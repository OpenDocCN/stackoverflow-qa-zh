# StackOverflow 问答 000565000-000565999

# sql - 检查 SQL CASE 语句中是否存在

> ID：565003
> 
> 赞同：2
> 
> 时间：2009-02-19T12:08:10.780
> 
> 标签：sql, database, db2

我正在尝试根据 table`a`中的不同列是否在 table 的一组结果中来更新 table 中的列`b`。目前的变化：

```
update a
set a.field1 =
 case
 when exists (
   select b.field2
   from b
   where b.field2 = a.field2
 )
 then 'FOO'
 else 'BAR'
 end 
```

没有运行。任何想法如何为 DB2 数据库执行此操作？

**编辑**：感谢您的回答，我能做的最好的就是

```
update a set field1 = 'FOO' where field2 in (select field2 from b);

update a set field1 = 'BAR' where field2 not in (select field2 from b); 
```

但我会保持打开状态，以防有人可以在顶部找到有效的代码版本。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-25T19:06:27.857

我在一个 DB2 for iSeries 机器上工作。尝试这个：

```
update a
set a.field1 =
 Coalesce( ( select 'FOO'
             from b
             where b.field2 = a.field2 ),
                      'BAR' ) 
```

`Coalesce()`是一个返回列表中第一个非 NULL 的函数。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-19T12:14:16.583

这适用于 SQLServer。也许 DB2 也有类似的结构。

```
update a SET field1 = 'BAR'
from a
     left outer join b on b.field1 = a.field1
where b.field1 is null;
update a SET field1 = 'FOO'
from a
     inner join b on b.field1 = a.field1 
```

问候，
利文

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-19T12:16:34.923

a.field1 的第一次出现应该是 a.field2。

您说“表中的不同列是否在集合中......”

您的代码正在修改同一列，而不是不同的列。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-19T12:16:45.860

我不是 SQL 或 DB2 方面的专家，但也许您可以加入这两个表并检查 b.field1 是否为空？

```
update a
set a.field1 = case when b.field1 is not null then 'FOO' else 'BAR' end
from a full outer join b on a.field1 = b.field1 
```

# javascript - 像在 Ted.com 中那样拟合不同的图像

> ID：565006
> 
> 赞同：4
> 
> 时间：2009-02-19T12:09:24.380
> 
> 标签：javascript, jquery, web-applications

[在http://www.ted.com/talks/browse](http://www.ted.com/talks/browse)和搜索结果 jinni.com中如何在固定空间中调整和调整不同图像的大小和拟合。

任何引导如何做到这一点，比如使用 jQuery 或使用 php 支持的东西。

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-20T01:17:34.190

就像在 TED 网站上所做的那样，他们使用 Flash 并且所有图像只有一个纵横比，这使得算法相当简单。对于更时尚的外观（以及严重的极客点），您可以选择几个纵横比（一个正方形、一个肖像、一个或两个水平）并自定义构建一个算法来解决 2D[装箱问题](http://en.wikipedia.org/wiki/Bin_packing_problem)的子集有效率的。

更好的是，您可以使用一些漂亮的代数来自动决定哪些尺寸适合指定宽度的矩形，并让算法自动为您完成所有调整大小。这听起来像是 NP 难的黑魔法，但实际上[A List Apart](http://www.alistapart.com/)前段时间有一篇关于它的优秀文章。它甚至对所涉及的数学和 PHP 代码有一个简单的解释，您可以根据需要下载和修改：

[自动杂志布局](http://www.alistapart.com/articles/magazinelayout)-[示例 1](http://www.alistapart.com/d/magazinelayouts/example1.htm)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-20T01:24:46.420

此显示的正确术语是[Treemap](http://en.wikipedia.org/wiki/Treemapping)。它可能有助于您的算法搜索。有几种可用的解决方案，包括[JavaScript](http://blog.thejit.org/javascript-information-visualization-toolkit-jit/)和[RoR](http://code.qnot.org/svn/projects/acts_as_treemap/)。

即使这些解决方案对您不起作用，适当的术语也应该可以帮助您走上正轨！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-19T12:29:09.107

使用 float:left & a fixed width & height with a clear:both 在某些图像上可以解决问题。

```
img.big{
 float:left;
 width:100px;
 height: 100px;
}
img.small{
 float:left;
 width:50px;
 height:50px;
}
img.clear{
 clear:both;
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-19T12:31:29.727

我相信他正在寻找一种能够实际执行图片布局的算法。

您可以查看[Wordle](http://www.wordle.net)，它似乎做了非常相似的事情（尽管它使用文本，而不是图像）。

# c# - 是否有任何简单的方法来检查文件的路径是否在某个文件夹（.NET 框架）内？

> ID：565026
> 
> 赞同：0
> 
> 时间：2009-02-19T12:13:05.930
> 
> 标签：c#, .net, file, path, directory

在我的程序中，我需要检查文件的多个路径是否位于系统临时文件夹中（例如*C:\Users\Roman\AppData\Local\Temp*）。我没有在*System.IO.File*、*System.IO.Directory*和*System.IO.Path*类中找到任何方法可以这样做。所以我创建了自己的：

```
public static bool IsSafeToDeleteFileOrDirectory(string path)
{
    try
    {
        string tempPath = Path.GetFullPath(
                    Path.Combine(Path.GetTempPath(), ".\\")
                    );
        string fullPath = Path.GetFullPath(path);
        return fullPath.StartsWith(tempPath) &&
               fullPath.Length > tempPath.Length;
    }
    catch (Exception ex)
    {}

    return false;            
} 
```

但我不确定它是否会一直有效。除了遍历文件夹树并检查每个子文件夹是否存在并且其父文件夹是 TEMP 之外，还有其他简单的解决方案吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-19T12:19:41.877

[`System.IO.Directory.Exists()`](http://msdn.microsoft.com/en-us/library/system.io.directory.exists(VS.80).aspx)也可以采用相对路径。我认为这应该为你做。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-19T12:17:05.657

StartsWith 方法将无法解释这种事情：

临时路径是：/tmp/

全路径为：/tmp/../etc/evil.cnf

您需要先规范化这两条路径，这将解决类似 ../

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-19T12:23:47.123

我相信您的代码甚至适用于 thomasrutter 的示例，因为路径由 Path.GetFullPath 解析。

# python - 我的程序可以访问超过 4GB 的内存吗？

> ID：565030
> 
> 赞同：6
> 
> 时间：2009-02-19T12:14:31.857
> 
> 标签：python, 64-bit

如果我在具有 64 位操作系统的 64 位机器上运行 python，我的程序是否能够访问全部内存？即，假设我有足够的 RAM，我可以建立一个包含 100 亿个条目的列表吗？如果没有，是否有其他编程语言允许这样做？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-19T12:31:24.560

您需要确保 Python 已构建为 64 位应用程序。例如，在 Win64 上，您将能够运行 Python.exe 的 32 位构建，但它不会获得 64 位环境的好处，因为 Windows 将在 32 位沙箱中运行它。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-19T12:17:45.623

语言 python 本身没有这样的限制，但也许你的操作系统或你的 python 运行时（pypy、cpython、jython）可能有这样的限制。

您想使用 python 运行时和操作系统的哪种组合？

# python - 在 Django 中为表单集的输出设置值

> ID：565034
> 
> 赞同：0
> 
> 时间：2009-02-19T12:15:44.897
> 
> 标签：python, django, django-forms, formset

这个问题与我之前提出的一个问题有些联系：

[使用 Django 在表单中生成和提交动态数量的对象](https://stackoverflow.com/questions/477183/generating-and-submitting-a-dynamic-number-of-objects-in-a-form-with-django)

我想知道，如果我在表单集中的每个表单都有单独的默认值，我是否能够预先填充这些字段？例如，需要在用户名中预先填写额外客户信息的表单？在诸如将电子邮件字段添加到已经存在的表中并立即更新其中许多的情况下。

Django 是否提供了一种简单的方法来做到这一点？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-19T15:57:05.443

传入一个字典列表，其中包含您要为每个表单设置的默认值：

[http://docs.djangoproject.com/en/dev/topics/forms/formsets/#using-initial-data-with-a-formset](http://docs.djangoproject.com/en/dev/topics/forms/formsets/#using-initial-data-with-a-formset)

# sql - sql查询查找订单太频繁的客户？

> ID：565040
> 
> 赞同：4
> 
> 时间：2009-02-19T12:17:28.213
> 
> 标签：sql, sql-server, tsql

我的数据库实际上不是客户和订单，而是客户和他们眼科测试的处方（以防万一有人想知道为什么我希望我的客户不那么频繁地下订单！）

我有一个眼镜连锁店的数据库，处方表有分店 ID 号、患者 ID 号以及他们进行眼睛测试的日期。随着时间的推移，患者将在数据库中列出不止一项眼科测试。如何获得在六个月内多次在系统中输入处方的患者列表。换言之，其中一个处方的日期是，例如，在同一患者的前一个处方日期的三个月内。

样本数据：

```
Branch  Patient DateOfTest
1      1          2007-08-12
1      1          2008-08-30
1      1          2008-08-31
1      2          2006-04-15
1      2          2007-04-12 
```

我不需要知道结果集中的实际日期，也不必正好是三个月，只需列出处方与前一个处方太接近的患者。在给出的示例数据中，我希望查询返回：

```
Branch   Patient
1       1 
```

这种查询不会经常运行，所以我不会过分担心效率。在我们的实时数据库中，处方表中有百万分之一的记录。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-19T12:28:03.743

像这样的东西

```
select p1.branch, p1.patient
from prescription p1, prescription p2
where p1.patient=p2.patient
and p1.dateoftest > p2.dateoftest
and datediff('day', p2.dateoftest, p1.dateoftest) < 90; 
```

应该做...你可能想添加

```
and p1.dateoftest > getdate() 
```

以限制未来的测试处方。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-19T12:33:24.760

这将有效地使用`(Branch, Patient, DateOfTest)`您当然应该拥有的索引：

```
SELECT Patient, DateOfTest, pDate
FROM (
  SELECT (
    SELECT TOP 1 DateOfTest AS last
    FROM Patients pp
    WHERE pp.Branch = p.Branch
      AND pp.Patient = p.Patient
      AND pp.DateOfTest BETWEEN DATEADD(month, -3, p.DateOfTest) AND p.DateOfTest
    ORDER BY 
      DateOfTest DESC
    ) pDate
  FROM Patients p
) po
WHERE pDate IS NOT NULL 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-19T12:26:07.680

在途中：

```
select d.branch, d.patient
from   data d
where exists
( select null from data d1
  where  d1.branch = d.branch
  and    d1.patient = d.patient
  and    "difference (d1.dateoftest ,d.dateoftest) < 6 months"
); 
```

这部分需要更改 - 我不熟悉 SQL Server 的日期操作：

```
"difference (d1.dateoftest ,d.dateoftest) < 6 months" 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-19T12:33:41.840

自加入：

```
select a.branch, a.patient
   from prescriptions a
   join prescriptions b
   on     a.branch = b.branch 
      and a.patient = b.patient
      and a.dateoftest > b.dateoftest
      and a.dateoftest - b.dateoftest < 180
group by a.branch, a.patient 
```

这假设您希望患者访问同一分支机构两次。如果不这样做，请取出分支部分。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-19T12:37:59.880

```
SELECT Branch
      ,Patient
  FROM (SELECT Branch
              ,Patient
              ,DateOfTest
              ,DateOfOtherTest
          FROM Prescriptions P1
          JOIN Prescriptions P2
            ON P2.Branch = P1.Branch
           AND P2.Patient = P2.Patient
           AND P2.DateOfTest <> P1.DateOfTest
       ) AS SubQuery
  WHERE DATEDIFF(day, SubQuery.DateOfTest, SubQuery.DateOfOtherTest) < 90 
```

# c++ - 您最喜欢用 C/C++ 访问多个不同数据库（MySQL、Oracle ...）的跨平台解决方案是什么？

> ID：565056
> 
> 赞同：2
> 
> 时间：2009-02-19T12:21:55.817
> 
> 标签：c++, c, database, cross-platform

我正在编写一个简单的 C++ 应用程序，它可能安装在 Linux 或 Windows 上，并将连接到数据库。我希望我的应用程序至少与 Oracle 和 MySQL（或 PostgreSQL）兼容。

您会推荐使用哪个 C 或 C++ 库来处理数据库查询：我对任何库都持开放态度，无论它是非常瘦（只执行 SQL 查询）还是非常胖（整个对象持久层、集群等）。

请每个答案一个图书馆。一点描述（优点和缺点）会很棒。非常感谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-19T12:31:54.590

我喜欢使用[SOCI](http://soci.sourceforge.net/)，它非常像 C++。就 Oracle 数据库的性能而言，它可以与原生 OCI 相媲美。它为一些 RDBMS 提供后端：

*   甲骨文
*   PostgreSQL
*   MySQL

还有一些在 CVS 存储库中。

它使用起来相当简单，文档很详尽，基本原理也很清楚。它支持连接池，具有很好的可扩展的数据类型转换方式。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-19T14:07:48.293

我真的很喜欢[QtSql](https://doc.qt.io/qt-5/qtsql-index.html)

*   它具有设计精良和跨平台的优点。
*   缺点是它是 LGPLv3（或商业）许可的，可能不适用于所有人。

您不必使用 Qt GUI，但如果您也需要 GUI 库，那就太好了。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-19T12:25:20.880

这正是[ODBC](http://support.microsoft.com/kb/110093)的设计目的。是的，它是由 Microsoft 设计的，但现在几乎每个平台和几乎每个数据库产品都有实现。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-19T14:00:59.650

我使用 SQLAPI++，它是一个很棒的产品。您可以免费试用，上手简单，而且他们的支持很棒。

[http://www.sqlapi.com/](http://www.sqlapi.com/)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-19T12:24:45.920

严重地？ [数据提供者](http://msdn.microsoft.com/en-us/library/ms972319.aspx)。

没有什么比为每个数据库自定义数据调用更好的了。通用解决方案往往有太多妥协 IMO。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2015-03-25T12:21:58.700

实际上，随着时间的推移，远离数据提供者 API 是明智的，您将遇到版本控制和默认参数化问题。最好是在您确实需要完全优化的后端时使用 SOCI，否则请坚持使用 OTL4.0 等任何辅助工具进行 ODBC 调用。

# java - 使用 jep.invoke() 方法

> ID：565060
> 
> 赞同：0
> 
> 时间：2009-02-19T12:24:00.493
> 
> 标签：java, python

我需要从 python 脚本调用一个函数并将参数传递给它。我有一个测试 python 脚本，我可以使用 Jepp 从 java 调用和运行它 - 然后添加人员。

例如Test.py

```
import Finding
from Finding import *

f = Finding()
f.addFinding("John", "Doe", 27) 
```

在我的寻找课程中，我有`addFinding(firstname, lastName, age)`

但是，我希望能够在 java 中做到这一点。我应该使用这种`jep.invoke()`方法吗？有没有人有一个 hello world 的例子来做这样的事情，或者转发给我一些好的例子？

请问有人有什么建议吗？

提前致谢

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-19T12:50:19.167

在 java 中运行 python 代码的更简单方法是使用[jython](http://www.jython.org/)。

**编辑：**在 jython 网站上找到了[一篇带有示例的文章。](http://wiki.python.org/jython/JythonMonthly/Articles/September2006/1)

# wcf - 检查 WCF Web 服务的可用性

> ID：565062
> 
> 赞同：10
> 
> 时间：2009-02-19T12:24:31.973
> 
> 标签：wcf

我想通过 C# 代码检查 WCF Web 服务 ic 服务的可用性是向上还是向下。如何做到这一点？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-19T12:40:32.387

当您调用`Client.Open`它是否已关闭时，应该抛出一个您可以捕获的异常。
我更喜欢做的是实现一个返回名为 Ping 的布尔值的方法。代码基本上就是这样做的，`return true;`因此它会尽快返回。在客户端，我调用它并捕获异常，如果我得到任何异常，那么我知道 Web 服务已关闭。
您可以扩展该模式以执行 PingCheckDB 或 PingCheckX 之类的操作，它们可以进行假/样本测试运行，以便您根据可用的内容启用/禁用客户端上的功能。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-19T13:51:56.023

详细说明上一个答案：确定服务是否“可用”的唯一方法是首先确定“可用”的含义。例如，依赖于数据库等外部资源的服务可能完全可用，但如果无法访问数据库，则该服务将可用但无用。

您还应该询问您将如何处理有关可用性的信息。特别是，如果您确定该服务是“可用的”，但当您调用它时，您会发现它并不是真正的“可用”。例如，如果上述服务可用并且数据库可用，但有一个特定的存储过程总是会失败。在这种情况下，服务是否“可用”？如果您指出它可用，但是这个存储过程失败了，那会有多糟糕？

在许多情况下，最好直接调用 Web 服务，然后处理任何异常。如果您已经验证了要发送到服务的参数，那么从最终用户的角度来看，服务的任何故障都相当于服务不可用。

无法成功使用，你看。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2014-03-11T21:23:19.203

这就是我正在使用的，效果很好。如果您想在顶部使用 Using 语句来限定它，ServiceController 位于命名空间“System.ServiceProcess”中。

```
try
{
    ServiceController sc = new ServiceController("Service Name", "Computer's IP Address");
    Console.WriteLine("The service status is currently set to {0}",
        sc.Status.ToString());

    if ((sc.Status.Equals(ServiceControllerStatus.Stopped)) ||
        (sc.Status.Equals(ServiceControllerStatus.StopPending)))
    {
        Console.WriteLine("Service is Stopped, Ending the application...");
        Console.Read();
        EndApplication();
    }
    else
    {
        Console.WriteLine("Service is Started...");
    }
}
catch (Exception)
{
    Console.WriteLine("Error Occurred trying to access the Server service...");
    Console.Read();
    EndApplication();
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2017-10-27T14:16:05.263

我使用以下代码。这很简单而且有效...

```
 public bool IsServiceRunning()
    {
        try
        {
            System.Net.WebClient wc = new System.Net.WebClient();
            string s = wc.DownloadString(new Uri("http://localhost:27777/whatever/services/GatherDataService?wsdl"));
        }
        catch (Exception ex)
        {
            return false;
        }

        return true;
    } 
```

只需获取您的端点 uri 并添加 ?wsdl

# asp.net-mvc - 如何将代码隐藏添加到 asp.net mvc 视图？

> ID：565069
> 
> 赞同：0
> 
> 时间：2009-02-19T12:26:06.463
> 
> 标签：asp.net-mvc

我正在经历一些我无法弄清楚的疯狂。

我创建了以下类：

```
public abstract class AbstractView<T> : ViewPage<T> where T : class 
```

这给了我一些有用的帮助，我在我的观点中使用它，如下所示：

```
<%@ Page Title="" Language="C#" MasterPageFile="~/Views/Shared/Site.Master" Inherits="Project.Web.Mvc.AbstractView<Project.Domain.Entities.Example>" %> 
```

这一切都很好。现在我必须创建一个需要大量复杂渲染代码的视图，所以我想给我的视图一个代码隐藏，这样我就可以将所有这些表示逻辑放入其中。

但是，当我这样做时：

```
<%@ Page Title="" Language="C#" MasterPageFile="~/Views/Shared/Site.Master" Inherits="Project.Web.Views.Examples.View" CodeBehind="~/Views/Examples/View.aspx.cs" %>

public class View : Project.Web.Mvc.AbstractView<Project.Domain.Entities.Example> 
```

当我调试视图时，模型总是为空，这随后给了我：

```
"The view 'View' or its master could not be found. The following locations were searched..." 
```

这是怎么回事？

PS不要告诉我代码隐藏是邪恶的。我正在编写特定于演示文稿的逻辑，还有很多。它不会在 aspx 中内联。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-19T12:40:52.620

您可以尝试同时使用代码。我的意思是从`AbstractView<T>`那个派生的一个类只被这个视图使用。它与代码隐藏几乎是相同的概念。然后只需指向它而不是使用`AbstractView<T>`.

此外，您的模型在 OnLoad 之前不会被连接（可能更早，我自己从未做过），因此如果您尝试在构造函数中使用它，这可能是您的问题。

否则，您可能希望考虑使用 ViewModel，这样您就不必传递我认为是原始域对象的内容，而是在 ViewModel 中执行自定义格式并将其传递给`AbstractView<T>`.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-19T12:43:50.820

使用 View 作为你的类名可能不是一个好主意。使用更具体的东西。

我认为您是在 Inherits 属性中指定的命名空间中声明类？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-19T12:49:59.120

好吧，我的错，模型在加载之前在代码隐藏中没有准备好，我在构造函数中做事。

奇怪的是 MVC 会说“找不到视图”，当它明显可以时，只是抛出了一个异常

# php - Magento中定义的setCouponCode函数在哪里

> ID：565072
> 
> 赞同：1
> 
> 时间：2009-02-19T12:26:22.063
> 
> 标签：php, magento, cart, rule, coupon

我知道 setCouponCode 在 Varien_Object 的 __call 中被捕获，但我不知道它是在哪里定义的。

我需要它，因为即使折扣为零，我也想显示优惠券代码。我相信它是在这个函数内部完成的。

因此，如果有人知道函数在哪里定义或者我可以在哪里修改代码以始终显示优惠券代码，请告诉我。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-19T17:36:51.617

大多数文本编辑器都有“在文件/文件夹中搜索”选项。打开源文件夹并搜索函数 __setCouponCode。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-20T02:28:00.917

好的，我想通了。SetCouponCode 在魔法函数中设置 coupon_code 的值。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-02-03T11:43:57.977

与此相关，有没有人注意到报价没有被正确删除？我说这与此有关，因为在您从购物车中删除产品后，优惠券代码变量会保留值 [如果有的话]。

尝试： 1\. 为产品设置一些购物车价格规则，并使其在标题部分显示横幅。2\. 将产品添加到结帐/购物车以触发规则并在购物车上显示横幅。3\. 从购物车中删除产品，您会看到标题部分仍显示横幅。

笔记。如果您在购物车中有其他产品，这将不起作用，因为当您删除触发规则和横幅的产品时，优惠券代码将被购物车中属于该其他产品的产品替换。因此，只有触发规则和横幅的产品在购物车中时，此错误才有效。

如果有人对此有解决方案或可以复制这些条件：我很想讨论一下 magento 的缺陷，无法从购物车中删除正确的产品——这意味着正确的报价刷新。

参考：-app/code/core/Mage/Sales/Model/Quote.php -> public function removeItem($itemId)

是的，magento 核心问题。

# c# - 如何使用通用 getter 和 setter 设置只读属性的值？

> ID：565075
> 
> 赞同：9
> 
> 时间：2009-02-19T12:28:01.403
> 
> 标签：c#, properties

不确定我的措辞是否正确......但我有以下代码：

```
 public Guid ItemId
    {
        get;
    }

    public TransactionItem()
    {
        this.ItemId = Guid.Empty;
    } 
```

自然地，我遇到了一个只读问题……我确实理解。无论如何设置此属性值而不必执行以下操作：

```
 Guid _itemId = Guid.Empty;
    public Guid ItemId
    {
        get
        {
            return _itemId;
        }
        set
        {
            _itemId = value;
        }
    } 
```

或者

```
 public Guid ItemId
    {
        get;
        internal set;
    } 
```

提前致谢！

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2009-02-19T12:36:22.520

我会这样做：

```
public Guid ItemId
{
    get;
    private set; // can omit as of C# 6 
}

public TransactionItem()
{
    this.ItemId = Guid.Empty;
} 
```

当然，它可以在这个类中设置，但既然你正在写它，我希望你有意识不要破坏自己的意图......

在我看来，像只读属性这样的东西，从外部看是最重要的。从里面看，它是什么并不重要，因为在那里，你是国王 =)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-19T12:45:42.047

如果您只需要该`ItemId`属性对您班级的外部用户是只读的，那么 Svish 的答案就是要走的路。

如果您需要`ItemId`在类本身中是只读的，那么您需要执行以下操作：

```
private readonly Guid _ItemId
public Guid ItemId
{
    get { return _ItemId; }
}

public TransactionItem()
{
    _ItemId = Guid.Empty;
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-19T12:32:38.583

您可以使用[readonly](http://msdn.microsoft.com/en-us/library/acdd6hb7.aspx)关键字

```
public readonly Guid ItemId;

public TransactionItem()
{
    this.ItemId = Guid.Empty;
} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-19T12:33:52.060

恐怕你的问题不是很清楚 - 但如果没有定义属性设置器，那么你当然不能调用它。

您*实际上*是否在自动实现只读属性之后，只允许在构造函数中进行设置？如果是这样，恐怕它不可用，就像我想要的那样。

只是为了扩展我的意思，我希望*能够*做到：

```
// Not valid in C# - yet!
public class Foo
{
    // Autogenerated field would be readonly in IL.
    public string Name { get; readonly set; }

    public Foo (string name)
    {
        this.Name = name;
    }

    public void Bar()
    {
        // This would be invalid
        this.Name = "No!";
    }
} 
```

基本上它是“制作一个像只读字段一样的属性”。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-19T12:35:30.853

使用私人设置器，还是设置支持字段？
（但是，您必须确保支持字段的名称可以根据属性名称来确定。
例如，确保您的支持字段始终与属性名称具有相同的名称，但前缀为下划线；就像`NHibernate`使用它的访问策略一样）。

# language-agnostic - 代码应该在多大程度上尝试解释致命异常？

> ID：565077
> 
> 赞同：3
> 
> 时间：2009-02-19T12:28:08.050
> 
> 标签：language-agnostic, error-reporting

我怀疑所有重要的软件都可能遇到遇到无法解决的外部问题并因此需要失败的情况。这可能是由于配置错误、外部服务器关闭、磁盘已满等原因。

在这些情况下，特别是如果软件在非交互模式下运行，我希望真正能做的就是记录错误并等待管理员阅读日志并修复问题。如果有人碰巧在此期间与软件交互，例如请求进入未能正确初始化的服务器，那么也许可以给出适当的提示来检查日志，甚至可以回显错误（取决于是否您可以判断他们是技术人员还是业务用户）。不过，我们暂时不要想太多这部分。

我的问题是，软件应该在多大程度上负责试图解释致命错误的含义？一般来说，您可以假定软件管理员有多少能力/知识，以及在记录致命错误时您应该包含多少故障排除信息和潜在的解决步骤？当然，如果运行时上下文有一些独特的东西，那么肯定应该记录下来；但是让我们假设您的软件需要通过 LDAP 与 Active Directory 通信并返回错误“ `[LDAP: error code 49 - 80090308: LdapErr: DSID-0C090334, comment: AcceptSecurityContext error, data 525, vece]`”。假设维护人员能够通过谷歌搜索错误代码并弄清楚它的*含义*是否合理，或者软件是否应该尝试解析错误代码并记录这是由 LDAP 配置中不正确的用户 DN 引起的？

我不知道是否有一个明确的最佳实践答案，所以我很想听听各种观点。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-19T12:34:09.483

对于所有广泛的问题，答案是“视情况而定”。

如果您正在查看配置错误，那么无论如何您都应该尝试解释错误的原因（在日志中）。如果这是一个内存不足的错误，那么您无能为力——您甚至可能无法编写日志消息。

你说的一件事与我有关：

> 如果在此期间有人碰巧与软件交互，例如请求进入未能正确初始化的服务器，那么也许可以给出适当的提示来检查日志

如果这确实是一个致命错误，则服务器不应该运行，因此任何传入的请求都应该失败，并且绝对没有警告或解释。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-19T12:46:27.380

我倾向于同意的方法是，如果致命错误是由您自己负责的某些代码（即不是第三方）引起的，您应该尽可能多地解释。否则，如果错误是由“进一步向下”引起的，例如在数据库级别，那么管理员应该向上传递返回的错误，而无需添加更多进一步的信息。因此，如果数据库服务器死了，那么您的连接器会抛出一些异常，并且您将在异常中记录错误代码。

然后，管理员或支持人员应该有足够的知识来使用所提供的信息解决问题。

当您确实提供了太多不是由您自己的代码引起的错误的详细信息时，您将面临错误详细信息与实际错误原因不匹配的风险，特别是如果错误代码在版本之间停止匹配时。

当然，也有例外。我们曾与文档记录如此糟糕的开源库合作，以至于我们最终围绕这些库编写了包装器，只是为了提供对实际情况的良好记录。

只是我的2c

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-19T12:35:20.510

您至少应该提供来自异常的消息和堆栈跟踪，以便您可以找出它在代码中发生的位置。如果可能，您还应该根据异常类型解释您尝试执行的操作以及您认为可能发生的情况。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-19T12:34:24.570

我想这取决于您在将软件交付给客户之前有多少时间。

是的，解析错误并给出更明确的消息会很好，但是在这个时代，谷歌并不总是很远。

因此，除非您有时间创建代码来解析错误，否则我会保持原样。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-19T12:50:28.557

恕我直言，在这种情况下，您永远不能提供太多信息。

然而，在现实世界中，它归结为成本效益分析。错误对您、您的应用程序、您的业务等有什么影响。值得花多少时间在上面。

在业务关键型应用程序中，我的第一点适用。其他一切都是一个滑动规模。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-19T13:13:49.750

我认为这取决于谁在使用该应用程序。

如果精通技术的人使用该应用程序，则显示更多技术细节，以便他们能够根据需要解决问题。我让一些用户不遗余力地解决问题。它非常有用，尤其是对于特定于某些配置的问题。

如果您的用户群更多的是普通的 Joe，那么在大多数情况下，技术细节会让他们感到困惑。您应该向他们展示一条简单的错误消息，并尽可能提供一些解决方案。

您也可以合并这两种技术。默认情况下显示简单的错误消息，并允许用户根据需要查看更详细的错误信息。

你只是不想用太多他们不理解的信息来压倒用户。在大多数情况下，这只会让他们感到沮丧和困惑。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-19T18:19:35.803

我认为所有错误和异常都应该有两个方面：

1）错误中有足够的信息来帮助调试问题。Stacktrace、类/方法名、异常类型等都属于这一类。

2) 一条人类可以理解的消息，理想情况下足够清晰，让运维团队或系统管理员工程师知道该给谁打电话或转发该错误消息。通常它的形式是“某某模块失败”或“网络呼叫失败”等。用非技术术语向客户解释问题的方式很接近您。

现在由于时间限制等，可能无法同时编写两种消息。然后我会四处走动，说我们应该有第二种类型的错误消息。请记住，系统管理员可能会打电话给您，并且由于您帮助编写了代码，您可能可以查明错误。但是如果客户在电话中询问错误，系统管理员最好能够解释可能的原因:)

另一方面，所有产品都需要在架构级别确定明确的异常/错误处理机制。例外情况需要遵守该设计。没有什么比试图根据设计调试错误更令人沮丧的是，一天后才发现它是基于完全不同的设计的一种错误消息。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-04-26T13:02:14.010

请参阅[https://meta.stackexchange.com/questions/3122/formatting-sandbox](https://meta.stackexchange.com/questions/3122/formatting-sandbox)

# javascript - Javascript 或 JQuery 思维导图插件

> ID：565081
> 
> 赞同：0
> 
> 时间：2009-02-19T12:29:25.033
> 
> 标签：javascript, jquery, ajax, mindmapping

有人知道我可以使用一个漂亮的 Ajax 思维导图模块吗？

我对可以将 minmaps 保存到 SQL 以输入数据库的东西感兴趣，但是如果需要，我很乐意添加该功能，这就是我正在寻找的闪亮性。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-19T21:30:30.460

几年前，我使用 Prototype 制作了一个[概念验证](http://jameslab.moveable.com/ajaxio)盒和连接器程序，作为学习 Prototype 的一种“双脚跳入”的方法。这有点蹩脚，我从来没有完成它，但它证明它是可以完成的。不客气。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-19T17:06:34.097

有[这个](http://code.google.com/p/js-mindmap/)，但还很年轻。

# php - 在formmail中附加文件。(php 格式邮件)

> ID：565082
> 
> 赞同：0
> 
> 时间：2009-02-19T12:30:06.640
> 
> 标签：php, attachment, formmail

我正在编写一个用于下订单的邮件表单 i php，并且感觉他们必须向我发送图片才能使订单正常工作，我希望能够将文件附加到 formmail 中。我该怎么做？我已经看到了一些不同的解决方案，但不是我完全理解的。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-19T12:52:57.613

您需要设置正确的邮件标头，然后通过将文件编码为您在标头中声明的任何形式来附加文件，例如以下代码段：

您需要在这里做的就是读取文件并对其进行编码（在这种情况下为 base64）

```
$file = fopen($fileatt,'rb');
$data = fread($file,filesize($fileatt));
fclose($file);

$data = chunk_split(base64_encode($data)); 
```

首先你需要一个边界，比如一条规则来告诉一个部分在哪里停止，另一个开始

```
$semi_rand = md5(time());
$mime_boundary = "==Multipart_Boundary_x{$semi_rand}x"; 
```

然后正确设置标题，以支持附件

```
$headers .= "\nMIME-Version: 1.0\n" .
"Content-Type: multipart/mixed;\n" .
" boundary=\"{$mime_boundary}\""; 
```

然后建立你的信息

```
$email_message .= "This is a multi-part message in MIME format.\n\n" .
"--{$mime_boundary}\n" . // start text block
"Content-Type:text/html; charset=\"iso-8859-1\"\n" .
"Content-Transfer-Encoding: 7bit\n\n" .
$email_content . "\n\n" .
"--{$mime_boundary}\n" . // start attachement
"Content-Type: {$fileatt_type};\n" .
" name=\"{$fileatt_name}\"\n" .
//"Content-Disposition: attachment;\n" .
//" filename=\"{$fileatt_name}\"\n" .
"Content-Transfer-Encoding: base64\n\n" .
$data . "\n\n" . // this is the file...
"--{$mime_boundary}\n"; 
```

然后...使用邮件发送消息;-)

```
mail($email_to, $email_subject, $email_message, $headers) 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-24T20:45:00.640

我还建议 php_mailer [http://sourceforge.net/project/showfiles.php?group_id=26031](http://sourceforge.net/project/showfiles.php?group_id=26031)

拥有您可能想要的所有选项，并让您构建自定义长度表格而不会“太”痛苦

还有一堆教程，如果你愿意，我很乐意发送我最近做的一个项目的例子

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-02-05T06:11:28.777

$sl="select max(id)AS maxid from photos"; $res=mysql_query($sl); $rowl=@mysql_fetch_array($res);

$adid=$rowl['maxid']; $filedir="/photo_gallery/"; $file1=$filedir."img".$adid.$_FILES['myfile']['name'];

//回显 $file1; @move_uploaded_file($_FILES['myfile']['tmp_name'],$file1);

$upd="更新照片集 photo='".$file1."',Added_date=now() where id=$adid";

//回显 $upd; mysql_query($upd);

@unlink($file1);

# vim - vi、vim 缓冲区溢出

> ID：565088
> 
> 赞同：2
> 
> 时间：2009-02-19T12:32:10.130
> 
> 标签：vim, vi

当我错误地试图切换到最后一个缓冲区 [n:] 后面时，我丢失了所有以前的缓冲区。

例如，如果我在编辑器中打开几个文件

```
:ls
  1 #    "/etc/moduli"                  line 1
  2 %a   "/etc/motd"                    line 1

:n
E163: There is only one file to edit

:p
E163: There is only one file to edit

now i can navigate between tabs just using :b [number] 
```

请建议如何解决此问题。在这种情况下，如何防止缓冲区关闭？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-19T12:54:50.853

我认为你在那里混淆了一些东西。缓冲区类似于打开的文件。*当您使用:n*切换到参数列表中的下一个文件时，您将关闭当前缓冲区并打开下一个缓冲区，因此此时必须保存或丢弃更改。

此外，如果您尝试超出参数列表中的最后一个文件，vim 的默认行为是显示错误消息，因此在 vim 中丢失任何内容都不是很容易。

如果这不能回答您的问题，也许在这里描述您的行为（按键）可能会有所帮助。

[编辑]

好的，现在我知道问题出在哪里了：缓冲区和您在启动 vim 时提供的要编辑的文件列表之间存在差异。如果你开始 vim

```
vim a.txt b.txt 
```

有 2 个文件要编辑。这并不意味着有多个缓冲区。您可以使用 :n 和 :p 导航（意思是 n(ext) 文件和 p(revious) 文件）。如果您设置了全局标志 :hidden，这意味着您关闭的每个缓冲区都将成为隐藏缓冲区。该文件仍在编辑中，但未显示在任何窗口中。该值可能是在系统中启动 vim 时设置的。尝试将*:se nohidden*添加到您的 .vimrc 并尝试以下操作：

```
:help buffer-hidden 
```

[/编辑]

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-19T16:48:50.177

:n 和 :p 不在缓冲区之间切换:)

试试 :bufnext 和 :bufprev

也许你会喜欢：

```
nmap <LEADER>k :bnext<CR>:redraw<CR>
nmap <LEADER>j :bprevious<CR>:redraw<CR>
nmap <LEADER>d :bd<CR>
nnoremap <LEADER>b :buffers<CR>:buffer<space> 
```

按 ,j 为上一个缓冲区，按 ,k 为下一个缓冲区，按 ,d 关闭当前缓冲区，按 ,b 列出您的缓冲区并用数字键选择一个。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-19T18:46:52.410

```
:bn 
```

将在您的缓冲区中显示下一个**ext**文件（在您的情况下为“/etc/moduli”）

```
:bp 
```

将在您的缓冲区中显示上一个文件（也是“/etc/ **moduli** ”，因为它会进行排列）

您会注意到的一件事是您正在编辑的文件标有

```
%a 
```

然而

```
# 
```

表示这是您显示的最后一个文件。希望它可以帮助你。

# javascript - 在js中使用关键字this声明变量

> ID：565094
> 
> 赞同：0
> 
> 时间：2009-02-19T12:33:10.500
> 
> 标签：javascript, jquery

这之间有区别吗：

```
var onClick = function() {

     var image = .....

     $.post("/..../...", null, function(data) { myCallback(data, image); } );
} 
```

和

```
var onClick = function() {

     this.image = .....

     $.post("/..../...", null, function(data) { myCallback(data, this.image); } );
} 
```

我正在使用“这种”方式，由于某种原因，我传递给 myCallback 的任何参数都是空的？

如果我在 $.post 调用之前使用警报输出变量，我会得到一个值，所以它不为空？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-19T12:38:12.500

当时....

```
function(data) { myCallback(data, this.image); } 
```

...将被执行（在 ajax 调用完成后），执行上下文被改变。它将在 jQuery 对象上下文中。所以在那个时候，这个 === jQuery，正如你已经看到的，没有 image 属性。因此，错误。

顺便说一句，谷歌搜索 JavaScript 闭包并尝试理解它们。这正是您的问题所在。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-19T12:39:52.060

由于您正在创建名为 'closure' 的 sol，使用 'var' 声明变量将起作用。'this' 关键字指的是当前作用域的对象，根据情况，它可能指的是函数、窗口对象或任何其他对象。一旦回调方法触发，这个范围肯定会有所不同，因此不可靠。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-19T12:49:36.703

如果您打算让 onClick 函数表示一个类（似乎不太可能），“this”既可以作为指示符，也可以作为公开实例属性的手段（因为在类实例中声明的 var 实际上是私有的）。

如果您不打算用 onClick 来表示一个类，那么这是完全*不合适*的，因为它会产生令人困惑的信号并混淆上下文足迹（无论上下文是什么）。

# java - getter 和 setter 是糟糕的设计吗？看到矛盾的建议

> ID：565095
> 
> 赞同：232
> 
> 时间：2009-02-19T12:33:20.000
> 
> 标签：java, oop, setter, getter, accessor

我目前正在开发一个具有多种不同模式的简单 Java 游戏。我扩展了一个主游戏类，将主逻辑放在其他类中。尽管如此，主要的游戏类仍然相当庞大。

在快速浏览了我的代码后，其中大部分是 Getters 和 Setters（60%），而其余部分则是游戏逻辑真正需要的。

一些 Google 搜索声称 Getter 和 Setter 是邪恶的，而其他人则声称它们对于良好的 OO 实践和出色的程序是必要的。

所以我该怎么做？应该是哪个？我应该为我的私有变量更改我的 Getter 和 Setter，还是应该坚持使用它们？

* * *

## 回答 #1

> 赞同：351
> 
> 时间：2009-02-19T13:03:56.917

还有一种观点认为，在大多数情况下，使用 setter 仍然会破坏封装，因为它允许您设置无意义的值。作为一个非常明显的例子，如果你在游戏中有一个只会上升的分数计数器，而不是

```
// Game
private int score;
public void setScore(int score) { this.score = score; }
public int getScore() { return score; }
// Usage
game.setScore(game.getScore() + ENEMY_DESTROYED_SCORE); 
```

它应该是

```
// Game
private int score;
public int getScore() { return score; }
public void addScore(int delta) { score += delta; }
// Usage
game.addScore(ENEMY_DESTROYED_SCORE); 
```

这也许是一个简单的例子。我想说的是，讨论 getter/setter 与公共字段通常会掩盖更大的问题，因为对象以亲密的方式操纵彼此的内部状态，因此耦合太紧密。

这个想法是制作直接做你想做的事情的方法。一个例子是如何设置敌人的“活着”状态。您可能很想拥有一个 setAlive(boolean alive) 方法。相反，您应该拥有：

```
private boolean alive = true;
public boolean isAlive() { return alive; }
public void kill() { alive = false; } 
```

这样做的原因是，如果您更改实现，使事物不再具有“活动”布尔值而是“生命值”值，则可以在不违反您之前编写的两种方法的合同的情况下进行更改：

```
private int hp; // Set in constructor.
public boolean isAlive() { return hp > 0; } // Same method signature.
public void kill() { hp = 0; } // Same method signature.
public void damage(int damage) { hp -= damage; } 
```

* * *

## 回答 #2

> 赞同：186
> 
> 时间：2009-02-19T12:36:07.187

*   非常邪恶：公共领域。
*   有点邪恶：在不需要的地方获取和设置。
*   好：仅在真正需要的地方获取 getter 和 setter —— 让类型暴露碰巧*使用*其状态的“更大”行为，而不是仅仅将类型视为状态存储库以供其他类型操作。

不过，这实际上取决于具体情况——有时您确实*只是*想要一个愚蠢的数据对象。

* * *

## 回答 #3

> 赞同：47
> 
> 时间：2009-02-19T13:26:47.533

你已经对此有了很多很好的答案，所以我只给我两分钱。Getter 和 Setter 非常非常邪恶。它们本质上是让您假装隐藏对象的内部结构，而大多数时候您所做的一切都被扔进了对隐藏内部状态没有任何作用的冗余代码中。对于一个简单的 POJO，没有理由不能将 getName() 和 setName() 替换为 obj.name = "Tom"。

如果方法调用仅仅代替了赋值，那么你通过更喜欢方法调用所获得的只是代码膨胀。不幸的是，该语言在 JavaBeans 规范中规定了 getter 和 setter 的使用，因此 Java 程序员被迫使用它们，即使这样做毫无意义。

幸运的是，Eclipse（可能还有其他 IDE）允许您自动生成它们。对于一个有趣的项目，我曾经在 XSLT 中为他们构建了一个代码生成器。但是，如果我想在 Java 中摆脱一件事，那就是过度依赖 getter 和 setter。

* * *

## 回答 #4

> 赞同：29
> 
> 时间：2009-02-19T13:27:34.210

Getter 和 setter在面向对象编程中强制执行[封装的概念。](http://en.wikipedia.org/wiki/Encapsulation_(computer_science))

通过将对象的状态隐藏在外部世界之外，对象真正掌控自己，并且不能以非预期的方式进行更改。可以操作对象的唯一方法是通过公开的公共方法，例如 getter 和 setter。

拥有 getter 和 setter 有几个优点：

**1\. 允许将来更改而不修改使用修改后的类的代码。**

使用 getter 和 setter 的一大优势是，一旦定义了公共方法，就会有一段时间需要更改底层实现（例如，找到需要修复的错误，使用不同的算法来提高性能等），通过让 getter 和 setter 成为操作对象的唯一方法，它将允许现有代码不会中断，并且即使在更改之后也可以按预期工作。

例如，假设有一个`setValue`方法`value`在对象中设置私有变量：

```
public void setValue(int value)
{
    this.value = value;
} 
```

但是随后，有一个新的要求需要跟踪`value`更改的次数。使用 setter 后，更改就相当简单了：

```
public void setValue(int value)
{
    this.value = value;
    count++;
} 
```

如果该`value`字段是公开的，则没有简单的方法可以稍后返回并添加一个跟踪值更改次数的计数器。因此，拥有 getter 和 setter 是一种让类“面向未来”以应对以后可能发生的变化的方法。

**2\. 执行可以操纵对象的方法。**

getter 和 setter 派上用场的另一种方式是强制执行对象可以被操纵的方式，因此，对象可以控制自己的状态。暴露对象的公共变量后，它很容易被破坏。

例如，一个`ImmutableArray`对象包含一个`int`名为 的数组`myArray`。如果数组是一个公共字段，它就不会是不可变的：

```
ImmutableArray a = new ImmutableArray();
int[] b = a.myArray;
b[0] = 10;      // Oops, the ImmutableArray a's contents have been changed. 
```

要实现一个真正不可变的数组，应该为数组（`getArray`方法）编写一个 getter，以便它返回其数组的副本：

```
public int[] getArray()
{
    return myArray.clone();
} 
```

即使发生以下情况：

```
ImmutableArray a = new ImmutableArray();
int[] b = a.getArray();
b[0] = 10;      // No problem, only the copy of the array is affected. 
```

`ImmutableArray`确实是不可变的。公开对象的变量将允许以非预期的方式对其进行操作，但仅公开某些方式（getter 和 setter），可以以预期的方式操作对象。

我认为拥有 getter 和 setter 对于作为 API 一部分的类将被其他人使用更为重要，因为它允许保持 API 完整和不变，同时允许对底层实现进行更改。

说完 getter 和 setter 的所有优点，如果 getter 只是返回私有变量的值，而 setter 只是接受一个值并将其分配给私有变量，那么 getter 和 setter 似乎是无关紧要的，实际上是一个浪费。如果该类仅供应用程序内部使用而不会被其他人使用，那么广泛使用 getter 和 setter 可能不如编写公共 API 时那么重要。

* * *

## 回答 #5

> 赞同：28
> 
> 时间：2011-10-08T11:03:49.053

他们绝对是邪恶的。

@coobird 不幸的是，他们绝对不会“强制执行封装的概念”，他们所做的只是让您认为您正在封装数据，而实际上您正在通过具有方法宏伟妄想的属性公开数据。任何 getter/setter 对公共领域所做的事情都会做得更好。

首先，如果您想要公共数据，请将其公开，摆脱 getter 和 setter 方法，以减少客户端必须涉足的方法数量，并使客户端在认知上更简单地更改它的值，例如。

```
object.field = value; 
```

而不是更强烈的认知

```
object.setField(value); 
```

客户端现在必须检查 getter/setter 方法以查看它是否有任何副作用。

其次，如果你真的需要在方法中做一些其他的事情，当它比简单的获取或设置有更多的职责时，为什么要称它为 get/set 方法呢？要么遵循 SRP，要么调用该方法，该方法实际上可以告诉您*整个*方法的作用，例如他提到的 Zarkonnen 的示例。

```
public void kill(){
    isAlive = false;
    removeFromWorld(this);
} 
```

代替

```
public void setAlive(boolean isAlive){
    this.isAlive = isAlive;
    if (isAlive)
        addToWorld(this);
    else
        removeFromWorld(this);
} 
```

setAlive(boolean) 方法在哪里告诉客户端作为副作用它会从世界中删除对象？为什么客户端应该对 isAlive 字段有任何了解？另外，当对象重新添加到世界时会发生什么，是否应该重新初始化？为什么客户会关心这些？

恕我直言，道德是命名方法来准确说明他们所做的事情，遵循 SRP 并摆脱 getter/setter。如果没有 getter/setter 存在问题，请告诉对象在自己的类中做自己的脏活，而不是尝试在其他类中与它们一起做事。

我的咆哮到此结束，对此感到抱歉；）

* * *

## 回答 #6

> 赞同：19
> 
> 时间：2009-02-19T13:02:57.357

这是一个滑坡。

一个简单的 Transfer 对象（或 Parameter 对象）的唯一目的可能是保存一些字段并按需提供它们的值。然而，即使在这种退化的情况下，人们也可以争辩说对象应该是不可变的——在构造函数中配置并且只公开`get`... 方法。

还有一个类暴露了一些“控制旋钮”的情况；您的车载收音机的 UI 可能可以理解为暴露了`getVolume`、`setVolume`、`getChannel`和之类的东西`setChannel`，但它的真正功能是接收信号和发出声音。但是这些旋钮并没有暴露太多的实现细节。你不知道收音机是晶体管，主要是软件还是真空管。

您越开始将对象视为问题域任务的积极参与者，您就越会考虑要求它*做某事，*而不是要求它告诉您它的内部状态，或者要求它它的数据，以便*其他代码*可以对这些值做一些事情。

所以……“邪恶”？并不真地。但是每次你倾向于输入一个值并在该值上公开`get`... 和`set`... 方法时，问问自己为什么，以及该对象的真正责任是什么。如果您能给自己的唯一答案是“为我保留这个价值”，那么*可能*除了 OO 之外还有其他事情正在发生。

* * *

## 回答 #7

> 赞同：15
> 
> 时间：2009-02-19T12:43:53.643

如果你的 Game 类暴露了这么多变量，它可能会遵循[上帝对象反模式。](http://en.wikipedia.org/wiki/God_object)getter 和 setter 没有任何问题（尽管它们在 Java 中的冗长可能有点烦人）；在一个精心设计的应用程序中，每个类都有明确分离的功能，你不需要在一个类中使用几十个。

**编辑：**如果getter和setter的主要目的是“配置”游戏类（我理解你的评论），那么你可能不需要getter（一个类访问它自己的私有变量是完全可以的不使用 get 方法），并且您可能可以将许多设置器折叠成“组设置器”，这些设置器设置几个在概念上属于一起的变量。

* * *

## 回答 #8

> 赞同：11
> 
> 时间：2009-02-19T12:56:50.803

getter 和 setter 的存在往往表明（如果您使用那种小学语言，那是一种“气味”）存在设计问题。微不足道的 getter 和 setter 与公共领域几乎没有区别。通常，对数据进行操作的代码将位于不同的类中 - 封装性差，以及您对不熟悉 OO 的程序员的期望。

在某些情况下，getter 和 setter 很好。但作为一项规则，同时具有 getter 和 setter 的类型表明存在设计问题。吸气剂为不变性工作；二传手为“告诉不问”工作。不变性和“告诉不要问”都是很好的设计选择，只要它们不以重叠的方式应用。

* * *

## 回答 #9

> 赞同：10
> 
> 时间：2009-02-19T12:36:42.083

我的观点是，getter 和 setter 是好的程序的必要条件。坚持使用它们，但不要编写不必要的 getter/setter - 并不总是需要直接处理所有变量。

* * *

## 回答 #10

> 赞同：9
> 
> 时间：2012-01-03T16:20:53.340

我真的不认为他们是邪恶的。但我很想生活在一个除非我真的需要，否则我永远不必使用它们的世界。

我在上面读到的一个例子是`future-proofing`你的代码。例如：

```
public void setValue(int value)
{
    this.value = value;
} 
```

然后，需求发生变化，您需要跟踪设置值的次数。

所以：

```
public void setValue(int value)
{
    this.value = value;
    count++;
} 
```

这很漂亮。我得到它。但是，在 Ruby 中，以下内容不会起到同样的作用吗？

```
someobject.my_value = 100 
```

稍后，您需要跟踪`my_value`被设置的次数。那么，你能不能只覆盖设置器**THEN**并且只覆盖**THEN**？

```
def my_value=(value)
    @my_value = value
    @count++
end 
```

我完全喜欢漂亮的代码，但我必须承认，翻阅我们拥有的大量 Java 类，实际上看到了成千上万行代码，这些代码除了基本的 getter/setter 之外什么都不是，既丑陋又烦人。

当我全职使用 C# 进行开发时，我们一直使用公共属性，并且仅在需要时才使用自定义 getter/setter。像一个魅力一样工作，它没有破坏任何东西。

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2009-02-19T12:38:21.067

与往常一样，唯一的答案是：视情况而定。如果你是唯一接触代码的人，你可以做任何你喜欢的事情，包括走捷径。

使用 setter 的好处之一是只需要在代码中的一个位置执行检查。

您可能需要更密切地关注这些方法实际获取和设置的内容。如果您使用它们来提供对常量值的访问，那么使用常量可能会更好。

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2009-02-19T12:53:40.827

这取决于所讨论的编程语言。您的问题是在 Java 的上下文中提出的，似乎 getter 和 setter 通常被认为是一件好事。

相比之下，在 Python 世界中，它们通常被认为是糟糕的风格：它们在代码中添加了几行代码，但实际上并未添加功能。当 Python 程序员需要时，他们可以使用元编程来获取和/或设置对象属性。

在 Java 中（至少是我十年前稍微学过的 Java 版本），这是不可能的。因此，在 Java 中，通常最好虔诚地使用 getter 和 setter，这样如果需要，您可以覆盖对变量的访问。

（这并不意味着 Python 一定比 Java 更好，只是不同而已。）

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2009-02-19T12:59:03.340

仅供参考：除了此线程中的所有出色答案外，请记住，在您可以提出支持或反对 getter/setter 的所有原因中，性能不是一个（有些人可能认为）。JVM 足够聪明，可以内联琐碎的 getter/setter（即使是非 getter/setter `final`，只要它们实际上没有被覆盖）。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2009-02-19T12:37:24.937

您可能想用值类替换一些类。这将允许您删除 getter 并避免在您更改内容时出现问题。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2009-02-19T12:42:40.400

如果您需要对字段的各个值进行外部访问，请使用 getter 和/或 setter。如果没有，不要。永远不要使用公共领域。就这么简单！（好吧，它从来没有*那么*简单，但这是一个很好的经验法则）。

一般来说，您还应该发现您需要提供 setter 的频率比 getter 少得多 - 特别是如果您试图使您的对象不可变 - 这是一件好事（但并不总是最好的选择） - 但即使不是。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2009-02-19T13:40:44.350

几个月前我一直在用java编程，我了解到我们应该只在应用程序需要时才使用getter和setter

玩得开心 ：）

# database - 为每个多对多关系创建唯一编号的最佳方法

> ID：565102
> 
> 赞同：0
> 
> 时间：2009-02-19T12:34:04.710
> 
> 标签：database, django, database-design, postgresql

我有一个学生表和一个课程表，它们通过中间表连接以创建多对多关系（即，一个学生可以注册多个课程，一个课程可以有多个学生）。问题是客户希望每门课程都有一个唯一的学生 ID。例如：

```
rowid Course Student      ID (calculated)
1     A      Ben          1
2     A      Alex         2
3     A      Luis         3
4     B      Alex         1
5     B      Gail         2
6     B      Steve        3 
```

ID 应该从 1 开始编号，并且学生可以为不同的课程使用不同的 ID（例如，Alex 的 ID=2 用于课程 A，但 ID=1 用于课程 B）。一旦分配了 ID，它就是固定的，不能更改。我通过对通过表“SELECT Student from table WHERE Course=A ORDER BY rowid”的rowid进行排序来实现一个解决方案，然后根据结果的顺序返回一个数字。

这个解决方案的问题是，如果一个学生离开课程（从表中删除），其他学生的人数将会改变。有人可以推荐更好的方法吗？如果重要的话，我正在使用 PostgreSQL 和 Django。这是我的想法：

*   为 ID 创建一列而不是计算它。创建新关系时，根据课程中学生的 max(id)+1 分配 ID
*   当学生离开课程时，添加一列“禁用”并将其设置为 True。这将涉及更改我的所有代码以确保只使用活跃的学生

我认为第一个解决方案更好，但是是否有一种更“以数据库为中心的方式”，数据库可以自动为我计算？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-19T12:44:27.463

如果你想拥有 stable `ID`，你肯定需要将它们存储在表中。

您需要`ID`为每个加入课程的学生分配一个新的序列，如果学生离开，只需将其删除，而不涉及其他人。

如果您可以同时访问您的表，请不要使用`MAX(id)`，因为两个查询可以`MAX(id)`在将其插入表之前选择相同的。

相反，创建一个单独的表用作`sequence`，用 锁定每个课程的行`SELECT FOR UPDATE`，然后插入新学生的行，并在单个事务`ID`中用新的更新行，如下所示：`ID`

```
培训班：

名称 NextID
-------- ---------
数学 101
物理 201

服务员：

学生课程编号
-------- ------ ----
史密斯数学 99
琼斯数学 100
史密斯物理学 200

```

```
BEGIN TRANSACTION;

SELECT NextID
INTO   @NewID
FROM   Courses
WHERE  Name = 'Math'
FOR UPDATE;

INSERT
INTO Attendants (Student, Course, Id)
VALUES ('Doe', 'Math', @NewID);

UPDATE
  Courses
SET NextID = @NewID + 1
WHERE Course = 'Math';

COMMIT; 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-19T12:38:22.830

您的第一个建议似乎不错：在课程表中有一个 last_id 字段，每当您注册该课程的学生时，您都会将其增加 1。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-19T12:51:46.290

> 为 ID 创建一列而不是计算它。创建新关系时，根据课程中学生的 max(id)+1 分配 ID

那我会怎么做。计算它没有意义。身份证不应该因为有人辍学而改变。

> 当学生离开课程时，添加一列“禁用”并将其设置为 True。

是的，那将是个好主意。另一个是创建另一个相同结构的表，您将在其中存储丢弃的学生。然后当然你必须从这两个表的联合中选择 max(id) 。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-19T13:17:11.550

我认为这里有两个概念需要帮助你。

1.  数据库自动为您获取 ID 的下一个值的[序列](http://www.postgresql.org/docs/7.4/interactive/functions-sequence.html)
2.  [组合键](http://sqlzoo.net/howto/source/z.dir/tip241027/postgres)可以组合多个列以构成表的主键。

从一个快速的谷歌看起来 Django 可以处理序列但不能处理复合键，所以你需要以某种方式模拟它。但是，您同样可以有两个外键和一个用于课程/学生关系的序列

至于如何处理删除，这取决于您对应用程序的需求，您可能会发现状态字段会帮助您，因为您可能想要区分离开的学生和被踢出的学生，或者获取有关多少学生的统计信息学生离开不同的课程。

# java - 查找网络中最近的服务器

> ID：565115
> 
> 赞同：2
> 
> 时间：2009-02-19T12:35:42.883
> 
> 标签：java, traceroute

给定服务器列表和客户端列表，如何使用“traceroute”找到离特定主机最近的服务器？程序应该是java。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-19T12:51:32.657

您如何定义“最接近”？跟踪路由中的大量跃点并不表示数据包路由通过的设备的接近程度。Ping 也不是太好，因为它只是显示延迟。
我的建议是，如果您在网络上使用[BGP](http://www.ssfnet.org/bgp/)来计算亲密度。如果您在局域网上或者您与 BGP 打成平手，则回退到[Traceroute](http://www.docjar.com/docs/api/com/act365/net/ping/Traceroute.html)。

这些链接指向 BGP 和 traceroute 的 Java 实现。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-19T12:54:35.223

我不认为仅使用标准 Java API 就可以完成，因为它不能充分支持 ICMP 协议。您可以使用[Jpcap](http://netresearch.ics.uci.edu/kfujii/jpcap/doc/)来做到这一点。

# sql-server - 选择内的表达式

> ID：565134
> 
> 赞同：0
> 
> 时间：2009-02-19T12:39:44.917
> 
> 标签：sql-server, performance

我有两个字段的简单表：ID 和日期

我怎么能选择将返回真或假，当然没有标量值函数

它必须是这样的：

```
SELECT (Date < getdate()) as mu_value FROM my_table 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-19T12:42:13.100

我使用类似的东西：

```
SELECT
  CASE
    WHEN mt.Date < getDate() THEN 1
    ELSE 0
  END as mu_value
FROM my_table mt 
```

当然，你可以用任何你喜欢的东西代替 1 和 0。

# c++ - 多线程作业队列管理器

> ID：565137
> 
> 赞同：37
> 
> 时间：2009-02-19T12:40:16.117
> 
> 标签：c++, multithreading, scheduled-tasks, threadpool

我需要在交互式应用程序中管理占用大量 CPU 的多任务作业。作为背景，我的具体应用是一个工程设计界面。当用户调整模型的不同参数和选项时，会在后台运行多个模拟，并在完成时显示结果，即使用户仍在编辑值也是如此。由于多次模拟需要不同的时间（有些是毫秒，有些需要 5 秒，有些需要 10 分钟），因此基本上是尽快显示反馈的问题，但通常会中止以前开始但现在不再需要的作业，因为用户的更改已经使它们无效。不同的用户更改可能会使不同的计算无效，因此在任何时候我都可能运行 10 个不同的模拟。

我非常有信心处理这种应用程序的代码级方法是某种多线程作业队列。这将包括提交作业以执行、设置任务优先级、等待作业完成、指定依赖关系（执行此作业，但仅在作业 X 和作业 Y 完成后）、取消符合某些条件的作业子集、查询什么作业保留，设置工作线程计数和优先级，等等。多平台支持也非常有用。

这些不是软件中的新想法或新愿望，但我正处于应用程序的早期设计阶段，我需要选择使用哪个库来管理此类任务。我过去用 C 编写了自己的粗略线程管理器（我认为这是一种通过仪式），但我想使用现代工具来作为我工作的基础，而不是我自己以前的 hack。

第一个想法是运行到[OpenMP](http://openmp.org/wp/)，但我不确定这是我想要的。OpenMP 非常适合精细并行化、自动展开循环等。虽然是多平台的，但它也会使用#pragmas 侵入您的代码。但大多数情况下，它不是为管理大型任务而设计的。尤其是取消挂起的作业或指定依赖项。可能，是的，但它并不优雅。

我注意到[即使是最琐碎的任务，谷歌浏览器也会使用这样的作业管理器。](http://www.switchonthecode.com/tutorials/how-google-chrome-stores-passwords)设计目标似乎是使用户交互线程尽可能轻巧灵活，因此任何可以异步生成的东西都应该是。从 Chrome 源代码来看，这似乎不是一个通用库，但看看设计如何使用异步启动来保持快速交互仍然很有趣。这越来越类似于我正在做的事情。

还有其他选择：

[Surge.Act：](http://members.gamedev.net/Rivorus/surge/html/index.html)用于定义工作的类似 Boost 的库。它建立在 OpenMP 之上，但确实允许链接依赖项，这很好。似乎没有可以查询的经理，可以取消工作等。这是一个陈旧的项目，因此依赖它很可怕。

[Job Queue](http://www.codeproject.com/KB/threads/multi_threaded_job_queue.aspx)与我的想法非常接近，但这是一篇 5 年前的文章，而不是受支持的库。

[Boost.threads](http://www.boost.org/doc/libs/1_38_0/doc/html/thread.html)确实有很好的平台独立同步，但这不是一个作业管理器。[POCO](http://pocoproject.org/)具有非常简洁的任务启动设计，但同样不是用于链接任务的完整管理器。（也许我低估了 POCO）。

因此，虽然有可用的选项，但我并不满意，我有再次推出自己的图书馆的冲动。但我宁愿使用已经存在的东西。即使在搜索之后（在 SO 和网络上），我也没有找到任何感觉正确的东西，尽管我认为这一定是一种经常需要的工具，所以肯定有一些社区库或至少是通用设计。在 SO 上有一些关于[工作队列的](https://stackoverflow.com/questions/125812/managing-threadpool-starvation-within-a-multithreaded-work-queue-processor)[帖子](https://stackoverflow.com/questions/38501/thread-pool-for-executing-arbitrary-tasks-with-different-priorities)，但似乎没有什么合适的。

我在这里的帖子是问你们我错过了哪些现有工具，和/或你们是如何推出自己的多线程作业队列的。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-02-20T03:14:08.950

我们必须构建自己的作业队列系统以满足与您类似的要求（UI 线程必须始终在 33 毫秒内响应，作业可以在 15-15000 毫秒内运行），因为真的没有什么能完全满足我们的需求，更不用说性能了.

不幸的是，我们的代码与专有代码一样专有，但我可以为您提供一些最显着的功能：

*   我们在程序开始时为每个内核启动一个线程。每个都从全局作业队列中提取工作。作业由一个函数对象和一组相关数据组成（实际上是对 func_ptr 和 void * 的详细说明）。线程 0 是快速客户端循环，不允许处理作业，但其余部分尽可能地抓取。
*   作业队列本身应该是无锁的数据结构，比如无[锁的单链表](http://portal.acm.org/citation.cfm?id=1377030.1377094)（Visual Studio[自带](http://msdn.microsoft.com/en-us/library/ms686360(VS.85).aspx)）。避免使用互斥锁；队列的争用非常高，并且获取互斥体的成本很高。
*   将作业的所有必要数据打包到作业对象本身中——避免将作业的指针返回到主堆中，在那里您必须处理作业和锁之间的争用以及所有其他缓慢、烦人的事情。例如，所有模拟参数都应进入作业的本地数据块。结果结构显然需要比作业更长的时间：您可以通过以下方式处理此问题：a）即使在作业对象完成运行后仍挂在作业对象上（因此您可以使用主线程中的内容），或 b）专门为每个作业分配一个结果结构，并将一个指针填充到作业的数据对象中。即使结果本身不会存在于作业中，这有效地为作业提供了对其输出内存的独占访问权限，因此您不必担心锁。

*   实际上我在上面简化了一点，因为我们需要准确编排哪些作业在哪些内核上运行，所以每个内核都有自己的作业队列，但这对你来说可能是不必要的。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-19T14:01:37.527

我推出了自己的，基于 Boost.threads。我对编写这么少的代码所获得的巨大收益感到非常惊讶。如果你没有找到预制的东西，不要害怕自己动手。在 Boost.threads 和您编写自己的代码后的经验之间，这可能比您记忆中的要容易。

对于预制选项，不要忘记[Chromium](http://code.google.com/chromium/)的许可非常友好，因此您可以围绕其代码滚动您自己的通用库。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-20T07:18:17.083

微软正在为下一个版本的 Visual Studio 2010 开发一组技术，称为并发运行时、并行模式库和异步代理库，这可能会有所帮助。并发运行时将提供基于策略的调度，即允许您管理和组合多个调度程序实例（类似于线程池，但实例之间具有关联和负载平衡），并行模式库将提供基于任务的编程和具有类似 STL 的并行循环编程模型。Agents 库提供了一个基于actor 的编程模型，并支持构建并发数据流管道，即管理上述那些依赖关系。[不幸的是，这还没有发布，所以你可以在我们的团队博客](http://blogs.msdn.com/nativeconcurrency)上阅读它或观看[channel9 上](http://channel9.msdn.com/tags/Parallel+Computing+Platform/)的一些视频，还有一个非常大的 CTP 可供下载。

如果您现在正在寻找解决方案，英特尔的线程构建模块和 boost 的线程库都是很好的库，并且现在可用。[JustSoftwareSolutions](http://www.justsoftwaresolutions.co.uk/)发布了一个与 C++0x 草案相匹配的 std::thread 实现，当然，如果您正在研究基于细粒度循环的并行性，那么 OpenMP 是广泛可用的。

正如其他人所暗示的那样，真正的挑战是正确识别并将工作分解为适合并发执行的任务（即没有不受保护的共享状态），了解它们之间的依赖关系并最大限度地减少可能发生在瓶颈上的争用（瓶颈是否正在[保护共享状态](http://www.ddj.com/hpc-high-performance-computing/214100002)或确保工作队列的调度循环是低争用或无锁的）......并且在没有调度实现细节泄漏到其余代码的情况下做到这一点。

-瑞克

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-19T17:29:18.643

像[线程池](http://threadpool.sourceforge.net/index.html)这样的东西对你有用吗？它基于 boost::threads 并且基本上实现了一个简单的线程任务队列，它将工作函数传递给池线程。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-19T21:33:41.980

您可能想查看[基于流的编程](http://www.jpaulmorrison.com/fbp/)——它基于异步组件之间的数据块流。有 Java 和 C# 版本的驱动程序，以及一些预编码的组件。它本质上是多线程的——事实上唯一的单线程代码在组件中，尽管您可以将时序约束添加到标准调度规则中。尽管它可能对您的需要来说太细了，但这里可能有一些您可以使用的东西。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2019-12-26T18:29:29.663

我一直在寻找几乎相同的要求。我正在开发一款具有 4x-ish 机制的游戏，并安排完成的不同部分几乎让我的大脑爆炸。我有一组复杂的工作需要在不同的时间分辨率下完成，并根据玩家主动加载的系统/区域进行不同程度的实际模拟。这意味着随着玩家从一个系统移动到另一个系统，我需要将一个系统加载到当前的高分辨率模拟，将最后一个系统卸载到较低分辨率的模拟，并对系统的活动/非活动区域执行相同的操作。不同的模拟是基于每个实体的概况的人口、政治、军事和经济行动的大列表。到目前为止，我将尝试描述我的问题和方法，我希望它 在为您或其他人描述替代方案时很有用。我正在构建的结构的粗略轮廓将使用以下内容：

1.  [cpp-taskflow](https://github.com/cpp-taskflow/cpp-taskflow)（现代 C++ 并行任务编程库） 我将创建一个模块库，用作作业构造部分。每个条目都有一个用于初始化和销毁​​的 API 以及用于通信的指针。我希望以一种可以嵌套的方式编写它，使用 cpp-taskflow API 在创建作业时设置所有依赖项，但提供一种实时调整的方法并提供可用的终止开关。我所做的大部分将是状态机的决策树，或行为树的状态机，因此作业数据结构将是时间分辨率标记数据的设置和状态，指向实际的统计数据和对象值。
2.  [FlatBuffers](https://github.com/google/flatbuffers)我希望使用这个库来构建一个“工作列表条目”以及一个“对象包装器”系统。作业队列中的每个条目将是一个 flatbuffer 对象，描述需要完成的工作（模块的设置），以及包含需要完成的工作的数据（或指向数据的共享指针）。对象存储平面缓冲区将包含表示实体表的数据。对我来说，大多数实际数据都是需要决定/处理的数组。我还希望将平面缓冲区用作线程之间的通信/控制通道。我很难让所有其他人都通过一个主“路由器”线程进行通信，或者每个线程都包含自己的线程，并且有一些发现机制。
3.  [SQLite](https://sqlite.org/index.html)由于只有活动区域/系统需要完成更高分辨率的工作，因此游戏将创建的一些后台工作列表（针对数千个系统及其实体）将非常庞大且寿命长。数以千计的数以百万计的工作（在我看来很大），每个工作都需要未知的时间才能完成。就我而言，我不在乎他们什么时候完成，只要他们都完成（长时间的活动）。我计划在每个线程上获取一个内存中的 sqlite 数据库表作为作业队列。每个条目将包含一个平面缓冲区工作块、一个指向完成时通知的缓冲区的指针、一个指向用于更新的控制缓冲区的指针，以及装饰作业项（位置、数据范围、优先级）的其他字段，这些字段将被填充为工作条目会产生新的工作，并且随着项目被消耗到数据库中。这为我提供了一种方法，我可以在作业之间创建关系联系，并且如果我需要重新处理/更新作业、删除它们及其依赖项，或者更新/重新排序优先级或依赖项，则只需构造查询。在 sqlite db 中使用的所有这些也意味着我可以随时将整个内容转储到磁盘并稍后重新加载，或者切换到附加到磁盘并从磁盘处理它。此外，这使我可以访问大量搜索和排序算法工作，我通常需要一堆不同类型的容器。能够使用 SQL 查询为我提供了很多处理作业的选项。在 sqlite db 中使用的所有这些也意味着我可以随时将整个内容转储到磁盘并稍后重新加载，或者切换到附加到磁盘并从磁盘处理它。此外，这使我可以访问大量搜索和排序算法工作，我通常需要一堆不同类型的容器。能够使用 SQL 查询为我提供了很多处理作业的选项。在 sqlite db 中使用的所有这些也意味着我可以随时将整个内容转储到磁盘并稍后重新加载，或者切换到附加到磁盘并从磁盘处理它。此外，这使我可以访问大量搜索和排序算法工作，我通常需要一堆不同类型的容器。能够使用 SQL 查询为我提供了很多处理作业的选项。

通信队列（作为数据库）是我是否应该通过相应的线程进行访问（每个线程都包含它自己的消息传递数据库，并且模块 API 具有为访问抽象的锁/互斥锁）或拥有所有更新、添加/删除以及通过某个主路由器线程到一个大型数据库中的通信。就互斥和锁定而言，我不知道哪个最让我头疼。我花了几天时间来制作一个共享指针的怪物意大利面野兽，这些指针指向 sbuffer 池和查找表，所以每个线程都有自己的缓冲区，并分离出缓冲区。那时我决定将庞大的列表卸载到 sqlite。然后我想，为什么不直接将其他所有内容的 flatbuffer 对象输入表中。

数据库中的几乎所有内容都来自每个模块，我可以编写 sql 语句来表示我需要处理的数据的视图，以及动态地了解数据的处理方式。将工作本身放在数据库中意味着我也可以为它们做同样的事情。SQLite 具有多线程访问，因此将其用作多线程作业队列管理器应该不会太费力。

总之，Cpp-Taskflow 将允许您使用依赖链和作业池多线程设置复杂的嵌套循环。开箱即用，它带有您需要的大部分结构。FlatBuffers 将允许您创建作业声明和对象包装器，以便将其作为一个工作单元输入流缓冲区并在作业线程之间传递它们，SQLite 将允许您以某种方式标记流缓冲区作业并将其排队到 blob 条目中这应该允许添加、搜索、排序、更新和删除，而您的工作量最少。它还使保存和重新加载变得轻而易举。快照和回滚也应该是可行的，您只需要牢记数据库事件的顺序和解决方案。

编辑：尽管对此持保留态度，但我发现了您的问题，因为我正在尝试完成 Crashworks 所描述的内容。我正在考虑使用亲和力来打开长期存在的线程并让主线程运行大部分 Cpp-Taskflow 层次结构工作，将作业提供给其他线程。我还没有使用作业队列/控制通信的sqlite方法，这只是我目前的计划。

我希望有人觉得这很有帮助。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-20T08:38:21.667

那里有很多分布式资源管理器。几乎可以满足您所有要求的软件是[Sun Grid Engine](http://gridengine.sunsource.net/)。SGE 用于一些世界上最大的超级计算机，并且正在积极开发中。

[Torque](http://www.clusterresources.com/pages/products/torque-resource-manager.php)、[Platform LSF](http://www.platform.com/Products/platform-lsf)和[Condor](http://www.cs.wisc.edu/condor/)也有类似的解决方案。

听起来您可能想自己动手，但上述所有功能都有很多功能。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-19T14:01:46.577

看一下[boost::future](http://braddock.com/~braddock/future/)（另请参阅这个[讨论](http://comments.gmane.org/gmane.comp.lib.boost.announce/220)和[提案](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2008/n2561.html)），它看起来像是一个非常好的并行基础（特别是它似乎为 C-depends-on-A-and-B 类型的情况提供了极好的支持） .

我看了一点 OpenMP，但（像你一样）不相信它适用于除 Fortran/C 数字代码之外的任何东西。英特尔的[线程构建块](http://en.wikipedia.org/wiki/Intel_Threading_Building_Blocks)对我来说看起来更有趣。

如果涉及到它，在 boost::thread 之上[滚动你自己](http://voluminium.svn.sourceforge.net/viewvc/voluminium/trunk/libcelebritas/)的并不是太难。[解释：线程[场](http://voluminium.svn.sourceforge.net/viewvc/voluminium/trunk/libcelebritas/farm.h?view=markup)（大多数人会称之为池）从函子（任务或作业）的线程安全[队列中提取工作。](http://voluminium.svn.sourceforge.net/viewvc/voluminium/trunk/libcelebritas/queue.h?view=markup)有关使用示例，请参阅[测试](http://voluminium.svn.sourceforge.net/viewvc/voluminium/trunk/libcelebritas/farm_test.cpp?view=markup)和[基准](http://voluminium.svn.sourceforge.net/viewvc/voluminium/trunk/libcelebritas/farm_bench.cpp?view=markup)。我有一些额外的复杂性来（可选地）支持具有优先级的任务，以及执行任务可以在工作队列中产生更多任务的情况（这使得知道所有工作何时实际完成有点问题；对“待定”的引用是可以处理案件的人）。无论如何，可能会给你一些想法。]

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-02-20T06:04:38.650

您可能想查看[英特尔线程构建模块](http://www.threadingbuildingblocks.org/)。我相信它可以满足您的需求，并且版本 2 是开源的。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-08-07T22:39:34.380

也许有点晚了，但也看看 ThreadWeaver： [http ://en.wikipedia.org/wiki/ThreadWeaver](http://en.wikipedia.org/wiki/ThreadWeaver)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-02-20T02:54:39.213

我不知道您是否正在寻找 C++ 库（我认为您是），但 Doug Lea 的 Java 7 Fork/Join 框架非常漂亮，并且完全符合您的要求。您可能能够在 C++ 中实现它或找到一个预先实现的库。

更多信息在这里： [http ://artisans-serverintellect-com.si-eioswww6.com/default.asp?W1](http://artisans-serverintellect-com.si-eioswww6.com/default.asp?W1)

# ruby-on-rails - 让 will_paginate 与 Ajax 一起工作的最佳方式

> ID：565145
> 
> 赞同：8
> 
> 时间：2009-02-19T12:41:27.110
> 
> 标签：ruby-on-rails, ajax

如果你用谷歌搜索“will_paginate”和“ajax”，最高的结果是[这篇博](http://weblog.redlinesoftware.com/2008/1/30/willpaginate-and-remote-links)文：但是 will_paginate 的原作者说[不要使用这种方法](http://wiki.github.com/mislav/will_paginate/ajax-pagination)（对 SEO/spiders 不利）......

但我无法让原始作者的方法起作用（他的 javascript 杀死了我所有的链接）。[另一位绅士](http://vikasnandal.blogspot.com/2009/01/ajax-pagination-with-mislavs.html)提出了与米斯拉夫（原 will_paginate 作者）概念类似的方法。但我也无法让它*发挥*作用。

所以 ....使用 AJAX 进行分页并保持 SEO 友好的最佳方式*是什么？*（对于轨道 >2.1）

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-02-20T00:13:09.320

汤姆的回答是正确的。只是为了麻烦，我制作了一个快速实现的原型。 [这是一个截屏视频](http://screencast.com/t/JmsFLMFxz)，显示它在启用 Javascript 时使用 Ajax（您的用户）并且在禁用 Javascript 时仍然具有漂亮的 URL（Google）。这里有一些代码片段可以让您继续使用它。

`config/routes.rb:`

```
map.connect 'items/:page', :controller => "items", :action => "index", :page => 1 
```

`app/controllers/items_controller.rb:`

```
class ItemsController < ApplicationController
  def index
    @items = Item.paginate(:all, :page => params[:page])

    respond_to do |format|
      format.html
      format.js do
        render :update do |page|
          page.replace_html :items, :partial => "items"
          page << "ajaxifyPagination();"
        end
      end
    end
  end
end 
```

`app/views/items/index.html.erb:`

```
<h1>Listing items</h1>

<div id="items">
  <%= render :partial => "items" %>
</div> 
```

`app/views/items/_items.html.erb:`

```
<%= will_paginate @items %>

<table>
  <% for item in @items %>
    <tr>
      <td><%= item.id %></td>
    </tr>
  <% end %>
</table> 
```

布局：

```
<%= javascript_include_tag :defaults %> 
```

`public/javascripts/application.js:`

```
$(document).ready(function() {
    ajaxifyPagination();
});

function ajaxifyPagination() {
    $(".pagination a").click(function() {
        $.ajax({
          type: "GET",
          url: $(this).attr("href"),
          dataType: "script"
        });
        return false;
    });
} 
```

我的示例使用 jQuery（使用[jRails](http://ennerchi.com/projects/jrails)），但使用 Prototype 也很简单。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-19T13:00:40.543

Seo 友好和不显眼的 javascript 齐头并进。你可以做的是以下。

*   对整个站点进行编码，就好像只启用了 html 一样（包括您的分页内容）
*   如果请求来自 js，则使用 respond_to 并仅提供项目列表
*   使用您选择的任何库中的 onDomReady 尝试捕获所有分页链接并添加一个 onclick 事件，该事件触发对该新视图的 ajax 调用并返回结果。您将该结果放入包含您正在分页的数据的容器中。然后 onclick 返回 false。
*   为了给您的用户提供更好的用户体验，您可以将一些功能（如活动链接等）添加到相同的 javascript 方法中。

使用这种方法，分页将适用于 JS 和非 js，因为非 js 用户（包括 Googlebot）将正常遍历您的分页。只有在用户启用了 javascript 的情况下，带有数据的容器才会更新为新结果。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-19T12:59:33.917

不幸的是，我认为您不能以您想要的方式使用 Ajax，并且在分页内容方面仍然保持 SEO 友好。问题在于，据我所知，Google 和朋友的机器人不会使用 XHR 请求浏览您的内容，因此他们根本看不到该内容。

也就是说，如果每个分页项目都有自己的静态、对 SEO 友好的页面（或者在您的网站上静态可用），那么内容仍然会进入它们的引擎。这就是你可能想要的方式。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-04-25T01:52:57.990

如果不担心蜘蛛，有一个很好的方法可以轻松做到这一点。花了我5分钟。查看：

[https://github.com/ronalchn/ajax_pagination/wiki/Adding-AJAX-to-will_paginate](https://github.com/ronalchn/ajax_pagination/wiki/Adding-AJAX-to-will_paginate)

如果您收到有关缺少“历史”文件的错误，请安装：

[https://github.com/wweidendorf/jquery-historyjs](https://github.com/wweidendorf/jquery-historyjs)

但也要注意：

[rails ajax_pagination 找不到文件“历史”](https://stackoverflow.com/questions/14417056/rails-ajax-pagination-couldnt-find-file-history)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-04-19T11:57:34.720

有一个关于这个主题的 railscasts 帮助了我[http://railscasts.com/episodes/174-pagination-with-ajax](http://railscasts.com/episodes/174-pagination-with-ajax)

我正在运行 rails 3.2，所以我将那里提到的 pagination.js 添加到 app/assets/javascripts 文件夹中

分页.js

```
 $(function() {
    $(".pagination a").live("click", function() {
        $(".pagination").html("Loading...");
        $.getScript(this.href);
        return false;
    });
}); 
```

然后创建

主页.js.erb

```
$('#div_tags_list').html('<%= escape_javascript(render partial: '/customersb2b/user_customer_numbers_list').html_safe %>')
$('#receipts_list').html('<%= escape_javascript(render partial: '/customersb2b/feed').html_safe %>') 
```

因为我的主页上有两个不同的列表。

这就是让 will_paginate 与 Ajax 一起工作所要做的全部工作。至于 SEO 问题，好吧，我不太了解，但 URL`http://localhost:3000/customers?_=1366372168315&feed_page=1&tags_page=2`仍然有效

# c - C语言中的大整数？

> ID：565150
> 
> 赞同：29
> 
> 时间：2009-02-19T12:42:17.907
> 
> 标签：c, variables, data-storage, bigint

在 C 中处理大量数字的最简单方法是什么？我需要将值存储在区域`1000^900`中，或者以更易于阅读的形式`10^2700`。

有谁知道一个简单的方法来做到这一点？任何帮助将不胜感激！

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2009-02-19T12:46:12.077

使用[libgmp](http://gmplib.org/)：

> GMP 是一个用于任意精度算术的免费库，可对有符号整数、有理数和浮点数进行运算。除了运行 GMP 的机器中的可用内存所暗示的精度之外，精度没有实际限制……
> 
> 从版本 6 开始，GMP 在双重许可下分发，[GNU LGPL v3](https://www.gnu.org/licenses/lgpl.html)和[GNU GPL v2](https://www.gnu.org/licenses/gpl-2.0.html) ...
> 
> GMP 的主要目标平台是 Unix 类型的系统，例如 GNU/Linux、Solaris、HP-UX、Mac OS X/Darwin、BSD、AIX 等。它还可以在 32 位和 64 位的 Windows 上工作。位模式...

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-02-19T12:47:26.053

有几个库可以帮助您做到这一点（任意精度数学）：

*   [大数字](http://www.di-mgt.com.au/bigdigits.html)；
*   [数学](http://spinning-yarns.org/michael/sw/imath/);
*   [十进制数](http://speleotrove.com/decimal/#decNumber)；和
*   毫无疑问其他人。

假设这与工作无关（即，您这样做是为了好玩，或者它是一种爱好，或者只是一个学习一些东西的机会），为任意精度数学编写一个库是一个相对有趣的项目。但是，如果您需要完全依赖它并且对具体细节不感兴趣，请使用库。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-19T12:50:00.600

有许多库可以处理大量数字。你需要整数还是浮点运算？

您可以查看 Python 中内置的用于该任务的代码。

您可以查看该任务的 Perl 扩展。

您可以查看 OpenSSL 中的代码以执行该任务。

您可以查看 GNU MP（多精度）库 - 如 kmkaplan 所述。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2020-12-21T03:39:48.517

你也可以试试openssl的BIGNUMs，见[https://www.openssl.org/docs/man1.0.2/man3/bn.html](https://www.openssl.org/docs/man1.0.2/man3/bn.html) , [https://www.openssl.org/docs/man1.1.1/man3/](https://www.openssl.org/docs/man1.1.1/man3/) ,[将作为字符串给出的大数字转换为 OpenSSL BIGNUM](https://stackoverflow.com/questions/30077562/convert-a-big-number-given-as-a-string-to-an-openssl-bignum)以获取详细信息。

# actionscript-3 - 原型和静态类型变量的 ActionScript 问题

> ID：565154
> 
> 赞同：3
> 
> 时间：2009-02-19T12:42:35.610
> 
> 标签：actionscript-3, prototype

我正在开发一个闪存（Flash 9、AS3）来连接到服务器并将数据发送/接收/解析到 JavaScript/HTML 上的聊天。我有这样的结构：

```
package {
    public class myClass {
        String.prototype.escapeHtml = function() {
            var str = this.replace(/&/g, "&amp;");
            str = str.replace(/</g, "&lt;");
            str = str.replace(/>/g, "&gt;");
            return str;
        }

        function writeToBrowser(str:String) {
            ExternalInterface.call("textWrite",str.escapeHtml());
        }
    }
} 
```

当我编译它时，我得到这个错误：

> 1061: 通过静态类型 String 的引用调用可能未定义的方法 escapeHtml。

如果我删除`:String`，一切正常，但是我必须检查它是否`str`是一个字符串，如果它不是未定义的等等。

我的代码中有很多这样的函数，其中许多接收用户输入的数据，所以我认为删除`:String`每个函数并进行多次检查并不是最好的方法。

我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-19T15:02:58.690

然后只需定义函数：

```
public function escapeHtml( str : String ) : String
{
    var str = this.replace(/&/g, "&amp;");
    str = str.replace(/</g, "&lt;");
    str = str.replace(/>/g, "&gt;");

    return str;
} 
```

在你的课上。

并称之为：

```
public function writeToBrowser( str : String )
{
    ExternalInterface.call( "textWrite", escapeHtml( str ) );
} 
```

:)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-19T15:14:46.697

你得到一个错误，因为编译器处于严格模式。如果你想保持严格模式，你可以试试这个：

```
ExternalInterface.call("textWrite",str["escapeHtml"]() ); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-19T13:50:08.600

原型实际上是遗产。

您应该扩展 String 类并使用您的自定义类

```
package {
    public class myClass {

        public function writeToBrowser(str:CustomString) {
                ExternalInterface.call("textWrite",str.escapeHtml());
        }
    }
    public class CustomString {

        public function escapeHtml():String {
                var str = this.replace(/&/g, "&amp;");
                str = str.replace(/</g, "&lt;");
                str = str.replace(/>/g, "&gt;");
                return str;
        }
    }
} 
```

# c# - 动态添加控件到用户控件

> ID：565161
> 
> 赞同：5
> 
> 时间：2009-02-19T12:44:21.473
> 
> 标签：c#, winforms, user-controls

我想在事件处理程序中向用户控件添加一个控件（如按钮单击事件）。

我正在尝试动态添加一个 datagridview 查找控件，但我无法让它工作，所以我尝试使用以下代码添加一个按钮：

```
private void btnCreateNewButton_Click(object sender, EventArgs e)
{
    Button btn = new Button();
    btn.Location = new Point(100, 640);
    btn.Size = new Size(100, 30);
    btn.Text = "Click Me";
    btn.Click += (s, ea) => MessageBox.Show("New button clicked");
    this.Controls.Add(btn);
} 
```

当我单击我的创建新按钮时，没有出现任何按钮。

如果我将完全相同的代码添加到表单而不是用户控件中，则会创建按钮并按预期显示，但在用户控件中没有任何反应。在用户控件中我也尝试过

```
this.Parent.Controls.Add(btn) and
this.ParentForm.Controls.Add(btn) 
```

但无济于事。

有人有什么想法吗？

谢谢，夏兰。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-19T13:17:57.523

您将按钮放在 100,640 点。请确保您的用户控件可以容纳您的动态按钮。否则，您将看不到它。我使用了你的代码，它对我来说很好，只需确保父表单和用户控件的大小合适。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-19T15:09:47.053

很可能只是您的按钮被放置在父控件的范围之外和/或在另一个控件后面。我不相信 UserControls 或 Forms 在运行时添加控件方面有什么特别之处，但一个简单的区别可能是 Forms 默认可调整大小而 UserControls 不是？无论哪种方式，我认为任何一种控件类型都不会自动调整大小以适应所有子控件，因此很容易将新/动态控件放在错误的位置并且使其不可见。

# sql - 如何：MySQL 如何根据三个属性检索记录？

> ID：565163
> 
> 赞同：0
> 
> 时间：2009-02-19T12:44:31.533
> 
> 标签：sql, rdbms

我是 SQL 和关系 DBMS 的新手。如果它们满足 3 个给定属性，我想从关系数据库中检索记录。

例如，如果有一个包含有关实体信息的表：

```
table_solid : |s_id|s_name|description|
table_width : |w_id|w_name|
table_height: |h_id|h_name|
table_length: |l_id|l_name| 
```

其中 *_id 都是主键。

我还有 3 个表用于将这些表与外键相关联。

```
table_s_h: |s_id|h_id|
table_s_w: |s_id|w_id|
table_s_l: |s_id|l_id| 
```

请您解释一下我如何加入这些。

提前致谢。

```
 --------- table_length
table_SOLID ----
                ----------- table_width

                ------------table_height 
```

table_length 包含 solid 可以采用的有效长度（与其他表类似）。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-19T12:48:13.647

从一个表：

```
Select * 
FROM TABLE_NAME
WHERE table_width = SOME_VALUE3
AND table_height= SOME_VALUE2
AND table_length = SOME_VALUE3 
```

那是你要找的吗？或者你想查询多个表？如果是这样试试这个：

```
Select * 
FROM TABLE_SOLID solid
Inner join table_width width on solid.w_id = width.w_id
inner join table_height height on solid.h_id = height.h_id
inner join table_length length on solid.l_id = length.l_id 
```

此链接可能对您[有用 http://dev.mysql.com/doc/refman/5.0/en/join.html](http://dev.mysql.com/doc/refman/5.0/en/join.html)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-19T13:09:25.530

我不清楚您的数据库架构。

这四个不同的表？如果是，它们是如何连接起来的，即如何检索给定实体的宽度、高度、长度？

还是 1 个表中的这四列由 s_id 标识？

请澄清。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-19T13:21:12.553

我希望我已经理解了你的架构。

```
SELECT
    s.*
FROM
    table_solid AS s
WHERE
    s.s_id IN
(
(SELECT s_id FROM table_s_h INNER JOIN table_height USING (h_id) WHERE h_name = H)
INTERSECT
(SELECT s_id FROM table_s_w INNER JOIN table_width USING (w_id) WHERE w_name = W)
INTERSECT
(SELECT s_id FROM table_s_l INNER JOIN table_length USING (l_id) WHERE l_name = L)
); 
```

OT：我不知道这是否适用于 MySQL，我不在乎 - 我已经在问题中添加了“mysql”标签，而你已经删除了它。

# drag-and-drop - 使用 javascript 拖放

> ID：565174
> 
> 赞同：0
> 
> 时间：2009-02-19T12:47:29.000
> 
> 标签：drag-and-drop, javascript

我在面板 A 中有一些物品以及一些描述，例如交货时间。不同 div 中的所有项目。在第二个面板中，我列出了具有不同时间的驱动程序，例如上午 9 点、上午 10 点等。

现在我需要，当我将 itemA 从 Panel1 拖放到 panel2 中的 DriverA 时，我希望该项目应添加到已放置的驱动程序（DriverA）和具有计时的特定驱动程序的单元格中（例如，如果项目必须上午 10 点交货，然后上午 10 点的司机单元将颜色变为红色）。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-19T12:51:21.440

jQuery 支持拖放。

请参阅[http://www.codeproject.com/KB/webforms/JQueryPersistantDragDrop.aspx](http://www.codeproject.com/KB/webforms/JQueryPersistantDragDrop.aspx)和[jQuery 的文档](http://docs.jquery.com/UI)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-19T12:52:49.783

使用像 jQuery 这样的 JavaScript 框架和像 Prototype 这样的 AJAX 框架来做到这一点。

使用 jQuery 使元素可放置：http: [//jqueryui.com/demos/droppable/](http://jqueryui.com/demos/droppable/)

然后使用 Prototype 和 jQuery 方法的回调函数通过 AJAX 调用存储信息。

# testing - 组织通过新功能/发布所需的测试脚本的最佳解决方案是什么

> ID：565177
> 
> 赞同：0
> 
> 时间：2009-02-19T12:48:47.173
> 
> 标签：testing

有没有人使用过好的软件（或其他方式）来组织单独的 tes 脚本，这些脚本需要在功能或整个版本发布给客户之前通过？我听说过关于这个[http://www.rallydev.com/agile_products/lifecycle_management/test_management/](http://www.rallydev.com/agile_products/lifecycle_management/test_management/)的好消息，但我自己还没有使用它。我知道很多人使用 excel 来组织测试脚本，但我想要一个多人可以同时工作的东西，并且真的是为此目的而设计的。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-19T14:01:55.700

有许多测试管理解决方案。这实际上取决于您的需求以及您想花多少钱等...我偏爱[TOMOS](http://reachsimplicity.com)，这是一个专为测试团队设计的托管网络应用程序。它支持整个测试周期（需求、测试用例、测试执行、错误跟踪和报告）。（注意，我确实为制造 TOMOS 的公司工作，但我已经使用了那里的大部分内容，所以我认为我有一个非常全面的意见。）

# .net - NHibernate 一对多

> ID：565178
> 
> 赞同：0
> 
> 时间：2009-02-19T12:48:55.033
> 
> 标签：.net, nhibernate

我有一个非常简单的 NHibernate 设置：一个 Item 对象，它有一个 ItemDetail 对象的集合。它们之间是一对多的关系。

在我的 Web 应用程序中，我正在编写类似于以下内容的代码：

```
item.Details.Add(new ItemDetail { Item = item, Text = "blah" });
itemRepos.Save(item); 
```

这一切都很好。但是，现在我正在编写一个小型控制台应用程序来执行一些导入，重用我的 NHibernate 设置和映射，但是在执行相同的代码时，我的保存尝试导致抛出异常，警告我 ItemDetail.Item 包含 null 或瞬态物品。我认为这意味着它抱怨 ItemDetail.Item 指的是尚未保存的项目（该项目绝对不是空的），但这听起来很奇怪，因为它正是我正在保存的那个项目。

我在这里忽略了一些微不足道的事情吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-19T13:48:35.030

您提供的详细程度不足以了解正在发生的事情。

如果我冒险猜测，它与级联以及 Item 和 Detail 之间的双向关系有关。您可能在关系的 OneToMany 端指定了级联规则，但在 ManyToOne 端没有指定。尝试在那里添加级联规则。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-19T14:27:45.063

原来问题是由于日期格式错误（SQL 错误）而导致保存项目失败，但这没有被捕获。然后，当它继续保存 ItemDetails 时，它抱怨 Item 没有被保存。

有点奇怪，它没有引发关于 SQL 错误的异常，不是吗？

# .net - 将大量对象长期保存在内存中

> ID：565184
> 
> 赞同：2
> 
> 时间：2009-02-19T12:50:12.440
> 
> 标签：.net, asp.net, performance, garbage-collection

在我的 ASP.NET 应用程序中，我有一个包含大量对象的字典（假设有 1M 大，以后可能会更大），存储在字典中的对象是引用类型而不是结构类型，字典是旨在用作此类对象的缓存（我有理由不使用 ASP.NET 缓存来缓存此类对象，但我将其用于缓存其他内容）。

这会导致 GC 出现问题吗？我一直听说长寿对象会影响 GC 的性能并导致它在收集过程中花费更多时间，有没有办法避免这种情况？据我了解，字典（和对象）应该在 Gen2 中结束，除非系统内存不足，否则 GC 不会收集（如果我错了，请纠正我），那么如果系统有很多怎么办内存，GC仍然会以相同的频率收集Gen2吗？肯定还有其他应用会长期缓存大量数据，不知道他们是如何避免GC的问题的。

任何建议都非常感谢...

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-19T13:54:14.550

在大约 100 万个条目中，底层数组的字典将不可避免地出现在 LOH 中。鉴于此，将其预先分配为与其最终包含的条目数量相称的大小可能是一个好主意（这可能会严重适得其反，并且在测试模式下可能会很痛苦）。

字典中的对象应该提供一个非常好的哈希码实现。这与内存使用直接无关，只是查找效率。但是，如果您用更高的负载因子换取更少的内存，使用错误的散列可能最终会降低字典的行为到不再是 O(1) 的程度。

它包含的长寿项目应该：

1.  （最佳情况）不包含引用类型的实例字段。

    *   然后 GC 不需要遍历数组中的每个对象（GC 实现可能不会执行此优化，因此您的里程可能会有所不同）。
2.  确保您的应用程序不会陷入[中年危机](http://blogs.msdn.com/ricom/archive/2003/12/04/41281.aspx)风格的行为

    *   触发更多您希望避免的 gen2 集合。
3.  它们包含的任何引用都不应指向 Gen0 或 Gen1 堆

    *   这会导致大量的写入障碍，从而减慢您的 gen 0 / gen 1 集合。

由于您声明这是一个缓存，但没有提及您的保留政策，我认为这个[建议](http://blogs.msdn.com/ricom/archive/2004/01/19/60280.aspx)也值得一提。

您正在缓存的对象类型的一些指示可能是相关的 4/8MB 或者即使使用现代处理器缓存，连续内存也非常多，因此对缓存的频繁请求可能比具有更好保留策略的更紧凑、更小缓存的性能更差.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-19T12:56:34.157

您对场景的理解是正确的，只要系统不渴望内存 Gen2 集合应该是不常见的，因此在其中保留许多长期存在的对象应该没有问题。

如果您必须仔细编码以避免 GC 出现“问题”，那么 GC 就不会很好地完成它的工作。

真正需要关注的唯一领域是大型分配（单个分配> 86KB），其中有很多**来来往往**可能是一个问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-19T12:57:03.453

我无法确定它是否明智，但如果您不希望它被收集，请使用以下代码：

```
GC.KeepAlive(object); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-19T13:04:42.500

您需要注意项目不会出现在大对象堆 (>85K) 中。如果它们保持常驻，这不是问题，但如果数据被换入和换出，您可能最终会出现内存碎片，因为 LOH 没有被压缩。

# c# - 文件/目录的开销。getter 中是否存在？

> ID：565192
> 
> 赞同：2
> 
> 时间：2009-02-19T12:52:26.227
> 
> 标签：c#

我有一个类，它有几个属性引用本地磁盘上的文件/目录位置。这些值可以是动态的，我想确保无论何时访问它们，我都会首先验证它是否存在，而不必在使用这些值的每个方法中都包含此代码。

我的问题是，将它放在吸气剂中会导致性能损失吗？它不会在一个循环中被调用数千次，所以这不是一个考虑因素。只是想确保我没有做会导致不必要的瓶颈的事情。

我知道通常过早优化是不明智的，但我宁愿现在进行此错误检查，然后我必须返回并将其从 getter 中删除并将其添加到所有地方。

* * *

澄清：

属性指向的文件/目录将由 System.Diagnostics.Process 使用。我不会直接读取/写入这些文件/目录，我只是想在生成子进程之前确保它们存在。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-19T15:47:59.983

任何不是简单查找或计算的东西都应该放在方法中，而不是属性中。属性在概念上应该类似于只访问一个字段——如果有任何额外的开销或失败的可能性（并且 IO——即使只是检查一个文件是否存在——在这两个方面都会使测试失败），那么属性不是正确的选择。

请记住，在查看对象状态时，调试器甚至会调用属性。

从这个角度来看，您关于开销实际是什么以及及早优化的问题变得无关紧要。希望这可以帮助。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-19T12:56:43.847

如果您正在重用一个对象，您应该考虑使用 FileInfo 类与静态 File 类。File 类的静态方法每次都会进行一次可能不必要的安全检查。
[FileInfo](http://msdn.microsoft.com/en-us/library/system.io.fileinfo.aspx) - [DirectoryInfo](http://msdn.microsoft.com/en-us/library/system.io.directoryinfo.aspx) -[文件](http://msdn.microsoft.com/en-us/library/system.io.file.exists.aspx)-[目录](http://msdn.microsoft.com/en-us/library/system.io.directory.exists.aspx)

**编辑：**

我的回答仍然适用。为了确保您的文件存在，您可以在 getter 中执行类似的操作：

```
if(File.Exists(string))
//do stuff
else
//file doesn't exist 
```

或者

```
FileInfo fi = new FileInfo(fName);
 if (fi.Exists)
//do stuff
else
//file doesn't exist 
```

正确的？

我的意思是，如果您在此逻辑中循环数千次，则使用**FileInfo**实例 VS 静态**File**类，因为如果您使用静态**File.Exits**方法，则会对性能产生负面影响。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-19T13:11:36.570

如果您非常担心性能（当您说过早优化不是一个好主意时您是对的），有一些方法可以缓解这种情况。如果您认为昂贵的操作是文件 I/O 并且您有很多此类操作，您总是可以考虑在您的课程中使用类似字典的东西。考虑这个（相当做作的）示例代码：

```
private Dictionary<string, bool> _directories = new Dictionary<string, bool>();

private void CheckDirectory(string directory, bool create)
{
  if (_directories.ContainsKey(_directories))
  {
    bool exists = Directory.Exists(directory);
    if (create && !exists)
    {
      Directory.CreateDirectory(directory);
    }
    // Add the directory to the dictionary. The value depends on
    // whether the directory previously existed or the method has been told
    // to create it.
    _directories.Add(directory, create || exists);
  }
} 
```

稍后通过迭代此列表来添加那些不存在的目录是一件简单的事情。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-19T13:37:50.033

1.  路径存在于检查点是可行的，但在检查点和对其进行操作之间被移动/删除。

    *   您可能已经知道这一点并接受了风险，但只是为了让您意识到这一点。
2.  如果你无论如何都要这样做，它是否在一个属性中并不重要，只是你检查的粒度是多少（每个操作一次或每组操作一次）

3.  如果您使用非静态 FileInfo 操作，请注意此对象将在文件系统上**缓存**其视图。

    *   这对您来说可能是一件好事，因为您可以通过 Refresh() 方法控制刷新缓存的频率，否则可能会导致代码中的错误。
4.  通常在担心性能建议之前先尝试一下，但您表示您知道这一点。

# language-agnostic - 基于合同的自由职业者的互惠知识产权/版权条款

> ID：565206
> 
> 赞同：7
> 
> 时间：2009-02-19T12:57:54.357
> 
> 标签：language-agnostic

我与客户签订的合同中有一个版权部分，声明我保留在我作为独立承包商为他们工作期间制作的任何作品的版权。这绝对不是为了对我的客户施加任意限制，而是为了保持我决定我创建的软件如何获得许可和分发的能力。几乎我从事的每个项目都会导致其中至少一部分作为开​​源发布。我从事的每个项目都使用以相同方式发布的第三方软件，因此我希望继续这样做。

不幸的是，在定义客户使用所述软件的权利时，合同并不清楚。我提到代码将被许可给他们，但没有提到关于排他性、生产衍生品的能力等细节。

因此，一位客户对我的合同中的版权部分提出了担忧，并建议我对其进行改写，以便在项目的最终付款时将所有版权完全转移给客户。这几乎肯定会降低我分发我创建的软件的能力；我更愿意找到一个更互利的协议，以平息我们双方的担忧。

在这种情况下，是否有任何经过验证的真实方法来许可软件？总结一下：

*   我想保持按照我自己的条款许可（部分）软件的能力，独立于我与客户的关系；
*   向客户保证不会共享任何商业机密或关键业务逻辑；
*   让他们能够在未来的项目中重用我的代码；
*   但不一定让他们卖掉（不过我不确定……如果他们卖掉他们的业务和软件会发生什么？）

我知道每个人的反馈都会以“IANAL”为前缀，但是我很感激您对此事的任何想法。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-19T13:03:20.087

创建一个许可，授予客户使用和修改软件的权利，但限制在获得许可的组织之外分发该软件。

这应该可以满足您的需求，因为您在与客户的合同中声明您保留对软件版权的控制权，并且他们根据合同签订时选择的许可从您那里获得许可。

只要您在签署合同时还签署了 NDA，他们的秘密就会被涵盖在内。

编辑：哦，是的，差点忘了：IANAL

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-19T23:08:56.557

尝试将项目分解为具有自己许可证的组件。这样，业务逻辑就有了他们的版权，而通用组件有你的版权和开源许可证。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-25T05:02:33.500

在考虑了给出的两个答案后，我决定将这两种方法结合起来会产生最好的结果。

考虑到这一点，我定义了两种类型的可交付成果；通用的和特定于客户的。客户在最终付款后获得客户特定交付物的专有所有权，我保留所有通用交付物的所有权。客户被授予“永久、不可撤销、有限、非独占、不可转让的全球许可，无权授予分许可（关联公司和子公司除外）”。

这种变化满足了我自己和客户的要求。

# c++ - 私有工作集大小取决于应用程序名称

> ID：565210
> 
> 赞同：2
> 
> 时间：2009-02-19T12:58:45.043
> 
> 标签：c++, windows, memory

一位同事一直在尝试减少在 vista 64 上运行的 32 位应用程序的内存占用，并注意到报告的私有工作集大小存在一些奇怪的行为。

他做了一些更改并重新编译了应用程序。然后他运行应用程序并加载到数据文件中。任务管理器报告私有工作集为 98Mb。然后，当他运行 fred.exe 并加载相同的数据文件时，他只是将应用程序重命名为“fred.exe”，据报道，私有工作集为 125Mb。将文件重命名为其原始名称，重复此操作，私有工作集将恢复为 98Mb。

有谁知道这是什么原因？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-20T10:37:44.517

Vista 正在使用应用程序缓存 (SuperFetch) 做一些聪明的事情。据我了解，这是通过应用程序名称完成的。

在您的情况下，我假设 Vista 检测到“originalName.EXE”从未受益于大型工作集，因此将其修剪为 98 MB 有助于其他应用程序。另一方面，新的“fred.exe”仍然得到默认处理。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-19T13:01:27.500

这通常发生在满月期间。

他还记得把一只鸡献给记忆之神巴尔泽布尔吗？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-10T01:20:04.747

应用程序的“工作集”（大致）是应用程序的当前可用虚拟内存空间的多少。该值会因多种原因而波动，具体取决于机器中发生的其他情况，并且并不能真正反映进程的实际内存占用。它当然不依赖于可执行文件的名称。

另一方面，“私有字节”值在测量应用程序的内存占用时最有用。该值反映了应用程序为分配更多内存而发出的请求总量，并且不依赖于当时恰好换入了多少应用程序的工作集。

# hibernate - Hibernate - 在 pojo 中声明一个瞬态对象

> ID：565216
> 
> 赞同：2
> 
> 时间：2009-02-19T13:00:11.293
> 
> 标签：hibernate, transient

我有一个 pojo，它是表 TableA 的对象 A

`TableA (int a1,int a2)`.

为了填写表格，我运行一个返回 (int a1, int a2, boolean b3) 的查询（并运行多个数据检查）

b3 在 TableA 中无效，但我仍然想对两者使用相同的 pojo （这是一个非常大的 pojo ，为了查询而拥有一个将是主要的代码重复）

我已经在 pojo 中声明了

```
@Transient
Boolean getB3() {..}
void setB3(Boolean b3) {..} 
```

在查询中，我声明我希望获得 b3 值：

```
<return> ...
<return-property name="b3" column="b3"/>
...
</return> 
```

但是 Hibernate 只是忽略了参数并且从不使用“setB3()”。当我删除 @Transient 时，它可以工作（然后在插入 table 时自然会失败） - 所以所有名称都是正确的

我怎样才能解决这个问题？

谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-03T19:04:04.630

好吧，不同的想法。我想既然您将该属性标记为瞬态休眠，它将既不会加载也不会存储该属性。

一种解决方案可能是创建两个类。一个没有 b 属性。第二个使用 mappedSuperclass 注释从第一个扩展。

或者您可以尝试使用一些仅提供一些默认值（例如 false）的[公式](http://www.hibernate.org/hib_docs/annotations/reference/en/html_single/#d0e2273)来映射它。因此，对于“正常”情况，您休眠将使用公式，从而产生一些默认值，对于您的特殊查询，您使用该查询中的任何逻辑。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-19T13:20:33.103

您的 ID 注释在哪里？它是在 getter 或 setter 上还是在字段上？

如果它在一个字段上，休眠将只查看字段以查找其他注释。

> 访问类型
> 
> accessType 属性在@Entity、@EmbeddableSuperclass、@Embeddable 中不再可用。从@Id 或@EmbeddedId 注释位置猜测给定实体的访问类型。如果实体在字段上具有@Id，则访问类型将为字段，并且将读取字段上的所有注释。方法也一样。@MappedSuperclass（以前的@EmbeddableSuperclass）和@Embeddable 从它们的拥有实体继承访问类型。
> 
> 禁止使用@Id 为给定实体注释字段和方法。
> 
> 如果出于某种原因您想在给定实体中或在实体与其 MappedSuperclass/Embeddable 之间混合访问类型，您可以使用 Hibernate 特定的 @AccessType 注释（请参阅参考文档以获取更多信息）。

这是来自[http://www.hibernate.org/398.html](http://www.hibernate.org/398.html)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-19T13:24:54.793

您是否在字段和方法上混合了注释？

例如，这不起作用：

```
@Entity
public class A {
    @Id
    @GeneratedValue
    private Long id;

    @Column
    private String b;

    private String c;

    public void setB(String b) { this.b = b; }
    public String getB() { return b; }

    @Transient // inconsistent with other annotations
    public void setC(String c) { this.c = c; }
    public String getC() { return c; }
} 
```

而这将：

```
@Entity
public class A {
    @Id
    @GeneratedValue
    private Long id;

    @Column
    private String b;

    @Transient // consistent with other annotations
    private String c;

    public void setB(String b) { this.b = b; }
    public String getB() { return b; }

    public void setC(String c) { this.c = c; }
    public String getC() { return c; }
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2015-01-05T17:40:11.663

在 get 方法上尝试 @Transient ，而不是 set 方法。

# java - cocoon 2.1.x 到 2.2.0 迁移指南

> ID：565225
> 
> 赞同：2
> 
> 时间：2009-02-19T13:03:36.217
> 
> 标签：java, upgrade, apache-cocoon

谁能推荐我一个好的迁移指南？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2011-01-28T11:10:50.367

[《Cocoon 2.2 without Tears》](http://www.csparks.com/cocoon/c22without/index.xhtml)是一篇关于此次升级的精彩文章：

> 本页描述了使用 cocoon 2.2 的一种不同寻常的方式。因此，cocoon 2.1 的前用户或已经在使用 2.2 时遇到挫折的人最欣赏它。

也可以看看：

*   [“2.2 中的新功能：迁移 2.1 组件”](http://cocoon.apache.org/2.2/1420_1_1.html)
*   [《表单迁移指南》](http://cocoon.apache.org/2.2/blocks/forms/1.0/1351_1_1.html)和[《AJAX 迁移指南》](http://cocoon.apache.org/2.2/blocks/ajax/1.0/1350_1_1.html)

# c# - 打开选定的文件或目录

> ID：565234
> 
> 赞同：-2
> 
> 时间：2009-02-19T13:05:24.323
> 
> 标签：c#

我将尝试清楚地解释这一点。使用鼠标，我们在资源管理器中选择文件或目录，我想知道的是，当一个项目被选中（可能是文件或目录）时，我想以编程方式打开所选项目。

这对我来说有点困难。我想知道如何获取选定或焦点文件或目录的窗口句柄。谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-19T13:19:05.477

[System.Diagnostics.Process.Start](http://msdn.microsoft.com/en-us/library/system.diagnostics.process.start.aspx)？

# php - 如何以自定义方式在 Zend Framework 应用程序中实现 jquery？

> ID：565235
> 
> 赞同：3
> 
> 时间：2009-02-19T13:05:33.700
> 
> 标签：php, jquery, zend-framework

如何以自定义方式在 Zend Framework 应用程序中实现 jquery。

*   附加 jquery.js**确定**
*   附加脚本**确定**
*   发送 POST 数据到控制器**ok**
*   处理 POST 数据**正常**
*   **现在**可以发送“AjaxContext”响应客户端（谢谢）

我第一次使用jquery，我做错了什么？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-19T14:48:31.393

早期，让 Zend 在没有完整布局的情况下响应 ajax 请求的最佳实践是检查通过请求标头提供的变量。根据[文档](http://framework.zend.com/manual/en/zend.controller.request.html#zend.controller.request.http.ajax)，包括 jQuery、Prototype、Yahoo UI、MockiKit 在内的许多客户端库都发送了正确的标头以使其正常工作。

```
if($this->_request->isXmlHttpRequest())
{
    //The request was made with via ajax
} 
```

然而，现代实践，以及您可能正在寻找的，现在是使用两个新助手之一：

*   [上下文切换器](http://framework.zend.com/manual/en/zend.controller.actionhelpers.html#zend.controller.actionhelpers.contextswitch)
*   **[Ajax 内容](http://framework.zend.com/manual/en/zend.controller.actionhelpers.html#zend.controller.actionhelpers.contextswitch.ajaxcontext)**

这使得该过程更加优雅。

```
class CommentController extends Zend_Controller_Action
{
    public function init()
    {
        $ajaxContext = $this->_helper->getHelper('AjaxContext');
        $ajaxContext->addActionContext('view', 'html')
                    ->initContext();
    }

    public function viewAction()
    {
        // Pull a single comment to view.
        // When AjaxContext detected, uses the comment/view.ajax.phtml
        // view script.
    } 
```

**请注意：**这种现代方法**要求**您请求格式才能触发上下文。它在文档中并不是很明显，当您最终在浏览器中得到奇怪的结果时会有些混乱。

```
/url/path?format=html 
```

希望我们可以找到一种解决方法。查看[完整文档](http://framework.zend.com/manual/en/zend.controller.actionhelpers.html#zend.controller.actionhelpers.contextswitch.ajaxcontext)以获取更多详细信息。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-19T14:57:58.233

确保您使用`$(document).ready()`任何触及 DOM 的 jQuery 事件。另外，检查 javascript/parser 错误控制台。在 Firefox 中，它位于 Tools->Error Console 中。如果您还没有安装它，我强烈推荐[Firebug](http://getfirebug.com)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-19T14:57:09.220

这应该是一个评论，不能，但是......
它与ZF + Jquery组合无关。
首先用一个简单的 php 文件尝试你需要的原型。没有框架，只有 Jquery 和直截了当的脏 php。
哦，别忘了跟踪 FireBug 发生的情况。

# windows-services - 不同用户会话中 Windows 服务和应用程序之间的通信

> ID：565238
> 
> 赞同：2
> 
> 时间：2009-02-19T13:06:41.373
> 
> 标签：windows-services, named-pipes

我有以下情况：

具有多个用户会话的 Windows Server 环境。

Windows 服务正在侦听众所周知的端口。

每个用户会话中的托盘应用程序自动启动。

Silverlight (SL) 应用程序在浏览器中运行，并使用套接字和预定义端口与 Windows 服务进行通信。

我的目标如下：用户与 SL 应用程序交互，SL 应用程序使用套接字与 Windows 服务通信，然后 Windows 服务应与位于同一用户会话中的适当托盘应用程序通信，例如发起调用的浏览器。

Windows 服务和托盘应用程序之间的通信计划使用命名管道来完成。

问题：如何定义/传输命名管道的名称到 Windows 服务以建立正确的（Windows 服务 -> 正确用户会话中的托盘应用程序）连接？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-10-17T19:25:21.937

我没有找到描述问题的确切解决方案。但是可以使用自定义协议概念。

SL 应用程序生成自定义协议链接，注册应用程序在用户会话中处理此类链接。之后，此类应用程序可以与正在侦听已知端口的 Windows 服务建立双向通信。

# asp.net - 有什么方法可以清除/刷新/删除OutputCache？

> ID：565239
> 
> 赞同：30
> 
> 时间：2009-02-19T13:07:08.877
> 
> 标签：asp.net, caching

我在我的网络用户控件 (.ascx) 上使用 OutputCache

```
<%@ OutputCache Duration="1000" VaryByParam="none" %> 
```

我想在接下来的 1000 秒内保留缓存，但是当我网站上的特定页面被加载时，我想删除/刷新/刷新缓存。就像，我想在加载 MyPage.aspx 时清除缓存。我可以以编程方式刷新缓存吗？

它只有一个页面被缓存，因此没有参数化版本可以刷新缓存。

提前感谢您的帮助。

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2009-02-19T14:57:18.190

您可以[`VaryByCustom`](http://msdn.microsoft.com/en-us/library/system.web.ui.outputcacheparameters.varybycustom.aspx)为此使用参数。

在您的用户控件中，您将拥有以下内容：

```
<%@ OutputCache Duration="1000" VaryByParam="None" VaryByCustom="MyKey" %> 
```

然后你会像这样覆盖[`GetVaryByCustomString`](http://msdn.microsoft.com/en-us/library/system.web.httpapplication.getvarybycustomstring.aspx)Global.asax 中的方法：

```
public override string GetVaryByCustomString(HttpContext context, string arg)
{
    if (arg == "MyKey")
    {
        object o = context.Current.Application["MyGuid"];
        if (o == null)
        {
            o = Guid.NewGuid();
            context.Current.Application["MyGuid"] = o;
        }
        return o.ToString();
    }
    return base.GetVaryByCustomString(context, arg);
} 
```

最后`MyPage.aspx`你会这样做：

```
Application["MyGuid"] = Guid.NewGuid(); 
```

**这是如何运作的？**

每当您的控件被缓存时，它都会与一个字符串相关联（`GetVaryByCustomString`当您的控件的`VaryByCustom`键被传递给它时从该方法返回的字符串）。

每当随后使用该控件时，`GetVaryByCustomString`都会再次调用该控件。如果返回的字符串与控件的缓存版本匹配，则使用缓存版本。

在我们的例子中，“MyKey”被传入`GetVaryByCustomString`并返回存储在`Application["MyGuid"]`.

每当`MyPage.aspx`被调用时，它都会更改`Application["MyGuid"]`为一个新的随机值。

下次使用控件时，该`GetVaryByCustomString`方法将返回新值，并且由于没有与该值关联的控件的缓存版本，因此将重新生成控件。（然后控件将被缓存并与新值关联，以持续到下一次调用`MyPage.aspx`etc）

[这里](http://msdn.microsoft.com/en-us/library/5ecf4420.aspx)有一个概述。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-12-30T22:27:13.767

您可以使用[`HttpResponse.RemoveOutputCacheItem`](http://msdn.microsoft.com/en-us/library/914c7ktw(VS.71).aspx)或[`HttpResponse.AddCacheItemDependency`](http://msdn.microsoft.com/en-us/library/system.web.httpresponse.addcacheitemdependency.aspx)使输出缓存条目无效。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2013-04-16T13:39:04.063

破解一种疯狂的方法有点像大锤，但这是完全清除/刷新我发现的应用程序缓存的最简单和最有效的方法。

只需调用：

```
HttpRuntime.UnloadAppDomain(); 
```

这与回收应用程序池具有相同的影响。并非在所有情况下都适用，但它肯定会完成工作。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-02-19T13:23:13.843

**编辑：**如果您在 II6+ 上启用了内核缓存，那么您将需要遵循 Luke 的建议并使用 VaryByCustom 标头，因为清除 ASP.NET 缓存不会影响内核缓存。

OutputCache 存储在 ASP.NET 缓存中，因此您只需调用 Cache.Remove：

```
List<string> keys = new List<string>();

foreach(string key in HttpRuntime.Cache)
{
    keys.Add(key);
}

foreach(string key in keys)
{
    Cache.Remove(key);
} 
```

但是，这将删除所有缓存条目，包括您的代码添加的自定义条目。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2015-02-26T08:18:46.523

通过在其他帖子上获得灵感，以下代码段`OutputCache`通过使用反射成功删除了 asp.net 中缓存的每个页面：

```
 public static void ClearOutputCache()
        {

            var runtimeType = typeof(HttpRuntime);

            var ci = runtimeType.GetProperty(
               "CacheInternal",
               BindingFlags.NonPublic | BindingFlags.Static);

            var cache = ci.GetValue(ci, new object[0]);

            var cachesInfo = cache.GetType().GetField(
                "_caches",
                BindingFlags.NonPublic | BindingFlags.Instance);
            var cacheEntries = cachesInfo.GetValue(cache);

            var outputCacheEntries = new List<object>();

            foreach (Object singleCache in cacheEntries as Array)
            {
                var singleCacheInfo =
                singleCache.GetType().GetField("_entries",
                   BindingFlags.NonPublic | BindingFlags.Instance);
                var entries = singleCacheInfo.GetValue(singleCache);

                foreach (DictionaryEntry cacheEntry in entries as Hashtable)
                {
                    var cacheEntryInfo = cacheEntry.Value.GetType().GetField("_value",
                       BindingFlags.NonPublic | BindingFlags.Instance);
                    var value = cacheEntryInfo.GetValue(cacheEntry.Value);
                    if (value.GetType().Name == "CachedRawResponse")
                    {
                        var key = (string)cacheEntry.Value.GetType().BaseType.GetField("_key", BindingFlags.Instance | BindingFlags.NonPublic).GetValue(cacheEntry.Value);
                        key = key.Substring(key.IndexOf("/"));
                        outputCacheEntries.Add(key);
                    }
                }
            }
            foreach (string key in outputCacheEntries)
            {  
                HttpResponse.RemoveOutputCacheItem(key);
            }
        } 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2019-05-02T21:15:10.307

因为[这个答案](https://stackoverflow.com/a/28737424/)不再有效，而且[这个答案](https://stackoverflow.com/a/565279/)只清除自定义缓存项（不是存储在缓存中的页面/MVC 操作），我挖掘了 ASP.NET 参考源代码并想出了这个：

```
public static void ClearAllCache()
{
    var runtimeType = typeof(System.Web.Caching.Cache);

    var ci = runtimeType.GetProperty(
       "InternalCache",
       BindingFlags.Instance | BindingFlags.NonPublic);

    var cache = ci.GetValue(HttpRuntime.Cache) as System.Web.Caching.CacheStoreProvider;
    enumerator = cache.GetEnumerator();
    while (enumerator.MoveNext())
    {
        keys.Add(enumerator.Key.ToString());
    }
    foreach (string key in keys)
    {
        cache.Remove(key);
    }
} 
```

更多信息在我的博客文章[中](https://www.jitbit.com/alexblog/279-clearflush-all-outputcache-in-aspnet/)

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2010-07-13T09:35:51.750

你可以添加 HttpResponse.RemoveOutputCacheItem("/YourCachePageName.aspx"); 页面的页面加载事件中的代码行，您希望缓存页面的缓存关闭。

# asp.net-mvc - 哪个动作作为强类型对象执行

> ID：565242
> 
> 赞同：0
> 
> 时间：2009-02-19T13:07:35.363
> 
> 标签：asp.net-mvc, action

我希望能够获得一些强类型的方式来了解正在执行的操作。

为了澄清我正在做 AOP，如果用户有权执行该操作，我只允许访问给定的操作。

使用字符串来确定要检查的规则的问题在于，如果某些开发人员重命名操作，我不会收到一个编译错误，告诉我我的规则已损坏。

有任何想法吗？？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-19T13:12:13.403

开发一个执行检查的属性。将该属性与任何必要的选项一起应用于您要保护的操作。编写单元测试来检查有问题的操作是否存在并用您的属性（使用适当的选项）进行修饰。在您的属性中，您不需要知道正在执行什么操作，只需知道当前用户是否通过了您的属性选项配置的测试。

我有几个从 AuthorizeAttribute 派生的不同属性，它们正是做这种事情。

```
 public class RequiresEmailAttribute : AuthorizeAttribute
 {
      ... implements the logic to test whether the current user
      ... has an email address and redirects to error view if no
      ... email address is found
 }

 [RequiresEmail]
 public ActionResult SendEmail( string to )
 {
    ....
 } 
```

# wpf - 样式化 WPF 布局网格背景（每个单元格、行、列）

> ID：565243
> 
> 赞同：26
> 
> 时间：2009-02-19T13:07:54.520
> 
> 标签：wpf, xaml, grid, styles, controltemplates

我想知道是否有任何方法可以设置 WPF 布局网格的单元格、行和列的样式。我一直在尝试查找任何信息，但我发现的少数提及并没有提供那么多信息。

我想将网格设置为看起来像链接屏幕截图中的网格。

如果实际控件不支持，我可以以某种方式继承它然后做吗？我对 WPF 很陌生，所以非常感谢任何帮助。

另一件事，我知道我可以为网格中的每个控件设置样式，但这似乎有点矫枉过正。我想有一个自己做的网格。

[截图 http://img21.imageshack.us/img21/2842/capturehz8.png](http://img21.imageshack.us/img21/2842/capturehz8.png)

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-02-19T13:51:59.533

@Dan 推荐我正在阅读的 WPF Unleashed。就在今天早上，我遇到了一个解决您问题的部分。

第 6 章，第 161 页：

> **常见问题解答：如何像 HTML 表格的单元格一样为网格单元格提供背景颜色、填充和边框？**
> 
> 没有内在的机制来赋予 Grid 单元这样的属性，但是您可以很容易地模拟它们，这要归功于多个元素可以出现在任何 Grid 单元中的事实。要为单元格提供背景颜色，您可以简单地使用适当的填充插入一个矩形，默认情况下它会拉伸以填充单元格。要给单元格填充，您可以使用自动调整大小并在适当的子元素上设置边距。对于边框，您可以再次使用 Rectangle，但给它一个适当颜色的显式 Stroke，或者您可以简单地使用 Border 元素。
> 
> 只需确保在任何其他子项之前将此类 Rectangles 或 Borders 添加到 Grid（或使用 ZIndex 附加属性显式标记它们），因此它们的 Z 顺序将它们放在主要内容的后面。

顺便说一句，WPF 释放的岩石。它写得很好，全彩印刷使它更容易阅读。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2009-02-19T14:34:09.743

这是一个快速（非常粗略的示例），您可以随意修改以获得您想要的格式（如果您认真使用 WPF，您会发现 Blend 在使您的布局看起来不错方面有很大帮助）：

```
<Page xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"                                                                                                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
       <Page.Resources>
           <Style x:Key="CustomerDefinition" TargetType="TextBlock">
               <Setter Property="Control.FontFamily" Value="Tahoma"/>
               <Setter Property="Control.FontSize" Value="12"/>
               <Setter Property="Control.Foreground" Value="Red"/>
           </Style>
           <Style TargetType="{x:Type Label}">
               <Setter Property="Width" Value="100"/>
           </Style>
           <Style x:Key="{x:Type TextBox}" TargetType="{x:Type TextBox}">
               <Setter Property="SnapsToDevicePixels" Value="True"/>
               <Setter Property="OverridesDefaultStyle" Value="True"/>
               <Setter Property="KeyboardNavigation.TabNavigation" Value="None"/>
               <Setter Property="FocusVisualStyle" Value="{x:Null}"/>
               <Setter Property="MinWidth" Value="120"/>
               <Setter Property="MinHeight" Value="20"/>
               <Setter Property="AllowDrop" Value="true"/>
               <Setter Property="Width" Value="200"/>
               <Setter Property="Template">
                   <Setter.Value>
                       <ControlTemplate TargetType="{x:Type TextBoxBase}">
                           <Border
                               Name="Border"
                               Background="#FFEBE9E9"
                               BorderBrush="#FF8B8787"
                               BorderThickness="1"
                               CornerRadius="2"
                               Padding="3">
                               <ScrollViewer x:Name="PART_ContentHost" Margin="0"/>
                           </Border>
                           <ControlTemplate.Triggers>
                               <Trigger Property="IsEnabled" Value="False">
                                   <Setter TargetName="Border" Property="Background"
                                                       Value="#EEEEEE"/>
                                   <Setter TargetName="Border" Property="BorderBrush"
                                                       Value="#EEEEEE"/>
                                   <Setter Property="Foreground" Value="#888888"/>
                               </Trigger>
                           </ControlTemplate.Triggers>
                       </ControlTemplate>
                   </Setter.Value>
               </Setter>
           </Style>
           <LinearGradientBrush x:Key="NormalBrush" StartPoint="0,0" EndPoint="0,1">
               <GradientBrush.GradientStops>
                   <GradientStopCollection>
                       <GradientStop Offset="0.0" Color="#FFF0EDED"/>
                       <GradientStop Offset="1.0" Color="#FFE1E0E0"/>
                   </GradientStopCollection>
               </GradientBrush.GradientStops>
           </LinearGradientBrush>
       </Page.Resources>
       <Grid>
           <Grid.ColumnDefinitions>
               <ColumnDefinition Width="*"/>
               <ColumnDefinition Width="*"/>
           </Grid.ColumnDefinitions>
           <Grid.RowDefinitions>
               <RowDefinition Height="26"/>
               <RowDefinition Height="23"/>
               <RowDefinition Height="24"/>
               <RowDefinition Height="24"/>
               <RowDefinition Height="24"/>
           </Grid.RowDefinitions>
           <TextBlock
               Grid.ColumnSpan="2"
               Grid.Row="0"
               Style="{StaticResource CustomerDefinition}"
               Text="Customer Definition"/>
           <Border
               Grid.Column="0"
               Grid.Row="1"
               Background="#FFEBE9E9"
               BorderBrush="#FF8B8787"
               BorderThickness="1">
               <StackPanel Background="{StaticResource NormalBrush}" Orientation="Horizontal">
                   <Label Content="Customer Code"/>
                   <TextBox Text="SMITHA 098 (normally I'd bind here)"/>
               </StackPanel>
           </Border>
           <Border
               Grid.Column="1"
               Grid.Row="1"
               Background="#FFEBE9E9"
               BorderBrush="#FF8B8787"
               BorderThickness="1">
               <StackPanel Background="{StaticResource NormalBrush}" Orientation="Horizontal">
                   <Label Content="Customer Type"/>
                   <TextBox Text="PRIVATE INDIVIDUAL"/>
               </StackPanel>
           </Border>
       </Grid> </Page> 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-19T13:38:08.240

WPF`Grid`没有可见的单元格。将它们视为不可见的网格线，您可以将子元素对齐。

因此，要设置网格单元格的样式，您必须设置网格内对齐的项目的样式。

`Grid`将视为 WinForms 之类的东西令人困惑`DataGrid`。我猜它最接近的 WinForms 等价物是`TableLayout`控件。

查看一些 3rd 方网格控件。我在测试版中使用了 DevExpress，发现它非常简单。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-19T13:38:34.650

我建议您使用边框作为样式。

您可以通过为每行和每列创建边框并相应地设置行跨度和列跨度来轻松地重新创建该布局。

您将有 5 个带有 colspan 2 的边框，这些边框将处理每行的渐变背景以及每行顶部和底部的边框。然后你将有 2 个行跨度为 5 的边框，这些将处理列边框。想象一下，您正在覆盖边框以形成您所追求的视觉网格效果。

对于页眉和外边框，只需根据需要用边框和样式包裹整个网格。

我建议将您的样式存储为资源，以便您可以将所有样式信息保存在一个地方。

注意了解样式的工作原理，因为它非常强大，但是有一个学习曲线，因为它与 CSS 的工作方式完全不同。如果可以的话，我会推荐阅读[WPF Unleashed 。](https://rads.stackoverflow.com/amzn/click/com/0672328917)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-08-06T20:43:46.647

我在寻找为 DataGrid 单元格设置边距（或填充）的方法时发现了这篇文章。多亏了（接近尾声）发布的示例 xaml 代码，我的问题得到了解决——非常简约。

[http://forums.silverlight.net/forums/p/16842/55997.aspx](http://forums.silverlight.net/forums/p/16842/55997.aspx)

# nhibernate - 我可以使用 Criteria API 编写此 SQL 吗？

> ID：565244
> 
> 赞同：0
> 
> 时间：2009-02-19T13:08:18.763
> 
> 标签：nhibernate

我正在尝试在 Criteria API 中重现此查询。在我的映射中，标签和产品之间存在多对多，但这仅出现在我的标签类中，即产品类不知道标签。基本上我想找到所有具有所有标签列表的产品。这是我生成的 sql，尽管它可能会改进。

```
SELECT Product.* FROM Product

    WHERE Product.ProductID IN (
        SELECT ProductID FROM ProductTagMap
            INNER JOIN Tag ON ProductTagMap.TagId = Tag.TagId
                WHERE Tag.UrlName = 'sticks')

    AND Product.ProductID IN (
        SELECT ProductId FROM ProductTagMap
            INNER JOIN Tag ON ProductTagMap.TagId = Tag.TagId
                WHERE Tag.UrlName = 'vic-firth') 
```

任何想法，非常感谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-19T13:14:31.383

是的，您可能最好查看 DetachedCriteria 的。这不完全是您正在做的事情，但[这篇博客文章](http://ayende.com/Blog/archive/2007/12/23/NHiberante-Querying-Many-To-Many-associations-using-the-Criteria-API.aspx)有一些使用 DetachedCriteria 的好例子 - 只需将他的 Exists 替换为 In 即可。

# java - 如何设置字符串的颜色

> ID：565252
> 
> 赞同：16
> 
> 时间：2009-02-19T13:13:19.670
> 
> 标签：java, colors, system.out

有谁知道我将如何设置将要打印的字符串的颜色`System.out`？
这是我目前拥有的代码：

```
System.out.println("TEXT THAT NEEDS TO BE A DIFFERENT COLOR."); 
```

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-02-19T14:04:50.873

## 安慰

有关完整的序列集合（包括颜色），请参阅[有关 ANSI 转义的 Wikipedia 页面。](http://en.wikipedia.org/wiki/ANSI_escape_code)

但是对于 Java 中的一个简单示例（以红色打印）（如您将其标记为 Java），请执行以下操作：

```
System.out.println("\u001B31;1mhello world!"); 
```

3 表示改变颜色，第一个 1 表示红色（绿色将是 2），第二个 1 表示在“明亮”模式下进行。

## 图形用户界面

但是，如果要打印到 GUI，最简单的方法是使用 html：

```
JEditorPane pane = new new JEditorPane();
pane.setText("<html><font color=\"red\">hello world!</font></html>"); 
```

有关此类事情的更多详细信息，请参阅[Swing 教程](http://java.sun.com/docs/books/tutorial/uiswing/components/editorpane.html)。也可以通过在 JTextPane 中使用样式。[这是一个有用](http://www.java2s.com/Code/Java/Swing-JFC/ExtensionofJTextPanethatallowstheusertoeasilyappendcoloredtexttothedocument.htm)的代码示例，可以使用 JTextPane 轻松完成此操作（从有用的评论中添加）。

JTextArea 是一个[单一颜色的文本组件，如此处所述](http://java.sun.com/docs/books/tutorial/uiswing/components/textarea.html)。它只能以一种颜色显示。您可以像这样设置整个 JTextArea 的颜色：

```
JTextArea area = new JTextArea("hello world");
area.setForeground(Color.red) 
```

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2013-02-17T20:39:02.310

对于 linux (bash) 以下代码适用于我：

```
System.out.print("\033[31mERROR  \033[0m"); 
```

\033[31m 将颜色切换为红色，\033[0m 将其切换回正常。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-19T13:52:50.030

谷歌显然有一个这类东西的库： [http ://code.google.com/p/jlibs/wiki/AnsiColoring](http://code.google.com/p/jlibs/wiki/AnsiColoring)

还有一篇 Javaworld 文章可以解决您的问题： [http ://www.javaworld.com/javaworld/javaqa/2002-12/02-qa-1220-console.html](http://www.javaworld.com/javaworld/javaqa/2002-12/02-qa-1220-console.html)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-19T13:27:38.060

如果您要打印到标准输出，则取决于您要打印到的终端。您可以在 xterms 和其他类似的终端仿真器上使用 ansi 转义码。这是一个 bash 代码片段，它将打印 xterm、putty 和 Konsole 支持的所有 255 种颜色：

```
 for ((i=0;i<256;i++)); do echo -en "\e[38;5;"$i"m"$i" "; done 
```

您可以在任何编程语言中使用这些转义码。最好依赖一个库，该库将根据架构和 TERM 环境变量的内容来决定使用哪些代码。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-04-01T10:07:29.157

我创建了一个名为[JCDP](http://www.diogonunes.com/#work)的 API ，以前的 JPrinter 代表*Java Colored Debug Printer*。对于 Linux，它使用 WhiteFang 提到的 ANSI 转义码，但使用单词而不是更直观的代码来抽象它们。对于 Windows，它实际上包含 JAnsi 库，但在其上创建了一个抽象层，保持为 Linux 创建的直观和简单的界面。

这个库是在[MIT 许可](https://tldrlegal.com/license/mit-license)下获得许可的，所以请随意使用它。

查看[JCDP 的 github 存储库](https://github.com/dialex/JCDP)。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-19T13:15:07.700

设置颜色（）。假设您在 AWT 上下文中使用 Graphics g。

请参阅[文档](http://java.sun.com/j2se/1.4.2/docs/api/java/awt/Graphics.html#setColor(java.awt.Color))以获取更多信息。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2014-03-13T12:37:01.387

下载 jansi-1.4.jar 并设置类路径并尝试此代码 100% 工作：

```
import org.fusesource.jansi.AnsiConsole;
import static org.fusesource.jansi.Ansi.*;
import static org.fusesource.jansi.Ansi.Color.*;

public class SampleColour
{
  public static void main(String[] args)
  {
    AnsiConsole.systemInstall();

    System.out.println(ansi().fg(RED).a("Hello World").reset());
    System.out.println("My Name is Raman");

    AnsiConsole.systemUninstall();
  }
} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-19T13:21:56.187

```
public class colorString
{

public static void main( String[] args )
{
    new colorString();   

}

public colorString( )
{
    kFrame f = new kFrame();
    f.setSize( 400, 400 );
    f.setVisible( true );
}

private static class kFrame extends JFrame
{
    @Override
    public void paint(Graphics g) 
    {
        super.paint( g );
        Graphics2D g2d = (Graphics2D)g;
        g2d.setColor( new Color(255, 0, 0) );
        g2d.drawString("red red red red red", 100, 100 );
    }
}
} 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-19T13:17:59.350

字符串不封装颜色信息。您是否正在考虑在控制台或 GUI 中设置颜色？

# c# - 滥用语言

> ID：565262
> 
> 赞同：1
> 
> 时间：2009-02-19T13:18:09.893
> 
> 标签：c#, using-statement

前段时间，我在实现 JavaScript 代码生成框架时不得不解决某个 C# 设计问题。我提出的解决方案之一是以完全不同的方式使用“使用”关键字（如果你愿意的话，这是骇人听闻的）。我将它用作构建分层代码结构的语法糖（好吧，本来它就是一个）。看起来像这样的东西：

```
CodeBuilder cb = new CodeBuilder();

using(cb.Function("foo"))
{
    // Generate some function code
    cb.Add(someStatement);
    cb.Add(someOtherStatement);

    using(cb.While(someCondition))
    {
        cb.Add(someLoopStatement);

        // Generate some more code
    }
} 
```

它之所以有效，是因为 Function 和 While 方法返回 IDisposable 对象，该对象在处置时会告诉构建器关闭当前范围。这样的东西对于任何需要硬编码的树状结构都有帮助。

你认为这样的“黑客”是合理的吗？因为您可以说，例如，在 C++ 中，模板和运算符重载等许多特性都被过度滥用了，而且这种行为受到许多人的鼓励（例如 boost）。另一方面，您可以说许多现代语言不鼓励这种滥用，并为您提供特定的、更受限制的功能。

当然，我的例子有些深奥，但真实。那么您如何看待具体的黑客攻击和整个问题？你遇到过类似的困境吗？你能容忍多少虐待？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-19T13:28:00.963

题外话，但只要看看使用 lambdas 变得多么漂亮：

```
var codeBuilder = new CodeBuilder();
codeBuilder.DefineFunction("Foo", x =>
{
    codeBuilder.While(condition, y =>
    {
    }
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-19T13:31:56.443

我认为这是从像 Ruby 这样的具有更广泛的机制让您在您的语言中创建语言的语言（如果您想了解更多信息，谷歌为“dsl”或“域特定语言”）所吹嘘的东西。C# 在这方面不太灵活。

我认为以这种方式创建 DSL 是一件好事。它使代码更具可读性。使用块可能是 C# 中 DSL 的有用部分。在这种情况下，我认为有更好的选择。在这种情况下使用 using 偏离其最初目的有点太远了。这可能会使读者感到困惑。例如，我更喜欢 Anton Gogolev 的解决方案。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-19T14:03:15.713

如果从 cb.Function(name) 返回的一次性对象是应该添加语句的对象会更好。在*内部*，这个函数构建器通过调用 CodeBuilder 上的私有/内部函数很好，只是对于公共消费者来说，顺序很清楚。

只要 Dispose 实现会使以下代码导致运行时错误。

```
CodeBuilder cb = new CodeBuilder();
var f = cb.Function("foo")
using(function)
{
    // Generate some function code
    f.Add(someStatement);
}
function.Add(something); // this should throw 
```

然后行为是直观的，相对合理的，正确的使用（下）鼓励和防止这种情况发生

```
CodeBuilder cb = new CodeBuilder();
using(var function = cb.Function("foo"))
{
    // Generate some function code
    function.Add(someStatement);
} 
```

我不得不问为什么您使用自己的类而不是提供的 CodeDomProvider 实现。（这有充分的理由，特别是当前的实现缺少许多 c# 3.0 功能）但是因为你自己没有提到它......

Edit: I would second Anoton's suggest to use lamdas. The readability is much improved (and you have the option of allowing [Expression Trees](http://msdn.microsoft.com/en-us/library/bb397951.aspx)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-19T13:36:57.697

如果您遵循 IDisposable 的最严格定义，那么这是一种滥用。它旨在用作托管对象以确定性方式释放本机资源的方法。

IDisposable 的使用已经演变为基本上由“任何应该具有确定性生命周期的对象”使用。我不是说这是写或错，而是有多少 API 和用户选择使用 IDisposable。鉴于该定义，它不是滥用。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-19T13:40:39.433

我不会认为这是非常糟糕的滥用，但我也不会认为它是好的形式，因为您正在为维护开发人员构建认知墙。using 语句意味着某种类型的生命周期管理。这在其通常的用途和稍微定制的用途中都很好（例如@heeen 对 RAII 类似物的引用），但这些情况仍然保持 using 语句的精神完好无损。

在您的特定情况下，我可能会争辩说，像@Anton Gogolev 这样的功能更强大的方法将更符合语言的精神并且更易于维护。

至于你的主要问题，我认为每个这样的黑客最终都必须站在自己的优点上，作为在特定情况下特定语言的“最佳”解决方案。当然，最佳的定义是主观的，但肯定有很多时候（尤其是当预算和时间表的外部限制被混合在一起时），稍微更老套的方法是唯一合理的答案。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-19T13:42:59.303

我经常“滥用”使用块。我认为它们提供了一种定义范围的好方法。我有一系列对象，用于在可能更改状态的操作期间捕获和恢复状态（例如组合框或鼠标指针）。我还使用它们来创建和删除数据库连接。

例如：

```
using(_cursorStack.ChangeCursor(System.Windows.Forms.Cursors.WaitCursor))
{
    ...
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-19T13:32:07.257

我不会称之为虐待。对我来说，这更像是一种幻想的 RAII 技术。人们一直在将这些用于监视器之类的东西。

# c# - 解析从旧版 ASP 应用程序生成的 HTML 以创建 ASP.NET 2.0 页面

> ID：565264
> 
> 赞同：0
> 
> 时间：2009-02-19T13:19:03.417
> 
> 标签：c#, .net, python, html

我的一个朋友正在研究一个很好的解决方案来生成 aspx 页面，而不是从旧的 asp 应用程序生成的 html 页面。

这个想法是运行遗留应用程序，捕获 html 输出，使用一些工具（比如 HtmlTidy）清理 html 并将其解析/转换为 aspx，（使用 Xslt 或自定义工具），以便现有的 html 元素、div、图像、样式等被巧妙地转换为 aspx 页面（太多了；））。

任何现有的工具/脚本/实用程序可以做同样的事情吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-19T15:02:40.300

这就是你要做的。

1.  定义旧版应用程序应该做什么。写下获取页面、发布表单、导航等的场景。

2.  为各种场景编写类似单元测试的脚本。

3.  使用 Python [HTTP 客户端库](http://docs.python.org/library/httplib.html)在您的各种脚本中使用旧版应用程序。

4.  如果您的脚本有效，那么您 (a) 真正了解旧版应用程序，(b) 可以让它做它应该做的各种事情，并且 (c) 您可以可靠地捕获 HTML 响应页面。

5.  更新您的脚本以捕获 HTML 响应。

你有页面。现在您可以考虑您的 ASPX 页面需要什么。

*   手动编辑 HTML 以使其成为 ASPX。

*   编写一些使用[Beautiful Soup](http://www.crummy.com/software/BeautifulSoup/)将 HTML 转换为适合 ASPX 的形式的东西。这可能是用标签替换文本或`<asp:...`标签。

*   从 HTML 中创建一些其他更有用的数据结构——一种反映页面结构和含义的数据结构，而不仅仅是 HTML 标记。从那个更有用的结构生成 ASPX 页面。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-20T03:56:13.077

刚刚发现 HTML 敏捷包足够有用，因为他们比 python 更了解 C#。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-11-03T00:13:31.693

我知道这是一个老问题，但在类似的情况下（需要在 .NET 框架中显示的 50k+ 旧 ASP 页面），我做了以下事情。

1.  创建了一个重写引擎（HttpModule），它捕获所有传入的请求并查找来自旧站点的任何内容。

2.  （在一个单独的类中 - 保持井井有条！）使用 WebClient 或 HttpRequest 等打开与旧服务器的连接并下载呈现的 HTML。

3.  使用 HTML 敏捷工具包（**非常**漂亮）来提取我感兴趣的内容——在我们的例子中，如果一个带有“bdy”类的 div，它总是在里面。

4.  把它扔到一个缓存中——在这个例子中是一个 SQL 表。

每次命中都会检查缓存，然后 a) 检索页面并构建缓存条目，或者 b) 仅从缓存中获取页面。

5.  专门为显示遗留内容而构建的 aspx 页面接收重写请求，并在 asp 文字控件内显示来自遗留页面的相关内容。

缓存是为了提高性能 - 因为对给定页面的第一个请求至少有两次点击 - 一个从浏览器到新服务器，一个从新服务器到旧服务器 - 我将可缓存数据存储在新服务器上，所以后续请求不必返回旧服务器。我们还缓存图像、css、脚本等。

当您必须处理表单、cookie 等时，它会变得混乱，但这些都可以存储在您的缓存中，并在必要时通过每个请求传递到旧服务器。我还存储从旧服务器返回的内容到期日期和其他标头，并确保在呈现缓存页面时将它们传递回浏览器。只要记住尽可能采用与内容无关的方法。您正在有效地构建一个页面内 Web 代理，让 IIS 以它想要的方式呈现旧的 ASP，并操纵输出。

工作得很好——我的所有旧页面都在我们的 ASP.NET 应用程序中无缝工作。这为我们节省了一年的开发时间，如果我们必须接触每个遗留的 asp 页面，这将是必需的。

祝你好运！

# html - 用 sed 格式化 html

> ID：565268
> 
> 赞同：1
> 
> 时间：2009-02-19T13:19:56.317
> 
> 标签：html, sed

如何使用 sed 在每个与表相关的标记之前在 html 文件中插入换行符？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-19T13:36:48.010

```
sed -e "s/<\\(表\\|td\\|tr\\)/\\
<\\1/gi"

```

添加您感兴趣的其他元素名称。也不是 100% 完美：它不能满足所有 HTML 怪异，但是 sed 永远不够。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-19T13:45:32.340

匹配开始和结束标签：

```
sed "s/\(<\/\?\(table\|tr\|td\)\)/\n&/gi" 
```

仅打开标签：

```
sed "s/\(<\(table\|tr\|td\)\)/\n&/gi" 
```

仅结束标签：

```
sed "s/\(<\/\(table\|tr\|td\)\)/\n&/gi" 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-19T13:35:44.313

这应该是一个基本的解决方案

```
sed -s "s/<\(\/\?\)\(t\)/\n<\1\2/gi" 
```

不是 100% 完美，因为它会忽略 col、colgroup 并捕获 telytype 标签，但您可能没有使用这些标签。

# java - 使用 Javadoc 和 Ant 测量文档覆盖率

> ID：565272
> 
> 赞同：5
> 
> 时间：2009-02-19T13:20:47.733
> 
> 标签：java, ant, javadoc

我参与了一个项目，其中公共 API 文档是一个明确的可交付成果。为了确保发布满足这个要求，如果文档覆盖率太低，我想确保我的 Ant 构建文件中的发布目标失败。

至少，每个具有公共或受保护访问权限的标识符都应具有适当的 Javadoc 标记和描述。例如，公共方法`@param`的每个参数都应该有一个标签，`@return`如果返回类型不是`void`，则应该有一个标签`@throws`，每个异常都有一个标签，以及单行描述。

我目前有使用 Cobertura 的 JUnit 代码覆盖率报告和故障条件，因此类似于文档的内容将是完美的。但是，如果无法检测到故障情况，则报告是合理的替代品。

文档**必须**采用 Javadoc 格式。没有其他格式（包括 Doxygen）是可接受的。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-19T13:36:37.480

[Checkstyle](http://checkstyle.sourceforge.net/)可以做到这一点。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-19T13:28:01.757

我不知道这样的工具，但我认为 Doxygen 可以生成描述代码结构的 XML 文件以及注释。您可以编写一个脚本，对其进行一些简单的测试并找到未记录的方法/参数/返回值/等。

# silverlight - Expression Blend 2 中的启动错误

> ID：565277
> 
> 赞同：0
> 
> 时间：2009-02-19T13:22:23.410
> 
> 标签：silverlight

在 Expression Blend 2 中按 F5/构建任何 Silverlight 项目时出现异常错误：

启动错误

```
Could not start ""
due to the following error: System.ComponentModel.Win32Exception: The 
system cannot find the file specified
at System.Diagnostics.Process.StartWithShellExecuteEx(ProcessStartInfo 
startInfo)
at System.Diagnostics.Process.Start()
at System.Diagnostics.Process.Start(ProcessStartInfo startInfo)
at Microsoft.Expression.Project.ExecutableProjectBase.Execυte() 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-19T13:50:47.553

谷歌搜索似乎表明它可能是一个错误配置的开发服务器。

这是一个[混合配置器](http://blogs.msdn.com/expression/archive/2007/05/29/working-with-visual-studio-code-name-orcas-and-expression-blend.aspx)

这是让[我去的帖子](http://silverlight.net/forums/p/2628/7054.aspx)

如果这没有帮助，请尝试以下操作：

1.  在您的 Web 应用程序的属性页中删除 Silverlight 项目引用，重新构建，再次添加它。
2.  确保您的 Web 应用程序正在运行的虚拟目录或其他路径（例如项目 URL： [http://localhost/mysilverlightapp](http://localhost/mysilverlightapp)）实际上可以让您访问它。如果没有，请点击“创建虚拟目录”。看看现在有没有。
3.  检查带有 silverlight 控件的页面是否具有正确的 Silverlight dll 文件名。

# objective-c - 将 NSString 转换为无符号字符 *

> ID：565280
> 
> 赞同：1
> 
> 时间：2009-02-19T13:24:12.500
> 
> 标签：objective-c, iphone

我正在尝试使用具有以下签名的函数来签署 HTTP 请求：

```
extern void hmac_sha1(const unsigned char *inText, int inTextLength, unsigned char* inKey, const unsigned int inKeyLength, unsigned char *outDigest); 
```

这是我写的使用它的方法：

```
- (NSString *)sign: (NSString *)stringToSign {
    NSString *secretKey = @"xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx";
    const unsigned char *inText = (unsigned char *)[stringToSign UTF8String];
    int inTextLength = [stringToSign length];
    unsigned char *inKey = (unsigned char *)[secretKey UTF8String];
    const unsigned int inKeyLength = (unsigned int)[secretKey length];
    unsigned char *outDigest;

    hmac_sha1(inText, inTextLength, inKey, inKeyLength, outDigest);
    NSString *output = [NSString stringWithUTF8String:(const char *)outDigest];

    return output;
} 
```

问题是我确定这不是我应该进行这种转换的方式，因为在这个`hmac_sha1`函数内部我得到了一个`EXC_BAD_ACCESS`异常。

由于我是 Objective-C 的新手并且几乎没有 C 的经验（惊喜！）我真的不知道要搜索什么。关于如何开始解决这个问题的任何提示？

提前致谢！

[顺便说一句，我在 stackoverflow 中](https://stackoverflow.com/questions/476455/is-there-a-library-for-iphone-to-work-with-hmac-sha-1-encoding/476513)得到了这个函数的参考。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-19T14:07:55.360

看起来问题不在于铸造，而在于`outDigest`. 第五个参数`hmac_sha1`应该指向一个已经分配的大小为 20 字节的缓冲区（我认为）。

如果你改变说

```
unsigned char *outDigest; 
```

说

```
#define HMACSHA1_DIGEST_SIZE 20
void *outDigest = malloc(HMACSHA1_DIGEST_SIZE); 
```

那应该可以让你通过里面的崩溃`hmac_sha1`。

然后你遇到了将数据`outDigest`转换为`NSString`. 看起来`hmac_sha1`会将 20 个字节的随机数据放在`outDigest`，而不是一个以 null 结尾的 UTF-8 字符串，因此`stringWithUTF8String:`无法正常工作。如果您必须返回一个，您可能想要使用类似的东西`NSString`：

```
NSString *output = [[NSString alloc] initWithBytesNoCopy:outDigest
                                     length:HMACSHA1_DIGEST_SIZE
                                     encoding:NSASCIIStringEncoding
                                     freeWhenDone:YES]; 
```

我认为这不是`NSString`真正适合摘要的类型，因此如果可以的话，可能值得更改您的方法以返回 an `NSData`。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-19T15:59:15.757

这不是您的问题的一部分，但它仍然是一个错误，您不应该使用它`-length`来获取 UTF8 字符串的字节数。该方法返回字符串中的 Unicode 字符数，而不是字节数。你想要的是`-lengthOfBytesUsingEncoding:`.

```
NSUInteger byteCount = [stringToSign lengthOfBytesUsingEncoding:NSUTF8StringEncoding]; 
```

另请注意，结果不考虑终止 NULL 字符。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-19T13:34:27.500

你确定你不需要`outDigest`在调用之前分配一些内存`hmac_sha1`吗？由于您传递的是指针，而不是指向指针的指针，因此无法在例程内部分配内存。

# unit-testing - 根据今天的日期进行日期处理的单元测试代码

> ID：565289
> 
> 赞同：21
> 
> 时间：2009-02-19T13:27:28.623
> 
> 标签：unit-testing, datetime, language-agnostic, dependency-injection

当代码根据当前日期处理日期时，测试应涵盖边缘情况，例如闰年以及更频繁的月份和年份边界。

`DateTime.Now`在我们的代码中，我们总是使用（在我们的例子中是.NET）在我们的类中深入获取当前日期。

你如何对这样的代码进行单元测试？

这是[依赖注入](http://martinfowler.com/articles/injection.html)变得非常有用的地方吗？

## 编辑

这是一个小问题，但显然 Typemock 的下一个版本将允许伪造`DateTime.Now`

[https://blog.typemock.com/2009/05/mockingfaking-datetimenow-in-unit-tests.html](https://blog.typemock.com/2009/05/mockingfaking-datetimenow-in-unit-tests.html)

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-02-19T13:33:57.127

> 在我们的代码中，我们总是使用 DateTime.Now（在我们的例子中是 .NET）提取当前日期。你如何对这样的代码进行单元测试？

这是一种依赖，而且是一种非确定性的依赖。您需要将代码的责任进一步划分。

前：

*   有一些代码使用当前日期时间来执行 X。

后：

*   应该有一些代码负责获取当前日期时间。
*   应该有一些代码使用日期时间来执行 X。

这两组代码不应相互依赖。

这种分离依赖的模式也适用于其他情况（数据库、文件系统等）。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-02-19T13:33:43.570

使用 DI 注入“当前日期和时间”肯定是矫枉过正。我宁愿重构代码以在任意日期运行。也就是说，我会更改`function calculateRevenue()`为`function calculateRevenueOn(datetime date)`. 如果您需要计算除当前日期之外的某些日期，这更容易测试和使用。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2009-02-19T13:37:45.090

我使用了 Oren Eini（又名 Ayende Rahien）在他的 blogspots [Dealing with time in](http://ayende.com/Blog/archive/2008/07/07/Dealing-with-time-in-tests.aspx) testing 中讨论的非常务实的方法。

有一个像这样的静态类：

```
public static class SystemTime
{
    public static Func<DateTime> Now = () => DateTime.Now;
} 
```

你的代码变成：

```
Entity.LastChange = SystemTime.Now(); 
```

你的测试会变成：

```
SystemTime.Now = () => new DateTime(2000,1,1);
repository.ResetFailures(failedMsgs); 
SystemTime.Now = () => new DateTime(2000,1,2);
var msgs = repository.GetAllReadyMessages(); 
Assert.AreEqual(2, msgs.Length); 
```

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2009-02-19T13:33:16.520

始终将核心日期处理逻辑（根据我的经验，通常很容易为此目的而隔离）放入以日期为参数的单独方法中。

然后，在您的生产代码中，您可以调用它们并将当前日期作为参数提供给它们，并且仍然在单元测试中根据您的内心内容测试边缘案例。

顺便说一句，我发现非常密集地测试日期逻辑对于边缘情况非常重要。它消除了（可能是灾难性的，参考 Zune）错误，否则您永远不会发现这些错误。除了你提到的那些，夏令时开关也可能有问题。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-02-19T13:28:30.960

你可以制作一个模拟 DateTime.Now 的模拟对象

这里有一个例子，其中 DateTime.Now 被嘲笑： http: [//geekswithblogs.net/AzamSharp/archive/2008/04/27/121695.aspx](http://geekswithblogs.net/AzamSharp/archive/2008/04/27/121695.aspx)

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-02-19T13:36:37.510

你已经给出了答案。您可以围绕 datetime 函数编写一个小型包装类，然后可以将其注入需要获取当前日期的类中。将 DateTime.Now 替换为对包装器对象的调用。

然后，在您的测试中，您可以注入一个存根或模拟对象，为您提供所需的日期。

另一种解决方案可能是，根据您的代码的工作方式，只需将日期作为参数传递，而不是隐藏对 datetime.Now 的调用。这使您的代码更具可重用性，因为它可以在比当前日期更多的时间上工作

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-02-19T13:41:19.463

```
public interface ITimeProvider {
    DateTime Now { get; }
}

public class SystemTimeProvider : ITimeProvider {
    public virtual DateTime Now { get { return DateTime.Now; } }
}

public class MockTimeProvider : ITimeProvider {
    public virtual DateTime Now { get; set; }
}

public class ServiceThatDependsOnTime {
    protected virtual ITimeProvider { get; set; }
    public ServiceThatDependsOnTime(ITimeProvider timeProvider) {
        TimeProvider = timeProvider;
    }
    public virtual void DoSomeTimeDependentOperation() {
        var now = TimeProvider.Now;
        //use 'now' in some complex processing.
    }
}

[Test]
public virtual void TestTheService() {
    var time = new MockTimeProvider();
    time.Now = DateTime.Now.AddDays(-500);
    var service = new ServiceThatDependsOnTime(time);
    service.DoSomeTimeDependentOperation();
    //check that the service did it right.
} 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-19T13:34:10.450

依赖注入可以解决这个问题，是的。

例如，您将创建一个带有方法的 IDateTimeProvider 接口：GetDate()。在您的生产代码类中，您将实现返回 DateTime.Now。

当单元测试时，正如 Natrium 建议的那样，您可以用一个模拟对象替换它，一个返回特定日期进行测试的对象。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2014-01-20T20:04:54.160

为什么不使用假货？使用 Visual Studio 尽可能简单。只需向 System 添加一个假程序集，将 ShimsContext 添加到您的测试中，

```
using (ShimsContext.Create())
{ 
```

并设置 DateTime.Now 以返回特定值：

```
System.Fakes.ShimDateTime.NowGet = () => new DateTime(2000, 1, 1); 
```

这种方法确保对 DateTime.Now 的每次调用都被重定向到您的代码，因此您不必注入任何东西来获取当前时间（这应该是非常直接的），也不需要全局的、可写的变量。

# ms-word - 如何创建一个两列的 Word 文档，其中每一列都是不同的文件？

> ID：565305
> 
> 赞同：-1
> 
> 时间：2009-02-19T13:31:06.587
> 
> 标签：ms-word, ms-office

是否可以创建一个两列 Word 文档，每列显示一个不同的文件？

我想打印不同语言的文本，原文和翻译，并排学习一门外语，但我不知道该怎么做。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-19T14:00:18.577

当您想在 Word 中自动执行某些操作时，一种技术是使用 Word 的宏记录器来记录您自己执行相同的任务（或类似的任务）。这导致 VBA 代码非常接近您的需要。获取该代码并对其进行调整以在您的程序中使用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-19T14:15:26.090

创建一个包含两列的表格，将一个文档粘贴到左列，另一个粘贴到右列。

# flash - 使用 Flash 进行服务器端 PDF 打印？

> ID：565308
> 
> 赞同：2
> 
> 时间：2009-02-19T13:32:29.877
> 
> 标签：flash

有谁知道可以将网页打印/保存为 PDF 的服务器端技术，包括嵌入式 Flash 组件？

本质上，我想模拟客户端打印到 PDF 功能，但在服务器上实现“下载 PDF”链接，但我不相信 HTML 到 PDF 解决方案支持 Flash。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-19T13:42:11.880

也许......如果你可以在服务器上打开一个窗口。试试这个：获取[SWT](http://www.eclipse.org/swt/)（它包含一个浏览器组件）。使用[浏览器片段](http://www.eclipse.org/swt/snippets/)确保它可以显示 Flash（有关如何使插件工作的详细信息，请参阅下面的常见问题解答）。如果是这样，那么[您可以使用 JavaScript 来打印](http://dev.eclipse.org/newslists/news.eclipse.platform.swt/msg29814.html)：

```
browser.execute("window.print();"); 
```

在 Unix 上，这应该足够了。在 Windows 上，您必须安装 PDF 打印机驱动程序并使用 UI 自动化工具来按下打印对话框的“确定”按钮。

有关如何让浏览器小部件在各种环境中工作的详细信息，请参阅[SWT 常见问题解答。](http://www.eclipse.org/swt/faq.php)

如果可行，您可以尝试创建外壳但不要打开它（因此屏幕上不会弹出窗口）。打印*应该*不会在屏幕上实际绘制任何东西，但你必须做一些实验。

我使用这项技术通过按一个按钮来创建我们 web 应用程序的所有页面的屏幕截图（打开 URL，等待它加载，复制主要可绘制对象，将图像保存到文件）。

[或者，您可以使用 ActiveX 网桥通过JDIC](https://jdic.dev.java.net/)将 Internet Explorer 嵌入到 Java 应用程序中。然后，该应用程序可以等待远程打印请求。

[编辑] 或者，如果您有一个缺乏 Flash 支持的 HTML->PDF 解决方案，只需在嵌入式浏览器中打开 Flash 元素。将浏览器小部件的屏幕截图保存为图像并修改 HTML 以使用图像而不是真正的 Flash（搜索`embed`标签并将其替换为`img`）。

[EDIT2] 如果 SWT 不起作用，请查看[QtJambi](http://www.qtsoftware.com/products)（其中包含 WebKit）。请注意，QtJambi 目前正在迁移到 LGPL。不过，我不确定 Flash 插件是否适用于 WebKit。

# sql-server-2005 - 数据库设计问题

> ID：565313
> 
> 赞同：1
> 
> 时间：2009-02-19T13:33:24.897
> 
> 标签：sql-server-2005, database-design, entity-relationship

我正在尝试为服务器和数据库清单设计一个数据库，并且我正在寻找一个好的数据库设计。我们有用于服务器集群、独立服务器和数据库的表。我想在数据库中表示以下关系：

从集群到服务器的一对多关系。
从数据库到集群/服务器的一对多关系。

困难在于第二种关系，因为集群和服务器位于不同的表中，并且集群由服务器组成。代表这种关系的最佳方式是什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-19T13:53:45.020

听起来你在你对情况的关系视图中有这个。

```
Cluster : name, other attributes of cluster

Server : name, optional FK to cluster, other attributes of a server

Database : name, (FK to cluster OR FK to server) 
```

问题是你有一个更复杂的现实世界情况，关系技术不能清楚地反映这种情况。

```
Host -- an abstract superclass for places a database can run.

Cluster (extends Host) : name, etc.

Server (extends Host) : name, optional FK to cluster.

Database : FK to Host 
```

您有多种选择来处理这种“子实体”问题。

1.  将主机、集群和服务器折叠到一个表中。这导致主机（作为集群）和主机（作为服务器）之间的递归关系。这有点烦人，但它确实为主机、集群和服务器创建了一个表。结果表有很多空值（集群行使用一组列，服务器行使用一组不同的列。）您必须添加一列来区分主机的子实体。

2.  将主机信息下推到集群和服务器中。当您在 Host 表中有很多公共信息，而在 Cluster 或 Server 表中有很少的子类特定信息时，这很有用。Cluster 和 Server 表看起来非常相似（基本上是 Host 的克隆），但有几列不同。

3.  基于主机中的鉴别器在（主机和集群）或（主机和服务器）之间使用连接。虽然相当复杂，但它的扩展性很好，因为所有数据库都加入了主机，并且完整的主机列表是加入服务器的主机和加入集群的主机的联合。

4.  使用数据库中的可选外键字段。这需要加入集群的数据库加上加入服务器的数据库之间的联合，以获得完整的数据库列表。每个数据库可能必须有一个鉴别器，以便您可以区分两个 FK 字段中 NULL 值的各种组合。有四种可能的组合，其中两种是明智的，两种可能是禁止的。尝试简单地使用两个可为空的 FK 通常效果不佳，因此您通常需要一个状态标志来将集群上的数据库与服务器上的数据库与未分配给任何内容的数据库、主机未知的数据库与可能存在的任何其他状态分开相关的。

* * *

## 回答 #2

> 赞同：-2
> 
> 时间：2009-02-19T13:48:20.493

选项 1：在数据库表中有两个字段。一个指服务器，另一个指集群。保持其中之一为空。

选项 2：另一种方法是在集群中也为每个独立服务器添加一个条目，并仅链接到该表。

选项 1 真的不是最干净的解决方案（我同意评论），所以选择选项 2 :)

# java - Java EE 容器上的 Clover

> ID：565317
> 
> 赞同：2
> 
> 时间：2009-02-19T13:34:13.210
> 
> 标签：java, jboss, code-coverage, instrumentation, clover

我想在生产环境中运行[Atlassian Clover](http://www.atlassian.com/software/clover/default.jsp)（我没有开销问题）。有没有人有这方面的经验，或者你能指导我怎么做吗？

我的目标是获得基于真实用户操作的 clover 报告。我正在使用 JBoss + JDK 1.5

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-21T06:12:15.150

终于找到答案了，谢谢大家。在创建 Clover DB（cmd / 或 eclipse 集成）之后，在启动我的应用服务器时，我添加以下参数 -Djboss.shutdown.forceHalt=false -Dclover.initstring.basedir=/coverage.db 它会完成这项工作

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-23T13:31:16.493

您可以将 clover 构建（以及检测期间生成的 coverage.db 文件）部署到您的服务器，添加一堆特定于 clover 的 java 选项来设置它，然后收集结果，使用 clover 合并工具将它们合并并生成报告。有关详细说明，请参阅[Clover Wiki](http://confluence.atlassian.com/display/CLOVER/Working+with+Distributed+Applications)。

请注意，默认情况下，clover 会在进程终止时转储覆盖率数据——您可能需要对如何使其定期发生进行一些研究。调查`-flushpolicy`和`-flushinterval`选择。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-02T18:56:56.823

一般的策略是在编译 Web 应用程序时使用 Clover（或 Cobertura 或类似工具）。如果您使用 maven 进行构建，则可以使用 cobertura 插件：

[http://mojo.codehaus.org/cobertura-maven-plugin/instrument-mojo.html](http://mojo.codehaus.org/cobertura-maven-plugin/instrument-mojo.html)

使用 cobertura:instrument 目标轻松添加此内容。然后像以前一样将生成的战争放到 JBoss 中。

您可能还对 Glassbox 感兴趣：

[http://www.glassbox.com/glassbox/Home.html](http://www.glassbox.com/glassbox/Home.html)

它不会生成代码覆盖率，而是为您提供有关正在发生的事情的高级报告，并可以告诉您可能在哪里遇到瓶颈。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-02-20T08:27:31.333

我已经很久没有使用三叶草了……但我确实使用 cobertura ( [http://cobertura.sourceforge.net/faq.html](http://cobertura.sourceforge.net/faq.html) ) 进行代码覆盖。查看 cobertura 的常见问题解答，它确实适用于 JBoss。

# wpf - 如何将 XAML/Codebehind 对动态嵌入为 StackPanel 的子项？

> ID：565318
> 
> 赞同：0
> 
> 时间：2009-02-19T13:34:22.243
> 
> 标签：wpf

我有一个名为“MainContent”的 StackPanel。

我可以像这样用 UIElements 动态填充它：

```
TextBlock textBlock = new TextBlock();
textBlock.Text = String.Format("This is text");
textBlock.Background = new SolidColorBrush(Colors.Beige);
MainContent.Children.Add(textBlock);

Button button = new Button();
button.Content = "This is a button";
MainContent.Children.Add(button); 
```

但我想超越它并用 XAML/Codebehind 对（例如页面或窗口）填充它：

```
Type type = this.GetType();
Assembly assembly = type.Assembly;
Window window = (Window)assembly.CreateInstance(String.Format("{0}.{1}", type.Namespace, "Test1"));
MainContent.Children.Add(window); 
```

但是上面的代码抱怨我不能添加一个“窗口到视觉”。我当然可以做 window.ShowDialog() 但它在我的主窗口之外。我希望将 Test1 窗口*嵌入*到我的应用程序中。

我怎样才能做到这一点？

**补充：**主要问题是：如何让 Window （或 Page）充当 UIElement 以便我可以将它们动态嵌入 StackPanels 等。目前正在查看**XamlLoader**，任何有经验的人？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-19T13:39:00.140

我不知道这是否可能。但是，与其用一个窗口来填充面板，不如用窗口的根元素来填充它。您将获得窗口的所有内容和价值，而无需使用不需要的 chrome。

更新：您可以通过 Dependency 属性获取窗口的根元素`Content`

```
 Window w;
    object rootElement = w.Content; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-19T15:10:06.380

最简单的方法是让你的 XAML/代码从 UserControl 继承 - 然后一切都会正常工作

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-19T13:39:52.073

你试过这个吗？

```
MainContent.Children.Add(window.Content); 
```

# licensing - 软件保护将其数据存储在哪里？

> ID：565322
> 
> 赞同：2
> 
> 时间：2009-02-19T13:35:19.057
> 
> 标签：licensing, copy-protection

我正在为我的公司探索软件保护方案。果然，有很多替代方案，几乎所有替代方案都提供了限制：

1.  使用次数（执行）
2.  天数

现在，如果我想一想，计算机中一定有*某个*地方存储了“应用程序已使用的次数”或“已使用的天数”。在这里，我假设使用这些机制之一保护的应用程序不需要它以管理权限运行。而且我知道具有正常用户权限的应用程序不能修改影响其他用户的地方。这意味着如果用户 A 的应用程序过期，它仍然会为用户 B 运行（这看起来很愚蠢）。我想知道这些方案可能会将其信息隐藏在什么地方以使其发挥作用？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-19T14:37:29.110

他们只是将其隐藏在难以找到的地方，例如应用程序的数据文件或注册表深处的某个地方。因此，对于定时限制（运行到 4 月 4 日），您可以使用文件的日期或在注册表中的某处写入安装日期（不是通常的位置；他们将其写在驱动程序部分的奇数键下方，您有很多随机 64 个字符键）。然后可以额外保护这些密钥（删除任何人的写访问权限）。

但是，“次数”限制需要写入密钥，因此“有限访问”方案不起作用（或不利于保护）。这些地方没有保护，但没有人知道信息存储在哪里。一个好地方是在一个巨大的数据文件中间的某个地方：这使得破解者很难找到，即使他们发现计数器必须在那个文件的某个地方。

也就是说，大多数好的软件之所以卖得好是因为它好，而不是因为它受到保护。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-19T13:47:55.360

我相信可靠地做这种事情的唯一方法是某种客户端-服务器方案。例如，您的公司有一个许可证服务器，客户端的软件每次运行时都会查询服务器。当然，这需要一个有效的互联网连接，这并不总是可用的......

当然你可以写一些东西到注册表，但没有什么能阻止用户修改它。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-19T13:48:01.303

*“而且我知道具有正常用户权限的应用程序不能修改影响其他用户的地方”* - 这句话是您误解的地方。

应用程序可以将此类信息存储在文件中、注册表中（在 Windows 下），甚至可能存储在它自己的代码或数据文件中。

例如，用户可以保存一个文本文件，以便其他用户可以或可以阅读它。权限可以使事情只对一个用户保密，但代码通常可以自由地使几乎任何操作系统上的任何用户都可以读取文件。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-19T13:54:08.170

我知道一些保护机制至少需要以管理权限运行一次（例如在安装期间）。我假设他们在非用户特定的位置（例如在 HKEY_LOCAL_MACHINE 或 ProgramFiles 甚至 WinDir 下）设置了一个位置，并且还为（经过身份验证的）用户设置了对该位置的写入权限。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-19T13:41:17.060

> 我想知道这些方案可能会将其信息隐藏在什么地方以使其发挥作用？

至少在 Windows 下，注册表将是所有用户都可以访问的公共数据存储。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-01-19T02:43:23.740

软件保护将计时信息存储到注册表或文件中。您可以使用注册表和文件监视器等程序来快速了解从注册表或文件中读取此数据的尝试。另一种方法是通过逆向工程。通过使用调试器，您可以在用于此范围的众所周知的 win API 上放置断点，例如用于从注册表读取数据的 RegOpenKeyEx/RegQueryValueEx 和用于从文件读取信息的 CreateFile/ReadFile/GetFileSize 等。您应该考虑在 MSDN 上阅读这些 API 的文档。

# spring - 单元测试环境中的Spring bean重新定义

> ID：565334
> 
> 赞同：53
> 
> 时间：2009-02-19T13:38:38.160
> 
> 标签：spring, unit-testing, spring-test

我们将 Spring 用于我的应用程序目的，并将 Spring 测试框架用于单元测试。不过我们有一个小问题：应用程序代码从类路径中的位置列表（XML 文件）加载 Spring 应用程序上下文。但是当我们运行单元测试时，我们希望一些 Spring bean 是模拟的，而不是成熟的实现类。此外，对于某些单元测试，我们希望一些 bean 成为模拟，而对于其他单元测试，我们希望其他 bean 成为模拟，因为我们正在测试应用程序的不同层。

所有这一切意味着我想重新定义应用程序上下文的特定 bean 并在需要时刷新上下文。在执行此操作时，我只想重新定义位于一个（或多个）原始 XML bean 定义文件中的一小部分 bean。我找不到一个简单的方法来做到这一点。人们一直认为 Spring 是一个对单元测试友好的框架，所以我一定在这里遗漏了一些东西。

你有什么想法吗？

谢谢！

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-02-19T15:31:22.853

我会`TestClass`为 spring bean.xml 的位置提出一个自定义和一些简单的规则：

```
@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration(locations = {
    "classpath*:spring/*.xml",
    "classpath*:spring/persistence/*.xml",
    "classpath*:spring/mock/*.xml"})
@Transactional
@TestExecutionListeners({
    DependencyInjectionTestExecutionListener.class,
    TransactionalTestExecutionListener.class,
    DirtiesContextTestExecutionListener.class})
public abstract class AbstractHibernateTests implements ApplicationContextAware {

    /**
     * Logger for Subclasses.
     */
    protected final Logger log = LoggerFactory.getLogger(getClass());

    /**
     * The {@link ApplicationContext} that was injected into this test instance
     * via {@link #setApplicationContext(ApplicationContext)}.
     */
    protected ApplicationContext applicationContext;

    /**
     * Set the {@link ApplicationContext} to be used by this test instance,
     * provided via {@link ApplicationContextAware} semantics.
     */
    @Override
    public final void setApplicationContext(
            final ApplicationContext applicationContext) {
        this.applicationContext = applicationContext;
    }
} 
```

如果`mock-bean.xml`在指定位置有，它们将覆盖`bean.xml`“正常”位置中的所有“真实”文件 - 您的正常位置可能会有所不同。

但是......我永远不会混合模拟和非模拟bean，因为当应用程序变老时很难追踪问题。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-02-19T23:08:14.110

spring 被描述为测试友好的原因之一是因为它可能很容易在单元测试中只*添加新*的或模拟的东西。

或者，我们已经成功地使用了以下设置，我认为它非常接近您想要的，我*强烈*推荐它：

对于在不同上下文中需要不同实现的所有 bean，请切换到基于注释的布线。你可以让其他人保持原样。

实现以下一组注解

```
 <context:component-scan base-package="com.foobar">
     <context:include-filter type="annotation" expression="com.foobar.annotations.StubRepository"/>
     <context:include-filter type="annotation" expression="com.foobar.annotations.TestScopedComponent"/>
     <context:exclude-filter type="annotation" expression="org.springframework.stereotype.Repository"/>
 </context:component-scan> 
```

然后，您使用@Repository 注释您的*实时*实现，使用@StubRepository 注释您的*存根*实现，任何应该仅使用@TestScopedComponent 出现在单元测试夹具中的代码。您可能会遇到需要更多注释的情况，但这是一个很好的开始。

如果你有很多 spring.xml，你可能需要创建一些新的 spring xml 文件，这些文件基本上只包含组件扫描定义。您通常只需将这些文件附加到您的常规 @ContextConfiguration 列表中。这样做的原因是因为您经常以不同的上下文扫描配置结束（相信我，如果您正在进行网络测试，您*将*至少再添加 1 个注释，这会产生 4 个相关组合）

然后你基本上使用

```
@ContextConfiguration(locations = { "classpath:/path/to/root-config.xml" })
@RunWith(SpringJUnit4ClassRunner.class) 
```

请注意，此设置*不允许*您交替组合存根/实时数据。我们试过这个，我认为这会导致一团糟，我不推荐任何人；）我们要么连接全套存根，要么提供全套实时服务。

在依赖关系通常非常大的东西附近测试 gui 时，我们主要使用自动连接的存根依赖关系。在更干净的代码区域，我们使用更常规的单元测试。

在我们的系统中，我们有以下用于组件扫描的 xml 文件：

*   用于常规网络制作
*   仅用于使用存根启动 web
*   用于集成测试（在junit中）
*   用于单元测试（在junit中）
*   用于 selenium web 测试（在 junit 中）

这意味着我们总共有 5 种不同的系统范围配置，我们可以使用它们来启动应用程序。因为我们只使用注解，所以即使是我们想要连接的单元测试，spring 也足够快地自动连接。我知道这是非传统的，但它真的很棒。

Out 集成测试使用完整的实时设置运行，有一次或两次我决定变得*非常*务实，并希望拥有 5 个实时布线和一个模拟：

```
public class HybridTest {
   @Autowired
   MyTestSubject myTestSubject;

   @Test
   public void testWith5LiveServicesAndOneMock(){
     MyServiceLive service = myTestSubject.getMyService();
     try {
          MyService mock = EasyMock.create(...)
          myTestSubject.setMyService( mock);

           .. do funky test  with lots of live but one mock object

     } finally {
          myTestSubject.setMyService( service);
     }

   }
} 
```

我知道测试纯粹主义者会为此而全力以赴。但有时它只是一个非常实用的解决方案，当替代方案真的很丑陋时，它会变得非常优雅。同样，它通常在那些 gui 附近的地区。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2013-10-31T22:13:35.443

[请参阅带有 @InjectedMock 注释的](http://samerabdelkafi.wordpress.com/2013/07/01/junit-test-with-mockito-and-spring/#comment-370)本 教程

它为我节省了很多时间。你只需使用

```
@Mock
SomeClass mockedSomeClass

@InjectMock
ClassUsingSomeClass service

@Before
public void setUp() {
    MockitoAnnotations.initMocks(this);
} 
```

你所有的问题都解决了。Mockito 将用 mock 替换 spring 依赖注入。我自己用过，效果很好。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-06-16T07:39:51.520

这里列出了一些非常复杂和强大的解决方案。

但是有一种**FAR，FAR 更简单**的方法来完成 Stas 所要求的，除了测试方法中的一行代码之外，它不涉及修改任何内容。它适用于单元测试和 Spring 集成测试，适用于自动装配的依赖项、私有和受保护的字段。

这里是：

```
junitx.util.PrivateAccessor.setField(testSubject, "fieldName", mockObject); 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-02-19T13:44:09.113

简单的。您为单元测试使用自定义应用程序上下文，或者根本不使用，而是手动创建和注入 bean。

在我看来，您的测试可能有点过于广泛。单元测试是关于测试，嗯，单元。Spring bean 是一个很好的单元示例。你不应该需要一个完整的应用程序上下文。我发现如果你的单元测试太高级以至于你需要数百个 bean、数据库连接等，你有一个非常脆弱的单元测试，它将在下一次更改时中断，将难以维护，而且确实是没有增加很多价值。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-02-19T14:43:53.947

您还可以编写单元测试以完全不需要任何查找：

```
@ContextConfiguration(locations = { "classpath:/path/to/test-config.xml" })
@RunWith(SpringJUnit4ClassRunner.class)
public class MyBeanTest {

    @Autowired
    private MyBean myBean; // the component under test

    @Test
    public void testMyBean() {
        ...
    }
} 
```

这提供了一种将真实配置文件与测试配置文件混合和匹配的简单方法。

例如，当使用 hibernate 时，我可能将 sessionFactory bean 放在一个配置文件中（用于测试和主应用程序），并将 dataSource bean 放在另一个配置文件中（可能使用 DriverManagerDataSource 到 in-内存数据库，另一个可能使用 JNDI 查找）。

但是，一定要注意[@cletus 的](https://stackoverflow.com/questions/565334/spring-beans-redefinition-in-unit-test-environment/565358#565358)警告 ;-)

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-02-19T14:02:34.967

您可以在测试应用程序上下文中使用[导入](http://static.springframework.org/spring/docs/2.5.x/reference/beans.html)功能来加载 prod bean 并覆盖您想要的那些。例如，我的 prod 数据源通常是通过 JNDI 查找获取的，但是当我测试时，我使用 DriverManager 数据源，因此我不必启动应用程序服务器进行测试。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-07-24T20:23:30.000

我没有声望点来堆积达菲莫的答案，但我只是想插话并说他对我来说是“正确”的答案。

使用自定义 applicationContext.xml 在单元测试设置中实例化 FileSystemXmlApplicationContext。在该自定义 xml 中，在顶部执行 duffymo 指示的操作。然后声明您的模拟 bean、非 JNDI 数据源等，这将覆盖导入中声明的 id。

对我来说就像一个梦想一样工作。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2016-09-05T13:32:17.710

您不需要使用任何测试上下文（不管是基于 XML 还是基于 Java）。自 Spring boot 1.4 以来，有可用的新注解[`@MockBean`](http://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#boot-features-testing-spring-boot-applications-mocking-beans)引入了对 Spring Bean 的模拟和间谍活动的本机支持。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-02-19T13:47:55.580

也许你可以为你的 bean 使用限定符？您将在单独的应用程序上下文中重新定义要模拟的 bean，并用限定符“test”标记它们。在您的单元测试中，在连接您的 bean 时，始终指定限定符“test”以使用模型。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-06-10T09:33:10.430

我想做同样的事情，我们发现它很重要。

我们使用的当前机制是相当手动的，但它确实有效。

举例来说，您希望模拟出 Y 类型的 bean。我们所做的是每个具有该依赖关系的 bean 都实现一个接口 - “IHasY”。这个界面是

```
interface IHasY {
   public void setY(Y y);
} 
```

然后在我们的测试中我们调用 util 方法...

```
 public static void insertMock(Y y) {
        Map invokers = BeanFactory.getInstance().getFactory("core").getBeansOfType(IHasY.class);
        for (Iterator iterator = invokers.values().iterator(); iterator.hasNext();) {
            IHasY invoker = (IHasY) iterator.next();
            invoker.setY(y);
        }
    } 
```

我不想创建一个完整的 xml 文件只是为了注入这个新的依赖项，这就是我喜欢这个的原因。

如果您愿意创建一个 xml 配置文件，那么可以使用模拟 bean 创建一个新工厂，并使您的默认工厂成为该工厂的父级。然后确保从新的子工厂加载所有 bean。这样做时，子工厂将在 bean id 相同时覆盖父工厂中的 bean。

现在，如果在我的测试中，如果我能以*编程*方式创建一个工厂，那就太棒了。不得不使用 xml 实在是太麻烦了。我正在寻找用代码创建那个子工厂。然后每个测试都可以按照它想要的方式配置它的工厂。这样的工厂没有理由不工作。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2014-02-02T17:39:00.000

[spring-reinject](https://github.com/sgri/spring-reinject)旨在用模拟替换bean。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2015-01-30T10:53:04.027

自 OP 以来，这已经出现：[Springockito](http://www.springockito.org/)

# .net - 比较 .net 1.1 和 .net 2.0 中相同应用程序之间的程序流程

> ID：565357
> 
> 赞同：0
> 
> 时间：2009-02-19T13:43:47.743
> 
> 标签：.net, debugging, .net-2.0, .net-1.1

我正在考虑将我们在这里使用 Visual Studio 2003 / .NET 1.1 开发的应用程序升级到 Visual Studio 2008 / .NET 2.0。

现在我正在测试东西，发现我有一个可重现的情况，其中 .NET 1.1 版本做了它应该做的事情，而 .NET 2.0 版本（相同的代码）最终以无限递归（递归是故意的, 但它应该限制在 2 个级别..)

市场上是否有任何东西可以比较两个正在运行的应用程序的程序流程，例如并排调试器或其他东西，或者我是否必须分别单步执行两个应用程序并尝试手动查找流程/状态的差异？

我很确定要么就是这样，要么会添加很多日志记录代码，但也许有人有一个好主意/提示来追踪这个？

（仅供参考，我目前最好的猜测是它与数据绑定有关，因为 .NET 1.1 和 .NET 2.0 数据绑定之间还有其他 [致命] 差异......）

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-10-01T05:19:22.413

如果您知道递归发生的位置，那么可能有一些放置良好的断点，以及大量使用“Watch”窗口，这样您就可以看到用于决定是否需要再次递归行程的值，并且您应该能够找到他们分歧的地方。

另一种选择是使用 Diff 工具（如[Sourcegear 的 DiffMerge](http://www.sourcegear.com/diffmerge/)）来比较您在两个版本的代码库之间所做的更改。我不知道框架的不同版本会以不同的方式处理相同的代码，所以我敢打赌，不同之处在于您在升级到 2.0 时已修改的代码。

# javascript - 我在哪里可以找到一个好的 JavaScript/HTML AutoSuggest 示例

> ID：565359
> 
> 赞同：4
> 
> 时间：2009-02-19T13:44:11.983
> 
> 标签：javascript, jquery, html

我正在寻找一个 JavaScript/HTML AutoSuggest 输入框的良好示例实现来帮助我入门。我试图实现的将表现得“完全”，就像 stackoverflow 上的标签输入框一样。

如果它有助于我使用 jQuery 来执行 Ajax 请求。

我正在寻找示例来帮助我实现这一点，但是我担心该领域的最佳实践，并且也希望获得意见。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-19T13:45:31.437

呃，[jQuery 自动完成](http://www.ajaxdaddy.com/demo-jquery-autocomplete.html)？还有[一个例子](http://jquery.bassistance.de/autocomplete/demo/)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-19T13:47:24.457

Antonio Lupetti 刚刚在他的文章[Useful Ajax Auto Suggest scripts collection](http://woork.blogspot.com/2009/02/useful-ajax-auto-suggest-scripts.html)中发表了对基于 Javascript 的自动建议脚本的评论。

您可能会在那里找到一些有趣的链接？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-19T13:57:04.980

尝试 YUI 自动完成。效果很好！！[http://developer.yahoo.com/yui/autocomplete/](http://developer.yahoo.com/yui/autocomplete/)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-19T16:45:54.927

我使用brandspankingnew的AutoSuggest（并且很高兴）-> [http://www.brandspankingnew.net](http://www.brandspankingnew.net/archive/2006/08/ajax_auto-suggest_auto-complete.html)

# c++ - 重载、字符串和默认参数

> ID：565360
> 
> 赞同：0
> 
> 时间：2009-02-19T13:44:21.563
> 
> 标签：c++, overloading

重构遗留代码，我遇到了这个函数（伪代码）：

```
int getMessage( char * buffer, int size = 300 ); 
```

哎呀，看看那个等待溢出的缓冲区。所以我想出了一个使用 std::string 的函数，并认为使用函数重载会很好：

```
int getMessage( std::string & buffer ); 
```

到现在为止还挺好。但是当我尝试用字符串*调用函数时：*

```
std::string buffer;
int rc = getMessage( buffer ); 
```

我收到此错误：

```
cannot convert 'std::string' to 'char*' for argument '1' to 'int getMessage(char*, int)' 
```

显然，编译器（GCC 4.1.2）努力将 std::string 转换为 char* 以满足第一个函数的参数列表（使用默认值来满足第二个参数），放弃了，但没有尝试第二个功能...

解决这个问题我不会有问题，但我想知道为什么会失败，以及是否有办法让它按预期工作。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-19T13:52:33.727

它在我的 GCC 4.3.2 上按预期工作，也许你拼错了重载的名称？没有从 std::string 到 char* 的转换，所以编译器选择正确的重载应该没有任何问题。

```
$ cat test.cpp
#include <string>
#include <stdio.h>

int getMessage( char * buffer, int size = 300 )
{
printf("1\n");
return 1;
}

int getMessage( std::string & buffer )
{
printf("2\n");
return 2;
}

int main()
{
std::string buffer;
buffer = "Hello";
int rc = getMessage( buffer );
}

$ g++ test.cpp -Wall -pedantic
test.cpp: In function ‘int main()’:
test.cpp:20: warning: unused variable ‘rc’
$ ./a.out 
2
$ $ g++ -v 2>&1|tail -n1
gcc version 4.3.2 (Ubuntu 4.3.2-1ubuntu12) 
$ 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-19T13:53:47.390

嗯。没有从 std::string 到 char* 的隐式转换，所以这不是你的问题。您确定您的新功能在呼叫现场可见吗？

你说这是伪代码。你是不是遗漏了什么？这些是模板函数还是成员函数？请发布更多代码或尝试将其归结为更小的测试用例。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-19T13:54:21.633

我的猜测是，函数的字符串版本的重载在您调用它的地方不可见。您确定它在正确的头文件中并且拼写正确吗？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-19T14:10:31.967

你有声明'int getMessage(std::string & buffer);' 在适用范围？您遇到此错误是因为未找到正确的功能。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-19T14:13:21.400

与往常一样，一旦问题得到解决，解决方案就会变得微不足道，而且应该一直很明显。

> 所以我想出了一个使用 std::string 的函数......

...在我的工作目录中，它编译得很好，但是我的 makefile 中的 -I 和 -L 仍然指向以前版本的库，这很幸运地不知道新功能。

抱歉打扰了。我一直是个白痴。我希望这不会成为一种习惯。;-)

# database - 连续数据库备份？

> ID：565361
> 
> 赞同：1
> 
> 时间：2009-02-19T13:44:36.087
> 
> 标签：database, sql-server-2005-express, backup-strategies

我有以下情况：

我们的系统在本地运行 SQL Server Express 2005 数据库（在每个用户桌面上，如果您愿意的话）。该系统正在存储来自机器的大量生产数据。对数据的安全性要求很高，每晚甚至每小时做一次备份是不够的。我们需要一种备份策略，以确保数据库几乎即时/连续备份。

有没有人成功地实施了类似的系统，和/或对如何完成它有一些想法？我现在唯一能想到的就是用镜像驱动器（raid）来保存数据，但这会很复杂而且很昂贵。

我将不胜感激对此的任何想法，因为这对我和我的公司来说是一个真正的问题。提前致谢！

**更新：**

我对场景的描述不够清楚。该系统将数据存储在与任何东西都没有连接的车辆中。因此，中央数据库是不可能的。我们也不能使用标准/企业版的 SQL Server，因为它会很昂贵（每辆车都需要许可证）。感谢您的输入！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-19T15:45:45.530

将您的数据库切换到“完整”恢复模式。每晚进行完整备份，并在主要用户操作后进行增量备份。增量备份可以在闪存或不同的硬盘上进行，所有数据都可以在在线时与服务器同步。

另一种简单的方法是跟踪存储在单独驱动器上的文本文件中的所有用户更改和重要数据。如果 SQL 数据库崩溃，用户或其他操作员可以重复步骤来恢复数据。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-19T13:45:34.167

我看到的一种方法是使用[DoubleTake](http://www.doubletake.com/english/solutions/Pages/sql-recovery.aspx)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-19T15:27:38.467

我将假设服务器上的中央数据库是不可行的，因为您的系统是独立运行的并且没有连接到任何东西。所以这就是我要做的

在计算机上设置 RAID。这可以确保您避免简单的磁盘故障。

如果您有完整的数据库备份和一组可用的事务日志，则任何 SQLSever 数据库都可以恢复到*最后提交事务的位置。*基本上，您只需恢复最后一次完整备份，然后应用事务日志。请参阅这些链接。

[http://www.enterpriseitplanet.com/storage/features/article.php/11318_3776361_3](http://www.enterpriseitplanet.com/storage/features/article.php/11318_3776361_3) [https://web.archive.org/web/1/http://blogs.techrepublic%2ecom%2ecom/datacenter/?p= 132](https://web.archive.org/web/1/http://blogs.techrepublic%2ecom%2ecom/datacenter/?p=132)

因此，您需要做的是设置数据库和事务日志的定期完整备份，以及更定期的事务日志备份（并确保您的事务日志永远不会耗尽空间）。

如果发生故障，您可以恢复上次的完整备份，然后继续应用事务日志。

我自己，如果这些是关键系统，我会倾向于向系统添加一个额外的驱动器，并确保将备份复制到该系统。这是因为与 raid 一样好，它有时也会出现问题 - raid 控制器失败，磁盘被意外并行擦除，磁盘故障被忽视，因此您只在一个磁盘上运行等。如果您确保将备份复制到单独的磁盘，那么您始终可以恢复到上次的事务日志备份。当然，您还应该确保磁带备份，但它们通常是出现问题时的最后手段。

如果由于某种原因您无法设置 raid，那么您仍然应该安装第二个磁盘，但将数据库文件放在一个驱动器上，将事务日志放在另一个驱动器上，并将备份复制到两个磁盘。如果 C 驱动器发生故障，或者其他一些软件问题导致数据库崩溃，您仍然可以恢复到最后提交的事务。D 驱动器上的故障将您限制为最后一次事务日志备份（Oracle 曾经允许您从数据库中镜像事务日志，这又会完全覆盖您，但我认为 SQL Server 中不存在此功能）

如果您正在寻找 SQL Server Express 的调度程序（没有附带），那么我一直在非常愉快地使用[SQLScheduler](http://www.lazycoding.com/products.aspx)，没有任何问题，而且它是免费的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-19T13:49:26.980

Raid 并不昂贵，但也不是最佳选择。如果您真的想要高可用性数据，您应该在远程服务器上升级到 sql server 标准，每个用户都连接到该服务器并使用基于事务的复制到另一台机器上的 sql server (express) 实例。Raid 并不总能保护您免受数据丢失。如果数据对您来说那么重要，那么成本应该不是那么大的问题。

更新以响应问题更新。

如果您不能使用远程服务器，那么有几个选项：

*   您编写一个触发器，该触发器在每次插入或更新时启动一个备份脚本，并将其存储在单独的硬盘上。
*   你使用突袭。但请注意，如果 raid 控制器出现故障，您仍然会遇到问题。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-19T13:50:21.737

最明显的答案是放弃在本地运行的 SQL Server Express，并为您的数据使用单一来源（例如安装在中央存储位置的标准 SQL Server）。除非您的系统需要对每个人自己的 SQL Server Express 实例进行单独备份。

如果您的要求非常严格，以至于每次操作都需要即时备份，那么您绝对应该考虑一种不同于 SQL Server Express 本地实例的存储方法。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-19T13:52:02.183

仅使用一个集中式 SQL Server 并每隔一小时左右备份一次不是更容易吗？如果您真的需要即时备份，您的公司（似乎不想花钱在每台机器上安装 Express）需要准备两台服务器和两个 SQL Server Enterprise 许可证来实施镜像。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-19T16:13:27.933

RAID 并不昂贵。使用 RAID 来防止硬盘出现故障。不过，您还需要监控。如果您让两个驱动器都发生故障，那么这样做毫无意义。

此外，实施每小时增量备份，然后是每日增量备份，最后是每周完整备份。

您需要所有这些策略一起工作，因为它们可以防止不同的事情。RAID 不能防止破坏数据的人为或编码错误。每小时和每周备份不能防止硬盘故障。

# linux - *NIX 中的命令管道如何工作？

> ID：565363
> 
> 赞同：5
> 
> 时间：2009-02-19T13:45:08.533
> 
> 标签：linux, unix, pipe

当我这样做时：

```
find . -name "pattern" | grep "another-pattern" 
```

进程`find`和`grep`是一起产生的吗？我的猜测是肯定的。如果是这样，那么这是如何工作的？：

```
yes | command_that_prompts_for_confirmations 
```

如果`yes`不断向标准输出发送“y”并`command_that_prompts_for_confirmations`在读取标准输入时读取“y”，如何`yes`知道何时终止？因为如果我`yes`单独运行而不将其输出传递给其他命令，它永远不会结束。

但是，如果管道命令不会同时产生所有进程，那么如何`yes`知道要输出多少个 'y'？这对我来说是第 22 条规则。有人可以解释一下这个管道在 *NIX 中是如何工作的吗？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-02-19T13:52:09.580

从[维基百科页面](http://en.wikipedia.org/wiki/Yes_(Unix))：*“yes 命令本身输出'y'或任何指定为参数的内容，后跟换行符，直到被用户停止或以其他方式杀死；当管道输入命令时，它将继续直到管道中断（即程序完成执行）。”*

`yes`不“知道”何时终止。但是，在某些时候将“y”输出到 stdout 会导致错误，因为其他进程已完成，这将导致管道损坏，并且 yes 将终止。

顺序是：

1.  其他程序终止
2.  操作系统关闭管道
3.  yes 尝试输出字符
4.  发生错误（断管）
5.  是的终止

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-19T13:51:09.143

是的，（一般来说）管道中的所有进程都是一起产生的。关于`yes`和类似的情况，信号被传回管道以指示它不再接受输入。具体来说：`SIGPIPE`，详细信息[here](http://en.wikipedia.org/wiki/SIGPIPE)和[here](http://www.unixguide.net/unix/bash/E2.shtml)。更多关于 *nix 流水线的有趣信息可在[wikipedia](http://en.wikipedia.org/wiki/Pipe_(Unix))上找到。

`SIGPIPE`如果您中断了一个意外的命令，您可以看到它正在运行，因为您收到`Broken Pipe`错误。不过，我似乎无法在我的 Ubuntu 设置中找到一个例子。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-19T14:44:48.283

其他答案包括终止。另一个方面是 yes 只会输出有限数量的 y - 管道中有一个缓冲区，一旦缓冲区已满，yes 将阻塞其写入请求。因此 yes 不会消耗无限的 CPU 时间。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-19T13:52:18.737

第一个进程的标准输出连接到第二个进程的标准输入，依此类推。“是”在第二个过程完成时退出，因为它不再有要写入的标准输出。

# javascript - document.readystate = 未定义

> ID：565364
> 
> 赞同：2
> 
> 时间：2009-02-19T13:45:21.030
> 
> 标签：javascript, internet-explorer-7

从外部 JS 脚本中，我使用 document.readystate 来确定文档是否已加载。

如果未加载，我附加 Onload 事件侦听器。

但是，当我在 IE7 document.readystate 上从 IEPRO（类似于 FFgreasemonkey）运行脚本时，会返回“未定义”。（我猜 IE7PRO 在文档已经加载后运行脚本）。

如何判断文档是否以跨浏览器工作的其他方式加载？

澄清（在前两个答案之后）：1.我的问题不是如何执行加载附加。我的问题是如何确定文档（或 DOM）是否已经以 document.readystate 以外的其他方式加载

2.  我无法更改文档。我的脚本是我无法控制的随机页面的插件。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-19T18:22:17.017

我不确定你的整个结论，但听起来你可以使用 jquery 并像这样设置你的代码：

```
 <script language="javascript" type="text/javascript">

    $(document).ready(function(){
 //have all your code of what you are trying to do here
 //
//
  });
</script> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-19T14:07:57.700

据我所知，这样做的唯一跨浏览器方法是将函数附加`load`到`window`; 这个脚本可能应该放在`head`. 当它触发时，设置一个布尔值，以便您知道稍后加载所有内容。

原型库就是这样做的；见`function fireContentLoadedEvent()`源。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-19T14:17:34.277

您可以在 body.onload 中执行此操作：

```
<body onload="document.ready=true;">... 
```

此 JavaScript 将在文档加载后执行。等到`document.ready`它是真的（或不再被低估）。

更好的方法是在 onload 中调用一个 JS 函数，然后调用你的外部脚本。这不涉及忙于等待，但可能不适用于您的情况。如果在框架中加载外部文档，则可以将要调用的函数存储在父文档中，并使用嵌套文档中的“window.parent.function()”。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-19T18:35:35.760

IEPRO UserScripts的[帮助站点](http://www.iescripts.org/help/index.html)似乎表明它们在页面加载后运行。那么为什么需要检查页面是否加载呢？

# asp.net - 使用 Global.asax 进行授权检查

> ID：565368
> 
> 赞同：5
> 
> 时间：2009-02-19T13:46:06.927
> 
> 标签：asp.net

在我的 ASP.NET Web 应用程序中，我想在用户每次尝试从我的应用程序获取页面时检查用户是否存在于数据库中（当然是在我们第一次在会话中保存用户详细信息之后）。我尝试使用 global.asax 中的 Application_AuthenticateRequest 事件来检查每个请求，但此事件中不存在会话。我需要一个关于我可以将我的授权逻辑放在哪里的建议，我仍然可以使用会话数据（以减少数据库访问）。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-19T14:09:40.987

您听起来好像在“滚动自己的”身份验证系统。

我会考虑使用 ASP.NET 的内置[Forms 身份验证](http://msdn.microsoft.com/en-us/library/xdt4thhy.aspx)系统，该系统通常与 ASP.NET [Membership Provider](http://msdn.microsoft.com/en-us/library/aa478949.aspx)一起使用。SQL Server 已经存在内置提供程序，您可以通过从[System.Web.Security.MembershipProvider](http://msdn.microsoft.com/en-us/library/system.web.security.membershipprovider.aspx)基类继承来创建自己的成员资格提供程序。

本质上，一旦客户端成功验证了自己，ASP.NET 成员资格提供程序通常通过在客户端浏览器中设置客户端 cookie（也称为身份验证票证）来工作。该 cookie 会随每个后续页面请求返回到 Web 服务器，从而允许 ASP.NET 以及您的代码来确定用户是谁，通常使用如下一行代码：

```
string username = HttpContext.Current.User.Identity.Name;
// The above gets the current user's name.

if(HttpContext.Current.User.Identity.IsAuthenticated)
// Do something when we know the user is authenticated. 
```

然后，您不需要在 Session 状态中存储任何内容。当然，如果您*想*将特定于用户的数据存储在会话变量中（即，可能不是用户身份验证的一部分的用户数据，可能是用户最喜欢的颜色等），那么无论如何您都可以将其存储在一个会话变量（在用户首次通过身份验证时从数据库中检索它之后）。会话变量可以基于用户名（假设名称唯一）进行存储，并使用与上述类似的代码进行检索，该代码获取当前用户名以访问正确的会话对象。

使用内置表单身份验证还允许您使用 web.config 中的简单声明性代码“保护”您网站的区域免受未经授权的用户的攻击，例如：

```
<authorization>
  <deny users="?"/>
</authorization> 
```

将上述内容添加到您的“主要”web.config 将确保未经授权的用户无法访问您的任何页面（尽管您实际上可能永远不会这样做 - 这只是作为示例）。将 ASP.NET[角色提供程序](http://msdn.microsoft.com/en-us/library/aa479032.aspx)与成员资格提供程序结合使用，可以让您更精确地确定谁可以或不能访问您网站的各个部分。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-19T14:03:30.270

您可以使用 SqlMembershipProvider（或自定义提供程序，如果您不使用 MSSQL）并拒绝整个应用程序中未经身份验证的用户（登录页面除外）。此检查将仅限于登录时间，因为身份验证票证将存储在会话中或作为用户计算机上的 cookie。

有关[如何：在 ASP.NET 2.0 中使用成员资格](http://msdn.microsoft.com/en-us/library/ms998347.aspx)和 [检查 ASP.NET 2.0 的成员资格、角色和配置文件的更多详细信息](http://aspnet.4guysfromrolla.com/articles/120705-1.aspx)

# c++ - 如何将 c++ dll 文件加载到 Matlab 中

> ID：565371
> 
> 赞同：7
> 
> 时间：2009-02-19T13:47:10.917
> 
> 标签：c++, matlab, dll, shared-libraries, loadlibrary

我有一个 C++ dll 文件，它使用了许多需要加载到 matlab 中的其他 c++ 库（IPP、Opencv +++）。我怎样才能做到这一点？

我试过loadlibrary和mex。加载库不起作用。

mex 找到 linux 的东西（独立于平台的库）并尝试包含它们。那是行不通的。

有没有人有什么好主意？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-19T17:37:07.967

loadlibrary 应该可以工作。我一直使用它来调用用 C++ 编写的带有 C 包装器的 dll 中的函数。

当您尝试使用 loadlibrary 时遇到什么错误？

确保 dll 的导出函数是 C 函数，而不是 C++ 函数。如果不是，则编写 C 包装器。

有关您在使用 loadlibrary 时正在做什么的更多信息会很有帮助。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-19T17:49:30.800

正如其他人所提到的，您应该首先将您的 C++ 库包装为 C 库 - mathworks 曾经建议不要直接在 mex 中使用 C++ 代码（直接 dlopening C++ 核心很复杂），也许它仍然是正确的。

您的描述也很不清楚：“mex 找到了 linux 的东西”是什么意思，但这不起作用。说它不起作用是没有帮助的：确切的命令和错误消息是。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-19T14:17:56.240

您可以选择 Java 方法（因为 Matlab 在 JRE 上运行并且可以[访问 Java 对象/方法](http://www.mathworks.com/access/helpdesk/help/techdoc/matlab_external/f44062.html)——请注意，Matlab JRE 不像最新的 JRE 那样最新，我正在运行的 JRE 使用Java 1.5) 并使用[JNA](https://github.com/twall/jna/#getting_started)访问您的 DLL。

* * *

或者，如果您编写了顶级 DLL，您可以选择 COM/ActiveX 方法。

我已经成功地将我的 C++ 函数的接口构建为 COM/ActiveX 库——你不必为那些 .h 的东西而烦恼。

请参阅 COM 客户端的[外部接口](http://www.mathworks.com/access/helpdesk/help/techdoc/matlab_external/brd0v8r.html)指南，尤其是有关[管理/转换](http://www.mathworks.com/access/helpdesk/help/techdoc/matlab_external/bq4epvg-1.html)数据的部分。

添加 COM/ActiveX 层将是额外的工作，但会使您的库在 Windows 世界中更便携，并且可能更容易在 MATLAB 中使用。

* * *

如果对 DLL 有很多函数调用，COM/ActiveX 方法可能会更快（不确定），但否则我认为 JNA 方法会更容易。

# .net - 如何以编程方式重新启动 Windows 资源管理器进程

> ID：565405
> 
> 赞同：7
> 
> 时间：2009-02-19T13:54:13.240
> 
> 标签：.net, windows, winapi, explorer, windows-explorer

我正在开发 Windows shell 扩展，不幸的是，在更改 DLL 时，我必须重新启动 Windows 资源管理器（因为它将 DLL 保存在内存中）。

我从 Dino Esposito 找到了这个程序，但它对我不起作用。

```
void SHShellRestart(void)
{
    HWND hwnd;
    hwnd = FindWindow("Progman", NULL );
    PostMessage(hwnd, WM_QUIT, 0, 0 );
    ShellExecute(NULL, NULL, "explorer.exe", NULL, NULL, SW_SHOW );
    return;
} 
```

有没有人可以分享一些东西来做到这一点？

PS我意识到我可以去任务管理器并杀死资源管理器进程，但我只是想以懒惰的方式来做。此外，这可以实现自动化。

PPS 我使用 .NET 进行开发，但 shell 重新启动功能可能是 C、C++ 或 .NET 语言。它只是一个小的独立可执行文件。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2012-05-03T20:17:36.100

在解析了一些早期的答案并进行了一些研究之后，我在 C# 中创建了一个完整的小示例。这将关闭 explorer shell，然后等待它完全关闭并重新启动它。希望这会有所帮助，这个线程中有很多有趣的信息。

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Runtime.InteropServices;
using System.Diagnostics;
using System.Threading;

namespace RestartExplorer
{
class Program
{
    [DllImport("user32.dll", SetLastError = true)]
    static extern bool PostMessage(IntPtr hWnd, [MarshalAs(UnmanagedType.U4)] uint Msg, IntPtr wParam, IntPtr lParam);

    [DllImport("user32.dll", SetLastError = true)]
    static extern IntPtr FindWindow(string lpClassName, string lpWindowName);

    const int WM_USER = 0x0400; //http://msdn.microsoft.com/en-us/library/windows/desktop/ms644931(v=vs.85).aspx

    static void Main(string[] args)
    {
        try
        {
            var ptr = FindWindow("Shell_TrayWnd", null);
            Console.WriteLine("INIT PTR: {0}", ptr.ToInt32());
            PostMessage(ptr, WM_USER + 436, (IntPtr)0, (IntPtr)0);

            do
            {
                ptr = FindWindow("Shell_TrayWnd", null);
                Console.WriteLine("PTR: {0}", ptr.ToInt32());

                if (ptr.ToInt32() == 0)
                {
                    Console.WriteLine("Success. Breaking out of loop.");
                    break;
                }

                Thread.Sleep(1000);
            } while (true);
        }
        catch (Exception ex)
        {
            Console.WriteLine("{0} {1}", ex.Message, ex.StackTrace);
        }
        Console.WriteLine("Restarting the shell.");
        string explorer = string.Format("{0}\\{1}", Environment.GetEnvironmentVariable("WINDIR"), "explorer.exe");
        Process process = new Process();           
        process.StartInfo.FileName = explorer;
        process.StartInfo.UseShellExecute = true;
        process.Start();

        Console.ReadLine();

    }
}
} 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2011-05-02T02:24:10.057

我注意到没有人解决将 explorer.exe 作为 shell 启动的问题，而不仅仅是打开资源管理器窗口。我花了一段时间才弄清楚这一点，结果很简单：

```
string explorer = string.Format("{0}\\{1}", Environment.GetEnvironmentVariable("WINDIR"), "explorer.exe");
        Process process = new Process();
        process.StartInfo.FileName = explorer;
        process.StartInfo.UseShellExecute = true;
        process.Start(); 
```

您必须将 StartInfo.UseshellExecute 设置为 true 才能使其作为 shell 重新启动。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-22T09:31:34.970

一个万无一失的解决方案：

```
foreach (Process p in Process.GetProcesses())
{
    // In case we get Access Denied
    try
    {
        if (p.MainModule.FileName.ToLower().EndsWith(":\\windows\\explorer.exe"))
        {
            p.Kill();
            break;
        }
    }
    catch
    { }
}
Process.Start("explorer.exe"); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-19T13:59:14.413

FindWindow 之后使用 GetWindowThreadProcessId，然后是 OpenProcess，然后是 TerminateProcess。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-19T14:25:06.457

经过一番谷歌搜索后，我想出了以下 C# 解决方案：

```
 using System.Diagnostics;
...
static public void RestartExplorer()
{
    foreach(Process p in Process.GetProcesses())  {
       if(p.MainModule.ModuleName.contains("explorer") == true)
         p.Kill();
    }
    Process.Start("explorer.exe");
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-19T15:01:46.197

这适用于我在 Vista 上：

```
DWORD dwPID;
HANDLE hExp;
HWND hSysTray = ::FindWindow (TEXT("Shell_TrayWnd"), NULL) ;
GetWindowThreadProcessId (hSysTray, &dwPID);
hExp = OpenProcess (PROCESS_TERMINATE, FALSE, dwPID);

if (hExp)
{
   TerminateProcess (hExp, 0);
}
Sleep (2000);
ShellExecute (NULL, NULL, TEXT("explorer.exe"), NULL, NULL, SW_HIDE); 
```

但我找不到任何方法来抑制打开的探索窗口（我试过了，因此是 SW_HIDE）。在 Vista 上，不带参数运行 explorer.exe 似乎与在早期系统上运行“explorer.exe /e”相同。你必须自己在 XP 上尝试一下，我这里没有。

注意：使用 TerminateProcess 看起来确实很极端，但是将 WM_CLOSE 发布到资源管理器会引发 Windows 关闭对话框。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-10-03T05:44:40.443

这适用于 Windows 7/8（需要测试，甚至可能适用于 Vista）。

由于**有一种关闭**Windows 7 和 8 中包含的资源管理器（progman）的正确方法 -通过**在按 Ctrl-Shift 的同时****右键单击**任务栏（Win8 中的 Shell_TrayWnd 或 Win7 上的 StartMenu），它会在弹出菜单中显示**一个隐藏的关闭选项Explorer**，并使用 Spy++ 挖掘它是由消息**WM_USER+436**触发的。

 ******因此，我进行了测试并执行了以下操作，效果很好。

```
PostMessage(FindWindow('Shell_TrayWnd'),nil),WM_USER+436,0,0); 
```

它关闭资源管理器，以及所有打开的实例。要重新启动资源管理器，请使用上面提供的方法。

因此，**请**在评论中确认这是否适用于您的 windows vista/7/8 或任何其他版本的 32 位/64 位版本。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2020-07-14T14:16:50.183

```
public static void RestartExplorer()
{
    using(Process process = new Process())
    {
        //有些系统有tskill.exe可以直接调用tskill explorer命令
        process.StartInfo = new ProcessStartInfo
        {
            FileName = "taskkill.exe",
            Arguments = "-f -im explorer.exe",
            WindowStyle = ProcessWindowStyle.Hidden
        };
        process.Start();
        process.WaitForExit();
        process.StartInfo = new ProcessStartInfo("explorer.exe");
        process.Start();
    }
} 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-09-25T14:27:39.233

AC# 解决方案提供了更多确定“正确”资源管理器进程被杀死的可能性。

```
using System;
using System.Diagnostics;

...............

public static void RestartExplorer()
 {
 const string explorer = "explorer.exe";
 string explorerPath = string.Format("{0}\\{1}", Environment.GetEnvironmentVariable("WINDIR"), explorer);
 foreach (Process process in Process.GetProcesses())
  {
  // In case we get Access Denied
  try
   {
   if (string.Compare(process.MainModule.FileName, explorerPath, StringComparison.OrdinalIgnoreCase) == 0)
    {
    process.Kill();
    }
   }
  catch
   {
   }
  }
 Process.Start(explorer);
 } 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2021-10-11T11:36:28.150

与其尝试重新启动资源管理器，不如快速刷新它，它应该具有类似的效果。

```
[DllImport("shell32.dll", CharSet = CharSet.Auto, SetLastError = true)]
public static extern void SHChangeNotify(uint wEventId, uint uFlags, IntPtr dwItem1, IntPtr dwItem2);

public static void RefreshExplorer()
{
    SHChangeNotify(0x08000000, 0x00000000, IntPtr.Zero, IntPtr.Zero);
} 
```

只需调用 RefreshExplorer()，它就会刷新资源管理器。

SHChangeNotify 接受 eventId 作为第一个参数。在上面的示例中，它通知文件关联已更改，但您可以针对特定事件执行此操作。[此处](https://docs.microsoft.com/en-us/windows/win32/api/shlobj_core/nf-shlobj_core-shchangenotify)的文档中提到了所有 eventId 常量。您可以在[magnumdb](https://www.magnumdb.com/search?q=SHCNE_*)中找到它们的值。

# sql-server - SQL Server Management Studio 和提交

> ID：565418
> 
> 赞同：3
> 
> 时间：2009-02-19T13:58:58.737
> 
> 标签：sql-server, commit

假设我有一个包含大量记录的表，我想使用 SQL Server managment studio 2008 更新该表中的所有记录，我输入：

Update Table set col1 = val

此命令需要一段时间才能更新所有记录记录，现在如果我按下停止执行，究竟会发生什么，一些记录将被更新和提交，或者像我从未执行过该命令一样？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-19T14:04:08.987

这将是全有或全无，这是一个基于集合的操作 SQL Server 如果尚未启动显式事务，则使用隐式事务，这是确保 ACID 的一种方法

所以如果你停止它来回答你的问题，它将处于与你按下之前相同的状态！或 F5

# .net - 在 VB.net 中将值从子级传递给 mdi 父级

> ID：565423
> 
> 赞同：4
> 
> 时间：2009-02-19T14:00:35.050
> 
> 标签：.net, vb.net, mdi

我有一个简单的通讯录。该应用程序有一个主窗口，它是一个 mdi 表单。当使用“添加联系人”表单添加联系人时，我想在父窗口状态栏中显示一条简单的反馈消息，说明联系人已成功添加。

这是子加载：

```
Private Sub addButton_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles addButton.Click
    Dim af As New addForm
    af.MdiParent = Me
    af.Show()
End Sub 
```

问题是，由于父级实际上是一个 mdi 父级，并且“添加联系人”表单是使用`.Show()`而不是启动的`.ShowDialog()`，所以我无法存储任何可以由启动 Sub 用于执行操作的返回值。

有没有办法将这个孩子的值传递给 mdi 父母？这是子窗体做它的东西：

```
Private Sub addButton_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles addButton.Click

    Dim contact = <contact>
                      <quickName><%= quickNameTextBox.Text %></quickName>
                      <firstName><%= firstNameTextBox.Text %></firstName>
                      <lastName><%= lastNameTextBox.Text %></lastName>
                      <email><%= emailTextBox.Text %></email>
                      <website><%= websiteTextBox.Text %></website>
                      <telephone><%= telephoneTextBox.Text %></telephone>
                      <mobile><%= mobileTextBox.Text %></mobile>
                  </contact>

    Dim contactList = XDocument.Load("contactList.xml")

    contactList.Elements()(0).Add(contact)
    contactList.Save("contactList.xml")
    //something here to trigger the status update in the parent?
    //trivia: SO doesn't support VB single-quote comments...
    Me.Close()

End Sub 
```

PS显然，我在标记事物方面相当糟糕......所以任何想要重新标记这个问题的人都非常受欢迎。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-19T14:20:56.920

我处理这个问题的方法是在子控件上创建一个自定义事件。然后处理父控件上的事件。

首先，在子控件中定义事件（例如，定义自己的）：

```
Public Event EVENTNAME(ByVal sender as Object, ByVal ValueToReturn As String) 
```

然后，当您的数据准备好传递时，在子控件上引发事件。

```
RaiseEvent EVENTNAME(Me, txtBoxWithReturnValue.Text) 
```

完成后，现在在父表单上，您可以处理自定义事件。为此，您需要添加一个侦听器，以便在事件触发时“侦听”事件：

```
AddHandler CONTROLNAME.EVENTNAME, AddressOf EVENTNAME 
```

然后，您可以编写一个例程来处理父表单中的这个新事件：

```
Private Sub FUNCTIONAME(ByVal sender As System.Object, ByVal ValueToReturn as String) Handles CONTROLNAME.EVENTNAME

'Code to handle data here

End Sub 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-07-29T18:20:46.247

这是最简单的答案，没有事件！

情况：1 个 MdiParent 表单（Form1）和 2 个子控件表单（Control1Form 和 Control2Form）。启动时，在 MdiParent 中创建子控件（control1 和 control2）。

Form1 在 StatusStrip 中具有名为 StatusLabel 的标签。Control2 有一个名为 Button1 的按钮

目标：当 Control2 的按钮被点击时，Control2 写入 control1 的 Title 和 Form1 的 StatusLabel

```
PARTIAL CODE

FORM1
Public Class Form1
Private Sub Form1_Load(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles MyBase.Load
control1 = New Control1Form
control2 = New Control2Form
control1.MdiParent = Me
control1.Show()
control2.MdiParent = Me
control2.Show()
End Sub
End Class

CONTROL2FORM
Public Class Control2Form
Private Sub Button1_Click(ByVal sender As Object, ByVal e As EventArgs) Handles Button1.Click
'Title of Control1
CType(Me.ParentForm, Form1).control1.Text = "Title bar text"
'Status Strip Label
CType(Me.ParentForm, Form1).StatusLabel.Text = "Status Strip Text"
End Sub
End Class 
```

瞧！希望能帮助到你

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-07-09T20:38:26.370

在 VB.NET 中，您可以使用 [My] 命名空间。My.Forms.[你的 MDI 表单的名称] 所以......如果你的主表单被称为 MdiMain 你可以做这样的事情。

```
My.Forms.MdiMain.lblStatus = "X" 
```

我所有的子表单都继承同一个基类，并且该类只有一个返回 My.Forms.MdiMain 的属性。我称它为 MdiParentForm。这样我就可以在任何形式上说 Me.MdiParentForm 和 bam ......那就是父母。（少打字）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-19T14:22:59.177

在 MDI 中创建一个控制器类并将其作为参数传递给子窗体。在 Me.Close() 之前将联系人列表分配给控制器上的属性。

您需要更多地分离数据和 GUI。有关模型-视图-控制器模式的更多信息，请访问[此处](http://en.wikipedia.org/wiki/Model-view-controller)。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-19T16:38:35.493

乔恩的回答 - 虽然很有帮助 - 是不完整的。缺少的部分可能会让像我这样的新手感到困惑。

不是像我一开始那样调暗 addForm，而是需要使用 WithEvents 关键字在类级别创建 addForm 的实例，然后使用该实例来加载表单和事件处理程序。

```
Private WithEvents oneAddForm As New addForm //create a new instance of addForm

Private Sub addButton_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles addButton.Click
    oneAddForm.MdiParent = Me
    oneAddForm.Show()
End Sub
//using this instance to load the form...

Private Sub updateStatus(ByVal sender As System.Object, ByVal contactName As String) Handles oneAddForm.addSuccess
    statusLabel.Text = contactName & " has been added to your contact list."
End Sub
//...and to put in the event handler 
```

但这会导致“无法访问已处置的对象...”在关闭一次后尝试加载 oneAddForm 表单时出现异常。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2015-05-08T22:16:20.840

我想添加一个对我来说非常有用的稍微不同的答案。

只要我确实在 MDI 父级中进行了任何代码更改，上述答案中的以下内容对我来说非常有用。当我插入相当于 form1.MDIparent=me 时，一切都失败了。所以我离开了这一步。

下面的 Form1 需要是您正在使用的 MDI 父窗体的名称。然后它在我的环境中工作，非常适合将变量传递给父级或追求父级的其他功能。

在这样做之前，我遇到了一个问题，孩子打电话给另一个有所有空白字段的父母！

```
CType(Me.ParentForm, Form1).control1.Text = "Title bar text"
'Status Strip Label
CType(Me.ParentForm, Form1).StatusLabel.Text = "Status Strip Text"

CType(Me.parentForm, Form1).variableDefinedinParentString = "abc" 'passing a variable

CType(Me.parentForm, Form1).subroutineLOCATEDinPARENT() 'Calling a subroutine in the parent 
```

也许这会帮助其他一些人。但愿如此！

# c# - 如何在 C# 中从我的数据库中获取用户名和密码？

> ID：565425
> 
> 赞同：4
> 
> 时间：2009-02-19T14:00:46.330
> 
> 标签：c#, .net, asp.net, tsql, sql-injection

我的`btn_click`活动中有以下代码：

```
Sqlconnection con = new Sqlconnection("server=.;database=bss;user id=ab;pwd=ab");
con.open();
SqlCommand cmd = new Sqlcommand("select * from login where username='" 
+ txt4name.Text + "' and pwd='" + txt4pwd.Text + "'", con);

SqlDataReader reader = cmd.execute Reader(); 
```

`login`表在哪里，`username`并且`pwd`是它的字段。在此代码之后，所有值都存储在`reader`对象中。我想将`username`和存储`pwd`在单独的变量中。

我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-02-19T14:07:11.930

通常，在访问您的数据库时，您应该使用与此类似的东西来消除 SQL 注入漏洞：

```
using (SqlCommand myCommand = new SqlCommand("SELECT * FROM USERS WHERE USERNAME=@username AND PASSWORD=HASHBYTES('SHA1', @password)", myConnection))
    {                    
        myCommand.Parameters.AddWithValue("@username", user);
        myCommand.Parameters.AddWithValue("@password", pass);

        myConnection.Open();
        SqlDataReader myReader = myCommand.ExecuteReader())
        ...................
    } 
```

**但更实际地存储凭据，您应该使用[会员系统](http://msdn.microsoft.com/en-us/library/yh26yfzy.aspx)之类的东西，而不是自己滚动。**

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-19T14:02:25.560

[你冒着巨大的 sql 注入风险。](http://en.wikipedia.org/wiki/SQL_injection) 对 SqlCommands 中的值使用 SQL 参数。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-19T14:07:38.217

如果您的意思是 c# 变量，并且您想从 db 中获取它们，只需执行以下操作：

```
SqlDataReader reader = cmd.execute Reader();
if (reader.Read())
{
    string username = reader["username"];
    string pwd = reader["password"];
} 
```

当您使用它时，参数化您的查询并防止 sql 注入：

```
SqlCommand cmd = new Sqlcommand("select * from login where username=@username and pwd=@pwd", con);
cmd.Parameters.AddWithValue("@username", txt4name.Text);
cmd.Parameters.AddWithValue("@pwd", txt4pwd.Text); 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-19T14:08:25.903

绝对注意有关 SQL 注入的建议，但这里是您问题的答案：

```
String username;
String pwd;

int columnIndex = reader.GetOrdinal("username");

if (!dataReader.IsDBNull(columnIndex))
{
    username = dataReader.GetString(columnIndex);
}

columnIndex = reader.GetOrdinal("pwd");

if (!dataReader.IsDBNull(columnIndex))
{
    pwd = dataReader.GetString(columnIndex);
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-19T14:06:19.107

```
string userName =  txt4name.Text;
string password =  txt4pwd.Text; 
```

这真的是你想要的吗？只是为了将这些数据转换为变量？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-19T14:11:23.417

您确实需要使用参数化 SQL。[这里有一个例子](https://stackoverflow.com/questions/546199/how-do-i-run-sql-code-using-c-3-5/546259) 此外，您的问题没有任何意义；你想把用户名和密码放在单独的变量中吗？在您的示例中，它们已经是分开的。如果您无法将它们分配给字符串，我建议您遵循一些[教程](http://www.google.com/search?client=safari&rls=en-us&q=c%23+tutorial&ie=UTF-8&oe=UTF-8)。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-19T14:20:31.540

另一种方法是将阅读器结果加载到 DataTable 中，如下所示：

```
DataTable Result = new DataTable();

Result.Load(reader); 
```

如果您的登录表仅包含唯一的两列（用户名和密码），您最终会得到仅包含一行信息的结果。然后，您可以从每列中获取列值：

```
string userName = Result.Rows[0].Field<string>("userName");
string password = Result.Rows[0].Field<string>("pwd"); 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2015-02-24T12:26:34.647

```
private void but_login_Click(object sender, EventArgs e)
{
    string cn = "Data Source=.;Initial Catalog=mvrdatabase;Integrated Security=True";
    SqlConnection con = new SqlConnection(cn);
    con.Open();
    SqlCommand cmd = new SqlCommand("select count (*) from logintable where username ='" + txt_uname.Text + "'and password='" + txt_pass.Text + "'", con);
    int i = Convert.ToInt32(cmd.ExecuteScalar());
    con.Close();

    if (i == 1)
    {
        Form2 f2 = new Form2();
        MessageBox.Show("User login successfully........");
        this.Hide();
        f2.Show();
    }
    else
    {
        MessageBox.Show("INCORRECT USERID AND PASSWORD", "Error");
    }
} 
```

* * *

## 回答 #9

> 赞同：-3
> 
> 时间：2009-02-19T14:13:13.490

您通常可以在 MSDN 上找到基本的使用示例，例如[SqlDataReader](http://msdn.microsoft.com/en-us/library/system.data.sqlclient.sqldatareader.aspx)。

# .net - .NET 数据库迁移工具包

> ID：565426
> 
> 赞同：4
> 
> 时间：2009-02-19T14:00:53.473
> 
> 标签：.net, database-migration

我目前的宠物项目是一个独立于语言的数据库迁移库（ Google Code 上的[Wizardby](http://code.google.com/p/octalforty-wizardby)）。它非常受 ActiveRecord Migrations 的启发，但也有一些细节。例如，执行一些基本的“类型推断”，因此您不必指定 FK 列的类型。仅给定“升级”序列即可生成“降级”脚本也足够聪明。尽管迁移是用特殊的 DSL 编写的，但该工具主要针对 .NET 项目。它也是独立于数据库平台的。

下面是语法的快速浏览：

```
 migration "Blog" revision => 1:
    type-aliases:
      type-alias N type => String, length => 200, nullable => false, default => ""

    defaults:
      default-primary-key ID type => Int32, nullable => false, identity => true

    version 1:
      add table Author:
        FirstName type => N
        LastName type => N
        EmailAddress type => N, unique => true
        Login type => N, unique => true
        Password type => Binary, length => 64, nullable => true

      add table Tag:
        Name type => N

      add table Blog:
        Name type => N
        Description type => String, nullable => false

      add table BlogPost:
        Title type => N
        Slug type => N
        BlogID references => Blog
        AuthorID references => Author

      add table BlogPostTagJunction primary-key => false:
        BlogPostID references => BlogPost
        TagID references => Tag

    version 2:
      add table BlogPostComment:
        BlogPostID references => BlogPost
        AuthorEmailAddress type => N
        Content type => String, nullable => false

    version 3:
      add table Media:
        TypeID type => Int32
        Name type => N
        MimeType type => N
        Length type => Int32
        BlogPostID nullable => true, references => BlogPost
        BlogPostCommentID nullable => true, references => BlogPostComment

      add table User:
        Login type => String, length => 200, nullable => false
        Password type => Binary, length => 64, nullable => false

        index IX_Login columns => [ID, [Login, desc]], unique => true

    version 4:
        add table Forum:
          Name type => String, length => 200, nullable => false
        add column ModeratorUserID nullable => false, references => User

    version 5:
        remove index IX_Login table => User

    version 6:
        add index IX_Login table => User, columns => [ID, [Login, desc]], unique => true

    version 7:
        BlogAuthorJunction primary-key => false:
            BlogID references => Blog
            AuthorID references => Author

        execute native-sql upgrade-resource => InsertSeedData, downgrade-resource => DeleteSeedData 
```

我知道那里有其他迁移库，但是，嘿，这是一个宠物项目！

The question is: what features do you expect from database migration toolkits in general and what can you say about this particular puppy syntax-wise?

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-09T22:23:16.020

I like this syntax. In your sample you focused on changing structure. But what about data manipulation?

It's very often when in migration I have to modify data (for example add some dictionary data).

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-02-18T04:10:24.677

I'd like to see the ability to verify that each revision has been applied to a database. So say for example version 3 added the table 'Media'. Since then versions 4 & 5 have been added to the database but somewhere along the line 'Johnny Q Expert' deleted the table 'Media'. Now comes version 6 which needs to alter the 'Media' table (which no longer exists) - a verify function could be useful which ensures a culmination of all changes made in versions 1 thru 5 are present in the database so the next version can be applied correctly.

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-09T17:39:32.600

From the looks of it I have to say that it is farily easy to follow and overall the structure looks pretty clean.

The biggest features that I'm looking for in something like this are as follows.

1.  Ability to make changes in a transaction to roll back should there be an issue. (Data integrity or otherwise)
2.  Ability to see the actual generated SQL scripts should the need arise
3.  Automatic rollback, if a failure occurs to the last version

I have other requirements regarding the moving of keys, indexes, and the such, but it looks like you have that already handled. For me it is really focused on the controls around the actual execution, and a quick, solid backout plan!

# javascript - （深度）使用 jQuery 复制数组

> ID：565430
> 
> 赞同：237
> 
> 时间：2009-02-19T14:01:20.977
> 
> 标签：javascript, jquery

> **可能重复：**
> [克隆 JavaScript 对象的最有效方法是什么？](https://stackoverflow.com/questions/122102/what-is-the-most-efficient-way-to-clone-a-javascript-object)

我需要复制一个（有序的，非关联的）对象数组。我正在使用 jQuery。我最初尝试过

```
jquery.extend({}, myArray) 
```

但是，自然地，这给了我一个对象，我需要一个数组（顺便说一下，真的很喜欢 jquery.extend）。

那么，复制数组的最佳方法是什么？

* * *

## 回答 #1

> 赞同：292
> 
> 时间：2009-05-03T13:22:50.417

由于 Array.slice() 不做深拷贝，所以不适合多维数组：

```
var a =[[1], [2], [3]];
var b = a.slice();

b.shift().shift();
// a is now [[], [2], [3]] 
```

请注意，尽管我在`shift().shift()`上面使用过，但要点只是*`b[0][0]`包含指向`a[0][0]`*而不是值的指针。

同样`delete(b[0][0])`也会导致 `a[0][0]`被删除并将`b[0][0]=99`的值更改`a[0][0]`为 99。

当一个真值作为初始参数传递时，jQuery 的`extend`方法*会执行深层复制：*

```
var a =[[1], [2], [3]];
var b = $.extend(true, [], a);

b.shift().shift();
// a is still [[1], [2], [3]] 
```

* * *

## 回答 #2

> 赞同：31
> 
> 时间：2009-02-19T14:14:53.550

`$.extend(true, [], [['a', ['c']], 'b'])`

那应该为你做。

* * *

## 回答 #3

> 赞同：21
> 
> 时间：2009-02-19T14:34:07.230

*我意识到您正在寻找数组的“深层”副本，但如果您只有一个单级数组，您可以使用它：*

复制原生 JS 数组很容易。使用[Array.slice()](http://www.devguru.com/Technologies/Ecmascript/Quickref/Slice.html)方法创建部分/全部数组的副本。

```
var foo = ['a','b','c','d','e'];
var bar = foo.slice(); 
```

现在 foo 和 bar 是 'a','b','c','d','e' 的 5 个成员数组

当然 bar 是副本，而不是参考......所以如果你接下来这样做......

```
bar.push('f');
alert('foo:' + foo.join(', '));
alert('bar:' + bar.join(', ')); 
```

你现在会得到：

```
foo:a, b, c, d, e
bar:a, b, c, d, e, f 
```

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2009-02-19T18:19:19.203

JavaScript 中的所有内容都是通过引用传递的，因此，如果您想要数组中对象的真正深层副本，我能想到的最佳方法是将整个数组序列化为 JSON，然后将其反序列化。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2011-11-17T15:42:34.537

如果你想使用纯 JavaScript，那么试试这个：

```
 var arr=["apple","ball","cat","dog"];
 var narr=[];

 for(var i=0;i<arr.length;i++){
     narr.push(arr[i]);
 }
 alert(narr); //output: apple,ball,vat,dog
 narr.push("elephant");
 alert(arr); // output: apple,ball,vat,dog
 alert(narr); // apple,ball,vat,dog,elephant 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2012-03-13T11:13:37.983

复杂类型呢？当数组包含对象...或任何其他

我的变种：

```
Object.prototype.copy = function(){
    var v_newObj = {};
    for(v_i in this)
        v_newObj[v_i] = (typeof this[v_i]).contains(/^(array|object)$/) ? this[v_i].copy() : this[v_i];
    return v_newObj;
}

Array.prototype.copy = function(){
    var v_newArr = [];
    this.each(function(v_i){
        v_newArr.push((typeof v_i).contains(/^(array|object)$/) ? v_i.copy() : v_i);
    });
    return v_newArr;
} 
```

这不是最终版本，只是一个想法。

PS：方法 each 和 contains 也是原型。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-02-19T14:52:24.783

我遇到了这个“深度对象复制”功能，我发现它可以方便地按值复制对象。它不使用 jQuery，但它确实很深。

[http://www.overset.com/2007/07/11/javascript-recursive-object-copy-deep-object-copy-pass-by-value/](http://www.overset.com/2007/07/11/javascript-recursive-object-copy-deep-object-copy-pass-by-value/)

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2011-03-13T01:58:11.513

我计划在[jPaq](http://jpaq.org/)的下一个版本中发布此代码，但在此之前，如果您的目标是对数组进行深度复制，则可以使用此代码：

```
Array.prototype.clone = function(doDeepCopy) {
    if(doDeepCopy) {
        var encountered = [{
            a : this,
            b : []
        }];

        var item,
            levels = [{a:this, b:encountered[0].b, i:0}],
            level = 0,
            i = 0,
            len = this.length;

        while(i < len) {
            item = levels[level].a[i];
            if(Object.prototype.toString.call(item) === "[object Array]") {
                for(var j = encountered.length - 1; j >= 0; j--) {
                    if(encountered[j].a === item) {
                        levels[level].b.push(encountered[j].b);
                        break;
                    }
                }
                if(j < 0) {
                    encountered.push(j = {
                        a : item,
                        b : []
                    });
                    levels[level].b.push(j.b);
                    levels[level].i = i + 1;
                    levels[++level] = {a:item, b:j.b, i:0};
                    i = -1;
                    len = item.length;
                }
            }
            else {
                levels[level].b.push(item);
            }

            if(++i == len && level > 0) {
                levels.pop();
                i = levels[--level].i;
                len = levels[level].a.length;
            }
        }

        return encountered[0].b;
    }
    else {
        return this.slice(0);
    }
}; 
```

以下是如何调用此函数对递归数组进行深拷贝的示例：

```
// Create a recursive array to prove that the cloning function can handle it.
var arrOriginal = [1,2,3];
arrOriginal.push(arrOriginal);

// Make a shallow copy of the recursive array.
var arrShallowCopy = arrOriginal.clone();

// Prove that the shallow copy isn't the same as a deep copy by showing that
// arrShallowCopy contains arrOriginal.
alert("It is " + (arrShallowCopy[3] === arrOriginal)
    + " that arrShallowCopy contains arrOriginal.");

// Make a deep copy of the recursive array.
var arrDeepCopy = arrOriginal.clone(true);

// Prove that the deep copy really works by showing that the original array is
// not the fourth item in arrDeepCopy but that this new array is.
alert("It is "
    + (arrDeepCopy[3] !== arrOriginal && arrDeepCopy === arrDeepCopy[3])
    + " that arrDeepCopy contains itself and not arrOriginal."); 
```

您可以[在 JS Bin 处](http://jsbin.com/jPaq-Array.clone/2)使用此代码。

# c# - 使用 NHibernate/FluentHibernates 保存表作为参数

> ID：565443
> 
> 赞同：1
> 
> 时间：2009-02-19T14:03:52.077
> 
> 标签：c#, nhibernate, fluent-nhibernate

我有一组答案 ( `IList<Answer>`) 和两个表（答案和答案历史）。我想做一些类似的事情：

```
Get the current answers from db.

save(Answers, "AnswerHist");
delete(Answers, "Answer");

Answers = questions
                            .Select(x => new Answer(response)
                            {
                                QuestionID = x.QuestionID,
                                Value = x.Answer.Value,
                                Bool = x.Answer.Bool,
                                Date = x.Answer.Date,
                                Number = x.Answer.Number,
                                Text = x.Answer.Text
                            })
                            .ToList<Answer>(); 
```

保存（答案，“答案”）；

基本上，将答案保存到历史表中，从答案表中删除答案，然后更新答案并将它们插入到答案表中。

有什么简单的方法可以让休眠保存同一个类和多个相同的表？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-19T14:31:47.703

据我所知，类和表之间的映射是静态的，不能更改。您可以创建一个`AnswerHistory`类并将其映射到`AnswerHist`表格：

```
public class AnswerHistory : Answer {
    public AnswerHistory (Answer answer) {
        this.QuestionID = answer.QuestionID;
        this.Value = answer.Value;
        // ...
    }
} 
```

然后你会像这样使用它：

```
save(Answers.Select(answer => new AnswerHistory(answer)));
delete(Answers);

Answers = new stuff;
save(Answers); 
```

另一种选择是在答案中添加一个布尔值，无论它是否在历史记录中；那么您只需要设置该布尔值并保存（到同一个表）。

# c# - 为一组随机值生成多个范围

> ID：565450
> 
> 赞同：2
> 
> 时间：2009-02-19T14:06:41.463
> 
> 标签：c#, database, random, range

给定数据库中的一组随机数值，如何生成一个有限的范围列表，其中每个范围至少包含一个值？这些范围不应重叠，并且理想情况下它们中的值数量相似。理想情况下，它们的边界也应该是 10、100、1000 等的倍数......

例如：

```
值：100,150,180,300,400,500,600,650,700
结果是
4 个范围：100-180(2)、180-300(1)、300-600(3)、600-800(3)
```

这如何在 C# 或 T-SQL 中完成？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-19T14:14:48.463

在`MS SQL 2005+`：

```
SELECT range, (MIN(getprev) + MIN(value)) / 2 as range_start, (MAX(getnext) + MAX(value)) / 2 AS range_end, COUNT(*) as range_values
FROM (
  SELECT value,
         NTILE(4) OVER (ORDER BY value ) AS range,
         (
         SELECT TOP 1 value
         FROM values li
         WHERE li.value < lo.value
         ORDER BY
           li.value DESC
         ) AS getprev,
         (
         SELECT TOP 1 value
         FROM values li
         WHERE li.value > lo.value
         ORDER BY
           li.value
         ) AS getnext
  FROM values lo
) vo
GROUP BY range
ORDER BY range 
```

在你的情况下：

```
1 100 240 3
2 240 450 2
3 450 625 2
4 625 700 2

```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-19T14:15:22.580

假设我们想要每个范围都有一个值： 值：100 150 180 300 只需生成这些随机数：

```
- a: 0 <= 100, eg: 50
- b: 100 <= 150, eg: 125
- c: 150 <= 180, eg: 165
- d: 180 <= 300, eg: 200
- e: 300 <=    , eg: 350 
```

...

范围：： `50-125 (1), 125-180(1), 180-200(1), 200 - 350 (1) ...`每一个都包含一个数字。

现在要在每个范围内有多个数字，只需开始跳过数字，例如跳过 c（可以随机选择跳过一个）：跳过 c：

```
50-125(1), 125-200(2), 200-350(1) 
```

# silverlight - Silverlight 中的小动画

> ID：565453
> 
> 赞同：2
> 
> 时间：2009-02-19T14:07:47.903
> 
> 标签：silverlight, animation

我制作了一个简单的故事板，它采用特定的 ListBoxItem 并让它增长 1.3 倍。我想将此动画添加到我动态创建的每个 ListBoxItem 中，以便在鼠标悬停时可以激活它，但情节提要似乎被硬编码为第一个项目：

```
 <Storyboard x:Name="ListItem_MouseEntered">
        <DoubleAnimationUsingKeyFrames BeginTime="00:00:00" Storyboard.TargetName="RecentNews" Storyboard.TargetProperty="(UIElement.RenderTransform).(TransformGroup.Children)[0].(ScaleTransform.ScaleX)">
            <SplineDoubleKeyFrame KeyTime="00:00:00.3000000" Value="1.3"/>
        </DoubleAnimationUsingKeyFrames>
        <DoubleAnimationUsingKeyFrames BeginTime="00:00:00" Storyboard.TargetName="RecentNews" Storyboard.TargetProperty="(UIElement.RenderTransform).(TransformGroup.Children)[0].(ScaleTransform.ScaleY)">
            <SplineDoubleKeyFrame KeyTime="00:00:00.3000000" Value="1.3"/>
        </DoubleAnimationUsingKeyFrames>
    </Storyboard> 
```

我应该如何复制这个故事板并将目标设置为每个列表框项？

干杯

尼克

PS，我相信我在动画中有一些错误，别担心，这不是我的问题的一部分:-)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-19T14:15:48.850

如果您使用可视状态管理器，则可以将其应用于所有类型：

[这](http://silverlight.net/forums/t/23491.aspx)显示了如何做到这一点。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-19T15:15:10.160

*您可以在UserControl*的*Resources*部分中为*ListBoxItem*定义一个**ControlTemplate** ，如下所示：

 ***```
<ControlTemplate x:Key="LIT" TargetType="ListBoxItem">
    <Border x:Name="MainBorder" BorderBrush="Red" BorderThickness="2" Background="Yellow" MouseEnter="Border_MouseEnter">
        <Border.Resources>
            <Storyboard x:Name="ItemStory">
                <DoubleAnimationUsingKeyFrames BeginTime="00:00:00" Storyboard.TargetName="ItemTransform" Storyboard.TargetProperty="ScaleX">
                    <SplineDoubleKeyFrame KeyTime="00:00:00.3000000" Value="1.3"/>
                </DoubleAnimationUsingKeyFrames>
                <DoubleAnimationUsingKeyFrames BeginTime="00:00:00" Storyboard.TargetName="ItemTransform" Storyboard.TargetProperty="ScaleY">
                    <SplineDoubleKeyFrame KeyTime="00:00:00.3000000" Value="1.3"/>
                </DoubleAnimationUsingKeyFrames>
            </Storyboard>
        </Border.Resources>
        <Border.RenderTransform>
            <ScaleTransform x:Name="ItemTransform" />
        </Border.RenderTransform>
        <TextBlock Text="{TemplateBinding Content}" />
    </Border>
</ControlTemplate> 
```

处理 MouseEnter 事件：

```
private void Border_MouseEnter(object sender, MouseEventArgs e)
{
    Border itemBorder = (Border)sender;
    Storyboard itemStory = (Storyboard)itemBorder.FindName("ItemStory");

    itemStory.Begin();
} 
```

并在 XAML 中像这样使用它：

```
<ListBox x:Name="MyList">
    <ListBox.Items>
        <ListBoxItem Content="Toto 1" Template="{StaticResource LIT}" />
    </ListBox.Items>
</ListBox> 
```

或者在 C# 中像这样：

```
MyList.Items.Add(new ListBoxItem()
{
    Content="Toto 2",
    Template = (ControlTemplate)Resources["LIT"]
}); 
```

# java - Java 事件处理程序

> ID：565458
> 
> 赞同：0
> 
> 时间：2009-02-19T14:09:26.387
> 
> 标签：java, swing, event-handling

我正在编写一个小型 Java 应用程序（在 Windows 上，因此在我的名字后面附加了 _on_vista）。

我有 3 个按钮，所有这些按钮都会对点击事件做出反应，但会做不同的事情。

以下代码是公认的方式还是我不知道的更清洁的方式？一方面，它有效，另一方面，似乎有些不对劲......

谢谢

```
cool_button_1.addActionListener(new ActionListener() {
    public void actionPerformed(ActionEvent e) {
        coolfunction1();
    }
});

cool_button_2.addActionListener(new ActionListener() {
    public void actionPerformed(ActionEvent e) {
        coolfunction2();
    }
});

// etc ... 
```

被调用的函数将根据需要产生线程，依此类推。

**更新**- 两者都是很好（几乎相同）的答案。我接受了代表较低的那个来分享财富。再次感谢各位。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-19T14:12:10.717

是的，这是正确的方法。这有点笨拙（必须编写五行长代码才能调用方法）但那是 Java :(

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-19T14:18:23.073

这还不错。我更喜欢使用[Actions](http://java.sun.com/j2se/1.5.0/docs/api/javax/swing/Action.html)并从中创建[JButtons ：](http://java.sun.com/j2se/1.5.0/docs/api/javax/swing/JButton.html)

```
Action fooAction = new AbstractAction() { ... };
JButton fooButton = new JButton(fooAction); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-19T14:20:44.113

它是正确的方法之一。

您正在使用匿名侦听器，但有一个替代方案

[在http://java.sun.com/docs/books/tutorial/uiswing/events/intro.html](http://java.sun.com/docs/books/tutorial/uiswing/events/intro.html)上很好地解释了

您在其中编写一个实现 ActionListener 并让它为您处理逻辑的类

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-19T14:12:53.477

我会说代码很好，就像 Java 代码一样。这是 Java 经常受到批评的冗长的一个很好的例子——在这种情况下，由于缺少闭包。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-19T14:57:13.633

我倾向于做这样的事情：

```
public class ButtonPanel implements ActionListener {
    JButton button1, button2, button3;
    public ButtonPanel() {
        button1 = new JButton(this);
        button2 = new JButton(this);
        button3 = new JButton(this):
        ...
    }

    public void ActionPerformed(ActionEvent e) {
        if( e.getSource() == button1 ) action1();
        else if( e.getSouce() == button2  ) action2();
        else if( e.getSource() == button3 ) action3();
    }
} 
```

# c++ - 具有相同名称的 C++ 包装器？

> ID：565459
> 
> 赞同：3
> 
> 时间：2009-02-19T14:09:38.757
> 
> 标签：c++, wrapper

如何执行一个包装函数，它调用另一个函数，其名称和参数与全局命名空间中的包装函数本身完全相同？

例如我在 Ah foo(int bar); 在 A.cpp 它的实现中，在 Bh foo(int bar); 并在 B.cpp foo(int bar) { foo(bar) }

我希望 B.cpp 的 foo(bar) 调用 Ah 的 foo(int bar)，而不是递归本身。

我怎样才能做到这一点？我不想重命名 foo.

**更新：**

啊在全局命名空间中，我无法更改它，所以我想使用命名空间不是一个选项？

**更新：**

命名空间解决了这个问题。我不知道你可以用 ::foo() 调用全局命名空间函数

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-19T14:12:39.013

使用命名空间

```
namespace A
{
int foo(int bar);
};
namespace B
{
int foo(int bar) { A::foo(bar); }
}; 
```

您也可以使用命名空间 A 编写；在您的代码中，但强烈建议不要在标头中使用命名空间编写。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-19T14:23:52.263

B 完全继承/实现 A 吗？

如果是这样，您可以使用

```
int B::foo(int bar)
{
   ::foo（酒吧）；
}

```

访问全局命名空间中的 foo

或者如果它不继承..您只能在 B 上使用命名空间

```
命名空间 B
{
int foo(int bar) { ::foo(bar); }
};

```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-19T14:12:55.300

这是命名空间试图解决的问题。您可以将名称空间添加到有问题的 foo 中吗？那么你有办法解决这个问题。无论如何，如果它们都在全局命名空间中，您会遇到链接器问题。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-19T14:24:31.467

如果不使用命名空间、更改其中一个函数的名称、更改签名或将其中之一设为静态，则无法执行此操作。问题是您不能有 2 个具有相同名称的函数。所以需要有一些东西让它们与众不同。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-19T14:21:07.950

如上所述，命名空间是一种解决方案。但是，假设您具有这种级别的灵活性，为什么不将此函数封装到类/结构中呢？

# opengl - 有些面是透明的，有些是不透明的

> ID：565463
> 
> 赞同：3
> 
> 时间：2009-02-19T14:10:49.533
> 
> 标签：opengl, transparency

我用 OpenGL创建了一个[常规的十二面体。](http://en.wikipedia.org/wiki/Dodecahedron)我想让面孔透明（如维基百科上的图像），但这并不总是有效。在 OpenGL 文档中进行了一些挖掘之后，似乎我“需要[从后到前对透明面进行排序](http://www.opengl.org/resources/faq/technical/transparency.htm)”。嗯。我怎么做？

我的意思是我调用 glRotatef() 来旋转坐标系，但面的参考坐标保持不变；旋转效果应用在我的更新代码的“外部”。

如果我将变换应用于坐标，那么其他一切都将停止移动。

*在这种情况下如何对人脸进行排序？*

[编辑] 我知道*为什么*会这样。我不知道解决方案会是什么样子。有人可以指导我正确的 OpenGL 调用或一段示例代码吗？我知道坐标变换何时完成，并且我有面顶点的坐标。我知道如何计算人脸的中心坐标。我知道我需要按 Z 值对它们进行排序。如何通过当前视图矩阵（或任何旋转我的坐标系的东西）转换 Vector3f？

旋转视图的代码：

```
 glRotatef(xrot, 1.0f, 0.0f, 0.0f);
    glRotatef(yrot, 0.0f, 1.0f, 0.0f); 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-19T14:38:15.537

当 OpenGL 文档说“对透明面进行排序”时，它的意思是“更改绘制它们的顺序”。您不转换面本身的几何形状，而是确保以正确的顺序绘制面：首先离相机最远，最后离相机最近，以便颜色在帧缓冲区中正确混合。

一种方法是为每个透明面计算距相机的代表距离（例如，其中心距相机中心的距离），然后根据该代表距离对透明面列表进行排序。

您需要这样做，因为 OpenGL 使用[Z 缓冲](http://en.wikipedia.org/wiki/Z-buffering)技术。

（我要补充一点，“按人脸中心距离排序”的技术有点幼稚，在人脸大或靠近相机的情况下会导致错误的结果。但它很简单，会让你开始；以后会有很多时间来担心更复杂的 Z 排序方法。）

* * *

更新：Aaron，您澄清了帖子以表明您了解上述内容，但不知道如何为每个人脸计算合适的 Z 值。是对的吗？我通常会通过测量从相机到相关面部的距离来做到这一点。所以我想这意味着你不知道相机在哪里？

如果这是您遇到的问题的正确陈述，请参阅[OpenGL FAQ 8.010](http://www.opengl.org/resources/faq/technical/viewing.htm#view0010)：

> 就OpenGL而言，没有相机。更具体地说，相机总是位于眼睛空间坐标（0., 0., 0.）。

* * *

更新：也许问题是你不知道如何通过模型视图矩阵转换一个点？如果*这是*问题所在，请参阅[OpenGL FAQ 9.130](http://www.opengl.org/resources/faq/technical/transformations.htm#tran0130)：

> 通过将点乘以 ModelView 矩阵，将点转换为眼睛坐标空间。然后简单地计算它与原点的距离。

用于`glGetFloatv(GL_MODELVIEW_MATRIX, dst)`将模型视图矩阵作为 16 个浮点数的列表。我认为您必须自己进行乘法运算：据我所知，OpenGL 没有为此提供 API。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-19T15:46:34.993

作为参考，这里是代码（使用 lwjgl 2.0.1）。我通过使用浮点数组的数组来定义我的模型：

```
 float one = 1f * scale;

        // Cube of size 2*scale
        float[][] coords = new float[][] {
            {  one,  one,  one }, // 0
            { -one,  one,  one },
            {  one, -one,  one },
            { -one, -one,  one },
            {  one,  one, -one },
            { -one,  one, -one },
            {  one, -one, -one },
            { -one, -one, -one }, // 7
        }; 
```

面在 int 数组的数组中定义。内部数组中的项目是顶点的索引：

```
 int[][] faces = new int[][] {
            { 0, 2, 3, 1, },
            { 0, 4, 6, 2, },
            { 0, 1, 5, 4, },
            { 4, 5, 7, 6, },
            { 5, 1, 3, 7, },
            { 4, 5, 1, 0, },
        }; 
```

这些行加载模型/视图矩阵：

```
 Matrix4f matrix = new Matrix4f ();
        FloatBuffer params = FloatBuffer.allocate (16);
        GL11.glGetFloat (GL11.GL_MODELVIEW_MATRIX, params );
        matrix.load (params); 
```

我将每张脸的一些信息存储在 Face 类中：

```
public static class Face
{
    public int id;
    public Vector3f center;

    @Override
    public String toString ()
    {
        return String.format ("%d %.2f", id, center.z);
    }
} 
```

然后使用此比较器按 Z 深度对面进行排序：

```
public static final Comparator<Face> FACE_DEPTH_COMPARATOR = new Comparator<Face> ()
{
    @Override
    public int compare (Face o1, Face o2)
    {
        float d = o1.center.z - o2.center.z;
        return d < 0f ? -1 : (d == 0 ? 0 : 1);
    }

}; 
```

`getCenter()`返回面的中心：

```
 public static Vector3f getCenter (float[][] coords, int[] face)
    {
        Vector3f center = new Vector3f ();
        for (int vertice = 0; vertice < face.length; vertice ++)
        {
            float[] c = coords[face[vertice]];
            center.x += c[0];
            center.y += c[1];
            center.z += c[2];
        }
        float N = face.length;
        center.x /= N;
        center.y /= N;
        center.z /= N;
        return center;
    } 
```

现在我需要设置人脸数组：

```
 Face[] faceArray = new Face[faces.length]; 
        Vector4f v = new Vector4f ();
        for (int f = 0; f < faces.length; f ++)
        {
            Face face = faceArray[f] = new Face ();
            face.id = f;
            face.center = getCenter (coords, faces[f]);
            v.x = face.center.x;
            v.y = face.center.y;
            v.z = face.center.z;
            v.w = 0f;
            Matrix4f.transform (matrix, v, v);
            face.center.x = v.x;
            face.center.y = v.y;
            face.center.z = v.z;
        } 
```

在这个循环之后，我得到了转换后的中心向量，`faceArray`我可以按 Z 值对它们进行排序：

```
 Arrays.sort (faceArray, FACE_DEPTH_COMPARATOR);
        //System.out.println (Arrays.toString (faceArray)); 
```

渲染发生在另一个嵌套循环中：

```
 float[] faceColor = new float[] { .3f, .7f, .9f, .3f };
        for (Face f: faceArray)
        {
            int[] face = faces[f.id];
            glColor4fv(faceColor);

            GL11.glBegin(GL11.GL_TRIANGLE_FAN);
            for (int vertice = 0; vertice < face.length; vertice ++)
            {
                glVertex3fv (coords[face[vertice]]);
            }
            GL11.glEnd();
        } 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-19T14:37:03.933

您是否尝试过从后到前绘制与常规世界坐标相关的每张脸？通常，某些 OpenGL 文档中的措辞似乎很奇怪。我认为，如果您以正确的顺序绘制图形而不用担心旋转，它可能会在您添加旋转时自动工作。OpenGL 可能会在旋转矩阵时处理面的重新排序。

或者，您可以在绘制时获取当前矩阵（**glGetMatrix()**）并根据哪些面将被旋转后/前重新排序您的绘图算法。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-19T14:37:42.993

那句话说明了一切——你需要对面孔进行分类。

当绘制这样一个简单的对象时，您可以使用 z-buffer 先渲染背面，然后再渲染正面（通过使用不同的 z-buffer 比较函数渲染两次）。

但通常，您只想变换对象，然后对面进行排序。您只转换内存中对象的表示，然后通过排序确定绘制顺序，然后使用原始坐标按该顺序绘制，根据需要使用转换（需要与您所做的排序一致）。在实际应用程序中，您可能会隐式进行转换，例如。通过将场景存储为 BSP 或 Quad- 或 R- 或任何树，并简单地从各个方向遍历树。

请注意，排序部分可能很棘手，因为函数“is-obsucred-by”是您想要比较面孔的函数（因为您需要先绘制被遮挡的面孔）不是排序，例如。可以有循环（A面遮盖B && B面遮盖A）。在这种情况下，您可能会拆分其中一个面以中断循环。

编辑：

您可以通过获取传递给 的坐标来获得顶点的 z 坐标，`glVertex3f()`通过附加 1 使其成为 4D（齐次坐标），使用模型视图矩阵对其进行变换，然后使用投影矩阵对其进行变换，然后进行透视除法。详细信息在第 2 章坐标转换部分的 OpenGL 规范中。

但是，没有任何 API 可供您实际进行转换。OpenGL 让您做的唯一一件事就是绘制图元，并告诉渲染器如何绘制它们（例如，如何转换它们）。它不会让您轻松地转换坐标或其他任何东西（尽管 IIUC 有方法告诉 OpenGL 将转换后的坐标写入缓冲区，但这并不容易）。如果您想要一些库来帮助您操作实际对象、坐标等，请考虑使用某种场景库（OpenInventor 或其他东西）

# asp.net - ASP.NET 日志记录 - 最佳实践

> ID：565471
> 
> 赞同：15
> 
> 时间：2009-02-19T14:12:59.030
> 
> 标签：asp.net, iis, logging, .net-2.0

在 ASP.NET 2.0 网页或 Web 服务中编写最少错误日志的最佳方法是什么？就我的目的而言，最好是香草，并且实现将通过 IIS 的虚拟目录进行。我目前正在使用标准的 TextWriterTraceListener，但它似乎没有写入虚拟目录。

仅供参考 - TextWriterTraceListener 的配置如下：

```
<system.diagnostics>
    <trace autoflush="true">
      <listeners>
        <add name="myListener" type="System.Diagnostics.TextWriterTraceListener" initializeData=".\VirtualDirectory\SomeLog.log" />
      </listeners>
    </trace>
  </system.diagnostics> 
```

我感谢您的帮助！

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-02-19T14:19:42.617

你可以试试 log4net 框架。它是非常强大的开源 .NET 日志框架。看看[Log4net 网站](http://logging.apache.org/log4net/index.html)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-19T14:25:24.723

你真的应该看看 log4net。看到[这个问题](https://stackoverflow.com/questions/98080/what-is-the-best-logging-solution-for-a-c-net-3-5-project/98791#98791) 现在看起来可能比您需要的要多，但是一旦您将它作为架构的一部分，它就会在您需要时随时可用并准备就绪。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-19T14:52:05.567

如果您只是在寻找返回给用户的异常记录，请尝试 ELMAH：

[http://code.google.com/p/elmah/](http://code.google.com/p/elmah/)

另一方面，如果您希望跟踪应用程序中的活动，您当然可以尝试 log4net。我自己更喜欢 nLog，你可以在这里找到它：

[http://www.nlog-project.org/](http://www.nlog-project.org/)

这两个都是开源的。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2011-08-30T08:54:59.067

您可以尝试 System.Diagnosis.TraceSource，它内置于 .NET 2.0

[记录最佳实践](https://stackoverflow.com/questions/576185/logging-best-practices)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-19T14:33:36.000

[在这里为log4net](http://logging.apache.org/log4net/index.html)再次投票。我在 Windows 服务中托管了一个复杂的远程处理应用程序，它非常有用。

log4net 非常强大且易于配置。您可以始终进行最小日志记录，然后通过更改配置设置以多个增量打开更详细的日志记录。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-19T14:26:49.167

我推荐包含 Logging Application 块的 Microsoft Enterprise Library。我已经使用了一段时间并且效果很好。

[http://www.codeplex.com/entlib/Release/ProjectReleases.aspx?ReleaseId=4474](http://www.codeplex.com/entlib/Release/ProjectReleases.aspx?ReleaseId=4474)

我在 WebApps 中使用它来写入虚拟目录。它相当精细，您可以轻松地为自己的应用程序自定义它

这个[http://www.codeproject.com/KB/architecture/GetLoggingWithEntLib.aspx](http://www.codeproject.com/KB/architecture/GetLoggingWithEntLib.aspx)是一篇关于使用它的好文章

# uuid - 选择一个 UUID

> ID：565475
> 
> 赞同：1
> 
> 时间：2009-02-19T14:14:22.037
> 
> 标签：uuid

我们需要为存储在后端的每个条目生成 UUID。正如我在 Wikipedia: Uuid Java implementation 中读到的，有 3 个可用的 UUID 生成器：

```
- Standard Java UUID generator(which only support version 3 and 4)
- JUG  which support all the version but 2
- UUID  which only support version 1 (MAC address based) 
```

请告知我们应该使用哪个生成器，假设许可证是兼容的？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-19T14:22:36.697

版本 3 不会解决您为每个条目生成*新UUID 的问题。*如果您没有其他要求（例如安全性），版本 1 通常就足够了。

如果您想隐藏所有可能的信息（MAC 地址和生成时间），请使用版本 4。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-19T15:09:01.313

默认情况下，Windows 使用的 UUID 生成器是版本 4 生成器。

使用 v4 UUID 的标准 Java 生成器可以正常工作。

# authentication - 在达到会话和身份验证票超时值之前，用户被迫随机重新登录

> ID：565476
> 
> 赞同：7
> 
> 时间：2009-02-19T14:14:22.503
> 
> 标签：authentication, session, iis-6, forms-authentication, asp.net-2.0

我收到来自我的用户的报告和投诉，他们将使用屏幕并在下一次请求时立即被踢回登录屏幕。它不会一直发生，而是随机发生。查看 Web 服务器后，应用程序事件日志中显示的错误是：

*事件代码：4005 事件消息：请求的表单身份验证失败。原因：提供的票已过期。*

我阅读的所有内容都是从人们询问网络花园或负载平衡开始的。我们没有使用其中任何一个。我们是带有 IIS6 的单一 Windows 2003（32 位操作系统，64 位硬件）服务器。这也是该服务器上唯一的网站。

此行为不会对用户产生任何应用程序异常或可见问题。他们只是被引导回到登录屏幕并被迫登录。正如您可以想象的那样，这对我们的用户来说非常烦人和适得其反。

这是我在 web.config 中为根中的应用程序设置的内容：

```
<authentication mode="Forms">
      <forms name=".TcaNet"
        protection="All"
        timeout="40"
        loginUrl="~/Login.aspx"
        defaultUrl="~/MyHome.aspx"
        path="/"
        slidingExpiration="true"
        requireSSL="false" />
    </authentication> 
```

我还读到，如果您的某些位置设置不再存在或者是虚假的，您可能会遇到问题。我的路径属性都是有效的目录，所以这不应该是问题：

```
<location path="js">
    <system.web>
      <authorization>
        <allow users="*" />
      </authorization>
    </system.web>
  </location>
  <location path="images">
    <system.web>
      <authorization>
        <allow users="*" />
      </authorization>
    </system.web>
  </location>
  <location path="anon">
    <system.web>
      <authorization>
        <allow users="*" />
      </authorization>
    </system.web>
  </location>
  <location path="App_Themes">
    <system.web>
      <authorization>
        <allow users="*" />
      </authorization>
    </system.web>
  </location>
  <location path="NonSSL">
    <system.web>
      <authorization>
        <allow users="*" />
      </authorization>
    </system.web>
  </location> 
```

我唯一不清楚的是，我在表单属性中的身份验证票的超时值是否必须与我的会话超时值（在 IIS 中的应用程序配置中定义）相同。我读过一些东西说你应该让身份验证超时（40）比会话超时（45）更短，以避免可能的并发症。无论哪种方式，我们都有用户在他们最后一次操作后一两分钟被踢到登录屏幕。所以会话绝对不应该过期。

***2009 年 2 月 23 日更新：我已经将会话超时和身份验证票证超时值都设置为 45，问题似乎仍然存在。***

应用程序中唯一的其他 web.config 位于托管社区服务器的 1 个虚拟目录中。该 web.config 的身份验证设置如下：

```
<authentication mode="Forms">
            <forms name=".TcaNet" 
            protection="All" 
            timeout="40" 
            loginUrl="~/Login.aspx" 
            defaultUrl="~/MyHome.aspx" 
            path="/" 
            slidingExpiration="true" 
            requireSSL="true" />
        </authentication> 
```

虽然我不认为它适用，除非您在网络花园中，但我将两个 web.config 文件中的机器键值设置为相同（为方便起见已删除）：

```
<machineKey 
        validationKey="<MYVALIDATIONKEYHERE>" 
        decryptionKey="<MYDECRYPTIONKEYHERE>" 
        validation="SHA1" />

<machineKey 
        validationKey="<MYVALIDATIONKEYHERE>" 
        decryptionKey="<MYDECRYPTIONKEYHERE>" 
        validation="SHA1"/> 
```

对此的任何帮助将不胜感激。这似乎是产生大量谷歌结果的问题之一，到目前为止，这些结果似乎都不适合我的情况。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-24T20:13:41.230

检查应用程序池的Maximum Worker Processes 属性可能也是值得的。如果您在内存中使用会话并且有多个作为最大工作进程，您会发现会话问题，因为用户请求由不知道其会话的不同线程处理。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-04-29T19:21:59.593

既然您已经注意到您正在为您的站点使用一个非常特定的 FQDN，那么您是否有任何其他 .Net 应用程序在相同的 FQDN 下运行，只是不同的虚拟路径？两个应用程序的身份验证 cookie 的名称可能相同，但令牌会不同。因此，如果我登录 www.domain.com，然后登录 www.domain.com/app2，我将不再对 app1 进行正确的身份验证。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-19T18:36:02.920

1.) 检查您的 iis 进程被回收的频率。（打开[日志记录](http://www.microsoft.com/technet/prodtechnol/WindowsServer2003/Library/IIS/24e3c22e-79a9-4f07-a407-dbd0e7f35432.mspx?mfr=true)并[检查您的设置](http://technet.microsoft.com/en-us/library/cc786196.aspx)）。回收后，使用 proc 会话存储中的默认值，会话将丢失。

2.) 您的应用程序是否生成可能引发异常的线程（顺便说一句，不会向用户显示）？因为如果存在这种情况，iis 会更频繁地回收进程。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2015-09-10T04:54:03.387

我刚刚完成了这个精确问题的处理，完全按照问题中的描述，问题是 web.config 中缺少一些配置。

使用 formsAuthentication 时，您需要停止让会话处理身份验证，因为 cookie 现在负责它。

需要在您的 Web 配置中的“system.web”元素中添加（或更新）这一行

```
<sessionState mode="Off"> 
```

sessionState 和 formsAuthentication 不应同时处于活动状态。我不了解它们如何相互干扰的细节，但在这种情况下，它会在随机时间产生随机用户的随机注销。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2016-08-10T09:19:21.930

我们的网站多年来一直遇到同样的问题，但昨天我们找到了解决方法，请参阅[我的问题](https://stackoverflow.com/q/38851190/1845672)。正如评论者建议的那样，我尝试将其添加到 web.config：

```
<sessionState mode="InProc" timeout="60" /> 
```

显然，必须在 sessionState 和票证中都设置超时。[另请参阅https://msdn.microsoft.com/en-us/library/ms178586.aspx](https://msdn.microsoft.com/en-us/library/ms178586.aspx)中的 ms 文档

为了在调试模式下更准确地测量实际超时，我发现在方法和`Debug.WriteLine`文件中添加调用很方便，使用添加毫秒时间`Global.asax.cs``Session_Start()``Session_End()`

```
string.Format("{0:HH:mm:ss.fff} - {1}", DateTime.Now, strMessage); 
```

这样您就可以登录，去吃午饭，让会话超时，并在 VisualStudio 输出窗口中的某个方便的时刻读取时间戳。

# perl - 如何使用 vim 在 Perl 中自动折叠 POD？

> ID：565486
> 
> 赞同：5
> 
> 时间：2009-02-19T14:16:17.697
> 
> 标签：perl, vim, folding

我正在尝试使用 vim 编辑文件并自动折叠 POD（只是 POD，而不是 Perl）。我无法让它工作。我可以让折叠本身工作，因为我可以手动突出显示线条和类型`zF`并且它可以正确折叠。

任何人都可以阐明这一点吗？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-19T16:01:22.123

你忘了

```
:set foldmethod=syntax
:setf perl
:syntax on
:set foldenable
:syn region POD start=/^=head[123]/ end=/^=cut/ fold 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2014-10-27T22:20:55.077

将以下内容粘贴到~/.vimrc 文件的*末尾：*

```
fu! MyFoldSettings()
  set foldmethod=expr
  set foldexpression=MyFoldLevel(v:lnum)
  set foldenable
  set foldminlines=1
endf      

fu! MyFoldLevel(lev)
    let mytext = getline(a:lev)
    let result="="
    if mytext =~ '^=item'
        let result=">3"
    elsei mytext =~ '^=back'
        let result="<2"
    elsei mytext =~ '^=over'
        let result=">2"
    elsei mytext =~ '^=cut'
        let result="<1"
    elsei mytext =~ '^=\w\+'
        let result='>1'
    en    
    return result
endf

augroup MyFoldSettings_AutoCommands
   au!
   au BufReadPost {*.pl,*.pod,*.pm} MyFoldSettings()
augroup END 
```

这应该在大多数情况下都有效——这只是一个快速而肮脏的例子，但如果你需要更多功能，你也可以添加更多。此外，要确保启用此功能，您可能需要添加模式行：

```
# vim:fen:fdo=hor:fcl=all:fdm=expr:fde=MyFoldLevel(v:lnum):fml=1 
```

如果此时您没有看到折叠文本，请尝试设置“foldopen=hor”和“foldclose=all”，这将使导航进/出折叠更容易。此外，如果您需要将其应用于其他文件或文件类型，您可以相应地设置 au（自动命令）。干杯。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2015-07-16T16:17:05.640

你可以把它放在你的 .vimrc 中：

```
au FileType perl
    \ setlocal foldexpr=getline(v:lnum)=~'^=cut'?'<1':getline(v:lnum)=~'^='?'1':'=' |
    \ setlocal foldmethod=expr 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2015-08-29T10:21:33.757

只需定义 perl_fold_* 变量，系统 perl 语法高亮器将处理其余部分。

在 .vimrc 中，只需添加

```
let perl_fold=1
let perl_fold_blocks=1 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2019-04-09T19:02:14.503

这是我正在使用的，

```
set syntax                                                                                                                                                               

augroup perl_folding                                                                                                                                                     
    au!                                                                                                                                                                  
    autocmd FileType perl setlocal foldmethod=syntax                                                                                                                     
    autocmd FileType perl setlocal foldlevel=1                                                                                                                           
    autocmd FileType perl let perl_fold = 1                                                                                                                              
    autocmd FileType perl let perl_fold_blocks = 1                                                                                                                       
    autocmd FileType perl setlocal foldenable                                                                                                                            
    au BufRead,BufNewFile *.pm set filetype=perl                                                                                                                         
augroup END 
```

# c# - 带分隔符的电子邮件模板

> ID：565493
> 
> 赞同：1
> 
> 时间：2009-02-19T14:18:05.990
> 
> 标签：c#, asp.net

在 DasBlog 中，模板使用以下语法，例如：

<h1><%= MyMacro() %></h1>

在一个 txt 文件中，我的查询是，如何在运行时评估它？DasBlog 的作者是否以编程方式使用 AspCompiler？

是否有我遗漏的评估语句或者作者只是使用正则表达式搜索和替换？我怀疑后者，但无论如何我都需要问。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-20T11:25:32.640

System.Web 命名空间包含像这样编译文本的方法。当您拥有物理路径时，一种方法是：

```
 IHttpHandler pageInstance = PageParser.GetCompiledPageInstance(viewPath, physicalPath, HttpContext);
    pageInstance.ProcessRequest(HttpContext); 
```

# winapi - 如何检测哪个窗口遮挡了另一个？

> ID：565494
> 
> 赞同：1
> 
> 时间：2009-02-19T14:18:19.703
> 
> 标签：winapi

如果我有两个窗口的把手，我如何判断一个是否遮挡了另一个？显然我可以轻松地进行碰撞测试，但我如何测试/找出它们的“z 顺序”？这些窗口来自完全不同的应用程序。

我可能错过了一些相当明显的东西..

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-19T14:28:36.667

WindowFromPoint，（使用一个以一个窗口为边界的点，看看你是否取回了那个窗口的句柄，或者另一个）。

对于部分遮挡，您可以使用剪裁系统。我在我的网站上更详细地讨论了[这个](http://bobmoore.mvps.org/Win32/w32tip72.htm)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-19T14:29:16.743

[本页](http://msdn.microsoft.com/en-us/library/ms632599(VS.85).aspx#zorder)讨论窗口的 Z 顺序。它没有提到直接获取 Z 顺序的函数，但它确实指向`[GetNextWindow()](http://msdn.microsoft.com/en-us/library/ms633509(VS.85).aspx)`，给定一个窗口可以返回 Z 顺序中的下一个（或上一个，不要让名字欺骗你）。使用它，您应该能够弄清楚。

# fonts - 在 Cygwin 中如何更改字体颜色？

> ID：565497
> 
> 赞同：24
> 
> 时间：2009-02-19T14:19:15.440
> 
> 标签：fonts, cygwin

我想开始使用 Cygwin，但我对字体颜色不满意，想将其更改为带有黑色背景的浅绿色。

（我试过谷歌搜索无济于事顺便说一句）

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-02-19T14:34:11.817

它基本上只是一个 DOS 窗口。所以点击shell窗口左上角的图标来获取菜单。转到属性。然后，您可以更改颜色、字体、命令历史记录和编辑选项（您需要打开快速编辑和插入模式）。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-02-19T14:55:46.150

我自己发现标准外壳非常可怕。

我下载并安装了 rxvt 包并更改了 cygwin.bat 以启动 rxvt，它更好地支持 copy-cut-n-paste。

```
@echo off
c:
chdir c:\data\cygwin\bin
set EDITOR=vi
set VISUAL=vi
set CYGWIN=codepage:ansi
rxvt -fn '*-courier-*-r-*-16-*' -sl  9999 -bg Black -fg Cyan -e /bin/bash -login 
```

-e 和 -login 将启动 shell 切换到 rxvt 和其余部分： -fn 设置 courier 大小 16 字体（告我） -sl 滚动行 9999 黑色背景和青色前景选择文本将自动填充粘贴缓冲区最后一点（-e /bin/bash -login）启动 bash 并告诉它它是一个运行配置文件设置等的登录 shell。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-02-19T14:44:26.020

如果您想要一个比 Windows 命令行窗口更好的终端与 cygwin 一起使用，您可以`xterm`从 cygwin 中开始，或者查看使用[puttycyg](http://code.google.com/p/puttycyg/)，这是 Windows ssh 客户端 putty 的修补版本，旨在与本地 cygwin 安装一起使用（在除了正常的 ssh 功能）。puttycyg 应该为您提供比 Windows 命令行窗口更好的终端控制。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2013-12-15T12:54:22.373

虽然其他人建议使用不同的终端，但默认的 Cygwin 终端仿真器 (mintty) 允许您自行更改颜色。您可以通过选项对话框更改前景色、背景色和光标颜色。您可以通过单击上下文菜单（窗口左上角的图标）找到选项对话框。

其余的 ANSI 颜色只能从配置文件 ( `~/.minttyrc`) 中更改。不幸的是[，该文件的参考资料](http://mintty.googlecode.com/svn-history/r1065/trunk/docs/mintty.1.html#21)不包含示例，因此需要进行一些猜测。[你可以在 github 上](https://github.com/exhuma/dotfiles/blob/master/.minttyrc)找到我的例子。我只增加了蓝色的亮度。还有[一个](https://github.com/mavnn/mintty-colors-solarized)包含solarized的[明暗](https://github.com/mavnn/mintty-colors-solarized/blob/master/.minttyrc.light)主题[的](https://github.com/mavnn/mintty-colors-solarized/blob/master/.minttyrc.light)[repo](http://ethanschoonover.com/solarized)。你用这些来获得灵感。

在旁注中，在我的情况下，更改定义似乎`Blue`并没有改变任何事情，但是更改`BoldBlue`更改了粗体和默认变体。我花了一段时间才弄清楚这一点......我一直在改变`Blue`，因为什么都没发生，我被其他细节（f.ex.: `Term=xterm-256color`& co）所牵制......也许我读的文档不适合我正在运行的同一个 Cygwin 版本。在摆弄你的主题时，你应该记住这一点。

编辑文件后，关闭并重新打开 Cygwin 终端，应该会显示新颜色。

哦...对于您最初的要求（黑底绿），您唯一需要的是：

```
ForegroundColour=0, 255, 0
BackgroundColour=0, 0, 0 
```

但是您应该考虑将默认前景色保持为白色（或浅灰色），除非您同时更改*所有*其他颜色代码！一些应用程序打印彩色输出，您将看不到“绿色”，因为其他所有内容也是绿色 :)*但是*，Cygwin 中绿色的默认颜色是`rgb:0,191,0`，所以如果您使用其他东西（如提到的`rgb:0,255,0`），您至少会看到亮度的差异。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2011-01-31T15:08:21.183

我建议使用[Console2](https://sourceforge.net/projects/console/)。这为您提供了一个选项卡式界面，您可以在其中同时拥有 Cygwin 选项卡和 Windows 命令提示选项卡。有很多自定义选项，以及更好的剪切和粘贴支持。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-02-19T14:39:37.593

cygwin 图标实际上只是一个 MS-DOS 批处理文件（如果您右键单击它，您可以编辑它并看到它只是从 cygwin\bin 目录启动 bash）。如果您右键单击并转到属性，则有一个颜色选项卡，您可以在其中更改背景和字体颜色。如果您修改主要的快捷方式属性，它应该每次都与这些属性一起启动。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-12-21T20:38:31.113

我使用 Cygwin 的 rxvt 和一个 .Xdefaults 文件进行调整

我的cygwin.bat：

```
:::::::::::::::::::::::::::::::::::::::::::::::::::::::::
@echo off

start /B \cygwin\bin\rxvt.exe -geometry 80x40+325+195 -fn "Andale Mono-13" -sl 2500 -e /bin/bash -i
:::::::::::::::::::::::::::::::::::::::::::::::::::::::::

My Cygwin .Xdefaults:

!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
! See rxvt --help for items available

! Black
Rxvt*background: #000000
Rxvt*cutchars: `"'()*,;<>[]{|}@
!!!Rxvt*cursorColor: #00ff00
Rxvt*cursorColor: White
Rxvt*foreground: Wheat
Rxvt*saveLines: 2048
Rxvt*scrollColor: Grey26
Rxvt*scrollBar_right: on
Rxvt*termName: xterm
Rxvt*visualBell: on
! Black
Rxvt*color0: #000000
! Red
Rxvt*color1: Red2
! Green
Rxvt*color2: Green1
! Yellow (brown)
Rxvt*color3: Khaki1
! Blue
Rxvt*color4: DodgerBlue1
! Magenta
Rxvt*color5: DarkOrchid1
! Cyan
Rxvt*color6: Cyan2
! This does not refer to foreground color!
! White
Rxvt*color7: #fdfdfd
! Gray
Rxvt*color8: #666666
! Bright red
!!!Rxvt*color9: #ee0000
Rxvt*color9: OrangeRed
! Bright green
Rxvt*color10: SpringGreen1
! Yellow
Rxvt*color11: Yellow
! Bright blue
Rxvt*color12: DodgerBlue3
! Bright magenta
Rxvt*color13: #ff00ff
! Bright cyan
Rxvt*color14: #00ffff
! This does not refer to foreground color!
! Bright white
Rxvt*color15: #ffffff

!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! 
```

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2011-06-28T18:59:39.233

rxvt 很棒，但我也有兴趣更改 cygwin 的 bash shell 的颜色。要更改这些颜色，我编辑了 cygwin\etc\DIR_COLORS 并更改了行

```
# 属性代码：
# 00=无 01=粗体 04=下划线 05=闪烁 07=反转 08=隐藏
# 文字颜色代码：
# 30=黑色 31=红色 32=绿色 33=黄色 34=蓝色 35=品红色 36=青色 37=白色
# 背景颜色代码：
# 40=黑色 41=红色 42=绿色 43=黄色 44=蓝色 45=品红色 46=青色 47=白色
执行 00;33
NORMAL 00;37 # 全局默认值，尽管一切都应该有所作为。
FILE 00;37 # 普通文件
DIR 00;32 # 目录

```

并重新采购了我的 .bashrc

```
eval `dircolors -b /etc/DIR_COLORS`

```

请参阅[http://cygwin.com/ml/cygwin/2001-05/msg00938.html](http://cygwin.com/ml/cygwin/2001-05/msg00938.html) 提示颜色也在 /etc/profile 例如在我的登录 .bashrc 中将提示设置为黄色以覆盖 /etc/profile，我可以添加行

```
PS1=('\033[33m$')

```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2014-12-08T17:33:14.277

仅供您参考。***Cygwin*不是终端（或控制台）应用程序。**这类似于回答您使用 Windows 来询问您使用什么浏览器上网。您可以使用各种浏览器在 Windows 上打开网站，例如*Chrome*、*Opera*、*Firefox*或*MSIE*。类似地，您可以在各种终端中打开*Cygwin的外壳。*Terminal 是一个应用程序，它管理来自用户的输入和输出 - 从*Cygwin*的 shell 呈现文本输出并将用户的输入（键盘和鼠标）发​​送回它。因此字体和颜色设置取决于您使用的终端。

Windows 有很多不同的终端应用程序。列举其中一些：

*   [**ConEmu**](https://code.google.com/p/conemu-maximus5/) - 我肯定会推荐这个，你可以通过多种方式配置它，它有标签等。

*   [**Console2**](http://sourceforge.net/projects/console/) - 与前一个类似，但选项较少

*   [**MinTTY**](https://code.google.com/p/mintty/) - 这个默认安装在 Cygwin 中，但它非常基础。*您应该在“ Cygwin Terminal* ”名称下的“开始”菜单中找到它。

*   **Windows 控制台**- 您也可以使用普通的 Windows 控制台：执行`cmd.exe`，导航到 Cygwin 的根目录并执行`bin/bash.exe --login -i`或`Cygwin.bat`

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2014-12-06T01:09:04.983

用于解释颜色的 CygWin 方法（无论是 shell、打印输出、提示符......等）应该与任何其他 Linux 相同，但这里的问题来自**Windows shell**，它没有太多功能。

好吧，我不知道这是否有帮助，但对我来说这是最好的解决方案，因为我喜欢**Putty 作为终端**：

*   从 CygWin 中安装 OpenSSH (SSHD) 包：

    apt-cyg update apt-cyg install sshd ssh-host-config --> [以管理员身份运行] net start sshd

*   [使用Putty](http://www.chiark.greenend.org.uk/~sgtatham/putty/)连接到您的计算机（本地主机）：

    腻子本地主机

现在你应该有一个体面的 shell 能够解释**颜色**。

# c# - ASP.NET MVC - 表单提交、检索数据库 ID 和重定向

> ID：565500
> 
> 赞同：1
> 
> 时间：2009-02-19T14:19:53.927
> 
> 标签：c#, asp.net-mvc

我目前正在学习 ASP.NET MVC 。我想知道当一个表单被提交到获取新记录的id然后重定向到一个带有新记录id的新页面时是否有可能？

信息已正确输入数据库，但不知道如何获取 id？

例如，填写新的客户详细信息表单，然后将页面重定向到可以为客户添加新订单的订单表单。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-19T14:27:30.367

你是如何访问数据库的？如果您使用的是 ORM（例如 NHibernate 或 LINQ to SQL），那么在将对象插入数据库后，它的 ID 属性应该会更新。

如果您手动滚动 SQL，那么您需要在与插入相同的语句中进行选择：

```
insert into ...

select scope_identity() 
```

这将返回您刚刚创建的行的 ID。

然后你可以在你的行动中做到这一点：

```
return RedirectToAction("YourActionName", new {id}); 
```

使用从保存的对象或 SQL 的返回值中检索到的 ID。哪个适合您的场景。

**编辑**

正如您所提到的，您正在使用 NHibernate，那么您可以这样做：

```
var myNewObject = // some way of creating the object

// some way of saving the object 
// at this point NHibernate will have set the ID of the object for you

return RedirectToAction("YourActionName", new { id = myNewObject.Id }); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-19T14:24:32.683

我的一个问题：您在 DB 层使用什么？这将告诉我们如何更好地回答您的问题。

对于重定向，一旦你有了你的 ID，你就可以使用：

```
return Redirect(string url); OR RedirectToAction(string actionPath) 
```

其中 url 是路径和新 ID 的组合。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-19T14:24:35.303

编写您的查询，以便它将返回新记录的 id 并使用新 id 重定向用户。例如，如果您使用 SQL Server 并手动编写查询：

```
command.CommandText = "Insert Into Customers(...) Values (...) Select @@Identity";
long id = long.Parse(command.ExecuteScalar().ToString());
Redirect("...customers/neworders/" + id); 
```

# c# - 您在 C# 代码中如何以及在何处使用断言？

> ID：565502
> 
> 赞同：2
> 
> 时间：2009-02-19T14:20:32.927
> 
> 标签：c#

我需要知道在 C# 中如何以及在何处使用断言的示例。

**编辑**我需要实际示例来说明最适合使用断言的位置。这就是为什么我需要那些使用过它们的人的例子

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-19T14:33:52.443

不久前有一个关于 Debug.Assert() 用法的很好的讨论：[Debug.Assert vs Exceptions](https://stackoverflow.com/questions/506285/debug-assert-vs-exceptions)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-19T14:42:29.503

我真的很喜欢在调试期间通过使用 Debug.Assert() 甚至 Debug.Fail() 来支持异常处理：

```
if( !whatever_I_expect )
{
  var message = "<exception message>";
  Debug.Fail( message );
  throw new InvalidOperation( message );
} 
```

这样我就得到了非常方便的 Debug.Assert() 对话框，并且可以在忽略、重试和中止之间进行选择。重试将进入我可以开始调试的代码。尤其是递归方法或复杂的 try-catch 结构可以通过这种方式更好地调试。你总能得到正确的调用堆栈。在我的发布代码中，我仍然有一个没有消息框的有效错误处理。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-19T15:10:15.943

有不同的观点（参见 comp.lang.c++.moderated 中的最近子线程，主题“我们不使用 C++ 异常”）。

我认为断言最好检查和记录你知道不可能是错误的东西，除非实现不一致。这比前置条件和不变量更强。

例如，一个只能从几个不同的地方调用的辅助函数有一个可用的资源。因为这个助手是私有的并且只在一个类中使用抛出 ArgumentException 是不合适的（那是用于公共/受保护的接口）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-19T15:19:09.670

我在不应该收到错误/无效参数的代码中使用了相当多的 Debug.Assert() - 输入参数和因变量*应该*已经过验证的那种代码。事实是，我*知道*我会犯错。我只是不知道在哪里。:-) 明智地使用“Debug.Assert”可以帮助我应对自己的缺陷。

这是我自己的代码中的一个示例：

```
 public bool AddPoint(uint time, object value)
    {
        bool success = false;
        int index = 0;

        Debug.Assert(_selectedParameterName != null, "RecipeBusinessObject.InsertPointAtTime() _selectedParameterName = null");
        Debug.Assert(_currentRecipe != null, "RecipeBusinessObject.InsertPointAtTime() _currentRecipe = null");          
        Debug.Assert(CurrentParameterTable != null, "RecipeBusinessObject.InsertPointAtTime() CurrentParameterTable = null");

        Debug.Assert(index >= 0, "RecipeBusinessObject.InsertPoint(), index out of range, index = " + index.ToString());
        Debug.Assert(index <= CurrentParameterTable.Rows.Count, "RecipeBusinessObject.InsertPoint(), index out of range, index = " + index.ToString());

        DataRow newRow = CurrentParameterTable.NewRow();

        <snip> 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-19T14:27:32.037

我能想到的直接答案是在测试代码时：

```
Assert.IsNotNull(yourVariable); 
```

您还可以使用 Debug.Assert

```
System.Diagnostics.Debug.Assert(myBooleanProperty); 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-19T14:28:27.853

谷歌应该给你很多例子（提示：键入 csharp 例子断言）

[http://en.csharp-online.net/Assert](http://en.csharp-online.net/Assert)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-19T14:30:05.400

我更喜欢使用单元测试来充实问题。由于我的主要产品是库/程序集，因此还需要确保参数经过验证并引发适当的异常。

有趣的注释： Debug.Assert() 在发布版本中被 MS C# 编译器捕获并删除。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-19T14:35:43.700

当然在单元测试中。

在单元测试之外，我可以识别 3 种类型的错误（非常简化）：

1.  严重的内部错误：来自代码单元内部的东西，用户无法影响。
2.  滥用某些功能：例如给出 null 而不是某个值
3.  外部问题：如文件不存在、无网络连接等。

我认为断言应该只应用于第一个。第二个和第三个应该使用适当的异常来处理。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-19T14:44:40.233

我经常使用 Debug.Assert 来检查我的代码的前置条件。例如，如果一个对象依赖于另一个对象，我可能会断言这个另一个对象不为空。即使在我将程序交给测试之前，这也会使很多问题变得明显。

我想用单元测试检查的内容和我想在运行时用断言检查的内容之间有一条很好的界限。通常，单元测试用于在应用程序的其余部分处于明确定义的状态时测试单个代码单元（我为此广泛使用模拟对象）并且我使用 debug.assert 在运行时检查应用程序的状态是否为我期望。

# php - 如何在不发送电子邮件的情况下检查电子邮件地址是否存在？

> ID：565504
> 
> 赞同：135
> 
> 时间：2009-02-19T14:20:43.300
> 
> 标签：php, email, smtp, telnet, email-validation

我遇到了这个[PHP 代码来使用 SMTP 检查电子邮件地址而不发送电子邮件](http://www.webdigi.co.uk/blog/2009/how-to-check-if-an-email-address-exists-without-sending-an-email/)。

有没有人尝试过类似的东西或者它对你有用吗？您能判断电子邮件客户/用户输入是否正确且存在吗？

* * *

## 回答 #1

> 赞同：102
> 
> 时间：2009-02-19T16:33:27.683

*您有时*可以使用两种方法来确定收件人是否实际存在：

1.  您可以连接到服务器，并发出`VRFY`命令。很少有服务器支持此命令，但它正是为此而设计的。如果服务器以 2.0.0 DSN 响应，则用户存在。

    ```
    VRFY user 
    ```

2.  您可以发出`RCPT`, 并查看邮件是否被拒绝。

    ```
    MAIL FROM:<>
    RCPT TO:<user@domain> 
    ```

如果用户不存在，您将获得 5.1.1 DSN。但是，仅仅因为电子邮件没有被拒绝，并不意味着用户存在。一些服务器会默默地丢弃这样的请求，以防止枚举其用户。其他服务器无法验证用户，并且无论如何都必须接受该消息。

还有一种称为灰名单的反垃圾邮件技术，它会导致服务器最初拒绝该地址，预计真正的 SMTP 服务器会在一段时间后尝试重新发送。这会打乱验证地址的尝试。

老实说，如果您尝试验证地址，最好的方法是使用简单的正则表达式来阻止明显无效的地址，然后将带有链接的实际电子邮件发送回您的系统，以验证电子邮件是否已收到。这也确保了他们的用户输入了他们的实际电子邮件，而不是碰巧属于其他人的轻微错字。

* * *

## 回答 #2

> 赞同：53
> 
> 时间：2010-12-18T16:09:38.087

此处的其他答案讨论了尝试执行此操作的各种问题。我想我会展示你如何尝试这个，以防你想自己学习。

您可以通过 telnet 连接到邮件服务器以询问是否存在电子邮件地址。下面是一个测试电子邮件地址的示例`stackoverflow.com`：

```
C:\>nslookup -q=mx stackoverflow.com
非权威答案：
stackoverflow.com MX 偏好 = 40，邮件交换器 = STACKOVERFLOW.COM.S9B2.PSMTP.com
stackoverflow.com MX 首选项 = 10，邮件交换器 = STACKOVERFLOW.COM.S9A1.PSMTP.com
stackoverflow.com MX 首选项 = 20，邮件交换器 = STACKOVERFLOW.COM.S9A2.PSMTP.com
stackoverflow.com MX 首选项 = 30，邮件交换器 = STACKOVERFLOW.COM.S9B1.PSMTP.com

C:\>telnet STACKOVERFLOW.COM.S9A1.PSMTP.com 25
220 Postini ESMTP 213 y6_35_0c4 准备就绪。CA Business and Professions Code Section 17538.45 禁止将此系统用于未经请求的电子邮件广告。

你好你好
250 Postini 回击打招呼

来自：<me@myhost.com> 的邮件
250 好的

转至：<fake@stackoverflow.com>
550-5.1.1 您尝试访问的电子邮件帐户不存在。请试试
550-5.1.1 仔细检查收件人的电子邮件地址是否有错别字或
550-5.1.1 不必要的空格。了解更多信息
550 5.1.1 http://mail.google.com/support/bin/answer.py?answer=6596 w41si3198459wfd.71

```

以数字代码为前缀的行是来自 SMTP 服务器的响应。我添加了一些空白行以使其更具可读性。

许多邮件服务器不会返回此信息以防止垃圾邮件发送者收集电子邮件地址，因此您不能依赖此技术。但是，您可能会通过检测无效邮件服务器或如上所述拒绝收件人地址来清除一些明显不良的电子邮件地址。

另请注意，如果您向邮件服务器发出过多请求，邮件服务器可能会将您列入黑名单。

* * *

在 PHP 中，我相信您可以使用`fsockopen`,`fwrite`并`fread`以编程方式执行上述步骤：

```
$smtp_server = fsockopen("STACKOVERFLOW.COM.S9A1.PSMTP.com", 25, $errno, $errstr, 30);
fwrite($smtp_server, "helo hi\r\n");
fwrite($smtp_server, "mail from: <me@myhost.com>\r\n");
fwrite($smtp_server, "rcpt to: <fake@stackoverflow.com>\r\n"); 
```

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-02-19T14:27:08.463

一般的答案是，如果您向其发送电子邮件，则*无法*检查电子邮件地址是否存在事件：它可能会进入黑洞。

话虽如此，那里描述的方法非常有效。它在[ZoneCheck](http://www.zonecheck.fr)的生产代码中使用，但它使用 RSET 而不是 QUIT。

在用户与其邮箱的交互成本不高的情况下，许多站点实际上通过发送一个必须发送回发送器的秘密号码来测试邮件是否到达某处（通过转到秘密 URL 或通过电子邮件发送回这个秘密号码）。大多数邮件列表都是这样工作的。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2011-05-20T17:38:33.473

当目标邮件服务器使用灰名单时，这将失败（在其他情况下）。

**灰名单**：SMTP 服务器在以前未知的客户端第一次连接时拒绝传递，允许下次连接；这可以阻止一定比例的垃圾邮件程序，同时允许合法使用 -*因为预计合法的邮件发件人会重试*，这是普通邮件传输代理会做的事情。

但是，如果您的代码只在服务器上检查*一次*，带有灰名单的服务器将拒绝交付（因为您的客户端是第一次连接）；除非您稍后再次检查，否则您可能会错误地拒绝有效的电子邮件地址。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-02-19T14:26:19.527

不是真的.....有些服务器可能不会检查“rcpt to:”

[http://www.freesoft.org/CIE/RFC/1123/92.htm](http://www.freesoft.org/CIE/RFC/1123/92.htm)

这样做有安全风险......

如果服务器这样做，您可以编写一个机器人来发现服务器上的每个地址......

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2009-02-19T14:27:38.637

一些问题：

1.  我敢肯定，如果您提供的地址不存在，某些 SMTP 服务器会立即通知您，但有些不会作为隐私措施。他们只会接受你给他们的任何地址，并默默地忽略那些不存在的地址。
2.  正如文章所说，如果您经常对某些服务器执行此操作，他们会将您列入黑名单。
3.  ~~对于某些 SMTP 服务器（如 gmail），您需要使用 SSL 才能执行任何操作。~~ *仅当使用 gmail 的 SMTP 服务器**发送**电子邮件时才适用。*

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2020-06-14T11:45:28.953

我可以确认 Joseph 和 Drew 的使用答案`RCPT TO: <address_to_check>`。我想在这些答案之上添加一些小附录。

### 包罗万象的供应商

一些邮件提供商实施包罗万象的策略，这意味着`*@mydomain.com`将对`RCPT TO:`命令返回肯定的结果。但这并不一定意味着邮箱“存在”，如“属于人类”。这里没有什么可以做的，只是要注意。

### IP灰名单/黑名单

灰名单：来自未知 IP 的第一个连接被阻止。解决方法：至少重试2次。

黑名单：如果您从同一 IP 发送的请求过多，则该 IP 被阻止。解决方案：使用IP轮换。

### 注册表单上的 HTTP 请求

这是非常特定于提供商的，但您有时可以使用精心设计的 HTTP 请求，并解析这些请求的响应，以查看用户名是否已在此提供商处注册。

`*@yahoo.com`这是我为使用 HTTP 请求检查地址而编写的开源库中的相关函数： [check-if-email-exists](https://github.com/reacherhq/check-if-email-exists/blob/5fad57d88ef92d65c7d493cdcb45eff347d6a286/core/src/smtp/yahoo.rs#L107)。我知道我的代码是 Rust 并且这个线程被标记为 PHP，但同样的想法也适用。

### 完整收件箱

这可能是一种极端情况，但是当用户的收件箱已满时，`RCTP TO:`将返回一条`5.1.1 DSN`错误消息，说明收件箱已满。这意味着该帐户确实存在！

### 披露

我运行 [Reacher][1]，一个实时电子邮件验证 API。我的代码是用 Rust 编写的，并且是 100% 开源的。如果您想要更强大的解决方案，请查看它：

Github：[https ://github.com/reacherhq/check-if-email-exists](https://github.com/reacherhq/check-if-email-exists)

通过结合各种技术来跳过障碍，我设法验证了大约 80% 的客户检查**的电子邮件。**

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-02-19T15:47:58.330

您所能做的就是搜索 DNS 并确保电子邮件地址中的域具有 MX 记录，除此之外没有可靠的处理方法。

某些服务器可能使用 rcpt-to 方法与 SMTP 服务器通信，但这完全取决于服务器的配置。另一个问题可能是过载的服务器可能返回一个 550 代码说用户未知，但这是一个临时错误，有一个可以返回的永久错误（我认为是 451？）。这*完全*取决于服务器的配置。

我个人会检查 DNS MX 记录，如果 MX 记录存在，则发送电子邮件验证。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2014-02-11T07:02:57.787

```
function EmailValidation($email)
{
    $email = htmlspecialchars(stripslashes(strip_tags($email))); //parse unnecessary characters to prevent exploits
    if (eregi('[a-z||0-9]@[a-z||0-9].[a-z]', $email)) {
        //checks to make sure the email address is in a valid format
        $domain = explode( "@", $email ); //get the domain name
        if (@fsockopen ($domain[1],80,$errno,$errstr,3)) {
            //if the connection can be established, the email address is probably valid
            echo "Domain Name is valid ";
            return true;
        } else {
            echo "Con not a email domian";
            return false; //if a connection cannot be established return false
        }
        return false; //if email address is an invalid format return false
    }
} 
```

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2016-06-16T07:25:41.630

虽然这个问题有点老了，但这个服务提示可能会帮助用户搜索类似的解决方案，在发送之前检查超出语法验证的电子邮件地址。

我一直在使用这个[开源服务](https://www.mailgun.com/email-validation)来更深入地验证电子邮件（检查电子邮件地址域上的 mx 记录等），并为一些项目取得了良好的效果。它还检查常见的拼写错误，这非常有用。演示[在这里](http://mailgun.github.io/validator-demo/)。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2009-02-19T14:41:17.650

“您能判断电子邮件客户/用户输入是否正确且存在吗？”

其实这是两个不同的东西。它可能*存在*，但可能不正确。

有时您必须以表面价值接受用户输入。否则有很多方法可以击败系统。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2009-02-19T15:02:59.470

假设它是*用户的*地址，一些邮件服务器确实允许 SMTP VRFY 命令根据其邮箱实际验证电子邮件地址。大多数主要网站不会为您提供太多信息；gmail 的回复是“如果您尝试邮寄，我们会尝试发送”或类似的巧妙内容。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-02-19T15:07:10.960

我认为您不能，在很多情况下，即使发送电子邮件也会失败。例如。用户端的邮件服务器暂时宕机、邮箱存在但已满无法投递等。

这可能就是为什么这么多网站在用户确认他们收到确认电子邮件后验证注册的原因。

* * *

## 回答 #14

> 赞同：-11
> 
> 时间：2014-12-02T05:33:02.857

```
<?php

   $email = "someone@exa mple.com";

   if(!filter_var($email, FILTER_VALIDATE_EMAIL))
      echo "E-mail is not valid";
   else
      echo "E-mail is valid";

?> 
```

# java - 在java中将StreamWriter转换为OutputStream？

> ID：565508
> 
> 赞同：13
> 
> 时间：2009-02-19T14:20:59.213
> 
> 标签：java, io, stream

我正在尝试使用 System.setOut 将 System.out 重定向到一个字符串，该字符串需要一个 PrintStream。有什么方法可以将 StringWriter 转换为 Stream 以便我可以将其传递给 setOut？

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2009-02-19T14:29:59.770

你不能完全做到这一点，因为`StringWriter`是 a `Writer`，而不是 a `Stream`。但是你可以这样做：

```
// create a ByteArray stream, which will be wrapped by a PrintStream
ByteArrayOutputStream baos = new ByteArrayOutputStream();
PrintStream ps = new PrintStream(baos);
System.setOut(ps);

// print whatever you got
String result = baos.toString(); 
```

# asp.net - ASP.NET 控件和更新面板

> ID：565514
> 
> 赞同：0
> 
> 时间：2009-02-19T14:21:48.663
> 
> 标签：asp.net, events, controls, updatepanel, custom-server-controls

我正在动态创建一系列嵌套在更新面板内的客户端组件控件。第一次创建控件时，一切正常，但是，当我在更新面板上触发更新并执行部分回发时，控件返回几个 javascript 错误，描述控件是如何在页面上注册的。

我收到一系列错误，类似于：“错误：Sys.InvalidOperationException：无法将具有相同 id “master_ctl40_CCB_PALETTES”的两个组件添加到应用程序中”

有什么想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-26T16:33:51.677

试试这些技巧：

1.  在 Page_Load 上放 uxFailedControl.ID = DateTime.Now.ToString(); 它将确保您的控件在每次页面重新加载（全部或部分）时都具有唯一 ID，因此理论上您不应再看到“相同 id”错误。
2.  如果在 Modal Popup 中显示控件：每次从服务器隐藏弹出窗口时，从其容器（面板、页面、控件等）中删除控件。使用 uxModalPopupPanel.Controls.Clear(); 或 uxModalPopupPanel.Remove(uxFailedControl);
3.  完成调试后，将 ScriptManager 的 ScriptMode 属性设置为“Release”。它将防止内部 AJAX 异常被冒泡到浏览器。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-26T04:18:59.290

看起来您的客户端对象被创建了不止一次。

如果您希望在刷新更新面板时替换您的客户端控件，它们应该从 Sys.UI.Control 继承，后者在其构造函数中采用一个元素。当该元素被更新面板替换时，客户端对象将被释放然后重新创建。如果您当前在服务器端使用 ScriptComponentDescriptor 来定义客户端控件实例，您需要切换到 ScriptControlDescriptor。

从它的声音来看，您的客户端对象只是从 Sys.Component 继承，它会一直存在，直到它们被手动处置，这就是为什么您会收到关于拥有多个具有相同 ID 的组件的错误。

我建议不要在每次回帖时都使用新 ID——这只会继续创建新的客户端对象，而不会清理旧的对象。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-19T14:34:16.623

在哪种情况下您将组件添加到更新面板？即您是否将它们放置在页面加载事件中而没有进行回发检查，或者您是否将它们放置在更新面板加载事件中？ETC...

# c++ - Visual Studio 生成的浏览信息的目的是什么

> ID：565516
> 
> 赞同：12
> 
> 时间：2009-02-19T14:22:14.717
> 
> 标签：c++, visual-studio

我在一个解决方案中获得了一个巨大的 C++ 第三方项目，其中包含一组项目。所以构建时间相当长，浏览信息生成也需要很多时间。那么浏览信息的目的是什么？如果我禁用浏览信息生成，哪些功能会丢失？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-02-19T14:35:13.017

Visual Studio 6 需要浏览信息来完成 Doug T. 提到的事情。

较新版本的 Visual Studio 可以使用浏览信息文件，但默认使用较新的 Intellisense 数据库。对于那些版本，基本上有一个 Intellisense 守护进程在后台构建数据库，而不是直接嵌入到构建过程中。使用 Intellisense 时，拥有多个处理器或内核确实很有帮助。否则，它真的会让你的系统陷入困境。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-19T14:25:31.947

从[这里](http://www.catch22.net/tuts/vctips)

> 对于要包含的任何源文件，选择 C/C++ 项目设置选项卡下的生成浏览信息。这对于搜索函数定义和声明非常有用 - 只需右键单击函数/变量并选择“Goto Definition Of...”，IDE 就会直接将您带到那里。

您将失去一些轻松浏览代码的能力。这在非常大的代码库中可能很重要。我知道没有它和[Visual Assist X](http://www.wholetomato.com/)之类的工具，我会迷路。尽管如此，Visual Studio 仍然有一个非常有效的文件查找操作，无法完全用浏览工具代替。

# networking - 串行通讯在 WinXP 中死机

> ID：565519
> 
> 赞同：4
> 
> 时间：2009-02-19T14:22:43.093
> 
> 标签：networking, windows-xp, serial-port, visual-c++-6

一点历史：我们有一个应用程序，最初是在很多年前编写的（1998 年是 PVCS 的第一个日期，但该应用程序比它早 5 年，因为它最初是一个 DOS 程序）。此应用程序通过串行与硬件进行通信。当我们使用 Windows XP 时，我们开始收到应用程序在运行一小段时间后死机的报告。似乎串行通讯刚刚“死亡”，应用程序处于卡住状态。从这种情况中恢复的唯一方法是重新启动应用程序。

我能找到的关于这个问题的唯一信息显然是 Windows 消息系统会错过接收到的信息，缓冲区会填满，系统会卡住。这段信息被留在了一个旧的word文档中，但没有证据支持这一点。它还提到这仅在高波特率 (115200+) 下普遍存在。

解决方案是为客户提供USB->串行转换器以及硬件。

今天：我们正在开发一个新版本的硬件，它将在网络和串行端口上运行。因此，为了让我能够处理网络代码，减去我们使用[VSCOM NetCom113](http://www.vscom.de/666.htm)设备的实际硬件。它还在用户（即：我的）机器上安装了一个虚拟通信端口。

现在我已经将网络代码与应用程序集成，看起来 NetCom 设备表现出与物理 commport 相同的行为。这是不可取的，因为我需要应用程序运行时间超过 ~30 秒。

谷歌发现我们遇到的零问题。

我想知道：

*   有谁之前经历过这个吗？如果是这样，您做了什么来解决/解决问题？
*   有没有人对文档的原始作者是否正确以及我可以做些什么来测试该理论有任何建议？

不幸的是，我无法发布代码，因为串行代码与系统的其余部分紧密耦合，但如果您对此有疑问，我可以回答有关它的问题。

**更新：**

*   代码是使用 Win32 Comm 例程编写的 - 所以我使用的是 CreateFile、ReadFile。还有对 GetOverlappedResult 的明智调用。
*   它本身并没有挂起，只是通讯停止了。您可以访问菜单，单击按钮，但没有任何东西可以与连接的硬件交互。使用[realterm](http://realterm.sourceforge.net/)你可以看到没有数据进出。
*   我认为对 windows 消息的引用是问题是 windows 内部的。数据已经到达，但内核错过了它，因此没有告诉系统的其余部分。
*   不使用流量控制。
*   编写一个“简单”的测试很困难，因为代码是紧密耦合的，底层协议非常复杂，需要大量工作。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-19T14:33:15.877

您使用的是 DOS 风格的串行代码，还是 Win32 CreateFile 方法？

如果是前者，请非常怀疑：如果可能的话，我会转换为后者。

如果是后者，你知道它挂在什么样的系统调用上吗？您是否处于阻塞读取呼叫中？还是重叠的 I/O 调用？或等待事件？（我不确定我是否有足够的经验来提供帮助，但这些都是我想到的问题）

您还可以检查队列大小，您可以使用[SetupComm](http://msdn.microsoft.com/en-us/library/aa363439(VS.85).aspx)函数进行设置。

我不买“Windows 消息系统”的东西——这听起来很可疑；您可以编写从不使用 Windows 消息的优秀 Win32 串行 i/o 代码。

**编辑：**您的重叠 I/O 是否使用事件？我似乎记得一些关于自动重置事件偶尔会错过触发的事情……非常仔细地检查重叠的 I/O 调用，看看你是否正确处理了可能的结果。也许有一种方法可以通过自动取消重叠的 i/o 并重新启动另一个读取来使您的代码更加健壮。（我认为问题出在读取的一半，而不是写入的一半？）

**编辑 2：**一个建议：假设 win32 端丢失了一个字节或数据包，并且您的设备处于死锁状态，因为它们都希望彼此响应某些东西，您能否定期调整串行 I/O 的另一端发送某种类型的带有递增计数器的“ping”数据包？（并在 PC 端记录 ping 数据包；这样您就可以查看是否遗漏了任何数据）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-19T14:48:37.977

你确定你的流量控制设置正确吗？DTR、RTS 等...

-亚当

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-24T17:23:05.673

不确定这是否适合您，但如果您可以使用 C#.NET 重写代码，您就可以访问那里的 SerialPort 类。它可能会解决您的问题。我知道很多基于 Win32 API 的用于硬件 I/O 端口的遗留代码在 XP 中由于时间问题往往会失败（对 MIDI 有一点经验）。

另外，我不知道您是否可以在 Vista 中使用 Win32 串行端口访问方法，这样可能会阻止未来的 MS 操作系统使用您的代码。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-20T23:08:24.150

我编写了使用 USB / 蓝牙串行端口的应用程序并且从未遇到过问题。使用蓝牙，我已经看到很长一段时间的比特率（持续）为 800,000 bps。大多数人没有正确实施该端口。

[我的串口](http://www.vbforums.com/showthread.php?t=530790)

# java - 警告登录前

> ID：565531
> 
> 赞同：1
> 
> 时间：2009-02-19T14:25:28.577
> 
> 标签：java, login, struts2, warnings

我需要提醒或警告用户..当用户登录到特定帐户时，'您的帐户已在下周过期'就像那样..我的用户表具有 validfrom 和 validto 日期。在有效日期的 1 周之前..我需要在每次登录时警告用户。

我的应用程序使用 strus2 ..

对于上述业务逻辑，我需要任何时间表..否则任何简单的方法..请帮助我

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-19T15:40:26.617

当用户登录时，从今天的日期中减去有效日期，如果小于或等于 7 天，则显示警报。

无需调度程序，无需更改数据库。

我认为您已经检查了今天的日期是否大于有效日期，以防止帐户过期的人登录。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-30T05:47:45.817

如果您预计您将需要多次进行计算，您可能会设置一个工作。例如，如果您要显示一周后到期的帐户列表，这是一个常见的交易。在这种情况下，您可能想看看[Quartz scheduler](http://www.quartz-scheduler.org/)。

[Spring Framework](http://www.springsource.org/documentation)与 Quartz 调度程序有很好的集成。以下是我正在从事的开源项目中的分类广告发布每小时过期的计划配置示例：

```
 <!-- Scheduled Jobs -->
<bean id="expiryJob" class="org.springframework.scheduling.quartz.MethodInvokingJobDetailFactoryBean">
    <property name="targetObject" ref="postingDAO" />
    <property name="targetMethod" value="expirePostings" />
</bean>

<bean id="cronTrigger" class="org.springframework.scheduling.quartz.CronTriggerBean">
    <property name="jobDetail" ref="expiryJob" />
    <!-- run every hour -->
    <property name="cronExpression" value="0 0 * * * ?" /> 
</bean>
<!--
<bean id="extraTrigger" class="org.springframework.scheduling.quartz.CronTriggerBean">
    <property name="jobDetail" ref="expiryJob" />
    <property name="cronExpression" value="0 * * * * ?" /> 
</bean>
-->
<!-- A list of Triggers to be scheduled and executed by Quartz -->
<bean class="org.springframework.scheduling.quartz.SchedulerFactoryBean">
    <property name="triggers">
        <list>
            <ref bean="cronTrigger"/>
            <!-- <ref bean="extraTrigger"/> -->
        </list>
    </property>
</bean> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-19T14:29:49.580

您可以调整登录功能以处理不同的状态：

*   有效的
*   无效的用户名/密码
*   已到期
*   一周内过期

所以不需要调度程序。

# .net - 使用ssis在vb.net中读取合并的excel数据

> ID：565533
> 
> 赞同：0
> 
> 时间：2009-02-19T14:25:40.090
> 
> 标签：.net

我在这里遇到了一个棘手的问题。我正在使用 SSIS 工具集从某些文件中导入数据。其中之一是 Excel 电子表格。问题是从合并的单元格中挑选数据时。这是该问题的详细版本-

行号 ColA ColB 1 值 1
2 XYZ

在上面的示例中，**Value1**在第 1 行和第 2 行合并。我希望获取 ColB 中的值，而不管 ColA 中的值是否被合并。目前，这不会发生在我的代码中。

更多细节 - 我使用 Microsoft.Jet.OLEDB.4.0 作为提供者来形成连接。使用选择查询来获取数据 - SELECT ColA FROM WHERE CoLB='XYZ'

我希望这会返回**Value1**，这显然不会因为它合并在两行中​​。

有人可以帮忙解决这个问题。这真的是要付出代价！！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-23T15:06:30.633

创建了一个 VB 代码来分别捕获合并的单元格值。然后再次循环以获取其他值并使用这些值更新虚拟数据集。有点慢，但它对我有用！

# java - 在 Java 中模拟 URL

> ID：565535
> 
> 赞同：26
> 
> 时间：2009-02-19T14:26:00.183
> 
> 标签：java, url, mocking

我们想要模拟的一个 Java 类中有一个 URL 对象，但它是最终类，所以我们不能。我们不想更上一层楼，并模拟 InputStream，因为这仍然会给我们留下未经测试的代码（我们有严格的测试覆盖率标准）。

我已经尝试过 jMockIt 的反射功能，但我们在 Mac 上工作，并且 Java 代理处理程序存在我无法解决的问题。

那么有没有不涉及在junit测试中使用真实URL的解决方案？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2011-05-31T15:24:21.820

就像 Rob 所说，如果你想要模拟从 URL 返回的连接，你可以扩展`URLStreamHandler`. 例如，使用 mockito：

```
final URLConnection mockUrlCon = mock(URLConnection.class);

ByteArrayInputStream is = new ByteArrayInputStream(
        "<myList></myList>".getBytes("UTF-8"));
doReturn(is).when(mockUrlCon).getInputStream();

//make getLastModified() return first 10, then 11
when(mockUrlCon.getLastModified()).thenReturn((Long)10L, (Long)11L);

URLStreamHandler stubUrlHandler = new URLStreamHandler() {
    @Override
     protected URLConnection openConnection(URL u) throws IOException {
        return mockUrlCon;
     }            
};
URL url = new URL("foo", "bar", 99, "/foobar", stubUrlHandler);
doReturn(url).when(mockClassloader).getResource("pseudo-xml-path"); 
```

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2009-02-19T14:30:21.530

当我有一个类因为它是最终的（或在 C# 中密封）而不能轻易模拟时，我通常的路线是在类周围编写一个包装器，并在我使用实际类的任何地方使用包装器。然后我会根据需要模拟包装类。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2013-01-17T21:11:39.193

我去了以下：

```
public static URL getMockUrl(final String filename) throws IOException {
    final File file = new File("testdata/" + filename);
    assertTrue("Mock HTML File " + filename + " not found", file.exists());
    final URLConnection mockConnection = Mockito.mock(URLConnection.class);
    given(mockConnection.getInputStream()).willReturn(
            new FileInputStream(file));

    final URLStreamHandler handler = new URLStreamHandler() {

        @Override
        protected URLConnection openConnection(final URL arg0)
                throws IOException {
            return mockConnection;
        }
    };
    final URL url = new URL("http://foo.bar", "foo.bar", 80, "", handler);
    return url;
} 
```

这给了我一个真实的 URL 对象，其中包含我的模拟数据。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2016-10-16T18:02:22.083

如果您不想创建包装器：

注册一个 URLStreamHandlerFactory

公开你想要的方法

嘲笑链条

```
abstract public class AbstractPublicStreamHandler extends URLStreamHandler {
    @Override
    public URLConnection openConnection(URL url) throws IOException {
        return null;
    }
}

public class UrlTest {
    private URLStreamHandlerFactory urlStreamHandlerFactory;

    @Before
    public void setUp() throws Exception {
        urlStreamHandlerFactory = Mockito.mock(URLStreamHandlerFactory.class);
        URL.setURLStreamHandlerFactory(urlStreamHandlerFactory);
    }

    @Test
    public void should_return_mocked_url() throws Exception {
        // GIVEN
        AbstractPublicStreamHandler publicStreamHandler = Mockito.mock(AbstractPublicStreamHandler.class);
        Mockito.doReturn(publicStreamHandler).when(urlStreamHandlerFactory).createURLStreamHandler(Matchers.eq("http"));

        URLConnection mockedConnection = Mockito.mock(URLConnection.class);
        Mockito.doReturn(mockedConnection).when(publicStreamHandler).openConnection(Matchers.any(URL.class));

        Mockito.doReturn(new ByteArrayInputStream("hello".getBytes("UTF-8"))).when(mockedConnection).getInputStream();

        // WHEN
        URLConnection connection = new URL("http://localhost/").openConnection();

        // THEN
        Assertions.assertThat(new MockUtil().isMock(connection)).isTrue();
        Assertions.assertThat(IOUtils.toString(connection.getInputStream(), "UTF-8")).isEqualTo("hello");
    }
} 
```

PS：我不知道如何取消最后一行后的编号列表自动间距

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2013-02-21T07:46:25.617

我认为您可以使用 Powermock 来执行此操作。我最近能够使用 PowerMock 模拟 URL 类。希望这可以帮助。

/* 实际类 */

```
import java.net.MalformedURLException;
import java.net.URL;

public class TestClass {

    public URL getUrl()
        throws MalformedURLException {

        URL url = new URL("http://localhost/");
        return url;
    }
} 
```

/* 测试类 */

```
import java.net.URL;

import junit.framework.Assert;

import org.junit.Test;
import org.junit.runner.RunWith;
import org.mockito.Mockito;
import org.powermock.api.mockito.PowerMockito;
import org.powermock.core.classloader.annotations.PrepareForTest;
import org.powermock.modules.junit4.PowerMockRunner;

@RunWith(PowerMockRunner.class)
@PrepareForTest(value = { TestClass.class })
public class TestClassTest {

    private TestClass testClass = new TestClass();

    @Test
    public void shouldReturnUrl()
        throws Exception {

        URL url = PowerMockito.mock(URL.class);
        PowerMockito.whenNew(URL.class).withParameterTypes(String.class)
                .withArguments(Mockito.anyString()).thenReturn(url);
        URL url1 = testClass.getUrl();
        Assert.assertNotNull(url1);
    }
} 
```

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2009-02-19T14:40:04.253

我使用了一个 URLHandler，它允许我从类路径加载一个 URL。所以以下

```
new URL("resource:///foo").openStream() 
```

将从类路径中打开一个名为 foo 的文件。为此，我使用了一个[通用实用程序库](http://openhms.sourceforge.net/common-util/)并注册了一个处理程序。要使用此处理程序，您只需调用：

```
com.healthmarketscience.common.util.resource.Handler.init(); 
```

并且资源 URL 现在可用。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-02-19T14:41:50.457

我会再看看你为什么*要*模拟一个最终的数据对象。由于根据定义，您不会在实际代码中对对象进行子类化，并且它不会成为被测对象，因此您不需要对此代码进行白盒测试；只需传入任何合适的（真实）URL 对象，然后检查输出。

模拟对象在难以创建合适的真实对象时很有用，或者真实对象的方法要么很耗时，要么依赖于一些有状态的外部资源（如数据库）。这些都不适用于这种情况，所以我不明白为什么你不能只构造一个代表适当资源位置的真实 URL 对象。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-06-14T12:53:47.813

JMockit 确实允许您模拟最终的 JRE 类，例如 java.net.URL。

似乎 jdkDir/lib/tools.jar 中的附加 API 在 JDK 1.6 的实现中可用，而不是 Sun 的也不能正常工作。我想这些东西仍然太新/太先进，或者根本没有得到其他 JDK 供应商（Apple、IBM 的 J9 JDK、Oracle 的 JRockit JDK）的必要关注。

因此，如果您在类路径中包含 tools.jar 时遇到问题，请尝试使用“-javaagent:jmockit.jar”JVM 参数。它告诉 JVM 在启动时直接加载 java 代理，而不使用 Attach API。这应该适用于 Apple JDK 1.5/1.6。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2016-11-22T08:45:18.200

创建一个指向测试类本身的 URL 对象。

```
final URL url = 
    new URL("file://" + getClass().getProtectionDomain().getCodeSource().getLocation().getPath()); 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-02-19T14:52:48.590

URL 类是否实现了接口？如果是这样，那么您可以使用控制反转或可配置工厂来实例化它，而不是通过直接构造，这将允许您在测试运行时注入/构造一个测试实例，而不是您当前拥有的最终实例。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2021-10-05T20:22:21.153

您可以这样模拟构造函数：

```
 new MockUp<URL>() {
        @Mock
        public void $init(Invocation invocation, String string) {
        }
    }; 
```

# c# - C#：替代 GenericType == null

> ID：565564
> 
> 赞同：22
> 
> 时间：2009-02-19T14:33:07.513
> 
> 标签：c#, generics, null

我需要检查一个通用对象是否为空或默认（T）。但我有一个问题......目前我已经这样做了：

```
if (typeof(T).IsValueType)
{
  if(default(T).Equals(thing))
    // Do something
  else
    // Do something else
}
else
{
  if(thing == null)
    // Do something
  else
    // Do something else
} 
```

但后来我又重复了自己……我不喜欢。问题如下：

```
thing == null; 
```

此处 ReSharper 警告可能将值类型与“null”进行比较。

```
thing == default(T); 
```

在这里我得到编译器错误：无法将运算符'=='应用于'T'和'T'类型的操作数。

```
thing.Equals(null|default(T)); 
```

`thing`显然可以为空（这就是我必须检查的原因！），因此会导致 NullReferenceException。

```
null|default(T).Equals(thing); 
```

null 并且 default(T) 也经常为 null ......

有没有干净的方法来做到这一点？

* * *

## 回答 #1

> 赞同：54
> 
> 时间：2009-09-25T15:20:57.073

正确的方法是：

```
return EqualityComparer<T>.Default.Equals(value, default(T)) 
```

没有拳击。你甚至可以像这样定义一个扩展方法：

```
public static void bool IsDefault<T>(this T value)
{
    return EqualityComparer<T>.Default.Equals(value, default(T));
} 
```

..并像这样调用它：

```
return entry.IsDefault(); 
```

不过，我个人并不关心 T 上的扩展方法（例如这个对象 IsNull()），因为它有时会妨碍可读性。

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2009-02-19T14:46:57.980

如果拳击不是问题，您可以使用：

```
object.Equals(value, default(T)) 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2011-02-10T17:14:38.177

当我需要测试该值是否为 NULL 时，我使用下面的方法。我通常在调用采用任何类型但不是空值的方法（例如缓存）时使用它。

```
public static bool IsNull<T>(this T value)
{
    var type = typeof(T);

    return (type.IsClass || Nullable.GetUnderlyingType(type) != null) 
        && EqualityComparer<T>.Default.Equals(value, default(T));

} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-19T14:41:07.713

目前我能想到的最好的事情是：

```
return value == null || value.Equals(default(T)); 
```

编辑：

显然，有一个`object.Equals`我不知道的静态方法：

```
return object.Equals(value, default(T)); 
```

这个更好。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-19T14:42:25.650

一点拳击就可以完成这项工作。

```
 static bool IsNullOrDefault<T>(T value)
    {
        return ((object)default(T)) == null ?
            ((object)value) == null :
            default(T).Equals(value);
    } 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-09-25T15:14:57.253

您可以通过注意可以静态确定类型的可空性来完全避免装箱。

这是您可以执行的操作：

1.  在泛型类中声明一个名为`isDefault`type的私有静态只读变量`Predicate<T>`
2.  将静态初始化程序添加到您的泛型类中，您可以在其中检查 T 的可空性，并将 isDefault 设置为任一`v==null`或`default(T).Equals(v)`取决于结果
3.  在代码的其余部分中使用`isDefault(x)`而不是`x==null`

这是一个例子：

```
public class Example<T> {

    private static readonly Predicate<T> isDefault;

    static Example() {
        // Nullability check is a bit ugly, but we do it once per T,
        // so what the heck...
        if (typeof(T).IsValueType &&
           (!typeof(T).IsGenericType
        ||  typeof(T).GetGenericTypeDefinition() != typeof(Nullable<>)
        )) {
            // This is safe because T is not null
            isDefault = val => default(T).Equals(val);
        } else {
            // T is not a value type, so its default is null
            isDefault = val => val == null;
        }
    }

    public bool Check(T value) {
        // Now our null-checking is both good-looking and efficient
        return isDefault(value);
    }

} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-19T14:45:39.310

有测试：

```
public class DefaultOrNullChecker<T>  {
    public bool Check(object x) {
        return object.ReferenceEquals(x, null) || x.Equals(default(T));
    }
}
[TestFixture]
public class Tests {
    [Test]  public void when_T_is_reference_type() { 
        Assert.IsFalse(new DefaultOrNullChecker<Exception>().Check(new Exception()));}
    [Test] public void when_T_is_value_type() { 
        Assert.IsFalse(new DefaultOrNullChecker<int>().Check(123)); }
    [Test] public void when_T_is_null() {
        Assert.IsTrue(new DefaultOrNullChecker<Exception>().Check(null));}
    [Test] public void when_T_is_default_value() { 
        Assert.IsTrue(new DefaultOrNullChecker<int>().Check(0)); }
} 
```

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2009-09-25T15:23:55.197

这有什么问题？

```
if (thing == default(T)) { } 
```

如果它是一个值类型，那么 JIT 将完全删除该语句。

# sql-server - 以不同的名称附加带有全文目录的数据库？

> ID：565565
> 
> 赞同：3
> 
> 时间：2009-02-19T14:33:08.433
> 
> 标签：sql-server, sql-server-2005, tsql, full-text-search

我有一个包含常规全文目录的数据库。我想分离此数据库，将其复制到不同的服务器并以不同的名称附加它（相同的名称但附加了“_BAK”）。我正在使用 SQL Server 2005。

这是尝试将 DATABASE 与名称 DATABASE_BAK 下的全文目录附加的错误

```
Warning: Identity or last population complete time of full-text catalog in 
directory 'E:\DATABASE\Name_FullText' does not match database 'DATABASE'. 
The full-text catalog cannot be attached. 
```

*   有没有办法以不同的名称附加带有全文的数据库？
*   如果不是，我还有什么其他选择？
    *   不附全文？
    *   在分离处删除全文并重新创建它？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-19T15:40:26.367

为什么不直接附加数据库，然后在附加后重命名它？

# xml - 基于属性的 XPath 节点元素索引

> ID：565590
> 
> 赞同：2
> 
> 时间：2009-02-19T14:39:04.457
> 
> 标签：xml, sharepoint, xpath, infopath

我正在尝试构建一个 Infopath 表单，该表单使用从 Sharepoint 列表返回的数据填充字段。我设置了一个下拉列表框，其值从 Sharepoint 数据源中填充。那部分工作正常。现在，一旦用户从列表中选择其中一项，我希望其他字符串字段能够自动填充。
所以我制定了一个规则来做到这一点。我写了一个 XPath 公式来从 Sharepoint 列表中获取属性

```
xdXDocument:GetDOM("Base Printers")
/dfs:myFields/dfs:dataFields/dfs:Base_Printers/@PNP_String 
```

问题是这总是从列表中的第一项中获取属性（PNP_String）。我想根据用户的选择使用正确的打印机（Base_Printers）填充它。所以我必须索引到 Base_Printers，然后选择 PNP_String。所以我尝试了这个

```
.../dfs:Base_Printers[2]/@PNP_String 
```

它将索引到第二项并返回该 PNP 字符串，这很棒！
但是我需要索引到用户选择的元素，所以我尝试了这个：

```
.../dfs:Base_Printers[@Printer=my:basePrinter]/@PNP_String 
```

其中@Printer 是共享点列表中的属性，my:basePrinter 是下拉列表的本地信息路径变量。这对我没有任何帮助。当我尝试文字值时：

```
.../dfs:Base_Printers[@Printer='XYZ']/@PNP_String 
```

它选择了正确的 pnp 字符串。
所以我的问题是，如何根据用户的选择索引到该打印机阵列？

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-19T15:58:59.187

我想我想通了。

```
xdXDocument:GetDOM("Base Printers")/dfs:myFields/dfs:dataFields
/dfs:Base_Printers[@Printer = current()]/@PNP_String 
```

出于某种奇怪的原因，它在您使用时起作用：

```
@Printer = current() 
```

但不是当你使用：

```
@Printer = my:basePrinter 
```

即使 current() 和 my:basePrinter 返回相同的字符串。

奇怪...

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-19T14:57:39.170

默认情况下，XPath 不会从周围环境继承上下文（例如本地信息路径变量）。

在 XSLT 中，由处理器提供一种机制来允许您填充全局（即在根节点中定义）xsl:variable 声明，然后这些声明在 XPath 中作为 $name 可用。

由于我不知道 InfoPath，我不能更具体，但它应该被记录（即使只是通过示例间接地）......

另请注意，您可以在谓词中（在 [] 内）使用带有自己谓词的完整位置路径，因此如果所选值在同一个文档中可用，您可以使用它，例如

```
.../dfs:base_printers[@printer=/theform/theCombo/Values[@selected=true]] 
```

# oop - 您如何在项目生命周期中保持对象模型图和代码实现同步？

> ID：565601
> 
> 赞同：1
> 
> 时间：2009-02-19T14:41:50.207
> 
> 标签：oop, class-design

在设计新的对象模型时，我总是从 Visual Studio 中的类图功能开始。一旦我起草了第一个版本，并根据收集新信息或需求变化进行了一些调整，我就开始着手实际实施。

随着开发变得忙碌并且必须满足目标，图表会被搁置一边，然后最终以与从一开始就设计的模型不同的模型结束。

您如何在项目生命周期中保持您的类对象模型和代码实现同步？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-19T14:49:17.740

如果您希望它始终保持同步，则必须从代码本身生成它。

类图不提供这种功能吗？我想如果你把它指向现有的类，它会保持最新。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-19T14:52:17.983

[我是Enterprise Architect](http://www.sparxsystems.com.au/)架构设计的忠实粉丝。

您可以从设计 UML 开始，然后它将为您生成基本代码。一旦您开始开发和更改代码，它就可以将您的代码差异同步回模型，反之亦然。

它做得更多，而且还有一个 Visual Studio 插件可以让它非常无缝。

如果您想查看，可以免费试用。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-19T15:16:08.190

你正在经历“设计与现实”的分裂。当你计划项目时，你不会知道一路上学到的所有东西。因此，最初的设计总是有缺陷的。

我的做法是只做一个非常粗略的设计，它指定主要目标，并为我们在构建应用程序时将要学习的所有内容留出喘息的空间。如果我需要图表，我总是从实时代码中生成它，因为这是唯一重要的 Truth(tm)。

# c# - 上下文菜单

> ID：565615
> 
> 赞同：3
> 
> 时间：2009-02-19T14:45:57.437
> 
> 标签：c#, .net, winforms, contextmenu

在 C# windows 窗体应用程序中，我想将项目添加到上下文菜单中，以便我可以在上下文菜单中选中或取消选中该项目。可能吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-19T14:49:41.577

那当然是。只需将您的[`CheckOnClick`](http://msdn.microsoft.com/en-us/library/system.windows.forms.toolstripmenuitem.checkonclick.aspx "CheckOnClick")属性更改`ToolStripMenuItem`为`true`.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-19T14:52:06.923

是的，它可能： [MenuItem](http://msdn.microsoft.com/en-us/library/system.windows.forms.menuitem(VS.80).aspx)然后是 Checked 属性

# database - 应用回调“深入”是不好的做法吗？

> ID：565616
> 
> 赞同：1
> 
> 时间：2009-02-19T14:46:21.850
> 
> 标签：database, architecture

奇怪的问题，但我不确定它是否是反模式。

假设我有一个 Web 应用程序，它将向 html 表呈现 1000 条记录。

我见过的典型方法是将查询发送到数据库，以某种方式将记录转换为某种抽象状态（可以是数组或对象等），然后将转换后的记录放入一个集合中，然后在视图中迭代。

随着记录数量的增加，这种方法会占用越来越多的内存。

为什么不与查询一起发送一个回调，在从数据库中读取每个翻译行时对它们执行操作？这意味着您不需要为视图中的进一步迭代收集数据，因此内存占用会缩小，并且您不会对数据进行两次迭代。

这种方法肯定有一些隐含的错误，因为我很少看到它在任何地方使用。这种方法有什么问题？

谢谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-19T14:52:18.373

实际上，这正是开发良好的应用程序应有的行为方式。

这种方法没有任何问题，只是不是所有的数据库接口都允许您轻松地做到这一点。

如果我们谈论`10`另一个社交网络的表格化记录，那么如果您可以通过已经为您实现的单个调用获得哈希数组或任何其他内容，则无需弄乱回调。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-19T15:20:55.873

> 这种方法肯定有一些隐含的错误，因为我很少看到它在任何地方使用。

我用这个。频繁地。即使我不会使用太多内存重复复制数据，使用回调似乎更干净。在带有闭包的语言中，它还可以让您将相关代码放在一起，同时排除杂乱的数据库内容。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-19T15:21:07.543

这是“受工具限制”的一类问题：大多数编程语言不允许说“围绕这段代码做点什么”。近年来，随着闭包的出现，这个问题得到了解决。将闭包视为将代码传递到另一个方法中的一种方式，然后在上下文中执行该方法。例如，在[GSQL](http://groovy.codehaus.org/GSQL)中，您可以编写：

```
def l = []
sql.execute ("select id from table where time > ?", time) { row ->
    l << row[0]
} 
```

这将打开与数据库的连接，创建语句和结果集，然后`l << it[0]`为数据库返回的每一行运行。请注意，代码在内部运行，`sql.execute()`但它可以访问局部变量 ( `l`)*和*`sql.execute()`( )中定义的变量`row`。

使用这种代码，您甚至可以即时生成 HTTP 请求的结果，而无需随时将大部分页面保留在 RAM 中。在我的例子中，我只使用几 KB 的 RAM 将一个 2MB 的文档流式传输到浏览器，然后浏览器会咀嚼 83 秒来解析它。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-19T14:57:17.083

这大致就是迭代器模式允许您做的事情。在许多情况下，这会破坏您的应用程序和数据库之间的接口。像 LINQ 这样的技术甚至有可以将代码发送回数据库的解决方案。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-19T15:30:47.477

我发现使用接口解析器比通过多个类连接的深度回调更容易。MS 有一个比我的更高级的版本，叫做 Unity。这提供了一种更简洁的方式来访问不应紧密耦合的类

[http://www.codeplex.com/unity](http://www.codeplex.com/unity)

# linq - Linq 中的全文搜索

> ID：565617
> 
> 赞同：24
> 
> 时间：2009-02-19T14:46:39.587
> 
> 标签：linq, linq-to-sql, search, full-text-search

Linq 中没有内置全文搜索，而且似乎没有很多关于这个主题的帖子，所以我玩了一下，为我的实用程序类想出了这个方法：

```
public static IEnumerable<TSource> GenericFullTextSearch<TSource>(string text, MyDataContext context)
{
    //Find LINQ Table attribute
    object[] info = typeof(TSource).GetCustomAttributes(typeof(System.Data.Linq.Mapping.TableAttribute), true);
    //Get table name
    String table = (info[0] as System.Data.Linq.Mapping.TableAttribute).Name;
    //Full text search on that table
    return context.ExecuteQuery<TSource>(String.Concat("SELECT * FROM ", table, " WHERE CONTAINS(*, {0})"), text);
} 
```

并将这个包装器添加到每个有全文索引的部分 Linq 类中

```
public static IEnumerable<Pet> FullTextSearch(string text, MyDataContext context)
{
    return (LinqUtilities.GenericFullTextSearch<Pet>(text, context) as IEnumerable<Pet>);
} 
```

所以现在我可以用整洁的东西做全文搜索，比如

```
var Pets = Pet.FullTextSearch(helloimatextbox.Text, MyDataContext).Skip(10).Take(10); 
```

我假设目前只需要一个非常基本的搜索。有人可以改进吗？是否可以作为扩展方法实现并避免包装器？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2010-02-25T14:42:00.153

最巧妙的解决方案是在 sql 中使用内联表值函数并将其添加到您的模型中

[http://sqlblogcasts.com/blogs/simons/archive/2008/12/18/LINQ-to-SQL---Enabling-Fulltext-searching.aspx](http://sqlblogcasts.com/blogs/simons/archive/2008/12/18/LINQ-to-SQL---Enabling-Fulltext-searching.aspx)

> 为了让它工作，你需要创建一个表值函数，它只`CONTAINSTABLE`根据你传入的关键字进行查询，
> 
> ```
> create function udf_sessionSearch
>       (@keywords nvarchar(4000)) returns table as   return (select [SessionId],[rank]
>             from containstable(Session,(description,title),@keywords)) 
> ```
> 
> 然后，您将此函数添加到您的 LINQ 2 SQL 模型中，然后您现在可以编写类似的查询。
> 
> ```
> var sessList = from s   in DB.Sessions
>                join fts in DB.udf_sessionSearch(SearchText) on s.sessionId equals fts.SessionId
>                select s; 
> ```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2012-10-19T15:07:09.800

我使用[Provider Wrapper](http://code.msdn.microsoft.com/EFProviderWrappers-c0b88f32)技术使用了一个小技巧。我有 ac# 代码，用 FTS 搜索 MS SQL 重写 SQL 中的魔法词（你可以调整你喜欢的任何服务器）。

如果您有上下文类 MyEntities，请创建子类，例如

```
public class MyEntitiesWithWrappers : MyEntities
{
    private IEFTraceListener listener;
    public string FullTextPrefix = "-FTSPREFIX-";

    public MyEntitiesWithWrappers(): this("name=MyEntities")
    {
    }

    public MyEntitiesWithWrappers(string connectionString)
        : base(EntityConnectionWrapperUtils.CreateEntityConnectionWithWrappers(connectionString,"EFTracingProvider"))
    {
        TracingConnection.CommandExecuting += RewriteFullTextQuery;
    }

    /// <summary>
    /// Rewrites query that contains predefined prefix like: where n.NOTETEXT.Contains(Db.FullTextPrefix  + text) with SQL server FTS 
    /// To be removed when EF will support FTS
    /// </summary>
    /// <param name="o"></param>
    /// <param name="args"></param>
    public void RewriteFullTextQuery(object o, CommandExecutionEventArgs args)
    {
        var text = args.Command.CommandText;
        for (int i = 0; i < args.Command.Parameters.Count; i++)
        {
            DbParameter parameter = args.Command.Parameters[i];
            if (parameter.DbType.In(DbType.String, DbType.AnsiString, DbType.StringFixedLength, DbType.AnsiStringFixedLength))
            {
                if (parameter.Value == DBNull.Value)
                    continue;
                var value = (string) parameter.Value;
                parameter.Size = 4096;
                if (value.IndexOf(FullTextPrefix) >= 0)
                {
                    value = value.Replace(FullTextPrefix, ""); // remove prefix we added n linq query
                    value = value.Substring(1, value.Length-2); // remove %% escaping by linq translator from string.Contains to sql LIKE
                    parameter.Value = value;
                    args.Command.CommandText = Regex.Replace(text,
                        string.Format(@"\(\[(\w*)\].\[(\w*)\]\s*LIKE\s*@{0}\s?(?:ESCAPE '~')\)", parameter.ParameterName), 
                        string.Format(@"contains([$1].[$2], @{0})", parameter.ParameterName));
                }
            }
        }
    }
} 
```

然后像这样使用它：

```
var fullTextSearch = Db.FullTextPrefix + textToSearch;
var q = Db.Notes.Where(n => !n.Private && n.NoteText.Contains(fullTextSearch)); 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2011-03-07T22:42:00.503

我对缺乏明确的例子感到非常沮丧……尤其是当存在潜在的大型数据集并且需要分页时。因此，这是一个示例，希望包含您可能需要的所有内容 :-)

```
create function TS_projectResourceSearch
    (   @KeyStr nvarchar(4000), 
        @OwnId int,
        @SkipN int,
        @TakeN int )
    returns @srch_rslt table (ProjectResourceId bigint not null, Ranking int not null )
    as 
    begin

        declare @TakeLast int
        set @TakeLast = @SkipN + @TakeN
        set @SkipN = @SkipN + 1

        insert into @srch_rslt  
        select pr.ProjectResourceId, Ranking
        from 
        (
            select t.[KEY] as ProjectResourceId, t.[RANK] as Ranking, ROW_NUMBER() over (order by t.[Rank] desc) row_num
            from containstable( ProjectResource,(ResourceInfo, ResourceName), @KeyStr )
            as t        
        ) as r
        join ProjectResource pr on r.ProjectResourceId = pr.ProjectResourceId
        where (pr.CreatorPersonId = @OwnId
            or pr.ResourceAvailType < 40)
            and r.row_num between @SkipN and @TakeLast
        order by r.Ranking desc 

        return
    end
    go

    select * from ts_projectResourceSearch(' "test*" ',1002, 0,1) 
```

享受吧，帕特里克

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-19T15:49:22.853

使用 CONTAINSTABLE 的更好的方法（使排名生效）

```
String pkey = context.Mapping.GetTable(typeof(TSource)).RowType.DataMembers.SingleOrDefault(x => x.IsPrimaryKey).Name;
string query = String.Concat(@"SELECT *
    FROM ", table, @" AS FT_TBL INNER JOIN
    CONTAINSTABLE(", table, @", *, {0}) AS KEY_TBL
    ON FT_TBL.", pkey, @" = KEY_TBL.[KEY]
    ORDER BY KEY_TBL.[RANK] DESC");
return context.ExecuteQuery<TSource>(query, text); 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2021-05-06T00:47:48.650

.NET Core 2.1 及更高版本支持允许使用`FREETEXT`和`FREETEXTTABLE`搜索的扩展方法

```
using Microsoft.EntityFrameworkCore;

var results = dbContext.MyTable
        .Where(e => EF.Functions.FreeText("*", "search criteria")); 
```

该`FreeText`函数在中定义，`Microsoft.EntityFrameworkCore.SqlServer`因此您的项目必须引用该包。

[文档](https://docs.microsoft.com/en-us/dotnet/api/microsoft.entityframeworkcore.sqlserverdbfunctionsextensions.freetext)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-25T15:47:44.933

我一直在尝试解决确切的问题。我喜欢在我的 LINQtoSQL 中编写我的 SQL 逻辑，但我需要一种方法来进行全文搜索。现在我只是使用 SQL 函数，然后在 linq 查询中调用用户定义的函数。不确定这是否是最有效的方法。你们有什么感想？

* * *

## 回答 #7

> 赞同：-3
> 
> 时间：2009-02-19T15:06:00.447

你可以做这样的事情

```
 var results = (from tags in _dataContext.View_GetDeterminationTags
                   where tags.TagName.Contains(TagName) ||
                   SqlMethods.Like(tags.TagName,TagName)
                   select new DeterminationTags
                   {
                       Row = tags.Row,
                       Record = tags.Record,
                       TagID = tags.TagID,
                       TagName = tags.TagName,
                       DateTagged = tags.DateTagged,
                       DeterminationID = tags.DeterminationID,
                       DeterminationMemberID = tags.DeterminationMemberID,
                       MemberID = tags.MemberID,
                       TotalTagged = tags.TotalTagged.Value
                   }).ToList(); 
```

注意 TagName.Contains 也 SQLMethods.Like 只是做一个使用

```
using System.Data.Linq.SqlClient; 
```

以访问该 SQLMethods。

* * *

## 回答 #8

> 赞同：-4
> 
> 时间：2009-02-19T15:12:17.203

dswatik - 想要全文搜索的原因是 .contains 转换为

```
SELECT * FROM MYTABLE WHERE COLUMNNAME LIKE '%TEXT%' 
```

它忽略任何索引并且在大表上很可怕。

# random - 生成具有 256 个随机位的数字的最佳方法？

> ID：565618
> 
> 赞同：2
> 
> 时间：2009-02-19T14:46:45.843
> 
> 标签：random, shuffle

生成具有 256 个随机位的数字的最佳方法是什么？

连接随机字节是否有效？

```
 byte[] data = new byte[32];
RNGCryptoServiceProvider rng = new RNGCryptoServiceProvider();
rng.GetNonZeroBytes(data); // should include zero bytes?
string number = BitConverter.ToString(data, 0).Replace("-", ""); 
```

此外，使用不重复的这些数字对一副牌进行排序是否合适？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-19T14:56:20.580

是否可以连接随机字节取决于您使用的随机数生成器。一些随机数生成器表现出序列相关性。对于这些随机数生成器，连接会很糟糕。

如果您将这些随机数用于加密目的，您应该查看[Blum Blum Shub](http://en.wikipedia.org/wiki/Blum_Blum_Shub)。否则，请查看[Mersenne Twister](http://en.wikipedia.org/wiki/Mersenne_twister)。

要对有限集进行洗牌，请查看[Fisher-Yates shuffle](http://en.wikipedia.org/wiki/Fisher-Yates_shuffle)。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-19T14:51:04.350

洗牌的正确方法是使用[Knuth Shuffle](http://en.wikipedia.org/wiki/Fisher-Yates_shuffle)。它简单而完美。完美的意思是，假设使用好的 RNG，所有可能的卡片排序都是同样可能的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-19T14:49:53.510

是的，连接随机字节会起作用。

编辑：不知道为什么你需要 256 位来洗一副牌，你能进一步扩展那部分吗？

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-02-19T14:51:05.897

如果随机字节生成器很好，任何方法都同样有效，而且你的洗牌方法也是合适的。

# sql - JOIN 和 INNER JOIN 的区别

> ID：565620
> 
> 赞同：1236
> 
> 时间：2009-02-19T14:47:29.977
> 
> 标签：sql, sql-server, join, inner-join

这两个连接都会给我相同的结果：

```
SELECT * FROM table JOIN otherTable ON table.ID = otherTable.FK 
```

对比

```
SELECT * FROM table INNER JOIN otherTable ON table.ID = otherTable.FK 
```

性能或其他方面的陈述之间有什么区别吗？

**不同的SQL**实现之间有区别吗？

* * *

## 回答 #1

> 赞同：1338
> 
> 时间：2009-02-19T14:50:21.047

它们在功能上是等效的，但`INNER JOIN`读起来会更清晰一些，尤其是当查询中包含其他连接类型（即`LEFT`or`RIGHT`或`CROSS`）时。

* * *

## 回答 #2

> 赞同：300
> 
> 时间：2009-02-19T14:48:41.440

不，没有区别，纯[**语法糖**](http://en.wikipedia.org/wiki/Syntax_sugar)。

* * *

## 回答 #3

> 赞同：186
> 
> 时间：2012-02-28T08:23:14.833

内连接 = 连接

> 如果您在使用单词 JOIN 时**未指定类型，则默认**为 INNER JOIN。
> 
> 您还可以使用 LEFT OUTER JOIN 或 RIGHT OUTER JOIN，在这种情况下，单词 OUTER 是可选的，或者您可以指定 CROSS JOIN。

或者

> 对于内连接，语法是：
> 
> SELECT ...
> FROM TableA
> [INNER] JOIN TableB
> 
> （换句话说，“INNER”关键字是**可选**的——有或没有它的结果都是一样的）

* * *

## 回答 #4

> 赞同：68
> 
> 时间：2012-05-15T13:33:06.427

> 不同的 SQL 实现之间有区别吗？

是的，[Microsoft Access](http://en.wikipedia.org/wiki/Microsoft_Access)不允许仅`join`. 它需要[`inner join`](http://msdn.microsoft.com/en-us/library/bb208854%28v=office.12%29.aspx).

* * *

## 回答 #5

> 赞同：58
> 
> 时间：2009-02-19T15:09:36.257

与 类似`OUTER JOINs`，该词`"OUTER"`是可选的。是`LEFT`or`RIGHT`关键字使`JOIN`an `"OUTER" JOIN`。

但是由于某种原因，我总是使用`"OUTER"`as in`LEFT OUTER JOIN`和 never `LEFT JOIN`，但我从不使用`INNER JOIN`，而是我只是使用`"JOIN"`：

```
SELECT ColA, ColB, ...
FROM MyTable AS T1
     JOIN MyOtherTable AS T2
         ON T2.ID = T1.ID
     LEFT OUTER JOIN MyOptionalTable AS T3
         ON T3.ID = T1.ID 
```

* * *

## 回答 #6

> 赞同：36
> 
> 时间：2015-08-02T16:38:33.163

正如其他答案已经说明的那样，您的示例没有区别。

[此处记录了](https://msdn.microsoft.com/en-us/library/ms177634.aspx)相关的语法

```
<join_type> ::= 
    [ { INNER | { { LEFT | RIGHT | FULL } [ OUTER ] } } [ <join_hint> ] ]
    JOIN 
```

表明所有都是可选的。该页面进一步阐明

> `INNER`指定返回所有匹配的行对。丢弃两个表中不匹配的行。**当没有指定连接类型时，这是默认的**。

语法也确实表明有一次`INNER` *是*需要的。指定连接提示时。

请参阅下面的示例

```
CREATE TABLE T1(X INT);
CREATE TABLE T2(Y INT);

SELECT *
FROM   T1
       LOOP JOIN T2
         ON X = Y;

SELECT *
FROM   T1
       INNER LOOP JOIN T2
         ON X = Y; 
```

[![在此处输入图像描述](https://i.stack.imgur.com/J4DX4.png)](https://i.stack.imgur.com/J4DX4.png)

# .net - 返回 System.Nullable 的 int64 的 GetType

> ID：565625
> 
> 赞同：5
> 
> 时间：2009-02-19T14:48:37.070
> 
> 标签：.net, types, nullable

我有一个具有 type 属性的对象。当类型设置为 Int64 时，我稍后尝试提取类型信息，我得到 System.Nullable。

这是类型信息

```
{Name = "Nullable`1" FullName = "System.Nullable`1[[System.Int64, mscorlib, Version=2.0.0.0]]"} 
```

如何获得 System.Int64 类型的这个？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-19T15:13:07.200

听起来您有一个给定的类型，您想要该类型或其基础类型（如果它是`Nullable<T>`. 最好的方法是这样的：

```
Nullable.GetUnderlyingType(yourObject.Type) ?? yourObject.Type; 
```

因为如果给定不是`Nullabe.GetUnderlyingType`返回，您可以使用空合并运算符 (??) 将值默认为原始类型。`null``Type``Nullable<T>`

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-19T14:59:13.147

```
Type t = Nullable.GetUnderlyingType(nullableType); 
```

请参阅[MSDN](http://msdn.microsoft.com/en-us/library/system.nullable.getunderlyingtype.aspx)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-06-05T10:03:19.833

```
if ( property.PropertyType.IsGenericType 
  && property.PropertyType.GetGenericTypeDefinition() == typeof(Nullable<>) ) 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-19T14:59:38.950

如果对象不为空，GetType 将返回 Int64。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-19T15:02:48.613

也许您将类型属性设置为“System.Int64”？任何地方？否则我无法重现你的行为。

# linux - 颠覆网页界面

> ID：565628
> 
> 赞同：22
> 
> 时间：2009-02-19T14:48:45.980
> 
> 标签：linux, svn, centos, plesk

我最近在 Linux 服务器 ( [CentOS](http://en.wikipedia.org/wiki/CentOS) ) 上安装了 Subversion，一切正常。

我想知道是否有任何 Web 界面可用于管理存储库，即创建/删除存储库、管理用户和权限、查看修订历史记录等。

我的想法是我可以通过 Web 界面而不是使用 SSH 来做所有事情。

顺便说一句，我在这台服务器上有[Plesk](https://en.wikipedia.org/wiki/Plesk) /virtuozzo（在另一台测试服务器上有 Webmin），所以如果有东西可以直接集成到这些服务器上，那就更好了！

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-02-19T15:00:14.017

Subversion 人员有一个[链接列表](http://svn.apache.org/repos/asf/subversion/branches/python-3-compatibility/www/links.html)，其中引用了大量与 Subversion 相关的材料，包括管理和不同的 Web 界面。

我没用过，但[Submin](http://supermind.nl/submin/index.html)可能是你要找的。

如果您正在寻找简单的存储库浏览 mod_dav_svn 是最小的并且有效。

[Trac](http://en.wikipedia.org/wiki/Trac)已经被推荐了，但是它有更多的 bug-tracking-wiki-project-management 功能，但是开箱即用的 SVN 管理很少。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-11-25T15:49:52.270

也看看： [http ://www.usvn.info/](http://www.usvn.info/)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2010-09-14T13:48:09.240

这可能是其他人所说的重复，但我已经看过很多选择。最好的可能是这些：

*   [亚分​​钟](http://supermind.nl/submin/about.html)(Linux)
*   [视觉SVN](http://demo-server.visualsvn.com/!/) (Windows)
*   [RVskin](http://www.rvskin.com/)（适用于 Linux/ [cPanel](https://en.wikipedia.org/wiki/CPanel)）

*[创建您自己的自定义 Subversion 管理层](http://www.troyhunt.com/2009/10/creating-your-own-custom-subversion.html)*启发我检查 VisualSVN，但我还没有测试它。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-19T14:53:32.880

[Trac](http://en.wikipedia.org/wiki/Trac)可能会满足您的目的，但我不确定它为您提供了对实际日常 SVN 命令的多少控制。然而，它确实有一个非常好的界面来查看 SVN 修订版。[在这里](http://trac.openstreetmap.org/browser/applications/rendering/gosmore)查看gosmore的[Trac](http://en.wikipedia.org/wiki/Trac)页面示例，以及[OpenStreetMap](http://en.wikipedia.org/wiki/OpenStreetMap)路由程序以了解它是什么样的。

还有[websvn](http://websvn.tigris.org/)和[viewsvn](http://viewsvn.berlios.de/)，但我似乎找不到任何真正允许您上传文件以签入或类似的东西。它们都旨在查看存储库、下载文件、查看日志和比较修订。

就日常签入、签出而言，您最好使用`svn`命令或像[TortoiseSVN](http://tortoisesvn.tigris.org/)（如果从 Windows 中使用）这样的友好 GUI 来处理这类事情。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2013-03-03T23:23:04.643

SVN 专家建议[使用 Subversion Edge](http://www.collab.net/products/subversion)。

> ```
> Install and Update: Certified binaries, wizard driven installers with 1-click updates
> Repository Management: Create, manage, browse, and local backup
> User Management: Manage roles, permissions and access rules
> Administration: Authentication, server management and health analytics
> Desktops & IDEs: Eclipse, Visual Studio, AnkhSVN, Subclipse, and more
> Cloud Services: Public cloud backup and restore to CollabNet CloudForge
> TeamForge: Adds multi-server Subversion replication, code governance, improved network performance, as well as Agile ALM through DevOps
> Git: Upgrade to TeamForge from SubversionEdge to manage your Git and SVN repositories within one environment 
> ```

我对此感到非常兴奋，目前正在对其进行设置（它是 Java 应用程序，因此与普通的 Web UI 相比，正确设置它需要一些时间）。

* * *

## 回答 #6

> 赞同：-2
> 
> 时间：2010-07-13T09:23:10.187

您可能需要查看[VoilàSVN](http://www.voilasvn.com/)或[OpenGrok](http://opengrok.github.io/OpenGrok/)

# c# - 打包vs2005项目

> ID：565629
> 
> 赞同：2
> 
> 时间：2009-02-19T14:49:00.177
> 
> 标签：c#, .net, visual-studio, build-process, packages

以下是我创建发送给最终用户的包的步骤：

1.  使用 Visual Studio 2005 在调试和发布模式下构建项目（这是用 C# 编写的库 DLL）。
2.  我运行 doxygen 并创建文档
3.  我创建了一个文件夹结构，我在其中放置了我的 dll 文档和一些发行说明
4.  压缩它
5.  装运它

目录树结构如下所示：

```
 --NetApi:
               --Api
                  --vs2005
                       --relesae
                              --dll
                        --debug
                              --dll
               --documentation
                  --htmls files generated by doxygen

              --ReleaseNotes.html       

              --Examples 
```

我正在考虑推出一个脚本来自动化它。但在此之前，我想了解一下打包库api类型项目的常见做法，特别是结构和使用的工具。高度赞赏参考和示例

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-26T21:00:09.667

我非常相信持续集成和自动化构建。

我们的商店有一条规则，我们永远不会向客户提供不是由完全自动化的零步或一步构建产生的可交付成果（这意味着人类只需点击一次鼠标即可完成基线、构建、打包和发布。）这些完全自动化的一步构建通过识别何时对源代码控制系统进行更改并自动触发“构建脚本”来工作。

对于 C#，我可以推荐[CruiseControl.NET](http://ccnet.thoughtworks.com/)和[Hudson](http://hudson-ci.org/)。

我还可以推荐[Pragmatic Project Automation](http://www.pragprog.com/titles/auto/pragmatic-project-automation)系列书籍。此标题的变体应可用于 Java 和 .NET。

[有很多预先编写的构建服务器](http://www.joelonsoftware.com/articles/fog0000000043.html)可以帮助您自动执行此操作。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-19T15:08:45.370

对于部署，我真的很喜欢[Inno Setup](http://jrsoftware.org/isinfo.php)。

它是免费的、灵活的，并且可以根据您的口味轻松定制。

# c++ - C++ 中是否有跨平台的预编译头文件框架/方法？

> ID：565630
> 
> 赞同：3
> 
> 时间：2009-02-19T14:49:01.843
> 
> 标签：c++, cross-platform, precompiled-headers

我想知道其他人在 C++ 中实现跨平台（linux 和 windows）预编译头文件的经历。我正在考虑 Visual Studio 允许您使用 stdafx.h 文件做什么，这些文件可以通过预编译全面使用的通用头文件（std/boost/etc 头文件）来显着缩短大量 C++ 代码的编译时间。有没有办法通过某种框架或其他东西跨平台实现这一点？

你有过什么样的经历？

### 编辑

我并不是真的要分享实际生成的 pch，我更感兴趣的是可以生成 pch 的框架，以及在特定平台上编译时的等价物，比如 gcc。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-19T23:23:38.050

`gcc`如果您传递头文件而不是实现文件，将自动预编译头文件。`-x`如果它试图生成目标代码，只需添加开关。GCC 总是会`.gch`在头文件之前查找文件，所以使用起来很简单。[此页面](http://gcc.gnu.org/onlinedocs/gcc/Precompiled-Headers.html)有更多信息。将其添加到您`Makefile`的自动化过程中。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-19T15:08:18.413

Visual Studio 预编译的头文件基于一个头文件，包括所有应该预编译的文件，通常包括很少更改的头文件，例如标准库的东西。它连接到在设置中设置为“生成预编译头”的stdafx.cpp，它只包括stdafx.h。

然后，Visual Studio 会强制所有文件包含 stdafx.h 作为其第一个预处理器定义，以避免在它之前包含头文件或更改影响 stdafx.h 解析的 #define 宏出现问题。

我认为将此行为映射到 g++ 的最简单方法是使其仅预编译 stdafx.h 并正常包含其他标头。这将类似于您在 Visual c++ 中所做的。您还可以将 stdafx 重命名为不那么愚蠢的名称，例如“precompiled_.h”或其他名称。很容易将 Visual Studio 设置为使用此文件。

我已经使用 g++ 的 make 文件实现了这种系统，它提供了一些性能，但我没有设法获得与 Visual Studio 中的预编译头文件相同的性能提升。这是一段时间以前的事了，从那时起 g++ 可能会有所改进。我已经设法让 CMake 生成带有预编译头文件的 Visual Studio 项目，我还没有尝试过它的 Makefile 生成，但应该没问题。

Visual Studio 有一些其他技巧可以提高编译速度。一种是在一批中编译许多具有相同设置的 cpp 文件。这可以使用通常称为统一构建系统的方式手动完成，在该系统中，您将多个 cpp 文件包含到一个文件中并一次性构建它，从而节省了头解析和磁盘 io。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-19T14:55:03.857

如果您的意思是在平台之间移植预编译的头文件数据库（.pch 或其他），那么这是不可能的，因为头文件在不同的平台上会有不同的内容。

# java - 为什么带有前导零的整数文字会被奇怪地解释？

> ID：565634
> 
> 赞同：67
> 
> 时间：2009-02-19T14:49:29.083
> 
> 标签：java

这打印 83

```
System.out.println(0123) 
```

然而这打印 123

```
System.out.println(123) 
```

为什么它会这样工作？

* * *

## 回答 #1

> 赞同：108
> 
> 时间：2009-02-19T14:51:29.123

前导零表示使用[八进制（以 8 为基数）](https://en.wikipedia.org/wiki/Octal)表示的文字。

0123可以通过doing进行转换`(1 * 8 * 8) + (2 * 8) + (3)`，等于十进制的83。由于某种原因，八进制浮点数不可用。

如果您不打算用八进制表示文字，请不要使用前导零。

还有一个`0x`前缀表示文字以十六进制（基数 16）表示。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-02-19T14:51:19.530

因为以开头的整数文字`0`被视为八进制数。

[请参阅JLS](https://docs.oracle.com/javase/specs/jls/se9/html/jls-3.html#jls-3.10.1)的第 3.10.1 节

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-02-19T14:52:26.250

试试这个：

```
public static String leftPad(int n, int padding) {
    return String.format("%0" + padding + "d", n);
}
leftPad(5, 3); // return "005"
leftPad(15, 5); // return "00015"
leftPad(224, 3); // return "224"
leftPad(0, 4); // return "0000" 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-02-19T14:53:44.673

第一个打印为 83，因为 java 将 0123 作为八进制数并打印该数字的十进制等值。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-02-19T23:12:38.063

八进制（前导 0）和十六进制（前导 0x）继承自 C。为了比较，请尝试

```
System.out.println(0x123); 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2014-05-10T09:55:43.717

在 Java 中，带有前导零的整数文字是八进制整数（以 8 为基数）。

```
(1 * 8^2) + (2 * 8^1) + (3 * 8^0) = 83 
```

因此，如果您不想将其视为八进制数，请不要使用任何以 0 开头的数字。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2017-05-04T16:27:22.923

```
0123 -> 83
1010L -> 1010  
0101L -> 65 
```

数字`1010L`和`0101L`不是二进制表示（只是为了避免混淆）。
这些数字以十进制表示。

即使按照[Oracle 文档](https://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html)中的 Regex 模式，

> \0n 是八进制值为 0n (0 <= n <= 7)
> 的字符 \xhh 是十六进制值为 0xhh 的字符

因此，无论是数字还是格式，您的数字`0101`都`Integer`被`Long`视为数字的八进制表示。

```
123 => 1 * 8^2 + 2 * 8^1 + 1 * 8^0 = 83
0101 => 1 * 8^2 + 0 * 8^1 + 1 * 8^0 = 64 + 0 + 1 = 65 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-19T15:43:24.353

`printf`会这样做：http: [//java.sun.com/developer/technicalArticles/Programming/sprintf/](http://java.sun.com/developer/technicalArticles/Programming/sprintf/)

```
public class X
{
    public static void main(final String[] argv)
    {
        System.out.printf("%04d", 123);
        System.out.println();
    }
} 
```

如果你想改变长度，你也可以做到`"%0" + size + "%d"`......虽然如果长度很常见，我可能会制作像`"%04d"`,`"%012d"`等常量......

# javascript - 您遇到过哪些跨浏览器问题？

> ID：565641
> 
> 赞同：64
> 
> 时间：2009-02-19T14:50:36.693
> 
> 标签：javascript, css, dom, cross-browser

在开发多套浏览器的过程中，由于浏览器实现的不同，您在开发过程中遇到过哪些问题？

首先，我列出了一些我面临的问题：

*   Firefox 中的文本节点仅允许 4K 数据。因此，一个 XML Ajax 响应被拆分为多个文本子节点，而不仅仅是一个节点。它在 Internet Explorer 中很好。对于 Firefox，要获取完整数据，您需要在调用 node.firstChild 之前使用 node.normalize 或使用 node.textContent，这两者都是 Mozilla 特定的方法
*   Internet Explorer 不替换`&nbsp;`或 HTML 字符代码 160，您需要替换其 Unicode 等价物 \u00a0
*   在 Firefox 中，表单内动态创建的输入字段（使用 document.createElement 创建）不会在表单提交时传递其值。
*   即使元素名称匹配，Internet Explorer 中的 document.getElementById 也会返回一个元素。Mozilla 仅在 id 匹配时返回元素。
*   在 Internet Explorer 中，如果选择框的值未由任何选项表示，它将显示为空白，Firefox 显示第一个选项。

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2009-02-19T15:07:11.410

唯一**真正**让我明白的：

*   [IE6 仍然被大约 18% 的网络用户使用](http://www.w3schools.com/browsers/browsers_stats.asp)——这几乎是五分之一——解决它的问题既费时又费力，而且令人沮丧。;)[问题](http://www.google.com/search?q=the+ie+factor)实在太多，无法在此处列出。

如果您对这些问题本身感兴趣，[QuirksMode.org](http://quirksmode.org/)是我在跳转到客户端库之前每天使用的一个了不起的资源。还可以查看 John Resig 在 yahoo 上的[The DOM is a Mess](http://ejohn.org/blog/the-dom-is-a-mess/)演示文稿，它提供了很多关于如何有效处理跨浏览器主题的理论。

但是，如果您有兴趣简单地解决这些问题，那么您的问题就是一个很好的例子，说明为什么许多人考虑使用[jQuery](http://www.jquery.com)、[YahooUI](http://developer.yahoo.com/yui/)、[MooTools](http://mootools.net/)、[Dojo](http://www.dojotoolkit.org/)等客户端库。拥有蓬勃发展的社区、人才和企业支持项目像那些让你专注于你的应用程序而不是这些问题。

下面是一些 jQuery 示例，它们避免了很多跨浏览器的挫败感，并且可以真正让这一切变得……有趣。

**跨浏览器鼠标点击绑定**

```
$('#select anything + you[want=using] ~ css:selectors').click(
    function(){ 
       alert('hi');
    }
); 
```

**跨浏览器 HTML 注入**

```
$('#anElementWithThisId').html('<span>anything you want</span>'); 
```

**跨浏览器 Ajax（所有请求对象 [仍然可供](http://docs.jquery.com/Ajax/load)您使用）**

```
$('p.message').load('/folder/file.html'); 
```

**真正让我大吃一惊的是，使用选择器加载数据子集（有关详细信息，请参阅[手册](http://docs.jquery.com/Ajax/load)）**

```
$('p.message').load('/folder/file.html body p:first-child'); 
```

**现在，这一切如何真正开始变得有趣：将方法链接在一起**

```
$('ul.menu a').click(           // bind click event to all matched objects
  function(evt){                // stnd event object is the first parameter
    evt.preventDefault();       // method is cross-browser thx to jquery
    $(this)                     // this = the clicked 'a' tag, like raw js
      .addClass('selected')     // add a 'selected' css class to it
      .closest('ul.menu')       // climb the dom tree back up to the ul
      .find('a.selected')       // find any existing selected dom children
      .not(this)                // filter out this element from matches
      .removeClass('selected'); // remove 'selected' css class
  }
) 
```

让我想起了 Joel 的[你的编程语言能做到这一点吗？](http://www.joelonsoftware.com/items/2006/08/01.html)文章。

把这一切都放在理论层面上，真正的进步不是来自你有意识的思考和努力可以做什么，而是你可以自动（不思考或努力）做什么。Joel 在*Smart And Gets Things Done*中有一个关于面试问题和聪明的开发人员的部分，彻底改变了我的编程方法。

就像钢琴家因为知道所有琴键而可以“弹奏”音乐一样，你的进步不是来自做更多需要思考的事情，而是更多不需要思考的事情。然后，目标就变成了让所有的基础变得容易……自然……潜意识……所以我们都可以了解我们更高层次的目标。

客户端库在某种程度上帮助我们做到了这一点。;)

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2009-02-28T14:43:47.323

我遇到的大多数问题都与 IE 相关，特别是 IE6。我个人处理的问题给我留下了难忘的印象（排名不分先后）：

*   必须使用框架来做基本的事情，因为每个浏览器实现 DOM 的方式略有不同。这对于 IE 和 AJAX 来说尤其令人发指，它们需要多个 if 块才能开始调用。在一个理想的世界里，我可以在没有框架的情况下使用 JavaScript 来做基本的事情。

*   IE 中选择的 onChange 实现错误，并在选择失去焦点之前触发（这是不正确的）。这意味着由于 IE，您永远不能将 onChange 与选择一起使用，因为仅使用键盘的用户将受到此实现问题的影响。

*   您在帖子中提到了它，但是当 IE 在使用 getElementBy **Id** () 时按名称抓取元素时，这是一个巨大的痛苦。

*   在 RTL 语言环境（阿拉伯语、希伯来语等）中，Firefox 实现“text-align: right;” 不正确。如果容器由于某种原因溢出，文本将对齐到可视容器的右侧，而不是容器本身的右侧（即使它使一部分不可见）。

*   不同的浏览器对如何结束数组和对象有不同程度的挑剔。例如，Firefox 可以使用如下所示的数组：[ item0, item1, ]"。但是，同样的代码会使 Opera 出错，因为它讨厌尾随逗号。IE 将使数组成为三项数组，第三项未定义！这肯定是糟糕的代码，但是我已经处理过动态生成的 javascript，重写它是一个巨大的痛苦——如果这能正常工作会很好。

*   一切都与 IE 的[hasLayout](http://www.satzansatz.de/cssd/onhavinglayout.html)相关。如此多可怕的痛苦围绕着这个属性，尤其是当我不知道它存在的时候。通过使用 hacks 添加 hasLayout 解决了很多问题。由于黑客攻击而产生了更多问题。

*   IE 中的浮点数很少像您希望的那样工作。它们在其他浏览器中也往往很烦人，但它们至少符合特定的行为。;)

*   IE[在列表项之间添加额外的空白](http://www.brunildo.org/test/IEWlispace.php)给我带来了无尽的痛苦，因为 YUI 使用列表来制作菜单。（要完全掌握这个问题，您必须在 IE 和另一个浏览器中并排查看该链接。）

*   我有很多问题让文本不包含在 IE 中的容器中。其他浏览器听“white-space: nowrap”的效果要好得多。这是我使用的具有可调整大小的侧边栏的 UI 的问题；在 IE 中，如果调整太多，侧边栏项目将开始换行。

*   IE6 中缺少许多 CSS 选择器类型意味着您必须对 DOM 进行不必要的分类。例如缺少+、:hover、:first-child。

*   不同的浏览器对空文本节点的处理方式不同。具体来说，当使用 Opera 遍历 DOM 时，我不得不担心在浏览节点的子节点时出现空文本节点。如果您正在寻找特定项目，这不是问题，但如果您正在编写需要特定输入的代码并且浏览器查看该输入的方式不同，那么这不是问题。

*   在 IE6 中，当您通过 javascript 动态生成 iframe 时，iframe 有时不会自动填充其容器（即使宽度和高度设置为最大值）。我仍然不知道如何解决这个问题，并且一直在考虑发布一个关于它的问题。

*   在 IE 中，您不能在 <tbody> 元素上设置溢出 CSS。这意味着无法以简单的方式制作可滚动的表格（带有具体的 <thead> 和 <tfoot>）。

稍后我可能会在此列表中添加更多内容，因为（对我而言）Web 开发中最糟糕的部分是跨浏览器问题。另外，我怀疑我是否会编辑掉“我以后可能会在此列表中添加更多内容”，因为这些问题是无穷无尽的。:)

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-03-01T11:03:18.530

IE6？嗯。你们已经很*容易*了！您从来没有在 Netscape 4 中使用过 CSS 布局（不会导致整个浏览器崩溃）？您从来不必为不支持表格的设备浏览器编写代码吗？你从来没有为**IE Mobile**写过东西吗？

*   不支持 JavaScript 分配的事件处理程序；您只能通过在 innerHTML 中设置“onclick="somestring"” 来编写事件处理程序；

*   最基本的 DOM 1 级属性（例如 nodeName、nodeType、nodeValue、firstChild、lastChild、nextSibling、previousSibling、data、value、HTMLElement.getElementsByTagName、所有 HTMLTableElement 成员、大多数 CSSStyleDeclaration 成员）根本不存在；

*   大多数 CSS 布局属性不起作用；许多简单的 CSS 属性（例如“宽度”）不适用于某些元素，例如表单字段；

*   在表格和表单字段等元素上设置许多其他 CSS 属性会导致浏览器即时挂起，由于 Windows Mobile 没有内置任务管理器，这意味着您必须软重置设备；

*   哦，在 <button> 中放置除文本之外的任何内容也是 insta-crash；

*   可以追溯到 Netscape 2 (!) 的大量基本 JavaScript 方法和“DOM 级别 0”方法丢失了。

而这是 2009 年微软旗舰 Windows Mobile 浏览器的最新版本。

当然，它支持 XMLHttpRequest，但是在 CSS 和脚本支持低于 IE3（！）的浏览器上编写 AJAX 代码是一种奇怪的精神分裂症，就像您正在使用 21 世纪和 19 世纪技术的奇怪混合物一样。

我不会推荐它。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-02-19T15:00:07.137

这样做太久了，没有很多问题，但它仍然让我发疯，我必须解决 IE 对 CSS 的不支持，比如 display:table、:last-child 和 :hover 在锚点之外。

所有 IE 的东西仍然很疯狂，但现在只是*背景的疯狂*:)

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-03-02T00:30:31.570

最大的跨浏览器问题？-**互联网浏览器**！

<start_grumpy>

IE***独自***负责“阻止网络”——我们的开发人员无法使用 HTML5、SVG、XFORMS 或 CANVAS 创建令人惊叹的网站……不是因为 Firefox、Safari 或 Chrome，而是因为 2/3s互联网仍然停留在 IE 上。更不用说大约 20% 的网络仍然停留在 IE6 上！IE8 是第一个至少***尝试***兼容标准（即 2001 年的标准）的 IE 版本，这意味着至少要到**2018 年**我们才能最终开始放弃对 IE7 的所有支持。

</start_grumpy>

否则，请命名一个 IE 完全支持的 DOM 方法……这是一个很难回答的问题，这是我最大的 CrossBrowser 问题。

```
getElementById() - badly broken
getElementsByName() - buggy
getElementsByTagName() - buggy
getAttribute() - buggy
setAttribute() - majorly broken
createElement() - buggy
appendChild() - buggy 
```

连 IE 发明的东西都搞砸了……

```
innerHTML (getting) - returns the worst markup possible
innerHTML (setting) - doesn't work on the elements you'd want to dump a bunch of data into (e.g. Tables and Selects) 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-02-19T14:54:14.080

在 Internet Explorer 中（注意：旧版本的 IE，不一定是 9/10+ 版本），如果您使用创建表单元素`document.createElement`，该字段将不会与表单一起提交。唯一的解决方法是使用

```
element.innerHTML = "<input type='text' value="+val+" name="+name+">"; 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-02-19T14:58:11.777

在为 Web 应用程序开发系统测试框架时，我们必须模拟各种事件，例如点击。我记得我们在 IE 和 FF 中找不到任何正常的方法来实现它，并且不得不以两种不同的方式实现它，并且周围有很多巫术。

我不记得具体细节，但我记得那真的很烦人。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-02-28T21:24:11.807

[这](https://stackoverflow.com/questions/581353)，基本上。

现代 javascript 框架（jQuery、原型等）已经为使代码同时在许多浏览器中工作创造了奇迹。

我现在遇到的最大问题是，任何丰富的 UI 行为都运行得非常缓慢。IE7不好。IE6 更糟糕。IE8 有问题，完成了一半，实际上并不比 IE7 好。

最糟糕的是，我认为我们永远不会摆脱 IE6。它是如此无处不在，又如此古怪。大量的“企业”应用程序（我的意思是一家大公司为另一家大公司开发的大型网络应用程序）应用程序使用高度特定的 IE6 javascript，甚至在 IE7 中都无法使用，更不用说其他了。

公司无法完全替换这些应用程序——我们正试图向他们出售新的应用程序，这意味着 IE6 支持是强制性的。现在的情况是，随着信贷紧缩的公司削减成本，我认为我们在 2015 年仍将支持 IE6 :-(

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-02-19T15:13:01.740

在 IE 中，不能隐藏选择选项元素，只能隐藏选择元素本身。这使得使用 Javascript 动态更改选择选项的内容变得困难。

这个问题在 Safari 和 Chrome 中也存在。

IE 还有很多其他问题，但最近让我感到最沮丧的是这个。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-02-19T15:05:10.200

IE 对在表格上使用 DOM 操作的限制迫使我对某些事情采取完全不同的方法。一开始非常令人沮丧，但积极的一面是第二种方法最终更好，所以我想我应该感谢 IE。;)

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-02-19T15:56:00.740

> 对于 Firefox，要获取完整数据，您需要在调用 node.firstChild 之前使用 node.normalize 或使用 node.textContent，这两者都是 Mozilla 特定的方法

实际上，所有这些都是绝大多数浏览器都支持的 W3C DOM 方法。我想你会发现它们也在 IE 中工作。

我最大的跨浏览器问题是仍有人使用 IE。

第二大是即使在遵循标准的浏览器中，在 CSS 中做一些事情仍然是不可能的；例如`tbody {overflow:auto}`，除了 Gecko，它对任何东西都没有任何用处，即使在那里它也有错误。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-02-19T16:00:04.907

Firefox 和 IE 在 DOM 中有不同的表格设置，其中一个单元格的所有兄弟都是其他单元格，而另一个单元格之间有元素。我不记得它是哪种方式，但它在一个应用程序中让我非常头疼。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-02-21T00:45:37.677

我最大的问题是浏览器制造商。嚣张的小*^&%s。我的意思是，你不能把浏览器卖给任何人，但每个人都在他们的小角落里试图超越对方，只会造成分裂。哦，还有铬。Chrome 仍然不知道它想成为什么，Safari 还是 Firefox。除了它的一个客厅技巧之外，它实际上毫无用处。我责怪你们那些因为讨厌垄断而一直在谷歌上搜索的人。猜猜看，他们现在是垄断者。现在我们都可以享受过早推出的二流软件了。

这主要源于我今天在 Chrome 中遇到的一个错误*，我从未想过要查询浏览器。Safari 和 Chrome 都失败了，所以我想嘿，一旦我修复了 Safari 问题，Chrome 就会自动修复，但是哦，不，不。先生。“我在单独的进程中运行选项卡”又名“Sr。没有全屏”只需要用它令人难以置信的实现将我困在蜥蜴锁中。

我也讨厌火狐。我不知道我是否有病毒感染或 Firebug 正在运行。现在，直到 Adob​​e 决定发布一个浏览器，使 Flash 可用于除电影剪辑以外的其他内容，我几乎都会有一些事情要抱怨很长一段时间。我们都知道这就是生活的意义所在。

另外，只有当我遇到可笑的错误让我的大脑汁液运转时，我才喜欢编程。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2009-02-27T20:35:32.463

处理表单时 CSS 框模型中的不一致。特别是每个浏览器处理 <select> 框的方式令人恼火

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2009-03-01T14:34:41.407

我唯一的噩梦是 IE6，你应该总是寻找黑客，但每次你遇到它的问题时，总会有人在你之前遇到它并在博客上谈论它（我们永远不会摆脱它）

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2009-03-01T14:53:09.257

我正在研究由一个认为给元素的大小是大小+填充+边框的人编写的 CSS 布局，就像在 IE5 中一样，而不仅仅是官方规范中解释的内容框。它是在几个月前写的，所以他做了一些肮脏的黑客攻击，使它在 IE7 中看起来很好。我用 FireBug 花了几个小时才找到问题的根源，当我意识到这一点时，我真的很生气。

如果您在 Firefox 中使用为 IE5 编写的“浮动”CSS 打开站点，那么这些框就没有足够的空间来容纳并从页面上掉下来。如果您在 IE7 中打开它，它看起来不错，因为 IE7 允许边框重叠，因此看起来几乎正确。对于像我这样没有经验的人来说，很难注意到。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2009-03-02T19:21:34.020

要在 Internet Explorer 中删除 iframe 边框，您必须将 frameborder 属性指定为不符合 xhtml 的 camelCase 格式。

```
<iframe frameBorder="0"/> 
```

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2010-02-15T12:04:27.747

解决烦人的 IE 显示问题的一种简单方法是使用 firebug，IE 6/7/8 中的 Yep enen 只需使用[Firebug Lite](http://getfirebug.com/firebuglite)

如果您将以下内容添加为书签并将其粘贴在工具栏上，则只需单击一下即可在任何网页上启用 firebug lite。（仅在 IE 中检查它，它工作正常。）

```
javascript:var%20firebug=document.createElement('script');firebug.setAttribute('src','http://getfirebug.com/releases/lite/1.2/firebug-lite-compressed.js');document.body.appendChild(firebug);(function(){if(window.firebug.version){firebug.init();}else{setTimeout(arguments.callee);}})();void(firebug); 
```

# ruby-on-rails - Web App Staging Server 的最佳实践（在预算内）

> ID：565647
> 
> 赞同：17
> 
> 时间：2009-02-19T14:51:55.723
> 
> 标签：ruby-on-rails, web-applications, staging

我想为 Rails 应用程序设置一个登台服务器。我使用 git & github、Cap，并且有一个带有 Apache/Passenger 的 VPS。我很好奇登台设置的最佳实践，包括登台服务器的配置以及与之交互的流程。我确实知道它应该尽可能与生产服务器相同，但限制对其的公共访问会限制它，因此仅为我使用保护它的提示也很棒。

另一个具体问题是我是否可以在 VPS 上创建一个虚拟主机，以便临时服务器可以与生产服务器一起驻留。不过，我觉得可能有理由避免这种情况。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-02-20T04:04:44.803

**便宜又简单的答案：**

1) 在您的 VPS 上指向 staging.domainname.com。

2）添加一个虚拟主机用于暂存，指向应用程序的暂存副本。

3）添加临时环境设置。（你知道你可以在 Rails 中定义新环境吗？有趣的东西！）我认为这就像将 production.rb 复制到 staging.rb 并根据需要进行调整，再加上更新 database.yml 一样简单。

4）在ActionController中，添加类似如下的代码

```
 if (ENV["RAILS_ENV"] == "staging")
     before_filter :verifies_admin
   end 
```

哪里`verifies_admin`可以是你想要的任何东西。我建议使用 HTTP 基本身份验证——既便宜又容易。

```
def verifies_admin
  authenticate_or_request_with_http_basic do |username, password|
    username == "foo" && password == "bar"
  end
end 
```

**请注意，如果他们向您发出入站请求，这可能会破坏您与该支付站点的连接**，尽管这很容易解决（只需关闭 before_filter 以获取适当的控制器和/或操作。）

**更好的答案：**

1) 购买第二个 VPS，该 VPS 使用与常规 VPS 相同的映像配置，和/或使用相同的 install-from-the-bare-metal 脚本进行配置（我喜欢 Capistrano 和 Deprec）。

2) 将 staging.domainname.com 指向它。

3）否则它与其他选项相同。

**需要考虑的事情：**

1）我也应该有一个暂存数据库吗？可能，特别是如果您要测试架构更改。

2) 我应该有一些设施来在暂存系统和生产系统之间移动数据吗？

3) 我的暂存应用程序发生灾难性故障会导致主应用程序瘫痪吗？最好的答案是否定的。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2010-06-14T02:36:00.467

我要补充一点，创建 Capistrano 的 Jamis Buck 还创建了一个 gem，专门用于使用 Capistrano 设置多阶段环境。您可以在没有 gem 的情况下做到这一点，但是 gem 使它更容易。你可以在这里找到他的帖子和说明：[http ://weblog.jamisbuck.org/2007/7/23/capistrano-multistage](http://weblog.jamisbuck.org/2007/7/23/capistrano-multistage)

Pragmatic Programmer 一书“Advanced Rails Recipes”中还有一篇非常有用的文章，它会指导您准确地进行设置。我发现这篇文章的答案与 Rails 食谱书相结合使设置起来非常容易。

StackOverflow 不会让我添加另一个链接，但如果你用谷歌搜索 Advanced Rails Recipes，这本书就是第一个结果。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-19T15:00:19.820

我想这取决于除您之外的任何人是否需要访问登台服务器。如果其他人需要能够访问它，那么您将需要另一个小片，然后您可以使用 htaccess 或防火墙规则来限制谁可以访问它。如果没有其他人需要访问它，我建议使用 VMWare。你可以在你自己的机器上运行它，或者你身边的一个备用盒子，或者一台非常便宜的 PC。我们将免费的 VMWare Server 2 用于我们的暂存和部署测试服务器，它运行良好。只需复制您的基本 VM 设置，就可以非常轻松地创建新的测试服务器。如果您使用的是 Mac，您可以使用 VMWare Fusion，但要花钱，但我必须已经使用它来测试 IE。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-20T00:40:01.347

我可能会因为这样说而受到打击，但是对于预算紧张的小型网站，我认为在生产网站旁边运行临时网站没有任何问题。

您正在使用 Rails、Apache 和Passenger。设置不同的 Rails 配置（和数据库），并将每一个设置为一个命名的 VirtualHost。用 htaccess 保护一个。从您的域创建一条 A 记录（暂存。*）并将其指向那里。

当然，它们之间并不是完全绝缘的。你可能会崩溃一切。哎呀！应该没关系吧 :)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-19T21:15:52.750

使用两个独立的服务器（VPS 或其他），尽可能在基础映像中制作它们（硬件和软件）。自动化您的生产环境的*所有*配置，因此无需手动完成任何操作。使用该自动化来生成与您的生产环境相同的登台服务器。保持自动化以确保两个环境保持同步并且可以按需复制。

解决您的暂存不同步问题和一阶扩展问题。

就成本而言，VPS 与芯片一样便宜。通过拥有一个登台服务器，您将避免的生产停机引发故障的数量将立即为您的登台环境支付费用（除非您实际上根本没有赚钱，在这种情况下，停机时间不是那么大问题，你可能会因为破损而发疯）。

# c# - 找出 Windows 服务的运行进程名称 .NET 1.1

> ID：565658
> 
> 赞同：10
> 
> 时间：2009-02-19T14:53:31.850
> 
> 标签：c#, windows-services, process, .net-1.1

我们正在使用一个写得很糟糕的 Windows 服务，当我们试图从代码中停止它时，它会挂起。所以我们需要找到与该服务相关的进程并杀死它。有什么建议么？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-02-19T16:26:12.393

您可以使用`[System.Management.MangementObjectSearcher](http://msdn.microsoft.com/en-us/library/system.management.managementobjectsearcher.aspx)`获取服务的进程 ID 并`[System.Diagnostics.Process](http://msdn.microsoft.com/en-us/library/system.diagnostics.process.aspx)`获取相应的`Process`实例并终止它。

以下程序中的`KillService()`方法显示了如何执行此操作：

```
using System;
using System.ComponentModel;
using System.Diagnostics;
using System.Management;

namespace KillProcessApp {
    class Program {
        static void Main(string[] args) {
            KillService("YourServiceName");
        }

        static void KillService(string serviceName) {
            string query = string.Format(
                "SELECT ProcessId FROM Win32_Service WHERE Name='{0}'", 
                serviceName);
            ManagementObjectSearcher searcher = 
                new ManagementObjectSearcher(query);
            foreach (ManagementObject obj in searcher.Get()) {
                uint processId = (uint) obj["ProcessId"];
                Process process = null;
                try
                {
                    process = Process.GetProcessById((int)processId);
                }
                catch (ArgumentException)
                {
                    // Thrown if the process specified by processId
                    // is no longer running.
                }
                try
                {
                    if (process != null) 
                    {
                        process.Kill();
                    }
                }
                catch (Win32Exception)
                {
                    // Thrown if process is already terminating,
                    // the process is a Win16 exe or the process
                    // could not be terminated.
                }
                catch (InvalidOperationException)
                {
                    // Thrown if the process has already terminated.
                }
            }
        }
    }
}
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-19T15:00:00.990

WMI 有这个信息：Win32_Service 类。

一个 WQL 查询，如

```
SELECT ProcessId FROM Win32_Service WHERE Name='MyServiceName' 
```

使用 System.Management 应该可以解决问题。

`taskllist.exe /svc`从命令行快速查看：和其他工具。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-19T15:06:40.210

您可以使用

```
tasklist /svc /fi "SERVICES eq YourServiceName" 
```

查找进程名称和 ID，以及同一进程是否托管其他服务。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-20T11:47:41.073

要准确回答我的问题 - 如何找到与某些服务相关的流程：

```
ManagementObjectSearcher searcher = new ManagementObjectSearcher
  ("SELECT * FROM Win32_Service WHERE DisplayName = '" + serviceName + "'");

foreach( ManagementObject result in searcher.Get() )
{
  if (result["DisplayName"].ToString().ToLower().Equals(serviceName.ToLower()))
  {
    int iPID = Convert.ToInt32( result["ProcessId"] );
    KillProcessByID(iPID, 1000); //some method that will kill Process for given PID and timeout. this should be trivial
  }
} 
```

}

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-19T16:52:00.717

Microsoft/SysInternals 有一个名为 PsKill 的命令行工具，可让您按名称终止进程。此工具还允许您终止其他服务器上的进程。 [Windows 系统内部](http://technet.microsoft.com/en-us/sysinternals)

> 用法：pskill [-t] [\computer [-u 用户名 [-p 密码]]] <进程ID | name>
>    -t 杀死进程及其后代。
>    -u 指定用于登录远程计算机的可选用户名。
>    -p 指定用户名的可选密码。如果您省略此项，系统将提示您输入隐藏密码。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-19T16:52:24.260

我想这是一个两步过程 - 如果它总是相同的服务，您可以使用其他答案中建议的方法轻松找到进程名称。

然后，我在 .NET 1.1 Web 服务器上的一个类中有以下代码：

```
Process[] runningProcs = 
          Process.GetProcessesByName("ProcessName");

foreach (Process runningProc in runningProcs)
{
    // NOTE: Kill only works for local processes
    runningProc.Kill();
} 
```

[Kill 方法](http://msdn.microsoft.com/en-us/library/system.diagnostics.process.kill.aspx)可以抛出一些您应该考虑捕获的异常 - 特别是 Win32Exception，如果无法终止进程，则会抛出该异常。

请注意，[WaitForExit 方法](http://msdn.microsoft.com/en-us/library/system.diagnostics.process.waitforexit.aspx)和[HasExited 属性](http://msdn.microsoft.com/en-us/library/system.diagnostics.process.hasexited.aspx)也存在于 1.1 世界中，但在 1.1 中的 Kill 文档页面上并未提及。

# .net - 为什么连接池在不同的服务器上表现不同？

> ID：565677
> 
> 赞同：2
> 
> 时间：2009-02-19T14:58:05.457
> 
> 标签：.net, sql-server-2005, connection-pooling

我们有一个程序读取输入流并将其写入数据库。没有用户输入。

该程序目前在开发服务器和生产服务器上并行运行，使用相同的数据作为输入，写入不同的输出服务器。

在开发服务器上一切都很好；一次打开大约 30 多个池连接并且运行愉快（这听起来可能很高，但我们为每个输入运行几个连续的、简短的查询，并且数据量很大）。在生产服务器上，它总是在 100 个连接时达到最大值，并且有时会引发异常，表明它已用完池中的可用连接。

是否存在某种可能导致这种差异的 SQL Server 设置？唯一的其他区别是生产服务器承受来自各种来源的额外负载。

我可以增加池中的连接数（虽然我不知道有多少会满足它），但我想了解是什么原因造成的。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-04T16:13:58.103

答案原来是我在 SqlDataReaders 上设置 CommandBehaviour.CloseConnection 的方式是错误的（我没有正确使用按位组合）。所以我毕竟在泄漏连接。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-19T15:54:27.547

通常，当您收到异常说您已达到连接池阈值时，您的代码没有正确关闭/处理连接。

我的理论是，您在生产中遇到了一个您不在开发中的数据库异常，因此您的连接保持打开状态。

您应该始终在 Try/Catch 中进行数据库工作，在外部声明连接和命令并在内部进行初始化。您永远不应该依赖在 try/catch 中关闭连接，始终在 finally 块中关闭/处置：

```
try
{
    m_Connection = this.getConnection();
    m_Command = this.getCommand();
    m_Command.CommandTimeout = m_ConnectionTimeout;
    m_Command.CommandText = sql;
    m_Command.Connection = m_Connection;
    m_Command.CommandType = CommandType.Text;

    m_Connection.Open();

    return m_Command.ExecuteNonQuery();
}
finally
{
    if (m_Connection != null && m_Connection.State != ConnectionState.Closed)
    {
        m_Connection.Close();
        m_Connection.Dispose();
    }

    if (m_Command != null)
        m_Command.Dispose();
} 
```

一个应用程序真的不应该消耗 100 个与数据库的连接。我会检查您是否正确关闭了连接。至少在您与数据库通信的地方放置一些日志，以查看那里是否发生异常。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-19T15:17:25.350

连接池是一个 ado.net 问题，因为 SQL 服务器不进行连接池。从内存来看，ado.net 的最大连接池大小是 100，所以你在它的最大值之内。您可以在应用程序中尝试的几件事是使用连接字符串中的最小池大小和最大池大小来硬设置连接池。

更多可以在[这里](http://www.15seconds.com/issue/040830.htm)和[这里](http://msdn.microsoft.com/en-us/library/8xx3tyca.aspx)找到。

# virtualbox - 为什么 VirtualBox 找不到名为 Windows_7 的注册机器？

> ID：565680
> 
> 赞同：28
> 
> 时间：2009-02-19T14:58:40.183
> 
> 标签：virtualbox

我正在尝试使用 VBoxManage setextradata 更改虚拟机的 TCP/UDP。

每当我输入命令时：

```
sudo VBoxManage setextradata Windows_7 "VBoxInternal/Devices/pcnet/0/LUN#0/Config/guestEmule_TCP/Protocol" TCP
```

我收到以下错误：

```
VirtualBox 命令行管理界面版本 2.1.4
(C) 2005-2009 Sun Microsystems, Inc.
版权所有。

[!] 在第 3688 行调用 a->virtualBox->FindMachine(Bstr(a->argv[0]), machine.asOutParam()) 失败！
[!] Primary RC = VBOX_E_OBJECT_NOT_FOUND (0x80BB0001) - 对应于提供的参数的对象不存在
[!] 存在完整错误信息：true，存在基本错误信息：true
[!] 结果代码 = VBOX_E_OBJECT_NOT_FOUND (0x80BB0001) - 对应于提供的参数的对象不存在
[!] Text = 找不到名为“Windows_7”的已注册机器
[!] 组件 = VirtualBox，接口：IVirtualBox，{339abca2-f47a-4302-87f5-7bc324e6bbde}
[!] 被调用者 = IVirtualBox，{339abca2-f47a-4302-87f5-7bc324e6bbde}
```

虚拟机是使用 GUI 创建的。任何的想法？

```
$ cd /Users/marco/Library/VirtualBox/Machines/Windows_7
$ ls
记录 Windows_7.xml
Windows 7.xml.1.5-macosx.bak
$ sudo vboxmanage registervm Windows_7.xml
VirtualBox 命令行管理界面版本 2.1.4
(C) 2005-2009 Sun Microsystems, Inc.
版权所有。

[!] 在第 762 行调用 a->virtualBox->OpenMachine(Bstr(a->argv[0]), machine.asOutParam()) 失败！
[!] Primary RC = NS_ERROR_FAILURE (0x80004005) - 操作失败
[!] 存在完整错误信息：true，存在基本错误信息：true
[!] 结果代码 = NS_ERROR_FAILURE (0x80004005) - 操作失败
[!] Text = 无法锁定设置文件 '/var/root/Library/VirtualBox/Windows_7.xml' (VERR_FILE_NOT_FOUND)
[!] 组件 = 机器，接口：IMachine，{ea6fb7ea-1993-4642-b113-f29eb39e0df0}
[!] 被调用者 = IVirtualBox，{339abca2-f47a-4302-87f5-7bc324e6bbde}
```

* * *

## 回答 #1

> 赞同：67
> 
> 时间：2009-02-19T15:45:22.750

它失败了，因为您使用的是 sudo。VirtualBox 旨在由任何用户（在`vboxusers`组中）运行，sudo 以 VirtualBox 配置为空的 root 用户身份运行命令。

您可以通过键入以下内容进行检查：

```
sudo VBoxManage -nologo list vms # Should print only a newline
VBoxManage -nologo list vms # Detailled information about all your VMs 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2014-03-03T15:42:17.223

不是直接的答案，只是为了让其他人搜索它：

在**Mac OS X**上，您可以告诉 VirtualBox 从另一个用户的主目录加载 VM，前提是文件权限允许，或者如果您以 root 用户身份运行 VirtualBox `sudo`（例如，如果您绝对必须在端口上访问主机的 Web 服务器80)。

这样做的方法是`VBOX_USER_HOME`适当地设置，例如

```
VBOX_USER_HOME=/Users/the_other_user/Library/VirtualBox 
```

如果要`VBoxHeadless`在 root 下运行，请使用：

```
sudo VBOX_USER_HOME=/Users/your_user_id/Library/VirtualBox nohup \
   VBoxHeadless -s "IE10 - Win7" </dev/null &>/dev/null & 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2020-10-27T16:39:59.733

！！仅限视窗！！

如果您不是管理员帐户并尝试在管理员 cmd 窗口中修改您的 VM，请键入以下命令：

cd "C:\Program Files\Oracle\VirtualBox"

VboxManage registervm "C:\Users\Your Name Here\VirtualBox VMs\Your VM name here\Your VM name here.vbox"

现在运行您的虚拟框修改命令或您正在做的其他任何事情，它应该可以工作！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-07-29T10:02:05.067

每当我`sudo`开始时，我都会收到类似的错误消息`VBoxSDL`：

```
Error: machine with the given name not found!
Check if this VM has been corrupted and is now inaccessible. 
```

与[ypocat](https://stackoverflow.com/users/448978/ypocat)的答案类似，我使用这样的小脚本为**Ubuntu解决了这个问题：**

```
#!/bin/bash
export VBOX_USER_HOME=/home/username/.config/VirtualBox
VBoxSDL --startvm nameOfVM 
```

您可以在需要启动`VM`as时使用它`root`。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2016-04-13T21:47:38.940

**SOLUTION_1**：

缺少虚拟技术可能是原因。对于 Intel 系统，它们具有 Intel VT-x（对于 AMD，它们具有 AMD-V），因此请确保已启用它。您可以在启动屏幕中启用它，进入**BIOS 设置**，在其中查找**系统配置**选项卡并启用**虚拟技术**

[![快照](https://i.stack.imgur.com/d6glh.png)](https://i.stack.imgur.com/d6glh.png).

**解决方案_2**：

*为Windows*打开终端或 cmd（以管理员身份运行），然后运行`SC START VBOXDRV`​​. 如果它说服务已经在运行，然后`SC STOP VBOXDRV`尝试`SC START VBOXDRV`。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2021-11-01T20:33:00.000

[除了其他命令之外， RealScar](https://stackoverflow.com/users/14048947/realscar)解决方案还帮助了我，它也可以在 Ubuntu 20.04 中使用。

我最初遇到了问题（VirtualBox 无法找到已注册的机器）。打字后我没有得到任何结果`sudo VBoxManage -nologo list vms`，所以我手动注册了现有的机器打字`sudo vboxmanage registervm /home/user/VirtualBox\ VMs/machinenamefolder/machinename.vbox`。效果很好。

注意：我正在创建 Cuckoo 恶意软件沙盒分析。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2021-10-26T07:05:36.317

如果有人在 ubuntu 中删除了配置文件并且无法从 vbox gui 或终端打开虚拟机，只需打开虚拟机文件夹并使用 virtualbox 打开文件（“机器名”.vbox），它将被注册

# .net - OracleCommand 的内存泄漏

> ID：565681
> 
> 赞同：2
> 
> 时间：2009-02-19T14:59:00.167
> 
> 标签：.net, oracle

我正在使用 ODP.Net 11.1.0 版将数据插入数据库，但我看到了内存泄漏。如果我注释掉下面的代码，它就会消失。这段代码在我的应用程序中被调用了数千次，我可以看到所有堆中的字节数在它运行时稳步增长。cmdStr 包含一个插入语句，该语句插入到具有 375 列的表中。这些字段都是 NUMBER，除了两个 - 一个是 DATE，另一个是 VARCHAR2(20)。我还需要做些什么来清理 OracleCommand 吗？这里没有抛出异常——插入命令每次都成功。

编辑：我尝试移动 return 语句，但没有预期的效果 - using 实际上是一个 try-finally 块。

更新：我使用 CLRProfiler 来查看内存用完的内容，它是一堆字符串对象，大约有 2800 个。它们的引用由 Oracle.DataAccess.Client.ConnDataPool 对象拥有的 HashTable 对象保存。为什么 ODP.NET 保留这些？

```
try
{
    using (OracleCommand cmd = new OracleCommand(cmdStr, conn))
    {
        cmd.CommandTimeout = txTimeout;
        int nRowsAffected = cmd.ExecuteNonQuery();
        errMsg = null;
        return EndpointResult.Success;
    }
}
catch (OracleException e)
{
    return BFOracleAdapter.HandleOracleException(e, out errMsg);
}
catch (Exception e)
{
    errMsg = "OracleInsertOperation Exception: " + e.Message;
    return EndpointResult.Error;
} 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-20T21:34:26.093

尝试使用 OracleConnection 围绕您的 using 语句包装 using 语句，如下所示：

```
try
{
    using (OracleConnection conn = new OracleConnection(connectionString))
    {
        using (OracleCommand cmd = new OracleCommand(cmdStr, conn))
        {
        ....
        }
    }
}
catch (OracleException e)
{
  ....
} 
```

这将尽快摆脱 OracleConnection 对象——即使在 using 语句中发生 OracleException 时也是如此。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-19T15:07:41.673

尝试将其重组为：

```
 object o;
  using (OracleCommand cmd = new OracleCommand(cmdStr, conn))
  {
    try
    {
      cmd.CommandTimeout = txTimeout;
      int nRowsAffected = cmd.ExecuteNonQuery();
      errMsg = null;
      o = EndpointResult.Success;
    }
    catch (OracleException e)
    {
      o = BFOracleAdapter.HandleOracleException(e, out errMsg);
    }
    catch (Exception e)
    {
      errMsg = "OracleInsertOperation Exception: " + e.Message;
      o = EndpointResult.Error;
    }
    finally 
    {
      // clean up
    }
  }
  return o 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-20T21:25:08.737

您是否保持连接打开？每次需要发出此命令时尝试打开一个新连接（无论如何它都会被合并，因此不会影响性能），在完成事务后关闭并处理它，看看内存泄漏是否消失。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-20T21:58:14.897

连接池上的最大连接数是多少？默认情况下，连接池已启用，最大连接数为 100。

您没有显示创建 /disposes 连接的代码部分。我怀疑这更有可能在哪里找到问题。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-19T15:00:46.170

尝试将 return 语句移到 using 块之外。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2017-02-21T05:40:20.520

尝试使用：Oracle.ManagedDataAccess.Client 而不是 Oracle.DataAccess.Client。

# vim - Vimdiff 当前行比较

> ID：565690
> 
> 赞同：2
> 
> 时间：2009-02-19T15:00:42.190
> 
> 标签：vim, diff

在 Beyond Compare 中，您当前选择的行将在窗口底部相互比较。有没有办法在 vimdiff 中完成这个？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-03-15T07:06:21.513

简短的回答没有。

Vim 没有内置的方法来做到这一点。您必须编写一个插件，在底部再拆分两个窗口，将它们重新调整为 1 行。我尝试手动执行此操作，但在滚动时它没有使其中一个窗口保持同步。

我的解决方法是使用`CTRL-W J`将窗口移动到底部，然后`CTRL-W L`将其带回并排比较。

详情见`help: window-moving`_

# wpf - 扩展 WPF 按钮以将数据存储在新属性中

> ID：565695
> 
> 赞同：4
> 
> 时间：2009-02-19T15:01:47.087
> 
> 标签：wpf, button

我想扩展一个 WPF 按钮来存储一些额外的数据，类似于当前的“标签”属性。附加属性是前进的方向吗？我要存储的数据将是一个 URL 链接字符串，例如，我希望能够执行以下操作：

```
<Button Tag="BBC World News" URLLink="http://www.bbc.co.uk"/> 
```

谁能帮我理解如何扩展按钮？

非常感谢

周杰伦

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-20T10:42:08.483

您可以使用[附加属性](http://msdn.microsoft.com/en-us/library/ms749011.aspx)：

```
public class ButtonBehavior
{
     public static readonly DependencyProperty UrlLinkProperty =
            DependencyProperty.RegisterAttached("UrlLink",
                                                typeof(ButtonBase),
                                                typeof(ButtonBehavior),
                                                new FrameworkPropertyMetadata(null));

     public static string GetUrlLink(DependencyObject d)
     {
          return (string)d.GetValue(UrlLinkProperty);
     }

     public static void SetUrlLink(DependencyObject d, string value)
     {
          d.SetValue(UrlLinkProperty, value);
     }
} 
```

然后你可以像这样声明你的按钮：

```
<Button Tag="BBC World News" ButtonBehavior.UrlLink="http://www.bbc.co.uk" Click="btnArticleView"/> 
```

您单击处理程序将如下所示：

```
 protected void btnArticleView(object sender, RoutedEventArgs e)
 {

     Button rb = sender as Button;
     string TheTitle = rb.Tag.ToString();
     string TheURL = ButtonBehavior.GetUrlLink(rb);

     //  Further code here

 } 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-03T09:37:07.270

像这样定义附加属性

```
 public static readonly DependencyProperty UrlLinkProperty =
        DependencyProperty.RegisterAttached("UrlLink",
                                            typeof(String),
                                            typeof(ButtonBehavior)
                                            new FrameworkPropertyMetadata(null)); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-19T17:04:58.787

我不确定你在这里的目标。您不需要扩展 Button 来存储两个值。您始终可以使用包含这两个值的自定义数据对象设置 Button 的 Datacontext。你能解释更多关于你的问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-19T17:19:54.810

感谢您的答复。

我有一个包含复杂自定义数据模板的列表框。该模板包含一个按钮。当我单击按钮时，我想发送 2 个字符串，即“URL 链接”和“URL 标题”。所以我在我的列表框数据模板中绑定了许多值，我想在按钮单击事件中传递其中两个。代码示例：

```
 protected void btnArticleView(object sender, RoutedEventArgs e)
    {

     Button rb = sender as Button;
     string TheTitle = rb.Tag.ToString();
     string TheURL = rb.URLLink.ToString();

     //  Further code here

} 
```

和 XAML：

```
<Button Tag="BBC World News" URLLink="http://www.bbc.co.uk" Click="btnArticleView"/> 
```

干杯

周杰伦

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-04-06T14:00:05.900

我知道这是一个旧帖子，但是...

您始终可以创建一个具有 2 个属性“URLText”和“URLTitle”的自定义类“MyURL”，然后创建该对象“objURL”并设置值并设置 button.datacontext = objURL。然后在点击事件中定义 rb 和 obj 以及你的文本变量 obj = rb.datacontext theTitle = obj.urltitle theURL = obj.urltext

# objective-c - NSString 是整数吗？

> ID：565696
> 
> 赞同：35
> 
> 时间：2009-02-19T15:01:49.160
> 
> 标签：objective-c, cocoa, nsstring

如何检查 NSString 的内容是否为整数值？有没有现成的方法？

必须有一些更好的方法然后做这样的事情：

```
- (BOOL)isInteger:(NSString *)toCheck {
  if([toCheck intValue] != 0) {
    return true;
  } else if([toCheck isEqualToString:@"0"]) {
    return true;
  } else {
    return false;
  }
} 
```

* * *

## 回答 #1

> 赞同：82
> 
> 时间：2009-02-19T15:11:35.847

您可以使用`-intValue`or`-integerValue`方法。如果字符串不以整数开头，则返回零，这有点遗憾，因为零是整数的有效值。

更好的选择可能是使用[`[NSScanner scanInt:]`](https://developer.apple.com/documentation/foundation/nsscanner/1410914-scanint?language=objc)which 返回一个`BOOL`指示它是否找到合适的值。

* * *

## 回答 #2

> 赞同：45
> 
> 时间：2009-02-21T05:15:19.230

像这样的东西：

```
NSScanner* scan = [NSScanner scannerWithString:toCheck]; 
int val; 
return [scan scanInt:&val] && [scan isAtEnd]; 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2012-08-17T15:06:47.807

基于@kevbo 的[答案](https://stackoverflow.com/a/4858584/383919)，这将检查整数> = 0：

```
if (fooString.length <= 0 || [fooString rangeOfCharacterFromSet:[[NSCharacterSet decimalDigitCharacterSet] invertedSet]].location != NSNotFound) {
    NSLog(@"This is not a positive integer");
} 
```

上述的快速版本：

```
func getPositive(incoming: String) -> String {
    if (incoming.characters.count <= 0) || (incoming.rangeOfCharacterFromSet(NSCharacterSet.decimalDigitCharacterSet().invertedSet) != nil) {
        return "This is NOT a positive integer"
    }
    return "YES! +ve integer"
} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2016-05-19T17:47:56.893

不要忘记带小数点的数字！！！

```
NSMutableCharacterSet *carSet = [NSMutableCharacterSet characterSetWithCharactersInString:@"0123456789."];
BOOL isNumber = [[subBoldText stringByTrimmingCharactersInSet:carSet] isEqualToString:@""]; 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2019-04-01T08:23:40.690

```
func getPositive(input: String) -> String {
    if (input.count <= 0) || (input.rangeOfCharacter(from: NSCharacterSet.decimalDigits.inverted) != nil) {
        return "This is NOT a positive integer"
    }
    return "YES! integer"
} 
```

更新@coco 对 Swift 5 的回答

# c# - 如何正确地将文件大小以字节为单位转换为兆字节或千兆字节？

> ID：565704
> 
> 赞同：22
> 
> 时间：2009-02-19T15:03:04.573
> 
> 标签：c#, byte, disk, driveinfo, megabyte

我在我的 C# 项目中使用 DriveInfo 类来检索给定驱动器上的可用字节。如何正确将此数字转换为兆字节或千兆字节？我猜除以 1024 不会完成这项工作。结果总是与 Windows-Explorer 中显示的结果不同。

* * *

## 回答 #1

> 赞同：50
> 
> 时间：2009-02-19T15:05:08.903

1024 在程序中使用是正确的。

您可能存在差异的原因可能是由于 driveinfo 报告为“可用空间”和 Windows 认为可用空间的差异。

请注意，只有驱动器制造商使用 1,000。在 Windows 和大多数程序中，正确的缩放比例是 1024。

此外，尽管您的编译器无论如何都应该对此进行优化，但只需将每个幅度的位移动 10 即可完成此计算：

> KB = B >> 10
> MB = KB >> 10 = B >> 20
> GB = MB >> 10 = KB >> 20 = B >> 30

尽管为了可读性，我希望连续除以 1024 会更清晰。

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2009-02-19T15:16:23.510

XKCD有[明确的答案](http://xkcd.com/394/)：

![KB 的单一、权威标准](https://imgs.xkcd.com/comics/kilobyte.png)

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2010-10-21T06:11:42.400

```
/// <summary>
/// Function to convert the given bytes to either Kilobyte, Megabyte, or Gigabyte
/// </summary>
/// <param name="bytes">Double -> Total bytes to be converted</param>
/// <param name="type">String -> Type of conversion to perform</param>
/// <returns>Int32 -> Converted bytes</returns>
/// <remarks></remarks>
public static double ConvertSize(double bytes, string type)
{
    try
    {
        const int CONVERSION_VALUE = 1024;
        //determine what conversion they want
        switch (type)
        {
            case "BY":
                 //convert to bytes (default)
                 return bytes;
                 break;
            case "KB":
                 //convert to kilobytes
                 return (bytes / CONVERSION_VALUE);
                 break;
            case "MB":
                 //convert to megabytes
                 return (bytes / CalculateSquare(CONVERSION_VALUE));
                 break;
            case "GB":
                 //convert to gigabytes
                 return (bytes / CalculateCube(CONVERSION_VALUE));
                 break;
            default:
                 //default
                 return bytes;
                 break;
          }
     }
     catch (Exception ex)
     {
         Console.WriteLine(ex.Message);
         return 0;
      }
}

/// <summary>
/// Function to calculate the square of the provided number
/// </summary>
/// <param name="number">Int32 -> Number to be squared</param>
/// <returns>Double -> THe provided number squared</returns>
/// <remarks></remarks>
public static double CalculateSquare(Int32 number)
{
     return Math.Pow(number, 2);
}

/// <summary>
/// Function to calculate the cube of the provided number
/// </summary>
/// <param name="number">Int32 -> Number to be cubed</param>
/// <returns>Double -> THe provided number cubed</returns>
/// <remarks></remarks>
public static double CalculateCube(Int32 number)
{
     return Math.Pow(number, 3);
}

//Sample Useage
String Size = "File is " + ConvertSize(250222,"MB") + " Megabytes in size" 
```

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2009-02-19T16:24:43.430

1024实际上是错误的。国际工程界 (IEC) 在 2000 年制定了一个标准，遗憾的是被计算机行业忽略了。这个标准基本上说

*   1000 字节是 1 千字节，1000KB 是 1 MB，依此类推。缩写有KB、MB、GB等。
*   广泛使用的 1024 字节 = 1 KB 应改为称为 1024 字节 = 1 千字节 (KiB)、1024 字节 = 1 兆字节 (MiB)、1024 字节 = 1 吉字节 (GiB) 等等。

大家可以在[IEC SI zone](http://www.iec.ch/zone/si/si_bytes.htm)上阅读。

因此，为了使您的转换根据国际标准化正确无误，您应该使用这种科学记数法。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-02-19T15:07:09.710

这取决于您是想要实际文件大小还是磁盘大小。实际文件大小是文件在内存中使用的实际字节数。磁盘大小是文件大小和磁盘/文件系统的块大小的函数。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-01-08T12:34:58.507

我隐约记得是使用 1000 还是 1024 的答案在于前缀的大小写。示例：如果使用“科学”1000 标度，则“科学”单位将为 kB（如 kg、kN 等）。如果使用以计算机为中心的 1024 缩放，则单位为 KB。因此，将科学前缀大写使其以计算机为中心。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-19T15:06:24.050

除以 1024。

# c# - 什么 winforms 控件以较小的 html 格式显示消息？

> ID：565731
> 
> 赞同：1
> 
> 时间：2009-02-19T15:09:04.650
> 
> 标签：c#, .net, html, winforms

是否有一个控件可以用来显示包含次要 html 格式（例如一个或多个链接）的短消息。我不想使用 WebBrowser 控件（[建议在这里](https://stackoverflow.com/questions/97598/is-there-a-control-for-a-net-winform-app-that-will-display-html)），因为它对我想要的东西有点重，所以欢迎任何其他建议。

如果用户确实单击了我的消息中的链接，我希望它在他们的默认浏览器中打开，而不是在我的应用程序中。

我确实使用了基础设施控制，所以其中一个就可以了，但我看不到任何可以做到这一点。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-19T15:15:10.410

[您可以在 CodeProject 上使用本文中](http://www.codeproject.com/KB/GDI-plus/HtmlRenderer.aspx "这篇关于 CodeProject 的文章")的控件，也可以将它们用作如何滚动您自己的示例。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-08-13T00:40:31.437

我已经为 .NET 实现了一个 HTML 控件，它可以执行您想要的操作：有关详细信息，请参见[http://www.modeltext.com/html](http://www.modeltext.com/html)。

该控件可以显示包含链接的 HTML，并且不使用浏览器。

用户单击链接时会发生什么取决于您：控件生成一个事件，该事件可由嵌入该控件的应用程序处理；因此，您的应用程序将实例化控件，用 HTML 填充它，安装事件处理程序，并在其事件处理程序被告知用户单击了链接时启动浏览器。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-19T15:56:31.803

如果您只需要链接功能，您可以使用 LinkLabel 控件。假设您已将 LinkLabel.Tag 属性设置为 url，以下代码将打开默认浏览器并打开指定的网页：

```
private void linkLabel1_LinkClicked(object sender, LinkLabelLinkClickedEventArgs e)
{
    Process.Start((string) ((sender as LinkLabel).Tag));
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-19T16:08:32.817

我认为在我的情况下最好的解决方案可能是使用 RichTextBox，它有一个属性 DetectLinks 和一个 LinkClicked 事件，告诉你点击了哪个链接。我会进一步研究这个...

# c# - 从一个数据库表复制到另一个 C#

> ID：565732
> 
> 赞同：9
> 
> 时间：2009-02-19T15:09:30.173
> 
> 标签：c#, sql-server, ado.net

使用 C# (vs2005) 我需要将表从一个数据库复制到另一个。两个数据库引擎都是 SQL Server 2005。对于远程数据库，源，我只有对存储过程的执行访问权限来获取我需要在本地带来的数据。

我可以更好地控制本地数据库，因为它由需要此远程表的本地副本的 [asp.net] 应用程序使用。我们希望它是本地的，以便于查找和与其他表连接等。

您能否向我解释一种将这些数据复制到我们本地数据库的有效方法。

可以使用与远程表相同的模式创建本地表，如果它使事情变得更简单的话。远程表有 9 列，其中没有一列是标识列。远程表中大约有 5400 行，并且这个数字以每年大约 200 的速度增长。所以不是一张快速更换的桌子。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-02-19T15:27:58.923

也许是 SqlBulkCopy；使用 SqlCommand.ExecuteReader 获取您在调用 SqlBulkCopy.WriteToServer 时使用的阅读器。这与批量插入相同，非常快。它应该看起来*像*（未经测试）；

```
using (SqlConnection connSource = new SqlConnection(csSource))
using (SqlCommand cmd = connSource.CreateCommand())
using (SqlBulkCopy bcp = new SqlBulkCopy(csDest))
{
    bcp.DestinationTableName = "SomeTable";
    cmd.CommandText = "myproc";
    cmd.CommandType = CommandType.StoredProcedure;
    connSource.Open();
    using(SqlDataReader reader = cmd.ExecuteReader())
    {
        bcp.WriteToServer(reader);
    }
} 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-02-19T15:29:15.273

ADO.NET 的批量复制功能可能会帮助您了解：

[MSDN - 多个大容量复制操作 (ADO.NET)](http://msdn.microsoft.com/en-us/library/s4s223c6.aspx)

[示例文章](http://www.c-sharpcorner.com/UploadFile/mahesh/BulckCopyAdoNet2008192005135138PM/BulckCopyAdoNet20.aspx)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-19T15:23:06.680

我首先会考虑使用 SQL Server 集成服务（SSIS，née Data Transfer Services (DTS)）。

它设计用于在数据库之间移动/比较/处理/转换数据，IIRC 允许对源进行任意表达。您需要将它安装在您的数据库上（应该不是问题，它是默认安装的一部分）。

否则代码解决方案，给定数据大小（小），将删除系统中的所有数据拉入内部结构，然后查找本地不存在的行进行插入。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-19T15:32:41.013

您可能无法做到这一点，但如果您做不到，请不要使用程序来做到这一点。如果您有任何方式与控制源服务器的人交谈，请查看他们是否会设置某种数据导出。如果数据像你说的那么小，那么 xml 或 csv 输出将比用 c#（或任何语言）编写内容好 100 倍。

所以让我们假设他们不能导出，仍然避免编写程序。你说你对目的地有更多的控制权。你能设置一个 SSIS 包，或者设置一个链接服务器吗？如果是这样，您将更容易迁移数据。

如果您至少将源设置为链接服务器，您可以编写一个小的 t-sql 批处理到

截断目标表

INSERT INTO DestTable SELECT SourceTable.Star FROM [SourceServer].[Schema].[Table]

不会像 SSIS 那样好（您对正在发生的事情有更多的了解，但上面的 t-sql 很清楚）。

由于我不会采用编程路线，因此如果您绝对必须这样做，我能给您的最佳解决方案是：

使用 SqlClient 命名空间。

因此，创建 2 个 SqlConnections、2 个 SqlCommands，并获取 1 个 SqlReader 的实例。

遍历源阅读器，并为每次迭代执行目标 SqlCommand 插入。

这会很丑，但它会起作用。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-19T16:02:16.920

您必须同步的数据量似乎并不大。在您描述的条件下（只有 SP 可以访问远程数据库而无法获得其他任何东西），您可以选择 Marc Gravell 的解决方案。在数据只能增长而现有数据无法更改的情况下，您可以比较远程和内部数据库的记录数，以优化操作；如果远程数据库没有变化，则无需复制。

# .net - 捕获 VPN 使用统计信息

> ID：565734
> 
> 赞同：3
> 
> 时间：2009-02-19T15:09:38.237
> 
> 标签：.net, windows, networking, vpn, cisco

我们正在使用 .NET 2.0 中的 NetworkInterface.GetIPv4Statistics() 监视网络接口的使用统计信息。这没有报告正在通过隧道传输 VPN 流量的连接的正确统计信息。相反 - 在 Cisco VPN 客户端的情况下 - 使用只是归因于一个看起来像以太网连接的新网络接口。

Windows 本身（至少是 Vista）正确地将 VPN 统计信息添加到实际物理接口，因此查看原始连接的“状态”对话框会显示正确的字节数。但是，.NET 中的调用结果不会将流量合并在一起。

有没有办法将 VPN 连接关联回通过其隧道传输的网络连接？如果做不到这一点，有谁知道状态对话框正在使用哪个 API 来检索正确的统计信息？

目前，我们不得不手动检测看起来像是 VPN 的连接，并将它们的使用添加到任何其他处于活动状态的连接中，这似乎不是一个可靠的解决方案。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-01T04:01:11.510

[这是一个用 Delphi 编写的程序](http://delphi.about.com/od/fullcodeprojects/l/aa112903a.htm)（带有完整的源代码和解释），它将帮助您收集网络信息，包括 VPN 数据。这是使用[开源 Indy 组件](http://www.indyproject.org/Sockets/index.EN.aspx)，它也可用于 C#。

我建议浏览源代码，您会发现它所做的确切 Windows API 调用。它严重依赖 IP Helper API ( [IPHlpApi](http://msdn.microsoft.com/en-us/library/aa366073(VS.85).aspx) )。

如果您正在寻找仅 C# 的示例，我建议您为“C# and IpHlpApi”做一些谷歌搜索。

问候

[替代文字 http://z.about.com/d/delphi/1/0/k/2/112903_2.gif](http://z.about.com/d/delphi/1/0/k/2/112903_2.gif)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-24T02:44:58.347

当我开始工作时，我必须检查一下我的配置是什么样的。

Cisco VPN 所做的一件事是（如果已配置）禁用拆分隧道。这意味着您无法访问连接到 VPN 的连接上的本地子网。

我可以看到的方式是，我的以太网连接配置了 IP 地址，但没有默认网关。

假设您确定了 VPN 连接，则该无网关连接将是您的另一个连接。

另外，您是否查看过任何 WMI 类。Cisco VPN 可能会与 WMI 类交互。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-20T16:51:53.307

正如 Rob 所建议的，答案在于 WMI。[`Win32_PerfFormattedData_RemoteAccess_RasPort`](http://msdn.microsoft.com/en-us/library/aa394283(VS.85).aspx)似乎正是 Windows 自己使用的 - 数字是相同的，字节对字节，无论 VPN 是否启动。

我测试过：

```
static class Program
{
    static void Main()
    {
        var query = new WqlEventQuery("__InstanceModificationEvent", TimeSpan.FromSeconds(1),
                                      "TargetInstance ISA 'Win32_PerfFormattedData_RemoteAccess_RasPort' AND TargetInstance.BytesReceived > 0");

        var watcher = new ManagementEventWatcher(query);
        watcher.EventArrived += EventArrived;
        watcher.Start();

        Console.ReadLine();
    }

    static void EventArrived(object sender, EventArrivedEventArgs e)
    {
        var mo = e.NewEvent["TargetInstance"] as ManagementBaseObject;
        Console.WriteLine("{0:#,0}: {1:#,0} bytes sent, {2:#,0} bytes received", mo["Name"], mo["BytesTransmitted"], mo["BytesReceived"]);
    }
} 
```

# java - Java Applet - 图像导出性能问题

> ID：565742
> 
> 赞同：2
> 
> 时间：2009-02-19T15:10:58.547
> 
> 标签：java, image-processing, applet

我有一个 Java Applet，我正在对其进行一些编辑并且遇到了性能问题。更具体地说，小程序生成一个我需要导出到客户端机器的图像。

这真的是在概念验证阶段，所以请耐心等待。目前，图像被导出到客户端机器的预定义位置（这将在未来被保存对话框或其他东西替换）。但是，对于一个 32kb 的文件，该过程需要将近 15 秒。

我已经完成了一些 'shoot-by-the-hip' 分析，在整个相关方法中以逻辑间隔将消息打印到控制台。令我惊讶的是，我发现瓶颈似乎与实际的数据流写入过程有关，而不是 jpeg 编码。

**请记住，我只有 Java 及其方法的基本知识**

所以慢慢来：p - 我主要是在寻找解决问题的建议，而不是解决方案本身。

这是发生魔法的代码块：

```
ByteArrayOutputStream jpegOutput = new ByteArrayOutputStream();
JPEGImageEncoder encoder = JPEGCodec.createJPEGEncoder(jpegOutput);
encoder.encode(biFullView);
byte[] imageData = jpegOutput.toByteArray();

String myFile="C:" + File.separator + "tmpfile.jpg";
File f = new File(myFile);

try {
dos = new DataOutputStream(new BufferedOutputStream(new FileOutputStream(myFile),512));
dos.writeBytes(byteToString(imageData));
dos.flush();
dos.close();
}
catch (SecurityException ee) {
    System.out.println("writeFile: caught security exception");
}
catch (IOException ioe) {
    System.out.println("writeFile: caught i/o exception");
} 
```

就像我提到的，使用 system.out.println() 我已经将性能瓶颈缩小到 DataOutputStream 块。使用具有不同硬件统计数据的各种机器似乎对整体性能影响不大。

任何指针/建议/方向将不胜感激。

编辑：根据要求，byteToString()：

```
public String byteToString(byte[] data){
  String text = new String();
  for ( int i = 0; i < data.length; i++ ){
    text += (char) ( data[i] & 0x00FF );
  }
  return text;
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-19T15:26:25.160

你可能想看看[`ImageIO`](http://java.sun.com/javase/6/docs/api/javax/imageio/ImageIO.html)。

而且我认为性能问题的原因是循环输入`byteToString`. 您*永远*不想在循环中进行连接。您可以改用`String(byte[])`构造函数，但您实际上并不需要将字节转换为字符串。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-19T15:27:10.600

如果您不需要图像数据字节数组，您可以直接编码到文件中：

```
String myFile="C:" + File.separator + "tmpfile.jpg";
File f = new File(myFile);
FileOutputStream fos = null;
try {
    fos = new FileOutputStream(f);
    JPEGImageEncoder encoder = JPEGCodec.createJPEGEncoder(
                             new BufferedOutputStream(fos));
    encoder.encode(biFullView);
}
catch (SecurityException ee) {
    System.out.println("writeFile: caught security exception");
}
catch (IOException ioe) {
    System.out.println("writeFile: caught i/o exception");
}finally{
    if(fos != null) fos.close();
} 
```

如果您需要字节数组来执行其他操作，最好将其直接写入 FileOutputStream：

```
//...
fos = new FileOutputStream(myFile));
fos.write(imageData, 0, imageData.length);
//... 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-09T11:22:35.577

您还可以使用标准[ImageIO](http://java.sun.com/javase/6/docs/technotes/guides/imageio/index.html) API（com.sun.image.codec.jpeg 包中的类不是核心 Java API 的一部分）。

```
String myFile="C:" + File.separator + "tmpfile.jpg";
File f = new File(myFile);
ImageIO.write(biFullView, "jpeg", f); 
```

# c# - 用于类型推断的通用标识函数

> ID：565755
> 
> 赞同：11
> 
> 时间：2009-02-19T15:13:48.180
> 
> 标签：c#, generics, identity, functional-programming, type-inference

我想知道这是否可能，因为我 5 分钟的实验证明是徒劳的。

我希望它会像这样简单：

```
T Identity<T>(T t) { return t; } 
```

但这无法在采用 Func 参数的泛型方法上编译。例如 OrderBy。即使指定类型参数（这正是我想要避免的！），它也无法编译。

接下来我尝试了一些我认为可行的方法：

```
Func<T, R> MakeIdentity<T, R>()
{
  return (T t) => (R)(object)t;
} 
```

也不行:(（这在应用类型参数时编译，再次，不是我想要的）

有没有人有幸做出这样的事情？

更新：请不要说：x => x，我知道，这很明显！我要的是一个函数，而不是一个表达式:)

更新2：当我提到身份时，我的意思是在功能意义上，函数只是返回您传递给它的相同对象。它可能在我遇到的每一种功能语言中都有，但那些不使用静态类型。我想知道如何使用泛型来做到这一点（如果可能的话）。只是为了好玩！

更新3：这是基于第二个想法的部分“解决方案”：

```
Expression<Func<T, T>> MakeIdentity<T>()
{
  return t => t;
}

void Foo(string[] args)
{
  var qargs = args.AsQueryable();
  var q = qargs.OrderBy(MakeIdentity<string>());
  ...
} 
```

我认为除此之外没有任何可能。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-19T15:53:56.293

类型推断将不起作用，因为主机方法和输入法都是通用的。为此，您必须编写

```
myList.OrderBy<int, int>(Identity); 
```

或者

```
myList.OrderBy((Func<int, int>)Identity); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2015-12-01T19:21:09.483

这适用于我到目前为止需要它的地方。

```
internal class IdentityFunction<TSource>
{
    public static Func<TSource, TSource> Instance
    {
        get { return x => x; }
    }
}

OrderBy(IdentityFunction<Foo>.Instance) 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-19T15:19:48.137

您遇到的问题是 C# 中的匿名函数和方法组不参与类型推断。必须给出显式类型。

您可以做的是为匿名函数提供身份函数。例子

```
Func<T> IdentityFunc1<T>(Func<T> func) { return func; } 
```

我不完全确定您对第二个样本的了解。你能详细说明吗？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-11-23T07:53:32.683

第一个选项对我有用：

```
public class Foo {

   public Foo(Func<MyObj, MyObj> map) {... }

}

public class Client {

   private static T Identity<T>(T t) { return t; }

   public void main() {
      var foo = new Foo(Identity);

      var c = from f in Enumerable.Range(0, 100) select Identity(f);
      c.ToList().ForEach(System.Console.Out.WriteLine);
   }
} 
```

# mod-rewrite - mod_rewrite 将以字符串开头的 URL 重定向到 google

> ID：565764
> 
> 赞同：0
> 
> 时间：2009-02-19T15:14:54.200
> 
> 标签：mod-rewrite, apache2

我试图建立一个简单的重写规则，但我似乎无法让它工作。基本上我想将任何以“餐厅”开头的地址路由到某个地方，并将所有其他地址路由到我的引导程序。

RewriteRule ^/restaurants [http://www.google.com](http://www.google.com) RewriteRule !^/restaurants index.php

是我到目前为止所拥有的。IE。

*   mysite.com/restaurants
*   mysite.com/restaurants/blabla
*   mysite.com/restaurants/beep/boop

都会去谷歌，所有其他请求都会去 index.php

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-19T15:18:02.247

如果要在 .htaccess 文件中使用规则，则必须删除`/`模式中的前导：

```
RewriteRule ^restaurants http://example.com/
RewriteRule !^index\.php$ index.php 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-19T16:13:54.270

这是一组应该起作用的规则

```
RewriteRule ^/resturants.*   http://www.google.com/ [L] 
RewriteRule !^/index\.php$   index.php 
```

您需要指定谷歌重定向是最后一个（L），否则它将被第二条规则覆盖。

# c++ - 使用继承时实现 operator==

> ID：565765
> 
> 赞同：12
> 
> 时间：2009-02-19T15:15:05.823
> 
> 标签：c++

我有一个实现 == 运算符的基类。我想编写另一个类，继承基类，并且应该重新实现 == 运算符。

这是一些示例代码：

```
#include <iostream>
#include <string>

class Person
{
public:
  Person(std::string Name) { m_Name = Name; };

  bool operator==(const Person& rPerson)
  {
    return m_Name == rPerson.m_Name;
  }

private:
  std::string m_Name;
};

class Employee : public Person
{
public:
  Employee(std::string Name, int Id) : Person(Name) { m_Id = Id; };

  bool operator==(const Employee& rEmployee)
  {

    return (Person::operator==(rEmployee)) && (m_Id == rEmployee.m_Id);
  }

private:
  int m_Id;
};

void main()
{
  Employee* pEmployee1 = new Employee("Foo" , 1);
  Employee* pEmployee2 = new Employee("Foo" , 2);

  if (*pEmployee1 == *pEmployee2)
  {
    std::cout << "same employee\n";
  }
  else
  {
    std::cout << "different employee\n";
  }

  Person* pPerson1 = pEmployee1;
  Person* pPerson2 = pEmployee2;

  if (*pPerson1 == *pPerson2)
  {
    std::cout << "same person\n";
  }
  else
  {
    std::cout << "different person\n";
  }
} 
```

此示例代码给出以下结果：

```
different employee
same person 
```

即使在处理 Person* 指针时，我也希望确保它们不同。

我该如何解决这个问题？

谢谢 ！

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-02-19T18:04:56.493

您想要做的是本质上“虚拟化”比较运算符。

~~由于运算符不能是虚拟的~~（操作员可以是`virtual`），您需要将其委托给其他人。这是一种可能的解决方案。

```
class Person
{
   public:
      /* ... */
      bool operator==(const Person& rhs)
      {
         return m_Name == rPerson.m_Name && this->doCompare(rhs);
      }
   private:
      virtual bool doCompare() = 0;
   };
}
class Employee : public Person
{
   /* ... */
   private:
      virtual bool doCompare(const Person& rhs)
      {
         bool bRetval = false;
         const Employee* pRHSEmployee = dynamic_cast<const Employee*>(&rhs);
         if (pEmployee)
         {
            bRetval = m_Id == pRHSEmployee->m_Id
         }
         return bRetval;
      }
}; 
```

这个问题没有说明 Person 是否需要是一个具体的类。如果是这样，您可以使其不是纯虚拟的，并实现它以返回 true。

这也使用 RTTI，您可能会也可能不满意。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-19T15:18:41.180

添加一个虚函数 int Compare(const Person& rPerson) 并在您的运算符中使用它

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-02-19T15:21:47.707

如果你有一个人和一个员工，你仍然会遇到一个主要问题——这个人可能与员工相等，但员工与人之间的比较却不同。IE：

```
(employee == person) != (person == employee) 
```

这是一件坏事（tm）。[基本上你已经制作了一个不对称](http://c2.com/cgi/wiki?EqualityOperator)的等式运算符

编辑：

好的，没有虚拟运算符-我认为在其他地方建议添加虚拟比较功能-但您仍然遇到对称问题。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-02-19T15:18:41.693

这个问题没有巧妙的解决方案。

在 C++ 中，这实际上不是问题。在平等的基础上比较实体有什么意义？

编辑：一些链接来思考适用于实体的平等的相关性：

*   价值[对象](http://www.two-sdg.demon.co.uk/curbralan/papers/ObjectsOfValue.pdf)
*   [平等的秘密](http://www.angelikalanger.com/Articles/JavaSolutions/SecretsOfEquals/Equals.html)，Angelika Langer，检查“实体与价值”部分

EDIT2（2018 年 11 月 27 日）：

这里还有另一个问题，这个问题也源于 OO 设计，而不是 C++。`x == x`设计一个自反（ ）、对称（`x == y <=> y == x`）、传递（ ）的比较算子是不可能的`x == y && y == z => x == z`，同时也符合里[氏代换原则](https://en.wikipedia.org/wiki/Liskov_substitution_principle)。*Joshua Bloch 的Effective Java*第 2 版中对这种限制进行了彻底的演示。

TL;DR：假设我们有`ColouredPoint`一个继承自s`Point`的函数，该函数对 s 的引用起作用，`Point`并且需要比较它们。如果*{1,2} == {1,2,blue}*，我们将得到*{1,2,blue} == {1,2,green}*。或者我们拒绝将点与彩色点进行比较，这会破坏 LSP。等等。没有解决办法。我的结论是继承比较，虽然它很吸引人，但它不起作用。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-19T15:52:47.220

这里最大的问题是——你如何确定平等？

任何对象都可以与层次结构中的任何其他对象进行比较吗？只能比较相同类型的对象吗？比较的标准在哪里？

解决方案的实施将取决于这些问题的答案。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-19T16:02:29.790

让同一个人等于两个不同的员工是没有意义的，但这是你的类设计所允许的。你最好安排一个人的身份。然后你问是否 a.identity() == b.identity()。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-19T16:05:28.847

为了使`operator==`对称，您必须让具有相同共享详细信息的人和员工有所不同，以便：

```
Person p("Foo");
Employee e("Foo" , 1);
p == e; // false
e == p; // false 
```

这是不直观但必要的。

为此，您可以使用[`typeid`关键字](http://en.wikipedia.org/wiki/Typeid)

```
bool operator==(const Person& other) const
{
     return m_Name == other.m_Name && typeid(other) == typeid(*this);
} 
```

当然`Person`必须是多态类型（至少有一个虚函数）。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-19T15:17:17.033

您需要将 Person::operator== 设为虚拟。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-19T15:22:29.027

您还可以将 operator== 放在类范围之外。在这种情况下，您可以创建必要的重载或通过模板使其通用。

# c# - 在调用应用程序中覆盖 .Net 资源文件

> ID：565768
> 
> 赞同：1
> 
> 时间：2009-02-19T15:15:11.377
> 
> 标签：c#, asp.net, localization

我有一个调用类库的 asp.net 2.0 Web 应用程序。可以肯定的是，这是一个相当普遍的情况。

类库使用大量资源文件和 ResourceManager 对象来设置本地化字符串。根据用户的浏览器设置，这在大多数情况下都可以正常工作。

但是，在某些情况下，我希望从 Web 应用程序中覆盖类库中的资源字符串。

这可能吗？如果是这样怎么办？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-20T06:09:27.607

据我所知，没有什么“开箱即用”可以让你这样做。

另一方面，您始终可以将您可能希望在类库中覆盖的那些字符串公开为公共属性，并在您的类库中将它们初始化为资源中的默认字符串，但由于它们是公共属性，调用 web app 总是可以覆盖它们并设置新值。

马克

# sharepoint - SharePoint - 查找 WSP 模板的站点模板值？

> ID：565771
> 
> 赞同：1
> 
> 时间：2009-02-19T15:16:08.083
> 
> 标签：sharepoint, stsadm

我正在尝试为 fab 40 Microsoft SharePoint 模板创建网站的脚本。我无法找到用于创建站点的 stsadm 命令的 sitetemplate 参数的值。

例如：

```
stsadm -o createsite -url http://Test/sites/Team_Site **-sitetemplate STS#0** -title "Team Site" ... 
```

是否有我可以运行的命令，或者我可以在某个地方查找 WSP 包的站点模板值（例如 BugDatabase.wsp）？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-19T19:55:09.163

我认为最简单的方法是通过 PowerShell，但您可以编写代码来做同样的事情。关键是获得对网络的引用，然后调用`SPWeb.GetAvailableWebTemplates(lcid)`.

下面是几行 PowerShell 脚本/命令，用于在屏幕上显示 Name 和 Title 属性：

```
[System.Reflection.Assembly]::LoadWithPartialName("Microsoft.SharePoint")  
$theSiteColl = New-Object Microsoft.SharePoint.SPSite("http://server")  
$theWeb = $theSiteColl.OpenWeb()  
$theWeb.GetAvailableWebTemplates(1033) | select name, title  
#put your locale ID in the function call 
```

该`Name`列是您必须传递给`stsadm -o createsite`命令的列，该`Title`列有助于将其与有意义的内容相关联。在我的测试框中，BugDatabase 应用程序模板是`BT#0`.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-31T18:34:36.837

WSP 只是一个可以包含多个模板的 CAB 文件。我认为您需要手动执行此操作。为此，将 WSP 重命名为具有 cab 扩展名，从 WSP 中提取 manifest.xml 和 webtemp* 文件，然后查看那里。站点定义的程序名称只是站点定义的名称，后跟 #，然后是配置 ID。例如，要使用 STS 模板的配置 0 创建站点，您将使用 STS#0。

# sql - 如何在sql中更改数据库的所有者？

> ID：565780
> 
> 赞同：36
> 
> 时间：2009-02-19T15:17:40.950
> 
> 标签：sql, sql-server

在管理工作室中，您可以在属性下看到所有者，但它不会让您更改它。我的猜测是有一些存储过程可以改变它，你不能通过 gui 来改变它。

* * *

## 回答 #1

> 赞同：46
> 
> 时间：2009-02-19T15:20:12.447

令人惊讶的是，它被称为[`sp_changedbowner`](http://msdn.microsoft.com/library/ms178630.aspx).

你实际上可以在`SQL Server Management Studio`下面改变它`Database / Properties / Files`

* * *

## 回答 #2

> 赞同：32
> 
> 时间：2014-05-03T03:34:20.520

除了使用`SSMS`GUI，还可以使用`ALTER AUTHORIZATION`或交替使用`sp_changedbowner`语句。

```
ALTER AUTHORIZATION ON DATABASE::MyDatabaseName TO NewOwner;
GO 
```

请注意`sp_changedbowner`已弃用`SQL Server 2012`。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2009-02-19T15:24:23.763

实际上，您可以在 SSMS 中更改它，它位于数据库属性的“文件”选项卡中。

# asp.net - 需要帮助数据绑定 ListItems 的 ArrayList

> ID：565782
> 
> 赞同：1
> 
> 时间：2009-02-19T15:18:03.730
> 
> 标签：asp.net, data-binding, .net-1.1

我正在使用以下数组列表对下拉列表进行数据绑定：

```
ArrayList al = new ArrayList();
al.Add(new ListItem("Service Types", 1));
al.Add(new ListItem("Expense Types", 2));
al.Add(new ListItem("Payment Terms", 3));
al.Add(new ListItem("Classes", 4));
al.Add(new ListItem("Project", 5));
al.Add(new ListItem("Employees", 6));
al.Add(new ListItem("Payroll Codes", 7));

ddlType.DataSource = al;
ddlType.DataBind(); 
```

这会产生以下 HTML：

```
<select name="ddlType">
    <option value="Service Types">Service Types</option>
    <option value="Expense Types">Expense Types</option>
    <option value="Payment Terms">Payment Terms</option>
    <option value="Classes">Classes</option>
    <option value="Project">Project</option>
    <option value="Employees">Employees</option>
    <option value="Payroll Codes">Payroll Codes</option>
</select> 
```

如何在我的下拉列表中设置 DataTextField 和 DataValueField 属性，以便列表项的值是下拉列表中的值？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-07-11T19:16:46.017

Why bother with databinding at all. You can populate the items collection directly:

```
ddlType.Items.Add(new ListItem("Service Types", 1));
...
ddlType.Items.Add(new ListItem("Payroll Codes", 7)); 
```

and it will even make your code 3 lines shorter ;-)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-07-11T19:03:17.027

Have you tried creating a ListItemCollection and binding to that?

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-19T15:24:07.597

你为什么不创建一个而不是一个而不是一个`ArrayList`包含？`ListItems``Hashtable`

```
Hashtable hash = new Hashtable();
hash.Add("one", "1")
hash.Add("two", "2")

dd.DataSource = ht
dd.DataTextField = "value"
dd.DataValueField = "key"
dd.DataBind() 
```

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-02-19T15:21:35.193

```
ddlType.DataTextField = "Text";
ddlType.DataValueField = "Value"; 
```

# oracle - 以错误的方式插入 Oracle - 如何处理？

> ID：565792
> 
> 赞同：0
> 
> 时间：2009-02-19T15:19:31.877
> 
> 标签：oracle, insert, primary-key, legacy-code

我刚刚找到以下代码：

```
select max(id) from TABLE_NAME ...

... do some stuff ...

insert into TABLE_NAME (id, ... )
VALUES (max(id) + 1, ...) 
```

我可以为 PK 创建一个序列，但有一堆现有代码（经典 asp、不属于该项目的现有 asp.net 应用程序）不会使用它。

我应该忽略它，还是有办法在不进入现有代码的情况下修复它？

我认为最好的选择就是这样做：

```
insert into TABLE_NAME (id, ... )
VALUES (select max(id) + 1, ...) 
```

选项？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-19T15:28:05.993

您可以在表上创建一个触发器，用您从序列中获取的值覆盖 ID 的值。这样，您仍然可以使用其他现有代码并且并发插入没有问题。

如果您无法更改其他软件并且他们仍然执行最不幸的选择 max(id)+1 插入。然后你可以做的是：

对于您自己的插入，请使用序列并使用 -1*（序列值）填充 ID 字段。这样插入既不会干扰现有程序，也不会与现有程序冲突。（在没有 id 值的情况下进行插入，并使用触发器用序列的负值填充 ID）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-19T22:40:50.260

这很快就变成了对应用程序架构的讨论，尤其是当问题归结为“我应该做什么？”时。

Oracle 中的主键确实需要来自序列，并且由于您在应用程序代码中处理复杂的插入逻辑（至少是父/子插入），因此您应该进入现有代码，正如您所说（因为触发器可能获胜帮不了你）。

在一种极端情况下，您可以从应用程序中移除直接 SQL 访问，并让它们调用服务，以便可以集中插入/更新/删除代码。或者你可以使用某种 MVC 架构重写你的代码。我假设两者都对你的情况来说太过分了。

id 列是否至少设置为真正的主键，所以有一个约束可以防止重复发生？如果没有，从那里开始。

一旦主键到位，或者如果它已经到位，插入开始失败只是时间问题；你会知道他们什么时候开始失败，对吧？如果没有，请继续错误记录。

现在修复应用程序代码。当你在那里时，你至少应该编写和调用帮助代码，这样你的数据库交互就在尽可能少的地方。然后为其他开发人员提供一些领导，并确保他们也使用帮助代码。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-19T15:47:34.363

正如其他人所说，您可以使用序列覆盖数据库触发器中的最大值。但是，如果任何应用程序代码像这样使用该值，则可能会导致问题：

```
select max(id) from TABLE_NAME ...

... do some stuff ...

insert into TABLE_NAME (id, ... )
VALUES (max(id) + 1, ...)

insert into CHILD_TABLE (parent_id, ...)
VALUES (max(id) + 1, ...) 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-19T19:16:20.973

在插入行前触发器中使用序列。select max(id) + 1 在多中心环境中不起作用。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-02-18T09:12:57.733

可以通过获取变量中的最大值然后将其插入表中来完成

声明 v_max int; 从表中选择 max(id) 到 v_max 中；

插入表值((v_max+rownum),val1,val2....,valn); 犯罪;

这将在单个插入和批量插入中创建一个序列。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-19T15:32:25.877

大问题：有人依赖PK的价值吗？如果不是，我建议使用触发器，从序列中获取 id 并设置它。插入根本不会指定和标识。

我不确定，但

> 插入 TABLE_NAME (id, ... ) VALUES (select max(id) + 1, ...)

当会话到达该代码时可能会导致问题。可能是 oracle 读取表（计算 max(id)），然后尝试获取 PK 上的锁定以进行插入。如果是这种情况，两个并发会话可能会尝试使用相同的 id，从而导致第二个会话出现异常。

您可以向触发器添加一些日志记录，以检查是否已处理已设置 ID 的插入。所以你知道你仍然需要寻找一些使用旧代码的地方。

# delphi - SetRoundMode(rmUp) 和像 10 这样的舍入“round”值，结果是 10,0001 怎么来的？

> ID：565797
> 
> 赞同：3
> 
> 时间：2009-02-19T15:20:33.387
> 
> 标签：delphi

这段代码：

```
 SetRoundMode(rmUp);
 Memo1.Lines.Add(CurrToStr(SimpleRoundTo(10))); 
```

结果为 10,0001。

我只是不明白。

我认为**rmUp**会做类似的事情，从 10,0001 到 11，但从不从 10 到 10,0001。

谁能解释为什么会这样？

谢谢。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-02-19T15:38:39.643

`SimpleRoundTo`像这样工作：

1.  将输入值除以 10 ^(*-x*)，其中*x*是要保留在结果中的小数位数。
2.  将该产品加 0.5。
3.  截断总和。
4.  乘以 10 ^(*-x*)。

结果是一个浮点值。与大多数浮点值一样，结果不会是精确的，即使在您的情况下，您从一个精确值开始。指定的小数位数为`SimpleRoundTo`负数，因此步骤 1 中的除数（对于您的示例输入）理想情况下为 0.01。但这不能精确地表示为浮点数，因此当在步骤 1 中计算 10 / 0.01 时，结果并不完全是 1000。但是，在步骤 3 中的结果将恰好是 1000，所以分工不重要。但是，第 4 步中的乘法不精确。该产品将不准确。会略高于10。

所以`SimpleRoundTo`返回一个稍高的值，并且由于您已指定舍入应该*上升*，因此将结果转换为`Extended`结果`SimpleRoundTo`的`Currency`输入`CurrToStr`正好为 10.0001。

`Currency`值是准确的；它们代表一个定点值，一个小数点后四位的整数。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-19T16:47:36.977

如果银行家的四舍五入没问题，我会使用 Round() 函数。它返回一个整数。

如果你不喜欢银行家的四舍五入，你可以使用这个：

```
// use this to not get "banker's rounding"
function HumanRound(X: Extended): integer;
// Rounds a number "normally": if the fractional
// part is >= 0.5 the number is rounded up (see RoundUp)
// Otherwise, if the fractional part is < 0.5, the
// number is rounded down
//   RoundN(3.5) = 4     RoundN(-3.5) = -4
//   RoundN(3.1) = 3     RoundN(-3.1) = -3
begin
  // Trunc() does nothing except conv to integer.  needed because return type of Int() is Extended
  Result := Trunc(Int(X) + Int(Frac(X) * 2));
end; 
```

我在这里的帖子有点离题，但仍然提供了丰富的信息。

我仔细研究了这一点，因为我不需要使用银行家的四舍五入。这是我的发现。据我所知，这仍然没有摆脱银行家的四舍五入

```
Value       Meaning
rmNearest       Rounds to the closest value.
rmDown      Rounds toward negative infinity.
rmUp        Rounds toward positive infinity.
rmTruncate      Truncates the value, rounding positive numbers down and negative numbers up.

rmNearest   // default
0.500   0
1.500   2
2.450   2
2.500   2
2.550   3
3.450   3
3.500   4
3.550   4

rmDown
0.500   0
1.500   1
2.450   2
2.500   2
2.550   2
3.450   3
3.500   3
3.550   3

rmUp
0.500   1
1.500   2
2.450   3
2.500   3
2.550   3
3.450   4
3.500   4
3.550   4

rmTrunc
0.500   0
1.500   1
2.450   2
2.500   2
2.550   2
3.450   3
3.500   3
3.550   3

uses
  math, sysutils, clipbrd;
var
  s:string;

procedure trythis(sMode:string);

  procedure tryone(d:double);
  begin
    s:=s+Format('%1.3f   %d%s',[d,Round(d),#13+#10]);
  end;

begin
  s:=s+#13#10+sMode+#13#10;

  tryone(0.50);
  tryone(1.50);
  tryone(2.45);
  tryone(2.50);
  tryone(2.55);
  tryone(3.45);
  tryone(3.50);
  tryone(3.55);
end;

begin
  s:=inttostr(integer(GetRoundMode));
  SetRoundMode(rmNearest);
  trythis('nearest');
  SetRoundMode(rmDown);
  trythis('down');
  SetRoundMode(rmUp);
  trythis('up');
  SetRoundMode(rmTruncate);
  trythis('trunc');
  clipboard.astext:=s;
end. 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-19T15:44:09.273

计算 SimpleToRound 的返回值也是一个 Double 并且在舍入时永远不能信任它们。在转换之前截断值应该可以完成工作！

Memo1.Lines.Add(CurrToStr(Trunc(SimpleRoundTo(10))));

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-19T21:13:34.893

Ceil() : Integer 函数应该为您提供值 > 0 的答案。如果 < 0，您可能需要使用 floor() 代替，具体取决于所需的行为。

# asp.net - 阻止 app_offline.htm 在每次构建时创建和删除？

> ID：565798
> 
> 赞同：8
> 
> 时间：2009-02-19T15:20:35.837
> 
> 标签：asp.net, visual-studio-2008, app-offline.htm

我在 Visual Studio 2008 SP1、.NET Framework 3.5 SP1 中有一个包含 2 个项目的解决方案。

*   一个 ASP 网站。
*   类库 (dll) 项目。

我有从网站到类库的引用，因为类库是我的数据层。但无论如何，只有这种基本设置、具有这两种类型项目的解决方案以及从网站到类库的引用才会发生这种情况。

现在，每次我修改类库中的某些内容并构建它时，Visual Studio 都会创建一个名为 app_offline.htm 的文件，然后将其删除（它将它发送到回收站）。

这真的很烦人，因为最终我得到了一个完整的回收站和我，作为完美主义者，我想保持它的清洁。我不是唯一一个遇到这个问题的人：[这里](http://morewally.com/cs/blogs/wallym/archive/2007/10/11/visual-studio-2008-thursday-october-11-2007.aspx)和[这里](http://forums.asp.net/t/1230063.aspx)。

我现在知道问题的原因，但仍然不知道如何解决它。如果您之前没有听说过 app_offline.htm，这里是[ScottGu 关于 app_offline 的文章](http://weblogs.asp.net/scottgu/archive/2005/10/06/426755.aspx)：

有谁知道问题的解决方案？VS中的某些设置在构建过程后永久删除文件？（我真的不想让我的回收站这样做，因为我不时会无意中删除一些东西，我希望能够恢复这些东西。）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-19T15:22:47.830

该文件不会进入我的回收站。也许您安装了一些严格的实用程序，它们会这样做吗？早在 2000 年，许多防病毒工具和通用系统实用程序套件就可以执行此操作，但我没有使用更高版本的经验。

更新：您可以使用[进程监视器](http://technet.microsoft.com/en-us/sysinternals/bb896645.aspx)找出哪个进程将此文件移动到回收站。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-20T09:45:48.417

[免责声明：我添加答案首先是因为我希望它能让更多人看到这个问题（我承认），其次是因为我对答案没有字符限制，反对评论。]

我听从了 Sander 的建议，并使用 Process Monitor 来跟踪哪个进程将此文件移动到回收站。

它确实是 devenv.exe。

它在几个事件中进行操作，例如：QueryDirectory、QueryOpen、CreateFile 和 CloseFile。而 devenv.exe 是唯一与 app_offline.htm 有任何关系的进程

仍然......我怎样才能让 Visual Studio 停止归档我的回收站？（走的路，丹，在“答案”中提出一个问题（：）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-24T04:34:31.563

在我们遇到 VSTS 服务器问题后不久，我开始看到同样的问题。VSTS 服务器宕机了一天，所以我不得不在离线模式下打开解决方案。在 VSTS 服务器重新上线后，我不得不在源代码控制下重新打开解决方案，并且 app_offline.htm 文件开始在我每次重新编译我的 Web 项目时不停地出现。

这真的很烦人！

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-07-16T20:27:26.783

我不确定如何阻止它，但我知道如何在我的环境中可靠地重现问题：

Windows XP Pro、VS2008、SourceGear（源代码控制系统）。

每当我执行结帐时，都会立即在根文件夹中/从根文件夹中创建和删除 app_offline.htm 文件。源代码控制系统使用的是 SQL Enterprise，所以我不确定它是否与人们发表的关于 SQL Express 的帖子中的一些参考有关。

同样，仍然不知道如何停止它，但也许这将有助于其他人弄清楚文件是如何/何时生成和删除的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-24T04:47:36.587

使用 Web 应用程序项目，而不是网站模板，它们是为“傻瓜”准备的。:)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2014-09-26T07:33:52.297

我遇到了这个问题，因为我从开发机器直接发布到 Azure Web 服务。

[此处](https://stackoverflow.com/questions/3965346/app-offline-htm-created-deleted-whenever-i-check-out-a-file-in-tfs)的答案与[此处](https://stackoverflow.com/a/2148380/1042934)的另一种可能的解决方法。

* * *

## 回答 #7

> 赞同：-2
> 
> 时间：2010-01-06T21:21:42.660

这就是我能找到的关于这个主题的全部内容。不幸的是，这也是猜测。

[http://petermcg.wordpress.com/2008/05/12/silverlight-app-offline/](http://petermcg.wordpress.com/2008/05/12/silverlight-app-offline/)

# c++ - Windows 中 SO_RCVBUF 的最大值？

> ID：565804
> 
> 赞同：7
> 
> 时间：2009-02-19T15:21:36.380
> 
> 标签：c++, c, windows, networking, sockets

快速提问，想知道是否有人知道 Windows 下 SO_RCVBUF 的限制。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-13T13:14:43.907

winsock 中的 SO_RCVBUF 不受 TCP 窗口大小的限制。至少对于Vista 之前的堆栈。它将受到非分页池可用性的限制，这是一个完全不同的主题。所以如果你愿意，你可以把它做得很大。

强制性不请自来的建议：如果您因为不经常接收而使用大缓冲区，我会研究带有事件/选择/完成端口的异步 I/O。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-21T18:57:19.893

我无法确定，但我相信 Windows 支持`fpathconf()`带有`_PC_SOCK_MAXBUF`选项的 POSIX 功能。如果是这样，这正是您正在寻找的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-20T21:14:46.903

根据[这篇文章](http://blogs.msdn.com/wndp/archive/2006/05/05/Winhec-blog-tcpip-2.aspx)，看起来最大值是 64K。

# 64-bit - 如何知道 Octave 是否可以完全访问 64 位内存范围

> ID：565806
> 
> 赞同：8
> 
> 时间：2009-02-19T15:22:00.177
> 
> 标签：64-bit, octave

我如何知道 Octave 是否可以完全访问 64 位内存范围？

我可以创建一个使用超过 4GB 内存的矩阵吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2011-12-06T09:11:49.850

我意识到这个问题很老，但它仍然很相关。在 Mac 上，是的，我使用了[自制软件](https://brew.sh/)，并在下面包含了一个超过 4GB 的矩阵示例。目前此程序有效：

安装自制软件，然后在终端窗口中运行以下命令。

```
brew install hg
brew install --use-gcc --HEAD graphicsmagick
brew install gfortran
brew install --use-gcc gnuplot
brew install octave 
```

然后将其添加到 ~/.octaverc：

```
setenv GNUTERM 'x11'
graphics_toolkit("gnuplot") 
```

享受您的 64 位倍频程编译！

```
octave:1> a = zeros(500*2^10+1,2^10);
octave:2> whos
Variables in the current scope:

  Attr Name        Size                     Bytes  Class
  ==== ====        ====                     =====  ===== 
        a      512001x1024              4194312192  double
        ans         1x50                       498  cell

Total is 524289074 elements using 4194312690 bytes 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-04-05T01:59:44.843

我使用 MacPorts 安装了 64 位版本的 Octave (octave-devel)。安装说明可在[http://shifteleven.com/articles/2011/11/06/installing-octave-on-osx-with-macports](http://shifteleven.com/articles/2011/11/06/installing-octave-on-osx-with-macports)获得。

但是，octave-devel 包似乎仍然使用 Octave 的 32 位默认索引，因此我无法加载大于 2GB 的“int8”数组。（参考：[http](http://www.gnu.org/software/octave/doc/interpreter/Compiling-Octave-with-64_002dbit-Indexing.html) ://www.gnu.org/software/octave/doc/interpreter/Compiling-Octave-with-64_002dbit-Indexing.html ）。

这可能是由于 octave-devel 包没有编译 Octave 所依赖的线性代数包的 64 位版本。

```
% Load a 3GB int8 vector (32-bit limits to 2GB)
octave:1> a = zeros(1024^3*3, 1, ‘int8′);
error: memory exhausted or requested size too large for range of Octave’s index type — trying to return to prompt 
```

64bit 处处的答案没有显示有效的测试，因为默认 Octave 的 32 位索引允许创建高达 16GB 的“双”数组。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-25T17:21:08.420

我不知道这是否对您有帮助，但根据此：[http](http://wiki.octave.org/wiki.pl?EnableLargeArrays) ://wiki.octave.org/wiki.pl?EnableLargeArrays ，支持超过 2 GB 的数组内存是实验性的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2013-09-25T20:33:43.977

有两件事是相关的：

*   64 位指针，允许大于 2 或 4GB 的内存结构

*   用于索引超过 2^32 个元素的数组的 64 位整数

首先，应该在 64 位系统上编译。第二，编译octave需要--enable64，但更重要的是，你需要链接64位整数索引BLAS库。这是困难的部分。

早在 2008 年，我就设法使用 AMD blas 库（64 位整数 fortran 版本）以这种方式编译了 octave 版本。但是，从那时起，我就无法重现这一点，因为该库已更新并且与我们使用的 Linux 系统（Ubunto 12.04）不兼容。编译 Octave 并与第三方 BLAS 链接太难了。

我在 128 GB 内存的计算机上工作，但我的 octave 脚本仍然只能解决小问题。2GB应该对任何人都足够了...

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2014-03-09T06:03:52.723

Matlab/Octave 软件包 Psychtoolbox 有一个 64 位 MacOS 版本和 64 位 .mex 文件。据我所知，对 .mex 文件的任何使用都将在 32 位 Octave 中失败，消息如下：

```
error: KbQueueReserve: /Applications/Psychtoolbox/PsychBasic/Octave3OSXFiles64/PsychHID.mex: failed to load: dlopen(/Applications/Psychtoolbox/PsychBasic/Octave3OSXFiles64/PsychHID.mex, 2): no suitable image found.  Did find: 
/Applications/Psychtoolbox/PsychBasic/Octave3OSXFiles64/PsychHID.mex: mach-o, but wrong architecture 
```

是否有可以使用 64 位 .mex 文件的 Octave 版本？

*   PsychHID.mex 架构是：x86_64
*   Octave 3.4.0 架构是：i386 ppc
*   我的系统是：运行 MacOS 10.6.8 的 MacBook Pro 5,1

这可能是一个 Psychtoolbox 问题，因为我在 中看到 Linux 文件（、、、）的 3 种架构`Octave3LinuxFiles`，但`Octave3LinuxFiles64`对于MacOS（）只有一种架构。`Octave3LinuxFilesARM``/Applications/Psychtoolbox/PsychBasic``Octave3OSXFiles64`

# php - 如何创建不允许符号的正则表达式？

> ID：565807
> 
> 赞同：0
> 
> 时间：2009-02-19T15:22:03.687
> 
> 标签：php, javascript, regex, validation

我一般有一个关于正则表达式的问题。我目前正在构建一个注册表单，您可以在其中输入全名（名字和姓氏），但是我不能使用 [a-zA-Z] 作为验证检查，因为这会排除所有具有“外来”字符的人。

确保他们不在 php 和 javascript 中输入符号的最佳方法是什么？

提前致谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-19T15:28:28.090

这个问题的正确解决方案（通常）是[POSIX character classes](http://www.regular-expressions.info/posixbrackets.html)。特别是，您应该能够使用`[:alpha:]`(或`[:alphanum:]`) 来执行此操作。

不过，您为什么要阻止用户在输入时输入他们的姓名呢？您确定您可以准确地告诉他们名字中允许包含哪些字符吗？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-19T15:29:37.260

您首先需要在概念上区分“外来”字符和“符号”。您可能需要在此处澄清。

考虑其他语言意味着考虑其他代码页，这实际上超出了简单正则表达式的范围。可以做到，但在更高的层次上，代码页必须工作。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-19T16:03:41.283

如果您严格希望您的正则表达式在标点符号和符号上失败，您可以使用`[^[:punct:]]`，但我不确定`[:punct:]`POSIX 类如何对一些奇怪的 unicode 符号作出反应。这当然会阻止某些人将“John Smythe-Jones”作为他们的名字（因为“-”是一个标点符号），所以我可能会建议不要使用它。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-19T16:09:43.463

我不认为这是个好主意。请参阅[如何检查真实姓名和姓氏 - PHP](https://stackoverflow.com/questions/557377/how-to-check-real-names-and-surnames-php)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-19T15:43:33.373

您可以遍历输入字符串并使用 String.charCodeAt() 函数来获取每个字符的整数字符代码。为自己设置一系列可接受的字符并进行比较。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-19T15:44:04.720

如前所述，POSIX 字符类可能是最好的选择。但是他们的支持（和替代方案）的细节与特定的正则表达式变体的细节有很大的不同。

PHP 显然确实支持它们，但 JavaScript 不*支持*。

这意味着对于 JavaScript，您将需要使用字符范围：/[\u0400-\u04FF]/ 匹配任何一个西里尔字符。显然，这需要一些写作，但 XML 1.0 建议（来自 W3C）不包括许多范围的列表，尽管现在已经有几年了。

一种方法可能是在 JavaScript 中对客户端进行有限检查，而仅在服务器端进行全面检查。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-19T15:32:23.427

我不知道您将如何解释有效与否，并且根据您的全球影响力，您可能无法在不锁定某人的情况下删除任何内容。但是谷歌搜索发现了这可能会有所帮助。

[http://nadeausoftware.com/articles/2007/09/php_tip_how_strip_symbol_characters_web_page](http://nadeausoftware.com/articles/2007/09/php_tip_how_strip_symbol_characters_web_page)

# asp.net - 经典 ASP 中的字节数组

> ID：565821
> 
> 赞同：1
> 
> 时间：2009-02-19T15:25:25.507
> 
> 标签：asp.net, asp-classic

如何在经典 ASP 中编写以下代码？我在包含文件中使用此代码。

```
 byte[] bytes = new byte[stream.Length] 
```

`StreamWriter`如果有人能说出如何在经典 ASP中创建对象，那就太好了。

```
 Set sw = Server.CreateObject("System.IO.StreamWriter(stream)") 
```

我不确定引号内的代码`System.IO.StreamWriter(stream)`。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-19T16:20:29.833

经典 ASP 只是普通的旧 VBScript。CreateObject 使用 classid/progid 创建一个 COM 对象：CreateObject("ADODB.Connection") 或 CreateObject("Scripting.FileSystemObject")。

经典 ASP 可以使用实际上是 .NET 对象的 COM 对象……但前提是它们是专门为支持 COM 互操作而构建的。大多数内部 .NET 东西都没有构建支持 COM 互操作。

请参阅：http: [//msdn.microsoft.com/en-us/library/zsfww439.aspx](http://msdn.microsoft.com/en-us/library/zsfww439.aspx)

如果您只需要一个流对象（不一定是 .NET System.IO.Stream 对象），那么我建议您使用 ADODB.Stream。

也不是在 ASP/VBScript 中所有变量都是变体。这使得像字节数组这样的事情变得棘手。你可以有一个变体数组没什么大不了的，所有的变体都可以是字节......但你不能创建一个*只能*保存字节的数组。更奇怪的是……如果一个 COM 对象返回一个 SAFEARRAY 字节，那么 ASP/VBScript 很乐意使用它。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-19T15:38:42.043

我不认为 StreamWriter 可以直接翻译。我的经典 ASP 对象知识有限，但 IIRC 最接近的匹配项是`FileSystemObject`. 至于字节数组：

```
Dim bytes(stream.Length-1) As Byte 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-20T20:53:46.673

不知道你想做什么，但是..

当我想处理来自 vbscript 的字节数组（比如来自数据库的 BLOB）时，我制作了一个通用的 VB6 COM 对象，它可以对字节数组执行操作。

[http://www.di-mgt.com.au/bytearrays.html](http://www.di-mgt.com.au/bytearrays.html)

# python - 如何匿名化选定标签的 XML 数据？

> ID：565823
> 
> 赞同：3
> 
> 时间：2009-02-19T15:25:47.337
> 
> 标签：python, xml, perl, anonymize

我的问题如下：

我必须阅读一个大的 XML 文件，50 MB；并匿名一些与私人问题相关的标签/字段，如姓名、姓氏地址、电子邮件、电话号码等......

我确切地知道 XML 中的哪些标签要匿名。

```
 s|<a>alpha</a>|MD5ed(alpha)|e;
 s|<h>beta</h>|MD5ed(beta)|e; 
```

where`alpha`和`beta`引用其中的任何字符，这些字符也将被散列，可能使用像[MD5](http://en.wikipedia.org/wiki/MD5)这样的算法。

我只会转换标签值，而不是标签本身。

我希望，我对我的问题足够清楚。我如何实现这一目标？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-19T15:47:59.983

您必须在 Python 中执行以下操作。

```
import xml.etree.ElementTree as xml # or lxml or whatever
import hashlib
theDoc= xml.parse( "sample.xml" )
for alphaTag in theDoc.findall( "xpath/to/tag" ):
    print alphaTag, alphaTag.text
    alphaTag.text = hashlib.md5(alphaTag.text).hexdigest()
xml.dump(theDoc) 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-19T15:35:02.633

底线：不要使用正则表达式解析 XML。

请改用您的语言的 DOM 解析库，如果您知道需要匿名化的元素，请使用 XPath 获取它们并通过设置它们的 innerText/innerHTML 属性（或您的语言所称的任何内容）来散列它们的内容。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-19T19:32:37.423

使用正则表达式确实很危险，除非您确切知道文件的格式，否则使用正则表达式很容易解析，并且您确定它将来不会改变。

否则，您确实可以使用 XML::Twig，如下所示。另一种方法是使用 XML::LibXML，尽管文件可能有点大，无法完全加载到内存中（同样，也许不是，现在内存很便宜）所以你可能不得不使用拉模式，我不太了解。

紧凑的 XML::Twig 代码：

```
#!/usr/bin/perl

use strict;
use warnings;

use XML::Twig;
use Digest::MD5 'md5_base64';

my @tags_to_anonymize= qw( name surname address email phone);

# the handler for each element ($_) sets its content with the md5 and then flushes
my %handlers= map { $_ => sub { $_->set_text( md5_base64( $_->text))->flush } } @tags_to_anonymize;

XML::Twig->new( twig_roots => \%handlers, twig_print_outside_roots => 1)
         ->parsefile( "my_big_file.xml")
         ->flush; 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-19T16:27:18.623

正如 Welbog 所说，不要尝试使用正则表达式解析 XML。你最终会后悔的。

可能最简单的方法是使用[XML::Twig](http://search.cpan.org/perldoc?XML::Twig)。它可以分块处理 XML，这使您可以处理非常大的文件。

另一种可能性是使用[SAX](http://search.cpan.org/perldoc?XML::SAX::Intro)，尤其是[XML::SAX::Machines](http://search.cpan.org/perldoc?XML::SAX::Machines)。我自己从来没有真正使用过它，但它是一个面向流的系统，所以它应该能够处理大文件。缺点是您可能必须编写更多代码来收集您关心的每个标签内的文本（XML::Twig 将为您收集该文本）。

# c++ - 有人可以给我一个支持代理的非托管 C++ HTML 客户端的例子吗？

> ID：565824
> 
> 赞同：0
> 
> 时间：2009-02-19T15:25:54.373
> 
> 标签：c++, html, http

有人可以给我一个支持代理的非托管 C++ HTML 客户端的例子吗？

我想在我的非托管 c++ 程序中做一些获取和发布，理想情况下我想允许代理服务器配置，或者只使用 IE 默认值。

我不是在寻找分发，只是一些可以通过的东西，因为我似乎无法找到太多关于此的内容。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-19T15:31:40.843

什么，[认真的？](http://www.mozilla.com/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-19T18:27:17.873

调用[WinHttpGetIEProxyConfigForCurrentUser](http://msdn.microsoft.com/en-us/library/aa384096.aspx)以获取代理配置，然后使用您选择的 HTTP 堆栈。我会避免实现你自己的伪 HTTP 堆栈，让它做对的工作比你想象的要多。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-19T15:32:32.087

我将从[Boost.ASIO](http://www.boost.org/doc/libs/1_36_0/doc/html/boost_asio/example/http/client/sync_client.cpp)开始。它不会提供您所要求的开箱即用的东西，那里有更完整的库，只是碰巧我不认识它们。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-19T16:02:04.063

如果你是在 Windows 上开发，你可以使用[WinHttp](http://msdn.microsoft.com/en-us/library/aa384273(VS.85).aspx)来写一个 C++ HTTP 客户端，我刚刚在工作中用它实现了一个客户端。

WinHttp 是一个相当简单易用的 API，它为您处理所有 HTTP 通信细节。

# delphi - 在非开发环境中调试 Delphi 应用程序

> ID：565829
> 
> 赞同：9
> 
> 时间：2009-02-19T15:27:39.933
> 
> 标签：delphi, debugging, windbg

我正在尝试使用 WinDBG 或其他调试器在远程机器上调试 CodeGear Delphi 2007 Windows 应用程序。我一直无法为 WinDBG 生成符号文件。

有没有办法使用 WinDBG 或其他调试器在不包含 IDE 的系统上调试 Delphi 应用程序？

**编辑1**

远程调试器在这里不是一个选项。我可以远程访问最终用户 PC，但由于防火墙限制，我无法使用远程调试器。

**编辑2**

我可以远程进入机器，但由于防火墙限制，无法连接 CodeGear 远程调试器。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-19T15:36:01.160

远程调试器怎么样？使用远程调试符号构建您的应用程序，并通过网络从您的开发机器进行调试。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-19T17:42:09.423

相反，我依赖于 MadExcept 堆栈跟踪和一些日志记录功能。我的应用程序分布在全球范围内，这已经足够了。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-19T20:04:44.967

您可以尝试生成地图文件，然后使用 [http://code.google.com/p/map2dbg/中的 map2dbg 将其转换为 dbg 文件](http://code.google.com/p/map2dbg/)

然后就可以在 WinDbg 中加载 dbg 文件了。

免责声明：我遇到过类似的问题，但我设法进行了远程调试，而不必做所有这些。所以我不确定这会奏效。但是，如果您尝试一下，请告诉我们它是否有效。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-19T21:37:11.317

恐怕这是“我没有实际答案”的答案之一，但这*可能会*有所帮助...

您是否考虑过将日志记录添加到您的应用程序中？我听说过有关[SmartInspect](http://www.gurock.com/products/smartinspect/)的好消息。有了它，您可以记录各种信息，包括堆栈跟踪和“监视”（变量）。

Delphi 的另一个日志记录产品是[EurekaLog](http://www.eurekalog.com/)。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-19T15:36:02.160

在 Delphi 中，您可以使用 Run -> Attach to Process，选择远程计算机并选择您要调试的进程。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2015-11-29T22:31:15.057

[http://sourceforge.net/projects/tds2dbg/](http://sourceforge.net/projects/tds2dbg/)可用于将Delphi 的TDS 调试文件转换为DBG 文件。这给出了基本的符号信息——函数、类、单位，但不是变量。足够一个合理的调用堆栈，并且有一点知识，足以实时调试 Delphi 应用程序和转储。

我在我的博客上写过一些关于 Delphi+WinDBG 的经验：[https ://marc.durdin.net/2015/11/windbg-and-delphi-a-collection-of-posts/](https://marc.durdin.net/2015/11/windbg-and-delphi-a-collection-of-posts/)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-20T14:45:19.523

谢谢大家的好建议和有趣的产品。

为了解决这个特定问题，我发现的“最佳”方法是使用位于*Windows命名空间中的**OutputDebugString*。这与[来自 Sysinternals 的 Debug View](http://technet.microsoft.com/en-us/sysinternals/bb896647.aspx)一起，将允许我收集调试信息并很快对其进行排序。

 *如果您决定使用此方法，请确保所有内容都包含在 ANSI 格式中。IE：

```
OutputDebugString(PAnsiChar(string1 + string2)); 
```

这确保了 string1 和 string2 被组合，然后转换为 ANSI 字符。

我可能应该刚刚开始将文本转储到文件中以获得快速而肮脏的东西，但这将允许非调试版本发出调试消息。

# asp.net - 在 ASP.NET 中使用 CSS

> ID：565831
> 
> 赞同：1
> 
> 时间：2009-02-19T15:28:03.090
> 
> 标签：asp.net, css

我有一个问题..

我正在使用带有 SQL 2005 的 Asp.Net C#

我有一个网格，在网格中我放了一个图像框，我想从我的 CSS 中调用图像。

当我在图像级别使用 ImageUrl="~/Images/delete_link_thumb.gif" 时，图像很好，但是当我通过 background-image:url(images/edit_link_thumb.gif) 从 css 调用时；那么图像显示不好

有什么建议吗？？

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-19T15:31:19.920

路径是 CSS 相对于 CSS 在网站中的存储位置。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-19T15:33:26.577

正如 Fabian 提到的，尝试使用 background-image:url(/images/edit_link_thumb.gif);

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-19T15:33:57.563

首先，你在你的问题中引用了两个不同的图像，除了它取决于你存储样式表的位置，因为它相对于它在项目中的位置，尝试在你的图像文件夹引用前面添加 ../ ，如下所示：

网址（../Images/blahblah.gif）；

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2015-10-09T03:03:28.693

情况是......如果您直接使用 Image url，它会影响图像框及其默认属性，并且您应用的 css 不是默认值，因此它也可能不采用确切的大小或它在你的css中提供了一些额外的填充

所以如果你使用css的背景属性，那么你应该提供位置参数，比如中心中心或任何合适的

# css - 在 HTML 电子邮件的 css 中使用 @media

> ID：565833
> 
> 赞同：0
> 
> 时间：2009-02-19T15:28:15.527
> 
> 标签：css

我正在尝试获取 HTML 电子邮件以打印比屏幕上显示的宽度更小的表格。我已经投入：

```
@media print{
  .style1 {
    width: 500;
  }
} 
```

当我打印时，它仍然超出页面。我已经将它设置为一个可笑的小量，但无济于事。`style1`应用于宽度为 100% 的表格，我认为百分比可能会抛出它，所以我将其更改为宽度并`688`得到相同的结果。表格中没有固定宽度的行或单元格；他们都使用百分比。有什么建议么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-19T15:33:35.440

如果这是上面的直接示例，则需要为 css 定义中除 0 之外的任何值提供单位（px、em 等）：

```
@media print{
  .style1 {
    width: 500px;
  }
} 
```

这与假定像素的 html 属性不同。希望这会有所帮助，-马特

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-19T15:38:29.763

首先，你应该在宽度之后定义一个单位。大多数浏览器仍然使用像素单位作为故障保护，所以这很可能不是实际问题。

你用的是什么邮件客户端？

[不保证跨不同的邮件客户端支持打印 CSS。](http://www.campaignmonitor.com/blog/post/1907/can-i-include-a-print-styleshe/)

# hardware - 是什么造就了现代商品集群？

> ID：565835
> 
> 赞同：0
> 
> 时间：2009-02-19T15:28:41.477
> 
> 标签：hardware, distributed-computing, cluster-computing

如今，使用商用硬件实现 TB 级分布式内存缓存会是最具成本效益的方式吗？什么是商品硬件？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-19T15:31:14.707

商品硬件被认为是硬件

*   现成的（没有定制）
*   许多制造商提供基本相似的版本。

有许多主板可以容纳 8 或 16 GB 的 RAM。更少的服务器主板可以容纳 32 甚至 64GB。

但它们符合商品的定义，因此可以用非常大的金额制成非常大的集群。

但是请注意，在许多访问模式中，条带 RAID HD 阵列的运行速度并不比千兆以太网链路慢很多 - 因此 RAM 集群可能没有显着改善（延迟除外），具体取决于您实际使用它的方式。

-亚当

# flash - 闪存上的外部图像未加载到位图中

> ID：565837
> 
> 赞同：0
> 
> 时间：2009-02-19T15:29:08.550
> 
> 标签：flash

我之前有一个答案，它非常有帮助，因此我修改了我的代码以使其工作，但是，我仍然在 square-1

```
//load libs
import flash.net.*;
import flash.geom.Matrix;
import flash.display.*;
import flash.events.*;
import com.adobe.images.JPGEncoder;

function myLoader() {
    var loader:Loader = new Loader();
    loader.contentLoaderInfo.addEventListener(Event.COMPLETE, sketch);

    var request:URLRequest = new URLRequest("http://www.sergiorodriguez.org/images/2008_5_FXD_VividBlack.jpg");
    loader.load(request);
}

//action for mouse 
stage.addEventListener(MouseEvent.MOUSE_MOVE, moveCursor);
Mouse.hide();

function moveCursor(event:MouseEvent):void{
    pencil.x = event.stageX;
    pencil.y = event.stageY;
}

var canvas_mc;
    canvas_mc = new MovieClip()

addChildAt(canvas_mc,0);
canvas_mc.swapDepths

//draw area to sketch
function sketch(e:Event):void{
    //load bitmap and draw it to memory
    var myBitmapData;
        myBitmapData = new BitmapData(500, 500);
        myBitmapData.draw(e);

    //define matrix
    var matrix;
        matrix = new flash.geom.Matrix();

    //start canvas
    canvas_mc.graphics.beginBitmapFill(myBitmapData,matrix, true, true);
    canvas_mc.graphics.drawRect(0, 0, 500, 500);
    canvas_mc.graphics.endFill();

    //listening  events
    canvas_mc.addEventListener(MouseEvent.MOUSE_DOWN, startDrawing);
    canvas_mc.addEventListener(MouseEvent.MOUSE_UP, stopDrawing);
    canvas_mc.addEventListener(MouseEvent.MOUSE_MOVE, makeLine);    
}       

//mouse draws on press
function startDrawing(event:MouseEvent):void{   
    canvas_mc.graphics.lineStyle(1, 0, 1);
    canvas_mc.graphics.moveTo(mouseX, mouseY);
    canvas_mc.addEventListener(MouseEvent.MOUSE_MOVE, makeLine);
}

//mouse stops drawing on realese
function stopDrawing(event:MouseEvent):void{
    canvas_mc.removeEventListener(MouseEvent.MOUSE_MOVE, makeLine);
}

//creates lines
function makeLine(event:MouseEvent):void{
    canvas_mc.graphics.lineTo(mouseX, mouseY);  
}

//call function
myLoader()

//start to save onto server
var serverPath:String = "";
function createJPG(m:MovieClip, q:Number, fileName:String){
    var jpgSource:BitmapData = new BitmapData (m.width, m.height);
    jpgSource.draw(m);
    var jpgEncoder:JPGEncoder = new JPGEncoder(q);
    var jpgStream:ByteArray = jpgEncoder.encode(jpgSource);
    var header:URLRequestHeader = new URLRequestHeader ("Content-type", "application/octet-stream");
    var jpgURLRequest:URLRequest = new URLRequest ( serverPath+"jpg_encoder_download.php?name=" + fileName + ".jpg");       
    jpgURLRequest.requestHeaders.push(header);              
    jpgURLRequest.method = URLRequestMethod.POST;               
    jpgURLRequest.data = jpgStream;

    var jpgURLLoader:URLLoader = new URLLoader();   
    //jpgURLLoader.load(jpgURLRequest);     
    navigateToURL(jpgURLRequest, "_blank");
}

save_btn.addEventListener(MouseEvent.CLICK, saveBtnPress);
save_btn.addEventListener(MouseEvent.ROLL_OVER, saveBtnOver);
save_btn.addEventListener(MouseEvent.ROLL_OUT, saveBtnOut);

function saveBtnPress(e:Event):void{    
createJPG(canvas_mc, 90, "sketch");
}

function saveBtnOver(e:Event):void{ 
    Mouse.show();
    pencil.visible = false;
}

function saveBtnOut(e:Event):void{  
    Mouse.hide();
    pencil.visible = true;
} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-19T15:40:04.367

我不确定问题是什么，但我假设您正在尝试在 myLoader() 函数加载的图像上绘画，并且您看不到该图像。在这种情况下，问题在于您没有将 Loader 实例作为孩子添加到主精灵。这是修复：

```
function myLoader() {
    var loader:Loader = new Loader();
    loader.contentLoaderInfo.addEventListener(Event.COMPLETE, sketch);

    var request:URLRequest = new URLRequest("http://www.sergiorodriguez.org/images/2008_5_FXD_VividBlack.jpg");
    loader.load(request);
    addChild(loader);
} 
```

说明：加载器最终会包含加载的图像，但是如果要显示它，则需要显示加载器本身。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-19T17:20:50.067

您不能将事件绘制到位图。您需要绘制加载的图像

改变你的路线：

```
myBitmapData.draw(e); 
```

进入

```
myBitmapData.draw(loader); 
```

我怀疑您的代码还有很多其他问题，我真的看不到您将 Bi​​tmapData 添加到任何地方的任何位图中，因此您永远看不到绘制的内容。

此外，请尝试在您的问题中更具体一些，如果我们不必通读整个代码，那么回答起来会容易得多。

# registry - 文件关联 - 在 Vista 上修改 shell 的编辑动词

> ID：565842
> 
> 赞同：1
> 
> 时间：2009-02-19T15:30:10.123
> 
> 标签：registry, windows-vista, windows-shell, file-association

我正在寻找以编程方式修改 Vista 上 shell 的**编辑**动词。例如，我想右键单击编辑（在资源管理器中）以使用 Notepad++ 打开一个 .cs 文件。

如何在 Windows Vista 上更改文件关联？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-19T16:03:47.633

您需要管理员登录，因为您必须修改 HKEY_CLASSES_ROOT。查找与 .cs 文件关联的注册表项；你会发现像“C# Source Code File”这样的描述（虽然可能不是这样；我现在不在一台安装了 VS 的机器上检查）。该键将指向另一个键（对于 MS，它通常是 GUID），用于存储编辑、打开等设置；这就是您需要进行更改的地方。

这应该让你开始，除非 Rob 猜错了，而且你的意思不是“以编程方式修改”。:-)

# vb.net - 可序列化多维数组的类是什么？

> ID：565850
> 
> 赞同：0
> 
> 时间：2009-02-19T15:31:55.793
> 
> 标签：vb.net, web-services, arrays, class, serialization

***编辑：见下文***

我有一个 Web 服务，它使用一类函数来返回各种业务流程中使用的数据（通过 InfoPath）。

其中一个函数采用给定的 SQLCommand 对象并将其执行到 SQLDataReader 中。现在，根据使用的 SQL 命令文本，这可能会返回一列或多列的一行或多行。那么这个函数返回的最佳类是什么，请记住它需要由 Web 服务序列化。

我现有的代码是：

```
 Dim array As New ArrayList

    Try

        conCMS.Open()
        Dim rdr As SqlDataReader = cmdCurrent.ExecuteReader

        While rdr.Read
            If rdr.VisibleFieldCount > 1 Then
                Dim complexType(rdr.VisibleFieldCount - 1) As String
                For rowIndex As Integer = 0 To rdr.VisibleFieldCount - 1
                    complexType(rowIndex) = rdr(rowIndex)
                Next
                array.Add(complexType)
            Else
                array.Add(rdr(0))
            End If
        End While
        conCMS.Close()

        Return array

    Catch ex As Exception

        array.Add("ERROR " & ex.Message)

    End Try

    Return Nothing 
```

现在我知道这不是有效的代码，但这是一项正在进行的工作。

正如您可能看到的那样，这正在生成一个字符串数组来表示具有多于一列的行，但是 Web 服务无法对其进行序列化。

所以真的有两件事；

*   关于使用有效类型的一些指导（无需编写我自己的可序列化类）
*   关于改进代码的一些建议。

提前致谢

***编辑：*** 我已经设法通过简单地创建一个嵌套的arrayList来使序列化工作，如下所示（doh！）：

```
 If rdr.VisibleFieldCount > 1 Then
    Dim complexType As New ArrayList
    For rowIndex As Integer = 0 To rdr.VisibleFieldCount - 1
      complexType.Add(rdr(rowIndex))
    Next
    array.Add(complexType)
   Else
    array.Add(rdr(0))
   End If 
```

但是，请让我知道如何改进。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-19T20:09:09.470

如果您的代码在调用之前知道返回数据的架构，那么您应该以相同的形状返回数据。对于返回的数据的每一列，都有一个具有适当类型属性的结构或类。对于每一行，创建这样一个结构的实例，并从返回的列中填充属性。然后将每个实例添加到该结构的强类型列表中，即 List(Of T)。然后返回列表。

OBTW，ArrayList 是在我们在 .NET 中使用泛型之前创建的。今天，最好使用强类型集合而不是 ArrayList，它基本上是 List(Of *any* )。

# compact-framework - 当子表单被解除时，防止父表单获得点击

> ID：565852
> 
> 赞同：0
> 
> 时间：2009-02-19T15:32:14.377
> 
> 标签：compact-framework

在我的 cf.net 项目中，我有一个主要的“父”表单，有时会显示一个子表单，如下所示：

```
Subform A = new SubForm();
A.ShowDialog();
//Get a property from the SubForm and use it. 
```

在我的子表单中包含一些链接标签。linkLabel 的点击事件会做一些事情并设置对话框结果，如下所示：

```
this.TextProperty = SomeNeatValue;
this.DialogResult = DialogResult.OK;
//This subform disappears and code resumes on the main form. 
```

我的主窗体还有一个 MouseUp() 处理程序，只要未单击控件，它就会执行某些操作。但是在单击 SubForm 中的 linkLabel 并且 SubForm 被关闭后，主窗体的 MouseUp() 处理程序被调用！

我希望 SubForm 的 linkLabel 完全消耗点击，而主窗体不获取它，但我找不到任何方法来防止这种情况。谁能帮我？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-23T15:38:18.577

不要在链接标签上使用点击事件。看看你是否能找到一种方法来使用 MouseUp 而不是点击（这可能是在鼠标按下的情况下工作）。

不久前，我在 KeyUp/Down 上遇到了同样的问题，我能解决的唯一方法是确保我在整个应用程序中始终使用相同的事件。

# sql-server - 安装新 SQL Server 数据库的设置提示

> ID：565867
> 
> 赞同：2
> 
> 时间：2009-02-19T15:33:36.763
> 
> 标签：sql-server, configuration, installation

为了节省成本，我们正在从托管 SQL Server 数据库转移到我们自己服务器上的专用数据库。

您将执行什么配置清单以确保最大的安全性和可靠性？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-19T15:49:10.603

有很多东西，这里只是部分列表

不同磁盘上的日志和数据文件

tempdb 在自己的磁盘上

购买尽可能多的内存（RAM 总是比磁盘 IO 快）

完成恢复或附加后，确保您使用全扫描更新统计信息并重建所有索引（如果您想制定最佳计划，这一点非常重要）

另请参阅 Microsoft 站点上的[SQL Server 最佳实践](http://msdn.microsoft.com/en-us/sqlserver/bb671432.aspx)，有大量可用的白皮书

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-19T16:34:17.093

1.  设置工作或创建维护计划，每天对所有数据库进行完整备份，每周对系统数据库进行完整备份。
2.  如果您使用的是完全恢复模式，请添加至少每小时运行一次的事务日志备份作业。
3.  确保您有一个进程来了解备份作业是否未运行（糟糕，一个月前有人停止了代理，现在我们没有备份）。
4.  通过在另一台服务器上恢复备份来测试您的备份。
5.  您可能需要优化作业以根据使用情况每天/每周/每月控制索引。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-19T15:37:30.707

对于初学者，请记住删除 sa 登录 - 令人惊讶的是，我工作过的许多地方都没有这样做！

除此之外，如果您有钱，请投资于快速磁盘-IMO 会产生巨大的影响。许多其他配置取决于您的个人应用程序/客户需求。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-19T15:49:15.753

MS没有“最佳实践”工具吗？

此外，避免使用 SQL Server 帐户并坚持使用 Windows 身份验证，这允许您将用户名和密码排除在连接字符串之外。然后为操作用户帐户分配他们需要的数据库对象的特定权限，仅此而已（例如，可以执行 SProcs 但不查看源代码）。

此外，通过[blog.stackoverflow.com](http://blog.stackoverflow.com)阅读，Jeff 等人不得不在这方面做一些工作。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-19T15:57:47.727

确保将默认服务器排序规则设置为您需要的。这将阻止您在未来创建新数据库，并且必须在该数据库和其他数据库之间硬编码排序规则更改。

# java - 为什么我的 tomcat 应用程序的内存使用量不断增长？

> ID：565871
> 
> 赞同：11
> 
> 时间：2009-02-19T15:34:19.457
> 
> 标签：java, tomcat, memory-management, memory-leaks

我的应用程序在 Windows Server 2000 上运行。内存使用量不断增长（从 145m）。

这正常吗？我是 Java 新手。版本为Tomcat5.5。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-19T15:42:58.280

如果它只增长，那就是内存泄漏。但是，如果它增长到您的最大堆，然后下降，那么这是正常的垃圾收集行为。您可以使用许多工具来了解更多信息。最简单的方法之一是连接 JConsole（JDK 的一部分）并随着时间的推移观察您的堆。

您还可以使用各种开关和参数（例如 -verbose:gc）来查看垃圾收集信息。

如果您想诊断内存泄漏，有许多优秀的工具可用，包括一些与 Eclipse、NetBeans、IntelliJ 等一起使用的免费工具。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-19T15:50:45.113

Sun“服务器”HotSpot 的默认行为是扩大堆而不是清除`SoftReference`s（用于缓存）。默认设置是为每兆字节的可用最大堆大小保留一秒钟。因此，期望堆增长到最大大小。如果您确实用尽了内存`OutOfMemoryException`或性能变差（由于过多的 GC 或小缓存），那么您需要查找内存泄漏。

此外，Tomcat 服务器在重新加载应用程序后经常会出现内存泄漏。例如，Tomcat 在所有应用程序之间共享线程，这经常导致 Sun 的`ThreadLocal`实现不正确地保留值。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-19T16:05:46.307

IMO Tom Hawtin 的回答是最好的。它会增长直到达到最大值，然后运行 ​​GC。在服务器环境中，这是有道理的：您想要最好的性能，而不是最好的内存使用。您预先计算内存总量，然后给每个应用程序一个最大值，然后一切都适合并具有最佳性能。可以调整此行为。

使用 jconsole 查看实际使用了多少。做 GC 并观察它的结果。该数字不应随着时间的推移而增长，否则您会出现内存泄漏。使用 visualvm 调试内存泄漏。

每次重新加载应用程序时，它都会使用无法回收的额外 Perm Gen 内存（在 Sun JVM 中，其他类似 JRockit 的内存没有这个问题）。在生产中，您不应该重新加载应用程序。每次重启Tomcat。如果您真的想继续这样做，那么您可以增加最大内存并使用标志 -XX:MaxPermSize=256m 增加 Max Perm Gen 内存

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-02-19T20:56:01.980

使用[Lambda Probe](http://www.lambdaprobe.org/d/index.htm)程序，您可以轻松查看 Tomcat 中的内存使用情况。（选项系统信息 - 内存利用率）。您可以在图中看到 Survivor Space Perm Gen Tenured Gen Eden Space Code Cache

只需将此warfile 部署到tomcat 并将启动选项-Dcom.sun.management.jmxremote 设置为Java 启动。

现在您可以看到内存的哪一部分增长了。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-19T15:36:57.347

这是不正常的，可能表示[内存泄漏](http://en.wikipedia.org/wiki/Memory_leak)。

您应该尝试使用[内存分析器](http://java-source.net/open-source/profilers)来查看您的应用程序泄漏的位置。

通常，您应该寻找创建对象但未正确[处理的](http://www.ibm.com/developerworks/java/library/j-jtp01274.html)循环或重复操作。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-19T15:38:22.930

您可能有内存泄漏。我首先将 jconsole 连接到您的应用程序以确定它是永久空间还是只是堆内存，然后继续找出泄漏的位置。你能给我们更多的信息吗？随着内存的增长，您的应用程序中发生了什么？

如果您对诊断此类问题比较陌生，我会推荐 jprofiler。您可以下载功能齐全的试用版并拍摄内存快照以查看内存中的对象。您可以使用此信息来确定哪些对象是泄漏源。

# .net - Memcached 1 Meg 限制，Enyim .Net 客户端

> ID：565876
> 
> 赞同：3
> 
> 时间：2009-02-19T15:35:40.657
> 
> 标签：.net, memcached

memcached 中的对象限制为 1 meg。存储比这更大的对象的最佳方法是什么？

我正在使用 Enyim .Net 客户端。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2010-07-19T12:18:40.883

从 1.4.2 开始，可以在 memcached 中增加大于 1MB 的项目的最大大小：

[http://code.google.com/p/memcached/wiki/ReleaseNotes142#Configurable_maximum_item_size](http://code.google.com/p/memcached/wiki/ReleaseNotes142#Configurable_maximum_item_size)

请注意，旧版本的 Enyim.Caching 客户端仍然有 1MB 的硬编码内部限制。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-19T15:43:21.700

我通过 C API 使用 memcached，但情况基本相同。您需要自己找到一种方法来拆分数据，并提供一种方法来生成一组密钥，以根据您的主密钥访问这些部分。您可能还需要存储在第一个 blob 中的某种标头，它可以告诉您是否正在查看多部分缓存对象。

我认为没有什么可以为您完成繁重的工作，但是我在 C++ 而不是 .NET 中执行此操作，也许有人已经编写了一个模块。否则......我建议市场上有差距:)

# jquery - Ajax“成功”和成功的方法调用之间的区别？

> ID：565882
> 
> 赞同：2
> 
> 时间：2009-02-19T15:36:55.100
> 
> 标签：jquery, ajax, asp.net-ajax

我有一个 jquery .ajax 发布到具有“授权”属性的 asp.net mvc 方法。即使用户无权发布到操作，Ajax 回调也会成功。一、ajax成功回调是基于什么成功的？其次，为了测试是否执行了实际方法，我从操作返回了一个“成功”字符串，并从那里使用了 javascript。这第二种方法好吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-19T15:41:22.710

AJAX 是使用 Javascript 的 HTTP 请求。获取网页时浏览器发出的相同 HTTP 请求。

AJAX 成功只是说它成功地获取了 URL，即。没有网络错误，服务器没有返回 404 或类似错误等。

您调用的方法是否返回成功结果是另一回事。AJAX 所能做的就是告诉你它成功地得到了*一个*结果，但是你必须弄清楚这个结果是否表明你的应用程序成功或失败。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-19T15:43:36.057

这里的区别在于javascript AJAX 机制的成功（即进入readyState==4）与httprequest 本身的成功（即status==200）之间。

对于 javascript，您的应用程序产生的 500 范围错误将作为请求很好地工作（看看堆栈跟踪在 HTML 中的格式看起来有多好？）。请记住检查 XHR 对象上的 readyState 和状态。

# iphone - UIImagePickerControllerSourceTypeCamera 占用内存

> ID：565886
> 
> 赞同：5
> 
> 时间：2009-02-19T15:37:24.573
> 
> 标签：iphone

我正在使用 UIImagePickerController 来让用户通过拍摄新照片或从图库中选择图像来选择我的应用程序中的图像。使用图库，该应用程序运行良好。但是如果我使用相机作为源，应用程序会占用大量内存，并最终在变得非常缓慢后被杀死。

有人可以告诉我使用 UIImagePickerControllerSourceTypeCamera 的最佳方式吗？

这是我正在使用的代码

```
if(![UIImagePickerController isSourceTypeAvailable:UIImagePickerControllerSourceTypeCamera])
    return;
picker = [[UIImagePickerController alloc] init];
picker.sourceType = UIImagePickerControllerSourceTypeCamera;
picker.delegate = self;
[[self navigationController] presentModalViewController:picker animated:YES];
[picker release]; 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-19T23:03:10.270

使用 UIImagePickerController 没有任何技巧——它使用大量内存，你只需要忍受它。完成后释放它是最有效的。

不过，这是关于图像选择器本身的。问题的另一部分是你对它返回给你的 UIImage 对象做了什么。这些都是大对象，按照 iPhone 的标准，你真的不能把它们中的许多保存在内存中。如果您正在显示图像，那就是生活，但是不在屏幕上的图像可以通过 UIImageJPEGRepresentation() 和 NSData 的 writeToFile:atomically: 安全地卸载到文件中。

如果您确实需要显示多个图像，请考虑缩小它们。相机的 1600x1200 已经比屏幕大了很多，加上屏幕上的多个图像就更夸张了。缩放到较低的分辨率会显着降低内存需求。执行此操作的示例代码不难找到——例如，请参阅[UIImagePickerController 相机预览是横向应用程序中的纵向](https://stackoverflow.com/questions/538041/uiimagepickercontroller-camera-preview-is-portrait-in-landscape-app)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-19T21:47:39.170

UIImagePickerController 泄漏内存，如此[处所述，](http://blog.airsource.co.uk/index.php/2008/11/12/memory-usage-in-uiimagepickercontroller/)并且在 7 或 8 次使用后会导致您的应用程序崩溃。您需要在应用程序的整个生命周期中创建一个单例 UIImagePickerController 以避免此 Apple 缺陷。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-25T18:04:11.530

我知道这个答案是事后的，但我遇到了相同类型的问题，通过链接 iPhone SDK 2.2 及更高版本解决了自身问题。

# java - 从多个线程进行 Java 日志记录的最佳实践？

> ID：565893
> 
> 赞同：29
> 
> 时间：2009-02-19T15:40:00.933
> 
> 标签：java, multithreading, logging

我想要一个由多个管理数据的任务生成的诊断日志。这些任务可能在多个线程中。每个任务都需要将一个元素（可能带有子元素）写入日志；快速进出。如果这是单任务情况，我会使用[XMLStreamWriter](http://java.sun.com/webservices/docs/1.5/api/javax/xml/stream/XMLStreamWriter.html)，因为它似乎是简单性/功能性的最佳匹配，而无需在内存中保存膨胀的 XML 文档。

但这不是单任务情况，我不确定如何最好地确保这是“线程安全的”，这里应用程序中的“线程安全”意味着每个日志元素都应该正确且连续地写入日志（一个之后另一个并且不以任何方式交错）。

有什么建议么？我有一个模糊的直觉，要走的路是使用一个日志元素队列（每个元素都可以快速生成：我的应用程序正忙于做对性能敏感的实际工作），并有一个单独的线程来处理日志元素并将它们发送到一个文件，这样日志记录就不会中断生产者。

日志记录不一定必须是 XML，但我确实希望它是结构化的和机器可读的。

编辑：我把“线程安全”放在引号中。Log4j 似乎是显而易见的选择（对我来说是新的，但对社区来说是旧的），为什么要重新发明轮子......

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-02-19T15:42:29.943

使用日志框架，例如[Log4j](http://logging.apache.org/log4j/)。

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2009-02-19T16:22:44.243

我认为你走错了路。您说“线程安全”，但实际上是指“序列化”。线程安全意味着一个线程不会干扰来自其他线程的数据。大多数情况下，线程问题是事先解决的，您不应该仅仅为了记录而担心它。例如，如果你写：

```
myVariableSum = 0 + myVariable;
//here comes other thread - Not very likely!
logger.info("Log some INFO; myVariable has value" + myVariable.toString()); 
```

您必须确保 myVariable 从执行计算（第一行）的那一刻起但在调用日志记录方法之前没有被其他线程更改。如果发生这种情况，您将记录未用于执行操作的脏值，而是由其他线程分配的值。这通常会得到照顾；例如本地（方法级别）变量不能被其他线程更改。无论如何，如果您在记录时不得不担心这一点，那么您的程序已经有 99% 的严重线程问题。
所有主要的日志框架本身都是“线程安全的”，这意味着它们可以部署在多线程环境中，并且不会在内部显示类似于上述问题的问题。
让跟踪按照它们发生的顺序出现在日志中实际上通常称为调用的“序列化”。序列化日志写入将成为任何多线程应用程序的主要性能瓶颈。如果您使用日志框架，如 log4j，来自所有线程的跟踪将或多或少地按照它们发生的顺序出现在一个地方。但是，一列通常是线程名称，因此您可以轻松地按线程过滤日志数据；每个线程将按时间顺序记录其数据。查看此链接： http: [//logging.apache.org/log4j/1.2/faq.html#1.7](http://logging.apache.org/log4j/1.2/faq.html#1.7)
最后，如果序列化日志写入是您真正需要的，那么您可以使用某种结构，例如 java.util。 concurrent.BlockingQueue 来路由您的消息。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-05-28T18:06:02.250

使用 logback 经典。它是 log4j 的更新更好的实现。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-02-19T15:45:27.290

您可以使用同步机制（如监视器或信号量）来确保在接受下一个日志请求之前处理一个日志请求。这一切都可以从调用日志记录例程的代码中隐藏起来。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-02-19T23:21:07.417

我倾向于在 Log4J 之上使用[SLF4J 。](http://www.slf4j.org/)如果您将拥有大量可能在生产环境中关闭的日志记录语句，则[参数化日志记录功能特别有吸引力。](http://www.slf4j.org/faq.html#logging_performance)

它也可以在 java.util.logging 的顶部运行或使用它自己的简单输出。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-02-19T15:47:06.090

> 使用日志框架，例如 Log4。

如果您对输出不满意，您可以编写自己的 Appender、Filter 等任何调整它的内容。所以你甚至可以做一些缓存来重新排列条目，尽管我并不是说这是一个好主意。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-02-19T15:47:22.847

使用实现某种形式[的 NDC 模式](http://logging.apache.org/log4j/1.2/apidocs/org/apache/log4j/NDC.html)的日志框架，例如[Log4J](http://logging.apache.org/log4j/1.2/index.html)。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-02-19T15:47:15.373

log4j 多年来一直是 Java 日志记录的标准。但是如果你不喜欢外部依赖，那么[java.util.logging](http://java.sun.com/j2se/1.4.2/docs/guide/util/logging/overview.html)包提供了一个可以接受的解决方案。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2016-11-11T05:30:01.140

我只对特殊日志有类似的问题和实现需求。我的解决方案是：

1.  我采用了应用程序流量/分钟的`blockinglinkedqueue`大小。`*2`

2.  所有线程将对象放入队列并完成作业。

3.  单独的线程从队列中获取头对象并使用单独的附加程序`Log-Writer`将其写入文件。`log4j`此附加程序未用于系统日志。

这确保了日志是按顺序写入的，并且始终是有序的。

这不会影响应用程序的性能，因为日志写入是一个完全独立的过程，不会造成瓶颈。

您还可以使用`aysncappender`.`log4j`

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-05-30T22:21:23.210

如果必须，您可以使用单写入器/单读取器 FIFO 或队列滚动自己的 ..。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-02-19T15:48:20.220

以线程安全的方式自行开发并非易事，因此您应该真正使用现有的线程安全日志框架。最常用的是[Log4J](http://logging.apache.org/log4j/1.2/)，它是线程安全的（请参阅[常见问题解答](http://logging.apache.org/log4j/1.2/faq.html#1.7)）。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2018-11-07T03:36:18.253

这是一个老问题，但这是我以编程方式使用 Log4J 的解决方案。

日志工厂类

```
import org.apache.log4j.Logger;
import org.apache.log4j.PropertyConfigurator;

import java.util.Properties;

public class LogFactory {

    private final static ThreadLocal<Logger> logFactory = new ThreadLocal<>();

    public static void createNewLogger(String className) {

        Logger log = Logger.getLogger("Thread" + className);

        Properties props = new Properties();
        props.setProperty("log4j.appender.file", "org.apache.log4j.RollingFileAppender");

        props.setProperty("log4j.appender.file.maxFileSize", "100MB");
        props.setProperty("log4j.appender.file.Append", "false");
        props.setProperty("log4j.", "100MB");
        props.setProperty("log4j.appender.file.maxBackupIndex", "100");
        props.setProperty("log4j.appender.file.File", "logs/" + className + ".log");
        props.setProperty("log4j.appender.file.threshold", "info");
        props.setProperty("log4j.appender.file.layout", "org.apache.log4j.PatternLayout");
        props.setProperty("log4j.appender.file.layout.ConversionPattern", "%d{yyyy-MM-dd HH-mm-ss} | %-5p | %C{1}:%L | %m%n");
        props.setProperty("log4j.appender.stdout", "org.apache.log4j.ConsoleAppender");
        props.setProperty("log4j.appender.stdout.Target", "System.out");
        props.setProperty("log4j.logger." + "Thread" + className, "INFO, file");
        PropertyConfigurator.configure(props);
        logFactory.set(log);
    }

    public static Logger getLogger() {
        return logFactory.get();
    }

} 
```

然后使用以下方法初始化记录器

```
logFactory.createNewLogger(String.valueOf(Thread.currentThread().getId()));
logFactory.getLogger().info(" TEST . Thread id is: " + id); 
```

# linq - 用于创建 PIVOT 表的 Linq 查询

> ID：565897
> 
> 赞同：0
> 
> 时间：2009-02-19T15:40:36.587
> 
> 标签：linq, pivot

我有三个表 table1、table2 和 table3

```
Table1                                                
Id  Data
1   Data1
2   Data2
3   Data3

Table2
Id  Meta data
1   Meta data1
2   Meta data2
“     "
“     "
“     "

Table 3
Id   Data ID  Meta Data ID      Value
1    Data1    Metadata1         Value1
2    Data1    Metadata2         Value2
3    Data2    Metadata1         Value3
4    Data2    Metadata2         Value4 
```

我想通过使用 LINQ 查询连接这些表来创建一个数据透视表

我的结果表应该是这样的

```
Data   Metadata 1  Metadata2  ‘”””   and so on……
Data1  Value1      Value2     
Data2  Value3      Value4 
```

什么是适当的 linq 查询，这可能是我实现结果的解决方案？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-02T23:43:42.750

你不能这样做吗？不需要花哨的 linq

```
var dict = new Dictionary<object, PivotedValue>();

foreach(var t in table3){
    if(!dict.ContainsKey(t.DataID)) dict.Add(t.DataID, new PivotedValue{DataID = t.DataID});
    dict[t.DataID].PivotedFields.Add(t.MetaDataID, t.Value);
}

class PivotedValue{

    object DataID {get;set;}
    Dictionary<object, object> PivotedFields {get;set;}

} 
```

# wcsf - WCSF 中的控制器是做什么用的？

> ID：565905
> 
> 赞同：1
> 
> 时间：2009-02-19T15:42:54.847
> 
> 标签：wcsf

我仍在努力让我的大脑围绕 MVP。我应该使用控制器类做什么？那是我访问数据资源的地方吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-19T07:11:13.327

控制器应该作用于模型，可能通过服务层调用数据库来填充模型。通常，对于来自视图的请求，控制器会在模型上执行操作。

视图是屏幕上的演示。

Presenter 处理视图和控制器之间的流程。

将演示者和控制器分开的原因可能是您可以将某个控制器与不同的演示者重用等。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-11-15T14:11:55.610

我认为 Presenter 不应该和 UI 技术耦合，应该直接处理模型的服务层。应用程序中应该只有一个控制器，并且可以与 UI 技术紧密耦合。页面导航可以在控制器中抽象出来。我觉得，基于 WCSF 的 MVP-Controller 模式是原始 MVP 模式的轻微变化。

让我建议演示者将被实现以供重用，而控制器则不是。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-10-25T19:38:21.540

MS 的 WCSF 示例中的控制器保存模块中多个演示者共享的数据，公开对共享数据进行操作的方法，并在 Web 会话中管理共享数据。例如，NewTransfer 演示者和 TransferHistory 演示者使用的汇款对象列表。

对 1 个演示者唯一的数据只能通过控制器访问，但不是必须的。在这种情况下，演示者可以自己管理数据访问和 Web 会话数据。

这是我在看了几年的几个例子后的解释，例如

*   WCSF2010 源文件中的 GlobalBanking 示例。它可以在[http://webclientguidance.codeplex.com/wikipage?title=Web%20Client%20Software%20Factory&referringTitle=Home](http://webclientguidance.codeplex.com/wikipage?title=Web%20Client%20Software%20Factory&referringTitle=Home)上找到。
*   这里的一个：http: [//msdn.microsoft.com/en-us/library/ff650240.aspx](http://msdn.microsoft.com/en-us/library/ff650240.aspx)。在底部附近，它提到了控制器。

我不确定他们使用的是谁的“控制器”定义，但它与 MVC 中的定义不同。

# oracle - 什么会导致间歇性 ORA-12560：TNS：协议适配器错误？

> ID：565912
> 
> 赞同：0
> 
> 时间：2009-02-19T15:43:54.123
> 
> 标签：oracle, ora-12560

我有一个写得很糟糕的遗留 .NET 应用程序，如果它检测到连接已被删除，它会与数据库保持持续联系，并抛出“无连接”屏幕。

运行此程序的所有机器都配置相同，但在其中两台机器上，我们最近刚开始遇到一个问题，无论是否有连接，都会出现无连接屏幕，并且在计算机本身重新启动之前不会检测到连接。

查看错误日志，罪魁祸首似乎是

```
ORA-12560: TNS:protocol adapter error 
```

但什么可能导致这种情况？特别是因为直到几周前才发生这种情况。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-19T15:51:43.343

很可能，机器无法解析条目中提供的名称，或访问条目中`DNS`提供的服务器。`HOST``tnsnames.ora``HOST`

如果连接在超时时断开（就像底层`TCP`流在超时时断开一样），它也会失败并显示此消息。

如果您使用`tnsnames.ora`on`Oracle 10g`或更高版本，请尝试使用`Easy Connect`format ( `//servername/servicename`) 代替。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-19T15:53:52.003

不确定，但是当网络发生不良情况时，这就是您所得到的。

一个常见的特殊情况是防火墙或其他关闭空闲连接的网络小工具。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-02-24T17:44:46.270

在我们的 C:\Oracle 目录中，一些文件被压缩（蓝色）。一旦我们解压缩文件，我们的问题就消失了。

# asp.net - 从 ASP.NET 获取 Windows 计划任务中任务的最后运行日期

> ID：565922
> 
> 赞同：3
> 
> 时间：2009-02-19T15:46:57.540
> 
> 标签：asp.net, scheduled-tasks

是否可以从 ASP.NET 获取 Windows 计划任务中计划任务的最后运行日期？

理想情况下，最好能够列出、启动和停止这些任务，尽管在这个阶段，我想做的主要事情是检索特定计划任务的最后运行时间。

如果这不可能，我的解决方法是让正在运行的应用程序使用它的上次运行日期更新数据库或 XML 文件，但由于此信息已存储在计划任务中，我想知道它是否更容易阅读数据直接来自那里。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-11-11T12:32:23.620

使用[Task Scheduler Managed Wrapper 1.2](http://www.softpedia.com/progDownload/Task-Scheduler-Managed-Wrapper-Download-115722.html)（免费下载），然后使用`Task.LastRunTime`属性

# java - 更新属性文件的更好的类？

> ID：565932
> 
> 赞同：39
> 
> 时间：2009-02-19T15:48:37.073
> 
> 标签：java, properties

虽然`java.util.properties`允许读取和写入属性文件，但写入不保留格式。不足为奇，因为它不绑定到属性文件。

是否有一个`PropertyFile`类 - 或类似的类 - 保留注释和空行并在适当位置更新属性值？

* * *

## 回答 #1

> 赞同：60
> 
> 时间：2009-02-19T16:04:23.470

它并没有比 Apache 的 Commons [Configuration](http://commons.apache.org/configuration/index.html) API 好多少。这提供了从属性文件、XML、JNDI、JDBC 数据源等进行配置的统一方法。

它对属性文件的处理非常好。它允许您从您的属性生成一个[PropertiesConfigurationLayout](http://commons.apache.org/configuration/apidocs/index.html)对象，该对象尽可能多地保留有关您的属性文件的信息（空格、注释等）。当您保存对属性文件的更改时，将尽可能地保留这些更改。

* * *

示例代码：

```
import java.io.File;
import java.io.FileInputStream;
import java.io.FileNotFoundException;
import java.io.InputStreamReader;

import org.apache.commons.configuration.ConfigurationException;
import org.apache.commons.configuration.PropertiesConfiguration;
import org.apache.commons.configuration.PropertiesConfigurationLayout;

public class PropertiesReader {
    public static void main(String args[]) throws ConfigurationException, FileNotFoundException {
        File file = new File(args[0] + ".properties");

        PropertiesConfiguration config = new PropertiesConfiguration();
        PropertiesConfigurationLayout layout = new PropertiesConfigurationLayout(config);
        layout.load(new InputStreamReader(new FileInputStream(file)));

        config.setProperty("test", "testValue");
        layout.save(new FileWriter("path\\to\\properties\\file.properties", false));
    }
} 
```

也可以看看：

*   [http://mvnrepository.com/artifact/commons-configuration/commons-configuration/](http://mvnrepository.com/artifact/commons-configuration/commons-configuration/)
*   [https://commons.apache.org/proper/commons-configuration/apidocs/org/apache/commons/configuration2/PropertiesConfigurationLayout.html](https://commons.apache.org/proper/commons-configuration/apidocs/org/apache/commons/configuration2/PropertiesConfigurationLayout.html)

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2015-04-10T15:00:57.237

Patrick Boos 提供的使用 Apache Commons Configuration 库的示例代码过于复杂。除非您需要对输出进行一些高级控制，否则您不需要显式使用 PropertiesConfigurationLayout。PropertiesConfiguration 本身就足以保留注释和格式：

```
PropertiesConfiguration config = new PropertiesConfiguration("myprops.properties");
config.setProperty("Foo", "Bar");
config.save(); 
```

（注意：此代码适用于现有的 1.10 稳定版本。我尚未检查它是否适用于当前可用的 2.0 alpha 版本。）

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-02-19T16:00:17.713

您可以查看包含[PropertiesConfiguration](http://commons.apache.org/configuration/apidocs/org/apache/commons/configuration/PropertiesConfiguration.html)类的[Apache Commons Configuration 。](http://commons.apache.org/configuration)但是，由于我从未使用过它，我不知道它是否保留了评论和格式......

不过，值得一试...

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2018-10-25T00:11:01.107

configuration2 类有不同的语法。这是使用它们的示例：

```
import org.apache.commons.configuration2.PropertiesConfiguration;
import org.apache.commons.configuration2.PropertiesConfigurationLayout;

public void test() {
    PropertiesConfiguration config = new PropertiesConfiguration();
    PropertiesConfigurationLayout layout = new PropertiesConfigurationLayout();
    config.setLayout(layout);
    layout.load(config, new FileReader("config.properties"));

    config.setProperty("KEY", "VALUE");
    StringWriter stringWriter = new StringWriter();
    layout.save(config, stringWriter);
    LOG.debug("Properties:\n{}", stringWriter.toString());
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2016-07-29T06:19:09.500

```
 File file = new File("src/test/resources/1automation.properties");
    PropertiesConfiguration config = new PropertiesConfiguration();
    PropertiesConfigurationLayout layout = new PropertiesConfigurationLayout(config);
    layout.load(new InputStreamReader(new FileInputStream(file)));
    FileWriter fw = new FileWriter("src/test/resources/1automation.properties",false);
    config.setProperty("myssi.admin.name", "testValue");
    layout.save(fw); 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2018-12-14T16:24:52.057

最佳答案包含一个小错误：该行：

```
PropertiesConfigurationLayout layout = new PropertiesConfigurationLayout(config); 
```

必须替换为：

```
PropertiesConfigurationLayout layout = config.getLayout(); 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2020-06-02T00:47:43.067

只是为了回应Jince Martin，他在编写的属性文件中遇到了尾随空格的问题，例如key = value而不是key = value。

您可以调用 layout.setGlobalSeparator("=") 来解决这个问题。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2009-02-19T16:00:51.777

我曾经看到一个使用 INI 文件执行此操作的类，但再也找不到链接了。如果您找不到其他任何东西，可以尝试[DecentXML](http://code.google.com/p/decentxml/)。我编写这个 XML 解析器的具体设计目标是 100% 保留原始格式（即带有注释、元素中或根元素周围的奇怪空格，所有内容）。

在解析生成的 XML 文档期间，您只需记住包含选项值的元素并替换其中的文本节点。当您保存时，任何未触及的内容都不会发生任何变化。

# c++ - 我可以使用什么容器来编写二进制文件？

> ID：565938
> 
> 赞同：3
> 
> 时间：2009-02-19T15:49:30.670
> 
> 标签：c++, containers

我想将 ac 数组写入容器，如果可能的话，我更喜欢修改它。我正在考虑使用向量，但它似乎确实有一个 write(*pchararray, len); 功能。String 看起来是下一个最好的东西，但它也没有写功能？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-19T15:55:44.280

给定

```
char myarray[10]; 
```

您可以使用**STL`iterator`**：

```
vector <char> v;
copy(myarray, myarray + 10, back_inserter(v)); 
```

您可以使用**构造函数**：

```
vector <char> v(myarray, myarray + 10); 
```

您可以**调整大小和复制**：

```
vector<char> v(10);
copy(myarray, myarray + 10, v.begin()); 
```

（并且所有这些对于字符串的工作方式都类似）

感谢评论/其他答案:)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-19T16:06:02.657

向量、字符串和许多其他容器为此目的都有一个“两个迭代器”构造函数：

```
char raw_data[100];
std::vector<char> v(raw_data, raw_data + 100);
std::string s(raw_data, raw_data + 100); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-19T15:56:17.403

容器选择取决于您对各个元素的使用。如果您的意思是将 ac 字符数组复制到容器中，您可以使用以下方法：

```
char buf[ n ];
std::vector<char> vc(n); // Thanks to Éric 
std::copy(buf, buf + n, vc.begin()); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-19T15:52:37.437

不确定您的“写”评论到底是什么意思，但是

```
std::vector<char> charBuffer; 
```

在功能上等同于 ac char(byte) 数组

```
&charBuffer[0] 
```

为您提供连续的底层内存。

所以现在你可以做

```
charBuffer.resize(100);
memcpy(&charBuffer[0], src, charBuffer.size()); 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-19T15:53:38.740

您可以使用向量。预先分配大小，然后寻址第一个字节：向量被保证是连续的，所以这总是有效的。

```
std::vector<char> vBuffer;
vBuffer.resize(nLength);
std::copy(pStart, pEnd, &vBuffer[0]); 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-19T17:46:58.863

您可以使用：

```
string s( pchararray, len );  // constructor 
```

或者：

```
string s;  s.append( pchararray, len ); // append example. 
```

或 string::insert() 如果你愿意。

如果您指定长度，字符串可以愉快地处理空字符 ('\0')。

见 [http://www.cplusplus.com/reference/string/string/](http://www.cplusplus.com/reference/string/string/)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-19T17:10:44.633

在这种情况下，您应该更喜欢使用 memcpy（因为向量包含 POD 类型）而不是使用 std::copy，它的速度要快得多。

# javascript - JavaScript：取消事件跨浏览器

> ID：565939
> 
> 赞同：0
> 
> 时间：2009-02-19T15:49:31.653
> 
> 标签：javascript, events

我正在一个 asp.net 网站中实现一个浮动弹出帮助控件，并且我正在使用 JQuery 来实现这些功能。

通过单击链接可以看到弹出窗口，该链接还具有指向另一个页面的 href 以支持禁用 JavaScript 的用户。我添加了“return false;” 到链接的onClick事件中的Javascript字符串的末尾，以防止导航到href值，并且很高兴直到我意识到Firefox不支持此功能。

我遇到了几篇指向 event.preventDefault 方法的文章，该方法可用于使 Firefox 以相同的方式运行，但在所有情况下，所涉及的示例似乎都有一些繁琐的模式，即向相关对象显式添加事件。

有没有一种简单的方法可以让这种语法起作用？我想让我的控制尽可能简单。代码示例：

```
<a id="myLink" 
onclick="javascript:$('#myPanel').addClass('helpPopOn');return
false;" href="/pages/help.aspx?content=TestHelp">Help</a> 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-19T15:52:56.847

显式添加事件很*繁琐*？

```
$("#myLink").click(function(e)
{
   $('#myPanel').addClass('helpPopOn');
   e.preventDefault();
}); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-20T04:13:16.840

虽然 Shog9 的回答是正确的，但为了完整起见，同样的逻辑显然也适用于内联处理程序：

```
<a id="myLink" onclick="javascript:$('#myPanel').addClass('helpPopOn');event.preventDefault();return false;" href="/pages/help.aspx?content=TestHelp">Help</a> 
```

# .net - Winforms &TimeSpan - 哪个控件效果最好？

> ID：565950
> 
> 赞同：5
> 
> 时间：2009-02-19T15:53:42.360
> 
> 标签：.net, winforms, timespan

我正在使用 winforms 构建一个表单 - 并且应该添加一个视图和可编辑的时间跨度值。哪种控制最适合这个？

正常的编辑控件正确显示值->但更改值并不是很好

正常的日期时间选择器不起作用

蒙版编辑控件没有任何标准蒙版

有人对此任务有控制的好主意吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-19T16:14:49.593

我构建了一个文本框和一个组合框来选择单位。用户控件具有范围设置（值 +-）和（时间单位）。根据选择的单位，文本框的范围被选中 - 例如，1-7 天可能有效，但如果单位是分钟，则 1-60 分钟可能会更好。

我也完成了两个 ComboBoxes 和 NumericUpDown 的组合。

如果您需要像 3 天 4 小时 6 分钟这样的时间跨度，我可能会选择带有蒙版文本框的用户控件并检查部件的范围。

不过，通常情况下，我会选择第一个。

只是我的两分钱。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2010-04-08T22:27:59.627

使用[TimeSpan Helper](https://github.com/dahall/TimeSpan2)，其中包括一个简单的 Control （当我使用它时没有很好地记录它）。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-19T15:56:13.020

使用一个普通的文本框，再加上一个错误提供程序控件，该控件使用 TimeSpan.TryParse() 来检查值，以及一个用于建议您期望什么样的数据的工具提示。

如果需要，您也可以将所有这些组合到一个自定义控件中。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2014-01-10T07:40:49.820

对于另一个项目，我也必须编辑时间跨度。

我终于使用了 3 个数字上/下控件：第一个控制总小时数，第二个控制分钟数，第三个控制秒数。

```
//Setting the values
durationHours.Value = (Decimal)Math.Floor (data.TotalHours);
durationMin.Value = data.Minutes;
durationSeconds.Value = data.Seconds;

//Getting the values
data = new TimeSpan((int)durationHours.Value, (int)durationMin.Value, (int)durationSeconds.Value); 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-07-29T09:57:37.963

如果您正在寻找一些工作代码，请查看下面的链接。

[此博客文章](http://jobijoy.blogspot.com/2007/10/time-picker-user-control.html)提供了用于选择时间跨度的 WPF 用户控件的源代码。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-07-05T01:46:26.627

也试试这个扩展[的 TimeSpanPicker](https://github.com/Coding4FunProjects/Coding4FunToolkit)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-11-12T09:58:55.593

如果您不想允许超过 24 小时并且您不想指定毫秒，我认为 DateTime 选择器效果最好，特别是如果您创建一个用户控件以使其成为 TimeSpan 选择器。

好消息是你可以调高小时/分钟/秒。它会自动阻止您设置超过 60 分钟/秒的时间。缺点：没有毫秒，也没有超过一天的时间。

在开发人员工作室中添加一个新的用户控件：TimePicker。在用户控件上放置一个日期时间选择器。更改属性：

*   格式：时间；这使您在 24 小时前只能看到一个时间（以秒为单位）
*   ShowUpDown：True：这使您无法打开日历。您将有一个小时/分钟/秒的上下。

使用本地化时间格式。如果您想要特定的时间格式，请使用自定义时间格式。

对经过验证的事件做出反应，将值读取为 DateTime 并从同一天开始时的午夜减去 if。结果将是一个时间跨度。在 Valug.Get 中返回此值。Value.Set：将今天午夜的 DateTime 添加到 TimeSpan 中进行设置。

如果您需要超过 24 小时，或者想要添加毫秒，请添加一个文本框并使用验证和 TryParse。这甚至允许用户使用刻度而不是时间通知。如果未验证，请使用工具提示显示错误。

# silverlight - 我可以移动在 Silverlight 中调整 IFRAME 大小的 GridSplitter 吗？

> ID：565955
> 
> 赞同：1
> 
> 时间：2009-02-19T15:55:09.423
> 
> 标签：silverlight

我的 silverlight 页面中有一个简单的 Grid 控件。网格中的一个单元格应该容纳一个网页。由于没有 Web 浏览器控件，我在 HTML 页面中添加了一个 IFRAME，并在加载后修改了 IFRAME 的大小和位置，使其看起来像在网格单元格中。

我还有一个 GridSplitter，用于允许用户调整网格部分的大小。当用户调整网格大小时，IFRAME 也会调整大小。

所有这一切都适用于一个小问题。如果我将 GridSplitter 拖向 IFRAME，只要鼠标指针位于 IFRAME 前面，调整大小就会停止。我猜是因为鼠标指针离开了 Silverlight 控件，现在位于 HTML 区域中。

有没有办法修改它，以便将 GridSplitter 拖到 IFRAME 上继续调整大小操作？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-20T10:23:40.633

这不是一个完美的解决方案，但你可以在它处于拖动模式时更改 html 中 iframe 的 z 顺序以将其放在 silverlight 应用程序下吗？

# wpf - WPF中的内发光效果

> ID：565962
> 
> 赞同：6
> 
> 时间：2009-02-19T15:56:20.820
> 
> 标签：wpf

简短的问题:) 有没有人有在 WPF 中创建内发光效果的方法？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-19T22:27:00.387

谷歌是你的朋友。

[如何：使用 Expression Blend 制作内发光。](http://blogs.msdn.com/msmossyblog/archive/2008/09/15/how-to-make-innerglows-with-expression-blend.aspx)

# coding-style - 软件安全标准

> ID：565965
> 
> 赞同：13
> 
> 时间：2009-02-19T15:56:38.013
> 
> 标签：coding-style

在开发涉及控制可能伤害使用它的个人的设备/系统的软件时，任何人都必须遵守哪些行业知名的软件安全标准？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-13T11:16:20.027

上面的 Aonix 链接对于基本推理来说是一个很好的链接。如果您想了解特定标准如何工作的示例，您可以搜索以下内容：

*   IEC61508：“电气/电子/可编程电子安全相关系统（E/E/PES）的功能安全”。在各个行业特定标准中引用的基本标准。[这个 IEC 页面](http://www.iec.ch/zone/fsafety/fsafety_entry.htm)是一个很好的起点。第 61508-3 部分是关于软件的。
*   DO-178B：与 IEC61508 范围相似的航空电子标准，对软件的看法略有不同
*   IEC60601-1-4：处理“可编程电气医疗系统”（60601 系列标准的一部分）
*   EN5012x：铁路特定标准 - 50128 是关于软件的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-20T18:43:27.703

不同的行业有不同的标准。例如飞机和机器人。一些新行业的标准仍在不断发展，例如手术机器人。仍然有一些共同的元素。首先是冗余。我与工业机器人一起工作。对于速度控制等关键项目，我们在两个不同的控制器上使用三种不同的计算。对于紧急停止系统，我们使用双电路，每个红色急停按钮后面都有两个物理开关。

我以前在飞机上工作。在飞机自动驾驶仪上，通常有两台甚至三台独立的计算机进行计算并比较结果。

目标是防止任何单一故障使系统不安全。

您需要查看管理您所在领域的规则和法规，以了解法律要求是什么，但您必须确保整个系统安全。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-19T16:07:21.747

MISRA 是汽车行业遵循的标准，但它是确保操作正确性和可移植性的编码标准。

您需要阅读[Therac 事故](http://courses.cs.vt.edu/~cs3604/lib/Therac_25/Therac_1.html)以了解此问题的复杂性。

此外，NASA 和军事文件广泛可用，并讨论了允许确定系统安全性的编码标准。

-亚当

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-03-13T02:33:33.543

方法因领域而异。（对不起，我只评价 1 个链接...）

航空电子设备：DO-178B：（参见维基百科）

信息安全通用标准（参见通用标准门户网站）

FDA 控制医疗设备的软件（想想 X 光机） [http://www.fda.gov/medicaldevices/deviceregulationandguidance/guidancedocuments/default.htm](http://www.fda.gov/medicaldevices/deviceregulationandguidance/guidancedocuments/default.htm)

位于英国约克大学的安全关键邮件列表 (UK) 是一个极好的资源 最近有关于如何将 SIL 标准（参见关于 SIL 标准的维基百科）应用到软件系统的讨论。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-20T18:23:51.993

不是安全标准，但阅读 comp.risks 一段时间将显示您需要努力预防的问题。

（《计算机相关风险》这本书也很好。）

* * *

## 回答 #6

> 赞同：-8
> 
> 时间：2009-02-19T16:03:03.023

软件不应该**运行**可能伤害某人的系统。这可能是错误的唯一可能（并且仍然值得怀疑）的时间是使用专为安全而设计的[安全可靠的 PLC 。](http://www2.sea.siemens.com/Products/Automation/Safety-Integrated/Safety-Integrated.htm)

你应该调查：

*   [SIL 4](http://www.jokabsafetyna.com/products/safetyrelay/ChoiceSafetyCategory.html)
*   [第 3 类](http://www.jokabsafetyna.com/products/safetyrelay/ChoiceSafetyCategory.html)

# linq - 如何通过查询读取 LINQ 组？

> ID：565972
> 
> 赞同：0
> 
> 时间：2009-02-19T15:59:04.710
> 
> 标签：linq, hashtable, group-by

这是我的 escenary，我有一个名为 Plantilla 的类，其中包含允许在 wpf 中绑定一个 gridview 的多个属性，所以这已经工作了，但是用户告诉我他们需要通过数据库中的某个字段重新分组查询，所以我准备这个片段：

```
 var dsTemplates = (from t in db.PLANTILLAs
                                   join q in db.EQUIPOs on t.codigoequipo equals q.codigoequipo
                                   where t.codigoestudio.Substring(5, 1).Equals(codigoModalidad)
                                   orderby t.tituloplantilla
                                   group new Plantilla
                                   {
                                       codigoplantilla = t.codigoplantilla,
                                       codigoequipo = t.codigoequipo,
                                       nombreequipo = q.nombreequipo,
                                       codigoestudio = t.codigoequipo,
                                       conclusion = t.conclusion,
                                       hallazgo = t.hallazgo,
                                       nombreexamen = t.tituloplantilla,
                                       tecnica = t.tecnica
                                   } by t.codigoestudio
                ).ToList();
                formTemplates.dlstPlantillas.ItemsSource = dsTemplates;
                db.Connection.Close(); 
```

现在我的问题是如何阅读以下内容？在哈希表中？如何将泛型转换为 Hashtable？因为当 T 是我的班级 Plantilla 时，我现在有一个列表

我将它绑定到一个网格视图，所以当我想从网格中获取值时，我得到了异常

调试告诉我这是我在 gridview.SelectedItems[0] 中的新型集合；

```
[0] = {System.Data.Linq.SqlClient.ObjectReaderCompiler.Group<string,Demo.View.Plantilla>} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-19T16:02:07.073

在您的 gridview 中，您可以将索引字段设置为返回的 var 中的必填字段。然后，这将为您提供编辑的每一行的 PK。

# objective-c - 将左按钮添加到 UINavigationBar (iPhone)

> ID：565989
> 
> 赞同：27
> 
> 时间：2009-02-19T16:03:05.410
> 
> 标签：objective-c, iphone, uinavigationbar, navigation-style

我创建了一个新的基于导航的 iPhone 应用程序。我将此添加到 RootViewController。

```
- (void)viewDidLoad {
    [super viewDidLoad];
    UIBarButtonItem *addButton = [[UIBarButtonItem alloc] init];
self.navigationItem.leftBarButtonItem = addButton;
self.navigationItem.leftBarButtonItem.enabled = YES;
} 
```

但是没有左键显示。有什么我需要做的吗？

* * *

## 回答 #1

> 赞同：55
> 
> 时间：2009-02-19T16:07:11.200

您没有定义按钮的实际作用。这是我的应用程序中的一行：

```
self.navigationItem.leftBarButtonItem = [[UIBarButtonItem alloc] initWithBarButtonSystemItem:UIBarButtonSystemItemCancel target:self action:@selector(cancelEdit:)]; 
```

`cancelEdit:`，选择器，在当前类（self）中，定义为：

```
- (void) cancelEdit: (id) sender; 
```

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2012-10-07T21:35:45.767

实际上还有另一个答案，此处未列出，但在许多情况下可能非常有用。如果您[不想使用 UINavigationController](https://stackoverflow.com/questions/10100038/how-to-add-bar-button-in-navigation-bar-without-navigation-controller)，那么`self.navigationItem`不适合您。

```
UIBarButtonItem *barButton = [[UIBarButtonItem alloc] initWithImage:[UIImage imageNamed:@"imageName"] style:UIBarButtonItemStyleBordered target:self action:@selector(action:)];
UINavigationItem *navigationItem = [[UINavigationItem alloc] initWithTitle:@"Bar Title"];
navigationItem.leftBarButtonItem = barButton;
[navigationBar pushNavigationItem:navigationItem animated:NO]; 
```

在创建带有栏和按钮的轻量级 UIViewController 时，您可能希望这样做，但不希望导航开销。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2009-09-06T04:03:13.920

关于这个问题：

> *很好，谢谢。您在哪里可以找到各种可用的选择器？该文档对此非常模糊。我定义了一个实例方法并将其作为选择器，但它从未执行过。单击按钮时，我想在详细视图中滑动。– 4thSpace 2 月 19 日 16:19*

我去了需要更多信息的地方，然后按退出 (Esc) 键。所以，在这个例子中：

`...(beginning of line)... @selector(**Place Cursor Here, press Esc**) ...`

将出现可用选择器的列表。对于 Microsoft 程序员来说，这就像 Intellisense，但您必须使用 Esc 来请求它（它只是不像在 Visual Studio 中那样自动出现）。实际上，当您开始键入时，XCode 确实会创建您尝试创建的大部分内容，并且当您确定 Tab 键是您的朋友时，它确实很有帮助。（嗯……这是*我*的朋友……我过着孤独的生活）

现在，如果您需要自己的选择器，可以将标签放在那里（例如**mySelector ：）**，然后在代码的更下方构建它：

`- (IBAction)mySelector:(id)sender {
NSLog(@"You touched me THERE!");
}`

另外，在头文件（.h）中，一定要放一个对应的：

`-(IBAction) mySelector:(id)sender;`

# asp.net - 将工具提示添加到 asp.net GridView 中的分页链接

> ID：565992
> 
> 赞同：2
> 
> 时间：2009-02-19T16:03:32.873
> 
> 标签：asp.net, gridview

我有一个网格视图，最终可能会显示大约 5K 条记录。我目前将其设置为使用分页，因此它一次显示 200 条记录。为了增加可用性，我想为最终用户提供一些反馈，让他们更容易找到记录。我希望有一种方法可以让用户将鼠标放在其中一个寻呼机链接上，并且工具提示会显示页面上可用的记录范围。

例如：

用户将鼠标放在第 1 页链接上，工具提示显示**ABOTT - BUELLER** 用户将鼠标放在第 14 页链接上，工具提示显示**MARTIN - PELLIGRINO**

我将如何在 ASP.NET 中完成此任务？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-19T16:21:19.633

您可以执行以下操作。首先创建一个空的 PagerTemplate：

```
<asp:GridView 
ID="GridView1" 
runat="server" 
AllowPaging="true" 
PagerSettings-Mode="Numeric" 
PageSize="2" ondatabound="GridView1_DataBound">
    <PagerTemplate />
</asp:GridView> 
```

现在，为了响应 DataBound 事件，您可以将控件添加到寻呼机行。此代码只是将页码添加为 LinkBut​​tons。

```
protected void GridView1_DataBound(object sender, EventArgs e)
{
    GridViewRow pagerRow = GridView1.BottomPagerRow;

    for (int i = 0; i < GridView1.PageCount; i++)
    {
        LinkButton lb = new LinkButton();
        lb.Text = i.ToString();
        lb.ToolTip = "...";
        lb.CommandName = "Page";
        lb.CommandArgument = i.ToString();

        pagerRow.Cells[0].Controls.Add(lb);
    }

} 
```

您还需要处理 PageIndexChanging 事件。

```
protected void GridView1_PageIndexChanging(object sender, GridViewPageEventArgs e)
{
    GridView1.PageIndex = e.NewPageIndex + 1;
    GridView1.DataBind();
} 
```

现在剩下的就是确定工具提示文本应该是什么。为此，您需要每一页的顶行和底行的索引。在此示例中，它们将是：

```
int topIndex = i * GridView1.PageSize;
int bottomIndex = ((i + 1) * GridView1.PageSize) - 1; 
```

# mysql - 在 MySQL 中，“开销”是什么意思，它有什么不好的，以及如何解决它？

> ID：565997
> 
> 赞同：164
> 
> 时间：2009-02-19T16:04:32.070
> 
> 标签：mysql, overhead

简单的问题，但它一直在唠叨我一段时间......

MySQL中的“开销”是什么，我应该担心吗？

单击“优化表”是否可以修复它？

* * *

## 回答 #1

> 赞同：154
> 
> 时间：2009-02-19T16:12:06.647

似乎开销是数据库用来运行某些查询的临时磁盘空间，所以你应该只担心这真的很高。

您可以将“优化表”与硬盘碎片整理进行比较。

我引用：

> 随着时间的推移，每个数据库都需要某种形式的维护，以使其保持在*最佳*性能水平。清除已删除的行、重新排序、压缩、管理索引路径、碎片整理等在 mysql 中称为 OPTIMIZATION，在其他数据库中称为其他术语。例如，IBM DB2/400 将其称为 REORGANIZE PHYSICAL FILE MEMBER。
> 
> 这有点像更换汽车中的机油或进行调整。你可能认为你真的不必这样做，但这样做你的车会跑得更好，你会得到更好的油耗，等等。一辆里程数多的汽车需要更频繁地进行调整。一个被大量使用的数据库也需要同样的东西。如果您正在执行大量 UPDATE 和/或 DELETE 操作，尤其是如果您的表具有可变长度列（VARCHAR、TEXT 等），您需要保持调整。

* * *

## 回答 #2

> 赞同：94
> 
> 时间：2009-02-19T16:28:12.417

如果您正在谈论`phpMyAdmin`调用的东西`overhead`，那么它是表数据文件的实际大小相对于同一数据文件的理想大小（就像刚从备份中恢复时一样）。

出于性能原因，`MySQL`在删除或更新行后不压缩数据文件。

这`overhead`对表扫描不利，即当您的查询需要遍历所有表值时，它需要查看更多的空白空间。

`overhead`您可以通过运行`OPTIMIZE TABLE`压缩表和索引来摆脱。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2013-12-23T12:40:24.137

开销是表的**Data_free ，即已****分配但未使用的字节数。** 我们可以通过 SQL 命令**SHOW TABLE STATUS**找到它。它是为您的表分配大小的可用空间。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2015-02-24T12:22:02.410

优化表可能会很成问题。例如，如果该表在站点上被大量使用。

[http://dev.mysql.com/doc/refman/5.1/en/optimize-table.html](http://dev.mysql.com/doc/refman/5.1/en/optimize-table.html)

> 在删除大部分 MyISAM 或 ARCHIVE 表，或对具有可变长度行的 MyISAM 或 ARCHIVE 表（具有 VARCHAR、VARBINARY、BLOB 或 TEXT 列的表）进行许多更改之后。删除的行保存在一个链表中，随后的 INSERT 操作重用旧的行位置。<

我相信我已经确认了这种行为。它确实非常有用。**********