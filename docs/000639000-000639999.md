# StackOverflow 问答 000639000-000639999

# editor - 如何获得 WMD 编辑器的价值？

> ID：639006
> 
> 赞同：3
> 
> 时间：2009-03-12T14:54:48.960
> 
> 标签：editor, wmd, wmd-editor

我正在我的网站中使用 WMD 编辑器 ( [http://wmd-editor.com/](http://wmd-editor.com/) )。我有一个非常简单的问题。当我准备好将文本提交到服务器时；如何获得编辑器的输出？

像这样的东西只返回“用户在文本区域中输入的实际文本”

```
 var jtext = document.getElementById('myTextarea').value; 
```

我想获得编辑器的“输出”；但我不知道该怎么做:(

按输出；我的意思是“Markdown”或“Html”输出。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-12T15:23:23.870

您将需要使用 javascript 来获取预览 div 的内容。根据 wmd 站点上的演示，有问题的 div 具有 wmd-preview 类。不知道为什么它不是 id'd。

在 jQuery 中，你会使用类似的东西：

```
$('#formname').submit(function() {
    $('#hidden_form_element').val($('.wmd-preview').html());
    return true;
}); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-10-06T13:36:48.303

我相信您可以简单地使用 id="wmd-output" 创建一个 textarea，它应该允许您提交输出代码

# c# - 如果与 NaN 的比较总是返回 false，我如何将浮点数与 NaN 进行比较？

> ID：639010
> 
> 赞同：52
> 
> 时间：2009-03-12T14:55:19.097
> 
> 标签：c#

我有一个浮点值设置为 NaN（在观察窗口中看到），但我不知道如何在代码中检测到它：

```
if (fValue == float.NaN) // returns false even though fValue is NaN
{
} 
```

* * *

## 回答 #1

> 赞同：101
> 
> 时间：2009-03-12T14:56:24.307

你想要`float.IsNaN(...)`。`NaN`无论浮点数是什么，比较总是返回 false。这是浮点的怪癖之一。

这意味着你可以这样做：

```
if (f1 != f1) { // This conditional will be true if f1 is NaN. 
```

事实上，这正是 IsNaN() 的工作原理。

* * *

## 回答 #2

> 赞同：34
> 
> 时间：2009-03-12T14:56:11.343

试试这个：

```
if (float.IsNaN(fValue))
{
} 
```

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2012-02-20T10:56:40.610

在性能关键代码`float.IsNaN`中可能会太慢，因为它涉及 FPU。在这种情况下，您可以使用二进制掩码检查（根据[IEEE 754 规范](http://en.wikipedia.org/wiki/Single_precision)），如下所示：

```
public static unsafe bool IsNaN (float f)
{
    int binary = *(int*)(&f);
    return ((binary & 0x7F800000) == 0x7F800000) && ((binary & 0x007FFFFF) != 0);
} 
```

它比 . 快 5 倍`float.IsNaN`。我只是想知道为什么微软没有`IsNaN`以这种方式实施。如果您不想使用不安全的代码，您仍然可以使用类似联合的结构：

```
[StructLayout (LayoutKind.Explicit)]
struct FloatUnion
{
    [FieldOffset (0)]
    public float value;

    [FieldOffset (0)]
    public int binary;
}

public static bool IsNaN (float f)
{
    FloatUnion union = new FloatUnion ();
    union.value = f;

    return ((union.binary & 0x7F800000) == 0x7F800000) && ((union.binary & 0x007FFFFF) != 0);
} 
```

它仍然比 . 快 3 倍`IsNaN`。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-03-12T14:57:22.743

```
if(float.isNaN(fValue))
{
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-03-27T02:38:24.543

```
if (fValue.CompareTo(float.NaN) == 0) 
```

注意：我知道，线程已经死了。

# continuous-integration - 持续集成 / Cruisecontrol 建议

> ID：639012
> 
> 赞同：2
> 
> 时间：2009-03-12T14:55:58.550
> 
> 标签：continuous-integration, cruisecontrol, cruisecontrol.rb

我的任务是为我们的项目设置一个持续集成服务器，并且正在权衡选项。

我想使用 cc.rb 而不是 cc，因为我宁愿编写 Ruby 而不是 XML。据我所知，cc 是一款更成熟的产品，并且具有更多开箱即用的功能。

所以我想知道您是否正在设置具有以下要求的集成服务器，您会选择哪个系统以及您将如何进行？

*   水银支持
*   在多个平台上运行 selenium 测试套件
*   x10 支持构建灯（不是必需的）

任何指导将不胜感激。

问候，

克里斯

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-12T15:43:53.557

是的，我同意，hudson 更容易管理，并且有各种漂亮的插件，使其灵活

它确实有 mercurial 支持 [http://wiki.hudson-ci.org/display/HUDSON/Mercurial+Plugin](http://wiki.hudson-ci.org/display/HUDSON/Mercurial+Plugin)

硒支持也可用 [http://thinkvitamin.com/dev/easy-automated-web-application-testing-with-hudson-and-selenium/](http://thinkvitamin.com/dev/easy-automated-web-application-testing-with-hudson-and-selenium/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-12T15:28:27.713

你有没有考虑过使用哈德森。它支持多种语言和 pluins，而且通常非常灵活。

我相信它有反复无常的支持，你可以以某种方式在硒测试中钩住。

卡尔

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-12T19:42:39.223

好吧，我个人会使用原始的 CruiseControl，但这可能是因为我帮助编写了它。;)

有很多工具可以用来做你想做的事（CC、cc.rb、Hudson 等）。如果您只关心运行这些测试，那么它们中的大多数都可以。如果您想要更精致的体验和更多功能（如 IDE 集成），那么 Zutubi Pulse（或 Bamboo 或 Team City）等工具开始看起来不错。如果您想进入完整的生命周期（CI->测试->部署）并从多个工具报告，那么像 AnthillPro 这样的高端产品可能是您的选择。

所以真的是一个你认为你可能想要做什么的问题。

# c# - DataBinder.Eval 中的 XSS

> ID：639034
> 
> 赞同：1
> 
> 时间：2009-03-12T14:59:12.147
> 
> 标签：c#, asp.net, xss

在以下 C# 代码隐藏中，XSS 的潜力在哪里？

```
// Get data based on key names
for (int i = 0; i < m_dataKeyNames.Length; i++)
{
   data[i] = (string)DataBinder.Eval(container.DataItem, m_dataKeyNames[i]);
} 
```

这可以解决吗？谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-12T15:18:06.847

根据数据的来源，它可能包含某人通过另一个表单添加的脚本。

添加数据并获取数据时，您需要使用[HtmlEncode](http://msdn.microsoft.com/en-us/library/system.web.httpserverutility.htmlencode.aspx)方法对其进行消毒。

# .net - Infragistics UltraGrid：如何删除第一行的默认选择

> ID：639037
> 
> 赞同：16
> 
> 时间：2009-03-12T15:01:51.860
> 
> 标签：.net, winforms, infragistics, ultrawingrid

我在 WinForms 用户控件上放置了一个 UltraGrid。我调整了一些设置，以便可以将网格用作只读多行选择表。但是有一个问题：默认情况下，第一行似乎被选中。

但是`Selected.Rows`属性是空的，`ActiveRow`属性也是`null`。

因此，该行似乎已被选中，但实际上并未选中，因此无法删除选择。

我确定必须在 UltraGrid 的某处隐藏一个设置来控制此行为。如果不是这种情况，那么也许有一种解决方法？

谢谢。

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-03-12T15:16:58.537

经过一番研究，我找到了一个解决方案，我将与大家分享：

```
myUltraGrid.DisplayLayout.Override.ActiveCellAppearance.Reset();
myUltraGrid.DisplayLayout.Override.ActiveRowAppearance.Reset(); 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2014-03-06T08:58:40.237

试试这个：

```
this.ultraGrid1.SyncWithCurrencyManager = false;
this.ultraGrid1.DisplayLayout.Override.RowSelectors=DefaultableBoolean.False; 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-06-03T14:42:19.597

我遇到了与您完全相同的问题，但 Gerrie Schenck 的解决方案对我不起作用。我使用了这个技巧： MyUltraGrid.ActiveRow = MyUltraGrid.Rows[0]; MyUltraGrid.ActiveRow = null;

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2014-11-14T13:48:14.873

这帮助我抑制了网格的“活动外观”：

```
grid.DisplayLayout.Override.ActiveAppearancesEnabled = Infragistics.Win.DefaultableBoolean.False; 
```

如果您也不希望将一行标记为选中，则必须对“Selected Appearance”执行相同操作：

```
grid.DisplayLayout.Override.SelectedAppearancesEnabled = Infragistics.Win.DefaultableBoolean.False; 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2016-01-19T19:10:06.007

区分 Selected 和 Active 很重要。网格永远不会自动选择任何行 您所看到的是 ActiveRow，它与所选行一样以突出显示方式显示。

网格的 ActiveRow 与 CurrencyManager 同步，因此默认情况下，网格的第一行突出显示。重置 ActiveRowAppearance 和 ActiveCellAppearance 将从 ActiveRow 中删除默认突出显示。

```
 this.ultraGrid1.DisplayLayout.Override.ActiveCellAppearance.Reset();
        this.ultraGrid1.DisplayLayout.Override.ActiveRowAppearance.Reset(); 
```

但重要的是要注意，这不会阻止该行成为活动行，只是网格不再突出显示活动行。由于该行仍然处于活动状态（并且没有办法阻止这种情况），因此突出显示活动行的任何其他内容仍将突出显示该行。例如，如果您将样式库 (*.isl) 文件加载到将样式应用于 ActiveRow 的应用程序中，它仍将显示。

如果您想以更彻底的方式禁用活动行外观，完全忽略所有属性设置和样式库设置，您可以这样做：

```
this.ultraGrid1.DisplayLayout.Override.ActiveAppearancesEnabled = Infragistics.Win.DefaultableBoolean.False; 
```

请注意，此属性是在 v9.2 中添加的，在旧版本中不存在。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-05-26T16:27:57.383

不知何故，上面列出的解决方案都不适合我。就我而言，我只是希望根本不发生激活/选择。所以我做了以下。它可能不是最好的解决方案，但它确实有效。

```
 private void LayoutVisulizerUltraGrid_AfterRowActivate(object sender, EventArgs e)
    {
        LayoutVisulizerUltraGrid.ActiveRow = null;
    } 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2015-08-06T06:19:13.570

完全禁用选定的行，然后设置`ActiveRow`为 null 应该清除选择。

```
grid.DisplayLayout.Override.SelectTypeRow = Infragistics.Win.UltraWinGrid.SelectType.None; 
```

# sql-server - 在单个语句中选择和执行 - SQL 服务器

> ID：639038
> 
> 赞同：1
> 
> 时间：2009-03-12T15:01:53.980
> 
> 标签：sql-server

我在 SP 中有一个临时表。我在其中插入了一些值。然后我需要通过发送临时表中的值来执行第二个 SP。我宁愿避免使用局部变量。

```
DECLARE @tmp TABLE
(
  Name VARCHAR(200).
  Code INT
)

INSERT INTO @tmp
SELECT 'TEST', 100

EXEC MyProc
  @Name = --Here I send the values from temp
  @Code = 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-12T20:01:31.690

创建一个实际的临时表#TempTable 而不是@varibale 表，您可以在父存储过程和子存储过程之间共享它...

[http://www.sommarskog.se/share_data.html#temptables](http://www.sommarskog.se/share_data.html#temptables)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-12T16:02:47.130

您不能，除非您使用的是允许表数据类型的 SQL Server 2008。可以用作存储过程参数。

否则 frp SQL 2000/2005，对于临时表中的 10 行，您需要循环通过 10 个内部存储过程调用。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-12T15:04:30.870

您可以将其全部包装在一个 SP 中。

# iphone - 如何在 Xcode 中一次本地化多个文件？

> ID：639041
> 
> 赞同：4
> 
> 时间：2009-03-12T15:02:30.047
> 
> 标签：iphone, cocoa, xcode, localization, internationalization

在本地化我的应用程序的过程中，我有大约 50 个资源（主要是 xib）需要本地化。我知道如何为每个文件添加本地化，​​但是打开信息面板并为每个文件添加本地化是一个非常耗时的过程。

有什么方法可以一次选择多个文件并为每个文件添加本地化？

编辑添加：这是 AppleGlot 或 iLocalize 可以提供帮助的地方吗？我还没有看过那些工具。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-12T15:07:58.163

只需为您正在本地化的语言创建一个目录（如果它不存在）（例如“en.lproj”）并将所有文件复制到那里。然后进入 xcode 并将新复制的文件添加到您的项目中。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-16T04:40:14.407

您是否尝试过使用 ibtool？这个从终端运行的工具可以列出 nib 文件中的类或对象，还可以将可本地化的字符串转储到 plist 中。

虽然我没有尝试过这个工具，但你可以通过在终端中输入“man ibtool”来找到更多信息。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-04-13T04:25:21.743

在左侧/导航器窗格中选择多个文件，然后通过右侧/实用程序窗格添加本地化应该可以工作，但不能。我针对 Xcode 4.0.1 提交了错误 #9276560。

如果您需要支持多种语言，这会有所帮助：

1.  点击文件#n
2.  添加一个本地化
3.  对所有文件重复步骤 1 和 2
4.  单击左侧/导航器部分中的项目
5.  在项目信息窗格中，添加本地化

这样做是将每个以前本地化的文件添加到新语言中。您仍然需要分别添加 50 个文件，但至少您不必执行 50 次乘以语言数量的操作。就我而言，这为我节省了数百步。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-08-19T14:23:55.787

答案在[这里的另一篇文章中](https://stackoverflow.com/questions/2942771/localize-many-images-in-xcode-at-once)

本质上，您必须为所有语言创建 xx.lproj 目录。然后将所有本地化文件复制到各自的目录中。现在，您的 lproj 目录应该具有相同名称的文件（但具有不同的本地化内容）。然后将所有目录中的所有文件添加到 Xcode 中。Xcode 将根据它们所在的 lproj 目录将它们分配到适当的语言环境。

# ms-word - CVS 关键字替换和 Microsoft Word 文件

> ID：639049
> 
> 赞同：0
> 
> 时间：2009-03-12T15:04:00.700
> 
> 标签：ms-word, cvs

CVS 具有关键字替换功能：在您编写的文本文件中`$Header$`，当您提交文件时，CVS 会替换`$Header$`为类似`$Header: /repo/src.cpp,v 1.6 2009/03/12 14:53:14 luser Exp $`

处理二进制 Microsoft Word 文件时是否可以获得相同的功能？

谢谢你。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-12T15:16:13.790

Word 文件的基本问题是它实际上是一个二进制文件（与纯文本文件相反），所以你不能确定像“$Header$”这样的关键字符串不会出现在某个地方（VB 宏代码，例如）意外。CVS 会扩展那个键字符串，突然之间一些明显不相关的东西（例如 VB 宏代码......）停止工作。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-12T15:42:40.703

使用传统的 .doc 格式似乎几乎不可能。一些创造性的工作可能允许您创建一个流程，以使用较新的 XML 格式实现它。我不确定 CVS 是否能完成这项工作，但在 subversion 中使用 post-commit 钩子可能会使它更合理地完成。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-12T15:21:42.750

使用 CVS？不见得。即使`$Header$`没有出现在您的 Word 文档中的任何位置（正如[DevSolar](https://stackoverflow.com/questions/639049/cvs-keyword-substitution-and-microsoft-word-file/639099#639099)建议的那样），您将该字符串放在哪里？Word 以其专有的二进制格式存储文本，但 CVS 查找纯文本。

另一方面，我相信您可以通过使用 XML Word 格式或 Word 宏来实现该效果。

# asp.net - 公共 ASP.NET 应用程序安全注意事项

> ID：639051
> 
> 赞同：3
> 
> 时间：2009-03-12T15:04:08.327
> 
> 标签：asp.net, sql, security

在我的工作中必须编写一个极其安全的 ASP.NET 应用程序，而不是在 Internet 上拖网寻找最佳实践，我想知道什么考虑因素以及通常应该做些什么来确保公共 Web 应用程序的安全。

当然，我们已经考虑了用户/通行证组合，但需要比这更深的层次。我说的是应用程序的每个级别和层，即

*   使用 URL 重写
*   母版页
*   站点地图
*   连接池
*   会话数据
*   编码密码。
*   使用存储过程而不是直接的 SQL 语句

我正在把它变成一个社区维基，因为没有一个唯一的答案是正确的，因为它是一个如此广泛的*讨论*话题。我还要指出，这绝不是我的强项，以前的安全锁定是通过非公开应用程序实现的。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-12T15:07:13.517

您应该将“存储过程”的概念细化为仅使用参数化查询。这将解决您那里的大部分问题。您还可以限制 UI 上的字段并删除或编码破坏性字符，例如讨厌的 ';'...

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-12T16:43:25.893

这是一个比我认为你可能意识到的更大的话题。最好的建议是找一个已经知道可以为您提供建议的人。如果没有，我会先阅读 Microsoft 文档“[提高 Web 应用程序安全性：威胁和对策](http://msdn.microsoft.com/en-us/library/ms994921.aspx)”，但要注意该文档的打印页数为 919。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-12T15:06:49.803

*   使用表单身份验证而不是在会话中存储身份验证数据。
*   显然：哈希密码。如果您想非常谨慎，请使用 SHA1 加密而不是 md5。

# java - Java小程序白屏

> ID：639056
> 
> 赞同：1
> 
> 时间：2009-03-12T15:05:25.750
> 
> 标签：java, applet

我正试图找出我们基于 Java 小程序的程序的问题。它经常出现无响应的 GUI（或白屏）。当然，这仅在部署在客户站点时才会发生 :-(。他们正在运行 1.5 系列的 Sun JVM 版本（不确定确切的版本）。

我们有一个理论认为这与小程序堆空间不足有关——这听起来合理吗？我在我的机器上设置的另一件事是禁用直接绘制，但这主要是为了避免其他应用程序上出现奇怪的伪影。

他们在 Citrix 和普通 PC 上看到了问题，但显然 Citrix 上的用户可以做的事情是有限的。

有什么建议么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-12T16:04:09.547

堆空间用完会导致 an`OutOfMemoryError`被抛出。这个案例听起来像是典型的僵局。要找到它在哪里，您需要所有线程的堆栈转储。IIRC< 您可以通过控制台或从 IIRC 1.6 JDK 包含`jps`和`jstack`.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-12T15:15:45.930

首先确保客户使用他们正在使用的最新版本的 JVM，并让他们在浏览器中启用 Java 控制台（这需要您进行一些研究）。

然后当它再次发生时，告诉他们查看控制台窗口并将邮件中的内容剪切粘贴给您。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-12T15:10:00.560

为了解决问题，您必须首先能够重现问题。您将需要一个相同的系统来解决此问题，一次进行一项更改，同时保持其他所有内容相同以确定原因。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-11-28T18:44:30.997

只是为了添加到这个答案（在我目前正在研究的时候建立知识库）。

（至少）有 2 个与小程序相关的不同白屏。

1.  死锁（正如 Tom 所说） - 当您将窗口拖到它前面时，该区域不会刷新，因此您会得到奇怪的尾巴效果。

2.  VM 崩溃 - 区域将变为白色，Java VM 关闭（搜索 hs_err_pid*.log，位置取决于浏览器）

# html - Visual Studio 2008 HTML 格式 - 它曾经有效吗？

> ID：639057
> 
> 赞同：5
> 
> 时间：2009-03-12T15:05:55.203
> 
> 标签：html, visual-studio, visual-studio-2008, formatting

这是另一个 Visual Studio 2008 HTML 格式问题...我想我要么在臭名昭著的糟糕的 VS HTML 格式中发现了一个错误，要么我做错了什么。这就是我正在做的事情：

**我通过以下方式删除所有客户端标签：**
工具->选项->文本编辑器-> HTML->格式->标签特定选项

**然后我添加 b 和 span 标签：**

[替代文字 http://www.xtupload.com/new/thumb-3BB0_49B92330.jpg](http://www.xtupload.com/new/share-3BB0_49B92330.html)

我按 CTRL+E,CTRL+D 得到这两个不同的结果：

## 1

[alt text http://www.xtupload.com/new/image-CBF1_49B92330.jpg](http://www.xtupload.com/new/image-CBF1_49B92330.jpg)
span 标签前的 P 格式不正确

## 2

[alt text http://www.xtupload.com/new/image-3AB6_49B92330.jpg](http://www.xtupload.com/new/image-3AB6_49B92330.jpg)
P 标签格式正确。

*这适用于 .ASPX 扩展文件。*

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-12T16:24:33.647

看起来这是一个错误，并不依赖于标签是 SPAN 还是 B。

# 我发现的工作

在结束 P 之前添加一个额外的空格。

## 它是如何失败的

```
<p><b>My title</b></p> 
```

重新格式化为

```
<p>
  <b>My title</b></p> 
```

## 如何让它工作

```
<p><b>My title</b> </p> 
```

*（注意 B 之后的空格）*被重新格式化为：

```
<p>
  <b>My title</b>
</p> 
```

无论如何，VS都会删除额外的空间。哈利路亚，我的 HTML 看起来很漂亮！

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-17T00:06:59.320

我遵循与克里斯相同的方法。我决定使用 RegEx 查找和替换来为整个文档执行此操作。正则表达式查找前面没有空格或行首的任何结束 p 或 h* 标记，并在结束标记之前插入换行符。检查正则表达式以获得更好的理解。这是我使用的：

找什么：

```
{[^:b^]}{\</(p|(h:z))\>}:b*$ 
```

用。。。来代替：

```
\1\n\2 
```

它只找到 p 和 h* 因为我发现只有这两个有这个问题。可以添加其他标签。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-03-12T15:14:26.913

你可以自定义每个标签的布局，如果它让你很困扰的话。转到选项对话框并选择文本编辑器下的格式选项 - > HTML

话虽如此，我不喜欢一些我无法修复的不一致，所以我停止使用它，除了在我开始工作之前重新格式化其他人的代码。完成初始重新格式化后，我手动维护格式化。

# asp.net - 如何将服务器端注销功能挂接到 ASP.Net 身份验证服务注销

> ID：639059
> 
> 赞同：0
> 
> 时间：2009-03-12T15:06:18.010
> 
> 标签：asp.net, authentication, service

Asp.net AJAX 身份验证服务提供了登录和注销方法。我可以配置成员资格提供程序，并且对 Login 的客户端调用将调用在成员资格提供程序中定义的服务器端 ValidateUser。到目前为止一切都很好。

但是，Logout 方法会调用内置服务的 Logout 方法，该方法基本上将 ASPXAUTH cookie 设置为空。

我如何挂钩此调用并编写一个服务器函数，在调用身份验证服务 Logout 时执行一些内务处理？

TIA

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-30T12:46:40.450

[AJAX 身份验证包装了表单身份验证，因此当表单身份验证的用户未通过身份](https://stackoverflow.com/questions/480681/event-to-capture-when-a-formsauthenticated-user-is-un-authenticated)验证时，这个问题可能是您可能会捕获的最佳事件

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-03-02T08:46:51.357

您不能覆盖[AuthenticationBase](http://msdn.microsoft.com/en-us/library/ff422449%28v=vs.91%29.aspx)类中的LogOut( [)](http://msdn.microsoft.com/en-us/library/ff423315%28v=vs.91%29.aspx)方法，但可以覆盖[ClearAuthenticationToken()](http://msdn.microsoft.com/en-us/library/ff423161%28v=vs.91%29.aspx)方法。您可以在那里执行任何服务器端逻辑。如果您需要用户名，请使用[GetUser()](http://msdn.microsoft.com/en-us/library/ff422990%28v=vs.91%29.aspx)方法。

* * *

## 回答 #3

> 赞同：-2
> 
> 时间：2009-04-30T12:39:01.653

也许 Global.asax 中的 Session_End 事件对你有帮助：http: [//www.codetoad.com/asp.net_globalasax.asp](http://www.codetoad.com/asp.net_globalasax.asp)

# google-analytics - 有谁知道解释谷歌分析结果的好指南/书？

> ID：639062
> 
> 赞同：-1
> 
> 时间：2009-03-12T15:07:09.677
> 
> 标签：google-analytics, traffic, web-traffic

我正在寻找解释 Google Analytics（分析）结果的指南。还有用于访问数据的 API 吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-12T15:11:16.640

> 我正在寻找解释 Google Analytics（分析）结果的指南。

我喜欢[高级网络指标](https://rads.stackoverflow.com/amzn/click/com/0470253126)；它派上用场了。如果您至少对一般分析包有所熟悉，建议您使用。否则选择更简单的东西，比如[Google Analytics 2.0](https://rads.stackoverflow.com/amzn/click/com/047017501X)。

> 还有用于访问数据的 API 吗？

[你可以在这里](http://code.google.com/apis/analytics/docs/gdata/gdataDeveloperGuide.html)找到 API

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-27T21:30:29.293

谷歌于 2009 年 4 月 21 日发布了一个分析 API。与谷歌一样，有一些警告：

*   它处于“公开测试版”中。每个人都可以使用它，但他们保留随时修改 API 的权利。
*   大多数（但并非所有）指标和维度都可用。在您开始进行高级组合之前，您几乎可以忽略这个事实。
*   只读访问。

他们提供完整的开发人员文档和 Google Analytics（分析）API 小组供讨论。

```
http://code.google.com/apis/analytics/ 
```

注意：作为新的 SO 用户，我无法为此答案添加任何相关链接，因此请随时编辑此帖子并将其添加。

# jquery - 从 jquery 对话框调用服务器函数

> ID：639063
> 
> 赞同：0
> 
> 时间：2009-03-12T15:07:10.177
> 
> 标签：jquery, dialog

目前我在我的 asp.net 内容页面上使用 jQuery（使用 master）。我正在使用 jquery 创建一个模式对话框。使用以下代码定义的 div

```
<div id="example" class="flora" title="Information" style="display:none; visibility:hidden; text-align:left;">
        <asp:Panel ID="Panel" runat="server">
            Is the information you have entered correct?<br />
            <asp:Label>Some labels filled when the modal appears</asp:Label> 
            <asp:button runat="server" OnClick="someServerSide_Function" Text="Submit" />
        </asp:Panel>
  </div> 
```

有一个 HTML 按钮被按下，当按下按钮时，它调用以下代码

```
$("#example").dialog("open"); 
```

模态是用以下代码定义的：

```
$("#example").dialog({
                autoOpen: false, 
                modal: true,
                height: 400,
                overlay: overlayCss,
                bgiframe: true
            }); 
```

单击 HTML 按钮时，Modal 会被填充，而 ASP.NET 按钮在单击时不会调用其服务器端函数。Example div 位于标签内，因此它应该调用服务器端函数。有什么问题？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-12T15:10:55.690

可能没有足够的信息来帮助你......但试试这个链接。

[http://encosia.com/2008/05/29/using-jquery-to-directly-call-aspnet-ajax-page-methods/](http://encosia.com/2008/05/29/using-jquery-to-directly-call-aspnet-ajax-page-methods/)

编辑：

看来这个问题已被编辑，所以我将编辑我的答案......

如果您希望按钮从 jquery 调用服务器端方法而不发布页面，请使用上述方法。

现在看来，您将正确地调用服务器端方法。（整个页面都会提交。）

您是否在服务器端方法中设置了一个断点并确保它被调用（调试）？

如果没有看到更多的代码隐藏，真的可能会有很多错误。

您还可以使用 Onit 事件将页面与类似的东西连接起来

```
this.Button1+=new EventHandler(Button1_Click); 
```

（在为您的按钮提供“Button1”的 ID 后）

# php - 在 Twitter 徽章中传递给 flash 变量的颜色代码

> ID：639068
> 
> 赞同：2
> 
> 时间：2009-03-12T15:09:05.243
> 
> 标签：php, flash, twitter

我正在尝试创建一个简单的界面来自动为 WordPress 主题创建 Flash twitter 徽章。

我的问题是，在[具有简单颜色定制器的推特页面上](http://twitter.com/widgets/compact_flash_widget)，标准的十六进制颜色代码被转换为要作为变量传递给闪存的东西。

任何人都可以阐明该颜色代码系统是什么吗？可能我如何编写一个 PHP 函数来将六位十六进制代码转换到该系统中？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-12T15:19:16.160

他们将十六进制颜色值作为十进制传递。例如：

```
(16711680)base10 = (FF0000)base16 = (red)base-layman
(0)base10        = (0)base16      = (black)base-layman 
```

据我所知，您不需要 PHP 中的任何特殊魔法。这是表示问题，而不是编码问题。

希望有帮助！

# sql - SQL 查询以计算表中正确的提前期 (MS Access)

> ID：639070
> 
> 赞同：1
> 
> 时间：2009-03-12T15:09:39.627
> 
> 标签：sql, ms-access

我有下表：`log(productId, status, statusDate, department...)`，其中 productId、status 和 statusDate 是主键。示例：

id1 01 01/01/2009
id1 02 02/01/2009
**id1 03 03/01/2009**
id1 01 06/01/2009
id1 02 07/01/2009
**id1 03 09/01/2009**
id2 01 02/01/ 2009
id2 02 03/01/2009
id2 01 04/01/2009
**id2 03 06/01/2009**
id3 01 03/01/2009
id3 02 04/01/2009

我想做一个查询，检索 status03 中的每个 productId，第一次达到 status01 和 status03 之间经过的时间。预期结果：

id1 2
id1 3
id2 4

知道吗？谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-12T16:12:07.483

怎么样：

```
SELECT t.ID, t.Status, t.SDateTime, 
    (SELECT Top 1 SDateTime 
     FROM t t1 WHERE t1.Status = 1 
     AND t1.ID=t.ID 
     AND t1.SDateTime<t.SDateTime 
     AND t1.SDateTime>=
         Nz((SELECT Top 1 SDateTime 
             FROM t t2 
             WHERE t2.Status=3 
             AND t2.ID=t.ID 
             AND t2.SDateTime<t.SDateTime),0)) AS DateStart, 
[SDateTime]-[DateStart] AS Result
FROM t
WHERE t.Status=3 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-12T17:03:26.533

我喜欢这样的东西。看起来它比迄今为止建议的其他两个答案中的任何一个都复杂。这是一个可行的解决方案。我为讨厌的格式道歉。此外，这将在 SQL Server 中工作，但我并没有永远使用 Access，所以你可能需要稍微调整一下才能在那里工作。或者，如果 Access 不支持非等值连接，它可能根本不起作用。

```
SELECT productId, MAX(tbl.TimeBetween)
FROM
 (SELECT status_1.productId as productId, status_1.statusDate as status1Date, MIN(status_3.statusDate) as status3Date, DATEDIFF(m,status_1.statusDate, MIN(status_3.statusDate)) as TimeBetween
  FROM 
  (SELECT productId, status, statusDate
    FROM log
    WHERE status = '01') status_1
  INNER JOIN
  (SELECT productId, status, statusDate
   FROM log
   WHERE status = '03') status_3
  ON status_1.productId = status_3.productId AND status_3.statusDate > status_1.statusDate
  GROUP BY status_1.productId, status_1.statusDate) tbl
GROUP BY productId, status3Date
ORDER BY productId, TimeBetween 
```

1.  最里面的选择获取每个状态的记录。
2.  然后将它们连接起来以提供大于相应“01”记录的“03”状态记录（您多久使用一次非等值连接？）
3.  然后过滤它们以给出仍在相应“01”记录之后的MIN“03”记录。
4.  The outermost select enforces your 'first time it reached '01' status rule' since it may go to '01' status multiple times before reaching '03' status.

If someone else has a more elegant solution, I'd love to see it. I have had to write similar queries to this in the past, and I'd love to see a better solution to this type of problem.

* * *

## 回答 #3

> 赞同：-3
> 
> 时间：2009-03-12T15:27:18.137

这将在 Sql Server 中工作。您可能需要为 Access 翻译其中的部分内容：

```
SELECT l3.productID, DATEDIFF(d,COALESCE(l1.statusDate,l3.statusDate),l3.statusDate) AS LeadTime
FROM log l3
LEFT JOIN log l1 ON l1.productID=l3.productID AND l1.Status='01'
    AND l1.statusDate = 
      (
         SELECT TOP 1 statusDate 
         FROM log lsub 
         WHERE lsub.Status='01' AND lsub.productID=l1.productID AND l1.statusDate<l3.StatusDate
         ORDER BY statusDate DESC
      )
WHERE l3.Status='03' 
```

# database - 聚集索引与索引查找

> ID：639071
> 
> 赞同：2
> 
> 时间：2009-03-12T15:09:49.670
> 
> 标签：database, indexing

聚集索引和索引查找之间的主要区别是什么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-12T15:24:10.390

[聚集索引](http://en.wikipedia.org/wiki/Index_(database)#Clustered)以物理方式将索引按排序顺序放置在磁盘上，因此可以更快地浏览它们。最好用于按排序顺序迭代索引，因为磁盘查找将是连续的。

索引查找只是一种查找索引的方式。这可能是[b+tree](http://en.wikipedia.org/wiki/B%2B_tree)，[hash](http://en.wikipedia.org/wiki/Hash_table)，任何可以查找索引的方法。

可以对聚集索引进行索引搜索，它们不是互斥的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-12T15:17:56.707

非聚集索引是一种索引，索引的每个叶节点都指向对应表中的一行。

聚集索引是一种索引，其中索引的每个叶节点*都是*对应表中的行。显然，任何给定的表只能有一个聚集索引（但不一定是一个）。

索引查找是一种在表中查找行的方法，在该表中查询索引，找到指向各个行的各个指针，并且仅将包含相应行的页面加载到内存中。如果预期的行数很少，并且如果它们倾向于聚集在几个页面上而不是分散在表中的所有页面上，则索引查找是一种在查询中查找行的有效方法。

# java - 用于java的简单ID到值映射表的高效持久存储

> ID：639077
> 
> 赞同：5
> 
> 时间：2009-03-12T15:11:36.593
> 
> 标签：java, data-structures, persistence

我需要存储一些数据，这些数据遵循将“id”映射到包含多个列（即一些整数值 [u、v、w]）的完整表（具有多行）的简单模式。其中一张表的大小为几 KB。基本上我需要的是存储一些中间结果的持久缓存。

这可以很容易地实现为简单的 sql，但是有几个问题，即我需要尽可能地压缩磁盘上这个结构的大小。（因为我要存储的值的数量）另外，它不是事务性的，我只需要编写一次并简单地读取整个表的内容，因此关系数据库实际上并不是一个很好的选择。

我想知道是否有人有任何好的建议？出于某种原因，我似乎无法想出一些像样的自动取款机。尤其是在 java 中有 API 的东西会很好。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-12T15:28:42.143

这听起来像是……的工作`new ObjectOutputStream(new FileOutputStream(STORAGE_DIR + "/" + key + ".dat");`！

说真的 - 最简单的方法是为每个要存储的数据表创建一个文件，将数据序列化并在要读取时使用密钥作为文件名进行查找。

在一个像样的文件系统上，写入可以是原子的（通过写入临时文件然后重命名文件）；读/写速度以 10 秒 MBit/秒为单位；通过创建一个简单的目录树可以使查找变得非常有效，例如`STORAGE_DIR + "/" + key.substring(0,2) + "/" + key.substring(0,4) + "/" + key`对于数百万个条目应该仍然有效，如果您的文件系统使用索引目录则效率更高；最后，在此之上实现内存支持的 LRU 缓存以实现更快的检索是微不足道的。

关于压缩 - 您可以在存储数据之前使用 Jakarta 的 commons-compress 对数据进行 gzip 甚至 bzip2 压缩。但这是一个优化问题，根据您的应用程序和可用磁盘空间，您最好将 CPU 周期投入到其他地方。

这是我制作的示例实现：http: [//geek.co.il/articles/geek-storage.zip](http://geek.co.il/articles/geek-storage.zip)。它使用一个简单的接口（远非干净——它只是一个概念的演示），它提供了从具有设定的最大大小的缓存中存储和检索对象的方法。缓存未命中被转移到用户实现进行处理，缓存会定期检查它没有超过存储要求，并会删除旧数据。

我还包括了一个 MySQL 支持的实现来完成和一个基准来比较基于磁盘和基于 MySQL 的实现。在我的家用机器（旧的 Athlon 64）上，磁盘基准测试的得分比封闭基准测试中的 MySQL 实现快两倍（9.01 秒对 18.17 秒）。尽管 DB 实现可能可以调整以获得稍微更好的性能，但我相信它足以很好地说明问题。

您可以随意使用它。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-12T15:29:31.080

我会使用[EHCache](http://ehcache.sourceforge.net)，它被 Hibernate 和其他 Java EE 库使用，并且非常简单高效：

添加表格：

```
List<List<Integer>> myTable = new(...)
cache.put(new Element("myId", myTable)); 
```

读书：

```
List<List<Integer>> myTable = (List<List<Integer>>) cache.get("myId").getObjectValue(); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-12T15:14:54.183

你看过[伯克利数据库](http://en.wikipedia.org/wiki/Berkeley_DB)吗？听起来它可能符合要求。

* * *

编辑：

我忘了补充，您可以在存储值之前自行对值进行 gzip 压缩。然后在检索它们时解压缩它们。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-12T15:47:20.193

如果您想要嵌入的东西（而不是单独的服务器），[Apache Derby可能是一个不错的选择。](http://db.apache.org/derby/)

[在 Java 中的轻量级数据库中](http://aurora.regenstrief.org/~schadow/dbm-java/)有其他选项列表

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-12T16:09:50.483

看来*Key=>Value Databases*是您要搜索的东西。

也许[SuperCSV](http://supercsv.sourceforge.net/)是最适合您的框架！

如果您不想使用关系数据库，可以使用[JAXB](http://jaxb.java.net/)将您的对象存储为 XML 文件！

还有一种方法可以与[XStream等其他库一起使用](http://xstream.codehaus.org/persistence-tutorial.html)

如果您更喜欢 XML，请使用 JAXB 或 XStream。否则，您应该查看 CSV 库，例如 SuperCSV。可以使用序列化 java 文件的人可以使用 Guss 所说的默认持久性机制。直接 Java 持久性可能是最快的方法。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-03T22:59:28.810

您可以使用 JOAFIP [http://joafip.sourceforge.net/](http://joafip.sourceforge.net/) 它使您能够将所有数据模型放在文件中，您可以访问它、更新它，而无需重新加载所有内存。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-04T11:00:48.683

如果你有几 KB，我不明白你为什么需要“尽可能压缩磁盘上这个结构的大小”鉴于 181 MB 的磁盘空间需要 1 美分，我建议任何小于这个的不值得花太多时间担心。

但是，要回答您的问题，您可以在编写文件时对其进行压缩。除了 ObjectOutputStream，您还可以使用 XMLExcoder 来序列化您的地图。这将比仅使用 ObjectOutputStream 更紧凑，并且如果您解压缩文件，您将能够读取或编辑数据。

```
XMLEncoder xe = new XMLEncoder(
    new GZIPOutputStream(
        new FileOutputStream(filename+".xml.gz")));
xe.writeObject(map);
xe.close(); 
```

# python - 无法通过 AWK/Python/Bash 以随机顺序搜索包含三个 7 的名称

> ID：639078
> 
> 赞同：0
> 
> 时间：2009-03-12T15:11:45.657
> 
> 标签：python, regex, bash, awk

我需要以随机顺序查找包含三个数字 7 的名称。

**我的尝试**

我们需要找到不包含七个的名字

```
ls | grep [^7] 
```

然后，我们可以从整个空间中删除这些匹配项

```
ls [remove] ls | grep [^7] 
```

我的伪代码中的问题开始迅速重复。

**如何通过 AWK/Python/Bash 以随机顺序找到包含三个 7 的名称？**

**[编辑]** 该名称可以包含任意数量的字母，并且包含三个 7 的单词。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-12T15:15:27.567

我不明白关于“随机顺序”的部分。当重复的标记相同时，您如何区分“顺序”？“a7b7”与“c7d7”在7s的顺序上是否不同？

无论如何，这应该工作：

```
 ls *7*7*7* 
```

它只是让shell解决问题，但也许我没有正确理解。

编辑：以上是错误的，它包括不想要的超过四个 7 的情况。假设这是 bash，并且启用了扩展的 globbing，则此方法有效：

```
ls *([^7])7*([^7])7*([^7])7*([^7]) 
```

这读作“零个或多个不是七的字符，然后是一个七，然后是零个或多个不是七的字符”，依此类推。重要的是要理解星号在这里是*前缀*运算符，对`([^7])`表示“除 7 之外的任何字符”的表达式进行操作。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-12T15:35:32.110

我猜你想找到正好包含三个 7 的文件，但没有更多。将 gnu grep 与扩展正则表达式开关 ( `-E`) 一起使用：

```
 ls | grep -E '^([^7]*7){3}[^7]*$' 
```

应该做的伎俩。

基本上匹配 3 次出现的“非 7 后跟 7”，然后是整个字符串中的一堆“非 7”（分别位于模式开头和结尾的 ^ 和 $）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-12T16:31:29.433

像这样的东西：

```
printf '%s\n' *|awk -F7 NF==4 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-12T16:53:43.140

Perl 解决方案：

```
$ ls | perl -ne 'print if (tr/7/7/ == 3)'
3777
4777
5777
6777
7077
7177
7277
7377
7477
7577
7677
... 
```

（我碰巧有一个带有 4 位数字的目录。1777 和 2777 不存在。:-)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-12T16:39:21.427

或者，不要在单个 grep 中执行此操作，而是使用一个 grep 查找具有 3 个或更多 7 的文件，另一个用于过滤掉 4 个或更多 7 的文件。

```
ls -f | egrep '7.*7.*7' | grep -v '7.*7.*7.*7' 
```

您可以将一些工作移到较短的 shell glob 中

```
ls -f *7*7*7* | grep -v '7.*7.*7.*7' 
```

虽然如果有大量文件与该模式匹配，那么后者将无法工作，因为对 glob 大小的内置限制。

'ls' 中的 '-f' 是为了防止 'ls' 对结果进行排序。如果目录中有大量文件，那么排序时间可能会非常明显。

我认为这个两步过滤过程比使用 [^7] 模式更容易理解。

此外，这是作为 Python 脚本的解决方案，因为您要求将其作为选项。

```
import os
for filename in os.listdir("."):
    if filename.count("7") == 4:
        print filename 
```

这将处理一些 shell 命令不会处理的情况，例如包含换行符的（邪恶）文件名。尽管即使在这里，这种情况下的输出可能仍然是错误的，或者至少下游程序没有准备好。

# macos - 执行 Mac 包时运行脚本

> ID：639083
> 
> 赞同：0
> 
> 时间：2009-03-12T15:12:35.187
> 
> 标签：macos

我有一个标准 .app 格式的 Mac OS X 应用程序，想知道在主程序之前执行小脚本的最简单方法是什么。那可能吗？

**编辑：**

我只想运行一次脚本，所以如果我可以在它运行后设置一个标志或其他东西，那就太好了！

**第二次编辑：**

我没有 XCode 项目，所以我无法重新编译任何东西，这就是我寻找另一种方法的原因。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-12T15:29:14.933

两种可能：

*   如果您有权访问 Xcode 项目，则可以将脚本放在应用程序的资源中，获取其路径名：

    ```
    [[NSBundle mainBundle] pathForResource:@"preamble" ofType:@"sh"] 
    ```

    `system()`并在函数开始时通过简单的调用来调用它`main()`。

*   如果您无权访问 Xcode 项目，我不确定是否可以。我会尝试用您的脚本替换实际的可执行文件，并添加一种在脚本末尾使用`exec`命令调用可执行文件的方法。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-12T16:05:07.420

如果应用程序相对简单，您可以将其重新打包到另一个包中。您可以编写一个简短的程序来运行脚本，然后启动它们的可执行文件，您希望将其作为资源包含在您的包中。

当然，您还需要从应用程序中复制所有原始资源。

请问您要以这种方式运行哪个程序？

# mysql - 在 MySQL 中创建存储过程时出现 SQL 语法错误

> ID：639089
> 
> 赞同：12
> 
> 时间：2009-03-12T15:14:06.823
> 
> 标签：mysql, stored-procedures

尝试在 mysql 中创建存储过程时，我很难找到错误。

如果我独立运行程序的每一行，一切都会很好。

```
CREATE PROCEDURE cms_proc_add_child 
(
    param_parent_id INT, param_name CHAR(255),
    param_content_type CHAR(255)
)
BEGIN
    SELECT @child_left := rgt FROM cms_tree WHERE id = param_parent_id;
    UPDATE cms_tree SET rgt = rgt+2 WHERE rgt >= @child_left;
    UPDATE cms_tree SET lft = lft+2 WHERE lft >= @child_left;
    INSERT INTO cms_tree (name, lft, rgt, content_type) VALUES 
    (
        param_name,
        @child_left,
        @child_left+1,
        param_content_type
    );
END 
```

我收到以下（有用的）错误：

> ERROR 1064 (42000)：您的 SQL 语法有错误；检查与您的 MySQL 服务器版本相对应的手册，以在第 3 行的 '' 附近使用正确的语法

我只是不知道从哪里开始调试，因为这些行中的每一行都是正确的。

你有什么建议吗？

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2009-03-12T16:12:30.040

由于第 3 行包含第一行`;`，您的分隔符可能有问题。

见[http://dev.mysql.com/doc/refman/5.0/en/stored-programs-defining.html](http://dev.mysql.com/doc/refman/5.0/en/stored-programs-defining.html)

```
DELIMITER //
CREATE PROCEDURE dorepeat(p1 INT)
BEGIN
    SET @x = 0;
    REPEAT SET @x = @x + 1; UNTIL @x > p1 END REPEAT;
END//
DELIMITER ; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-12T15:18:32.633

你永远不会声明你的 @child_left 变量。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-02T01:01:19.773

谢谢，***第 3 行的 '' 附近***是我的问题，分隔符语句修复了它！我总是希望事情有意义，而这确实如此。因为 '' 表示它在过程的末尾，但没有找到 END 语句，因此出现语法错误。我想知道为什么我一直看到很多人使用分隔符语句。我看见了光！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2021-05-03T17:36:14.693

如果您遇到一堆不能同时运行但可以单独成功运行的过程的问题，请尝试使用`Go`命令将它们分开。

前任：

```
--i)
CREATE PROCEDURE A
AS
BEGIN
END;
GO 

--ii)
CREATE PROCEDURE B
AS
BEGIN
END; 
```

# c# - 页面上的计数控件

> ID：639093
> 
> 赞同：1
> 
> 时间：2009-03-12T15:15:07.757
> 
> 标签：c#, asp.net

我的问题是，我想计算页面上的控件，然后获取它们的类型，如果有文本框、复选框或组合框，然后让它们启用或禁用？网上有没有例子？

谢谢

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-12T15:18:06.863

这将是一项昂贵的操作，因为您必须递归地遍历页面的控件集合来检查每个控件。也许您不知道 ASP.NET 将`Disabled`属性从父级级联到子级？换句话说，如果您将父控件设置为禁用，则所有子输入控件也将被禁用。

**编辑：**如果你*真的*想这样做，那么这是最好的方法：

```
protected override void OnPreRender(EventArgs e)
{
    base.OnPreRender(e);

    int count = 0;

    this.disableControls(this, ref count);
}

void disableControls(Control control, ref int count)
{
    foreach (Control c in control.Controls)
    {
        WebControl wc = c as WebControl;

        if (wc != null)
        {
            count++;
            wc.Enabled = false;             
        }

        this.disableControls(c, ref count);
    }
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-12T15:20:24.253

您可以使用如下方法：

```
public int CountControls(Control top)
{
    int cnt = 1;
    foreach (Control c in top.Controls)
        cnt += CountControls(c);
    return cnt;
} 
```

但正如安德鲁所说，这将是昂贵的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-12T15:22:04.857

```
private void ChangeControlStatus(ControlCollection col, bool status)
 {
    foreach (Control ctrl in col)
        ChangeControlStatus(ctrl.Controls, status)

          if (ctrl is TextBox)

            ((TextBox)ctrl).Enabled = status;

          else if (ctrl is Button)

            ((Button)ctrl).Enabled = status;

          else if (ctrl is RadioButton)

            ((RadioButton)ctrl).Enabled = status;

          else if (ctrl is ImageButton)

            ((ImageButton)ctrl).Enabled = status;

          else if (ctrl is CheckBox)

            ((CheckBox)ctrl).Enabled = status;

          else if (ctrl is DropDownList)

            ((DropDownList)ctrl).Enabled = status; 

       else if (ctrl is HyperLink)

        ((HyperLink)ctrl).Enabled = status; 

 } 
```

# c++ - 指向成员函数的指针 - C++ std::list 排序

> ID：639100
> 
> 赞同：5
> 
> 时间：2009-03-12T15:16:26.253
> 
> 标签：c++, list, comparison

如何将指向成员函数的指针传递给 std::list.sort()？

这可能吗？谢谢

```
struct Node {
       uint32_t ID;
       char *   Value;
};

class myClass {
          private:
            uint32_t  myValueLength;
          public:
            list<queueNode *> MyQueue;
            bool compare(Node * first, Node * second);
            bool doStuff();
}

bool myClass::compare(Node * first, Node * second) {
    unsigned int ii =0;
    while (ii < myValueLength)
    {
        if (first-> Value[ii] < second-> Value[ii]) 
        {
            return true;
        } else if (first-> Value[ii] > second-> Value[ii])
        {
            return false;
        }

        ++ii;
    }

    return false;
}

bool myClass::doStuff()
{
    list.sort(compare);
} 
```

我想在类中使用长度变量，而不是在比较函数中执行 strlen() （值总是相同的长度）

编辑： myValueLength 不是我想从比较函数中访问的唯一变量，我只是简化了它以使示例更短。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-12T16:25:36.343

详细说明[grieve 的](https://stackoverflow.com/questions/639100/pointer-to-member-functions-c-stdlist-sort/639112#639112)反应，为什么不使用函子？例如：

```
struct Functor
{
  bool operator()( char * a, char * b )
    { return strcmp(a,b) < 0; }
}; 
```

然后你可以使用：

```
Functor f;
myList.sort(f); 
```

你甚至可以通过定义 operator() 来使用你的类作为 Functor...

```
class myClass {
  ...
  bool operator()( queueNode * a, queueNode * b )
  { return compare( a, b ); }

  void doStuff() { MyQueue.sort(*this); }
}; 
```

* * *

简单示例代码：

```
#include <iostream>
#include <list>
using namespace std;

  // Assumes  TYPE t; cout << t;  is valid.
template<class TYPE>
inline ostream & operator<< ( ostream & theOstream,
                              const list<TYPE> & theList )
{
  typename list<TYPE>::const_iterator listIterator = theList.begin();
  for ( int i = 0;   listIterator != theList.end();  listIterator ++, i ++ )
    theOstream << "    [" << i << "]:   \"" << (*listIterator) << "\"" << endl;
  return theOstream;
}

struct Functor
{
  bool operator()( const char * a, const char * b )
    { return strcmp(a,b) < 0; }
};

int
main()
{
  list<char*>  l;

    /* Load up some example test data... */
  char  s[3];
  s[2] = '\0';
  for (   s[0]='c'; s[0]>='a'; s[0]-- )
    for ( s[1]='c'; s[1]>='a'; s[1]--  )
      l.push_back(strdup(s));

    /* Show us that test data... */
  cout << l << endl;

    /* Sort list. */
  Functor f;
  l.sort(f);

    /* Show us what we have now... */
  cout << l << endl;
} 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-12T15:26:00.743

有可能的。你考虑过使用 boost::function 吗？

```
list.sort( boost::bind( &myClass::compare, this, _1, _2 ) ); 
```

您的“比较”功能是否会依赖**这些**数据？如果不是 - 您可以简单地将“比较”功能设置为**static**。然后它将是

```
list.sort( &myClass::compare ); 
```

您可以添加辅助结构来进行比较，然后

```
list.sort( Comparer( myValueLength ) );

struct Comparer
{
    Comparer( uint32_t myValueLength ):
        length( myValueLength )
    {}

    bool operator() (Node * first, Node * second)
    {
        unsigned int ii =0;
        while (ii < length)
        {
            if (first-> Value[ii] < second-> Value[ii]) 
            {
                    return true;
            } else if (first-> Value[ii] > second-> Value[ii])
            {
                    return false;
            }

            ++ii;
        }

        return false;
    }

    uint32_t length;
}; 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-12T15:18:51.307

您可能想要使用仿函数。

[http://www.newty.de/fpt/functor.html](http://www.newty.de/fpt/functor.html)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-12T15:23:17.507

请注意，`std::list`根据为该`operator<`元素定义的元素对元素进行排序。您需要更改`compare`函数以使用为对象`operator<`定义的全局：`Node`

```
bool operator<(Node const& first, Node const& second) {
unsigned int ii =0;
while (ii < length)
{
    if (first.Value[ii] < second.Value[ii]) 
    {
            return true;
    } else if (first.Value[ii] > second.Value[ii])
    {
            return false;
    }

    ++ii; 
}

return false; 
```

}

建议的改进是：

```
bool operator<(Node const& first, Node const& second) {
    for (size_t ii =0; first.Value[ii] == second.Value[ii]; ++ii) ; // note ;
    return (first.Value[ii] < second.Value[ii]);
} 
```

如果`char *Value`真的代表一个 C 风格的字符串，并且您想要字典排序，则可以进一步改进：

```
bool operator<(Node const& first, Node const& second) {
     return (strcmp(first.Value, second.Value) < 0);
} 
```

如果它们真的是字符串，我建议你使用`std::string`，你可以写：

```
bool operator<(Node const& first, Node const& second) {
     return first.Value < second.Value;
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-12T16:32:06.437

正如 grieve 和 mrree 所建议的那样

简单地重载 () 运算符就可以了

感谢所有回答的人

```
struct Node {
       uint32_t ID;
       char     *       Value;
};

class myClass {
          private:
            uint32_t  myValueLength;
          public:
            list<queueNode *> MyQueue;
            bool operator()(Node * first, Node * second);
            bool doStuff();
}

bool myClass::operator()(Node * first, Node * second) {
    unsigned int ii =0;
    while (ii < myValueLength)
    {
        if (first-> Value[ii] < second-> Value[ii]) 
        {
                return true;
        } else if (first-> Value[ii] > second-> Value[ii])
        {
                return false;
        }

        ++ii;
    }

    return false;
}

bool myClass::doStuff()
{
    list.sort(*this);
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-03-02T05:17:26.417

为什么不让你的比较函数静态，那么你就不再需要仿函数了。然后你可以简单地做 list.sort(compare);

没关系...我刚刚意识到您的比较函数正在使用类数据成员，因此它不能是静态的。使用函子:)

# excel - 如何在 Excel 单元格内填零

> ID：639120
> 
> 赞同：17
> 
> 时间：2009-03-12T15:20:24.893
> 
> 标签：excel, formatting, worksheet-function

如何在 Excel 电子表格中将数字填零到 10 个位置？

即如果单元格A1 有1234 单元格A2 如何显示0000001234（10 个职位）。

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2009-03-12T15:25:56.813

=文本（A1，“0000000000”）

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-03-12T15:26:10.573

不是编程问题，真的：

1.  选择要以这种方式格式化的单元格。
2.  右键单击并选择“格式化单元格...”
3.  选择“数字”标签，然后在类别列表中向下滚动到“自定义”。
4.  在类型字段中输入“0000000000”。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-03-12T15:23:44.930

格式>单元格...>数字>自定义>类型>0000000000

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2011-04-15T08:56:46.153

这个公式是可变的。

它检查值的长度并在前面添加“0”

现在长度为 10。您可以更改它。

```
=REPT("0",10-LEN(A1))&A1 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2014-09-26T02:08:04.203

我知道这是一篇很老的帖子，但是我在将 sql 表导出到 excel 时遇到了同样的问题，我发现我的解决方案非常简单！只需将单元格格式设置为“自定义”，然后输入您希望最终数字具有的字符数；在你的情况下 10 个职位 '0000000000' 我通常不会回复 stackoverflow 的帖子，所以我没有足够的声誉来发布图片；

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-12T15:25:06.923

类似于以下内容。

```
right( "0000000000" & number, 10 ) 
```

在左边放 10 个零，取最右边的 10 个位置，不管结果如何。

另外，你有

```
text( number, "0000000000" ) 
```

* * *

## 回答 #7

> 赞同：-2
> 
> 时间：2012-10-15T03:30:12.967

如何在excel工作表中显示完整的数字？

即单元格A1“2.40252E+13”如何在A1中显示全数变成“24025207702012”

# c# - 在单声道中加密 web.config 的配置部分

> ID：639125
> 
> 赞同：3
> 
> 时间：2009-03-12T15:21:40.600
> 
> 标签：c#, .net, encryption, mono

我看到可以使用 ASP_regiis 来加密 web.config 文件的部分，但我在使用 Apache 的机器上运行单声道。在 Mono/Linux 中有没有办法做到这一点？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-15T09:49:27.507

您可以使用 System.Configuration.ConfigurationManager 以编程方式执行此操作，以获取 ConfigurationSection 对象并在其上调用 SectionInformation.ProtecteSection("DataProtectionConfigurationProvider")

```
 /// <summary>
    /// Encrypts a Config section from the given Configuration object
    /// </summary>
    /// <param name="sectionKey">Path to the section to Encrypt</param>
    /// <param name="config">Configuration</param>
    public static void EncryptConfigSection(String sectionKey, Configuration config)
    {
        ConfigurationSection section = config.GetSection(sectionKey);
        if (section != null)
        {
            if (!section.SectionInformation.IsProtected)
            {
                if (!section.ElementInformation.IsLocked)
                {
                    section.SectionInformation.ProtectSection("DataProtectionConfigurationProvider");
                    section.SectionInformation.ForceSave = true;
                    config.Save(ConfigurationSaveMode.Full);
                }
            }
        }
    } 
```

对于 Web 配置，您需要使用 System.Web.Configuration.WebConfigurationManager 来获取配置对象，然后您可以将其传递给上述函数。请注意，对于 web.config 文件，只有某些部分是可加密的。

另请注意，如果设置存储在 AppSettings 中，那么任何人都可以编写一个简单的应用程序，当在您的服务器上运行时，只要他们知道您的设置名称，就可以检索设置的纯文本值。

查看 Jon Galloway 撰写的以下关于简单加密 AppSettings 部分的替代方法的文章：[http ://weblogs.asp.net/jgalloway/archive/2008/04/13/encrypting-passwords-in-a-net-app-config -文件.aspx](http://weblogs.asp.net/jgalloway/archive/2008/04/13/encrypting-passwords-in-a-net-app-config-file.aspx)

* * *

## 回答 #2

> 赞同：-2
> 
> 时间：2009-03-12T15:36:28.817

除非我弄错了，否则 IIS 不会提供 Web.Config 文件。如果您担心人们将其从网络上拉下来，我相信您可以阻止该文件由 Apache 提供。

如果您谈论的是本地安全，我认为没有“好”的方法可以做到这一点。假设您在 Web.Config 中有密码，正确加密的唯一方法是要求另一个密码来解密文件。所以本质上，因为（我假设）你需要以编程方式访问文件，你只是移动你存储密码的地方，从 Web.Config 到源代码或另一个外部文件，这真的不会为你带来任何好处. 所有其他不需要密码来解密的加密方法只会掩盖文件，但很容易被掩盖。

阅读这篇关于 Pidgin（以前的 gaim）在本地存储密码的文章[http://developer.pidgin.im/wiki/PlainTextPasswords](http://developer.pidgin.im/wiki/PlainTextPasswords)。此外[，这篇](http://en.wikipedia.org/wiki/Key_(cryptography)#Need_for_secrecy)关于加密密钥的维基百科文章可能很有用。[两者都通过模糊性](http://en.wikipedia.org/wiki/Security_through_obscurity)讨论了安全性的固有局限性。

本质上，如果您在本地锁定文件，请使用基于用户帐户的安全性来执行此操作，即限制对文件的读/写访问。

# c# - 从 lucene 查询字符串中获取字段名称

> ID：639128
> 
> 赞同：0
> 
> 时间：2009-03-12T15:21:59.303
> 
> 标签：c#, .net, asp.net-mvc, lucene

如果我有一个 Lucene 查询字符串

```
"field1:value1 myField:aValue" 
```

有没有办法让 Lucene 解析这个以便我可以获得术语查询？
我最终希望能够将字段名称及其值返回到我的视图数据中，以便我可以在回发时将它们填充到我的文本框中。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-14T13:23:09.457

lucene`QueryParser`会将该字符串转换为`BooleanQuery`包含两个`TermQuery`子句的字符串。您需要使用 的[`getClauses`](http://incubator.apache.org/lucene.net/docs/2.1/Lucene.Net.Search.BooleanQuery.GetClauses.html)方法`BooleanQuery`来获取术语查询。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2016-12-13T08:48:36.317

我面临类似的要求，但查询可以是通用的。想出了下面的方法（在java中实现）。完整代码[https://github.com/atulsm/Test_Projects/blob/master/src/TestLuceneQueryStringFields.java](https://github.com/atulsm/Test_Projects/blob/master/src/TestLuceneQueryStringFields.java)

```
private static Set<String> calculateQueryFieldsRecursively(Query query) throws ParseException{
    Set<String> fields = new HashSet<String>();

    if(query instanceof TermQuery){
        TermQuery tQuery = (TermQuery)query;            
        Term term = tQuery.getTerm();
        fields.add(term.field());
    } else if(query instanceof BooleanQuery){
        BooleanQuery bQuery = (BooleanQuery)query;
        List<BooleanClause> clauses = bQuery.clauses();
        for(BooleanClause clause: clauses){
            Query innerQuery = clause.getQuery();
            Set<String> innerFields = calculateQueryFieldsRecursively(innerQuery);
            if(innerFields == null){
                return null;
            }else{
                fields.addAll(innerFields);
            }
        }
    } else { //TODO support more lucene query types
        return null;
    }   
    return fields;
} 
```

# sql - SSIS 派生列缺少下游

> ID：639137
> 
> 赞同：1
> 
> 时间：2009-03-12T15:23:14.790
> 
> 标签：sql, sql-server-2005, ssis

我创建了一个派生列，将 1 转换为“M”，将 2 转换为“F”。即性别指标。派生列馈入模糊查找转换，然后馈入条件拆分。问题是派生字段没有出现在任何下游组件中。在模糊查找转换中，派生列的“通过”复选框被选中，但在以下条件拆分转换中，该列根本不显示。有趣的是，_Similarity_Gender_Derived 确实出现在条件拆分的列列表中。

希望其他人已经看到了这种行为。

谢谢-Do先生

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-12T16:29:21.577

1.  右键单击 Fuzzy Lookup 任务并选择 Show Advanced Editor。
2.  转到“输入和输出属性”选项卡。
3.  展开“输出”项，然后展开“输出列”项。
4.  您的派生列是否列在那里？

如果是，它也应该显示在 Conditional Split 任务的可用输入列上。如果不 ...

1.  右键单击派生列任务并选择显示高级编辑器。
2.  转到“输入和输出属性”选项卡。
3.  展开“Derived Column Output”项，然后展开“Output Columns”项，然后选择您的派生性别列。
4.  注意它的 LineageID 属性。
5.  重复前面的步骤以获得模糊查找的输出列。
6.  点击“添加列”按钮。将该列命名为与派生列相同的名称，并在“SourceInputColumnLineageID”属性中输入您之前记下的 LineageID。

替代答案：您的派生列是创建一个全新的列，还是只是替换您现有的“1/2”列？在派生列编辑器中，检查您的“派生列”.. umm .. 列。如果您只是用新值替换现有列（而不是添加新列），您可能只是在寻找错误的位置。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-12T18:48:40.413

感谢您的回复。事实证明，该问题与元数据的某些损坏有关。我最终回到派生列转换，错误地重命名了列，然后用旧名称添加了一个新的派生列。我保存了转换，然后删除了原始列。这解决了问题。

感谢您的回复。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-12T15:48:12.983

您是否将派生列添加到现有的转换链中？

如果您这样做了，那么很有可能将队列更靠后的转换之一设置为不传递这个新派生的列。检查下面的所有转换，并确保您的派生列设置为通过。

# vba - 编写宏以重复使用转置函数

> ID：639140
> 
> 赞同：0
> 
> 时间：2009-03-12T15:23:30.157
> 
> 标签：vba, excel

我正在尝试将值行移动到 Excel 中的列中。转置功能效果很好，但一次只能移动一行。我想要一个宏，它将跨三列的 173 行数据转换为一列。请看下面的例子。提前感谢您的帮助。

行：

```
98,058 98,058 98,314
82,362 82,684 83,326
93,410 93,479 93,761

```

列：

```
98,058
98,058
98,314
82,362
82,684
83,326
93410
93479
93761

```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-12T16:42:35.943

下面将A1的CurrentRegion中的数据加载到一个数组中并粘贴到一个列中，从A5开始。

我假设数据是数字的、连续的，并且这是一次性的，而不是可能必须在不同大小的数据集上重复的练习。如果您的数据不连续，或者不受空单元格的约束，那么您可以改为对范围进行硬编码。

```
Private Sub transposeRows()
Dim inputRange As Variant
Dim myArray() As Long
Dim x As Long
Dim testCell As Range

'Get the range of data to copy'
Set inputRange = Range("A1").CurrentRegion

'Resize array to fit'
ReDim myArray(inputRange.Count - 1)

'Fill up array with data'
For Each testCell In inputRange
    myArray(x) = testCell
    x = x + 1
Next testCell

'Fill destination range'
Range("A5:A" & UBound(myArray) + 5) = WorksheetFunction.Transpose(myArray)

End Sub 
```

# sql-server-2005 - 如何强制 dbo 模式名称？

> ID：639141
> 
> 赞同：1
> 
> 时间：2009-03-12T15:23:40.907
> 
> 标签：sql-server-2005, managed, user-defined-functions

我在 VS 2008 中使用“SQL SERVER PROJECT”在 C# 中创建 UDF 然后我使用 DEPLOY 命令将 DLL 发布到 MS SQL Server 2005

除了所有创建的 UDF 都归我所有（作为用户）之外，所有工作都很好但我想保留 dbo 模式（例如：dbo.UDF_TEST - 不是 jonny.UDF_TEST）

知道如何管理 thar 吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-12T15:29:27.490

从数据库上的 sysadmin 或 dbo 帐户部署 UDF。您可以构建 dll，然后通过以 dbo 身份登录到管理工作室并运行以下命令来手动部署它：

> 从以下位置创建程序集地理编码
> 
> 'C:\PATH\YourUDF.dll' 与
> 
> PERMISSION_SET = 安全

或者

1.  在解决方案资源管理器的 Visual Studio 中，单击 UDF 项目（不是解决方案）。
2.  转到属性。
3.  单击数据库选项卡。
4.  您可以更改连接字符串，也可以在此处更改程序集所有者。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-13T11:45:17.553

我找到了另一种方法，允许在 VS 中执行所有操作。

我已经添加到名为“postdeployscript.sql”的项目 SQL 脚本中：

声明 @SQL NVARCHAR(200)

SET @SQL = 'alter schema dbo transfer ' + CURRENT_USER +'.[UDF_GET_AUDIT_VALUE]'

执行 (@SQL)

去

脚本在分解过程中由 VS 自动执行，并将模式从当前用户更改为 DBO。

缺点：您需要手动添加每个 UDF/USP

PS：请注意您也可以使用 predeployscript.sql 在部署前执行一些命令

# sql - SQL查询：将属性的值作为列

> ID：639145
> 
> 赞同：1
> 
> 时间：2009-03-12T15:23:52.777
> 
> 标签：sql, ms-access

我有一个表错误（errorId、category、eDate）。

我试图显示每周的错误数量和类别。查询结果应该是这样的：

```
Week    Category1    Category2
01      2            5 
02      0            20 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-12T15:28:19.413

我发布的代码不正确。您需要查看Access 中的[交叉表](http://office.microsoft.com/en-us/access/HA102295771033.aspx)查询。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-12T15:31:11.760

据我所知，Access 不能做枢轴。在 SQL Server 中，您可以使用 PIVOT() 构造来执行此操作。

编辑：实际上，看看[这个](http://msdn.microsoft.com/en-us/library/bb208956.aspx)。

# attributes - Microsoft CRM 4.0：如何为属性设置“更新有效”= 0？

> ID：639147
> 
> 赞同：0
> 
> 时间：2009-03-12T15:24:04.353
> 
> 标签：attributes, dynamics-crm, dynamics-crm-4

如果表单处于更新模式，我希望禁用我的属性。

我尝试导出实体 xml 并编辑此处[记录的](http://technet.microsoft.com/en-us/library/aa682371.aspx)值 ValidForUpdateAPI但它不起作用：当我导入我的自定义项时，CRM 忽略它们！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-12T16:34:52.497

在 onLoad 事件期间，您必须在 JavaScript 中执行此操作。检查 crmForm.FormType 属性，如果该字段为“2”，则禁用该字段。

```
if (crmForm.FormType == 2)
{
   crmForm.all.fieldname.disabled=true;
} 
```

# c# - 让 svcutil 从 C# 文件中获取文档？

> ID：639156
> 
> 赞同：3
> 
> 时间：2009-03-12T15:25:33.710
> 
> 标签：c#, wcf, documentation, metadata, xml-documentation

伙计们，

我正在创建一个新的 WCF 服务并从我的服务接口开始。看起来像：

```
 public interface ISomethingService
    {
        /// <summary>
        /// some description
        /// </summary>
        /// <version>2.13.0</version>
        /// <copyright>2009 by myself</copyright>
        /// <author>Marc Scheuner</author>
        /// <param name="request">The request object</param>
        [OperationContract]
        SomethingResponse GetList(SomethingRequest request);
    } 
```

现在，我还在另一个文件中创建了一些数据协定，描述了 SomethingRequest 和 SomethingResponse 消息。

我编译了我的项目并启动了 svcutil.exe 以从 DLL 中提取元数据（WSDL 和 XSD） - 但我似乎无法弄清楚是否有办法将我的所有评论和解释放入 WSDL/XSD 到 /节点。

我是否对另一个不起眼的 svcutil.exe 参数视​​而不见，还是真的没有办法在元数据中自动生成此文档？

编辑：好的，根据 Marc Gravell 的回答，注释和文档字符串既不在编译的 DLL 中，也不在 MEX 元数据交换协议上可用（可惜！）。

SO THEN：如果您需要向第三方提供访问您的服务所需的信息，您如何记录您的 WCF 服务？是否有“NService”或“WCF 沙堡”工具可以扫描我的 WCF 服务库并从源代码构建 WSDL 和 XSD，包括注释？

似乎找不到很多工具和方法来做到这一点 - 老实说，令我惊讶的是......

马克

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-12T15:35:10.317

svcutil.exe 使用“mex”API，并且只能访问元数据的子集。`[DescriptionAttribute]`不包括评论（在很大程度上也不包括 IIRC ）。

您可能不得不依赖外部文档（即帮助页面/死树）。另一种选择（尽管它违反了许多纯 SOA 规则）是在 dll + xml 中传送实体/接口；svcutil（和 IDE）可以重用现有程序集中的匹配类型。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-11-27T16:11:17.963

也许这有帮助：http: [//msdn.microsoft.com/en-us/library/aa717040.aspx](http://msdn.microsoft.com/en-us/library/aa717040.aspx)

它也适用于 svcutil。

# python - python：确定一个类是否嵌套

> ID：639162
> 
> 赞同：6
> 
> 时间：2009-03-12T15:26:53.597
> 
> 标签：python, introspection, inner-classes

假设您有一个获取类型作为参数的 python 方法；是否可以确定给定类型是否是嵌套类？
例如在这个例子中：

```
def show_type_info(t):
    print t.__name__
    # print outer class name (if any) ...

class SomeClass:
    pass

class OuterClass:
    class InnerClass:
        pass

show_type_info(SomeClass)
show_type_info(OuterClass.InnerClass) 
```

我还希望调用`show_type_info(OuterClass.InnerClass)`显示 InnerClass 是在 OuterClass 中定义的。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-03-12T15:34:51.020

AFAIK，给定一个类而没有其他信息，您无法判断它是否是嵌套类。但是，[请参阅此处](http://mail.python.org/pipermail/python-list/2005-July/330874.html)了解如何使用装饰器来确定这一点。

问题是嵌套类只是一个普通类，它是其外部类的一个属性。您可能期望工作的其他解决方案可能不会 -`inspect.getmro`例如，只为您提供基类，而不是外部类。

此外，很少需要嵌套类。我会强烈重新考虑这是否是一种在您想使用它的特定情况下的好方法。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-12T16:23:04.447

内部类在 Python 中没有提供任何特殊功能。它只是类对象的一个​​属性，与整数或字符串属性没有什么不同。您的 OuterClass/InnerClass 示例可以完全重写为：

```
class OuterClass(): pass
class InnerClass(): pass
OuterClass.InnerClass= InnerClass 
```

InnerClass 无法知道它是否在另一个类中声明，因为那只是一个普通的变量绑定。使绑定方法知道其所有者“自我”的魔法在这里并不适用。

John 发布的链接中的内部类装饰器魔法是一种有趣的方法，但我不会按原样使用它。它不会缓存它为每个外部对象创建的类，因此每次调用 outerinstance.InnerClass 时都会得到一个新的 InnerClass：

```
>>> o= OuterClass()
>>> i= o.InnerClass()
>>> isinstance(i, o.InnerClass)
False # huh?
>>> o.InnerClass is o.InnerClass
False # oh, whoops... 
```

此外，它试图复制 Java 行为，即使用 getattr/setattr 在内部类上提供外部类变量是非常狡猾的，而且实际上是不必要的（因为更 Pythonic 的方式是显式调用 i.__outer__.attr）。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-12T16:46:50.987

实际上，嵌套类与任何其他类没有什么不同——它只是碰巧定义在顶级命名空间之外的其他地方（而是在另一个类中）。如果我们将描述从“嵌套”修改为“非顶级”，那么您可能能够足够接近您的需要。

例如：

```
import inspect

def not_toplevel(cls):
    m = inspect.getmodule(cls)
    return not (getattr(m, cls.__name__, []) is cls) 
```

这适用于常见情况，但在定义后重命名或以其他方式操作类的情况下，它可能无法满足您的要求。例如：

```
class C:             # not_toplevel(C) = False
    class B: pass    # not_toplevel(C.B) = True

B=C.B                # not_toplevel(B) = True

D=C                  # D is defined at the top, but...
del C                # not_toplevel(D) = True

def getclass():      # not_toplevel(getclass()) = True
    class C: pass 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-12T17:14:20.250

谢谢大家的答案。
我使用元类找到了这个可能的解决方案；我所做的更多是出于固执而不是真正的需要，而且它的完成方式不适用于 python 3。
无论如何我都想分享这个解决方案，所以我在这里发布它。

```
#!/usr/bin/env python
class ScopeInfo(type): # stores scope information
    __outers={} # outer classes
    def __init__(cls, name, bases, dict):
        super(ScopeInfo, cls).__init__(name, bases, dict)
        ScopeInfo.__outers[cls] = None
        for v in dict.values(): # iterate objects in the class's dictionary
            for t in ScopeInfo.__outers:
                if (v == t): # is the object an already registered type?
                    ScopeInfo.__outers[t] = cls
                    break;
    def FullyQualifiedName(cls):
        c = ScopeInfo.__outers[cls]
        if c is None:
            return "%s::%s" % (cls.__module__,cls.__name__)
        else:
            return "%s.%s" % (c.FullyQualifiedName(),cls.__name__)

__metaclass__ = ScopeInfo

class Outer:
    class Inner:
        class EvenMoreInner:
            pass

print Outer.FullyQualifiedName()
print Outer.Inner.FullyQualifiedName()
print Outer.Inner.EvenMoreInner.FullyQualifiedName()
X = Outer.Inner
del Outer.Inner
print X.FullyQualifiedName() 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-12T16:37:15.567

如果不自己设置，我不相信有什么方法可以判断类是否嵌套。无论如何，Python 类不能用作命名空间（或者至少不容易），我想说最好的办法就是使用不同的文件。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2018-04-22T18:53:13.857

从 Python 3.3 开始有一个新的属性[`__qualname__`](https://docs.python.org/3/library/stdtypes.html?highlight=__qualname__#definition.__qualname__)，它不仅提供类名，还提供外部类的名称：

在您的示例中，这将导致：

```
assert SomeClass.__qualname__ == 'SomeClass'
assert OuterClass.InnerClass.__qualname__ == 'OuterClass.InnerClass' 
```

如果`__qualname__`一个类不包含'.' 这是一个外部类！

# c# - 编写“if”语句的不同方式

> ID：639166
> 
> 赞同：29
> 
> 时间：2009-03-12T15:27:51.893
> 
> 标签：c#

我见过不同的写`if`声明的方式。

你更喜欢哪一个，为什么？

### 示例 1：

```
if (val % 2 == 1){output = “Number is odd”;}else{output = “Number is even”;} 
```

### 示例 2：

```
if (val % 2 == 1)
{
    output = “Number is odd”;
}
else
{
   output = “Number is even”;
} 
```

### 示例 3：

```
if (val % 2 == 1)
output = “Number is odd”;
else
output = “Number is even”; 
```

### 示例 4：

```
if (val % 2 == 1){
output = “Number is odd”;
} else {
output = “Number is even”;
} 
```

### 类似的问题：

> [为什么省略花括号被认为是一种不好的做法？](https://stackoverflow.com/questions/359732)

* * *

## 回答 #1

> 赞同：56
> 
> 时间：2009-03-12T15:32:41.773

对于这样的情况，还有条件运算符：

```
output = (val % 2 == 1) ? "Number is odd" : "Number is even"; 
```

如果您肯定要使用“如果”，我会使用版本 2 或版本 4，具体取决于您的支撑样式的其余部分。（在工作中我使用 4；对于个人项目，我使用 2。）主要是即使在单个语句周围也有大括号。

顺便说一句，为了测试奇偶校验，使用起来稍微快一些：

```
if ((val & 1) == 1) 
```

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2009-03-12T15:33:49.510

版本 2。我总是包含括号，因为如果您需要在条件下放置多条线，则不必担心以后再放入括号。那，它确保你所有的 if 语句都具有相同的结构，这在你扫描某个 if 语句的代码时会有所帮助。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2009-03-12T16:47:46.540

我使用版本 2。

如果您没有 else，使用花括号的一个原因会变得更加清楚。

```
if(SomeCondition)
{
  DoSomething();
} 
```

如果您随后需要添加另一行代码，则出现问题的可能性较小：

```
if(SomeCondition)
{ 
  DoSomething();
  DoSomethingElse();
} 
```

如果没有大括号，您*可能*会这样做：

```
if(SomeCondition)
   DoSomething();
   DoSomethingElse(); 
```

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2009-03-12T17:40:10.907

我个人更喜欢 3\. 额外的花括号只会添加太多不必要的视觉噪音和空白。

我可以在一定程度上看到 2/4 减少错误的原因，但我个人从未遇到过错误，因为认为 if 语句中有额外的行。我确实使用 C# 和 Visual Studio，所以我的代码总是保持很好的格式。但是，如果我是一个更像记事本风格的程序员，这可能是个问题。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-03-12T15:30:32.200

我更喜欢#2。易于阅读。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2009-03-12T19:15:06.233

以上都不是。

如果我的执行块只有一行（即使它是一个巨大的 for 语句），那么我不使用大括号，但我**会**缩进它，类似于 #3

```
if (num > 3)
     print "num is greater than 3";
else
     print "num is not greater than 3"; 
```

多个不需要大括号的语句的示例：

```
if (num > 3)
    for (int i = 0; i < 100)
        print i + "\n";
else
    print "booya!"; 
```

也就是说，Jon Skeet 在这个问题上的回答是最好的

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-03-12T21:36:45.987

**保持一致比选择最好的更重要。**

这些样式有不同的优点和缺点，但没有一个比在项目甚至编译单元或函数中混合它们更糟糕的了。

* * *

三元运算符是此特定代码的明显选择。`if/else`对于不能以其他方式表达的简单的单语句，我更喜欢缩进的 case 3：

```
if (val % 2 == 1)
    output = “Number is odd”;
else
    output = “Number is even”; 
```

我理解“总是使用大括号”背后的动机，但我个人从未被他们的遗漏所困扰（好吧，一次。使用宏。）

从上述样式中，我会选择（2）。(4) 如果“正确”缩进就可以了。
(1) 我将归因于一个年轻的开发人员，他们希望从“紧凑的代码”中成长起来，或者一个买不起像样的显示器的人。不过，如果它是当地风格，我会选择它。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-03-12T15:30:31.903

我使用版本 2。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2009-03-12T17:20:28.410

我同意三元运算符。在我遇到的代码中没有得到充分利用，我认为它比写出 if/else 语句所需的所有额外括号和缩进更容易阅读。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2009-03-12T20:12:05.347

奇怪的是没有人提到这个：

```
if ( x == 1) {
   ...
}
else {
   ...
} 
```

对我来说，这是唯一正确的方法，当然:-)

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-03-12T17:43:38.543

我自己更喜欢4，但我认为2也绝对不错。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-03-12T19:19:27.687

就个人而言，我认为有两种方法是好的做法：

对于 if 块，只有这种方式：

```
if(...)
{
    // ...
}
else if (...)
{
    // ...
}
else
{
    // ...
} 
```

这是编写 if-else-blocks 的最安全和最容易理解的方法。

对于一列（真正的一列可以在一行上理解），您可以使用三元运算符。

```
var objectInstance = condition ? foo : bar;

// Or the binary operator when dealing with null values
var objectInstance = condition ?? foo; 
```

你不应该调用那些对当前分配没有帮助的方法。

除了上述方法，我不会使用任何其他方法。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-03-12T20:31:15.800

版本 #2 对我来说 - 最容易看到，最容易阅读，容易看到 if 开始和结束的位置，对于 else 也是一样，如果你想添加多个语句，你不必担心放在括号中。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-03-12T17:46:27.193

示例 2 无疑是最不容易出错的方法。请参阅我对[类似问题](https://stackoverflow.com/questions/11099/what-is-the-prefered-style-for-single-decision-and-action-statements)给出的答案，原因是：

[单一决策和行动陈述的首选风格是什么？](https://stackoverflow.com/questions/11099/what-is-the-prefered-style-for-single-decision-and-action-statements/11117#11117)

尽管 Visual Studio 默认使用大括号将大括号放在换行符上（我的首选方法），但 Krzysztof Cwalina 和 Brad Abrams 的[框架设计指南](http://www.amazon.co.uk/Framework-Design-Guidelines-Conventions-Libraries/dp/0321246756/ref=sr_1_2?ie=UTF8&s=books&qid=1236880864&sr=8-2)书（第一版）提出了不同的约定，示例 4，将左大括号放在前面`if`语句的结尾（第 274 页）。他们还声明“**避免**省略大括号，即使语言允许”。

手头没有[第二版](http://www.pearsoned.co.uk/Student/detail.asp?item=100000000275308)，我不能说这些约定是否改变了。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-03-12T17:53:22.700

我会按以下顺序使用它们：1）三元运算符 2）示例 3，但缩进正确 3）2 或 4，它们基本相同。无论我工作的一般风格是什么，我都会去。

我同意杰克关于省略不必要的花括号的说法。我从未引起或见过由于添加新代码而引起的错误，并且有人认为它们是 if 语句的一部分，但不是因为缺少花括号。如果有人这样做，我会无情地嘲笑他们。

你必须折磨我才能让我使用数字 1。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2009-03-12T19:09:01.707

我总是使用#2。#4 是一个非常糟糕的布局，只有那些认为方法必须是一个屏幕大小的长度并且会做任何事情来填充它而不是重构代码的人才能完成！

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2009-03-12T19:10:10.270

就我个人而言，我更喜欢版本 2。但因为它只是格式化，所以没关系。使用最适合您和您的团队成员阅读的内容！

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2009-03-12T19:11:36.007

我使用#2 稍作改动

```
if (condition1) 
{
      doStuff();
} else 
{
      doSomethingElse();
} 
```

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2009-03-12T21:46:54.510

单一的简短陈述：

```
if (condition) output = firstChoice;
else doSomethingElse(); 
```

多个或长语句

```
if (condition) {
   output = firstChoice;
   ...
} else {
   ...
} 
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2013-10-27T23:33:29.440

建议使用大括号，我已经看到不带大括号的 if else 语句存在一些问题，（我不记得确切）即 if 下的语句没有执行，当我用大括号添加相同的语句时才起作用。（使用 Visual工作室和 C#4.0)。

# ruby-on-rails - 是什么导致了这个 ActiveRecord::ReadOnlyRecord 错误？

> ID：639171
> 
> 赞同：206
> 
> 时间：2009-03-12T15:28:33.733
> 
> 标签：ruby-on-rails, ruby, activerecord, join, associations

这遵循[了](https://stackoverflow.com/questions/628000/rails-whats-wrong-with-this-multiple-join-with-conditions-on-the-associations "这")前面的问题，该问题已得到回答。我实际上发现我可以从该查询中删除一个连接，所以现在工作查询是

```
start_cards = DeckCard.find :all, :joins => [:card], :conditions => ["deck_cards.deck_id = ? and cards.start_card = ?", @game.deck.id, true] 
```

这似乎有效。但是，当我尝试将这些 DeckCard 移动到另一个关联时，我收到 ActiveRecord::ReadOnlyRecord 错误。

这是代码

```
for player in @game.players 
  player.tableau = Tableau.new
  start_card = start_cards.pop 
  start_card.draw_pile = false
  player.tableau.deck_cards << start_card  # the error occurs on this line
end 
```

和相关的模型（画面是桌上的玩家牌）

```
class Player < ActiveRecord::Base
  belongs_to :game
  belongs_to :user
  has_one :hand
  has_one :tableau
end

class Tableau < ActiveRecord::Base
  belongs_to :player
  has_many :deck_cards
end  

class DeckCard < ActiveRecord::Base
  belongs_to :card
  belongs_to :deck  
end 
```

在这段代码之后，我正在执行类似的操作，添加`DeckCards`到玩家手中，并且该代码运行良好。我想知道我是否需要`belongs_to :tableau`DeckCard 模型，但它可以很好地添加到玩家的手牌中。我在 DeckCard 表中有一个`tableau_id`和`hand_id`列。

我在rails api中查找了ReadOnlyRecord，除了描述之外并没有说太多。

* * *

## 回答 #1

> 赞同：287
> 
> 时间：2009-03-12T18:15:06.923

**Rails 2.3.3 及更低版本**

来自[ActiveRecord `CHANGELOG`](https://raw.github.com/rails/rails/3-0-stable/activerecord/CHANGELOG)^(（v1.12.0，2005 年 10 月 16 日）)：

> 引入只读记录。如果你调用 object.readonly！然后它会将对象标记为只读并在调用 object.save 时引发 ReadOnlyRecord。object.readonly? 报告对象是否是只读的。将 :readonly => true 传递给任何 finder 方法会将返回的记录标记为只读。 **:joins 选项现在意味着 :readonly，因此如果您使用此选项，现在保存相同的记录将失败。** 使用 find_by_sql 来解决。

Using`find_by_sql`并不是真正的替代方案，因为它返回原始行/列数据，而不是`ActiveRecords`. 你有两个选择：

1.  强制实例变量`@readonly`在记录中为假（hack）
2.  使用`:include => :card`代替`:join => :card`

**Rails 2.3.4 及更高版本**

2012 年 9 月 10 日之后，上述大部分内容不再适用：

*   使用`Record.find_by_sql` **是**一个可行的选择
*   `:readonly => true`只有在**没有**显式**或**显式（或finder-scope-in​​herited）选项指定时**才会**自动推断（参见Rails 2.3.4的in实现，或Rails 3.0.0的in和in的实现）`:joins`**`:select` **`:readonly``set_readonly_option!``active_record/base.rb``to_a``active_record/relation.rb``custom_join_sql``active_record/relation/query_methods.rb`****
*****   但是，如果连接表有两个以上的外键列并且没有明确指定（即忽略用户提供的值 - 参见.） ，`:readonly => true`则总是自动推断in 。`has_and_belongs_to_many``:joins``:select``:readonly``finding_with_ambiguous_select?``active_record/associations/has_and_belongs_to_many_association.rb`*   总之，除非处理特殊的连接表和`has_and_belongs_to_many`，否则`@aaronrustad`的答案在 Rails 2.3.4 和 3.0.0 中适用。*   *如果*`:includes`您想实现`INNER JOIN`(`:includes`意味着 a `LEFT OUTER JOIN`，它的选择性和效率低于`INNER JOIN`.) ，请不要使用****

 ***** * *

## 回答 #2

> 赞同：172
> 
> 时间：2010-08-09T23:50:45.930

或者在 Rails 3 中，您可以使用 readonly 方法（将“...”替换为您的条件）：

```
( Deck.joins(:card) & Card.where('...') ).readonly(false) 
```

* * *

## 回答 #3

> 赞同：45
> 
> 时间：2009-06-07T00:32:46.280

这可能在最近发布的 Rails 中有所改变，但解决此问题的适当方法是将**:readonly => false**添加到查找选项。

* * *

## 回答 #4

> 赞同：17
> 
> 时间：2013-03-01T22:17:09.960

select('*') 似乎在 Rails 3.2 中解决了这个问题：

```
> Contact.select('*').joins(:slugs).where('slugs.slug' => 'the-slug').first.readonly?
=> false 
```

只是为了验证，省略 select('*') 确实会产生只读记录：

```
> Contact.joins(:slugs).where('slugs.slug' => 'the-slug').first.readonly?
=> true 
```

不能说我理解其中的原理，但至少这是一个快速而干净的解决方法。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-03-27T00:32:54.397

代替 find_by_sql，您可以在 finder 上指定一个 :select，然后一切都恢复正常了...

`start_cards = DeckCard.find :all, :select => 'deck_cards.*', :joins => [:card], :conditions => ["deck_cards.deck_id = ? and cards.start_card = ?", @game.deck.id, true]`

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2012-08-10T22:31:29.697

要停用它...

```
module DeactivateImplicitReadonly
  def custom_join_sql(*args)
    result = super
    @implicit_readonly = false
    result
  end
end
ActiveRecord::Relation.send :include, DeactivateImplicitReadonly 
```

# c# - 如何部署我的 C# 项目？

> ID：639174
> 
> 赞同：3
> 
> 时间：2009-03-12T15:29:13.123
> 
> 标签：c#, deployment

如何部署 C# Visual Studio 2005 项目以便我可以在另一个系统中运行该应用程序？我的项目有一些在部署项目时必须集成的依赖项和文件。

处理这个问题的最佳方法是什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-12T15:33:54.097

你需要知道你有什么依赖。

*   您需要安装 .Net 框架
*   您必须在目标机器上显式安装您从 GAC 使用的所有依赖项（一些 3rd 方组件）
*   然后你只需要从你的 \bin\Release 文件夹中复制文件
*   安装所有服务等，如果有的话

在最简单的情况下，仅复制文件就足够了。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-12T15:50:03.930

您是否研究过[ClickOnce](http://msdn.microsoft.com/en-us/library/t71a733d(VS.80).aspx)部署？
它远非完美，但对于没有大量开销的项目，它通常已经足够好了。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-12T15:31:14.540

您可以在 Visual Studio 中右键单击项目文件并发布到其他位置。这将构建站点并将其复制到指定的目录。

此外，如果您在构建过程中需要做任何额外的事情，您可以在项目属性的构建选项卡上指定自定义构建操作。

编辑：现在我看到你补充说它是一个 Windows 应用程序，我的回答并不重要。我会尝试在 Visual Studio 中添加一个设置和部署项目来处理安装/部署您的 Windows 应用程序。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-12T15:32:30.930

什么样的项目？

假设它是一个常规的 winforms 应用程序，只需将 obj\debug 或 obj\release 目录中的所有内容复制到新计算机即可。然后运行你的可执行文件

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-12T16:00:02.737

在我看来，您或多或少有三个选项（也许是 4 个？）。

1.  [Windows 安装程序](http://msdn.microsoft.com/en-us/library/1hb0zwz8(VS.80).aspx)
2.  [点击一次](http://msdn.microsoft.com/en-us/library/31kztyey(VS.80).aspx)
3.  只需分发exe本身

在您的特定情况下，只要项目不是庞大且依赖项太多，我建议使用 ClickOnce。

对于其他[替代品](http://msdn.microsoft.com/en-us/library/54cw8ks0(VS.80).aspx)。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-12T20:09:18.473

正确答案取决于许多标准。

最简单的部署方法是复制文件。只需将您的 .exe、依赖的 .dll 和 .config 文件放在一个目录中，然后将其复制到目标计算机上。这很简单，但是这种方法有很多限制：

*   它假定目标机器安装了正确版本的 .NET 框架
*   它假定安装软件的人具有一定的技术能力。
*   安装不会做一些基本的事情，比如创建开始菜单项。

发布 ClickOnce 部署程序解决了很多这些问题，但它有自己的一组限制。我用的不多，所以可能不止这些，尽管仅这些就非常重要：

*   程序安装在 ClickOnce 缓存中，而不是 Program Files 目录中。
*   如果您的程序在 ClickOnce 沙箱之外执行任何操作，则您必须处理安全提升和代码签名。

您可以创建一个 VS 安装和部署项目并构建一个 .msi 文件来安装程序。最明显的缺点是它很复杂：.msi 文件可以做很多很多事情，并且设置和部署对象模型很复杂，并且文档很复杂，可以说是奇特的。但是您可以通过 .msi 安装完成一些其他方法无法轻松完成的事情，包括（*当然*不限于）：

*   通过添加/删除程序彻底卸载程序。
*   为安装提供一个实际的 UI，让用户决定将程序放在哪里。
*   支持通过 MSIEXEC 进行脚本安装。
*   安装程序以外的组件，例如数据库、COM 对象等。
*   将组件放入目标机器的 GAC。

# dependency-injection - 温莎城堡和自动注册

> ID：639176
> 
> 赞同：1
> 
> 时间：2009-03-12T15:29:15.043
> 
> 标签：dependency-injection, inversion-of-control, castle-windsor

我是 Castle n00b，正在使用 Castle Windsor 中的 Fluent API 根据命名约定自动注册服务的实现（ISomething 由 Something 实现）。我想要支持的一件事是自动注册以获取位于单独 dll 中的依赖项，并自动注册这些依赖项。

所以：IFoo 由 Foo 实现（都在 Foo.dll 中），而 Foo 依赖于 Bar.dll 中的 IBar。

我编写了以下代码来实际执行自动注册。它似乎有效，但我想知道我自己是否做了太多工作。有没有更简单的方法来完成同样的事情？

```
private static void EnsureRegistered(Type t, IWindsorContainer container)
    {
        if (!container.Kernel.HasComponent(t) && (!(t.Assembly.FullName.StartsWith("System") || t.Assembly.FullName.StartsWith("mscorlib"))))
        {
            bool registeredAtLeastOneComponent = false;

            container.Register(AllTypes.Pick().
                   FromAssembly(t.Assembly).If(delegate(Type t2)
                       {
                           //auto-registers all types that implement an interface where
                           //the name of the interface is the same as the class, minus the 'I'
                           //ex: EchoService is auto-registered as handler of IEchoService
                           Type[] interfaces = t2.GetInterfaces();
                           bool shouldRegister = false;
                           foreach(Type interfaceType in interfaces)
                           {
                               shouldRegister = t2.Name.Equals(interfaceType.Name.Substring(1))
                                                     && (!container.Kernel.HasComponent(interfaceType));
                               registeredAtLeastOneComponent = registeredAtLeastOneComponent || shouldRegister;
                               if (shouldRegister)
                                   break;
                           }
                           return shouldRegister;

                       }).WithService.Select(delegate(Type type, Type baseType)
                         {
                             Type serviceType = null;
                             Type[] interfaces = type.GetInterfaces();
                             foreach(Type interfaceType in interfaces)
                             {
                                 if (!type.Name.Equals(interfaceType.Name.Substring(1))) continue;
                                 serviceType = interfaceType;
                                 break;
                             }

                             return new Type[] {serviceType};

                         }));

            if (!registeredAtLeastOneComponent)
                return;

            //for each of the items in the graph, if they have see if they have dependencies
            //in other assemblies that aren't registered, register those dependencies as well
            foreach(GraphNode registered in container.Kernel.GraphNodes)
            {
               if (!(registered is Castle.Core.ComponentModel))
                    continue;

               Castle.Core.ComponentModel registeredComponent = registered as Castle.Core.ComponentModel;

               foreach(ConstructorCandidate constructor in registeredComponent.Constructors)
               {
                   foreach(DependencyModel dep in constructor.Dependencies)
                   {
                       EnsureRegistered(dep.TargetType, container);
                   }
               }
            }
        }
    } 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-12T19:23:07.943

这真的取决于你如何构建和命名你的组件......如果你保持一些简单的约定（即“MyApp.Services”命名空间下的所有组件服务及其在“MyApp.Services.Impl”下的实现），你可以大大减少这个复杂性（参见例如[ayende1](http://ayende.com/Blog/archive/2008/05/13/Zero-friction-IoC-Auto-registration-is-mandatory.aspx)，[ayende2](http://ayende.com/Blog/archive/2008/05/13/Binsor-amp-Auto-Registration--Making-it-even-simpler.aspx)）。

此外，IMO 的用处是相当有限的，除了最简单的情况......例如，您想在没有任何服务接口的情况下注册一些服务，一些服务需要配置，服务覆盖等。在这种情况下，这将不起作用.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-01-31T15:54:51.763

不确定这是否回答了您的问题，但这是我为自动注册我的服务所做的。

```
 // Auto-Register Services as Singletons
        container.Register(
            AllTypes.FromAssembly(typeof(BaseService).Assembly).Pick()
                    .WithService.DefaultInterfaces()
                    .Configure(s => s.LifestyleSingleton())); 
```

我的所有服务都继承自 BaseService（抽象类）以及接口 - IService。这将自动将具体服务类绑定到其接口，并使其可在容器中使用。

# exim - exim 配置 - 接受所有邮件

> ID：639187
> 
> 赞同：8
> 
> 时间：2009-03-12T15:30:36.100
> 
> 标签：exim

我刚刚在我的 ubuntu 计算机上设置了 exim。目前它只接受该计算机上存在的帐户的电子邮件，但我希望它接受所有电子邮件（只是因为我感兴趣）。不幸的是，似乎有一百万个与 exim 相关的配置文件，我在谷歌上找不到任何东西。

是否有针对完整初学者的 exim 介绍？

谢谢。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-03-12T16:33:32.907

[http://www.exim.org/maillist.html](http://www.exim.org/maillist.html)上有一个邮件列表。作为 Ubuntu 用户，您将面临的问题是 Debian 打包者/用户和主要的 Exim 用户群之间总是存在轻微的紧张关系，因为 Debian 选择大量定制他们的配置。他们定制它的原因是合理的，但它导致 Debian 用户出现在主邮件列表上，使用非 Debian 用户无法识别的术语提出问题。Debian 运行自己的 exim 专用帮助列表（我手边没有地址，但它在发行版文档中）。不幸的是，这最终会给您带来问题，因为 Ubuntu 采用了 Debian 的所有这些软件包，但不像 Debian 那样支持它们，

因此，Ubuntu 用户转到主要的 Exim 列表，并被告知向他们的打包程序寻求帮助。所以他们去 Debian 列表寻求帮助，可能会也可能不会。

现在，要回答您最初的问题，有很多方法可以满足您的要求，并且可能对您来说最好的方法是特定于 Debian/Ubuntu 配置。然而，为了让你开始，你可以在你的路由器中添加这样的东西：

```
catchall:
  driver = redirect
  domains = +local_domains
  data = youraddress@example.com 
```

如果你把它放在你的通用别名/本地传送路由器之后和任何强制故障路由器之前，这会将所有邮件重定向到 local_domains 中任何域的任何未处理的 local_part 到 youraddress@example.com。

local_domain 是标准 exim 配置文件中定义的域列表。如果您没有它或等效项，则可以将其替换为以冒号分隔的本地域列表，例如“example.com:example.net:example.foo”

难以跟上 Exim 的原因之一是你可以用它做任何事情（从字面上看，列表中的某个人证明了扩展语法在几年前已经完成，IIRC）。因此，例如，您可以使用上述框架从文件中查找域，对 local_parts 应用正则表达式以捕获，将邮件保存到文件而不是重定向到地址，将其放在前面路由器并使用“看不见”来保存所有邮件的副本等。如果您真的想管理 Exim 安装，我强烈建议您从头到尾阅读文档，一旦您抓住脚趾，这真的非常非常好。

祝你好运！

# c++ - 链接器问题：未定义的引用

> ID：639194
> 
> 赞同：2
> 
> 时间：2009-03-12T15:31:51.167
> 
> 标签：c++, linker

构建当前项目时，链接器出现问题。

它出现的错误如下：

```
libmiinddynamic.so: undefined reference to `std::basic_ostream<char, std::char_traits<char> >& SparseImplementationLib::operator<< <double, double, SparseImplementationLib::DefaultPtr<double, double> >(std::basic_ostream<char, std::char_traits<char> >&, SparseImplementationLib::AbstractSparseNode<double, double, SparseImplementationLib::DefaultPtr<double, double> > const&)' 
```

这有点奇怪，据我所知，这个方法是在一个肯定正在编译的文件中声明的：

```
 namespace SparseImplementationLib {
        template <ActivityType,WeightType,ptr_type = 
DefaultPtr<ActivityType,WeightType> > class AbstractSparseNode;
    // A whole bunch of other methods

```
//! All derived classes from AbstractSparseNode can use operator<<
template <class ActivityType, class WeightType, class ptr_type>
ostream& operator<<
(
    ostream& s, 
    const AbstractSparseNode<ActivityType,WeightType>& node)
{
    node.ToStream(s);
    return s;
} 
```

} 
```

为什么会弹出这个错误？

注意这是在 Fedora 上使用 MPICXX 编译的，我使用的是 CCMAKE。

编辑好的，使用 nm 我发现以下内容：

```
std::ostream& SparseImplementationLib::operator<< <double, double, SparseImplementationLib::DefaultPtr<double, double> >(std::ostream&, SparseImplementationLib::AbstractSparseNode<double, double, SparseImplementationLib::DefaultPtr<double, double> > const&) 
```

当它想要这个时：

```
std::basic_ostream >& SparseImplementationLib::operator<< <double, double, SparseImplementationLib::DefaultPtr<double, double> >(std::basic_ostream >&, SparseImplementationLib::AbstractSparseNode<double, double, SparseImplementationLib::DefaultPtr<double, double> > const&) 
```

不幸的是，我不知道如何解决这个问题， cus operator<< 只需要 2 个参数。

（所有 _s 之前的随机 \s 是为了尝试逃避它们，stackoverflow 今天有点喜怒无常，不会这样做（否则我们在我的代码中随机得到可爱的斜体））

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-12T15:59:32.303

你能 nm 上面显示的代码生成的对象，看看签名确实是你所期望的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-12T16:46:28.400

试图解析（重新格式化）该行，以便我可以阅读它......

```
libmiinddynamic.so: undefined reference to:
ostream & SparseImplementationLib::operator<<
   < double, double, SparseImplementationLib::DefaultPtr<double, double> >
(
   ostream &,
  SparseImplementationLib::AbstractSparseNode<
     double, double, SparseImplementationLib::DefaultPtr<double, double> > const
) 
```

如果我没看错，那么：

*   *ActivityType 类*是一个*double*。
*   *类 WeightType*是一个*double*。
*   *类 ptr_type*是*SparseImplementationLib::DefaultPtr<double, double>*

不知何故，第二个参数
***const AbstractSparseNode<ActivityType,WeightType>&***，
例如***const AbstractSparseNode<double,double>&***
变成了：

```
 SparseImplementationLib::AbstractSparseNode<
     double,
     double,
     SparseImplementationLib::DefaultPtr<double, double>
       > const & 
```

**模板参数计数不匹配。** 您已经使用 2 个模板化参数定义了第二个（模板化）参数，并且您的错误消息指示 3 个模板化参数。

# ruby-on-rails - MemCacheError：执行已过期

> ID：639207
> 
> 赞同：0
> 
> 时间：2009-03-12T15:34:39.850
> 
> 标签：ruby-on-rails, memcached

我在一个大型 Rails 项目中使用了超棒的缓存货币 gem。我经常遇到这些异常

> MemCache::MemCacheError: 执行已过期”

似乎没有押韵或理由。这*究竟*是什么意思，以及如何解决？

编辑：

这是一个有代表性的堆栈跟踪：

```
lib/authenticated_system.rb:100:in `login_from_session'
lib/authenticated_system.rb:12:in `current_user'
lib/authenticated_system.rb:6:in `logged_in?'
lib/authenticated_system.rb:35:in `authorized?'
lib/authenticated_system.rb:53:in `login_required' 
```

有问题的行来自 RESTful_Authentication：

```
self.current_user = User.find(session[:user_id]) if session[:user_id] 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-25T17:33:56.890

我认为[Michael Simons通过他的](http://info.michael-simons.eu/)[博](http://info.michael-simons.eu/2009/03/23/phusion-passenger-and-memcache-client-revisited/)文回答了我的问题。本质上，这是一个存在于Passenger 和Memcached 之间的[已知问题。](http://www.modrails.com/documentation/Users%20guide.html#_example_1_memcached_connection_sharing_harmful)

这是迈克尔的修复：

```
# environment.rb
begin
   PhusionPassenger.on_event(:starting_worker_process) do |forked|
     if forked
       # We're in smart spawning mode, so...
       # Close duplicated memcached connections - they will open themselves
       CACHE.reset
     end
   end
# In case you're not running under Passenger (i.e. devmode with mongrel)
rescue NameError => error
end 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-14T18:59:48.103

我从队友那里听说，Rails 的默认 memcache 客户端不会尝试自动重新连接到 memcache 守护进程，如果由于某种原因它停止并重新启动，尽管我自己还没有确认。Fiveruns [memcache-client](http://github.com/fiveruns/memcache-client/tree/master)库修复了这个问题。

# algorithm - 从总成本计算投标价格

> ID：639215
> 
> 赞同：1
> 
> 时间：2009-03-12T15:36:24.433
> 
> 标签：algorithm, math

我必须解决以下问题。我必须从总价计算出标价。例如，一个客户想要支付 2000 美元作为总价，但是从这个价格中，有额外的成本：

-使用价格是投标价格的 10%，最低 10 美元，最高 50 美元

-卖方价格：投标价格的 2%

- 附加价格： 1 到 500 之间的出价 5 美元 501 到 1000 之间的出价 10 美元 1001 到 3000 之间的出价 15 美元 超过 3000 美元的出价 20 美元

-存储成本：100$

例如，从这一切中，我必须计算出总共 2000 美元的投标价格。我有点不知道如何做到这一点。谁能给我一些关于算法应该是什么的提示或答案？

编辑：好的，我知道了如何计算代数，现在我陷入困境的是如何用代码或伪代码编写算法。有人有提示吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-12T15:42:09.863

您可以将所有这些成本表示为投标价格的函数。生成一个巨大的方程，它是所有这些函数的总和，并求解一个特定的最终值，例如：

```
usage cost(bid) = PIN(bid*0.10, 10, 50)
seller cost(bid) = bid*.02
added cost(bid) = PIN(ceiling(bid/500)*5, 5, 10) + PIN(ceiling((bid - 1000)/2000)*5, 0, 10)
storing cost(bid) = 100 
```

所以最终成本是这样的：

```
final cost(bid) = PIN(bid*.1, 10, 50) + pin(ceiling(bid/500)*5, 5, 20) + PIN(ceiling((bid - 1000)/2000)*10, 0, 20) + bid*.02 + 100 + bid 
```

求解一个特定的值，你就完成了。

例如，如果您希望总成本为 2000 美元：

```
2000 = PIN(bid*.1, 10, 50) + pin(ceiling(bid/500)*5, 5, 10) + PIN(ceiling((bid - 1000)/2000)*5, 0, 10) + bid*.02 + 100 + bid. 
```

出价必须至少 > 1500 且 < 2000，这很好，因为我们可以使这些 PIN 部分保持不变：

```
2000 = 50 + 10 + 5 + 100 + bid*1.02
1835 = bid*1.02
bid = 1799.0196078431372549019607843137 
```

PIN 表达式是最难考虑的因素，因此您可能需要猜测几次，直到您得到缩小要计算的出价范围的东西。

# asp.net - ASP.NET 中的 SMTP 标头注入？

> ID：639217
> 
> 赞同：8
> 
> 时间：2009-03-12T15:36:57.880
> 
> 标签：asp.net, security, smtp, code-injection

我的 ASP.NET 网站有一个全局错误处理程序，当 Web 应用程序出现任何类型的错误时，它会向我（和另一个开发人员）发送电子邮件。我们最近收到一个错误，其中包含对我们从未听说过的电子邮件地址的抄送。可怕的是，错误电子邮件发送给的开发人员列表是硬编码在已编译的 ASP.NET 代码中的。我们看不到如何添加 CC。

我们也非常怀疑犯规行为，因为导致错误的请求是试图使用我们的一种形式发送垃圾邮件。发送请求的 IP 地址也列在[http://www.projecthoneypot.org/](http://www.projecthoneypot.org/)上。

我们现在最好的猜测是该请求以某种方式格式错误，它在电子邮件中注入了一个 CC 标头。问题是我们无法弄清楚如何做到这一点。我们正在使用 System.Net.Mail 发送电子邮件，它似乎可以防止此类事情发生。MailMessage 对象的主题只接受单行，因此您不会使用抄送行创建多行主题。在 MailMessage 中设置 to 和 cc 地址似乎相当健壮。而且我看不到您如何在邮件正文中添加 CC 标头。我找不到有关此的任何信息，我很想知道这是否是一个真正的问题。

编辑：有人要求提供代码。它有点长，但这里是：

```
public class Global : System.Web.HttpApplication
{
    protected void Application_Error(Object sender, EventArgs e)
    {
        // Get the last exception.
        Exception objException = Server.GetLastError();

        // Work out the error details based on the exception.
        string ErrorType = "";
        string ErrorDescription = "";
        string ErrorHtml = "";

        if (objException == null)
        {
            // This should never occur.
            ErrorType = "Unknown Error";
            ErrorDescription = "Unknown Error";
        }
        else if (objException.GetType() == typeof(HttpException))
        {
            // This will occur when the ASP.NET engine throws a HttpException.
            HttpException objHttpException = objException as HttpException;
            if (objHttpException.GetHttpCode() == 404)
            {
                string Resource = Globals.GetFullUrl(this.Context);
                Server.ClearError();
                Response.Redirect("/ResourceNotFound.aspx?BadUrl=" + Server.UrlEncode(Resource));
                return;
            }
            else
            {
                ErrorType = objHttpException.GetHttpCode().ToString();
                ErrorDescription = objHttpException.Message;
            }
        }
        else if (objException.GetType() == typeof(HttpUnhandledException) && objException.InnerException != null && objException.InnerException.GetType() == typeof(HttpException))
        {
            // This will occur when the code throws a HttpException (e.g. a fake 404).
            HttpException objHttpException = objException.InnerException as HttpException;
            if (objHttpException.GetHttpCode() == 404)
            {
                string Resource = Globals.GetFullUrl(this.Context);
                Server.ClearError();
                Response.Redirect("/ResourceNotFound.aspx?BadUrl=" + Server.UrlEncode(Resource));
                return;
            }
            else
            {
                ErrorType = objHttpException.GetHttpCode().ToString();
                ErrorDescription = objHttpException.Message;
            }
        }
        else if (objException.GetType() == typeof(HttpUnhandledException))
        {
            // This will occur when a page throws an error.
            HttpUnhandledException objHttpUnhandledException = (HttpUnhandledException) objException;
            ErrorType = objHttpUnhandledException.GetHttpCode().ToString();
            if (objHttpUnhandledException.InnerException != null)
                ErrorDescription = objHttpUnhandledException.InnerException.Message;
            else
                ErrorDescription = objHttpUnhandledException.Message;
            if (objHttpUnhandledException.GetHtmlErrorMessage() != null)
            {
                ErrorHtml = objHttpUnhandledException.GetHtmlErrorMessage();
            }
        }
        else if (objException.GetType() == typeof(HttpRequestValidationException) && !Globals.IsTtiUser(this.Context))
        {
            // Do nothing.  This is mostly just spider junk and we don't want to know about it.
        }
        else
        {
            // This will occur when the ASP.NET engine throws any error other than a HttpException.
            ErrorType = objException.GetType().Name;
            ErrorDescription = objException.Message;
        }

        // Send an email if there's an error to report.
        if (ErrorType != "" || ErrorDescription != "")
        {
            Globals.SendErrorEmail(this.Context, ErrorType, ErrorDescription, ErrorHtml);
        }
    }

    public static void SendErrorEmail (HttpContext context, string errorType, string errorDescription, string errorHtml)
    {
        // Build the email subject.
        string Subject = "EM: " + errorType + ": " + context.Request.ServerVariables["SCRIPT_NAME"];

        // Build the email body.
        string Body;

        StringBuilder sb = new StringBuilder("");
        sb.Append("Server:\r\n");
        sb.Append(Globals.Server.ToString() + "\r\n");
        sb.Append("\r\n");
        sb.Append("URL:\r\n");
        sb.Append(Globals.GetFullUrl(context) + "\r\n");
        sb.Append("\r\n");
        sb.Append("Error Type" + ":\r\n");
        sb.Append(errorType + "\r\n");
        sb.Append("\r\n");
        sb.Append("Error Description" + ":\r\n");
        sb.Append(errorDescription + "\r\n");
        sb.Append("\r\n");
        sb.Append("Referring Page:\r\n");
        sb.Append(context.Request.ServerVariables["HTTP_REFERER"] + "\r\n");
        sb.Append("\r\n");
        sb.Append("Date/Time:\r\n");
        sb.Append(DateTime.Now.ToString() + "\r\n");
        sb.Append("\r\n");
        sb.Append("Remote IP:\r\n");
        sb.Append(context.Request.ServerVariables["REMOTE_ADDR"] + "\r\n");
        sb.Append("\r\n");
        sb.Append("User Agent:\r\n");
        sb.Append(context.Request.ServerVariables["HTTP_USER_AGENT"] + "\r\n");
        sb.Append("\r\n");
        sb.Append("Crawler:\r\n");
        sb.Append(context.Request.Browser.Crawler.ToString() + "\r\n");
        sb.Append("\r\n");
        sb.Append("Admin User:\r\n");
        sb.Append(context.User.Identity.Name + "\r\n");
        sb.Append("\r\n");
        sb.Append("\r\n");
        Body = sb.ToString();

        // If there's HTML to represent the error (usually from HttpUnhandledException),
        // then stuff the body text into the HTML (if possible).
        bool HtmlMessage = false;

        if (errorHtml != "")
        {
            Regex r = new Regex("(?<thebodytext><body.*?>)", RegexOptions.IgnoreCase);
            if (r.IsMatch(errorHtml))
            {
                Body = Body.Replace("\r\n", "<br>");
                Body = r.Replace(errorHtml, "${thebodytext}" + Body, 1);
                HtmlMessage = true;
            }
        }

        // Send an email to the TTI developers.
        MailMessage objMail;
        objMail = new MailMessage();
        objMail.From = new MailAddress("from-address");
        objMail.To.Add(new MailAddress("to-address"));
        objMail.CC.Add(new MailAddress("cc-address"));
        objMail.CC.Add(new MailAddress("another-cc-address"));
        if (HtmlMessage)
            objMail.IsBodyHtml = true;
        else
            objMail.IsBodyHtml = false;
        if (errorType == "404")
            objMail.Priority = MailPriority.Low;
        else
            objMail.Priority = MailPriority.High;
        objMail.Subject = Subject;
        objMail.Body = Body;

        try
        {
            SmtpClient objSmtpClient = new SmtpClient();
            objSmtpClient.Send(objMail);
        }
        finally
        {
            // Do nothing.
        }
    }
} 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-18T00:26:51.840

我可以看到这是一个*非常*有创意的攻击的目标......您正在将用户控制的数据填充到您的消息正文中......此时，巧妙地使用二进制数据*可能会*导致一个在发送期间发送正确数据的 BODY SMTP 会话以将其格式化为*正确*...如果可以的话，我建议将正文转换为所有 ASCII 文本，或者在您的字符串构建期间，编写一个仅允许 RFC 字符进入的字符串清理程序。（过滤 URL， REFERRER、远程地址和 UserAgent）。这些是你更有可能的攻击点。

第二个想法可能是用代码构建一个基本的电子邮件，并将您构建的正文附加为文本、HTML 或 PDF 文件。

请记住，SMTP 信封数据*与*邮件数据不同......如果他们继续发送数据，他们可以发送整个 MAIL FROM: RCPT TO:, DATA, etc...（当然，这是不太可能的情况...）...

我很想看到你收到的电子邮件的*原始*来源......（如实际 SMTP 事务的十六进制转储中，不是 Outlook 希望你看到的，或其他）。

您也可以在发送消息之前尝试使用 QP 或 B64 对您的身体进行编码......这可能会解决您的问题......

这是一个有趣的问题，我很期待它的结果。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-18T11:05:51.773

您的代码看起来非常安全，所以我认为问题不在您这边。

IMO，要么有人在将 SMTP 消息发送到邮件服务器时拦截了它，并注入了额外的 CC: 行；或邮件服务器已被入侵。

如果您找不到答案，我建议您直接联系 Microsoft - 您可能在 .NET Framework 中发现了一个漏洞。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-07-19T18:35:29.797

作为一种解决方法，您为什么不使用非对称加密（例如公钥加密）对电子邮件消息进行加密？这样，只有预期的接收者才能阅读它。

这样，即使坏人得到了你的信息的副本（通过任何方式），它现在也对他们有用。

让我们面对现实吧，如果您拥有像 FBI 或 Google 这样的知名网站，那么很多非常有创意的人会花费大量时间并竭尽全力损害它。保护详细的错误消息非常重要。

# jsp - 如何在 WebWork 中更改我的上下文根？

> ID：639218
> 
> 赞同：0
> 
> 时间：2009-03-12T15:37:25.960
> 
> 标签：jsp, root, webwork

我目前正在开发一个由 JSP 组成的大型 Web 应用程序。我也使用 WebWork 框架。

到目前为止，我的应用程序的上下文根是“/”。现在我想将其更改为“nstat”。

我应该如何处理来自我的 JSP 的相对和绝对调用？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-12T15:44:36.067

对于 jsps，您可以使用`<c:url/>`标签来构建正确的相对 url。Webwork 有一个类似的自定义标签，名为`<ww:url/>`.

```
<c:url val="somepath/some.jsp"/> 
```

将被翻译成“/nstat/somepath/some.jsp”。如果您设置了 var 属性，您可以稍后在您的 jsp 中使用该`${}`符号使用该 url。

# asp.net - 从 MSDN 获取所需信息的最快方法是什么？

> ID：639219
> 
> 赞同：4
> 
> 时间：2009-03-12T15:38:17.250
> 
> 标签：asp.net, reference, msdn

在 PHP 中，如果我需要有关函数的信息，我只需键入[http://php.net/function-name](http://php.net/function-name)即可。如果该函数不存在，它将执行所有函数的搜索。每个函数的文档通常只有 1 页长，包含所需的所有相关信息（参数、返回类型、示例代码、注释、特殊情况）。

当我在 MSDN 上搜索某些内容时，通常需要单击 2-3 次才能找到我要查找的内容。

由于我花了很多时间尝试从 MSDN 中提取非常基本的信息，是否有网站或服务可以压缩这些信息以便更快更轻松地访问？

例如，我知道对于 Java，有[http://javadocs.org/](http://javadocs.org/)可以更轻松地查找文档（[http://javadocs.org/Color](http://javadocs.org/Color)重定向到[http://java.sun.com/j2se/1.5。 0/docs/api/java/awt/Color.html](http://java.sun.com/j2se/1.5.0/docs/api/java/awt/Color.html) )

这样的事情已经存在了吗？谢谢。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-03-12T15:40:03.707

使用 Google 并指定站点：msdn.microsoft.com

[http://www.google.com/search?q=system.net.mail+site%3Amsdn.microsoft.com](http://www.google.com/search?q=system.net.mail+site%3Amsdn.microsoft.com)

注意：我也使用这种方法搜索 SO -- Google using site:stackoverflow.com

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-12T15:42:24.637

我假设您使用 Visual Studio。因此，例如，如果您想了解有关 ClassX 的信息，只需将光标放在上面，然后按 F1。

如果我在 Visual Studio 中的 FileInfo 类上执行此操作，我会得到[http://msdn.microsoft.com/en-us/library/system.io.fileinfo.aspx](http://msdn.microsoft.com/en-us/library/system.io.fileinfo.aspx)。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-12T15:39:22.053

我发现使用 google 更容易，只需输入“msdn [我正在寻找的]”之类的内容。它往往比试图通过 MSDN 的网站摆弄我的方式来获得更好的结果。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-12T15:40:37.747

谷歌 ==> 网站：msdn.microsoft.com + 关键字 :)

甚至还有一个自定义的谷歌搜索：[MSDN Search](http://www.google.com/coop/cse?cx=001706605492879182808%3Ayra97xpb_7y)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-12T15:43:08.677

1.  询问 StackOverflow
2.  使用谷歌

请注意，使用 MSDN 中的搜索框甚至不在大多数人的答案中。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-12T15:52:23.880

为您的浏览器使用[Open Search](http://www.opensearch.org/)插件。像[这些](http://mycroft.mozdev.org/search-engines.html?name=msdn)。IE7、Fire Fox（我认为）Chrome 使用这些。Chrome 的实现与地址框集成，而 Fire Fox 和 IE 在顶部角落有一个特定的搜索对话框。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-12T16:04:15.503

正如其他人所说，MSDN 属于可以说的网站类别：“Google 搜索 X 比 X 搜索 X 更好”。著名的同行包括 Wikipedia 和 StackOverflow。

为了使使用 google 更容易，google 将允许您创建[自定义搜索引擎](http://www.google.com/coop/cse/)，不仅限于在特定站点内搜索，还允许您设置其他要求。例如，如果您单击我的名字以查看我的 SO 用户个人资料，您会在右上角的框中看到我有 MSDN 和 StackOverflow 搜索链接。我还没有让它工作，但最终我会让 StackOverflow 搜索设置只返回问题页面并排除用户页面或标签页面。

也就是说，您缺少的一件事是，当您使用 Microsoft 语言时，您可能*也在*使用 Visual Studio。如果是这种情况，智能感知提示在 90% 的时间里都拥有您需要的信息。所以从这个意义上说，它甚至比 php 更好，因为你甚至不需要打开 Web 浏览器。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-12T15:44:31.480

MSDN 开发人员库非常庞大；我同意手动查找东西可能很麻烦，所以我不打扰。

实际上，通常如果只指定函数名，Google 会在 MSDN 上列出前两个或三个选项。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-12T20:08:11.300

MSDN 对文档的最新版本使用以下 URL 格式：

> [http://msdn.microsoft.com/en-us/library/[Namespace.Class.Etc].aspx](http://msdn.microsoft.com/en-us/library/[Namespace.Class.Etc].aspx)

在 Firefox 中，您可以创建表单的书签：

> [http://msdn.microsoft.com/en-us/library/%s.aspx](http://msdn.microsoft.com/en-us/library/%s.aspx)

给它一个关键字，即“msdn”，然后在您的位置栏中输入：

> msdn system.web.ui.webcontrols

FF 会带你去：

> [http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.aspx](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.aspx)

Chrome 还可以让您设置这样的搜索，您还可以使用测试 url 为 Internet Explorer 创建自定义搜索提供程序：

> [http://msdn.microsoft.com/en-us/library/TEST.aspx](http://msdn.microsoft.com/en-us/library/TEST.aspx)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-06-24T21:16:51.047

还有鲜为人知的...

[http://www.google.com/microsoft.html](http://www.google.com/microsoft.html)

...不是特定于 MSDN，但它有效。:)

# delphi - TDictionary - 无效键

> ID：639232
> 
> 赞同：1
> 
> 时间：2009-03-12T15:42:06.417
> 
> 标签：delphi, delphi-2009, tdictionary

我有这样的代码：

```
type
  TMyDictionary = TDictionary<int, int>;

var
  myDict: TMyDictionary;
  k, v: integer;

  // code to fill the dictionary

  for k in myDict.Keys do
  begin
     v := myDict.Items[k];

     // other stuff
  end; 
```

随机我看到 'v := myDict.Items[k];' 上抛出异常 其中说 k 无效。

还有人看到这个吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-12T15:49:53.293

您是否`myDict`在标记为 的部分内进行修改`// other stuff`？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-20T14:56:10.150

查看 CodeCentral 我看到许多针对 TDictionary 的错误，特别是支持 for ... in ... 构造的枚举器。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-12T15:53:22.770

尝试以一种仅使用局部变量的方法重现此问题。

可能是您使用来自 2 个不同线程的变量，或者您更新了 myDict 中的元素。

我将尝试解释我关于更多复制它的答案：

您应该创建一种可以在另一台计算机上运行并显示您遇到的错误的方法。

例如（问题：我得到了除以零异常）：

```
var
   i : integer;
begin
   i := 3;
   while (i <= 0) do
   begin
     Writeln(FloatToStr(20/i));
     Dec(i);
   end;
end 
```

如果您在计算机上运行此程序，人们将得到除以零的异常。所以我能够重现这个问题。尝试创建一个尽可能简单的片段，以一致的方式重现您遇到的问题。

# sql-server - 截断字符串数据时如何回滚TSQL中的事务？

> ID：639238
> 
> 赞同：34
> 
> 时间：2009-03-12T15:43:14.697
> 
> 标签：sql-server, tsql, error-handling

目前我有一个大型导入过程，我试图将其包装在事务中，所以如果有任何问题 - 我可以回滚。我遇到的问题是，当trans里面的TSQL爆炸时，发生以下SQL错误时它不会回滚

```
Msg 8152, Level 16, State 14, Line 249
String or binary data would be truncated.
The statement has been terminated. 
```

下面包装了这个导入 TSQL

```
DECLARE @error INT
SELECT @error = 0
BEGIN TRANSACTION

--** begin import TSQL

--** end import TSQL

SELECT @error = @@error 
IF @error != 0 GOTO handle_error

COMMIT

handle_error: 
IF @error != 0 
BEGIN 
ROLLBACK 
END 
```

* * *

## 回答 #1

> 赞同：83
> 
> 时间：2009-03-12T15:53:22.253

如果您使用 SQL 2005，您可以尝试：

```
BEGIN TRANSACTION
BEGIN TRY
    --Run your Statements
    COMMIT TRANSACTION
END TRY
BEGIN CATCH
        ROLLBACK TRANSACTION
        DECLARE @Msg NVARCHAR(MAX)  
        SELECT @Msg=ERROR_MESSAGE() 
        RAISERROR('Error Occured: %s', 20, 101,@msg) WITH LOG
END CATCH 
```

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2009-03-12T15:45:02.930

开启[xact_abort怎么样](http://msdn.microsoft.com/en-us/library/ms188792.aspx)

```
set xact_abort on 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-12T19:24:37.973

我还要指出，如果您经常收到此错误，则需要修改要输入数据的列的大小或调整清理过程以在将数据放入 prod 表之前对其进行准备。在 SSIS 中，您还可以将不符合标准大小的数据转到错误的数据表并处理其余部分。

# visual-studio - 将鼠标悬停在 Visual Studio '08 中的自动隐藏面板/工具栏上时缩短延迟

> ID：639239
> 
> 赞同：1
> 
> 时间：2009-03-12T15:43:27.910
> 
> 标签：visual-studio, visual-studio-2008, ide

我已禁用自动隐藏面板或工具栏的动画，但我想缩短悬停在它们上方的延迟。有人知道我该怎么做。我在环境设置中没有找到选项。

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-12T17:47:21.060

`Tools`然后`Options`then `Environment`then`General`有一个复选框`Animate environment tools`。下面是一个滑块，可让您调整速度。- 更慢，+ 更快。或者干脆把它关掉。

我现在看到您希望在面板弹出之前缩短延迟。我看不出哪里可以配置。

# java - .NET 等效或替代 Java 的 GlyphVector？

> ID：639243
> 
> 赞同：22
> 
> 时间：2009-03-12T15:44:25.677
> 
> 标签：java, .net, graphics, text, ikvm

[我正在使用IKVM](http://ikvm.sourceforge.net)将 Java 程序移植到 .NET 。不幸的是，IKVM 的 Graphics2D 实现在[drawGlyphVector](http://java.sun.com/j2se/1.4.2/docs/api/java/awt/Graphics2D.html)中抛出 NotImplementedException ，即它需要用 .NET 实现“充实”（或通过将其减少为对*已*实现的其他 IKVM Graphics2D 方法的调用）。

.NET 中的等价物有什么想法可以用来在 IKVM 中为该方法提供实现吗？

* * *

**编辑＃1**：我的第一个预感是简单地调用`GlyphVector.getOutline()`然后填充该形状。可惜`getOutline()`自己扔了`NotImplementedException`。

好吧，现在我似乎正在寻找一个替代方案`GlyphVector`：NetGlyphVector，IKVM 版本`Glyphvector`基本上只是一个存根类，几乎所有方法当前都抛出 NotImplementedExceptions ......

那么***有人知道.NET 相当于Java 的`GlyphVector`类吗？***

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-06-26T20:06:27.540

.NET 中还没有等价物。来自微软的网站：

> 在 Java 语言中，此类表示字形的集合，并包含每个字形在变换后的坐标空间中的位置的几何信息。
> 
> 在 .NET Framework 中，没有直接的等价物。

[http://technet.microsoft.com/en-us/subscriptions/b6s81f68%28v=vs.80%29.aspx](http://technet.microsoft.com/en-us/subscriptions/b6s81f68%28v=vs.80%29.aspx)

您可能应该只创建自己的类并使用 Java 源代码实现所需的方法，否则您将不得不找到另一种方法来转换您的代码。

# c++ - C++ 协变模板

> ID：639248
> 
> 赞同：21
> 
> 时间：2009-03-12T15:46:27.060
> 
> 标签：c++, templates, covariance

我觉得以前有人问过这个问题，但是我在 SO 上找不到它，在 Google 上也找不到任何有用的东西。也许“协变”不是我要找的词，但这个概念与函数的协变返回类型非常相似，所以我认为它可能是正确的。这是我想做的，它给了我一个编译器错误：

```
class Base;
class Derived : public Base;

SmartPtr<Derived> d = new Derived;
SmartPtr<Base> b = d; // compiler error 
```

假设这些课程完全充实......我想你明白了。由于某些不清楚的原因，它无法将 a 转换`SmartPtr<Derived>`为 a 。`SmartPtr<Base>`我记得这在 C++ 和许多其他语言中很正常，但目前我不记得为什么。

我的根本问题是：执行此分配操作的最佳方法是什么？目前，我将指针从 中拉出`SmartPtr`，显式地将其向上转换为基本类型，然后将其包装在`SmartPtr`适当类型的新类型中（请注意，这不会泄漏资源，因为我们的本土`SmartPtr`类使用侵入式引用计数）。那很长而且很乱，尤其是当我需要将其包装`SmartPtr`在另一个对象中时……有什么快捷方式吗？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-03-12T15:57:01.730

`SmartPtr<Base>`并且`SmartPtr<Derived>`是`SmartPtr`模板的两个不同实例。`Base`这些新类不共享继承`Derived`。因此，你的问题。

> 执行此分配操作的最佳方法是什么？

```
 SmartPtr<Base> b = d; 
```

不调用赋值运算符。这会调用 copy-ctor（副本在大多数情况下会被省略），就像您写的一样：

```
 SmartPtr<Base> b(d); 
```

提供一个接受`SmartPtr<OtherType>`并实现它的复制ctor。赋值运算符也是如此。你必须写出 copy-ctor 和 op= 记住 SmartPtr 的语义。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-03-12T15:56:22.620

复制构造函数和赋值运算符都应该能够采用不同类型的 SmartPtr 并尝试将指针从一个复制到另一个。如果类型不兼容，编译器会抱怨，如果它们兼容，你的问题就解决了。像这样的东西：

```
template<class Type> class SmartPtr
{
    ....
    template<class OtherType> SmartPtr(const SmartPtr<OtherType> &blah) // same logic as the SmartPtr<Type> copy constructor

    template<class OtherType> SmartPtr<Type> &operator=(const SmartPtr<OtherType> &blah) // same logic as the SmartPtr<Type> assignment operator
}; 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-12T16:02:58.847

模板不是协变的，这很好；想象一下在以下情况下会发生什么：

```
vector<Apple*> va;
va.push_back(new Apple);

// Now, if templates were covariants, a vector<Apple*> could be
// cast to a vector<Fruit*>
vector<Fruit*> & vf = va;
vf.push_back(new Orange); // Bam, we just added an Orange among the Apples! 
```

为了实现你想要做的事情，SmartPointer 类必须有一个模板化的构造函数，它接受另一个 SmartPointer 或另一个类型的指针。你可以看看 boost::shared_ptr，它就是这样做的。

```
template <typename T>
class SmartPointer {

    T * ptr;

  public:
    SmartPointer(T * p) : ptr(p) {}
    SmartPointer(const SmartPointer & sp) : ptr(sp.ptr) {}

    template <typename U>
    SmartPointer(U * p) : ptr(p) {}

    template <typename U>
    SmartPointer(const SmartPointer<U> & sp) : ptr(sp.ptr) {}

    // Do the same for operator= (even though it's not used in your example)
}; 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-12T15:56:05.883

取决于`SmartPtr`班级。如果它有一个复制构造函数（或者在你的情况下，赋值运算符）`SmartPtr<T>`，其中 T 是它构造的类型，那么它不会工作，因为即使 T1 和 T2 通过继承相关也`SmartPtr<T1>`无关`SmartPtr<T2>`.

但是，如果 SmartPtr 有一个*模板化*的复制构造函数/赋值运算符，带有模板参数`TOther`，接受`SmartPtr<TOther>`，那么它应该可以工作。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-12T15:56:28.253

假设您可以控制 SmartPtr 类，解决方案是提供一个模板化构造函数：

```
template <class T>
class SmartPtr
{
    T *ptr;
public:

    // Note that this IS NOT a copy constructor, just another constructor that takes 
    // a similar looking class.
    template <class O>
    SmartPtr(const SmartPtr<O> &src)
    {
        ptr = src.GetPtr();
    }
    // And likewise with assignment operator.
}; 
```

如果 T 和 O 类型兼容，它将起作用，如果不兼容，则会出现编译错误。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-12T17:26:22.903

我认为最简单的方法是根据以下内容自动转换为另一个 SmartPtr：

```
template <class T>
class SmartPtr
{
public:
    SmartPtr(T *ptr) { t = ptr; }
    operator T * () const { return t; }
    template <class Q> operator SmartPtr<Q> () const
    { return SmartPtr<Q>(static_cast<Q *>(static_cast<T *>(* this))); }
private:
    T *t;
}; 
```

请注意，这个实现是健壮的，因为转换运算符模板不需要了解智能指针的语义，因此不需要复制引用计数等。

# asp.net-mvc - Webform 属性上的内联代码

> ID：639250
> 
> 赞同：3
> 
> 时间：2009-03-12T15:47:34.717
> 
> 标签：asp.net-mvc, webforms, inline-code

为什么渲染时不显示日期/时间？

```
<asp:Label runat="server" ID="test" Text="<%= DateTime.Now.ToString() %>" ></asp:Label> 
```

有没有办法使这项工作？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-12T15:52:29.353

Asp.net 服务器控件不能很好地与 <%= 配合使用，您可以这样做：

```
<span><%= DateTime.Now.ToString() %></span> 
```

附言。您也可以在代码隐藏上设置标签的文本。在 PreRenderComplete 上设置它可能适用于您的场景。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-12T17:04:05.003

我不确定您是否有代码隐藏文件，但如果您确实需要`Text`在 .aspx 标记中设置标签的属性，您可以在页面中添加以下代码：

```
<script runat="server">
    protected override void OnPreLoad(EventArgs e)
    {
        if (!Page.IsPostBack)
        {
            this.test.Text = DateTime.Now.ToString();
            base.OnPreLoad(e);
        }
    }
</script> 
```

这样，您可以在回发时维护标签控件的状态。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-11-07T12:03:00.617

将内联代码放在标签的标签内，如下所示，

```
< asp:Label ID="Lbl" runat="server" Text="">
<%= DateTime.Now.ToString() %>
< /asp:Label> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-12T16:07:57.180

但这里真正的问题是我需要在标记页面上使用代码设置 WebControl 的属性。我发现这样做的唯一方法是将整个控件放在代码块中。它不是优雅的或建议的，但是当所有其他方法都失败时，这将起作用。

```
 <%
        var stringBuilder = new StringBuilder();
        var stringWriter = new StringWriter(stringBuilder);
        var htmlWriter = new HtmlTextWriter(stringWriter);
        var label = new Label { Text = DateTime.Now.ToString() };
        label.RenderControl(htmlWriter);
        Response.Write(stringBuilder.ToString());
     %> 
```

但是，如果您需要控件来维护状态，这将不起作用。

更新：

在研究了 Kev 的答案后，我确实找到了更好的解决方案。我没有后面的代码（它是一个 MVC 页面），但您仍然可以通过代码块引用页面上的控件，因此我的新解决方案如下。注意 - 您必须先放置代码块才能使其工作。

```
 <%
    lblTest.Text = DateTime.Now.ToString();
 %>
<asp:label runat="server" ID="lblTest" /> 
```

感谢Kev的灵感！

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-12T15:49:43.387

那么asp标签被渲染了。您必须在运行时设置该属性。或者只是做`<%= DateTime.Now.ToString() %>`.

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-12T17:13:55.353

完成这项工作的最简单方法是使用数据绑定表达式代替代码渲染块......

```
<asp:Label runat="server" ID="test" Text="<%# DateTime.Now.ToString() %>" ></asp:Label> 
```

现在，每当调用 Page.DataBind() 时都会设置 Text 属性，因此在您的代码隐藏中，您将需要类似

```
protected override void OnPreRender(EventArgs e)
{
    if (!Page.IsPostBack)
    {
        DataBind();
    }

   base.OnPreRender(e);
} 
```

# excel - ChartType = xlXYScatterSmoothNoMarkers 的平滑公式

> ID：639254
> 
> 赞同：0
> 
> 时间：2009-03-12T15:49:16.117
> 
> 标签：excel

是否有任何参考资料可以查找用于生成线条的特定平滑公式`ChartType = xlXYScatterSmoothNoMarkers`？它是在标记点处带有结的自然三次样条吗？我正在尝试在复制这条平滑线的 stata 中编写公式。谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-09-28T03:58:25.927

我不知道 Excel 使用什么公式进行平滑处理，但是如果您描述最终要绘制的内容，那将会很有帮助。这是平滑的Stata示例：

```
 sysuse auto, clear

        twoway scatter weight length, mcolor(*.8) || /*
        */  lpoly weight length, || lowess weight length /*
        */ , by(foreign) 
```

# sql-server - JOIN 性能：复合键与 BigInt 主键

> ID：639255
> 
> 赞同：1
> 
> 时间：2009-03-12T15:49:23.030
> 
> 标签：sql-server, sql-server-2008, join

我们有一个表将是 1 亿到 10 亿行（表名：存档）

该表将从另一个表“用户”中引用。

Archive 表上的主键有 2 个选项：

选项 1：dataID (bigint)

选项 2：用户 ID + 日期时间（4 字节版本）。

架构：

用户 - 用户 ID (int)

存档 - 用户 ID - 日期时间

或者

存档 - dataID（大整数）

哪个会更快？

我们回避使用 Option#1，因为 bigint 是 8 个字节，并且有 1 亿行，这将增加分配的存储空间。

**更新** 好吧对不起我忘了提，userID 和 datetime 必须不管，所以这就是不向表中添加另一列 dataID 的原因。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-12T15:55:46.303

一些想法，但可能没有明确的解决方案：

*   如果您有 10 亿行，为什么不使用从 -21 亿到 +21 亿的 int 呢？

*   Userid, int, 4 bytes + smalldatetime, 4 bytes = 8 bytes, 同 bigint

*   如果您正在考虑 userid + smalldatetime，那么无论如何这肯定很有用。如果是这样，添加代理“archiveID”列无论如何都会增加空间

*   您是否需要按用户 ID + smalldatetime 过滤/排序？

*   确保你的模型是正确的，以后再担心 JOIN ......

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-12T17:04:00.820

**关注点：**使用 UserID/[small]datetime 会带来不唯一的高风险。

这是一些真实的模式。这就是你在说的吗？

```
-- Users (regardless of Archive choice)
CREATE TABLE dbo.Users (
    userID      int           NOT NULL  IDENTITY,
    <other columns>
    CONSTRAINT <name> PRIMARY KEY CLUSTERED (userID)
)

-- Archive option 1
CREATE TABLE dbo.Archive (
    dataID      bigint        NOT NULL  IDENTITY,
    userID      int           NOT NULL,
    [datetime]  smalldatetime NOT NULL,
    <other columns>
    CONSTRAINT <name> PRIMARY KEY CLUSTERED (dataID)
)

-- Archive option 2
CREATE TABLE dbo.Archive (
    userID      int           NOT NULL,
    [datetime]  smalldatetime NOT NULL,
    <other columns>
    CONSTRAINT <name> PRIMARY KEY CLUSTERED (userID, [datetime] DESC)
)
CREATE NONCLUSTERED INDEX <name> ON dbo.Archive (
    userID,
    [datetime] DESC
) 
```

如果这是我的决定，我肯定会选择选项 1。磁盘很便宜。

如果您选择选项 2，很可能您必须在 PK 中添加一些其他列以使其独一无二，然后您的设计开始退化。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-12T15:56:36.817

选项 3 是什么：将 dataID 设为 4 字节整数？

另外，如果我理解正确，存档表将从用户表中引用，因此在存档表中包含 userID 甚至没有多大意义。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-12T15:59:05.313

我建议您设置一个模拟以在您的环境中验证这一点，但我的猜测是单个 bigint 通常会更快；但是，当您查询表格时，您将查询什么？

如果我正在构建一个档案库，我可能倾向于拥有一个自动增量身份字段，然后使用分区方案根据 DateTime 和可能的用户 ID 进行分区，但这取决于具体情况。

# latex - 制作 LaTeX Beamer 黑白

> ID：639260
> 
> 赞同：5
> 
> 时间：2009-03-12T15:50:28.487
> 
> 标签：latex, pdflatex, beamer

有没有办法让 LaTeX Beamer 输出黑白？我需要它来打印纸张。我正在使用默认颜色主题，出于对比原因，我需要标题和所有内容都是黑色的。如果有黑白配色方案，我可以使用它，但否则我不想要其他配色方案，有彩色背景。也许有一些我可以重新定义的命令？

谢谢。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2011-03-28T11:26:19.203

您也可以`gray`在声明中添加选项`documentclass`：

```
\documentclass[gray]{beamer}
... 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-12T16:25:28.167

好的，经过一番搜索，找到了。答案是：

```
\setbeamercolor{frametitle}{fg=black} 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-03-17T18:59:26.410

事实上，您可以使用`\setbeamercolor`. 您可以使用 fg 更改前景，使用 bg 更改背景。这样做的问题是你不能使用传统的 rbg 方案，你必须用一种不太友好的方式来制作非常奇怪的颜色组合，以提供你想要组合的每种颜色的份额

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2019-02-27T15:50:49.920

另一种可能性是使用`\selectcolormodel{gray}`

```
\documentclass{beamer}
\usetheme{CambridgeUS}

\selectcolormodel{gray}

\begin{document}
\begin{frame}
\titlepage
\end{frame}
\end{document} 
```

# .net - Compact Framework 3.5 上 MethodBase.GetCurrentMethod() 的解决方法

> ID：639263
> 
> 赞同：2
> 
> 时间：2009-03-12T15:51:28.220
> 
> 标签：.net, linq, generics, reflection, compact-framework

我想在 .NET Compact Framework 的项目中使用 Linq IQueryable Toolkit。CF 中的 Linq 功能有点不同 - 即：IQueryable 接口不可用。所以我找到了第三方库，它实现了我需要的缺失功能。

现在我遇到了缺少方法“MethodBase.GetCurrentMethod()”的问题。有 cca​​ 100 方法，使用这种方法。所以我不需要“GetCurrentMethod()”的确切克隆。这种特定情况的解决方法就足够了。

原始代码示例：

```
public static bool Any<TSource>( this IQueryable<TSource> source ) {
    return source.Provider.Execute<bool>( Expression.Call( null, ((MethodInfo)MethodBase.GetCurrentMethod()).MakeGenericMethod( new Type[] { typeof( TSource ) } ), new Expression[] { source.Expression } ) );
}

public static bool Any<TSource>( this IQueryable<TSource> source, Expression<Func<TSource, bool>> predicate ) {
    return source.Provider.Execute<bool>( Expression.Call( null, ((MethodInfo)MethodBase.GetCurrentMethod()).MakeGenericMethod( new Type[] { typeof( TSource ) } ), new Expression[] { source.Expression, Expression.Quote( predicate ) } ) );
} 
```

可行的解决方案是将“（MethodInfo）MethodBase.GetCurrentMethod（）”替换为特定的方法调用。例如：GetMethod_Any_TSource_On_Source() 和 GetMethod_Any_TSource_On_Source_With_Predicate_TSource_Bool()。

我寻找一些方便的解决方案如何解决它。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-22T18:19:15.003

看到[这个讨论](http://social.msdn.microsoft.com/Forums/en-US/netfxcompact/thread/3c958ba2-fb35-4c77-987c-520dd6338c90)

在 Compact Framework 1.0 的纯托管代码中，这基本上是不可能的。

在 2.0 中是可能的，但容易出错，脆弱，最重要的是不能保证是正确的（一个严重的缺陷）。

我建议改为编写一个宏，它可以找到“（（MethodInfo）MethodBase.GetCurrentMethod（））”的所有实例并确定它们所在的方法。

像这样简单地转换每一行

```
".*\(\(MethodInfo\)MethodBase\.GetCurrentMethod\(\)\).*" 
```

抛出新异常((MethodInfo)MethodBase.GetCurrentMethod()).Name);

*   为非紧凑框架编译（手动修复正则表达式替换损坏的位置，应该不多）
*   运行通过反射发生替换的类中的每个方法
*   捕获产生的异常并打印消息（方法名称）和堆栈跟踪的第一行。

然后，这会为您提供一个列表，其中列出了您需要直接在每个呼叫站点输入的内容（可能由一个惰性创建的静态字段备份，该字段为每个呼叫站点保存 MethodInfo。

这很麻烦，但作为一个一次性的预框架更新可能工作得相当好，但老实说，它可能同样快地完成并手动完成。

# java - 正则表达式用于在用引号括起来时删除字符串中的逗号

> ID：639264
> 
> 赞同：4
> 
> 时间：2009-03-12T15:51:28.797
> 
> 标签：java, regex

仅当用引号括起来时，我才需要删除字符串中的逗号。

例子：

```
String a = "123, \"Anders, Jr.\", John, john.anders@company.com,A" 
```

更换后应该

```
String a = "123, Anders Jr., John, john.anders@company.com,A" 
```

你能给我示例java代码来做到这一点吗？

非常感谢，

丽娜

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-12T16:03:48.173

从您的示例来看，您似乎还需要删除引号。

你不能在一个正则表达式中做到这一点。您需要匹配每个实例

```
"[^"]*" 
```

然后去掉周围的引号并替换逗号。有没有其他麻烦的角色？可以在引号内转义引号字符，例如。作为 '””'？

看起来您正在尝试解析 CSV。如果是这样，正则表达式不足以完成任务，您应该查看许多免费的 Java CSV 解析器之一。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-12T21:35:01.887

我相信你要求一个正则表达式试图获得一个“优雅”的解决方案，但也许一个“正常”的答案更适合你的需求......这个完美地得到了你的例子，虽然我没有检查像两个这样的边界情况引号一起，所以如果你要使用我的例子，请彻底检查

```
布尔删除逗号=假；
for(int i=0; i > a.length(); i++){
    if(a.charAt(i)=='\"'){
        a = a.substring(0, i) + a.substring(i+1, a.length());
        deleteCommas = !deleteCommas;
    }
    if(a.charAt(i)==','&&deleteCommas){
        a = a.substring(0, i) + a.substring(i+1, a.length());
    }
}

```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-13T03:55:59.257

接受的答案有两个主要问题。首先，`"(.*)\"(.*),(.*)\"(.*)"`如果匹配任何内容，正则表达式将匹配整个字符串，因此它最多会删除一个逗号和两个引号。

其次，没有什么可以确保逗号和引号都属于同一字段；`("foo", "bar")`给定它会返回的输入`("foo "bar)`。它也不考虑换行符或转义引号，这两者在带引号的字段中都是允许的。

您可以使用正则表达式来解析 CSV 数据，但它比大多数人预期的要复杂得多。[但是，正如 bobince 指出的那样](https://stackoverflow.com/questions/639264/regex-for-removing-comma-in-a-string-when-it-is-enclosed-by-quotes/639311#639311)，当有几个免费的 CSV 库可供下载时，为什么还要与它抗争呢？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-12T15:55:27.880

应该管用：

```
s/(?<="[^"]*),(?=[^"]*")//g
s/"//g 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-12T16:17:31.730

这看起来像是 CSV 文件中的一行，通过任何合理的 CSV 库对其进行解析将自动为您处理此问题。至少通过将引用的值读入单个“字段”。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-12T16:17:49.077

可能非常低效，但它似乎工作。

```
import java.util.regex.*;

StringBuffer ResultString = new StringBuffer();

try {
    Pattern regex = Pattern.compile("(.*)\"(.*),(.*)\"(.*)", Pattern.CASE_INSENSITIVE | Pattern.UNICODE_CASE);
    Matcher regexMatcher = regex.matcher(a);
    while (regexMatcher.find()) {
        try {
            // You can vary the replacement text for each match on-the-fly
            regexMatcher.appendReplacement(ResultString, "$1$2$3$4");
        } catch (IllegalStateException ex) {
            // appendReplacement() called without a prior successful call to find()
        } catch (IllegalArgumentException ex) {
            // Syntax error in the replacement text (unescaped $ signs?)
        } catch (IndexOutOfBoundsException ex) {
            // Non-existent backreference used the replacement text
        } 
    }
    regexMatcher.appendTail(ResultString);
} catch (PatternSyntaxException ex) {
    // Syntax error in the regular expression
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-23T10:09:39.883

这工作正常。'<' 而不是 '>'

```
boolean deleteCommas = false;
for(int i=0; i < text.length(); i++){
    if(text.charAt(i)=='\''){
        text = text.substring(0, i) + text.substring(i+1, text.length());
        deleteCommas = !deleteCommas;
    }
    if(text.charAt(i)==','&&deleteCommas){
        text = text.substring(0, i) + text.substring(i+1, text.length());
    }
} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-23T10:36:05.670

一种更简单的方法是替换此正则表达式的匹配项：

```
("[^",]+),([^"]+") 
```

这样：

```
$1$2 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-06-23T17:25:01.707

以下 perl 适用于大多数情况：

```
open(DATA,'in/my.csv');
while(<DATA>){
  if(/(,\s*|^)"[^"]*,[^"]*"(\s*,|$)/){
    print "Before: $_";
    while(/(,\s*|^)"[^"]*,[^"]*"(\s*,|$)/){
      s/((?:^|,\s*)"[^"]*),([^"]*"(?:\s*,|$))/$1 $2/
    }
    print "After: $_";
  }
} 
```

它正在寻找：

*   （逗号加可选空格）或行首
*   报价
*   0 个或多个非引号
*   逗号
*   0 个或多个非引号
*   （可选空格加逗号）或行尾

如果找到，它将继续用空格替换逗号，直到找不到更多示例。

它之所以起作用，是因为假设开引号前面有一个逗号加可选空格（或将在行首），而右引号后面将有可选空格加逗号，或者将是结尾的线。

我敢肯定在某些情况下它会失败-如果有人可以发布它们，我很想看到它们...

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2015-09-23T21:32:54.803

我的答案不是正则表达式，但我相信它更简单、更有效。将行更改为 char 数组，然后遍历每个 char。跟踪偶数或奇数报价金额。如果奇数引号并且您有逗号，则不要添加它。应该看起来像这样。

```
public String removeCommaBetweenQuotes(String line){

    int charCount = 0;
    char[] charArray = line.toCharArray();
    StringBuilder newLine = new StringBuilder();

    for(char c : charArray){

        if(c == '"'){
            charCount++;
            newLine.append(c);
        }

        else if(charCount%2 == 1 && c == ','){
            //do nothing
        }

        else{
            newLine.append(c);
        }

    }

    return newLine.toString();

} 
```

# java - Java EE 应用程序的可伸缩性。你会如何处理它？

> ID：639275
> 
> 赞同：1
> 
> 时间：2009-03-12T15:56:18.893
> 
> 标签：java, jakarta-ee, concurrency, scalability, jms

我一直致力于金融行业的解决方案。该应用程序的主要功能是能够加载大量输入文件、消化它们、更新持久存储中的状态以及根据请求从持久存储中生成提取。很简单。

输入文件是行业标准格式的 XML 大型（超过数百兆字节）消息，其中包含许多重复条目。持久存储是关系数据库。该引擎已实现为可部署在 J2EE 应用服务器上的基于 POJO（作为主干的 Spring 框架）Java 应用程序。

问题是关于解决方案的可扩展性和性能。如果应用程序按顺序处理来自 XML 的条目，则解决方案的可伸缩性相当差。没有办法让应用程序的多个实例参与单个文件的处理。这就是我为输入 XML 文件中的条目引入并行处理的原因。基本上，这个想法是为池中的工人分派处理单个条目。我决定使用 JMS 进行调度。加载文件的组件读取流并简单地提取单个条目并提供给调度队列。队列的另一端有许多并发消费者。每个人从队列中挑选一条消息并处理该条目，它可以立即用于处理其他条目。这与 Web 容器中的 servlet 非常相似。我发现这种方法特别强大的是，只要队列是共享的，工作人员就可以驻留在部署在远程服务器上的应用程序的不同实例中。不幸的是，所有工作人员都连接到维护持久性存储的同一个数据库，如果数据库服务器的功能不足以处理来自并发工作人员的负载，这可能是一个瓶颈。

您对这种架构有何看法？你有类似的应用程序设计吗？你当时的设计选择是什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-12T16:16:10.763

您还可以查看 Hadoop，这是一个非常方便的 Map/Reduce 作业平台。巨大的优势是，所有基础设施都由 Hadoop 提供，因此您只需应用新的硬件节点来扩展。实施 Map 和 Reduce 作业应该只执行一次，在此之后，您可以为集群提供大量负载。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-12T16:08:13.903

我认为架构总体上是合理的。如果数据库在处理来自工作人员的大量并发更新时遇到问题，您可以在应用程序的另一“侧”引入第二个队列：当每个工作人员完成他们的任务时，他们将该任务的结果添加到队列。那么单个工作进程会定期从第二个队列中抓取结果对象并以大批量操作更新数据库吗？这将降低数据库并发性并可能提高更新效率。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-14T09:39:09.850

我最近花了一些空闲时间研究 Spring Batch 2.0。这是基于 Spring 框架的新版 Java 批处理引擎。实施 Spring Batch 的人专注于此版本的并发和并行执行。我必须说它看起来很有希望！

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-13T18:46:21.520

另外，看看 Terracota 集群解决方案。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-13T17:51:07.120

对于并行处理，正如 Mork0075 所说，hadoop 是一个很好的解决方案。实际上，许多公司都将它用于非常大的日志分析。一个有趣的项目 Hive 是基于 hadoop 构建的，用于数据仓库。

无论如何，我认为您当前的设计具有很大的可扩展性。至于您对所有工作人员访问数据库的担忧，您可以在工作人员和数据库之间放置另一个消息队列。工作人员将处理结果放入队列中，您构建另一个程序来订阅队列并更新数据库。缺点是两个队列可能会使系统过于复杂。当然，您可以在现有的 MQ 系统中添加另一个主题。这将使系统更简单。另一种方法是使用共享文件系统，如NFS，每台worker机器将相同的目录挂载在共享文件服务器上，每个worker将其处理结果写入共享文件服务器上的单独文件中。然后您构建一个程序来检查新文件以更新数据库。在这种方法中，您引入了另一种复杂性：共享文件服务器。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-11-17T12:00:20.007

如果您已经在使用 Spring/Java EE，那么将 Spring Batch 作为“并发架构”的解决方案是很自然的。

蝙蝠的两个好处：

1.  Spring Batch（从 2.0 开始）实现了分区，这意味着框架将在单独的分区步骤（`StepExecution`）中为您处理分区数据，并将这些步骤的实际执行委托给多个线程或其他分布式系统（`PartitionHandlers`例如，`TaskExecutorPartitionHandler`或更加分散`MessageChannelPartitionHandler`，等等。）

2.  Spring 有一个很好的 OXM 包来处理 XML + Spring Batch 有一个`StaxEventItemReader`从输入 XML 文档中提取片段，这些片段对应于要处理的记录

试试 Spring Batch。如果您有任何问题，请告诉我，我很乐意为您提供帮助。

`EDIT:`

另请查看`Scala/AKKA Actors`和/或`Scala parallel collections`。如果您的任务适用于分片/分区/分布式 => 那就是 Actor 模型的用途。

如果您想考虑非 JVM 解决方案，请查看`Erlang OTP`=> 简单而优雅。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-04-10T22:02:58.743

在回答您的问题时：

> 您对这种架构有何看法？你有类似的应用程序设计吗？你当时的设计选择是什么？

我认为这是一个很好的架构，你说得对，数据库是你的瓶颈。但是，设计足够灵活，您可以控制数据库的输入量。

我有跨节点的多线程工作。我不完全确定 Haddoop 或其他分布式处理系统会给你比你已经拥有的更多，因为你只是对数据库进行 I/O。

我已经使用 JMS 队列实现了一些类似的集中式日志记录，它工作得很好，对代码的影响较小，然后将日志写入磁盘。我认为它适用于您的应用程序。

# windows - 有没有办法查看进程正在使用的每个核心的 CPU 使用量？

> ID：639277
> 
> 赞同：7
> 
> 时间：2009-03-12T15:56:27.957
> 
> 标签：windows, performance, multicore, cpu-usage

我知道在 perfmon 中，您可以看到每个内核的使用量，以及特定进程使用的总 CPU 量。但是，我似乎无法找到一种方法来查看一个进程正在使用多少 CPU，按内核划分。

是否有内置方法可以查看此信息？有没有一种程序化的方式来查看这个？（首选 C#）我是否通过提出这个问题来证明对 Windows（Vista）如何处理核心使用和上下文切换的误解？

编辑：更多澄清我想知道的内容。我的进程仅使用 30-40% 的总 CPU（在四核上）是因为它没有足够的多线程来利用更多，还是因为它太受 I/O 限制并且磁盘访问是瓶颈？

那么根本就没有办法做到这一点吗？（除了确保计算机上没有其他 CPU 活动）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-12T15:58:26.407

Process Explorer 至少可以向您显示给定进程的线程以及它们正在使用多少 CPU。也许您可以以某种方式获得线程正在运行的核心/cpu，然后加起来。不过，我没有太多 WinAPI 经验。所以也许处理器亲和力只能在进程上查询。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-12T16:09:37.550

您无法直接获取给定进程的每个处理器的周期时间，但您可以随着时间的推移估计它`QueryIdleProcessorCycleTime`（因为它返回所有逻辑处理器（即核心）的空闲时间）`QueryProcessCycleTime`并假设它是唯一的非空转进程运行。

# math - 如果没有 ARCTAN2(n,m) 的便利，我应该如何处理 ARCTAN（并防止除以零）？

> ID：639283
> 
> 赞同：4
> 
> 时间：2009-03-12T15:56:56.363
> 
> 标签：math, trigonometry, divide-by-zero

我试图确定从一点`(n,m)`到的角度`(0,0)`。在没有`arctan2`可用的情况下，我`m`遇到了可能为 0 的问题，这导致可能被零除。

解决这个问题的优雅、正确的解决方案是什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-12T16:43:16.270

不要使用传统的象限，使用由线 y = +/- x 定义的分支点，并使用类似 CORDIC 的算法的第一步两步（例如，将坐标旋转已知角度并跟踪您'已经旋转）：

```
function atan2_substitute(x,y)
{
   double angle = 0;
   if (x < y)
   { angle = M_PI; x = -x; y = -y; }
   // this guarantees that the angle is between -135 and +45 degrees

   if (x < -y)
   {
     angle -= M_PI/2; tmp = x; x = -y; y = tmp;
   }
   // this guarantees that the angle is between -45 and +45

   angle += atan(y/x);

   if (angle > M_PI)
      angle -= 2*M_PI;
   // fails at 0,0; otherwise is accurate over the entire plane
} 
```

这样做的原因是 atan() 对于 -1 和 +1 之间的比率 y/x 可能比对于大于 1 的比率更准确。（尽管一个好的 atan() 算法会认识到这一点并且取倒数）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-12T16:13:50.893

如果 atan2 不可用，您必须检查代码中的除以零条件和所有其他特殊情况。就这么简单。atan2 上的维基百科条目具有您需要的所有条件。

如果您的目标硬件支持浮点运算的除零异常，您还有另一个选择：

安装一个低级处理程序来检查异常原因，如果它碰巧是一个 atan 部门，请修复问题。如果异常很少，这将使您的 atan2 更快，但它需要低级别的修补并且不可移植。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-01-25T09:46:25.850

使用 Taylor 级数实现标准`arctan(n, m)`，并在计算 arctan 之前执行以下操作：

```
if (m == 0) {
    if (n < 0) return Pi;
    return 0;
} 
```

还有一些技巧：

1）如果`|m| < |n|`，交换`m, n`然后计算arctan。最后减去结果`Pi/2`

2) 如果`|m|`接近`|n|`，则使用半角公式 计算半角的反正切 `arctan(x) = 2*arctan(x/(1+sqrt(1+x*x)))`，否则，对于这样的值，反正切收敛非常慢

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-12T16:09:23.790

定义您的`arctan2`. C 中作为宏的示例：

```
#define atan2(n,m)   (m)==0 ? M_PI_2 : atan((n)/(m)) 
```

当然，您可以详细说明根据 和 的符号找到`n`象限`m`。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-12T16:24:25.767

我相信这是使用 atan 的 atan2 的正确实现（虽然不处理无穷大）：

```
float my_atan2(float y, float x)
{
    if(x == 0) // might also want to use fabs(x) < 1e-6 or something like that
    {
        if(y > 0)
            return M_PI_2;
        else
            return -M_PI_2;
    }
    else if(x > 0)
    {
        return atan(y/x);
    }
    else 
    {
        // x < 0                                                                                
        if(y > 0)
            return M_PI + atan(y/x);
        else
            return -M_PI + atan(y/x);
    }
} 
```

测试线束：

```
int main()
{
    for(int i = -360; i <= 360; i++)
    {
        float x = cos(i / 180.0 * M_PI);
        float y = sin(i / 180.0 * M_PI);

        float good = atan2(y, x);
        float mine = my_atan2(y, x);

        if(fabs(good - mine) > 1e-6)
        {
            printf("%d %f %f %f %f\n", i, x, y, good, mine);
        }
    }
} 
```

# database - 何时应将列映射到代码中的 Enum 类型

> ID：639289
> 
> 赞同：1
> 
> 时间：2009-03-12T15:59:02.863
> 
> 标签：database, enums

也许这是一个愚蠢的问题，但是什么时候应该将列映射到枚举类型。例如，我们都知道数据库中表示为“M”或“F”的列“Gender”可以映射到一个名为Gender的枚举。由于通常有 2 种性别 :)，我们可以确定这个枚举不需要更新。但是，为业务逻辑设置的枚举呢？例如，假设区域，如果您有一个 Enum 代表数据库中的所有区域，则每当您将另一个区域插入数据库时​​，该枚举必须更改，因此需要另一个提升。这是一个好习惯吗？是否有最佳实践？

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-12T16:13:31.317

这实际上是一个复杂的问题：当您使用枚举时，按照 Reed 的建议，在数据库中也有一个查找表是传统的做法。但这提出了同步定义的问题。

我们所做的是从枚举定义生成表，作为我们构建/部署脚本的一部分，以确保两者反映相同的合法值集。

然后我们有方便的函数，它接受从 DB 查询返回的 DataSet，并将 id 列映射到具有枚举值的（新创建的）列。但我们会在检索到查询结果后立即执行此操作。所以我的建议是尽快映射它们，最好是在你的 DAL 中。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-12T16:02:18.550

您最好为区域创建一个单独的表，并使用它自己的唯一 ID。然后在您的主表中使用该地区的 ID。

这为将来提供了更大的灵活性，因为添加区域只是添加新记录。

有关详细信息和完整说明，请参阅有关数据库规范化的任何文本。

# c# - 有没有办法像 ArrayList 一样对待 ac# 静态数组？

> ID：639292
> 
> 赞同：2
> 
> 时间：2009-03-12T15:59:34.220
> 
> 标签：c#, arrays, arraylist

我有使用数组的代码，不幸的是，我无法更改它们的类型。如果可以的话，我会使用 ArrayLists 或类似的东西来做我需要做的事情，但我不能。基本上，我正在寻找从静态数组中添加和删除对象的最佳方法。为了动态地向数组中添加一个项目，我必须创建一个比旧数组大一个元素的新数组，将旧数组中的项目复制到新数组中，然后添加新项目。像这样的东西......

```
public partial class dataStruct 
{
    private myObject[] myStaticArray;
};

private void AddItemToMyArray()
{
    int oldLength = dataStruct.myStaticArray.Length;
    myObject[] newMyObjectArray = new myObject[oldLength + 1];
    for (int i = 0; i < oldLength; i++)
       newMyObjectArray [i] = dataStruct.myStaticArray[i];

    dataStruct.myStaticArray[oldLength] = new myObject();
    dataStruct.myStaticArray = newMyObjectArray;
} 
```

为了删除一个项目，我做同样的事情，只是我创建了一个小一个项目的新数组。这感觉真的效率低下。任何人都可以提出更好的方法，如果有的话？或任何其他想法？

提前感谢您的所有帮助！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-12T16:03:04.650

否 - 数组始终是固定大小。您不能从中添加/删除条目。

这正是有效解决的[`ArrayList`](http://msdn.microsoft.com/en-us/library/system.collections.arraylist.aspx)限制[`List<T>`](http://msdn.microsoft.com/en-us/library/6sh2ey19.aspx)。它们在内部维护一个数组，但通常大于列表的逻辑大小。当您向 a 添加项目时，`List<T>`如果可以，它将填充现有数组，或者如果没有足够的空间，它将创建一个新的更大的数组并将内容复制到其中。但是，此更改对调用者是透明的 - 您仍然可以使用原始引用，因为它是对列表的引用，而不是对底层数组的引用。

使您的代码*更简单*（但可能不会更有效）的一件事是使用[Array.Resize](http://msdn.microsoft.com/en-us/library/bb348051.aspx)。它不会调整*现有*数组的大小，而是返回一个新数组，其中包含旧内容的浅表副本，大小为您请求的大小。复制可能比手动循环快一点，但效率低下的主要原因仍然存在。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-12T16:02:07.553

为什么要在这里使用数组？切换到`List<T>`, 或（如果您需要从中间有效移除/插入） a `LinkedList<T>`.

我不确定您是否按照我的意思表示“静态”-您能澄清一下吗？

有关信息，您可以使用`Array.Resize(ref myArray, newSize)`，但这不是频繁更改的正确答案。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-12T16:24:12.960

> 不幸的是，我不能改变他们的类型

为什么不？唯一合理的答案是您有一个 API，您必须将其与返回它们或要求它们作为参数的函数一起使用。在这种情况下，根据需要使用`List<T>`和调用它的`.ToArray()`或`.AddRange()`方法。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-12T16:09:01.360

从它的声音来看，您无法更改数据结构，因此必须处理数组。

你唯一能得到帮助的就是你可以避免循环并做一个 Array.copy

```
int oldLength = dataStruct.myStaticArray.Length;
myObject[] newMyObjectArray = new myObject[oldLength + 1];
Array.copy(dataStruct.myStaticArray, newMyObjectArray, oldLength);

dataStruct.myStaticArray[oldLength] = new myObject();
dataStruct.myStaticArray = newMyObjectArray; 
```

编辑实际上这可能有效：

```
int oldLength = dataStruct.myStaticArray.Length;
Array.Resize(dataStruct.myStaticArray, oldLength+1); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-12T16:04:17.283

您基本上是在编写自己的列表，但效率较低。

List 在内部执行您所描述的操作，但在性能方面存在很大差异。

当它重新分配其内部数组时，它不仅添加了一个新元素，而且添加了它们的一个块。这样，未来的添加并不总是需要重新分配。这是列表的“容量” - 以及为什么列表容量总是 >= 列表的大小。

如果你必须这样做，我建议你做类似的事情。但是，切换到 List 将是一个更好的选择。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-12T16:05:05.767

您可以做的任何事情来使数组更像`ArrayList`or`List<T>`只会导致您最终重新实现这些类的部分（或全部）。正如其他答案所述，最好的方法是使用内置类。

# .net - 如何在.net中序列化集合

> ID：639303
> 
> 赞同：4
> 
> 时间：2009-03-12T16:02:20.533
> 
> 标签：.net, serialization

我想从我的 app.config 文件中序列化一组用于存储/检索的对象。[（我正在使用来自 Jeff Attwood 的博客条目The Last Configuration Section Handler.. Revisited](http://www.codinghorror.com/blog/archives/000656.html)的示例中的代码）。

我想知道的是为什么类型对象的集合

```
public class MyClass
{
  ...
} 
```

序列化为一个名为的 xml 元素

```
<ArrayOfMyClass>...</ArrayOfMyClass> 
```

在此示例中，我使用了 MyClass 对象的通用列表。我还尝试创建一个从 List 继承的新类，并且生成的 xml 完全相同。

有没有办法覆盖序列化/反序列化时使用的 xml 元素名称？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-12T16:10:51.493

当你从 List 继承时，你可以尝试一些类似的东西

```
[Serializable]
[System.Xml.Serialization.XmlRoot("SuperDuperCollection")]
public class SuperDuperCollection : List<MyClass> { ... } 
```

为了装饰您的类，使用不同的 XmlAttributes 应该可以让您控制 XML 在序列化时的输出方式。

只需使用一些测试代码和输出进行额外编辑：

```
[Serializable]
public class MyClass
{
public int SomeIdentifier { get; set; }
public string SomeData { get; set; }
}

....

SuperDuperCollection coll = new SuperDuperCollection
{
    new MyClass{ SomeData = "Hello", SomeIdentifier = 1},
    new MyClass{ SomeData = "World", SomeIdentifier = 2}
};

Console.WriteLine(XmlSerializeToString(coll)); 
```

输出：

```
<SuperDuperCollection xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema">
  <MyClass>
    <SomeIdentifier>1</SomeIdentifier>
    <SomeData>Hello</SomeData>
  </MyClass>
  <MyClass>
    <SomeIdentifier>2</SomeIdentifier>
    <SomeData>World</SomeData>
  </MyClass>
</SuperDuperCollection> 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-12T16:07:28.553

如果它们是某种类型的子元素，则它们不会 - 您可以使用`[XmlRoot]`、`[XmlType]`和`[XmlElement]`和以各种组合来获得不同的结果 - 不幸的是，具体情况取决于确切的布局......`[XmlArray]``[XmlArrayItem]`

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-12T16:07:59.037

看一下[XmlArrayAttribute](http://msdn.microsoft.com/en-us/library/system.xml.serialization.xmlarrayattribute.aspx)属性

# transactions - LLBLGen Pro 中的事务

> ID：639313
> 
> 赞同：0
> 
> 时间：2009-03-12T16:04:03.197
> 
> 标签：transactions, llblgenpro

我正在使用带有自助服务的 LLBLGen Pro 2.5。如果我想在事务中将一些行添加到我的表中，然后更新我添加的第一行，我是否必须再次将第一个实体添加到事务对象中？

这是我的意思的一个虚构示例：

```
Dim objCustomer as New CustomerEntity()
Dim trans as new Transaction(IsolationLevel.ReadCommitted, "AddRecord")
objCustomer.FirstName = "John"
objCustomer.LastName = "Locke"
objCustomer.DateCreated = DateTime.Now
trans.Add(objCustomer)
objCustomer.Save()

Dim objOrder as New OrderEntity()
objOrder.CustomerID = objCustomer.CustomerID
objOrder.OrderDate = DateTime.Now
trans.Add(objOrder)
objOrder.Save()

objCustomer.FirstOrderID = objOrder.OrderID
trans.Add(objCustomer) 'DO I DO THIS??????
objCustomer.Save()

trans.Commit() 
```

任何建议将不胜感激！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-31T15:12:10.380

不，您不必再次添加它。您只需再次保存即可。我使用适配器而不是自助服务，所以我会确保在保存时获取我的客户数据，但我不确定这是否是自助服务的要求。

# asp.net - 内容管理 - ASP.NET 建议

> ID：639316
> 
> 赞同：1
> 
> 时间：2009-03-12T16:04:13.773
> 
> 标签：asp.net, sql, content-management

构建与购买...我们都在这条路上走...看起来内容管理解决方案需要成为一种工具，您需要将其保留在工具箱中以获得一些快速的胜利，而且它们只会变得更好。我当然可以考虑建造一个，但是当你把所有的花里胡哨都装进去的时候，从架子上买一个会更便宜……

我已经在[StackOverflow](https://stackoverflow.com/search?q=content+management)上搜索了一些建议，但似乎确实没有任何针对 ASP.NET 实现的高度评价的想法。

不要误会我的意思，PHP 和 mySQL 肯定有它们的位置，但在某些情况下，由于其他限制，您确实必须坚持使用 ASP.NET 和 SQL Server 实现。[Drupal](http://drupal.org/)和[WordPress](http://wordpress.org/)看起来都很酷，但我无法在我必须使用的环境中进行这些设置和安装。

什么是最好的 ASP.NET CMS 解决方案？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-03-12T20:47:15.510

我会尝试更有针对性的搜索：

> [[asp.net]“内容管理”](https://stackoverflow.com/search?q=[asp.net]+%22content+management%22)

将其过滤为仅标记为“asp.net”的问题，并确保您搜索的是短语 Content Management，而不是两个词。

很多都归结为您对“内容管理”的定义。在过去的 5 年里，我一直在专业从事微软的 CMS 之类的工作，最近还做了一点 MOSS Web 内容管理，在此之前，我们为一家出版社编写了两三个定制的 CMS，所以我考虑使用 CMS成为一个完整的网站建设工具，专注于发布多种类型和风格的内容。

在开源/免费/便宜方面，我最近看了一些，发现以下内容：

*   [N2 CMS](http://www.n2cms.com) - 这是我决定使用的，主要是因为他们有一个有效的 MVC 实现，我想了解这一点，但这也是我发现的最接近我对 CMS 的定义
*   [Umbraco](http://www.umbraco.net/) - 紧随其后，由于当时缺乏 MVCness 而令人失望。
*   [Graffiti CMS](http://graffiticms.com/) - 作为一个 CMS 并没有真正与我切磋，更像是一个美化的博客引擎
*   [DotNetNuke](http://www.dotnetnuke.com/) - VB，我在 C# 中工作。但是，如果您真正想要的是门户，那就太好了。

只是我的想法来支持通常的乏味列表。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-12T16:40:25.777

您可能想查看[Umbraco](http://www.umbraco.net/) - 完全用 C#/.NET 编写，具有非常强大的编程 API（使用大量 XSLT 进行转换）。

他们提供免费的社区版和商业版。

马克

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2010-04-08T16:15:41.027

微软已经发布了“Orchard”...这看起来是 ASP.NET MVC 平台上的一个可靠的 CMS 实现。

[http://orchard.codeplex.com/](http://orchard.codeplex.com/)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-12T16:39:14.983

我看到一篇关于名为[axcms的 cms](http://www.axcms.net/)[的文章](http://weblogs.asp.net/scottgu/archive/2006/02/02/437220.aspx)（由[ScottGu](http://www.axcms.net/)撰写） 。你可以试试看。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-05-22T19:03:10.767

我自己最喜欢的是[Tridion](http://www.sdltridion.com)，它可以用于 .NET 或基于 Java 的站点。但是，如果您正在寻找它，它不是免费的。

[复合](http://www.composite.net/)也可能很有趣 - 也不是免费的，但它有试用期的可能性。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-12T16:11:33.507

[DotNetNuke](http://www.dotnetnuke.com)可能是最流行的并且有很多插件和文档。
虽然它是用 VB.NET 编写的 :(

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-05-22T19:27:21.793

我最近一直在使用 DotNetNuke，强烈推荐它。它非常易于安装，尤其是通过 Web Platform Installer（来自 Microsoft），而且非常易于定制。

我的客户最终购买了皮肤，但我发现自己构建皮肤并定制购买的皮肤非常容易。尝试搜索免费的 XHTML DotNetNuke 皮肤。

构建新模块也非常容易！到目前为止，我已经写了四个 - 用 C# - 这很容易。

实际的 DNN 源代码是用带有大量 HTML 表的 VB.NET 编写的。它绝对**不是**大多数人认为的最佳实践，但它确实运作良好。它是那些运行良好的软件项目之一，然后你看看幕后，你会后悔你这样做了。

我曾经评估过它，并没有通过源代码，因为它是 VB.NET。我现在后悔了——最后一个项目对我来说非常顺利。所以，我强烈推荐它。除了花费您评估的时间之外，它不会花费您任何费用。:)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2011-02-26T08:23:26.893

我迟到了几年才参加这个讨论，但我会从采购方面提出一些关于繁荣的想法。情况发生了变化，但对于商业 CMS，我会查看研究公司推荐的供应商。对于开源解决方案，我会寻找一个大型的活跃社区、文档和您可以接受的支持模型。

我们于 2008 年开始研究 CMS，通过在线搜索和最终的 CMS 列表[http://www.cmsmatrix.org/](http://www.cmsmatrix.org/)。（难以置信有多少“CMS”）

我们最终看到了 Gartner 和 Forrester 推荐的“.NET-friendly” CMS。Gartner 的领导者/挑战者和利基/有远见者的“魔力象限”和 Forrester 的“Wave”指出了功能集以及市场和供应商路线图。

一个好的提案请求 (RFP) 或比较提示不是问“你有 X 功能吗？” 但要比较一下，看看哪个解决方案*做得更好*。

At the time, Kentico and Sitefinity were on our evaluation list as .NET-friendly. We also considered DotNetNuke, though there was a mild objection to "becoming DNN programmers" rather than staying mainly .NET (I'm sure there's a mis-perception in there, no offense).

We ended up comparing RedDot and Tridion and found Tridion to be a better fit for us because of its .NET API and flexibility.

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2009-03-12T16:09:39.687

你可以试试这些：

*   [http://rainbowportal.net/](http://rainbowportal.net/)
*   [http://www.ektron.com/](http://www.ektron.com/)
*   [http://www.joomla.org/](http://www.joomla.org/)
*   [http://www.opensourcecms.com/](http://www.opensourcecms.com/)

# c# - 代言人有什么好处？

> ID：639320
> 
> 赞同：24
> 
> 时间：2009-03-12T16:04:58.933
> 
> 标签：c#, .net, delegates

使用代表的好处/优势是什么？任何人都可以提供任何简单的例子吗？

* * *

## 回答 #1

> 赞同：44
> 
> 时间：2009-03-12T16:07:20.317

它们是封装一段代码的好方法。例如，当您将事件处理程序附加到按钮时，该处理程序就是委托。按钮不需要知道它做了什么，只需要知道如何在正确的时间调用它。

另一个例子是 LINQ——过滤、投影等都需要相同类型的模板代码；所有改变的是表示过滤器、投影等的逻辑。使用 C# 3 中的 lambda 表达式（转换为委托或表达式树），这使它变得非常简单：

```
var namesOfAdults = people.Where(person => person.Age >= 18)
                          .Select(person => person.Name); 
```

（这也可以表示为查询表达式，但我们不要离委托太远。）

委托的另一种思考方式是作为单方法接口类型。例如，`EventHandler`委托类型有点像：

```
public interface IEventHandler
{
    void Invoke(object sender, EventArgs e)
} 
```

但是框架中的委托支持允许将委托链接在一起、异步调用、用作事件处理程序等。

有关代表和事件的更多信息，请参阅[我关于该主题的文章](http://pobox.com/~skeet/csharp/events.html)。它的重点是事件，但它也涵盖了代表。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-03-12T16:14:15.387

这是一个非常模糊的话题，但这里有一些事情需要考虑 -

委托基本上是一个更干净、更简单的函数指针。在 C++ 中使用函数指针的任何地方，您都可以认为是委托。

**在设计中使用它们的优点：**

*   可以轻松重用代码
*   可以为您的设计提供很大的灵活性
*   允许您开发易于扩展的库和类，因为它提供了一种简单的方法来挂钩其他功能（例如，LINQ 中的 where 子句可以使用委托`[Func<T,bool>]`进行过滤，而无需在 Where 方法中编写新代码

**潜在的缺点：**

*   它们`~can~`，特别是如果天真地使用，会导致代码更难阅读
*   它们可能会在您的组件中引入意外的行为，因为您无法控制的第 3 方代码将被调用（例如，如果有人将委托附加到导致无限循环的事件之一，它可能会使您的类看起来很糟糕，即使它与你无关）

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-03-12T16:14:10.067

代表有三个目的：

1.  观察者模式的简化实现
2.  回调的简化实现
3.  匿名（不可重用）代码块

观察者

```
public class Something
{
    public event EventHandler SomethingHappened;
}

public class SomethingConsumer
{
    private mySomething = new Something();

    public void WireUpEvents()
    {
        mySomething.SomethingHappened += whenSomethingHappened;
    }

    private void whenSoemthingHappened(object sender, EventArgs e)
    {
        // do something
    }
} 
```

打回来

```
public void DoSomethingAsynchronously(EventHandler callBack)
{
    // long running logic.
    callBack(this, EventArgs.Empty);
} 
```

匿名不可重用代码

```
public void DoSomethingReusably(Action nonReusableCode)
{
    // reusable code
    nonReusableCode();
    // more reusable code
}

public void DoALotOfSomething()
{
    DoSomethingReusably(() => { /* non-reusable code here */ });
    DoSomethingReusably(() => { /* non-reusable code here */ });
    DoSomethingReusably(() => { /* non-reusable code here */ });
} 
```

在所有情况下，这只是提供简洁性的问题。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-12T16:10:09.437

C# 中的委托是 eqv。到 C 中的函数指针，但它还携带对创建它的类实例的引用。

Windows 窗体中的所有事件处理程序都是委托。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-12T16:10:13.913

相比有什么优势？委托可以是有用的东西，并且肯定在许多中等复杂的 C# 代码中占有一席之地。（每当您在类中使用事件时，您都在隐式使用多播委托）。如果你想了解它们的语法和用法，我推荐以下文章：

*   [MSDN 教程](http://msdn.microsoft.com/en-us/library/aa288459(VS.71).aspx)
*   [代表简介 - MSDN 杂志文章](http://msdn.microsoft.com/en-us/magazine/cc301810.aspx)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-03-12T16:26:21.397

免责声明：我并不是说我如何使用委托是预期的方式，但它只是一个例子。

我以前只使用过一次，但基本上在我们的应用程序中，用户单击“完成”按钮执行一个步骤，然后将他们带到路由页面以决定下一步将其发送到哪里。所以从技术上讲，他们刚刚点击“完成”的步骤在他们路由之前并没有真正完成。但是由于我在另一个页面上，所以我无法轻松访问它们所在的位置。

因此，我所做的是在单击“完成”时为需要特殊处理的几个步骤（在本例中为电子邮件）创建了一个委托，当他们在下一页上路由它时，我将检查委托的存在，如果它在那里调用它来触发我的“存储”事件。

创意：可能，错误：可能，工作：肯定。

就像我说的可能不是它的预期用途，但编码既是艺术又是科学，对吧？

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-12T16:37:59.790

我记得早期的 Java GUI 框架没有委托或命令路由的概念。为了制作一个可以做某事的按钮，您必须*继承 Button*并覆盖 click 方法。您最终会得到大量 UI 元素子类，其中包含少量应用程序代码。

处理该点击的代码必须放在某个地方，并且在 Java 或 C# 等 OO 语言中，它必须放在一个类中，但委托允许它发生在方便的地方。这通常会导致在表单类中有太多代码在做太多不同的事情，但这是一个不同的问题。

# asp.net - 在页面中保留动态用户控件的最佳方式是什么？

> ID：639323
> 
> 赞同：1
> 
> 时间：2009-03-12T16:05:44.987
> 
> 标签：asp.net, user-controls

我有一个应用程序，目前使用一堆包含 aspx 文件的指令，很像经典的 ASP 应用程序可能会工作。（我知道，呃。）我真的很想将其转换为动态用户控件，因为 URL/查询字符串将有助于确定应该执行哪些代码。我知道如果我手动执行，我需要在 Page_Load 事件触发之前动态加载用户控件。在我看到的另一个 SO 问题上，有人指出[DynamicControlsPlaceholder](http://www.denisbauer.com/ASPNETControls/DynamicControlsPlaceholder.aspx)这似乎是一个很酷的主意。不过，该软件自 2006 年以来就没有更新过，所以我想知道它是否跟上了最新的创新，如 ASP.NET ajax、.NET 3.5 等。此外，我的动态控件可能需要进行大量数据库更新，与页面的各个部分等交谈。有没有人推荐一个好的打包解决方案？或者，如果人们认为我应该考虑自己编写所有的控制插入逻辑，那么我可以看看一个非常好的教程吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-12T16:13:26.683

只要它们在娱乐时保持相同的名称，您就可以像往常一样依靠视图状态重新填充它们。

它们需要在页面初始化事件中重新创建。

您可以将重新创建它们所需的信息存储在 session 之类的地方。

[这个](http://aspnet.4guysfromrolla.com/articles/092904-1.aspx)不错，就是有点旧

希望有帮助。

# .net - MsTest - 在程序集中的每个测试之前执行方法

> ID：639326
> 
> 赞同：42
> 
> 时间：2009-03-12T16:06:39.023
> 
> 标签：.net, mstest

是否可以在程序集中的每个测试之前运行特定方法？

我知道`TestInitialize`属性，但这个属性有“类范围”。如果它是在 Test 类中定义的，它将在该类的每个测试之前执行。

我想定义一个方法，该方法将在整个程序集中定义的每个测试之前执行。

* * *

## 回答 #1

> 赞同：71
> 
> 时间：2009-03-13T00:15:56.290

`[TestInitialize()]`是你需要的。

```
private string dir;

[TestInitialize()]
public void Startup()
{
    dir = Path.GetTempFileName();
    MakeDirectory(ssDir);
}

[TestCleanup()]
public void Cleanup()
{
    ss = null;
    Directory.SetCurrentDirectory(Path.GetTempPath());

    setAttributesNormal(new DirectoryInfo(ssDir));
    Directory.Delete(ssDir, true);
}

[TestMethod]
public void TestAddFile()
{
    File.WriteAllText(dir + "a", "This is a file");
    ss.AddFile("a");
    ...
}

[TestMethod]
public void TestAddFolder()
{
    ss.CreateFolder("a/");
    ...
} 
```

这为每个测试提供了一个新的随机临时路径，并在完成后将其删除。您可以通过在调试中运行它并查看每个测试用例的 dir 变量来验证这一点。

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2009-03-13T00:10:12.810

我不确定这个功能是否可以像其他测试框架（例如 MbUnit）一样在 MsTest 中实现。

如果我必须使用 MsTest，那么我通过定义具有`[TestInitialize]`属性的抽象类 TestBase 来解决这个问题，并且每个需要这种行为的测试都派生自这个基类。在您的情况下，程序集中的每个测试类都必须继承自这个基......

可能还有另一种解决方案，您可以制作自定义测试属性 - 但我还没有尝试过...... :)

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2011-02-27T03:08:34.493

你想用`[AssemblyInitialize]`.

请参阅：[MSDN 链接](http://msdn.microsoft.com/en-us/library/microsoft.visualstudio.testtools.unittesting.assemblyinitializeattribute%28v=vs.80%29.aspx)

或者这个问题： [关于stackoverflow](https://stackoverflow.com/questions/1427443/global-test-initialize-method-for-mstest)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-12T18:20:42.073

那么 MSTest 不是为每个测试实例化类吗？这就是我对它的理解。在这种情况下，您从构造函数中调用的任何内容都是初始化代码（按定义进行每个测试）。

编辑：如果它不起作用（我仍然认为应该这样做，因为 MSTest 需要确保单独的测试方法运行是隔离的）那么`TestInitialize`就是你的属性。顺便说一句[，Codeplex 上的 Link提供了最好的单元测试比较](http://xunit.codeplex.com/Wiki/View.aspx?title=Comparisons&referringTitle=WhyDidWeBuildXunit)

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-03-12T16:09:03.900

我认为您正在寻找该`ClassInitialize`属性。

# c# - 在 xbap 中导入带有图像的 RTF

> ID：639335
> 
> 赞同：1
> 
> 时间：2009-03-12T16:08:36.260
> 
> 标签：c#, wpf, xaml, rtf, xbap

我需要将 RTF 文档导入 FlowDocument 以进行进一步解析。但我有一个非常奇怪的问题：

```
public string ConvertRTF(byte[] bytes)
{
    if (bytes == null)
    {
        throw new ArgumentNullException();
    }

    FlowDocument document = new FlowDocument();

    // open the file for reading
    using (MemoryStream stream = new MemoryStream(bytes, true))
    {
        // create a TextRange around the entire document
        TextRange documentTextRange = new TextRange(document.ContentStart, document.ContentEnd);
        if (documentTextRange.CanLoad(DataFormats.Rtf))
            documentTextRange.Load(stream, DataFormats.Rtf);
    }

    return XamlWriter.Save(document);

} 
```

我已经在三个不同的项目中测试了这种方法：

*   **Wpf 独立应用程序**：从来没有给我带来任何问题，但是唉，我不能使用这种应用程序。
*   **控制台应用程序**：它经常工作，但它有时会在带有图像的文档上中断，当它中断时我无法找到我的手指，为什么......我收到的错误是关于 TextRange 的 Load 方法：“无法识别数据格式为“富文本格式”的结构。参数名称：stream"
*   **Xbap 应用程序**：甚至没有通过 CanLoad 方法... :( 所以给了我 jack whathisname 结果...

奇怪的是，当我使用控制台应用程序对其进行测试时，它在以下构造中可以正常工作：

```
[STAThread]
static void Main(string[] args)
{
    OpenFileDialog dialog = new OpenFileDialog
    {
        Filter = "import files (*.rtf)|*.rtf"
    };

    if (dialog.ShowDialog() != DialogResult.OK)
        return;

    byte[] data;
    using (Stream filestream = dialog.OpenFile())
    {
        int offset = 0;
        data = new byte[filestream.Length];
        int remaining = data.Length;
        while (remaining > 0)
        {
            int read = filestream.Read(data, offset, remaining);
            if (read <= 0)
                throw new EndOfStreamException
                    (String.Format("End of stream reached with {0} bytes left to read", remaining));
            remaining -= read;
            offset += read;
        }
    }

    FlowDocument document = new FlowDocument();

    using (MemoryStream stream = new MemoryStream(data))
    {
        // create a TextRange around the entire document
        TextRange documentTextRange = new TextRange(document.ContentStart, document.ContentEnd);
        documentTextRange.Load(stream, DataFormats.Rtf);
    }

    Console.WriteLine("test ok");
} 
```

这让我一无所知，因为这正是我正在做的事情，但随后分两步进行……首先检索位，然后使用内存流将其制成 RTF……:(

会不会是某些 dll 版本中可能存在冲突？我们正在为我们的项目使用 3.5 SP1...

有人可以帮我找到上述最后两个可能性之一的解决方案吗？

谢谢

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2010-09-28T18:25:23.593

您可能对信任级别有问题。Xbap Internet 应用程序默认为部分信任。您可以使用证书来允许完全信任 xpab 互联网应用程序。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-12-21T13:02:59.357

显然做不到。

我们最终将 rtf 发送到具有更多权限的服务器，并将结果发送回客户端。讨厌，但它的工作原理。

# activex - ActiveX 控件未在 IE6 中运行

> ID：639336
> 
> 赞同：1
> 
> 时间：2009-03-12T16:08:50.593
> 
> 标签：activex, internet-explorer-6

我正在尝试获取一些 javascript 来与 activex 控件对话。当这有效并且 JS 可以获得控件状态时，我会收到一条消息。如果没有，我会收到一条错误消息。

在 IE7/8 中，系统会提示您接受 activex 控件（通过警告栏），但在 IE6 中，js 无法获取控件状态。

我还尝试使用外部文件中的 document.write 创建控件，以便它可以在页面加载后立即运行。该控件是不可见的，因此我无法仅通过查看页面来判断它是否正在加载。

我会很感激你的帮助。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-12T16:12:51.850

这可能是在 IE7 中启动的 ActiveX 控件激活机制，但我认为应该稍后在服务包中删除。这是控件开发人员和网页作者的主要痛苦。

本文提供了一些背景和建议：http: [//msdn.microsoft.com/en-us/library/ms537508.aspx](http://msdn.microsoft.com/en-us/library/ms537508.aspx)

这里还有一些有用的信息：http: [//blogs.msdn.com/ie/archive/2007/11/08/ie-automatic-component-activation-changes-to-ie-activex-update.aspx](http://blogs.msdn.com/ie/archive/2007/11/08/ie-automatic-component-activation-changes-to-ie-activex-update.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-12T16:37:04.897

在由于诉讼而禁用自动机制之后（或之前）在 IE 中激活控件在 HTML 中放置一个脚本标记，如下所示

```
<script src="control.js"></script> 
```

然后在网站的根目录中创建一个 control.js 文件，如下所示：（当然，您必须为控件的 classid 编辑脚本，它是 parms - 但您明白了）

```
document.write('<OBJECT align=left classid="CLSID:8BD21D30-EC42-11CE-9E0D-00AA006002F3" id=Customer style="HEIGHT: 23px; text-align:left; LEFT: 0px; TOP: 100px; WIDTH: 160px" tabIndex=4 width=75 onchange="NewCustomer" VIEWASTEXT>');
document.write('<param name="VariousPropertyBits" value="746604571">');
document.write('<param name="BackColor" value="2147483653">');
document.write('<param name="ForeColor" value="2147483656">');
document.write('<param name="MaxLength" value="0">');
document.write('<param name="BorderStyle" value="0">');
document.write('<param name="ScrollBars" value="0">');
document.write('<param name="DisplayStyle" value="3">');
document.write('<param name="MousePointer" value="0">');
document.write('<param name="Size" value="4233;609">');
document.write('<param name="PasswordChar" value="0">');
document.write('<param name="ListWidth" value="0">');
document.write('<param name="BoundColumn" value="1">');
document.write('<param name="TextColumn" value="65535">');
document.write('<param name="ColumnCount" value="1">');
document.write('<param name="ListRows" value="8">');
document.write('<param name="cColumnInfo" value="0">');
document.write('<param name="MatchEntry" value="1">');
document.write('<param name="ListStyle" value="0">');
document.write('<param name="ShowDropButtonWhen" value="2">');
document.write('<param name="ShowListWhen" value="1">');
document.write('<param name="DropButtonStyle" value="1">');
document.write('<param name="MultiSelect" value="0">');
document.write('<param name="Value" value>');
document.write('<param name="Caption" value>');
document.write('<param name="PicturePosition" value="458753">');
document.write('<param name="BorderColor" value="2147483654">');
document.write('<param name="SpecialEffect" value="2">');
document.write('<param name="Accelerator" value="0">');
document.write('<param name="GroupName" value>');
document.write('<param name="FontName" value="Arial">');
document.write('<param name="FontEffects" value="1073741824">');
document.write('<param name="FontHeight" value="165">');
document.write('<param name="FontOffset" value="0">');
document.write('<param name="FontCharSet" value="0">');
document.write('<param name="FontPitchAndFamily" value="2">');
document.write('<param name="ParagraphAlign" value="1">');
document.write('<param name="FontWeight" value="400">');
document.write('<param name="autoStart" value="-1"></object>'); 
```

autoStart=-1 是让它自动运行的导入项（一旦安装）。您可能还想为指向 control.CAB 文件的对象添加一个 CODEPATH 以进行安装。（在我的情况下我不需要这个）

# sql - Select * from Table 并仍然在单个命名列上执行某些功能

> ID：639341
> 
> 赞同：3
> 
> 时间：2009-03-12T16:09:27.397
> 
> 标签：sql, select, plsql, wildcard, to-char

我希望能够返回表中或连接的结果表中的所有列，并且仍然能够按名称将日期转换为字符串。

例如

从 MY_TABLE 中选择 ID、描述、TO_CHAR(CHANGE_DATE,'YYYY-MM-DD HH24:MI:SS') AS FORMATED_DATE；

这对这三列来说一切都很好。但是，该表实际上将有更多列，并且可能会连接到其他表。我希望能够使用通配符来获取所有列，并且仍然能够执行 TO_CHAR 转换。

类似于：SELECT *, (CHANGE_DATE, 'YYYY-MM-DD HH24:MI:SS') AS FORMATED_DATE FROM MY_TABLE;

正如您从 TO_CHAR 中猜到的那样，我使用的是 Oracle，所以我使用的是 PLSQL。

所以我的具体问题是：是否有一种语法允许我选择所有列（通过*）并且仍然能够在这些列中的单个列上调用函数。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-12T16:16:09.470

您可以做的最接近的是：

```
SELECT 
     MY_TABLE.*, 
     (CHANGE_DATE, 'YYYY-MM-DD HH24:MI:SS') AS FORMATED_DATE 
FROM MY_TABLE; 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-10-14T00:52:39.840

与其教训你，不如在这里。Oracle 在这方面比 MSSQL 更麻烦一些，但这对我有用。

SELECT GENERAL.GOREMAL.* ,rownum ,current_date 从 GENERAL.GOREMAL

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-12T16:17:08.843

以下是可以接受的：

```
SELECT T1.*, T2.*, x + y as some_Z 
```

也许

```
SELECT compute_foo() as aColumn, * 
```

最后一个将始终将您的特殊列保持在同一个位置 - 在开始时 - 无论通配符带来多少列。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-12T16:15:09.020

在 SQL Server 中，您编写的内容完全有效，我认为它也应该在 Oracle 中工作。请注意，您将返回日期列两次，一次以原始形式返回，一次以格式化形式返回。

仅供参考使用 SELECT * 可能应该避免，但这是另一个问题:-)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-12T18:18:43.450

仅供参考，如果您有联接，则特别要避免选择 *，因为它会浪费服务器和网络资源，尤其是因为所有联接字段都具有相同的信息。像“select *”这样的垃圾编码会产生性能问题，当系统中的每个查询都写得不好时，这些问题就很难修复。我知道在 SQL Server 中，您可以从对象浏览器中拖动列，如果 ORacle 有类似的东西，我不会感到惊讶。

此外，随着数据表的变化，select * 会产生很多很多以后的 bug。不按您想要的特定顺序命名列是不好的做法。

# iphone - 默认表格视图 - 删除部分

> ID：639342
> 
> 赞同：3
> 
> 时间：2009-03-12T16:09:32.433
> 
> 标签：iphone

我的应用程序包含一个带有行和部分的表格视图。
当我删除一个部分的最后一项时，我删除了该部分。它工作正常。
但是，当我将一个部分的最后一行移动到另一个部分时，我得到一个错误。

这是我在这两种情况下的代码：

```
[categoryArray removeObjectAtIndex:indexPath.section];
[tableView deleteSections:[NSIndexSet indexSetWithIndex:indexPath.section] withRowAnimation:UITableViewRowAnimationTop]; 
```

这是 moveRowAtIndexPath:fromIndexPath:toIndexPath 中发生的错误：

```
2009-03-11 17:56:09.524 Test[5140:20b] 1
2009-03-11 17:56:09.525 Test[5140:20b] *** Terminating app due to uncaught exception 'NSRangeException', reason: '*** -[NSCFArray objectAtIndex:]: index (5) beyond bounds (5)' 
```

任何帮助都会很棒！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-12T16:39:42.877

好吧，事实上，我的代码并没有试图访问一个元素。我认为错误来自 UITableView 方法（我不知道，因为我们只能访问 sdk 的头文件）。问题出现在这一点上：

```
[tableView deleteSections:[NSIndexSet indexSetWithIndex:fromIndexPath.section] withRowAnimation:UITableViewRowAnimationTop]; 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-07-09T23:17:00.627

我有这个问题，我刚刚解决了。就我而言，我使用的是 Core Data，我必须将删除逻辑包装在

```
 [tableView beginUpdates];
    ...
    [tableView endUpdates]; 
```

我必须把所有东西都包起来；从我删除数据/部分之前到我保存上下文之后。希望能帮助到你。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-12T16:19:44.827

看起来您正在尝试访问五元素数组的第六个元素。您是否使用数组大小​​作为索引而不减去 1？

# nhibernate - nHibernate 可以为属性生成价值吗？

> ID：639352
> 
> 赞同：2
> 
> 时间：2009-03-12T16:11:42.290
> 
> 标签：nhibernate

Id 列可以指定一个生成器。完美的。

但是，我有一种情况，如果它为空，我需要将生成的值分配给属性列。想想发票表，其中有一个代理主键列和一个发票编号列。

`CREATE TABLE dbo.Invoice (InvoiceId INT NOT NULL PRIMARY KEY IDENTITY(1,1), InvoiceNumber INT NOT NULL, InvoiceDate DATETIME NOT NULL, remaining columns...)`

这不是默认值。发票编号可能有一些围绕它的生成的规则。我有一个处理实际生成的 C# 类，我只需要找到一种方法来填充 Invoice 类上的属性值。

理想情况下，我可以像为映射中的 Id 一样为属性指定生成器。不幸的是，从我能确定的情况来看，这似乎是不可能的。我希望我错了。

我还有其他可以使用的非 nHibernate 选项，例如使用触发器，将生成插入提供程序。但是，我想将其保留为配置选项而不是编码选项。

有谁知道是否存在这样的能力？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-12T16:15:07.600

NHibernate 期望您在域类中定义所有这些规则——例如，在构造函数中。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-12T16:13:11.457

你的意思是你想提供一个默认值？

我会说这应该是您应该在数据库级别指定的内容...

如果你真的希望 NHibernate 处理这个问题，我认为你应该创建一个拦截器，当它在刷新时为空时设置该属性的值。

或者，您可以通过在构造函数中为属性指定默认值来指定实体中的默认值。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-07T14:53:00.677

抱歉回答晚了，但我最近遇到了和你一样的问题。我在 NHibernate 源代码中回溯了一下，似乎找到了解决方案。

您可以使用 NHibernate.Id 命名空间来生成 Guid。有 2 个可行的选项 - 让您的客户生成 Guid 或让本机数据库来做。

这些是您需要的课程：

*   NHibernate.Id.NativeGuidGenerator //数据库生成
*   NHibernate.Id.GuidGenerator //客户端生成

使用 NHibernate.Id.NativeGuidGenerator 类可以通过以下方式完成：

```
public Guid GetNewSessionId()
{
    NHibernate.Id.NativeGuidGenerator guidGen = new NHibernate.Id.NativeGuidGenerator();
    return (Guid)(guidGen.Generate((NHibernate.Engine.ISessionImplementor)anOpenSession, null));
} 
```

祝你好运:)

# web-services - 数据查找服务

> ID：639383
> 
> 赞同：0
> 
> 时间：2009-03-12T16:16:35.070
> 
> 标签：web-services

我正在寻找数据查找服务，我可以发送房地产地址（街道、城市、州、邮编）并获取有关该房产的信息（业主、抵押贷款、平方英尺、房间等）

任何人都知道这样的现有服务，可以使用和 ASP.Net 应用程序吗？

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-12T16:36:35.973

那么您正在寻找的服务类型通常仅限于多重上市服务。要成为 MLS 的成员，您必须是 NAR（全国房地产经纪人协会）的成员。即使这样，您正在寻找的服务类型（按需查找）通常也仅适用于指定经纪人（每个房地产经纪人只有一名指定经纪人）。但是，您有时可以找到可以为您提供 MLS 之类的查找服务（查看 google 等），但您可能需要付费。你可能会感兴趣看看[这个相关的问题](https://stackoverflow.com/questions/130170/is-there-a-free-pay-web-service-that-i-can-query-to-get-mls-data)。

# asp.net - T-SQL 中的 HTML 编码？

> ID：639393
> 
> 赞同：19
> 
> 时间：2009-03-12T16:18:07.937
> 
> 标签：asp.net, sql, tsql

是否有任何函数可以在 T-SQL 中对 HTML 字符串进行编码？我有一个旧数据库，其中包含诸如“<”、“>”等狡猾的字符。我可以编写一个函数来替换这些字符，但有更好的方法吗？

我有一个 ASP.Net 应用程序，当它返回一个字符串时，它包含导致错误的字符。ASP.Net 应用程序正在从数据库表中读取数据。它不会写入表本身。

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2009-09-25T10:33:52.987

我们有一个遗留系统，它使用触发器和 dbmail 在输入表格时发送 HTML 编码的电子邮件，因此我们需要在电子邮件生成中进行编码。我注意到 Leo 的版本有一个小错误，将 & in 编码 `&lt;`，`&gt;`我使用这个版本：

```
CREATE FUNCTION HtmlEncode
(
    @UnEncoded as varchar(500)
)
RETURNS varchar(500)
AS
BEGIN
  DECLARE @Encoded as varchar(500)

  --order is important here. Replace the amp first, then the lt and gt. 
  --otherwise the &lt will become &amp;lt; 
  SELECT @Encoded = 
  Replace(
    Replace(
      Replace(@UnEncoded,'&','&amp;'),
    '<', '&lt;'),
  '>', '&gt;')

  RETURN @Encoded
END
GO 
```

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2013-01-09T12:00:21.917

有点晚了，但无论如何，这里有正确的方法：

HTML 编码（HTML 编码 = XML 编码）：

```
DECLARE @s NVARCHAR(100)
SET @s = '<html>unsafe & safe Utf8CharsDon''tGetEncoded ÄöÜ - "Conex"<html>'
SELECT (SELECT @s FOR XML PATH('')) 
```

查询中的 HTML 编码：

```
SELECT 
    FIELD_NAME  
    ,(SELECT FIELD_NAME AS [text()] FOR XML PATH('')) AS FIELD_NAME_HtmlENcoded 
FROM TABLE_NAME 
```

HTML解码：

```
SELECT CAST('<root>' + '&lt;root&gt;Test&amp;123' + '</root>' AS XML).value(N'(root)[1]', N'varchar(max)'); 
```

如果您想正确执行此操作，可以使用 CLR 存储过程。
但是，它有点复杂，因为您不能在 CLR-stored-procedures 中使用 System.Web-Assembly（因此您不能使用 System.Web.HttpUtility.HtmlDecode(htmlEncodedStr);）。所以你必须编写自己的 HttpUtility 类，我不建议这样做，尤其是用于解码。

幸运的是，您可以将 System.Web.HttpUtility 从单声道源代码（.NET for Linux）中剥离出来。然后你可以在不引用system.web的情况下使用HttpUtility。

然后你编写这个 CLR-Stored-Procedure：

```
using System;
using System.Collections.Generic;
using System.Text;

using Microsoft.SqlServer.Server;
using System.Data.SqlTypes;
//using Microsoft.SqlServer.Types;

namespace ClrFunctionsLibrary
{

    public class Test
    {

        [Microsoft.SqlServer.Server.SqlFunction]
        public static SqlString HtmlEncode(SqlString sqlstrTextThatNeedsEncoding)
        {
            string strHtmlEncoded = System.Web.HttpUtility.HtmlEncode(sqlstrTextThatNeedsEncoding.Value);
            SqlString sqlstrReturnValue = new SqlString(strHtmlEncoded);

            return sqlstrReturnValue;
        }

        [Microsoft.SqlServer.Server.SqlFunction]
        public static SqlString HtmlDecode(SqlString sqlstrHtmlEncodedText)
        {
            string strHtmlDecoded = System.Web.HttpUtility.HtmlDecode(sqlstrHtmlEncodedText.Value);
            SqlString sqlstrReturnValue = new SqlString(strHtmlDecoded);

            return sqlstrReturnValue;
        }

        // ClrFunctionsLibrary.Test.GetPassword
        //[Microsoft.SqlServer.Server.SqlFunction]
        //public static SqlString GetPassword(SqlString sqlstrEncryptedPassword)
        //{
        //    string strDecryptedPassword = libPortalSecurity.AperturePortal.DecryptPassword(sqlstrEncryptedPassword.Value);
        //    SqlString sqlstrReturnValue = new SqlString(sqlstrEncryptedPassword.Value + "hello");

        //    return sqlstrReturnValue;
        //}

        public const double SALES_TAX = .086;

        // http://msdn.microsoft.com/en-us/library/w2kae45k(v=vs.80).aspx
        [SqlFunction()]
        public static SqlDouble addTax(SqlDouble originalAmount)
        {
            SqlDouble taxAmount = originalAmount * SALES_TAX;

            return originalAmount + taxAmount;
        }

    } // End Class Test

} // End Namespace ClrFunctionsLibrary 
```

并注册它：

```
GO

/*
--http://stackoverflow.com/questions/72281/error-running-clr-stored-proc
-- For unsafe permission
EXEC sp_changedbowner 'sa'
ALTER DATABASE YOUR_DB_NAME SET TRUSTWORTHY ON 

GO
*/

IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[HtmlEncode]') AND type in (N'FN', N'IF', N'TF', N'FS', N'FT'))
DROP FUNCTION [dbo].[HtmlEncode]
GO

IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[HtmlDecode]') AND type in (N'FN', N'IF', N'TF', N'FS', N'FT'))
DROP FUNCTION [dbo].[HtmlDecode]
GO

IF  EXISTS (SELECT * FROM sys.assemblies asms WHERE asms.name = N'ClrFunctionsLibrary' and is_user_defined = 1)
DROP ASSEMBLY [ClrFunctionsLibrary]

GO

--http://msdn.microsoft.com/en-us/library/ms345101.aspx

CREATE ASSEMBLY [ClrFunctionsLibrary]
AUTHORIZATION [dbo]
FROM 'D:\username\documents\visual studio 2010\Projects\ClrFunctionsLibrary\ClrFunctionsLibrary\bin\Debug\ClrFunctionsLibrary.dll' 
WITH PERMISSION_SET = UNSAFE  --EXTERNAL_ACCESS  --SAFE
;

GO

CREATE FUNCTION [dbo].[HtmlDecode](@value [nvarchar](max))
RETURNS [nvarchar](max) WITH EXECUTE AS CALLER
AS 
-- [AssemblyName].[Namespace.Class].[FunctionName]
EXTERNAL NAME [ClrFunctionsLibrary].[ClrFunctionsLibrary.Test].[HtmlDecode]
GO

CREATE FUNCTION [dbo].[HtmlEncode](@value [nvarchar](max))
RETURNS [nvarchar](max) WITH EXECUTE AS CALLER
AS 
-- [AssemblyName].[Namespace.Class].[FunctionName]
EXTERNAL NAME [ClrFunctionsLibrary].[ClrFunctionsLibrary.Test].[HtmlEncode]
GO

/*
EXEC sp_CONFIGURE 'show advanced options' , '1';
 GO
 RECONFIGURE;
 GO
 EXEC sp_CONFIGURE 'clr enabled' , '1'
 GO
 RECONFIGURE;
 GO

EXEC sp_CONFIGURE 'show advanced options' , '0';
 GO
 RECONFIGURE;
*/ 
```

之后，您可以像使用普通功能一样使用它：

```
SELECT
     dbo.HtmlEncode('helloäÖühello123') AS Encoded
    ,dbo.HtmlDecode('hello&auml;&Ouml;&uuml;hello123') AS Decoded 
```

任何只是复制粘贴的人，请注意，出于效率原因，您将使用

```
public const double SALES_TAX = 1.086;

// http://msdn.microsoft.com/en-us/library/w2kae45k(v=vs.80).aspx
[SqlFunction()]
public static SqlDouble addTax(SqlDouble originalAmount)
{
     return originalAmount * SALES_TAX;
} 
```

如果您要在生产中使用此功能。

请参阅此处了解已编辑的单声道类： http:
[//pastebin.com/pXi57iZ3](http://pastebin.com/pXi57iZ3)
[http://pastebin.com/2bfGKBte](http://pastebin.com/2bfGKBte)

您需要在构建选项中定义 NET_2_0 ![构建选项](https://i.stack.imgur.com/Rr8dp.png)

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2009-03-12T16:22:42.230

您不应该修复 SQL 中的字符串。更好的方法是在 ASP.net 中使用名为 HtmlEncode 的函数，这将处理导致您看到的问题的特殊字符，请参见下面的示例。我希望这有帮助。

```
string htmlEncodedStr = System.Web.HttpUtility.HtmlEncode(yourRawStringVariableHere);
string decodedRawStr =  System.Web.HttpUtility.HtmlDecode(htmlEncodedStr); 
```

编辑：因为你是从数据表中绑定数据的。使用内联表达式在 GridView 的标记或您使用的任何控件中调用 HTMLEncode，这仍将满足您的数据绑定要求。请参见下面的示例。或者，您可以循环数据表对象中的每条记录，并在数据绑定之前使用 html 编码字符串更新每个单元格。

```
<%# System.Web.HttpUtility.HtmlEncode(Eval("YourColumnNameHere")) %> 
```

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-03-12T17:20:18.987

我认为数据库中的数据不应该知道或关心用户界面。显示问题应由表示层处理。我不想看到任何 HTML 混合到数据库中。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2016-12-16T04:11:43.937

您可以简单地在查询中使用“XML PATH”。例如;

```
声明 @encodedString VARCHAR(MAX)

SET @encodedString = '给你要编码的html字符串'

选择 @encodedString
SELECT (SELECT @encodedString FOR XML PATH(''))

```

现在，如您所愿，您可以在自己的 sql 函数中执行此操作。希望这会有所帮助。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-03-12T16:33:31.363

如果要在 Web 上显示字符串，可以使用 Server.HTMLEncode() 对其进行编码。

如果您在数据库中存储字符串，请确保数据库字段是“nchar”，而不是“char”。这将允许它存储 unicode 字符串。

如果无法控制数据库，可以使用 Encoding.ASCII.GetString 将字符串“展平”为 ASCII。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2011-07-29T01:09:20.213

我自己没有尝试过这个解决方案，但我想尝试的是利用 sql server / .NET CLR 集成并实际从 T-SQL 调用 C# HTMLEncode 函数。这可能效率低下，但我怀疑它会给你最准确的结果。

我想知道如何做到这一点的起点是[http://msdn.microsoft.com/en-us/library/ms254498%28VS.80%29.aspx](http://msdn.microsoft.com/en-us/library/ms254498%28VS.80%29.aspx)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2018-07-04T00:55:12.020

我今天一直在尝试在 T-SQL 中执行此操作，主要是为了好玩，因为我的要求发生了变化，但我找到了一种出路。您可以使用从 NCHAR() 函数构建的 unicode 字符表，或者只是导入它，从 0 迭代到 65535（如果您只需要前 512 或其他内容，则可以更少）。然后重建字符串。可能有更好的方法来重建字符串，但这在紧要关头有效。

```
---store unicode chars into a table so you can replace those characters withthe decimal value

` 
```

创建表#UnicodeCharacters（DecimalValue INT，UnicodeCharacter NCHAR）；

```
--loop from 0 to highest unicode value you want and dump to the table you created
DECLARE @x INT = 0;
WHILE @x <= 65535
    BEGIN
        BEGIN
            INSERT INTO #UnicodeCharacters(DecimalValue, UnicodeCharacter)
            SELECT  @x,NCHAR(@x)
        END
        ;

        SET @x = @x + 1
        ;
    END
;

--index for fast retrieval
CREATE CLUSTERED INDEX CX_UnicodeCharacter_DecimalValue ON #UnicodeCharacters(UnicodeCharacter, DecimalValue);

--this is the string that you want to html-encode...
DECLARE @String NVARCHAR(100) = N'人This is a test - Ñ';

--other vars
DECLARE @NewString NVARCHAR(100) = '';
DECLARE @Word TABLE(Character NCHAR(1));
DECLARE @Pos INT = 1;

--run through the string and check each character to see if it is outside the regex expression
WHILE @Pos <= LEN(@String)
BEGIN
    DECLARE @Letter NCHAR(1) = SUBSTRING(@String,@Pos,1);
    PRINT @Letter;
    --rebuild the string replacing each unicode character outside the regex with &#[unicode value];
    SELECT  @NewString = @NewString + 
                CASE 
                    WHEN @Letter LIKE N'%[0-9abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ-!@#$%^&*()_+-= ]%' THEN @Letter
                    ELSE '&#' + CAST(uc.DecimalValue AS VARCHAR(10)) + ';'
                END
    FROM    #UnicodeCharacters uc
    WHERE   @Letter = uc.UnicodeCharacter COLLATE JAPANESE_UNICODE_BIN

    SET @Pos += 1
END

--end result
SELECT @NewString
; 
```

` 我知道通常你会使用 [0-9A-Za-z]，但由于某种原因，当我这样做时，它认为重音字符在该表达式的范围内。因此，我在表达式中明确使用了我不想转换为 Unicode 的每个字符。

最后一点，我不得不使用不同的排序规则来匹配 Unicode 字符，因为默认的 LATIN 排序规则（CI 或其他）似乎与重音字符不正确匹配，就像 LIKE 中的正则表达式一样。

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2009-03-15T19:40:20.540

好的，这就是我所做的。我创建了一个简单的函数来处理它。它远未完成，但至少可以处理标准`<>&`字符。我会在我继续的时候添加它。

```
CREATE FUNCTION HtmlEncode
(
    @UnEncoded as varchar(500)
)
RETURNS varchar(500)
AS
BEGIN
    DECLARE @Encoded as varchar(500)   
    SELECT @Encoded = Replace(@UnEncoded,'<','&lt;')
    SELECT @Encoded = Replace(@Encoded,'>','&gt;')
    SELECT @Encoded = Replace(@Encoded,'&','&amp;')   
    RETURN @Encoded    
END 
```

然后我可以使用：

```
Select Ref,dbo.HtmlEncode(RecID) from Customers 
```

这给了我一个 HTML 安全的记录 ID。可能有一个内置函数，但我找不到它。

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2010-11-08T15:40:47.327

将其分配给标签的 Text 属性，它将由 .NET 自动编码

# thread-safety - 编写调用 sybase 的 nsapi 插件的建议，该插件必须是线程安全的

> ID：639395
> 
> 赞同：1
> 
> 时间：2009-03-12T16:18:38.997
> 
> 标签：thread-safety, sybase, nsapi

我正在努力寻找 sybase 文档，说明 12.5 客户端是否是线程安全的。我需要进行 sybase 线程安全调用，因为我正在编写一个存在于线程环境中的 nsapi 插件。因此，要么我需要确保 sybase 客户端可以在线程环境中运行，要么我需要序列化对 sybase 的调用，这会降低我的网络服务器的速度。建议？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-12T17:44:50.537

12.5.1 开放的客户端是线程安全的，你只需要链接到正确的库。

> 在此版本中，Open Client/C 库的线程安全版本是使用 POSIX 线程编写的。所有多线程库都使用命名模式 *_r.a 用于静态库或 *_r.so 用于共享库。对于多线程应用程序，请使用带有“_r”后缀的库，例如 libcs​​_r.a。对于非多线程应用程序，请使用不带“_r”后缀的库，例如 libcs​​.a。

[http://download.sybase.com/pdfdocs/sdr1251e/ocssun04.pdf](http://download.sybase.com/pdfdocs/sdr1251e/ocssun04.pdf)

# java - 更改 JTable 上的 Ctrl + 单击行为

> ID：639397
> 
> 赞同：5
> 
> 时间：2009-03-12T16:19:37.840
> 
> 标签：java, swing, jtable

当按下键盘按钮（即 CTRL 按钮）并选择一行时，是否有一种简单的方法来操作 JTable 上的控件以提供不同的功能？我被要求创建一个表格，其中一行上的 CTRL + 单击（鼠标单击）只会取消选择选定的行，而不会选择一行。如果用户 CTRL + 单击未选择的行，则不会发生任何事情。

我已经能够创建一个表，并禁用诸如 CTRL + A （全选）之类的功能，并且我已经能够检查在生成 MouseEvent 时是否按下了控制按钮，但我似乎无法弄清楚了解如何调整 CTRL + 单击。这是一些代码：

```
package nicky;

import javax.swing.*;
import java.awt.Dimension;
import java.awt.GridLayout;
import java.awt.event.*;

public class TableTester extends JPanel {
    public TableTester() {
        super(new GridLayout(1,0));

        final String[] columnNames = {"First Name",
                                      "Last Name",
                                      "Sport",
                                      "# of Years",
                                      "Vegetarian"};

        final Object[][] data = {
            {"Tom",   "Roberts","Athletic", new Integer(5),  new Boolean(false)},
            {"Sarah", "Watt",   "Football", new Integer(3),  new Boolean(true)},
            {"Laura", "Brown",  "Swimming", new Integer(2),  new Boolean(false)},
            {"Simon", "Smith",  "Tennis",   new Integer(20), new Boolean(true)},
            {"Paul",  "Jones",  "Rugby",    new Integer(10), new Boolean(false)}
        };

        JTable table = new JTable(data, columnNames);
        table.setPreferredScrollableViewportSize(new Dimension(500, 100));

        table.setSelectionMode(ListSelectionModel.MULTIPLE_INTERVAL_SELECTION);

        table.addMouseListener(new MouseListener(){
            public void mouseEntered(MouseEvent me){}
            public void mouseExited(MouseEvent me){}
            public void mouseReleased(MouseEvent me){}
            public void mouseClicked(MouseEvent me){}
            public void mousePressed(MouseEvent me){
                if (me.isControlDown()){
                    System.out.println("This is working ");
                }
            }
        });

        InputMap inputMap = table.getInputMap(JTable.WHEN_ANCESTOR_OF_FOCUSED_COMPONENT);
        KeyStroke keyStroke = KeyStroke.getKeyStroke(KeyEvent.VK_A, InputEvent.CTRL_MASK);
        inputMap.put(keyStroke, "none");

        JScrollPane scrollPane = new JScrollPane(table);
        add(scrollPane);
    }

    private static void createAndShowGUI() {
        JFrame.setDefaultLookAndFeelDecorated(true);
        JFrame frame = new JFrame("TableTester");
        frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
        TableTester newContentPane = new TableTester();
        newContentPane.setOpaque(true);
        frame.setContentPane(newContentPane);
        frame.pack();
        frame.setVisible(true);
    }

    public static void main(String[] args) {
        javax.swing.SwingUtilities.invokeLater(new Runnable() {
            public void run() {
                createAndShowGUI();
            }
        });
    }
} 
```

在 mousePressed 方法中，我尝试从表中获取所有选定的行，然后检查新单击的行是否在 selectedRows 中......但是，我不确定是否有办法查看哪一行与 MouseEvent 相关联。

（另外，我知道这样的预期行为不应该玩太多，但它是为了复制公司中的遗留系统）

任何想法/建议将不胜感激！

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-13T14:17:13.287

好的，第二次拍摄（我留下了第一个，因为它可能会引起其他人的兴趣，谁知道？说它是为了教育目的...... :-)）。

我查看了 JTable 的源代码，发现鼠标事件是由外观处理的。知道它如何处理控制键，我可以安全地重写 changeSelection 方法来做你需要的。
我发现要求有点奇怪（您仍然可以使用 Shift+click，不是吗？）但我不知道上下文。

```
class SpecialTable extends JTable
{
    SpecialTable(Object[][] data, String[] columnNames)
    {
        super(data, columnNames);
// That's already the default        
//        setSelectionMode(ListSelectionModel.MULTIPLE_INTERVAL_SELECTION);
    }

    /**
     * Called by javax.swing.plaf.basic.BasicTableUI.Handler.adjustSelection(MouseEvent)
     * like: table.changeSelection(pressedRow, pressedCol, e.isControlDown(), e.isShiftDown());
     */
    @Override
    public void changeSelection(int rowIndex, int columnIndex, boolean toggle, boolean extend)
    {
        if (toggle && !isRowSelected(rowIndex))
            return; // Don't do the selection
        super.changeSelection(rowIndex, columnIndex, toggle, extend);
    }
} 
```

简单得多，正是您所需要的！

顺便说一句，感谢您提供如此简单的好测试用例，如果我必须自己编写它，我可能不会尝试...... :-D 这是一个有趣且学习的挑战。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-12T17:58:25.900

我在以下方面取得了成功，尽管我不确定这是最好的方法......

```
class SpecialTable extends JTable
{
    boolean bIsControlDown;
    int clickedRow;

    SpecialTable(Object[][] data, String[] columnNames)
    {
        super(data, columnNames);
//        setSelectionMode(ListSelectionModel.MULTIPLE_INTERVAL_SELECTION);
        getSelectionModel().addListSelectionListener(this);
        addMouseListener(new MouseInputAdapter()
        {
            public void mousePressed(MouseEvent me)
            {
                bIsControlDown = me.isControlDown();
                clickedRow = rowAtPoint(me.getPoint());
            }
        });
    }

    public void valueChanged(ListSelectionEvent evt)  
    {
        super.valueChanged(evt);
        if (bIsControlDown)
        {
            if (!evt.getValueIsAdjusting())
            {
//                System.out.println(evt);
//                System.out.println("=> " + clickedRow);
                getSelectionModel().removeSelectionInterval(clickedRow, clickedRow);
            }
        }
    }
} 
```

仅将代码中定义的行替换为`table`：

```
 JTable table = new SpecialTable(data, columnNames);
    table.setPreferredScrollableViewportSize(new Dimension(500, 100)); 
```

当您按住 Control 键单击未选择的行时，它会短暂地被选中，然后被取消选择。

# asp.net - Having problem opening/writing to a text file in ASP.NET

> ID：639406
> 
> 赞同：3
> 
> 时间：2009-03-12T16:21:30.987
> 
> 标签：asp.net, vb.net, streamwriter

I want to write some stats to a text file every time a person loads a page. But every once in awhile I am getting at 'Could Not Open File, Already in use' type of error. I can not 100% replicate this error it is very erratic. My code is

```
Public Sub WriteStats(ByVal ad_id As Integer)
    Dim ad_date As String = Now.Year & Now.Month

    Dim FILENAME As String = Server.MapPath("text/BoxedAds.txt")
    Dim objStreamWriter As StreamWriter
    objStreamWriter = File.AppendText(FILENAME)
    objStreamWriter.WriteLine(ad_id & ";" & ad_date)
    objStreamWriter.Close()
End Sub 
```

My question is, how can I lock and unlock the file so I stop getting the erratic errors?

Thanks

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-12T16:23:52.853

If two or more requests hit your web server at roughly the same time, they will all try to open the same file. You will need to create unique file names for each request.

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-12T16:31:13.130

```
Public Sub WriteStats(ByVal ad_id As Integer)
    Dim ad_date As String = Now.Year & Now.Month
    Dim FILENAME As String = Server.MapPath("text/BoxedAds.txt")
    Dim index As Integer

    Using fs As New IO.FileStream(FILENAME, IO.FileMode.Append, IO.FileAccess.Write, IO.FileShare.ReadWrite), _
          tl As New TextWriterTraceListener(fs)

        index = Trace.Listeners.Add(tl)
        Trace.WriteLine(ad_id & ";" & ad_date)
        Trace.Listeners(index).Flush()
        Trace.Flush()
    End Using
    Trace.Listeners.RemoveAt(index)
End Sub 
```

Three important things here:

1.  Use of IO.FileShare.ReadWrite to allow multiple writers on the file at once.
2.  The Using statement to make sure the stream is closed immediately, even if an exception occurs. This will minimize collisions
3.  The TextWriterTraceListener will create a temp file for your if it can't open the file you request, to make sure the message isn't lost.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-12T16:28:36.430

You will have to handle the exception and build some handling to re-try writing to the file after a short random interval.

If you get too much contention then it might make more sense to log it to a table in a database and create a process to export to a file (if its still needed)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-12T16:29:43.727

I haven't had any trouble with short info using: File.AppendAllText(path, info);

Regarding the comment on it causing locks, from reflector it uses the same options explained very well by Joel. It does not use the trace writer, so it won't output to a temp file in the case of high load / large content causing trouble.

If the info is large, you really want separate files. For high load, I would go with Joel's suggestion and create a temp file, which can be alternatively done by catching the exception on File.AppendAllText, and using the same File.AppeandAllText with a unique filename.

# php - PHP 与长时间运行的进程（Python、Java 等）？

> ID：639409
> 
> 赞同：5
> 
> 时间：2009-03-12T16:22:12.700
> 
> 标签：php, python

对于使用 PHP 编写 Web 应用程序与使用 Django 或 Turbogears for Python 等工具的长期运行过程，我想听听你的看法。

据我所知： - 在 PHP 中，每次都会从硬盘中获取页面（尽管我假设操作系统在文件被访问后会在 RAM 中保存一段时间） - 每次都会将页面重新编译为操作码（尽管例如，Zend 的工具可以将编译后的版本保存在 RAM 中） - 每次获取页面意味着每次都读取全局和会话数据，并重新打开与数据库的连接

所以，我想 PHP 在共享服务器（多个站点共享同一主机）上运行适度使用的应用程序是有意义的，而长时间运行的进程为在专用服务器上运行并大量使用的应用程序提供更高的性能？

感谢您的任何反馈。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-12T17:00:05.480

在应用内存缓存、操作码缓存和连接池之后，PHP 和其他选项之间唯一真正的区别是 PHP 是短期的、基于处理的，而其他选项通常是长期的基于多线程的。

PHP 的优点是编写脚本非常简单。您不必担心内存管理（它总是在请求结束时释放），您不必非常担心并发性。

无论如何，我可以看到的主要缺点是一些更高级（有时更疯狂？）的事情更难：预计算结果、预热缓存、重用现有数据、请求优先级和异步编程。我相信人们可以想到更多。

不过，大多数时候，这些缺点并不是什么大问题。您可以通过添加更多机器和使用更多缓存来扩展。一般的 Web 开发人员不需要担心并发控制或内存管理，因此从删除它们中获得微不足道的影响并不是什么大问题。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-12T16:45:46.403

*   使用[APC](http://www.php.net/manual/en/book.apc.php)，它很快就会默认包含在 PHP 中，编译后的字节码保存在 RAM 中。
*   使用最流行的 PHP 使用方式 mod_php，PHP 解释器保留在 Web 服务器的内存中。
*   使用[APC 数据存储](http://www.php.net/manual/en/function.apc-store.php)或[memcache](http://www.php.net/manual/en/ref.memcache.php)，您可以在 RAM 中拥有持久对象，而不是总是通过从 DB 中获取数据来重新创建它们。

在实际部署中，您将使用以上所有内容。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-12T16:28:02.327

在我看来，PHP 对这两种使用都很好，很少注意到性能开销。通常是其他进程会延迟程序。使用 eAccelerator 之类的东西很容易缓存 PHP 程序。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-12T19:26:09.980

正如许多其他人所指出的，PHP 或 Django 将成为您的瓶颈。在 PHP 上为字节码命中硬盘对于一个流量很大的网站来说是无关紧要的，因为缓存将在那个时候接管。Django 也是如此。

模型/视图和用户体验设计将比语言本身对性能产生数量级的好处。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-03-12T16:27:05.857

PHP 是一种类似于 Java 等的语言。只有您的可执行文件是 php 二进制文件，而不是 JVM！您可以毫无问题地为 PHP 脚本设置另一个 MAX-Runtime（如果您的共享主机提供商允许您这样做）。

您的应用程序在哪里运行不应取决于服务器的类型。它应该取决于应用程序使用的资源（CPU-Time、RAM）以及您的服务器/虚拟服务器/共享主机提供的资源！

出于性能调整的原因，您应该看看[eAccelerator](http://eaccelerator.net/)等。Apache 还支持用于连接池的模块！请参阅[mod_dbd](http://httpd.apache.org/docs/2.2/mod/mod_dbd.html)。如果您需要扩展（例如在集群中），您可以使用分布式内存缓存系统，例如[memcached](http://www.danga.com/memcached/)！

# .net - 如何使用 SQL Server 2005 在 NHibernate 中映射 uint

> ID：639428
> 
> 赞同：5
> 
> 时间：2009-03-12T16:25:59.120
> 
> 标签：.net, sql-server-2005, nhibernate, orm, uint32

我的实体上有一个 uint 类型的属性。就像是：

```
public class Enity
{
   public uint Count {get;set;}
} 
```

当我尝试将其持久保存到 SQL Server 2005 数据库中时，出现异常

> 方言不支持 DbType.UInt32

解决此问题的最简单方法是什么。例如，我可以将它存储在数据库中。我只是不知道如何告诉 NHibernate。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-27T09:10:00.410

最干净、*最官方*的解决方案可能是编写用户类型。

举个例子，像[这个](http://www.lostechies.com/blogs/rhouston/archive/2008/03/23/mapping-strings-to-booleans-using-nhibernate-s-iusertype.aspx)并适应它。如果您有很多`uint`'s，则值得拥有一个用户类型。

```
<property name="Prop" type="UIntUserType"/> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-21T05:19:52.150

没有尝试过，所以不确定这是否适合您，但您可以尝试创建自己的方言并在 web.config/app.config 中注册

方言类：

```
public class MyDialect:MsSql2005Dialect
{
    public MyDialect()
    {            
        RegisterColumnType(System.Data.DbType.UInt32, "bigint");            
    }
} 
```

网络配置：

```
configuration>
 <configSections>
  <section name="hibernate-configuration" type="NHibernate.Cfg.ConfigurationSectionHandler, NHibernate" />
 </configSections>

                <hibernate-configuration xmlns="urn:nhibernate-configuration-2.2">
  <session-factory>
   <property name="connection.provider">NHibernate.Connection.DriverConnectionProvider, NHibernate</property>
   <property name="connection.connection_string">
    Server=127.0.0.1; Initial Catalog=thedatabase; Integrated Security=SSPI
   </property>
   <property name="dialect">MyDialect</property>
   <property name="current_session_context_class">managed_web</property>
  </session-factory>
 </hibernate-configuration>
    <!-- other app specific config follows -->

</configuration> 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-12T16:43:44.380

```
<property name="Prop" type="long"/> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-20T09:22:37.513

您可以尝试添加另一个私有“镜像”属性。

```
public class Enity
{
   public uint Count {get;set;}

   private long CountAsLong 
   { 
     get { return Convert.ToInt64(Count); } 
     set { Count = Convert.ToUInt(value); }
   }
}

<property name="CountAsLong" type="long"/> 
```

当然，只有在映射无法解决**时才应该这样做。**

# asp.net-mvc - 更改视图的查找规则

> ID：639450
> 
> 赞同：1
> 
> 时间：2009-03-12T16:33:10.363
> 
> 标签：asp.net-mvc, theming

我有一个在多个国家推出的应用程序。web.config 文件中将有一个设置，用于定义国家/地区。国家/地区不会出现在 URL 中。

一些观点因国家而异。我的第一次尝试是使用包含视图的 views 文件夹中的文件夹，如果它们与默认视图不同：

**默认**

/问题/ask.aspx

**西班牙**

/问题/ESP/ask.aspx

如果国家文件夹中没有视图，则使用默认视图。有没有办法扩展 ViewEngine 以首先在国家文件夹中查找视图？

编辑：

这只是一个 poc。要查看完整的实现，请查看

[http://pietschsoft.com/?tag=/mvc](http://pietschsoft.com/?tag=/mvc)

```
 private static string[] LocalViewFormats = 

       new string[] {
           "~/Views/{1}/ESP/{0}.aspx",
        "~/Views/{1}/{0}.aspx",
        "~/Views/{1}/{0}.ascx",
        "~/Views/Shared/{0}.aspx",
        "~/Views/Shared/{0}.ascx"
    };

      public LocalizationWebFormViewEngine()
      {      
        ViewLocationFormats = LocalViewFormats; 
    } 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-12T17:23:55.530

```
public class MyViewEngine : WebFormViewEngine
{
    private static string[] LocalViewFormats = new[] { "~/Views/ESP/{0}.aspx",
                                                          "~/Views/ESP/{0}.ascx" };
    public MyViewEngine()
    {
        ViewLocationFormats = LocalViewFormats.Union(ViewLocationFormats).ToArray();
    }
} 
```

显然，您不想对位置进行硬编码，但这应该会给您一个大致的想法。

# .net - DataContracts 中的 XmlTextAttribute 等效项

> ID：639462
> 
> 赞同：0
> 
> 时间：2009-03-12T16:37:34.520
> 
> 标签：.net, datacontractserializer

使用 DataContractSerializer 时是否有等效于 XmlTextAttribute 的方法？

我想在将属性序列化为 XML 时将其视为“默认属性”。例如：

```
[Serializable]
[DataContract]
public class Item
{
    [DataMember]
    public String Value
    {
        get;
        set;
    }
} 
```

.Value 设置为“foo”的对象被序列化为：

```
<Item>foo</Item> 
```

而不是：

```
<Item><Value>foo</Value></Item> 
```

李

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-12T17:32:45.993

我认为您不能使用 DataContractSerializer 做到这一点。

马克

# c# - 使用 XML 序列化来序列化没有父节点的集合

> ID：639471
> 
> 赞同：25
> 
> 时间：2009-03-12T16:39:14.873
> 
> 标签：c#, xml-serialization

假设我有一堂课；

```
public class Car 
{ 
  public List<Passenger> Passengers {get; set;} 
} 
```

我想将其序列化为 XML，以便乘客是 Car 的子节点，并且没有中间的乘客节点。换句话说，我希望输出看起来像这样；

```
<Car>
  <Passenger>...</Passenger>
  <Passenger>...</Passenger>
</Car> 
```

而不是这样，这是默认布局；

```
<Car>   
  <Passengers>
    <Passenger>...</Passenger>
    <Passenger>...</Passenger>
  </Passengers> 
</Car> 
```

我需要向 Car.Passengers 添加一个属性来实现这一点，但我不记得是哪个。

* * *

## 回答 #1

> 赞同：42
> 
> 时间：2009-03-12T16:45:14.703

这就是我所追求的！

> ```
> [XmlElement("Passenger")]
> public List<Passenger> Passengers {get; set;} 
> ```

# wpf - WPF 图像缩放

> ID：639477
> 
> 赞同：7
> 
> 时间：2009-03-12T16:40:30.567
> 
> 标签：wpf, image, zooming

我有一个里面有一个图像的 Viewbox。这很棒，因为 Viewbox 会缩放图像以适合窗口。但是，我需要能够将图像缩放到完整尺寸并显示滚动条，我很难弄清楚如何做到这一点。

这就是我现在所拥有的。任何人都可以就我如何修改它以实现上述功能提供一些指示吗？

```
<Viewbox x:Name="viewbox">
    <StackPanel>
        <Image x:Name="image" Source="ranch.jpg" />
    </StackPanel>
</Viewbox> 
```

编辑：只是为了澄清。我需要两种查看图像的方式，适合窗口的视图框样式以及切换到显示滚动条且不调整图像大小的实际大小视图的能力。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-03-12T17:54:26.020

您不需要 a `Viewbox`，通过放入`Image`a`ScrollViewer`并操作`VerticalScrollBarVisibility`and`HorizontalScrollBarVisibility`属性，您可以制作`Image`比例或不制作比例：

```
<Grid xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation" xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
    <Grid.RowDefinitions>
        <RowDefinition Height="Auto"/>
        <RowDefinition/>
    </Grid.RowDefinitions>
    <CheckBox x:Name="chkActualSize" Grid.Row="0" Content="Actual Size"/>
    <ScrollViewer Grid.Row="1">
        <ScrollViewer.Style>
            <Style TargetType="{x:Type ScrollViewer}">
                <Setter Property="HorizontalScrollBarVisibility" Value="Disabled"/>
                <Setter Property="VerticalScrollBarVisibility" Value="Disabled"/>
                <Style.Triggers>
                    <DataTrigger Binding="{Binding IsChecked, ElementName=chkActualSize}" Value="True">
                        <Setter Property="HorizontalScrollBarVisibility" Value="Auto"/>
                        <Setter Property="VerticalScrollBarVisibility" Value="Auto"/>
                    </DataTrigger>
                </Style.Triggers>
            </Style>
        </ScrollViewer.Style>
        <Image Source="http://sipi.usc.edu/database/misc/4.1.01.tiff" VerticalAlignment="Center" HorizontalAlignment="Center"/>
    </ScrollViewer>
</Grid> 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-12T17:00:50.673

```
<ScrollViewer HorizontalScrollBarVisibility="Auto">
    <Viewbox>
        <Image Source="ranch.jpg"/>
    </Viewbox>
</ScrollViewer> 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-12T17:44:55.280

根据您需要切换两种方法的编辑，我会以两种方式之一执行此操作。

1.  图像有两个元素。没有 Viewbox 的 ScrollViewer 中的 Image 元素将为您提供完整大小的图像，而 Viewbox 版本将对其进行缩放。然后，您可以根据要显示的内容切换两者。

2.  在 Image 的 Height 和 Width 属性上使用绑定表达式，并将其包含在滚动查看器中。当您想要缩放它时（在某种触发器中），将 Height 设置为访问 ScrollViewer 的 ActualHeight 属性的绑定表达式或任何高于该属性的容器（使用 RelativeSource 访问最近的祖先，如下所示）：

    ```
    {Binding Path=ActualHeight, 
             RelativeSource={RelativeSource AncestorType={x:Type ScrollViewer}}} 
    ```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2015-05-06T13:52:24.680

以为我会为任何寻找的人发布我的解决方案。

```
 <Slider Width="200" Value="500" Interval="25" Maximum="1000" x:Name="TestImageSlider" Minimum="-50" />
            <ScrollViewer Grid.Row="1" HorizontalScrollBarVisibility="Auto">
              <Image Source="{Binding SelectedScannedImage.ScannedImage}" Width="{Binding Path=Value, ElementName=TestImageSlider}" />
            </ScrollViewer> 
```

# php - 解析错误，期待“T_STRING”或“T_VARIABLE”或“T_NUM_STRING”

> ID：639481
> 
> 赞同：0
> 
> 时间：2009-03-12T16:42:07.177
> 
> 标签：php, parsing

我需要对此有新的看法。我从有人说它有效的人那里得到了这个代码。

这是错误：

```
PHP Parse error: parse error, expecting `T_STRING' or `T_VARIABLE' or `T_NUM_STRING' in C:\Inetpub\wwwroot\2am\employment\send-email-form.php on line 19 
```

第 19 行是`GetUploadedFileInfo()`. 我也收到第 20 行和第 21 行的错误。它显然与`$file_info`数组有关，但这里有什么问题？

```
<?php 
$max_allowed_file_size = "100"; // this is size in KB 
list($name_of_uploaded_file, $type_of_uploaded_file, $size_of_uploaded_file) = GetUploadedFileInfo();
if(!Validate($name_of_uploaded_file, $type_of_uploaded_file, $size_of_uploaded_file, $max_allowed_file_size)) {
   exit();
}
LoadUploadedFile($name_of_uploaded_file);
$path_of_uploaded_file = "uploads/" . $name_of_uploaded_file;

   include_once('Mail.php');
   include_once('mime.php');

ComposeMail($path_of_uploaded_file);

//////////////////// Functions ////////////////////////

function GetUploadedFileInfo() {
   $file_info[] = basename($_FILES['uploaded_file']['name']);
   $file_info[] = substr($file_info[0], strrpos($file_info[0], '.') + 1);
   $file_info[] = $_FILES["uploaded_file"]["size"]/1024;
   return $file_info;
}

function Validate($name_of_uploaded_file, $type_of_uploaded_file, $size_of_uploaded_file, $max_allowed_file_size) {
   if($size_of_uploaded_file>$max_allowed_file_size ) {
       echo "Size of file is greater than" . $max_allowed_file_size . " KB. <a href='attachment_email_form.html'>Click Here to upload a smaller sized file.</a>";
      return false;
   }
$allowed_extension = array("jpg", "jpeg", "gif", "bmp");
for($i=0; $i<sizeof($allowed_extension); $i++) { 
   $allowed_extension[$i] = strtoupper($allowed_extension[$i]); 
}
$type_of_uploaded_file = strtoupper($type_of_uploaded_file);
if(!(in_array(strtoupper($type_of_uploaded_file),$allowed_extension))) {
   echo "You have uploaded a file with an extension of " . $type_of_uploaded_file . " . This type is not allowed. Please upload a file with allowed image extensions like jpg, jpeg, bmp, gif. <a href='attachment_email_form.html'>Click Here to upload a file with allowed extension.</a>";
   return false;
}
   return true;
}

function LoadUploadedFile($name_of_uploaded_file) {
   move_uploaded_file($_FILES["uploaded_file"]["tmp_name"], "uploads/" . $name_of_uploaded_file);
   return true;
}

function ComposeMail($name_of_uploaded_file) {
   $name = $_POST['name'];
   $user_message = $_POST['message'];
   $to = "RecipietnEmail@hotmail.com";
   $subject="An email with attachement is sent";
   $from = "SenderEmail@hotmail.com";
   $text = "A user " . $name . "has sent you this message and an attachment: " . $user_message;
   $message = new Mail_mime(); 
   $message->setTXTBody($text); 
   $message->addAttachment($name_of_uploaded_file);
   $body = $message->get();
   $extraheaders = array("From"=>$from, "Subject"=>$subject);
   $headers = $message->headers($extraheaders);
   $mail = Mail::factory("mail");
   $mail->send($to, $headers, $body);
   echo "Your Email with attachment was sent.";
}
?> 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-12T16:50:36.593

叫我疯了，但我试过这个并没有收到解析错误 - 你确定你正在查看正确的文件（或它的正确版本）吗？

编辑：那么我唯一能想到的是单引号正在关闭一个在其他地方打开的字符串。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-12T17:00:45.977

**$file_info**不是一个函数，它是一个变量（数组）。

您发布的代码没有任何错误。我将其复制/粘贴到 php 文件并运行 lint: **php -l**并报告：*在 test.php 中未检测到语法错误*

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-12T22:30:00.897

好吧，我发现了问题所在。

不知道这完成了什么，但我将第 19 行推到第 20 行，在第 18 行函数 GetUploadedFileInfo() {

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-12T18:00:28.563

浏览器是直接请求 send-email-form.php，还是访问其他包含或需要 send-email-form.php 的 PHP 文件？

如果是另一个脚本包含它的情况，请检查此文件之前包含的任何 PHP 代码或主文件中的任何内联 PHP 代码中是否没有不匹配的字符（括号、引号、大括号等）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-12T17:15:35.037

错误消息看起来像是期待`$file_info[]`. 您是否在使用无法识别`[]`附加到数组末尾的“”语法的古老版本的 PHP？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-12T17:17:35.733

您收到的错误表明括号或引号不匹配，但语法看起来不错。我能够毫无错误地运行该功能：

```
 $ php -a
Interactive shell

php > function GetUploadedFileInfo() {
php {    $file_info[] = basename($_FILES['uploaded_file']['name']);
php {    $file_info[] = substr($file_info[0], strrpos($file_info[0], '.') + 1);
php {    $file_info[] = $_FILES["uploaded_file"]["size"]/1024;
php {    return $file_info;
php { }
php > print_r(GetUploadedFileInfo());
Array
(
    [0] => 
    [1] => 
    [2] => 0
) 
```

@PhiLho php 确实允许您动态创建数组变量。但是，由于它没有被正确初始化，因此在变量在其他地方初始化的情况下，您可能会出现意外行为。但是由于变量在函数内部是隔离的，而不是全局访问的，所以在这种情况下很好。

```
 $ php -a
Interactive shell

php > $a = array();
php > $a[] = 'Hello, world!';
php > print_r($a);
Array
(
    [0] => Hello, world!
)
php > $b[] = 'Hello, SO!';
php > print_r($b);
Array
(
    [0] => Hello, SO!
) 
```

另外，您运行的是什么版本的 PHP？我的示例使用 PHP 5.2.8-pl2-gentoo。

# c# - 在 C# 中，如何安全地退出带有 try catch 块的锁？

> ID：639493
> 
> 赞同：16
> 
> 时间：2009-03-12T16:47:07.803
> 
> 标签：c#

这是一个在锁内发生异常的示例，带有一个 try-catch 块。

```
int zero = 0;
int j = 10;

lock (sharedResource.SyncRoot)
{
    try
    {
        j = j / zero;
    }
    catch (DivideByZeroException e)
    {
        // exception caught but lock not released
    }
} 
```

我如何安全地释放这个锁？

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2009-03-12T16:50:19.433

不会自动释放吗？

来自 MSDN 锁的意思

```
System.Threading.Monitor.Enter(x);
try {
   ...
}
finally {
   System.Threading.Monitor.Exit(x);
} 
```

所以你不必费心。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-03-12T16:55:24.837

在您超出 lock(sharedResource.SyncRoot) 块的范围之前，不会释放锁。 `lock (sharedResource.SyncRoot) {}`基本等同于：

```
Monitor.Enter(sharedResource.SyncRoot);
try
{
}
finally
{
    Monitor.Exit(sharedResource.SyncRoot);
} 
```

如果您想要更多控制权，您可以自己执行 Enter/Exit，或者只是将锁定范围重新调整为您想要的，例如：

```
try
{
    lock(sharedResource.SyncRoot)
    {
        int bad = 2 / 0;
    }
}
catch (DivideByZeroException e)
{
   // Lock released by this point.
} 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-03-12T17:02:16.147

证明。

```
.method public hidebysig instance void  test(int32 i) cil managed
{
  // Code size       43 (0x2b)
  .maxstack  2
  .locals init ([0] int32 bad,
           [1] class [mscorlib]System.DivideByZeroException e,
           [2] object CS$2$0000)
  IL_0000:  nop
  IL_0001:  ldarg.0
  IL_0002:  ldfld      object WebApplication1.myclass::mutex
  IL_0007:  dup
  IL_0008:  stloc.2
  IL_0009:  call       void [mscorlib]System.Threading.Monitor::Enter(object)
  IL_000e:  nop
  .try
  {
    IL_000f:  nop
    .try
    {
      IL_0010:  nop
      IL_0011:  ldc.i4.2
      IL_0012:  ldarg.1
      IL_0013:  div
      IL_0014:  stloc.0
      IL_0015:  nop
      IL_0016:  leave.s    IL_001d
    }  // end .try
    catch [mscorlib]System.DivideByZeroException 
    {
      IL_0018:  stloc.1
      IL_0019:  nop
      IL_001a:  nop
      IL_001b:  leave.s    IL_001d
    }  // end handler
    IL_001d:  nop
    IL_001e:  nop
    IL_001f:  leave.s    IL_0029
  }  // end .try
  finally
  {
    IL_0021:  ldloc.2
    IL_0022:  call       void [mscorlib]System.Threading.Monitor::Exit(object)
    IL_0027:  nop
    IL_0028:  endfinally
  }  // end handler
  IL_0029:  nop
  IL_002a:  ret
} // end of method myclass::test 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-03-12T19:43:12.937

Jaredpar 在评论中发布了一个链接，我认为值得一试：

[http://blogs.msdn.com/ericlippert/archive/2009/03/06/locks-and-exceptions-do-not-mix.aspx](http://blogs.msdn.com/ericlippert/archive/2009/03/06/locks-and-exceptions-do-not-mix.aspx)

在这篇博文中，Eric Lippert 评论了与 C# 中的锁定相关的问题：

> 这里的问题是，如果编译器在监视器进入和 try 保护区域之间生成一个无操作指令，那么运行时可能会在监视器进入之后但在 try 之前引发线程中止异常。在那种情况下， finally 永远不会运行，因此锁泄漏，可能最终导致程序死锁。如果这在未优化和优化的构建中是不可能的，那就太好了。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-03-12T16:55:40.653

您的代码非常好。被`lock(sth){...}`内部翻译成`try finally`块。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-12T16:51:01.197

无论如何，它不会像这样运行：

```
try
{
  lock (sharedResource.SyncRoot)
  {
      int bad = 2 / 0;
  }
}
catch (DivideByZeroException e)
{
    // exception caught but lock not released
}
finally
{
      //release lock
} 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-12T16:53:06.980

当退出它的块的上下文时，锁将被释放，但是会发生这种情况。在上面给出的代码示例中，当控制退出最终的 } 上下文时，锁将自动、安全地释放。

# c++ - C ++将一堆值与给定值进行比较

> ID：639496
> 
> 赞同：3
> 
> 时间：2009-03-12T16:47:54.167
> 
> 标签：c++

我需要将一个给定值与检索到的值进行比较。我在代码中多次这样做。我对它的外观不满意，我正在寻找某种实用功能。有人写过吗？

我要比较的值的数量在编译时是已知的。

**更新：**我想摆脱容器，因为我知道我想要比较的确切值（通常不超过 3）。而且每次都往容器里放东西也不是很方便。**如果**
两者都不是， 我不喜欢，因为它不像“找到”那样明显。

 **```
#include <algorithm>
#include <string>
#include <vector>

std::string getValue1()
{
    return "test";
}

std::string getValue2()
{
    return "the";
}

std::string getValue3()
{
    return "world";
}

int main()
{
    const std::string value = "the";

    // simple if
    if ( value == getValue1() ||
         value == getValue2() ||
         value == getValue3() )
        return 1;

    // using collections like vector, set
    std::vector<std::string> values;
    values.push_back( getValue1() );
    values.push_back( getValue2() );
    values.push_back( getValue3() );
    if ( values.end() != std::find( values.begin(), values.end(), value ) )
        return 1;

    // third option I'd use instead
    //

    return 0;
} 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-12T16:55:56.643

如果您要查找的值与 operator< 可比（如整数、浮点数和 std::strings），那么使用 std::set 将值放在那里然后检查 set.find(value) = 会更快= set.end()。这是因为该集合将以允许更快查找的特定顺序存储值。使用哈希表会更快。但是，对于少于 50 个左右的值，您可能不会注意到任何差异 :) 所以我的经验法则是：

*   少于 5 项：如果有多个 ||

*   5个或更多：放入一个集合或哈希表

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-12T17:14:39.080

您可以编写一组模板函数来帮助您完成此操作，例如：

```
template <typename T>
bool InSet(const T & item, const T & i1, const T & i2) {
  return item==i1 || item==i2;
}

template <typename T>
bool InSet(const T & item, const T & i1, const T & i2, const T & i3) {
  return item==i1 || item==i2 || item==i3;
} 
```

请注意，您可以通过创建具有不同数量参数的多个模板来使 InSet 像使用可变数量的参数一样工作。

进而：

```
int i;
if (InSet(i, 3, 4, 5)) { ... }
string s;
if (InSet(s, "foobar", "zap", "garblex")) { ... } 
```

等等

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-12T17:16:54.207

您**不需要***std::set*或std *::vector*。只需使用**std::set_intersection()** ...

代码最好...

```
#include <set>
#include <iostream>
#include <iterator>
using namespace std;

#define COUNT(TYPE,ARRAY)  ( sizeof(ARRAY) / sizeof(TYPE) )

inline bool CaseInsensitiveCompare (const char * a, const char * b)
  {  return strcasecmp( a, b ) < 0;  }

int  main()
{
  const char * setA[] = { "the", "world", "is", "flat" };
  const char * setB[] = { "the", "empty", "set", "is", "boring" };

  stable_sort( setA,  setA + COUNT( const char *, setA ),
               CaseInsensitiveCompare );

  stable_sort( setB,  setB + COUNT( const char *, setB ),
               CaseInsensitiveCompare );

  cout << "Intersection of sets:  ";
  set_intersection( setA, setA + COUNT( const char *, setA ),
                    setB, setB + COUNT( const char *, setB ),
                    ostream_iterator<const char *>(cout, " "),
                    CaseInsensitiveCompare );
  cout << endl << endl;
} 
```

* * *

或者，考虑到您的 1-N 查找问题：（
注意：在排序后使用**binary_search** *()* ！）

 **```
if ( binary_search( setA, setA + COUNT( const char *, setA ),
            "is", CaseInsensitiveCompare ) )
  ...

if ( binary_search( setA, setA + COUNT( const char *, setA ),
            "set", CaseInsensitiveCompare ) )
  ... 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-12T17:32:03.047

为您的要求做

```
if (InSet(value)(GetValue1(), GetValue2(), GetValue3()))
{
   // Do something here...
} 
```

试试这个：

```
template <typename T>
class InSetHelper
{
     const T &Value;
     void operator=(const InSetHelper &);
public:
     InSetHelper(const T &value) : Value(value) {}

     template<class Other, class Another>
     bool operator()(const Other &value1, const Another &value2) const
     {
         return Value == value1 || Value == value2;
     }
     template<class Other, class Another, class AThird>
     bool operator()(const Other &value1, const Another &value2, const AThird &value3) const
     {
         return Value == value1 || Value == value2 || Value == value3;
     }
};

template <typename T> 
InSetHelper<T> InSet(const T &value) { return InSetHelper<T>(value); } 
```

不过，这种语法可能更清楚：

```
if (MakeSet(GetValue1(), GetValue2(), GetValue3()).Contains(value))
{
   // Do something here...
}

template <typename T, typename U, typename V>
class Set3
{
    const T& V1;
    const U& V2;
    const V& V3;
    void operator=(const Set3 &);
public:
    Set3(const T &v1, const U &v2, const V &v3) : V1(v1), V2(v2), V3(v3) {}

    template <typename W>
    bool Contains(const W &v) const
    {
        return V1 == v || V2 == v || V3 == v;
    }
};

template <typename T, typename U>
class Set2 
{ 
     // as above 
};

template <typename T, typename U, typename V>
Set3<T, U, V> MakeSet(const T &v1, const U &v2, const V &v3)
{
    return Set3<T, U, V>(v1, v2, v3);
}

template <typename T, typename U>
Set3<T, U> MakeSet(const T &v1, const U &v23)
{
    return Set3<T, U, V>(v1, v2);
} 
```

如果这些值真的是树或链表的一部分，那么你已经有了你的集合/容器，你最好的选择是只使用一些递归：

```
parent.ThisOrDescendantHasValue(value); 
```

您只需将其添加到父母和孩子所属的任何班级：

```
class Node
{
public: 
    Value GetValue();
    Node *GetChild();
    bool ThisOrDescendantHasValue(const Value &value)
    {
        return GetValue() == value
           || (GetChild() && GetChild->ThisOrDescendantHasValue(value));
    }
}; 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-12T17:37:15.593

哪个变化更大，“值”或“getValueX()”返回的值？您可以将所有内容插入到 hash_map/map 中，然后按照您对容器的建议进行搜索。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-12T16:52:05.093

`std::find_first_of`.

当然，如果您只关心查找单个值，您可以创建自己的包装器`std::find`。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-12T16:53:33.187

我会推荐您的方法 2，使用 std::vector 或其他容器并寻找会员资格。由于您检查的元素顺序可能不相关，因此您可能需要使用 std::set 或 std::map。如果您的值集中有很多项目，那么使用集合或地图会更快，而如果您只有几个向量可能会更快。

这些方法中的任何一种的优点是您可以将集合/映射存储在某个公共位置，并避免每次都构建匹配响应集。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-12T16:55:53.023

我喜欢集合方法，也许使用 hash_set 而不是向量。将值存储在属性文件中，并具有从文件中填充 hash_set 的方法，如果值在 hash_set 中，则另一种方法返回布尔值。然后你可以在主代码中减少到两行。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-12T17:24:53.190

这取决于检索值的来源，如果您从文件或流中读取，那么您会做一些不同的事情，但如果您的来源是一系列函数，那么以下是一种不同的方法，并不完美但可能适合您的需求：

```
const int count = 3;
std::string value = "world";
boost::function<std::string(void)> funcArray[count];
funcArray[0] = &getValue1;
funcArray[1] = &getValue2;
funcArray[2] = &getValue3;

for( int i = 0; i < count; ++i )
{
    if( funcArray[i]() == value )
        return 1;
} 
```

如果您知道哪些函数是源（以及对象的数量），我希望您可以使用预处理器组装函数指针数组。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-03-12T17:41:10.763

如何使用 boost::array（或 std::tr1::array）并创建一个像这样的简单函数：

```
template <typename ValueType, size_t arraySize>
bool contains(const boost::array<ValueType, arraySize>& arr, const ValueType& val)
{
    return std::find(arr.begin(), arr.end(), val)!=arr.end();
} 
```

然后你可以很容易地重用它：

```
#include <string>
#include <iostream>

#include <boost\array.hpp>

template <typename ValueType, size_t arraySize>
bool contains(const boost::array<ValueType, arraySize>& arr, const ValueType& val)
{
    return std::find(arr.begin(), arr.end(), val)!=arr.end();
}

int _tmain(int argc, _TCHAR* argv[])
{
    boost::array<std::string, 3> arr = {"HI", "there", "world"};

    std::cout << std::boolalpha 
        << "arr contains HI: " << contains(arr, std::string("HI")) << std::endl
        << "arr contains blag: " << contains(arr, std::string("blag") ) << std::endl
        << "arr contains there: " << contains(arr, std::string("there") ) << std::endl;

    return 0;
} 
```

**编辑：**所以提升了。将其调整为常规数组非常容易：

```
template <typename ValueType, size_t arraySize>
bool contains(ValueType (&arr)[arraySize], const ValueType& val)
{
    return std::find(&arr[0], &arr[arraySize], val)!=&arr[arraySize];
}

int _tmain(int argc, _TCHAR* argv[])
{
    std::string arr[3] = {"HI", "there", "world"};

    std::cout << std::boolalpha << "arr contains HI: " << contains(arr, std::string("HI")) << std::endl
        << "arr contains blag: " << contains(arr, std::string("blag") ) << std::endl
        << "arr contains there: " << contains(arr, std::string("there") ) << std::endl;

    return 0;
} 
```

# iphone - iPhone 配置：钥匙串是否在 CSR 中插入了错误的电子邮件地址？

> ID：639507
> 
> 赞同：0
> 
> 时间：2009-03-12T16:51:32.753
> 
> 标签：iphone, email, provisioning, signing, keychain

我遇到了一个问题，我的开发证书没有扩展（未链接）到我的私钥。

我将问题追溯到用于创建我的开发证书的电子邮件中的差异，并且当我安装我创建的用于制作我的开发证书的 CSR 时，一个钥匙串是自动选择的。

我通过检查我的 CSR 的内容来验证这一点，如下所示。

1) 双击现有的 CSR 文件以启动 Keychain 中的“安装”过程。

2) 选中“让我覆盖此请求的默认值”复选框。

3) 按 Continue 两次进入“创建您的证书”页面。

4) 选中“让我覆盖默认值”复选框。

5) 按 Continue 两次进入“证书信息”页面。

在这里，我发现“电子邮件地址”字段中列出的电子邮件与我用来创建开发证书的电子邮件不同。

我尝试选择正确的电子邮件并安装 CSR，但无法链接证书。

我能找到的唯一解决方法是使用那个旧的电子邮件地址重新创建我的开发证书，这样当我以正常方式安装 CSR 时，一切都已链接。

其他人遇到过这个问题吗？

有谁知道钥匙串在哪里获得备用电子邮件地址列表，所以我可以清除它？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-30T06:04:22.850

让证书正常工作曾经是一团糟。去年我尝试按照 Apple 的原始说明进行操作，但始终无法正常工作。幸运的是，有一种更简单、更可靠的新方法：

1.  登录 Apple iPhone 开发中心 ( [http://developer.apple.com/iphone/](http://developer.apple.com/iphone/) )
2.  **单击指向iPhone 开发人员计划门户**的链接（屏幕右侧）
***   在页面中间有一个新工具。**标题文本显示“使用Development Provisioning Assistant**在 iPhone 上获取您的应用程序”，并且有一个标记为“ **launch assistant** ”的按钮。单击标有“启动助手”的按钮并按照说明进行操作。**

 **结果：Apple 将亲自带领您完成整个认证过程，并且与以前完全不同-您当前的问题甚至可能不会出现。

# c - 在哪里可以找到 IJG libjpeg 的好教程

> ID：639511
> 
> 赞同：8
> 
> 时间：2009-03-12T16:52:13.360
> 
> 标签：c, libjpeg, ijg

我需要对这个库做一些工作，我发现[http://apodeline.free.fr/DOC/libjpeg/libjpeg.html](http://apodeline.free.fr/DOC/libjpeg/libjpeg.html)上的文档有缺陷（函数签名不完整等）。有谁知道其他方面或有一些示例代码说明常见任务？

[编辑] 我还通过一个例子找到了这个[问题](https://stackoverflow.com/questions/637043/using-jpeglib-for-jpeg-compressed-byte-stream)，但其他任何问题都会有所帮助。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-12T17:05:30.223

尝试使用[libjpeg](http://libjpeg.sourceforge.net/)库。示例如何使用它在[这个博客](http://andrewewhite.net/lifetype/blog.php/the-white-blog/programming/2008/09/02/very-simple-jpeg-writer-in-c-c)中。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-12T17:17:22.507

我不知道您在使用什么，但我们使用[Smaller Animals Software](http://www.smalleranimals.com/jpegfile.htm)的 C++ 包装器，我们对此感到满意。如果不出意外，它可以作为示例代码工作。

# javascript - 如何获取 JavaScript 变量的内存地址？

> ID：639514
> 
> 赞同：75
> 
> 时间：2009-03-12T16:53:03.967
> 
> 标签：javascript, spidermonkey, memory-address

是否可以找到 JavaScript 变量的内存地址？JavaScript 代码是（嵌入）普通应用程序的一部分，其中 JavaScript 用作 C++ 的前端，并且不在浏览器上运行。使用的 JavaScript 实现是 SpiderMonkey。

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-03-12T16:59:30.723

如果可能的话，它将非常依赖于javascript引擎。更现代的 javascript 引擎使用即时编译器编译他们的代码，并且弄乱他们的内部变量对性能不利，或者对稳定性不利。

如果引擎允许，为什么不对一些本机代码创建一个函数调用接口来交换变量的值呢？

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2013-04-23T15:34:37.040

这或多或少是不可能的——Javascript 的评估策略是始终使用按值调用，但在对象（包括数组）的情况下，传递的值是对对象的引用，它不会被复制或克隆。如果您在函数中重新分配对象本身，则不会更改原始对象，但如果您重新分配对象的属性之一，则会影响原始对象。

也就是说，你想要完成什么？如果只是在 C++ 和 Javascript 之间传递复杂的数据，您可以使用 JSON 库进行通信。将一个 JSON 对象发送给 C++ 进行处理，并获取一个 JSON 对象来替换旧的对象。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2021-03-14T08:54:20.250

您可以使用***side-channel***，但除了攻击浏览器安全之外，您无法用它做任何有用的事情！

最接近虚拟地址的是 ArrayBuffers。

如果 ArrayBuffer 中的一个虚拟地址被识别，则其余地址也是已知的，因为内存地址和数组索引都是线性的。

尽管虚拟地址本身不是物理内存地址，但有一些方法可以将虚拟地址转换为物理内存地址。

浏览器引擎分配 ArrayBuffers 总是页面对齐。因此，ArrayBuffer 的第一个字节位于新物理页的开头，并且最低有效 12 位设置为“0”。

如果分配了大块内存，浏览器引擎通常使用 mmap 来分配此内存，该内存已优化为分配 2 MB 透明大页面 (THP) 而不是 4 KB 页面。

由于这些物理页面是按需映射的，即，一旦第一次访问页面，遍历数组索引就会导致新页面开始出现页面错误。解决页面错误的时间明显高于正常的内存访问。因此，您可以知道新的 2 MB 页面开始的索引。在该数组索引处，底层物理页的 21 个最低有效位设置为“0”。

这个答案不是试图提供概念证明，因为我没有时间这样做，但我将来可能会这样做。这个答案试图为提出问题的人指出正确的方向。

来源，

[http://www.misc0110.net/files/jszero.pdf](http://www.misc0110.net/files/jszero.pdf)

[https://download.vusec.net/papers/anc_ndss17.pdf](https://download.vusec.net/papers/anc_ndss17.pdf)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2020-05-14T14:52:14.517

我认为这是可能的，但你必须：

1.  下载 node.js 源代码。
2.  手动添加你的函数（比如返回指针的内存地址等）
3.  编译它并将其用作您的节点可执行文件。

# hibernate - 在 HQL 中执行日期/时间数学？

> ID：639522
> 
> 赞同：16
> 
> 时间：2009-03-12T16:55:28.563
> 
> 标签：hibernate, datetime, hql

我正在寻找如何在 HQL 查询中执行日期/时间数学。具体来说，如何从`current_timestamp()`函数的结果中添加或减去 (x) 时间量？或者我是否必须为此投入 SQL 并希望正在运行的任何数据库都支持它？

HQL 查询示例：

```
FROM RandomThing
WHERE randomTime IS NOT NULL AND
      randomTime >= current_timestamp() AND
      randomTime <= (current_timestamp() + :timeToAdd) 
```

我可以将 :timeToSubtract 参数定义为任何特定单位，但任何大于小时的单位都是不可取的，而秒是最可取的。

澄清：我意识到这可以在查询之外轻松完成。但是出于哲学原因，假设使用数据库服务器的时间而不是查询系统的时间很重要。实际示例：我正在查询在最后 (x) 时间内创建的所有条目的自动时间戳。由于时间戳是由数据库系统生成的，因此使用数据库的当前时间也很重要。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-12T20:27:01.037

为什么需要在查询中这样做？为什么不在java代码中处理它。

例如：

```
From RandomThing
Where randomTime is not null and
      randomTime >= :currentTimestamp and
      randomTime <= :maxTimestamp 
```

然后只需设置参数。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-13T04:04:22.590

您可以确定使用数据库中的 SQL 执行此操作的语法，然后在自定义 HibernateDialect 中定义一个函数。例如，我们需要一个非标准 SQL 的工作日函数。我们对每个数据库的方言进行子类化，然后添加如下一行：

```
registerFunction("weekday", 
  new SQLFunctionTemplate(Hibernate.INTEGER, "to_char(?1,'D')") ); 
```

在您的情况下，您可以使用一个名为 date_diff 的函数，它可能被定义为 ? - ？在某些数据库中或在其他数据库中不同。这样您就不必在查询中编写原始 SQL，如果您需要切换数据库，您只需在方言中以不同方式映射函数。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-09-15T12:12:12.957

如果您需要数据库服务器的时间，您可以先执行一个简单的 hql 查询来获取时间戳，然后在 java 中计算 maxTimestamp 并将获取的时间戳和计算出的 maxTimeStamp 传递给类似 ccclark 的查询。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-13T19:12:50.863

它必须是HQL吗？我可能会切换到休眠标准并使用：

```
Criteria.add( Restrictions.SQLRestriction( "{alias} <= current_timestamp() " ) )
Criteria.add( Restrictions.SQLRestriction( "{alias} >= (current_timestamp() + ?) ", 5 ) 
```

# mysql - 在 MySQL 数据库的每个表的字段中搜索文本

> ID：639531
> 
> 赞同：336
> 
> 时间：2009-03-12T16:57:13.303
> 
> 标签：mysql

我想在 MySQL 数据库的所有表中搜索给定字符串的所有字段，可能使用以下语法：

```
SELECT * FROM * WHERE * LIKE '%stuff%' 
```

有可能做这样的事情吗？

* * *

## 回答 #1

> 赞同：471
> 
> 时间：2011-01-27T13:51:17.377

您可以执行`SQLDump`数据库（及其数据）然后搜索该文件。

* * *

## 回答 #2

> 赞同：226
> 
> 时间：2010-10-01T17:22:03.003

如果您安装了 phpMyAdmin，请使用其“搜索”功能。

*   选择您的数据库
*   确保您确实选择了数据库（即不是表，否则您将获得完全不同的搜索对话框）
*   点击“搜索”标签
*   选择您想要的搜索词
*   选择要搜索的表

我已经在多达 250 个表/10GB 数据库（在快速服务器上）上使用了它，响应时间简直令人惊叹。

* * *

## 回答 #3

> 赞同：85
> 
> 时间：2009-03-12T17:00:19.520

您可以查看`information_schema`架构。它具有所有表和表中所有字段的列表。然后，您可以使用从该表中获得的信息运行查询。

涉及的表是 SCHEMATA、TABLES 和 COLUMNS。有外键，这样您就可以准确地构建表在模式中的创建方式。

* * *

## 回答 #4

> 赞同：48
> 
> 时间：2011-03-08T15:58:44.417

PHP函数：

```
function searchAllDB($search){
    global $mysqli;

    $out = Array();

    $sql = "show tables";
    $rs = $mysqli->query($sql);
    if($rs->num_rows > 0){
        while($r = $rs->fetch_array()){
            $table = $r[0];
            $sql_search = "select * from `".$table."` where ";
            $sql_search_fields = Array();
            $sql2 = "SHOW COLUMNS FROM `".$table."`";
            $rs2 = $mysqli->query($sql2);
            if($rs2->num_rows > 0){
                while($r2 = $rs2->fetch_array()){
                    $column = $r2[0];
                    $sql_search_fields[] = "`".$column."` like('%".$mysqli->real_escape_string($search)."%')";
                }
                $rs2->close();
            }
            $sql_search .= implode(" OR ", $sql_search_fields);
            $rs3 = $mysqli->query($sql_search);
            $out[$table] = $rs3->num_rows."\n";
            if($rs3->num_rows > 0){
                $rs3->close();
            }
        }
        $rs->close();
    }

    return $out;
}

print_r(searchAllDB("search string")); 
```

* * *

## 回答 #5

> 赞同：17
> 
> 时间：2018-10-29T21:48:47.377

这是我知道的简单方法。在 PHPMyAdmin 中选择您的数据库，然后转到“搜索”选项卡并写下您想要查找的内容以及您将搜索的位置。如果要从所有表中搜索单词，请选择所有表。然后“GO”并查看结果。[![我想从我的 Wordpress DB 中找到 VCD（后门）这个词来删除](https://i.stack.imgur.com/u9wGD.png)](https://i.stack.imgur.com/u9wGD.png)

* * *

## 回答 #6

> 赞同：16
> 
> 时间：2016-11-17T04:56:53.643

如果您是在躲避瘟疫，或者由于权限而`stored procedures`无法执行，或者遇到其他各种原因。`mysql_dump`

我建议采用这样的三步方法：

1) 此查询将一堆查询构建为结果集。

```
# =================
# VAR/CHAR SEARCH
# =================
# BE ADVISED USE ANY OF THESE WITH CAUTION
# DON'T RUN ON YOUR PRODUCTION SERVER 
# ** USE AN ALTERNATE BACKUP **

SELECT 
    CONCAT('SELECT * FROM ', A.TABLE_SCHEMA, '.', A.TABLE_NAME, 
           ' WHERE ', A.COLUMN_NAME, ' LIKE \'%stuff%\';') 
FROM INFORMATION_SCHEMA.COLUMNS A
WHERE 
            A.TABLE_SCHEMA != 'mysql' 
AND     A.TABLE_SCHEMA != 'innodb' 
AND     A.TABLE_SCHEMA != 'performance_schema' 
AND     A.TABLE_SCHEMA != 'information_schema'
AND     
        (
            A.DATA_TYPE LIKE '%text%'
        OR  
            A.DATA_TYPE LIKE '%char%'
        )
; 
```

.

```
# =================
# NUMBER SEARCH
# =================
# BE ADVISED USE WITH CAUTION

SELECT 
    CONCAT('SELECT * FROM ', A.TABLE_SCHEMA, '.', A.TABLE_NAME, 
           ' WHERE ', A.COLUMN_NAME, ' IN (\'%1234567890%\');') 
FROM INFORMATION_SCHEMA.COLUMNS A
WHERE 
            A.TABLE_SCHEMA != 'mysql' 
AND     A.TABLE_SCHEMA != 'innodb' 
AND     A.TABLE_SCHEMA != 'performance_schema' 
AND     A.TABLE_SCHEMA != 'information_schema'
AND     A.DATA_TYPE IN ('bigint','int','smallint','tinyint','decimal','double')
; 
```

.

```
# =================
# BLOB SEARCH
# =================
# BE ADVISED THIS IS CAN END HORRIFICALLY IF YOU DONT KNOW WHAT YOU ARE DOING
# YOU SHOULD KNOW IF YOU HAVE FULL TEXT INDEX ON OR NOT
# MISUSE AND YOU COULD CRASH A LARGE SERVER
SELECT 
    CONCAT('SELECT CONVERT(',A.COLUMN_NAME, ' USING utf8) FROM ', A.TABLE_SCHEMA, '.', A.TABLE_NAME, 
           ' WHERE CONVERT(',A.COLUMN_NAME, ' USING utf8) IN (\'%someText%\');') 
FROM INFORMATION_SCHEMA.COLUMNS A
WHERE 
            A.TABLE_SCHEMA != 'mysql' 
AND     A.TABLE_SCHEMA != 'innodb' 
AND     A.TABLE_SCHEMA != 'performance_schema' 
AND     A.TABLE_SCHEMA != 'information_schema'
AND     A.DATA_TYPE LIKE '%blob%'
; 
```

结果应如下所示：

[![将这些结果复制到另一个查询窗口](https://i.stack.imgur.com/rgfCp.png)](https://i.stack.imgur.com/rgfCp.png)

2）然后您可以`Right Click`使用`Copy Row (tab-separated)`

[![在此处输入图像描述](https://i.stack.imgur.com/0Ijfb.png)](https://i.stack.imgur.com/0Ijfb.png)

3) 将结果粘贴到新的查询窗口中，然后运行到您想要的内容。

详细信息：我排除了您通常不会在工作台中看到的系统架构，除非您`Show Metadata and Internal Schemas`选中了该选项。

我这样做是为了`ANALYZE`在需要时为整个 HOST 或 DB 提供一种快速方法，或者运行`OPTIMIZE`语句以支持性能改进。

我敢肯定，您可以采用*不同*的方法来执行此操作，但以下方法对我有用：

```
-- ========================================== DYNAMICALLY FIND TABLES AND CREATE A LIST OF QUERIES IN THE RESULTS TO ANALYZE THEM
SELECT CONCAT('ANALYZE TABLE ', TABLE_SCHEMA, '.', TABLE_NAME, ';') FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'dbname';

-- ========================================== DYNAMICALLY FIND TABLES AND CREATE A LIST OF QUERIES IN THE RESULTS TO OPTIMIZE THEM
SELECT CONCAT('OPTIMIZE TABLE ', TABLE_SCHEMA, '.', TABLE_NAME, ';') FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'dbname'; 
```

> 在 MySQL 版本上测试：5.6.23
> 
> 警告：如果出现以下情况，请勿运行：
> 
> 1.  您担心导致表锁（注意您的客户端连接）
> 2.  你不确定你在做什么。
>     
>     
> 3.  您正试图激怒您的 DBA。（你的办公桌上可能会有人*很快*。）

干杯，杰;-]

* * *

## 回答 #7

> 赞同：9
> 
> 时间：2015-09-14T15:35:38.273

使用 MySQL Workbench，可以轻松选择多个表并在数据库的所有这些表中运行文本搜索；-)

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2014-10-08T10:30:49.943

我也做了自己的mysql爬虫来搜索一些wordpress配置，在界面和数据库中都找不到，而且数据库转储太重且不可读。我必须说我现在不能没有它。

它的工作方式与@Olivier 中的类似，但它管理异国情调的数据库/表名，并且是 LIKE-joker 安全的。

```
<?php

$database = 'database';
$criteria = '*iemblo'; // you can use * and ? as jokers

$dbh = new PDO("mysql:host=127.0.0.1;dbname={$database};charset=utf8", 'root', '');
$dbh->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);

$tables = $dbh->query("SHOW TABLES");
while (($table = $tables->fetch(PDO::FETCH_NUM)) !== false)
{
    $fields = $dbh->prepare("SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_SCHEMA = ? AND TABLE_NAME = ?");
    $fields->execute(array ($database, $table[0]));

    $ors = array ();
    while (($field = $fields->fetch(PDO::FETCH_NUM)) !== false)
    {
        $ors[] = str_replace("`", "``", $field[0]) . " LIKE REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(:search, '\\\\', '\\\\\\\\'), '%', '\\%'), '_', '\\_'), '*', '%'), '?', '_')";
    }

    $request = 'SELECT * FROM ';
    $request .= str_replace("`", "``", $table[0]);
    $request .= ' WHERE ';
    $request .= implode(' OR ', $ors);
    $rows = $dbh->prepare($request);

    $rows->execute(array ('search' => $criteria));

    $count = $rows->rowCount();
    if ($count == 0)
    {
        continue;
    }

    $str = "Table '{$table[0]}' contains {$count} rows matching '{$criteria}'.";
    echo str_repeat('-', strlen($str)), PHP_EOL;
    echo $str, PHP_EOL;
    echo str_repeat('-', strlen($str)), PHP_EOL;

    $counter = 1;
    while (($row = $rows->fetch(PDO::FETCH_ASSOC)) !== false)
    {
        $col = 0;
        $title = "Row #{$counter}:";
        echo $title;
        foreach ($row as $column => $value)
        {
            echo
            (($col++ > 0) ? str_repeat(' ', strlen($title) + 1) : ' '),
            $column, ': ',
            trim(preg_replace('!\s+!', ' ', str_replace(array ("\r", "\t", "\n"), array ("", "", " "), $value))),
            PHP_EOL;
        }
        echo PHP_EOL;
        $counter++;
    }
} 
```

运行此脚本可能会输出如下内容：

```
---------------------------------------------------
Table 'customers' contains 1 rows matching '*iemblo'.
---------------------------------------------------
Row #1: email_client: my@email.com
        numero_client_compta: C05135
        nom_client: Tiemblo
        adresse_facturation_1: 151, My Street
        adresse_facturation_2: 
        ville_facturation: Nantes
        code_postal_facturation: 44300
        pays_facturation: FR
        numero_tva_client: 
        zone_geographique: UE
        prenom_client: Alain
        commentaires: 
        nom_societe: 
        email_facturation: my@email.com 
```

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2021-08-25T00:19:37.283

已经*十二年*了，没有人回答以下问题：

**我想在 MySQL 数据库的所有表中的所有字段中搜索给定的字符串**

Anwsers 包括 GUI、模糊的想法、语法错误、需要表名或前缀的过程以及各种扭曲。这是一个实际的、工作的、经过测试的、简单易用的答案，它建立在多个先前的答案之上，但也将主键添加到结果中。

```
DROP PROCEDURE IF EXISTS findAll;
DELIMITER $$
CREATE PROCEDURE findAll( IN `search` TEXT )
BEGIN
    SET SESSION group_concat_max_len := @@max_allowed_packet;
    SELECT GROUP_CONCAT(
        "SELECT '", c1.TABLE_NAME, "' AS `table`, '", c1.COLUMN_NAME, "' AS `column`, ",
        "CONCAT_WS(',', ",  (SELECT GROUP_CONCAT(c2.column_name) FROM `information_schema`.`columns` c2 WHERE c1.TABLE_SCHEMA=c2.TABLE_SCHEMA AND c1.TABLE_NAME=c2.TABLE_NAME AND c2.COLUMN_KEY='PRI') ,") AS pri,", 
        c1.COLUMN_NAME, " AS value FROM ", c1.TABLE_NAME,
      " WHERE `",c1.COLUMN_NAME,"` LIKE '%", search, "%'" SEPARATOR "\nUNION\n") AS col 
    INTO @sql   
    FROM information_schema.columns c1 
    WHERE c1.TABLE_SCHEMA = DATABASE();
  PREPARE stmt FROM @sql;
  EXECUTE stmt;
  DEALLOCATE PREPARE stmt;
END $$
DELIMITER ; 
```

就是这样。你现在可以做`CALL findAll('foobar');`

除了没有。你会遇到两个问题：

1.  MySQL 错误 1436：线程堆栈溢出
2.  准备好的语句需要重新准备。

将以下两行添加到`/etc/mysql/mysql.conf.d/mysqld.cnf`您所在的位置或任何`cnf`位置，或将它们保存在单独的文件中并复制到`conf.d`目录中。

```
thread_stack            = 2M
table_definition_cache  = 5000 
```

是的，显然这不应该在生产环境中运行，因为它不安全并且会降低你的性能。

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2011-02-11T16:56:50.613

这是检索所有列和表的最简单查询

```
SELECT * FROM information_schema.`COLUMNS` C WHERE TABLE_SCHEMA = 'YOUR_DATABASE' 
```

可以通过 phpMyAdmin 中的“搜索”选项卡搜索所有表或名称中具有特定字符串的表。

有很好的查询... \^.^/

* * *

## 回答 #11

> 赞同：6
> 
> 时间：2012-02-02T10:46:29.413

这是我的解决方案

```
DROP PROCEDURE IF EXISTS findAll;
CREATE PROCEDURE `findAll`( IN `tableName` VARCHAR( 28 ) , IN `search` TEXT )
BEGIN
       DECLARE finished INT DEFAULT FALSE ;
       DECLARE columnName VARCHAR ( 28 ) ;
       DECLARE stmtFields TEXT ;
       DECLARE columnNames CURSOR FOR
              SELECT DISTINCT `COLUMN_NAME` FROM `information_schema`.`COLUMNS`
              WHERE `TABLE_NAME` = tableName ORDER BY `ORDINAL_POSITION` ;
       DECLARE CONTINUE HANDLER FOR NOT FOUND SET finished = TRUE;
       SET stmtFields = '' ;
       OPEN columnNames ;
       readColumns: LOOP
              FETCH columnNames INTO columnName ;
              IF finished THEN
                     LEAVE readColumns ;
              END IF;
              SET stmtFields = CONCAT(
                     stmtFields , IF ( LENGTH( stmtFields ) > 0 , ' OR' , ''  ) ,
                     ' `', tableName ,'`.`' , columnName , '` REGEXP "' , search , '"'
              ) ;
       END LOOP;
       SET @stmtQuery := CONCAT ( 'SELECT * FROM `' , tableName , '` WHERE ' , stmtFields ) ;
       PREPARE stmt FROM @stmtQuery ;
       EXECUTE stmt ;
       CLOSE columnNames ;
END; 
```

* * *

## 回答 #12

> 赞同：6
> 
> 时间：2016-08-21T21:38:03.997

虽然这个问题很老，但如果您使用的是 mysql workbench 6.3，这里是如何做到的。（很可能它也适用于其他版本）

右键单击您的架构和“搜索表数据”，输入您的值并点击“开始搜索”。就是这样。

* * *

## 回答 #13

> 赞同：5
> 
> 时间：2016-02-13T06:36:55.557

我正在使用 HeidiSQL 是一个有用且可靠的工具，专为使用流行 MySQL 服务器的 Web 开发人员而设计。

在 HeidiSQL 中，您可以按 shift + ctrl + f 并且可以在服务器上的所有表中找到文本。这个选项非常有用。

* * *

## 回答 #14

> 赞同：4
> 
> 时间：2020-07-30T12:56:05.150

**MySQL 工作台**

这里有一些说明。

下载并安装 MSQL 工作台。

[https://www.mysql.com/products/workbench/](https://www.mysql.com/products/workbench/)

安装时，可能需要您安装 Visual Studio C++ Redistributable。你可以在这里得到它：

[https://support.microsoft.com/en-us/help/2977003/the-latest-supported-visual-c-downloads](https://support.microsoft.com/en-us/help/2977003/the-latest-supported-visual-c-downloads)

x64：vc_redist.x64.exe（适用于 64 位 Windows）

打开 MySQL Workbench 时，您必须输入主机名、用户名和密码。

侧面菜单栏上有一个 Schemas 选项卡，单击 Schemas 选项卡，然后双击数据库以选择要搜索的数据库。

然后转到菜单数据库 - 搜索数据，并输入您要搜索的文本，单击开始搜索。

[![在此处输入图像描述](https://i.stack.imgur.com/fl08q.png)](https://i.stack.imgur.com/fl08q.png)

**HeidiSql**

下载安装HeidiSql [https://www.heidisql.com/download.php](https://www.heidisql.com/download.php)

输入您的主机名、用户名和密码。

按 Ctrl+Shift+F 搜索文本。

[![在此处输入图像描述](https://i.stack.imgur.com/AgYId.png)](https://i.stack.imgur.com/AgYId.png)

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2009-03-12T17:01:13.433

你可以使用

```
SHOW TABLES; 
```

然后获取这些表中的列（循环）

```
SHOW COLUMNS FROM table; 
```

然后使用该信息创建许多查询，如果需要，您也可以 UNION。

但这对数据库来说非常沉重。特别是如果您正在进行 LIKE 搜索。

* * *

## 回答 #16

> 赞同：3
> 
> 时间：2014-01-29T17:59:29.433

这个解决方案
a) 只有 MySQL，不需要其他语言，
b) 返回 SQL 结果，准备好处理！

```
#Search multiple database tables and/or columns
#Version 0.1 - JK 2014-01
#USAGE: 1\. set the search term @search, 2\. set the scope by adapting the WHERE clause of the `information_schema`.`columns` query
#NOTE: This is a usage example and might be advanced by setting the scope through a variable, putting it all in a function, and so on...

#define the search term here (using rules for the LIKE command, e.g % as a wildcard)
SET @search = '%needle%';

#settings
SET SESSION group_concat_max_len := @@max_allowed_packet;

#ini variable
SET @sql = NULL;

#query for prepared statement
SELECT
    GROUP_CONCAT("SELECT '",`TABLE_NAME`,"' AS `table`, '",`COLUMN_NAME`,"' AS `column`, `",`COLUMN_NAME`,"` AS `value` FROM `",TABLE_NAME,"` WHERE `",COLUMN_NAME,"` LIKE '",@search,"'" SEPARATOR "\nUNION\n") AS col
INTO @sql
FROM `information_schema`.`columns`
WHERE TABLE_NAME IN
(
    SELECT TABLE_NAME FROM `information_schema`.`columns`
    WHERE
        TABLE_SCHEMA IN ("my_database")
        && TABLE_NAME IN ("my_table1", "my_table2") || TABLE_NAME LIKE "my_prefix_%"
);

#prepare and execute the statement
PREPARE stmt FROM @sql;
EXECUTE stmt;
DEALLOCATE PREPARE stmt; 
```

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2015-12-17T21:27:28.747

我将 Olivier 的 PHP 答案修改为：

*   打印出找到字符串的结果
*   省略没有结果的表格
*   如果列名与搜索输入匹配，也会显示输出
*   显示结果总数

    ```
    function searchAllDB($search){
        global $mysqli;

        $out = "";
        $total = 0;
        $sql = "SHOW TABLES";
        $rs = $mysqli->query($sql);
        if($rs->num_rows > 0){
            while($r = $rs->fetch_array()){
                $table = $r[0];
                $sql_search = "select * from ".$table." where ";
                $sql_search_fields = Array();
                $sql2 = "SHOW COLUMNS FROM ".$table;
                $rs2 = $mysqli->query($sql2);
                if($rs2->num_rows > 0){
                    while($r2 = $rs2->fetch_array()){
                        $colum = $r2[0];
                        $sql_search_fields[] = $colum." like('%".$search."%')";
                        if(strpos($colum,$search))
                        {
                            echo "FIELD NAME: ".$colum."\n";
                        }
                    }
                    $rs2->close();
                }
                $sql_search .= implode(" OR ", $sql_search_fields);
                $rs3 = $mysqli->query($sql_search);
                if($rs3 && $rs3->num_rows > 0)
                {
                    $out .= $table.": ".$rs3->num_rows."\n";
                    if($rs3->num_rows > 0){
                        $total += $rs3->num_rows;
                        $out.= print_r($rs3->fetch_all(),1);
                        $rs3->close();
                    }
                }
            }
            $out .= "\n\nTotal results:".$total;
            $rs->close();
        }
        return $out;
    } 
    ```

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2018-08-10T10:08:14.743

我建立在先前的答案上，并有这个，一些额外的填充只是为了能够方便地加入所有输出：

```
SELECT 
CONCAT('SELECT ''',A.TABLE_NAME, '-' ,A.COLUMN_NAME,''' FROM ', A.TABLE_SCHEMA, '.', A.TABLE_NAME, 
       ' WHERE ', A.COLUMN_NAME, ' LIKE \'%Value%\' UNION')
FROM INFORMATION_SCHEMA.COLUMNS A
WHERE 
        A.TABLE_SCHEMA != 'mysql' 
AND     A.TABLE_SCHEMA != 'innodb' 
AND     A.TABLE_SCHEMA != 'performance_schema' 
AND     A.TABLE_SCHEMA != 'information_schema'
UNION SELECT 'SELECT '''

-- for exact match use: A.COLUMN_NAME, ' LIKE \'Value\' instead 
```

首先运行它，然后粘贴并运行结果（无需编辑），它将显示使用该值的所有表名和列。

* * *

## 回答 #19

> 赞同：2
> 
> 时间：2020-11-04T17:42:18.303

即使以下建议不应被视为最终解决方案，您也可以通过执行以下操作来实现目标：

```
SET SESSION group_concat_max_len = 1000000;
SET @search = 'Text_To_Search';

DROP table IF EXISTS table1;
CREATE TEMPORARY TABLE table1 AS 
(SELECT 
    CONCAT('SELECT \'',TABLE_NAME,'\' as \'table_name\',\'',COLUMN_NAME,'\' as \'column_name\',CONVERT(count(*),char) as \'matches\' FROM `',
    TABLE_NAME,'` where `',COLUMN_NAME,'` like \'%',@search,'%\' UNION ') as 'query'
FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_SCHEMA = 'db_name' limit 1000000);

set @query = (SELECT GROUP_CONCAT(t1.`query` SEPARATOR '') as 'final_query' from table1 t1 limit 1);
set @query = (SELECT SUBSTRING(@query, 1, length(@query) - 7));

PREPARE stmt FROM @query;
EXECUTE stmt;
DEALLOCATE PREPARE stmt; 
```

请记住：

1.  选项：**group_concat_max_len**和**limit 1000000**并不总是需要，这取决于您的服务器/IDE 配置。以防万一我添加了它们。

2.  执行此操作后，您将获得 3 列响应：[table_name]、[column_name]、[matches]

3.  列“匹配”是给定表/列中出现的次数。

4.  这个查询非常快。

免责声明：它仅对个人使用有用，换句话说，请不要在生产系统中使用它，因为考虑到搜索参数与其他字符串连接，它对 SQL 注入攻击很敏感。如果你想创建一个产品。ready 函数，那么您将需要使用 LOOP 创建一个存储过程。

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2018-08-11T22:15:18.893

我得到了这个工作。你只需要改变变量

```
$query ="SELECT `column_name` FROM `information_schema`.`columns` WHERE `table_schema`='" . $_SESSION['db'] . "' AND `table_name`='" . $table . "' ";
$stmt = $dbh->prepare($query);
$stmt->execute(); 
$columns = $stmt->fetchAll(PDO::FETCH_ASSOC);       

$query="SELECT name FROM `" . $database . "`.`" . $table . "` WHERE ( ";
foreach ( $columns as $column ) {
    $query .=" CONVERT( `" . $column['column_name'] . "` USING utf8 ) LIKE '%" . $search . "%' OR ";
}
$query = substr($query, 0, -3);
$query .= ")";

echo $query . "<br>";
$stmt=$dbh->prepare($query);
$stmt->execute();
$results = $stmt->fetchAll(PDO::FETCH_ASSOC);
echo "<pre>";
print_r ($results );
echo "</pre>"; 
```

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2019-05-27T03:36:59.190

我已经使用 HeidiSQL 完成了这项工作。它不容易找到，但按 Ctrl+Shift+F 会显示“表格工具”对话框。然后选择您要搜索的内容（完整数据库到单个表）并输入“要查找的文本”值并单击“查找”。我发现它出奇的快（不到一分钟就达到了 870MiB db）

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2021-07-30T05:02:54.027

要在数据库中的所有表中搜索字符串，请在 CLI 上运行以下命令。

```
mysqldump -u UserName --no-create-info --extended-insert=FALSE DBName -p | grep -i "searchingString" 
```

或者，

```
mysqldump -u UserName --no-create-info --extended-insert=FALSE DBName -p | grep -i "searchingString" > searchingString.sql 
```

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2016-08-01T14:35:00.240

我使用 Union 将查询串在一起。不知道这是否是最有效的方法，但它有效。

```
SELECT * FROM table1 WHERE name LIKE '%Bob%' Union
SELCET * FROM table2 WHERE name LIKE '%Bob%'; 
```

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2017-10-25T07:56:01.650

有一个不错的图书馆可以阅读所有表格，[ridona](https://github.com/hosseinmousavi/ridona)

```
$database = new ridona\Database('mysql:dbname=database_name;host=127.0.0.1', 'db_user','db_pass');

foreach ($database->tables()->by_entire() as $row) {

....do

} 
```

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2017-12-11T20:58:09.480

我不知道这是否仅在最近的版本中，但是右键单击窗格`Tables`中的选项会`Navigator`弹出一个名为`Search Table Data`. 这将打开一个搜索框，您可以在其中填写搜索字符串并点击搜索。

您确实需要在左侧窗格中选择要搜索的表。但是，如果您按住 shift 并一次选择 10 个表，MySql 可以处理并在几秒钟内返回结果。

对于任何正在寻找更好选择的人！:)

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2020-08-12T10:22:29.023

如果 23 个答案还不够，这里还有 2 个……根据数据库结构和内容，您可能会发现其中一个实际上是一种快速而简单的解决方案。

对于shell one-liners的粉丝，这里有一个很长的（实际上在2行上使用变量）：

```
cmd='mysql -u Username -pYour_Password -D Your_Database' # <-- Adapt this

$cmd -s -e 'SHOW TABLES' | while read table; do echo "=== $table ==="; $cmd -B -s -e "SELECT * FROM $table" | grep 'Your_Search'; done 
```

或在多行上使其更具可读性：

```
$cmd -s -e 'SHOW TABLES' \
| while read table; do
    echo "=== $table ===";
    $cmd -B -s -e "SELECT * FROM $table" \
    | grep 'Your_Search';
  done 
```

*   `-s`( `--silent`) 是抑制列名标题

*   `-B`( `--batch`) 转义了像换行符这样的特殊字符，所以我们在使用时得到了整个记录`grep`

对于 Perl 爱好者，这将让您使用正则表达式：

```
# perl -MDBI -le '($db,$u,$p)=@ARGV; $dbh=DBI->connect("dbi:mysql:dbname=$db",$u,$p); foreach $table ($dbh->tables()) {print "$table\n"; foreach $r ($dbh->selectall_array("SELECT * FROM $table")) {$_=join("\t", @$r); print $_ if (/Your_Regex/);}}' Your_Database Username Your_Password 
```

在“真正的”Perl 脚本中可能是这样的：

```
#!/usr/bin/perl

use strict;
use open qw(:std :utf8);

use DBI;

my $db_host  = 'localhost';
my $db       = 'Your_Database';
my $db_user  = 'Username';
my $db_pass  = 'Your_Password';

my $search    = qr/Your_regex_Search/;

# https://metacpan.org/pod/DBD::mysql
my $dbh = DBI->connect( "dbi:mysql:dbname=$db;host=$db_host", $db_user, $db_pass,
                        { mysql_enable_utf8mb4 => 1 }
) or die "Can't connect: $DBI::errstr\n";

foreach my $table ( $dbh->tables() ) {
    my $sth = $dbh->prepare("SELECT * FROM $table")
        or die "Can't prepare: ", $dbh->errstr;

    $sth->execute
        or die "Can't execute: ", $sth->errstr;

    my @results;

    while (my @row = $sth->fetchrow()) {
        local $_ = join("\t", @row);
        if ( /$search/ ) {
            push @results, $_;
        }
    }

    $sth->finish;

    next unless @results;

    print "*** TABLE $table :\n",
          join("\n---------------\n", @results),
          "\n" . "=" x 20 . "\n";
}

$dbh->disconnect; 
```

# c# - 如何在按下按钮时关闭弹出窗口并在打开弹出窗口的窗口上启动回发？

> ID：639533
> 
> 赞同：1
> 
> 时间：2009-03-12T16:58:11.303
> 
> 标签：c#, asp.net, javascript

往上看...

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-12T17:06:02.593

您应该能够调用 window.parent 中的函数。

```
<script type="text/javascript">
    function closeThisPopupWindow()
    {
        if (window.parent && window.parent.callBack)
            window.parent.callBack();
        window.close();
    }
</script> 
```

显然，您需要将 closeThisPopupWindow 函数附加到您的按钮。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-12T17:03:40.527

尝试这样的事情：

```
parent.document.getElementById('btnSubmit').click();; // submit the parent form
self.close(); // close the current window 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-12T17:09:18.080

我会在弹出窗口的按钮单击中做类似的事情

```
ClientScript.RegisterStartupScript(typeof(string), "auto_refreshparent", @" window.opener.location.reload(); ", true);
ClientScript.RegisterStartupScript(typeof(Page), "ThatsAllFolks", "window.close();", true); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-11-05T18:58:58.320

string windowArgs = "工具栏=no,menubar=no,location=no,width=620,height=500,scrollbars=yes,resizable=yes,modal=yes"; 字符串 newWindowUrl = "MarketShotPreview.aspx"; 字符串 javaScript = "\n" + "\n" + "\n"; ClientScript.RegisterStartupScript(typeof(System.Web.UI.Page), "Popup", javaScript);

# windows - 在 64 位操作系统上，32 位进程可以访问多少内存？

> ID：639540
> 
> 赞同：90
> 
> 时间：2009-03-12T17:00:38.287
> 
> 标签：windows, memory, wow64

在 Windows 上，在正常情况下，32 位进程只能访问 2GB 的 RAM（或 3GB，在 boot.ini 文件中使用特殊开关）。在 64 位操作系统上运行 32 位进程时，有多少可用内存？是否有任何特殊的开关或设置可以改变这一点？

* * *

## 回答 #1

> 赞同：95
> 
> 时间：2009-03-12T17:04:38.260

默认为 2 GB。如果应用程序支持大地址空间（与 /LARGEADDRESSAWARE 链接），它会获得 4 GB（不是 3 GB，请参阅[http://msdn.microsoft.com/en-us/library/aa366778.aspx](http://msdn.microsoft.com/en-us/library/aa366778.aspx)）

它们仍然限制为 2 GB，因为许多应用程序依赖于指针的最高位为零。

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2009-03-12T17:03:37.407

如果您与 /LARGEADDRESSAWARE 链接，则 4 GB 减去系统正在使用的内存。

[当然，如果你设置了那个标志，你应该更加小心指针算术。](https://devblogs.microsoft.com/oldnewthing/20040812-00/?p=38183)

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2013-01-22T22:09:43.563

似乎没有人提到这样一个事实，即如果你有许多不同的 32 位应用程序，wow64 子系统可以将它们映射到 4G 以上内存中的任何位置，因此在具有足够内存的 64 位窗口上，你可以运行更多的 32 位应用程序比在本机 32 位系统上。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-03-12T17:04:11.913

32 位进程仍然受限于 64 位操作系统中的相同约束。问题是内存指针只有 32 位宽，因此程序无法分配/解析任何大于 32 位的内存地址。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2017-07-01T17:05:21.157

64 位操作系统下的单个 32 位进程限制为 2Gb。但是，如果将其编译为`IMAGE_FILE_LARGE_ADDRESS_AWARE`设置了位的 EXE 文件，则它的限制为 4 GB，而不是 2Gb - 请参阅[https://msdn.microsoft.com/en-us/library/aa366778(VS.85).aspx](https://msdn.microsoft.com/en-us/library/aa366778(VS.85).aspx)

你听到的关于特殊引导标志、3 GB、`/3GB`开关的事情，或者`/userva`都是关于 32 位操作系统的，不适用于 64 位 Windows。

有关详细信息，请参阅[https://msdn.microsoft.com/en-us/library/aa366778(v=vs.85).aspx 。](https://msdn.microsoft.com/en-us/library/aa366778(v=vs.85).aspx)

至于 32 位操作系统，出乎意料的是，32 位操作系统没有 4GB 的物理限制。例如，32 位服务器操作系统（如 Microsoft Windows Server 2008 32 位）最多可以访问**64 GB**（Windows Server 2008 企业版和数据中心版）——通过物理地址扩展 (PAE)，它首先由 Intel 在 Pentium Pro 中引入，后来由 AMD 在 Athlon 处理器中引入——它定义了三个级别的页表层次结构，每个表条目是 64 位而不是 32 位，允许这些 CPU 直接访问大于 4 GB 的物理地址空间——因此理论上，32 位操作系统理论上可以访问 2^64 字节，即 17,179,869,184 GB，但该段是受限于 4GB。但是，由于营销原因，Microsoft 将非服务器操作系统上的最大可访问内存限制为仅 4GB，甚至有效的 3GB。因此，在 32 位操作系统上，单个进程可以访问超过 4GB 的空间——Microsoft SQL Server 就是一个例子。

*在使用共享内核的虚拟地址空间（也称为系统空间*）方面，64 位 Windows 下的 32 位进程与 64 位进程相比没有任何劣势。64 位 Windows 下的所有进程，无论是 64 位还是 32 位，都共享相同的 64 位系统空间。

鉴于[系统空间由所有进程共享](https://docs.microsoft.com/en-us/windows-hardware/drivers/gettingstarted/virtual-address-spaces)，在**32 位 Windows**上，创建大量句柄（如线程、信号量、文件等）的进程[会消耗内核对象的系统空间，](https://docs.microsoft.com/en-us/windows/win32/sysinfo/kernel-objects)甚至可能耗尽内存如果您总共有很多可用内存。相比之下，在**64 位 Windows**上，内核空间是 64 位的，不受 4 GB 的限制。32 位应用程序进行的所有系统调用都[在用户模式下转换为本机 64 位调用](https://docs.microsoft.com/en-us/windows/win32/winprog64/wow64-implementation-details)。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-03-12T17:03:45.300

在 Win64 下运行 32 位进程时，您有相同的基本限制。您的应用程序在 32 但子系统中运行，该子系统尽力看起来像 Win32，这将包括您的进程的内存限制（您的内存限制为 2GB，操作系统为 2GB）

* * *

## 回答 #7

> 赞同：-12
> 
> 时间：2012-05-14T12:27:41.517

限制不是 2g 或 3gb，32 位是 4gb。

人们认为它的 3gb 的原因是操作系统显示 3gb 空闲时他们真的有 4gb 的系统内存。

它的总内存为 4GB。因此，如果您有一个 1 GB 的视频卡，它算作 32 位操作系统查看的总内存的一部分。

4Gig 不是 3 不是 2 明白了吗？

# open-source - 是否有经过业务验证的云存储/Key=>Value 数据库？（开源）

> ID：639545
> 
> 赞同：35
> 
> 时间：2009-03-12T17:01:57.190
> 
> 标签：open-source, amazon-ec2, cloud, key-value

我一直在寻找云计算/存储解决方案（灵感来自 Google Bigtable）。但我找不到一个易于使用、业务就绪的解决方案。

我正在搜索一个简单的、容错的、分布式的 Key=>Value DB，比如来自 Amazon 的 SimpleDB。

我见过这样的事情：

1.  [CouchDB 项目](http://couchdb.apache.org/index.html)：简单的分布式容错数据库。但它只理解 JSON。没有 XML 连接器等。
2.  [Eucalyptus](http://eucalyptus.cs.ucsb.edu/)：不错的 Amazon EC2 接口。开放标准和 XML。但是分布式更少，容错性更差？还有很多 XEN/VMWare 问题的未解决问题。
3.  [Cloudstore / Kosmosfs](http://kosmosfs.sourceforge.net/index.html)：很好的分布式、容错 fs。但是很难配置。有没有java连接器？
4.  [Apache Hadoop](http://hadoop.apache.org/)：很好的系统，比存储数据的能力要强得多。使用自己的 Hadoop 分布式文件系统，并已在 2000 个节点的集群上进行测试。
5.  * [Amazon SimpleDB](http://aws.amazon.com/simpledb/)：找不到开源替代品！对于海量数据来说，这是一个不错但昂贵的系统。你沉迷于亚马逊。

还有其他更好的解决方案吗？哪一个是最好的选择？哪一个提供最少的 SOF（单点故障）？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-03-21T21:24:43.487

[内存缓存](http://www.danga.com/memcached/)怎么样？

高[可扩展性](http://highscalability.com/tags/key-value-store)博客涵盖了这个问题；如果有你所追求的开源解决方案，它肯定会在那里。

其他项目包括：

*   [伏地魔计划](http://project-voldemort.com/)
*   [Lightcloud - 键值数据库](http://highscalability.com/product-lightcloud-key-value-database)
*   Ringo -[不可变数据的分布式键值存储](http://highscalability.com/ringo-distributed-key-value-storage-immutable-data)

另一个不错的列表：[Anti-RDBMS：分布式键值存储列表](http://www.metabrew.com/article/anti-rdbms-a-list-of-distributed-key-value-stores/)

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-04-06T07:25:28.217

[MongoDB](http://www.mongodb.org)是另一个与 CouchDB 非常相似的选项，但使用与 SQL 非常相似的查询语言而不是 JavaScript 中的 map/reduce。它还支持二进制数据的索引、查询分析、复制和存储。

它有大量的文档，一开始可能会让人不知所措，所以我建议从[开发者之旅开始](http://www.mongodb.org/display/DOCS/MongoDB+-+A+Developer%27s+Tour)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-21T16:20:41.343

维基百科说，雅虎[既为 Hadoop 做出了贡献，又在生产中使用它](http://en.wikipedia.org/wiki/Hadoop)（[文章链接自维基百科](http://developer.yahoo.net/blogs/hadoop/2008/02/yahoo-worlds-largest-production-hadoop.html)）。所以我会说它对业务证明很重要，尽管我不确定它是否算作 K/V 值数据库。

[使用MySQL 作为简单的无模式键/值存储](http://bret.appspot.com/entry/how-friendfeed-uses-mysql)的 Friendfeed 系统不在您的列表中。

我很难理解你的优先事项。CouchDB 简单、容错且分布式，但不知何故您将它排除在外，因为它没有 XML。XML 和 Java 连接器是未说明的要求吗？

（无论如何，CouchDB 实际上应该被排除在外，因为它还很年轻，它的 API 不稳定，而且它不是键值存储。）

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-03-22T02:08:58.683

我使用 Google 的[Google Base](http://code.google.com/apis/base/) api，它是 Xml、免费、文档化、基于云的，并且具有多种语言的连接器。如果您也想要免费托管，我认为它会满足您的需求。

现在，如果您想托管自己的服务器，[东京机柜](http://tokyocabinet.sourceforge.net/spex-en.html)就是您的答案，它基于 key=>value，使用平面文件，并且是目前最快的数据库（与 Oracle 相比非常准系统，但非常擅长存储和访问数据，大约每秒 100 万条记录，大约 10 字节的开销（取决于存储引擎）。至于业务就绪，TokyoCabinet 是一项名为 Mixi 的服务的核心，它相当于日本的 Facebook+MyPage，拥有数百万重度用户，因此它实际上是经过实战证明的。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-03-27T21:58:09.410

如果你想要 Bigtable 之类的东西，你不能超越[HBase](http://hadoop.apache.org/hbase/)或[Hypertable——](http://hypertable.org/)它们都是开源的 Bigtable 克隆。不过，要考虑的一件事是，您的要求是否真的对 Bigtable 来说“足够大”。它可以扩展到数千台平板服务器，因此，它下面有相当多的基础设施来实现这一点（例如，处理常规节点故障的预期）。

如果您预计至少不会增长到数十台平板电脑服务器，您可能需要考虑其中一种建议的替代方案：您不能因为简单而击败 BerkelyDb，或者因为无处不在而击败 MySQL。如果您只需要一个键/值数据存储，您可以在您的数据库接口周围放置一个简单的“dict”包装器，如果您的后端超出了一个，则可以关闭您的后端。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-03-23T17:29:14.207

您可能想查看仿照 google 的 bigtable 的[hypertable 。](http://hypertable.org/)

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-03-28T02:06:27.753

使用 CouchDB

*   JSON有什么问题？
*   JSON 到 XML 很简单

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-03-12T17:05:52.970

您可能想看看这个（使用 MySQL 作为键值存储）：

[http://bret.appspot.com/entry/how-friendfeed-uses-mysql](http://bret.appspot.com/entry/how-friendfeed-uses-mysql)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-21T21:17:32.270

[Cloudera](http://www.cloudera.com/)是一家将 Apache Hadoop 商业化的公司，当然还有一些附加值，比如产品化、配置、培训和支持服务。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-03-23T18:04:54.197

而不是寻找*受 Google 的 bigtable 启发的*东西——为什么不直接使用 bigtable 呢？您可以在 Google App-Engine 上编写前端。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-11-28T05:35:32.420

为您的问题精心汇编的存储工具：

[http://www.metabrew.com/article/anti-rdbms-a-list-of-distributed-key-value-stores/](http://www.metabrew.com/article/anti-rdbms-a-list-of-distributed-key-value-stores/)

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-11-28T12:05:53.283

[Tokyo Cabinet](http://1978th.net/tokyocabinet/)也受到了一些关注，因为它支持表模式、键值对和哈希表。它使用 Lua 作为嵌入式脚本平台，并使用 HTTP 作为其通信协议。这是一个[很好的演示](http://www.infoq.com/presentations/grigorik-tokyo-cabinet-recipes)。

# firefox - 是否有清除缓存的 Firefox 键盘快捷键？

> ID：639547
> 
> 赞同：53
> 
> 时间：2009-03-12T17:02:29.700
> 
> 标签：firefox, vimperator

使用 Firefox Web 开发人员工具栏，我可以选择“杂项 → 清除私人数据 → 缓存”。有没有办法用键盘快捷键做同样的事情？

*编辑：*我也在使用 vimperator 用键盘驱动 Firefox；刚刚发现可以使用：`:emenu Extra.Web Developer.Miscellaneous.Clear Private Data.Cache`.

* * *

## 回答 #1

> 赞同：66
> 
> 时间：2009-03-12T17:06:01.363

我认为`Ctrl`++`Shift`取出`Delete`所有私人数据，包括缓存。[这是一个链接，它将告诉您如何设置特定选项。](http://kaioa.com/node/82)

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2009-03-19T16:50:31.290

您还可以使用以下**命令重新加载和清除**某个页面的缓存

`Cmd`+ `Shift`+`R`

在 Mac 上，或

`Ctrl`+`F5`

在 Windows/Linux 机器上。

（这些是对*普通*重新加载快捷方式`Cmd`+ `R`/的补充`F5`）

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-12T17:26:45.913

我使用 web 开发者插件来完全禁用我的开发机器上的缓存。这样您就不必担心清除缓存。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2011-04-12T13:03:50.690

在 Firefox 中是

`CTRL`+ `SHIFT`+`R`

[来源](http://support.mozilla.com/en-US/kb/Keyboard%20shortcuts)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-12T17:07:10.533

我猜

`Ctrl`+ `Shift`+`Delete`

是不是你想要的？

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2012-09-04T23:40:33.870

对于 Mac OSX 它是

`Command`+ `Shift`+`Delete`

适用于所有浏览器（Safari 除外）

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-08-19T15:11:12.560

你可以试试这个组合：

`ctrl`+`F5`

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-07-05T23:41:50.070

我要做的是去

```
Tools > Options > Privacy > Show Cookies 
```

然后保持`Show Cookie`s窗口打开。

它在您的网页上保持最小化，因此您只需点击

```
Maximize > Remove All cookies 
```

# cakephp - 在 CakePHP 中创建全局变量的最佳方法是什么？

> ID：639564
> 
> 赞同：22
> 
> 时间：2009-03-12T17:05:15.937
> 
> 标签：cakephp

我想在 CakePHP 中创建一个全局变量。如果我在我的 app_controller.php 中定义了一些东西，比如

```
var $varName 
```

我可以访问

```
$this->varName 
```

从我的任何控制器，但我无法从模型中得到它。

如何创建可从模型访问的全局变量？

$varName 的值直到运行时才知道，所以我不认为 bootstrap.php 是一个选项。

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2009-03-12T17:27:45.787

> CakePHP 的新[配置类](http://book.cakephp.org/2.0/en/development/configuration.html#configure-class)可用于存储和检索应用程序或运行时特定的值。请注意，此类允许您在其中存储任何内容，然后在代码的任何其他部分中使用它

* * *

## 回答 #2

> 赞同：30
> 
> 时间：2010-12-17T14:05:27.943

要保存全局变量，请使用配置类。例如：

> 配置::write('Company.name','Pizza, Inc.');

要稍后在代码的任何位置读取变量，请使用：

> 配置::read('Company.name'); //产量：'Pizza, Inc.'

存储全局常量的推荐文件位于**app/config/bootstrap.php**

有关更多信息，请参阅：
配置类 - [配置 CakePhp 类](http://book.cakephp.org/2.0/en/development/configuration.html#configure-class)。或关于引导的第 3.4.7 节

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2014-01-18T13:55:29.157

你可以在 app/cofig/core.php 中声明全局变量

```
Configure::write('variable Name','Variable Value'); 
```

你可以这样打印：

```
Configure::read('Variable Name'); 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-13T21:26:00.277

应用程序的全局函数和变量可以在 app/config/bootstrap.php 中定义

有关更多信息，请参阅[http://book.cakephp.org/view/48/Bootstrapping-CakePHP](http://book.cakephp.org/view/48/Bootstrapping-CakePHP)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2013-06-20T18:10:49.613

您可以在 app/config/ 目录中的 bootstrap.php 中定义常量。它可以全局用于任何控制器或视图。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2017-12-28T16:10:15.890

您可以尝试使用 bootstrap.php 定义常量（蛋糕 3）

> 该文件非常适合许多常见的引导任务：
> 
> 定义便利功能。
> 
> 声明常量。
> 
> 定义缓存配置。
> 
> 定义日志记录配置。
> 
> 加载自定义变形。
> 
> 加载配置文件。

参考[https://book.cakephp.org/3.0/en/development/configuration.html#bootstrapping-cakephp](https://book.cakephp.org/3.0/en/development/configuration.html#bootstrapping-cakephp)

* * *

## 回答 #7

> 赞同：-2
> 
> 时间：2009-03-12T17:37:34.720

其实，你为什么要这么做？模型不应该知道控制器的存在。

如果它是一个业务（模型）对象，就这样创建它。如果不是，模型不应该知道它。

# javascript - 预加载 img 元素

> ID：639573
> 
> 赞同：2
> 
> 时间：2009-03-12T17:06:35.340
> 
> 标签：javascript

我目前有一个预加载图像 javascript 脚本：

```
function MM_preloadImages() { 
  var d = document; 

  if(d.images){ 
     if(!d.MM_p )
        d.MM_p=new Array();

     var i,j=d.MM_p.length,a=MM_preloadImages.arguments;

     for(i=0; i<a.length; i++){
        if (a[i].indexOf("#")!=0){
           d.MM_p[j]=new Image; 
           d.MM_p[j++].src= '/img' + a[i];
        }
     }
  }
} 
```

问题是我必须在添加图像时手动更新数组删除等。

无论如何都可以自动化这个或者是否有一个库。

大多数图像 url 都是元素 href。

显然我可以在服务器端写一些东西，但我想检查那里是否已经有东西了。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-12T17:09:27.203

[这是一个用jQuery](http://jquery.com/)做你想做的事情的人：

[http://www.filamentgroup.com/lab/update_automatically_preload_images_from_css_with_jquery/](http://www.filamentgroup.com/lab/update_automatically_preload_images_from_css_with_jquery/)

**编辑：**实际上这并不是您要寻找的，因为它会从 CSS 文件中预加载图像 - 我将把它留在这里以防它仍然有用。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-12T17:19:57.537

问题是当元素在 DOM 中可供 JS 检查图像时，无论如何都已经加载了。

AFAIK 没有办法做到这一点（基于 CSS 的检查工作，因为它是在正文内容之前加载的），但一般来说，解决这个问题的一个更好的解决方案是[CSS spriting](http://css-tricks.com/css-sprites-what-they-are-why-theyre-cool-and-how-to-use-them/)。

# entity-framework - 我做错了什么得到“具有不同键的两个实体映射到同一行

> ID：639585
> 
> 赞同：0
> 
> 时间：2009-03-12T17:13:41.983
> 
> 标签：entity-framework

见图片：

[EF 设计器](http://dl.getdropbox.com/u/681837/EFProblem.png)

[SQL 表](http://dl.getdropbox.com/u/681837/EFProblem-sql.png)

“具有不同键的两个实体映射到同一行。确保这两个映射片段不会将具有重叠键的两组实体映射到同一组行。”

事实上，只有两个（或这里是 6 个）实体中的一个具有单行的键。

我该如何克服这一点？将它们全部组合到一行的 SQL 视图？ContactMethod中计算的鉴别器列？我应该如何设计不同的表格以更好地与 EF 配合使用？

还是我可以做一些 XML 编辑来保留我的架构，并告诉 EF 相信我，我永远不会将相同的 Id 放在一个以上的派生类中？

这是：[edmx](http://dl.getdropbox.com/u/681837/Model.edmx.xml)，如果有帮助的话。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-09-21T06:29:01.350

edmx 文件的链接无效。也许，你必须添加一个条件标签

```
<Condition ColumnName="ContactId" IsNull="false" /> 
```

使用 xml-editor 到您的 edmx 文件：

```
<AssociationSetMapping Name="FK_Contact_ContactMethod" TypeName="SomeNamespace.FK_Contact_ContactMethod" StoreEntitySet="ContactMethod">
  <EndProperty Name="ContactMethod">
    <ScalarProperty Name="ContactMethodId" ColumnName="ContactMethodId" />
  </EndProperty>
  <EndProperty Name="Contact">
    <ScalarProperty Name="ContactId" ColumnName="ContactId" />
  </EndProperty>
  <Condition ColumnName="ContactId" IsNull="false" />
</AssociationSetMapping> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-12T19:16:53.047

删除数据库中 ContactMethod 的外键可以消除错误，但似乎不正确。

# java - 为什么接口优先于抽象类？

> ID：639592
> 
> 赞同：37
> 
> 时间：2009-03-12T17:15:23.663
> 
> 标签：java, oop, interface, abstraction

我最近参加了一次采访，他们问我一个问题“为什么接口比抽象类更受欢迎？”

我尝试给出一些答案，例如：

*   我们只能得到一个扩展功能
*   它们是 100% 抽象的
*   实现不是硬编码的

他们要求我采用您使用的任何 JDBC api。“为什么它们是接口？”。

我可以得到更好的答案吗？

* * *

## 回答 #1

> 赞同：55
> 
> 时间：2009-03-12T17:30:37.280

该采访问题反映了提问者的某种信念。我相信这个人是错的，因此你可以选择两个方向之一。

1.  给他们想要的答案。
2.  表示不同意。

他们想要的答案，嗯，其他海报已经非常好地突出了这些。多重接口继承，继承迫使类做出实现选择，接口可以更容易地改变。

但是，如果您在分歧中提出令人信服（且正确）的论点，那么面试官可能会注意到这一点。首先，突出接口的积极方面，这是必须的。其次，我会说接口在许多场景中更好，但它们也会导致代码重复，这是一个负面的事情。如果您有大量的子类，它们将执行基本相同的实现，加上额外的功能，那么您可能需要一个抽象类。它允许您拥有许多具有细粒度细节的相似对象，而仅使用接口，您必须拥有许多具有几乎重复代码的不同对象。

接口有很多用途，有一个令人信服的理由相信它们“更好”。但是，您应该始终使用正确的工具来完成这项工作，这意味着您不能注销抽象类。

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2009-03-12T17:45:27.260

总的来说，这绝不是一个应该盲目遵循的“规则”，最灵活的安排是：

```
interface
   abstract class
       concrete class 1       
       concrete class 2 
```

该界面的存在有几个原因：

*   已经扩展了某些东西的现有类可以实现接口（假设您可以控制现有类的代码）
*   现有类可以是子类，子类可以实现接口（假设现有类是可子类化的）

这意味着您可以采用预先存在的类（或者只是必须从其他东西扩展的类）并让它们与您的代码一起使用。

抽象类为具体类提供所有公共位。抽象类是在您编写新类或修改要扩展它的类时扩展的（假设它们是从 java.lang.Object 扩展的）。

您应该始终（除非您有充分的理由不这样做）将变量（实例、类、本地和方法参数）声明为接口。

* * *

## 回答 #3

> 赞同：23
> 
> 时间：2009-03-12T17:17:49.853

您只能获得一次继承权。如果你创建一个抽象类而不是一个接口，那么继承你的类的人不能也继承另一个抽象类。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2009-03-12T17:18:05.093

你可以实现多个接口，但你只能从一个类继承

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2009-03-12T17:25:01.380

***抽象类***

1.不能独立于它们的派生类来实例化。抽象类构造函数仅由其派生类调用。

2.定义基类必须实现的抽象成员签名。

3.比接口更可扩展，不破坏任何版本兼容性。使用抽象类，可以添加所有派生类都可以继承的其他非抽象成员。

4.可以包括存储在字段中的数据。

5.允许具有实现的（虚拟）成员，因此，为派生类提供成员的默认实现。

6.从抽象类派生使用了子类唯一的基类选项。

***界面***

1.无法实例化。

2.接口的所有成员的实现都发生在基类中。不可能只实现实现类中的一些成员。

3.扩展接口增加成员，破坏了版本兼容性。

4.不能存储任何数据。只能在派生类上指定字段。解决方法是定义属性，但没有实现。

5.所有成员都是自动虚拟的，不能包含任何实现。

6.虽然不会出现默认实现，但实现接口的类可以继续相互派生。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2009-03-12T17:46:44.337

正如[devinb](https://stackoverflow.com/questions/639592/why-are-interfaces-preferred-to-abstract-classes/639656#639656)和其他人所提到的，听起来面试官在不接受你的有效答案方面表现出他们的无知。

但是，提到 JDBC 可能是一个提示。在这种情况下，也许他们要求***客户端***针对接口而不是类进行编码的好处。

因此，与其寻找与类设计有关的完全有效的答案，例如*“您只能使用继承”*，他们可能正在寻找更像*“将客户端与特定实现分离”*的答案。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2009-03-12T17:23:41.430

抽象类有许多潜在的陷阱。例如，如果您覆盖一个方法，`super()`除非您显式调用它，否则该方法不会被调用。这可能会导致实现不佳的覆盖类出现问题。`equals()`此外，使用继承时也存在潜在问题。

当您想要共享实现时，使用接口可以鼓励使用组合。组合通常是重用其他对象的更好方法，因为它不那么脆弱。继承很容易被过度使用或用于错误的目的。

定义一个接口是一种非常安全的方式来定义一个对象应该如何行动，而不会冒扩展另一个类（无论是否抽象类）可能带来*的脆弱性的风险。*

此外，正如您所提到的，您一次只能扩展一个类，但您可以实现任意数量的接口。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2009-03-15T11:25:02.383

*继承实现*时使用抽象类，继承*规范*时使用接口。JDBC 标准规定“连接必须这样做*”*。那是规范。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2009-03-12T17:18:36.870

当您使用抽象类时，您会在子类和基类之间创建耦合。这种耦合有时会使代码很难更改，尤其是随着子类数量的增加。接口没有这个问题。

你也只有一个继承，所以你应该确保你使用它是出于正当的理由。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2009-03-12T18:01:30.120

> “为什么接口比抽象类更受欢迎？”

其他帖子在研究接口和抽象类之间的差异方面做得很好，所以我不会重复这些想法。

但是看看面试问题，更好的问题真的是“*什么时候*应该优先考虑接口而不是抽象类？” （反之亦然）。

与大多数编程结构一样，它们的存在是有原因的，而面试问题中的绝对陈述往往会忽略这一点。这让我想起了你曾经读过的关于C 语言中*goto*语句的所有声明。“你永远不应该使用*goto* - 它显示出糟糕的编码技能。” 但是，*goto*总是有其适当的用途。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2009-03-15T07:34:00.457

恭敬地不同意上述大多数海报（对不起！如果你愿意，请把我改掉 :-)）

* * *

首先，“只有一个超类”的答案是蹩脚的。任何在采访中给我这个答案的人都会很快被反驳说“C++ 在 Java 和 C++ 有多个超类之前就已经存在了。为什么你认为 James Gosling 只允许 Java 有一个超类？”

了解你的答案背后的哲学，否则你会干杯（至少如果我采访你的话。）

* * *

其次，与抽象类相比，接口具有多种优势，尤其是在设计接口时。最大的问题是没有对方法的调用者施加特定的类结构。没有什么比尝试使用需要特定类结构的方法调用更糟糕的了。这是痛苦和尴尬的。使用接口可以以最小的期望将*任何东西传递给方法。*

例子：

```
public void foo(Hashtable bar); 
```

对比

```
public void foo(Map bar); 
```

对于前者，调用者将始终采用他们现有的数据结构并将其猛烈撞击到一个新的 Hashtable 中。

* * *

第三，接口允许具体类实现者中的公共方法是“私有的”。如果该方法未在接口中声明，则该方法不能被没有业务使用该方法的类使用（或滥用）。这让我想到了第 4 点....

* * *

第四，接口代表了实现类和调用者之间的最小契约。这个最小的契约准确地指定了具体的实现者期望如何被使用，*仅此而已。*调用类不允许使用接口的“契约”未指定的任何其他方法。使用中的接口名称也符合开发人员对他们应该如何使用对象的期望。如果开发人员通过了

```
public interface FragmentVisitor {
    public void visit(Node node);
} 
```

开发人员知道他们可以调用的唯一方法是访问方法。他们不会被他们不应该搞乱的具体类中明亮闪亮的方法分心。

* * *

最后，抽象类有许多方法，这些方法实际上只存在于要使用的子类中。因此，对于外部开发人员来说，抽象类往往看起来有点像一团糟，没有关于外部代码打算使用哪些方法的指导。

是的，当然可以保护一些这样的方法。但是，可悲的是，受保护的方法对同一包中的其他类也是可见的。如果抽象类的方法实现了接口，则该方法必须是公共的。

然而，使用接口时，所有这些在查看抽象超类或具体类时都会出现的内部结构被安全地隐藏起来。

* * *

是的，我知道开发人员当然可以使用一些“特殊”知识将对象转换为另一个更广泛的接口或具体类本身。但是这样的演员阵容违反了预期的合同，开发商应该被打三文鱼。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2011-07-30T16:12:02.080

如果他们认为 X 比 YI 更好，我不会担心得到这份工作，我不会喜欢为那些强迫我做一个设计而不是另一个设计的人工作，因为他们被告知接口是最好的。两者都好视情况而定，不然语言为什么选择加抽象类呢？当然，语言设计者比我聪明。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2012-12-03T17:05:21.130

这就是“多重继承”的问题。我们一次可以通过另一个类“扩展”不超过一个抽象类，但是在接口中，我们可以在单个类中“实现”多个接口。因此，尽管 Java 通常不提供多重继承，但通过使用接口，我们可以在其中合并多重继承属性。

希望这可以帮助！！！

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2009-03-12T17:34:52.510

`interface`s 是编写纯抽象类的一种更简洁的方式。您可以看出实现并没有潜入（当然您可能希望在某些维护阶段这样做，这会使接口变得糟糕）。就是这样。客户端代码几乎没有可辨别的区别。

JDBC 是一个非常糟糕的例子。询问任何尝试实现接口并在 JDK 版本之间维护代码的人。JAX-WS 更糟糕，在更新版本中添加方法。

存在技术差异，例如能够乘以“继承”接口。这往往是设计混乱的结果。在极少数情况下，拥有不同于接口层次结构的实现层次结构可能很有用。

在接口的不利方面，编译器无法接受一些不可能`instanceof`的强制转换。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2009-03-12T21:27:51.623

上面没有提到的原因之一。

您可以使用 java.lang.reflect.Proxy 轻松装饰任何接口，允许您在运行时将自定义代码添加到给定接口中的任何方法。它非常强大。

有关教程，请参阅[http://tutorials.jenkov.com/java-reflection/dynamic-proxies.html](http://tutorials.jenkov.com/java-reflection/dynamic-proxies.html)。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2016-11-07T18:03:31.370

**接口**不能代替**抽象类**。

*更喜欢*

**接口：**通过多个不相关的对象来实现一个契约

**抽象类：**在多个相关对象之间实现相同或不同的行为

* * *

有关接口和抽象类的用例，请参阅此相关 SE 问题

[接口 vs 抽象类（通用 OO）](https://stackoverflow.com/questions/761194/interface-vs-abstract-class-general-oo/33963650#33963650)

## **用例：**

如果必须使用[Template_method](https://en.wikipedia.org/wiki/Template_method_pattern)模式，则无法通过接口实现。应该选择**抽象类来实现它。**

如果您必须为许多不相关的对象实现功能，则抽象类无法达到目的，您必须选择**interface**。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2009-03-12T17:19:32.813

您可以实现多个接口，但特别是对于 c#，您不能拥有多个继承

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2009-03-12T17:27:12.327

因为接口不会强迫您进入某些继承层次结构。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2009-03-12T17:50:22.707

当您只需要某个对象实现某些方法但您不关心它的谱系时，您可以定义接口。因此，有人可以扩展现有类来实现接口，而不会影响该类先前存在的行为。

这就是为什么 JDBC 都是接口的原因；您并不真正关心 JDBC 实现中使用了哪些类，您只需要任何 JDBC 实现即可具有相同的预期行为。在内部，Oracle JDBC 驱动程序可能与 PostgreSQL 驱动程序有很大不同，但这与您无关。一个可能必须继承数据库开发人员已经拥有的一些内部类，而另一个可能是完全从头开发的，但这对您来说并不重要，只要它们都实现相同的接口，以便您可以与其中一个或其他不知道其中任何一个的内部运作。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2009-03-12T21:05:06.483

好吧，我建议应该改写问题本身。接口主要是一个类获得的契约，该契约本身的实现会有所不同。抽象类通常包含一些默认逻辑，其子类将添加更多逻辑。我想说问题的答案取决于钻石问题。Java 防止多重继承来避免它。（[http://en.wikipedia.org/wiki/Diamond_problem](http://en.wikipedia.org/wiki/Diamond_problem)）。

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2009-04-13T21:47:13.817

> 他们要求我采用您使用的任何 JDBC api。“为什么它们是接口？”。

我对这个具体问题的回答是：

SUN 不知道如何实施它们或在实施中放入什么。由服务提供商/数据库供应商将他们的逻辑放入实现中。

JDBC 的设计与桥模式有关系，桥模式说“将抽象与其实现分离，以便两者可以独立变化”。

这意味着 JDBC api 的接口层次结构可以演变，而与 jdbc 供应商提供或使用的实现层次结构无关。

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2009-10-21T13:28:43.593

抽象类提供了一种定义行为模板的方法，用户可以在其中插入详细信息。

一个很好的例子是 Java 6 的[SwingWorker](http://java.sun.com/javase/6/docs/api/javax/swing/SwingWorker.html)。它定义了一个在后台做某事的框架，要求用户为实际任务定义**doInBackground()**。

我扩展了这个类，使它自动创建一个弹出进度条。我覆盖了 done()，以控制此弹出窗口的处理，但随后提供了一个新的覆盖点，允许用户有选择地定义进度条消失后会发生什么。

```
public abstract class ProgressiveSwingWorker<T, V> extends SwingWorker<T, V> {

    private JFrame progress;

    public ProgressiveSwingWorker(final String title, final String label) {
        SwingUtilities.invokeLater(new Runnable() {
            @SuppressWarnings("serial")
            @Override
            public void run() {
                progress = new JFrame() {{
                    setLayout(new MigLayout("","[grow]"));
                    setTitle(title);
                    add(new JLabel(label));
                    JProgressBar bar = new JProgressBar();
                    bar.setIndeterminate(true);
                    add(bar);
                    pack();
                    setLocationRelativeTo(null);
                    setVisible(true);
                }};
            }
        });
    }

    /**
     * This method has been marked final to secure disposing of the progress dialog. Any behavior
     * intended for this should be put in afterProgressBarDisposed.
     */
    @Override
    protected final void done() {
        progress.dispose();
        try {
            afterProgressBarDisposed(get());
        } catch (InterruptedException e) {
            e.printStackTrace();
        } catch (ExecutionException e) {
            e.printStackTrace();
        }
    }

    protected void afterProgressBarDisposed(T results) {
    }

} 
```

用户仍然需要提供**doInBackground()**的实现。但是，它们也可以有后续行为，例如打开另一个窗口、显示带有结果的 JOptionPane，或者干脆什么都不做。

要使用它：

```
new ProgressiveSwingWorker<DataResultType, Object>("Editing some data", "Editing " + data.getSource()) {

    @Override
    protected DataResultType doInBackground() throws Exception {
        return retrieve(data.getSource());
    }

    @Override
    protected void afterProgressBarDisposed(DataResultType results) {
        new DataEditor(results);
    }

}.execute(); 
```

这显示了抽象类如何很好地提供模板化操作，与定义 API 契约的接口概念正交。

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2009-11-25T13:03:26.370

它取决于您的要求和实施能力，这非常重要。关于这个问题，你有很多答案。我对这个问题的看法是，抽象类是 API 的演变。你可以在抽象类中定义你未来的函数定义，但你不需要在你的主类中实现所有函数，但是使用接口你不能做这件事。

# ruby-on-rails - 是否值得学习 Ruby On Rails

> ID：639594
> 
> 赞同：7
> 
> 时间：2009-03-12T17:15:38.610
> 
> 标签：ruby-on-rails

Ruby On Rails 是一个不断发展的框架，还是会在未来几年内消亡？现在值得将您的项目提交给它吗？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-12T17:18:20.583

我认为一个更好的问题是 Ruby on Rails 是否满足您的需求？它会很好地满足您的需求吗？是否有其他工具可以更好地满足您的需求？

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-12T17:23:52.693

每一项技术都不可避免地有一天会消亡，Ruby on Rails 也不例外。

FORTRAN 是 60 年代和 70 年代事实上的标准，但它实际上在很久以前就死了。同样的事情可能会发生在 C、C++，当然还有 Ruby 上。

话虽如此，Rails 是一个非常可靠的框架，我认为它是目前最好的 Web 框架之一。如果您是 Web 开发人员，您绝对应该研究一下。

**编辑：**

我认为有必要对 FORTRAN 的“死亡”进行一些澄清。

当我说 FORTRAN*几乎*已死时，我说的是与 FORTRAN 的全盛时期（60 年代和 70 年代）相比。据我所知，FORTRAN 不再在学校教授或用于新项目。

附带说明一下，这（语言/技术何时“死亡？”）将是一个非常有趣的话题，但我不确定 SO 是否适合它。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-12T17:20:01.547

我们有一个充满活力的 Ruby on Rails 和 Ruby 用户社区。我看不到任何迹象表明它会很快消失。不过，我认为@Alex B 的观点是正确的：选择最适合您的框架，尽管这可能包括它的长期可行性。

至于它是否值得学习，我认为如果您没有任何动态语言经验，无论您是否打算在生产应用程序中使用 Ruby 和 RoR，都值得探索。我主要在 C#/.NET 中工作，并且从探索 RoR 中学到了很多可以应用到那里的东西。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-12T17:36:49.243

继续学习 Ruby on Rails，或者至少学习一个更好的教程。

某些想法/技巧（例如约定优于配置）有助于在您以后所做的任何工作中理解。

与其他一些选项相比，Ruby 运行速度有点慢，但对于大多数不会获得大量流量的内部网站来说，它肯定足够快。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-12T17:24:24.640

我说是的，但我的观点是有偏见的，因为我自己一直在尝试学习 Ruby on Rails。我认为这个框架很棒；它有其缺陷（主要与社区改变事物的速度以及它的所有“魔力”有关），但总的来说，我认为就 Web 开发而言，它是“下一件大事”。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-12T17:24:24.750

Ruby on Rails 的使用已恢复正常。起初它被夸大了，然后被过度批评了。

它做得很好，如果没有其他原因，值得检查基础知识，然后看看 Web 应用程序开发不必是痛苦的。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-12T17:24:40.663

当您要学习 RoR 时，您可以转向 JRuby 或 Groovy/Grails，并从 Java/J2EE 世界的巨大影响中获益。

Ruby 是一种生产力非常高、富有表现力且易于阅读的语言，无需太多代码样板。

但是 Ruby 是一种非常慢的语言！JVM 实现 JRuby 要快得多。

也许 RoR 会消亡（我认为不会），但 Java 平台的寿命可能会更长一些。因此，您可以保护您的投资，因为您可以将任何 JRuby 类与其他 Java 类重用。几乎每个 Ruby 软件都可以在 Glassfish 上使用 JRuby 启动；）

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-12T17:41:13.463

如果我正确阅读情况，取决于您在哪里工作。

如果你在一家大公司工作，比如美国的财富 500 强公司，Ruby 或 Rails 不太可能对你有好处。较少出于技术原因，更多是因为这些组织往往规模庞大、官僚主义、保守、最小公分母和规避风险。你会看到 Java 或 C# 在那里根深蒂固，因为它们是主流语言，拥有庞大的用户社区和公司支持它们。

如果您在一家更具创业精神的小公司，我可以看到他们更有可能在 Ruby、Python 等技术上冒险。与[Paul Graham](http://www.paulgraham.com/power.html)一致的地方更有可能使用替代平台.

# networking - 如何使子网内的 Teredo 主机相互通信

> ID：639597
> 
> 赞同：2
> 
> 时间：2009-03-12T17:17:02.130
> 
> 标签：networking, ipv6, tunneling

虽然我可以从启用 teredo 的终端主机成功 ping 一个全局地址，但我无法在同一个 ipv4 子网中连接两个终端主机。我们正在运行 Windows XP。有什么想法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-26T02:29:34.793

答：使用链接本地地址。这可以通过使用 mac 地址和其他可用信息来形成。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-03-25T12:00:29.610

winxp sp3 teredo 实现似乎有一个错误。Winxp SP3 在同一路由器后面时不发送多播气泡数据包。目前还没有解决办法。但有时它会发送多播数据包并到达同一子网中的系统。

# maven-2 - 如何从父 pom 部署多个对等 webapp

> ID：639616
> 
> 赞同：18
> 
> 时间：2009-03-12T17:21:37.910
> 
> 标签：maven-2, jetty

我有一组我管理的网络应用程序，我正试图转移到 maven。

```
/pom.xml // 父 pom
 webapp1/pom.xml // 配置为指向父级
 webapp2/pom.xml // webapp1 的对等点并指向父级。

```

每个 webapps 都引用父 pom，并且它们目前都有一个可以工作的 jetty maven 插件。

我的问题是如何从父 pom 挂载每个 webapp，以便 mvn jetty:run 在父目录中工作？

编辑回答：Pascal T 问题不在于我在尝试从根 pom 运行命令时遇到错误，而是我不确定如何配置它。

例如 webapp1/pom.xml 看起来像：

```
<project>
...
<plugins>
  <plugin>
    <groupId>org.mortbay.jetty</groupId>
    <artifactId>maven-jetty-plugin</artifactId>
  </plugin>
</plugins>
...
</project> 
```

切换到这个目录并输入 mvn jetty:run 工作得很好，让我能够点击：[http://localhost:8080/webapp1](http://localhost:8080/webapp1)。

但是，我希望成为 webapp1 的父级，并从父目录运行所有“n”个 webapp。因此，[http://localhost:8080/webapp1](http://localhost:8080/webapp1)和[http://localhost:8080/webapp2](http://localhost:8080/webapp2)可通过一个命令行参数使用。

顺便说一句，如果答案涉及 tomcat 插件，那很好。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-12T19:38:56.127

**编辑**：我已经完全编辑了我的第一个答案，因为我对 OP 的期望有了更好的理解。

查看[Cargo](http://cargo.codehaus.org/)，*它是一个瘦包装器，允许您以标准方式操作 Java EE 容器*。

实际上，在 Cargo 的网站上有一个[教程](http://cargo.codehaus.org/Starting+and+stopping+a+container)，演示了如何使用 Cargo Maven2 插件来自动启动/停止容器（可能在容器启动时部署一些可部署的东西），这就是你从我所寻找的明白了。

我只是不确定从父目录执行此操作是否可行，以及是否需要，或者是否可以从另一个目录执行此操作。我稍后会回来讨论这个问题。让我们首先看一下 Cargo Maven2 插件设置。

在您的情况下，您可以从最小配置开始（使用 Jetty 5.x，这是 Cargo 的默认容器）：

```
[...]
<build>
  <plugins>
    <plugin>
      <groupId>org.codehaus.cargo</groupId>
      <artifactId>cargo-maven2-plugin</artifactId>
    </plugin>
  </plugins>
</build>
[...] 
```

如果你想使用 Jetty 6.x，你必须在元素中指定`<containerId>`和：`<type>``<container>`

```
[...]
<plugin>
 <groupId>org.codehaus.cargo</groupId>
 <artifactId>cargo-maven2-plugin</artifactId>
 <configuration>
   <container>
     <containerId>jetty6x</containerId>
     <type>embedded</type>
   </container>
 </configuration>
</plugin>
[...] 
```

然后，通过在插件配置中显式定义可部署项来添加要部署的模块（有关配置的详细信息，请参阅*Maven2*插件[参考指南](http://cargo.codehaus.org/Maven2+Plugin+Reference+Guide)）：

```
<deployables>
  <deployable>
    <groupId>com.mycompany.myproject</groupId>
    <artifactId>myproject-alpha</artifactId>
    <type>war</type>
    <properties>
      <context>optional alpha root context</context>
    </properties>
  </deployable>
  <deployable>
    <groupId>com.mycompany.myproject</groupId>
    <artifactId>myproject-beta</artifactId>
    <type>war</type>
    <properties>
      <context>optional beta root context</context>
    </properties>
  </deployable>
  [...]
</deployables> 
```

有了这个，您应该能够启动 Jetty 并通过简单的方式在其上部署您的 webapps（从包含货物插件配置的项目中运行）：

```
$ mvn cargo:start 
```

我只是不确定这是否可以与父 pom 一起使用（我想知道这是否会导致循环依赖问题）并且我没有对其进行测试。但就个人而言，我会将所有这些东西放在一个专用项目的 pom 中，例如，放在 webapps 的兄弟项目中，而不是放在父 pom 中。我认为这没什么大不了的，恕我直言，这是一个更好的设置，特别是如果您打算使用 cargo 进行[集成测试](http://cargo.codehaus.org/Starting+and+stopping+a+container#Startingandstoppingacontainer-lifecycle)。

# orientation - 在 Postscript 文件上使用 Cups 反转方向

> ID：639617
> 
> 赞同：1
> 
> 时间：2009-03-12T17:21:51.777
> 
> 标签：orientation, reverse, postscript, cups

在 CUPS 中使用 lp -oorientation-requested=6 打印 postscript 文件时，第一页反转 180 度，然后下一页回到 0 方向。第三页旋转 180 度，第四页回 0 以此类推。我需要将文件中的每一页反转 180 度。任何关于尝试什么的建议将不胜感激。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-12T18:23:40.863

如果您的 PostScript 文件不严格符合 PostScript DSC（文档结构约定），并且文件被发送到 PostScript 打印机，那么 CUPS 可能添加到页面的任何额外内容都可能被不正常的每页覆盖文件中的内容。不幸的是，没有特别好的解决方案可以克服任意行为不良的 PostScript 代码。（rotate-every-other-page 或 rotate-every-page-an-extra-180 行为支持这个 via。

如果生成 PostScript 文件的是您自己的应用程序，您可能会受益于将您通过管道输入假脱机程序的内容与 CUPS 实际发送到打印机的内容进行比较（您可以使用 netcat 捕获它）。

# c# - Nhibernate 将一个类与其自身进行一对一映射

> ID：639620
> 
> 赞同：0
> 
> 时间：2009-03-12T17:23:27.857
> 
> 标签：c#, nhibernate, nhibernate-mapping

我们有一种情况，我们想要定义一个关系，其中一个类（名为 Module）可能与作为它的前身的 Module 对象相关，也可能不相关。可以有零个或没有前任。该类如下所示：

```
public class Module
{
    public int Id
    {
        get;
        set;
    }

    // other stuff here

    public Module Predecessor
    {
        get;
        set;
    }
} 
```

我们已经定义了映射，以便 Predecessor 是 Module 类型的属性，如下所示：

```
<class name="Module">
    <Id name="Id">
        <generator class="native/>
    </Id
    <property name="Predecessor" type="Module" "unique="true"/>
<class> 
```

但是，我们收到有关映射无法编译的投诉，因为它找不到“模块”类型。我们已经尝试了类的长名称

```
type="STC.EI.JobSubmissionSystem.Data.Domain" 
```

和类的完全限定名称

```
type="STC.EI.JobSubmissionSystem.Data.Domain, STC.EI.JobSubmissionSystem.Data" 
```

无济于事。我的问题是：

我们是否正确地映射了它，如果没有，那么我们如何正确地映射它？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-12T17:31:52.407

您可以使用[多对一](http://www.hibernate.org/hib_docs/nhibernate/1.2/reference/en/html_single/#mapping-declaration-manytoone)元素：

```
<class name="Module">
    <Id name="Id">
        <generator class="native"/>
    </Id>
    <many-to-one name="Predecessor" class="Module" column="predecessor_id" />
<class> 
```

请注意，您需要在表中有一列来定义关系。

# php - 关注点分离; MVC；为什么？

> ID：639622
> 
> 赞同：31
> 
> 时间：2009-03-12T17:23:52.443
> 
> 标签：php, model-view-controller, user-interface, oop

在开始我的下一个主要项目之前，我目前正在阅读 OO。为了给您一些快速的背景知识，我是一名 PHP 开发人员，从事 Web 应用程序的工作。

我特别感兴趣的一个领域是用户界面。特别是如何构建它并将其连接到我的 OO“模型”。

我一直在阅读这方面的内容。我的最爱之一是： [为面向对象系统构建用户界面](http://www.javaworld.com/javaworld/jw-07-1999/jw-07-toolbox.html)

> “所有对象都必须提供自己的 UI”

考虑到*我的*问题，我可以看到它运作良好。例如，我构建我的“用户”对象来代表已经登录到我的网站的人。我的一种方法是“display_yourself”或类似的。我可以在我的代码中使用它。也许从这开始只是他们的名字。稍后，如果我需要调整以显示他们的名字+小头像，我可以更新这个方法，嘿-presto，我的应用程序更新了。或者，如果我需要将他们的名字作为他们个人资料的链接，我可以从一个地方轻松地再次更新。

就OO系统而言；我认为这种方法效果很好。查看其他 StackOverflow 线程，我在“关注点分离”下找到了这个： [Soc](https://stackoverflow.com/questions/98734/separation-of-concerns)

> “在计算机科学中，关注点分离 (SoC) 是将计算机程序分解为功能上尽可能少重叠的不同特征的过程。关注点是程序中的任何兴趣或关注点。通常，关注点与功能或行为。传统上，SoC 的进步是通过模块化和封装以及信息隐藏来实现的。

在我看来，我已经做到了这一点。我的用户对象隐藏了它的所有信息。在显示之前，我的代码中没有任何地方可以说 $user->get_user_name() 。

然而，这似乎违背了其他人似乎认为的“最佳实践”。

引用同一问题的“选定”（绿色）答案：

> “关注点分离就是将每个关注点的代码分开。更改接口不应该需要更改业务逻辑代码，反之亦然。模型-视图-控制器 (MVC) 设计模式是分离这些关注点的一个很好的例子以获得更好的软件可维护性。”

为什么这会带来更好的软件可维护性？当然，使用 MVC，我的视图必须对模型非常了解？阅读 JavaWorld 文章以获得关于这一点的详细讨论： [为面向对象系统构建用户界面](http://www.javaworld.com/javaworld/jw-07-1999/jw-07-toolbox.html)

不管怎样……终于到了真正的重点！

**1.**谁能推荐一些详细讨论这个问题的书？我不想要一本 MVC 书；我没有在 MVC 上出售。我想要一本讨论 OO / UI、潜在问题、潜在解决方案等的书。（可能包括 MVC） Arthur Riel 的[面向对象设计启发式](https://rads.stackoverflow.com/amzn/click/com/020163385X)

触及它（也是一本优秀的书！），但我想要更详细的东西。

**2.**谁能提出一个像 Allen Holub 的 JavaWorld 文章那样解释清楚为什么 MVC 是一个好主意的论点？

非常感谢任何可以帮助我就此得出结论的人。

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2009-03-12T18:59:02.637

这是 OOP 教学方式的失败，使用了诸如 rectangle.draw() 和恐龙.show() 之类的示例，这些示例绝对没有意义。

当您谈论拥有一个显示自身的用户类时，您几乎是在回答自己的问题。

“以后，如果我需要调整显示他们的名字+小头像，我可以更新这个方法，嘿，我的应用程序更新了。”

暂时想想那一小部分。现在查看 Stack Overflow 并注意您的用户名出现的所有位置。在每种情况下看起来都一样吗？不，在顶部，您的用户名旁边只有一个信封，然后是您的声誉和徽章。在问题线程中，您的头像后面是您的用户名，下面是您的声誉和徽章。您是否认为存在具有 getUserNameWithAvatarInFrontOfItAndReputationAndBadgesUnderneath() 等方法的用户对象？不。

一个对象与它所代表的数据和作用于该数据的方法有关。您的用户对象可能具有 firstName 和 lastName 成员，以及检索这些片段所需的 getter。它也可能有一个方便的方法，比如 toString()（用 Java 术语），它会以通用格式返回用户的姓名，比如名字后跟一个空格，然后是姓氏。除此之外，用户对象不应该做太多其他事情。由客户决定它想对对象做什么。

以你给我们的用户对象为例，然后想想如果你在其中构建一个“UI”，你将如何做以下事情：

1.  创建显示所有用户的 CSV 导出，按姓氏排序。例如姓氏，名字。
2.  提供重量级 GUI 和基于 Web 的界面来处理用户对象。
3.  在一个地方的用户名旁边显示一个头像，但只在另一个地方显示用户名。
4.  提供用户的 RSS 列表。
5.  在一个地方显示用户名粗体，在另一个地方显示为斜体，在另一个地方显示为超链接。
6.  在适当的地方显示用户的中间名。

如果您考虑这些要求，它们都归结为提供一个只关注它应该关注的数据的用户对象。它不应该试图对每个人都适用，它应该只是提供一种获取用户数据的方法。*由您将创建的许多*视图中的每一个来决定它希望如何显示用户数据。

您关于在一个地方更新代码以在多个地方更新您的视图的想法是一个很好的想法。这仍然是可能的，而无需处理太低的水平。您当然可以创建类似小部件的类来封装您各种常见的“东西”视图，并在您的视图代码中使用它们。

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2009-03-12T19:40:23.317

这是我在 PHP 中使用 MVC/关注点分离模式创建网站时采用的方法：

我使用的框架包含三个基本部分：

*   模型 - PHP 类。我向它们添加方法来获取和保存数据。每个模型代表系统中不同类型的实体：用户、页面、博客文章
*   视图 - Smarty 模板。这是 html 所在的地方。
*   控制器 - PHP 类。这些是应用程序的大脑。通常，站点中的 url 调用类的方法。example.com/user/show/1 将调用 $user_controller->show(1) 方法。控制器从模型中取出数据并将其提供给视图。

这些作品中的每一个都有特定的工作或“关注点”。**模型**的工作是为数据提供一个干净的接口。通常，站点的数据存储在 SQL 数据库中。我向模型中添加了用于获取数据和保存数据的方法。

**view**的工作是显示数据。所有 HTML 标记都在视图中。处理数据表的斑马条纹的逻辑进入视图。处理日期显示格式的代码进入视图。我喜欢为视图使用 Smarty 模板，因为它提供了一些很好的功能来处理类似的事情。

**控制器**的工作是充当用户、模型和视图之间的中介。

让我们看一个例子，说明它们是如何结合在一起的以及好处在哪里：

想象一个简单的博客网站。主要数据是帖子。另外，假设该网站跟踪查看帖子的次数。我们将为此创建一个 SQL 表：

```
posts
id date_created title body hits 
```

现在假设您想显示 5 个最受欢迎的帖子。以下是您可能在非 MVC 应用程序中看到的内容：

```
$sql = "SELECT * FROM posts ORDER BY hits DESC LIMIT 5";
$result = mysql_query($sql);

while ($row = mysql_fetch_assoc($result)) {
    echo "<a href="post.php?id=$row['id']">$row['title']</a><br />";
} 
```

此代码段非常简单，并且在以下情况下效果很好：

1.  这是您想要显示最受欢迎帖子的唯一地方
2.  你永远不想改变它的外观
3.  你永远不会决定改变什么是“热门帖子”

想象一下，您想在主页上显示 10 个最受欢迎的帖子，并在子页面的侧边栏中显示 5 个最受欢迎的帖子。您现在需要复制上面的代码，或者将其放入包含逻辑的包含文件中，以检查它的显示位置。

如果您想更新主页的标记以向今天创建的帖子添加“新帖子”类怎么办？

假设您认为某个帖子很受欢迎，因为它有很多评论，而不是点击量。数据库将更改以反映这一点。现在，您的应用程序中显示热门帖子的每个位置都必须更新以反映新逻辑。

你开始看到一个复杂形式的雪球。很容易看出在项目过程中事情如何变得越来越难以维护。此外，还要考虑多个开发人员在一个项目上工作时的复杂性。在向输出中添加类时，设计人员是否必须咨询数据库开发人员？

采用 MVC 方法并在应用程序中实施关注点分离可以缓解这些问题。理想情况下，我们希望将其分为三个区域：

1.  数据逻辑
2.  应用逻辑
3.  和显示逻辑

让我们看看如何做到这一点：

我们将从**模型**开始。我们将有一个`$post_model`类并给它一个名为`get_popular()`. 此方法将返回一个帖子数组。此外，我们将给它一个参数来指定要返回的帖子数：

```
post_model.php

class post_model {
    public function get_popular($number) {
        $sql = "SELECT * FROM posts ORDER BY hits DESC LIMIT $number";
        $result = mysql_query($sql);
        while($row = mysql_fetch_assoc($result)) {
            $array[] = $row;
        }
        return $array;
    } 
} 
```

现在对于主页，我们有一个**控制器**，我们将其称为“主页”。假设我们有一个 url 路由方案，它在请求主页时调用我们的控制器。它的工作是获取热门帖子并将其赋予正确的视图：

```
home_controller.php

class home_controller {
    $post_model = new post_model();
    $popular_posts = $post_model->get_popular(10);

    // This is the smarty syntax for assigning data and displaying
    // a template. The important concept is that we are handing over the 
    // array of popular posts to a template file which will use them 
    // to generate an html page
    $smarty->assign('posts', $popular_posts);
    $smarty->view('homepage.tpl');
} 
```

现在让我们看看**视图**会是什么样子：

```
homepage.tpl   

{include file="header.tpl"}

 // This loops through the posts we assigned in the controller
 {foreach from='posts' item='post'} 
    <a href="post.php?id={$post.id}">{$post.title}</a>
 {/foreach}

{include file="footer.tpl"} 
```

现在我们有了应用程序的基本部分，可以看到关注点的分离。

该**模型**与获取数据有关。它了解数据库，了解 SQL 查询和 LIMIT 语句。它知道它应该交还一个漂亮的数组。

**控制器**知道用户的请求，即他们正在查看主页。它知道主页应该显示 10 个热门帖子。它从模型中获取数据并将其提供给视图。

**视图**知道帖子数组应该显示为一系列 achor 标签，后面有 break 标签。它知道一个帖子有一个标题和一个ID。它知道应该将帖子的标题用于锚文本，并且应该在 href 中使用帖子 ID。视图还知道页面上应该显示页眉和页脚。

提及每件作品*不*知道的内容也很重要。

该**模型**不知道热门帖子显示在主页上。

**控制器**和**视图**不知道帖子存储在 SQL 数据库中。

**控制器**和**模型**不知道主页上帖子的每个链接后面都应该有一个中断标签。

因此，在这种状态下，我们已经在数据逻辑（模型）、应用程序逻辑（控制器）和显示逻辑（视图）之间建立了清晰的关注点分离。那么现在怎么办？我们采用了一个简短的简单 PHP 片段并将其分解为三个令人困惑的文件。这给了我们什么？

让我们看看关注点分离如何帮助我们解决上述问题。重申一下，我们希望：

1.  在子页面的侧边栏中显示热门帖子
2.  使用额外的 CSS 类突出显示新帖子
3.  更改“热门帖子”的基本定义

为了在侧边栏中显示热门帖子，我们将在子页面中添加两个文件：

子页面控制器...

```
subpage_controller.php

class subpage_controller {
    $post_model = new post_model();
    $popular_posts = $post_model->get_popular(5);

    $smarty->assign('posts', $popular_posts);
    $smarty->view('subpage.tpl');
} 
```

...和一个子页面模板：

```
subpage.tpl

{include file="header.tpl"}

<div id="sidebar">

 {foreach from='posts' item='post'}
    <a href="post.php?id={$post.id}">{$post.title}</a>
 {/foreach}

</div>

{include file="footer.tpl"} 
```

新的子页面**控制器**知道子页面应该只显示 5 个热门帖子。子页面**视图**知道子页面应该将帖子列表放在侧边栏 div 中。

现在，在主页上，我们要突出显示新帖子。我们可以通过修改 homepage.tpl 来实现。

```
{include file="header.tpl"}

 {foreach from='posts' item='post'}
    {if $post.date_created == $smarty.now}
        <a class="new-post" href="post.php?id={$post.id}">{$post.title}</a>
    {else}
        <a href="post.php?id={$post.id}">{$post.title}</a>
    {/if}
 {/foreach}

{include file="footer.tpl"} 
```

在这里，**视图**处理了所有用于显示热门帖子的新逻辑。**控制器**和**模型**不需要知道有关该更改的任何信息。这纯粹是显示逻辑。子页面列表继续像以前一样显示。

最后，我们想更改热门帖子的含义。我们希望它不是基于页面获得的点击数，而是基于帖子获得的评论数。我们可以将该更改应用于模型：

```
post_model.php

class post_model {
    public function get_popular($number) {
        $sql = "SELECT * , COUNT(comments.id) as comment_count
                FROM posts 
                INNER JOIN comments ON comments.post_id = posts.id
                ORDER BY comment_count DESC 
                LIMIT $number";
        $result = mysql_query($sql);
        while($row = mysql_fetch_assoc($result)) {
            $array[] = $row;
        }
        return $array;
    } 
} 
```

我们增加了“热门帖子”逻辑的复杂性。但是，一旦我们在**模型**中进行了这种更改，新的逻辑就会在一个地方应用到所有地方。主页和子页面，在没有其他修改的情况下，现在将根据评论显示热门帖子。我们的设计师不需要参与其中。标记不受影响。

希望这提供了一个令人信服的例子，说明如何分离数据逻辑、应用程序逻辑和显示逻辑的关注点，可以使开发应用程序更容易。一个领域的变化往往对其他领域的影响较小。

遵循这个约定并不是让你的代码自动变得完美的灵丹妙药。毫无疑问，你会遇到一些不太清楚应该在哪里分离的问题。最后，这一切都与管理应用程序中的复杂性有关。

您应该充分考虑如何构建模型。他们将提供什么样的接口（参见 Gregory 关于合同的回答）？控制器和视图期望使用什么数据格式？提前考虑这些事情会让事情变得更容易。

此外，在开始一个项目以使所有这些部分很好地协同工作时，可能会有一些开销。有许多框架为模型、控制器、模板引擎、url 路由等提供构建块。有关 PHP MVC 框架的建议，请参阅 SO 上的许多其他帖子。这些框架将使您启动并运行，但您作为开发人员负责管理复杂性并实施关注点分离。

我还要注意，上面的代码片段只是简化的示例。他们可能（很可能）有错误。但是，它们在结构上与我在自己的项目中使用的代码非常相似。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-12T17:45:08.040

我不确定我能不能带你去喝你想喝的水，但我想我可以回答你的一些担忧。

首先，在 MVC 中，模型和视图确实有一些相互作用，但视图实际上是耦合到契约而不是实现。您可以转移到遵守相同合同的其他模型，并且仍然能够使用该视图。而且，如果你仔细想想，这是有道理的。用户有名字和姓氏。他可能还有一个登录名和密码，尽管您可能会将其与用户的“合同”联系起来，也可能不会。关键是，一旦您确定了用户是什么，就不太可能发生太大变化。您可能会向其中添加一些内容，但您不太可能经常删除。

在视图中，您有指向遵循该合同的模型的指针，但我可以使用一个简单的对象：

```
 public class User
 {
    public string FirstName;
    public string LastName;
 } 
```

是的，我意识到公共领域很糟糕。:-) 我也可以使用 DataTable 作为模型，只要它公开 FirstName 和 LastName。这可能不是最好的例子，但关键是模型与视图无关。视图与合同相关联，并且特定模型遵守该合同。

我还没有听说过每个对象都必须有自己的 UI。基本上有两种类型的对象：状态和行为。我见过同时具有状态和行为的示例，但它们通常位于不太可测试的系统中，我不喜欢这样。最终，每个状态对象都应该暴露给某种形式的 UI，以避免迫使 IT 人员直接在数据存储中处理所有更新，但有自己的 UI？我将不得不看到写在解释中的内容，以尝试了解用户在做什么。

至于 SoC，将事物清晰封装的原因是能够在不重写整个系统的情况下切换层/层。一般来说，该应用程序确实位于业务层，因此该部分不能轻易切换。在设计良好的系统中，数据和 UI 应该相当容易切换。

至于理解 OOP 的书籍，我更喜欢模式书籍，因为它们是理解概念的更实用的方法。您可以在网上找到底漆材料。如果您想要一本与语言无关的模式书，并且觉得有点怪异，那么“四人帮”书是一个不错的起点。对于更具创意的类型，我会说 Heads Up Design Patterns。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-12T17:37:23.127

所有对象都知道如何显示自己的想法的问题是每个对象只能以一种方式显示。如果您想提供用户的详细视图和摘要视图，会发生什么情况。如果您想显示一个合并多个对象（例如用户及其关联地址）的视图，会发生什么情况。如果您将业务对象（用户）与知道如何显示它们的事物分开，那么您就无需编写更多代码，只需将其分隔到不同的位置即可。

这使得软件更易于维护，因为如果用户对象的行为不正确，您知道它是用户，如果它没有正确显示，您知道它是视图。在您需要为应用程序提供新界面的情况下（假设您决定为移动浏览器提供新的外观和感觉），那么您根本不需要更改用户对象，您可以添加一个知道如何操作的新对象为移动浏览器呈现用户对象。

SOLID 原则为此提供了一些很好的推理，[这里](http://mmiika.wordpress.com/oo-design-principles/)是一个相对简洁的介绍。恐怕我手头没有一本可以很好地总结它的书，但经验告诉我，编写新代码比更新旧代码更容易，因此设计倾向于将小型模块化类插入到实现所需的东西，虽然前期设计更难，但从长远来看更容易维护。能够为用户对象编写新的渲染器，而无需深入研究该对象的内部结构，这真是太好了。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-13T08:16:42.093

> 谁能提出一个论点 [...] 来解释为什么 MVC 是一个好主意？

它通过帮助您记住代码的作用来让您保持清醒，因为它们彼此隔离。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-12T17:34:34.180

*   考虑将进入该单个类的代码量，如果您不仅想在 UI 上公开与 Html 相同的信息，而且作为 RSS、JSON、带有 XML 的休息服务的一部分，[插入其他内容] .
*   这是一个有漏洞的抽象，这意味着它试图让你感觉到它将是唯一知道这些数据的部分，但这不可能完全是事实。假设您想提供一项与多个外部第三方集成的服务。您将很难强迫他们使用您的特定语言与您的服务集成（因为它是唯一可以使用它的数据的类），或者另一方面，如果您公开它的一些数据您没有向这些第三方系统隐藏数据。

**更新 1：**我对整篇文章进行了整体查看，作为一篇旧文章 (99)，它并不是真正关于我们今天所知道的 MVC 与面向对象的对比，也没有反对 SRP 的论点。

您完全可以按照他所说的来处理我提到的上述场景，并使用负责将对象的公共合同转换为不同格式的特定类：主要问题是我们没有明确的位置来处理更改而且我们不希望这些信息被重复一遍。因此，在 html 案例中，您可以完美地拥有一个呈现信息的控件，或者一个将其转换为 html 的类或 [在此处插入重用机制]。

顺便说一句，我对 RMI 位有一个闪回。无论如何，在那个例子中，你可以看到他与一种交流机制有关。也就是说，每个方法调用都是远程处理的。我认为他也非常关心开发人员的代码，而不是获取单个对象并对返回的信息进行操作，而是有很多小的 Get 调用来获取大量不同的信息。

附言。我建议您阅读有关 DDD 和 Solid 的信息，正如我对 SRP 所说的那样，我不会说这是作者抱怨的事情类型

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-13T08:14:43.097

我不知道任何关于 MVC 主题的好书，但根据我自己的经验。例如，在 Web 开发中，您经常与设计师合作，有时与 dbas 合作。将逻辑与演示分开可以让您更好地与具有不同技能的人一起工作，因为设计师不需要太多的编码，反之亦然。此外，对于 DRY 的概念，您可以使您的代码更少重复且更易于维护。您的代码将更具可重用性，并使您的工作更加轻松。它还将使您成为更好的开发人员，因为您将变得更有条理并以不同的方式思考编程。因此，即使您必须从事非 MVC 的工作，您也可能有不同的方法来构建项目，因为您了解 MVC 概念。

我猜想为大型站点使用许多 MVC 框架的权衡是它可能不够快来处理负载。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2011-01-12T18:39:25.977

我的 2c .. 除了所说的之外，您还可以做的另一件事是使用用户对象的装饰器。这样，您可以根据上下文对用户进行不同的*装饰。*所以你最终会得到 WebUser.class、CVSUser.class、RSSUser.class 等。

我并没有真正这样做，它可能会变得混乱，但它有助于避免客户端代码不得不从你的用户中提取大量信息。研究起来可能很有趣；-)

*   [为什么 getter 和 setter 方法是邪恶的](http://www.javaworld.com/javaworld/jw-09-2003/jw-0905-toolbox.html)（JavaWorld）
*   [装饰图案](http://en.wikipedia.org/wiki/Decorator_pattern)

# linux - 长时间运行的java进程

> ID：639625
> 
> 赞同：2
> 
> 时间：2009-03-12T17:23:57.670
> 
> 标签：linux, daemon, startupscript

我继承了一个应该在 Linux 服务器的后台运行的 java 系统。指示要求启动它`java -jar start.jar`。这对我来说似乎有点太脆弱了。我希望它在后台实际运行，理想情况下在启动时自动启动。

实现这一目标的最佳方法是什么？我已经研究过在一个`screen`环境中运行系统，它工作正常，但在系统重新启动时不会自动启动。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-12T17:29:31.400

您可以为它编写一个 init.d 脚本！（init.d 脚本在启动时以指定的运行级别启动）

或者，您可以在命令末尾使用 & 在后台启动它。

```
java -jar start.jar & 
```

你使用什么样的分布？德比安？

看看：[创建自己的 init.d 脚本](http://www.linux.com/feature/46892)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-12T17:30:58.807

至少在 ubuntu 上，我会将此命令放在 /etc/rc.local 文件中，并以 & 结尾。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-13T09:32:07.233

+1 使用 init.d 脚本

您还应该考虑在 init.d 脚本中使用 jsvc ( [http://commons.apache.org/daemon/jsvc.html](http://commons.apache.org/daemon/jsvc.html) ) 以允许您在以非特权用户身份运行服务时使用特权资源。jsvc 至少与 Debian 和 Ubuntu 捆绑在一起。

# wpf - 如何在 RichTextBox 中限制每行最多 83 个字符

> ID：639634
> 
> 赞同：0
> 
> 时间：2009-03-12T17:25:24.577
> 
> 标签：wpf, richtextbox

我正在尝试使用 WPF RichTextBox 和工具栏重新创建 MSWord，因此最近出现的问题之一如下：

在 MSWord 文档中...

...使用 Font Family Times New Roman, 11, Justify 单行包含 95 个字符 ...使用 Font Family Times New Roman, 11, Justify, Bold 单行包含 83 个字符

关于边距更建议使用边距或限制每行字符？导致当用户输入为 , 时。或其他 ASCII 的大小比其他的短，单行“更改”中的最大字符。因此，如果最恰当地使用边距 - WPF RichTextBox 如何管理边距？

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-12T18:11:58.677

试图限制每行的字符对我来说听起来像是一场噩梦。你最好摆脱默认设置`ControlTemplate`，`RichTextBox`这样你就只有文本，然后设置`Margin`你的`RichTextBox`，这样文本“浮动”在中间：

```
<Grid xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation" xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
    <ScrollViewer>
        <RichTextBox Margin="30,0">
            <RichTextBox.Template>
                <ControlTemplate TargetType="{x:Type RichTextBox}">
                    <Border x:Name="PART_ContentHost" Margin="2" Background="Transparent" BorderBrush="Transparent"/>
                </ControlTemplate>
            </RichTextBox.Template>
        </RichTextBox>
    </ScrollViewer>
</Grid> 
```

# ada - 如何在 Ada 中打印 Ada.Calendar.Time 变量？

> ID：639643
> 
> 赞同：1
> 
> 时间：2009-03-12T17:27:51.140
> 
> 标签：ada

需要知道如何在 Ada 中打印时间变量。我认为没有可移植的方式，因为 Time 是实现定义的。我已经看到 GNAT 下可用的 GNAT.Calendar.Formatting 包，我也对 VME 的 GHS 感兴趣。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-13T08:27:55.793

请参阅 Ada2005 的包“Ada.Calendar.Formatting”函数“Image”。如果你有一个 Ada95 编译器，但这个包不可用，请从[这里尝试我的实现](http://www.martin.dowie.btinternet.co.uk/Calendar/Calendar.zip)

这是使用 GNAT 3.15p 编写的，非常古老。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-12T18:41:36.093

当然，时间输出是可移植的，Ada.Calendar 包含提取时间值组件的标准函数，因此很容易将自己的转换包放在一起。

例如，这是[一个](http://www.adapower.com/index.php?Command=Class&ClassID=AdaLibs&CID=190). 只需要创建一个小的添加来为给定的时间值创建一个“Formatted_Time”记录（请参阅包的 Get_Time() 函数以获取指导），或者使 Main_Formatter() 在包规范中可见。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-18T18:14:40.403

通常我所做的是使用 Calendar.Split 然后在我关心的部分上做一个'图像。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2015-11-19T19:50:17.600

这是一个使用 GNAT.Calendar.Time_IO 包显示日期和时间的示例：

```
with ada.calendar;
with gnat.calendar.time_io;

procedure display_time is
begin
  gnat.calendar.time_io.put_time(ada.calendar.clock, "Date: %Y/%m/%d Time: %H:%M:%S");
end display_time; 
```

此处提供日期/时间格式选项： [https ://en.wikibooks.org/wiki/Ada_Programming/Libraries/GNAT.Calendar.Time_IO](https://en.wikibooks.org/wiki/Ada_Programming/Libraries/GNAT.Calendar.Time_IO "GNAT.Calendar.Time_IO 规范")

# asp.net-mvc - git 和 ASP MVC

> ID：639647
> 
> 赞同：17
> 
> 时间：2009-03-12T17:28:22.197
> 
> 标签：asp.net-mvc, git, gitignore

`git`有人知道用and建立新项目的好文章`ASP.NET MVC`吗？

只是想知道要包括`ignore`什么以及如何处理部署。

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2011-04-03T03:35:39.110

## 吉蒂诺尔

您询问了要忽略的内容——这是我用于 ASP.NET MVC 项目的默认 .gitignore：

```
###################
# compiled source #
###################
*.com
*.class
*.dll
*.exe
*.pdb
*.dll.config
*.cache
*.suo
# Include dlls if they’re in the NuGet packages directory
!/packages/*/lib/*.dll
!/packages/*/lib/*/*.dll
# Include dlls if they're in the CommonReferences directory
!*CommonReferences/*.dll
####################
# VS Upgrade stuff #
####################
UpgradeLog.XML
_UpgradeReport_Files/
###############
# Directories #
###############
bin/
obj/
TestResults/
###################
# Web publish log #
###################
*.Publish.xml
#############
# Resharper #
#############
/_ReSharper.*
*.ReSharper.*
############
# Packages #
############
# it’s better to unpack these files and commit the raw source
# git has its own built in compression methods
*.7z
*.dmg
*.gz
*.iso
*.jar
*.rar
*.tar
*.zip
######################
# Logs and databases #
######################
*.log
*.sqlite
# OS generated files #
######################
.DS_Store?
ehthumbs.db
Icon?
Thumbs.db 
```

## 建立一个新项目

对于设置新项目的帮助，我会安装[msysgit](http://code.google.com/p/msysgit/) ，因为您很可能在 Windows 上，并查看[learn.github](http://learn.github.com/p/setup.html)以了解如何开始使用 git。当然，大师 (Skeet)[建议你从控制台做大部分事情](https://stackoverflow.com/questions/507343/using-git-with-visual-studio/507369#507369)——我倾向于同意他的观点。恕我直言，Git 更容易。如果您想要方便的 git 参考，请查看[git 参考](http://gitref.org/)。

## 部署

正如其他人已经提到的那样——查看[AppHarbor](http://appharbor.com/)进行部署。这些人的目标是成为“ASP.NET 的 Heroku”。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-12T18:04:31.970

[今天在codebetter.com](http://codebetter.com)上有一篇很棒的帖子。它是关于 OSS 项目的，但我敢打赌它也适用于你，因为它描述了 GIT。

文章右侧是[Kyle 博客](http://kylecordes.com)的链接，尤其是[Windows 上的 Git 和 GitHub 入门](http://kylecordes.com/2008/04/30/git-windows-go/)。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2011-04-01T22:14:30.003

如果您已经在使用 git 和 ASP MVC，您还应该查看 AppHarbor [http://appharbor.com/](http://appharbor.com/)以进行部署和托管。它直接集成到您的工作流程中。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-14T04:16:24.440

更正链接

[http://codebetter.com/blogs/aaron.jensen/archive/2009/03/12/hosting-your-oss-project-on-github.aspx](http://codebetter.com/blogs/aaron.jensen/archive/2009/03/12/hosting-your-oss-project-on-github.aspx)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-07-26T09:02:57.537

我的超级简单：

```
*/packages/*
/packages/*
obj/
bin/
TestResults/
_ReSharper.*
*.csproj.user
*.resharper.user
*.resharper
*.suo
*.cache
*~
*.swp
*.resharper.user
*.rptproj.user
*.db
*.sdf
*.tmp 
```

有关 gitignore 文件的示例，请查看[github gitignore 示例](https://github.com/github/gitignore)和 Visual Studio [VisualStudio.gitignore示例](https://github.com/github/gitignore/blob/master/Global/VisualStudio.gitignore)

# winapi - 如何在 Win32 中将光标设置为拖动复制/移动光标？

> ID：639649
> 
> 赞同：1
> 
> 时间：2009-03-12T17:28:36.160
> 
> 标签：winapi, drag-and-drop, cursors

它似乎不是标准游标之一（如 IDC_ARROW），那么我该如何加载它呢？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-12T17:37:52.130

您需要将自定义光标作为资源添加到应用程序，获取资源句柄，然后使用 SetCursor(...)

拖动/复制/移动光标不是标准库的一部分 - 您的应用程序需要它自己的。标准游标都在这里列出：

[http://msdn.microsoft.com/en-us/library/ms648391(VS.85).aspx](http://msdn.microsoft.com/en-us/library/ms648391(VS.85).aspx)

话虽如此，IDC_HAND 确实存在于较新的操作系统上，这可能是您正在寻找的...

# wix - 如何在 Wix 中查找和删除注册表项

> ID：639665
> 
> 赞同：3
> 
> 时间：2009-03-12T17:32:51.050
> 
> 标签：wix, registry, wix3, visual-studio-addins

我正在尝试为 Visual Studio 加载项编写 Wix3 安装。

我就在那里，但我需要通过删除注册表项来重置插件。特别是任何以

```
HKCU\Software\Microsoft\VisualStudio\8.0\PreloadAddinStateManaged\MyAddinName.Connect; 
```

如何说服 Wix 删除任何此类条目？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-12T17:59:28.333

你需要使用`registry`元素。

*   [http://wix.sourceforge.net/manual-wix2/wix_xsd_registry.htm](http://wix.sourceforge.net/manual-wix2/wix_xsd_registry.htm)

这应该可以解决您遇到的问题。有一个很棒的[WiX 教程](http://www.tramontana.co.hu/wix/)和注册表在名为[Beyond Files](http://www.tramontana.co.hu/wix/lesson1.php#1.7)的章节中讨论。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-12T18:00:07.893

您的问题是否需要对注册表值进行部分匹配。如果没有，那么您可能正在寻找 RemoveRegistryValue 元素（嵌套在 Component 下）。如果是，那么我认为您可能需要创建一个自定义操作来搜索注册表值以删除并使用您找到的内容填充 RemoveRegistry 表。我认为 DTF（部署工具基金会）自定义操作是一个可行的选择。

# php - 如何将 PHP 应用程序限制在它们自己的目录和它们自己的 php.ini 中？

> ID：639666
> 
> 赞同：6
> 
> 时间：2009-03-12T17:32:56.180
> 
> 标签：php, apache, include, subdomain, server-side-includes

我在我的 Mac 上运行多个 PHP 应用程序，运行 OS X 10.5.6、Apache 2、PHP 5。我为每个项目设置了子域、每个子域的主机文件条目以及 Apache 配置中的虚拟目录块。所以

project1.localhost 转到 /Library/WebServer/Documents/Project1
project2.localhost 转到 /Library/WebServer/Documents/Project2
等...

但是，这种方法并没有真正“隔离”网络应用程序。例如，如果我包含这样的脚本：

```
<?php
include("/includes/include.php");
?> 
```

它从我的计算机的基本目录中引用脚本。所以它访问
C:/includes/include.php

有没有办法让我参考
C:/Library/WebServer/Documents/Project2/includes/include.php

基本上，让它不知道它自己的目录之外的任何东西。另外，有没有办法在每个子域的基础上使用 php.ini？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-12T21:14:32.933

我相信可以为每个虚拟主机设置一个 php.ini

```
<VirtualHost *:80>
    ...

    PHPINIDir /full/path/to/php/ini/

</VirtualHost> 
```

这样你可以自定义 open_basedir 和其他

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-12T19:31:52.730

[您可以通过将open_basedir](http://www.php.net/manual/en/ini.sect.safe-mode.php#ini.open-basedir)指令添加到 httpd.conf 文件中的文件夹块来限制脚本查看特定文件夹树上方的任何内容的能力。它应该看起来像：

> <目录/完整/路径/到/文件夹/包含/脚本/>
> 
> php_admin_value open_basedir "/full/path/to/top/folder/of/desired/tree/"
> 
> </目录>

一件事 - 如果你不以 / 结束路径，那么它就是通配符匹配。换句话说，“/var/etc/my”将匹配“/var/etc/myFolder”以及“/var/etc/myMothersFolder”，而“/var/etc/my/”将只匹配那个确切的文件夹姓名。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-12T21:05:34.017

关于应用程序隔离〜这是关于*保护*PHP 脚本以使它们无法访问其他脚本吗？请详细说明 -

关于 php.ini - 我不知道每个目录使用特定 php.ini 的任何方法，但您当然可以使用一堆 ini_set() 行创建一个 php 包含页面，也许是这样的..

```
<?php
  // in your header or along top of all php modules in your pap
  require_once ( '/path/to/includes/ini_set.php' );

  // ...

?> 
```

和 ini_set.php 脚本：

```
<?php
  // one of these for each override of defaults set in php.ini file --
  ini_set ( $varname, $newvalue );
  ini_set ( $varname, $newvalue );
  ini_set ( $varname, $newvalue );
?> 
```

如果您有兴趣了解有关 ini_set() 函数的更多信息，请访问 php.net 上的文档页面：http: [//us3.php.net/ini_set](http://us3.php.net/ini_set)

希望这有点帮助~

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-15T21:24:06.563

最好的方法是通过 FCGI (mod_fcgid) 使用 PHP。这样，您可以使用不同的用户和每个 vHost 的不同 php.ini 运行 PHP。

以下是如何在 Ubuntu 上设置此类配置的示例：http: [//www.howtoforge.com/how-to-set-up-apache2-with-mod_fcgid-and-php5-on-ubuntu-8.10](http://www.howtoforge.com/how-to-set-up-apache2-with-mod_fcgid-and-php5-on-ubuntu-8.10)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-12T19:29:05.667

如果要使用完整路径名，可以使用：

```
<?php
include  dirname( __FILE__ ) . '/includes/include.php';
?> 
```

* * *

[php.ini 文件的可能解决方案](http://forum.slicehost.com/comments.php?DiscussionID=3087)

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-03-12T18:00:38.813

尝试相对路径！像：

```
<?php
include("./includes/include.php");
?> 
```

或者

```
<?php
include("includes/include.php");
?> 
```

# synchronization - 保持测试和生产服务器环境清洁、同步和一致

> ID：639668
> 
> 赞同：16
> 
> 时间：2009-03-12T17:33:34.027
> 
> 标签：synchronization, production-environment, consistency, test-environments

我工作的公司似乎一直**在与客户的服务器环境**作斗争。

具体来说，我们几乎总是会遇到测试服务器和生产服务器的问题，而且它们似乎总是配置不同。当我们测试我们开发的应用程序时，测试服务器以一种方式运行，因此我们调整和配置我们的应用程序以适应该特定行为。但是当我们在生产服务器上安装相同的应用程序时，我们会观察到另一种与测试服务器不一致的行为，从而使我们的调整和配置变得毫无用处。最令人沮丧的是，这种情况一直在发生，而且似乎没有人知道该怎么做。

当然，我们对为什么会发生这种情况有一个大致的了解。每个克隆的环境开始时都是一样的，并且在前几天的工作方式相同，但迟早有人只在一个服务器环境中重新配置某些东西（无论是数据库更新、组件库更新、Web 文件更新，或其他配置），从而导致差异。随着时间的推移，越来越多的差异越来越大。但问题是：我们能做些什么呢？

我试过在网上搜索，但找不到任何关于该做什么的好答案。我也试图自己找出一些解决方案，但我的大多数想法似乎在某种程度上存在问题。新的套路，无论多么严格，都可以规避。定期克隆生产服务器以创建测试服务器是一个乏味且通常非常缓慢的过程。自动复制并不总是可靠的，甚至是不可能的。那么我们究竟应该如何解决这个问题呢？我们如何保证测试时的体验与上线时的体验相匹配？

我想其他人也有这个问题。还是他们？也许只是我的特定公司不称职？你们有没有遇到过这个问题？如果是这样，你做了什么？

真挚地，

Linus，瑞典系统开发人员

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-12T17:40:35.397

您需要开始跟踪您对测试环境所做的每一次更改，并提供一种将其传播到生产环境的方法。

**对于代码**，这意味着版本控制系统，例如 CVS、Subversion 或 GIT。

**对于数据库**，它意味着更新生产数据库的结构比较工具或部署脚本。

**对于配置**，两个系统应该完全相同，任何“调整”或更改都需要首先应用于测试服务器，然后在部署期间应用于生产服务器。

除非您有一个有效的流程，否则您将继续遇到问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-13T15:10:24.283

> 当然，我们对为什么会发生这种情况有一个大致的了解。每个克隆的环境开始时都是一样的，并且在前几天的工作方式相同，但迟早有人会在其中一个服务器环境中重新配置某些东西

我认为你很慷慨，或者你很幸运。通常情况下，需要外包开发工作的商店并不真正了解开发过程。如果他们为您提供了一个测试环境，您将获得的是他们上次服务器刷新之前的生产系统。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-06-01T23:05:53.217

为了使 MySQL 数据库保持同步，我刚刚遇到了这个工具：

[http://schemasync.org/](http://schemasync.org/)

我还没有真正使用它，所以我不能说它是否有好处，但我们需要一些方法来控制测试和产品之间的模式漂移，所以我们要试一试。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-12T17:37:42.020

您需要确保以一致的方式对环境进行任何更改。

我会考虑从新图像开始并执行严格的修改日志策略，或者使用 Capistrano 之类的东西在所有机器上执行远程命令并将代码同时部署到所有机器上。

理想情况下，所有需求都应该检查到您的版本控制系统中（按照 Rails 如何让您将 gem 存储在 /vendor 目录中并优先在运行时加载它们的方式），以及一个描述如何设置环境的自述文件（所需的库等）。任何对环境进行更改的人都需要严格更新自述文件。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-12T17:41:25.363

你的问题很正常。我知道至少有两种策略效果很好：

如果你在 linux 上分发，你可以从你的开发过程中构建 rpms/debs 并使用包管理功能。我知道很多项目在内部项目中都取得了巨大的成功。

另一种选择是将整个环境打包为某种 shell 脚本。这个 shell 脚本可以/应该使用所有设置来配置完整的环境。通常这个脚本是由开发人员维护的，这个脚本会覆盖手动进行的*任何*修改。像这样的脚本通常由开发人员维护，处于版本控制之下，并作为完整的发行版发送到部署。为此，我们使用 cygwin。通常，脚本会读取某种可能由操作管理的配置。我的脚本实际上是从头开始设置*整个系统，就好像安装在一台完全空白的、新安装的机器上一样。*

这两种策略最好都应该包括从构建脚本/构建系统一直自动生成这些工件。这个过程运行得越顺畅，对所有相关方都越好。

# c# - 在另一个线程上处理时图像失真

> ID：639669
> 
> 赞同：0
> 
> 时间：2009-03-12T17:33:35.727
> 
> 标签：c#, image-processing

我编写了一个小应用程序，用作沙箱，用于测试最终会在生产产品中出现的想法。这个想法很简单；使用 TrackBar 更改图像的整体亮度。因为这个过程需要相当长的时间，我需要在另一个线程中完成（除非你有更好的方法）。我不能使用 ColorMatrix 类，因为它允许颜色分量值溢出，而且我无法弄清楚如何将它们钳位在 255。无论如何，这是问题所在：

当我缓慢移动 TrackBar 时，一切正常。如果我在 GUI 线程上运行它，一切都会很好（延迟太多）。当我快速移动 TrackBar 时，图像会变形。水平条带出现在其上，好像图像是使用不同的比例因子处理的。

我不知道这是怎么回事，因为我正在使用基本位图绘制显示位图以获取颜色值，并且我认为我正在阻止操作从重新开始直到完成，但我对它的经验*很少*穿线。我被困在这一点上，所以你们可以提供的任何帮助将不胜感激。该项目如下（必须使用filefront，因为它对于论坛附件来说太大了）。

这是该项目的链接，整个程序可以在下面阅读。
[http://files.filefront.com/13453973](http://files.filefront.com/13453973)

```
public partial class Form1 : Form
{       
    public Form1( )
    {
        InitializeComponent( );
        testPBox1.Image = Properties.Resources.test;
        trackBar1.Value = 100;
        trackBar1.ValueChanged += trackBar1_ValueChanged;
    }     

    void trackBar1_ValueChanged( object sender, EventArgs e )
    {
        testPBox1.IntensityScale = (float) trackBar1.Value / 100;
    }
}

class TestPBox : Control
{
    private const int MIN_SAT_WARNING = 240;        
    private Bitmap m_srcBitmap;
    private Bitmap m_dispBitmap;
    private float m_scale;        
    BackgroundWorker worker;

    public TestPBox( )
    {
        this.DoubleBuffered = true;                        
        worker = new BackgroundWorker( );
        worker.DoWork += new DoWorkEventHandler( worker_DoWork );
        IntensityScale = 1.0f;
    }       

    public Bitmap Image
    {
        get
        {
            return m_dispBitmap;
        }
        set
        {
            if ( value != null )
            {
                m_srcBitmap = value;
                m_dispBitmap = (Bitmap) value.Clone( );
                Invalidate( );
                OnImageChanged( EventArgs.Empty );
            }
        }
    }

    [DefaultValue( 1.0f )]
    public float IntensityScale
    {
        get
        {
            return m_scale;
        }
        set
        {
            if ( value == 0.0 || m_scale == value )
            {
                return;
            }

            m_scale = value;
            if ( !this.DesignMode && StartImageProcThread( ) )
            {
                OnIntensityscaleChanged( EventArgs.Empty );
            }                
        }
    }

    private bool StartImageProcThread( )
    {                        
        if ( !worker.IsBusy )
        {                     
            worker.RunWorkerAsync( );
            return true;
        }

        return false;
    }

    private void worker_DoWork( object sender, DoWorkEventArgs e )
    {
        ChangeIntensity( );
    }

    private unsafe void ChangeIntensity( )
    {
        if ( Image != null )
        {                
            BitmapData srcData = m_srcBitmap.LockBits
                    ( new Rectangle( new Point( 0, 0 ), m_srcBitmap.Size ), ImageLockMode.ReadWrite, PixelFormat.Format32bppRgb );
            BitmapData dspData = m_dispBitmap.LockBits
                    ( new Rectangle( new Point( 0, 0 ), m_dispBitmap.Size ), ImageLockMode.ReadWrite, PixelFormat.Format32bppRgb );
            byte* pSrc = (byte*) srcData.Scan0;
            byte* pDsp = (byte*) dspData.Scan0;

            for ( int y = 0; y < m_dispBitmap.Height; ++y )
            {
                for ( int x = 0; x < m_dispBitmap.Width; ++x )
                {
                    // we are dealing with a monochrome image, so r = g = b.
                    // We only need to get one value to use for all r, g, and b.
                    byte b = (byte) CompMinMax( 0, 255, (int) ( pSrc[0] * m_scale ) );
                    Color c = ( b > MIN_SAT_WARNING ) ? Color.FromArgb( b, Color.Red ) : Color.FromArgb( 255, b, b, b );

                    pDsp[3] = (byte) c.A;
                    pDsp[2] = (byte) c.R;
                    pDsp[1] = (byte) c.G;
                    pDsp[0] = (byte) c.B;

                    pSrc += 4;
                    pDsp += 4;
                }
            }

            m_srcBitmap.UnlockBits( srcData );
            m_dispBitmap.UnlockBits( dspData );
            this.Invalidate( );           
        }
    }

    private int CompMinMax( int min, int max, int value )
    {
        if ( value > max ) return max;
        if ( value < min ) return min;
        return value;
    }

    protected override void OnPaint( PaintEventArgs e )
    {
        if ( Image != null )
        {               
            Graphics g = e.Graphics;
            Rectangle drawingRect = PaintUtils.CenterInRect( ClientRectangle, PaintUtils.ScaleRect( ClientRectangle, Image.Size ).Size );
            g.DrawImage( Image, drawingRect, 0, 0, Image.Width, Image.Height, GraphicsUnit.Pixel );         
        }

        base.OnPaint( e );
    } 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-12T17:39:45.277

在我看来，您可以在运行过程`m_scale`中更改 的值`ChangeIntensity`。

```
 // ...
    m_scale = value; 
    if ( !this.DesignMode && StartImageProcThread( ) )
    {
        OnIntensityscaleChanged( EventArgs.Empty );
    }  

    // ...
    private bool StartImageProcThread( )
    {                        
        if ( !worker.IsBusy )
        {                     
            worker.RunWorkerAsync( );
            return true;
        }

        return false;
    } 
```

如果您的工作人员正在进行处理，则它用于缩放的值会发生变化，并且仅适用于仍需处理的像素。

# iphone - 如何在导航栏中使用与普通按钮相同的样式创建带有 UIActivityIndi cator 的按钮？

> ID：639672
> 
> 赞同：11
> 
> 时间：2009-03-12T17:33:53.620
> 
> 标签：iphone, objective-c, cocoa-touch

我在这里和其他网站上看到的所有示例都涉及创建 UIActivityIndi​​catorView 并使用以下内容加载它：

```
self.navigationItem.rightBarButtonItem = [[[UIBarButtonItem alloc] 
                   initWithCustomView:myActivityIndicatorView 
                   target:nil 
                   action:nil] 
                  autorelease]; 
```

但是，这只会在导航栏中创建一个简单的活动指示器。我想要做的是有一个按钮，看起来就像普通的 UIBarButtonSystemItem 按钮，但有一个活动指示器而不是默认图像之一。我试过用 nil 图像或标题做 initWithImage 和 initWithTitle ，然后将活动指示器添加为子视图，但这不起作用。

有任何想法吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2010-03-09T06:26:19.080

我的解决方案是创建 UIButton 的子类：

在*SOActivityButton.h*中：

```
@interface SOActivityButton : UIButton 
{
UIActivityIndicatorView* activityIndicator;
}
@end 
```

在*SOActivityButton.m*中：

```
@implementation SOActivityButton

- (id)initWithFrame:(CGRect)frame 
{
    if (self = [super initWithFrame:frame]) 
    {
        CGRect innerFrame = CGRectInset(frame, 8.0f, 8.0f);
        activityIndicator = [[UIActivityIndicatorView alloc]
                                    initWithFrame:innerFrame];
        activityIndicator.activityIndicatorViewStyle = UIActivityIndicatorViewStyleWhite;
        [self addSubview:activityIndicator];
    }
    return self;
}

- (void)dealloc 
{
    [activityIndicator release], activityIndicator = nil;
    [super dealloc];
}

- (void) startAnimating
{   
    [activityIndicator startAnimating];
}

- (void) stopAnimating
{   
    [activityIndicator stopAnimating];
}
@end 
```

然后使用它：

```
SOActivityButton* activityButton = [[SOActivityButton alloc] 
                    initWithFrame:CGRectMake(0.0f, 0.0f, 32.0f, 32.0f)];
[activityButton setImage:[UIImage imageNamed:@"button-background.png"]
                    forState:UIControlStateNormal];
[activityButton addTarget:self action:@selector(myAction:) 
                    forControlEvents:UIControlEventTouchUpInside];
UIBarButtonItem *activityBarButtonItem = [[UIBarButtonItem alloc] 
                    initWithCustomView:activityButton];
[activityButton release];
self.navigationItem.rightBarButtonItem = activityBarButtonItem;
[activityBarButtonItem release]; 
```

您将需要找到或创建一个*button-background.png*。[这里](http://www.teehanlax.com/blog/2009/06/18/iphone-gui-psd-30/)的PSD应该有一个。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-12T19:12:35.210

您是否尝试过在按钮栏中创建一个 UIButton，然后添加一个活动指示器作为 UIButton 的子视图？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-29T04:41:16.910

我有这个工作，它很简单。只需使用 IB 将活动指示器放在您想要的位置，但确保它在列表中低于您想要的栏，并且位于“顶级”（不是其他任何东西的子视图）。然后通过插座在代码中控制它。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-08-21T15:45:30.360

这里有一些可以提供帮助的东西：

```
activityIndicator = [[UIActivityIndicatorView alloc] initWithFrame:CGRectMake(0, 0, 20, 20)];
[activityIndicator startAnimating];
UIBarButtonItem *activityItem = [[UIBarButtonItem alloc] initWithCustomView:activityIndicator];
[activityIndicator release];
self.navigationItem.rightBarButtonItem = activityItem;
[activityItem release];
[activityIndicator startAnimating]; 
```

# c++ - 在 C++ 中重载全局运算符 new/delete

> ID：639676
> 
> 赞同：8
> 
> 时间：2009-03-12T17:34:38.890
> 
> 标签：c++, operator-overloading

我正在尝试为性能敏感的应用程序重载全局运算符 new 和 delete。我已阅读[http://www.informit.com/articles/article.aspx?p=30642&seqNum=3](http://www.informit.com/articles/article.aspx?p=30642&seqNum=3)中描述的问题以及使用英特尔 TBB 分配器的建议[http://www.intel.com/technology/itj/ 2007/v11i4/5-foundations/5-memory.htm](http://www.intel.com/technology/itj/2007/v11i4/5-foundations/5-memory.htm)

由于我是第一次重载 new 和 delete，所以我有几个问题。

我是否应该在所有包含“新”调用的文件中包含包含重载新函数的新标头 Allocator.h（或 Pre.h）？这很乏味。

或者我应该在每个翻译单元中使用包含 Allocator.h（之前）的“gcc -include Allocator.h ...”吗？我想尽可能地保持代码平台独立。所有编译器都支持类似于“gcc -include”的东西吗？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-03-12T17:40:22.607

如果你想重载全局`operator new`and `operator delete`，你只需要实现它。您不需要在任何地方明确定义它，因为它已经被定义为语言的一部分。

编辑：如果你想定义一个带有不同参数的操作符 new，那么你需要在任何地方 #include 它。不管你怎么做，这取决于你；这主要是风格问题。

并且不要忘记实现全局运算符 new 和 delete: `new`、`new[]`、`delete`、`delete[]`和`std::nothrow`变体的所有变体。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-12T17:41:03.027

如果您使用的是 Visual Studio 并使用预编译的头文件，那么您可以将包含放入其中。我认为 gcc 也有某种形式的预编译头文件，这也会缩短你的编译时间。

# php - PHP 的 mcrypt_decrypt() 需要什么？

> ID：639680
> 
> 赞同：5
> 
> 时间：2009-03-12T17:36:14.380
> 
> 标签：php, mcrypt

我有一个使用 mcrypt_decrypt() 函数的脚本，但出现以下错误

> 致命错误：调用未定义函数 mcrypt_decrypt()

我需要包含哪些模块/库才能使用此功能？还是我收到错误的另一个原因？

谢谢

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2010-02-03T17:22:42.137

sudo apt-get install php5-mcrypt

在 ubuntu 上工作。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-12T17:39:08.770

请参见：

*   [Mcrypt 要求](http://de.php.net/manual/en/mcrypt.requirements.php)
*   [Mcrypt 安装](http://de.php.net/manual/en/mcrypt.installation.php)

您需要使用`--with-mcrypt[=DIR]`libmcrypt 版本 2.5.6 或更高版本编译 PHP 并在您的机器上安装。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2015-05-27T10:02:11.270

使用 php5-fpm (Ubuntu 14.04) 配置 php5-mcrypt

我假设您已经安装并运行了 nginx 和 php-fpm。

php5-mcrypt 应该已经安装（它与 php5-fpm 捆绑在一起）。只是为了安全，apt-get install php5-mcrypt

创建指向 mods-available 的符号链接，ln -s /etc/php5/conf.d/mcrypt.ini /etc/php5/mods-available/mcrypt.ini

启用它。php5enmod mcrypt

重启php-fpm，服务php5-fpm重启

重启nginx，服务nginx重启

完毕！

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-12T17:38:15.170

从[手册](http://us.php.net/manual/en/mcrypt.installation.php)：

> 您需要使用 --with-mcrypt[=DIR] 参数编译 PHP 以启用此扩展。DIR 是 mcrypt 安装目录。确保使用选项 --disable-posix-threads 编译 libmcrypt。

通常如果 PHP 说一个函数是未定义的，这意味着你需要在某个库中编译。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-08-22T10:16:44.070

我上面的不起作用，你可以试试这个：

在 /etc/php5/conf.d 中创建带有内容的 mcrypt.ini 文件

```
extension=mcrypt.so 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-08-24T08:22:29.400

[我通过http://php-osx.liip.ch/](http://php-osx.liip.ch/)将 PHP 升级到 5.4 ，它工作正常。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-01-31T09:29:40.703

对于 php 5.3.X

取决于 yum mcrypt 包的可用性，您可以使用 yum 包

像这样： yum install php53-mcrypt 并重新启动 httpd

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2014-03-22T21:33:13.587

并注意 phpinfo 页面中的文件夹：“扫描此目录以获取其他 .ini 文件”和下一个：“已解析的其他 .ini 文件”。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2014-05-09T15:24:23.757

升级到 php 5.4 运行后（Works）

```
sudo php5enmod mcrypt
sudo service apache2 restart 
```

# xml - 基于不同值的枚举值 XSLT 2.0

> ID：639690
> 
> 赞同：4
> 
> 时间：2009-03-12T17:38:03.237
> 
> 标签：xml, xslt, xslt-2.0

我有一长串带有命名标识符的 XML 值。我需要为每个组合在一起并唯一命名的不同标识符制作单独的输出文件。

因此，例如，假设我有：

```
<List>
   <Item group="::this_long_and_complicated_group_name_that_cannot_be_a_filename::">
      Hello World!
   </Item>
   <Item group="::this_other_long_and_complicated_group_name_that_cannot_be_a_filename::">
      Goodbye World!
   </Item>
   <Item group="::this_long_and_complicated_group_name_that_cannot_be_a_filename::">
      This example text should be in the first file
   </Item>
   <Item group="::this_other_long_and_complicated_group_name_that_cannot_be_a_filename::">
      This example text should be in the second file
   </Item>
   <Item group="::this_long_and_complicated_group_name_that_cannot_be_a_filename::">
      Hello World!
   </Item>
</List> 
```

如何编写转换 (XSLT 2.0) 以将这些分组输出为生成的文件名并具有唯一值？例如：将第一个映射`@group`到 file1.xml，第二个映射`@group`到 file2.xml

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-12T19:07:10.680

**这是一个使用 XSLT 2.0 中一些好的新特性的解决方案：**

***这种转变***：

```
<xsl:stylesheet version="2.0"
    xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
    xmlns:xs="http://www.w3.org/2001/XMLSchema">
    <xsl:output omit-xml-declaration="yes" indent="yes"/>
      <!--                                                  --> 
    <xsl:template match="/*">
      <xsl:variable name="vTop" select="."/>
      <!--                                                  --> 
        <xsl:for-each-group select="Item" group-by="@group">
          <xsl:result-document href="file:///C:/Temp/file{position()}.xml">
            <xsl:element name="{name($vTop)}">
              <xsl:copy-of select="current-group()"/>
            </xsl:element>
          </xsl:result-document>
        </xsl:for-each-group>
    </xsl:template>
</xsl:stylesheet> 
```

**当应用于 OP 提供的 Xml 文档时（更正为格式正确！）：**

```
<List>
    <Item group="::this_long_and_complicated_group_name_that_cannot_be_a_filename::">
         Hello World!
    </Item>
    <Item group="::this_other_long_and_complicated_group_name_that_cannot_be_a_filename::">
          Goodbye World!
  </Item>
    <Item group="::this_long_and_complicated_group_name_that_cannot_be_a_filename::">
          This example text should be in the first file
 </Item>
    <Item group="::this_other_long_and_complicated_group_name_that_cannot_be_a_filename::">
          This example text should be in the second file
 </Item>
    <Item group="::this_long_and_complicated_group_name_that_cannot_be_a_filename::">
          Hello World!
  </Item>
</List> 
```

**产生想要的两个文件**：*file1.xml 和 file2.xml*

# c++ - C++ 静态代码分析工具值得吗？

> ID：639694
> 
> 赞同：31
> 
> 时间：2009-03-12T17:38:23.907
> 
> 标签：c++, static-analysis

我们的管理层最近一直在与一些销售 C++[静态分析工具](http://en.wikipedia.org/wiki/List_of_tools_for_static_code_analysis)的人交谈。当然，销售人员说他们会发现很多错误，但我对此表示怀疑。

这些工具在现实世界中如何工作？他们能找到真正的错误吗？它们是否帮助更多初级程序员学习？

他们值得麻烦吗？

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-03-12T18:19:03.747

静态代码分析几乎总是值得的。现有代码库的问题是它可能会报告太多错误，使其开箱即用。

我曾经参与过一个项目，该项目有 100,000 多个来自编译器的警告......在该代码库上运行 Lint 工具毫无意义。

“正确”使用 Lint 工具意味着购买更好的流程（这是一件好事）。我做过的最好的工作之一是在一个研究实验室工作，在那里我们不允许签入带有警告的代码。

所以，是的，这些工具是值得的……从长远来看。在短期内将你的编译器警告调到最大，看看它报告了什么。如果代码是“干净的”，那么现在是时候查看 lint 工具了。如果代码有很多警告...优先考虑并修复它们。一旦代码没有（或至少很少）警告，然后查看 Lint 工具。

所以，Lint 工具不会帮助糟糕的代码库，但是一旦你拥有了一个好的代码库，它就可以帮助你保持良好的状态。

编辑：

以 100,000+ 个警告产品为例，它被分解为大约 60 个 Visual Studio 项目。由于每个项目都删除了所有警告，因此它已更改为警告是错误，这会阻止将新警告添加到已清理的项目中（或者更确切地说，它让我的同事对任何签入的开发人员大吼大叫无需先编译的代码:-)

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-03-30T19:29:20.320

根据我与几个雇主的经验，C/C++ 的 Coverity Prevent 绝对是值得的，即使在优秀的开发人员的代码中也能发现一些错误，而在最差的开发人员的代码中也会发现很多错误。其他人已经涵盖了技术方面，所以我将专注于政治困难。

首先，代码最需要静态分析的开发人员，最不可能主动使用它。所以恐怕你需要强大的管理支持，无论是在实践中还是在理论上；否则它可能最终只是一个清单项目，产生令人印象深刻的指标而实际上没有修复错误。任何静态分析工具都会产生误报；您可能需要派人来尽量减少他们的烦恼，例如，通过对缺陷进行分类、确定检查程序的优先级以及调整设置。（商业工具应该非常擅长从不多次显示误报；仅此一项可能就值得付出代价。）即使是真正的缺陷也可能会产生烦恼；我对此的建议是不要担心，例如，签入评论抱怨明显具有破坏性的错误是“次要的。

我最大的一条建议是我的第一定律的推论，上面：首先采取廉价的措施，然后看看你最糟糕的开发人员的痛苦明显的错误。其中一些甚至可能已经被编译器警告发现，但是很多错误可能会从这些裂缝中溜走，例如，当它们被命令行选项抑制时。真正明显的错误可能在政治上很有用，例如，最有趣的十大缺陷列表，如果小心使用，可以很好地集中注意力。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-05-31T11:11:49.720

正如一些人所说，如果您在大多数应用程序上全速运行静态分析工具，您会收到很多警告，其中一些可能是误报，或者可能不会导致可利用的缺陷。正是这种经验导致人们认为这些类型的工具很吵，而且可能是在浪费时间。但是，有些警告会突出显示可能导致安全性、可靠性或正确性问题的真实且潜在危险的缺陷，并且对于许多团队而言，这些问题对于修复很重要，并且可能几乎不可能通过测试发现。

也就是说，静态分析工具非常有用，但将它们应用到现有代码库需要一点策略。这里有一些提示可能对您有所帮助。

1）不要一次打开所有东西，决定一组初始缺陷，打开这些分析并在你的代码库中修复它们。

2) 当您解决一类缺陷时，帮助您的整个开发团队了解缺陷是什么、为什么它很重要以及如何编写代码来防御该缺陷。

3) 努力彻底清除代码库中的此类缺陷。

4）一旦此类问题得到解决，引入一种机制以保持零问题状态。幸运的是，如果您处于基线没有错误，确保您没有重新引入错误要容易得多。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-03-12T17:45:20.863

它确实有帮助。我建议您使用试用版并通过您认为被忽略的代码库的一部分运行它。这些工具会产生很多误报。一旦你涉水过这些，你可能会发现一个或两个缓冲区溢出，可以在不久的将来节省很多悲伤。此外，尝试至少两个/三个品种（以及一些开源的东西）。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-03-12T18:36:58.383

您可能必须处理大量误报，尤其是在您的代码库很大的情况下。

大多数静态分析工具使用“过程内分析”工作，这意味着它们单独考虑每个过程，而不是考虑整个程序的“整个程序分析”。

他们通常使用“程序内”分析，因为“整个程序分析”必须考虑通过程序的许多路径，这些路径实际上不会在实践中发生，因此通常会产生误报结果。

程序内分析通过只关注单个程序来消除这些问题。然而，为了工作，它们通常需要引入一种“注释语言”，用于描述过程参数、返回类型和对象字段的元数据。对于 C++，这些东西通常是通过你用来装饰东西的宏来实现的。然后注释描述了诸如“这个字段永远不会为空”、“这个字符串缓冲区由这个整数值保护”、“这个字段只能被标记为'background'的线程访问”等内容。

然后，分析工具将获取您提供的注释并验证您编写的代码实际上是否符合注释。例如，如果您可能将 null 传递给标记为非 null 的内容，它将标记错误。

在没有注释的情况下，该工具需要假设最坏的情况，因此会报告很多并非真正错误的错误。

由于您似乎还没有使用这样的工具，因此您应该假设您将不得不花费大量时间注释您的代码以消除最初报告的所有误报。我最初会运行该工具，并计算错误的数量。这应该让您估计在您的代码库中采用它需要多长时间。

该工具是否值得取决于您的组织。你最常咬的虫子有哪些？它们是缓冲区溢出错误吗？它们是空解引用还是内存泄漏错误？他们是线程问题吗？他们是“哎呀，我们没有考虑这种情况”，还是“我们没有测试在立陶宛版本的 Windows 98 上运行的我们产品的中文版本？”。

一旦你弄清楚问题是什么，那么你应该知道它是否值得付出努力。

该工具可能有助于解决缓冲区溢出、null 取消引用和内存泄漏错误。如果它支持“线程着色”、“效果”或“权限”分析，它可能有助于解决线程错误。然而，这些类型的分析是非常先进的，并且有巨大的符号负担，所以它们确实需要一些费用。该工具可能无法解决任何其他类型的错误。

因此，这实际上取决于您编写的软件类型以及您最常遇到的错误类型。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-03-12T17:43:38.213

我用过它们——例如 PC-Lint，它们确实找到了一些东西。通常它们是可配置的，如果您确定 xyz 确实不是问题，您可以告诉他们“不要再为 xyz 打扰我”。

我不知道它们帮助初级程序员学到了很多东西，但它们可以作为一种机制来帮助收紧代码。

我发现第二组（怀疑的，探索错误的）眼睛和单元测试通常是我看到更多错误捕获发生的地方。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-03-12T17:55:22.960

这些工具确实有帮助。lint 一直是 C 开发人员的绝佳工具。

但我的一个反对意见是，它们是在您编写了大量代码并可能生成大量消息之后运行的批处理过程。

我认为更好的方法是将这样的东西构建到您的 IDE 中，并在您编写它时让它指出问题，以便您可以立即纠正它。不要让这些问题首先进入代码库。

这就是 Java 的 FindBugs 静态分析工具和 IntelliJ 的 Inspector 之间的区别。我非常喜欢后者。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-03-13T10:00:13.047

如果您使用正确的工具，我认为静态代码分析非常值得。最近，我们尝试了 Coverity Tool（有点贵）。它太棒了，它带来了许多严重的缺陷，这些缺陷是 lint 或 purify 无法检测到的。

我们还发现，如果我们早先使用覆盖率，我们可以避免 35% 的客户现场缺陷。

现在，Coverity 在我的公司推出，当我们在旧软件版本中获得客户 TR 时，我们会针对它运行 Coverity，以便在我们开始对 susbsytem 进行分析之前找出可能的故障候选者。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-05-19T03:37:50.600

与所有事情一样，答案取决于......如果您是为您的祖母开发针织图案漂亮打印机的唯一开发人员，您可能不想购买任何静态分析工具。如果您有一个中等规模的软件项目，该项目将涉及一些重要的事情，而且您的日程安排可能很紧，那么您现在可能想要投资一点，以便以后节省更多。

我最近写了一篇关于此的一般咆哮：[http ://www.redlizards.com/blog/?p=29](http://www.redlizards.com/blog/?p=29)

我应该在时间允许的情况下尽快写第二部分，但总的来说，粗略计算一下是否值得：

*   调试花了多少时间？
*   绑定了多少资源？
*   通过静态分析可以找到多少百分比？
*   工具设置成本？
*   购买价格？
*   内心的平静？:-)

我个人的看法也是：

*   尽早进行静态分析

    *   项目初期
    *   在开发周期的早期
    *   早在很早的时候（在夜间构建和后续测试之前）
*   为开发者提供自己使用静态分析的能力

    *   没有人喜欢被测试工程师或一些匿名工具告诉他们昨天做错了什么
    *   更少的调试让开发人员高兴:-)
    *   提供了一种很好的方式来了解（微妙的）陷阱而不会尴尬

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-03-12T18:16:31.380

我想这在很大程度上取决于您的编程风格。如果您主要编写 C 代码（偶尔使用 C++ 功能），那么这些工具可能会有所帮助（例如内存管理、缓冲区溢出……）。但是，如果您使用的是更复杂的 C++ 功能，那么在尝试解析源代码时这些工具可能会感到困惑（或者只是找不到很多问题，因为 C++ 工具通常使用起来更安全）。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2012-01-26T07:27:13.320

这个相当惊人的结果是使用 Elsa 和 Oink 完成的。

[http://www.cs.berkeley.edu/~daw/papers/fmtstr-plas07.pdf](http://www.cs.berkeley.edu/~daw/papers/fmtstr-plas07.pdf)

“Debian Linux 中格式字符串漏洞的大规模分析”，作者：Karl Chen、David Wagner，加州大学伯克利分校，{quarl, daw}@cs.berkeley.edu

抽象的：

格式字符串漏洞是一种比较常见的安全漏洞，可导致任意代码执行。与其他人合作，我们设计并实现了一个系统，以消除整个 Linux 发行版中的格式字符串漏洞，使用类型限定符推断，一种可以发现污染违规的静态分析技术。我们成功分析了 Debian 3.1 Linux 发行版中 66% 的 C/C++ 源代码包。我们的系统发现了 1,533 个格式字符串污染警告。我们估计其中 85% 是真阳性，即真正的错误；忽略来自库的重复项，大约 75% 是真正的错误。我们建议存在该技术以在不久的将来消除格式字符串漏洞。

类别和主题描述符 D.4.6 [操作系统]：安全和保护——侵入性软件；一般条款：安全性、语言；关键词：格式字符串漏洞，大规模分析，类型限定符推断

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2009-03-12T17:41:46.097

当有一些非常优质的免费工具时，可能不需要为大多数静态分析工具付费（除非您需要商业版本提供的一些非常特殊或特定的功能）。例如，请参阅我在另一个关于[cppcheck](https://stackoverflow.com/questions/632057/c-c-free-alternative-to-lint/632085#632085)的问题上给出的答案。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-03-12T18:21:26.203

发现真正错误的静态分析是值得的，无论它是否是 C++。有些往往很吵，但如果他们能捕捉到细微的错误，比如有符号/无符号比较导致优化破坏你的代码或越界数组访问，他们绝对值得付出努力。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2011-04-26T12:09:33.180

在前雇主，我们有 Insure++。它有助于查明 Valgrind 找不到的随机行为（使用未初始化的东西）。但最重要的是：它有助于消除尚未被称为错误的错误。

Insure++ 很好，但价格昂贵，这就是我们只购买一个用户许可证的原因。

# math - 如何将纬度或经度转换为米？

> ID：639695
> 
> 赞同：157
> 
> 时间：2009-03-12T17:38:44.047
> 
> 标签：math, geolocation, geo

如果我有标准 NMEA 格式的纬度或经度读数，是否有一种简单的方法/公式可以将该读数转换为米，然后我可以在 Java (J9) 中实现？

编辑：好吧，看来我想做的事情不*容易*，但我真正想做的是：

假设我有一个经纬度的路点和一个用户的经度和经度，有没有一种简单的方法可以比较它们以决定何时告诉用户他们在距离路点*相当*近的距离内？我意识到合理是主题，但这很容易做到还是仍然过于数学？

* * *

## 回答 #1

> 赞同：213
> 
> 时间：2012-06-23T20:20:08.947

这是一个javascript函数：

```
function measure(lat1, lon1, lat2, lon2){  // generally used geo measurement function
    var R = 6378.137; // Radius of earth in KM
    var dLat = lat2 * Math.PI / 180 - lat1 * Math.PI / 180;
    var dLon = lon2 * Math.PI / 180 - lon1 * Math.PI / 180;
    var a = Math.sin(dLat/2) * Math.sin(dLat/2) +
    Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
    Math.sin(dLon/2) * Math.sin(dLon/2);
    var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
    var d = R * c;
    return d * 1000; // meters
} 
```

说明：[https ://en.wikipedia.org/wiki/Haversine_formula](https://en.wikipedia.org/wiki/Haversine_formula)

> 在给定经度和纬度的情况下，Haversine 公式确定球体上两点之间的大圆距离。

* * *

## 回答 #2

> 赞同：85
> 
> 时间：2016-09-16T21:29:20.653

假设您正在寻找一个简单的公式，这可能是最简单的方法，假设地球是一个周长为 40075 公里的球体。

纬度 1° 的长度以米为单位 = 始终为 111.32 公里

1° 经度的米长度 = 40075 公里 * cos( 纬度 ) / 360

* * *

## 回答 #3

> 赞同：35
> 
> 时间：2013-10-14T08:46:12.107

为了近似两个坐标之间的短距离，我使用了来自 [http://en.wikipedia.org/wiki/Lat-lon](http://en.wikipedia.org/wiki/Lat-lon)的公式：

```
m_per_deg_lat = 111132.954 - 559.822 * cos( 2 * latMid ) + 1.175 * cos( 4 * latMid);
m_per_deg_lon = 111132.954 * cos ( latMid ); 
```

.

在下面的代码中，我留下了原始数字以显示它们与维基百科公式的关系。

```
double latMid, m_per_deg_lat, m_per_deg_lon, deltaLat, deltaLon,dist_m;

latMid = (Lat1+Lat2 )/2.0;  // or just use Lat1 for slightly less accurate estimate

m_per_deg_lat = 111132.954 - 559.822 * cos( 2.0 * latMid ) + 1.175 * cos( 4.0 * latMid);
m_per_deg_lon = (3.14159265359/180 ) * 6367449 * cos ( latMid );

deltaLat = fabs(Lat1 - Lat2);
deltaLon = fabs(Lon1 - Lon2);

dist_m = sqrt (  pow( deltaLat * m_per_deg_lat,2) + pow( deltaLon * m_per_deg_lon , 2) ); 
```

维基百科条目指出，距离计算在纵向 100 公里的距离计算在 0.6 米以内，在纬向的 100 公里的距离计算在 1 厘米以内，但我没有验证这一点，因为接近该精度的任何地方都适合我使用。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2015-02-06T18:07:06.800

这是[bh- 函数](https://stackoverflow.com/a/11172685/1086511)的 R 版本，以防万一：

```
measure <- function(lon1,lat1,lon2,lat2) {
    R <- 6378.137                                # radius of earth in Km
    dLat <- (lat2-lat1)*pi/180
    dLon <- (lon2-lon1)*pi/180
    a <- sin((dLat/2))^2 + cos(lat1*pi/180)*cos(lat2*pi/180)*(sin(dLon/2))^2
    c <- 2 * atan2(sqrt(a), sqrt(1-a))
    d <- R * c
    return (d * 1000)                            # distance in meters
} 
```

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2009-03-12T17:59:40.483

有许多工具可以使这变得简单。有关所涉及内容的更多详细信息，请参阅[monjardin 的答案](https://stackoverflow.com/questions/639695/how-to-convert-latitude-or-longitude-to-meters/639711#639711)。

但是，这样做并不一定很困难。听起来您正在使用 Java，所以我建议您研究一下[GDAL](http://www.gdal.org)之类的东西。它为其例程提供了 java 包装器，并且它们具有从 Lat/Lon（地理坐标）转换为 UTM（投影坐标系）或其他一些合理的地图投影所需的所有工具。

UTM 很好，因为它是米，很容易使用。但是，您需要获得适当的[UTM 区域](http://www.dmap.co.uk/utmworld.htm)才能做好工作。通过谷歌搜索可以找到一些简单的代码，以找到适合纬度/经度对的区域。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2009-03-12T18:59:45.787

地球是一个令人讨厌的不规则表面，因此没有简单的公式可以准确地做到这一点。您必须使用地球的近似模型，并将您的坐标投影到它上面。我通常看到用于此的模型是[WGS 84](http://en.wikipedia.org/wiki/World_Geodetic_System)。这就是 GPS 设备通常用来解决完全相同的问题的方法。

[NOAA 有一些软件，您可以在他们的网站上](http://www.ngs.noaa.gov/PC_PROD/pc_prod.shtml)下载以帮助解决此问题。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-03-12T17:42:37.733

一海里（1852 米）定义为赤道经度的[一角分。](http://en.wikipedia.org/wiki/Arc_second)但是，您需要定义一个[地图投影](http://en.wikipedia.org/wiki/Map_projection)（另请参阅[UTM](http://en.wikipedia.org/wiki/Universal_Transverse_Mercator_coordinate_system)），您在其中工作以使转换真正有意义。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-03-12T18:34:02.087

有很多方法可以计算这个。他们都使用球面三角法的近似值，其中半径是地球之一。

尝试[http://www.movable-type.co.uk/scripts/latlong.html](http://www.movable-type.co.uk/scripts/latlong.html)了解一些不同语言的方法和代码。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-03-12T18:01:44.800

```
 'below is from
'http://www.zipcodeworld.com/samples/distance.vbnet.html
Public Function distance(ByVal lat1 As Double, ByVal lon1 As Double, _
                         ByVal lat2 As Double, ByVal lon2 As Double, _
                         Optional ByVal unit As Char = "M"c) As Double
    Dim theta As Double = lon1 - lon2
    Dim dist As Double = Math.Sin(deg2rad(lat1)) * Math.Sin(deg2rad(lat2)) + _
                            Math.Cos(deg2rad(lat1)) * Math.Cos(deg2rad(lat2)) * _
                            Math.Cos(deg2rad(theta))
    dist = Math.Acos(dist)
    dist = rad2deg(dist)
    dist = dist * 60 * 1.1515
    If unit = "K" Then
        dist = dist * 1.609344
    ElseIf unit = "N" Then
        dist = dist * 0.8684
    End If
    Return dist
End Function
Public Function Haversine(ByVal lat1 As Double, ByVal lon1 As Double, _
                         ByVal lat2 As Double, ByVal lon2 As Double, _
                         Optional ByVal unit As Char = "M"c) As Double
    Dim R As Double = 6371 'earth radius in km
    Dim dLat As Double
    Dim dLon As Double
    Dim a As Double
    Dim c As Double
    Dim d As Double
    dLat = deg2rad(lat2 - lat1)
    dLon = deg2rad((lon2 - lon1))
    a = Math.Sin(dLat / 2) * Math.Sin(dLat / 2) + Math.Cos(deg2rad(lat1)) * _
            Math.Cos(deg2rad(lat2)) * Math.Sin(dLon / 2) * Math.Sin(dLon / 2)
    c = 2 * Math.Atan2(Math.Sqrt(a), Math.Sqrt(1 - a))
    d = R * c
    Select Case unit.ToString.ToUpper
        Case "M"c
            d = d * 0.62137119
        Case "N"c
            d = d * 0.5399568
    End Select
    Return d
End Function
Private Function deg2rad(ByVal deg As Double) As Double
    Return (deg * Math.PI / 180.0)
End Function
Private Function rad2deg(ByVal rad As Double) As Double
    Return rad / Math.PI * 180.0
End Function 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2013-03-02T06:12:09.917

要在 x 和 y 表示中转换纬度和经度，您需要决定使用哪种类型的地图投影。至于我，椭圆墨卡托似乎很好。[在这里](http://wiki.openstreetmap.org/wiki/Mercator)你可以找到一个实现（也用 Java）。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2021-04-19T12:14:46.253

这是一个MySQL函数：

```
SET @radius_of_earth = 6378.137; -- In kilometers

DROP FUNCTION IF EXISTS Measure;
DELIMITER //
CREATE FUNCTION Measure (lat1 REAL, lon1 REAL, lat2 REAL, lon2 REAL) RETURNS REAL
BEGIN
-- Multiply by 1000 to convert millimeters to meters
RETURN 2 * @radius_of_earth * 1000 * ASIN(SQRT(
    POW(SIN((lat2 - lat1) / 2 * PI() / 180), 2) +
    COS(lat1 * PI() / 180) *
    COS(lat2 * PI() / 180) *
    POW(SIN((lon2 - lon1) / 2 * PI() / 180), 2)
));
END; //
DELIMITER ; 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2010-04-16T10:11:14.910

如果它足够接近，您可以将它们视为平面上的坐标。如果不需要完美的准确度，这适用于街道或城市级别，而您所需要的只是粗略猜测所涉及的距离以与任意限制进行比较。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2021-06-28T11:05:34.273

这是一个版本`Swift`：

```
func toDegreeAt(point: CLLocationCoordinate2D) -> CLLocationDegrees {
    let latitude = point.latitude  
    let earthRadiusInMetersAtSeaLevel = 6378137.0
    let earthRadiusInMetersAtPole = 6356752.314

    let r1 = earthRadiusInMetersAtSeaLevel
    let r2 = earthRadiusInMetersAtPole
    let beta = latitude

    let earthRadiuseAtGivenLatitude = (
      ( pow(pow(r1, 2) * cos(beta), 2) + pow(pow(r2, 2) * sin(beta), 2) ) /
      ( pow(r1 * cos(beta), 2) + pow(r2 * sin(beta), 2) )
    )
    .squareRoot()

    let metersInOneDegree = (2 * Double.pi * earthRadiuseAtGivenLatitude * 1.0) / 360.0
    let value: CLLocationDegrees = self / metersInOneDegree
    return value
  } 
```

* * *

## 回答 #14

> 赞同：-1
> 
> 时间：2013-08-28T14:34:00.000

基于地球上的平均下降距离。

1° = 111公里；

将其转换为弧度并除以米，这是 RAD 的一个幻数，以米为单位：0.000008998719243599958；

然后：

```
const RAD = 0.000008998719243599958;
Math.sqrt(Math.pow(lat1 - lat2, 2) + Math.pow(long1 - long2, 2)) / RAD; 
```

* * *

## 回答 #15

> 赞同：-1
> 
> 时间：2018-05-24T04:32:20.770

如果您想要一个简单的解决方案，请使用其他评论中概述的[Haversine 公式。](https://en.wikipedia.org/wiki/Haversine_formula)如果您有一个对精度敏感的应用程序，请记住，Haversine 公式不能保证精度优于 0.5%，因为它假设地球是一个球体。要考虑地球是一个扁球体，请考虑使用[文森蒂公式](https://en.wikipedia.org/wiki/Vincenty%27s_formulae)。此外，我不确定我们应该使用Haversine 公式使用什么半径：{赤道：6,378.137 公里，极地：6,356.752 公里，体积：6,371.0088 公里}。

* * *

## 回答 #16

> 赞同：-2
> 
> 时间：2010-03-24T11:20:17.810

您需要将坐标转换为弧度以进行球面几何。转换后，您可以计算两点之间的距离。然后可以将距离转换为您想要的任何度量。

# asp.net - 如何在响应重定向之前调用 javascript

> ID：639698
> 
> 赞同：3
> 
> 时间：2009-03-12T17:39:38.847
> 
> 标签：asp.net, javascript, vb.net, asp.net-2.0

我试图在页面重定向之前运行一些 java 脚本，但它无法运行。当我注释掉 Response.Redirect 时，一切正常，但这违反了特定要求。关于如何实现此功能的任何想法？

```
 Dim strscript As String = "<script>alert('hello');</script>"

        If Not ClientScript.IsClientScriptBlockRegistered("clientscript") Then
            ClientScript.RegisterStartupScript(Me.GetType(), "clientscript", strscript)
        End If

        Response.Redirect("http://www.google.com") 
```

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-12T17:44:27.010

您的问题是 Response.Redirect 在将任何内容发送回客户端之前重定向响应（...）。所以客户端得到的是来自谷歌而不是你的服务器的响应。

为了在页面上编写一些 javascript 并在将客户端发送到 Google 之前执行它，您需要在警报之后在 javascript 中进行重定向。

```
 Dim strscript As String = "<script>alert('hello');window.location.href='http://www.google.com'</script>"

   If Not ClientScript.IsClientScriptBlockRegistered("clientscript") Then
       ClientScript.RegisterStartupScript(Me.GetType(), "clientscript", strscript)
   End If 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-12T17:43:50.477

客户端没有机会加载。尝试从客户端重定向：

```
Dim strscript As String = "<script>alert('hello');window.location.href("http://www.google.com");</script>"

If Not ClientScript.IsClientScriptBlockRegistered("clientscript") Then
   ClientScript.RegisterStartupScript(Me.GetType(), "clientscript", strscript)
End If 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-12T17:43:50.850

如果要在重定向之前执行一些 javascript，则需要在 javascript 中而不是在 ASP.NET 中进行重定向。

```
Dim strscript As String = "<script>alert('hello'); window.location.href='http://www.google.com';</script>"

If Not ClientScript.IsClientScriptBlockRegistered("clientscript") Then
    ClientScript.RegisterStartupScript(Me.GetType(), "clientscript", strscript)
End If 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-09-09T05:55:35.517

不工作：

```
string sScript = "<script language='javascript'>alert(\"" + Alertstr + "\");  alert('Record has been Updated Successfully'); </script>";
ClientScript.RegisterStartupScript(typeof(Page), "alert", sScript);
response.redirect("LandingPage.aspx"); 
```

在职的：

```
string sScript = "<script language='javascript'>alert(\"" + Alertstr + "\");  alert('Record has been Updated Successfully'); window.location.href = 'LandingPage.aspx'; </script>";
ClientScript.RegisterStartupScript(typeof(Page), "alert", sScript); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-12T17:47:15.273

如果您使用 Response.Redirect 它实际上会向浏览器发送一个[3XX 响应](http://en.wikipedia.org/wiki/URL_redirection#HTTP_status_codes_3xx)，这会导致它向重定向中的 URL 发送请求。它实际上不会加载/渲染响应中包含的任何数据（实际上我认为没有发送任何数据）。如果您希望它在页面加载后重定向，您可能需要包含一个[META 刷新标头](http://en.wikipedia.org/wiki/Meta_refresh)，该标头在加载后重定向一定时间，或者在脚本末尾使用 javascript do 进行重定向。

# wcf - WCF 和对象

> ID：639715
> 
> 赞同：0
> 
> 时间：2009-03-12T17:43:33.317
> 
> 标签：wcf, web-services, casting

我正在尝试将一个对象传递给 WCF Web 服务，我传入的对象是一个服务器对象，然后我希望能够调用 TestConnection();

我遇到的问题是 Server 是基类，并且有几个 Server 的派生类，即我想使用的 SqlServer2005Server、OracleServer 和 ODBCServer

我希望能够传入一个服务器对象，然后确定它的类型，转换它然后使用该方法

```
public string TestServerConnection(Server server)
{
    if (server.ConnectionType == "SqlServer")
    {
        SqlServer2005Server x = (SqlServer2005Server)server;
        // Tests connection to server and returns result
        return x.TestConnection();
    }

    return "";
} 
```

'Server' 基类实现 IServer

我无法投射它，你能建议吗？

非常感激

菲尔

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-12T18:24:30.817

正如[Daniel Pratt 所说](https://stackoverflow.com/questions/639715/wcf-and-object/639838#639838)，最后，您只是在网络上穿梭 XML（并非总是如此，但大多数时候都是如此）。

如果您使用代理生成器来生成 Server 类型的定义，那么您将无法调用 Server 的方法，因为在代理定义中只使用了属性（至少在语义上）。此外，您不能强制转换为派生类型，因为您的实例实际上是一个单独的类型定义，而不是实际的基类。

如果 Server 类型确实是相同的类型（并且相同，我的意思是对相同程序集的引用，而不仅仅是在名称和架构中），那么您可以按照[Steve 所说](https://stackoverflow.com/questions/639715/wcf-and-object/639781#639781)的那样，在 Server 定义中使用 KnownType 属性，添加每个派生类都有一个属性。

但是，就像他说的那样，这会使您的代码复杂化，因此在执行此操作时要小心。

我认为在这里使用控制反转会起作用，但是您会遇到对特定提供程序的通用引用的相同情况。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-12T17:59:30.127

您需要将 KnownType 声明添加到每个派生类的服务合同中。有一些方法可以自动执行此操作（因为它显然会使代码复杂化并破坏继承），但它们需要大量工作。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-12T18:12:58.737

您传递的对象是否代表与 DBMS 的“实时”连接？如果答案是肯定的，那就没有希望了。请记住，尽管有漂亮的包装器，但您的 Web 服务从调用者那里得到的唯一东西是一大块 xml。

# iphone - iPhone - 捕获设备按钮按下

> ID：639721
> 
> 赞同：5
> 
> 时间：2009-03-12T17:44:00.053
> 
> 标签：iphone, objective-c

我知道您无法从应用程序中控制设备音量，但我希望设备音量能够影响我在应用程序中控制音量的 UIScrollBar。

我知道这是可能的，因为 Last.fm 应用程序做到了，我想实现这种行为。

我可以在互联网上找到很少的信息。这里的任何人都可以帮助我吗？:)

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-03-12T17:50:52.690

侦听器回调很容易

```
void audioVolumeChangeListenerCallback (void *inUserData, AudioSessionPropertyID inID, UInt32 inDataSize, const void *inData)
{
    RootViewController *controller = (RootViewController *) inUserData;
    Float32 newGain = *(Float32 *)inData;
    [controller setGainManual:newGain]; 
} 
```

像这样在我的视图控制器的 viewDidLoad 中初始化

```
AudioSessionAddPropertyListener (kAudioSessionProperty_CurrentHardwareOutputVolume ,audioVolumeChangeListenerCallback, self ); 
```

这也是所有 SDK/App Store 友好的。

# asp.net-mvc - ASP.Net MVC - Actions 中奇怪的参数缓存行为

> ID：639727
> 
> 赞同：0
> 
> 时间：2009-03-12T17:45:04.217
> 
> 标签：asp.net-mvc, caching, binding, action

我在我的项目中遇到了一个奇怪的问题。我的操作是获取旧参数值，而不是 Request.Params 中的实际值。我创建了一个 HomeController.Echo(string text) 动作来说明它（见截图）。当我第一次调用“Home/Echo?text=aaa”等动作时，一切正常。当我第二次使用不同的文本值（“Home/Echo/text=bbb”）调用相同的操作时，我在操作“text”参数中再次获得旧的“aaa”值。奇怪的是 Request.Params 包含正确的“bbb”值。

我在想是否有什么我可以打破自己，但无法弄清楚任何事情。我从 IoC 容器提供控制器，我重写了 ControllerActionInvoker.InvokeActionMethodWithFilters 方法（将依赖项注入到来自 IoC 的过滤器中）并且我正在处理 HttpApplication.AuthenticateRequest。在任何这些中，我都不使用参数/绑定...

[截屏](http://i.nyx.cz/files/00/00/02/14/214301_e613dda0904e56e02677.png)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-13T14:37:43.503

这个问题可能是由一些线程问题引起的——我忘记在我的 IoC 容器中注册控制器的每个请求生命周期（它们被注册为单例）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-12T17:54:49.437

您是否已通过应用程序进行调试以查看值在何处被切换。对文本变量（无论您在代码中如何称呼它）进行简单的观察应该会在变量发生更改的位置产生。如果没有要运行的代码，我不知道它发生在哪里。

我会说写一个测试，但这里仍然有 UI 干扰的可能性。如果你发现它在代码中的哪个地方发生了变化，然后编写一个测试来确认这个错误并开始处理它。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-12T17:56:08.997

我建议您开始评论您覆盖的所有方法，直到您找出问题为止。在最坏的情况下，您将到达创建项目时 ASP.NET MVC 向导离开项目的地步，并且参数绑定确实有效。

# vba - 禁止程序正在尝试访问我的邮件的对话框警告

> ID：639737
> 
> 赞同：2
> 
> 时间：2009-03-12T17:46:33.043
> 
> 标签：vba, outlook

我正在关注此页面中的代码：[如何在 Outlook 中为规则向导创建脚本](https://support.microsoft.com/en-us/help/306108/how-to-create-a-script-for-the-rules-wizard-in-outlook)

这就是我所拥有的：

```
Public Sub GetMails(Item As Outlook.MailItem)

    MsgBox "Mail message arrived: " & Item.SenderEmailAddress
    MsgBox "Mail message arrived: " & Item.Subject
    MsgBox "Mail message arrived: " & Item.Body

End Sub 
```

我设置了一个规则来运行这个宏。每次运行此脚本时，都会出现一个关于程序如何尝试访问我的邮件的对话框。

如何使用 VBA 摆脱这种情况，或者 Outlook 中是否有任何配置选项不会出现？

我对此进行了谷歌搜索，发现一些网站提供了 C# 和 VB.net 的代码，但没有提供 VBA 的代码。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-12T17:51:26.697

添加此功能是为了防止恶意脚本将 Outlook 变成群发邮件或其他坏事。

您可以在您的工作站上关闭此功能，但如果您想将您的应用程序分发给其他用户，您只能通过创建自己的 Outlook 插件或使用像[Redemption](http://www.dimastr.com/redemption/)这样的 3rd-party 工具来摆脱它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-03T02:48:53.153

尝试这个

工具-->宏-->安全-->宏安全-->无安全工具-->宏-->安全-->程序访问

然后选择从不就可疑活动向我发出警告。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-07-30T10:26:38.380

我在某个地方找到了这个并且它有效：

```
Sub SaveAttachment(myItem As Outlook.MailItem) 
```

' 删除电子邮件的所有附件并将它们保存在 ' 本地文件夹中。如果保存时有任何错误，则 ' 附件将保留在原位。

```
Dim myAttachments As Object
Dim myOrt As String
Dim strID As String
Dim olNS As Outlook.NameSpace
Dim oMail As Outlook.MailItem
Dim fs As Object 
```

' 我们需要从应用程序中获取邮件项目对象 ' 对象以避免警告消息

```
strID = myItem.EntryID
Set olNS = Application.GetNamespace("MAPI")
Set oMail = olNS.GetItemFromID(strID) 
```

# python - 在 Autodesk Maya 等 Python 环境中使用 Nose 运行单元测试？

> ID：639744
> 
> 赞同：6
> 
> 时间：2009-03-12T17:49:21.367
> 
> 标签：python, unit-testing, environment, nose, maya

我想开始为我的 Maya 脚本创建单元测试。这些脚本必须在 Maya 环境中运行并依赖于`maya.cmds`模块命名空间。

如何在 Maya 等运行环境中运行鼻子测试？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-03-12T21:03:01.370

使用 Maya 安装中包含的 mayapy 可执行文件，而不是标准的 python 可执行文件。

为了完成这项工作，您需要以编程方式运行鼻子。创建一个名为的 python 文件`runtests.py`并将其放在您的测试文件旁边。在其中，包括以下代码：

```
import os
os.environ['PYTHONPATH'] = '/path/to/site-packages'

import nose
nose.run() 
```

由于 mayapy 加载它自己的 pythonpath，它不知道鼻子所在的站点包目录。os.environ 用于在脚本中手动设置它。或者，您也可以将其设置为系统环境变量。

从命令行使用 mayapy 应用程序运行`runtests.py`脚本：

> /path/to/mayapy.exe runtests.py

您可能需要`maya.standalone`根据您的测试进行导入。

```
import maya.standalone
maya.standalone.initialize(name='python') 
```

# sql-server-2008 - 是否可以将 SQL 7 数据库恢复到 SQL 2008？

> ID：639750
> 
> 赞同：4
> 
> 时间：2009-03-12T17:51:07.917
> 
> 标签：sql-server-2008, sql-server-7

我现在正在尝试使用一个旧的 SQL 7 DB .bak 文件。我试图在 SQL 2008 中恢复备份，但它说它无法使用该文件。有谁知道我如何恢复这个数据库？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-12T17:58:00.630

您需要先安装 SQL Server 7、2000 或 2005，然后将备份还原到其中一个。

*   SQL 2000/2005 - 将备份、导出和还原到 2008。
*   SQL 7 - 恢复备份并使用 SQL Server 2008 导入功能导入数据。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-12T17:56:12.350

您尝试还原到的数据库可能设置为与版本 8 兼容，而不是 7。这将是我要检查的第一件事。

# asp.net-mvc - 让 ASP.NET Mvc 和 Web 窗体一起工作

> ID：639751
> 
> 赞同：0
> 
> 时间：2009-03-12T17:51:15.903
> 
> 标签：asp.net-mvc

***对不起，如果这已经被问到了。***

我目前正在开发一个小功能，并正在尝试将 ASP.NET Mvc 框架实现到我当前的 Web 窗体 Web 应用程序中。我一直在关注我最近在堆栈**溢出中发现的**[Professional ASP.NET 3.5 Mvc Chapter 13](http://media.wiley.com/assets/1539/15/professionalaspnet35mvc_chapter13.pdf) pdf 文档，以使 Web 窗体和 Mvc 一起工作。我已经完成了所有三个步骤：

 **1.  添加了对 System.Web.Mvc、System.Web.Routing 和 System.Web.Abstractions 库的引用

2.  将两个目录添加到我的 Web 应用程序：控制器和视图

3.  更新 web.config 以加载第一步中提到的三个程序集并注册 UrlRoutingModule HttpModule。我还将初始路由设置添加到我的 Global.asax 文件中

    RouteTable.Routes.MapRoute("默认", "{controller}/{action}/{id}", new { controller = "Support", action = "Index", id = "" } );

一旦我尝试按照 ASP.NET Mvc 框架运行我新创建的页面，我会在以下代码中得到 NullReferenceException：

```
<%= Html.Encode(ViewData["Message"]) %> 
```

在我的控制器中，我将 ViewData["Message"] 设置为“Message！” 只是作为一个测试。我是否错过了一些设置我的 Web 应用程序以使用 ASP.NET Mvc 的东西？

任何帮助将不胜感激。

谢谢，

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-12T18:00:43.087

从玩早期的 beta 到今天，我发现创建一个新的 MVC 应用程序并将现有文件“导入”到解决方案中比在现有应用程序中正确设置所有设置更容易。我认为没有理由为设置可以从模板中为我编写的管道而变得炙手可热。也许我只是太懒了。

我发现我可以让“旧版 ASP.NET”Web 表单与 MVC 一起正常工作。对整个项目唯一的要求是让应用程序路由到我的 default.aspx 开始。比运行多个步骤来包含 MVC 要容易得多。

我知道这不是您问题的直接答案，但我认为尝试它也可以解决您的问题。另一个好处是您可以保留旧的“遗留”源，以防出现错误修复。但是，无论如何，您应该处于源代码控制之下。

# ruby-on-rails - Rails Restful 身份验证：找不到 UserObserver

> ID：639752
> 
> 赞同：1
> 
> 时间：2009-03-12T17:51:21.097
> 
> 标签：ruby-on-rails, restful-authentication

我对 Rails 比较陌生，所以这可能是一个愚蠢的问题......

[我按照插件的github 站点](http://github.com/technoweenie/restful-authentication/tree/master)上的基本步骤进行操作（主要是安装插件，运行生成器，修改 environment.rb 并在模型目录中创建 UserObserver 类）

我得到的错误是说它来自 active_support/dependencies。**“'load_missing_constant'：未初始化的常量 UserObserver (NameError)。”** 关于为什么找不到用户观察者类的任何想法？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-12T22:20:35.723

这意味着它正在寻找一个名为“UserObserver”的常量（这通常意味着它是一个类/模块）。它找不到它，因为你可能没有一个名为 user_observer.rb 的文件，一般位于 app/models 或 app/observers 中。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-12T23:25:53.743

您是否在文件中包含这两行`environment.rb`？假设`user_observer.rb`位于`app/observers`.

```
config.load_paths += %W( #{RAILS_ROOT}/app/observers )%
config.active_record.observers = :user_observer 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-12T20:49:43.540

我不知道您的特定问题的解决方案，但您可以查看[Bort](http://github.com/fudgestudios/bort/tree/master)，这是一个已经具有 restful auth 设置的骨架应用程序，并查看他们做了哪些您没有完成的操作。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-07-06T03:37:02.673

我以前遇到过这个问题。这是解决方案：

在使用生成器之前，不要对环境和路由文件进行任何更改。先使用生成器；然后添加...

map.signup '/signup', :controller => 'users', :action => 'new' map.login '/login', :controller => 'sessions', :action => 'new' map.logout ' /logout', :controller => 'sessions', :action => 'destroy'

...ETC。

应该这样做。

# java - 如何编写 StoredProcedure 子类来调用 Oracle 函数？

> ID：639757
> 
> 赞同：1
> 
> 时间：2009-03-12T17:53:41.730
> 
> 标签：java, oracle, spring, jdbc

我编写了以下 Spring JDBC API StoredProcedure 子类：

```
class GetLdapPropertiesStoredProcedure extends StoredProcedure {

protected GetLdapPropertiesStoredProcedure(JdbcTemplate jdbcTemplate) {
    super(jdbcTemplate, "get_ldap_properties");
    setFunction(true);
    declareParameter(new SqlReturnResultSet("rs", new ProductPropertiesMapper()));
    declareParameter(new SqlParameter("in_ldap_code", Types.VARCHAR));
    compile();
}

public Properties execute(String productCode) {
    HashMap input = new HashMap();
    input.put("in_ldap_code", productCode);

    Map results = execute(input);

    Collection<Map.Entry<Object,Object>> entries = (Collection<Map.Entry<Object,Object>>) results.get("rs");
    Properties properties = new Properties();
    properties.entrySet().addAll(entries);
    return properties;
}

} 
```

它调用以下 Oracle 函数：

```
FUNCTION get_ldap_properties (
in_ldap_code   IN VARCHAR2
)
RETURN rowset; 
```

但是，当我调用上述代码时，我得到以下 Oracle 异常：

```
java.sql.SQLException: ORA-06550: line 1, column 13:
PLS-00306: wrong number or types of arguments in call to 'GET_LDAP_PROPERTIES'
ORA-06550: line 1, column 7:
PL/SQL: Statement ignored 
```

谁能看看我做错了什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-12T18:10:36.777

这是您将获得的函数调用语句（即`setFunction(true)`) :``

 ````
{ ? = call get_ldap_properties(?) } 
```

So you need to add a first out parameter for the return value. Try this instead:` 

```
setFunction(true);

// The return value parameter must be the first parameter that you declare.
declareParameter(new SqlOutParameter("RETURN_VALUE", OracleTypes.CURSOR, new ProductPropertiesMapper())); 
```

编辑：根据 Thomas Risberg在 Spring 社区论坛上的[回答](http://forum.springframework.org/showthread.php?p=231407)，修复了使用 Oracle 时处理函数返回值**和行集的语法。**

# jquery - 使用 Ajax 的 HTML 图层的平铺滚动/预加载（Google 地图样式）

> ID：639760
> 
> 赞同：4
> 
> 时间：2009-03-12T17:54:08.063
> 
> 标签：jquery, ajax, google-maps, prezi

我希望复制 Google Maps API 的平移（不一定是缩放）效果，但没有图像。本质上，我想将 HTML 元素放置在一个大坐标系中，并能够在它们周围导航，[Prezi](http://prezi.com/)风格（尽管没有旋转）。

最好，我想通过 jQuery/AJAX 动态地预加载元素，但如果我必须首先加载所有内容，我会的。

那里有任何图书馆可以让我这样做吗？我可以自己编写代码，但我无法想象以前没有人想到过类似的东西。

这可以通过 Google Maps API 完成吗？如果可以，怎么做？实现 GOverlay 接口？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-12T20:58:37.620

哦，你自己做这件事会很有趣，如果你使用 jQuery，肯定不会浪费太多时间，这里是你要做的事情的简要说明......

构建你的容器/包含布局（使用溢出：隐藏只显示所需的大小）

然后使用 mousedown 和 mouseup 事件捕获用户操作。

根据包含的 div 位置属性采取相应的行动（使用“维度”插件）

您可能会在几分钟内获得第一次工作尝试。

问候

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-13T00:06:08.437

开放层 - [http://www.openlayers.org/](http://www.openlayers.org/)是 Google 地图组件的开源实现，它可能超出您的需要，但它是一个很好的起点。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2014-11-12T22:15:46.893

如果您想以 prezi 样式导航到它的 html 元素，Zoomooz 可能正是您要寻找的东西，您不必使用缩放效果，但无论如何它都在那里，尽管为了获得最佳兼容性和性能，我认为您需要使用基于 webkit浏览器...

[http://jaukia.github.io/zoomooz/](http://jaukia.github.io/zoomooz/)

# grails - Grails/GORM 中的遗留映射：1:N 关系中的一个域类和两个表

> ID：639764
> 
> 赞同：1
> 
> 时间：2009-03-12T17:54:50.293
> 
> 标签：grails, grails-orm

假设我有两张表**employee**和**salary**具有1:N 的关系（一个salary 可以与许多员工相关联）。

在纯 SQL 中，表将与：

```
SELECT e.id, e.name, s.salary FROM employee e, salary s WHERE s.id = e.salary_id AND e.id = 12345; 
```

假设以下由 GORM 驱动的域类，我如何将遗留数据库结构映射到该类？

```
class Employee {
   String name
   int salary
} 
```

**澄清 #1：**我只想要一个包含两个表中的数据的域类。因此，添加另一个类不是一种选择。

**澄清 #2：**我试图找到答案的问题只是“如何使用 Grails/GORM 将两个表映射到一个类”？如果您认为不可能这样做，那么请在您的回答中清楚地说明这一点，而不是试图重述问题。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-16T10:31:29.400

IMO 不可能使用普通的 Grails/GORM 来连接多个表并将它们映射到一个域类。作为一种解决方法，您可以使用传统的 XML 休眠映射并利用[连接功能](http://www.hibernate.org/hib_docs/reference/en/html/mapping.html#mapping-declaration-join)来实现您想要的目标。当然，你会失去很多 GORM 的好东西。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-12T18:51:37.693

您的 SQL 示例表明有两个表，Employee 和 Salary。这也应该反映在您的课程中。因此，您需要两个类，而不是一个。GORM 映射将如下所示。

```
class Employee {
   String name
   Salary salary
}

class Salary {
   static hasMany = [ employees : Employee ]
   int salary
} 
```

见[http://www.grails.org/GORM+-+Defining+relationships](http://www.grails.org/GORM+-+Defining+relationships)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-14T04:23:12.210

您可以不将薪水和姓名作为属性，而是将它们作为实际在这两个表上运行查询的 get* 方法。

当然，这不是 grails 方式，强烈建议您遵循 grails 方式。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-03-14T03:37:20.917

如果数据库中有 2 个表，我不完全理解不能添加另一个类的限制，但是如果您希望有一个统一的接口，将方法委托给 Salary 类是否可行？

就像是：

```
class Salary {
    int amount
}

class Employee {
    Salary _salary
    String name

    String toString() { name }

    public Integer getSalary() {
        return _salary?.amount
    }
    public void setSalary(Integer amount) {
    // not quite sure of your business logic here, this is a guess
        _salary = Salary.findByAmount(amount)
        if (!_salary) {
            _salary = new Salary(amount: amount)
            _salary.save()
        }
    }
}

def e = new Employee(name:"willy loman", salary: 100)
e.save()
assert e.salary == 100 
```

也有可能您可以使用自定义休眠映射文件来实现您所要求的工作，但我对以这种方式扭曲休眠还不够熟悉，无法肯定地说。

请参阅[本页的自定义用户类型部分](http://www.grails.org/Hibernate+Integration)。

# .net - IronPython + Emacs？

> ID：639772
> 
> 赞同：4
> 
> 时间：2009-03-12T17:56:17.060
> 
> 标签：.net, emacs, ironpython

我决定进入 IronPython，因为我几乎只在 .NET 中工作，但需要一些比 C# 更简单的东西来模拟快速的东西。Python 对于小东西、一次性测试等这类东西都很好，但到了我需要能够访问我们的一些 .NET 代码的地步。

尽管我完全反感，但我一直在使用 emacs 进行 Python 编辑，并且我也想将它用于 IronPython，假设它是可能的。谷歌一直没有提供资源，所以我想我会看看周围是否有人知道如何让它发挥作用。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-13T20:04:42.970

您可以使用 IronPython，就像它是 emacs 中的标准 Jython 解释器一样。

这假设您使用的是[EmacsW32](http://ourcomments.org/Emacs/EmacsW32.html)并且您已经从启动板安装了[python-mode](https://launchpad.net/python-mode/+download)。（请注意，启动板中的 python 模式与 emacsw32 附带的 python 模式不同！）

确保您已安装[IronPython](http://www.ironpython.com/)，并且您知道它在文件系统上的位置。

打开 emacs，然后打开文件 ~/.emacs 并添加一行代码，将变量 py-jython-command 设置为指向 IronPython，如下所示。您需要更改以下值

(setq py-jython-command "c:/Program Files/IronPython 2.0.1/ipy.exe")

重新启动 emacs 以确保该变量设置正确。

打开一个 python 文件，点击 control-c control-t 切换到 Jython(IronPython) shell，然后点击 control-c ！启动外壳。

此时，您可以点击 control-c control-c 在 IronPython 中执行打开文件的内容，或者只是在 IronPython 中玩耍。

上面的说明假设您可以安装 python-mode，但如果您不知道如何安装，我可以添加更多说明。

另外，如果不清楚，我很乐意扩展其中的任何内容。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-12T18:13:46.630

如果您在使用 emacs 编辑 Python 时感到“完全反感”，请切换到不那么反感的东西。有一些关于 SO 的建议（例如[best-gui-python-interpreter](https://stackoverflow.com/questions/37327/best-gui-python-interpreter)），有些也适合 IronPython。

我发现[SciTE](http://www.scintilla.org/SciTE.html)非常适合许多轻量级编程任务，包括 Python 和 IronPython。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-12T18:17:40.567

我已经将[KomodoEdit](http://www.activestate.com/komodo_edit/)与 IronPython 的自定义运行操作一起使用，但它并不能真正处理分类为自动完成的非 Python。

# c++ - 你如何禁用 CBitmapButton？

> ID：639774
> 
> 赞同：2
> 
> 时间：2009-03-12T17:57:23.890
> 
> 标签：c++, visual-c++, button, mfc

你如何禁用 CBitmapButton？我尝试使用 m_bitmapbutton.EnableWindow(false); 但它不起作用。它仍然会触发一个事件。

如果事件 B 正在执行（从按钮 B），我想要做的是阻止按钮 A 触发事件 A。所以在事件 B 中，我想禁用按钮 A。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-12T18:03:06.687

以下是要检查的事项列表：

*   您是否为位图按钮的禁用状态定义了图像？
*   你确定事件被触发了吗？
*   事件 B 不在线程中是吗？
*   您是否在事件 B 开始时执行 m_bitmapbutton.EnableWindow(FALSE) 并在最后执行 m_bitmapbutton.EnableWindow(TRUE) ？
*   你在做一个BN_CLICKED Notification()吗？或者它可能是一个不同的通知，例如 WM_LBUTTONDOWN Notification()？
*   您确定变量 m_bitmapbutton 与您的按钮 A 正确关联吗？你可以试试 GetDlgItem(IDC_BUTTON_A)->EnableWindow(FALSE);

您总是可以只设置一个布尔成员变量来指示按钮 A 已禁用，并在设置此布尔成员时忽略发送给它的任何事件。

[从 CodeProject 使用此类](http://www.codeproject.com/KB/cpp/button00.aspx)可能更容易。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-13T09:08:31.190

我想问题是当你参加活动 B 时，这个窗口的消息没有被发送。因此，在您完成参加活动 B 并且您再次启用按钮 A 后，他们正在排队和调度。像这样的东西：

1.  OnBnClickedButtonB
2.  buttonA.EnableWindow(FALSE) （窗口的鼠标事件正在排队而不是调度）
3.  buttonA.EnableWindow(TRUE)
4.  ~OnBnClickedButtonB（应用程序调度排队事件，使按钮再次启用）

这不仅仅是 CBitmapButton 的问题......它应该与任何其他按钮一起出现（我自己没有尝试过）。

一个可能的解决方法可能是在再次启用按钮之前为该窗口调度鼠标事件......虽然我不太喜欢做这种事情......也许有人可以给你一个更好的解决方案：

```
void CMyDlg::OnBnClickedButtonB()
{
    m_buttonA.EnableWindow(FALSE);

    //Process button B clicked event 

    MSG msg;
    while(PeekMessage(  &msg, 
                GetSafeHwnd(), 
                WM_MOUSEFIRST, 
                WM_MOUSELAST, 
                PM_REMOVE))
    {
        TranslateMessage(&msg);
        DispatchMessage(&msg);  
    }

    m_buttonA.EnableWindow(TRUE);
} 
```

希望这有帮助！

哈维尔

# c# - 如何将负数变为红色？

> ID：639778
> 
> 赞同：2
> 
> 时间：2009-03-12T17:58:42.327
> 
> 标签：c#, .net, asp.net, html

我正在使用数据集，并将返回正数和负数货币数据。我已经有一个括号。如何仅让 gridview 中的负数显示为红色？我可以在 HTML 端执行此操作吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-12T18:10:01.770

如果数字为负数，我会将控件的 CssClass 设置为按照您想要的方式设置文本样式。使用 CssClass 而不是 FontColor 的原因是您将来可能会更改它，并且仅更改 CSS 样式而不是使用它的任何代码会更容易。

```
<asp:BoundField runat="server"
    DataField="Value"
    HeaderText="value"
    ItemStyleCssClass='<% (double)Eval("Value") < 0 ? "negative-number" : "" %>' /> 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-12T18:02:33.147

在不使用具有格式规则的第三方控件的情况下，我将使用 Row 的数据绑定事件并在相关单元格的文本为负数时为其着色。这给 UI 层增加了一点点权重，但在交付成千上万行之前，这还不够明显。如果您要交付成千上万行，则可能存在架构问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-12T18:01:13.227

有很多方法可以做到这一点，我想到了两种：

1.  应用一个 CSS 类，将元素设置`color`为红色。
2.  `Color`在用于呈现数字的 WebControl 上设置属性。

没有一些代码，很难给你具体的例子。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-12T18:14:52.600

```
protected void GridView1_RowDataBound(object sender, GridViewRowEventArgs e)    {

   myCell = new TableCell();       
   myCell.Text =   e.Row.DataItemIndex.ToString();
   myCell.Style["color"] = decimal.Parse(myCell.Text)<0?"Red":"OtherColor";
   e.Row.Cells.Add(myCell);

} 
```

或类似的东西

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-12T18:26:46.520

您可以尝试使用 jQuery 进行样式设置：

jQuery：

```
$("span:contains('-')").css("color", "#f00"); 
```

当然，更改您的号码所在的任何标签的跨度（并考虑进入比跨度更具体的内容，例如*span.number-container 。*

# python - 在 django 中使用通用 create_object 视图设置对象所有者

> ID：639792
> 
> 赞同：11
> 
> 时间：2009-03-12T18:02:08.357
> 
> 标签：python, django

是否可以使用 create_object 视图创建新对象并自动将 request.user 分配为外键？

体育：

```
class Post(models.Model):
    text = models.TextField()
    author = models.ForeignKey(User) 
```

我想要的是使用 create_object 并用 request.user 填充作者。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-12T20:22:47.147

在许多方面，解决这个问题的所有解决方案都将比它们的价值更麻烦。这有资格作为一个黑客。如果 django 更新改变了 create_update 的实现方式，它可能会让你感到兴奋和干燥。为简单起见，我假设您正在尝试设置默认用户，而不是默默地强制用户成为登录用户。

编写上下文处理器：

```
from django.views.generic.create_update import get_model_and_form_class
def form_user_default(request):
    if request.method == 'GET':
        model, custom_form = get_model_and_form_class(Post,None)
        custom_form.author = request.user
        return {'form':custom_form}
    else: return {} 
```

这将覆盖 create_update 传递给模板的表单对象。它在技术上所做的是在默认视图完成后重新创建表单。

然后在你的 url conf 中：

```
url(r'pattern_to_match', 'django.views.generic.create_update.create_object', kwargs={'context_processors':form_user_default}) 
```

同样，我不得不深入研究源代码来弄清楚如何做到这一点。最好尝试编写自己的视图（但要包含尽可能多的 Django 自定义对象）。没有“简单的默认”方法可以做到这一点，因为在 django 范式中，表单与模型层的联系比与视图的联系更紧密，并且只有视图才知道请求对象。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-12-01T22:21:53.117

您可能需要考虑关闭。

```
from django.forms import ModelForm
from django.views.generic.create_update import create_object, update_object

def make_foo_form(request):
    class FooForm(ModelForm):
        class Meta:
            model = Foo
            fields = ['foo', 'bar']

        def save(self, commit=True):
            f = super(FooForm, self).save(commit=False)
            if not f.pk: f.user = request.user
            if commit: f.save()
            return f

    return FooForm

def create_foo(request):
    FooForm = make_foo_form(request)
    return create_object(form_class=FooForm) 
```

这里有一些效率低下，因为您需要在每个请求上创建 ModelForm 对象，但它确实允许您将功能注入通用视图。

您需要确定为表单创建增加的复杂性是否值得在视图端保持简单性。

不过，这里的一个好处是，这也适用于更新案例，几乎不需要额外的努力：

```
def update_foo(request, object_id):
    FooForm = make_foo_form(request)
    return update_object(form_class=FooForm, object_id=object_id) 
```

显然，您也可以将这种方法用于更复杂的情况。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-12T19:08:59.383

如果用户通过身份验证，则他们的用户对象就是`request.user`对象。

我对 create_object 不熟悉...我仍然是 django 的初学者，并且刚刚开始使用它进行我的第一个真正的项目。

请注意，在使用它之前，您应该检查以确保用户已登录。这可以通过`request.user.is_authenticated()`.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-13T18:24:55.533

使用当前的 Django 通用视图时，没有很好的方法来保存对象。一旦它们被[重写为 classes](http://code.djangoproject.com/ticket/6735)，您就可以将视图子类化并挂接到适当的位置，而无需重写整个视图。

出于这个原因，我已经使用了我自己的基于类的通用视图。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-27T05:23:45.483

我建议为 create_object 做一个包装器，因为作者 建议[http://www.b-list.org/weblog/2006/nov/16/django-tips-get-most-out-generic-views/](http://www.b-list.org/weblog/2006/nov/16/django-tips-get-most-out-generic-views/)您可以访问用户信息的视图。之后，您将需要使用 extra_context 将用户传递给模板。最后在模板中，您可以添加一个包含用户信息的隐藏字段。我没有尝试过，但我已经考虑了很长时间。希望这个解决方案适合你！;) 干杯！

# regex - 构造正则表达式

> ID：639797
> 
> 赞同：2
> 
> 时间：2009-03-12T18:03:58.540
> 
> 标签：regex, theory

我使用正则表达式伙伴，它接受一个正则表达式，然后给出它的含义，从中得到它可以做什么？在类似的行中，是否有可能有一些引擎采用自然语言输入来描述一个需要匹配/替换的模式，并为该描述给出正确（几乎正确）的正则表达式？

例如匹配某个文件中的整个单词“dio”

所以正则表达式可能是：`<dio>` 或

\bdio\b

-广告。

PS = 我认为这里很少有人会认为这是一个“主观”“与编程无关”的问题，但我仍然需要问这个问题。为了我自己。- 谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-12T18:24:25.573

这将是复杂的编程，因为你需要一个能够推导出含义的自然语言解析器。除非你把它限制在一个严格的子集中——在这种情况下，你正在重新发明一种表达式语言，你最终会回到正则表达式——只有更大的符号。那么有什么好处呢？

正则表达式的开发是有原因的——它们是最简单、最准确的表示。

有一个用于 Emacs 的[Symbolix Regular Expression Builder](http://www.emacswiki.org/emacs/SymbolicRegexp)包，但是看着它，我认为正则表达式更容易使用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-12T18:37:06.493

简短的回答：不，直到人工智能改进了很多。

如果你写了这样的东西，你的语法就会非常有限。对于要知道“在某个文件中匹配整个单词'dio'”的人，他们基本上需要对正则表达式有重要的了解。此时，只需使用正则表达式。

对于非技术用户，除非您将其限制为基本的“查找此短语”或“查找以 ?? 开头/结尾的行”，否则这将永远不会起作用。他们永远不会想出这样的事情：

> 查找包含小于号后跟字符串“img”后跟一个或多个分组的行：一些空格，后跟一个或多个字母，后跟双引号字符串或单引号字符串，这些分组是后跟任意长度的空格，然后是斜杠和大于号。

这是我对这个相对简单的正则表达式的简单语言版本的尝试：

```
/<img(\s+[a-z]+=("[^"]*"|'[^']*'))+\s*/>/i 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-12T18:09:43.627

是的，我同意你的看法`subjective`。但我会回答你的问题，因为我认为你问了一个错误的问题。

答案是“**是**”。几乎任何东西都可以编码，这将是一个相当简单的编码应用程序。它会完美运行吗？不，它不会，因为自然语言的解析和解释非常复杂。但是有可能写出这样一个有一些限制的引擎。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-12T18:55:27.980

通过使用自然语言处理器生成正则表达式是很有可能的。Prolog 应该是解决这类问题的一个不错的语言选择。然而，在实践中，您实际上要做的是设计您自己的输入语言，该语言提供正则表达式作为输出。如果您的目标是为特定任务生成正则表达式，这实际上可能很有用。也许您正在执行的任务往往需要某些可行但未内置于正则表达式的公式。尽管这是否比一次只创建一个正则表达式更有效取决于您的项目。通常情况可能并非如此，因为您自己的语言不会像正则表达式那样广为人知或有充分的记录。如果您的目标是生成正则表达式的替代品，其输出将被解析为正则表达式，我认为您 问了很多。并不是说人们以前没有做过同样的事情（例如，C++ 语言作为最初在 C++ 上运行的“改进”）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-07-01T15:39:13.703

[在http://www.rubyregexp.sf.net](http://www.rubyregexp.sf.net)尝试开源 mac 应用程序 Ruby Regexp Machine 。它是用 ruby​​ 编写的，因此即使您不在 mac 上也可以使用其中的一些代码。你可以用简单的英语语法描述很多简单的正则表达式。作为披露，我确实制作了这个工具。

# crystal-reports - Crystal Reports：超过一页的子报表

> ID：639800
> 
> 赞同：0
> 
> 时间：2009-03-12T18:04:17.167
> 
> 标签：crystal-reports, subreport

您好我有一个水晶报表，报表设置，我想插入一个子报表作为第一页。我想我可以这样做购买在我的其他报告的 PageHeader 中放置一个子报告。它运行良好，但不显示我的其余子报告页面；它只显示第一页。有人可以帮我配置吗？谢谢你。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-13T13:28:28.367

如果您将子报表放在页眉中并且子报表比一页长，水晶可能会爆炸！

# sql - 自定义生成器 Visual Studio 数据库版 GDR 未显示

> ID：639806
> 
> 赞同：1
> 
> 时间：2009-03-12T18:05:21.703
> 
> 标签：sql, visual-studio

我正在尝试在 Visual Studio 团队套件中创建一个自定义生成器，我已经安装了数据库版本 GDR，我已经按照 MSDN 上的演练为 GDR 版本这样做（并根据演练对我的解决方案进行了三次检查）并下载来自说明功能的 codeplex 项目。但无论我尝试什么，新项目都不会出现在数据生成计划的下拉列表中。是否有其他人遇到过同样的问题并设法解决或知道如何调试或记录自定义生成器的加载。任何指针都非常受欢迎。

皮特

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-30T10:22:08.323

我已经设法解决了这个问题，这与我正在使用的 xxx.extensions.xml 文件有关。文件的正确开头是：

```
 <?xml version="1.0" encoding="utf-8"?>
   <extensions assembly="" version="1" xmlns="urn:Microsoft.Data.Schema.Extensions" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="urn:Microsoft.Data.Schema.Extensions Microsoft.Data.Schema.Extensions.xsd"> 
```

不是：

```
 <?xml version="1.0" encoding="utf-8"?>
   <extensions assembly="" version="1" xmlns="urn:Microsoft.VisualStudio.TeamSystem.Data.Extensions" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="urn:Microsoft.VisualStudio.TeamSystem.Data.Extensions Microsoft.Data.Schema.Extensions.xsd"> 
```

正如我在一些例子中发现的那样。

希望这对其他人有帮助！

# wpf - 如何在 WPF ListView 中对项目进行分组

> ID：639809
> 
> 赞同：23
> 
> 时间：2009-03-12T18:05:47.740
> 
> 标签：wpf, .net-3.5, styles

我有一个`ListView`我想将结果分组，但是我发现的例子不起作用。如何对结果进行分组？

我想对`Status`自定义对象的属性进行分组。

这就是我所拥有的：

```
<ListView IsSynchronizedWithCurrentItem="True"
          ItemsSource="{Binding}"
          HorizontalContentAlignment="Stretch"
          ScrollViewer.HorizontalScrollBarVisibility="Disabled"
          Background="Transparent" SelectionChanged="ListView_SelectionChanged"
          Name="lstShelvedOrders">

        <ListView.GroupStyle>
            <GroupStyle>
                <GroupStyle.HeaderTemplate>
                    <DataTemplate>
                        <TextBlock FontWeight="Bold" FontSize="15"
                         Text="{Binding Path=Status}"/>
                    </DataTemplate>
                </GroupStyle.HeaderTemplate>
            </GroupStyle>
        </ListView.GroupStyle>

        <ListView.ItemContainerStyle>
            <Style TargetType="{x:Type ListViewItem}">
                <Setter Property="BorderThickness" Value="1" />
                <Setter Property="Width" Value="Auto" />
                <Setter Property="FontSize" Value="10.4"  />               
            </Style>
        </ListView.ItemContainerStyle>

        <ListView.View>
            <GridView>
                <GridViewColumn DisplayMemberBinding="{Binding Path=Number}" Header="Shelve ID"  />
                <GridViewColumn DisplayMemberBinding="{Binding Path=Customer}" Header="Customer" />
                <GridViewColumn DisplayMemberBinding="{Binding Path=PurchaseOrderNo}" Header="PO Number" />
                <GridViewColumn DisplayMemberBinding="{Binding Path=SubmittedBy}" Header="Shelved By"  />
                <GridViewColumn DisplayMemberBinding="{Binding Path=OrderDate, StringFormat=MMM dd\, yyyy}" Header="Date"  />
                <GridViewColumn DisplayMemberBinding="{Binding Path=CustomerTerms.Description}" Header="Order Terms"  />
                <GridViewColumn DisplayMemberBinding="{Binding Path=ShippingMethod.Description}" Header="Shipping"  />
                <GridViewColumn DisplayMemberBinding="{Binding Path=TotalPrice, StringFormat=c}" Header="Order Total"  />
            </GridView>
        </ListView.View>
    </ListView> 
```

这是我拥有的代码：

```
 void ShelvedOrderList_DataContextChanged(object sender, System.Windows.DependencyPropertyChangedEventArgs e)
 {
     AddGrouping();
 }

 private void AddGrouping()
 {
     if ( lstShelvedOrders.ItemsSource == null)
     {
         return;
     }

     CollectionView myView = (CollectionView)CollectionViewSource.GetDefaultView(lstShelvedOrders.ItemsSource);
     PropertyGroupDescription groupDescription = new PropertyGroupDescription("Status");
     myView.GroupDescriptions.Add(groupDescription);
 } 
```

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-03-12T18:44:06.540

我马上注意到一件事 -[`GroupStyle.HeaderTemplate`](http://msdn.microsoft.com/en-us/library/system.windows.controls.groupstyle.headertemplate.aspx)将应用于 a [`CollectionViewGroup`，](http://msdn.microsoft.com/en-us/library/system.windows.data.collectionviewgroup.aspx)所以你`DataTemplate`应该看起来像这样：

```
<GroupStyle>
    <GroupStyle.HeaderTemplate>
        <DataTemplate>
            <TextBlock FontSize="15" FontWeight="Bold" Text="{Binding Name}"/>
        </DataTemplate>
    </GroupStyle.HeaderTemplate>
</GroupStyle> 
```

`CollectionViewGroup.Name`将`Status`为该组分配 的值。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2011-09-01T13:07:03.813

我认为这也可以更好，使用带有新 ControlTemplate 的 GroupStyle：

```
<ListView ItemsSource="{Binding Path=ContactsView}">
  <ListView.GroupStyle>
    <GroupStyle>
      <GroupStyle.ContainerStyle>
        <Style TargetType="{x:Type GroupItem}">
          <Setter Property="Template" Value="{StaticResource ContactsGroupItemTemplate}" />
        </Style>
      </GroupStyle.ContainerStyle>
    </GroupStyle>
  </ListView.GroupStyle> 
```

...

```
<ControlTemplate TargetType="{x:Type GroupItem}" x:Key="ContactsGroupItemTemplate">
  <Expander IsExpanded="False">
    <Expander.Header>
      <DockPanel>
        <TextBlock FontWeight="Bold" Text="{Binding Path=Name}" Margin="5,0,0,0" Width="100"/>
          <TextBlock FontWeight="Bold" Text="{Binding Path=ItemCount}"/>
          <TextBlock FontWeight="Bold" Text=" Items"/>
      </DockPanel>
    </Expander.Header>
    <Expander.Content>
      <ItemsPresenter />
    </Expander.Content>
  </Expander>
</ControlTemplate> 
```

# ruby - 如何在不将换行符粘贴到字符串中的情况下使用“puts”添加额外的换行符？

> ID：639810
> 
> 赞同：39
> 
> 时间：2009-03-12T18:06:08.753
> 
> 标签：ruby, string, newline

如果我说

```
puts "Hello" 
```

并决定添加一个额外的换行符，我需要这样做：

```
puts "Hello\n" 
```

在字符串中有这个字符是丑陋的。有没有办法在不污染我的字符串的情况下做到这一点？

* * *

## 回答 #1

> 赞同：58
> 
> 时间：2009-03-12T18:07:54.270

只需再次致电`puts`：

```
puts "Hello"
puts 
```

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2009-03-16T21:58:45.817

```
puts "Hello","" 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2013-02-24T23:10:29.443

我经常发现自己在 ruby​​ 中添加一个常量来包含这些字符

```
NEW_LINE = "\n"

puts "Hello" + NEW_LINE 
```

我认为它更具可读性，并且如果有人决定在以后的某个日期用其他东西分隔每一行，则可以轻松更改所有换行符。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-12T18:15:37.687

你觉得这个好看吗？

```
 puts "Hello"+$/ 
```

</邪恶>

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-12T18:17:39.957

Ruby 使用“\n”作为换行符的原因是它基于 C。Ruby MRI 是用 C 编写的，甚至 JRuby 也是用基于 C 的 C++ 编写的 Java ......你明白了！所以所有这些 C 风格的语言都使用“\n”作为新行。

您始终可以编写自己的方法，该方法的作用类似于 puts，但会根据方法的参数添加新行。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-04-24T18:55:18.410

你可以写

```
p "Hello"
p 
```

如果您想保持简短和简单，那应该也可以

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-12T18:09:22.070

好吧，我不认为明确的换行是丑陋的。mipadi 的回答也很好。只是为了输入另一个答案，制作一个行数组，然后用换行符加入数组。:)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2014-08-05T21:52:45.600

您想要修复的内容：脚本输入：

```
puts "Hello there"
puts "Goodbye" 
```

脚本的输出：

```
Hello thereGoodbye 
```

修复问题： 脚本输入：

```
puts "Hello there"
puts
puts "Goodbye" 
```

脚本的输出：

```
Hello there
Goodbye 
```

# c# - ExpectedException 没有捕捉到异常，但我可以用 try catch 捕捉它

> ID：639813
> 
> 赞同：2
> 
> 时间：2009-03-12T18:07:08.923
> 
> 标签：c#, visual-studio, unit-testing, exception

关于这个有什么想法吗？我正在尝试编写一个单元测试，它将删除一个项目并通过尝试按其 ID 检索该项目来确认该项目不再在存储库中，这应该引发 DataAccessException。但是，测试一直失败。我添加了一个 try catch 块，果然我捕捉到了我期待的异常。我正在使用 VS 测试工具进行单元测试。

```
 [ExpectedException(typeof(DataAccessException))]
    private static void NHibernateRepositoryBaseDeleteHelper<T, TKey>(T myItem, TKey myItemId)
    {
        MyTestRepository<T, TKey> myRepository = new MyTestRepository<T, TKey>();
        myRepository.Delete(myItem);
        myRepository.CommitChanges();
        try
        {
            myRepository.GetById(myItemId, false);
        }
        catch (DataAccessException dae)
        {
            Assert.IsTrue(true);
        }
    } 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-12T18:20:05.990

我将通过指出“ExpectedException”属性很糟糕来补充 Jared 所说的内容。无法断言异常的消息是正确的（“message”参数不会像您认为的那样做），并且您无法在一次测试中检查多个异常。

更好的解决方案是执行以下操作：http: [//geekswithblogs.net/sdorman/archive/2009/01/17/unit-testing-and-expected-exceptions.aspx](http://geekswithblogs.net/sdorman/archive/2009/01/17/unit-testing-and-expected-exceptions.aspx)

这个类可以让你做这样的整洁的事情：

```
[测试方法]
公共无效TestAFewObviousExceptions（）
{
// 这里的一些设置
   ExceptionAssert.Throws("类别 47 不存在", () =>
                钱包.Categories.GetChildCategoryIds(47));
   ExceptionAssert.Throws("Id Flim 无效", () =>
                wallet.Categories.IdFromName("Flim"));
}

```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-12T18:09:49.197

您需要将 ExpectedException 属性添加到具有 TestMethod 属性的同一方法上。VS 单元测试框架只会在特定测试的入口点查找 ExpectedException 属性。

```
[TestMethod]
[ExpectedException(typeof(DataAccessException))]
public void ATestMethod() {
  ...
  NHibernateRepositoryBaseDeleteHelper(itemValue, keyValue);
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-12T18:12:56.677

首先，您正在修改您的删除方法。我会有一个单独的删除方法和测试方法。是的，您正在测试删除，但实际上您正在测试与删除相关的行为。这里可能还有其他测试。

由于这似乎是自动生成测试的一部分，因此我不会在该测试中添加到同一个存储库对象，而是会在他们自己的测试方法中执行我的测试，并将删除用作设置的一部分班上。这肯定会将测试与删除分开。

希望这可以帮助。

# regex - 用于检索日志文件中上一行的正则表达式

> ID：639814
> 
> 赞同：5
> 
> 时间：2009-03-12T18:07:20.483
> 
> 标签：regex

我的日志文件包含以下内容：

> ```
> 2009-03-12T12:44:27+0000 something was logged
> 2009-03-12T12:45:36+0000 127.0.0.1 127.0.0.1 <auth.info> last message repeated 2 times 
> ```

我可以编写一个正则表达式来检索带有“最后一条消息重复...”语句的行，但是，如果不检索它之前的行，那行是没有意义的。

话虽如此，有没有人知道一个正则表达式，只要检测到“最后一条消息重复......”语句，我就可以检索这两行？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-12T18:20:20.437

编辑为 2 组匹配正则表达式。你可以试一试：[RegexLib](http://regexlib.com/RETester.aspx)

不如优化但这样：

```
([\r\n].*?)(?:=?\r|\n)(.*?(?:last message repeated).*) 
```

应该努力从这样的事情中得到结果：

```
2009-03-12T12:44:27+0000 something1 was logged
2009-03-12T12:44:27+0000 something2 was logged
2009-03-12T12:45:36+0000 127.0.0.1 127.0.0.1 <auth.info> last message repeated 2 times
2009-03-12T12:44:27+0000 something3 was logged
2009-03-12T12:44:27+0000 something4 was logged
2009-03-12T12:44:27+0000 something5 was logged
2009-03-12T12:45:36+0000 127.0.0.1 127.0.0.1 <auth.info> last message repeated 2 times 
```

导致：

```
Matches
First Match, First Group: 2009-03-12T12:44:27+0000 something2 was logged
First Match, Second Group: 2009-03-12T12:45:36+0000 127.0.0.1 127.0.0.1 <auth.info> last message repeated 2 times
Second Match, First Group: 2009-03-12T12:44:27+0000 something5 was logged 
Second Match, Second Group: 2009-03-12T12:45:36+0000 127.0.0.1 127.0.0.1 <auth.info> last message repeated 2 times 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-12T18:11:59.830

我会这样做。尝试搜索包含两组的模式。第一组是一行，其后是另一组，其中包含另一行带有“最后一条消息重复”的文本。那么第一组的内容就是你要找的文本。

像这样的东西（这是过于简化的正则表达式）：

```
\n(.*)\n(.*)last message repeated 
```

现在第一组值包含您感兴趣的行。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-12T18:21:01.650

它必须是正则表达式吗？grep 允许您在匹配之前和之后获取上下文（`-B NUM`和`-A NUM`选项）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-12T18:21:41.150

模式 ^.*$ 匹配整行。翻译：行首，后跟任意数量的字符，然后是行尾。所以也许你可以搜索“任何一行，后跟”（你在那里的模式）。

# javascript - 如何禁用所有 div 内容

> ID：639815
> 
> 赞同：322
> 
> 时间：2009-03-12T18:07:25.210
> 
> 标签：javascript, jquery, html

我假设如果我禁用了一个 div，所有内容也会被禁用。

但是，内容是灰色的，但我仍然可以与之交互。

有没有办法做到这一点？（禁用 div 并禁用所有内容）

* * *

## 回答 #1

> 赞同：631
> 
> 时间：2014-08-15T14:23:05.353

上述许多答案仅适用于表单元素。禁用任何 DIV 包括其内容的简单方法是禁用鼠标交互。例如：

```
$("#mydiv").addClass("disabledbutton"); 
```

CSS

```
.disabledbutton {
    pointer-events: none;
    opacity: 0.4;
} 
```

***补充：***

许多人这样评论：“这只会禁止鼠标事件，但控件仍处于启用状态”和“您仍然可以通过键盘导航”。您可以将此代码添加到您的脚本中，并且无法通过键盘选项卡等其他方式访问输入。您可以更改此代码以满足您的需要。

```
$([Parent Container]).find('input').each(function () {
     $(this).attr('disabled', 'disabled');
 }); 
```

* * *

## 回答 #2

> 赞同：148
> 
> 时间：2009-03-12T18:09:36.733

使用 JQuery 之类的框架来执行以下操作：

```
function toggleStatus() {
    if ($('#toggleElement').is(':checked')) {
        $('#idOfTheDIV :input').attr('disabled', true);
    } else {
        $('#idOfTheDIV :input').removeAttr('disabled');
    }   
} 
```

[使用 jQuery 禁用和启用 Div 块中的输入元素](http://techchorus.net/disable-and-enable-input-elements-div-block-using-jquery)应该会对您有所帮助！

从 jQuery 1.6 开始，您应该使用`.prop`而不是`.attr`禁用。

* * *

## 回答 #3

> 赞同：58
> 
> 时间：2016-11-25T08:15:05.620

对于不需要 div 而只需要块元素的人，这里有一个快速评论。在 HTML5`<fieldset disabled="disabled"></fieldset>`中获得了 disabled 属性。禁用字段集中的每个表单元素都被禁用。

* * *

## 回答 #4

> 赞同：50
> 
> 时间：2009-03-12T21:39:40.253

我只是想提一下[这个用于启用和禁用元素的扩展方法](https://stackoverflow.com/questions/625109/jquery-script-load-timing/625126#625126)。我认为这比直接添加和删除属性要干净得多。

然后，您只需执行以下操作：

```
$("div *").disable(); 
```

* * *

## 回答 #5

> 赞同：15
> 
> 时间：2009-03-12T18:30:01.207

disabled 属性不是[DIV 元素](http://www.w3.org/TR/REC-html40/struct/global.html)的 W3C 规范的一部分，仅适用于[表单元素](http://www.w3.org/TR/html401/interact/forms.html#adef-disabled)。

Martin 建议的 jQuery 方法是完成此任务的唯一万无一失的方法。

* * *

## 回答 #6

> 赞同：15
> 
> 时间：2015-04-06T17:03:18.510

您可以使用这个简单的 CSS 语句来禁用事件

```
#my-div {
    pointer-events:none;
} 
```

* * *

## 回答 #7

> 赞同：14
> 
> 时间：2013-08-23T02:37:14.420

类似于 cletu 的解决方案，但我使用该解决方案时出错，这是解决方法：

```
$('div *').prop('disabled',true);
// or
$('#the_div_id *').prop('disabled',true); 
```

对我很好

* * *

## 回答 #8

> 赞同：13
> 
> 时间：2019-05-31T04:28:38.163

`div`在`fieldset`标签内包装：

```
<fieldset disabled>
<div>your controls</div>
</fieldset> 
```

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2017-01-17T14:13:28.040

实现此目的的一种方法是将 disabled 属性添加到 div 的所有子项。你可以很容易地做到这一点：

```
$("#myDiv").find("*").prop('disabled', true); 
```

`$("#myDiv")`找到 div，`.find("*")`获取所有级别的所有子节点并`.prop('disabled', true)`禁用每个子节点。

这样所有内容都被禁用，你不能点击它们，标签到它们，滚动它们等。此外，你不需要添加任何 css 类。

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2013-02-20T05:47:22.800

测试的浏览器：IE 9、Chrome、Firefox 和 jquery-1.7.1.min.js

```
 $(document).ready(function () {
        $('#chkDisableEnableElements').change(function () {
            if ($('#chkDisableEnableElements').is(':checked')) {
                enableElements($('#divDifferentElements').children());
            }
            else {
                disableElements($('#divDifferentElements').children());
            }
        });
    });

    function disableElements(el) {
        for (var i = 0; i < el.length; i++) {
            el[i].disabled = true;

            disableElements(el[i].children);
        }
    }

    function enableElements(el) {
        for (var i = 0; i < el.length; i++) {
            el[i].disabled = false;

            enableElements(el[i].children);
        }
    } 
```

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2012-11-30T16:29:26.943

如您所知，可以使用“禁用”属性禁用 HTML 输入控件。一旦设置了输入控件的“禁用”属性，就不会调用与此类控件关联的事件处理程序。

如果您愿意，您必须为不支持“禁用”属性（如 div）的 HTML 元素模拟上述行为。

如果你有一个 div，并且你想在那个 div 上支持 click 或 key 事件，那么你必须做两件事： 1）当你想禁用 div 时，像往常一样设置它的 disabled 属性（只是为了遵守约定） 2）在您的 div 的单击和/或键处理程序中，检查是否在 div 上设置了 disabled 属性。如果是，则忽略单击或键事件（例如，立即返回）。如果未设置禁用属性，则执行 div 的单击和/或键事件逻辑。

以上步骤也与浏览器无关。

* * *

## 回答 #12

> 赞同：5
> 
> 时间：2017-10-24T15:03:21.607

如果您想保持禁用的语义如下

```
<div disabled="disabled"> Your content here </div> 
```

您可以添加以下 CSS

```
div[disabled=disabled] {
  pointer-events: none;
  opacity: 0.4;
} 
```

这里的好处是你没有使用你想要使用的 div 上的类

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2019-06-10T20:23:03.020

或者只是使用 css 和“禁用”类。
*注意：*不要使用 disabled 属性。
无需弄乱 jQuery 的开/关。
这更容易并且可以跨浏览器工作：

```
.disabled{
    position: relative;
}
.disabled:after{
    content: "";
    position: absolute;
    width: 100%;
    height: inherit;
    background-color: rgba(0,0,0,0.1);
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
} 
```

然后您可以在初始化页面或切换按钮时关闭和关闭它

```
if(myDiv !== "can be edited"){
    $('div').removeClass('disabled');
} else{
    $('div').addClass('disabled');
} 
```

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2021-01-04T13:10:23.300

正如许多答案已经阐明`disabled`的那样，它不是一个`DIV`属性。然而 xHTML 意味着**可扩展的 HTML**。这意味着您**可以定义自己的 HTML 属性**（所有前端框架也这样做）。**CSS 支持属性选择器**，即`[]`.

将标准 HTML 与您定义的属性一起使用：

```
<div disabled>My disabled div</div> 
```

使用 CSS：

```
div[disabled] {
  opacity: 0.6;
  pointer-events: none;
} 
```

**注意：您也可以使用带有 ID 或类名称的 CSS 属性选择器，例如`.myDiv[disabled] {...}`也可以应用值过滤器，例如：遵循 HTML 禁用带有值的标准属性`div[disabled=disabled] {...}`。**

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2012-04-13T18:51:54.567

我想我会写一些笔记。

1.  < div > 可以在 IE8/9 中禁用。我认为这是“不正确的”，它让我失望
2.  不要使用 .removeProp()，因为它对元素有永久影响。使用 .prop("disabled", false) 代替
3.  $("#myDiv").filter("input,textarea,select,button").prop("disabled", true) 更明确，并且会捕获一些您会错过的表单元素 :input

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2015-06-13T19:01:17.070

## 如何禁用 DIV 的内容

单独的 CSS`pointer-events`属性不会禁止子元素滚动，IE10 及以下 DIV 元素不支持它（仅适用于 SVG）。 [http://caniuse.com/#feat=pointer-events](http://caniuse.com/#feat=pointer-events)

**在所有浏览器上禁用 DIV 的内容。**

Javascript：

```
$("#myDiv")
  .addClass("disable")
  .click(function () {
    return false;
  }); 
```

CSS：

```
.disable {
  opacity: 0.4;
}
// Disable scrolling on child elements
.disable div,
.disable textarea {
  overflow: hidden;
} 
```

**在所有浏览器上禁用 DIV 的内容，IE10 及以下版本除外。**

Javascript：

```
$("#myDiv").addClass("disable"); 
```

CSS：

```
.disable {
  // Note: pointer-events not supported by IE10 and under
  pointer-events: none;
  opacity: 0.4;
}
// Disable scrolling on child elements
.disable div,
.disable textarea {
  overflow: hidden;
} 
```

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2016-06-23T05:24:34.683

**这是给搜索者的，**

我做的最好的是，

```
$('#myDiv *').attr("disabled", true);                   
$('#myDiv *').fadeTo('slow', .6); 
```

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2017-09-09T15:55:28.513

正如评论中提到的，您仍然可以通过使用 tab 键在元素之间导航来访问元素。所以我推荐这个：

```
$("#mydiv")
  .css({"pointer-events" : "none" , "opacity" :  "0.4"})
  .attr("tabindex" , "-1"); 
```

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2012-08-27T14:44:19.420

我会使用 Cletus 功能的改进版本：

```
 $.fn.disable = function() {
    return this.each(function() {          
      if (typeof this.disabled != "undefined") {
        $(this).data('jquery.disabled', this.disabled);

        this.disabled = true;
      }
    });
};

$.fn.enable = function() {
    return this.each(function() {
      if (typeof this.disabled != "undefined") {
        this.disabled = $(this).data('jquery.disabled');
      }
    });
}; 
```

它存储元素的原始“禁用”属性。

```
$('#myDiv *').disable(); 
```

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2015-11-20T00:58:37.037

以下是屏蔽 div 启用的更全面的解决方案

*   没有单独的 CSS
*   覆盖整个页面或只是一个元素
*   指定蒙版颜色和不透明度
*   指定 Z-index 以便您可以在遮罩上显示弹出窗口
*   在面具上显示一个沙漏光标
*   删除 maksOff 上的遮罩 div，以便稍后显示不同的 div
*   元素调整大小时拉伸掩码
*   返回掩码元素，以便您可以对其进行样式设置等

还包括可以单独使用的hourglassOn和hourglassOff

```
// elemOrId - jquery element or element id, defaults to $('<body>')'
// settings.color defaults to 'transparent'
// settings.opacity defaults to 1
// settings.zIndex defaults to 2147483647
// if settings.hourglasss==true change cursor to hourglass over mask
function maskOn(elemOrId, settings) {
    var elem=elemFromParam(elemOrId);
    if (!elem) return;

    var maskDiv=elem.data('maskDiv');
    if (!maskDiv) {
        maskDiv=$('<div style="position:fixed;display:inline"></div>');
        $('body').append(maskDiv);
        elem.data('maskDiv', maskDiv);
    }

    if (typeof settings==='undefined' || settings===null) settings={};
    if (typeof settings.color==='undefined' || settings.color===null) settings.color='transparent';
    if (typeof settings.opacity==='undefined' || settings.opacity===null) settings.opacity=1;
    if (typeof settings.zIndex==='undefined' || settings.zIndex===null) settings.zIndex=2147483647;
    if (typeof settings.hourglass==='undefined' || settings.hourglass===null) settings.hourglass=false;

    // stretch maskdiv over elem
    var offsetParent = elem.offsetParent();
    var widthPercents=elem.outerWidth()*100/offsetParent.outerWidth()+'%';
    var heightPercents=elem.outerHeight()*100/offsetParent.outerHeight()+'%';
    maskDiv.width(widthPercents);
    maskDiv.height(heightPercents);
    maskDiv.offset($(elem).offset());

    // set styles
    maskDiv[0].style.backgroundColor = settings.color;
    maskDiv[0].style.opacity = settings.opacity;
    maskDiv[0].style.zIndex = settings.zIndex;

    if (settings.hourglass) hourglassOn(maskDiv);

    return maskDiv;
}

// elemOrId - jquery element or element id, defaults to $('<body>')'
function maskOff(elemOrId) {
    var elem=elemFromParam(elemOrId);
    if (!elem) return;

    var maskDiv=elem.data('maskDiv');
    if (!maskDiv) {
        console.log('maskOff no mask !');
        return;
    }

    elem.removeData('maskDiv');
    maskDiv.remove();
}

// elemOrId - jquery element or element id, defaults to $('<body>')'
// if decendents is true also shows hourglass over decendents of elemOrId, defaults to true
function hourglassOn(elemOrId, decendents) {
    var elem=elemFromParam(elemOrId);
    if (!elem) return;

    if (typeof decendents==='undefined' || decendents===null) decendents=true;

    if ($('style:contains("hourGlass")').length < 1) $('<style>').text('.hourGlass { cursor: wait !important; }').appendTo('head');
    if ($('style:contains("hourGlassWithDecendents")').length < 1) $('<style>').text('.hourGlassWithDecendents, .hourGlassWithDecendents * { cursor: wait !important; }').appendTo('head');
    elem.addClass(decendents ? 'hourGlassWithDecendents' : 'hourGlass');
}

// elemOrId - jquery element or element id, defaults to $('<body>')'
function hourglassOff(elemOrId) {
    var elem=elemFromParam(elemOrId);
    if (!elem) return;

    elem.removeClass('hourGlass');
    elem.removeClass('hourGlassWithDecendents');
}

function elemFromParam(elemOrId) {
    var elem;
    if (typeof elemOrId==='undefined' || elemOrId===null) 
        elem=$('body');
    else if (typeof elemOrId === 'string' || elemOrId instanceof String) 
        elem=$('#'+elemOrId);
    else
        elem=$(elemOrId);

    if (!elem || elem.length===0) {
        console.log('elemFromParam no element !');
        return null;
    }

    return elem;
} 
```

有了这个，你可以做例如：

```
maskOn(); // transparent page mask
maskOn(null, {color:'gray', opacity:0.8}); // gray page mask with opacity
maskOff(); // remove page mask
maskOn(div); // transparent div mask
maskOn(divId, {color:'gray', hourglass:true}); // gray div mask with hourglass
maskOff(div); // remove div mask 
```

见[jsfiddle](https://jsfiddle.net/wbsmhjL0/)

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2018-03-08T16:40:56.823

```
function disableItems(divSelector){
    var disableInputs = $(divSelector).find(":input").not("[disabled]");
    disableInputs.attr("data-reenable", true);
    disableInputs.attr("disabled", true);
}

function reEnableItems(divSelector){
    var reenableInputs = $(divSelector).find("[data-reenable]");
    reenableInputs.removeAttr("disabled");
    reenableInputs.removeAttr("data-reenable");
} 
```

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2012-01-15T06:44:52.170

在 jQuery 中，另一种方法是获取包含 DIV 的内部高度、内部宽度和位置，并简单地将另一个透明的 DIV 覆盖在相同大小的顶部。这将适用于该容器内的所有元素，而不仅仅是输入。

但请记住，在禁用 JS 的情况下，您仍然可以使用 DIV 输入/内容。上面的答案也一样。

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2013-09-20T05:31:17.247

```
$("#yourdivid textarea, #yourdivid input, #yourdivid select").attr('disabled',true); 
```

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2014-09-09T12:41:30.967

这个 css only/noscript 解决方案在字段集（或 div 或任何其他元素）上方添加了一个覆盖，防止交互：

```
fieldset { position: relative; }
fieldset[disabled]::after { content: ''; display: inline-block; position: absolute; top: 0; left: 0; right: 0; bottom: 0; pointer-events: all; background: rgba(128,128,128,0.2); } 
```

如果您想要一个不可见的即透明覆盖，请将背景设置为例如 rgba(128,128,128,0)，因为没有背景它将无法工作。以上适用于 IE9+。以下更简单的 css 将适用于 IE11+

```
[disabled] { pointer-events: none; } 
```

铬合金

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2016-04-19T11:57:00.267

如果您只是想阻止人们点击并且不担心安全性 - 我发现一个绝对放置的 div 具有 99999 的 z-index 排序很好。您无法单击或访问任何内容，因为 div 被放置在它上面。可能会更简单一些，并且是唯一的 CSS 解决方案，直到您需要将其删除。

* * *

## 回答 #26

> 赞同：-1
> 
> 时间：2016-06-28T10:44:44.060

编辑：下面我使用`.on()`了方法，而不是使用`.bind()`方法

```
$(this).bind('click', false);
$(this).bind('contextmenu', false); 
```

要删除您的设置，您可以使用`.unbind()`方法。而该`.off()`方法没有按预期工作。

```
 $(this).unbind('click', false);
 $(this).unbind('contextmenu', false); 
```

在研究了数百种解决方案之后！了解指针事件，下面是我所做的。

正如[**@Kokodoko**](https://stackoverflow.com/users/1083572/kokodoko)在他的解决方案中提到的，它适用于除 IE 之外的所有浏览器。`pointer-events`在**IE11**中工作，而不是在较低版本中。我还注意到在**IE11**中，指针事件对子元素不起作用。因此，如果我们有类似下面的东西

```
 <a href="www.preshmalinetpereira.wordpress.com"><i class="car icon"></i><span>My Blog</span></a> 
```

其中 span *-是子元素*，设置`pointer-events: none`不起作用

为了克服这个问题，我编写了一个函数，它可以作为 IE 的指针事件，并且可以在较低版本中工作。

**在 JS 文件中**

```
DisablePointerEvents(".DisablePointerEvents");

function DisablePointerEvents(classId) {
    $(classId).each(function () {
        $(this).on('click', false );
        $(this).on('contextmenu', false );
    });
} 
```

**在 CSS 文件中**

```
.DisablePointerEvents{
    pointer-events: none;
    opacity: 0.7;
    cursor: default;
} 
```

**在 HTML 中**

```
 <a href="www.preshmalinetpereira.wordpress.com" class="DisablePointerEvents"><i class="car icon"></i><span>My Blog</span></a> 
```

这伪造了不起作用的`pointer-events`情况以及发生上述子元素情况的情况。`pointer-events`

**JS Fiddle 也一样**

> [https://jsfiddle.net/rpxxrjxh/](https://jsfiddle.net/rpxxrjxh/)

* * *

## 回答 #27

> 赞同：-1
> 
> 时间：2016-11-24T09:55:15.773

> 最简单的解决方案

看看我的选择器

```
$myForm.find('#fieldsetUserInfo input:disabled').prop("disabled", false); 
```

`fieldsetUserInfo`is div 包含我要禁用或启用的所有输入

希望这对你有帮助

* * *

## 回答 #28

> 赞同：-1
> 
> 时间：2020-05-05T20:01:38.153

有一些可配置的 javascript 库接受 html 字符串或 dom 元素并去除不需要的标签和属性。这些被称为*html sanitizers*。例如：

*   [DOMPurify](https://github.com/cure53/DOMPurify)
*   [疯狂的](https://github.com/bevacqua/insane)
*   [清理-html](https://github.com/apostrophecms/sanitize-html)

例如在 DOMPurify

```
DOMPurify.sanitize('<div>abc<iframe//src=jAva&Tab;script:alert(3)>def</div>'); 
// becomes <div>abcdef</div> 
```

# c# - Linq 到 SQL 连接

> ID：639820
> 
> 赞同：2
> 
> 时间：2009-03-12T18:08:19.777
> 
> 标签：c#, linq, linq-to-sql, sqlconnection

我正在为一个相当复杂的站点使用 Linq to SQL，并且在上线后，我们遇到了许多数据库超时。我注意到的第一件事是与数据库有相当多的连接。

来自 ADO.net 背景，我们曾经对其进行编码，以便任何站点只使用一个或两个池连接，这导致即使有相当少的并发用户也可以获得可接受的性能。

所以我的问题是，这种旧的做法是有缺陷的，还是有办法做到 LINQ？似乎我们的性能问题是由与数据库的大量连接引起的，但如果这是一个问题，我会认为它会在所有 LINQ 教程中提到。

有什么建议么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-12T18:11:53.530

我猜你正在保留 DataContexts，而不是在完成后对它们调用 Dispose（或者至少将它们留在周围）。

相反，您应该初始化 DataContext，执行您的操作，然后在完成后将其丢弃。您不应该在操作之间持有对它的引用。

最好使用 using 语句来处理对 IDisposable 的调用。

关于连接池，默认情况下 SqlClient 池连接，因此除非您明确将其关闭，否则您应该已经利用它。当然，如果您不释放正在使用的连接，那么池化只会带您到此为止。

# python - Python：增量编组/腌制一个对象？

> ID：639821
> 
> 赞同：4
> 
> 时间：2009-03-12T18:08:33.957
> 
> 标签：python, serialization, data-structures, memory-management

我有一个大对象要序列化到磁盘。我发现[marshal](http://www.python.org/doc/2.5.2/lib/module-marshal.html)工作得很好，又好又快。

现在我正在创建我的大对象，然后调用 marshal.dump 。如果可能的话，我想避免将大对象保存在内存中——我想在构建它时逐步转储它。那可能吗？

该对象相当简单，是一个数组字典。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-14T00:57:24.043

bsddb 模块的 'hashopen' 和 'btopen' 函数提供了一个持久的类字典接口。也许您可以使用其中之一而不是常规字典来将数组增量序列化到磁盘？

```
import bsddb
import marshal

db = bsddb.hashopen('file.db')
db['array1'] = marshal.dumps(array1)
db['array2'] = marshal.dumps(array2)
...
db.close() 
```

要检索数组：

```
db = bsddb.hashopen('file.db')
array1 = marshal.loads(db['array1'])
... 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-14T07:22:53.103

您的对象所要做的就是成为列表字典，然后您就可以使用[搁置模块](http://www.python.org/doc/2.5.2/lib/module-shelve.html)。它提供了一个类似字典的界面，其中键和值存储在数据库文件中而不是内存中。可能会或可能不会影响您的一个限制是 Shelf 对象中的键必须是字符串。如果在创建 Shelf 对象时指定 protocol=-1 以使其使用更有效的二进制表示，则值存储将更有效。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-13T01:37:54.783

您应该能够将项目逐个转储到文件中。需要解决的两个设计问题是：

1.  当您将对象放入内存时，您是如何构建它的？
2.  当内存不足时，您如何需要数据？

如果您的构建过程一次填充与给定键关联的整个数组，您可能只是将 key:array 对作为单独的字典转储到文件中：

```
big_hairy_dictionary['sample_key'] = pre_existing_array
marshal.dump({'sample_key':big_hairy_dictionary['sample_key']},'central_file') 
```

然后在更新时，对 marshal.load('central_file') 的每次调用都会返回一个字典，您可以使用它来更新中央字典。但这真的只有当您需要返回数据时，您想要处理每个键读取一次“central_file”时才会有帮助。

或者，如果您以没有特定顺序逐个元素填充数组，则可以尝试：

```
big_hairy_dictionary['sample_key'].append(single_element)
marshal.dump(single_element,'marshaled_files/'+'sample_key') 
```

然后，当您将其加载回来时，您不一定需要构建整个字典来获取您需要的内容；您只需调用 marshal.load('marshaled_files/sample_key') 直到它返回 None，并且您拥有与密钥关联的所有内容。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-12T19:14:21.397

这在很大程度上取决于您如何构建对象。它是一个子对象数组吗？您可以在构建时编组/腌制每个数组元素。是字典吗？同样的想法适用（元帅/泡菜键）

如果它只是一个大而复杂的 harry 对象，您可能想要编组转储对象的每个部分，然后在您读回它时应用您的“构建”过程。

# php - 另一个托管问题：Linux、Apache2、PHP5、PostGreSQL 8.3

> ID：639822
> 
> 赞同：1
> 
> 时间：2009-03-12T18:08:58.933
> 
> 标签：php, linux, postgresql, apache2, hosting

我希望有人能够推荐一个提供以下环境的好的托管公司。我知道我可以只用谷歌搜索一个，但我先在这里问，因为我正在寻找以前与这样一家公司合作过的人。

1.  Linux 盒子。
2.  阿帕奇 2.0。
3.  PHP5（准确地说是 5.2.6）。
4.  PostGreSQL (8.3.1)。
5.  出色的技术支持，他们知道自己在做什么。

关于我为什么要寻找新主机的一些背景信息。我正在为当前托管他的网站的客户做一些自由 PHP 工作，名字以 H 开头，姓氏以 V 开头（匿名）。我确信他们是一家很棒的公司，但昨晚我第一次看到了他们的门户网站，坦率地说，它看起来像是在 90 年代开发的，这让我感到害怕。

我正在寻找一家现代化的托管公司（我的个人网站由 godaddy 托管，他们可能会得到所有负面影响，他们的托管控制中心是很棒的 IMO）。

我已经和我的客户谈过了，他们愿意更换托管公司，所以那里没有问题。我在已设置的本地计算机上完成所有工作，因此我希望能够与技术支持人员合作以获得相同的服务器设置。简单的事情，比如启用正确的 php 扩展和更改 ini 文件。还有一部分网站的访问由 http 身份验证控制，所以我还需要与技术人员合作以正确设置。访问网络根目录之外的文件夹也绝对是一个加分项（例如，据我所知，godaddy 不允许通过 ftp 进行此操作）。

之前在该站点工作的程序员与当前托管公司的技术人员进行了一些交谈，得到的印象是他们甚至无法正确设置 pg_hba.conf 文件。

我也在寻找一家已经提供 pgPhpAdmin 安装的公司，或者可以正确编辑 pg_hba.conf 文件以便我可以自己安装它的公司。我将完成的旧站点和新站点的数据库之间的差异非常大，因此在使站点联机并确认数据库设置正确时，拥有这样一个工具对我来说将是一个巨大的帮助.

无论如何，对于冗长的帖子感到抱歉，并感谢您的任何回复！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-12T18:47:33.863

[服务器格罗夫](http://www.servergrove.com/)

去一个 VPS 主机。到目前为止，我只有积极的经验，您几乎可以通过 SSH 自己做所有事情。它们非常有用且简单。另外，他们有一种我非常喜欢的环保意识方法。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-12T18:52:27.970

试试[网派](http://www.webfaction.com)。他们为您提供了一个预安装的环境（apache、php、postgres），您可以（如果需要）自己配置所有内容。Postgres 版本是 8.3.1，其他版本可以自己查看。Webfaction 有很好的支持，所以我建议你看看。

这个概念与 vps 有点不同：如果您使用他们的软件，您将获得定期更新。仅当您安装自己的软件（如 PHP）（这可能是因为完整的预安装构建必需品）时，您必须自己维护它。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-13T00:38:30.790

[鹰主机](http://www.hawkhost.com)

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2010-02-25T13:05:41.193

Godaddy.com 是另一种选择。

# crystal-reports - Crystal Reports 中的水平页面

> ID：639827
> 
> 赞同：0
> 
> 时间：2009-03-12T18:10:00.583
> 
> 标签：crystal-reports, report

如何设计我的报告以横向使用它？我真的需要更多的字段，所以垂直不会显示所有内容。

谢谢。

编辑：我需要页面是横向的而不是纵向的。

对不起，我的版本是 8.0。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-18T20:52:43.423

您应该能够从文件 > 打印...更改 Crystal 的打印机设置下的方向。

只要您的打印机支持横向打印，报告就会反映更改（如果打印机驱动程序不允许横向打印但您认为应该允许，请检查打印机驱动程序）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-17T04:02:21.433

取决于您是在设计时还是运行时尝试执行此操作，并且取决于您使用的 Crystal Reports 版本。通常你去文件->页面设置来改变纸张方向和大小。

编辑 - 该版本 Crystal 的运行时环境不支持在程序执行时通过 CrystalReport 对象更改纸张方向，仅在您设计报表时。选择要打印到的打印机时，您必须使用打印机选项更改方向。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-12-31T20:10:33.360

如果您右键单击您的报告，进入设计-> 页面设置，将会有一个方向选项卡来选择横向或纵向。

# c# - Active Record 模式的最佳实践和使用静态方法进行组操作

> ID：639830
> 
> 赞同：0
> 
> 时间：2009-03-12T18:10:39.507
> 
> 标签：c#, .net, activerecord, design-patterns

他们所说的关于设计模式的说法是真的，它们只是已经普遍使用的技术的体现。自 1985 年以来，我一直在使用 Active Record 模式。

此模式的属性之一是在实现中使用静态成员来执行返回基础数据集合的搜索。

```
class Customer { 
   static Customer FindCustomerById( int Id ) { ... } 
   static Customer[] FindActiveCustomers() { ... }
} 
```

在许多我需要更多灵活性的情况下，我会打破封装并包含一种方法，例如

```
static Customer[] FindCustomers( string criteria ) { ... } 
```

人们将其称为

```
Customer[] customers = Customer.FindCustomers( "LastName = 'Smith'" ); 
```

当然，这是我在 C 语言中使用这种模式时的保留，显然不是最佳实践，如果使用不当可能会导致 SQL 注入和其他问题。

是否可以应用合适的模式或实践，使 Customer 类成为此类搜索的“标准”？

例如，假设我想查找姓氏为 Smith 的客户，我可能会考虑编写一个实现，例如：

```
static Customer[] FindCustomers( Customer customer ) { ... } 
```

被称为（当然使用适当的构造函数）：

```
Customer[] customersnamedsmith = 
   Customer.FindCustomer( new Customer( "Smith" ) ); 
```

还是创建一个定义标准的同级更好？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-12T18:17:54.700

刚开始使用 LINQ，我喜欢传入表达式而不是字符串的想法。但是，也许这只是我？我也不喜欢 ActiveRecord，因为它在同一个对象中混合了状态和行为。漂亮的包装，但不是模型和数据访问的清晰分离。

我见过将客户类传递给活动记录的情况，但是如果您要走那条路，存储库模式会更加清晰，并且确实将行为与状态分开。但是，我认为使用您在活动记录中已有的投资并传递对象并没有错。

如果您想创建一个标准类，您最终会得到一些策略模式，这可以使您的活动记录比现在更加活跃。然而，这是一种适用的模式，也可以解决任何注入问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-12T18:27:01.310

尽管它会将您推出数据库级别，但您可以使用类似于比较器的东西。我不知道 C#，所以我只是捏造了它，但你明白了要点：

```
class CustomerLastNameEvaluator : IEvaluate
{
    private Customer _customer;

    public CustomerLastNameEvaluator (String lastName)
    {
        _customer = new Customer (lastName);
    }

    bool IEvaluate.Evaluate(Customer c)
    {
        return (_customer.LastName == c.LastName);
    }
}

Customer[] customers = Customer.FindCustomers( new CustomerLastNameEvaluator("Smith") ); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-12T19:48:50.723

没有理由不这样做，我会提供这样的方法：

```
public static IEnumerable<Customer> AllCustomers()
{
   return Customers.AsEnumerable();
} 
```

如果您有理由不这样做，则需要阐明这些原因并详细检查它们，以便设计正确的解决方案。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-08-12T16:30:18.577

查看 codeplex 上的 WWPlatform DataAccess 示例。它展示了一个将搜索规范实例作为参数提供的绝佳示例，尽管是通过存储库模式。

# php - 从数据库中选择值并选中复选框（如果它确实存在）

> ID：639831
> 
> 赞同：1
> 
> 时间：2009-03-12T18:11:14.247
> 
> 标签：php

```
//query to check if part id number exists in table ATTEND where service id = ...
$result2 = mysql_query("SELECT * FROM attend WHERE SIDno='$SIDno' and ServiceID='$id");
//if exists $ok = true;
  if (mysql_num_rows($result2)>0) {
        $ok == true;
  }
  echo "<tr bgcolor=$bgcolor>";
  echo "<td><a name=$row1[0] id=$row1[0]>$row1[0]</td>";
  echo "<td>" . $row1[1] . "</td>";
  echo "<td>" . $row1[5] . "</td>";
  echo "<td>" . $row1[2] . "</td>";
  echo "<td>" . $row1[3] . "</td>";
  echo "<td><input type='checkbox' name='checkbox[]' value=" . $row1[0];
  if ($ok == true) {
    echo 'disabled="disabled" checked="checked"';
  }
  echo "></td>";
  echo "<input type='hidden' name='ServiceID' value=" . $id . ">";
  echo "<input type='hidden' name='Year' value=" . $Year . ">";
  echo "<input type='hidden' name='Stype' value='Recollection'>";

  echo "</tr>";
  } 
}
echo "<tr>
<td colspan='5' align='right' bgcolor='#FFFFFF'><input name='SUBMIT1' type='submit' id='SUBMIT'value='SUBMIT'></td>
</tr>"; 
```

如果该复选框的值已经在数据库中可用，那么如何在下一次加载时实现它，现在将对其进行检查。但如果它还不存在，我可以检查它并将其保存到数据库中。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-12T18:39:17.333

我猜问题出在这一行：

```
if (mysql_num_rows($result2)>0) {
    $ok == true;
} 
```

它应该是：

```
if (mysql_num_rows($result2)>0) {
    $ok = true;
} 
```

在第一个代码段中，您只是测试 if `$ok`is equal to `true`，而在第二个示例中，执行了对变量的实际赋值。

记住：

```
= != == 
```

# windows - csrss.exe 进程有什么作用？

> ID：639832
> 
> 赞同：5
> 
> 时间：2009-03-12T18:11:25.557
> 
> 标签：windows, debugging, service, internals

Windows 上的 csrss.exe（客户端/服务器运行时服务器子系统）的用途是什么？

也许有人可以给出一个很好的解释或指向文档的指针？不幸的是，在搜索 Windows 的核心进程时，Google 的结果非常嘈杂。

我问的原因是我从我的服务应用程序中得到了一个 BSOD，这似乎与 csrss.exe 进程有关，至少这是内存转储分析显示的内容：

```
PROCESS_OBJECT: 85eeeb70

IMAGE_NAME:  csrss.exe

DEBUG_FLR_IMAGE_TIMESTAMP:  0
MODULE_NAME: csrss
FAULTING_MODULE: 00000000 
PROCESS_NAME:  PreviewService.
BUGCHECK_STR:  0xF4_PreviewService.
DEFAULT_BUCKET_ID:  DRIVER_FAULT
CURRENT_IRQL:  0
LAST_CONTROL_TRANSFER:  from 80998221 to 80876b40

STACK_TEXT:  
f5175d00 80998221 000000f4 00000003 85eeeb70 nt!KeBugCheckEx+0x1b
f5175d24 8095b1be 8095b1fa 85eeeb70 85eeecd4 nt!PspCatchCriticalBreak+0x75
f5175d54 8082350b 00000494 ffffffff 051bf114 nt!NtTerminateProcess+0x7a
f5175d54 7c8285ec 00000494 ffffffff 051bf114 nt!KiFastCallEntry+0xf8
051bf114 00000000 00000000 00000000 00000000 ntdll!KiFastSystemCallRet

STACK_COMMAND:  kb
FOLLOWUP_NAME:  MachineOwner
FAILURE_BUCKET_ID:  0xF4_PreviewService._IMAGE_csrss.exe
BUCKET_ID:  0xF4_PreviewService._IMAGE_csrss.exe

Followup: MachineOwner 
```

编辑：已经谢谢你的好答案，但我实际上不需要关于我的服务的帮助，我只是想对这项服务的目的有一些基本的了解。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-12T18:17:27.447

CSRSS 承载 Win32 子系统的服务器端。它被认为是一个系统关键进程，如果它被终止，你会得到一个蓝屏。需要更多数据，但您需要确定某个进程是否正在终止 csrss，或者它是否由于错误而崩溃。

[Windows Internals](https://rads.stackoverflow.com/amzn/click/com/0735625301)是一本很棒的书。 [维基百科](http://en.wikipedia.org/wiki/CSRSS)也有一篇关于 CSRSS 的文章。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-12T18:14:30.887

`csrss`是 Win32 子系统的用户模式部分——类似于内核模式 win32.sys 的用户模式。至于您的特定服务正在发生什么，如果没有关于您的服务在做什么的更好提示，很难说。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-08-20T10:40:25.180

它所做的一件事是为 cmd.exe 等控制台应用程序提供默认控制台窗口。至少根据jdeBP：

[在 Windows 上，控制台窗口所有权如何工作？](https://stackoverflow.com/questions/2807303/on-windows-how-does-console-window-ownership-work/2831185#2831185)

看起来，当创建控制台应用程序进程而没有将句柄传递给标准输入、标准输出和标准错误时，一些进程间通信会要求 csrss 在新线程中创建控制台窗口并将其 IO 句柄提供给控制台进程。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2018-08-17T05:33:29.530

它与图形系统有关。然而，现在这个名字背后有一个活跃的木马，它给人们带来了很多问题。我听说。它正在挖掘加密货币，由于 exe 进程本身是普通人很难检测到主要问题

# django - 验证对象是否存在于 django 视图中而不返回 404 的正确方法是什么？

> ID：639836
> 
> 赞同：97
> 
> 时间：2009-03-12T18:12:31.513
> 
> 标签：django, django-views

我需要验证对象是否存在并返回该对象，然后根据该对象执行操作。不返回 404 的正确方法是什么？

```
try:
    listing = RealEstateListing.objects.get(slug_url = slug)
except:
    listing = None

if listing: 
```

* * *

## 回答 #1

> 赞同：216
> 
> 时间：2011-12-16T19:10:18.393

你也可以这样做：

```
if not RealEstateListing.objects.filter(slug_url=slug).exists():
    # do stuff... 
```

有时使用块更清晰，`try: except:`有时单行使`exists()`代码看起来更清晰......这一切都取决于您的应用程序逻辑。

* * *

## 回答 #2

> 赞同：126
> 
> 时间：2009-03-12T19:24:12.187

如果您没有获得 404，我不会使用 404 包装器。这是对意图的滥用。相反，只需抓住DoesNotExist。

```
try:
    listing = RealEstateListing.objects.get(slug_url=slug)
except RealEstateListing.DoesNotExist:
    listing = None 
```

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2017-04-12T13:06:18.820

```
listing = RealEstateListing.objects.filter(slug_url=slug).first() 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2020-01-22T09:50:56.070

我会这样做很简单，如下所示：

```
listing = RealEstateListing.objects.filter(slug_url=slug)
if listing:
    # do stuff 
```

我认为不需要尝试/捕获。如果结果中可能有多个对象，则使用 first() 如用户 Henrik Heino 所示

# encryption - 文件夹加密

> ID：639845
> 
> 赞同：0
> 
> 时间：2009-03-12T18:15:16.563
> 
> 标签：encryption, directory

是否有类似于 VIM 的“vim -x 文件”的目录加密变体？我正在寻找类似“mkdir -encrypt 文件夹”的东西。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-12T19:55:44.217

[TrueCrypt](http://www.truecrypt.org/docs/?s=command-line-usage) 它是开源的，支持多种类型的加密。你想知道什么操作系统？

编辑：Windows Vista/XP、Mac OS X 和 Linux 都支持。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-12T20:10:37.270

没有“通用”的方式来加密目录（即，一种适用于所有文件和操作系统的方式）（见下文）。

但是，您可以（如 Dante 所述）使用 TrueCrypt 在文件中创建加密文件系统，然后挂载（Windows 术语中的“附加”？）该文件。

如果您使用的是 Linux，您甚至可以将该文件挂载到特定目录，以使该目录*看起来*是加密的。

如果您想知道如何使用 TrueCrypt，请在​​此处查看适用于 Windows 的文档：[http](http://www.truecrypt.org/docs/?s=tutorial) ://www.truecrypt.org/docs/?s=tutorial和适用于 Linux 的文档：http: [//www.howtoforge.com/truecrypt_data_encryption](http://www.howtoforge.com/truecrypt_data_encryption) (向下滚动到“TrueCrypt 下载”标题）。

因此，快速解释一下为什么可以加密文件但不能加密目录：
就“计算机”（即硬件、操作系统、文件系统驱动程序等）而言，“文件”只是“一堆磁盘”（就像一本书“只是纸上的一堆墨水”一样）。当程序读取或写入文件时，它可以读取或写入它想要的任何内容 - 因此，如果该程序想要在将某些数据写入文件之前加密某些数据，或者读取文件然后解密它读取的数据， 伟大的。

但是，目录是另一回事：要读取（即列出）或写入（即创建）目录，程序（无论是 、`mkdir`、`ls`Windows Explorer 还是 Finder）必须询问操作系统，然后操作系统询问文件系统驱动程序“嘿，你能创建目录 /foo/bar 吗？” 或者“嘿，你能告诉我 /bar/baz 里有什么吗？” - 所有程序或操作系统（基本上）看到的都是创建目录的函数和列出目录内容的函数。

因此，要加密目录，您可以看到它必须是执行加密的文件系统驱动程序，而不是创建/列出目录的程序......并且没有现代文件系统支持每个目录加密。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-12T20:17:22.807

在 Linux 上，最简单的方法可能是使用[EncFS](http://www.arg0.net/encfs)

*“EncFS 在用户空间提供加密文件系统。它无需任何特殊权限即可运行，并使用 FUSE 库和 Linux 内核模块提供文件系统接口。”*

它基本上将加密文件夹安装为普通文件夹。

[有关维基百科](http://en.wikipedia.org/wiki/EncFS)的更多信息

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2015-08-03T16:23:28.477

我会推荐*企业加密文件系统*，即在 Debian/Ubuntu 中`ecryptfs`找到的，`apt-get`因为`ecryptfs-utils`比 TrueCrypt 更灵活。这可能是这里加密目录的最强方式之一。它可以与两个密码一起使用：登录密码和密码，因此使其成为一种双密码系统。它也是 POSIX 实现的。与许多其他加密系统一样，该系统的局限性在于它仅支持最高`144`255 个 Linux 标准的文件名/目录名。维护了四年，最后一次更新是在 4 个月前，所以对未来来说是一件好事。

[这篇博](https://news.ycombinator.com/item?id=8059218)文中 TrueCrypt 和 encryptfs 之间的比较

> Truecrypt 是模拟硬件加密。它创建了一个虚拟加密硬盘，您的操作系统或多或少可以将其视为普通硬盘，但 Truecrypt 添加了用于锁定和解锁磁盘的内核挂钩。EcryptFS 是一个加密的文件系统。与加密单个磁盘块的 Truecrypt 不同，像 EcryptFS 这样的系统加密和解密整个文件。

以及两个系统之间的更多[比较](https://askubuntu.com/a/393191/25388)：

> 这些复杂性（以及 ecryptfs 速度较慢的事实）是人们喜欢 TrueCrypt 之类的块级加密的部分原因，但我确实欣赏 ecryptfs 的灵活性。

# mysql - 在警告消息中查找由数字标识的 MySQL 行

> ID：639846
> 
> 赞同：3
> 
> 时间：2009-03-12T18:15:25.860
> 
> 标签：mysql

MySQL“显示警告”输出按编号识别有问题的行。快速查看此类行的所有数据的最佳方法是什么？

例如，运行一条`update`语句后，结果显示“1 个警告”，运行时`show warnings`会显示如下消息：“第 65278 行的“人员”列的数据被截断”。如何准确选择该行？

这是一个探索`limit`解决方案的具体示例：

```
create table test1 (
  id     mediumint,
  value  varchar(2)
);
insert into test1 (id, value) values
  (11, "a"),
  (12, "b"),
  (13, "c"),
  (14, "d"),
  (15, "ee"),
  (16, "ff");
update test1 set value = concat(value, "X") where id % 2 = 1;
show warnings; 
```

这导致此警告输出：

```
+---------+------+--------------------------------------------+
| Level   | Code | Message                                    |
+---------+------+--------------------------------------------+
| Warning | 1265 | Data truncated for column 'value' at row 5 | 
+---------+------+--------------------------------------------+ 
```

要获得第 5 行，我可以这样做：

```
select * from test1 limit 4,1; 
```

结果是：

```
+------+-------+
| id   | value |
+------+-------+
|   15 | ee    | 
+------+-------+ 
```

所以看起来`limit`偏移量（4）一定比行号小一，警告中给出的行号是针对更新的源表而不考虑`where`子句的。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-12T18:52:32.043

据我所知，选择这些行的唯一方法是`SELECT`使用原始`UPDATE`查询中的条件来选择它们：

```
mysql> UPDATE foo SET bar = "bar" WHERE baz = "baz";
mysql> SHOW WARNINGS;
...
Message: Data truncated for column 'X' at row 420
...
mysql> SELECT * FROM foo WHERE baz = "baz" LIMIT 420,1; 
```

显然，如果您修改了原始查询中的一个或多个列，这将不起作用。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-07-18T07:24:03.367

LIMIT x,y 根据您的选择查询中的结果集的顺序，在行 x 之后返回 y 行。但是，如果您仔细查看我刚才所说的内容，您会注意到如果没有 ORDER BY 子句，您将无法保证您尝试获取的行的位置。

您可能希望将自动增量字段添加到您的插入中，或者可能是在每次插入之前触发的触发器，然后使用该索引来确保限制结果的顺序。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2015-05-27T06:37:34.023

不是从死里提出这个问题，而是我将添加另一种方法来查找在某些情况下可能会有所帮助的警告数据的来源。

如果您将完整的数据集从一个表导入到另一个表并在特定字段上收到截断警告，您可以运行查询以 ID 值连接两个表，然后按相关字段不匹配的记录进行过滤。显然，这仅在您从单独的表导入并且仍然可以访问未修改的源表时才有效。

因此，如果有问题的字段是`testfield`并且您的导入查询如下所示：

```
INSERT INTO newtable (
  id,
  field1,
  field2,
  testfield
)
SELECT
  id,
  field1,
  field2,
  testfield
FROM oldtable; 
```

诊断查询可能如下所示：

```
SELECT newtable.testfield, oldtable.testfield
FROM newtable
INNER JOIN oldtable ON newtable.id = oldtable.id
WHERE newtable.testfield != oldtable.testfield; 
```

这具有额外的优势，即任一表中的记录顺序都无关紧要。

# gcc - 在 gcc 中的 x86 AT&T-Assembler 中复制和调用函数

> ID：639848
> 
> 赞同：1
> 
> 时间：2009-03-12T18:16:02.817
> 
> 标签：gcc, assembly, x86

我在 AT&T 汇编器语法中为 gcc 编写了以下代码

```
.global main
.section .data

to_gen_inner: #x f, implicit n
        pushl %ebp
        movl %esp, %ebp
        movl $0xFF00FF00, %eax
        call printregs
        lret

.set to_gen_inner_len, . - to_gen_inner

.section .text

main:
        pushl %ebp
        movl %esp, %ebp

        #allocate memory
        pushl $to_gen_inner_len
        call malloc
        popl %ecx

        pushl $to_gen_inner_len
        pushl to_gen_inner
        pushl %eax
        call copy_bytes
        popl %eax
        popl %ecx
        popl %ecx

        lcall *(%eax)

        movl %ebp, %esp
        popl %ebp
        ret

printfregs:
        .ascii "eax: %8X\nebx: %8X\necx: %8X\nedx: %8X\n\0"

printregs:
        pushl %edx
        pushl %ecx
        pushl %ebx
        pushl %eax
        pushl $printfregs
        call printf
        popl %ecx
        popl %eax
        popl %ebx
        popl %ecx
        popl %edx
        lret

copy_bytes: #dest source length
        pushl %ebp
        movl %esp, %ebp

        subl $24, %esp

        movl 8(%ebp), %ecx # dest
        movl %eax, -4(%ebp)

        movl 12(%ebp), %ebx # source
        movl %eax, -8(%ebp)

        movl 16(%ebp), %eax # length
        movl %eax, -12(%ebp)

        addl %eax, %ecx # last dest-byte
        movl %ecx, -16(%ebp)

        addl %eax, %edx # last source-byte
        movl %ecx, -20(%ebp)

        movl -4(%ebp), %eax
        movl -8(%ebp), %ebx
        movl -16(%ebp), %ecx

        copy_bytes_2:
        movb (%ebx), %dl
        movb %dl, (%eax)
        incl %eax
        incl %ebx
        cmp %eax, %ecx
        jne copy_bytes_2

        movl %ebp, %esp
        popl %ebp
        ret 
```

实际上，我想要做的是将函数代码复制`to_gen_inner`到我用malloc分配的内存中，然后跳转到它。此代码产生分段错误。gdb 说：

```
Program received signal SIGSEGV, Segmentation fault.
main () at speicher3.S:32
32              lcall *(%eax)
Current language:  auto; currently asm
(gdb) disas $pc-5 $pc+5
Dump of assembler code from 0x80483eb to 0x80483f5:
0x080483eb <main+23>:   add    %al,(%eax)
0x080483ed <main+25>:   pop    %eax
0x080483ee <main+26>:   pop    %ecx
0x080483ef <main+27>:   pop    %ecx
0x080483f0 <main+28>:   lcall  *(%eax)
0x080483f2 <main+30>:   mov    %ebp,%esp
0x080483f4 <main+32>:   pop    %ebp
End of assembler dump.
(gdb) disas $pc-6 $pc+5
Dump of assembler code from 0x80483ea to 0x80483f5:
0x080483ea <main+22>:   add    %al,(%eax)
0x080483ec <main+24>:   add    %bl,0x59(%eax)
0x080483ef <main+27>:   pop    %ecx
0x080483f0 <main+28>:   lcall  *(%eax)
0x080483f2 <main+30>:   mov    %ebp,%esp
0x080483f4 <main+32>:   pop    %ebp
End of assembler dump.
(gdb) 
```

我其实不知道为什么。我已经在使用 lcall 和 lret，我读过它被认为是绝对调用，使用 call 和 ret，它也不起作用，同样的错误。

我不知道我做错了什么。有人可以帮我吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-12T21:39:17.243

您有以下问题：

*   在为调用 copy_bytes 设置堆栈时，您希望 pushl $to_gen_inner 而不是 pushl to_gen_inner （后者将内存内容推送到 to_gen_inner 指向的位置）

*   将值复制到 copy_bytes 内的本地堆栈帧时，您需要写入刚刚读取参数的寄存器，而不是始终写入 EAX

*   lcall *(%eax) 期望从 EAX 指向的内存中读取一个地址，然后跳转到那里。此外，它预计读取 48 个字节，前 16 个是段。我已将您的 lcall 替换为 call *%eax; 也相应地用 rets 替换了 lrets。

*   对 printregs 的调用被汇编为相对调用，因为您正在执行的指令不再与目标的相对偏移量与汇编时相同。我已将其替换为

    ```
    movl $printregs, %ecx
    call *%ecx 
    ```

（这会破坏 %ecx）

*   最后， to_gen_inner 在进入时设置堆栈帧，但在退出时未能销毁它

修复所有这些后，代码如下所示：

```
.global main
.section .data

to_gen_inner: #x f, implicit n
        pushl %ebp
        movl %esp, %ebp
        movl $0xFF00FF00, %eax
        movl $printregs, %ecx
        call *%ecx
        movl %ebp, %esp
        popl %ebp        
        ret

.set to_gen_inner_len, . - to_gen_inner

.section .text

main:
        pushl %ebp
        movl %esp, %ebp

        #allocate memory
        pushl $to_gen_inner_len
        call malloc
        popl %ecx

        pushl $to_gen_inner_len
        pushl $to_gen_inner
        pushl %eax
        call copy_bytes
        popl %eax
        popl %ecx
        popl %ecx

        call *%eax

        movl %ebp, %esp
        popl %ebp
        ret

printfregs:
        .ascii "eax: %8X\nebx: %8X\necx: %8X\nedx: %8X\n\0"

printregs:
        pushl %edx
        pushl %ecx
        pushl %ebx
        pushl %eax
        pushl $printfregs
        call printf
        popl %ecx
        popl %eax
        popl %ebx
        popl %ecx
        popl %edx
        ret

copy_bytes: #dest source length
        pushl %ebp
        movl %esp, %ebp

        subl $24, %esp

        movl 8(%ebp), %ecx # dest
        movl %ecx, -4(%ebp)

        movl 12(%ebp), %ebx # source
        movl %ebx, -8(%ebp)

        movl 16(%ebp), %eax # length
        movl %eax, -12(%ebp)

        addl %eax, %ecx # last dest-byte
        movl %ecx, -16(%ebp)

        addl %eax, %edx # last source-byte
        movl %ecx, -20(%ebp)

        movl -4(%ebp), %eax
        movl -8(%ebp), %ebx
        movl -16(%ebp), %ecx

        copy_bytes_2:
        movb (%ebx), %dl
        movb %dl, (%eax)
        incl %eax
        incl %ebx
        cmp %eax, %ecx
        jne copy_bytes_2

        movl %ebp, %esp
        popl %ebp
        ret 
```

...它在这里为我构建和运行。希望有帮助。

# jboss - JMS消息的并行处理？

> ID：639852
> 
> 赞同：1
> 
> 时间：2009-03-12T18:16:34.063
> 
> 标签：jboss, jms

是否可以创建消息侦听器池或消息驱动 Bean 以并行处理来自 JMS 队列或主题的消息？

我正在使用 JBoss 和 JBoss 的 JMS

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-12T18:20:40.870

是的，如果 MDB 池大小大于 1，JBoss 应该创建多个 MDB 来并行处理消息。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-12T18:21:29.497

绝对地。我已经使用 JMS 队列创建了一个多服务器侦听器池，以便处理大量事务。您可以使用竞争消费者模式。我使用了一个修改过的，因为我们需要在帐​​户中按顺序处理消息。我们使用租用机制将服务器分配到帐号范围，提供故障转移和可扩展性。

我们使用的是 Tibco 的 JMS 提供程序，但它适用于任何 JMS 提供程序。

# sql - 检查一行是否存在，否则插入

> ID：639854
> 
> 赞同：258
> 
> 时间：2009-03-12T18:17:29.833
> 
> 标签：sql, sql-server, sql-server-2008, tsql

我需要编写一个 T-SQL 存储过程来更新表中的一行。如果该行不存在，则插入它。所有这些步骤都由事务包装。

这是一个预订系统，所以它必须是**原子的和可靠的**。如果事务已提交且航班已预订，则它必须返回 true。

我是**T-SQL 新手**，不知道如何使用`@@rowcount`. 这是我一直写到现在的。我在正确的道路上吗？我相信这对你来说是一个简单的问题。

```
-- BEGIN TRANSACTION (HOW TO DO?)

UPDATE Bookings
 SET TicketsBooked = TicketsBooked + @TicketsToBook
 WHERE FlightId = @Id AND TicketsMax < (TicketsBooked + @TicketsToBook)

-- Here I need to insert only if the row doesn't exists.
-- If the row exists but the condition TicketsMax is violated, I must not insert 
-- the row and return FALSE

IF @@ROWCOUNT = 0 
BEGIN

 INSERT INTO Bookings ... (omitted)

END

-- END TRANSACTION (HOW TO DO?)

-- Return TRUE (How to do?) 
```

* * *

## 回答 #1

> 赞同：180
> 
> 时间：2009-03-12T18:21:41.260

我假设每个航班只有一行？如果是这样：

```
IF EXISTS (SELECT * FROM Bookings WHERE FLightID = @Id)
BEGIN
    --UPDATE HERE
END
ELSE
BEGIN
   -- INSERT HERE
END 
```

我假设我所说的那样，因为您的处理方式可能会超额预订航班，因为当最多有 10 张机票并且您预订 20 张时，它将插入一个新行。

* * *

## 回答 #2

> 赞同：166
> 
> 时间：2009-03-13T04:34:59.850

看看[**MERGE**](http://msdn.microsoft.com/en-us/library/bb510625.aspx)命令。您可以在一个语句中执行`UPDATE`, `INSERT`& 。`DELETE`

这是一个使用的工作实现`MERGE`
- 它在进行更新之前检查航班是否已满，否则进行插入。

```
if exists(select 1 from INFORMATION_SCHEMA.TABLES T 
              where T.TABLE_NAME = 'Bookings') 
begin
    drop table Bookings
end
GO

create table Bookings(
  FlightID    int identity(1, 1) primary key,
  TicketsMax    int not null,
  TicketsBooked int not null
)
GO

insert  Bookings(TicketsMax, TicketsBooked) select 1, 0
insert  Bookings(TicketsMax, TicketsBooked) select 2, 2
insert  Bookings(TicketsMax, TicketsBooked) select 3, 1
GO

select * from Bookings 
```

接着 ...

```
declare @FlightID int = 1
declare @TicketsToBook int = 2

--; This should add a new record
merge Bookings as T
using (select @FlightID as FlightID, @TicketsToBook as TicketsToBook) as S
    on  T.FlightID = S.FlightID
      and T.TicketsMax > (T.TicketsBooked + S.TicketsToBook)
  when matched then
    update set T.TicketsBooked = T.TicketsBooked + S.TicketsToBook
  when not matched then
    insert (TicketsMax, TicketsBooked) 
    values(S.TicketsToBook, S.TicketsToBook);

select * from Bookings 
```

* * *

## 回答 #3

> 赞同：72
> 
> 时间：2010-04-15T13:03:55.507

在测试行是否存在时传递 updlock、rowlock、holdlock 提示。

```
begin tran /* default read committed isolation level is fine */

if not exists (select * from Table with (updlock, rowlock, holdlock) where ...)
    /* insert */
else
    /* update */

commit /* locks are released here */ 
```

如果行已经存在，updlock 提示会强制查询对其进行更新锁定，以防止其他事务修改它，直到您提交或回滚。

holdlock 提示强制查询采用范围锁定，防止其他事务添加与您的过滤条件匹配的行，直到您提交或回滚。

rowlock 提示将锁定粒度强制为行级别而不是默认页面级别，因此您的事务不会阻止尝试更新同一页面中不相关行的其他事务（但请注意减少争用和增加锁定开销 - 您应该避免在单个事务中使用大量行级锁定）。

有关详细信息，请参阅[http://msdn.microsoft.com/en-us/library/ms187373.aspx](http://msdn.microsoft.com/en-us/library/ms187373.aspx)。

请注意，锁定是在执行获取它们的语句时采用的——调用 begin tran 并不能让您免受另一个事务在您到达某物之前对其进行挤压锁定。您应该尝试通过尽快提交事务（晚获取，早释放）来尝试考虑您的 SQL 以在尽可能短的时间内保持锁定。

请注意，如果您的 PK 是 bigint，则行级锁可能不太有效，因为 SQL Server 上的内部散列对于 64 位值是退化的（不同的键值可能散列到相同的锁 id）。

* * *

## 回答 #4

> 赞同：46
> 
> 时间：2013-02-25T00:48:04.810

我正在写我的解决方案。我的方法不支持“如果”或“合并”。我的方法很简单。

```
INSERT INTO TableName (col1,col2)
SELECT @par1, @par2
   WHERE NOT EXISTS (SELECT col1,col2 FROM TableName
                     WHERE col1=@par1 AND col2=@par2) 
```

例如：

```
INSERT INTO Members (username)
SELECT 'Cem'
   WHERE NOT EXISTS (SELECT username FROM Members
                     WHERE username='Cem') 
```

**解释：**

(1) SELECT col1,col2 FROM TableName WHERE col1=@par1 AND col2=@par2 从 TableName 搜索值中选择

(2) SELECT @par1, @par2 WHERE NOT EXISTS 如果不存在则取自 (1) 子查询

(3) 插入 TableName (2) 步骤值

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2015-01-05T21:46:41.690

我终于能够使用以下模型插入一行，条件是它不存在：

```
INSERT INTO table ( column1, column2, column3 )
(
    SELECT $column1, $column2, $column3
      WHERE NOT EXISTS (
        SELECT 1
          FROM table 
          WHERE column1 = $column1
          AND column2 = $column2
          AND column3 = $column3 
    )
) 
```

我发现在：

[http://www.postgresql.org/message-id/87hdow4ld1.fsf@stark.xeocode.com](http://www.postgresql.org/message-id/87hdow4ld1.fsf@stark.xeocode.com)

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-03-12T18:23:51.253

这是我最近不得不做的事情：

```
set ANSI_NULLS ON
set QUOTED_IDENTIFIER ON
GO
ALTER PROCEDURE [dbo].[cjso_UpdateCustomerLogin]
    (
      @CustomerID AS INT,
      @UserName AS VARCHAR(25),
      @Password AS BINARY(16)
    )
AS 
    BEGIN
        IF ISNULL((SELECT CustomerID FROM tblOnline_CustomerAccount WHERE CustomerID = @CustomerID), 0) = 0
        BEGIN
            INSERT INTO [tblOnline_CustomerAccount] (
                [CustomerID],
                [UserName],
                [Password],
                [LastLogin]
            ) VALUES ( 
                /* CustomerID - int */ @CustomerID,
                /* UserName - varchar(25) */ @UserName,
                /* Password - binary(16) */ @Password,
                /* LastLogin - datetime */ NULL ) 
        END
        ELSE
        BEGIN
            UPDATE  [tblOnline_CustomerAccount]
            SET     UserName = @UserName,
                    Password = @Password
            WHERE   CustomerID = @CustomerID    
        END

    END 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-12T18:25:20.313

您可以使用[合并](http://msdn.microsoft.com/en-us/library/bb510625.aspx)功能来实现。否则你可以这样做：

```
declare @rowCount int

select @rowCount=@@RowCount

if @rowCount=0
begin
--insert.... 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2017-04-03T05:23:24.643

```
INSERT INTO [DatabaseName1].dbo.[TableName1] SELECT * FROM [DatabaseName2].dbo.[TableName2]
 WHERE [YourPK] not in (select [YourPK] from [DatabaseName1].dbo.[TableName1]) 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2013-10-01T23:41:03.460

完整的解决方案如下（包括游标结构）。非常感谢 Cassius Porcus 提供`begin trans ... commit`上面发布的代码。

```
declare @mystat6 bigint
declare @mystat6p varchar(50)
declare @mystat6b bigint

DECLARE mycur1 CURSOR for

 select result1,picture,bittot from  all_Tempnogos2results11

 OPEN mycur1

 FETCH NEXT FROM mycur1 INTO @mystat6, @mystat6p , @mystat6b

 WHILE @@Fetch_Status = 0
 BEGIN

 begin tran /* default read committed isolation level is fine */

 if not exists (select * from all_Tempnogos2results11_uniq with (updlock, rowlock, holdlock)
                     where all_Tempnogos2results11_uniq.result1 = @mystat6 
                        and all_Tempnogos2results11_uniq.bittot = @mystat6b )
     insert all_Tempnogos2results11_uniq values (@mystat6 , @mystat6p , @mystat6b)

 --else
 --  /* update */

 commit /* locks are released here */

 FETCH NEXT FROM mycur1 INTO @mystat6 , @mystat6p , @mystat6b

 END

 CLOSE mycur1

 DEALLOCATE mycur1
 go 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2022-01-05T22:02:48.957

将数据从 T1 复制到 T2 并避免在 T2 中重复的简单方法

```
--Insert a new record
INSERT INTO dbo.Table2(NoEtu, FirstName, LastName)
SELECT t1.NoEtuDos, t1.FName, t1.LName 
FROM dbo.Table1 as t1
WHERE NOT EXISTS (SELECT (1) FROM dbo.Table2  AS t2
                    WHERE t1.FName = t2.FirstName
                        AND t1.LName = t2.LastName
                        AND t1.NoEtuDos = t2.NoEtu) 
```

* * *

## 回答 #11

> 赞同：-2
> 
> 时间：2015-03-27T22:45:03.063

```
INSERT INTO table ( column1, column2, column3 )
SELECT $column1, $column2, $column3
EXCEPT SELECT column1, column2, column3
FROM table 
```

* * *

## 回答 #12

> 赞同：-2
> 
> 时间：2018-07-12T15:03:30.047

解决此问题的最佳方法是首先使数据库列 UNIQUE

`ALTER TABLE table_name ADD UNIQUE KEY`

`THEN INSERT IGNORE INTO table_name`，如果导致重复键/表中已经存在，则不会插入该值。

# svn - 如何安装 apache 便携式运行时

> ID：639858
> 
> 赞同：0
> 
> 时间：2009-03-12T18:18:09.583
> 
> 标签：svn, apache, runtime, portability

我正在尝试在 linux 机器上安装 subversion 并得到错误提示我没有安装 APR

我的问题是：如何安装 APR 并与我的 Apache HTTP 服务器链接（我正在运行 2.2）？

我已经找了大约 2 个小时的文档，......找不到任何东西......我还想提一下，我是一个相当大的 unix 新手。

将我指向正确的方向将不胜感激。

安德鲁

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-12T18:40:13.633

Apache Portable Runtime 与 apache 服务器一起安装。您所要做的就是确保您的 LD_LIBRARY_PATH 包含 <APACHEINSTALLDIR>/lib 的路径，并且它将被您的 svn 检测到。

# javascript - JQuery 1.3.2 中的“递归过多”错误

> ID：639862
> 
> 赞同：16
> 
> 时间：2009-03-12T18:19:46.630
> 
> 标签：javascript, jquery

我正在尝试制作具有一些动态行为的表单。具体来说，我在 div 中有我的输入，我想让它这样当用户单击 div 中的任何位置时，输入被选中。我使用的是 JQuery 1.2.6，一切正常。

但是，我升级到 JQuery 1.3.2 并且出现了一些奇怪的行为。当我单击任何输入时，在选择它之前会出现延迟。我的 Firefox 错误控制台在 JQuery 库中给了我几个“递归过多”的错误。我在 Internet Explorer 7 中尝试了该页面并收到错误消息“对象不支持此属性或方法”。

我做错了什么，或者这是 JQuery 中的错误？有谁知道在不回到旧版本的情况下解决此问题的方法？我正在使用 Firefox 3.0.7 以防万一。这是我为说明问题而制作的一个简单示例：

```
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>quiz test</title>
<script type="text/javascript" src="jquery-1.3.2.min.js"></script>
</head>
<body>
<div class='question'>Favorite soda?
    <div><input type='radio' name='q' value='A' id='a'><label for='a'>Coke</label></div>
    <div><input type='radio' name='q' value='B' id='b'><label for='b'>Pepsi</label></div>
    </div>
<script type="text/javascript">
$(function() {
    $(".question div").click(function() {
        $(this).children("input").click();
    });
});
</script>
</body></html> 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-12T18:23:58.773

```
$(function() {
    $(".question div").click(function() {
        var radio = $(this).children("input")[0];
        radio.checked = !radio.checked;
    });
}); 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-12T18:26:35.147

是的，点击事件会冒泡……所以当你加注时`$(this).children("input").click()`，你`$(".question div").click()`又在加注，以此类推。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-12T18:35:18.170

如果您已经在使用，为什么还需要这样做`<label for="">`？无论如何，单击标签应该会激活无线电控制。

**[编辑：]**跟进您的评论，您可以这样做：

使标签显示为块元素，应用您用于 div 包装字段的所有样式。

```
.question label { display:block } 
```

然后使用这个布局。如果div也可以摆脱。

```
<label><input type="radio">Coke</label>
<label><input type="radio">Pepsi</label> 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-12T19:05:51.153

仅`click()`当事件的目标是 div 时触发，即

```
$(function() {
    $(".question div").click(function(event) {
        if($(event.target).is('div'))
            $(this).children("input").click();
    });
}); 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2010-12-01T11:00:17.247

当我要让我的 div 提交它的子输入时，我遇到了同样的问题：提交。这将解决问题：

```
$(function() {
    $(".question div").click(function() {
        $(this).children("input").click(function(event){
            event.stopPropagation();
        });
        $(this).children("input").trigger("click");
    });}); 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-12T20:42:57.533

问题（正如 grilix 所说）是事件“冒泡”DOM，因此，有一个简单的解决方案，您只需要取消该冒泡效果。

气泡是指（简单的英语）一个事件，由于它在文档中的位置而在所有受影响的元素上触发。因此，在您的示例中，“单击”事件由（按此顺序）BODY 接收，然后是父级（.question）DIV，然后是另一个 DIV，最后由 INPUT 接收。

要取消气泡，您可以使用 jQuery 方法，在回调函数中调用 stopPropagation 方法，如下所示：

```
$(function() {
    $(".question div").click(function(event) {
        $(this).children("input").click();
        event.stopPropagation();
    });
}); 
```

普通的 javascript 方式需要您使用 cancelBubble 方法，但我想这超出了您的问题范围。

问候，马诺洛

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2010-11-02T14:34:59.767

```
<script type="text/javascript">
$(function() {
    $(".question div").click(function() {
        $(this).find("input").attr("checked", "checked");
    });
});
</script> 
```

PS：递归太多可能是因为您停止传播 div 的点击，而不是输入的点击。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-12T18:47:42.070

我不记得如何使用 jQuery 检查收音机，但可能是这样的：

```
<script type="text/javascript">
$（函数（）{
    $(".question div").click(function() {
        $(this).children("input").checked(true);
// 或者
        $(this).children("input").checked=true;
    });
});
</脚本>

```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-12T18:59:29.843

我知道这可能根本不是答案，但我正在写它，因为它发生在我身上：当我在同一个项目中使用 jquery 和原型时，它给了我“太多递归”错误，这也可能发生在 ajax .net 与 jquery，因此如果您使用多个库，请确保库之间没有冲突。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-03-12T19:11:16.663

谢谢你们。我尝试了grillix 设置checked 属性的想法，尽管我不得不稍微修正一下语法。这是我所做的：

```
$(this).children("input").attr("checked", true); 
```

它有效，但我仍然很好奇为什么我以前的方式停止使用 JQuery 1.3.2。我知道事件冒泡行为的变化，但为什么我不能通过在回调中调用“event.stopPropagation()”或“return false”来解决这个问题？

# apache - Mod Rewrite，将参数从 URL1 传递到 URL2

> ID：639869
> 
> 赞同：3
> 
> 时间：2009-03-12T18:21:01.103
> 
> 标签：apache, .htaccess, mod-rewrite, url-rewriting

我正在尝试重写以下 URL

```
test.php?par1=foo&par2=bar 
```

进入...

```
newtest.php?hidden_par=blah&par1=foo&par2=bar 
```

我有这个规则，它不起作用：

```
RewriteRule ^test.php\??(.*?)$ newtest.php?hiden_par=blah&$1 [L] 
```

这可以使用 RewriteCond 或其他方法来完成吗？（比如说，可以这样做吗？），提前谢谢。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-03-12T18:24:40.893

您可能需要类似`QSA`("query string append") 标志，它会导致查询字符串的其余部分正确附加到重写 URL 的末尾。

例如：

```
^test.php test.php?hidden=value [L,QSA] 
```

# asp.net - jQuery函数问题

> ID：639883
> 
> 赞同：1
> 
> 时间：2009-03-12T18:25:07.133
> 
> 标签：asp.net, javascript, jquery

我有一个关于 jQuery 函数的问题。我有一个功能，一旦浏览器准备好，该功能就会找到一个特定的表格，然后向它添加悬停和单击功能。

我正在尝试从 asp .net 页面中的代码调用此函数，因为一旦有人添加到数据库中，更新面板就会触发并检索 gridview（受 document.ready 中的函数影响的表） . 当它回来时，它又是一张普通的桌子。

这是原始功能：

```
$("#GridView1").find("tr").click(function(e) {
                var row = jQuery(this)
                //var bID = row.children("td:eq(0)").text();
                $('#tbHiddenBatchID').val(row.children("td:eq(0)").text());
                //Took out repetitive code, places values from table into modal

                e.preventDefault();
                $('#modalContentTest').modal({ position: ["25%", "5%"] });
                //row.addClass('highlight');
                //$('#tbEdit').val(bID);
            });

//here is the function that adds hover styling
$("#GridView1").find("tr").click(function() {
            return $('td', this).length && !$('table', this).length
        }).css({ background: "ffffff" }).hover(
            function() { $(this).css({ background: "#C1DAD7" }); },
            function() {
                $(this).css({ background: "#ffffff" });

            }); 
```

好的，我试图做的是创建一个函数，在 document.ready 上调用它，并在数据库更新后在后面的代码中调用它。

这是我所做的：

```
function helpGrid() {
            $("#GridView1").find("tr").click(function(e) {
                var row = jQuery(this)
                //var bID = row.children("td:eq(0)").text();
                $('#tbHiddenBatchID').val(row.children("td:eq(0)").text());
                //
                e.preventDefault();
                $('#modalContentTest').modal({ position: ["25%", "5%"] });
                //row.addClass('highlight');
                //$('#tbEdit').val(bID);
            });

//Haven't even tried to add the hover stlying part yet; can't get this to work.
        } 
```

当我尝试调用 helpGrid(); 我收到一个未定义的错误...

显然我是一个 jQuery 新手，但我确实有 jQuery in Action & 我现在正在搜索它以寻找答案......

请帮忙..

谢谢！！！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-12T19:08:48.727

由于您使用的是更新面板，因此整个页面不会回发，并且 document.ready 的内容永远不会受到影响...下面是您可以在更新结束时添加要运行的函数的地方，因此 resetMyTableStuff(); 是你想要施展魔法的地方...

尝试添加这样的东西......

```
function pageLoad() {
    if (!Sys.WebForms.PageRequestManager.getInstance().get_isInAsyncPostBack()) {
        Sys.WebForms.PageRequestManager.getInstance().add_endRequest(endRequestHandler);
        Sys.WebForms.PageRequestManager.getInstance().add_initializeRequest(initializeRequest);
    }
}

function endRequestHandler(sender, args) {
     resetMyTableStuff();
}

function initializeRequest(sender, args) {
      //just in case you need to do it...
} 
```

# .net - 突出显示被拖动的 TreeView 项目

> ID：639884
> 
> 赞同：6
> 
> 时间：2009-03-12T18:25:17.443
> 
> 标签：.net, wpf, xaml, drag-and-drop, treeview

在我的应用程序中，我有一个允许拖放的 TreeView。我的所有功能都可以正常工作，但是当拖拽 TreeViewItem 时我很难突出显示它。这是我的树视图项目的风格。IsMouseOver 触发器在拖动时不起作用，因为拖动似乎会阻止其他鼠标事件。任何人都可以帮我在拖动时触发我的树视图项目上的相同边框更改吗？

```
<Style x:Key="TreeViewItemStyle" TargetType="{x:Type TreeViewItem}"> 
    <Setter Property="Template"> 
        <Setter.Value> 
            <ControlTemplate TargetType="{x:Type TreeViewItem}"> 
                <Grid> 
                    <Grid.ColumnDefinitions> 
                        <ColumnDefinition MinWidth="19" Width="Auto"/> 
                        <ColumnDefinition Width="Auto"/> 
                        <ColumnDefinition Width="*"/> 
                    </Grid.ColumnDefinitions> 
                    <Grid.RowDefinitions> 
                        <RowDefinition Height="Auto"/> 
                        <RowDefinition/> 
                    </Grid.RowDefinitions> 
                    <ToggleButton  
                        x:Name="PART_Expander" 
                        Style="{StaticResource ExpandCollapseToggleStyle}" 
                        IsChecked="{Binding Path=IsExpanded, RelativeSource={RelativeSource TemplatedParent}}" 
                        ClickMode="Press" 
                        /> 
                    <Border 
                        x:Name="OuterBorder"  
                        Grid.Column="1" 
                        SnapsToDevicePixels="True" 
                        BorderThickness="1"  
                        CornerRadius="3"  
                        BorderBrush="Transparent"  
                        Background="Transparent" 
                        > 
                        <Border  
                            x:Name="InnerBorder"  
                            SnapsToDevicePixels="True" 
                            BorderThickness="1"  
                            CornerRadius="2"  
                            BorderBrush="Transparent"  
                            Background="Transparent" 
                            > 
                            <ContentPresenter 
                                x:Name="PART_Content" 
                                ContentSource="Header" 
                                HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}" 
                                /> 
                        </Border> 
                    </Border> 
                    <ItemsPresenter 
                        x:Name="PART_ItemsHost" 
                        Grid.Row="1" 
                        Grid.Column="1" 
                        Grid.ColumnSpan="2" 
                        /> 
                </Grid> 
                <ControlTemplate.Triggers> 
                    <Trigger Property="IsMouseOver" SourceName="OuterBorder" Value="True"> 
                        <Setter TargetName="OuterBorder" Property="BorderBrush" Value="Blue" /> 
                        <Setter TargetName="OuterBorder" Property="Background" Value="Red" /> 
                        <Setter TargetName="InnerBorder" Property="BorderBrush" Value="White" /> 
                    </Trigger> 
                    <MultiTrigger> 
                </ControlTemplate.Triggers> 
            </ControlTemplate> 
        </Setter.Value> 
    </Setter> 
</Style> 
```

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-03-12T19:45:55.130

我为此使用了一个附加属性，然后在我的 xaml 文件中使用该属性来更改树视图项的背景颜色：

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Windows;
using System.Windows.Controls;
using System.Windows.Input;

namespace SKNotes.Utilities
{
    /// <summary>
    /// Implements an attached property used for styling TreeViewItems when
    /// they're a possible drop target.
    /// </summary>
    public static class TreeViewDropHighlighter
    {
        #region private variables
        /// <summary>
        /// the TreeViewItem that is the current drop target
        /// </summary>
        private static TreeViewItem _currentItem = null;

        /// <summary>
        /// Indicates whether the current TreeViewItem is a possible
        /// drop target
        /// </summary>
        private static bool _dropPossible;
        #endregion

        #region IsPossibleDropTarget
        /// <summary>
        /// Property key (since this is a read-only DP) for the IsPossibleDropTarget property.
        /// </summary>
        private static readonly DependencyPropertyKey IsPossibleDropTargetKey = 
                                    DependencyProperty.RegisterAttachedReadOnly(
                                        "IsPossibleDropTarget",
                                        typeof( bool ),
                                        typeof( TreeViewDropHighlighter ),
                                        new FrameworkPropertyMetadata( null,
                                            new CoerceValueCallback( CalculateIsPossibleDropTarget ) ) );

        /// <summary>
        /// Dependency Property IsPossibleDropTarget.
        /// Is true if the TreeViewItem is a possible drop target (i.e., if it would receive
        /// the OnDrop event if the mouse button is released right now).
        /// </summary>
        public static readonly DependencyProperty IsPossibleDropTargetProperty = IsPossibleDropTargetKey.DependencyProperty;

        /// <summary>
        /// Getter for IsPossibleDropTarget
        /// </summary>
        public static bool GetIsPossibleDropTarget( DependencyObject obj )
        {
            return (bool)obj.GetValue( IsPossibleDropTargetProperty );
        }

        /// <summary>
        /// Coercion method which calculates the IsPossibleDropTarget property.
        /// </summary>
        private static object CalculateIsPossibleDropTarget( DependencyObject item, object value )
        {
            if ( ( item == _currentItem ) && ( _dropPossible ) )
                return true;
            else
                return false;
        }
        #endregion

        /// <summary>
        /// Initializes the <see cref="TreeViewDropHighlighter"/> class.
        /// </summary>
        static TreeViewDropHighlighter( )
        {
            // Get all drag enter/leave events for TreeViewItem.
            EventManager.RegisterClassHandler( typeof( TreeViewItem ),
                                      TreeViewItem.PreviewDragEnterEvent,
                                      new DragEventHandler( OnDragEvent ), true );
            EventManager.RegisterClassHandler( typeof( TreeViewItem ),
                                      TreeViewItem.PreviewDragLeaveEvent,
                                      new DragEventHandler( OnDragLeave ), true );
            EventManager.RegisterClassHandler( typeof( TreeViewItem ),
                                      TreeViewItem.PreviewDragOverEvent,
                                      new DragEventHandler( OnDragEvent ), true );
        }

        #region event handlers
        /// <summary>
        /// Called when an item is dragged over the TreeViewItem.
        /// </summary>
        /// <param name="sender">The sender.</param>
        /// <param name="args">The <see cref="System.Windows.DragEventArgs"/> instance containing the event data.</param>
        static void OnDragEvent( object sender, DragEventArgs args )
        {
            lock ( IsPossibleDropTargetProperty )
            {
                _dropPossible = false;

                if ( _currentItem != null )
                {
                    // Tell the item that previously had the mouse that it no longer does.
                    DependencyObject oldItem = _currentItem;
                    _currentItem = null;
                    oldItem.InvalidateProperty( IsPossibleDropTargetProperty );
                }

                if ( args.Effects != DragDropEffects.None )
                {
                    _dropPossible = true;
                }

                TreeViewItem tvi = sender as TreeViewItem;
                if ( tvi != null )
                {
                    _currentItem = tvi;
                    // Tell that item to re-calculate the IsPossibleDropTarget property
                    _currentItem.InvalidateProperty( IsPossibleDropTargetProperty );
                }
            }
        }

        /// <summary>
        /// Called when the drag cursor leaves the TreeViewItem
        /// </summary>
        /// <param name="sender">The sender.</param>
        /// <param name="args">The <see cref="System.Windows.DragEventArgs"/> instance containing the event data.</param>
        static void OnDragLeave( object sender, DragEventArgs args )
        {
            lock ( IsPossibleDropTargetProperty )
            {
                _dropPossible = false;

                if ( _currentItem != null )
                {
                    // Tell the item that previously had the mouse that it no longer does.
                    DependencyObject oldItem = _currentItem;
                    _currentItem = null;
                    oldItem.InvalidateProperty( IsPossibleDropTargetProperty );
                }

                TreeViewItem tvi = sender as TreeViewItem;
                if ( tvi != null )
                {
                    _currentItem = tvi;
                    tvi.InvalidateProperty( IsPossibleDropTargetProperty );
                }
            }
        }
        #endregion
    }
} 
```

然后在 xaml 文件中：

```
 <TreeView.ItemContainerStyle>
        <Style TargetType="{x:Type TreeViewItem}">
            <Setter Property="FontWeight" Value="Normal" />
            <Style.Triggers>
                <Trigger Property="utils:TreeViewDropHighlighter.IsPossibleDropTarget" Value="True">
                    <Setter Property="Background" Value="{DynamicResource {x:Static SystemColors.HighlightBrushKey}}" />
                </Trigger>
            </Style.Triggers>
        </Style>
    </TreeView.ItemContainerStyle> 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-12T18:29:23.800

查看[DragOver](http://msdn.microsoft.com/en-us/library/system.windows.uielement.dragover.aspx)事件（可能还有 DragEnter/DragLeave）而不是 IsMouseOver。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2013-09-20T14:38:14.397

除了 Stefan 的回答，我发现还需要添加 Drop 事件：

```
static void OnDragDrop(object sender, DragEventArgs args)
{
    lock (IsPossibleDropTargetProperty)
    {
        _dropPossible = false;

        if (_currentItem != null)
        {
            _currentItem.InvalidateProperty(IsPossibleDropTargetProperty);
        }

        TreeViewItem tvi = sender as TreeViewItem;
        if (tvi != null)
        {
            tvi.InvalidateProperty(IsPossibleDropTargetProperty);
        }
    }
} 
```

并注册 drop 事件：

```
EventManager.RegisterClassHandler(typeof(TreeViewItem),
             TreeViewItem.PreviewDropEvent,
             new DragEventHandler(OnDragDrop), true); 
```

否则，如果一个 treeItem 掉落在另一个之上，则背景可能不会改变。如果你按 ESC 也是一样。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-05-08T21:20:22.943

对于我们这些在这些范围内工作的人来说，这篇文章只是将 Stefan 上面对 VB 的精彩回应的移植；除了希望我没有把任何事情搞砸之外，我没有什么可提供的。它似乎对我有用：

```
Namespace SKNotes.Utilities

''' <summary>
''' Implements an attached property used for styling TreeViewItems when
''' they are a possible drop target.
''' </summary>
Public Class TreeViewDropHighlighter

    ''' <summary>
    ''' The TreeViewItem that is the current drop target
    ''' </summary>
    Private Shared _CurrentItem As TreeViewItem = Nothing

    ''' <summary>
    ''' Indicates whether the current TreeView Item is a possible drop target
    ''' </summary>
    ''' <remarks></remarks>
    Private Shared _DropPossible As Boolean

    ''' <summary>
    ''' Property Key (since this is a read only DP) for the IsPossibleDropTarget property.
    ''' </summary>
    ''' <remarks></remarks>
    Private Shared ReadOnly IsPossibleDropTargetKey As DependencyPropertyKey = _
                                            DependencyProperty.RegisterAttachedReadOnly _
                                            ( _
                                                "IsPossibleDropTarget", _
                                                GetType(Boolean), _
                                                GetType(TreeViewDropHighlighter), _
                                                New FrameworkPropertyMetadata(Nothing, _
                                                                                New CoerceValueCallback(AddressOf CalculateIsPossibleDropTarget)
                                                                                )
                                            )
    ''' <summary>
    ''' Dependency Property IsPossibleDropTarget.
    ''' Is true if the TreeViewItem is a possible drop target (ie, if it would receive the 
    ''' OnDrop even if the mouse button is release right now).
    ''' </summary>
    ''' <remarks></remarks>
    Public Shared ReadOnly IsPossibleDropTargetProperty As DependencyProperty = IsPossibleDropTargetKey.DependencyProperty

    ''' <summary>
    ''' Getter for IsPossibleDropTarget
    ''' </summary>
    Public Shared Function GetIsPossibleDropTarget(ByVal obj As DependencyObject) As Boolean
        Return CBool(obj.GetValue(IsPossibleDropTargetProperty))
    End Function

    ''' <summary>
    ''' Coercion method which calculates the IsPossibleDropTarget property
    ''' </summary>
    Private Shared Function CalculateIsPossibleDropTarget(item As DependencyObject, value As Object) As Object
        If item.Equals(_CurrentItem) And _
           _DropPossible Then
            Return True
        Else
            Return False
        End If
    End Function

    ''' <summary>
    ''' Initializes the TreeViewDropHighlighter class
    ''' </summary>
    Shared Sub New()
        EventManager.RegisterClassHandler(GetType(TreeViewItem), _
                                            TreeViewItem.PreviewDragEnterEvent, _
                                            New DragEventHandler(AddressOf OnDragEvent), True)
        EventManager.RegisterClassHandler(GetType(TreeViewItem), _
                                            TreeViewItem.PreviewDragLeaveEvent,
                                            New DragEventHandler(AddressOf OnDragLeave), True)
        EventManager.RegisterClassHandler(GetType(TreeViewItem), _
                                            TreeViewItem.PreviewDragOverEvent, _
                                            New DragEventHandler(AddressOf OnDragEvent), True)
    End Sub

    ''' <summary>
    ''' Called when an item is dragged over the TreeView Item
    ''' </summary>
    ''' <param name="sender">The sender</param>
    ''' <param name="args">The System.Windows.DragEventArgs instance containing the event data</param>
    ''' <remarks></remarks>
    Shared Sub OnDragEvent(sender As Object, args As DragEventArgs)
        SyncLock (IsPossibleDropTargetProperty)
            _DropPossible = False
            If Not IsNothing(_CurrentItem) Then
                'Tell the item that previously had the mouse that it no longer does.
                Dim OldItem As DependencyObject = _CurrentItem
                _CurrentItem = Nothing
                OldItem.InvalidateProperty(IsPossibleDropTargetProperty)
            End If

            If args.Effects <> DragDropEffects.None Then
                _DropPossible = True
            End If

            Dim tvi As TreeViewItem = CType(sender, TreeViewItem)
            If Not IsNothing(tvi) Then
                _CurrentItem = tvi
                'Tell that item to recalculate the IsPossibleDropTarget property
                _CurrentItem.InvalidateProperty(IsPossibleDropTargetProperty)
            End If
        End SyncLock
    End Sub

    Shared Sub OnDragLeave(sender As Object, args As DragEventArgs)

        SyncLock (IsPossibleDropTargetProperty)
            _DropPossible = False
            If Not IsNothing(_CurrentItem) Then
                'Tell the item that previously had the mouse that it no longer does
                Dim OldItem As DependencyObject = _CurrentItem
                _CurrentItem = Nothing
                OldItem.InvalidateProperty(IsPossibleDropTargetProperty)
            End If

            Dim tvi As TreeViewItem = CType(sender, TreeViewItem)
            If Not IsNothing(tvi) Then
                _CurrentItem = tvi
                tvi.InvalidateProperty(IsPossibleDropTargetProperty)
            End If

        End SyncLock

    End Sub

End Class 
```

结束命名空间

# sql-server - 使用列标题从 SQL Server 导出到 Excel？

> ID：639886
> 
> 赞同：14
> 
> 时间：2009-03-12T18:25:20.627
> 
> 标签：sql-server, excel, sql-server-2005, export

我有一个大约有 20 列的查询，我想将其导出到带有列标题的 Excel 文件。

我认为这很容易弄清楚，但没有运气！我在网上搜索并发现了一个最终没有奏效的建议，所以我被卡住了。

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2012-01-12T00:04:31.497

工具——>选项，选择“查询结果”——>“SQL Server”——>“结果到网格”和“结果到文本”（下图）：

![在此处输入图像描述](https://i.stack.imgur.com/eWmYN.png)

![在此处输入图像描述](https://i.stack.imgur.com/xnDwK.png)

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-03-12T21:44:16.950

我通常只需单击结果网格的左上角，复制，然后粘贴到 Excel 中即可。有一个问题，您需要进入选项->查询结果-> SQL Server->结果到网格（或文本，如果您想保存到文件以导入到excel中）并在复制或保存时打开包含列标题结果。我觉得这很好用。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2012-02-15T10:08:17.227

这个脚本 [让 BCP 将数据导出到 excel](http://dotnetkeeda.blogspot.in/2009/09/bcp-command-to-export-data-to-excel.html)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-12T18:29:08.400

如果您使用导入/导出向导，这是默认设置。如果要自定义导出，也可以将其保存到 SSIS 包中。

# excel - VB/VBA：从剪贴板获取 HTML 字符串（通过网络浏览器复制）

> ID：639890
> 
> 赞同：1
> 
> 时间：2009-03-12T18:26:41.340
> 
> 标签：excel, vba, browser, vb6, clipboard

似乎当您将某些内容从 Web 浏览器复制到剪贴板时，至少会存储 2 项内容：

1.  纯文本
2.  HTML 源代码

然后由您粘贴到的软件来确定它想要哪个。粘贴到**MS Excel 2003**时，您有一个粘贴特殊选项来粘贴 HTML，它将粘贴格式化的 HTML（因为它由浏览器显示）。

我想要做的是将实际的源代码粘贴为纯文本。这可以从 VBA 的剪贴板中获取吗？

**编辑** 我正在尝试访问复制的 HTML 的所有源代码，包括标签。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-12T22:41:12.757

这次我已经正确阅读了这个问题，并意识到*coonj*想要从剪贴板中获取 HTML，包括标签。

我相信这是相当困难的。您需要使用 Windows API 调用来读取剪贴板。然后，解析生成的 CF_HTML 字符串，该字符串在 HTML 顶部添加了一些古怪的标题。

1.  [带有 Windows API 代码的Microsoft 知识库文章](http://support.microsoft.com/kb/274326)，用于从剪贴板读取 CF_HTML（函数 GetHTMLClipboard）。
2.  然后，您可能想要忽略古怪的标题。[Microsoft 在此处](http://msdn.microsoft.com/en-us/library/aa767917.aspx)记录格式。下面显示了一个示例 CF_HTML 片段。您可能会想出一些猜测方法来跳过前几行。

    ```
    Version:0.9 
    StartHTML:71 
    EndHTML:170 
    StartFragment:140 
    EndFragment:160 
    StartSelection:140 
    EndSelection:160 
    <!DOCTYPE> 
    <HTML> 
    <HEAD> 
    <TITLE>The HTML Clipboard</TITLE> 
    <BASE HREF="http://sample/specs">  
    </HEAD> 
    <BODY> 
    <!--StartFragment -->     <P>The Fragment</P> 
    <!--EndFragment --> 
    </BODY> 
    </HTML> 
    ```

是否还有其他方法可以解决您的问题也可能值得考虑。例如，浏览器是否总是 Internet Explorer？你能通过使用 COM 对象模型遍历 HTML 树来获得你需要的东西吗？

编辑：*coonj*现在已经尝试过了，并说“GetHTMLClipboard 功能似乎可以与 Firefox 和 IE 一起使用，而且它看起来不像是把这些标题扔在那里”

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-12T18:33:55.910

VB6 有 Clipboard 对象，允许您获取不同格式的剪贴板数据。VBA 没有这个对象。但是您可以使用 Windows API 调用。[您可以在此处](http://vb.mvps.org/samples/project.asp?id=clipex)查看 VBA 的示例实现。

# asp.net-mvc - 如何在 Visual Basic 中使用 ASP.NET MVC Html.RouteLink？

> ID：639893
> 
> 赞同：1
> 
> 时间：2009-03-12T18:27:07.500
> 
> 标签：asp.net-mvc, vb.net, html-helper

我认为在 C# 中，您可以像这样创建内联 RouteValueDictionary 实例：

```
<%=Html.RouteLink(Model.Name, "SomeRoute", new { id = Model.Id }) %> 
```

Visual Basic 中的等价物是什么？

这有效，但很罗嗦：

```
<%
    Dim d As New RouteValueDictionary()
    d.Add("id", Model.Id)
%>

<%=Html.RouteLink(Model.Name, "SomeRoute", d)%> 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-12T18:43:36.387

```
<%=Html.RouteLink(Model.Name, "SomeRoute", New With {.id = Model.Id})%> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-19T03:19:15.850

澄清一下，您实际上并没有使用这种语法创建内联 RouteValueDictionary。您正在创建一个新的匿名类型，并使用`RouteLink(linkText As String, routeName As String, routeValues As Object)`重载。此重载在内部使用反射（我假设）将匿名对象的属性及其值添加到 RouteValueDictionary 以创建链接。

# c# - 如何将列表计数绑定到 WinForms 中的标签？

> ID：639894
> 
> 赞同：5
> 
> 时间：2009-03-12T18:27:52.663
> 
> 标签：c#, winforms

如何将列表的计数绑定到标签。以下代码不会随着列表的更改而更新：

```
private IList<string> list = new List<string>();
//...
label1.DataBindings.Add("Text", list.Count, ""); 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-13T02:24:34.967

根据 Marc Gravell 对于这个问题的说法，他[建议创建一个外观](http://objectmix.com/csharp/388347-binding-formatstring-rendering-curly-braces-trick-bind-list-t-countproperty.html)来包装您要绑定到 label1.Text 的集合

我试图实现一个（为了好玩）并且能够绑定到*Count*工作。
``CountList<T>``是包装要绑定到的集合的外观。

这是完整的演示。

```
using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Windows.Forms;

namespace TextBindingTest
{
    public partial class Form1 : Form
    {
        private readonly CountList<string> _List =
            new CountList<string>(new List<string> { "a", "b", "c" });

        public Form1()
        {
            InitializeComponent();
            BindAll();
        }

        private void BindAll()
        {
            var binding = new Binding("Text", _List, "Count", true);
            binding.Format += (sender, e) => e.Value = string.Format("{0} items", e.Value);
            label1.DataBindings.Add(binding);
        }

        private void addToList_Click(object sender, EventArgs e)
        {
            _List.Add("a");
        }

        private void closeButton_Click(object sender, EventArgs e)
        {
            Close();
        }
    }

    public class CountList<T> : INotifyPropertyChanged
    {
        public event PropertyChangedEventHandler PropertyChanged = delegate { };
        private void OnPropertyChanged(PropertyChangedEventArgs e)
        {
            var handler = PropertyChanged;
            handler(this, e);
        }

        private ICollection<T> List { get; set; }
        public int Count { get { return List.Count; } }

        public CountList(ICollection<T> list)
        {
            List = list;
        }

        public void Add(T item)
        {
            List.Add(item);
            OnPropertyChanged(new PropertyChangedEventArgs("Count"));
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-12T18:49:51.097

绑定侦听 IPropertyChanged 接口的 PropertyChanged 事件。我认为 List.Count 在更改时不会报告为 PropertyChanged 事件。

您可以做的是实现您的自定义 List 或找到一个在 Count 更改时通知的集合。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-12T19:27:24.657

如果您有列表框的数据源，则可以使用 DataSourceChanged。只要记住更新和重新绑定数据源。

这可能有点贫民窟，但这是我使用的示例：

```
List<int> collection = new List<int>();
    public Form1()
    {
        InitializeComponent();
        listBox1.DataSourceChanged += listbox1_Changed;
    }

    private void button1_Click(object sender, EventArgs e)
    {
        collection.Add(new Random().Next(100));
        listBox1.BeginUpdate();
        listBox1.DataSource = null;
        listBox1.DataSource = collection;
        listBox1.EndUpdate();
    }
    private void listbox1_Changed(object sender, EventArgs e)
    {
        textBox1.Text = collection.Count.ToString();
    } 
```

# sql - 按名称查找所有数据库对象？

> ID：639895
> 
> 赞同：29
> 
> 时间：2009-03-12T18:27:58.233
> 
> 标签：sql, sql-server

如何使用对象名称查找给定数据库中的所有数据库对象？我们在所有特定于站点的表、视图、索引、函数、约束等前面加上一个常量字符串。我需要找到名称以该字符串开头的所有对象。

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2009-03-12T18:29:55.577

假设您拥有正确的权限：

```
SELECT *
FROM yourdatabasename.sys.all_objects
WHERE upper(name) like upper('my prefix%')  --use UPPER for case-INsensitivity 
```

# pbcopy - 无法在不打开文本编辑器的情况下将 pbcopy 保存到新文件

> ID：639896
> 
> 赞同：1
> 
> 时间：2009-03-12T18:28:36.920
> 
> 标签：pbcopy

我尝试了以下代码不成功

```
cat pbcopy >> newFile 
```

**如何在不打开文本编辑器的情况下将剪贴板保存到文件 newFile？**

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-12T18:32:38.533

尝试：`pbpaste >newFile`

# c++ - 使用 ODBC 连接到 SQLite，无需注册数据库

> ID：639899
> 
> 赞同：5
> 
> 时间：2009-03-12T18:29:39.867
> 
> 标签：c++, sqlite, odbc

是否可以在 C++ 中连接到 SQLite 并使用 ODBC API 而无需在 ODBC 中注册数据库？

我有使用 ODBC 与数据库通信的代码，不想为使用 SQLite 而重写，也不想注册新的 ODBC 连接。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-20T17:24:43.450

您应该能够使用[sqliteodbc](http://www.ch-werner.de/sqliteodbc/)无需任何代码更改即可做到这一点。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-10-02T14:59:20.973

简短的回答，使用以下连接字符串之一：

```
Driver=SQLite ODBC Driver;Database=full-path-to-db;...
Driver=SQLite3 ODBC Driver;Database=full-path-to-db;... 
```

长答案： sqliteodbc 驱动程序附带的自述文件涵盖了使用无 DSN 连接字符串的连接方法。

见[http://www.ch-werner.de/sqliteodbc/html/index.html](http://www.ch-werner.de/sqliteodbc/html/index.html)

# asp.net - 如何使用 JQUERY 在更改事件上禁用下拉列表？

> ID：639900
> 
> 赞同：10
> 
> 时间：2009-03-12T18:29:49.633
> 
> 标签：asp.net, jquery, drop-down-menu

```
$(document).ready(function() {
      $('#<%=ddlContinents.ClientID %>').change(function() { 
      var element = $(this);
      var totalLength = element.children().length; 
      if ($(this).disabled == false) { $(this).disabled = true; }
      });
}); 
```

我想要做的是触发更改事件`dropdownlist`并在更改时`dropdownlist`禁用它。代码正在触发和一切，但它不会禁用`dropdownlist`.

这部分代码不起作用：

```
if ($(this).disabled == false) { $(this).disabled = true; } }); 
```

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-03-12T18:36:15.840

您应该使用[`.prop()`](http://api.jquery.com/prop/)jQuery 1.6+ 或[`.attr()`](http://api.jquery.com/attr/)更早版本的 jQuery：

> jQuery 1.6：

```
$(document).ready(function() {
  $('#<%=ddlContinents.ClientID %>').change(function() { 
    var element = $(this);
    var totalLength = element.children().length;

    if (!$(this).prop("disabled")) { 
      $(this).prop("disabled", true); 
    } 
  });
}); 
```

< jQuery 1.6：

```
$(document).ready(function() {
  $('#<%=ddlContinents.ClientID %>').change(function() { 
    var element = $(this);
    var totalLength = element.children().length;

    if (!$(this).attr("disabled")) { 
      $(this).attr("disabled", "disabled"); 
    } 
  });
}); 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-03-12T18:39:21.950

```
if (!$(this).attr("disabled")) { $(this).attr("disabled","disabled"); } 
```

如果您想稍后启用它，您必须执行以下操作：

```
$(this).removeAttr("disabled"); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-09-13T23:33:17.550

我知道这篇文章很旧..如果有人坚持禁用下拉更改功能的下拉菜单，这可能会有所帮助

```
 if ($(this).attr('disabled', false)) 
         { $(this).attr('disabled', true);
    } 
```

# windows - Windows 服务命令 RPC 错误（sc.exe 或 psservice）

> ID：639901
> 
> 赞同：8
> 
> 时间：2009-03-12T18:29:50.147
> 
> 标签：windows, windows-services

当我尝试从远程机器运行命令时出现以下错误

```
C:\>sc \\machinename query
[SC] OpenSCManager FAILED 1722:

The RPC server is unavailable. 
```

*   我拥有那台机器的管理员权限。

任何解决方案让我知道。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2012-04-24T20:05:20.533

就我而言，我收到了这个错误，因为我弄乱了我所针对的服务器的名称。如果您不小心将其指向任何内容，它将给您此错误。在我的例子中，服务器名称是一个从文本文档中定义的变量，所以我花了一段时间才意识到。

另外值得注意的是：机器名称前实际上应该有两个斜杠（我确定这只是一个错字，但以防万一它可能会混淆任何人）。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-13T11:55:41.960

错误 1722 是：RPC 服务器不可用。使用 telnet 验证 RPC 服务（远程过程调用 (RPC)）是否在远程计算机上运行，​​在命令行尝试：
*>telnet your.server 135

如果没有发生错误，则 RPC 服务器可能没问题，然后检查系统事件是否有问题。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2015-11-26T10:05:10.780

6年后，但无论如何。

在远程计算机上启用文件和打印机共享，它将起作用。

[https://support.microsoft.com/en-us/kb/323790](https://support.microsoft.com/en-us/kb/323790)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-05-14T07:40:59.320

我在本地机器上测试 ![在 PCxxxx4 上运行 SC QUERY](https://i.stack.imgur.com/5Fo5g.png)

我从网络上的另一台机器上测试 ![在 PCxxxx0 上运行 SC QUERY](https://i.stack.imgur.com/3bXBO.png)

SC很好..！:)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2017-04-04T14:01:27.637

您需要确保客户端 DNS 服务没有停止。这解决了问题。

# java - 尝试从 postgreSQL 获取数据时出现 OptimisticLockException

> ID：639908
> 
> 赞同：4
> 
> 时间：2009-03-12T18:31:29.037
> 
> 标签：java, hibernate, postgresql, jpa, jboss

我们正在开发一个旨在每秒处理多个请求的网站。-

我们当前的环境是 JavaEE、JBoss 4.2.3、Struts2 for MVC、Hibernate 作为 ORM 和 Postgres 作为 DB 的 JPA。

这是这样的场景：每当请求到达任何页面时，一些操作会检查数据库中的信息以填充请求的页面（该信息由多个实体组成，其中一些具有映射的集合，一些懒惰，一些急切）；一切正常，直到我们收到几个（不多...... 2 就足够了 XD）并发请求，然后休眠在获取该信息时抛出“OptimisticLockException”。

最有趣的是我们只是在阅读信息！从来不写！！

也许我们忽略了一些东西或类似的东西......任何帮助将不胜感激。

提前致谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-12T20:24:25.473

也许您的事务控制有问题。如果您在视图中使用开放会话，请确保将事务设置为只读，否则如果您执行 obj.setXX() 它将引发更改并且休眠将尝试更新表。

看看你的事务隔离策略的配置。

最后，一定要正确实现版本属性，以及它的映射；以及 equals 和 hashcode 方法（尤其是在使用集合时）。

# c# - 继承与事件

> ID：639911
> 
> 赞同：0
> 
> 时间：2009-03-12T18:32:36.223
> 
> 标签：c#, oop

我有一个这样定义的接口：

```
public interface IRipper
{
    IRipperHost Host { get; set; }

    void Rip(FileStream stream);

    event RipperEventHandler OnStart;
    event RipperEventHandler OnComplete;
    event RipperEventHandler OnProgressChanged;        
}

public delegate void RipperEventHandler(object sender, RipperEventArgs e); 
```

以及实现该接口的基类

```
public class RipperBase : IRipper
{

    public void Rip(FileStream stream)
    {
        throw new System.NotImplementedException();
    }
    public event RipperEventHandler PostRipEvent;
    event RipperEventHandler IRipper.OnComplete
    {
        add
        {
            if (PostRipEvent != null)
            {
                lock (PostRipEvent)
                {
                    PostRipEvent += value;
                }
            }
            else
            {
                PostRipEvent = value;
            }
        }
        remove
        {
            if (PostRipEvent != null)
            {
                lock (PostRipEvent)
                {
                    PostRipEvent -= value;
                }
            }
        }
    }
    ... and so on
} 
```

我的问题是您将如何***从***RipperBase 继承并覆盖 BaseClass Rip 方法。实际上，该功能应该是抽象的-但我不知道如何使用接口来做到这一点。

另外，我如何从派生自 RipperBase 的类中调用基类事件处理程序？我试过这个

```
 RipperEventHandler handler = PreRipEvent;
    if (handler != null)
    {
        handler(this, new RipperEventArgs { Message = "Started Ripping file to CSV!" });
    }

    handler = RipProgEvent; 
```

这但我得到“事件只能出现在 += 或 -= 的左侧。” 错误

任何帮助将不胜感激！我正在尝试使其尽可能具有可扩展性。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-12T18:44:24.013

将基类中的方法声明为虚拟方法，例如：

```
public virtual void Rip(FileStream stream)
{
    throw new System.NotImplementedException();
} 
```

并在特定类别中：

```
public override void Rip(FileStream stream){} 
```

对于该事件，请在基础上执行此操作：

```
protected void FireASpecificEvent(SomeClass someArguments)
{//fire event normally
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-12T18:49:02.940

我会这样做：

```
 public abstract class RipperBase : IRipper
    {
        public void Rip( Filestream fs )
        {
             RipCore (fs);
             OnCompleted();
        }

        protected abstract void RipCore(Filestream fs);

        public event EventHandler<RipperEventArgs> Completed;

        protected void OnCompleted
        {
           if( Completed != null )
           {
               // TODO: make this Threadsafe.
               Completed (this, new RipperEventArgs( ... ) );
           }
        }
} 
```

我已经将该类声明为抽象类，因为我认为您不能从 RipperBase 实例化对象？

从 RipperBase 继承的类必须重写 RipCore 方法，并实现正确的功能。Rip 是调用 RipCore 方法的方法，它还引发 Completed 事件处理程序。（也许你不想这样做，我不知道）。

如果需要，您还可以确保 Rip 方法在另一个线程上调用 RipCore 方法。

对于事件，我在基类中创建了一个可用于引发事件的受保护方法。如果要在子类中引发事件，只需调用此方法。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-12T18:44:53.667

我不知道这是否有帮助，但我认为你应该用虚拟访问标记 Rip 功能，所以它可以被覆盖，

还有关于事件，也许你可以尝试在基类OnPreRipEventFired()上创建一个方法，不知道，只是给个思路

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-12T18:51:26.100

也许您最好创建一个 Ripper 抽象基类。

此外，为您的事件使用 EventHandler<> 泛型类型，而不是声明另一种类型 (RipperEventHandler)。例如：

```
event EventHandler<RipperEventArgs> OnStart; 
```

# c# - 在 c# 中断言属性应用于方法的最短方法是什么？

> ID：639913
> 
> 赞同：0
> 
> 时间：2009-03-12T18:33:01.560
> 
> 标签：c#, unit-testing, reflection, nunit-2.5

在 c# 中断言属性应用于方法的最短方法是什么？

我正在使用 nunit-2.5

:)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-12T18:44:51.953

```
MethodInfo mi = typeof(MyType).GetMethod("methodname");    

Assert.IsFalse (Attribute.IsDefined (mi, typeof(MyAttributeClass))); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-12T18:38:01.423

我不确定 nunit 使用的断言方法，但您可以简单地将这个布尔表达式用于传递给它的参数（假设您能够使用 LINQ：

```
methodInfo.GetCustomAttributes(attributeType, true).Any() 
```

如果应用了该属性，那么它将返回 true。

如果您想制作通用版本（而不是使用 typeof），您可以使用通用方法为您执行此操作：

```
static bool IsAttributeAppliedToMethodInfo<T>(this MethodInfo methodInfo) 
    where T : Attribute
{
    // If the attribute exists, then return true.
   return methodInfo.GetCustomAttributes(typeof(T), true).Any();
} 
```

然后在您的断言方法中调用它，如下所示：

```
<assert method>(methodInfo.IsAttributeAppliedToMethodInfo<MyAttribute>()); 
```

要使用表达式执行此操作，您可以首先定义以下扩展方法：

```
public static MethodInfo 
    AssertAttributeAppliedToMethod<TExpression, TAttribute>
    (this Expression<T> expression) where TAttribute : Attribute
{
    // Get the method info in the expression of T.
    MethodInfo mi = (expression.Body as MethodCallExpression).Method;

    Assert.That(mi, Has.Attribute(typeof(TAttribute)));
} 
```

然后用这样的代码调用它：

```
(() => Console.WriteLine("Hello nurse")).
    AssertAttributeAppliedToMethod<MyAttribute>(); 
```

请注意，传递给该方法的参数是什么并不重要，因为该方法永远不会被调用，它只需要表达式。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-12T18:56:12.860

nunit 2.5 的替代方案：

```
var methodInfo = typeof(MyType).GetMethod("myMethod");

Assert.That(methodInfo, Has.Attribute(typeof(MyAttribute))); 
```

# asp.net - 复制/粘贴到 ASP .Net 时重音字符损坏

> ID：639914
> 
> 赞同：0
> 
> 时间：2009-03-12T18:33:05.553
> 
> 标签：asp.net, utf-8, character-encoding

我正在从 MS Word 文档复制粘贴到 ASCX 文件中。当我查看 ascx 文件时，重音字符正常显示。但是，当页面通过我的 ASP.net 应用程序呈现时，重音字符被破坏：

`Une promenade dans un verger ensoleillÃ©, un peau de pÃªche dÃ©licatement parfumÃ©eâ€¦ Les plaisirs du printemps vous attendent!`

该页面指定了 UTF-8 编码，我认为这是正确显示它们所必需的。

`<meta content="text/html; charset=utf-8" http-equiv="content-type" />`

通常，这可以正常工作，并且重音字符正常显示（我在同一站点上创建的其他页面仍然正确显示）。但是，现在我似乎无法让它正常工作。所以以前，我对此没有任何问题，但现在我看不出我做了什么不同的事情。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-12T18:36:10.040

您是否直接复制到html视图中？--- 如果你在设计器上复制它，它可能是对字符进行编码。

我不确定为什么它们没有为此页面编码，但请确保在 aspx html 视图中对所有它们进行编码，例如`&aacute;`á 或`&oacute;`ó

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-08-26T19:17:36.193

我的 ascx 文件被加载到另一个 ANSI 编码的 ascx 中。当我都被编码为 UTF-8 时，字符显示正常。

# c# - .NET 中的电话事件通知

> ID：639915
> 
> 赞同：2
> 
> 时间：2009-03-12T18:33:30.920
> 
> 标签：c#, .net, telephony, tapi

我有一个用 C# 开发的 Windows 窗体应用程序，它将受益于能够接收电话事件通知。

例如，如果办公室工作人员 Joe 在其组织的 PBX 系统上接听电话，我需要我的桌面应用程序知道它（以及他何时发起呼叫、何时挂断等）。

我想使用尽可能通用和通用的机制来实现这一目标，以获得最大的硬件/电话系统支持。

任何关于哪种技术组合最适用的建议将不胜感激。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-18T02:36:17.440

您可以在表单中插入 TAPI OCX 控件以接收电话事件。Internet 上有多种免费和共享软件 TAPI 控件。TAPI 支持传统电话和 VOIP 电话，您只需让电话设备供应商提供支持其设备的 TSP。

[另请参阅此问题](https://stackoverflow.com/questions/748186/how-to-capture-a-phone-number/762688#762688)的答案。

# wpf - 是否可以在开发的 WPF 应用程序中调整以更改分辨率？

> ID：639919
> 
> 赞同：0
> 
> 时间：2009-03-12T18:34:16.283
> 
> 标签：wpf

我阅读了有关 WPF 的信息，但我有以下担忧： 通常，当我们开发应用程序（在我的情况下）时，会尝试使用自动调整以适应分辨率变化的百分比。

目前我正在开发一个与 wpf apreder 一起使用的应用程序，以管理其在 1280 * 1024 上的操作，而当我想看到分辨率为 1024 * 768 的应用程序不符合新分辨率时。

这是代码 AXML 的示例。

```
<Window x:Class="pedido"        
    WindowState="Maximized"
xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
Title="pedido" 
WindowStyle="None" Name="VentanaPeido" Background="White" BorderThickness="2" AllowsTransparency="False">
<Window.Resources>      
    <Style x:Key="myHeaderStyle" TargetType="{x:Type GridViewColumnHeader}">
        <Setter Property="Visibility" Value="Collapsed" />
    </Style>
</Window.Resources>

<StackPanel Name="todo" HorizontalAlignment="Center" Width="1280" Height="1024">
    <Grid Background="Maroon" Name="grdInicio">
        <StackPanel Name="titulo" Width="1280" Height="214">
            <StackPanel Height="10">
            </StackPanel>
            <StackPanel Name="tituloLogo" Orientation="Horizontal" HorizontalAlignment="Center">
                <StackPanel  Orientation="Vertical" HorizontalAlignment="Center" VerticalAlignment="Center" Width="245" Height="150">
                    <Image  Name="logoAuto" Width="150" Height="148" Stretch="Uniform" HorizontalAlignment="Right" />

                </StackPanel>
                <StackPanel  HorizontalAlignment="Center" Width="765" Name="tituloLetras">
                    <Label  Height="67.5"  FontWeight="Bold" VerticalAlignment="Center" HorizontalAlignment="Center" Margin="1" Name="Mensaje" FontSize="44" Foreground="White" Width="707.5" OpacityMask="Black">Mensaje</Label>
                    <Label HorizontalAlignment="Center"  Canvas.Top="180" FontSize="48" FontWeight="Bold" Foreground="Gold" Height="85" Name="NombreTienda" Width="565" OpacityMask="Black">Nombre Tienda</Label>

                </StackPanel>

            </StackPanel>
            <StackPanel.Background>
                <ImageBrush  x:Name="fondoTitulo" Stretch="Uniform">
                </ImageBrush>
            </StackPanel.Background>
        </StackPanel>
    </Grid>

        <StackPanel Name="espacio1" Background="White" Height="12" Width="1280" VerticalAlignment="Top"></StackPanel>
        <StackPanel Name="panel" Orientation="Horizontal" VerticalAlignment="Top" HorizontalAlignment="Left" Width="1280" Height="800">
            <StackPanel Name="ticket" Orientation="Vertical" HorizontalAlignment="Center" Width="635" Height="1280">
                <ListView HorizontalAlignment="center" VerticalAlignment="Top"  Name="lvPedido"  Height="600" ItemsSource="{Binding}" FontSize="30" IsEnabled="True" IsTextSearchEnabled="False" IsTabStop="False" Grid.IsSharedSizeScope="False" BorderBrush="Black" ItemStringFormat="center" Background="White" FontFamily="Arila" BorderThickness="5" Opacity="3" FontWeight="Bold">
                    <ListView.View>
                        <!--ColumnHeaderContainerStyle="{StaticResource myHeaderStyle}"-->
                        <GridView ScrollViewer.IsDeferredScrollingEnabled="False"  >

                        <GridViewColumn Width="60">
                            <GridViewColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock TextAlignment="Left" HorizontalAlignment="Left" Text="{Binding Path=cantidad}"/>
                                </DataTemplate>
                            </GridViewColumn.CellTemplate>
                        </GridViewColumn>
                        <GridViewColumn Width="316">
                            <GridViewColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock TextAlignment="Left" Text="{Binding Path=item}"/>
                                </DataTemplate>
                            </GridViewColumn.CellTemplate>
                         </GridViewColumn>
                        <GridViewColumn Width="80">
                            <GridViewColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock TextAlignment="center" HorizontalAlignment="Center"  Text="{Binding Path=moneda}"/>
                                </DataTemplate>
                            </GridViewColumn.CellTemplate>
                        </GridViewColumn>

                        <GridViewColumn Width="150" >
                            <GridViewColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock TextAlignment="Right" HorizontalAlignment="Right" Text="{Binding Path=monto}"/>
                                </DataTemplate>
                            </GridViewColumn.CellTemplate>
                        </GridViewColumn>

                        </GridView>
                    </ListView.View>
                </ListView>
                <StackPanel   HorizontalAlignment="Center" Height="20"></StackPanel>

                <StackPanel Margin="15"  HorizontalAlignment="Right" Width="555" Height="150">
                    <TextBlock  HorizontalAlignment="Center" FontSize="40" Foreground="Black" Height="50" Width="535" FontWeight="Bold" Text="Total"></TextBlock>
                    <TextBlock Name="Monto" HorizontalAlignment="Center" FontWeight="Bold" FontSize="80" Width="565" Height="100" Opacity="2" OpacityMask="Magenta" OverridesDefaultStyle="True" Foreground="White">monto</TextBlock >
                </StackPanel>

                <StackPanel.Background>
                    <ImageBrush  x:Name="fondo1">
                    </ImageBrush>
                </StackPanel.Background>
            </StackPanel>
        <StackPanel Width="10" Height="800" Background="White"></StackPanel>
            <StackPanel Name="imagenProducto" VerticalAlignment="Top" Orientation="Vertical" HorizontalAlignment="Center" Width="635" Height="800">

            <StackPanel Name="Imagen1">
                <Image Name="itemP" Width="635" Height="299" Stretch="Uniform" Margin="2"/>
            </StackPanel>
            <StackPanel Name="Espacio" Background="White" Width="635" Height="10"></StackPanel>

              <StackPanel Name="Video" Width="635" Height="299" VerticalAlignment="Top">
                <MediaElement Name="Promo" Stretch="Uniform" Width="635" Height="299" LoadedBehavior="Manual" UnloadedBehavior="Stop" MediaEnded="Promo_MediaEnded"/>
                <StackPanel.Background>
                    <ImageBrush  x:Name="videoPromo" Stretch="Uniform">
                    </ImageBrush>
                </StackPanel.Background>
            </StackPanel>
            <StackPanel Name="Imagen2" Visibility="Collapsed" Width="635" Height="299">
                <Image Name="itemS" Width="635" Height="299" Stretch="Uniform" Margin="2" Tag="true" />
           </StackPanel>
           <StackPanel.Background>
                <ImageBrush  x:Name="fondo2">
                </ImageBrush>
            </StackPanel.Background>
        </StackPanel>

        </StackPanel>

</StackPanel> 
```

我做错事了吗？有更好的做法吗？

非常感谢你

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-16T20:20:47.360

下午好，

在阅读和分析代码教程后，我发现了一种使用方法来解决我的问题在它的帮助下，您可以根据大小或与我的情况相同的分辨率调整窗口的内容。

没关系，它定义了一个固定大小的对象（例如我自己），该动作试图调高窗口大小。

解决方案是代码：

```
<Window x:Class="pedido"        
    WindowState="Maximized"
xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
Title="pedido" 
WindowStyle="None" Name="VentanaPeido" Background="White" BorderThickness="2" AllowsTransparency="False">
<Window.Resources>      
    <Style x:Key="myHeaderStyle" TargetType="{x:Type GridViewColumnHeader}">
        <Setter Property="Visibility" Value="Collapsed" />
    </Style>
</Window.Resources>

<StackPanel Name="todo" HorizontalAlignment="Center" Width="1280" Height="1024">
 <Viewbox>
      <......>
   </Viewbox>

</StackPanel> 
```

如果其他人得到不同的解决方案或清洁剂，请继续写

# c++ - 通常如何返回分配在本地堆栈上的用户定义类型的实例

> ID：639922
> 
> 赞同：1
> 
> 时间：2009-03-12T18:35:04.177
> 
> 标签：c++

我对流行的方法很好奇。

我发现自己可以互换地做这两件事：

*请注意，在所有情况下，对象都是在本地分配的。*

```
std::string GetDescription ()
{
      std::string desc;

     /* Create a description */

       return desc;
}

void GetResult (map<int, double> & resultMap)
{
        /*Fill map result map with  values*/

}

map<int, double> GetResult2(map<int, double> & resultMap)
{
          map<int, double> & resultMap
        /* Fill map result map with  values */
          return resultMap;
} 
```

这样做的首选方法是什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-12T18:36:10.850

要么按值返回它，要么将其作为传入的 out 参数进行操作。除非您喜欢崩溃和未定义的行为，否则不要通过引用返回在堆栈上分配的任何内容。

编辑：这确实是风格问题。我更喜欢值类型的值和非值类型的输出参数。虽然如果我真的想抽象一些东西，我会使用专门的接口，本着`ostream`.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-12T18:54:24.970

我投票支持第一种方法，但返回一个布尔值以确认操作是否正确完成：

```
bool GetResult (map & resultMap)
{
        /*Fill map result map with  values*/
        return true;
}
```

如果该函数执行的操作可能会影响您的代码库的其余部分，它只会使后续工作变得更容易。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-12T20:14:20.007

对于较大的对象，我倾向于返回一个智能指针，当 C++0x 发布并且你有一个支持它的编译器时替换`std::auto_ptr`为`std::unique_ptr`它，或者选择另一个智能指针。

这种模式也符合强异常保证。

```
std::auto_ptr< std::map<int, double> > GetResult()
{
    std::auto_ptr< std::map<int, double> > result(new std::map<int, double>());
    // Fill result map with values
    return result;
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-12T20:24:43.040

一个函数接口有两部分：

1.  输入，通过参数赋予
2.  输出，通过返回值赋予

这个模式当然不是一个绝对的法则，但它是一个非常好的规则，无论是为了一致性（代码美学）还是为了可用性。除非您有充分的理由，否则不要破坏此*模式*。

效率？一般不是很好的理由。通过 out 参数返回值以提高效率是一种非常低级的技巧，它在 API 的公共接口中没有位置。不要使用它。特别是因为它是一个非常**过早**的优化。

现代 C++ 编译器定期执行[命名返回值优化。](http://blogs.msdn.com/slippman/archive/2004/02/03/66739.aspx)很少有情况不能以这种方式进行优化，我怀疑这些情况是否能从一般的论点中受益。

在这种 out 参数至关重要的少数情况下，将方法重构为公共 API 方法和私有实现，如下所示：

```
namespace impl {
    void my_private_impl(args…) {
        …
    }
}

LargeType my_public_function(args…) {
    LargeType ret;
    impl::my_private_impl(ret, args…);
    return ret;
} 
```

这样，客户端仍然可以从干净的接口中受益*并*获得性能优势（顺便说一句，外部方法无论如何都会被内联，因此使用这种模式*不会*造成性能损失）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-12T18:41:42.397

一般来说，我赞成第一种方法，因为它使值分配成为函数调用的结果，而不是它的“副作用”。我认为这使代码更易于阅读。

但是，当效率至关重要，或者创建/分配类型的成本很高时，我使用 out 参数方法。对于某些类型的对象（例如，容器），使用 out 参数是合理的习惯用法，所以这也是一个考虑因素。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-12T18:57:45.867

C++ 编译器可以优化某些涉及返回值的情况。[见这里](http://www.tantalon.com/pete/cppopt/final.htm#AvoidTemporaries)。我倾向于更喜欢返回值，主要是出于审美目的，因为我更喜欢功能风格，但显然你需要小心对象，比如集合，最终可能会被深度复制。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-12T19:40:33.863

对于值类型返回很好。对于对象和容器，通过引用传递是要走的路。返回深度嵌套的容器会导致很多额外的开销，而没有任何好处。返回非值类型的一个危险是当你有指针成员变量时。你想要这些成员的深拷贝还是浅拷贝？如果您不小心，最终可能会出现悬空指针。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-12T21:11:44.593

这在很大程度上取决于手头的任务。对于创建新值的函数，我会采用第一种方法，而对更改参数的函数使用第二种方法。正如其他人所提到的，在某些情况下，其他限制（创建/分配成本）可能会影响决策。

第一个定义清楚地表明它将无中生有地创建一个新对象并将其返回。也就是说，相同的定义是说明调用的语义。

第二个和第三个定义要求调用者在调用函数*之前*创建一个对象。这对用户来说可能很麻烦，因为她不能只是忽略返回值（或将其用作未命名的时间来提供另一个函数，请参见片段 1），并且可能会在某些情况下受到限制（即不能重新分配来自已创建的引用对象，请参见片段 2)。

从函数定义中并不清楚函数内部的参数有什么用。函数的行为会因传递的对象而异吗？从函数定义看不清楚。

第三种是，我相信，最糟糕的选择。它不仅强制调用者创建一个命名变量以传递给函数，而且还制作一个副本以返回（除非它是一个错字并且您正在返回一个 [可能是 const] 引用）

无论如何，其他考虑因素可能会抵消第一种方法提供的清晰语义的优势。在某些情况下，性能或其他限制，例如无法复制的对象（请参阅片段 3）

```
// snippet 1
//    user code to the different approaches
class X {};
X f1();
void f2( X& );
X f3( X& );
void g( X const & );

void test1()
{
   g( f1() ); // valid code
}
void test2()
{
   X x; // must create instance before
   f2( x ); // then call the function
   g( x );
}
void test3()
{
   X x; // must create instance before
   g( f3( x ) );
}

// snippet 2
class Y {};
class X
{
public:
   X( Y & y ) : y_( y ) {}
private:
   Y & y_;
};
X f1();
void f2( X & );
X f3( X & );

void test1()
{
   X x = f1();
}
void test2or3()
{  
   Y y;
   X x( y ); // user must create with a reference
   f2( x ); // f2 cannot change the reference inside x to another instance
}

// snippet 3
class X
{
private:
   X( X const & );
   X& operator= ( X const & );
};
X f1(); // Returned object cannot be used
void f2( X & );
X f3( X & );

void test1()
{
   X x = f1(); // compilation error
}
void test2()
{
   X x;
   f2( x );
}
void test3()
{
   X x;
   X y = f3( x ); // compilation error
} 
```

# asp.net - 您可以从 Visual Studio 2008 Tracepoint 打印 JavaScript 变量吗？

> ID：639923
> 
> 赞同：0
> 
> 时间：2009-03-12T18:35:04.190
> 
> 标签：asp.net, javascript, visual-studio, debugging

在了解了如何使用 Visual Studio 的 Tracepoint 功能打印出调试消息后，我很想知道它是否适用于 JavaScript 文件。到目前为止，它有，也没有。

如果我在 VS 2008 中编辑 .js 文件，我可以单击边距来创建断点。然后我可以右键单击断点并选择“当命中时”，然后出现对话框来定义操作。

我选择“打印消息”和“继续执行”。这样，断点就变成了一个跟踪点，并在 ASP.Net 程序在调试中运行时将消息打印到输出窗口。

这本身就很酷。但是，在 C# 代码中，我可以通过将变量括在 {} 中来将它们放入打印的消息中。所以我可以说“在函数 $FUNCTION，x = {x}”。当我尝试使用 JavaScript 跟踪点执行此操作时，无论我在括号中添加什么内容，它都只会显示“未定义*变量”。*

除了 JavaScript 跟踪点中的“你在这里”类型消息之外，还有什么方法可以打印有意义的信息？

我的意图是放入可以在调试中打印到输出控制台的计时代码，但不必在发布时注释掉。

它至少有点支持 JavaScript，因为如果我使用它是内置变量，比如 $FUNCTION 代表它工作的函数名。实际上我只是让它为 $FUNCTION 打印“JScript 匿名函数”，但它是在一个匿名函数中。如果有 $TIMESTAMP 我会处于良好状态。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-12T18:45:43.323

没有$TIMESTAMP，但有$TICK。它以十六进制打印毫秒计数'tick'，所以它看起来像这样：

```
Document Ready Start - 0x890A27
Document Ready End - 0x890E7C 
```

所以一点计算器的工作就可以找出两者之间的区别。

仍然不知道如何评估 JavaScript 变量...

更新：

它不如使用跟踪点那么好（因为您实际上并没有为它们添加东西到代码中），但是 Sys.Debug.trace() 就时序代码部分而言可以满足我的要求。

# html - 使用浮动时div折叠

> ID：639925
> 
> 赞同：10
> 
> 时间：2009-03-12T18:35:30.820
> 
> 标签：html, css

我有以下 HTML，我想在按钮和文本后面显示蓝色背景。不幸的是，使用以下代码，蓝色背景消失了。如果我删除了 ids 按钮和文本的 CSS，背景又回来了。

我究竟做错了什么？

谢谢！

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" >
<head>
    <title>Untitled Page</title>
    <style>

    #actions
    {
        background: blue;
    }

    #buttons
    {
        float: left;
    }

    #text 
    {
        float: right;
    }

    </style>
</head>
<body>

        <div id="actions">
            <div id="buttons">
                <input type="button" id="btnOne" value="Bla bla" />
                <input type="button" id="btnTwo" value="Bla bla bls" />
            </div>
            <div id="text">Bla bla bla</div>
        </div>

</body>
</html> 
```

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-12T18:42:14.267

你必须“清除”你的花车。浮动元素将它们带出页面的正常块定位，因此向右浮动的元素会脱离父容器，折叠 div。您可以清除它们，或者更简洁和聪明的方法是将 'overflow: auto' 添加到父容器：

```
#actions
{
    background: blue; overflow: auto;
}

#buttons
{
    float: left;
    overflow: hidden;
}

#text 
{
    float: right;
    overflow: hidden;
} 
```

由于“溢出：自动”可以在某些情况下产生滚动条，我通常通过在子元素上指定“溢出：隐藏”来明确防止这种情况。根据我的经验，这很可靠。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-12T18:40:20.810

试试这个：

```
 <div id="actions">
        <div id="buttons">
            <input type="button" id="btnOne" value="Bla bla" />
            <input type="button" id="btnTwo" value="Bla bla bls" />                
        </div>
        <div id="text">Bla bla bla</div>
        <div style="clear:both;height:1px;overflow:none;"></div>
    </div> 
```

基本问题是浮动元素对容器的计算高度没有贡献。因此，当其他两个 div 浮动时， div#actions 没有任何高度。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-12T19:04:55.430

有关浮动和清除它们的更多信息：[http ://www.dave-woods.co.uk/index.php/float-and-clear-a-comparison-of-css-clearing-techniques/](http://www.dave-woods.co.uk/index.php/float-and-clear-a-comparison-of-css-clearing-techniques/)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-27T05:43:13.387

如果非浮动元素仅包含浮动元素，则它不会有任何高度。要强制最外面的元素向下伸展并围绕浮动元素，它也必须是浮动的。这个问题的简单答案是也浮动“动作”div - 这将按预期扩展背景。

在底部添加一个额外的元素只是为了清除浮动元素是不必要的，也不是语义，所以应该不鼓励。

# .net - 解密字符串 C#

> ID：639935
> 
> 赞同：3
> 
> 时间：2009-03-12T18:38:11.907
> 
> 标签：.net, security, encryption

我的公司正在从第三方手中接管一个仅限会员的网站。我们重新编写了网站，最后一步是导入现有用户。我们有包含用户及其密码的数据库。我们还获得了“密钥”，并被告知密码字段是用 AES 加密的。

我需要解密密码，然后使用我公司的加密密钥在新数据库中重新加密它们。使用 .Net，如何仅使用密钥解密密码？我见过的所有示例都需要 BlockSize、InitializationVector、KeySize 等信息。我没有这些信息。

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-15T02:14:49.257

这似乎是错误的......密码通常不加密，它们是散列的。如果是这种情况，那么您将无法检索原始密码。

有什么方法可以查看原始代码以查看密码是如何生成的？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-15T09:03:25.000

为什么不向每个用户发送一封电子邮件，其中包含他们可以单击的唯一链接，从而将他们带到可以重置密码的页面？

无论如何，用户都应该定期更改密码。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-12T18:40:23.930

您可以使用 BlockSize 和 KeySize（它们是 8 IIRC 的倍数）。

不确定初始化向量。可能全为 0，但您至少需要 1 个正确解密的密码来验证这一点。

祝你好运。:)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-12T19:11:12.560

在不知道 IV 的情况下，很可能无法对其进行解密，尤其是因为您处理的密码很可能小于块大小（AES 标准是 128 位）。

您的选择在这里非常有限：

*   向第 3 方网站索取 IV
*   如果您可以访问他们的代码，您可能会发现相同的 IV 用于加密代码中的所有密码（尽管这不是很好的做法），因为如果不使用一次又一次地相同，或者将他们用于特定用户的那个存储在数据库中的某个位置
*   让用户在您的新版本网站上重新注册并使用某种形式的[散列](http://en.wikipedia.org/wiki/SHA1)而不是加密

# c++ - 将信息保存在从 func 到 func 的向量中

> ID：639937
> 
> 赞同：-2
> 
> 时间：2009-03-12T18:39:04.430
> 
> 标签：c++

我有一个非常琐碎的选项处理功能，我需要经常输入这个功能。所以我不能分配向量。我需要能够向向量添加一个元素并保存它，所以当我回到这个函数时它仍然是他们的。

```
vector<sStruct> * loadFile(char *myTextFile)
{
    myStruct 
        sStruct; 
    vector<myStruct> 
        vectorAddress,
        vectorData;
vectorData = &vectorAddress;
    string 
        feild1, feild2, feild3, feild4;

    ifstream 
        *inFile = new ifstream;

    inFile->open( myTextFile, ios::in );

    if ( !inFile->good() )
    {
         cout << "? File Doesnt Exist! " << endl;
    }

    while ( !inFile->eof() )
    {

// reading a file deliimted  by commas hi,hello,hey,1234
//...
         getline( *inFile, feild1, ',' );
         sStruct.m_1 = field1;
         getline( *inFile, feild2, ',' );
         sStruct.m_2 = field2;
         getline( *inFile, field3, ',' );
         sStruct.m_3; = feild3
         getline( *inFile, feild4 );
         sStruct.m_4 = feield4;

// saving each member of the struct in the vector
    vectorAddress.push_back( sStruct );

    }

    inFile->clear();
    inFile->close();

    cout << vectorAddress.size() << endl;
    delete inFile;  
//
   (*vectorData) = vectorAddress;
    return vectorData;
}

// This function tries despretly to add another element saved in struct member varaible
// to the end of the vector. I need the information from the first function to be here. What i think im trying to do is refer to the same address in memory.

vector<sStruct> *  addElement(vector<sStruct> *vAddElement)
{    
    myStruct sAddElement;  // referring to the same struct.
    vector<sStruct> vectorAddress;
    vAddElement = &vectorAddress;

    cout << "Enter a String: ";
    cin  >> sAddElement.feild1  // save user spec in struct member

    vectorAddress.push_back( sAddElement );
    cout << vectorAddress.size() << endl;
    (*vAddElement) = vectorAddress;
    return vAddElement;
} 
```

我试图在不改变功能签名的情况下做到这一点。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-12T19:02:06.450

首先，对这种类型的东西使用引用，它减少了不必要的代码并且不能为NULL。

关于这个问题，要添加到向量，使用 push_back 或其他添加到向量的方法，您所做的是尝试分配给向量：

```
vector<sStruct> *addElement(vector<sStruct> &vAddElement) {
    myStruct sAddElement;  // referring to the same struct.

    cout << "Enter a String: ";
    cin  >> sAddElement.feild1  // save user spec in struct member

    vAddElement.push_back(sAddElement);
    cout << vectorAddress.size() << endl;

    return &vAddElement; // since you said you must return a pointer (which is silly)
                         // we'll return the address of the object passed in.
} 
```

**编辑：**你为什么这么多（完全）使用指针，在你的程序中绝对不需要任何类型的动态分配或获取成员的地址。通常的堆栈分配和按引用传递可以让您用一半的代码（并且正确）完成相同的工作。

**编辑：此外，您的循环已损坏，****在**您尝试读取之前，您无法正确测试 EOF 。这样做更容易：

```
while(getline(file, line)) { /* process line */ } 
```

**编辑：**

您的这段代码甚至与您认为的不一样，我会为您推荐它，以便您知道：

```
vector<sStruct> *addElement(vector<sStruct> *vAddElement) {    
    myStruct sAddElement;

    // ...

    vector<sStruct> vectorAddress;  // creates a new *vector* on the stack
    vAddElement = &vectorAddress;   // makes vAddElement point to the new vector
                                    // but does *not* effect the vector whose
                                    // address you passed

    // ...

    vectorAddress.push_back( sAddElement ); // adds an element to the new vector
    cout << vectorAddress.size() << endl;   // it's size will always be 1, 
                                            // since you just added the first element

    (*vAddElement) = vectorAddress; // does absolutely nothing, you are assigning 
                                    // the new vector to itself

    return vAddElement;    // erroneously returns a pointer to the new vector
                           // it was allocated on the stack and no longer exists 
                           // after the return, **never do that **
} 
```

# design-patterns - 你如何为你的 DAL 制作一种通用的选择方法？

> ID：639938
> 
> 赞同：0
> 
> 时间：2009-03-12T18:39:16.800
> 
> 标签：design-patterns, oop, poco

**设想**

您有一个数据传输对象程序集，其中包含 10 个类，这些类准确地代表数据库中的 10 个表。您生成/构建具有以下方法的 DAL 层 -

```
 DTOForTable1[] GetDataFromTable1();
  DTOForTable2[] GetDataFromTable2(); 
```

等等....

**问题**

如何创建一种方法来隐藏从客户端代码中从每个表中获取数据的众多方法？例如，我在服务或业务层中想要的方法可能看起来像 -

```
SomeGenericDTO[] GetDataFromTable(TableTypeEnum tableTypeEnum); 
```

1.  我该怎么做呢 ？这甚至可能吗？

2.  如果（1）是，这是一个好习惯吗？

3.  如果 (1) 和 (2) 为是，这是否会简化设计或使设计复杂化？

提前致谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-12T19:00:30.963

你可以像这样定义它：

```
T[] GetDataFromTable1<T>() where T:IDto
{
   // you can know the table with the type of T
} 
```

也就是说，我宁愿使用不同的方法甚至类来使用它。我改用存储库模式，我建议查找有关它的信息。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-12T19:03:55.137

这是我的 DAL 的做法：

```
List<entity> customers = SQL.Read(new SearchCriteria(), new Customers()); 
```

要执行连接：

```
List<entity> customers = SQL.Read(new SearchCriteria(), new Customers(new Orders(new OrderDetails()))); 
```

DTO 类本身确定要访问的表，其属性确定要检索的列。

我无法回答这是最佳做法还是良好做法。这是长期以来对我有用的做法。没有诸如“GetById”、“GetAll”等无关的方法。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-12T19:05:50.000

如今，将具体表类实现为继承抽象表访问类是很常见的。抽象类具有查询表的通用方法。每个具体类都可以声明*对应的*数据库表（也可能是列和表间关系）。

有助于包括[ActiveRecord](http://martinfowler.com/eaaCatalog/activeRecord.html)和[Table Data Gateway](http://martinfowler.com/eaaCatalog/tableDataGateway.html)的设计模式。

# c# - 提醒图书馆用户注意不一致的状态

> ID：639945
> 
> 赞同：3
> 
> 时间：2009-03-12T18:40:41.383
> 
> 标签：c#, .net

在本地库的托管包装器中，我必须完成某些操作，对于高级对象的用户来说，这些操作应该被认为是原子的和一致的。但是，本机代码中的底层操作是原子的并且单独一致，但不是整体。

```
// Simplistic look at the AddRange operation
void AddRange(IEnumerable<ChildType> range)
{
    foreach (var value in range)
    {
        this.NativeAdd(value);
    }
}

// Simplistic look at the Delete operation
void Delete(ParentType value)
{
    foreach (var child in value.Children)
    {
        this.NativeDelete(child);
    }

    this.NativeDelete(value);
} 
```

如果本机代码涉及错误，则所有本机操作都会失败并出现一个常见的异常类型：

```
void NativeDelete(ChildType child)
{
    StatusCode status = StatusCode.NoError;
    NativeMethods.DeleteChild(this.id, child.Id, out status);

    if (status != StatusCode.NoError)
    {
        throw new LibraryException(this, child, status);
    }
} 
```

在高级 AddRange 和 Delete 例程中，我遇到了一些本地 Add 或 Delete 调用已完成，但其中一个发生错误而其余调用未完成的情况。

**更新：**对于用户来说，磁盘上的实际文件看起来不会有任何不同，如果他们添加了 7 个项目并且在第 7 个项目上失败，或者他们成功添加了 6 个项目。记录错误的唯一时间是在运行时。因此，如果用户没有意识到状态不一致的可能性，他们可能无法确定底层文件是否有效。

我是不是该：

1.  让 LibraryException 通过并向用户提供 ParentType 或 ChildType 对象可能处于不一致状态的文档
2.  将 LibraryException 包装在 InconsistentStateException 中，其中包含有关哪些对象可能处于不一致状态的信息
3.  捕获 LibraryException 并尝试“手动”回滚所做的更改，然后再为用户重新抛出异常（不是这个的粉丝）
4.  还有什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-12T18:52:39.047

如果没有真正的两阶段提交支持（即事务管理器），则 3 是不可能的。如果那里发生错误，手动回滚只会导致您进入更多不一致的状态。

我认为2是多余的。如果您在父类型上调用一个方法（这是这些方法暴露的地方）并且您在抛出该异常时发生异常，则假设对象上的状态已损坏（除了少数异常） . 通常，当这种情况发生时，除了扔掉它并使用具有一致状态的新对象之外，您无法对对象做太多事情。

剩下 1 来记录它。虽然您可能会在 2 中提供大量结构化信息，但如果对象处于不一致状态，您*真的*不想尝试修复该状态，因为您冒着将其搞砸的更大风险。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-12T18:46:15.367

我喜欢你的第二个选择-

这将提供一个更有意义的异常，您可以控制它。没有理由强迫您的最终用户理解一些奇怪的状态代码等。至少这样，发生了什么以及为什么会很明显。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-12T21:18:53.267

如果我正确理解您的更新，调用者所能做的就是将信息传递给最终用户，最终用户必须决定是接受状态还是回滚。

在这种情况下，（2）：提供所有信息，以便调用者可以将信息传递给用户，或日志文件，或一些统计信息，而无需大量工作。

(1) 如果与 (2) 没有信息差异，则可以，例如知道哪个项目失败是无关紧要的。

（3）如果你不能指望大多数时间修复它是没有意义的，如果你有一点机会让它变得更糟，那么它是危险的。

根据文件大小，您可以通过处理副本来进行准原子更改。至少，用户可能会期望一种简单的方法来回滚到上次保存。

# python - 在 Python 中验证 Oracle 日期

> ID：639949
> 
> 赞同：1
> 
> 时间：2009-03-12T18:41:20.760
> 
> 标签：python, oracle, validation

我们的 Python CMS 将一些日期值存储在通用“属性”表的*varchar*列中。其中一些日期稍后会移动到具有实际*日期*列的表中。如果 CMS 用户输入了无效日期，则在迁移之前不会被捕获，此时查询失败并出现“无效字符串日期”错误。

如何使用 Python 确保放入 CMS 的所有日期都是有效的 Oracle 字符串日期表示？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-12T19:03:31.737

> 如何使用 Python 确保放入 CMS 的所有日期都是有效的 Oracle 字符串日期表示？

我会稍微改变一下方法。让 Python 尽可能宽容地解析原始日期输入，然后以已知良好的表示形式输出日期。

[dateutil](http://labix.org/python-dateutil)的自由解析器可能是一个不错的起点：

```
import dateutil.parser
d= dateutil.parser.parse('1/2/2003')
d.strftime('%d-%b-%y') 
```

我不确定 '%d-%b-%y' 实际上仍然是 Oracle 的正确日期格式，但它可能会是类似的东西，理想情况下是四位数的年份并且不依赖于月份名称。（陷阱：%b 取决于语言环境，因此可能会在非英语操作系统上返回不需要的月份名称。）也许是“strftime('%Y-%m-%d')”，然后是“TO_DATE(..., 'YYYY -MM-DD')” 需要在 Oracle 端吗？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-12T19:18:18.783

Oracle 识别为日期的日期字符串的格式是数据库的可配置属性，因此依赖字符串到日期的隐式转换被认为是错误的格式。

通常，Oracle 日期格式为“DD-MON-YYYY”，但您不能总是依赖这种方式设置它。

就我个人而言，我会让 CMS 以标准格式（例如 'YYYY-MM-DD' -DD' ），你不会有任何问题。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-03-12T19:33:41.197

尽早验证。为什么不在 Python CMS 中将日期存储为日期？

很难知道像 '03-04-2008' 这样的字符串是什么日期。是 2008 年 4 月 3 日还是 2008 年 3 月 4 日？美国人会说 2008 年 3 月 4 日，而荷兰人会说 2008 年 4 月 3 日。

# c++ - 链接器问题，找不到现有方法？

> ID：639952
> 
> 赞同：0
> 
> 时间：2009-03-12T18:42:02.707
> 
> 标签：c++, linker

好的，我当前项目的链接器有问题（这是另一个问题的延续，ish）

基本上，链接器在 dynamiclib.so 中给出了一个未定义的引用：

```
std::basic_ostream<char, std::char_traits<char> >& SparseImplementationLib::operator<< <double, double, SparseImplementationLib::DefaultPtr<double, double> >(std::basic_ostream<char, std::char_traits<char> >&, SparseImplementationLib::AbstractSparseNode<double, double, SparseImplementationLib::DefaultPtr<double, double> > const&) 
```

我只能找到：

```
std::ostream& SparseImplementationLib::operator<< <double, double, SparseImplementationLib::DefaultPtr<double, double> >(std::ostream&, SparseImplementationLib::AbstractSparseNode<double, double, SparseImplementationLib::DefaultPtr<double, double> > const&)
```

文件内。

问题是，它们是相同的方法，真的（basic_ostream 和 ostream 可以互换？）

如果我手动将第一个方法添加到命名空间，它会抱怨它在编译时已经定义。

有谁知道这里到底发生了什么？

干杯，埃德

注意这是 MPICXX 和 CCMAKE

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-12T18:55:33.580

听起来您没有将 dynamiclib.so 正确链接到 SparseImplementationLib。您的 makefile 中是否有类似于 -lSparseImplementationLib 的链接器标志？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-13T02:12:46.320

对于我正在研究的类似 gStreamer 的引擎，我（几乎）遇到了同样的问题——从 .so 文件调用的函数在主代码中不存在。

我发现链接器正在删除该函数，因为它没有被任何内部函数调用。

目前，我已经通过函数调用/构造函数强制将函数包含在链接器中，在有条件地从不调用的函数中解决了这个问题：-

```
bool callme = false;

if(callme == true)
{
    dummyfunction();
} 
```

我发现这迫使链接器包含，但代码本身从未运行过。

如果有人有一个解决方案可以阻止链接器如此智能，或者有一个“正确”的方法可以使用，我想听听！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-13T12:04:16.167

好的，经过昨晚大约 10 个小时的黑客攻击，我今天早上设法解决了这个问题。

事实证明，如果您将函数的定义内联，并确保它具有所有模板参数和非默认参数的函数选项，它就会编译！

# python - 用python解压目录结构

> ID：639962
> 
> 赞同：29
> 
> 时间：2009-03-12T18:44:45.820
> 
> 标签：python, unzip

我有一个包含以下目录结构的 zip 文件：

```
dir1\dir2\dir3a
dir1\dir2\dir3b 
```

我正在尝试解压缩并维护目录结构，但是出现错误：

```
IOError: [Errno 2] No such file or directory: 'C:\\\projects\\\testFolder\\\subdir\\\unzip.exe' 
```

其中 testFolder 是上面的 dir1，subdir 是 dir2。

有没有快速解压文件和维护目录结构的方法？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-03-12T19:11:36.257

如果您使用的是 Python 2.6，则 extract 和 extractall 方法非常有用。我现在必须使用 Python 2.5，所以如果它们不存在，我只需要创建目录。`namelist()`您可以使用该方法获取目录列表。目录将始终以正斜杠结尾（即使在 Windows 上），例如，

```
import os, zipfile

z = zipfile.ZipFile('myfile.zip')
for f in z.namelist():
    if f.endswith('/'):
        os.makedirs(f) 
```

您可能不想*完全*那样做（即，您可能希望在遍历名称列表时提取 zip 文件的内容），但您明白了。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-03-13T00:56:12.760

**不要**相信 extract() 或 extractall()。

这些方法会盲目地将文件提取到文件名中给出的路径。但是 ZIP 文件名可以是任何东西，包括像“x/../../../etc/passwd”这样的危险字符串。提取此类文件，您可能已经破坏了整个服务器。

也许这应该被认为是 Python 的 zipfile 模块中的一个可报告的安全漏洞，但过去任何数量的 zip-dearchivers 都表现出完全相同的行为。要安全地解压缩具有文件夹结构的 ZIP 文件，您需要深入检查每个文件路径。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-03-12T19:11:42.667

我试过了，并且可以重现它。正如其他答案所建议的， extractall 方法**不能解决**问题。对我来说，这似乎是 zipfile 模块中的一个错误（可能仅限 Windows？），除非我误解了 zipfile 的结构。

```
testa\
testa\testb\
testa\testb\test.log
> test.zip

>>> from zipfile import ZipFile
>>> zipTest = ZipFile("C:\\...\\test.zip")
>>> zipTest.extractall("C:\\...\\")
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
  File "...\zipfile.py", line 940, in extractall
  File "...\zipfile.py", line 928, in extract
  File "...\zipfile.py", line 965, in _extract_member
IOError: [Errno 2] No such file or directory: 'C:\\...\\testa\\testb\\test.log' 
```

如果我做 a `printdir()`，我会得到这个（第一列）：

```
>>> zipTest.printdir()
File Name
testa/testb/
testa/testb/test.log 
```

如果我尝试仅提取第一个条目，如下所示：

```
>>> zipTest.extract("testa/testb/")
'C:\\...\\testa\\testb' 
```

在磁盘上，这会导致创建一个文件夹`testa`，其中包含一个**文件** `testb`。这显然是随后尝试提取`test.log`失败的原因；`testa\testb`是文件，不是文件夹。

编辑＃1：如果您只提取文件，那么它可以工作：

```
>>> zipTest.extract("testa/testb/test.log")
'C:\\...\\testa\\testb\\test.log' 
```

编辑#2：杰夫的代码是要走的路；遍历`namelist`；如果是目录，则创建目录。否则，提取文件。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2011-06-25T14:32:43.357

我知道现在说这个可能有点晚，但杰夫是对的。它很简单：

```
import os
from zipfile import ZipFile as zip

def extractAll(zipName):
    z = zip(zipName)
    for f in z.namelist():
        if f.endswith('/'):
            os.makedirs(f)
        else:
            z.extract(f)

if __name__ == '__main__':
    zipList = ['one.zip', 'two.zip', 'three.zip']
    for zip in zipList:
        extractAll(zipName) 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-03-12T19:03:04.717

如果您使用的是 Python 2.6，有一个非常简单的方法：[extractall](http://docs.python.org/library/zipfile.html#zipfile.ZipFile.extractall)方法。

但是，由于该`zipfile`模块完全在 Python 中实现，没有任何 C 扩展，您可能可以将它从 2.6 安装中复制出来并与旧版本的 Python 一起使用；您可能会发现这比自己重新实现功能更容易。但是，函数本身很短：

```
def extractall(self, path=None, members=None, pwd=None):
    """Extract all members from the archive to the current working
       directory. `path' specifies a different directory to extract to.
       `members' is optional and must be a subset of the list returned
       by namelist().
    """
    if members is None:
        members = self.namelist()

    for zipinfo in members:
        self.extract(zipinfo, path, pwd) 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-03-12T19:03:11.160

听起来您正在尝试运行 unzip 来提取 zip。

最好使用 python[`zipfile`](http://docs.python.org/library/zipfile.html)模块，因此在 python 中进行提取。

```
import zipfile

def extract(zipfilepath, extractiondir):
    zip = zipfile.ZipFile(zipfilepath)
    zip.extractall(path=extractiondir) 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2012-08-26T12:20:07.567

## 过滤名单以排除文件夹

您所要做的就是过滤掉以`namelist()`结尾的条目`/`，问题就解决了：

```
 z.extractall(dest, filter(lambda f: not f.endswith('/'), z.namelist())) 
```

开心！

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2015-03-18T22:13:22.717

如果像我一样，您必须使用较旧的 Python 版本（在我的情况下为 2.4）提取完整的 zip 存档，这就是我想出的（基于 Jeff 的回答）：

```
import zipfile
import os

def unzip(source_file_path, destination_dir):
    destination_dir += '/'
    z = zipfile.ZipFile(source_file_path, 'r')
    for file in z.namelist():
        outfile_path = destination_dir + file
        if file.endswith('/'):
            os.makedirs(outfile_path)
        else:
            outfile = open(outfile_path, 'wb')
            outfile.write(z.read(file))
            outfile.close()
    z.close() 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2010-02-27T02:27:24.963

请注意，zip 文件可以包含目录条目和文件条目。使用`zip`命令创建档案时，传递`-D`选项以禁用将目录条目显式添加到档案中。当 Python 2.6 的`ZipFile.extractall`方法在目录条目中运行时，它似乎会在其位置创建一个*文件*。由于存档条目不一定按顺序排列，这会导致`ZipFile.extractall`经常失败，因为它会尝试在文件的子目录中创建文件。如果您有要与 Python 模块一起使用的存档，只需将其解压缩并使用该`-D`选项重新压缩即可。这是我已经使用了一段时间的一个小片段来做到这一点：

```
P=`pwd` && 
Z=`mktemp -d -t zip` && 
pushd $Z && 
unzip $P/<busted>.zip && 
zip -r -D $P/<new>.zip . && 
popd && 
rm -rf $Z 
```

用相对于当前目录的真实文件名替换`<busted>.zip`和。`<new>.zip`然后只需复制整个内容并将其粘贴到命令 shell 中，它将创建一个新的归档文件，该归档文件已准备好与 Python 2.6 一起使用。有一个命令*可以*`zip`在不解压缩的情况下删除这些目录条目，但 IIRC 在不同的 shell 环境或 zip 配置中表现得很奇怪。

# sql-server - SQL 2005 实例不适用于 DNS

> ID：639970
> 
> 赞同：3
> 
> 时间：2009-03-12T18:46:19.827
> 
> 标签：sql-server, sql-server-2005, dns

基本上我有一个安装了命名实例（server/instance1）的 sql 2005 标准服务器。我还创建了一个指向 sql server ip 地址的 DNS 条目 (dnsDBServer)。我们拥有的 Web 应用程序可以使用以下方法（ipaddress/instance1、server/instance1）进行连接，但无法使用 dnsDBServer/instance1 进行连接。当然，这种方式违背了 dns 条目的目的。想知道 sql 别名是否有助于解决此问题，或者是否有人有解决方案。谢谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-12T19:23:09.520

很可能您的 DNS 解析并没有像您想象的那样工作。

从试图与您的 sql server 对话的机器上做一个 tracert 并查看它的去向。

您还应该查看请求机器和服务器之间的防火墙设置，看看是否有其他影响它的东西。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-12T19:34:09.277

是否存在域不匹配？例如 server.bob.net、dnsDBServer.fred.com？

1.  使用 ping -a 查看 DNS 别名和服务器名称的域解析。
2.  此外，在客户端的 DNS 设置中，检查“附加这些 DNS 后缀（按顺序）”列表。
3.  SQL 框上的 SSMS 可以连接到 dnsDBServer\instance1 吗？
4.  已经建议的跟踪器

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-12T21:51:23.143

哈，我刚刚意识到 Web 服务器（与运行 sql 服务器的服务器相同）没有更新它自己的 dns。我应该首先检查一下。我运行了 ipconfig /flushdns 并开始工作。我从来没有意识到检查服务器本身。谢谢你的帮助。

# java - 如何使用 Graphics2D 执行 MULTIPLY 复合效果

> ID：639977
> 
> 赞同：4
> 
> 时间：2009-03-12T18:50:42.127
> 
> 标签：java, swing, graphics

我有两个不同的 javax.swing.Icon 对象，我想创建一个新的 Icon，它是这两个对象的组合。我希望合成是一种 MULTIPLY 效果，类似于您在选择该选项时在任何类似 Photoshop 的图像编辑应用程序中获得的效果。具体来说，对于每个像素，如果您分别具有来自图像 1 和图像的颜色 Ca 和 Cb

Ca = (Ra,Ga,Ba) Cb = (Rb,Gb,Bb)

我希望输出是

Cc = (Ra *Rb,Ga* Gb,Ba*Bb)

我想即时（实时）执行此操作，因此我必须仅使用 Graphics2D 操作来执行此操作。我看过 AlphaComposite 并没有看到可以做到这一点。有人有想法么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2015-11-06T22:28:32.010

由于这个问题的大多数答案都指向很多场外资源，我想我会在这里提供一个完整的实现。它本质上与您可能见过的大型混合模式库相同，但我为了实现特定的混合模式而去掉了抽象。

关于以下代码的一些注释：

*   简单地使用`g.setComposite(MultiplyComposite.Multiply)`

*   该类`MultiplyComposite`实现了两者`Composite`，`CompositeContext`因为对于我的需要，两者之间没有什么不同。如果您有一个可以调整参数或混合应用不同的混合模式，您将需要分别实现这两个类。

*   此代码仅适用于 32 位“整数”缓冲区。您需要修改它以使用 16 位颜色（移动和屏蔽 5/6 位而不是 8 位）

*   此代码使用最后一个字节作为 Alpha 通道。您需要修改代码以处理没有 Alpha 通道（24 位）的数据。

*   该方法中右移 8`mixPixel`是除以 256 的快速方法。例如。`(a * b) >> 8`代替`(a * b) / 256`

*   从左到右，一次处理一行像素。如果您有更多内存，您可以修改它以一次处理整个缓冲区。

* * *

```
public class MultiplyComposite implements Composite, CompositeContext {
    protected void checkRaster(Raster r) {
        if (r.getSampleModel().getDataType() != DataBuffer.TYPE_INT) {
            throw new IllegalStateException("Expected integer sample type");
        }
    }

    @Override
    public void compose(Raster src, Raster dstIn, WritableRaster dstOut) {
        checkRaster(src);
        checkRaster(dstIn);
        checkRaster(dstOut);

        int width = Math.min(src.getWidth(), dstIn.getWidth());
        int height = Math.min(src.getHeight(), dstIn.getHeight());
        int x, y;
        int[] srcPixels = new int[width];
        int[] dstPixels = new int[width];

        for (y=0; y < height; y++) {
            src.getDataElements(0, y, width, 1, srcPixels);
            dstIn.getDataElements(0, y, width, 1, dstPixels);

            for (x=0; x < width; x++) {
                dstPixels[x] = mixPixel(srcPixels[x], dstPixels[x]);
            }

            dstOut.setDataElements(0, y, width, 1, dstPixels);
        }
    }

    private static int mixPixel(int x, int y) {
        int xb = (x) & 0xFF;
        int yb = (y) & 0xFF;
        int b = (xb * yb) / 255;

        int xg = (x >> 8) & 0xFF;
        int yg = (y >> 8) & 0xFF;
        int g = (xg * yg) / 255;

        int xr = (x >> 16) & 0xFF;
        int yr = (y >> 16) & 0xFF;
        int r = (xr * yr) / 255;

        int xa = (x >> 24) & 0xFF;
        int ya = (y >> 24) & 0xFF;
        int a = Math.min(255, xa + ya);

        return (b) | (g << 8) | (r << 16) | (a << 24);
    }

    @Override
    public CompositeContext createContext(ColorModel srcColorModel, ColorModel dstColorModel, RenderingHints hints) {
        return this;
    }

    @Override
    public void dispose() {

    }

    public static final MultiplyComposite Multiply = new MultiplyComposite();

} 
```

# php - 知道加载 xml 文件的 .htaccess mod_rewrite 解决方法吗？

> ID：639978
> 
> 赞同：0
> 
> 时间：2009-03-12T18:50:51.983
> 
> 标签：php, .htaccess

这是我当前的`.htaccess`代码（打开引擎等）：

```
RewriteRule ^foo\.xml$ bar.php [NC] 
```

这段代码在 . 等域名上运行良好`foobar.com`。它不适用于临时域，如`bar.com/~foo/`：

有解决办法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-12T19:26:05.737

您正在检查的**RegEx**正在评估是否`foo.xml` *是*请求，但对于文件夹，请求将更像`~foo/foo.xml`. 添加另一个规则：

```
RewriteRule ^(.+)/foo.xml$ bar.php [NC] 
```

我还没有检查它，但类似的东西应该会有所帮助。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-12T19:28:44.827

试试这个规则：

```
RewriteRule ^(.+/)?foo\.xml$ $1bar.php 
```

# web-services - 是否可以在报告服务报告中执行 Web 服务调用？

> ID：639987
> 
> 赞同：8
> 
> 时间：2009-03-12T18:53:00.637
> 
> 标签：web-services, reporting-services

是否可以在报告服务报告中执行 Web 服务调用？（即对数据源使用 WS 调用）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-12T18:55:30.053

[http://technet.microsoft.com/en-us/library/aa964129.aspx](http://technet.microsoft.com/en-us/library/aa964129.aspx)

本白皮书将为您提供有关使用 Web 服务和其他基于 XML 的源作为报告数据源的信息。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-26T06:16:33.347

这个答案可能有点离题，但仍可能包含一些有用的信息。:)

是的，您可以连接到 Web 服务。我正在使用它为 Reporting Services 提供来自基于 Web 服务的 ERP 系统的数据。ERP 系统建立在 SQL Server 和 ASP.NET 之上，并使用 SSRS 进行报告。

他们最近将数据库和报告服务器都升级到了 2008 年，从那时起，我实际上在基于 Web 服务的连接方面遇到了一些问题。

我不知道是不是只有 BIDS 2008 有问题，还是应该归咎于我从 BIDS 2005 自动转换的报告项目，或者服务器端是否配置错误。

但例如，我无法更新数据集中的查询字段。我被迫手动添加新的查询字段。我也无法使用查询设计器进行查询，这在 BIDS 2005 中的“数据”选项卡上是可能的（顺便说一下，我真的很想念 BIDS 2008）。

与 2005 年的环境相比，似乎还有很多其他事情并没有按预期工作。

老实说，我没有尝试从头开始构建新报告，这样可能会解决我的一些问题。

不过，BIDS 2008 中的预览模式和已发布的报告效果很好。:)

# svn - CruiseControl.net 和 svn 结帐

> ID：639988
> 
> 赞同：0
> 
> 时间：2009-03-12T18:53:07.533
> 
> 标签：svn, cruisecontrol.net

我能够让巡航控制与 svn 一起工作。我想要做的是，当 Cruisecontrol 检测到存储库中的更改时，它会删除我工作目录中的所有内容，**然后**再次签出整个项目。我不确定我该怎么做。似乎 Cruisecontrol 在存储库中有并更新时会自动更新工作目录，但在更新目录之前它不会删除额外的文件（如 bin 文件）。

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-12T19:03:36.650

在您的 ccnet.config 文件中，您的源代码控制块是否包含 cleanCopy 项？要删除工作目录中的所有内容，请确保将 cleanCopy 设置为“true”

希望这可以帮助。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-12T19:00:56.890

我不知道 SVN 是否以类似 TFS 的方式工作（它有一个缓存等等......），但这是我使用 CC.NET 和 Sourcesafe 的方法：

在我项目的预构建部分，我确保我清理了我的工作目录，即：我删除了其中的所有内容。
（包含在 prebuild 部分中的任务将在 CC.NET 使您的项目的最新版本脱离源代码控制之前执行）。

为了实现这一点，我调用了一个在我的 buildscript (msbuild) 中定义的 Target，它被称为“clean”。

此目标删除所有文件和目录。

这或多或少是我的 msbuild buildscript 中的任务的样子（实际上，我这里没有它）：

```
<Task name="clean">
   <ItemGroup>
       <FilesToDelete include="$(workingdir)\**\*.*" />
   </ItemGroup>
   <ItemGroup>
        <DirectoriesToDelete include="$(workingdir)\**" />
   </ItemGroup>
   <Delete Files="@(FilesToDelete)" />
   <RemoveDir Directories="@(DirectoriesToDelete)" />
</Task> 
```

然后，在 CC.NET 项目配置中，我使用 MSBuild 任务调用 MSBuild 脚本，并调用此目标。

我喜欢这个的地方是，我也可以非常轻松地清理工作站上的工作目录；我只需要在命令行上调用 msbuild 来调用这个目标，而我的工作目录是空的。我也有类似的任务来执行最新的、完整的构建等。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-09-04T18:47:15.863

您可以让构建脚本先删除 bin 目录，然后编译项目。创建一个名为“clean”的构建任务，删除已编译的输出文件夹，然后将任务“mainBuild”设置为依赖于“clean”。如果所有内容都编译到一个公共输出文件夹，则创建“干净”任务会更容易。

无论是设置 ccnet.config 来清理工作副本，还是添加构建任务来清理工作副本，都是一个偏好问题。

# bash - 无法在 Mac 中将 TERM 放入 .bashrc

> ID：639990
> 
> 赞同：0
> 
> 时间：2009-03-12T18:54:02.553
> 
> 标签：bash

[Stevey](http://stevey-home.blogspot.com/)建议将以下命令设置为 .bashrc

```
TERM=xterm-256color 
```

我将代码放在 .bashrc 的顶部，现在我有一个闪烁的黑绿色终端。我的终端中的字体颜色会定期从黑色切换到绿色，反之亦然。

**我做错什么了？**

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-12T18:58:40.203

简单来说，Mac 的终端应用程序不支持 256 色。见这里：[http ://news.ycombinator.com/item?id=443769](http://news.ycombinator.com/item?id=443769)

从同一个链接，看起来可能还有其他终端可以这样做。祝你好运！

# apache-flex - 使默认参数=变量的最佳方法？

> ID：639994
> 
> 赞同：0
> 
> 时间：2009-03-12T18:54:46.267
> 
> 标签：apache-flex, actionscript-3, parameters, default

我有一个变量，为了简洁起见，我们认为它看起来像这样：

```
private function applyDiscount (value:Number):Number
{
return value*_discount; //_discount defined somewhere else
} 
```

好的，这一切都很好，但说我希望能够调用该函数并能够传递我自己的折扣，但仍然使用 _discount 作为默认值。

我可以做这个：

```
private function applyDiscount (value:Number, discount:Number = 50):Number
    {
    return value*discount;
    } 
```

这将使折扣默认为 50，但我在创作时不知道，所以我需要这样做，但 Flex 中不允许这样做。

```
private function applyDiscount (value:Number, discount:Number = _discount):Number
    {
    return value*discount;
    } 
```

**所以我的问题是，实现与 Flex 中最后一个示例相同的最佳方法是什么？**

谢谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-12T19:50:24.820

```
 private function applyDiscount(value: Number, discount : Number = Number.POSITIVE_INFINITY){
   if(discount == Number.POSITIVE_INFINITY) discount = _discount;
    return value*discount;
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-12T19:05:10.857

也许将折扣公开为公共属性，以便您可以将其单独设置为方法调用。例如

```
public function get discount():Number{ 
    return _discount; 
} 

public function set discount(param:Number):void { 
    _discount = param; 
}

private function applyDiscount (value:Number):Number
{
    return value*_discount; //_discount defined somewhere else
} 
```

附加功能在评论中看起来很傻，所以我在这里添加了它......基本上你可以将折扣作为可选参数。

```
function applyDiscount(value:Number, ... rest):void {
    if(rest.length > 0) {
        return value*rest[0];
    } else {
        return value*_discount; //_discount defined somewhere else
    }
}

applyDiscount(100, 10); // 10 discount...
applyDiscount(100); // default discount... 
```

# css - 有没有办法在 *.css 文件中执行特定于浏览器的条件 CSS？

> ID：639999
> 
> 赞同：17
> 
> 时间：2009-03-12T18:56:51.517
> 
> 标签：css, cross-browser

有没有办法在 *.css 文件中执行特定于浏览器的条件 CSS？我想在同一个物理文件中定义所有样式。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-12T19:11:16.040

有一种方法可以在 IE 中利用浏览器和 @import 中的错误来实现。我见过的最好的方法是[在这里](https://stackoverflow.com/questions/615448/css-method-to-include-ie6-hacks/615769#615769)，由 bobince 提供（并且肯定击败了我的答案，呵呵）。

但总的来说，没有。甚至条件注释也是特定于 IE 的浏览器。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2014-12-20T06:44:45.540

我一直在为许多，特别是最近的浏览器——大多数版本的 Firefox、Webkit 和 Internet Explorer 版本进行此工作。最近，Safari 和 Chrome 的版本能够分开。其中一些我放在 browserhacks.com 上

最好先从你能做的最好的 CSS 开始，但是当你的时间很短并且需要一些东西时，这些都是可用的……昨天。

目前作为参考，Internet Explorer 是第 11 版，Safari 是第 8 版，Firefox 在开发/Aurora 版本中最多 36 个，Chrome 在开发/金丝雀版本中最多 41 个。

这些是非常具体的，如果通过删除任何部分来更改它们，它们将无法正常工作。

针对任何版本的 Firefox [不在 iOS 上！见下文]：

```
/* Firefox (any) */

_:-moz-tree-row(hover), .selector { color:red; } 
```

要检测新版本的 Chrome：

（这不适用于 iOS 上的 Chrome ！！！——开发人员在 iPad 和 iPhone 上使用了 Safari 引擎，而不是 Chromium 或 Mozilla——所以你使用 Safari hack 来代替这些浏览器的 iOS 版本）

```
/* Chrome 29 and newer */

@media screen and (-webkit-min-device-pixel-ratio:0)
and (min-resolution:.001dpcm) {
    .selector { color:red; }
} 
```

如果您想这样做，您还可以使用我制定的组合 hack 将 Chrome 定位在更远的位置（这是奇怪的 CSS，但它有效 - 完全按照您在此处看到的方式复制它）：

```
/* Chrome 22-28 */

@media screen and(-webkit-min-device-pixel-ratio:0)
{
   .selector {-chrome-:only(; 
       color:red; 
   );} 
} 
```

要检测新版本的 Safari 和 Chrome 一样难以解决，这个使用了一对嵌套的媒体查询：

```
/* Safari 6.1-10.0 */

@media screen and (min-color-index:0) and(-webkit-min-device-pixel-ratio:0) 
{ @media {
   .selector { color:red; } 
}} 
```

Safari 于 2017 年 3 月下旬更新，因此适用于 10.1：

```
/* Safari 10.1+ */

@media not all and (min-resolution:.001dpcm) 
{ @media {
   .selector { color:red; } 
}} 
```

对于版本（7.1 及更高版本），您可以使用以下版本：

```
/* Safari 7.1+ (10.1 is the current version as of April 2017) */

_::-webkit-full-page-media, _:future, :root .selector { color:red; } 
```

要定位较新版本的 Internet Explorer：

```
/* Internet Explorer 11 */

_:-ms-fullscreen, :root .selector { color:red; }

/* Internet Explorer 10+ AND Microsoft Edge */

_:-ms-lang(x), .selector { color:red; }

/* Internet Explorer 9-11 */

_::selection, .selector { color:red\0; }

/* Microsoft's Edge Browser */

@supports (-ms-ime-align:auto) { .selector { color:red; } } 
```

这些是基础知识，但要查看我针对许多不同浏览器版本的更多创作，请参阅我的博客：

[https://jeffclayton.wordpress.com](https://jeffclayton.wordpress.com)

或我的实时 CSS hack 测试页面：

[https://browserstrangeness.bitbucket.io/css_hacks.html](https://browserstrangeness.bitbucket.io/css_hacks.html) 镜像： [https ://browserstrangeness.github.io/css_hacks.html](https://browserstrangeness.github.io/css_hacks.html)

享受！

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-03-14T02:32:25.063

你可以使用这个聪明的 javascript 文件，CSS 浏览器选择器：[http ://rafael.adm.br/css_browser_selector/](http://rafael.adm.br/css_browser_selector/)

它允许您通过使用类名来定位特定的浏览器，例如：

```
.ie .example {
  background-color: yellow
}
.ie7 .example {
  background-color: orange
}
.gecko .example {
  background-color: gray
}
.win.gecko .example {
  background-color: red
}
.linux.gecko .example {
  background-color: pink
}
.opera .example {
  background-color: green
}
.konqueror .example {
  background-color: blue
}
.webkit .example {
  background-color: black
} 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-12T19:00:36.657

只能通过黑客手段。条件注释只为标记文件定义，而不是 .CSS 文件。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-12T19:00:29.277

不确定一种方法可以做到这一点。我们只是在代码隐藏中根据用户浏览器设置 CSS 文件。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-12T19:13:49.637

不，使用 CSS 文件的全部目的是每个文件代表特定的样式。如果你想写脚本，你应该使用 PHP 或类似的东西，CSS 只是单一样式的描述。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-13T11:20:13.587

有多个 hack（以这个[有些过时的表](http://dithered.chadlindstrom.ca/css_filters/css_only/index.php)为例）

还有基于服务器端的解决方案，例如php的[条件 css](http://conditional-css.com/)

但是写得好，结构良好的 css 不需要那么多的 hack，只需要偶尔的 ie 修复。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2014-11-06T11:27:03.733

我认为没有比上面提到的 Rafael Lima 更好的 CSS 浏览器选择器了，所以我不会在此处添加链接或在同一篇文章中取自 Rafael Lima 页面的示例。

需要注意的是，它只能在 CSS 选择器之外使用，并且不针对特定的 CSS 行，但它比标准方法更健壮并且更易于阅读。************