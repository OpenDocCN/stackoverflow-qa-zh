# StackOverflow 问答 000217000-000217999

# python - OS X 上的 Python/editline：£ 符号似乎绑定到 ed-prev-word

> ID：217020
> 
> 赞同：0
> 
> 时间：2008-10-19T21:33:45.963
> 
> 标签：python, macos, unix, terminal, editline

在 Mac OS XI 上，无法在 Python 交互式 shell 中输入英镑符号 (£)。

```
* Mac OS X 10.5.5
* Python 2.5.1 (r251:54863, Jan 17 2008, 19:35:17)
* European keyboard (£ is shift-3) 
```

当我在 Python 交互式 shell 中键入 shift-3 时，我似乎调用了前一个单词函数，即光标将移动到该行上键入的最后一个“单词”（即以空格分隔的项目）的开头。当我回到 bash shell 时，键入 shift-3 只会产生一个 £，正如预期的那样。

这个版本的 Python 显然使用 editline 作为它的交互式 shell，而不是 readline。我猜测默认的编辑行键绑定之一将 shift-3（或当我键入 shift-3 时看到的任何编辑行）绑定到 ed-prev-word 命令。

我在 ~/.editrc 文件中尝试了一些方法来删除此绑定，但它们没有任何效果：

*   `bind -r £`
*   `bind -r \243`
*   `bind -r \156`

另一个导致总线错误：

*   `bind £ \243`

有任何想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-19T21:54:07.437

这可能是编辑线问题；libedit 可能不接受 UTF-8 字符：

*   [http://tracker.firebirdsql.org/browse/CORE-362#action_11593](http://tracker.firebirdsql.org/browse/CORE-362#action_11593)
*   [http://marc.info/?t=119056021900002&r=1&w=2](http://marc.info/?t=119056021900002&r=1&w=2)

# flash - Flash CS3 电影在浏览器中失败

> ID：217030
> 
> 赞同：0
> 
> 时间：2008-10-19T21:47:06.763
> 
> 标签：flash, actionscript-3, cs3

我的 AS3-heavy 项目在 IDE 中测试良好，但某些部分在发布时无法在浏览器中运行。有什么想法可能导致这种情况吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-19T22:38:54.117

如果您提供一些关于什么不起作用的更具体的信息可能会有所帮助。你能发个链接吗？此外，您项目的任何部分是否引用了任何远程对象？如果是这样，您可能希望确保您的远程对象位于您的应用程序期望的位置。如果您正在执行任何跨站点脚本，您可能还需要将 crossdomain.xml 添加到您的服务器根目录。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-19T23:00:01.593

跨域问题？

在非 Windows 服务器上区分大小写？

您始终可以使用闪存调试器启动远程调试以确定原因。文档解释了如何做到这一点。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-19T23:01:04.870

在黑暗中拍摄 - 您是否在浏览器中运行正确版本的 Flash 播放器？请记住，浏览器安装的播放器和 IDE 播放器不一定同步。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-20T20:33:38.003

感谢您的建议。我对此很陌生，我想我可能已经找到了解决方案：我的 .swf 包含声音和图形，并且直到现在还没有预加载器。使用适当的预加载器（由 Lee Brimelow 在 Gotoandlearn.com 上的教程提供）似乎可以正常工作。再次感谢。

# neural-network - 神经网络或人机交互

> ID：217034
> 
> 赞同：7
> 
> 时间：2008-10-19T21:52:02.637
> 
> 标签：neural-network, hci

一旦我完成了作为 Web 开发人员的实习年，我将在下一学年进入我的大学三年级，我想听听关于 Title 中的两个模块的一些意见。

我对两者都感兴趣，但是我想选择一个与我的职业相关并且可以应用于我开发的系统的。

我正在攻读互联网计算学位，它涵盖了网络开发、网络、数据库工作和编程。虽然我已经让自己成为一名网络开发人员，但我对此不再那么确定，所以我试图不将自己限制在那个开发领域。

我知道 HCI 会帮助我成为一名 Web 开发人员，但你认为这值得吗？你认为神经网络知识可以在我未来编写的系统中真正帮助我吗？

谢谢。

**编辑：我认为跟进我决定做什么以及它是如何工作的会很有用**。

我选择人工神经网络而不是 HCI，我真的很喜欢它。对认知科学和机器学习的了解激发了我对该学科领域的兴趣，我希望在几年后能负担得起的时候承担一个研究生项目。

我有一份工作，我在期末考试（几天后）后开始工作，确实有人问我是否做过人机交互或类似的模块。这似乎并不重要，因为它不是前端开发人员的职位！

如果您可以选择该模块，我建议您选择该模块，以及任何包含生物计算的模块，如果您将来想进行研究生研究，它将打开更多的大门。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-19T22:03:02.193

价值取决于三个因素：

*   你对这个话题有多熟悉？
*   您想参加的课程/课程有多好？
*   你对什么更感兴趣？

尤其是对于 HCI，您还可以通过阅读一本好书或在互联网上发表的更多关于它的文章轻松获得广泛的“常识”信息。另一方面，确实存在许多主要通过心理学研究获得的更深层次的见解。如果课程做得正确，您确实可以学到很多关于该主题的知识以及用于开发界面的真正考虑因素。

对于神经网络，不得不说这是一个典型的炒作话题。这门课程主要关注神经网络的应用领域。您可以确定自己不会为 Web 开发编程或使用任何神经网络。另一方面，如果课程做得好，这可能是您拓宽知识的好机会。特别是加深你对计算机科学理论的理解。不过，这在很大程度上取决于课程的布置方式。

HCI 是一个有助于您作为 Web 开发人员职业生涯的主题，但前提是您在该主题上感到无能（那么这是必须的）或者做得很好。神经网络是一个更有潜力成为真正有趣的核心计算机科学东西的主题，你确实可以更好地了解某些东西。如果你对 NN 感兴趣，你不应该错过接受不局限于 Web 开发领域的教育的机会——毕竟，也许你会对其他东西产生更多的兴趣（了解其他东西总是好的）您可能希望将来进入的方向）。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-19T21:59:47.037

在您阅读细则之前，神经网络听起来[很酷](http://en.wikipedia.org/wiki/Artificial_neural_network)：

> 在人工神经网络**的现代软件实现中，受生物学启发的方法或多或少已被放弃**，而采用基于统计和信号处理的更实用的方法。

这是让我困惑多年的事情。在这里，您拥有一个非常复杂且功能强大的控制系统（现实世界的生物神经网络），以及一门似乎是关于在软件中对这些系统进行建模但实际上已经放弃该活动的学科。

如果您正在进行 Web 开发，那么您的时间可能最好花在 HCI 课程上。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-19T22:00:46.083

选择你最感兴趣的。HCI 的东西以后会更容易根据需要学习，你可能再也没有机会学习神经网络了！

对于未来的雇主（至少是好雇主！），您需要对自己的工作表现出热情和兴奋。我宁愿雇佣能热情地谈论神经网络的人，也不愿雇佣在 HCI 方面有额外功劳的人。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-19T21:56:50.520

除非您想做世界末日的研究，即获得硕士/博士学位，否则请选择人机交互。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-19T22:55:42.180

当我学习人工智能时，我在大学学习神经计算。我现在经营自己的公司。自从我学习以来，我使用我的神经网络技能的次数为零。我很高兴我做到了，因为它非常吸引人，但从我现在的位置来看，我会发现 HCI 更有用。我认为您会从与软件行业相关的 HCI 课程中获得更多见解，但如果您认为自己的经验应该更多地体现在开发的深奥/几乎艺术方面，请选择 NN。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-19T21:57:33.750

哪个听起来更有趣？或者，等效地，你会在哪个方面更加努力？选那个。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-19T22:30:12.497

在 NN 和其他一些 AI 课程中做了两门课程——研究这些东西很有趣，我实际上设法在我做过的一些事情中实现了这些东西，比如面部识别，它在其他一些领域很有用如果你想绘制你的实验室数据等。我在我的网络开发生涯中从未使用过 NN:s 虽然我确信它可以用于某些事情但是它真正归结为找到愿意支付费用的客户或员工当你可以走直路的时候。因此，如果我不是那么顽固的话，我宁愿阅读有关它的书。

基础神经网络不需要太多数学知识，这是我在第一门课程中使用的。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-26T00:57:05.133

as a programmer to be you need the knowledge of neural network. if parallel processing is the way to go in hardware then future programmers must be knowledgable in neural network. don't forget that NN works better with noise or imprecise data but other systems may not. Note that most data we use for analysis are sample data which is a fraction of the whole and you could imagine if some in the sample are way off. so you need knowledge of NN if you want to last in computer programming field.

# java - 无法在 Java 中创建 LinkedLists 数组...？

> ID：217065
> 
> 赞同：103
> 
> 时间：2008-10-19T22:25:54.113
> 
> 标签：java, arrays, generics

我正在研究一个**需要**使用数组`LinkedList`来存储矩阵值的稀疏矩阵类。数组的每个元素（即每个`LinkedList`）代表矩阵的一行。并且，`LinkedList`数组中的每个元素代表一列和存储的值。

在我的课堂上，我将数组声明为：

```
private LinkedList<IntegerNode>[] myMatrix; 
```

而且，在我的构造函数中`SparseMatrix`，我尝试定义：

```
myMatrix = new LinkedList<IntegerNode>[numRows]; 
```

我最终得到的错误是

> 无法创建 的通用数组`LinkedList<IntegerNode>`。

所以，我有两个问题：

1.  我做错了什么，和
2.  如果无法创建数组，为什么该类型在声明中是可接受的？

`IntegerNode`是我创建的一个类。而且，我所有的类文件都打包在一起。

* * *

## 回答 #1

> 赞同：145
> 
> 时间：2008-10-19T22:45:45.913

出于某种原因，您必须转换类型并进行如下声明：

```
myMatrix = (LinkedList<IntegerNode>[]) new LinkedList<?>[numRows]; 
```

* * *

## 回答 #2

> 赞同：65
> 
> 时间：2008-10-19T22:53:11.983

您不能使用通用数组创建。这是java泛型的一个缺陷/特性。

没有警告的方法是：

1.  使用列表列表而不是列表数组：

    ```
    List< List<IntegerNode>> nodeLists = new LinkedList< List< IntegerNode >>(); 
    ```

2.  声明列表数组的特殊类：

    ```
    class IntegerNodeList {
        private final List< IntegerNode > nodes;
    } 
    ```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-19T23:16:49.690

除了语法问题之外，使用数组和链表来表示矩阵对我来说似乎很奇怪。为了能够访问矩阵的任意单元，您可能需要一个实际的数组或至少一个`ArrayList`来保存行，因为`LinkedList`必须遍历从第一个元素到任何特定元素的整个列表，一个`O(n)`操作，而不是很多`O(1)`使用`ArrayList`或实际数组更快。

但是，由于您提到此矩阵是稀疏的，因此存储数据的更好方法可能是作为映射的映射，其中第一个映射中的键表示行索引，其值是键为列索引的行映射，值是您的 IntegerNode 类。因此：

```
private Map<Integer, Map<Integer, IntegerNode>> myMatrix = new HashMap<Integer, Map<Integer, IntegerNode>>();

// access a matrix cell:
int rowIdx = 100;
int colIdx = 30;
Map<Integer, IntegerNode> row = myMatrix.get(rowIdx); // if null, create and add to matrix
IntegerNode node = row.get(colIdx); // possibly null 
```

如果您需要能够逐行遍历矩阵，则可以将行映射类型设置为 a `TreeMap`，并且对于按索引顺序遍历列的方式相同，但如果您不需要这些情况，`HashMap`则比`TreeMap`. 当然，获取和设置任意单元格、处理未设置的空值的辅助方法会很有用。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2011-03-29T18:31:35.760

```
class IntegerNodeList extends LinkedList<IntegerNode> {}

IntegerNodeList[] myMatrix = new IntegerNodeList[numRows]; 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2010-04-01T09:01:54.407

> `myMatrix = (LinkedList<IntegerNode>[]) new LinkedList[numRows];`

以这种方式投射是有效的，但仍然会给你留下一个令人讨厌的警告：

“类型安全：类型 List[] 的表达式需要未经检查的转换..”

> 为列表数组声明一个特殊类：
> 
> `class IntegerNodeList { private final List< IntegerNode > nodes; }`

避免警告是一个聪明的主意。也许更好一点的是为它使用一个接口：

```
public interface IntegerNodeList extends List<IntegerNode> {} 
```

然后

```
List<IntegerNode>[] myMatrix = new IntegerNodeList[numRows]; 
```

编译没有警告。

看起来还不错，是吗？

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-19T22:51:49.817

Java 1.5（或据我所知是 1.6）中没有通用数组创建。请参阅[https://community.oracle.com/message/4829402](https://community.oracle.com/message/4829402)。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2011-04-30T18:17:05.800

```
List<String>[] lst = new List[2];
lst[0] = new LinkedList<String>();
lst[1] = new LinkedList<String>(); 
```

没有任何警告。NetBeans 6.9.1，jdk1.6.0_24

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2012-10-04T18:55:50.937

如果我执行以下操作，我会收到相关的错误消息

```
LinkedList<Node>[] matrix = new LinkedList<Node>[5]; 
```

但是，如果我只是删除声明中的列表类型，它似乎具有所需的功能。

```
LinkedList<Node>[] matrix = new LinkedList[5]; 
```

这两个声明是否以我不知道的方式截然不同？

**编辑**

啊，我想我现在遇到了这个问题。

遍历矩阵并在 for 循环中初始化列表似乎有效。尽管它不如其他一些解决方案那么理想。

```
for(int i=0; i < matrix.length; i++){

    matrix[i] = new LinkedList<>();
} 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2013-02-10T11:54:04.873

您需要一个列表数组，另一种方法是尝试：

```
private IntegerNode[] node_array = new IntegerNode[sizeOfYourChoice]; 
```

然后存储 a or`node_array[i]`的头（第一个）节点（无论您最喜欢的列表实现）。 `ArrayList<IntegerNode>``LinkedList<IntegerNode>`

在这种设计下，您失去了随机访问方法`list.get(index)`，但是您仍然可以从类型安全数组中的头/拳节点存储开始遍历列表。

根据您的用例，这可能是一个可接受的设计选择。例如，我使用这种设计来表示图的邻接列表，在大多数用例中，它需要遍历给定顶点的邻接列表，而不是随机访问列表中的某些顶点。

# asp.net - Response.Redirect 导致 IsPostBack 为真

> ID：217067
> 
> 赞同：5
> 
> 时间：2008-10-19T22:29:25.930
> 
> 标签：asp.net

我在 ASP.Net 页面上有一个按钮，它将在执行一些处理后调用 Response.Redirect 回到同一页面，以便重新显示查询结果。但是，由于某种原因，页面出现空白。似乎 IsPostBack 在重定向后返回 true。有人知道为什么会发生这种情况吗？

该页面是社区服务器中的自定义页面。这是基本代码：

```
void Page_Load(object sender, EventArgs e)
{
    if (!IsPostBack)
    {
        string connStr = ConfigurationManager.ConnectionStrings["SiteSqlServer"].ConnectionString;
        SqlDataAdapter da = new SqlDataAdapter("SELECT * FROM ge_vw_NonResidents", connStr);
        DataTable tbl = new DataTable();
        da.Fill(tbl);
        da.Dispose();
        rptNonResidents.DataSource = tbl;
        rptNonResidents.DataBind();
    }
}

void btnApprove_Command(object sender, CommandEventArgs e)
{
    // Code removed for testing.

    Response.Clear();
    Response.Redirect("ApproveResidents.aspx", true);
    Response.End();
} 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-19T23:08:57.723

Response.Redirect 将触发来自浏览器的 HTTP *GET 。*由于未发布任何数据，因此 IsPostBack 为 false。你有其他事情发生。

我建议启动[Fiddler](http://www.fiddlertool.com/)并查看请求的顺序。它应该看起来像：

*   客户端：HTTP POST（按钮单击）
*   服务器：HTTP 302（重定向）
*   客户端：HTTP GET
*   服务器：HTTP 200（写入页面）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-20T01:02:36.900

我建议这是比尝试从浏览器重定向更好的解决方案。

```
protected void Page_Load( object sender, EventArgs e )
{
   if (!IsPosBack) {
      BuildData();
   }
}

void btnApprove_Command(object sender, CommandEventArgs e)
{
    // do your stuff and clear any some controls, maybe

    BuildData();
}

private void BuildData()
{
   string connStr = ConfigurationManager.ConnectionStrings["SiteSqlServer"].ConnectionString;
   SqlDataAdapter da = new SqlDataAdapter("SELECT * FROM ge_vw_NonResidents", connStr);
   DataTable tbl = new DataTable();
   da.Fill(tbl);
   da.Dispose();
   rptNonResidents.DataSource = tbl;
   rptNonResidents.DataBind();
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-20T06:01:36.393

抱歉，这是一个 id-10-t 错误。我的事件处理程序根本没有被调用。该页面具有 EnableViewState="false"。一旦我将其更改为true，它就起作用了。

我也接受了 tvanfosson 的建议。这允许我显示确认消息。我可以很容易地检查是否已经采取了行动并安全地忽略它。因为我可能是唯一一个见过这个屏幕的人，所以我不太关心可用性。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-11-10T09:46:49.920

该页面已发回，这就是您将其视为真实的原因。确保它是假的。

# java - 如何将查询参数添加到 GetMethod（使用 Java commons-httpclient）？

> ID：217070
> 
> 赞同：33
> 
> 时间：2008-10-19T22:31:22.103
> 
> 标签：java, httpclient, getmethod

使用 Apache 的 commons-httpclient for Java，将查询参数添加到 GetMethod 实例的最佳方法是什么？如果我使用 PostMethod，它非常简单：

```
PostMethod method = new PostMethod();
method.addParameter("key", "value"); 
```

不过，GetMethod 没有“addParameter”方法。我发现这有效：

```
GetMethod method = new GetMethod("http://www.example.com/page");
method.setQueryString(new NameValuePair[] {
    new NameValuePair("key", "value")
}); 
```

但是，我见过的大多数示例要么将参数直接硬编码到 URL 中，例如：

```
GetMethod method = new GetMethod("http://www.example.com/page?key=value"); 
```

或硬编码查询字符串，例如：

```
GetMethod method = new GetMethod("http://www.example.com/page");
method.setQueryString("?key=value"); 
```

这些模式之一是首选吗？为什么 PostMethod 和 GetMethod 之间的 API 存在差异？所有其他 HttpMethodParams 方法打算用于什么？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-10-19T22:49:23.973

Post 方法有 post 参数，但[get 方法没有](http://www.cs.tut.fi/~jkorpela/forms/methods.html)。

查询参数嵌入在 URL 中。当前版本的 HttpClient 在构造函数中接受一个字符串。如果你想添加上面的键值对，你可以使用：

```
String url = "http://www.example.com/page?key=value";
GetMethod method = new GetMethod(url); 
```

可以在[Apache Jakarta Commons 页面](http://hc.apache.org/httpclient-3.x/tutorial.html)上找到一个很好的入门教程。

**更新**：正如评论中所建议的，NameValuePair 有效。

```
GetMethod method = new GetMethod("example.com/page"); 
method.setQueryString(new NameValuePair[] { 
    new NameValuePair("key", "value") 
}); 
```

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2010-08-09T19:08:09.193

这不仅仅是个人喜好问题。这里的相关问题是对参数值进行 URL 编码，以便这些值不会被损坏或被误解为额外的分隔符等。

与往常一样，最好详细阅读 API 文档： [HttpClient API 文档](http://hc.apache.org/httpclient-3.x/apidocs/org/apache/commons/httpclient/HttpMethodBase.html#setQueryString(org.apache.commons.httpclient.NameValuePair[]))

阅读本文，您可以看到它`setQueryString(String)`不会对您的参数和值进行 URL 编码或分隔，而`setQueryString(NameValuePair[])`会自动对您的参数名称和值进行 URL 编码和分隔。当您使用动态数据时，这是最好的方法，因为它可能包含与号、等号等。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2012-10-23T15:10:04.833

试试这种方式：

```
 URIBuilder builder = new URIBuilder("https://graph.facebook.com/oauth/access_token")
            .addParameter("client_id", application.getKey())
            .addParameter("client_secret", application.getSecret())
            .addParameter("redirect_uri", callbackURL)
            .addParameter("code", code);

    HttpPost method = new HttpPost(builder.build()); 
```

# c++ - std::list 的部分排序

> ID：217073
> 
> 赞同：7
> 
> 时间：2008-10-19T22:33:52.817
> 
> 标签：c++, stl

我有一个链接列表，我想对其进行排序，例如：

```
std::sort(someIterator, otherIterator, predicate); 
```

std::sort 需要随机访问迭代器，因此这种方法不起作用。有一个专门化的 std::list::sort，但它只能对整个列表进行排序。我认为我没有足够的权限访问列表成员来自己写一些东西。

有没有办法做到这一点而不改变，比如说，矢量？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-10-19T23:37:51.690

如何将您想要排序的列表部分解绑到一个独立列表中，然后使用专门的列表排序，然后将其重新连接到原始列表中？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-19T22:40:09.060

是的，但您必须使用[合并排序](http://en.literateprograms.org/Merge_sort_(C_Plus_Plus))。

# c - 在 C 中使用 scanf 解析输入

> ID：217074
> 
> 赞同：10
> 
> 时间：2008-10-19T22:35:20.803
> 
> 标签：c, scanf

我一直在试图弄清楚如何使用`scanf()`. 它似乎适用于整数，相当简单`scanf("%d", &i)`。

我遇到问题的地方是`scanf()`在尝试读取输入的循环中使用。例如：

```
do {
  printf("counter: %d: ", counter);
  scanf("%c %c%d", &command, &prefix, &input);
} while (command != 'q'); 
```

1.  当我输入一个有效结构的输入`c P101`时，它似乎在提示我之前再次循环。即使只有一个，这似乎也会发生：

    ```
    scanf("%c", &c) 
    ```

    在一个while循环中。在再次提示我之前，它会循环两次。是什么让它循环两次，我该如何阻止它？

2.  当我输入的输入量较少而以编程方式没有其他字符或数字时`q`，按 Enter 似乎提示我输入更多。如何`scanf()`处理单字符和双字符条目？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-10-19T22:59:58.210

当您输入“ `c P101`”时，程序实际上会收到“ `c P101\n`”。大多数转换说明符会跳过包括换行符在内的前导空格，但`%c`不会。第一次围绕所有内容直到 " `\n`" 被读取，第二次围绕 "\n" 被读入`command`， " `c`" 被读入`prefix`，并且 " `P`" 剩下的不是数字，因此转换失败并且 " `P101\n`" 是留在溪流上。下一次将“ `P`”存储到命令中，“ `1`”存储到前缀中，并且`1`（从剩余的“ `01`”）存储到输入中，“ `\n`”仍然在流中以供下次使用。

第二种情况发生了类似的事情，当您输入“ `q`”时，“ `q\n`”被输入到流中，第一次读取“ `q`”周围，第二次`\n`读取“”，仅在第三次调用时第二个“ `q`”读取，您可以通过在格式字符串的开头添加一个空格字符来再次避免该问题。

更好的方法是使用 fgets() 之类的东西一次处理一行，然后使用 sscanf() 进行解析。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-19T22:40:38.763

对于问题 1，我怀疑您的 有问题`printf()`，因为没有终止“\n”。

的默认行为`printf`是缓冲输出，直到它有一个完整的行。除非您明确更改`stdout`.

对于问题 2，您刚刚遇到了`scanf()`. 除非您的输入与您指定的扫描字符串完全匹配，否则您的结果将与您期望的完全不同。

如果您有一个选项，您将通过忽略`scanf()`并进行自己的解析获得更好的结果（以及更少的安全问题）。例如，用于`fgets()`将整行读入字符串，然后处理字符串的各个字段——甚至可能使用`sscanf()`.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-19T23:01:08.487

真的坏了！我不知道

```
#include <stdio.h>

int main(void)
{
    int counter = 1;
    char command, prefix;
    int input;

    do 
    {
        printf("counter: %d: ", counter);
        scanf("%c %c%d", &command, &prefix, &input);
        printf("---%c %c%d---\n", command, prefix, input);
        counter++;
    } while (command != 'q');
} 
```

```
counter: 1: a b1
---a b1---
counter: 2: c d2
---
 c1---
counter: 3: e f3
---d 21---
counter: 4: ---e f3---
counter: 5: g h4
---
 g3--- 
```

输出似乎符合罗伯特的回答。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-19T23:14:28.087

一旦你有了包含该行的字符串。即“C P101”，可以使用sscanf的解析能力。

见： [http ://www.cplusplus.com/reference/clibrary/cstdio/sscanf.html](http://www.cplusplus.com/reference/clibrary/cstdio/sscanf.html)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-11-20T11:00:39.890

也许使用 while 循环而不是 do...while 循环会有所帮助。这样，在执行代码之前会测试条件。试试下面的代码片段：

```
 while(command != 'q')
    {
        //statements
    } 
```

此外，如果您提前知道字符串长度，则“for”循环比“while”循环更容易使用。还有一些更棘手的方法来动态确定长度。

作为最后的咆哮：`scanf()`不“烂”。它做它所做的，仅此而已。

该[`gets()`函数非常危险](https://stackoverflow.com/questions/1694036/why-is-the-gets-function-dangerous-why-should-it-not-be-used)（尽管对无风险应用程序很方便），因为它本身并不对输入进行任何检查。它通常被称为漏洞利用点，特别是缓冲区溢出攻击，覆盖未分配给该变量的寄存器中的空间。因此，如果您选择使用它，请花一些时间进行一些可靠的错误检查/纠正。

但是，几乎总是应该使用[`fgets()`](http://pubs.opengroup.org/onlinepubs/9699919799/functions/fgets.html)POSIX 或 POSIX来读取该行——注意这两个函数都在输入字符串中包含换行符，这与. 您可以从read by或using中删除尾随换行符——这很可靠。[`getline()`](http://pubs.opengroup.org/onlinepubs/9699919799/functions/getline.html)`gets()``string``fgets()``getline()``string[strcspn(string, "\n")] = '\0';`

# unicode - 寻找 UTF-8 文本编辑器

> ID：217089
> 
> 赞同：5
> 
> 时间：2008-10-19T22:43:17.540
> 
> 标签：unicode, utf-8, character-encoding, text-editor

我正在寻找一个（简单的）文本编辑器，它可以处理同一文档中不同编码的文本。

我需要开发一些日文和英文混合文本的网站，而我现在拥有的编辑器（在英文 Windows 系统上）无法显示日文文本。Jedit 文件不显示我输入的日语文本，但是当我在浏览器中查看该文件时，它会正确显示。Gvim 将编辑器中的所有日文文本显示为问号，也在浏览器中显示。在 Gvim 中输入汉字的工作（你输入发音，然后按空格键来获取汉字）但是当你确认你想要的汉字时，它会用问号替换那个汉字。（每个汉字1个问号）。

有人可以推荐我一个文本编辑器来编辑能够显示 utf-8 编码文本并保存为 utf-8 文件的 html 和 php 文件吗？

谢谢你。

在阅读了有关 emacs 的信息后，我安装了它。见下文。

谢谢大家的提示。如果您还没有 unicode 字体，则必须在网上找到一种或购买一种。这是在 Windows 系统上安装字体的说明[http://support.microsoft.com/kb/314960](http://support.microsoft.com/kb/314960)

jEdit 我将 Jedit 中的字体更改为 UTF 字体，现在日文显示正常。输入日语仍然有问题，因为您看不到您在输入什么。（要更改字体以编辑文件，请转到实用程序 -> 全局选项 -> 文本区域选择 Unicode 字体，您将能够看到日文字符。

gVim 我仍在试图弄清楚如何在 gvim 中添加字体。一旦我知道该怎么做，我会更新这个。

Emacs Emacs 不能正确显示汉字，它们显示为 ??? 但至少我可以看到我用日语输入的内容并选择正确的单词。

所以此时我不得不说，在 jEdit 中我可以看到日文文本，但我无法输入日文文本。Gvim 我可以输入日文文本，但在文本区域内显示为 ??? Emacs 也是如此。遗憾的是，在 emacs 和 gvim 中添加字体并非易事。目前，我使用带有 Arial unicode MS 字体的记事本并保存为 UTF-8 文件作为我的日语编辑器。不理想，但至少它有效。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-10-19T22:49:49.867

强烈推荐记事本++。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-19T22:48:36.813

Emacs 为我正确处理 UTF-8。（当然，它可以编辑 HTML 和 PHP 文件）。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-10-19T22:49:10.463

我仍然会推荐 Vim。您看到的问号问题可能是您使用的字体的问题。当显示包含当前语言中没有的字符的文本时，应用程序通常将它们显示为空框或问号。有关Vim中的[UTF-8](http://vimdoc.sourceforge.net/htmldoc/mbyte.html#UTF-8)支持，请参见此处。

[Vim 手册的这一部分](http://vimdoc.sourceforge.net/htmldoc/usr_45.html#45.3)也很有帮助，特别是对于在 Windows 中设置 UTF-8。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-10-20T00:35:20.247

大多数支持 Unicode 的文本编辑器都存在一个问题：当您选择一种字体时，它们会坚持使用它。如果字体不包含字符的字形，则使用默认替换字符（我相信 U+FFFD，REPLACEMENT CHARACTER）。

相比之下，Web 浏览器通常会尝试在系统提供的所有字体中找到它们必须显示的字符的字形。

因此，如果您没有“Arial Unicode MS”字体或类似字体（包括日文字形），您需要的是一个编辑器，它会尝试将字形与除所选字体之外的其他字体进行匹配。

在有人为这样的编辑器提供链接之前，我会建议一个（有点极端:) 编辑器：

*   [为 MS Windows](http://www.python.org/ftp/python/2.6/python-2.6.msi)安装最新的稳定 python 2.x 版本（当前为 2.6）。
*   在安装中包含“空闲”。
*   开始 → 程序 → Python 2,6 → 空闲 (Python Gui)

“空闲”编辑器通常用于编辑 python 代码（并在 Python shell 中交互地测试它）。但是，它可以用作纯 Unicode 感知的文本编辑器，并且在保存包含非 ASCII 字符的文本时，它默认为 UTF-8 编码。

现在，idle 基于 Tkinter，它是 tk 的接口，tk 是 tcl 的 gui 库；tcl/tk 与 Web 浏览器一样，当被要求显示小部件字体中不存在字形的字符时，它也会搜索其他字体。

不管这看起来多么牵强，我真的相信它会有所帮助；如果没有其他解决方案可以帮助您，请尝试一下。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2010-09-21T01:47:59.840

[Vim](http://www.vim.org/)作为 UTF-8 文本编辑器对我来说很好用。

首先，**您需要一种具有您正在使用的字符的字体**。选择另一个文本编辑器对您没有帮助（除非当您使用的字体没有其他字体时，它会搜索其他字体以获取正确的字符）。如果你使用 gVim，你可以设置如下字体：

```
set guifont=Consolas 
```

（这并不是说 Consolas 是您想要的字体。）您可能希望将其放在`.vimrc`文件中以便始终使用它。

其次，**Vim 需要将文件解释为 UTF-8**，它并不总是自动这样做。为此，请执行以下操作：

```
set encoding=utf8 
```

您还可以查看它使用的编码：

```
set encoding? 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-10-19T23:12:22.240

EmEditor 正是由一家日本公司为此目的而编写的。它是一款出色的文本编辑器，具有良好的性能/简单性，但几乎具备强大编辑器所期望的所有功能；我在 Windows 平台上使用它作为我的默认设置，以及编辑日语网页模板。它值得成为更知名的 IMO；它至少和 TextPad 一样好，但完全支持 Unicode。

不幸的是，它不是免费的，但是您可以在 download.com 等网站上找到旧版 EmEditor 6 的免费版本。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-10-19T22:48:58.963

您可以只使用带有“Arial Unicode MS”字体的 Notepad.exe（如果您的所有文本都是从左到右的，给定英文 Windows 版本）。只需另存为，选择 UTF-8。

通常，使用您最喜欢的编辑器和“Arial Unicode MS”之类的字体。我提到这个是因为它是我见过的 Unicode 覆盖率最高的字体，

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-10-19T23:12:17.217

试试[BabelPad](http://www.babelstone.co.uk/Software/BabelPad.html)。编辑方面，很简单。Unicode 支持方面，太棒了！

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-01-16T02:40:41.383

I've never had a problem with vim as long as I use a font that actually contains the characters I want. It needs to be a monospace font. :set enc=utf8 to get to utf8 mode. Then you can use :digraph command to get a display of available characters, and see how each is displayed.

To add a font, add it in Windows (Control Panel/Fonts/Add Font). If it's a monospace font, it will then show up in vin in /Edit/Font.

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-10-19T22:48:42.833

听起来 Jedit 的问题可能出在字体上——您使用的字体是否可以正确显示所有字符？

更准确地说，Arial Unicode MS 是一种 Unicode 字体的合理选择，它可以显示各种语言范围内的各种字符。它存在某些问题，可能使其对于某些单独使用的语言来说不是最佳选择 - 这就是为什么 Windows 中还包含特定于语言的 Unicode 字体的原因。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-07-13T09:05:10.310

只是添加另一个：我刚刚检查了 Programmer's Notepad 2 也有一些 UTF-8 设置。

（vim 和 emacs 也可以）

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-11-10T09:15:22.613

[EditPad Lite 和 Pro](http://www.editpadpro.com "编辑板")从版本 6 开始完全支持 Unicode。（**免责声明**：这些是我自己的产品。）

如果出现问号，则说明您使用的编码不支持日文字符。在 EditPad 中，您可以通过 Convert、Text Encoding 更改文本编码（Unicode、遗留代码页）。您可以在选项、配置文件类型、编码中设置每种文件类型的默认值。

如果您看到的是正方形而不是日文字符，请选择日文字体或 Unicode 字体。您可以通过选项、字体在 EditPad 中执行此操作。

要键入日语，只需在 Windows 控制面板的键盘设置中安装日语键盘驱动程序（如果尚未安装）。

EditPad Pro 为 PHP 和 HTML 预先配置了文件类型。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2010-09-21T02:06:57.540

[EditPlus](http://www.editplus.com/)似乎是`UTF-8`我使用它的更好选择。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-07-13T09:18:13.200

我喜欢[jEdit](http://jedit.org/)因为它能够识别换行。编辑 XML 文件时非常好。不过要提醒一句：它是 Java，所以它的速度并不快，就像您期望的文本编辑器那样。

完全支持文本编解码器。它区分带有和不带有标识文件格式（[字节顺序标记](http://en.wikipedia.org/wiki/UTF-8#Byte-order_mark)）的标头的文本文件，将它们称为 UTF-8 和 UTF-8Y。这是我在其他文本编辑器中缺少的东西。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-03-22T20:56:20.673

对于非常基本的 UTF-8 多语言文本编辑，我对 BabelPad (www.babelstone.co.uk) 很满意：它免费、简单且功能强大，几乎可以毫不费力地显示所有内容。当编辑需要更严格时，我会使用 EditPad Pro，或者偶尔使用 Notepad++。对于 Windows 上的非 Unicode 编辑，我是 TextPad 用户——我的员工和我可能在 TextPad 上花费了大约 200,000 小时，只是偶尔尝试使用 NotePad2、MadEdit、jEdit、XML Copy Editor 和 EPCedit。后两者可以很好地处理 UTF-8 XML 文件。上面提到的所有编辑器都是免费的，除了 TextPad 和 EditPad Pro。感谢推荐Emeditor的人。我会尝试一下。——PFSchaffner

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-11-10T09:38:32.003

试试 SciTE [http://gisdeveloper.tripod.com/scite.html](http://gisdeveloper.tripod.com/scite.html)。这太棒了；）

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2013-11-20T06:28:09.220

For japanese, [Sakura Editor](http://sakura-editor.sourceforge.net/) is exceptional. It can display UTF-8, EUC-JP, SJIS and so on.

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2009-07-13T09:24:51.267

试试 EditPlus。它具有对 HTML、语法高亮的特定支持，也可以作为任何编译器的简单 IDE。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2008-10-20T01:18:39.070

凯特。通过扩展，任何其他使用 Kate 作为嵌入式 KPart 的 KDE 程序（KWrite、Quanta+、KDevelop）。它处理很多编码，但我喜欢总是使用 UTF-8。它还有大量的语法高亮。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2009-07-15T06:13:19.223

在 Mac 上：[SubEthaEdit](http://www.codingmonkeys.de/subethaedit/)对字符编码有很好的支持。

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2012-12-27T14:29:16.323

[TextPad](http://www.textpad.com/)也是一个很好的实用程序。这是一个试用软件，但工作正常。查看如何设置[char-encoding-setting-in-textpad](http://randomtechnotes.blogspot.com/2007/01/char-encoding-setting-in-textpad.html)。

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2015-10-21T17:08:41.777

[http://www.ultraedit.com/](http://www.ultraedit.com/)是一个多平台编辑器，可以进行 UTF-8 和各种格式之间的转换

* * *

## 回答 #23

> 赞同：-1
> 
> 时间：2009-03-07T16:36:01.050

EditPad Pro ...推荐给你

欢呼；）

# .net - ASP.NET MVC 和 WCF

> ID：217111
> 
> 赞同：27
> 
> 时间：2008-10-19T22:53:37.740
> 
> 标签：.net, asp.net-mvc, wcf

我目前正在努力进入 MVC，但在我的“在某个时候学习”列表中，我也有 WCF。

我只是想知道 WCF 是否应该/可以在 MVC 应用程序中使用？背景是我想要一个桌面应用程序（.NET 3.5，WPF）与我的 MVC 网站交互，我想知道在两者之间传输数据的最佳方式是什么。我应该只使用特殊视图/让控制器返回 JSON 或 XML（使用 ContentResult）吗？

也许更重要的是，反过来说，我可以只调用特殊控制器吗？不确定授权在这种情况下如何工作。我可以使用 Windows 身份验证，或者（如果站点正在运行表单身份验证）让用户将他/她的凭据存储在应用程序中，但我基本上会在我的应用程序中创建一个 HTTP 客户端。因此，虽然 MVC => Application 看起来真的很简单，但 Application => MVC 似乎有点棘手并且可能用于 WCF？

我不是在尝试暴力破解 WCF，但我只是想知道在 MVC 应用程序中是否确实存在 WCF 的一个很好的用例。

* * *

## 回答 #1

> 赞同：47
> 
> 时间：2008-10-20T13:18:36.243

WCF 服务在这种情况下可能有意义，但不要创建与您的 UI 一致的服务，而是创建与业务流程一致的服务。IE。您不会有一个返回每个页面的视图数据的服务，您将有一个公开逻辑操作的服务。然后，您的站点可以调用 windows 客户端调用的相同服务，但您不必将 windows 客户端的设计与网站的设计结合起来。

而不是这个：

Windows 客户端 -> 服务 -> 网站

它应该是：

Windows 客户端 -> 服务

网站 -> 服务

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-10-19T23:29:47.307

您可以使用 ADO.NET 数据服务与 JSON（用于 JavaScript 客户端）或 XML（用于桌面应用程序）共享数据。

然后，ASP.NET MVC 可以通过在模型中使用两者中的任何一个来利用这一点。您可能知道，ADO.NET 数据服务基于 WCF，因此您走在了正确的轨道上。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-07-16T17:51:26.473

我使用 asp.net mvc 作为我的 html 网站（默认视图引擎）和我的服务端点。我的 WPF 和 Silverlight 客户端通过将“content-type=text/xml”注入 WebClient 请求的标头来使用服务端点（请参阅 ScottGu 关于在 SL 中使用服务的[帖子](http://weblogs.asp.net/scottgu/pages/silverlight-tutorial-part-3-using-networking-to-retrieve-data-and-populate-a-datagrid.aspx)，它启发了这种方法）。我在网上的某个地方找到了一些覆盖 OnActionExecuted 事件的代码，如下所示：

```
public class JsonOrXml : ActionFilterAttribute
{
    private static UTF8Encoding UTF8 = new UTF8Encoding(false);

    public override void OnActionExecuted(ActionExecutedContext filterContext)
    {
        // setup the request, view and data
        HttpRequestBase request = filterContext.RequestContext.HttpContext.Request;
        ViewResult view = (ViewResult)(filterContext.Result);
        var data = view.ViewData.Model;

        String contentType = request.ContentType ?? string.Empty;

        // JSON
        if (contentType.Contains("application/json") || (string)view.ViewData["FORMAT"] == "json")
        {
            filterContext.Result = new JsonResult
            {
                Data = data
            };
        }

        // POX
        else if (contentType.Contains("text/xml") || (string)view.ViewData["FORMAT"] == "xml")
        {
            // MemoryStream to encapsulate as UTF-8 (default UTF-16)
            // http://stackoverflow.com/questions/427725/
            //
            // MemoryStream also used for atomicity but not here
            // http://stackoverflow.com/questions/486843/
            //using (MemoryStream stream = new MemoryStream(500))
            //{
            //    using (var xmlWriter =
            //        XmlTextWriter.Create(stream,
            //            new XmlWriterSettings()
            //            {
            //                OmitXmlDeclaration = false,
            //                Encoding = UTF8,
            //                Indent = true
            //            }))
            //    {
            //        new XmlSerializer(data.GetType()).Serialize(xmlWriter, data);
            //    }

            //    filterContext.Result = new ContentResult
            //    {
            //        ContentType = "text/xml",
            //        Content = UTF8.GetString(stream.ToArray()),
            //        ContentEncoding = UTF8
            //    };
            //}

            XmlDeclaration xmlDecl = new XmlDocument().CreateXmlDeclaration("1.0", "UTF-8", "yes");

            filterContext.Result = new ContentResult
            {                    
                ContentType = "text/xml",
                Content = xmlDecl.OuterXml + data.ToString(),
                ContentEncoding = UTF8
            };
        }
    }
} 
```

因此，注释掉的部分是我找到的代码 - 请参阅 stackoverflow 链接了解我在哪里得到它:)

我覆盖了所有业务对象上的 ToString() 方法，以返回表示业务对象希望如何将自身表示为 xml 的字符串。WCF 通过属性实现了这一点，但我想要一个不依赖反射的更清洁的解决方案，而且我不想同时拥有一个网站项目和一个 WCF 项目——两个项目的问题是很难同时保留它们在功能方面同步 - 我会收到诸如“为什么该服务不允许我像网站那样过滤我的结果？”这样的请求。

我对其他人对此方法的反馈非常感兴趣:)

这是一个业务对象的示例：

```
public class ContentFile : Entity
{
    public ContentBook BelongsToBook { get; set; }
    public string FileName { get; set; }
    public XElement FileXml { get; set; }
    public Binary FileData { get; set; }
    public List<ContentFile> Versions { get; set; }
    public List<ContentNode> ContentNodes { get; set; }

    public override string ToString()
    {
        return this.ToString(SaveOptions.DisableFormatting);
    }

    public string ToString(SaveOptions options)
    {
        XElement xml = XElement.Parse("<contentFile id=\"" + Id.ToString() + "" + "\" />");
        xml.Add(new XElement("fileName", FileName));
        xml.Add(new XElement("fileStructure", FileXml));
        xml.Add(base.ToString(options));
        return xml.ToString(options);
    }
} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-04-01T03:19:29.290

您可以为您的 MVC 应用程序使用[OData](http://www.odata.org/)来处理 Xml/Json 类型的内容。我知道其他人建议你自己动手——这就是我目前正在做的事情……通过使用我自己的自定义 ActionFilter 或自定义 ViewResult。

OData 代码示例：[Scott Hanselman 的 OData + StackOverflow 博客文章](http://www.hanselman.com/blog/CreatingAnODataAPIForStackOverflowIncludingXMLAndJSONIn30Minutes.aspx)。

# java - Java中的死锁检测

> ID：217113
> 
> 赞同：63
> 
> 时间：2008-10-19T22:54:21.137
> 
> 标签：java, multithreading, deadlock

很久以前，我从一本Java参考书中保存了一句话：*“Java没有处理死锁的机制，它甚至不知道发生了死锁。” （Head First Java 第 2 版，第 516 页）*

那么，它是怎么回事呢？有没有办法在 Java 中捕获死锁情况？我的意思是，有没有办法让我们的代码理解发生死锁的情况？

* * *

## 回答 #1

> 赞同：81
> 
> 时间：2008-10-20T07:11:24.723

从 JDK 1.5 开始，包中有非常有用的方法`java.lang.management`来查找和检查发生的死锁。查看类的`findMonitorDeadlockedThreads()`and`findDeadlockedThreads()`方法`ThreadMXBean`。

一种可能的使用方法是有一个单独的看门狗线程（或周期性任务）来执行此操作。

示例代码：

```
 ThreadMXBean tmx = ManagementFactory.getThreadMXBean();
  long[] ids = tmx.findDeadlockedThreads();
  if (ids != null) {
     ThreadInfo[] infos = tmx.getThreadInfo(ids, true, true);
     System.out.println("The following threads are deadlocked:");
     for (ThreadInfo ti : infos) {
        System.out.println(ti);
     }
  } 
```

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2008-10-19T23:03:13.867

[JConsole](http://java.sun.com/javase/6/docs/technotes/guides/management/jconsole.html)能够检测正在运行的应用程序中的死锁。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-10-20T03:19:30.667

JDK 5 和 6 将在完整的线程转储中转储持有的锁信息（通过 kill -3、jstack、jconsole 等获得）。JDK 6 甚至包含有关 ReentrantLock 和 ReentrantReadWriteLock 的信息。根据这些信息，可以通过查找锁循环来诊断死锁：线程 A 持有锁 1，线程 B 持有锁 2，A 请求 2 或 B 请求 1。根据我的经验，这通常很明显。

其他分析工具实际上可以发现潜在的死锁，即使它们没有发生。来自 OptimizeIt、JProbe、Coverity 等供应商的线程工具是不错的选择。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2009-11-02T13:20:16.650

请注意，使用并发包时存在一种很难调试的死锁。这就是你有一个 ReentrantReadWriteLock 并且一个线程获取读锁的地方，然后（比如说）尝试进入一个由其他线程持有的监视器，该线程也在等待获取写锁。使调试特别困难的是没有记录谁进入了读锁。这只是一个计数。线程甚至可能抛出异常并死亡，使读取计数非零。

以下是前面提到的 findDeadlockedThreads 方法无法获取的示例死锁：

```
import java.util.concurrent.locks.*;
import java.lang.management.*;

public class LockTest {

    static ReentrantReadWriteLock lock = new ReentrantReadWriteLock();

    public static void main(String[] args) throws Exception {
        Reader reader = new Reader();
        Writer writer = new Writer();
        sleep(10);
        System.out.println("finding deadlocked threads");
        ThreadMXBean tmx = ManagementFactory.getThreadMXBean();
        long[] ids = tmx.findDeadlockedThreads();
        if (ids != null) {
            ThreadInfo[] infos = tmx.getThreadInfo(ids, true, true);
            System.out.println("the following threads are deadlocked:");
            for (ThreadInfo ti : infos) {
                System.out.println(ti);
            }
        }
        System.out.println("finished finding deadlocked threads");
    }

    static void sleep(int seconds) {
        try {
            Thread.currentThread().sleep(seconds*1000);
        } catch (InterruptedException e) {}
    }

    static class Reader implements Runnable {
        Reader() {
            new Thread(this).start();
        }
        public void run() {
            sleep(2);
            System.out.println("reader thread getting lock");
            lock.readLock().lock();
            System.out.println("reader thread got lock");
            synchronized (lock) {
                System.out.println("reader thread inside monitor!");
                lock.readLock().unlock();
            }
        }
    }

    static class Writer implements Runnable {
        Writer() {
            new Thread(this).start();
        }
        public void run() {
            synchronized (lock) {
                sleep(4);
                System.out.println("writer thread getting lock");
                lock.writeLock().lock();
                System.out.println("writer thread got lock!");
            }
        }
    }
} 
```

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-10-19T23:47:31.157

一般来说，java 不提供死锁检测。与显式锁定语言相比，synchronized 关键字和内置监视器使得死锁的推理更加困难。

我建议迁移到使用 java.util.concurrent.Lock 锁等，以使您的锁定方案更易于推理。事实上，您可以轻松地使用死锁检测来实现自己的锁接口。算法基本就是遍历锁依赖图，寻找一个循环。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-10-20T05:06:13.570

如果您遵循一个简单的规则，就可以避免死锁：让所有线程以相同的顺序声明和释放它们的锁。这样，您永远不会陷入可能发生死锁的情况。

即使是哲学家进餐问题也可以被视为违反了这一规则，因为它使用了左右勺子的相对概念，导致不同的线程使用勺子的不同分配顺序。如果勺子的编号是唯一的，而哲学家们都试图首先得到编号最小的勺子，那么僵局就不可能发生。

在我看来，预防胜于治疗。

这是我喜欢遵循的两个准则之一，以确保线程正常工作。另一个是确保每个线程**单独**负责自己的执行，因为它是唯一一个完全知道自己在任何时间点正在做什么的线程。

所以这意味着没有`Thread.stop`调用，使用全局标志（或消息队列或类似的东西）告诉另一个线程你想要采取行动。然后让那个线程做实际的工作。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2011-12-08T20:56:48.160

Java 可以检测死锁（虽然不是在运行时，但它仍然可以诊断和报告它）。

例如，当使用稍微修改版本的“Saurabh M. Chande”代码时（将其更改为 Java 并添加了一些时间以保证每次运行时锁定）。一旦你运行它并且它死锁，如果你输入：

```
kill -3 PID   # where 'PID' is the Linux process ID 
```

它将生成一个堆栈转储，其中将包含以下信息：

```
Found one Java-level deadlock:
=============================
"Thread-0":
     waiting to lock monitor 0x08081670 (object 0x7f61ddb8, a Deadlock$A),
     which is held by "main"
"main":
      waiting to lock monitor 0x080809f0 (object 0x7f61f3b0, a Deadlock$B),
      which is held by "Thread-0" 
```

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2008-10-20T07:03:28.763

如果您使用的是 Java 5，则可以调用`findMonitorDeadlockedThreads()`ThreadMXBean 上的方法，您可以通过调用`java.lang.management.ManagementFactory.getThreadMXBean()`. 这将仅发现由对象监视器引起的死锁。在 Java 6 上`findDeadlockedThreads()`，还会发现由“可拥有的同步器（例如`ReentrandLock`和`ReentrantReadWriteLock`）引起的死锁。

请注意，调用这些方法可能会很昂贵，因此它们应仅用于故障排除目的。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-10-20T03:26:05.053

JavaSpecialists 的 Heinz Kabutz 博士撰写了[一篇关于 Java 死锁的有趣且内容丰富的时事通讯，并在](http://www.javaspecialists.eu/archive/Issue160.html)[另一时事通讯](http://www.javaspecialists.eu/archive/Issue130.html)中描述了称为 ThreadMXBean 的东西。在这些之间，您应该对这些问题有一个很好的了解，并了解一些关于自己进行检测的指示。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2008-10-19T23:04:17.687

不完全是您所要求的，但是当*确实*发生死锁时，您可以对进程 ID 执行“kill -3”，并将线程转储转储到标准输出。此外，1.6 jvm 有一些工具可以以 gui 方式做同样的事情。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2008-10-19T23:09:56.363

如果您从命令行运行并且您怀疑自己已死锁，请尝试在 Windows 中按 ctrl+break（在 unix 中为 ctrl+\）以获取线程转储。见[http://java.sun.com/javase/6/webnotes/trouble/TSG-VM/html/gbmps.html](http://java.sun.com/javase/6/webnotes/trouble/TSG-VM/html/gbmps.html)

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2008-10-21T15:23:39.707

如果你在 Eclipse 中调试，你可以暂停应用程序（在调试视图中选择应用程序和调试工具栏上的小 || 按钮），然后它可以报告死锁。

有关示例，请参见[http://runnerwhocodes.blogspot.com/2007/10/deadlock-detection-with-eclipse.html](http://runnerwhocodes.blogspot.com/2007/10/deadlock-detection-with-eclipse.html)。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2020-06-22T16:48:47.290

`jcmd`从 Java 1.8 开始，您可以通过在终端上使用命令轻松查看您的程序是否存在死锁。

1.  在您的终端上运行`jcmd`：它列出了所有使用 Java 的程序（PID 和名称）。
2.  现在，运行`jcmd <PID> Thread.print`：这将在您的控制台上打印线程转储，并且如果您的程序有死锁，也会打印。

`jcmd`您可以使用命令列出的 更多选项来分析您的 Java 程序`jcmd <PID> help`

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2017-09-19T05:05:50.203

Java 5 引入了 ThreadMXBean——一个为线程提供各种监控方法的接口。...不同的是findDeadlockedThreads也可以检测到由所有者锁(java.util.concurrent)引起的死锁，而findMonitorDeadlockedThreads只能检测监控锁(即同步块)

或者您可以以编程方式检测它，请参阅此[https://dzone.com/articles/how-detect-java-deadlocks](https://dzone.com/articles/how-detect-java-deadlocks)

* * *

## 回答 #15

> 赞同：-1
> 
> 时间：2010-05-24T14:27:37.343

经过这么长时间，我能够写出最简单的死锁示例。欢迎评论。

```
Class A
{
  synchronized void methodA(B b)
  {
    b.last();
  }

  synchronized void last()
  {
    SOP(“ Inside A.last()”);
  }
}

Class B
{
  synchronized void methodB(A a)
  {
    a.last();
  }

  synchronized void last()
  {
    SOP(“ Inside B.last()”);
  }
}

Class Deadlock implements Runnable 
{
  A a = new A(); 
  B b = new B();

  // Constructor
  Deadlock()
  {
    Thread t = new Thread(); 
    t.start();
    a.methodA(b);
  }

  public void run()
  {
    b.methodB(a);
  }

  public static void main(String args[] )
  {
    new Deadlock();
  }
} 
```

* * *

## 回答 #16

> 赞同：-4
> 
> 时间：2011-05-08T12:35:34.877

你必须在死锁类中稍微修改一下代码

```
   死锁（）{
    Therad t = 新线程（此）；// 修改的
    t.start();
    System.out.println(); //任何延迟指令
    a.方法A(b)；
}

```

此外，上面的代码并不总是会导致死锁，只是有时会发生。

# java - 在Eclipse中调试时，我可以在返回之前找出返回值吗？

> ID：217116
> 
> 赞同：101
> 
> 时间：2008-10-19T22:57:18.137
> 
> 标签：java, eclipse, debugging, return-value

是否可以在运行该行之后并且在指令指针返回到调用函数之前查看方法的返回值？

我正在调试我无法修改的代码*（阅读：不想重新编译第三方库）*，有时它会跳转到我没有源代码的代码，或者返回表达式具有阻止我的副作用能够在“*显示”*选项卡中运行表达式。

通常返回值在复合语句中使用，因此*变量*视图永远不会显示值（因此希望在控制返回调用函数之前查看结果）。

**更新：**我不能使用表达式查看器，因为语句中有副作用。

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2009-01-20T14:00:37.113

此功能已添加到 Eclipse 版本 4.7 M2 的[Eclipse 错误 40912](https://bugs.eclipse.org/bugs/show_bug.cgi?id=40912)下。

要使用它：

*   跳过`return`语句（使用“Step Over”或“Step Return”）
*   现在变量视图中的第一行将显示 return 语句的结果，如“[statement xxx] returned:”

有关详细信息，请参阅[Eclipse Project Oxygen (4.7) M2 - New and Noteworthy](https://www.eclipse.org/eclipse/news/4.7/M2/#step-show-methodresult)。

* * *

## 回答 #2

> 赞同：35
> 
> 时间：2014-01-28T06:43:27.600

为此找到了一个非常好的捷径。选择返回值的表达式并按

```
Ctrl + Shift + D 
```

这将显示返回语句的值。这在您不能或不想仅出于调试目的进行更改的情况下非常有用。

希望这可以帮助。

注意：尚未使用第三方库对此进行测试，但它适用于我的代码。*在面向 Web 开发人员的 Eclipse Java EE IDE*上对此进行了测试。*版本：Juno Service Release 1*

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-11-19T16:18:54.307

这就是为什么我总是坚持以下模式的方法：

```
MyReturnedType foo() {
     MyReturnedType   result = null;

     // do your stuff, modify the result or not

     return result;
} 
```

我的规则：

1.  只有一个return语句，只在方法的最后（最后允许在它之后）
2.  总是有一个本地调用的结果，它保存返回的值，从默认值开始。

当然，最琐碎的吸气剂是例外的。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-12-26T11:33:12.520

这实际上是 Eclipse 中一个长期存在的错误，可以追溯到 IDE 的最初几天：[https ://bugs.eclipse.org/bugs/show_bug.cgi?id=40912](https://bugs.eclipse.org/bugs/show_bug.cgi?id=40912)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-20T03:41:04.040

我也很想知道这个问题的答案。

过去，在处理这样的 3rd 方库时，我所做的是创建一个包装类或子类，委托给父类并在包装/子类中进行调试。但这需要额外的工作。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2019-01-09T16:02:17.923

“现在，当您从方法返回时，在上层方法中，在变量视图中它会显示先前完成的调用的返回值” [1]

[1] [https://coffeeorientedprogramming.wordpress.com/2016/09/23/eclipse-see-return-value-during-debugging/](https://coffeeorientedprogramming.wordpress.com/2016/09/23/eclipse-see-return-value-during-debugging/)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-19T23:21:49.600

艰难的一个。我在 Eclipse 之外的经验是，如果您可能需要查看返回值，最好将其分配给函数中的局部变量，以便返回语句是简单的`return varname;`而不是`return(some * expression || other);`. 但是，这对您没有太大帮助，因为您说您不能（或不想）修改甚至重新编译代码。所以，我没有给你一个好的答案——也许你需要重新考虑你的要求。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-19T23:32:17.927

根据 return 语句，您可以突出显示正在返回的表达式，并且从右键菜单中，应该有类似“评估表达式”的内容（我现在没有 eclipse，但它是这样的）。它将向您显示将要返回的内容。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-20T16:51:24.337

这有点牵强，但似乎没有一个简单的方法：

您可以使用 AspectJ 对 JAR 进行检测，其中包含您感兴趣的方法的返回值。根据 Eclipse 的文档，可以像其他程序一样[调试AspectJ 程序。](http://help.eclipse.org/help33/index.jsp?topic=/org.eclipse.ajdt.doc.user/questions/usingajdt/debugging.htm)

有两个选项可以在不重新编译库的情况下编织您的类：

*   如果处理二进制 JAR 是可以接受的，则进行编译后编织；

*   加载时编织，需要在 VM 中激活编织代理。

请参阅 eclipse 文档（上面的链接）以及[AspectJ 开发环境指南](http://www.eclipse.org/aspectj/doc/released/devguide/index.html)。

# language-agnostic - 如果一个对象是可编写脚本的，这意味着什么？

> ID：217128
> 
> 赞同：1
> 
> 时间：2008-10-19T23:04:01.103
> 
> 标签：language-agnostic, object, scriptable

正是标题所说的。请注意，这与“可[下标](https://stackoverflow.com/questions/216972/in-python-what-does-it-mean-if-an-object-is-scriptable-or-not)”对象无关。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-20T02:22:16.803

这在 Python 中*没有任何意义*，因为 Enthought 的[Traits](https://svn.enthought.com/enthought/wiki/Traits)模块提供了可编写脚本的对象。

来自[Application Scripting Framework](https://svn.enthought.com/enthought/browser/AppTools/trunk/docs/source/appscripting/Introduction.rst)，其中提到：

> 可编写脚本的类型是 HasTraits 的子类型，它具有可编写脚本的方法和可编写脚本的特征。

并继续定义：

> 可编写脚本的对象是可编写脚本类型的实例。

Traits 不是标准库的一部分，但它*作为*Enthought [Python Distribution](http://www.enthought.com/products/epd.php)的一部分分发。

请不要混淆两者。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-19T23:04:12.647

可编写脚本的对象是记录对其执行的操作的对象，并且可以将它们存储为可以重放的“脚本”。

例如，请参阅：[应用程序脚本框架](https://svn.enthought.com/enthought/browser/AppTools/trunk/docs/source/appscripting/Introduction.rst)

# vba - 控制表格的大小

> ID：217132
> 
> 赞同：1
> 
> 时间：2008-10-19T23:05:59.133
> 
> 标签：vba, ms-access

所以我有一个 Access 应用程序，我希望某些表单在打开时最大化，而其他表单在打开时为中等大小。但是，如果我尝试这样的事情：

```
Private Sub Form_Activate()
  DoCmd.Maximize
End Sub 
```

或者

```
Private Sub Form_Activate()
  DoCmd.Restore
End Sub 
```

它具有最大化或恢复每个打开的窗口的效果，这不是我想要的。

有没有办法解决？

我正在使用 Access 2003。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-19T23:12:17.107

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-20T08:23:53.267

[ΤΖΩΤΖΙΟΥ](https://stackoverflow.com/questions/217132/controlling-size-of-forms-in-access#217137) is 100% right when saying that either all are maximised, or none. If you really want to manage this issue, you'll have to read a little bit [**here**](http://www.utteraccess.com/forums/printthread.php?Cat=&Board=84&main=642287&type=thread) (look at the code proposed and the way to call it), understand what is done, and eventually build your own solution depending on your needs.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-19T23:16:20.330

You can use MoveSize:

```
DoCmd.MoveSize 100,100 
```

Further information: [http://msdn.microsoft.com/en-us/library/aa141514(office.10).aspx](http://msdn.microsoft.com/en-us/library/aa141514(office.10).aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-20T13:10:59.117

There are a couple of options here: [http://www.jamiessoftware.tk/articles/resolution.html](http://www.jamiessoftware.tk/articles/resolution.html)

I used ADHResize in the past and it got the job done.

# c++ - C++ STL：容器重新创建还是清除后重用？

> ID：217149
> 
> 赞同：6
> 
> 时间：2008-10-19T23:18:59.810
> 
> 标签：c++, stl, complexity-theory

在编程中，我们面临需要使用中间 STL 容器的各种情况，如下例所示：

```
while(true)
{
    set < int > tempSet;

    for (int i = 0; i < n; i ++)
    {
        if (m.size() == min && m.size() <= max)
        {
            tempSet.insert(i);
        }
    }
    //Some condition testing code
} 
```

或者

```
set < int > tempSet;

while(true)
{
    for (int i = 0; i < n; i ++)
    {
        if (m.size() == min && m.size() <= max)
        {
            tempSet.insert(i);
        }
    }
    tempSet.clear();

    //Some condition testing code
} 
```

考虑到 C++ 编译器的现状，哪种方法在时间和空间复杂度方面更好？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-10-19T23:39:23.200

第一个版本是正确的。它几乎在所有方面都更简单。更容易写、更容易阅读、更容易理解、更容易维护等等......

第二个版本*可能*更快，但也可能不会。在使用它之前，您需要证明它具有显着优势。在大多数重要的情况下，我猜想两者之间不会有可衡量的性能差异。

有时在嵌入式编程中，避免将东西放在堆栈上是有用的；在这种情况下，第二个版本是正确的。

默认使用第一个版本；仅当您可以给出这样做的充分理由时才使用第二个（如果原因是性能，那么您应该有证据表明好处是显着的）。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-19T23:25:13.307

我说第一个更防错误。您不必记住清除它（它只会超出范围并完成）。:-)

性能方面没有太大区别，但您仍然应该衡量这两种情况并自己看看。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-19T23:24:37.177

如果这是一个问题`set/map/list`，它不会有任何区别。如果是 的问题`vector/hash_set/hash_map/string`，则第二个将更快或相同的速度。当然，这种速度差异只有在您执行大量操作时才会明显（将 10,000 个整数推入`vector`10,000 次的速度大约是原来的两倍 - 3 秒和一些变化与 7 秒。）。

如果您正在执行诸如`struct/class`在数据结构中存储 a 而不是指向 a 的指针之类的操作，则这种差异会更大，因为在每次调整大小时，您都必须复制所有元素。

同样，在几乎所有情况下，它都无关紧要 - 在它确实重要的情况下，如果您正在优化，它就会显示出来，并且您关心每一点性能。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-19T23:21:54.733

第二个可能在时间上稍微好一些，但差异将非常小——代码仍然必须遍历并释放集合中的每个项目，无论是重新创建还是清除它。

（在空间上它们将是相同的。）

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-19T23:39:27.240

两者之间的性能差异将非常小。您应该根据代码的可读性和健壮性做出决定。

我认为第一个示例更具可读性和安全性 - 当您向循环添加条件时会在六个月内发生什么，可能在某处**继续**- 在第二个示例中，它将绕过 clear() 并且您将拥有一个错误。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-19T23:50:37.560

您正在将您的集合放入堆栈，因此分配成本几乎为零！

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-19T23:23:45.633

作为一般规则，将数据加载到容器中会产生内存分配成本。通过重复使用容器来避免多次支付这笔费用要好得多。如果您确实知道有多少项目，或者可以很好地猜测，您应该预先在容器中预先分配空间。

如果您将对象插入容器中，这一点尤其明显，因为您最终可能会支付大量额外的构造/销毁成本，因为容器意识到它太小，重新分配内存，并将构造新对象复制到基于新内存的在现有对象上。

始终预分配和重用。它可以节省时间和内存。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-19T23:30:46.790

几乎没有区别，尽管您的第二个避免多次调用构造函数和析构函数。另一方面，您的第一个是短行，并保证容器在循环范围之外不可见。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2013-02-28T22:15:09.157

Set 通常实现为红黑树。每个节点都是单独分配的，因此集合不会从重用中受益。这就是为什么这两种方法具有几乎相同的性能。调用“tempSet.clear()”应该花费与销毁对象大致相同的时间。第一种方法更好，因为它具有相同的性能并且遵循更安全的编程风格。

您可以在此处找到有关其他容器的一般讨论：[重用容器 o 创建新容器](https://stackoverflow.com/questions/15144279/reusing-a-container-or-declaring-a-new-one-each-time)

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2008-10-20T05:57:28.350

我认为您可以为 STL 容器预分配一定数量的元素，因此如果您知道容器中有多少元素，那么内存分配成本就会保持不变。

# python - 如何在 Windows、Linux 和 MacOS 中通过 Python 确定显示空闲时间？

> ID：217157
> 
> 赞同：18
> 
> 时间：2008-10-19T23:25:08.580
> 
> 标签：python, winapi, gtk, pygtk, pywin32

我想知道自从用户最后一次按键或移动鼠标以来已经过了多长时间 - 不仅在我的应用程序中，而且在整个“计算机”（即显示器）上，以便猜测他们是否仍然在计算机并能够观察屏幕上弹出的通知。

我想纯粹从 (Py)GTK+ 来做这件事，但我愿意调用特定于平台的函数。理想情况下，我想调用已经从 Python 包装的函数，但如果这不可能，我不会超过一点 C 或`ctypes`代码，只要我知道我真正在寻找什么。

在 Windows 上，我认为我想要的功能是[`GetLastInputInfo`](http://msdn.microsoft.com/en-us/library/ms646302.aspx)，但这似乎没有被 pywin32 包装；我希望我错过了什么。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-07-17T21:07:04.147

[Gajim](http://www.gajim.org/)在 Windows、OS X 和 GNU/Linux（以及其他 *nixes）上这样做：

1.  [Python 包装器模块](https://dev.gajim.org/gajim/gajim/blob/89c7eb6e6ab3f61a188c6cee063a000526df522c/gajim/common/sleepy.py)（还包括 Windows 空闲时间检测代码，使用`GetTickCount`with `ctypes`）；
2.  [基于 Ctypes 的模块来获取 X11 空闲时间](https://dev.gajim.org/gajim/gajim/blob/89c7eb6e6ab3f61a188c6cee063a000526df522c/gajim/common/idle.py)（使用`XScreenSaverQueryInfo`, 是旧 Gajim 版本中的 C 模块）；
3.  [C 模块获取 OS X 空闲时间](https://dev.gajim.org/gajim/gajim/blob/8ee54c65325d6670fffc6df8d773f811c5bf0243/src/common/idle_c/idle.c)（使用`HIDIdleTime`系统属性）。

这些链接指向相当过时的 0.12 版本，因此您可能需要检查当前来源以了解可能的进一步改进和更改。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2013-05-27T17:06:43.560

如果你在 Linux 上使用 PyGTK 和 X11，你可以这样做，这是基于 Pidgin 所做的：

```
import ctypes
import ctypes.util
import platform

class XScreenSaverInfo(ctypes.Structure):
    _fields_ = [('window', ctypes.c_long),
                ('state', ctypes.c_int),
                ('kind', ctypes.c_int),
                ('til_or_since', ctypes.c_ulong),
                ('idle', ctypes.c_ulong),
                ('eventMask', ctypes.c_ulong)]

class IdleXScreenSaver(object):
    def __init__(self):
        self.xss = self._get_library('Xss')
        self.gdk = self._get_library('gdk-x11-2.0')

        self.gdk.gdk_display_get_default.restype = ctypes.c_void_p
        # GDK_DISPLAY_XDISPLAY expands to gdk_x11_display_get_xdisplay
        self.gdk.gdk_x11_display_get_xdisplay.restype = ctypes.c_void_p
        self.gdk.gdk_x11_display_get_xdisplay.argtypes = [ctypes.c_void_p]
        # GDK_ROOT_WINDOW expands to gdk_x11_get_default_root_xwindow
        self.gdk.gdk_x11_get_default_root_xwindow.restype = ctypes.c_void_p

        self.xss.XScreenSaverAllocInfo.restype = ctypes.POINTER(XScreenSaverInfo)
        self.xss.XScreenSaverQueryExtension.restype = ctypes.c_int
        self.xss.XScreenSaverQueryExtension.argtypes = [ctypes.c_void_p,
                                                        ctypes.POINTER(ctypes.c_int),
                                                        ctypes.POINTER(ctypes.c_int)]
        self.xss.XScreenSaverQueryInfo.restype = ctypes.c_int
        self.xss.XScreenSaverQueryInfo.argtypes = [ctypes.c_void_p,
                                                   ctypes.c_void_p,
                                                   ctypes.POINTER(XScreenSaverInfo)]

        # gtk_init() must have been called for this to work
        import gtk
        gtk  # pyflakes

        # has_extension = XScreenSaverQueryExtension(GDK_DISPLAY_XDISPLAY(gdk_display_get_default()),
        #                                            &event_base, &error_base);
        event_base = ctypes.c_int()
        error_base = ctypes.c_int()
        gtk_display = self.gdk.gdk_display_get_default()
        self.dpy = self.gdk.gdk_x11_display_get_xdisplay(gtk_display)
        available = self.xss.XScreenSaverQueryExtension(self.dpy,
                                                        ctypes.byref(event_base),
                                                        ctypes.byref(error_base))
        if available == 1:
            self.xss_info = self.xss.XScreenSaverAllocInfo()
        else:
            self.xss_info = None

    def _get_library(self, libname):
        path = ctypes.util.find_library(libname)
        if not path:
            raise ImportError('Could not find library "%s"' % (libname, ))
        lib = ctypes.cdll.LoadLibrary(path)
        assert lib
        return lib

    def get_idle(self):
        if not self.xss_info:
            return 0

        # XScreenSaverQueryInfo(GDK_DISPLAY_XDISPLAY(gdk_display_get_default()),
        #                       GDK_ROOT_WINDOW(), mit_info);
        drawable = self.gdk.gdk_x11_get_default_root_xwindow()
        self.xss.XScreenSaverQueryInfo(self.dpy, drawable, self.xss_info)
        # return (mit_info->idle) / 1000;
        return self.xss_info.contents.idle / 1000 
```

上面的例子通过 ctypes 使用 gdk 来访问特定的 X11。Xscreensaver API 也需要通过 ctypes 访问。

移植它以使用 PyGI 和自省应该很容易。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-20T01:27:38.613

我得到了关于建议使用[pyHook](http://www.cs.unc.edu/Research/assist/developer.shtml)的鼠标点击的答案：

[使用python检测Windows中的鼠标点击](https://stackoverflow.com/questions/165495/detecting-mouse-clicks-in-windows-using-python)

这是我通过 ctypes 检测鼠标位置的一些其他代码：http: [//monkut.webfactional.com/blog/archive/2008/10/2/python-win-mouse-position](http://monkut.webfactional.com/blog/archive/2008/10/2/python-win-mouse-position)

实现这一点的一种更迂回的方法是通过屏幕捕获并使用 PIL 比较图像中的任何变化。

[http://www.wellho.net/forum/Programming-in-Python-and-Ruby/Python-Imaging-Library-PIL.html](http://www.wellho.net/forum/Programming-in-Python-and-Ruby/Python-Imaging-Library-PIL.html)

# language-agnostic - 应用程序中的插件系统推荐什么？

> ID：217172
> 
> 赞同：1
> 
> 时间：2008-10-19T23:38:32.250
> 
> 标签：language-agnostic, plugins, compiled-language

在编译语言（C#/C/C++/D）中做插件的“正常”方法是什么？我对与语言无关的方法特别感兴趣，但特定于语言的方法并非不可接受。

目前，“编译时”插件方法（仅包含代码或不包含代码，一切正常）是有效的，但可以迁移到更动态方法的东西是首选。

关于运行时类型，我更感兴趣的是加载插件的机制等等，而不是设计插件/应用程序界面

编辑：顺便说一句，插件将是奴隶而不是主人。插件的基本动作是在给定的情况下，它会被要求“做它的事情”并被赋予一个环境对象，它应该使用它来获得它需要操作的东西。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-20T00:06:12.507

[Mono.Addins](http://www.mono-project.com/Mono.Addins)似乎是 .NET 的一个很好的解决方案。我相信它包含 API，允许您从 repo 下载插件（或插件）并将其动态加载到正在运行的程序集中。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-20T00:48:10.533

对于编译语言（编译意味着程序作为本机可执行文件运行，没有任何类型的虚拟机），您几乎需要使用某种特定于平台的共享库方法。在 Windows 中，这意味着使用 DLL。

您根据一组函数（具有特定名称、参数和调用约定）定义插件接口。然后，您在共享库中加载函数的地址并前往城镇。在 Windows 中，这意味着使用[GetProcAddress()](http://msdn.microsoft.com/en-us/library/ms683212(VS.85).aspx)，然后将返回值转换为 C 中适当类型的函数指针，或者您正在使用的语言中的任何等价物。

另一个可能更理想也可能不更理想的选择是从您的本机应用程序中运行另一种语言的虚拟机，并让插件成为该语言的代码。例如，您可以使用 CPython 运行 Python VM 并动态加载 Python 模块。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-20T00:01:45.213

我发现插件的难点在于：找到它们、解决它们的依赖关系以及处理版本问题。您和您的插件作者应该清楚如何处理这些问题。如果你把这些问题弄错了，那将导致无穷无尽的痛苦。我会研究使用插件的脚本语言和应用程序，以了解什么是有效的。

静态构造函数通常是坏意义上的“聪明”。由于无论如何您都必须一次加载一个插件（C/C++：dlopen 和 Linux 下的朋友）（在动态情况下），您也可以在这样做时明确地初始化它们。除此之外，这可能会让您有机会拒绝没有预期 api 的插件。

请注意，您不必为插件使用动态加载库。也可以使用其他机制：共享内存、套接字等......

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-20T01:05:51.340

这真的取决于你想做什么。在 Emacs 和 Gimp 中看到的常见 Unix 模式是编写一个程序，该程序由一个小型编译组件组成，该组件公开了解释组件用来执行所有操作的基本功能。提供可以在应用程序之上构建的新功能的插件很容易，但您需要在提供的原语中非常灵活才能实现这一点。在相反的极端想象一个可以以多种格式保存的照片编辑器。您希望允许人们编写自己的文件格式处理程序。这需要让您的代码使用一组简单的原语，然后在运行时选择一个实现。在直接（Unix）C 中使用 dlopen，在 C++ 中使用 extern C，这限制了你可以做什么和 dlopen。在 Objective-C 中，你有一个类可以为你做这件事。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-20T03:32:30.267

对于每个插件封装一组通用函数的不同实现的从属插件，我只需将 DLL 存放在主机应用程序已知的插件文件夹中（例如“c:\program files\myapp\plugins”），并且然后通过反射从主机调用 DLL。

在安装每个 DLL 时，您*可以*进行某种复杂的注册过程，但我从未遇到过简单的插件在一个文件夹中的方法的任何问题。

编辑：要在 C# 中执行此操作，您只需向 DLL（名为“插件”或其他名称）添加一个公共类，并在那里实现所需的功能。然后从您的主机创建一个 Plugin 类型的对象并调用其方法（全部使用反射）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-19T23:46:00.940

带有 void Register(EventSource) 的接口似乎运行良好 - 有关示例，请参见 ASP.NET 的[IHttpModule.Init(HttpApplication](http://msdn.microsoft.com/en-us/library/system.web.ihttpmodule.init.aspx) )。

这允许应用程序作者（谁控制 EventSource）根据需要添加事件，而无需扩展 IPlugin 接口（不可避免地导致 IPluginEx、IPlugin2、IPlugin2Ex 等）

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-20T00:36:27.983

我使用的一种方法（在 .NET 中）是让主机对插件进行初始调用（通过反射），启动插件并将引用传递给插件保存的主机。然后插件根据需要调用主机上的方法（也通过反射）。

我认为对于大多数插件，调用通常会在另一个方向进行（即主机会根据需要调用插件）。就我而言，插件本身具有需要使用主机功能的 UI 元素。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-20T01:10:27.650

除了低级模块实现问题（例如windows DLL和实现问题），我使用的游戏引擎在DLL中只有一个全局注册函数，并尝试在插件目录中的每个dll上查找并调用它。注册功能执行公开功能所需的任何簿记。

# perforce - Perforce：有没有办法将编号的更改列表链接到仓库中的文件夹？

> ID：217177
> 
> 赞同：1
> 
> 时间：2008-10-19T23:45:17.197
> 
> 标签：perforce

问题：我的仓库中有多个项目已签出。我还有多个未决编号的更改列表，每个更改列表都包含特定于其项目的签出文件。当我签出一个新文件时，它出现在默认更改列表中，而不是与其项目相关的更改列表中，我需要手动将其移动到相关更改列表中。这很快就会变得非常乏味。

有没有办法自动化这个过程？当然，带有正则表达式的 shell 脚本可以工作，但我想知道是否有任何 Perforce 功能可以做到这一点。例如，有没有办法将我的项目文件夹链接到编号的更改列表，以便新签出的文件自动出现在相关的更改列表中？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-22T17:26:40.993

图形客户端使这非常容易。将文件或文件夹拖到更改列表中将为您检查。无需使用上下文菜单或 Ctrl+E 将它们检出，这会将它们放入默认更改列表中，只需将它们拖到适当的更改列表中，它们就会自动检出到您想要的位置。

要从命令行执行此操作，您可以通过 -c 开关将目标更改列表编号传递给编辑命令。以下命令将打开文件 foo.txt 以在更改列表编号 1234 中进行编辑：

```
p4 edit -c 1234 foo.txt 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-20T00:00:31.240

我处理这个问题的方式是我正在处理的每个项目都有一个单独的客户端工作区配置。

但是，这是其他情况的六分之一，六分之一 - 现在我必须管理一堆工作区。我遇到的问题是，当我在项目 A 上工作并想在项目 BI 中快速做一些事情时，必须切换我的工作区才能做到这一点。

Perforce 确实有一些方法可以通过使用您放置在目录层次结构的适当部分中的配置文件来帮助处理该问题。请参阅[Perforce 用户指南，第 2 章 - “使用配置文件”部分](http://www.perforce.com/perforce/doc.081/manuals/p4guide/02_config.html#1081890)。

# templates - 软件/系统移交模板 - 有什么好的例子吗？

> ID：217185
> 
> 赞同：1
> 
> 时间：2008-10-19T23:52:46.403
> 
> 标签：templates, documentation, release

我需要将我刚刚发布的更新公司网站的内容移交给我们的内容编辑。显然，带笔记的培训课程是不够的。很公平。

因此，更可怕的文档迫在眉睫。在对 Google 进行了相当简短的搜索后，我找不到任何相关且可用的模板来用作网站或 Web 应用程序移交的基础。我发现应该出现在此类文档中的最有用的项目列表是专家交流（敌人）：

1.  系统概述、概述
2.  流程和跨部门流程
3.  系统配置、设置和依赖项
4.  技术要求、特点和限制
5.  支持过程
6.  用于故障排除的相关方的升级列表和联系信息

这是一个很好的工作基础——我可以为那些只会对网站进行内容更改的用户“简化”，但有人知道云中可用的良好标准模板吗？是否应该将更多内容添加到此列表中？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-19T23:55:24.727

我本身不知道可用的模板，但另请参阅这个问题：[支持文档中包含哪些核心元素？](https://stackoverflow.com/questions/205374/what-are-the-core-elements-to-include-in-support-documentation)

# c# - 将 C# 数据结构存储到 SQL 数据库中

> ID：217187
> 
> 赞同：10
> 
> 时间：2008-10-19T23:54:10.813
> 
> 标签：c#, asp.net, sql, data-structures

我是 ASP.NET 和 SQL 服务器世界的新手，所以请原谅我的无知...

如果我在 C# 中有一个数据结构（例如，让我们说一个存储一些字符串的向量），是否可以像在 SQL 表中一样存储向量的内容？我想这样做，以便尽可能快地将数据转换回矢量形式，而不必逐个元素地构造它。几乎就像将二进制数据写入文件，然后读取它并将其复制到 C 中分配的结构中。

我在 SQL Server 2008 上创建了一个表，其中一个字段被定义为 VARBINARY(MAX)。我以为我会从那开始。

有人可以向我展示一个示例，说明我将如何在该字段中存储和检索例如 10 个字符串的向量？这甚至可能吗（我想不出为什么不）？

谢谢！

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-10-20T00:15:13.893

首先，很明显的方法是简单地创建一个关系结构并将对象映射到数据库中的字段。

其次，如果您有一个可序列化的对象，您可以将它存储在 SQL Server 中。我有时会这样做，并使用 SQL Server 中的 Text 数据类型来存储 XML。

***意见：我更喜欢将序列化对象存储为 XML 而不是二进制数据。***为什么？因为您实际上可以读取其中的内容（用于调试），并且在 SQL Server 中您可以使用 XQuery 从序列化对象中选择数据。根据我的经验，与使用更易于调试且可以以伪关系方式使用的数据相比，使用二进制数据所带来的性能提升并不值得。看看[SQL Server 的 XQuery 功能](http://msdn.microsoft.com/en-us/library/ms345122(SQL.90).aspx)。即使您不打算立即使用它，也没有理由让自己陷入困境。

您可以查看一些使用[NetDataContractSerializer](http://msdn.microsoft.com/en-us/library/system.runtime.serialization.netdatacontractserializer.aspx)的示例。

我相信你所说的向量是 C# 中的 List<> 。查看 System.Collections.Generic。您可以使用 NetDataContractSerializer 序列化 3 个字符串的列表，例如：

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Runtime.Serialization;
using System.IO;

namespace SerializeThingy
{
    class Program
    {
        static void Main(string[] args)
        {
            List<string> myList = new List<string>();
            myList.Add("One");
            myList.Add("Two");
            myList.Add("Three");
            NetDataContractSerializer serializer = new NetDataContractSerializer();
            MemoryStream stream = new MemoryStream();
            serializer.Serialize(stream, myList);
            stream.Position = 0;
            Console.WriteLine(ASCIIEncoding.ASCII.GetString(stream.ToArray()));
            List<string> myList2 = (List<string>)serializer.Deserialize(stream);
            Console.WriteLine(myList2[0]);
            Console.ReadKey();
        }
    }
} 
```

这个例子只是序列化一个列表，将序列化输出到控制台，然后在另一面证明它是正确的。我认为您可以从这里看到，您可以将内存流转储为字符串并将其写入数据库，或者使用其他流类型而不是内存流来执行此操作。

请记住引用 System.Runtime.Serialization 以访问 NetDataContractSerializer。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-10-20T00:19:16.943

```
[Serializable]
public struct Vector3
{
    public double x, y, z;
}

class Program
{
    static void Main(string[] args)
    {
        Vector3 vector = new Vector3();
        vector.x = 1;
        vector.y = 2;
        vector.z = 3;

        MemoryStream memoryStream = new MemoryStream();
        BinaryFormatter binaryFormatter = new BinaryFormatter();
        binaryFormatter.Serialize(memoryStream, vector);
        string str = System.Convert.ToBase64String(memoryStream.ToArray());

        //Store str into the database
    }
} 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-20T00:06:31.663

假设对象被标记`[Serializable]`或实现类提供`ISerializable`了`BinaryFormatter`一种简单的方法来做到这一点。

如果没有，您正在查看（非平凡的）自定义代码。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-20T00:02:25.993

如果您要这样做（我想这在技术上是*可行的*），您也可以使用平面文件：不再使用关系数据库。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-20T00:40:37.897

这是通用列表的另一种更通用的方法。注意，存储在列表中的实际类型也必须是可序列化的

```
using System.Runtime.Serialization.Formatters.Binary;
using System.IO;
using System.Data.SqlClient;
using System.Runtime.Serialization;

public byte[] SerializeList<T>(List<T> list)
{

    MemoryStream ms = new MemoryStream();

    BinaryFormatter bf = new BinaryFormatter();

    bf.Serialize(ms, list);

    ms.Position = 0;

    byte[] serializedList = new byte[ms.Length];

    ms.Read(serializedList, 0, (int)ms.Length);

    ms.Close();

    return serializedList; 

} 

public List<T> DeserializeList<T>(byte[] data)
{
    try
    {
        MemoryStream ms = new MemoryStream();

        ms.Write(data, 0, data.Length);

        ms.Position = 0;

        BinaryFormatter bf = new BinaryFormatter();

        List<T> list = bf.Deserialize(ms) as List<T>;

        return list;
    }
    catch (SerializationException ex)
    {
        // Handle deserialization problems here.
        Debug.WriteLine(ex.ToString());

        return null;
    }

} 
```

然后在客户端代码中：

```
List<string> stringList = new List<string>() { "January", "February", "March" };

byte[] data = SerializeList<string>(stringList); 
```

存储/检索此字节数组的一种基本方法是使用简单的 SQLClient 对象：

```
SqlParameter param = new SqlParameter("columnName", SqlDbType.Binary, data.Length);
param.Value = data; 

etc... 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-12-20T12:54:02.933

有理由保持灵活。不应允许数据库结构的规则或指导方针阻碍创造力。鉴于这里的第一个线程，我可以看到一种混合方法来存储序列化列和约束列。通过保持对可能性的开放态度，许多应用程序可以得到极大的改进。

无论如何，我很欣赏新手对此事的看法。让我们都保持新鲜..

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-29T00:15:34.890

与 c# 相比，我在关系数据库方面的经验更多，但二进制序列化是一种可接受的方式，因为它允许将整个对象的状态保存到数据库中。XML 序列化几乎相同，但不允许使用泛型类型。

# svn - 如何隔离特定的颠覆修订？

> ID：217190
> 
> 赞同：7
> 
> 时间：2008-10-19T23:56:51.357
> 
> 标签：svn

我有一个已提交给 SVN 主干的修订，我想回滚。但是，我想以某种方式保留更改，例如分支甚至补丁文件。有什么建议么？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-10-19T23:58:59.620

反向合并（我认为这是术语），提交，仅此而已。

对于“反向合并”部分 - TSVN 有一个很酷的功能，称为“恢复到此修订版”（和“恢复此修订版的更改”），可通过日志对话框访问。

VCS 的主要目的是保留更改的历史记录。您始终可以使用“更新到修订版...”或使用上述“快捷方式”返回到此特定修订版。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-20T00:04:48.517

您可以在复制时指定特定的修订（即分支）。

就像是：

```
svn 复制 -rsome_revision 主干分支/interesting_branch

```

因此，在您的主干中回滚您的更改，然后执行您的分支，在您提交回滚（合并）之前指定修订。

如果您确实想要这样做，您还可以通过将 an 的输出重定向`svn diff`到文本文件来将差异捕获为补丁文件。但这通常不是必需的，因为 subversion 合并命令已经为您提供了这种灵活性。

# error-handling - awk 可以跳过不存在的文件吗？

> ID：217213
> 
> 赞同：6
> 
> 时间：2008-10-20T00:21:32.303
> 
> 标签：error-handling, awk, race-condition, gawk

有没有办法让**awk** (gawk) 忽略或跳过丢失的文件？也就是说，通过命令行传递的文件不再存在于文件系统中（例如，/proc/[1-9]* 下快速出现/消失的文件）。

默认情况下，丢失文件是致命错误:-(

我希望能够做类似这样的事情：

```
BEGIN { MISSING_FILES_ARE_FATAL = 0 }  # <- Wishful thinking!
      { count++ }
END   { print count } 
```

包装脚本无法在 awk 运行之前检查文件是否存在，因为它们可能会在检查它们和 awk 尝试打开它们之间消失，即，这是一个竞争条件。（在 awk 中 check-and-then-open 也是一种竞争条件，虽然时间比较紧）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-09-10T11:22:57.233

GAWK 4 可以`BEGINFILE`在其中测试`ERRNO`并执行`nextfile`if `ERRNO`is not empty（表示无法打开文件）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-20T09:35:57.583

即使在你的 awk 脚本周围贴上 perl 或 shell 包装器，我认为仍然会有竞争条件。例如，使用 ADEpt 原本很好的 shell 片段：

```
[ -r "$filename" ] && awk -f ... $filename 
```

没有什么可以阻止进程在 -r 和 awk 尝试打开文件的时间之间消失......

我能想到的唯一答案是使用 LD_PRELOAD 替换 awk 的系统打开调用，这样如果文件丢失，则会打开 /dev/null 上的读取文件描述符。

那可能行得通...

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-20T09:48:51.723

那么您可以通过系统调用检查 的内容`ARGV`，然后通过`getline`.

```
 if (system("test -r " ARGV[1]) == 0)
   while ( (getline aline < ARGV[1]) >0 )
     # process ARGV[1] via `aline` instead of $0 
```

...

然后处理 ARGV[2] 等 HTH

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-07T13:06:26.780

在我看来，“MISSING_FILES_ARE_FATAL = 0”功能将成为下一个 gawk 版本的一部分。查看当前 gawk-stable 源代码的 ChangeLog 文件：

--- 剪断 ---

2008 年 8 月 22 日星期五 14:43:49 阿诺德 D.罗宾斯

```
* io.c (nextfile): Users Strong In The Ways Of The Source can use
non-existant files on the command line without it being a fatal error. 
```

--- 剪断 ---

[http://cvs.savannah.gnu.org/viewvc/gawk-stable/ChangeLog?revision=1.87&root=gawk&view=markup](http://cvs.savannah.gnu.org/viewvc/gawk-stable/ChangeLog?revision=1.87&root=gawk&view=markup)

赫尔曼

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-20T01:05:39.627

按照最好的传统，我将使用 Perl 程序回答您的 awk 问题。

```
#!/usr/bin/perl -w

for my $file (@ARGV) {
    open my $fh, $file or next;
    while(<$fh>) {
        ...do your thing here...
    }
} 
```

（这不是 awk，但它是唯一没有竞争条件的解决方案。）

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-21T22:14:29.783

哦对不起。忽略我之前的回答。这是另一个建议：

```
cat /proc/[1-9]* 2>/dev/null | awk .... 
```

Cat 将吞噬所有文件，无论是丢失的还是现有的，cat 的错误将被遗忘（丢失的文件对 cat 来说是非致命错误），并且 awk 将能够处理结果。

# c# - 自动将一些 Where 子句添加到 Linq 表达式树

> ID：217219
> 
> 赞同：3
> 
> 时间：2008-10-20T00:33:05.883
> 
> 标签：c#, linq, entity-framework

我正在使用实体框架和 Linq to Entity。我创建了一个小型数据库模式和框架来实现版本控制和本地化。现在每个实体都包含两个或三个表（即 Product、ProductBase 和 ProductLocal）。

我的 linq 始终包含以下样板代码：

```
from o in DB.Product
from b in o.Base
from l in o.Local
WHERE o.VersionStatus == (int)VersionStatus.Active 
   && b.VersionStatus == (int)VersionStatus.Active 
   && l.VersionStatus == (int)VersionStatus.Active 
   && l.VersionLanguage == Context.CurrentLanguage
select new ProductInstance { Instance = o, Base = b, Local = l } 
```

我想要完成的是把上面变成：

```
(from o in DB.Product
 from b in o.Base
 from l in o.Local
 select new ProductInstance { Instance = o, Base = b, Local = l }).IsActive() 
```

或者最坏的情况是：

```
from o in DB.Product.Active()
from b in o.Base.Active()
from l in o.Local.Active()
select new ProductInstance { Instance = o, Base = b, Local = l } 
```

我扩展了 EDM 生成的基类，以实现一些强制执行属性的接口（ IVersionStatus 和/或 IVersionLanguage ）。有什么方法可以遍历表达式树，检查表达式中的类型是否实现了该接口，然后相应地设置 VersionStatus ？

我希望它像第一个选项一样简单，只是少写和/或忘记。我已经看到了事后的例子，在它的 IEnumerable 之后，但我宁愿不要从数据库中提取比我需要的更多的东西。

感谢您的任何提示！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-20T01:22:39.483

是的。

您可以通过在 IQueryable 上定义一个名为 IsActive 的扩展方法来做到这一点。IQueryable 上有一个名为“Expression”的属性，它返回一个表达式树，表示从您的查询生成的 LINQ 方法调用链。

在你的情况下，看起来像这样：

```
DB.Product.SelectMany(o=>o.base, (o, b)=>new{o.b}).SelectMany(item=>o.local, (item, local)=>new {item.o, item.b, item.local}).Select(item=>new ProductInstance { Instance = item.o, Base = item.b, Local=item.Local}); 
```

“DB.Product”是第一个 From 子句中的项目。每个剩余的“SelectMany”调用都是一个附加的 from 子句。

然后，您可以深入研究表达式树以收集所有 from 子句元素。查看它们的类型，然后最终为 where 子句生成表达式树。

然后，您的扩展方法将使用您生成的 where 子句从 IQueryable 参数中返回 .Where 。

当您尝试“foreach”结果时，生成的 Where 子句将在服务器上与查询的其余部分一起执行。

**编辑：**

请注意，如果您希望它与显式的“Join”子句一起使用，那么除了“SelectMany”之外，您还需要添加对“Join”方法的支持。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-20T01:08:42.677

您需要使用 DataLoadOptions 类，以便它自动加载您在该对象上指定的外键关系。这将使它自动获取您指定的链接表，这正是您正在做的事情。

此页面详细说明了如何执行此操作，并详细说明了我认为您正在寻找的内容。

[http://www.crazysalsadancer.com/2008/08/efficient-data-loading-with-linq-using.html](http://www.crazysalsadancer.com/2008/08/efficient-data-loading-with-linq-using.html)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-20T01:18:54.903

我可能是错的，但我不认为`DataLoadOptions`适用于实体框架。

# c# - 带有按钮的用户控件 - 当 uc 被动态添加到另一个页面时

> ID：217227
> 
> 赞同：2
> 
> 时间：2008-10-20T00:43:30.433
> 
> 标签：c#, asp.net, dynamic

带有按钮的用户控件 - 当 uc 被动态添加到另一个页面时，我松开了按钮处理程序。

即：我有 1 个用户控件和 1 个按钮 - 该按钮在后面的代码中有一个事件处理程序。当我以编程方式将 UserControl 添加到页面时，按钮处理程序不会触发。任何解决此问题的简单方法的想法。

通常，当我将控件动态添加到页面时，我不得不在每次回帖时重新连接事件处理程序，但我希望因为该按钮包含在 UserControl 中并且 uc 是动态添加的，所以我不会松开它 - 不会似乎是这样 - 有没有更好的方法来做到这一点？我的用户控件最终会有很多按钮，我不想每次都从动态添加用户控件的页面重新连接它们。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-20T09:14:27.737

您将使用 Page.LoadControl 在页面的 OnInit 事件处理程序中添加 ascx 控件（尽管我已经在 Load 事件处理程序中这样做并且它有效，但文档指定了 OnInit）

您的用户控件（和页面）应该为每次加载和回发连接他们的事件，例如 this.buttonID.Click += new System.EventHandler(this.buttonID_Click);

如果您正在这样做，那么它应该都可以工作，如果没有，请检查您的 aspx/ascx 标记，因为错误的字符（例如某处的额外 < 可能会破坏页面，但它仍会在浏览器中呈现正常）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-21T13:31:54.953

您是否将其添加到 ajax UpdatePanel 内部？更新面板将捕获回发。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-20T08:18:08.490

有时，当您将控件动态添加到页面时，按钮事件处理程序会因为控件的 ID 不同步而变得混乱。但是我再次需要看看你是如何动态加载控件的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-20T08:46:32.863

当您动态添加任何控件时，您必须**每次**在 Page_Init 事件的主机页面中创建它。
如果您这样做，请确保单击事件处理程序已连接到 UserControl 的 OnInit。我认为您不会每次都创建动态控件。

# unicode - 当我的文本显示为框时是什么意思？

> ID：217228
> 
> 赞同：3
> 
> 时间：2008-10-20T00:43:59.170
> 
> 标签：unicode, text, fonts

我正在尝试使用（例如）Windows GDI 在我的程序中显示一些文本，并且某些 unicode 字符显示为框？怎么了？

另请参阅：[当我的文本显示为问号时，这意味着什么？](https://stackoverflow.com/questions/217237/what-does-it-mean-when-my-text-is-displayed-as-question-marks)

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-10-20T00:48:32.093

![](https://i.stack.imgur.com/bkF8U.jpg)

（T 恤图片来自[http://www.cafepress.com/nucleartacos.163046834](http://www.cafepress.com/nucleartacos.163046834)）

上图表示文本显示系统的常见故障模式，它未能考虑到所有 Unicode 字符。在 Windows 平台上，无法使用任何可用字体表示的字符用一个开放的矩形表示。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-20T00:46:09.133

通常，这意味着指定的 unicode 字符在该特定字体中不可用。尝试将字体更改为跨国字体之一，它应该会消失。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-20T01:08:11.010

在 Windows 中，尝试显示 Unicode 字符时会出现 2 个常见的显示问题：

1.  文本有时显示为问号

    *   当 Unicode 数据通常通过系统代码页（但可以在转换调用中指定其他代码页）转换为 8 位字符集编码（或技术上的多字节字符）时，就会发生这种情况。如果目标 8 位字符集不包含所需的字符，则目标字符集中无法表示的任何字符都将转换为问号。
2.  文本有时显示为框

    *   这是字体没有特定字符的 glpyh 的问题。当文档中的 Unicode 字符与字体支持的字符不匹配时，会出现框。具体来说，这些框表示所选字体不支持的字符。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-20T00:47:26.777

问题是您尝试显示的文本包含您使用的字体不支持的字符。方框字符是字体中没有字形的 Unicode 文本的默认替换字符。

在 Windows 上，如果您尝试以多种不同语言显示文本，请使用 Arial Unicode MS 等字体 - 这包括大量不同语言的字形。它是一种“最小公分母”字体 - 字形通常会存在，但通常缺少字符，并且某些字形彼此相邻看起来会有些奇怪。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2020-02-29T16:14:51.567

我在 Chrome for Win10 上遇到相同的框/字符/文本问题大约 2 年，并尝试了所有建议的修复，但没有一个对我有用。我的问题是由我没有考虑过的应用程序引起的。我使用 uBlock Origin 来减少弹出广告。默认情况下，uBlock 还“阻止此站点上的远程字体”，实际上是每个站点。当字体被阻止时，Chrome 会插入一些东西来代替它，通常是一个简单的正方形或矩形。如果没有其他工作，请检查您的广告拦截器。该功能可以轻松关闭，然后显示所有正确的文本。

# c# - 冒泡事件。

> ID：217233
> 
> 赞同：28
> 
> 时间：2008-10-20T00:48:03.687
> 
> 标签：c#, winforms, events

我在应用程序中有多个层，我发现自己不得不将事件冒泡到 GUI 层以进行状态栏更改等。. 我发现自己不得不编写重复的代码，其中每一层都简单地订阅来自较低层的事件，然后在回调中简单地在链上引发一个事件。有没有更有效的方法来做到这一点？

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2008-10-20T02:22:44.447

如果您所做的只是从另一个事件处理程序触发事件处理程序，您可以切断中间人并将事件处理程序直接挂接到事件的添加/删除块中。

例如，如果您有一个带有“SaveButtonClick”事件的 UserControl，并且您要做的就是在单击 UserControl 上的“SaveButton”时调用事件处理程序，您可以这样做：

```
public event EventHandler SaveButtonClick
{
    add { this.SaveButton.Click += value; }
    remove { this.SaveButton.Click -= value; }
} 
```

现在您不需要任何代码来触发 SaveButtonClick 事件 - 它会在引发 SaveButton.Click 事件时自动触发（即当有人单击该按钮时）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-22T09:58:25.820

阅读 Jeremy Miller 的博客“The Shade Tree Developer”，尤其是他的[*Write Your Own CAB*系列](http://codebetter.com/jeremymiller/2007/07/26/the-build-your-own-cab-series-table-of-contents/)- 他谈到的命令模式内容可能正是您所需要的。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-25T20:13:27.357

Peter Rilling 发布了一种在 winforms 中模拟事件冒泡/广播的方法。它简单有效。

[http://www.codeproject.com/KB/cs/event_broadcast.aspx](http://www.codeproject.com/KB/cs/event_broadcast.aspx)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-20T06:46:46.503

除非我看到更多的设计......很难给出一个好的答案。

WPF 确实（自动）在 UI 组件/控制树中冒泡事件......这现在已经内置到框架中。所以我想这是推荐的方式:)

绕过中间人Layer2的麻烦在于Layer1和Layer3现在互相认识……是耦合的。所以这是一个权衡..如果你对耦合没问题..消除中间人/发明一个专门负责这个责任的组件。但是，如果您希望第 3 层可热插拔（低耦合），我会说继续冒泡。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-20T01:25:39.193

您可以拥有一个仅支持事件的中央频道。此通道必须是独立的，因此该层仅发布或订阅它。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-21T13:58:34.010

看看[更新控件 .NET](http://udpatecontrols.net)。这些控件甚至可以通过业务逻辑层发现它们所依赖的数据模型部分。您不必编写*任何*代码来通知他们。

# unicode - 我的文字显示为问号是什么意思？

> ID：217237
> 
> 赞同：10
> 
> 时间：2008-10-20T00:49:05.463
> 
> 标签：unicode, text, fonts

我正在尝试使用（比如说）Windows GDI 在我的程序中显示一些文本，并且一些 unicode 字符显示为问号？怎么了？

另请参阅：[当我的文本显示为框时是什么意思？](https://stackoverflow.com/questions/217228/what-does-it-mean-when-my-text-is-displayed-as-boxes)

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-20T01:05:52.840

在 Windows 中，尝试显示 Unicode 字符时会出现 2 个常见的显示问题：

1.  文本有时显示为问号

    *   当 Unicode 数据通常通过系统代码页（但可以在转换调用中指定其他代码页）转换为 8 位字符集编码（或技术上的多字节字符）时，就会发生这种情况。如果目标 8 位字符集不包含所需的字符，则目标字符集中无法表示的任何字符都将转换为问号。
2.  文本有时显示为框

    *   这是字体没有特定字符的 glpyh 的问题。当文档中的 Unicode 字符与字体支持的字符不匹配时，会出现框。具体来说，这些框表示所选字体不支持的字符。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-20T00:53:31.477

这意味着您的 Unicode 文本正在某处转换为 ANSI 文本。由于 Latin-1 之外的 Unicode 字符无法转换为 ANSI，因此它们将转换为问号。确保您的程序编译时启用了 Unicode 支持（即预处理器符号 UNICODE 和 _UNICODE 由您的项目#定义），以便您始终调用各种 Windows 函数的正确 Unicode 版本。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-20T00:53:03.473

基本上你已经损坏了文本。您将 Unicode 文本采用一种编码，然后将其转换为另一种编码，而没有检查目标编码是否包含源文本中的所有字符。这样做后，您会遇到一堆乱码。

这样做的方法包括：

1.  将 UTF-8 文本视为 ANSI（不首先转换为有效的代码页）
2.  将 Unicode 文本转换为代码页，而不检查代码页中是否包含正确的字符。

# c# - 生成用户友好的字母数字 ID 的选项有哪些（如企业 ID、SKU）

> ID：217253
> 
> 赞同：16
> 
> 时间：2008-10-20T00:56:32.717
> 
> 标签：c#, .net, algorithm, guid

以下是要求：

必须是字母数字，8-10 个字符，以便用户友好。这些将作为唯一键存储在数据库中。我使用 Guids 作为主键，因此使用 GUIds 生成这些唯一 Id 的选项会更可取。

我正在考虑采用 Guid 并转换为 8 个字符的唯一字符串的 base-n 转换器的行。

首选短的、轻量级的算法，因为它经常被调用。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-20T21:26:27.803

```
8 characters - perfectly random - 36^8 = 2,821,109,907,456 combinations
10 characters - perfectly random - 36^10 = 3,656,158,440,062,976 combinations
GUID's - statistically unique* - 2^128 = 340,000,000,000,000,000,000,000,000,000,000,000,000 combinations 
```

* [GUID 是否 100% 都是唯一的？[堆栈溢出]](https://stackoverflow.com/questions/39771/is-a-guid-unique-100-of-the-time)

您的 GUID -> 字符转换问题；虽然您的 GUID 在统计上是唯一的，但通过采用任何子集，您可以减少随机性并增加冲突的机会。您当然不想创建非唯一的 SKU。

* * *

解决方案1：

使用与对象和业务规则相关的数据创建 SKU。

即，可能存在使对象唯一[（自然键）](http://en.wikipedia.org/wiki/Natural_key)的属性的小组合。结合自然键的元素，对它们进行编码和压缩以创建 SKU。通常，您只需要一个日期时间字段（即 CreationDate）和一些其他属性即可实现此目的。您在创建 sku 时可能有很多漏洞，但 sku 与您的用户更相关。

假设：

```
Wholesaler, product name, product version, sku
Amazon,     IPod Nano,    2.2,             AMIPDNN22
BestBuy,    Vaio,         3.2,             BEVAIO32 
```

* * *

解决方案2：

一种方法，它保留一系列数字，然后继续按顺序释放它们，并且永远不会返回相同的数字两次。您仍然可以在该范围内留下漏洞。虽然您可能不需要生成足够多的 sku，但请确保您的要求允许这样做。

一种实现是`key`在具有计数器的数据库中拥有一个表。计数器在事务中递增。重要的一点是，软件中的方法不是增加 1，而是抓取一个块。伪c#代码如下。

```
-- what the key table may look like
CREATE TABLE Keys(Name VARCHAR(10) primary key, NextID INT)
INSERT INTO Keys Values('sku',1)

// some elements of the class
public static SkuKeyGenerator 
{
    private static syncObject = new object();
    private static int nextID = 0;
    private static int maxID = 0;
    private const int amountToReserve = 100;

    public static int NextKey()
    {
        lock( syncObject )
        {
            if( nextID == maxID )
            {
                ReserveIds();
            }
            return nextID++;
        }
    }
    private static void ReserveIds()
    {
        // pseudocode - in reality I'd do this with a stored procedure inside a transaction,
        // We reserve some predefined number of keys from Keys where Name = 'sku'
        // need to run the select and update in the same transaction because this isn't the only
        // method that can use this table.
        using( Transaction trans = new Transaction() ) // pseudocode.
        {
             int currentTableValue = db.Execute(trans, "SELECT NextID FROM Keys WHERE Name = 'sku'");
             int newMaxID = currentTableValue + amountToReserve;
             db.Execute(trans, "UPDATE Keys SET NextID = @1 WHERE Name = 'sku'", newMaxID);

             trans.Commit();

             nextID = currentTableValue;
             maxID = newMaxID;
        }
    } 
```

这里的想法是您保留足够的键，这样您的代码就不会经常进入数据库，因为获取键范围是一项昂贵的操作。您需要很好地了解需要保留的密钥数量，以平衡密钥丢失（应用程序重新启动）与过快耗尽密钥并返回数据库。这种简单的实现无法重用丢失的密钥。

因为这个实现依赖于数据库和事务，所以您可以让应用程序同时运行并且都生成唯一键，而无需经常访问数据库。

请注意，以上内容大致基于[Patterns of Enterprise Application Architecture (Fowler)](http://martinfowler.com/books.html#eaa)`key table`第 222 页。该方法通常用于在不需要数据库标识列的情况下生成主键，但您可以看到它如何适应您的目的。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-10-20T01:10:30.707

您可能会考虑以[36](http://en.wikipedia.org/wiki/Base_36)为底，因为它可以处理字母和数字。考虑从你的集合中移除 I（眼睛）和 O（哦），这样它们就不会与 1（一）和 0（零）混淆。有些人可能也会抱怨 2 和 Z。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-20T01:12:20.393

如果您正在寻找“用户友好”，您可能想尝试使用整个单词，而不是简单地将其设为短/字母数字，因此，类似于：

```
words = [s.strip().lower() for s in open('/usr/share/dict/canadian-english') if "'" not in s]
mod = len(words)

def main(script, guid):
    guid = hash(guid)

    print "+".join(words[(guid ** e) % mod] for e in (53, 61, 71))

if __name__ == "__main__":
    import sys
    main(*sys.argv) 
```

产生如下输出：

```
oranjestad+compressing+wellspring
padlock+discommoded+blazons
pt+olenek+renews 
```

这很有趣。否则，简单地获取 guid 的前 8-10 个字符或 guid 的 sha1/md5 哈希可能是您最好的选择。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-20T01:33:32.393

可能工作的最简单的事情是每次需要值时递增的计数器。八个（左填充零）数字为您提供 1 亿个可能的值，从 00000000 到 99999999（尽管您可能会插入空格或连字符以提高可读性，如 000-000-00）。

如果您需要超过 1 亿个值，您可以增加长度或在其他位置使用字母。使用 A0A0A0A0 到 Z9Z9Z9Z9 可为您提供超过 45 亿个可能的值 (4,569,760,000)。采用长整数并产生这样的编码是很简单的代码（最右边的数字为 10，最右边的数字为 10，然后最右边的字母为 26，等等）如果你有内存要刻录，最快的方法是将计数器转换为 mod 260 数组，并使用每个 mod 260 值作为索引到两个字符串数组（“A0”、“A1”、“A2”等到“A9”、“ B0”、“B1”等到“Z9”）。

base 36 的问题（在另一个回复中提到）是您不仅要担心读者混淆相似字符（一与 I，零与 O，二与 Z，五与 S），还要担心组合可能被读者视为拼写令人反感或淫秽的单词或缩写的相邻字母。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-20T01:05:58.360

您可能想尝试使用 CRC32 散列算法。CRC32 生成一个 8 个字符的字符串。

[http://en.wikipedia.org/wiki/Cyclic_redundancy_check](http://en.wikipedia.org/wiki/Cyclic_redundancy_check)

[http://textop.us/Hashing/CRC](http://textop.us/Hashing/CRC)

# java - 如何在 NetBeans 或其他 Java IDE 中按名称对类成员进行排序？

> ID：217257
> 
> 赞同：15
> 
> 时间：2008-10-20T00:58:29.903
> 
> 标签：java, sorting, netbeans, methods

我想在源代码中按名称对成员进行排序。有什么简单的方法吗？

我正在使用 NetBeans，但如果有其他编辑器可以做到这一点，请告诉我它的名称。

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2014-11-27T12:13:55.543

在 Netbeans 8.0.1 中：

```
Tools -> Options -> Editor -> Formatting -> Category: Ordering 
```

![Netbeans 成员排序](https://i.stack.imgur.com/7BxRT.png)

然后：

```
Source -> Organize Members 
```

![Netbeans 成员排序](https://i.stack.imgur.com/MO7Dc.png)

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-10-20T01:07:50.323

Eclipse 可以做到。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2012-09-05T17:52:32.363

这是在 Netbeans 7.3 中实现的：http: //netbeans.org/bugzilla/show_bug.cgi?id= [212528](http://netbeans.org/bugzilla/show_bug.cgi?id=212528)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-20T01:16:45.280

正如@PaulCroarkin 所说 - 使用 eclipse，或者您可以使用[Jalopy](http://jalopy.sourceforge.net/)作为构建的一部分，它将在此过程中对您的源文件进行各种神奇的格式化（这是否是一件好事还有待商榷）

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-23T03:51:49.180

Netbeans 允许您对导航器中的方法进行排序。就个人而言，我从未在代码中看到排序方法的意义。如果可能的话，我喜欢将可以一起工作的方法放在一起。例如，getter() 和 setter()。恕我直言，增量搜索或能够控制单击方法以导航到声明更有用。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-21T20:50:57.860

从 6.0/6.1 开始，此功能在内置工具中不可用。“导航器”视图旨在为您提供成员的有序索引。要查看导航器，请转到 Window->Navigating->Navigator 或按 Control-F7。

[考虑向Netbeans](http://www.netbeans.org/community/issues.html)提交功能增强。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2016-08-25T05:40:54.477

对于 C/C++ 模式，在 Navigator 窗口中右键单击方法名称，然后选择“按名称排序”或“按源排序”，选择您喜欢的一个:)

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2014-11-04T21:56:07.853

这是在 NetBeans 中执行此操作的简单方法：

1.  转到工具选项卡并选择选项。应出现选项窗口。
2.  单击编辑器并选择格式选项卡。
3.  为类别选择排序。排序是下拉类别列表中的最后一个元素。
4.  取消选中按可见性排序成员字段。此时只应检查“按字母顺序对组中的成员进行排序”。
5.  单击应用并退出选项窗口。现在您将全局设置为按字母顺序对成员进行排序。
6.  打开或选择要对成员进行排序的源文件。
7.  单击源选项卡（右上角）并选择组织成员。

就是这样。您的源文件应按字母顺序排列成员。

# java - 比较 Java 中的引用

> ID：217258
> 
> 赞同：16
> 
> 时间：2008-10-20T01:01:13.970
> 
> 标签：java

假设您重写了对象的 equals() 和 hashCode() 方法，以便它们使用对象的字段。

你如何检查两个引用是否指向同一个对象，也就是股票 equals() 方法？

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2008-10-20T01:08:17.060

在对象上使用`==`以执行身份比较。

这是默认实现`equals()`所做的，但通常会覆盖`equals()`以用作“等效内容”检查。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-20T01:07:24.410

这就是 == 运算符的作用。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-20T01:09:01.570

equals() 的默认行为是使用 == 运算符比较两个对象。因此，如果您想要默认的行为使用 ==，如果您想要覆盖的行为使用 equals()。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2019-01-10T11:45:51.083

如果您需要为 JUnit Assertion 执行此操作，您也可以使用`Assert.assertSame()`

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2016-07-27T09:47:17.893

使用 == 运算符，因为它与引用而不是内容进行比较，如果您想与内容进行比较，可以使用 equals() 方法。

# php - 代码生成缩进

> ID：217259
> 
> 赞同：5
> 
> 时间：2008-10-20T01:01:43.517
> 
> 标签：php, code-generation, metaprogramming

通常，程序员编写的代码会生成其他代码。

（技术术语是[元编程](http://en.wikipedia.org/wiki/Metaprogramming "维基百科关于元编程的文章")，但它比单纯的交叉编译器更常见；想想每个生成 HTML 的 PHP 网页或每个 XSLT 文件。）

我发现具有挑战性的一个领域是想出一些技术来确保手写源文件和计算机生成的目标文件都清楚地缩进以帮助调试*。*这两个目标似乎经常相互竞争。

我发现这在 PHP/HTML 组合中特别具有挑战性。我认为这是因为：

*   有时源文件中的 HTML 代码比生成的 PHP 代码多
*   HTML 文件往往比 SQL 语句长，需要更好的缩进
*   HTML 具有空间敏感特性（例如标签之间）
*   结果是比 SQL 语句更公开可见的 HTML，因此做合理工作的压力更大。

您使用什么技术来解决这个问题？

* * *

编辑：我接受至少有三个论点不费心生成漂亮的 HTML 代码：

*   增加了生成代码的复杂性。
*   与浏览器渲染没有区别；开发人员可以使用 Firebug 或类似工具来很好地查看它。
*   轻微的性能损失 - 增加了空白字符的下载时间。

我当然有时会生成代码而不考虑缩进（尤其是 SQL）。

然而，有一些论据推动了另一种方式：

*   在实践中，我发现我*确实*经常阅读生成的代码——有额外的步骤来访问它是不方便的。
*   HTML 有时会遇到一些空间敏感问题。

例如，考虑以下代码：

```
<div class="foo">
    <?php
        $fooHeader();
        $fooBody();
        $fooFooter();
    ?>
</div> 
```

它比下面的代码更清楚：

```
<div class="foo"><?php
        $fooHeader();
        $fooBody();
        $fooFooter();
?></div> 
```

但是，由于 HTML 中包含空格，它也具有不同的呈现方式。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-20T01:08:16.127

在更一般的情况下，我编写了生成 C++ 数据库接口代码的 XSLT 代码。虽然一开始我试图从 XSLT 输出正确缩进的代码，但这很快就变得站不住脚了。我的解决方案是完全忽略 XSLT 输出中的格式，然后通过[GNU indent](http://www.gnu.org/software/indent/)运行生成的非常长的代码行。这产生了一个格式合理的适合调试的 C++ 源文件。

我可以想象，在处理 HTML 和 PHP 等组合源时，问题会变得更加棘手。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-20T01:04:20.533

当生成代码支配生成代码时，我使用的一种技术是传递一个缩进参数。

例如，在 Python 中，生成更多的 Python。

```
def generateWhileLoop(condition, block, indentPrefix = ""):
    print indentPrefix + "while " + condition + ":"
    generateBlock(block, indentPrefix + "    ") 
```

或者，根据我的心情：

```
def generateWhileLoop(condition, block, indentLevel = 0):
    print " " * (indentLevel * spacesPerIndent) + "while " + condition + ":"
    generateBlock(block, indentLevel + 1) 
```

请注意假设`condition`是一小段文本适合在同一行上，而`block`在单独的缩进行上。如果这段代码不能确定子项是否需要缩进，这个方法就开始失效了。

此外，这种技术对于将相对少量的 PHP 注入 HTML 几乎没有那么有用。

[编辑澄清：我写了这个问题和这个答案。我想用一种我确实使用过并且有时很有用的技术来寻找答案，但是这种技术在典型的 PHP 编码中失败了，所以我正在寻找其他类似的想法。]

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-20T01:08:46.437

生成一个 AST，然后按顺序遍历它并发出格式正确的源代码。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-20T01:59:03.700

我发现在生成过程中忽略缩进是最好的。我编写了一个通用的“代码格式化”引擎，可以对所有输出的代码进行后处理。这样，我可以与生成器分开定义缩进规则和代码语法规则。这种分离有明显的好处。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-20T01:11:33.390

我同意奇思妙想的回答。

有时最好通过反转来解决问题。如果您发现自己生成了大量文本，请考虑使用少量智能生成代码将文本编写为模板是否更容易。或者，如果您可以将问题分解为您组装的一系列小模板，然后将每个模板作为一个整体缩进。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-20T01:21:22.167

用 PHP 制作网站，我发现混合使用 HTML 和特定功能的 PHP 是有问题的，它限制了概述并使调试更加困难。在这种情况下避免混合的解决方案是使用模板驱动的内容，例如[Smarty 。](http://www.smarty.net/manual/en/)除了更好的意图之外，内容模板对于其他事情也很有用，例如更快的修补。如果客户需要更改布局，则可以快速找到并修复该特定布局问题，而无需使用生成数据的功能性 PHP 代码（反之亦然）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-20T01:21:51.853

特别是关于 HTML 生成 - 为什么它很重要？

您花费大量时间传递缩进参数，并试图弄清楚您的嵌套深度等等。除了一般浪费时间（因为最终渲染输出没有区别），当您添加其他 HTML 标记并将页面包装在 div 等中时，您如何维护所有这些内容？

无论如何，安装[Firebug](http://www.getfirebug.com)（以及用于测试 IE 的[IE 开发人员工具栏](http://www.microsoft.com/downloads/details.aspx?familyid=e59c3964-672d-4511-bb3e-2d5e1db91038&displaylang=en)），它们都会以嵌套格式向您显示 HTML，并且您只需单击页面元素即可直接查看标记 - 比查看原始源 HTML 更有效输出。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-20T12:34:53.883

在 PHP/HTML 情况下，我尝试让每个代码片段在其源代码中始终缩进。这使代码在真正重要的地方保持可读性，并且*通常*具有生成可读的 HTML 输出的副作用。正如其他人所说，萤火虫负责其余的工作。

# c++ - 缺少 msvcr80.dll

> ID：217266
> 
> 赞同：11
> 
> 时间：2008-10-20T01:05:32.027
> 
> 标签：c++, windows, dll, dependencies

如果编译的库中缺少 C++ 运行时 msvcr80.dll，有没有办法确定使用哪个版本来创建库或让它在更高版本的 msvcr80.dll 上运行？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-10-20T02:25:42.320

VC80 SP1 CRT 可再发行包将安装 C 运行时的 RTM 和 SP1 版本`%SystemRoot%\WinSxS`（假设您使用的是 Windows XP 或 Vista；Windows 2000 不支持并行程序集）。如果您安装了 VC8，则 CRT 可再发行包位于`%ProgramFiles%\Microsoft Visual Studio 8\VC\redist`. 如果您没有安装 VC8，我认为您可以从 Microsoft.com 下载 CRT 可再发行包。

此外，要准确了解使用 VC8 或 VC9 构建的二进制文件需要什么 CRT 版本（例如 RTM 与 SP1），您可以提取清单：

```
mt.exe -inputresource:mydll.dll;#1 -out:mydll.dll.manifest 
```

寻找这样的东西：

```
<assemblyIdentity type="win32" name="Microsoft.VC90.CRT" version="9.0.21022.8" processorArchitecture="x86" publicKeyToken="1fc8b3b9a1e18e3b">
</assemblyIdentity> 
```

我的可执行文件需要 CRT 版本 9.0.21022.8。此版本号也嵌入在`WinSxS`子目录名称中（不幸的是它被哈希包围）：

```
D:>dir c:\windows\WinSxS\*VC90.CRT*
12/14/2007  02:16 AM    <DIR>          amd64_microsoft.vc90.crt_1fc8b3b9a1e18e3b_9.0.21022.8_none_750b37ff97f4f68b
12/14/2007  02:00 AM    <DIR>          x86_microsoft.vc90.crt_1fc8b3b9a1e18e3b_9.0.21022.8_none_bcb86ed6ac711f91 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-10-20T01:08:52.067

[Dependency Walker](http://www.dependencywalker.com/)将帮助您回答这个问题。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-08-08T21:39:19.520

如果您正在创作和分发上述 DLL，请考虑使用 Visual C++ 8.0 CRT 的合并模块作为安装程序的一部分。

我注意到在 Windows SDK 6.1 中有一个新的 mt.exe 工具和新的 Visual C++ CRT。我在 InstallShield 12 安装程序中使用合并模块作为先决条件并取得了巨大成功。

# java - java内存管理

> ID：217287
> 
> 赞同：5
> 
> 时间：2008-10-20T01:15:10.743
> 
> 标签：java, memory-leaks

我是一名 C++ 程序员，在找到 JPA 之后，我正在玩 java，这对于我当前的一些应用程序来说是神来之笔。从大学开始我就没有接触过java，我遇到了堆空间不足的问题。我使用下面的代码作为 jdbc/jpa/lucene 的不太严重的测试的主要部分，但我不断收到随机的 OutOfMemory 异常。

```
 EntityManager em = emf.createEntityManager();
        Query q = em.createQuery("select p from Product p" +
            " where p.productid = :productid");
        Connection con = DriverManager.getConnection("connection string");
        Statement st = con.createStatement();

        IndexWriter writer = new IndexWriter("c:\\temp\\lucene", new StandardAnalyzer(), IndexWriter.MaxFieldLength.LIMITED);

        ResultSet rs = st.executeQuery("select productid from product order by productid");
        while (rs.next()) {
            int productid = rs.getInt("PRODUCTID");
            q.setParameter("productid", productid);
            Product p = (Product)q.getSingleResult();

            writer.addDocument(createDocument(p));
        }

        writer.commit();
        writer.optimize();
        writer.close();

        st.close();
        con.close(); 
```

我不会发布所有的 createDocument 但它所做的只是实例化一个新的 org.apache.lucene.document.Document 并通过 add(new Field...) 等添加字段。总共大约有 50 个字段，大多数都很短长度为字符串（<32 个字符）。

在我的新手中，我正在做（或不做）一些完全愚蠢的事情会导致事情不被 GC 处理吗？

是否有关于 java 内存管理和 GC 的最佳实践？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-20T01:21:11.857

我没有看到任何明显不合适的地方。如果您正在使用一个非常大的数据库，您可以尝试通过使用`-Xmx n`JVM 调用中的选项来增加堆大小。这通常不是最好的解决方案——只有当你知道你的工作集大小实际上大于默认堆大小时才这样做。

您是否使用任何复杂的数据结构？如果对象之间存在循环引用，则可能会阻止垃圾收集器清理无法访问的对象。如果您有任何手写的数据结构，请确保您明确地清除对已删除对象的引用，而不是执行诸如递减大小变量之类的操作。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-22T09:41:59.067

可能您的永久代空间不足。检查您的堆栈跟踪是否包含类似 java.lang.OutOfMemoryError: PermGen

您可以使用 jvm 的此参数增加这一代的空间：-XX:MaxPermSize=128m

垃圾回收期间不考虑永久代中的对象。查看[sun 的此页面](http://java.sun.com/javase/technologies/hotspot/gc/gc_tuning_6.html)，了解有关垃圾收集和 JVM 中不同代对象的更多信息。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-20T01:28:17.723

试试 SAP 内存分析器。

[https://www.sdn.sap.com/irj/sdn/wiki?path=/display/Java/Java+Memory+Analysis](https://www.sdn.sap.com/irj/sdn/wiki?path=/display/Java/Java+Memory+Analysis)

这会读入转储文件并让您调查占用内存的内容。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-20T01:41:24.733

出色地...

长期使用 Java 和数据库（ postgresSQL mysql oracle 差异[示例](https://stackoverflow.com/questions/216601/postgressql-mysql-oracle-diferences#217230)>）的经验告诉我，我们在做这项工作时使用的 JDBC 驱动程序经常会出现问题。

我有一段代码需要 24/7 保持连接到数据库，并且由于驱动程序内存泄漏，JVM 总是会在某个时候阻塞。因此，我编写了代码来捕获抛出的特定异常，然后采取越来越激烈的措施，包括断开连接并重新连接，甚至在绝望中重新启动 JVM，没有任何工作可以解决问题。编写它是多么痛苦，但它一直有效，直到 DBMS 供应商推出了一个不会导致问题的新 JDBC 驱动程序......我实际上只是将代码留在原处，以防万一！

...所以，这可能不是你在做什么。

请注意，调用垃圾收集器是我使用的策略之一，但指标显示它很少有帮助。

此外，可能不清楚，但 ResultSets 保持与数据库引擎本身的持续连接，在许多情况下（除非明确设置）是双向的，即使您只是在阅读。而且，一些 JDBC 驱动程序让您请求单向连接，但撒谎并返回双向连接！小心这个！

因此，最好将 ResultSet 对象卸载到其他对象中以保存值并尽快删除 ResultSet 对象本身。

祝你好运。RTIII

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-22T09:29:09.407

Java 维护着几个不同的内存池，用完其中任何一个都可能导致可怕的 OutOfMermoryException。操作系统分配内存的问题也可能表现为 OOM。

您应该会看到详细的堆栈跟踪 - 或者可能是应用程序目录中的错误转储文件 - 这可能会提供有关问题的更多线索。

如果您使用一个不错的分析器 - 最近 Sun Java 6 JDK 附带的 JVisualVM 可能就足够了 - 您可以查看所有各种池并查看哪些池已用完。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-20T01:38:30.213

您的结果集中有多少项？如果有足够的记录，那么您将用完所有内存，因为在这种情况下没有任何垃圾收集，因为您正在对编写器执行 addDocument，它将保存对您正在创建的所有文档的引用。

# javascript - 嵌入式幻灯片/图像查看器？

> ID：217301
> 
> 赞同：1
> 
> 时间：2008-10-20T01:23:41.820
> 
> 标签：javascript, css, image-viewer

我在多个网站上遇到过这种事情，想知道它叫什么，有人知道吗？[这是一个屏幕截图。](http://twitpic.com/h77i/full "twitpic.com")

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-20T01:32:36.873

我认为那是[灯箱](http://www.huddletogether.com/projects/lightbox/)。

**编辑：**或[灯箱 2](http://www.lokeshdhakar.com/projects/lightbox2/)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-20T01:38:11.773

看起来像灯箱（或克隆），

看看这个[Lightbox Clone List](http://planetozh.com/projects/lightbox-clones/)，我个人很喜欢[jQuery lightBox 插件](http://leandrovieira.com/projects/jquery/lightbox/)...

# javascript - 确定数字数组中高低的最佳算法？

> ID：217316
> 
> 赞同：11
> 
> 时间：2008-10-20T01:40:22.487
> 
> 标签：javascript, algorithm

我在这里使用伪代码，但这是在 JavaScript 中。使用最有效的算法，我试图在给定正整数数组的情况下找到高点和低点。这是我想出的，但我认为这可能不是最好的，只是想知道是否有人有其他建议。

```
var low = 1;
var high = 1;
for ( loop numbers ) {
    if ( number > high ) {
        high = number;
    }
    if ( low == 1 ) {
        low = high;
    }
    if ( number < low ) {
        low = number;
    }
} 
```

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2008-10-20T01:47:21.273

将 high 和 low 初始化为第一个元素。比任意选择“高”或“低”数字更有意义。

```
var myArray = [...],
    low = myArray[0],
    high = myArray[0]
;
// start looping at index 1
for (var i = 1, l = myArray.length; i < l; ++i) {
    if (myArray[i] > high) {
        high = myArray[i];
    } else if (myArray[i] < low) {
        low = myArray[i];
    }
} 
```

或者，避免多次查找数组的需要：

```
for (var i = 1, val; (val = myArray[i]) !== undefined; ++i) {
    if (val > high) {
        high = val;
    } else if (val < low) {
        low = val;
    }
} 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-10-20T01:44:32.013

您必须及时执行此操作，`O(n)`因为您需要遍历所有 ( `n`) 元素来检查它们，因为任何一个元素都可能是最小值或最大值。（除非它们已经排序。）

换句话说，您需要遍历所有元素并像您一样进行最大和最小检查。

排序通常是最好的`O(n*log(n))`。因此，它比单次扫描 ( `O(n)`) 慢。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-10-20T01:47:51.427

您的示例几乎是最有效的算法，但显然当*所有*数字都小于 1 或大于 1 时它将不起作用。此代码将在这些情况下起作用：

```
var low = numbers[0]; // first number in array
var high = numbers[0]; // first number in array
for ( loop numbers ) {
    if ( number > high ) {
        high = number;
    }
    if ( number < low ) {
        low = number;
    }
} 
```

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-10-20T01:52:28.737

如果列表很小（其中“小”少于几千个元素）并且您不做太多（其中“多”少于几千次）没关系。 在您担心优化最大/最小算法之前，**首先分析您的代码以找到真正的瓶颈。**

现在回答你问的问题。

因为无法避免查看列表的每个元素，所以线性搜索是最有效的算法。它需要 N 时间，其中 N 是列表中元素的数量。在一个循环中完成所有操作比调用 max() 然后调用 min() 更有效（这需要 2*N 时间）。所以你的代码基本上是正确的，尽管它没有考虑负数。这是在 Perl 中。

```
# Initialize max & min
my $max = $list[0];
my $min = $list[0];
for my $num (@list) {
     $max = $num if $num > $max;
     $min = $num if $num < $min;
} 
```

排序然后抓取第一个和最后一个元素是效率最低的。它需要 N * log(N) 其中 N 是列表中的元素数。

最有效的最小/最大算法是每次从列表中添加或删除元素时重新计算最小/最大值的算法。实际上，缓存结果并避免每次进行线性搜索。花费在此上的时间就是列表更改的次数。最多需要 M 时间，其中 M 是无论您调用多少次都会更改的次数。

为此，您可能会考虑一个保持其元素有序的搜索树。根据您使用的树样式，获取该结构中的最小值/最大值是 O(1) 或 O(log[n])。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-10-20T04:13:44.003

虽然它仍然是一个 O(n) 算法，但您可以通过首先成对比较相邻元素，然后将较小的元素与最小值进行比较，将较大的元素与最大值进行比较，可以将其速度提高 25%（即比例常数为 3/2 对 2）。我不知道javascript，但这里是C++：

```
std::pair<int, int> minmax(int* a, int n)
{
  int low = std::numeric_limits<int>::max();
  int high = std::numeric_limits<int>::min();

  for (int i = 0; i < n-1; i += 2) {
    if (a[i] < a[i+i]) {
      if (a[i] < low) {
        low = a[i];
      }
      if (a[i+1] > high) {
        high = a[i+1];
      }
    }
    else {
      if (a[i] > high) {
        high = a[i];
      }
      if (a[i+1] < low) {
        low = a[i+1];
      }
    }
  }

  // Handle last element if we've got an odd array size
  if (a[n-1] < low) {
    low = a[n-1];
  }
  if (a[n-1] > high) {
    high = a[n-1];
  }

  return std::make_pair(low, high);
} 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-10-20T11:36:45.577

```
var numbers = [1,2,5,9,16,4,6];

var maxNumber = Math.max.apply(null, numbers);
var minNumber = Math.min.apply(null, numbers); 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-10-25T21:33:59.823

nickf 的算法并不是最好的方法。在最坏的情况下，nickf 的算法对每个数字进行 2 次比较，总共 2n - 2。

我们可以做得更好一些。当你比较两个元素 a 和 b 时，如果 a > b 我们知道 a 不是最小值，b 不是最大值。通过这种方式，我们可以使用所有可用信息来消除尽可能多的元素。为简单起见，假设我们有偶数个元素。

将它们分成对：（a1，a2），（a3，a4）等。

比较它们，将它们分成一组赢家和输家——这需要 n/2 比较，给我们两组大小 n/2。现在找到获胜者的最大值和失败者的最小值。

从上面看，找到 n 个元素的最小值或最大值需要 n-1 次比较。因此运行时间是：n/2（用于初始比较）+ n/2 - 1（获胜者的最大值）+ n/2 - 1（失败者的最小值）= n/2 + n/2 + n/2 -2 = 3n/2 - 2。如果 n 是奇数，我们在每个集合中都有一个元素，因此运行时间将为 3n/2

事实上，我们可以证明这是任何算法都可能解决这个问题的最快速度。

一个例子：

假设我们的数组是 1, 5, 2, 3, 1, 8, 4 分成对：(1,5), (2,3) (1,8),(4,-)。比较。获胜者是：（5、3、8、4）。输家是 (1, 2, 1, 4)。

扫描获胜者得到 8。扫描失败者得到 1。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-10-25T22:56:13.730

在 V8 上真实地尝试这些片段，Drew Hall 的算法运行时间是 nickf 的 2/3，正如预测的那样。使循环倒计时而不是倒计时将其减少到大约 59% 的时间（尽管这更依赖于实现）。仅经过轻微测试：

```
var A = [ /* 100,000 random integers */];

function minmax() {
    var low = A[A.length-1];
    var high = A[A.length-1];
    var i, x, y;
    for (i = A.length - 3; 0 <= i; i -= 2) {
        y = A[i+1];
        x = A[i];
        if (x < y) {
            if (x < low) {
                low = x;
            }
            if (high < y) {
                high = y;
            }
        } else {
            if (y < low) {
                low = y;
            }
            if (high < x) {
                high = x;
            }
        }
    }
    if (i === -1) {
        x = A[0];
        if (high < x) {
            high = x;
        } else if (x < low) {
            low = x;
        }
    }
    return [low, high];
}

for (var i = 0; i < 1000; ++i) { minmax(); } 
```

但是，伙计，它很丑陋。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-05-07T03:35:46.597

Javascript 数组具有本机排序函数，该函数接受用于比较的函数。您可以对数字进行排序，然后只取头部和尾部以获得最小值和最大值。

```
var sorted = arrayOfNumbers.sort(function(a, b) { return a - b; }),
    ,min = sorted[0], max = sorted[sorted.length -1]; 
```

默认情况下， sort 方法按字典顺序（字典顺序）进行排序，这就是为什么您必须传入一个函数才能使用它来获得数字排序。您传入的函数需要返回 1、-1 或 0 来确定排序顺序。

```
// standard sort function
function sorter(a, b) {
  if (/* some check */)
    return -1; // a should be left of b
  if (/*some other check*/)
    return 1; // a should be to the right of b
  return 0; // a is equal to b (no movement)
} 
```

对于数字，您只需从第一个参数中减去第二个即可确定顺序。

```
var numbers = [5,8,123,1,7,77,3.14,-5];

// default lexicographical sort
numbers.sort() // -5,1,123,3.14,5,7,77,8

// numerical sort
numbers.sort(function(a, b) { return a - b; }) // -5,1,123,3.14,5,7,77,8 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-10-20T02:56:38.607

我建议的唯一进一步优化是优化循环本身。在 JavaScript 中倒数比倒数要快。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2017-08-15T09:00:53.843

[使用扩展语法](https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Operators/Spread_operator)以 ES6 方式进行操作：

```
var arrNums = [1, 2, 3, 4, 5];
Math.max(...arrNums) // 5
Math.min(...arrNums) // 1 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-10-20T01:44:52.883

假设列表尚未排序，那是您能做的最好的事情。您可以通过执行以下操作（在伪代码中）节省自己的比较：

```
low = +INFINITY
high = -INFINITY
for each n in numbers:
    if n < low:
        low = n
    if n > high:
        high = n 
```

这是一个 O(n) 操作，基本上是你能做的最好的。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-11-11T18:23:48.837

该算法适用于 O(n) 并且不再需要额外的内存来存储元素......

```
enter code here
int l=0,h=1,index,i=3;
    if(a[l]>a[h])
                 swap(&a[l],&a[h]);
    for(i=2;i<9;i++)
    {
                                if(a[i]<a[l])
                                {
                                      swap(&a[i],&a[l]);  
                                }
                                if(a[i]>a[h])
                                {
                                             swap(&a[i],&a[h]);
                                }
    }
    printf("Low:  %d  High:  %d",a[0],a[1]); 
```

* * *

## 回答 #14

> 赞同：-6
> 
> 时间：2008-10-20T01:44:12.060

在蟒蛇中：

```
>>> seq = [1, 2, 3, 4, 5, 6, 7]
>>> max(seq)
7
>>> min(seq)
1 
```

# mysql - MySql 中的 IF 构造产生错误 #1064

> ID：217343
> 
> 赞同：1
> 
> 时间：2008-10-20T02:01:00.917
> 
> 标签：mysql

我正在尝试在 phpMyAdmin 中运行以下代码：

```
set @tagTokenNum=0;
select @tagTokenNum:=tag_token_id from tag_token where tag_token_name = 'XXX';
delimiter go
if @tagTokenNum is null then 
   insert into tag_token (tag_token_name) values ('XXX');
   select @tagTokenNum:=last_insert_id();
end if;
go 
```

我也试过这个没有分隔符语句和相应的 go。我收到错误消息“#1064 - 您的 SQL 语法有错误；请查看与您的 MySQL 服务器版本相对应的手册，以了解在 'if @tagTokenNum 为 null 然后插入 tag_token ...”附近使用的正确语法

据我所知，我正在遵循 MySql 中 IF 语句的正确语法。我对 Microsoft SQL 更熟悉，所以我完全有可能做错了什么。我很感激你能提供的任何帮助。谢谢。- 戴夫

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-20T05:14:53.710

您只能在存储过程中使用 if 语句的 ISTR，参考：mysql docs [...An IF ... END IF 块，就像在存储程序中使用的所有其他流控制块一样](http://dev.mysql.com/doc/refman/5.0/en/if-statement.html)...。

但是我认为您可以通过以下方式实现相同的目标：

```
insert into tag_token (tag_token_name) values ('XXX')
    ON DUPLICATE KEY UPDATE tag_token_name = tag_token_name;

select @tagTokenNum:=tag_token_id from tag_token where tag_token_name = 'XXX' 
```

# windows-vista - 任务管理器脚本

> ID：217345
> 
> 赞同：0
> 
> 时间：2008-10-20T02:03:02.473
> 
> 标签：windows-vista, taskmanager

我需要一个脚本，该脚本将在 Vista 中启动任务管理器，但包含来自所有用户的进程（例如，当您单击“显示所有用户的进程”时）。我不介意 UAC 中断，但我想节省一些时间并直接进入“所有用户”版本。

我不在乎本身是什么语言，只是在不加载任何额外内容的情况下在 Vista 上运行它的东西。

谢谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-20T02:22:42.323

*   在 vista 开始菜单搜索栏中，输入“taskmgr”（不带引号）。
*   当 taskmgr.exe 程序出现在结果中时，右键单击并选择“创建快捷方式”。
*   在您的桌面上，右键单击您的新快捷方式，然后在“快捷方式”选项卡下选择“高级”。
*   勾选“以管理员身份运行”。

现在，当您单击此 UAC 时会出现。在你告诉它运行后，它会向所有用户开放 :)

# asp.net-mvc - 为什么我的 HtmlHelper 扩展不起作用？

> ID：217350
> 
> 赞同：11
> 
> 时间：2008-10-20T02:06:08.833
> 
> 标签：asp.net-mvc, extension-methods, html-helper

我正在构建一个 ASP.Net MVC 网站。我决定将 Web、模型和控制器分离到同一个解决方案中的不同项目中，这些项目相互引用，而不是在一个项目中包含所有内容。

引用是这样的：

> Web ---[references]---> Controller ---[references]---> Model

现在我想向 HtmlHelper 类添加 2 个自定义方法——它们被称为“IncludeScript”和“IncludeStyle”。它们每个都接受一个字符串参数，并分别生成一个脚本或链接标签。

根据网络上的文档，我创建了一个扩展器类，并编写了这两个方法并编译了应用程序。

现在，当我进入 Public.Master 页面（这是我的主要母版页，也是我打算使用这些方法的地方之一）时，我可以输入如下代码：

`<%= Html.IncludeScript("\js\jquery.js") %>`

IntelliSense 采用 IncludeScript 方法并向我显示语法就好了。所以我希望一切都能正常工作。

但事实并非如此。

一切都可以编译，但只要我运行应用程序，就会从 Default.aspx.cs 的第 14 行收到以下运行时错误：

`c:\\Projects\\PhoneReel\\PhoneReel.Web\\Views\\Shared\\Public.Master(11): error CS0117: 'System.Web.Mvc.HtmlHelper' does not contain a definition for 'IncludeScript'`

这是发生错误的代码行：

`httpHandler.ProcessRequest(HttpContext.Current);`

任何想法这里可能出了什么问题？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-10-20T22:25:23.723

检查以确保我们的视图可以访问您的扩展的命名空间。在您看来，您需要：

```
<%@ Import Namespace="MyRootNamespace.NamespaceForMyHtmlHelperExtensions"%> 
```

或者在您的网络配置命名空间部分：

```
<add namespace="MyRootNamespace.NamespaceForMyHtmlHelperExtensions"/> 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-12-30T15:02:07.173

如果您使用**强类型**视图，并且您的扩展方法是 extends `HtmlHelper<object>`，它不会找到扩展。您必须**创建一个通用扩展器**来扩展`HtmlHelper<T>`.

```
public static string IncludeScript<T>(this HtmlHelper<T> html, string url) {
   return "<script type=\"text/javascript\" src=\"" + url + "\"></script>";
} 
```

然后你会看到你的扩展方法出现了。

我希望这会有所帮助。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-20T02:32:12.930

确保在您的页面中对您的扩展方法命名空间有一个导入指令。

否则，Visual Studio 可能会看到，但您的网站将无法看到。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-20T02:30:58.080

您确定编译器设置为 .NET Framework 3.5？当我无意中将编译器设置为 .NET Framework 2.0 时，这发生在我身上

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-21T19:04:21.990

在 IncludeScript 方法中，确保您扩展的是 System.Web.Mvc.HtmlHelper。在其他命名空间中可能存在 HtmlHelper。

# c# - 从.net（C＃）中的Webbrowser控件中检索选定的文本

> ID：217353
> 
> 赞同：18
> 
> 时间：2008-10-20T02:07:42.603
> 
> 标签：c#, winforms, webbrowser-control

我一直在试图弄清楚如何在我的浏览器控件中检索用户选择的文本，并且在挖掘了 msdn 和其他资源之后没有运气，所以我想知道是否有办法真正做到这一点。也许我只是错过了一些东西。

我感谢任何有关此的帮助或资源。

谢谢

* * *

## 回答 #1

> 赞同：44
> 
> 时间：2008-10-20T04:13:50.870

您需要使用 WebBrowser 控件的 Document.DomDocument 属性并将其转换为 Microsoft.mshtml 互操作程序集中提供的 IHtmlDocument2 接口。这使您可以访问在 IE 中实际运行的 Javascript 可用的完整 DOM。

为此，您首先需要将项目的引用添加到 Microsoft.mshtml 程序集，通常位于“C:\Program Files\Microsoft.NET\Primary Interop Assemblies\Microsoft.mshtml.dll”。可能有多个，请确保选择具有此路径的引用。

然后获取当前的文本选择，例如：

```
using mshtml;

...

    IHTMLDocument2 htmlDocument = webBrowser1.Document.DomDocument as IHTMLDocument2;

    IHTMLSelectionObject currentSelection= htmlDocument.selection;

    if (currentSelection!=null) 
    {
        IHTMLTxtRange range= currentSelection.createRange() as IHTMLTxtRange;

        if (range != null)
        {
            MessageBox.Show(range.text);
        }
    } 
```

有关从 .NET 应用程序访问完整 DOM 的更多信息，请参阅：

*   [演练：从 C# 访问 DHTML DOM](http://msdn.microsoft.com/en-us/library/aa290341(VS.71).aspx)

*   [IHTMLDocument2 接口参考](http://msdn.microsoft.com/en-us/library/aa752574(VS.85).aspx)

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2017-01-20T13:05:19.463

以防万一有人对不需要添加对 mshtml.dll 的引用的解决方案感兴趣：

```
private string GetSelectedText()
{
    dynamic document = webBrowser.Document.DomDocument;
    dynamic selection = document.selection;
    dynamic text = selection.createRange().text;
    return (string)text;
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-12-27T22:53:00.627

如果你只是使用下面的技术？

//将选中的文本复制到剪贴板

```
 Clipboard.Clear();
        SendKeys.SendWait("^(c)"); 
```

//从剪贴板中获取选中的文本

```
 string strClip = Clipboard.GetText().Trim();
        Clipboard.Clear(); 
```

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-10-20T03:07:54.887

我假设您有一个 WinForms 应用程序，其中包含一个打开网站的控件。

检查您是否可以在 Web 浏览器控件中注入/运行 JavaScript。使用 JavaScript，您将能够找出选择的内容并将其返回。否则，我怀疑 Web 浏览器控件是否知道其中选择的内容。

# c# - 将 NameValueCollection 绑定到 GridView？

> ID：217356
> 
> 赞同：9
> 
> 时间：2008-10-20T02:13:44.823
> 
> 标签：c#, asp.net, data-binding, namevaluecollection

我应该使用哪种集合将 NameValue 集合转换为可绑定到 GridView？直接做的时候没用。

**aspx.cs 中的代码**

```
 private void BindList(NameValueCollection nvpList)
  {
     resultGV.DataSource = list;
     resultGV.DataBind();
  } 
```

**aspx 中的代码**

```
<asp:GridView ID="resultGV" runat="server" AutoGenerateColumns="False" Width="100%">
    <Columns>
         <asp:BoundField DataField="Key" HeaderText="Key" />
         <asp:BoundField DataField="Value" HeaderText="Value" />
    </Columns>
</asp:GridView> 
```

任何提示都非常受欢迎。谢谢。X。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-20T02:21:17.553

您可以使用 Dictionary<string,string> 代替 NameValueCollection。由于 Dictionary<T,T> 实现了 IEnumerable，因此您可以这样使用 LINQ：

```
resultGV.DataSource = from item in nvpDictionary
                      select new { Key = item.Key, Value = item.Value };
resultGV.DataBind(); 
```

[编辑] 实际上你可以直接使用 Dictionary 作为：

```
resultGV.DataSource = nvpDictionary;
resultGV.DataBind(); 
```

如果它没有按照您想要的方式映射键/值，您可以随时返回 LINQ。LINQ 还允许您将字段重命名为您想要的任何名称。

[编辑] 如果您无法更改为使用 Dictionary<T,T>，请将 NameValueCollection 复制为方法中的 Dictionary 并绑定到它。

```
private void BindList(NameValueCollection nvpList)
{
   Dictionary<string,string> temp = new Dictionary<string,string>();
   foreach (string key in nvpList)
   {
      temp.Add(key,nvpList[key]);
   }

   resultGV.DataSource = temp;
   resultGV.DataBind();
} 
```

如果你经常这样做，你可以编写一个扩展方法来转换为字典，并使用它。

```
public static class NameValueCollectionExtensions
{
   public static Dictionary<string,string> ToDictionary( this NameValueCollection collection )
   {
      Dictionary<string,string> temp = new Dictionary<string,string>();
      foreach (string key in collection)
      {
          temp.Add(key,collection[key]);
      }
      return temp;
   }
}

private void BindList(NameValueCollection nvpList)
{
   resultGV.DataSource = nvpList.ToDictionary();
   resultGV.DataBind();
} 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-21T13:05:06.740

这有点棘手，因为[枚举](http://msdn.microsoft.com/en-us/library/system.collections.specialized.nameobjectcollectionbase.getenumerator.aspx)器只返回键。但是，您可以通过 Container.DataItem 获取 Key 值，然后查找 NameValueCollection 以获取值：

```
<asp:GridView id="gv" runat="server" AutoGenerateColumns="false">
   <Columns>
      <asp:TemplateField HeaderText="Key">
         <ItemTemplate><%# Container.DataItem %></ItemTemplate>
      </asp:TemplateField>
      <asp:TemplateField HeaderText="Value">
         <ItemTemplate>
            <%# ((NameValueCollection)gv.DataSource)[(string)Container.DataItem] %>
         </ItemTemplate>
      </asp:TemplateField>
   </Columns>
</asp:GridView> 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-21T12:41:36.600

最后，我使用了您的扩展实现中建议的解决方案，但没有扩展本身。

```
 private void BindList(NvpList nvpList)
  {
     IDictionary dict = new Dictionary<string, string>();

     foreach (String s in nvpList.AllKeys)
        dict.Add(s, nvpList[s]);

     resultGV.DataSource = dict;
     resultGV.DataBind();
  } 
```

也许做一些静态的帮助类，并在一个地方而不是多个地方为我做翻译。这个扩展非常方便...... :-)

谢谢。X。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-03-30T21:10:07.843

如果你有一个嵌套的`Repeater`（或者`GridView`我敢肯定），你需要改变[Mark Brackett 的答案](https://stackoverflow.com/questions/217356/bind-namevaluecollection-to-gridview/221797#221797)看起来像这样，否则你会得到一个运行时错误，关于无法找到一个名为*回复*_

```
<asp:Repeater ID="rpt" runat="server">
<ItemTemplate>
    <li>
        <%# Container.DataItem %>:
        <%# ((NameValueCollection)((Repeater)Container.Parent).DataSource)[(string)Container.DataItem] %>
    </li>    
</ItemTemplate>
</asp:Repeater> 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-08-13T10:56:22.763

我发现最好使用 StringDictionary 进行数据绑定和访问键和值

```
Dim sDict as New StringDictionary
sDict.Add("1","data1")
sDict.Add("2","data2")
sDict.Add("3","data3")
...

CheckBoxList1.DataSource = sDict
CheckBoxList1.DataValueField = "key"
CheckBoxList1.DataTextField = "value"
CheckBoxList1.DataBind() 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-03-29T17:19:39.870

我有一个类似的问题，涉及将字典（实际上是 SortedDictionary）绑定到 GridView 并想要重命名列。最终对我有用的是一些更容易阅读的东西。

```
<asp:GridView ID="gv" runat="server" AutoGenerateColumns="False">
  <Columns>
    <asp:TemplateField HeaderText="Attribute">
      <ItemTemplate>
        <%# ((KeyValuePair<string,string>)Container.DataItem).Key %>
      </ItemTemplate>
    </asp:TemplateField>
    <asp:TemplateField HeaderText="Value">
      <ItemTemplate>
        <%# ((KeyValuePair<string,string>)Container.DataItem).Value %>
      </ItemTemplate>
    </asp:TemplateField>
  </Columns>
</asp:GridView> 
```

这通过获取 Container.DataItem（GridView 试图显示的当前项目）将其强制转换为实际数据类型 (KeyValuePair)，然后显示该项目的所需属性来工作。

# javascript - IE7 和状态栏

> ID：217357
> 
> 赞同：1
> 
> 时间：2008-10-20T02:14:18.457
> 
> 标签：javascript, internet-explorer-7, popup, statusbar

有没有办法通过 IE7 中的 javascript 生成一个隐藏状态栏的新窗口？

我已将 Intranet 应用程序添加为受信任的站点。不知道我还能用什么来尝试。这是我的 JS

```
window.open("http:/localhost/start.html", "MyApp", "left=0, top=0, width=" + screen.width + "," +
                              "height=" + screen.height + ", scrollbars=yes, " + 
                              "resizable=yes, location=no, menubar=no, titlebar=no, " + "toolbar=no, status=no"); 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-20T15:47:23.713

**不。** 微软决定**“以安全的名义”**（[IE 博客链接](http://blogs.msdn.com/ie/archive/2006/08/25/719355.aspx)）他们将强制状态栏显示在 IE7 的弹出窗口上。（他们还强制使用~250px 的新最小宽度，而不是以前的 100px - 这样他们就可以在只读下拉位置栏中显示 url）

对不起。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-20T02:41:32.443

您的代码对我有用，[这是一个屏幕截图。](http://img511.imageshack.us/my.php?image=workshq7.png)

[](http://img511.imageshack.us/my.php?image=workshq7.png)

[IE7 如何呈现没有状态栏的弹出窗口的示例。http://img511.imageshack.us/img511/7757/workshq7.th.png](http://img511.imageshack.us/my.php?image=workshq7.png)

请注意，实验是在本地文件系统上完成的，“保护模式”完全关闭。如果它对您不起作用，我猜您的安全设置仍然很高。出于安全原因，通常会阻止通过 JavaScript 修改浏览器 UI，因此不应依赖它。

# debugging - 你认为调试（系统故障排除）是程序员可以拥有的最重要的可衡量的与技术无关的技能之一吗？

> ID：217374
> 
> 赞同：6
> 
> 时间：2008-10-20T02:30:14.807
> 
> 标签：debugging, language-agnostic

程序员可以拥有许多技能（理解问题、提出好的问题、良好的设计技能等）。

我认为**系统调试技能**非常有价值。这种调试任何技术系统的一般技能（从遥控器中的电池没电到来自邻居的业余无线电的信号干扰）。

这是我教计算机编程时给学生的方法：

1.  定义问题（当我执行 XYZ Repro 步骤时，我得到 ABC 症状）
2.  确定测试范围并分成几个部分。
3.  使用排除法测试每个部分，以找到导致问题的部分。
4.  如果需要，将部分分解为小节。
5.  分析导致问题的小节。
6.  使固定。
7.  使用“重现症状的步骤”的文本。

怎么想？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-20T02:46:59.360

如果您将“故障排除”定义为包括“调试”，那么是的，这很关键！

编辑：根据您的编辑，您列出的自上而下的消除过程是系统的并且非常有价值。

另一种技术是向后推理：

*   从最后开始，使用产生症状/错误的变量/调用
*   从那里向后推理 - 是什么导致了这个不正确的值或错误的调用？
*   继续在逻辑中向后追溯，直到找到罪魁祸首

当有很多可能导致问题的前馈路径/可能性时，这很有用，但具有不需要调试器或跟踪来找出最可能的原因的优势。

另一种技术是通常的嫌疑人技术，您可以从最后一次触及或给您带来最多问题的代码的任何部分开始调查，以查看其中是否有某些更改导致新问题

另一种技术是坐下来思考哪些情况可能会产生观察到的错误/行为/价值。当您赶时间并且不想系统地扫描很多地方但要求您已经对系统有透彻的了解时，此技术很有用。当有问题的错误/行为是由于设计缺陷或疏忽而不是编码错误时，这很有用。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-20T03:06:10.897

计算机世界中的故障排除通常意味着您在百思买柜台后面的人所做的基本的“我的电脑不工作-你能修复它”类型的工作。我认为您的意思是调试，虽然两者都很有价值（我很高兴我不需要运行来支持我的计算机的每个故障）调试对于开发人员来说无疑是更关键的技能。无论是哪种语言，知道如何跟踪、识别和消除错误都是程序员在其职业生涯中将要做的最困难和最常执行的任务之一。

话虽如此，我实际上想说的是，我认为我的武器库中最重要的技能是毅力。当我的经理让我执行一项任务时，他们知道无论如何我都会完成它。时期。无论遇到什么障碍，无论时间表是什么，无论最终目标是什么，我都会尽最大努力满足他们的期望，直到工作完成或他们对结果感到满意。顺便说一句，这是一个非常重要的区别！最初的目标并不总是可行的，如果不可行，我的工作就是确保管理层确切知道为什么不可行以及他们的替代方案是什么。提供这些替代方案很重要。没有人愿意听到，“好吧，对不起。你真的完蛋了。” 为问题提供不同的解决方案是坚持不懈的一部分。除非你得到指示，否则你永远不会放弃。

简而言之，在我看来，能够在不分心或放弃的情况下完成项目，是您可以做的最有效的事情，可以让自己与众不同并让自己成为雇主的理想人选。相信我，这太难了！但这就是它的价值所在！:)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-20T03:16:30.407

故障排除技巧至关重要。通常，一个好的疑难解答者的问题多于答案。他们还将有一个有条不紊的方法来测试他们发现的问题的解决方案。他们不会害怕自己不知道的事情，也不会因为问“愚蠢”的问题而感到尴尬。他们学得很快。程序员的所有优点。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-20T03:05:01.180

“懒惰”

[谷歌上懒惰的程序员搜索](http://www.google.com.au/search?sourceid=navclient&ie=UTF-8&rlz=1T4SKPB_enUS269AU269&q=lazy+programmer)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-20T05:15:17.110

当我离开大学时，我认为成为一名优秀程序员的关键是第一次编写完美的（功能和形式）代码。出现的任何问题都是因为我不够好，或者因为我不够细心，或者因为我想得不够远，或者没有花足够的时间计划。如果我能在白板上解决所有问题，我将成为一名出色的程序员。

我在调试器上开始了我的编程生涯。几年之后，我确信对于一个成功的程序员来说最重要的技能就是调试。我承认我第一次写不出完美的代码，其他人也一样。我把所有的时间都花在白板上从来没有产生过有效的代码，但这确实花了很长时间。相反，我只是写一些看似合理的东西，然后进行调试。没有办法像我希望的那样编写出色的代码，但我可以非常擅长修复损坏的代码。

那行得通。我能够创建运输软件，而只花费了计划的 2 倍或 3 倍。我能够在发货之前修复几乎所有重要的错误，而不会在此过程中引入太多其他错误。（我畏缩写那个！）。

然后我阅读了 Fowler 的[重构](http://martinfowler.com/books.html#refactoring)。它彻底改变了我的想法。它告诉我，虽然我第一次无法编写简单、清晰、干净、可维护的代码，但我可以做到。我第一次无法在白板上正确地完成我的设计的原因是，除非你在代码中看到它，否则你无法判断它是否正确。只有这样，您才能决定出了什么问题以及如何解决它。关键似乎是尽快进入代码，同时尽可能便宜和安全地在编写代码后修复代码设计。

这使我进入了极限编程，在那里我了解到通过编写结构良好的代码，其中类小、简单且易于理解，我还可以拥有简单、易于编写和易于通过的单元测试。当您像这样编写代码时，单元测试失败会很快将您指向问题的根源。如果我做对了，跟踪问题就很容易了，以至于我很少接触调试器。

现在，我不是代码天使。我很少结对程序，也不总是先编写单元测试。我责备我的父母。哦，事实上我的雇主和我的工具并没有我希望的那样支持。果然，我为此付出了代价。然后我抽出调试器，并应用那些旧的调试技能，同时希望我刚刚编写了更好的单元测试。

还有一个调试很关键的地方：在生产中。当您在野外查看问题时，能够在调试器中快速诊断它是非常强大的。我可以学习编写擅长自我诊断的程序来预测弱点，但是对于不可预测的问题，我认为我总是需要一个调试器。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-20T02:35:25.840

我认为承诺更重要。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-20T02:59:08.680

这很重要，但对我来说故障排除/调试只是：

1.  理解问题。了解模块如何协同工作。或者知道您对问题/模块不了解的内容；
2.  提出正确的问题
3.  并采取合乎逻辑的步骤解决问题

所以，是的，这很重要，但与你提到的其他人相去不远。我会先测量（1）。故意使某些部分含糊不清。他应该能够意识到这一点。下一步是（2）他提出了正确的问题。然后非随机地攻击问题（3）。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-20T03:03:27.437

知道如何：

*   学习
*   研究
*   接受你什么都不知道
*   将过去经验中的知识应用于您当前的问题
*   而且，最重要的是，探索您认为可能已经解决的问题的替代方案。您可能会遇到更好的解决方案。

如果这就是故障排除的原因，那么是的，这非常重要：D

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-20T16:10:37.943

我喜欢我的一位前任老板如何将这两个部分定义为开发人员，这解释了为什么简单的“是”在这里可能不够：

1) 编程——能够设计和编写代码。

2) 故障排除 - 调试、调查问题以确定是代码、数据还是网络问题，修复错误。

# sql-server - 如何在 NTEXT SQL Server 列上使用 LEFT？

> ID：217377
> 
> 赞同：6
> 
> 时间：2008-10-20T02:32:28.623
> 
> 标签：sql-server

如何在 SQL Server NTEXT 列上使用 LEFT 函数（或等效函数）？

基本上我正在构建一个 GridView，我只想从 NTEXT 的描述列中返回前 100 个左右的字符。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-20T02:39:14.973

选择 CAST(ntext_col AS nvarchar(100)) 作为 ntext_substr FROM ...

[编辑] 最初让它将 CAST 的 LEFT(N,100) 返回到 nvarchar(MAX)，CASTing 将截断，因为需要 LEFT，这就足够了。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2012-11-19T15:24:07.170

您可以使用[SUBSTRING 函数](http://msdn.microsoft.com/en-us/library/ms187748%28v=sql.105%29.aspx)，它“返回字符、二进制、文本或图像表达式的一部分”：

```
SUBSTRING ( value_expression , start_expression , length_expression ) 
```

因此，要从`Description`NTEXT 列中选择前 100 个字符，您可以使用如下内容：

```
SELECT SUBSTRING(Description, 1, 100) as truncatedDescription FROM MyTable; 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-20T02:36:45.090

您必须先将其转换为 VARCHAR(MAX)。

# c# - 如何从 C# 中的类访问表单方法和控件？

> ID：217389
> 
> 赞同：26
> 
> 时间：2008-10-20T02:42:47.853
> 
> 标签：c#, winforms

我正在开发一个 C# 程序，现在我有一个`Form`和几个类。我希望能够从我的班级访问一些`Form`控件（例如 a ）。`TextBox`当我尝试更改`TextBox`班级中的文本时，出现以下错误：

> 非静态字段、方法或属性“Project.Form1.txtLog”需要对象引用

如何访问`Form1.cs`我的一个类中的方法和控件？

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2008-10-20T02:50:41.940

您正在尝试访问类而不是对象。该声明可能会让初学者感到困惑，但您实际上是在尝试通过拿起房屋计划中的门来打开房屋的门。

如果你真的想直接从一个类（你不想）访问表单组件，你会使用实例化你的表单的变量。

根据您想要走的方式，您最好将控件的文本或其他任何内容发送到您的类中的方法，例如

```
public void DoSomethingWithText(string formText)
{
   // do something text in here
} 
```

或在表单类上公开属性并在其中设置表单文本 - 例如

```
string SomeProperty
{
   get 
   {
      return textBox1.Text;
   }
   set
   {
      textBox1.Text = value;
   }
} 
```

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-10-20T03:12:40.790

另一种解决方案是将文本框（或要修改的控件）传递给将其作为参数进行操作的方法。

```
public partial class Form1 : Form
{
    public Form1()
    {
        InitializeComponent();
    }

    private void button1_Click(object sender, EventArgs e)
    {
        TestClass test = new TestClass();
        test.ModifyText(textBox1);
    }
}

public class TestClass
{
    public void ModifyText(TextBox textBox)
    {
        textBox.Text = "New text";
    }
} 
```

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-10-20T02:45:55.477

1.  您必须引用表单对象才能访问其元素
2.  必须将元素声明为 public 才能让另一个类访问它们
3.  不要这样做——你的班级必须对你的表单是如何实现的了解太多；不要在表单类之外公开表单控件
4.  相反，在您的表单上创建公共属性以获取/设置您感兴趣的值
5.  发布有关您想要什么以及原因的更多详细信息，听起来您可能正朝着与良好封装实践不一致的方向前进

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-20T02:47:28.063

您需要访问对象....您不能简单地询问表单类....

例如...

你会做一些事情，比如

```
Form1.txtLog.Text = "blah" 
```

代替

```
Form1 blah = new Form1();
blah.txtLog.Text = "hello" 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2010-02-13T04:42:32.573

如果表单首先启动，在表单加载处理程序中，我们可以实例化我们类的副本。我们可以拥有引用我们想要引用的任何控件的属性。将对表单“this”的引用传递给类的构造函数。

```
public partial class Form1 : Form
{
    public ListView Lv
    {
        get { return lvProcesses; }
    }

    public Form1()
    {
        InitializeComponent();
    }

    private void Form1_Load(object sender, EventArgs e)
    {
        Utilities ut = new Utilities(this);
    }
} 
```

在您的类中，来自表单的引用被传递到构造函数并存储为私有成员。此表单引用可用于访问表单的属性。

```
class Utilities
{
    private Form1 _mainForm;
    public Utilities(Form1 mainForm)
    {
        _mainForm = mainForm;
        _mainForm.Lv.Items.Clear();
    }
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-20T02:50:49.773

您需要将表单类中的成员设为公共的，或者，如果服务类在同一个程序集中，则设为内部的。Windows 控件的可见性可以通过它们的修饰符属性来控制。

请注意，将服务类显式绑定到 UI 类通常被认为是一种不好的做法。相反，您应该在服务类和表单类之间创建良好的接口。也就是说，对于学习或只是一般地乱搞，如果您为服务类公开表单成员，地球不会偏离它的轴心。

rp

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2010-12-09T18:28:55.127

我对 c# 比较陌生，对 stackoverflow 来说是全新的。无论如何，关于如何从一个类访问表单上的控件的问题：我只是使用了表单的 ControlCollection (Controls) 类。

```
 //Add a new form called frmEditData to project.
        //Draw a textbox on it named txtTest; set the text to
        //something in design as a test.
        Form frmED =  new frmEditData();
        MessageBox.Show(frmED.Controls["txtTest"].Text); 
```

为我工作，也许对这两个问题都有帮助。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2014-01-02T13:19:46.607

只是你可以发送表格来上课

```
Class1 excell = new Class1 (); //you must declare this in form as you want to control

excel.get_data_from_excel(this); // And create instance for class and sen this form to another class 
```

在您创建 CLASS1 时在 CLASS 内部

```
class Class1
{
    public void get_data_from_excel (Form1 form) //you getting the form here and you can control as you want
    {
        form.ComboBox1.text = "try it"; //you can chance Form1 UI elements inside the class now
    }
} 
```

重要提示：但您不能忘记您已将修饰符表单属性声明为 PUBLIC，并且您可以访问其他方式，您无法从类中看到表单中的控件

# asp.net - XSD 元素到 ASP.NET 中的表单

> ID：217395
> 
> 赞同：2
> 
> 时间：2008-10-20T02:48:04.597
> 
> 标签：asp.net, webforms, xsd, input, elements

是否有将 XSD 转换为输入表单（ASP.NET C#）的标准方法，以便以后每当从 XSD 添加/删除新字段时，页面上的字段会分别自动显示或消失，这是什么东西哪些需要内部开发我认为必须有一种方法来序列化/反序列化并生成表单？任何地狱将不胜感激..

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-20T03:03:27.983

我不认为有任何内置的东西可以使这完全自动化。但是，您可以非常接近。Visual Studio 包含一个名为 xsd.exe 的命令行程序，可用于从 xsd 文档自动创建类定义。一旦有了该类定义，您就可以通过 ObjectDataSource 组件和 DetailsView 控件将其连接到表单。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-20T03:02:42.463

假设：您正在使用 XML，因为目前它对您来说更简单。

想法：由于您想创建一个表单来操作数据，我猜您可能对 SQL 而非 XML 持开放态度。情况可能并非如此，但如果您有数据库后端而不是 XML/XSD 后端，您可能会找到更多工具来帮助您。（此外，还有一些方法可以将数据从一种转换为另一种）。

有一些工具可以从 ASP.NET 中的数据库创建表单。例如，SubSonic 有一个自动脚手架模块，可以让您创建一个只知道其模式的数据库管理器。如果架构发生变化，只需让 SubSonic 重新生成其文件，您的表单就会被修改。它并不完美，但可能会有很长的路要走，具体取决于您的需求。

选项 1）您可以从 XSD 创建数据库模式（[如何从 XSD 文件创建数据库表？](https://stackoverflow.com/questions/138575/how-can-i-create-database-tables-from-xsd-files)）并从那时起使用 SubSonic。这可能比你原来的问题更痛苦......只有你知道。

选项 2) 破解 SubSonic 脚手架，使其支持您的底层 XSD/XML 而不是数据库。您可能可以重用他们的许多基础设施（SubSonic 是开源的）来从 XSD 生成表单。

祝你好运！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-31T15:37:10.007

好吧，我不得不说 ObjectDataSource 不是一个坏主意，但是如果您有嵌套元素，这将不起作用。除此之外，对于嵌套元素，您还将在 DetailsView 中拥有所有“..FieldSpecified”布尔字段。

我仍在试图弄清楚如何使用 XSD 文件生成 ASP.NET 表单，而不必输入所有内容，这是猴子的工作。

有人已经遇到过这个问题吗？

PS：另一种方法是使用 InfoPath，但这需要许可软件作为网络表单运行......

# javascript - 如何在 MVC 下使用 Lightbox

> ID：217414
> 
> 赞同：2
> 
> 时间：2008-10-20T03:05:51.037
> 
> 标签：javascript, model-view-controller, lightbox2

我是 Lightbox2 库的忠实拥护者，过去曾在 MVC 项目中使用过它。在过去，我记得 Lightbox2 对脚本、css 和图像所在的路径很挑剔。我记得特别需要将所有内容放在页面路径的子目录中，否则它将无法正常工作。

在非 MVC 应用程序中，这种方法很好，但现在我发现自己正在处理 MVC 应用程序，并且页面的 URL 可能与目录结构无关。因此，按照以下说明链接到 Lightbox2：

```
<script type="text/javascript" src="js/prototype.js"></script>
<script type="text/javascript" src="js/scriptaculous.js?load=effects,builder"></script>
<script type="text/javascript" src="js/lightbox.js"></script> 
```

显然行不通。

我尝试将绝对路径放入给我效果的 JavaScript，只是没有图像。我怀疑 JavaScript“知道”它的图像在哪里，但找不到它们。

有没有人在 MVC 环境中使用 Lightbox2 取得成功？也许只是成功地将 Lightbox2 部署到非子目录？

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-20T03:32:20.813

我相信 Lightbox 假设您的结构如下：

```
/图片
    上一个标签.gif
    下一个标签.gif
    加载.gif
    关闭标签.gif
/css
    灯箱.css
灯箱.js

```

您可以打开 lightbox.js 并找到：

```
fileLoadingImage:        'images/loading.gif',     
fileBottomNavCloseImage: 'images/closelabel.gif', 
```

在 lightbox.css 中找到：

```
#prevLink:hover, #prevLink:visited:hover { background: url(../images/prevlabel.gif) left 15% no-repeat; }
#nextLink:hover, #nextLink:visited:hover { background: url(../images/nextlabel.gif) right 15% no-repeat; } 
```

随心所欲。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2015-02-18T10:15:25.770

```
<script src="~/LightBox/js/jquery.js"></script>

<script src="~/LightBox/js/jquery.lightbox-0.5.min.js"></script>

<a title="Title here" class="lightbox" href="~/LightBox/images/lightbox-btn-close.gif">click</a>

<script type="text/javascript">
    $(function () {
        $('a.lightbox').lightBox();//.lightBox(); // Select all links with lightbox class
    });
</script> 
```

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-10-20T03:30:13.873

我们在这里讨论的是哪个 MVC 框架？虽然我不熟悉那个特定的灯箱库，但我强烈建议您找出通过站点根目录中的绝对路径引用 javascript 文件的正确方法：

```
 <script type="text/javascript" src="/js/prototype.js"> 

```

如果你能弄清楚如何让它工作，我敢打赌它会解决你的图像问题。

此外，在您的网站上到处乱扔相同的 javascript 文件的副本是个坏主意。除了明显的混乱问题之外，浏览器将不得不一遍又一遍地下载相同的文件，而不是从缓存中读取它们，因为它们位于不同的 URL。

# php - 理想的 PHP 会话大小？

> ID：217420
> 
> 赞同：17
> 
> 时间：2008-10-20T03:09:37.427
> 
> 标签：php

我有一个大约 400 个字段的 PHP 表单（抵押应用程序），网站上的流量会很低。

进入 MySQL 数据库的 400 个字段的理想会话大小是多少？

我在`php.ini`什么设置？

我应该设置什么我想念的？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-10-20T03:33:22.760

会话的大小没有限制，但是 PHP 可以占用的内存有限制：http: [//ca.php.net/manual/en/ini.core.php#ini.memory-limit](http://ca.php.net/manual/en/ini.core.php#ini.memory-limit)

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-10-20T03:21:23.673

好吧，就我个人而言，我之前有过非常大的会议，问题很少。可能我以前拥有的最大大小约为 10MB。这不是最佳的，但即使是这么大的脚本，我也没有遇到过慢脚本的问题。我不会担心会话会变得很大，但我会尽量控制它。我的理论是，如果将其保留在会话中使其比每次查询数据库（例如在搜索的情况下）要快得多，那么我就去做。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2010-05-08T07:41:42.650

不建议在会话中存储大量数据。正如其他人所指出的，从数据库中复制数据并不是一个想法。即使您确实需要某种缓存机制，也不会将数据存储在会话中。问题是 PHP 会为每个请求重写会话数据。众所周知，写入磁盘是一个相当缓慢的操作。

如果您确实需要这样做，请将数组序列化并将其存储在单独的文件中。

如果您只需要 10 页中的 1 个序列化数据，则只需在 10 页中解压一次。会话当然是为每个请求打包/拆包。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2012-10-16T14:07:36.753

您还应该检查，post_max_size，max_input_vars（默认为 1000，所以您没问题）

# php - 在 PHP 中为用户创建一个 CSV 文件

> ID：217424
> 
> 赞同：225
> 
> 时间：2008-10-20T03:11:46.533
> 
> 标签：php, csv, download, http-headers

我在 MySQL 数据库中有数据。我正在向用户发送一个 URL，以将他们的数据作为 CSV 文件取出。

我已经涵盖了链接、MySQL 查询等的电子邮件。

当他们单击链接时，我怎样才能弹出一个窗口来下载带有 MySQL 记录的 CVS？

我已经掌握了获取记录的所有信息。我只是不知道如何让 PHP 创建 CSV 文件并让他们下载扩展名为 .csv 的文件。

* * *

## 回答 #1

> 赞同：477
> 
> 时间：2011-06-27T13:43:09.017

```
header("Content-Type: text/csv");
header("Content-Disposition: attachment; filename=file.csv");

function outputCSV($data) {
  $output = fopen("php://output", "wb");
  foreach ($data as $row)
    fputcsv($output, $row); // here you can change delimiter/enclosure
  fclose($output);
}

outputCSV(array(
  array("name 1", "age 1", "city 1"),
  array("name 2", "age 2", "city 2"),
  array("name 3", "age 3", "city 3")
)); 
```

[php://输出](http://php.net/manual/en/wrappers.php.php#refsect2-wrappers.php-unknown-unknown-unknown-descriptioq)
[fputcsv](http://php.net/manual/en/function.fputcsv.php)

* * *

## 回答 #2

> 赞同：292
> 
> 时间：2008-10-20T03:15:36.633

尝试：

```
header("Content-type: text/csv");
header("Content-Disposition: attachment; filename=file.csv");
header("Pragma: no-cache");
header("Expires: 0");

echo "record1,record2,record3\n";
die; 
```

ETC

编辑：这是我用来选择性地编码 CSV 字段的代码片段：

```
function maybeEncodeCSVField($string) {
    if(strpos($string, ',') !== false || strpos($string, '"') !== false || strpos($string, "\n") !== false) {
        $string = '"' . str_replace('"', '""', $string) . '"';
    }
    return $string;
} 
```

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2012-02-14T19:07:00.847

这是@Andrew 发布的 php.net 函数的改进版本。

```
function download_csv_results($results, $name = NULL)
{
    if( ! $name)
    {
        $name = md5(uniqid() . microtime(TRUE) . mt_rand()). '.csv';
    }

    header('Content-Type: text/csv');
    header('Content-Disposition: attachment; filename='. $name);
    header('Pragma: no-cache');
    header("Expires: 0");

    $outstream = fopen("php://output", "wb");

    foreach($results as $result)
    {
        fputcsv($outstream, $result);
    }

    fclose($outstream);
} 
```

它真的很容易使用并且与 MySQL(i)/PDO 结果集一起工作得很好。

```
download_csv_results($results, 'your_name_here.csv'); 
```

`exit()`如果您完成了页面，请记住在调用它之后。

* * *

## 回答 #4

> 赞同：16
> 
> 时间：2013-03-14T23:32:07.090

除了已经说过的所有内容之外，您可能还需要添加：

```
header("Content-Transfer-Encoding: UTF-8"); 
```

在处理包含多种语言的文件（例如人名或城市）时，它非常有用。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2008-10-20T03:16:29.907

创建您的文件，然后使用正确的标题返回对它的引用以触发另存为 - 根据需要编辑以下内容。将您的 CSV 数据放入 $csvdata。

```
$fname = 'myCSV.csv';
$fp = fopen($fname,'wb');
fwrite($fp,$csvdata);
fclose($fp);

header('Content-type: application/csv');
header("Content-Disposition: inline; filename=".$fname);
readfile($fname); 
```

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2011-12-10T09:07:05.733

我知道，该线程有点旧，但供将来参考和像我一样的菜鸟：

这里的其他人都解释了如何创建 CSV，但错过了问题的一个基本部分：如何链接。为了链接到 CSV 文件的下载，您只需链接到 .php 文件，该文件又以 .csv 文件的形式响应。PHP 标头就是这样做的。这可以实现很酷的东西，例如向查询字符串添加变量并自定义输出：

```
<a href="my_csv_creator.php?user=23&amp;othervariable=true">Get CSV</a> 
```

my_csv_creator.php 可以使用查询字符串中给出的变量，例如使用不同的或自定义的数据库查询、更改 CSV 的列、个性化文件名等等，例如：

```
User_John_Doe_10_Dec_11.csv 
```

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2013-07-01T18:05:14.743

这是一个使用 PDO 并包含列标题的完整工作示例：

```
$query = $pdo->prepare('SELECT * FROM test WHERE id=?');
$query->execute(array($id));    
$results = $query->fetchAll(PDO::FETCH_ASSOC);
download_csv_results($results, 'test.csv'); 
exit();

function download_csv_results($results, $name)
{            
    header('Content-Type: text/csv');
    header('Content-Disposition: attachment; filename='. $name);
    header('Pragma: no-cache');
    header("Expires: 0");

    $outstream = fopen("php://output", "wb");    
    fputcsv($outstream, array_keys($results[0]));

    foreach($results as $result)
    {
        fputcsv($outstream, $result);
    }

    fclose($outstream);
} 
```

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2009-11-17T15:11:23.997

首先将数据制作为以逗号为分隔符的字符串（用“，”分隔）。像这样的东西

```
$CSV_string="No,Date,Email,Sender Name,Sender Email \n"; //making string, So "\n" is used for newLine

$rand = rand(1,50); //Make a random int number between 1 to 50.
$file ="export/export".$rand.".csv"; //For avoiding cache in the client and on the server 
                                     //side it is recommended that the file name be different.

file_put_contents($file,$CSV_string);

/* Or try this code if $CSV_string is an array
    fh =fopen($file, 'w');
    fputcsv($fh , $CSV_string , ","  , "\n" ); // "," is delimiter // "\n" is new line.
    fclose($fh);
*/ 
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2013-02-14T13:41:50.903

嘿它工作得很好......！！！！感谢 Peter Mortensen 和 Connor Burton

```
<?php
header("Content-type: application/csv");
header("Content-Disposition: attachment; filename=file.csv");
header("Pragma: no-cache");
header("Expires: 0");

ini_set('display_errors',1);
$private=1;
error_reporting(E_ALL ^ E_NOTICE);

mysql_connect("localhost", "user", "pass") or die(mysql_error());
mysql_select_db("db") or die(mysql_error());

$start = $_GET["start"];
$end = $_GET["end"];

$query = "SELECT * FROM customers WHERE created>='{$start} 00:00:00'  AND created<='{$end} 23:59:59'   ORDER BY id";
$select_c = mysql_query($query) or die(mysql_error());

while ($row = mysql_fetch_array($select_c, MYSQL_ASSOC))
{
    $result.="{$row['email']},";
    $result.="\n";
    echo $result;
} 
```

?>

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2015-03-06T07:53:26.893

[您可以使用fputcsv](http://php.net/manual/en/function.fputcsv.php)函数简单地将数据写入 CSV 。让我们看看下面的例子。将列表数组写入 CSV 文件

```
$list[] = array("Cars", "Planes", "Ships");
$list[] = array("Car's2", "Planes2", "Ships2");
//define headers for CSV 
header('Content-Type: text/csv; charset=utf-8');
header('Content-Disposition: attachment; filename=file_name.csv');
//write data into CSV
$fp = fopen('php://output', 'wb');
//convert data to UTF-8 
fprintf($fp, chr(0xEF).chr(0xBB).chr(0xBF));
foreach ($list as $line) {
    fputcsv($fp, $line);
}
fclose($fp); 
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2010-02-12T09:39:39.840

简单的方法 -

```
$data = array (
    'aaa,bbb,ccc,dddd',
    '123,456,789',
    '"aaa","bbb"');

$fp = fopen('data.csv', 'wb');
foreach($data as $line){
    $val = explode(",",$line);
    fputcsv($fp, $val);
}
fclose($fp); 
```

因此，数组的每一行都`$data`将转到新创建的 CSV 文件的新行。它仅适用于 PHP 5 及更高版本。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-10-20T03:15:08.070

要让它以 CSV 格式发送并给出文件名，请使用 header()：

[http://us2.php.net/header](http://us2.php.net/header)

```
header('Content-type: text/csv');
header('Content-disposition: attachment; filename="myfile.csv"'); 
```

至于制作 CSV 本身，您只需遍历结果集，格式化输出并发送它，就像您处理任何其他内容一样。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2010-10-29T15:29:49.033

代替：

```
$query = "SELECT * FROM customers WHERE created>='{$start} 00:00:00'  AND created<='{$end} 23:59:59'   ORDER BY id";
$select_c = mysql_query($query) or die(mysql_error()); 

while ($row = mysql_fetch_array($select_c, MYSQL_ASSOC))
{
    $result.="{$row['email']},";
    $result.="\n";
    echo $result;
} 
```

采用：

```
$query = "SELECT * FROM customers WHERE created>='{$start} 00:00:00'  AND created<='{$end} 23:59:59'   ORDER BY id";
$select_c = mysql_query($query) or die(mysql_error()); 

while ($row = mysql_fetch_array($select_c, MYSQL_ASSOC))
{
    echo implode(",", $row)."\n";
} 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2011-07-25T18:51:48.670

最简单的方法是使用这样的专用[CSV 类](http://www.eeqqoo.com/index.php?option=com_content&view=article&id=63%3aphp-csv-class&catid=35%3aphp&Itemid=54)：

```
$csv = new csv();
$csv->load_data(array(
    array('name'=>'John', 'age'=>35),
    array('name'=>'Adrian', 'age'=>23), 
    array('name'=>'William', 'age'=>57) 
));
$csv->send_file('age.csv'); 
```

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2012-12-17T16:19:35.567

已经非常好的解决方案来了。我只是在输入全部代码，以便新手获得全面帮助

```
<?php
extract($_GET); //you can send some parameter by query variable. I have sent table name in *table* variable

header("Content-type: text/csv");
header("Content-Disposition: attachment; filename=$table.csv");
header("Pragma: no-cache");
header("Expires: 0");

require_once("includes/functions.php"); //necessary mysql connection functions here

//first of all I'll get the column name to put title of csv file.
$query = "SHOW columns FROM $table";
$headers = mysql_query($query) or die(mysql_error());
$csv_head = array();
while ($row = mysql_fetch_array($headers, MYSQL_ASSOC))
{
    $csv_head[] =  $row['Field'];
}
echo implode(",", $csv_head)."\n";

//now I'll bring the data.
$query = "SELECT * FROM $table";
$select_c = mysql_query($query) or die(mysql_error()); 

while ($row = mysql_fetch_array($select_c, MYSQL_ASSOC))
{
    foreach ($row as $key => $value) {
            //there may be separator (here I have used comma) inside data. So need to put double quote around such data.
        if(strpos($value, ',') !== false || strpos($value, '"') !== false || strpos($value, "\n") !== false) {
            $row[$key] = '"' . str_replace('"', '""', $value) . '"';
        }
    }
    echo implode(",", $row)."\n";
}

?> 
```

我已将此代码保存在 csv-download.php

现在看看我是如何使用这些数据下载 csv 文件的

```
<a href="csv-download.php?table=tbl_vfm"><img title="Download as Excel" src="images/Excel-logo.gif" alt="Download as Excel" /><a/> 
```

因此，当我单击该链接时，它会下载文件，而不会将我带到浏览器上的 csv-download.php 页面。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-12-11T19:55:34.937

```
<?
    // Connect to database
    $result = mysql_query("select id
    from tablename
    where shid=3");
    list($DBshid) = mysql_fetch_row($result);

    /***********************************
    Write date to CSV file
    ***********************************/

    $_file = 'show.csv';
    $_fp = @fopen( $_file, 'wb' );

    $result = mysql_query("select name,compname,job_title,email_add,phone,url from UserTables where id=3");

    while (list( $Username, $Useremail_add, $Userphone, $Userurl) = mysql_fetch_row($result))
    {
        $_csv_data = $Username.','.$Useremail_add.','.$Userphone.','.$Userurl . "\n";
        @fwrite( $_fp, $_csv_data);
    }
    @fclose( $_fp );
?> 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2012-10-22T02:40:00.910

如何使用 PHP 脚本写入 CSV 文件？其实我也在找那个。使用 PHP 是一件容易的事。fputs(handler, content) - 这个函数对我来说很有效。首先，您需要使用 fopen($CSVFileName, 'wb') 打开需要写入内容的文件。

```
$CSVFileName = “test.csv”;
$fp = fopen($CSVFileName, ‘wb’);

//Multiple iterations to append the data using function fputs()
foreach ($csv_post as $temp)
{
    $line = “”;
    $line .= “Content 1″ . $comma . “$temp” . $comma . “Content 2″ . $comma . “16/10/2012″.$comma;
    $line .= “\n”;
    fputs($fp, $line);
} 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2017-06-06T08:15:29.517

编写您自己的 CSV 代码可能是在浪费您的时间，只需使用一个包，例如 League/csv - 它为您处理所有困难的事情，文档很好并且非常稳定/可靠：

[http://csv.thephpleague.com/](http://csv.thephpleague.com/)

你需要使用作曲家。如果您不知道作曲家是什么，我强烈建议您看看：[https ://getcomposer.org/](https://getcomposer.org/)

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2022-03-04T05:58:46.400

公共函数 actionExportnotificationresponselogdata() {

```
 $fileName = '/tmp/notificationresponselogs_' . date('d-m-Y-g-i-h') . '.csv';
    $f = fopen($fileName, 'w'); 

        $csv_fields=array();
        $csv_fields[] = 'heading1';
        $csv_fields[] = 'heading2';
        $csv_fields[] = 'heading3';
        $csv_fields[] = 'heading4';
        $csv_fields[] = 'heading5';
        $csv_fields[] = 'heading6';
        $csv_fields[] = 'heading7';
        $csv_fields[] = 'heading8';
        fputcsv($f, $csv_fields);

$notification_log_arr = $notificationObj->getNotificationResponseForExport($params); //result from database

    if (count($notification_log_arr) > 0) {
        $serialNumber=1;
    foreach ($notification_log_arr AS $notifaction) {

            $fields = array();
            $fields['serialNumber']= $serialNumber  ;
            $fields['fld_1']= $notifaction['fld_1'] ;
            $fields['fld_2']= $notifaction['fld_2'] ;
            $fields['fld_3']= $notifaction['fld_3'] ;
            $fields['fld_4']= $notifaction['fld_4'] ;
            $fields['fld_5']= $notifaction['fld_5'] ;
            $fields['fld_6']= $notifaction['fld_6'] ; 
            $fields['fld_7']= $notifaction['fld_7'] ; 
           // print_r($fields); die;
            fputcsv($f, $fields,",");

            $serialNumber++;  }
            fclose($f);
            if (file_exists($fileName)) {

                header("Content-type: application/csv");
                header("Content-Disposition: attachment; filename="."exportlog".date("Y-m-d_H:i").".csv");
                header("Content-length: " . filesize($fileName));
                header("Pragma: no-cache"); 
                header("Expires: 0");
                readfile($fileName);
                unlink($fileName);
                exit;
            }
} 
```

* * *

## 回答 #20

> 赞同：-1
> 
> 时间：2010-11-18T10:57:27.540

将 CSV 数据放入`$output`变量并使用正确的标题回显

```
header("Content-type: application/download\r\n");
header("Content-disposition: filename=filename.csv\r\n\r\n");
header("Content-Transfer-Encoding: ASCII\r\n");
header("Content-length: ".strlen($output)."\r\n");
echo $output; 
```

# php - PHP mkdir 问题

> ID：217427
> 
> 赞同：1
> 
> 时间：2008-10-20T03:13:32.130
> 
> 标签：php, php-5.2

`mkdir("/people/jason", 0700, TRUE);`

TRUE = PHP 5 中的递归并且服务器正在运行 5.2.5 但我得到：

```
Warning: mkdir() expects at most 2 parameters, 3 given in 
/home/net1003/public_html/admin/_createPage.inc on line 5 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-20T03:22:56.167

你是通过命令行界面运行这个特定的脚本吗？可能是 PHP 4 的版本，而 mod_php 的版本是 5。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-20T03:50:07.873

这就是我的全部代码。

将用户添加到 MySQL 数据库后，我想在 Web 服务器上创建一个目录。每个用户都有自己的目录和默认的 index.php 页面，我试图以编程方式而不是手动执行此操作。

# c# - .Net 是否有一个好的图表（不是图表）可视化 API？

> ID：217433
> 
> 赞同：7
> 
> 时间：2008-10-20T03:15:11.987
> 
> 标签：c#, .net, graph-theory

我查看了[Microsoft GLEE](http://blogs.msdn.com/powershell/archive/2007/11/27/graphing-with-glee.aspx)（非商业用途）和其他用于绘制图形的库，但我需要一个良好的商业用途图形 API 来显示通过 Internet 的复杂路线。

我需要能够显示大量的节点和顶点。有任何想法吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-20T03:46:28.910

[Graphviz 资源页面](http://www.graphviz.org/Resources.php)列出了一个项目[QuickGraph](http://www.codeplex.com/quickgraph)，它可能会解决您的问题。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-20T04:06:05.127

您应该查看 Microsoft Research 的 NetMap

[http://www.codeplex.com/NetMap](http://www.codeplex.com/NetMap)

“.NetMap 是一对用于查看网络图的应用程序，以及一组可用于将网络图添加到自定义应用程序的 .NET Framework 2.0 类库。

网络图是由边连接的一系列顶点（有时称为节点）。有关网络图的概述，请参阅此 Wikipedia 文章。

.NetMap 由微软研究院的 Marc Smith 团队创建。”

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-03T02:00:10.970

有[Piccolo 工具包](http://www.cs.umd.edu/hcil/jazz/)；我还没有尝试过，但它看起来很有希望。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-12T22:15:08.010

CodePlex 的[Graph#](http://graphsharp.codeplex.com/)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-20T03:20:40.430

Netron，一个图形库，不幸的是因为源被买了而死了。尽管如此，SF 上的最新版本仍然存在： http: [//sourceforge.net/project/showfiles.php ?group_id=69788&package_id=123851](http://sourceforge.net/project/showfiles.php?group_id=69788&package_id=123851)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-20T04:14:19.667

[ILOG Diagrammer](http://www.ilog.com/promotions/ppc/diagrammer/)提供网络图表；实际上，我还没有尝试过他们的 Vis 产品，但我很高兴使用他们的[Gantt](http://www.ilog.com/products/ganttnet/)产品，效果很好。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-20T06:11:06.840

操作，

您链接到的 PowerShell 博客条目在评论中有另一个指向商业版本的链接。据评论者称，它已更名为 Microsoft Automatic Graph Layout。这是直接链接： [Microsoft Automatic Graph Layout 2007](http://www.windowsmarketplace.com/details.aspx?view=info&itemid=6002737)

# grails - 有最喜欢的自定义 Grails 标签吗？

> ID：217437
> 
> 赞同：6
> 
> 时间：2008-10-20T03:16:54.697
> 
> 标签：grails

我一直在我的项目中使用标签。我正在浏览 grails.org 上的自定义标签，为我的库找到一些新标签。

[http://www.grails.org/Contribute+a+Tag](http://www.grails.org/Contribute+a+Tag)

我想知道 StackOverflow 社区中的人们是否有他们想要分享的最喜欢的自定义标签。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-20T17:51:03.917

我有一个“fmt:relDate”标签，它为您提供类似于 Twitter 的相对日期“3 天前”、“不到 30 秒前”等，并将实时时间作为工具提示。

当前的实现基本上是一个巨大的 if/then 语句链，具有我喜欢的边界。基于二进制搜索的算法会更好（在“更高效”的意义上），当前的实现将我的个人偏好编码到其中，所以我不愿意分享标签。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-08-31T19:49:50.073

我有一个远程分页选项卡，它可以帮助我通过 ajax 对结果进行分页。它是对默认选项卡的改进，并接受了自定义参数。

这是代码：

```
class CustomRemotePaginateTagLib {

  static namespace = 'myTagLib'

  /** * Creates next/previous links to support pagination for the current controller * * <g:paginate total="$ { Account.count() } " />               */
  def remotePaginate = {attrs ->
    def writer = out
    if (attrs.total == null) throwTagError("Tag [remotePaginate] is missing required attribute [total]")

    if (attrs.update == null) throwTagError("Tag [remotePaginate] is missing required attribute [update]")

    def locale = RequestContextUtils.getLocale(request)

    def total = attrs.total.toInteger()

    def update = attrs.update

    def action = (attrs.action ? attrs.action : (params.action ? params.action : "list"))
    def controller = (attrs.controller ? attrs.controller : params.controller)
    def offset = params.offset?.toInteger()
    def max = params.max?.toInteger()
    def maxsteps = (attrs.maxsteps ? attrs.maxsteps.toInteger() : 10)

    if (!offset) offset = (attrs.offset ? attrs.offset.toInteger() : 0)
    if (!max) max = (attrs.max ? attrs.max.toInteger() : 10)

    def linkParams = [offset: offset - max, max: max]
    if (params.sort) linkParams.sort = params.sort
    if (params.order) linkParams.order = params.order
    if (attrs.params) linkParams.putAll(attrs.params)
    linkParams['action'] = action
    linkParams['controller'] = controller

    def linkTagAttrs = [url: "#"]
    if (attrs.controller) { linkTagAttrs.controller = attrs.controller }
    if (attrs.id != null) { linkTagAttrs.id = attrs.id }

    // determine paging variables
    def steps = maxsteps > 0
    int currentstep = (offset / max) + 1
    int firststep = 1
    int laststep = Math.round(Math.ceil(total / max))

    // display previous link when not on firststep
    if (currentstep > firststep) {
      linkTagAttrs.class = 'prevLink'
      def prevOffset = linkParams.offset

      def params = attrs.params ?: []
      params.'offset' = prevOffset

      linkTagAttrs.onclick = g.remoteFunction(update: update, action: linkParams.action, controller: linkParams.controller, params: params)
      writer << link(linkTagAttrs.clone()) {
        (attrs.prev ? attrs.prev : g.message(code: 'default.paginate.prev', default: 'Previous'))
      }
    }

    // display steps when steps are enabled and laststep is not firststep
    if (steps && laststep > firststep) {
      linkTagAttrs.class = 'step'

      // determine begin and endstep paging variables
      int beginstep = currentstep - Math.round(maxsteps / 2) + (maxsteps % 2)
      int endstep = currentstep + Math.round(maxsteps / 2) - 1

      if (beginstep < firststep) {
        beginstep = firststep
        endstep = maxsteps
      }
      if (endstep > laststep) {
        beginstep = laststep - maxsteps + 1
        if (beginstep < firststep) {
          beginstep = firststep
        }
        endstep = laststep
      }

      // display firststep link when beginstep is not firststep
      if (beginstep > firststep) {
        linkParams.offset = 0

        def params = attrs.params ?: []
        params['offset'] = linkParams.offset

        linkTagAttrs.onclick = g.remoteFunction(update: update, action: linkParams.action, controller: linkParams.controller, params: params)
        writer << link(linkTagAttrs.clone()) { firststep.toString() }
        writer << '<span class="step">..</span>'
      }

      // display paginate steps
      (beginstep..endstep).each {i ->
        if (currentstep == i) {
          writer << "<span class=\"currentStep\">${i}</span>"
        } else {
          linkParams.offset = (i - 1) * max

          def params = attrs.params ?: []
          params['offset'] = linkParams.offset

          linkTagAttrs.onclick = g.remoteFunction(update: update, action: linkParams.action, controller: linkParams.controller, params: params)
          writer << link(linkTagAttrs.clone()) { i.toString() }
        }
      }

      // display laststep link when endstep is not laststep
      if (endstep < laststep) {
        writer << '<span class="step">..</span>'
        linkParams.offset = (laststep - 1) * max

        def params = attrs.params ?: []
        params['offset'] = linkParams.offset

        linkTagAttrs.onclick = g.remoteFunction(update: update, action: linkParams.action, controller: linkParams.controller, params: params)
        writer << link(linkTagAttrs.clone()) { laststep.toString() }
      }
    }

    // display next link when not on laststep
    if (currentstep < laststep) {
      linkTagAttrs.class = 'nextLink'
      linkParams.offset = offset + max

      def params = attrs.params ?: []
      params['offset'] = linkParams.offset

      linkTagAttrs.onclick = g.remoteFunction(update: update, action: linkParams.action, controller: linkParams.controller, params: params)
      writer << link(linkTagAttrs.clone()) {
        (attrs.next ? attrs.next : g.message(code: 'default.paginate.next', default: 'Next'))
      }
    }

  } 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-09-01T02:25:52.133

对于某些用例，我发现 DecimalFormat 类（以及 Grails 的 formatNumber 标签）有点不透明，而且我仍然没有找到一种合理的方法来使用它进行一些非常基本的格式化，而无需进行一些丑陋的预处理以生成适当的格式细绳。几个月前，我拼凑了一个简单的数字格式化标签，它本质上构建了一个格式字符串并对数字本身进行了一些最小的处理。

它不像我想要的那样通用或优雅（这是我们当时所需要的——它是超级基本的，但它仍然使 GSP 无法处理一些丑陋的处理），但它应该易于阅读，而且很明显它可以进行微不足道的改进（即使缩放迭代而不是幼稚的 if-elseif slop，允许用户传入自定义缩放标记，允许自定义数字验证器作为参数等）。

```
 // Formats a number to 3 significant digits, appending appropriate scale marker
// (k, m, b, t, etc.). Defining var allows you to use a string representation
// of the formatted number anywhere you need it within the tag body, and 
// provides the scale as well (in case highlighting or other special formatting
// based upon scale is desired).
def formatNumberScaled = {attrs, body -> // number, prefix, suffix, invalid, var
    Double number
    String numberString
    String scale

    try {
        number = attrs.'number'.toDouble()
    } catch (Exception e) {
        number = Double.NaN
    }

    if (number.isNaN() || number.isInfinite()) {
        numberString = scale = attrs.'invalid' ?: "N/A"
    } else {
        Boolean negative = number < 0d
        number = negative ? -number : number

        if (number < 1000d) {
            scale = ''
        } else if (number < 1000000d) {
            scale = 'k'
            number /= 1000d
        } else if (number < 1000000000d) {
            scale = 'm'
            number /= 1000000d
        } else if (number < 1000000000000d) {
            scale = 'b'
            number /= 1000000000d
        } else if (number < 1000000000000000d) {
            scale = 't'
            number /= 1000000000000d
        }

        String format
        if (number < 10d) {
            format = '#.00'
        } else if (number < 100d) {
            format = '##.0'
        } else {
            format = '###'
        }
        format = "'${attrs.'prefix' ?: ''}'${format}'${scale} ${attrs.'suffix' ?: ''}'"

        numberString = g.formatNumber('number': negative ? -number : number, 'format': format)
    }

    // Now, either print the number or output the tag body with
    // the appropriate variables set
    if (attrs.'var') {
        out << body((attrs.'var'): numberString, 'scale': scale)
    } else {
        out << numberString
    }
} 
```

# http - URL中的URL编码尖括号？

> ID：217447
> 
> 赞同：4
> 
> 时间：2008-10-20T03:23:43.653
> 
> 标签：http, url, encoding, iis-6

我正在开发一个遗留应用程序，无论出于何种原因，它都试图将 URL 编码的尖括号填充到 URL 中。例如，要获取以“<sometext>”结尾的 URL：

[http://somesite.com/somefolder/%3csometext%3e](http://somesite.com/somefolder/%3csometext%3e)

当获取上述 URL 编码的 URL 时，它会在 IIS6 上生成 400 错误（错误请求），我不太明白为什么。可能很简单，但我很难过。

想法？谢谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-20T03:26:45.597

您必须安装不允许尖括号（任何形式）的 URLScan 工具 ( [http://technet.microsoft.com/en-us/security/cc242650.aspx](http://technet.microsoft.com/en-us/security/cc242650.aspx) )。

据此，[_](http://blogs.iis.net/nazim/archive/2008/06/24/using-the-new-rules-configuration-in-urlscan-v3-0-beta-part-1.aspx)

```
 The new default urlscan.ini contains a rule in it to protect against these sort of patterns and the rule is just simply:

[DenyQueryStringSequences]

<

> 
```

# c# - 编辑数据网格行

> ID：217455
> 
> 赞同：3
> 
> 时间：2008-10-20T03:29:16.450
> 
> 标签：c#, visual-studio, datagrid

我想知道如何从数据网格中编辑单行（我选择）

例如，我有一个包含 A、B 和 C 列的数据网格，并且我有几行数据，大约 10 行。

假设我想更改第 4 行中数据的值。

我该怎么做？

我正在使用 Visual Studio 2003，但我想如果 Visual Studio 2005 也可以。对于我正在使用 c# 的编码

谢谢..

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-20T06:11:23.393

查看将 EditItemTemplate 添加到数据网格的文档。您将 ItemTemplate 用于仅查看的显示元素，并将 EditItemTemplate 用于用于绑定您选择的单个行的控件。

这是一个可能有帮助的链接：

[http://www.gridviewguy.com/](http://www.gridviewguy.com/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-21T16:16:43.903

asp.net 的所有类似网格的组件在开始编辑单行时具有相同的机制。实际上，asp.net 默认只编辑网格中的一行。

开始编辑需要在 ItemTemplate 中包含 asp:button 或 asp:linkbutton 并将 CommandName 设置为“Edit”。这是所有类似网格的组件都知道如何响应的保留命令名之一。在 DataGrid 中单击此按钮将引发 EditCommand 事件。在这种情况下，您必须将网格的 EditItemIndex 设置为等于 eventargs 的 Item.Itemindex。这会将行 vaccordeing 呈现给 EditItemTemplate。

在此模板中，您放置了 2 个按钮或链接按钮。一个应该将 CommandName 设置为“Update”，一个应该将 CommandName 设置为“Cancel”。

“更新”按钮引发 UpdateCommand 事件。在其中执行将行中的数据存储到其存储（例如：数据库）并将 EditItemIndex 设置为 -1 的代码 - > 所有行都呈现为只读（ItemTemplate 或 AlternateItemTemplate）。

“取消”按钮引发 CancelCommand 事件。在事件处理程序中，您必须将 EditItemIndex 设置为 -1。

此描述仅适用于 DataGrid，而不适用于在 asp.net 中引入的 GridView，它处理大部分“样板”代码，它自己与数据源控件一起工作。谷歌网络以获取更多信息。现在在这里解释太多了。

希望能帮助到你？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-20T07:03:30.947

您的数据在成为 DataGrid 之前是否在 DataTable 中，或者您可以将它放在 DataTable 中吗？您可以更新/删除/编辑 DataTable 中的行，这是一个带有代码片段的链接，非常简单：

[http://msdn.microsoft.com/en-us/library/tat996zc(VS.80).aspx](http://msdn.microsoft.com/en-us/library/tat996zc(VS.80).aspx)

# .net - 尝试在 Linux 下获取 DXperience：在 SLED 中的 wine 下安装 .NET 2.0 时需要“Windows Installer 3”

> ID：217462
> 
> 赞同：4
> 
> 时间：2008-10-20T03:34:32.197
> 
> 标签：.net, cross-platform, suse, dxperience

`DXperience`我想在 Linux（Suse Linux 企业桌面）上试用组件套件。由于它严重依赖 PInvoke 调用，因此 Mono 不会在这里工作。

有些人可以通过在 Linux 上的 wine 下安装 .NET 2.0 来运行它。

我尝试使用 winetricks 和手动执行此操作。每次在 SLED 上安装 .NET 2.0 时，都会使用最新的 wine 来满足“安装程序 3 要求”。

由于缺少加密服务，安装 MSI3 本身失败。

可以通过在 Win98 模式下安装 .NET 2.0 来避免此要求，但安装过程在结束前中断。

有没有人遇到过这个？

* * *

## 回答 #1

> 赞同：-1
> 
> 时间：2008-10-20T11:15:44.510

我认为您不可能在 linux 中安装 .Net 2.0。即使您可以使用一些技巧，您也可能最终会得到一半损坏的框架。

好吧，我用谷歌搜索并找到了这个页面[Interop with Native Libraries](http://www.mono-project.com/Interop_with_Native_Libraries)，我想你可以在单声道中使用 pinvoke，并让 wine 正确解释。这种方式被证明是有效的，您可能可以从社区获得更多帮助，而不是在 linux 中安装 .Net 2.0。

# c++ - 如何在 CrashRpt 中配置电子邮件设置以发送故障转储？

> ID：217463
> 
> 赞同：1
> 
> 时间：2008-10-20T03:35:44.267
> 
> 标签：c++, visual-studio, crashrpt

在阅读了[这个](https://stackoverflow.com/questions/49224/good-crash-reporting-library-in-c)[讨论](https://stackoverflow.com/questions/36127/any-recommended-vc-settings-for-better-pdb-analysis-on-release-builds)和关于使用 CrashRpt 生成故障转储并将其通过电子邮件发送给开发人员的讨论之后，我一直很难找到任何说明/教程来配置库用于发送电子邮件的电子邮件设置。

当您调用 install() 函数来初始化 CrashRpt 时，您指定了要将故障转储发送到的电子邮件地址，但是 CrashPrt 库如何知道如何将电子邮件发送到该地址？图书馆不需要知道每个用户的电子邮件客户端设置吗？

当我的代码发生致命崩溃时，会弹出 CrashRpt 对话框，当我输入我的电子邮件地址并单击发送按钮时，它会将我带到一个“保存文件”对话框，我可以在其中保存压缩包和指定的帐户在 Install() 函数中永远不会收到电子邮件。

提前感谢您的任何帮助！我显然错过了一些东西。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-20T03:44:27.527

**CrashRpt 对电子邮件的作用：**

电子邮件系统只是使用 MAPI 来发送您的电子邮件。如果您有一个并且支持 MAPI，它将尝试使用您的默认邮件客户端。查看 MailMsg.cpp 了解详细信息。

**个人经验：**

在我公司对 CrashRpt 的使用中，我们对其进行了一些修改，以调用我们创建的提交崩溃报告的 Web 服务。因此，我们完全从 CrashRpt 中删除了电子邮件代码。相反，我们在错误跟踪系统中有一个崩溃部分，当崩溃发生时自动提交。

**要找到您的问题：**

我可能会尝试调试 CrashRpt 代码，看看为什么它会给你一个保存对话框。相反，它应该只打开您的默认邮件客户端。也许你有一个旧版本的库，或者对话框资源有点乱。调试代码会告诉你这一点。

很可能正在调用 MailReport 但失败了。

在 DoModal 之后的原始[CrashRpt 代码](http://code.google.com/p/crashrpt/)的 CrashHandler.cpp 中设置断点：

```
 mainDlg.m_pUDFiles = &m_files;
   if (IDOK == mainDlg.DoModal())
   {
      //Put breakpoint here <---------
      if (m_sTo.IsEmpty() || 
          !MailReport(rpt, sTempFileName, mainDlg.m_sEmail, mainDlg.m_sDescription))
      {
         SaveReport(rpt, sTempFileName);
      }
   } 
```

检查为什么 MailReport 没有被调用。它要么是对话框资源，要么是您的 m_sTo 未填充，或者您可以单步执行 MailMsg.cpp 并查看 MAPI 失败的位置。

**替代解决方案：**

一个简单的解决方法是，如果您在上面发现 MailReport 正在被调用，但没有成功，则只需执行一个 ShellExecute 并指定一个 mailto：

您甚至可以尝试使用 MAPI 方法，但如果无法执行 mailto：

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-08-07T05:51:02.903

您可以在此处找到 CrashRpt 文档、常见问题解答并下载新的 CrashRpt v1.1 [http://code.google.com/p/crashrpt/](http://code.google.com/p/crashrpt/)

# c# - c#中的文本输入解析器

> ID：217464
> 
> 赞同：-1
> 
> 时间：2008-10-20T03:35:45.423
> 
> 标签：c#

我有一个这种格式的文本文件：

```
L O A D   C A S E   1   O F   2  ...     
J O I N T   D I S P L A C E M E N T S                   (global)
      Joint    X-dsp       Y-dsp       Z-dsp       X-rot       Y-rot       Z-rot
         1    0.0         0.0         0.0         0.0         0.0        -0.001712
         2    0.000646   -0.021756    0.0         0.0         0.0        -0.001339
         3    0.003562   -0.038487    0.0         0.0         0.0        -0.000727
         4    0.006478   -0.041661    0.0         0.0         0.0         0.000104
         5    0.009536   -0.036266    0.0         0.0         0.0         0.000720
         6    0.012595   -0.022824    0.0         0.0         0.0         0.001326
         7    0.014724    0.0         0.0         0.0         0.0         0.001948
         8    0.010000   -0.018686    0.0         0.0         0.0        -0.001117
         9    0.009354   -0.036887    0.0         0.0         0.0        -0.000829
        10    0.005767   -0.041661    0.0         0.0         0.0         0.000060
        11    0.002180   -0.035866    0.0         0.0         0.0         0.000798
        12    0.000051   -0.020695    0.0         0.0         0.0         0.001210
    M E M B E R   E N D   F O R C E S                   (local)
      Member Joint      Nx          Vy         Vz         Txx        Myy        Mzz
         1      1    -16.138t      0.002      0.0        0.0        0.0        0.011
         1      2     16.138t     -0.002      0.0        0.0        0.0        0.017
         2      2    -72.907t      0.003      0.0        0.0        0.0        0.013
         2      3     72.907t     -0.003      0.0        0.0        0.0        0.023
         3      3    -72.909t     -0.000      0.0        0.0        0.0       -0.009
         3      4     72.909t      0.000      0.0        0.0        0.0        0.005
         4      4    -76.455t     -0.000      0.0        0.0        0.0       -0.007
         4      5     76.455t      0.000      0.0        0.0        0.0        0.003
         5      5    -76.453t     -0.001      0.0        0.0        0.0       -0.010
         5      6     76.453t      0.001      0.0        0.0        0.0        0.000
         6      6    -53.226t     -0.002      0.0        0.0        0.0       -0.018
         6      7     53.226t      0.002      0.0        0.0        0.0       -0.008
         7      1    108.570c     -0.001      0.0        0.0        0.0       -0.011
         7      8   -108.570c      0.001      0.0        0.0        0.0       -0.004
         8      2    -76.765t     -0.004      0.0        0.0        0.0       -0.024
         8      8     76.765t      0.004      0.0        0.0        0.0       -0.021
         9      2     80.278c     -0.000      0.0        0.0        0.0       -0.006
         9      9    -80.278c      0.000      0.0        0.0        0.0       -0.000
        10      3    -39.997t     -0.002      0.0        0.0        0.0       -0.014
        10      9     39.997t      0.002      0.0        0.0        0.0       -0.016
        11      4    -23.720t     -0.000      0.0        0.0        0.0        0.004
        11      9     23.720t      0.000      0.0        0.0        0.0       -0.007
        12      4     -0.001t      0.000      0.0        0.0        0.0        0.002
        12     10      0.001t     -0.000      0.0        0.0        0.0        0.001
        13      4    -18.706t      0.000      0.0        0.0        0.0       -0.003
        13     11     18.706t     -0.000      0.0        0.0        0.0        0.005
        14      5    -10.000t      0.001      0.0        0.0        0.0        0.007
        14     11     10.000t     -0.001      0.0        0.0        0.0        0.008
        15      6     32.845c      0.000      0.0        0.0        0.0        0.006
        15     11    -32.845c     -0.000      0.0        0.0        0.0       -0.000
        16      6    -53.223t      0.002      0.0        0.0        0.0        0.012
        16     12     53.223t     -0.002      0.0        0.0        0.0        0.010
        17      7     75.273c      0.000      0.0        0.0        0.0        0.008
        17     12    -75.273c     -0.000      0.0        0.0        0.0       -0.001
        18      8     16.142c      0.005      0.0        0.0        0.0        0.025
        18      9    -16.142c     -0.005      0.0        0.0        0.0        0.030
        19      9     89.682c      0.000      0.0        0.0        0.0       -0.007
        19     10    -89.682c     -0.000      0.0        0.0        0.0        0.008
        20     10     89.682c     -0.000      0.0        0.0        0.0       -0.009
        20     11    -89.682c      0.000      0.0        0.0        0.0        0.003
        21     11     53.228c     -0.002      0.0        0.0        0.0       -0.016
        21     12    -53.228c      0.002      0.0        0.0        0.0       -0.010 
```

是否有任何 C# 库可用于解析这种格式的信息？

谢谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-20T03:42:03.350

不。

您可以使用 .NETs 字符串库非常轻松地自己解析它

例如 string.Split

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-20T03:48:02.137

[这](http://schotime.net/blog/index.php/2008/03/18/importing-data-files-with-linq/)是关于使用 Linq 导入表格数据的一种非常有趣的方法。

它简单而优雅，您只需要一个 Enumerable 方法来从文件中产生行：

```
public static IEnumerable<string> ReadLinesFromFile(string filename)
{
    using (StreamReader reader = new StreamReader(filename))
    {
        while (true)
        {
            string s = reader.ReadLine();
            if (s == null)
                break;
            yield return s;
        }
    }
} 
```

and then you do the query:

```
var jointDisplacements = from line in ReadLinesFromFile(@"c:\import.txt")
               let item = line.Split(new char[] { '\t' })
               select new
               {
              Joint = Convert.ToInt32(item[0]),
              X-dsp = Convert.ToDouble(item[1]),
              Y-dsp = Convert.ToDouble(item[2]),
              Z-dsp = Convert.ToDouble(item[3]),
              X-rot = Convert.ToDouble(item[4]),
              Y-rot = Convert.ToDouble(item[5]),
              Z-rot = Convert.ToDouble(item[6])
               }; 
```

You have now a list of [anonymous objects](http://msdn.microsoft.com/en-us/library/bb308966.aspx#csharp3.0overview_topic15) that have the values from your file, represented as properties of each object.

If your file includes the column headers, you should skip the first line...

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-20T03:46:16.603

正则表达式可以提供很好的帮助。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-20T03:57:22.213

[http://filehelpers.sourceforge.net/](http://filehelpers.sourceforge.net/) may be useful. It won't be completely automatic. You'll need to do some work to break the different portions of the file into different streams that you can pass to the FileHelperEngine class that will parse the fixed format data.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-20T03:47:59.953

看起来像固定长度格式？

通过一些预处理，您可以使用 OLEDB 驱动程序通过标准 API 获取数据：

*   [http://www.codeproject.com/KB/database/ReadTextFile.aspx](http://www.codeproject.com/KB/database/ReadTextFile.aspx)

有人创建了一个使用 XML 文件配置格式的示例：

*   [https://web.archive.org/web/1/http://articles.techrepublic%2ecom%2ecom/5100-10878_11-6156780.html](https://web.archive.org/web/1/http://articles.techrepublic%2ecom%2ecom/5100-10878_11-6156780.html)

# .net - 单个 WCF 服务到多个客户端连接

> ID：217484
> 
> 赞同：4
> 
> 时间：2008-10-20T03:53:32.390
> 
> 标签：.net, wcf

我开发了一个接收和发送回数据的 VB.NET WCF 服务。当第一个客户端连接时，它会启动数据输出，如果客户端关闭，该数据输出也会继续。如果新客户端连接，则创建一个新对象，并且数据输出从一开始就开始并与旧实例并行继续。有没有办法从多个客户端读取相同的服务对象？

该服务是自托管的。

**更新：**我解决了将以下代码添加到服务类的问题：

```
<ServiceBehavior(ConcurrencyMode:=ConcurrencyMode.Multiple, 
    InstanceContextMode:=InstanceContextMode.Single)>
    ... 
```

要使用接收 SingletonInstance 的 ServiceHost 重载，必须使用适当的 ServiceBehaviours 标记服务。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-20T04:14:13.550

如果您要自托管服务，则可以使用 ServiceHost 构造函数重载，该构造函数采用服务实例而不是服务类型。所有客户端都将连接到同一个服务实例。

如果您托管在 IIS 中，则您无法控制服务实例。更糟糕的是，您无法控制进程的生命周期。因此，如果您想要一个signleton，您必须拥有自己的进程并让服务实例连接到它。

**更新**：正如@jezell 指出的那样，通过InstanceContextMode 可以对IIS 中的服务实例进行一些控制。但是，这仍然不能控制 IIS 进程。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-20T12:43:19.857

我在这里谈论选项：

[http://www.iserviceoriented.com/blog/post/Configuring+Performance+Options+-+WCF+Gotcha+3.aspx](http://www.iserviceoriented.com/blog/post/Configuring+Performance+Options+-+WCF+Gotcha+3.aspx)

首先，您有 InstanceContextMode，它可以是 Single、PerCall 或 PerSession。这控制了如何创建服务类的新实例。

除此之外，节流和并发设置也很重要，因为将实例上下文模式设置为单一而不将并发模式更改为多个可能会产生严重的负面后果。查看帖子以获得更详细的讨论。

# algorithm - 效率/算法与系统规格

> ID：217489
> 
> 赞同：1
> 
> 时间：2008-10-20T04:00:47.417
> 
> 标签：algorithm

我们都在谈论算法的效率，它基本上取决于输入大小。

当前运行该算法的计算机的系统规格如何？在 Core 2 Duo 2.6 GHZ、4 GB RAM 计算机或 P-2、256 MB RAM 计算机中运行不同的排序算法有什么不同吗？

我确信必须存在性能差异。但是，我想知道算法和系统规范之间的真正关系是什么......

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-20T04:05:00.170

硬件性能的提高会给你一个常数 C 乘以你的算法的运行时间。这意味着如果您的计算机 A 总体上比计算机 B 慢 2 倍。您的算法在计算机 B 上的速度将是计算机 B 的两倍。尽管当您考虑到算法的大输入值时，两倍的速度实际上几乎没有区别。

[在大 O 表示法](http://en.wikipedia.org/wiki/Big_O_notation)中，也就是说，与 C *O(n) = O(cn* ) = O(n) 相比，你将有类似 O(n) 的东西。算法的复杂性和大值的一般运行时间在计算机 A 和计算机 B 上大致相同。

如果您使用诸如大 O 表示法之类的方法分析算法的运行时间，那么您将对算法的实际工作方式有更好的了解。当您将 O(logn) 与 O(n^2) 的算法进行比较时，计算机性能不会给您带来任何优势。

看一下 n 的一些数据值：

我假设慢速计算机每次操作需要 1 秒，快速计算机需要 2 次操作。我会将慢速计算机的更好算法与快速计算机的较差算法进行比较。

**对于 n = 10：**

> 算法 1：O(logn)：4 次操作慢速计算机：4 秒
> 
> 算法 2：O(n^2)：100 次操作快速计算机：50 秒

**对于 n = 100：**

> 算法 1：O(logn)：7 次操作慢速计算机：7 秒
> 
> 算法 2：O(n^2)：10,000 次操作快速计算机：1.4 小时

差异大

**对于 n = 1,000：**

> 算法 1：O(logn)：10 次操作慢速计算机：10 秒
> 
> 算法 2：O(n^2)：1,000,000 次操作快速计算机：5.8 天

巨大的差异

* * *

随着 n 的增加，差异越来越大。

现在，如果您尝试在更快/更慢的计算机上运行这些算法中的每一个以获取较大的输入大小。没关系。放下 O(logn) 会更快。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-20T04:42:10.937

我不喜欢 Brian Bondy 和 Czimi 提供的答案......

也许这是因为我开始在一个不同的时代，当时 32K 被认为是很多内存，而大多数“个人计算机”都有 8K 字节，而现在我从事科学计算工作，其中最大的数据集在世界上的一些计算机上处​​理拥有数千个处理节点和看似难以置信的存储量的最大系统。因此，我不会忽视问题的某些其他要素。

所讨论的数据集的大小产生了巨大的差异。到目前为止，关于这个问题的大多数答案都忽略了这一点，并且适用于非常小的数字 N。其他回答过的人都假设“这一切都适合记忆”或类似的东西。

对于大型数据集，其他因素也会发挥作用，而“大”取决于您在解决问题时必须使用哪些资源。现代系统有机会进行离线存储（例如 DVD）、网络存储（例如 nfs）、在线存储（例如串行 ATA）以及两级内存存储，即系统主存储器和片上缓存。这些如何被利用很重要，数据集越大，它们就越重要。您可能需要也可能不需要将这些访问设计到您的“算法”中，但如果您这样做，那*真的很*重要！

随着您将规模扩大到某个特定点之外——单个 CPU 及其本地内存的限制几乎是正确的——这些其他因素成为工作负载开销中越来越大的因素。当我还是一名数字技术人员时，我们在多 CPU 系统上进行了一些真正的商业工作，我记得运行过一个基准测试表明，使用单 CPU 作为 CPU 工作负载能力的一个“单元”，第二个 CPU（在紧密耦合的系统）总共会给你大约 1.8。也就是第二个CPU增加了0.8左右。对于三个，增加下降到大约 0.6，四个下降更多，到大约 0.2，对于四个 CPU 布置，总共大约为 2.6，尽管由于其他影响，我们在四个 CPU 上保持良好的数字时遇到了一些麻烦（测量工作成为额外资源的很大一部分）。... 最重要的是，多 CPU 不一定是它们被破解的全部 - 四倍 CPU 不会给你四倍的处理能力，即使理论上你会得到四倍的失败率。...我们重复了 Alpha 芯片的工作，这是历史上第一个多核，结果保持得很好。当然可以进行优化来提高每个额外 CPU 所提供的分数，并且从那时起肯定有很多工作可以更智能地拆分计算线程，但你永远不会一直到每个新线程的 100% ，部分原因是它们都减慢了一些（额外的开销）来协调。..我们重复了Alpha芯片的工作，这是历史上第一个多核，结果保持得很好。当然可以进行优化来提高每个额外 CPU 所提供的分数，并且从那时起肯定有很多工作可以更智能地拆分计算线程，但你永远不会一直到每个新线程的 100% ，部分原因是它们都减慢了一些（额外的开销）来协调。..我们重复了Alpha芯片的工作，这是历史上第一个多核，结果保持得很好。当然可以进行优化来提高每个额外 CPU 所提供的分数，并且从那时起肯定有很多工作可以更智能地拆分计算线程，但你永远不会一直到每个新线程的 100% ，部分原因是它们都减慢了一些（额外的开销）来协调。

小小的感叹 - 我们对这项工作有一个说法：“将所有重要的东西都归结为编译器！” RISC，明白了吗？这是因为编译器本身必须组织工作负载，因此竞争线程不会互相踩踏！

最终执行真正海量数据处理的处理需要一个非常聪明的策略，将数据移入和移出更远的数据存储区到本地内存。而且，算法内部的分工绝对至关重要。在我与加州大学洛杉矶分校的 Roberto Mechoso 一起做全球循环建模的工作中，他们有一个数据代理设计，说明了人们为做好工作所做的尝试。坦率地说，结果并没有想象中那么好，但其中的设计理念值得研究。...假设您考虑“算法”的这一部分 - 而不仅仅是位旋转部分，那么资源的算法管理是合理（如果不是最佳）资源利用进行大量计算的最重要方面之一。

...我希望这有助于回答您的询问。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-20T07:13:26.823

到目前为止没有提出的一件事是，算法通常用速度来描述，例如 O(n)、O(n log(n)) 等……但它们在资源使用方面也有特点，其中提高了速度，比如说 O(n) 与 O (n log(n))，是以更大的内存使用为代价的。在现代计算机中，随着资源耗尽，它们通常被更大的较慢资源所取代，例如将内存换成磁盘，其中较慢的资源要慢几个数量级。因此，当我们绘制算法性能与时间的关系图，并期望一条直线、n log n 曲线等时......我们经常会看到较大的 n 值随着内存耗尽而出现峰值。在这种情况下，1GB 和 2GB 的 RAM 之间的差异可能是巨大的，所以实际上，你的问题的答案是肯定的，**系统规范非常重要**，**算法 的 选择 需要 了解 系统 规范 和 输入 数据 的 大小**.

例如，我开发了曲面建模和分析软件，我知道我的程序在 32 位 XP 盒子上运行良好，适用于 400 万点的 TIN 模型。350 万和 400 万点之间的性能差异很小。在 450 万点处，性能下降非常严重，软件无法使用。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-20T04:06:12.147

是的，它确实取决于系统规范。一个系统可能比另一个系统快 10 倍，因此它对一组数据运行冒泡排序和快速排序的速度比另一个快 10 倍。

但是当你分析算法时，你经常会忽略这样的常数因素，这是大 O 表示法所做的一件事。因此，bubblesort 是 O(n^2)，quicksort 是 O(nlogn)（在平均情况下），无论您的硬件有多快，它都成立。

有趣的是当你开始比较苹果和橙子时。如果你在你的快速硬件上运行冒泡排序，你可能会发现它比在慢速硬件上的快速排序要快——但只是在一定程度上。最终，如果输入集足够大，慢速硬件上的快速排序将比快速硬件上的冒泡排序更快。

如果你想开始进行这样的比较，你需要一起做两件事：确定算法复杂度，包括常数因素，并为实际硬件开发一个速度模型（例如，它每秒可以执行多少次特定循环的迭代）你在继续。与其他有关算法的书籍相比，关于 Knuth 的[《计算机编程艺术》](https://rads.stackoverflow.com/amzn/click/com/0201485419)的有趣之处在于他两者都做，因此对于他检查的每个算法，他都会计算给定大小的输入所需的执行时间单位在他的（神话的）MIX 电脑上。然后，您可以针对更快或更慢的硬件调整计算——这是 big-O 符号无法解决的问题。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-20T04:09:35.527

通过您的问题，您的意思是要问为什么仅根据输入大小来描述算法的效率？

算法通常使用[Big O Notation](http://en.wikipedia.org/wiki/Big_O_notation)来描述。该符号描述了算法的渐近行为；它描述了输入数据非常非常大时的行为。

例如，我们有两种排序算法。

1.  算法#1 与 O(n)
2.  算法#2 O(n^2)

让我们拿两台电脑：

1.  PC1
2.  PC2 比 PC1 快 100 倍

我们有两种设置：

1.  PC1 运行算法#1
2.  PC2 运行算法#2

当 n 非常非常大时（比如数十亿？）PC1 仍然会击败 PC1 :)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-20T04:08:03.627

算法的效率不取决于系统规范。效率由 Ordo 数描述，它为您提供了处理工作量和输入大小的关系。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-20T04:08:14.513

当然可以。使用高 CPU，**执行时间**会减少。
同样，对于更高的内存，**交换数据**（如果适用）所花费的时间肯定会减少。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-20T04:09:43.903

请注意实现算法的语言的特殊性。

例如，在 java 世界中，如[本文](http://mlee888.wordpress.com/2006/03/31/java-performance-in-dual-coremultiprocessor-environment/)所示，更快的计算机并不总是意味着更快的运行时：

> 在单 CPU 机器上运行相同的 Java 程序实际上可以比在多进程/多核机器上运行得快得多！！

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-20T04:15:50.803

> 在 Core 2 Duo 2.6 GHZ、4 GB RAM 计算机或 P-2、256 MB RAM 计算机中运行不同的排序算法有什么不同吗？

在某些情况下绝对！如果您的数据集不适合内存，您将需要使用基于磁盘的排序算法，例如归并排序。引用[维基百科](http://en.wikipedia.org/wiki/Sorting_algorithm)：

> 当要排序的数组的大小接近或超过可用的主内存时，必须使用（慢得多的）磁盘或交换空间，排序算法的内存使用模式变得很重要，并且可能已经相当公平的算法当阵列很容易适合 RAM 时，效率可能变得不切实际。在这种情况下，比较的总数变得（相对）不那么重要，并且必须从磁盘复制或交换内存部分的次数可以支配算法的性能特征。因此，通过次数和比较的本地化可能比原始比较次数更重要，因为附近元素之间的比较发生在系统总线速度（或者，使用缓存，甚至在 CPU 速度下），比较到磁盘速度，
> 
> 例如，流行的递归快速排序算法在 RAM 充足的情况下提供了相当合理的性能，但由于它复制数组部分的递归方式，当数组不适合 RAM 时，它变得不太实用，因为它可能会导致大量慢速复制或从磁盘移动操作。在这种情况下，另一种算法可能更可取，即使它需要更多的总比较。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-10-20T05:45:36.720

是的。请记住，自 80 年代初以来，我们已经跃升了约 4 个数量级。（1 兆赫、10 兆赫、100 兆赫、1000 兆赫）。但这只是 n=10 和 n=10000 之间的区别，就数据集大小而言。我可以购买 TB 硬盘驱动器...超过 6?7？数量级比我的旧 20 兆字节驱动器。

那里漂浮的数据比计算能力多得多。因此，尽管您可能对 big-O 在 n=50、n=500 种大小时的用处感到困惑……当 n=1,000,00 时，您希望尽可能地最小化 n。任何超线性对您的计算能力都是粗略的……非多项式甚至更糟。这从系统的顶部一直延伸到底部。因此，一旦您处理真实世界的数据集大小，效率就是王道。

让我给你举个例子。

我做了一个初级数据库设计。到最后，我可能有 5 个表，其中可能包含 20-40 个预定义的类别。添加行、10 行、20 行。没什么大不了。我是个天才。我是用 PHP 做的，而不是 Perl。我就是*这样，还有一袋薯条*。

搬到现在，几年后。我正在做一个股票市场数据挖掘的业余项目。我每天从一个金融网站收集数据——6100 只股票，每只股票大约有 10 列。每周三万多行。我最初的设计是“规范化”的，静态数据和动态数据在不同的表中。当我玩弄我的查询，了解事物时，如果我做了一个糟糕的连接，我真的会崩溃我的服务器并使其不可用。所以我去规范化了。我的下一个阶段是标记并开始实际挖掘。我不打算在圣诞节之前开始做出严肃的预测。大约 11x30K = 330K 行进行挖掘和分析。算法效率*很重要*，如果我想及时处理我的数据。如果我的 CPU 快 10 倍也没关系……如果我使用 N^2 算法，它只会以 2 倍的速度完成。:-)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-21T22:11:05.407

> 但是，我想知道算法和系统规范之间的真正关系是什么......

我很困惑。我看到很多人在这里写了很多东西，但是，当我读到上面的引文作为一个问题时，我只能说：

*   更好的系统（= 更快的 CPU，更多的 RAM）运行得更快，更差的系统（= 更慢的 CPU，更少的 RAM）运行得更慢。相同的算法（无论好坏）很可能在更好的系统上运行得更快，而在更差的系统上运行得更慢。

*   较快的算法比较慢的算法运行得更快。它将在较慢的系统上运行得更快，在较快的系统上运行得更快。

那么你的问题到底是什么？你的问题是“如果系统已经那么快，我们真的需要一种快速算法吗？一个慢速算法不也可以吗？” 也许吧。但在那种情况下，我会问两个问题：

1.  为什么仅仅因为系统快就选择慢算法？这样，您的代码只会在非常快的系统上以不错的速度运行。如果您选择快速算法，您的代码甚至可能在更糟糕的系统上以不错的速度运行。

2.  为什么要故意达到更差的性能？即使一个糟糕的算法可能会在 5 秒内运行，但您认为在快速机器上足够快，一个好的算法可能会在 100 毫秒内运行。那么，为什么要让你的程序在 5 秒内执行一项任务，而它却可以在 100 毫秒内执行完全相同的任务呢？

实际上，第 (2) 点确实经常困扰我。所以经常有人说“嘿，不要过度优化，没关系。这个代码只是这么大的系统中的一个小系统”。是的，如果你只看这段代码是孤立的，那是真的。但有句俗语说“一粒粒粒粒粒粒”。当然，您应该首先优化处理器最密集的部分。但是，如果一个系统由 100 个模块组成，并且每个模块只使用 1% 的 CPU 时间，那么将其中一个模块优化为两倍的速度只会使整体处理时间提高 0.5%，几乎没有；这就是为什么大多数人不这样做的原因。但人们忽略的是，将所有这些优化为两倍的速度将获得 50% 的处理时间改进（或 IOW，

因此，除非有充分的理由不这样做，否则为什么不总是使用已知的最佳算法来解决问题呢？最好的意味着表现出良好的性能和良好的 CPU 时间/内存使用率的那台（因为如果这台需要比普通客户 PC 甚至更多的内存，那么使用最快的那台是没有用的）。

# frameworks - 您最喜欢的 Web 框架中缺少的一项功能是什么？

> ID：217499
> 
> 赞同：0
> 
> 时间：2008-10-20T04:08:43.797
> 
> 标签：frameworks

今天有几个非常高质量的 web 框架，每个人似乎都能找到一个成为他们最喜欢的。然后，他们对所讨论的框架只有好话要说，并且他们将他们的个人经验与框架如何使 Web 开发对他们来说更愉快有关。

太好了，我在 stackoverflow 上看到的与 Web 框架相关的问题已经以有用的方式得到了回答，同时避免了激烈的战争等等 - 这说明了很多关于参与这里的人，并且很高兴阅读高质量的内容。

所以这是我的问题：当然，有 99 个理由喜欢你最喜欢的 Web 框架，但你希望它拥有的 1 个额外功能是什么？还是您认为可以改进的那 1 个领域？

希望我们已经摆脱了“我的框架比你的框架更好”的毫无意义的讨论，并且我们也意识到所有框架都有它们的最佳点。我当然尊重那些承认自己喜欢的框架并不完美的人，我想了解人们发现缺少或可以改进的功能类型。谁知道呢，那些框架的开发者可能会听到你的声音并实现/改进这些功能！

提前感谢您的回复。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-20T04:19:01.077

对于 ASP.NET，我唯一不喜欢的是，MS 经常鼓励快速而肮脏的风格开发，使用太多的拖放控件和数据集，而不是通过更好的想法而不是那么快但更不肮脏的解决方案。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-20T04:17:29.300

我将通过承认我最喜欢的框架[Stripes](http://www.stripesframework.org)*可以*对其本地化机制的灵活性进行一些改进来发布我自己的问题的答案。虽然该机制非常有用，但开发人员应该更容易自定义动态使用哪些资源包以及哪些是字段名称和错误消息的查找键。

但是，嘿，我们正在努力！

# java - 将验证码与 Spring Security 集成

> ID：217511
> 
> 赞同：16
> 
> 时间：2008-10-20T04:14:14.330
> 
> 标签：java, spring-security, captcha

将 SpringSecurity 与 Capcha 集成的合适方法是什么？

我有以下用例：当用户尝试登录时，如果我们登录 N 次失败，将显示验证码，因此验证将使用三个参数：用户名、密码、验证码。但是 Spring Security 不支持内置的验证码处理。

我刚刚开始考虑实施。并有以下变体：

*   在 Spring Security 过滤器堆栈中添加单独的安全过滤器，
*   完全重写 AuthenticationProcessingFilter 以支持一些验证码
*   使用带有拦截验证码逻辑的一些编程身份验证，然后将用户名和密码传输到 Spring Security

作为验证码的实现，我想到了 JCaptcha，但你的想法是什么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-21T00:59:09.700

作为使用 JCaptcha 的替代方法，如果您想在您的站点上使用[reCAPTCHA 服务](http://recaptcha.net/)，请查看新的[Spring in Practice](http://www.manning.com/wheeler/)书（目前处于测试阶段）的免费第 4.4 节（[直接 PDF 链接）。](http://www.manning.com/wheeler/SIP_Wheeler_MEAP_ch4.pdf)

这向您展示了与 Spring MVC 和 Spring Validation 的集成。由于集成在前端，带有外部 API，因此 Spring Security 并没有真正出现在这里。

我不确定你的用例是什么？您是否希望使用验证码代替身份验证来证明“人性”？

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2011-02-23T00:38:21.750

看看这篇文章：[Spring Security 3: Integrating reCAPTCHA Service](http://krams915.blogspot.com/2011/02/spring-security-3-integrating-recaptcha.html)。

这使用两个过滤器来使 reCAPTCHA 集成尽可能无缝且不显眼。这意味着您现有的 Spring Security 实现不会中断。无需触及现有课程

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-01-14T13:06:47.663

我通过定义自定义安全过滤器完成了与 reCaptcha 和 Spring Security (Spring Web Flow + JSF) 的集成。也许它不是最优雅的，但效果很好。你可以看看我的博客 - 不幸的是波兰语，但也许会对你或某人有所帮助......

[http://marioosh.net/blog/?p=1087](http://marioosh.net/blog/?p=1087)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-07-13T19:26:16.583

[Kaptcha](http://code.google.com/p/kaptcha/wiki/HowToUse)易于使用。

# css - 奇怪的 IE CSS 问题

> ID：217515
> 
> 赞同：1
> 
> 时间：2008-10-20T04:17:15.293
> 
> 标签：css, internet-explorer, internet-explorer-7, jquery-corner

所以我的问题与有效的粘性页脚有关，但是圆角脚本在 IE7 中将页脚向上推了一点。（例如：[游戏页面](http://callynandmike.com/games/games.php)）如果您在 IE7 中加载页面，页脚位于错误的位置，但如果您执行以下操作： 1\. 打开一个新标签 2\. 在新标签中转到 google.ca（或做一些事情) 3\. 关闭标签页脚问题已修复。我无法理解为什么会这样。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-20T14:35:49.957

写完这篇文章后，我发现了这篇关于堆栈溢出的文章：[IE CSS Bug - How do I maintain a position:absolute when dynamic javascript content on the page changes](https://stackoverflow.com/questions/33837/ie-css-bug-how-do-i-maintain-a-positionabsolute-when-dynamic-javascript-content)这似乎解决了同样的问题。

# svn - 我可以使用 mercurial 模拟 svn:externals 吗？

> ID：217523
> 
> 赞同：62
> 
> 时间：2008-10-20T04:31:07.697
> 
> 标签：svn, mercurial, svn-externals, externals

我们正在考虑从 SVN 迁移到 Mercurial，但遇到了一个绊脚石。

我们目前使用`svn:externals`自动将一组通用库拉入工作目录。我在 Mercurial 中找不到这样的支持。

有没有办法使用 Mercurial 自动执行此操作，或者我是否需要在构建过程中伪造它？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-07-13T11:20:59.787

森林扩展的功能似乎正在核心 Mercurial 中实现（从 1.3 开始）：

[https://www.mercurial-scm.org/wiki/Subrepository](https://www.mercurial-scm.org/wiki/Subrepository)。

目前标记为“实验性”，但可能是处理 svn:external -v1.4 的类型功能的途径。

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2008-10-24T03:41:45.143

仅使用 mercurial 没有好方法。其他地方提到的森林扩展会导致现在修复的更多问题。大多数人只是使用一个大型 repo 并将所有组件包含在 repo 中，然后让他们的构建脚本下载并使用 3rd 方库——如果他们是 Java-heads，则使用 maven。

简短的回答“在你的构建过程中伪造它”。

**更新：**

在 Mercurial 1.3 中，添加了一个新的 sub repos 功能。它就像旧的森林扩展，但以全新的代码开始。

[Subrepos](https://www.mercurial-scm.org/wiki/Subrepository)被认为是“**不得已而为之的功能**”。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-12T08:22:53.330

你试过[Deps Extension](https://www.mercurial-scm.org/wiki/DepsExtension)吗？

它不是 Mercurial 的一部分，但似乎模仿`svn:externals`功能

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-20T04:42:03.340

试试 Mercurial 的[Forest Extension](https://www.mercurial-scm.org/wiki/ForestExtension)。

# database - 数据库可扩展性 - 性能与数据库大小

> ID：217531
> 
> 赞同：4
> 
> 时间：2008-10-20T04:42:38.393
> 
> 标签：database, scalability

我正在创建一个应用程序，它必须将最多 32 GB 的数据放入我的数据库中。我正在使用 B-tree 索引，因为读取将具有范围查询（例如 from 0 < time < 1hr）。

一开始（数据库大小 = 0GB），我将获得每毫秒 60 和 70 次写入。在说 5GB 之后，我测试过的三个数据库（H2、berkeley DB、Sybase SQL Anywhere）真的减慢到每毫秒不到 5 次写入。

**问题：**

*   这是典型的吗？
*   如果我删除了索引，我还会看到这个可伸缩性问题吗？
*   这个问题的原因是什么？

**笔记：**

每条记录由几个整数组成

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-20T04:46:26.107

是的; 索引以插入时间为代价提高了获取时间。你的数字听起来很合理——不知道更多。

您可以对其进行基准测试。您需要存储合理数量的数据。考虑是否根据查询进行索引 - 重获取和轻插入？索引 where 子句可能使用它的任何地方。轻取，重插入？可能避免索引。混合工作量；标杆吧！

在进行基准测试时，您需要尽可能真实或真实的数据，无论是在数量上还是在数据域上（例如，数据的分布，不仅仅是所有的“henry smith”，而是各种名称）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-20T05:33:39.193

索引通常会牺牲插入速度来换取访问速度。你可以从一个为每一列建立索引的数据库表中找到它（我已经在野外看到过这些）。如果更新的数量与查询的数量相比很小，那么这并没有本质上的错误。

但是，鉴于：

1/ 您似乎担心您的写入速度会减慢到 5/ms（仍然是 5000/秒），

2/ 每条记录只写几个整数；和

3/您的查询仅基于时间查询，

您可能需要考虑绕过常规数据库并滚动您自己的数据库（我的想法是您正在收集实时数据，例如设备读数）。

如果您只编写按顺序计时的数据，您可以只使用一个平面文件并定期单独写入“索引”信息（比如在每分钟开始时）。

这将大大加快您的写入速度，但仍允许相对有效的读取过程 - 最坏的情况是您必须找到相关时期的开始并从那里进行扫描。

这当然取决于我对您的存储是否正确的假设：

1/ 您正在按时间顺序写入记录。

2/您只需要查询时间范围。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-20T05:43:18.193

是的，索引通常会减慢插入速度，同时显着加快选择（查询）。

请记住，并非所有对 B 树的插入都是相等的。这是一棵树；如果你所做的只是插入它，它必须不断增长。数据结构允许进行一些填充，但如果您继续向其中插入按顺序增长的数字，则它必须不断添加新页面和/或随机播放以保持平衡。确保您的测试插入分布良好的数字（假设这就是它们在现实生活中的方式），并看看您是否可以做任何事情来告诉 B-tree 从一开始就期望有多少项目。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-24T18:44:55.837

我认为他们在 BDB 文档的某处提到页面大小极大地影响了 btree 中的这种行为。假设你没有在并发方面做太多事情并且你有固定的记录大小，你应该尝试增加你的页面大小

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-20T05:01:20.493

完全同意@Richard-t - 在离线/批量场景中，在批量更新语料库之前完全删除索引是很常见的，只有在更新完成时才重新应用它们。

应用的索引类型也会影响插入性能 - 例如，对于 SQL Server 聚集索引更新 I/O 用于数据分发和索引更新，其中非聚集索引在单独的（因此更昂贵的）I/O 操作中更新.

与任何工程项目一样 - 最好的建议是使用真实数据集（倾斜页面分布、撕裂等）进行测量

# c++ - OpenThemeData 函数有哪些可能的类？

> ID：217532
> 
> 赞同：15
> 
> 时间：2008-10-20T04:44:43.660
> 
> 标签：c++, winapi, mfc, themes, msdn

我正在尝试调用 OpenThemeData （请参阅 msdn [OpenThemeData](http://msdn.microsoft.com/en-us/library/bb759821%28v=VS.85%29.aspx)）函数，但我无法确定`pszClassList`参数传递的可接受的类名称是什么。

```
HTHEME OpenThemeData(      
    HWND hwnd,
    LPCWSTR pszClassList
); 
```

谁能告诉我可以传递给该参数的可接受的类名是什么？谢谢！

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2011-06-30T18:55:57.623

The article [**Parts and States**](http://msdn.microsoft.com/en-us/library/bb773210%28v=VS.85%29.aspx) on MSDN contains a table which shows the *control classes*, *parts*, and *states*. The values in the table are defined in `Vsstyle.h` and `Vssym32.h`.

Here is a quick reference:

```
BUTTON, CLOCK, COMBOBOX, COMMUNICATIONS, CONTROLPANEL, DATEPICKER, DRAGDROP, 
EDIT, EXPLORERBAR, FLYOUT, GLOBALS, HEADER, LISTBOX, LISTVIEW, MENU, MENUBAND, 
NAVIGATION, PAGE, PROGRESS, REBAR, SCROLLBAR, SEARCHEDITBOX, SPIN, STARTPANEL, 
STATUS, TAB, TASKBAND, TASKBAR, TASKDIALOG, TEXTSTYLE, TOOLBAR, TOOLTIP, 
TRACKBAR, TRAYNOTIFY, TREEVIEW, WINDOW 
```

The answer to the question [Windows Visual Themes: Gallery of Parts and States?](https://stackoverflow.com/questions/4009701/windows-visual-themes-gallery-of-parts-and-states/4009712#4009712) provides a *"Parts and States Explorer"* application where you can browse and test most of the styles.

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-20T06:30:24.650

您可以在“AeroStyle.xml”中查看之前的海报，其中提供了 Vista/Aero 的确切列表。但是，如果您想安全起见（并且您可能会这样做），类名通常应该是 Windows 通用控件的 Windows 类名。例如，按钮和复选框使用类名“Button”，编辑控件“Edit”等。我通常选择最接近我正在处理的任何自定义元素的控件的类名，并使用主题数据。这样，您将获得适用于 XP、Vista 和（希望）Windows 7 的代码，无论用户选择的主题实际上是什么。

但是，除非您经常使用原始 Win32，否则您可能不会直接使用类名创建太多控件。类名在整个 MSDN 中相当随意地散布。一个好的起点通常是 Platform SDK 中的“CommCtrl.h”文件，其中有很多，而且它们总是在 MSDN 帮助中对各个常用控件进行描述。您还可以经常通过在文本编辑器中打开 .rc 文件来查看对话框是如何定义的：这些包含控件的类名。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2018-11-21T15:22:51.123

I know this is an old question, but I want to give an updated answer (2018) for those who come here from Google.

The accepted answer of DavidK says to look into the file "**AeroStyle.xml**" where the themes are defined. This file was part of the Windows 7 SDK, but has been removed from the Windows 10 SDK, so the accepted answer is not useful anymore.

The answer of splash links to the **MSDN** where the list of theme names, parts and states is highly incompetlete and not updated.

The themes are drawn by **UxTheme.dll** which reads the images and colors, etc. from the file **aero.msstyles** in the folder `C:\Windows\Resources\Themes\Aero` on Windows 10.

But when you open this file in a hex editor you will not find the names of all themes. I don't know if there is a way to enumerate all existing theme class names which can be passed to `OpenThemeData()`. I suppose that this is not possible.

But what I know for sure is that in Windows 10 build 18282 Microsoft has removed the theme "`Clock`" which is not used anymore and lots of undocumented themes have been added like for example: "`TaskBand2CompositedSmallIconsVertical8Light::Taskband2`" which is passed as theme class name to `OpenThemeData()`.

And I also know that several themes can only be obtained if you pass the correct window handle. If you pass the handle of the wrong window you may get another theme handle than expected or even `NULL`.

I also know that Microsoft in the last 2 years internally has changed all their code to use `OpenThemeDataForDpi()` instead of `OpenThemeData()` because each monitor on Windows 10 may have a different resolution.

The problem that we have here is a severe lack of documentation in the MSDN and a lack of an API function to enumerate all availabe themes.

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-20T05:25:17.433

类名取决于主题。例如，正如[OpenThemeData](http://msdn.microsoft.com/en-us/library/bb759821(VS.85).aspx)的文档所述：

> Aero 主题的类名在 AeroStyle.xml 中定义，该文件位于 Microsoft Windows 软件开发工具包 (SDK) 的 Include 文件夹中。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-20T13:26:14.873

它与 Aero 无关，它甚至不会在 XP 上退出！请参阅 OpenThemeData() 的源代码。

# compiler-construction - 程序员的记事本没有捕获 Make 输出？

> ID：217538
> 
> 赞同：3
> 
> 时间：2008-10-20T04:47:01.630
> 
> 标签：compiler-construction, programmers-notepad

我已经使用 Programmer's notepad 一段时间了，我发现它是一个非常简单的工具，我更喜欢在我知道我不需要大部分标准 IDE 开销的项目中使用它。但是，我最近在 Windows Vista 上运行程序时遇到了这个问题。

我发现在运行内置的“make”命令时，make.exe 的输出并没有像预期的那样在窗口中捕获。错误代码被捕获，但无论程序实际输出什么，输出总是完全空白。（从命令行运行程序可以很好地显示输出，就像在不使用 PN 的“捕获输出”选项的情况下运行它一样。）有人知道这可能是什么原因吗？

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-04T16:29:54.657

好吧，我对这个问题的部分解决方案是切换编译器。显然，Programmer's Notepad 不喜欢 Windows Vista 上 DJGPP 的输出，可能是因为 DJGPP 不是一个完整的端口，并且无论如何都有各种其他问题。解决方案是只使用不同的编译器。我们现在在这个项目中使用 MinGW，一旦我们解决了链接器问题，它就解决了我们的大部分问题。

不过，如果有人有办法让 DJGPP 与 PN 一起工作（我知道仍有一些项目依赖它），那么知道会很有帮助。

# checksum - JPEG内置校验和/指纹？

> ID：217544
> 
> 赞同：7
> 
> 时间：2008-10-20T04:53:59.167
> 
> 标签：checksum, jpeg, fingerprint

我正在编写一个脚本来查找大型图像库中的删除重复项。目前我正在做一个两通过滤器，首先查找相同大小的文件，然后对文件的 10240 字节片段执行 sha256 以获得具有相同大小的文件的指纹（[此处](http://parand.com/say/index.php/2008/10/15/python-script-for-finding-and-removing-duplicate-files/)的代码）。

它工作得很好，但我猜可能有内置于 jpeg 格式的校验和，我可以使用它来代替 sha256。

有谁知道是否有校验和或其他可以充当校验和/指纹的组件？如果是这样，是否有一种有效的方法来访问它们？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-20T05:01:17.230

我认为 JPEG 规范不包含您所描述的任何类型的校验和。

不过，JPEG 可以包含缩略图作为其 EXIF 元数据的一部分。这不是一个完美的指标，因为两个不同的图像可能具有相同的缩略图。至少有一个记录在案的情况是，在图像经过大量修改后，缩略图没有被替换，称缩略图显示的内容远远超出了出版商的预期。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-20T05:00:23.020

自从我研究 IJG 库以来已经有一段时间了，但我认为没有一个简单的类成员或函数调用可以用来检查某种类型的指纹。如果您可以控制图像的编码，则可以使用内置的 EXIF 标签...

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-01-03T04:13:52.763

我刚刚构建了一个非常相似的脚本。我不想校验和元数据我想查看实际图像是否重复，即使标签已被修改。最好的方法不是按大小排序，而是按校验和 istelf 排序。我使用 jhead 删除元数据，然后对整个文件进行校验和（但我也想过只做一部分，但实际上我认为它不会节省太多时间）。jhead 不使用共享内存（管道）并且会覆盖，所以我只是先将文件复制到共享内存。我将校验和放在 ImageDescription 字段中，以便以后更快地检索。显然，这也允许稍后检查图像完整性，这也是我校验整个事情的部分原因。提示：exiv2 在读取和写入元数据方面比 exiftool 在一次基于决策的操作方面快得多。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-20T05:04:10.267

在JPEG标准（ITU-T.81）中，我相信对于整个压缩的jpeg图像文件，没有任何具有校验和等的字段/语法元素。除非定制的应用程序将此类文件放在应用程序段中，或者作为标准中提供的段的元数据。因此，为了达到您的目的，您所做的只是一个解决方案。其他可能是某种应用程序包装器，它将调用一些二进制文件比较实用程序（例如超越比较，甚至是 Windows 命令**fc /b**）并检查该比较实用程序的结果并做出您想要的决定。

-广告

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-20T13:06:38.717

您可以执行的一种方法是将所有图像缩小到固定大小并将其存储为缩略图。然后，图像比较将比较相似大小的图像，并为您提供复制的机会 - 如果您已裁剪（除非裁剪严重）或调整大小的图像并希望找到那些“重复”，这很有用。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-09-09T11:53:21.243

In the XMP specification there are document ID and version ID which should uniquely identify the version of the image.

The problem with these (and with any other metadata-based identification method) is that it might not be respected by some applications that can change the content of the jpeg updating the metadata accordingly.

# security - 安全和策略注入应用程序块

> ID：217547
> 
> 赞同：1
> 
> 时间：2008-10-20T04:56:58.770
> 
> 标签：security, policy-injection

我有一个混合 UI（Win 应用程序、WPF 应用程序，很快还有一个 ASP.NET MVC 应用程序）设置，到目前为止，我正在使用客户端应用程序服务来确保安全。我知道如何以编程方式让用户通过身份验证，并且这样做效果很好。然而...

我想实现一些横切，基本上检查用户是否一直经过身份验证。由于一切都将访问 Web 服务，因此我希望将其作为 UI 所做的几乎所有事情的标准执行。到目前为止，我认为 PIAB - 策略注入应用程序块 - 将提供该功能。我想知道的是两件事；

1 PIAB 会涵盖所需的功能吗？如果针对 UI 使用，在每个实际步骤验证身份验证？

...和...

2 除了 PIAB，还有其他选择吗？我很想对面向方面的策略注入框架进行比较。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-20T11:13:56.900

我对客户端应用程序服务不是很熟悉，但根据我的经验，大多数 AOP 框架都包装接口以实现横切功能。如果 CAS 使用接口，您可能只需将它们包装为您需要的任何功能。

替代 AOP 框架：

*   [春天.NET](http://www.springframework.net/)
*   [城堡动态代理](http://www.castleproject.org/dynamicproxy/index.html)

Spring.NET 和动态代理似乎以几乎相同的方式工作，并且在我的 Hello World 类型测试中具有相同的性能（大约介于直接调用和通过反射调用之间）。PIAB 比这两个框架都慢得多，而且我发现它更冗长。它确实能够通过 xml 进行配置，我不确定这是否是一件好事。不确定其他框架是否提供。它当然有 MS 的批准印章：P。

# design-patterns - 您使用的是 C++ 中的哪个类型安全枚举？

> ID：217549
> 
> 赞同：45
> 
> 时间：2008-10-20T04:58:33.603
> 
> 标签：design-patterns, enums, enumeration, type-safety, c++03

众所周知，C++ 中的内置枚举不是类型安全的。我想知道那里使用了哪些实现类型安全枚举的类......我自己使用以下“自行车”，但它有点冗长和有限：

typesafeenum.h：

```
struct TypesafeEnum
{
// Construction:
public:
    TypesafeEnum(): id (next_id++), name("") {}
    TypesafeEnum(const std::string& n): id(next_id++), name(n) {}

// Operations:
public:
    bool operator == (const TypesafeEnum& right) const;
    bool operator != (const TypesafeEnum& right) const;
    bool operator < (const TypesafeEnum& right) const;

    std::string to_string() const { return name; }

// Implementation:
private:
    static int next_id;
    int id;
    std::string name;
}; 
```

typesafeenum.cpp：

```
int TypesafeEnum::next_id = 1;

bool TypesafeEnum::operator== (const TypesafeEnum& right) const 
{ return id == right.id; }

bool TypesafeEnum::operator!= (const TypesafeEnum& right) const 
{ return !operator== (right); }

bool TypesafeEnum::operator< (const TypesafeEnum& right) const  
{ return id < right.id; } 
```

用法：

```
class Dialog 
{
 ...
    struct Result: public TypesafeEnum
    {
        static const Result CANCEL("Cancel");
        static const Result OK("Ok");
    };

    Result doModal();
 ...
};

const Dialog::Result Dialog::Result::OK;
const Dialog::Result Dialog::Result::CANCEL; 
```

**补充：** 我认为我应该对要求更具体。我将尝试总结它们：

优先级 1：将枚举变量设置为无效值应该是不可能的（编译时错误），没有例外。

优先级 2：应该可以通过单个显式函数/方法调用将枚举值转换为 int。

优先级3：尽可能简洁、优雅、方便的声明和使用

优先级 4：将枚举值与字符串转换。

Priority 5: (Nice to have) Possibility to iterate over enum values.

* * *

## 回答 #1

> 赞同：42
> 
> 时间：2009-01-13T13:51:09.080

I'm currently playing around with the Boost.Enum proposal from the [Boost Vault](https://github.com/boost-vault/Miscellaneous) (filename `enum_rev4.6.zip`). Although it was never officially submitted for inclusion into Boost, it's useable as-is. (Documentation is lacking but is made up for by clear source code and good tests.)

Boost.Enum lets you declare an enum like this:

```
BOOST_ENUM_VALUES(Level, const char*,
    (Abort)("unrecoverable problem")
    (Error)("recoverable problem")
    (Alert)("unexpected behavior")
    (Info) ("expected behavior")
    (Trace)("normal flow of execution")
    (Debug)("detailed object state listings")
) 
```

And have it automatically expand to this:

```
class Level : public boost::detail::enum_base<Level, string>
{
public:
    enum domain
    {
        Abort,
        Error,
        Alert,
        Info,
        Trace,
        Debug,
    };

    BOOST_STATIC_CONSTANT(index_type, size = 6);

    Level() {}
    Level(domain index) : boost::detail::enum_base<Level, string>(index) {}

    typedef boost::optional<Level> optional;
    static optional get_by_name(const char* str)
    {
        if(strcmp(str, "Abort") == 0) return optional(Abort);
        if(strcmp(str, "Error") == 0) return optional(Error);
        if(strcmp(str, "Alert") == 0) return optional(Alert);
        if(strcmp(str, "Info") == 0) return optional(Info);
        if(strcmp(str, "Trace") == 0) return optional(Trace);
        if(strcmp(str, "Debug") == 0) return optional(Debug);
        return optional();
    }

private:
    friend class boost::detail::enum_base<Level, string>;
    static const char* names(domain index)
    {
        switch(index)
        {
        case Abort: return "Abort";
        case Error: return "Error";
        case Alert: return "Alert";
        case Info: return "Info";
        case Trace: return "Trace";
        case Debug: return "Debug";
        default: return NULL;
        }
    }

    typedef boost::optional<value_type> optional_value;
    static optional_value values(domain index)
    {
        switch(index)
        {
        case Abort: return optional_value("unrecoverable problem");
        case Error: return optional_value("recoverable problem");
        case Alert: return optional_value("unexpected behavior");
        case Info: return optional_value("expected behavior");
        case Trace: return optional_value("normal flow of execution");
        case Debug: return optional_value("detailed object state listings");
        default: return optional_value();
        }
    }
}; 
```

It satisfies all five of the priorities which you list.

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2008-10-20T05:09:03.863

A nice compromise method is this:

```
struct Flintstones {
   enum E {
      Fred,
      Barney,
      Wilma
   };
};

Flintstones::E fred = Flintstones::Fred;
Flintstones::E barney = Flintstones::Barney; 
```

It's not typesafe in the same sense that your version is, but the usage is nicer than standard enums, and you can still take advantage of integer conversion when you need it.

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2009-01-13T14:09:42.133

I use [C++0x typesafe enums](http://en.wikipedia.org/wiki/C%2B%2B0x#Strongly_typed_enumerations). I use some helper template/macros that provide the to/from string functionality.

```
enum class Result { Ok, Cancel}; 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-10-20T05:04:33.933

I don't. Way too much overhead for little benefit. Also, being able to caste enumerations to different data types for serialization is a very handy tool. I have never seen an instance where a "Type safe" enumeration would be worth the overhead and complexity where C++ offers a good enough implementation already.

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-20T15:09:24.087

My take is that you're inventing a problem and then fitting a solution onto it. I see no need to do an elaborate framework for an enumeration of values. If you are *dedicated* to having your values only be members of a certain set, you could hack up a variant of a unique set datatype.

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2012-08-08T02:08:05.700

I'm personally using an adapted version of the [typesafe enum idiom](https://en.wikibooks.org/wiki/More_C%2B%2B_Idioms/Type_Safe_Enum). It doesn't provide all the five "requirements" that you've stated in your edit, but I strongly disagree with some of them anyway. For example, I don't see how Prio#4 (conversion of values to strings) has anything to do with type safety. Most of the time string representation of individual values should be separate from the definition of the type anyway (think i18n for a simple reason why). Prio#5 (iteratio, which is optional) is one of the nicest things I'd like to see *naturally* happening in enums, so I felt sad that it appears as "optional" in your request, but it seems it is better addressed via a [separate iteration system](https://stackoverflow.com/questions/8498300/allow-for-range-based-for-with-enum-classes) such as `begin`/`end` functions or an enum_iterator, which makes them work seamlessly with STL and C++11 foreach.

OTOH this simple idiom nicely provides Prio#3 Prio#1 thanks to the fact that it mostly only wraps `enum`s with more type information. Not to mention it is a very simple solution that for the most part doesn't require any external dependency headers, so it's pretty easy to carry around. It also has the advantage of making enumerations scoped a-la-C++11:

```
// This doesn't compile, and if it did it wouldn't work anyway
enum colors { salmon, .... };
enum fishes { salmon, .... };

// This, however, works seamlessly.
struct colors_def { enum type { salmon, .... }; };
struct fishes_def { enum type { salmon, .... }; };

typedef typesafe_enum<colors_def> colors;
typedef typesafe_enum<fishes_def> fishes; 
```

The only "hole" that solution provides is that it doesn't address the fact that it doesn't prevent `enum`s of different types (or an `enum` and an int) from being directly compared, because when you use values directly you force the implicit conversion to `int`:

```
if (colors::salmon == fishes::salmon) { .../* Ooops! */... } 
```

But so far I've found such problems can be solved by simply offering a better comparison to the compiler - for example, explicitly providing an operator that compares any two different `enum` types, then forcing it to fail:

```
// I'm using backports of C++11 utilities like static_assert and enable_if
template <typename Enum1, typename Enum2>
typename enable_if< (is_enum<Enum1>::value && is_enum<Enum2>::value) && (false == is_same<Enum1,Enum2>::value) , bool >
::type operator== (Enum1, Enum2) {
    static_assert (false, "Comparing enumerations of different types!");
} 
```

Though it doesn't seem to break code so far, and it does to explicitly deal with the specific problem without doing something else, I'm not sure it such thing is a thing one "*should*" do (I suspect it will interfere with `enum`s already taking part in conversion operators declared elsewhere; I'd gladly receive commentary about this).

Combining this with the above typesafe idiom gives something that is relatively close to C++11 `enum class` in humanibility (readability and maintainability) without having to do anything too obscure. And I have to admit it was fun to do, I had never thought to actually *ask* the compiler if I was dealing with `enum`s or not...

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-20T05:08:13.113

I think the Java `enum` would be a good model to follow. Essentially, the Java form would look like this:

```
public enum Result {
    OK("OK"), CANCEL("Cancel");

    private final String name;

    Result(String name) {
        this.name = name;
    }

    public String getName() {
        return name;
    }
} 
```

What's interesting about the Java approach is that `OK` and `CANCEL` are immutable, singleton instances of `Result` (with the methods that you see). You cannot create any further instances of `Result`. Since they're singletons, you can compare by pointer/reference---very handy. :-)

ETA: In Java, instead of doing bitmasks by hand, instead you use an `EnumSet` to specify a bit set (it implements the `Set` interface, and works like sets---but implemented using bitmasks). Much more readable than hand-written bitmask manipulation!

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-20T07:31:13.030

I gave an answer to this [here](https://stackoverflow.com/questions/201593/is-there-a-simple-script-to-convert-c-enum-to-string#202529), on a different topic. It's a different style of approach which allows most of the same functionality without requiring modification to the original enum definition (and consequently allowing usage in cases where you don't define the enum). It also allows runtime range checking.

The downside of my approach is that it doesn't programmatically enforce the coupling between the enum and the helper class, so they have to be updated in parallel. It works for me, but YMMV.

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2015-01-16T08:51:14.537

I am currently writing my own typesafe enum library at [https://bitbucket.org/chopsii/typesafe-enums](https://bitbucket.org/chopsii/typesafe-enums)

I am not the most experienced C++ developer ever, but I am writing this due to the shortcomings of the BOOST vault enums.

Feel free to check it out and use them yourself, but they have some (hopefully minor) usability issues, and are probably not at all cross-platform.

Please contribute if you want to. This is my first open source undertaking.

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2016-10-06T19:49:02.950

Use `boost::variant`!

After trying a lot of the above ideas and finding them lacking I hit upon this simple approach:

```
#include <iostream>
#include <boost/variant.hpp>

struct A_t {};
static const A_t A = A_t();
template <typename T>
bool isA(const T & x) { if(boost::get<A_t>(&x)) return true; return false; }

struct B_t {};
static const B_t B = B_t();
template <typename T>
bool isB(const T & x) { if(boost::get<B_t>(&x)) return true; return false; }

struct C_t {};
static const C_t C = C_t();
template <typename T>
bool isC(const T & x) { if(boost::get<C_t>(&x)) return true; return false; }

typedef boost::variant<A_t, B_t> AB;
typedef boost::variant<B_t, C_t> BC;

void ab(const AB & e)
{
  if(isA(e))
    std::cerr << "A!" << std::endl;
  if(isB(e))
    std::cerr << "B!" << std::endl;
  // ERROR:
  // if(isC(e))
  //   std::cerr << "C!" << std::endl;

  // ERROR:
  // if(e == 0)
  //   std::cerr << "B!" << std::endl;
}

void bc(const BC & e)
{
  // ERROR:
  // if(isA(e))
  //   std::cerr << "A!" << std::endl;

  if(isB(e))
    std::cerr << "B!" << std::endl;
  if(isC(e))
    std::cerr << "C!" << std::endl;
}

int main() {
  AB a;
  a = A;
  AB b;
  b = B;
  ab(a);
  ab(b);
  ab(A);
  ab(B);
  // ab(C); // ERROR
  // bc(A); // ERROR
  bc(B);
  bc(C);
} 
```

You can probably come up with a macro to generate the boilerplate. (Let me know if you do.)

Unlike other approaches this one is actually type-safe and works with old C++. You can even make cool types like `boost::variant<int, A_t, B_t, boost::none>`, for example, to represent a value that could be A, B, an integer or nothing which is almost Haskell98 levels of type safety.

Downsides to be aware of:

*   at-least with old boost -- I'm on a system with boost 1.33 -- you are limited to 20 items in your variant; there is a work-around however
*   affects compile time
*   insane error messages -- but that's C++ for you

## Update

Here, for your convenience is your typesafe-enum "library". Paste this header:

```
#ifndef _TYPESAFE_ENUMS_H
#define _TYPESAFE_ENUMS_H
#include <string>
#include <boost/variant.hpp>

#define ITEM(NAME, VAL) \
struct NAME##_t { \
  std::string toStr() const { return std::string( #NAME ); } \
  int toInt() const { return VAL; } \
}; \
static const NAME##_t NAME = NAME##_t(); \
template <typename T> \
bool is##NAME(const T & x) { if(boost::get<NAME##_t>(&x)) return true; return false; } \

class toStr_visitor: public boost::static_visitor<std::string> {
public:
  template<typename T>
  std::string operator()(const T & a) const {
    return a.toStr();
  }
};

template<BOOST_VARIANT_ENUM_PARAMS(typename T)>
inline static
std::string toStr(const boost::variant<BOOST_VARIANT_ENUM_PARAMS(T)> & a) {
  return boost::apply_visitor(toStr_visitor(), a);
}

class toInt_visitor: public boost::static_visitor<int> {
public:
  template<typename T>
  int operator()(const T & a) const {
    return a.toInt();
  }
};

template<BOOST_VARIANT_ENUM_PARAMS(typename T)>
inline static
int toInt(const boost::variant<BOOST_VARIANT_ENUM_PARAMS(T)> & a) {
  return boost::apply_visitor(toInt_visitor(), a);
}

#define ENUM(...) \
typedef boost::variant<__VA_ARGS__>
#endif 
```

And use it like:

```
ITEM(A, 0);
ITEM(B, 1);
ITEM(C, 2);

ENUM(A_t, B_t) AB;
ENUM(B_t, C_t) BC; 
```

Notice you have to say `A_t` instead of `A` in the `ENUM` macro which destroys some of the magic. Oh well. Also, notice there's now a `toStr` function and a `toInt` function to meet OPs requirement of simple conversion to strings and ints. The requirement I can't figure out is a way to iterate over the items. Let me know if you know how to write such a thing.

* * *

## 回答 #11

> 赞同：-2
> 
> 时间：2009-06-07T23:52:15.467

Not sure if this post is too late, but there's an article on GameDev.net which satisfies all but the 5th point (ability to iterate over enumerators): [http://www.gamedev.net/reference/snippets/features/cppstringizing/](http://www.gamedev.net/reference/snippets/features/cppstringizing/)

The method described by the article allows string conversion support for **existing enumerations** without changing their code. If you only want support for new enumerations though, I'd go with Boost.Enum (mentioned above).

# java - 如何创建一个表示 Java 的字符串，就好像它是无符号的 64 位值一样

> ID：217551
> 
> 赞同：3
> 
> 时间：2008-10-20T04:59:38.670
> 
> 标签：java, unsigned

我的组件被传递了一个长值，我稍后将其用作缓存中的键。密钥本身是 long 值的字符串表示形式，就好像它是无符号的 64 位值一样。也就是说，当我的组件被交给-2944827264075010823L时，我需要将其转换为字符串键“15501916809634540793”。

我有一个解决方案，但它似乎是蛮力的，它让我有点反胃。本质上，我将 long 转换为十六进制字符串表示形式（因此 -2944827264075010823L 变为“d721df34a7ec6cf9”）并将十六进制字符串转换为 BigInteger：

```
String longValueAsHexString = convertLongToHexString(longValue);
BigInteger bi = new BigInteger(longValueAsHexString, 16);
String longValueString = bi.toString(); 
```

然后我使用 longValueString 作为进入缓存的键。

我不能使用 Long.toString(longValue,16)，因为它返回绝对值的十六进制字符串，前缀为“-”。

所以我的 convertLongToHexString 看起来像这样：

```
long mask = 0x00000000ffffffffL;
long bottomHalf = number & mask;
long upperHalf = (number >> 32) & mask;
String bottomHalfString = Long.toString(bottomHalf, 16);
if (bottomHalfString.length() != 8) {
    String zeroes = "0000000000000000";
    bottomHalfString = zeroes.substring(16-bottomHalfString.length()) + bottomHalfString;
}
return Long.toString(upperHalf,16)+bottomHalfString; 
```

必须有一种更优雅的方式来做到这一点。有什么建议么？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-20T05:21:54.087

这是我的实现。我已经对其进行了重构，使其具有一个接受 a`long`并返回一个字符串的函数。:-)

```
import java.math.BigInteger;

class UInt64Test {
    public static void main(String[] args) {
        for (String arg : args)
            System.out.println(toUnsignedString(Long.parseLong(arg)));
    }

    private static final BigInteger B64 = BigInteger.ZERO.setBit(64);
    public static String toUnsignedString(long num) {
        if (num >= 0)
            return String.valueOf(num);
        return BigInteger.valueOf(num).add(B64).toString();
    }
} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-20T06:04:32.330

我认为克里斯的答案更好，但这是另一个只是为了好玩。

```
public static String longUnsignedString(long l) {
  byte[] bytes = new byte[9];

  for (int i = 1; i < 9; i++) {
     bytes[i] = (byte) ((l >> ((8 - i) * 8)) & 255);
  }

  return (new BigInteger(bytes)).toString();
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2013-05-29T16:14:05.053

晚了五年，但这是一个不使用`BigInteger`字节数组的实现。
相反，它模拟无符号除法一步并将其余部分卸载到标准库函数：

```
public static String unsignedToString(long n) {
    long temp = (n >>> 1) / 5;  // Unsigned divide by 10 and floor
    if (temp == 0)
        return Integer.toString((int)n);  // Single digit
    else
        return Long.toString(temp) + (n - temp * 10);  // Multiple digits
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-09-14T13:41:01.193

无位实现：

```
 byte[] bytes = ByteBuffer.allocate(8).putLong(1023L).array();
    System.out.println(new BigInteger(bytes).toString(2)); 
```

问候，亚历克斯

# php - php_uname() 有多快？

> ID：217555
> 
> 赞同：3
> 
> 时间：2008-10-20T05:02:58.803
> 
> 标签：php, optimization, uname

[php_uname()](http://php.net/manual/en/function.php-uname.php)说做`php_uname('s n')`or的速度有多快`php_uname('a')`？我问的原因是因为我想用它来确定我在哪个服务器上，从而确定配置（路径等）。

这与[是否有提供本地主机名的 PHP 函数或变量有关？](https://stackoverflow.com/questions/211885/is-there-a-php-function-or-variable-giving-the-local-host-name)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-20T05:12:36.507

我只是这样做了：

```
<?php
  $tstart = microtime(true);

  php_uname('a');

  print 'it took '. sprintf("%f",microtime(true) - $tstart) ." seconds\n";
?> 
```

它产生了这个：

```
it took 0.000016 seconds 
```

那是在 Core2Duo 2.4GHz Debian 盒子上。

我知道这是一个经验测试，但我认为它表明它对你来说足够快。

我没想到会花很长时间，因为 uname 只需要对内核进行非常简单的调用。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-23T10:06:31.997

```
$_SERVER['HTTP_HOST'] 
```

# algorithm - 有哪些确定性垃圾收集算法？

> ID：217565
> 
> 赞同：18
> 
> 时间：2008-10-20T05:10:15.530
> 
> 标签：algorithm, garbage-collection, real-time, deterministic

通过确定性，我含糊其词的意思是可以用于关键的实时软件，如航空航天飞行软件。垃圾收集器（以及与此相关的动态内存分配）是飞行软件中的大禁忌，因为它们被认为是非确定性的。但是，我知道对此正在进行研究，所以我想知道这个问题是否已经解决。

我还在问题中包括了任何对它们的使用方式施加限制的垃圾收集算法。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-10-21T12:17:58.550

我知道我可能会对此回复投下很多反对票，但是如果您一开始就已经在尝试避免动态内存，因为您说这是不行的，那您为什么还要使用 GC？我永远不会在可预测的运行时速度是主要关注点的实时系统中使用 GC。我会尽可能避免使用动态内存，因此开始时动态对象非常非常少，然后我会手动处理非常少的动态分配，因此我可以 100% 控制何时释放某些内容以及它在哪里释放。毕竟不仅 GC 不是确定性的，free() 和 malloc() 一样没有确定性。没有人说 free() 调用只需将内存标记为空闲。它不妨尝试将围绕已释放的较小的空闲内存块组合成一个大的空闲内存块，这种行为不是确定性的，

在一个关键的实时系统中，您甚至可以用不同的实现替换系统标准 malloc()/free()，甚至可能编写自己的实现（这并不像听起来那么难！我以前这样做只是为了好玩其中）最具有确定性。对我来说，GC 是一件很方便的事情，它让程序员不再专注于复杂的 malloc()/free() 规划，而是让系统自动处理这个问题。它有助于进行快速软件开发，并节省数小时的调试工作查找和修复内存泄漏。但就像我永远不会在操作系统内核中使用 GC 一样，我也永远不会在关键的实时应用程序中使用它。

如果我需要更复杂的内存处理，我可能会编写我自己的 malloc()/free() 来按需要（并且最具确定性）工作，并在其上编写我自己的引用计数模型。引用计数仍然是手动内存管理，但比仅使用 malloc()/free() 要舒服得多。它不是超快的，但具有确定性（至少增加/减少引用计数器的速度是确定性的），除非您可能有循环引用，否则如果您在整个应用程序中遵循保留/释放策略，它将捕获所有死内存。唯一不确定的部分是您不知道调用 release 是否只会减少引用计数器或真正释放对象（取决于引用计数是否为零），但您可以通过提供延迟实际释放说“releaseWithoutFreeing”的功能 ，它将引用计数器减一，但即使它达到零，它也不会释放（）对象。你的 malloc()/free() 实现可以有一个函数“findDeadObjects”，它搜索所有保留计数器为零的对象，这些对象还没有被释放并释放它们（稍后，当你不那么关键时有更多时间处理此类任务的代码的一部分）。由于这也不是确定性的，您可以像“findDeadObjectsForUpTo(ms)”一样限制它可能使用的时间量，ms 是它可能用于查找和释放它们的毫秒量，这个时间会尽快返回量子已被使用，因此您不会在此任务上花费太多时间。你的 malloc()/free() 实现可以有一个函数“findDeadObjects”，它搜索所有保留计数器为零的对象，这些对象还没有被释放并释放它们（稍后，当你不那么关键时有更多时间处理此类任务的代码的一部分）。由于这也不是确定性的，您可以像“findDeadObjectsForUpTo(ms)”一样限制它可能使用的时间量，ms 是它可能用于查找和释放它们的毫秒量，这个时间会尽快返回量子已被使用，因此您不会在此任务上花费太多时间。你的 malloc()/free() 实现可以有一个函数“findDeadObjects”，它搜索所有保留计数器为零的对象，这些对象还没有被释放并释放它们（稍后，当你不那么关键时有更多时间处理此类任务的代码的一部分）。由于这也不是确定性的，您可以像“findDeadObjectsForUpTo(ms)”一样限制它可能使用的时间量，ms 是它可能用于查找和释放它们的毫秒量，这个时间会尽快返回量子已被使用，因此您不会在此任务上花费太多时间。当您处于代码中不太重要的部分，有更多时间处理此类任务时）。由于这也不是确定性的，您可以像“findDeadObjectsForUpTo(ms)”一样限制它可能使用的时间量，ms 是它可能用于查找和释放它们的毫秒量，这个时间会尽快返回量子已被使用，因此您不会在此任务上花费太多时间。当您处于代码中不太重要的部分，有更多时间处理此类任务时）。由于这也不是确定性的，您可以像“findDeadObjectsForUpTo(ms)”一样限制它可能使用的时间量，ms 是它可能用于查找和释放它们的毫秒量，这个时间会尽快返回量子已被使用，因此您不会在此任务上花费太多时间。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-10-20T05:34:10.143

[Metronome GC](http://domino.watson.ibm.com/comm/research_projects.nsf/pages/metronome.metronomegc.html)和[BEA JRockit](http://www.bea.com/content/news_events/white_papers/BEA_JRockit_Deterministic_GC_wp.pdf)是我所知道的两个确定性 GC 实现（都用于 Java）。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2012-06-23T23:36:47.670

碰巧正在通过 Stack Overflow 搜索并注意到这个相当老的帖子。

Jon Anderson 提到了 JamaicaVM。由于这些帖子已经发布了 4 年多，我认为回复此处发布的一些信息很重要。

我为 aicas 工作，它是 JamaicaVM、JamaicaCAR 和 Veriflux 的开发人员和营销人员。

JamaicaVM 确实有一个硬实时垃圾收集器。它是完全抢先的。实时操作系统所需的完全相同的行为。尽管抢占延迟取决于 CPU 速度，但假设在 Ghz 级处理器上，垃圾收集器的抢占时间小于 1 微秒。有一个 32 位单核版本，每个进程地址空间支持高达 3 GB 的内存。有一个 32 位多核版本，支持每个进程地址空间和多核 3 GB 内存。还有 64 位单核和多核版本，每个进程地址空间支持高达 128 GB 的内存。垃圾收集器的性能与内存大小无关。针对有关运行 GC 完全耗尽内存的响应之一，对于硬实时系统，您不会设计您的程序来做到这一点。尽管实际上您可以在这种情况下使用硬实时 GC，但您必须考虑到您的应用程序可能无法接受的最坏情况执行时间。

相反，正确的方法是分析您的程序以获得最大内存分配，然后将硬实时垃圾收集器配置为在所有先前分配期间增量释放块，以便描述的特定场景永远不会发生。这称为线程分布式、工作节奏的垃圾收集。

Siebert 博士关于硬实时垃圾收集器的书描述了如何实现这一点，并提供了一个正式的证据，证明垃圾收集器将跟上应用程序，而不是成为 O(N) 操作。

了解实时垃圾收集意味着几件事非常重要：

1.  垃圾收集器是可抢占式的，就像任何其他操作系统服务一样
2.  从数学上可以证明，垃圾收集器会跟上，这样内存就不会因为一些内存还没有被回收而耗尽。
3.  垃圾收集器不会对内存进行碎片化，只要有可用内存，内存请求就会成功。
4.  此外，您将需要它成为具有优先级反转保护、固定优先级线程调度程序和其他功能的系统的一部分。有关这方面的一些信息，请参阅 RTSJ。

尽管安全关键应用程序需要硬实时垃圾收集，但它也可以用于任务关键型应用程序和通用 Java 应用程序。使用硬实时垃圾收集器没有固有的限制。对于一般用途，您可以期待更顺畅的程序执行，因为没有长时间的垃圾收集器暂停。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-20T08:08:56.807

对我来说，100% 实时的 Java 在很大程度上仍然是一项屡试不爽的技术，但我并不声称自己是专家。

我建议阅读这些文章 - [Cliff Click 博客](http://blogs.azulsystems.com/cliff/)。他是 Azul 的架构师，几乎编写了所有标准 1.5 Java 并发类等...仅供参考，Azul 专为需要非常大堆大小的系统而设计，而不仅仅是标准 RT 要求。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-16T07:59:18.980

它不是 GC，但有简单的 O(1) 固定大小的块分配/释放方案，您可以使用它来进行简单的使用。例如，您可以使用固定大小块的空闲列表。

```
struct Block {
   Block *next;
}

Block *free_list = NULL; /* you will need to populate this at start, an 
                          * easy way is to just call free on each block you 
                          * want to add */

void release(void *p) {
    if(p != NULL) {
        struct Block *b_ptr = (struct Block *)p;
        b_ptr->next = free_list;
        free_list = b_ptr;
    }
}

void *acquire() {
    void *ret = (void *)free_list;
    if(free_list != NULL) {
        free_list = free_list->next;
    }
    return ret;
}

/* call this before you use acquire/free */
void init() {
    /* example of an allocator supporting 100 blocks each 32-bytes big */
    static const int blocks = 100;
    static const int size = 32;
    static unsigned char mem[blocks * size];
    int i;
    for(i = 0; i < blocks; ++i) {
        free(&mem[i * size]);
    }
} 
```

如果您有相应的计划，您可以将您的设计限制为只有几个特定大小以进行动态分配，并为每个潜在大小设置一个 free_list。如果您使用的是 c++，您可以实现一些简单的东西，例如 scoped_ptr（对于每个大小，我会使用模板参数）来获得更简单但仍然 O(1) 的内存管理。

唯一真正需要注意的是，您将*无法*避免双重释放，甚至不小心将 ptr 传递给不是来自获取的释放。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-04-10T02:42:25.500

Sun 已经广泛记录了他们的实时垃圾收集器，并提供了您可以在[此处](http://java.sun.com/javase/technologies/realtime/reference/doc_2.1/release/JavaRTSGarbageCollection.html)自己运行的基准测试。其他人提到了 Metronome，这是另一个主要的生产级 RTGC 算法。许多其他 RT JVM 供应商都有自己的实现——请参阅我的供应商列表，其中大多数都提供了大量文档[。](https://stackoverflow.com/questions/697916/what-languages-are-used-for-real-time-systems-programming/736502#736502)

如果您对航空电子/飞行软件特别感兴趣，我建议您看看[aicas](http://www.aicas.com)，这是一家专门针对航空电子行业进行营销的 RTSJ 供应商。 [Siebert 博士](http://aicas.com/fridtjof_siebert.html)（aicas CEO）的主页列出了一些学术出版物，其中详细介绍了 PERC 的 GC 实施。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-20T08:35:50.887

您可能会对以下博士论文 [CMU-CS-01-174 - Scalable Real-time Parallel Garbage Collection for Symmetric Multiprocessors](http://reports-archive.adm.cs.cmu.edu/cs2001.html)有一些运气。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-03-07T11:08:37.703

实时意味着响应时间有保证的上限。这意味着在您交付结果之前您可以执行的指令的上限。这也对您可以触摸的数据量设置了上限。如果您不知道您将需要多少内存，则极有可能您将有一个无法给出其执行时间上限的计算。Otoh，如果您知道计算的上限，您也知道它触及了多少内存（除非您真的不知道您的软件做了什么）。因此，您对代码的了解程度足以消除对 GC 的需求。

有一些特性，比如 RT-Java 中的区域，允许超越局部和全局（静态）变量的表达。但是它们不会免除您管理分配的内存的义务，因为否则您无法保证下一次分配不会因为内存资源不足而失败。

诚然：我对自称为“实时垃圾收集器”的东西有些怀疑。当然，如果您假设每个分配都运行一个完整的集合，那么任何 GC 都是实时的（这仍然不能保证它之后会成功，因为可能会发现所有内存块都是可访问的）。但是对于任何承诺较低分配时间限制的 GC，请考虑其在以下示例代码中的性能：

```
// assume that on `Link` object needs k bytes:
class Link {
    Link next = null;
    /* further fields */
    static Link head = null;
}

public static void main (String args) {
    // assume we have N bytes free now
    // set n := floor (N/k), assume that n > 1

    for (int i = 0; i < n; i ++) {
        Link tmp = new Link ();
        tmp.next = Link.head;
        Link.head = tmp;
    } 
    // (1)
    Link.head = Link.head.next; // (2)
    Link tmp = new Link ();  // (3)
} 
```

*   在第 (1) 点，我们只有不到 k 字节的空闲空间（分配另一个 `Link`对象会失败），并且 `Link`到目前为止分配的所有对象都可以从该 `Link.static Link head`字段开始访问。
*   在点 (2)，

    *   (a) 以前列表中的第一个条目现在无法访问，但是
    *   (b) 就内存管理部分而言，它仍然被分配。
*   在第 (3) 点，分配应该成功，因为 (2a) - 我们可以使用以前的第一个链接 - 但是，由于 (2b)，我们必须启动 GC，最终将遍历 n-1 个对象，因此运行时间为 O(N)。

所以，是的，这是一个人为的例子。但是声称对分配有限制的 GC 也应该能够掌握这个例子。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2012-12-12T17:26:51.110

我知道这篇文章有点过时了，但我做了一些有趣的研究，并希望确保它得到更新。

Azul Systems "Zing JVM" 和 JRocket 可以提供确定性 GC。Zing 带有一些非常有趣的附加功能，现在“100% 基于软件”（可以在 x86 机器上运行）。不过，它目前仅适用于 Linux ...

价格：如果您使用的是 Java 6 或之前的版本，Oracle 现在收取 300% 的升级费用并强制支持此功能（每个处理器 15,000 美元和 3,300 美元的支持）。Azul，据我所知，大约是 10,000 - 12,000 美元，但按物理机收费，而不是核心/处理器。此外，该过程按数量分级，因此您利用的服务器越多，折扣越深。我与他们的谈话表明他们非常灵活。Oracle 是永久许可，而 Zing 是基于订阅的……但如果您算一算并添加 Zing 具有的其他功能（请参阅下面的差异）。

您可以通过迁移到 Java 7 来降低成本，但会产生开发成本。鉴于 Oracle 的路线图（每 18 个月左右发布一个新版本），以及他们历来只免费提供最新版本和一个较旧版本的 Java SE 更新的事实，“免费”期限预计从最初的 GA 开始为 3 年如果有任何主要版本，请发布。由于最初的 GA 版本通常在 12 到 18 个月内不会在生产中采用，并且将生产系统迁移到新的主要 Java 版本通常会带来巨大的成本，这意味着 Java SE 支持费用将在初始部署后 6 到 24 个月之间开始达到.

显着差异：JRocket 在 RAM 方面仍然存在一些可扩展性限制（尽管比以前有所改进）。您可以通过一些调整来改善您的结果。Zing 设计了他们的算法以允许连续、并发、压缩（不停止世界暂停，也不需要“调整”）。这使得 Zing 可以在没有理论上的内存上限的情况下进行扩展（他们正在做 300+ GB 堆而不会遭受停止世界或崩溃的痛苦）。谈论范式改变者（想想对大数据的影响）。Zing 对锁定进行了一些非常酷的改进，通过一些工作使其具有惊人的性能（如果调整，平均可以达到亚毫秒级）。最后，它们可以查看生产中的类、方法和线程行为（无开销）。在考虑更新时，我们认为这可以节省大量时间，补丁和错误修复（例如泄漏和锁定）。这实际上可以消除在开发/测试中重新创建许多问题的需要。

我发现的 JVM 数据的链接：

[JRocket确定性GC](http://www.oracle.com/us/technologies/java/oracle-jrockit-real-time-1517310.pdf)

[Azul 演示 - 没有抖动的 Java](http://www.azulsystems.com/presentations/sifma-java-without-the-jitter)

[Azul / MyChannels 测试](http://mechanical-sympathy.blogspot.com/2012/03/fun-with-my-channels-nirvana-and-azul.html)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-10-20T05:18:59.647

我知道 azul 系统有一个 jvm，其 GC 是硬件辅助的。它还可以同时运行并非常快速地收集大量数据。

不确定它的确定性如何。

# performance - 如何确定二维点是否在多边形内？

> ID：217578
> 
> 赞同：565
> 
> 时间：2008-10-20T05:20:49.487
> 
> 标签：performance, graphics, collision-detection, polygon, point-in-polygon

我正在尝试在多边形算法中创建一个*快速*的2D 点，用于命中测试（例如`Polygon.contains(p:Point)`）。对有效技术的建议将不胜感激。

* * *

## 回答 #1

> 赞同：828
> 
> 时间：2008-10-20T11:19:15.503

对于图形，我宁愿不喜欢整数。许多系统使用整数进行 UI 绘制（像素毕竟是整数），但例如 macOS，对所有内容都使用浮点数。macOS 只知道点，一个点可以转换为一个像素，但根据显示器分辨率，它可能会转换为其他东西。在视网膜屏幕上，半个点 (0.5/0.5) 是像素。尽管如此，我从未注意到 macOS UI 比其他 UI 慢得多。毕竟，3D API（OpenGL 或 Direct3D）也适用于浮点数，现代图形库经常利用 GPU 加速。

现在你说速度是你主要关心的问题，好吧，让我们追求速度。在你运行任何复杂的算法之前，首先做一个简单的测试。在多边形周围创建一个*轴对齐的边界框。*这非常简单、快速，并且已经可以为您节省大量计算。这是如何运作的？遍历多边形的所有点并找到 X 和 Y 的最小/最大值。

例如，你有积分`(9/1), (4/3), (2/7), (8/2), (3/6)`。这意味着 Xmin 为 2，Xmax 为 9，Ymin 为 1，Ymax 为 7。具有两条边 (2/1) 和 (9/7) 的矩形外部的点不能位于多边形内。

```
// p is your point, p.x is the x coord, p.y is the y coord
if (p.x < Xmin || p.x > Xmax || p.y < Ymin || p.y > Ymax) {
    // Definitely not within the polygon!
} 
```

这是针对任何点运行的第一个测试。如您所见，此测试非常快，但也非常粗糙。为了处理边界矩形内的点，我们需要更复杂的算法。有几种计算方法。哪种方法有效还取决于多边形是否可以有孔或始终是实心的。以下是实心的示例（一凸一凹）：

![无孔多边形](https://i.stack.imgur.com/G76ta.jpg)

这是一个有洞的：

![带孔的多边形](https://i.stack.imgur.com/oDCCd.gif)

绿色的中间有个洞！

可以处理上述所有三种情况并且仍然非常快的最简单的算法称为**光线投射**。该算法的想法非常简单：从多边形外的任何地方绘制一条虚拟射线到您的点，并计算它击中多边形一侧的频率。如果命中数是偶数，它在多边形之外，如果它是奇数，它在多边形内。

![演示光线如何穿过多边形](https://i.stack.imgur.com/2EzSM.png)

**缠绕数算法**将是一种替代方法，对于非常接近多边形线的点来说它更准确，但它也慢得多。由于有限的浮点精度和舍入问题，对于太靠近多边形边的点，光线投射可能会失败，但实际上这几乎不是问题，就好像一个点离边很近，通常在视觉上甚至不可能查看器来识别它是已经在里面还是仍然在外面。

你还有上面的边界框，记得吗？只需在边界框外选择一个点并将其用作射线的起点。例如，该点`(Xmin - e/p.y)`肯定在多边形之外。

但什么是`e`？好吧，`e`（实际上是 epsilon）给边界框一些*padding*。正如我所说，如果我们开始离多边形线太近，光线追踪就会失败。由于边界框可能等于多边形（如果多边形是轴对齐的矩形，则边界框等于多边形本身！），我们需要一些填充来确保安全，仅此而已。你应该选择多大`e`？不会太大。这取决于您用于绘图的坐标系比例。如果您的像素步长为 1.0，则只需选择 1.0（但 0.1 也可以）

现在我们有了射线及其起点和终点坐标，问题从“*是多边形内的点*”转移到“*射线与多边形边相交的频率*”。因此，我们不能像以前那样只使用多边形点，现在我们需要实际的边。边总是由两点定义。

```
side 1: (X1/Y1)-(X2/Y2)
side 2: (X2/Y2)-(X3/Y3)
side 3: (X3/Y3)-(X4/Y4)
: 
```

您需要针对所有侧面测试射线。将射线视为向量，将每条边视为向量。射线必须恰好击中每一侧一次或根本不击中。它不能两次击中同一侧。二维空间中的两条线总是相交一次，除非它们平行，在这种情况下它们永远不会相交。但是，由于向量的长度有限，因此两个向量可能不平行并且仍然永远不会相交，因为它们太短而无法相遇。

```
// Test the ray against all sides
int intersections = 0;
for (side = 0; side < numberOfSides; side++) {
    // Test if current side intersects with ray.
    // If yes, intersections++;
}
if ((intersections & 1) == 1) {
    // Inside of polygon
} else {
    // Outside of polygon
} 
```

到目前为止一切顺利，但是如何测试两个向量是否相交？这是一些 C 代码（未经测试），应该可以解决问题：

```
#define NO 0
#define YES 1
#define COLLINEAR 2

int areIntersecting(
    float v1x1, float v1y1, float v1x2, float v1y2,
    float v2x1, float v2y1, float v2x2, float v2y2
) {
    float d1, d2;
    float a1, a2, b1, b2, c1, c2;

    // Convert vector 1 to a line (line 1) of infinite length.
    // We want the line in linear equation standard form: A*x + B*y + C = 0
    // See: http://en.wikipedia.org/wiki/Linear_equation
    a1 = v1y2 - v1y1;
    b1 = v1x1 - v1x2;
    c1 = (v1x2 * v1y1) - (v1x1 * v1y2);

    // Every point (x,y), that solves the equation above, is on the line,
    // every point that does not solve it, is not. The equation will have a
    // positive result if it is on one side of the line and a negative one 
    // if is on the other side of it. We insert (x1,y1) and (x2,y2) of vector
    // 2 into the equation above.
    d1 = (a1 * v2x1) + (b1 * v2y1) + c1;
    d2 = (a1 * v2x2) + (b1 * v2y2) + c1;

    // If d1 and d2 both have the same sign, they are both on the same side
    // of our line 1 and in that case no intersection is possible. Careful, 
    // 0 is a special case, that's why we don't test ">=" and "<=", 
    // but "<" and ">".
    if (d1 > 0 && d2 > 0) return NO;
    if (d1 < 0 && d2 < 0) return NO;

    // The fact that vector 2 intersected the infinite line 1 above doesn't 
    // mean it also intersects the vector 1\. Vector 1 is only a subset of that
    // infinite line 1, so it may have intersected that line before the vector
    // started or after it ended. To know for sure, we have to repeat the
    // the same test the other way round. We start by calculating the 
    // infinite line 2 in linear equation standard form.
    a2 = v2y2 - v2y1;
    b2 = v2x1 - v2x2;
    c2 = (v2x2 * v2y1) - (v2x1 * v2y2);

    // Calculate d1 and d2 again, this time using points of vector 1.
    d1 = (a2 * v1x1) + (b2 * v1y1) + c2;
    d2 = (a2 * v1x2) + (b2 * v1y2) + c2;

    // Again, if both have the same sign (and neither one is 0),
    // no intersection is possible.
    if (d1 > 0 && d2 > 0) return NO;
    if (d1 < 0 && d2 < 0) return NO;

    // If we get here, only two possibilities are left. Either the two
    // vectors intersect in exactly one point or they are collinear, which
    // means they intersect in any number of points from zero to infinite.
    if ((a1 * b2) - (a2 * b1) == 0.0f) return COLLINEAR;

    // If they are not collinear, they must intersect in exactly one point.
    return YES;
} 
```

输入值是向量 1 (和) 和向量 2 (和) 的*两个端点*。所以你有 2 个向量，4 个点，8 个坐标。并且很清楚。增加交叉点，什么都不做。`v1x1/v1y1``v1x2/v1y2``v2x1/v2y1``v2x2/v2y2``YES``NO``YES``NO`

COLLINEAR 怎么样？这意味着两个向量都位于同一条无限线上，具体取决于位置和长度，它们根本不相交或相交于无数个点。我不确定如何处理这种情况，无论哪种方式，我都不会将其视为交集。好吧，由于浮点舍入错误，这种情况在实践中相当罕见；更好的代码可能不会测试`== 0.0f`而是测试类似的东西`< epsilon`，其中 epsilon 是一个相当小的数字。

如果您需要测试更多的点，您当然可以通过将多边形边的线性方程标准形式保存在内存中来加快整个过程，因此您不必每次都重新计算这些。这将在每次测试中为您节省两个浮点乘法和三个浮点减法，以换取在内存中存储每个多边形边的三个浮点值。这是典型的内存与计算时间的权衡。

最后但同样重要的是：如果您可以使用 3D 硬件来解决问题，还有一个有趣的替代方案。只需让 GPU 为您完成所有工作。创建一个屏幕外的绘画表面。用黑色完全填充它。现在让 OpenGL 或 Direct3D 绘制您的多边形（如果您只想测试该点是否在其中任何一个内，甚至可以绘制所有多边形，但您不关心哪个）并用不同的填充多边形颜色，例如白色。要检查一个点是否在多边形内，请从绘图表面获取该点的颜色。这只是一个 O(1) 内存获取。

当然，这种方法仅在您的绘图表面不必很大时才可用。如果它无法适应 GPU 内存，则此方法比在 CPU 上执行要慢。如果它必须很大并且您的 GPU 支持现代着色器，您仍然可以通过将上面显示的光线投射实现为 GPU 着色器来使用 GPU，这绝对是可能的。对于要测试的大量多边形或大量点，这将得到回报，考虑一些 GPU 将能够并行测试 64 到 256 个点。但是请注意，将数据从 CPU 传输到 GPU 并返回总是很昂贵，因此仅针对几个简单的多边形测试几个点，其中点或多边形是动态的并且会经常变化，GPU 方法很少会支付离开。

* * *

## 回答 #2

> 赞同：609
> 
> 时间：2010-05-27T16:08:08.157

我认为以下代码是最好的解决方案（取自[此处](https://wrf.ecse.rpi.edu/Research/Short_Notes/pnpoly.html)）：

```
int pnpoly(int nvert, float *vertx, float *verty, float testx, float testy)
{
  int i, j, c = 0;
  for (i = 0, j = nvert-1; i < nvert; j = i++) {
    if ( ((verty[i]>testy) != (verty[j]>testy)) &&
     (testx < (vertx[j]-vertx[i]) * (testy-verty[i]) / (verty[j]-verty[i]) + vertx[i]) )
       c = !c;
  }
  return c;
} 
```

### 论据

*   **nvert**：多边形中的顶点数。是否重复最后的第一个顶点已经在上面提到的文章中讨论过了。
*   **vertx, verty**：包含多边形顶点的 x 和 y 坐标的数组。
*   **testx, testy**：测试点的 X 和 y 坐标。

它既短又高效，适用于凸多边形和凹多边形。如前所述，您应该首先检查边界矩形并分别处理多边形孔。

这背后的想法很简单。作者是这样描述的：

> 我从测试点水平射出一条半无限光线（增加 x，固定 y），并计算它穿过多少条边。在每个交叉点，光线在内部和外部之间切换。这被称为乔丹曲线定理。

每次水平光线穿过任何边缘时，变量 c 都会从 0 切换到 1 和 1 到 0。所以基本上它会跟踪交叉的边数是偶数还是奇数。0 表示偶数，1 表示奇数。

* * *

## 回答 #3

> 赞同：83
> 
> 时间：2013-05-06T04:14:38.653

[这是nirg 给出](https://stackoverflow.com/a/2922778/384670)的答案的 C# 版本，来自[这个 RPI 教授](https://wrf.ecse.rpi.edu/Research/Short_Notes/pnpoly.html)。请注意，使用来自该 RPI 源的代码需要注明出处。

顶部添加了边界框检查。但是，正如 James Brown 所指出的，主要代码几乎与边界框检查本身一样快，因此边界框检查实际上会减慢整体操作，在您检查的大部分点都在边界框内的情况下. 因此，您可以检查边界框，或者如果多边形的形状不经常改变形状，另一种方法是预先计算多边形的边界框。

```
public bool IsPointInPolygon( Point p, Point[] polygon )
{
    double minX = polygon[ 0 ].X;
    double maxX = polygon[ 0 ].X;
    double minY = polygon[ 0 ].Y;
    double maxY = polygon[ 0 ].Y;
    for ( int i = 1 ; i < polygon.Length ; i++ )
    {
        Point q = polygon[ i ];
        minX = Math.Min( q.X, minX );
        maxX = Math.Max( q.X, maxX );
        minY = Math.Min( q.Y, minY );
        maxY = Math.Max( q.Y, maxY );
    }

    if ( p.X < minX || p.X > maxX || p.Y < minY || p.Y > maxY )
    {
        return false;
    }

    // https://wrf.ecse.rpi.edu/Research/Short_Notes/pnpoly.html
    bool inside = false;
    for ( int i = 0, j = polygon.Length - 1 ; i < polygon.Length ; j = i++ )
    {
        if ( ( polygon[ i ].Y > p.Y ) != ( polygon[ j ].Y > p.Y ) &&
             p.X < ( polygon[ j ].X - polygon[ i ].X ) * ( p.Y - polygon[ i ].Y ) / ( polygon[ j ].Y - polygon[ i ].Y ) + polygon[ i ].X )
        {
            inside = !inside;
        }
    }

    return inside;
} 
```

* * *

## 回答 #4

> 赞同：57
> 
> 时间：2013-07-05T14:11:26.880

这是 M. Katz 基于 Nirg 方法的答案的 JavaScript 变体：

```
function pointIsInPoly(p, polygon) {
    var isInside = false;
    var minX = polygon[0].x, maxX = polygon[0].x;
    var minY = polygon[0].y, maxY = polygon[0].y;
    for (var n = 1; n < polygon.length; n++) {
        var q = polygon[n];
        minX = Math.min(q.x, minX);
        maxX = Math.max(q.x, maxX);
        minY = Math.min(q.y, minY);
        maxY = Math.max(q.y, maxY);
    }

    if (p.x < minX || p.x > maxX || p.y < minY || p.y > maxY) {
        return false;
    }

    var i = 0, j = polygon.length - 1;
    for (i, j; i < polygon.length; j = i++) {
        if ( (polygon[i].y > p.y) != (polygon[j].y > p.y) &&
                p.x < (polygon[j].x - polygon[i].x) * (p.y - polygon[i].y) / (polygon[j].y - polygon[i].y) + polygon[i].x ) {
            isInside = !isInside;
        }
    }

    return isInside;
} 
```

* * *

## 回答 #5

> 赞同：39
> 
> 时间：2008-10-20T05:47:17.293

计算点 p 和每个多边形顶点之间的定向角度和。如果总定向角度为 360 度，则该点在内部。如果总和为 0，则该点在外部。

我更喜欢这种方法，因为它更健壮且对数值精度的依赖更少。

计算交叉点数量均匀性的方法受到限制，因为您可以在计算交叉点数量期间“命中”顶点。

编辑：顺便说一句，这种方法适用于凹凸多边形。

编辑：我最近发现了一篇关于该主题的完整[维基百科文章。](http://en.wikipedia.org/wiki/Point_in_polygon)

* * *

## 回答 #6

> 赞同：34
> 
> 时间：2017-05-06T15:24:23.840

这个问题太有趣了。我有另一个与这篇文章的其他答案不同的可行想法。这个想法是使用角度的总和来确定目标是在内部还是外部。更好地称为[绕组数](https://en.wikipedia.org/wiki/Winding_number)。

设 x 为目标点。令数组 [0, 1, .... n] 为该区域的所有点。用一条线将目标点与每个边界点连接起来。如果目标点在该区域内。所有角度的总和将是 360 度。如果不是，角度将小于 360。

请参阅此图像以基本了解该想法： [![在此处输入图像描述](https://i.stack.imgur.com/Zbcec.jpg)](https://i.stack.imgur.com/Zbcec.jpg)

我的算法假设顺时针方向是正方向。这是一个潜在的输入：

```
[[-122.402015, 48.225216], [-117.032049, 48.999931], [-116.919132, 45.995175], [-124.079107, 46.267259], [-124.717175, 48.377557], [-122.92315, 47.047963], [-122.402015, 48.225216]] 
```

下面是实现这个想法的python代码：

```
def isInside(self, border, target):
degree = 0
for i in range(len(border) - 1):
    a = border[i]
    b = border[i + 1]

    # calculate distance of vector
    A = getDistance(a[0], a[1], b[0], b[1]);
    B = getDistance(target[0], target[1], a[0], a[1])
    C = getDistance(target[0], target[1], b[0], b[1])

    # calculate direction of vector
    ta_x = a[0] - target[0]
    ta_y = a[1] - target[1]
    tb_x = b[0] - target[0]
    tb_y = b[1] - target[1]

    cross = tb_y * ta_x - tb_x * ta_y
    clockwise = cross < 0

    # calculate sum of angles
    if(clockwise):
        degree = degree + math.degrees(math.acos((B * B + C * C - A * A) / (2.0 * B * C)))
    else:
        degree = degree - math.degrees(math.acos((B * B + C * C - A * A) / (2.0 * B * C)))

if(abs(round(degree) - 360) <= 3):
    return True
return False 
```

* * *

## 回答 #7

> 赞同：24
> 
> 时间：2009-12-29T04:28:09.570

bobobobo 引用的[Eric Haines 文章](http://erich.realtimerendering.com/ptinpoly/)真的很棒。特别有趣的是比较算法性能的表格；与其他方法相比，角度求和方法确实很糟糕。同样有趣的是，使用查找网格将多边形进一步细分为“输入”和“输出”扇区等优化可以使测试速度非常快，即使在具有 > 1000 个边的多边形上也是如此。

无论如何，现在还为时过早，但我的投票是“交叉”方法，这几乎就是 Mecki 所描述的我的想法。但是，我发现[David Bourke 对其进行了最简洁的描述和编纂](http://web.archive.org/web/20110314030147/http://paulbourke.net/geometry/insidepoly/)。我喜欢不需要真正的三角函数，它适用于凸面和凹面，并且随着边数的增加它表现得相当好。

顺便说一句，这是 Eric Haines 的文章中的性能表之一，用于测试随机多边形。

```
 number of edges per polygon
                         3       4      10      100    1000
MacMartin               2.9     3.2     5.9     50.6    485
Crossings               3.1     3.4     6.8     60.0    624
Triangle Fan+edge sort  1.1     1.8     6.5     77.6    787
Triangle Fan            1.2     2.1     7.3     85.4    865
Barycentric             2.1     3.8    13.8    160.7   1665
Angle Summation        56.2    70.4   153.6   1403.8  14693

Grid (100x100)          1.5     1.5     1.6      2.1      9.8
Grid (20x20)            1.7     1.7     1.9      5.7     42.2
Bins (100)              1.8     1.9     2.7     15.1    117
Bins (20)               2.1     2.2     3.7     26.3    278 
```

* * *

## 回答 #8

> 赞同：12
> 
> 时间：2013-07-05T13:49:28.367

真的很喜欢 Nirg 发布并由 bobobobo 编辑的解决方案。我只是让它对 javascript 友好并且更易读于我的使用：

```
function insidePoly(poly, pointx, pointy) {
    var i, j;
    var inside = false;
    for (i = 0, j = poly.length - 1; i < poly.length; j = i++) {
        if(((poly[i].y > pointy) != (poly[j].y > pointy)) && (pointx < (poly[j].x-poly[i].x) * (pointy-poly[i].y) / (poly[j].y-poly[i].y) + poly[i].x) ) inside = !inside;
    }
    return inside;
} 
```

* * *

## 回答 #9

> 赞同：11
> 
> 时间：2015-05-25T10:32:36.543

[nirg](https://stackoverflow.com/a/2922778/3310339)的答案的 Swift 版本：

```
extension CGPoint {
    func isInsidePolygon(vertices: [CGPoint]) -> Bool {
        guard !vertices.isEmpty else { return false }
        var j = vertices.last!, c = false
        for i in vertices {
            let a = (i.y > y) != (j.y > y)
            let b = (x < (j.x - i.x) * (y - i.y) / (j.y - i.y) + i.x)
            if a && b { c = !c }
            j = i
        }
        return c
    }
} 
```

* * *

## 回答 #10

> 赞同：9
> 
> 时间：2008-10-20T05:44:15.710

当我在[Michael Stonebraker手下担任研究员时，我在这方面做了一些工作——你知道，提出](http://en.wikipedia.org/wiki/Michael_Stonebraker)[Ingres](http://en.wikipedia.org/wiki/Ingres_%28database%29)、[PostgreSQL](http://en.wikipedia.org/wiki/PostgreSQL)等的教授。

我们意识到最快的方法是先做一个边界框，因为它非常快。如果它在边界框之外，它就在外面。否则，你会更努力地工作......

如果您想要一个出色的算法，请查看开源项目 PostgreSQL 源代码以进行地理工作...

我想指出，我们从来没有深入了解过左撇子和右撇子（也可以表达为“内部”与“外部”问题......

* * *

更新

BKB 的链接提供了大量合理的算法。我正在研究地球科学问题，因此需要一个适用于纬度/经度的解决方案，它有一个特殊的惯用手问题——是较小区域内的区域还是较大区域内的区域？答案是顶点的“方向”很重要——它是左撇子或右撇子，通过这种方式，您可以将任一区域指示为任何给定多边形的“内部”。因此，我的工作使用了该页面上列举的解决方案三。

此外，我的工作使用单独的函数进行“在线”测试。

...既然有人问：我们发现当顶点的数量超过某个数字时，边界框测试是最好的——如果需要，在进行更长的测试之前做一个非常快速的测试......一个边界框是通过简单地获取最大的 x、最小的 x、最大的 y 和最小的 y 并将它们放在一起形成一个盒子的四个点...

给后面的人的另一个提示：我们在网格空间中进行了所有更复杂和“调光”的计算，所有这些计算都在平面上的正点上，然后重新投影回“真实”经度/纬度，从而避免可能的错误当一根越过经度线 180 和处理极地地区时环绕。工作得很好！

* * *

## 回答 #11

> 赞同：6
> 
> 时间：2008-10-20T06:31:51.260

David Segond 的答案几乎是标准的一般答案，Richard T 是最常见的优化，尽管还有其他一些优化。其他强大的优化基于不太通用的解决方案。例如，如果您要检查具有大量点的同一个多边形，对多边形进行三角剖分可以大大加快速度，因为有许多非常快速的 TIN 搜索算法。另一个是如果多边形和点在低分辨率的有限平面上，例如屏幕显示，您可以将多边形绘制到给定颜色的内存映射显示缓冲区上，并检查给定像素的颜色以查看它是否位于在多边形中。

像许多优化一样，这些优化基于特定而不是一般情况，并且基于摊销时间而不是单一使用来产生收益。

在这个领域工作时，我发现 Joeseph O'Rourkes 'Computation Geometry in C' ISBN 0-521-44034-3 对我很有帮助。

* * *

## 回答 #12

> 赞同：5
> 
> 时间：2008-10-20T05:33:01.380

简单的解决方案是将多边形划分为三角形并按[此处所述对三角形进行命中测试](http://www.blackpawn.com/texts/pointinpoly/default.html)

如果您的多边形是**凸**的，那么可能会有更好的方法。将多边形视为无限线的集合。每条线将空间分成两部分。对于每一点，很容易判断它是在线的一侧还是另一侧。如果一个点在所有线的同一侧，那么它在多边形内。

* * *

## 回答 #13

> 赞同：5
> 
> 时间：2013-11-22T23:54:39.117

Java版本：

```
public class Geocode {
    private float latitude;
    private float longitude;

    public Geocode() {
    }

    public Geocode(float latitude, float longitude) {
        this.latitude = latitude;
        this.longitude = longitude;
    }

    public float getLatitude() {
        return latitude;
    }

    public void setLatitude(float latitude) {
        this.latitude = latitude;
    }

    public float getLongitude() {
        return longitude;
    }

    public void setLongitude(float longitude) {
        this.longitude = longitude;
    }
}

public class GeoPolygon {
    private ArrayList<Geocode> points;

    public GeoPolygon() {
        this.points = new ArrayList<Geocode>();
    }

    public GeoPolygon(ArrayList<Geocode> points) {
        this.points = points;
    }

    public GeoPolygon add(Geocode geo) {
        points.add(geo);
        return this;
    }

    public boolean inside(Geocode geo) {
        int i, j;
        boolean c = false;
        for (i = 0, j = points.size() - 1; i < points.size(); j = i++) {
            if (((points.get(i).getLongitude() > geo.getLongitude()) != (points.get(j).getLongitude() > geo.getLongitude())) &&
                    (geo.getLatitude() < (points.get(j).getLatitude() - points.get(i).getLatitude()) * (geo.getLongitude() - points.get(i).getLongitude()) / (points.get(j).getLongitude() - points.get(i).getLongitude()) + points.get(i).getLatitude()))
                c = !c;
        }
        return c;
    }

} 
```

* * *

## 回答 #14

> 赞同：5
> 
> 时间：2020-08-16T11:15:00.440

这个问题的大多数答案都不能很好地处理所有极端情况。一些微妙的极端情况，如下所示： [![光线投射角落案例](https://i.stack.imgur.com/20cli.png)](https://i.stack.imgur.com/20cli.png) 这是一个 JavaScript 版本，所有极端情况都得到了很好的处理。

```
/** Get relationship between a point and a polygon using ray-casting algorithm
 * @param {{x:number, y:number}} P: point to check
 * @param {{x:number, y:number}[]} polygon: the polygon
 * @returns -1: outside, 0: on edge, 1: inside
 */
function relationPP(P, polygon) {
    const between = (p, a, b) => p >= a && p <= b || p <= a && p >= b
    let inside = false
    for (let i = polygon.length-1, j = 0; j < polygon.length; i = j, j++) {
        const A = polygon[i]
        const B = polygon[j]
        // corner cases
        if (P.x == A.x && P.y == A.y || P.x == B.x && P.y == B.y) return 0
        if (A.y == B.y && P.y == A.y && between(P.x, A.x, B.x)) return 0

        if (between(P.y, A.y, B.y)) { // if P inside the vertical range
            // filter out "ray pass vertex" problem by treating the line a little lower
            if (P.y == A.y && B.y >= A.y || P.y == B.y && A.y >= B.y) continue
            // calc cross product `PA X PB`, P lays on left side of AB if c > 0 
            const c = (A.x - P.x) * (B.y - P.y) - (B.x - P.x) * (A.y - P.y)
            if (c == 0) return 0
            if ((A.y < B.y) == (c > 0)) inside = !inside
        }
    }

    return inside? 1 : -1
} 
```

* * *

## 回答 #15

> 赞同：4
> 
> 时间：2011-08-02T03:53:11.950

我意识到这是旧的，但这里有一个用 Cocoa 实现的光线投射算法，以防有人感兴趣。不确定这是最有效的做事方式，但它可能会帮助某人。

```
- (BOOL)shape:(NSBezierPath *)path containsPoint:(NSPoint)point
{
    NSBezierPath *currentPath = [path bezierPathByFlatteningPath];
    BOOL result;
    float aggregateX = 0; //I use these to calculate the centroid of the shape
    float aggregateY = 0;
    NSPoint firstPoint[1];
    [currentPath elementAtIndex:0 associatedPoints:firstPoint];
    float olderX = firstPoint[0].x;
    float olderY = firstPoint[0].y;
    NSPoint interPoint;
    int noOfIntersections = 0;

    for (int n = 0; n < [currentPath elementCount]; n++) {
        NSPoint points[1];
        [currentPath elementAtIndex:n associatedPoints:points];
        aggregateX += points[0].x;
        aggregateY += points[0].y;
    }

    for (int n = 0; n < [currentPath elementCount]; n++) {
        NSPoint points[1];

        [currentPath elementAtIndex:n associatedPoints:points];
        //line equations in Ax + By = C form
        float _A_FOO = (aggregateY/[currentPath elementCount]) - point.y;  
        float _B_FOO = point.x - (aggregateX/[currentPath elementCount]);
        float _C_FOO = (_A_FOO * point.x) + (_B_FOO * point.y);

        float _A_BAR = olderY - points[0].y;
        float _B_BAR = points[0].x - olderX;
        float _C_BAR = (_A_BAR * olderX) + (_B_BAR * olderY);

        float det = (_A_FOO * _B_BAR) - (_A_BAR * _B_FOO);
        if (det != 0) {
            //intersection points with the edges
            float xIntersectionPoint = ((_B_BAR * _C_FOO) - (_B_FOO * _C_BAR)) / det;
            float yIntersectionPoint = ((_A_FOO * _C_BAR) - (_A_BAR * _C_FOO)) / det;
            interPoint = NSMakePoint(xIntersectionPoint, yIntersectionPoint);
            if (olderX <= points[0].x) {
                //doesn't matter in which direction the ray goes, so I send it right-ward.
                if ((interPoint.x >= olderX && interPoint.x <= points[0].x) && (interPoint.x > point.x)) {  
                    noOfIntersections++;
                }
            } else {
                if ((interPoint.x >= points[0].x && interPoint.x <= olderX) && (interPoint.x > point.x)) {
                     noOfIntersections++;
                } 
            }
        }
        olderX = points[0].x;
        olderY = points[0].y;
    }
    if (noOfIntersections % 2 == 0) {
        result = FALSE;
    } else {
        result = TRUE;
    }
    return result;
} 
```

* * *

## 回答 #16

> 赞同：4
> 
> 时间：2013-04-09T23:07:33.333

nirg 答案的 Obj-C 版本，带有用于测试点的示例方法。Nirg 的回答对我来说效果很好。

```
- (BOOL)isPointInPolygon:(NSArray *)vertices point:(CGPoint)test {
    NSUInteger nvert = [vertices count];
    NSInteger i, j, c = 0;
    CGPoint verti, vertj;

    for (i = 0, j = nvert-1; i < nvert; j = i++) {
        verti = [(NSValue *)[vertices objectAtIndex:i] CGPointValue];
        vertj = [(NSValue *)[vertices objectAtIndex:j] CGPointValue];
        if (( (verti.y > test.y) != (vertj.y > test.y) ) &&
        ( test.x < ( vertj.x - verti.x ) * ( test.y - verti.y ) / ( vertj.y - verti.y ) + verti.x) )
            c = !c;
    }

    return (c ? YES : NO);
}

- (void)testPoint {

    NSArray *polygonVertices = [NSArray arrayWithObjects:
        [NSValue valueWithCGPoint:CGPointMake(13.5, 41.5)],
        [NSValue valueWithCGPoint:CGPointMake(42.5, 56.5)],
        [NSValue valueWithCGPoint:CGPointMake(39.5, 69.5)],
        [NSValue valueWithCGPoint:CGPointMake(42.5, 84.5)],
        [NSValue valueWithCGPoint:CGPointMake(13.5, 100.0)],
        [NSValue valueWithCGPoint:CGPointMake(6.0, 70.5)],
        nil
    ];

    CGPoint tappedPoint = CGPointMake(23.0, 70.0);

    if ([self isPointInPolygon:polygonVertices point:tappedPoint]) {
        NSLog(@"YES");
    } else {
        NSLog(@"NO");
    }
} 
```

![样本多边形](https://i.stack.imgur.com/vCFl0.png)

* * *

## 回答 #17

> 赞同：4
> 
> 时间：2013-04-28T10:09:33.473

没有什么比对问题的归纳定义更美好的了。为了完整起见，您在 prolog 中有一个版本，它也可能阐明*光线投射*背后的想法：

基于[http://www.ecse.rpi.edu/Homepages/wrf/Research/Short_Notes/pnpoly.html中的简单算法模拟](http://www.ecse.rpi.edu/Homepages/wrf/Research/Short_Notes/pnpoly.html)

一些辅助谓词：

```
exor(A,B):- \+A,B;A,\+B.
in_range(Coordinate,CA,CB) :- exor((CA>Coordinate),(CB>Coordinate)).

inside(false).
inside(_,[_|[]]).
inside(X:Y, [X1:Y1,X2:Y2|R]) :- in_range(Y,Y1,Y2), X > ( ((X2-X1)*(Y-Y1))/(Y2-Y1) +      X1),toggle_ray, inside(X:Y, [X2:Y2|R]); inside(X:Y, [X2:Y2|R]).

get_line(_,_,[]).
get_line([XA:YA,XB:YB],[X1:Y1,X2:Y2|R]):- [XA:YA,XB:YB]=[X1:Y1,X2:Y2]; get_line([XA:YA,XB:YB],[X2:Y2|R]). 
```

给定 2 个点 A 和 B (Line(A,B)) 的直线方程为：

```
 (YB-YA)
           Y - YA = ------- * (X - XA) 
                    (XB-YB) 
```

重要的是，线的旋转方向设置为边界顺时针方向和孔逆时针方向。我们要检查点(X,Y)，即被测点是否在我们线的左半平面上（看个人喜好，也可以是右边，也可以是边界的方向在这种情况下必须更改线），这是将光线从点投射到右侧（或左侧）并确认与线的交点。我们选择在水平方向投射光线（这也是个人喜好问题，也可以在具有类似限制的垂直方向上进行），所以我们有：

```
 (XB-XA)
           X < ------- * (Y - YA) + XA
               (YB-YA) 
```

现在我们需要知道该点是否仅在线段的左侧（或右侧），而不是整个平面，因此我们需要将搜索限制在该段内，但这很容易，因为在该段内直线中只有一个点可以高于垂直轴上的 Y。由于这是一个更强的限制，它需要首先检查，所以我们首先只取那些满足这个要求的行，然后检查它的位置。根据 Jordan 曲线定理，任何投射到多边形的射线都必须在偶数条线上相交。所以我们完成了，我们将光线向右抛，然后每次它与一条线相交时，切换它的状态。然而，在我们的实现中，我们将检查满足给定限制的解决方案包的长度并决定其内部结构。对于多边形中的每条线，都必须这样做。

```
is_left_half_plane(_,[],[],_).
is_left_half_plane(X:Y,[XA:YA,XB:YB], [[X1:Y1,X2:Y2]|R], Test) :- [XA:YA, XB:YB] =  [X1:Y1, X2:Y2], call(Test, X , (((XB - XA) * (Y - YA)) / (YB - YA) + XA)); 
                                                        is_left_half_plane(X:Y, [XA:YA, XB:YB], R, Test).

in_y_range_at_poly(Y,[XA:YA,XB:YB],Polygon) :- get_line([XA:YA,XB:YB],Polygon),  in_range(Y,YA,YB).
all_in_range(Coordinate,Polygon,Lines) :- aggregate(bag(Line),    in_y_range_at_poly(Coordinate,Line,Polygon), Lines).

traverses_ray(X:Y, Lines, Count) :- aggregate(bag(Line), is_left_half_plane(X:Y, Line, Lines, <), IntersectingLines), length(IntersectingLines, Count).

% This is the entry point predicate
inside_poly(X:Y,Polygon,Answer) :- all_in_range(Y,Polygon,Lines), traverses_ray(X:Y, Lines, Count), (1 is mod(Count,2)->Answer=inside;Answer=outside). 
```

* * *

## 回答 #18

> 赞同：3
> 
> 时间：2012-12-20T07:26:54.900

C# 版本的 nirg 的答案在这里：我将分享代码。它可能会节省一些时间。

```
public static bool IsPointInPolygon(IList<Point> polygon, Point testPoint) {
            bool result = false;
            int j = polygon.Count() - 1;
            for (int i = 0; i < polygon.Count(); i++) {
                if (polygon[i].Y < testPoint.Y && polygon[j].Y >= testPoint.Y || polygon[j].Y < testPoint.Y && polygon[i].Y >= testPoint.Y) {
                    if (polygon[i].X + (testPoint.Y - polygon[i].Y) / (polygon[j].Y - polygon[i].Y) * (polygon[j].X - polygon[i].X) < testPoint.X) {
                        result = !result;
                    }
                }
                j = i;
            }
            return result;
        } 
```

* * *

## 回答 #19

> 赞同：3
> 
> 时间：2018-05-15T14:32:00.357

我已经对[nirg 的](https://stackoverflow.com/users/1258650/nirg)c++[代码](https://stackoverflow.com/a/2922778/7575092)进行了 Python 实现：

输入

*   **bounding_points：**构成多边形的节点。
*   **bounding_box_positions：**要过滤的候选点。（在我从边界框创建的实现中。

    （输入是元组列表，格式为`[(xcord, ycord), ...]`：）

退货

*   多边形内的所有点。

```
def polygon_ray_casting(self, bounding_points, bounding_box_positions):
    # Arrays containing the x- and y-coordinates of the polygon's vertices.
    vertx = [point[0] for point in bounding_points]
    verty = [point[1] for point in bounding_points]
    # Number of vertices in the polygon
    nvert = len(bounding_points)
    # Points that are inside
    points_inside = []

    # For every candidate position within the bounding box
    for idx, pos in enumerate(bounding_box_positions):
        testx, testy = (pos[0], pos[1])
        c = 0
        for i in range(0, nvert):
            j = i - 1 if i != 0 else nvert - 1
            if( ((verty[i] > testy ) != (verty[j] > testy))   and
                    (testx < (vertx[j] - vertx[i]) * (testy - verty[i]) / (verty[j] - verty[i]) + vertx[i]) ):
                c += 1
        # If odd, that means that we are inside the polygon
        if c % 2 == 1: 
            points_inside.append(pos)

    return points_inside 
```

同样，这个想法来自[这里](https://wrf.ecse.rpi.edu//Research/Short_Notes/pnpoly.html)

* * *

## 回答 #20

> 赞同：2
> 
> 时间：2012-03-20T22:45:50.960

.Net 端口：

```
 static void Main(string[] args)
    {

        Console.Write("Hola");
        List<double> vertx = new List<double>();
        List<double> verty = new List<double>();

        int i, j, c = 0;

        vertx.Add(1);
        vertx.Add(2);
        vertx.Add(1);
        vertx.Add(4);
        vertx.Add(4);
        vertx.Add(1);

        verty.Add(1);
        verty.Add(2);
        verty.Add(4);
        verty.Add(4);
        verty.Add(1);
        verty.Add(1);

        int nvert = 6;  //Vértices del poligono

        double testx = 2;
        double testy = 5;

        for (i = 0, j = nvert - 1; i < nvert; j = i++)
        {
            if (((verty[i] > testy) != (verty[j] > testy)) &&
             (testx < (vertx[j] - vertx[i]) * (testy - verty[i]) / (verty[j] - verty[i]) + vertx[i]))
                c = 1;
        }
    } 
```

* * *

## 回答 #21

> 赞同：2
> 
> 时间：2016-04-07T19:12:02.243

**VBA 版本：**

注意：请记住，如果您的多边形是地图中的一个区域，则纬度/经度是 Y/X 值而不是 X/Y（纬度 = Y，经度 = X），因为据我所知，这是从很久以前开始的历史影响经度不是测量值。

课程模块：CPoint

```
Private pXValue As Double
Private pYValue As Double

'''''X Value Property'''''

Public Property Get X() As Double
    X = pXValue
End Property

Public Property Let X(Value As Double)
    pXValue = Value
End Property

'''''Y Value Property'''''

Public Property Get Y() As Double
    Y = pYValue
End Property

Public Property Let Y(Value As Double)
    pYValue = Value
End Property 
```

模块：

```
Public Function isPointInPolygon(p As CPoint, polygon() As CPoint) As Boolean

    Dim i As Integer
    Dim j As Integer
    Dim q As Object
    Dim minX As Double
    Dim maxX As Double
    Dim minY As Double
    Dim maxY As Double
    minX = polygon(0).X
    maxX = polygon(0).X
    minY = polygon(0).Y
    maxY = polygon(0).Y

    For i = 1 To UBound(polygon)
        Set q = polygon(i)
        minX = vbMin(q.X, minX)
        maxX = vbMax(q.X, maxX)
        minY = vbMin(q.Y, minY)
        maxY = vbMax(q.Y, maxY)
    Next i

    If p.X < minX Or p.X > maxX Or p.Y < minY Or p.Y > maxY Then
        isPointInPolygon = False
        Exit Function
    End If

    ' SOURCE: http://www.ecse.rpi.edu/Homepages/wrf/Research/Short_Notes/pnpoly.html

    isPointInPolygon = False
    i = 0
    j = UBound(polygon)

    Do While i < UBound(polygon) + 1
        If (polygon(i).Y > p.Y) Then
            If (polygon(j).Y < p.Y) Then
                If p.X < (polygon(j).X - polygon(i).X) * (p.Y - polygon(i).Y) / (polygon(j).Y - polygon(i).Y) + polygon(i).X Then
                    isPointInPolygon = True
                    Exit Function
                End If
            End If
        ElseIf (polygon(i).Y < p.Y) Then
            If (polygon(j).Y > p.Y) Then
                If p.X < (polygon(j).X - polygon(i).X) * (p.Y - polygon(i).Y) / (polygon(j).Y - polygon(i).Y) + polygon(i).X Then
                    isPointInPolygon = True
                    Exit Function
                End If
            End If
        End If
        j = i
        i = i + 1
    Loop   
End Function

Function vbMax(n1, n2) As Double
    vbMax = IIf(n1 > n2, n1, n2)
End Function

Function vbMin(n1, n2) As Double
    vbMin = IIf(n1 > n2, n2, n1)
End Function

Sub TestPointInPolygon()

    Dim i As Integer
    Dim InPolygon As Boolean

'   MARKER Object
    Dim p As CPoint
    Set p = New CPoint
    p.X = <ENTER X VALUE HERE>
    p.Y = <ENTER Y VALUE HERE>

'   POLYGON OBJECT
    Dim polygon() As CPoint
    ReDim polygon(<ENTER VALUE HERE>) 'Amount of vertices in polygon - 1
    For i = 0 To <ENTER VALUE HERE> 'Same value as above
       Set polygon(i) = New CPoint
       polygon(i).X = <ASSIGN X VALUE HERE> 'Source a list of values that can be looped through
       polgyon(i).Y = <ASSIGN Y VALUE HERE> 'Source a list of values that can be looped through
    Next i

    InPolygon = isPointInPolygon(p, polygon)
    MsgBox InPolygon

End Sub 
```

* * *

## 回答 #22

> 赞同：2
> 
> 时间：2018-12-19T19:54:47.657

很惊讶之前没有人提出这个问题，但是对于需要数据库的实用主义者来说：MongoDB 对包括这个在内的地理查询有很好的支持。

您正在寻找的是：

> db.neighborhoods.findOne({ geometry: { $geoIntersects: { $geometry: { type: "Point", coordinates: [ "longitude", "latitude" ] } } } })

`Neighborhoods`是以标准 GeoJson 格式存储一个或多个多边形的集合。如果查询返回 null 它不相交，否则它是。

这里有很好的记录： [https ://docs.mongodb.com/manual/tutorial/geospatial-tutorial/](https://docs.mongodb.com/manual/tutorial/geospatial-tutorial/)

在 330 个不规则多边形网格中分类的 6,000 多个点的性能不到一分钟，完全没有优化，包括用各自的多边形更新文档的时间。

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2013-12-26T08:12:07.973

这是 C 中多边形测试中的一个点，它不使用光线投射。它可以用于重叠区域（自相交），请参阅`use_holes`论点。

```
/* math lib (defined below) */
static float dot_v2v2(const float a[2], const float b[2]);
static float angle_signed_v2v2(const float v1[2], const float v2[2]);
static void copy_v2_v2(float r[2], const float a[2]);

/* intersection function */
bool isect_point_poly_v2(const float pt[2], const float verts[][2], const unsigned int nr,
                         const bool use_holes)
{
    /* we do the angle rule, define that all added angles should be about zero or (2 * PI) */
    float angletot = 0.0;
    float fp1[2], fp2[2];
    unsigned int i;
    const float *p1, *p2;

    p1 = verts[nr - 1];

    /* first vector */
    fp1[0] = p1[0] - pt[0];
    fp1[1] = p1[1] - pt[1];

    for (i = 0; i < nr; i++) {
        p2 = verts[i];

        /* second vector */
        fp2[0] = p2[0] - pt[0];
        fp2[1] = p2[1] - pt[1];

        /* dot and angle and cross */
        angletot += angle_signed_v2v2(fp1, fp2);

        /* circulate */
        copy_v2_v2(fp1, fp2);
        p1 = p2;
    }

    angletot = fabsf(angletot);
    if (use_holes) {
        const float nested = floorf((angletot / (float)(M_PI * 2.0)) + 0.00001f);
        angletot -= nested * (float)(M_PI * 2.0);
        return (angletot > 4.0f) != ((int)nested % 2);
    }
    else {
        return (angletot > 4.0f);
    }
}

/* math lib */

static float dot_v2v2(const float a[2], const float b[2])
{
    return a[0] * b[0] + a[1] * b[1];
}

static float angle_signed_v2v2(const float v1[2], const float v2[2])
{
    const float perp_dot = (v1[1] * v2[0]) - (v1[0] * v2[1]);
    return atan2f(perp_dot, dot_v2v2(v1, v2));
}

static void copy_v2_v2(float r[2], const float a[2])
{
    r[0] = a[0];
    r[1] = a[1];
} 
```

注意：这是不太理想的方法之一，因为它包含对 的大量调用`atan2f`，但阅读此线程的开发人员可能会感兴趣（在我的测试中，它比使用线交点方法慢约 23 倍）。

* * *

## 回答 #24

> 赞同：1
> 
> 时间：2020-06-08T03:08:48.347

这可能是来自[此](https://stackoverflow.com/a/218081/541208)[页面](https://wrf.ecse.rpi.edu//Research/Short_Notes/pnpoly.html)的 C 代码的优化程度略低的版本。

我的 C++ 版本使用 a`std::vector<std::pair<double, double>>`和两个 double 作为 x 和 y。逻辑应该与原始 C 代码完全相同，但我发现我的代码更易于阅读。我不能为表演说话。

```
bool point_in_poly(std::vector<std::pair<double, double>>& verts, double point_x, double point_y)
{
    bool in_poly = false;
    auto num_verts = verts.size();
    for (int i = 0, j = num_verts - 1; i < num_verts; j = i++) {
        double x1 = verts[i].first;
        double y1 = verts[i].second;
        double x2 = verts[j].first;
        double y2 = verts[j].second;

        if (((y1 > point_y) != (y2 > point_y)) &&
            (point_x < (x2 - x1) * (point_y - y1) / (y2 - y1) + x1))
            in_poly = !in_poly;
    }
    return in_poly;
} 
```

原始C代码是

```
int pnpoly(int nvert, float *vertx, float *verty, float testx, float testy)
{
  int i, j, c = 0;
  for (i = 0, j = nvert-1; i < nvert; j = i++) {
    if ( ((verty[i]>testy) != (verty[j]>testy)) &&
     (testx < (vertx[j]-vertx[i]) * (testy-verty[i]) / (verty[j]-verty[i]) + vertx[i]) )
       c = !c;
  }
  return c;
} 
```

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2015-11-19T05:34:10.827

为了检测多边形上的命中，我们需要测试两件事：

1.  如果 Point 在多边形区域内。（可以通过光线投射算法完成）
2.  如果点在多边形边界上（可以通过与折线（线）上的点检测相同的算法来完成）。

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2015-11-20T10:24:40.203

在[光线投射算法](https://en.wikipedia.org/w/index.php?title=Point_in_polygon&oldid=678331753#Ray_casting_algorithm)中处理以下特殊情况：

1.  光线与多边形的一侧重叠。
2.  该点位于多边形内部，光线穿过多边形的一个顶点。
3.  该点位于多边形之外，光线刚好接触到多边形的一个角度。

检查[确定点是否在复杂多边形内](http://alienryderflex.com/polygon/)。本文提供了一种简单的方法来解决它们，因此上述情况不需要特殊处理。

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2015-11-22T12:46:27.037

您可以通过检查通过将所需点连接到多边形的顶点形成的区域是否与多边形本身的区域匹配来做到这一点。

或者您可以检查从您的点到每对两个连续多边形顶点到您的检查点的内角总和是否为 360，但我觉得第一个选项更快，因为它不涉及除法或计算三角函数的反函数。

我不知道如果你的多边形里面有一个洞会发生什么，但在我看来，主要思想可以适应这种情况

您也可以在数学社区中发布问题。我敢打赌他们有一百万种方法可以做到这一点

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2016-02-11T08:47:14.613

如果您正在寻找一个 java 脚本库，那么 Polygon 类有一个 javascript google maps v3 扩展来检测一个点是否位于其中。

```
var polygon = new google.maps.Polygon([], "#000000", 1, 1, "#336699", 0.3);
var isWithinPolygon = polygon.containsLatLng(40, -90); 
```

[谷歌扩展 Github](https://github.com/tparkin/Google-Maps-Point-in-Polygon)

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2016-03-18T07:44:46.033

使用[qt](/questions/tagged/qt "显示标记为“qt”的问题") (Qt 4.3+) 时，可以使用 QPolygon 的函数[containsPoint](http://doc.qt.io/qt-4.8/qpolygon.html#containsPoint)

* * *

## 回答 #30

> 赞同：0
> 
> 时间：2016-10-19T00:26:50.923

答案取决于您是否拥有简单或复杂的多边形。简单多边形不得有任何线段交点。所以它们可以有孔，但线不能相互交叉。复杂区域可以有线交点——因此它们可以有重叠区域，或者仅通过一个点相互接触的区域。

对于简单的多边形，最好的算法是光线投射（交叉数）算法。对于复杂的多边形，此算法不会检测重叠区域内的点。所以对于复杂的多边形，你必须使用绕组数算法。

这是一篇出色的文章，其中包含两种算法的 C 实现。我试过了，它们工作得很好。

[http://geomalgorithms.com/a03-_inclusion.html](http://geomalgorithms.com/a03-_inclusion.html)

* * *

## 回答 #31

> 赞同：0
> 
> 时间：2018-02-15T16:23:57.677

nirg 解决方案的 Scala 版本（假设边界矩形预检查是单独完成的）：

```
def inside(p: Point, polygon: Array[Point], bounds: Bounds): Boolean = {

  val length = polygon.length

  @tailrec
  def oddIntersections(i: Int, j: Int, tracker: Boolean): Boolean = {
    if (i == length)
      tracker
    else {
      val intersects = (polygon(i).y > p.y) != (polygon(j).y > p.y) && p.x < (polygon(j).x - polygon(i).x) * (p.y - polygon(i).y) / (polygon(j).y - polygon(i).y) + polygon(i).x
      oddIntersections(i + 1, i, if (intersects) !tracker else tracker)
    }
  }

  oddIntersections(0, length - 1, tracker = false)
} 
```

* * *

## 回答 #32

> 赞同：0
> 
> 时间：2018-10-30T10:59:20.350

这是@nirg 答案的golang 版本（灵感来自@@m-katz 的C# 代码）

```
func isPointInPolygon(polygon []point, testp point) bool {
    minX := polygon[0].X
    maxX := polygon[0].X
    minY := polygon[0].Y
    maxY := polygon[0].Y

    for _, p := range polygon {
        minX = min(p.X, minX)
        maxX = max(p.X, maxX)
        minY = min(p.Y, minY)
        maxY = max(p.Y, maxY)
    }

    if testp.X < minX || testp.X > maxX || testp.Y < minY || testp.Y > maxY {
        return false
    }

    inside := false
    j := len(polygon) - 1
    for i := 0; i < len(polygon); i++ {
        if (polygon[i].Y > testp.Y) != (polygon[j].Y > testp.Y) && testp.X < (polygon[j].X-polygon[i].X)*(testp.Y-polygon[i].Y)/(polygon[j].Y-polygon[i].Y)+polygon[i].X {
            inside = !inside
        }
        j = i
    }

    return inside
} 
```

* * *

## 回答 #33

> 赞同：0
> 
> 时间：2019-12-24T12:06:16.957

这似乎在 R 中有效（为丑陋道歉，希望看到更好的版本！）。

```
pnpoly <- function(nvert,vertx,verty,testx,testy){
          c <- FALSE
          j <- nvert 
          for (i in 1:nvert){
              if( ((verty[i]>testy) != (verty[j]>testy)) && 
   (testx < (vertx[j]-vertx[i])*(testy-verty[i])/(verty[j]-verty[i])+vertx[i]))
            {c <- !c}
             j <- i}
   return(c)} 
```

* * *

## 回答 #34

> 赞同：0
> 
> 时间：2020-03-18T00:32:10.513

如果您使用 Google Map SDK 并想检查一个点是否在多边形内，您可以尝试使用`GMSGeometryContainsLocation`. 效果很好！！这是它的工作原理，

```
if GMSGeometryContainsLocation(point, polygon, true) {
    print("Inside this polygon.")
} else {
    print("outside this polygon")
} 
```

这是参考：[https ://developers.google.com/maps/documentation/ios-sdk/reference/group___geometry_utils#gaba958d3776d49213404af249419d0ffd](https://developers.google.com/maps/documentation/ios-sdk/reference/group___geometry_utils#gaba958d3776d49213404af249419d0ffd)

* * *

## 回答 #35

> 赞同：0
> 
> 时间：2020-04-19T11:45:37.130

[为了完整起见，这里是由nirg提供并由](https://stackoverflow.com/a/218081/1612369)[Mecki](https://stackoverflow.com/a/2922778/1612369)讨论的算法的 lua 实现：

```
function pnpoly(area, test)
    local inside = false
    local tx, ty = table.unpack(test)
    local j = #area
    for i=1, #area do
        local vxi, vyi = table.unpack(area[i])
        local vxj, vyj = table.unpack(area[j])
        if (vyi > ty) ~= (vyj > ty)
        and tx < (vxj - vxi)*(ty - vyi)/(vyj - vyi) + vxi
        then
            inside = not inside
        end
        j = i
    end
    return inside
end 
```

该变量`area`是一个点表，这些点又存储为 2D 表。例子：

```
> A = {{2, 1}, {1, 2}, {15, 3}, {3, 4}, {5, 3}, {4, 1.5}}
> T = {2, 1.1}
> pnpoly(A, T)
true 
```

GitHub Gist的[链接。](https://gist.github.com/franekwow/0f4246a9b76ba11ef899023c1ffca54e)

* * *

## 回答 #36

> 赞同：0
> 
> 时间：2021-03-10T01:16:41.673

```
from typing import Iterable

def pnpoly(verts, x, y):
    #check if x and/or y is iterable
    xit, yit = isinstance(x, Iterable), isinstance(y, Iterable)
    #if not iterable, make an iterable of length 1
    X = x if xit else (x, )
    Y = y if yit else (y, )
    #store verts length as a range to juggle j
    r = range(len(verts))
    #final results if x or y is iterable
    results = []
    #traverse x and y coordinates
    for xp in X:
        for yp in Y:
            c = 0 #reset c at every new position
            for i in r:
                j = r[i-1] #set j to position before i
                #store a few arguments to shorten the if statement
                yneq       = (verts[i][1] > yp) != (verts[j][1] > yp)
                xofs, yofs = (verts[j][0] - verts[i][0]), (verts[j][1] - verts[i][1])
                #if we have crossed a line, increment c
                if (yneq and (xp < xofs * (yp - verts[i][1]) / yofs + verts[i][0])):
                    c += 1
            #if c is odd store the coordinates        
            if c%2:
                results.append((xp, yp))
    #return either coordinates or a bool, depending if x or y was an iterable
    return results if (xit or yit) else bool(c%2) 
```

这个 python 版本是通用的。您可以为 True/False 结果输入单个 x 和单个 y 值，也可以使用`range`for`x`和`y`遍历整个点网格。如果使用范围，则返回所有点`list`的 x/y 对。`True`该`vertices`参数需要一个二维`Iterable`的 x/y 对，例如：`[(x1,y1), (x2,y2), ...]`

示例用法：

```
vertices = [(25,25), (75,25), (75,75), (25,75)]
pnpoly(vertices, 50, 50) #True
pnpoly(vertices, range(100), range(100)) #[(25,25), (25,26), (25,27), ...] 
```

实际上，即使这些也行得通。

```
pnpoly(vertices, 50, range(100)) #check 0 to 99 y at x of 50
pnpoly(vertices, range(100), 50) #check 0 to 99 x at y of 50 
```

* * *

## 回答 #37

> 赞同：0
> 
> 时间：2021-07-07T23:49:37.627

我认为这是迄今为止所有答案中最简洁的另一个 numpyic 实现。

例如，假设我们有一个带有多边形空洞的多边形，如下所示： [![在此处输入图像描述](https://i.stack.imgur.com/LhIba.png)](https://i.stack.imgur.com/LhIba.png)

大多边形顶点的二维坐标是

```
[[139, 483], [227, 792], [482, 849], [523, 670], [352, 330]] 
```

正方形空心顶点的坐标是

```
[[248, 518], [336, 510], [341, 614], [250, 620]] 
```

三角形空心顶点的坐标是

```
[[416, 531], [505, 517], [495, 616]] 
```

假设我们要测试两个点`[296, 557]`，以及`[422, 730]`它们是否在红色区域内（不包括边缘）。如果我们找到这两个点，它将如下所示： [![在此处输入图像描述](https://i.stack.imgur.com/15MqO.png)](https://i.stack.imgur.com/15MqO.png)

显然，`[296, 557]`不在读取区域内，而`[422, 730]`在。

我的解决方案是基于[绕组数算法](https://en.wikipedia.org/wiki/Point_in_polygon#Winding_number_algorithm)。下面是我的 4 行 python 代码，仅使用`numpy`：

```
def detect(points, *polygons):
    import numpy as np
    endpoint1 = np.r_[tuple(np.roll(p, 1, 0) for p in polygons)][:, None] - points
    endpoint2 = np.r_[polygons][:, None] - points
    p1, p2 = np.cross(endpoint1, endpoint2), np.einsum('...i,...i', endpoint1, endpoint2)
    return ~((p1.sum(0) < 0) ^ (abs(np.arctan2(p1, p2).sum(0)) > np.pi) | ((p1 == 0) & (p2 <= 0)).any(0)) 
```

要测试实现：

```
points = [[296, 557], [422, 730]]
polygon1 = [[139, 483], [227, 792], [482, 849], [523, 670], [352, 330]]
polygon2 = [[248, 518], [336, 510], [341, 614], [250, 620]]
polygon3 = [[416, 531], [505, 517], [495, 616]]

print(detect(points, polygon1, polygon2, polygon3)) 
```

输出：

```
[False  True] 
```

* * *

## 回答 #38

> 赞同：-1
> 
> 时间：2014-09-17T19:52:54.777

这仅适用于凸形，但 Minkowski Portal Refinement 和 GJK 也是测试点是否在多边形中的绝佳选择。您使用 minkowski 减法从多边形中减去点，然后运行这些算法以查看多边形是否包含原点。

此外，有趣的是，您可以使用支持函数更隐含地描述您的形状，该支持函数将方向向量作为输入并沿该向量吐出最远的点。这使您可以描述任何凸面形状.. 弯曲的、由多边形制成的或混合的。您还可以进行操作以组合简单的支持功能的结果来制作更复杂的形状。

更多信息：http: [//xenocollide.snethen.com/mpr2d.html](http://xenocollide.snethen.com/mpr2d.html)

此外，游戏编程 gems 7 讨论了如何在 3d 中执行此操作（：

# xml - 连接xml文件

> ID：217591
> 
> 赞同：6
> 
> 时间：2008-10-20T05:34:27.633
> 
> 标签：xml, xslt, msxml

我有几个 xml 文件，它们的名称存储在另一个 xml 文件中。

我想使用 xsl 来生成 xml 文件组合的摘要。我记得有一种方法可以使用 msxml 扩展（我正在使用 msxml）。

我知道我可以使用每个文件的内容，`select="document(filename)"`但我不确定如何将所有这些文件合并为一个。

2008 年 10 月 21 日我应该提到我想对组合的 xml 进行进一步处理，因此仅从转换中输出它是不够的，我需要将它作为节点集存储在变量中。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-20T06:53:20.780

这只是你**可以**做的一个小例子：

*文件 1.xml：*

```
<foo>
<bar>Text from file1</bar>
</foo> 
```

*文件 2.xml：*

```
<foo>
<bar>Text from file2</bar>
</foo> 
```

*索引.xml：*

```
<index>
<filename>file1.xml</filename>
<filename>file2.xml</filename> 
```

*总结.xsl：*

```
<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" 
    xmlns:exsl="http://exslt.org/common"
    extension-element-prefixes="exsl">

  <xsl:variable name="big-doc-rtf">
      <xsl:for-each select="/index/filename">
        <xsl:copy-of select="document(.)"/>
      </xsl:for-each>
  </xsl:variable>

  <xsl:variable name="big-doc" select="exsl:node-set($big-doc-rtf)"/>

  <xsl:template match="/">
    <xsl:element name="summary">
      <xsl:apply-templates select="$big-doc/foo"/>
    </xsl:element>  
  </xsl:template>

  <xsl:template match="foo">
    <xsl:element name="text">
      <xsl:value-of select="bar"/>
    </xsl:element>  
  </xsl:template>

</xsl:stylesheet> 
```

将样式表应用于*index.xml*可为您提供：

```
<?xml version="1.0" encoding="UTF-8"?><summary><text>Text from file1</text><text>Text from file2</text></summary> 
```

诀窍是使用文档函数（几乎所有 XSLT 1.0 处理器都支持的扩展函数）加载不同的文档，将内容作为变量主体的一部分输出，然后将变量转换为节点集以进行进一步处理。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-20T06:56:51.897

假设您在这样的文件中列出了文件名：

```
<files>
    <file>a.xml</file>
    <file>b.xml</file>
</files> 
```

然后你可以在上面的文件中使用这样的样式表：

```
<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
    <xsl:output method="xml" version="1.0" encoding="UTF-8" indent="yes"/>

    <xsl:template match="/">
        <root>
            <xsl:apply-templates select="files/file"/>                          
        </root>
    </xsl:template>

    <xsl:template match="file">
        <xsl:copy-of select="document(.)"/>
    </xsl:template>
</xsl:stylesheet> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-20T06:43:02.143

看看[`document()`函数文档](http://msdn.microsoft.com/en-us/library/ms256465(VS.85).aspx)。

您可以`document()`在转换过程中使用它来加载更多的 XML 文档。它们作为节点集加载。这意味着您最初将包含要加载到 XSLT 的文件名的 XML 提供给 XSLT，然后从那里获取它：

```
<xsl:copy-of select="document(@href)/"/> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-21T01:25:13.533

感谢所有的答案。这是我与 msxml 一起使用的解决方案的要点。

```
<?xml version="1.0"?>
<xsl:stylesheet version="1.0" 
xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
xmlns:ms="urn:schemas-microsoft-com:xslt">
  <xsl:output method="xml"/>
  <xsl:template match="/">
    <xsl:variable name="combined">
      <xsl:apply-templates select="files"/>
    </xsl:variable>
    <xsl:copy-of select="ms:node-set($combined)"/>
  </xsl:template>
  <xsl:template match="files">
    <multifile>
      <xsl:apply-templates select="file"/>
    </multifile>
  </xsl:template>
  <xsl:template match="file">
    <xsl:copy-of select="document(@name)"/>
  </xsl:template>
</xsl:stylesheet> 
```

现在我正在尝试提高性能，因为每个文件大约 8 MB 并且转换需要很长时间，但这是另一个问题。

# php - 确定脚本在哪个服务器上以及 PHP 中的配置的最佳方法是什么？

> ID：217594
> 
> 赞同：3
> 
> 时间：2008-10-20T05:37:45.910
> 
> 标签：php, configuration

我正在尝试确定让 PHP 脚本确定脚本/站点当前正在哪个服务器上运行的最佳方法。

目前我有一个`switch()`用来`$_SERVER['SERVER_NAME'] . ':' . $_SERVER['SERVER_PORT']`确定它在哪个服务器上的。然后它会根据它所在的服务器设置一些路径、数据库连接参数、SMTP 参数和调试设置。（根据站点需要，可能还有其他参数。）

这意味着我可以简单地将站点放到任何已配置的服务器上，而无需更改任何代码（特别是配置）。如果是新服务器，那么我只需添加一个新服务器，然后`case`它就可以使用了。

我们已经完成了基于相同`SERVER_NAME:SERVER_PORT`组合的配置文件的加载，但发现这是您必须维护的另一个文件，而且我们不确定解析 ini 文件的速度，（尽管每个服务器都有额外的案例可能同样慢）。

我们遇到的另一个问题是，一个站点经常在两台服务器之间移动，但我们在每台服务器上都使用相同的`SERVER_NAME`和`SERVER_PORT`。这意味着我们需要暂时评论一个案例并确保它不会进入 repo。

另一个其他想法？它需要在所有服务器上都可用（有时`SERVER_NAME`不可`SERVER_PORT`用）。如果它与 CLI PHP 一起使用也会很好。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-20T05:43:16.150

如何使用**$_SERVER['SERVER_ADDR']**并将您的身份基于服务器的 IP 地址。

更新：在虚拟主机情况下，您可能还希望将 IP 与文档根路径连接起来，如下所示：

```
$id = $_SERVER['SERVER_ADDR'] . $_SERVER['DOCUMENT_ROOT']; 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-20T07:14:08.757

我们使用 $_SERVER['HTTP_HOST'] 变量创建 PHP 包含文件的文件名，该文件包含所有虚拟主机特定信息（我们将相同的软件部署到许多虚拟主机）

我喜欢这种技术，因为您可以巧妙地使用它来构建配置层次结构，例如 www.foo.com，

*   尝试加载*com.config.php*
*   尝试加载*foo.com.config.php*
*   尝试加载*www.foo.com.config.php*

这样做可以让您为全球所有实时站点设置选项，并根据需要调整各个站点。我们也有自己的开发者沙箱内部根域名，所以我们可以在 internal.config.php 中启用所有开发者级别的选项

您也可以反过来执行此操作，即尝试加载 www.foo.com.config.php，只有在未找到时才尝试加载 foo.com.config.php，依此类推。效率更高，但灵活性稍差。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-20T07:17:06.023

以下是您可以检查的一些变量：

```
$_SERVER['HTTP_HOST']; 
```

当php通过apache运行时，我使用它来检查我在哪个服务器上。

```
$_SERVER['USER'];
$_SERVER['LOGNAME']; 
```

当我知道我正在从控制台运行时，我使用这两个。其中之一总是解析为可用的用户名。控制台模式下似乎没有其他主机定义变量。

这可能对您没有足够的帮助；如果你发现你仍然很难唯一地识别你所在的服务器，你可以给它一点“推送”。在我的情况下，我有一个小配置文件，每个服务器都是唯一的，基本上设置一个 php 变量来定义我正在运行的*环境（例如**开发*或*生产*。）这样你只需要维护一个小的，易于重新创建的文件在您的源代码控制之外。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-20T07:20:10.413

我一直在我的网站上保留一个 config.php，存储可能对该服务器非常有用的信息。

*   进行 php 解析几乎（例如，需要打开、关闭文件等）与将代码放在每个脚本顶部一样快，并且比 ini 和 xml 配置解决方案快得多
*   每个服务器上站点配置的集中位置，因此易于保持最新状态（服务器不会经常更改，使用更新脚本更新配置很简单）。
*   可以由脚本生成，我所有的站点都有一个使用 $config[] assoc 数组重建配置文件的功能。
*   影响配置文件的更新就像 "$config['key'] = 'new value';config_update()"

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-09-04T01:15:49.970

我一直在使用以下机制：

```
if(__FILE__ === '/Sites/mywebsite.com/includes/config.php')
    define('SERVER', 'DEV');
else
    define('SERVER', 'PRODUCTION'); 
```

My development environment has a rather distinct path structure so this works well, and I don't need to worry if additional domains are added to `$_SERVER[HTTP_HOST]`, or a client that provides an incorrect HTTP_HOST value (although that would be rare ...).

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-20T07:20:53.283

为什么没有存储在项目目录之外的每个主机的配置文件并从 php 代码中读取？

拥有特定于主机的代码并不是一个好习惯。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-21T14:02:43.597

```
$posix_uname   = function_exists('posix_uname') ? posix_uname() : null;
$this_hostname = !empty($_SERVER["HOSTNAME"]) ? $_SERVER["HOSTNAME"] : $_ENV["HOSTNAME"];
$this_hostname = !empty($this_hostname) ? $this_hostname : $posix_uname['nodename']; 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-01-20T15:10:13.097

We use environment variables for this (ENVPHP environment variable which will contain the specific server environment - ie. development/test/production). This approach works very well for CLI scripts as well (for CLI you set the OS environment variables, for Apache you can use SetEnv switches in the host configuration). In PHP you access this environment variable using getenv('ENVPHP')...

# perl - 如何使用 Perl 的 Getopt::Long 按照用户输入的顺序获取选项？

> ID：217595
> 
> 赞同：3
> 
> 时间：2008-10-20T05:39:29.730
> 
> 标签：perl, getopt

我有一个现有的 Perl 程序，它使用`Getopt`package 和`Getopt::Long::Configure`with`permute`作为选项之一。但是，现在我需要保持用户输入的选项的顺序。`$RETURN_IN_ORDER`中提到了一个选项`Long.pm`，但似乎根本没有在任何地方使用。

当我通过`return_in_order`时，我收到以下错误。

* * *

> Getopt::Long：C:/Program Files/IBM/RationalSDLC/common/lib/perl5/5.8.6/Getopt/Long.pm 第 1199 行的未知配置参数“return_in_order”。

* * *

有人可以告诉我这是否受支持，如果支持，正确的使用方式？如果没有，我想知道我还有其他选择。

谢谢。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-20T05:46:59.837

我想你想要“require_order”

[http://perldoc.perl.org/Getopt/Long.html#Configuring-Getopt%3a%3aLong](http://perldoc.perl.org/Getopt/Long.html#Configuring-Getopt%3a%3aLong)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-20T06:25:26.907

您有两个指向“require_order”的答案，但我认为这两个答案都误解了“require_order”的作用和您所寻求的。

如果 'require_order' 未设置，那么您可以编写（在命令行上）：

```
-a file -b 
```

其中 -a 和 -b 都是简单的选项（不带参数）。设置 'require_order' 后，'file' 的存在会终止选项，并且 '-b' 标志变为 'file name'。

我认为您正在寻找的是一种机制，可以让您知道“-a”出现在“文件”和“-b”之前。我不认为 Getopt::Long 支持这一点。事实上，我不知道有任何 Getopt::* 模块可以做到这一点（除了我自己的、未发布的、我有时使用的 Getopt::JLSS）。[*如果您对代码感兴趣，请通过 Gmail 给我发送电子邮件，在名字和姓氏之间使用一个点。*]

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-20T05:45:09.547

`require_order`根据我在这里的手册页，它被称为。:-)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-20T08:08:46.043

如果您为您的程序提供一个示例调用，也许会有所帮助。

Getopt::Long 支持将选项与普通的“位置”参数混合：

```
./foo --option1 --option2 file1 file2 file3 
```

如果仅使用 GetOptions 解析选项，则 file1 到 3 将按照它们出现的顺序留在 @ARGV 中。也许您可以使用该行为来实现您想要的。

此外，您可以多次指定相同的选项并将结果放入数组中（按顺序！）：

```
#!/usr/bin/perl
use strict;
use warnings;
use Getopt::Long;
my @permute;
GetOptions(
  'p=s' => \@permute,
);

print "$_\n" for @permute; 
```

"perl foo.pl -p=1 -p=2 -p=3 -p=4" 会产生以下输出：（*注意：* "-p X" 与 "-p=X" 的作用相同）

```
1
2
3
4 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-20T10:13:17.883

在我的情况下，要求非常不同，因为命令行参数将是选项和参数的组合，如下所示。

我的工具 -arg1 值 1 -arg2 值2 -arg3 值3

这就是为什么 require_order 不是特别有用的原因。

正如我刚刚发现的那样，问题并不在于解析组件。它与用于存储它们的散列对象一起使用。

正如 tsee right 所指出的，如果我们使用默认配置，顺序将是相同的。

无论如何，谢谢各位。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2013-08-13T17:15:05.723

需要知道指定选项的顺序是我仍然使用 Getopt::Mixed 的原因。该模块有一个 nextOption 函数，您可以循环访问它，它会按照它们在命令行上的顺序为您提供选项。

我的用例是包含和排除正则表达式：

`myscript /usr --include /usr/local/bin --exclude /usr/local`

当然，实际发生的情况还取决于我如何通过脚本处理包含和排除，但我需要知道顺序。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2018-03-28T12:28:58.793

*聚会*很晚。我使用[选项处理子例程](https://metacpan.org/pod/Getopt::Long#User-defined-subroutines-to-handle-options)来做到这一点。我的特殊用例是我需要以任何顺序处理任意数量的`-e <foo>`和`-f <foo>`选项，并保留该顺序（对于[个人项目](https://github.com/cxw42/axk)）。

```
use Data::Dumper; use Getopt::Long; use strict; use warnings;
my @Sources;    # Each element is [was -f, parameter]

my $dr_save_source = sub {      # Called each time we see -e or -f
    my ($which, $text) = @_;
    push @Sources, [$which eq "f", $text];
}; # dr_save_source

GetOptions("e=s@" => $dr_save_source, "f=s@" => $dr_save_source);
print Dumper(\@Sources); 
```

将子例程引用`$dr_save_source`作为与选项规范 () 关联的值提供，`=> $dr_save_source`告诉`GetOptions`调用该子例程以在选项出现时对其进行处理。

随着选项数量的增加，这可能会有点笨拙，但它是......一个选项。

# asp.net-mvc - 将所有请求重定向到 IIS6 上的 ASP.NET MVC

> ID：217597
> 
> 赞同：2
> 
> 时间：2008-10-20T05:43:11.187
> 
> 标签：asp.net-mvc, redirect, iis-6, http-status-code-404

我可能在这里忽略了一些非常简单的事情，但我试图将所有错误的 URL 重定向到根据条件过滤 URL 的操作，然后 301 重定向到合适的页面或发出 404 页面。

为此，我在路由表的末尾有一条这样的路由：

```
routes.MapRoute("Error", "{*url}", new { controller = "Main", action = "Error" }); 
```

像这样的动作：

```
public ActionResult Error(string url)
{
        if (/* Conditions are met... */)
        {
            Response.Status = "301 Moved Permanently";
            Response.AddHeader("Location", /* Destination URL */);
            Response.End();
        }

        Response.StatusCode = 404;
        return View(/* 404 page... */));
} 
```

这在本地完美运行。

但是，当部署到 IIS6 时，不包含 .mvc（例如 oldfile.php）的 URL 永远不会发送到 ASP.NET 进程进行路由。

有没有简单的解决方案/我忽略了什么？

编辑：这与[这个问题有关](https://stackoverflow.com/questions/108813/404-http-error-handler-in-aspnet-mvc-rc-5)，但是在没有 .mvc 的 IIS6 URL 下，不会发送 ASP.NET MVC 处理。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-20T06:06:17.507

当您部署到服务器时，很可能没有调用 ASP.Net。

我会在 IIS 中设置通配符映射，以便您的请求将使用 ASP.Net 来处理请求。

打开 IIS 管理器，右键单击您的应用程序，转到“属性”，然后转到“主目录”选项卡，然后单击“配置”。在通配符应用程序映射下，单击插入（不是添加，这在上面令人困惑），然后为“可执行文件”输入 C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\aspnet_isapi.dll，并取消选中验证文件是否存在。

有关更多信息，请访问帮助我解决此问题的来源：http: [//blog.codeville.net/2008/07/04/options-for-deploying-aspnet-mvc-to-iis-6/](http://blog.codeville.net/2008/07/04/options-for-deploying-aspnet-mvc-to-iis-6/)

# php - 在 PHP 中 $this-> 之后使用美元符号是什么意思？

> ID：217612
> 
> 赞同：7
> 
> 时间：2008-10-20T05:49:26.480
> 
> 标签：php, syntax, oop

我对遇到的一些 PHP 语法感到有些困惑。这是一个例子：

```
$k = $this->_tbl_key;

if( $this->$k)
{
   $ret = $this->_db->updateObject( $this->_tbl, $this, $this->_tbl_key, $updateNulls );
}
else
{
    $ret = $this->_db->insertObject( $this->_tbl, $this, $this->_tbl_key );
} 
```

我的问题基本上是什么`$this->$k`意思？我认为这可能意味着成员变量的名称为 in `$this->_tbl_key`，但它是如何工作的呢？是否可以在运行时将成员变量添加到类中？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-10-20T05:51:35.117

它会查找“k”的任何值，并将其视为变量名。这两个样本是相同的：

```
echo ($obj->myvar);

####

$k = "myvar";
echo ($obj->$k); 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-20T05:51:53.697

我相信这是[可变变量](http://us.php.net/language.variables.variable)的情况。

# language-agnostic - 查找映射/哈希的良好命名约定是什么？

> ID：217614
> 
> 赞同：7
> 
> 时间：2008-10-20T05:50:52.263
> 
> 标签：language-agnostic, naming-conventions

在数据处理中，我经常需要创建一个查找数据结构来将一个标识符映射到另一个标识符。作为一个具体的例子，让我们看一个结构，它包含一个国家的 2 个字符代码和它的全名之间的 1 对 1 映射。在里面我们会有

```
AD -> Andorra   
AE -> United Arab Emirates  
AF -> Afghanistan 
```

保存这张地图的变量的好名字是什么？一些想法（我将使用驼峰命名）：

```
countryNameByCode
nameByCodeLookup
nameCodeLookup
codeToName 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-20T06:01:39.077

`codeToName`在这种特殊情况下，我的投票是赞成的，我想这可以概括。这并不是说这是我在所有情况下都会选择自己的名字。这在很大程度上取决于范围、进一步的封装等等。但这感觉是个好名字，应该有助于使您的代码可读：

```
String country = codeToName["SV"]; 
```

看起来相当不错，应该很容易被任何人理解。可能将“代码”一词更改为更精确的词（“国家代码”将是我的下一个选择）。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-20T06:55:47.093

```
country_name = countries_by_code[country_code] 
```

它通过了“电话听写”测试，听起来也更像自然语言。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-20T06:12:39.380

我喜欢用复数来表示集合。

```
countryNames 
```

编辑：`countryCodes`是错误的，因为您正在从代码映射到名称。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-20T05:59:32.730

我通常这样做：

countryCodeMappingByName

或者，如果映射是唯一的，只需简单地：

国家代码映射

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-20T06:17:08.420

发音时使用听起来正确的东西。这也意味着适当地命名您的关键变量。例子：

```
countryName = countries[countryCode]; 
```

这很有意义——你给`countries`一个`countryCode`，它返回一个`countryName`。这将是多余的：

```
countryName = countryCodesToNames[countryCode]; 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-20T06:38:36.257

在 C# 中，我会调用执行此操作的类型`CountryCodeToNameMapping`。通常我会调用一个变量`countryCodeToNameMapping`，但在某些非常受限的上下文中（*例如*，lambdas），我可能会调用它`c`或`m`。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2020-10-14T09:13:53.857

我会选

```
countryName = countryByCode["DE"] 
```

除非你的代码中有一个*Country*类，在这种情况下我会选择

```
countryName = countryNameByCode["DE"] 
```

它清晰、简洁、易于阅读。

地图首先不是集合，而是地图。因此，我不会选择类似`countries`or的名称`countriesByCode`。根据上下文，*有时*强调地图的论点可能是合理的（参见[unwind 的答案](https://stackoverflow.com/a/217628/10716984)）。但就个人而言，我认为在你的情况下，

```
countryName = CountryCodeToName["DE"] 
```

或类似的东西并不反映您的意图（获得国家名称）以及上面给出的名称。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2008-10-25T07:41:56.847

另一个投票只是将您映射到的内容多元化。

例如。`country = countries[code]`

# php - __construct() vs SameAsClassName() 用于 PHP 中的构造函数

> ID：217618
> 
> 赞同：70
> 
> 时间：2008-10-20T05:52:58.967
> 
> 标签：php, constructor

`__construct()`在 PHP 中使用而不是类的名称作为构造函数有什么好处吗？

示例 ( `__construct`)：

```
class Foo {
    function __construct(){
        //do stuff
    }
} 
```

示例（命名）：

```
class Foo {
    function Foo(){
        //do stuff
    }
} 
```

从 PHP 5 开始就可以使用该`__construct`方法（第一个示例）。

从 PHP 版本 4 到版本 7，可以使用与类同名的方法作为构造函数（第二个示例）。

* * *

## 回答 #1

> 赞同：71
> 
> 时间：2008-10-20T09:25:22.893

我同意小发明，优点是如果你重命名你的类，你不必重命名它。干燥。

同样，如果您有一个子类，您可以调用

```
parent::__construct() 
```

调用父构造函数。如果进一步更改子类继承的类，则不必更改对父类的构造调用。

这似乎是一件小事，但是缺少将构造函数调用名称更改为您的父类可能会产生微妙的（而不是那么微妙的）错误。

例如，如果您将一个类插入到您的 heirachy 中，但忘记更改构造函数调用，您可以开始调用祖父母的构造函数而不是父母的构造函数。这通常会导致难以察觉的不良结果。

另请注意

> 从 PHP 5.3.3 开始，与命名空间类名的最后一个元素同名的方法将不再被视为构造函数。此更改不会影响非命名空间类。

来源： http: [//php.net/manual/en/language.oop5.decon.php](http://php.net/manual/en/language.oop5.decon.php)

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2008-10-20T05:57:11.673

`__construct`在 PHP5 中引入。这是你现在应该这样做的方式。不过，我不知道本身有任何*优势。*

来自 PHP 手册：

> 为了向后兼容，如果 PHP 5 找不到给定类的 __construct() 函数，它将按类的名称搜索旧式构造函数。实际上，这意味着唯一会出现兼容性问题的情况是，如果该类有一个名为 __construct() 的方法，该方法用于不同的语义

如果您使用的是 PHP5，我建议您使用`__construct`它来避免让 PHP 看起来别处。

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2008-10-20T06:01:11.930

我看到 __construct 的主要优点是，如果更改类名，则不必重命名构造函数。

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2013-06-16T09:14:03.653

今天，公认的答案已经过时了。

重命名类是不好的做法：每次升级到较新版本时，您都必须记住要重命名的内容和位置。有时（比如使用[反射](http://php.net/manual/en/book.reflection.php)或复杂的依赖结构）如果不进行彻底的重构是不可能的。这是您要避免的[意外复杂性。](http://en.wikipedia.org/wiki/Accidental_complexity)这就是**命名空间**被引入 PHP 的原因。Java、C++ 或 C# 不使用`__construct`，它们使用命名构造函数，它们没有问题。

> **从 PHP 5.3.3 开始，与命名空间**类名的最后一个元素同名的方法将不再被视为构造函数。此更改**不会影响非命名空间类**。

**例子**

```
namespace Foo;
class Test {
  var $a = 3;

  function Test($a) {
    $this->a = $a;
  }

  function getA() {
    return $this->a;
  }
}

$test = new Test(4);
echo $test->getA(); // 3, Test is not a constructor, just ordinary function 
```

请注意，不推荐使用命名构造函数（今天的 PHP 5.5）。但是，您无法预测您的类不会在命名空间中使用，**因此** `__construct`应该优先使用。

**澄清上述不良做法**（针对丹尼斯）

您可以在代码中的某处使用[ReflectionClass::getName()](http://www.php.net/manual/en/reflectionclass.getname.php)；当你重命名类时，你需要记住你在哪里使用了反射，并检查`getName()`结果在你的应用程序中是否仍然一致。您需要记住的特定内容越多，就越有可能忘记某些内容，从而导致应用程序出现错误。

父母无法控制世界上所有依赖他们的班级。如果启用了[allow_url_include](http://cz1.php.net/manual/en/filesystem.configuration.php#ini.allow-url-include)，则其他一些网站可能正在使用您服务器中的类，如果您重命名某个类，它可能会崩溃。在上面提到的编译语言中情况更糟：该库可以复制并捆绑在其他代码中。

没有理由重命名类：

*   如果类名冲突，使用命名空间
*   如果类责任转移，则派生一些其他类

在命名空间中的 PHP 类中，无论如何都应该避免使用同名的方法：直观地说，它应该产生一个创建该类的对象；如果它做其他事情，为什么要给它同样的名字？它应该是一个构造函数，没有别的。主要问题是这种方法的行为取决于命名空间的使用。

PHP 中的 __construct 构造函数没有问题。但改变命名构造函数并不是最聪明的主意。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2008-10-20T09:30:19.030

使用`__contruct()`而不是的最大优势`ClassName()`是在扩展类时。`parent::__construct()`调用它而不是更容易`parent::ClassName()`，因为它可以在类之间重用，并且可以轻松更改父级。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2015-05-13T03:03:48.823

在您的示例`Foo::Foo`中，有时称为 PHP 4 或旧式构造函数，因为它来自 PHP 4 时代：

```
class Foo {
    // PHP 4 constructor
    function Foo(){
        //do stuff
    }
} 
```

[PHP 4 构造函数将被弃用，但不会](https://wiki.php.net/rfc/remove_php4_constructors)在 PHP 7 中删除。在 PHP 8 的任何情况下，它们都将不再被视为构造函数。未来的兼容性绝对是不使用此功能的一个重要原因。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2015-03-29T13:50:35.287

好吧，这个问题被问到已经有几年了，但我想我仍然必须回答这个问题，因为事情已经发生了变化，对于未来的读者，我希望让信息保持最新！

因此在 php-7 中，他们将删除将构造函数创建为与类同名的函数的选项。如果你仍然这样做，你会得到一个`E_DEPRECATED`.

您可以在此处阅读有关此提案的更多信息（该提案已被接受）： [https ://wiki.php.net/rfc/remove_php4_constructors](https://wiki.php.net/rfc/remove_php4_constructors)

并从那里引用：

> **只要**定义了 PHP 4 构造函数，****PHP 7**就会发出**E_DEPRECATED**。当方法名与类名匹配时，该类不在命名空间中，并且 PHP 5 构造函数 (__construct) 不存在，则将发出 E_DEPRECATED。**PHP 8 将停止发出 E_DEPRECATED 并且这些方法将不会被识别为构造函数。****

 ******`E_STRICT`如果你定义一个与类和 a 同名的方法，你也不会在 php-7 中得到a `__construct()`。

你也可以在这里看到：

> **当存在与类同名的方法以及 __construct 时，**PHP 7**也将**停止发出 E_STRICT 。****

 **所以我建议你使用`__construct()`，因为将来你会遇到更少的问题。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-10-20T06:00:04.227

在 PHP 5 中，优点是性能会更好。它将查找名称为`__construct`first 的构造函数，如果找不到，它将查找名称为 的构造函数`className`。因此，如果它通过名称找到构造函数，`__construct`则不需要按名称搜索构造函数`className`。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-10-20T09:14:50.277

前向兼容性。为了向后兼容而留在语言中的遗留代码总是有可能在未来的版本中被删除。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2013-12-06T06:35:54.493

如果有方法 __construct 和 SameAsClassName 方法，则 __construct 将被执行，SameAsClassName 方法将被跳过。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2013-06-06T00:44:25.240

我认为主要原因是语言约定。你不需要强迫一种语言表现得像其他人一样。

我的意思是，例如，在 Objective-C 中，您可以在构造函数前加上 -init。您可以使用您的类名创建自己的构造函数，但为什么呢？有什么理由使用这个模式而不是语言约定吗？

# multithreading - 从工作线程调用更新 UI 线程是如何工作的？

> ID：217645
> 
> 赞同：2
> 
> 时间：2008-10-20T06:22:36.257
> 
> 标签：multithreading, user-interface, asynchronous

如果我在处理某些数据的线程中有一个函数，那么它会调用一个回调函数来更新 UI 中的状态。

如果 UI 需要时间来处理回调函数，那么它就没有多大用处。除了在回调函数中处理更新之外，它是否应该以不阻塞的方式向 UI 发送某种消息？

我的意思是当在处理函数中并且我调用更新状态函数时，这应该立即返回到处理函数，然后在更新中它可以等待所有它想要的 UI 更新完成。

还是我需要第三个线程来处理向 UI 发送更新数据？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-20T06:32:20.310

通常有一种方法可以在不阻塞的情况下将回调发布到 UI 线程。

例如：

*   在 Win32 上有[PostMessage](http://msdn.microsoft.com/en-us/library/ms644944.aspx)
*   在 .NET Windows 窗体中有[Control.BeginInvoke](http://msdn.microsoft.com/en-us/library/system.windows.forms.control.begininvoke.aspx)（实现[ISynchronizeInvoke.BeginInvoke](http://msdn.microsoft.com/en-us/library/system.componentmodel.isynchronizeinvoke.begininvoke.aspx)）
*   在 Java 中有[EventQueue.invokeLater](http://java.sun.com/j2se/1.5.0/docs/api/java/awt/EventQueue.html#invokeLater(java.lang.Runnable))

我敢肯定，如果您查看正在使用的 UI 工具包的文档，您会发现类似的东西。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-20T06:32:50.730

在 .NET（WinForms、WPF、Silverlight）中，您只需使用 UI 线程上的 Dispatcher 对象来调用用户界面的更新方法。调度程序既可以同步调用（使用 Invoke），也可以[异步](http://www.codeproject.com/KB/cs/AsyncMethodInvocation.aspx)调用（使用 BeginInvoke/EndInvoke）。请注意，在 .NET 中，需要为每个 BeginInvoke 调用 EndInvoke（因为 .NET 不保证异步句柄将被释放），因此默认情况下 Fire and Forget 不是一个选项（除非您实现你自己的[FireAndForget](http://www.codeproject.com/KB/dotnet/async_pattern.aspx)）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-20T06:27:46.510

Mapad 在[此处](https://stackoverflow.com/questions/207230/hooking-up-gui-interface-with-asynchronous-sftp-operation)发布了指向 UI 和线程的链接，您可能会发现它很有用。你没有提到哪个 UI 工具包和哪种语言，所以我不能给你任何细节。

# .net - 使用实体框架实体作为业务对象？

> ID：217655
> 
> 赞同：57
> 
> 时间：2008-10-20T06:34:59.617
> 
> 标签：.net, entity-framework, architecture

我正在使用 Microsoft 的 Entity Framework O/R 映射器，并将实体类（映射到 DB 对象的生成类）用作业务对象。这个可以吗？请说出你的缺点或优点。在业务层和表示之间进行WCF通信的情况下该怎么办，如何将这些对象作为数据成员发送？

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2011-07-01T02:58:46.647

首先，在撰写本文时，有 11k 的问题视图，我对缺乏答案感到有点惊讶，恕我直言，答案的质量，给出了一个相当简单的问题。

所以，既然我已经发泄了一点，我想解决这个问题，因为我认为它在今天更适用于最近发布的 Entity Framework Code-First。

> “使用实体框架实体作为业务对象？”

在我开始之前澄清几点：

*   当您说“业务对象”时，我的印象是您所指的这些对象包含规则或逻辑，例如从简单的验证（即必填字段）到更复杂的逻辑（即结账时的处理税）。

*   我认为我无法回答您关于 WCF 的后续问题。这样做的原因仅仅是因为我将客观地回答您关于 EF 作为业务对象的问题，然后主观地迫使我采取与我试图真实客观地回答所述第一个问题的尝试相矛盾的立场。

也就是说，将您的 EF 作为业务对象问题...

> “我正在使用 Microsoft 的实体框架 O/R 映射器，并使用实体类（映射到 DB 对象的生成类）作为业务对象。可以吗？”

对不起，这里根本没有正确或错误的答案。这取决于您的目标是什么，以及在充分了解这样做的优缺点的同时，您得出的结论是最合理的设计。

> “请说出你的优缺点”</p>

我很高兴你问！我很乐意回答，我希望在考虑到利弊的情况下，您能够就您是否认为将 EF 用于您的业务对象是“OK”做出明智的决定。通常情况下，我会列出利弊，以便于“消化”，但是，我认为这在这里不合适，因为我认为我们会对这样一个非常有趣的话题做出不公正的对待，而且也很接近和亲爱的我的心。

首先，让我从技术上谈一下……您可以将 EF 对象用作您的业务对象，没有什么技术上阻止您这样做。事实上，EF Code-First (CF) 通过允许您创建 POCO 并让您能够应用数据注释以进行简单验证以及实现 IValidatableObject 以进行更复杂的验证，从而使这非常容易。很酷，嗯？

讨论的核心就在这里。

EF 或任何 ORM 旨在支持数据管理。它的主要职责是数据，因此您创建的对象是以数据为中心的。所以，如果你也试图通过行为来设计你的对象，那么你手头就有一个难题。简而言之，这个难题被称为阻抗失配。想象一下；您的应用程序中有两个必需的用例：

1.  编辑用户的屏幕
2.  显示用户信息的只读子集的控件

如果使用 EF（任何风格）或任何 ORM，您可能会倾向于使用相同的“用户”对象来处理保存用户以及获取用户以提取只读字段子集的能力。您这样做可能是出于以下几个原因之一：

1.  像许多开发人员一样，我们在教育过程中在我们的大脑中播下了这颗种子，“整合代码”是最重要的，或者可能更好地称为 DRY——不要重复自己，因此您可能会在消极的语境。
2.  诸如 EF 4.1 之类的 ORM 具有技术限制（和骇人听闻的变通办法），例如将多个 POCO/对象映射到同一个数据库表，从而迫使您不管您的信念如何。
3.  这是启动和运行应用程序的一种快速简便的方法
4.  它“感觉”是正确的做法

这样做有好处也有坏处，你可以根据你的意见来看待这是积极或消极的方式。

我想如果你相信代码的规范化而不是行为，那么你已经取得了很大的成功。通过编写单个对象来处理该实体的数据和业务用例，您可以限制代码量，从而可能节省时间。

我想如果你相信代码行为的规范化，那么你就惨败了。通过节省代码，您已经牺牲了设计对象的职责，这可能会使其难以管理，从而增加维护成本。

不管您的意见如何，我们可能都同意这个业务对象承担了多项职责，并且对象的行为（不是数据！）充其量是次要的。它的主要职责是管理数据，次要职责是处理简单和复杂的业务规则，涉及编辑用户和显示只读用户信息。在面向对象设计 (OOD) 中，如果一个对象的设计以其身份和行为为特征，那么该对象可能是一个困惑的个体，因为它不符合 OOD 的定义。

从技术角度来看，任何时候您请求用户对象都会继承大量开销。当仅显示只读信息的子集时，这可能包括所有属性和业务规则等内容。

那么这一切与我是否应该使用 EF 来表示我的业务对象有什么关系呢？

嗯……虽然在技术上是可行的，但对于是否应该使用 EF 或任何 ORM 来表示您的业务对象，存在不同的理念（有些好，有些不好）。我针对上述这些哲学的核心给出了一个概要，但是 Rocky Lhotka 和 Martin Fowler 等人对它们进行了更详细的记录。

您采取的方向很可能取决于应用程序，从哲学角度来看，可能取决于您是理想主义者还是实用主义者。也就是说，我并不是说理想主义者或实用主义者与是否将 EF 用于业务对象相关——它只会影响您对此的看法。

在撰写本文时，Microsoft 的迹象表明 EF 是为处理业务逻辑而构建的，无论对错，它们似乎都朝着这个方向发展。EF 不断发展，某些技术限制正在被取消，因此 EF 最终可能被用于满足两全其美的需求。换句话说，最终你也许可以吃到你的蛋糕。

希望这可以帮助。

考虑到 ORM 背后的目的是管理数据，回答一个关于 ORM 的持久性无知是否荒谬的问题。:-) 对不起，我无法抗拒！

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2008-10-20T12:48:01.720

我以这种方式使用 EF，一个不错的特性是生成的实体是部分类，允许它们以一种不受再生问题影响的方式进行扩展。

还可以查看[MSDN 上的此链接](http://msdn.microsoft.com/en-us/library/cc716789.aspx)，该链接描述了 EF 在业务逻辑方面的一些常见使用场景。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2008-10-20T06:38:24.930

Entity 框架是为将实体对象用作业务对象而设计的，但您应该记住，业务对象将与 O/R 技术以及 EDM 模型相关联。在 EF 1.0 中，没有任何对*[持久性忽略](http://blogs.msdn.com/dsimmons/pages/ef-faq-entity-classes.aspx#_Does_Entity_Framework "实体框架是否支持")*方案的支持，但在 4.0 中添加了支持。如果您不想使用它们的任何基类，您可以实现[接口。](http://msdn.microsoft.com/en-us/library/bb738631.aspx "MSDN：实现自定义数据类接口")

从 .NET 3.5 SP1 开始，它们也应该可以用作 WCF 服务方法中的参数和返回类型，而无需任何额外的代码。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-20T14:07:41.997

根据我的经验，我们在应用程序的业务层中使用了 EF 对象，但是当我们通过 WCF 服务层过渡到表示层时，我们将从 EF 对象创建视图对象。

在我们的例子中，只有视图被传递到表示层。我们这样做是为了控制数据的呈现方式，并对来自表示层的数据应用防御性验证。

如果在 WCF 事务中使用 EF 对象，您将丢失与 EF 对象关联的对象上下文。CodePlex 有一些努力试图帮助解决这个问题，但我没有跟上他们的努力。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-12-02T05:39:32.847

我遇到的两个限制是：

1.  继承的对象不能有导航属性——即如果你有一个“人”类，然后是一个“客户”和“供应商”，这些客户和供应商不能有导航属性。

2.  方法和计算字段（部分类中的任何内容）不会通过 ADO.Net 数据服务传输 - 如果您还使用 ADO.Net 数据服务，则您在部分类中扩展实体框架对象的任何内容都不会通过 ADO.Net 传输数据服务。

这些通常不是显示停止项（对于导航属性，我们暂时不使用实体框架上的继承），但您可能会感兴趣。我希望未来的版本能够启用这两个项目。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-11-11T07:33:19.340

如果对象丢失了原始对象上下文，您就不能重新附加对象吗？不过，您需要自己处理并发问题。

我不建议将 EF 对象用作 WCF 的 DataContract 对象，因为您将实体对象的实现与 Web 服务客户端紧密联系在一起，将来很难进行更改，您计划拥有的客户端越多，就越难。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2010-02-20T20:01:50.300

**[WPF 应用程序框架 (WAF)](http://waf.codeplex.com)**的 BookLibrary 示例应用程序展示了如何将模型-视图-视图模型 (MVVM) 模式与实体框架结合使用。

# php - 用php搭建插件系统

> ID：217659
> 
> 赞同：35
> 
> 时间：2008-10-20T06:41:55.173
> 
> 标签：php, plugins

我正在为自己使用定制 CMS，并且正在考虑实现一个插件系统，以便我可以更轻松地扩展代码。不过，我在概念化架构和布局时遇到了麻烦。

我知道我可以通过一些实现类似功能的开源程序，但这实际上只是学术性的，所以我真的不想花太多时间挖掘外国代码。

有没有人对如何进行有任何好主意？如果有人可以概述一些更流行的程序是如何做到的，那就完美了。

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2008-10-20T07:19:19.463

1.  定义您希望插件插入的功能（即，它们将做什么以及做什么）
2.  定义适合插件的类层次结构，例如，所有文章修饰插件都应继承自 ArticleMangler
3.  定义插件的物理位置，例如 /plugins
4.  导入该位置中存在的所有插件
5.  使用[装饰器](http://wikipedia.org/wiki/Decorator_pattern)或[观察者](http://wikipedia.org/wiki/Observer_pattern)模式注入插件的行为或通知插件事件发生。[策略](http://wikipedia.org/wiki/Strategy_pattern)也可能适用于某些情况。

如果您不小心，PHP 使这相当容易，但可能会造成混乱。我喜欢 Observer 方法，其中插件将自己注册到插件管理器，该插件管理器会通知他们发生的事情并等待他们的操作发生。

如果您不信任插件，那么您必须添加控件来控制您将允许任何插件注册的事件。

# inheritance - 我应该继承 List 还是将其作为财产？

> ID：217665
> 
> 赞同：15
> 
> 时间：2008-10-20T06:46:12.277
> 
> 标签：inheritance, oop

在过去的几个月里，我经常遇到这个问题，在此期间我一直在构建这个系统。场景是这样的：我有这种对象，它本质上是其他对象的列表，但具有一些其他特定于其性质的属性。例如：

*   类`Tests`：
    *   包含许多`Test`对象
    *   有属性：
        *   `DefaultTimeouts`
        *   `DefaultNumberOfTries`

我应该有这个类的子类`List<Test>`还是应该让它继承自`Object`，只是将列表作为其他字段旁边的属性？

我知道这可能有点主观，个人品味可能会在这里起作用，但我非常想知道您对此的看法。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-10-20T07:34:16.643

与这里的大多数答案相反，在大多数情况下，我不会从 List 子类化。我发现从一个类继承来重用功能通常会在以后引起问题。

我通常只有一个 List（或 IList）类型的属性，它返回对列表的引用。通常你在这里只需要一个 get 属性。您可以通过选择使用 .AsReadOnly() 返回列表的只读版本或仅将列表公开为 IEnumerable 来控制对列表的访问。

在我希望 Tests*成为*列表的情况下，我通常实现 IList 并为 IList 的实际实现调用内部 List 字段。这需要更多的工作，并导致需要维护更多的代码，但我发现这比仅仅为了实现而继承 List 更易于维护。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-20T06:52:19.240

List<T> 的子类。如果您将 List 泛型作为属性，那么它就没有像子类那样被很好地封装。

如果它看起来像 List<T> 并且听起来像 List<T>，那么它可能是 List<T>。

我称之为TestCollection。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-20T06:48:20.993

如果它确实做了所有 a`List`会做的事情，并且所有`List`函数都会`Tests`以直观的方式作用于对象并给出正确的结果，那么在我看来它应该只是 subclass `List<Test>`。

`List<Test>`否则，您将拥有一个包含大量方法的类，这些方法仅在实例中的变量上调用同名方法。这只是`List<Test>`类本身的不完美扩展。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-20T06:49:47.217

继承通常映射到“is-a”关系。由于您的容器*是一个*列表，但还有其他一些东西，我将从 List 继承并将您的其他属性添加到您的子类中。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-20T06:57:12.770

我不认为你所拥有的是一个简单的“测试列表”，因为你需要更多的东西。我建议您调用它`TestSuite`并将列表作为属性。*与继承相比， has-a*更容易维护。

一般来说，我会非常小心地继承类似 a 的东西`List`。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-20T07:07:25.993

在阅读答案时，关键问题似乎*是你的对象**真的**是一个列表的长度是多少？*因此，在继承的危险和组合的缺乏透明度之间，一个很好的折衷方案是将 a`List<Test>`作为私有后端并仅公开将要使用的方法。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-20T06:51:53.733

在您的示例中，您说“类测试包含许多测试对象”，而不是“类测试是测试对象的集合”。IMO 在这种情况下没有必要对 List 进行子类化，除非您需要为此类提供类似 List 的接口。

但是，答案实际上取决于 Tests 类的上下文。如果它的行为类似于 List 并且将在需要 List 对象的上下文中使用，则从 List 继承。

请注意，继承比组合更难维护。

此外，我会将 Tests 重命名为 TestCollection（如果您将 List 子类化）或类似 TestUnit 的名称（如果它包含 Test 类的列表。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-20T06:53:23.340

“优先组合优于继承”始终是一个很好的经验法则。使用此类的方法是使用所有 List 方法以及您添加的方法还是仅使用您添加的方法？

# python - 排查py2exe打包问题

> ID：217666
> 
> 赞同：5
> 
> 时间：2008-10-20T06:46:22.060
> 
> 标签：python, user-interface, py2exe

我为 py2exe 编写了 setup.py 脚本，为我的 python GUI 应用程序生成了一个可执行文件，并且我在 dist 目录中有一大堆文件，包括应用程序、w9xopen.exe 和 MSVCR71.dll。当我尝试运行应用程序时，我收到一条错误消息，上面写着“查看日志文件了解详细信息”。唯一的问题是，日志文件是空的。

我见过的最接近的错误是“以下模块似乎丢失了”，但据我所知，我没有使用这些模块中的任何一个（特别是因为它们似乎是我没有使用的数据库），但正在挖掘在 Google 上表明这些是相对温和的警告。

我已经编写并打包了一个控制台应用程序以及一个带有 py2exe 的 wxpython 应用程序，并且这两个应用程序都已成功编译并运行。我正在使用一个名为 dabo 的新 python 工具包，它又使用 wxpython 模块，所以我不知道我做错了什么。我从哪里开始调查这个问题，因为显然日志文件并没有太大用处？

**编辑1：** python版本是2.5。py2exe 是 0.6.8。没有明显的构建错误。唯一的一点是“以下模块似乎丢失了......”这是非关键错误，因为列出的包是我绝对没有使用的包，也不应该停止应用程序的执行。运行可执行文件会生成一个完全为空的日志文件。以前它有一个关于语言环境的错误，我已经修复了这个错误，但由于可执行文件没有运行，显然出了点问题。setup.py 文件很大程度上基于运行他们的“应用程序向导”并查看 Ed Leafe 和其他一些人发布的示例生成的原始 setup.py。是的，我有一个日志文件，它没有打印任何东西供我使用，这就是为什么我要问是否有

我什至编写了一个简单的测试应用程序，它只生成一个简单的 GUI——一个带有一些默认菜单选项的空框架。自己编写的代码只有 3 行，其余的都在 3rd 方工具包中。同样，它编译成一个 exe（就像我的原始应用程序一样），但根本没有运行。运行时日志文件中也没有错误输出。

**编辑 2：** 事实证明，出于初始调试目的从“windows”切换到“console”是有见地的。我现在有了一个基本的运行测试应用程序，并开始编译真正的应用程序！

*测试应用：*

```
进口达博
应用程序 = dabo.dApp()
app.start()

```

*测试应用的 setup.py：*

```
导入操作系统
导入系统
导入全局
从 distutils.core 导入设置
导入py2exe
导入 dabo.icons
daboDir = os.path.split(dabo.__file__)[0]

# 找到dabo图标的位置：
iconDir = os.path.split(dabo.icons.__file__)[0]
图标子目录 = []
def getIconSubDir(arg, 目录名, fnames):
    如果 ".svn" 不在 dirname 和 dirname[-1] 中！= "\\":
        图标 = glob.glob(os.path.join(dirname, "*.png"))
        如果图标：
            subdir = (os.path.join("资源", dirname[len(arg)+1:]), 图标)
            iconSubDirs.append(子目录)
os.path.walk(iconDir, getIconSubDir, iconDir)

# 语言环境：
localeDir = "%s%slocale" % (daboDir, os.sep)
语言环境 = []
def getLocales(arg, 目录名, fnames):
  如果 ".svn" 不在 dirname 和 dirname[-1] 中！= "\\":
    mo_files = tuple(glob.glob(os.path.join(dirname, "*.mo")))
    如果 mo_files：
      subdir = os.path.join("dabo.locale", dirname[len(arg)+1:])
      locales.append((子目录，mo_files))
os.path.walk(localeDir, getLocales, localeDir)

data_files=[("资源", glob.glob(os.path.join(iconDir, "*.ico"))),
        ("资源", glob.glob("资源/*"))]
data_files.extend(iconSubDirs)
data_files.extend（语言环境）

设置（名称=“基本应用程序”，
        版本='0.01',
        description="测试大博应用",
        选项={“py2exe”：{
                “压缩”：1，“优化”：2，“bundle_files”：1，
                "排除": ["Tkconstants","Tkinter","tcl",
                “_imagingtk”，“PIL._imagingtk”，
                “ImageTk”、“PIL.ImageTk”、“FixTk”、“kinterbasdb”、
                “MySQLdb”，“数字”，“OpenGL.GL”，“OpenGL.GLUT”，
                'dbGadfly', 'email.Generator',
                'email.Iterators', 'email.Utils', 'kinterbasdb',
                'numarray', 'pymssql', 'pysqlite2', 'wx.BitmapFromImage'],
                “包括”：[“编码”，“语言环境”，“wx.gizmos”，“wx.lib.calendar”]}}，
        压缩文件=无，
        windows=[{'script':'basicApp.py'}],
        数据文件=数据文件
)

```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-20T12:33:37.567

您可能需要先修复日志处理，[此](http://www.py2exe.org/index.cgi/StderrLog)URL 可能会有所帮助。

[稍后您可能会在这里](http://www.py2exe.org/index.cgi/GeneralTipsAndTricks)寻找答案。

我的回答非常笼统，因为您没有提供任何更具体的信息（例如 py2exe/python 版本、py2exe 日志、其他使用的 3rd 方库）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-20T13:31:21.757

wxPyton 的类初始化器参见[http://www.wxpython.org/docs/api/wx.App-class.html 。](http://www.wxpython.org/docs/api/wx.App-class.html)`App`如果您想从控制台运行应用程序并将 stderr 打印到那里，请提供`False`参数`redirect`。否则，如果您只想弹出一个窗口，请设置`redirect`为`True`和。`filename``None`

# c# - 如何在 ASP.NET 页面中以编程方式生成 401 错误

> ID：217678
> 
> 赞同：36
> 
> 时间：2008-10-20T06:53:07.507
> 
> 标签：c#, asp.net, iis, asp.net-2.0

如您所见，这是来自非 Web 开发人员的问题。我想要一个 ASPX 页面，在某些情况下，它可以从代码中生成 401 错误。理想情况下，它将显示 IIS 标准页面。

* * *

## 回答 #1

> 赞同：59
> 
> 时间：2008-10-20T07:00:10.253

```
Response.StatusCode = 401;
Response.End(); 
```

* * *

## 回答 #2

> 赞同：58
> 
> 时间：2008-10-20T07:00:07.803

设置[Response.StatusCode](http://msdn.microsoft.com/en-us/library/system.web.httpresponse.statuscode.aspx)然后 - 如果您需要停止执行 - 调用[Response.End()](http://msdn.microsoft.com/en-us/library/system.web.httpresponse.end.aspx)。

* * *

## 回答 #3

> 赞同：44
> 
> 时间：2009-10-26T22:39:45.877

我想我还是更喜欢：

```
throw new HttpException(401, "Auth Failed") 
```

我认为该`Response.StatusCode`方法不会触发 web.config 文件中定义的自定义错误，例如

```
<customErrors mode="On" defaultRedirect="GenericErrorPage.htm">
     <error statusCode="401" redirect="AuthFailed.htm" />
     <error statusCode="403" redirect="NoAccess.htm" />
     <error statusCode="404" redirect="FileNotFound.htm" />
</customErrors> 
```

抛出一个新的异常肯定会触发自定义错误。

此外，您可能正在使用应用程序范围的错误记录工具，如[ELMAH](http://code.google.com/p/elmah/)或其他东西，我认为该`Response.StatusCode`方法也不会在那里记录。

**注意：**我现在看到问题说，理想情况下，应该显示标准 IIS 错误页面。*显然，不需要*自定义错误页面。在这种情况下，我会使用该`Response.StatusCode`方法。

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2008-10-20T06:58:46.307

[根据MSDN](http://msdn.microsoft.com/en-us/library/system.web.httpexception.httpexception.aspx)，您应该能够使用以下内容。

```
Throw New HttpException(401, "Auth Failed") 
```

**编辑**在看到其他响应设置状态代码后会更合适。

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2011-10-05T21:24:21.757

补充一条评论。

如果页面的一部分已经被写入输出缓冲区，那么清除任何缓冲内容很重要，否则页面可能无法正确显示。

这很可能在模板化环境中。例如母版页...

```
Response.ClearContent();
Response.StatusCode = 401;
Response.End(); 
```

# c# - Java的“同步”和C#的“锁”有什么区别吗？

> ID：217707
> 
> 赞同：14
> 
> 时间：2008-10-20T07:19:43.707
> 
> 标签：c#, java, synchronization

这两个关键字是否具有完全相同的效果，或者我应该注意什么？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-20T07:25:05.117

根据此站点：[http](http://en.csharp-online.net/CSharp_FAQ:_What_is_the_difference_between_CSharp_lock_and_Java_synchronized) ://en.csharp-online.net/CSharp_FAQ:_What_is_the_difference_between_CSharp_lock_and_Java_synchronized ，C#`lock`和 Java`synchronized`代码块“语义相同”，而对于方法，Java 使用`synchronized`而 C# 使用属性：`[MethodImpl(MethodImplOptions.Synchronized)]`.

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-20T07:32:24.103

Keeg 发布的链接中没有涵盖一个有趣的区别：据我所知，Java 中没有针对 .NET 的[Monitor.Enter](http://msdn.microsoft.com/en-us/library/system.threading.monitor.enter.aspx)和[Monitor.Exit的等效](http://msdn.microsoft.com/en-us/library/system.threading.monitor.exit.aspx)*方法*调用，C#语句归结为。这意味着您也不能执行与[Monitor.TryEnter](http://msdn.microsoft.com/en-us/library/system.threading.monitor.tryenter.aspx)等效的操作- 尽管 java.util.concurrent.locks 包（从 1.5 开始）当然有多种锁，这些锁具有更多可用功能。`lock`

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-10-20T08:08:57.290

我是java，您不必担心锁定您拥有的公共类型。

在 .NET 中，您[必须](http://www.bluebytesoftware.com/blog/PermaLink.aspx?guid=f9a1d4c8-553b-4cc1-b1d6-0a8c395d8e9c)

更新：这适用于您拥有的类型。锁定您不拥有的公共类型在任何语言中都是不好的:)

# php - 格式化 if 语句以提高可读性

> ID：217710
> 
> 赞同：5
> 
> 时间：2008-10-20T07:21:34.233
> 
> 标签：php, formatting, readability

为了便于阅读，最好的格式化方法是什么？

```
if (strpos($file, '.jpg',1) && file_exists("$thumbsdir/$file") == false || strpos($file, '.gif',1) && file_exists("$thumbsdir/$file") == false || strpos($file, '.png',1) && file_exists("$thumbsdir/$file") == false) {
  createThumb("$gallerydir/$file", "$thumbsdir/$file",$thumbsize);
  fwrite($log,date("Y-m-d")." @ ".date("H:i:s")."  CREATED: $thumbsdir/$file\n");
} 
```

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-10-20T07:26:57.563

我会将“是图像”逻辑提取到它自己的函数中，这使得`if`更具可读性并且还允许您集中逻辑。

```
function is_image($filename) {
    $image_extensions = array('png', 'gif', 'jpg');

    foreach ($image_extensions as $extension) 
        if (strrpos($filename, ".$extension") !== FALSE)
            return true;

    return false;
}

if (is_image($file) && !file_exists("$thumbsdir/$file")) {
    createThumb("$gallerydir/$file", "$thumbsdir/$file",$thumbsize);
    fwrite($log,date("Y-m-d")." @ ".date("H:i:s")."  CREATED: $thumbsdir/$file\n");
} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-20T07:24:29.393

```
if ((strpos($file, '.jpg',1) ||
     strpos($file, '.gif',1) ||
     strpos($file, '.png',1))
    && file_exists("$thumbsdir/$file") == false)
{
  createThumb("$gallerydir/$file", "$thumbsdir/$file",$thumbsize);
  fwrite($log,date("Y-m-d")." @ ".date("H:i:s")."  CREATED: $thumbsdir/$file\n");
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-20T07:28:29.353

每种文件类型的`file_exists`检查似乎都是恒定的，因此除非`file_exists`检查已通过，否则不要比较它们。

```
if (file_exists("$thumbsdir/$file") == false)
{
   if(strpos($file, '.jpg',1) ||
     strpos($file, '.gif',1) ||
     strpos($file, '.png',1)
   {
     createThumb("$gallerydir/$file", "$thumbsdir/$file",$thumbsize);
     fwrite($log,date("Y-m-d")." @ ".date("H:i:s")."  CREATED: $thumbsdir/$file\n");
   }
} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-20T07:28:42.910

```
function check_thumbnail($file)
{
    return (strpos($file, '.jpg',1) && file_exists("$thumbsdir/$file") == false ||
            strpos($file, '.gif',1) && file_exists("$thumbsdir/$file") == false ||
            strpos($file, '.png',1) && file_exists("$thumbsdir/$file") == false);
}

if (check_thumbnail ($file)) {
  createThumb("$gallerydir/$file", "$thumbsdir/$file",$thumbsize);
  fwrite($log,date("Y-m-d")." @ ".date("H:i:s")."  CREATED: $thumbsdir/$file\n");
} 
```

将逻辑提取到单独的函数后，可以减少重复：

```
function check_thumbnail($file)
{
    return (strpos($file, '.jpg',1) ||
            strpos($file, '.gif',1) ||
            strpos($file, '.png',1)) &&
           (file_exists("$thumbsdir/$file") == false);
} 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-20T07:31:51.017

我会分开 ifs，因为那里有一些重复的代码。我也尝试尽早退出例程：

```
if (!strpos($file, '.jpg',1) && !strpos($file, '.gif',1) && !strpos($file, '.png',1))
{
    return;
}

if(file_exists("$thumbsdir/$file"))
{
    return;
}

createThumb("$gallerydir/$file", "$thumbsdir/$file",$thumbsize);
fwrite($log,date("Y-m-d")." @ ".date("H:i:s")."  CREATED: $thumbsdir/$file\n"); 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-20T07:24:57.613

我会像这样分解它，抛开冗余问题：

```
if (strpos($file, '.jpg',1) && file_exists("$thumbsdir/$file") == false
 || strpos($file, '.gif',1) && file_exists("$thumbsdir/$file") == false
 || strpos($file, '.png',1) && file_exists("$thumbsdir/$file") == false) {
  createThumb("$gallerydir/$file", "$thumbsdir/$file",$thumbsize);
  fwrite($log,date("Y-m-d")." @ ".date("H:i:s")."  CREATED: $thumbsdir/$file\n");
} 
```

[@Fire Lancer 的](https://stackoverflow.com/questions/217710/fomating-an-if-statement-for-readability#217712)回答很好地解决了冗余问题。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-20T16:29:00.103

我发现以下内容使用 getimagesize() 更具可读性。我在脑海中写下这个，所以它可能需要一些调试。

垂直代码比水平代码更具可读性，恕我直言。

```
// Extract image info if possible
    // Note: Error suppression is for missing file or non-image
if (@$imageInfo = getimagesize("{$thumbsdir}/{$file}")) {

    // Accept the following image types
    $acceptTypes = array(
        IMAGETYPE_JPEG,
        IMAGETYPE_GIF,
        IMAGETYPE_PNG,
    );

    // Proceed if image format is acceptable
    if (in_array($imageInfo[2], $acceptTypes)) {

        //createThumb(...);
        //fwrite(...);

    }

} 
```

和平+快乐的黑客。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-25T08:59:45.207

还不如把我的两分钱投入。

```
if(!file_exists($thumbsdir . '/' . $file) && preg_match('/\.(?:jpe?g|png|gif)$/', $file)) {
    createThumb($gallerydir . '/' . $file, $thumbsdir . '/' . $file, $thumbsize);
    fwrite($log, date('Y-m-d @ H:i:s') . '  CREATED: ' . $thumbsdir . '/' . $file . "\n");
} 
```

# jquery - 使用带有奇怪标记的 jQuery 手风琴

> ID：217713
> 
> 赞同：0
> 
> 时间：2008-10-20T07:24:42.137
> 
> 标签：jquery, dom, accordion

我有这个 HTML 结构，想把它转换成手风琴。

```
<div class="accor">
    <div class="section">
        <h3>Sub section</h3>
        <p>Sub section text</p>
    </div>
    <div class="section">
        <h3>Sub section</h3>
        <p>Sub section text</p>
    </div>
    <div class="section">
        <h3>Sub section</h3>
        <p>Sub section text</p>
    </div>
</div> 
```

基本上使用`h3`s 作为手风琴标题，并将每个中的其余`div.section`内容作为每个手风琴面板的内容。（另请注意：标题可以是 h2 和 h6 之间的任何内容，具体取决于它们的嵌套）。

我认为如果 DOM 树被重组，那么这将是最简单的，因此`h3`s 在每个之外，`div`因为这就是手风琴默认的工作方式：

```
 <h3>Sub section</h3>
    <div class="section">
        <p>Sub section text</p>
    </div> 
```

唯一的问题是：如何移动标题？（我无权更改 HTML）。

```
var $sections = $("div.accor > .section"),
    $headings = $sections.find("> :header")
;
// I figured that inserting each heading to be before its parent might
// be the answer:
$headings.insertBefore($headings.find(":parent"));

// ... but that doesn't do anything 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-20T07:29:42.843

啊，我找到了解决方案。

使用`$.each()`

```
$headings.each(function(i, el) {
    var $this = $(el), $p = $this.parent();
    $this.insertBefore($p);
}); 
```

不过，还有比这更好的解决方案吗？也许只是使用香草手风琴选项？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-20T07:38:33.420

这个怎么样：

```
$('.accor .section').each(function() {
    $('h3', this).insertBefore($(this));
}); 
```

# java - 如何使用 spring 2.5.x 将单个属性值注入字符串？

> ID：217718
> 
> 赞同：6
> 
> 时间：2008-10-20T07:27:28.183
> 
> 标签：java, spring

我真的很想用引用属性文件中的单个属性来注释方法以进行注入。

```
@Resource("${my.service.url}")
private String myServiceUrl; 
```

当然，这种语法不起作用；）这就是我在这里问的原因。

我知道我可以注入完整的属性文件，但这似乎太过分了，我不想要属性文件 - 我想要配置的值。

编辑：我只能看到使用 XML 将属性连接到给定字段的 PropertyPlaceholderConfigurer 示例。我仍然无法弄清楚如何通过注释来实现这一点？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-08-18T11:27:17.033

我知道距离最初的帖子已经有一段时间了，但我设法偶然发现了一个针对 spring 2.5.x 的解决方案

您可以在 spring xml 配置中创建“String”bean 的实例，然后可以将其注入到带注释的组件中

```
@Component
public class SomeCompent{
  @Autowired(required=true 
  @Resource("someStringBeanId")
  private String aProperty;

  ...
}

<beans ....>
   <context:component-scan base-package="..."/>

  <bean class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer">
    ...
  </bean>
  <bean id="someStringId" class="java.lang.String" factory-method="valueOf">
    <constructor-arg value="${place-holder}"/>
  </bean>
</beans> 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2010-12-03T12:01:52.170

我创建了一个项目来解决 Spring 2.5.* 的这个问题：

[http://code.google.com/p/spring-property-annotations/](http://code.google.com/p/spring-property-annotations/)

对于 Spring 3，您可以使用 @Value("${propery.key}") 注释。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-20T14:33:23.113

[Spring 论坛](http://forum.springframework.org/showthread.php?t=50790)上有一个关于此的主题。简短的回答是，实际上没有办法使用注释注入单个属性。

我听说 Spring 3.0 将改进对使用注解的支持，所以很可能很快就会解决这个问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-20T09:27:18.770

如果您使用 XML 配置，您可以这样做。只需配置 PropertyPlaceholderConfigurer 并在配置中指定属性值

```
<bean class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer">
    <property name="locations">
        <value>classpath:com/foo/jdbc.properties</value>
    </property>
</bean>
<bean ...>
  <property name="myServiceUrl" value="${my.service.url}"/>
</bean> 
```

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2008-10-20T08:30:37.543

您可以尝试将属性“my.service.url”的值注入到您的 bean 中。

看看：[http ://static.springframework.org/spring/docs/2.5.x/reference/beans.html#beans-factory-placeholderconfigurer](http://static.springframework.org/spring/docs/2.5.x/reference/beans.html#beans-factory-placeholderconfigurer)

HTH。

# c - 如何使用 x86 裸机组件获取键盘输入？

> ID：217731
> 
> 赞同：4
> 
> 时间：2008-10-20T07:43:17.607
> 
> 标签：c, assembly, keyboard, x86, bare-metal

我正在尝试将内核的第一部分组合在一起。我目前将整个内核编译为 C 代码，并且我已经设法让它在控制台窗口中显示文本以及所有这些优点。现在，我想开始接受键盘输入，这样我就可以实际使用它并继续进行流程管理。

我正在使用 DJGPP 进行编译，并使用 GRUB 加载。我还使用了一小部分程序集，它基本上直接跳转到我编译的 C 代码中，我很高兴从那里。

我所做的所有研究似乎都指向 $0x16 的 ISR 以从键盘缓冲区中读取下一个字符。据我所知，这应该将 ASCII 值存储在 ah 中，并将键码存储在 al 中，或者类似的东西。我试图在内联汇编中使用以下例程对此进行编码：

```
char getc(void) 
{
    int output = 0;

    //CRAZY VOODOO CODE
    asm("xor %%ah, %%ah\n\t"
        "int $0x16"
        : "=a" (output)
        : "a" (output)
        : 

        );

    return (char)output;
} 
```

调用此代码时，核心立即崩溃。（我在 VirtualBox 上运行它，我觉得没有必要在真实硬件上尝试这种基本的东西。）

现在我实际上有几个问题。没有人能够告诉我（因为我的代码是从 GRUB 启动的）我目前是在实模式还是受保护模式下运行。我没有以一种或另一种方式进行跳跃，我计划在实模式下运行，直到我设置了一个进程处理程序。

那么，假设我在实模式下运行，我做错了什么，我该如何解决？我只需要一个基本的 getc 例程，最好是非阻塞的，但如果谷歌在这方面提供帮助，我会感到很糟糕。一旦我能做到这一点，我就可以从那里做剩下的事情。

我想我在这里要问的是，我在正确的轨道附近吗？通常如何在这个级别上获得键盘输入？

编辑：哦……所以我在保护模式下运行。这当然解释了尝试访问实模式功能时的崩溃。

那么我想我正在寻找如何从保护模式访问键盘 IO。我也许可以自己找到，但如果有人碰巧知道，请随意。再次感谢。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-20T08:10:07.723

您那里的代码正在尝试访问实模式 BIOS 服务。如果您在保护模式下运行，这可能考虑到您正在编写内核，那么中断将不起作用。您将需要执行以下操作之一：

*   将 CPU 切换到实模式，确保中断向量表正确，并使用您拥有的实模式代码或
*   编写您自己的保护模式键盘处理程序（即使用输入/输出指令）。

第一个解决方案将涉及运行时性能开销，而第二个解决方案将需要一些有关键盘 IO 的信息。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-20T10:48:23.473

如果您使用 gcc 进行编译，除非您使用 linux 内核使用的疯狂的“.code16gcc”技巧（我非常怀疑），否则您不能处于实模式。如果您使用的是 GRUB 多重引导规范，则 GRUB 本身会为您切换到保护模式。因此，正如其他人指出的那样，您将不得不直接与兼容 8042 的键盘/鼠标控制器交谈。除非它是 USB 键盘/鼠标并且 8042 仿真被禁用，否则您将需要一个 USB 堆栈（但您可以使用键盘/鼠标的“启动”协议，这更简单）。

没有人说编写操作系统内核很简单。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-20T08:07:47.557

我有一块似乎可以做的 GeekOS

```
In_Byte(KB_CMD); 
```

进而

```
In_Byte(KB_DATA); 
```

获取扫描码。我把它放了：[keyboard.c](http://gargoyle.ath.cx/~aes/keyboard/keyboard.c)和[keyboard.h](http://gargoyle.ath.cx/~aes/keyboard/keyboard.h)。`KB_CMD`分别`KB_DATA`为 0x64 和 0x60。我也许还可以指出，这是在 intr:1 的中断处理程序中完成的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-20T14:44:24.370

你做对了，但我似乎记得 djgpp 只生成保护模式输出，你不能从中调用中断。您可以像其他人建议的那样进入实模式，还是更愿意直接解决硬件问题？

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-30T08:46:53.613

出于解释的目的，假设您自己用汇编语言编写*所有内容*，包括引导加载程序和内核（*咳*我已经这样做了）。

在实模式下，您可以使用来自 BIOS 的中断例程。您也可以用自己的中断向量替换。但是，所有代码都是 16 位代码，与 32 位代码*二进制不兼容。*

当您跳过一些难关进入保护模式（包括重新编程中断控制器，以绕过 IBM 在 PC 中使用 Intel 保留中断的事实）时，您有机会设置 16 位和 32 位代码段。这可用于运行 16 位代码。所以你可以用它来访问getchar中断！

... 不完全的。要使此中断起作用，您实际上需要键盘缓冲区中的数据，该数据由不同的 ISR 放置在那里 - 当按键被按下时由键盘触发。有各种问题几乎阻止您在保护模式下将 BIOS ISR 用作实际的硬件 ISR。因此，BIOS 键盘例程是无用的。

另一方面，BIOS 视频通话很好，因为没有硬件触发的组件。您确实必须准备一个 16 位代码段，但如果可以控制，那么您可以通过使用 BIOS 中断来切换视频模式和类似的事情。

回到键盘：您需要（再次假设您正在编写所有代码）是编写键盘驱动程序。除非你是受虐狂（我是其中之一），否则不要去那里。

一个建议：尝试在实模式下编写多任务内核。（那是 16 位模式。）您可以使用所有 BIOS 中断！您没有获得内存保护，但您仍然可以通过挂钩计时器中断来获得先发制人的多任务处理。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-20T08:11:47.300

只是一个想法：查看[GRUB 的 DOS](https://gna.org/projects/grub4dos/)源代码（asm.s），该`console_checkkey`功能正在使用 BIOS `INT 16H Function 01`，而不是功能 00，就像您尝试做的那样。也许您想检查一个键是否正在等待输入。

[正如@skizz 建议](https://stackoverflow.com/questions/217731/x86-assembly-keyboard-input#217755)的`console_checkkey`那样，代码将 CPU 设置为实模式以使用 BIOS 。

您也可以尝试直接使用 GRUB 函数（如果仍以实模式映射）。

阅读汇编源代码的注意事项：在这个版本中

```
movb    $0x1, %ah 
```

表示将常量字节（0x1）移动到寄存器`%ah`

来自`console_checkkey`GRUB asm.s：

```
/*
 * int console_checkkey (void)
 *  if there is a character pending, return it; otherwise return -1
 * BIOS call "INT 16H Function 01H" to check whether a character is pending
 *  Call with   %ah = 0x1
 *  Return:
 *      If key waiting to be input:
 *          %ah = keyboard scan code
 *          %al = ASCII character
 *          Zero flag = clear
 *      else
 *          Zero flag = set
 */
 ENTRY(console_checkkey)
  push  %ebp
  xorl  %edx, %edx

  call  EXT_C(prot_to_real) /* enter real mode */

  .code16

  sti       /* checkkey needs interrupt on */

  movb  $0x1, %ah
  int   $0x16

  DATA32    jz  notpending

  movw  %ax, %dx
  //call    translate_keycode
  call  remap_ascii_char
  DATA32    jmp pending

notpending:
  movl  $0xFFFFFFFF, %edx

pending:
  DATA32    call    EXT_C(real_to_prot)
  .code32

  mov   %edx, %eax

  pop   %ebp
  ret 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2014-05-09T07:39:50.367

轮询键盘控制器的示例：

```
Start:
      cli
      mov al,2        ; dissable IRQ 1
      out 21h,al
      sti

;--------------------------------------
; Main-Routine
AGAIN:
      in al,64h       ; get the status
      test al,1       ; check output buffer
      jz short NOKEY
      test al,20h     ; check if it is a PS2Mouse-byte
      jnz short NOKEY
      in al,60h       ; get the key

; insert your code here (maybe for converting into ASCII...)

NOKEY:
      jmp AGAIN
;--------------------------------------
; At the end
      cli
      xor al,al       ; enable IRQ 1
      out 21h,al
      sti 
```

# java - 检查 LDAP 连接 (Java)

> ID：217733
> 
> 赞同：0
> 
> 时间：2008-10-20T07:44:33.517
> 
> 标签：java, ldap, naming

我正在使用 javax 命名来连接到 LDAP 数据库。有没有检查连接是否仍然有效的好方法？我在这里寻找真正有效的东西，因为它可能需要经常做。

经过一些网络搜索后，我发现的只是一个快速搜索的建议，还有更轻量级的方法吗？

/苹果电脑

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-20T13:24:49.477

您是否有理由不能假设它仍然有效？这似乎是最有效的。将 LDAP 通信封装在一个类中。您可以通过重新连接然后重新执行请求的操作来处理由于连接断开而导致的任何异常。

# keyboard - 识别键盘

> ID：217737
> 
> 赞同：1
> 
> 时间：2008-10-20T07:49:27.750
> 
> 标签：keyboard, hardware

我有两个键盘连接到我的 PC，有什么方法可以知道在任何语言或框架中按下了哪个键盘？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-20T08:14:38.947

[对于 Windows，您可以使用RegisterRawInputDevices](http://msdn.microsoft.com/en-us/library/ms645600(VS.85).aspx) API注册您的应用程序以接收[原始输入](http://msdn.microsoft.com/en-us/library/ms645536(VS.85).aspx)通知。注册后，您的应用程序将开始接收[WM_INPUT](http://msdn.microsoft.com/en-us/library/ms645590(VS.85).aspx)消息。该消息的 lParam 是一个指向[RAWINPUT](http://msdn.microsoft.com/en-us/library/ms645562(VS.85).aspx)结构的指针。您可以使用[GetRawInputData](http://msdn.microsoft.com/en-us/library/ms645596(VS.85).aspx) API 以[RAWINPUTHEADER](http://msdn.microsoft.com/en-us/library/ms645571(VS.85).aspx)结构的形式获取标头。然后，您可以使用标头中设备句柄上的[GetRawInputDeviceInfo](http://msdn.microsoft.com/en-us/library/ms645597(VS.85).aspx)来提取生成输入的设备的信息。

我不知道获取在 Windows 上生成键盘输入的设备的其他方法。

我也不知道如何在任何其他操作系统上解决这个问题。

# silverlight - 银光博客？

> ID：217740
> 
> 赞同：4
> 
> 时间：2008-10-20T07:53:55.200
> 
> 标签：silverlight

使用 asp.net MVC 框架，团队成员（Rob Conery、Phil Haack 等）的博客确实帮助了我，让我感到开发正朝着正确的方向发展。Silverlight 有类似的东西吗？

-Edit：我想提一下，我想自己找开发团队的成员。目前，跨操作系统和浏览器对 Silverlight 的支持太差了，无法让我关心和投入时间。但我想密切注意，这样我就可以开始关心框架何时发挥其潜力。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-20T08:00:53.127

Tim Heuer 的方法 ~ of ~ 失败：http: [//feeds.timheuer.com/timheuer-silverlight](http://feeds.timheuer.com/timheuer-silverlight)

Jesse Liberty - Silverlight 极客： http: [//feeds.feedburner.com/JesseLiberty-SilverlightGeek](http://feeds.feedburner.com/JesseLiberty-SilverlightGeek)

社区 Silverlight 内容： [http ://silverlight.net/blogs/community/rss.aspx](http://silverlight.net/blogs/community/rss.aspx)

Silverlight 每日小贴士 [http://silverlight.net/blogs/msnow/default.aspx](http://silverlight.net/blogs/msnow/default.aspx)

播客： [http ://www.sparklingclient.com/](http://www.sparklingclient.com/)

Wynapse（为 Silverlight 挖掘 Web，因此您不必这样做）： [http ://geekswithblogs.net/WynApseTechnicalMusings/Default.aspx](http://geekswithblogs.net/WynApseTechnicalMusings/Default.aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-20T08:01:48.100

Mike Taulty 在他的博客中定期发布了很多关于 Silverlight 的内容：（已经完成了很多 silverlight screecasts ）

[http://mtaulty.com/CommunityServer/blogs/mike_taultys_blog/rss.aspx](http://mtaulty.com/CommunityServer/blogs/mike_taultys_blog/rss.aspx)

与卡尔 Shifflett 相同：http: [//karlshifflett.wordpress.com](http://karlshifflett.wordpress.com)

马蒂亚斯夏皮罗： http: [//www.designerwpf.com](http://www.designerwpf.com)

迈克尔同步： http: [//michaelsync.net/](http://michaelsync.net/)

罗比·英格布雷森：[http ://nerdplusart.com/](http://nerdplusart.com/)

路德·博克：[http ://www.sitechno.com/Blog](http://www.sitechno.com/Blog)

至少这是我博客阅读器的摘录

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-20T09:28:27.893

> 感谢您的反馈。他们中的任何一个实际上是 Silverlight 开发团队的成员吗？

是的，Jesse Liberty 是 Microsoft Silverlight 开发部门的高级项目经理。

Tim Heuer 是 Microsoft Silverlight 的项目经理。

Mike Snow (Silverlight Tips of the Day) is a Senior SDET Lead on the Web Tools team at Microsoft.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-20T08:06:24.330

[.NET Framework 的产品经理Scott Guthrie在他的](http://weblogs.asp.net/Scottgu/)[博客](http://weblogs.asp.net/Scottgu/)中不时地撰写有关 Silverlight 的文章。他报告新版本及其附带的功能，有时他会发布一些非常好的教程来举例说明如何使用这些功能。

但当然，该博客的重点更多地在于整个 .NET Framework，而不仅仅是 Silverlight。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-23T14:32:21.197

[http://silverlight.net/blogs/msnow/archive/2008/05/05/silverlight-resources.aspx](http://silverlight.net/blogs/msnow/archive/2008/05/05/silverlight-resources.aspx)

# html - 继续调整文本大小以防止将其容器中的其他元素推到周围？

> ID：217741
> 
> 赞同：2
> 
> 时间：2008-10-20T07:57:29.310
> 
> 标签：html, css, layout

我有以下html

```
 <div id="menu">
            <ul class="horizMenu">
            <li id="active"><a href="#" id="current">About</a></li>
            <li><a href="#">Archive</a></li>
            <li><a href="#">Contact</a></li>
            <li><a href="#">Item four</a></li>
            <li><a href="#">Item five</a></li>
            </ul>
        </div> 
```

在我的CSS中

```
.horizMenu li
{
    display: inline;
    list-style-type: none;
    padding-right: 20px;
}
#menu
{

    text-align:center;
    margin-bottom:10px;
    letter-spacing:7px;
}
#menu a
{
    color:red;

}
#menu a:hover
{
    color:blue;
    font-weight:bold;
} 
```

一切都很好，除了当我将鼠标悬停在链接上时，颜色会发生变化并且变为粗体，这是我想要的，但它也会导致所有其他 li 元素轻微移动，然后在鼠标关闭时向后移动. 有没有一种简单的方法可以阻止这种情况发生？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-21T08:03:20.157

Not sure who -1ed, but Mauro's answer is essentially correct: you can't trivially make an item with automatic width depend on what the width would have been if the font inside weren't bold.

However, a 'float: left;' rule will also be necessary as you can't set the width of an inline-display element. And 'em' would probably be a better unit, to make the required width dependent on the font size in the buttons.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-20T08:02:01.733

为列表项元素添加一个宽度，该宽度大于项目的粗体宽度，这样它们就不会被推出。

```
#menu li
{
   width: 150px;
} 
```

或者，您可以尝试使用等宽字体，它不会受到悬停时粗体/非粗体的影响。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-11-18T19:06:33.967

try using this menutext { line-height: 10px; /* or whatever */ }

and also, to set the width of a inline element, use display: inline-block;

float:left might be not so friendly, if you do use it and it messes things up use clear:both

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-12-29T20:22:42.340

I've just had the same problem. A solution I thought of, and might use from now on, is to use text-shadow instead.

```
a:hover {
  color:blue;
  text-shadow:0px 0px 1px blue;
} 
```

The text will look a little blur though. If you set the 3rd parameter to 0, text won't be blur but will look just a little bit bolder.

I'd say this is better than dealing with width-dynamic texts.

# javascript - 重置链接上的访问状态

> ID：217749
> 
> 赞同：19
> 
> 时间：2008-10-20T08:06:27.920
> 
> 标签：javascript, css, client-side

有什么方法可以重置链接上的访问状态？

场景是这样的：在一个自然有很多链接的 Intranet 站点上，我们希望一个链接在一段时间内具有“已访问”状态。因此，我正在寻找一种方法来操纵链接的访问状态。

这是可行的吗？当然应该是跨浏览器的。

ETA：客户端解决方案是完全可以接受的。甚至更喜欢.. :-)

ETA-2：允许使用 Cookie。这里没有禁止:-)

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-20T08:33:40.830

当浏览器选择应用`:visited` [CSS 伪类](http://www.w3.org/TR/CSS2/selector.html#link-pseudo-classes)时，链接显示为“已访问” 。

将链接重置为未访问状态的客户端方法是（以某种方式）清除浏览历史记录。得知有一种便携式方法可以做到这一点，我会感到非常惊讶。它还具有令人不快的副作用，例如削弱对历史敏感的智能位置栏的行为，例如 Firefox 3 中的智能位置栏。

正如 Drew Noakes 所建议的，服务器端的方法是在链接中添加一些噪声查询参数，并定期更改查询参数。这只会给出您想要的行为的错误近似值。要获得“正确”的行为，您需要跟踪每个用户服务器端访问页面的历史记录，因此您只能在必要时间之后更改特定页面的噪声参数。

总而言之，实际上尝试“重置链接上的访问状态”可能是一个坏主意。

我认为更好的解决方案是调整页面样式，以便 :visited 伪类呈现与 :link 伪类相同。然后保留每个用户访问链接的服务器端历史记录，并使用显式`visited`类调整链接的显示。

如果您手边没有用户身份，并且不想要求登录，您可以随时使用随机持久 cookie。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-20T09:16:37.997

我觉得这个想法很臭。

重置链接访问状态的目的是什么？通知一些新数据可用？那么也许像“新”图像这样更冗长的东西会更合适？

另一方面，如果您确实需要这样做 - 更改 URL

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-10-20T18:41:42.113

所以你只是想让“访问过的”链接在一段时间内看起来不同？如果您绕过浏览器的`:visited`伪类并只分配自定义类名，这很容易。使用cookies；他们有内置的过期时间。

当您单击链接时设置一个 JavaScript 处理程序。伪代码：

```
function clickHandler(event) {
  var href = /* (figure out which anchor was clicked and get the href) */
  // (you might need to escape the href)

  setCookie(href, "visited", 5); // set cookie for 5 days
} 
```

它将在跟随链接之前运行此功能。

然后，在页面加载时，您可以执行以下操作：

```
function markVisitedLinks() {
  var anchors = document.getElementsByTagName("a");

  for (var i = 0; i < anchors.length; i++) {
    if (readCookie(anchors[i].href) == "visited") {
      anchors[i].className += " visited";
    }
  }
} 
```

从 QuirksMode中获取setCookie[和 readCookie 函数。](http://www.quirksmode.org/js/cookies.html)

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-20T08:33:10.377

如果使用“更改 url”的简单服务器端解决方案，例如：

24 小时后变成“http://url1?expire2008_10_21”的“ http [://url1?expire2008_10_20](http://url1?expire2008_10_21) [” ，](http://url1?expire2008_10_20)

不行，可以使用以下方法：

让服务器在浏览器上存储一个带有链接最后访问时间的 cookie。如果有很多链接并且最大 cookie 长度不够，您可以

1.  存储会话 cookie 并将访问过的数据保存在服务器上
2.  使用 cookie 的 flash 模拟 - 本地共享对象

如果上次访问时间已过，还要放置一个随机化客户端 url 的代码。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-20T08:10:39.987

我相信这是浏览器的属性，因此无法从服务器端控制。

一个“hack”可能是在链接末尾附加一个未使用的查询字符串，并定期轮换它们。尽管这意味着特定客户端的“已访问”状态的长度取决于查询字符串何时轮换，而不是固定的时间段。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-20T18:54:59.593

更改链接的工作方式通常会使您的用户感到困惑和/或不安。这是降低您网站的感知*可用性*的可靠方法。

你真正想要完成什么？

如果您的站点中的子页面发生了变化（指向新内容），您的用户*会发现这一点*。如果您的页面结构中有两到三个层次的闪亮新文章，如果重要的话，请在主页上添加一个带有链接*的新功能部分。*（或者在电子邮件中发送带有链接的通知，或者......）

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-20T19:04:54.127

仅仅格式化`:visited`链接的 CSS 属性就足够了，让它看起来好像从未被点击过？

我不知道您是否想暂时跟踪访问过的链接，或者只是一直显示它们；如果是后者，那么一个简单的 CSS（如下所示）就可以了。

 `````
a, a:visited {
     color: blue;
     text-decoration: underline
}

a:hover, a:active {
     color: orange;
} 
````  `* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-20T08:38:21.193

更改目标页面以接受来自查询字符串的参数，并将具有适当生命周期的 cookie 设置为该值。

在引用页面上，放置一些 Javascript 来检查 cookie 的存在。

如果它不存在，让 Javascript 在 URL 中添加一个带有大随机数的参数（这样浏览器的历史记录就无法识别它。）

如果确实存在，让 Javascript 添加一个与 cookie 具有相同值的参数（这样浏览器的历史记录就可以识别它。）

笔记：

*   我假设链接的目标与引用页面在同一个域上。如果没有，请使用同一域上的重定向页面。

*   这仅在浏览器的历史与您的 cookie 的生命周期一样长时才有效。如果浏览器历史记录很短或没有，则客户端不会将其显示为已访问。

*   请不要这样做！您的用户对“已访问”的含义有很好的理解。不要破坏它 - 你只会混淆他们。

*   您是否需要为不运行 Javascript 的人考虑服务器端解决方案？

*   我没有测试过这个设计。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-20T09:22:34.787

维护与用户会话的时间戳访问的 url 列表。

链接页面加载时

*   刷新过时的网址
*   列表中包含的样式链接作为已访问。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-10-20T09:47:00.010

作为纯粹的可视化问题，您无需担心以某种方式将访问过的链接标记回未访问过的链接。

为您的链接添加一个 onclick 处理程序，将链接样式更改为类似于已访问状态。从这个处理程序你可以例如。将链接状态写入 cookie。

然后您可以定期检查是否有不再可见的链接并将样式更改回正常。

# mvp - 在 MVP 中写验证的地方

> ID：217752
> 
> 赞同：34
> 
> 时间：2008-10-20T08:08:55.543
> 
> 标签：mvp

在 Model-View-Presenter 模式中，我们应该在哪里编写用户输入的验证。

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-10-20T08:42:14.320

特定领域的规则/验证应该在模型中。你可以有一个 model.validate() 来让你知道规则是否被违反。查看 Rails 模型 (ActiveRecord) 类以了解此概念的良好实现。

视图应该使用户难以键入无效输入。因此，在到达演示者之前，应消除“为数值输入字符串”类的输入错误。模型和视图之间可能存在一些重复验证。例如 AttributeX 必须在 1-100 之间。这必须在模型中进行验证。同时，您可能希望在 UI 中插入一个微调器，其 minValue 和 maxValue 范围设置为 1-100。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-20T08:43:49.420

我通常保持我的观点完全干净，没有逻辑。但我不做很多网络开发。在类似于 Ajax 的情况下，您可能希望在视图中进行客户端验证。

业务逻辑验证进入模型。对于业务逻辑验证，我的意思是检查最小订单大小等。

输入验证在演示者中进行。这可以是检查数字字段是否不包含非数字字符之类的事情。但根据您的情况，这也可能意味着检查文件是否存在等。

在更复杂的情况下，验证应该可以在不同的地方重用，我通常将它分成一个可以在不同地方调用的验证引擎。例如，这解决了在表示层和持久层中使用的重复验证代码的一些问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-20T08:35:56.470

主持人....

视图应该有“小部件”，在可能的情况下防止无效输入。

# nhibernate - nhibernate - 禁用一对多关系的子记录的自动\延迟加载

> ID：217761
> 
> 赞同：10
> 
> 时间：2008-10-20T08:13:40.790
> 
> 标签：nhibernate

我想知道是否有一种方法可以禁用 nHibernate 中子记录的自动加载（对于一个：多个关系）。

我们可以轻松地关闭属性的延迟加载，但我想要的是禁用任何类型的自动加载（延迟和非延迟）。我只想通过查询加载数据（即 HQL 或 Criteria ）

我仍然想在映射文件中定义父子记录之间的关系以方便 HQL 并能够加入父子实体，但我不希望子记录作为父记录的一部分加载，除非在父记录明确指出（通过急切获取等）。

示例：从数据库中获取部门记录不应从数据库中获取所有员工记录，因为它可能永远不需要。

此处的一种选择是将部门上的员工集合设置为延迟加载。这种方法的问题在于，一旦将对象提供给调用 API，它就可以“触摸”延迟加载属性，并且将从数据库中获取整个列表。

我尝试使用 'evict' - 断开对象，但它似乎并没有一直工作，也没有对对象进行深度驱逐。另外，它使用代理类抽象了延迟加载的属性类型，该代理类稍后会在我们试图通过反射对对象进行操作的代码中造成严重破坏，并且它会在对象上遇到未扩展的类型。

我是 nHibernate 的初学者，任何指示或帮助都会有很大帮助。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-23T13:24:55.683

根据您的要求，您不能简单地从部门映射到雇员，也不能在您的部门中拥有雇员属性。这意味着您*总是*必须进行数据库访问才能找到数据库的员工。

*如果这些代码示例不能开箱即用，我很抱歉，我目前不在编译器附近*

因此，您的部门班级可能如下所示：

```
 public class Department 
 { 
     public int Id { get; protected set; }
     public string Name { get; set; }
     /* Equality and GetHashCode here */
 } 
```

你的员工看起来像：

```
 public class Employee
 { 
     public int Id { get; protected set; }
     public Name Name { get; set; }
     public Department Department { get; set; }
     /* Equality and GetHashCode here */
 } 
```

任何时候您想为某个部门寻找员工，您都必须致电：

```
/*...*/
session.CreateCriteria(typeof(Employee))
    .Add(Restrictions.Eq("Department", department)
    .List<Employee>(); 
```

仅仅因为您的规范说“部门有很多员工”，并不意味着您必须将其映射为双向关联。如果您可以保持关联的单向，那么您真的可以让您的数据访问也飞起来。

谷歌[“领域驱动设计”聚合](http://www.google.com/search?q=%22Domain+Driven+Design%22+aggregate)，或查看 Eric Evan 的领域驱动设计书的第 125 页了解更多信息

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2008-10-20T08:52:50.430

您可以在集合上具有惰性属性。在您的示例中，部门有 n 名员工，如果启用了惰性，则在您加载部门时默认不会加载员工：[http ://www.nhforge.org/doc/nh/en/#collections-lazy](http://www.nhforge.org/doc/nh/en/#collections-lazy "懒惰的文档")

您可以有将部门和员工明确加载在一起的查询。这是“获取”选项：[http ://www.nhforge.org/doc/nh/en/#performance-fetching-lazy](http://www.nhforge.org/doc/nh/en/#performance-fetching-lazy "获取选项")

# sql - 带有聚合组件的 sql union

> ID：217765
> 
> 赞同：0
> 
> 时间：2008-10-20T08:17:18.100
> 
> 标签：sql, sql-server, reporting-services

我有一个查询，用于在报告服务中绘制图表，如下所示：

```
（从 tbl 中选择 Alpha、Beta、Gamma、Delta、Epsilon、Zeta、Eta、Theta、Iota、Kappa、Lambda、Mu、Nu、Xi
在哪里    
(@Alphas) 中的 Alpha 和
(@Betas) 中的 Beta 和
(@Gammas) 中的 Gamma 和
Delta in (@Deltas) 和
(@Epsilons) 中的 Epsilon 和
Zeta in (@Zetas) 和
Eta 在 (@Etas) 和
Theta in (@Thetas) )
联盟
（从 tbl 中选择 Alpha、Beta、Gamma、Delta、Epsilon、Zeta、Eta、Theta、Iota、Kappa、Lambda、Mu、Nu、Omicron
在哪里    
(@Alphas) 中的 Alpha 和
(@Betas) 中的 Beta 和
(@Gammas) 中的 Gamma 和
Delta in (@Deltas) 和
(@Epsilons) 中的 Epsilon 和
Zeta in (@Zetas) 和
Eta 在 (@Etas) 和
Theta in (@Thetas))

```

Alpha 到 Theta 将用于将它们（例如 Alpha、Beta、Gamma）连接成一个字段中的字符串的几个计算字段中。Omicron 的选择语句将生成与 Xi 相同的行数，但我真正想要的是聚合 Omicron，因此如果使用 Xi 的 Select 查询产生 9 个图例项，Omicron 的聚合选择应该只产生一个图例项，因为值Alpha 到 Theta 对 Omicron 来说并不重要。应该如何构造查询，以便我可以使用 Alpha 到 Theta 作为参数但仍然聚合 Omicron？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-20T08:26:02.577

我不确定您真正想要什么，但如果我理解正确，您可以尝试以下操作：

```
(SELECT a,b,c,d FROM k
WHERE a in (@a) and b in (@b) and c in (@c))
UNION
(SELECT NULL,NULL,NULL,sum(e) FROM k
WHERE a in (@a) and b in (@b) and c in (@c) GROUP BY e) 
```

NULL 只是为了能够执行联合（保持列的数量，您可能必须进行列别名）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-20T09:10:28.837

为什么不在一个 select 语句中选择所有的希腊语、Xi 和 Omicron 并以宿主语言计算总和？这是一个可能成本高昂的查询，而不是两个。

# perl - 如何提取文本，保存，然后输出到网络？

> ID：217769
> 
> 赞同：1
> 
> 时间：2008-10-20T08:20:40.917
> 
> 标签：perl, search, cgi, extract

例如，我在“MyFile.txt”中[搜索](https://stackoverflow.com/questions/211260/perl-extract-text-then-save<br)HF50(HF$HF)，以便提取的数据必须保存到“save.txt”。现在再次提取“save.txt”上的数据并在我的表格中填充参数和输出。但是当我尝试代码时，我没有输出并且“save.txt”是空白的。？

无论我输入什么，Var $HF 都无法识别。请帮忙。

```
#! /usr/bin/perl

print "Content-type:text/html\r\n\r\n";

use CGI qw(:standard);
use strict;
use warnings;

my ($file,$line,$tester,$HF,$keyword);
my ($f1,$f2,$f3,$f4,$f5,$f6,$f7,$f8,$f9,$f10,$f11,$f12,$f13,$f14,$f15,$f16,$f17,$f18,$f19);

my $keyWord=param('keyword');
$HF=$keyWord;

my $infile='MyFile.txt';
my $outfile='save.txt';

open (my $inhandle, '<',$infile) or die "Can't open $infile:$!";
open (my $outhandle, '>', $outfile) or die "Can't open $outfile:$!";

while (my $line=<$inhandle>){
if ($line=~ m/HF$HF/i) {
print {$outhandle}$line;
print $line;

print "<HTML>";
print "<head>";
print "<body bgcolor='#4682B4'>";
print "<title>FUSION SHIFT REPORT</title>";
print "<div align='left'>";
print "<FORM METHOD='get'        ACTION='http://Shielex.com/pe/mrigos/mainhead.html'>";
print "<b>SEACRH:</b>";
print "<INPUT TYPE='text' NAME='rec' SIZE='12' MAXLENGHT='40'>";
print "<INPUT TYPE='submit' value='go'>";
print "</form>";
print "<TABLE CELLPADDING='1' CELLSPACING='1' BORDER='1' bordercolor=black  width='100%'>";
print "<TR>";

print "<td width='11%'bgcolor='#00ff00'><font size='2'>TESTER No.</td>";
print "<td width='10%'bgcolor='#00ff00'><font size='2'>DATE</td>";

print "<td width='11%'bgcolor='#00ff00'><font size='2'>DEVICE NAME</td>";
print "<td bgcolor='#00ff00'><font size='2'>TEST PROGRAM</td>";

print "<td width='10%'bgcolor='#00ff00'><font size='2'>SMSLOT</td>";

print "<td width='12%'bgcolor='#00ff00'><font size='2'>LOADBOARD</td>";

print "<td width='10%'bgcolor='#00ff00'><font size='2'>CATEGORY</td>";
print "<td width='13%'bgcolor='#00ff00'><font size='2'>ROOT CAUSE 1</td>";
print "<td width='13%'bgcolor='#00ff00'><font size='2'>ROOT CAUSE 2</td>";
print "</tr>";
print "<TR>";

$file='save.txt';
open(F,$file)||die("Could not open $file");
while ($line=<F>)
{
my @cells=($f1,$f2,$f3,$f4,$f5,$f6,$f7,$f8,$f9,$f10,$f11,$f12,$f13,$f14,$f15,$f16,$f17,$f18,$f19)=   split ',',$line;

print "<TD bgcolor='#ADD8E6'><font size='2'>$f2</TD>";
print "<TD bgcolor='#ADD8E6'><font size='2'>$f3</TD>";

print "<TD bgcolor='#ADD8E6'><font size='2'>$f5</TD>";
print "<TD bgcolor='#ADD8E6'><font size='2'>$f6</TD>";

print "<TD bgcolor='#ADD8E6'><font size='2'>$f8</TD>";

print "<TD bgcolor='#ADD8E6'><font size='2'>$f10</TD>";
print "<TD bgcolor='#ADD8E6'><font size='2'>$f17</TD>";
print "<TD bgcolor='#ADD8E6'><font size='2'>$f18</TD>";
print "<TD bgcolor='#ADD8E6'><font size='2'>$f19</TD>";
print "</tr>";

}
}
}
close F;
print "</TABLE>";
print "</body>";
print "<html>"; 
```

= **MyFile.txt 数据**=
1,HF50,13-OCT-08,04:17:53,761503BZZGR-62,B2761503BP22.EVA,DWP,DWP,校准
2,HF60,13-OCT-08,04:17:53 ,761503BZZGR-62,B2761503BP22.EVA,DWP,DWP,校准
1,HF50,13-OCT-08,04:17:53,761503BZZGR-62,B2761503BP22.EVA,DWP,DWP,校准

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-20T14:44:49.817

您是否将其作为 CGI 脚本运行？在这种情况下，您可能无权打开文件进行写入。您是否检查了错误日志以查看您的消息`die`是否在那里？

您可能需要查看[疑难解答 Perl CGI 脚本](http://brian-d-foy.cvs.sourceforge.net/*checkout*/brian-d-foy/CGI_MetaFAQ/troubleshooting_CGI.html)。完成所有步骤，不要跳过任何步骤。当您遇到困难时，您可以获得帮助我们帮助您所需的大部分信息。

祝你好运， ：）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-20T09:23:46.437

你永远不会关闭`$outfile`，所以它不会被冲洗。但也许您想将数据存储在数组中？

顺便说一句，在使用 CGI 程序时，您应该始终使用三参数形式，`open()`并且还应该始终使用绝对路径，因为在许多情况下，“当前目录”并不是您认为的那样。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-10-20T16:44:19.653

首先，Perl 的输出本质上是缓冲的。因此，除非您使用某种显式方法，否则无法保证物理文件将有任何可读取的内容。正如有人提到的，您必须以某种方式刷新输出。我的评论在代码下方。（您也可以通过关闭输出文件并在读取后以*附加模式打开它来执行此操作。）*

其次，你似乎不想做你想做的事。如果所有内容都完美地刷新到文件中，则您正在为*每个输入行*请求一个 html 标头。因此，当我在输入中添加行时，它会打印出许多搜索框。我不希望那是你想要的。

这是一个更*完善的*代码：

```
use CGI qw(:standard);
use IO::File;
use strict;
use warnings;

my ($file,$line,$HF); #,$tester,$HF,$keyword);
# don't pollute -> my ($f1,$f2,$f3,$f4,$f5,$f6,$f7,$f8,$f9,$f10
# ,$f11,$f12,$f13,$f14,$f15,$f16,$f17,$f18,$f19);

# my $keyWord=param('keyword'); <-- if you're not going to do anything with $keyWord
$HF=param('keyword'); # <- assign it to the variable you're going to use

my $infile='MyFile.txt';
my $outfile='save.txt';

open (my $inhandle, '<',$infile) or die "Can't open $infile:$!";
open (my $outhandle, '>', $outfile) or die "Can't open $outfile:$!";
# this would flush -> my $outhandle = IO::File->new( ">$outfile" );

print q{Content-type:text/html

<HTML>
<head>
<title>FUSION SHIFT REPORT</title>
<style type="text/css">
.header { background-color : #0f0; font-size : 12pt }
.detail { background-color : #ADD8E6; font-size : 12pt }
</style>
</head>
<body bgcolor='#4682B4'>
<div align='left'>
<FORM METHOD='get' ACTION='http://Shielex.com/pe/mrigos/mainhead.html'>
<b>SEACRH:</b>
<input type='text' name='rec' size='12' maxlenght='40'>
<input type='submit' value='go'>
</form>
<table cellpadding='1' cellspacing='1' border='1' bordercolor=black  width='100%'>
<tr>
  <td class="header" width='11%'>TESTER No.</td>
  <td class="header" width='10%'>DATE</td>
  <td class="header" width='11%'>DEVICE NAME</td>
  <td class="header" >TEST PROGRAM</td>
  <td class="header" width='10%'>SMSLOT</td>
  <td class="header" width='12%'>LOADBOARD</td>
  <td class="header" width='10%'>CATEGORY</td>
  <td class="header" width='13%'>ROOT CAUSE 1</td>
  <td class="header" width='13%'>ROOT CAUSE 2</td>
</tr>
}; 

my $hf_str = ",HF$HF,";
# OO -> $outhandle->autoflush(); <- set autoflush
while (my $line=<$inhandle>){
    next unless index( $line, $hf_str ) > -1;
    # OO -> $outhandle->print( $line );
    #       $outhandle->flush(); <- if autoflush not set, do it manually
    print *{$outhandle} $line;
    print "<tr>"
        , ( map { qq{<td class="detail">$_</td>} } 
            split ',', $line
           )
        , "</tr>\n"
        ;
}
print q{
</table>
</body>
</html>
}; 
```

# java - GWT + 弹簧

> ID：217775
> 
> 赞同：2
> 
> 时间：2008-10-20T08:27:04.803
> 
> 标签：java, spring, gwt

我可以从 GWT 应用程序（客户端）访问使用 http 调用程序（服务器）公开的 spring bean 吗？如果是这样，是否有任何示例/教程？

——约纳坦

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-20T15:44:59.303

[这里](http://bram.jteam.nl/index.php/2007/06/20/springone-2007-slides-sample-code/)有一个适用于 Spring-GWT 应用程序的应用程序模板，您可能会发现它很有用。我还没有尝试过，但我相信它是作为 Maven 原型实现的。

有关此模板为您做什么以及如何将 GWT 与 Spring 集成的更多背景信息，请查看以下（视频）[演示文稿](http://www.parleys.com/d/142)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-05-26T20:28:41.607

你可以试试我的 GWT 和 Spring 集成方式：[https](https://code.google.com/p/gspring) ://code.google.com/p/gspring 。

它简单明了。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-04-24T17:48:47.373

我对 Spring4GWT 有很好的经验。在大约 30 分钟内完成了整个集成。（包括 ORM）。我使用了这个链接[http://www.javacodegeeks.com/2010/05/gwt-2-spring-3-jpa-2-hibernate-35.html](http://www.javacodegeeks.com/2010/05/gwt-2-spring-3-jpa-2-hibernate-35.html)

也设法将 UI Binder 集成到堆栈中。将很快将代码推送到谷歌代码。（会回来更新这里的链接）。但是，如果您在此之前需要它，请记下。

# html - 如何将 CSS 应用于 iframe？

> ID：217776
> 
> 赞同：1131
> 
> 时间：2008-10-20T08:27:14.430
> 
> 标签：html, css, iframe, rss

我有一个简单的页面，其中包含一些 iframe 部分（用于显示 RSS 链接）。如何将相同的 CSS 格式从主页应用到 iframe 中显示的页面？

* * *

## 回答 #1

> 赞同：479
> 
> 时间：2008-10-20T09:07:48.327

**编辑：除非设置了适当的**[CORS 标头](https://developer.mozilla.org/en-US/docs/Web/HTTP/Access_control_CORS)，否则这不适用于跨域。

这里有两个不同的东西：iframe 块的样式和嵌入在 iframe 中的页面的样式。您可以按照通常的方式设置 iframe 块的样式：

```
<iframe name="iframe1" id="iframe1" src="empty.htm" 
        frameborder="0" border="0" cellspacing="0"
        style="border-style: none;width: 100%; height: 120px;"></iframe> 
```

嵌入在 iframe 中的页面样式必须通过将其包含在子页面中来设置：

```
<link type="text/css" rel="Stylesheet" href="Style/simple.css" /> 
```

或者可以使用 Javascript 从父页面加载：

```
var cssLink = document.createElement("link");
cssLink.href = "style.css"; 
cssLink.rel = "stylesheet"; 
cssLink.type = "text/css"; 
frames['iframe1'].document.head.appendChild(cssLink); 
```

* * *

## 回答 #2

> 赞同：218
> 
> 时间：2012-09-20T22:21:17.443

**我用Google Calendar**遇到了这个问题。我想在较暗的背景上设置样式并更改字体。

幸运的是，嵌入代码中的 URL 对直接访问没有限制，因此通过使用 PHP 函数`file_get_contents`可以从页面中获取整个内容。可以调用位于您服务器上的 php 文件，而不是调用 Google URL，例如。`google.php`，它将包含经过修改的原始内容：

```
$content = file_get_contents('https://www.google.com/calendar/embed?src=%23contacts%40group.v.calendar.google.com&ctz=America/Montreal'); 
```

将路径添加到样式表：

```
$content = str_replace('</head>','<link rel="stylesheet" href="http://www.yourwebsiteurl.com/google.css" /></head>', $content); 
```

（这会将您的样式表放在`head`结束标记之前。）

如果 css 和 js 被相对调用，请指定原始 url 的基本 url：

```
$content = str_replace('</title>','</title><base href="https://www.google.com/calendar/" />', $content); 
```

最终`google.php`文件应如下所示：

```
<?php
$content = file_get_contents('https://www.google.com/calendar/embed?src=%23contacts%40group.v.calendar.google.com&ctz=America/Montreal');
$content = str_replace('</title>','</title><base href="https://www.google.com/calendar/" />', $content);
$content = str_replace('</head>','<link rel="stylesheet" href="http://www.yourwebsiteurl.com/google.css" /></head>', $content);
echo $content; 
```

然后将`iframe`嵌入代码更改为：

```
<iframe src="http://www.yourwebsiteurl.com/google.php" style="border: 0" width="800" height="600" frameborder="0" scrolling="no"></iframe> 
```

祝你好运！

* * *

## 回答 #3

> 赞同：82
> 
> 时间：2008-10-20T08:58:47.487

如果 iframe 的内容未完全在您的控制之下，或者您想从不同页面访问具有不同样式的内容，您可以尝试使用 JavaScript 对其进行操作。

```
var frm = frames['frame'].document;
var otherhead = frm.getElementsByTagName("head")[0];
var link = frm.createElement("link");
link.setAttribute("rel", "stylesheet");
link.setAttribute("type", "text/css");
link.setAttribute("href", "style.css");
otherhead.appendChild(link); 
```

请注意，根据您使用的浏览器，这可能仅适用于从同一域提供的页面。

* * *

## 回答 #4

> 赞同：63
> 
> 时间：2012-11-21T16:17:35.670

```
var $head = $("#eFormIFrame").contents().find("head");

$head.append($("<link/>", {
    rel: "stylesheet",
    href: url,
    type: "text/css"
})); 
```

* * *

## 回答 #5

> 赞同：36
> 
> 时间：2013-10-15T22:47:12.780

这是直接应用 CSS 代码而不使用`<link>`加载额外样式表的方法。

```
var head = jQuery("#iframe").contents().find("head");
var css = '<style type="text/css">' +
          '#banner{display:none}; ' +
          '</style>';
jQuery(head).append(css); 
```

这会隐藏 iframe 页面中的横幅。谢谢你的建议！

* * *

## 回答 #6

> 赞同：27
> 
> 时间：2008-10-20T08:37:01.697

大多数浏览器都像处理不同的 HTML 页面一样普遍处理 iframe。如果您想将相同的样式表应用于 iframe 的内容，只需从其中使用的页面中引用它。

* * *

## 回答 #7

> 赞同：27
> 
> 时间：2008-10-20T08:52:14.440

如果您在 iframe 中控制页面，如 hangy 所说，最简单的方法是创建一个具有通用样式的共享 CSS 文件，然后从您的 html 页面链接到它。

否则，您不太可能能够从 iframe 中的外部页面动态更改页面样式。这是因为浏览器已经加强了跨框架 dom 脚本的安全性，因为可能被滥用于欺骗和其他黑客行为。

[本教程](http://www.dyn-web.com/tutorials/iframes/)可能会为您提供有关编写 iframe 脚本的更多信息。 [关于跨框架脚本](http://msdn.microsoft.com/en-us/library/ms533028(VS.85).aspx)从 IE 的角度解释了安全限制。

* * *

## 回答 #8

> 赞同：20
> 
> 时间：2009-07-28T22:53:01.340

上面有一点改变的作品：

```
var cssLink = document.createElement("link") 
cssLink.href = "pFstylesEditor.css"; 
cssLink.rel = "stylesheet"; 
cssLink.type = "text/css"; 

//Instead of this
//frames['frame1'].document.body.appendChild(cssLink);
//Do this

var doc=document.getElementById("edit").contentWindow.document;

//If you are doing any dynamic writing do that first
doc.open();
doc.write(myData);
doc.close();

//Then append child
doc.body.appendChild(cssLink); 
```

至少适用于 ff3 和 ie8

* * *

## 回答 #9

> 赞同：15
> 
> 时间：2011-05-23T16:22:09.950

以下对我有用。

```
var iframe = top.frames[name].document;
var css = '' +
          '<style type="text/css">' +
          'body{margin:0;padding:0;background:transparent}' +
          '</style>';
iframe.open();
iframe.write(css);
iframe.close(); 
```

* * *

## 回答 #10

> 赞同：13
> 
> 时间：2010-03-02T07:16:41.303

如果您想从主页重用 CSS 和 JavaScript，也许您应该考虑替换`<IFRAME>`为 Ajax 加载的内容。当搜索机器人能够执行 JavaScript 时，这对 SEO 更加友好。

这是一个[jQuery](http://jquery.com)示例，它将另一个 html 页面包含到您的文档中。这比 SEO 友好得多`iframe`。为了确保机器人没有索引包含的页面，只需添加它以禁止`robots.txt`

```
<html>
  <header>
    <script src="/js/jquery.js" type="text/javascript"></script>
  </header>
  <body>
    <div id='include-from-outside'></div>
    <script type='text/javascript'>
      $('#include-from-outside').load('http://example.com/included.html');
    </script> 
  </body>
</html> 
```

您还可以直接从 Google 包含 jQuery：[http](http://code.google.com/apis/ajaxlibs/documentation/) ://code.google.com/apis/ajaxlibs/documentation/ - 这意味着可选的自动包含较新版本和一些显着的速度提升。此外，这意味着您必须相信他们只为您提供 jQuery ;)

* * *

## 回答 #11

> 赞同：13
> 
> 时间：2013-06-24T11:14:10.567

扩展上述 jQuery 解决方案以应对加载框架内容的任何延迟。

```
$('iframe').each(function(){
    function injectCSS(){
        $iframe.contents().find('head').append(
            $('<link/>', { rel: 'stylesheet', href: 'iframe.css', type: 'text/css' })
        );
    }

    var $iframe = $(this);
    $iframe.on('load', injectCSS);
    injectCSS();
}); 
```

* * *

## 回答 #12

> 赞同：12
> 
> 时间：2017-09-01T10:15:49.467

使用可以试试这个：

```
$('iframe').load( function() {
     $('iframe').contents().find("head")
     .append($("<style type='text/css'>  .my-class{display:none;}  </style>"));
  }); 
```

* * *

## 回答 #13

> 赞同：11
> 
> 时间：2013-03-21T09:07:13.617

我的**紧凑版**：

```
<script type="text/javascript">
$(window).load(function () {
    var frame = $('iframe').get(0);
    if (frame != null) {
        var frmHead = $(frame).contents().find('head');
        if (frmHead != null) {
            frmHead.append($('style, link[rel=stylesheet]').clone()); // clone existing css link
            //frmHead.append($("<link/>", { rel: "stylesheet", href: "/styles/style.css", type: "text/css" })); // or create css link yourself
        }
    }   
});
</script> 
```

但是，有时在`iframe`加载窗口时还没有准备好，因此需要使用**计时器**。

**即用型代码**（带计时器）：

```
<script type="text/javascript">
var frameListener;
$(window).load(function () {
    frameListener = setInterval("frameLoaded()", 50);
});
function frameLoaded() {
    var frame = $('iframe').get(0);
    if (frame != null) {
        var frmHead = $(frame).contents().find('head');
        if (frmHead != null) {
            clearInterval(frameListener); // stop the listener
            frmHead.append($('style, link[rel=stylesheet]').clone()); // clone existing css link
            //frmHead.append($("<link/>", { rel: "stylesheet", href: "/styles/style.css", type: "text/css" })); // or create css link yourself
        }
    }
}
</script> 
```

...和 ​​jQuery 链接：

```
<script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.9.1.min.js" type="text/javascript"></script> 
```

* * *

## 回答 #14

> 赞同：10
> 
> 时间：2019-11-06T03:53:13.997

由于为相同的域编写了许多答案，因此我将编写如何在跨域中执行此操作。

首先，您需要了解[Post Message API](https://developer.mozilla.org/en-US/docs/Web/API/Window/postMessage)。我们需要一个信使在两个窗口之间进行通信。

这是我创建的信使。

```
/**
 * Creates a messenger between two windows
 *  which have two different domains
 */
class CrossMessenger {

    /**
     * 
     * @param {object} otherWindow - window object of the other
     * @param {string} targetDomain - domain of the other window
     * @param {object} eventHandlers - all the event names and handlers
     */
    constructor(otherWindow, targetDomain, eventHandlers = {}) {
        this.otherWindow = otherWindow;
        this.targetDomain = targetDomain;
        this.eventHandlers = eventHandlers;

        window.addEventListener("message", (e) => this.receive.call(this, e));
    }

    post(event, data) {

        try {
            // data obj should have event name
            var json = JSON.stringify({
                event,
                data
            });
            this.otherWindow.postMessage(json, this.targetDomain);

        } catch (e) {}
    }

    receive(e) {
        var json;
        try {
            json = JSON.parse(e.data ? e.data : "{}");
        } catch (e) {
            return;
        }
        var eventName = json.event,
            data = json.data;

        if (e.origin !== this.targetDomain)
            return;

        if (typeof this.eventHandlers[eventName] === "function") 
            this.eventHandlers[eventName](data);
    }

} 
```

在两个窗口中使用它进行通信可以解决您的问题。

在主窗口中，

```
var msger = new CrossMessenger(iframe.contentWindow, "https://iframe.s.domain");

var cssContent = Array.prototype.map.call(yourCSSElement.sheet.cssRules, css_text).join('\n');
msger.post("cssContent", {
   css: cssContent
}) 
```

然后，从 iframe 接收事件。

在 iframe 中：

```
var msger = new CrossMessenger(window.parent, "https://parent.window.domain", {
    cssContent: (data) => {
        var cssElem = document.createElement("style");
        cssElem.innerHTML = data.css;
        document.head.appendChild(cssElem);
    }
}) 
```

有关详细信息，请参阅完整的 [Javascript 和 iframe](https://groups.hyvor.com/WebDevelopment/171/javascript-and-iframes)教程。

* * *

## 回答 #15

> 赞同：8
> 
> 时间：2016-07-07T00:59:53.687

这里的其他答案似乎使用 jQuery 和 CSS 链接。

此代码使用 vanilla JavaScript。它创建了一个新`<style>`元素。它将该元素的文本内容设置为包含新 CSS 的字符串。并将该元素直接附加到 iframe 文档的头部。

```
var iframe = document.getElementById('the-iframe');
var style = document.createElement('style');
style.textContent =
  '.some-class-name {' +
  '  some-style-name: some-value;' +
  '}' 
;
iframe.contentDocument.head.appendChild(style); 
```

* * *

## 回答 #16

> 赞同：7
> 
> 时间：2010-11-08T06:25:23.147

When you say "doc.open()" it means you can write whatever HTML tag inside the iframe, so you should write all the basic tags for the HTML page and if you want to have a CSS link in your iframe head just write an iframe with CSS link in it. I give you an example:

```
doc.open();

doc.write('<!DOCTYPE html><html><head><meta charset="utf-8"/><meta http-quiv="Content-Type" content="text/html; charset=utf-8"/><title>Print Frame</title><link rel="stylesheet" type="text/css" href="/css/print.css"/></head><body><table id="' + gridId + 'Printable' + '" class="print" >' + out + '</table></body></html>');

doc.close(); 
```

* * *

## 回答 #17

> 赞同：6
> 
> 时间：2009-03-31T21:36:42.360

您将无法以这种方式设置 iframe 内容的样式。我的建议是使用服务器端脚本（PHP、ASP 或 Perl 脚本）或查找将提要转换为 JavaScript 代码的在线服务。唯一的另一种方法是您可以执行服务器端包含。

* * *

## 回答 #18

> 赞同：4
> 
> 时间：2016-05-19T20:20:18.843

如果您可以访问 iframe 页面并希望仅在您通过页面上的 iframe 加载它时应用不同的 CSS，我在这里找到了针对此类事情的解决方案

即使 iframe 正在加载不同的域，这也有效

检查一下`postMessage()`

计划是，将 css 作为消息发送到 iframe

```
iframenode.postMessage('h2{color:red;}','*'); 
```

`*`是发送此消息，无论它在 iframe 中是什么域

并在 iframe 中接收消息并将收到的消息（CSS）添加到该文档头。

在 iframe 页面中添加的代码

```
window.addEventListener('message',function(e){

    if(e.data == 'send_user_details')
    document.head.appendChild('<style>'+e.data+'</style>');

}); 
```

* * *

## 回答 #19

> 赞同：3
> 
> 时间：2015-03-18T14:51:00.680

我找到了另一种将样式放在主 html 中的解决方案，如下所示

```
<style id="iframestyle">
    html {
        color: white;
        background: black;
    }
</style>
<style>
    html {
        color: initial;
        background: initial;
    }
    iframe {
        border: none;
    }
</style> 
```

然后在 iframe 中执行此操作（请参阅 js onload）

```
<iframe  onload="iframe.document.head.appendChild(ifstyle)" name="log" src="/upgrading.log"></iframe> 
```

在js中

```
<script>
    ifstyle = document.getElementById('iframestyle')
    iframe = top.frames["log"];
</script> 
```

它可能不是最好的解决方案，当然可以改进，但如果您想在父窗口中保留“样式”标签，这是另一种选择

* * *

## 回答 #20

> 赞同：3
> 
> 时间：2014-09-02T15:18:10.807

我们可以在 iframe 中插入样式标签。

```
<style type="text/css" id="cssID">
.className
{
    background-color: red;
}
</style>

<iframe id="iFrameID"></iframe>

<script type="text/javascript">
    $(function () {
        $("#iFrameID").contents().find("head")[0].appendChild(cssID);
        //Or $("#iFrameID").contents().find("head")[0].appendChild($('#cssID')[0]);
    });
</script> 
```

* * *

## 回答 #21

> 赞同：3
> 
> 时间：2014-07-31T12:34:27.240

我认为最简单的方法是在与 iframe 相同的位置添加另一个 div，然后

使其`z-index`比 iframe 容器大，因此您可以轻松地设置自己的 div 样式。如果您需要单击它，只需`pointer-events:none`在您自己的 div 上使用，这样 iframe 就可以工作，以防您需要单击它；）

我希望它会帮助某人；）

* * *

## 回答 #22

> 赞同：3
> 
> 时间：2016-12-29T03:47:08.010

这里，域里面有两个东西

1.  iFrame 部分
2.  在 iFrame 内加载的页面

因此，您要对这两个部分进行如下样式设置，

**1\. iFrame 部分的样式**

`id`它可以使用具有该尊重或`class`名称的CSS 设置样式。你也可以在你的父样式表中设置它的样式。

```
<style>
#my_iFrame{
height: 300px;
width: 100%;
position:absolute;
top:0;
left:0;
border: 1px black solid;
}
</style>

<iframe name='iframe1' id="my_iFrame" src="#" cellspacing="0"></iframe> 
```

**2\. 为 iFrame 中加载的页面设置样式**

可以在 Javascript 的帮助下从父页面加载此样式

```
var cssFile  = document.createElement("link") 
cssFile.rel  = "stylesheet"; 
cssFile.type = "text/css"; 
cssFile.href = "iFramePage.css"; 
```

然后将该 CSS 文件设置为受尊重的 iFrame 部分

```
//to Load in the Body Part
frames['my_iFrame'].document.body.appendChild(cssFile); 
//to Load in the Head Part
frames['my_iFrame'].document.head.appendChild(cssFile); 
```

* * *

在这里，您也可以使用这种方式在 iFrame 内编辑页面的头部

```
var $iFrameHead = $("#my_iFrame").contents().find("head");
$iFrameHead.append(
   $("<link/>",{ 
      rel: "stylesheet", 
      href: urlPath, 
      type: "text/css" }
     )); 
```

* * *

## 回答 #23

> 赞同：2
> 
> 时间：2016-10-28T03:14:28.803

```
var link1 = document.createElement('link');
    link1.type = 'text/css';
    link1.rel = 'stylesheet';
    link1.href = "../../assets/css/normalize.css";
window.frames['richTextField'].document.body.appendChild(link1);
```

* * *

## 回答 #24

> 赞同：1
> 
> 时间：2017-01-04T02:27:00.817

作为替代方案，您可以使用 CSS-in-JS 技术，如下所示：

[https://github.com/cssobj/cssobj](https://github.com/cssobj/cssobj)

它可以动态地将 JS 对象作为 CSS 注入 iframe

* * *

## 回答 #25

> 赞同：1
> 
> 时间：2016-10-03T19:41:01.883

有一个[很棒的脚本](https://github.com/edenspiekermann/iframify)可以用自己的 iframe 版本替换节点。 [CodePen**演示**](http://codepen.io/HugoGiraudel/pen/vGWpyr)

[![在此处输入图像描述](https://i.stack.imgur.com/NYF5z.png)](https://i.stack.imgur.com/NYF5z.png)

**用法示例：**

```
// Single node
var component = document.querySelector('.component');
var iframe = iframify(component);

// Collection of nodes
var components = document.querySelectorAll('.component');
var iframes = Array.prototype.map.call(components, function (component) {
  return iframify(component, {});
});

// With options
var component = document.querySelector('.component');
var iframe = iframify(component, {
  headExtra: '<style>.component { color: red; }</style>',
  metaViewport: '<meta name="viewport" content="width=device-width">'
}); 
```

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2016-10-17T08:01:32.613

**这只是一个概念，但不要在没有安全检查和过滤的情况下实现它！否则脚本可能会入侵您的网站！**

答：如果您控制目标站点，您可以设置接收器脚本，如：

1) 使用参数设置 iframe 链接`style`，例如：

```
http://your_site.com/target.php?color=red 
```

（最后一个短语由函数`a{color:red}` 编码。`urlencode`

2）像这样设置接收者页面`target.php`：

```
<head>
..........
$col = FILTER_VAR(SANITIZE_STRING, $_GET['color']);
<style>.xyz{color: <?php echo (in_array( $col, ['red','yellow','green'])?  $col : "black") ;?> } </style>
.......... 
```

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2021-11-17T01:47:38.273

这就是我在生产中的做法。需要注意的是，如果 iframe 属于其他网站，则会触发 CORS 错误，无法正常工作。

```
 var $iframe =  document.querySelector(`iframe`);
    var doc = $iframe.contentDocument;

    var style = doc.createElement("style");
    style.textContent = `*{display:none!important;}`;
    doc.head.append(style); 
```

在某些情况下，您可能还想将`load`事件附加到 iframe：

```
var $iframe =  document.querySelector(`iframe`);

$iframe.addEventListener("load", function() {
    var doc = $iframe.contentDocument;
    var style = doc.createElement("style");
    style.textContent = `*{display:none!important;}`;
    doc.head.append(style);
}); 
```

* * *

## 回答 #28

> 赞同：-20
> 
> 时间：2010-12-08T09:46:02.987

好吧，我已按照以下步骤操作：

1.  Div 与要举行的班级`iframe`
2.  添加`iframe`到`div`.
3.  在 CSS 文件中，

```
divClass { width: 500px; height: 500px; }
divClass iframe { width: 100%; height: 100%; } 
```

这适用于 IE 6。应该适用于其他浏览器，请检查！

# javascript - 哪个 JavaScript AJAX 框架最强大且非常轻量级？

> ID：217781
> 
> 赞同：5
> 
> 时间：2008-10-20T08:32:57.040
> 
> 标签：javascript, ajax, json, frameworks

我一直在使用 jQuery 在基于 Web 的应用程序中完成整个 AJAX 魔术。但我决定不需要 jQuery 拥有的所有这些惊人的功能，除了它的 AJAX 函数（如、`$.ajax()`、`$.get()`和`$.post`）。`getJSON()``load();`

你能推荐一个轻量级的跨浏览器 AJAX 库/框架（最多约 10 kb）吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-22T20:27:50.403

您可以通过删除不需要的模块来使 jQuery 更小/只需修改[Makefile](https://github.com/jquery/jquery/blob/master/Makefile)文件。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-20T08:42:01.187

如果您只需要使用 ajax 功能，请查看[sajax](http://www.modernmethod.com/sajax/index.phtml)或自定义[MooTools](http://mootools.net)。当然，如果你是一个“轻量级怪胎”你可以为此编写自己的例程（应该少于 50 行）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-20T14:55:38.170

MochiKit 可能满足您的需求： http: [//mochikit.com/](http://mochikit.com/)

尽管轻巧且功能强大，但它可能无法满足 10kb 的要求（您可以将其缩减为仅 async 模块）

等效的方法是：

*   多XHR

*   doSimpleXMLHttpRequest

*   evalJSONRequest

*   加载JSONDoc

*   发送XMLHttpRequest

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-20T15:08:53.543

真的很轻量有 SACK (Simple AJAX Code Kit) 我自己没用但是看起来很简单

编辑：我检查了，js文件大约5kB

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-20T09:10:07.900

*MooTools* ...!!

不要相信 jQuery 的家伙... ;)

# networking - 模拟 UPnP 路由器

> ID：217784
> 
> 赞同：5
> 
> 时间：2008-10-20T08:33:41.857
> 
> 标签：networking, hardware, router, emulation, upnp

我想将自动端口转发（NAT Traversal）选项添加到应用程序。

我知道这可以使用 UPnP 来完成（特别是与呈现为 IGD 的设备通信的部分 - 互联网网关设备）。

我需要能够在开发时测试此端口转发功能。以及任何大型路由器系统公司的流量都经过路由

*   不提供 UPnP。

*   不希望我在现场服务时弄乱它。

我的问题是：

**有谁知道充当或模拟 UPnP 兼容路由器的任何软件？**

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-20T09:46:14.053

[您可以使用默认支持](https://web.archive.org/web/1/http://articles.techrepublic%2ecom%2ecom/5100-10878_11-1056711.html)UPnp 的Windows 防火墙/Internet 连接共享。只需设置另一台机器，激活 Internet 连接共享，您将拥有一个 UPnp 路由器。

[此外，您可以在此处](http://www.upnp.org/)查看 UPnp 论坛以获取更多信息。

后期编辑：

您也可以尝试设置激活[igd](http://linux-igd.sourceforge.net/)的 linux/unix firwall 。

这是[ubuntu](http://ubuntuforums.org/showthread.php?t=165288)的论坛帖子。

还有一个[miniUPnp](http://miniupnp.free.fr/)项目。

# delphi - 轻松获取应用程序 exe 大小

> ID：217793
> 
> 赞同：7
> 
> 时间：2008-10-20T08:38:02.037
> 
> 标签：delphi, size

Delphi 有没有办法在一两行代码中获取当前应用程序的 exe 大小？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-20T14:34:36.373

Just for grins...you can also do this with streams Just slightly more than 2 lines of code. Generally the application filename including path is also stored into Paramstr(0).

```
var
  fs : tFilestream;
begin
  fs := tFilestream.create(paramstr(0),fmOpenRead or fmShareDenyNone);
  try
    result := fs.size;
  finally
    fs.free;
  end;
end; 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-20T15:27:50.477

It's not as small as you want, but it needs no handles. I use this in all my "SFX" archivers and programs that must know their size. IIRC it requires the Windows unit.

```
function GetExeSize: cardinal;
var
  p: pchar;
  i, NumSections: integer;
const
  IMAGE_PE_SIGNATURE  = $00004550;
begin
  result := 0;
  p := pointer(hinstance);
  inc(p, PImageDosHeader(p)._lfanew + sizeof(dword));
  NumSections := PImageFileHeader(p).NumberOfSections;
  inc(p,sizeof(TImageFileHeader)+ sizeof(TImageOptionalHeader));
  for i := 1 to NumSections do
  begin
    with PImageSectionHeader(p)^ do
      if PointerToRawData+SizeOfRawData > result then
        result := PointerToRawData+SizeOfRawData;
    inc(p, sizeof(TImageSectionHeader));
  end;
end;
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-21T00:14:07.000

For the sake of future compatibility, you should choose an implementation that does not require pointers or Windows API functions when possible. The TFileStream based solution provided by skamradt looks good to me.

But... You shouldn't worry too much whether the routine is 1 or 10 lines of code, because you're going to encapsulate it anyway in a function that takes a filename as a parameter and returns an Int64, and put it in your personal library of reusable code. Then you can call it like so:

GetMyFileSize(Application.ExeName);

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-20T09:02:50.397

不幸的是，如果不使用某些库，只用一两行代码是不可能做到的。

简单的部分是获取应用程序的 exe 文件。你可以在`Application.ExeName`

一般来说，检索文件大小有几种可能性：

1.  打开文件并读取流的大小。这可以使用“旧”Delphi 函数`FileOpen`和`FileSize`，或使用`TFileStream`（使用`size`属性）或使用 Win32 API 函数`CreateFile`和`GetFileSize`函数来完成。（平台依赖！）确保您以只读访问权限打开文件。
2.  在纯 Win32 环境中，您可以使用它`FindFirst`来获取文件大小。您可以从`TSearchRec.FindData.nFileSizeLow`. 如果您想为大于 2 GB 的文件做好准备（您应该这样做），您还必须使用该`nFileSizeHigh`部分。
3.  在 Delphi.NET 中，您可以`System.IO.FileInfo`像这样使用 : `FileInfo.Create(filename).Length`(one-liner)
4.  在 Linux 中，您可以使用`lstat64`函数 (Unit `Libc`) 并从`TStatBuf64.st_size`. （如果不计算变量声明，则为双线）

在[JCL 库](http://jcl.sourceforge.net)中，您可以找到许多有用的函数，包括一个返回给定文件名的文件大小的简单函数。（它使用适合给定平台的方法）

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-20T09:18:29.740

你可以试试这个：

```
 if FindFirst(ExpandFileName(Application.exename), faAnyFile, SearchRec) = 0 then
    MessageDlg(Format('Tamaño: <%d>',[SearchRec.Size]), mtInformation, [mbOK], 0);
  FindClose(SearchRec); 
```

===============
Neftalí

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-20T15:07:56.977

Streams can also be used without a TFileStream variable:

```
with TFilestream.create(paramstr(0), fmOpenRead or fmShareDenyNone) do 
  aFileSize := Size;
  Free;
end; 
```

Ugly, yes.

I prefer using DSiFileSize from [DSiWin32](http://gp.17slon.com/gp/dsiwin32.htm). It uses CreateFile internally:

```
function DSiFileSize(const fileName: string): int64;
var
  fHandle: DWORD;
begin
  fHandle := CreateFile(PChar(fileName), 0, 0, nil, OPEN_EXISTING, FILE_ATTRIBUTE_NORMAL, 0);
  if fHandle = INVALID_HANDLE_VALUE then
    Result := -1
  else try
    Int64Rec(Result).Lo := GetFileSize(fHandle, @Int64Rec(Result).Hi);
  finally CloseHandle(fHandle); end;
end; { DSiFileSize } 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2012-08-04T11:29:17.080

```
uses IdGlobalProtocols;

var
  ExeSize: Int64;
begin
  ExeSize := FileSizeByName(ParamStr(0)); 
  // or
  ExeSize := FileSizeByName(Application.ExeName);
end; 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-21T12:11:53.803

I would like to modify the code provided by skamradt, to make it two lines of code as you requested ;-)

```
 with tFilestream.create(paramstr(0),fmOpenRead or fmShareDenyNone) do
    ShowMessage(IntToStr(size)); 
```

but I would prefer to use the code as **skamradt** wrote, because it's more safe

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-21T12:47:38.570

Shortest I could do. Note that the .Size is in bytes, so for kilobytes, divide by 1024.

```
procedure TForm1.Button1Click(Sender: TObject);
begin
  with TFileStream.Create(Application.ExeName,fmShareDenyNone) do
    ShowMessage(FloatToStr(Size/1024));
end; 
```

Check out [this link.](http://www.delphi3000.com/articles/article_2686.asp?SK=)

# c# - 获取非 Unicode 程序的语言

> ID：217801
> 
> 赞同：3
> 
> 时间：2008-10-20T08:42:26.457
> 
> 标签：c#

任何人都知道如何使用 c# 以编程方式在控制面板区域设置中获取“非 Unicode 程序语言”的值？

已经尝试过 CultureInfo、RegionInfo 并使用 Encoding 对象获取默认编码，但我只能获取 Standards and Formats 值或主代码页。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-20T09:24:15.843

[GetSystemDefaultLocaleName](https://msdn.microsoft.com/en-us/library/dd318122(v=vs.85).aspx)或[GetSystemDefaultLCID](https://msdn.microsoft.com/en-us/library/dd318121(v=vs.85).aspx)（及其[P/Invoke 声明](http://pinvoke.net/default.aspx/kernel32/GetSystemDefaultLCID.html)）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2017-09-23T19:17:58.100

*Windows 应用程序国际*化中的[NLS 术语](https://msdn.microsoft.com/en-us/library/dd319088(v=vs.85).aspx#Language_for_Non-Unicode_Programs)页面有答案：

 *> ANSI 应用程序应在安装期间检查非 Unicode 程序设置的语言。它使用**[GetACP](https://msdn.microsoft.com/en-us/library/dd318070(v=vs.85).aspx)**或**[GetOEMCP](https://msdn.microsoft.com/en-us/library/dd318114(v=vs.85).aspx)**来检索值。不支持为非 Unicode 程序设置语言的功能。

该`GetACP`函数返回[“ANSI 代码页”](https://en.wikipedia.org/wiki/Windows_code_page#ANSI_code_page)（例如，英语为 1252），同时`GetOEMCP`返回“OEM 代码页”（控制台中使用的代码页，英文为 437）。

[Code Pages](https://msdn.microsoft.com/en-us/library/windows/desktop/dd317752(v=vs.85).aspx)包含有关 Windows 中的代码页的更多信息。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-20T09:18:49.083

IIRC，`Thread.CurrentUICulture`获得了这个价值。

# c# - 使用 LINQ 连接字符串

> ID：217805
> 
> 赞同：374
> 
> 时间：2008-10-20T08:46:11.100
> 
> 标签：c#, linq, string-concatenation

写老派最有效的方法是什么：

```
StringBuilder sb = new StringBuilder();
if (strings.Count > 0)
{
    foreach (string s in strings)
    {
        sb.Append(s + ", ");
    }
    sb.Remove(sb.Length - 2, 2);
}
return sb.ToString(); 
```

...在 LINQ 中？

* * *

## 回答 #1

> 赞同：557
> 
> 时间：2008-10-20T08:53:13.910

**此答案显示了问题中要求的 LINQ ( `Aggregate`) 的用法，不适合日常使用。因为这不使用 a`StringBuilder`它对于很长的序列会有可怕的性能。对于常规代码使用`String.Join`，如另一个[答案所示](https://stackoverflow.com/a/218419/477420)**

使用这样的聚合查询：

```
string[] words = { "one", "two", "three" };
var res = words.Aggregate(
   "", // start with empty string to handle empty list case.
   (current, next) => current + ", " + next);
Console.WriteLine(res); 
```

这输出：

```
， 一二三
```

聚合是一个函数，它接受一组值并返回一个标量值。T-SQL 中的示例包括 min、max 和 sum。VB 和 C# 都支持聚合。VB 和 C# 都支持聚合作为扩展方法。使用点表示法，只需调用[IEnumerable](http://msdn.microsoft.com/en-us/library/system.collections.ienumerable.aspx)对象上的方法。

请记住，聚合查询会立即执行。

更多信息 - [MSDN：聚合查询](https://docs.microsoft.com/en-us/dotnet/framework/data/adonet/sql/linq/aggregate-queries)

* * *

如果您真的想使用[CodeMonkeyKing](https://stackoverflow.com/users/78830/codemonkeyking)在评论中提出的`Aggregate`使用变体，这将与常规代码大致相同，包括对大量对象的良好性能：`StringBuilder``String.Join`

```
 var res = words.Aggregate(
     new StringBuilder(), 
     (current, next) => current.Append(current.Length == 0? "" : ", ").Append(next))
     .ToString(); 
```

* * *

## 回答 #2

> 赞同：410
> 
> 时间：2008-10-20T13:28:34.447

```
return string.Join(", ", strings.ToArray()); 
```

* * *

在 .Net 4 中，有一个新的[重载](http://msdn.microsoft.com/en-us/library/dd783876.aspx)来`string.Join`接受`IEnumerable<string>`。代码将如下所示：

```
return string.Join(", ", strings); 
```

* * *

## 回答 #3

> 赞同：132
> 
> 时间：2008-09-23T18:18:34.477

为什么要使用 Linq？

```
string[] s = {"foo", "bar", "baz"};
Console.WriteLine(String.Join(", ", s)); 
```

`IEnumerable<string>`据我所知，这非常有效并且可以接受任何内容。`Aggregate`这里不需要任何慢得多的东西。

* * *

## 回答 #4

> 赞同：79
> 
> 时间：2008-09-23T18:09:49.740

你看过聚合扩展方法吗？

```
var sa = (new[] { "yabba", "dabba", "doo" }).Aggregate((a,b) => a + "," + b); 
```

* * *

## 回答 #5

> 赞同：58
> 
> 时间：2008-10-20T08:52:59.587

我的代码中的真实示例：

```
return selected.Select(query => query.Name).Aggregate((a, b) => a + ", " + b); 
```

查询是具有名称属性的对象，该属性是一个字符串，我想要所选列表中所有查询的名称，以逗号分隔。

* * *

## 回答 #6

> 赞同：32
> 
> 时间：2012-10-04T19:02:53.463

Here is the combined Join/Linq approach I settled on after looking at the other answers and the issues addressed [in a similar question](https://stackoverflow.com/a/2680156/957950) (namely that Aggregate and Concatenate fail with 0 elements).

`string Result = String.Join(",", split.Select(s => s.Name));`

or (if `s` is not a string)

`string Result = String.Join(",", split.Select(s => s.ToString()));`

*   Simple
*   easy to read and understand
*   works for generic elements
*   allows using objects or object properties
*   handles the case of 0-length elements
*   could be used with additional Linq filtering
*   performs well (at least in my experience)
*   doesn't require (manual) creation of an additional object (e.g. `StringBuilder`) to implement

And of course Join takes care of the pesky final comma that sometimes sneaks into other approaches (`for`, `foreach`), which is why I was looking for a Linq solution in the first place.

* * *

## 回答 #7

> 赞同：29
> 
> 时间：2010-05-19T20:42:05.397

您可以`StringBuilder`使用`Aggregate`：

```
 List<string> strings = new List<string>() { "one", "two", "three" };

  StringBuilder sb = strings
    .Select(s => s)
    .Aggregate(new StringBuilder(), (ag, n) => ag.Append(n).Append(", "));

  if (sb.Length > 0) { sb.Remove(sb.Length - 2, 2); }

  Console.WriteLine(sb.ToString()); 
```

（`Select`那里只是为了表明你可以做更多的 LINQ 东西。）

* * *

## 回答 #8

> 赞同：22
> 
> 时间：2010-05-10T22:46:43.030

超过 3000 个元素的 StringBuilder 与 Select & Aggregate 案例的快速性能数据：

单元测试 - 持续时间（秒）
LINQ_StringBuilder - 0.0036644
LINQ_Select.Aggregate - 1.8012535

```
 [TestMethod()]
    public void LINQ_StringBuilder()
    {
        IList<int> ints = new List<int>();
        for (int i = 0; i < 3000;i++ )
        {
            ints.Add(i);
        }
        StringBuilder idString = new StringBuilder();
        foreach (int id in ints)
        {
            idString.Append(id + ", ");
        }
    }
    [TestMethod()]
    public void LINQ_SELECT()
    {
        IList<int> ints = new List<int>();
        for (int i = 0; i < 3000; i++)
        {
            ints.Add(i);
        }
        string ids = ints.Select(query => query.ToString())
                         .Aggregate((a, b) => a + ", " + b);
    } 
```

* * *

## 回答 #9

> 赞同：19
> 
> 时间：2009-05-08T17:02:34.813

我总是使用扩展方法：

```
public static string JoinAsString<T>(this IEnumerable<T> input, string seperator)
{
    var ar = input.Select(i => i.ToString());
    return string.Join(seperator, ar);
} 
```

* * *

## 回答 #10

> 赞同：13
> 
> 时间：2012-05-16T12:37:37.140

通过“*超酷的 LINQ 方式*”，您可能是在谈论 LINQ 通过使用扩展方法使函数式编程更容易接受的方式。我的意思是，允许函数以视觉线性方式（一个接一个）而不是嵌套（一个在另一个内部）链接的语法糖。例如：

```
int totalEven = Enumerable.Sum(Enumerable.Where(myInts, i => i % 2 == 0)); 
```

可以这样写：

```
int totalEven = myInts.Where(i => i % 2 == 0).Sum(); 
```

您可以看到第二个示例更易于阅读。您还可以看到如何在减少缩进问题或出现在表达式末尾的*Lispy闭合括号的情况下添加更多函数。*

许多其他答案表明这`String.Join`是要走的路，因为它是最快或最容易阅读的。但是，如果您接受我对“*超酷 LINQ 方式*”的解释，那么答案是使用`String.Join`但将其包装在 LINQ 样式扩展方法中，这将允许您以视觉上令人愉悦的方式链接您的函数。所以如果你想写`sa.Concatenate(", ")`，你只需要创建这样的东西：

```
public static class EnumerableStringExtensions
{
   public static string Concatenate(this IEnumerable<string> strings, string separator)
   {
      return String.Join(separator, strings);
   }
} 
```

这将提供与直接调用一样高性能的代码（至少在算法复杂性方面），并且在某些情况下可能使代码更具可读性（取决于上下文），特别是如果块中的其他代码使用链式函数样式.

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2008-10-20T09:14:32.680

[在上一个问题上](https://stackoverflow.com/questions/145856/how-to-join-int-to-a-charcter-separated-string-in-c)有各种替代答案- 诚然，它以整数数组作为源，但收到了普遍的答案。

* * *

## 回答 #12

> 赞同：5
> 
> 时间：2012-09-03T04:34:09.773

这里它使用纯 LINQ 作为单个表达式：

```
static string StringJoin(string sep, IEnumerable<string> strings) {
  return strings
    .Skip(1)
    .Aggregate(
       new StringBuilder().Append(strings.FirstOrDefault() ?? ""), 
       (sb, x) => sb.Append(sep).Append(x));
} 
```

而且它非常快！

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2011-09-01T17:42:52.357

我将稍微作弊并抛出一个新的答案，似乎总结了这里最好的一切，而不是将其粘贴在评论中。

所以你可以这样写：

```
List<string> strings = new List<string>() { "one", "two", "three" };

string concat = strings        
    .Aggregate(new StringBuilder("\a"), 
                    (current, next) => current.Append(", ").Append(next))
    .ToString()
    .Replace("\a, ",string.Empty); 
```

**编辑：**您要么先检查一个空的可枚举，要么`.Replace("\a",string.Empty);`在表达式的末尾添加一个。我想我可能一直试图变得有点太聪明了。

@a.friend 的答案可能会稍微好一点，我不确定 Replace 与 Remove 相比在幕后做了什么。如果出于某种原因您想连接以 \a 结尾的字符串，那么唯一的另一个警告是您会丢失分隔符......我发现这不太可能。如果是这种情况，您确实有[其他花哨的角色](http://blogs.msdn.com/b/csharpfaq/archive/2004/03/12/what-character-escape-sequences-are-available.aspx)可供选择。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2011-02-02T09:00:14.363

您可以将 LINQ 和`string.join()`相当有效的结合起来。在这里，我从字符串中删除一个项目。也有更好的方法来做到这一点，但这里是：

```
filterset = String.Join(",",
                        filterset.Split(',')
                                 .Where(f => mycomplicatedMatch(f,paramToMatch))
                       ); 
```

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2010-04-21T20:02:07.253

这里有很多选择。您可以使用 LINQ 和 StringBuilder 来获得性能，如下所示：

```
StringBuilder builder = new StringBuilder();
List<string> MyList = new List<string>() {"one","two","three"};

MyList.ForEach(w => builder.Append(builder.Length > 0 ? ", " + w : w));
return builder.ToString(); 
```

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2011-12-14T18:41:55.440

在使用 linq 解析 IIS 日志文件时，我做了以下快速而肮脏的操作，它在 100 万行（15 秒）时工作得很好，尽管在尝试 200 万行时出现内存不足错误。

```
 static void Main(string[] args)
    {

        Debug.WriteLine(DateTime.Now.ToString() + " entering main");

        // USED THIS DOS COMMAND TO GET ALL THE DAILY FILES INTO A SINGLE FILE: copy *.log target.log 
        string[] lines = File.ReadAllLines(@"C:\Log File Analysis\12-8 E5.log");

        Debug.WriteLine(lines.Count().ToString());

        string[] a = lines.Where(x => !x.StartsWith("#Software:") &&
                                      !x.StartsWith("#Version:") &&
                                      !x.StartsWith("#Date:") &&
                                      !x.StartsWith("#Fields:") &&
                                      !x.Contains("_vti_") &&
                                      !x.Contains("/c$") &&
                                      !x.Contains("/favicon.ico") &&
                                      !x.Contains("/ - 80")
                                 ).ToArray();

        Debug.WriteLine(a.Count().ToString());

        string[] b = a
                    .Select(l => l.Split(' '))
                    .Select(words => string.Join(",", words))
                    .ToArray()
                    ;

        System.IO.File.WriteAllLines(@"C:\Log File Analysis\12-8 E5.csv", b);

        Debug.WriteLine(DateTime.Now.ToString() + " leaving main");

    } 
```

我使用 linq 的真正原因是我之前需要的 Distinct()：

```
string[] b = a
    .Select(l => l.Split(' '))
    .Where(l => l.Length > 11)
    .Select(words => string.Format("{0},{1}",
        words[6].ToUpper(), // virtual dir / service
        words[10]) // client ip
    ).Distinct().ToArray()
    ; 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2009-11-15T11:50:30.957

不久前我在博客上写过这个，我所做的接缝正是你正在寻找的：

[http://ondevelopment.blogspot.com/2009/02/string-concatenation-made-easy.html](http://ondevelopment.blogspot.com/2009/02/string-concatenation-made-easy.html)

在博客文章中描述了如何实现适用于 IEnumerable 并命名为 Concatenate 的扩展方法，这将让您编写如下内容：

```
var sequence = new string[] { "foo", "bar" };
string result = sequence.Concatenate(); 
```

或者更复杂的事情，比如：

```
var methodNames = typeof(IFoo).GetMethods().Select(x => x.Name);
string result = methodNames.Concatenate(", "); 
```

# excel - 访问 Office 应用程序状态栏中的进度条

> ID：217816
> 
> 赞同：5
> 
> 时间：2008-10-20T08:55:12.017
> 
> 标签：excel, vba, ms-word, progress-bar, ms-office

我为 Word 和 Excel 构建 VBA 应用程序，有什么方法可以访问有时出现在 Office 状态栏中的进度条。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-20T17:38:15.877

下面将模拟 Excel 状态栏中的进度条：

```
Public Sub UpdateStatusBar(percent As Double, Optional Message As String = "")

    Const maxBars As Long = 20
    Const before As String = "["
    Const after As String = "]"

    Dim bar As String
    Dim notBar As String
    Dim numBars As Long

    bar = Chr(31)
    notBar = Chr(151)
    numBars = percent * maxBars

    Application.StatusBar = _
    before & Application.Rept(bar, numBars) & Application.Rept(notBar, maxBars - numBars) & after & " " & _
         Message & " (" & PercentageToString(percent) & "%)"

    DoEvents

End Sub 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-22T19:35:11.600

另外，我建议记录 StatusBar 的当前状态，然后在一切完成后恢复它。

```
Dim OldStatus
With Application
    OldStatus = .DisplayStatusBar
    .DisplayStatusBar = True
    .StatusBar = "Doing my duty, please wait..."
End With
' Do what you do best here (you can refresh the .StatusBar message with updted, as needed)
With Application
    .StatusBar = False
    .DisplayStatusBar = OldStatus
End With 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-20T09:10:44.093

我没有访问进度条，但我过去曾使用过类似的东西将任务状态文本放在状态栏中......

```
Sub StatusBarExample()
    Application.ScreenUpdating = False 
    ' turns off screen updating
    Application.DisplayStatusBar = True 
    ' makes sure that the statusbar is visible
    Application.StatusBar = "Please wait while performing task 1..."
    ' add some code for task 1 that replaces the next sentence
    Application.Wait Now + TimeValue("00:00:02")
    Application.StatusBar = "Please wait while performing task 2..."
    ' add some code for task 2 that replaces the next sentence
    Application.Wait Now + TimeValue("00:00:02")
    Application.StatusBar = False 
    ' gives control of the statusbar back to the programme
End Sub 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-26T11:49:44.323

AFAIK，没有办法重现 Word 和 Excel 使用的蓝点线来显示 100% 的进度，例如在打开文件时。

我记得曾经在状态栏中看到一些代码来复制它，但它很复杂，我不推荐它，当使用 Application.StatusBar 在状态栏中说“X% 完成”就足够了。

# vba - 构建 Word 字段

> ID：217821
> 
> 赞同：3
> 
> 时间：2008-10-20T09:00:05.813
> 
> 标签：vba, ms-word, word-template, user-defined-fields

除了将文本插入和解析到空白 Word 字段之外，有没有办法使用 VBA 以编程方式将用户定义的字段和字段代码构建到我自己的模板中？此外，有没有办法让这些字段显示在可用字段列表中？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-20T18:01:18.623

我最近开发了一个使用 Word 的 MACROBUTTON 和 ADDIN 字段类型的解决方案。

我发现 MACROBUTTON 很有用，因为字段内的第三个以空格分隔的条目（以编程方式 field.code.text）显示在 Word 中。这允许我的用户在移动时观察字段。{ MACROBUTTON NoMacro * } 会在 Word 中显示一个“*”，例如当用户双击它时它什么也不做，因为我故意没有定义一个名为“NoMacro”的宏。

The ADDIN field does not display (except when display field codes is turned on) and stores a hidden string in its field.data property. Using this field I could have a hidden field the contents of which could not be seen or modified by users (excepting that if they turn on "show field codes" they can see that it is an ADDIN field (but they cannot see/edit the "data" property), and that they can delete this field just like any other field.)

I found these pages useful:

*   [Using MacroButton fields](http://word.mvps.org/FAQs/TblsFldsFms/UsingMacroButton.htm)
*   [Using Addin Fields](http://word.mvps.org/FAQs/TblsFldsFms/AddinFields.htm)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-20T12:45:00.680

你想到了什么？可以手动或使用 VBA 添加自定义文档属性。这些是 DOCPROPERTY 下的可访问字段：

```
{ DOCPROPERTY "Test"  \* MERGEFORMAT } 
```

您可以使用宏来确保将自定义属性添加到文档中：

```
Sub AutoNew()
Dim objCustomProperties As DocumentProperties

Set objCustomProperties = ActiveDocument.CustomDocumentProperties

objCustomProperties.Add Name:="Test", _
   Type:=msoPropertyTypeString, Value:="Blah", _
   LinkToContent:=False

End Sub 
```

**更多的信息**

自动宏：http : [//msdn.microsoft.com/en-us/library/aa263747 (office.10).aspx](http://msdn.microsoft.com/en-us/library/aa263747(office.10).aspx)

了解 Microsoft Office Word 2003 中的自定义文档属性：http: [//msdn.microsoft.com/en-us/library/aa537154.aspx](http://msdn.microsoft.com/en-us/library/aa537154.aspx)

# iphone - OpenGL ES 中的大滚动背景

> ID：217822
> 
> 赞同：5
> 
> 时间：2008-10-20T09:00:12.040
> 
> 标签：iphone, performance, opengl-es, scroll, 2d

我正在为 iPhone 开发 2D 滚动游戏。我有一个大的图像背景，比如 480×6000 像素，只有一部分是可见的（正好一个屏幕的价值，480×320 像素）。在屏幕上获得这样的背景的最佳方法是什么？

目前，我将背景拆分为多个纹理（以绕过最大纹理大小限制），并将每个帧中的整个背景绘制为带纹理的三角形条。滚动是通过平移模型视图矩阵来完成的。剪刀框设置为窗口大小，480×320 像素。这并不意味着要快，我只是想要一个工作代码，然后再进行优化。

我认为也许 OpenGL 实现足够聪明，可以丢弃背景的不可见部分，但根据我编写的一些测量代码，它看起来背景平均需要 7 毫秒来绘制，最多需要 84 毫秒。（这是在模拟器中测量的。）这大约是整个渲染循环的一半，即。对我来说很慢。

绘制背景应该像将一些 480×320 像素从 VRAM 的一部分复制到另一部分一样简单，或者换句话说，速度极快。接近这种性能的最佳方法是什么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-20T09:21:11.730

这是做这件事的快速方法。您可以做的事情来提高性能：

*   尝试不同的纹理格式。大概 SDK 文档有关于首选格式的详细信息，并且大概越小越好。
*   自己剔除屏幕外的瓷砖
*   将图像分割成更小的纹理

我假设您正在以 1:1 的缩放级别进行绘制；是这样吗？

**编辑：**哎呀。更仔细地阅读了您的问题后，我必须提供另一条建议：**在模拟器上进行的计时毫无价值。**

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-20T09:59:13.980

快速解决方案：

*   创建瓷砖的几何矩阵（最好是四边形），以便在可视区域的所有侧面至少有一行/列的屏幕外瓷砖。

*   将纹理映射到所有这些图块。

*   只要一个图块超出可视区域，您就可以释放此纹理并绑定一个新的。

*   Move the tiles using a modulo of the tile width and tile height as position (so that the tile will reposition itself at its starting pos when it have moved exactly one tile in length). Also remember to remap the textures during that operation. This allows you to have a very small grid/very little texture memory loaded at any given time. Which I guess is especially important in GL ES.

If you have memory to spare and are still plagued with slow load speed (although you shouldn't for that amount of textures). You could build a texture streaming engine that preloads textures into faster memory (whatever that may be on your target device) when you reach a new area. Mapping as textures will in that case go from that faster memory when needed. Just be sure that you are able to preload it without using up all memory and remember to release it dynamically when not needed.

Here is a link to a GL (not ES) tile engine. I haven't used it myself so I cannot vouch for its functionality but it might be able to help you: [http://www.mesa3d.org/brianp/TR.html](http://www.mesa3d.org/brianp/TR.html)

# linux - 是否有任何类似的 Linux 工具可以像 Mac OS X 上的 Shark 一样工作？

> ID：217825
> 
> 赞同：7
> 
> 时间：2008-10-20T09:02:57.307
> 
> 标签：linux, profiling, profiler, oprofile

[Mac OS X 上的Shark](http://en.wikipedia.org/wiki/Apple_Developer_Tools#Shark)是一个很好的工具，用于分析正在运行的系统上的应用程序。Linux 有没有类似的工具？

[OProfile](http://oprofile.sourceforge.net/about/)看起来可以，有人用过吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-02T17:48:22.407

扩展另一个答案，我使用 valgrind ( [http://valgrind.org](http://valgrind.org) ) 的 'callgrind' 选项。然后从 KDE 安装[kcachegrind](https://github.com/KDE/kcachegrind)以获得漂亮的 GUI 界面。

作为一个假人的教程，做：

1) 使用调试信息编译您的应用程序。尝试打开和关闭优化进行分析是个好主意，关闭优化您将获得更多信息，但它可能不太准确（特别是微小的函数似乎会占用比应得的更多时间。

2）运行：

```
valgrind --tool=callgrind <name of your app> <your app's options> 
```

这应该会生成一个名为“callgrind.something”的文件，您可以将其加载到 kcachegrind 中。

您还可以查看：

```
valgrind --tool=cachegrind <name of your app> <your app's options> 
```

这将为您提供有关您的应用程序如何与 CPU 缓存交互的信息。

请注意，虽然 valgrind 和 Shark 看起来很相似，但它们的工作方式却大不相同。当您在 valgrind 中运行应用程序时，它的运行速度会比正常速度慢很多倍（通常慢 40 倍以上），但您获得的结果比鲨鱼的要准确得多。我倾向于使用两者，所以我可以获得尽可能多的信息！

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-20T09:40:39.400

你或许可以试试 Valgrind ( [http://valgrind.org/](http://valgrind.org/) )。他们有运行时和编译时分析工具。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2010-12-07T10:34:57.843

A bit late to answer this one, but the closest answer is [Zoom](http://rotateright.com/zoom.html). Some of the Shark team worked on it.

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-12-03T03:26:40.430

[**OProfile**](http://oprofile.sourceforge.net/news/) is a tool that does sampling-based profiling of both your application and the system calls it makes. This allows for seeing detailed information about where it's spending time. It doesn't have a GUI, but there are several front-ends that will let you process the information from the runs.

I've used it extensively, both for desktop applications and for embedded systems. It takes a little effort to interpret the results, but the callgraph output is really useful here.

# java - Which is the best Open source application server?

> ID：217827
> 
> 赞同：23
> 
> 时间：2008-10-20T09:04:09.863
> 
> 标签：java

We are looking for a open source J2EE Application server for log budget deployments. We are considering JBoss and Glassfish. Which is the best open source application server? Any comparative study available?

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-10-20T21:53:00.153

JBoss has been used in production environment for over 6 years now. Glassfish's codebase is over 10 years BUT most of the code is recent. Glassfish v3 (still in beta) has a microkernel (so is Jboss 5) architecture.

Glassfish has command line tools and a nice console. Since Glassfish is from sun, usually it will work well with the latest version of JDK/J2EE -- currently JDK 6/J2EE 5.

Glassfish should work well in windows, solaris and linux. Jboss(from redhat) should work just fine on linux, windows for sure.

community : a much much bigger community around Jboss. Glassfish still forming its community. Books and other 3rd party products are available for JBoss but not for Glassfish.

If something is mission critical and you need to get it up and running right now, you will NOT go wrong going with JBoss. However, if you have some time, in the long run Glassfish will NOT hurt you. Especially, if you're targeting Solaris.

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-10-21T03:24:57.393

After using JBoss from the very beginning and then switching to Glassfish in the last 6 months, I can honestly say that Glassfish is fast, reliable and full-featured. I would never consider going back. Im not talking "PetStore" here, my experience with these servers is in the high-transaction online stock-trading arena.

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-20T09:14:10.717

I'm sure the answer depends on your specific needs. You won't go wrong with either Glassfish or Jboss. I tend to prefer Glassfish because of the nice admin console. My advice to you is that you draw you requirements and test both app servers. Most benchmarks I find on the net tend to be a little biased.

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-20T09:09:05.670

A comparison table between JBoss, Geronimo and Tomcat for latter 2007.

[This article](http://www.javaworld.com/javaworld/jw-12-2007/jw-12-appservers.html) has many interesting points to aid your decision and is worth reading:

> **Geronimo 2 is the clear choice if your Java application needs are particularly extensive or if you just want to leverage total Java EE 5 compliance.** Although JBoss 4.2 is not completely compatible with Sun's Java EE 5 standard, the JBoss 4.2 team is responsible for many of the cutting-edge technologies used by all of the servers and added to the standard Java EE 5 capabilities. Tomcat 6 by itself is a lightweight solution. It does not come with all the Java EE features and additional packages found in JBoss and Geronimo, but also doesn't require much memory and runs fast even on smaller servers.

In conclusion the author says:

> Bottom line: JBoss, Geronimo, and Tomcat are reliable, fast, and definitely able to handle the traffic on large-scale enterprise applications. Furthermore, many of the high-demand Java server technologies presented in the features comparison originate from the open source world, not the commercial one.

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-21T03:17:05.490

I would consider any bells and whistles you might be interested in. JBoss has a lot of nice integration points with frameworks, such as Hibernate, but has a history of not playing well with Spring. Both very useful frameworks, both code change your decision on how you might proceed.

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-24T00:16:20.517

I've had great experiences with JBoss 4.x, but unfortunately they seem to have gone off the tracks with their Java EE 5 implementation effort. The fact that JBoss 5 is so late getting to market is extremely disappointing.

The most impressive to me right now is Glassfish. It has a great pace of development, and appears poised to dominate once Java EE 6 hits the wire.

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-11T20:52:44.987

Websphere CE is also worth looking at, but over all my vote would be for glassfish. The v3 version is looking very promising.

Karl

# asp.net-mvc - ASP.net MVC 和 .Net 版本

> ID：217828
> 
> 赞同：1
> 
> 时间：2008-10-20T09:04:23.277
> 
> 标签：asp.net-mvc

我的 PC 上安装了 Visual Studio 2008。谁能告诉我应该安装什么，以便我可以从 MVC 架构开始。我对 MVC 架构所需的 .NET 版本感到非常困惑。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-20T09:09:48.807

访问[http://www.asp.net](http://www.asp.net)

您将需要带有 SP1 的 vs2008

.net3.5

然后是来自 MS的[beta](http://www.microsoft.com/downloads/details.aspx?FamilyId=A24D1E00-CD35-4F66-BAA0-2362BDDE0766&displaylang=en)

# asp.net-mvc - 请等待 ASP.NET MVC 中的页面

> ID：217829
> 
> 赞同：5
> 
> 时间：2008-10-20T09:04:47.473
> 
> 标签：asp.net-mvc, webforms

一个页面执行许多任务并且需要很长时间来处理。我们希望在每个任务完成时给用户反馈。

在我们使用的 ASP.NET 网络表单中`Response.Flush()`

你会在 ASP.NET MVC 中采用什么方法？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-20T09:36:25.490

你仍然可以使用 Response.Write() 和 Response.Flush() 来处理你想要发送的任何状态。或者，如果您在用户控件中有进度，您可以执行以下操作：

```
this.PartialView("Progress").ExecuteResult(this.ControllerContext);
this.Response.Flush(); 
```

在控制器的操作方法中执行冗长的操作时，从您的控制器中获取。

您可以选择此方法或此处评论中提到的客户端方法，只是想指出服务器端仍然是可能的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-20T09:29:07.613

我建议使用 AJAX 来显示进度。见链接的想法：

*   [带有 ASP.NET AJAX 的实时进度条](http://www.singingeels.com/Articles/RealTime_Progress_Bar_With_ASPNET_AJAX.aspx)
*   [在 ASP.NET 中使用 jQuery 插件](http://mattberseth.com/blog/2008/06/using_jquery_plugins_with_aspn.html)
*   [Ajax 进度条控件](http://refact.blogspot.com/2008/06/ajax-progress-bar-control.html)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-20T09:38:32.913

有两种基本方法：

1.  轮询返回状态的服务器页面，然后在操作完成后重定向到结果页面。MVC 与这种方式无关，您需要使用服务器变量来存储对象/状态 - 这是一种与标准 Asp.NET 应用程序更相关的方式，因为您（可能）使用会话变量等。反正。

2.  从客户端到服务器上的 Web 服务的 AJAX 调用。Asp.NET MVC 将滚动 jQuery 框架，因此将其用于客户端调用和响应事件处理。这将更符合 MVC 的精神，它不/不应该使用会话状态等。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-20T09:21:56.783

你可以在客户端制作它。在每个步骤中，您使用当前步骤设置一些会话变量。然后，您在控制器中执行另一个操作，称为“GetProgress”并为其分配视图和 URI。

在操作中，您将检查此会话并返回任务的当前进度。在客户端，创建一个计时器（即 setTimeOut），然后每隔特定时间（大约 1 秒）调用后面的控制器操作的 URI。这就对了。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-20T09:22:40.153

就我个人而言，我会考虑两种选择：

*   重定向到等待页面，然后触发操作
*   做ajax风格

# java - 如何使用 Hibernate @Any 相关的注解？

> ID：217831
> 
> 赞同：33
> 
> 时间：2008-10-20T09:05:30.123
> 
> 标签：java, hibernate, orm, annotations

有人可以向我解释任何相关的注释（`@Any`、`@AnyMetaDef`和）在实践中是如何工作的`@AnyMetaDefs`。`@ManyToAny`我很难找到关于这些的任何有用的文档（仅 JavaDoc 不是很有帮助）。

到目前为止，我已经收集到它们以某种方式能够引用抽象类和扩展类。如果是这种情况，为什么没有`@OneToAny`注释？这个“任何”是指一个“任何”还是多个“任何”？

一个简短、实用和说明性的例子将非常感激（不必编译）。

**编辑：**尽管我想接受答复作为答案并在适当的时候给予信用，但我发现 Smink 和 Sakana 的答案都提供了丰富的信息。因为我不能接受多个回复作为*答案*，所以很遗憾我将两者都标记为答案。

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2008-10-20T09:15:14.690

希望这篇[文章](http://www.jroller.com/eyallupu/entry/hibernate_the_any_annotation)能给这个主题带来一些启示：

> 有时我们需要将关联属性映射到没有共同祖先实体的不同类型的实体——因此普通的多态关联无法完成这项工作。

例如，让我们假设管理媒体库的三个不同应用程序 - 第一个应用程序管理图书借阅，第二个应用程序管理 DVD，第三个应用程序管理 VHS。这些应用程序没有任何共同点。现在我们要开发一个新的应用程序来管理所有三种媒体类型并重用现有的 Book、DVD 和 VHS 实体。由于 Book、DVD 和 VHS 类来自不同的应用程序，它们没有任何祖先实体——共同的祖先是 java.lang.Object。我们仍然希望有一个 Borrow 实体，它可以引用任何可能的媒体类型。

为了解决这种类型的引用，我们可以使用 any 映射。此映射始终包含多个列：一列包含当前映射属性所引用的实体的类型，另一列包含实体的标识，例如，如果我们引用一本书，则第一列将包含一个标记Book 实体类型，第二个实体类型将包含特定书籍的 id。

```
@Entity
@Table(name = "BORROW")
public class Borrow{

    @Id
    @GeneratedValue
    private Long id;

    @Any(metaColumn = @Column(name = "ITEM_TYPE"))
    @AnyMetaDef(idType = "long", metaType = "string", 
            metaValues = { 
             @MetaValue(targetEntity = Book.class, value = "B"),
             @MetaValue(targetEntity = VHS.class, value = "V"),
             @MetaValue(targetEntity = DVD.class, value = "D")
       })
    @JoinColumn(name="ITEM_ID")
    private Object item;

     .......
    public Object getItem() {
        return item;
    }

    public void setItem(Object item) {
        this.item = item;
    }

} 
```

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2008-10-20T09:26:34.153

@Any 注释定义了与来自多个表的类的多态关联。这种类型的映射总是需要多于一列。第一列包含关联实体的类型。其余列包含标识符。为这种关联指定外键约束是不可能的，因此这绝对不是映射（多态）关联的常用方式。您应该只在非常特殊的情况下使用它（例如审计日志、用户会话数据等）。@Any 注释描述了保存元数据信息的列。为了链接元数据信息的值和实际的实体类型，使用了@AnyDef 和@AnyDefs 注释。

```
@Any( metaColumn = @Column( name = "property_type" ), fetch=FetchType.EAGER )
@AnyMetaDef(
    idType = "integer",
    metaType = "string",
    metaValues = {
        @MetaValue( value = "S", targetEntity = StringProperty.class ),
        @MetaValue( value = "I", targetEntity = IntegerProperty.class )
} )
@JoinColumn( name = "property_id" )
public Property getMainProperty() {
    return mainProperty;
} 
```

idType 表示目标实体标识符属性类型，metaType 表示元数据类型（通常是 String）。请注意，@AnyDef 可以相互化和重用。在这种情况下，建议将其作为包元数据放置。

```
//on a package
@AnyMetaDef( name="property"
idType = "integer",
metaType = "string",
metaValues = {
@MetaValue( value = "S", targetEntity = StringProperty.class ),
@MetaValue( value = "I", targetEntity = IntegerProperty.class )
} )
package org.hibernate.test.annotations.any;
//in a class
@Any( metaDef="property", metaColumn = @Column( name = "property_type" ), fetch=FetchType.EAGER )
@JoinColumn( name = "property_id" )
public Property getMainProperty() {
    return mainProperty;
} 
```

@ManyToAny 允许对来自多个表的类进行多态关联。这种类型的映射总是需要多于一列。第一列包含关联实体的类型。其余列包含标识符。为这种关联指定外键约束是不可能的，因此这绝对不是映射（多态）关联的常用方式。您应该只在非常特殊的情况下使用它（例如审计日志、用户会话数据等）。

```
@ManyToAny(
metaColumn = @Column( name = "property_type" ) )
@AnyMetaDef(
    idType = "integer",
    metaType = "string",
    metaValues = {
@MetaValue( value = "S", targetEntity = StringProperty.class ),
@MetaValue( value = "I", targetEntity = IntegerProperty.class ) } )
@Cascade( { org.hibernate.annotations.CascadeType.ALL } )
@JoinTable( name = "obj_properties", joinColumns = @JoinColumn( name = "obj_id" ),
    inverseJoinColumns = @JoinColumn( name = "property_id" ) )
public List<Property> getGeneralProperties() { 
```

Src：[Hibernate Annotations 参考指南 3.4.0GA](http://www.hibernate.org/hib_docs/annotations/reference/en/pdf/hibernate_annotations.pdf)

希望能帮助到你！

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2015-10-06T14:45:35.420

@Any 注释定义了来自多个表的类的多态关联，对，但是像这样的多态关联是 SQL 反模式！主要原因是如果一列可以引用多个表，则无法定义 FK 约束。

Bill Karwin 在他的书中指出的解决方案之一是为每种类型的“Any”创建交集表，而不是使用带有“type”的列，并使用 unique 修饰符来避免重复。使用 JPA 时，此解决方案可能会很痛苦。

另一个解决方案，也是由 Karwin 提出的，是为连接的元素创建一个超类型。以借用 Book、DVD 或 VHS 为例，可以创建一个超类型 Item，并使 Book、DVD 和 VHS 继承于 Item，采用 Joined table 的策略。借用然后指向项目。这样您就完全避免了 FK 问题。我将本书示例翻译为 JPA，如下所示：

```
@Entity
@Table(name = "BORROW")
public class Borrow{
//... id, ...
@ManyToOne Item item;
//...
}

@Entity
@Table(name = "ITEMS")
@Inheritance(strategy=JOINED)
public class Item{
  // id, ....
  // you can add a reverse OneToMany here to borrow.
}

@Entity
@Table(name = "BOOKS")    
public class Book extends Item {
  // book attributes
}

@Entity
@Table(name = "VHS")    
public class VHS extends Item {
  // VHSattributes
}

@Entity
@Table(name = "DVD")    
public class DVD extends Item {
  // DVD attributes
} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-20T09:15:09.573

您是否阅读[过 @Any 的 Hibernate Annotations 文档](http://docs.jboss.org/hibernate/orm/5.2/userguide/html_single/Hibernate_User_Guide.html#mapping-column-any)？我自己还没有使用过那个，但它看起来像是定义引用的某种扩展方式。该链接包含一个示例，但我不知道它是否足以完全理解这个概念......

# latex - 如何用 LaTeX 创建时间线？

> ID：217834
> 
> 赞同：88
> 
> 时间：2008-10-20T09:08:30.650
> 
> 标签：latex, tex, timeline

在历史书籍中，您通常有时间线，其中事件和时期以正确的相对距离标记在一条线上。如何在 LaTeX 中创建类似的东西？

* * *

## 回答 #1

> 赞同：83
> 
> 时间：2010-12-10T01:41:20.070

There is a new [chronology.sty](http://www.tug.org/texlive/devsrc/Master/texmf-dist/tex/latex/chronology/chronology.sty) by [Levi Wiseman](https://web.archive.org/web/20110830214835/http://codeaholic.com/Portfolio/Design/LaTeX/Chronology). The [documentation](http://ctan.localhost.net.ar/macros/latex/contrib/chronology/chronology.pdf) (pdf) says:

> Most timeline packages and solutions for LATEX are used to convey a lot of information and are therefore designed vertically. If you are just attempting to assign labels to dates, a more traditional timeline might be more appropriate. That's what chronology is for.

Here is some example code:

```
\documentclass{article}
\usepackage{chronology}
\begin{document}

\begin{chronology}[5]{1983}{2010}{3ex}[\textwidth]
\event{1984}{one}
\event[1985]{1986}{two}
\event{\decimaldate{25}{12}{2001}}{three}
\end{chronology}

\end{document} 
```

Which produces this output:

> ![chronology.sty 的示例输出](https://i.stack.imgur.com/OONZJ.png)

* * *

## 回答 #2

> 赞同：53
> 
> 时间：2008-10-20T17:40:12.830

tikz包似乎[有](http://ctan.org/pkg/pgf)你想要的。

```
\documentclass{article}
\usepackage{tikz}
\usetikzlibrary{snakes}

\begin{document}

  \begin{tikzpicture}[snake=zigzag, line before snake = 5mm, line after snake = 5mm]
    % draw horizontal line   
    \draw (0,0) -- (2,0);
    \draw[snake] (2,0) -- (4,0);
    \draw (4,0) -- (5,0);
    \draw[snake] (5,0) -- (7,0);

    % draw vertical lines
    \foreach \x in {0,1,2,4,5,7}
      \draw (\x cm,3pt) -- (\x cm,-3pt);

    % draw nodes
    \draw (0,0) node[below=3pt] {$ 0 $} node[above=3pt] {$   $};
    \draw (1,0) node[below=3pt] {$ 1 $} node[above=3pt] {$ 10 $};
    \draw (2,0) node[below=3pt] {$ 2 $} node[above=3pt] {$ 20 $};
    \draw (3,0) node[below=3pt] {$  $} node[above=3pt] {$  $};
    \draw (4,0) node[below=3pt] {$ 5 $} node[above=3pt] {$ 50 $};
    \draw (5,0) node[below=3pt] {$ 6 $} node[above=3pt] {$ 60 $};
    \draw (6,0) node[below=3pt] {$  $} node[above=3pt] {$  $};
    \draw (7,0) node[below=3pt] {$ n $} node[above=3pt] {$ 10n $};
  \end{tikzpicture}

\end{document} 
```

我对 tikz 不太熟悉，但这确实给出了一个很好的时间表，如下所示：

![在此处输入图像描述](https://i.stack.imgur.com/8hk5B.png)

* * *

## 回答 #3

> 赞同：25
> 
> 时间：2013-07-25T12:06:59.587

Also the package [chronosys](http://www.ctan.org/pkg/chronosys) provides a nice solution. Here's an example from the user manual:

![在此处输入图像描述](https://i.stack.imgur.com/HaEgs.png)

* * *

## 回答 #4

> 赞同：16
> 
> 时间：2010-11-13T04:31:25.663

Just an update.

The present TiKZ package will issue: Package tikz Warning: Snakes have been superseded by decorations. Please use the decoration libraries instead of the snakes library on input line. . .

So the pertaining part of code has to be changed to:

```
\documentclass{article}
\usepackage{tikz}
\usetikzlibrary{decorations}
\begin{document}
\begin{tikzpicture}
%draw horizontal line
\draw (0,0) -- (2,0);
\draw[decorate,decoration={snake,pre length=5mm, post length=5mm}] (2,0) -- (4,0);
\draw (4,0) -- (5,0);
\draw[decorate,decoration={snake,pre length=5mm, post length=5mm}] (5,0) -- (7,0);

%draw vertical lines
\foreach \x in {0,1,2,4,5,7}
\draw (\x cm,3pt) -- (\x cm,-3pt);

%draw nodes
\draw (0,0) node[below=3pt] {$ 0 $} node[above=3pt] {$   $};
\draw (1,0) node[below=3pt] {$ 1 $} node[above=3pt] {$ 10 $};
\draw (2,0) node[below=3pt] {$ 2 $} node[above=3pt] {$ 20 $};
\draw (3,0) node[below=3pt] {$  $} node[above=3pt] {$  $};
\draw (4,0) node[below=3pt] {$ 5 $} node[above=3pt] {$ 50 $};
\draw (5,0) node[below=3pt] {$ 6 $} node[above=3pt] {$ 60 $};
\draw (6,0) node[below=3pt] {$  $} node[above=3pt] {$  $};
\draw (7,0) node[below=3pt] {$ n $} node[above=3pt] {$ 10n $};
\end{tikzpicture}

\end{document} 
```

HTH

* * *

## 回答 #5

> 赞同：15
> 
> 时间：2009-06-05T19:44:52.063

[Tim Storer](http://www.cs.st-andrews.ac.uk/~tws/) wrote a more flexible and nicer looking [`timeline.sty`](http://web.archive.org/web/20070717115907/http://www.cs.st-andrews.ac.uk/~tws/tools/latex/timeline.zip) (Internet Archive Wayback Machine link, as original is gone). In addition, the line is horizontal rather than vertical. So for instance:

```
\begin{timeline}{2008}{2010}{50}{250}
  \MonthAndYearEvent{4}{2008}{First Podcast}
  \MonthAndYearEvent{7}{2008}{Private Beta}
  \MonthAndYearEvent{9}{2008}{Public Beta}
  \YearEvent{2009}{IPO?}
\end{timeline} 
```

produces a timeline that looks like this:

```
2008                              2010
 · · April, 2008 First Podcast    ·
       · July, 2008 Private Beta
           · September, 2008 Public Beta
                · 2009 IPO? 
```

Personally, I find this a more pleasing solution than the other answers. But I also find myself modifying the code to get something closer to what I think a timeline should look like. So there's not definitive solution in my opinion.

* * *

## 回答 #6

> 赞同：12
> 
> 时间：2010-03-15T00:06:52.410

Firstly, I prefer `tikz` guided solution, because it gives you more freedom. Secondly, I'm not posting anything totally new. It is obviously similar to Zoe Gagnon's answer, because he showed the way.

I needed some year timeline and it took me some time (what a surprise!) to do it, so I'm sharing the results. I hope you'll like it.

```
\documentclass[tikz]{standalone}
\usepackage{verbatim}
\begin{document}
\newlength\yearposx
\begin{tikzpicture}[scale=0.57] % timeline 1990-2010->
    % define coordinates (begin, used, end, arrow)
    \foreach \x in {1990,1992,2000,2002,2004,2005,2008,2009,2010,2011}{
        \pgfmathsetlength\yearposx{(\x-1990)*1cm};
        \coordinate (y\x)   at (\yearposx,0);
        \coordinate (y\x t) at (\yearposx,+3pt);
        \coordinate (y\x b) at (\yearposx,-3pt);
    }
    % draw horizontal line with arrow
    \draw [->] (y1990) -- (y2011);
    % draw ticks
   \foreach \x in {1992,2000,2002,2004,2005,2008,2009}
        \draw (y\x t) -- (y\x b);
    % annotate
    \foreach \x in {1992,2002,2005,2009}
        \node at (y\x) [below=3pt] {\x};
    \foreach \x in {2000,2004,2008}
        \node at (y\x) [above=3pt] {\x};
    \begin{comment}
    % for use in beamer class
    \only<2>    {\fill      (y1992) circle (5pt);}
    \only<3-5>  {\fill      (y2000) circle (5pt);}
    \only<4-5>  {\fill      (y2002) circle (5pt);}
    \only<5>    {\fill[red] (y2004) circle (5pt);}
    \only<6>    {\fill      (y2005) circle (5pt);}
    \only<7>    {\fill[red] (y2005) circle (5pt);}
    \only<8-11> {\fill      (y2008) circle (5pt);}
    \only<11>   {\fill      (y2009) circle (5pt);}
    \end{comment}
\end{tikzpicture}
\end{document} 
```

As you can see, it's tailored to beamer presentation (select part and also scale option), but if you really want to test it in a presentation, then you should move `\newlength\yearposx` outside of the frame definition, because otherwise you'll get error veritably stating that command `\yearposx` is already defined (unless you remove the selection part and any other frame-splitting commands from your frame).

![在此处输入图像描述](https://i.stack.imgur.com/Tltvs.png)

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-04-08T09:12:45.713

有[timeline.sty](http://www.tex.ac.uk/tex-archive/macros/latex209/contrib/timeline/timeline.sty)漂浮。

语法比使用 tikz 更简单：

```
%%% In LaTeX:
%%% \begin{timeline}{length}(start,stop)
%%%   .
%%%   .
%%%   .
%%% \end{timeline}
%%%
%%% in plain TeX
%%% \timeline{length}(start,stop)
%%%   .
%%%   .
%%%   .
%%% \endtimeline
%%% in between the two, we may have:
%%% \item{date}{description}
%%% \item[sortkey]{date}{description}
%%% \optrule
%%%
%%% the options to timeline are:
%%%      length The amount of vertical space that the timeline should
%%%                use.
%%%      (start,stop) indicate the range of the timeline. All dates or
%%%                sortkeys should lie in the range [start,stop]
%%%
%%% \item without the sort key expects date to be a number (such as a
%%%      year).
%%% \item with the sort key expects the sort key to be a number; date
%%%      can be anything. This can be used for log scale time lines
%%%      or dates that include months or days.
%%% putting \optrule inside of the timeline environment will cause a
%%%      vertical rule to be drawn down the center of the timeline. 
```

我使用 python 的 datetime.data.toordinal 将日期转换为包上下文中的“排序键”。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-06-26T10:12:13.003

If you are looking for UML sequence diagrams, you might be interested in [pkf-umlsd](http://code.google.com/p/pgf-umlsd/), which is based on TiKZ. Nice demos can be found [here](http://www.texample.net/tikz/examples/pgf-umlsd/).

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2021-01-10T13:58:47.587

我一直在努力寻找一种合适的方法来创建时间线，我终于可以通过这个修改来做到这一点。通常在创建时间线时，问题是我无法添加文本来用更长的文本清楚地解释每个日期。我修改并进一步利用了@Zoe Gagnon 的乳胶脚本。请随时查看以下内容：

```
\documentclass{article}
\usepackage{tikz}
\usetikzlibrary{snakes}
\usepackage{rotating}

\begin{document}

\begin{center}
    \begin{tikzpicture}
        % draw horizontal line   
        \draw (-5,0) -- (6,0);

    % draw vertical lines
    \foreach \x in {-5,-4,-3,-2, -1,0,1,2}
    \draw (\x cm,3pt) -- (\x cm,-3pt);

    % draw nodes
    \draw (-5,0) node[below=3pt] {$ 0 $} node[above=3pt] {$  $};
    \draw (-4,0) node[below=3pt] {$ 1 $} node[above=3pt] {$\begin{turn}{45}
            All individuals vote
        \end{turn}$};
    \draw (-3,0) node[below=3pt] {$ 2 $} node[above=3pt] {$\begin{turn}{45} 
        Policy vector decided
        \end{turn}$};
    \draw (-2,0) node[below=3pt] {$ 3 $} node[above=3pt] {$\begin{turn}{45}  Becoming a bureaucrat \end{turn} $};
    \draw (-1,0) node[below=3pt] {$ 4 $} node[above=3pt] {$\begin{turn}{45} Bureaucrats' effort choice \end{turn}$};
    \draw (0,0) node[below=3pt] {$ 5 $} node[above=3pt] {$\begin{turn}{45} Tax evasion decision made \end{turn}$};
    \draw (1,0) node[below=3pt] {$  6$} node[above=3pt] {$\begin{turn}{45} $p(x_{t})$ tax evaders caught \end{turn}$};
    \draw (2,0) node[below=3pt] {$ 7 $} node[above=3pt] {$\begin{turn}{45} $q_{t}$ shirking bureaucrats \end{turn}$};
            \draw (3,0) node[below=3pt] {$ $} node[above=3pt] {$\begin{turn}{45} Public service provided  \end{turn}   $};
\end{tikzpicture}
\end{center} 
\end{document} 
```

不幸的是，不允许使用更长的文本。它看起来像这样：

[![上面时间线的视觉描述](https://i.stack.imgur.com/eS5Dl.png)](https://i.stack.imgur.com/eS5Dl.png)

# c# - .NET 自动生成的 Web 服务客户端：如何避免从 w3.org 请求模式？

> ID：217841
> 
> 赞同：2
> 
> 时间：2008-10-20T09:12:50.343
> 
> 标签：c#, .net, web-services, wsdl, offline

我有一个 .NET Web 服务客户端，它是使用 wsdl.exe 工具从 wsdl 文件自动生成的。

当我第一次实例化生成的类时，它开始从 w3.org 和其他网站请求一堆文档。第一个是[http://www.w3.org/2001/XMLSchema.dtd](http://www.w3.org/2001/XMLSchema.dtd)

除了不想对 w3.org 造成不必要的流量外，我还需要能够在没有连接到 Internet 的情况下运行应用程序（网络服务是“内部网络服务”）。

有人知道解决方案吗？

如果有帮助，这是我没有互联网时得到的堆栈跟踪：

```
"An error has occurred while opening external DTD 'http://www.w3.org/2001/XMLSchema.dtd': The remote name could not be resolved: 'www.w3.org'"

   at System.Net.HttpWebRequest.GetResponse()
   at System.Xml.XmlDownloadManager.GetNonFileStream(Uri uri, ICredentials credentials)
   at System.Xml.XmlDownloadManager.GetStream(Uri uri, ICredentials credentials)
   at System.Xml.XmlUrlResolver.GetEntity(Uri absoluteUri, String role, Type ofObjectToReturn)
   at System.Xml.XmlTextReaderImpl.OpenStream(Uri uri)
   at System.Xml.XmlTextReaderImpl.DtdParserProxy_PushExternalSubset(String systemId, String publicId)

   at System.Xml.XmlTextReaderImpl.Throw(Exception e)
   at System.Xml.XmlTextReaderImpl.DtdParserProxy_PushExternalSubset(String systemId, String publicId)
   at System.Xml.XmlTextReaderImpl.DtdParserProxy.System.Xml.IDtdParserAdapter.PushExternalSubset(String systemId, String publicId)
   at System.Xml.DtdParser.ParseExternalSubset()
   at System.Xml.DtdParser.ParseInDocumentDtd(Boolean saveInternalSubset)
   at System.Xml.DtdParser.Parse(Boolean saveInternalSubset)
   at System.Xml.XmlTextReaderImpl.DtdParserProxy.Parse(Boolean saveInternalSubset)
   at System.Xml.XmlTextReaderImpl.ParseDoctypeDecl()
   at System.Xml.XmlTextReaderImpl.ParseDocumentContent()
   at System.Xml.XmlTextReaderImpl.Read()
   at System.Xml.Schema.Parser.StartParsing(XmlReader reader, String targetNamespace)
   at System.Xml.Schema.Parser.Parse(XmlReader reader, String targetNamespace)
   at System.Xml.Schema.XmlSchemaSet.ParseSchema(String targetNamespace, XmlReader reader)
   at System.Xml.Schema.XmlSchemaSet.Add(String targetNamespace, XmlReader schemaDocument)
   at [...]WebServiceClientType..cctor() in [...] 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-20T11:31:05.807

如果您有权访问 XmlReader（或 XmlTextReader），则可以执行以下操作：

```
XmlReader r = ...
r.XmlResolver = null; // prevent xsd or dtd parsing 
```

问候，坦伯格

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-20T11:38:50.877

我需要 XmlResolver，所以[tamberg 的解决方案](https://stackoverflow.com/questions/217841/net-autogenerated-web-service-client-how-do-i-avoid-requesting-schemas-from-w3o#218105)不太奏效。我通过实现我自己的 XmlResolver 来解决它，它从嵌入式资源中读取必要的模式，而不是下载它们。

顺便说一句，这个问题与自动生成的代码没有任何关系。

web-service-client 有另一个实现文件，其中包含如下内容：

```
public partial class [...]WebServiceClientType
  {
    private static readonly XmlSchemaSet _schema;

    static KeyImportFileType()
    {
      _schema = new XmlSchemaSet();
      _schema.Add(null, XmlResourceResolver.GetXmlReader("http://www.w3.org/TR/2002/REC-xmldsig-core-20020212/xmldsig-core-schema.xsd"));
      _schema.Add(null, XmlResourceResolver.GetXmlReader("http://www.w3.org/TR/2002/REC-xmlenc-core-20021210/xenc-schema.xsd"));
      _schema.Compile();
    } 
```

正是这个类构造函数失败了。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-02-18T06:25:54.903

这是我的解决方案。我希望它可以让人们不必像我必须解决 XmlUrlResolver 的基础那样通过 .NET 框架进行调试。它将从本地资源（resx 文本文件）加载、缓存或使用 XmlUrlResolver 默认行为：

```
using System;
using System.Text;
using System.Text.RegularExpressions;
using System.Xml;
using System.Net;
using System.Net.Cache;
using System.IO;
using System.Resources;

namespace AxureExport {

    //
    // redirect URL resolution to local resource (or cache)
    public class XmlCustomResolver : XmlUrlResolver {

        ICredentials _credentials;
        ResourceManager _resourceManager;

        public enum ResolverType { useDefault, useCache, useResource };
        ResolverType _resolverType;

        public XmlCustomResolver(ResolverType rt, ResourceManager rm = null) {
            _resourceManager = rm != null ? rm : AxureExport.Properties.Resources.ResourceManager;
            _resolverType = rt;
        }

        public override ICredentials Credentials {
            set {
                _credentials = value;
                base.Credentials = value;
            }
        }

        public override object GetEntity(Uri absoluteUri, string role, Type ofObjectToReturn) {
            object response = null;

            if (absoluteUri == null)
                throw new ArgumentNullException(@"absoluteUri");

            switch (_resolverType) {
                default:
                case ResolverType.useDefault:                   // use the default behavior of the XmlUrlResolver
                    response = defaultResponse(absoluteUri, role, ofObjectToReturn);
                    break;

                case ResolverType.useCache:                     // resolve resources thru cache
                    if (!isExternalRequest(absoluteUri, ofObjectToReturn)) {
                        response = defaultResponse(absoluteUri, role, ofObjectToReturn);
                        break;
                    }

                    WebRequest webReq = WebRequest.Create(absoluteUri);
                    webReq.CachePolicy = new HttpRequestCachePolicy(HttpRequestCacheLevel.Default);
                    if (_credentials != null)
                        webReq.Credentials = _credentials;

                    WebResponse wr = webReq.GetResponse();
                    response = wr.GetResponseStream();
                    break;

                case ResolverType.useResource:                  // get resource from internal resource
                    if (!isExternalRequest(absoluteUri, ofObjectToReturn)) {
                        response = defaultResponse(absoluteUri, role, ofObjectToReturn);    // not an external request
                        break;
                    }

                    string resourceName = uriToResourceKey(absoluteUri);
                    object resource = _resourceManager.GetObject(resourceName);
                    if (resource == null)
                        throw new ArgumentException(@"Resource not found.  Uri=" + absoluteUri + @" Local resourceName=" + resourceName);

                    if (resource.GetType() != typeof(System.String))
                        throw new ArgumentException(resourceName + @" is an unexpected resource type.  (Are you setting resource FileType=Text?)");

                    response = ObjectToUTF8Stream(resource);
                    break;
            }

            return response;
        }

        //
        // convert object to stream
        private static object ObjectToUTF8Stream(object o) {
            MemoryStream stream = new MemoryStream();

            StreamWriter writer = new StreamWriter(stream, Encoding.UTF8);
            writer.Write(o);
            writer.Flush();
            stream.Position = 0;

            return stream;
        }

        //
        // default response is to call tbe base resolver
        private object defaultResponse(Uri absoluteUri, string role, Type ofObjectToReturn) {
            return base.GetEntity(absoluteUri, role, ofObjectToReturn);
        }

        //
        // determine whether this is an external request
        private static bool isExternalRequest(Uri absoluteUri, Type ofObjectToReturn) {
            return absoluteUri.Scheme == @"http" && (ofObjectToReturn == null || ofObjectToReturn == typeof(Stream));
        }

        //
        // translate uri to format compatible with reource manager key naming rules
        // see: System.Resources.Tools.StronglyTypedResourceBuilder.VerifyResourceName Method
        //   from http://msdn.microsoft.com/en-us/library/ms145952.aspx:
        private static string uriToResourceKey(Uri absoluteUri) {
            const string repl = @"[ \xA0\.\,\;\|\~\@\#\%\^\&\*\+\-\/\\\<\>\?\[\]\(\)\{\}\" + "\"" + @"\'\:\!]+";
            return Regex.Replace(Path.GetFileNameWithoutExtension(absoluteUri.LocalPath), repl, @"_");
        }
    }
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-27T11:56:51.570

谢谢 Tamberg，您简洁而正确的答案为我节省了大量时间。我没有意识到默认解析器会访问网络。检查 MSDN 是状态 -

> *XmlResolver 是 System.Xml 命名空间中所有类的默认解析器。您还可以创建自己的解析器...*

我已经实现了您的答案，将解析器设置为 NULL 以解决问题并减少网络开销。

```
XmlReader r = ...r.XmlResolver = null; // prevent xsd or dtd parsing 
```

再次感谢，安迪

# html - 如何将我的子弹图像与我的 内容？

> ID：217842
> 
> 赞同：3
> 
> 时间：2008-10-20T09:13:28.050
> 
> 标签：html, css

这是一个屏幕截图，以使其清楚。我正在尝试找出一种使子弹图像与我的 li 内容垂直对齐的可靠方法。如您所见，我的内容目前太高了。

非常感谢'over-flowers'...

[http://dl.getdropbox.com/u/240752/list-example.gif](http://dl.getdropbox.com/u/240752/list-example.gif)

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-20T09:18:42.687

好吧，一些 CSS 代码来看看你当前如何设置你的子弹图像会很有用;-)

我没有实际设置“list-style-image”属性，而是为 li 元素设置 background-image 属性得到了更加一致的结果。然后，您可以以像素精度控制定位。请记住设置一个合适的左填充值以将您的列表项内容从项目符号图像中清除。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-20T15:14:39.943

我喜欢@bryn 的回答。我成功使用的一个例子：

```
#content ul li {
    margin: 3px -20px 3px 20px;
    padding: 0 0 0 0;
    list-style: none;
    background: url(newbullet.gif) no-repeat 0 3px;
} 
```

在您的情况下，可能需要也可能不需要负右边距。您可能需要根据您的图像进行调整以满足您的特定需求。（我的图像是 14 x 15。）如果您想要跨浏览器的类似外观，您**必须**专门设置边距**和填充，因为 Firefox 和 IE 使用不同的默认值来显示项目符号。**

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-20T09:16:25.797

你可以在你的CSS中使用这样的东西......

```
#content li{

    list-style-image: url(../images/bullet.gif);

} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-20T09:22:28.343

使用背景图像，为您的 li 元素添加填充。

```
.box li{
    padding-left: 20px;
    background-image: url("img/list_icon.jpg");
    background-repeat: no-repeat;
    background-position: 0px 2px;
    margin-top: 6px;
} 
```

# windows-server-2008 - 网络服务器的日志文件中有 404 个 SysVol 条目

> ID：217849
> 
> 赞同：1
> 
> 时间：2008-10-20T09:15:46.250
> 
> 标签：windows-server-2008, webserver, http-status-code-404, domaincontroller

我们的 404 错误日志在我们的网站的 Windows Web Server 2008 上显示了很多 /SysVol http 请求。它只有一个网络服务器角色，我相信 SysVol 请求是针对域控制器的？是什么导致了这种情况，处理这些 404 请求的最佳解决方案是什么？

我正在使用通过 Active Directory (ldap) 访问员工记录的代码，如果这与问题有关，则服务器不受委托。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-10-20T09:32:46.747

这些请求是否来自外部 IP？他们可能正试图 p0wn 你

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-29T15:17:18.923

sysvol 共享通常在服务器升级为域控制器时创建和共享。我假设您的 Web 服务器不是 DC 并且不在 Active Directory 域中？

至于如何处理它，如果您在防火墙后面，您可以阻止除端口 80 和 443 之外的所有内容。我希望您的网络服务器位于防火墙后面。考虑到它在互联网上，看到这样的流量并不是那么不寻常。

# matlab - 如何将非常大的 MATLAB 稀疏矩阵保存到文本文件中？

> ID：217852
> 
> 赞同：17
> 
> 时间：2008-10-20T09:17:04.127
> 
> 标签：matlab, interop

我在 MATLAB（版本 7）中有一个 30000x14000 稀疏矩阵，我需要在另一个程序中使用它。调用 save 不会将其写为 ASCII（不支持）。调用`full()`这个怪物会导致 `Out of Memory`错误。
我如何导出它？

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2008-12-18T16:08:57.483

You can use find to get index & value vectors:

```
[i,j,val] = find(data)
data_dump = [i,j,val] 
```

You can recreate data from data_dump with spconvert, which is meant to "Import from sparse matrix external format" (so I guess it's a good export format):

```
data = spconvert( data_dump ) 
```

You can save to ascii with:

```
save -ascii data.txt data_dump 
```

But this dumps indices as double, you can write it out more nicely with fopen/fprintf/fclose:

```
fid = fopen('data.txt','w')
fprintf( fid,'%d %d %f\n', transpose(data_dump) )
fclose(fid) 
```

Hope this helps.

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-10-20T09:31:24.720

将稀疏矩阵保存为`.mat`文件。然后，在另一个程序中，使用合适的库来读取`.mat`文件。

例如，如果另一个程序是用 Python 编写的，您可以使用该`scipy.io.mio.loadmat`函数，该函数支持稀疏数组并为您提供稀疏的 numpy 矩阵。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-27T13:54:21.280

我在 MATLAB 中使用 Java 将其保存为文本。MATLAB 代码：

```
 pw=java.io.PrintWriter(java.io.FileWriter('c:\\retail.txt'));
line=num2str(0:size(data,2)-1);
pw.println(line);
for index=1:length(data)
    disp(index);
    line=num2str(full(data(index,:)));
    pw.println(line);
end
pw.flush();
pw.close(); 
```

这`data`是一个非常大的稀疏矩阵。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-20T09:28:57.177

你试过分区吗？

我的意思是尝试在前 1000 行（或 5000 行）上调用 full()，如果可行，则重复该过程。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-27T14:17:40.657

使用该`find`函数获取非零元素的索引...

```
idcs = find(data);
vals = data(idcs);
...save the index vector and value vector in whatever format you want... 
```

If you want, you can use `ind2sub` to convert the linear indices to row, column subscripts.

If you need to recreate a sparse matrix in matlab from subscripts + values, use `spconvert`.

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-09-12T06:49:01.043

**dlmwrite** - Write matrix to ASCII-delimited file Syntax

dlmwrite(filename, M)

dlmwrite(filename, M, 'D')

dlmwrite(filename, M, 'D', R, C)

dlmwrite(filename, M, 'attrib1', value1, 'attrib2', value2, ...)

dlmwrite(filename, M, '-append')

dlmwrite(filename, M, '-append', attribute-value list)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-20T11:41:45.910

如果这几乎是一次性交易，那么我只需遍历矩阵并通过蛮力将矩阵写入 ASCII 文件，或者使用 @ [Veynom 的](https://stackoverflow.com/questions/217852/saving-matlab-sparse-matrix-to-text-file#217885)建议并在行子集上调用 full()。这可能需要一段时间，但它可能会比学习如何在 MATLAB 环境之外读取 .mat 文件更快。

如果这是您需要经常做的事情，那么我会采纳[@Vebjorn](https://stackoverflow.com/questions/217852/saving-matlab-sparse-matrix-to-text-file#217891)的建议并使用库来读取 .mat 文件。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2019-01-20T00:31:36.327

Use this script: [msm_to_mm.m](https://groups.google.com/forum/#!search/spconvert/comp.soft-sys.matlab/J5VmFnqMoxQ/J181s16tMKkJ), writes an MATLAB sparse matrix to an MatrixMarket file.

And This [thread](https://groups.google.com/forum/#!search/spconvert/comp.soft-sys.matlab/J5VmFnqMoxQ/J181s16tMKkJ) may also be useful.

# datetime - 代表一天的最佳格式是什么？

> ID：217853
> 
> 赞同：4
> 
> 时间：2008-10-20T09:17:26.590
> 
> 标签：datetime, representation

如何表示一天的开始和结束时间？

以 2008 年 10 月 23 日为例，它是从 2008-10-23 12:00:00 AM 开始到 2008-10-23 11:59:59 PM 结束吗？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-10-20T09:24:01.053

我想引用一个网站，[http://www.cl.cam.ac.uk/~mgk25/iso-time.html](http://www.cl.cam.ac.uk/~mgk25/iso-time.html)

一天中时间的国际标准符号是

```
hh:mm:ss 
```

其中 hh 是自午夜 (00-24) 以来经过的完整小时数，mm 是自一小时开始 (00-59) 以来经过的完整分钟数，ss 是自午夜 (00-59) 以来经过的完整秒数分钟的开始 (00-60)。如果小时值为 24，则分钟和秒值必须为零。

注意： ss 的值 60 有时可能需要在原子时间尺度（如协调世界时 (UTC)）中插入闰秒。正如巴黎国际地球自转服务所宣布的那样，每隔几年将一个闰秒 23:59:60 插入 UTC 时间尺度，以防止 UTC 偏离不太恒定的天文时间尺度 UT1 超过 0.9 秒，这由地球的实际自转定义。实际上，您不太可能看到时钟显示 23:59:60。大多数同步时钟在闰秒发生后的某个时间再次与 UTC 重新同步，或者它们在闰秒时间附近暂时放慢速度，以避免超出范围的时间戳可能导致的任何中断。

一个示例时间是

```
23:59:59 
```

表示午夜前一秒的时间。

与日期符号一样，分隔冒号也可以省略，如

```
235959 
```

并且可以通过省略秒或秒和分钟来降低精度，如

```
23:59, 2359, or 23 
```

也可以在小数点或逗号后添加秒的小数部分，例如午夜前 5.8 毫秒的时间可以写为

```
23:59:59.9942 or 235959.9942 
```

由于每一天都以午夜开始和结束，因此可以使用两种符号 00:00 和 24:00 来区分可以与一个日期相关联的两个午夜。这意味着以下两个符号指的是完全相同的时间点：

```
1995-02-04 24:00 = 1995-02-05 00:00 
```

如果需要明确表示时间，00:00 通常是午夜而不是 24:00 的首选表示法。数字时钟显示 00:00 而不是 24:00。

ISO 8601 does not specify, whether its notations specify a point in time or a time period. This means for example that ISO 8601 does not define whether 09:00 refers to the exact end of the ninth hour of the day or the period from 09:00 to 09:01 or anything else. The users of the standard must somehow agree on the exact interpretation of the time notation if this should be of any concern.

If a date and a time are displayed on the same line, then always write the date in front of the time. If a date and a time value are stored together in a single data field, then ISO 8601 suggests that they should be separated by a latin capital letter T, as in 19951231T235959.

A remark for readers from the U.S.:

The 24h time notation specified here has already been the de-facto standard all over the world in written language for decades. The only exception are a few English speaking countries, where still notations with hours between 1 and 12 and additions like “a.m.” and “p.m.” are in wide use. The common 24h international standard notation is widely used now even in England (e.g. at airports, cinemas, bus/train timetables, etc.). Most other languages do not even have abbreviations like “a.m.” and “p.m.” and the 12h notation is certainly hardly ever used on Continental Europe to write or display a time. Even in the U.S., the military and computer programmers have been using the 24h notation for a long time.

The old English 12h notation has many disadvantages like:

*   It is longer than the normal 24h notation.
*   It takes somewhat more time for humans to compare two times in 12h notation.
*   It is not clear, how 00:00, 12:00 and 24:00 are represented. Even encyclopedias and style manuals contain contradicting descriptions and a common quick fix seems to be to avoid “12:00 a.m./p.m.” altogether and write “noon”, “midnight”, or “12:01 a.m./p.m.” instead, although the word “midnight” still does not distinguish between 00:00 and 24:00 (midnight at the start or end of a given day).
*   It makes people often believe that the next day starts at the overflow from “12:59 a.m.” to “1:00 a.m.”, which is a common problem not only when people try to program the timer of VCRs shortly after midnight.
*   It is not easily comparable with a string compare operation.
*   It is not immediately clear for the unaware, whether the time between “12:00 a.m./p.m.” and “1:00 a.m./p.m.” starts at 00:00 or at 12:00, i.e. the English 12h notation is more difficult to understand.

Please consider the 12h time to be a relic from the dark ages when Roman numerals were used, the number zero had not yet been invented and analog clocks were the only known form of displaying a time. Please avoid using it today, especially in technical applications! Even in the U.S., the widely respected Chicago Manual of Style now recommends using the international standard time notation in publications.

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-20T09:47:53.457

Surely, if you just want to represent 1 day, you don't need to include the time at all - especially as this raises such a level of discussion about when a day starts or ends. In my experience, date handling is usually complicated enough, without introducing any extra complexity.

Today is Oct 20th 2008 - no more information is necessary.

Or am I missing something?

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-20T09:40:02.193

Oct. 23 starts at 2008-10-23 12AM and finishes at 2008-10-24 12AM—a day ends at the exact same point the next one begins. The very last second begins at 11:59:59 PM but you still have a whole second before the day is over.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-20T09:26:03.017

Your notation is strange. I'd suggest the standard way of specifying a full day range is:

2008-10-23 00:00:00 and finish 2008-10-23 23:59:59

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-20T09:27:49.097

The definition of the day you mention in the question is any time that is >= 2008-10-23 00:00:00 and < 2008-10-24 00:00:00 .

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-20T10:20:57.010

If you were to use mathematical interval notation, you would write it as

> [2008-10-23 00:00:00 , 2008-10-24 00:00:00)

The **[** means inclusion, and **)** means up to but not including.

In this way you make it easier for users and for yourself.

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-20T10:41:18.747

It depends what you mean by a day. Date handling is, sadly, always more complex than it looks.

To convert your example into 24h ISO date format, you'd say:

```
2008-10-23 00:00:00 - 2008-10-23 23:59:59 
```

However depending on whether you interpret a range as inclusive or exclusive that could omit the last second of the day*. Programmers normally prefer to keep the upper bound exclusive, so you'd go for:

```
2008-10-23 00:00:00 - 2008-10-24 00:00:00 
```

Or, as a slightly nicer way of stating the same, if supported (or for human readability):

```
2008-10-23 00:00:00 - 2008-10-23 24:00:00 
```

*: actually possibly more than one. If the span represents a day in the UTC timezone (or another timezone aligned to it, which is quite likely), there can occasionally be an extra 'leap second' at the end of the day, 23:59:60, in a pointless attempt to keep UTC in line with sidereal time. The next leap second is planned for the end of this year. However, many systems ignore leap seconds because they're silly and annoying.

If you want to represent a 'calendar day' independently of timezones your best bet is the Julian day number. Today is 2454760.

# actionscript-3 - Flex DRAG_DROP 事件 - 是否可以访问被拖动的图像？

> ID：217859
> 
> 赞同：3
> 
> 时间：2008-10-20T09:19:43.917
> 
> 标签：actionscript-3, apache-flex

当您启动 Flex 拖动操作时，您会传入一个代理图像，以便在您在屏幕上拖动时显示。当下降发生时，我希望能够抓住这个代理，但我找不到从 DragEvent 对象中获取的方法。

可能吗？我想要的是在释放鼠标按钮时实际放下拖动的图像...... Flex 会自动在代理上做一个很好的收缩动画，但我不希望那样。

[Flex 示例](http://livedocs.adobe.com/flex/3/html/help.html?content=dragdrop_7.html)显示了我不想要的内容 - 代理已删除并添加了新图像，但位置不正确......

更多信息：我尝试将代理图像作为数据项添加到 DragSource。发生下降时我能够访问它并看到有一个类 mx.managers.dragClasses.DragProxy 似乎有我需要的所有信息......但是这个类没有记录吗？

所以真的有两个问题......如何获取代理并找出鼠标光标在代理中的位置，以及如何禁用 Flex 拖放动画。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2011-10-13T04:25:43.380

为了禁用 s:List 中的动画，在 dragCompleteHandler 覆盖中，您可以“破解”到 DragManager 以获取 dragProxy 并将其隐藏。

```
override protected function dragCompleteHandler(e:DragEvent):void
{
  DragManager.mx_internal::dragProxy.visible = false; // <- MAGIC!
  super.dragCompleteHandler(e);
} 
```

可能适用于其他情况。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-20T13:57:38.723

dragProxy 是 DragManager 上的静态 getter，范围为 mx_internal。因此，要引用它，您必须执行以下操作：

```
import mx_internal; 
```

在拖动事件处理程序中：

```
var p:* = DragManager.mx_internal::dragProxy; 
```

我不知道你怎么能阻止动画。如果我发现了，我会告诉你的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-16T19:21:48.717

至于让代理的鼠标坐标将其放置在正确的位置，请尝试以下操作：

假设您在 mouseDown 上启动拖动，在您的处理程序中使用 e.currentTarget.contentMouseX 和 e.currentTarget.contentMouseY 获取坐标。然后将这些添加到dragSource（我将其作为对象），例如：

```
var drgSrc:DragSource = new DragSource();
drgSrc.addData( { x:e.currentTarget.contentMouseX, y:e.currentTarget.contentMouseY }, 'drgXY' ); 
```

然后在您的放置处理程序中（假设您将其放入名为 drpCvs 的画布中）：

```
var newImg:Image = new Image();
newImg.x = drpCvs.contentMouseX - e.dragSource.dataForFormat( 'drgXY' ).x;
newImg.y = drpCvs.contentMouseY - e.dragSource.dataForFormat( 'drgXY' ).y; 
```

我在寻找摆脱收缩动画的方法时发现了这一点，所以谢谢。以为我会RTF。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-06T20:54:19.283

防止动画的唯一方法：

- 你必须修改 DragProxy 类（即创建一个具有相同名称、代码和包结构的新类），并从 mouseUpHandler() 中删除效果代码。

据我所知，没有其他方法可以覆盖它，尽管该问题在一年前已作为错误提交给 Adob​​e。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-28T20:28:31.510

如果你只是想阻止动画，最简单（hackiest）的方法是：创建你自己的代理并添加一个 MOUSE_UP 处理程序到触发时将代理的可见属性设置为 false 的阶段。它实际上不会停止动画，它只会在动画发生时隐藏代理。像这样的东西：

```
var proxy:UIComponent = new UIComponent();
proxy.graphics.lineStyle(1);
proxy.graphics.beginFill(0xccddff);
proxy.graphics.drawRect(0, 0, main.width, main.height);
stage.addEventListener(MouseEvent.MOUSE_UP, function (e:MouseEvent):void {
  proxy.visible = false;
}); 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-10-25T01:12:02.320

Setting

```
event.dragInitiator.visible = false; 
```

in the drag drop handler works for me!

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-10-18T10:17:01.510

我关闭动画的解决方案是在我的自定义 ListItemDragProxy 组件中设置 visible=0 onMouseUp。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-03-10T03:52:12.377

@ykessler：谢谢，猴子补丁就像一个魅力。 [SDK：DragProxy.as](http://opensource.adobe.com/svn/opensource/flex/sdk/branches/3.4.0/frameworks/projects/framework/src/mx/managers/dragClasses/DragProxy.as)

@Alvaro：我相信这种方法会导致竞争状况。我试过了，它只是有时有效。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-10-14T08:28:40.980

我的解决方案是删除 SandboxRoot 上的 MouseUp-Handler 并在目标的 dragEnterHandler 中附加一个自己的 MouseUp-Handler，如下所示：

```
protected function dragEnterHandler(event:DragEvent):void{

        DragManager.acceptDragDrop(this);

        this.dragProxy = DragManager.mx_internal::dragProxy;// get drag proxy

        var sm:ISystemManager = event.dragInitiator.systemManager.topLevelSystemManager as ISystemManager;
        var ed:IEventDispatcher = sm.getSandboxRoot();
        this.sandboxRoot = sm.getSandboxRoot();
        //remove
        ed.removeEventListener(MouseEvent.MOUSE_UP, dragProxy.mouseUpHandler, true);

        //attach own
        ed.addEventListener(MouseEvent.MOUSE_UP, mouseUpHandler, true);
        ed.addEventListener(MouseEvent.MOUSE_MOVE, mouseMoveHandler);

        this.dragInitiator = event.dragInitiator;} 
```

在 mouseUpHandler 中，我从原始 DragProxy.as 实现了函数 mouseUpHandler 的副本，并删除了 Drop-Effect。

# c# - 如何显示任务栏通知？

> ID：217871
> 
> 赞同：3
> 
> 时间：2008-10-20T09:23:31.867
> 
> 标签：c#, .net, taskbar

如何显示任务栏通知？

我想编写一个定期显示闪存卡式通知的应用程序，目的是查看每小时 5 秒左右的分心是否有助于语言学习。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-20T09:25:44.110

在 .NET 中，您可以使用[通知图标](http://msdn.microsoft.com/en-us/library/aa972170.aspx)在系统托盘中放置通知。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-20T09:41:07.073

对于您描述的应用程序，我可能不会使用通知图标或任务栏图标。您可能需要显示更大的窗口和更大的字体。

我会打开一个位于桌面左下角的无框窗口（可能会褪色或滚动到视图中）。（当然请记住，不是每个人都有屏幕底部的任务栏）。

例如，看看 Outlook 或许多 RSS 阅读器如何通知新消息 - 此功能通常称为“toast”弹出窗口。

# python - 字符串简单替换

> ID：217881
> 
> 赞同：0
> 
> 时间：2008-10-20T09:27:08.770
> 
> 标签：python, string

将大多数用户习惯的更简单的正则表达式格式转换为正确的 re python 正则表达式字符串的最简单方法是什么？

例如，我需要将其转换为：

```
string = "*abc+de?" 
```

对此：

```
string = ".*abc.+de.?" 
```

当然，我可以遍历字符串并逐个字符地构建另一个字符串，但这肯定是一种低效的方法吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-20T11:29:13.267

这些看起来不像您要翻译的正则表达式，它们看起来更像是 unix shell glob。Python 已经有一个[模块](http://www.python.org/doc/2.5.2/lib/module-fnmatch.html)可以做到这一点。它不知道您使用的“+”语法，但我的 shell 也不知道，我认为语法是非标准的。

```
>>> import fnmatch
>>> fnmatch.fnmatch("fooabcdef", "*abcde?")
True
>>> help(fnmatch.fnmatch)
Help on function fnmatch in module fnmatch:

fnmatch(name, pat)
    Test whether FILENAME matches PATTERN.

    Patterns are Unix shell style:

    *       matches everything
    ?       matches any single character
    [seq]   matches any character in seq
    [!seq]  matches any char not in seq

    An initial period in FILENAME is not special.
    Both FILENAME and PATTERN are first case-normalized
    if the operating system requires it.
    If you don't want this, use fnmatchcase(FILENAME, PATTERN).

>>> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-20T10:13:13.983

.replacing() 每个通配符都是快速的方法，但是如果通配符字符串包含其他正则表达式特殊字符怎么办？例如。搜索“my.thing*”的人可能并不意味着“。” 匹配任何字符。在最坏的情况下，诸如匹配组创建括号之类的事情可能会破坏您对正则表达式匹配的最终处理。

re.escape 可用于将文字字符放入正则表达式。不过，您必须先拆分通配符。通常的技巧是将 re.split 与匹配的括号一起使用，从而生成 [literal, wildcard, literal, wildcard, literal...] 形式的列表。

示例代码：

```
wildcards= re.compile('([?*+])')
escapewild= {'?': '.', '*': '.*', '+': '.+'}

def escapePart((parti, part)):
    if parti%2==0: # even items are literals
        return re.escape(part)
    else: # odd items are wildcards
        return escapewild[part]

def convertWildcardedToRegex(s):
    parts= map(escapePart, enumerate(wildcards.split(s)))
    return '^%s$' % (''.join(parts)) 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-20T09:51:47.457

您可能只会偶尔进行这种替换，例如每次用户输入新的搜索字符串时，所以我不会担心解决方案的效率如何。

您需要生成从“用户格式”转换为正则表达式所需的替换列表。为了便于维护，我会将它们存储在字典中，就像@Konrad Rudolph 一样，我只会使用 replace 方法：

```
def wildcard_to_regex(wildcard):
    replacements = {
        '*': '.*',
        '?': '.?',
        '+': '.+',
        }
    regex = wildcard
    for (wildcard_pattern, regex_pattern) in replacements.items():
        regex = regex.replace(wildcard_pattern, regex_pattern)
    return regex 
```

`wildcard_to_regex`请注意，这仅适用于简单的字符替换，尽管如有必要，至少可以将其他复杂的代码隐藏在函数中。

（另外，我不确定这`?`应该转化为`.?`——我认为普通的通配符具有`?`“恰好一个字符”，所以它的替换应该很简单`.`——但我正在按照你的例子。）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-20T09:35:04.683

我会使用[`replace`](http://www.python.org/doc/2.5.2/lib/string-methods.html#l2h-255)：

```
def wildcard_to_regex(str):
    return str.replace("*", ".*").replace("?", .?").replace("#", "\d") 
```

这可能不是最有效的方法，但对于大多数用途来说应该足够有效。请注意，某些通配符格式允许更难处理的字符类。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-20T09:44:38.003

这是执行此操作的[Perl 示例](http://www.unix.com.ua/orelly/perl/cookbook/ch06_10.htm)。它只是使用一个表将每个通配符构造替换为相应的正则表达式。我以前自己做过这个，但是在 C 中。移植到 Python 应该不会太难。

# c# - 使用 C# 显示 powerpoint

> ID：217890
> 
> 赞同：9
> 
> 时间：2008-10-20T09:31:10.277
> 
> 标签：c#, .net, powerpoint

有没有什么好方法可以使用用 C# 编写的 Windows 应用程序来显示/控制 powerpoint 幻灯片？最终，我想在表单中显示缩略图，单击这些缩略图将推进在第二台显示器上显示的幻灯片（类似于使用 Powerpoint 本身在第二台显示器上显示幻灯片）。

如果没有安装 Powerpoint，我希望能够使用 Powerpoint Viewer。

似乎有一些允许将 Powerpoint 集成到表单中的 ActiveX 控件，但其中大多数似乎要花钱，有人有使用这些控件的经验吗？

编辑：我知道可以通过添加对 Microsoft.Office.InterOp.Powerpoint 的引用来访问对象模型，但我希望能够在没有 Microsoft Office 作为先决条件的情况下分发生成的程序，这就是我提到 Powerpoint Viewer 的原因因为它可以自由分发。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-07-29T22:22:22.177

这个 kb 列出了使用 powerpoint 演示查看器对象模型的基础知识。我建议您在分发应用程序时包含查看器。

[http://support.microsoft.com/kb/265385](http://support.microsoft.com/kb/265385)

一旦获得对查看器（顶级）对象的引用，它基本上与使用 powerpoint.presentation 对象模型相同，但功能较少（即编辑等）

如果您使用的是 Powerpoint 2007，则可以通过使用 System.XML 和相关命名空间来添加编辑功能，以将演示文件作为打开的 xml 文件进行处理。

关于 UNO/openoffice.org 的评论，我认为这些都没有抓住重点，因为你不能使用 UNO 来处理 powerpoint，它是用于 openoffice 的，这不是提问者的原始要求。

有像 aspose 这样的 3rd 方工具集，但是您的目标是使用 powerpoint 查看器组件（免费），所以我猜您想避免为开发工具付费？无论哪种方式查看器组件 OM 都非常适合显示和预览以及现有的幻灯片放映。（您将需要一份 Powerpoint 副本，以便您可以从头开始创作演示文稿，还需要 Visual Studio 来创建 VSTO 项目）。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-20T09:41:51.877

我们在这里工作的软件之一就是这样做的。最初我们使用 MS Office，但最近我们改用[OpenOffice.org Uno](http://udk.openoffice.org/)，因为它提供比 MS Office 更好的控制并且更易于使用。它有[.NET CLI 绑定](http://wiki.services.openoffice.org/wiki/Uno/CLI)。

要回答您的问题，可以，但我们的工程师会建议您改用 OpenOffice.org。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-20T13:20:53.323

就像 Microsoft Excel 和 Word 一样，Powerpoint 有一个对象模型，您可以通过在项目中包含以下引用来在代码中访问它：

Microsoft.Office.InterOp.Powerpoint。

我使用过 Excel 和 Word 模型，但没有使用过 Powerpoint 模型。包含参考后，您可以通过打开对象浏览器来稍微了解可用的功能，以查看可用的功能类型。如果您不想使用 3rd 方工具访问对象模型，这对您来说可能是一个可行的解决方案。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-20T12:39:51.470

我使用了 Aspose 的 Word 工具包——他们也有一个我认为值得一看的 Powerpoint 工具包。

[http://www.aspose.com/categories/file-format-components/aspose.slides-for-.net-and-java/default.aspx](http://www.aspose.com/categories/file-format-components/aspose.slides-for-.net-and-java/default.aspx)

# c++ - 什么是非空 STL 擦除的安全等价物？

> ID：217892
> 
> 赞同：4
> 
> 时间：2008-10-20T09:31:54.940
> 
> 标签：c++, stl, iterator, hashmap

假设我有一个 hash_map 和一个类似的代码

```
// i is an iterator
i = hash_map.erase(i) 
```

但是 GCC 的 STL 不会在擦除时返回迭代器，而是一个 void。现在是这样的代码

```
hash_map.erase(i++) 
```

安全（即不会使迭代器无效或做任何其他意外或不愉快的事情）？请注意这是一个 hash_map。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-20T09:38:42.227

是的，这是安全的，因为在`i`删除当前值之前， 的值将被设置为下一个值。

根据[关于散列容器失效的 SGI 文档，](http://www.sgi.com/tech/stl/HashedAssociativeContainer.html)对于未擦除的元素，甚至调整大小都不会发生（没有关于插入是否会导致调整大小的消息，所以要小心，我承认这是一种可能性）---但是在后一种情况，迭代顺序将被改变。但这不适用于这里，除非您在遍历或其他情况下不遗余力地调整容器的大小。:-)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-02-20T21:04:27.117

您可以封装擦除为您使用的所有容器提供相同的接口：

```
namespace detail {
template<typename Container, typename R>
struct SelectErase {
  // by default, assume the next iterator is returned
  template<typename Iterator>
  Iterator erase(Container& c, Iterator where) {
    return c.erase(where);
  }
};
// specialize on return type void
template<typename Container>
struct SelectErase<Container, void> {
  template<typename Iterator>
  Iterator erase(Container& c, Iterator where) {
    Iterator next (where);
    ++next;
    c.erase(where);
    return next;
  }
};

template<typename I, typename Container, typename R>
SelectErase<Container,R> select_erase(R (Container::*)(I)) {
  return SelectErase<Container,R>();
}
} // namespace detail

template<typename Container, typename Iterator>
Iterator erase(Container& container, Iterator where) {
  return detail::select_erase<Iterator>(&Container::erase).erase(container, where);
} 
```

这需要：

1.  c.erase 返回下一项的迭代器。这就是向量、双端队列和列表的工作方式。
2.  c.erase 返回 void 并且不会使下一个迭代器无效。这就是 map、set 和（非标准库）hash_map 的工作方式。

* * *

## 回答 #3

> 赞同：-4
> 
> 时间：2008-10-21T01:30:53.897

讨厌在游行中下雨，但我认为你的提议并不安全。

i++ 是后自增运算符，这意味着 i 在调用擦除后自增。但是擦除使所有指向被擦除元素的迭代器无效。因此，当 i 增加时，它不再有效。

如果你幸运的话，它可能会意外地正常工作，直到有一天它不再起作用。

据我所知，没有办法解决这个问题，但类似：

```
// tmp and i are both iterators
tmp = i;
++i;
hash_map.erase(tmp); 
```

# python - 如何为方法生成单元测试代码

> ID：217900
> 
> 赞同：3
> 
> 时间：2008-10-20T09:36:51.467
> 
> 标签：python, unit-testing

我想为单元测试编写代码来测试我的应用程序代码。我有不同的方法，现在想在 python 脚本中一一测试这些方法。但我不知道我该怎么写。谁能给我在python中进行单元测试的小代码示例。我很感激

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-20T09:48:11.507

阅读[Python 库参考](http://www.python.org/doc/2.5.2/lib/lib.html)的[单元测试框架部分](http://www.python.org/doc/2.5.2/lib/module-unittest.html)。

文档中的一个[基本示例](http://www.python.org/doc/2.5.2/lib/minimal-example.html)：

```
import random
import unittest

class TestSequenceFunctions(unittest.TestCase):

    def setUp(self):
        self.seq = range(10)

    def testshuffle(self):
        # make sure the shuffled sequence does not lose any elements
        random.shuffle(self.seq)
        self.seq.sort()
        self.assertEqual(self.seq, range(10))

    def testchoice(self):
        element = random.choice(self.seq)
        self.assert_(element in self.seq)

    def testsample(self):
        self.assertRaises(ValueError, random.sample, self.seq, 20)
        for element in random.sample(self.seq, 5):
            self.assert_(element in self.seq)

if __name__ == '__main__':
    unittest.main() 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-20T13:46:52.367

最好从给定的`unittest`示例开始。一些标准的最佳实践：

*   将所有测试放在`tests`项目根目录下的文件夹中。
*   为您正在测试的每个 python 模块编写一个测试模块。
*   测试模块应该以单词开头`test`。
*   测试方法应该以单词开头`test`。

当您已经习惯了`unittest`（并且应该不会花很长时间）时，有一些不错的扩展可以随着您的测试数量和范围的增加而使生活变得更轻松：

*   [鼻子](http://somethingaboutorange.com/mrl/projects/nose/)- 轻松找到并运行所有测试，等等。
*   [testoob](http://testoob.sourceforge.net/) - 彩色输出（还有更多，但这就是我使用它的原因）。
*   [pythoscope](http://pythoscope.org/) - 没有尝试过，但这会自动为您的应用程序生成（失败）测试存根。应该可以节省大量编写样板代码的时间。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-20T09:49:29.100

这是一个[示例](http://www.python.org/doc/2.5.2/lib/minimal-example.html)，您可能想阅读更多关于[python 单元测试](http://www.python.org/doc/2.5.2/lib/module-unittest.html)的内容。

# c++ - c++模板函数重载

> ID：217901
> 
> 赞同：3
> 
> 时间：2008-10-20T09:36:52.463
> 
> 标签：c++, templates

以下是“c++ 编程语言”中的几行

```
template<class T > T sqrt(T );
template<class T > complex<T> sqrt(complex<T>);
double sqrt(double);
void f(complex<double> z )
{
s q r t (2 ); // sqrt<int>(int)
sqrt(2.0) ; // sqrt(double)
sqrt(z) ; // sqrt<double>(complex<double>)
} 
```

我不明白为什么 sqrt(z) ；电话`sqrt<double>(complex<double>)`可以任何机构请解释。

作者说， `T sqrt<complex<T>>` 比更专业，`T sqrt <T>`但有一个单独的声明`template<class T > complex<T> sqrt(complex<T>);`为什么不使用它？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-20T09:55:58.527

事后看来，如果 Bjarne 将其写为

```
template<class T> T sqrt(T);
template<class U> complex<U> sqrt(complex<U>);
double sqrt(double);
void f(complex<double> z )
{
    sqrt (2); // sqrt<int>(int)
    sqrt(2.0) ; // sqrt(double)
    sqrt(z) ; // sqrt<double>(complex<double>)
} 
```

so you don't get confused by all the different T's. But the idea is simple; C++ finds the best match. There are three possible functions. The first two are perfect matches (no conversion needed) so the non-template version is ignored. Now, we have T=complex and U=double. Which version is chosen? Bjarne explains the second template is chosen here, because it's more specialized. This means that for any type U, there is a type `T=complex<U>` which makes the signatures of both templates identical.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-20T09:47:13.863

好吧，使用的函数就是您正在谈论`sqrt<double>(complex<double>)`的那个模板的实例`template <class T> complex<T> sqrt(complex<T>)`。

您的误解在于模板实例的含义，而不是重载过程。

# c# - 读/写一个INI文件

> ID：217902
> 
> 赞同：284
> 
> 时间：2008-10-20T09:37:22.383
> 
> 标签：c#, .net, ini

.NET 框架中是否有可以读/写标准 .ini 文件的类：

```
[Section]
<keyname>=<value>
... 
```

Delphi 有这个`TIniFile`组件，我想知道 C# 是否有类似的东西？

* * *

## 回答 #1

> 赞同：260
> 
> 时间：2013-02-16T02:52:39.737

## Preface

Firstly, read this MSDN blog post on [the limitations of INI files](https://blogs.msdn.microsoft.com/oldnewthing/20071126-00/?p=24383/). If it suits your needs, read on.

This is a concise implementation I wrote, utilising the original Windows P/Invoke, so it is supported by all versions of Windows with .NET installed, (i.e. Windows 98 - Windows 10). I hereby release it into the public domain - you're free to use it commercially without attribution.

## The tiny class

Add a new class called `IniFile.cs` to your project:

```
using System.IO;
using System.Reflection;
using System.Runtime.InteropServices;
using System.Text;

// Change this to match your program's normal namespace
namespace MyProg
{
    class IniFile   // revision 11
    {
        string Path;
        string EXE = Assembly.GetExecutingAssembly().GetName().Name;

        [DllImport("kernel32", CharSet = CharSet.Unicode)]
        static extern long WritePrivateProfileString(string Section, string Key, string Value, string FilePath);

        [DllImport("kernel32", CharSet = CharSet.Unicode)]
        static extern int GetPrivateProfileString(string Section, string Key, string Default, StringBuilder RetVal, int Size, string FilePath);

        public IniFile(string IniPath = null)
        {
            Path = new FileInfo(IniPath ?? EXE + ".ini").FullName;
        }

        public string Read(string Key, string Section = null)
        {
            var RetVal = new StringBuilder(255);
            GetPrivateProfileString(Section ?? EXE, Key, "", RetVal, 255, Path);
            return RetVal.ToString();
        }

        public void Write(string Key, string Value, string Section = null)
        {
            WritePrivateProfileString(Section ?? EXE, Key, Value, Path);
        }

        public void DeleteKey(string Key, string Section = null)
        {
            Write(Key, null, Section ?? EXE);
        }

        public void DeleteSection(string Section = null)
        {
            Write(null, null, Section ?? EXE);
        }

        public bool KeyExists(string Key, string Section = null)
        {
            return Read(Key, Section).Length > 0;
        }
    }
} 
```

## How to use it

Open the INI file in one of the 3 following ways:

```
// Creates or loads an INI file in the same directory as your executable
// named EXE.ini (where EXE is the name of your executable)
var MyIni = new IniFile();

// Or specify a specific name in the current dir
var MyIni = new IniFile("Settings.ini");

// Or specify a specific name in a specific dir
var MyIni = new IniFile(@"C:\Settings.ini"); 
```

You can write some values like so:

```
MyIni.Write("DefaultVolume", "100");
MyIni.Write("HomePage", "http://www.google.com"); 
```

To create a file like this:

```
[MyProg]
DefaultVolume=100
HomePage=http://www.google.com 
```

To read the values out of the INI file:

```
var DefaultVolume = MyIni.Read("DefaultVolume");
var HomePage = MyIni.Read("HomePage"); 
```

Optionally, you can set `[Section]`'s:

```
MyIni.Write("DefaultVolume", "100", "Audio");
MyIni.Write("HomePage", "http://www.google.com", "Web"); 
```

To create a file like this:

```
[Audio]
DefaultVolume=100

[Web]
HomePage=http://www.google.com 
```

You can also check for the existence of a key like so:

```
if(!MyIni.KeyExists("DefaultVolume", "Audio"))
{
    MyIni.Write("DefaultVolume", "100", "Audio");
} 
```

You can delete a key like so:

```
MyIni.DeleteKey("DefaultVolume", "Audio"); 
```

You can also delete a whole section (including all keys) like so:

```
MyIni.DeleteSection("Web"); 
```

Please feel free to comment with any improvements!

* * *

## 回答 #2

> 赞同：201
> 
> 时间：2008-10-20T09:42:20.923

.NET 框架的创建者希望您使用基于 XML 的配置文件，而不是 INI 文件。所以不，没有用于读取它们的内置机制。

不过，有第三方解决方案可用。

*   INI 处理程序可以作为[NuGet 包](https://www.nuget.org/packages?q=ini)获得，例如[INI Parser](https://www.nuget.org/packages/ini-parser/)。
*   您可以编写自己的 INI 处理程序，这是老式的、费力的方式。它使您可以更好地控制实现，您可以将其用于坏处或好处。参见例如[使用 C#、P/Invoke 和 Win32 的 INI 文件处理类](http://www.codeproject.com/KB/cs/cs_ini.aspx)。

* * *

## 回答 #3

> 赞同：66
> 
> 时间：2008-10-20T09:42:55.993

CodeProject 上的这篇文章“[使用 C# 的 INI 文件处理类](http://www.codeproject.com/KB/cs/cs_ini.aspx)”应该会有所帮助。

作者创建了一个 C# 类“Ini”，它公开了 KERNEL32.dll 中的两个函数。这些函数是： `WritePrivateProfileString`和`GetPrivateProfileString`。您将需要两个命名空间：`System.Runtime.InteropServices`和`System.Text`.

**使用 Ini 类的步骤**

在您的项目命名空间定义中添加

```
using INI; 
```

像这样创建一个INIFile

```
INIFile ini = new INIFile("C:\\test.ini"); 
```

用于`IniWriteValue`将新值写入节中的特定键或用于`IniReadValue`从特定节中的键读取值。

*注意：如果您是从头开始，您可以阅读这篇**MSDN 文章**：[如何：将应用程序配置文件添加到 C# 项目](http://msdn.microsoft.com/en-us/library/ms184658(VS.80).aspx)。这是配置应用程序的更好方法。*

* * *

## 回答 #4

> 赞同：49
> 
> 时间：2011-02-18T04:08:21.230

I found this simple implementation:

[http://bytes.com/topic/net/insights/797169-reading-parsing-ini-file-c](http://bytes.com/topic/net/insights/797169-reading-parsing-ini-file-c)

Works well for what I need.

Here is how you use it:

```
public class TestParser
{
    public static void Main()
    {
        IniParser parser = new IniParser(@"C:\test.ini");

        String newMessage;

        newMessage = parser.GetSetting("appsettings", "msgpart1");
        newMessage += parser.GetSetting("appsettings", "msgpart2");
        newMessage += parser.GetSetting("punctuation", "ex");

        //Returns "Hello World!"
        Console.WriteLine(newMessage);
        Console.ReadLine();
    }
} 
```

Here is the code:

```
using System;
using System.IO;
using System.Collections;

public class IniParser
{
    private Hashtable keyPairs = new Hashtable();
    private String iniFilePath;

    private struct SectionPair
    {
        public String Section;
        public String Key;
    }

    /// <summary>
    /// Opens the INI file at the given path and enumerates the values in the IniParser.
    /// </summary>
    /// <param name="iniPath">Full path to INI file.</param>
    public IniParser(String iniPath)
    {
        TextReader iniFile = null;
        String strLine = null;
        String currentRoot = null;
        String[] keyPair = null;

        iniFilePath = iniPath;

        if (File.Exists(iniPath))
        {
            try
            {
                iniFile = new StreamReader(iniPath);

                strLine = iniFile.ReadLine();

                while (strLine != null)
                {
                    strLine = strLine.Trim().ToUpper();

                    if (strLine != "")
                    {
                        if (strLine.StartsWith("[") && strLine.EndsWith("]"))
                        {
                            currentRoot = strLine.Substring(1, strLine.Length - 2);
                        }
                        else
                        {
                            keyPair = strLine.Split(new char[] { '=' }, 2);

                            SectionPair sectionPair;
                            String value = null;

                            if (currentRoot == null)
                                currentRoot = "ROOT";

                            sectionPair.Section = currentRoot;
                            sectionPair.Key = keyPair[0];

                            if (keyPair.Length > 1)
                                value = keyPair[1];

                            keyPairs.Add(sectionPair, value);
                        }
                    }

                    strLine = iniFile.ReadLine();
                }

            }
            catch (Exception ex)
            {
                throw ex;
            }
            finally
            {
                if (iniFile != null)
                    iniFile.Close();
            }
        }
        else
            throw new FileNotFoundException("Unable to locate " + iniPath);

    }

    /// <summary>
    /// Returns the value for the given section, key pair.
    /// </summary>
    /// <param name="sectionName">Section name.</param>
    /// <param name="settingName">Key name.</param>
    public String GetSetting(String sectionName, String settingName)
    {
        SectionPair sectionPair;
        sectionPair.Section = sectionName.ToUpper();
        sectionPair.Key = settingName.ToUpper();

        return (String)keyPairs[sectionPair];
    }

    /// <summary>
    /// Enumerates all lines for given section.
    /// </summary>
    /// <param name="sectionName">Section to enum.</param>
    public String[] EnumSection(String sectionName)
    {
        ArrayList tmpArray = new ArrayList();

        foreach (SectionPair pair in keyPairs.Keys)
        {
            if (pair.Section == sectionName.ToUpper())
                tmpArray.Add(pair.Key);
        }

        return (String[])tmpArray.ToArray(typeof(String));
    }

    /// <summary>
    /// Adds or replaces a setting to the table to be saved.
    /// </summary>
    /// <param name="sectionName">Section to add under.</param>
    /// <param name="settingName">Key name to add.</param>
    /// <param name="settingValue">Value of key.</param>
    public void AddSetting(String sectionName, String settingName, String settingValue)
    {
        SectionPair sectionPair;
        sectionPair.Section = sectionName.ToUpper();
        sectionPair.Key = settingName.ToUpper();

        if (keyPairs.ContainsKey(sectionPair))
            keyPairs.Remove(sectionPair);

        keyPairs.Add(sectionPair, settingValue);
    }

    /// <summary>
    /// Adds or replaces a setting to the table to be saved with a null value.
    /// </summary>
    /// <param name="sectionName">Section to add under.</param>
    /// <param name="settingName">Key name to add.</param>
    public void AddSetting(String sectionName, String settingName)
    {
        AddSetting(sectionName, settingName, null);
    }

    /// <summary>
    /// Remove a setting.
    /// </summary>
    /// <param name="sectionName">Section to add under.</param>
    /// <param name="settingName">Key name to add.</param>
    public void DeleteSetting(String sectionName, String settingName)
    {
        SectionPair sectionPair;
        sectionPair.Section = sectionName.ToUpper();
        sectionPair.Key = settingName.ToUpper();

        if (keyPairs.ContainsKey(sectionPair))
            keyPairs.Remove(sectionPair);
    }

    /// <summary>
    /// Save settings to new file.
    /// </summary>
    /// <param name="newFilePath">New file path.</param>
    public void SaveSettings(String newFilePath)
    {
        ArrayList sections = new ArrayList();
        String tmpValue = "";
        String strToSave = "";

        foreach (SectionPair sectionPair in keyPairs.Keys)
        {
            if (!sections.Contains(sectionPair.Section))
                sections.Add(sectionPair.Section);
        }

        foreach (String section in sections)
        {
            strToSave += ("[" + section + "]\r\n");

            foreach (SectionPair sectionPair in keyPairs.Keys)
            {
                if (sectionPair.Section == section)
                {
                    tmpValue = (String)keyPairs[sectionPair];

                    if (tmpValue != null)
                        tmpValue = "=" + tmpValue;

                    strToSave += (sectionPair.Key + tmpValue + "\r\n");
                }
            }

            strToSave += "\r\n";
        }

        try
        {
            TextWriter tw = new StreamWriter(newFilePath);
            tw.Write(strToSave);
            tw.Close();
        }
        catch (Exception ex)
        {
            throw ex;
        }
    }

    /// <summary>
    /// Save settings back to ini file.
    /// </summary>
    public void SaveSettings()
    {
        SaveSettings(iniFilePath);
    }
} 
```

* * *

## 回答 #5

> 赞同：23
> 
> 时间：2013-06-06T21:47:44.987

The code in joerage's answer is inspiring.

Unfortunately, it changes the character casing of the keys and does not handle comments. So I wrote something that should be robust enough to read (only) very dirty INI files and allows to retrieve keys as they are.

It uses some LINQ, a nested case insensitive string dictionary to store sections, keys and values, and read the file in one go.

```
using System;
using System.Collections.Generic;
using System.IO;
using System.Linq;

class IniReader
{
    Dictionary<string, Dictionary<string, string>> ini = new Dictionary<string, Dictionary<string, string>>(StringComparer.InvariantCultureIgnoreCase);

    public IniReader(string file)
    {
        var txt = File.ReadAllText(file);

        Dictionary<string, string> currentSection = new Dictionary<string, string>(StringComparer.InvariantCultureIgnoreCase);

        ini[""] = currentSection;

        foreach(var line in txt.Split(new[]{"\n"}, StringSplitOptions.RemoveEmptyEntries)
                               .Where(t => !string.IsNullOrWhiteSpace(t))
                               .Select(t => t.Trim()))
        {
            if (line.StartsWith(";"))
                continue;

            if (line.StartsWith("[") && line.EndsWith("]"))
            {
                currentSection = new Dictionary<string, string>(StringComparer.InvariantCultureIgnoreCase);
                ini[line.Substring(1, line.LastIndexOf("]") - 1)] = currentSection;
                continue;
            }

            var idx = line.IndexOf("=");
            if (idx == -1)
                currentSection[line] = "";
            else
                currentSection[line.Substring(0, idx)] = line.Substring(idx + 1);
        }
    }

    public string GetValue(string key)
    {
        return GetValue(key, "", "");
    }

    public string GetValue(string key, string section)
    {
        return GetValue(key, section, "");
    }

    public string GetValue(string key, string section, string @default)
    {
        if (!ini.ContainsKey(section))
            return @default;

        if (!ini[section].ContainsKey(key))
            return @default;

        return ini[section][key];
    }

    public string[] GetKeys(string section)
    {
        if (!ini.ContainsKey(section))
            return new string[0];

        return ini[section].Keys.ToArray();
    }

    public string[] GetSections()
    {
        return ini.Keys.Where(t => t != "").ToArray();
    }
} 
```

* * *

## 回答 #6

> 赞同：15
> 
> 时间：2014-04-21T18:22:10.100

I want to introduce an IniParser library I've created completely in c#, so it contains no dependencies in any OS, which makes it Mono compatible. Open Source with MIT license -so it can be used in any code.

You can [check out the source in GitHub](https://github.com/rickyah/ini-parser), and it is [also available as a NuGet package](http://www.nuget.org/packages/ini-parser)

It's [heavily configurable](https://github.com/rickyah/ini-parser/wiki/Configuring-parser-behavior), and [really simple to use](https://github.com/rickyah/ini-parser/wiki/First-Steps).

Sorry for the shameless plug but I hope it can be of help of anyone revisiting this answer.

* * *

## 回答 #7

> 赞同：9
> 
> 时间：2017-07-06T05:03:52.337

If you only need read access and not write access and you are using the `Microsoft.Extensions.Confiuration` (comes bundled in by default with ASP.NET Core but works with regular programs too) you can use the NuGet package [`Microsoft.Extensions.Configuration.Ini`](https://www.nuget.org/packages/Microsoft.Extensions.Configuration.Ini) to import ini files in to your configuration settings.

```
public Startup(IHostingEnvironment env)
{
    var builder = new ConfigurationBuilder()
        .SetBasePath(env.ContentRootPath)
        .AddIniFile("SomeConfig.ini", optional: false);
    Configuration = builder.Build();
} 
```

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2017-07-21T17:37:16.440

[PeanutButter.INI](https://www.nuget.org/packages/PeanutButter.INI/) is a Nuget-packaged class for INI files manipulation. It supports read/write, including comments – your comments are preserved on write. It appears to be reasonably popular, is tested and easy to use. It's also totally free and open-source.

*Disclaimer: I am the author of PeanutButter.INI.*

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2012-04-02T06:14:17.747

Usually, when you create applications using C# and the .NET framework, you will not use INI files. It is more common to store settings in an XML-based configuration file or in the registry. However, if your software shares settings with a legacy application it may be easier to use its configuration file, rather than duplicating the information elsewhere.

The .NET framework does not support the use of INI files directly. However, you can use Windows API functions with Platform Invocation Services (P/Invoke) to write to and read from the files. In this link we create a class that represents INI files and uses Windows API functions to manipulate them. Please go through the following link.

[Reading and Writing INI Files](http://www.blackwasp.co.uk/IniFile.aspx)

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2016-06-12T09:16:44.023

If you want just a simple reader without sections and any other dlls here is simple solution:

```
using System;
using System.Collections.Generic;
using System.IO;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace Tool
{
    public class Config
    {
        Dictionary <string, string> values;
        public Config (string path)
        {
            values = File.ReadLines(path)
            .Where(line => (!String.IsNullOrWhiteSpace(line) && !line.StartsWith("#")))
            .Select(line => line.Split(new char[] { '=' }, 2, 0))
            .ToDictionary(parts => parts[0].Trim(), parts => parts.Length>1?parts[1].Trim():null);
        }
        public string Value (string name, string value=null)
        {
            if (values!=null && values.ContainsKey(name))
            {
                return values[name];
            }
            return value;
        }
    }
} 
```

Usage sample:

```
 file = new Tool.Config (Path.GetDirectoryName(System.Reflection.Assembly.GetExecutingAssembly().Location) + "\\config.ini");
    command = file.Value ("command");
    action = file.Value ("action");
    string value;
    //second parameter is default value if no key found with this name
    value = file.Value("debug","true");
    this.debug = (value.ToLower()=="true" || value== "1");
    value = file.Value("plain", "false");
    this.plain = (value.ToLower() == "true" || value == "1"); 
```

Config file content meanwhile (as you see supports # symbol for line comment):

```
#command to run
command = php

#default script
action = index.php

#debug mode
#debug = true

#plain text mode
#plain = false

#icon = favico.ico 
```

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2017-02-07T18:51:21.250

Try this method:

```
public static Dictionary<string, string> ParseIniDataWithSections(string[] iniData)
{
    var dict = new Dictionary<string, string>();
    var rows = iniData.Where(t => 
        !String.IsNullOrEmpty(t.Trim()) && !t.StartsWith(";") && (t.Contains('[') || t.Contains('=')));
    if (rows == null || rows.Count() == 0) return dict;
    string section = "";
    foreach (string row in rows)
    {
        string rw = row.TrimStart();
        if (rw.StartsWith("["))
            section = rw.TrimStart('[').TrimEnd(']');
        else
        {
            int index = rw.IndexOf('=');
            dict[section + "-" + rw.Substring(0, index).Trim()] = rw.Substring(index+1).Trim().Trim('"');
        }
    }
    return dict;
} 
```

It creates the dictionary where the key is "-". You can load it like this:

```
var dict = ParseIniDataWithSections(File.ReadAllLines(fileName)); 
```

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2017-08-18T17:20:34.163

I'm late to join the party, but I had the same issue today and I've written the following implementation:

```
using System.Text.RegularExpressions;

static bool match(this string str, string pat, out Match m) =>
    (m = Regex.Match(str, pat, RegexOptions.IgnoreCase)).Success;

static void Main()
{
    Dictionary<string, Dictionary<string, string>> ini = new Dictionary<string, Dictionary<string, string>>();
    string section = "";

    foreach (string line in File.ReadAllLines(.........)) // read from file
    {
        string ln = (line.Contains('#') ? line.Remove(line.IndexOf('#')) : line).Trim();

        if (ln.match(@"^[ \t]*\[(?<sec>[\w\-]+)\]", out Match m))
            section = m.Groups["sec"].ToString();
        else if (ln.match(@"^[ \t]*(?<prop>[\w\-]+)\=(?<val>.*)", out m))
        {
            if (!ini.ContainsKey(section))
                ini[section] = new Dictionary<string, string>();

            ini[section][m.Groups["prop"].ToString()] = m.Groups["val"].ToString();
        }
    }

    // access the ini file as follows:
    string content = ini["section"]["property"];
} 
```

It must be noted, that this implementation does not handle sections or properties which are not found. To achieve this, you should extend the `Dictionary<,>`-class to handle unfound keys.

* * *

To serialize an instance of `Dictionary<string, Dictionary<string, string>>` to an `.ini`-file, I use the following code:

```
string targetpath = .........;
Dictionary<string, Dictionary<string, string>> ini = ........;
StringBuilder sb = new StringBuilder();

foreach (string section in ini.Keys)
{
    sb.AppendLine($"[{section}]");

    foreach (string property in ini[section].Keys)
        sb.AppendLine($"{property}={ini[section][property]");
}

File.WriteAllText(targetpath, sb.ToString()); 
```

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2010-01-28T06:27:58.197

There is an Ini Parser available in [CommonLibrary.NET](http://commonlibrarynet.codeplex.com)

This has various very convenient overloads for getting sections/values and is very light weight.

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2016-10-14T20:45:11.777

Here is my own version, using regular expressions. This code assumes that each section name is unique - if however this is not true - it makes sense to replace Dictionary with List. This function supports .ini file commenting, starting from ';' character. Section starts normally [section], and key value pairs also comes normally "key = value". Same assumption as for sections - key name is unique.

```
/// <summary>
/// Loads .ini file into dictionary.
/// </summary>
public static Dictionary<String, Dictionary<String, String>> loadIni(String file)
{
    Dictionary<String, Dictionary<String, String>> d = new Dictionary<string, Dictionary<string, string>>();

    String ini = File.ReadAllText(file);

    // Remove comments, preserve linefeeds, if end-user needs to count line number.
    ini = Regex.Replace(ini, @"^\s*;.*$", "", RegexOptions.Multiline);

    // Pick up all lines from first section to another section
    foreach (Match m in Regex.Matches(ini, "(^|[\r\n])\\[([^\r\n]*)\\][\r\n]+(.*?)(\\[([^\r\n]*)\\][\r\n]+|$)", RegexOptions.Singleline))
    {
        String sectionName = m.Groups[2].Value;
        Dictionary<String, String> lines = new Dictionary<String, String>();

        // Pick up "key = value" kind of syntax.
        foreach (Match l in Regex.Matches(ini, @"^\s*(.*?)\s*=\s*(.*?)\s*$", RegexOptions.Multiline))
        {
            String key = l.Groups[1].Value;
            String value = l.Groups[2].Value;

            // Open up quotation if any.
            value = Regex.Replace(value, "^\"(.*)\"$", "$1");

            if (!lines.ContainsKey(key))
                lines[key] = value;
        }

        if (!d.ContainsKey(sectionName))
            d[sectionName] = lines;
    }

    return d;
} 
```

* * *

## 回答 #15

> 赞同：-4
> 
> 时间：2018-10-01T12:17:17.417

Here is my class, works like a charm :

```
public static class IniFileManager
{

    [DllImport("kernel32")]
    private static extern long WritePrivateProfileString(string section,
        string key, string val, string filePath);
    [DllImport("kernel32")]
    private static extern int GetPrivateProfileString(string section,
             string key, string def, StringBuilder retVal,
        int size, string filePath);
    [DllImport("kernel32.dll")]
    private static extern int GetPrivateProfileSection(string lpAppName,
             byte[] lpszReturnBuffer, int nSize, string lpFileName);

    /// <summary>
    /// Write Data to the INI File
    /// </summary>
    /// <PARAM name="Section"></PARAM>
    /// Section name
    /// <PARAM name="Key"></PARAM>
    /// Key Name
    /// <PARAM name="Value"></PARAM>
    /// Value Name
    public static void IniWriteValue(string sPath,string Section, string Key, string Value)
    {
        WritePrivateProfileString(Section, Key, Value, sPath);
    }

    /// <summary>
    /// Read Data Value From the Ini File
    /// </summary>
    /// <PARAM name="Section"></PARAM>
    /// <PARAM name="Key"></PARAM>
    /// <PARAM name="Path"></PARAM>
    /// <returns></returns>
    public static string IniReadValue(string sPath,string Section, string Key)
    {
        StringBuilder temp = new StringBuilder(255);
        int i = GetPrivateProfileString(Section, Key, "", temp,
                                        255, sPath);
        return temp.ToString();

    } 
```

}

The use is obviouse since its a static class, just call IniFileManager.IniWriteValue for readsing a section or IniFileManager.IniReadValue for reading a section.

* * *

## 回答 #16

> 赞同：-7
> 
> 时间：2016-01-13T01:43:28.717

You should read and write data from xml files since you can save a whole object to xml and also you can populate a object from a saved xml. It is better an easy to manipulate objects.

Here is how to do it: Write Object Data to an XML File: [https://msdn.microsoft.com/en-us/library/ms172873.aspx](https://msdn.microsoft.com/en-us/library/ms172873.aspx) Read Object Data from an XML File: [https://msdn.microsoft.com/en-us/library/ms172872.aspx](https://msdn.microsoft.com/en-us/library/ms172872.aspx)

# java - 如何在一个 Maven 配置文件和另一个配置文件之间切换？

> ID：217908
> 
> 赞同：3
> 
> 时间：2008-10-20T09:41:24.013
> 
> 标签：java, maven-2, build-process

如果我有一个由属性的存在激活的 Maven 配置文件，我如何定义另一个仅在另一个配置文件未激活时才激活的配置文件？

例如

```
 <profile>
        <activation>
            <property>
                <name>myproperty</name>
                <value>value</value>
            </property>
        </activation>
        ...
    </profile>

    <profile>
        <activation>
            <property>
                <name>myproperty</name>
                <value></value> <!-- Anything other than "value"  -->
            </property>
        </activation>
        ...
    </profile> 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-20T10:30:55.460

答案似乎是

```
<value>!value</value> 
```

# c++ - 为什么 C++ 编译器不定义 operator== 和 operator!=？

> ID：217911
> 
> 赞同：334
> 
> 时间：2008-10-20T09:42:36.243
> 
> 标签：c++, operators

我非常喜欢让编译器为你做尽可能多的工作。在编写一个简单的类时，编译器可以“免费”为您提供以下内容：

*   默认（空）构造函数
*   复制构造函数
*   一个析构函数
*   赋值运算符 ( `operator=`)

但它似乎无法为您提供任何比较运算符 - 例如`operator==`or `operator!=`。例如：

```
class foo
{
public:
    std::string str_;
    int n_;
};

foo f1;        // Works
foo f2(f1);    // Works
foo f3;
f3 = f2;       // Works

if (f3 == f2)  // Fails
{ }

if (f3 != f2)  // Fails
{ } 
```

这有充分的理由吗？为什么执行逐个成员的比较会成为问题？显然，如果该类分配内存，那么您要小心，但是对于一个简单的类，编译器肯定可以为您做到这一点吗？

* * *

## 回答 #1

> 赞同：333
> 
> 时间：2008-10-20T14:53:20.657

如果编译器可以提供默认的复制构造函数，那么它应该能够提供类似的默认值的论点`operator==()`具有一定的意义。我认为决定不为该运算符提供编译器生成的默认值的原因可以通过 Stroustrup 在“C++ 的设计和演变”（第 11.4.1 节 - 复制控制）中关于默认复制构造函数的说法来猜测。 ：

> 我个人认为很遗憾，默认情况下定义了复制操作，并且我禁止复制我的许多类的对象。但是，C++ 继承了 C 的默认赋值和复制构造函数，并且经常使用它们。

因此`operator==()`，问题应该是“为什么 C++ 有默认赋值和复制构造函数？”而不是“为什么 C++ 没有默认值？”，答案是 Stroustrup 不情愿地包含了这些项目，以实现与 C 的向后兼容性（可能是大多数 C++ 缺陷的原因，但也可能是 C++ 流行的主要原因）。

出于我自己的目的，在我的 IDE 中，我用于新类的代码段包含私有赋值运算符和复制构造函数的声明，因此当我生成一个新类时，我没有默认赋值和复制操作 - 我必须显式删除声明`private:`如果我希望编译器能够为我生成这些操作，请从该部分中提取这些操作。

* * *

## 回答 #2

> 赞同：115
> 
> 时间：2015-01-08T10:23:14.293

即使在 C++20 中，编译器仍然不会`operator==`为您隐式生成

```
struct foo
{
    std::string str;
    int n;
};

assert(foo{"Anton", 1} == foo{"Anton", 1}); // ill-formed 
```

[但是您将获得自 C++20 以来](https://en.cppreference.com/w/cpp/language/default_comparisons)*显式*默认的能力：`==`

```
struct foo
{
    std::string str;
    int n;

    // either member form
    bool operator==(foo const&) const = default;
    // ... or friend form
    friend bool operator==(foo const&, foo const&) = default;
}; 
```

默认`==`是按成员进行的`==`（与默认复制构造函数按成员进行复制构造的方式相同）。`==`新规则还提供了和之间的预期关系`!=`。例如，使用上面的声明，我可以同时编写：

```
assert(foo{"Anton", 1} == foo{"Anton", 1}); // ok!
assert(foo{"Anton", 1} != foo{"Anton", 2}); // ok! 
```

这个特定的特性（和 之间的默认和`operator==`对称）来自[一个提议](https://wg21.link/p1185)，该提议是更广泛的语言特性的一部分，即.`==``!=`[`operator<=>`](https://wg21.link/p515)

* * *

## 回答 #3

> 赞同：79
> 
> 时间：2008-10-20T09:53:07.190

编译器不知道您是想要指针比较还是深度（内部）比较。

不实现它并让程序员自己做会更安全。然后他们可以做出他们喜欢的所有假设。

* * *

## 回答 #4

> 赞同：45
> 
> 时间：2009-04-03T17:05:05.167

恕我直言，没有“好”的理由。之所以有这么多人同意这个设计决定，是因为他们没有学会掌握基于值的语义的力量。人们需要编写大量自定义复制构造函数、比较运算符和析构函数，因为他们在实现中使用原始指针。

当使用适当的智能指针（如 std::shared_ptr）时，默认的复制构造函数通常很好，假设的默认比较运算符的明显实现也很好。

* * *

## 回答 #5

> 赞同：42
> 
> 时间：2011-12-07T16:50:56.110

答案是 C++ 没有做 == 因为 C 没有，这就是为什么 C 只提供默认 = 而首先不提供 == 的原因。C 想要保持简单：C 实现 = by memcpy; 但是，由于填充，== 无法由 memcmp 实现。因为填充没有初始化，所以 memcmp 说它们是不同的，即使它们是相同的。空类也存在同样的问题：memcmp 说它们是不同的，因为空类的大小不为零。从上面可以看出，实现 == 比在 C 中实现 = 更复杂。一些代码[示例](http://riocpp.wordpress.com/2011/12/07/default-equal-operator/)与此相关。如果我错了，感谢您的指正。

* * *

## 回答 #6

> 赞同：31
> 
> 时间：2014-04-27T21:15:42.993

在这段[**视频**](https://www.youtube.com/watch?v=B5yiLvaxPS4&list=PLHxtyCq_WDLXryyw91lahwdtpZsmo4BGD)中，STL 的创建者 Alex Stepanov 在大约 13:00 解决了这个问题。总而言之，在观察了 C++ 的演变之后，他认为：

*   不幸的是**== 和 !=**没有被隐式声明（并且 Bjarne 同意他的观点）。正确的语言应该为您准备好这些东西（他进一步建议您不应该定义一个**!=**破坏**==**语义的东西）
*   这种情况的原因在 C 中有其根源（与许多 C++ 问题一样）。在那里，赋值运算符是*通过逐位赋值*隐式定义的，但这不适用于**==**。可以在Bjarne Stroustrup的这篇[**文章中找到更详细的解释。**](https://isocpp.org/blog/2016/02/a-bit-of-background-for-the-default-comparison-proposal-bjarne-stroustrup)
*   在后续问题中，**为什么不使用成员之间的比较，**他说了一件**令人惊奇的事情**：C 是一种本土语言，为 Ritchie 实现这些东西的人告诉他，他发现这很难实现！

然后他说在（遥远的）未来**==**和**!=**将被隐式生成。

* * *

## 回答 #7

> 赞同：22
> 
> 时间：2018-05-15T08:11:51.827

C++20 提供了一种轻松实现默认比较运算符的方法。

[来自cppreference.com](http://en.cppreference.com/w/cpp/language/default_comparisons)的示例：

```
class Point {
    int x;
    int y;
public:
    auto operator<=>(const Point&) const = default;
    // ... non-comparison functions ...
};

// compiler implicitly declares operator== and all four relational operators work
Point pt1, pt2;
if (pt1 == pt2) { /*...*/ } // ok, calls implicit Point::operator==
std::set<Point> s; // ok
s.insert(pt1); // ok
if (pt1 <= pt2) { /*...*/ } // ok, makes only a single call to Point::operator<=> 
```

* * *

## 回答 #8

> 赞同：16
> 
> 时间：2008-10-20T11:23:28.613

无法定义默认值`==`，但您可以定义默认值，您通常应该`!=`通过它自己定义。`==`为此，您应该执行以下操作：

```
#include <utility>
using namespace std::rel_ops;
...

class FooClass
{
public:
  bool operator== (const FooClass& other) const {
  // ...
  }
}; 
```

您可以查看[http://www.cplusplus.com/reference/std/utility/rel_ops/](http://www.cplusplus.com/reference/std/utility/rel_ops/)了解详细信息。

另外，如果你定义`operator<` 了，<=, >, >= 的操作符可以在使用的时候推导出来`std::rel_ops`。

但是你在使用时应该小心，`std::rel_ops`因为比较运算符可以推导出你不期望的类型。

从基本运算符推导出相关运算符的更优选方法是使用[boost::operators](http://www.boost.org/doc/libs/1_36_0/libs/utility/operators.htm)。

boost 中使用的方法更好，因为它为您只需要的类定义了运算符的用法，而不是针对范围内的所有类。

您还可以从“+=”生成“+”，从“-=”等生成-...（参见[此处的](http://www.boost.org/doc/libs/1_36_0/libs/utility/operators.htm#smpl_oprs)完整列表）

* * *

## 回答 #9

> 赞同：11
> 
> 时间：2008-10-20T09:59:31.607

C++0x~~有~~一个关于默认函数的提议，所以你可以说`default operator==;` 我们已经知道它有助于使这些事情变得明确。

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2008-10-20T10:06:15.447

从概念上讲，定义平等并不容易。即使对于 POD 数据，有人可能会争辩说，即使字段相同，但它是不同的对象（在不同的地址），它也不一定相等。这实际上取决于运营商的使用情况。不幸的是，您的编译器不是通灵的，无法推断。

除此之外，默认功能是在脚下射击自己的绝佳方式。您描述的默认值基本上是为了保持与 POD 结构的兼容性。然而，它们确实造成了足够多的破坏，开发人员忘记了它们，或者默认实现的语义。

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2019-09-06T12:29:07.837

只是为了让这个问题的答案随着时间的推移而保持完整：从 C++20 开始，它可以使用命令自动生成`auto operator<=>(const foo&) const = default;`

它将生成所有运算符：==、!=、<、<=、> 和 >=，有关详细信息，请参阅[https://en.cppreference.com/w/cpp/language/default_comparisons](https://en.cppreference.com/w/cpp/language/default_comparisons)。

由于操作员的外观`<=>`，它被称为宇宙飞船操作员。另请参阅[为什么我们需要 C++ 中的 spaceship <=> 运算符？](https://stackoverflow.com/questions/49661170/why-do-we-need-the-spaceship-operator-in-c).

编辑：在 C++11 中也有一个非常简洁的替代品，`std::tie`请参阅[https://en.cppreference.com/w/cpp/utility/tuple/tie](https://en.cppreference.com/w/cpp/utility/tuple/tie)以获取完整的代码示例`bool operator<(…)`。更改为使用的有趣部分`==`是：

```
#include <tuple>

struct S {
………
bool operator==(const S& rhs) const
    {
        // compares n to rhs.n,
        // then s to rhs.s,
        // then d to rhs.d
        return std::tie(n, s, d) == std::tie(rhs.n, rhs.s, rhs.d);
    }
}; 
```

`std::tie`适用于所有比较运算符，并由编译器完全优化。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2015-12-04T20:01:33.843

> 这有充分的理由吗？为什么执行逐个成员的比较会成为问题？

这在功能上可能不是问题，但在性能方面，默认的逐个成员比较可能比默认的逐个成员分配/复制更不理想。与分配顺序不同，比较顺序会影响性能，因为第一个不相等的成员意味着可以跳过其余的成员。因此，如果有一些通常相等的成员，您想最后比较它们，编译器不知道哪些成员更有可能相等。

考虑这个例子，`verboseDescription`从相对较小的一组可能的天气描述中选择一个长字符串。

```
class LocalWeatherRecord {
    std::string verboseDescription;
    std::tm date;
    bool operator==(const LocalWeatherRecord& other){
        return date==other.date
            && verboseDescription==other.verboseDescription;
    // The above makes a lot more sense than
     // return verboseDescription==other.verboseDescription
     //     && date==other.date;
    // because some verboseDescriptions are liable to be same/similar
    }
} 
```

（当然，如果编译器认为它们没有副作用，则它有权忽略比较的顺序，但大概它仍然会从源代码中获取它自己没有更好信息的地方。）

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-10-20T09:50:35.680

我同意，对于 POD 类型类，编译器可以为您完成。但是，您可能认为简单的编译器可能会出错。所以还是让程序员来做比较好。

我确实有一个 POD 案例，其中两个字段是唯一的 - 所以比较永远不会被认为是正确的。然而，我只需要在有效负载上进行比较——编译器永远无法理解或自己无法弄清楚的东西。

此外 - 他们不会花很长时间来写他们吗？！

# .net - 数据绑定文本框：无法退出

> ID：217912
> 
> 赞同：6
> 
> 时间：2008-10-20T09:42:48.457
> 
> 标签：.net, winforms, data-binding, textbox

我有一个文本框绑定到表单上的对象属性（实际上是几个文本框）。这是一个对象的编辑器。当我在其中一个文本框中编辑一些对象并修改值时，我无法退出文本框（既不能通过选项卡也不能单击另一个文本框）。然而，情况并非总是如此 - 在编辑其他对象（相同类型）时它工作正常。

这是一个代码片段：

```
txtValue.DataBindings.Add("Text", _SourceObject, "PlannedValue", True, DataSourceUpdateMode.OnPropertyChanged, Nothing, "c")
txtEstPlacements.DataBindings.Add("Text", _SourceObject, "EstimatedPlacementCount")
txtReference.DataBindings.Add("Text", _SourceObject, "Reference") 
```

有什么建议么？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-10-20T16:54:20.613

听起来像是数据验证问题。检查窗体上的控件是否将其 CausesValidation 属性设置为 true 或 false。

还要检查表单上的 AutoValidate 属性。它可能设置为 EnablePreventFocusChange（这是默认设置）。

也可能是文本框中提供的值无法转换为它在源数据对象上绑定到的属性的类型。我相信 Convert 类用于此（尽管我在这里可能错了）。

您可能想查看MSDN 上的[这篇文章](http://msdn.microsoft.com/en-us/library/ms950965.aspx)，其中详细介绍了 winforms 验证。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-22T10:06:48.830

如果您的表单具有 AutoValidate==EnablePreventFocusChange，那么您最终会将焦点卡在任何未通过验证的字段中。

请注意，如果将值写入对象时出现异常，则认为验证失败。

尝试在绑定到光标卡住的控件的属性的设置器的入口点设置断点。然后，单步查看是否引发异常。

If the breakpoint never fires, the exception may be occuring within the Databinding framework.

Contrary to popular believe, the databinding framework does log errors and other useful information - it uses support from the System.Diagnostics namespace to do this. I forget the details, but they're on MSDN - you should be able to view the diagnostics in the messages window of Visual Studio while your application runs. Very useful for troubleshooting issues with Databinding.

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2012-03-14T13:23:36.783

In order to fix the validation failure, which is due to the inability of the databinding to set `DBNull.Value` into the textbox.text, you may add the following line in the Form_Load section:

```
TextBox1.DataBindings["Text"].NullValue = string.Empty; 
```

for each text box you want to allow empty value to be validated correctly.

[See more details on Microsoft Connect](http://connect.microsoft.com/VisualStudio/feedback/details/117111/provide-better-databinding-support-for-nullable-types#details).

and on:

[Can't escape empty textbox](https://stackoverflow.com/questions/4615328/cant-escape-empty-textbox)

# c# - 将 Access DB 中的图片读入 PictureBox

> ID：217928
> 
> 赞同：3
> 
> 时间：2008-10-20T09:49:09.117
> 
> 标签：c#, ms-access, picturebox

我一直试图在 C# windows 应用程序的 PictureBox 中读取保存在 Access DB 中的图片作为 OLE 对象。

执行此操作的代码如下所示：

```
 string connString = @"Provider=Microsoft.Jet.OLEDB.4.0;Data Source=D:\Rajesh\SampleDB_2003.mdb;";
        OleDbConnection oConn = new OleDbConnection(connString);
        oConn.Open();
        string commandString = "select * from employee where id = " + id + "";
        OleDbCommand oCmd = new OleDbCommand(commandString, oConn);
        OleDbDataReader oReader = oCmd.ExecuteReader(CommandBehavior.SequentialAccess);

        while (oReader.Read())
        {
            txtID.Text = ((int)oReader.GetValue(0)).ToString();
            txtName.Text = (string)oReader.GetValue(1);
            txtAge.Text = ((int)oReader.GetValue(2)).ToString();
            txtType.Text = (string)oReader.GetValue(3);
            byte[] imageBytes = (byte[])oReader.GetValue(4);

            MemoryStream ms = new MemoryStream();
            ms.Write(imageBytes, 0, imageBytes.Length);
            Bitmap bmp = new Bitmap(ms);
            pbPassport.Image = bmp;
        } 
```

当我执行上述代码时，会在该行引发“参数无效”异常：

```
Bitmap bmp = new Bitmap(ms) 
```

从异常消息中，很明显“ms”的格式无法识别。有什么建议可以解决这个问题吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-20T10:01:30.683

不幸的是，我没有给你好的答案，但我可以告诉你，当我尝试时，我得到了相同的结果。有时跳过字节数组的前 78 个字节有效，有时则无效。

这是因为 OLE 对象数据类型在字段中存储了某种类型的标头，以便 Access 知道它是什么类型的 OLE 对象。我找不到可靠的方法来准确计算此标头停止的位置和真实数据的开始位置，但我也放弃了，祝你好运:)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-20T14:47:51.900

谷歌搜索 AccessHdr。您将找到对 AccessHdr.cpp 和 AccessHdr.h 的引用。这些将说明在没有标头的情况下提取流所需的内容。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-07-23T12:02:34.543

您不能如此轻松地读取 OLE 对象。事实上，将图片作为 OLE 对象保存在数据库中是一种不好的做法。

最好在某些存储中将 em 作为 BLOB 对象或路径和文件名。AccessImagine 可以处理 MS Access 和 C# 的两种情况。你可以在这里下载 - [http://access.bukrek.net](http://access.bukrek.net)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-20T11:19:14.083

你可以试试：

```
pbPassport.Image = Image.FromStream(ms); 
```

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-10-20T10:53:13.480

您的字节流以某种方式损坏，因为我尝试了您的确切方法，但是用文件中的 PNG 数据填充了字节数组。

我建议创建两个流，一个来自数据库，另一个来自作为数据库中图像源的文件。然后逐字节比较它们。如果甚至有一个字节的差异，则数据库图像数据已损坏。

# java - 使用tomcat 6在spring webapp中设置Commons Logging / Log4j的问题

> ID：217929
> 
> 赞同：15
> 
> 时间：2008-10-20T09:49:12.627
> 
> 标签：java, tomcat, logging, log4j

我在部署在 tomcat 6 下的 apring webapp 中的日志记录设置有问题。

webapp 使用 commons-logging api，在运行时应该使用 log4j。日志文件已创建但仍为空 - 不出现日志条目。

设置如下：

WEB-INF/web.xml：

```
 <context-param>
    <param-name>log4jConfigLocation</param-name>
    <param-value>/WEB-INF/log4j.xml</param-value>
  </context-param>
  <listener>
    <listener-class>org.springframework.web.util.Log4jConfigListener</listener-class>
  </listener> 
```

WEB-INF/classes/commons-logging.properties：

```
org.apache.commons.logging.Log=org.apache.commons.logging.impl.Log4JLogger 
```

WEB-INF/log4j.xml：

```
<log4j:configuration xmlns:log4j='http://jakarta.apache.org/log4j/'>

  <appender name="CONSOLE" class="org.apache.log4j.ConsoleAppender">
    ...
  </appender>
  <appender name="FILE" class="org.apache.log4j.RollingFileAppender">
    <param name="File" value="${catalina.home}/logs/my.log"/>
    ...
  </appender>

  <logger name="my.package">
    <level value="INFO"/>
  </logger>

  <root>
    <level value="ERROR"/>
    <appender-ref ref="CONSOLE"/>
    <appender-ref ref="FILE"/>
  </root>
</log4j:configuration> 
```

文件 logs/my.log 已创建，但未显示任何日志。是 tomcat 控制台上的信息日志，但没有配置布局模式。

commons-logging-1.1.1.jar 和 log4j-1.2.14.jar 包含在 WEB-INF/lib 中。知道这里有什么问题吗？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-20T15:11:24.457

网络上有许多记录在案的实例，警告人们使用公共日志记录。如此之多，以至于[SLF4J](http://www.slf4j.org/)越来越受欢迎。

考虑到您对将 Tomcat 与 Log4j 一起使用不感兴趣，您应该直接在应用程序中使用 Log4j。特别是如果您将来没有机会切换日志框架。它将降低您的应用程序的复杂性，并摆脱您在公共日志记录方面遇到的任何类加载器问题。

这在您的文本中应该是一个相对容易的搜索和替换，因为 commons-logging 和 log4j 都对它们的日志记录方法使用类似的调用结构。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-22T18:25:57.153

请特别注意您**没有**将 log4j.jar 放在 Tomcat commons/lib 目录中。如果根类加载器加载 log4j 库，当您的 webapps 也尝试使用 log4j 时，您将遇到冲突和初始化问题。

如果您需要将 log4j 用于常见的 Tomcat 日志记录，则需要注意您的 webapps 也不要尝试加载 log4j。如果您在服务器上有多个 webapps，那么您需要遵守规则，每个 webapp 的日志初始化不会影响其他 webapps 的初始化。每个 webapp 都需要使用唯一的 Logger ID，这可以通过唯一的包名称来完成。

在 Tomcat 中使用具有多个 webapps 的通用 log4j 会导致严重的冲突，因为您有共享库都想要进行日志记录，例如 Hibernate 或 Spring。下一个尝试初始化 log4j 的 webapp 可能会关闭前一个的记录器。这可能是一团糟。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2011-04-01T00:23:42.577

我有类似的问题，现在找到了解决方法。使用附加参数启动tomcat：

-Dorg.apache.commons.logging.LogFactory=org.apache.commons.logging.impl.LogFactoryImpl

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-20T13:35:09.380

您需要为完整的公共日志编译额外的组件。默认情况下，Tomcat 6 使用始终委托给 java.util.logging 的 commons-logging 的硬编码实现。

此处的构建说明[http://tomcat.apache.org/tomcat-6.0-doc/building.html](http://tomcat.apache.org/tomcat-6.0-doc/building.html)

然后替换Tomcat的/bin目录下的tomcat-juli.jar，将tomcat-juli-adapters.jar连同log4j和config一起放到/lib目录下。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-09-28T14:27:33.440

如果您使用 log4j +common 日志记录，则可以避免上述大部分配置。common logging LogFactory 有一个类似于 JAXP 的发现功能，在以下优先级中，搜索 Log 实现，1.配置属性 org.apache.commons.logging.Log 在文件 commons-logging.properties 2.系统属性 org.apache.commons。 logging.Log 3\. 如果 Log4J 在类路径中可用，请使用相应的包装类 (Log4JLogger)。4\. Jdk14Logger 5\. SimpleLog

只要确保类路径中的 common-logging.jar 和 common-logging-api.jar 和 log4j.jar 都可以。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2010-02-18T12:40:47.770

可能是我错了。请尝试以下方法：

A) 将 appender 添加到 my.package 为： **或** B) 将 root 的日志级别降低到 INFO

# .net - 这些为单例创建静态实例的方式有什么区别？

> ID：217932
> 
> 赞同：6
> 
> 时间：2008-10-20T09:50:42.780
> 
> 标签：.net, com, singleton

我最近遇到了一个错误，该错误仅在将库构建为发布版本而不是调试版本时才表现出来。该库是一个带有 COM 包装器的 .NET dll，我正在使用 CoCreateInstance 从非托管 c++ 应用程序中的 dll 创建一个类。当我最终追踪到这个错误时，它是由访问一个单例对象引起的。我有这样声明的单例实例：

```
private static readonly MyObjectType s_instance = new MyObjectType; 
```

然后通过以下方式访问它：

```
public static MyObjectType Instance 
    { 
        get 
        {                               
            return s_instance; 
        } 
    } 
```

这是失败的。将其更改为：

```
private static MyObjectType s_instance;

public static MyObjectType Instance 
    { 
        get 
        {               
            if (s_instance==null) 
            { 
                s_instance = new MyObjectType(); 
            } 
            return s_instance; 
        } 
    } 
```

解决了这个问题。任何想法为什么最初的使用不起作用，以及这样做是否有任何缺点？

发布 dll 似乎完全可以从另一个托管应用程序中使用。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-20T10:26:47.963

尝试添加（空）静态构造函数，或*在*静态构造函数中初始化单例。

[Jon Skeet在这里](http://www.yoda.arachsys.com/csharp/singleton.html)对单例模式进行了完整的讨论。我不确定它为什么失败，但猜测它可能与“beforefieldinit”标志有关。请参阅他的第 4 个示例，其中他添加了一个静态构造函数来调整此标志。我并不声称自己是 beforefieldinit 方面的专家，但这种症状似乎符合[此处](http://www.yoda.arachsys.com/csharp/beforefieldinit.html)讨论的某些症状。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-20T10:56:19.107

只是重申 Marc Gravell 所说的话，但这听起来*很像*beforefieldinit 问题，这意味着空的静态构造函数是您的解决方案。您需要在类中发布任何和所有构造函数以获得明确的答案。

第二种方法具有延迟加载的优势（这是一个优势）。

# asp.net-mvc - 从控制器操作返回 301 重定向

> ID：217935
> 
> 赞同：20
> 
> 时间：2008-10-20T09:53:10.230
> 
> 标签：asp.net-mvc

在 ASP.net MVC 上，让控制器将 301 重定向返回到外部站点的“正确”方法是什么？

各种 RedirectTo-Function 似乎只返回我手动映射的相对链接或路由，但没有办法说“执行 301 重定向到[http://example.com](http://example.com) ”。

我想我可以设置 Response.StatusCode 或使用 Response.Redirect，但在 MVC 中应该这样做吗？还是有执行重定向的官方“正确方法”？

**更新：**与此同时，我为此写了一个 ActionResult：[PermanentRedirectResult](http://www.stum.de/2008/10/22/permanentredirectresult/)

**更新 2：**从 ASP.net 4.0 开始，永久重定向是[框架的一部分](https://stackoverflow.com/a/11470379/91)。

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2012-07-13T12:20:02.713

采用

```
Response.RedirectPermanent("http://www.google.com"); 
```

或从控制器返回 ActionResult 类型：

```
return RedirectPermanent("http://www.google.com"); 
```

由 ASP.net 4.0 框架提供。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-20T22:26:50.647

由于您正在谈论重定向到您对路由一无所知的 URL（可能是内部页面（想想经典的 ASP.NET）或某些外部资源），那么您唯一能做的就是设置状态代码，并在途中发送用户的浏览器。

在 MVC 中的这个链中，您担心让用户访问他们的视图，但该视图不受您的控制，甚至可能根本不是视图。所以最终你在这种情况下尽你所能，并且据我所知并没有违反任何 MVC“规则”。

我希望这会有所帮助。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-07T15:33:46.697

我执行重定向以支持旧版 URL。

我的控制器看起来像这样……

```
Public Class ThingController
    Inherits System.Web.Mvc.Controller

    Function Details(ByVal id As String) As ActionResult
        Dim RedirectId As Guid
        Select Case key
            Case "legacyurlone"
                RedirectId = New Guid("c564c0c1-c365-4b0c-bc33-fd4eadf0551b")
            Case "legacyurltwo"
                RedirectId = New Guid("157fa15b-8d5d-4f04-87cc-434f7ae93dfa")
            Case Else
                RedirectId = Guid.Empty
        End Select
        If Not RedirectId = Guid.Empty Then
            Response.StatusCode = Net.HttpStatusCode.MovedPermanently
            Response.RedirectLocation = Url.RouteUrl("IdOnly", New With {.id = RedirectId})
            Return Nothing
        End If
        Dim ThingId As Guid = New Guid(id)
        Dim db As New ThingEntities
        Dim Model As Thing = ...
        Return View(Model)
    End Function

    ...

End Class 
```

我现在想知道我是否可以通过两个路由和控制器功能更干净地处理这个问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-20T10:28:55.493

这有帮助吗？[http://blog.eworldui.net/post/2008/04/ASPNET-MVC---Legacy-Url-Routing.aspx](http://blog.eworldui.net/post/2008/04/ASPNET-MVC---Legacy-Url-Routing.aspx)

看起来您只需要用您喜欢的 URL 替换虚拟路径。

# c# - 是否可以遍历文本框的内容？如果不是，那么逐行阅读的最佳策略是什么？

> ID：217938
> 
> 赞同：3
> 
> 时间：2008-10-20T09:53:39.823
> 
> 标签：c#, asp.net

我正在设计一个爬虫，它将从网页中获取某些内容（使用字符串操作或正则表达式）。

我能够将网页的内容作为响应流（使用整个 httpwebrequest 事物）获取，然后出于测试/开发目的，我将流内容写入 ASP.NET 网页中的多行文本框。

我是否可以遍历文本框的内容，然后说“如果 textbox1.text.contains（或将文本框文本保存为字符串变量），则某个字符串会增加一个计数”。文本框的问题是字符串丢失了格式，所以它是一行长的，没有换行符。那可以改变吗？

我想这样做而不是将内容写入文件，因为写入文件意味着我必须处理各种外部问题。当然，如果这是唯一的方法，那就这样吧。如果我必须写入文件，那么遍历每一行的最佳策略是什么（我有点不知所措，因此感到困惑，因为有许多逻辑和语言方法可供使用），寻找条件？因此，如果我想在以下文本中查找字符串“Hello”：

我的名字是 xyz 我是 xyz 岁 你好等等等等再见

当我打招呼时，我想增加一个整数变量。

谢谢，

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-20T10:05:06.183

在我看来，您可以将文本内容拆分为单词而不是行：

```
public int CountOccurences(string searchString)
{
    int i;
    var words = txtBox.Text.Split(" ");

    foreach (var s in words)
        if (s.Contains(searchString))
           i++;

    return i;
} 
```

如果我正确理解您的目的，则无需保留换行符。

另请注意，这不适用于多个单词搜索。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-20T15:51:02.413

为什么你需要一个文本框？您的真正目标是根据爬虫找到的文本增加一个计数器。您可以通过检查流本身来完成此操作：

```
 Stream response = webRequest.GetResponse().GetResponseStream();
  StreamReader reader = new StreamReader(response);
  String line = null;

  while ( line = reader.ReadLine() ) 
  {
    if (line.Contains("hello"))
    {
      // increment your counter
    }
  } 
```

如果行包含多个相关字符串的实例，则扩展此作为练习留给读者:)。

如果您想手动检查内容，您仍然可以将内容写入文本框，但尝试遍历文本框的行只会掩盖问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-20T09:57:39.520

我在一个项目中这样做，可能有更好的方法，但这有效:)

```
string template = txtTemplate.Text;
            string[] lines = template.Split(Environment.NewLine.ToCharArray()); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-20T10:04:50.863

这是一个很好的创意方式。

但是，我正在返回一个复杂的 HTML 文档（出于测试目的，我使用的是 Microsoft 的主页，所以我得到了所有的 HTML）。我不必指定要在哪里换行吗？

给定您的方法，如果每一行都在一个集合中（虽然我有），那么我可以遍历集合的每个成员并查找我想要的条件。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-20T10:23:49.607

如果返回的文本框内容带有表示自动换行位置的换行符，则该结果将取决于样式（例如字体大小、文本框的宽度等），而不是用户实际输入的内容。根据您实际想要做什么，这几乎肯定不是您想要的。

如果用户物理按下“回车/回车”键，则相关字符将包含在字符串中。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-20T16:36:37.563

文本框用于显示 html 页面的内容。这是供我使用的，所以如果我在没有任何断点的情况下运行网页，我可以看到流是否在视觉上被返回。此外，这是客户要求，因此他们可以看到每一步发生的情况。真的不值得额外的代码行，但它真的很微不足道，也是我最关心的问题。

while 循环中的代码我不明白。转到下一行的指令在哪里？这是我使用 readline 方法的弱点，因为我很少看到强制读取下一行的逻辑。

我确实需要将该行存储为找到某个字符串的字符串 var，因为我需要执行一些操作（以及字符串的某个部分），所以我一直在查看 readline。

谢谢！

# wcf - WCF 收到未知消息事件

> ID：217940
> 
> 赞同：2
> 
> 时间：2008-10-20T09:54:46.297
> 
> 标签：wcf, events

有谁知道 WCF ServiceHost 上的 UnknownMessageReceived 事件何时会被触发？

我有一些代码在其中捕获了 Faulted en UnknownMessageReceived 事件，但即使我向特定服务发布错误消息，我也从未收到该事件。

约臣

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2011-01-04T20:27:24.853

当我错误地指定了这样的地址时，我遇到了这个事件： [http://localhost:4000/SomeService//mex](http://localhost:4000/SomeService//mex)

**注意双斜杠**

该服务托管在 WPF 应用程序中。因此，我还发现此事件是在与主/ui 线程不同的线程上引发的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-12-10T08:28:35.437

当服务在通道上接收到消息时，通道堆栈顶部的 ChannelDispatcher 对象会查询其关联的每个 EndpointDispatcher 对象以确定哪个端点可以处理该消息。如果没有任何 EndpointDispatcher 对象可以接受该消息，WCF 运行时会在承载该服务的 ServiceHost 对象上引发 UnknownMessageReceived 事件。第 3 章，使应用程序和服务健壮”，描述了如何处理此事件。©（Microsoft® Windows® Communication Foundation Step by Step by John Sharp）。 [http://download.microsoft.com/download/f/c/7/fc7d048b-b7a5-4add-be2c-baaee38091e3/9780735623361_MSWindowsCommFoundationSBS_ch13.pdf](http://download.microsoft.com/download/f/c/7/fc7d048b-b7a5-4add-be2c-baaee38091e3/9780735623361_MSWindowsCommFoundationSBS_ch13.pdf)

我也试图提升这个事件 - 没有成功。在常见情况下（在客户端）我有一个错误的消息异常。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-21T15:52:02.583

Wenlong Dong的[一篇博客文章](http://blogs.msdn.com/wenlong/archive/2006/01/11/511514.aspx)（是的，我知道）可能会为您指明正确的方向。我相信文龙是 MS 的 WCF 团队的成员。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-10-20T16:52:59.977

我猜（虽然不确定）这意味着您收到（返回）合同中未定义的消息。

# asp.net - ASP.NET 手风琴

> ID：217941
> 
> 赞同：0
> 
> 时间：2008-10-20T09:55:14.237
> 
> 标签：asp.net, accordion

所以我正在修改别人的代码，他们使用了数据绑定的 Accordion 控件。我需要禁用 Accordion 功能，以便扩展顶部项目，而将其余项目最小化并保持这种方式。

还有什么办法可以在最终项目上放一个类？

提前非常感谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-23T21:17:32.440

最简单的方法可能是将 Accordion 控件替换为Repeater，该Repeater 的样式看起来像当前的Accordion。

但是，要尝试回答您的问题：

创建一个仅将 SelectedIndex 设置为 0 的 OnItemCommand 事件处理程序。这样用户就无法打开 Accordion 中的任何其他项目。

至于最终项目的样式，您必须创建一个 OnItemDataBound 事件处理程序，该处理程序知道您的集合中有多少项目，然后计算它已绑定的项目。当该方法使用与集合大小匹配的索引绑定项目时，您只需将项目的 CssClass 设置为最终项目的类。（如果您要用另一个控件替换 Accordion，同样的技术也应该起作用。）

检查问题的第一个答案“[如何将 ASP.net ajax AccordionPane 绑定到 XMLDatasource？](https://stackoverflow.com/questions/127832/how-do-i-bind-an-aspnet-ajax-accordionpane-to-an-xmldatasource)' 对于 ItemDataBound 事件处理程序的示例。

# database - 我可以在一个表中有多个主键吗？

> ID：217945
> 
> 赞同：425
> 
> 时间：2008-10-20T09:56:23.283
> 
> 标签：database, database-design, primary-key, composite-primary-key

我可以在一个表中有多个主键吗？

* * *

## 回答 #1

> 赞同：620
> 
> 时间：2008-10-20T10:00:10.060

一个表可以有一个**复合主键**，它是由两列或多列组成的主键。例如：

```
CREATE TABLE userdata (
  userid INT,
  userdataid INT,
  info char(200),
  primary key (userid, userdataid)
); 
```

**更新：** [这是一个](http://weblogs.sqlteam.com/jeffs/archive/2007/08/23/composite_primary_keys.aspx)包含复合主键更详细描述的链接。

* * *

## 回答 #2

> 赞同：217
> 
> 时间：2008-10-20T09:57:40.817

您只能有一个主键，但您的主键中可以有多个列。

您还可以在您的表上使用唯一索引，它的工作方式有点像主键，因为它们将强制执行唯一值，并加快对这些值的查询。

* * *

## 回答 #3

> 赞同：44
> 
> 时间：2008-10-21T21:00:53.753

一个表可以有多个候选键。每个候选键是一个列或一组列，它们是唯一的、加在一起的，并且也不是 NULL。因此，为任何候选键的所有列指定值就足以确定有一行满足条件，或者根本没有行。

候选键是关系数据模型中的一个基本概念。

通常的做法是，如果一个表中存在多个键，则将其中一个候选键指定为主键。使表的任何外键引用主键而不是任何其他候选键也是常见的做法。

我推荐这些做法，但是在关系模型中没有任何东西需要在候选键中选择一个主键。

* * *

## 回答 #4

> 赞同：16
> 
> 时间：2011-06-17T08:16:55.323

这是主要问题和@Kalmi 的问题的答案

> 拥有多个自动生成的列有什么意义？

下面的代码有一个复合主键。它的一列是自动递增的。这仅适用于 MyISAM。InnoDB 会产生一个错误“ *ERROR 1075 (42000): Incorrect table definition; can only be one auto column and it must be defined as a key* ”。

```
DROP TABLE IF EXISTS `test`.`animals`;
CREATE TABLE  `test`.`animals` (
  `grp` char(30) NOT NULL,
  `id` mediumint(9) NOT NULL AUTO_INCREMENT,
  `name` char(30) NOT NULL,
  PRIMARY KEY (`grp`,`id`)
) ENGINE=MyISAM;

INSERT INTO animals (grp,name) VALUES
    ('mammal','dog'),('mammal','cat'),
    ('bird','penguin'),('fish','lax'),('mammal','whale'),
    ('bird','ostrich');

SELECT * FROM animals ORDER BY grp,id;

Which returns:

+--------+----+---------+
| grp    | id | name    |
+--------+----+---------+
| fish   |  1 | lax     |
| mammal |  1 | dog     |
| mammal |  2 | cat     |
| mammal |  3 | whale   |
| bird   |  1 | penguin |
| bird   |  2 | ostrich |
+--------+----+---------+ 
```

* * *

## 回答 #5

> 赞同：14
> 
> 时间：2018-04-08T04:57:44.913

（一直在研究这些，很多）

**候选键**- 唯一标识表行所需的最小列组合。
**复合键**- 2 列或更多列。

*   一个表中可以存在 多个**候选键。**
    *   **Primary KEY** - 只有我们*选择的候选键之一*
    *   **备用键**- 所有*其他*候选键
        *   主键和备用键都可以是**复合键**

来源：
[https://en.wikipedia.org/wiki/Superkey](https://en.wikipedia.org/wiki/Superkey)
[https://en.wikipedia.org/wiki/Candidate_key](https://en.wikipedia.org/wiki/Candidate_key)
[https://en.wikipedia.org/wiki/Primary_key](https://en.wikipedia.org/wiki/Primary_key)
[https://en.wikipedia.org /wiki/复合键](https://en.wikipedia.org/wiki/Compound_key)

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2011-06-17T08:27:11.970

正如其他人所指出的，可以有多列主键。然而应该注意的是，如果你有一些没有被键引入的[函数依赖](http://en.wikipedia.org/wiki/Functional_dependency)，你应该考虑[规范化](http://en.wikipedia.org/wiki/Database_normalization)你的关系。

例子：

```
Person(id, name, email, street, zip_code, area) 
```

之间可能存在函数依赖，`id -> name,email, street, zip_code and area` 但通常 a`zip_code`与 a 相关联`area`，因此 之间存在内部函数依赖`zip_code -> area`。

因此，可以考虑将其拆分为另一个表：

```
Person(id, name, email, street, zip_code)
Area(zip_code, name) 
```

使其符合[第三范式](http://en.wikipedia.org/wiki/Third_normal_form)。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2016-04-04T05:57:34.900

Primary Key 是非常不幸的符号，因为“Primary”的内涵以及与逻辑模型的潜意识关联。因此，我避免使用它。相反，我指的是物理模型的代理键和逻辑模型的自然键。

重要的是，每个实体的逻辑模型都至少有一组“业务属性”，这些“业务属性”构成了实体的键。Boyce、Codd、Date 等人在关系模型中将这些称为候选键。然后，当我们为这些实体构建表时，它们的候选键成为这些表中的自然键。只有通过这些自然键，用户才能唯一标识表中的行；因为代理键应始终对用户隐藏。这是因为代理键没有商业意义。

然而，如果没有代理键，我们表的物理模型在许多情况下效率会很低。回想一下，非聚集索引的未覆盖列只能（通常）通过键查找到聚集索引中找到（暂时忽略作为堆实现的表）。当我们可用的自然键很宽时，这（1）加宽了我们的非聚集叶节点的宽度，增加了存储需求和读取访问，以查找和扫描该非聚集索引；(2) 减少聚集索引的扇出，增加索引高度和索引大小，再次增加聚集索引的读取和存储需求；(3) 增加对我们的聚集索引的缓存要求。从缓存中追逐其他索引和数据。

这是一个小的代理键，指定给 RDBMS 作为“主键”证明是有益的。当设置为聚簇键时，用于从非聚簇索引到聚簇索引的键查找和从相关表的外键查找，所有这些缺点都消失了。我们的聚集索引扇出再次增加以减少聚集索引的高度和大小，减少聚集索引的缓存负载，减少通过任何机制访问数据时的读取（无论是索引扫描、索引查找、非聚集键查找还是外键查找）并减少我们表的聚集索引和非聚集索引的存储需求。

请注意，这些好处仅在代理键和集群键都很小时才会出现。如果使用 GUID 作为集群键，情况通常会比使用最小可用自然键时更糟。如果表被组织为一个堆，那么 8 字节（堆）的 RowID 将用于键查找，这比 16 字节的 GUID 好，但性能低于 4 字节的整数。

如果由于业务限制必须使用 GUID，那么搜索更好的集群键是值得的。例如，如果一个小的站点标识符和 4 字节的“站点序列号”是可行的，那么该设计可能比作为代理键的 GUID 提供更好的性能。

如果堆（可能是散列连接）的结果使其成为首选存储，则需要在权衡分析中平衡更广泛集群密钥的成本。

考虑这个例子::

```
ALTER TABLE Persons
ADD CONSTRAINT pk_PersonID PRIMARY KEY (P_Id,LastName) 
```

其中元组“ *(P_Id,LastName)* ”需要唯一性约束，并且可能是一个冗长的 Unicode LastName 加上一个 4 字节整数，最好 (1) 以声明方式将此约束强制为“ *ADD CONSTRAINT pk_PersonID UNIQUE NONCLUSTERED (P_Id ,LastName)* " 和 (2) 分别声明一个小的代理键作为聚簇索引的“*主键*”。值得注意的是，Anita 可能只希望将 LastName 添加到此约束中，以使其成为一个覆盖字段，这在聚集索引中是不必要的，因为所有字段都被它覆盖。

SQL Server 中将主键指定为非集群的能力是一个不幸的历史情况，因为将“首选自然键或候选键”（来自逻辑模型）的含义与物理模型中的“存储中的查找键”的含义混为一谈。模型。我的理解是，最初 SYBASE SQL Server 总是使用 4 字节的 RowID，无论是在堆还是聚集索引中，作为物理模型中的“存储中的查找键”。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-10-20T17:53:50.107

有些人使用术语“主键”来准确表示一个整数列，该列通过某种自动机制生成其值。例如`AUTO_INCREMENT`在 MySQL 或`IDENTITY`Microsoft SQL Server 中。你在这个意义上使用主键吗？

如果是这样，答案取决于您使用的数据库品牌。在 MySQL 中，你不能这样做，你会得到一个错误：

```
mysql> create table foo (
  id int primary key auto_increment, 
  id2 int auto_increment
);
ERROR 1075 (42000): Incorrect table definition; 
there can be only one auto column and it must be defined as a key 
```

在其他一些品牌的数据库中，您可以在一个表中定义多个自动生成列。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2013-05-28T15:42:57.417

主键是唯一标识一条记录并在所有索引中使用的键。这就是为什么你不能拥有多个。它通常也是用于连接子表的键，但这不是必需的。PK 的真正目的是确保某些东西允许您唯一标识一条记录，以便数据更改影响正确的记录，从而可以创建索引。

但是，您可以将多个字段放在一个主键中（复合 PK）。这将使您的连接变慢（特别是如果它们是较大的字符串类型字段）并且您的索引更大，但它可能会消除在某些子表中进行连接的需要，因此就性能和设计而言，将其作为案例案例基础。当你这样做时，每个字段本身不是唯一的，但它们的组合是唯一的。如果复合键中的一个或多个字段也应该是唯一的，那么您需要一个唯一索引。但是，如果一个字段是唯一的，这很可能是 PK 的更好候选者。

现在有时，您有不止一个 PK 候选人。在这种情况下，您选择一个作为 PK 或使用代理键（我个人更喜欢这种情况下的代理键）。并且（这很关键！）您为每个未被选为 PK 的候选键添加唯一索引。如果数据需要唯一，不管是不是PK，都需要一个唯一的索引。这是一个数据完整性问题。（请注意，任何时候使用代理键时也是如此；人们会因为代理键而陷入麻烦，因为他们忘记在候选键上创建唯一索引。）

有时您需要多个代理键（如果您有代理键，通常是 PK）。在这种情况下，您想要的不是更多的 PK，而是更多带有自动生成键的字段。大多数数据库不允许这样做，但有一些方法可以绕过它。首先考虑是否可以根据第一个自动生成的键（例如 Field1 * -1）计算第二个字段，或者可能需要第二个自动生成的键确实意味着您应该创建一个相关表。相关表可以是一对一的关系。您可以通过将父表中的 PK 添加到子表中，然后将新的自动生成字段添加到表中，然后添加适合该表的任何字段来强制执行此操作。然后选择两个键中的一个作为 PK，并在另一个上放置唯一索引（自动生成的字段不必是 PK）。并确保将 FK 添加到父表中的字段。通常，如果子表没有其他字段，则需要检查为什么您认为需要两个自动生成的字段。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2017-09-29T21:53:47.247

同时拥有两个主键是不可能的。但是（假设您没有用复合键搞砸情况），您可能需要使一个属性唯一。

```
CREATE t1(
c1 int NOT NULL,
c2 int NOT NULL UNIQUE,
...,
PRIMARY KEY (c1)
); 
```

但是请注意，在关系数据库中，“超级键”是唯一标识表中的元组或行的属性子集。“键”是“超级键”，它具有从键中删除任何属性的附加属性，使该键不再是“超级键”（或者简单地说，“键”是最小的超级键）。如果有更多的键，它们都是候选键。我们选择其中一个候选键作为主键。这就是为什么谈论一个关系或表的多个主键是一种冲突。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2012-09-16T19:09:51.510

以比我能做的更好的方式给出了好的技术答案。我只能添加到这个主题：

如果您想要一些不允许/不可接受的东西，那么有充分的理由退后一步。

1.  了解为什么它不可接受的核心。
2.  在文档/期刊文章/网络等中挖掘更多信息。
3.  分析/审查当前的设计并指出主要缺陷。
4.  考虑和测试新设计中的每一步。
5.  始终期待并尝试创建自适应解决方案。

希望它会帮助某人。

* * *

## 回答 #12

> 赞同：-3
> 
> 时间：2009-01-07T11:44:55.743

是的，它在 SQL 中是可能的，但我们不能在 MsAccess 中设置多个主键。然后，我不知道其他数据库。

```
CREATE TABLE CHAPTER (
    BOOK_ISBN VARCHAR(50) NOT NULL,
    IDX INT NOT NULL,
    TITLE VARCHAR(100) NOT NULL,
    NUM_OF_PAGES INT,
    PRIMARY KEY (BOOK_ISBN, IDX)
); 
```

# .net - 获取 cmd.exe 的当前工作目录

> ID：217951
> 
> 赞同：16
> 
> 时间：2008-10-20T09:59:48.330
> 
> 标签：.net, winapi, directory, cmd

如何检索 cmd.exe 的当前工作目录？

这似乎是可能的。例如使用 ProcessExplorer，选择 CMD.exe，右键单击，属性，图像选项卡，“当前目录”反映使用 CD 或 CHDIR 命令设置的目录。

我查看了 .NET Process 和 ProcessStartInfo 类（ProcessStartInfo.WorkingDirectory 总是返回“”），但似乎找不到确定这一点的方法。[PInvoke](http://www.pinvoke.net/)也没有什么特别突出的。

作为一个例子，我希望能够以编程方式说出类似这样的话： Process.GetCurrentWorkingDirectory(processID) 其中 processID 是另一个正在运行的进程的 Windows 进程 ID。

有没有解决方案，WinAPI 或 .NET？

[更新]

问这个问题的原因：

我已经使用“命令提示符资源管理器栏”有一段时间了，它很棒，除非我“CD”到一个新目录，当前的资源管理器窗口也不会改变。（即同步只是从资源管理器到命令提示符的一种方式）。我正在寻找这两种方式。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-20T10:55:37.437

未经测试，一种可能的方法：

创建一个带有 DllMain 的 DLL，该 DllMain 使用 GetThreadStartInformation() 来查找缓冲区的地址，然后使用 GetCurrentDirectory 来填充它。这应该没问题，因为这两个函数都在 kernel32 中，它始终存在。你需要有一些结构来返回成功/失败。

1.  获取 cmd.exe 进程的句柄。
2.  在那里分配一些内存（VirtualAllocEx）
3.  将 DLL 的路径放在内存中。（写进程内存）
4.  将您的 dll 加载到 cmd.exe 地址空间中。（CreateRemoteThread 的入口点为 LoadLibrary，参数是您之前分配的内存。）
5.  WaitForSingleObject 后跟 GetExitCodeThread()，在 cmd.exe 进程中为您提供 DLL 的 HMODULE。
6.  ReadProcessMemory 获取当前目录。
7.  从 cmd.exe 地址空间中卸载您的 dll。CreateRemote Thread，入口点为 FreeLibrary，参数为 HMODULE。
8.  WaitForSingleObject 等待 DLL 卸载。

粗略的草图：细节留作练习！风险：在 cmd.exe 地址空间分配内存，改变其状态。必须小心在 DllMain 中调用的函数。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-20T10:04:57.710

您是指批处理文件中的 %CD% 变量吗？

像这样：

```
set OLDDIR=%CD%
.. do stuff ..
chdir /d %OLDDIR% &rem restore current directory 
```

在命令提示符下尝试**echo %CD% 。**:)

好吧，这正是您所需要的，这里有一个**PowerShell**函数可以做到这一点：

```
$(get-location) 
```

希望这可以帮助。

[我从这里](http://winpowershell.blogspot.com/2006/08/powershell-prompt-part-2.html)找到了这一切。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-20T17:56:35.387

也许[Sysinternals 论坛上的这个论坛条目](http://forum.sysinternals.com/forum_posts.asp?TID=629)包含解决方案的提示。在 GetProcessStrings 函数中查找：

```
// Get Command Line Block

// At offset 0x00020498 is the process current directory followed by

// the system PATH. After that is the process full command line, followed

// by the exe name and the windows station it's running on. 
```

这篇 CodeProject 文章“[读取远程进程的环境字符串](http://www.codeproject.com/KB/threads/ReadProcEnv.aspx)”也很有用。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-20T14:55:36.517

> **更新：**这**不是**解决方案，请参阅对此答案的评论：*“正如 Janm 所说，.Modules[0].FileName (或 MainModuile.FileName) 给出了在该进程中运行的可执行文件的位置。我正在寻找当前工作目录（可以使用 CD 或 CHDIR 命令更改）。”*

您可以使用**System.Diagnostics Namespace**。这里以 C# 控制台应用程序为例。从文件名中，您可以轻松提取路径信息（System.IO.Path...）。

您将确保拥有执行此操作的权限（以管理员身份运行）。

希望这可以帮助。这是**工作代码**（经过测试）：

```
using System;
using System.Diagnostics;
using System.IO;

namespace Test
{
    class Program
    {
        static void Main(string[] args)
        {
            Process[] procList =  Process.GetProcessesByName("cmd");

            string sFileName;

            for (int i = 0; i < procList.Length; i++ )
            {
                Console.Write(procList[i].Id);
                Console.Write(" ");

                try
                {
                    sFileName = procList[i].Modules[0].FileName;
                    Console.Write("(");
                    Console.Write(Path.GetFileName(sFileName));
                    Console.Write("): ");
                    Console.WriteLine(Path.GetDirectoryName(sFileName));
                }
                catch (Exception ex)
                {
                    // catch "Access denied" etc.
                    Console.WriteLine(ex.Message);
                }

            }

        }
    }
} 
```

这是我机器上的**输出**（我打开了四个命令行）：

[替代文字 http://img236.imageshack.us/img236/3547/processworkingdirvn4.png](http://img236.imageshack.us/img236/3547/processworkingdirvn4.png)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-05T07:44:46.540

试试这个简单的环境属性：

Environment.CurrentDirectory()

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-14T08:17:11.673

请参阅[我](https://stackoverflow.com/questions/439653/getting-process-information-in-net#442255)对类似问题的回答（我自己）。我编写了一个命令行实用程序和 C# 包装器来读取进程环境变量。对于我的问题（获取 java 的当前目录），我只是阅读了 catalina_base 目录。

我不确定这是否直接适用于 cmd.exe。代码项目文章中提供的实用程序无法与 cmd.exe 一起使用。

# windows - 如何从 Windows 命令行执行 HTTP HEAD 请求？

> ID：217955
> 
> 赞同：14
> 
> 时间：2008-10-20T10:02:31.693
> 
> 标签：windows, http, command-line, windows-vista

Windows（Vista）命令行上获取远程网络服务器上文件的大小和修改时间的最佳方法（或工具）是什么，而不下载它？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-20T10:06:24.900

wget有一个[Win32 端口](http://gnuwin32.sourceforge.net/packages/wget.htm)可以正常工作。

PowerShell`Invoke-WebRequest -Method Head`也可以。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2011-04-12T09:24:55.553

如果您无法安装其他应用程序，那么您可以远程登录远程服务器（您需要按照此操作为您的 Windows 7 安装此功能[）](http://www.fettesps.com/windows-7-enable-telnet/)：

```
TELNET server_name 80 
```

其次是：

```
HEAD /virtual/directory/file.ext 
```

或者

```
GET /virtual/directory/file.ext 
```

取决于您是否只想要标题（HEAD）或完整内容（GET）

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-10-20T10:15:19.330

在 Linux 上，我经常将 curl 与 --head 参数一起使用。它适用于多种操作系统，包括 Windows。

[编辑] 与下面的答案相关，gknw.net 目前已于 2012 年 2 月 23 日关闭。检查 curl.haxx.se 以获取更新信息。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2010-07-28T18:03:36.040

1) 查看从 GET 请求返回的标头

```
wget --server-response -O /dev/null http://.... 
```

1a) 保存从 GET 请求返回的标头

```
wget --server-response -o headers -O /dev/null http://.... 
```

2) 查看从 GET HEAD 请求返回的标头

```
wget --server-response --spider http://.... 
```

2a) 保存从 GET HEAD 请求返回的标头

```
wget --server-response --spider -o headers http://.... 
```

*   大卫

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-20T10:06:29.097

我会下载[PuTTY](http://www.chiark.greenend.org.uk/~sgtatham/putty/download.html)并在端口 80 上运行一个远程登录会话到你想要的网络服务器

```
HEAD /resource HTTP/1.1
Host: www.example.com 
```

您也可以下载[Perl](http://strawberryperl.com)并尝试 LWP 的 HEAD 命令。或者编写自己的脚本。

# javascript - 如何在 Google Chrome JavaScript 控制台中打印调试消息？

> ID：217957
> 
> 赞同：476
> 
> 时间：2008-10-20T10:03:08.917
> 
> 标签：javascript, console, debugging, google-chrome

如何在 Google Chrome JavaScript 控制台中打印调试消息？

请注意，JavaScript 控制台与 JavaScript 调试器不同；它们具有不同的语法 AFAIK，因此 JavaScript 调试器中的**打印**命令在这里不起作用。在 JavaScript 控制台中，`print()`将参数发送到打印机。

* * *

## 回答 #1

> 赞同：602
> 
> 时间：2008-10-20T10:20:23.517

从浏览器地址栏执行以下代码：

```
javascript: 控制台.log(2);

```

成功将消息打印到 Google Chrome 中的“JavaScript 控制台”。

* * *

## 回答 #2

> 赞同：167
> 
> 时间：2010-05-03T11:01:31.433

改进 Andru 的想法，如果它们不存在，您可以编写一个创建控制台函数的脚本：

```
if (!window.console) console = {};
console.log = console.log || function(){};
console.warn = console.warn || function(){};
console.error = console.error || function(){};
console.info = console.info || function(){}; 
```

然后，使用以下任一方法：

```
console.log(...);
console.error(...);
console.info(...);
console.warn(...); 
```

这些函数将记录不同类型的项目（可以根据日志、信息、错误或警告进行过滤），并且在控制台不可用时不会导致错误。这些函数将在 Firebug 和 Chrome 控制台中运行。

* * *

## 回答 #3

> 赞同：47
> 
> 时间：2013-10-22T07:44:26.180

Just add a cool feature which a lot of developers miss:

```
console.log("this is %o, event is %o, host is %s", this, e, location.host); 
```

This is the magical `%o` dump *clickable and deep-browsable* content of a JavaScript object. `%s` was shown just for a record.

Also this is cool too:

```
console.log("%s", new Error().stack); 
```

Which gives a Java-like stack trace to the point of the `new Error()` invocation (including *path to file and line number*!).

Both `%o` and `new Error().stack` are available in Chrome and Firefox!

Also for stack traces in Firefox use:

```
console.trace(); 
```

As [https://developer.mozilla.org/en-US/docs/Web/API/console](https://developer.mozilla.org/en-US/docs/Web/API/console) says.

Happy hacking!

**UPDATE**: Some libraries are written by bad people which redefine the `console` object for their own purposes. To restore the original browser `console` after loading library, use:

```
delete console.log;
delete console.warn;
.... 
```

See Stack Overflow question *[Restoring console.log()](https://stackoverflow.com/questions/7089443)*.

* * *

## 回答 #4

> 赞同：17
> 
> 时间：2009-05-28T12:59:48.717

只是一个快速警告——如果你想在 Internet Explorer 中进行测试而不删除所有的 console.log()，你需要使用[Firebug Lite](http://getfirebug.com/lite.html)，否则你会得到一些不是特别友好的错误。

（或者创建你自己的 console.log() ，它只返回 false。）

* * *

## 回答 #5

> 赞同：17
> 
> 时间：2010-09-16T13:28:55.600

这是一个简短的脚本，用于检查控制台是否可用。如果不是，它会尝试加载[Firebug](http://en.wikipedia.org/wiki/Firebug_%28software%29)，如果 Firebug 不可用，它会加载 Firebug Lite。现在您可以`console.log`在任何浏览器中使用。享受！

```
if (!window['console']) {

    // Enable console
    if (window['loadFirebugConsole']) {
        window.loadFirebugConsole();
    }
    else {
        // No console, use Firebug Lite
        var firebugLite = function(F, i, r, e, b, u, g, L, I, T, E) {
            if (F.getElementById(b))
                return;
            E = F[i+'NS']&&F.documentElement.namespaceURI;
            E = E ? F[i + 'NS'](E, 'script') : F[i]('script');
            E[r]('id', b);
            E[r]('src', I + g + T);
            E[r](b, u);
            (F[e]('head')[0] || F[e]('body')[0]).appendChild(E);
            E = new Image;
            E[r]('src', I + L);
        };
        firebugLite(
            document, 'createElement', 'setAttribute', 'getElementsByTagName',
            'FirebugLite', '4', 'firebug-lite.js',
            'releases/lite/latest/skin/xp/sprite.png',
            'https://getfirebug.com/', '#startOpened');
    }
}
else {
    // Console is already available, no action needed.
} 
```

* * *

## 回答 #6

> 赞同：13
> 
> 时间：2012-09-25T10:14:27.187

In addition to [Delan Azabani's answer](https://stackoverflow.com/a/2757552/60518), I like to share my `console.js`, and I use for the same purpose. I create a noop console using an array of function names, what is in my opinion a very convenient way to do this, and I took care of Internet Explorer, which has a `console.log` function, but no `console.debug`:

```
// Create a noop console object if the browser doesn't provide one...
if (!window.console){
  window.console = {};
}

// Internet Explorer has a console that has a 'log' function, but no 'debug'. To make console.debug work in Internet Explorer,
// We just map the function (extend for info, etc. if needed)
else {
  if (!window.console.debug && typeof window.console.log !== 'undefined') {
    window.console.debug = window.console.log;
  }
}

// ... and create all functions we expect the console to have (taken from Firebug).
var names = ["log", "debug", "info", "warn", "error", "assert", "dir", "dirxml",
    "group", "groupEnd", "time", "timeEnd", "count", "trace", "profile", "profileEnd"];

for (var i = 0; i < names.length; ++i){
  if(!window.console[names[i]]){
    window.console[names[i]] = function() {};
  }
} 
```

* * *

## 回答 #7

> 赞同：12
> 
> 时间：2011-05-22T06:51:00.053

Or use this function:

```
function log(message){
    if (typeof console == "object") {
        console.log(message);
    }
} 
```

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2010-11-16T03:18:23.927

这是我的控制台包装类。它也给了我范围输出，让生活更轻松。请注意使用`localConsole.debug.call()`so that`localConsole.debug`在调用类的范围内运行，提供对其`toString`方法的访问。

```
localConsole = {

    info: function(caller, msg, args) {
        if ( window.console && window.console.info ) {
            var params = [(this.className) ? this.className : this.toString() + '.' + caller + '(), ' + msg];
            if (args) {
                params = params.concat(args);
            }
            console.info.apply(console, params);
        }
    },

    debug: function(caller, msg, args) {
        if ( window.console && window.console.debug ) {
            var params = [(this.className) ? this.className : this.toString() + '.' + caller + '(), ' + msg];
            if (args) {
                params = params.concat(args);
            }
            console.debug.apply(console, params);
        }
    }
};

someClass = {

    toString: function(){
        return 'In scope of someClass';
    },

    someFunc: function() {

        myObj = {
            dr: 'zeus',
            cat: 'hat'
        };

        localConsole.debug.call(this, 'someFunc', 'myObj: ', myObj);
    }
};

someClass.someFunc(); 
```

This gives output like so in [Firebug](http://en.wikipedia.org/wiki/Firebug_%28software%29):

```
In scope of someClass.someFunc(), myObj: Object { dr="zeus", more...} 
```

Or Chrome:

```
In scope of someClass.someFunc(), obj:
Object
cat: "hat"
dr: "zeus"
__proto__: Object 
```

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2011-10-11T12:42:41.040

Personally I use this, which is similar to tarek11011's:

```
// Use a less-common namespace than just 'log'
function myLog(msg)
{
    // Attempt to send a message to the console
    try
    {
        console.log(msg);
    }
    // Fail gracefully if it does not exist
    catch(e){}
} 
```

The main point is that it's a good idea to at least have some practice of logging other than just sticking `console.log()` right into your JavaScript code, because if you forget about it, and it's on a production site, it can potentially break all of the JavaScript code for that page.

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2012-06-23T05:22:09.693

You could use `console.log()` if you have a debugged code in what programming software editor you have and you will see the output mostly likely the best editor for me (Google Chrome). Just press `F12` and press the Console tab. You will see the result. Happy coding. :)

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2013-06-10T02:54:12.637

I've had a lot of issues with developers checking in their console.() statements. And, I really don't like debugging Internet Explorer, despite the fantastic improvements of [Internet Explorer 10](http://en.wikipedia.org/wiki/Internet_Explorer_11#Internet_Explorer_10) and [Visual Studio 2012](http://en.wikipedia.org/wiki/Microsoft_Visual_Studio#Visual_Studio_2012), etc.

So, I've overridden the console object itself... I've added a __localhost flag that only allows console statements when on localhost. I also added console.() functions to Internet Explorer (that displays an alert() instead).

```
// Console extensions...
(function() {
    var __localhost = (document.location.host === "localhost"),
        __allow_examine = true;

    if (!console) {
        console = {};
    }

    console.__log = console.log;
    console.log = function() {
        if (__localhost) {
            if (typeof console !== "undefined" && typeof console.__log === "function") {
                console.__log(arguments);
            } else {
                var i, msg = "";
                for (i = 0; i < arguments.length; ++i) {
                    msg += arguments[i] + "\r\n";
                }
                alert(msg);
            }
        }
    };

    console.__info = console.info;
    console.info = function() {
        if (__localhost) {
            if (typeof console !== "undefined" && typeof console.__info === "function") {
                console.__info(arguments);
            } else {
                var i, msg = "";
                for (i = 0; i < arguments.length; ++i) {
                    msg += arguments[i] + "\r\n";
                }
                alert(msg);
            }
        }
    };

    console.__warn = console.warn;
    console.warn = function() {
        if (__localhost) {
            if (typeof console !== "undefined" && typeof console.__warn === "function") {
                console.__warn(arguments);
            } else {
                var i, msg = "";
                for (i = 0; i < arguments.length; ++i) {
                    msg += arguments[i] + "\r\n";
                }
                alert(msg);
            }
        }
    };

    console.__error = console.error;
    console.error = function() {
        if (__localhost) {
            if (typeof console !== "undefined" && typeof console.__error === "function") {
                console.__error(arguments);
            } else {
                var i, msg = "";
                for (i = 0; i < arguments.length; ++i) {
                    msg += arguments[i] + "\r\n";
                }
                alert(msg);
            }
        }
    };

    console.__group = console.group;
    console.group = function() {
        if (__localhost) {
            if (typeof console !== "undefined" && typeof console.__group === "function") {
                console.__group(arguments);
            } else {
                var i, msg = "";
                for (i = 0; i < arguments.length; ++i) {
                    msg += arguments[i] + "\r\n";
                }
                alert("group:\r\n" + msg + "{");
            }
        }
    };

    console.__groupEnd = console.groupEnd;
    console.groupEnd = function() {
        if (__localhost) {
            if (typeof console !== "undefined" && typeof console.__groupEnd === "function") {
                console.__groupEnd(arguments);
            } else {
                var i, msg = "";
                for (i = 0; i < arguments.length; ++i) {
                    msg += arguments[i] + "\r\n";
                }
                alert(msg + "\r\n}");
            }
        }
    };

    /// <summary>
    /// Clever way to leave hundreds of debug output messages in the code,
    /// but not see _everything_ when you only want to see _some_ of the
    /// debugging messages.
    /// </summary>
    /// <remarks>
    /// To enable __examine_() statements for sections/groups of code, type the
    /// following in your browser's console:
    ///       top.__examine_ABC = true;
    /// This will enable only the console.examine("ABC", ... ) statements
    /// in the code.
    /// </remarks>
    console.examine = function() {
        if (!__allow_examine) {
            return;
        }
        if (arguments.length > 0) {
            var obj = top["__examine_" + arguments[0]];
            if (obj && obj === true) {
                console.log(arguments.splice(0, 1));
            }
        }
    };
})(); 
```

Example use:

```
 console.log("hello"); 
```

Chrome/Firefox:

```
 prints hello in the console window. 
```

Internet Explorer:

```
 displays an alert with 'hello'. 
```

For those who look closely at the code, you'll discover the console.examine() function. I created this years ago so that I can leave debug code in certain areas around the product to help troubleshoot [QA](https://en.wikipedia.org/wiki/Quality_assurance)/customer issues. For instance, I would leave the following line in some released code:

```
 function doSomething(arg1) {
        // ...
        console.examine("someLabel", arg1);
        // ...
    } 
```

And then from the released product, type the following into the console (or address bar prefixed with 'javascript:'):

```
 top.__examine_someLabel = true; 
```

Then, I will see all of the logged console.examine() statements. It's been a fantastic help many times over.

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2013-06-17T17:39:51.320

Simple [Internet Explorer 7](http://en.wikipedia.org/wiki/Internet_Explorer_7) and below [shim](https://en.wikipedia.org/wiki/Shim_%28computing%29) that preserves line numbering for other browsers:

```
/* Console shim */
(function () {
    var f = function () {};
    if (!window.console) {
        window.console = {
            log:f, info:f, warn:f, debug:f, error:f
        };
    }
}()); 
```

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2016-02-12T08:12:25.510

```
console.debug(""); 
```

Using this method prints out the text in a bright blue color in the console.

[![enter image description here](https://i.stack.imgur.com/KCjUx.png)](https://i.stack.imgur.com/KCjUx.png)

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2014-05-20T14:51:04.490

Improving further on ideas of Delan and Andru (which is why this answer is an edited version); console.log is likely to exist whilst the other functions may not, so have the default map to the same function as console.log....

You can write a script which creates console functions if they don't exist:

```
if (!window.console) console = {};
console.log = console.log || function(){};
console.warn = console.warn || console.log;  // defaults to log
console.error = console.error || console.log; // defaults to log
console.info = console.info || console.log; // defaults to log 
```

Then, use any of the following:

```
console.log(...);
console.error(...);
console.info(...);
console.warn(...); 
```

These functions will log different types of items (which can be filtered based on log, info, error or warn) and will not cause errors when console is not available. These functions will work in Firebug and Chrome consoles.

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2021-01-26T18:03:49.283

Even though this question is old, and has good answers, I want to provide an update on other logging capabilities.

You can also print with groups:

```
console.group("Main");
console.group("Feature 1");
console.log("Enabled:", true);
console.log("Public:", true);
console.groupEnd();
console.group("Feature 2");
console.log("Enabled:", false);
console.warn("Error: Requires auth");
console.groupEnd(); 
```

Which prints:

[![enter image description here](https://i.stack.imgur.com/5TqdF.png)](https://i.stack.imgur.com/5TqdF.png)

This is supported by all major browsers according to [this page](https://developer.mozilla.org/en-US/docs/Web/API/Console/group): [![enter image description here](https://i.stack.imgur.com/eOjxc.png)](https://i.stack.imgur.com/eOjxc.png)

# c# - 如何在 ASP.NET MVC 中创建友好的 URL？

> ID：217960
> 
> 赞同：39
> 
> 时间：2008-10-20T10:04:38.727
> 
> 标签：c#, asp.net-mvc, asp.net-mvc-routing, friendly-url, slug

如何在 ASP.NET MVC 框架中生成友好的 URL？例如，我们有一个如下所示的 URL：

```
http://site/catalogue/BrowseByStyleLevel/1
```

1 是要浏览的学习级别（在本例中为更高）的 ID，但我想以与 StackOverflow 相同的方式重新格式化 URL。

例如，这两个 URL 会将您带到同一个地方：

> [https://stackoverflow.com/questions/119323/nested-for-loops-in-different-languages](https://stackoverflow.com/questions/119323/nested-for-loops-in-different-languages)
> 
> [https://stackoverflow.com/questions/119323/](https://stackoverflow.com/questions/119323/)

**编辑：** url 的友好部分称为*slug*。

* * *

## 回答 #1

> 赞同：52
> 
> 时间：2008-10-20T13:15:29.807

There are two steps to solve this problem. First, create a new route or change the default route to accept an additional parameter:

```
routes.MapRoute(  "Default", // Route name
                   "{controller}/{action}/{id}/{ignoreThisBit}", 
                   new { controller = "Home", 
                         action = "Index", 
                         id = "",
                         ignoreThisBit = ""}  // Parameter defaults ) 
```

Now you can type whatever you want to at the end of your URI and the application will ignore it.

When you render the links, you need to add the "friendly" text:

```
<%= Html.ActionLink("Link text", "ActionName", "ControllerName",
                    new { id = 1234, ignoreThisBit="friendly-text-here" }); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2011-07-28T21:38:29.467

This is how I have implemented the slug URL on my application. **Note:** The default Maproute should not be changed and also the routes are processed in the order in which they're added to the route list.

```
routes.MapRoute(
    "Default", // Route name
    "{controller}/{action}/{id}", // URL with parameters
    new { controller = "Home",
          action = "Index",
          id = UrlParameter.Optional
    } // Parameter defaults
);
routes.MapRoute("Place", "{controller}/{action}/{id}/{slug}", new { controller = "Place", action = "Details", id = UrlParameter.Optional,slug="" }); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-20T10:20:53.593

你在 global.asax 上有一条路线

```
 routes.MapRoute(
                    "Default", // Route name
                    "{controller}/{action}/{id}", // URL with parameters
                    new { controller = "Home", action = "Index", id = ""} 
                    // Parameter defaults ) 
```

您可以定义自己的路线，例如：

控制器是控制器文件夹中的cs类。

您可以定义您的 id - 使用您选择的名称。

the system will pass the value to your actionResult method.

you can read more about this step here : [http://www.asp.net/learn/mvc/tutorial-05-cs.aspx](http://www.asp.net/learn/mvc/tutorial-05-cs.aspx)

# c# - 在 C# 中序列化和反序列化表达式树

> ID：217961
> 
> 赞同：95
> 
> 时间：2008-10-20T10:04:41.410
> 
> 标签：c#, serialization, expression-trees

有没有办法在 C# 中反序列化表达式，我想将表达式存储在数据库中并在运行时加载它们。

* * *

## 回答 #1

> 赞同：49
> 
> 时间：2011-06-14T22:15:29.610

我继续[在 C# 中序列化和反序列化表达式树提到的库上工作](https://stackoverflow.com/questions/217961/serializing-and-deserializing-expression-trees-in-c/1486253#1486253)

看起来该项目已被放弃（2008 年），但我做了一些工作，现在它可以与 .NET 4.0 和 Silverlight 一起使用。我对他们的代码进行了错误修复，并使其更加独立于 DAL。

[http://expressiontree.codeplex.com/](http://expressiontree.codeplex.com/)

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2008-10-20T15:11:21.837

在 GitHub/Nuget 上有一个名为[MetaLinq](https://github.com/mcintyre321/metalinq)的项目，旨在让使用表达式树更容易。

它在普通表达式和可变且完全可序列化的“EditableExpressions”之间进行转换，因此可以与 Json、Xml、Binary 等一起使用。

另请查看此[博客文章](https://nomadic-developer.com/2007/05/24/announcing-metalinq-linq-to-expressions/)以获取更多信息。

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2009-09-28T09:57:31.370

其他选项是 code.msdn.com 上的[Expression Tree Serialization](http://code.msdn.microsoft.com/exprserialization)项目 - 这里似乎更需要什么？

UPD：现在[http://archive.msdn.microsoft.com/exprserialization](http://archive.msdn.microsoft.com/exprserialization)

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2012-09-22T10:03:51.987

看看我的新库[Serialize.Linq](https://github.com/esskar/Serialize.Linq)。它将 linq 表达式序列化为 json、xml 和二进制。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-20T10:16:29.980

不完整；但是，[Dynamic LINQ](http://weblogs.asp.net/scottgu/archive/2008/01/07/dynamic-linq-part-1-using-the-linq-dynamic-query-library.aspx)示例可能会有所帮助。您当然可以将表达式序列化为字符串（在某种程度上 - 泛型看起来有点古怪），但没有内置的解析器。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2010-09-10T07:27:17.447

WCF RIA 服务允许序列化`IQuerayble<T>`

[WCF RIA 服务第 3 部分 - 更新数据](http://www.softinsight.com/bnoyes/CommentView,guid,dddf4af6-7dbe-4c14-9ae4-c0f14520bc6f.aspx)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2015-08-15T10:17:12.537

I was working on a project for serializing expressions. It's OK and you can use it. [http://www.codeproject.com/Articles/851187/ServicePredicateBuilder-for-creating-Serializable](http://www.codeproject.com/Articles/851187/ServicePredicateBuilder-for-creating-Serializable)

# sql-server-2005 - 用于将 Access 数据库迁移到 SQL Server 2005 的 SSMA 是否可以自动化？

> ID：217964
> 
> 赞同：1
> 
> 时间：2008-10-20T10:05:04.093
> 
> 标签：sql-server-2005, ms-access, sql-server-migration-assi

我需要将 Access 数据库迁移到 SQL Server 2005。由于这需要在设置中完成，以便客户的安装透明地迁移到 SQL Server 2005，我想知道是否可以自动化 Microsoft 的 SSMA 工具包。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-20T13:33:35.543

据我所知，这种自动化是不可用的。但是您仍然可以生成创建数据库的 SQL 代码（以“CREATE DATABASE”语句开头的代码）并通过 SQL 服务器上的用户界面启动它。

要生成此代码，您可以

1.  使用 Access 工具包创建 access 数据库
2.  使用（例如）SQL Server Management Studio 生成相应的“CREATE DATABASE”SQL 代码（右键单击数据库，选择“script database as CREATE”。EMS SQL Studio 为 SQL Server Management Studio 提供了一个非常好的替代方案
3.  保存代码以供进一步使用

使用 EMS Studio，您甚至可以决定此代码是否也更新数据。但我更喜欢通过代码自动传输数据：例如，您可以浏览表（以正确的顺序，取决于关系），打开记录集（一个本地，一个 SQL），并通过浏览字段来传输数据（您可以甚至不需要命名它们），代码如下：

```
(localRecordset links to local table. can be DAO or ADODB; Adjust code accordingly)
(sqlRecordset links to the SQL server. can be DAO or ADODB; Adjust code accordingly)

localRecordset.moveFirst

Do while not localRecordset.EOF
    sqlRecordset.addnew
    For each field in localrecordset.fields
        sqlRecordset.fields(field.name).value = field.value
    Next field
    sqlRecordset.update
    localRecordset.moveNext
Loop 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-10T14:04:13.790

Actually SSMA had command-line interface (special console executable in the SSMA installation folder). It was available at some time but I'm not sure whether it made its way to last release. You should ping SSMA support about what versions had it and what examples of its usages are available. I hope this will help you.

# c# - 从附属程序集中获取所有受支持的文化

> ID：217968
> 
> 赞同：5
> 
> 时间：2008-10-20T10:06:10.143
> 
> 标签：c#, assemblies, internationalization, globalization, satellite

我正在使用附属程序集来保存 C# 应用程序中的所有本地化资源。

我需要做的是在 GUI 中创建一个菜单，其中包含应用程序存在的所有可用语言。有没有办法动态获取信息？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-07-04T22:47:28.940

此函数返回 App_GlobalResources 文件夹中所有已安装文化的数组 - 根据您的需要更改搜索路径。对于不变的文化，它返回“自动”。

```
public static string[] GetInstalledCultures()
{
    List<string> cultures = new List<string>();
    foreach (string file in Directory.GetFiles(HttpContext.Current.Server.MapPath("/App_GlobalResources"), \\Change folder to search in if needed.
        "*.resx", SearchOption.TopDirectoryOnly))
    {
        string name = file.Split('\\').Last();
        name = name.Split('.')[1];

        cultures.Add(name != "resx" ? name : "auto"); \\Change "auto" to something else like "en-US" if needed.
    }
    return cultures.ToArray();
} 
```

你也可以使用这个来获得更多的功能来获取完整的 CultureInfo 实例：

```
public static CultureInfo[] GetInstalledCultures()
{
    List<CultureInfo> cultures = new List<CultureInfo>();
    foreach (string file in Directory.GetFiles(HttpContext.Current.Server.MapPath("/App_GlobalResources"), "*.resx", SearchOption.TopDirectoryOnly))
    {
        string name = file.Split('\\').Last();
        name = name.Split('.')[1];

     string culture = name != "resx" ? name : "en-US";
     cultures.Add(new CultureInfo(culture));
    }
    return cultures.ToArray();
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-20T10:46:38.377

*特定语言的每个附属程序集的名称相同，但位于以特定文化命名的子文件夹中，例如 fr 或 fr-CA。*
也许您可以使用这个事实并扫描文件夹层次结构以动态构建该菜单。

# php - 如何使用 PHP 在文本区域中显示 Word 文档？

> ID：217969
> 
> 赞同：2
> 
> 时间：2008-10-20T10:06:14.043
> 
> 标签：php, ms-word

我试图使用 com 类测试代码以显示 Word 文件，但我似乎无法得到答案并且仍在搜索。我收到错误，有时程序根本不显示任何内容。请给我一些想法。我正在使用 PHP 4。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-20T10:24:44.490

如果该站点托管在带有 Word 的 Windows 计算机上，则您可以使用 PHP 的 COM 扩展来访问 Word 文档。使用 Word 的自动化模型公开的自动化方法，您可能会执行一些操作，例如将 word 文档导出到 HTML，然后将该 HTML 呈现到页面上的某个框架/div。我没有查看代码或尝试过，但有人在这里创建了一个 word/php 类：
[http ://www.phpclasses.org/browse/package/3553.html](http://www.phpclasses.org/browse/package/3553.html)

可能还有很多其他人。

虽然我在过去看到过无需使用自动化就可以直接读取 Word 文档的代码，但我不推荐它，因为它很容易被新版本或文件格式中的怪异所破坏。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-20T10:13:57.537

你的意思是你想在浏览器中激活这个词插件？尝试[`<object>`](http://www.w3.org/TR/html401/struct/objects.html#edef-OBJECT)使用正确的 mime 类型的标签。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2019-05-25T20:11:36.837

```
<head><title>snook.ca load document</title>

<script language="JavaScript">

<!--//

function loadworddoc(){

    // creates the word object

    var doc = new ActiveXObject("Word.Application"); 

    // doesn't display Word window

    doc.Visible=false; 

    // specify path to document

    doc.Documents.Open(document.all.hello.value); 

   //copy the content from my word document and throw it into my variable

   var txt;

   txt = doc.Documents(document.all.hello.value).Content;

   //document.all.myarea.value = txt;

   document.all.tbContentElement.DOM.body.innerHTML = txt;

   // quit word (very important or you'll quickly chew up memory!)

   doc.quit(0); 

   }

   //-->

   </script>

</head>

<body>

   <p><input type=button onClick="loadworddoc();" value="Load">

   <p><input type=file name=hello>

   <p><textarea name=myarea cols=50 rows=5>nothing here yet</textarea>

   <object ID="tbContentElement" CLASS="tbContentElement" 

     CLASSID="clsid:2D360201-FFF5-11D1-8D03-00A0C959BC0A" VIEWASTEXT

     width="450" height="300">

     <param name=Scrollbars value=true></object>

</body> 
```

# c# - 如何使用 XmlSerializer 获取 XML 元素的内容？

> ID：217977
> 
> 赞同：3
> 
> 时间：2008-10-20T10:10:55.127
> 
> 标签：c#, .net, xml, .net-2.0, serialization

我在这个 XML 字符串上有一个 XML 阅读器：

```
<?xml version="1.0" encoding="UTF-8" ?>
<story id="1224488641nL21535800" date="20 Oct 2008" time="07:44">
<title>PRESS DIGEST - PORTUGAL - Oct 20</title>
<text>
<p>    LISBON, Oct 20 (Reuters) - Following are some of the main
 stories in Portuguese newspapers on Monday. Reuters has not
verified these stories and does not vouch for their accuracy. </p>
<p>More HTML stuff here</p>
</text>
</story> 
```

我创建了一个 XSD 和一个相应的反序列化类。

```
[System.Xml.Serialization.XmlRootAttribute(Namespace="", IsNullable=false)]
public class story {
    [System.Xml.Serialization.XmlAttributeAttribute()]
    public string id;
    [System.Xml.Serialization.XmlAttributeAttribute()]
    public string date;
    [System.Xml.Serialization.XmlAttributeAttribute()]
    public string time;
    public string title;
    public string text;
} 
```

`Deserialize`然后我使用XmlSerializer的方法创建该类的一个实例。

```
XmlSerializer ser = new XmlSerializer(typeof(story));
return (story)ser.Deserialize(xr); 
```

现在，`text`成员`story`始终为空。如何更改我的`story`类以便按预期解析 XML？

**编辑：**

使用 XmlText 不起作用，我无法控制正在解析的 XML。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-20T12:22:52.613

如果 text 标签只包含 p 标签，我将提出以下建议，它可能在短期内有用。

您可以将其作为字符串数组，而不是将文本字段作为字符串的故事。然后，您可以使用正确的 XmlArray 属性（不记得确切的名称，例如 XmlArrayItemAttribute），并使用正确的参数使其看起来像：

```
<text>
   <p>blah</p>
   <p>blib</p>
</text> 
```

这更接近了一步，但并不完全是您所需要的。

另一种选择是制作一个像这样的类：

```
public class Text //Obviously a bad name for a class...
{
   public string[] p;
   public string[] pre;
} 
```

再次使用 XmlArray 属性让它看起来正确，不确定它们是否像那样可配置，因为我以前只将它们用于简单类型。

编辑：

使用：

```
[System.Xml.Serialization.XmlRootAttribute(Namespace = "", IsNullable = false)]
    public class story
    {
        [System.Xml.Serialization.XmlAttributeAttribute()]
        public string id;
        [System.Xml.Serialization.XmlAttributeAttribute()]
        public string date;
        [System.Xml.Serialization.XmlAttributeAttribute()]
        public string time;
        public string title;

        [XmlArrayItem("p")]
        public string[] text;

    } 
```

与提供的 XML 一起工作得很好，但是拥有这个类似乎有点复杂。它最终类似于：

```
 <text>
       <p>
          <p>qwertyuiop</p>
          <p>asdfghjkl</p>
       </p>
       <pre>
          <pre>stuff</pre>
          <pre>nonsense</pre>
       </pre>
   </text> 
```

这显然不是我们想要的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-20T10:56:51.210

我找到了一个*非常*不满意的解决方案。

像这样改变班级（呃！）

```
// ...
[XmlElement("HACK - this should never match anything")]
public string text;
// ... 
```

并像这样更改调用代码（糟糕！）

```
XmlSerializer ser = new XmlSerializer(typeof(story));
string text = string.Empty;
ser.UnknownElement += delegate(object sender, XmlElementEventArgs e) {
    if (e.Element.Name != "text")
        throw new XmlException(
              string.Format(CultureInfo.InvariantCulture, 
             "Unknown element '{0}' cannot be deserialized.",
             e.Element.Name));
    text += e.Element.InnerXml;
};

story result = (story)ser.Deserialize(xr);
result.text = text;
return result; 
```

这是一种非常糟糕的做法，因为它破坏了*封装*。有更好的方法吗？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-20T13:40:47.650

您可以`IXmlSerializable`为您的类实现并在那里处理内部元素，这意味着您将用于反序列化数据的代码保留在目标类中（从而避免封装问题）。这是一个足够简单的数据类型，代码应该很容易编写。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-06T23:23:34.243

你试过[xsd.exe](http://msdn.microsoft.com/en-us/library/x6c1kb0s(VS.71).aspx)吗？它允许您从 xml 文档创建 xsd，然后从 xsd 生成应该适合 xml 反序列化的类。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-20T12:26:15.307

也许使用[XmlAnyElement](http://msdn.microsoft.com/en-us/library/system.xml.serialization.xmlanyelementattribute.aspx)属性而不是处理 UnknownElement 事件可能更优雅。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-20T11:13:51.753

由于您无法控制 XML，因此您可以改用 StreamReader。XmlReader 将 HTML 标记解释为 XML，这不是您想要的。

然而，XmlSerializer 将去除文本标记中的 HTML 标记。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-20T10:27:38.540

在我看来，XML 不正确。由于您在文本标记中使用 HTML 标记，因此 HTML 标记被解释为 XML。您应该使用 CDATA 正确解释数据或转义 < 和 >。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2012-08-22T01:01:03.543

在使用 XSD.exe 从 XML 生成 XSD，然后将 XSD 生成类之后，我遇到了同样的问题。我在生成的类文件中的对象类之前添加了一个 [XmlText] 标记（在我的例子中称为 P，因为`<p>`它推断为 XML 节点的标记）并且它立即起作用。拉入父节点内的完整 HTML 内容并放入该 P 对象，然后我将其重命名为更有用的东西。

# c# - C# 小端还是大端？

> ID：217980
> 
> 赞同：67
> 
> 时间：2008-10-20T10:13:25.883
> 
> 标签：c#, hardware, udp, endianness

在允许我们通过 UDP/IP 控制它的硬件文档中，我发现了以下片段：

> 在该通信协议中，DWORD 为 4 字节数据，WORD 为 2 字节数据，BYTE 为单字节数据。存储格式为little endian，即4字节（32bits）数据存储为：d7-d0、d15-d8、d23-d16、d31-d24；双字节（16 位）数据存储为：d7-d0、d15-d8。

我想知道这如何转换为 C#？我必须在发送之前转换东西吗？例如，如果我想发送一个 32 位整数或 4 个字符的字符串？

* * *

## 回答 #1

> 赞同：90
> 
> 时间：2008-10-20T10:21:02.873

C# 本身并没有定义字节序。但是，无论何时转换为字节，您都在做出选择。[BitConverter](http://msdn.microsoft.com/en-us/library/system.bitconverter.aspx)类有一个[IsLittleEndian](http://msdn.microsoft.com/en-us/library/system.bitconverter.islittleendian.aspx)字段来告诉您它的行为方式，但它没有提供选择。BinaryReader/BinaryWriter 也是如此。

我的[MiscUtil](http://pobox.com/~skeet/csharp/miscutil)库有一个 EndianBitConverter 类，它允许您定义字节序；BinaryReader/Writer 也有类似的等价物。恐怕没有在线使用指南，但它们很简单:)

（EndianBitConverter 还具有正常 BitConverter 中不存在的一项功能，即在字节数组中进行就地转换。）

* * *

## 回答 #2

> 赞同：48
> 
> 时间：2008-10-20T10:29:58.817

你也可以使用

```
IPAddress.NetworkToHostOrder(...) 
```

简而言之，int 或 long。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-10-20T10:20:04.530

Re little-endian，简短的回答（我需要做任何事情）是“可能不是，但这取决于你的硬件”。您可以通过以下方式检查：

```
bool le = BitConverter.IsLittleEndian; 
```

根据这所说的，您可能想要反转部分缓冲区。[或者，Jon Skeet在这里](http://www.yoda.arachsys.com/csharp/miscutil/)有特定的字节序转换器（查找 EndianBitConverter）。

请注意，安腾（例如）是大端的。大多数英特尔都是小端的。

重新指定 UDP/IP ...？

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-20T10:25:30.027

您需要了解网络字节顺序以及 CPU 字节序。

[`htons`](http://msdn.microsoft.com/en-us/library/ms738557.aspx)通常对于 TCP/UDP 通信，您总是使用函数（和`ntohs`，以及它们的相关函数）将数据转换为网络字节顺序。

通常网络顺序是大端，但在这种情况下（出于某种原因！）通信是小端，所以这些功能不是很有用。这很重要，因为你不能假设他们实现的 UDP 通信遵循任何其他标准，如果你有一个大端架构，它也会让生活变得困难，因为你不能`htons`按照你应该的方式包装所有东西:-(

但是，如果您来自 intel x86 架构，那么您已经是 little-endian，因此只需发送数据而不进行转换。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2015-09-10T20:25:11.107

我正在使用 UDP Multicast 中的打包数据，我需要一些东西来重新排序 UInt16 八位字节，因为我注意到数据包标头（Wireshark）中有错误，所以我做了这个：

```
 private UInt16 swapOctetsUInt16(UInt16 toSwap)
    {
        Int32 tmp = 0;
        tmp = toSwap >> 8;
        tmp = tmp | ((toSwap & 0xff) << 8);
        return (UInt16) tmp;
    } 
```

在 UInt32 的情况下，

```
 private UInt32 swapOctetsUInt32(UInt32 toSwap)
    {
        UInt32 tmp = 0;
        tmp = toSwap >> 24;
        tmp = tmp | ((toSwap & 0xff0000) >> 8);
        tmp = tmp | ((toSwap & 0xff00) << 8);
        tmp = tmp | ((toSwap & 0xff) << 24);
        return tmp;
    } 
```

这只是为了测试

```
 private void testSwap() {
        UInt16 tmp1 = 0x0a0b;
        UInt32 tmp2 = 0x0a0b0c0d;
        SoapHexBinary shb1 = new SoapHexBinary(BitConverter.GetBytes(tmp1));
        SoapHexBinary shb2 = new SoapHexBinary(BitConverter.GetBytes(swapOctetsUInt16(tmp1)));
        Debug.WriteLine("{0}", shb1.ToString());
        Debug.WriteLine("{0}", shb2.ToString());
        SoapHexBinary shb3 = new SoapHexBinary(BitConverter.GetBytes(tmp2));
        SoapHexBinary shb4 = new SoapHexBinary(BitConverter.GetBytes(swapOctetsUInt32(tmp2)));
        Debug.WriteLine("{0}", shb3.ToString());
        Debug.WriteLine("{0}", shb4.ToString());
    } 
```

从哪个输出是这样的：

```
 0B0A: {0}
    0A0B: {0}
    0D0C0B0A: {0}
    0A0B0C0D: {0} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-11-08T10:38:59.210

如果您正在解析并且性能不重要，请考虑以下非常简单的代码：

```
private static byte[] NetworkToHostOrder (byte[] array, int offset, int length)
{
    return array.Skip (offset).Take (length).Reverse ().ToArray ();
}

int foo = BitConverter.ToInt64 (NetworkToHostOrder (queue, 14, 8), 0); 
```

# asp.net - .NET 2.0 和 MySql 处于中等信任模式

> ID：217989
> 
> 赞同：1
> 
> 时间：2008-10-20T10:20:31.940
> 
> 标签：asp.net, mysql, medium-trust

如何以中等信任模式从 ASP.NET 2 站点访问 Mysql？我的 ISP 不允许我的网站在完全信任的情况下运行，我已经尝试了许多（如果不是全部）mysql api 来连接到数据库。

所有都会导致 SocketPermission 或 FileIOPermission 错误。我什至尝试覆盖我的 web.config 中的信任设置。

有任何想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-20T10:36:34.310

要求他们将 MySQL 程序集放入 GAC。这是第三方数据库和 Medium Trust 的常见问题。

我要补充一点，你将不得不对他们说甜言蜜语。他们将需要信任他们将要安装的软件，以免破坏他们的服务器。因此，您需要解释它是已建立的软件，并向他们提供该站点的 URL。

[另一种选择](http://www.aspcode.net/Getting-MySQL-to-function-in-medium-trust.aspx)是让他们稍微改变信任区的状态。这看起来有点可疑，但它不涉及接触 GAC。*``********