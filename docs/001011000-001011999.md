# StackOverflow 问答 1011000-1011999

# php - 使用curl和php保存xml文件的问题

> ID：1011003
> 
> 赞同：0
> 
> 时间：2009-06-18T05:56:34.007
> 
> 标签：php, xml, curl

我正在使用 curl 和 xml 将我的 xml 发布到 URL。

我现在正在收到它的响应，但它没有显示在输出中。

当我`View Source`通过右键单击页面来获取页面时，就像 XML 文件输出一样。

我需要将该 xml 文档存储到文件中。

我在下面使用了这段代码

```
<?
$path = "https://newport.ingrammicro.com/mustang"; //Relative path to the file with $_POST parsing
$ch = curl_init($path); //Initialise curl resource with above file
$data = "my xml document to post"; 
//Data to be sent to the file

curl_setopt($ch, CURLOPT_POSTFIELDS, $data); //Send the data to the file?
curl_setopt($ch, CURLOPT_RETURNTRANSFER, 0); 
curl_setopt($ch, CURLOPT_HEADER, 0);
$val = curl_exec($ch);   
curl_close($ch); //Close curl session
$fp = fopen('data.xml', 'w');
fwrite($fp, $val);
fclose($fp);
?> 
```

但是当我打开保存的文件时只有一个值`"1"`，这是我在文件中得到的值。

实际上它是 curl 语句的真实值（$val = curl_exec($ch); ） bool(true) 我试图回显 Sval 的值，它也是“1”

如何将我的 XML 输出文件完全保存为 XML 文件输出。当我查看页面源时

它看起来像这样

```
<PNAResponse>
  <Version>2.0</Version>
  <TransactionHeader>
    <SenderID>14-018111</SenderID>
    <ReceiverID>14-018111</ReceiverID>
    <ErrorStatus ErrorNumber=""/>
    <DocumentID>{F1B17BBB-F848-4693-914A-B6943AA9009A}</DocumentID>
    <TransactionID/>
    <TimeStamp>2009-06-17T22:42:44</TimeStamp>
  </TransactionHeader>
  <PriceAndAvailability SKU="V06669" Quantity="5" GovtProgramType="PA" GovtEndUserType="F">
    <Price>1413.04</Price>
    <SpecialPriceFlag>Y</SpecialPriceFlag>
    <ManufacturerPartNumber>V11H270020</ManufacturerPartNumber>
    <ManufacturerPartNumberOccurs/>
    <VendorNumber>4913</VendorNumber>
    <Description>POWERLITE 1735W LCD PROJ</Description>
    <ReserveInventoryFlag>N</ReserveInventoryFlag>
    <AvailableRebQty>0</AvailableRebQty>
    <Branch ID="10" Name="Mira Loma, California">
      <Availability>7</Availability>
      <OnOrder>8</OnOrder>
      <ETADate>2009-06-19</ETADate>
    </Branch>
    <Branch ID="30" Name="Millington, Tennessee">
      <Availability>0</Availability>
      <OnOrder>4</OnOrder>
      <ETADate>2009-06-22</ETADate>
    </Branch>
    <Branch ID="40" Name="Carol Stream, Illinois">
      <Availability>0</Availability>
      <OnOrder>18</OnOrder>
      <ETADate>2009-06-18</ETADate>
    </Branch>
    <Branch ID="80" Name="Jonestown Pennsylvania">
      <Availability>0</Availability>
      <OnOrder>9</OnOrder>
      <ETADate>2009-06-23</ETADate>
    </Branch>
  </PriceAndAvailability>
</PNAResponse> 
```

有谁知道如何做到这一点？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-18T13:15:38.660

curl_exec() 函数在成功时返回 TRUE，在失败时返回 FALSE，*除非*您将 CURLOPT_RETURNTRASFER 设置设置为 true (1)：

```
curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1); 
```

这将导致 curl_exec() 函数返回请求的响应正文而不是真/假值。

另请参阅 PHP 的“返回值”部分[：curl_exec - Manual](http://www.php.net/manual/en/function.curl-exec.php)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-18T06:14:24.993

设置`CURLOPT_RETURNTRANSFER`为`true`：

```
curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1); 
```

为什么你一开始就把它设置为0？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-18T14:39:42.797

另外，如果您想尝试添加一些用户代理以确保您获得与真实浏览器相同的输出

```
 @curl_setopt($ch, CURLOPT_USERAGENT, "Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.8.1.1) Gecko/20061204 Firefox/2.0.0.1"); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-07-09T00:39:44.887

就像 Grabiel Sosa 所说，“您可能想尝试添加一些用户代理，以确保您获得与真实浏览器相同的输出”。

网站[http://www.user-agents.org/index.shtml?moz](http://www.user-agents.org/index.shtml?moz)包含大量的用户代理（Mozilla 和其他）

# delphi - 在delphi中分离接口和实现类？

> ID：1011006
> 
> 赞同：2
> 
> 时间：2009-06-18T05:57:22.400
> 
> 标签：delphi, class

我将我的delphi代码分成接口和实现单元，即。

EmployeeIntf.pas 看起来像这样

```
type
 // forward declaration
  TScheduleList = class;
  TDeparment = class;
 TEmployee = class(BDObject)
  ....
    function GetSchedules: TScheduleList;
    function GetDepartment: TDepartment;
 end;

 TEmployeeList = class(DBList)
  ....
 end;

 TEmployeeDM = class(BDDBobject)
  ...
 end; 
```

然后我有两个单元**ScheduleIntf.pas**和**DepartmentIntf.pas**，它们声明了 TScheduleList 类和 TDepartment 类。

然后在我的主要单元中，它结合了所有单元看起来像这样，

```
Unit BusinessDomain
Interface
uses
 classes
  {$I Interface\EmployeeIntf.pas}
  {$I Interface\DepartmentIntf.pas}
  {$I Interface\ScheduleIntf.pas}
Implementation
uses
 SysUtils
 {$I Implementation\EmployeeImpl.pas}
 {$I Implementation\DepartmentImpl.pas}
 {$I Implementation\ScheduleImpl.pas}
Initialization
finalization

end. 
```

当我编译这个时，编译器会抛出一个错误；

```
*Type TScheduleList is not yet completely defined* 
```

我怎样才能让这些类在每个单元文件（.pas）中分开，然后在编译器不抛出这个错误的情况下进行前向声明？

班级本身很大，我更愿意以这种方式将它们分开。

加思

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-06-18T07:15:50.447

我的第一个建议：完全跳过这个 $Include 东西。正如 Uwe 所写，找到一个更像 Delphi 的解决方案。

如果您真的**想**保留 $Include 样式：您引用的错误发生是因为前向声明不适用于“类型”块。您在一个块中转发声明 TScheduleList，但在另一个块中定义它。要解决此问题，请省略 *Intf.pas 中的“type”关键字，并将其插入到 BusinessDomain.pas 中包含之前。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-06-18T06:38:38.743

恐怕，不可能将一个类声明拆分成多个文件。如果类那么大，您应该考虑重新设计。

另一种选择是接口：

```
type
  IEmployee = interface
    { public properties and methods of an employee }
    ...
  end;

type
  TEmployee = class(BDObject, IEmployee)
    ...
  end; 
```

接口和类声明现在可以驻留在不同的文件中。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-06-18T07:31:24.377

Ulrich 是非常正确的（+1），虽然您可以操作您的包含文件以大致以这种方式工作，但这对您来说不会是一个很好的开发体验。

将 $Include 指令视为一种简单的文本替换机制，构成您的单位的东西，嗯......单位是范围机制（使用部分，类型部分等），它们在包含文件中使用起来会更加困难，这就是为什么包含文件通常称为 xxx.inc 而不是 xxxx.pas，因为它们通常不会自己作为源文件站立。这当然使它们在开发环境中变得非常困难，因为它们实际上只是文本文件而不是适当的可调试单元。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-06-18T16:18:39.873

包含文件是那些不断向前发展的传统 Pascal 功能之一。有一点我们没有使用子句，它是管理多个文件的唯一方法（当然，我们都使用 wordstar 命令进行代码导航......等等，它们仍然存在）。

今天，包含文件最常见的用途是包含一段代码，该代码块必须在多个文件之间共享，而**不能**只在另一个单元中使用。正如 Mason 在另一条评论中指出的那样，这将是 IFDEF-DEFINE 块，用于确定应该打开哪些编译器选项，以及应该在项目范围内启用哪些定义。我们不再受限于源文件的 64k 限制。

需要考虑的其他几点。大多数搜索源的工具可能无法导航到包含文件。使用像文本搜索这样简单的方法来查找不断弹出的文本消息可能会很困难。根本不将任何代码放入其中会为您提供更好的服务。将映射文件转换为代码时，我相信如果包含文件被合并到位，您在映射文件中指定的行号将是总文件。如果您使用 MadExcept 等自动化工具，报告的错误行可能不是实际位置。

我的建议是按照 Uwe 的建议使用接口。它们不仅适用于 COM，还可以解决您将“接口”与“实现”分开的愿望。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-06-18T11:01:32.953

也许我之前的评论有点冒昧……再次阅读您的问题，我认为您可能误解了如何使用单位，特别是“使用”指令。

您可以在单个单元文件中声明接口和实现的各个类：

```
unit EmployeeDBCLassesU

uses system, DB, Blah, blah; // Units needed by this unit

interface

type

 TEmployeeList = class(DBList)
   Procedure DoSomething;
 end;

 TEmployeeDM = class(BDDBobject)
  Procedure DoSomething;
 end;

implementation

{TEmployeeList}

Procedure TEmployeeList.DoSomething;
begin
...
end;

{TEmployeeDM }

Procedure TEmployeeDM.DoSomething;
begin
...
end; 
```

然后稍后在其他地方使用它们：

```
Unit BusinessDomain

interface

uses EmployeeDBCLassesU; // MY units needed by this unit
.
.
. 
```

这会将所有类定义带入 BusinessDomain

然后你可以做

```
 TBusinessDomain = class(BDDBobject)
   EmployeeList: TEmployeeList;
   EmployeeDM: TEmployeeDM;
   .
   .
   .;
 end; 
```

希望这会有所帮助，因为您将从正确的方法中获益良多——您会意识到这一点，尤其是在导航单元进行编辑和调试时。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-06-18T12:15:47.283

如果你真的喜欢分离接口和实现，看看 Modula2。这也是一个类似帕斯卡的应用程序，但它为每个“单元”使用两个文件。一个用于接口，一个用于实现。

另一种解决方案是拆分文件或类定义，并编写一个自定义预处理器将这些（文本方式）链接在一起。然后你有类似的东西：

```
unit BusinessDomain
interface
uses
 classes;

type
  Employment = class from Interface\EmployeeIntf.pas;
  Department = class from Interface\DepartmentIntf.pas;
  Schedule = class from Interface\ScheduleIntf.pas;

implementation
uses
  SysUtils;

external define
  Employment = class from Implementation\EmployeeImpl.pas;
  Department = class from Implementation\DepartmentImpl.pas;
  Schedule = class from Implementation\ScheduleImpl.pas;
end;

end. 
```

使用 Delphi 2009，您可以在构建阶段之前和之后发出命令。所以在技术上这是可能的。

# database - 在编译的 Visual Basic .NET 应用程序中如何链接数据源？

> ID：1011007
> 
> 赞同：2
> 
> 时间：2009-06-18T05:57:36.487
> 
> 标签：database, vb.net, visual-studio, sql-server-ce

当我尝试向我的项目添加新数据源时，我收到提示“您选择的连接使用不属于当前项目的本地数据文件。您想将文件复制到您的项目并修改连接吗？ "

这对我来说听起来相当晦涩，因为我是 VB.NET 的新手，并且通常对非脚本应用程序进行编程。本例中的数据源是一个 .sdf SQL CE 文件。

问题1：如果我说我想把数据库复制到项目中，我编译app后会发生什么，数据库会在哪里？（我将如何从另一个应用程序编辑它？）

问题2：如果我不包含它，数据源如何仍然保持链接？我可以使用***%ProgramFiles%*** \MyAppDir 等文件系统环境变量进行链接吗？

问题 3：我可以告诉它在网络上使用只读（只需阅读它）数据源，比如在 FTP 上吗？

提前感谢您的帮助！=)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-18T06:08:31.320

Visual Studio 只是尝试将所有文​​件放在一个位置，其余文件放在项目文件夹中。

Q1 - SQL Ce 数据库可以在您喜欢的任何地方，您可以使用 app.settings 中的 ConnectionStrings 设置部分。SQL Ce 只是一个文件，仅此而已，因此可以从任何应用程序访问。Is 没有编译到您的应用程序中，它只是在您部署等时随身携带。

要回答 Q2 - 你可能可以，但我不确定它会自动为你工作。

Q3 - 从 ftp 读取，可能不是，除非您在您的应用程序中使用 ftp 客户端支持并在后台下载它。另一种解决方案是将 ftp 映射到本地驱动器并从那里访问它。

例如，将连接字符串存储在 app.config 中（摘自 app.config）：

```
<connectionStrings>
   <add name="db" connectionString="Provider=Microsoft.SQLSERVER.OLEDB.CE.2.0; data source=c:SomePathToSDFfile" />
</connectionStrings> 
```

稍后在您的应用程序中，您可以像这样访问此连接字符串：（添加对 System.Configuration 的引用）

```
 Dim c As Configuration.ConnectionStringSettingsCollection
  Dim cn As SqlClient.SqlConnection

  c = Configuration.ConfigurationManager.ConnectionStrings
  cn = New SqlClient.SqlConnection
  cn.ConnectionString = c.Item("db").ConnectionString
  cn.Open() 
```

# sql - 更新 SQLite 中随机选择的行

> ID：1011009
> 
> 赞同：3
> 
> 时间：2009-06-18T05:58:15.083
> 
> 标签：sql, sqlite

我有一个表，其中有一个特定的值 - 默认情况下它设置为 -1，但我想将它更改为 0 随机行。

此操作的正确查询是什么？

这是我尝试过的：

```
UPDATE statuses SET status = 0
WHERE word_id = (
      SELECT word_id FROM statuses WHERE status = -1 ORDER BY RANDOM() LIMIT 1
) 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-18T06:03:46.260

嗯，我刚刚制作了一个示例表，您的查询似乎按以下方式工作：

```
sqlite> create table statuses (word_id, status default -1);
sqlite> insert into statuses (word_id) values (1);
sqlite> insert into statuses (word_id) values (2);
sqlite> insert into statuses (word_id) values (3);
sqlite> insert into statuses (word_id) values (4);
sqlite> insert into statuses (word_id) values (5);
sqlite> select * from statuses;
1|-1
2|-1
3|-1
4|-1
5|-1
sqlite> UPDATE statuses SET status = 0
   ...> WHERE word_id = (
   ...>       SELECT word_id FROM statuses WHERE status = -1 ORDER BY RANDOM() LIMIT 1
   ...> );
sqlite> select * from statuses;
1|-1
2|-1
3|0
4|-1
5|-1 
```

因此，换句话说，您的查询是正确的 - 您的错误可能在代码的其他地方。

# c# - ip地址屏蔽

> ID：1011012
> 
> 赞同：1
> 
> 时间：2009-06-18T05:59:26.140
> 
> 标签：c#, sockets

我有一个使用 c# 中的套接字编程的服务器和客户端应用程序。在这方面，最大。一次可以连接 10 个客户端到服务器。但我的要求是，当我通过服务器发送消息时，我必须通过 IP 地址阻止其中一个客户端。请帮助阻止。程序如下..

```
using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Text;
using System.Windows.Forms;
using System.Net.Sockets;
using System.Net;

namespace Server
{
    public partial class SocketServer : Form
    {
        const int MAX_CLIENTS = 10;

        public AsyncCallback pfnWorkerCallBack;
        private Socket m_mainSocket;
        private Socket[] m_workerSocket = new Socket[10];
        private int m_clientCount = 0;
        private byte[] byData;

        public SocketServer()
        {
            InitializeComponent();
            textBoxIP.Text = GetIP();
        }

        String GetIP()
        {
            String strHostName = Dns.GetHostName();
            // Find host by name
            IPHostEntry iphostentry = Dns.GetHostByName(strHostName);

            // Grab the first IP addresses
            String IPStr = "";
            foreach (IPAddress ipaddress in iphostentry.AddressList)
            {
                IPStr = ipaddress.ToString();
                ip = IPStr;
                return IPStr;
            }
                 ip = IPStr;
                return IPStr;

        }

        private void Form1_Load(object sender, EventArgs e)
        {

        }

        private void buttonStartListen_Click(object sender, EventArgs e)
        {
            try
            {
                // Check the port value
                if (textBoxPort.Text == "")
                {
                    MessageBox.Show("Please enter a Port Number");
                    return;
                }
                string portStr = textBoxPort.Text;
                int port = System.Convert.ToInt32(portStr);
                // Create the listening socket...
                m_mainSocket = new Socket(AddressFamily.InterNetwork,
                                          SocketType.Stream,
                                          ProtocolType.Tcp);
                IPEndPoint ipLocal = new IPEndPoint(IPAddress.Any, port);

                    // Bind to local IP Address...
                    m_mainSocket.Bind(ipLocal);
                    // Start listening...
                    m_mainSocket.Listen(4);
                    // Create the call back for any client connections...
                    m_mainSocket.BeginAccept(new AsyncCallback(OnClientConnect), null);

                    UpdateControls(true);

            }
            catch (SocketException se)
            {
                MessageBox.Show(se.Message);
            }
        }

        private void UpdateControls(bool listening)
        {
            buttonStartListen.Enabled = !listening;
            buttonStopListen.Enabled = listening;
        }

        public delegate void UpdateTextCallback(string message, object obj);

        public void OnClientConnect(IAsyncResult asyn)
        {
            try
            {
                // Here we complete/end the BeginAccept() asynchronous call
                // by calling EndAccept() - which returns the reference to
                // a new Socket object
                m_workerSocket[m_clientCount] = m_mainSocket.EndAccept(asyn);
                // Let the worker Socket do the further processing for the 
                // just connected client
                WaitForData(m_workerSocket[m_clientCount]);
                // Now increment the client count
                ++m_clientCount;
                // Display this client connection as a status message on the GUI    
                String str = String.Format("Client # {0} connected", m_clientCount);

                //textBoxMsg.Text = str;
                textBoxMsg.BeginInvoke(new UpdateTextCallback(UpdateText), new object[] { str, textBoxMsg });

                // Since the main Socket is now free, it can go back and wait for
                // other clients who are attempting to connect
                m_mainSocket.BeginAccept(new AsyncCallback(OnClientConnect), null);

            }
            catch (ObjectDisposedException)
            {
                System.Diagnostics.Debugger.Log(0, "1", "\n OnClientConnection: Socket has been closed\n");
            }
            catch (SocketException se)
            {
                MessageBox.Show(se.Message);
            }

        }

        private void UpdateText(string message, object ctrl)
        {
            if (ctrl is TextBox)
                textBoxMsg.Text = message;

            if(ctrl is RichTextBox)
                richTextBoxReceivedMsg.AppendText(message);
        }

        public class SocketPacket
        {
            public System.Net.Sockets.Socket m_currentSocket;
            public byte[] dataBuffer = new byte[1];
        }

        public void WaitForData(System.Net.Sockets.Socket soc)
        {
            try
            {
                if (pfnWorkerCallBack == null)
                {
                    // Specify the call back function which is to be 
                    // invoked when there is any write activity by the 
                    // connected client
                    pfnWorkerCallBack = new AsyncCallback(OnDataReceived);
                }
                SocketPacket theSocPkt = new SocketPacket();
                theSocPkt.m_currentSocket = soc;
                // Start receiving any data written by the connected client
                // asynchronously
                soc.BeginReceive(theSocPkt.dataBuffer, 0,
                                   theSocPkt.dataBuffer.Length,
                                   SocketFlags.None,
                                   pfnWorkerCallBack,
                                   theSocPkt);
            }
            catch (SocketException se)
            {
                MessageBox.Show(se.Message);
            }

        }

        public void OnDataReceived(IAsyncResult asyn)
        {
            try
            {
                SocketPacket socketData = (SocketPacket)asyn.AsyncState;

                int iRx = 0;
                // Complete the BeginReceive() asynchronous call by EndReceive() method
                // which will return the number of characters written to the stream 
                // by the client
                iRx = socketData.m_currentSocket.EndReceive(asyn);
                char[] chars = new char[iRx + 1];
                System.Text.Decoder d = System.Text.Encoding.UTF8.GetDecoder();
                int charLen = d.GetChars(socketData.dataBuffer,
                                         0, iRx, chars, 0);
                System.String szData = new System.String(chars);
                //richTextBoxReceivedMsg.AppendText(szData);
                richTextBoxReceivedMsg.BeginInvoke(new UpdateTextCallback(UpdateText), new object[] { szData, richTextBoxReceivedMsg });

                // Continue the waiting for data on the Socket
                WaitForData(socketData.m_currentSocket);
            }
            catch (ObjectDisposedException)
            {
                System.Diagnostics.Debugger.Log(0, "1", "\nOnDataReceived: Socket has been closed\n");
            }
            catch (SocketException se)
            {
                MessageBox.Show(se.Message);
            }
        }
        private void buttonStopListen_Click(object sender, EventArgs e)
        {
            CloseSockets();
            UpdateControls(false);
        }

        void CloseSockets()
        {
            if (m_mainSocket != null)
            {
                m_mainSocket.Close();
            }
            for (int i = 0; i < m_clientCount; i++)
            {
                if (m_workerSocket[i] != null)
                {
                    m_workerSocket[i].Close();
                    m_workerSocket[i] = null;
                }
            }
        }

        private void buttonSendMsg_Click(object sender, EventArgs e)
        {

            try
            {
                Object objData = richTextBoxSendMsg.Text;
                byData = System.Text.Encoding.ASCII.GetBytes(objData.ToString());
                for (int i = 0; i < m_clientCount; i++)
                {
                    if (m_workerSocket[i] != null)
                    {
                        if (m_workerSocket[i].Connected)
                        {

                                m_workerSocket[i].Send(byData);

                        }
                    }
                }
            }

            catch (SocketException se)
            {
                MessageBox.Show(se.Message);
            }
        }

        private void Form1_Minimize(object sender, System.EventArgs e)
        {
            if (FormWindowState.Minimized == WindowState)
            {
                Hide();
                this.notify.Visible = true;
            }
        }
        private void Form1_Resize(object sender, System.EventArgs e)
        {
            Show();
            WindowState = FormWindowState.Normal;
            this.notify.Visible = false;

        } 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-08-28T01:58:28.387

这有点容易做到，您只需要多看一下客户端连接例程...将下面的 127.0.0.1 替换为您要拒绝并抛出异常的 IP 地址或简单地关闭连接并返回。

```
public void OnClientConnect(IAsyncResult asyn)
{
    try
    {
        TcpListener listener = (TcpListener)ar.AsyncState;
        System.Net.Sockets.TcpClient client = listener.EndAcceptTcpClient(ar);
        IPEndPoint clientEndPoint = (IPEndPoint)client.Client.RemoteEndPoint;
        if (clientEndPoint.Address == new IPAddress("127.0.0.1"))
            throw new InvalidOperationException(); 
```

# reporting-services - rdlc如何显示数据库中的图像

> ID：1011015
> 
> 赞同：0
> 
> 时间：2009-06-18T06:00:13.737
> 
> 标签：reporting-services, rdlc

我有一个包含图像的集合。我想在我的 RDLC 报告中显示这些图像。谁能告诉我该怎么做？

请给我代码或示例。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-18T06:56:10.587

如果您想从数据库中的表中检索图像并在 Reporting Services 报表中使用它，您所要做的就是创建一个包含图像字段的数据源并将其用作图像字段的数据源，例如您可以处理报告中显示的其余数据。

假设您有一个名为*image_table*的表，其中有一列名为*image_col*。

您所要做的就是创建一个带有如下选择语句的数据源：

```
SELECT image_col FROM image_table WHERE your_condition_here 
```

获得数据源后，将其分配给图像字段 DataSource 属性，并将 Fields!image_col 分配给图像字段的 Value 属性。有了这个，你就有了报告上的图像。

**要测试这个想法，您可以按照以下步骤操作：**

1) 定义一个表名为“image_table”的强类型数据集

2) image_table 将有 2 列 IdCol（一个数字列）和 image_col 一个（Byte() 列）

3) 使用以下数据填充数据集：

```
 Dim cText As String
    Dim myDataSet As dsImageDataset

    cText = "SELECT idCol, image_col FROM image_table"
    Dim sCommand As New SqlClient.SqlCommand(cText, yourConnection)
    Dim dAdapt As New SqlClient.SqlDataAdapter(sCommand)
    dAdapt.Fill(myDataSet, "image_table") 
```

这将使用表 image_table 中的所有图像填充数据集 myDataSet。

# sql - 更改数据库列类型，同时使用 SQL 忽略转换错误

> ID：1011017
> 
> 赞同：1
> 
> 时间：2009-06-18T06:01:32.563
> 
> 标签：sql, sql-server, tsql, types

这类似于上一个问题[MSSQL: Change type of a column with numbers from varchar to int](https://stackoverflow.com/questions/577712/mssql-change-type-of-a-column-with-numbers-from-varchar-to-int)，除了在这种情况下，并非所有原始数据都可以成功地从 varchar 转换为 int。在这些情况下，我希望输出只是`NULL`.

例如，varchar 列中的传入值集将如下所示`{'123', '234', '345', 'A', '456'}`：从 varchar 转换为 int 后，我​​希望该列包含 values `{123, 234, 345, NULL, 456}`。在实践中，我将有大约 99% 的成功率。

虽然通用解决方案是理想的，但我使用的是 SQL Server 2005，需要在 Transact SQL 中执行更改。

编辑：这些`IsNumeric`建议确实弥补了一部分差距，但并不完整。例如，如果数据集包含数字但不包含整数数据，则`IsNumeric`修复不起作用（并且似乎没有 a `IsInteger`）。特别是，以下集合不会转换 {'123.456', '$12'} 根据 SQL Server 它们都是数字`IsNumeric`但不会转换为`Int`.

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-18T06:11:23.767

1.  因此运行更新：

    .. SET OldValue = CASE WHEN ISNUMERIC(Oldvalue) = 1 THEN Oldvalue ELSE NULL END ...

2.  跑

    ALTER TABLE dbo.Mytable ALTER COLUMN OldValue int -- 根据需要添加 NULL 或 NOT NULL

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-18T06:11:32.347

1.  先执行这个：

    更新表集字段 = null 其中 ISNUMERIC(field) = 0

2.  然后改变类型

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-06-18T07:11:54.807

经过一个小时的黑客攻击并在其他答案的指导下，这就是我想出的：

1.  清理数据以确保信息能够转换。由于没有 IsInteger 函数，因此请使用 IsNumeric 设置为`NULL`根本无法转换的任何内容。

2.  将所有剩余的数据转换为类型`MONEY`，这将有效地摆脱以前接受的货币符号`IsNumeric`。

3.  将货币类型转换为整数以去除分数。

4.  最后，更改数据类型。

以下测试演示了如何使用 SQL：

```
CREATE TABLE tbl ( 
    id INTEGER IDENTITY NOT NULL,
    col VARCHAR(20)
)

INSERT INTO tbl (col) VALUES ('123')
INSERT INTO tbl (col) VALUES ('ABC')
INSERT INTO tbl (col) VALUES ('123.456')
INSERT INTO tbl (col) VALUES ('$12')

UPDATE tbl SET col = CASE WHEN IsNumeric(col) = 1 THEN Convert(INTEGER, (Convert(MONEY, col))) ELSE NULL END
ALTER TABLE tbl ALTER COLUMN col INTEGER

SELECT * FROM tbl 
```

# compiler-construction - How does ebook to exe application compile to self-contained executable?

> ID：1011030
> 
> 赞同：0
> 
> 时间：2009-06-18T06:05:39.517
> 
> 标签：compiler-construction, exe

I am trying to understand how various ebook applications compile their output into a self-contained executable file with no dependencies when you run the exe. How can it be done? Do they use real embedded compiler?

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-21T08:12:24.393

The ebook application probably creates an application with an integrated web browser. The application will be pre-compiled and the only thing missing will be the html content. This will be added as a resource. A full compiler isn't necessary. All is needed is to add the resources to an existing executable.

See this [article](http://support.microsoft.com/kb/319616) on how html pages can be added to a resource dll. [Resource hacker](http://angusj.com/resourcehacker/) is a utility that can extract/replace resources from any executable. No compiler is needed to do this.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-23T08:01:05.780

The simplest approach, used by many archivers sfx modules, is to have precompiled stub, and then append created information to this stub (in your case compiled ebook). Then, when exe is executed is detect start of information block (for example with some predefined byte sequence) and extract information for play.

You can even embed external references in your exe, for example some tools, include .dll files as resources, which is extracted on run to temp folder and then loaded from there.

Of course there is more complex ways to embed information to existent executable, for example BeginUpdateResource - UpdateResource - EndUpdateResource sequence on WinNT is another way to embed your information into executable (as resource).

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-18T14:00:12.220

They simply include a loader/viewer of the ebook that is paired with ebook data itself inside the executable.

There are many ways to do it, first of all you should understand if the binary really has no dependencies or if it searches for libraries (for example acrobat ones), then you can program a viewer that loads its data directly from the binary either in a vector-based view (smaller) either on a image-based view (like pdfs without text being ocr-ed)

I'm assuming that you're talking about a pdf-ebook.. for every other format the idea remains the same: pairing the ebook data with the viewer

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-27T22:58:33.343

Ebook exe application maybe put your ebook in resource in .exe and try use a embedded webbrowser of pdf activex to load ebook.

# c# - 调用 Socket.Receive 后 C# Socket.Connected 属性更改为 false

> ID：1011031
> 
> 赞同：4
> 
> 时间：2009-06-18T06:05:55.520
> 
> 标签：c#, sockets

```
int readCount;
byte[] buffer = new byte[128];
SocketError socketError;

TcpClient tcpClient = tcpListener.AcceptTcpClient();
tcpClient.Client.ReceiveTimeout = 500; // #1
// tcpClient.Client.Connected is **true** here.
readCount = tcpClient.Client.Receive(buffer, 0, buffer.Length, SocketFlags.None, out socketError); // reacCount > 0
// tcpClient.Client.Connected is **false** here. 
```

如果 #1 替换为**tcpClient.Client.Blocking = false;** ， tcpClient.Client.Connected 具有正确的值（真）。

* * *

我已将`Socket.ReceiveTime`属性设置为 100 并调用了`Socket.Receive()`. `Receive()`返回大于零的整数值。没有发生异常。在我使用复制的缓冲区完成工作后——我没有使用任何与 Socket 相关的方法——Socket.Connected 属性已更改为 false。为什么？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-06-18T09:31:44.010

关键可能在于[TcpClient.Connected](http://msdn.microsoft.com/en-us/library/system.net.sockets.tcpclient.connected.aspx)的真正作用：

> Connected 属性获取客户端套接字 **在最后一次 I/O 操作**时的连接状态。当它返回 false 时，客户端套接字要么从未连接，要么不再连接。
> 
> 由于 Connected 属性仅反映最近操作时的连接状态，因此您应该尝试发送或接收消息以确定当前状态。消息发送失败后，该属性不再返回true。请注意，此行为是设计使然。您无法可靠地测试连接的状态，因为在测试和发送/接收之间的时间内，连接可能已经丢失。您的代码应假定套接字已连接，并优雅地处理失败的传输。

因此，当您没有阻塞并且当您检查 Connected 值时，读取可能尚未完成，因此 Connected 仍处于旧值。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-18T09:15:02.670

如果远程主机不再连接到套接字，则可能会发生这种情况。连接的另一端是否有可能已超过的超时？

# django - 如何在 django 0.96 中为 appengine 项目包含 css/javascript

> ID：1011042
> 
> 赞同：0
> 
> 时间：2009-06-18T06:10:05.047
> 
> 标签：django, google-app-engine

我正在为 appengine 项目使用 django 0.96。我想在我的 html 文件中使用 javascript 和 css 不幸的是我无法通过 django 做到这一点......一种解决方案（我不喜欢）是让我的 app.yaml 像这样：

```
handlers:
- url: /media
  static_dir: static/media 
```

但我希望它与 django 本身有关，所以我避免使用上面的行，因此我正在寻找一种“django”的方式来做这件事。我的项目的目录结构是这样的（不完整只是相关项目 /myapp /static /media /css /js /images settings.py app.yaml

一个示例模板文件头是：

```
<link type="text/css" href="/media/css/ui-lightness/jquery-ui-1.7.1.custom.css" rel="Stylesheet" /> 
<script type="text/javascript" src="/media/js/jquery-1.3.2.min.js"></script>
<script type="text/javascript" src="/media/js/jquery-ui-1.7.1.custom.min.js">$('#date').datepicker();</script> 
```

settings.py 有：

```
MEDIA_ROOT =  os.path.join(os.path.dirname(__file__), 'static')
MEDIA_URL ='/media/'
TEMPLATE_DIRS = (

    # Put strings here, like "/home/html/django_templates" or "C:/www/django/templates".
    # Always use forward slashes, even on Windows.
    # Don't forget to use absolute paths, not relative paths.
    os.path.join(os.path.dirname(__file__), 'myapp/templates'),
    os.path.join(os.path.dirname(__file__), 'static'),
) 
```

我知道我在标题或设置中犯了一个错误，因为当我使用绝对 url 时：

> 然后至少css可以工作。存在解决方案来使用 app.yaml（如上所述）但我想从 django 本身来做。有什么提示吗？谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-18T09:20:41.927

我对GAE了解不多，但我确实了解Django，而Django的做法是*不让*Django去做。您的静态资产应始终与 Django 分开提供，否则您将无缘无故地承担大量的处理器开销。

您使用`handlers`上述方法设置它的方式看起来是正确的方式。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-08-30T02:22:46.923

在此处查看 Google App Engine 的文档：

[django 之外的静态文件处理程序](http://code.google.com/appengine/docs/python/config/appconfig.html#Static_File_Handlers) 是提供静态文件的最佳方式，GAE 会自动处理 mime 类型。

# c# - 通过服务删除 Windows 登录屏幕

> ID：1011047
> 
> 赞同：2
> 
> 时间：2009-06-18T06:11:33.000
> 
> 标签：c#, authentication, windows-services, windows-xp, winlogon

我正在尝试从从服务启动的可执行文件中删除 Windows 登录屏幕 (winlogon)。该服务将自动启动 windows 并等待来自另一台计算机的命令。当它接收到命令时，它将启动一个 exe，该 exe 将在特定用户名下启动 cmd.exe。

该服务已经存在。我有编写这个可执行文件的工作。目前，我已经编写了可执行文件 (CmdLogin)，它通过调用 LogonUserW、ImpersonateUser 和 CreateProcessWithLogonW 在不同的用户下启动 cmd.exe。我将 lpDesktop 指定为“WinSta0\Default”。唯一的问题是该服务必须在管理员帐户下运行（但这是一个不同的问题）。

当从命令提示符调用时（即使在 Windows 7 上），它工作得非常好。当用户登录并查看他的桌面时从服务调用时，这也有效（就像我在同一台机器上调试时所做的那样）。但是，就像我上面所说的，我真正的要求是即使在显示 Windows 登录屏幕时也能正常工作。目前，exe 给出了正确的退出代码，但没有出现该窗口。但是，当用户登录时，他会在桌面上看到 cmd 窗口。

我发现的一种解决方案是对 lpDesktop 使用“WinSta0\WinLogon”而不是 Default。我还没有尝试这个。但是，这看起来会在登录屏幕上显示 cmd 窗口。我真正需要的是实际模拟用户登录到 winlogon 并显示他的实际桌面（和 cmd 窗口）。

我环顾四周，发现了 GINA 和 Winlogon 通知包。他们似乎有点过头了，我不确定这是否能解决这里的目的。此外，这些在 Windows Vista 中已被弃用，这让我认为有更好、更简洁的方法来解决这个问题。

关于我应该使用什么来实现这一目标的任何建议？作为记录，可执行文件在 C# 中，使用 P/Invoke 进行 API 调用。我也愿意使用可以从此 C# 应用程序调用的 C dll。

谢谢你，
侯赛因

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-07-07T01:28:47.567

GINA has been superceded in Vista/2008 by Credential Providers (not available in managed code).

I don't know how to do what you need, but perhaps this is a clue to go further down the trail.

And for the record, this seems like the wrong way to address the problem. I just don't see how you would need to run a command prompt under an auto login... Why not write a service to do your tasks, and have it run under a set of service specific credentials?

I don't have the background on your problem, but this description makes me shudder. :-)

[Update] Well, in response to your comment. I would say that writing a GINA replacement for <= Windows 2003, or a custom credential provider for Vista/2008+ would look to be your best option.

You can provide custom authentication against his credential store, then allow or deny the login as you see fit.

# jquery - 防止直接访问 JSON Web 服务

> ID：1011055
> 
> 赞同：2
> 
> 时间：2009-06-18T06:14:59.547
> 
> 标签：jquery, ajax, web-services, json, security

我有一个通过在页面中插入一段 javascript 来使用的 web 服务。Javascript 扫描页面中的某个字符串并向我的 ASP.NET JSON WebService 发出请求。然后 javascript 使用 JSON 来显示一些内容。

我最想做的是阻止任何人直接访问我的 JSON 服务。

该服务是使用 jQuery Ajax 请求访问的。

这可能吗？

最好的问候， TheLorax

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-18T08:20:32.173

我的经验主要是使用 PHP，因此您可能必须将概念转换为 ASP.NET ;)

如果代码是同一个 Web 应用程序的一部分（或在同一个服务器实例上）并且我想将其锁定，例如，它位于身份验证系统的后面，我会在会话中存储一个变量，说明用户已通过身份验证。您也许可以对 ASP.NET 和会话状态做同样的事情。取决于 Web 服务或任何提供 JSON 的服务是否可以访问该用户的会话状态。

另一种选择是在服务器端创建某种散列密钥，并以私钥为种子。通过您的请求将其传递给也知道私钥的 JSON 服务。这个解决方案的问题是需要协调以确保 JSON 服务正确解密，并且人们仍然可以以其他方式使用 JSON 服务。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-06-18T06:26:03.680

并不真地。

如果您有一个已知的用户组，您可以通过发布 API 密钥等来阻止其他人访问您的服务。但是您的有效用户将能够以他们喜欢的任何形式访问您的 JSON。

您可以尝试混淆事物，但这可能不值得付出努力。

既然您无法关闭它，您应该拥抱 Web 2.0 的混搭精神，并且如果有人访问您的服务并以您从未想过的新的、创新的方式呈现信息，您会很高兴。这应该会让你的服务更受欢迎。

如果它以某种方式最终花费了您的实际收入，您必须依靠法律手段来阻止它，因为可以规避技术措施。

# c# - 当客户端和服务器在远程处理中共享相同的接口时，如何为 SAO 创建代理

> ID：1011056
> 
> 赞同：0
> 
> 时间：2009-06-18T06:15:13.057
> 
> 标签：c#, .net, remoting

我怀疑与 SAO 对象有关。例如。我有接口 ITest，它位于 ITestObj.dll 和 RemoteObject（注册为 SAO）测试中，它在名为 RemoteObject.dll 的服务器中实现 ITest。现在我的客户端只使用 ITestObj.dll 并尝试使用 Activator 方法创建代理对象。根据 MSDN-GetObject 或 new 可用于服务器激活。重要的是要注意，在进行这些调用中的任何一个时，都不会实例化远程对象。事实上，根本不会产生网络调用。框架从元数据中获取足够的信息来创建代理，而无需连接到远程对象。

为什么 Activator.GetObject 可以创建一个 Test 实例并将其作为 Itest 类型提供给客户端而不连接到服务器？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-18T20:01:26.727

在您对对象进行调用之前，代理不会尝试连接到服务器。因此，即使服务器没有运行，您也可以使用 Activator.GetObject() 来获取对对象代理的引用。

如果您在服务器未运行时调用代理对象上的方法，您将收到 RemotingException。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-10-03T04:21:40.183

创建客户端透明代理时，不会在服务器上检查其有效性。一旦你调用一个函数，就会与服务器建立连接，此时服务器会尝试定位实现接口的服务器对象。如果未找到，则会生成错误。

基本上，在客户端创建的透明代理是使用接口来确定如何序列化对服务器的调用。

我不确定我是否清楚地解释了这一点，但希望这会有所帮助。

# php - PHP 类错误

> ID：1011060
> 
> 赞同：0
> 
> 时间：2009-06-18T06:16:32.167
> 
> 标签：php

我收到以下错误：

解析错误：语法错误，意外的 T_STRING，需要 T_OLD_FUNCTION 或 T_FUNCTION 或 T_VAR 或 '}'

引用的行是：

```
class Food {

private $q = array();   
private $nutrients = array();

... 
```

我该如何解决这个错误？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-06-18T06:21:07.963

您只能在 php 5 环境中使用“private”。看起来您正在 PHP 4 中运行它。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-18T06:19:12.240

我认为你缺少一个结束大括号'}'。（至少你在提供的代码中做了）。

但是很难用您提供的更少的代码来判断。请提供有关该问题的更多代码。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-18T06:20:25.497

```
class Food {

private $q = array();
private $nutrients = array();

} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-18T06:20:42.207

这很可能是由在您的类中在任何函数调用或变量声明之外的某个地方进一步声明的字符串引起的。

另一个可能的原因是您的一个声明末尾缺少分号。

您能否提供更多代码（包括有问题的行号）。

# java - 文件读取和可测试代码

> ID：1011061
> 
> 赞同：1
> 
> 时间：2009-06-18T06:16:49.077
> 
> 标签：java, unit-testing

我有一段 java 代码，它从文件中读取字符串并从字符串中创建一个映射。由于此代码依赖于文件，因此单元测试很笨拙。如何设计这样的部分以便代码可以进行单元测试？

我能想到的一种方法是，本文不采用文件作为参数，而是采用输入流。在实际场景中，传递文件输入流，而单元测试传递从字符串创建的输入流。但是，这对我来说似乎是一种过度杀戮。有没有更好的办法？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-18T06:24:38.517

`InputStream`如果您对文件所做的所有操作都是读取它，则不提供从文件中读取的函数是设计错误。因此，将函数修改为采用`InputStream`，并提供一个采用 的包装器`File`。使用[ByteArrayInputStream](http://java.sun.com/javase/6/docs/api/java/io/ByteArrayInputStream.html)或 StringInputStream 来测试它很好。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-18T06:22:44.200

在这种情况下，我曾经为测试用例创建所需的文件，并在单元测试中使用它们。我为这些文件（测试数据）设置了一个专用文件夹，并设置了测试用例以获取适合测试用例的文件。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-06-18T21:39:47.077

这样看：无论您如何重组代码，测试数据都必须来自*某个*文件。我看到 2 个变体：

1.  数据在 .java 单元测试源代码文件之一中就地编码。它仅适用于小型测试数据集。正如您所描述的，您需要重构代码以获取输入流并拥有另一个与文件一起使用的包装器。

2.  测试数据文件。您必须创建一个项目范围的约定来保存您的测试数据文件。它们的位置可能是相对于 jave 项目的位置，或者在一个通用的测试数据文件根目录下。在任何情况下，使用一个实用方法来返回给定“逻辑”文件名的完整测试数据文件路径会很有帮助。

在您的情况下（仅一个测试，一百个单词），第一个解决方案似乎就足够了。是的，您需要稍微重构一下代码。第二种解决方案更通用，我个人觉得它更实用和适用。

如果它适用于数据文件，有人会说这不是单元测试。好吧，这是“单元测试”的定义问题，并且完全无关紧要。如果您需要测试您的代码，只需*为您的项目*找到最好/最方便的方法。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-18T06:29:00.787

我建议要么使用专用于测试的数据集（在本例中为文件）。否则我会使用模拟来模拟对外部资源的访问。无论如何，我倾向于尽可能扩大自动测试的覆盖范围。

# c# - 将实体框架与 MySQL DB 一起使用，模型设计器不会获取存储的 proc 参数

> ID：1011062
> 
> 赞同：5
> 
> 时间：2009-06-18T06:17:17.610
> 
> 标签：c#, mysql, entity-framework

我有最新的 Mysql 连接器，它允许您使用 Visual Studio 实体框架设计器。它工作得很好，但我只是添加了一个存储过程。

服务器资源管理器使用指定的参数很好地加载了它，但后来我将它添加到实体模型中，它生成的代码没有任何输入参数。

这是存储过程

```
CREATE PROCEDURE `GetViewableMenuNodes`(IN siteId INT, IN parentId INT, IN userName varchar(255))
BEGIN
    select m.*
    from menunode m 
    where m.siteid = siteId
    and m.showinmenu = 1
    and m.parentid = parentId
    and m.viewername = userName;
END 
```

这是模型生成的代码

```
public global::System.Data.Objects.ObjectResult<MenuNode> GetViewableMenuNodes()
{
    return base.ExecuteFunction<MenuNode>("GetViewableMenuNodes");
} 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2011-07-05T15:49:01.863

如果您觉得这很有帮助，这里是我使用 MySQL Connector/.NET Entity Framework 提供程序在 MySQL 中使用参数处理存储过程的方法。我调用 ExecuteStoreQuery()。这使我不必处理映射过程与模型中的参数的挑战。这可以满足我们的需求。

```
 public IList<SearchResultsMember> SearchMembers(int memberID, string countryCode, string regionCode, string cityCode, float distanceKm,
        int genderID, int ageMin, int ageMax, int offsetRowIndex, int maxRows)
    {

        MySqlParameter[] queryParams = new MySqlParameter[] { 
                                        new MySqlParameter("memberIDParam", memberID),
                                        new MySqlParameter("countryCodeParam", countryCode),
                                        new MySqlParameter("regionCodeParam", regionCode),
                                        new MySqlParameter("cityCodeParam", cityCode),
                                        new MySqlParameter("distanceKmParam", distanceKm),
                                        new MySqlParameter("genderIDParam", genderID),
                                        new MySqlParameter("ageMinParam", ageMin),
                                        new MySqlParameter("ageMaxParam", ageMax),
                                        new MySqlParameter("offsetRowIndexParam", offsetRowIndex),
                                        new MySqlParameter("maxRowsParam", maxRows)
                                    };

        StringBuilder sb = new StringBuilder();
        sb.Append("CALL search_members(@memberIDParam, @countryCodeParam, @regionCodeParam, @cityCodeParam, @distanceKmParam, @genderIDParam, @ageMinParam, @ageMaxParam, @offsetRowIndexParam, @maxRowsParam)");

        string commandText = sb.ToString();
        var results = _context.ExecuteStoreQuery<SearchResultsMember>(commandText, queryParams);

        return results.ToList();
    } 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2013-07-22T22:17:29.967

这是我们为在 DbContext 上执行 StoredProcedures 所做的一个小扩展：

```
 public static List<T> ExecuteStoredProcedure<T>(this DbContext dbContext, string storedProcedureName, params object[] parameters)
    {
        string storedProcedureCommand = "CALL " + storedProcedureName + "(";

        List<object> augmentedParameters = parameters.ToList();

        storedProcedureCommand = AddParametersToCommand(storedProcedureCommand, augmentedParameters);

        storedProcedureCommand += ");";

        return dbContext.Database.SqlQuery<T>(storedProcedureCommand).ToList<T>();
    }

    public static List<T> ExecuteStoredRecursiveProcedure<T>(this DbContext dbContext, string storedProcedureName, params object[] parameters)
    {
        string storedProcedureCommand = "SET max_sp_recursion_depth = " + maxRecursionCount + "; CALL " + storedProcedureName + "(";

        List<object> augmentedParameters = parameters.ToList();

        storedProcedureCommand = AddParametersToCommand(storedProcedureCommand, augmentedParameters);

        storedProcedureCommand += ");";

        return dbContext.Database.SqlQuery<T>(storedProcedureCommand).ToList<T>();
    }

    private static string AddParametersToCommand(string storedProcedureCommand, List<object> augmentedParameters)
    {
        for (int i = 0; i < augmentedParameters.Count(); i++)
        {
            storedProcedureCommand = AddParameterToCommand(storedProcedureCommand, augmentedParameters, i);
        }
        return storedProcedureCommand;
    }

    private static string AddParameterToCommand(string storedProcedureCommand, List<object> augmentedParameters, int i)
    {
        if (augmentedParameters[i].GetType() == typeof(string))
        {
            storedProcedureCommand += "'";
        }

        storedProcedureCommand += (augmentedParameters[i].ToString());

        if (augmentedParameters[i].GetType() == typeof(string))
        {
            storedProcedureCommand += "'";
        }

        if (i < augmentedParameters.Count - 1)
        {
            storedProcedureCommand += ",";
        }

        return storedProcedureCommand;
    } 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2011-04-21T14:46:40.493

查看此错误条目：

[http://bugs.mysql.com/bug.php?id=44985](http://bugs.mysql.com/bug.php?id=44985)

对不起你的运气。欢迎来到俱乐部。显然，无法从 MySQL Connector/.NET Entity Framework 对 MySQL 中的存储过程提供适当的支持。从线程中的日期可以看出，引入该功能的响应非常缓慢。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2014-09-23T19:26:24.577

我喜欢这种更安全的参数方法，因为它也可以处理 sql 注入问题。我将其概括如下：

```
public DbRawSqlQuery<T> ExecuteStoredProcedure<T>(string storedProcedureName, params object[] parameters)
        {            string storedProcedureCommand = "CALL " + storedProcedureName + "(";

            List<object> augmentedParameters = parameters.ToList();

            MySqlParameter[] queryParams;
            storedProcedureCommand = AddParametersToCommand(storedProcedureCommand, augmentedParameters, out queryParams);

            storedProcedureCommand += ");";

            return ((DbContext)this).Database.SqlQuery<T>(storedProcedureCommand, queryParams);
        }

        private string AddParametersToCommand(string storedProcedureCommand, List<object> augmentedParameters, out MySqlParameter[] queryParams)
        {
            string paramName = "";
            queryParams = new MySqlParameter[augmentedParameters.Count()];
            for (int i = 0; i < augmentedParameters.Count(); i++)
            {
                paramName = "p" + i;
                queryParams[i] = new MySqlParameter(paramName,augmentedParameters[i]);                                
                storedProcedureCommand += "@" + paramName;

                if (i < augmentedParameters.Count - 1)
                {
                    storedProcedureCommand += ",";
                }
            }
            return storedProcedureCommand;
        } 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2014-09-23T19:31:14.243

在处理 mysql 数据库时还要注意一件最重要的事情；始终将存储过程参数与表列名称不同地命名，否则它会在 sp 内的查询中混淆。

例如：

```
CREATE  PROCEDURE `authenticate_user`(
IN p_login_name varchar(50),
IN p_password varchar(80)
)
BEGIN

SELECT `user`.`user_id`,
    `user`.`login_name`,
    `user`.`password`
from users
where `login_name` = p_login_name
and `password` = p_password;

END 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2014-10-12T19:44:09.707

这是我的代码示例，它可以与 VS2012 和 Mysql 连接器 6.8.3 一起使用，只需像往常一样生成数据模型，不要忘记包含存储过程。

希望这对某人有帮助。

```
public static IList<MyClass> GetCustOrderHist(string someParameter)
    {
        IList<MyClass> data = ((IObjectContextAdapter)TestDashboardEntities).ObjectContext.ExecuteStoreQuery<MyClass>("CALL CustOrderHist({0});", someParameter).ToList();

        return data;
    }

    public class MyClass
    {
        public string ProductName { get; set; }
        public int TOTAL { get; set; }
    } 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2016-07-22T14:44:31.820

调用存储过程是我的解决方案。我希望有用。

```
MovieDbEntities db = new MovieDbEntities();
int id = 2;
var result = db.Movie.SqlQuery($"CALL SP_ReadMovie({id})").ToList(); 
```

# java - Java Applet 可以发现多少硬件细节？

> ID：1011063
> 
> 赞同：7
> 
> 时间：2009-06-18T06:17:24.770
> 
> 标签：java, operating-system, benchmarking

我正在编写一个 Java 小程序以在不同的硬件下以不同的方式运行。例如，如果我知道一台计算机有大量 RAM 但处理器较弱，我可以改变一些时间内存权衡的平衡。能够发现运行小程序的 CPU 的确切品牌和型号可能会有所帮助。拥有这些信息将使我能够针对不同的系统对我的软件进行基准测试并找到瓶颈。

一般来说，我正在寻找的是：

*   内核和/或处理器的数量
*   32 位与 64 位 CPU
*   CPU 缓存行大小
*   L1、L2、L3 缓存大小
*   设置缓存的关联性
*   TLB 大小
*   CPU 上的确切品牌/型号信息
*   外频信息
*   内存量
*   交换/虚拟内存量
*   运行小程序的 JVM
*   运行 JVM 的操作系统
*   系统负载
*   使用/未使用的内核线程数
*   互联网连接带宽
*   可用内存
*   正在使用的显卡
*   如果操作系统正在可视化
*   正在使用的网络资源

这些信息中是否有任何信息被嵌入到 Java Applets 中。是否有图书馆可以找到这些信息？Applet 基准测试工具来发现/猜测其中的一些？你能想到什么巧妙的技巧吗？

他们是阻塞的计算机硬件的任何方面。也就是说，Java 小程序是否可以通过尝试访问它并被拒绝（可能是特定的 TCP 端口或图形加速器）来检测正在使用或不可用的东西。

免责声明：我知道关心硬件与不关心硬件的 Java 意识形态背道而驰。虽然评论指出这一点可能对看到这个问题的其他读者有所帮助，但请注意，这样的答案不是我想要的。

**编辑**

添加了附加信息：

**java.lang. [管理](http://java.sun.com/javase/6/docs/api/java/lang/management/package-summary.html)**提供有关运行 JVM 的系统的各种信息。

**java.lang.management。[OperatingSystemMXBean](http://java.sun.com/javase/6/docs/api/java/lang/management/OperatingSystemMXBean.html)**提供：

1.  [getAvailableProcessors()](http://java.sun.com/javase/6/docs/api/java/lang/management/OperatingSystemMXBean.html#getAvailableProcessors())等效的可用处理器数量[Runtime.availableProcessors()](http://java.sun.com/javase/6/docs/api/java/lang/Runtime.html#availableProcessors())
2.  [getSystemLoadAverage()](http://java.sun.com/javase/6/docs/api/java/lang/management/OperatingSystemMXBean.html#getSystemLoadAverage())系统上的平均负载是最后一分钟的系统负载平均值。

**java.lang.management。[管理工厂](http://java.sun.com/javase/6/docs/api/java/lang/management/ManagementFactory.html#getMemoryMXBean())**

1.  **[getGarbageCollectorMXBeans()](http://java.sun.com/javase/6/docs/api/java/lang/management/GarbageCollectorMXBean.html)**返回GarbageCollectorMXBeans 列表。可以查询每个 [GarbageCollectorMXBean以获取以下信息：](http://java.sun.com/javase/6/docs/api/java/lang/management/GarbageCollectorMXBean.html)

    1.  [getCollectionCount()](http://java.sun.com/javase/6/docs/api/java/lang/management/GarbageCollectorMXBean.html#getCollectionCount())使用此 bean 发生的 gc 数。
    2.  [getCollectionTime()](http://java.sun.com/javase/6/docs/api/java/lang/management/GarbageCollectorMXBean.html#getCollectionTime()) gc 之间经过的近似累积时间（以毫秒为单位）。（注意：Java 虚拟机实现可能使用高分辨率计时器来测量经过的时间。）
    3.  [getName()](http://java.sun.com/javase/6/docs/api/java/lang/management/MemoryManagerMXBean.html#getName())内存管理器的名称。
    4.  [getMemoryPoolNames()](http://java.sun.com/javase/6/docs/api/java/lang/management/MemoryManagerMXBean.html#getMemoryPoolNames())此 gc 管理的内存池。
2.  **[getThreadMXBean()](http://java.sun.com/javase/6/docs/api/java/lang/management/ManagementFactory.html#getThreadMXBean())**返回[ThreadMXBean](http://java.sun.com/javase/6/docs/api/java/lang/management/ThreadMXBean.html)，它提供：

    1.  [getCurrentThreadCpuTime()](http://java.sun.com/javase/6/docs/api/java/lang/management/ThreadMXBean.html#getCurrentThreadCpuTime())返回当前线程的总 CPU 时间（以纳秒为单位）。如果实现区分用户模式时间和系统模式时间，则返回的 CPU 时间是当前线程在用户模式或系统模式下执行的时间量。
3.  **[getRuntimeMXBean](http://java.sun.com/javase/6/docs/api/java/lang/management/RuntimeMXBean.html)**返回[RuntimeMXBean](http://java.sun.com/javase/6/docs/api/java/lang/management/RuntimeMXBean.html)
    1.  [getUptime()](http://java.sun.com/javase/6/docs/api/java/lang/management/RuntimeMXBean.html#getStartTime()) Java 虚拟机的正常运行时间，以毫秒为单位。
    2.  [getStartTime()](http://java.sun.com/javase/6/docs/api/java/lang/management/RuntimeMXBean.html#getStartTime()) Java 虚拟机的启动时间，以毫秒为单位。
    3.  [getInputArguments()](http://java.sun.com/javase/6/docs/api/java/lang/management/RuntimeMXBean.html#getInputArguments())返回传递给 Java 虚拟机的输入参数，其中不包括 main 方法的参数。
4.  **[getCompilationMXBean](http://java.sun.com/javase/6/docs/api/java/lang/management/CompilationMXBean.html)**返回[CompilationMXBean](http://java.sun.com/javase/6/docs/api/java/lang/management/CompilationMXBean.html)
    1.  [getName()](http://java.sun.com/javase/6/docs/api/java/lang/management/CompilationMXBean.html#getName()) JIT 的名称
    2.  [getTotalCompilationTime()](http://java.sun.com/javase/6/docs/api/java/lang/management/CompilationMXBean.html#getTotalCompilationTime())编译代码所需的时间（以毫秒为单位）。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-06-18T08:17:50.587

很容易获得的是通过[`System.getProperties`](http://java.sun.com/javase/6/docs/api/java/lang/System.html#getProperties())(or [`System.getProperty`](http://java.sun.com/javase/6/docs/api/java/lang/System.html#getProperty(java.lang.String))) 方法可访问的信息。

例如，`os.name`将返回操作系统的名称。在我的系统上，我得到了`Windows XP`结果。

一些可用的信息[`System.getProperties`](http://java.sun.com/javase/6/docs/api/java/lang/System.html#getProperties())，似乎可以通过小程序访问，包括：

*   `java.vm.version`-- JVM 的版本。
*   `java.vm.vendor`-- JVM 的供应商名称。
*   `java.vm.name`-- JVM 的名称。
*   `os.name`-- 操作系统的名称。（例如`Windows XP`）
*   `os.arch`——系统架构。（例如`x86`）
*   `os.version`-- 操作系统的版本。（例如`5.1`）
*   `java.specification.version`-- JRE 规范版本。

以上不是一个完整的列表，但它可以提供一些关于系统是什么样的想法。

需要注意的是，并不是所有可以`System.getProperties`通过`AccessControlException`. 当我试图读取该`java.home`属性时，抛出了一个异常。

要获得默认情况下导致的那些属性，`AccessControlException`可能必须采取一些步骤来授予小程序执行其中一些信息的权限。（这里是[课程](http://java.sun.com/docs/books/tutorial/deployment/applet/index.html)[安全限制](http://java.sun.com/docs/books/tutorial/deployment/applet/security_practical.html)部分的链接： [Java 教程](http://java.sun.com/docs/books/tutorial/index.html)中的小程序。）

该类`Runtime`可以提供以下信息：

*   该方法可用于 JVM 的处理器（或内核或逻辑线程）的数量[`Runtime.availableProcessors`](http://java.sun.com/javase/6/docs/api/java/lang/Runtime.html#availableProcessors())。
*   Java 虚拟机的内存信息，如[`freeMemory`](http://java.sun.com/javase/6/docs/api/java/lang/Runtime.html#freeMemory())、[`maxMemory`](http://java.sun.com/javase/6/docs/api/java/lang/Runtime.html#maxMemory())和[`totalMemory`](http://java.sun.com/javase/6/docs/api/java/lang/Runtime.html#totalMemory())。

`System`除了默认和类提供的信息之外，`Runtime`可能还需要调用操作系统，这将取决于平台。

**编辑**

课程中的[获取系统属性](http://java.sun.com/docs/books/tutorial/deployment/applet/properties.html)页面[：](http://java.sun.com/docs/books/tutorial/deployment/applet/index.html)[Java 教程](http://java.sun.com/docs/books/tutorial/index.html)的小程序提供了一个可以读取的属性列表，以及一个小程序无法读取的属性列表。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-03-02T12:58:18.383

这里还有一些：

[java.awt.Toolkit](http://download.oracle.com/javase/1.4.2/docs/api/java/awt/Toolkit.html)可能能够告诉屏幕分辨率，甚至可能更多关于图形卡的信息（来自使用的颜色模型）。

您还可以分配一些更大的字节数组并测量访问时间以获取有关缓存的大致信息（过去我们使用它来检查内存缓存技巧是否适用于 Java；他们确实如此）。但是，这些测试可能会使您的小程序挂起一段时间，因此您需要通知用户您正在执行的操作。

进行建模的小程序可以测量经过的虚拟时间与经过的实际时间的比率。在检测到慢速系统后，小程序可以增加积分步长和类似的常数，以减少 CPU 时间，即使以不太完美的输出为代价。[这里](http://ultrastudio.org/en/Special%3aReview?review=8362de82-fc7d-3a1b-a245-812417fca6a3&pkg=0&cls=1&view=1)有一个这样的自我调整代码的例子，它在模拟鸟群行为时调整步速。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-03-26T13:04:19.630

使用**getNetworkInterfaces**，您可以枚举系统中的网络接口：

[http://www.browserleaks.com/java](http://www.browserleaks.com/java)

它可能会显示重要信息，例如网络适配器名称和连接名称。

# java - 如何绕过数据表中的验证？JSF

> ID：1011071
> 
> 赞同：0
> 
> 时间：2009-06-18T06:19:39.663
> 
> 标签：java, jsf

我有两个 SelectOneMenu 的表。我需要根据首先选择的数据在第二个菜单中填充数据。我需要绕过验证阶段，因为。我动态地将行添加到表中。

```
+-- Table ---------------------------------------------------+
|                           |                                |
| Field 1: |____________|v| |  Field 2.1: |____________|v|   |
+---------------------------+--------------------------------+
| Field 1: |____________|v| |  Field 2.2: |____________|v|   |
|                           |                                |
+------------------------------------------------------------+ 
```

有我的代码：

```
 <h:selectOneMenu value="#{rowItem.selectedItem1}"  immediate="true" valueChangeListener="#{rowItem.processValueChange}"
                                     onchange="submit()">
                        <f:selectItems value="#{rowItem.selectItems1}" />
                    </h:selectOneMenu>
                </h:column>
                <h:column>
                    <h:selectOneMenu value="#{rowItem.selectedItem1}" >
                        <f:selectItems value="#{rowItem.seriesItems2}" />
                    </h:selectOneMenu>

               ..... some more elements
            </h:dataTable> 
```

在我的桌子上，我有

```
 private ArrayList<RowItem> rowItems; 
```

我想在我的类中使用 processValueChange() 来代表 RowItem 但我不能，因为我不能在我的 RowItem 类中绑定 SelectOneMenu。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-18T12:50:39.223

为什么所有这些逻辑都在 rowItem bean 中？

你能使用 Richfaces 框架吗？

如果你，那么你将能够做大致这样的事情：

```
<h:selectOneMenu value="#{rowItem.selectedItem1}">
  <f:selectItems value="#{rowItem.selectItems1}" />
  <a4j:support event="onchange" ajaxSingle="true" action="#{helperBean.loadSeriesItems2}" reRender="areaToRender"/>
</h:selectOneMenu> 
```

# layout - 我们应该使用 CSS 框架吗？他们值得吗？

> ID：1011077
> 
> 赞同：6
> 
> 时间：2009-06-18T06:20:51.160
> 
> 标签：layout, frameworks, css, css-frameworks

CSS 框架内置了很好的样式，并要求您专注于网格，但仍然存在一些依赖性和缺乏自由度。如果我需要通过查看基于 PSD 的模型屏幕来生成网页..我会使用框架提供的类，但如果实际测量值不存在，我需要再次指定我自己的规则，这些规则将添加到我的 CSS 文件大小中，并且如果性能一如既往地是一个约束......你不需要大大小的文件..虽然它以 kb 为单位，但每一滴都很重要。

以最佳方式使用该框架的任何意见和建议。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-06-18T06:26:34.490

我认为样式重置很棒 - 但框架太局限了。您被迫使用他们的课程等。

这可能会导致一些不一致的类名，例如，如果您的网站使用连字符 (-) 分隔单词，然后使用使用下划线 (_) 的网格。

您还必须*购买*该框架，例如在您的整个站点中采用它（如果主模板正在使用它）。

请参阅[UnobtrusiveCss](http://unobtrusivecss.com/)来笑一笑 :)。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-06-18T15:35:03.277

Css 框架不像常规的代码框架/库，它们提供的功能可以让您更快地完成工作。它更像是一个启动文件，可以节省您编写在所有项目中使用的 css 的时间。

话虽如此，我确实相信使用 css 框架的最佳方法是查看您更经常使用的 css 并创建一个本土 css 框架。我个人对我的大多数项目都使用相同的重置和排版规则。我确实有一组不同的网格，但实际上这取决于项目的类型。并非所有设计都适用于网格。

在我尝试使用预先构建的框架之前，我发现自己在浪费时间删除样式或解决框架中的一些样式。这只是根据我在框架方面的经验，我确实知道喜欢使用 Blueprint 并对其发誓的人。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-23T14:03:47.483

我认为这是一个使用正确工具来完成工作的问题。

我经常使用 BluePrint CSS，它确实帮助我快速创建标准网站。大多数时候，这正是我的客户想要的。如果我需要更深入地挖掘——我将推出自己的 CSS 来完成这项工作——但这​​会使网站变得更加昂贵，并且需要更长的时间来开发和测试。

I don't think CSS frameworks are an alternative to learning CSS, they just help you do standard things quickly and easily.

Hope that helps?

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-18T06:52:55.930

CSS 框架是我最喜欢的页面设计工具，看看 960er.gs 一个不错的网格框架。

好的，您对尺寸的了解有限，但您可以更快地设计页面，一周后您会了解所有课程。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-21T16:08:49.877

所以这个故事的寓意是使用 css 重置和视觉辅助来调试 body 中的网格图像将做必要的事情。Pic 镜头插件肯定有助于匹配像素。感谢大家鼓励的回应

# javascript - 项目 JS 文件

> ID：1011087
> 
> 赞同：0
> 
> 时间：2009-06-18T06:25:07.270
> 
> 标签：javascript

我想使用 URL 的绝对路径来保护我的 JS 文件。

请帮我。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-06-18T06:29:12.490

无法完成。

您可以尝试将 JavaScript 和 CSS 隐藏在混淆文件中，但由于用户的浏览器需要它才能显示您的页面，因此足智多谋的用户总是可以从那里提取出来。

**更新：** 评论抱怨我从[论坛网站](http://69.10.233.10/Forums/1640/Web-Development.aspx?fid=1640&df=90&mpp=25&noise=3&sort=Position&view=Quick&select=3085689&fr=1#xx3085689xx)逐字取消了这个答案。我想争辩说，情况正好相反。检查时间戳和用户名。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-18T07:13:22.213

您可以尝试使用 Apache mod_rewrite 执行此操作：

```
RewriteEngine on
RewriteCond %{HTTP_REFERER} !^http://www.xyzxyz123.com/.*$ [NC]
RewriteCond %{REQUEST_URI} !^/bad.js$ [NC]
RewriteRule .*\.(js|css)$ /bad.js [NC,R] 
```

这基本上只是寻找引荐来源网址，如果它是空的，或者没有填充您的网站（浏览器应该在引荐来源：标头中传递），那么它将返回 /bad.js 。只需创建一个 /bad.js 是空的，或者包含垃圾代码等。

知识渊博的人总能弄清楚如何篡改他们的标头以传递 Referer 标头，所以我不会认为这是一个包罗万象的方法。

希望这可以帮助。

# django - 从 Django 测试访问 Django 测试服务器

> ID：1011088
> 
> 赞同：7
> 
> 时间：2009-06-18T06:25:18.173
> 
> 标签：django, unit-testing, thrift

我想编写一个直接执行 HTTP 请求的单元测试（而不是使用 django.test.client.Client）。

如果你好奇为什么——这是因为我想测试我从 Django 应用程序公开的 Thrift-over-HTTP API——并且我想在单元测试中使用 Thrift 客户端。

问题是在测试期间，服务器实际上并没有运行。使用 django.test.client.Client 时，它只会调用视图函数，而不是实际发出 HTTP 请求。（如果我错了，请纠正我。）

那么强制测试框架启动 HTTP 服务器的最佳方法是什么？

我尝试编写一个执行以下操作的 bash 脚本：

```
./manage.py testserver --addrport 7000 &
PID=$!
sleep 5
./manage.py test --no-input
kill $PID 
```

但这很麻烦（并且实际上不起作用），因为 1）我需要睡眠（否则测试将在测试服务器初始化数据库之前开始）和 2）测试将尝试再次初始化数据库（在testserver 已经对其进行了初始化）。

对此还有其他解决方案吗？

谢谢你。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-06-18T08:10:10.477

是的，你是对的 - 这是一个问题，并且有一个错误：[http ://code.djangoproject.com/ticket/2879](http://code.djangoproject.com/ticket/2879)

[只是，你可能会遇到多线程问题，故意省略：http :](http://code.djangoproject.com/ticket/3357) //code.djangoproject.com/ticket/10117 [http://code.djangoproject.com/ticket/4513](http://code.djangoproject.com/ticket/10117) [http://code.djangoproject.com/ticket/](http://code.djangoproject.com/ticket/4513) [3357](http://code.djangoproject.com/ticket/3357)

我很沮丧，因此我编写了一个库，其中包括在单独的线程中启动实时服务器并在之后清理它：http: [//devel.almad.net/trac/django-sane-testing/](http://devel.almad.net/trac/django-sane-testing/)。它还通过运行时猴子补丁启动 Django 的多线程服务器，您可以改用cherrypy http（无论如何这更好）。

唯一的问题是它要求您使用鼻子作为测试框架（与标准单元测试 100% 向后兼容，但如果您已经在使用其他东西......）。然后，您可以只使用 --with-django 和 --with-djangoliveserver/--with-cherrypyliveserver。不知道它将如何与节俭一起工作。

请注意：

*   请不要用错误报告给 Django 开发人员带来错误，你自己一个人
*   Windmill 提供了相同的解决方案，所以如果您使用的是 Windmill，您可能会遇到端口冲突

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2021-03-19T11:25:14.447

如果您想使用真实的 HTTP 请求测试您的应用程序，请使用Django 附带的[`LiveServerTestCase`or 。`StaticLiveServerTestCase`](https://docs.djangoproject.com/en/3.1/topics/testing/tools/#liveservertestcase)

在您的`tests.py`文件中，添加如下代码：

```
from django.contrib.staticfiles.testing import StaticLiveServerTestCase

class Example(StaticLiveServerTestCase):
    def test_example(self):
        subprocess.check_call(["curl", self.live_server_url]) 
```

然后通过运行运行测试`python manage.py test`。

# iphone - 未使用 initWithNibName 从 NIB 加载子视图

> ID：1011093
> 
> 赞同：2
> 
> 时间：2009-06-18T06:28:17.873
> 
> 标签：iphone

我在我的 RootViewController（它是一个 UITableViewController）中有下面的代码。当单击导航栏中的按钮时执行此代码，然后（在模拟器中）显示下一个视图。但是，在由 TripDetailsController 管理的视图中绘制的子视图（UITextLabels、UIButtons）不显示。此外，在屏幕顶部的导航栏中，未显示原始视图的“返回”按钮，但是当我单击导航栏的左侧时，它确实转换回原始视图。

*   TripDetailsController.view 链接到 Interface Builder 中的 TripDetailsView (UIView)
*   tdController 确实有一个值，所以它看起来好像是加载的
*   TripDetailsController 位于单独的 NIB 文件中
*   使用 iPhone SDK 2.2.1（所以还不是 3.0）

代码：

```
 TripDetailsController *tdController = [[TripDetailsController alloc]
                  initWithNibName:@"TripDetailsController" bundle:nil];
 [self.navigationController pushViewController:tdController animated:YES];
 [tdController release]; 
```

在 TripDetailsController 类中，我添加了 viewDidLoad 方法，如下所示：

代码：

```
- (void)viewDidLoad {
  [super viewDidLoad];
  self.navigationItem.title = @"Reis Details";    

  NSLog(@"Subviews: %@", self.view.subviews);
  UILabel *l = [self.view.subviews objectAtIndex:0];
  NSLog(@"Subview 0 bounds: %@", l.bounds);
} 
```

下面的日志消息确实显示了子视图，但也没有设置边界：

代码：

```
6/18/09 Jun 18, 2009   10:06:00 PM ReisAdvies[11226] Subviews: (
    <UILabel: 0x56f250>,
    <UILabel: 0x56f5a0>,
    <UILabel: 0x56f6b0>,
    <UILabel: 0x56f780>
) 
6/18/09 Jun 18, 2009   10:06:00 PM ReisAdvies[11226] Subview 0 bounds: (null) 
```

在 Interface Builder 中，“标签大小”选项卡确实显示了 X/Y/W/H 的值。感觉我必须触发它来做一些布局活动，但是在 viewDidLoad() 中调用 layoutSubviews 并没有帮助。有什么想法可能是这里的问题吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-18T20:24:01.970

在 Interface Builder 中找到了解决方案：

1.  在 NIB 文件中，我没有包含 UIWindow，因此我在 NIB 文件中添加了一个 UIWindow，并将 TripDetailsController.view 插座连接到新添加的 UIWindow。
2.  文件的所有者视图属性连接到 TripDetailsView (UIView)
3.  File 的 Owner 类设置为 UIViewController

现在它按预期工作。

不是 100% 确定这是否是这样做的“方法”，但至少它似乎对我有用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-18T09:54:56.693

我在您的代码中注意到的第一件事是您调用了如下函数：

```
tdController.loadView; 
```

据我所知，这不能在objective-c中完成。你必须这样称呼它：

```
[tdController loadView]; 
```

另外，您在哪里进行所有初始化？在“loadView”中，在“viewDidLoad”中？

尝试使用类似这样的方式将控制器添加到屏幕（推送视图而不是视图控制器）：

```
[self.view insertSubview:tdController.view atIndex:0]; 
```

上面的代码假设它在另一个 UIViewController 子类中运行，它将控制器的视图作为子视图加载到它自己的视图中。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-18T10:01:24.917

> 此外，在屏幕顶部的导航栏中，未显示原始视图的“返回”按钮，但是当我单击导航栏的左侧时，它确实转换回原始视图。

您是否为您的 navigationItem 设置了标题？

例如，在 TripDetailsController viewDidLoad

```
self.navigationitem.title = @"trip detail"; 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-18T06:57:22.957

您导航到子视图的方式对我来说通常很好。我唯一要提到的是您的 [TripDetailController -loadView] 消息。我从来没有做过这样的事情。通常，我只是将一些状态信息传输到依赖控制器，然后再将其添加到 UINavigationController，依赖于标准机制（即 viewDidLoad）来初始化控制器的逻辑。

您是否收到 -viewDidLoad 消息？您的控制器在那一刻启动并运行了吗？

可能这是您项目中某处的微妙接线问题/类型。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-07-27T01:04:02.050

这对我有用...

从 XIB 中剥离 Window 和 ViewControl 并使文件所有者成为我的 ViewCONtroller 类，然后将文件所有者视图连接到我的视图。

是否使用 initWithNibName 加载...

iPhone Dev 的新手，对我可以在 IB 中吊死自己的方式感到有些疲惫。

# nginx - Nginx 位置指令似乎不起作用。我错过了什么吗？

> ID：1011101
> 
> 赞同：39
> 
> 时间：2009-06-18T06:32:14.997
> 
> 标签：nginx

我已经将 Nginx 设置为我的主要 Web 服务器，并在其后面有两个基于 Mochiweb 的服务器。某些请求被反向代理到这两个服务器。现在，我想使用 nginx 访问 phpmyadmin（位于 /var/www/nginx-default/phpMyAdmin），但它一直说找不到错误 404。我在这里遗漏了一些明显的东西吗？

```
server {
    ############### General Settings ####################
    listen   80;
    server_name  localhost;
    access_log  /home/me/dev/wwwaccess.log;

    ############## Document Root #######################    
    location / {
        root   /home/me/dev;
        index  index.html index.htm index.php;
    }

    ############## PHPMyAdmin #######################   
    location /phpmyadmin {
        root   /var/www/nginx-default/phpMyAdmin;
        index  index.html index.htm index.php;
    }

    ############## Proxy Settings for FastCGI Server #####
    location ~ \.php$ {
        fastcgi_pass   127.0.0.1:9000;
        fastcgi_index  index.php;
        fastcgi_param  SCRIPT_FILENAME  /home/me/dev$fastcgi_script_name;
        include /etc/nginx/fastcgi_params;
    }

    ############# Proxy Settings for Mochi1 ###############
    location /mochi1 {
            proxy_pass         http://127.0.0.1:8000;
            proxy_redirect     off;

            proxy_set_header   Host             $host;
            proxy_set_header   X-Real-IP        $remote_addr;
            proxy_set_header   X-Forwarded-For  $proxy_add_x_forwarded_for;

            client_max_body_size       10m;
            client_body_buffer_size    128k;

            proxy_connect_timeout      90;
            proxy_send_timeout         90;
            proxy_read_timeout         3600;

            proxy_buffering off;
        }

    ############# Proxy Settings for Mochi2 ###############
    location /mochi2 {
            proxy_pass         http://127.0.0.1:8001;
            proxy_redirect     off;

            proxy_set_header   Host             $host;
            proxy_set_header   X-Real-IP        $remote_addr;
            proxy_set_header   X-Forwarded-For  $proxy_add_x_forwarded_for;

            client_max_body_size       10m;
            client_body_buffer_size    128k;

            proxy_connect_timeout      90;
            proxy_send_timeout         90;
            proxy_read_timeout         3600;

            proxy_buffering off;
        }

    ############# Error redirection pages ################
    error_page   500 502 503 504  /50x.html;
    location = /50x.html {
        root   /home/me/dev;
    }
} 
```

* * *

## 回答 #1

> 赞同：83
> 
> 时间：2009-07-08T16:44:13.317

这里的问题是只有“最佳”`location`指令被采用，顺序如下：

```
location =  <path>  (longest match wins)
location ^~ <path>  (longest match wins)
location ~  <path>  (first defined match wins)
location    <path>  (longest match wins) 
```

使用此规则集，您的`/phpmyadmin` `location`指令会被正则表达式“ `.php$`”`location`指令击败，因此前者将被完全忽略。此外，您的 php fastcgi 指令硬连线到您的`/home/me/dev`目录，这意味着 phpMyAdmin 完全无法访问。您可以使用重写来为您的 phpMyAdmin 脚本获取正确的根目录：

```
location ~ \.php$ {
    set $php_root /home/me/dev;
    if ($request_uri ~* /phpmyadmin) {
        set $php_root /var/www/nginx-default/phpMyAdmin;
    }

    fastcgi_pass   127.0.0.1:9000;
    fastcgi_index  index.php;
    fastcgi_param  SCRIPT_FILENAME  $php_root$fastcgi_script_name;
    include /etc/nginx/fastcgi_params;
} 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2012-09-11T15:07:55.033

直接设置'root'。更少的指令，更少的计算需要设置更多的变量。还有其他一些东西（如 fastcgi_param DOCUMENT_ROOT）不会在当前接受的答案中正确设置。但是，此方法将处理所有这些：

```
location ~ \.php$ {
    if ($request_uri ~* /phpmyadmin) {
        root /var/www/nginx-default/phpMyAdmin;
    }

    fastcgi_pass   127.0.0.1:9000;
    fastcgi_index  index.php;
    include /etc/nginx/fastcgi_params;
} 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2013-05-19T17:19:17.393

我为此苦苦挣扎了好几个小时，上面讨论的解决方案都不适用于我的情况（因为我需要运行 index.php、带参数的 index.php 以及 index.php 以外的其他 php 脚本），但最终达到了工作配置如下：

```
 location /php-app {
    passenger_enabled off;
    alias /path/to/php-app/$1;
    index index.php index.html;
    try_files $uri $uri/ @rewrite;
   }

   location @rewrite {
    rewrite ^/php-app(.*)$ /index.php?q=$1 last;
   }

location ~ \.php$ {
    alias /path/to/php-app/$1;
    rewrite ^/php-app(.*)$ $1 last;
    passenger_enabled off;
    fastcgi_pass unix:/tmp/php-fpm.socket;
    fastcgi_index index.php;
    include /etc/nginx/fastcgi_params;
    fastcgi_param SCRIPT_FILENAME /path/to/php-app$fastcgi_script_name;
    fastcgi_intercept_errors on;
    } 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-22T12:47:03.950

也许它会搜索 index.html？尝试更改为

```
location /phpmyadmin {
    root   /var/www/nginx-default/phpMyAdmin;
    index index.php;
} 
```

并在下面添加部分，以避免与案例相关的问题

```
location /phpMyAdmin {
   rewrite ^/* /phpmyadmin last;
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2021-05-02T21:06:24.150

这是一个为两个不同文件夹提供服务的配置的实际示例，一个受保护，另一个不受保护。

Nginx 服务于两个文件夹： http:yourhost:port/ 上的 /usr/share/nginx/html/ （受 htpasswd 保护） http:yourhost:port/health/ 上的 /usr/share/nginx/static/ （开放以允许健康）监控）

```
 location / {
        root   /usr/share/nginx/html/;
        index  index.html index.htm;
        auth_basic           "Administrator’s Area";
        auth_basic_user_file /etc/nginx/.htpasswd;
    }

    location ^~ /health/ {
        root   /usr/share/nginx/static;
        index  index.html index.htm;
    }
```

# xml - 如何停止 XSL 非转义 URL

> ID：1011103
> 
> 赞同：0
> 
> 时间：2009-06-18T06:32:53.950
> 
> 标签：xml, url, xslt, escaping, url-encoding

我正在使用 XSL 在浏览器中显示电子邮件消息的 XML 表示。电子邮件附件存储在与主电子邮件 XML 文件不同的文件中，因此我希望生成的电子邮件网页包含指向其附件的链接。

然而，一些附件本身就是电子邮件，可能是转发或回复的，因此可能具有包含冒号的名称，例如**FW:Important**。该名称被 URL 转义为**FW%3AImportant**，并作为文件存储为**FW%3AImportant.xml**。

问题是我的 XSL 生成网页中的 URL 未转义，并且再次包含冒号 ( **file://FW:Important.xml** )，因此是一个损坏的链接。阻止这种行为的最佳方法是什么？

这是 XML 片段：

```
<email:part email:filename="FW%3AImportant">
    <email:attachment filename="FW%3AImportant.xml">
        FW%3AImportant.xml
    </email:attachment>
</email:part> 
```

这是 XSL 片段：

```
<xsl:template match="email:email/email:parts">
    <xsl:for-each select="email:part/email:attachment">
        <a>
            <xsl:attribute name="href">
                <xsl:value-of select="@filename" />
            </xsl:attribute>
            <xsl:value-of select="@filename" />
        </a>
    </xsl:for-each>             
</xsl:template> 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-18T08:32:27.017

我认为你在这里走错了路。取消转义 URL 的不是 XSLT，而是浏览器。

XML（以及 XSLT）已知的唯一转义序列是“ `&xxx;`”的形式。URL 字符串的 " `%xx`" 保持不变。

问题是您`<a href="...">`包含浏览器正在尝试使用的字符串。所以你在编码 URL 时做错了。

当文件系统上的文件存储为：

```
FW%3Aimportant.xml
```

那么引用它的正确 URL 必须是：

```
<a href="FW%253AImportant.xml">FW%3AImportant.xml</a>
<!-- ------^^^ the '%' char itself must be escaped! --> 
```

这意味着您必须在将字符串放入`href`属性之前对其进行 URL 编码，就像在任何其他生成 HTML 的系统中一样。

不幸的是，XSLT 中没有本地 URL 编码功能。这意味着您可以使用 XSLT 环境的扩展函数，或者使用 XPath 字符串函数在单独的模板中进行编码。由于正确的 URL 编码并非微不足道，因此我建议使用此处证明的内容。这是一个样式表，您可以参考 ( `<xsl:import>`) 为您完成它： http: [//skew.org/xml/stylesheets/url-encode/](http://skew.org/xml/stylesheets/url-encode/)

# logging - 如何使用 Enterprise Library Logging 仅编写消息以调试输出？

> ID：1011106
> 
> 赞同：14
> 
> 时间：2009-06-18T06:36:08.780
> 
> 标签：logging, enterprise-library

我想使用 EntLib Logging 实现日志记录，并为“调试”类别连接两个 TraceListener。一个将这些消息写入文件，另一个将它们输出到系统跟踪输出，就像 Debug.Write 一样（这样我就可以使用 Sysinternals DbgView 监视它们），但我找不到如何使用格式化程序设置第二个侦听器我需要。我真正需要的只是消息，但它会输出一大堆东西，比如 EventId、Priority 等。我该如何删除所有这些东西？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-06-18T16:00:47.933

我在 MSDN 上找到了一个不错的演练：[Creating a Custom Trace Listener](http://msdn.microsoft.com/en-us/library/dd139989.aspx)

它正是我需要的。这是我最终得到的完整代码：

```
using System;
using System.Diagnostics;
using Microsoft.Practices.EnterpriseLibrary.Common.Configuration;
using Microsoft.Practices.EnterpriseLibrary.Logging;
using Microsoft.Practices.EnterpriseLibrary.Logging.Configuration;
using Microsoft.Practices.EnterpriseLibrary.Logging.TraceListeners;

namespace Common.Utils
{
    [ConfigurationElementType(typeof(CustomTraceListenerData))]
    public class FormattedDebugWriterTraceListener : CustomTraceListener
    {
        public override void TraceData(TraceEventCache eventCache, string source, TraceEventType eventType, int id, object data)
        {
            if (data is LogEntry && this.Formatter != null)
            {
                this.WriteLine(this.Formatter.Format(data as LogEntry));
            }
            else
            {
                this.WriteLine(data.ToString());
            }
        }

        public override void Write(string message)
        {
            Debug.Write(message);
        }

        public override void WriteLine(string message)
        {
            Debug.WriteLine(message);
        }

    }
} 
```

配置文件：

```
<?xml version="1.0" encoding="utf-8"?>
<configuration>
  <configSections>
    <section name="loggingConfiguration" type="Microsoft.Practices.EnterpriseLibrary.Logging.Configuration.LoggingSettings, Microsoft.Practices.EnterpriseLibrary.Logging, Version=3.1.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a" />
    <section name="dataConfiguration" type="Microsoft.Practices.EnterpriseLibrary.Data.Configuration.DatabaseSettings, Microsoft.Practices.EnterpriseLibrary.Data, Version=3.1.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a" />
  </configSections>
  <loggingConfiguration name="Logging Application Block" tracingEnabled="true"
    defaultCategory="General" logWarningsWhenNoCategoriesMatch="true">
    <listeners>
      <add listenerDataType="Microsoft.Practices.EnterpriseLibrary.Logging.Configuration.CustomTraceListenerData, Microsoft.Practices.EnterpriseLibrary.Logging, Version=3.1.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a"
        traceOutputOptions="None" type="Common.Utils.FormattedDebugWriterTraceListener, Common.Utils"
        name="FormattedDebugWriterTraceListener" initializeData="" formatter="SimpleMessageFormatter" />
      <add fileName="log\Debugging.log" rollSizeKB="0" timeStampPattern="yyyy-MM-dd"
        rollFileExistsBehavior="Overwrite" rollInterval="Week" formatter="GeneralTextFormatter"
        header="----------------------------------------" footer="----------------------------------------"
        listenerDataType="Microsoft.Practices.EnterpriseLibrary.Logging.Configuration.RollingFlatFileTraceListenerData, Microsoft.Practices.EnterpriseLibrary.Logging, Version=3.1.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a"
        traceOutputOptions="None" type="Microsoft.Practices.EnterpriseLibrary.Logging.TraceListeners.RollingFlatFileTraceListener, Microsoft.Practices.EnterpriseLibrary.Logging, Version=3.1.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a"
        name="RollingFlatFileTraceListener" />
    </listeners>
    <formatters>
      <add template="{message}&#xD;&#xA;" type="Microsoft.Practices.EnterpriseLibrary.Logging.Formatters.TextFormatter, Microsoft.Practices.EnterpriseLibrary.Logging, Version=3.1.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a"
        name="SimpleMessageFormatter" />
      <add template="Timestamp: {timestamp}&#xD;&#xA;Message: {message}&#xD;&#xA;Category: {category}&#xD;&#xA;Priority: {priority}&#xD;&#xA;EventId: {eventid}&#xD;&#xA;Severity: {severity}&#xD;&#xA;Title:{title}&#xD;&#xA;Machine: {machine}&#xD;&#xA;Application Domain: {appDomain}&#xD;&#xA;Process Id: {processId}&#xD;&#xA;Process Name: {processName}&#xD;&#xA;Win32 Thread Id: {win32ThreadId}&#xD;&#xA;Thread Name: {threadName}&#xD;&#xA;Extended Properties: {dictionary({key} - {value}&#xD;&#xA;)}"
        type="Microsoft.Practices.EnterpriseLibrary.Logging.Formatters.TextFormatter, Microsoft.Practices.EnterpriseLibrary.Logging, Version=3.1.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a"
        name="GeneralTextFormatter" />
    </formatters>
    <categorySources>
      <add switchValue="All" name="Debugging">
        <listeners>
          <add name="FormattedDebugWriterTraceListener" />
          <add name="RollingFlatFileTraceListener" />
        </listeners>
      </add>
      <add switchValue="All" name="General" />
    </categorySources>
    <specialSources>
      <allEvents switchValue="All" name="All Events" />
      <notProcessed switchValue="All" name="Unprocessed Category" />
      <errors switchValue="All" name="Logging Errors &amp; Warnings" />
    </specialSources>
  </loggingConfiguration>
</configuration> 
```

用法是这样的：

```
Debug.Write("Debug.Write test");
Logger.Write("EntLib test", "Debugging"); 
```

两者都以 DbgView 可轻松跟踪的调试输出结束。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-18T07:02:51.200

在应用程序的 EntLib 配置中，您可以指定要使用的 Formatter。默认格式化程序包括所有这些信息。要删除您不感兴趣的信息，请从您当前使用的 TextFormatter 中删除它们，或者创建一个包含所需字段的新文本格式化程序并更改“调试”以使用您的新格式化程序。

# android - 对 Android 联系人应用程序中的新联系人做出反应

> ID：1011111
> 
> 赞同：4
> 
> 时间：2009-06-18T06:39:42.720
> 
> 标签：android, android-contacts

每次用户在 Android 联系人应用程序中添加新联系人时，我都想执行某个操作。这将包括使用新联系人的信息。

是否有捷径可寻？是否有可以监听的事件或者我必须扩展联系人应用程序本身？或者，如果这不可行，我是否应该考虑其他方法。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-06-19T14:16:31.273

看起来您最好的做法是运行一个轻量级后台服务，该服务使用[内容观察者](http://developer.android.com/reference/android/database/ContentObserver.html)来获取联系人数据，因为在输入新联系人时没有公开广播的意图。关于这个想法的更详细的讨论可以在[android-developers google group 网站上](http://groups.google.com/group/android-developers/browse_thread/thread/a1aca12e78664064?tvc=2)找到。

# php - PHP XML节点删除

> ID：1011114
> 
> 赞同：1
> 
> 时间：2009-06-18T06:41:38.613
> 
> 标签：php, xml, dom

我有一个带有大量标签的 XML 文件。它在这里和那里有超过 2000 个标签。我想删除所有 htmlText 标记并将其保存为新的 xml。如何在 PHP 中做到这一点？？？这是我正在使用的代码

```
$remove = $doc->getElementsByTagName('htmlText');
$doc->removeChild($remove); 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2010-09-09T23:18:51.207

这两个解决方案应该有效：

```
$elements = $doc->getElementsByTagName('htmlText');
while ($elements->length > 0) {
  $elements->item(0)->parentNode->removeChild($elements->item(0));
} 
```

或向后循环

```
$elements = $doc->getElementsByTagName('htmlText');
for ($i = $elements->length-1; $i >= 0; $i--) {
    $elements->item($i)->parentNode->removeChild($elements->item($i));
} 
```

如前所述使用 foreach 或从 0 向上循环将不起作用，因为在循环时节点列表会发生变化。您可以使用以下代码段对此进行测试：

```
$doc = new DOMDocument();
$doc->loadHTML('<p>first</p><p>second</p><p>third</p>');
foreach ($doc->getElementsByTagName('p') as $el) {
    $el->parentNode->removeChild($el);
}
echo $doc->saveHTML(); 
```

这里的节点列表包含 3 个元素：0=>first、1=>second、2=>third。如果你运行它，你会看到第二个元素没有被删除，因为第一次迭代删除了索引 0 处的元素（'first'），节点列表只剩下 2 个元素（0=>second，1=>third）。下一次迭代删除索引 1（第三个）处的元素，循环结束。如果您随后保存文档，您会发现第二个元素保持不变。当您对上一个建议说“它只会删除其中一些”时，这可能就是您所经历的。

# java - Java中的逐行打印

> ID：1011116
> 
> 赞同：2
> 
> 时间：2009-06-18T06:41:54.213
> 
> 标签：java, printing

我想在 Dotmatrix 打印机（Epson LQ-300 打印机）上逐行打印一页。这意味着，我将向打印机发送一行文本，休息后我将发送另一行，现在这两行都应该在一个页不在两页上。

请告诉我如何实现这一目标。

问候。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-18T06:49:55.700

您可能首先需要一个通信库 - 并行或串行端口。从 Java 1.2 开始就有一个相当老的 Sun 实现，但我们仍然在 Java 5 中成功使用它。接口在 javax.comm 包中定义。以此为起点。

由于您没有提供有关您的情况的更多信息，因此以下内容有些含糊，但无论如何希望对您有所帮助：

Com/Serial 和并口取决于平台，需要一段本机代码。对于 Linux，有提供实现的 RxTx 项目。

然后，您只需根据打印机理解的协议使用适当的参数（有一个端口枚举器）打开它，将数据写入端口。对于大多数 Epson 打印机，这是 ESC/P(2) 标准。设置完成后，打印多行纯文本应该像将它们打印到屏幕一样简单。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-18T06:55:59.013

老实说，我从未尝试过自己发送打印机，但我做了一些谷歌搜索（是吗？），[本教程](http://www.javaworld.com/javaworld/jw-07-2005/jw-0725-print.html)看起来很有希望。

现在，关于后一个请求，您只需要构建一个文本缓冲区，将文本发送到该缓冲区中，然后可以将其内容转储到打印机。如果我过度简化了您的问题，请纠正我=）

# ms-access - 我怎样才能每人只返回一条记录？

> ID：1011122
> 
> 赞同：0
> 
> 时间：2009-06-18T06:43:57.300
> 
> 标签：ms-access

我有一个包含员工退休金供款的数据库，我尝试运行查询以确定他们的供款频率，当我运行查询时，每次员工供款时，我都会得到一个条目。

我想要的只是标准中要求的每位员工一个条目。例如。每周，每两周等

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-18T13:40:19.483

您需要按员工 ID 或姓名字段进行分组。在查询构建器中，您可以通过将查询类型更改为交叉表然后再更改回选择来执行此操作。然后，每个字段都有一个“总计”选项。对于 ID 字段，将其设置为“分组依据”。要计算字段，请使用带有“计数”选项的字段。

我不确定你的标准应该是什么，我需要看看你的桌子是如何设置的，以及你想知道什么。您可能只需要在某个时间段内每个人有多少条记录。

或者，您可以转到 SQL 编辑器并编写一个涉及 GROUP BY 子句的查询。Access 的帮助应该给出示例。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-18T15:56:33.067

听起来你想要的查询应该是这样的：

```
SELECT Table1.StaffName, Count(Table1.StaffName) AS NumberOfEntries
FROM Table1
WHERE Table1.DateEntered Between #6/2/2009# And #6/15/2009#
GROUP BY Table1.StaffName 
```

您可以使用任何您想要的日期范围，它只会返回每人一行。一列将显示该人的姓名，另一列将显示一个数字，表示该人在所选日期范围内拥有多少条记录。

# document - EDI X12 810 文档

> ID：1011127
> 
> 赞同：1
> 
> 时间：2009-06-18T06:46:11.133
> 
> 标签：document, edi, x12, invoices

我在哪里可以找到同一个 810 文档中包含多张发票的示例文档？我发现的大多数样品只有一张发票。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-07-01T03:22:40.907

Safeway 有一个示例，其中包含两张发票：

[Safeway 810 004030 样品](http://suppliers.safeway.com/usa/doc/810-X12-004030Sample.doc)

如果您有翻译，创建出站 810 地图以生成您自己的测试数据可能是一个值得练习的练习。在我的贸易伙伴没有真正准备好或提供我认为不足以执行我们流程的所有功能的测试数据时，我不得不在很多情况下这样做。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-03-21T02:03:24.937

试试这个安全通道：

[http://suppliers.safeway.com/usa/edi_us/edi_mapping.asp](http://suppliers.safeway.com/usa/edi_us/edi_mapping.asp)

# .net - 线程如何在对象中工作

> ID：1011134
> 
> 赞同：1
> 
> 时间：2009-06-18T06:50:23.843
> 
> 标签：.net, multithreading, windows-services

嘿伙计们，我在线程方面完全没有经验，所以这是我的问题：

**线程如何在对象的实例中工作，特别是，我正在处理 Windows Service**。

那么，我的服务基本上是一个对象的实例，对吧？

因此，假设我的服务中有一个 System.Timers.Timer，并且每 10 秒触发一次 ElapsedEventHandler。

假设 Timer 事件处理程序中的每个操作都需要 1 分钟才能完成。

**每个事件是否由不同的线程处理？**

**如果是这样，我的对象的属性对此有何反应？属性是否跨线程共享？**

**线程限制是多少？他们用完了吗？如果是这样，当 Timer Event 触发并且所有线程都被占用时会发生什么？**

**非常感谢，我对如何跨线程共享属性**特别感兴趣？如果这就是发生的事情。

干杯！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-06-18T06:56:41.773

Jon Skeet 在这里有一些关于线程基础的介绍性页面（注意[这里](http://www.yoda.arachsys.com/csharp/threads/)有 17 个单独的主题页面）。

> 每个事件是否由不同的线程处理？

这取决于特定的计时器，但这将是一个安全（即最坏情况）的假设

> 属性是否跨线程共享？

是的; 除非您自己编写`[MethodImpl(MethodImplOptions.Synchronized)]`（使方法同步）或使用诸如`lock`. 唯一的例外是用特殊属性标记的静态字段`[ThreadStatic]`，然后每个线程都有一个静态字段。

> 线程限制是多少？他们用完了吗？如果是这样，当 Timer Event 触发并且所有线程都被占用时会发生什么？

部分受限于操作系统资源，部分受限于它们是“常规”线程还是池线程。但是，如果您使用的足够多，这会成为一个问题，那么您的线程就太多了。如果没有足够的资源来启动一个线程，要么它会开始失败（常规线程），要么工作会简单地堆积起来，等待更多的可用性（池线程）。完全有可能使线程池饱和并死锁一切。基本上避免过多的线程。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-18T06:58:33.923

这是一个相当复杂的话题，我建议在这里花一些时间阅读 msdn 上的大量线程文档：http: [//msdn.microsoft.com/en-us/library/3e8s7xdd.aspx](http://msdn.microsoft.com/en-us/library/3e8s7xdd.aspx)

每个计时器经过的事件都在单独的线程上处理（并且线程来自控制线程可用性的 ThreadPool）。对象和属性是跨线程共享的，你有责任锁定临界区。我使用静态 Interlocked 类进行轻量级锁定。如果你用谷歌搜索的话，会有很多例子。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-18T06:58:11.397

[System.Timers.Timer](http://msdn.microsoft.com/en-us/library/system.timers.timer.aspx)将在每次 Elapsed 触发时使用一个线程池线程，我不知道是否有最大值，但线程池应该以一种好的方式处理这个我希望..但同时运行多个线程是不推荐，cpu必须一直更换线程，这是有代价的。

属性在不同的线程之间共享，但如果你不让它们线程安全，它们就不是线程安全的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-18T06:58:57.230

是的，每次触发事件时，都会在线程池线程上进行处理。此外，内存中只有一个对象实例，因此线程将共享对相同变量的访问。

阅读线程和计时器是一个非常好的主意，也许看看一些例子，因为否则你可能最终会在让事情可靠工作的过程中拔掉大部分头发。

注意：我希望您的处理程序不会在每 10 秒事件触发时花费 1 分钟，因为那样您的运行线程数将每分钟增加 5 个并且永远不会再次下降……您不能继续做越来越多的工作同时地。

# java - 如何加快 Java 单元测试？

> ID：1011136
> 
> 赞同：38
> 
> 时间：2009-06-18T06:50:35.793
> 
> 标签：java, performance, unit-testing, ant

目前我们的项目有超过 3000 个单元测试，“ant testAll”需要 20 多分钟。除了获得更好的硬件之外，还有什么方法可以加快速度吗？

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2009-06-18T07:01:45.587

与加速任何其他代码的方式相同。找出哪些测试花费的时间最多，并了解如何优化它们。

有很多操作可能很慢，如果你执行 3000 次，它就会加起来。有时，在测试之间重用数据是值得的（即使您不应该在单元测试中这样做，如果这是让您的测试以可接受的速度运行所需要的，那么它可能是必要的）。

计时你的测试。通常，它们中的 90% 几乎会立即执行，而最后 10% 几乎会占用所有时间。找到那 10%，看看他们在做什么。

通过分析器运行代码，并注意时间花费在哪里。猜测是浪费时间。你*认为*测试运行者在做什么是没有意义的。与其猜测，不如*找出*它在做什么。然后你就会知道如何加快速度。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-06-18T07:04:16.520

一些想法：

*   使用模拟框架来避免访问数据库（或进行 Web 服务调用等）。
*   如果您对许多单独的测试进行相同或相似的设置，请尝试在测试夹具设置中进行（即每个夹具完成一次而不是每次测试一次）。
*   我相信一些测试框架允许你并行运行测试

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-06-18T07:16:56.760

您可能希望将单元测试拆分为套件。您的应用程序是模块化的吗？您真正需要多久运行一次所有测试？如果您的开发人员只运行与他们自己的模块相关的单元测试，并且您让一系列测试在夜间和/或 CI 上运行，这是否可以接受？

是否有任何非常复杂的特定单元测试（我知道，我在这里滑入功能和集成测试，但这条线有时很模糊），但它们中的任何一个都可以在开发过程中运行在*健全*的水平上然后是CI用完了？

*编辑*：只是为了好玩，我将在我以前的一个项目中简要描述测试例程

首先，测试系统的增长是有机的，这意味着它不是最初计划出来的，而是随着它的增长而修改和变化的。因此，它并不完美，并且随着时间的推移，一些命名约定已成为杜撰。

*   在开发人员级别，我们使用了一个名为 CheckIn 的简单两分钟测试套件，它验证了代码足够健康，可以加入主干。
*   最重要的是，我们在 CI 机器上连续运行健全性测试。这些是更复杂的集成和功能测试、所有单元测试和所有回归测试的简化版本。
*   复杂的测试套件（以小时为单位）在白天和晚上远程运行，并在第二天早上编译结果。

自动测试 - 这是笨蛋的坚果。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-06-18T07:49:23.047

首先：
a) 获取有关 Junit 测试运行时间的统计信息。您可能已经在测试报告中获取了该信息。
b) 取出前 10 个测试课程（按时间计算）并尝试减少时间。您需要持续进行此操作。
c) 尝试通过重构甚至改变测试方法来减少运行时间。
我遇到的一个这样的案例是在一个用于 CRUD 测试用例的测试类中。更新测试用例首先创建功能然后更新。但是我们已经在单独的测试用例中测试过创建。所以在这些情况下，您可以链接您的测试用例，例如

```
@Test()
    public void testCreate() throws Exception
    {}
    @Test(dependsOnMethods = "testCreate")
    public void testAmend() throws Exception
    {}
    @Test(dependsOnMethods = "testAmend")
    public void testDelete() throws Exception
    {} 
```

因此，您可以节省重复测试。

d）我能够显着减少时间的另一个例子是。我们有一个系统（inherietd），其中每个测试用例都调用 SetUp（Strating Spring Server 等）并在运行后关闭系统资源。这非常耗时，所以我重构它以在测试套件之前和整个套件之后启动 coomon 资源完成然后关闭那些。

e) 根据您的项目，它们可能是您可能需要解决的其他瓶颈。

[如何在 TDD 中管理构建时间](https://stackoverflow.com/questions/930407/how-to-manage-build-time-in-tdd)

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-06-18T14:52:46.903

你`fork="yes"`在`junit`通话中使用吗？如果是这样，请确保设置`forkMode="once"`，否则 junit 任务将为每个 TestCase 类启动一个新 VM。通过 3000 个单元测试，这将产生巨大的差异。

[http://ant.apache.org/manual/Tasks/junit.html](http://ant.apache.org/manual/Tasks/junit.html)

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2009-06-18T10:53:47.917

我假设您已经完成了所有其他常用步骤，例如模拟数据库调用、优化测试设置阶段等，并且测试运行这么长时间是因为您有 3000 个测试而不是单个测试非常慢。

如果是这样，**一种方法是多线程测试运行。**Test-NG 很好地支持了这一点。将您的测试从 junit 转换为 test-ng 并不难，只需要完成一次。

必须按顺序运行的测试可以很容易地标记：

```
@Test(sequential = true)
public class ATest {
  ... 
```

在多核机器上，您会看到运行时的巨大改进。即使在单核上，您也会看到一个很好的改进，因为一些线程等待 io 操作。

有关如何设置的详细信息，请参见此处：

[http://beust.com/weblog/archives/000407.html](http://beust.com/weblog/archives/000407.html)

希望这可以帮助。

……

**更多建议**- 我不敢相信您没有使用持续集成。相信我，30 名开发人员不会让你的 CI 服务器超载。即使您无法购买 CI，也可以在您自己的机器上安装[hudson](http://hudson-ci.org/) - 设置需要 10 分钟，而且好处是巨大的。询问您的经理，每个开发人员都在等待单元测试完成或让服务器为您完成，哪个更糟糕。为破坏构建的人戴上一顶愚蠢的帽子通常足以说服开发人员运行他们的单元测试。

如果签入的质量确实是一个大问题（不要忘记签入总是可以回滚）考虑[Teamcity](http://www.jetbrains.com/teamcity/) - 它运行测试并且如果测试失败则不会提交代码。

最后，可能适合您的用例的选项也是[clover 和竹子](http://java.dzone.com/articles/implementation-dukes-choice)。*最新版本记录了哪些代码由哪些测试进行测试，以及何时进行更改，它只运行相关测试。*这可能非常强大。

但是请记住，像 test-ng、teamcity 和 clover 这样的聪明工具只会让你走这么远——好的测试不会自己编写！

**总结一下我的解决方案是尝试以下全部或部分步骤：**

1.  优化测试——模拟、通用设置等。
2.  并行运行测试
3.  获取其他东西来为您运行测试 - 使用 hudson 或类似工具使其成为离线任务
4.  只运行需要运行的测试——将它们分类成包或使用三叶草和竹子。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-06-18T08:09:25.330

显然，您的测试中有一些东西需要很长时间。

有时，您无法绕过缓慢的测试。例如，测试 Spring 是否可以读取其所有配置文件，测试 hibernate 映射是否有效，诸如此类。这些测试的好处是它们只需要在单个测试中运行，然后你可以全部模拟出来，但你也可以决定将它们作为集成测试的一部分运行，让构建服务器担心它。

其余的测试很慢，要么是因为它们正在执行 IO，要么是因为它们过度受 CPU 限制。

IO 可以是很多东西。Web 服务和数据库调用可以被抽象出来和模拟，如果需要的话，你必须做的几个真正的调用可以移动到集成阶段。日志记录也确实可以减慢速度——尤其是 3.000 个测试用例。我会说完全关闭日志记录并在测试失败时依靠您的大脑和调试器。

在某些情况下，IO 本身就是被测试的单元。例如，如果您正在测试将表数据写入磁盘的数据库服务器部分。在这种情况下，尽量在内存中保留尽可能多的 IO。在 Java 中，许多 IO 抽象都有内存实现。

CPU 边界测试也有不同的风格。纯性能和吞吐量测试应该在集成测试阶段。如果您正在启动一堆线程来尝试检查并发错误，那么您可能会将大型测试移至集成阶段并在常规测试套件中保留一个“轻量级”版本。

最后，分析器是你的朋友。很可能您的部分代码可以提高效率并显着加快您的测试速度。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-06-18T07:00:39.583

如果不进一步了解正在测试的内容，唯一容易呈现的两种方法是：

*   使用更好的硬件（对不起）
*   简化测试逻辑

您甚至可能想在测试运行中运行分析器，看看是否有任何特别低效的测试实现。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-06-18T07:02:59.687

好吧，我不知道您的单元测试在做什么，但是您需要问自己*为什么*要花 20 分钟。根据我的经验，通常有很多测试在几毫秒内运行，而剩下的所需时间很少。大多数情况下，这些是涉及 IO/network/DB-Stuff 的测试。例如，如果您由于网络延迟而花费大量时间等待，您可能会考虑并行运行测试。

您可以寻找这些测试并寻找改进。但是让你的测试更快并不会让你的实际代码更好。您可能需要注意需要大量时间的测试，因为被测类不是最佳的。查明和改进此类情况很可能也会使您的产品更好/更快。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-06-19T01:20:50.610

我建议有两个构建（每次签入时运行的增量构建和夜间运行的完整构建）

增量版本在大约 7 分钟内运行较短的测试，而完整版本在不到 40 分钟内运行所有测试的时间更长。

Clearcase 确实鼓励了分支噩梦，但您应该能够为每个开发人员构建两个版本。我会质疑让每个开发人员都在自己的分支上进行开发的价值，因为我相信让开发人员在同一个分支上（成对或更多）一起工作会有一些好处。

注意：一台持续集成服务器可以有任意数量的代理，如果您买不起多台服务器，您可以使用 PC 作为构建代理。（您必须至少拥有其中的 30 个）

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-06-19T16:01:18.843

这是我将采取的方法。

1.  查看您的测试用例，寻找任何多余的测试。通过 3000 次测试，您很可能会覆盖不必要的部分。
2.  挑选你的“金丝雀”。这些是您要始终运行的测试，它们会在其他部分嗅出危险。它们很可能是测试组件之间使用的公共 API 接口的更高级别的测试用例。如果其中一个失败，您可以进入并运行该组件的完整测试套件。
3.  开始迁移到像[TestNG](http://testng.org/doc/documentation-main.html)这样的框架并开始对您的测试用例进行分类，然后只对您正在处理的内容进行分类，并使用每晚的完整测试。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-06-18T13:54:54.807

我同意巴勃罗吉姆的观点。并行化您的测试。我们正在使用 clearcase 并从视图服务器传输所有内容确实减慢了速度。当我们在 Duelcore 上进行并行化时，我们得到了 6-8 倍的更短测试运行。

我们正在使用 CPPUnit 框架，我们刚刚添加了一个 python 脚本来在不同的线程上启动不同的测试套件。

我们还使用 clearmake 来并行化构建过程。我们的下一步可能是在开发人员的客户端上并行化测试。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-06-18T22:59:12.843

我会像解决任何其他性能问题一样解决这个问题：

1.  不要假设问题是什么
2.  使用分析器分析测试执行以确定热点
3.  一次分析一个热点，在每次代码更改后重新测试。

您可能会发现最终必须深入研究该测试运行程序。您可以使用[cavaj](http://www.bysoft.se/sureshot/cavaj/)之类的反编译工具从类文件生成源代码（尽管它显然比原始代码更难阅读）。您可能会发现测试运行器实现中的某些内容正在影响性能。例如，您已经提到读取 XML 配置文件作为测试运行程序执行的一项活动——这可能会影响性能。

您最终可能会发现性能问题的另一个领域是自定义“基础”测试用例类。这些往往会增加很多便利性，但很难记住您的便利性添加行为可能会在一个大型项目中分摊到 10k 次测试中，无论每个测试是否需要便利行为。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2009-06-18T14:17:40.110

在连续集成引擎系统中移动完整的测试套件，因此开发人员不必每次都运行它们。这样的系统比开发人员更有耐心。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-08-15T20:38:41.033

The most effective way to speed up a large test suite is to run it incrementally, so that only tests that touch code changed since the last test run are re-executed. After all, the fastest tests will always be those which are **not** executed. 8^)

The hard part is actually getting this to work. I am currently working in incremental testing for JUnit 4, which is part of the "JMockit Coverage" tool in the [JMockit](https://jmockit.dev.java.net) developer testing toolkit. It's still immature, but I believe it will work well.

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2009-11-18T00:14:25.267

数据库访问和网络延迟可能是需要检查的领域。如果您在集成测试中执行大量数据库访问，您可能想要探索使用像 HSQL、H2 或 Derby 这样的内存数据库，而不是像 Oracle 这样的“真实”数据库。如果您使用的是 Hibernate，您还必须更改 Hibernate 配置中的设置以使用特定于该数据库的方言（例如，HSQLDialect 而不是 OracleDialect）。曾经在一个项目中，每个完整构建最终都必须删除并重新创建整个 Oracle 模式并通过网络执行大量数据库测试，有时需要长达 20 分钟，然后你发现有人签入并且事情被破坏了再次。:(

理想情况下，您只希望有一个可用于两个数据库的数据库脚本，但您最终可能不得不同步两个不同的数据库创建脚本——一个用于生产，一个用于集成测试。

同一 JVM 中的数据库与网络中的数据库 - 可能会有所不同。

# ruby - 包含一个模块来定义动态类方法

> ID：1011142
> 
> 赞同：3
> 
> 时间：2009-06-18T06:53:01.077
> 
> 标签：ruby, class, module

我正在玩 Ruby，我编写了以下代码：

```
module IdAndNameRedefine
  def self.included(base)
    base.extend(ClassMethods)
  end

  module ClassMethods
    def use_id_and_name_from_module(use_attribute)
      class_eval <<CODE
        def id_and_name
          "\#{id}-\#{#{use_attribute}.downcase}"
        end
CODE
    end
  end
end

class Model
  include IdAndNameRedefine

  attr_reader :id, :name1, :name2

  def initialize(id, name1, name2)
    @id = id
    @name1 = name1
    @name2 = name2
  end

  def id_and_name
    "#{id}-#{name1}"
  end

  use_id_and_name_from_module :name2
end

model = Model.new(1, "TesT", "Test number TWO")
puts model.id_and_name 
```

当我在这里尝试做的是用-module`id_and_name`动态插入的方法覆盖类Model中的类方法。`IdAndNameRedefine`当包含该模块时，它会创建一个“静态”方法（实际上是我理解的 Model.class 的类方法），当`use_id_and_name_from_module`被调用时，它会在 Model 中创建一个类方法，该方法重新定义`id_and_name`使用 Model 的任何属性要求。

**我的问题是..** 有没有更好的方法，或者这是“正确”的方法吗？我不太确定我是否喜欢 class_eval 带有一个字符串，我需要在其中转义值等以使其工作。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-06-18T07:27:54.087

您不必将字符串传递给`class_eval`. 它可以改为一个块。事实上，我想不出有一次我必须将字符串传递给`class_eval`. 所以我们可以像这样重写 ClassMethods 模块：

```
module ClassMethods
  def use_id_and_name_from_module(use_attribute)
    class_eval do 
      define_method(:id_and_name) {"#{id}-#{send(use_attribute).downcase}"}
    end
  end
end 
```

但在这种特殊情况下，我们只是告诉`self`to `class_eval`，这意味着我们已经在该类的上下文中。所以它实际上可以缩短为：

```
module ClassMethods
  def use_id_and_name_from_module(use_attribute)
    define_method(:id_and_name) {"#{id}-#{send(use_attribute).downcase}"}
  end
end 
```

（我只是想展示`class_eval`真正的工作原理，因为你似乎对那部分最感兴趣。）

# java - 是否有基于构建器的用于 selenium 的 java api？

> ID：1011151
> 
> 赞同：1
> 
> 时间：2009-06-18T06:56:03.723
> 
> 标签：java, selenium

有谁知道“经典” [com.thoughtworks.selenium.Selenium](http://release.seleniumhq.org/selenium-remote-control/0.9.0/doc/java/com/thoughtworks/selenium/Selenium.html)接口的基于构建器的替代/补充？看起来这对这个api来说是一个更好的方法......

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-18T13:07:52.013

你见过[Tellurium 自动化测试框架](http://code.google.com/p/aost/)吗？

# asp.net - 控件在当前上下文中不可用

> ID：1011156
> 
> 赞同：0
> 
> 时间：2009-06-18T06:56:49.043
> 
> 标签：asp.net, visual-studio-2008, svn, tortoisesvn

我使用 tortoise svn "Apply Patch" 命令将补丁应用于 asp.net 页面。补丁是使用“创建补丁”命令创建的。

该补丁在 aspx 页面中添加了一个标签控件，并在代码隐藏中添加了一些对其的引用。现在，除非我先单独构建页面，否则解决方案将无法构建。有时即使这样也行不通。

该页面是经常构建和运行的完全有效的 asp.net 和 c# 代码。唯一的区别是代码是在 visualstudio 之外添加的，在 tortoisemerge 中。

任何修复

注释：该文件已经在项目中。只是在 vs 外部添加了一个新控件

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-18T07:02:49.407

问一个愚蠢的问题：）

你说它是在VS之外添加的。那么您是否将文件包含在您的项目/解决方案中。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-07-24T07:23:07.037

我无法解释原因，但在从 svn 获取新的工作副本后问题已解决

# codedom - 通过 CodeDOM 生成变量名

> ID：1011157
> 
> 赞同：0
> 
> 时间：2009-06-18T06:56:56.483
> 
> 标签：codedom

大家好，

请在这件事上给予我帮助：

我有一个包含我的自定义控件的表单。

在自定义控件中，我有 2 个集合引用同一个 DataSource 来获取数据。

我当前的 CodeDOM 序列化程序是这样工作的：

```
control1.Values.DataSource = new objA();
   control1.CategoryNames.DataSource = new objA(); 
```

如您所见，objA 被实例化了 2 次。

如何解决这个问题？

我想我可以声明一个包含对 objA 的引用的变量，然后将该变量分配给 2 个集合：

```
 ObjA var = new objA();
    control1.Values.DataSource = var;
   control1.CategoryNames.DataSource = var; 
```

但我不能确保“var”是一个唯一的名称。我怎样才能让它自动分配给我的控件（控件 1、控件 2 等）的名称？

谢谢你。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-18T07:11:17.647

作为替代方案，您可以将变量命名为 guid。它不能保证是唯一的，但很可能会是唯一的（尤其是如果您的类中没有其他变量被命名为 guid）。

您需要对其进行一些过滤以使其成为有效的变量名，例如确保它以字母开头并删除破折号。

```
string variableName = "A" + Guid.NewGuid().ToString().Replace("-",""); 
```

# asp.net - 收集 SQL 数据并反馈给 asp.net Web 应用程序

> ID：1011159
> 
> 赞同：1
> 
> 时间：2009-06-18T06:58:03.830
> 
> 标签：asp.net, sql, sql-server

我有以下情况：我有一个存储过程，它从一堆表中获取数据并将记录创建到单个表中。之后，最终用户可以根据结果表中的行中的数据获取一些图形。问题在于，将多个表中的数据收集到生成的表中可能需要很长时间的运行。我想从我的 Web 应用程序中为用户提供启动此数据收集的可能性，并在完成时通知他这一点，以便他可以根据收集到的数据访问图形图表。我的问题是如何将其作为最佳实践来实施。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-18T07:25:17.960

在服务器上启动一个后台线程来进行处理。您可以将处理结果存储在[会话状态](http://msdn.microsoft.com/en-us/library/ms178581.aspx)、数据库或其他位置。

在客户端，使用[UpdatePanel](http://www.asp.net/Ajax/Documentation/Live/overview/UpdatePanelOverview.aspx)和 Timer 定期轮询服务器以获取结果。当结果出现时，禁用计时器。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-18T08:29:39.050

我会做一些像 Andomar 建议的事情，但是在 Windows 服务中，而不是在 asp.net 进程中的线程中。

首先，我会在我的数据库中设置一个用作工作队列的表——也许你的结果表就足够了？此表将包含作业唯一 ID、作业描述（由您的服务用于确定要做什么）和作业状态代码（新、工作、已完成）。

然后我会设置一个 Windows 服务应用程序，它会定期轮询这个表。根据您的负载，可能每 5-30 秒一次。该服务很简单：如果它发现任何新工作，它将第一个工作标记为“工作”，然后运行数据收集过程。该过程完成后，服务会将作业标记为已完成。

最后，在我的 asp.net 应用程序中，我将设置一个作业订单页面，用户可以在其中请求新的数据收集作业。该请求将在工作队列表中插入一条新记录，状态为新的，工作描述根据需要。然后页面会将用户重定向到一个新页面（或使用 ajax），该页面将检查作业的状态并每 XX 秒重新加载一次以检查作业是否完成。当作业状态代码设置为完成时，我们会显示用户可以显示报告或下载文件或其他内容的页面。

我在这里建议的是基于轮询的作业队列的简单实现。你当然可以使用 MSMQ 或类似的东西制作一个更高级的版本，但这对于大多数情况来说应该足够了。

# python - RIA 需要学习什么

> ID：1011168
> 
> 赞同：1
> 
> 时间：2009-06-18T06:59:45.277
> 
> 标签：python, silverlight, html, ria

我计划在大约一年后（当我当前的合同结束时）建立一个 RIA。您会建议在什么技术上投入时间？

我需要对视频、音乐和画布提供良好的跨浏览器/平台支持。理想情况下，我想利用我的 Python 技能。

Silverlight 看起来很有趣，因为我可以通过 .NET 使用 Python。但我在 Linux 上，所以我永远是二等公民。而且它的安装基数很低。另一方面，Flash 拥有庞大的安装基础。由于与 Oracle 的交易，我不确定 JavaFX。

还是我应该对 HTML 5 抱有希望？

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-18T07:10:04.077

如果您有一年的准备时间，我建议您研究所有可以研究的技术。为不同的平台构建你好世界。然后在每个候选框架上构建相同的简单 RIA，以更好地了解差异。显然你不会发现每一个小问题，但总的架构和风格会很明显。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-18T08:08:47.360

您应该关注“HTML5”，其中“HTML5”是新的“Ajax”流行词。“开放式 Web 平台”——不仅仅是 HTML 5 规范本身。

Flash、Silverlight 和 JavaFX 都是单一供应商的插件产品，但“HTML5”是多供应商的浏览器原生产品。

如果您想要一个 IDE 工作流程，您可以使用 Google Web Toolkit 拥有一个针对浏览器原生无插件功能集的 Java 工作流程。不幸的是，目前还没有类似 GWT 的 Python 系统。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-18T07:09:50.800

Silverlight/Flash 是有趣但封闭的平台

[openlaszlo](http://www.openlaszlo.org/)是您应该考虑的另一个 RIA 平台，您使用 XML/javascript 编写并输出到多个平台，例如 Flash/DHTML，并且将来可能会更多

另一个候选者是[Titanium](http://www.appcelerator.com/)，您可以在其中使用 python

我个人的选择是只使用普通的 javascript/HTML，如果可能的话，可能是 HTML5 服务器端的 django，客户端的 jquery

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-20T02:03:14.693

我会推荐 Flash/Flex/AIR。它肯定会给你最大的自由来构建你想要的东西。

Flex 非常适合制作 RIA，现在有了 AIR，您现在可以部署到桌面。

这里有几个链接：

*   [Adobe.com 上的丰富互联网应用程序](http://www.adobe.com/resources/business/rich_internet_apps/#open)
*   [弹性 RIA](http://www.flex888.com/)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-06-20T02:15:22.033

环顾四周时，请查看[Titanium 。](http://www.appcelerator.com/)它类似于 AIR，您可以使用 Python 印章。

Otherwise, I would say go as HTML/CSS/JavaScript as you can, and use Flash for any multimedia that you can't get to work otherwise. Keep in mind that mobile web is exploding and right now Flash is not a great solution for mobile (or at least not yet).

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-10-05T12:37:45.107

[http://pyjs.org/](http://pyjs.org/) pyjs is a Rich Internet Application (RIA) Development Platform for both Web and Desktop. With pyjs you can write your JavaScript-powered web applications entirely in Python.

# cocoa - Cocoa - 来自 NSDate、NSCalendarDate 的本地化字符串

> ID：1011175
> 
> 赞同：3
> 
> 时间：2009-06-18T07:01:56.740
> 
> 标签：cocoa, nsdate, localization

我正在使用 NSDate 来获取一个字符串，例如“18 Jun 09”，代码：

```
NSDate *theDate = [NSDate date];
NSString *dateString = [theDate descriptionWithCalendarFormat:@"%d %b %y"
        timeZone:nil
        locale: nil]; 
```

这可行，但只会产生英文输出。我需要将输出本地化为用户的默认语言。

Cocoa（在这种情况下为 Mac OS X 10.4、10.5）是否提供了这种本地化的工具，还是我必须为我自己的每个日期和月份名称手动本地化？

（我提供了一个语言环境，但尽管它确实提供了特定于语言环境的日期排序，但它似乎没有对日月名称进行任何本地化。）

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-06-18T07:07:47.620

这是[来自 Apple 的片段](http://developer.apple.com/documentation/Cocoa/Conceptual/DataFormatting/Articles/dfDateFormatting10_4.html)：

```
NSDateFormatter *dateFormatter = [[[NSDateFormatter alloc] init] autorelease];

[dateFormatter setDateStyle:NSDateFormatterMediumStyle];

[dateFormatter setTimeStyle:NSDateFormatterNoStyle];

NSDate *date = [NSDate dateWithTimeIntervalSinceReferenceDate:118800];

NSString *formattedDateString = [dateFormatter stringFromDate:date];

NSLog(@"formattedDateString for locale %@: %@", [[dateFormatter locale] localeIdentifier], formattedDateString); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2011-01-09T23:48:12.997

似乎缺少一行代码：

```
[dateFormatter setLocale:usLocale]; 
```

# installation - 如何编写批处理文件以在拥有 500 多个用户的网络上安装应用程序包？

> ID：1011182
> 
> 赞同：0
> 
> 时间：2009-06-18T07:04:28.750
> 
> 标签：installation, batch-file

我有一个在生产环境中很有用的应用程序包。我需要通过运行批处理文件来安装而不打扰用户。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-18T07:31:15.657

通常，这是通过创建“安静”安装程序来完成的，该安装程序在安装您的应用程序时不会向用户或进度表提出任何查询，然后使用 Microsoft SMS 或您的组织已经使用的其他桌面管理工具分发安装程序（如果它是 500+用户，您必须使用某些工具...）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-18T07:25:32.517

通过在 Sysadmin 姊妹站点上询问这个问题，您可能会得到更好的回应：[http](http://serverfault.com) ://serverfault.com 。

# cocoa - 将 NSNumberFormatter 的否定格式从 (xxx.xx) 更改为 -xxx.xx

> ID：1011183
> 
> 赞同：8
> 
> 时间：2009-06-18T07:04:31.197
> 
> 标签：cocoa, cocoa-touch, number-formatting, negative-number

我想将我的 NSNumberformatter 从显示带括号的负数更改为将减号放在前面（或任何本地化标准）。

我假设我可以用 setNegativeFormat 做到这一点：

但是阅读 Apple 的非常详尽的文档，我只能摸不着头脑：

* * *

**设置负格式：**

设置接收器用于显示负值的格式。

```
- (void)setNegativeFormat:(NSString *)aFormat 
```

**参数** aFormat 一个字符串，它指定负值的格式。

**可用性** 适用于 iPhone OS 2.0 及更高版本。

**另见** - 负格式

**在** NSNumberFormatter.h中声明

* * *

我对 aFormat 有什么选择？！？来吧Doc Writers，这里的链接会杀了你吗？

编辑：这是值得的声明：

```
NSNumberFormatter *currencyFormatter = [[NSNumberFormatter alloc] init];
[currencyFormatter setNumberStyle:NSNumberFormatterCurrencyStyle]; 
```

保留本地化的货币符号和小数位对我来说很重要，无论它们是什么。所以 [currencyFormatter setNegativeFormat:@"-#,##0.00"] 可能无法工作，因为缺少货币并且不能为所有货币假设 2 位小数。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-06-18T07:27:21.407

如果您查看[Cocoa 的数据格式化编程指南](http://developer.apple.com/documentation/Cocoa/Conceptual/DataFormatting/Articles/dfNumberFormatting10_4.html#//apple_ref/doc/uid/TP40002368-SW5)中的“格式化字符串”部分：

> 格式字符串使用[Unicode 技术标准 #35](http://unicode.org/reports/tr35/tr35-6.html#Number_Format_Patterns)中的格式模式（此参考是版本 tr35-6；Mac OS X v10.4 的格式化程序使用版本[tr35-4](http://unicode.org/reports/tr35/tr35-4.html#Number_Format_Patterns)）。

**编辑：**

如果要设置基于货币的格式字符串，可以使用`¤`字符，例如：

```
[formatter setFormat:@"¤#,##0.00"]; 
```

这将添加当前本地化的货币符号来代替`¤`字符。

因此，将相同的概念应用于否定格式字符串：

```
[formatter setFormat:@"-¤#,##0.00"]; 
```

这也将应用货币符号代替`¤`当前本地化的 。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-18T08:05:31.407

好的，所以我得到的答案是：

```
[currencyFormatter setNegativeFormat:@"-¤#,##0.00"]; 
```

关键是什么？字符“¤”。不知道叫什么？任何人？但它以这些格式字符串表示本地化货币...

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-18T07:18:55.493

在这种情况下，它正在寻找格式 NSString。 [在此处查找格式字符串详细信息](http://developer.apple.com/documentation/Cocoa/Conceptual/DataFormatting/Articles/df100103.html)。

如果你想让负数的`12,345.67`显示为`-12,345.67`，那么我相信正确的 NSString 值是`@"-#,##0.00"`

我还在上面链接的文档中注意到以下句子：

> 如果您没有为负值指定格式，则使用为正值指定的格式，前面带有一个减号 (-)。

编辑： 10.4 及更高版本
的更新： [这是描述 10.4 及更高版本行为的 PDF](http://www.google.com/url?sa=t&source=web&ct=res&cd=1&url=http%3A%2F%2Fdeveloper.apple.com%2Fdocumentation%2FCocoa%2FConceptual%2FDataFormatting%2FDataFormatting.pdf&ei=DUQ6SobbL4P-tQPayOW2Bw&usg=AFQjCNHfP63dcTyukYI7lhesOmjHb3YKmQ&sig2=9qtunPbNMS7aorDStXszVg)
并且，从该文档链接，这里是[10.4 及更高版本所需格式的数据](http://unicode.org/reports/tr35/tr35-4.html#Number_Format_Patterns)。
从本文档看来，正确的字符串可能是：`@"-#,##0.##"`

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2014-07-10T16:06:26.353

给出的所有答案都假设货币保留两位小数，并且还使用逗号作为千位分隔符。显然有许多货币不符合这个标准，[http](http://en.wikipedia.org/wiki/Decimal_mark) ://en.wikipedia.org/wiki/Decimal_mark ，所以我使用以下技术

```
 NSString * formattedBalance = [currencyFormatter stringFromNumber:balance];
    if([formattedBalance rangeOfString:@"("].location != NSNotFound ) {
        formattedBalance = [NSString stringWithFormat:@"-%@",[[formattedBalance stringByReplacingOccurrencesOfString:@")" withString:@"" ]stringByReplacingOccurrencesOfString:@"(" withString:@"" ]];
    } 
```

# java - 用于 jdk 1.5 的系统托盘

> ID：1011184
> 
> 赞同：1
> 
> 时间：2009-06-18T07:04:35.130
> 
> 标签：java, system-tray, jdk1.6, jdk1.5

我正在将代码从 jdk 1.6 转换为 jdk 1.5，代码是：

```
import java.awt.SystemTray;

public static void main(String[] args) {
    if (SystemTray.isSupported()) {
        SystemTray tray = SystemTray.getSystemTray();
    }

    try {
       tray.add(trayIcon);
    } catch (AWTException e) {
       System.err.println("TrayIcon could not be added.");
    }
} 
```

你们能告诉我兼容的代码是什么吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-18T07:32:59.770

您可以尝试其中任何一种

[JDIC（JDesktop 集成组件）](https://jdic.dev.java.net/)

[托盘](http://www.jpackages.com/jtray/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-18T07:26:54.387

`java.awt.SystemTray`不是 JDK 5 的一部分，因此您将需要一些外部库，例如[Systray](http://systray.sourceforge.net/)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-18T07:08:44.687

在 Java 5 中，您需要外部（可能是 JNI）库来支持它。[这](http://jeans.studentenweb.org/java/trayicon/trayicon.html)是 Windows 的示例。

# c# - 如何在office word 2003 中禁用宏？

> ID：1011189
> 
> 赞同：0
> 
> 时间：2009-06-18T07:07:26.560
> 
> 标签：c#, ms-word, macros, office-2003

我正在尝试使用 Adob​​e distiller 将 word 报告转换为 PDF。其中一些word文件中有宏，当文档打开时会显示一个弹出窗口，这会停止自动化过程。

我们尝试通过禁用宏

> wordApplication.AutomationSecurity = Microsoft.Office.Core.MsoAutomationSecurity.msoAutomationSecurityForceDisable；

但现在应用程序不再触发`Document Open`事件，在该事件中实现了转换代码。在这种情况下，编写代码是为了确保仅在 word 加载文件后进行转换。

有没有其他方法可以禁用宏？或任何其他方法，以便我可以禁用宏并确保加载文件以启动转换过程。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-07-31T13:59:52.643

如果您禁用宏，则您打开的文档中的任何代码都不会运行，包括 Document Open 事件中的代码。毕竟这是一个“宏观”。无法在单个文档中运行某些宏，但不能运行其他宏。

为什么在文档打开事件中发生转换过程？为什么不在打开文档的代码中执行呢？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-07-17T20:56:54.453

如果我正确理解了这个问题，你可以做一个`try ...catch...finally`陈述。

您只需将打开的代码放在 try 中，并将变量设置为`true`if 文件已打开，然后`if/then`在 Statement 中放置一条语句，`Finally`以便如果文档已打开，它将运行转换，如果文档未打开您可以返回文档未转换的消息并说明原因。在 OP 的情况下，您可能仍然需要禁用宏。

我知道这是一个非常古老的帖子，但如果他们看到这篇文章寻求帮助，它可能会给其他人一些想法。

# windows - Qt 静态链接和部署

> ID：1011197
> 
> 赞同：76
> 
> 时间：2009-06-18T07:10:07.197
> 
> 标签：windows, qt, deployment, static

我正在尝试部署（向公众发布）我最近制作的一个简单的 qt 应用程序，但被困在静态链接 qt 库中。

我按照 qt docs 上的指南静态地重新构建 qt 和我的应用程序。但是发布版本仍然需要 qtgui / qtcore dll 没有明显的原因，我想知道是否有人以前见过这种问题？或者更好的是，已经成功解决了吗？

[http://doc.qtsoftware.com/4.5/deployment-windows.html](http://doc.qtsoftware.com/4.5/deployment-windows.html)

* * *

## 回答 #1

> 赞同：47
> 
> 时间：2009-10-31T16:17:21.457

我写[了一个静态链接指南](http://web.archive.org/web/20161222135358/http://www.formortals.com/how-to-statically-link-qt-4/)

以及 [如何使用多个编译器构建 Qt 静态并保持较小](http://web.archive.org/web/20161222125623/http://www.formortals.com/build-qt-static-small-microsoft-intel-gcc-compiler/)

（因为它可以变得相当大，特别是对于简单的程序）。您可能还想查看 BitRock 安装程序，它对开源项目是免费的。

简而言之，如果您使用 Qt 认为的任何插件，例如对大多数图像类型（JPEG、GIF）或数据库的支持，它就会变得更加复杂。例如，如果您想为您的图标包括对 Oracle DBMS 和 GIF 图像的支持，您可以将以下内容添加到您的 .PRO 文件中：

```
QTPLUGIN += qsqloci qgif
CONFIG += static 
```

然后，您将需要：

```
#include <QtPlugin> 
```

在您的项目中，并导入使用的任何插件。您需要更改这些设置以使其再次使用动态链接进行编译（例如在调试或添加功能时），尽管这可以很容易地自动化。在构建用于静态链接的 Qt 库时也有一些注意事项，尽管 Qt 说明至少可以帮助您入门。

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2015-09-16T16:19:19.440

使用 Qt 5.5，事情变得非常简单。`configure`在构建 Qt 之前，您必须运行该脚本。您传递给以下正交设置`configure`：

0.  你想要一个静态的 Qt 库吗？

`-static`选项应该传递给`configure`

1.  您希望 Qt 和您的应用程序的构建使用静态 C++ 运行时吗？

`-static-runtime`选项应该传递给`configure`

2.  您想要 XP 定位吗？

`-target xp`选项应该传递给`configure`

此外，请按照[此博客文章](http://blogs.msdn.com/b/vcblog/archive/2012/10/08/windows-xp-targeting-with-c-in-visual-studio-2012.aspx)中的说明进行操作。

Qt Creator 至少在 v.3.5.0 之前不支持 XP 自动定位，因为它没有为构建工具正确设置环境。[您必须根据博客文章](http://blogs.msdn.com/b/vcblog/archive/2012/10/08/windows-xp-targeting-with-c-in-visual-studio-2012.aspx)手动修改构建环境。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2011-01-26T13:16:52.040

另外，请注意，您的静态构建仍将动态链接到 Visual Studio 运行时！

请参阅[此常见问题解答](https://wiki.qt.io/Qt_project_org_faq#Why_does_a_statically_built_Qt_use_the_dynamic_Visual_Studio_runtime_libraries_.3F_Do_I_need_to_deploy_those_with_my_application_.3F)（[互联网存档链接，以防链接消失](https://web.archive.org/web/20160428171509/https://wiki.qt.io/Qt_project_org_faq#Why_does_a_statically_built_Qt_use_the_dynamic_Visual_Studio_runtime_libraries_.3F_Do_I_need_to_deploy_those_with_my_application_.3F)）：

> **为什么静态构建的 Qt 使用动态 Visual Studio 运行时库？我需要将它们与我的应用程序一起部署吗？**
> 
> Qt 是使用 -MD(d) 开关构建的，该开关链接到动态 C/C++ 运行时库。这是必要的，因为我们在使用除 -MD(d) 标志之外的任何东西时都遇到过内存问题，通常建议使用。您不应该为您的应用程序自行更改此标志，因为如果您将标志更改为 -MT，它将与 Qt 库的构建方式相冲突。您也不应该为 Qt 更改它，因为它可能会导致问题。
> 
> 但是，使用 -static 选项时 Qt 仍然是静态构建的，这意味着在部署应用程序时不需要分发 Qt dll。您将不得不分发 C 运行时（如果它们在目标机器上尚不存在），请参阅我们的部署文档[http://doc.qt.io/qt-5/windows-deployment.html#application-dependencies](http://doc.qt.io/qt-5/windows-deployment.html#application-dependencies) .

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2017-10-15T02:05:21.660

[msys2](https://sourceforge.net/projects/msys2/)有一个预构建的[静态 Qt5 包](https://github.com/Alexpux/MINGW-packages/tree/master/mingw-w64-qt5-static)

例如`pacman -S mingw-w64-qt5-static`

目前，要使用 CMake 静态链接 Qt 的所有依赖项，您需要
`list(PREPEND CMAKE_FIND_LIBRARY_SUFFIXES .a .lib)`
在调用之前添加： `find_package(Qt5`...</p>

* * *

`CMAKE_AUTOSTATICPLUGINS`已被新的上游实现取代，不再需要。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2017-06-20T14:12:02.277

我刚刚使用 QT 插件（5.9）和 VS（2015）（Win）静态编译了一个应用程序（调试）。

a) 添加到您的代码中。

```
#include <QtPlugin>
Q_IMPORT_PLUGIN (QWindowsIntegrationPlugin); 
```

b）将以下内容添加到链接路径

```
\5.9.0_x86_static_install\lib
\5.9.0_x86_static_install\bin
\5.9.0_x86_static_install\plugins
\5.9.0_x86_static_install\plugins\platforms
\5.9.0_x86_static_install\plugins\imageformats 
```

c) 将 QT 静态库和内部 VS 库列表添加到您的链接列表中。

```
version.lib
imm32.lib
shlwapi.lib
rpcrt4.lib
Ws2_32.lib
Mpr.lib
Netapi32.lib
Rpcrt4.lib
Iphlpapi.lib
winmm.lib
gdi32.lib
advapi32.lib
msimg32.lib
UxTheme.lib
translatord.lib
preprocessord.lib
d3d9.lib
dxguid.lib
libEGLd.lib
libGLESv2d.lib
iphlpapi.lib
psapi.lib
ws2_32.lib
Dwmapi.lib
Qt5CoreD.lib
Qt5Guid.lib
Qt5Xmld.lib
Qt5Widgetsd.lib
Qt5Networkd.lib
Qt5Winextrasd.lib
Qt5PlatformCompositorSupportd.lib
qicod.lib
qtmaind.lib
qtlibpngd.lib
qtharfbuzzd.lib
qtpcre2d.lib
qwindowsd.lib
Qt5FontDatabaseSupportd.lib
Qt5ThemeSupportd.lib
Qt5EventDispatcherSupportd.lib
Qt5AccessibilitySupportd.lib
qtfreetyped.lib 
```

凯文·希金斯

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2018-10-22T05:46:19.140

我推荐你使用*linuxdeployqt*这个工具。它可以帮助解决大多数依赖问题。我用它成功地打包了我的 qt 应用程序。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2020-10-29T00:41:34.857

这个答案适用于在 Windows 和 qmake 中使用**MSYS2**和**mingw-w64作为编译器。**QT 版本为 5.15.0。

* * *

安装这个包`qt5-static` 会给你一个 QT 构建，它可以生成不依赖任何 QT DLL 的可执行文件。（示例命令行 - `pacman -Ss mingw64/mingw-w64-x86_64-qt5-static`）。

然而，这里引入了一个新问题：它没有将`-static`标志传递给 gcc。这意味着虽然可执行文件不依赖于 QT DLL，但它确实依赖于 libgcc-s、libwinpthread.dll 等。

通常，这个问题可以通过使用`CONFIG += static`which 导致 qmake 传递`-static`给 gcc 来解决。但是，正如其他答案中所述，对于 qt-static 构建，该配置选项被忽略！

为了解决这个问题，我必须在 qmake 文件中手动指定用于静态链接的 gcc 标志，即：

```
QMAKE_CXXFLAGS += -static
QMAKE_LFLAGS_WINDOWS += -static 
```

这会产生一个（大）二进制文件，除了 Windows 系统 DLL 之外没有外部依赖项。

（以防万一：我的用例是构建一个 COM 进程内服务器 DLL，它应该没有外部依赖项；我也在使用`TEMPLATE=lib`and `CONFIG += dll`）。

# c# - 非重复随机数

> ID：1011198
> 
> 赞同：10
> 
> 时间：2009-06-18T07:10:08.443
> 
> 标签：c#, random

要生成从 1 到 20 的随机数，我需要选择选择性并且不应该重复。

如何在 C# 中执行此操作

注意我需要像这样循环

```
Random rnd = new Random()
rnd.Next(1,20)
for(int i =0; i<=20;i++)
{

} 
```

对于所有循环数应为 1 到 20

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-06-18T07:13:59.967

“不应该重复”到底是什么意思？如果你的意思是你不想得到*任何*重复，那么你基本上应该拿一个数字 1-20 的列表，将它们洗牌，然后从列表的顶部一次抓取一个。有关随机播放列表的有效方法，请参阅[此 Stack Overflow 答案](https://stackoverflow.com/questions/962802/is-it-correct-to-use-javascript-array-sort-method-for-shuffling/962829#962829)。

如果您只是说您当前的尝试给出了 5、5、5、5、5、5、1、1、1、1、1、1、1、1、2、2、2、2、2 等，那么机会是`Random`每次选择一个数字时，您都会创建一个新实例：不要那样做。每次创建实例时，它将使用当前时间作为随机数生成器的“种子”（除非您明确指定一个）。这意味着如果您快速连续创建多个实例，每个实例将获得相同的种子，因此会给出相同的数字序列。

相反，使用单个实例`Random`并重用它。（请注意，它不是线程安全的，这很痛苦。）例如：

```
private static readonly Random Rng = new Random();

public int NextNumber()
{
    return Rng.Next(20) + 1;
} 
```

这不是线程安全的，但如果这是一个问题，请告诉我们。有时，另一种方法是将 传递给`Random`方法（当然，这通常会更复杂）：

```
public int NextNumber(Random rng)
{
    return rng.Next(20) + 1;
} 
```

然后调用者可以适当地重用该实例。

如果您想要一种生成随机数的线程安全方式，您可能需要查看我[`StaticRandom`](http://www.yoda.arachsys.com/csharp/miscutil/usage/staticrandom.html)在[MiscUtil](http://pobox.com/~skeet/csharp/miscutil)中的课程。

（请注意，使用`rng.Next(1, 21)`也可以正常工作 - 我碰巧更喜欢上面的版本，因为我认为它减少了对包含/排除边界的猜测，但这是个人品味的问题。）

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2009-06-18T08:11:32.847

此方法将生成所有数字，并且不会重复任何数字：

```
/// <summary>
/// Returns all numbers, between min and max inclusive, once in a random sequence.
/// </summary>
IEnumerable<int> UniqueRandom(int minInclusive, int maxInclusive)
{
    List<int> candidates = new List<int>();
    for (int i = minInclusive; i <= maxInclusive; i++)
    {
        candidates.Add(i);
    }
    Random rnd = new Random();
    while (candidates.Count > 0)
    {
        int index = rnd.Next(candidates.Count);
        yield return candidates[index];
        candidates.RemoveAt(index);
    }
} 
```

你可以像这样使用它：

```
Console.WriteLine("All numbers between 0 and 20 in random order:");
foreach (int i in UniqueRandom(0, 20)) {
    Console.WriteLine(i);
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-06-18T14:34:10.280

不久前我就这样做了。我不知道它与效率、随机性等方面的其他方法相比如何。但它似乎有效：

```
List<int> integers = new List<int>() { 1, 2, 3, 4, 5, 6,7, 8, 9, 10, 11, 12 };

Random rnd = new Random();

var ints = from i in integers
           orderby rnd.Next(integers.Count)
           select i; 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-09-23T17:21:06.680

一个*IEnumerable*实现，基于[Hallgrim 的](https://stackoverflow.com/questions/1011198/non-repetitive-random-number-c/1011408#1011408)回答：

```
public class UniqueRandoms : IEnumerable<int>
{
    Random _rand = new Random();
    List<int> _candidates;

    public UniqueRandoms(int maxInclusive)
        : this(1, maxInclusive)
    { }

    public UniqueRandoms(int minInclusive, int maxInclusive)
    {
        _candidates = 
            Enumerable.Range(minInclusive, maxInclusive - minInclusive + 1).ToList();
    }

    public IEnumerator<int> GetEnumerator()
    {
        while (_candidates.Count > 0)
        {
            int index = _rand.Next(_candidates.Count);
            yield return _candidates[index];
            _candidates.RemoveAt(index);
        }
    }

    System.Collections.IEnumerator System.Collections.IEnumerable.GetEnumerator()
    {
        return GetEnumerator();
    }
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-18T07:29:45.487

来自 MSDN

“提高随机性的一种方法是使种子值与时间相关。”

另一个事实

您应该“创建一个随机数以随时间生成许多随机数”。这将增强随机生成

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2014-03-20T08:37:40.110

下面的方式是很好的方式，我这里用了一个字符串，你可以把列表的类型改成你想要的……，试试看：

```
 List<string> NamesList = new List<string>() { "Name1", "Name2", "Name3", "Name4", "Name5" };
            Random rnd = new Random();
            //Now to get random of the above "Without Repeating.."
            for (int i = 0; i <= NamesList.Count - 1; i++)
            {
                int TheSelectedRand = rnd.Next(NamesList.Count);
                string MyRandNumber = NamesList[TheSelectedRand];

                //Print or use your item here

                NamesList.Remove(NamesList[TheSelectedRand]);
            } 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-07-29T09:15:10.150

```
class Program
{
    static void Main(string[] args)
    {        
        List<int> list = new List<int>();
        int val;
        Random r;
        int IntialCount = 1;
        int count = 7 ;
        int maxRandomValue = 8;

        while (IntialCount <= count)
        {
            r = new Random();
            val = r.Next(maxRandomValue);
            if (!list.Contains(val))
            {
                list.Add(val);
                IntialCount++;
            }

        } 
    }
} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2016-12-15T17:14:57.913

```
static void Main(string[] args)
{
    //Randomize 15 numbers out of 25 - from 1 to 25 - in ascending order
    var randomNumbers = new List<int>();
    var randomGenerator = new Random();
    int initialCount = 1;

    for (int i = 1; i <= 15; i++)
    {
        while (initialCount <= 15)
        {
            int num = randomGenerator.Next(1, 26);
            if (!randomNumbers.Contains(num))
            {
                randomNumbers.Add(num);
                initialCount++;
            }
        }
    }
    randomNumbers.Sort();
    randomNumbers.ForEach(x => Console.WriteLine(x));
} 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2020-07-05T05:14:35.877

就像我做的那样：

```
 list.Clear();
    int count = 0;

    while (count < 20)
    {            
        int x = Random.Range(1, 21);
        if (!list.Contains(x))
        {
            list.Add(x);
            count++;
        }
    } 
```

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2014-11-01T00:18:40.447

打击代码生成 0 - 92 之间的 65 个唯一随机数，并在数组中返回该唯一随机数。

```
public static int[] RandomNumbers_Supplier()
        {
            Random R = new Random();
            int[] RandomNumbers = new int[65];
            int k = 0, Temp;
            bool IsRepetitive = false;
            while (k < 65)
            {
                Temp = R.Next(0, 92);
                for (int i = 0; i < 65; i++)
                {
                    IsRepetitive = false;
                    if (RandomNumbers[i] == Temp)
                    {
                        IsRepetitive = true;
                        break;
                    }                    
                }
                if (!IsRepetitive)
                {
                    RandomNumbers[k] = Temp;
                    k++;
                }
            }
            return(RandomNumbers)
        } 
```

# objective-c - NSUnknownKeyException，KVC 合规代码不起作用

> ID：1011200
> 
> 赞同：1
> 
> 时间：2009-06-18T07:10:20.020
> 
> 标签：objective-c, cocoa, key-value-coding

以下代码已成功构建，对我来说似乎还可以，但不起作用...请注意，我是键值编码的新手，您的帮助将不胜感激...在表格视图中委托 didSelectRowAtIndexPath: 方法在这里categoriesList 是一个包含 5 个条目的简单表格

```
NSUInteger row = [indexPath row];
NSString *rowString = [categoriesList objectAtIndex:row];
NSString *path = [[NSBundle mainBundle] pathForResource:@"DataBase" ofType:@"plist"];
NSDictionary *rootDict = [[NSDictionary alloc] initWithContentsOfFile:path];
NSArray *allRootKeys = [rootDict allKeys];
NSMutableArray *mutableArray = [[NSMutableArray alloc] init];
for (NSString *name in allRootKeys) {
    NSInteger index = [allRootKeys indexOfObject:name];
    NSDictionary *newDict = [allRootKeys objectAtIndex:index];
    if ([newDict valueForKey:@"Class"] == rowString)
        [mutableArray addObject:[allRootKeys objectAtIndex:index]]; 
}   
NSArray *childControllerArray = [[NSArray alloc] initWithArray:mutableArray]; 
```

现在我将 childControllerArray 传递给我的下一个控制器的 loadArray ivar，当使用特定数组选择任何行并显示该数组的内容时，它会被推送。当我删除上面的代码并将一个简单的对象数组传递给它，它工作得很好....请帮助

给出的例外是：

> `Terminating app due to uncaught exception 'NSUnknownKeyException', reason: '[<NSCFString 0x543eb0> valueForUndefinedKey:]: this class is not key value coding-compliant for the key Class.`

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-18T08:01:21.680

[rootDict allKeys]; //这是一个 NSStrings 数组，而不是 NSDictionarys 数组

此代码无法工作

```
NSArray *allRootKeys = [rootDict allKeys];
NSDictionary *newDict = [allRootKeys objectAtIndex:index]; 
```

# apache - 记录基于 Web 的应用程序

> ID：1011207
> 
> 赞同：0
> 
> 时间：2009-06-18T07:11:03.323
> 
> 标签：apache, logging

我正在开发一种 Web 应用程序，最近需要在其中记录一些用户活动。因此，自然而然的问题是，为此使用 Apache 服务器日志记录机制是个好主意吗？如果答案是肯定的，请解释原因，如果不是，请解释原因。我主要担心的是在 Apache 中启用日志记录会导致性能下降。同样，构建日志机制以便能够在基于 Web 的应用程序中跟踪客户端活动的最佳实践是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-18T08:27:11.003

正如 MaxVT 所说，日志记录的开销极不可能影响性能。Web 应用程序中网络延迟的开销通常远大于单个磁盘写入，可能在个位数微秒范围内。

通常，基于 Web 的应用程序应该*始终*打开某种形式的日志记录，而 Apache 中基于 mod_logger 的日志记录是一种非常便宜的方式。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-18T07:28:22.980

Apache 只是简单地将文本附加到日志文件中——它不会对性能造成太大影响。此外，您很有可能已经启用了日志，因为这是安装在网络主机上的大多数统计数据包的工作方式（与基于网络的 Google Analytics 等不同）

如果您只有一台服务器，我会选择单独的日志文件。我喜欢将应用程序日志与 Web 服务器日志分开，因为这样更容易找到相关记录。

如果您有多个服务器并希望拥有一个公共日志，您可能需要查看 syslogd 等。将日志数据从您的应用程序服务器发送到单个日志记录机器。

在数据库中保留日志也是可能的，但可能会导致数据库服务器的负载过大，尤其是在您的应用程序已经依赖缓存来保持数据库负载较低的情况下。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-18T08:31:57.173

虽然 apache 日志记录的性能非常低，但您需要考虑日志的用途：

1.  用户能否看到“我的日志”？
2.  您是否需要根据日志“回滚”？
3.  您记录的操作类型是否有相关数据？

这些问题可以引导您选择 apache 日志记录或基于 DBMS 的自定义日志记录。

使用自定义日志记录，您可以轻松构建事务日志，只需单击一下即可帮助您将整个系统从一种状态恢复到另一种状态。

jrh

# php - PHP：将多行命令行输出输出为不同的行

> ID：1011211
> 
> 赞同：1
> 
> 时间：2009-06-18T07:12:11.217
> 
> 标签：php, command-line, command, lines

PHP：将多行命令行输出输出为不同的行。对不起，如果标题难以理解。基本上我希望我的输出像 A，而不是 B。它目前看起来像 B。我已经尝试过 nl2br。我试图运行的脚本是：

脚本：

```
echo "病毒扫描结果：";
$scanme = system('cd /var/www/upload/files; clamscan --remove=yes '.$furl);
printf(nl2br($scanme));

```

A：

```
802931t_e_s_t.txt：好的
----------- 扫描摘要 -----------
已知病毒：574585
引擎版本：0.95.1
扫描目录：0
扫描文件：1
受感染的文件：0
扫描数据：0.00 MB
数据读取：0.00 MB（比率 0.00:1）
时间：2.352 秒（0 米 2 秒）
时间：2.352 秒（0 米 2 秒）

```

乙：

```
802931t_e_s_t.txt：OK ----------- 扫描摘要 ----------- 已知病毒：574585 引擎版本：0.95.1 扫描目录：0 扫描文件：1 受感染文件： 0 扫描的数据：0.00 MB 读取的数据：0.00 MB（比率 0.00:1） 时间：2.352 秒（0 m 2 s） 时间：2.352 秒（0 m 2 s）

```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-18T07:14:57.170

如果这是在命令行上，为什么要使用 nl2br？

nl2br 输出`<br />`新行的标签...这在命令行上没有任何意义

**编辑**

两件事情：

**1**次尝试

```
system('cd /var/www/upload/files; clamscan --remove=yes '.$furl, $scanme); 
```

**2**您可能想使用[exec](http://jp2.php.net/manual/en/function.exec.php)函数而不是 system

例如

```
exec('cd /var/www/upload/files; clamscan --remove=yes '.$furl, $scanme);
$scanme = implode("\n",$scanme); 
```

exec ( 字符串 $command [, 数组 &$output [, int &$return_var ]] )

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-18T07:28:36.147

您是否尝试过直接打印命令的输出？

```
echo "Virus Scan Results:";
echo exec('cd /var/www/upload/files; clamscan --remove=yes '.$furl); 
```

PS。你真的应该像这样清理输入（如果你还没有这样做的话）：

```
$furl = escapeshellarg($furl) 
```

[escapeshellarg()](http://au.php.net/manual/en/function.escapeshellarg.php) - 转义要用作 shell 参数的字符串

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-18T07:21:32.133

如果您在命令行上运行，则换行符表示为“\n”，或在 Windows 环境中表示为“\r\n”。因此，请确保每行末尾都有一个 \n，并且您应该得到您想要的输出。编辑：
汤姆：哎呀。固定的。

# c# - 为什么在 Asp.net 中刷新页面时会发生数据操作

> ID：1011212
> 
> 赞同：1
> 
> 时间：2009-06-18T07:12:43.527
> 
> 标签：c#, asp.net

为什么在 Asp.net 中刷新页面时会发生数据操作

提交按钮以将数据插入数据库表后，如果我按 f5 或浏览器刷新，然后再次插入重复数据，为什么它保持文本框值并且没有单击提交按钮它被触发......？提供解决方案…………

提前致谢..........

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-18T07:18:56.227

听起来您应该在用户提交表单后重定向用户。只需一个简单的 Response.Redirect 即可。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-08-28T00:15:27.333

这实际上与任何特定的 Web 技术没有任何关系。当您第一次显示表单时，创建一个带有随机值的隐藏字段。称它为“transactionID”之类的东西。当用户单击“提交”时，检查该随机值是否已被使用。如果没有，请处理表格。如果是这样，请返回“您已提交此表单”或类似内容。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-18T11:49:41.970

在 IE 中，当您按下 F5 时，它会尝试执行最后执行的命令。在您的情况下，它是 POST，因此再次发生相同的选项。你可以用不同的方式处理这个问题。

1.  在数据库中完成更新后。向用户显示确认消息，以便他/她尝试 F5
2.  尝试持有一个保持操作状态的隐藏字段。（第一次隐藏字段的值为 New，一旦插入发生，它就有插入记录的 ID。）
3.  可以尝试在客户端处理，防止F5双发。

# php - 是否可以使快速排序功能对数组进行降序排序？

> ID：1011228
> 
> 赞同：0
> 
> 时间：2009-06-18T07:18:09.037
> 
> 标签：php, algorithm, sorting, quicksort

我得到了以下 php 函数，并想将其更改为降序排序，有人可以帮助我：

```
function quickSort(&$numbers, $array_size,$level)
{
   q_sort($numbers, 0, $array_size - 1,$level);
}

function q_sort(&$numbers, $left, $right,$level)
{
   $l_hold = $left;
   $r_hold = $right;
   $pivot = $numbers[$left];

   while ($left < $right)
   {
      if ($level == 'RegID')
      {
         while (($numbers[$right]->RegID >= $pivot->RegID) && ($left < $right))
            $right--;
      }

      if ($left != $right)
      {
         $numbers[$left] = $numbers[$right];
         $left++;
      }

      if($level == 'RegID')
      {
         while (($numbers[$left]->RegID >= $pivot->RegID) && ($left < $right))
            $left++;
      }

      if ($left != $right)
      {
         $numbers[$right] = $numbers[$left];
         $right--;
      }
   }

   $numbers[$left] = $pivot;
   $pivot = $left;
   $left = $l_hold;
   $right = $r_hold;

   if ($left < $pivot)
      q_sort($numbers, $left, $pivot-1,$level);
   if ($right > $pivot)
      q_sort($numbers, $pivot+1, $right,$level);

} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-18T07:35:12.497

简单：每当您比较元素时，将“>”更改为“<”，反之亦然。

这适用于所有排序算法和任何类型的排序：将数组元素的任何比较替换为回答一个元素应该在排序数组中的另一个元素之前的问题的任何表达式。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-18T07:37:02.307

当然是。看看[算法](http://en.wikipedia.org/wiki/QuickSort)是如何工作的。

```
 if ($level == 'RegID')
  {
     // Comparison
     while (($numbers[$right]->RegID >= $pivot->RegID) && ($left < $right))
        $right--;

  }

  if ($left != $right)
  {
     $numbers[$left] = $numbers[$right];
     $left++;
  }

  if($level == 'RegID')
  {
     // Comparison
     while (($numbers[$left]->RegID >= $pivot->RegID) && ($left < $right))
        $left++;
  } 
```

您只需要更改算法确定一个元素是否大于另一个元素的方式 - 因此您必须将比较运算符从 更改`>=`为`<`。

注意：你不能只使用[内置的排序功能](http://us3.php.net/manual/en/function.uasort.php)吗？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-18T07:39:10.493

“通用”方式是提供比较函数（对象），例如

```
function q_sort( &$numbers, $left, $right,$level, $comparison )
{
...
    if( $comparison->ordered( $left, $right ) )
    {...
    }
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-18T07:39:38.633

不要编写自己的排序函数，使用内置函数之一：

```
function cmp($a, $b) {
        return a->RegID - b->RegID;
}
uasort($a, "cmp"); 
```

# sql - 数据库记录 - 有效的开始和结束日期以及外键

> ID：1011230
> 
> 赞同：2
> 
> 时间：2009-06-18T07:18:19.083
> 
> 标签：sql, database, datetime

有没有人有任何使用数据集的经验，其中记录根据有效的开始和结束日期变得有效和无效？问题是当这些表中的记录具有其他表的外键时，这些表也具有有效的开始和结束日期

似乎您最终必须为几乎每个表创建新记录，以允许在维护历史记录的同时更新外键。

例子：

--- 宠物 ---
名为 jasper 的狗，主人是 jan -> jun 的 Jack，从 Jun -> jun 卖给 Ken

--- 业主 ---
Jack 从 1 月 -> 2 月住在 A 屋，然后从 2 月到 B 屋 -> 时间结束
Ken 从 2 月 -> 9 月住在 C 屋，从 9 月到 D 屋 -> 时间结束

因此，如果 jasper 在 6 月份报告，业主将是住在 B 屋的杰克。9 月运行的相同查询将是住在 D 屋的肯。

模拟这种关系的最佳方式是什么？以及如何对数据执行“更新”以保持适当的关系？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-18T07:58:47.690

我们用于此类问题的方法不是在同一个表中保留元素的所有权，而是在包含时间线的映射表中。

```
Table DOGS
 - ID
 - NAME

Table OWNER
 - ID
 - NAME

Table LOCATION
 - ID
 - HOUSE_NAME

Table DOGS_OWNERSHIP:
 - DOG_ID (FK->DOGS.ID)
 - OWNER_ID (FK->OWNER.ID)
 - START_TIME
 - END_TIME

Table OWNER_LOCATION
 - OWNER_ID (FK->OWNER.ID)
 - LOCATION_ID (FK->LOCATION.ID)
 - START_TIME
 - END_TIME 
```

这样您就可以在两个表中完全维护所有权、位置和各自的时间线。

如果所有权或位置发生更改，则更新相应时间轴表中当前所有权/位置的 END_TIME 并添加从当前时间和新结束时间（结束时间）开始的新条目。

您还想添加一些约束以确保没有任何重叠映射，但这取决于您的业务逻辑和偏好。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-18T16:01:07.340

“有没有人使用过数据集，其中记录根据有效的开始和结束日期变得有效和无效？”

是的，我有（但那是差不多 15 年前的事了）。

好消息：您的问题（即管理时间数据）是可以解决的。

坏消息：你的问题不能用今天存在的任何 SQL 系统来解决，也不太可能用将来出现的任何 SQL 系统来解决。

对于这个问题的基本处理，我可以推荐阅读 Lorentzos、Darwen 和 Date 的“时间数据和关系模型”。

对于他们想法的原型实现，我可以推荐 SIRA_PRISE。

# html - HTML div 高度问题

> ID：1011231
> 
> 赞同：2
> 
> 时间：2009-06-18T07:18:42.717
> 
> 标签：html

我的页面中有两个 div 元素垂直对齐。一个 div 的内容是固定的，但另一个 div 的内容会发生变化，因此它的高度。我想让两个 div 都具有相同的高度。我怎样才能做到这一点？？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-18T07:22:01.853

诀窍是使用 CSS 属性 display:table、display:table-row 和 display:table-cell 使容器（在本例中为 div 元素）表现得像表格单元格。

[完整的解释和演示](http://www.456bereastreet.com/archive/200405/equal_height_boxes_with_css/)

也：[使用 CSS 的等高列](http://www.ejeliot.com/blog/61)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-18T07:27:08.690

那么有两种方法：

## 使用带有假背景的 CSS

为此，您需要制作包含两列的背景图像，就像您希望看到的那样。将其显示在任何持有列的地方，现在列看起来相同的高度，即使它们不是。

您可能需要添加一个新的包装 div 来应用背景：

```
<div class="colwrap">
    <div class="col">...</div>
    <div class="col">...</div>
</div>

<div class="colwrap">
    <div class="col">...</div>
    <div class="col">...</div>
</div> 
```

## 或者，使用 jQuery（或其他）来修复高度

这稍微有点手动，但如果您启动了其他 JS 脚本，这应该不会太难。

```
if ($('col:1').height() > $('col:2').height())
    $('col:2').height($('col:1').height());
else
    $('col:1').height($('col:2').height()); 
```

或类似的东西*会*做到这一点。

# c# - 如何在 C# 中从 MS Office 文档中提取文本

> ID：1011234
> 
> 赞同：40
> 
> 时间：2009-06-18T07:20:14.430
> 
> 标签：c#, ms-office, text-extraction

我试图使用 C# 从 MS Word（.doc、.docx）、Excel 和 Powerpoint 中提取文本（字符串）。我在哪里可以找到一个免费且简单的 .Net 库来阅读 MS Office 文档？我尝试使用 NPOI，但没有获得有关如何使用 NPOI 的示例。

* * *

## 回答 #1

> 赞同：43
> 
> 时间：2011-12-28T18:21:56.197

对于 Microsoft Word 2007 和 Microsoft Word 2010 (.docx) 文件，您可以使用 Open XML SDK。这段代码将打开一个文档并将其内容作为文本返回。对于任何试图使用正则表达式来解析 Word 文档内容的人来说，它尤其有用。要使用此解决方案，您需要参考 DocumentFormat.OpenXml.dll，它是 OpenXML SDK 的一部分。

请参阅：http: [//msdn.microsoft.com/en-us/library/bb448854.aspx](http://msdn.microsoft.com/en-us/library/bb448854.aspx)

```
 public static string TextFromWord(SPFile file)
    {
        const string wordmlNamespace = "http://schemas.openxmlformats.org/wordprocessingml/2006/main";

        StringBuilder textBuilder = new StringBuilder();
        using (WordprocessingDocument wdDoc = WordprocessingDocument.Open(file.OpenBinaryStream(), false))
        {
            // Manage namespaces to perform XPath queries.  
            NameTable nt = new NameTable();
            XmlNamespaceManager nsManager = new XmlNamespaceManager(nt);
            nsManager.AddNamespace("w", wordmlNamespace);

            // Get the document part from the package.  
            // Load the XML in the document part into an XmlDocument instance.  
            XmlDocument xdoc = new XmlDocument(nt);
            xdoc.Load(wdDoc.MainDocumentPart.GetStream());

            XmlNodeList paragraphNodes = xdoc.SelectNodes("//w:p", nsManager);
            foreach (XmlNode paragraphNode in paragraphNodes)
            {
                XmlNodeList textNodes = paragraphNode.SelectNodes(".//w:t", nsManager);
                foreach (System.Xml.XmlNode textNode in textNodes)
                {
                    textBuilder.Append(textNode.InnerText);
                }
                textBuilder.Append(Environment.NewLine);
            }

        }
        return textBuilder.ToString();
    } 
```

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2009-06-18T08:28:28.693

使用 PInvokes，您可以使用[IFilter](http://msdn.microsoft.com/en-us/library/ms691105(VS.85).aspx)接口（在 Windows 上）。许多常见文件类型的 IFilter 随 Windows 一起安装（您可以使用[此](http://www.citeknet.com/Products/IFilters/IFilterExplorer/tabid/62/Default.aspx)工具浏览它们。您只需要求 IFilter 将文件中的文本返回给您。有几组示例代码（[这里](http://www.codeproject.com/KB/cs/IFilter.aspx)是一个这样的示例）。

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2015-11-23T02:05:57.457

Tika 非常有用且易于从不同类型的文档中提取文本，包括 Microsoft Office 文件。

您可以使用这个项目，这是 Kevin Miller 制作的精美艺术品 [http://kevm.github.io/tikaondotnet/](http://kevm.github.io/tikaondotnet/)

只需简单地添加这个 NuGet 包 [https://www.nuget.org/packages/TikaOnDotNet/](https://www.nuget.org/packages/TikaOnDotNet/)

然后，这一行代码将发挥作用：

```
var text = new TikaOnDotNet.TextExtractor().Extract("fileName.docx  / pdf  / .... ").Text; 
```

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2014-07-02T16:04:02.520

让我稍微纠正一下 KyleM 给出的答案。我刚刚添加了两个额外节点的处理，这会影响结果：一个负责“\t”的水平制表，另一个负责“\v”的垂直制表。这是代码：

```
 public static string ReadAllTextFromDocx(FileInfo fileInfo)
    {
        StringBuilder stringBuilder;
        using(WordprocessingDocument wordprocessingDocument = WordprocessingDocument.Open(dataSourceFileInfo.FullName, false))
        {
            NameTable nameTable = new NameTable();
            XmlNamespaceManager xmlNamespaceManager = new XmlNamespaceManager(nameTable);
            xmlNamespaceManager.AddNamespace("w", "http://schemas.openxmlformats.org/wordprocessingml/2006/main");

            string wordprocessingDocumentText;
            using(StreamReader streamReader = new StreamReader(wordprocessingDocument.MainDocumentPart.GetStream()))
            {
                wordprocessingDocumentText = streamReader.ReadToEnd();
            }

            stringBuilder = new StringBuilder(wordprocessingDocumentText.Length);

            XmlDocument xmlDocument = new XmlDocument(nameTable);
            xmlDocument.LoadXml(wordprocessingDocumentText);

            XmlNodeList paragraphNodes = xmlDocument.SelectNodes("//w:p", xmlNamespaceManager);
            foreach(XmlNode paragraphNode in paragraphNodes)
            {
                XmlNodeList textNodes = paragraphNode.SelectNodes(".//w:t | .//w:tab | .//w:br", xmlNamespaceManager);
                foreach(XmlNode textNode in textNodes)
                {
                    switch(textNode.Name)
                    {
                        case "w:t":
                            stringBuilder.Append(textNode.InnerText);
                            break;

                        case "w:tab":
                            stringBuilder.Append("\t");
                            break;

                        case "w:br":
                            stringBuilder.Append("\v");
                            break;
                    }
                }

                stringBuilder.Append(Environment.NewLine);
            }
        }

        return stringBuilder.ToString();
    } 
```

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2016-10-19T02:57:24.877

使用 Microsoft Office 互操作。它免费且流畅。这是我如何从文档中提取所有单词的方法。

```
 using Microsoft.Office.Interop.Word;

   //Create Doc
    string docPath = @"C:\docLocation.doc";
    Application app = new Application();
    Document doc = app.Documents.Open(docPath);

    //Get all words
    string allWords = doc.Content.Text;
    doc.Close();
    app.Quit(); 
```

然后用文字做任何你想做的事。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2016-09-15T16:40:56.507

派对有点晚了，但是 - 现在你不需要下载任何东西 - 所有东西都已经安装了 .NET ：（只需确保添加对 System.IO.Compression 和 System.IO.Compression.FileSystem 的引用）

```
using System;
using System.Linq;
using System.Xml.Linq;
using System.Xml.XPath;
using System.Xml;
using System.Text;
using System.IO.Compression;

public static class DocxTextExtractor
{
    public static string Extract(string filename)
    {
        XmlNamespaceManager NsMgr = new XmlNamespaceManager(new NameTable());
        NsMgr.AddNamespace("w", "http://schemas.openxmlformats.org/wordprocessingml/2006/main");

        using (var archive = ZipFile.OpenRead(filename))
        {
            return XDocument
                .Load(archive.GetEntry(@"word/document.xml").Open())
                .XPathSelectElements("//w:p", NsMgr)
                .Aggregate(new StringBuilder(), (sb, p) => p
                    .XPathSelectElements(".//w:t|.//w:tab|.//w:br", NsMgr)
                    .Select(e => { switch (e.Name.LocalName) { case "br": return "\v"; case "tab": return "\t"; } return e.Value; })
                    .Aggregate(sb, (sb1, v) => sb1.Append(v)))
                .ToString();
        }
    }
} 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-06-18T07:38:03.740

简单的！

这两个步骤将使您到达那里：

1) 使用[Office Interop 库](http://msdn.microsoft.com/en-us/library/bb412305.aspx)将 DOC 转换为 DOCX
2) 使用[DOCX2TXT](http://docx2txt.sourceforge.net/)从新的 DOCX 中提取文本

1) 的链接很好地解释了如何进行转换，甚至还有代码示例。

2) 的替代方法是在 C# 中解压缩 DOCX 文件并扫描您需要的文件。[您可以在此处](http://en.wikipedia.org/wiki/Open_Packaging_Convention)阅读有关 ZIP 文件结构的信息。

**编辑：**啊，是的，我忘了指出，正如 Skurmedel 在下面所做的那样，您必须在要进行转换的系统上安装 Office。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-06-18T07:25:27.290

我曾经做过一个 docx 文本提取器，非常简单。基本上 docx 和我认为的其他（新）格式是一个带有一堆 XML 文件的 zip 文件。可以使用 XmlReader 并仅使用 .NET 类来提取文本。

我没有代码了，似乎:(，但我找到了一个有类似[解决方案](http://www.codeproject.com/KB/office/ExtractTextFromDOCXs.aspx)的人。

但是，如果您需要阅读 .doc 和 .xls 文件，这可能对您不可行，因为它们是二进制格式并且可能更难解析。

微软还发布了[OpenXML SDK](http://openxmldeveloper.org/articles/4730.aspx)，尽管它仍然在 CTP 中。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2017-06-23T16:51:14.520

如果您正在寻找 asp.net 选项，除非您在服务器上安装 office，否则互操作将无法工作。即使那样，微软也表示不要这样做。

我使用了 Spire.Doc，效果很好。 [Spire.Doc 下载](https://www.e-iceblue.com/Introduce/spire-office-for-net-free.html#.WU1GDpDyuUk) 它甚至可以读取实际上是 .txt 但保存为 .doc 的文档。他们有免费和付费版本。您还可以获得一个试用许可证，该许可证会从您创建的文档中删除一些警告，但我没有创建任何警告，只是搜索了它们，因此免费版本就像一个魅力。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2019-10-09T10:18:01.997

在 C# 中从 Office 文档中提取文本的合适选项之一是[GroupDocs.Parser for .NET](https://products.groupdocs.com/parser/net) API。以下是用于提取简单文本和格式化文本的代码示例。

*提取文本*

```
// Create an instance of Parser class
using(Parser parser = new Parser("sample.docx"))
{
    // Extract a text into the reader
    using(TextReader reader = parser.GetText())
    {
        // Print a text from the document
        // If text extraction isn't supported, a reader is null
        Console.WriteLine(reader == null ? "Text extraction isn't supported" : reader.ReadToEnd());
    }
} 
```

*提取格式化文本*

```
// Create an instance of Parser class
using (Parser parser = new Parser("sample.docx"))
{
    // Extract a formatted text into the reader
    using (TextReader reader = parser.GetFormattedText(new FormattedTextOptions(FormattedTextMode.Html)))
    {
        // Print a formatted text from the document
        // If formatted text extraction isn't supported, a reader is null
        Console.WriteLine(reader == null ? "Formatted text extraction isn't suppported" : reader.ReadToEnd());
    }
} 
```

*披露：我在 GroupDocs 担任开发人员布道师。*

# android - 如何在 android 中创建 DataGrid 显示？

> ID：1011237
> 
> 赞同：8
> 
> 时间：2009-06-18T07:21:33.837
> 
> 标签：android

海任何人请告诉我是否有可能在 android 中创建一个 DataGrid，如果是的意思是请帮助我一些代码片段，或提供一些相关的网址。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2010-10-14T09:39:33.693

图书.java

```
package com.dgrid;

public class Book {
    String title;
    String author;

    public Book(String title, String author) {
        this.title = title;
        this.author = author;
    }
    public String getTitle() {
        return title;
    }
    public void setTitle(String title) {
        this.title = title;
    }
    public String getAuthor() {
        return author;
    }
    public void setAuthor(String author) {
        this.author = author;
    }

} 
```

主要的.xml

```
<?xml version="1.0" encoding="utf-8"?>
<AbsoluteLayout xmlns:android="http://schemas.android.com/apk/res/android"
    android:orientation="vertical"
    android:layout_width="wrap_content"
    android:layout_height="fill_parent"
    >
<ListView  
    android:id="@+id/bookListView"
    android:layout_width="fill_parent" 
    android:layout_height="fill_parent"
    android:divider="#ffffff" 
    />
</AbsoluteLayout> 
```

行.xml

```
<?xml version="1.0" encoding="utf-8"?>
<LinearLayout
android:id="@+id/widget0"
android:orientation="horizontal"
android:layout_toRightOf="@android:id/icon"
android:layout_width="fill_parent"
android:layout_height="fill_parent"
android:background="#ffffff"
xmlns:android="http://schemas.android.com/apk/res/android"
>
<com.dgrid.ListItemView
android:id="@+id/title"
android:layout_height="wrap_content"
android:layout_width="150px"
android:text="Title"
android:textSize="10sp"
android:textStyle="bold"
android:textColor="#ff000000"
/> 
```

ListItemView.java

```
package com.dgrid;

import android.content.Context;
import android.graphics.Canvas;
import android.graphics.Color;
import android.graphics.Paint;
import android.util.AttributeSet;
import android.widget.TextView;

public class ListItemView extends TextView {
    private boolean isHeader = false;
    private Paint linePaint;

    public ListItemView(Context context, AttributeSet attrs, int defStyle) {
        super(context, attrs, defStyle);
        init();
    }

    public ListItemView(Context context, AttributeSet attrs) {
        super(context, attrs);
        init();
    }

    public ListItemView(Context context) {
        super(context);
        init();
    }

    public void init(){
        linePaint = new Paint(Paint.ANTI_ALIAS_FLAG);
        linePaint.setColor(Color.parseColor("#000000"));
    }
    public boolean isHeader() {
        return isHeader;
    }

    public void setHeader(boolean isHeader) {
        this.isHeader = isHeader;
    }

    @Override
    protected void onDraw(Canvas canvas) {
        super.onDraw(canvas);
        if(isHeader){
            canvas.drawColor(Color.parseColor("#AAFFFF99"));
        }
        canvas.drawLine(0, 0, getMeasuredWidth(), 0,linePaint);
        canvas.drawLine(0, getMeasuredHeight(), getMeasuredWidth(), getMeasuredHeight(),linePaint);
        canvas.drawLine(0,0, 0, getMeasuredHeight(),linePaint);
    }
} 
```

数据gridActivity.java

```
package com.dgrid;

import android.app.Activity;
import android.content.Context;
import android.os.Bundle;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.ArrayAdapter;
import android.widget.ListView;

public class DatagridActivity extends Activity {
    Context mContext;
    Book[] books = {new Book("Title","Author"),new Book("Clean Code","Uncle Bob"),new Book("Face 2.0","Allen Cooper")};
    @Override
    public void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        mContext = this;
        setContentView(R.layout.main);
        ListView bookListView =(ListView)findViewById(R.id.bookListView);
        LitemItemAdapter mcqListAdapter = new LitemItemAdapter(this,R.layout.row,books);
        bookListView.setAdapter(mcqListAdapter);
    }
    class LitemItemAdapter extends ArrayAdapter<Book>{

        public LitemItemAdapter(Context context, int textViewResourceId,
                Book[] objects) {
            super(context, textViewResourceId, objects);
        }
        public View getView(int position, View convertView, ViewGroup parent) {
            View v = convertView;
            if (v == null) {

                LayoutInflater vi = (LayoutInflater) mContext.getSystemService(Context.LAYOUT_INFLATER_SERVICE);
                v = vi.inflate(R.layout.row, null);
            }
            Book item = books[position];
            if (item != null) {
                    ListItemView titleView = (ListItemView) v.findViewById(R.id.title);
                    ListItemView authorView = (ListItemView) v.findViewById(R.id.author);
                    if(position == 0){
                        titleView.setHeader(true);
                        authorView.setHeader(true);
                    }
                    if(titleView != null){
                        titleView.setText(item.getTitle());
                    }
                    if(authorView != null){
                        authorView.setText(item.getAuthor());
                    }
            }
            return v;
        }       

    }
} 
```

# sqlite - 使用 SQLite 提供可靠的用户反馈

> ID：1011242
> 
> 赞同：0
> 
> 时间：2009-06-18T07:22:25.097
> 
> 标签：sqlite, reliability, user-feedback

我正在编写一个带有 GUI 前端 (GTK) 和 SQLite 后端的应用程序。当通过 GUI 更改某些内容时，当且仅当它在数据库中成功完成时，我希望更改显示在 GUI 中。

*   是否`sqlite3_step`足以`SQLITE_ERROR`确保我不会向用户提供错误反馈？

*   如果没有，是否有其他步骤（例如回调或触发器）可以提供额外的可靠性？

*   有什么方法可以检测到对数据库的所有更改，而不仅仅是来自程序自身连接的更改，以便我可以动态地在 GUI 中反映对其内容的更改？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-18T07:42:40.877

如果我理解正确，您正在做一个 GUI 应用程序来修改 SQLite 数据库中的信息。

*   不是真的，`SQLITE_BUSY`如果你有线程，你可能会得到；`SQLITE_INTERNAL`; 等检查[SQLite 文档](http://www.sqlite.org/c3ref/c_abort.html)。而不是要求`SQLITE_ERROR`你可以做类似的事情：

`SQLITE_OK`或者`SQLITE_DONE`取决于你在做什么。

```
if (ret != SQLITE_OK || ret != SQLITE_DONE)
    //then this is an error. 
```

*   不知道你用什么语言编码，但我在[这里](http://code.google.com/p/database-adt/)用 C 语言做了一个 SQLite 的抽象。你可能会觉得很有趣。

*   使用[sqlite3_trace()](http://www.sqlite.org/c3ref/profile.html)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-18T07:51:02.090

除了异常处理...您应该通过单击保存按钮从用户提交的数据库中重新选择数据。这样您就可以确定用户看到了正确的数据。

# powershell - 在哪里放置 PowerShell 脚本？

> ID：1011243
> 
> 赞同：65
> 
> 时间：2009-06-18T07:22:35.783
> 
> 标签：powershell

（我不敢相信我真的在问这个问题，但我今天没有脑力。）

我刚刚编写了我的第一个严肃的 PowerShell 脚本，我对此非常满意。我计划每天左右使用它。我希望能够从 Posh 命令行调用它。我会给它一个动词-名词类型名称，但现在它是一个简单的 .ps1，而不是那些需要参数等的花哨的高级函数之一。

那么它应该去哪里以及如何从 Posh 命令行调用它？我打算写更多！他们应该去哪里？

*   它应该是我个人资料中的一个功能吗？
*   它应该走上我的路吗？
*   它是否进入 PSMODULEPATH？到底什么样的东西去那里？它看起来是递归的还是就像正常的 PATH 一样？

你们都将 PowerShell 脚本放在哪里以及如何组织它们？我有很多制作 C# 和 C++ 工具的经验，并且知道如何命名它们以及将它们放在哪里。在另一个极端，我做了很多糟糕的 .bat 文件，这些文件通常是独立的，或者堆积在某个文件夹中。但 PowerShell 似乎非常不同。您可以非常快速地在其中制作蹩脚的 .bat 文件类型的东西，或者您可以使用它构建库和复杂的服务。

我真的很喜欢在开始之前我应该​​如何开始组织这些事情的一些想法。显然每个人都是不同的，所以我希望有一些讨论。谢谢！

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2009-06-19T14:58:10.800

我将我的个人脚本与我的个人资料放在同一个文件夹中。然后我可以一起备份和版本化它们。我的个人资料开头是：

```
$ProfileRoot = (Split-Path -Parent $MyInvocation.MyCommand.Path)
$env:path += ";$ProfileRoot" 
```

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-06-18T08:06:43.573

我的建议： - 将脚本存储在您希望的目录中，例如 c:\posh - 将目录添加到 $env:path

```
$env:path += ";c:\posh" 
```

这确保您可能在其他目录中，例如 c:\windows，但您可以调用脚本

```
[c:\windows] > sampl[TAB] # it expands the name of file to sample.ps1, then hit enter 
```

如果您的文件 sample.ps1 包含函数定义并且您每次都将其导入，那么我会考虑将此行添加到您的 $profile 文件中

```
. c:\posh\sample.ps1 
```

关于脚本组织.. 根据脚本的目的只有几个目录 :) 个人，开发，外部（下载），示例，...

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2009-06-20T16:09:07.927

使用 V2，您可以在配置文件所在的 WindowsPowerShell 目录中创建模块目录。当您运行 import-module 时，PS 会自动在该目录中查找以加载模块。我还在 WindowsPowerShell 下创建了一个“脚本”目录，它是模块的同级目录。

我使用我的配置文件通过以下代码使用变量设置一些目录：

```
PS>  cat $Profile
$scripts = "$(split-path $profile)\Scripts"
$modules = "$(split-path $profile)\Modules"
$docs    =  $(resolve-path "$Env:userprofile\documents")
$desktop =  $(resolve-path "$Env:userprofile\desktop")

PS> cat variable:\scripts
C:\Users\andy.schneider\Documents\WindowsPowerShell\Scripts

PS>  cat variable:\modules
C:\Users\andy.schneider\Documents\WindowsPowerShell\Modules 
```

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2009-10-01T02:26:20.203

这就是我所做的：

注意：用“ModuleName”代替有意义的东西。

创建一个模块并将其保存在全局模块文件夹中，名称为“C:\Windows\System32\WindowsPowerShell\v1.0\Modules\ModuleName\ModuleName.psm1”。例如：

```
function global:FancyFunction() {
   # do something interesting here.
}

Export-ModuleMember -function FancyFunction 
```

打开您的 powershell 配置文件并添加以下行以确保每次启动 powershell 会话时都加载您的模块：

```
Import-Module ModuleName -Force 
```

您可以通过键入以下内容轻松找到您的 powershell 配置文件：

```
notepad $profile 
```

当您打开一个新的 powershell 会话时，您应该能够从控制台或其他脚本调用您的函数，而无需执行任何其他操作。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2021-05-17T20:48:39.027

powershell 7.1 中使用的 PowerShellGet 模块中有一个导出的变量

```
$PSGetPath 
```

它有 4 个属性

```
AllUsersModules    : C:\Program Files\PowerShell\Modules
AllUsersScripts    : C:\Program Files\PowerShell\Scripts
CurrentUserModules : C:\Users\username\Documents\PowerShell\Modules
CurrentUserScripts : C:\Users\username\Documents\PowerShell\Scripts 
```

您可以使用这些脚本位置之一。`Install-Script`也在使用它们。

# svn - 在 SVN 工作副本中取消删除

> ID：1011244
> 
> 赞同：5
> 
> 时间：2009-06-18T07:23:10.180
> 
> 标签：svn

刚刚打电话：

```
svn rm someDirectory 
```

但*没有提交*，如何取消删除目录？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-06-18T07:25:34.700

```
svn revert --recursive <folder_name> 
```

将从 folder_name 向下递归地退出任何更改

# c# - 如何使用 .NET Framework 通过 SSL SMTP 发送电子邮件？

> ID：1011245
> 
> 赞同：46
> 
> 时间：2009-06-18T07:24:42.237
> 
> 标签：c#, .net, email, ssl, smtp

.NET Framework 有没有办法通过端口 465 上的 SSL SMTP 服务器发送电子邮件？

通常的方式：

```
System.Net.Mail.SmtpClient _SmtpServer = new System.Net.Mail.SmtpClient("tempurl.org");
_SmtpServer.Port = 465;
_SmtpServer.EnableSsl = true;
_SmtpServer.Credentials = new System.Net.NetworkCredential("username", "password");
_SmtpServer.Timeout = 5000;
_SmtpServer.UseDefaultCredentials = false;

MailMessage mail = new MailMessage();
mail.From = new MailAddress(from);
mail.To.Add(to);
mail.CC.Add(cc);
mail.Subject = subject;
mail.Body = content;
mail.IsBodyHtml = useHtml;
_SmtpServer.Send(mail); 
```

超时：

```
System.Net Verbose: 0 : [1024] SmtpClient::.ctor(host=ssl0.ovh.net, port=465)
System.Net Information: 0 : [1024] Associating SmtpClient#64923656 with SmtpTransport#44624228
System.Net Verbose: 0 : [1024] Exiting SmtpClient::.ctor()  -> SmtpClient#64923656
System.Net Information: 0 : [1024] Associating MailMessage#17654054 with Message#52727599
System.Net Verbose: 0 : [1024] SmtpClient#64923656::Send(MailMessage#17654054)
System.Net Information: 0 : [1024] SmtpClient#64923656::Send(DeliveryMethod=Network)
System.Net Information: 0 : [1024] Associating SmtpClient#64923656 with MailMessage#17654054
System.Net Information: 0 : [1024] Associating SmtpTransport#44624228 with SmtpConnection#14347911
System.Net Information: 0 : [1024] Associating SmtpConnection#14347911 with ServicePoint#51393439
System.Net.Sockets Verbose: 0 : [1024] Socket#26756241::Socket(InterNetwork#2)
System.Net.Sockets Verbose: 0 : [1024] Exiting Socket#26756241::Socket() 
System.Net.Sockets Verbose: 0 : [1024] Socket#23264094::Socket(InterNetworkV6#23)
System.Net.Sockets Verbose: 0 : [1024] Exiting Socket#23264094::Socket() 
System.Net.Sockets Verbose: 0 : [1024] Socket#26756241::Connect(20:465#337754884)
System.Net.Sockets Verbose: 0 : [1024] Exiting Socket#26756241::Connect() 
System.Net.Sockets Verbose: 0 : [1024] Socket#23264094::Close()
System.Net.Sockets Verbose: 0 : [1024] Socket#23264094::Dispose()
System.Net.Sockets Verbose: 0 : [1024] Exiting Socket#23264094::Close() 
System.Net Information: 0 : [1024] Associating SmtpConnection#14347911 with SmtpPooledStream#14303791
System.Net.Sockets Verbose: 0 : [1024] Socket#26756241::Receive()
System.Net.Sockets Verbose: 0 : [2404] Socket#26756241::Dispose()
System.Net.Sockets Error: 0 : [1024] Exception in the Socket#26756241::Receive - A blocking operation was interrupted by a call to WSACancelBlockingCall
System.Net.Sockets Verbose: 0 : [1024] Exiting Socket#26756241::Receive()   -> 0#0
System.Net Error: 0 : [1024] Exception in the SmtpClient#64923656::Send - Unable to read data from the transport connection: A blocking operation was interrupted by a call to WSACancelBlockingCall.
System.Net Error: 0 : [1024]    at System.Net.Sockets.NetworkStream.Read(Byte[] buffer, Int32 offset, Int32 size)
   at System.Net.DelegatedStream.Read(Byte[] buffer, Int32 offset, Int32 count)
   at System.Net.BufferedReadStream.Read(Byte[] buffer, Int32 offset, Int32 count)
   at System.Net.Mail.SmtpReplyReaderFactory.ReadLines(SmtpReplyReader caller, Boolean oneLine)
   at System.Net.Mail.SmtpReplyReaderFactory.ReadLine(SmtpReplyReader caller)
   at System.Net.Mail.SmtpConnection.GetConnection(String host, Int32 port)
   at System.Net.Mail.SmtpTransport.GetConnection(String host, Int32 port)
   at System.Net.Mail.SmtpClient.GetConnection()
   at System.Net.Mail.SmtpClient.Send(MailMessage message)
System.Net Verbose: 0 : [1024] Exiting SmtpClient#64923656::Send() 
System.Net Information: 0 : [1024] Associating MailMessage#49584532 with Message#19699911 
```

我四处搜索，发现 System.Net.Mail 支持端口 587 上的连接（显式 SSL 的默认端口开始未加密然后发出 STARTDLS 然后切换到加密连接：RFC 2228），但不支持隐式 SSL（整个连接包裹在 SSL 层中）...

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2009-06-18T20:01:34.653

这是一个如何通过同样使用 SSL/465 的 GMail 发送电子邮件的示例。对下面的代码进行微调应该可以工作！

```
using System.Web.Mail;
using System;
public class MailSender
{
    public static bool SendEmail(
        string pGmailEmail, 
        string pGmailPassword, 
        string pTo, 
        string pSubject,
        string pBody, 
        System.Web.Mail.MailFormat pFormat,
        string pAttachmentPath)
    {
    try
    {
        System.Web.Mail.MailMessage myMail = new System.Web.Mail.MailMessage();
        myMail.Fields.Add
            ("http://schemas.microsoft.com/cdo/configuration/smtpserver",
                          "smtp.gmail.com");
        myMail.Fields.Add
            ("http://schemas.microsoft.com/cdo/configuration/smtpserverport",
                          "465");
        myMail.Fields.Add
            ("http://schemas.microsoft.com/cdo/configuration/sendusing",
                          "2");
        //sendusing: cdoSendUsingPort, value 2, for sending the message using 
        //the network.

        //smtpauthenticate: Specifies the mechanism used when authenticating 
        //to an SMTP 
        //service over the network. Possible values are:
        //- cdoAnonymous, value 0\. Do not authenticate.
        //- cdoBasic, value 1\. Use basic clear-text authentication. 
        //When using this option you have to provide the user name and password 
        //through the sendusername and sendpassword fields.
        //- cdoNTLM, value 2\. The current process security context is used to 
        // authenticate with the service.
        myMail.Fields.Add
        ("http://schemas.microsoft.com/cdo/configuration/smtpauthenticate","1");
        //Use 0 for anonymous
        myMail.Fields.Add
        ("http://schemas.microsoft.com/cdo/configuration/sendusername",
            pGmailEmail);
        myMail.Fields.Add
        ("http://schemas.microsoft.com/cdo/configuration/sendpassword",
             pGmailPassword);
        myMail.Fields.Add
        ("http://schemas.microsoft.com/cdo/configuration/smtpusessl",
             "true");
        myMail.From = pGmailEmail;
        myMail.To = pTo;
        myMail.Subject = pSubject;
        myMail.BodyFormat = pFormat;
        myMail.Body = pBody;
        if (pAttachmentPath.Trim() != "")
        {
            MailAttachment MyAttachment = 
                    new MailAttachment(pAttachmentPath);
            myMail.Attachments.Add(MyAttachment);
            myMail.Priority = System.Web.Mail.MailPriority.High;
        }

        System.Web.Mail.SmtpMail.SmtpServer = "smtp.gmail.com:465";
        System.Web.Mail.SmtpMail.Send(myMail);
        return true;
    }
    catch (Exception ex)
    {
        throw;
    }
}
} 
```

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2015-04-10T00:48:42.207

我参加这个聚会迟到了，但我会为任何可能对替代方案感兴趣的路人提供我的方法。

如前面的答案所述，`System.Net.Mail` `SmtpClient`该类不支持*Implicit SSL*。它确实支持*显式 SSL*，这需要通过端口 25 与 SMTP 服务器建立不安全的连接，以便协商传输级别安全性 (TLS)。[我在这里](http://blog.ramsoftsolutions.com/2015/04/sending-mail-via-smtp-over-implicit-ssl.html)用这种微妙的方式记录了我的艰辛。

简而言之，通过隐式 SSL 端口 465 的 SMTP 需要在连接到 SMTP 服务器*之前协商 TLS。*我没有编写 .Net SMTPS 实现，而是转向了一个名为[Stunnel](https://www.stunnel.org/index.html)的实用程序。这是一项小型服务，可让您通过 SSL 将本地端口上的流量重定向到远程端口。

> 免责声明：Stunnel 使用 OpenSSL 库的部分内容，该库最近在所有主要科技新闻媒体上发布了一个备受瞩目的漏洞利用。我相信最新版本使用修补过的 OpenSSL，但请自担风险使用。

安装实用程序后，在配置文件中添加一小部分内容：

```
; Example SSL client mode services
[my-smtps]
client = yes
accept = 127.0.0.1:465
connect = mymailserver.com:465 
```

...指示 Stunnel 服务将本地请求重新路由到端口 465 到我在端口 465 上的邮件服务器。这发生在 TLS 上，它满足另一端的 SMTP 服务器。

使用此实用程序，以下代码将成功通过端口 465 传输：

```
using System;
using System.Net;
using System.Net.Mail;

namespace RSS.SmtpTest
{
    class Program
    {
        static void Main( string[] args )
        {
            try {
                using( SmtpClient smtpClient = new SmtpClient( "localhost", 465 ) ) { // <-- note the use of localhost
                    NetworkCredential creds = new NetworkCredential( "username", "password" );
                    smtpClient.Credentials = creds;
                    MailMessage msg = new MailMessage( "joe@schmoe.com", "jane@schmoe.com", "Test", "This is a test" );
                    smtpClient.Send( msg );
                }
            }
            catch( Exception ex ) {
                Console.WriteLine( ex.Message );
            }
        }
    }
} 
```

所以这里的优点是您可以使用隐式 SSL 和端口 465 作为安全协议，同时仍然使用框架中内置的发送邮件方法。缺点是它需要使用第三方服务，除了这个特定的功能之外，它可能对任何东西都没有用。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2009-06-18T07:45:59.153

它适用于 System.Web.Mail（标记为过时）：

```
private const string SMTP_SERVER        = "http://schemas.microsoft.com/cdo/configuration/smtpserver";
private const string SMTP_SERVER_PORT   = "http://schemas.microsoft.com/cdo/configuration/smtpserverport";
private const string SEND_USING         = "http://schemas.microsoft.com/cdo/configuration/sendusing";
private const string SMTP_USE_SSL       = "http://schemas.microsoft.com/cdo/configuration/smtpusessl";
private const string SMTP_AUTHENTICATE  = "http://schemas.microsoft.com/cdo/configuration/smtpauthenticate";
private const string SEND_USERNAME      = "http://schemas.microsoft.com/cdo/configuration/sendusername";
private const string SEND_PASSWORD      = "http://schemas.microsoft.com/cdo/configuration/sendpassword";

System.Web.Mail.MailMessage mail = new System.Web.Mail.MailMessage();

mail.Fields[SMTP_SERVER] = "tempurl.org";
mail.Fields[SMTP_SERVER_PORT] = 465;
mail.Fields[SEND_USING] = 2;
mail.Fields[SMTP_USE_SSL] = true;
mail.Fields[SMTP_AUTHENTICATE] = 1;
mail.Fields[SEND_USERNAME] = "username";
mail.Fields[SEND_PASSWORD] = "password";

System.Web.Mail.SmtpMail.Send(mail); 
```

您对过时的命名空间使用有何看法？

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2016-09-09T15:11:30.180

在 VB.NET 中尝试连接到 465 上的 Rackspace 的 SSL 端口时，我遇到了同样的问题（需要隐式 SSL）。为了成功连接，我使用了[https://www.nuget.org/packages/MailKit/ 。](https://www.nuget.org/packages/MailKit/)

以下是 HTML 电子邮件的示例。

```
Imports MailKit.Net.Smtp
Imports MailKit
Imports MimeKit

Sub somesub()
    Dim builder As New BodyBuilder()
    Dim mail As MimeMessage
    mail = New MimeMessage()
    mail.From.Add(New MailboxAddress("", c_MailUser))
    mail.To.Add(New MailboxAddress("", c_ToUser))
    mail.Subject = "Mail Subject"
    builder.HtmlBody = "<html><body>Body Text"
    builder.HtmlBody += "</body></html>"
      mail.Body = builder.ToMessageBody()

      Using client As New SmtpClient
        client.Connect(c_MailServer, 465, True)
        client.AuthenticationMechanisms.Remove("XOAUTH2") ' Do not use OAUTH2
        client.Authenticate(c_MailUser, c_MailPassword) ' Use a username / password to authenticate.
        client.Send(mail)
        client.Disconnect(True)
    End Using 

End Sub 
```

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2015-01-19T02:49:08.327

尝试检查这个免费的开源替代方案 [https://www.nuget.org/packages/AIM](https://www.nuget.org/packages/AIM) 它是免费使用和开源的，并且使用与 System.Net.Mail 使用的完全相同的方式将电子邮件发送到隐式 ssl您可以使用以下代码的端口

```
public static void SendMail()
{    
    var mailMessage = new MimeMailMessage();
    mailMessage.Subject = "test mail";
    mailMessage.Body = "hi dude!";
    mailMessage.Sender = new MimeMailAddress("you@gmail.com", "your name");
    mailMessage.To.Add(new MimeMailAddress("yourfriend@gmail.com", "your friendd's name")); 
// You can add CC and BCC list using the same way
    mailMessage.Attachments.Add(new MimeAttachment("your file address"));

//Mail Sender (Smtp Client)

    var emailer = new SmtpSocketClient();
    emailer.Host = "your mail server address";
    emailer.Port = 465;
    emailer.SslType = SslMode.Ssl;
    emailer.User = "mail sever user name";
    emailer.Password = "mail sever password" ;
    emailer.AuthenticationMode = AuthenticationType.Base64;
    // The authentication types depends on your server, it can be plain, base 64 or none. 
//if you do not need user name and password means you are using default credentials 
// In this case, your authentication type is none            
    emailer.MailMessage = mailMessage;
    emailer.OnMailSent += new SendCompletedEventHandler(OnMailSent);
    emailer.SendMessageAsync();
}

// A simple call back function:
private void OnMailSent(object sender, AsyncCompletedEventArgs asynccompletedeventargs)
{
if (e.UserState!=null)
    Console.Out.WriteLine(e.UserState.ToString());
if (e.Error != null)
{
    MessageBox.Show(e.Error.Message, "Error", MessageBoxButtons.OK, MessageBoxIcon.Error);
}
else if (!e.Cancelled)
{
    MessageBox.Show("Send successfull!", "Information", MessageBoxButtons.OK, MessageBoxIcon.Information);
}
} 
```

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2017-09-13T17:02:45.730

我知道我加入讨论很晚，但我认为这对其他人有用。

我想避免弃用的东西，经过大量的摆弄后，我找到了一种简单的方法来发送到需要隐式 SSL 的服务器：使用 NuGet 并将[MailKit 包](https://github.com/jstedfast/MailKit)添加到项目中。（我使用了针对 .NET 4.6.2 的 VS2017，但它应该适用于较低的 .NET 版本......）

然后你只需要做这样的事情：

```
using MailKit.Net.Smtp;
using MimeKit;

var client = new SmtpClient();
client.Connect("server.name", 465, true);

// Note: since we don't have an OAuth2 token, disable the XOAUTH2 authentication mechanism.
client.AuthenticationMechanisms.Remove ("XOAUTH2");

if (needsUserAndPwd)
{
    // Note: only needed if the SMTP server requires authentication
    client.Authenticate (user, pwd);
}

var msg = new MimeMessage();
msg.From.Add(new MailboxAddress("sender@ema.il"));
msg.To  .Add(new MailboxAddress("target@ema.il"));
msg.Subject = "This is a test subject";

msg.Body = new TextPart("plain") {
    Text = "This is a sample message body"
};

client.Send(msg);
client.Disconnect(true); 
```

当然，您也可以调整它以使用显式 SSL 或根本不使用传输安全性。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2009-06-18T20:28:21.900

如果它是隐式 SSL，它看起来无法使用 System.Net.Mail 完成，并且目前尚不支持。

[http://blogs.msdn.com/webdav_101/archive/2008/06/02/system-net-mail-with-ssl-to-authenticate-against-port-465.aspx](http://blogs.msdn.com/webdav_101/archive/2008/06/02/system-net-mail-with-ssl-to-authenticate-against-port-465.aspx)

要检查它是否是隐式 SSL 试试[这个。](https://stackoverflow.com/questions/172811/is-there-a-way-i-can-tell-whether-an-smtp-server-is-expecting-a-client-to-connect/172860#172860)

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2010-10-03T14:02:47.747

您也可以通过端口 465 进行连接，但由于 System.Net.Mail 命名空间的一些限制，您可能必须更改您的代码。这是因为命名空间不提供建立隐式 SSL 连接的能力。这在[http://blogs.msdn.com/b/webdav_101/archive/2008/06/02/system-net-mail-with-ssl-to-authenticate-against-port-465.aspx](http://blogs.msdn.com/b/webdav_101/archive/2008/06/02/system-net-mail-with-ssl-to-authenticate-against-port-465.aspx)进行了讨论。

无需使用现已过时的 System.Web.Mail 命名空间即可建立隐式连接，但您必须访问 Microsoft CDO（协作数据对象）。我在另一个讨论中提供了一个如何使用 CDO 的示例（[GMail SMTP via C# .Net errors on all ports](https://stackoverflow.com/questions/1082216/gmail-smtp-via-c-net-errors-on-all-ports/3845907#3845907)）。

希望这可以帮助！

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2018-01-18T13:38:15.207

如评论中所述

[http://blogs.msdn.com/webdav_101/archive/2008/06/02/system-net-mail-with-ssl-to-authenticate-against-port-465.aspx](http://blogs.msdn.com/webdav_101/archive/2008/06/02/system-net-mail-with-ssl-to-authenticate-against-port-465.aspx)

使用 System.Net.Mail，使用端口 25 而不是 465：

> 您必须设置 SSL=true 和 Port=25。服务器从不受保护的 25 响应您的请求，然后抛出与受保护的 465 的连接。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2014-05-15T13:47:36.600

如果对此代码有任何疑问，请提出您的问题（这里的 gmail 端口号是 587）

```
// code to Send Mail 
// Add following Lines in your web.config file 
//               <system.net>
//                  <mailSettings>
//                    <smtp>
//                        <network host="smtp.gmail.com" port="587" userName="xxx@gmail.com" password="yyy"   defaultCredentials="false"/>
//                    </smtp>
//               </mailSettings>
//               </system.net>
// Add below lines in your config file inside appsetting tag <appsetting></appsetting>
//          <add key="emailFromAddress" value="xxxx@gmail.com"/>
//       <add key="emailToAddress" value="xxxxxxx@gmail.com"/>
//        <add key="EmailSsl" value="true"/>

// Namespace Used

using System.Net.Mail;
     public static bool SendingMail(string subject, string content)
    {
       // getting the values from config file through c#
        string fromEmail = ConfigurationSettings.AppSettings["emailFromAddress"];
        string mailid = ConfigurationSettings.AppSettings["emailToAddress"];
        bool useSSL;
        if (ConfigurationSettings.AppSettings["EmailSsl"] == "true")
        {
            useSSL = true;
        }
        else
        {
            useSSL = false;
        }

        SmtpClient emailClient;
        MailMessage message;
        message = new MailMessage();
        message.From = new MailAddress(fromEmail);
        message.ReplyTo = new MailAddress(fromEmail);
        if (SetMailAddressCollection(message.To, mailid))
        {
            message.Subject = subject;
            message.Body = content;
            message.IsBodyHtml = true;
            emailClient = new SmtpClient();
            emailClient.EnableSsl = useSSL;
            emailClient.Send(message);
        }
        return true;
    }
    // if you are sending mail in group

    private static bool SetMailAddressCollection(MailAddressCollection toAddresses, string    mailId)
    {
        bool successfulAddressCreation = true;
        toAddresses.Add(new MailAddress(mailId));
        return successfulAddressCreation;
    } 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2016-06-10T14:02:40.520

对于 gmail，这些设置对我有用，ServicePointManager.SecurityProtocol 行是必要的。因为我设置了两步验证，所以我需要从[谷歌应用密码生成器](https://security.google.com/settings/security/apppasswords)获取应用密码。

```
SmtpClient mailer = new SmtpClient();
mailer.Host = "smtp.gmail.com";
mailer.Port = 587;
mailer.EnableSsl = true;
ServicePointManager.SecurityProtocol = SecurityProtocolType.Tls; 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2020-08-25T15:39:04.993

为了扩展[Idriss](https://stackoverflow.com/users/86324/idriss)的答案，这是我的静态方法，它像冠军一样工作：

```
using System.Web.Mail;

public static void SendEmail(String Subject, String sMessage, String EmailAddress, String STMPServer, int SMTPPort, String UserName = "", String Password = null, Boolean IsSecure = true, Boolean IsHTML = true, String FromAddress = "no-reply@contoso.com") {
    string SMTP_SERVER = "http://schemas.microsoft.com/cdo/configuration/smtpserver";
    string SMTP_SERVER_PORT = "http://schemas.microsoft.com/cdo/configuration/smtpserverport";
    string SEND_USING = "http://schemas.microsoft.com/cdo/configuration/sendusing";
    string SMTP_USE_SSL = "http://schemas.microsoft.com/cdo/configuration/smtpusessl";
    string SMTP_AUTHENTICATE = "http://schemas.microsoft.com/cdo/configuration/smtpauthenticate";
    string SEND_USERNAME = "http://schemas.microsoft.com/cdo/configuration/sendusername";
    string SEND_PASSWORD = "http://schemas.microsoft.com/cdo/configuration/sendpassword";

    MailMessage mail = new MailMessage();

    mail.Fields[SMTP_SERVER] = STMPServer;
    mail.Fields[SMTP_SERVER_PORT] = SMTPPort;
    mail.Fields[SEND_USING] = 2;
    mail.Fields[SMTP_USE_SSL] = IsSecure;
    if(!String.IsNullOrEmpty(UserName) && !String.IsNullOrEmpty(Password))
    {
        mail.Fields[SMTP_AUTHENTICATE] = 1;
        mail.Fields[SEND_USERNAME] = UserName;
        mail.Fields[SEND_PASSWORD] = Password;
    }
    else
    {
        mail.Fields[SMTP_AUTHENTICATE] = 0;
    }
    mail.From = FromAddress;
    mail.To = EmailAddress;
    mail.Subject = Subject;

    if (IsHTML)
    {
        mail.BodyFormat = MailFormat.Html;
    }
    else
    {
        mail.BodyFormat = MailFormat.Text;
    }
    mail.Body = sMessage;

    SmtpMail.Send(mail);
} 
```

# php - htmlspecialchars 是否足以在 HTTP 响应中转义 XML 元素内容？

> ID：1011256
> 
> 赞同：2
> 
> 时间：2009-06-18T07:26:04.263
> 
> 标签：php, xml, http, utf-8

我正在返回一个 UTF-8 XML 响应，并且某些元素具有用户提供的内容，因此我必须确保它们被正确转义。是否`htmlspecialchars(..., ENT_COMPAT, 'UTF-8')`足以正确转义 XML 元素文本？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-18T07:32:16.823

我不确定我是否完全理解......你想要在 html 中的 xml 还是在 xml 中的 html？如果是后者，为什么不使用 CDATA？

例如

```
<xmlelement>
  <![CDATA[<span>John Smith</span>]]>
</xmlelement> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-18T09:07:36.913

[http://www.w3.org/TR/2008/REC-xml-20081126/](http://www.w3.org/TR/2008/REC-xml-20081126/)

2.2 人物...

```
[2] Char ::= #x9 | #xA | #xD | [#x20-#xD7FF] | [#xE000-#xFFFD] | [#x10000-#x10FFFF] /* any Unicode character, excluding the surrogate blocks, FFFE, and FFFF. */ 
```

所以这告诉你，如果没有 Tab、CR、LF，就没有办法将字符存储在 < 0x20 的低区。此外，xml 解析器必须规范化换行符。它必须将 CR LF 转换为 LF 等等。

因此，普通节点和 CDATA 部分都无法在 XML 中传输二进制字符串。如果要传输它，则必须将其转换为 base64 或传输为数字列表。

# apache-flex - 如何防止 Datagrid 重用 itemRenderers？

> ID：1011257
> 
> 赞同：0
> 
> 时间：2009-06-18T07:26:18.927
> 
> 标签：apache-flex, itemrenderer

是否可以不在数据网格中的滚动上重用 itemrenderers。相反，滚动数据网格应该创建 itemrenderers 的新实例？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-12-13T13:17:26.383

不建议这样做，但看起来您可以通过将`useVirtualLayout`参数设置为`false`：

```
<s:List>  
   <s:layout>  
      <s:VerticalLayout useVirtualLayout="false" />  
   <s:/layout>  
</s:list> 
```

注意：这是针对 Flex 4.x

# windows - 如何在 Windows Cmd Prompt 中执行 UNIX 的“diff -r”？

> ID：1011269
> 
> 赞同：27
> 
> 时间：2009-06-18T07:30:27.327
> 
> 标签：windows, cmd

如何在 Windows m/c 的 cmd 提示符下比较两个目录？我想要相当于 UNIX 的 diff -r 。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-06-18T07:33:55.183

安装[Cygwin](http://www.cygwin.com/)即可`diff -r`在 Windows 上使用。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-06-18T07:33:08.943

Windows的[comp](http://www.microsoft.com/resources/documentation/windows/xp/all/proddocs/en-us/comp.mspx?mfr=true)命令就是您要找的。

这里的例子：

要将目录 C:\Reports 的内容与备份目录 \\Sales\Backup\April 的内容进行比较，请键入：

```
comp c:\reports \\sales\backup\april 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-06-18T07:37:04.223

最简单的方法可能是为 Windows 下载 diff：http: [//gnuwin32.sourceforge.net/packages/diffutils.htm](http://gnuwin32.sourceforge.net/packages/diffutils.htm)
您还可以执行以下操作：

```
dir directory1 > dir1
dir directory2 > dir2
comp dir1 dir2 
```

此外，某些版本的 Windows 附带`windiff`，但这是一个 GUI 工具

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2012-12-04T09:45:56.200

在 Windows 中有`fc`命令。我认为`diff`更好，但是如果您只想使用安装附带的内容，那么，就可以了！:)

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2012-04-18T01:44:46.370

您可以安装 Gow，并且可以在 Windows 命令提示符中运行 diff。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-06-18T07:37:41.680

您可以使用 NT 版本及更高版本的 Windows 中包含的 windiff 实用程序。只需运行“windiff”，就会弹出一个图形工具。

文件 -> 比较目录

[http://msdn.microsoft.com/en-us/library/aa266122(VS.60).aspx](http://msdn.microsoft.com/en-us/library/aa266122(VS.60).aspx)

本文介绍如何从命令行使用它。该工具的最大好处是它已经包含在内，您无需下载和安装任何东西。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2014-12-17T11:24:38.590

# 使用 ROBOCOPY 的部分解决方案

一个部分解决方案（因此对我来说不幸的是一个“非解决方案”，尽管我最初对它寄予厚望），这对你来说可能或可能不够：

似乎[ROBOCOPY 工具可以（ab-）用作穷人的递归比较](http://improvingsoftware.com/2013/09/09/how-to-diff-two-folders-from-a-windows-command-prompt/)；不幸的是，它显然***不比较文件内容***。它似乎比较*大小、日期*和可选的*属性*。对此的神奇咒语是：

```
ROBOCOPY path1 path2 /e /l /ns /njs /njh /ndl /fp /log:result.txt /it 
```

[选项](http://technet.microsoft.com/en-us/library/cc733145.aspx) 的[含义](http://ss64.com/nt/robocopy.html)似乎是：

*   `/e`- 递归，包括空目录；
*   `/l`-**只打印日志，不修改文件；**
*   `/ns /njs /njh`- 不打印文件大小、作业摘要、作业标题；
*   `/ndl`- “不记录文件夹名称”
    *   注意：据报道，这将导致跳过丢失/多余的空目录的情况；如果你不使用这个，那些应该被记录，但你必须以某种方式通过其他方式删除非不同的目录；
*   `/log:result.txt`- 将结果写入“result.txt”文件；我认为这可以省略，然后结果将显示在标准输出上。

附加选项：

*   `/it`- 如果您也想比较属性，我认为应该添加它 - 请参阅[有关“调整”文件是什么的解释](https://superuser.com/questions/314503/what-does-robocopy-mean-by-tweaked-lonely-and-extra)。

## 警告：不比较文件内容

正如我上面所说，不幸的是，这似乎没有比较文件内容。我通过首先运行以下命令来验证这一点：

```
mkdir d1\a\b d2\a\b & echo x > d1\a\b\f & echo y > d2\a\b\f 
```

大多数情况下，这应该生成具有相同时间戳的文件 d1\a\b\f 和 d2\a\b\f，您可以使用`dir d1\a\b\f d2\a\b\f`. 对 d1 & d2的`robocopy`调用为我生成了一个空结果集。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2013-06-08T15:09:05.760

要将数据与命令提示符进行比较，您可以使用

**COMP /a /l D:\Folder1\data.txt D:\Folder2\data.txt**

可以有不同的选项，例如要搜索的特定行数和不区分大小写的搜索，甚至您可以使用命令提示符比较文件夹。以下是[使用命令提示符比较文件和文件夹](http://www.funbutlearn.com/2012/10/compare-two-filesfolders-with-command.html)的其他选项。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2017-10-26T10:11:07.120

在 Windows 10 中，您可以通过启用 Linux Bash Shell来运行`diff`命令`bash`

# php - GMail SMTP 发送邮件，接收错误（4.7.0），但邮件已发送！

> ID：1011270
> 
> 赞同：2
> 
> 时间：2009-06-18T07:30:42.350
> 
> 标签：php, smtp, gmail, phpmailer

我正在使用 GMail SMTP 服务器发送邮件。和 PHPMailer 作为邮件发送脚本。

我收到了这个错误（我记录了所有的 SMTP 错误，即每当 PHPMailer::Send 失败）：-

```
SMTP Error: Data not accepted.<p>SMTP server error: 4.7.0 Temporary System Problem.  Try again later (WS) 
```

但邮件实际上是发送的。（我通过匹配已发送邮件的时间戳和日志中的时间戳知道这一点。）

这怎么可能？这个错误是什么意思？

**更新**：我想我的问题并不清楚。让我改写一下：-

我**不担心**在 PHPMailer 能够将邮件发送到 GMail SMTP 后邮件是否丢失。但我担心 PHPMailer 已经返回错误，但邮件已发送。可能吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-18T08:56:22.723

我认为 SMTP 无论如何都不能保证交付。它是一种存储转发机制。这就是为什么某些电子邮件可能会丢失的原因（例如，如果中继在中继消息的过程中崩溃了）。

如果您依赖电子邮件来执行重要功能，您可能需要强制执行某种反馈机制（可能通过响应）。然后，如果在特定时间范围内未收到响应，您再试一次。

**更新**：这当然是可能的。您所需要的只是一个向您发送错误代码的邮件服务器。它可能会由于各种原因发送错误代码，不胜枚举。我建议使用上述方法是因为，您永远不应该仅依靠信任来获取服务器响应，尤其是在它没有任何原子性/酸性的情况下。

# ruby - ruby：关键字“in”是什么意思

> ID：1011282
> 
> 赞同：7
> 
> 时间：2009-06-18T07:34:05.433
> 
> 标签：ruby

当我第一次在 ruby​​ 中找到关键字“in”时。我想也许我可以这样做：1 in (0..10) 但看起来我不能那样使用它。

然后我在 ruby​​-lang.org 中搜索它，然后用谷歌搜索它。没有答案！

ruby中关键字“in”的含义是什么？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-06-18T07:43:12.170

您应该能够执行以下操作：

```
for i in 0..10 do
  puts i
end 
```

您提到的表达式`1 in (0..10)`不起作用，因为常数（1）不能在一个范围内变化 - 它是一个常数！`in`您需要在关键字之前命名一个变量。

希望有帮助。

也请参阅[此页面](http://www.techotopia.com/index.php/Looping_with_for_and_the_Ruby_Looping_Methods)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-18T07:37:20.793

根据实用程序员的书，你认为它如下

```
while *name*[, *name*]... in *expression* [do | :]
  body
end 
```

所以你在循环中使用它，如果这含糊不清，对不起，但我才刚刚开始学习 ruby​​。

# oracle - 任何人都可以帮助我从表的内容中修改 csv 文件的 abt sql 程序吗

> ID：1011283
> 
> 赞同：0
> 
> 时间：2009-06-18T07:35:11.157
> 
> 标签：oracle

嗨，我坚持编写一个必须根据表的内容更新 csv 文件（或删除旧的 csv 文件并在表中创建具有相同名称和数据的新 csv 文件）的程序。
谢谢在 adv

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-18T08:43:12.483

嗨，Oracle UTL_FILE 实用程序很好用，这是我使用的 2 个过程
1\. 删除文件
2\. 从作为参数传入的任何查询字符串创建一个 CSV 文件

```
 CREATE OR REPLACE PROCEDURE  delete_external_file (p_directory in VARCHAR2
                                                    ,p_filename in VARCHAR2) 
AS

BEGIN

  utl_file.fremove(p_directory
,p_filename);

EXCEPTION

  when others then raise;

END; 
```

```
 create or replace PROCEDURE  dump_table_to_csv( p_query in varchar2
                                             ,  p_dir   in varchar2
                                             ,  p_filename in varchar2)
 is

     l_output        utl_file.file_type;

     l_theCursor     integer default dbms_sql.open_cursor;

     l_columnValue   varchar2(2000);

     l_status        integer;

     l_colCnt        number := 0;

     l_separator     varchar2(1);

     l_descTbl       dbms_sql.desc_tab;

 begin

    l_output := utl_file.fopen( p_dir, p_filename, 'w',32760 );
    execute immediate 'alter session set nls_date_format=''dd-mon-yyyy hh24:mi:ss'' ';
    dbms_sql.parse(  l_theCursor,  p_query, dbms_sql.native );
    dbms_sql.describe_columns( l_theCursor, l_colCnt, l_descTbl );
    for i in 1 .. l_colCnt loop
    utl_file.put( l_output, l_separator || '"' || l_descTbl(i).col_name || '"' );
    dbms_sql.define_column( l_theCursor, i, l_columnValue, 4000 );
    l_separator := ',';
    end loop;
    utl_file.new_line( l_output );
    l_status := dbms_sql.execute(l_theCursor);
    while ( dbms_sql.fetch_rows(l_theCursor) > 0 ) loop
         l_separator := '';
         for i in 1 .. l_colCnt loop
              dbms_sql.column_value( l_theCursor, i, l_columnValue );
              utl_file.put( l_output, l_separator||'"'|| l_columnValue||'"' );
              l_separator := ',';
          end loop;
          utl_file.new_line( l_output );
      end loop;
     dbms_sql.close_cursor(l_theCursor);
     utl_file.fclose( l_output );
     execute immediate 'alter session set nls_date_format=''dd-MON-yy'' ';
exception

      when others then

          execute immediate 'alter session set nls_date_format=''dd-MON-yy'' ';
         raise;
 end; 
```

# java - 从Java中的文件位置获取文件名

> ID：1011287
> 
> 赞同：35
> 
> 时间：2009-06-18T07:36:03.337
> 
> 标签：java, url, string, path, filenames

我有一个`String`提供文件的绝对路径（包括文件名）。我只想获取文件名。最简单的方法是什么？

它需要尽可能通用，因为我无法提前知道 URL 是什么。我不能简单地创建一个 URL 对象并使用`getFile()`——尽管如果可能的话那将是理想的——因为它不一定是`http://`前缀，它可能是 c:/ 或类似的东西。

* * *

## 回答 #1

> 赞同：81
> 
> 时间：2009-06-18T07:37:50.200

```
new File(fileName).getName(); 
```

或者

```
int idx = fileName.replaceAll("\\\\", "/").lastIndexOf("/");
return idx >= 0 ? fileName.substring(idx + 1) : fileName; 
```

请注意，第一个解决方案取决于系统。它只考虑系统的路径分隔符。因此，如果您的代码在 Unix 系统上运行并接收 Windows 路径，它将无法工作。处理 Internet Explorer 发送的文件上传时就是这种情况。

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2009-06-18T07:38:58.027

```
new File(absolutePath).getName(); 
```

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2009-06-18T07:39:17.170

[Apache Commons IO](http://commons.apache.org/io/)提供了 FilenameUtils 类，它为您提供了一组非常丰富的实用程序函数，用于轻松获取文件名的各种组件，尽管 java.io.File 类提供了基础知识。

* * *

## 回答 #4

> 赞同：16
> 
> 时间：2012-11-13T15:00:49.440

来自[Apache Commons IO FileNameUtils](http://commons.apache.org/proper/commons-io/javadocs/api-release/index.html?org/apache/commons/io/FilenameUtils.html)

```
String fileName = FilenameUtils.getName(stringNameWithPath); 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2017-08-03T17:20:55.547

这里有 2 种方式（两者都是独立于操作系统的。）

使用`Paths`：从 1.7 开始

```
Path p = Paths.get(<Absolute Path of Linux/Windows system>);
String fileName = p.getFileName().toString();
String directory = p.getParent().toString(); 
```

`FilenameUtils`在 Apache Commons IO 中使用：

```
String name1 = FilenameUtils.getName("/ab/cd/xyz.txt");
String name2 = FilenameUtils.getName("c:\\ab\\cd\\xyz.txt"); 
```

# asp.net-mvc - ASP.Net mvc 为图表构建 xml 数据提要

> ID：1011288
> 
> 赞同：0
> 
> 时间：2009-06-18T07:36:34.523
> 
> 标签：asp.net-mvc, xml

我必须构建一个 xml 输出，该输出表示为放置在视图中的弹性图表结构化的数据。我有几个选择：

1.  让控制器创建 xml（使用数据库中的数据），并将其返回到实际上什么都不做的视图，因为一切都准备好了。

2.  将视图强类型化到数据库中的数据模型，并在视图中以声明方式呈现 xml。

3.  创建一个 Html 扩展方法，该方法将包含创建 xml 并在视图上使用它的逻辑。

在关注点分离方面，最好的选择是什么？将来我不希望对 xml 结构进行很多更改，也许时不时地。我倾向于选择选项 1，因为它更易于测试，而且我对控制器准备 xml 数据感觉更舒服。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-18T07:42:24.543

我会选择第 1 个选项，因为我觉得它最适合 MVC 模式。基于某些数据模型创建 XML 文件不是 View 的责任。这是业务逻辑，因此在控制器中效果更好。

同样重要的是，就像您说的那样，如果您让控制器创建 xml 文件，您可以为其创建一个单元测试，断言输出 xml 是有效的，包含所有必要的节点等等。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-18T07:42:53.120

选项 2 是最好的。你的模型有数据，你的控制器要求它并将它提供给视图。该视图只有一个标签来说明它的去向。这对我来说是关注点分离。

看到 Razzie 的回答，我也喜欢 1，我想模型必须提供一些方法来将某些实体类（您的图表结果）序列化为 xml，以便您的强类型视图能够使用它.

无论如何我希望答案有所帮助，基本上我认为3不是很好。:-)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-18T08:04:05.030

我会说这取决于您更喜欢什么，因为选项 1 和 2 都是可行的。人们会说选项 1 很好，因为您可以使用 XmlWriter 来确保返回有效的 xml，人们会说选项 2 是有效的，因为 mvc 就是完全控制视图中呈现的内容（可以是xml）。

但是，我个人会选择选项 1 的变体，以保持功能独立于控制器，并将其作为独立的实用程序方法，接收数据并输出 xml。这将更容易测试，但如果将来需要，也可以从代码中的其他位置调用。除此之外，它还可以使控制器中的代码保持清洁。

我同意马克的观点，我认为选项 3 不是一个好方法。

这只是我的想法，希望这会有所帮助:-)

# sql - 推荐一个很好的 SQL Server 临时表教程

> ID：1011295
> 
> 赞同：4
> 
> 时间：2009-06-18T07:37:55.393
> 
> 标签：sql, sql-server, temp-tables

我搜索但找不到适合 SQL Server 2005/2008 新手的临时表使用教程。我想了解临时表与普通表相比的优缺点，它的生命周期以及临时表是如何共享的（在同一个会话中，跨会话）？

提前谢谢，乔治

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-06-18T07:55:37.683

有两种创建临时表的方法。这将创建表并从 PHYSICALTABLE 插入数据；

```
SELECT FIELD1,FIELD2,FIELD3 INTO TempTable FROM PHYSICALTABLE; 
```

另一种方法是使用 CREATE TABLE 方法；

```
CREATE TABLE #TempTable (ID int,NAME varchar(50));
INSERT INTO #TempTable(ID,NAME) VALUES(1,'PERSON'); 
```

一旦连接关闭，或者当您对它们使用 DROP TABLE 命令时，服务器将删除临时表。除非您使用全局临时表（通过在表名中添加##），否则每个连接只能访问自己的临时表。我读过临时表会导致大表的性能损失，所以我通常只使用临时表来 UNION 两个表，然后按 + SUM 对这两个表进行分组。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-18T10:21:11.257

这是创建临时表并从中选择的快速 SQL

```
-- Create Temp table
CREATE TABLE #temps 
(
    VId int,
    first   VARCHAR( 255 ),
    surname VARCHAR( 255 ),
    DOB DATETIME

    PRIMARY KEY (VId)
)

-- Insert some test data
Insert into #temps (Vid, first, surname, DOB) 
VALUES (1, 'Bob', 'Jennings','23 Feb 1970')

-- Insert some test data
Insert into #temps (Vid, first, surname, DOB) 
VALUES (2, 'John', 'Doe','14 Oct 1965')

-- Select data from the temp table
Select * from #temps

-- Run if you wish to drop the table
-- DROP T ABLE #temps 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-18T07:57:27.100

以下指南似乎是一个很好的起点，可以了解有关临时表（和表变量）的详细信息，包括生命周期、共享等：

*   [临时表和表变量：何时使用什么以及为什么使用 - 第 1 部分](http://it.toolbox.com/blogs/programming-life/temp-tables-and-table-variables-when-to-use-what-and-why-part-1-16116)
*   [临时表和表变量：何时使用什么以及为什么使用 - 第 2 部分](http://it.toolbox.com/blogs/programming-life/temp-tables-and-table-variables-when-to-use-what-and-why-part-2-16303)

[SQL Server 临时表真的有必要吗？](http://www.sql-server-performance.com/articles/per/temp_tables_necessary_p1.aspx)出于性能原因，还考虑使用临时表。

将它们与“普通”表进行比较，我想说最大的区别本质上是普通表在数据库中持久存在，因此当您需要存储正在使用的数据时应该使用临时表，如果只是在查询/存储过程等的上下文...

# apache-flex - Flex：选择月份的任何控件？

> ID：1011298
> 
> 赞同：0
> 
> 时间：2009-06-18T07:38:28.950
> 
> 标签：apache-flex

是否有任何 Flex 控件来选择月份（任意）？

现在我正在使用 DateField，并允许用户选择一个月中的任何日期来选择该月。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-06-18T12:47:37.670

也许尝试组合框？或列表？

所以这里是 ComboBox 的示例：

```
<?xml version="1.0" encoding="utf-8"?>
<mx:WindowedApplication xmlns:mx="http://www.adobe.com/2006/mxml"
    xmlns:controls="radekg.*">
    <mx:Form>
        <mx:FormItem label="Select date:">
            <controls:DateComboBox id="dcb" change="trace(dcb.selectedMonth)" />
        </mx:FormItem>
    </mx:Form>
</mx:WindowedApplication> 
```

和 radekg/DateComboBox.as

```
package radekg {
    import mx.collections.ArrayCollection;
    import mx.controls.ComboBox;
    import mx.formatters.DateFormatter;

    public class DateComboBox extends ComboBox {

        public function DateComboBox() {
            super();
            var formatter:DateFormatter = new DateFormatter();
            formatter.formatString = "MMMM";
            dataProvider = new ArrayCollection();
            for (var i:int=0; i<12; i++) {
                var date:Date = new Date(1971,i,1);
                ArrayCollection(dataProvider).addItem(
                    { label: formatter.format(date), data: date }
                );
            }
            selectedIndex = 0;
        }

        public function get selectedMonth():Number {
            return (selectedItem.data as Date).month;
        }
        public function set selectedMonth(value:Number):void {
            selectedIndex = value;
        }

    }
} 
```

这只是一个示例:) 希望它有所帮助。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-07-01T13:39:34.980

您还可以使用压缩的 DateChooser，如下所示：

```
<?xml version="1.0" encoding="utf-8"?>
<mx:WindowedApplication xmlns:mx="http://www.adobe.com/2006/mxml">

    <mx:DateChooser id="dateChooser" height="31"/>

</mx:WindowedApplication> 
```

在初始化函数中：

```
//import com.adobe.fiber.runtime.lib.DateTimeFunc;

public function init():void {
//    var days:int = DateTimeFunc.daysInMonth(new Date() );
    var disabledDays:Array = [ 0, 1, 2, 3 , 4, 5, 6 ];
    this.view.dateChooser.disabledDays = disabledDays;
    this.view.dateChooser.yearNavigationEnabled = true;
    this.view.dateChooser.minYear = 2010;
} 
```

我不确定禁用天数是否有用，但由于我们隐藏天数，子面板没用。

请注意，我指定了最小年份并启用了年份选择器。我在使用日历时留下了一个有用的功能：）

# sql-server - SQL Server：如何增加事务日志的大小？

> ID：1011311
> 
> 赞同：7
> 
> 时间：2009-06-18T07:42:55.413
> 
> 标签：sql-server, tsql, transaction-log

如何增加事务日志的大小？是否也可以临时增加事务日志？

假设我有以下情况。我的删除操作对于当前事务日志来说太大了。我想要：

*   增加事务日志（我可以检测当前的大小吗？我可以告诉我需要多大的事务日志来进行操作吗？）
*   （执行我的操作）
*   备份事务日志
*   恢复事务日志的大小。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-18T07:52:41.137

事务日志可以配置为根据需要扩展。您将选项设置为自动增长。但是，当事务日志变得太大（磁盘空间不足）或使 sql server 无法使用时。

***备份事务日志。SQL 将自动截断不活动的事务***

当你恢复事务日志时会减少

要配置自动增长：

1.  右键单击管理工作室中的数据库。
2.  选择属性
3.  更新自动增长值

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-06-18T07:54:09.713

简短的回答：

*   SQL 2k5/2k8[如何：增加数据库的大小 (SQL Server Management Studio)](http://msdn.microsoft.com/en-us/library/ms175890.aspx)（也适用于日志），[如何：缩小数据库 (SQL Server Management Studio)](http://msdn.microsoft.com/en-us/library/ms189035.aspx)
*   SQL 2K[如何增加数据库的大小（企业管理器）](http://msdn.microsoft.com/en-us/library/aa197143(SQL.80).aspx)，[如何缩小数据库（企业管理器）](http://msdn.microsoft.com/en-us/library/aa176794(SQL.80).aspx)

长答案：您可以使用`ALTER DATABASE ... MODIFY FILE`来更改数据库文件的大小，包括 LOG 文件。您可以查找`master_files/sysfiles`(2k) 或`<dbname>.sys.database_files`(2k5/2k8) 以获取日志的逻辑名称。您可以使用它[`DBCC SHRINKFILE`](http://msdn.microsoft.com/en-us/library/ms189493.aspx)来缩小文件（如果可能）。

> 我可以知道我的操作需要多大的事务日志吗？

这取决于很多因素（这是新数据吗？是更新吗？是删除吗？什么恢复模式？你对 SQL 2k8 有压缩吗？等等），但通常比你预期的要大。我估计你将要执行的更新大小是 2.5 倍。

更新：

错过你说的是一个DELETE。粗略估计是删除数据（包括所有索引）大小的 1.5 倍。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-18T09:21:34.933

最重要的部分是场景的最后一行：“恢复事务日志的大小”。你的意思是把日志缩小到原来的大小。

由于很多原因，这确实很危险，我们已经在 SQLServerPedia 的几个故事中介绍了它们：

*   [http://sqlserverpedia.com/wiki/Shrinking_Databases](http://sqlserverpedia.com/wiki/Shrinking_Databases)
*   [http://sqlserverpedia.com/blog/sql-server-backup-and-restore/backup-log-with-truncate_only-like-a-bear-trap/](http://sqlserverpedia.com/blog/sql-server-backup-and-restore/backup-log-with-truncate_only-like-a-bear-trap/)
*   [http://sqlserverpedia.com/blog/sql-server-bloggers/i-was-in-the-pool-dealing-with-sql-shrinkage/](http://sqlserverpedia.com/blog/sql-server-bloggers/i-was-in-the-pool-dealing-with-sql-shrinkage/)

# javascript - 如果 JavaScript 中为 null 或 undefined 则替换一个值

> ID：1011317
> 
> 赞同：174
> 
> 时间：2009-06-18T07:44:45.987
> 
> 标签：javascript

我需要将`??`C# 运算符应用于 JavaScript，但我不知道如何。在 C# 中考虑这个：

```
int i?=null;
int j=i ?? 10;//j is now 10 
```

现在我在 JavaScript 中设置了这个：

```
var options={
       filters:{
          firstName:'abc'
       } 
    };
var filter=options.filters[0]||'';//should get 'abc' here, it doesn't happen
var filter2=options.filters[1]||'';//should get empty string here, because there is only one filter 
```

我该如何正确地做到这一点？

谢谢。

编辑：我发现了一半的问题：我不能对对象（`my_object[0]`）使用“索引器”表示法。有没有办法绕过它？（我事先不知道过滤器属性的名称，也不想遍历它们）。

* * *

## 回答 #1

> 赞同：341
> 
> 时间：2009-06-18T07:49:29.333

这是等效的 JavaScript：

```
var i = null;
var j = i || 10; //j is now 10 
```

请注意，[逻辑运算符`||`](https://developer.mozilla.org/en/Core_JavaScript_1.5_Reference/Operators/Logical_Operators)不返回布尔值，而是返回第一个可以转换为*true*的值。

另外使用一组对象而不是一个对象：

```
var options = {
    filters: [
        {
            name: 'firstName',
            value: 'abc'
        }
    ]
};
var filter  = options.filters[0] || '';  // is {name:'firstName', value:'abc'}
var filter2 = options.filters[1] || '';  // is '' 
```

可以通过索引访问。

* * *

## 回答 #2

> 赞同：31
> 
> 时间：2020-04-13T18:44:51.247

## ES2020 答案

新的[Nullish Coalescing](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Nullish_coalescing_operator) Operator 终于可以在 JavaScript 上使用了。但是，请注意[浏览器支持](https://caniuse.com/mdn-javascript_operators_nullish_coalescing)。您可能需要使用像[Babel](https://babeljs.io/)这样的 JavaScript 编译器来将其转换为更向后兼容的东西。

根据文件，

> 空值合并运算符 (??) 是一个逻辑运算符，当其左侧操作数为空或未定义时返回其右侧操作数，否则返回其左侧操作数。

```
const options={
  filters:{
    firstName:'abc'
  } 
};
const filter = options.filters[0] ?? '';
const filter2 = options.filters[1] ?? ''; 
```

这将确保您的两个变量都具有`''`if`filters[0]`或`filters[1]`are`null`或的后备值`undefined`。

请注意，nullish 合并运算符不会返回其他类型的假值的默认值，例如`0`and `''`。如果您希望考虑所有虚假值，您应该使用 OR 运算符`||`。

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2020-07-09T22:14:10.253

# 逻辑无效分配，2020+ 解决方案

添加了一个新的运算符，`??=`. 这相当于`value = value ?? defaultValue`。

`||=`并且`&&=`相似，链接如下。

这将检查左侧是否未定义或为空，如果已定义则短路。如果不是，则为左侧分配右侧值。

### 基本示例

```
let a          // undefined
let b = null
let c = false

a ??= true  // true
b ??= true  // true
c ??= true  // false

// Equivalent to
a = a ?? true 
```

### 对象/数组示例

```
let x = ["foo"]
let y = { foo: "fizz" }

x[0] ??= "bar"  // "foo"
x[1] ??= "bar"  // "bar"

y.foo ??= "buzz"  // "fizz"
y.bar ??= "buzz"  // "buzz"

x  // Array [ "foo", "bar" ]
y  // Object { foo: "fizz", bar: "buzz" } 
```

### 功能示例

```
function config(options) {
    options.duration ??= 100
    options.speed ??= 25
    return options
}

config({ duration: 555 })   // { duration: 555, speed: 25 }
config({})                  // { duration: 100, speed: 25 }
config({ duration: null })  // { duration: 100, speed: 25 } 
```

[??= 浏览器支持](https://caniuse.com/#feat=mdn-javascript_operators_logical_nullish_assignment)2021 年 9 月 - 90%

[??= Mozilla 文档](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Logical_nullish_assignment)

[||= Mozilla 文档](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Logical_OR_assignment)

[&&= Mozilla 文档](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Logical_AND_assignment)

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-06-18T07:56:07.883

> 我发现了一半的问题：我不能对对象 (my_object[0]) 使用“索引器”表示法。有没有办法绕过它？

不; 顾名思义，对象字面量是一个*对象*，而不是数组，因此您不能简单地根据索引检索属性，因为它们的属性没有特定的顺序。检索其值的唯一方法是使用特定名称：

```
var someVar = options.filters.firstName; //Returns 'abc' 
```

或者通过使用循环遍历它们`for ... in`：

```
for(var p in options.filters) {
    var someVar = options.filters[p]; //Returns the property being iterated
} 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2021-02-02T11:57:35.980

### TLDR：

`int j=i ?? 10;`也可以在 javascript 中使用。只需替换`int`为`let`.

### `??`对比`||`

`??`应该首选，`||`因为它只检查**null 和 undefined**。

全部 以下表达式为真：

```
(null || 'x') === 'x' ;
(undefined || 'x') === 'x' ;
//Most of the times you don't want the result below
('' || 'x') === 'x'  ;
(0 || 'x') === 'x' ;
(false || 'x') === 'x' ;
//-----

//Using ?? is preferred
(null ?? 'x') === 'x' ;
(undefined ?? 'x') === 'x' ;
//?? works only for null and undefined, which is in general safer
('' ?? 'x') === '' ;
(0 ?? 'x') === 0 ;
(false ?? 'x') === false ; 
```

**星号：**检查[浏览器兼容性](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Nullish_coalescing_operator#browser_compatibility)，如果你真的需要支持这些其他浏览器，请使用[babel](https://babeljs.io/)。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2020-07-10T00:00:02.407

# 解构解决方案

问题内容可能已经改变，所以我会尽量彻底回答。

解构允许您从任何具有属性的事物中提取值。您还可以在 null/undefined 和名称别名时定义默认值。

```
const options = {
    filters : {
        firstName : "abc"
    } 
}

const {filters: {firstName = "John", lastName = "Smith"}} = options

// firstName = "abc"
// lastName = "Smith" 
```

> 注意：大小写很重要

如果使用数组，请按照以下方式操作。

在这种情况下，从数组中的每个对象中提取名称，并赋予其自己的别名。由于该对象可能不存在`= {}`，因此也添加了。

```
const options = {
    filters: [{
        name: "abc",
        value: "lots"
    }]
}

const {filters:[{name : filter1 = "John"} = {}, {name : filter2 = "Smith"} = {}]} = options

// filter1 = "abc"
// filter2 = "Smith" 
```

[更详细的教程](https://wesbos.com/destructuring-default-values)

[浏览器支持](https://caniuse.com/#feat=mdn-javascript_operators_destructuring)92% 2020 年 7 月

# c++ - 检查交互式白板或投影仪

> ID：1011325
> 
> 赞同：0
> 
> 时间：2009-06-18T07:46:16.127
> 
> 标签：c++, projector, whiteboard

我想检查系统是否连接了交互式白板或投影仪。其实我想检查它不存在。（为了能够制作不同的许可级别。）有什么技术可以确定吗？

平台：MS Windows XP/Vista、MS Visual C++

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-18T07:48:12.127

标准 C++ 中没有任何内容 - 您将需要特定于平台的库。为了让我们帮助您，我们需要有关您使用的平台的更多信息。

# python - Python 包中的相对文件路径

> ID：1011337
> 
> 赞同：17
> 
> 时间：2009-06-18T07:51:23.993
> 
> 标签：python, reference, packages, relative-path

如何相对于包的目录引用文件？

我的目录结构是：

```
    /foo
     包1/
      资源/
      __init__.py
     包2/
      资源/
      __init__.py
     脚本.py

```

`script.py`导入包`package1`和`package2`. 尽管可以通过系统上的任何其他脚本导入包。例如，我应该如何引用内部资源，`package1`以确保它在`os.path.curdir`任意情况下都能正常工作？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-06-18T08:00:44.020

如果要从`foo/package1/resources`文件夹中引用文件，则需要使用`__file__`模块的变量。内部`foo/package1/__init__.py`：

```
from os import path
resources_dir = path.join(path.dirname(__file__), 'resources') 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2016-10-05T02:01:22.697

一种简单/安全的方法是使用 pkg_resources 中的[方法](http://setuptools.readthedocs.io/en/latest/pkg_resources.html)`resource_filename`（与[setuptools](https://pypi.python.org/pypi/setuptools)一起分发），如下所示：

```
from pkg_resources import resource_filename
filepath = resource_filename('package1', 'resources/thefile') 
```

或者，如果你在里面实现这个`package1/___init___.py`：

```
from pkg_resources import resource_filename
filepath = resource_filename(__name__, 'resources/thefile') 
```

这为您提供了一个干净的解决方案，它也是（如果我没记错的话）拉链安全。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-06-18T08:33:57.293

[如果您使用twisted.python.modules](http://twistedmatrix.com/documents/8.2.0/api/twisted.python.modules.html)，您可以在使用 zip 安全的同时使用一个非常方便的 API 。

例如，如果我有一个`data.txt`包含一些文本的文件，并且这个`sample.py`文件在一个目录中：

```
from twisted.python.modules import getModule
moduleDirectory = getModule(__name__).filePath.parent()
print repr(moduleDirectory.child("data.txt").open().read()) 
```

然后导入`sample`将执行此操作：

```
>>> import sample
'Hello, data!\n'
>>> 
```

如果您的模块位于常规目录中，`getModule(__name__).filePath`则为[FilePath](http://twistedmatrix.com/documents/8.2.0/api/twisted.python.filepath.FilePath.html)；如果它在一个 zip 文件中，它将是一个[ZipPath](http://twistedmatrix.com/documents/8.2.0/api/twisted.python.zippath.ZipPath.html)，它支持大多数（但不是全部）相同的 API。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-06-18T08:20:28.723

这是一个坏主意，因为如果您的软件包是作为 zipped egg 安装的，那么资源可能不可用。

如果您使用 setuptool，请不要忘记将 zip_safe=False 添加到 setup.py 配置中。

# perl - IO::Select 中的 select() 包装器是线程安全的吗？如何解决？

> ID：1011338
> 
> 赞同：2
> 
> 时间：2009-06-18T07:52:01.153
> 
> 标签：perl, sockets, network-programming, nonblocking

假设我有一个线程：

```
sub     new {
        my      $class = shift;
        my      $self = ref $class || $class;

        bless { 'read_set'  => IO::Select->new,
                'write_set' => IO::Select->new,
                'error_set' => IO::Select->new }, $self;
}

sub     start {
        my      $self = shift;

        $self->{'thread'} = threads->create(\&worker_thr, $self);
        $self->{'thread'}->detach;
}

sub     worker_thr {
         my      $self = shift;

         while(1) {
                 my($read_active, $write_active, $error_active) = 
                    IO::Select->select(
                            $self->{'read_set'},
                            $self->{'write_set'},
                            $self->{'error_set'}, 
                            undef
                    );
         }

} 
```

由于我没有提供超时`select()`并且它无限期地阻塞，直到在一个描述符（好吧，“句柄”）集上检测到活动，如果另一个线程修改集的内容（例如添加一个新的套接字进行轮询）会发生什么？

相对于 Perl POSIX 线程实现，它是否以线程安全的方式实现？

如果没有，我想我可以将阻塞`select()`调用放在具有自己范围的块中并锁定集合，或者更清楚地说，锁定整个包数据。从另一个线程唤醒`select()`以返回以便可以操作集合的内容的最佳方法是什么？线程特定的信号？信号？欢迎提出建议。

非常感谢！

**编辑：**嗯，线程特定的“信号”出来了。如此处所述（[http://perldoc.perl.org/threads.html](http://perldoc.perl.org/threads.html)）：“相应地，向线程发送信号不会中断线程当前正在处理的操作：信号将在当前操作之后执行已经完成。例如，如果线程卡在 I/O 调用上，向其发送信号不会导致 I/O 调用中断，从而立即执行信号。

这仍然让我想知道`select()`如果我希望它无限期地阻塞而不是在固定超时后返回，我应该如何处理在线程中唤醒的问题。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-18T09:49:06.003

默认情况下，perl 线程不共享任何数据，因此如果一个线程更改了它的集合，它不会影响另一个。所以是的，它是线程安全的，但它可能不会做你想做的事。

如果您真的想唤醒另一个阻塞选择的线程或进程，一个简单的解决方案是将管道添加到它的读取队列。然后，您可以通过向该管道写入一个字节来唤醒它。

# c++ - 如何使用 C++ 发出 HTTP 请求？

> ID：1011339
> 
> 赞同：323
> 
> 时间：2009-06-18T07:52:41.010
> 
> 标签：c++, httprequest

有什么方法可以轻松地用 C++ 发出 HTTP 请求？具体来说，我想下载页面（API）的内容并检查内容是否包含1或0。是否也可以将内容下载到字符串中？

* * *

## 回答 #1

> 赞同：306
> 
> 时间：2009-07-10T21:29:26.343

我有同样的问题。[libcurl](http://curl.haxx.se/libcurl/)真的很完整。当您要求 C++ 库时，您可能会对C++ 包装器[curlpp感兴趣。](http://www.curlpp.org/)[neon](https://notroj.github.io/neon/)是另一个有趣的 C 库，它也支持[WebDAV](https://fr.wikipedia.org/wiki/WebDAV)。

如果您使用 C++，curlpp 似乎很自然。源代码分发中提供了许多示例。要获取 URL 的内容，您可以执行类似的操作（从示例中提取）：

```
// Edit : rewritten for cURLpp 0.7.3
// Note : namespace changed, was cURLpp in 0.7.2 ...

#include <curlpp/cURLpp.hpp>
#include <curlpp/Options.hpp>

// RAII cleanup

curlpp::Cleanup myCleanup;

// Send request and get a result.
// Here I use a shortcut to get it in a string stream ...

std::ostringstream os;
os << curlpp::options::Url(std::string("http://example.com"));

string asAskedInQuestion = os.str(); 
```

参见[curlpp source distribution](https://github.com/jpbarrette/curlpp)`examples`中的目录，有很多更复杂的案例，还有一个使用 curlpp的[简单完整的最小案例。](https://github.com/jpbarrette/curlpp/blob/master/examples/example22.cpp)

我的 2 美分...

* * *

## 回答 #2

> 赞同：130
> 
> 时间：2012-09-11T16:52:00.157

窗口代码：

```
#include <string.h>
#include <winsock2.h>
#include <windows.h>
#include <iostream>
#include <vector>
#include <locale>
#include <sstream>
using namespace std;
#pragma comment(lib,"ws2_32.lib")

int main( void ){

WSADATA wsaData;
SOCKET Socket;
SOCKADDR_IN SockAddr;
int lineCount=0;
int rowCount=0;
struct hostent *host;
locale local;
char buffer[10000];
int i = 0 ;
int nDataLength;
string website_HTML;

// website url
string url = "www.google.com";

//HTTP GET
string get_http = "GET / HTTP/1.1\r\nHost: " + url + "\r\nConnection: close\r\n\r\n";

    if (WSAStartup(MAKEWORD(2,2), &wsaData) != 0){
        cout << "WSAStartup failed.\n";
        system("pause");
        //return 1;
    }

    Socket=socket(AF_INET,SOCK_STREAM,IPPROTO_TCP);
    host = gethostbyname(url.c_str());

    SockAddr.sin_port=htons(80);
    SockAddr.sin_family=AF_INET;
    SockAddr.sin_addr.s_addr = *((unsigned long*)host->h_addr);

    if(connect(Socket,(SOCKADDR*)(&SockAddr),sizeof(SockAddr)) != 0){
        cout << "Could not connect";
        system("pause");
        //return 1;
    }

    // send GET / HTTP
    send(Socket,get_http.c_str(), strlen(get_http.c_str()),0 );

    // recieve html
    while ((nDataLength = recv(Socket,buffer,10000,0)) > 0){        
        int i = 0;
        while (buffer[i] >= 32 || buffer[i] == '\n' || buffer[i] == '\r'){

            website_HTML+=buffer[i];
            i += 1;
        }               
    }

    closesocket(Socket);
    WSACleanup();

    // Display HTML source 
    cout<<website_HTML;

    // pause
    cout<<"\n\nPress ANY key to close.\n\n";
    cin.ignore(); cin.get(); 

 return 0;
} 
```

这是一个更好的实现：

```
#include <windows.h>
#include <string>
#include <stdio.h>

using std::string;

#pragma comment(lib,"ws2_32.lib")

HINSTANCE hInst;
WSADATA wsaData;
void mParseUrl(char *mUrl, string &serverName, string &filepath, string &filename);
SOCKET connectToServer(char *szServerName, WORD portNum);
int getHeaderLength(char *content);
char *readUrl2(char *szUrl, long &bytesReturnedOut, char **headerOut);

int main()
{
    const int bufLen = 1024;
    char *szUrl = "http://stackoverflow.com";
    long fileSize;
    char *memBuffer, *headerBuffer;
    FILE *fp;

    memBuffer = headerBuffer = NULL;

    if ( WSAStartup(0x101, &wsaData) != 0)
        return -1;

    memBuffer = readUrl2(szUrl, fileSize, &headerBuffer);
    printf("returned from readUrl\n");
    printf("data returned:\n%s", memBuffer);
    if (fileSize != 0)
    {
        printf("Got some data\n");
        fp = fopen("downloaded.file", "wb");
        fwrite(memBuffer, 1, fileSize, fp);
        fclose(fp);
         delete(memBuffer);
        delete(headerBuffer);
    }

    WSACleanup();
    return 0;
}

void mParseUrl(char *mUrl, string &serverName, string &filepath, string &filename)
{
    string::size_type n;
    string url = mUrl;

    if (url.substr(0,7) == "http://")
        url.erase(0,7);

    if (url.substr(0,8) == "https://")
        url.erase(0,8);

    n = url.find('/');
    if (n != string::npos)
    {
        serverName = url.substr(0,n);
        filepath = url.substr(n);
        n = filepath.rfind('/');
        filename = filepath.substr(n+1);
    }

    else
    {
        serverName = url;
        filepath = "/";
        filename = "";
    }
}

SOCKET connectToServer(char *szServerName, WORD portNum)
{
    struct hostent *hp;
    unsigned int addr;
    struct sockaddr_in server;
    SOCKET conn;

    conn = socket(AF_INET, SOCK_STREAM, IPPROTO_TCP);
    if (conn == INVALID_SOCKET)
        return NULL;

    if(inet_addr(szServerName)==INADDR_NONE)
    {
        hp=gethostbyname(szServerName);
    }
    else
    {
        addr=inet_addr(szServerName);
        hp=gethostbyaddr((char*)&addr,sizeof(addr),AF_INET);
    }

    if(hp==NULL)
    {
        closesocket(conn);
        return NULL;
    }

    server.sin_addr.s_addr=*((unsigned long*)hp->h_addr);
    server.sin_family=AF_INET;
    server.sin_port=htons(portNum);
    if(connect(conn,(struct sockaddr*)&server,sizeof(server)))
    {
        closesocket(conn);
        return NULL;
    }
    return conn;
}

int getHeaderLength(char *content)
{
    const char *srchStr1 = "\r\n\r\n", *srchStr2 = "\n\r\n\r";
    char *findPos;
    int ofset = -1;

    findPos = strstr(content, srchStr1);
    if (findPos != NULL)
    {
        ofset = findPos - content;
        ofset += strlen(srchStr1);
    }

    else
    {
        findPos = strstr(content, srchStr2);
        if (findPos != NULL)
        {
            ofset = findPos - content;
            ofset += strlen(srchStr2);
        }
    }
    return ofset;
}

char *readUrl2(char *szUrl, long &bytesReturnedOut, char **headerOut)
{
    const int bufSize = 512;
    char readBuffer[bufSize], sendBuffer[bufSize], tmpBuffer[bufSize];
    char *tmpResult=NULL, *result;
    SOCKET conn;
    string server, filepath, filename;
    long totalBytesRead, thisReadSize, headerLen;

    mParseUrl(szUrl, server, filepath, filename);

    ///////////// step 1, connect //////////////////////
    conn = connectToServer((char*)server.c_str(), 80);

    ///////////// step 2, send GET request /////////////
    sprintf(tmpBuffer, "GET %s HTTP/1.0", filepath.c_str());
    strcpy(sendBuffer, tmpBuffer);
    strcat(sendBuffer, "\r\n");
    sprintf(tmpBuffer, "Host: %s", server.c_str());
    strcat(sendBuffer, tmpBuffer);
    strcat(sendBuffer, "\r\n");
    strcat(sendBuffer, "\r\n");
    send(conn, sendBuffer, strlen(sendBuffer), 0);

//    SetWindowText(edit3Hwnd, sendBuffer);
    printf("Buffer being sent:\n%s", sendBuffer);

    ///////////// step 3 - get received bytes ////////////////
    // Receive until the peer closes the connection
    totalBytesRead = 0;
    while(1)
    {
        memset(readBuffer, 0, bufSize);
        thisReadSize = recv (conn, readBuffer, bufSize, 0);

        if ( thisReadSize <= 0 )
            break;

        tmpResult = (char*)realloc(tmpResult, thisReadSize+totalBytesRead);

        memcpy(tmpResult+totalBytesRead, readBuffer, thisReadSize);
        totalBytesRead += thisReadSize;
    }

    headerLen = getHeaderLength(tmpResult);
    long contenLen = totalBytesRead-headerLen;
    result = new char[contenLen+1];
    memcpy(result, tmpResult+headerLen, contenLen);
    result[contenLen] = 0x0;
    char *myTmp;

    myTmp = new char[headerLen+1];
    strncpy(myTmp, tmpResult, headerLen);
    myTmp[headerLen] = NULL;
    delete(tmpResult);
    *headerOut = myTmp;

    bytesReturnedOut = contenLen;
    closesocket(conn);
    return(result);
} 
```

* * *

## 回答 #3

> 赞同：58
> 
> 时间：2012-07-24T04:39:21.477

**2020 年更新：**我有一个新的答案来取代这个，现在已经 8 岁了，一个：[https ://stackoverflow.com/a/61177330/278976](https://stackoverflow.com/a/61177330/278976)

在 Linux 上，我尝试了 cpp-netlib、libcurl、curlpp、urdl、boost::asio 并考虑了 Qt（但根据许可证拒绝了它）。所有这些要么是不完整的，要么是不完整的，要么是草率的界面，要么是糟糕的文档，要么是无人维护，要么是不支持 https。

然后，在[https://stackoverflow.com/a/1012577/278976](https://stackoverflow.com/a/1012577/278976)的建议下，我尝试了 POCO。哇，我真希望我几年前就看到了。下面是一个使用 POCO 发出 HTTP GET 请求的示例：

[https://stackoverflow.com/a/26026828/2817595](https://stackoverflow.com/a/26026828/2817595)

POCO 是免费的、开源的（增强许可证）。不，我与公司没有任何关系；我真的很喜欢他们的界面。干得好家伙（和女孩）。

[https://pocoproject.org/download.html](https://pocoproject.org/download.html)

希望这对某人有所帮助……我花了三天时间尝试所有这些库。

* * *

## 回答 #4

> 赞同：47
> 
> 时间：2015-09-01T15:13:57.450

正在开发一种更新的、不太成熟的 curl 包装器，称为[C++ Requests](https://github.com/whoshuu/cpr)。这是一个简单的 GET 请求：

```
#include <iostream>
#include <cpr.h>

int main(int argc, char** argv) {
    auto response = cpr::Get(cpr::Url{"http://httpbin.org/get"});
    std::cout << response.text << std::endl;
} 
```

它支持多种 HTTP 动词和 curl 选项。[这里](https://whoshuu.github.io/cpr/)有更多使用文档。

*免责声明：我是这个库的维护者*。

* * *

## 回答 #5

> 赞同：19
> 
> 时间：2009-07-13T14:57:38.583

如果您需要 C++ 解决方案，您可以使用[Qt](http://www.qt.io)。它有一个可以使用的 QHttp 类。

您可以查看[文档](http://doc.qt.digia.com/4.5/qhttp.html)：

```
http->setHost("qt.nokia.com");
http->get(QUrl::toPercentEncoding("/index.html")); 
```

Qt 还有很多其他功能，您可以在常见的 C++ 应用程序中使用。

* * *

## 回答 #6

> 赞同：19
> 
> 时间：2020-04-12T19:56:29.770

2020 年 4 月的更新答案：

最近，我使用[cpp-httplib](https://github.com/yhirose/cpp-httplib)（作为客户端和服务器）取得了很大的成功。它很成熟，其近似的单线程 RPS 约为 6k。

在更多的前沿，有一个非常有前途的框架[cpv-framework](https://github.com/cpv-project/cpv-framework)，它可以在两个内核上获得大约 180k RPS（并且可以很好地随着内核的数量而扩展，因为它基于[seastar](https://github.com/scylladb/seastar)框架，它为最快的数据库提供动力星球，[scylladb](https://github.com/scylladb/scylla)）。

但是cpv-framework还比较不成熟；因此，对于大多数用途，我强烈推荐 cpp-httplib。

此建议取代了[我之前的答案](https://stackoverflow.com/a/11624263/278976)（8 年前）。

* * *

## 回答 #7

> 赞同：18
> 
> 时间：2014-11-19T20:49:29.117

这是我对 cURL 的最小包装，它能够将网页作为字符串获取。例如，这对于单元测试很有用。它基本上是 C 代码的 RAII 包装器。

`yum install libcurl libcurl-devel`在您的机器或同等设备上安装“libcurl” 。

使用示例：

```
CURLplusplus client;
string x = client.Get("http://google.com");
string y = client.Get("http://yahoo.com"); 
```

类实现：

```
#include <curl/curl.h>

class CURLplusplus
{
private:
    CURL* curl;
    stringstream ss;
    long http_code;
public:
    CURLplusplus()
            : curl(curl_easy_init())
    , http_code(0)
    {

    }
    ~CURLplusplus()
    {
        if (curl) curl_easy_cleanup(curl);
    }
    std::string Get(const std::string& url)
    {
        CURLcode res;
        curl_easy_setopt(curl, CURLOPT_URL, url.c_str());
        curl_easy_setopt(curl, CURLOPT_FOLLOWLOCATION, 1L);
        curl_easy_setopt(curl, CURLOPT_WRITEFUNCTION, write_data);
        curl_easy_setopt(curl, CURLOPT_WRITEDATA, this);

        ss.str("");
        http_code = 0;
        res = curl_easy_perform(curl);
        if (res != CURLE_OK)
        {
            throw std::runtime_error(curl_easy_strerror(res));
        }
        curl_easy_getinfo(curl, CURLINFO_RESPONSE_CODE, &http_code);
        return ss.str();
    }
    long GetHttpCode()
    {
        return http_code;
    }
private:
    static size_t write_data(void *buffer, size_t size, size_t nmemb, void *userp)
    {
        return static_cast<CURLplusplus*>(userp)->Write(buffer,size,nmemb);
    }
    size_t Write(void *buffer, size_t size, size_t nmemb)
    {
        ss.write((const char*)buffer,size*nmemb);
        return size*nmemb;
    }
}; 
```

* * *

## 回答 #8

> 赞同：17
> 
> 时间：2014-01-14T02:01:16.517

您可能需要检查[C++ REST SDK](https://github.com/Microsoft/cpprestsdk)（代号“Casablanca”）。[http://msdn.microsoft.com/en-us/library/jj950081.aspx](http://msdn.microsoft.com/en-us/library/jj950081.aspx)

使用 C++ REST SDK，您可以更轻松地从 C++ 应用程序连接到 HTTP 服务器。

使用示例：

```
#include <iostream>
#include <cpprest/http_client.h>

using namespace web::http;                  // Common HTTP functionality
using namespace web::http::client;          // HTTP client features

int main(int argc, char** argv) {
    http_client client("http://httpbin.org/");

    http_response response;
    // ordinary `get` request
    response = client.request(methods::GET, "/get").get();
    std::cout << response.extract_string().get() << "\n";

    // working with json
    response = client.request(methods::GET, "/get").get();
    std::cout << "url: " << response.extract_json().get()[U("url")] << "\n";
} 
```

C++ REST SDK 是一个 Microsoft 项目，用于使用现代异步 C++ API 设计以本机代码进行基于云的客户端-服务器通信。

* * *

## 回答 #9

> 赞同：16
> 
> 时间：2009-06-18T15:57:13.800

[libCURL](http://curl.haxx.se/)对您来说是一个不错的选择。根据你需要做什么，[教程](http://curl.haxx.se/libcurl/c/libcurl-tutorial.html)应该告诉你你想要什么，特别是为了容易处理。但是，基本上，您可以这样做只是为了查看页面的来源：

```
CURL* c;
c = curl_easy_init();
curl_easy_setopt( c, CURL_URL, "www.google.com" );
curl_easy_perform( c );
curl_easy_cleanup( c ); 
```

我相信这会导致结果打印到标准输出。如果你想处理它——我假设你这样做——你需要设置 CURL_WRITEFUNCTION。所有这些都包含在上面链接的 curl 教程中。

* * *

## 回答 #10

> 赞同：12
> 
> 时间：2015-02-06T16:06:29.460

有了这个答案，我参考了[Software_Developer 的答案](https://stackoverflow.com/a/12374407/2334932)。通过重新构建代码，我发现某些部分已被**弃用**（`gethostbyname()`）或**不为操作提供错误处理**（创建套接字、发送内容）。

以下*Windows 代码*使用 Visual Studio 2013 和 Windows 8.1 64 位以及 Windows 7 64 位进行了测试。它将以与 www.google.com 的 Web 服务器的 IPv4 TCP 连接为目标。

```
#include <winsock2.h>
#include <WS2tcpip.h>
#include <windows.h>
#include <iostream>
#pragma comment(lib,"ws2_32.lib")
using namespace std;
    int main (){
    // Initialize Dependencies to the Windows Socket.
    WSADATA wsaData;
    if (WSAStartup(MAKEWORD(2,2), &wsaData) != 0) {
        cout << "WSAStartup failed.\n";
        system("pause");
        return -1;
    }

    // We first prepare some "hints" for the "getaddrinfo" function
    // to tell it, that we are looking for a IPv4 TCP Connection.
    struct addrinfo hints;
    ZeroMemory(&hints, sizeof(hints));
    hints.ai_family = AF_INET;          // We are targeting IPv4
    hints.ai_protocol = IPPROTO_TCP;    // We are targeting TCP
    hints.ai_socktype = SOCK_STREAM;    // We are targeting TCP so its SOCK_STREAM

    // Aquiring of the IPv4 address of a host using the newer
    // "getaddrinfo" function which outdated "gethostbyname".
    // It will search for IPv4 addresses using the TCP-Protocol.
    struct addrinfo* targetAdressInfo = NULL;
    DWORD getAddrRes = getaddrinfo("www.google.com", NULL, &hints, &targetAdressInfo);
    if (getAddrRes != 0 || targetAdressInfo == NULL)
    {
        cout << "Could not resolve the Host Name" << endl;
        system("pause");
        WSACleanup();
        return -1;
    }

    // Create the Socket Address Informations, using IPv4
    // We dont have to take care of sin_zero, it is only used to extend the length of SOCKADDR_IN to the size of SOCKADDR
    SOCKADDR_IN sockAddr;
    sockAddr.sin_addr = ((struct sockaddr_in*) targetAdressInfo->ai_addr)->sin_addr;    // The IPv4 Address from the Address Resolution Result
    sockAddr.sin_family = AF_INET;  // IPv4
    sockAddr.sin_port = htons(80);  // HTTP Port: 80

    // We have to free the Address-Information from getaddrinfo again
    freeaddrinfo(targetAdressInfo);

    // Creation of a socket for the communication with the Web Server,
    // using IPv4 and the TCP-Protocol
    SOCKET webSocket = socket(AF_INET, SOCK_STREAM, IPPROTO_TCP);
    if (webSocket == INVALID_SOCKET)
    {
        cout << "Creation of the Socket Failed" << endl;
        system("pause");
        WSACleanup();
        return -1;
    }

    // Establishing a connection to the web Socket
    cout << "Connecting...\n";
    if(connect(webSocket, (SOCKADDR*)&sockAddr, sizeof(sockAddr)) != 0)
    {
        cout << "Could not connect";
        system("pause");
        closesocket(webSocket);
        WSACleanup();
        return -1;
    }
    cout << "Connected.\n";

    // Sending a HTTP-GET-Request to the Web Server
    const char* httpRequest = "GET / HTTP/1.1\r\nHost: www.google.com\r\nConnection: close\r\n\r\n";
    int sentBytes = send(webSocket, httpRequest, strlen(httpRequest),0);
    if (sentBytes < strlen(httpRequest) || sentBytes == SOCKET_ERROR)
    {
        cout << "Could not send the request to the Server" << endl;
        system("pause");
        closesocket(webSocket);
        WSACleanup();
        return -1;
    }

    // Receiving and Displaying an answer from the Web Server
    char buffer[10000];
    ZeroMemory(buffer, sizeof(buffer));
    int dataLen;
    while ((dataLen = recv(webSocket, buffer, sizeof(buffer), 0) > 0))
    {
        int i = 0;
        while (buffer[i] >= 32 || buffer[i] == '\n' || buffer[i] == '\r') {
            cout << buffer[i];
            i += 1;
        }
    }

    // Cleaning up Windows Socket Dependencies
    closesocket(webSocket);
    WSACleanup();

    system("pause");
    return 0;
} 
```

**参考：**

[弃用 gethostbyname](https://msdn.microsoft.com/de-de/library/windows/desktop/ms738524%28v=vs.85%29.aspx)

[socket() 的返回值](https://msdn.microsoft.com/de-de/library/windows/desktop/ms740506(v=vs.85).aspx)

[send() 的返回值](https://msdn.microsoft.com/de-de/library/windows/desktop/ms740149(v=vs.85).aspx)

* * *

## 回答 #11

> 赞同：8
> 
> 时间：2009-06-18T08:13:42.857

C++ 没有提供任何直接执行此操作的方法。这完全取决于您拥有的平台和库。

在最坏的情况下，您可以使用 boost::asio 库建立 TCP 连接，发送 HTTP 标头 (RFC 2616)，并直接解析响应。查看您的应用程序需求，这很简单。

* * *

## 回答 #12

> 赞同：7
> 
> 时间：2018-08-22T04:03:08.740

请注意，这不需要 libcurl、Windows.h 或 WinSock！无需编译库，无需项目配置等。我在 Windows 10 上的 Visual Studio 2017 c++ 中有此代码：

```
#pragma comment(lib, "urlmon.lib")

#include <urlmon.h>
#include <sstream>

using namespace std;

...

IStream* stream;
//Also works with https URL's - unsure about the extent of SSL support though.
HRESULT result = URLOpenBlockingStream(0, "http://google.com", &stream, 0, 0);
if (result != 0)
{
    return 1;
}
char buffer[100];
unsigned long bytesRead;
stringstream ss;
stream->Read(buffer, 100, &bytesRead);
while (bytesRead > 0U)
{
    ss.write(buffer, (long long)bytesRead);
    stream->Read(buffer, 100, &bytesRead);
}
stream.Release();
string resultString = ss.str(); 
```

我只是想出了如何做到这一点，因为我想要一个简单的 API 访问脚本，像 libcurl 这样的库给我带来了各种各样的问题（即使我遵循了指示......），而 WinSock 太低级和复杂了.

我不太确定所有的[IStream](https://docs.microsoft.com/en-us/windows/desktop/api/objidl/nn-objidl-istream)阅读代码（特别是 while 条件 - 随时更正/改进），但是嘿，**它可以工作**，无忧无虑！（这对我来说很有意义，因为我使用了[阻塞（同步）调用](https://docs.microsoft.com/en-us/previous-versions/windows/internet-explorer/ie-developer/platform-apis/ms775127%28v%3Dvs.85%29)，这很好，在流（ [ISequentialStream](https://docs.microsoft.com/en-us/windows/desktop/api/objidl/nf-objidl-isequentialstream-read)？）完成读取`bytesRead`之前，它总是 > 0U ，但谁知道。）

另请参阅：[URL Monikers 和异步可插入协议参考](https://docs.microsoft.com/en-us/previous-versions/windows/internet-explorer/ie-developer/platform-apis/ms774965%28v%3Dvs.85%29 "URL Monikers 和异步可插入协议参考")

* * *

## 回答 #13

> 赞同：7
> 
> 时间：2018-10-26T12:22:48.133

以下是一些无需使用任何第三方库即可工作的代码：首先定义您的网关、用户、密码和您需要发送到此特定服务器的任何其他参数。

```
#define USERNAME "user"
#define PASSWORD "your password"
#define GATEWAY "your gateway" 
```

这是代码本身：

```
HINTERNET hOpenHandle, hResourceHandle, hConnectHandle;
const TCHAR* szHeaders = _T("Content-Type:application/json; charset=utf-8\r\n");

hOpenHandle = InternetOpen(_T("HTTPS"), INTERNET_OPEN_TYPE_DIRECT, NULL, NULL, 0);
if (hOpenHandle == NULL)
{
    return false;
}

hConnectHandle = InternetConnect(hOpenHandle,
    GATEWAY,
    INTERNET_DEFAULT_HTTPS_PORT,
    NULL, NULL, INTERNET_SERVICE_HTTP,
    0, 1);

if (hConnectHandle == NULL)
{
    InternetCloseHandle(hOpenHandle);
    return false;
}

hResourceHandle = HttpOpenRequest(hConnectHandle,
    _T("POST"),
    GATEWAY,
    NULL, NULL, NULL, INTERNET_FLAG_SECURE | INTERNET_FLAG_KEEP_CONNECTION,
    1);

if (hResourceHandle == NULL)
{
    InternetCloseHandle(hOpenHandle);
    InternetCloseHandle(hConnectHandle);
    return false;
}

InternetSetOption(hResourceHandle, INTERNET_OPTION_USERNAME, (LPVOID)USERNAME, _tcslen(USERNAME));
InternetSetOption(hResourceHandle, INTERNET_OPTION_PASSWORD, (LPVOID)PASSWORD, _tcslen(PASSWORD));

std::string buf;
if (HttpSendRequest(hResourceHandle, szHeaders, 0, NULL, 0))
{
    while (true)
    {
        std::string part;
        DWORD size;
        if (!InternetQueryDataAvailable(hResourceHandle, &size, 0, 0))break;
        if (size == 0)break;
        part.resize(size);
        if (!InternetReadFile(hResourceHandle, &part[0], part.size(), &size))break;
        if (size == 0)break;
        part.resize(size);
        buf.append(part);
    }
}

if (!buf.empty())
{
    // Get data back
}

InternetCloseHandle(hResourceHandle);
InternetCloseHandle(hConnectHandle);
InternetCloseHandle(hOpenHandle); 
```

这应该适用于 Win32 API 环境。

这是一个[例子](https://www.codeproject.com/Articles/1265615/Sending-WhatsApp-messages-from-a-Win32-cplusplus-p)。

* * *

## 回答 #14

> 赞同：5
> 
> 时间：2016-08-15T05:20:44.963

HTTP协议很简单，所以写一个HTTP客户端也很简单。这是一个

[https://github.com/pedro-vicente/lib_netsockets](https://github.com/pedro-vicente/lib_netsockets)

它使用 HTTP GET 从 Web 服务器检索文件，服务器和文件都是命令行参数。远程文件保存到本地副本。

免责声明：我是作者

检查 http.cc [https://github.com/pedro-vicente/lib_netsockets/blob/master/src/http.cc](https://github.com/pedro-vicente/lib_netsockets/blob/master/src/http.cc)

```
int http_client_t::get(const char *path_remote_file)
{
  char buf_request[1024];

  //construct request message using class input parameters
  sprintf(buf_request, "GET %s HTTP/1.1\r\nHost: %s\r\nConnection: close\r\n\r\n", path_remote_file, m_server_ip.c_str());

  //send request, using built in tcp_client_t socket
  if (this->write_all(buf_request, (int)strlen(buf_request)) < 0)
  {
    return -1;
  } 
```

编辑：编辑的网址

* * *

## 回答 #15

> 赞同：4
> 
> 时间：2009-07-10T09:51:25.723

C 和 C++ 没有用于 HTTP 甚至用于套接字连接的标准库。多年来，已经开发了一些可移植的库。正如其他人所说，使用最广泛的是[libcurl](http://curl.haxx.se/libcurl/)。

这是libcurl 的替代品[列表](http://curl.haxx.se/libcurl/competitors.html)（来自 libcurl 的网站）。

此外，对于 Linux，[这](http://coding.debuntu.org/c-linux-socket-programming-tcp-simple-http-client)是一个简单的 HTTP 客户端。您可以实现自己的简单 HTTP GET 客户端，但如果涉及身份验证或重定向，或者您需要在代理后面工作，这将不起作用。对于这些情况，您需要一个成熟的库，例如 libcurl。

对于带有 libcurl 的源代码，[这](http://curl.haxx.se/lxr/source/docs/examples/htmltitle.cc)是最接近您想要的（Libcurl 有很多[示例](http://curl.haxx.se/libcurl/c/example.html)）。看主函数。成功连接后，html 内容将被复制到缓冲区。只需将 parseHtml 替换为您自己的函数即可。

* * *

## 回答 #16

> 赞同：4
> 
> 时间：2014-11-11T17:45:30.440

这是一些（相对）简单的 C++11 代码，它使用 libCURL 将 URL 的内容下载到`std::vector<char>`：

### http_download.hh

```
# pragma once

#include <string>
#include <vector>

std::vector<char> download(std::string url, long* responseCode = nullptr); 
```

### http_download.cc

```
#include "http_download.hh"

#include <curl/curl.h>
#include <sstream>
#include <stdexcept>

using namespace std;

size_t callback(void* contents, size_t size, size_t nmemb, void* user)
{
  auto chunk = reinterpret_cast<char*>(contents);
  auto buffer = reinterpret_cast<vector<char>*>(user);

  size_t priorSize = buffer->size();
  size_t sizeIncrease = size * nmemb;

  buffer->resize(priorSize + sizeIncrease);
  std::copy(chunk, chunk + sizeIncrease, buffer->data() + priorSize);

  return sizeIncrease;
}

vector<char> download(string url, long* responseCode)
{
  vector<char> data;

  curl_global_init(CURL_GLOBAL_ALL);
  CURL* handle = curl_easy_init();
  curl_easy_setopt(handle, CURLOPT_URL, url.c_str());
  curl_easy_setopt(handle, CURLOPT_WRITEFUNCTION, callback);
  curl_easy_setopt(handle, CURLOPT_WRITEDATA, &data);
  curl_easy_setopt(handle, CURLOPT_USERAGENT, "libcurl-agent/1.0");
  CURLcode result = curl_easy_perform(handle);
  if (responseCode != nullptr)
    curl_easy_getinfo(handle, CURLINFO_RESPONSE_CODE, responseCode);
  curl_easy_cleanup(handle);
  curl_global_cleanup();

  if (result != CURLE_OK)
  {
    stringstream err;
    err << "Error downloading from URL \"" << url << "\": " << curl_easy_strerror(result);
    throw runtime_error(err.str());
  }

  return data;
} 
```

* * *

## 回答 #17

> 赞同：4
> 
> 时间：2016-02-19T12:18:20.317

您可以使用[EmbeddedRest](https://github.com/fnc12/embeddedRest/)库。它是轻量级的仅头文件库。因此很容易将其包含到您的项目中，并且不需要编译，因为其中没有`.cpp`文件。

`readme.md`从 repo请求示例：

```
#include "UrlRequest.hpp"

//...

UrlRequest request;
request.host("api.vk.com");
const auto countryId = 1;
const auto count = 1000;
request.uri("/method/database.getCities",{
    { "lang", "ru" },
    { "country_id", countryId },
    { "count", count },
    { "need_all", "1" },
});
request.addHeader("Content-Type: application/json");
auto response = std::move(request.perform());
if (response.statusCode() == 200) {
  cout << "status code = " << response.statusCode() << ", body = *" << response.body() << "*" << endl;
}else{
  cout << "status code = " << response.statusCode() << ", description = " << response.statusDescription() << endl;
} 
```

* * *

## 回答 #18

> 赞同：3
> 
> 时间：2019-05-15T16:34:34.947

如果您正在寻找一个支持多个平台（Linux、Windows 和 Mac）的 C++ HTTP 客户端库来使用 Restful Web 服务。您可以有以下选项。

1.  [QT Network Library](https://doc.qt.io/qt-5/qnetworkaccessmanager.html) - 允许应用程序发送网络请求和接收回复
2.  [C++ REST SDK](https://github.com/Microsoft/cpprestsdk) - 一个新兴的第三方 HTTP 库，支持 PPL
3.  [Libcurl](http://curl.haxx.se/libcurl/) - 它可能是原生世界中最常用的 http lib 之一。

* * *

## 回答 #19

> 赞同：2
> 
> 时间：2014-02-12T04:32:48.947

一般来说，我会推荐一些跨平台的东西，比如 cURL、POCO 或 Qt。但是，这是一个 Windows 示例！：

```
#include <atlbase.h>
#include <msxml6.h>
#include <comutil.h> // _bstr_t

HRESULT hr;
CComPtr<IXMLHTTPRequest> request;

hr = request.CoCreateInstance(CLSID_XMLHTTP60);
hr = request->open(
    _bstr_t("GET"),
    _bstr_t("https://www.google.com/images/srpr/logo11w.png"),
    _variant_t(VARIANT_FALSE),
    _variant_t(),
    _variant_t());
hr = request->send(_variant_t());

// get status - 200 if succuss
long status;
hr = request->get_status(&status);

// load image data (if url points to an image)
VARIANT responseVariant;
hr = request->get_responseStream(&responseVariant);
IStream* stream = (IStream*)responseVariant.punkVal;
CImage *image = new CImage();
image->Load(stream);
stream->Release(); 
```

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2017-06-14T01:48:38.777

虽然有点晚了。您可能更喜欢[https://github.com/Taymindis/backcurl](https://github.com/Taymindis/backcurl)。

它允许您在移动 C++ 开发中进行 http 调用。适合手机游戏开发

```
bcl::init(); // init when using

bcl::execute<std::string>([&](bcl::Request *req) {
    bcl::setOpts(req, CURLOPT_URL , "http://www.google.com",
             CURLOPT_FOLLOWLOCATION, 1L,
             CURLOPT_WRITEFUNCTION, &bcl::writeContentCallback,
             CURLOPT_WRITEDATA, req->dataPtr,
             CURLOPT_USERAGENT, "libcurl-agent/1.0",
             CURLOPT_RANGE, "0-200000"
            );
}, [&](bcl::Response * resp) {
    std::string ret =  std::string(resp->getBody<std::string>()->c_str());
    printf("Sync === %s\n", ret.c_str());
});

bcl::cleanUp(); // clean up when no more using 
```

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2021-04-22T04:03:07.167

以上所有答案都有帮助。我的回答只是添加了一些补充：

*   使用 boost beast、[sync](https://www.boost.org/doc/libs/1_70_0/libs/beast/example/http/client/sync/http_client_sync.cpp)示例、[async](https://www.boost.org/doc/libs/1_70_0/libs/beast/example/http/client/async/http_client_async.cpp)示例、[ssl](https://www.boost.org/doc/libs/1_70_0/libs/beast/example/http/client/sync-ssl/http_client_sync_ssl.cpp)示例
*   使用 nghttp2，[例如](https://github.com/nghttp2/nghttp2/blob/master/examples/asio-cl.cc)，它支持 SSL、HTTP/2
*   使用 Facebook [proxygen](https://github.com/facebook/proxygen/blob/master/proxygen/httpclient/samples/curl/CurlClientMain.cpp)，该项目包含 Facebook 使用的核心 C++ HTTP 抽象。它的目标是高性能和并发性。我建议使用 vcpkg 安装它，否则您将难以管理依赖项。它支持 SSL。它还支持一些高级协议：HTTP/1.1、SPDY/3、SPDY/3.1、HTTP/2和HTTP/3

nghttp2 和 proxygen 都是稳定的，可以考虑在生产中使用。

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2015-03-11T09:12:40.967

您可以使用 ACE 来执行此操作：

```
#include "ace/SOCK_Connector.h"

int main(int argc, ACE_TCHAR* argv[])
{
    //HTTP Request Header
    char* szRequest = "GET /video/nice.mp4 HTTP/1.1\r\nHost: example.com\r\n\r\n"; 
    int ilen = strlen(szRequest);

    //our buffer
    char output[16*1024];

    ACE_INET_Addr server (80, "example.com");
    ACE_SOCK_Stream peer;
    ACE_SOCK_Connector connector;
    int ires = connector.connect(peer, server);
    int sum = 0;
    peer.send(szRequest, ilen);
    while (true)
    {
        ACE_Time_Value timeout = ACE_Time_Value(15);
        int rc = peer.recv_n(output, 16*1024, &timeout);
        if (rc == -1)
        {
            break;
        }
        sum += rc;
    }
    peer.close();
    printf("Bytes transffered: %d",sum);

    return 0;
} 
```

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2020-08-17T19:57:27.583

MS 的 CppRest SDK 是我刚刚发现的，大约 1/2 小时后，我的第一个简单的 Web 服务调用开始工作。与这里提到的其他人相比，即使经过数小时的查看，我什至无法安装任何东西，我会说它非常令人印象深刻

[https://github.com/microsoft/cpprestsdk](https://github.com/microsoft/cpprestsdk)

向下滚动并单击文档，然后单击入门教程，您将立即运行一个简单的应用程序。

# java - 比较数组中的元素是否存在重复项

> ID：1011344
> 
> 赞同：5
> 
> 时间：2009-06-18T07:54:12.147
> 
> 标签：java, arrays

我正在尝试`int`在 Java 中生成一个 5 位数组，但在从哪里开始时遇到了麻烦。数组中的任何数字都不能重复。我可以为其生成随机数，但无法弄清楚如何将数字相互比较并替换任何重复项。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-06-18T07:57:29.487

您可以使用 java.util.Set 而不是数组，因为它保证只有唯一的元素。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-06-18T08:09:48.870

如果我理解正确，你想要一个随机的 5 位数字，没有数字重复？

如果是这样，一种方法是打乱数字 0-9 的列表，然后选择前 5 个元素。

**编辑**

```
Integer[] digits = {0, 1, 2, 3, 4, 5, 6, 7, 8, 9};
Random random = new Random();

public Integer[] generateId() {
    List<Integer> id = Arrays.asList(digits);
    Collections.shuffle(id, random);
    return id.subList(0, 5).toArray(new Integer[0]);
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-06-18T08:46:57.580

这会在 O（位数）中生成它，没有内部循环，没有洗牌 <- 如果选择的数量变得非常大，这可能会很昂贵

```
int[] digits = { 0, 1, 2, 3, 4, 5, 6, 7, 8, 9 };
Random random = new Random();

int[] generateId() {
    int[] choices = digits.clone();
    int[] id = new int[5];

    for (int i = 0; i < 5; i++) {
        // one less choice to choose from each time
        int index = random.nextInt(choices.length - i);
        id[i] = choices[index];
        // "remove" used item by replacing it with item at end of range
        // because that index at the end won't be considered in next round
        choices[index] = choices[choices.length - i - 1];
    }

    return id;
} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-06-18T08:03:29.507

您可以通过将数组转换为 TreeSet 来消除重复项（这也会对它们进行排序）：

```
int numbers[] { 4 5 7 6 5 7 5 89 847 7 94 093 02 10 11 10 11 };
TreeSet set new TreeSet(Arrays.asList(numbers));
for (int no : set)
  System.out.println(no); 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-06-18T08:51:22.127

作为替代方案，只需对数组进行排序并对其进行迭代。

```
 List<int> myList = new List<int>() { 1, 1, 2, 3, 4, 5, 5, 7 , 1, 7};
    myList.Sort();
    for (int i = myList.Count - 1; i > 0; i--)
    {
        if (myList[i] == myList[i - 1])
            myList.RemoveAt(i);
    } 
```

但当然，最好不要一开始就有任何重复。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-06-18T08:01:25.113

尝试这个：

```
int[] digits = { 0, 1, 2, 3, 4, 5, 6, 7, 8, 9 };
Random random = new Random();

int[] generateId() {
    int[] clone = digits.clone();
    int[] id = new int[5];

    for (int i = 0; i < 5; i++) {
        int candidate;

        do {
            candidate = random.nextInt(10);
        } while (clone[candidate] == -1);

        id[i] = clone[candidate];
        clone[candidate] = -1;
    }

    return id;
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-06-18T21:28:01.000

首先，我要感谢大家的帮助，我真的很感激。

我让这个程序按照我想要的方式工作，但似乎应该有一个更简单的方法。这就是我所做的。任何更多的评论都会很棒。

```
do
    {
        for (int i = 0; i < 5; i++) 
        {
            iNumber = generator.nextInt(9) + 1;
            numbers[i] = iNumber;
        }
    }
    while(numbers[0] == numbers[1] || numbers[0] == numbers[2] || numbers[0] == numbers[3] || numbers[0] == numbers[4] || numbers[1] == numbers[2] || numbers[1] == numbers[3] || numbers[1] == numbers[4] || numbers[2] == numbers[3] || numbers[2] == numbers[4] || numbers[3] == numbers[4]); 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2014-05-07T10:53:39.697

```
/**
 * findDuplicate method return map where key is unique no and value as the
 * repitation
 * 
 * @param a
 *            : arrays of Objects
 * @return map
 */
public Map findDuplicate(T[] a) {
    Map<T, Integer> map = new HashMap<T, Integer>();
    Set<T> unique = new HashSet<T>(Arrays.asList(a));
    int count = 0;
    for (T integer : unique) {
        for (T integer1 : a) {
            if (integer == integer1) {
                ++count;
            }
        }
        map.put(integer, count);
        count = 0;
    }

    return map;
} 
```

# oracle - abt oracle procedure agv 并从 oracle 的过程中删除 csv 文件

> ID：1011346
> 
> 赞同：0
> 
> 时间：2009-06-18T07:55:36.713
> 
> 标签：oracle

嗨，你能给我信息 abt 我们如何将 arg 传递给 oracle 程序
我如何从 oracle 程序中删除 csv 文件

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-18T08:14:26.257

您可以使用 UTL_FILE 包与位于服务器上的系统文件进行交互。您应该阅读[文档](http://download-uk.oracle.com/docs/cd/B19306_01/appdev.102/b14258/u_file.htm#BABGGEDF "UTL_FILE 10gr2")以了解如何设置您的环境。一旦你在 oracle 中创建了你想要访问的目录（这里命名为`DIR`），这个[命令](http://download-uk.oracle.com/docs/cd/B19306_01/appdev.102/b14258/u_file.htm#i1003602 "utl_file.fremove")将删除一个文件：

```
utl_file.fremove('DIR', 'FILE_NAME'); 
```

# windows-vista - 迁移到 64 位 Vista 时的一般陷阱？

> ID：1011349
> 
> 赞同：0
> 
> 时间：2009-06-18T07:55:56.137
> 
> 标签：windows-vista, 64-bit

首先，我在 32 位 Windows XP 系统上使用 Visual Studio 2008。我有第二个 32 位 Vista 系统，但不用于开发。我刚刚订购了一台新的开发计算机，它将使用 64 位 Vista。（暂时不想要 Windows 7，但如果它具有良好的市场价值，可能会在两年内升级到 Windows 7。）（顺便说一句，英特尔至强四核，12 GB RAM，1.3 TB 磁盘空间超过 2 个磁盘。）我知道大多数 32 位应用程序都可以正常工作，包括 VS 和其他一些应用程序。反正我也不太担心这个。我也使用 Delphi 2007 进行开发，但也不担心这一点。但我确实想考虑到这一点：

*在这个新的 64 位系统上，我可以开始开发 64 位应用程序。这对我来说是新的，那么当我开始开发新的 64 位应用程序时，我需要避免哪些最常见的陷阱？*例如，不同大小的数据类型、可能不同的文件系统、我需要注意的特殊 64 位函数、当我必须将 64 位代码与 32 位程序集组合时可能发生冲突，等等

（我已经知道了：在开发 Web 应用程序时，我需要确保我的虚拟主机支持 64 位应用程序，否则没有用......显然，IIS 似乎无法同时支持 64 位和 32 -bits 应用程序，所以这是一个陷阱。）

我不会将 32 位应用程序移植到 64 位应用程序。我只想创建*新*的 64 位应用程序。从头开始！所以没有任何 32 位历史。我也读过这个[未回答的警告](https://stackoverflow.com/questions/473546/vista-64-bit-development-caveats)问题，但更多的是关于迁移。我不会迁移任何东西。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-25T13:36:20.647

自 11 月以来，我一直在使用 64 位 Vista 系统，几乎没有问题。到目前为止最糟糕的是，在 Visual Studio 中，要在 SSIS 中调试脚本任务，您必须告诉它不要使用 64 位运行时。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-25T14:07:06.950

至少对于桌面应用程序来说，部署令人头疼。

由于某种原因，特殊文件夹有所不同。

在 Visual Studio 中编辑并继续仅在编译为 32 位时有效。

您可能会发现一些可能需要永远解决的晦涩问题。

# mysql - mysql备份保留关系

> ID：1011351
> 
> 赞同：0
> 
> 时间：2009-06-18T07:56:16.213
> 
> 标签：mysql, backup, mysqldump, database-backups

我想知道如何从 2 个单独的表（CATEGORIES 和 SUBCATEGORIES，其中 SUBCATEGORIES 属于一个 CATEGORY）中备份我的数据，以便以后可以恢复关系。我不确定是否`mysqldump --opt db_name`足够。

例子：

分类：

```
| ID | name
-----------
| 1  | Audio
| 9  | Video 
```

子类别：

```
| ID | category_id | name
-------------------------
| 1  | 1           | Guitar
| 2  | 1           | Piano
| 3  | 9           | Video Camera 
```

谢谢

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-18T08:03:38.993

***mysqldump*就足够了**

它将生成重建数据库所需的 SQL 代码，并且由于关系不是特殊数据（只是表之间的*逻辑重合*），因此备份数据库就足够了。即使使用不带*--opt*参数的 mysqldump ，它也会添加索引定义，因此约束将保持不变

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-18T08:00:54.847

mysqldump 默认添加创建表命令并保存关系。

# php - 将 CodeIgniter（或任何 PHP 项目）部署到实时站点？

> ID：1011363
> 
> 赞同：1
> 
> 时间：2009-06-18T07:59:34.350
> 
> 标签：php, svn, version-control, deployment, codeigniter

将 CodeIgniter 项目（或任何 PHP 项目）从本地机器部署到实时站点的理想方式是什么？很长一段时间以来，我一直在使用 subversion 从实时站点检查和更新代码。但是也有人说这种做法不好，因为您不需要实时站点中的 svn 元数据。我还阅读了几篇使用 Capitrano 部署 PHP 项目的文章。您在 PHP 项目部署方面的实践是什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-18T08:07:39.937

我使用 Phing 来满足我所有的建筑需求。

我已经创建了几个任务，例如 prod、staging、debug。当我想将所有数据推送到我的生产服务器时，我只使用*phing prod*。这将检查我的 repo 中的所有代码，进行一些配置更改，通过 minifier 等运行所有静态文件，如 css 和 javascript。

有关 Phing 的更多信息：

[Phing.info](http://phing.info "官方网站")

[http://www.slideshare.net/hozn/phing-building-with-php](http://www.slideshare.net/hozn/phing-building-with-php "很棒的幻灯片")

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-18T14:21:10.977

我问了一个类似的问题，很多人似乎喜欢 Phing：

[您首选的 php 部署策略是什么？](https://stackoverflow.com/questions/425692/what-is-your-preferred-php-deployment-strategy)

我看了看，配置文件非常吓人。我有兴趣听到更多关于这个主题的信息。

# unit-testing - 教 emacs 识别 Boost.Test 错误

> ID：1011364
> 
> 赞同：0
> 
> 时间：2009-06-18T07:59:36.863
> 
> 标签：unit-testing, emacs, boost

这是测试用例失败时 Boost.Test 的输出：

```
bjam 工具集=msvc
...耐心...
...找到 1287 个目标...
...更新 4 个目标...
编译-c-c++ ..\bin\test\Function.test\msvc-8.0\debug\link-static\threading-multi\Function.obj
函数.cpp
msvc.link ..\bin\test\Function.test\msvc-8.0\debug\link-static\threading-multi\Function.exe
msvc.manifest ..\bin\test\Function.test\msvc-8.0\debug\link-static\threading-multi\Function.exe
testing.capture-output ..\bin\test\Function.test\msvc-8.0\debug\link-static\threading-multi\Function.run
====== 开始输出 ======
运行 1 个测试用例...
Function.cpp(26): "FunctionConstruction" 中的致命错误: 关键检查 pf->Name() == "F13" failed [F1 != F13]

*** 在测试套件“foo_test”中检测到 1 个故障
检测到内存泄漏！
倾倒对象 ->
{235} 0x003A7C88 处的普通块，32 字节长。
 数据：00 00 00 00 CD CD CD CD 54 31 00 CD CD CD CD CD
{234} 0x003A7E00 处的普通块，96 字节长。
 数据：00 00 00 00 CD CD CD CD 54 31 00 CD CD CD CD CD
{233} 0x003A7D88 处的普通块，76 字节长。
 数据：F4 D9 45 00 00 00 00 00 CD CD CD CD 00 7E 3A 00
对象转储完成。

退出状态：201
====== 结束输出 ======

```

MSVC 正确解析了这个错误，所以我可以双击并跳转到代码中。但是 emacs 无法解析这个输出。怎么教呢？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-18T13:12:05.033

该解决方案将涉及自定义变量：`'compilation-error-regexp-alist`, `'compilation-error-regexp-alist-alist`, `'compilation-directory-matcher`.

第一个，`'compilation-error-regexp-alist`只是一个符号列表，告诉编译模式在第二个变量“compilation-error-regexp-alist-alist”中查找什么，所以你可能只需要为 boost 添加一些东西：

```
(add-to-list 'compilation-error-regexp-alist 'boost) 
```

然后，要使其工作，您需要将列表添加到第二个变量`'compilation-error-regexp-alist-alist`. 这是它开始变得棘手的地方。您需要阅读第一个变量的文档才能正确使用正则表达式，但它类似于：

```
(add-to-list 'compilation-error-regexp-alist-alist
         '(boost
           "^\\(.*\\)(\\([0-9]+\\)): fatal error in" 1 2)) 
```

正则表达式匹配错误行，1 和 2 指定子表达式，分别指定文件名和行号。您还可以指定其他内容（请参阅文档）。

虽然，老实说，上述两个设置可能是不必要的，因为我很确定现有的正则表达式之一将匹配格式。目录跟踪确实存在问题。

最后一个变量，`'compilation-directory-matcher' 是让下一个错误跟踪在哪里找到文件的变量。所以需要适当更新。它看起来不像 boost 测试吐出 Emacs 寻找的有点标准的“进入目录......”，但信息似乎在编译行中......

您也可以尝试在 boost 用户邮件列表中询问是否有人解决了这个问题。可以在[此处](http://lists.boost.org/mailman/listinfo.cgi/boost-users)找到邮件列表。

# asp.net - Urlrewritten 页面上的 IIS 6 压缩不起作用

> ID：1011370
> 
> 赞同：0
> 
> 时间：2009-06-18T08:01:39.900
> 
> 标签：asp.net, iis, url-rewriting, compression

我正在开发一个 asp.net 站点（运行 .net 3.5 SP 1）并使用 UrlRewriter.Net（[http://urlrewriter.net/](http://urlrewriter.net/)）进行 urlrewriting。

该站点是 Windows 2003 服务器上的 hostet，包含所有服务包等。

它运行 IIS 6。

为了启用 url 重写，我为 * 设置了一个通配符处理程序，这意味着所有请求都通过 asp.net 引擎发送。

我还启用了 IIS 压缩功能 - 当我使用未重写的 url 时，它工作得很好。但是它不会压缩重写的页面。

我添加了 aspx、ashx 和 asmx 作为 metabase.xml 的扩展，并设置了适当的压缩级别 (9) 等。

重写的页面有.htm 扩展名，所以这不应该是因为扩展名错误。

任何想法为什么这不起作用？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-18T08:06:29.143

可能是因为通配符，IIS 将请求发送到 ASP.NET，后者进一步处理页面生成等。压缩发生在管道的后期，所以它被绕过了......

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-18T08:52:15.650

不幸的是，我没有足够的代表发表评论。

如果问题是压缩发生在管道中的错误时间，我希望它也不适用于 .aspx（因为所有内容都是通过 asp.net 处理程序发送的）

话虽如此，我想它可以在管道的早期处理 .aspx，因为我相信通配符处理程序是“最后的手段”。不幸的是，在 IIS 6 上没有改变处理程序的优先级:-(

我想我将不得不向我们的管理员询问一个带有 IIS 7 的 Windows 2008 服务器。

# c# - 如何杀死在特定用户帐户下运行的特定进程

> ID：1011371
> 
> 赞同：2
> 
> 时间：2009-06-18T08:02:18.107
> 
> 标签：c#, windows

如何杀死在特定用户帐户下运行的特定进程。使用 C#？

谢谢，

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-06-18T08:06:45.570

```
var processes = from p in Process.GetProcessesByName(nameOfTheProcess)
                where p.StartInfo.UserName == nameOfTheUser
                select p;

foreach(Process p in processes) p.Kill(); 
```

编辑：正如 Fredrik 指出的那样，没有为 GetProcesses 获得的进程设置 UserName 属性。这是一个使用 WMI 获取用户名的修改版本（GetProcessOwner 方法在[这里](http://benreichelt.net/blog/2006/01/31/get-process-user-name/)找到）：

```
static void KillProcessByNameAndUserName(string processName, string userName)
{
    var processes = from p in Process.GetProcessesByName(processName)
                    where GetProcessOwner(p.Id) == userName
                    select p;

    foreach(Process p in processes) p.Kill();
}

static string GetProcessOwner(int processId)
{

    string query = “Select * From Win32_Process Where ProcessID = “ + processId;
    ManagementObjectSearcher searcher = new ManagementObjectSearcher(query);
    ManagementObjectCollection processList = searcher.Get();

    foreach (ManagementObject obj in processList)
    {
        string[] argList = new string[] { string.Empty };
        int returnVal = Convert.ToInt32(obj.InvokeMethod(“GetOwner”, argList));
        if (returnVal == 0)
            return argList[0];
    }

    return “NO OWNER”;

} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-18T10:46:26.013

为了获取用户名，您必须从 Win32 API 中获取进程的安全上下文。

通过 P/Invoke 调用 OpenProcessToken() 函数，使用上面已有代码的 .Net Process 类中的进程句柄。您将获得一个包含进程所有者的 SID 的结构。为诸如拒绝访问之类的错误做好准备，因为您可能没有访问权限来获取所有进程的此信息，例如那些不属于您的进程。从那里，您必须将 SID 转换为名称。有几种方法可以做到这一点，但 LookupAccountSid() 函数（同样，通过 P/Invoke）将为您获取用户名。

在框架 2.0 中，添加了很多东西来帮助处理安全描述符（System.Security.AccessControl 命名空间），但是，我没有看到任何可以帮助您处理那里的 P/Invoke 复杂性的东西。

有关从 C# 使用 Win32 API 的信息，请参阅[pinvoke.net](http://www.pinvoke.net/)。

# visual-studio-2008 - AjaxControlToolkit 资源文件未复制到 MSBuild 脚本中的输出

> ID：1011373
> 
> 赞同：0
> 
> 时间：2009-06-18T08:03:06.637
> 
> 标签：visual-studio-2008, msbuild, ajaxcontroltoolkit, web-applications, resource-files

我是 MSBuild 的新手，但我设法设置了以下简单脚本：

```
<Project ToolsVersion="3.5" DefaultTargets="Compile" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
    <PropertyGroup>
        <Configuration Condition="'$(Configuration)' == ''">Debug</Configuration>
    </PropertyGroup>
    <ItemGroup>
        <SolutionRoot Include=".." />
        <BuildArtifacts Include=".\Artifacts\" />
        <SolutionFile Include="..\SolutionName.sln" />
    </ItemGroup>
    <Target Name="Clean">
        <RemoveDir Directories="@(BuildArtifacts)" />
    </Target>
    <Target Name="Init" DependsOnTargets="Clean">
        <MakeDir Directories="@(BuildArtifacts)" />
    </Target>
    <Target Name="Compile" DependsOnTargets="Init">
        <MSBuild Projects="@(SolutionFile)" Properties="OutDir=%(BuildArtifacts.FullPath);Configuration=$(Configuration)" />
        <MakeDir Directories="%(BuildArtifacts.FullPath)\_PublishedWebsites\RDE.XAP.UnifiedGui.Web\Temp" />
    </Target>
</Project> 
```

该解决方案有 23 个项目，其中 4 个是 WebApp。现在，脚本工作正常并且输出正确生成。我反驳的唯一问题是解决方案中有两个使用 AJAX 控制工具包的 WebApp 项目。该工具包有一组包含本地化资源的文件夹（例如*ar*、*it*、*es*、*fr ）。*在 MSBuild 中构建解决方案时，这些文件夹不会复制到 WebApps 的*bin*目录中，但在 Visual Studio 中构建时会复制它们。

我怎样才能以干净的方式解决这个问题？我知道我可以编写一个（相当复杂的）任务，在编译后复制目录，但这对我来说似乎不是正确的解决方案。此外，Google、SO 和 MSDN 都无法提供有关此类问题的更多详细信息。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2010-04-21T19:09:21.530

Make sure the ajaxcontroltoolkit.dll from the bin directory was added to your source control repository. (ie SVN, GIT, CNV, etc.)

# oracle - 自定义 Oracle AWR 报告

> ID：1011380
> 
> 赞同：1
> 
> 时间：2009-06-18T08:05:01.610
> 
> 标签：oracle, awr, statspack

Oracle 创建了 HTML 格式的工作负载报告 (AWR)，其中列出了实例统计信息、等待事件、前十个繁重的 SQL 语句（按执行次数、磁盘读取次数等）。

是否有（简单的）方法来自定义此报告？

例如，我想要前 25 个 SQL，而不是前 10 个。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-18T11:54:40.273

查看 $ORACLE_HOME/rdbms/admin 中的 awr*.sql 文件 - 它们是生成报告的文件。我已经复制了这些文件并对其进行了调整以更改报告以供我自己使用。

[编辑]

在我最初的回答之后，我想到您可能只对修改此报告中的 top-N 参数感兴趣 - 这是通过 DBMS_WORKLOAD_REPOSITORY.MODIFY_SNAPSHOT_SETTINGS 包来修改快照收集参数的。

# c++ - < & > 转换为 > < 等

> ID：1011392
> 
> 赞同：0
> 
> 时间：2009-06-18T08:07:56.783
> 
> 标签：c++, xml, msxml

我正在使用 MSXMl 库来解析 xml

在我调用 put_text 然后 get_xml

输出将 < & > 转换为`&lt;`& `&gt;`

我怎样才能摆脱这个？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-18T08:09:10.213

< 和 > 禁止在文本内部使用，需要编码为 > 和 <。避免这种情况的唯一方法是为包含这些内容的文本创建一个 CDATA 部分。但是，如果您打算使用 MS XML 阅读 XMLT，您真的不需要 - 它会很好地解码这些符号，并且您会在提取的文本中得到完美的 < 和 >。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-06-18T08:18:58.960

好吧，您正在从纯文本转换为 XML 编码文本。
这是我所期望的行为。

如果您想要输入的原始字符串，请尝试使用 get_text() 转换回文本。

如果您不希望 put_text() 在不编码 < 和 > 的情况下对文本进行编码，那么它必须位于 CData 部分内。

```
<![CDATA[    Text that can include < and > without encoding  ]]> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-18T08:11:30.660

你得到`&lt`或`&lt;`？

它们的末尾应该有一个分号才能成为有效实体。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-18T08:52:34.900

如果您希望将其作为文本包含在内，则可以对其进行转义。每个 xml 解析器都会对文本进行转义。

如果您希望它作为 xml 元素，则不能使用 put_text 创建它们，但需要以这种方式创建树

```
dataNode=xmlDoc.createElement("data")

idNode=xmlDoc.createElement("id")
textNode=xmlDoc.createTextNode("17")
idNode.appendChild(textNode)
nameNode=xmlDoc.createElement("name")
textNode=xmlDoc.createTextNode("Uday")
nameNode.appendChild(textNode)
...

dataNode.appendChild(idNode)
dataNode.appendChild(nameNode)
...

parentNode.appendChild(dataNode) 
```

如果您用眼睛观察并希望将文本写在您可以使用 cdata 部分的文件上，那么看起来会更好。

```
newCDATA=xmlDoc.createCDATASection("<data><id>17</id>...</data>")
parentNode.appendChild(newCDATA) 
```

# snmp - 如何注册一个新的 MIB 模块？

> ID：1011409
> 
> 赞同：1
> 
> 时间：2009-06-18T08:11:36.620
> 
> 标签：snmp, mib

对于那些尝试使用 net-snmp 库的人，如何添加新的 mib 模块？到目前为止，我所做的是使用 mib2c 命令生成模板 newmodule.c 和 newmodule.h 文件。现在，我不知道在启动 net-snmp 应用程序期间在哪里放置 init_newmodule() 函数来注册新的 mib？

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-10-05T22:46:36.873

在您的 snmpd.conf 中，添加：

```
dlmod myNewModule /path/to/libnewmodule.so 
```

这将加载 libnewmodule.so 并调用 init_myNewModule()。

# java - 如何根据大小将两个数组列表排序为一个新的数组列表

> ID：1011410
> 
> 赞同：0
> 
> 时间：2009-06-18T08:11:49.770
> 
> 标签：java

我有两个对象，每个对象都有一个 id 和一个列表。我想要第三个数组列表根据列表大小对这个对象进行排序。并且仍然有对应的 id 和列表

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-18T08:40:15.220

这是方法：

1.  创建一个[`Comparator`](http://java.sun.com/javase/6/docs/api/java/util/Comparator.html)可以比较两个“id/list 对”的对象——在这种情况下，我们比较列表组件的列表大小。

2.  创建[`ArrayList`](http://java.sun.com/javase/6/docs/api/java/util/ArrayList.html)这些“id/list 对”中的一个。

3.  使用[`Collections.sort`](http://java.sun.com/javase/6/docs/api/java/util/Collections.html#sort(java.util.List,%20java.util.Comparator))方法对 进行排序`ArrayList`，根据`Comparator`。

如果我理解正确，有一个 id/list 对。这是我做的一个：

```
class IdListPair {
  int id;
  List<?> list;

  IdListPair(int id, List<?> list) {
    this.id = id;
    this.list = list;
  }

  public String toString() {
    return "id: " + id + "; list: " + list;
  }
} 
```

提供`IdListPair`了一个构造函数来创建 id/list 对，以及一个`toString`稍后将用于显示排序结果的方法。

然后，我们将有一个部分创建一个`ArrayList`，并使用 a 对列表进行排序`Comparator`：

```
List<IdListPair> pairList = new ArrayList<IdListPair>();
pairList.add(new IdListPair(0, Arrays.asList(1, 2, 3)));
pairList.add(new IdListPair(1, Arrays.asList(1)));
pairList.add(new IdListPair(2, Arrays.asList(1, 2)));

System.out.println("Before: " + pairList);

Collections.sort(pairList, new Comparator<IdListPair>() {
  public int compare(IdListPair o1, IdListPair o2) {
    return o1.list.size() - o2.list.size();
  }

  public boolean equals(Object o) {
    return false;
  }
});

System.out.println("After: " + pairList); 
```

起初，`ArrayList`创建了`IdListPair`一个具有不同长度列表的列表。

然后，该[`Collections.sort`](http://java.sun.com/javase/6/docs/api/java/util/Collections.html#sort(java.util.List,%20java.util.Comparator))方法根据提供的规则进行排序[`Comparator`](http://java.sun.com/javase/6/docs/api/java/util/Collections.html#sort(java.util.List,%20java.util.Comparator))。实现类`Comparator`需要提供[`compare`](http://java.sun.com/javase/6/docs/api/java/util/Comparator.html#compare(T,%20T))和[`equals`](http://java.sun.com/javase/6/docs/api/java/util/Comparator.html#equals(java.lang.Object))方法。

在这里，创建了一个`Comparator`，因此它将比较每个对象在方法中包含[`size`](http://java.sun.com/javase/6/docs/api/java/util/List.html#size())的。该方法是一个虚拟方法，因为它没有在这里使用。`list``IdListPair`[`compare`](http://java.sun.com/javase/6/docs/api/java/util/Comparator.html#compare(T,%20T))`equals`

大部分工作都将花在编写正确的`compare`方法上，因此排序器`Collections.sort`可以正确地对列表进行排序。

结果如下：

```
Before: [id: 0; list: [1, 2, 3], id: 1; list: [1], id: 2; list: [1, 2]]
After: [id: 1; list: [1], id: 2; list: [1, 2], id: 0; list: [1, 2, 3]] 
```

# mfc - 如何获取不包含标题栏和状态栏的基于 CView 的 Windows

> ID：1011411
> 
> 赞同：1
> 
> 时间：2009-06-18T08:11:52.033
> 
> 标签：mfc, dialog, statusbar, titlebar, cview

我正在编写 MFC 应用程序，我选择基于 CView 的应用程序，而不是基于对话框的应用程序。我不知道如何删除标题栏和状态栏，有什么方法可以做到吗？并制作了一个基于 CView 的应用程序，就像基于对话框的应用程序一样？非常感谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-18T14:35:56.313

可以通过删除 MainFrm 类中对 CStatusBar 成员的所有引用来删除状态栏。

标题栏，你是什么意思——菜单、工具栏还是标题栏？前两个通过注释掉 CMainFrm 的 OnCreate() 中的相关部分来删除，最后一个我不是 100%，但我认为你可以通过修改 CMainFrm 的 PreCreateWindow 中的 cs.style 来做到这一点。将样式设置为 WS_DLGFRAME，我认为应该可以。

# apache-flex - Flex：我应该使用什么开源容器组件？

> ID：1011416
> 
> 赞同：1
> 
> 时间：2009-06-18T08:13:33.933
> 
> 标签：apache-flex, components

请帮助我将使用什么容器组件。这是我的问题，我有高级数据网格，其中包含大约 300 x 300 行列的数据（数据可以是图片）。现在我需要一个可以放大/缩小、适应屏幕功能并且可以在内部组件周围拖动的容器，这样我的数据网格就可以在容器周围进行缩放和拖动（便于用户阅读我的数据网格内的内容）。任何适合我需要的容器的建议。谢谢

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-22T22:15:57.353

[http://code.google.com/p/flexlib/wiki/ComponentList](http://code.google.com/p/flexlib/wiki/ComponentList)

也许是 dragscrollCanvas 容器，结合数据网格上的 scaleX/scaleY 事件以响应用于缩放的 mousewheeel 事件？

不确定你到底需要什么...

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-18T16:46:37.273

您可能必须向 AdvandedDataGrid 添加一些功能才能执行此类操作。网格仅渲染当前在屏幕上的单元格（嗯，大部分）以达到不错的性能水平。如果您扩大网格以显示所有单元格，然后将其嵌入到管理滚动等的容器中，则速度可能会慢得令人无法接受。

但是您可以将事件处理程序直接添加到网格中以管理您的新用户手势。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-06-18T15:21:30.683

您需要为您的数据网格字段使用自定义 itemRenderer。那里有一些很棒的教程... [http://www.adobe.com/devnet/flex/quickstart/using_item_renderers/](http://www.adobe.com/devnet/flex/quickstart/using_item_renderers/) [http://www.adobe.com/devnet/flex/articles/itemrenderers_pt1.html](http://www.adobe.com/devnet/flex/articles/itemrenderers_pt1.html)（是系列

如果您知道自己在寻找什么，那么我相信您可以为您的数据网格找到合适的 itemRenderer。

然后使用您的自定义组件，您可以四处移动、缩放等。

如果您正在谈论包含数据网格的容器，请查看 flexlib mdi 容器。这个容器里面可以有其他窗口，然后你可以平铺、层叠、填充等。这也支持拖动。示例：[http](http://www.returnundefined.com/flexmdi/explorer/) ://www.returnundefined.com/flexmdi/explorer/ 网页：[http ://code.google.com/p/flexmdi/](http://code.google.com/p/flexmdi/)

# java - 是否有一种半自动化的方式来为 i18n 执行字符串提取？

> ID：1011423
> 
> 赞同：13
> 
> 时间：2009-06-18T08:17:19.527
> 
> 标签：java, string, internationalization

我们有一个 Java 项目，其中包含大量用于用户提示、错误消息等的英语字符串。我们想将所有可翻译的字符串提取到一个属性文件中，以便以后可以翻译它们。

例如，我们想要替换：

*Foo.java*

```
String msg = "Hello, " + name + "! Today is " + dayOfWeek; 
```

和：

*Foo.java*

```
String msg = Language.getString("foo.hello", name, dayOfWeek); 
```

*语言属性*

```
foo.hello = Hello, {0}! Today is {1} 
```

我知道以完全自动化的方式这样做几乎是不可能的，因为不是每个字符串都应该翻译。但是，我们想知道是否有一种半自动化的方式可以消除一些繁重的工作。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-08-26T11:09:30.113

你想要的是一个工具，它用库调用替换每个涉及字符串连接的表达式，表达式的明显特殊情况只涉及单个文字字符串。

您可以在其中表达所需模式的程序转换系统可以做到这一点。这样的系统接受以下形式的规则：

```
 lhs_pattern -> rhs_pattern  if condition ; 
```

其中模式是对模式变量具有语法类别约束的代码片段。这会导致该工具查找与 lhs_pattern 匹配的语法，如果找到，则替换为 rhs_pattern，其中模式匹配是针对语言结构而不是文本。因此，无论代码格式、缩进、注释等如何，它都能正常工作。

按照您的示例样式绘制一些规则（并过度简化以保持简短）：

```
 domain Java;

  nationalize_literal(s1:literal_string):
    " \s1 " -> "Language.getString1(\s1 )";

  nationalize_single_concatenation(s1:literal_string,s2:term):
    " \s1 + \s2 " -> "Language.getString1(\s1) + \s2"; 

  nationalize_double_concatenation(s1:literal_string,s2:term,s3:literal_string): 
      " \s1 + \s2 + \s3 " -> 
      "Language.getString3(\generate_template1\(\s1 + "{1}" +\s3\, s2);"
   if IsNotLiteral(s2); 
```

模式本身包含在“...”中；这些不是Java字符串文字，而是一种向多计算机语言模式匹配引擎说“...”内的suff是（域）Java代码的方式。元数据用 \ 标记，例如元变量 \s1、\s2、\s3 和嵌入模式调用 \generate 用 ( 和 ) 表示其元参数列表：-}

请注意在元变量 s1 和 s3 上使用语法类别约束以确保仅匹配字符串文字。左侧模式上的元变量匹配的内容在右侧被替换。

子模式 generate_template 是一个过程，它在转换时（例如，当规则触发时）将其已知为常量的第一个参数评估为您建议的模板字符串并插入到您的库中，并返回库字符串索引。请注意，生成模式的第一个参数是此示例完全由连接的文字字符串组成。

显然，有人将不得不手工处理最终在库中的模板化字符串以生成外语等价物。
你是对的，这可能会使代码过度模板化，因为某些字符串不应该放在国有化字符串库中。在您可以为这些情况编写程序检查的范围内，它们可以作为条件包含在规则中以防止它们触发。（稍加努力，您可以将未转换的文本放入注释中，使单个转换更容易在以后撤消）。

实际上，我猜你必须编写 ~~100 条这样的规则来涵盖组合学和感兴趣的特殊情况。回报是您的代码会自动增强。如果做得好，您可以在代码经历多个版本时重复将此转换应用于您的代码；它将不理会以前的国有化表达，而只是修改那些随心所欲的程序员插入的新表达。

一个可以做到这一点的系统是[DMS Software Reengineering Toolkit](http://www.semanticdesigns.com/Products/DMS/DMSToolkit.html)。DMS 可以解析/模式匹配/转换/prettyprint 多种语言，包括 Java 和 C#。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-18T20:49:00.453

Eclipse 将外部化每个单独的字符串，并且不会像您正在寻找的那样自动构建替换。如果您对如何构建字符串有一个非常一致的约定，您可以编写一个 perl 脚本来对 .java 文件进行一些智能替换。但是如果你想处理这个脚本会变得相当复杂

*   字符串味精 = 新字符串（“你好”）；
*   字符串 msg2 = "Hello2";
*   String msg3 = new StringBuffer().append("Hello3").toString();
*   字符串 msg4 = "你好" + 4;
*   等等

我认为有一些付费工具可以帮助解决这个问题。我记得评估过一个，但我不记得它的名字。我也不记得它是否可以处理外部字符串中的变量替换。我将尝试查找信息并使用详细信息编辑此帖子。

**编辑：** 该工具是[Lingport](http://www.lingoport.com/software-internationalization-products/globalyzer)的 Globalyzer。该网站说它支持字符串外部化，但没有具体说明如何。不确定它是否支持变量替换。有一个免费试用版，所以你可以试试看。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-08-25T17:30:36.457

除了生成属性文件[的 Eclipse 的 string externalizer](https://help.eclipse.org/?topic=%2Forg.eclipse.jdt.doc.user%2Freference%2Fref-wizard-externalize-strings.htm&cp=1_4_9_3)之外，Eclipse 还针对非外部化字符串发出警告，这有助于查找尚未国际化的文件。

```
String msg = "Hello " + name; 
```

给出警告“非外部化字符串文字；它应该后跟 //$NON-NLS-$”。对于真正属于代码的字符串，您可以添加注释 ( `@SuppressWarnings("nls")`) 或添加注释：

```
String msg = "Hello " + name; //$NON-NLS-1$ 
```

这对于将项目转换为适当的国际化非常有帮助。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-12-09T23:16:30.987

Globalyzer 具有检测、管理和外部化字符串的广泛功能，并通过查看字符串和逐个外部化显着加快工作速度。您可以过滤字符串，也可以在上下文中查看它们，然后逐个或分批外部化。它适用于多种编程语言和资源类型，当然包括 Java。此外，Globalyzer 为您的国际化项目找到的不仅仅是嵌入式字符串。[您可以在http://lingoport.com/globalyzer](http://lingoport.com/globalyzer)阅读更多内容，那里有注册模拟账户的链接。Globalyzer 最初是为执行大型国际化服务项目而构建的，然后经过多年的发展，它已发展成为一个全面的企业工具，以确保开发获得并保持国际化。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-18T08:19:22.533

我认为eclipse有一些选项可以将所有字符串外部化到一个属性文件中。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-08-26T00:23:11.803

InteliJ idea 是另一个具有此功能的工具。

[![替代文字](../Images/fbd4915fb2f32e2dd98f18d531f12303.png)](https://i.stack.imgur.com/fJoyQ.png)

这是[演示的链接](http://www.jetbrains.com/idea/training/demos/i18n.html)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-08-26T09:54:48.253

您可以使用 Eclipse 中的“外部化字符串”方法。在编辑器中打开您的 Java 文件，然后单击“Source”主菜单中的“Externalize String”。IT 会为您生成一个属性文件，其中包含您在选择中选中的所有字符串。

希望这可以帮助。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-08-28T09:16:43.083

因为每个人都在权衡 IDE 我想我最好支持 Netbeans :)

工具-->国际化-->国际化向导

非常便利..

# linq - linq'范围变量'问题

> ID：1011428
> 
> 赞同：1
> 
> 时间：2009-06-18T08:18:30.600
> 
> 标签：linq, linq-to-sql, null

使用 linq 删除记录时遇到一个奇怪的问题，我怀疑它与范围变量（名为`source`）有关。删除记录后，使用以下语句检索客户的所有目标：

```
var q = from source in unitOfWork.GetRepository<db_Target>().Find()
  where source.db_TargetBase.db_Person.fk_Customer == customerID
  select source.FromLinq(); 
```

FromLinq 在 db_target 上的扩展方法中：

```
public static Target FromLinq(this db_Target source)
{
    return new Target
    {
        id = source.id,
        LastModified = source.db_TargetBase.LastModified,
        ...
     }
} 
```

当一条记录同时被删除`db_Target`和`db_TargetBase`被删除时。例如，当两个用户正在删除记录时，linq 会尝试检索 user2 的记录，该记录已被 user1 删除，导致`LastModified = source.db_TargetBase.LastModified`线路崩溃，因为`db_TargetBase`is `null`。

使用以下代码时，不会出现问题，仅检索未删除的记录：

```
var q = from source in unitOfWork.GetRepository<db_Target>().Find()
    where source.db_TargetBase.db_Person.fk_Customer == customerID
    select new Target
    {
        id = source.id,
        LastModified = source.db_TargetBase.LastModified,
        ...
    }; 
```

这产生了两个问题：

1.  这里发生了什么？我是否正在复制范围变量`source`，因为我在扩展方法中使用它？
2.  如何“包装”`return new Target`代码？我在多个地方使用它，不想每次都复制它。使我的代码更难维护。

TIA,

JJ

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-19T04:50:10.593

在第一组代码中——因为初始化程序是一个不可翻译的方法（扩展或其他），它不能被翻译——所以它在本地运行。

在第二组代码中 - 初始化器由 elementinit 表达式表示，该表达式被翻译（检查/比较生成的 sql 的 select 子句以进行证明）。

* * *

如果你想包装它，你需要一个`Expression<Func<db_Target, Target>>`任何人都可以在他们的查询中抓取和使用的。幸运的是，这很容易做到：

```
public Expression<Func<db_Target, Target>> GetFromLinqExpressionForTarget()
{
  return
    source => new Target
    {
      id = source.id,
      LastModified = source.db_TargetBase.LastModified,
      ...
    }
} 
```

可以这样使用：

```
var FromLinq = GetFromLinqExpressionForTarget();
var q =
(
   from source in ...
   ...
   ...
   select source
).Select(FromLinq); 
```

现在......我真的在这里猜测并且只有大约60％的信心我的答案是正确的。所以如果有人想证实这一点，那会让我很开心。:)

# python - Python中的常见陷阱

> ID：1011431
> 
> 赞同：79
> 
> 时间：2009-06-18T08:19:11.440
> 
> 标签：python

多年后，今天我再次被可变的默认参数所困扰。除非需要，否则我通常不会使用可变的默认参数，但我想随着时间的推移我忘记了这一点。今天在应用程序中，我在 PDF 生成函数的参数列表中添加了 tocElements=[]，现在“目录”在每次调用“生成 pdf”后变得越来越长。:)

我还应该在必须避免的事情清单中添加什么？

*   始终以相同的方式导入模块，例如`from y import x`并被[视为不同的](https://stackoverflow.com/questions/1459236/module-reimported-if-imported-from-different-path)`import x`模块。

*   不要使用*range*代替列表，因为`range()`无论如何都会成为迭代器，以下将失败：

    ```
     myIndexList = [0, 1, 3]
      isListSorted = myIndexList == range(3)  # will fail in 3.0
      isListSorted = myIndexList == list(range(3))  # will not 
    ```

    同样的事情也可以用*xrange 错误地完成：*

    ```
     myIndexList == xrange(3) 
    ```

*   小心捕获多种异常类型：

    ```
     try:
          raise KeyError("hmm bug")
      except KeyError, TypeError:
          print TypeError 
    ```

    这会打印“hmm bug”，尽管它不是错误；看起来我们正在捕获这两种类型的异常，但我们只是将 KeyError 捕获为变量*TypeError，*请改用它：

    ```
     try:
          raise KeyError("hmm bug")
      except (KeyError, TypeError):
          print TypeError 
    ```

* * *

## 回答 #1

> 赞同：73
> 
> 时间：2009-08-24T08:17:25.740

**不要使用索引来循环序列**

不 ：

```
for i in range(len(tab)) :
    print tab[i] 
```

做 ：

```
for elem in tab :
    print elem 
```

*For*将为您自动执行大多数迭代操作。

如果[`enumerate`](http://docs.python.org/library/functions.html#enumerate)您确实需要索引和元素，请使用。

```
for i, elem in enumerate(tab):
     print i, elem 
```

***使用“==”检查True*或*False*时要小心**

 *```
if (var == True) :
    # this will execute if var is True or 1, 1.0, 1L

if (var != True) :
    # this will execute if var is neither True nor 1

if (var == False) :
    # this will execute if var is False or 0 (or 0.0, 0L, 0j)

if (var == None) :
    # only execute if var is None

if var :
    # execute if var is a non-empty string/list/dictionary/tuple, non-0, etc

if not var :
    # execute if var is "", {}, [], (), 0, None, etc.

if var is True :
    # only execute if var is boolean True, not 1

if var is False :
    # only execute if var is boolean False, not 0

if var is None :
    # same as var == None 
```

**不要检查是否可以，只需执行并处理错误**

Pythonistas 通常会说“请求原谅比请求许可更容易”。

不 ：

```
if os.path.isfile(file_path) :
    file = open(file_path)
else :
    # do something 
```

做 ：

```
try :
    file =  open(file_path)
except OSError as e:
    # do something 
```

使用 python 2.6+ / 3 甚至更好：

```
with open(file_path) as file : 
```

它要好得多，因为它更通用。您可以将“try / except”应用于几乎任何事情。你不需要关心如何防止它，只关心你冒的错误。

**不要检查类型**

Python 是动态类型的，因此检查类型会使您失去灵活性。相反，通过检查行为来使用鸭子类型。例如，您希望函数中有一个字符串，然后使用 str() 转换字符串中的任何对象。您期望一个列表，使用 list() 来转换列表中的任何可迭代对象。

不 ：

```
def foo(name) :
    if isinstance(name, str) :
        print name.lower()

def bar(listing) :
    if isinstance(listing, list) :
        listing.extend((1, 2, 3))
        return ", ".join(listing) 
```

做 ：

```
def foo(name) :
    print str(name).lower()

def bar(listing) :
    l = list(listing)
    l.extend((1, 2, 3))
    return ", ".join(l) 
```

使用最后一种方式， foo 将接受任何对象。Bar 将接受字符串、元组、集合、列表等等。便宜的干:-)

**不要混用空格和制表符**

只是不要。你会哭的。

**使用*对象*作为第一父级**

这很棘手，但随着程序的增长它会咬你。Python 2.x 中有新旧类。旧的，嗯，旧的。它们缺乏一些特性，并且在继承时可能会出现尴尬的行为。为了可用，您的任何类都必须是“新样式”。为此，使其继承自 "object" ：

不 ：

```
class Father :
    pass

class Child(Father) :
    pass 
```

做 ：

```
class Father(object) :
    pass

class Child(Father) :
    pass 
```

在 Python 3.x 中，所有类都是新样式，因此您可以声明`class Father:`很好。

**不要在`__init__`方法之外初始化类属性**

来自其他语言的人会觉得这很诱人，因为您在 Java 或 PHP 中所做的工作。你写下类名，然后列出你的属性并给它们一个默认值。它似乎在 Python 中工作，但是，这并不像你想象的那样工作。

这样做将设置类属性（静态属性），然后当您尝试获取对象属性时，它将为您提供其值，除非它为空。在这种情况下，它将返回类属性。

这意味着两大危害：

*   如果更改类属性，则更改初始值。
*   如果您将可变对象设置为默认值，您将获得跨实例共享的相同对象。

不要（除非你想要静态）：

```
class Car(object):
    color = "red"
    wheels = [wheel(), Wheel(), Wheel(), Wheel()] 
```

做 ：

```
class Car(object):
    def __init__(self):
        self.color = "red"
        self.wheels = [wheel(), Wheel(), Wheel(), Wheel()] 
```

* * *

## 回答 #2

> 赞同：39
> 
> 时间：2009-06-22T04:27:30.283

当您需要大量数组时，您可能会想输入如下内容：

```
>>> a=[[1,2,3,4,5]]*4 
```

果然，当你看到它时，它会给你你所期望的

```
>>> from pprint import pprint
>>> pprint(a)

[[1, 2, 3, 4, 5],
 [1, 2, 3, 4, 5],
 [1, 2, 3, 4, 5],
 [1, 2, 3, 4, 5]] 
```

但不要指望人口中的元素是单独的对象：

```
>>> a[0][0] = 2
>>> pprint(a)

[[2, 2, 3, 4, 5],
 [2, 2, 3, 4, 5],
 [2, 2, 3, 4, 5],
 [2, 2, 3, 4, 5]] 
```

除非这是你需要的...

值得一提的解决方法是：

```
a = [[1,2,3,4,5] for _ in range(4)] 
```

* * *

## 回答 #3

> 赞同：28
> 
> 时间：2009-06-18T10:24:08.817

Python 语言陷阱——以非常晦涩的方式失败的事情

*   使用可变的默认参数。

*   前导零表示八进制。 `09`是 Python 2.x 中一个非常晦涩的语法错误

*   在超类或子类中拼写错误的重写方法名称。超类拼写错误更严重，因为没有一个子类正确覆盖它。

Python 设计陷阱

*   花时间进行自省（例如，尝试自动确定类型或超类身份或其他内容）。首先，通过阅读源代码很明显。更重要的是，花在奇怪的 Python 内省上的时间通常表明根本无法掌握多态性。80% 的关于 SO 的 Python 自省问题都未能得到多态性。

*   花时间在代码高尔夫上。仅仅因为您的应用程序的心智模型是四个关键字（“do”、“what”、“I”、“mean”），并不意味着您应该构建一个超复杂的内省装饰器驱动框架来做到这一点。Python 允许你将 DRY 提升到一个愚蠢的水平。剩下的关于 SO 的 Python 自省问题试图将复杂的问题简化为编写高尔夫练习的代码。

*   猴子补丁。

*   未能真正通读标准库，并重新发明轮子。

*   将交互式 Python 类型与适当的程序混为一谈。当您以交互方式键入时，您可能会忘记变量并不得不使用`globals()`. 此外，当您打字时，几乎所有内容都是全局的。在适当的程序中，您永远不会“忘记”变量，并且没有什么是全局的。

* * *

## 回答 #4

> 赞同：26
> 
> 时间：2009-08-24T08:12:17.873

改变默认参数：

```
def foo(bar=[]):
    bar.append('baz')
    return bar 
```

默认值只计算一次，而不是每次调用函数时。重复调用`foo()`将返回`['baz']`, `['baz', 'baz']`, `['baz', 'baz', 'baz']`, ...

如果你想改变 bar 做这样的事情：

```
def foo(bar=None):
    if bar is None:
        bar = []

    bar.append('baz')
    return bar 
```

或者，如果您希望参数是最终的：

```
def foo(bar=[]):
    not_bar = bar[:]

    not_bar.append('baz')
    return not_bar 
```

* * *

## 回答 #5

> 赞同：22
> 
> 时间：2009-08-24T08:05:57.667

我不知道这是否是一个常见的错误，但是虽然 Python 没有递增和递减运算符，但允许使用双符号，所以

```
++i 
```

和

```
--i 
```

是语法正确的代码，但没有做任何“有用”或您可能期望的事情。

* * *

## 回答 #6

> 赞同：18
> 
> 时间：2009-08-24T09:11:42.510

在查看标准库之前滚动您自己的代码。例如，这样写：

```
def repeat_list(items):
    while True:
        for item in items:
            yield item 
```

当你可以使用这个时：

```
from itertools import cycle 
```

经常被忽视的模块的例子（除了[`itertools`](http://docs.python.org/library/itertools.html)）包括：

*   [`optparse`](http://docs.python.org/library/optparse.html)用于创建命令行解析器
*   [`ConfigParser`](http://docs.python.org/library/configparser.html)用于以标准方式读取配置文件
*   [`tempfile`](http://docs.python.org/library/tempfile.html)用于创建和管理临时文件
*   [`shelve`](http://docs.python.org/library/shelve.html)用于将 Python 对象存储到磁盘，当一个完整的数据库过于强大时很方便

* * *

## 回答 #7

> 赞同：15
> 
> 时间：2009-06-18T08:23:47.937

避免使用关键字作为您自己的标识符。

另外，不使用总是好的`from somemodule import *`。

* * *

## 回答 #8

> 赞同：14
> 
> 时间：2009-07-27T17:23:54.157

Surprised that nobody said this:

> Mix tab and spaces when indenting.

Really, it's a killer. Believe me. *In particular*, if it runs.

* * *

## 回答 #9

> 赞同：14
> 
> 时间：2009-08-24T09:17:47.430

不使用功能性工具。从风格的角度来看，这不仅仅是一个错误，从速度的角度来看也是一个错误，因为很多功能工具都是在 C 中优化的。

这是最常见的例子：

```
temporary = []
for item in itemlist:
    temporary.append(somefunction(item))
itemlist = temporary 
```

正确的做法：

```
itemlist = map(somefunction, itemlist) 
```

同样正确的方法是：

```
itemlist = [somefunction(x) for x in itemlist] 
```

如果您一次只需要一个处理项目，而不是一次全部可用，则可以通过使用可迭代等效项来节省内存并提高速度

```
# itertools-based iterator
itemiter = itertools.imap(somefunction, itemlist)
# generator expression-based iterator
itemiter = (somefunction(x) for x in itemlist) 
```

* * *

## 回答 #10

> 赞同：13
> 
> 时间：2009-08-24T08:21:27.573

如果您来自 C++，请意识到在类定义中声明的变量是静态的。您可以在**init**方法中初始化非静态成员。

例子：

```
class MyClass:
  static_member = 1

  def __init__(self):
    self.non_static_member = random() 
```

* * *

## 回答 #11

> 赞同：10
> 
> 时间：2009-06-18T08:31:29.077

[像 Pythonista 一样编写代码：惯用的 Python](http://python.net/~goodger/projects/pycon/2007/idiomatic/handout.html)

* * *

## 回答 #12

> 赞同：9
> 
> 时间：2009-08-24T08:16:37.020

正常的复制（分配）是通过引用完成的，因此通过调整相同的对象并插入来填充容器，最终会得到一个引用了最后添加的对象的容器。

改为使用`copy.deepcopy`。

* * *

## 回答 #13

> 赞同：8
> 
> 时间：2010-01-04T03:31:10.087

Using the `%s` formatter in error messages. In almost every circumstance, `%r` should be used.

For example, imagine code like this:

```
try:
    get_person(person)
except NoSuchPerson:
    logger.error("Person %s not found." %(person)) 
```

Printed this error:

```
ERROR: Person wolever not found.
```

It's impossible to tell if the `person` variable is the string `"wolever"`, the unicode string `u"wolever"` or an instance of the `Person` class (which has `__str__` defined as `def __str__(self): return self.name`). Whereas, if `%r` was used, there would be three different error messages:

```
...
logger.error("Person %r not found." %(person)) 
```

Would produce the much more helpful errors:

```
ERROR: Person 'wolever' not found.
ERROR: Person u'wolever' not found.
ERROR: Person  not found.
```

Another good reason for this is that paths are a whole lot easier to copy/paste. Imagine:

```
try:
    stuff = open(path).read()
except IOError:
    logger.error("Could not open %s" %(path)) 
```

If `path` is `some path/with 'strange' "characters"`, the error message will be:

```
ERROR: Could not open some path/with 'strange' "characters"
```

Which is hard to visually parse and hard to copy/paste into a shell.

Whereas, if `%r` is used, the error would be:

```
ERROR: Could not open 'some path/with \'strange\' "characters"'
```

Easy to visually parse, easy to copy-paste, all around better.

* * *

## 回答 #14

> 赞同：8
> 
> 时间：2009-08-24T08:17:54.243

导入和使用完整的正则表达式方法进行字符串匹配/转换，当每个常见操作（例如大写、简单匹配/搜索）都存在`re`完美的[字符串方法时。](http://python.org/doc/2.5.2/lib/string-methods.html)

* * *

## 回答 #15

> 赞同：7
> 
> 时间：2009-07-16T05:20:09.520

*   不要将大的输出消息写入标准输出
*   字符串是不可变的 - 不使用“+”运算符而是使用 str.join() 函数构建它们。
*   阅读这些文章：
    *   [蟒蛇陷阱](http://www.ferg.org/projects/python_gotchas.html)
    *   [要避免的事情](http://www.techiesabode.com/article/read_article_w.php?article_id=14)
    *   [Python 用户的陷阱](http://boo.codehaus.org/Gotchas+for+Python+Users)
    *   [蟒蛇地雷](https://stackoverflow.com/questions/530530/python-2-x-gotchas-and-landmines)

最后一个链接是原始链接，这个 SO 问题是重复的。

* * *

## 回答 #16

> 赞同：6
> 
> 时间：2009-06-18T08:23:42.790

我将在 2.6 中停止使用已弃用的方法，以便您的应用程序或脚本准备就绪并且更容易转换为 Python 3。

* * *

## 回答 #17

> 赞同：6
> 
> 时间：2009-07-16T05:03:13.110

我必须训练自己改掉的一个坏习惯是使用`X and Y or Z`内联逻辑。

除非你能 100% 始终保证这`Y`将是一个真实的价值，否则即使你的代码在 18 个月内发生变化，你也会为一些意想不到的行为做好准备。

值得庆幸的是，在以后的版本中，您可以使用`Y if X else Z`.

* * *

## 回答 #18

> 赞同：5
> 
> 时间：2009-06-18T09:49:37.937

一些个人意见，但我发现最好**不要**：

*   使用不推荐使用的模块（对它们使用警告）

*   过度使用类和继承（可能是静态语言遗留的典型）

*   `for`显式使用声明性算法（作为与vs 使用的 迭代`itertools`）

*   从标准库重新实现功能，“因为我不需要所有这些功能”

*   为了它而使用特性（降低与旧 Python 版本的兼容性）

*   当你真的不需要时使用元类，更普遍的是让事情变得太“神奇”

*   避免使用生成器

*   （更个人化）尝试在低级基础上对 CPython 代码进行微优化。更好地花时间在算法上，然后通过创建一个小的 C 共享库来进行优化`ctypes`（在内部循环中很容易获得 5 倍的性能提升）

*   当迭代器足够时使用不必要的列表

*   在您需要的库全部可用之前直接为 3.x 编写一个项目（这一点现在可能有点争议！）

* * *

## 回答 #19

> 赞同：5
> 
> 时间：2009-08-24T08:06:55.777

我也开始学习 Python，我犯的最大错误之一就是经常使用 C++/C# 索引的“for”循环。Python 有 for(i ; i < length ; i++) 类型的循环，这是有充分理由的——大多数时候有更好的方法来做同样的事情。

示例：我有一个迭代列表并返回所选项目索引的方法：

```
for i in range(len(myList)):
    if myList[i].selected:
        retVal.append(i) 
```

取而代之的是，Python 具有列表理解，它以一种更优雅、更易于阅读的方式解决了相同的问题：

```
retVal = [index for index, item in enumerate(myList) if item.selected] 
```

* * *

## 回答 #20

> 赞同：5
> 
> 时间：2009-07-16T04:45:25.517

`++n`并且`--n`可能无法像来自 C 或 Java 背景的人所期望的那样工作。

`++n`是正数的正数，即`n`.

`--n`是负数的负数，即`n`.

* * *

## 回答 #21

> 赞同：4
> 
> 时间：2009-06-22T04:44:43.860

```
import this 
```

美丽总比丑陋好。
显式优于隐式。
简单胜于复杂。
复杂胜于复杂。
平面优于嵌套。
稀疏比密集好。
可读性很重要。
特殊情况不足以打破规则。
虽然实用胜过纯洁。
错误永远不应该悄无声息地过去。
除非明确沉默。
面对模棱两可，拒绝猜测的诱惑。
应该有一种——最好只有一种——明显的方法来做到这一点。
虽然这种方式一开始可能并不明显，除非你是荷兰人。
现在总比没有好。
虽然从不总是比*正确更好*现在。
如果实现很难解释，那是个坏主意。
如果实现很容易解释，那可能是个好主意。
命名空间是一个很棒的想法——让我们做更多的事情！

```
import not_this 
```

编写丑陋的代码。
编写隐式代码。
编写复杂的代码。
编写嵌套代码。
编写密集的代码。
编写不可读的代码。
写特殊情况。
力求纯洁。
忽略错误和异常。
在发布之前编写最佳代码。
每个实现都需要一个流程图。
不要使用命名空间。

* * *

## 回答 #22

> 赞同：4
> 
> 时间：2009-08-24T09:32:17.757

永远不要假设拥有多线程 Python 应用程序和支持 SMP 的机器（例如配备多核 CPU 的机器）会给您带来将真正的并行性引入应用程序的好处。很可能不会因为 GIL（全局解释器锁）在字节码解释器级别同步您的应用程序。

有一些解决方法，例如通过将并发代码放在 C API 调用中或通过包装器使用多个进程（而不是线程）来利用 SMP（例如[http://www.parallelpython.org](http://www.parallelpython.org)提供的那个），但如果一个在 Python 中需要真正的多线程，应该查看 Jython、IronPython 等（GIL 是 CPython 解释器的一项功能，因此其他实现不受影响）。

根据 Python 3000 FAQ（Artima 提供），即使是最新的 Python 版本，上述内容仍然适用。

* * *

## 回答 #23

> 赞同：3
> 
> 时间：2010-01-04T03:03:06.430

您已经提到了默认参数......一个几乎与可变默认参数一样糟糕：默认值不是`None`.

考虑一个可以烹饪食物的函数：

```
def cook(breakfast="spam"):
    arrange_ingredients_for(breakfast)
    heat_ingredients_for(breakfast)
    serve(breakfast) 
```

因为它为 指定了一个默认值`breakfast`，所以如果没有特殊情况，其他一些函数就不可能说“煮你的默认早餐”：

```
def order(breakfast=None):
    if breakfast is None:
        cook()
    else:
        cook(breakfast) 
```

`cook`但是，如果将其用作`None`默认值，则可以避免这种情况：

```
def cook(breakfast=None):
    if breakfast is None:
        breakfast = "spam"

def order(breakfast=None):
    cook(breakfast) 
```

一个很好的例子是 Django bug [#6988](http://code.djangoproject.com/ticket/6988)。Django 的缓存模块有一个“保存到缓存”功能，如下所示：

```
def set(key, value, timeout=0):
    if timeout == 0:
        timeout = settings.DEFAULT_TIMEOUT
    _caching_backend.set(key, value, timeout) 
```

但是，对于 memcached 后端，超时`0`意味着“永不超时”……正如您所见，无法指定。

* * *

## 回答 #24

> 赞同：3
> 
> 时间：2009-07-16T05:27:31.127

与默认的可变参数有些相关，当传递一个空列表时，如何检查“缺失”情况会导致差异：

```
def func1(toc=None):
    if not toc:
        toc = []
    toc.append('bar')

def func2(toc=None):
    if toc is None:
        toc = []
    toc.append('bar')

def demo(toc, func):
    print func.__name__
    print '  before:', toc
    func(toc)
    print '  after:', toc

demo([], func1)
demo([], func2) 
```

这是输出：

```
func1
  before: []
  after: []
func2
  before: []
  after: ['bar'] 
```

* * *

## 回答 #25

> 赞同：3
> 
> 时间：2010-05-02T15:07:07.267

迭代列表时不要修改列表。

```
odd = lambda x : bool(x % 2)
numbers = range(10)
for i in range(len(numbers)):
    if odd(numbers[i]):
        del numbers[i] 
```

解决此问题的一个常见建议是反向迭代列表：

```
for i in range(len(numbers)-1,0,-1):
    if odd(numbers[i]):
        del numbers[i] 
```

但更好的是使用列表推导来构建一个新列表来替换旧列表：

```
numbers[:] = [n for n in numbers if not odd(n)] 
```

* * *

## 回答 #26

> 赞同：3
> 
> 时间：2009-08-24T22:57:26.477

```
my_variable = <something>
...
my_varaible = f(my_variable)
...
use my_variable and thinking it contains the result from f, and not the initial value 
```

Python 不会以任何方式警告你在第二次赋值时你拼错了变量名并创建了一个新的。

* * *

## 回答 #27

> 赞同：3
> 
> 时间：2009-08-24T08:16:46.023

开始之前的第一个错误：*不要害怕空格*。

当你向某人展示一段 Python 代码时，他们会印象深刻，直到你告诉他们*必须*正确缩进。出于某种原因，大多数人认为一种语言不应该强加给他们某种风格，而所有人都会缩进代码。

* * *

## 回答 #28

> 赞同：3
> 
> 时间：2009-08-24T08:19:31.477

常见的陷阱：*默认参数被评估一次*：

```
def x(a, l=[]):
    l.append(a)
    return l

print x(1)
print x(2) 
```

印刷：

```
[1]
[1, 2] 
```

即你总是得到相同的列表。

* * *

## 回答 #29

> 赞同：1
> 
> 时间：2010-05-02T14:40:36.967

从 stdlib 创建一个同名的本地模块。这几乎总是意外完成（如[本问题](https://stackoverflow.com/questions/2753552/has-twisted-changed-its-dependencies)中所述），但通常会导致神秘的错误消息。

* * *

## 回答 #30

> 赞同：1
> 
> 时间：2010-07-27T21:36:43.433

## 混杂异常处理

这是我在生产代码中看到的数量惊人的东西，它让我感到畏缩。

```
try:
    do_something() # do_something can raise a lot errors e.g. files, sockets
except:
    pass # who cares we'll just ignore it 
```

异常是您想要抑制的异常，还是更严重？但还有更微妙的情况。这可以让你把头发拉出来试图弄清楚。

```
try: 
    foo().bar().baz()
except AttributeError: # baz() may return None or an incompatible *duck type*
    handle_no_baz() 
```

问题是 foo 或 baz 也可能是罪魁祸首。我认为这可能更加阴险，因为这是*惯用的 python*，您可以在其中检查类型以获取正确的方法。但是每个方法调用都有机会返回一些意想不到的东西并抑制应该引发异常的错误。

知道一个方法可以抛出什么异常并不总是显而易见的。例如，urllib 和 urllib2 使用套接字，它有自己的异常，当你最不期望的时候，它们会向上渗透并抬起它们丑陋的脑袋。

异常处理在处理 C 等系统级语言中的错误方面是一种生产力提升。但我发现不正确地抑制异常会创建真正神秘的调试会话并带走解释语言提供的主要优势。

* * *

## 回答 #31

> 赞同：0
> 
> 时间：2010-07-27T20:57:16.377

## Class attributes

Some answers above are incorrect or unclear about class attributes.

They do not become instance attributes, but are readable using the same syntax as instance attributes. They can be changed by accessing them via the class name.

```
class MyClass:
    attrib = 1                         # class attributes named 'attrib'
    another = 2                        # and 'another'
    def __init__(self):
        self.instattr = 3              # creates instance attributes
        self.attrib = 'instance'      

mc0 = MyClass()
mc1 = MyClass()

print mc.attrib    # 'instance'
print mc.another   # '2'

MyClass.another = 5  # change class attributes
MyClass.attrib = 21  # <- masked by instance attribute of same name

print mc.attrib    # 'instance'   unchanged instance attribute
print mc.another   # '5'          changed class attribute 
```

Class attributes can be used as sort of default values for instance attributes, masked later by instance attributes of the same name with a different value.

## Intermediate scope local variables

A more difficult matter to understand is the scoping of variables in nested functions.

In the following example, *y* is unwritable from anywhere other than function 'outer'. *x* is readable and writable from anywhere, as it is declared global in each function. *z* is readable and writable in 'inner*' only. *y* is readable in 'outer' and 'inner*', but not writable except in 'outer'.

```
x = 1
def outer():
    global x
    y = 2
    def inner1():
        global x, y
        y = y+1  # creates new global variable with value=3
    def inner2():
        global x
        y = y+1  # creates new local variable with value=3 
```

I believe that Python 3 includes an 'outer' keyword for such 'outside this function but not global' cases. In Python 2.#, you are stuck with either making *y* global, or making it a mutable parameter to 'inner'.

* * *

## 回答 #32

> 赞同：0
> 
> 时间：2009-09-22T07:16:02.773

算法博客有一篇关于 Python 性能问题以及如何避免它们的好文章： [10 Python Optimization Tips and Issues](http://www.algorithm.co.il/blogs/index.php/programming/python/10-python-optimization-tips-and-issues/)

* * *

## 回答 #33

> 赞同：0
> 
> 时间：2009-08-24T22:50:27.800

这已经提到过，但我想详细说明一下类属性的可变性。

当您定义成员属性时，每次实例化该类时，它都会获得一个属性，该属性是类属性的浅表副本。

所以如果你有类似的东西

```
class Test(object):
   myAttr = 1
instA = Test()
instB = Test()
instB.myAttr = 2 
```

它将按预期运行。

```
>>> instA.myAttr
  1
>>> instB.myAttr
  2 
```

当您具有可变的类属性时，问题就来了。由于实例化只是做了一个浅拷贝，所有实例都将只有一个指向同一个对象的引用。

```
class Test(object):
   myAttr=[1,2,3]
instA = Test()
instB = Test()
instB.myAttr[0]=2
>>> instA.myAttr
   [2,2,3] 
```

但是引用*是*实例的实际成员，所以只要您实际上为属性分配了新的东西，就可以了。

**您可以通过在init**函数期间制作可变变量的深层副本来解决此问题

```
import copy
class Test(object):
   myAttr = [1,2,3]
   def __init__(self):
      self.myAttr = copy.deepcopy(self.myAttr)
instA = Test()
instB = Test()
instB.myAttr[0] = 5
>>> instA.myAttr
   [1,2,3]
>>> instB.myAttr
   [5,2,3] 
```

可能可以编写一个装饰器，在初始化期间自动对您的所有类属性进行深度复制，但我不知道任何地方都提供了一个。

* * *

## 回答 #34

> 赞同：0
> 
> 时间：2009-08-24T08:40:11.543

与可变默认参数类似的是可变类属性。

```
>>> class Classy:
...    foo = []
...    def add(self, value):
...        self.foo.append(value)
... 
>>> instance1 = Classy()
>>> instance2 = Classy()
>>> instance1.add("Foo!")
>>> instance2.foo
['Foo!'] 
```

不是你所期望的。*

# apache - 带有 / 斜杠的 Mod-Rewrite 问题 (Apache)

> ID：1011439
> 
> 赞同：0
> 
> 时间：2009-06-18T08:21:21.267
> 
> 标签：apache, mod-rewrite

我赌的是一个我没有看到的明显问题。

对于那些熟悉 Mod-Rewrite 的人来说，这是重要的一点

具有 mod-rewrite 规则的 .htaccess 文件存在于此处： [http](http://www.thedomain.com/.htaccess) ://www.thedomain.com/.htaccess 用户转到此 URL： [http](http://www.thedomain.com/test/blog) ://www.thedomain.com/test/blog Mod-Rewrite 规则实际上应该告诉服务器访问此 URL： [http ://www.thedomain.com/index.php?page=blog](http://www.thedomain.com/index.php?page=blog)

.ht 访问：

```
Options FollowSymLinks
Options -MultiViews
RewriteEngine on
RewriteRule ^test/([^/.]+)$ /index.php?page=$1 [L] 
```

这种代码/请求的组合不起作用。如果您想知道代码片段 ^test 不是 ^/test ，那是因为这显然是 GoDaddy 上的一个问题，代码在 ^ 之后出现 / 失败 - 这似乎与我的问题有关，我将进一步解释...如果我更改 .htaccess 代码行：

```
RewriteRule ^test/([^/.]+)$ /index.php?page=$1 [L] 
```

至

```
RewriteRule ^test([^/.]+)$ /index.php?page=$1 [L] 
```

（只是在这里删除 / ： ^test/([^/.]+) ）

当用户查看正确的 index.php?page=blog 服务器响应时，当请求的 URL 更改为适应（删除斜杠； http://www.thedomain.com/testblog ）时，该代码将**起作用**[。](http://www.thedomain.com/)在我看来，我不能在 RewriteRule 的匹配端使用任何斜线。是什么赋予了？

 ****更新：**如果完全相关，则此 .htaccess 文件和问题的相关文件都存在于托管此文件的 GoDaddy 服务器的子目录中，尽管域指向该子目录作为根目录。不确定这是否相关。

**更新：**这台服务器（在服务器根目录）实际上运行 wordpress 并启用了漂亮的 URL，它们工作得很好。我假设 wordpress 使用 mod-rewrite 来制作像 thedomain.com/2008/11/15/the-article-title.html 这样的疯狂网址......？

非常感谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-18T08:27:48.460

RewriteBase[是](http://httpd.apache.org/docs/2.2/mod/mod_rewrite.html#rewritebase "重写库")您正在寻找的吗？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-18T08:30:07.970

这里有一个不错的 windows 测试工具

[http://www.helicontech.com/download-isapi_rewrite.htm](http://www.helicontech.com/download-isapi_rewrite.htm)

尝试将您的代码更改为：

```
^/test/([^/]+)$ /index.php?page=$1 [L] 
```

或不带斜线

```
^test[^a-z]+([a-z]*)$ /index.php?page=$1 [L] 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-19T07:26:02.600

我无法在 GoDaddy 上找到解决此问题的可靠方法；无论出于何种原因，我不能在试图重写基础的 URL 中使用斜杠（[http://www.somedomain.com/testingthis](http://www.somedomain.com/testingthis)可以工作，但[http://www.somedomain.com/testing/this](http://www.somedomain.com/testing/this)死了）。

我最终改为使用 Wordpress .htaccess 将所有不存在的文件/目录请求发送回我的 index.php。然后我使用带有 pathinfo() 的 $_SERVER['REQUEST_URI'] var 来解析 URL，然后指导从解析中加载哪些内容。这很好用，速度很快，并且可能与 Wordpress 使用的方法相同。

感谢您的尝试！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-18T09:13:13.453

> 如果您想知道代码片段 ^test 不是 ^/test ，那是因为这显然是 GoDaddy 上的一个问题，代码在 ^ [...]

这并不奇怪，但很有必要：

> **[每个目录重写](http://httpd.apache.org/docs/2.2/mod/mod_rewrite.html#rewriterule)**
> 
> 在`.htaccess`文件中使用重写引擎时，每个目录的前缀（对于特定目录总是相同的）被自动*删除*以进行模式匹配，并在替换完成后自动*添加。*

每个*目录的前缀*是用于文档根目录 ( `/.htaccess`) 中的 URL 路径根目录 ()中的 .htaccess 文件`/`。因此，`^`必须在没有*每个目录前缀* `/`的情况下编写带有 的模式。

以同样的方式处理*替换*。应用规则后，*每个目录的前缀*被添加到替换中。所以试试这个规则：

```
RewriteRule ^test/([^/.]+)$ index.php?page=$1 [L] 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-18T09:22:42.360

好的，首先，我认为 GoDaddy apache 服务器只是关闭了一些选项。我认为，如果他们[`AllowOverride FileInfo`](http://httpd.apache.org/docs/2.2/mod/core.html#AllowOverride)的配置中没有一个，`RewriteRule`就不会工作得那么好，或者根本就不会。

这意味着令人惊讶的是，该 URL`http://www.thedomain.com/testblog`完全有效，并且被重新编写。所以我想我有点困惑。

这是一个想法：尝试创建一个名为 的目录`test`，然后将`.htaccess`文件放在那里！它看起来像这样：

```
Options FollowSymLinks
RewriteEngine on
RewriteRule ^([^/]+)$ /index.php?page=$1 [L] 
```

好的，另一个想法：使用`RewriteCond`. 也许您可以直接检查请求 URI，如下所示：

```
Options FollowSymLinks
RewriteEngine on
RewriteCond %{REQUEST_URI} ^/test/([^/]+)
RewriteRule . /index.php?page=%1 [L] 
```

最后一个想法：也许您的浏览器看到 URL`http://www.thedomain.com/test/blog`并认为它是一个目录，并添加了一个斜杠？所以 URL 是发送的是`http://www.thedomain.com/test/blog/`. 在这种情况下，除非您允许尾部斜杠，否则 REGEX 将不匹配：

```
RewriteRule ^test/([^/.]+)/?$ /index.php?page=$1 [L] 
```

哎呀。很抱歉滔滔不绝 - 在经过重写的 HTTP 请求中，有很多事情可能会出错，并且有很多方法可以尝试克服这些问题 :-)**

# sql - 如何创建 SQL 索引以提高 ORDER BY 性能

> ID：1011440
> 
> 赞同：1
> 
> 时间：2009-06-18T08:23:19.217
> 
> 标签：sql, sqlite, indexing, sql-order-by

我有一些类似于以下的 SQL，它连接四个表，然后按第一个的“状态”列对结果进行排序：

```
SELECT * 
 FROM a, b, c, d 
 WHERE b.aid=a.id AND c.id=a.cid AND a.did=d.id AND a.did='XXX'
 ORDER BY a.status 
```

有用。但是，它很慢。我发现这是因为 ORDER BY 子句和表“a”上没有任何索引。

所有四个表都在“id”列上设置了 PRIMARY KEY。

所以，我知道我需要向包含“状态”列的表 a 添加一个索引，但它还需要包含什么？“bid”、“cid”和“did”也应该在里面吗？

我试图从一般的 SQL 意义上问这个问题，但如果它很重要，那么目标是与 Gears 一起使用的 SQLite。

提前致谢，

杰克（菜鸟）

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-18T08:49:48.930

我会说它很慢，因为引擎正在整个地方进行扫描而不是寻找。你的意思是 SELECT a.* 代替吗？那也会更快，这里的 SELECT * 相当于 a.*, b.*, c.*, d.*。

如果您在这些列中的每一列上放置一个单独的索引，您可能会得到更好的结果：

*   a.did（因此 a.did = 'XXX' 是查找而不是扫描，也有助于 a.did = d.id）
*   a.cid（对于 a.cid = c.id）
*   b.aid（对于 a.id = b.aid）

您可以尝试使用 ASCENDING 顺序将 Status 添加到第一个和第二个索引，以获得额外的性能 - 它不会受到伤害。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-18T08:30:40.933

我很好奇你是如何发现问题是“ORDER BY 子句和表“a”上缺少任何索引。我觉得这有点可疑，因为表 a 上有一个索引，主键上，你后来说。

查看查询的性质以及我对数据性质的猜测，我认为与它使用的表的大小相比，这个查询通常会产生相对较少的结果，因此 ORDER BY 会非常便宜的。当然，这只是一个猜测。

索引是否有帮助取决于表中的数据。查询优化器在执行查询时将使用哪些索引取决于许多不同的因素，其中一个重要因素是查找产生的预期结果数量。

有很大帮助的一件事是，如果您发布 EXPLAINing 您的查询的输出。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-18T08:50:24.857

你试过加入吗？

select * from a inner join b on a.id = b.aid inner join c on a.cid = c.id inner join d on a.did=d.id where a.did='XXX' ORDER BY a.status

连接（左、里奇、内、外）的正确使用取决于表的结构

希望这可以帮助

# java - 在 Java 中在运行时扩展或添加新类

> ID：1011443
> 
> 赞同：5
> 
> 时间：2009-06-18T08:23:55.207
> 
> 标签：java, class, runtime, extend

有没有办法在运行时在 java 中添加（或扩展现有）类。我遇到了一个问题，我必须在运行时扩展现有类并将其添加到类路径中，以便拾取这个新类。

谢谢，

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-06-18T09:22:49.533

有很多方法可以做到这一点。

*   [使用javax.tools](http://java.sun.com/javase/6/docs/api/javax/tools/ToolProvider.html)包在运行时编译源代码，然后使用[ClassLoader](http://java.sun.com/javase/6/docs/api/java/net/URLClassLoader.html)加载它们。
*   [如果您正在编写接口，则可以使用Proxy](http://java.sun.com/javase/6/docs/api/java/lang/reflect/Proxy.html)装饰类。
*   [使用BCEL](http://jakarta.apache.org/bcel/index.html)或[ASM](http://asm.ow2.org/)等技术（后者对语言特性，如注释有更多最新支持）采取更复杂的字节码操作/生成路线，然后使用 ClassLoader 加载类。

我想还有其他选择。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-06-18T08:25:04.800

你可能想看看[BCEL](http://jakarta.apache.org/bcel/index.html)。如果没有更多关于您需要做什么的信息，很难给出更具体的答案。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-18T09:07:22.997

您绝对应该写下为什么需要此功能。如果您尝试在运行时添加或替换逻辑，您可能需要查看[脚本 API](http://java.sun.com/javase/6/docs/api/javax/script/package-summary.html)和一些实际[实现](http://en.wikipedia.org/wiki/List_of_Java_scripting_languages)。

# language-agnostic - 命令式语言中递归的“必要”使用

> ID：1011448
> 
> 赞同：14
> 
> 时间：2009-06-18T08:25:41.083
> 
> 标签：language-agnostic, recursion, iteration

我最近在几个不同的地方看到类似这样的评论：“我在学校学习了递归，但从那时起就再也没有使用过或觉得有必要使用它。” （递归似乎是特定程序员群体中“书本学习”的一个流行例子。）

的确，在 Java 和 Ruby[1] 等命令式语言中，我们通常使用迭代并避免递归，部分原因是存在堆栈溢出的风险，部分原因是大多数程序员在这些语言中习惯于使用这种风格.

现在我知道，严格来说，在这些语言中没有“必要”使用递归：无论事情变得多么复杂，人们总是可以以某种方式用迭代代替递归。这里的“必要”是指以下内容：

你能想到在这样的语言中递归比迭代好得多的任何特定代码示例（出于清晰、效率或其他原因），你无论如何都使用递归，而转换为迭代将是一个很大的损失？

答案中多次提到递归行走树：您对它的特定使用究竟是什么使递归比使用库定义的迭代器更好，它是否可用？

[1]：是的，我知道这些也是面向对象的语言。然而，这与这个问题没有直接关系。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-06-18T09:22:38.257

递归没有“必要的”用途。所有递归算法都可以转换为迭代算法。我似乎记得有一个堆栈是必要的，但我不记得我头顶上的确切结构。

实际上，如果您没有对以下内容使用递归（即使在命令式语言中），您有点生气：

1.  树遍历
2.  图表
3.  词法分析/解析
4.  排序

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-06-18T09:04:04.067

例如，当您行走在任何一种树状结构时

*   使用递归下降解析器解析语法
*   遍历 DOM 树（例如解析的 HTML 或 XML）

此外，每个调用对象成员的 toString() 的 toString() 方法也可以被认为是递归的。所有对象序列化算法都是递归的。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-06-18T08:28:54.200

在我的工作中，递归很少用于任何算法。使用简单的循环可以更易读（且更有效）地解决阶乘等问题。当它确实出现时，通常是因为您正在处理一些本质上是递归的数据。例如，可以递归处理树结构上的节点。

例如，如果您要编写一个程序来遍历二叉树的节点，您可以编写一个处理一个节点的函数，并调用它自己来处理它的每个子节点。这比在遍历每个子节点时尝试维护每个子节点的所有不同状态更有效。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-06-18T09:15:21.297

最著名的例子可能是 CAR Hoare 开发的快速排序算法。

另一个示例是遍历目录树以查找文件。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-06-18T09:37:42.517

在我看来，当数据结构也是递归的时候，递归算法是很自然的选择。

```
def traverse(node, function):
    function(this)
    for each childnode in children:
        traverse(childnode, function) 
```

我不明白为什么我想迭代地写那个。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-06-18T08:57:17.620

这一切都与您正在处理的数据有关。

我编写了一个简单的解析器来将字符串转换为数据结构，这可能是 Java 5 年工作中唯一的例子，但我认为这是正确的方法。

字符串看起来像这样：

```
"{ index = 1, ID = ['A', 'B', 'C'], data = {" +
   "count = 112, flags = FLAG_1 | FLAG_2 }}" 
```

对此最好的抽象是一棵树，其中所有叶节点都是原始数据类型，分支可以是数组或对象。这是典型的递归问题，非递归解决方案是可能的，但要复杂得多。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-06-18T09:26:21.947

递归总是可以用外部堆栈重写为迭代。但是，如果您确定不会冒会导致 stackoverflow 的非常深的递归的风险，那么递归是一件非常方便的事情。

一个很好的例子是遍历已知操作系统上的目录结构。您通常知道它可以有多深（最大路径长度是有限的），因此不会有 stackoverflow。通过使用外部堆栈进行迭代来做同样的事情并不是那么方便。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-06-19T22:58:39.217

有人说“任何树”。我可能过于谨慎，而且我知道现在堆栈很大，但我仍然不会在典型的树上使用递归。但是，我会在**[平衡树上](http://en.wikipedia.org/wiki/B-tree)**进行。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-06-18T08:44:30.500

我有一份报告清单。我在包含此列表的班级上使用索引器。使用索引器通过它们的屏幕名称检索报告。在索引器中，如果该屏幕名称的报告不存在，它会加载报告并递归调用自身。

```
public class ReportDictionary
    {
        private static List<Report> _reportList = null;

        public ReportColumnList this[string screenName]
        {
            get
            {
                Report rc = _reportList.Find(delegate(Report obj) { return obj.ReportName == screenName; });

                if (rc == null)
                {
                    this.Load(screenName);
                    return this[screenName]; // Recursive call
                }
                else
                    return rc.ReportColumnList.Copy();
            }
            private set
            {
                this.Add(screenName, value);
            }
        }

    } 
```

这可以在不使用一些额外代码行的递归的情况下完成。

# regex - 将 1.2.3 转换为 1.02.03 的正则表达式

> ID：1011450
> 
> 赞同：0
> 
> 时间：2009-06-18T08:26:19.493
> 
> 标签：regex, transformation

我真的不擅长正则表达式，我需要一个将“1.2.3”转换为“1.02.03”的方式，第一部分始终保持原样，第二和第三部分将转换 2 到 02、7 到07 等等，但如果有 10、15、17 等等，它将保持原样。我想在 msbuild 中使用它。

样品：

```
2.5.7  -> 2.05.07
2.10.9 -> 2.10.09
1.7.18 -> 1.07.18 
```

谢谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-18T08:34:41.737

```
/\.(\d)(?=\D|$)/g  =>  .0$1 
```

适用于任意数量的点:)

**编辑：**当不支持前瞻但单词边界时，您可以使用

```
/\.(\d)\b/g  =>  .0$1 
```

...或者只是因为它更简单:)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-18T08:31:01.793

```
/\.\([1-9]\)[([.$])]/.0\1\2/g 
```

以点、一个数字、点或行结尾到点零数字 endsym。

# design-patterns - 这是一个足够好的系统错误到用户友好的错误翻译器吗？

> ID：1011451
> 
> 赞同：1
> 
> 时间：2009-06-18T08:26:22.690
> 
> 标签：design-patterns, exception

这就是我翻译抛出的错误的方式：

```
 catch (NpgsqlException ex)
        {
            if (tx != null) tx.Rollback();

            if (ex.Message.Contains("foreign key constraint"))
                throw new Exception("Cannot delete this, this record is already referenced on other record(s)");
            else
                throw new Exception(ex.Message, ex.InnerException);
        } 
```

Npgsql 示例约束错误：

> 错误：23503：表“color”上的更新或删除违反了表“order_detail”上的外键约束“fk_order_detail__color”

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-18T08:31:17.533

您从异常中删除信息而不是记录它。

我认为这是一个糟糕的电话。
记录消息以便能够处理它，这个错误也不应该发生。

重构，这样就不会再发生这种情况。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-18T08:28:21.487

你应该这样写你的问题，这样它就不会导致 SQL 错误。

或者，如果您知道发生错误的具体原因，只需在界面中将其显示*为消息*，而不是错误。即“您应该删除删除此对象之间的依赖关系”而不是“内部错误：随便”。

错误是意料之外的；你的约束错误不是。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-06-18T08:30:27.517

如果您想更具体地处理一些错误，那么理想情况下您会创建一个`ColorAlreadyUsedException class`并抛出它。想想如何`caller`区分这两种情况：是否也需要检查消息？

仍然包含原始异常作为内部异常。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-18T08:35:37.413

在我看来，当它已经有一个错误代码时，依赖消息的文本是相当不稳定的。尽管其他答案中概述的模式存在其他一些问题，但至少我会搜索“23503”而不是“外键约束”。否则，如果用户安装的数据库处于不同的文化中，或者服务器的更新版本更改了消息的文本，会发生什么情况？

* * *

实际上，查看您正在使用的异常类的一些[在线文档](http://npgsql.projects.postgresql.org/docs/api/Npgsql.NpgsqlExceptionMembers.html)，它看起来甚至还有一个 Code 属性，这将比 message 属性更快、更可靠地进行比较。

* * *

最后的想法...

我同意 Van 的观点，即当约束被破坏时你应该抛出一个更具体的异常，但当错误是其他错误时，你也不应该抛出一个基本异常。首先，抛出基异常类从来都不是一个好习惯，因为它不会为客户端代码提供任何关于错误是什么的易于测试的信息。其次，您会丢失大量信息，包括 NpgsqlException 实现的所有额外属性以及堆栈跟踪。我会用类似的东西代替投掷：

```
if (ex.Message.Contains("foreign key constraint"))
    throw new ConstraintException("Cannot delete this, this record is already referenced on other record(s)");
else
     throw; 
```

基本上，如果你不打算对异常做任何有成效的事情，那就不要碰它，你永远不知道备份调用堆栈可能需要什么信息代码。

# java - 一个 int 值中的多个标志

> ID：1011452
> 
> 赞同：7
> 
> 时间：2009-06-18T08:26:57.603
> 
> 标签：java, eclipse

我有一个包含多个标志的 int 变量，例如：

```
int styles = ExpandableComposite.TITLE_BAR | ExpandableComposite.TWISTIE | ExpandableComposite.EXPANDED; 
```

我可以测试标志的存在

```
boolean expanded = (styles & ExpandableComposite.EXPANDED) != 0; 
```

如何在不知道其中设置的确切标志的情况下清除标志的值`styles`，即动态删除？`ExpandableComposite.EXPANDED``styles`

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-06-18T08:30:05.553

这是一个古老的 C 习语，仍在 Java 中工作：

```
styles &= ~ExpandableComposite.EXPANDED; 
```

但是这些天（> = Java 1.5）您应该考虑使用：

*   [`Enum`](https://docs.oracle.com/javase/8/docs/api/java/lang/Enum.html)（见[教程](http://docs.oracle.com/javase/tutorial/java/javaOO/enum.html)）
*   [`EnumSet`](http://docs.oracle.com/javase/8/docs/api/java/util/EnumSet.html)
*   [`EnumMap`](http://docs.oracle.com/javase/8/docs/api/java/util/EnumMap.html)

# eclipse - Eclipse 插件

> ID：1011454
> 
> 赞同：1
> 
> 时间：2009-06-18T08:27:28.397
> 
> 标签：eclipse, plugins

我想写一个eclipse插件来显示消息代码的实际值。这些值将从给定的资源包中加载。只有资源包的类可用。所以我需要加载当前文件中声明的资源包类。这些类文件将位于 classes 文件夹或 lib 文件夹中的 jar 文件中。有没有办法从 eclipse 插件动态加载类？提前致谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-18T09:35:54.173

如何从 message.properties 文件中获取外部化字符串的示例

```
private static final String BUNDLE_NAME = "de.stackoverflow.package.messages"; //$NON-NLS-1$

private static final ResourceBundle RESOURCE_BUNDLE = ResourceBundle.getBundle(BUNDLE_NAME);

RESOURCE_BUNDLE.getString(key); 
```

每个插件都有一个 bundle 对象，您可以在其中加载插件的文件。Bundle 对象应包含您要使用的所有信息。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-18T09:27:05.953

看看 Bundle 类。有以下方法：

```
public Class loadClass(String name) throws ClassNotFoundException; 
```

要从插件中获取捆绑包：

```
Activator.getDefault().getBundle() 
```

希望这有帮助

马努

# c - 是否可以在C中修改字符串？

> ID：1011455
> 
> 赞同：91
> 
> 时间：2009-06-18T08:27:36.447
> 
> 标签：c, string, debugging

我已经为各种与指针相关的 C 教程和书籍苦苦挣扎了几个小时，但我真正想知道的是是否可以在创建 char 指针后对其进行更改。

这是我尝试过的：

```
char *a = "This is a string";
char *b = "new string";

a[2] = b[1]; // Causes a segment fault

*b[2] = b[1]; // This almost seems like it would work but the compiler throws an error. 
```

那么有没有办法改变字符串中的值而不是指针地址呢？

* * *

## 回答 #1

> 赞同：172
> 
> 时间：2009-06-18T08:47:22.337

当您在源代码中编写“字符串”时，它会直接写入可执行文件，因为需要在编译时知道该值（有可用的工具可以将软件分开并在其中找到所有纯文本字符串）。写的时候`char *a = "This is a string"`，“This is a string”的位置在可执行文件中，位置`a`指向的，在可执行文件中。可执行映像中的数据是只读的。

您需要做的（正如其他答案所指出的）是在非只读位置（在堆上或堆栈帧中）创建该内存。如果您声明一个本地数组，则在堆栈上为该数组的每个元素创建空间，并将字符串文字（存储在可执行文件中）复制到堆栈中的该空间。

```
char a[] = "This is a string"; 
```

您还可以通过在堆上分配一些内存来手动复制该数据，然后使用`strcpy()`将字符串文字复制到该空间中。

```
char *a = malloc(256);
strcpy(a, "This is a string"); 
```

每当您分配空间时，`malloc()`请记住在完成后调用`free()`（阅读：内存泄漏）。

基本上，您必须跟踪数据的位置。每当您在源代码中写入字符串时，该字符串都是只读的（否则您可能会更改可执行文件的行为 - 想象一下，如果您写入`char *a = "hello";`然后更改`a[0]`为`'c'`. 然后在其他地方写入`printf("hello");`。如果您被允许更改第一个的字符`"hello"`，并且您的编译器只存储一次（它应该），然后`printf("hello");`会输出`cello`！）

* * *

## 回答 #2

> 赞同：33
> 
> 时间：2009-06-18T08:31:55.207

不，您不能修改它，因为字符串可以存储在只读存储器中。如果要修改它，可以使用数组代替，例如

```
char a[] = "This is a string"; 
```

或者，您可以使用 malloc 分配内存，例如

```
char *a = malloc(100);
strcpy(a, "This is a string");
free(a); // deallocate memory once you've done 
```

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2009-06-18T12:23:56.423

很多人对 char* 和 char[] 与 C 中的字符串文字之间的区别感到困惑。当您编写时：

```
char *foo = "hello world"; 
```

...您实际上将 foo 指向一个恒定的内存块（实际上，在这种情况下，编译器对“hello world”所做的操作取决于实现。）

使用 char[] 代替告诉编译器您要创建一个数组并用内容“hello world”填充它。foo 是指向 char 数组的第一个索引的指针。它们都是 char 指针，但只有 char[] 将指向本地分配的可变内存块。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-06-18T08:34:39.193

a & b 的内存不是你分配的。编译器可以自由选择只读内存位置来存储字符。因此，如果您尝试更改它可能会导致段错误。所以我建议你自己创建一个字符数组。就像是：`char a[10]; strcpy(a, "Hello");`

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-06-18T13:37:52.047

您的问题似乎已经得到解答，但现在您可能想知道为什么 char *a = "String" 存储在只读内存中。嗯，它实际上没有被 c99 标准定义，但大多数编译器选择这种方式，例如：

```
printf("Hello, World\n"); 
```

[c99 标准（pdf）](http://www.google.com/url?sa=t&source=web&ct=res&cd=1&url=http%3A%2F%2Fwww.open-std.org%2FJTC1%2FSC22%2FWG14%2Fwww%2Fdocs%2Fn1124.pdf&ei=oEA6SuD6IqKqtgeY1v3TDA&usg=AFQjCNHfDjr8heM10SbpMcifDB02qFA48g&sig2=z-pRltAqpZGNE7QrptV23w) [第 130 页，第 6.7.8 节]：

声明：

```
char s[] = "abc", t[3] = "abc"; 
```

定义“普通”字符数组对象 s 和 t，其元素用字符串字面量初始化。此声明与 char 相同

```
s[] = { 'a', 'b', 'c', '\0' }, t[] = { 'a', 'b', 'c' }; 
```

数组的内容是可修改的。另一方面，声明

```
char *p = "abc"; 
```

定义 p 类型为“pointer to char”，并将其初始化为指向长度为 4 的类型为“char 数组”的对象，其元素使用字符串字面量进行初始化。如果尝试使用 p 修改数组的内容，则行为未定义。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2014-01-08T16:45:23.457

你也可以使用`strdup`：

```
 The strdup() function returns a pointer to a new string which is a duplicate of the string  s.
   Memory for the new string is obtained with malloc(3), and can be freed with free(3). 
```

以你为例：

```
char *a = strdup("stack overflow"); 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2013-05-02T13:13:30.107

所有这些都是很好的答案，解释了为什么不能修改字符串文字，因为它们被放置在只读内存中。然而，当事关重大时，有办法做到这一点。看看这个例子：

```
#include <sys/mman.h>
#include <unistd.h>
#include <stddef.h>
#include <string.h>
#include <stdlib.h>
#include <stdio.h>

int take_me_back_to_DOS_times(const void *ptr, size_t len);

int main()
{
    const *data = "Bender is always sober.";
    printf("Before: %s\n", data);
    if (take_me_back_to_DOS_times(data, sizeof(data)) != 0)
        perror("Time machine appears to be broken!");
    memcpy((char *)data + 17, "drunk!", 6);
    printf("After: %s\n", data);

    return 0;
}

int take_me_back_to_DOS_times(const void *ptr, size_t len)
{
    int pagesize;
    unsigned long long pg_off;
    void *page;

    pagesize = sysconf(_SC_PAGE_SIZE);
    if (pagesize < 0)
        return -1;
    pg_off = (unsigned long long)ptr % (unsigned long long)pagesize;
    page = ((char *)ptr - pg_off);
    if (mprotect(page, len + pg_off, PROT_READ | PROT_WRITE | PROT_EXEC) == -1)
        return -1;
    return 0;
} 
```

[作为我对 const-correctness 的更深入思考的](http://lazarenko.me/2013/05/01/how-constant-is-a-constant/)一部分，我写了这篇文章，你可能会觉得这很有趣（我希望 :)）。

希望能帮助到你。祝你好运！

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-06-18T08:30:05.913

您需要将字符串复制到另一个非只读内存缓冲区并在那里进行修改。使用 strncpy() 复制字符串，使用 strlen() 检测字符串长度，使用 malloc() 和 free() 为新字符串动态分配缓冲区。

例如（类似 C++ 的伪代码）：

```
int stringLength = strlen( sourceString );
char* newBuffer = malloc( stringLength + 1 );

// you should check if newBuffer is 0 here to test for memory allocaton failure - omitted

strncpy( newBuffer, sourceString, stringLength );
newBuffer[stringLength] = 0;

// you can now modify the contents of newBuffer freely

free( newBuffer );
newBuffer = 0; 
```

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2009-06-18T08:55:49.650

```
char *a = "stack overflow";
char *b = "new string, it's real";
int d = strlen(a);

b = malloc(d * sizeof(char));
b = strcpy(b,a);
printf("%s %s\n", a, b); 
```

# .net - 如何以编程方式找出服务器上的数据库？

> ID：1011456
> 
> 赞同：0
> 
> 时间：2009-06-18T08:27:44.683
> 
> 标签：.net, sql-server

有什么方法可以通过编程方式找出服务器上存在哪些数据库？这是因为我想向用户展示所有可用的数据库并允许他选择他感兴趣的数据库。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-18T08:31:00.777

如果您的意思是“哪些数据库位于 SQL Server 的特定实例上”，那么存储过程`sp_databases`（可通过 Master 访问）将为您提供帮助。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-18T08:34:49.723

使用 Microsoft.SqlServer.Management.Smo，它允许您查询服务器和数据库，特别是当您调用 SmoApplication.EnumAvailableSqlServers() 时。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-18T08:40:37.327

*   2k5：`select * from sys.databases`
*   2k：`select * from sysdatabases`

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-18T08:45:00.703

将取决于您所指的数据库。每个数据库都有自己的方式来查询这些元信息。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-18T12:57:39.553

查看[列出服务器上所有数据库的三种方法](http://wiki.lessthandot.com/index.php/Three_Way_To_List_All_Databases_On_Your_Server)

# ruby - 是什么让 Ruby 变慢了？

> ID：1011460
> 
> 赞同：57
> 
> 时间：2009-06-18T08:28:35.493
> 
> 标签：ruby, performance, garbage-collection, dynamic-languages

Ruby 在某些事情上很慢。但它的哪些部分是最有问题的？

垃圾收集器对性能有多大影响？我知道我曾经有过单独运行垃圾收集器需要几秒钟的时间，尤其是在使用 OpenGL 库时。

我在 Ruby 中使用过特别慢的矩阵数学库。ruby 如何实现基本数学有问题吗？

Ruby 中是否有任何无法有效实现的动态特性？如果是这样，其他语言如 Lua 和 Python 是如何解决这些问题的？

最近有没有显着提高性能的工作？

* * *

## 回答 #1

> 赞同：70
> 
> 时间：2009-06-22T17:46:10.470

> 红宝石很慢。但它的哪些部分是最有问题的？

它对方法进行“后期查找”，以提供灵活性。这会减慢它的速度。它还必须记住每个上下文的变量名以允许 eval，因此它的帧和方法调用更慢。目前它还缺乏一个好的 JIT 编译器，虽然 MRI 1.9 有一个字节码编译器（更好），并且 jruby 将它编译成 java 字节码，然后（可以）通过 HotSpot JVM 的 JIT 编译器编译，但它最终是关于速度与1.9相同。

> 垃圾收集器对性能有多大影响？我知道我曾经有过单独运行垃圾收集器需要几秒钟的时间，尤其是在使用 OpenGL 库时。

从[http://www.igvita.com/2009/06/13/profiling-ruby-with-googles-perftools/](http://www.igvita.com/2009/06/13/profiling-ruby-with-googles-perftools/)上的一些图表我会说它需要大约 10%，这相当多——你可以通过增加 gc.c 中的 malloc_limit 并重新编译来减少这种影响。

> 我在 Ruby 中使用过特别慢的矩阵数学库。ruby 如何实现基本数学有问题吗？

Ruby 1.8“没有”实现基本数学，它实现了数字类，你每次调用都会调用一次像 Fixnum#+ Fixnum#/ 这样的东西——这很慢。Ruby 1.9 通过内联一些基本的数学运算有点作弊。

> Ruby 中是否有任何无法有效实现的动态特性？如果是这样，其他语言如 Lua 和 Python 是如何解决这些问题的？

我敢肯定，诸如评估之类的事情很难有效地实施。*Ruby的踢球者是，它必须在另一个线程*中适应一个自发改变班级定义的人，因此必须非常保守。

> 最近有没有显着提高性能的工作？

1.9就像2倍加速。它也更加有效。Jruby一直在努力提高速度[并且在GC中花费的时间比KRI花费的时间少]。除此之外，除了我一直从事的小爱好事情之外，我还不知道很多。还请注意，由于编码友好性，1.9的字符串有时会变慢。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-06-18T08:54:06.770

Ruby 非常适合快速交付解决方案。提供快速解决方案的情况较少。这取决于您要解决什么样的问题。我想起了 90 年代初在旧 CompuServe MSBASIC 论坛上的讨论：当被问及 Windows 开发、VB 还是 C 哪个更快时，通常的回答是“VB，大约 6 个月”。

在其 MRI 1.8 形式中，Ruby 在执行某些类型的计算密集型任务时相对较慢。与大多数主流编译语言相比，几乎所有解释语言都会受到这种影响。

原因有很多：一些相当容易处理（例如 1.8 中的原始垃圾收集），一些则不太容易。

1.9 解决了一些问题，尽管它可能需要一段时间才能普遍可用。其他一些以预先存在的运行时为目标的实现，例如 JRuby、IronRuby、MagLev，有可能显着加快速度。

关于数学性能，看到相当慢的吞吐量我不会感到惊讶：这是您为任意精度付出的代价的一部分。再次，选择你的问题。我已经在 Ruby 中解决了 70 多个[Project Euler](http://projecteuler.net)问题，几乎没有一个解决方案需要花费超过一分钟的时间来运行。你需要它多快运行，多快需要它？

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-06-18T08:31:20.387

最成问题的部分是“每个人”。

如果那个“每个人”从来没有真正使用过这种语言，那就加分吧。

说真的，1.9 快得多，现在与 python 不相上下，而 jruby 比 jython 快。

垃圾收集器无处不在；例如，Java 有一个，它在动态内存处理方面比 C++ 更快。Ruby 不太适合数字运算。但是很少有语言是这样的，所以如果你的程序中有任何语言的计算密集型部分，你最好用 C 重写它们（Java 由于其原始类型而在数学上很快，但它为它们付出了高昂的代价，它们显然是 # 1 在语言中最丑陋的部分）。

至于动态特性：它们并不快，但是在静态语言中没有它们的代码可能会更慢；例如，java 将使用 XML 配置，而不是使用 DSL 的 Ruby；而且它可能会更慢，因为 XML 解析成本很高。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-06-21T01:05:47.473

嗯 - 几年前我在一个项目中工作，我用 Ruby 性能刮了桶，我不确定从那以后有多大变化。现在它是警告购买者 - 你必须知道不要做某些事情，坦率地说游戏/实时应用程序将是其中之一（因为你提到了 OpenGL）。

扼杀交互性能的罪魁祸首是垃圾收集器——这里的其他人提到 Java 和其他环境也有垃圾收集，但 Ruby 必须*阻止世界*运行。也就是说，它必须停止运行你的程序，从头开始扫描每个寄存器和内存指针，标记仍在使用的内存，然后释放其余的。发生这种情况时，该过程不能中断，您可能已经注意到，它可能需要数百毫秒。

它的执行频率和长度与您创建和销毁的对象数量成正比，但除非您完全禁用它，否则您无法控制。我的经验是有几个不令人满意的策略来平滑我的 Ruby 动画循环：

*   GC.disable / GC.enable 围绕关键动画循环，也许是一个机会主义的 GC.start 在它不会造成任何伤害时强制它去。（因为我当时的目标平台是一台 64MB 的 Windows NT 机器，这会导致系统偶尔耗尽内存。但从根本上说这是一个坏主意 - 除非您可以在执行此操作之前预先计算您可能需要多少内存，否则您'冒着内存耗尽的风险）
*   减少您创建的对象数量，从而减少 GC 要做的工作（减少其执行的频率/长度）
*   用 C 重写你的动画循环（一个逃避，但我选择了那个！）

这些天我可能还会看看 JRuby 是否可以作为替代运行时工作，因为我相信它依赖于 Java 更复杂的垃圾收集器。

我发现的另一个主要性能问题是不久前尝试用 Ruby 编写 TFTP 服务器时的基本 I/O（是的，我为我的性能关键项目选择了所有最好的语言，这只是一个实验）。最简单的最紧凑的循环简单地响应一个 UDP 数据包与另一个，包含文件的下一部分，肯定比股票 C 版本慢 20 倍。我怀疑基于使用低级 IO（sysread 等）可能已经进行了一些改进，但速度缓慢可能只是因为没有低级字节数据类型 - 每个小读取都被复制到一个细绳。虽然这只是猜测，我并没有进一步推进这个项目，但它警告我不要依赖 snappy I/O。

尽管我在这里没有完全更新，但最近的主要速度增加是虚拟机实现在 1.9 中重做，从而加快了代码执行速度。但是[我认为 GC 没有改变](http://svn.ruby-lang.org/cgi-bin/viewvc.cgi/trunk/gc.c?view=log)，而且我很确定 I/O 方面没有什么新东西。但我并不完全了解最新的 Ruby，所以其他人可能想在这里插手。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-06-18T11:05:30.403

我假设您在问，“Ruby 中的哪些特定技术往往很慢”。

一是对象实例化。如果你正在做大量的事情，你想看看（合理的）减少它的方法，比如使用[flyweight 模式](http://en.wikipedia.org/wiki/Flyweight_pattern)，即使内存使用不是问题。在一个库中，我对其进行了重新设计，不再一遍又一遍地创建大量非常相似的对象，我将库的整体速度提高了一倍。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-06-18T08:46:59.730

Steve Dekorte：“用高级语言编写 Mandelbrot 集合计算器就像试图在公共汽车上运行 Indy 500。”

[http://www.dekorte.com/blog/blog.cgi?do=item&id=4047](http://www.dekorte.com/blog/blog.cgi?do=item&id=4047)

我建议学习各种工具，以便为工作使用正确的工具。使用高级 API 可以有效地进行矩阵转换，该 API 使用算术密集型计算围绕紧密循环。有关将 C 或 C++ 代码嵌入 Ruby 脚本的示例，请参阅 RubyInline gem。

还有一种比 Ruby 慢得多的 Io 语言，但它在 Pixar 中有效地渲染电影，并通过使用 SIMD 加速在矢量算术上优于原始 C。

*   [http://iolanguage.com](http://iolanguage.com)
*   [https://renderman.pixar.com/products/tools/it.html](https://renderman.pixar.com/products/tools/it.html)
*   [http://iolanguage.com/scm/git/checkout/Io/docs/IoGuide.html#Primitives-Vector](http://iolanguage.com/scm/git/checkout/Io/docs/IoGuide.html#Primitives-Vector)

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-06-18T08:32:46.233

根据一些基准测试，Ruby 1.9.1 的速度大约是 PHP 的两倍，并且比 Perl 快一点。

（更新：我的来源是[这个](http://mwrc2009.confreaks.com/13-mar-2009-11-55-the-great-rails-refactor-yehuda-katz.html)（[截图](http://img.skitch.com/20090622-f5gkwpjy3umbpn3gp8rtt8afsu.jpg)）。不过，我不知道他的来源是什么。）

红宝石并不慢。旧的 1.8 是，但当前的 Ruby 不是。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2011-04-25T15:53:55.290

Ruby 很慢，因为它旨在优化程序员的体验，而不是程序的执行时间。缓慢只是该设计决策的一个症状。如果您更喜欢表演而不是娱乐，您可能应该使用不同的语言。Ruby 并不是万能的。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2011-01-28T15:01:13.833

IMO，动态语言一般都很慢。他们在运行时做一些静态语言在编译时间中所做的事情。

语法检查、解释和类似类型检查、转换。这是不可避免的，因此 ruby​​ 比 c/c++/java 慢，如果我错了，请纠正我。

# latex - 从 LaTeX 包中加载单个符号

> ID：1011462
> 
> 赞同：4
> 
> 时间：2009-06-18T08:28:55.510
> 
> 标签：latex, package, symbols

使用 MnSymbol 包时，pdflatex 会给出两个字体警告：

```
LaTeX Font Warning: Encoding 'OMS' has changed to 'U' for symbol font
(Font)              'symbols' in the math version 'normal' on input line 120.

LaTeX Font Info:    Overwriting symbol font 'symbols' in version 'normal'
(Font)                  OMS/cmsy/m/n --> U/MnSymbolF/m/n on input line 120. 
```

事实证明，这可能是由于与 AMSSymb 包的冲突。

因为我只需要包中的几个符号：有没有办法从包中加载一个符号，而不是全部？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-26T07:20:14.003

这些警告无需担心。事实上，在下一个 LaTeX 版本中它们会消失（参见[原始错误报告](http://www.latex-project.org/cgi-bin/ltxbugs2html?pr=latex/3975)）。然而，没有ETA。

> 此外，这是否真的有可能影响文档的排版？

没有。

> 有什么办法可以防止这种情况吗？

可以在加载包之前修补 LaTeX 警告消息代码，然后再恢复它（这是我过去在自己的包中所做的），但作为用户，我只是学会忽略警告。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-03-14T12:18:52.623

这是我解决这个问题的方法：

从综合乳胶符号文档源下载perl脚本“makefakeMnSymbol”：http: [//mirror.ctan.org/info/symbols/comprehensive/source/makefakeMnSymbol](http://mirror.ctan.org/info/symbols/comprehensive/source/makefakeMnSymbol)

接下来，在命令行执行`chmod +x makefakeMnSymbol`以使其可执行。然后，运行

```
./makefakeMnSymbol `kpsewhich MnSymbol.sty` > fakeMnSymbol.sty 
```

将 fakeMnSymbol.sty 放在选择的 texmf 目录（全局或本地）中，然后运行`texhash`

如果你现在把

```
\usepackage{fakeMnSymbol} 
```

在您的序言中，您现在可以使用任何 MnSymbol，例如`\powerset`通过添加前缀`\MNSpowerset`

非常感谢 Scott Pakin 的这次黑客攻击......以及他全面的符号指南......

* * *

此 hack 存在下标/上标中的符号问题。一种解决方法是使用查看`fakeMnSymbol.sty`源来查找您想要的符号是从哪个字体加载的，以及它的编号。`\boxminus`这是我的序言之一中的一个示例，其中我用 MnSymbol覆盖了内置：

```
\usepackage[]{fakeMnSymbol}
\DeclareSymbolFont{mnsymbolc}{U}{MnSymbolC}{m}{n}
\let\boxminus=\undefined
\DeclareMathSymbol{\boxminus}{2}{mnsymbolc}{112} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-02-14T19:54:19.043

以下可能会有所帮助。这是我必须添加的代码，以便从 MnSymbol 包中获取 \bigominus 符号。

```
\DeclareFontFamily{U}{MnSymbolF}{}<br>
\DeclareSymbolFont{mnsymbols}{U}{MnSymbolF}{m}{n}<br>
\DeclareFontShape{U}{MnSymbolF}{m}{n}{<br>
    <-6>  MnSymbolF5<br>
   <6-7>  MnSymbolF6<br>
   <7-8>  MnSymbolF7<br>
   <8-9>  MnSymbolF8<br>
   <9-10> MnSymbolF9<br>
  <10-12> MnSymbolF10<br>
  <12->   MnSymbolF12}{}<br>
\DeclareMathSymbol{\bigominus}{\mathop}{mnsymbols}{55} 
```

# java - 创建文件导致问题，File.getPath() 似乎不起作用

> ID：1011463
> 
> 赞同：1
> 
> 时间：2009-06-18T08:28:55.510
> 
> 标签：java, file-io

我正在尝试为 Web 服务器上的 html 文件创建备份文件。

我希望备份与现有文件位于同一位置（这是一个快速修复）。我想使用 File file = new File(PathName); 创建文件

```
public void backUpOldPage(String oldContent) throws IOException{
            // this.uri is a class variable with the path of the file to be backed up
    String fileName = new File(this.uri).getName();
    String pathName = new File(this.uri).getPath();
    System.out.println(pathName);
    String bckPath = pathName+"\\"+bckName;

    FileOutputStream fout;      

    try
    {
        // Open an output stream
        fout = new FileOutputStream (bckFile);
        fout.close();       
    }
    // Catches any error conditions
    catch (IOException e)
    {
        System.err.println ("Unable to write to file");
        System.exit(-1);
    }
} 
```

但是，如果我要像这样设置 bckPath，它将起作用。

```
String bckPath = "C://dev/server/tomcat6/webapps/sample-site/index_sdjf---sd.html"; 
```

我在 Windows 上工作，不确定这是否会有所不同。

String bckPath = pathName+"\"+bckName的结果；是 bckPath = C:\dev\server\tomcat6\webapps\sample-site\filename.html - 这不会产生新文件。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-18T08:49:30.570

使用 File.pathSeparator，这样您就不必担心您使用的是什么操作系统。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-18T09:03:38.183

尝试使用[`File.getCanonicalPath()`](http://java.sun.com/javase/6/docs/api/)而不是 plain `getPath()`。如果未完全指定原始路径，这将有所帮助。

关于斜杠，/ 或 \ 或`File.pathSeparator`不会导致问题，因为它们在 Windows 和 Java 上都是相同的。（而且你没有`bckFile`在你的代码中定义，只有`bckPath`。也用于`getCanonicalPath()`新创建的`bckPath`。）

# open-source - 你如何建立一个问答网站？

> ID：1011468
> 
> 赞同：0
> 
> 时间：2009-06-18T08:29:50.623
> 
> 标签：open-source, sites

有没有开源平台可以让开发者快速搭建问答网站？例如，StackOverflow 是从头开始构建的，还是利用了现有平台？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-18T08:33:58.103

据我所知，Stackoverflow 是使用 .net 从头开始​​构建的

这是 Google 的一个演示文稿，解释了堆栈溢出背后的想法

[http://www.youtube.com/watch?v=NWHfY_lvKIQ](http://www.youtube.com/watch?v=NWHfY_lvKIQ)

前段时间 SO 上有一个人写了一个问题，问了一个类似的问题并回答说他已经构建了类似 SO 的东西并使其开源 - 它被称为 Stacked。

[http://ra-ajax.org/stacked-an-open-source-implementation-of-stackoverflow-com.blog](http://ra-ajax.org/stacked-an-open-source-implementation-of-stackoverflow-com.blog)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2012-10-07T20:52:53.073

[http://www.osqa.net/](http://www.osqa.net/)上有一个开源问答平台，它的外观和感觉与 stackexchange 站点非常相似。

用他们自己的话来说：

> OSQA 是您一直在等待的免费开源问答系统。您的 OSQA 站点不仅仅是一个常见问题解答页面，它还是一个功能齐全的问答社区。用户通过有用的参与获得积分和徽章，社区中的每个人都会获胜。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-18T08:40:17.857

SO 是在 .net 中从头开始构建的。伙计们已经讨论过将 SO 代码作为开源发布，但尚未做出决定。（见这里[https://stackoverflow.com/questions/7335/the-stackoverflow-source-code](https://stackoverflow.com/questions/7335/the-stackoverflow-source-code)和这里[​​ https://stackoverflow.fogbugz.com/default.asp?W4331](https://stackoverflow.fogbugz.com/default.asp?W4331)）。

您可以查看各种开源副本。Ankur提到了一个。还有cnprog（这里[http://code.google.com/p/cnprog/](http://code.google.com/p/cnprog/)）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-09-16T11:55:25.557

[DotNetNuke](http://www.dotnetnuke.com)很棒。它有很多模块可以用来做问答。而且由于它无处不在，因此有很多资源（包括 SO）可以让您获得帮助。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2014-01-16T17:17:34.827

有一个开源问答平台，看起来很有前途，它叫做 Shapado。还有一个付费版本，但代码，它内置在 ruby​​、mongomapper 和 mongodb 中，可在 Gitorious 上获得： [https ://gitorious.org/shapado](https://gitorious.org/shapado)

但是，它缺乏 Stack Overflow 的一些更丰富的功能，这些功能可以建立声誉并展示最佳内容。毫无疑问，你可以建立自己。

# python - 配置 Django 以使用 SQLAlchemy

> ID：1011476
> 
> 赞同：28
> 
> 时间：2009-06-18T08:31:04.303
> 
> 标签：python, django, sqlalchemy, configure

如何使用 SQLAlchemy 配置 Django？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2011-12-16T19:53:12.120

您可以在带有 Aldjemy 的 Django 项目中使用 SQLAlchemy：

[https://github.com/Deepwalker/aldjemy](https://github.com/Deepwalker/aldjemy)

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-06-18T08:34:42.347

检查这个：

[替换 django orm](http://lethain.com/entry/2008/jul/23/replacing-django-s-orm-with-sqlalchemy/)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-06-18T08:38:50.327

炼金术？:)

谷歌链接：

*   [用 sqlalchemy 替换 django-s-orm](http://lethain.com/entry/2008/jul/23/replacing-django-s-orm-with-sqlalchemy/)
*   [django-sqlalchemy](http://code.google.com/p/django-sqlalchemy/)
*   [谷歌群组](http://groups.google.com/group/django-developers/browse_thread/thread/5149e1c60dc65bff/a177bb34cfde1ec7?pli=1)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2014-12-20T10:54:37.680

[请找到这个关于如何在 Django 中使用 SQLAlchemy 的](http://rodic.fr/blog/sqlalchemy-django/)小教程

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2017-08-25T09:37:55.477

使用 SQLAlchemy 代替 Django ORM 有很多好处，但考虑**开发**一个内置的 Django 选择 SQLAlchemy（有一个叫做 的东西`a production ready`）

顺便说一句，Django ORM 变得更好了——在 Django 1.11 中，他们添加了`UNION`支持（一个 SQL 基本运算符），所以也许有一天不需要更改 ORM。

# c# - 继承多个形状 - ASP.NET MVC

> ID：1011480
> 
> 赞同：0
> 
> 时间：2009-06-18T08:31:30.167
> 
> 标签：c#, asp.net-mvc

我将多个形状返回到一个页面并使用我创建的 ViewData 类。这个类的命名空间是：

```
namespace IntranetMvcAreas.Areas.Accounts.Views.ContractsControl.ViewData 
```

我不确定它是否正确。在我尝试的页面中：

```
Inherits="System.Web.Mvc.ViewPage<ViewData.ContractsViewData>" 
```

但`ViewData`甚至不能在智能感知中解决，所以我不确定我做错了什么，但我无法访问任何可用的对象。

我也在控制器功能中这样做：

```
return View(new ContractsViewData(contracts, costCentres, userTerminals, serviceMapping, services)); 
```

它应该在视图中提供该 ViewData 对象。

有任何想法吗？

**编辑**

这是我在 web.config 中导入的命名空间

```
<namespaces>
    <add namespace="IntranetMvcAreas.Areas.Accounts.Models"/>
    <add namespace="System.Web.Mvc" />
    <add namespace="System.Web.Mvc.Ajax" />
    <add namespace="System.Web.Mvc.Html" />
    <add namespace="System.Web.Routing" />
    <add namespace="System.Linq" />
    <add namespace="System.Collections.Generic" />
</namespaces> 
```

我现在已将 ContractsViewData 移至 Models 文件夹。

**更新**

我重新创建了整个项目并从头开始构建它只是为了仔细检查。我正在使用[Phil Haack 的 AreaLib](http://haacked.com/archive/2008/11/04/areas-in-aspnetmvc.aspx)，我不确定这是否有什么不同。无论如何，我有一个 ViewModels 文件夹，其中包含一个名为 ViewData 的类`ContractsControlViewData.cs`，其中包含以下内容：

```
namespace Intranet.Areas.Accounts.ViewModels
{
  using Intranet.Areas.Accounts.Models;
  using System.Collections.Generic;

  public class ContractsControlViewData
  {
    public IEnumerable<Contract> Contracts { get; set; }
    public IEnumerable<tblCC_Contract_CC> tblCC_Contract_CCs { get; set; }
    public IEnumerable<tblCC_Contract_Data_Terminal> tblCC_Contract_Data_Terminals { get; set; }
    public IEnumerable<tblCC_CDT_Data_Service> tblCC_CDT_Data_Services { get; set; }
    public IEnumerable<tblCC_Data_Service> tblCC_Data_Services { get; set; }
  }
} 
```

然后在我的控制器中，我有以下内容：

```
 public ActionResult DataContracts()
        {
          IEnumerable<Contract> contracts;

          using(ContractsControlDataContext db = new ContractsControlDataContext())
          {
            IMultipleResults results = db.procCC_Contract_Select(null, null, null, null, null, null);
            contracts = results.GetResult<Contract>();
          }

          return View(new ContractsControlViewData {
            Contracts = contracts,
            tblCC_Contract_CCs = null,
            tblCC_Contract_Data_Terminals = null,
            tblCC_CDT_Data_Services = null,
            tblCC_Data_Services = null
          });
        } 
```

我的网络配置有以下内容：

```
 <namespaces>
    <add namespace="Intranet.Areas.Accounts.ViewModels"/>
    <add namespace="System.Web.Mvc"/>
    <add namespace="System.Web.Mvc.Ajax"/>
    <add namespace="System.Web.Mvc.Html"/>
    <add namespace="System.Web.Routing"/>
    <add namespace="System.Linq"/>
    <add namespace="System.Collections.Generic"/>
  </namespaces> 
```

我`ContractsControl.design.cs`的有以下（因为如果你把它放在部分类中它不起作用：

```
[Function(Name = "dbo.procCC_Contract_Select")]
    [ResultType(typeof(Contract))]
    [ResultType(typeof(tblCC_Contract_CC))]
    [ResultType(typeof(tblCC_Contract_Data_Terminal))]
    [ResultType(typeof(tblCC_CDT_Data_Service))]
    [ResultType(typeof(tblCC_Data_Service))]
    public IMultipleResults procCC_Contract_Select(
        [Parameter(Name = "ContractID", DbType = "Int")] System.Nullable<int> contractID,
        [Parameter(Name = "ContractTypeID", DbType = "Int")] System.Nullable<int> contractTypeID,
        [Parameter(Name = "ResponsibilityKey", DbType = "Int")] System.Nullable<int> responsibilityKey,
        [Parameter(Name = "ExpenseType", DbType = "Char(4)")] string expenseType,
        [Parameter(Name = "SupplierID", DbType = "Int")] System.Nullable<int> supplierID,
        [Parameter(Name = "BusinessID", DbType = "Char(4)")] string businessID)
    {
      IExecuteResult result = this.ExecuteMethodCall(this, ((MethodInfo)(MethodInfo.GetCurrentMethod())), contractID, contractTypeID, responsibilityKey, expenseType, supplierID, businessID);
      return (IMultipleResults)result.ReturnValue;
    } 
```

一旦我将泛型放在我的 Inherits 语句中，我就无法再访问 ViewData。此外，如果我将 sproc 函数声明放在部分类中，我将无法进行构建。

所以我不知道。我个人认为这是一个错误，但是让存储过程带回多个结果集并不是很好。事实上，这很可怕。

**编辑**

我发现唯一相关的是[这个链接](http://social.msdn.microsoft.com/Forums/en-US/linqprojectgeneral/thread/8c66d227-4b45-4f03-ae5a-87ba0051b953)。但是，当我清除应用程序设置并将其设置为 false 时，我的 *.designer.cs 文件被删除，这意味着我的 dbml 文件中的任何类都不可访问。

**编辑编辑**

在重新实现模型（再次）并按照 Ian 的想法添加以下内容后：

```
<PropertyGroup>
    <MvcBuildViews>true</MvcBuildViews>
</PropertyGroup> 
```

我现在收到以下错误：

```
Error   1   Could not load type 'System.Web.Mvc.ViewPage<ContractsControlViewData>'.    D:\temp\Areas\Accounts\Views\ContractsControl\DataContracts.aspx    2   Intranet 
```

但是，我尝试使用完全限定名称，还尝试将 ViewData 类与 View 放在同一文件夹中，并删除命名空间以确保它可用。由于某种原因它没有被看到，但至少它可能更接近了一步？我猜 ViewData 在视图中不可用，因为在继承语句中使用的泛型无效，这将解释它的那一部分。

还有什么想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-18T09:02:45.300

首先，您不必完全限定您的命名空间，因此以下内容就可以了。

```
Inherits="System.Web.Mvc.ViewPage<ContractsViewData>" 
```

然后，您需要导入该命名空间，以便 ViewModel 可以在视图中的 ViewData.Model 属性上访问。

我倾向于在同一个命名空间中创建我的视图模型，然后通过将以下内容添加到我的 web.config 将其导入所有视图。

```
<namespaces>
    <add namespace="IntranetMvcAreas.Areas.Accounts.Views.ContractsControl.ViewData"/>
</namespaces> 
```

或者，您可以在页面顶部导入命名空间，如下所示。

```
<%@ Import Namespace="IntranetMvcAreas.Areas.Accounts.Views.ContractsControl.ViewData"%> 
```

然后，您可以在您的视图中访问您的模型，如下所示。

```
<%= Model.Property %> 
```

希望这可以帮助。

**编辑**

我会尝试编译您的意见，看看问题出在哪里。在记事本中打开您的项目文件并按如下方式编辑 xml。

```
<PropertyGroup>
    <MvcBuildViews>true</MvcBuildViews>
</PropertyGroup> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-18T08:57:04.580

今天早上我不得不做一些类似的事情，让智能感知工作，因为我必须指定完整的类型定义。

```
Inherits="System.Web.Mvc.ViewPage<IntranetMvcAreas.Areas.Accounts.Views.ContractsControl.ViewData.ContractsViewData>" 
```

然后，您应该能够通过标记中模型属性的关联属性访问形状。

我希望我已经正确理解了这个问题，我希望这会有所帮助。

# iphone - 如何在 iPhone 应用程序中正确处理 applicationWillTerminate？

> ID：1011496
> 
> 赞同：1
> 
> 时间：2009-06-18T08:34:44.653
> 
> 标签：iphone, objective-c

我目前正在尝试编写 iPhone 应用程序，但在理解如何正确退出应用程序方面遇到了一些麻烦。

基本上，我有一个向用户显示数据表的视图控制器。同时，当应用程序启动时，它会启动一个新线程来从服务器检索数据并在后台更新表。数据正在写入本地 sqlite 数据库。

我担心的是，如果没有适当的清理和终止，工作线程完全有可能在一个讨厌的地方终止（比如，在写入期间）并使 sqlite db 损坏。如果要求应用程序终止，我想指示线程干净地退出。但是，据我所知，我的大多数对象甚至都没有调用 dealloc，因此实际上没有任何东西干净地退出。现在，我正在尝试处理 applicationWillTerminate 并可能在一两个重要类上调用某种自定义 finalize 方法。

所以...

1.  是否有一个保证的时间窗口，我必须通过调用 applicationWillTerminate 干净地响应和退出？
2.  还有其他干净退出的建议吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-18T08:42:24.203

当 applicationWillTerminate 被调用时，你有 5 秒的时间来做所有你想做的事情

如果您的应用程序退出时间超过 5 秒，系统可能会直接终止它。

[http://developer.apple.com/iphone/library/documentation/iPhone/Conceptual/iPhoneOSProgrammingGuide/ApplicationEnvironment/ApplicationEnvironment.html](http://developer.apple.com/iphone/library/documentation/iPhone/Conceptual/iPhoneOSProgrammingGuide/ApplicationEnvironment/ApplicationEnvironment.html)

# java - POJO 到 Google App Engine 中的 XML 字符串？

> ID：1011498
> 
> 赞同：2
> 
> 时间：2009-06-18T08:35:00.457
> 
> 标签：java, google-app-engine, xml-serialization

我想为我的 Java Google App Engine 程序创建一个 REST 接口。我想我会从我的 POJOS 生成一些 XML 开始。然而，XStream 似乎受到了 GAE 的限制。

我可以使用什么来在 Google App Engine 中生成 XML 字符串？

谢谢。

编辑1：这是例外的开始：

```
javax.servlet.ServletContext log: Exception while dispatching incoming RPC call
com.google.gwt.user.server.rpc.UnexpectedException: Service method 'public abstract    java.lang.String com.mydomain.client.ObjectService.sendObject(com.mydomain.client.models.myobject)' threw an unexpected exception: java.security.AccessControlException: access denied (java.io.SerializablePermission enableSubclassImplementation) 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-18T08:47:34.817

对于同样的限制（不过，补丁正在进行中）我结束了使用 org.json 库生成 JSON。此外，JAXB 似乎不在白名单中。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-18T08:52:14.370

异常是由 java.io.SerializablePermission 引起的，根据 javadoc 是为了允许：

> ObjectOutputStream 或 ObjectInputStream 的子类实现，分别覆盖对象的默认序列化或反序列化

XStream 可能在幕后使用对象流，并且违反了未授予此权限。

Google App Engine 是否真的有一个白名单，或者只是一组受限权限？JAXB2 不使用对象流，那么您真的尝试过吗？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-18T12:57:40.350

试试[Jersey——](http://jersey.java.net/)它将通过 REST 为您提供 XML、JSON 和更多内容；全部使用带注释的方法。

它对我有用，但是有一些警告：

看[这里](http://lqd.hybird.org/journal/?p=123)和[这里](http://blogs.oracle.com/naresh/entry/running_the_jersey_webapp_on)

# css - 使用 CSS 的角落图像

> ID：1011508
> 
> 赞同：2
> 
> 时间：2009-06-18T08:38:52.447
> 
> 标签：css

我有一个相对简单的设计让我感到困惑。它有 4 个大图像，需要贴在左上角、右下角和左下角、右上角。图像非常大，内容容器与它们重叠。有点像这样：

[结构 http://www.kalleload.net/uploads/nizyjc/zxyagpfrmjqe.png](http://www.kalleload.net/uploads/nizyjc/zxyagpfrmjqe.png)

我的问题是我的实现在除 IE8（我刚刚开始尊重）之外的所有主要浏览器中都能正常工作。有没有更好的方法可以做到这一点？

我目前正在使用以下标记：

```
<div class="corner-top">
    <div><img src="./images/top-left-corner.png" /></div>
</div>

<div class="corner-bottom">
    <img src="./images/bottom-left-corner.png" />
</div>

<div id="container">
....
</div>

#container {
    margin: 60px auto;
    width: 488px;
}

.corner-top {
    background: url('./images/top-right-corner.png') top right no-repeat;
    height: 356px;
    min-width: 868px;
    overflow: hidden;
    position: absolute;
    top: 0;
    width: 100%;
    z-index: -20;
}

.corner-top div {
    min-width: 868px;
}

.corner-bottom {
    background: url('./images/bottom-right-corner.png') bottom right no-repeat;
    bottom: 0;
    height: 325px;
    min-width: 868px;
    overflow: hidden;
    position: absolute;
    width: 100%;
    z-index: -20;
}

.corner-bottom div {
    min-width: 868px;
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-18T08:50:19.193

圆角有很多方法（基本相同）。我认为最舒服的一个是彼此有四个 div：

```
<div id="container" class="topleft"> 
  <div class="topright"> 
    <div class="bottomleft"> 
      <div class="bottomright"> 
         <!-- content -->
      </div>
    </div>
  </div>
</div> 
```

另一个优点是您不需要`<img>`标签。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-18T08:59:28.927

您可以尝试强制 IE8 进入 IE7 兼容模式。

戳

```
<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE7" /> 
```

在你的`<head>`

# windows - 自动 FTP 到 Windows 服务器

> ID：1011510
> 
> 赞同：1
> 
> 时间：2009-06-18T08:39:19.013
> 
> 标签：windows, ftp

我需要建立某种基础设施来自动将一些文件从一个远程服务器 FTP 到另一个。FTP 事务将按计划进行。这两个服务器都是 Windows 机器，需要 FTP 的文件的位置将取决于当前日期（它们所在的文件夹将被命名为当天的日期）。

我真的很讨厌不得不从头开始编写类似的东西，那么那里有工具/实用程序/类似的东西吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-18T10:24:05.980

Windows 命令行`ftp`将从文本文件中读取输入。例如：

```
ftp -ni < ftpscript.txt 
```

使用这些选项的地方：

*   `-n`- 抑制初始连接时的自动登录。
*   `-i`- 在多个文件传输期间关闭交互式提示。

`ftpscript.txt`看起来像这样：

```
open ftp.mycompany.com
user someuser password
binary
get /somedir/myfile.dat 
```

编写一个输出包含正确文件名的 FTP 脚本的脚本应该相当简单。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-18T08:47:15.207

你会认为这将是一件容易的事。它不是。

我发现的最好的工具是 SyncBack，我认为有一个免费/精简版可用。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-18T10:39:43.670

如果您在 Windows 环境中，请考虑使用 PowerShell 和 System.Net.WebClient .NET Framework 类，如[这篇文章](http://www.vistax64.com/powershell/17000-using-powershell-automate-ftp-transfers.html)。这是一个下载示例，但 WebClient 对象还提供了 UploadFile 方法。

# c# - 复杂类型的 SOAP 序列化时出现 InvalidOperationException

> ID：1011512
> 
> 赞同：6
> 
> 时间：2009-06-18T08:39:35.753
> 
> 标签：c#, .net, serialization, soap

我遇到了 SOAP 序列化的问题，很高兴找到答案。这是一个非常简化的示例：

```
public void Test()
{
    StringBuilder sb = new StringBuilder();
    StringWriter writer = new StringWriter(sb);

    SoapReflectionImporter importer = new SoapReflectionImporter();
    XmlTypeMapping map = importer.ImportTypeMapping(typeof(A));
    XmlSerializer serializer = new XmlSerializer(map);
    serializer.Serialize(writer, new A());
}

[Serializable]
public class A
{
    public A()
    {
        BB = new B();
    }

    public int a;

    public B BB;
}
[Serializable]
public class B
{
    public int A1 { get; set; }

    public int A2 { get; set; }
} 
```

如果我运行方法 Test() 那么我得到以下异常：`System.InvalidOperationException: Token StartElement in state Epilog would result in an invalid XML document.`

将不胜感激任何帮助。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-06-18T09:38:29.330

使用 XmlWriter 而不是 StringWriter 并执行 writer.WriteStartElement("root");

这将起作用：

```
Stream s = new MemoryStream();
XmlWriter writer = new XmlTextWriter(s, Encoding.UTF8);

SoapReflectionImporter importer = new SoapReflectionImporter();
XmlTypeMapping map = importer.ImportTypeMapping(typeof(A));
XmlSerializer serializer = new XmlSerializer(map);
writer.WriteStartElement("root");
serializer.Serialize(writer, new A());

StreamReader sr = new StreamReader(s);
string data = sr.ReadToEnd(); 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2010-08-31T10:46:23.970

请注意，如果流的位置未设置为流的开头，则上面的示例将不起作用。像这样：

```
Stream s = new MemoryStream();
XmlWriter writer = new XmlTextWriter(s, Encoding.UTF8);

SoapReflectionImporter importer = new SoapReflectionImporter();
XmlTypeMapping map = importer.ImportTypeMapping(typeof(A));
XmlSerializer serializer = new XmlSerializer(map);
writer.WriteStartElement("root");
serializer.Serialize(writer, new A());

s.Position = 0;
StreamReader sr = new StreamReader(s);
string data = sr.ReadToEnd(); 
```

# e-commerce - WorldPay 集成

> ID：1011518
> 
> 赞同：1
> 
> 时间：2009-06-18T08:41:13.410
> 
> 标签：e-commerce, worldpay

我被要求建立一个演示站点，调用 WorldPay 来授权交易。

我们还没有 MerchantID 或类似的东西，是否有可以在互联网上调用的虚拟服务，或者可以下载并且可以在本地安装？

我显然已经环顾四周，但到目前为止一无所获 - 这是一个直截了当的答案，所以想知道这里是否有人知道他们的头脑？

谢谢

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-18T08:48:25.033

几年前，但据我所知：

如果您（或您的客户）要注册 Worldpay，那么他们会同时提供真实账户和测试账户。
我似乎记得您必须通过测试帐户成功交易，然后他们才会为您激活实时帐户。

他们的支持部门过去非常有帮助，所以我建议只是给他们打个电话。让您启动和运行符合他们的利益，因此他们可以开始为此向您收费

# entity-framework - 实体框架EntityKey/外键问题

> ID：1011519
> 
> 赞同：7
> 
> 时间：2009-06-18T08:41:44.640
> 
> 标签：entity-framework, foreign-keys, entity, entitykey

作为表单发布的结果，我正在尝试保存新的品牌记录。在我看来，Gender 是一个下拉列表，返回一个 Integer，它由 ViewData("gender") 填充

我的链接设置如下：

```
gID = CInt(Request.Form("Gender"))
Brand.GenderReference.EntityKey = New EntityKey("DB_ENTITIES.Gender", "Id", gID)
TryUpdateModel(Brand)
DB.SaveChanges() 
```

这会导致以下错误。

```
Entities in 'DB_ENTITIES.Brand' participate in the 'FK_Brand_Gender' relationship. 0 related 'Gender' were found. 1 'Gender' is expected. 
```

有人可以用简单的英语向我解释这些参数。我也尝试过 DB.Gender 作为第一个参数，但没有任何乐趣。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-06-18T16:29:32.477

而不是创建一个 EntityKey 创建一个存根 Gender 对象（对不起，我不是 C# 中的 VB 人）：

```
Gender g = new Gender{ID = Int32.Parse(Request.Form("Gender"))}; 
```

然后将 Gender 附加到适当的位置（您从中获取 Gender 实体`EntitySet`的属性名称是下面的字符串）：`DB`

```
DB.AttachTo("Genders",g); 
```

这会将数据库置于 Gender`ObjectContext`处于未更改状态的状态，而无需进行数据库查询。现在你可以正常建立关系了

```
brand.Gender = g;
DB.AddToBrand(brand);
DB.SaveChanges(); 
```

这就是它的全部。没必要乱搞`EntityKeys`

希望这可以帮助

[亚历克斯](http://twitter.com/adjames)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-18T09:37:12.500

您需要的是 Brand 和 Gender 的实例，然后将 Brand.Gender 设置为 Gender 的实例。然后你可以毫无问题地保存。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-18T11:49:15.620

好的，这就是我想出的，而不是使用 updateModel。无论如何，这似乎是有问题的/潜在的安全风险，可能会在帖子中添加额外的字段。可以通过 trygetObjectByKey 实例化 Gender 的新实例。到目前为止，这是有效的。任何其他关于让 UpdateModel 更新 Gender 属性对象的建议表示赞赏。

```
Dim cID As Integer
cID = CInt(Request.Form("Gender"))
Dim key As New EntityKey(DB.DefaultContainerName() & ".Gender", "ID", cID)

Dim objGenderDS As New Gender
'Bring back the Gender object.
If DB.TryGetObjectByKey(key, objGenderDS) Then
Brand.GenderReference.EntityKey = key
Brand.Gender = objGenderDS
DB.AddToBrand(Brand)
DB.SaveChanges()
Else
End If 
```

# c++ - Windows 文件夹共享 API

> ID：1011520
> 
> 赞同：2
> 
> 时间：2009-06-18T08:42:19.960
> 
> 标签：c++, winapi, file-sharing

是否有 WIN32 API 可用于管理 Windows 中的文件夹共享？一些示例链接会有所帮助。谢谢。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-06-18T08:54:03.010

是的，从 Windows 2000 Professional 开始，netapi32.dll 中有一个网络 API 可用，它提供了这个功能。NetShareAdd、NetShareCheck、NetShareDel 等功能可让您管理共享文件。看

[http://msdn.microsoft.com/en-us/library/bb525393(VS.85).aspx](http://msdn.microsoft.com/en-us/library/bb525393(VS.85).aspx)

了解更多信息，

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-18T08:55:23.427

有[一个使用 C# 执行此操作的教程](http://www.codeproject.com/KB/system/Share-Folder-c_.aspx)，可能有帮助吗？

# c# - 这是正确的例外吗？

> ID：1011522
> 
> 赞同：0
> 
> 时间：2009-06-18T08:42:40.443
> 
> 标签：c#, xml, exception

我解析一个 XML 文件以加载数据，当我有一个具有无法识别值的属性时，我抛出一个 InvalidDataException。这是正确的还是有更好/更具描述性的

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-18T08:48:14.737

这对我来说似乎很合理。这不是我特别熟悉的例外（即我在其他 API 中没有遇到过），但它明白了这一点。

我想唯一的问题是`IOException`某种形式的 an 是否更合适。当然，这里的问题不是实际的*传输*——而是传输的内容。当然，这是一个灰色地带。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-18T08:50:02.160

该异常表明这是文件本身格式的错误，就像字符编码中的错误一样。XmlException 会更合适。

考虑改为抛出 ApplicationException，因为它不是 XML 格式的真正错误，而是 XML 包含的您的应用程序不接受的错误。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-18T09:20:25.030

如果您有一个已发布的模式，那么 SchemaValidationException 可能是合适的。

# c# - 无法访问包装在 WCF 中创建用户的 NetAPI32 函数

> ID：1011527
> 
> 赞同：0
> 
> 时间：2009-06-18T08:44:20.377
> 
> 标签：c#, wcf, .net-3.5, com, netapi32

我创建了一个项目，它基本上被描述为在远程计算机上创建或编辑用户的消耗性服务。这个想法是连接到服务器并添加用户。项目结构如下：

*   WCF 服务：公开功能以创建/编辑/选择用户

*   实用程序集：包装在实用程序类中的 Netapi32 COM 函数

*   消费者：包装对 WCF 服务的调用以在站点中使用的可用程序集

我遇到的问题是，我可以获得运行 WCF 服务的计算机上所有用户的列表，但我无法创建或编辑它们。它只给我只读功能。

有谁知道我如何能够解决这个问题甚至解决它？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-18T09:30:27.443

实际运行 WCF 服务的帐户很可能没有创建或编辑用户的权限。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-18T09:31:18.143

确保您的服务在实际有权创建用户的管理员用户下运行。如果您使用 IIS 的默认用户，我敢打赌它没有那种访问权限。

# introspection - 用于 PowerBuilder 应用程序的 Spy++

> ID：1011536
> 
> 赞同：7
> 
> 时间：2009-06-18T08:45:27.783
> 
> 标签：introspection, powerbuilder, code-injection, spy++

我正在尝试编写一个工具来检查基于 PowerBuilder 的应用程序的状态。我在想的是像 Spy++（或者，更好的是，'Snoop'，因为它存在于 .NET 应用程序）之类的东西，它可以让我检查一些基于 PowerBuilder 的 GUI 的对象树（和对象的属性）。

我已经对普通（基于 MFC）的应用程序和 .NET 应用程序做了同样的事情，但不幸的是我自己从未在 PowerBuilder 中开发过应用程序，所以我现在通常在考虑两个问题：

1.  是否有一些 API（最好是 Java 或 C/C++）可以让人们遍历 PowerBuilder 应用程序的可视对象树？我在 PowerBuilder Native Interface system 上阅读了一些内容，但似乎这意味着用 C/C++ 编写 PowerBuilder 扩展，然后可以从 PowerBuilder 脚本语言调用，对吧？

2.  如果有一些可用的 API - 也许 PowerBuilder 应用程序甚至会公开某种支持 IPC 的 API，它可以让我检查 PowerBuilder 对象层次结构的状态，而无需处于 PowerBuilder 应用程序的进程中？也许有可用的自动化接口，或者基于 COM 的东西——或者其他东西？

现在，我的印象是可能需要在 PowerBuilder 应用程序的进程中注入一个 DLL，然后获得对正在运行的 PowerBuilder VM 的访问权限，以便我可以查询它以获取对象树。某种 IPC 机制将让我将这些信息传输到 PowerBuilder 应用程序的进程之外。

有没有人有这方面的经验，或者可以阐明是否有人已经尝试过这样做？

最好的祝福，

*   弗里里希

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-06-18T19:48:57.830

首先，简单的答案：我认为你想要做的事情已经完成了，有点。[Enable 的 Rex](http://www.enable-pb.com/Objects/Pagina.asp?ID=77)做了我认为你所追求的，但 IIRC 与开发人员交谈，它取决于应用程序中内置的代码挂钩。

这导致我认为您无法完全从应用程序外部完成我认为您尝试做的事情的建议。您可以使用 WinAPI 获取窗口句柄并用它做一些基本的事情，但不是您想要的那么多。并通过 WinAPI 获取有关 DataWindows 的信息？忘了它。

我*相信*我听说过像您所询问的那样的 API，但我从未听说过其他自动化测试软件工具制造商接触过它。如果这是真的（并且此信息的质量类似于“在走廊里听到”），我怀疑让此信息泄露可能存在一些应用程序安全问题。（我知道*你*永远不想感染我的应用程序，或者四处寻找我的秘密。*咧嘴笑*）

即使有挂钩到 PowerBuilder VM 内存空间，我也不知道能够在没有一些 PowerScript 框架挂钩的情况下获取内存中的对象列表（例如，在每个打开和构造函数上使用对象句柄填充列表）。获得窗口句柄后，您可以轻松地遍历其控件数组（及其子类控件数组）以获取窗口上的对象列表，但诸如 NVO 实例变量的句柄之类的东西会出现问题。

我很欣赏这个想法。我希望我有更好的消息（也许 Rex 可能会解决您的问题而不必自己动手）。现在我更加期待eran 会发布什么！*咧嘴笑*

祝你好运，

特里。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-06-18T10:27:45.970

我刚刚创建了这样一个工具，但我作弊了一点。实际上我自己要在 PB 新闻组上问同样的问题。我的解决方案由两部分组成：

**Spy-like tool** - 一个类似于 Spy++ 的独立应用程序，即允许您将目标拖到控件上，使用 Windows API 函数（虽然是用 PB 编写的）。

**目标应用程序的内部基础设施**- 位于所有应用程序窗口的祖先。一旦给定了某个（windows）句柄，它就会通过 Control[] 数组并查找其句柄与给定句柄匹配的控件。如有必要，它还会递归到诸如选项卡之类的控件容器中。

当用户选择一个控件时，spy 工具首先使用 Windows API 查找它的包含窗口。找到后，该工具会向该窗口发送一条自定义消息，然后由应用程序的基础架构处理。然后该控件位于 PB 应用程序中，其详细信息最终被发送回间谍工具，该工具将其呈现给用户。

我怀疑基础设施部分可以用一些外部东西代替，因为我已经看到似乎能够做到这一点的工具（Visual Expert，QTP）。但是，我没有时间进一步研究，而且这个解决方案相对容易开发。

我不得不说，你的问题来得正是时候。请参阅[我最近提出的这个问题](https://stackoverflow.com/questions/1003134/is-contributing-internal-tools-to-open-source-worth-the-effort)。如果您对我创建的工具感兴趣，请给我留言。

# nhibernate - 为什么调用 NHibernate AdoTransaction 的终结器？

> ID：1011537
> 
> 赞同：1
> 
> 时间：2009-06-18T08:46:03.057
> 
> 标签：nhibernate, dispose, finalizer

我正在分析单元和集成测试，我发现很多时间都花在了 NHibernate.Transaction.AdoTransaction 的终结器上——这意味着它没有得到正确处理。

我没有直接在代码中使用 AdoTransaction，所以它可能被 NHibernate 中的其他对象使用。知道我忘记处理什么了吗？

这是我的文本夹具：

```
public abstract class AbstractInMemoryFixture
{
    protected ISessionFactory sessionFactory;
    protected ILogger Logger { get; private set; }
    static readonly Configuration config;
    private static readonly ISessionFactory internalSessionFactory;

    static AbstractInMemoryFixture()
    {
        config = new NHibernateConfigurator().Configure(NHibernateConfigurators.SQLiteInMemory());
        internalSessionFactory = config.BuildSessionFactory();
    }

    [SetUp]
    public void SetUp()
    {
        const string sqliteInMemoryConnectionString = "Data Source=:memory:;Version=3;Pooling=False;Max Pool Size=1;";
        var con = new SQLiteConnection(sqliteInMemoryConnectionString);
        con.Open();
        new SchemaExport(config).Execute(false, true, false, true, con, System.Console.Out);
        var proxyGenerator = new ProxyGenerator();

        sessionFactory = proxyGenerator.CreateInterfaceProxyWithTarget(internalSessionFactory, new UseExistingConnectionInterceptor(con));
        Logger = new NullLogger();

        ExtraSetup();
    }

    [TearDown]
    public void TearDown()
    {
        var con = sessionFactory.OpenSession().Connection;
        if (con != null)
        {
            if (con.State == ConnectionState.Open)
                con.Close();
            con.Dispose();
        }
    }

    private class UseExistingConnectionInterceptor :IInterceptor
    {
        private readonly SQLiteConnection connection;

        public UseExistingConnectionInterceptor(SQLiteConnection connection)
        {
            this.connection = connection;
        }

        public void Intercept(IInvocation invocation)
        {
            if (invocation.Method.Name != "OpenSession" || invocation.Method.GetParameters().Length > 0)
            {
                invocation.Proceed();
                return;
            }
            var factory = (ISessionFactory) invocation.InvocationTarget;
            invocation.ReturnValue = factory.OpenSession(connection);
        }
    }
    protected virtual void ExtraSetup() { }
} 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-11-12T14:34:41.600

我在访问 Sybase 数据库时遇到了同样的问题。我不知道为什么，也不是问题的真正原因，但似乎[`\NHibernate\Transaction\AdoTransaction.cs`](http://nhibernate.svn.sourceforge.net/viewvc/nhibernate/trunk/nhibernate/src/NHibernate/Transaction/AdoTransaction.cs?revision=4266&view=markup)（第 307 到 311 行）中与关闭/处置对象相关的一些代码已被禁用了一段时间。不幸的是，SVN 的责备功能并没有提供太多信息:(

# php - 您如何为从 CSV 和登录过程中获取的 ID/密码信息编写代码？

> ID：1011538
> 
> 赞同：1
> 
> 时间：2009-06-18T08:46:17.050
> 
> 标签：php, authentication, csv, login

我以为我应该使用**JSON**作为 ID/pass 存储格式一次，但我研究了一下，后来发现 JSON对我**来说太难**了，所以现在我正在考虑使用**CSV**。

CSV 文件将是这样的。文件名为**id.csv。**

```
aaa_id,aaa_pass
bbb_id,bbb_pass
ccc_id,ccc_pass 
```

左列是 id，右列是密码，每个信息用逗号分隔。登录表单是**login.php**。这是我的 login.php 示例。

```
<form method="post" action="login-process.php">
id <input type="text" name="id" size="20"><br>
pass <input type="text" name="pass" size="20"><br>
<input type="submit" value="login">
</form> 
```

现在我需要编写**login-process.php**

```
<?php

error_reporting(0);

$handle = fopen("id.csv", "r");
while (($data = fgetcsv($handle)) !== FALSE) {
    print $data['0'];
    print "=>";
    print $data['1'];
    print "<br>";
}
?> 
```

当我执行这个脚本时，它显示为：

```
aaa_id=>aaa_pass
bbb_id=>bbb_pass
ccc_id=>ccc_pass 
```

我觉得我接近最终目标，但我需要编写验证代码。

如何改进此代码？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-18T08:49:50.070

既然你没有涵盖我认为是一个非常明显的问题，我必须问它：

你为什么不为此使用数据库？PHP 和 MySQL 有一种美好的、美好的关系，在这种情况下，这种关系简直是一种侮辱。除非你有一个特别特殊的情况使你无法使用数据库——老实说，我无法想到我的头脑——你应该继续并切换你的代码以使用数据库。它们*更快*、*更*容易、*更好*。但是，出于本网站的目的，有关如何操作的教程将相当冗长。您应该考虑阅读有关该主题的[许多在线教程](http://www.google.com/search?q=php+mysql)，或者购买一本书。

**编辑**：

因为必须担心 SQL 注入而避免使用数据库就像因为必须担心 XSS 攻击而完全避免创建网站，或者因为可能会编写错误而完全避免编写代码。尽管由于存在许多天真的程序员，SQL 注入是流行的安全漏洞，但通过在[MySQLi](http://www.php.net/mysqli)或[PDO](http://www.php.net/pdo)中使用准备好的语句来保护自己免受它们的侵害是*微不足道*的。

作为旁注，将密码存储为纯文本是一个[可怕的想法](https://stackoverflow.com/questions/674904/salting-your-password-best-practices)。正确的方法是在插入数据库时​​对密码进行单向加密，并且每当您想检查是否有人提供了正确的密码时，您*对该*密码进行加密并将其与数据库中的密码进行比较。如果你不这样做，你只是在自找麻烦。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-18T08:58:19.210

首先，我同意 Paolo 所说的，这绝对是错误的做法。除了他所说的：

*   随着文件中有更多用户，登录过程将变得越来越慢（这可能在一定程度上适用于任何系统，但我认为这在这里很重要）
*   在文件中间进行更改将是一个完全的痛苦
*   让多个脚本实例同时尝试写入文件可能会导致损坏/丢失数据

* * *

但是，如果您有一个包含“用户名”和“密码”字段的表单，您可以像下面这样处理它。我正在争论是否应该删除代码以避免人们实际编写这样的东西的风险。

```
<?php

$username = trim($_POST['username']);
$password = trim($_POST['password']);

if (!strlen($username) || !strlen($password)) {
    die('Please enter a username and password');
}

$success = false;

$handle = fopen("test.csv", "r");

while (($data = fgetcsv($handle)) !== FALSE) {
    if ($data[0] == $username && $data[1] == $password) {
        $success = true;
        break;
    }
}

fclose($handle);

if ($success) {
    // they logged in ok
} else {
    // login failed
} 
```

您可能需要阅读有关使用[Sessions](http://www.php.net/session)的内容，以记住用户是跨多个页面请求登录的。

# c# - 抑制退格，删除 MaskedTextbox 中的键

> ID：1011550
> 
> 赞同：1
> 
> 时间：2009-06-18T08:49:18.743
> 
> 标签：c#, winforms

问题很简单：怎么做？我有几个由一些间接用户操作填充的 MaskedTextboxes（所以不是通过直接输入值）。当输入被掩码拒绝时，文本框中的文本会显示为红色。到目前为止还好。

但是，我不希望最终用户能够直接编辑这些框。所以，我添加了以下代码：

```
 private void HandleMaskedTextBoxKeyPress(object sender, KeyPressEventArgs e)
    {
        e.Handled = true;
    }

    private void HandleMaskedTextBoxKeyDown(object sender, KeyEventArgs e)
    {
        e.Handled = true;
        e.SuppressKeyPress = true;
    } 
```

虽然处理了大多数字符，但退格键和删除键却没有：按下这些键时文本会消失。如何处理这些密钥呢？

（另一种选择是将`readonly`框的属性设置为`true`，但是当输入被拒绝时，文本不再变为红色。我试图在`MaskInputRejected`事件中强制使用红色，但这也没有成功.)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-18T09:47:02.933

我认为将`MaskedTextBox`'`ReadOnly`属性设置为`true`. `MaskInputRejected`但是，您应该像这样使用事件，而不是处理事件`TypeValidationCompleted`：

```
private void maskedTextBox1_TypeValidationCompleted(object sender, TypeValidationEventArgs e) {
  maskedTextBox1.ForeColor = e.IsValidInput ? Color.Black : Color.Red;
} 
```

由于我猜您正在修改`MaskedTextBox`by 代码的值，因此您还必须处理`TextChanged`事件以触发如下验证：

```
private void maskedTextBox1_TextChanged(object sender, EventArgs e) {
  maskedTextBox1.ValidateText();
} 
```

最后（这是关键），由于`MaskedTextBox`将是只读的，因此您需要将`BackColor`和`ForeColor`属性分别设置回`Color.White`和`Color.Black`，但您必须在代码中进行，例如在表单的构造函数中。 .

```
maskedTextBox1.BackColor = Color.White;
maskedTextBox1.ForeColor = Color.Black; 
```

如果你有很多，我建议你创建一个继承`MasketTextBox`并覆盖这些值的新控件。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-18T09:21:17.837

您可以使用富文本框。将只读设置为 true，并使用后面的代码屏蔽字符。

我希望这会有所帮助。RG

# c# - 如何创建具有可在设计器中编辑的 IPAddress 属性的控件？

> ID：1011553
> 
> 赞同：0
> 
> 时间：2009-06-18T08:49:44.937
> 
> 标签：c#, .net, winforms, ip-address, designer

我正在创建一个具有 type 属性的控件`System.Net.IPAddress`。设计者将这些显示为只读，并且似乎将它们与资源相匹配。有没有办法让用户可以在设计器属性窗口中编辑这些属性，而不必打开资源编辑器？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-18T09:02:04.180

找到它 - 答案是伪造它：

```
[Browsable(true)]
[DisplayName("IPAddress")]
public string IPAddressText
{
    get { return this.IPAddress.ToString(); }
    set { this.IPAddress = IPAddress.Parse(value); }
}

[Browsable(false)]
[DesignerSerializationVisibility(DesignerSerializationVisibility.Hidden)]
public IPAddress IPAddress
{
    get;
    set;
} 
```

# git - 在 Git 中签出新分支后，有没有办法触发挂钩？

> ID：1011557
> 
> 赞同：49
> 
> 时间：2009-06-18T08:50:10.537
> 
> 标签：git, githooks

在 Git 中签出新分支后，有没有办法触发挂钩？

* * *

## 回答 #1

> 赞同：52
> 
> 时间：2014-01-02T22:18:21.423

git hook 是放置在存储库的特殊位置的脚本，该位置是：

> .git/钩子

该脚本可以是您可以在您的环境中执行的任何类型，例如 bash、python、ruby 等。

结帐后执行的钩子是[post-checkout](http://git-scm.com/docs/githooks.html)。从文档：

> ...钩子有三个参数...

**例子：**

1.  创建钩子（脚本）：

    ```
    touch .git/hooks/post-checkout
    chmod u+x .git/hooks/post-checkout 
    ```

2.  挂钩示例内容：

```
#!/bin/bash                                                                      

set -e                                                                           

printf '\npost-checkout hook\n\n'                                                

prevHEAD=$1                                                                      
newHEAD=$2                                                                       
checkoutType=$3                                                                  

[[ $checkoutType == 1 ]] && checkoutType='branch' ||                             
                            checkoutType='file' ;                                

echo 'Checkout type: '$checkoutType                                              
echo '    prev HEAD: '`git name-rev --name-only $prevHEAD`                       
echo '     new HEAD: '`git name-rev --name-only $newHEAD` 
```

注意：第一行的 shebang 表示脚本的类型。

这个脚本（git hook）只会捕获传递的三个参数，并以人性化的格式打印出来。

* * *

## 回答 #2

> 赞同：40
> 
> 时间：2009-06-18T09:33:55.253

如果这些钩子中的一个不能做到这一点，我会感到惊讶：

[https://schacon.github.io/git/githooks.html](https://schacon.github.io/git/githooks.html)

也许[这个](https://schacon.github.io/git/githooks.html#_post_checkout)：

> 结帐后
> 
> 在更新工作树后运行 git-checkout 时会调用此挂钩。钩子被赋予了三个参数：前一个 HEAD 的 ref，新 HEAD 的 ref（可能已经改变也可能没有改变），以及一个指示检出是否是分支检出的标志（改变分支，标志 = 1）或文件检出（从索引中检索文件，标志=0）。这个钩子不会影响 git-checkout 的结果。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2016-02-03T16:09:55.197

与其他类似，但验证分支已被检出一次。

```
#!/bin/bash

# this is a file checkout – do nothing
if [ "$3" == "0" ]; then exit; fi

BRANCH_NAME=$(git symbolic-ref --short -q HEAD)
NUM_CHECKOUTS=`git reflog --date=local | grep -o ${BRANCH_NAME} | wc -l`

#if the refs of the previous and new heads are the same 
#AND the number of checkouts equals one, a new branch has been created
if [ "$1" == "$2"  ] && [ ${NUM_CHECKOUTS} -eq 1 ]; then
    git push origin ${BRANCH_NAME}
fi 
```

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2016-01-22T00:26:08.980

`post-checkout` [钩子](https://git-scm.com/docs/githooks)接收三个参数：

1.  前 HEAD 的参考
2.  新 HEAD 的参考
3.  这是文件检出 ( `0`) 还是分支检出 ( `1`)

您可以使用从当前 HEAD 创建的分支对于参数 1 和 2 具有相同值的事实。

```
cat > .git/hooks/post-checkout <<"EOF"
if [ "$3" == "0" ]; then exit; fi
if [ "$1" == "$2" ]; then 
  echo "New branch created. (Probably)."
fi
EOF

chmod u+x .git/hooks/post-checkout 
```

限制：

*   检查一个恰好与当前 HEAD 位于同一个 HEAD 的现有分支会欺骗它。
*   *不会检测到不是*从当前 HEAD创建新分支。

# apache - 寻找允许 .htaccess 的“localhost”apache 服务器

> ID：1011560
> 
> 赞同：0
> 
> 时间：2009-06-18T08:50:31.363
> 
> 标签：apache, .htaccess, xampp

是否有一些 apache 服务器软件可以安装在我的 Windows PC 上（用于本地开发目的），它还允许 .htaccess 进行 URL 重写？

我目前正在使用 Xampp，它似乎不提供此功能（尽管我可能错了）。

任何建议将不胜感激。

谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-18T08:55:56.860

您必须在 apache 配置中激活 mod_rewrite。转到您的 xampp 文件夹，您将在 apache/conf/ 中找到 httpd.conf 文件。打开它并使用：

```
#LoadModule rewrite_module modules/mod_rewrite.so 
```

将其更改为

```
LoadModule rewrite_module modules/mod_rewrite.so 
```

保存 httpd.conf 并重新启动您的 apache。现在 mod_rewrite 应该可以工作了。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-18T08:59:00.003

Xampp 会这样做，您需要先启用 mod_rewrite。

打开安装 Xampp 的目录，然后在记事本中打开 \apache\conf\httpd.conf 并搜索 mod_rewrite。

通过从开头删除 # 取消注释该行。默认情况下 mod_rewrite 在全新安装时被禁用。

```
LoadModule rewrite_module modules/mod_rewrite.so 
```

重新启动 Xamppp 现在应该采用 .htaccess 规则。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-18T08:57:29.057

确实，默认情况下，Windows 上的 Xampp 不支持 URL 重写。然而，这是一个非常简单的修复：

1.  在您的 httpd.conf 文件中，找到包含“mod_rewrite”的行并删除它前面的 #
2.  再次在您的 httpd.conf 文件中，找到所有出现的 AllowOverride None 并将其更改为 AllowOverride All
3.  重启apache就完成了：）

# language-agnostic - 输入数据验证的正确位置是什么？

> ID：1011567
> 
> 赞同：1
> 
> 时间：2009-06-18T08:52:21.827
> 
> 标签：language-agnostic, validation

*（注：[这](https://stackoverflow.com/questions/786650/what-is-the-better-way-place-for-validation) [两个](https://stackoverflow.com/questions/806439/place-for-validation)问题类似，但更具体到 ASP.Net）*

考虑一个带有富客户端（在我的例子中是 Flex）的典型 Web 应用程序，其中您有一个表单，一个将表单的输入映射到数据模型的底层客户端逻辑，以及将这些对象远程处理到服务器逻辑的某种方式，这通常将其放入数据库中。

我应该——一般来说——把验证逻辑放在哪里，即确保电子邮件地址、数字等的正确格式？

1.  越早越好。像 Flex 这样的富客户端框架提供了内置的验证器逻辑，让您可以在表单提交时进行验证，甚至在它到达您的数据模型之前。这很好并且响应迅速，但是如果您开发了一些可扩展的东西并且您希望验证以防止后来的贡献者的编程错误，这并没有抓住它。
2.  在客户端的数据模型上。由于这是您的数据的“官方”表示，并且您已经拥有数据类型和 getter / setter，因此此验证会捕获扩展系统的人员的用户错误和编程错误。
3.  在服务器上收到数据后。这增加了对以后可能加入系统的损坏或恶意客户端的保护。同样在多客户端场景中，这为您提供了一个权威的验证来源。
4.  就在您将数据存储在后端之前。这包括防止链中任何地方发生的所有错误（存储逻辑本身除外），但可能需要一直冒泡错误。

我有点倾向于同时使用 2 和 4，因为我正在构建一个具有第三方潜在扩展点的应用程序。除了 4 之外使用 2 似乎是多余的，但我认为它使客户端应用程序的行为更加用户友好，因为它不需要往返服务器来查看数据是否正常。你的方法是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-18T09:07:32.107

只有一条规则始终**至少**使用某种**服务器验证**（列表中的数字 3/4）。

**客户端验证**（第 2/1 号）使用户体验更快捷并减少负载（因为您不会将未通过客户端验证的内容发布到服务器）。

需要指出的重要一点是，如果您只进行客户端验证，那么您将面临很大的风险（想象一下，如果您的客户端验证依赖于 javascript 并且用户在他们的浏览器上禁用了 javascript）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-18T09:09:23.447

无需太具体，我认为应该出于以下原因进行验证：

1.  让用户知道输入在某种程度上是不正确的。
2.  保护系统免受攻击。

`@`尽早让用户知道某些数据不正确会很友好——例如，在输入符号和域名之前，电子邮件输入字段可能具有红色背景。只有当电子邮件地址遵循 RFC 5321/5322 中的格式时，电子邮件字段才会变为绿色，并且可能会打上一个漂亮的复选标记，让用户知道电子邮件地址看起来不错。

此外，让用户知道所提供的信息在某些方面可能不正确也会很有帮助。例如，询问用户他或她是否真的打算让同一收件人两次接收同一封电子邮件。

然后，接下来应该在服务器端进行检查——永远不要假设传入的数据格式正确。执行检查以确保数据可靠，并提防任何攻击。

假设客户端会阻止 SQL 注入，并且盲目地接受来自与服务器的连接的数据可能是一个严重的漏洞。如前所述，如果服务器过于信任，其唯一目的是攻击系统的恶意客户端很容易破坏系统。

最后，执行任何检查以查看数据是否正确，并且逻辑可以正确处理数据。如果有任何问题，请通知用户任何问题。

我想，从我的角度来看，友好和防守就是归结为。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-18T09:14:19.067

肯定应该在服务器端进行验证。我认为应该尽早在服务器端进行验证，这样恶意（或不正确）数据进入系统的可能性就会降低。

客户端的输入验证很有帮助，因为它使界面更快捷，但不能保证进入服务器的数据已经通过客户端验证，因此必须在服务器端进行验证。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-18T09:38:35.197

由于安全性和便利性：服务器端和尽可能早但同样重要的是进行一些全局模型/业务逻辑验证，因此当您有多个具有公共数据（例如产品名称）的表单时，验证规则除非要求另有说明，否则应保持一致。

# ruby-on-rails - 为什么我的徽标没有出现在 Rails 的部分页面上？

> ID：1011571
> 
> 赞同：-1
> 
> 时间：2009-06-18T08:52:58.720
> 
> 标签：ruby-on-rails, ruby

我已经提出了申请，并且徽标出现在每个页面上。我的所有 3 个布局都是复制并粘贴为相同的。我有 2 个部分链接到同一个视图文件夹中的 2 个页面，并且徽标适用于其中一个，而不适用于另一个。它只显示`<img>`. 有没有办法解决这个问题？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-18T09:03:11.977

我建议-对此我深表歉意-显而易见的答案是您没有正确调用图像文件。

检查生成的 (x)html 中图像的 URI，以确保在完成的页面中，它指向正确的文件。在这些情况下，我自己的问题往往是删除句点（`../image.png`变成`./image.png`）、文件类型上的拼写错误（`image.png' as`image.pgp` -我不知道为什么）或其他一些基于拼写错误的问题。

抱歉，我不能更专业，但根据我的经验，这些是最常见的答案。

# openssl - 将 pem 密钥转换为 ssh-rsa 格式

> ID：1011572
> 
> 赞同：177
> 
> 时间：2009-06-18T08:53:28.050
> 
> 标签：openssl, openssh

我有一个`der`格式的证书，使用这个命令我生成一个公钥：

```
openssl x509 -inform der -in ejbcacert.cer -noout -pubkey > pub1key.pub 
```

结果是：

```
-----BEGIN PUBLIC KEY-----
MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQC7vbqajDw4o6gJy8UtmIbkcpnk
O3Kwc4qsEnSZp/TR+fQi62F79RHWmwKOtFmwteURgLbj7D/WGuNLGOfa/2vse3G2
eHnHl5CB8ruRX9fBl/KgwCVr2JaEuUm66bBQeP5XeBotdR4cvX38uPYivCDdPjJ1
QWPdspTBKcxeFbccDwIDAQAB
-----END PUBLIC KEY----- 
```

我怎样才能获得这样的公钥？来自证书还是来自这个公钥？

```
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAAAgQC7vbqajDw4o6gJy8UtmIbkcpnkO3Kwc4qsEnSZp/TR+fQi62F79RHWmwKOtFmwteURgLbj7D/WGuNLGOfa/2vse3G2eHnHl5CB8ruRX9fBl/KgwCVr2JaEuUm66bBQeP5XeBotdR4cvX38uPYivCDdPjJ1QWPdspTBKcxeFbccDw== 
```

这是通过以下命令获得的：

```
ssh-keygen -y -f private_key1.pem > public_key1.pub 
```

* * *

## 回答 #1

> 赞同：159
> 
> 时间：2011-05-24T14:57:11.263

不需要编译东西。您可以使用以下方法执行相同操作`ssh-keygen`：

```
ssh-keygen -f pub1key.pub -i 
```

将从中读取 openssl 格式的`pub1key.pub`公钥并以 OpenSSH 格式输出。

**注意**：在某些情况下，您需要指定输入格式：

```
ssh-keygen -f pub1key.pub -i -mPKCS8 
```

来自 ssh-keygen 文档（来自 man ssh-keygen）：

> -m **key_format**为 -i（导入）或 -e（导出）转换选项指定密钥格式。支持的密钥格式为：“RFC4716”（RFC 4716/SSH2 公钥或私钥）、“PKCS8”（PEM PKCS8 公钥）或“PEM”（PEM 公钥）。默认转换格式为“RFC4716”。

* * *

## 回答 #2

> 赞同：64
> 
> 时间：2014-06-10T14:46:15.920

不需要脚本或其他“技巧”：`openssl`就`ssh-keygen`足够了。我假设密钥没有密码（这很糟糕）。

# 生成 RSA 对

以下所有方法都给出了相同格式的 RSA 密钥对

1.  使用 openssl ( [man genrsa](https://www.openssl.org/docs/apps/genrsa.html "男人根萨") )

    ```
    openssl genrsa -out dummy-genrsa.pem 2048 
    ```

    在 OpenSSL v1.0.1`genrsa` [中被取代](https://www.openssl.org/docs/apps/openssl.html "男人openssl")，`genpkey`所以这是新的方法（[man genpkey](https://www.openssl.org/docs/apps/genpkey.html "人基因密钥")）：

    ```
    openssl genpkey -algorithm RSA -out dummy-genpkey.pem -pkeyopt rsa_keygen_bits:2048 
    ```

2.  使用 ssh-keygen

    ```
    ssh-keygen -t rsa -b 2048 -f dummy-ssh-keygen.pem -N '' -C "Test Key" 
    ```

# 将 DER 转换为 PEM

如果您有 DER 格式的 RSA 密钥对，您可能需要将其转换为 PEM 以允许进行以下格式转换：

一代：

```
openssl genpkey -algorithm RSA -out genpkey-dummy.cer -outform DER -pkeyopt rsa_keygen_bits:2048 
```

转换：

```
openssl rsa -inform DER -outform PEM -in genpkey-dummy.cer -out dummy-der2pem.pem 
```

# 从 PEM 格式的 RSA 对中提取公钥

2.  PEM 格式：

    ```
    openssl rsa -in dummy-xxx.pem -pubout 
    ```

3.  在 OpenSSH v2 格式中，[请参阅](http://www.sysmic.org/dotclear/index.php?post/2010/03/24/Convert-keys-betweens-GnuPG%2C-OpenSsh-and-OpenSSL)：

    ```
    ssh-keygen -y -f dummy-xxx.pem 
    ```

# 笔记

操作系统和软件版本：

```
[user@test1 ~]# cat /etc/redhat-release ; uname -a ; openssl version
CentOS release 6.5 (Final)
Linux test1.example.local 2.6.32-431.el6.x86_64 #1 SMP Fri Nov 22 03:15:09 UTC 2013 x86_64 x86_64 x86_64 GNU/Linux
OpenSSL 1.0.1e-fips 11 Feb 2013 
```

参考：

*   [Sysmic.org 在 GnuPG、OpenSsh 和 OpenSSL 之间转换密钥](http://www.sysmic.org/dotclear/index.php?post/2010/03/24/Convert-keys-betweens-GnuPG%2C-OpenSsh-and-OpenSSL)

* * *

## 回答 #3

> 赞同：26
> 
> 时间：2009-07-02T14:59:29.243

为了回答我自己的问题，在 openssl 邮件列表上发帖后得到了这个：

这是从 OpenSSL 公钥转换为 OpenSSH 公钥的 C 代码。您可以从此[链接](http://www.idrix.fr/Root/Samples/pubkey2ssh.c)获取代码并自行编译：

```
static unsigned char pSshHeader[11] = { 0x00, 0x00, 0x00, 0x07, 0x73, 0x73, 0x68, 0x2D, 0x72, 0x73, 0x61};

static int SshEncodeBuffer(unsigned char *pEncoding, int bufferLen, unsigned char* pBuffer)
{
   int adjustedLen = bufferLen, index;
   if (*pBuffer & 0x80)
   {
      adjustedLen++;
      pEncoding[4] = 0;
      index = 5;
   }
   else
   {
      index = 4;
   }
   pEncoding[0] = (unsigned char) (adjustedLen >> 24);
   pEncoding[1] = (unsigned char) (adjustedLen >> 16);
   pEncoding[2] = (unsigned char) (adjustedLen >>  8);
   pEncoding[3] = (unsigned char) (adjustedLen      );
   memcpy(&pEncoding[index], pBuffer, bufferLen);
   return index + bufferLen;
}

int main(int argc, char**  argv)
{
   int iRet = 0;
   int nLen = 0, eLen = 0;
   int encodingLength = 0;
   int index = 0;
   unsigned char *nBytes = NULL, *eBytes = NULL;
   unsigned char* pEncoding = NULL;
   FILE* pFile = NULL;
   EVP_PKEY *pPubKey = NULL;
   RSA* pRsa = NULL;
   BIO *bio, *b64;

   ERR_load_crypto_strings(); 
   OpenSSL_add_all_algorithms();

   if (argc != 3)
   {
      printf("usage: %s public_key_file_name ssh_key_description\n", argv[0]);
      iRet = 1;
      goto error;
   }

   pFile = fopen(argv[1], "rt");
   if (!pFile)
   {
      printf("Failed to open the given file\n");
      iRet = 2;
      goto error;
   }

   pPubKey = PEM_read_PUBKEY(pFile, NULL, NULL, NULL);
   if (!pPubKey)
   {
      printf("Unable to decode public key from the given file: %s\n", ERR_error_string(ERR_get_error(), NULL));
      iRet = 3;
      goto error;
   }

   if (EVP_PKEY_type(pPubKey->type) != EVP_PKEY_RSA)
   {
      printf("Only RSA public keys are currently supported\n");
      iRet = 4;
      goto error;
   }

   pRsa = EVP_PKEY_get1_RSA(pPubKey);
   if (!pRsa)
   {
      printf("Failed to get RSA public key : %s\n", ERR_error_string(ERR_get_error(), NULL));
      iRet = 5;
      goto error;
   }

   // reading the modulus
   nLen = BN_num_bytes(pRsa->n);
   nBytes = (unsigned char*) malloc(nLen);
   BN_bn2bin(pRsa->n, nBytes);

   // reading the public exponent
   eLen = BN_num_bytes(pRsa->e);
   eBytes = (unsigned char*) malloc(eLen);
   BN_bn2bin(pRsa->e, eBytes);

   encodingLength = 11 + 4 + eLen + 4 + nLen;
   // correct depending on the MSB of e and N
   if (eBytes[0] & 0x80)
      encodingLength++;
   if (nBytes[0] & 0x80)
      encodingLength++;

   pEncoding = (unsigned char*) malloc(encodingLength);
   memcpy(pEncoding, pSshHeader, 11);

   index = SshEncodeBuffer(&pEncoding[11], eLen, eBytes);
   index = SshEncodeBuffer(&pEncoding[11 + index], nLen, nBytes);

   b64 = BIO_new(BIO_f_base64());
   BIO_set_flags(b64, BIO_FLAGS_BASE64_NO_NL);
   bio = BIO_new_fp(stdout, BIO_NOCLOSE);
   BIO_printf(bio, "ssh-rsa ");
   bio = BIO_push(b64, bio);
   BIO_write(bio, pEncoding, encodingLength);
   BIO_flush(bio);
   bio = BIO_pop(b64);
   BIO_printf(bio, " %s\n", argv[2]);
   BIO_flush(bio);
   BIO_free_all(bio);
   BIO_free(b64);

error:
   if (pFile)
      fclose(pFile);
   if (pRsa)
      RSA_free(pRsa);
   if (pPubKey)
      EVP_PKEY_free(pPubKey);
   if (nBytes)
      free(nBytes);
   if (eBytes)
      free(eBytes);
   if (pEncoding)
      free(pEncoding);

   EVP_cleanup();
   ERR_free_strings();
   return iRet;
} 
```

* * *

## 回答 #4

> 赞同：18
> 
> 时间：2018-03-28T14:55:55.007

```
ssh-keygen -i -m PKCS8 -f public-key.pem 
```

* * *

## 回答 #5

> 赞同：16
> 
> 时间：2017-08-08T18:19:14.320

```
ssh-keygen -f private.pem -y > public.pub 
```

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2014-01-22T17:51:18.913

以下脚本将获取 base64 编码的 DER 格式的 ci.jenkins-ci.org 公钥证书，并将其转换为 OpenSSH 公钥文件。此代码假定使用 2048 位 RSA 密钥，并从 Ian Boyd 的[回答](https://stackoverflow.com/questions/1193529/how-to-store-retreieve-rsa-public-private-key/13104466#13104466)中汲取了很多信息。我在 Jenkins wiki中对[这篇文章的评论中解释了它是如何工作的。](https://wiki.jenkins-ci.org/display/JENKINS/Instance+Identity)

```
echo -n "ssh-rsa " > jenkins.pub
curl -sfI https://ci.jenkins-ci.org/ | grep -i X-Instance-Identity | tr -d \\r | cut -d\  -f2 | base64 -d | dd bs=1 skip=32 count=257 status=none | xxd -p -c257 | sed s/^/00000007\ 7373682d727361\ 00000003\ 010001\ 00000101\ / | xxd -p -r | base64 -w0 >> jenkins.pub
echo >> jenkins.pub 
```

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2012-02-06T16:20:06.747

我做过

> ssh-keygen -i -f $sshkeysfile >> 授权密钥

[信用在这里](http://www.commandlinefu.com/commands/view/155/convert-an-ssh2-public-key-to-openssh-format)

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2018-12-14T20:27:51.753

FWIW，此 BASH 脚本将采用 PEM 或 DER 格式的 X.509 证书或 OpenSSL 公钥文件（也是 PEM 格式）作为第一个参数并泄露 OpenSSH RSA 公钥。这扩展了@mkalkov 上面的回答。要求是`cat`, `grep`, `tr`, `dd`, `xxd`, `sed`, `xargs`, `file`, `uuidgen`, `base64`, `openssl`(1.0+)，当然还有`bash`。所有 except `openssl`(contains `base64`) 都几乎可以保证成为任何现代 Linux 系统上基本安装的一部分，除了可能`xxd`（Fedora 在`vim-common`包中显示）。如果有人想清理它并使它变得更好，请注意讲师。

```
#!/bin/bash
#
# Extract a valid SSH format public key from an X509 public certificate.
#

# Variables:
pubFile=$1
fileType="no"
pkEightTypeFile="$pubFile"
tmpFile="/tmp/`uuidgen`-pkEightTypeFile.pk8"

# See if a file was passed:
[ ! -f "$pubFile" ] && echo "Error, bad or no input file $pubFile." && exit 1

# If it is a PEM format X.509 public cert, set $fileType appropriately:
pemCertType="X$(file $pubFile | grep 'PEM certificate')"
[ "$pemCertType" != "X" ] && fileType="PEM"

# If it is an OpenSSL PEM-format PKCS#8-style public key, set $fileType appropriately:
pkEightType="X$(grep -e '-BEGIN PUBLIC KEY-' $pubFile)"
[ "$pkEightType" != "X" ] && fileType="PKCS"

# If this is a file we can't recognise, try to decode a (binary) DER-format X.509 cert:
if [ "$fileType" = "no" ]; then
        openssl x509 -in $pubFile -inform DER -noout
        derResult=$(echo $?)
        [ "$derResult" = "0" ] && fileType="DER"
fi

# Exit if not detected as a file we can use:
[ "$fileType" = "no" ] && echo "Error, input file not of type X.509 public certificate or OpenSSL PKCS#8-style public key (not encrypted)." && exit 1

# Convert the X.509 public cert to an OpenSSL PEM-format PKCS#8-style public key:
if [ "$fileType" = "PEM" -o "$fileType" = "DER" ]; then
        openssl x509 -in $pubFile -inform $fileType -noout -pubkey > $tmpFile
        pkEightTypeFile="$tmpFile"
fi

# Build the string:
# Front matter:
frontString="$(echo -en 'ssh-rsa ')"

# Encoded modulus and exponent, with appropriate pointers:
encodedModulus="$(cat $pkEightTypeFile | grep -v -e "----" | tr -d '\n' | base64 -d | dd bs=1 skip=32 count=257 status=none | xxd -p -c257 | sed s/^/00000007\ 7373682d727361\ 00000003\ 010001\ 00000101\ / | xxd -p -r | base64 -w0 )"

# Add a comment string based on the filename, just to be nice:
commentString=" $(echo $pubFile | xargs basename | sed -e 's/\.crt\|\.cer\|\.pem\|\.pk8\|\.der//')"

# Give the user a string:
echo $frontString $encodedModulus $commentString

# cleanup:
rm -f $tmpFile 
```

# java - JComboBox getSelectedItem() 没有改变

> ID：1011580
> 
> 赞同：2
> 
> 时间：2009-06-18T08:55:34.457
> 
> 标签：java, swing, binding, netbeans6.5

我将 a 绑定`JComboBox`到一个 observable `List`。我清除并添加`Objects`了可观察列表。这工作正常并正确反映了变化`JComboBox`。

问题是我无法使用鼠标选择列表的内容，尽管新添加的项目在展开时正确显示在组合框中。`getSelectedItem()`总是停留在列表中的第一个项目上。

```
 List<Object> sourceListObserver = 
     ObservableCollections.observableList(new ArrayList<Object>()); 
```

绑定是使用 Netbeans GUI 设计器完成的。

我现在也尝试过使用`DefaultComboBoxModel`.

```
DefaultComboBoxModel model = new DefaultComboBoxModel();
wireSourceComboBox.setModel(model); 
```

使用`wireSourceComboBox.removeAllItems();`和`wireSourceComboBox.addItem(qb);`

将对象删除并添加到组合框后仍然是相同的行为。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-09-21T23:49:38.403

without a working example it's hard to prove, but you probably need to fire the event listeners to have the UI track your model correctly.

see [AbstractListModel.fireContentsChanged](http://java.sun.com/javase/6/docs/api/javax/swing/AbstractListModel.html#fireContentsChanged%28java.lang.Object,%20int,%20int%29)

# php - 如何在 Symfony 表单选择框中设置选定的选项

> ID：1011586
> 
> 赞同：4
> 
> 时间：2009-06-18T08:56:39.557
> 
> 标签：php, symfony1

我有一个用 Symfony 表单创建的表单。

在模板中我有这个选择框，用渲染方法显示在页面上。

```
<?php echo $form['field']->render() ?> 
```

是否可以设置此选择框的选定选项？

还是必须在创建此表单的类中完成？完成了字段的创建：

```
public function configure() {
    $this->widgetSchema['field'] = new sfWidgetFormSelect(
      array("choices" => 
          array('1' => 'test1','2' => 'test2')
      )
    );
  } 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-18T11:57:33.200

是的，当然——你应该设置相应的表单值——或者通过`bind()`，或者通过小部件的`default`选项。

例如，

```
public function configure() 
{
    $this->widgetSchema['field'] = new sfWidgetFormSelect(array(
        "choices" => array('1' => 'test1','2' => 'test2'), 
        'default' => 2));
} 
```

希望我已经回答了你的问题。

# sql-server-2005 - 无法在视图上创建 CLUSTERED INDEX，因为我引用同一个表两次，有什么解决方法吗？

> ID：1011595
> 
> 赞同：2
> 
> 时间：2009-06-18T08:59:08.710
> 
> 标签：sql-server-2005, tsql, database-design

我想创建一个索引视图来集成来自多个表的数据，但是 SQL Server 抱怨错误消息：

*无法在视图“MyView”上创建索引。该视图包含“dbo.Companies”上的自联接。*

视图定义是这样的（简化版）：

```
SELECT  T.Field1
      , T.Field2
      , P.CompanyName AS ProviderName
      , C.CompanyName AS CustomerName
      , T3.Field1
FROM dbo.Table1 T 
                  INNER JOIN dbo.Companies P ON T.ProviderId = T2.Id
                  INNER JOIN dbo.Companies C ON T.CustomerId = T2.Id
                  INNER JOIN dbo.Table3 ON T.Id = T3.Id 
```

这种情况有什么解决方法吗？我不想将*Companies*表拆分为两个表。

提前致谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-18T12:31:53.367

您将无法解决此问题，索引视图必须符合[创建索引视图](http://msdn.microsoft.com/en-us/library/ms191432.aspx)中列举的某些限制。除其他外，不支持外部和**自**连接（从上到下的第 10 个限制）。它归结为引擎能够在更新基表时更新视图索引。

不知道您的数据模型的所有细节，您确定索引视图是必要的并且基表索引不够吗？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2021-05-12T09:59:32.837

[此处](http://jmkehayias.blogspot.com/2008/12/creating-indexed-view-with-self-join.html)描述了一种解决方法。

您创建两个视图：

1.  一个索引视图，其中包含一组用于您的第一个连接的行和另一组用于您的第二个连接的行，即它是非透视数据。这个视图可以被索引。
2.  一个非索引视图，它将您的索引视图和 PIVOTs 返回到单独的列

在此解决方法中，您确实获得了一个执行连接的索引视图，但 SQL 需要执行额外的 PIVOT 操作来获取您希望如何使用它的数据。与仅在没有索引视图的情况下进行连接相比，这是否会提高性能我不知道。（但如果您进行分析，请告诉我）。

# django - Google App Engine 上的 Django

> ID：1011599
> 
> 赞同：19
> 
> 时间：2009-06-18T08:59:51.907
> 
> 标签：django, google-app-engine

在 App Engine 上运行 Django 应用程序有多痛苦？此外，Datastore 是否可以与 Django 一起使用？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-06-18T12:29:42.840

我花了一些时间试图回答同样的问题……在我看来，最难转移到 GAE 的是**django 的模型**……从某种意义上说，它们需要进行各种修改和重新思考，主要是因为 GAE 的后端不是标准关系数据库，但谷歌的**BigTable**。我在这里找到了一个很好的介绍：

[http://www.youtube.com/watch?v=rRCx9e38yr8](http://www.youtube.com/watch?v=rRCx9e38yr8)

无论如何，值得下载其中一个“补丁”并尝试一下！

对我来说，最好的解决方案是“ **app-engine-patch** ”。我下载了示例项目，它立即工作！（请注意，您需要单独安装 GAE 的 SDK）对我来说，一个杀手级功能是**django-admin**和许多其他经典 django 功能也已被移植！！！

[http://code.google.com/p/app-engine-patch/](http://code.google.com/p/app-engine-patch/)

在我看来，[文档](http://code.google.com/p/app-engine-patch/wiki/Documentation)仍然很少，但足以让您继续前进。不过，它会帮助您浏览 GAE 官方文档！

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-06-21T05:47:39.037

就在[昨天（取决于您的时区），Google](http://groups.google.com/group/google-appengine/browse_thread/thread/fab4e52646994dff/93bdf272719b724c)在 Appengine 上发布了一个新的 Python SDK，它支持 django 1.0 开箱即用。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2012-02-24T11:44:47.320

您需要使用[django-nonrel](http://www.allbuttonspressed.com/projects/django-nonrel) ( [source](https://github.com/django-nonrel) )。

你仍然会发现很多问题：

*   不支持 Many2Many 关系
*   假连接增加了查询的数量
*   App Engine 不允许任何带有套接字或 C 依赖项的 python 库（sentry、lxml...）

您可以尝试提前访问[CloudSQL](https://developers.google.com/cloud-sql/)。

否则你不限制使用 App Engine，你可以考虑使用：

*   [Heroku](http://devcenter.heroku.com/articles/django)
*   [刚铎](https://gondor.io/)

使用 pip 等支持需求文件更便宜、更可控。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2012-02-02T08:30:48.947

31.01.2012，[谷歌发布了支持 Django 的 App Engine 1.6.2](http://googleappengine.blogspot.com.au/2012/01/app-engine-162-released.html)开箱即用。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-06-18T10:38:30.443

App Engine 包含开箱即用的 Django 0.96 版，但它相当残缺。

App Engine Helper 和 app-engine-patch 应该在一定程度上解决了这个问题，但我自己也没有尝试过。

[http://code.google.com/appengine/articles/appengine_helper_for_django.html](http://code.google.com/appengine/articles/appengine_helper_for_django.html) [http://code.google.com/appengine/articles/app-engine-patch.html](http://code.google.com/appengine/articles/app-engine-patch.html)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-06-18T12:35:02.003

痛苦的程度取决于您想要重用多少现有代码。不幸的是，由于 Datastore 不支持 SQL，您通常不能只使用任何 django-pluggable 应用程序并在您的 GAE 项目中使用它。

App-engine-patch [http://code.google.com/p/app-engine-patch/](http://code.google.com/p/app-engine-patch/)在将标准应用程序（站点、内容类型、平面页面）引入 GAE 方面似乎领先于其他 django 助手。我在几个 gae 项目中使用了 app-engine-patch，一旦你了解了如何将 django-sql 模型移植到 django-gae 模型并将 sql 转换为数据存储查询，事情就可以很快完成 - 但总有一个学习曲线。

appengine-helper 试图通过提供模型来弥合数据存储区的差距，这样您就不必更改模型超类，但我发现您最终不得不更改多对多关系和任何 sql，因此优势最终是最小。ae-patch 有一个尝试提供 ae-datastore 后端的路线图，但它可能暂时不会发生。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-01-03T08:40:03.503

谷歌现在已经推出了他们的 Cloud SQL 存储。那实际上是云中的 MySQL 5.5。IMO 这是将您的 Django 应用程序迁移到云中的一种非常好的方法。他们的免费试用期至 2013 年 6 月 1 日。

如果您需要一些技巧来为 Appengine 和 Cloud SQL 设置 Django 项目，我已经为此编写了一个[教程](http://howto.pui.ch/post/39245389801/tutorial-django-1-4-on-appengine-using-google-cloud)。

# python - 如何在 Breve Simulator 中为机器人添加摄像头？

> ID：1011602
> 
> 赞同：1
> 
> 时间：2009-06-18T09:01:23.400
> 
> 标签：python, simulation, robotics

我创建了一个基于 braitenberg 车辆的两轮机器人。我们的机器人有两个轮子和一个 PolygonDisk 身体（很像 kepera 和 e-puck 机器人）。我想在机器人前面加一个摄像头。那么问题就变成了如何控制相机以及如何将其指向正确的方向（与机器人相同的方向）。如何使摄像头指向与机器人相同的方向？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-22T12:54:10.720

经过多次尝试和失败，我终于成功了。所以我是这样做的：

总的想法是有一个链接或物体链接到车辆，然后测量它的旋转和位置，以便找出相机应该瞄准的方向。

1）添加一个链接到机器人的对象：

```
def addVisualCam(self):
    joint = None
    cam = breve.createInstances(breve.Link,1)
    cam.setShape(breve.createInstances(breve.PolygonCone, 1).initWith(10,0.08,0.08))
    joint = breve.createInstances(breve.FixedJoint,1)
    # So ad-hoc it hurts. oh well...
    joint.setRelativeRotation(breve.vector(0,1,0), -3.14/2)
    joint.link(breve.vector(0,1.05,0), breve.vector(0,0,0), cam, self.vehicle.bodyLink, 0)
    joint.setDoubleSpring(300, 1.01000, -1.01000)
    self.vehicle.addDependency(joint)
    self.vehicle.addDependency(cam)
    cam.setColor(breve.vector(0,0,0))
    self.cam = cam 
```

2）添加这个postIterate：

```
def postIterate(self):
    look_at = self.cam.getLocation() + (self.cam.getRotation() * breve.vector(0,0,1))
    look_from = -(self.cam.getRotation()*breve.vector(0,0,1))
    self.vision.look(look_at, look_from) 
```

# ios - 更新到 iPhone OS 3.0 时，是否兼容旧应用程序？

> ID：1011603
> 
> 赞同：1
> 
> 时间：2009-06-18T09:01:38.733
> 
> 标签：ios, iphone, iphone-sdk-3.0, updating

我目前正在使用具有**iPhone OS 2.2.1 的设备。** 众所周知，**OS 3.0**更新可供下载。我已经下载了更新并阅读了很多关于它的评论。我在 OS 2.2.1 上开发了我所有的应用程序。只是为了确认，**如果我在我的设备上安装 3.0，这些应用程序是否兼容。** 如果没有，我可以**回滚到 2.2.1**吗？如果可以回滚，那么我该如何回滚？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-18T09:06:38.723

您的应用程序在 App Store 中出售吗？或者他们是私人应用程序？苹果现在不会批准任何不兼容 3.0 的应用程序，但我很确定所有 2.2.1 应用程序都可以在 3.0 上运行。

使用 iPhone 模拟器，您可以测试不同的版本。使用该设备，没有简单的方法可以回滚到 2.2.1。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-18T11:39:30.960

为了回答你关于降级的问题，我昨天做了这个过程，将我的 iPod Touch 2G 从 3.0 GM 固件降级到 2.2.1。

首先，您需要获取 2.2.1 固件。[http://www.blogsdna.com/2264/iphone-firmware-221-and-ipod-touch-firmware-221-released.htm](http://www.blogsdna.com/2264/iphone-firmware-221-and-ipod-touch-firmware-221-released.htm)上有链接列表

如果您下载 zip 文件并且有 .zip 文件名后缀，只需从文件名中删除“.zip”部分。**不要解压缩文件**。ipsw 文件使用 zip 封装与固件升级相关的各种文件。

接下来，您需要将设备连接到 Mac，并将其置于 DFU 模式。这包括按住主页和电源按钮直到设备关闭，然后将手指从电源按钮上移开，但将其保持在主页按钮上几秒钟，然后松开。这有点棘手，因此请查看[有关该主题的各种文章](http://www.google.co.uk/search?hl=en&q=DFU+mode+iphone)。我花了好几次才把它弄好。

将设备置于 DFU 模式后，您可以使用 Xcode 的 Organizer 窗口将 2.2.1 固件加载到设备上。转到**软件版本**菜单，然后选择**其他版本**...。然后浏览到您下载的 2.2.1 固件文件，单击**Open**，然后单击**Restore [device]**。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-18T09:07:08.147

也许你可以使用 pwnage 工具降级.. 但我不确定.. 无论如何你可以尝试降级到 2.1 看看会发生什么..

# arguments - fortran 意图（输入、输出、输入）之间的显式区别是什么？

> ID：1011604
> 
> 赞同：18
> 
> 时间：2009-06-18T09:01:43.710
> 
> 标签：arguments, fortran

在书籍、stackoverflow 和一般网络上搜索了一段时间后，我发现很难找到对 fortran 参数意图之间真正差异的直接解释。我理解的方式是这样的：

*   `intent(in)`-- 在入口处将实际参数复制到虚拟参数。
*   `intent(out)`-- 虚拟参数指向实际参数（它们都指向内存中的同一位置）。
*   `intent(inout)`-- 虚拟参数在本地创建，然后在过程完成时复制到实际参数。

如果我的理解是正确的，那么我也想知道为什么要使用`intent(out)`，因为这`intent(inout)`需要更少的工作（无需复制数据）。

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2010-01-07T23:59:13.007

意图只是编译器的提示，您可以丢弃该信息并违反它。意图的存在几乎完全是为了确保您只执行您计划在子例程中执行的操作。编译器可能会选择信任您并优化某些内容。

这意味着`intent(in)`不是按值传递。您仍然可以覆盖原始值。

```
program xxxx  
    integer i  
    i = 9  
    call sub(i)  
    print*,i ! will print 7 on all compilers I checked  
end  
subroutine sub(i)  
    integer,intent(in) :: i  
    call sub2(i)  
end  
subroutine sub2(i)  
    implicit none  
    integer i  
    i = 7  ! This works since the "intent" information was lost.  
end

program xxxx  
    integer i  
    i = 9  
    call sub(i)  
end  
subroutine sub(i)  
    integer,intent(out) :: i  
    call sub2(i)  
end  
subroutine sub2(i)  
    implicit none   
    integer i  
    print*,i ! will print 9 on all compilers I checked, even though intent was "out" above.  
end 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-06-18T09:07:32.497

*   `intent(in)`- 看起来像按值传递（并且对此的更改不会反映在外部代码中），但实际上是按引用传递并且编译器禁止更改它。但它仍然可以改变。
*   `intent(out)`- 以某种方式通过引用传递，实际上是一个返回参数
*   `intent(inout)`- 通过引用传递，正常输入/输出参数。

使用`intent(out)`if is 是显而易见的，以记录您的设计。如果有的话，不要关心非常小的性能增益。（评论表明没有，因为`intent(in)`在技术上也是通过引用传递的。）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2016-12-31T08:49:28.067

目前尚不清楚是否确实回答了 OP 的部分问题。此外，在随后的答案/讨论中似乎有很多混乱和各种错误，可能会受益于一些澄清。

A）OP的问题Re

“那么我也想知道为什么要使用intent(out)，因为intent(inout) 需要的工作更少（无需复制数据）。”

可能没有回答，或者至少太直接/正确。

首先，要明确`Intent`属性至少有两个目的：“安全/卫生”和“间接性能”问题（不是“直接性能”问题）。

1) 安全/卫生：协助生成“安全/合理”的代码，减少“搞砸”的机会。因此，Intent(In) 不能被覆盖（至少在本地，甚至在某些情况下“全局”，见下文）。

同样，Intent(Out) 要求为 Arg 分配“明确答案”，从而有助于减少“垃圾”结果。

例如，在可能是计算数学中最常见的问题的解决方案中，即所谓的“Ax=b 问题”，人们正在寻找的“直接结果/答案”是向量 x 的值。那些应该是 Intent(Out) 以确保 x 被分配一个“明确”的答案。如果 x 被声明为 Intent(InOut) 或“no Intent”，那么 Fortran 将为 x 分配一些“默认值”（在调试模式下可能是“零”，但在发布模式下可能是“垃圾”，无论是内存在 Args 指针位置），如果用户没有明确地为 x 分配正确的值，它将返回“垃圾”。Intent(Out) 将“提醒/强制”用户明确地为 x 赋值，从而避免这种“（意外）垃圾”。

在求解过程中，将（几乎肯定）产生矩阵 A 的逆矩阵。用户可能希望将该逆矩阵返回给调用 s/r 来代替 A，在这种情况下，A 应该是 Intent(InOut)。

或者，用户可能希望确保不对矩阵 A 或向量 b 进行任何更改，在这种情况下，它们将被声明为 Intent(In)，从而确保不会覆盖关键值。

2 a) “间接绩效”（和“全球安全/卫生”）：虽然意图不是直接影响绩效，但它们是间接影响的。值得注意的是，某些类型的优化，尤其是 Fortran Pure 和 Elemental 构造，可以大大提高性能。这些设置通常要求所有 Args 都明确声明其 Intent。

粗略地说，如果编译器事先知道所有 var 的 Intent，那么它可以更轻松有效地优化和“愚蠢检查”代码。

至关重要的是，如果一个人使用 Pure etc 构造，那么很有可能还会有一种“全局安全/卫生”，因为 Pure/Elemental s/p 只能调用其他 Pure/Elemental s/p 等等无法达到“格雷泽盖伊”示例中所示的那种情况。

例如，如果 Sub1() 声明为 Pure，那么 Sub2() 也必须声明为 Pure，然后需要声明所有级别的 Intent，因此“The Glazer Guy”中产生的“garbage out” “示例不可能发生。也就是说，代码将是：

```
Pure subroutine sub_P(i)
    integer,intent(in) :: i
    call sub2_P(i)
end  subroutine sub_P

Pure subroutine sub2_P(i)
    implicit none
!        integer i          ! not permitted to omit Intent in a Pure s/p
    integer,intent(in) :: i
    i = 7   ! This WILL NOT WORK/HAPPEN, since Pure obviates the possibility of omitting Intent, and Intent(In) prohibits assignment ... so "i" remains "safe".
end  subroutine sub2_P 
```

...在编译时，这会产生类似

“ ||错误：在 (1)| 的变量定义上下文（赋值）中带有 INTENT(IN) 的虚拟参数 'i'|”

当然，sub2 不必是 Pure 才能将 i 声明为 Intent(In)，这将再次提供人们正在寻找的“安全/卫生”。

请注意，即使 i 被声明为 Intent(InOut)，它仍然会因 Pure 失败。那是：

```
Pure subroutine sub_P(i)
    integer,intent(in) :: i
    call sub2_P(i)
end  subroutine sub_P

Pure subroutine sub2_P(i)
    implicit none
    integer,intent(inOut) :: i
    i = 7   ! This WILL NOT WORK, since Pure obviates the possibility of "mixing" Intent's.
end  subroutine sub2_P 
```

...在编译时，这会产生类似

“||错误：变量定义上下文中带有INTENT（IN）的虚拟参数'i'（INTENT的实际参数= OUT / INOUT）在（1）|”

因此，对纯/元素构造的严格或广泛依赖将确保（大部分）“全球安全/卫生”。

不可能在所有情况下都使用 Pure/Elemental 等（例如，许多混合语言设置，或者依赖于您无法控制的外部库等）。

尽管如此，始终如一地使用 Intents，并尽可能使用 Pure 等，将产生很多好处，并消除很多悲伤。

人们可以简单地养成在可能的情况下始终在任何地方声明意图的习惯，无论是否纯正......这是推荐的编码实践。

...这也凸显了同时存在 Intent(InOut) 和 Intent(Out) 的另一个原因，因为 Pure 必须声明所有 Arg 的 Intent，因此会有一些 Arg 仅是 Out，而另一些是 InOut (即，如果没有 In、InOut 和 Out Intent 中的每一个，就很难拥有 Pure's）。

2 b) OP 的评论期望“性能改进”因为不需要复制“表明对 Fortran 及其广泛使用按引用传递的误解。通过引用传递，本质上，只需要指针，实际上，通常只需要需要指向数组中第一个元素的指针（加上一些隐藏的数组信息）。

事实上，考虑“过去”（例如 Fortran IV、77 等）可能会提供一些见解，当传递数组时可能已编码如下：

```
Real*8 A(1000)

Call Sub(A)

Subroutine Sub(A)

Real*8 A(1) ! this was workable since Fortran only passes the pointer/by ref to the first element of A(1000)
                ! modern Fortran may well throw a bounds check warning 
```

在现代 Fortran 中，“等效”是在 s/r 中将 A 声明为 Real(DP) A(:) （尽管严格来说，有各种设置受益于传递数组的边界并明确声明边界，但是将是另一天冗长的题外话）。

也就是说，Fortran 不会按值传递，也不会为 Args/Dummy 变量“制作副本”。调用 s/r 中的 A() 与 s/r 中使用的“相同 A”（当然，在 s/r 中，可以复制 A() 或其他任何内容，这将创建额外的工作/空间要求，但这是另一回事）。

主要是因为这个原因，Intent 不会在很大程度上直接影响性能，即使对于大型数组 Arg 等也是如此。

B）关于“按值传递”的混淆：尽管上面的各种响应确实证实使用 Intent 是“不按值传递”，但澄清此事可能会有所帮助。

将措辞更改为“意图始终通过引用传递”可能会有所帮助。这与“不按值传递”不同，是一个重要的微妙之处。值得注意的是，Intent 不仅是“byRef”，而且 Intent 可以防止按值传递。

尽管有一些特殊的/更复杂的设置（例如混合语言 Fortran DLL 等）需要更多的讨论，但对于“标准 Fortran”的大部分内容，Args 由 Ref 传递。这种“意图微妙”的演示可以在“The Glazer Guys”示例的简单扩展中看到，如下所示：

```
subroutine sub(i)
    integer, intent(in) :: i, j
    integer, value     :: iV, jV
    call sub2(i)
    call sub3(i, j, jV, iV)
end
subroutine sub2(i)
    implicit none
    integer i
    i = 7  ! This works since the "intent" information was lost.
end
subroutine sub3(i, j, jV, iV)
    implicit none
    integer, value, Intent(In)          :: i    ! This will work, since passed in byRef, but used locally as byVal
    integer, value, Intent(InOut)       :: j    ! This will FAIL, since ByVal/ByRef collision with calling s/r,
                                                ! ||Error: VALUE attribute conflicts with INTENT(INOUT) attribute at (1)|
    integer, value, Intent(InOut)       :: iV   ! This will FAIL, since ByVal/ByRef collision with calling s/r,
                                                ! ... in spite of "byVal" in calling s/r
                                                ! ||Error: VALUE attribute conflicts with INTENT(INOUT) attribute at (1)|
    integer, value, Intent(Out)         :: jV   ! This will FAIL, since ByVal/ByRef collision with calling s/r
                                                ! ... in spite of "byVal" in calling s/r
                                                ! ||Error: VALUE attribute conflicts with INTENT(OUT) attribute at (1)|
    jV = -7
    iV = 7
end 
```

也就是说，任何具有“Out”方面的东西都必须是“byRef”（至少在正常设置中），因为调用 s/r 期待“byRef”。因此，即使所有 s/r 都将 Args 声明为“Value”，它们也仅在本地是“byVal”（同样在标准设置中）。因此，被调用的 s/r 尝试返回一个声明为具有任何 Out Intent 的值的 Arg 的任何尝试都将由于传递样式的“冲突”而失败。

如果它必须是“Out”或“InOut”和“Value”，那么就不能使用Intent：这不仅仅是说“它不是按值传递”。

# javascript - 清除 JavaScript 中的缓存

> ID：1011605
> 
> 赞同：203
> 
> 时间：2009-06-18T09:02:00.700
> 
> 标签：javascript, caching

如何使用 JavaScript 清除浏览器缓存？

我们部署了最新的 JavaScript 代码，但无法获取最新的 JavaScript 代码。

编者按：这个问题在以下地方是半重复的，下面第一个问题的答案可能是最好的。这个公认的答案不再是理想的解决方案。

[如何强制浏览器重新加载缓存的 CSS/JS 文件？](https://stackoverflow.com/questions/118884/how-to-force-browser-to-reload-cached-css-js-files)

[如何强制客户端刷新 JavaScript 文件？](https://stackoverflow.com/questions/32414/how-can-i-force-clients-to-refresh-javascript-files)

[动态重新加载本地 Javascript 源/json 数据](https://stackoverflow.com/questions/12079631/dynamically-reload-local-javascript-source-json-data)

* * *

## 回答 #1

> 赞同：222
> 
> 时间：2010-02-02T02:31:43.313

您可以调用[window.location.reload(true)](http://msdn.microsoft.com/en-us/library/ms536691%28VS.85%29.aspx)来重新加载当前页面。它将忽略任何缓存的项目并从服务器检索页面、css、图像、JavaScript 等的新副本。这不会清除整个缓存，但会清除您所在页面的缓存。

但是，您最好的策略是对其他各种答案中提到的路径或文件名进行版本控制。此外，请参阅[Revving Filenames: don't use querystring](http://www.stevesouders.com/blog/2008/08/23/revving-filenames-dont-use-querystring/) for reasons not to use `?v=n`as your versioning scheme。

* * *

## 回答 #2

> 赞同：122
> 
> 时间：2009-06-18T09:05:31.037

您无法使用 javascript 清除缓存。一种常见的方法是将修订号或上次更新的时间戳附加到文件中，如下所示：

```
myscript.123.js 
```

或者

`myscript.js?updated=1234567890`

* * *

## 回答 #3

> 赞同：44
> 
> 时间：2009-06-18T09:09:22.650

尝试更改 JavaScript 文件的 src？由此：

```
<script language="JavaScript" src="js/myscript.js"></script> 
```

对此：

```
<script language="JavaScript" src="js/myscript.js?n=1"></script> 
```

此方法应强制您的浏览器加载 JS 文件的新副本。

* * *

## 回答 #4

> 赞同：21
> 
> 时间：2011-12-12T11:28:22.540

除了每小时或每周缓存外，您还可以根据文件数据进行缓存。

示例（在 PHP 中）：

```
<script src="js/my_script.js?v=<?=md5_file('js/my_script.js')?>"></script> 
```

甚至使用文件修改时间：

```
<script src="js/my_script.js?v=<?=filemtime('js/my_script.js')?>"></script> 
```

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2009-06-18T11:11:29.317

您还可以强制每小时重新加载代码，如下所示，在 PHP 中：

```
<?php
echo '<script language="JavaScript" src="js/myscript.js?token='.date('YmdH').'">';
?> 
```

或者

```
<script type="text/javascript" src="js/myscript.js?v=<?php echo date('YmdHis'); ?>"></script> 
```

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2020-04-03T17:38:45.680

`window.location.reload(true)`似乎已被 HTML5 标准弃用。不使用查询字符串的一种方法是使用[`Clear-Site-Data`标头](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Clear-Site-Data)，这似乎[是标准化](https://www.w3.org/TR/clear-site-data/)的。

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2011-03-31T09:08:39.930

把它放在模板的末尾：

```
var scripts =  document.getElementsByTagName('script');
var torefreshs = ['myscript.js', 'myscript2.js'] ; // list of js to be refresh
var key = 1; // change this key every time you want force a refresh
for(var i=0;i<scripts.length;i++){ 
   for(var j=0;j<torefreshs.length;j++){ 
      if(scripts[i].src && (scripts[i].src.indexOf(torefreshs[j]) > -1)){
        new_src = scripts[i].src.replace(torefreshs[j],torefreshs[j] + 'k=' + key );
        scripts[i].src = new_src; // change src in order to refresh js
      } 
   }
} 
```

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2015-09-16T07:48:10.897

尝试使用这个

```
 <script language="JavaScript" src="js/myscript.js"></script> 
```

对此：

```
 <script language="JavaScript" src="js/myscript.js?n=1"></script> 
```

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2011-07-22T12:05:02.240

或者您可以使用 file_get_contets 通过服务器读取 js 文件，然后在 js 内容的标头中放入 echo

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2009-09-02T02:27:33.233

这是我在最新项目中使用的片段。

从控制器：

```
if ( IS_DEV ) {
    $this->view->cacheBust = microtime(true);
} else {
    $this->view->cacheBust = file_exists($versionFile) 
        // The version file exists, encode it
        ? urlencode( file_get_contents($versionFile) )
        // Use today's year and week number to still have caching and busting 
        : date("YW");
} 
```

从观点来看：

```
<script type="text/javascript" src="/javascript/somefile.js?v=<?= $this->cacheBust; ?>"></script>
<link rel="stylesheet" type="text/css" href="/css/layout.css?v=<?= $this->cacheBust; ?>"> 
```

我们的发布过程会生成一个包含当前构建版本号的文件。这通过对该文件进行 URL 编码并将其用作缓存破坏器来工作。作为故障转移，如果该文件不存在，则使用年份和周数，以便缓存仍然有效，并且每周至少刷新一次。

此外，这为开发环境中的每个页面加载提供了缓存清除，因此开发人员不必担心清除任何资源（javascript、css、ajax 调用等）的缓存。

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2017-06-12T00:23:05.187

也许**“清除缓存”**并不像应该的那么容易。我没有清除浏览器上的缓存，而是意识到**“触摸”**文件实际上会更改缓存在服务器上的源文件的日期（在 Edge、Chrome 和 Firefox 上测试），并且大多数浏览器会自动下载最新的新副本你的服务器上有什么（代码，图形任何多媒体）。我建议您在程序运行之前复制服务器上最新的脚本和**“做触摸的事情”**解决方案，这样它会将所有问题文件的日期更改为最新的日期和时间，然后下载一个新的副本到您的浏览器：

```
<?php
    touch('/www/control/file1.js');
    touch('/www/control/file2.js');
    touch('/www/control/file2.js');
?> 
```

...您的程序的其余部分...

我花了一些时间来解决这个问题（因为许多浏览器对不同命令的行为不同，但它们都会检查文件的时间并与您在浏览器中下载的副本进行比较，如果日期和时间不同，则会进行刷新），如果您不能走所谓的正确方式，总有另一种可用且更好的解决方案。最好的问候和快乐的露营。

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2014-05-02T15:11:43.360

如果你使用 php 可以这样做：

```
 <script src="js/myscript.js?rev=<?php echo time();?>"
    type="text/javascript"></script> 
```

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2012-06-08T21:14:41.753

我对 yboussard 建议的代码有一些问题。内部 j 循环不起作用。这是我成功使用的修改后的代码。

```
function reloadScripts(toRefreshList/* list of js to be refresh */, key /* change this key every time you want force a refresh */) {
    var scripts = document.getElementsByTagName('script');
    for(var i = 0; i < scripts.length; i++) {
        var aScript = scripts[i];
        for(var j = 0; j < toRefreshList.length; j++) {
            var toRefresh = toRefreshList[j];
            if(aScript.src && (aScript.src.indexOf(toRefresh) > -1)) {
                new_src = aScript.src.replace(toRefresh, toRefresh + '?k=' + key);
                // console.log('Force refresh on cached script files. From: ' + aScript.src + ' to ' + new_src)
                aScript.src = new_src;
            }
        }
    }
} 
```

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2019-05-18T02:11:50.497

您还可以使用元 HTML 标签禁用浏览器缓存，只需将 html 标签放在 head 部分，以避免在编码/测试时缓存网页，完成后您可以删除元标签。

（在头部）

```
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
<meta http-equiv="Pragma" content="no-cache" />
<meta http-equiv="Expires" content="0"/> 
```

将其粘贴到头部后刷新您的页面，并且也应该刷新新的 javascript 代码。

如果您需要，此链接将为您提供其他选项 [http://cristian.sulea.net/blog/disable-browser-caching-with-meta-html-tags/](http://cristian.sulea.net/blog/disable-browser-caching-with-meta-html-tags/)

或者你可以像这样创建一个按钮

```
<button type="button" onclick="location.reload(true)">Refresh</button> 
```

它会刷新并避免缓存，但它会一直在您的页面上，直到您完成测试，然后您可以将其取下。拳头选项是我最好的选择。

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2018-07-12T01:34:38.573

请不要提供不正确的信息。 [缓存 api](https://developer.mozilla.org/en-US/docs/Web/API/Cache)是与[http 缓存不同的缓存类型](https://developer.mozilla.org/en-US/docs/Web/HTTP/Caching)

当服务器发送正确的[标头时会触发](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Cache-Control)[HTTP 缓存](https://developer.mozilla.org/en-US/docs/Web/HTTP/Caching)，您无法使用 javasvipt 访问。

另一方面，[缓存 api在您需要时被触发，它在与](https://developer.mozilla.org/en-US/docs/Web/API/Cache)[服务工作者](https://developers.google.com/web/fundamentals/primers/service-workers/)一起工作时很有用，因此您可以交叉请求并从这种类型的缓存中回答它，请参阅：[ilustration 1](https://www.youtube.com/watch?v=yE5MVuLXjEg&feature=youtu.be) [ilustration 2](https://www.youtube.com/watch?v=8rIYvtCcFyA&feature=youtu.be) [course](https://classroom.udacity.com/courses/ud899)

您可以使用这些技术为您的用户提供新鲜的内容：

1.  使用[location.reload(true)](https://developer.mozilla.org/en-US/docs/Web/API/Location/reload)这对我不起作用，所以我不会推荐它。
2.  使用[Cache api](https://developer.mozilla.org/en-US/docs/Web/API/Cache)以保存到缓存中并将请求与[service worker](https://developers.google.com/web/fundamentals/primers/service-workers/)相交，请注意这一点，因为如果服务器已经为您要刷新的文件发送了[缓存头](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Cache-Control)，浏览器将首先从 HTTP 缓存中响应，如果它没有找到它，那么它将进入网络，所以你最终可能会得到旧文件
3.  从你的策略文件中更改 url，我的建议是你应该根据文件内容的更改来命名它，我使用[md5](https://www.google.com.ec/search?q=md5&rlz=1C1CHBD_esEC794EC794&oq=md5&aqs=chrome..69i57j0j69i60l3j35i39.583j0j4&sourceid=chrome&ie=UTF-8)然后将其转换为字符串和 url 友好，md5 会随着文件的内容而改变，你可以自由发送足够长的 HTTP 缓存标头

我会推荐第三个[看](https://www.youtube.com/watch?v=vAgKZoGIvqs)

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2009-06-18T09:29:33.453

我倾向于对我的框架进行版本化，然后将版本号应用于脚本和样式路径

```
<cfset fw.version = '001' />
<script src="/scripts/#fw.version#/foo.js"/> 
```

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2021-02-01T02:38:11.813

我最近找到了解决这个问题的方法。就我而言，我试图使用 javascript 更新 html 元素；我一直在使用 XHR 根据从 GET 请求中检索到的数据来更新文本。尽管 XHR 请求频繁发生，缓存的 HTML 数据仍然令人沮丧地保持不变。

`fetch`最近，我在api中发现了一种缓存清除方法。fetch api 替代了 XHR，使用起来超级简单。这是一个例子：

```
 async function updateHTMLElement(t) {
            let res = await fetch(url, {cache: "no-store"});
            if(res.ok){
                let myTxt = await res.text();
                document.getElementById('myElement').innerHTML = myTxt;
            }
        } 
```

注意到那个`{cache: "no-store"}`论点了吗？这会导致浏览器破坏该元素的缓存，以便正确加载新数据。天哪，这对我来说是天赐之物。我希望这对你也有帮助。

切线地，要破坏在服务器端更新但保持相同属性的图像的缓存，`src`最简单和最古老的方法是简单地使用`Date.now()`，并将该数字作为 url 变量附加到`src`该图像的属性。这适用于图像，但不适用于 HTML 元素。但是在这两种技术之间，您可以更新您现在需要的任何信息 :-)

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2017-05-16T17:10:01.350

[Cache.delete()](https://developer.mozilla.org/en-US/docs/Web/API/Cache/delete)可用于新的 chrome、firefox 和 opera。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2021-06-17T15:53:45.170

本主题中已经提到了大多数正确答案。但是，我想添加一篇文章的链接，这是我能阅读的最好的一篇文章。

[https://www.fastly.com/blog/clearing-cache-browser](https://www.fastly.com/blog/clearing-cache-browser)

据我所知，最合适的解决方案是：

在 iframe 中发布。接下来是建议帖子的一个小减法：

==============

```
const ifr = document.createElement('iframe');
ifr.name = ifr.id = 'ifr_'+Date.now();
document.body.appendChild(ifr);
const form = document.createElement('form');
form.method = "POST";
form.target = ifr.name;
form.action = ‘/thing/stuck/in/cache’;
document.body.appendChild(form);
form.submit(); 
```

有一些明显的副作用：这将创建一个浏览器历史记录条目，并受到相同的非缓存响应问题的影响。但它避开了 fetch 存在的预检要求，并且由于它是一种导航，拆分缓存的浏览器将清除正确的缓存。

这一个几乎钉了它。Firefox 将保留卡住的对象以获取跨域资源，但仅用于后续获取。每个浏览器都会使对象的导航缓存失效，无论是同源还是跨源资源。

===============================

我们尝试了很多东西，但那个效果很好。唯一的问题是您需要能够以某种方式将此脚本带到最终用户页面，以便您能够重置缓存。在我们的特殊情况下，我们很幸运。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2020-07-27T14:57:37.507

我已经通过使用 [ETag解决了这个问题](https://en.wikipedia.org/wiki/HTTP_ETag)

Etag 类似于指纹，如果给定 URL 的资源发生变化，则必须生成新的 Etag 值。比较它们可以确定资源的两种表示是否相同。

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2019-10-22T09:55:05.747

导致浏览器缓存相同的链接，你应该在 url 的末尾添加一个随机数。 `new Date().getTime()`生成不同的号码。

`new Date().getTime()`只需像调用一样添加链接结尾

```
'https://stackoverflow.com/questions.php?' + new Date().getTime() 
```

输出：`https://stackoverflow.com/questions.php?1571737901173`

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2016-03-20T18:46:05.883

```
window.parent.caches.delete("call") 
```

在控制台中执行代码后关闭并打开浏览器。

* * *

## 回答 #23

> 赞同：-1
> 
> 时间：2020-10-09T07:08:34.497

**参考：** [https ://developer.mozilla.org/en-US/docs/Web/API/Cache/delete](https://developer.mozilla.org/en-US/docs/Web/API/Cache/delete)

缓存删除（）

方法

句法：

```
cache.delete(request, {options}).then(function(found) {
  // your cache entry has been deleted if found
}); 
```

# iis - 未安装 ssl 时 https 到 http 重定向

> ID：1011620
> 
> 赞同：1
> 
> 时间：2009-06-18T09:05:50.207
> 
> 标签：iis

我们有一个启用了 https 的网站。网站改造后，我们删除了证书，并且[https://www.foo.com](https://www.foo.com)不是[http://www.foo.com](http://www.foo.com)。

其他站点中有许多链接，它们链接到我们无法控制的旧 https 站点。我们可以在外面做些什么来将这些链接至少重定向到主页吗？

在这种情况下，url 重写会起作用吗？

我们使用自定义 404 页面修复了一些损坏的链接并跟踪链接。

这是否属于服务器故障？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-06-18T09:14:41.157

你很不走运 - 你可以像@Josh 所说的那样进行 URL 重写，但在浏览器还没达到那一步之前，他们中的大多数人都会给用户一个很大的警告消息，告诉他们 SSL 证书无效，这会推迟大部分游客。

我建议购买 SSL 证书——它们并不昂贵——然后进行重写。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-18T09:11:43.847

使用 mod_rewrite

```
# forces everything to non-secure if secure (http) 
RewriteCond %{SERVER_PORT} =443 
RewriteRule ^(.*)$ http://%{SERVER_NAME}/$1 [R,L] 
```

乔什

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-07-09T15:26:54.940

IIS 的解决方案可能是[ISAPI_Rewrite 3](http://www.helicontech.com/isapi_rewrite/)。这是.htaccess：

```
RewriteBase /
RewriteCond %{HTTPS} on
RewriteRule ^(.*)$ http://%{HTTP_HOST}/$1 [R=301,L] 
```

# ruby-on-rails - 从 Web 检测区域设置（列表分隔符）

> ID：1011628
> 
> 赞同：8
> 
> 时间：2009-06-18T09:07:29.533
> 
> 标签：ruby-on-rails, ruby, regional

在对逗号分隔值（CSV）文件不一定是逗号分隔感到不快之后，我试图找出是否有任何方法可以从 http 请求检测客户端计算机上的区域设置列表分隔符值。

场景如下：用户可以从网站下载一些 CSV 格式的数据（RoR，如果重要的话）。该 CSV 文件是动态生成的，发送给用户，并且大部分时间在目的地的 Windows 机器上双击并在 MS Excel 中打开。现在，如果用户将“，”设置为列表分隔符，则数据将正确排列在列中，但如果设置了任何其他分隔符（此处广泛使用“;”），则所有内容都将被放入单个列中。那么，有什么方法可以检测客户端机器上使用的分隔符，并相应地生成文件？

我有一种沉没的感觉，但我想在我将“无法完成，抱歉”这一行传递给客户之前确定 :)

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2010-05-11T17:12:48.950

[这是我刚刚根据此处](http://www.codeproject.com/Articles/80083/Detecting-User-Regional-Settings-In-The-Web-Browse.aspx)显示的方法编写的 JavaScript 解决方案：

```
function getListSeparator() {
    var list = ['a', 'b'], str;
    if (list.toLocaleString) {
        str = list.toLocaleString();
        if (str.indexOf(';') > 0 && str.indexOf(',') == -1) {
            return ';';
        }
    }
    return ',';
} 
```

关键在于使用系统列表分隔符的 toLocaleString() 方法。

您可以使用 JavaScript 获取列表分隔符并将其设置在 cookie 中，然后您可以从服务器中检测到该 cookie。

我检查了所有的 Windows 语言环境，似乎默认的列表分隔符几乎总是“，”或“；”。对于某些语言环境，控制面板中的下拉列表提供了两个选项；对于其他人，它只提供'，'。一种语言环境 Divehi 有一个我以前从未见过的奇怪字符作为列表分隔符，并且对于任何语言环境，用户都可以输入他们想要的任何字符串作为列表分隔符。

将随机字符串作为 CSV 文件中的分隔符对我来说听起来很麻烦，所以我上面的函数只会返回一个 ';' 或一个'.'，它只会返回一个';' 如果在 Array.toLocaleString 字符串中找不到“，”。我不完全确定 array.toLocaleString 是否具有跨浏览器保证的格式，因此 indexOf 检查而不是在特定索引处挑选字符。

使用 Array.toLocaleString 获取列表分隔符适用于 IE6、IE7 和 IE8，但不幸的是，它似乎不适用于 Firefox、Safari、Opera 和 Chrome（或者至少是我计算机上的这些浏览器的版本）：无论 Windows 的“列表分隔符”设置如何，它们似乎都用逗号分隔数组项。

另外值得注意的是，默认情况下，Excel 在解析 CSV 文件中的数字时似乎使用系统“小数分隔符”。玉。因此，如果您要本地化列表分隔符，您可能还需要本地化小数点分隔符。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-18T15:01:21.193

我认为每个人都应该使用 OpenOffice 中的 Calc——它会询问您何时打开有关编码、列分隔符等的文件。我不知道您的问题的答案，但也许您可以尝试在 html 表或 xml 中发送数据 - excel 应该正确读取它们。根据我的经验，将数据导出到 Excel 并不容易。几周前我遇到了问题，经过几个小时的工作，我向一个无法在 excel 中打开我的 csv 文件的人询问版本。这是Excel 98...

看看[html 示例](http://codesnippets.joyent.com/posts/show/1893)和[xml](http://arydjmal.com/2008/6/8/export-to-excel-in-rails-2)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-12-13T22:07:05.160

getListSeparator 函数的更简单版本，允许任何字符作为分隔符：

```
function getListSeparator_bis()
{
    var list = ['a', 'b'];
    return(list.toLocaleString().charAt(1));
}// getListSeparator_bis 
```

只需在您的操作系统中将任何字符（fe'#'）设置为列表分隔符，然后尝试上面的代码。返回适当的字符（即“#”，如果设置为 sugested）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-18T14:53:01.897

您是否可以让具有非逗号分隔符的用户设置一个配置文件类型的选项，然后根据用户设置生成 CSV，默认为逗号？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-18T14:59:39.853

汤姆斯，据我所知，没有办法实现你所追求的。您最多可以尝试检测用户区域设置并将其映射到区域设置/列表分隔符的数据库，从而更改 .CSV 文件中的列表分隔符。

# silverlight-3.0 - 将查询字符串从 silverlight 传递到 http 处理程序的问题

> ID：1011640
> 
> 赞同：0
> 
> 时间：2009-06-18T09:12:02.317
> 
> 标签：silverlight-3.0, query-string, relative-path

为此，我正在使用 Silverlight 3 beta 和 Visual Studio 2008 SP1。

在 Web 应用程序（服务器端）中，我有一个 HTTP 处理程序 ImageFetcher.ashx，它需要来自查询字符串的 ID 参数，并从数据库中检索数据并将其写入输出流。这工作正常，我已经用一个测试 aspx 页面对其进行了测试，添加了一个带有 src=ImageFetcher.ashx?id=44 的图像控件。

我在同一个解决方案中也有一个 Silverlight 客户端导航应用程序。我的 xaml 中有以下图像标记

```
<Image x:Name="myImage"  Width="400" Height="300" Stretch="Uniform" Source="/ImageFetcher.ashx?id=44"/> 
```

当我运行这个应用程序时，它无法检索图像。当我调试处理程序时，我注意到它没有得到任何查询字符串参数。如果将图像标签更改为使用下面的绝对 URL，它会再次正常工作

```
<Image x:Name="myImage"  Width="400" Height="300" Stretch="Uniform" Source="http://localhost:5573/ImageTest/ImageFetcher.ashx?id=44"/> 
```

但是我不能使用绝对 URL，这里有什么问题？为什么相对 URL 没有将查询字符串正确地传送到服务器端？

谢谢施里达尔

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-18T15:54:29.070

我也在 Silverlight 论坛上发布过，但我也会在这里复制。

相对 URL 是相对于 XAP 的 - 它加载在客户端机器上。将 XAP 下载到客户端后，加载的 ashx 页面将不再与 XAP 相关，因此将找不到。一旦你将 url 设为绝对，你就是在告诉它在你的本地主机 [确切位置] 上查找加载页面。

# css - 如何保留换行符 block?

> ID：1011641
> 
> 赞同：31
> 
> 时间：2009-06-18T09:12:10.977
> 
> 标签：css

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-06-18T09:15:15.180

Are you sure you're not doing something wrong? This code works for me on IE7:

```
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
  <style type="text/css">
  code { white-space: pre; }
  </style>
</head>
<body>
  <code>
      function() {
          alert('yay');
      }
  </code>
</body>
</html> 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-06-18T09:20:15.343

Check your doctype is valid and on the first line. Maybe it's slipping into quirks mode?

# java - 如何识别Java中的按键事件

> ID：1011646
> 
> 赞同：2
> 
> 时间：2009-06-18T09:13:32.797
> 
> 标签：java, user-interface, awt

我在机器人对象上使用键盘事件....

但每次我必须单独指定键....就像

```
Robot r=new Robot();
r.KeyPress(KeyEvent.VK_A);
r.KeyPress(KeyEvent.VK_B);
r.KeyPress(KeyEvent.VK_C);
r.KeyPress(KeyEvent.VK_D); 
```

是否有任何技术可以获取/识别每个键......而不是通过单独指定它们......？**我在keyCode**变量中从服务器端接收键码......所以我可以直接使用这个变量代替**“KeyEvent.VK_D”**，如**r.keyPress(keyCode);**

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-18T09:23:12.373

Key 标识符只是一个 Int 值。当服务器值与 java 值匹配时，您可以直接将值放入。如果不是，则必须创建一个 Map，其中服务器值引用 java 键值。

在 C++ Qt 键事件和 Java 键事件之间的转换过程中，我遇到了同样的问题。该值也不匹配。我必须为此创建一个映射。

看一下 KeyEvent 类。每个键都用一个 int 值列出。您必须检查从服务器获得的值是否与此 int 值匹配。当服务器值不匹配时，您必须创建一个 Map。映射键是服务器值，映射值是按下键对应的 KeyEvent 值。

当值匹配时，您不必创建地图。您可以直接将服务器值用于 Robot 命令。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-20T07:16:55.957

如果我正确理解了您的问题，那么您正在尝试在按下任何键时执行此操作。尽管我怀疑我是否正确阅读了您的问题，但解决方案是使用 KeyEvent.KEY_PRESSED，如果您想要一个操作或在释放键时设置一个变量，它将是 KeyEvent.KEY_RELEASED。虽然，我有点困惑。您是否真的希望在按下每个键时都发生相同的操作，或者您是否想要一组键的唯一事件？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-18T09:23:55.477

嗯……是吗？KeyEvent.VK_D 中的常量只是为了您的方便。使用其他地方的数值绝对没有错，只要相同的值用于相同的键。

# javascript - 如何访问 JavaScript 对象的属性？

> ID：1011648
> 
> 赞同：0
> 
> 时间：2009-06-18T09:14:13.810
> 
> 标签：javascript, scripting

在查看 javascript 编码时，我看到了

```
var detailInf = {
  "hTitle":"Results",
  "hMark":"98"
}; 
```

这个js编码背后的概念是什么。在为变量发出警报时，它显示为“[object Object]”。所以这是一个对象，那么我们如何访问变量并显示来自该对象的数据。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-06-18T09:17:38.670

尝试这样做：

```
alert(detailInf['hTitle']);
alert(detailInf.hTitle); 
```

两者都会提醒“结果”——这是一个 Javascript 对象，可以用作各种字典。

必读：[作为关联数组的对象](http://www.quirksmode.org/js/associative.html)

作为一个脚注，在使用 Javascript 时你应该真的得到[Firebug 。](http://www.getfirebug.com)然后`console.log(detailInf);`你就可以在控制台中得到一个很好地映射出来的对象显示。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-06-18T09:47:30.140

JavaScript 对象的这种形式称为**对象字面**量，就像数组字面量一样。例如，以下两个数组声明是相同的：

```
var a = [1, 2, 3];          // array literal
var b = new Array(1, 2, 3); // using the Array constructor 
```

就像上面一样，一个对象可以用多种方式声明。其中之一是对象字面量，您可以在其中声明属性和对象：

```
var o = {property: "value"}; // object literal 
```

相当于：

```
var o = new Object; // using the Object constructor
o.property = "value"; 
```

对象也可以从构造函数创建。像这样：

```
var Foo = function() {
    this.property = "value";
};

var o = new Foo; 
```

### 添加方法

正如我刚才在评论中所说，这种声明 JavaScript 对象的形式不是 JSON 格式。JSON 是一种数据格式，不允许将函数作为值。这意味着以下是有效的 JavaScript 对象文字，但不是有效的 JSON 格式：

```
var user = {
    age : 16,

    // this is a method
    isAdult : function() {
        // the object is referenced by the special variable: this
        return this.age >= 18;
    }
}; 
```

此外，属性的名称不需要用引号括起来。然而，这在 JSON 中是必需的。在 JavaScript 中，我们将它们括在括号中，其中属性名称是保留字，例如`class`等`while`。所以以下也是等价的：

```
var o = {
    property : "value",
};

var o = {
    "property" : "value",
}; 
```

此外，键也可以是数字：

```
var a = {
    0 : "foo",
    1 : "bar",
    2 : "abz"
};

alert(a[1]); // bar 
```

### 类数组对象

现在，如果上面的对象也有一个`length`属性，它将是一个类似对象的数组：

```
var arrayLike = {
    0 : "foo",
    1 : "bar",
    2 : "baz",

    length : 3
}; 
```

类数组意味着它可以很容易地用正常的迭代构造（for，while）进行迭代。但是，您不能在其上应用数组方法。像 array.slice()。但这是另一个话题。

### 方括号表示法

正如 Paolo Bergantino 已经说过的，您可以使用点符号和方括号符号来访问对象的属性。例如：

```
var o = {
    property : "value"
};

o.property;
o["property"]; 
```

您想在什么时候使用其中一种？人们在动态确定属性名称时使用方括号表示法，如下所示：

```
var getProperty = function(object, property) {
    return object[property];
}; 
```

或者当属性名称是 JavaScript 保留字时，例如`while`.

```
object["while"];
object.while; // error 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-06-18T09:19:06.767

~~那是[JSON](http://www.json.org/)格式~~的对象。那是一个[javascript 对象文字](https://developer.mozilla.org/en/Core_JavaScript_1.5_Guide/Literals#Object_Literals)。基本上，左边的位`:`是属性名称，右边的​​位是属性值。所以，你有一个名为 的变量`detailInf`，它有两个属性，`hTitle`和`hMark`。`hTitle`的值为 Results，`hMark`的值为 98。

```
var detailInf = { "hTitle":"Results", "hMark":"98"};
alert(detailInf.hTitle); //should alert "Results"
alert(detailInf.hMark); //should alert "98 
```

**编辑**保罗的答案更好:-)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-18T09:22:18.567

正如 Dan F 所说，这是一个 JSON 格式的对象。要遍历对象的所有属性，您可以执行以下操作：

```
for (var i in foo) {
    alert('foo[' + i + ']: ' + foo[i]);
} 
```

# linq - 更新 Linq 数据

> ID：1011651
> 
> 赞同：0
> 
> 时间：2009-06-18T09:14:37.833
> 
> 标签：linq

我有一个 Windows 应用程序和一个 Web 应用程序在同一个数据库上运行，但有两个 dbml 文件（Linq）。现在，当我在 Windows 应用程序中更新数据时，我无法在 Web 应用程序中看到更新的数据。如果我重建 Web 应用程序，我可以看到数据。但是在部署之后，Web 应用程序应该在没有对数据库进行任何人工干预的情况下运行。请让我知道是否有任何解决方案。提前致谢。

问候， BLNS

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-07-04T02:35:10.743

听起来像是 Web 应用程序在调用之间使用了相同的数据上下文。
如果我是对的，重新启动 Web 服务器或在 IIS 中回收关联的应用程序池应该与重新部署具有相同的效果。

如果是这种情况，那么您需要重新设计数据检索方法以每次都使用新的数据上下文。

大致：

```
public List<MyData> GetData()
{
  MyDataContext context = new MyDataContext();
  return context.MyData.ToList();
} 
```

# static - 使用 WebPy 作为静态 HTTP 内容服务器

> ID：1011653
> 
> 赞同：3
> 
> 时间：2009-06-18T09:14:47.460
> 
> 标签：static, virtualhost, web.py

如何调整 WebPy 以使用它为多个网站提供静态内容？

我在一个 IP 上运行两个网站，`web.subdomain_application`用于基于名称的虚拟主机。托管静态内容的隐含解决方案是`static/`在包含 HTTP 服务器脚本的目录中创建一个目录，并将两个网站的所有静态文件放在那里。

但是，即使我创建子目录`site1/`和`site2/`内部 `static/`来组织我的资源，也可以请求 Site1 的资源，例如`http://site2.com/static/site1/foo.css`. 对我来说，限制这种跨站点对资源的访问似乎很自然。

如何在 WebPy 上分别为两个站点提供静态内容？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-05-31T22:00:31.510

我更喜欢使用 nginx 来提供静态内容，例如：

```
location ~ ^/(static(/.*)?)$ {
    alias /srv/http/$1;
}

location / {
    include /etc/nginx/conf/uwsgi_params;
    uwsgi_pass unix:/tmp/my_webapp.sock;
} 
```

# outlook - 挂钩以发送/接收 Outlook 联系人的同步事件

> ID：1011655
> 
> 赞同：1
> 
> 时间：2009-06-18T09:15:04.870
> 
> 标签：outlook, vsto, ms-office

如何`SendAndReceive`使用 VSTO 插件为 Outlook 2007 中的联系人文件夹/联系人项目的事件附加事件处理程序？我尝试使用：

```
Application.ActiveExplorer().SyncObjects.ForEach
{
   SyncObject.SyncEnd += \\Do something
} 
```

但它不起作用。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-07-19T08:59:34.137

我试过

```
Application.ActiveExplorer().SyncObjects.AppFolders.SyncEnd += \\EventHandler 
```

这可以发送/接收所有默认文件夹。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-07-14T23:08:55.423

实际上我的需求有点不同，但可能是一样的：我想在发送/接收后收到文件夹更改的通知（在我的情况下是约会）。我的第一个想法（我认为你在同一条轨道上）是检查发送/接收事件，并可能从中获取一些项目集合或类似的东西，但没有这样的东西可用。[（在这个论坛帖子](http://social.msdn.microsoft.com/Forums/en-US/vsto/thread/b8454dd6-9815-4c8c-ae61-c34870ff3af6)中也有解释）

我的第二条路径来自[以下文章](http://www.eggheadcafe.com/software/aspnet/32763644/outlook-2007-addin-appo.aspx)：我可以注册到文件夹的`Item_Add`and `Item_Change`（甚至`Item_Removed`）事件（它们也由发送接收所做的更改触发）：

一些代码：

```
// Get the folder calendar folder and subscribe to the events.
private void ThisAddIn_Startup(object sender, System.EventArgs e)
{
    Application.Session.GetDefaultFolder(Outlook.OlDefaultFolders.olFolderCalendar).Items.ItemAdd += new Microsoft.Office.Interop.Outlook.ItemsEvents_ItemAddEventHandler(Items_ItemAdd);
    Application.Session.GetDefaultFolder(Outlook.OlDefaultFolders.olFolderCalendar).Items.ItemChange += new Microsoft.Office.Interop.Outlook.ItemsEvents_ItemChangeEventHandler(Items_ItemChange);
}

// Do something with it.
void Items_ItemAdd(object Item)
{
    logItem(Item, "Add");
}
void logItem(object Item, string Action)
{

    Outlook.AppointmentItem item = Item as Outlook.AppointmentItem;

    File.AppendAllText(@"e:\log.txt", string.Format("Item {0}: {1}", Action, Item));

    if (item != null)
    {
        File.AppendAllText(@"e:\log.txt", " - Appointment: " + item.Subject);
    }
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-07-18T05:12:23.757

您可以连接邮件发送/接收事件，然后检查邮件类型是否为 ContactItem。这是发送事件的示例。

```
// hook up the event
this.Application.ItemSend += ThisApplication_SentMail; 
```

然后在您的事件处理程序中检查邮件项目类型；

```
internal void ThisApplication_SentMail(object item, ref bool cancel)
{
    Outlook.ContactItem contactItem = item as Outlook.ContactItem;

    // mail message is not a ContactItem, so exit.
    if (contactItem == null) return;

    // do  whatever you need to here

 } 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2021-07-23T07:45:31.983

就我而言，我需要在收到新电子邮件后和电子邮件同步后触发一个事件，以便我收到一封新电子邮件，否则我将不会收到新的电子邮件附件。

下面我的解决方案可能会对您有所帮助。

```
private void ThisAddIn_Startup(object sender, System.EventArgs e)
{
     this.Application.NewMail += Application_NewMail;
}

private void Application_NewMail()
{
_currentExplorer = Application.ActiveExplorer();
_currentExplorer.Session.SyncObjects[1].SyncEnd += AppFolders_SyncEnd;
_currentExplorer.Session.SyncObjects[1].Start();            
}

private void AppFolders_SyncEnd()
{
//Your enter code here
} 
```

# javascript - 文本框 ASP.Net Javascript 中的自动格式化时间

> ID：1011660
> 
> 赞同：0
> 
> 时间：2009-06-18T09:16:43.353
> 
> 标签：javascript, time

我需要使用 Javascript 以 12 小时或 24 小时格式格式化时间，如 10:00 PM 或 12:23 AM

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-18T09:20:30.180

10 种方法来做到这一点

[http://www.webdevelopersnotes.com/tips/html/formatting_time_using_javascript.php3](http://www.webdevelopersnotes.com/tips/html/formatting_time_using_javascript.php3)

```
<script type="text/javascript">
<!--

var a_p = "";
var d = new Date();

var curr_hour = d.getHours();

if (curr_hour < 12)
   {
   a_p = "AM";
   }
else
   {
   a_p = "PM";
   }
if (curr_hour == 0)
   {
   curr_hour = 12;
   }
if (curr_hour > 12)
   {
   curr_hour = curr_hour - 12;
   }

var curr_min = d.getMinutes();

document.write(curr_hour + " : " + curr_min + " " + a_p);

//-->
</script> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-18T09:21:22.157

这里有一些来自[depressedpress.com](http://www.depressedpress.com/Content/Development/JavaScript/Extensions/DP_DateExtensions/Index.cfm)的东西。希望这对你有帮助！

此外，[javascripttoolbox 的](http://www.javascripttoolbox.com/lib/date/)日期库也可以对日期时间做一些技巧。

# triggers - 在 DB2 中，是否可以只有一个触发器用于更新和插入？

> ID：1011673
> 
> 赞同：5
> 
> 时间：2009-06-18T09:19:47.763
> 
> 标签：triggers, db2

我必须创建触发器来保持对我的表的审计。触发器应该在插入和更新时都执行。

目前我有两个触发器

**一个用于插入**：

```
CREATE TRIGGER SCH.TRG_TBL1_AFT_I
  AFTER INSERT ON SCH.TBL1  
  REFERENCING
    NEW AS n
  FOR EACH ROW
 MODE DB2SQL
INSERT INTO SCH.TBL1_AUDIT
VALUES( .. ,, .. ); 
```

**另一个更新**

```
CREATE TRIGGER SCH.TRG_TBL1_AFT_U
  AFTER UPDATE ON SCH.TBL1  
  REFERENCING
    NEW AS n
  FOR EACH ROW
 MODE DB2SQL
INSERT INTO SCH.TBL1_AUDIT
VALUES( .. ,, .. ); 
```

但关键是，是否可以在 DB2 中创建一个触发器来执行任务？[提供两者，触发器正在做同样的事情。]

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-11-27T02:30:36.420

试试这个，该功能从 9.7.x 版本开始可用。

```
CREATE or replace TRIGGER PASSENGER_TR01_BEFORE_IUD
 BEFORE 
    DELETE
 OR UPDATE OF FIRST_NAME 
 OR INSERT ON PASSENGER
REFERENCING 
OLD AS oldRow
NEW AS newRow
FOR EACH ROW
WHEN (1=1) 
Begin
Declare ACTION Char(1) Default '';
-- Use Case/When to inquire trigger-event
Case 
When INSERTING Then
    Set ACTION='I';
When UPDATING  Then
    Set ACTION='U';    
When DELETING  Then
    Set ACTION='D';    
Else
    Set ACTION='N';    
End Case;

-- Use If/Then/Else to inquire trigger-event
If INSERTING Then
    Set ACTION='I';
ElseIf UPDATING  Then
    Set ACTION='U';
ElseIf DELETING  Then
    Set ACTION='D';
Else
    Set ACTION='N';    
End If;
End 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2013-04-15T13:59:16.533

是的，有可能。 **[请参阅创建触发器的文档](http://pic.dhe.ibm.com/infocenter/dzichelp/v2r2/topic/com.ibm.db2z10.doc.sqlref/src/tpc/db2z_sql_createtrigger.htm)**。这是一个粘贴：

```
trigger-event

   .-OR--------------------------------------.   
   V                                     (4) |   
|----+-INSERT--------------------------+-----+------------------|
     +-DELETE--------------------------+         
     '-UPDATE--+---------------------+-'         
               |     .-,-----------. |           
               |     V             | |           
               '-OF----column-name-+-' 
```

这将使您能够说：

`create trigger blah before insert on blah or update of blah`.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2015-06-25T06:03:04.983

[你可以在这里找到更多信息](http://www.ibm.com/developerworks/ibmi/library/i-event_triggers_support/)

```
 CREATE OR REPLACE TRIGGER SET_SALARY
 NO CASCADE
 BEFORE UPDATE OR INSERT ON employee
 REFERENCING NEW AS n OLD AS o
 FOR EACH ROW
 WHEN( o.edlevel IS NULL OR n.edlevel > o.edlevel )
 BEGIN
    -- Give 10% raise to existing employees with new education level.
 IF UPDATING THEN SET n.salary = n.salary * 1.1;
     -- Give starting salary based on education level.
 ELSEIF INSERTING THEN
     SET n.salary = CASE n.edlevel WHEN 18 THEN 50000
  WHEN 16 THEN 40000
         ELSE 25000
  END;
  END IF;
 END 
```

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-06-18T19:10:03.930

抱歉，DB2 不提供将更新和插入触发器组合在一起的方法。

# iphone - 可用时推送通知但保持 2.0 兼容性

> ID：1011677
> 
> 赞同：2
> 
> 时间：2009-06-18T09:20:19.167
> 
> 标签：iphone

新的 iPhone OS 3 启用了推送通知，我想使用它，但是，这将是我感兴趣的 3.0 的唯一功能。我注意到 TapTap Revenge 应用程序在商店中保持了它们的 2.0 兼容性，然而当我将设备升级到 3.0 时，我得到了启用通知的弹出窗口。有谁知道他们是如何做到的？我考虑为 2.0 编译并检查 UIApplication 是否响应 registerForRemoteNotificationTypes 选择器，如果是则调用它。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-18T12:15:49.293

请参阅[您如何选择使用 iphone-os-3-0-features-in-a-2-0-compatible-app](https://stackoverflow.com/questions/986589/how-do-you-optionally-use-iphone-os-3-0-features-in-a-2-0-compatible-app)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-18T13:39:39.470

在 3.0 区域的苹果网站 ( [devforums.apple.com](http://devforums.apple.com) ) 上的开发论坛中，有关于如何做到这一点的讨论。

我面前没有带书签的链接，但是一旦我从另一台计算机上找到它，我就会编辑这篇文章。

这就是它的要点。

*   将 Base SDK 设置为具有您要使用的功能的 SDK（在本例中为 3.0 用于推送）
*   将项目选项中的目标平台设置为您想要支持的最低操作系统版本（对于我的应用，我将选择 2.2.1）
*   在程序上检查您想要使用的功能的存在，以便在程序在旧版本的操作系统上运行时可以优雅地降级（主要示例 - 我将在我的应用程序中使用的一个 - 是推送通知）。

希望有帮助。

克里斯。

# c# - 为什么我不能对字节进行布尔逻辑？

> ID：1011682
> 
> 赞同：6
> 
> 时间：2009-06-18T09:20:47.603
> 
> 标签：c#, .net, byte, boolean-logic

在 C# (3.5) 中，我尝试以下操作：

```
byte byte1 = 0x00;
byte byte2 = 0x00;
byte byte3 = byte1 & byte2; 
```

我得到错误 132：“无法将类型 'int' 隐式转换为 'byte'。存在显式转换（您是否缺少强制转换？）”。| 也会发生同样的情况 和^。

我究竟做错了什么？为什么它问我整数？为什么我不能对字节进行布尔逻辑？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-06-18T09:23:21.750

没有声明各种运算符`byte`- 两个操作数都被提升为`int`，结果是`int`. 例如，加法：

```
byte byte1 = 0x00;
byte byte2 = 0x00;
byte byte3 = byte1 + byte2; // Compilation error 
```

请注意，复合分配确实有效：

```
byte1 += byte2; 
```

最近有一个[关于此的 SO 问题](https://stackoverflow.com/questions/941584/byte-byte-int-why)。我同意这对于按位运算来说尤其令人讨厌，因为结果应该始终是相同的大小，并且它在逻辑上是完全有效的运算。

作为一种解决方法，您可以将结果转换回字节：

```
byte byte3 = (byte) (byte1 & byte2); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-18T09:23:45.383

因为字节（和短）类型不实现这些运算符

见规格：4.1.5

# sql-server - SQL Server 中的跨数据库视图和镜像

> ID：1011693
> 
> 赞同：1
> 
> 时间：2009-06-18T09:22:38.770
> 
> 标签：sql-server, view, mirroring, cross-database

我有一个关于镜像和跨数据库视图的问题。我们在数据库 X 中有一个视图，它引用同一服务器 S1 上的数据库 Y。数据库 X 和 Y 都镜像到另一台服务器 S2。问题是：如果 db X 故障转移到 S2，则引用 db Y 的视图现在正在查看 S2，但 db Y 可能没有故障转移。解决这个问题的最佳方法是什么？您能否创建一个镜像对，以便如果一对中的 dbs 上的 1 个故障转移，另一个也可以吗？

谢谢

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-18T16:44:23.407

我们检测到数据库发生故障并[手动故障转移](http://msdn.microsoft.com/en-us/library/ms179481.aspx)第二个数据库。这篇[文章](http://www.mssqltips.com/tip.asp?tip=1564) 可能会有所帮助；基本上，这是对见证中第一个数据库的故障转移的黑客攻击，可让您触发第二个数据库的故障转移。

[http://www.mssqltips.com/tip.asp?tip=1564](http://www.mssqltips.com/tip.asp?tip=1564)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-07-29T07:51:30.430

如果您升级到 SQL 2012，您可以使用 Always on 可用性组功能为此目的对数据库进行分组。

# sql-server - 将 VB 6.0 应用程序连接到 Oracle

> ID：1011699
> 
> 赞同：0
> 
> 时间：2009-06-18T09:23:10.330
> 
> 标签：sql-server, oracle, vb6

目前我正在使用 Oracle 9i Lite Client 将我的 VB 6.0 应用程序连接到 Oracle 数据库。Oracle 9i Lite Client 安装在所有用户的机器上。（约 200 个）

VB 6.0 应用程序还需要与 SQL Server 2000 数据库通信

我正在考虑更换 Oracle 9i Lite 客户端，以便我可以通过从所有用户的机器中删除 Oracle 9i Lite 客户端并用一些开源或更便宜的选项替换它来降低总体成本，这样我就可以连接到 Oracle 数据库而无需失去与 SQL Server 2000 的连接。

谢谢

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-18T11:49:57.490

试用即时客户端：

[http://www.oracle.com/technology/tech/oci/instantclient/index.html](http://www.oracle.com/technology/tech/oci/instantclient/index.html)

# .net - MethodImplAttribute 如何在 .NET 中工作？

> ID：1011702
> 
> 赞同：7
> 
> 时间：2009-06-18T09:23:37.193
> 
> 标签：.net, attributes, disassembly

我正在研究一些框架代码（System.AppDomain.GetDynamicDir 方法），这就是汇编程序显示的全部内容：

```
[MethodImpl(MethodImplOptions.InternalCall)]
private extern string GetDynamicDir(); 
```

调用此方法时会发生什么？我不是指这个特定的方法，而是具有这个属性的一般方法。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-06-18T09:35:44.097

来自[MSDN](http://msdn.microsoft.com/en-us/library/system.runtime.compilerservices.methodimploptions.aspx)：

> **MethodImplOptions.InternalCall**：指定内部调用。内部调用是对在公共语言运行时本身内实现的方法的调用。

所以基本上，CLR 提供了它自己的这个方法的实现（可能在本机代码中），这就是为什么你在反汇编器中看不到它的原因。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-06-18T09:35:30.647

[在这里](http://msdn.microsoft.com/en-us/magazine/cc163896.aspx)回答：

> (...) **`MethodImplOptions.InternalCall`**与 extern 一起使用来告诉运行时该方法是在系统本身内部实现的。这是为许多核心 .NET Framework 方法完成的，这些方法通过在非托管代码中实现更好。例如， 、 和 Math 类上的许多方法**`String`**都**`GC`**标记为 **`InternalCall`**。正如您所注意到的， **`Guid.CompleteGuid`**它也是一个 **`InternalCall`**.

# java - 将 Java 5/6 功能反向移植到 Java 1.4？

> ID：1011706
> 
> 赞同：8
> 
> 时间：2009-06-18T09:24:22.603
> 
> 标签：java, java1.4, backport

我们一直坚持使用 Java2SE v1.4 直到 2010 年底。这真的很糟糕，但我们无能为力。我们现在必须使用哪些新功能？我可以想到几种方法，例如

*   更改字节码，例如使用[Retrotranslator](http://retrotranslator.sourceforge.net/)或[Retroweaver](http://retroweaver.sourceforge.net/)。

*   库的反向移植，例如[Concurrent Backport](http://backport-jsr166.sourceforge.net/)，但这对泛型没有帮助。

*   模拟 Java 5 功能，例如检查集合、带有辅助方法的可变参数等。

*   通过预编译更改源代码，在最终编译之前剥离所有 1.5 的东西，例如使用[Declawer](http://sites.google.com/site/glazedlists/Home/declawer)可以做到这一点。

我最感兴趣的是在生产环境中使用 Weblogic 和“真实”东西的非常积极的体验。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-07-08T15:44:35.357

感谢您的回答。这是所有相关答案和我自己的研究的摘要。

**更改字节码：Retros**
这是由[“retro”工具](http://en.wikipedia.org/wiki/Comparison_of_backporting_tools)完成的：[Retrotranslator](http://retrotranslator.sourceforge.net/)、[Retroweaver](http://retroweaver.sourceforge.net/)和[JBossRetro](http://www.jboss.org/community/docs/DOC-10738)。Retrotranslator 似乎是其中最成熟和最活跃的工具。这些工具扫描所有类并更改字节码以删除 Java 5 和 6 功能。支持许多 Java5 功能，其中一些通过使用 3rd 方反向移植库。此选项最受欢迎，用户也有一些积极的反馈。实验表明它按预期工作。请参阅[developerworks](http://www.ibm.com/developerworks/java/library/j-jtp02277.html)的简短概述。

优点：您可以完全使用 Java 5 进行开发、构建模块和各种 JAR。最后，您只需将所有类转换为 Java 1.4 并打包您的 EAR。这可以通过 Retrotranslator 的 Maven 集成 ( `org.codehaus.mojo:retrotranslator-maven-plugin`) 轻松完成。

缺点：保守的环境不允许部署更改的字节码。任何编码人员都看不到追溯步骤的结果，因此无法获得批准。第二个问题是恐惧：可能存在一些神秘的生产问题，而追溯代码是另一个可能受到指责的步骤。应用服务器供应商可能会因为更改字节码而拒绝帮助。所以没有人愿意负责在生产中使用它。由于这是一个政治问题而不是技术问题，所以我认为没有解决方案。它发生在我们身上，所以我正在寻找更多的选择:-(

**将 Java5 编译为 Java 1.4：jsr14**
有一个不受支持的选项，`javac -source 1.5 and -target jsr14`它将 Java5 源代码编译为有效的 Java 1.4 字节码。无论如何，大多数功能（如 varargs 或扩展 for 循环）都由编译器翻译。泛型和注释被剥离。不支持枚举，我也不知道自动装箱，因为这些`valueOf`方法大多是在 Java5 中引入的。

缺点：只翻​​译字节码，库使用没有改变。因此，您必须小心不要使用 Java5 特定的 API（但可以使用 Backports）。此外，您必须同时构建所有模块，因为对于开发时间，您可能需要具有通用和注释信息的 Java5 代码。因此，您必须从头开始构建整个项目以用于 Java 1.4 生产。

**将源代码更改回 Java 1.4：Declawer**
正如在[相关问题](https://stackoverflow.com/questions/603828/java-5-to-java-1-4-source-code-backporting-tool)中所回答的那样，有[Declawer](https://glazedlists.dev.java.net/servlets/ProjectDocumentList?folderID=4541&expandFolder=4541&folderID=4540)是一个编译器扩展，适用于泛型和可变参数，但不适用于增强的 for 循环或自动装箱。生成的源“有点时髦，但还不错”。

优点：生成的源代码可用并且可以查看。在最坏的情况下，可以在此源中进行修复。没有“魔法”，因为源代码是有效的 Java。有些人甚至使用 JAD（Java 反编译器）来重新获取 Java 1.4 源代码。如果您使用调试信息进行编译并且不使用内部类，则 Jad readable 的输出是可读的。

缺点：与 类似`-target jsr14`，您需要在部署中增加一个步骤。图书馆也有同样的问题。

**将源更改回 Java 1.4：手动**
有几个答案建议手动进行。对于一个自动的、重复的构建过程，这当然没有用，但对于一次性更改它是合理的。只是自动化可能的事情。也许看看 Antlr 来创建一个本土的转换工具。

**Backported Libraries：**
问题是，Java5 还提供了新的库，这些库在旧的 JRE 中不可用，请参阅[相关问题](https://stackoverflow.com/questions/547872/converting-java-1-5-source-into-1-1-source)。幸运的是，有几个向后移植的库可以为您提供 Java5 的一些功能，但不能模拟语言特性，例如泛型。

*   [注释](http://backport175.codehaus.org/)，在[TSS讨论](http://www.theserverside.com/news/thread.tss?thread_id=31882)
*   [同时](http://backport-jsr166.sourceforge.net/)
*   [com.sun.net.httpserver](http://javablog.co.uk/2007/10/27/http-server-api-backport-to-java-5/)（Java 6 到 5）
*   [Gif 写作](http://www.jakobnielsen.net/java6-gif-backport/)（Java 6 到 5）
*   开始您自己的反向移植项目；-)
*   您可以从 JDK 或其他库中复制您需要的类，但它们很可能与其他类相关。

**在 Java 1.4 代码中模拟 Java5 功能：**
我正在考虑您可能会做的一些事情，以使您的生活更轻松，并且仍然使用 Java 1.4。最重要的特性是类型安全的集合，这里有一些想法：

*   您可以使用一些模板创建自己的类型安全容器，而不是使用泛型。
*   添加一个类型安全的迭代器（不再是迭代器）。
*   添加`asList`允许`1,2,...,n`参数和它们的数组的方法（以模拟可变参数）。
*   可变参数（将`1,...,n`参数转换为数组）的方法，`valueOf`可以放在一些帮助类中。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-18T09:28:15.653

> 源代码预编译，在最终编译和部署之前剥离所有 1.5 的东西。有没有可以做到这一点的工具？

是的。它们被称为 Retrotranslator 或 Retroweaver。除了泛型（无论如何它只是为了编译器的缘故而存在），你不能简单地“剥离 1.5 的东西”。枚举（也许还有其他一些特性）必须用功能等效的代码替换。这正是这些工具的作用。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-06-18T14:05:29.760

**您可以使用 JDK 1.5 功能进行编码，**并在编译时以 JDK 1.4 为目标。查看可用的 Javac 选项。但是，大多数库现在都使用 JDK 1.5 代码，因此您将被旧库卡住。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-18T18:44:19.900

值得注意的是，虽然 Java 1.4 已经 EOL 一段时间了。Java 5.0 将于 2009 年 10 月 8 日 EOL。如果有人向您承诺到 2010 年 Java 5.0，我会问为什么？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-07-08T15:41:39.637

要在 java 1.4 中模拟注释，您可以使用[http://xdoclet.sourceforge.net/xdoclet/index.html](http://xdoclet.sourceforge.net/xdoclet/index.html)

# .net - 正则表达式替换单词中间的连字符

> ID：1011708
> 
> 赞同：2
> 
> 时间：2009-06-18T09:25:10.793
> 
> 标签：.net, regex

我需要一个正则表达式来替换任何单词中间的连字符，但不要触及前导或尾随或独立的。这是用于 Regex.Replace() 中的 .NET

我试过以下

```
\w[-]\w 
```

但这也捕获了连字符两侧的字符。例如，我需要的是以下字符串

-test 测试-测试-测试

如果替换字符是 !，则变为

-test 测试！测试 -test

任何帮助都得到了极大的帮助

谢谢

詹姆士

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-06-18T10:20:51.460

如果我正确理解了这个问题，那就是匹配连字符，而不是它旁边的单词。这是一个类似 perl 的正则表达式：

```
(?<=\w)-(?=\w) 
```

这是一个积极的后向断言、一个连字符和一个积极的前瞻断言。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-18T09:33:27.343

在 Perl 中（你没有提到一种语言）这有效：

```
/\w-\w/ 
```

例如，试试这个单行：

```
mine:~> perl -e '$x="abc-def"; $x=~/\w(-)\w/; print "$x $1\n";'
abc-def - 
```

或者这个：

```
mine:~> perl -e '$x="abc-def"; print "$x\n";$x=~s/(\w)-(\w)/$1 $2/; print "$x\n";'
abc-def
abc def 
```

这是一个示例（来自评论）替换字符串中*所有*相关的“-”：

```
mine:~> perl -e '$x="-this i-s a te-st-"; print "$x\n";$x=~s/(\w)-(\w)/$1$2/g; print "$x\n";'
-this i-s a te-st-
-this is a test- 
```

请注意，在此示例中，我只是删除了破折号，而在前面的示例中，我将其替换为空格。我还在`g`替换命令中添加了修饰符，以使其替换所有“-”实例。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-18T10:02:44.617

```
echo "- foo-bar - bar-foo -" | sed -e 's/\([[:alnum:]]\)-\([[:alnum:]]\)/\1\2/g' 
```

如果您使用 sed，您可能使用了错误的字符类来匹配字母数字表达式。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-18T09:40:20.187

此正则表达式匹配其中恰好有 1 个连字符的所有单词：

```
[a-zA-Z]+[-][a-zA-Z]+ 
```

这相当于：

```
\w+[-]\w+ 
```

您的表达式匹配连字符之前的字母、连字符和连字符之后的字母。它会找到您想要的所有连字符，即使是包含多个连字符的单词。你想如何替换连字符？你能更具体地说明你的目标吗？

# php - PHP中的求和数组

> ID：1011710
> 
> 赞同：0
> 
> 时间：2009-06-18T09:25:29.123
> 
> 标签：php, arrays, sum

我必须对一些数组求和（数组数组）。我的数组的结构是这样的：

```
Array([id]=>some_id, [name]=>some_name, [value]=>float_value) 
```

我知道我之前有 N 个数组。我需要对具有相同 ID 的人求和。

任何的想法？

示例：
**

```
Array
(
    [id] => 1
    [name] => John00
    [value] => 0.9
)
Array
(
    [id] => 2
    [name] => Ann01
    [value] => 0.011
)
Array
(
    [id] => 3
    [name] => Ann
    [value] => 0.1
) 
```

* * *

**

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-18T09:38:16.553

我不完全确定您要做什么 - 我假设您希望每个不同 id 按 id 分组的总和，但我可能错了。

```
<?php
//result array of sums
$sums = array();

//example data
$source = array(
    array('id'=>3, 'name'=>'some_name6', 'value'=>1.6),
    array('id'=>1, 'name'=>'some_name', 'value'=>1.4),
    array('id'=>1, 'name'=>'some_name2', 'value'=>7.2),
    array('id'=>2, 'name'=>'some_name3', 'value'=>4.4),
    array('id'=>1, 'name'=>'some_name4', 'value'=>1.2),
    array('id'=>2, 'name'=>'some_name5', 'value'=>1.4),
);

foreach ($source as $ar) {
    //create an entry for this id in the array of sums if does not exist.
    if (!isset($sums[ $ar['id'] ])) {
        $sums[ $ar['id'] ] = 0;
    }

    //add 'value' key to sum for that id
    $sums[ $ar['id'] ] += $ar['value'];
}

//sort by id
ksort($sums);

print_r($sums);

/* output:
Array
(
    [1] => 9.8
    [2] => 5.8
    [3] => 1.6
)
*/ 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-18T09:42:44.440

这看起来像是来自数据库，而查询是执行此类操作的最佳位置。（如果这不是来自数据库的数据，请忽略此答案）。

```
SELECT id, SUM(value)
FROM YourTable
-- add your WHERE-constraints here
GROUP BY id; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-18T10:05:03.567

伪代码：

```
$totals = array();

function add($in)
{
   global $totals;
   if(!isset($totals($in['id']))
   {
      $totals[$in['id']] = $in['value'];
   }else
   {
      $totals[$in['id']] += $in['value'];
   }
}

array_walk('add',$input_array);

var_dump($totals); 
```

# cocoa - NSArray 到 C 数组

> ID：1011711
> 
> 赞同：19
> 
> 时间：2009-06-18T09:25:33.727
> 
> 标签：cocoa, opengl

我们可以将 NSArray 转换为 c 数组吗？如果没有，还有什么替代方案。[假设我需要在 opengl 函数中提供 c 数组，其中 c 数组包含从 plist 文件中读取的顶点指针]

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2009-06-18T10:22:51.193

答案取决于 C 数组的性质。

如果您需要填充原始值和已知长度的数组，您可以执行以下操作：

```
NSArray* nsArray = [NSArray arrayWithObjects:[NSNumber numberWithInt:1],
                                             [NSNumber numberWithInt:2],
                                             nil];
int cArray[2];

// Fill C-array with ints
int count = [nsArray count];

for (int i = 0; i < count; ++i) {
    cArray[i] = [[nsArray objectAtIndex:i] intValue];
}

// Do stuff with the C-array
NSLog(@"%d %d", cArray[0], cArray[1]); 
```

这是一个示例，我们希望从 中创建一个新的 C 数组`NSArray`，并将数组项保持为 Obj-C 对象：

```
NSArray* nsArray = [NSArray arrayWithObjects:@"First", @"Second", nil];

// Make a C-array
int count = [nsArray count];
NSString** cArray = malloc(sizeof(NSString*) * count);

for (int i = 0; i < count; ++i) {
    cArray[i] = [nsArray objectAtIndex:i];
    [cArray[i] retain];    // C-arrays don't automatically retain contents
}

// Do stuff with the C-array
for (int i = 0; i < count; ++i) {
    NSLog(cArray[i]);
}

// Free the C-array's memory
for (int i = 0; i < count; ++i) {
    [cArray[i] release];
}
free(cArray); 
```

或者，您可能想要`nil`-terminate 数组而不是传递它的长度：

```
// Make a nil-terminated C-array
int count = [nsArray count];
NSString** cArray = malloc(sizeof(NSString*) * (count + 1));

for (int i = 0; i < count; ++i) {
    cArray[i] = [nsArray objectAtIndex:i];
    [cArray[i] retain];    // C-arrays don't automatically retain contents
}

cArray[count] = nil;

// Do stuff with the C-array
for (NSString** item = cArray; *item; ++item) {
    NSLog(*item);
}

// Free the C-array's memory
for (NSString** item = cArray; *item; ++item) {
    [*item release];
}
free(cArray); 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-06-18T15:33:09.613

`NSArray`有一种`-getObjects:range:`为数组的子范围创建 C 数组的方法。

例子：

```
NSArray *someArray = /* .... */;
NSRange copyRange = NSMakeRange(0, [someArray count]);
id *cArray = malloc(sizeof(id *) * copyRange.length);

[someArray getObjects:cArray range:copyRange];

/* use cArray somewhere */

free(cArray); 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-06-18T09:43:20.007

我建议转换自己，例如：

```
NSArray * myArray;

... // code feeding myArray

id table[ [myArray count] ];

int i = 0;
for (id item in myArray)
{
    table[i++] = item;
} 
```

# loops - 您对跟踪和避免循环中的错误有什么建议？

> ID：1011712
> 
> 赞同：2
> 
> 时间：2009-06-18T09:25:45.783
> 
> 标签：loops, for-loop, while-loop

我刚刚发现......再次......一个实时浪费错误如下

```
for (int i = 0; i < length; i++)
{ //...Lots of code 
    for (int j = 0; i < length; j++)
    {
        //...Lots of code 
    }
} 
```

你有没有注意到应该是 j 的内部 i ？我也没有。所以从现在开始我将使用：

```
for (int i = 0; i < length; i++)
{
    for (int i1 = 0; i1 < length; i1++)
    {
    }
} 
```

您对内部和外部 while 和 for 循环有什么建议？

编辑：感谢您的宝贵回复。特此简要总结建议的技巧：

*   为索引变量使用有意义的变量名称（而不是我使用 SomeObjCollectionLength ）
*   将内循环的内容放入一个单独的方法中，并从外循环调用该方法
*   外循环和内循环之间无法管理的代码行数是代码异味的强烈信号
*   避免复制粘贴和匆忙，小心编写索引变量

您可能需要查看[LBushkin](https://stackoverflow.com/users/91671/lbushkin)的摘要以了解[以下内容](https://stackoverflow.com/questions/1011712/what-are-your-tips-for-keeping-track-and-avoiding-bugs-in-loops/1015064#1015064)

*   尽可能使用 foreach 和迭代器
*   在进入循环之前初始化变量
*   使每个循环只执行一个功能。避免在一个循环中混合职责
*   如果可能的话，让你的循环足够短，以便一次查看所有内容

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-06-18T09:33:18.140

不要使用 i & j（或任何其他单字母变量）作为索引名称。使用专有名称，您将不会遇到此类问题。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-06-18T09:32:45.910

最简单和最干净的解决方案之一是将内部循环的内容放入一个方法中，使其变为：

```
for (int i = 0; i < length; i++)
{
    DoSomething();
}

private void DoSomething(int outerValue)
{
    for (int i = 0; i < length; i++)
    {
        // Do something else
    }

} 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-06-18T09:35:45.217

对我来说，这里的“代码味道”是“大量代码”。

如果循环中的代码量特别大，则内循环和外循环之间的距离意味着它们不太可能相互比较以确保正确性。

诚然，孤立地查看内部循环的开始应该会引起您的注意，但是将主要结构放在尽可能小的代码段中会使您的大脑难以消化。

可以将“大量代码”部分提取到单独的函数/方法中，以减小主要结构的大小——但这可能并不总是可行的。

另外，我想说“i1”不是一个特别好的变量名选择，因为这往往会鼓励“i2”、“i3”等，这并不能真正导致可理解的代码。也许用更有意义的东西替换所有循环变量将有助于代码的清晰性，并减少原始错误的机会。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-06-18T20:38:22.503

我对编写更好的循环代码的最佳建议（没有特别的顺序）（其中大部分来自优秀的书[Code Complete](https://rads.stackoverflow.com/amzn/click/com/0735619670)）：

2.  避免循环的多个出口点。
3.  谨慎使用继续/中断。
4.  尽可能将嵌套循环重构为单独的例程。
5.  使用有意义的变量名使嵌套循环可读。
6.  尽可能使用 foreach() 循环，而不是 for(i=...) 循环。
7.  仅从一个位置输入循环。不要用 goto 跳入循环。曾经。
8.  将初始化代码放在循环之前。
9.  将循环初始化语句与它们相关的循环保持一致。
10.  避免在非嵌套循环之间重用变量。10.将循环索引变量的范围限制为循环本身。
11.  使用 while(true) 进行无限循环，而不是 for(;;)
12.  在提供块结构的语言中（例如'{' 和'}'）使用它们而不是缩进来包含循环语句。是的，即使是单线循环。
13.  避免空循环。
14.  避免将家务琐事放在循环的中间，而是将它们放在开头和/或结尾。
15.  使每个循环只执行一个功能。避免在一个循环中混合职责。
16.  使循环终止条件明显。
17.  不要使用 for() 循环的循环索引变量来使其终止。
18.  避免使用依赖于循环索引器最终值的代码。
19.  考虑在复杂循环中使用安全计数器——可以检查它们以确保循环不会执行太多或太少的次数。
20.  尽可能使用 break 语句来终止 while 循环。
21.  如果可能的话，让你的循环足够短，以便一次查看所有内容。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-06-18T09:30:53.527

这是一个复制粘贴错误，避免复制粘贴。

至于你的解决方案，它也好不到哪里去。错误仍然可以在大量代码之间溜走。即使是循环临时变量，我也倾向于使用有意义的名称。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-06-18T09:40:35.973

在 VS 上利用您的 IDE，尝试使用它：http: [//msdn.microsoft.com/en-us/library/z4c5cc9b (VS.80).aspx](http://msdn.microsoft.com/en-us/library/z4c5cc9b(VS.80).aspx)

示例：输入**for** ，然后依次按**Tab Tab**

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-06-18T09:42:21.990

我来这里是为了聪明并说“我只是第一次就写对了”。但是后来我看到了你的例子，而且，我自己已经做过太多次了。

当您需要这样的嵌套循环时，我唯一的解决方案是在编写代码时保持警惕和思考。

在可能的情况下，使用迭代器和 for each 循环很好。

另外，我看不出您建议的解决方案会变得更好。而且看起来也不怎么好看。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-06-18T09:47:52.620

首先，减少循环体的大小，即将东西移动到单独的函数中。函数的长度超过屏幕可以容纳的长度通常是一个坏主意，因此循环应该更小。

其次，在这种情况下使用有意义的变量名。我只会在几行代码的简单循环中使用 i 和 j。例如，如果你正在处理一个二维数组，“col”和“row”会更有意义，让代码更容易阅读（“which was which?”）并且更容易发现这样的错误。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-06-18T09:30:00.143

你只需要特别注意这些问题，没有灵丹妙药。即使您建议使用“更好的命名”，您有时也会忘记这是第 N 级还是第 (N+M) 级嵌套循环并出错。

如果需要嵌套循环，请仔细编写。如果可以通过将外部循环体提取到一个可以很好地防止索引滥用的函数来避免它。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-06-18T09:34:30.773

如果我真的需要它们，我会使用 'ii' 和 'jj' 作为瞬态循环计数器 - 它们比 'i' 和 'j' 更容易搜索，并且在上述示例中也更容易发现。为了更好，您实际上可以使用真正的变量名。如果你正在循环一个字符串，那么你可以称它为 characterIndex 或其他东西。它需要更多的打字，但它会记录自己并节省以后调试晦涩问题的时间。

更好的是避免使用数字计数器并在集合上使用命名迭代器。在我看来，它们使意图更加清晰。

最后，如果可能的话，最好完全取消循环：[Boost::Foreach](http://www.boost.org/doc/libs/1_35_0/doc/html/foreach.html)是在 C++ 中执行此操作的一种方法，尽管我通常更喜欢使用 Python 等语言，它本机允许直接迭代容器的内容而无需需要增加索引值或迭代器。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-06-18T09:36:36.653

尝试使用更多的声明性循环结构。例如，如果您真的不需要索引（那些`i`s 和`j`s）并且您的编程环境允许，您可以使用`foreach`构造来迭代集合。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-06-18T09:40:48.453

就像在很多事情上一样，Steve McConnell 的[Code Complete](http://www.cc2e.com/)中有一些很好的建议。值得您花时间阅读他所说的关于构建良好循环代码的内容。我手头没有这本书的副本，但整本书值得你花时间。

# php - 使用 PHP 处理退回电子邮件？

> ID：1011714
> 
> 赞同：29
> 
> 时间：2009-06-18T09:26:19.247
> 
> 标签：php, email, email-bounces

这是我的场景：

我有 2 个电子邮件帐户：admin@domain.com 和bounce@domain.com。

我想用 admin@domain.com 向我的所有用户发送电子邮件，然后“回复”bounce@domain.com（直到这里，我的 PHP 脚本可以处理它）。

当邮件无法发送时，它被发送到bounce@domain.com，错误信息可能是553（不存在的电子邮件......）等。

我的问题是：如何通过处理脚本将所有这些退回电子邮件（无法发送的电子邮件）定向到bounce@domain.com 以检查退回错误代码？

我应该为“处理脚本”使用什么编程语言？

“处理脚本”会是什么样子？能给个样品吗？

换句话说：

**我应该遵循哪些程序来处理退回电子邮件？**

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-06-18T14:36:23.613

最好的方案是能够对反弹的类型进行分类：软、硬……

我们使用的是[BounceStudio](http://www.boogietools.com/Products/Linux/)。您需要编译它并添加 php 库......一点也不难。您拥有该产品的免费和付费版本

一旦我们检测到[退回的类型，](http://www.boogietools.com/Products/Linux/BounceStudioAPI/Email-Bounce-Boogie-Bounce-API-Categories.asp?sReturnURL=/Products/Linux/Default.asp)我们使用 PEAR::MAIL::MIME 来搜索我们之前添加到电子邮件中的自定义标题，让我们说：

```
X-user-id: XXXXX
X-campaign-id: YYYYYY 
X-recipient-id: SSSSSSSSS 
```

通过这种方式，我们可以知道我们发送电子邮件的真实收件人。

希望这对你有帮助！所以你可以帮助我达到 500 分：P

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-06-18T09:39:41.823

为什么不创建一个bounce@domain.com 并使用php 来[阅读这些电子邮件](http://www.weberdev.com/get_example-4015.html)并做任何你想做的事？

在您发表评论后编辑：请检查我的链接，其中有一个 php 脚本，它将教您如何使用 php 打开和电子邮件箱并阅读电子邮件。您可以使用此脚本来检查错误消息。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-06-18T10:58:40.013

让电子邮件退回到真正是电子邮件地址的地址（带有登录详细信息等）。

制作一个每 x 分钟运行一次的 php 脚本（例如使用 cron 作业）。此 php 脚本必须执行以下操作。- 从框中检索所有电子邮件（例如使用[Zend Mail](http://framework.zend.com/manual/en/zend.mail.read.html)） - 检查消息中的错误（例如，通过使用正则表达式搜索它） - 做任何必要的事情。

如果您想具体了解谁被退回，您可以使用用户特定的退回地址。（例如参见[本网站](http://www.umailcampaign.com/Article/16.aspx)）

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2010-11-16T11:10:09.203

也许答案有点晚了，但你总是可以尝试一些新的东西。上周我有一个这样的任务，并使用了 Chris Fortune 编写的 BOUNCE HANDLER 类，它将反弹分割成关联数组 - [http://www.phpclasses.org/browse/file/11665.html](http://www.phpclasses.org/browse/file/11665.html)

这将在您使用某些邮件程序连接到 POP3 以从中获取退回邮件后使用，然后将其解析为碎片，如果具有您搜索的状态，请执行必要的操作。

干杯。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-06-18T09:41:19.247

如果您设置了 POP3 邮箱`bounce@domain.com`，您可以使用 PHP 编写的 POP3 客户端脚本来检索邮件并检查无法投递的邮件。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2018-09-17T11:26:30.287

您可以使用[imap_open](http://php.net/manual/de/function.imap-open.php)从 PHP 访问您的邮件。

此功能也适用于 POP3，但并非每个功能都可以在这里使用。不过我猜 2018 年大多数电子邮件客户端应该支持 IMAP。

> 此功能也可用于向 POP3 和 NNTP 服务器打开流，但某些功能和特性仅在 IMAP 服务器上可用。

这是一个小例子，如何遍历您的电子邮件：

```
 /* connect to server */
  $hostname = "{$your-server:$your-port}INBOX";
  $username = 'my-username';
  $password = '123';

  /* try to connect */
  $inbox = imap_open($hostname,$username,$password) or die('Cannot connect to mailbox: ' . imap_last_error());

  /* grab emails */
  $emails = imap_search($inbox,'ALL');

  /* if emails are returned, cycle through each... */
  if($emails) {
    /* for every email... */
    foreach($emails as $email_number) {

        $message = imap_body($inbox,$email_number,2);
        $head    = imap_headerinfo($inbox, $email_number,2);
        // Here you can handle your emails
        // ...
        //  ...
      }
  } 
```

就我而言，我知道我总是从`Mailer-Daemon@myserver.com`. 所以我可以识别出这样的反弹：

```
if($head->from[0]->mailbox == 'Mailer-Daemon')
{
  // We have a bounce mail here!
} 
```

你说：

> 当邮件无法发送时，它被发送到bounce@domain.com，错误信息可能是553（不存在的电子邮件......）等。

因此，如果您的退回电子邮件的主题为“邮件传递失败：错误 553”，那么您可以通过主题来识别它们，如下所示：

```
if($head->subject == 'Mail delivery failed: Error 553')
{
  // We have a bounce mail here!
} 
```

失败的电子邮件地址不在标头中，因此您需要`$message`使用一些智能代码从变量中解析它。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2011-11-16T16:02:25.097

我正在寻找同一个问题的答案。问题的部分更多，选项也更多。

为了处理退回的电子邮件，我找到了一个[PHP 类](http://www.phpclasses.org/package/2691-PHP-Parse-bounced-e-mail-message-reports.html)，如果您有一个 PHP 支持的站点，则不需要编译或额外的软件安装。这是非常容易使用。

如果您使用 cPanel 或 InterWorx/SiteWorx，您可以配置一些地址以使用脚本（例如 PHP 脚本）处理接收到的电子邮件，这样您就可以借助上述类编写自己的处理程序。当然，您也可以创建普通的电子邮件帐户，通过 POP3 或 IMAP 检索邮件，然后对其进行解释。我认为第一个更好，因为它是直接的，您不必使用其他渠道，例如 IMAP。当然如果你不能配置你的邮件服务器，或者不知道怎么做，那么前者更适合你。

祝你好运！:)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2011-03-23T11:36:20.950

[您始终可以使用http://cloudmailin.com](http://cloudmailin.com)之类的东西通过 http 将退回的电子邮件转发到您的 php 服务器，但是使用专门用于发送电子邮件并使用其 api 检索退回详细信息的服务可能会更好。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2012-02-08T04:10:22.970

在 php 邮件命令[http://php.net/mail](http://php.net/mail)

您使用第五个参数并向其添加“-f”。

因此，您使用“-f mybouncebox@mydomain.com”作为参数

phpList[通讯管理器](http://www.phplist.com)使用它来管理退回邮件。

一旦退回邮件填满邮箱，您就可以将它们弹出并处理它们。这是处理它们的最简单方法，而不是在它们到达时处理它们。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2013-12-16T11:19:47.110

We are using Procmail to filter these kind of mails. After examining some of the solutions already mentioned here, we ended up with a simple Procmail recipe to detect bounce messages. Depending on the accuracy you need, this might be applicable to your situation.

For details, check this [blog entry](http://blog.claasloader.de/blog/2013/07/19/bounce-mail-handling/).

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2011-08-29T00:33:48.147

我在为此寻找 PHP 解决方案时运气不佳，但是我遇到了这个产品，它可以满足我的需要。

它作为本机应用程序 mac/win 运行，但它可以完成这项工作。

[http://www.maxprog.com/site/software/internet-marketing/email-bounce-handler_sheet_us.php](http://www.maxprog.com/site/software/internet-marketing/email-bounce-handler_sheet_us.php)

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2012-10-31T06:41:50.670

这是使用 IMAP 处理退回邮件的固定解决方案。

我将 Mail 实例的 Return-Path 标头更改为专用的bounce@xxxxxx.us

我认为可行的唯一简单方法是以下方法，它通过 POP3 检查专用收件箱，并可以根据收到的消息处理每封电子邮件。

```
$inst=pop3_login('mail.xxxxxx.us','110','bounce@xxxxxx.us','pass');
$stat=pop3_stat($inst);
//print_r($stat);
if($stat['Unread']>0){
    echo "begin process<br><br>";
    $list=pop3_list($inst);
    //print_r($list);
    foreach($list as $row){
        if(strpos($row['from'],'MAILER-DAEMON')!==FALSE){
            $msg=imap_fetchbody($inst,$row['msgno'],'1');
            if(strpos($msg,'550')!==FALSE){
                echo "handle hard bounce".$msg."<br><br>";
                //WHATEVER HERE TO PROCESS BOUNCE
            }   
        }
        else{
            $msg=imap_fetchbody($inst,$row['msgno'],'1');
            echo "not from my server. could be spam, etc.".$msg."<br><br>";
            //PROBABLY NO ACTION IS NEEDED
        }   
        //AFTER PROCESSING
        //imap_delete ( resource $imap_stream , int $msg_number [, int $options = 0 ] )
        //commented out because I havent implemented yet. see IMAP documentation
    }   
}   
else{
    echo "no unread messages";  
}

//imap_close ( resource $imap_stream [, int $flag = 0 ] )
//commented out because I havent implemented yet. see IMAP documentation.
//flag: If set to CL_EXPUNGE, the function will silently expunge the mailbox before closing, removing all messages marked for deletion. You can achieve the same thing by using imap_expunge()

function pop3_login($host,$port,$user,$pass,$folder="INBOX",$ssl=false) 
{ 
    $ssl=($ssl==false)?"/novalidate-cert":""; 
    return (imap_open("{"."$host:$port/pop3$ssl"."}$folder",$user,$pass)); 
} 
function pop3_stat($connection)        
{ 
    $check = imap_mailboxmsginfo($connection); 
    return ((array)$check); 
} 
function pop3_list($connection,$message="") 
{ 
    if ($message) 
    { 
        $range=$message; 
    } else { 
        $MC = imap_check($connection); 
        $range = "1:".$MC->Nmsgs; 
    } 
    $response = imap_fetch_overview($connection,$range); 
    foreach ($response as $msg) $result[$msg->msgno]=(array)$msg; 
        return $result; 
} 
function pop3_retr($connection,$message) 
{ 
    return(imap_fetchheader($connection,$message,FT_PREFETCHTEXT)); 
} 
function pop3_dele($connection,$message) 
{ 
    return(imap_delete($connection,$message)); 
} 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2015-11-24T17:25:53.180

我有同样的问题，确切的情况。默认情况下，我的邮件服务器会将我所有返回的邮件发送到最初发送邮件的同一帐户，并自动发送 msg **"Mail delivery failed: returned message to sender"**。

我真的不想知道它为什么被退回，有这么多邮件交易，我只想删除坏的。没有时间检查特定规则，例如是否存在，不可用等，，，只想标记删除并继续。

退回邮件非常简单，因为您需要处理许多不同的服务器和响应类型。每个反垃圾邮件软件或操作系统方案都可以通过退回的电子邮件发送不同的错误代码。

如果您想设置 IMAP ，我建议您阅读并下载处理退回电子邮件的固定调试版本- 使用来自 KIDMOSES**的 PHPMAILER-BMH 和 AUTHSMTP** [http://www.kidmoses.com/blog-article.php?bid=40](http://www.kidmoses.com/blog-article.php?bid=40)并发送您自己的自定义标头，将它们发送到您的**bounce@domain.com**，然后交叉手指查看脚本是否捕获了您在退回邮件中发送的标头。我试过了，有效。

但是，如果您想按照我的快速简便的解决方案解决我的问题，这里就是秘密。

1 - 从 KIDMOSES 网站或我的网站下载更好的版本，以防 KIDMOSES 想搬到其他地方[http://chasqui.market/downloads/KIDMOSES-phpmailer-bmh.zip](http://chasqui.market/downloads/KIDMOSES-phpmailer-bmh.zip)

2 - 包含返回邮件文本的变量是 $body ，它本身包含错误的返回电子邮件（所以它是一个多维数组）。（还包含您的服务器邮件和其他 DNS 邮件内容，但我们正在寻找 BAD MAIL BOUNCED。

3 - 由于您的 OWN SERVICE 正在向您发送退回的电子邮件，因此它不太可能更改其格式和自己的标题，发送退回的电子邮件，因此您可以安全地选择退回的电子邮件数组返回的顺序。在我的情况下，总是相同的格式模板。（除非您更改系统或提供商）

4 - 我们查看**$body**并搜索所有电子邮件字符串变量并将它们提取到一个名为 **$matches的****二维数组中**

 ****5 - 我们通过使用print_r(array_values($matches))**打印数组来选择数组位置；

 **6 - 这是您需要修改的代码。它来自**class.phpmailer-bmh.php**文件的第 500 行左右

```
 // process bounces by rules
  $result = bmhDSNRules($dsn_msg,$dsn_report,$this->debug_dsn_rule);
} elseif ($type == 'BODY') {
  $structure = imap_fetchstructure($this->_mailbox_link,$pos);
  switch ($structure->type) {
    case 0: // Content-type = text
      $body = imap_fetchbody($this->_mailbox_link,$pos,"1");
      $result = bmhBodyRules($body,$structure,$this->debug_body_rule);

      //MY RULE IT WORKS at least on my return mail system..
      $pattern = '/[a-z0-9_\-\+]+@[a-z0-9\-]+\.([a-z]{2,3})(?:\.[a-z]{2})?/i';
      preg_match_all($pattern, $body, $matches);
        //print_r( array_values( $matches ));     //To select array number of bad returned mail desired, usually is 1st array $matches[0][0]          
        echo "<font color = red>".$matches[0][0]."</font><br>";
      break; 
```

因此，我们忘记了返回的标头并专注于糟糕的电子邮件。你可以超越它们，你可以使用 MySQL，或者处理任何你想做的事情。

**重要** 注释在示例目录中的 callback_echo.php 中的回声，否则您会在打印之前得到所有垃圾。

```
function callbackAction ($msgnum, $bounce_type, $email, $subject,      $xheader, $cheader, $remove, $rule_no=false, $rule_cat=false, $rule_msg='', $totalFetched=0) {
  $displayData = prepData($email, $bounce_type, $remove);
  $bounce_type = $displayData['bounce_type'];
  $emailName   = $displayData['emailName'];
  $emailAddy   = $displayData['emailAddy'];
  $remove      = $displayData['remove'];
  //echo "<br>".$msgnum . ': '  . $rule_no . ' | '  . $rule_cat . ' | '  . $bounce_type . ' | '  . $remove . ' | ' . $email . ' | '  . $subject . ' | ';
  //echo 'Custom Header: '  . $cheader . " | ";
  //echo 'Bounce Message: '  . $rule_msg . " | ";
  return true;
} 
```

我的输出

```
Connected to: mail.chasqui.market (bounce@chasqui.market)
Total: 271 messages 
Running in disable_delete mode, not deleting messages from mailbox

kty2001us@starmedia.com

...

entv@nuevoface.com

Closing mailbox, and purging messages
Read: 271 messages
0 action taken
271 no action taken
0 messages deleted
0 messages moved 
```

* * *

## 回答 #14

> 赞同：-1
> 
> 时间：2010-06-04T12:59:39.987

你应该看看 SwiftMailer。它完全用 PHP 编写，并且支持“退回”电子邮件。 [http://swiftmailer.org/](http://swiftmailer.org/)****

# .net - 忽略 NAnt 警告

> ID：1011717
> 
> 赞同：0
> 
> 时间：2009-06-18T09:26:25.953
> 
> 标签：.net, nant

我正在使用 NAnt（和 CruiseControl.NET）设置构建服务器，并且我目前正在为应用程序中的所有程序集（均在 VB.NET/C# 中）编写构建文件。
不幸的是，当编译大多数项目时，NAnt 发出了几个警告，这些警告会停止构建过程。因为我知道这些警告几乎是不切实际的（这个警告的绝大多数来自代码，如

```
If object Is Nothing 
```

它会生成一个警告，如“*运行时可能会导致**空引用异常”， **emphasys***是我的，当然）我想让 NAnt 只显示它们而不停止构建过程。
提前感谢任何会提供帮助的人

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-18T19:43:03.800

如果您使用 exec 任务执行 devenv.exe 将其更改为执行 devenv.com，这应该将警告打印到标准输出（我认为它是标准输出，可能是标准错误），但警告不应停止构建。

此外，请确保您的 Visual Studio 项目设置不会将警告视为错误。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-19T10:07:17.940

CSC 和 MsBuild 具有指定将警告视为错误的参数 - 您应该检查这些参数是否设置为 false：

```
<property name="build.warnaserrors" value="false" /> 
```

构建

```
<exec program="path/to/MSBuild.exe" workingdir="path/to/dir">
    <arg value="/p:TreatWarningsAsErrors=${build.warnaserrors}" />
    ....other args
</exec> 
```

CSC

```
<csc warnaserror="${warnaserrors}"
    ...other args
></csc> 
```

# excel - 比赛随机参赛抽奖脚本

> ID：1011721
> 
> 赞同：0
> 
> 时间：2009-06-18T09:26:59.870
> 
> 标签：excel

你能告诉我一个随机抽取获胜者的最佳脚本/程序吗？

这些都是比赛的参赛者，需要随机选择一名获胜者。

Excel 工作表中的数据。我想针对excel运行脚本。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-18T10:53:12.083

以下假设您的参赛者名单在名为“参赛者”的范围内。自然，关于系统生成的随机数不完全是随机的通常警告适用 - 对于本地/小规模的有趣比赛应该没问题，可能不是国家彩票的解决方案。

```
Sub PickWinner()
    Dim winner As String

    winner = Range("Entrants").Cells(Int(Rnd() * (Range("Entrants").Count) + 1), 1)

    Debug.Print winner
End Sub 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-18T09:43:40.663

然后另存为 CSV

在蟒蛇中：

```
import random
fd = open(csv_file)
lines = fd.readlines()
line_num = random.randrange(0,len(lines)-1)
print 'winner: ', lines[line_num] 
```

# php - PHP If 语句问题

> ID：1011723
> 
> 赞同：1
> 
> 时间：2009-06-18T09:27:15.483
> 
> 标签：php

对于下面的代码，我正在尝试使用 IF 语句

> 如果（mysql_num_rows（$resA）>0）

如果 $entry 不在我的数据库中任何表的“站点”列中，则避免运行 foreach 循环。但是，如果数据库中任何表的“站点”列中不存在 $entry，我会收到错误消息“警告：为 foreach() 提供的参数无效”。知道为什么要这样做吗？

提前致谢，

约翰

```
$result = mysql_query("SHOW TABLES FROM feather") 
or die(mysql_error()); 

while(list($table)= mysql_fetch_row($result))
{
  $sqlA = "SELECT COUNT(*) FROM `$table` WHERE `site` LIKE '$entry'";

  $resA = mysql_query($sqlA) or die("$sqlA:".mysql_error());
  list($isThere) = mysql_fetch_row($resA);
  $isThere = intval($isThere);
  if ($isThere)
  {
     $table_list[] = $table;
  }

}

if(mysql_num_rows($resA)>0){
foreach ($table_list as $table) { 
    $sql = "SELECT votes_up FROM `$table` WHERE `site` LIKE '$entry'"; 
    $sql1 = mysql_query($sql) or die("$sql:".mysql_error());
   while ($row = mysql_fetch_assoc($sql1)) {
       $votes[$table] = $row['votes_up'];
       $sum += $row['votes_up'];
   } 

}
}
else{
print "";
} 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-06-18T09:35:20.243

初始化变量是个好主意：

```
$table_list = array(); // <-- Initialize variable.
while (list($table) = mysql_fetch_row($result)) {
    /* ... */
    $table_list[] = $table;
    /* ... */
}

if (mysql_num_rows($resA) > 0) {
    foreach ($table_list as $table) { 
        /* ... */
    }
} 
```

您收到错误是因为没有添加任何条目，`$table_list`这意味着当您运行`foreach`循环时该变量将不存在。首先初始化它以避免这种混淆。

没有添加条目的原因`$table_list`是所有获取的表的计数为零。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-18T16:46:32.080

初始化变量很好，尽管您也可以在进入 foreach 循环之前检查数组：

```
if (is_array($table_list))
foreach ($table_list as $table) {
  ...
} 
```

在任何可以传递非数组的 foreach 循环之前检查这一点是明智的。PHP 严格要求 foreach 中的数组（而在许多其他地方却相当松懈）。我一直认为将其他任何东西（例如字符串）视为空数组会更好，因此根本不循环。

# gcc - 如何在 cygwin 上安装 gcc-4.4？

> ID：1011728
> 
> 赞同：4
> 
> 时间：2009-06-18T09:29:06.637
> 
> 标签：gcc, cygwin

我已经在 Windows 上安装了[cygwin](http://www.cygwin.com/setup.exe)环境。有 gcc 4.3。如何在这种环境下安装 gcc 4.4？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-18T09:37:07.227

另一种方法是自己构建一个，但在 cygwin 上会非常慢。如果您是 Linux 用户，您可以在 Linux 上构建*本机*编译器（在 Windows 上运行在 cmd.exe 中，并生成本机 win32 二进制文件）。它要快得多（根据我的经验，要快一个数量级）。

否则，mingw 是一个很好的解决方案，尽管根据我的经验，来自[equation.com 的二进制文件更](ftp://ftp.equation.com/gcc/gcc-4.4.0-32.exe)适合 gcc 4.4（MinGW 还没有官方的 gcc 4.4）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-18T09:32:17.567

如果您出于特殊原因不需要 cygwin 环境，我会选择带有 gcc 4.4 的 Mingw。您可以在以下位置找到构建：[http](http://www.tdragon.net/recentgcc/) ://www.tdragon.net/recentgcc/ 。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-12-17T16:33:00.093

阅读[MinGW 常见问题解答](http://mingw.org/wiki/FAQ)，揭示了它可以传递使用 MinGW 二进制文件而不是 Cygwin 附带的二进制文件的请求。

> 对于那些想使用 Cygwin 环境进行开发，但生成不依赖于 Cygwin 的可执行文件的人来说，确实存在一个更简单的“-mno-cygwin”选项。只需将 Cygwin 和 MinGW 发行版安装在单独的目录中（即“C:\CYGWIN”和“C:\MINGW”），并确保 MinGW 安装下的“/bin”子目录位于 Cygwin 的“/bin”子目录之前您的 PATH 环境变量（即“PATH=%PATH%;C:\MINGW\BIN;C:\CYGWIN\BIN”）。这将允许您访问所需的所有 UNIX 工具，同时确保使用的 GCC 实例是 MinGW 版本。%%%
> 
> 请记住，在“/etc/profile”文件中，Cygwin 默认将“/usr/local/bin”、“/usr/bin”和“/bin”放在系统级 PATH 之前。因此，在 Windows 路径中将 MinGW 的“/bin”放在 Cygwin 之前是不够的……它还必须设置为 Cygwin 环境中的第一位（通过修改“/etc/profile”或手动设置） ）。

# exception - Log4net：只为异常记录上下文

> ID：1011730
> 
> 赞同：2
> 
> 时间：2009-06-18T09:29:41.550
> 
> 标签：exception, logging, log4net

我正在寻找一种方法来收集一组仅用于调试的数据。即，仅当我记录异常时才应记录数据。当我得到一个异常参数时`ILog.Error`，`Fatal`或者`Debug`我想记录额外的信息。当记录有异常的其他数据时，不应记录额外的信息。

我计划使用 GlobalContext 或 ThreadContext 来构建数据集。

我的想法是连接到 Log4Net 并附加到我想像的事件，以更改消息模式以包含上下文，但我找不到任何可以帮助我的事件。也许有更简单的方法？

你觉得这个整体设计怎么样？我是在正确的轨道上还是我错过了什么？

如果这种方式很好，我该如何实施？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-19T12:22:10.490

钩住和改变模式感觉不太对劲。我建议看一下过滤器的东西。因此，您将设置使用 MessagesWithExceptionOnly 过滤器的“ForMessagesWithExceptionsOnly”附加程序。这个附加程序当然只会处理包含异常的消息。

要实现 MessagesWithExceptionOnly 过滤器，请查看[FilterSkeleton](http://logging.apache.org/log4net/release/sdk/log4net.Filter.FilterSkeleton.html)。

# c# - 遍历字母表 - C# a-caz

> ID：1011732
> 
> 赞同：18
> 
> 时间：2009-06-18T09:29:59.193
> 
> 标签：c#, count, loops, iteration, alphabet

我有一个关于遍历字母表的问题。我想要一个以“a”开头并以“z”结尾的循环。之后，循环开始“aa”并计数到“az”。之后从“ba”开始到“bz”等等......

有人知道一些解决方案吗？

## 谢谢

编辑：我忘了我给函数一个字符“a”然后函数必须返回b。如果你给“bnc”那么函数必须返回“bnd”

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2009-06-18T09:45:58.193

**第一次努力，只有 az 然后 aa-zz**

```
public static IEnumerable<string> GetExcelColumns()
{
    for (char c = 'a'; c <= 'z'; c++)
    {
        yield return c.ToString();
    }
    char[] chars = new char[2];
    for (char high = 'a'; high <= 'z'; high++)
    {
        chars[0] = high;
        for (char low = 'a'; low <= 'z'; low++)
        {
            chars[1] = low;
            yield return new string(chars);
        }
    }
} 
```

请注意，这将在“zz”处停止。当然，就循环而言，这里有一些丑陋的重复。幸运的是，这很容易解决 - 它也可以更加灵活：

**第二次尝试：更灵活的字母表**

```
private const string Alphabet = "abcdefghijklmnopqrstuvwxyz";

public static IEnumerable<string> GetExcelColumns()
{
    return GetExcelColumns(Alphabet);
}

public static IEnumerable<string> GetExcelColumns(string alphabet)
{
    foreach(char c in alphabet)
    {
        yield return c.ToString();
    }
    char[] chars = new char[2];
    foreach(char high in alphabet)
    {
        chars[0] = high;
        foreach(char low in alphabet)
        {
            chars[1] = low;
            yield return new string(chars);
        }
    }
} 
```

现在，如果您只想生成 a, b, c, d, aa, ab, ac, ad, ba, ... 您可以调用`GetExcelColumns("abcd")`.

**第三次尝试（进一步修订） - 无限序列**

```
public static IEnumerable<string> GetExcelColumns(string alphabet)
{
    int length = 0;
    char[] chars = null;
    int[] indexes = null;
    while (true)
    {
        int position = length-1;
        // Try to increment the least significant
        // value.
        while (position >= 0)
        {
            indexes[position]++;
            if (indexes[position] == alphabet.Length)
            {
                for (int i=position; i < length; i++)
                {
                    indexes[i] = 0;
                    chars[i] = alphabet[0];
                }
                position--;
            }
            else
            {
                chars[position] = alphabet[indexes[position]];
                break;
            }
        }
        // If we got all the way to the start of the array,
        // we need an extra value
        if (position == -1)
        {
            length++; 
            chars = new char[length];
            indexes = new int[length];
            for (int i=0; i < length; i++)
            {
                chars[i] = alphabet[0];
            }
        }
        yield return new string(chars);
    }
} 
```

使用递归可能会是更简洁的代码，但效率不会那么高。

请注意，如果您想在某个点停止，您可以使用 LINQ：

```
var query = GetExcelColumns().TakeWhile(x => x != "zzz"); 
```

**“重新启动”迭代器**

要从给定点重新启动迭代器，您确实可以`SkipWhile`按照软件绝地的建议使用。当然，这是相当低效的。如果您能够在调用之间保持任何状态，则可以只保留迭代器（对于任一解决方案）：

```
using (IEnumerator<string> iterator = GetExcelColumns())
{
    iterator.MoveNext();
    string firstAttempt = iterator.Current;

    if (someCondition)
    {
        iterator.MoveNext();
        string secondAttempt = iterator.Current;
        // etc
    }
} 
```

或者，您很可能能够构造您的代码以使用 a `foreach`，只需突破您实际可以使用的第一个值。

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2009-06-18T10:12:39.153

*编辑：让它完全按照 OP 的最新编辑想要的那样做*

这是最简单的解决方案，并经过测试：

```
static void Main(string[] args)
{
    Console.WriteLine(GetNextBase26("a"));
    Console.WriteLine(GetNextBase26("bnc"));
}

private static string GetNextBase26(string a)
{
    return Base26Sequence().SkipWhile(x => x != a).Skip(1).First();
}

private static IEnumerable<string> Base26Sequence()
{
    long i = 0L;
    while (true)
        yield return Base26Encode(i++);
}

private static char[] base26Chars = "abcdefghijklmnopqrstuvwxyz".ToCharArray();
private static string Base26Encode(Int64 value)
{
    string returnValue = null;
    do
    {
        returnValue = base26Chars[value % 26] + returnValue;
        value /= 26;
    } while (value-- != 0);
    return returnValue;
} 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-06-18T09:45:03.997

以下使用所需的字符串填充列表：

```
List<string> result = new List<string>();
for (char ch = 'a'; ch <= 'z'; ch++){
    result.Add (ch.ToString());
}

for (char i = 'a'; i <= 'z'; i++)
{
    for (char j = 'a'; j <= 'z'; j++)
    {
        result.Add (i.ToString() + j.ToString());
    }
} 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-06-18T14:06:01.553

我知道这里有很多答案，一个已经被接受了，但是 IMO 他们都让它变得比需要的更难。我认为以下更简单，更干净：

```
static string NextColumn(string column){
    char[] c = column.ToCharArray();
    for(int i = c.Length - 1; i >= 0; i--){
        if(char.ToUpper(c[i]++) < 'Z')
            break;
        c[i] -= (char)26;
        if(i == 0)
            return "A" + new string(c);
    }
    return new string(c);
} 
```

请注意，这不会进行任何输入验证。如果您不信任您的调用者，您应该`IsNullOrEmpty`在开头添加一个检查，并`c[i] >= 'A' && c[i] <= 'Z' || c[i] >= 'a' && c[i] <= 'z'`在循环顶部添加一个检查。或者就让它成为[GIGO](http://en.wikipedia.org/wiki/Garbage_In,_Garbage_Out)吧。

您可能还会发现这些伴随功能的用途：

```
static string GetColumnName(int index){
    StringBuilder txt = new StringBuilder();
    txt.Append((char)('A' + index % 26));
    //txt.Append((char)('A' + --index % 26));
    while((index /= 26) > 0)
        txt.Insert(0, (char)('A' + --index % 26));
    return txt.ToString();
}
static int GetColumnIndex(string name){
    int rtn = 0;
    foreach(char c in name)
        rtn = rtn * 26 + (char.ToUpper(c) - '@');
    return rtn - 1;
    //return rtn;
} 
```

这两个函数都是从零开始的。也就是说，"A" = 0、"Z" = 25、"AA" = 26 等。要使它们从一开始（如 Excel 的 COM 接口），请删除每个函数中注释行上方的行，并取消注释那些线。

与`NextColumn`函数一样，这些函数不会验证它们的输入。如果这就是他们得到的，两者都会给你垃圾。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2011-01-21T09:59:03.087

这就是我想出的。

```
/// <summary>
/// Return an incremented alphabtical string
/// </summary>
/// <param name="letter">The string to be incremented</param>
/// <returns>the incremented string</returns>
public static string NextLetter(string letter)
{
  const string alphabet = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
  if (!string.IsNullOrEmpty(letter))
  {
    char lastLetterInString = letter[letter.Length - 1];

    // if the last letter in the string is the last letter of the alphabet
    if (alphabet.IndexOf(lastLetterInString) == alphabet.Length - 1) 
    {
        //replace the last letter in the string with the first leter of the alphbat and get the next letter for the rest of the string
        return NextLetter(letter.Substring(0, letter.Length - 1)) + alphabet[0];
    }
    else 
    {
      // replace the last letter in the string with the proceeding letter of the alphabet
      return letter.Remove(letter.Length-1).Insert(letter.Length-1, (alphabet[alphabet.IndexOf(letter[letter.Length-1])+1]).ToString() );
    }
  }
  //return the first letter of the alphabet
  return alphabet[0].ToString();
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-03-24T23:25:16.600

只是好奇，为什么不只是

```
 private string alphRecursive(int c) {
         var alphabet = "abcdefghijklmnopqrstuvwxyz".ToCharArray();
         if (c >= alphabet.Length) {
             return alphRecursive(c/alphabet.Length) + alphabet[c%alphabet.Length];
         } else {
             return "" + alphabet[c%alphabet.Length];
         }
    } 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-06-18T09:44:33.953

这就像显示一个 int，只使用基数 26 而不是基数 10。尝试以下算法来查找数组的第 n 个条目

```
q = n div 26;
r = n mod 26;
s = '';
while (q > 0 || r > 0) {
  s = alphabet[r] + s;
  q = q div 26;
  r = q mod 26;
} 
```

当然，如果您想要前 n 个条目，这不是最有效的解决方案。在这种情况下，请尝试类似丹尼尔的解决方案。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-06-18T11:13:25.660

我试了一下，想出了这个：

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;

namespace Alphabetty
{
    class Program
    {
        const string alphabet = "abcdefghijklmnopqrstuvwxyz";
        static int cursor = 0;
        static int prefixCursor;
        static string prefix = string.Empty;
        static bool done = false;
        static void Main(string[] args)
        {
            string s = string.Empty;
            while (s != "Done")
            {
                s = GetNextString();
                Console.WriteLine(s);
            }
            Console.ReadKey();

        }        
        static string GetNextString()
        {
            if (done) return "Done";
            char? nextLetter = GetNextLetter(ref cursor);
            if (nextLetter == null)
            {
                char? nextPrefixLetter = GetNextLetter(ref prefixCursor);
                if(nextPrefixLetter == null)
                {
                    done = true;
                    return "Done";
                }
                prefix = nextPrefixLetter.Value.ToString();
                nextLetter = GetNextLetter(ref cursor);
            }

            return prefix + nextLetter;
        }

        static char? GetNextLetter(ref int letterCursor)
        {
            if (letterCursor == alphabet.Length)
            {
                letterCursor = 0;
                return null;
            }

            char c = alphabet[letterCursor];
            letterCursor++;
            return c;
        }
    }
} 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2017-08-03T15:37:41.547

这是我做的可能类似的东西。我正在试验迭代计数，以便设计一个尽可能小的编号模式，但给了我足够的独特性。

我知道每次添加一个 Alpha 字符时，它都会增加 26 倍的可能性，但我不确定我想使用多少个字母、数字或模式。

这让我看到了下面的代码。基本上，您将一个 AlphaNumber 字符串传递给它，每个有字母的位置最终都会增加到“z\Z”，每个有数字的位置最终都会增加到“9”。

所以你可以称它为两种方式之一。

```
//This would give you the next Itteration... (H3reIsaStup4dExamplf)
string myNextValue = IncrementAlphaNumericValue("H3reIsaStup4dExample") 

//Or Loop it resulting eventually as "Z9zzZzzZzzz9zZzzzzzz"
string myNextValue = "H3reIsaStup4dExample"
while (myNextValue != null)
{
   myNextValue = IncrementAlphaNumericValue(myNextValue)
   //And of course do something with this like write it out
} 
```

（对我来说，我正在做类似“1AA000”的事情）

```
public string IncrementAlphaNumericValue(string Value)
    {
        //We only allow Characters a-b, A-Z, 0-9
        if (System.Text.RegularExpressions.Regex.IsMatch(Value, "^[a-zA-Z0-9]+$") == false)
        {
            throw new Exception("Invalid Character: Must be a-Z or 0-9");
        }

        //We work with each Character so it's best to convert the string to a char array for incrementing
        char[] myCharacterArray = Value.ToCharArray();

        //So what we do here is step backwards through the Characters and increment the first one we can. 
        for (Int32 myCharIndex = myCharacterArray.Length - 1; myCharIndex >= 0; myCharIndex--)
        {
            //Converts the Character to it's ASCII value
            Int32 myCharValue = Convert.ToInt32(myCharacterArray[myCharIndex]);

            //We only Increment this Character Position, if it is not already at it's Max value (Z = 90, z = 122, 57 = 9)
            if (myCharValue != 57 && myCharValue != 90 && myCharValue != 122)
            {
                myCharacterArray[myCharIndex]++;

                //Now that we have Incremented the Character, we "reset" all the values to the right of it
                for (Int32 myResetIndex = myCharIndex + 1; myResetIndex < myCharacterArray.Length; myResetIndex++)
                {
                    myCharValue = Convert.ToInt32(myCharacterArray[myResetIndex]);
                    if (myCharValue >= 65 && myCharValue <= 90)
                    {
                        myCharacterArray[myResetIndex] = 'A';
                    }
                    else if (myCharValue >= 97 && myCharValue <= 122)
                    {
                        myCharacterArray[myResetIndex] = 'a';
                    }
                    else if (myCharValue >= 48 && myCharValue <= 57)
                    {
                        myCharacterArray[myResetIndex] = '0';
                    }
                }

                //Now we just return an new Value
                return new string(myCharacterArray);
            } 
        }

        //If we got through the Character Loop and were not able to increment anything, we retun a NULL. 
        return null;  
    } 
```

* * *

## 回答 #10

> 赞同：-2
> 
> 时间：2009-06-18T10:05:22.820

这是我使用递归的尝试：

```
public static void PrintAlphabet(string alphabet, string prefix)
{
    for (int i = 0; i < alphabet.Length; i++) {
        Console.WriteLine(prefix + alphabet[i].ToString());
    }

    if (prefix.Length < alphabet.Length - 1) {
        for (int i = 0; i < alphabet.Length; i++) {
            PrintAlphabet(alphabet, prefix + alphabet[i]);
        }
    }
} 
```

然后只需调用`PrintAlphabet("abcd", "")`;

# c# - Web 用户控件自引用（高级）

> ID：1011734
> 
> 赞同：1
> 
> 时间：2009-06-18T09:30:21.983
> 
> 标签：c#, asp.net

我有点卡住了。

我创建了一个呈现问题的 Web 用户控件（我有一个问题域对象）。此 Web 用户控件应为当前问题的所有子问题再次呈现自身。

目前我正在将带有 LoadControl 的子问题加载到父控件中。它工作正常，子问题控件不保持视图状态。它们也不会触发任何适当的回发。

在自身内部再次加载 Web 用户控件以便正确保留视图状态的最佳方法是什么？

我正在使用 VS2005 和 ASP.NET 2.0

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-18T13:04:36.873

我猜你有时间问题。您可能在 asp.net 页面生命周期中加载您的子控件为时已晚，无法将它们加载到视图状态。如果你在 Load 上加载你的控件，我几乎可以肯定是这样。尝试更早地加载您的控件，也许是 OnInit？

[这是页面生命周期的图表。](http://blog.krisvandermast.com/content/binary/ASP.NET-2.0-life-cycle.png)

# ruby-on-rails - 如何验证关联是否有效

> ID：1011744
> 
> 赞同：4
> 
> 时间：2009-06-18T09:33:32.553
> 
> 标签：ruby-on-rails, ruby, activerecord

我有一个名为 Profile 的模型，它是属于用户的，因此数据库需要跟踪“user_id”。在我为这个模型制作的本地管理界面中，我想提供允许管理员在编辑屏幕的字段中输入用户名的灵活性，然后将其解析为 user_id 以保存在控制器中。

然而问题是，我如何检查用户名是否有有效的回报？我发现在 ActiveRecord::Validation 中没有验证关联存在的方法。你将如何处理这样的情况？

更新：我要做的是验证表单中的用户名字段确实是真实用户，然后我可以将该 user_id 保存回管理员正在编辑的配置文件。这里的“return”表示返回的用户对象。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-06-18T11:14:55.067

这个问题是虚拟属性的一个很好的候选。与其尝试解析用户名，不如让配置文件模型为您工作。

```
class Profile

  belongs_to :user

  # ...

  def username
    user.try(:username)
  end

  def username=(value)
    self.user = User.find_by_username(value)
  end

end 
```

然后以你的形式

```
<% form_for @profile do |f| %>

  <%= f.text_field :username %>

<% end %> 
```

提交时，用户名字段的值会自动与所有其他真实的活动记录属性一起传递。ActiveRecord 将查找 username= setter 并解析关联。如果关联返回 nil（给定用户名不存在记录），则它将当前 user_id 设置为 nil，并且验证将按预期失败。

您可能希望自定义错误代码以使其更有意义。

编辑：添加示例。

```
validate :ensure_username_exists 

def username=(value) 
  self.user_id = User.find_by_username(value) || 0 
end 

protected 

  def ensure_username_exists 
    if user_id == 0 # nil is allowed 
      errors.add(:user_id, "Username doesn't exists") 
      return false 
    end
  end 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-18T09:57:31.260

这是 Active Record 关联的有用参考：http: [//guides.rubyonrails.org/association_basics.html](http://guides.rubyonrails.org/association_basics.html)

要检查关联是否存在，只需检查*关联*.nil?

```
if @profile.user.nil?
  ... something ...
end 
```

要检查用户名是否有有效的回报，我不太清楚你的意思。你能详细谈谈？

# wpf - 使用 MVVM 处理 SelectedItem 事件的最简单方法是什么？

> ID：1011750
> 
> 赞同：10
> 
> 时间：2009-06-18T09:34:51.663
> 
> 标签：wpf, mvvm, selecteditem

在下面的代码中，**当用户**在组合框中选择客户时，**客户的姓名会显示**在文本框中。我用 ViewModel 上的 ObservableCollection 属性填充 Combox 框，但是如何处理 ViewModel 中的 SelectedItem 事件？

使用代码隐藏很容易实现这一点，如下所示，但是**如何使用 MVVM 模式来实现呢？**

我目前在我可以使用的基本 MVVM 模板中有**DelegateCommand**和**AttachedBehaviors ，但我不知道如何让它们在“组合框选择新项目”时触发。**

**看法：**

```
<Window.Resources>
    <DataTemplate x:Key="CustomerTemplate">
        <StackPanel Orientation="Horizontal">
            <TextBlock Text="{Binding LastName}"/>
        </StackPanel>
    </DataTemplate>
</Window.Resources>

<DockPanel LastChildFill="False" Margin="10">
    <ComboBox 
        x:Name="CustomerList"
        ItemTemplate="{StaticResource CustomerTemplate}"
        HorizontalAlignment="Left"
        DockPanel.Dock="Top" 
        Width="200"
        SelectionChanged="CustomerSelected"
        ItemsSource="{Binding Customers}"/>

    <TextBlock x:Name="CurrentlySelectedCustomer"/>
</DockPanel> 
```

**代码背后：**

```
private void CustomerSelected(object sender, System.Windows.Controls.SelectionChangedEventArgs e)
{
    Customer customer = (Customer)CustomerList.SelectedItem;
    CurrentlySelectedCustomer.Text = String.Format("{0} {1}", customer.FirstName, customer.LastName);
} 
```

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-06-18T09:38:00.970

您应该能够将 ViewModel 中的属性绑定到组合框的 SelectedItem 属性。如果您将其设置为双向绑定，您将在 SelectedItem 更改时收到通知，因为它将触发属性上的 set 方法。

视图模型：

```
public ObservableCollection Customers
{
   get { return _customers; }
   set
   {
       if (_customers != value)
       {
           _customers = value;
           OnPropertyChanged("Customers");
       }
   }
}

public Customer SelectedCustomer
{
   get { return _selectedCustomer; }
   set
   {
       if (_selectedCustomer != value)
       {
           _selectedCustomer= value;
           LastName= value.LastName;
           OnPropertyChanged("SelectedCustomer");
       }
   }
}

public Customer LastName
{
   get { return _lastName; }
   set
   {
       if (_lastName!= value)
       {
           _lastName= value;
           OnPropertyChanged("LastName");
       }
   }
} 
```

xml:

```
<DockPanel LastChildFill="False" Margin="10">
    <ComboBox 
        x:Name="CustomerList"
        ItemTemplate="{StaticResource CustomerTemplate}"
        HorizontalAlignment="Left"
        DockPanel.Dock="Top" 
        Width="200"
        SelectedItem="{Binding SelectedCustomer, Mode=TwoWay}"
        ItemsSource="{Binding Customers}"/>

    <TextBlock x:Name="CurrentlySelectedCustomer"
               Text="{Binding LastName}"/>
</DockPanel> 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-06-18T09:38:56.430

在 www.codeproject.com 上查看[此应用程序。](http://www.codeproject.com/KB/WPF/WPFPhotoBooth.aspx)这里我使用CollectionView来检测当前选中的item

**更新**

使用 CollectionView 检测当前选中的项目

```
ListCollectionView view = (ListCollectionView)CollectionViewSource.GetDefaultView(Customers); 
view.CurrentChanged += delegate 
{ 
    SelectedCustomer= (Customer)view.CurrentItem; 
}; 
```

请记住还要设置 IsSynchronizedWithCurrentItem="True"

# hardware - “安腾惨败”背后的技术原因是什么？

> ID：1011760
> 
> 赞同：28
> 
> 时间：2009-06-18T09:36:38.757
> 
> 标签：hardware, itanium

在[这篇文章中](http://www.pcmag.com/article2/0,2817,2339629,00.asp)， Jonh Dvorak 称安腾是“*过去 50 年的重大惨败之一*”。虽然他描述了这个想法的过度乐观的市场预期和戏剧性的财务结果，但他没有深入探讨这个史诗般失败的技术细节。我有机会与 Itanium 合作了一段时间，我个人很喜欢它的架构，与现代 x86 处理器架构相比，它是如此清晰、简单和直接......

那么，它失败的技术原因是什么？表现不佳？与 x86 代码不兼容？编译器的复杂性？这艘“伊坦尼克号”为何沉没？

![安腾处理器块](../Images/d5544b0f6c35169f1fe8d522d03713a9.png)

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2012-12-11T17:15:34.833

Itanium 失败了，因为用于当今工作负载的 VLIW 简直是一个糟糕的主意。

Donald Knuth 是一位广受尊敬的计算机科学家，[他在 2008 年的一次采访](http://www.informit.com/articles/article.aspx?p=1193856)中说，“ *‘Itanium’方法本应如此出色——直到结果证明，所希望的编译器基本上是不可能编写的。* ” ¹

这几乎可以解决问题。

对于科学计算，每个基本块至少有几十条指令，VLIW 可能工作正常。那里有足够的说明来创建好的捆绑包。对于更现代的工作负载，通常每个基本块大约有 6 到 7 条指令，它根本不会（这是 SPEC2000 的平均值，IIRC）。编译器根本找不到独立的指令来放入包中。

现代 x86 处理器，除了 Intel Atom（前 Silvermont）和我相信 AMD E-3**/4** 之外，都是无序处理器。它们维护一个大约 100 条指令的动态指令窗口，并且在该窗口内，只要输入准备就绪，它们就会执行指令。如果多条指令准备好执行并且它们不竞争资源，它们会在同一个周期中一起执行。

那么这与 VLIW 有什么不同呢？VLIW 和乱序的第一个关键区别是乱序处理器可以从不同的基本块中选择指令同时执行。无论如何，这些指令都是以推测方式执行的（主要基于分支预测）。第二个关键区别是乱序处理器动态确定这些调度（即，每条动态指令都是独立调度的；VLIW 编译器对静态指令进行操作）。

第三个关键区别是乱序处理器的实现可以任意宽，而无需更改指令集（英特尔酷睿有 5 个执行端口，其他处理器有 4 个，等等）。VLIW 机器*可以*并且确实一次执行多个包（如果它们不冲突）。例如，[早期的 Itanium CPU 每个时钟周期最多执行 2 个 VLIW 包，6 条指令](https://www.realworldtech.com/ev8-mckinley/5/)，后来的设计（[2011 年的 Poulson 及以后](https://www.realworldtech.com/poulson-preview/)) 最多运行 4 个捆绑包 = 每个时钟 12 条指令，使用 SMT 从多个线程获取这些指令。在这方面，真正的 Itanium 硬件就像传统的有序超标量设计（如 P5 Pentium 或 Atom），但编译器有更多/更好的方式向硬件公开指令级并行性（理论上，如果它可以找到够了，这就是问题）。

在性能方面，具有类似规格（缓存、内核等），它们只是击败了安腾。

那么为什么现在要购买安腾呢？嗯，唯一的原因确实是 HP-UX。如果你想运行 HP-UX，那就是这样做的方法......

许多编译器编写者不这么看——他们总是喜欢 Itanium 让他们有更多工作要做，让他们重新控制，等等。但他们不会承认它失败得多么悲惨。

* * *

脚注1：

这是对多核处理器价值的回应的一部分。Knuth 说并行处理很难利用。在 VLIW 的编译时发现和公开细粒度指令级并行性（以及显式推测：EPIC）也是一个难题，并且在某种程度上与找到粗粒度并行性以将顺序程序或函数拆分为多个线程以自动充分利用多核。

11 年后他仍然基本上是对的：对于大多数非服务器软件来说，每线程性能仍然非常重要，而且 CPU 供应商专注于这一点，因为许多内核是无可替代的。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-06-18T09:49:22.040

简单的。它不兼容 x86。这就是 x86_64 芯片的原因。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2011-04-19T23:02:02.807

Itanium 的设计基于非常宽的指令级并行性的理念，以在由于热限制而施加时钟频率限制时扩展处理器的性能。

但是 AMD Opteron 通过 PROLIFERATING x86_64 内核来实现可扩展的性能并与 32 位 x86 二进制文件兼容，从而破坏了安腾的采用。

对于类似的处理器数量，Itanium 服务器比 x86 贵 10 倍。

所有这些因素都减缓了主流市场对安腾服务器的采用。Itanium 现在的主要市场是任务关键型企业计算，这是一个每年 10B 美元以上的良好市场，仅由 HP、IBM 和 Sun 主导。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-06-18T09:46:38.970

编写代码生成器非常困难；而且它一开始并没有太多成功的理由（它是由英特尔制造的，那又怎样？）。

我听说一些 JIT 的性能比 Itanium 上的解释器更差，因为 gcc 更好地优化了解释器；如果处理器需要*这种*级别的优化，那就不行了。

非主流 RISC 正在失势；他们没有看到或希望它会成为主流。太糟糕了，它不会因为没有任何理由。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-09-05T00:09:23.363

我读了那篇文章，我完全错过了他所指的“惨败”。正如他在接近尾声时提到的那样，一看到安腾，“一个又一个有希望的项目被放弃了”。MIPS、Alpha、PA-RISC——消失了。Sun 已经取消了他们最后两个大型 Sparc 项目，尽管在这之前它并不是一个大卖家。PowerPC 只存在于嵌入式领域。

英特尔是如何用一条产品线杀死所有竞争对手的，除了有史以来最伟大的微处理器胜利之外还有什么？我敢肯定他们不够聪明，无法预料到这一点，但*即使他们知道这会失败*，假装投入几十亿美元也很有效。显然他们负担得起，其他人都死了。

在台式机、服务器机房，甚至在超级计算机（前 500 强名单中的 87%）中，就肉眼所见而言，它都与 x86 兼容。如果这是英特尔“惨败”的结果，那么*没有成功*的处理器还能说什么呢？

在我的书中，英特尔和安腾与微软和 MS-DOS 并驾齐驱：尽管它在技术上可能很糟糕，但它使它们能够完全主导这个行业。

编辑：安腾从第一天起就具有 x86 兼容性，所以不是这样。它很慢，但它就在那里。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-09-04T23:34:10.020

我认为安腾仍然有它的市场——高端系统和惠普刀片服务器。与 x86 相比，性能仍然高得多。我不确定当它为惠普创造数十亿美元时，为什么有人会称它为失败（尽管它不仅仅是处理器；它是产生收入的安腾服务器销售）。

# web-services - 带有 JRuby 嵌入式码头的 Servlet 和静态内容

> ID：1011771
> 
> 赞同：1
> 
> 时间：2009-06-18T09:38:30.547
> 
> 标签：web-services, servlets, jetty, jruby

我想使用 JRuby 中嵌入的码头来提供 servlet 和静态内容。我试过这个：

```
server = Server.new(8080)
context = Context.new(server, '/', 0)

context_static = Context.new(server, '/static', 0)
context_static.setHandler(ResourceHandler.new)
context_static.setResourceBase('./')
context_static.setContextPath('/static')

servlet = Servlet.new()
holder = ServletHolder.new(servlet)
context.addServlet(holder, '/')
server.start() 
```

问题是[http://localhost:8080/static](http://localhost:8080/static)不能作为 exepecte 工作，而且还显示 servlet 创建的内容而不是静态内容。

关于 servlet：我首先使用 javax.servlet.http.HttpServlet，但后来切换到 org.mortbay.jetty.servlet.DefaultServlet，因为它似乎使并行服务成为可能。对于解决此问题的任何提示，我将不胜感激。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-18T10:15:12.283

尝试`context_static`在之前进行初始化`context`（由于构造函数采用服务器参数，我假设实例化的顺序会影响上下文的链接顺序）。（使用 Jetty 6 和 Clojure 进行了尝试。）

# jquery - 如何格式化 url：对于 CakePHP 中的 jQuery ajax() 请求，它不会在 url 中添加问号？

> ID：1011774
> 
> 赞同：2
> 
> 时间：2009-06-18T09:39:06.147
> 
> 标签：jquery, ajax, cakephp

我正在尝试使用 jQuery ajax() 调用我的“国家”控制器的“关税”操作，并将其传递给以下格式的国家名称：

```
/countries/tariff/countryname 
```

但是，使用以下代码（设置为 GET ），它会在`?`添加 get 的情况下调用它：

```
/countries/tariff/?countryname 
```

这是代码：

```
$(document).ready(function(){
    $('#CountriesIndexForm select').change(function(){          
        $.ajax({
            type: "GET",

            url: "/countries/tariff/",

            data: escape($(this).val()),

            success: function(html){

                $(this).parent().next('div').html(html);

            }
        });
    }); 
}); 
```

我理解它，因为类型设置为 GET，但是有解决办法吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-06-18T09:42:40.057

手动制作网址

```
url: "/countries/tariff/"+escape($(this).val()) 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-18T09:44:20.927

您需要将其附加到**url**参数并省略**data**，即：

```
url: "/countries/tariff/" + $(this).val(), 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-06-18T09:46:48.410

直接在url字段中传递参数，而不是使用数据

```
$(document).ready(function(){    
   $('#CountriesIndexForm select').change(function(){                          
      $.ajax({                
          type: "GET",                
             url: "/countries/tariff/" + escape($(this).val()),                
             success: function(html){                        
                  $(this).parent().next('div').html(html);                
             }        
      });    
    }); 
}); 
```

# java - 在运行时更新 Java 安全策略？

> ID：1011777
> 
> 赞同：8
> 
> 时间：2009-06-18T09:39:50.110
> 
> 标签：java, security, policy

是否有在运行时向 Java 安全策略添加/删除权限的合法方法？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-18T10:10:42.433

Javadoc 说`Policy.refresh()`对于基于文件的策略会重新读取文件。因此，可以通过编辑策略文件然后调用来在运行时修改系统范围的策略`Policy.refresh()`

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-18T11:29:11.543

It is possible to set custom Policy implementation, using `Policy.setPolicy()` method.

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-06-18T09:48:59.263

从 1.4 动态[`ProtectionDomain`](http://java.sun.com/javase/6/docs/api/java/security/ProtectionDomain.html#ProtectionDomain(java.security.CodeSource,%20java.security.PermissionCollection,%20java.lang.ClassLoader,%20java.security.Principal[]))s 可以委托给[`Policy`](http://java.sun.com/javase/6/docs/api/java/security/Policy.html#getPermissions(java.security.ProtectionDomain)). 从代码中动态删除权限不太可能有任何意义。的两种论证形式[`AccessController.doPrivileged`](http://java.sun.com/javase/6/docs/api/java/security/AccessController.html#doPrivileged(java.security.PrivilegedAction,%20java.security.AccessControlContext))也可能有用。

# php - PHP函数不返回值

> ID：1011778
> 
> 赞同：2
> 
> 时间：2009-06-18T09:40:05.380
> 
> 标签：php, recursion, function, return-value

我有一个函数，给定文件名和目录路径，检查目录是否已经包含同名的文件，如果是，则返回修改后的文件名（通过在文件名的第一部分后附加一个数字）。（get_filenames() 函数是一个 CodeIgniter 辅助函数，它创建一个包含指定目录中所有文件名的数组。）

当我尝试打印出函数调用的返回结果时，我什么也得不到；但是如果我在函数本身的 else{} 语句中打印 $new_filename ，然后只需调用该函数（而不是打印它的值），它就可以工作！

我需要返回函数中的值，而不是打印它，因为我实际上需要将结果分配给一个变量以进行进一步处理。（在下面的示例中，我刚刚打印了函数调用的结果来证明这一点。）

功能：

```
function avoid_conflicting_filenames($old_filename, $new_filename, $dir, $count)
{   
    $num = '';
    if ($count > 0):
        $num = $count;
    endif;

    $filename_arr = explode('.', $old_filename, -1);
    $new_filename = $filename_arr[0] . $num . '.' . $filename_arr[1];

    if (in_array($new_filename, get_filenames($dir))):      
        $count++;
        avoid_conflicting_filenames($old_filename, $new_filename, $dir, $count);
    else:
        return $new_filename;
    endif;
} 
```

我在哪里调用函数：

```
print avoid_conflicting_filenames('file.jpg', '', 'path/to/file', 0); 
```

在过去的一天里，这一直让我发疯，所以任何帮助将不胜感激！谢谢。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-06-18T09:43:35.717

替换这个：

```
avoid_conflicting_filenames($old_filename, $new_filename, $dir, $count); 
```

有了这个：

```
return avoid_conflicting_filenames($old_filename, $new_filename, $dir, $count); 
```

你不是在递归地考虑它。您必须返回函数的返回值。

过去，if 语法是怎么回事？我在模板中容忍它，但是对于代码？嗯。

如果我正确理解代码，您还可以重写此函数以避免递归，如下所示：

```
function avoid_conflicting_filenames($old_filename, $new_filename, $dir) {   
    $num = 0;
    $files = get_filenames($dir);
    $filename_arr = explode('.', $old_filename, -1);
    do {
        $new_filename = $filename_arr[0] . $num . '.' . $filename_arr[1];
        $num++;
    } while(in_array($new_filename, $files));
    return $new_filename;
} 
```

我认为这更好，更容易获得，但这取决于你......

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-18T09:43:47.183

将您的代码更改为：

```
function avoid_conflicting_filenames($old_filename, $new_filename, $dir, $count)
{   
    $num = '';
    if ($count > 0):
        $num = $count;
    endif;

    $filename_arr = explode('.', $old_filename, -1);
    $new_filename = $filename_arr[0] . $num . '.' . $filename_arr[1];

    if (in_array($new_filename, get_filenames($dir))):          
        $count++;
        return avoid_conflicting_filenames($old_filename, $new_filename, $dir, $count);
    else:
        return $new_filename;
    endif;
} 
```

在避免冲突文件名中调用避免冲突文件名时，您忘记了返回语句。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-18T09:45:38.037

您正在递归地运行该函数。您需要将结果传递给函数的“父”实例：

```
if (in_array($new_filename, get_filenames($dir))):          
    $count++;
    // Note "return" statement below.
    return avoid_conflicting_filenames($old_filename, $new_filename, $dir, $count);
else:
    return $new_filename;
endif; 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-18T09:46:32.013

如果第二个 if 中的第一个分支被采用，则该函数永远不会遇到 return 语句。

将其更改为：

```
if (in_array($new_filename, get_filenames($dir))):          
    $count++;
    //Added return
    return avoid_conflicting_filenames($old_filename, $new_filename, $dir, $count);
else:
    return $new_filename;
endif; 
```

# ruby-on-rails - 多个资源的单个 RSS 提要

> ID：1011779
> 
> 赞同：0
> 
> 时间：2009-06-18T09:40:10.187
> 
> 标签：ruby-on-rails, feed

我的 rails 应用程序有几个内容生成资源，如文章、博客文章等。

我可以为每个单独的资源生成 RSS，但我不知道如何为这些多个提要同步到一个 RSS 提要中。

目前我已经通过 FeedBurner 设置了文章提要，甚至 FeedBurner 也没有这种功能可以将同一应用程序的不同 RSS 合并为一个，这样我的用户就可以订阅单个 RSS（我已经完成了）或只是一个单个主提要获取所有更新。

我找不到任何插件，也找不到我的 Rails 应用程序的任何代码？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-18T11:55:09.820

[FeedStitch](http://feedstitch.com)允许您将多个提要“缝合”在一起。从 Rails 的角度来看，它并没有解决这个问题，但它完成了工作。

我建议将您的饲料放入 feedstitch，然后将 feedburner 与 feedstitch 饲料一起使用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-18T12:14:38.143

如果你想从 Rails 端解决问题，没那么复杂。创建一个新操作并获取要格式化为提要的记录并创建提要。

```
# the action
def feed
  @articles = Article.all(:limit => 10)
  @posts = Post.all(:limit => 10)
  @items = @article + @posts

  respond_to do |format|
    format.html
    format.atom
  end
end

# the view
atom_feed do |feed|
  feed.title("Latest items")
  feed.updated(@items.first.try(:created_at))

  for item in @items
    feed.entry(item) do |entry|
      entry.title(item.title)
      entry.content(item.body, :type => 'html')
    end
  end
end 
```

当然，资源必须至少对于您要在控制器中调用的方法共享相同的 API。 [http://api.rubyonrails.org/classes/ActionView/Helpers/AtomFeedHelper.html#M001900](http://api.rubyonrails.org/classes/ActionView/Helpers/AtomFeedHelper.html#M001900)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-18T13:15:47.427

如果您接受依赖外部服务，您可以使用 RSS Mix 或 Yahoo! 管道：

www.rssmix.com/

管道.yahoo.com/pipes/

# oop - 加密对象

> ID：1011782
> 
> 赞同：0
> 
> 时间：2009-06-18T09:40:28.843
> 
> 标签：oop, encryption, md5

我有一个像Employee这样的班级。这个类有一些字段，如 Id,Name,Surname, Tasks(一个字符串数组), isManager, TaskDueDates (一个日期时间数组)。我想从这个对象生成一个文本。我认为使用分隔符，这是一个基本的解决方案。例如我的文本可以是：13;George;Smith;{"Task1","Task2","Task3"},false, {this night,nextweek}

但如果对象的其中一个字段包含此分隔符；程序将无法运行。在我生成文本之后；我想通过使用一些密钥用 MD5 加密它。这将生成一些加密数据，如 asp .net viewstate 信息。程序还会将此加密数据解密到源对象。

我怎样才能做到这一点？我正在使用 Asp .Net 2005

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-18T09:43:38.120

MD5 没有加密。这是一种哈希算法。如果您从某些数据中创建 MD5，则无法从散列中创建数据。有关详细信息，请参阅[http://en.wikipedia.org/wiki/Cryptographic_hash_function 。](http://en.wikipedia.org/wiki/Cryptographic_hash_function)

对于你的问题：试试这个链接 [http://www.codeproject.com/KB/security/SimpleEncryption.aspx](http://www.codeproject.com/KB/security/SimpleEncryption.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-18T09:46:14.480

首先你不能解密 MD5，你需要一个真正的加密算法。您可能想要使用 AES256。

至于字段，Unix 一直有字段分隔文本，他们通常会在任何通常特殊的字符前面放置一个 '\'，但在这种情况下不应该（如果你想在文本，你写'\'）。你可以偷那个。

*编辑：*如果您使用的是 ASP，为什么不将输出格式化为 HTML？然后你可以把输出放在一个表中。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-18T13:57:38.950

正如答案中已经提到的，对于加密，您需要使用一些[加密算法](http://en.wikipedia.org/wiki/List_of_algorithms#Cryptography)，如 AED 或 DES。

对于序列化，即将对象转换为字符串，您可以制作自己的方案，例如`;`用作分隔符。要处理输入包含 的情况`;`，您需要转换`;`为`\;`. 您的序列化对象将如下所示：

```
Name: Geor;ge

    3;Geor\;ge;Smith;{"Task1","Task2","Task3"};false;{this night,nextweek} 
```

转换回对象时，只要在`\`之前找到`;`，您就会知道这`;`是字符串的一部分，而不是实际的分隔符。

关于使用语言序列化功能，是的，您应该能够做到这一点，但这取决于您正在使用的语言。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-18T15:58:54.643

如果您希望对象采用人类可读的格式，而不是进行手动序列化，请使用自动 XML 序列化：

```
XmlSerializer formatter;

using (FileStream file = new FileStream (Path.Combine (Application.StartupPath, GetType ().ToString () + ".xml.template"), FileMode.Create))
{
        formatter = new XmlSerializer (typeof (G));
        formatter.Serialize (file, this);
} 
```

使用 XML 序列化确保 XML 文件中所需的成员是`public`. `private`并且`protected`不会被 XML 序列化。

# c++ - 为什么 std::string.find(text,std::string:npos) 不返回 npos？

> ID：1011790
> 
> 赞同：3
> 
> 时间：2009-06-18T09:43:03.097
> 
> 标签：c++, std

我正在一个字符串中进行一系列搜索，沿着这条线的某个地方会丢失一个字符串，我的一组搜索应该会失败。

我曾预计，一旦位置达到 std::string::npos 它会留在那里，但事实并非如此。将 std::string::npos 传递给 std::string.find 似乎再次从头开始搜索

```
std::string str("frederick");
std::string::size_type pos = str.find("der",std::string::npos);
TS_ASSERT_EQUALS(pos, std::string::npos); // FAIL, 3 is returned 
```

为什么不表示字符串的结尾？

更新：目的是按顺序搜索一系列字符串，并在最后检查结果

```
pos = str.find(string1, pos)
pos = str.find(string2, pos)
pos = str.find(string3, pos)
if (pos != std:string::npos)
{ // All strings found 
```

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-06-18T10:05:43.113

查看规范，我认为您的实现中可能存在错误。

`basic_string::find`应该返回最低位置`xpos`，使得`pos <= xpos`和控制的`xpos + str.size() <= size()`所有`at(xpos + I) == str.at(I)`元素。`I``str`

`basic_string::npos`是 -1 转换为无符号类型，因此必须是该无符号类型可表示的最大数。鉴于没有其他位置`xpos`可以满足`npos`<=的第一部分`xpos`并且`find`必须`npos`在失败时返回，据我所知，这是作为第二个参数传递时`npos`唯一有效的返回值。`basic_string::find``npos`

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-06-18T10:54:30.597

比较 string::find() 和 string::copy()。（在 N2798 中，即 21.3.7.2 和 21.3.6.7，第 686/687 页）两者都采用位置参数。然而只有 string::copy 有一个“Requires: pos <= size()”子句。因此，string::find*不需要*pos <= size()。

从那时起，查尔斯·贝利就有了正确的逻辑。查看有效返回值的范围，很明显只有与 rqeuirements 匹配的返回值是 string::npos。返回的任何其他值都小于 string::npos，失败 21.3.7.2/1。

* * *

从 N2798=08-0308，版权 ISO/IEC：

21.3.7.2`basic_string::find [string::find]`

`size_type find(const basic_string<charT,traits,Allocator>& str,` `size_type pos = 0) const;`

1 效果：如果可能，确定最低位置`xpos`，使得以下两个条件都获得： -`pos <= xpos`和`xpos + str.size() <= size();` -对于由 控制的字符串`traits::eq(at(xpos+I), str.at(I))`的所有元素。2 返回：函数是否可以确定. 否则，返回。3 备注：用途。`I``str``xpos``xpos``npos``traits::eq()`

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-06-18T09:56:07.063

`std::string::npos`不是 的有效参数`std::string::find`。

标准中的定义`find`仅提及`npos`可能的返回值，而不是起始位置。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-06-18T10:53:25.640

您可能会发现在这种情况下，免费函数 std::search 更容易使用。例如

```
std::string::const_iterator iter = str.begin();

iter = std::search( iter, str.end(), string1.begin(), string1.end() );
iter = std::search( iter, str.end(), string2.begin(), string2.end() );
iter = std::search( iter, str.end(), string3.begin(), string3.end() ); 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-06-18T10:05:17.407

如果您通过，则行为未定义`npos`：

**[更新]**
STL 文档（我能找到的两个复制品，无论如何）`string::npos`仅提及作为可能的返回值，而不是作为`pos`. 后者是搜索开始的索引。

但另请参阅下面的评论（我不是 ISO 标准的专家，我根据我拥有的文档限制了我的期望）。

STL 实现通常会使用明显超出范围的值（例如 ( `(size_type)-1)`。未明确说明如何将其作为参数处理，因此我不会依赖该行为。 **[/update]**

因此，您需要从 0 开始，并`pos != npos`在每次调用后检查以查找：

```
 pos = str.find(string1, 0)
 if (pos != std:string::npos)
   pos = str.find(string2, pos)
 if (pos != std:string::npos)
   pos = str.find(string3, pos)

 if (pos != std:string::npos)
 { 
   // All strings found
 } 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-06-18T09:54:00.737

将 std::string::npos 作为第二个参数传递给 find 意味着“开始在字符串中的 std::string::npos 位置上或之后查找”。

显然这不是你想要的。

编辑：

这可能会达到您最初的预期：

```
string s;
string::size_type pos;

if ((pos = s.find(s1)) != string::npos && (pos = s.find(s2, pos)) != npos && 
    (pos = s.find(s3,pos)) != string::npos)
{
    // okay
} 
```

我还没有测试过它，但它应该可以工作，你可能更喜欢 peterchen 风格，因为它更具可读性。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-06-18T09:54:40.517

您应该将字符串的长度用作起始位置。

# python - 如何在 Windows 上准确地编写自动“点击”程序？

> ID：1011799
> 
> 赞同：0
> 
> 时间：2009-06-18T09:44:12.393
> 
> 标签：python, ruby, perl, winapi, windows

我编写了一个程序，使用 Win32 在预定时间自动单击应用程序，使用`MOUSE_DOWN`和`MOUSE_UP`. 它通常工作得很好，除了我发现我需要放入一个

```
sleep 0.1 
```

`MOUSE_DOWN`和之间`MOUSE_UP`。（使用 Ruby，它允许睡一小会儿）。

没有睡眠，有时点击不会通过。但我注意到有时，点击“太长”。点击实际上是在 Flash 应用程序的右箭头上。这个右箭头将转到列表中的下一个项目。因此，如果您`MOUSE_DOWN`再多花一点时间，它实际上会移动 2 或 3 个项目，而不仅仅是 1 个项目。

所以我想知道，在这种情况下，有没有办法准确地模拟 1 次点击。大概没有`MOUSE_CLICK`事件吧？`MOUSE_DOWN`必须使用and来模拟它`MOUSE_UP`？

（它实际上是在 Win32 上调用`MOUSEEVENTF_LEFTDOWN`的`MOUSEEVENTF_LEFTUP`，只是为了简单起见，它被声明为`MOUSE_DOWN`。）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-18T09:52:49.863

如果您不受特定语言的限制，您可以查看[AutoIt](http://www.autoitscript.com/autoit3/)，它专为此类事情而设计。我在自动化鼠标点击或击键等事情方面有很好的经验。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-06-18T13:11:58.153

您无法决定鼠标按下和鼠标抬起之间的延迟设置会导致有效的单击，操作系统会决定。

没有任何`sleep`函数可以保证您想要的鼠标按下和鼠标按下事件之间的时间。Perl 的[Win32::GuiTest](http://search.cpan.org/~karasik/Win32-GuiTest-1.56/)模块允许您发送实际的单击事件，而不是弄乱向下和向上事件的时间。**后来：**查看源代码，Win32::GuiTest 似乎只是触发鼠标向下和向上事件，它们之间没有任何延迟，[请参见 GuiTest.pm](http://cpansearch.perl.org/src/KARASIK/Win32-GuiTest-1.56/lib/Win32/GuiTest.pm)：

```
elsif ( $item =~ /leftclick/i ) {
    SendLButtonDown ();
    SendLButtonUp ();
} 
```

此外， http: [//msdn.microsoft.com/en-us/library/ms646260](http://msdn.microsoft.com/en-us/library/ms646260(VS.85).aspx) (VS.85).aspx声明`mouse_event`已被`SendInput` [http://msdn.microsoft.com/en-us/library/ms646310取代(VS.85).aspx](http://msdn.microsoft.com/en-us/library/ms646310(VS.85).aspx)允许您发送`MOUSEINPUT`带有时间戳等的事件。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-18T09:55:35.850

您使用什么功能来完成此任务？

我希望[SendInput](http://msdn.microsoft.com/en-us/library/ms646310.aspx)在 MOUSEINPUT 结构中传递 2 个链（一个按钮向下，另一个按钮向上）会为您完成此任务。您甚至可以使用伪造事件的时间戳来玩游戏，以获得比使用 sleep() 获得的更具确定性的行为。

没有 CLICK 发送，因为应用程序负责将低级别事件（鼠标移动、按钮按下、按钮向上、按键按下、按键向上等）折叠为“用户级”事件。

* * *

一些代码，以澄清。这是直接未经测试/编译的 C（阅读：糟糕的 C），但我希望它能说明我的观点。

```
LPINPUT events = (LPINPUT)malloc(sizeof(INPUT) * 2);

events[0].type = INPUT_MOUSE;
events[0].mi.dwFlags = MOUSEEVENTF_LEFTDOWN;
events[0].mi.time = 0; //Here, you can play with timestamps (milliseconds)
events[1].type = INPUT_MOUSE;
events[1].mi.dwFlags = MOUSEEVENTF_LEFTUP;
events[1].mi.time = 0; //Likewise

//Push both events into the event queue
SendInput(2, events, sizeof(INPUT)); 
```

我的 Ruby 经验为零，所以我不知道您将如何针对您的情况进行互操作。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-18T10:00:09.193

我猜有两件事：

1.  我敢打赌 ruby​​ 不会也不能保证 sleep 0.1 真的只睡 0.1 秒。因为这可能不受红宝石控制和操作系统控制
2.  通过 Win32 本身调用 Win32 API 可能需要任意时间并导致延迟

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-06-18T10:10:21.827

既然 Windows API 支持低至 1 毫秒的睡眠，为什么不缩短睡眠时间呢？0.01秒应该够了吧？

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-06-18T23:30:54.107

我会使用 AutoHotKey。它是开源和免费的，已经存在很长时间并积极维护，以至于其他人已经为它构建了一个 IDE。我用它来为表单测试生成独特的随机测试数据，但它也可以做鼠标的事情。

[http://www.autohotkey.com/](http://www.autohotkey.com/)

# c - 操作内存时是否需要乘以sizeof(char)？

> ID：1011806
> 
> 赞同：16
> 
> 时间：2009-06-18T09:45:18.973
> 
> 标签：c, memory-management, malloc, sizeof

当使用 malloc 并进行类似的内存操作时，我可以依赖 sizeof( char ) 始终为 1 吗？

例如，我需要为 N 个类型的元素分配内存`char`。乘以`sizeof( char )`必要：

```
char* buffer = malloc( N * sizeof( char ) ); 
```

还是我可以依靠 sizeof( char ) 始终为 1 并跳过乘法

```
char* buffer = malloc( N ); 
```

我完全理解`sizeof`在编译期间进行评估，然后编译器甚至可能编译出乘法，因此性能损失将是最小的并且很可能为零。

我主要询问代码清晰度和可移植性。类型是否*需要*这种乘法`char`？

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-06-18T09:48:26.427

根据定义，sizeof(char) 始终等于 1。一个字节是 C 中字符的大小，无论一个字节中的位数是多少（在普通桌面 CPU 上为 8）。

一个字节不是 8 位的典型示例是[PDP-10](http://en.wikipedia.org/wiki/36-bit)和其他具有 9/36 位字节的旧的类似小型计算机的体系结构。但是我相信不是 2^N 的字节变得非常罕见

另外，我认为这是更好的风格：

```
char* buf1;
double* buf2;

buf1 = malloc(sizeof(*buf1) * N);
buf2 = malloc(sizeof(*buf2) * N); 
```

because it works whatever the pointer type is.

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-06-18T09:48:17.893

`sizeof(char)`无论您执行何种类型的内存操作，始终为 1。

但是，`sizeof(TCHAR)`可能会因您的编译器选项而异。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2009-06-18T10:12:58.967

I consider it kind of an [anti-pattern](http://en.wikipedia.org/wiki/Anti-pattern). It signals that the programmer didn't quite know what he/she was doing, which immediately casts the rest of the code in dubious light.

Granted, it's not (quoting Wikipedia) "ineffective", but I do find it "far from optimal". It doesn't cost anything at run-time, but it clutters the code with needless junk, all the while signalling that someone thought it necessary.

Also, please note that the expression doesn't parse as a function-call: `sizeof` is not a function. You're not calling a function passing it the magical symbol `char`. You're applying the built-in unary prefix operator `sizeof` to an expression, and your expression is in this case a cast to the type `char`, which in C is written as `(char)`.

It's perfectly possible, and highly recommended whenever possible, to use `sizeof` on other expressions, it will then yield the size of the expression's value:

```
char a;
printf("A char's size is %u\n", (unsigned int) sizeof a); 
```

This will print `1`, always, on all conforming C implementations.

I also heavily agree with David Cournapeau and consider repeating the type *name* in a `malloc()`-call to *also* be kind of an anti-pattern.

Instead of

```
char *str;

str = malloc(N * sizeof (char)); 
```

that many would write to allocate an N-character-capacity string buffer, I'd go with

```
char *str;

str = malloc(N * sizeof *str); 
```

Or (for strings only) omit the `sizeof` as per above, but this of course is more general and works just as well for any type of pointer.

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-06-19T08:40:02.640

While its not necessary, I consider it good practice to leave in the sizeof( char ) because it makes the code more readable and avoids the use of a magic number. Also, if the code needs to be changed later so that instead of a char it's mallocing the size of something into a pointer for that object, it's easier to change the code than if you have just a "1".

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-06-18T09:47:26.007

这不是必要的。请参见[此处](http://publications.gbdirect.co.uk/c_book/chapter5/sizeof_and_malloc.html)（例如）。

**`sizeof(char)`**由 C 标准定义为始终为**1**（字节）。请注意，因为`sizeof`返回多个*字节*，所以每个字节的位数是无关紧要的（实际上无论如何都是 8）。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-06-18T15:55:20.040

Something else to keep in mind is that the compiler statically knows the value of sizeof (char) is 1 and it also knows that multiplying a number by a static 1 implies the multiplication doesn't need to be done; the compiler will optimize it out. Concerns of performance shouldn't enter in to consideration on these grounds.

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2010-02-07T01:40:59.687

From "New C standard. An economic and cultural commentary".

1.  Statistics: 2.0% of sizeof are taken from `char` and 1.5% - from `unsigned char`. Page 1033 in 1.2 version of book.
2.  page 1037\.

> The number of bits in the representation of a character type is irrelevant. By definition the number of bytes in byte a character type is one.
> 
> Coding Guidelines Developers sometimes associate a byte as always containing eight bits. On hosts where the character type is 16 bits, this can lead to the incorrect assumption that applying sizeof to a character type will return the value 2. These issues are discussed elsewhere.

* * *

## 回答 #8

> 赞同：-4
> 
> 时间：2009-06-18T11:13:15.787

Using the sizeof(char) makes your code more readable and portable.

On x86, we all know that a character is 1 byte. But explicitly writing it down helps make your intentions clearer, which is always a good thing.

Also, what if your code gets put on some other platform where a character isn't 1 byte. What if a character was only 4 bits instead?

Agreed, it's not necessary, but it doesn't slow your run time down and it will pay off in that rare case you need to port your code to a different architecture.

# iphone - iPhone OS 2.2.1 备份

> ID：1011812
> 
> 赞同：-3
> 
> 时间：2009-06-18T09:46:00.487
> 
> 标签：iphone

我知道此时没有办法从 3.0 降级到 2.2.1。那么，谁能告诉我如何使用 2.2.1 备份 iPhone 设备。

谢谢你们。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-18T09:49:01.823

**升级到 3.0 后**，您将无法从该备份恢复以获取 2.2.1 。****

 **但是，如果您想进行备份，只需将手机连接到 PC 或 Mac，iTunes 就会自动备份。

如果没有，请右键单击 iTunes 左侧面板中的 iPhone 图标，然后选择“备份”。

备份将备份您的设置和文档，您也许可以使用该备份恢复这些设置和文档。

要恢复，请连接您的 iPhone，然后在您的手机的 iTunes 页面中点击“恢复”按钮。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-18T09:54:21.263

以下是降级固件的方法：http: [//www.blogsdna.com/2733/how-to-downgrade-iphone-firmware-30-to-221.htm](http://www.blogsdna.com/2733/how-to-downgrade-iphone-firmware-30-to-221.htm)

备份：如果您有越狱设备，您可以使用 SSH 访问您需要的文件。我认为没有一种“简单”的方法可以将 3.0 备份加载到 2.2.1 手机（如果我有正确理解您的问题）。

干杯

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-06-15T06:50:54.730

如果您更关心数据而不是其格式，那么我建议您调整[SQL 源代码](http://www.sqlite.org/download.html)，它完全基于 C。这真是一个痛苦的过程。正如 Afit 所说，您最终会在有效字符之间产生垃圾。**

# google-app-engine - 在 Google App Engine 数据存储中存储分层数据？

> ID：1011814
> 
> 赞同：24
> 
> 时间：2009-06-18T09:46:27.177
> 
> 标签：google-app-engine, hierarchical-data, google-cloud-datastore

有人可以说明我如何在谷歌应用引擎数据存储中存储和轻松查询分层数据吗？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-06-18T16:02:14.003

最佳选择取决于您的要求。这是一些解决方案（我假设您使用的是 Python，因为您没有指定）：

1.  如果您需要对整棵树进行事务更新，并且对任何一棵树的持续更新不会超过 1QPS，则可以使用对分层存储的内置支持。创建实体时，可以传递“parent”属性来指定父实体或键，查询时，可以使用 .ancestor() 方法（或 GQL 中的 'ANCESTOR IS' 来检索给定实体的所有后代.
2.  如果您不需要事务更新，则可以复制实体组的功能而不会出现争用问题（和事务安全）：将 db.ListProperty(db.Key) 添加到名为“ancestors”的模型中，并使用您要插入的对象的祖先列表。然后，您可以使用 MyModel.all().filter('ancestors =', parent_key) 轻松检索来自给定祖先的所有内容。
3.  如果您不需要事务，并且只关心检索实体的直接子代（不是所有后代），请使用上述方法，但不要使用 ListProperty，只需使用父实体的 ReferenceProperty。这称为邻接列表。

还有其他可用的方法，但这三种方法应该涵盖最常见的情况。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-06-18T09:57:06.610

好吧，你应该尽量保持你的数据尽可能线性。如果您需要快速查询数据的树形结构，则必须将其存储在数据库中（或者如果您愿意，可以使用 JSON 编码）（如果您的数据可能的话），或者您必须生成可以用于快速查询一片树结构。但是，我不确定 Google App Engine 在更新这些索引时会如何执行。

对于 Google App Engine，您主要关心的是减少您需要进行的查询数量，并且您的查询返回尽可能少的行。操作很昂贵，但存储不是，因此冗余不应被视为一件坏事。

以下是我通过谷歌搜索找到的关于该主题的一些想法（虽然是针对 MySQL，但您可以从中得到大致的想法）：[Managing Hierarchical Data in MySQL](http://mikehillyer.com/articles/managing-hierarchical-data-in-mysql/)

啊，这是关于 Google App Engine 的讨论：[Modeling Hierarchical Data](http://groups.google.co.jp/group/google-appengine/browse_thread/thread/879cfff68bf9ab3f/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-18T11:08:10.633

一种方法是使用模型的父属性。然后，您可以使用 query.ancestor() 和 model.parent() 函数。

我想这取决于您想对这些数据执行什么样的操作，这将决定如何最好地表示它。

# .net - 将共享程序集安装到 GAC 中以进行开发和构建

> ID：1011823
> 
> 赞同：2
> 
> 时间：2009-06-18T09:47:23.603
> 
> 标签：.net, build, development-environment, shared-libraries, gac

我在这里阅读了一些关于 GAC 的帖子，以及为什么永远不应该通过将共享程序集安装到 GAC 中来部署应用程序。我认为这是有道理的，因为它应该使更新客户端计算机上的应用程序更容易。

但是，我可以看到 GAC 在两个方面很有用，即在开发期间和在构建服务器上。

例如，如果您使用 Microsoft 应用程序块，您可以将它们安装到 GAC 中并在那里引用它们。这是有道理的，因为这样做比拥有和绝对引用路径更容易，并且每个开发人员机器上的路径可能不同。这也比拥有一个包含所有共享组件的共享网络驱动器要好 - 已经做到了。

然后，您可能会对构建服务器执行相同的操作。但是，我看到的唯一问题是您有一个使用 2.0 版应用程序块的应用程序。稍后您将其升级为使用 3.1 版。在某些时候，您可能需要重新创建该应用程序的早期版本来测试客户发现的错误，但是当您重新创建构建时，它将选择应用程序块的 3.1 版本，而不是最初构建时所针对的 2.0 版本。这是真的，还是旧项目文件仍然会引用旧版本的 dll，只要它在 GAC 中？

你对这个特定点有什么想法/意见？

我希望能够将所有版本的共享组件（我们下载或构建）作为 MSI 分发给所有开发人员，这些 MSI 安装到 GAC 中，并作为应用程序安装程序的一部分部署到客户机器上。这是最好的方法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-18T10:11:04.133

> 你对这个特定点有什么想法/意见？

**我总是将主二进制文件保存在 .NET 软件项目的 Resource/Library 文件夹中。**显然这个文件夹是版本化的。无论如何，这些天存储很便宜，所以它并没有太大的区别。

这有几个目的：

*   项目是原子的，它们不依赖于 GAC 中某个库的特定版本。因此，只需检查一下，就很容易重现以前的一些修订。一切都会奏效。
*   它只需要一台干净的开发机器（当然，安装了所有 .NET 服务包和主要 SDK），以便开始检查项目、运行完整的集成构建并开始工作。

当有超过 10 个不同的项目需要管理时，这就开始产生一些影响。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-18T10:02:01.827

如果您不使用较新的程序集重建旧应用程序，旧应用程序将从 GAC 中选择旧版本的程序集。每个程序集都将此信息保存在它自己的清单中，即它所引用的程序集。[如果您使用ILDasm 工具](http://msdn.microsoft.com/en-us/library/f7dy01k1(VS.80).aspx)打开程序集，您可以详细检查程序集的清单，其中保留了所有引用程序集的信息。

# c# - WPF ItemsControl：将 TextChanged 事件路由到所有 UserControl 项

> ID：1011839
> 
> 赞同：0
> 
> 时间：2009-06-18T09:49:33.973
> 
> 标签：c#, wpf, user-controls, command, routed

我已将我的 UserControls 放入 ItemsControl Container (Template Stackpanel) 中，在运行应用程序时会动态添加和删除它们。如何通过我的 UserControl（主要由 TextBoxes 组成）中的所有元素路由事件（例如 TextChanged 或 GotFocus）？这是我应该使用“代表”还是 ICommand 的地方？我是新手，可能我混淆了一些东西。

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-18T19:47:54.913

我在您问题的字里行间阅读了很多内容，但我怀疑您希望在添加（和删除）每个控件子项时附加（和分离）事件处理程序。

尝试将您的 ItemsSource 设置为 ObservableCollection。然后，您可以将事件处理程序附加到您的 ObservableCollection.CollectionChanged 事件。在所述事件处理程序中，您可以在添加和删除事件处理程序时将事件处理程序附加或分离到您的孩子。

```
public class MyContainer : StackPanel
{
   public MyContainer()
   {
      this.ItemsSource = MyCollection;
   }

   ObservableCollection<UIElement> myCollection;
   public ObservableCollection<UIElement> MyCollection
   {
      get
      {
         if (myCollection == null)
         {
             myCollection = new ObservableCollection<UIElement>();
             myCollection.CollectionChanged += new NotifyCollectionChangedEventHandler(myCollection_CollectionChanged);
         }
         return myCollection;
   }

   void myCollection_CollectionChanged(object sender, NotifyCollectionChangedEventArgs e)
   {
       foreach (UIElement removed in e.OldItems)
       {
          if (added is TextBox)
             (added as TextBox).TextChanged -= new Removeyoureventhandler here...

          if (added is someotherclass)
             (added as someotherclass).someotherevent += Removesomeothereventhandler here...              
       }

       foreach (UIElement added in e.NewItems)
       {
          if (added is TextBox)
             (added as TextBox).TextChanged += new Addyoureventhandler here...

          if (added is someotherclass)
             (added as someotherclass).someotherevent += Addsomeothereventhandler here...
       }

} 
```

# php - 根据PHP中的字形检查字符串的语言

> ID：1011841
> 
> 赞同：4
> 
> 时间：2009-06-18T09:50:38.980
> 
> 标签：php, mysql, unicode, arabic

我有一个 MySQL 数据库，其中包含英语和阿拉伯语的书名，并且我正在使用一个[PHP 类](http://www.ar-php.com/php/arabic/index.html)，该类可以自动将阿拉伯语文本音译成拉丁语脚本。

我希望我的输出 HTML 看起来像这样：

```
<h3>A book</h3>
<h3>كتاب <em>(kitaab)</em></h3>
<h3>Another book</h3> 
```

PHP 有没有办法根据字符串中使用的 Unicode 字符和字形来确定字符串的语言？我试图得到这样的东西：

```
$Ar = new Arabic('EnTransliteration');
while ($item = mysql_fetch_array($results)) {
    ...
    if (some test to see if $item['item_title'] has Arabic glyphs in it) {
      echo "<h3>$item[item_title] <em>(" . $Ar->ar2en($item['item_title']) . ")</em></h3>";
    } else {
      echo "<h3>$item[item_title]</h3>";
    }
    ...
} 
```

幸运的是，当输入拉丁字符时，课程不会窒息，所以理论上我可以通过转换发送每个结果，但这似乎是浪费处理。

谢谢！

**编辑：** 我还没有找到检查字形或字符的方法。我想我可以将所有阿拉伯字符放在一个数组中，并检查数组中的任何内容是否与字符串的一部分匹配......

但是，我确实想出了一个最终可能会正常工作的临时解决方案。无论语言如何，它都会对每个标题进行转换，但仅在字符串更改时才输出括号中的音译：

```
while ($item = mysql_fetch_array($mysql_results)) {
    $transliterate = trim(strtolower($Ar->ar2en($item['item_title'])));
    $item_title = (strtolower($item['item_title']) == $transliterate) ? $item['item_title'] : $item['item_title'] . " <em>($transliterate)</em>";

    echo "<h3>$item_title</h3>";
} 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-06-20T15:02:02.197

这应该这样做：

```
preg_match("/\p{Arabic}/u", $item['item_title']) 
```

如果你愿意，你可以让这个正则表达式更复杂一点，但我认为你真的不需要。

[`\p`转义序列](http://www.php.net/manual/en/regexp.reference.php#regexp.reference.unicode)允许您根据Unicode 属性选择字符（使用[`u`模式修饰符](http://www.php.net/manual/en/reference.pcre.pattern.modifiers.php)时）。

PHP 手册提到：“PCRE 不支持“Greek”或“InMusicalSymbols”等扩展属性。但这不再完全正确。[PCRE 6.5 版增加了对脚本名称的支持](http://www.pcre.org/news.txt)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-18T09:57:02.850

这是一个用于阿拉伯语字符集自动检测的 PHP 开源类：

[http://www.ar-php.com/php/arabic/index.html#ArCharsetD](http://www.ar-php.com/php/arabic/index.html#ArCharsetD)

# javascript - 自动关闭 Flash 文件

> ID：1011843
> 
> 赞同：0
> 
> 时间：2009-06-18T09:51:34.843
> 
> 标签：javascript, flash

是否可以在浏览器中播放完 Flash 横幅后自动关闭它？

可以通过javascript完成吗？还是应该在闪存文件本身中配置？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-18T09:56:24.273

您所说的“关闭”是什么意思，您是打算折叠空间还是将其隐藏？第二个简单的方法是在一个空的透明框架上结束。首先，您可能需要 javascript 将其从 DOM 中删除。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-18T09:57:08.640

据我了解，当它到达时间轴的末尾时，您希望从 DOM 树中删除对象/嵌入内容。

考虑到这一点，我会说这是可能的。不是flash大师，但flash应该能够调用一个javascript函数来删除适当的DOM元素。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-18T10:01:44.277

您可以使用 ExternalInterface 调用 javascript 以从您的操作脚本中删除该对象。

在你的闪光中：

```
import flash.external.ExternalInterface;
ExternalInterface.call("removemovie"); 
```

在 JavaScript 中：

```
function removemovie(){
   //do stuff here to remove movie
} 
```

乔什

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-18T10:04:47.530

您可以向 flash 添加一个动作脚本，当 flash 播放完毕时，他会调用您编写的 javascript 函数。在此功能中，您隐藏了元素。

# linux - linux上的QT Creator可以创建.exe文件吗

> ID：1011845
> 
> 赞同：-1
> 
> 时间：2009-06-18T09:52:00.520
> 
> 标签：linux, qt-creator, cross-compiling, opensuse

我已经在 OpenSUSE Linux 发行版中安装了 QT Creator，我能知道是否可以创建在 Linux 中完美执行的 QT 程序的“.exe”。

如果是这样，请提及在 Linux 中创建 .exe 的过程。

感谢你

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-18T09:55:56.910

我了解您有一个 Qt 应用程序，并且您可以使用 QtCreator 在 OpenSuse 上编译它，并且您想在 OpenSuse 上创建同一应用程序的 Windows 二进制文件。

最轻松的方法是安装 Qt SDK（和 QtCreator，如果需要）并在 Windows 机器上编译您的代码。

如果没有，请查看[http://silmor.de/29](http://silmor.de/29)。

jrh

* * *

更新：回应您的评论：

在这种情况下，您需要在 linux for windows 上交叉编译您的代码。（你显然知道这一点，因为你已经很好地标记了你的问题）。

1.  你需要在 linux 上安装 MinGW：http: [//www.mingw.org/wiki/LinuxCrossMinGW](http://www.mingw.org/wiki/LinuxCrossMinGW)
2.  现在按照[此链接](http://silmor.de/qtstuff.mingw.php)上的说明进行操作（从[http://silmor.de/29](http://silmor.de/29)恢复的链接）。

这应该是全部。

jrh

# project-management - 项目规划，开发人员笔记工具

> ID：1011862
> 
> 赞同：1
> 
> 时间：2009-06-18T09:56:29.420
> 
> 标签：project-management, knowledge-management

我正在寻找一个项目规划工具，其中包括组织者、待办事项列表、项目目标 * 截止日期等功能。

因为我是一名开发人员，所以拥有一个可以进行建模的工具（如 UML/ERD 等）会很好。

我也在寻找可以做笔记的东西。类似于带有代码片段的博客 - 所以带有语法突出显示。OneNote 等都没有代码突出显示 - 我能做的最好的事情是使用在线语法突出显示生成 HTML，然后粘贴其中很慢。

当然，拥有一个具有我列出的所有功能的免费/开源工具是件好事。但很高兴知道那里有哪些付费选项

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-18T10:11:01.903

为什么它必须是一个工具？Outlook 或 Evolution（或 KDE 工具）和 Umbrello 之类的 UML 工具的组合将比某种瑞士军刀万事通程序好得多。

UNIX 哲学基于许多工具执行专门任务的概念。桌面、命令行和开放标准将它们联系在一起。在大多数情况下，这非常有效。

坦率地说，对于旨在成为所有人的一切的程序，我从来没有太多的运气。通常最终的结果只是臃肿和错误。

无论如何，对于计划者，我建议您查看[Taskcoach](http://www.taskcoach.org/)。这太棒了，并且有很多你想要的东西。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-18T10:10:25.930

像 Eclipse 这样的一些 IDE 为许多这样的事情提供了插件。

它有用于组织者、UML、待办事项列表、项目截止日期 (mylyn) 的插件。

我不确定是否有做笔记的插件，虽然我听说有一个博客插件可用。

**编辑：**有一个[插件](http://robrohan.com/2007/02/07/blogging-from-within-eclipse-metaweblog-plugin/)可以在 Eclipse 中编写博客。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-18T13:10:24.287

看看 gmail - google docs - google calendar - 我开始认为它拥有开发人员/项目经理所需的所有工具

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-09-07T12:53:33.810

就我个人而言，我想将博客工具（joomla/wordpress）与开发人员相关的插件 - 语法高亮 - 带有 wiki 的日历/项目管理插件的组合对我来说是最好的......至少个人......

也许扔一个错误管理应用程序或类似的东西......谷歌浪潮似乎也很有趣

希望谷歌应用程序会改进，我认为这会很好

# java - 如何加快 gwt 编译器的速度？

> ID：1011863
> 
> 赞同：205
> 
> 时间：2009-06-18T09:56:45.317
> 
> 标签：java, performance, gwt

我们开始在我们的项目中更多地使用 GWT，而 GWT 编译器的性能变得越来越烦人。

我们将开始改变我们的工作实践来缓解这个问题，包括更加强调托管模式浏览器，它将运行 GWT 编译器的需要推迟到以后，但这会带来其自身的风险，尤其是直到比我们想要的晚得多时才发现真正的浏览器的问题。

理想情况下，我们希望 GWT 编译器本身更快 - 编译一个相当小的应用程序需要一分钟时间。但是，如果我们使用 compile 是一种相当幼稚的方式，所以我希望我们可以快速轻松地获得一些收益。

我们目前正在调用 com.google.gwt.dev.Compiler 作为来自 ant Ant 目标的 java 应用程序，具有 256m 的最大堆和大量的堆栈空间。编译器由 Ant 使用 fork=true 和最新的 Java 6 JRE 启动，以尝试利用 Java6 改进的性能。我们将主控制器类与应用程序类路径一起传递给编译器，然后就可以了。

我们还能做些什么来获得额外的速度？我们能不能给它更多的信息，让它花更少的时间去发现要做什么？

我知道我们可以告诉它只为一个浏览器编译，但我们需要进行多浏览器测试，所以这并不实际。

在这一点上欢迎所有建议。

* * *

## 回答 #1

> 赞同：145
> 
> 时间：2009-06-18T10:01:41.623

让我们从令人不安的事实开始：GWT 编译器的性能真的很糟糕。您可以在这里和那里使用一些技巧，但您不会获得明显更好的性能。

您可以做的一个不错的性能改进是仅针对特定浏览器进行编译，方法是在您的`gwt.xml`:

```
<define-property name="user.agent" values="ie6,gecko,gecko1_8"></define-property> 
```

或在 gwt 2.x 语法中，并且仅适用于一个浏览器：

```
<set-property name="user.agent" value="gecko1_8"/> 
```

例如，这将只为 IE 和 FF 编译您的应用程序。如果你知道你只使用特定的浏览器进行测试，你可以使用这个小技巧。

另一种选择：如果您使用多个语言环境，并且再次仅使用一个进行测试，您可以将它们全部注释掉，以便 GWT 将使用默认语言环境，这会减少编译时的一些额外开销。

底线：您不会在编译器性能上获得数量级的提升，但是通过几次放松，您可以在这里和那里节省几分钟。

* * *

## 回答 #2

> 赞同：62
> 
> 时间：2009-06-18T13:27:23.050

如果使用 -localWorkers 标志运行 GWT 编译器，编译器将并行编译多个排列。这使您可以使用多核机器的所有内核，例如 -localWorkers 2 将告诉编译器并行编译两个排列。您不会获得数量级的差异（并非编译器中的所有内容都是可并行化的），但如果您正在编译多个排列，它仍然是一个显着的加速。

如果您愿意使用 GWT 的主干版本，您将能够对任何浏览器使用托管模式（[进程外托管模式](http://code.google.com/p/google-web-toolkit/wiki/DesignOOPHM)），这可以缓解当前托管模式的大部分问题。这似乎是 GWT 的发展方向 - 始终使用托管模式进行开发，因为编译不太可能更快地获得数量级。

* * *

## 回答 #3

> 赞同：55
> 
> 时间：2010-05-03T14:06:13.550

虽然这个条目很老，而且你们中的大多数人可能已经知道，但我认为值得一提的是 GWT 2.x 包含一个新的编译标志，它通过跳过优化来加速编译。您绝对不应该部署以这种方式编译的 JavaScript，但在非生产连续构建期间它可以节省时间。

只需在您的 GWT 编译器行中包含标志：-draftCompile。

* * *

## 回答 #4

> 赞同：32
> 
> 时间：2011-05-08T10:45:04.703

这是您可以将其设置[为的 user.agent 值的列表。](https://gwt.googlesource.com/gwt/+/master/user/src/com/google/gwt/useragent/UserAgent.gwt.xml)

（在这里添加这个是因为当我搜索我应该设置的内容以使其仅产生 chrome 的排列时，我一直在这里结束。答案是`<set-property name="user.agent" value="safari"/>`：）

* * *

## 回答 #5

> 赞同：30
> 
> 时间：2011-11-21T18:12:29.963

在 GWT 的较新版本中（我相信从 2.3 或 2.4 开始），您还可以添加

```
<collapse-all-properties /> 
```

到您的 gwt.xml 用于开发目的。这将告诉 GWT 编译器创建一个涵盖所有语言环境和浏览器的单一排列。因此，您仍然可以在所有浏览器和语言中进行测试，但仍然只编译一个排列

* * *

## 回答 #6

> 赞同：18
> 
> 时间：2013-03-05T23:29:11.483

您可以在构建中添加一个选项以进行生产：

`-localWorkers 8`– 其中 8 是计算排列的并发线程数。您所要做的就是将此数字调整为对您更方便的数字。请参阅[GWT 编译性能](http://josephmarques.wordpress.com/2010/07/30/gwt-compilation-performance/)（感谢 Dennis Ich 评论）。

如果要编译到测试环境，还可以使用：

`-draftCompile` 这可以实现更快但优化程度较低的编译

`-optimize 0` 这不会优化您的代码（9 是最大优化值）

将构建和托管模式性能提高一倍以上的另一件事是使用 SSD 磁盘（现在托管模式就像一个魅力）。这不是一个便宜的解决方案，但取决于您使用 GWT 的程度和您的时间成本，这可能是值得的！

希望这对你有帮助！

* * *

## 回答 #7

> 赞同：14
> 
> 时间：2009-06-18T10:10:47.520

GWT 编译器正在进行大量代码分析，因此很难加快速度。 [Google IO 2008 的本次会议](http://www.youtube.com/watch?v=nvti32k4xyU)将让您很好地了解 GWT 正在做什么以及为什么需要这么长时间。

我的建议是开发尽可能使用托管模式，然后仅在您想要进行测试时进行编译。这听起来确实像您已经找到的解决方案，但基本上这就是托管模式存在的原因（嗯，那个和调试）。

您可以加快 GWT 编译速度，但仅针对某些浏览器进行编译，而不是 GWT 默认执行的 5 种。如果您想使用托管模式，请确保您为至少两个浏览器进行编译；如果您针对单个浏览器进行编译，则浏览器检测代码会被优化掉，然后托管模式不再起作用。

为更少的浏览器配置编译的一种简单方法是创建第二个从主模块继承的模块：

```
<module rename-to="myproject">
  <inherits name="com.mycompany.MyProject"/>
  <!-- Compile for IE and Chrome -->
  <!-- If you compile for only one browser, the browser detection javascript
       is optimised away and then Hosted Mode doesn't work -->
  <set-property name="user.agent" value="ie6,safari"/>
</module> 
```

如果`rename-to`属性设置相同，则输出文件将与您进行完整编译时相同

* * *

## 回答 #8

> 赞同：11
> 
> 时间：2009-06-18T10:23:15.060

*   将您的应用程序拆分为多个模块或入口点，然后仅在需要时重新编译。
*   使用主干版本分析您的应用程序 - 它提供了[您的编译故事](http://code.google.com/p/google-web-toolkit/wiki/CodeSplitting)。这可能与 1.6 编译器相关，也可能不相关，但它可以指示正在发生的事情。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2011-02-21T16:47:48.307

对于 GWT 2.x，我刚刚发现，如果您使用

```
<set-property name="user.agent" value="ie6"/>
<extend-property values="ie8,gecko1_8" name="user.agent"/> 
```

您甚至可以指定多个排列。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2021-04-07T02:23:27.197

您可以编译 gwt 的特定模块只需在项目的 build.xml 中提及要编译的模块即可。

With the help of the command below

```
ant -Dap.build.javadoc gwt 
```

# tcp - Berkley sockets的shutdown函数，有多重要？

> ID：1011868
> 
> 赞同：2
> 
> 时间：2009-06-18T09:57:31.447
> 
> 标签：tcp, berkeley-sockets

作为背景，我有一个嵌入式设备，可以通过 IP 与第三方服务器通信。第三方服务器中的代码不太可能更改。在最近的一个版本中，我将 ip disconnect 函数更改为在调用 close() 之前调用 shutdown()（之前它只是调用了 close()）。如果发生某些中断，嵌入式设备会在未完成通信会话的情况下断开连接。当这种情况发生在会话中的错误点时，服务器现在正在生成一个跟踪文件，由于各种原因，该文件对客户来说是不可接受的。这仅在调用 shutdown 时发生，服务器将此视为发送失败错误（并生成跟踪文件），而将更突然的 close() 视为不需要跟踪的另一端断开连接错误。

所以显而易见的解决方案是停止调用关机。Barnes 先生在这个[问题](https://stackoverflow.com/questions/409783/socket-shutdown-vs-socket-close)中的回答很好地描述了这两个功能，但是，如果您知道只有一个进程连接到特定套接字，那么有什么理由在关闭之前使用关闭？

谢谢，帕特里克

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-18T10:48:17.817

在我看来，“突然断开连接”已经成为您通信协议的一部分，这不是一件好事。如果客户端在“某些中断发生”之后运行很长时间来决定是否使用`shutdown()`或`close()`影响另一端看到的内容，那么最好更新您的协议以可靠地传递“此会话已中止消息。 "

也就是说，听起来好像这个系统（即所有的交互软件）已经（在服务器上）严重冻结了一点，以至于这种变化永远不会发生。可能你想要做的，而不是弄清楚问题到底是什么，是让经理签署一个快速而肮脏的“只使用`close()`”解决方案，在向他解释你不确定其他什么之后这可能会产生影响，但之前的情况似乎确实运行良好。（自从您进行更改后，您没有注意到任何其他错误消失，是吗？）

决定是否进行潜在昂贵的搜索以查看此处实际发生的情况，以及与另一端负责维护该软件的某个组织进行潜在的昂贵（政治上，如果不是财务上），实际上是管理决策，而不是技术决策第一，虽然要正确制作，但需要了解技术风险。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-12-07T02:08:54.220

> 如果您知道只有一个进程连接到特定套接字，那么在关闭之前是否有任何理由使用关闭？

不，没有。与那里的许多文档相反。如果尚未发送，则关闭 FIN/ACK 关闭握手。

编辑：但这并不是说关机没有它的用​​途：当然它有。如果您想停止发送，并希望接收者知道这一点，但又想继续接收，那就是它的目的。另一个用途是几乎解决了两军问题并获得同步关闭：如果您读取 EOS，则发送关闭并关闭；如果要启动关闭，请发送关闭并读取直到 EOS，然后关闭。如果您的应用程序协议正确，则后一步不应读取任何数据，并且两端的关闭将是相当同时的。

# video - “中间人”司机？

> ID：1011881
> 
> 赞同：2
> 
> 时间：2009-06-18T10:02:07.020
> 
> 标签：video, usb, driver

我有一个想法，但不知道是否可以这样做：

是否可以编写一个可以将视频源多路复用到任何需要它的软件的 USB cam 驱动程序？一种“中间人”司机:)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-18T10:06:21.083

是的。至于这如何取决于系统。你甚至没有说你在说什么操作系统。无论如何，windows 和 linux 都支持调用其他驱动程序的驱动程序。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-18T12:03:14.733

如果您需要 Linux 驱动程序，请查看 v4l 环回驱动程序：

[http://www.lavrsen.dk/foswiki/bin/view/Motion/VideoFourLinuxLoopbackDevice](http://www.lavrsen.dk/foswiki/bin/view/Motion/VideoFourLinuxLoopbackDevice)

应该可以将它与一些用户代码结合起来做你想做的事。

对于 Windows，您可能可以使用 DirectShow 在用户空间中执行某些操作。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-07-02T15:42:28.110

这在 Windows 驱动程序模型中也应该是可能的。它被称为“上层过滤驱动程序”，位于常规驱动程序和用户空间之间。

底层驱动程序显然是独占的，而您的过滤器不应该是。[那么阅读这篇](http://blogs.msdn.com/doronh/archive/2006/05/25/607708.aspx)关于如何使驱动程序（非）独占的博文可能是明智的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-18T10:14:14.640

嗯，如果它是 GNU/Linux、MacOS 或任何其他支持的操作系统，则可以使用足够简单的 FUSE 模块来多路复用设备节点......如果明天之前没有任何响应，我会尝试敲一下Perl（如果我能找到我的摄像头...）:)

前段时间我考虑过编写这样的代码（作为内核模块），但它最终被搁置了——这个想法实际上是针对网络摄像头的，但可以应用于提供一个多路复用的只读设备节点，抽象任何其他设备提供数据流的节点...

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-18T12:23:29.980

可能想看看 FTDI 芯片 [http://www.ftdichip.com/](http://www.ftdichip.com/)

有适用于许多操作系统的驱动程序。

也可以看看上面已经有 USB 芯片的 Arduino 板。 [http://www.arduino.cc/](http://www.arduino.cc/)。

# xbap - XBAP 异常通知器

> ID：1011886
> 
> 赞同：0
> 
> 时间：2009-06-18T10:03:28.593
> 
> 标签：xbap

我计划在 XBAP 应用程序（部分信任）中设计一个异常通知器。异常通知器将是一个用户控件。它将由左侧的列表框和所有错误消息组成，右侧的错误消息的详细说明将是另一个列表框（模板化）。

我不想每次都向用户显示此异常通知程序。当出现错误/异常时，这个隐藏的异常通知器必须从我的屏幕底部（或从任何方向）弹出并带有一些动画。然后，用户可以选择在查看完消息后关闭异常通知程序。

任何代码示例都会帮助我。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-12-28T14:08:47.257

老哥退房

[在 WinForms 中处理未处理的异常](http://srtsolutions.com/blogs/mikewoelmer/archive/2009/04/17/dealing-with-unhandled-exceptions-in-winforms.aspx)

[处理 WPF 中未处理的异常](http://srtsolutions.com/blogs/mikewoelmer/archive/2009/04/17/dealing-with-unhandled-exceptions-in-wpf.aspx)

也看看[异常报告器](http://exceptionreporter.codeplex.com/)

# wpf - 如何让 StackPanel 使用 ItemTemplate？

> ID：1011899
> 
> 赞同：14
> 
> 时间：2009-06-18T10:08:33.747
> 
> 标签：wpf, xaml, stackpanel, itemtemplate

在下面的代码中，我通过分配**ItemTemplate**属性来告诉**ComboBox**使用名为 CustomerTemplate 的 DataTemplate 。

 ****但是StackPanel**没有 ItemTemplate 属性。

**如何让 StackPanel 也使用 CustomerTemplate？**

```
<Window.Resources>
    <DataTemplate x:Key="CustomerTemplate">
        <StackPanel Orientation="Horizontal">
            <TextBlock Text="{Binding FirstName}"/>
            <TextBlock Text=" "/>
            <TextBlock Text="{Binding LastName}"/>
        </StackPanel>
    </DataTemplate>
</Window.Resources>

<DockPanel LastChildFill="False" Margin="10">
    <ComboBox 
        x:Name="CustomerList"
        ItemTemplate="{StaticResource CustomerTemplate}"
        HorizontalAlignment="Left"
        DockPanel.Dock="Top" 
        Width="200"
        SelectedItem="{Binding SelectedCustomer, Mode=TwoWay}"
        ItemsSource="{Binding Customers}"/>

    <StackPanel DataContext="{Binding SelectedCustomer}" Orientation="Horizontal">
        <TextBlock Text="Chosen: "/>
        <TextBlock Text="{Binding LastName}"/>
    </StackPanel>

</DockPanel> 
```

* * *

## 回答 #1

> 赞同：51
> 
> 时间：2009-06-18T10:28:48.747

[ItemsControl](http://msdn.microsoft.com/en-us/library/system.windows.controls.itemscontrol.aspx)本质上是一个带有 ItemTemplate 的 StackPanel。它在内部使用 StackPanel。

但是，看起来您正在尝试显示单个客户而不是他们的列表（我听起来像 Clippy，不是吗？）。在这种情况下，您想使用 ContentControl：

```
<ContentControl 
    Content="{Binding SelectedCustomer}"
    ContentTemplate="{StaticResource CustomerTemplate}" /> 
```**

# asp.net-3.5 - 需要有关 ASP.net 的 HttpApplicationState 的教育

> ID：1011900
> 
> 赞同：1
> 
> 时间：2009-06-18T10:08:54.013
> 
> 标签：asp.net-3.5, session-state

今天我对 2 个与 ASP.net 的 HttpApplicationState 相关的问题感到困惑。我的问题如下

1.  如果我使用 StateServer 进行会话管理（我想用于我的网络花园部署的 out proc 会话管理内容），假设**HttpApplicationState （我通过 System.Web.UI.Page.Application 属性访问）是否安全) 也**像 Session 一样存储在 StateServer 中？因此，如果我的工作进程 A 将值“10”写入 Page.Application，那么稍后在工作进程 B 中运行的另一个请求必须看到同一个键的这个“10” - 是否正确？

2.  我的一位开发人员同事告诉我，他在测试中发现，在 StateServer 场景中，**如果他将 100 个键值条目插入到 Page.Session 中，那么当他尝试从不同的请求中读取任何键时，workerprocess将全部 100 个条目带入活动的工作进程内存空间，然后提供请求实际询问的密钥。**是真的吗？

如果有人可以帮助我消除我在这方面的困惑，将不胜感激。

谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-18T10:23:36.743

1.  StateServer 仅支持 Session 状态，Application 状态仅限于 AppDomain。

2.  StateServer 存储 Session 的序列化。它无法知道如何访问特定的键值。当被访问时，会话被重新注入需要它的应用程序中，并在请求期间用作正常的会话数据。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-18T10:20:23.193

1.  据我所知，进程外状态服务器不存储 HttpApplicationState 数据。您可以很容易地对此进行测试以确定，但我怀疑它确实如此。

2.  我也不认为这是真的。会话存储基本上是一个哈希表。在哈希表中查找单个键应该只返回关联的值。你不应该看到你描述的行为。同样，您应该能够轻松地对此进行测试。

# iphone - 是否可以同时在两部 iPhone/iPod 上构建和运行？

> ID：1011901
> 
> 赞同：5
> 
> 时间：2009-06-18T10:09:17.320
> 
> 标签：iphone, deployment, p2p

当我同时将两部 iPhone 连接到我的计算机并构建并运行项目时，该应用程序仅在其中一台设备上安装和播放。

现在，使用支持蓝牙点对点连接的 iPhone 3.0，要测试多人游戏项目，您必须同时在两台设备上安装和运行它。能够通过单击而不是：在一部手机上安装，断开连接，连接另一部手机，等待 10 秒钟以识别手机并再次安装并运行...

有人知道做这种事情的方法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-18T12:14:01.983

未测试但值得一试：启动另一个 Xcode 实例（例如从命令行）并从那里使用第二个设备。

```
> /Developer/Applications/Xcode.app/Contents/MacOS/Xcode & 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-18T21:58:54.777

有趣的是你应该问。我今天早上在我的博客上发布了关于这个主题的分步说明。我不会在这里重复。这是链接：[http ://ramin.firoozye.com/2009/06/18/debugging-peer-to-peer-and-wifi-apps-on-the-iphone/](http://ramin.firoozye.com/2009/06/18/debugging-peer-to-peer-and-wifi-apps-on-the-iphone/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-06-18T03:14:02.527

如果您碰巧可以访问安装了 iPhone sdk 的 Mac 实验室（学院/大学实验室），您可以测试 p2p 应用程序。模拟器不支持蓝牙，但仍然可以通过这种方式进行测试。在一台 Mac 上转到 wifi 图标并选择创建网络，将其命名为某物，在第二台 Mac 上转到 wifi 图标并选择您刚刚命名的网络。将您的代码加载到两台机器上的 xCode 中并运行模拟器。我已经以这种方式测试了我的蓝牙 p2p 应用程序，它工作正常。

如果您无法访问实验室，对不起。

# ruby-on-rails - 为什么 facebook.feed.publishUserAction 会删除我的图像？

> ID：1011903
> 
> 赞同：-1
> 
> 时间：2009-06-18T10:10:23.790
> 
> 标签：ruby-on-rails, ruby, facebook, facebooker

我在 Rails 中使用 Facebooker 插件将用户操作发布到他们的新闻源，但没有添加图像。

调用（通过 Net::HTTP.post_form）如下所示：

```
Posting to http://api.facebook.com/restserver.php with
{:api_key=>"4f5ed28f76142adsfasdf029c98ad", :template_bundle_id=>"107345673712", 
:template_data=>"{\"project\": \"testing\", \"images\": 
[{\"src\":\"http://www.dezyne.net/news.jpg\", 
\"href\":\"http://www.facebook.com/\"}]}", 
:session_key=>"2.nvhdfsdfgimDZWSwQ__.86400.1245405600-100000007614297", 
:method=>"facebook.feed.publishUserAction", :sig=>"ac0a7181b351b5fdgsdfge767a004314", 
:call_id=>"1242343866.44512", :v=>"1.0"} 
```

“项目”在发布到新闻源的文本中被捕获。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-18T19:44:34.187

一个可能的问题是您在实际上传图像之前测试了此模板。这将导致 Facebook 缓存一个空图像。每次请求图像时，FB 都会使用其存储的缓存，而不是重新检索图像。

如果这是问题所在，解决方案是使用 API 函数 fbml.refreshImgSrc() 使 Facebook 更新其缓存。不幸的是，没有快速的机制来执行此操作，因为该 API 方法在测试控制台或开发人员应用程序中根本不可用，这意味着您需要编写一个脚本来刷新此图像的缓存。

如果这没有帮助，请回帖，我会看看我是否想不出任何其他可能的问题。

# iphone - UIToolbar-如何在两行中添加两个按钮项？

> ID：1011906
> 
> 赞同：0
> 
> 时间：2009-06-18T10:10:42.527
> 
> 标签：iphone

作为标题如何？ UIToolbar的类方法是在单行中添加按钮

```
[contentToolBar setItems:items animated:NO]; 
```

但我希望它可以添加不同的行或多行，谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-18T12:10:17.997

那不完全是[HIG](http://developer.apple.com/iphone/library/documentation/UserExperience/Conceptual/MobileHIG/Introduction/Introduction.html)。所以你必须自己做。

# c++ - 在 WindowProc MFC 中使用 try/catch

> ID：1011908
> 
> 赞同：1
> 
> 时间：2009-06-18T10:11:01.030
> 
> 标签：c++, mfc

如果我在 MFC 窗口/视图类的 WindowProc 覆盖中使用 try/catch，则会影响性能。为什么会这样，有什么替代方法？

这是我通过分析发现的。删除块使函数消耗更少的时间。我正在使用 MS VS 2008。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-18T10:16:51.377

仅使用 try/catch 不会对性能产生影响 - 也许您抛出了太多异常？您是否分析过您的代码以找出性能下降的来源？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-18T10:29:01.600

在[usage-of-try-catch-blocks-in-c 中，](https://stackoverflow.com/questions/951380/usage-of-try-catch-blocks-in-c) Todd Gardner 解释说编译器使用“表”方法或“代码”方法来实现异常。“代码”方法解释了性能损失。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-22T09:14:09.883

另一种方法是将 try-catch 放在您自己的代码周围。大多数对 WndProc 的调用都以 DefaultWindowProc* 结束，它不会引发 C++ 异常。因此，通过将 try/catch 移近您自己的代码，可以节省大量开销。

[*] DefaultWindowProc 可能会抛出 SEH 异常，例如增加堆栈，但您不应该处理这些异常。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-18T12:26:44.780

我确定您知道 WindowProc 处理大量流量。*开关（消息）*循环之外的任何代码都将由通过泵的每条消息执行。

我刚刚制作了一个基于小对话框的 MFC 应用程序，我在其中覆盖了 WindowProc 并简单地计算了它被调用的次数。测试表明，只需将鼠标光标移到对话框上，每秒就会产生超过 1000 次 WindowProc 调用。

只是想一想。

ps 我会将此添加为评论，但我还没有足够的声誉分数。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-20T00:18:00.287

在您的应用程序类中，查看覆盖[`CWinApp::ProcessWndProcException`](http://msdn.microsoft.com/en-us/library/93k07whb(VS.80).aspx). 这使您有机会在任何命令或消息处理程序中引发未捕获的 MFC `CException`（和衍生品）。

如果您需要最后一次机会，您需要考虑安装自己的 SEH 过滤器。

# mysql - MySQL 错误 2013

> ID：1011911
> 
> 赞同：8
> 
> 时间：2009-06-18T10:11:32.243
> 
> 标签：mysql, mysql-error-2013

当我运行我的程序超过几天时，我遇到了与 MySQL 问题的连接失败。连接到数据库时，MySQL 错误代码是 2013。MySQL 服务器和客户端程序都在同一台机器上。我使用 FC5 作为我的操作系统，MySQL 版本是 5.0.18。有人可以对此有所了解吗？

我在调用时收到 mysql 错误 2013 `mysql_real_connect()`...

任何帮助表示赞赏。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2011-09-06T06:57:41.020

尝试使用 localhost，而不是您自己的 IP。我不知道为什么，但这立即为我解决了问题。

如果有人能突然澄清为什么这会起作用，我将不胜感激。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-06-18T10:12:54.177

1.  听起来像是防火墙问题。您是否尝试过暂时禁用防火墙？

2.  [另一种可能的解决方案涉及编辑此处](http://forums.mysql.com/read.php?34,45914,120196#msg-120196)提到的启动脚本并注释掉以下行：

    SKIP=跳过网络

3.  [这里](http://www.tutorials.de/forum/relationale-datenbanksysteme/194826-mysql-error-2013-hy000-lost-connection-mysql-server-during-query.html#post1011024)提到了第三种可能的解决方案。用户尝试访问 InnoDB 数据库，但意外禁用了 MySQL 服务器的 InnoDB 支持。

4.  **（新）**我发现[这篇 MySQL 官方文章](http://dev.mysql.com/doc/refman/5.0/en/gone-away.html)有很多解决问题的方法。您是否修改了 wait_timeout 系统变量？

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-04-20T00:19:45.657

这是一个你可能想不到的答案。我遇到了同样的问题。MySQL 错误 2013。以下是症状：

1.  PHPMyAdmin 触发了 2013 和错误 95。

2.  我可以进入 MySQL 监视器，但启动需要非常长的时间。命令行实用程序启动后，我可以查看表格并且一切正常

3.  服务器需要很长时间才能停止并重新启动。

4.  MySQL 错误日志中没有错误。

我和一位优秀的系统管理员一起工作，他检查了 netstat -tn，得到了答案：

```
tcp        0      0 [my.srv.ip]:3306     184.73.87.215:59271     ESTABLISHED
tcp        0      1 [my.srv.ip]:38138    184.73.87.215:113       SYN_SENT 
```

IP 解析为 Amazon Web Services。尽管端口 80 之外的所有内容都是仅允许的，但我的 3306 上仍有一些刺痛。是时候查看我的防火墙规则了。

没有新表，mtop 也没有显示任何活动，但我在 auth 日志中发现了很多：

```
Apr 19 15:14:52 magic2 mysqld[18953]: refused connect from ec2-184-73-87-215.compute-1.amazonaws.com
Apr 19 15:18:02 magic2 mysqld[18953]: refused connect from ec2-184-73-87-215.compute-1.amazonaws.com 
```

在 iptables 中阻止了有问题的 IP 后，问题突然消失了。偷偷摸摸的混蛋。这个故事的寓意是：看起来像错误的东西，可能是黑客。

bz

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-04-06T23:29:16.393

检查您的 my.cnf。将您的绑定地址设置为服务器的 IP 地址。为我解决了这个问题。似乎没有人知道那个问题的答案！

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2015-06-09T13:10:05.937

我的解决方法是 - 将 'localhost' 更改为 '127.0.0.1'

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-06-18T10:20:34.927

可能是网络错误导致 TCP/IP 连接断开，或者服务器上的 wait_timeout 已超过；后者实际上可以用于降低打开连接数，但应用程序需要正确处理错误代码 2013！

# java - Java 7 中的链式调用？

> ID：1011916
> 
> 赞同：6
> 
> 时间：2009-06-18T10:14:05.907
> 
> 标签：java, language-design, language-features, java-7

我正在阅读[Java 7 预览演示文稿 (pdf)](http://puredanger.com/techfiles/090204/Java7Preview.pdf)，并且有一张关于*Chained Invocation*的幻灯片。这是幻灯片中使用的示例：

```
// Construction with setters
DrinkBuilder margarita = new DrinkBuilder();
margarita.add("tequila");
margarita.add("orange liqueur");
margarita.add("lime juice");
margarita.withRocks();
margarita.withSalt();
Drink drink = margarita.drink();

// Construction with chained invocation
Drink margarita = new DrinkBuilder()
    .add("tequila")
    .add("orange liqueur")
    .add("lime juice")
    .withRocks()
    .withSalt()
    .drink(); 
```

我对此有复杂的感觉。不应该将太多的方法调用链接到一个语句中。另一方面，写作`margarita.this()`也`margarita.that()`不太方便。

现在，我从 Delphi 世界来到 Java。在 Delphi 中有[`with`](http://www.delphibasics.co.uk/RTL.asp?Name=With)语言结构。这是少数人所珍视的，而许多人则厌恶这一点（或者相反？）。我发现`with`它比链式调用的想法更优雅（我相信它的工作原理是`void`方法返回对已调用它的对象的引用——这是我不喜欢的部分，因为`void`应该*什么都不*返回）。

我很欣赏`with`Java 采用的语言特性，因此示例代码可以这样编写：

```
Drink margarita = null;
with (new DrinkBuilder()) {
    add("tequila");
    add("orange liqueur");
    add("lime juice");
    withRocks();
    withSalt();
    margarita = drink();
} 
```

我是唯一一个更喜欢这种解决方案而不是链式调用的人吗？还有其他人觉得这`with`可能是对 Java 语言的有用扩展吗？（让我想起有人关于需要“Java++”的问题......）

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-06-18T10:30:15.810

可以使用带有初始化程序的匿名类在 Java 中翻译**with**语句：

```
Drink margarita = new DrinkBuilder() {{
    add(“tequila”);
    add(“orange liqueur”);
    add(“lime juice”);
    withRocks();
    withSalt();
}}.drink(); 
```

使用这个成语的缺点在[这里](https://stackoverflow.com/questions/924285/efficiency-of-java-double-brace-initialization)有很好的记录。

链式调用是方法链式的别名。这是众所周知的习语，适用于任何版本的 Java：

```
class Chained {

    public Chained withFoo() { 
        // ...
        return this;
    }

    public Chained withBar() { 
        // ...
        return this;
    }
} 
```

JDK 7 的一项提议是[允许链接方法也用于 void 返回类型](http://tech.puredanger.com/java7/#chained)：

```
class ChainedJava7 {

    public void withFoo() { 
        // ...
    }

    public void withBar() { 
        // ...
    }
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-18T10:24:16.040

[这](http://en.wikipedia.org/wiki/Fluent_interface)可能会让你感兴趣。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-06-18T10:33:49.063

我很喜欢`with`这种形式的陈述，但我更喜欢它们的 VB 版本：

```
With testObject
    .Height = 100
    .Text = "Hello, World"
    .ForeColor = System.Drawing.Color.Green
End With 
```

由于`With`块中的每个属性仍然必须以 a 开头，`.`因此您知道您引用的是 Object 属性而不是局部变量，从而减少了任何命名空间冲突。

如果我们以您的为例：

```
with (new DrinkBuilder()) {
    add(“tequila”);
    add(“orange liqueur”);
    add(“lime juice”);
    withRocks();
    withSalt();
    margarita = drink();
} 
```

没有简单的方法来判断`withSalt()`是本地类的方法`DrinkBuilder`还是本地类中的方法。如果您只允许块中的`with`-ed 对象的方法，`with`那么我认为它们变得不那么有用。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-18T10:23:04.047

我不喜欢使用`with`; 我更喜欢[Python`with`语句](http://www.python.org/dev/peps/pep-0343/)。不过，我确实同意你的`void`看法`void`。在您提供的示例中，如果一个人真的希望能够链接方法调用，他们应该只更改其方法的返回类型，以便它们是可链接的。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-06-18T11:42:16.413

也许对一个对象的多次调用表明某些代码需要移动？

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-06-18T12:53:21.683

Joshua Bloch 在[Effective Java](http://java.sun.com/docs/books/effective/) Item #2 中强烈建议在您有一个带有很多参数的构造函数时使用 Builder。一个原因是可以编写它来保证构建的对象始终处于一致状态。它还避免了在构建对象的类中具有复杂的“伸缩构造函数”。还有一个问题是，如果您希望构建的对象是不可变的（例如，为了线程安全），它不能有 setter 方法。

# java - Eclipse 无法解析同一命名空间中的枚举？

> ID：1011932
> 
> 赞同：1
> 
> 时间：2009-06-18T10:22:31.427
> 
> 标签：java, eclipse

我遇到了一个非常奇怪的问题，在 eclipse 中我有一个我已经工作了几个星期的代码库，它运行良好。我做了一个 svn 更新，突然之间我的一个类无法编译，因为它无法将同一命名空间中的枚举解析为一个类型。

我检查了 Java 版本并且我在 Java 6 下运行，所以应该支持枚举。

它也工作到昨天，现在它没有。

有没有其他人见过这种行为？我已经重新加载了eclipse，但除此之外我不知道从哪里开始诊断它。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-18T11:18:37.023

如果它确实说“步骤无法解析为一种类型”，只需尝试清理项目（项目 -> 清理）。Eclipse 有时会感到困惑，而清理通常会有所帮助。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-18T11:21:49.200

我最近有这个。原来有人提交了一些冲突的罐子（有一个以前的构建）并放在构建路径上。检查最近的提交以查看是否是问题所在，或者查看可能导致问题的原因。

但是，我肯定会首先在 Eclipse 中进行构建清理，并查看 ANT/Maven 是否受到影响（我假设您确实有这样的构建脚本）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-18T11:13:29.920

奇怪的想法，但可能是 Eclipse 正在尝试使用 1.4.2 编译器编译您的类并且不识别枚举？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-18T11:20:36.973

我卸载了项目并重新加载它，它就可以工作了......不知道原始问题是什么......

# python - 循环也访问上一个和下一个值

> ID：1011938
> 
> 赞同：101
> 
> 时间：2009-06-18T10:23:38.443
> 
> 标签：python, loops, iteration

如何遍历对象列表，访问上一个、当前和下一个项目？像 Python 中的这个 C/C++ 代码一样吗？

```
foo = somevalue;
previous = next = 0;

for (i=1; i<objects.length(); i++) {
    if (objects[i]==foo) {
        previous = objects[i-1];
        next = objects[i+1];
    }
} 
```

* * *

## 回答 #1

> 赞同：164
> 
> 时间：2009-06-18T11:12:58.690

到目前为止，解决方案只处理列表，并且大多数都是复制列表。以我的经验，很多时候这是不可能的。

此外，它们不处理您可以在列表中包含重复元素的事实。

您的问题的标题是“*循环内的上一个和下一个值*”，但如果您在循环内运行大多数答案，您最终将在每个元素上再次遍历整个列表以找到它。

所以我刚刚创建了一个函数。使用该[`itertools`](http://docs.python.org/library/itertools.html)模块，对可迭代对象进行拆分和切片，并生成包含前一个元素和下一个元素的元组。不完全是您的代码的作用，但值得一看，因为它可能可以解决您的问题。

```
from itertools import tee, islice, chain, izip

def previous_and_next(some_iterable):
    prevs, items, nexts = tee(some_iterable, 3)
    prevs = chain([None], prevs)
    nexts = chain(islice(nexts, 1, None), [None])
    return izip(prevs, items, nexts) 
```

然后在循环中使用它，您将在其中包含上一个和下一个项目：

```
mylist = ['banana', 'orange', 'apple', 'kiwi', 'tomato']

for previous, item, nxt in previous_and_next(mylist):
    print "Item is now", item, "next is", nxt, "previous is", previous 
```

结果：

```
Item is now banana next is orange previous is None
Item is now orange next is apple previous is banana
Item is now apple next is kiwi previous is orange
Item is now kiwi next is tomato previous is apple
Item is now tomato next is None previous is kiwi 
```

它适用于任何大小的列表（因为它不复制列表）和任何可迭代的（文件、集等）。这样您就可以遍历序列，并在循环中使用前一个和下一个项目。无需再次搜索序列中的项目。

代码的简短说明：

*   `tee`用于在输入序列上有效地创建 3 个独立的迭代器
*   `chain`将两个序列合二为一；它在这里用于将单元素序列附加`[None]`到`prevs`
*   `islice`用于制作除第一个以外的所有元素的序列，然后`chain`用于将 a 附加`None`到其末尾
*   现在有 3 个基于`some_iterable`该外观的独立序列：
    *   `prevs`：`None, A, B, C, D, E`
    *   `items`：`A, B, C, D, E`
    *   `nexts`：`B, C, D, E, None`
*   finally`izip`用于将 3 个序列变为一个三元组序列。

请注意，`izip`当任何输入序列用尽时停止，因此`prevs`将忽略 的最后一个元素，这是正确的 - 没有这样的元素，最后一个元素将是它的`prev`. 我们可以尝试从 中剥离最后的元素，`prevs`但`izip`

还要注意`tee`, `izip`,`islice`和`chain`来自`itertools`模块；它们在运行中（懒惰地）对其输入序列进行操作，这使它们变得高效，并且不需要随时将整个序列存储在内存中。

中`python 3`，导入时会报错`izip`，可以`zip`用`izip`. 无需导入`zip`，[源](https://github.com/weinbe58/QuSpin/issues/20)`python 3`内 预定义

* * *

## 回答 #2

> 赞同：121
> 
> 时间：2009-06-18T10:28:51.383

这应该可以解决问题。

```
foo = somevalue
previous = next_ = None
l = len(objects)
for index, obj in enumerate(objects):
    if obj == foo:
        if index > 0:
            previous = objects[index - 1]
        if index < (l - 1):
            next_ = objects[index + 1] 
```

这是有关该[`enumerate`](http://docs.python.org/library/functions.html#enumerate)功能的文档。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2015-09-22T10:40:53.257

使用列表推导，返回一个包含当前、前一个和下一个元素的 3 元组：

```
three_tuple = [(current, 
                my_list[idx - 1] if idx >= 1 else None, 
                my_list[idx + 1] if idx < len(my_list) - 1 else None) for idx, current in enumerate(my_list)] 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2019-06-18T17:19:02.913

我不知道这还没有出现，因为它只使用内置函数并且很容易扩展到其他偏移量：

```
values = [1, 2, 3, 4]
offsets = [None] + values[:-1], values, values[1:] + [None]
for value in list(zip(*offsets)):
    print(value) # (previous, current, next)

(None, 1, 2)
(1, 2, 3)
(2, 3, 4)
(3, 4, None) 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-06-18T11:29:11.137

这是一个使用没有边界错误的生成器的版本：

```
def trios(iterable):
    it = iter(iterable)
    try:
        prev, current = next(it), next(it)
    except StopIteration:
        return
    for next in it:
        yield prev, current, next
        prev, current = current, next

def find_prev_next(objects, foo):
    prev, next = 0, 0
    for temp_prev, current, temp_next in trios(objects):
        if current == foo:
            prev, next = temp_prev, temp_next
    return prev, next

print(find_prev_next(range(10), 1))
print(find_prev_next(range(10), 0))
print(find_prev_next(range(10), 10))
print(find_prev_next(range(0), 10))
print(find_prev_next(range(1), 10))
print(find_prev_next(range(2), 10)) 
```

请注意，边界行为是我们从不在第一个或最后一个元素中查找“foo”，这与您的代码不同。同样，边界语义很奇怪......并且很难从您的代码中理解:)

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2021-03-04T05:24:20.290

如果您只想迭代*具有*下一个和上一个元素的元素（例如，您想跳过第一个和最后一个元素）并且您的输入是一个列表，您可以[`zip`](https://docs.python.org/library/functions.html#zip)在没有第一个元素和没有第二个元素的情况下输入自身元素：

```
words = "one two three four five".split()

for prev, current, nxt in zip(words, words[1:], words[2:]):
    print(prev, current, nxt) 
```

输出：

```
one two three
two three four
three four five 
```

如果您不想跳过第一个和最后一个元素，并且希望在您位于第一个元素上时`prev`设置为（并且是最后一个元素），请先用这些值填充您的列表：`None``nxt``None`

```
words = "one two three four five".split()

padded_words = [None, *words, None]

for prev, current, nxt in zip(padded_words, padded_words[1:], padded_words[2:]):
    print(prev, current, nxt) 
```

输出：

```
None one two
one two three
two three four
three four five
four five None 
```

你可以用任何你想要的东西来填充。如果您希望您的列表“环绕”（例如，`prev`第一个元素的 是最后一个元素，`nxt`最后一个元素的 是第一个元素），请使用以下内容填充您的输入`None`：

```
# avoid IndexError if words is an empty list
padded_words = [words[-1], *words, words[0]] if words else [] 
```

输出：

```
five one two
one two three
two three four
three four five
four five one 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-06-18T11:02:48.973

使用条件表达式来简化 python >= 2.5

```
def prenext(l,v) : 
   i=l.index(v)
   return l[i-1] if i>0 else None,l[i+1] if i<len(l)-1 else None

# example
x=range(10)
prenext(x,3)
>>> (2,4)
prenext(x,0)
>>> (None,2)
prenext(x,9)
>>> (8,None) 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2019-05-08T15:56:08.583

对于正在寻找解决方案并希望循环元素的任何人，下面可能会起作用 -

```
from collections import deque  

foo = ['A', 'B', 'C', 'D']

def prev_and_next(input_list):
    CURRENT = input_list
    PREV = deque(input_list)
    PREV.rotate(-1)
    PREV = list(PREV)
    NEXT = deque(input_list)
    NEXT.rotate(1)
    NEXT = list(NEXT)
    return zip(PREV, CURRENT, NEXT)

for previous_, current_, next_ in prev_and_next(foo):
    print(previous_, current_, next) 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2020-09-10T17:21:24.573

两个简单的解决方案：

1.  如果必须定义前一个值和下一个值的变量：

```
alist = ['Zero', 'One', 'Two', 'Three', 'Four', 'Five']

prev = alist[0]
curr = alist[1]

for nxt in alist[2:]:
    print(f'prev: {prev}, curr: {curr}, next: {nxt}')
    prev = curr
    curr = nxt

Output[1]:
prev: Zero, curr: One, next: Two
prev: One, curr: Two, next: Three
prev: Two, curr: Three, next: Four
prev: Three, curr: Four, next: Five 
```

2.  如果列表中的所有值都必须由当前值变量遍历：

```
alist = ['Zero', 'One', 'Two', 'Three', 'Four', 'Five']

prev = None
curr = alist[0]

for nxt in alist[1:] + [None]:
    print(f'prev: {prev}, curr: {curr}, next: {nxt}')
    prev = curr
    curr = nxt

Output[2]:
prev: None, curr: Zero, next: One
prev: Zero, curr: One, next: Two
prev: One, curr: Two, next: Three
prev: Two, curr: Three, next: Four
prev: Three, curr: Four, next: Five
prev: Four, curr: Five, next: None 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2019-03-05T04:08:02.670

使用生成器，非常简单：

```
signal = ['→Signal value←']
def pniter( iter, signal=signal ):
    iA = iB = signal
    for iC in iter:
        if iB is signal:
            iB = iC
            continue
        else:
            yield iA, iB, iC
        iA = iB
        iB = iC
    iC = signal
    yield iA, iB, iC

if __name__ == '__main__':
    print('test 1:')
    for a, b, c in pniter( range( 10 )):
        print( a, b, c )
    print('\ntest 2:')
    for a, b, c in pniter([ 20, 30, 40, 50, 60, 70, 80 ]):
        print( a, b, c )
    print('\ntest 3:')
    cam = { 1: 30, 2: 40, 10: 9, -5: 36 }
    for a, b, c in pniter( cam ):
        print( a, b, c )
    for a, b, c in pniter( cam ):
        print( a, a if a is signal else cam[ a ], b, b if b is signal else cam[ b ], c, c if c is signal else cam[ c ])
    print('\ntest 4:')
    for a, b, c in pniter([ 20, 30, None, 50, 60, 70, 80 ]):
        print( a, b, c )
    print('\ntest 5:')
    for a, b, c in pniter([ 20, 30, None, 50, 60, 70, 80 ], ['sig']):
        print( a, b, c )
    print('\ntest 6:')
    for a, b, c in pniter([ 20, ['→Signal value←'], None, '→Signal value←', 60, 70, 80 ], signal ):
        print( a, b, c ) 
```

请注意，包含 None 和与信号值相同的值的测试仍然有效，因为对信号值的检查使用“is”并且信号是 Python 不实习的值。但是，任何单例标记值都可以用作信号，这在某些情况下可能会简化用户代码。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-06-18T10:49:16.413

您可以`index`在列表中使用来查找位置`somevalue`，然后根据需要获取上一个和下一个：

```
 def find_prev_next(elem, elements):
    previous, next = None, None
    index = elements.index(elem)
    if index > 0:
        previous = elements[index -1]
    if index < (len(elements)-1):
        next = elements[index +1]
    return previous, next

foo = 'three'
list = ['one','two','three', 'four', 'five']

previous, next = find_prev_next(foo, list)

print previous # should print 'two'
print next # should print 'four' 

```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2014-03-24T11:40:31.690

AFAIK 这应该很快，但我没有测试它：

```
def iterate_prv_nxt(my_list):
    prv, cur, nxt = None, iter(my_list), iter(my_list)
    next(nxt, None)

    while True:
        try:
            if prv:
                yield next(prv), next(cur), next(nxt, None)
            else:
                yield None, next(cur), next(nxt, None)
                prv = iter(my_list)
        except StopIteration:
            break 
```

示例用法：

```
>>> my_list = ['a', 'b', 'c']
>>> for prv, cur, nxt in iterate_prv_nxt(my_list):
...    print prv, cur, nxt
... 
None a b
a b c
b c None 
```

* * *

## 回答 #13

> 赞同：-1
> 
> 时间：2015-10-09T11:06:07.620

Pythonic和优雅的方式：

```
objects = [1, 2, 3, 4, 5]
value = 3
if value in objects:
   index = objects.index(value)
   previous_value = objects[index-1]
   next_value = objects[index+1] if index + 1 < len(objects) else None 
```

* * *

## 回答 #14

> 赞同：-1
> 
> 时间：2020-05-01T23:05:57.743

我认为这行得通，并不复杂

```
array= [1,5,6,6,3,2]
for i in range(0,len(array)):
    Current = array[i]
    Next = array[i+1]
    Prev = array[i-1] 
```

* * *

## 回答 #15

> 赞同：-2
> 
> 时间：2020-08-21T14:50:05.853

非常 C/C++ 风格的解决方案：

```
 foo = 5
    objectsList = [3, 6, 5, 9, 10]
    prev = nex = 0

    currentIndex = 0
    indexHigher = len(objectsList)-1 #control the higher limit of list

    found = False
    prevFound = False
    nexFound = False

    #main logic:
    for currentValue in objectsList: #getting each value of list
        if currentValue == foo:
            found = True
            if currentIndex > 0: #check if target value is in the first position   
                prevFound = True
                prev = objectsList[currentIndex-1]
            if currentIndex < indexHigher: #check if target value is in the last position
                nexFound = True
                nex = objectsList[currentIndex+1]
            break #I am considering that target value only exist 1 time in the list
        currentIndex+=1

    if found:
        print("Value %s found" % foo)
        if prevFound:
            print("Previous Value: ", prev)
        else:
            print("Previous Value: Target value is in the first position of list.")
        if nexFound:
            print("Next Value: ", nex)
        else:
            print("Next Value: Target value is in the last position of list.")
    else:
        print("Target value does not exist in the list.") 
```

# jquery - 有没有一种简单的方法可以将 jQuery 与 Simile Timeplots 一起使用？

> ID：1011944
> 
> 赞同：2
> 
> 时间：2009-06-18T10:25:27.177
> 
> 标签：jquery, simile

我为一个作为 jQuery 插件实现的[Simile Timeplot](http://www.simile-widgets.org/timeplot/)创建了一个加载器。这在 Firefox 中运行良好，但在 IE(8) 中无法正确加载。timeplot api 会加载时间线 api，而后者又会加载一些版本的 jQuery（可能是旧版本）。时间轴 jquery 参考混淆了 IE，它无法很好地显示图形。如果我没有在我的 html 中引用最新版本的 jQuery，那么我的加载器将失败，因为尚未加载或引用 jQuery。

[似乎](http://groups.google.co.uk/group/simile-widgets/browse_thread/thread/4eb02df298f707a7/084b957fbfdf82f4)有人愿意使用现代 jQuery 更新时间线/时间图，但与此同时，有没有人遇到过这个问题并找到了解决方法？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-08-13T19:55:25.653

好吧，这个问题帮助我赢得了风滚草徽章，最终我们得到了时间图。然而，今天我们完成了从 Timeplot 到 Flot 的迁移，我得说，如果你想结合 Timeplot 和 jQuery，不要这样做。使用 Flot，效果会更好。

# django - Django：知道属性是否是默认值

> ID：1011946
> 
> 赞同：1
> 
> 时间：2009-06-18T10:26:12.823
> 
> 标签：django, django-models

你怎么知道一个值是否是模型属性的默认值。

例如

```
class Alias(models.Model) :
  image = models.ImageField(upload_to='alias', default='/media/alias-default.png')

a = Alias.get("123")
# this doesn't work
if a.image == a.image.default :
  pass
# nor this
if a.image == Alias.image.default :
  pass 
```

我尝试在文档中挖掘，但没有看到任何东西。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-18T11:29:45.800

您无法从属性本身获取它，您必须通过`model._meta`.

```
a._meta.get_field_by_name('image')[0].get_default() 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-18T11:28:10.407

Django 中的`default`默认值与 SQL 默认值不同 - 它仅用于管理员在创建新对象时自动填充表单字段。

如果您想将某些内容与定义的值进行比较，`default`您必须在其他地方定义它（即在 中`settings.py`）。像：

```
class MyModel(models.Model):
    ...
    my_field = models.IntegerField(default=settings.INT_DEFAULT) 
```

该`default`值存储在其中，`MyModel._meta._fields()[field_creation_index].default`但请注意这是在挖掘内部结构。

# java - 我可以用@Autowire 注释继承的最终属性吗？

> ID：1011951
> 
> 赞同：5
> 
> 时间：2009-06-18T10:27:27.860
> 
> 标签：java, spring, annotations, ibatis

解决方案：不，我不再扩展原始父级。

原文：
有没有办法注释继承的`final`setter方法？我正在扩展一个具有`final`我想`@Autowire`使用 Spring 的 setter 的类。父类来自库，无法修改。

我发现的一种解决方法是编写一个代理方法，但这似乎比必要的工作更多。

```
public abstract class SqlMapClientDaoSupport ... {
    public final void setSqlMapClient(SqlMapClient smc) {
        ...
    }
}

@Component
public class AccountDao extends SqlMapClientDaoSupport {
    // all this just to annotate an existing method?
    @Autowire
    public final void setSqlMapClientWorkaround(SqlMapClient smc) {
        super.setSqlMapClient(smc);
    }
} 
```

***编辑 1：***修改了上面的示例以反映用例：
用例正在为 Ibatis/Spring 实现 DAO 对象，这些对象扩展了一个公共[基类](http://static.springframework.org/spring/docs/2.5.x/api/org/springframework/orm/ibatis/support/SqlMapClientDaoSupport.html)。每个 DAO 都需要相同的属性集，并且每个都需要配置为一个 bean。我目前通过在`applicationContext.xml`.

```
<bean id="accountDAO" 
  class="com.example.proj.dao.h2.AccountDAOImpl"
  p:sqlMapClient-ref="sqlMapClient" />
<bean id="companyDAO" 
  class="com.example.proj.dao.h2.CompanyDAOImpl"
  p:sqlMapClient-ref="sqlMapClient" />
<!-- etc... --> 
```

我更喜欢使用组件扫描来自动发现和自动连接 DAO 对象，我无法复制/粘贴这些对象。

```
<context:component-scan base-package="com.example.proj.dao.h2" /> 
```

我在[注释指南](http://java.sun.com/j2se/1.5.0/docs/guide/language/annotations.html)中看不到如何注释除声明位置之外的属性/成员。我希望这是我所缺少的。

***编辑 2：***我不再扩展 SqlMapClientDaoSupport 类，而是我的 AccountDao 是一个 POJO，它实现了 Support 类提供的小功能。这让我可以随意使用@Autowire。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-18T10:44:32.037

你试过用xml配置它吗？因为它是一个看起来无法更改的现有类，所以它是使用 xml 配置它的明确候选者。然后可以将其指定为“自动装配”，甚至可以在 xml 中配置属性。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-22T11:28:01.410

在我看来，您不应该尝试设置最终字段。

字段是最终的通常有一个很好的理由。

您是否设置了 SqlMapClientFactoryBean 对象？

看[这里寻求帮助](http://static.springframework.org/spring/docs/2.5.x/reference/orm.html#orm-ibatis-setup)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-09-15T04:07:56.850

不，没有办法注释继承的 final 方法。

`SqlMapClientDaoSupport`我没有扩展支持类（

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-02-11T23:28:11.393

您可以为所有最终的 setter 和`@Autowired`构造函数创建一个带有参数的新构造函数，然后在构造函数中调用 setter。

# windows - Windows 上的 Quicktime 播放延迟

> ID：1011973
> 
> 赞同：0
> 
> 时间：2009-06-18T10:31:39.613
> 
> 标签：windows, video, quicktime

我正在构建一个需要高播放性能的应用程序。我选择 Quicktime 作为视频引擎。我用不同的版本试验了不同的播放性能：

*   v7.1.3 性能最佳：QT播放器按播放，视频立即开始播放
*   较新的quicktime版本播放性能很差，从按下播放到有效视频播放的延迟约为400ms。有没有办法在最新版本中改善这种延迟？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-18T10:55:42.950

听起来你正在看到预缓存。你能调整缓存设置吗？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-05-06T20:41:41.573

我最终使用自定义库处理了声音，并仅将 QuickTime 用于同步视频显示。

# python - 如何使用机械化获取网页上的链接并打开这些链接

> ID：1011975
> 
> 赞同：3
> 
> 时间：2009-06-18T10:32:44.900
> 
> 标签：python, mechanize

我想用python的mechanize来获取页面的所有链接，然后打开链接。我该怎么做？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-06-18T10:53:11.163

这是项目[页面](http://wwwsearch.sourceforge.net/mechanize/)中的一个示例：

```
 import re
from mechanize import Browser

br = Browser()
br.open("http://www.example.com/")

# ...

# .links() optionally accepts the keyword args of .follow_/.find_link()
for link in br.links(url_regex="python.org"):
    print link
    br.follow_link(link)  # takes EITHER Link instance OR keyword args
    br.back() 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-18T10:51:03.523

中的`Browser`对象`mechanize`有一个`links`方法可以检索页面上的所有链接。

# php - 让网站自动选择 WAP 版还是普通版？

> ID：1011977
> 
> 赞同：1
> 
> 时间：2009-06-18T10:33:44.993
> 
> 标签：php, xml, apache, wap, wml

我有一个网站，根文件夹中有以下文件： index.wml index.php

如果您通过非 wap 浏览器访问，我如何让它打开 index.php，但当它是 wap 浏览器时自动打开 index.wml。我怀疑 .htaccess 文件中必须包含某些内容？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-18T11:05:56.207

我建议您使用[移动设备浏览器文件](http://mdbf.codeplex.com/)。这是一个包含大量已知设备功能信息的数据库。尽管它是为在 ASP.NET 应用程序中使用而创建的，但它是一个 XML 文件，因此您也可以从 PHP 中使用它（查看文件[架构](http://msdn.microsoft.com/en-us/library/ms228122.aspx)）。

我强烈建议您使用功能来决定如何将内容发送到设备，而不是任何简单的“ `if not desktop and not laptop then send_wap()`”。查看[包含的功能列表](http://mdbf.codeplex.com/Wiki/View.aspx?title=capabilities&referringTitle=Home)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-18T10:39:28.913

您可以在 index.php 中通过用户代理切换和将 wap 浏览器重定向到 index.wml 来完成此操作，但我不知道 wap 浏览器在其用户代理字符串中报告什么。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-18T10:40:31.407

看看这个脚本：

[http://tom.anu007.googlepages.com/wapredirect](http://tom.anu007.googlepages.com/wapredirect)

允许您根据浏览器指定不同的重定向。

乔什

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-18T10:48:43.463

如果它只是您想要以不同格式（WAP 和 PHP）呈现的一个页面，请尝试添加一个“手持式”样式表来重新格式化页面和/或隐藏 WAP 浏览器的元素和 div。

```
<link rel="stylesheet" type="text/css" media="handheld" href="wap.css"> 
```

否则，您将不得不使用重定向脚本，例如 Josh 链接的那个。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-06-18T11:13:09.703

这可以通过 mod_rewrite 来完成。

```
RewriteCond %{HTTP_ACCEPT} application/vnd\.wap\.xhtml\+xml [OR]
RewriteCond %{HTTP_ACCEPT} text/vnd\.wap\.wml
RewriteRule ^index\.php http://host.com/index.wml [L,QSA,R] 
```

# git - Git 中的行尾搞砸了——如何在一个巨大的行尾修复后跟踪另一个分支的更改？

> ID：1011985
> 
> 赞同：24
> 
> 时间：2009-06-18T10:37:45.937
> 
> 标签：git, history, rewrite, branch, newline

我们正在使用定期更新的第 3 方 PHP 引擎。版本保存在 git 中的一个单独分支上，我们的 fork 是主分支。

通过这种方式，我们将能够从新版本的引擎中将补丁应用到我们的 fork。

我的问题是，在多次提交到我们的分支之后，我意识到引擎的初始导入是使用 CRLF 行结尾完成的。

我将每个文件都转换为 LF，但这带来了巨大的提交，删除了 100k 行并添加了 100k 行，这显然破坏了我们的意图：轻松合并来自该 3rd 方引擎的工厂版本的补丁。

我该知道什么？我怎样才能解决这个问题？我的分叉上已经有数百个提交。

好的是在初始导入之后和分支我们自己的分叉之前以某种方式进行行尾修复提交，并在历史后期删除那个巨大的行尾提交。

但是我不知道如何在 Git 中做到这一点。

谢谢！

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2009-06-29T22:08:31.437

我终于设法解决了。

答案是：

```
git filter-branch --tree-filter '~/Scripts/fix-line-endings.sh' -- --all 
```

fix-line-endings.sh 包含：

```
#!/bin/sh
find . -type f -a \( -name '*.tpl' -o -name '*.php' -o -name '*.js' -o -name '*.css' -o -name '*.sh' -o -name '*.txt' -iname '*.html' \) | xargs fromdos 
```

在所有提交中的所有树中修复了所有行尾之后，我进行了交互式 rebase 并删除了所有修复行尾的提交。

现在我的回购是干净和新鲜的，可以推送了:)

**访客注意：如果您的回购已被推送/克隆，请不要这样做，因为它会严重搞砸！**

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-06-18T10:41:36.553

你看了`git rebase`吗？

您将需要重新建立存储库的历史记录，如下所示：

*   提交行终止符修复
*   开始变基
*   先离开第三方导入提交
*   应用行终止符修复
*   应用你的其他补丁

* * *

但是，您需要了解的是，这将*破坏*所有下游存储库 - 那些从您的父存储库克隆的存储库。理想情况下，您将从头开始。

* * *

*更新*：示例用法：

```
target=`git rev-list --max-count=3 HEAD | tail -n1`
get rebase -i $target 
```

将为最后 3 次提交启动一个 rebase 会话。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2010-01-08T18:25:43.843

展望未来，避免使用`core.autocrlf`设置出现此问题，记录在[`git config --help`](http://git-scm.com/docs/git-config)：

> *核心.autocrlf*
> 
> 如果为 true，则在从文件系统读取时使 git`CRLF`在文本文件的行尾转换为`LF`，并在写入文件系统时反向转换。该变量可以设置为，在这种情况下，转换仅在从文件系统读取时发生，但文件在行尾`input`写出。`LF`一个文件被认为是“文本”（*即*受制于该`autocrlf`机制）基于文件的`crlf`属性，或者如果`crlf`未指定，则基于文件的内容。请参阅[gitattributes](http://git-scm.com/docs/gitattributes)。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-06-18T12:01:57.247

一种解决方案（不一定是最好的）是使用[git-filter-branch](http://git-scm.com/docs/git-filter-branch)重写历史以始终使用正确的行尾。这应该是交互式 rebase 的更好解决方案，至少对于大量提交而言；使用 git-filter-branch 处理合并也可能更容易。

这当然是假设历史*没有发布*（存储库没有克隆）。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2010-01-09T11:25:40.610

我们在未来通过以下方式避免这个问题：

1）每个人都使用一个去除尾随空格的编辑器，我们用 LF 保存所有文件。

2) 如果 1) 失败（它可以 - 有人出于某种原因不小心将其保存在 CRLF 中），我们有一个预提交脚本来检查 CRLF 字符：

```
#!/bin/sh
#
# An example hook script to verify what is about to be committed.
# Called by git-commit with no arguments.  The hook should
# exit with non-zero status after issuing an appropriate message if
# it wants to stop the commit.
#
# To enable this hook, rename this file to "pre-commit" and set executable bit

# original by Junio C Hamano

# modified by Barnabas Debreceni to disallow CR characters in commits

if git rev-parse --verify HEAD 2>/dev/null
then
    against=HEAD
else
    # Initial commit: diff against an empty tree object
    against=4b825dc642cb6eb9a060e54bf8d69288fbee4904
fi

crlf=0

IFS="
"
for FILE in `git diff-index --cached $against`
do
    fhash=`echo $FILE | cut -d' ' -f4`
    fname=`echo $FILE | cut -f2`

    if git show $fhash | grep -EUIlq $'\r$'
    then
        echo $fname contains CRLF characters
        crlf=1
    fi
done

if [ $crlf -eq 1 ]
then
    echo Some files have CRLF line endings. Please fix it to be LF and try committing again.
    exit 1
fi

exec git diff-index --check --cached $against -- 
```

该脚本使用 GNU grep，并且可以在 Mac OS X 上运行，但是在其他平台上使用之前应该对其进行测试（我们遇到了 Cygwin 和 BSD grep 的问题）

3）如果我们发现任何空白错误，我们对错误文件使用以下脚本：

```
#!/usr/bin/env php
<?php

    // Remove various whitespace errors and convert to LF from CRLF line endings
    // written by Barnabas Debreceni
    // licensed under the terms of WFTPL (http://en.wikipedia.org/wiki/WTFPL)

    // handle no args
    if( $argc <2 ) die( "nothing to do" );

    // blacklist

    $bl = array( 'smarty' . DIRECTORY_SEPARATOR . 'templates_c' . DIRECTORY_SEPARATOR . '.*' );

    // whitelist

    $wl = array(    '\.tpl', '\.php', '\.inc', '\.js', '\.css', '\.sh', '\.html', '\.txt', '\.htc', '\.afm',
                    '\.cfm', '\.cfc', '\.asp', '\.aspx', '\.ascx' ,'\.lasso', '\.py', '\.afp', '\.xml',
                    '\.htm', '\.sql', '\.as', '\.mxml', '\.ini', '\.yaml', '\.yml'  );

    // remove $argv[0]
    array_shift( $argv );

    // make file list
    $files = getFileList( $argv );

    // sort files
    sort( $files );

    // filter them for blacklist and whitelist entries

    $filtered = preg_grep( '#(' . implode( '|', $wl ) . ')$#', $files );
    $filtered = preg_grep( '#(' . implode( '|', $bl ) . ')$#', $filtered, PREG_GREP_INVERT );

    // fix whitespace errors
    fix_whitespace_errors( $filtered );

    ///////////////////////////////////////////////////////////////////////////////////////////////
    ///////////////////////////////////////////////////////////////////////////////////////////////

    // whitespace error fixer
    function fix_whitespace_errors( $files ) {
        foreach( $files as $file ) {

            // read in file
            $rawlines = file_get_contents( $file );

            // remove \r
            $lines = preg_replace( "/(\r\n)|(\n\r)/m", "\n", $rawlines );
            $lines = preg_replace( "/\r/m", "\n", $lines );

            // remove spaces from before tabs
            $lines = preg_replace( "/\040+\t/m", "\t", $lines );

            // remove spaces from line endings
            $lines = preg_replace( "/[\040\t]+$/m", "", $lines );

            // remove tabs from line endings
            $lines = preg_replace( "/\t+$/m", "", $lines );

            // remove EOF newlines
            $lines = preg_replace( "/\n+$/", "", $lines );

            // write file if changed and set old permissions
            if( strlen( $lines ) != strlen( $rawlines )){

                $perms = fileperms( $file );

                // Uncomment to save original files

                //rename( $file, $file.".old" );
                file_put_contents( $file, $lines);
                chmod( $file, $perms );
                echo "${file}: FIXED\n";
            } else {
                echo "${file}: unchanged\n";
            }

        }
    }

    // get file list from argument array
    function getFileList( $argv ) {
        $files = array();
        foreach( $argv as $arg ) {
          // is a direcrtory
            if( is_dir( $arg ) )  {
                $files = array_merge( $files, getDirectoryTree( $arg ) );
            }
            // is a file
            if( is_file( $arg ) ) {
                $files[] = $arg;
            }
        }
        return $files;
    }

    // recursively scan directory
    function getDirectoryTree( $outerDir ){
        $outerDir = preg_replace( ':' . DIRECTORY_SEPARATOR . '$:', '', $outerDir );
        $dirs = array_diff( scandir( $outerDir ), array( ".", ".." ) );
        $dir_array = array();
        foreach( $dirs as $d ){
            if( is_dir( $outerDir . DIRECTORY_SEPARATOR . $d ) ) {
                $otherdir = getDirectoryTree( $outerDir . DIRECTORY_SEPARATOR . $d );
                $dir_array = array_merge( $dir_array, $otherdir );
            }
            else $dir_array[] = $outerDir . DIRECTORY_SEPARATOR . $d;
        }
        return $dir_array;
    }
?> 
```

# javascript - jQuery 的 slideToggle 在 IE8 中同时进行 slideDown 和 slideUp

> ID：1011987
> 
> 赞同：0
> 
> 时间：2009-06-18T10:39:15.403
> 
> 标签：javascript, jquery, effects

我在这里上传了我的问题：http: [//gotchance.com/k2/](http://gotchance.com/k2/)

尝试单击“登录”链接。它在 FF 和 Safari 中运行良好。但是在 IE8 中，表单会向下滑动，然后再自动向上滑动。

出于测试目的，我又添加了 4 个“测试”链接，发现只有 #navigation div 中的链接会导致此问题。

此外，如果我使用“按钮”“输入”之类的任何其他元素进行切换，它工作正常。只有“#navigation”中的“a”标签会导致问题。

有任何想法吗 ？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-18T14:53:38.227

我看到的一个问题是您的 custom.js 文件中有一个额外的逗号。额外的逗号在第 25 行。

前：

```
 confirm: {
            required: true,
            equalTo: "#rpassword"
        },
    }, 
```

后：

```
confirm: {
            required: true,
            equalTo: "#rpassword"
        }
    }, 
```

我不知道这是否会解决你的问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-18T15:57:44.487

您的 html 未验证。始终确保首先通过[w3c 验证器](http://validator.w3.org)运行它。一个无效的 dom 可以和 jquery 选择器一起玩地狱（尤其是在 ie 中）。

另外我注意到圆角和字体插件会产生一些奇怪的标记，这也可能导致问题。

您是否尝试过将页面剥离到其裸露的骨骼，然后一次添加一个功能，以确保在每一步之后您的切换正常工作。

# .net - 价格追踪应用：最佳实践

> ID：1011990
> 
> 赞同：0
> 
> 时间：2009-06-18T10:39:41.470
> 
> 标签：.net, charts

我正在开发一个价格跟踪应用程序，该应用程序从不同的在线商店收集数据并将它们重新映射到我们自己的产品数据库。我们已经在收集价格及其检索日期。

我们对这些数据的第一次展示是检索平均价格以及价格和时间之间的折线图形式的价格，我们想看看价格如何随时间变化。

我的问题是，存储和检索这些历史数据（为了制图）的最佳实践是什么？我目前有几件事：

*   创建一个外部应用程序，该应用程序将从数据库中检索值，生成包含所需数据的非规范化文件，并清除数据库（以使其保持小）
*   将文件公开为 JSON 以便于客户端检索（而不是服务器生成以减少负载）

平台：IIS、ASP.NET、SQL Server 2005

我们目前正在将 Google Charting API 用于应用程序的其他部分，这可能会被考虑在内。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-18T10:52:39.930

Martin Fowler 有一篇很好的文章处理[随时间变化的事物](http://martinfowler.com/ap2/timeNarrative.html)。它可能会给你一些启发。

乍一看，存储似乎很明显：带有 ID、[GTIN](http://en.wikipedia.org/wiki/GTIN')（或您用来跟踪产品的任何其他内容）、日期和价格的表格。因此，为图表提取数据是微不足道的：选择一个或多个 GTIN 的价格范围并将它们绘制到图表上。

# objective-c - 在Objective-C中将字符串与数组进行比较

> ID：1011996
> 
> 赞同：6
> 
> 时间：2009-06-18T10:42:15.770
> 
> 标签：objective-c, arrays, string, comparison

这是一个非常基本的问题，我相信您将能够快速回答。请不要嘲笑我的无知。

我有一个字符串，我想将其与字符串数组进行比较。只有当字符串不是数组的一部分时，我才想执行操作。我尝试了以下代码，但不起作用。我明白为什么，但我就是想不出一种正确的方法。

请帮助我摆脱痛苦。

提前致谢

夏克连

```
-(void) findRedundant: (NSString *) aString {
#define ALPHA_ARRAY [NSArray arrayWithObjects: @"A", @"B", @"C", nil]   
    NSUInteger f;
    for (f = 0; f < [ALPHA_ARRAY count]; f++) 
    {
        NSString * stringFromArray = [ALPHA_ARRAY objectAtIndex:f];
        if ([aString isEqualToString:stringFromArray]) {
            // do nothing

        } else {
            //do something
        }

    }

}

[self findRedundant:@"D"]; 
```

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-06-18T11:56:03.610

您的代码似乎工作正常。它的代码很糟糕，但它工作正常，任何匹配都会调用 // do nothing 部分，而数组中的每个不匹配都会调用 // do something 部分。我怀疑问题是你期望 // do nothing 部分在没有匹配时执行一次，并且 // do something 部分在有任何匹配时执行一次，但事实并非如此。你可能想要：

```
-(void) findRedundant: (NSString *) aString {
#define ALPHA_ARRAY [NSArray arrayWithObjects: @"A", @"B", @"C", nil]
    BOOL found = NO;
    NSUInteger f;
    for (f = 0; f < [ALPHA_ARRAY count]; f++) {
        NSString * stringFromArray = [ALPHA_ARRAY objectAtIndex:f];
        if ([aString isEqualToString:stringFromArray]) {
            found = YES;
            break;
        }
    }
    if ( found ) {
        // do found
    } else {
        // do not found
    }
} 
```

此外，您显然不了解宏以及何时应该和不应该使用它们（通常，您不应该使用它们，只有极少数例外）。宏在文本中替换为您的代码。**这意味着每次**使用 ALPHA_ARRAY时都会发生数组创建和初始化。这真糟糕。

基本上，在您对自己正在做的事情有更深入的了解之前，永远不要再次使用#define（常量除外）。在这种情况下，您将按照 taebot 的描述创建数组：

```
NSArray* alphaArray = [NSArray arrayWithObjects: @"A", @"B", @"C", nil]; 
```

接下来，如果您正在为现代平台（10.5 或 iPhone）进行开发，您可以使用更容易阅读的快速枚举：

```
-(void) findRedundant: (NSString *) aString {
    NSArray* alphaArray = [NSArray arrayWithObjects: @"A", @"B", @"C", nil];
    BOOL found = NO;
    for ( NSString* stringFromArray in alphaArray ) {
        if ([aString isEqualToString:stringFromArray]) {
            found = YES;
            break;
        }
    }
    if ( found ) {
        // do found
    } else {
        // do not found
    }
} 
```

最后，您应该阅读有关 NSArray 和 NSString 的文档，看看您可以免费做什么，然后您会找到 KiwiBastard 指出的 containsObject 等方法，您可以将例程重写为：

```
-(void) findRedundant: (NSString *) aString {
    NSArray* alphaArray = [NSArray arrayWithObjects: @"A", @"B", @"C", nil];
    if ( [alphaArray containsObject: aString] ) {
        // do found
    } else {
        // do not found
    }
} 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-06-18T10:57:21.963

我不确定为什么您上面的代码不起作用，但是您是否尝试过：

```
if ([ALPHA_ARRAY containsObject:aString]) 
```

如果 aString 存在则返回 YES 否则返回 NO

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-06-18T11:15:26.030

#define 对我来说看起来很奇怪。我认为每次使用 ALPHA_ARRAY 都会创建一个不同的 NSArray 实例。在 NSArray 上使用 containsObject: 方法会更干净：

```
NSArray* alphaArray = [NSArray arrayWithObjects: @"A", @"B", @"C", nil];
if (![alphaArray containsObject:aString]) {
    // do something
} 
```

# agile - 使用 Open Flash Chart 2 创建燃尽图的技巧

> ID：1011999
> 
> 赞同：1
> 
> 时间：2009-06-18T10:42:51.573
> 
> 标签：agile, open-flash-chart, burndowncharts

我将为我们的项目管理系统实施燃尽图。它将使用[Open Flash Chart 2](http://teethgrinder.co.uk/open-flash-chart-2/)

系统知道项目何时开始以及预计何时完成。它还知道故事点以及每个故事点需要多少小时。

用户每天写下他们在分配的每个故事点上工作了多少小时。

从我看过的图表来看，它们通常显示每天的状态。以及预计的完成日期。

1.  我应该期望每天是 8 小时还是 8 小时 * 用户工作。
    或者我应该只显示剩余的小时数并让图表自行正常化（因为许多用户可以在开始时使用它而在最后很少使用（或相反）
2.  有没有人在打开的 flash 图表 2 中创建了燃尽图，您是否还有其他创建类似内容的提示。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-27T01:29:03.343

关于组成冲刺的小时数和持续时间的决定应该在冲刺计划阶段完成。显然，您拥有的资源数量和他们每天的可用时间将决定总持续时间。一旦您开始创建和更新燃尽图，您将显示每天剩余的总小时数，而不是分解每天的小时数或资源数；这与剩余的努力无关（尽管显然与在冲刺期内完成该努力的能力有关）。

您提出的问题是速度之一；你需要决定你是在以恒定的速度工作（在 sprint 期间使用相同的可用资源）还是以可变的速度工作（例如，预先提供更多资源）。大多数燃尽图显示一条“稳定的步伐”线，因此您可能只需要考虑这在变速冲刺中是什么样子的。恐怕我不能直接对 Open Flash Charts 发表评论，但希望上面的其他信息有用。