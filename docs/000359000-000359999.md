# StackOverflow 问答 000359000-000359999

# development-environment - 在单个虚拟机中完成*所有*工作的任何提示？

> ID：359005
> 
> 赞同：6
> 
> 时间：2008-12-11T11:05:31.030
> 
> 标签：development-environment, vmware, virtualization

我最近买了一台新的 Vista PC，但在让一切正常工作时遇到了很多问题，所以我继续在我已经使用多年的慢速 XP 机器上完成大部分工作（开发和其他）。

直到现在，我使用 VMware Convertor 为我的旧 XP 机器拍摄映像，现在我在我的 Vista 机器上运行它，并且在那个 XP 虚拟机中完成了我几乎所有的工作。我正在使用 VMware Worstation。

**所以每天早上我启动我的 Vista 机器，然后启动我的 XP 虚拟机，并在 XP 虚拟机上工作一整天。**

是的，您可能会猜到：我与 VMware 高级用户完全相反……我还没有想出快照、链接克隆或运行 VM 的绝对基础知识以外的任何东西。但是我把这个系统设置好了，而且运行良好。无论如何，一切都比在我的旧机器上运行得快得多。

但是，我担心虚拟机被损坏或什么东西导致我失去一切。当然我可以备份整个虚拟机，我可以从虚拟机上备份文件，我会的，但**我想知道使用映射驱动器或公用文件夹或其他东西是否更容易和更安全工作**，所以如果 XP VM 失败，我的文件都可以从 Vista 机器上获得。

这也很好，因为我可以在 Vista 和 XP 机器之间轻松共享文件（我确实使用 Vista 来做奇怪的事情）。但我想知道它是否会使从我的 XP 机器上读写文件变得更慢？（例如，如果我正在编译一个大型 Java 项目，这将同时涉及大量 IO。）

关于*如何*设置这些东西的信息很容易获得，但我发现找出我正在做的事情的最佳方法并不容易。大多数人将虚拟机用于比我更高级的目的。

此外，我想知道对于这种“全能工作”的 VM 类型设置是否还有其他提示或重要考虑因素？例如，什么可能会出错，我该如何避免呢？还要别的吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-11T11:12:02.873

当然，如果您在 VM 中完成**所有**工作，那么是时候考虑将主机更改为可用的了，不是吗？

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-11T11:14:21.637

我家里有一个 Ubuntu Linux 盒子，里面有三个虚拟机，都是完全独立的。

第一个是我妻子的生意，她需要访问所有 MS Office 的东西和 MYOB。

第二个是工作，他们太紧了，不能给我买一台笔记本电脑，我不会让他们在我的真实盒子上安装他们可怕的安全和自动更新产品。

第三个是我的 Visual Studio 开发 VM。

它像梦一样运行（尽管一次只测试过一个虚拟机）。我只是从 Ubuntu 备份所有 VM 文件（以及我的 Linux 工作），这基本上为我提供了 VM 硬盘驱动器的图像。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-11T11:59:06.333

正如其他人所指出的那样，是时候考虑将您的主机操作系统更改为您熟悉且可以完成工作的操作系统了。根据您每天在机器上所做的事情，我敢打赌 Vista 将不仅仅是一个大障碍。**为什么要在Vista 仅用于在VMware 中完成所有**工作的野兽之上运行VMware 来增加您的工作和您自己的负担？

话虽如此，我还是建议您查看 VMware[快照](http://www.vmware.com/support/ws55/doc/ws_clone_overview.html)和[克隆](http://www.vmware.com/support/ws55/doc/ws_clone_overview.html)。这两个是强大的功能，尤其是在您的情况下，除了解决您在 VMware 中运行任何操作系统时可能遇到的许多常见问题外，它还可以用来避免很多常见问题。

我偶尔会执行一次粗略的备份，使用 7-zip 之类的工具在磁盘上压缩 VMware 映像，然后将它们存储在备份媒体上。但是，对于系统内的备份或还原点，VMware 的链接克隆绝对是一个方便的功能——因为 Windows 经常容易受到损坏/感染，通过链接克隆，您可以很确定您可以轻松恢复到上一个在腐败发生之前的状态，并从那里畅通无阻地继续您的工作。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-12T05:58:35.033

几年来，我一直在工作中使用 VMWare。我用它来开发和测试。只要您的基础 PC 足够好，它就是分离“PC Life”的好方法。

我肯定会将您的数据文件存储在某处的服务器上。这可以是映射驱动器、源代码控制或其他任何东西。当您开始使用快照时，擦除会话非常容易，因此将您的基础 PC 视为一种 NAS 可以避免这个问题。

我现在决定在家里开始使用 VMWare。我有一个用于业务应用程序（Office、QuickBooks 等）的 VM，一个用于 Visual Studio 开发，还有几个用于 Web 服务器、sql 服务器等。我的基本 PC 有 8GB RAM 和 2.8GHz 四核处理器，因此运行四个或更多 VM没问题。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-14T22:29:01.033

> 我想知道在我的所有工作中使用映射驱动器或公用文件夹或其他东西是否更容易和更安全

如果您主要使用文本文件，请使用版本控制系统（也已备份）。可以访问映射的驱动器或公用文件夹，但不是最佳方式。

# javascript - 为什么在 JavaScript 中使用 moveTo 会出错？

> ID：359020
> 
> 赞同：1
> 
> 时间：2008-12-11T11:14:05.223
> 
> 标签：javascript, internet-explorer, internet-explorer-7

我正在使用 var myWindow = window.open(...) 从按钮打开一个新窗口。然后我想将该窗口移动到屏幕上的正确位置。我使用 myWindow.moveTo(10,10) 来执行此操作，但我收到拒绝访问错误。

我打开的窗口包含从另一台服务器到我正在执行的服务器的信息。如果不是，则窗口正确移动。这是限制吗？有办法解决吗？

我正在使用 IE7。（这项工作适用于包含大量 ActiveX 的现有 Intranet，因此所有用户都使用 IE7）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-11T11:19:54.603

您可以尝试将来自其他站点的信息放在运行 window.open JavaScript 的同一主机上的 iframe 中。或者甚至更好，获取信息服务器端并直接从您的站点呈现。iframe 可能会很麻烦。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-11T11:18:59.067

> 我打开的窗口包含从另一台服务器到我正在执行的服务器的信息。如果不是，则窗口正确移动。这是限制吗？有办法解决吗？

在过去的几年里，浏览器的安全模型越来越受到限制。几年前你能做的，现在不允许了。归咎于广告公司。

# database - DAAB，使用数据库实例的最佳方法是

> ID：359028
> 
> 赞同：4
> 
> 时间：2008-12-11T11:21:55.847
> 
> 标签：database, enterprise-library, daab

伙计们，我将使用 Enterprise Library (4.1)，尤其是 DAAB。这是我有问题：

1.  什么是最好的方法，为什么：

    *   每次需要运行 DbCommand 时，我都会使用 DatabaseFactory.CreateDatabase(); 创建数据库实例。

    *   我有一个带有实例数据库的基类（使用相同的 CreateDatabase() 静态方法）和返回实例数据库的公共属性之类的东西。

2.  创建数据库类的实例有多“重”或快/慢？如果每次需要 DbCommand 时我都这样做会怎样？

谢谢你。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2014-01-31T14:32:15.223

这算不上问题。创建数据库类的开销很低。

但是，实际创建数据库连接的开销很大，这就是 Windows 使用连接池的原因。简而言之，进程第一次创建数据库连接时，它会在连接池中查找具有完全相同连接字符串的现有连接。如果找不到，它会创建一个新的（昂贵的操作）。当进程关闭它并让它超出范围时，它实际上并没有关闭与数据库的连接，而是将其放入连接池中。直到同一个进程使用相同的连接字符串创建另一个连接为止。然后它会为您提供连接池中已经存在的一个。

您可以关闭连接池（通过连接字符串中的设置），但这通常是一个非常糟糕的主意。

# php - PHP文件上传问题

> ID：359029
> 
> 赞同：0
> 
> 时间：2008-12-11T11:23:12.460
> 
> 标签：php, file-upload

我的 PHP 脚本有一个非常奇怪的问题。

我正在上传几个文件并让 PHP 将它们全部放在一个文件夹中。我在发送随机文件和不发送随机文件时遇到问题。所以我调试了它，我从 $_FILES[] 数组中得到了一个非常奇怪的结果。

我用3个文件试了一下。

`$_FILES["addFile"]["name"]`保存 3 个文件的名称。

您希望`$_FILES["addFile"]["tmp_name"]`保留 PHP 用来复制文件的 3 个临时名称，但事实并非如此。它只有一个名字。其他 2 个是空字符串，在上传时会产生错误（我禁止显示）

这很奇怪。我尝试了多种情况，但它一直在发生。这一定是我的设置甚至我的代码中的某些内容。

这是我的代码：

```
$i = 0;
  if (!empty($_FILES['addFile'])) {
    foreach($_FILES['addFile'] as $addFile) {
      $fileToCopy = $_FILES["addFile"]["tmp_name"][$i];
      $fileName   = $_FILES["addFile"]["name"][$i];
      $i++;
      if(!empty($fileToCopy)){
       $copyTo = $baseDir."/".$fileName;
       @copy($fileToCopy, $copyTo) or die("cannot copy ".$fileToCopy." to ".$copyTo);
      }
     }
          exit(0);
   } 
```

由于 tmp_name 为空，if-value 将为 false，因此它将跳过 die() 函数。

有谁知道可能是什么原因造成的？

更多信息：我使用的是 Windows XP，运行 WAMP 服务器。以前从未遇到过这个问题，我可以访问我尝试上传的所有地图。我认为Windows的安全设置不是问题。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-11T11:50:28.817

很抱歉，但我觉得您正在尝试上传具有相同变量名的所有 3 个文件？这是正确的吗？但这不起作用，因为它们会相互覆盖。我认为使用类似的东西会更好更清洁的方式

```
 $i = 0;
    foreach($_FILES['addFile'.$i] as $addFile) {
     if(!empty($addFiles) {
        move_uploaded_file($addFile['temp_name'], 'YOUR DIRECTORY');
     }
      $i++;
   } 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-11T11:28:44.180

相关，但可能无济于事：但是 move_uploaded_file 是一种（稍微）更好的处理上传文件的方法，而不是复制。

任何文件都很大吗？PHP 对文件大小和上传文件的时间有限制......

最好把你送到这里，而不是试图写下它所说的：

[http://uk3.php.net/manual/en/features.file-upload.common-pitfalls.php](http://uk3.php.net/manual/en/features.file-upload.common-pitfalls.php)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-11T11:34:54.980

您的循环逻辑不正确。您直接在文件输入名称上使用了 foreach 循环，它存储了几个您不感兴趣的属性（“类型”、“大小”等）。

您应该从第一个文件中获取文件计数并将其用作循环长度：

```
if (!empty($_FILES['addFile']) && is_array($_FILES['addFile']['name'])) {
    $length = count($_FILES['addFile']['name']);
    for($i = 0; $i < $length; $i++) {
        $result = move_uploaded_file($_FILES['addFile']['tmp_name'][$i],$baseDir."/" . $_FILES['addFile']['name'][$i]);
         if($result === false) {
            echo 'File upload failed. The following error has occurred: ' . $_FILES['addFile']['error'][$i];
         }
     }
} 
```

如果您仍然遇到问题，请检查错误代码，它应该提供调试它所需的所有信息。

# php - PDFLib：无法打开 PDF 文件

> ID：359031
> 
> 赞同：1
> 
> 时间：2008-12-11T11:24:06.420
> 
> 标签：php, pdflib

以下是我用来打开 PDF 文件的 PHP 代码行：

```
$pdf_generartor = new PDFlib();

$doc = $pdf_generartor -> open_pdi_document("Report.pdf", "") or die ("ERROR: " . $pdf_generartor -> get_errmsg()); 
```

尽管该文件位于所需位置，但每次我收到以下错误时：

```
ERROR: Couldn't open PDF file 'Report.pdf' for reading (file not found) 
```

有人熟悉可能的解决方案吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2010-09-08T13:54:37.790

我知道这有点过时了，但我自己遇到了这个问题并设法“修复”它。显然 PDF 库不能很好地理解相对路径，因此您必须使用 realpath()。

查看示例时，您可以通过两种方式执行此操作。您可以将 realpath() 与实际文件路径一起使用，也可以将 realpath() 与“搜索目录”一起使用。

```
$p = new PDFlib();
$p->set_parameter("SearchPath", realpath("data/")); 
```

或者：

```
$indoc = $p->open_pdi_document(realpath($infile), ""); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-11T11:31:37.840

我认为您只是将文件放在错误的位置。

请记住，如果它是 linux，它区分大小写。

如果您的代码在包含的文件等中，如果您相对使用它，则在计算路径时需要牢记这一点。

尝试

```
echo realpath('Report.pdf'); 
```

它将输出 PHP 将 Report.pdf 转换为的路径，并且可能会帮助您找出出错的原因。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-22T04:51:22.447

尝试从不同的路径提供文件，甚至提到目录：

```
 $doc = $pdf_generartor->open_pdi_document("D:\\Report.pdf", "") or die ("ERROR:") 
```

# php - 为一个站点设置两个 CMS，最佳实践

> ID：359032
> 
> 赞同：1
> 
> 时间：2008-12-11T11:24:16.437
> 
> 标签：php, architecture, content-management-system

我目前正在为杂志开发一个（有点大的）网站，该网站主要由以下部分组成：新闻（针对各种类别）、成员和一些“其他内容”（如留言箱、民意调查、以前的封面、可以被标记，和广告横幅系统）。

现在，由于该网站的大部分内容是典型的博客风格（单篇文章页面），我正在考虑使用 Wordpress 作为主要引擎，因为它具有强大的后端和良好的（易于使用？）所见即所得的编辑器，漂亮的页面组织、媒体处理和许多其他功能。自然地，这让我有了“其他东西”。（横幅管理、照片标签管理等）

最简单的方法（嗯，我认为）是设置另一个 CMS（我们称之为 CMS2），来处理所有不可能或可能难以集成到 WP admin 中的事情，然后尝试在前端处理所有事情， WP风格。

我的问题：

1.  一个站点有两个（或更多）CMS 是否很好（正常）？
2.  什么可能出错？（或者，这种方法有什么我应该事先知道的吗？）
3.  另一种选择是寻找另一种好的、单一的方式来处理所有事情。但现在的主要问题是找到一个足够强大和灵活的 CMS。什么框架/CMS最适合这个（根据你）？
4.  其他选择？

提前谢谢了。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-11T11:54:20.603

我认为它太复杂了，并且围绕有两个系统的事实可能会出现问题。从可用性的角度来看，它也不是很好。

您应该查看一些更强大的 CMS 选项。Drupal 有很多可用的插件和功能，如果它不能满足你的需要，你会感到惊讶。Joomla 和 CMS Made Simple (CMSMS) 也值得一看。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-03T13:27:56.050

老实说，我认为这是一个非常糟糕的主意，至少从我自己的经验来看。

主要缺点：

*   管理员/编辑必须拥有/开发的知识量翻倍
*   安全风险增加一倍
*   更新/修补 CMS 安装的数量翻倍
*   降低为您找到替代品的可能性
*   它使与 SEO 相关的任务更加困难
*   如果两个站点的功能应该交互，它会使开发更加困难
*   它使两个站点的功能之间的交互变得困难或不可能（由于 CMS 的限制）

无论如何，第二个 CMS 会是什么？如果它是具有您描述的尺寸的站点，为什么不使用真正的 CMS？Drupal 和 Joomla 都可以处理您描述的所有需求！

花一些时间来评估，选择哪一个并选择一个 CMS！

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-03T13:15:46.790

使用 WordPress 可能是个好主意，具体取决于您想要在博客中使用的功能。Drupal 有一个“博客”功能，但它有点受限。（例如，人们不能像在 Word Press 中那样使用 OpenID 发表评论 - 尽管我已经 6 个月左右没有使用 Drupal，但它可能已经改变了。对于 Drupal 博客的示例，看看[这个 drupal网站](http://kkl.com.au/blog)）。

Drupal 仍然有您提到的易于使用的 WYSIWYG 编辑器，并且有不同类型的帖子（例如，您可以只发布图像、发布文章、发布博客帖子等。创建它们时，您可以选择发布他们到首页，或者只是到他们的类别（取决于您如何配置站点，它非常灵活）。

因此，如果这对您来说足够了，那么管理起来会简单得多！

# .net - 为什么我的程序不能从 Program Files 目录运行，而是从其他任何地方运行？

> ID：359036
> 
> 赞同：1
> 
> 时间：2008-12-11T11:27:09.333
> 
> 标签：.net, windows

除了程序文件目录（Windows XP）之外，我的程序在我的驱动器上的任何其他地方都可以正常运行，我以管理员身份登录，因此我对驱动器具有完全权限。它从 c 的根目录运行良好：windows 目录基本上除了 Program Files 之外的任何其他地方。我已经在 4 台不同的机器 2 XP、2 Vista 上重现了这个问题。

我的程序是 C# .Net 2.0 程序。到底是什么问题？

我什至已经将我的整个项目复制到 Program Files 目录中，但我无法从那里调试它，它不会运行，根本没有错误。

谢谢你的帮助。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-11T11:32:58.727

只是猜测，但如果您的程序试图将数据保存到程序目录，Vista 会阻止这种情况并将路径动态更改为 c:\users[user]\AppData 之类的路径。也许这会给你一个关于正在发生的事情的提示。

否则，我们需要有关您的计划的更多信息来帮助您。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-11T11:38:46.173

If you can't debug, you can always create a debug log. It is a bit slow, but in the end you will find the place where the program stops working.

```
LogDebug('before 1');
Statement1;
LogDebug('before 2');
Statement2;
LogDebug('before 3');
Statement3;
LogDebug('after 3'); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-11T11:56:29.087

I've tried the program on a fresh XP install that doesn't have any orgranizational policies applied.

:-(

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-11T11:38:35.847

The program does run from other folders with a space in the path such as Documents and Settings, the program does create a temporary file in the user profile\appdata folder.

If I run the app several time from somewhere it will run from I've just noticed I get an error with the option to debug but VS won't show me the location of the problem I just get the error belo.

Unhandled exception at 0x79fb96a2 in test.exe: 0xC0000005: Access violation reading location 0x0000000c.

The problem can be recreated on XP and Vista.

Many thanks

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-11T11:39:51.240

If this is a machine managed by your company's "big brother", it sounds like only "allowed" applications can run from "Program files"

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-11T17:04:09.153

对此很抱歉，但我发现了问题，我有一些垃圾代码正在寻找传递的参数，包括“文件”，而“程序文件”中的文件强制程序进入没有 gui 的命令行模式。真的很抱歉把你的时间浪费在这样一个微不足道的问题上，你生活和学习！

谢谢大家。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-11T12:40:46.983

您的程序在其目录中读取了什么？

为什么要在 user/appdata 中创建临时文件？对于临时文件，您应该使用 API 来获取当前配置文件的临时文件夹，最好是临时文件名，如下所示：

```
string tempFilePath = Path.Combine(Path.GetTempPath(), Path.GetTempFileName()); 
```

为了正确地帮助你，我们需要知道你的程序应该在 init 上做什么。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-11T12:56:50.727

你有没有像防病毒软件一样运行的东西？

它是哪一个？

*   它没有运行吗（可能与操作系统相关）
*   或者它是否会倒下（可能是权限）
*   或者运行并且没有产生预期的输出？（可能是权限）

你检查过事件日志吗？

尝试从批处理文件中调用它，看看会发生什么。

嗯，有人想在他们的机器上尝试他的 .exe 吗？

# c# - 在 c# 中请求网页欺骗主机

> ID：359041
> 
> 赞同：11
> 
> 时间：2008-12-11T11:27:57.350
> 
> 标签：c#, http, http-headers

我需要为发送到我们网站的网页创建一个请求，但我也需要能够设置主机标头信息。我已经尝试过使用 HttpWebRequest，但是标头信息是只读的（或者至少它的主机部分是只读的）。我需要这样做，因为我们想在用户之前执行页面的初始请求。我们有 10 个负载均衡的 Web 服务器，因此我们需要从每个 Web 服务器请求文件。

我尝试了以下方法：

```
HttpWebRequest request = (HttpWebRequest)WebRequest.Create("http://192.168.1.5/filename.htm");
request.Headers.Set("Host", "www.mywebsite.com");
WebResponse response = request.GetResponse(); 
```

显然这不起作用，因为我无法更新标题，而且我不知道这是否确实是正确的方法。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2011-09-26T19:33:06.187

虽然这是一个很晚的答案，但也许有人可以从中受益

```
HttpWebRequest request = (HttpWebRequest)HttpWebRequest.Create(new Uri("http://192.168.1.1"));
request.Headers.GetType().InvokeMember("ChangeInternal", BindingFlags.NonPublic | BindingFlags.Instance | BindingFlags.InvokeMethod, null, request.Headers, new object[] {"Host","www.mysite.com"}); 
```

反射是你的朋友:)

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-12-11T13:18:19.670

通过使用套接字，我设法找到了一条更漫长的路线。我在 IPEndPoint 的 MSDN 页面中找到了答案：

```
string getString = "GET /path/mypage.htm HTTP/1.1\r\nHost: www.mysite.mobi\r\nConnection: Close\r\n\r\n";
Encoding ASCII = Encoding.ASCII;
Byte[] byteGetString = ASCII.GetBytes(getString);
Byte[] receiveByte = new Byte[256];
Socket socket = null;
String strPage = null;
try
{
    IPEndPoint ip = new IPEndPoint(IPAddress.Parse("10.23.1.93"), 80);
    socket = new Socket(ip.AddressFamily, SocketType.Stream, ProtocolType.Tcp);
    socket.Connect(ip);
}
catch (SocketException ex)
{
    Console.WriteLine("Source:" + ex.Source);
    Console.WriteLine("Message:" + ex.Message);
}
socket.Send(byteGetString, byteGetString.Length, 0);
Int32 bytes = socket.Receive(receiveByte, receiveByte.Length, 0);
strPage = strPage + ASCII.GetString(receiveByte, 0, bytes);

while (bytes > 0)
{
    bytes = socket.Receive(receiveByte, receiveByte.Length, 0);
    strPage = strPage + ASCII.GetString(receiveByte, 0, bytes);
}
socket.Close(); 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2010-12-12T11:02:09.960

我有一个问题，我使用的 URL dns 有几个不同的 IP 地址，我想在主机中使用相同的 dns 名称分别调用每个地址 - 解决方案是使用代理：

```
string retVal = "";
            // Can't change the 'Host' header property because .NET protects it
            // HttpWebRequest request = (HttpWebRequest)WebRequest.Create(url);
            // request.Headers.Set(HttpRequestHeader.Host, DEPLOYER_HOST);
            // so we must use a workaround
            HttpWebRequest request = (HttpWebRequest)WebRequest.Create(url);
            request.Proxy = new WebProxy(ip);
            using (WebResponse response = request.GetResponse())
            {
                using (TextReader reader = new StreamReader(response.GetResponseStream()))
                {
                    string line;
                    while ((line = reader.ReadLine()) != null)
                        retVal += line;
                }
            }
            return retVal; 
```

主机标头由 .NET 自动从“url”设置，“ip”包含您要联系的 Web 服务器的实际地址（您也可以在此处使用 dns 名称）

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2010-02-15T08:21:36.643

我知道这是旧的，但我遇到了同样的问题，我找到了一个更好的解决方案，然后使用套接字或反射......

我所做的是创建一个来自 WebHeaderCollection 的新类，并绕过对您在其中粘贴的内容的验证：

```
public class MyHeaderCollection:WebHeaderCollection
{
    public new void Set(string name, string value)
    {
        AddWithoutValidate(name, value);
    }
    //or
    public new string this[string name]
    {
        get { return base[name]; }
        set { AddWithoutValidate(name, value); }
    }
} 
```

下面是你如何使用它：

```
 var http = WebRequest.Create("http://example.com/");
    var headers = new MyHeaderCollection();
    http.Headers = headers;

    //Now you can add/override anything you like without validation:
    headers.Set("Host", http.RequestUri.Host);
    //or
    headers["Host"] = http.RequestUri.Host; 
```

希望这可以帮助任何寻找这个的人！

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2015-06-18T08:18:51.017

我知道这是一个老问题，但是这些天，你可以做到。

```
HttpWebRequest request = (HttpWebRequest)WebRequest.Create("http://192.168.1.5/filename.htm");
request.Host = "www.mywebstite.com";
WebResponse response = request.GetResponse(); 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-11T11:33:00.787

好吧，一点点研究发现了这一点：

[https://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=384456](https://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=384456)

似乎MS*可能会*在某个时候对此做些什么。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-11T11:58:01.190

“主机”标头受到保护，不能以编程方式修改。我想解决这个问题，您可以尝试通过反射绑定到 WebRequest 对象的私有“InnerCollection”属性，并在其上调用“Set”ar“Add”方法来修改 Host 标头。我还没有尝试过，但是通过快速查看 Reflector 中的源代码，我认为它很容易完成。但是，是的，绑定到框架对象的私有属性并不是完成事情的最佳方式。:) 仅在必须时使用。

编辑：或者像链接问题中提到的其他人一样，只需打开一个套接字并手动快速“获取”。如果您不需要修补其他东西，比如 cookie 或 HttpWebRequest 提供的任何其他细节，那么应该是不费吹灰之力。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2013-09-25T17:13:43.780

你可以使用我的解决方案来解决这个问题，它发布在这里：

[如何在 HttpWebRequest 中设置自定义“主机”标头？](https://stackoverflow.com/questions/1450937/how-to-set-custom-host-header-in-httpwebrequest/18572236#18572236)

这可以帮助您编辑主机头，避免使用代理和直接套接字请求。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2016-12-21T08:09:05.267

死灵术。
对于那些仍在使用 .NET 2.0的人
来说，如果您知道如何操作，这实际上很容易。

问题是，您不能设置主机标头，因为框架不允许您在运行时更改值。（.net framework 4.0+ 将允许您在 httpwebrequest 中覆盖主机）。

下一次尝试将设置带有反射的标头 - 如此处最受好评的答案所示 - 绕过它，这将让您更改标头值。但是在运行时，它会用**url的 host 部分****覆盖**这个值，这意味着反射不会给你带来任何东西，这就是为什么我**不**明白为什么人们继续**投票**的原因。

 ******如果 dns-name 不存在，坦率地说，这是您首先要执行此操作的唯一情况，您无法设置它，因为 .NET 无法解析它，而且您也无法覆盖 .NET DNS 解析器。

但是您可以做的是设置一个与目标服务器具有完全相同 IP 的网络代理。

所以，如果你的服务器 IP 是 28.14.88.71：

```
public class myweb : System.Net.WebClient
{
    protected override System.Net.WebRequest GetWebRequest(System.Uri address)
    {
        System.Net.WebRequest request = (System.Net.WebRequest)base.GetWebRequest(address);
        //string host = "redmine.nonexistantdomain.com";

        //request.Headers.GetType().InvokeMember("ChangeInternal",
        //    System.Reflection.BindingFlags.NonPublic |
        //    System.Reflection.BindingFlags.Instance |
        //    System.Reflection.BindingFlags.InvokeMethod, null,
        //    request.Headers, new object[] { "Host", host }
        //);

        //server IP and port
        request.Proxy = new System.Net.WebProxy("http://28.14.88.71:80");

        // .NET 4.0 only
        System.Net.HttpWebRequest foo = (System.Net.HttpWebRequest)request;
        //foo.Host = host;

        // The below reflection-based operation is not necessary, 
        // if the server speaks HTTP 1.1 correctly
        // and the firewall doesn't interfere
        // https://yoursunny.com/t/2009/HttpWebRequest-IP/
        System.Reflection.FieldInfo horribleProxyServicePoint = (typeof(System.Net.ServicePoint))
            .GetField("m_ProxyServicePoint", System.Reflection.BindingFlags.NonPublic |
            System.Reflection.BindingFlags.Instance);

        horribleProxyServicePoint.SetValue(foo.ServicePoint, false);
        return foo; // or return request; if you don't neet this
    }

    } 
```

瞧，现在

```
myweb wc = new myweb();
string str = wc.DownloadString("http://redmine.netexistantdomain.com"); 
```

如果 28.14.88.71 是一个具有基于虚拟名称的托管（基于 http-host-header）的网络服务器，那么您会得到正确的页面。

现在您对 WebRequest 和 WebClient 的原始问题有了正确的答案。我认为使用自定义套接字来执行此操作是错误的方法，尤其是在应该使用 SSL 并且实际解决方案如此简单时......

# php - 基于字符的分页 - 在文本上插入分页符，而不是标点符号或代码

> ID：359043
> 
> 赞同：0
> 
> 时间：2008-12-11T11:29:13.337
> 
> 标签：php

我正在编写代码来生成基于字符的分页。我的网站中有文章，我想根据长度进行拆分。

到目前为止，我的代码正在运行，尽管有两个问题：

1.  它在单词和 HTML 标签中间分割页面；我希望它只在一个完整的单词、标签或标点符号之后拆分。
2.  在分页栏中，它生成了错误的页数。

在分页栏中，它生成了错误的页数。

需要帮助解决这两个问题。代码如下：

```
$text = file_get_contents($View);
$ArticleLength = strlen($text);
$CharsPerPage = 5000;
$NoOfPages = round((double)$ArticleLength / (double)$CharsPerPage);
$CurrentPage = $this->ReturnNeededObject('pagenumber');
$Page = (isset($CurrentPage) && '' !== $CurrentPage) ? $CurrentPage : '1';
$PageText = substr($text, $CharsPerPage*($Page-1), $CharsPerPage);
echo $PageText, '<p>';
for ($i=1; $i<$NoOfPages+1; $i++)
{
    if ($i == $CurrentPage)
    {
        echo '<strong>', $i, '</strong>';
    }
    else
    {
         echo '<a href="', $i, '">', $i, '</a>';
    }
    echo ' | ';
}
echo '</p>'; 
```

我究竟做错了什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-11T12:08:22.197

Thanks, guys. I put in the fix for the 1st point and it worked beautifully.

Hm. I guess it is messy to do the second point. I've found some regex on-line. Will think, write, and get back to you when I make some progress.

Thanks again.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-11T11:38:07.080

```
$NoOfPages = round((double)$ArticleLength / (double)$CharsPerPage); 
```

That should use ceil instead of round - if you use round, 4.2 pages will only show 1-4 - you need a 5th page to show the last .2 of a page.

The other part is harder ... its common to use some sort of marker in the file to indicate where the page breaks go as no matter how clever your code, it can't appreciate where is a good break in then same way a human can.

If you insist on doing it suggest some logic that first works forwards/backwards to the nearest space when a page break is created, which isn't too tricky. More tricky is deciding when you are within a tag or not .... think you'll either need some fairly heavy regex, or else an HTML parsing tool.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-11T11:38:53.707

You're calculating the number of pages wrong... you should be using `ceil()` not `round()` (for example 4.1 pages worth of text is still 5 pages to display).

To fix the other issue, you're going to have big problems if there's arbitrary HTML in there. For example, you need to know that `<div>`s and `<p>`s are OK to split, but `<table>`s aren't (unless you want to get really fancy)!

To do it properly you should use an HTML library to build a tree of elements and then go from there.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-11T12:57:16.577

根据你的第一句话，

> 它在单词和 HTML 标记中间分割页面

插入标记后，您的字符数似乎正在完成。这意味着例如链接中的长 URL 将计入您尝试实现的页面长度。但是，您没有说明文章最初是如何创建的。

我建议在创建文章的过程中寻找一个可以检查原始文本的点。通过将实际内容（没有标记）视为一组段落，并根据每行的典型字符数估计每个段落的垂直长度，您可以得出更一致的大小。

我也会考虑只在段落之间打断，以将思想单元放在同一页上。作为一名读者，我真的很讨厌去那些强迫我暂停、点击按钮或链接、等待页面重新加载的网站，所有这些都在一个想法的中间。

# networking - UDP/TCP 中使用的 Pseudo Header 的意义是什么

> ID：359045
> 
> 赞同：22
> 
> 时间：2008-12-11T11:30:54.083
> 
> 标签：networking, tcp, udp

为什么要在 UDP 数据报中添加[伪标头](http://www.networksorcery.com/enp/protocol/udp.htm#Checksum)以计算 UDP 校验和？这背后的原因是什么？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2010-05-15T13:30:13.090

最接近您将获得“直接从马嘴里”的答案来自以下链接的 David P. Reed。

[http://www.postel.org/pipermail/end2end-interest/2005-February/004616.html](http://www.postel.org/pipermail/end2end-interest/2005-February/004616.html)

答案的简短版本是“伪标头由于历史原因而存在”。

最初，TCP/IP 是一个单一的整体协议（仅称为 TCP）。当他们决定将其拆分为 TCP 和 IP（以及其他）时，他们并没有将两者完全分开：IP 地址仍然被认为是 TCP 的一部分，但它们只是从 IP 层“继承”而来而不是在 TCP 标头中重复。TCP 校验和对部分 IP 标头（包括 IP 地址）进行操作的原因是因为他们打算使用密码学来加密和验证 TCP 有效负载，并且他们希望伪标头中的 IP 地址和其他 TCP 参数是受验证码保护。这将使中间人无法篡改 IP 源地址和目标地址：中间路由器不会注意到篡改，

由于种种原因，那个宏大的加密计划都没有实现，但取代它的 TCP 校验和仍然在伪标头上运行，就好像这是一件有用的事情。是的，它为您提供了一些针对随机错误的额外保护，但这不是它存在的原因。坦率地说，没有它我们会更好：TCP和IP之间的耦合意味着你必须在更改IP时重新定义TCP。因此，IPv6 的定义包括 TCP 和 UDP 伪报头的新定义（参见 RFC 2460，s8.1）。为什么 IPv6 设计者选择延续这种耦合而不是借此机会废除它，我无法理解。

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2008-12-11T11:43:27.130

从 TCP 或 UDP 的角度来看，数据包不包含 IP 地址。（IP 是它们下面的层。）

因此，为了进行正确的校验和，需要包含一个“伪标头”。它是“伪”的，因为它实际上不是 UDP 数据报的一部分。它包含IP头中最重要的部分，即源地址和目的地址、协议号和数据长度。

这是为了确保 UDP 校验和考虑这些字段。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2014-02-09T12:04:29.437

> "The purpose of using a pseudo-header is to verify that the UDP datagram has reached its correct destination. The key to understanding the pseudo-header lies in realizing that the correct destination consists of a specific machine and a specific protocol port within that machine. The UDP header itself specifies only the protocol port number. Thus, to verify the destination, UDP on the sending machine computes a checksum that covers the destination IP address as well as the UDP datagram. The pseudo-header is not transmitted with the UDP datagram, nor is it included in the length."

E. Comer - Internetworking with TCP/IP 4th edition.

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2009-02-27T17:01:45.847

在设计这些协议时，他们的一个严重问题是主机接收到的数据包认为它是他们的，但实际上不是。如果在传输过程中 IP 报头中的一些位被翻转并且数据包改变了路线（但 IP 校验和仍然正确），重定向接收器的 TCP/UDP 堆栈仍然可以知道拒绝数据包。

尽管伪标题打破了层分离习惯，但它被认为可以提高可靠性。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2020-01-29T02:53:12.933

Pseudo IP header contains the source IP, destination IP, protocol and Total length fields. Now, by including these fields in TCP checksum, we are verifying the checksum for these fields both at Network layer and Transport layer, thus doing a double check to ensure that the data is delivered to the correct host.

# php - 检测 PHP 中的请求类型（GET、POST、PUT 或 DELETE）

> ID：359047
> 
> 赞同：1038
> 
> 时间：2008-12-11T11:31:27.170
> 
> 标签：php, http, request

如何检测 PHP 中使用了哪种请求类型（GET、POST、PUT 或 DELETE）？

* * *

## 回答 #1

> 赞同：1471
> 
> 时间：2008-12-11T11:32:18.277

通过使用

```
$_SERVER['REQUEST_METHOD'] 
```

### 例子

```
if ($_SERVER['REQUEST_METHOD'] === 'POST') {
     // The request is using the POST method
} 
```

有关更多详细信息，请参阅[$_SERVER 变量的文档](http://php.net/manual/en/reserved.variables.server.php)。

* * *

## 回答 #2

> 赞同：236
> 
> 时间：2009-05-22T10:52:06.740

PHP 中的 REST 可以非常简单地完成。创建[http://example.com/test.php](http://example.com/test.php)（如下所述）。将此用于 REST 调用，例如[http://example.com/test.php/testing/123/hello](http://example.com/test.php/testing/123/hello)。这适用于开箱即用的 Apache 和 Lighttpd，并且不需要重写规则。

```
<?php
$method = $_SERVER['REQUEST_METHOD'];
$request = explode("/", substr(@$_SERVER['PATH_INFO'], 1));

switch ($method) {
  case 'PUT':
    do_something_with_put($request);  
    break;
  case 'POST':
    do_something_with_post($request);  
    break;
  case 'GET':
    do_something_with_get($request);  
    break;
  default:
    handle_error($request);  
    break;
} 
```

* * *

## 回答 #3

> 赞同：26
> 
> 时间：2015-10-27T11:16:10.540

Detecting the HTTP method or so called `REQUEST METHOD` can be done using the following code snippet.

```
$method = $_SERVER['REQUEST_METHOD'];
if ($method == 'POST'){
    // Method is POST
} elseif ($method == 'GET'){
    // Method is GET
} elseif ($method == 'PUT'){
    // Method is PUT
} elseif ($method == 'DELETE'){
    // Method is DELETE
} else {
    // Method unknown
} 
```

You could also do it using a `switch` if you prefer this over the `if-else` statement.

If a method other than `GET` or `POST` is required in an HTML form, this is often solved using a hidden field in the form.

```
<!-- DELETE method -->
<form action='' method='POST'>
    <input type="hidden" name'_METHOD' value="DELETE">
</form>

<!-- PUT method -->
<form action='' method='POST'>
    <input type="hidden" name'_METHOD' value="PUT">
</form> 
```

For more information regarding HTTP methods I would like to refer to the following StackOverflow question:

[HTTP protocol's PUT and DELETE and their usage in PHP](https://stackoverflow.com/questions/27941207/http-protocols-put-and-delete-and-their-usage-in-php)

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2016-03-04T12:35:33.807

You can use `getenv` function and don't have to work with a `$_SERVER` variable:

```
getenv('REQUEST_METHOD'); 
```

More info:

[http://php.net/manual/en/function.getenv.php](http://php.net/manual/en/function.getenv.php)

* * *

## 回答 #5

> 赞同：14
> 
> 时间：2016-05-13T03:55:29.047

We can also use the [input_filter](http://php.net/manual/en/function.filter-input.php) to detect the request method while also providing security through input sanitation.

```
$request = filter_input(INPUT_SERVER, 'REQUEST_METHOD', FILTER_SANITIZE_ENCODED); 
```

* * *

## 回答 #6

> 赞同：12
> 
> 时间：2013-12-16T12:32:47.723

Since this is about REST, just getting the request method from the server is not enough. You also need to receive RESTful route parameters. The reason for separating RESTful parameters and GET/POST/PUT parameters is that a resource needs to have its own unique URL for identification.

Here's one way of implementing RESTful routes in PHP using Slim:

[https://github.com/codeguy/Slim](https://github.com/codeguy/Slim)

```
$app = new \Slim\Slim();
$app->get('/hello/:name', function ($name) {
  echo "Hello, $name";
});
$app->run(); 
```

And configure the server accordingly.

Here's another example using AltoRouter:

[https://github.com/dannyvankooten/AltoRouter](https://github.com/dannyvankooten/AltoRouter)

```
$router = new AltoRouter();
$router->setBasePath('/AltoRouter'); // (optional) the subdir AltoRouter lives in

// mapping routes
$router->map('GET|POST','/', 'home#index', 'home');
$router->map('GET','/users', array('c' => 'UserController', 'a' => 'ListAction'));
$router->map('GET','/users/[i:id]', 'users#show', 'users_show');
$router->map('POST','/users/[i:id]/[delete|update:action]', 'usersController#doAction', 'users_do'); 
```

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2015-07-06T11:11:18.423

```
$request = new \Zend\Http\PhpEnvironment\Request();
$httpMethod = $request->getMethod(); 
```

In this way you can also achieve in zend framework 2 also. Thanks.

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2017-04-13T12:52:35.433

> It is Very Simple just use **$_SERVER['REQUEST_METHOD'];**

**Example:**

```
<?php
$method = $_SERVER['REQUEST_METHOD'];
switch ($method) {
  case 'GET':
    //Here Handle GET Request 
    break;
  case 'POST':
    //Here Handle POST Request 
    break;
  case 'DELETE':
    //Here Handle DELETE Request 
    break;
  case 'PUT':
    //Here Handle PUT Request 
    break;
}
?> 
```

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2018-08-03T14:00:02.050

In core php you can do like this :

```
<?php

$method = $_SERVER['REQUEST_METHOD'];

switch ($method) {
  case 'GET':
    //Here Handle GET Request
    echo 'You are using '.$method.' Method';
    break;
  case 'POST':
    //Here Handle POST Request
    echo 'You are using '.$method.' Method';
    break;
  case 'PUT':
    //Here Handle PUT Request
    echo 'You are using '.$method.' Method';
    break;
  case 'PATCH':
    //Here Handle PATCH Request
    echo 'You are using '.$method.' Method';
    break;
  case 'DELETE':
    //Here Handle DELETE Request
    echo 'You are using '.$method.' Method';
    break;
  case 'COPY':
      //Here Handle COPY Request
      echo 'You are using '.$method.' Method';
      break;

  case 'OPTIONS':
      //Here Handle OPTIONS Request
      echo 'You are using '.$method.' Method';
      break;
  case 'LINK':
      //Here Handle LINK Request
      echo 'You are using '.$method.' Method';
      break;
  case 'UNLINK':
      //Here Handle UNLINK Request
      echo 'You are using '.$method.' Method';
      break;
  case 'PURGE':
      //Here Handle PURGE Request
      echo 'You are using '.$method.' Method';
      break;
  case 'LOCK':
      //Here Handle LOCK Request
      echo 'You are using '.$method.' Method';
      break;
  case 'UNLOCK':
      //Here Handle UNLOCK Request
      echo 'You are using '.$method.' Method';
      break;
  case 'PROPFIND':
      //Here Handle PROPFIND Request
      echo 'You are using '.$method.' Method';
      break;
  case 'VIEW':
      //Here Handle VIEW Request
      echo 'You are using '.$method.' Method';
      break;
  Default:
    echo 'You are using '.$method.' Method';
  break;
}

?> 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2020-02-07T07:28:48.193

It is valuable to additionally note, that PHP will populate all the `$_GET` parameters even when you send a proper request of other type.

Methods in above replies are completely correct, however if you want to additionaly check for `GET` parameters while handling `POST`, `DELETE`, `PUT`, etc. request, you need to check the size of `$_GET` array.

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2017-09-06T13:17:57.880

When a method was requested, it will have an `array`. So simply check with `count()`.

```
$m=['GET'=>$_GET,'POST'=>$_POST];
foreach($m as$k=>$v){
    echo count($v)?
    $k.' was requested.':null;
} 
```

[3v4l.org/U51TE](https://3v4l.org/U51TE)

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2019-01-18T16:03:10.200

I used this code. It should work.

```
function get_request_method() {
    $request_method = strtolower($_SERVER['REQUEST_METHOD']);

    if($request_method != 'get' && $request_method != 'post') {
        return $request_method;
    }

    if($request_method == 'post' && isset($_POST['_method'])) {
        return strtolower($_POST['_method']);
    }

    return $request_method;
} 
```

This above code will work with `REST calls` and will also work with `html form`

```
<form method="post">
    <input name="_method" type="hidden" value="delete" />
    <input type="submit" value="Submit">
</form> 
```

* * *

## 回答 #13

> 赞同：-5
> 
> 时间：2016-01-01T11:37:53.583

You can get any query string data i.e `www.example.com?id=2&name=r`

You must get data using `$_GET['id']` or `$_REQUEST['id']`.

Post data means like form `<form action='' method='POST'>` you must use `$_POST` or `$_REQUEST`.

# delphi - 我可以在 Delphi 7 的 PUT 和 DELETE 中发送请求吗？

> ID：359052
> 
> 赞同：3
> 
> 时间：2008-12-11T11:32:55.903
> 
> 标签：delphi, rest

我需要将 PUT 和 DELETE 与 POST、GET 一起发送到 REST API 我该怎么做？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-11T12:10:43.237

Delphi 7 带有[Indy](http://www.indyproject.org/Sockets/index.EN.aspx)。请参阅[TIdHTTP 组件](http://www.indyproject.org/docsite/html/frames.html?frmname=topic&frmfile=!!MEMBEROVERVIEW_TIdHTTP.html)，特别是 Get 和 Put 方法。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-11T17:02:16.253

或者查看开源[Synapse](http://synapse.ararat.cz/doku.php/download)库。[HTTPSend](http://synapse.ararat.cz/doc/help/httpsend.html)单元中有一些简单的函数调用，使实现这一点完全轻松。只需使用示例函数/程序作为 PUT/DELETE 的模型。现有的例程已经提供了 POST 和 GET。不同之处在于传递的方法。

就我个人而言，我发现这个库非常适合与 REST 一起使用。它简单，写得好，易于扩展。

例如，这是一个发送和接收流的简单 put：

```
function HttpPutBinary(const URL: string; const Data: TStream): Boolean;
var
  HTTP: THTTPSend;
begin
  HTTP := THTTPSend.Create;
  try
    HTTP.Document.CopyFrom(Data, 0);
    HTTP.MimeType := 'Application/octet-stream';
    Result := HTTP.HTTPMethod('PUT', URL);  // changed method from 'POST'
    Data.Size := 0;
    if Result then
    begin
      Data.Seek(0, soFromBeginning);
      Data.CopyFrom(HTTP.Document, 0);
    end;
  finally
    HTTP.Free;
  end;
end; 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-11T11:41:11.003

检查[ICS](http://www.overbyte.be/frame_index.html)组件，它们适合这项工作。

# c++ - error C2065: 'CoInitializeEx' : undeclared identifier

> ID：359070
> 
> 赞同：1
> 
> 时间：2008-12-11T11:40:55.623
> 
> 标签：c++, mfc

I get the following error while trying to use `hres = CoInitializeEx(0, COINIT_MULTITHREADED);`

> error C2065: 'CoInitializeEx' : undeclared identifier

I have already included:

```
#define _WIN32_DCOM
#include <iostream>
using namespace std;
#include <comdef.h>
#include <Wbemidl.h> 
```

in my cpp file.

Kindly help.

Thanks, Neha

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-11T11:46:41.633

Try placing the following line at the beginning of your precompiled header(*stdafx.h*).

```
#define _WIN32_WINNT 0x0400 
```

# c++ - 如何在 Windows Mobile 上捕获高分辨率图像

> ID：359084
> 
> 赞同：0
> 
> 时间：2008-12-11T11:46:49.323
> 
> 标签：c++, windows-mobile, image-capture

我想用 Windows Mobile 设备捕捉高分辨率图像。我已经尝试过 WM SDK 中的示例，但它只捕获了单帧摄像机并且分辨率很差。有没有人有使用 C++ 在 Pocket PC 上进行图像捕获的经验？

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-11T14:37:30.867

您需要更改示例代码使用的过滤器以捕获高分辨率图像。当您在数码相机中使用取景器时，相机会通过应用最低分辨率滤镜然后快速拍摄并显示单帧来“模拟”摄像机的外观。当您单击按钮拍摄高分辨率照片时，相机必须将低分辨率滤镜换成高分辨率滤镜，然后再拍摄高分辨率照片 - 这就是为什么（廉价）数码相机总是如此很想拍张照片。

我不知道您正在使用哪个代码示例，但如果它是我使用的那个，它默认使用最低分辨率过滤器。在它的某处应该有一条选择过滤器的行。您只需要将传递的值从 0 更改为（可能）3 或 4 以获得最高分辨率。

# c# - List.BinarySearch vs Dictionary.TryGetValue - which is faster

> ID：359085
> 
> 赞同：3
> 
> 时间：2008-12-11T11:47:57.123
> 
> 标签：c#

Which would be faster for say 500 elements.

Or what's the faster data structure/collection for retrieving elements?

```
 List<MyObj> myObjs = new List<MyObj>();
        int i = myObjs.BinarySearch(myObjsToFind);
        MyObj obj = myObjs[i]; 
```

Or

```
 Dictionary<MyObj, MyObj> myObjss = new Dictionary<MyObj, MyObj>();
        MyObj value;
        myObjss.TryGetValue(myObjsToFind, out value); 
```

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-12-11T11:54:34.863

I assume in your real code you'd actually *populate* myObjs - and sort it.

Have you just tried it? It will depend on several factors:

*   Do you need to sort the list for any other reason?
*   How fast is MyObj.CompareTo(MyObj)?
*   How fast is MyObj.GetHashCode()?
*   How fast is MyObj.Equals()?
*   How likely are you to get hash collisions?
*   Does it actually make a significant difference to you?

It'll take around 8 or 9 comparisons in the binary search case, against a single call to GetHashCode and some number of calls to Equals (depending on hash collisions) in the dictionary case. Then there's the intrinsic calculations (accessing arrays etc) involved in both cases.

Is this really a bottleneck for you though?

I'd expect Dictionary to be a bit faster at 500 elements, but not *very* much faster. As the collection grows, the difference will obviously grow.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-11T11:54:35.737

The latter.

A binary search runs at O(log n) while a hashtable will be O(1).

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2021-02-22T22:51:38.520

一直在用大约 500k 个项目的内存集合进行一些真实世界的测试。二分搜索在各个方面都获胜。字典会减慢您拥有的更多哈希冲突。二进制搜索在技术上会减慢速度，但没有字典算法那么快。

二进制搜索的巧妙之处在于它会告诉你如果没有找到该项目在哪里插入列表。所以制作排序列表也非常快。（没那么快）

与使用二进制搜索排序的列表相比，大字典也会消耗大量内存。根据我的测试，排序列表消耗了字典 id 的大约 27% 的内存。（所以一个词声称 3.7 X 内存）

对于较小的列表字典就可以了——一旦你变大，它可能不是最好的选择。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-11T16:13:44.340

一些评论者使用的大“O”符号是一个很好的使用指南。但是，在实践中，确定在特定情况下哪种方式更快的唯一方法是在更改之前和之后为*您自己的代码计时*（正如 Jon 所暗示的那样）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-11T11:57:42.623

BinarySearch requires the list to already be sorted. [edit: Forgot that dictionary is a hashtable. So lookup is O(1)]. The 2 are not really the same either. The first one is really just checking if it exists in the list and where it is. If you want to just check existance in a dictionary use the contain method.

# .net - .NET 设计时数据源（用于组合框）

> ID：359086
> 
> 赞同：0
> 
> 时间：2008-12-11T11:47:59.807
> 
> 标签：.net, vb.net, combobox, objectdatasource, design-time

我正在尝试创建一个 ObjectDataSource，我可以用它来绑定到一个 BindingSource，而他又应该绑定到一个 ComboBox。

我为这个类创建了一个简单的类和一个简单的列表（见下文）

1.  Times 列表类未显示在我的工具箱中，因此我无法将其拖到表单中，因此我可以选择它作为绑定源的数据源。
2.  第二个选项是创建一个新的项目数据源（ObjectDataSource）。此处要求“选择您希望绑定到的对象”。我向 Form1 添加了一个朋友/公共/私有变量，它实例化了 Times 类。但是这个变量没有显示。我的项目命名空间中出现的唯一对象是 Form1。

我错过了什么？

```
Public Class Time
    Private _timeValue As String
    Private _timeDisplay As String

    Public Sub New(ByVal Value As String, ByVal Display As String)
        Me._timeDisplay = Display
        Me._timeValue = Value
    End Sub

    Public Property Display() As String
        Get
            Return Me._timeDisplay
        End Get
        Set(ByVal value As String)
            Me._timeDisplay = value
        End Set
    End Property

    Public Property Value() As String
        Get
            Return Me._timeValue
        End Get
        Set(ByVal value As String)
            Me._timeValue = value
        End Set
    End Property
End Class

Public Class Times : Inherits List(Of Time)
    Public Sub New()

    End Sub
End Class 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-11T12:22:59.860

要改善使用 的体验`ObjectDataSource`，请考虑使用 标记您的数据类型`[DataObject]`。此外，还有一个`[DataObjectMethod]`属性定义了可能的操作。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-11T12:34:01.523

我可以将`System.ComponentModel.DataObject`属性添加到`class`. 但是我不能`System.ComponentModel.DataObjectMethod`在我的`Display/Value property`. 当我将它们更改为时，`Functions`出现以下错误：

*'重载解决失败，因为没有可访问`New()`的接受这个数量的参数'*

```
'This works
<System.ComponentModel.DataObject()> _
Public Class Time
    Private _timeValue As String
    Private _timeDisplay As String

    Public Sub New()

    End Sub

    Public Sub New(ByVal Value As String, ByVal Display As String)
        Me._timeDisplay = Display
        Me._timeValue = Value
    End Sub

    'This doesn't work
    <System.ComponentModel.DataObjectMethod()> _
    Public Function getDisplay() As String
        Return Me._timeDisplay
    End Function

    'This doesn't work
    <System.ComponentModel.DataObjectMethod()> _
    Public Function getValue() As String
        Return Me._timeValue
    End Function
End Class 
```

# javascript - jQuery检测程序更改事件

> ID：359087
> 
> 赞同：12
> 
> 时间：2008-12-11T11:49:18.553
> 
> 标签：javascript, jquery

如果我执行 jQuery(expr).change(function)，那么当用户更改值时，我可以获得一个事件函数来触发。

如果以编程方式更改它是否有可能触发它，即如果我调用 jQuery(expr).val("moo")。

或者如果一些普通的旧 JavaScript 改变了它的价值？

谢谢你的帮助。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-12-11T12:10:04.580

更改值后，您可以自己触发事件，从而调用所有“onchange”处理程序。

```
jQuery('#element').change(); 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-11T12:13:10.877

直接在 JS 中更改值不会挂钩任何 jQuery 可以侦听以触发更改事件的内容。正如 Sander 所说，您可以自己触发事件处理程序。如果您无法控制修改这些值的其他代码并且这不是一个选项，那么您有点不走运。唯一可能起作用的其他选择是让观察者使用 观察间隔上的值`setTimeout`，这真的很混乱，可能不是一个好主意。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2013-05-24T08:19:13.600

jQuery v1+ 支持处理程序的编程触发——我使用了这个方法而不是 .change() 方法，因为它允许在需要时触发多个其他处理程序（例如一些自定义处理程序）。[API 文档](http://api.jquery.com/trigger/ "http://api.jquery.com/trigger/")位于： [http ://api.jquery.com/trigger/](http://api.jquery.com/trigger/ "http://api.jquery.com/trigger/")

# perl - How can I handle multiple sockets within a Perl daemon with large memory usage?

> ID：359093
> 
> 赞同：5
> 
> 时间：2008-12-11T11:54:08.980
> 
> 标签：perl, multithreading, sockets, ipc, multiprocessing

I have created a client-server program with Perl using IO::Socket::INET. I access server through CGI based site. My server program will run as daemon and will accept multiple simultaneous connections. My server process consumes about 100MB of memory space (9 large arrays, many arrays...). I want these hashes to reside in memory and share them so that I don't have to create them for every connection. Hash creation takes 10-15 seconds.

Whenever a new connection is accepted through sockets, I fork a new process to take care of the processing for each connection received. Since parent process is huge, every time I fork, processor tries to allocate memory to a new child, but due to limited memory, it takes large time to spawn a new child, thereby increasing the response time. Many times it hangs down even for a single connection.

Parent process creates 9 large hashes. For each child, I need to refer to one or more hashes in read-only mode. I will not update hashes through child. I want to use something like copy-on-write, by which I can share whole 100mb or whole global variables created by parent with all child? or any other mechanism like threads. I expect the server will get minimum 100 request per second and it should be able to process all of them in parallel. On an average, a child will exit in 2 seconds.

I am using Cygwin on Windows XP with only 1GB of RAM. I am not finding any way to overcome this issue. Can you suggest something? How can I share variables and also create 100 child processes per second and manage them and synchronize them,

Thanks.

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-11T12:04:47.743

Instead of forking there are two other approaches to handle concurrent connections. Either you use threads or a polling approach.

In the thread approach for each connection a new thread is created that handles the I/O of a socket. A thread runs in the same virtual memory of the creating process and can access all of its data. Make sure to properly use locks to synchronize write access on your data.

An even more efficient approach is to use polling via select(). In this case a single process/thread handles all sockets. This works under the assumption that most work will be I/O and that the time spend with waiting for I/O requests to finish is spent handling other sockets.

Go research further on those two options and decide which one suits you best.

See for example: [http://www.perlfect.com/articles/select.shtml](http://www.perlfect.com/articles/select.shtml)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-11T14:18:51.873

如果你有那么多数据，我想知道你为什么不简单地使用数据库？

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-11T16:15:25.647

这种架构不适合 Cygwin。在真正的 unix 系统上分叉很便宜，但在像 Cygwin 这样的假 unix 系统上则非常昂贵，因为必须复制所有数据（真正的 unice 使用写时复制）。使用线程会改变内存使用模式（更高的基本使用率，但每个线程的增加量较小），但很可能它仍然效率低下。

我建议您使用轮询的单进程方法，也可以使用非阻塞 IO。

# silverlight - 如何在水平 Silverlight 列表框中均匀分布项目

> ID：359098
> 
> 赞同：0
> 
> 时间：2008-12-11T11:55:20.307
> 
> 标签：silverlight

在 Silverlight 中，我有一个 Vertical ListBox，其中每个项目都有一个 Horizo​​ntal ListBox。我希望 Horizo​​ntalListbox 中的项目在父（垂直）ListBox 的宽度上均匀分布。我怎样才能做到这一点？

```
 <ListBox x:Name="MachineListBox" Background="Green">
        <ListBox.ItemTemplate>
            <DataTemplate>
            <ListBox ItemsSource="{Binding CoilList}" Background="Red" HorizontalAlignment="Stretch">
                    <ListBox.ItemsPanel>
                        <ItemsPanelTemplate>
                        <StackPanel 
                            HorizontalAlignment="Stretch"  />
                    </ItemsPanelTemplate                                >
                            </ListBox.ItemsPanel>

                    <ListBox.ItemTemplate >
                       <DataTemplate>
                                <TextBlock
                                    Text="{Binding Coil}"
                                     HorizontalAlignment="Stretch"/>
                        </DataTemplate>
                </ListBox.ItemTemplate>
            </ListBox>
        </DataTemplate>
            </ListBox.ItemTemplate>
    </ListBox> 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-11T14:02:28.927

我冒昧地建议您使用我自己发明的自定义控件。它被称为 ProportionalPanel，它可以满足您的需要 - 均匀地放置项目。您可以将它用于内部 ListBox 中的 ItemsPanel 而不是 StackPanel。我还提供了源代码，因此您可以随意调整逻辑。我博客上的相关帖子在[这里](http://itblobs.blogspot.com/2008/11/proportionalpanel-custom-control-for.html)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-11T18:48:24.917

我认为比例尺寸操作员会做你想要的。没试过，但听起来像是一个选择。宽度=“ `*" and Margin="2`*”。

# php - 我应该在 PHP 中使用哪个 Iterator 实现，为什么？

> ID：359099
> 
> 赞同：4
> 
> 时间：2008-12-11T11:55:26.450
> 
> 标签：php, design-patterns, iterator, spl

我正在尝试重构一个大型的旧项目，我注意到的一件事是一系列不同的迭代器实现：

```
while($iterator->moveNext()) {
    $item = $iterator->current();
    // do something with $item;
}   

for($iterator = getIterator(), $iterator->HasNext()) {
    $item = $iterator->Next();
    // do something with $item
}   

while($item = $iterator->fetch()) {
    // do something with item
} 
```

甚至是[StandardPHPLibrary (SPL)](http://www.php.net/~helly/php/ext/spl/)迭代器，它允许

```
foreach($iterator as $item) {
    // do something with $item
} 
```

拥有这么多不同的迭代器（使用不同的方法循环集合）似乎是一种强烈的代码气味，我倾向于将所有内容重构为 SPL。Iterator 的这些实现是否有令人信服的优势，还是纯粹是个人喜好问题？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-11T12:01:46.737

SPL 版本绝对是要走的路。它不仅是最容易阅读的，而且它现在是 PHP 的一部分，因此会为更多人所熟悉。

其他的没有什么“错误”，但正如你所说，在一个项目中拥有所有这些不同的版本对任何人都没有帮助。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-11T12:04:28.993

Imo，简单地使用一个或多个 SPL 库作为接口在前端使用中往往不那么难看。但是，实现背后的支持可能会有点难看。

例如，我编写了一个迭代器，它可以有效地迭代数据库结果集，因此从未请求过的结果永远不会从请求指针中获取，如果项目被过早获取（IE：$obj[5]），它会搜索所有所需的结果到一个内部缓冲区。

工作得非常好，你只是祈祷让幕后魔法永远不会失败的代码，因为当人们看到你使用看起来像数组的东西时，它会让人们感到困惑，而且它确实“魔法”可能会失败:)

魔术让人们在火刑柱上被烧死。因此，谨慎而明智地使用它，可能让它的工作原理一目了然。

我个人的偏好是

```
for( $object as $i => $v ) 
```

它的符号通常更一致和可预测。

```
for( $dbresult->iterator() as $i => $v ){ 

} 
```

样式符号在功能上是相同的，但至少你对它在表面上的工作方式的猜测更少。

# mousewheel - 在 GNU 屏幕中使用滚轮

> ID：359109
> 
> 赞同：267
> 
> 时间：2008-12-11T12:01:42.430
> 
> 标签：mousewheel, gnu-screen

如何设置 GNU 屏幕以允许鼠标滚轮在回滚缓冲区中滚动？我试着用谷歌搜索这个，但大多数点击都是关于如何允许屏幕内的应用程序使用滚轮。

* * *

## 回答 #1

> 赞同：378
> 
> 时间：2009-07-14T14:54:46.803

我相信你可以在你的`~/.screenrc`：

```
termcapinfo xterm* ti@:te@ 
```

其中“xterm*”是您当前 TERM 的全局匹配。要确认它有效，^A^D 从屏幕上分离，然后`screen -d -r`重新连接，然后`ls`几次，然后尝试向后滚动。这个对我有用。

* * *

这是什么魔法？好吧，让我们查阅手册页。

`screen(1)`说：

```
termcapinfo term terminal-tweaks [window-tweaks]
  [..]
  The first argument specifies which terminal(s) should be affected by this
  definition. You can specify multiple terminal names by separating them with
  `|'s. Use `*' to match all terminals and `vt*' to match all terminals that
  begin with "vt".
  [..]
  Some examples:

      termcap xterm*  LP:hs@

  Informs screen that all terminals that begin with `xterm' have firm
  auto-margins that allow the last position on the screen to be updated (LP),
  but they don't really have a status line (no 'hs' -  append  `@'  to turn
  entries off).  Note that we assume `LP' for all terminal names that start
  with "vt", but only if you don't specify a termcap command for that terminal. 
```

来自`termcap(5)`：

```
String capabilities
    [..]
    te   End program that uses cursor motion
    ti   Begin program that uses cursor motion 
```

* * *

## 回答 #2

> 赞同：76
> 
> 时间：2009-01-24T02:01:32.273

在屏幕中，您必须先进入“回滚模式”（或“复制模式”）才能在回滚缓冲区中滚动：组合键`Ctrl`-`a` `Esc`或`Ctrl`- `a` `Ctrl`- `[`。`Ctrl`然后您可以使用向上和向下键（或- `b`, `Ctrl`-`f`移动页面）滚动历史记录。

在该模式下，您的鼠标滚轮也应该可以工作，如果它在其他应用程序中工作的话。你用 . 结束“回滚模式” `Esc`。

至于在不先进入回滚模式的情况下滚动回滚缓冲区，如果不修改屏幕，这可能是不可能的。除了回滚模式，我从未听说过访问回滚缓冲区的方法。

* * *

## 回答 #3

> 赞同：24
> 
> 时间：2010-08-13T07:22:28.563

Jon Z 所指的优秀文章不再可用，但我能够从 Google 缓存中找到它的纯文本版本。我把它保存在这里，以防谷歌将来也放弃它。原始帖子由 Mikael Ståldal 撰写，因此应归功于应得的信用。

--

**如何在 GNU Screen 中使用鼠标滚轮**

GNU Screen 支持回滚，但默认情况下您必须使用笨拙的键才能使用它。我希望能够使用 Shift-PageUp、Shift-PageDown 和鼠标滚轮来滚动，就像在 xterm 中一样。

为此配置Screen并不容易，需要与终端模拟器配合。但我终于设法实现了一个效果很好的解决方案。将此添加到您的 ~/.Xresources 文件中（您需要注销才能生效）：

```
XTerm*saveLines: 0
XTerm*vt100.translations: #override \n\
  Ctrl <Btn4Down>: string(0x1b) string("[25S") \n\
  Lock Ctrl <Btn4Down>: string(0x1b) string("[25S") \n\
  Lock @Num_Lock Ctrl <Btn4Down>: string(0x1b) string("[25S") \n\
  @Num_Lock Ctrl <Btn4Down>: string(0x1b) string("[25S") \n\
  <Btn4Down>: string(0x1b) string("[5S") \n\
  Ctrl <Btn5Down>: string(0x1b) string("[25T") \n\
  Lock Ctrl <Btn5Down>: string(0x1b) string("[25T") \n\
  Lock @Num_Lock Ctrl <Btn5Down>: string(0x1b) string("[25T") \n\
  @Num_Lock Ctrl <Btn5Down>: string(0x1b) string("[25T") \n\
  <Btn5Down>: string(0x1b) string("[5T") \n\
  Shift <KeyPress> Prior: string(0x1b) string("[25S") \n\
  Shift <KeyPress> Next: string(0x1b) string("[25T") \n 
```

然后将其添加到您的 ~/.screenrc 文件中：

```
defscrollback 1000

# Scroll up
bindkey -d "^[[5S" eval copy "stuff 5\025"
bindkey -m "^[[5S" stuff 5\025

# Scroll down
bindkey -d "^[[5T" eval copy "stuff 5\004"
bindkey -m "^[[5T" stuff 5\004

# Scroll up more
bindkey -d "^[[25S" eval copy "stuff \025"
bindkey -m "^[[25S" stuff \025

# Scroll down more
bindkey -d "^[[25T" eval copy "stuff \004"
bindkey -m "^[[25T" stuff \004 
```

这适用于 xterm。我不确定它是否适用于其他终端模拟器。

请注意，这会禁用 xterm 中的正常滚动支持，您只能在使用 Screen 时滚动。您可能希望像这样启动 xterm 以始终使用 Screen：

```
xterm -e screen 
```

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2012-11-29T14:58:42.813

对于 OS X (Snow Leopard)，以下对我有用：

[http://slaptijack.com/system-administration/mac-os-x-terminal-and-gnu-screen-scrollback/](http://slaptijack.com/system-administration/mac-os-x-terminal-and-gnu-screen-scrollback/)

简而言之，它涉及将以下内容添加到远程主机上的 ~/.screenrc（您正在运行 screen 的主机）：

```
defscrollback 5000
termcapinfo xterm* ti@:te@ 
```

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2011-10-24T16:09:26.007

并在 GNU Screen 内的 VIM 中使用滚轮：

[.vimrc]

```
set mouse=a             " hold shift to copy xterm
set ttymouse=xterm2     " necessary for gnu screen & mouse 
```

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2012-11-12T12:24:14.363

按`Ctrl`+`a`后跟`[`

终端的标题栏现在应该显示复制模式。

现在箭头键和鼠标滚轮应该可以正常工作了。

要恢复正常，请按 Esc 或按 Enter 几次。

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2014-10-06T07:02:38.950

在运行屏幕之前将`TERM`变量设置为`vt100`而不是也可以。 我已经使用了很长时间，就像一个魅力。`xterm`

将此添加到您的`.bashrc`：

```
# make scrollbar / wheel scrolling work when running screen in gnome-terminal (or other)
if [ "$TERM" = "xterm" ]; then
  export TERM=vt100
fi 
```

--

作为参考，我`.screenrc`有这个（这个 AFAIK 不需要）：

```
# Extend the vt100 desciption by some sequences.
termcap  vt100* ms:AL=\E[%dL:DL=\E[%dM:UP=\E[%dA:DO=\E[%dB:LE=\E[%dD:RI=\E[%dC
terminfo vt100* ms:AL=\E[%p1%dL:DL=\E[%p1%dM:UP=\E[%p1%dA:DO=\E[%p1%dB:LE=\E[%p1%dD:RI=\E[%p1%dC 
```

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2014-01-20T13:51:47.140

以下在 Cygwin 和 Putty 中都对我有用：编辑 .screenrc 并添加

```
terminfo xterm* ti=:te= 
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2017-02-14T20:28:53.627

如果上面的答案对您不起作用，请确保您的 .screenrc 中没有设置**标题**或**alwayslastline**选项。如果你有它们，这将不起作用：

```
termcapinfo xterm* ti@:te@ 
```

如果您需要此信息，可以尝试将其设置在终端标题中（带有`termcapinfo`）

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2017-07-22T12:56:33.973

使用“Ubuntu 16.04.2 LTS”时的解决方案如下：

一种）。更新*$HOME/.screenrc*之前的答案已指定：

```
termcapinfo xterm* ti@:te@ 
```

乙）。使用“设置”。“首选应用程序”将默认终端更改为 xterm，方法是在下拉列表中选择“X 终端”。

一些多余的注释

*   即使我将 termcapinfo 行更改为“*”而不是“xterm*”，其他任何终端（包括安装“lxterminal”）都没有为我工作。

*   通过单击屏幕左上角的菜单按钮，您可以使用右下角的第三个图标进入设置对话框。

# deployment - How you deploy your reports (with Reporting Services)

> ID：359112
> 
> 赞同：16
> 
> 时间：2008-12-11T12:02:15.550
> 
> 标签：deployment, reporting-services

Which one you choose?

*   Use the Deploy feature in VS
*   Build a rss script and execute it through rs.exe
*   Build a deployment package
*   Another option

Keep in mind that in many of your environments the report developers/designers don't have publish role in Reporting Server.

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-11T17:53:42.517

在 Dev 中，我们使用 VS 中的部署功能。在 Prod 中，我们的 Prod 支持团队要么从 ReportServer 网站手动上传它们（如果只是一两个报告），要么使用我们编写的简单报告上传实用程序。该实用程序使用 SSRS Web 服务。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-16T15:35:15.433

对于开发人员，我们有一个定制的 ReportDeployer，我们可以在其中选择要部署到的环境（开发、测试、生产）和要部署的分支（还有开发、测试、生产）。有一个配置文件，其中包含所有可用于部署的报告及其目录结构。

对于生产构建，ReportDeployer 有一个命令行界面，我们的构建脚本从 TFS 中的 Prod 分支提取最新报告，然后使用我们的自定义应用程序部署所有报告。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-08-19T16:22:59.237

开发人员可以使用 Visual Studio 中的 deploy 命令发布到开发。管理员使用 rsscripter 将报告从 dev 移动到 prd。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-04-04T14:00:47.670

我们使用 rss 脚本从文件夹中获取所有报告并将它们上传到给定的报告服务器。

# batch-file - 批处理如何正确结束for循环

> ID：359120
> 
> 赞同：4
> 
> 时间：2008-12-11T12:06:05.510
> 
> 标签：batch-file, for-loop, cmd

出于测试目的，我需要一个包含一些文件的递归目录，该目录具有最大路径长度。

用于创建的 Script 仅包含两个 for 循环，如下所示：

```
for /L %%a in (1 1 255) do @(
    mkdir %%a
    && cd %%a
    && for /L %%b in (1 1 %random%) do @(
            echo %%b >> %%a.txt
        )
) 
```

现在我想将此脚本作为另一个脚本的一部分嵌入，因为还有更多工作要做，但我不能在它周围添加任何其他命令，否则它会拒绝工作。我在 windows vista 下使用它，如果这对你有用的话。

如果我`"@ECHO OFF`在第一行写“ `echo done`”，在最后一行写“”也不行。

命令行输出是：

```
X:\Scripte>recursive.cmd
OFFfor /L %a in (1 1 255) do @( mkdir %a
The system cannot find the path specified. 
```

编辑：似乎是第 8 层的问题，问题似乎出在使用的命令外壳中，如果使用裸 cmd.exe，它可以工作，使用 Visual Studio 2008 命令外壳它不起作用，如上所述。

无论如何，谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-03-09T14:21:12.560

我不明白如何在答案下方添加一点评论，所以我就在这里做。

仅当 echo 尚未关闭时，才需要左括号前面的 @ 符号。在这种情况下，如果没有 @ 符号，将会回显 FOR 循环中的每个命令。

而且，是的，需要 && 的原因是文本编辑器将它们全部放在一行上。但是没有人发布解决方案。只需复制并粘贴到记事本中，然后根据需要分隔行。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-11T12:11:45.887

我认为您不需要括号前面的“@”或 for 循环体内的“&&”；括号负责处理 for 循环中的多个语句。

以下对我有用：

```
@echo OFF

for /L %%a in (1 1 255) do (
    @echo a = %%a
    mkdir %%a
    cd %%a
    for /L %%b in (1 1 %random%) do (
        echo %%b >> %%a.txt
    )
)

@echo done 
```

# c# - 依赖注入替代方案

> ID：359122
> 
> 赞同：14
> 
> 时间：2008-12-11T12:06:32.280
> 
> 标签：c#, dependency-injection

我正在研究依赖注入，我可以看到它的好处，但我遇到了它创建的语法问题。我有这个例子

```
public class BusinessProducts
{
   IDataContext _dx;

   BusinessProducts(IDataContext dx)
   {
      _dx = dx;
   }

   public List<Product> GetProducts()
   {
    return dx.GetProducts();
   }
} 
```

问题是我不想写

```
BusinessProducts bp = new BusinessProducts(dataContextImplementation); 
```

我会继续写

```
BusinessProducts bp = new BusinessProducts(); 
```

因为我觉得第一种选择感觉不自然。我不想知道 BusinessProduct “依赖”什么来获得产品，而且我觉得它使我的代码更难读。

这种方法是否有任何替代方法，因为我想保留用于创建对象的原始语法，但我希望在单元测试时仍然能够伪造依赖关系，或者这种依赖注入框架可以为我做些什么？

我正在用 c# 编码，但欢迎使用其他语言的替代品

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-12-11T12:32:26.703

我为我的上下文使用工厂并注入它，如果提供的工厂为空，则提供合适的默认值。我这样做有两个原因。首先，我将数据上下文用作工作单元范围的对象，因此我需要能够在需要时创建它们，而不是保留一个。其次，我主要使用 DI 来增加可测试性，而解耦只是次要考虑。

所以我的商业产品类看起来像：

```
public class BusinessProducts
{
     private IDataContextFactory DataContextFactory { get; set; }  // my interface

     public BusinessProducts() : this(null) {}

     public BusinessProducts( IDataContextFactory factory )
     {
          this.DataContext = factory ?? new BusinessProductsDataContextFactory();
     }

     public void DoSomething()
     {
          using (DataContext dc = this.DataContextFactory().CreateDataContext())
          {
             ...
          }
     } 
```

另一种方法是使工厂属性可公开设置，并通过设置属性注入备用工厂。无论哪种方式，如果要保留 null 构造函数，都需要提供默认值。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-11T12:18:44.470

您可以创建一个工厂。DI 容器最适合在设置时发生的接线 - 而不是在运行时（看起来就是这种情况）。工厂可以以不同的方式实现，具体取决于它需要的可插拔性以及您需要使用它的位置。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-12-11T12:36:10.207

我通常会有一个空的构造函数，它使用一个实体实例（或由 IoC 创建的实例），以及一个带有 DI 的构造函数。IE

```
public class BusinessProducts
{
   IDataContext _dx;

   BusinessProducts()
   {
      _dx = new SolidDataContext();
   }

   BusinessProducts(IDataContext dx)
   {
      _dx = dx;
   }
} 
```

这样，您可以使用 DI 在单元测试测试中覆盖默认实例。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-12-11T15:17:41.333

你的感觉虽然有效，但却是错误的。

[依赖注入](http://en.wikipedia.org/wiki/Dependency_injection)模式是[控制反转](http://en.wikipedia.org/wiki/Inversion_of_Control)原则的直接应用。

这意味着，不是您的类控制它使用的其他类的实例，而是*反转*关系并为其提供依赖关系。

因此，您的类自然会通过构造函数参数或属性公开它们的依赖关系。对这种结构表现出不屑一顾表示你还没有真正理解这种模式。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-12-11T12:15:25.287

这里有两种不同的情况：

在生产代码中你*永远不会*写

```
new BusinessProducts(dataContextImplementation) 
```

因为依赖注入通常会为您创建完整的对象层次结构。这是依赖注入模式的“病毒”性质，它们倾向于完全控制您的服务创建。

在单元测试代码中，您通常会自己创建它，但通常您会提供一个模拟对象或 dataContextImplementation 的存根实现。所以通常你会注入一个没有大量后续依赖的对象。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-11T12:10:37.030

[http://springframework.net/](http://springframework.net/)和[http://structuremap.sourceforge.net/Default.htm](http://structuremap.sourceforge.net/Default.htm)可能是最常用的基于 .NET 的语言的 DI 框架，它们都可以满足您的需求。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-11T12:28:37.210

通常，框架本身将具有构建整个对象树的逻辑。例如，而不是

```
new SomeObjectO(diContext) 
```

你可以这样调用框架：

```
DIFramework.GetNew<SomeObjectO>(); 
```

或者

```
DIFramework.Get<SomeObject>(); 
```

如果您想了解 DI 和流程，可以看看另一个有趣的框架是 Microsoft 的 Unity 和 Object Builder 项目。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-12-11T12:55:31.527

如果你真的不喜欢在构造函数中注入这个实例，你可以尝试将[CommonServiceLocator](http://www.codeplex.com/CommonServiceLocator)与你最喜欢的兼容 .NET 依赖注入框架一起使用。这将允许您编写如下代码：

```
public class BusinessProducts
{
   IDataContext _dx;

   BusinessProducts()
   {
      _dx = Microsoft.Practices.ServiceLocation.ServiceLocator.Current.GetInstance<IDataContext>();
   }

   public List<Product> GetProducts()
   {
    return dx.GetProducts();
   }
} 
```

但是，请注意，当大多数人知道您使用依赖注入框架时，这并不是他们所期望的。我认为使用依赖注入框架并让它为您创建所有对象更为常见。

```
BusinessProducts bp = Microsoft.Practices.ServiceLocation.ServiceLocator.Current.GetInstance<BusinessProducts>(); 
```

如果您想避免依赖注入框架路径，使用工厂可能是最好的方法。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-12-11T14:07:32.550

有一种技术叫做穷人的 DI，看起来像这样

```
public class BusinessProducts
{
   IDataContext _dx;

   BusinessProducts() : this(new DataContext()) {}

   BusinessProducts(IDataContext dx)
   {
      _dx = dx;
   }

   public List<Product> GetProducts()
   {
    return dx.GetProducts();
   }
} 
```

这并不理想，因为它将您与实现联系在一起，但它是实现解耦代码的良好垫脚石。这类似于@tvanfosson，但要简单得多。

我赞成温莎的建议

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-12-11T14:21:45.423

我的代码将引用 Microsoft Unity，但我确信它非常适用于所有 DI 框架。如果您正确使用 DI，则无需调用 new BusinessObject(new dataContext)，DI 关联将为您处理一切。

我的示例会有点长，因为我将粘贴一些用于运行由 Unity 完全加载的 DI 的模型视图演示器网站的代码。（如果你想要完整的源代码，请查看我的博客并从我的 Assembla SVN 服务器下载）

加载容器（可以是我喜欢的代码或使用配置）

```
protected void Application_Start(object sender, EventArgs e)
{
    Application.GetContainer()
        // presenters / controllers are per request                 
        .RegisterType<IEmployeeController, EmployeeController>(new ContextLifetimeManager<IEmployeeController>())

        //Data Providers are Per session                
        .RegisterType<IEmployeeDataProvider, EmployeeDataProvider>(new SessionLifetimeManager<IEmployeeDataProvider>())

        //Session Factory is life time
        .RegisterType<INHibernateSessionManager, NHibernateSessionManager>(new ContainerControlledLifetimeManager());
} 
```

自定义 HTTP 模块在 OnPreRequest 调用期间为每个页面调用 Unity BuildUp 方法。

```
private static void OnPreRequestHandlerExecute(object sender, EventArgs e)
{
    var handler = HttpContext.Current.Handler;
    HttpContext.Current.Application.GetContainer().BuildUp(handler.GetType(), handler);

    // User Controls are ready to be built up after the page initialization is complete
    var page = HttpContext.Current.Handler as Page;
    if (page != null)
    {
        page.InitComplete += OnPageInitComplete;
    }
} 
```

用 [Dependency] 属性装饰的页面容器展示器

```
public partial class Employees : Page, IEmployeeView
{
    private EmployeePresenter _presenter;

    [Dependency]
    public EmployeePresenter Presenter
    {
        set
        {
            _presenter = value;
            _presenter.View = this;
        }
    }
} 
```

带有 InjectionConstructor 方法的 Presenter

```
public class EmployeePresenter : Presenter<IEmployeeView>
{
    private readonly IEmployeeController _controller;

    [InjectionConstructor]
    }
    public EmployeePresenter(IEmployeeController controller)
    {
        _controller = controller;
} 
```

控制器跟风

```
public class EmployeeController : IEmployeeController
{
    private readonly IEmployeeDataProvider _provider;

    [InjectionConstructor]
    public EmployeeController(IEmployeeDataProvider DataProvider)
    {
        _provider = DataProvider;
    }
} 
```

与提供者相同

```
public class EmployeeController : IEmployeeController
{
    private readonly IEmployeeDataProvider _provider;

    [InjectionConstructor]
    public EmployeeController(IEmployeeDataProvider DataProvider)
    {
        _provider = DataProvider;
    }
} 
```

最后是会话管理器，它只包含一个常规构造函数。

```
public class NHibernateSessionManager : INHibernateSessionManager
{   
    private readonly ISessionFactory _sessionFactory;

    public NHibernateSessionManager()
    {            
        _sessionFactory = GetSessionFactory();
    }
} 
```

那么当一个页面请求启动时，HttpModule 在页面上调用 BuildUp() 方法会发生什么。然后，Unity 会看到标有 Dependency 属性的 Property，并将检查它的容器以查看其中是否存在 EmployeePresenter 对象。

由于容器中没有这样的对象，因此它将尝试创建一个 EmployeePresenter。在检查创建它在 Presenter 中看到的类时，它需要一个需要将 IEmployeeController 注入其中的构造函数。由于容器实际上有一个控制器的管理器，它将查看容器中是否存在它的实例，而在页面请求的开头不存在，因此它将实例化控制器。

然后，Unity 将看到控制器需要注入 IEmployeeDataProvider，它将继续此过程，直到最终到达 Provider 需要注入会话管理器的地步。由于会话管理器不再需要注入，Unity 将创建会话管理器的一个实例，将其存储在容器中，因为它给定了 ContainerLifeTimeManager，将其注入提供者并存储该实例，依此类推，直到它完成创建一个页面的 EmployeePresenter 依赖项。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-12-11T12:16:18.780

您还可以查看[Windsor](http://www.castleproject.org/container/index.html) for IoC 。

# c - 如何将数据存储在可变长度数组中而不导致内存损坏？

> ID：359125
> 
> 赞同：2
> 
> 时间：2008-12-11T12:07:33.010
> 
> 标签：c, memory-management

这是一个相当基本的问题，由于某种原因，目前我没有找到合适的解决方案。我正在处理一个声明以下结构的第 3 方 SDK：

```
struct VstEvents
{
    VstInt32 numEvents;  ///< number of Events in array
    VstIntPtr reserved;  ///< zero (Reserved for future use)
    VstEvent* events[2]; ///< event pointer array, variable size
}; 
```

即使这是一个“可变大小”数组，它也是静态声明的。所以很明显，如果我创建一个 VstEvents 对象，将 numEvents 设置为某个值，然后通过并开始将它们添加到数组中，这将导致内存损坏。

那么我应该如何正确处理这样的结构呢？我应该分配我自己的 VstEvent* 数组，然后将 events[0] 指向它吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-11T12:13:32.000

你需要预先分配一块足够大的内存来包含整个东西+你想要的任何其他记录......

```
struct VstEvents
{
    VstInt32 numEvents;  ///< number of Events in array
    VstIntPtr reserved;  ///< zero (Reserved for future use)
    VstEvent* events[2]; ///< event pointer array, variable size
};

#define numEventsRequired 10
VstEvents *vstEvents = (VstEvents*)malloc(sizeof(VstEvents) + sizeof(VstEvent*)*(numEventsRequired-2));

vstEvents->numEvents = numEventsRequired; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-11T12:12:28.400

如果你知道有多少，你可以分配它

```
struct VstEvents *evnts;

evnts = (struct VstEvents*)malloc(sizeof(struct VstEvents) + 
                                  numEvents*sizeof(VstEvent*)); 
```

这将分配 2 个**额外的**插槽

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-13T06:31:51.727

你的第三方库有点奇怪。您需要区分两种“可变大小的数组”

*   **数组的大小在分配数组时是已知的，**此后**永远不会改变**。这是一个简单的案例，我在下面展示了一个 C99 习语。

*   **分配数组时的最终大小是未知的，**并且**数组可能需要**在其生命周期内增长。对于这样的事情，我建议您在 Dave Hanson 的[C Interfaces and Implementations](http://www.cs.princeton.edu/software/cii/)的源文件 seq.c 中查看 Seq_T 的实现。你可以很容易地调整他的代码。

如果您在分配时知道大小，则 C99 习语是这样的：

```
struct VstEvents
{
    VstInt32 numEvents;  ///< number of Events in array
    VstIntPtr reserved;  ///< zero (Reserved for future use)
    VstEvent* events[];  ///< event pointer array, variable size
};

struct VstEvents *alloc_vst_events(int num_events) {
  struct VstEvents *p = 
            malloc(sizeof(*p) + num_events * sizeof(p->events[0]));
  return p;
} 
```

关键是结构中那个奇怪的数组，其大小未指定。需要 C99。

既然你被第三者的怪异所困，我会试试这个：

```
#define NELEMS(A) (sizeof(A) / sizeof((A)[0]))

struct VstEvents *alloc_vst_events(int num_events) {
  struct VstEvents *p;
  int events_needed = num_events - NELEMS(p->events);
  p = malloc(sizeof(*p) + events_needed * sizeof(p->events[0]));
  return p;
} 
```

免责声明：**我没有通过编译器推送此代码**。欢迎指正。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-12-11T12:13:10.567

该结构声明的是一个指向 VstEvent 对象的指针数组（大小为 2）。您应该分配一个 VstEvent 并将其分配给 events[0]，将 numEvents 设置为 1。如果您有 2 个 VstEvents，则分配另一个 VstEvent，将其分配给 events[1]，并将 numEvents 设置为 2。如果您需要 2 个以上，那么您需要对 VstEvents 执行 realloc 以增加其大小，以便事件包含您需要的指针数量并根据需要分配给 2、3、4、...。或者，如果您提前知道需要存储多少事件，您可以按照@SDX2000 显示的最初分配它。

我认为基本思想是为了方便起见，他们用大小 2 声明它，这样如果你只有 1 或 2，你不需要做额外的 malloc 来调整事件数组的大小。

# performance - 如何加快 Crystal Reports 11 的打印速度？

> ID：359126
> 
> 赞同：0
> 
> 时间：2008-12-11T12:07:56.457
> 
> 标签：performance, crystal-reports

我正在使用 Crystal Reports 11（和 VB6）打开报表文件，从 Access 数据库加载数据，然后将报表打印到打印机或将报表导出到另一个 .rpt 文件（以便以后在没有数据库的情况下打印）

即使对于少量数据，该过程也有些慢。分析显示三个记录（一页）大约 1.5 秒对于 10 页上的大约 500 条记录，它是 1.7 秒。

我可以做些什么来加快速度吗？我可以调整数据或报告吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-11T14:48:43.433

看到没有其他回复，我只会发布我真正的想法，老实说，我希望我的 Crystal Reports 11 应用程序和你的一样快。在我的应用程序中，有很多被隐藏的字段和部分，Crystal 只需拖动大约一分钟即可生成任何报告。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-28T10:59:11.787

这只是一个想法，但我会首先尝试在服务器上构建一个视图，以便 CR 可以直接访问报表的数据，而无需处理任何连接或过滤器或用户方面的任何事情。在显示报告之前，我已经阅读了关于 CR 多次使用相同的查询查询服务器的可怕事情......

# winforms - 如何在 .net windows 窗体中“模糊”选定的 ComboBox？

> ID：359128
> 
> 赞同：1
> 
> 时间：2008-12-11T12:08:49.763
> 
> 标签：winforms, combobox

单击 ComboBox 时，会导致它在窗口中被选中。有没有办法执行相当于 javascript blur()

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-11T12:19:55.467

不是直接的。不过，您可以尝试关注组合框或其他元素的根父级。

```
comboBox1.TopLevelControl.Focus(); 
```

或者

```
someControl.Focus(); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-06-14T08:55:56.040

我遇到了类似的问题，我设法通过禁用和重新启用组合框来解决它。

```
comboBox1.Enabled = false;
comboBox1.Enabled = true; 
```

# java - JSP 中的屏蔽 url

> ID：359147
> 
> 赞同：3
> 
> 时间：2008-12-11T12:15:34.057
> 
> 标签：java, jsp, url, jakarta-ee

与此问题相关： [使用 UrlRewrite 在 JSP 中替换 URL 字符](https://stackoverflow.com/questions/353207/url-characters-replacement-in-jsp-with-urlrewrite)

我想在这个 JSP Java EE web 项目中屏蔽 URL。例如，如果我有这个：

```
http://mysite.com/products.jsp?id=42&name=Programming_Book 
```

我想将该 URL 转换为对用户/Google 更友好的内容，例如：

```
http://mysite.com/product-Programming-Book 
```

我一直在使用 UrlRewrite、转发和 RequestDispatcher 来完成我想要的事情，但我有点迷路了。我可能应该对所有 http 请求都有一个过滤器，重新格式化它们，然后转发页面。

任何人都可以给一些指示吗？尖端？

非常感谢。

**更新：** Servlet 做到了。感谢 Yuval 的指导。我一直在使用 UrlRewrite，正如您在问题的第一句话中看到的那样，我还问了一个关于此的问题。但我无法按照我想要的方式让 UrlRewrite 工作。Servlet 完成了这项工作。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-15T08:14:16.803

你可以使用一个`URLRewrite filter`. 这就像 mod_rewrite 是如何用于 Apache 的 HTTP Web 服务器的。

[http://tukey.org/urlrewrite/](http://tuckey.org/urlrewrite/)

"重定向一个网址

```
<rule>
<from>^/some/old/page\.html$</from>
<to type="redirect">/very/new/page.html</to>
</rule> 
```

微小/友好的网址

```
<rule>
<from>^/zebra$</from>
<to type="redirect">/big/ugly/url/1,23,56,23132.html</to>
</rule> 
```

"

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-11T13:19:13.490

我已经有一段时间没有处理 JSP 了，但是如果你没记错的话，你可以将 URL 模式添加到你的 web.xml（或其中一个 XML 配置文件），并让 servlet 引擎自动将请求路由到你选择的有效 URL的参数。如果你愿意，我可以查看详细信息。

在您的情况下，映射`http://mysite.com/product-Programming-Book`到 URL `http://mysite.com/products.jsp?id=42&name=Programming_Book`并且用户不再看到真实的 URL。此外，您可以在应用程序中使用这个对用户更友好的 URL，作为该页面的逻辑名称。

尤瓦尔=8-)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-11T20:58:07.230

通常，您使用 Apache 来处理您的应用程序。如果是这样，请考虑使用 Apache 的 mod_rewrite。[http://httpd.apache.org/docs/1.3/mod/mod_rewrite.html](http://httpd.apache.org/docs/1.3/mod/mod_rewrite.html)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-05-28T20:20:46.470

一方面，我建议您在应用程序中处理此问题，而不是依赖外部重写，例如通过 Apache mod_rewrite （除非您确定这是最快的方法。）

但首先有几件事：

我不会转换这个：

[http://mysite.com/products.jsp?id=42&name=Programming_Book](http://mysite.com/products.jsp?id=42&name=Programming_Book)

进入这个：

[http://mysite.com/product-Programming-Book](http://mysite.com/product-Programming-Book)

看，如果我只看你的书示例，我看不出以前的 URL 有什么问题。之后，这一切都适用于亚马逊。并且没有像谷歌友好的 URL（只有用户友好的 URL）这样的东西。你必须考虑为什么要进行这种类型的重写，以及如何进行。例如，在您的重写选项中，id 在哪里？

也就是说，您必须定义一个逻辑规则来定义

您要显示的唯一页面，以及可以识别每个页面的唯一参数组合。

例如，使用您的书柜。假设您可以使用以下规则识别任何书籍：

1.  由国际标准书号
2.  按作者姓名、标题和适用版本（如果缺少版本，假定为最新版本）
3.  如果 ISBN 包含在作者姓名、标题和/或版本中，则忽略除 ISBN 之外的所有内容。也就是说，将其视为前者（或更准确地说，当存在 ISBN 时，忽略所有其他书籍标识参数。）

使用 ?parametrized url 方案，您将有以下可能性：

```
http://yoursite/products?isbn=123465
http://yoursite/products?author=johndoe&title="the cookbook" << this assumes the latest edition, or 1 if first.
http://yoursite/products?author=johndoe&title="the cookbook"&edition=3
http://yoursite/products?title="the cookbook"&author=johndoe
http://yoursite/products?edition=3&title="the cookbook"&author=johndoe
.... 
```

依此类推，适用于所有组合。因此，在您寻找技术实现之前，您必须非常仔细地考虑您将如何做到这一点。您必须创建语法和参数层次结构（例如，作者总是在标题之前，标题总是在版本之前）。

所以你最终会得到以下结果（使用与作者 John Doe 相同的示例，他的书在第 3 版中）：

```
http://yoursite/product/isbn/12345
http://yoursite/product/author/johndoe/the%20cookbook << see the %20 for encoding spaces (not a good idea, but something to take into account)
http://yoursite/product/author/johndoe/the%20cookbook/3 
```

任何其他组合都应该生成错误或巧妙地找出如何重写“大炮”版本并使用适当的 URL 目标向客户端发送 HTTP 3xx。

一旦你解决了这些细节，你就可以问问自己付出的努力是否值得或必要。

因此，如果您发现自己需要这样做，那么最简单和最便宜的 DIY 方法是编写一个过滤器来解析 url，分解参数，为 JSP 页面创建一个 ?parametrized url 字符串，获取它的 RequestDispatcher 并转发给它。

您不想进行 URL 重写，因为这些会在服务器和客户端之间来回的 HTTP 303/307 中产生。或者至少您希望将其保持在最低限度。

# vbscript - 是否有任何免费/开源的 vbscript 编译器？

> ID：359166
> 
> 赞同：6
> 
> 时间：2008-12-11T12:23:14.883
> 
> 标签：vbscript, wmi

我需要将 wmi vbscript 编译为可执行文件（以在多台计算机中自动配置）。任何免费的 vbscript 编译器或任何其他建议？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-07T16:15:55.800

在执行此操作时我会特别担心的一件事是您必须真正信任正在编译脚本的产品。毕竟，嵌入病毒或蠕虫病毒的最佳方法是提供免费的编译器，将您的 VBScript 编译成不可读的可执行文件。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-09-08T13:42:43.363

目前，最著名的开源客户端 vbscript 是 baleas2。

如果说的是服务器端vb之类的脚本，那么选项列表就很大如下：instant-asp (ib4j-tomcat, java), rbsp (realbasic-server-pages), pbsp (purebasic-server-pages), run-basic (libertybasicscript) 等几乎所有完全开发的 vb 商业替代品。

关于 basicwebscripting 领域中其他基于 Windows 的开源基本变体，目前有 maven-sb4j、scriptbasic 和 gbs3（gambas 服务器页面）。然后 freebasic 服务器页面可能很快会成为未来的另一种选择（在开发 curl 和 proxyserver / fastcgi 支持之后）。

您也可以尝试将 maven-sb4j 用于 jbasic、jabaco、scriptbasic-japi 和 yabasic-japi。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-01-07T13:14:56.743

试试[http://www.xneat.com/application-builder/index.htm](http://www.xneat.com/application-builder/index.htm)

看起来值得信赖

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-18T18:43:29.897

好吧，我想这很有趣，我完全理解你的观点！

[您可以在此处](http://www.microsoft.com/downloads/details.aspx?familyid=E7877F67-C447-4873-B1B0-21F0626A6329&displaylang=en)使用 WSH 编码器（Windows 脚本宿主），它是免费的，您可以加密您的脚本，这样就没有人可以阅读它们（只是那些不好奇的！）

如果您正在寻找一些强大而艰苦的工作以及加密，您可以[在这里尝试这本书](http://sites.google.com/site/martanifayssal/pro-decrypting-vbscript-viruses)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-10-31T07:17:17.883

试试vbs转exe。它是命令行，但工作正常。 [http://www.f2ko.de/programs.php?lang=en&pid=v2e](http://www.f2ko.de/programs.php?lang=en&pid=v2e)

# c# - 将现有表映射到 C# 中的域类

> ID：359167
> 
> 赞同：2
> 
> 时间：2008-12-11T12:23:20.077
> 
> 标签：c#, sql, sql-server, dns

我什至不知道我是否使用了正确的术语，但这里是：

有没有办法通过工具或其他方式自动将 SQL Server 中的表及其关系映射到域（C# 代码）？

我使用了 nhibernate 插件，但它在 .cs 中创建了一个文件，在 xml 中创建了另一个文件，该文件具有映射，但我希望该映射在 .cs 文件中显示为“属性”。

抱歉，如果这有点令人困惑。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-11T12:26:27.013

你总是可以使用[Entity Framework](http://msdn.microsoft.com/en-us/library/bb399572.aspx)或者[Linq2SQL](http://msdn.microsoft.com/en-us/library/bb386976.aspx)，但我不熟悉它是如何工作的。

Tho，在 EF 和 NHibernate 之外，我更喜欢 NHibernate。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-13T06:43:47.863

看看[亚音速](http://subsonicproject.com/)。它将生成您的 DAL，还可以生成自定义模板的代码。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-11T12:26:38.667

使用 Linq 2 Sql 的 LLBLgen（在 VS 2008 中可用）。或者使用实体框架（在 VS 2008 SP1 中）。Linq 2 sql 允许您将表从 sql server 拖放到画布，它会为您创建一个域类，并将属性映射到列。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-11T12:26:44.033

看看 Fluent NHibernate，看看这是否是您正在寻找的： http: [//blog.jagregory.com/2008/08/08/introducing-fluent-nhibernate/](http://blog.jagregory.com/2008/08/08/introducing-fluent-nhibernate/)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-11T12:27:51.800

您可以使用使用属性的[Castle ActiveRecord 。](http://castleproject.org/activerecord/index.html)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-11T12:28:14.827

我认为您应该阅读一些有关 Linq to Sql 的信息

[http://searchwindevelopment.techtarget.com/tip/0,289483,sid8_gci1269859,00.html#](http://searchwindevelopment.techtarget.com/tip/0,289483,sid8_gci1269859,00.html#)

# scripting - 使用 psexec 的嵌套调用出现问题（访问被拒绝）

> ID：359186
> 
> 赞同：2
> 
> 时间：2008-12-11T12:27:57.743
> 
> 标签：scripting, batch-file, cluster-analysis, psexec

首先，对不起我糟糕的英语。我会尝试解释我的问题。

我在脚本中使用 psexec 来重新启动集群，如下所示：

node1 中的 script1：在 node1 中执行大量任务（关闭服务、检查状态等），并在使用 psexec 完成所有任务启动后，在 node2 中执行 script2（psexec-d \ node2 script2）

node2 中的 script2：执行大量任务并在 node1 中启动 script3。这是，当我尝试在 node1 中运行 script3 时，我在 psexec 中收到“拒绝访问”。(psexec -d \\ nodo1 script3)

我使用属于组管理员的用户启动脚本

出于安全原因，我无法传递用户名和密码，因为将凭据留在 .bat 文件中是不安全的。

附加信息：

我在 W2k3 服务器上运行脚本 我尝试了 net use 并且一切正常 我尝试了带有 -u 用户名和 -p 用户名的 psexec 并且一切正常 我尝试使用以下语法执行 psexec： psexec .exe -d \node1 cmd.exe "script3.bat" 并返回相同的错误。

非常感谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-11T16:06:23.433

最后我决定在第二个脚本中使用看门狗进程，所以脚本将由这个进程启动，而不是由 psexec 启动。

非常感谢您的帮助和您为帮助我所付出的时间。

此致

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-11T12:37:05.633

这可能与使用集成身份验证从太多链接服务器跃点获得的问题有关 -[**双跃点 Kerberos 问题**](http://support.microsoft.com/kb/887682)。

由于集成 Windows 身份验证涵盖两种独立的身份验证机制：

*   NTLM v2 -和-
*   克伯罗斯，

如果您使用的是 Kerberos，由于用户的密码永远不会传递给 IIS 服务器，因此 IIS 服务器上的令牌要跳到网络上的另一台机器的唯一方法是通过 Kerberos 委派。如果那不可用或不允许，那么跳跃就不会发生（这听起来像是正在发生的事情）。

假设您使用的是默认凭据，并且如果当前安全上下文是一个无法委托的模拟令牌，那么您提供的凭据将不会跳转到另一台机器。由于 Windows 集成身份验证会创建模拟令牌，因此很可能会出现这种情况。

资料来源：

*   [psexec 问题](http://nyc-dba.blogspot.com/2008/09/psexec-permission-denied-error.html)
*   [Windows 身份验证线程（论坛）](http://www.velocityreviews.com/forums/t75486-re-windows-auth-double-hop-issue.html)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-11T13:40:24.680

你可以让 script2 的调用等待完成，而不是让 script2 回调到 node1：

> node1 中的 script1：在 node1 中执行大量任务（关闭服务、检查状态等），并在使用 psexec 完成所有任务启动后，在 node2 中执行 script2（psexec \ node2 script2）
> 
> node2 中的 script2：执行很多任务。
> 
> node1 中的 script1：启动 script3。

# .net - 如何在 IronPython 中创建 Web 服务？

> ID：359201
> 
> 赞同：6
> 
> 时间：2008-12-11T12:34:51.833
> 
> 标签：.net, web-services, ironpython

如何在 IronPython 中创建 .Net Web 服务？最好是动态的，无需任何预处理或后处理。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-12T13:56:44.903

我不确定这一点，但这是我过去试图寻找的东西。

也许看看以下内容：

*   [http://sourceforge.net/projects/pywebsvcs/](http://sourceforge.net/projects/pywebsvcs/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-11T23:39:56.217

[查看最近发布的IronPython 2.0](http://www.codeplex.com/IronPython/Release/ProjectReleases.aspx?ReleaseId=8365)中名为 DynamicWebServiceHelpers 的示例。

# .net - 在项目中声明常量

> ID：359206
> 
> 赞同：5
> 
> 时间：2008-12-11T12:40:03.383
> 
> 标签：.net, constants

我已经看到了将在项目中使用的这两种常量声明方法。

1.  公共模块中的常量。

2.  NonInheritable(Sealed) 类中的常量

有没有人使用任何其他方法来不断声明？

这些方法之间有什么区别，有什么优点和缺点吗？

谢谢。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-12-11T12:42:08.790

将常量放在最相关的类中 - 例如`Math.Pi`，`Int32.MinValue`等。

我已经看到了实际上应该是枚举的各种常量 - 特别是对于状态代码等。

我认为只为常量创建一个类（或模块）是不明智的，除非确实没有与这些常量相关联的合理类。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-11T13:15:56.257

我同意@Jon。然而，对于您的应用程序所特有的常量——即它们是配置默认值、调整参数等，我有时会创建一个强类型静态配置类来保存它们。我通过仅定义公共 getter 的属性公开值。这样，它们可以从配置文件中加载，但在整个代码中作为固定值引用。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-11T13:42:24.240

我的做法与 Jon 所说的相似。绝大多数枚举和常量显然都与特定的类或模块相关联，并在其中被声明为 public。

我的软件的最低级别称为实用程序，包含数学例程和其他通用实用程序的功能和方法（而不是该应用程序模式的特定实用程序）。其中有一个模块具有一堆功能，这些功能只是没有共同主题的实用功能/子例程。任何枚举或常量都在这一领域。

应用程序模型有一个类似的区域，该应用程序的通用实用程序所在的区域。并且不能与任何一类模型绑定的常量所在的位置。

所以在我的个人框架中可以找到三个常量

类声明 应用模型的通用实用模块 实用程序集的通用实用模块。

实际上，只有几十个枚举和常量中的少数需要在任一实用程序模块中声明。其中大部分是导入到我的程序集中的 Win32 函数使用的 Win32 减速。

# wcf - WCF/本地数据访问层

> ID：359208
> 
> 赞同：2
> 
> 时间：2008-12-11T12:40:32.430
> 
> 标签：wcf, data-access-layer

我正在寻找一种方法来创建一个数据访问层，该层既可以驻留在服务器上并通过 WCF 服务访问，也可以驻留在本地计算机上，在这种情况下，它可以直接访问，而无需通过 iis 运行。有没有一种方法可以通过配置文件将其从本地更改为 WCF 版本？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-20T06:24:40.777

听起来您想要提供者模型。

查看：[http ://dotnetslackers.com/articles/designpatterns/HowToWriteAProviderModel.aspx](http://dotnetslackers.com/articles/designpatterns/HowToWriteAProviderModel.aspx)

您创建两个共享一个公共接口的提供程序，并根据配置选择适当的一个。

# java - 在 Windows 批处理文件中编译 CLASSPATH

> ID：359213
> 
> 赞同：2
> 
> 时间：2008-12-11T12:41:45.063
> 
> 标签：java, windows, batch-file, classpath

在 Unix 系统上，使用 find 很容易编译 CLASSPATH：

```
LIBDIR=`find lib/ -name \*.jar`
for DIR in $LIBDIR:
do
    CLASSPATH="$CLASSPATH:$DIR"
done

java -classpath $CLASSPATH com.example.MyClass 
```

Windows 批处理文件中的等效项是什么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-11T12:52:35.650

在 Windows XP 上可以通过以下方式实现相同的功能：

```
setlocal ENABLEDELAYEDEXPANSION
FOR /R .\lib %%G IN (*.jar) DO set CLASSPATH=!CLASSPATH!;%%G

java -classpath %CLASSPATH% com.example.MyClass 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-11T12:57:24.610

唯一的方法是使用延迟的环境变量扩展。你可以通过运行来做到这一点

```
cmd /v 
```

然后你可以运行：

```
set var=.
FOR /r %%d IN (*.jar) DO SET var=!var!;%%d
set CLASSPATH=%var% 
```

# asp.net - 用于显示内容的修订或差异的 ASP.NET WebControl

> ID：359214
> 
> 赞同：3
> 
> 时间：2008-12-11T12:41:47.590
> 
> 标签：asp.net, diff, web-controls

我想显示相同内容的版本之间的差异。最初我推出了自己的 WebControl，但是我想出的差分算法有点幼稚。

有谁知道 Internet 上可能有用的任何 .Net 代码或 WebControl？stackoverflow 使用的实现正是我正在寻找的东西，例如：

![替代文字](https://i.stack.imgur.com/SEXhn.png)

**更新：** 2008 年 12 月 12 日我已经将 jsdiff 实现包装到一个自包含的 Web 控件程序集中，并将其上传到 MSDN 代码库[文本差异和语法突出显示 ASP.Net WebControls](http://code.msdn.microsoft.com/jsdiffsyntaxhighligh)。

**更新：2008**年 11 月 12 日遇到以下[javascript 差异库](http://ejohn.org/projects/javascript-diff-algorithm/)。将尝试将其包装在自定义 WebControl 中。输出看起来类似于 stackoverflow 使用的输出：

![替代文字](https://i.stack.imgur.com/RPpJF.png)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-11T16:48:00.667

我使用你提到的js lib。

将 .js 文件包含在脚本标记中，将命名为 asp:Literal 添加到页面

```
<asp:Literal ID="litCompare" runat="server">
</asp:Literal> 
```

并添加到代码隐藏：

```
litComparison.Text = "<pre id=\"lbDiffPre\" class=\"code\"> </pre>";
ClientScript.RegisterStartupScript(GetType(), "calccompare",
    @"document.getElementById('lbDiffPre').innerHTML = 
    diffString(document.getElementById('" + edit1.ClientID + "').value, 
        document.getElementById('" + edit2.ClientID + "').value).
        replace(/\r\n/g, '<br>';", true); 
```

就我而言，我有 2 个控件也显示原始值，您可能希望将字符串逐字包含在 diffString() 函数中。额外的 replace() 将 \r\n 换行符转换为 HTML 换行符。

# wpf - 如何使 WPF ListView 项目水平重复，如水平滚动条？

> ID：359217
> 
> 赞同：74
> 
> 时间：2008-12-11T12:43:04.187
> 
> 标签：wpf, xaml, listview, alignment

我有一个垂直重复数据的 WPF ListView。我不知道如何让它水平重复，就像 Windows 资源管理器中的幻灯片视图一样。我当前的 ListView 定义是：

```
<ListView ItemsSource="{StaticResource MyDataList}" ItemTemplate="{StaticResource ListViewTemplate}">
</ListView> 
```

DataTemplate 是（尽管我认为这无关紧要）；

```
 <Rectangle HorizontalAlignment="Stretch" Margin="0,1,0,0" x:Name="rectReflection" Width="Auto" Grid.Row="1" Height="30">
                    <Rectangle.Fill>
                        <VisualBrush Stretch="None" AlignmentX="Center" AlignmentY="Top" Visual="{Binding ElementName=imgPhoto}">
                            <VisualBrush.RelativeTransform>
                                <TransformGroup>
                                    <MatrixTransform Matrix="1,0,0,-1,0,0" />
                                    <TranslateTransform Y="1" />
                                </TransformGroup>
                            </VisualBrush.RelativeTransform>
                        </VisualBrush>
                    </Rectangle.Fill>
                    <Rectangle.OpacityMask>
                        <RadialGradientBrush GradientOrigin="0.5,1.041">
                            <RadialGradientBrush.RelativeTransform>
                                <TransformGroup>
                                    <ScaleTransform CenterX="0.5" CenterY="0.5" ScaleX="1.202" ScaleY="2.865"/>
                                    <SkewTransform AngleX="0" AngleY="0" CenterX="0.5" CenterY="0.5"/>
                                    <RotateTransform Angle="0" CenterX="0.5" CenterY="0.5"/>
                                    <TranslateTransform X="-0.002" Y="-0.491"/>
                                </TransformGroup>
                            </RadialGradientBrush.RelativeTransform>
                            <GradientStop Color="#D9000000" Offset="0"/>
                            <GradientStop Color="#01FFFFFF" Offset="0.8"/>
                        </RadialGradientBrush>
                    </Rectangle.OpacityMask>
                </Rectangle>
            </Grid>
        </Border>
    </DataTemplate> 
```

* * *

## 回答 #1

> 赞同：205
> 
> 时间：2008-12-11T13:54:21.080

将 ListView 的 ItemsPanel 设置为水平 StackPanel。像这样：

```
<ListView.ItemsPanel>
    <ItemsPanelTemplate>
        <StackPanel Orientation="Horizontal"></StackPanel>
    </ItemsPanelTemplate>
</ListView.ItemsPanel> 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2011-11-05T18:01:57.803

也许更好的方法是使用具有所有相同属性但性能更高的 VirtualizingStackPanel，尤其是对于具有大量项目的列表框。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2016-07-06T02:29:01.963

我发现走这条路更容易

```
<ItemsControl ItemsSource="{Binding Path=Steps}">
<ItemsControl.ItemTemplate>
    <DataTemplate>
        <TextBlock Text="{Binding PageName}" Padding="10" />
    </DataTemplate>
</ItemsControl.ItemTemplate>    
<ItemsControl.ItemsPanel>
    <ItemsPanelTemplate>
        <WrapPanel></WrapPanel>
    </ItemsPanelTemplate>
</ItemsControl.ItemsPanel> 
```

# c# - 对齐网格鼠标锁定

> ID：359229
> 
> 赞同：2
> 
> 时间：2008-12-11T12:50:04.610
> 
> 标签：c#, grid, mouse, cursor-position, onmousemove

我正在开发一个绘制简单点网格的应用程序。我希望鼠标在网格上的点之间捕捉，最终在网格上画线。

我有一种方法可以获取当前鼠标位置（X，Y）并计算最近的网格坐标。

当我创建一个事件并尝试将鼠标移动到新坐标时，整个系统变得不稳定。鼠标在网格点之间不能平滑捕捉。

我在下面复制了一个代码示例来说明我正在尝试做的事情。关于如何消除鼠标移动中的跳动，有没有人可以向我提供任何建议？

* * *

```
using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Linq;
using System.Text;
using System.Windows.Forms;

namespace GridTest
{
    public partial class Form1 : Form
    {
        Graphics g;
        const int gridsize = 20;

        public Form1()
        {
            InitializeComponent();
            g = splitContainer1.Panel2.CreateGraphics();
            splitContainer1.Panel2.Invalidate();
        }

        private void splitContainer1_Panel2_Paint(object sender, PaintEventArgs e)
        {
            Drawgrid();
        }

        private void Drawgrid()
        {
            for (int x = 0; x < splitContainer1.Panel2.ClientSize.Width; x += gridsize)
            {
                for (int y = 0; y < splitContainer1.Panel2.ClientSize.Height; y += gridsize)
                { g.DrawLine(Pens.Black, new Point(x, y), new Point(x + 1, y)); }
            }
        }

        private void splitContainer1_Panel2_MouseMove(object sender, MouseEventArgs e)
        {
            Point newPosition = new Point();
            newPosition = RoundToNearest(gridsize, e.Location);
            Cursor.Position = splitContainer1.Panel2.PointToScreen(newPosition);
        }

        private Point RoundToNearest(int nearestRoundValue, Point currentPoint)
        {
            Point newPoint = new Point();
            int lastDigit;

            lastDigit = currentPoint.X % nearestRoundValue;

            if (lastDigit >= (nearestRoundValue/2))
            { newPoint.X = currentPoint.X - lastDigit + nearestRoundValue; }
            else
            { newPoint.X = currentPoint.X - lastDigit; }

            lastDigit = currentPoint.Y % nearestRoundValue;
            if (lastDigit >= (nearestRoundValue / 2))
            { newPoint.Y = currentPoint.Y - lastDigit + nearestRoundValue; }
            else
            { newPoint.Y = currentPoint.Y - lastDigit; }

            return newPoint;
        }
    }
} 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-11T14:53:48.790

不要修改光标位置。你不需要。

相反，*绘制*就像它被捕捉到网格一样。当用户单击某处时，只需从最近的网格点绘制线。

例如，如果用户点击 (197,198)，但您知道最近的点实际上是 (200,200)，只需画一条线到 (200,200) 而不是 (197,198)。

请不要弄乱*实际*的光标位置。

* * *

我不知道是否有某种方法可以隐藏鼠标光标。如果有，您可以隐藏它并自己绘制它，*而无需修改实际位置*。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-11T13:00:23.217

如果您尝试移动鼠标，它会一直捕捉到同一点 - 因为它仍然最接近该点...如果您将鼠标向左移动，请将光标移动到当前鼠标左侧的点，而不是重新计算当前。申请其他3个方向...

不过我不推荐这种行为，它会引起很多刺激。将控件对齐到网格，而不是鼠标。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-11T16:17:08.157

我想我明白你来自哪里。在捕捉到新点之前，您只需要距离原始捕捉点（鼠标左键）有一些增量。

这里有 50 行代码说明了我的意思：（启动一个新的 VB.NET 项目，添加一个新模块，复制并粘贴代码，添加对 System、System.drawing 和 System.Windows.Forms 的引用）

```
 Imports System
Imports System.Drawing
Imports System.Windows.Forms

Module modSnap

    Public Const strApplicationTitle As String = "Snap Demo"
    Public frmSnap As SnapForm
    Public ptSnap, ptStart, ptEnd As Point

    Public Class SnapForm
        Inherits Form
        Public Sub New()
            Me.Text = "Snap Demo"
            Me.ClientSize = New Size(800, 600)
            Me.FormBorderStyle = Windows.Forms.FormBorderStyle.FixedSingle
            Me.MaximizeBox = False
            Me.StartPosition = FormStartPosition.CenterScreen
            Me.DoubleBuffered = True
        End Sub
        Protected Overrides Sub OnPaint(ByVal e As System.Windows.Forms.PaintEventArgs)
            MyBase.OnPaint(e)
            e.Graphics.Clear(Color.Black)
            For row As Integer = 20 To 780 Step 20
                For col As Integer = 20 To 580 Step 20
                    e.Graphics.DrawEllipse(Pens.Blue, New Rectangle(row - 2, col - 2, 4, 4))
                Next
            Next
            e.Graphics.DrawLine(Pens.Red, ptStart, ptEnd)
        End Sub
        Protected Overrides Sub OnMouseDown(ByVal e As System.Windows.Forms.MouseEventArgs)
            MyBase.OnMouseDown(e)
            Dim x As Integer = CInt(e.X / 20) * 20
            Dim y As Integer = CInt(e.Y / 20) * 20
            ptStart = New Point(x, y)
            ptSnap = New Point(x, y)
            Windows.Forms.Cursor.Position = Me.PointToScreen(ptSnap)
        End Sub
        Protected Overrides Sub OnMouseMove(ByVal e As System.Windows.Forms.MouseEventArgs)
            MyBase.OnMouseMove(e)
            If e.Button = Windows.Forms.MouseButtons.Left Then
                Dim x As Integer = CInt(e.X / 20) * 20
                Dim y As Integer = CInt(e.Y / 20) * 20
                ' must be some delta away from original snap point
                If (x < ptSnap.X - 15 Or x > ptSnap.X + 15) Or (y < ptSnap.Y - 15 Or y > ptSnap.Y + 15) Then
                    ptSnap = New Point(x, y)
                    ptEnd = New Point(x, y)
                    Me.Invalidate(False)
                    Windows.Forms.Cursor.Position = Me.PointToScreen(ptSnap)
                End If
            End If
        End Sub
    End Class

    Public Sub main()
        Try
            frmSnap = New SnapForm
            Application.Run(frmSnap)
        Catch ex As Exception
            MessageBox.Show(ex.Message, strApplicationTitle, MessageBoxButtons.OK, MessageBoxIcon.Error)
        Finally
            frmSnap.Dispose()
        End Try
    End Sub

End Module 

```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-11T15:09:56.247

我同意ruijoel，不要弄乱光标位置。最好在捕捉点处绘制一个十字或一个环，以向用户显示在单击事件中将捕捉到哪个点。

为了使其正常工作，您可能需要查看 xor-drawing 以便在您移动到新的捕捉点后删除该项目。

# windows - Windows XP 上 for /f 命令的问题

> ID：359232
> 
> 赞同：3
> 
> 时间：2008-12-11T12:51:09.240
> 
> 标签：windows, syntax, batch-file, cmd

我使用的是 Windows XP Service Pack 3，并且默认情况下在 Windows 注册表中启用了命令扩展。不知何故，以下命令在此版本的 Windows 上不起作用，但如果我在 Windows Server 2003 或 Windows Vista Business 中运行它，它就可以正常工作。有什么线索吗？

问题是在 Windows XP 上，似乎 /f 选项根本不起作用，并且命令的 do 部分永远不会被执行。

这是命令：

```
for /f "tokens=1 delims=: " %A in ('tasklist /FI "IMAGENAME eq python.exe" /NH') do (
If "%A" == "python.exe" (
    echo "It's running"
) Else (
    echo "It's not running"
)
) 
```

提前致谢。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-11T13:14:29.007

那是因为没有找到任务时`tasklist.exe`输出。循环只能看到，所以如果`STDERR`没有运行，它就没有什么可以循环的了。`for /f``STDOUT``python.exe`

重定向`STDERR`到`STDOUT`( `2>&1`) 作品：

```
for /F "tokens=1 delims=: " %A in ('tasklist /FI "IMAGENAME eq python.exe" /NH 2^>^&1') do (
  if "%A"=="python.exe" (
    echo "It's running"
  ) else (
    echo "It's not running"
  )
) 
```

这些`^`字符是为此工作所必需的转义序列。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-11T13:05:10.257

以下在我的 Windows XP 计算机上运行：

```
@echo off
for /f "tokens=1 delims=: " %%A in ('tasklist /FI "IMAGENAME eq java.exe" /NH') do (
    If "%%A" == "java.exe" (
        echo "It's running"
    ) Else (
        echo "It's not running"
    )
) 
```

注意使用`%%A`
（对不起，我使用 java.exe 因为在我的测试时没有运行 python.exe ;)）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-02-15T17:17:06.517

```
Set RUNNING=False
for /f "tokens=1 delims=: " %%a in ('tasklist /FI "IMAGENAME eq python.exe" /NH 2^>NUL') do (Set RUNNING=True)
If %RUNNING% == True (
    @Echo It IS running
) ELSE (
    @Echo It's NOT running
) 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-11T13:21:24.843

这将起作用并且不显示

> 信息：没有任务以指定的条件运行

信息：

```
@echo off
set found=0

for /f "tokens=1 delims=: " %%A in ('tasklist /NH') do (
    If /i "%%A" equ "python.exe" (
        set found=1
    ) 
)

if %found%==1 (
    @echo It's running
) else (
    @echo It's not running
) 
```

# c++ - 为什么 C++ 没有反射？

> ID：359237
> 
> 赞同：356
> 
> 时间：2008-12-11T12:52:01.673
> 
> 标签：c++, reflection

这是一个有点奇怪的问题。我的目标是了解语言设计决策并确定 C++ 中反射的可能性。

1.  为什么 C++ 语言委员会没有着手在语言中实现反射？在不在虚拟机（如 java）上运行的语言中，反射是否太难了？

2.  如果要为 C++ 实现反射，会有哪些挑战？

我猜反射的用途是众所周知的：编辑器可以更容易编写，程序代码会更小，可以为单元测试生成模拟等等。但是，如果您也可以评论反射的使用，那就太好了。

* * *

## 回答 #1

> 赞同：648
> 
> 时间：2008-12-11T14:07:31.677

C++ 中的反射存在几个问题。

*   添加的工作量很大，而且 C++ 委员会相当保守，除非他们确定会有回报，否则不要花时间在激进的新功能上。（已经提出了添加类似于 .NET 程序集的模块系统的建议，虽然我认为人们普遍认为拥有它会很好，但这不是他们目前的首要任务，并且一直被推迟到很久以后C++0x。这个特性的动机是摆脱`#include`系统，但它也会启用至少一些元数据）。

*   你不用为你不使用的东西付费。这是 C++ 必须的基本设计理念之一。如果我可能永远不需要它，为什么我的代码要携带元数据？此外，添加元数据可能会阻止编译器进行优化。如果我可能永远不需要元数据，我为什么要在我的代码中支付这笔费用？

*   这就引出了另一个重点：C++对编译后的代码几乎没有保证*。*只要生成的功能符合预期，编译器就可以做它喜欢的任何事情。例如，您的课程不需要实际 *存在*。编译器可以优化它们，内联它们所做的一切，而且它经常这样做，因为即使是简单的模板代码也倾向于创建相当多的模板实例化。C++ 标准库*依赖*于这种积极的优化。仅当实例化和破坏对象的开销可以优化掉时，函子才具有高性能。 `operator[]`在向量上仅在性能上与原始数组索引相当，因为整个运算符可以内联，从而完全从编译的代码中删除。C# 和 Java 对编译器的输出做了很多保证。如果我在 C# 中定义一个类，那么该类*将存在*于生成的程序集中。即使我从不使用它。即使对其成员函数的所有调用都可以内联。类必须在那里，以便反射可以找到它。C# 编译为字节码可以部分缓解这种情况，这意味着 JIT 编译器*可以*如果愿意，可以删除类定义和内联函数，即使最初的 C# 编译器不能。在 C++ 中，你只有一个编译器，它必须输出高效的代码。如果允许您检查 C++ 可执行文件的元数据，您会希望看到它定义的每个类，这意味着编译器必须保留所有定义的类，即使它们不是必需的。

*   然后是模板。C++ 中的模板与其他语言中的泛型完全不同。每个模板实例化都会创建一个 *新*类型。`std::vector<int>`是一个完全独立的类 `std::vector<float>`。这在整个程序中增加了许多不同的类型。我们的反思应该看到什么？*模板* `std::vector`？_ 但它怎么可能呢，因为那是一个源代码结构，在运行时没有任何意义？它必须看到单独的类 `std::vector<int>`和 `std::vector<float>`. 和 `std::vector<int>::iterator`, `std::vector<float>::iterator`相同的`const_iterator`等等。一旦你进入模板元编程，你很快就会实例化数百个模板，所有这些模板都会被编译器再次内联和删除。它们没有任何意义，除了作为编译时元程序的一部分。所有这数百个类都应该对反射可见吗？他们必须这样做，否则我们的反射将毫无用处，如果它甚至不能保证我定义的类实际上*会在那里*。一个附带的问题是模板类在实例化之前不存在。想象一个使用`std::vector<int>`. 我们的反射系统应该能够看到`std::vector<int>::iterator`吗？一方面，你肯定会期望如此。这是一个重要的类，它是根据 定义的`std::vector<int>`，它*确实*存在于元数据中。另一方面，如果程序从来没有真正*使用*过这个迭代器类模板，那么它的类型就永远不会被实例化，所以编译器一开始就不会生成这个类。而且在运行时创建它为时已晚，因为它需要访问源代码。

*   最后，反射在 C++ 中并不像在 C# 中那么重要。原因又是模板元编程。它不能解决所有问题，但在很多情况下，如果您需要使用反射，则可以编写一个在编译时执行相同操作的元程序。 `boost::type_traits`是一个简单的例子。你想知道类型 `T`吗？检查其`type_traits`. 在 C# 中，您必须使用反射在其类型之后四处寻找。反射对某些事情仍然有用（我能看到的主要用途是元编程无法轻易替代的，用于自动生成的序列化代码），但它会为 C++ 带来一些重大成本，而且它并不像它那样经常使用是其他语言的。

*编辑：* 回应评论：

cdleary：是的，调试符号做类似的事情，因为它们存储有关可执行文件中使用的类型的元数据。但他们也受到我所描述的问题的困扰。如果您曾经尝试过调试发布版本，您就会明白我的意思。您在源代码中创建的类存在很大的逻辑空白，该类已在最终代码中内联。如果您要将反射用于任何有用的事情，您需要它更加可靠和一致。事实上，几乎每次编译时类型都会消失和消失。您更改了一个微小的细节，编译器决定更改哪些类型被内联，哪些不被内联，作为响应。你如何从中提取有用的东西，当你' 甚至不保证最相关的类型将在您的元数据中表示？您正在寻找的类型可能在上一个版本中已经存在，但现在它已经消失了。明天，有人将检查一个小的无害更改到一个小的无害函数，这使得类型足够大以至于它不会被完全内联，所以它会再次回来。这对于调试符号仍然有用，但仅此而已。我讨厌尝试根据这些条款为类生成序列化代码。但仅此而已。我讨厌尝试根据这些条款为类生成序列化代码。但仅此而已。我讨厌尝试根据这些条款为类生成序列化代码。

Evan Teran：这些问题当然*可以*解决。但这又回到了我的第 1 点。这需要做很多工作，而且 C++ 委员会有很多他们认为更重要的事情。在 C++ 中获得一些有限的反射（并且它会受到限制）的好处真的足够大，足以证明以牺牲其他特性为代价来关注它吗？添加已经（大部分）可以通过库和预处理器（如 QT）完成的核心语言功能真的有巨大的好处吗？也许吧，但与不存在此类库的情况相比，这种需求的紧迫性要小得多。不过，对于您的具体建议，我相信在模板上禁止它会使其完全无用。例如，您将无法在标准库上使用反射。什么样的反思会'`std::vector`? 模板是 C++ 的*重要*组成部分。在模板上不起作用的功能基本上是没用的。

但你是对的，可以实现某种形式的反射。但这将是语言的重大变化。就像现在一样，类型完全是一种编译时构造。它们的存在是为了编译器的利益，仅此而已。编译代码后，就*没有*类了。如果您扩展自己，您可能会争辩说函数仍然存在，但实际上，只有一堆跳转汇编指令和大量堆栈推送/弹出。添加此类元数据时，没有什么可做的。

但就像我说的，有一个建议是对编译模型进行更改，添加自包含模块，存储选择类型的元数据，允许其他模块引用它们而不必与`#include`s 混淆。这是一个好的开始，老实说，我很惊讶标准委员会并没有因为太大的变化而放弃提案。所以也许在5-10年内？:)

* * *

## 回答 #2

> 赞同：45
> 
> 时间：2008-12-11T12:56:22.240

反射需要一些关于类型的元数据存储在可以查询的地方。由于 C++ 编译为本地机器代码并由于优化而发生大量更改，因此在编译过程中几乎丢失了应用程序的高级视图，因此无法在运行时查询它们。Java 和 .NET 在虚拟机的二进制代码中使用了非常高级的表示，使得这种级别的反射成为可能。然而，在某些 C++ 实现中，有一种称为运行时类型信息 (RTTI) 的东西，可以将其视为反射的精简版本。

* * *

## 回答 #3

> 赞同：23
> 
> 时间：2009-11-06T17:17:42.623

所有语言都不应该尝试融合所有其他语言的所有功能。

C++ 本质上是一个非常非常复杂的宏汇编器。它不是（在传统意义上）像 C#、Java、Objective-C、Smalltalk 等这样的高级语言。

对于不同的工作有不同的工具是很好的。如果我们只有锤子，所有的东西都会看起来像钉子等等。拥有脚本语言对某些工作很有用，而反射型 OO 语言（Java、Obj-C、C#）对另一类工作很有用，而且超级- 接近机器的高效准系统语言对另一类工作（C++、C、汇编程序）很有用。

C++ 在将汇编程序技术扩展到令人难以置信的复杂性管理水平和抽象以使人类更可能进行更大、更复杂的任务的编程方面做得非常出色。但它不一定是最适合那些从严格的高级角度（Lisp、Smalltalk、Java、C#）解决问题的人的语言。如果您需要一种具有这些功能的语言来最好地解决您的问题，那么感谢那些为我们所有人创建此类语言的人！

但是 C++ 适合那些出于某种原因需要在其代码和底层机器操作之间建立强关联的人。无论是它的效率，还是编程设备驱动程序，还是与较低级别的操作系统服务的交互，或者其他什么，C++ 都更适合这些任务。

C#、Java、Objective-C 都需要更大、更丰富的运行时系统来支持它们的执行。该运行时必须交付给相关系统 - 预先安装以支持您的软件的操作。并且必须为各种目标系统维护该层，由其他语言定制以使其在该平台上工作。中间层——宿主操作系统和代码之间的自适应层——运行时，几乎总是用 C 或 C++ 之类的语言编写，效率是第一，可以很好地理解软件和硬件之间的确切交互理解并操纵到最大收益。

我喜欢 Smalltalk、Objective-C，以及拥有丰富的运行时系统，包括反射、元数据、垃圾收集等。可以编写惊人的代码来利用这些设施！但这只是堆栈上的较高层，必须位于较低层上的层，它们本身最终必须位于操作系统和硬件之上。我们总是需要一种最适合构建该层的语言：C++/C/Assembler。

附录：C++11/14 正在继续扩展 C++ 能力以支持更高级别的抽象和系统。线程、同步、精确的内存模型、更精确的抽象机器定义使 C++ 开发人员能够实现许多高级抽象，而这些高级语言中的一些曾经拥有专有域，同时继续提供接近金属性能和出色的可预测性（即最小的运行时子系统）。也许反射工具将在未来的 C++ 版本中选择性地启用，对于那些需要它的人 - 或者也许一个库将提供这样的运行时服务（也许现在有一个，或者一个在 boost 中的开始？）。

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2008-12-11T13:03:19.123

如果您真的想了解有关 C++ 的设计决策，请查找Ellis 和 Stroustrup的[The Annotated C++ Reference Manual的副本。](https://rads.stackoverflow.com/amzn/click/com/0201514591)它不是最新的标准，但它通过了原始标准并解释了事情是如何工作的，并且经常解释他们是如何做到的。

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2009-08-31T03:22:17.310

对于拥有反射的语言来说，反射是关于编译器愿意在目标代码中保留多少源代码以启用反射，以及有多少分析机制可用于解释反射信息。除非编译器保留所有源代码，否则反射将限制其分析有关源代码的可用事实的能力。

C++ 编译器没有保留任何东西（好吧，忽略 RTTI），所以你不会*在*语言中得到反射。（Java 和 C# 编译器只保留类、方法名称和返回类型，因此您可以获得一些反射数据，但您无法检查表达式或程序结构，这意味着即使在那些“启用反射”的语言中您可以获得的信息非常稀少，因此您确实无法进行太多分析）。

但是您可以*跳出*语言并获得完整的反思能力。[关于C 中反射的](https://stackoverflow.com/questions/1353022/reflection-support-in-c/1353133#1353133)另一个堆栈溢出讨论的答案讨论了这一点。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2008-12-11T12:58:30.833

[反射可以并且以前已经在 c++ 中实现过。](http://www.google.fr/search?q=c%2B%2B+reflection)

它不是本机 C++ 功能，因为它具有不应该由语言默认设置的沉重成本（内存和速度） - 该语言是“默认情况下的最大性能”导向的。

由于您不应该为不需要的东西付费，并且正如您自己所说，在编辑器中比在其他应用程序中更需要它，所以它应该只在您需要的地方实现，而不是“强制”所有代码（您不需要对将在编辑器或其他类似应用程序中使用的所有数据进行反思）。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2008-12-11T13:02:14.197

C++ 没有反射的原因是这需要编译器将符号信息添加到目标文件中，例如类类型具有哪些成员、有关成员的信息、有关函数和所有内容。这基本上会使包含文件变得无用，因为声明传递的信息将从这些目标文件（然后是模块）中读取。在 C++ 中，通过包含相应的头文件，类型定义可以在程序中多次出现（前提是所有这些定义都相同），因此必须决定将有关该类型的信息放在哪里，就像命名一个一样这里的并发症。C++ 编译器进行的积极优化，可以优化几十个类模板实例，是另一个强项。这是可能的，但由于 C++ 与 C 兼容，

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2012-08-14T19:04:58.877

有大量在 C++ 中使用反射的情况，使用模板元编程等编译时构造无法充分解决。

[N3340](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2012/n3340.pdf)提出了富指针作为在 C++ 中引入反射的一种方式。除其他事项外，它还解决了除非您使用它，否则不为功能付费的问题。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2009-11-06T16:56:12.910

根据 Alistair Cockburn 的说法，[在反射环境中无法保证子类型化](http://alistair.cockburn.us/Constructive+deconstruction+of+subtyping)。

反射与潜在类型系统更相关。在 C++ 中，你知道你有什么类型，你知道你可以用它做什么。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2016-05-17T08:58:44.663

这基本上是因为它是“可选的额外”。许多人选择 C++ 而不是 Java 和 C# 等语言，以便他们可以更好地控制编译器输出，例如更小和/或更快的程序。

如果您选择添加反射，则可以[使用多种解决方案](https://stackoverflow.com/questions/41453/how-can-i-add-reflection-to-a-c-application)。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2009-09-11T14:49:52.203

如果 C++ 可以有：

*   变量名称、变量类型和`const`修饰符的类成员数据
*   函数参数迭代器（仅位置而不是名称）
*   函数名称、返回类型和`const`修饰符的类成员数据
*   父类列表（与定义的顺序相同）
*   模板成员和父类的数据；扩展模板（意味着实际类型可用于反射 API，而不是“如何到达那里的模板信息”）

这足以在当今的 Web 和数据库应用程序（所有的 orms、消息传递机制、xml/json 解析器、数据序列化等）中如此普遍的无类型数据处理的关键处创建非常易于使用的库。

例如，`Q_PROPERTY`宏（Qt 框架的一部分） [http://qt.nokia.com/doc/4.5/properties.html](http://qt.nokia.com/doc/4.5/properties.html)支持的基本信息扩展到涵盖类方法和 e) - 对 C++ 和一般的软件社区。

当然，我所指的反思不会涵盖语义或更复杂的问题（如注释源代码行号、数据流分析等）——但我也不认为这些都需要成为语言标准的一部分。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2021-08-13T01:06:13.343

在过去的 10 年中，人们一直在尝试为 C++ 添加反射。最新的提案是针对[c++23](/questions/tagged/c%2b%2b23 "显示标记为“c++23”的问题")的，可能会也可能不会。

与大多数语言中的反射不同，[c++](/questions/tagged/c%2b%2b "显示标记为“c++”的问题")反射的计划是**编译时反射**。因此，在编译时，您可以反映结构成员、函数和方法的参数和属性、枚举值和名称等。

然后，您可以进行有限的具体化，注入有关您反映的内容的信息以生成其他类型和代码。

虽然这有点奇怪，但这意味着不使用反射的程序不会为此支付运行时成本。它也非常强大。

最简单的例子是您可以使用它来实现运行时反射。

```
struct Member {
  std::string_view name;
  std::any_ref value;
};

struct Reflectable {
  virtual std::span<Member> GetMembers() const = 0;
  virtual std::span<Member> GetMembers() = 0;
};

template<class D>
struct ImplReflectable:Reflectable {
  std::span<Member> GetMembers() const final;
  std::span<Member> GetMembers() final;
};
template<class D>
std::span<Member> ImplReflectable<D>::GetMembers() const {
  // compile time reflection code on D here
}
template<class D>
std::span<Member> ImplReflectable<D>::GetMembers() {
  // compile time reflection code on D here
} 
```

你写了上面一次，突然你想要反射的任何类型，你可以这样做：

```
struct Point : ImplReflectable<Point> {
  int x, y;
}; 
```

并附有反射系统`Point`。

实现这个运行时反射的库可以像你喜欢的那样复杂和强大。每种类型都必须做一些工作（如上述）才能选择加入，但对于 UI 库（例如）这样做并不是一个严重的问题。不选择加入的类型继续 C++ 假设“如果你不使用它就不要付费”。

但这仅仅是开始。一个提议，元类，允许：

```
interface Reflectable {
  std::span<Member> GetMembers() const;
  std::span<Member> GetMembers();
}; 
```

你可以有元类，或者接受类型并返回它们的函数。这允许您定义类的元类，例如用语言编写的“接口”。现在，`interface`有点像玩具，但您可以编写`QObject`或`Reflectable`或或`PolymorphicValueType`或`NetworkProtocol`元类来修改您的类定义的含义。

这可能会或可能不会进入[c++23](/questions/tagged/c%2b%2b23 "显示标记为“c++23”的问题")。它继续变得更好，但它也继续被推迟。对于大多数主要的 C++ 编译器，您可以尝试多种编译时反射实现。语法是不断变化的，因为有基于符号运算符的反射库，`reflexpr`基于运算符的反射库，其中一些反射数据是类型，另一些是`constexpr`对象和`consteval`函数。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-09-02T21:04:48.653

如果要将 C++ 用作数据库访问、Web 会话处理/http 和 GUI 开发的语言，我认为 C++ 中的反射是至关重要的。缺少反射会阻止 ORM（如 Hibernate 或 LINQ）、实例化类的 XML 和 JSON 解析器、数据序列化和许多其他问题（最初必须使用无类型数据来创建类的实例）。

在构建过程中可供软件开发人员使用的编译时间开关可用于消除这种“您为所用付费”的担忧。

我是固件开发人员，不需要反射来从串行端口读取数据——那么就不要使用开关了。但是，作为一个想要继续使用 C++ 的数据库开发人员，我不断地使用一种可怕的、难以维护的代码来映​​射数据成员和数据库结构之间的数据。

Boost 序列化和其他机制都没有真正解决反射问题——它必须由编译器完成——一旦完成，C++ 将再次在学校中使用并用于处理数据处理的软件中

对我来说，这个问题#1（和原始线程原语是问题#2）。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2012-08-25T11:23:27.300

反射可以是可选的，例如预处理器指令。就像是

`#pragma enable reflection`

这样我们就可以两全其美，如果没有这个编译指示库，就可以在没有反射的情况下创建（没有讨论的任何开销），那么个人开发人员是否想要速度或易用性将取决于他们。

* * *

## 回答 #15

> 赞同：-1
> 
> 时间：2020-12-04T03:19:07.573

C++ 是一种不需要反射的语言，因为 C++ 是一种用于编写具有反射的语言的语言。

# c# - Microsoft Compact Framework 3.5 上的 AoP

> ID：359247
> 
> 赞同：0
> 
> 时间：2008-12-11T12:55:34.490
> 
> 标签：c#, .net-3.5, compact-framework, aop

我试过使用 Postsharp，但他们目前的实现目标是 2.0，让它工作变得很痛苦。我是否应该推出自己的 AoP 实施（我在这里考虑一个非常基本和实用的实施）

还是有一个我不知道的替代方案？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-13T06:41:14.813

您可能希望查看[Eric Bodden 的列表](http://www.bodden.de/tools/aop-dot-net/)，该列表取自[一个非常相似的 stackoverflow 问题](https://stackoverflow.com/questions/133950/what-are-the-bestmost-popular-ways-to-do-aspect-oriented-programming-aop-in-cnet)。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2008-12-23T23:12:34.347

oOo CF 上的“开箱即用”AOP？你可能有点失望。

最好的答案是[PostSharp](http://www.postsharp.org/download/1.5/)。:D 这里的问题是下载链接是这样说的：

> “但是它并不稳定。如果您想尝试新功能并参与稳定产品，请下载它。”

因此，如果您希望在生产中使用它，可能会有一些隐藏的痛苦。但他们确实[明确支持 CF](http://www.postsharp.org/about/features/)！我自己还没有尝试过，所以我无法给出评论。

[Eric Bodden 的列表对于 Compact Framework 来说并不那么热门，这就是为什么这个问题与那个](https://stackoverflow.com/questions/133950/what-are-the-bestmost-popular-ways-to-do-aspect-oriented-programming-aop-in-cnet)问题不太相似的原因。在 PostSharp CTP 1.5 发布之前，我快速浏览了一下这个，我没有找到任何“开箱即用”的。所有其他框架（包括列表中省略的 Spring.NET）似乎都需要有人为它们创建一个端口。考虑到可能使用序列化、动态代码生成、Reflection.Emit 或 x86 特定调用，我怀疑移植是否会非常容易。

所以是的，我猜是 PostSharp FTW。

# sql - 为什么使用 CAST 时 VARCHAR 的默认长度是 30？

> ID：359257
> 
> 赞同：56
> 
> 时间：2008-12-11T12:58:03.940
> 
> 标签：sql, sql-server, casting

在 SQL Server 2005 中，此查询

```
select len(cast('the quick brown fox jumped over the lazy dog' as varchar)) 
```

返回 30 作为长度，而提供的字符串有更多字符。这似乎是默认值。为什么是 30，而不是 32 或 2 的任何其他幂？

**[编辑]**我知道在转换为 varchar 时我应该始终指定长度，但这是一个快速的让我们检查一些东西的查询。问题仍然存在，为什么是 30？

* * *

## 回答 #1

> 赞同：50
> 
> 时间：2008-12-11T13:13:14.110

为什么不指定 varchar 长度？IE：

```
SELECT CAST('the quick brown fox jumped over the lazy dog' AS VARCHAR(45)) 
```

至于为什么 30，这是 SQL Server 中该类型的默认长度。

从[char 和 varchar (Transact-SQL)](http://msdn.microsoft.com/en-us/library/ms176089.aspx)：

> 在数据定义或变量声明语句*中未指定 n 时，默认长度为 1。使用 CAST 和 CONVERT 函数时未指定 n 时，默认长度为 30。*

* * *

## 回答 #2

> 赞同：33
> 
> 时间：2012-07-17T05:47:42.007

关于为什么 30 而不是 32 或 2 的任何其他幂的问题，varchar(n) 的存储大小为 n + 2 个字节，这使得长度为 30 的字符串的字节存储大小为 32。可能是他们在看什么？

然后只是对一些注释进行澄清：未指定长度的 varchar 字段的默认长度是 n=1。CAST 或 CONVERT 针对此数据类型的转换返回的默认字符串长度为 30。

很酷的问题！

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2012-07-22T05:57:58.167

Microsoft 在 SQL Server、Access 的 Jet DB 引擎和他们的其他几个产品中选择 30 作为 CHAR 和 VARCHAR 的默认长度。它起源于过去，名称或地址列的默认长度最初设置为 30。其他数据库（如 Informix）默认 CHAR 为 20，VARCHAR 为 255。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2019-04-30T15:27:06.040

我的理论是默认的 30 个字符长度源自美国邮政服务规范的名称和地址行：

[http://pe.usps.gov/cpim/ftp/pubs/pub28/pub28.pdf](http://pe.usps.gov/cpim/ftp/pubs/pub28/pub28.pdf)

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-12-11T13:13:25.560

我不知道他们为什么选择 30，但在 Sybase SQL Server 中也是如此，微软的 SQL Server 就是从它开发的。这似乎是这些 RDBMS 的一个特性，因为它不在 SQL 标准中，并且其他服务器的行为也有所不同。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-07-17T19:18:40.073

convert/cast 的默认大小与内存分配无关，因此默认值（即 30）与 2 的任何幂无关。

关于为什么是 30，这是微软的指南，它给出了这个默认值，以便覆盖前 30 个字符中的基本数据。 [http://msdn.microsoft.com/en-us/library/ms176089.aspx](http://msdn.microsoft.com/en-us/library/ms176089.aspx)

虽然在转换/铸造过程中总是可以改变长度

```
select len(cast('the quick brown fox jumped over the lazy dog' as varchar(max))) 
```

# sharepoint - 我是否必须为 SharePoint 工作流中的每个任务使用 InfoPath 表单？

> ID：359265
> 
> 赞同：1
> 
> 时间：2008-12-11T13:01:24.900
> 
> 标签：sharepoint, infopath

是否可以在 SharePoint 工作流中将 InfoPath 表单用于除一项工作流任务之外的所有任务？我们的客户希望特定任务使用默认共享点页面来编辑该列表项，但禁用我用于该任务的表单只会使工作流默认为在 workflow.xml 中定义的 Task0_FormURN。如果我确保此定义为空或不存在，那么我只会收到错误消息。在我看来，如果您想使用 InfoPath 表单，那么您需要全力以赴完成每项任务。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-18T12:51:38.210

你说的对。您不能在一个工作流程中混合使用 Infopath 任务表单和自定义页面。

您可以尝试使用自定义代码在工作流中创建任务。

```
var newTask = list.Items.Add(someUrl, SPFileSystemObjectType.File, someTitle);
newTask["AssignedTo"] = new SPFieldUserValueCollection(new SPFieldUserValue(web, id, name));
newTask["StartDate"] = DateTime.Now;
newTask["Body"] = "task body";
newTask.Update(); 
```

在这种情况下，您的工作流程将不会“监视”任务更改。我假设您会通过活动观察工作流项目的变化`OnWorkflowItemChanged`。

希望这可以帮助

# java - 如何通过 Tomcat 检索其他 LDAP 数据字段（getRemoteUser 只给出名称）

> ID：359267
> 
> 赞同：2
> 
> 时间：2008-12-11T13:02:27.097
> 
> 标签：java, ldap, tomcat5.5

我已将 Tomcat 配置为使用 LDAP/AD。

如何获取有关登录用户的更多详细信息；用户 ID 由`request.getRemoteUser()`但不是我需要的全名返回。

如何`displayName`从 AD 获得实际的“”（全名）？

我正在使用 ldap/activedirectory/tomcat 5.5

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-14T10:47:43.017

我想 LDAP/AD 的 tomcat 配置是关于登录（例如领域）。因此 Natalia 是正确的：您必须查询您的 LDAP 服务器以获取更多信息。此评论的评论字段太短，所以我选择了另一个答案，说明相同。

这样做的原因是，Realm 接口提供了一个 Principal，它只包含用户名和查询的可能性，如果当前用户处于给定角色中（它甚至不提供主体所在的所有角色） . 这足以根据 URL 获取 web.xml 的访问限制。它并非旨在成为您与存储在用户数据库中的所有内容的中心联系点。

如果您不使用用户 ID，而只是希望将其替换为完整的用户名，则可以通过查看 tomcat 安装、创建新的 Realm 实现并将具有此实现的 jar 添加到 TOMCAT_HOME 来轻松编写自己的 LDAP Realm /lib（用于 Tomcat 6.0）。当然，您需要从您的 TOMCAT_HOME/conf/server.xml 引用此实现，而不是标准的 tomcat 实现。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-12T04:44:02.483

您将需要直接查询您的 LDAP 目录以获取有关用户的更多信息。

# silverlight - 在 Silverlight 中使用“数据表”

> ID：359272
> 
> 赞同：0
> 
> 时间：2008-12-11T13:05:03.177
> 
> 标签：silverlight, dataset

由于 silverlight 不支持 DataSets/DataTables，如果我想使用数据库中的数据表，最好的方法是什么？

有点像这样：silverlight 中的用户操作 -> 从服务器获取数据 -> 在 GridView 中显示

问题是，我不知道数据将有多少列和哪些列......

我可以将 DataGrid 绑定到服务器上生成的某种松散形式的 XML，还是必须自己解析 Web 服务返回的数据集以另一种格式或...？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-11T14:03:32.263

对我有用的一种方法是我刚刚发现的以下方法：http: [//blog.bodurov.com/How-to-bind-Silverlight-DataGrid-from-IEnumerable-of-IDictionary](http://blog.bodurov.com/How-to-bind-Silverlight-DataGrid-from-IEnumerable-of-IDictionary)

通过使用 XML 文件，并将数据放入 Dictionary 对象列表（列表是记录，每个列表项的字典是具有值的字段列表），我可以使用上面 URL 中的方法来动态创建对象。使用这些对象，我可以填充 GridView。

# c++ - 静态变量未初始化 - 有时？

> ID：359276
> 
> 赞同：2
> 
> 时间：2008-12-11T13:06:14.280
> 
> 标签：c++

我有一个谜题游戏。拼图是使用拼图引擎 ID 从脚本文件创建的。拼图引擎使用静态散列中的静态变量注册自己。我收到了有关崩溃的报告，我们已经将问题归结为没有某些键的哈希，这些键应该是由静态函数添加的。

请注意，这是一个我们无法重现的错误，即该方法可以正常工作。事实上，我不知道为什么有时它显然没有。有没有可能不调用这些静态函数？也许是编译器错误？（视觉 C++ 2005）

拼图工厂类型

```
class PuzzleMode;
typedef PuzzleMode* (*fnPuzzleFactory)(bool* bVictory, const char* sPuzzleCode, const GFC::StringList& lParams); 
```

引擎使用这个宏来确保它们被注册。有一个静态 bool，它被初始化为注册工厂并返回 true 的函数的结果：

```
#define REGISTER_PUZZLE(CODE, CLASSNAME)                                                                    \
    PuzzleMode* puzzleFactory##CLASSNAME (bool* bVictory, const char* sCode, const StringList& lParams)     \
    {                                                                                                       \
        return new CLASSNAME(bVictory, sCode, lParams);                                                     \
    }                                                                                                       \
                                                                                                            \
    static bool registerPuzzle##CLASSNAME (void)                                                            \
    {                                                                                                       \
        PuzzleMode::registerPuzzleFactory(CODE, puzzleFactory##CLASSNAME);                                  \
        return true;                                                                                        \
    }                                                                                                       \
                                                                                                            \
    static bool s_bRegisteredPuzzle##CLASSNAME = registerPuzzle##CLASSNAME(); 
```

例如，在拼图引擎 .cpp 中：

```
REGISTER_PUZZLE("bloodcollection", BloodCollection); 
```

在其他地方，在 .cpp 中：

```
static Hash<String, fnPuzzleFactory>* s_hPuzzleFactories = NULL;

void PuzzleMode::registerPuzzleFactory (const char* sId, fnPuzzleFactory pFactory)
{
    if (!s_hPuzzleFactories)
        s_hPuzzleFactories = new Hash<String, fnPuzzleFactory>();   

    String sLowId = String(sId).lower();
    s_hPuzzleFactories->setAt(sLowId, pFactory);
} 
```

所有这些都应该在应用程序启动时发生。很久以后它是这样使用的

```
PuzzleMode* PuzzleMode::createPuzzleInstance (const char* sEngine, bool* bVictory, const GFC::StringList& lParams)
{
    // Shouldn't happen
    if (!s_hPuzzleFactories)
        s_hPuzzleFactories = new Hash<String, fnPuzzleFactory>();

    String sLowId = String(sEngine).lower();
        if (!s_hPuzzleFactories->hasKey(sLowId))    // <----- HERE
        return NULL;

    fnPuzzleFactory fnFactory = s_hPuzzleFactories->getAt(sLowId);
    return fnFactory(bVictory, sEngine, lParams);
} 
```

有时，但只是有时，在上面标记的行中，哈希没有密钥。

有任何想法吗？我唯一能想到的（我在写这篇文章时想到的）是在哈希本身初始化为 NULL 之前调用了寄存器函数，但是在我们发现哈希没有之前，一切都应该崩溃和烧毁我们正在寻找的钥匙。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-11T13:17:34.180

这可能是一个[静态初始化](http://www.parashift.com/c++-faq-lite/ctors.html#faq-10.12)顺序问题。尝试将其重写为“[首次使用时构造](http://www.parashift.com/c++-faq-lite/ctors.html#faq-10.13)”。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-11T13:45:52.797

如果链接器认为它不包含可访问的代码，则允许链接器完全删除一个编译单元。因此，如果您的 .cpp 文件中的任何函数都没有从其他地方显式调用，则它可能会被完全丢弃，并且应该已注册的对象只是从您的可执行文件中丢失。

尝试在缺少的拼图的 .cpp 中放置一个虚拟外部函数，然后从 main() 调用它，看看它是否能解决您的问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-18T19:05:56.363

看起来这毕竟与静态初始化无关 - 经过大量日志记录后，我们发现一些不相关的代码显然正在破坏指针。

# xml - 将属性值指定为 CDATA

> ID：359280
> 
> 赞同：16
> 
> 时间：2008-12-11T13:07:24.200
> 
> 标签：xml, validation

可以将 XML 属性值指定为 CDATA 吗？如果是 - 相同的架构是什么。如果不是 - 为什么 XML 中没有解决这个限制？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-12-11T13:12:25.470

不，你不能这样做。

在什么构成属性和什么构成子元素之间有一条非常细的界限（以及非常大的争论）。例如，请参见[此处](https://stackoverflow.com/questions/152313/xml-attributes-vs-elements)。

鉴于此，XML 中没有解决“限制”，因为它不存在。你总是有能力把这些数据放在一个子元素中，事实上我什至会说，如果你甚至不得不考虑这一点，一个元素就是正确的结构。

编辑：更多阅读材料

*   [属性/文本难题](http://xmleverywhere.com/newsletters/20000525.htm)
*   [XML 设计原则：何时使用元素与属性](http://www.ibm.com/developerworks/xml/library/x-eleatt.html)
*   [w3schools 参加](http://www.w3schools.com/DTD/dtd_el_vs_attr.asp)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-11T13:51:28.043

您处理的方式是使用子元素而不是属性。

# php - Javascript 在方法中提交表单

> ID：359284
> 
> 赞同：1
> 
> 时间：2008-12-11T13:11:17.437
> 
> 标签：php, javascript, post

我有一种方法可以打印出一组图像的顺序。我需要将此提交到一个新的 php 页面。

我有一个表格，目前将订单打印到同一页面。

```
<form action="mainpage.php" method="post">
<div style="clear:both;padding-bottom:10px">

    <input type="Button" style="width:100px" value="Show order" onclick="saveImageOrder()">

</div> 
```

`Saveimageorder()`显示图像并将订单保存在名为 orderString 的变量中

```
function saveImageOrder()
{
    var orderString = "";
    var objects = document.getElementsByTagName('DIV');

    for(var no=0;no<objects.length;no++)
    {
        if(objects[no].className=='imageBox' || objects[no].className=='imageBoxHighlighted')
        {
             if(orderString.length>0) orderString = orderString + ',';
             orderString = orderString + objects[no].id;
        }
    }
    document.getElementById('debug').innerHTML = 'This is the new order of the images(IDs) : <br>' + orderString;    
} 
```

这个怎么做？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-11T13:19:05.317

您可以使用以下方式提交表单（请注意，这未经测试）：

```
document.formname.submit(); 
```

如果您需要先更改操作（要提交到的页面）：

```
document.formname.action = 'some_other_url'; 
```

如果您需要异步提交表单，您需要使用 XMLHttpRequest 或类似的东西。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-11T13:27:57.590

使用普通 POST（无 ajax），您需要将处理结果（图像订单 ID 检索）存储在表单字段中：

```
<input type="hidden" name="imagesorder" value=""/> 
```

在您的函数中，您可以在填充 orderString 后将值设置为该字段：

```
document.getElementsByName('imagesorder')[0].value = orderString; 
```

然后提交表格，您可以通过替换您的

```
<input type="button" .../> 
```

和

```
<input type="submit" .../> 
```

在服务器端，您将获得帖子集合中的值（我不是 php 开发人员）

```
$_POST['imagesorder'] 
```

# java - 如何通过 Eclipse 插件使用 Hibernate？

> ID：359287
> 
> 赞同：3
> 
> 时间：2008-12-11T13:11:52.413
> 
> 标签：java, eclipse, hibernate, eclipse-plugin

我正在编写一个从中央数据库加载资源的[Eclipse](http://www.eclipse.com)插件。我想使用[Hibernate](http://www.hibernate.org)访问该数据库。

那么如何将它作为依赖项添加到我的插件项目中呢？我试过谷歌，但只对编辑 Hibernate 配置文件的插件有所了解。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-11T15:15:34.613

我将创建一个休眠插件，它公开所有休眠 jar 文件并导出包含的类。然后，我的配置和数据将位于另一个依赖休眠的插件中。

然后，因为 hibernate 像没有明天一样使用反射，所以 Hibernate 插件需要能够从依赖它的插件中加载类。为此，您需要使用 Eclipse-BuddyPolicy 指令。 [检查这个关于 eclipse 上的类加载的文档，它提到了 BuddyPolicy](http://wiki.eclipse.org/index.php/Context_Class_Loader_Enhancements)

我已经使用这种技术设置了一个 Kodo JDO 插件，并且效果很好。附上我的 Manifest.mf 的样本

```
Manifest-Version: 1.0
Bundle-ManifestVersion: 2
Bundle-Name: Solarmetric Kodo
Bundle-SymbolicName: com.solarmetric.kodo
Bundle-Activator: com.solarmetric.kodo.KodoPlugin
Bundle-Localization: plugin
Require-Bundle: org.eclipse.core.runtime
Eclipse-AutoStart: true
Eclipse-BuddyPolicy: global
Export-Package: com.solarmetric.ant,
 com.solarmetric.apache.commons.collections,
 com.solarmetric.apache.commons.collections.buffer,
 com.solarmetric.apache.commons.collections.collection,
 com.solarmetric.apache.commons.collections.functors,
 com.solarmetric.apache.commons.collections.iterators,
 com.solarmetric.apache.commons.collections.keyvalue, 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-11T14:35:59.420

您可以坚持使用标准的 hibernate 教程，如 hibernate.org 或 Gaven Kings book 上提供的文档，以便在 eclipse rcp 项目中结合使用 hibernate。

最简单的方法是将您的 Hibernate 相关代码和您的配置包含在您当前开发的插件中。

因此，您的插件必须依赖于每个休眠项目所依赖的 jar 文件。您还可以通过单独的插件提供这些库并简单地导出它们。

但是您必须记住，hibernate 大量使用反射，并且您的持久化类必须可供持久性管理器访问。

[在http://entwickler.de/zonen/portale/psecom,id,101,online,1082,.html](http://entwickler.de/zonen/portale/psecom,id,101,online,1082,.html)上还有一个非常好的将 hibernate 集成为单独插件的教程，但不幸的是它只有德语。

# dictionary - 如何让 FxCop 自定义词典工作？

> ID：359290
> 
> 赞同：42
> 
> 时间：2008-12-11T13:13:14.250
> 
> 标签：dictionary, localization, code-analysis, fxcop

如何让 FxCop 自定义词典正常工作？

我尝试将要识别的单词添加到文件“CustomDictionary.xml”中，该文件与 FxCop 项目文件保存在同一文件夹中。这似乎不起作用，因为即使在重新加载并重新运行 FxCop 之后，我仍然会收到“标识符应拼写正确”的 FxCop 消息。使用版本 1.36。

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-01-15T11:33:34.770

如果你在 Visual Studio 中使用它...

来自[Visual Studio 代码分析团队博客](http://blogs.msdn.com/fxcop/archive/2007/08/20/new-for-visual-studio-2008-custom-dictionaries.aspx)

> 将自定义字典添加到 C# 和 Visual Basic 项目很简单：
> 
> 1.  在解决方案资源管理器中，右键单击项目并选择添加 -> 新项目...
> 2.  在 Templates 下，选择 XML File，输入字典的名称，例如 CodeAnalysisDictionary.xml，然后单击 Add
> 3.  在解决方案资源管理器中，右键单击 XML 文件并选择属性
> 4.  在 Properties 工具窗口中，在 Build Action 下选择 CodeAnalysisDictionary
> 5.  在解决方案资源管理器中，双击新创建的字典将其打开
> 6.  在 XML 编辑器中，粘贴以下内容，将“productname”和“companyname”替换为您团队的等效项：
>     
>     
>     
>     ```
>     <Dictionary>
>          <Words>
>             <Recognized>
>                 <Word>"productname"</Word>
>                 <Word>"companyname"</Word>
>             </Recognized>
>         </Words>
>     </Dictionary> 
>     ```
>     
>     
> 
> 您现在可以开始输入您自己的自定义词了。只需为项目中字典中不存在的每个单词添加一个新元素。每个单词都不区分大小写，因此单词的任何大小写都会被识别。代码分析将在下次运行时自动选择自定义字典。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-04-07T15:31:49.897

最简单的方法是将其命名为“CustomDictionary.xml”并将其放入您的解决方案文件夹中，如果您有，FxCop（此处测试为 1.36）将自动获取它

```
<CustomDictionaries SearchFxCopDir="True"
                    SearchUserProfile="True"
                    SearchProjectDir="True" /> 
```

在您的 FxCop 项目文件中。

或者，您可以通过`/dictionary`命令行参数指定它。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-16T12:54:03.323

据我所知，FxCop 1.35 及更高版本使用两个字典来源。

*   Microsoft Office 字典（通过 MS Word 等添加单词应该可以）
*   存储在*FxCop 程序文件夹*而不是项目文件夹中的“CustomDictionary.xml”文件。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2010-04-12T08:35:34.817

我在构建过程中运行 FxCopCmd.exe，在这里我传递了字典命令行参数

```
FxCopCmd.exe ... /dictionary:FxCopDictionary.xml 
```

这项工作与视觉工作室 2010 RC 版本的 FxCop 一起工作。不知道它是否适用于以前的版本。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-11-25T12:06:39.593

除了[上面](https://stackoverflow.com/questions/359290/how-to-get-the-fxcop-custom-dictionary-to-work/726358#726358)大卫施密特的回答，您可能需要从 FxCop 安装文件夹中更改/删除 FxCop 附带的自定义字典。

我刚刚安装了 FxCop v1.36，直到我删除了`C:\Program Files\Microsoft FxCop 1.36\CustomDictionary.xml`.

有一次，我将它移到一侧，FxCop 开始使用`CustomDictionary.xml`解决方案文件夹中的 。

这确实引出了一个问题，即如何将常用词添加到共享自定义词典和其他自定义词典中的项目/解决方案特定词，并实际让 FxCop 使用这两者。但现在它正在工作......

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2014-06-24T13:55:56.820

我为上述大多数答案而苦苦挣扎，并一直在寻找解决方案。我终于对我的 .fxcop 文件进行了更改并将其签入源代码管理，它可以从命令行和 gui fxcop

我改变了这条线

```
<CustomDictionaries SearchFxCopDir="True" SearchUserProfile="True" SearchProjectDir="True" /> 
```

至

```
<CustomDictionaries SearchFxCopDir="True" SearchUserProfile="True" SearchProjectDir="True" >
  <CustomDictionary Path="$(ProjectDir)/CustomDictionary.xml"/>
</CustomDictionaries> 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2012-06-08T23:41:59.303

还要确保文件确实是`*.xml`而不是`*.xml.txt`. 然后觉得用记事本创建文件并忘记它总是添加一个txt扩展名感到很傻。原来对我来说就是这样。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2012-10-07T17:22:46.967

我不必将*Build Action*设置为*CodeAnalysisDictionary*。事实上，我什至没有这个选项（使用 Visual Studio 2010 Professional）。我正在使用[FxCop Integrator](http://fxcopintegrator.codeplex.com/)扩展。它允许您右键单击解决方案并选择*代码分析*。另一个选项是*更多任务*。在*More Tasks*菜单中可以编辑**Edit FxCop Dictionary**。当我执行编辑时，它创建了一个名为*Code Analysis的新**解决方案文件夹，其中包含一个名为**FxCopDictionary.xml*的新 XML 文件。这个 XML 文件的设置正如人们所期望的那样***CustomDictionary.xml*文件看起来像。**

 **希望这可以帮助那里的人！

# c# - 转换有句号而不是逗号的浮点数？

> ID：359298
> 
> 赞同：10
> 
> 时间：2008-12-11T13:18:13.960
> 
> 标签：c#, .net, .net-2.0

我有来自数据库（字符串）中包含文本和价格的表的数据。我从数据中提取价格，但我的问题是有时我可以将其转换为浮动，有时不能。

我注意到 ：

```
Convert.ToSingle(m.Groups[1].Value); 
```

它有效但并非总是如此，因为有时句号是问题（它需要逗号）。我能做些什么？我已经尝试用“，”替换“。”，但有时在其他PC上这是一个需要的时期！

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-12-11T13:20:31.617

你有这个问题，因为转换检查你的电脑的语言。您将需要执行以下操作：

```
Convert.ToSingle(m.Groups[1].Value, CultureInfo.InvariantCulture.NumberFormat); 
```

这样，它就不会检查 PC 的语言。您可以从 MSDN找到有关[InvariantCulture的更多信息。](http://msdn.microsoft.com/en-us/library/system.globalization.cultureinfo.invariantculture.aspx)我在一个项目中有类似的东西，我的转换工作。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-11T17:13:32.847

或者明确要求这种特定的数字格式：

```
System.Globalization.NumberFormatInfo nf
  = new System.Globalization.NumberFormatInfo ( )
{
  NumberGroupSeparator = "."
};
float f = float.Parse ( "5.34534", nf ); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-11T14:28:05.707

如果您没有对数据库的写入权限，首先要做的是尝试说服数据源使用不变文化。如果用户正在输入数据，您可以执行以下操作：

```
float f = float.Parse(input);
string toDb = f.ToString(CultureInfo.InvariantCulture); 
```

然后从另一边：

```
float f = float.Parse(fromDb, CultureInfo.InvariantCulture);
string toOutput = f.ToString(); 
```

虽然如果你能说服他们相信，正如莱特所说，说服他们使用本机数据类型可能会更好。

从上面的片段中可以看出，出于各种原因，我还建议使用 float.Parse 而不是 Convert，但最重要的是使用 TryParse 的能力：

```
float f;
if (!float.TryParse(input, out f))
{
    // ERROR
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-11T13:23:51.670

正如其他人所说：

```
Convert.ToSingle(m.Groups[1].Value, CultureInfo.InvariantCulture); 
```

您还必须确保`InvariantCulture`在**写入**数据库时​​使用 。（如果您将数据保存到具有其本机数据类型的列中会更好，但我离题了......）

# c# - 批处理图像

> ID：359301
> 
> 赞同：1
> 
> 时间：2008-12-11T13:18:37.343
> 
> 标签：c#, image, batch-processing

我必须每天以特定的方式转换几百张图像。

我需要最好的免费软件工具或一段支持批量水印、调整图像大小并且可以自动化（旧配置可以重用）的 C# 代码。

你建议什么工具？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-11T13:22:37.133

[scripting.com](http://scripting.com/)名声的 Dave Winer一直在发布关于他在[ImageMagick](http://www.imagemagick.org/script/index.php)上的成功。我认为它是免费的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-11T13:22:52.407

[IrfanView](http://www.irfanview.com/)有相当不错的批量图像处理/转换支持。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-11T13:24:20.577

如果您想推出自己的解决方案（我猜这就是您用“C#”标记问题的原因），框架中内置的 GDI+ 内容（System.Drawing 及其子项）非常强大，足以完成你需要。这种方法的优点是，如果您选择以这种方式编码，您可以定义自己的转换并整体应用它们。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-11T13:28:43.003

查看[Netpbm 集合](http://netpbm.sourceforge.net/)。它包含 300 多种工具并支持数百种图形格式。您可以轻松地使用工具一一尝试您想要完成的过程，然后将它们绑定到一个脚本中。这是开源代码，所以如果你想获得最大的性能，你甚至可以将你感兴趣的代码打包成一个独立的程序。

您通常通过将工具组合到管道中来使用 netpbm。因此，您将使用[pamscale](http://netpbm.sourceforge.net/doc/pamscale.html)来缩放图像，并使用[pamcomp](http://netpbm.sourceforge.net/doc/pamcomp.html)将结果与水印结合起来。如果水印因每张图片而异，您可以使用[pbmtext](http://netpbm.sourceforge.net/doc/pbmtext.html)创建它。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-11T14:13:26.657

有很多使用 C# 进行此类图像处理的示例，这并不难。

这是 Joel Neubeck 的两篇文章，它们调整了图像的大小和水印。

[http://www.codeproject.com/KB/GDI-plus/imageresize.aspx](http://www.codeproject.com/KB/GDI-plus/imageresize.aspx)

[http://www.codeproject.com/KB/GDI-plus/watermark.aspx](http://www.codeproject.com/KB/GDI-plus/watermark.aspx)

您可以将它们打包在一起并编写一个简单的程序来处理所有图像，同时应用这些操作。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-12T10:10:31.700

[请参阅http://www.abadev.com](http://www.abadev.com)上的 IMG 转换

# svn - Subversion 外部配置中的相对路径

> ID：359302
> 
> 赞同：35
> 
> 时间：2008-12-11T13:18:39.653
> 
> 标签：svn

配置颠覆外部时有什么方法可以使用相对路径。

例如

```
 Trunk
      - directoryA
      - directoryB
      - projectA {external DirectoryB} 
```

为了配置 ProjectA，我们必须在外部属性中配置完整路径，这会导致问题或迫使我们在执行分支时更改属性。

任何自动化分支过程或使用绝对路径修复的方法都会很有用

* * *

## 回答 #1

> 赞同：60
> 
> 时间：2008-12-11T14:25:42.810

Subversion 1.5 客户端支持相对 url：

有关详细信息，请参阅[Subversion 1.5 发行说明](http://subversion.apache.org/docs/release-notes/1.5.html#externals)和[subversion 手册](http://svnbook.red-bean.com/nightly/en/svn.advanced.externals.html)

一些例子：（注意不支持注释语法）

```
# Repository root relative
^/projectX/trunk/src/ projectX

# Relative to current directory
../../dependency/X X

# Server root relative
/svn/repos/projectX/trunk/src projectX

# Schema relative
//svn.collab.net/repos/svn/trunk svn 
```

# objective-c - 如何为控件分配名称并在事件方法中检索它？

> ID：359303
> 
> 赞同：2
> 
> 时间：2008-12-11T13:18:52.180
> 
> 标签：objective-c, cocoa-touch, interface-builder

我有一个 IBAction，例如：

```
- (IBAction)showPicker:(id)sender; 
```

如何从 sender 变量中获取控件的名称？

我通常是 ac# 编码器，所以尝试了以下方法无济于事

```
senderName = ((UIButton *)sender).name; 
```

我需要比控件 ID 更具描述性的东西（也不是按钮标题）。我有 5 个按钮都调用相同的方法。我需要确定单击了哪个以便对适当的控件执行方法操作。IE 我有一个地址选择器方法，但想用 5 个按钮中的每一个填充 5 个具有不同详细信息的文本字段。只是试图保持代码整洁

NB 最初我计划使用 Interface Builders 名称字段，但我被告知（如下）这在运行时不可用。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-11T13:42:26.657

您可能想查看使用*tag*属性。它是一个整数而不是名称，但可用于区分两个控件。它是从 UIView 继承的，因此任何发送事件的控件都应该拥有它。

它可以在 Interface Builder 中的 View attributes 下进行编辑。

它是一个属性，因此可以使用点符号以编程方式访问它：

```
control.tag 
```

或者您可以转换为字符串，如下所示：

```
[stringWithFormat:@"%d", control.tag] 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-11T20:10:04.987

您不使用 Interface Builder 中的对象名称来引用该对象；它只是供参考。（Interface Builder 还将使用它来提示连接到控件的出口以及控件发送的操作可能被命名，但仅作为提示。）

相反，您将插座添加到您连接到该对象的控制器对象。这使您可以在运行时直接从控制器访问对象，而无需经过任何查找步骤。

此外，听起来您有五个按钮，有五件事要做，都连接到同一个操作方法。不要那样做。

在 Cocoa 和 Cocoa Touch 中，您通常不应该为“每个事件”创建一个操作方法，然后根据哪个控件发送事件来决定要做什么。Cocoa 中的控件自己处理事件，并将它们转换为更高级别的操作。因此，您可以在控制器中实现五种操作方法，将每个按钮连接到相应的操作方法，而不必根据哪个控件发送操作来决定要做什么。

显然，这并不适用于所有情况。例如，如果您有一个按钮矩阵，其中的图像在运行时会发生变化，您可能希望它们都连接到相同的操作并根据它们的标记属性来区分它们。一个好的经验法则是在处理“不同”事物时使用不同的操作方法，而在处理“许多相同”事物时使用相同的操作方法和控制标签。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2012-02-20T21:03:44.170

虽然我同意标签在许多情况下都可以使用，但是当您有一个包含 100 个按钮的矩阵时，使用整数标签会很痛苦，这些按钮可以在您想要识别的位置进行推送：(1) 推送的内容和 (2) 推送的值. 我发现自己开始发明带有失控的标签号的行/列命名方案。

我希望多个控件共享同一个处理程序，并且我想在 IB 中仔细设计我的 UI，以根据推送的内容将名称/值对传递给键值存储。

作为标签的替代方案，我为 UISegmentedControl 提出了另一种解决方法（它也适用于其他控件）。

（1）新建类和子类UISegmentedControl。将字符串属性 MyCustomKey 添加到您的新类。

```
@interface CustomSegmentedControl : UISegmentedControl
@property (nonatomic, retain) NSString* myCustomKey; 
@end 
```

(2) 回到 IB，将 UISegmentedContol 实例修改为 CustomSegmentedControl 实例。使用 IB“用户定义的运行时属性”来设置使用 IB 的 myCustomKey 的值。KeyValueCoding 将为您处理属性设置：

![通过界面构建​​设置自定义属性的屏幕截图](https://i.stack.imgur.com/TOmg3.png)

(3) 将所有按钮连接到一个 IBAction。

(4) 在您的 IBAction 中，您现在可以通过读回您的自定义属性来提取键值对：

```
- (IBAction)myButtonPressed:(id) sender
{
    if ([sender isKindOfClass:[CustomSegmentedControl class]] == false)
        return;

    // get the key-values from the control
    CustomSegmentedControl *control = (CustomSegmentedControl *)sender;
    NSString *key = [control valueForKey:@"myCustomKey"];
    NSNumber *value = [NSNumber numberWithInteger:[control selectedSegmentIndex]];
    NSLog(@"Pressed control %@ with a value of %@", key, value);
} 
```

在这种情况下，我只对分段控件的整数值感兴趣，但您可以从控件中获取任何属性作为值。

希望这可以帮助。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-11T13:36:37.853

Interface Builder Identity 下的`name`字段是 Interface Builder 独有的；我实际上不确定它是如何使用的，但它不会映射到您实际控件上的可用属性、ivar 或方法。相反，`tag`如果您不保留对它们的引用作为 ivar，请使用该属性（在 View 属性下）将不同的控件与操作方法区分开来。如果我误解了您并且您想要按钮的标题，请`currentTitle`改用。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-11T13:41:06.393

如果控件具有名称属性，则：

```
NSString *senderName = [sender name]; 
```

这不是大多数控件所具备的。你可能想要：

```
NSString *senderName = [sender title]; 
```

例如，如果它是一个 NSButton。或者正如 Marc 所说，对于 UIButton，使用 currentTitle。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-11T13:42:09.310

尝试：

```
senderTitle = [sender currentTitle]; 
```

# wpf - WPF 路由命令和 ShowDialog 窗口

> ID：359304
> 
> 赞同：2
> 
> 时间：2008-12-11T13:18:54.317
> 
> 标签：wpf, command, showdialog, routed

我想知道如何在可视树中处理通过 ShowDialog 打开的窗口。

例如，窗口 A 通过 ShowDialog 打开窗口 B。在窗口 B 上触发路由命令时，窗口 A 不会收到该命令（即使它正在侦听它）。

有什么办法可以使这项工作？

谢谢！乔恩

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-11T19:57:28.880

我们在我们的应用程序中一直遇到这种情况。为此，我们使用 Window.Owner 属性和 ICommandSource.CommandTarget 属性。

例如，在窗口 A 中：

```
DialogWindow windowB = new DialogWindow();
windowB.Owner = this;
windowB.ShowDialog(); 
```

然后，在 DialogWindow 中，所有执行命令的控件都将其 CommandTarget 绑定到父窗口的所有者：

```
<Window x:Class="DialogWindow" x:Name="wnd">
    <Button Command="SomeCommand" CommandTarget="{Binding Owner, ElementName=wnd}"/>
</Window> 
```

或者，如果您从窗口 B 中的代码执行：

```
SomeCommand.Execute(params, this.Owner); 
```

CommandTarget 将让窗口 A 监听 CanExecute 和 Execute。

# java - 如何配置 JAXB 以便在解组标记值时修剪空格？

> ID：359315
> 
> 赞同：11
> 
> 时间：2008-12-11T13:22:16.870
> 
> 标签：java, xml, jaxb

如何配置 JAXB unmarshaller 以便从字符串中修剪前导和尾随空格？

例如，让我们考虑一个使用 JAXB 注释的 Java bean 和 XML 之间的简单绑定：

```
@XmlRootElement(name="bean")
class Bean {

  @XmlElement(required=true)
  String name;

  @XmlElement(required=true)
  int number;
} 
```

我希望能够解组下面给出的 XML，因此**bean.name**不包括开头和结尾的空格 - 是“**我的名字**”，而不是“ **\n 我的名字\n** ”。

```
<bean>
  <name>
    My name
  </name>
  <number>1</number>
</bean> 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-11T13:39:21.030

使用自定义*适配器*类。我在想[NormalizedStringAdapter](http://java.sun.com/javase/6/docs/api/javax/xml/bind/annotation/adapters/NormalizedStringAdapter.html)会做这项工作，但它只是为了解组，它不会做你想做的事。

```
public class MyNormalizedStringAdapter extends XmlAdapter<String, String> {

    @Override
    public String marshal(String text) {
        return text.trim();
    }

    @Override
    public String unmarshal(String v) throws Exception {
        return v.trim();
    }
} 
```

然后用你的适配器装饰这个字段，如下所示：

```
@XmlElement(required=true)
@XmlJavaTypeAdapter(MyNormalizedStringAdapter.class)
String name; 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2020-02-21T10:38:44.053

要在解组期间删除前导和尾随空格，您可以使用适配器[CollapsedStringAdapter](https://docs.oracle.com/javase/8/docs/api/javax/xml/bind/annotation/adapters/CollapsedStringAdapter.html)（从 Java 1.6 开始）。

> 内置 XmlAdapter 来处理 xs:token 及其派生类型。此适配器删除前导和尾随空格，然后用单个空格字符“”截断制表符、CR、LF 和 SP 的任何序列。

```
@XmlElement(required=true)
@XmlJavaTypeAdapter(CollapsedStringAdapter.class)
String name; 
```

# c# - 在方法中创建委托类型

> ID：359320
> 
> 赞同：23
> 
> 时间：2008-12-11T13:22:46.463
> 
> 标签：c#, .net-2.0, delegates

为了创建匿名方法，我想在 C# 中的方法内创建一个委托类型。

例如：

```
public void MyMethod(){
   delegate int Sum(int a, int b);

   Sum mySumImplementation=delegate (int a, int b) {return a+b;}

   Console.WriteLine(mySumImplementation(1,1).ToString());
} 
```

不幸的是，我不能使用 .NET 2.0 和 C# 2.0 来做到这一点。

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2008-12-11T13:28:14.440

为什么要在方法中创建委托类型？在方法之外声明它有什么问题？基本上，你不能这样做——你不能在方法中声明一个*类型*（任何类型）。

一种替代方法是声明 .NET 3.5 中存在的所有 Func/Action 泛型委托 - 然后您可以这样做：

```
public void MyMethod(){
    Func<int, int, int> mySumImplementation = 
        delegate (int a, int b) { return a+b; };

    Console.WriteLine(mySumImplementation(1,1).ToString());
} 
```

声明在我的[C#/.NET 版本页面上](http://csharpindepth.com/Articles/Chapter1/Versions.aspx)。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2008-12-11T13:29:50.677

委托*类型*必须在函数之外定义。可以像您一样在方法内部创建实际的委托。

```
class MyClass {
  delegate int Sum(int a, int b);
  public void MyMethod(){

       Sum mySumImplementation=delegate (int a, int b) {return a+b;}

       Console.WriteLine(mySumImplementation(1,1).ToString());
  }

} 
```

将是有效的。最好的解决方案可能是模拟 .NET3.5，并在全局范围内创建一些通用委托类型，这些委托类型可以在您的整个解决方案中使用，以避免必须不断地为所有内容重新声明委托类型：

```
delegate R Func<R>();
delegate R Func<T, R>(T t);
delegate R Func<T0, T1, R>(T0 t0, T1 t1);
delegate R Func<T0, T1, T2, R>(T0 t0, T1 t1, T2 t2); 
```

然后，您可以`Func<int, int, int>`在上面的代码中使用委托。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2011-04-26T06:54:24.520

委托被编译为类（继承自 System.MulticastDelegate 的类）。在 C# 中，不允许在方法中声明类（请参阅 C# 语言规范）。因此，您也不能在方法中声明委托。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2016-06-12T21:21:10.230

那这个呢：

```
static void Main(string[] args)
{
    Expression<Func<int, int, int>> exFunc = (a, b) => a + b;
    var lambda = exFunc as LambdaExpression;
    Delegate del = exFunc.Compile();
    Console.WriteLine(del.DynamicInvoke(2, 2));
} 
```

# mysql - Mysql查询优化

> ID：359321
> 
> 赞同：0
> 
> 时间：2008-12-11T13:22:47.103
> 
> 标签：mysql, optimization

我有以下 SQL 查询：

```
select expr1, operator, expr2, count(*) as c 
from log_keyword_fulltext 
group by expr1, operator, expr2 
order by c desc limit 2000; 
```

问题：`count(*)`作为我订购的一部分，正在杀死我的应用程序，可能是因为它不使用索引。我想知道是否有任何方法可以使它更快，例如 a `select`inside of another`select`或类似的东西。

我的`SELECT`解释：

```
+----+-------------+----------------------+-------+---------------+-------+---------+------+--------+----------------------------------------------+
| id | select_type | table                | type  | possible_keys | key   | key_len | ref  | rows   | Extra                                        |
+----+-------------+----------------------+-------+---------------+-------+---------+------+--------+----------------------------------------------+
|  1 | SIMPLE      | log_keyword_fulltext | index | NULL          | expr1 | 208     | NULL | 110000 | Using index; Using temporary; Using filesort | 
+----+-------------+----------------------+-------+---------------+-------+---------+------+--------+----------------------------------------------+ 
```

更新：

我试图做一个这样的子查询

```
select * from (select b.expr1,b.operator,b.expr2,count(*) as c 
from log_keyword_fulltext b group by b.expr1,b.operator,b.expr2) x 
order by x.c desc limit 2000; 
```

它的工作但不是更快，以下是解释：

```
+----+-------------+------------+-------+---------------+-------+---------+------+--------+----------------+
| id | select_type | table      | type  | possible_keys | key   | key_len | ref  | rows   | Extra          |
+----+-------------+------------+-------+---------------+-------+---------+------+--------+----------------+
|  1 | PRIMARY     | <derived2> | ALL   | NULL          | NULL  | NULL    | NULL |  38398 | Using filesort | 
|  2 | DERIVED     | b          | index | NULL          | expr1 | 208     | NULL | 110000 | Using index    | 
+----+-------------+------------+-------+---------------+-------+---------+------+--------+----------------+ 
```

你现在可以检查一下，它不再使用临时的了，但它仍然具有相同的性能。有什么建议吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-11T14:29:10.057

您正在运行一个需要扫描整个表的查询，这不会扩展。没有 WHERE 子句，所以它绝对需要扫描整个事情。

考虑维护一些汇总表，而不是经常执行此查询。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-11T13:50:49.683

始终尝试对某个单列进行计数，而不是使用 count(*)，因为它需要对每行的每一列进行排列计数。所以需要更长的时间

```
Eg:

select expr1, operator, expr2, count(expr1) as c 
from log_keyword_fulltext 
group by expr1, operator, expr2 
order by c desc limit 2000; 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-11T19:52:02.370

我错过了什么？我没有看到 WHERE 子句。在我看来，您正在**请求**表扫描。

如果您指望您的“LIMIT”子句，那么您就不走运了 - 那是 COUNT 聚合计算。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-11T14:10:50.797

“杀死你的应用程序”是什么意思？上下文是什么？您多久运行一次此查询？运行此查询时数据库上发生了什么？这个特定的结果是否必须是实时的？条件是什么（inserts/s、selects/s、db size等）

这是你可以做的：

1.  将计数存储在单独的表中，您将使用插入/删除触发器更新该表

2.  如果你不能强迫 MySQL 通过简单的表格滑动来执行此操作，请尝试使用存储过程来执行类似（伪代码）的操作：

    ```
    CREATE TEMP TABLE t (e1 EXP_T, op OP_T, e2 EXP_T, count INTEGER)
    ADD AN INDEX ON count
    FOR EACH LINE OF SELECT exp1,operator,exp2 FROM log_blah DO
           UPDATE t SET count=count+1 WHERE exp1=e1 AND operator=op AND exp2=e2
           IF IT DOES NOT WORK INSERT INTO t VALUES (exp1,operator,exp2,1)
    DONE
    SELECT * FROM t ORDER BY count DESC LIMIT 2000 
    ```

1 可能是你想要的。忘记索引，这个查询无论如何都必须刷整个表。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-11T19:35:29.097

防止表扫描的最佳方法是为您经常访问的字段添加封面索引。创建索引需要一次性成本。表上的 INSERT 和 DELETE 操作也有一些额外的成本，因此可以更新索引。

覆盖索引可防止数据库必须将整个记录读入内存才能访问您关心的少数字段的值。整个查询可以脱离索引运行。

```
ALTER TABLE `log_keyword_fulltext` ADD INDEX `idx_name`(expr1, operator, expr2) 
```

如果这些不是实际字段，而是字段上的操作，例如 left(foo,20)，您实际上可以索引您将在未来 SELECT 或 WHERE 子句中使用的字段部分。

有关其他优化想法，请参阅[此页面](http://dev.mysql.com/doc/refman/5.0/en/query-speed.html)。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-12-11T13:39:46.693

试图对其进行计数和排序将是一个杀手。我建议尝试使用计数创建一个临时表，然后对其执行 select...order by。

不确定这是否适用于 MySQL，但在 PostreSQL 或 Oracle 中，那将是

```
create foo as 
   select expr1, operator, expr2, count(*) as c
   from log_keyword_fulltext 
   group by expr1, operator, expr2;
select * from foo order by c desc limit 2000; 
```

此外，您必须进行所有计数才能对它们进行排序，因此限制子句不会阻止它进行所有这些计算。

# php - javascript不工作，没有错误

> ID：359328
> 
> 赞同：0
> 
> 时间：2008-12-11T13:24:44.057
> 
> 标签：php, javascript, ajax

我有以下 javascript 代码，加载时没有错误，但是更新函数实际上似乎不起作用，因为 get_Records.php 从未加载。我无法测试是否加载了 get_auction.php，因为它是从 get_records.php 中加载的

**我主要担心的一个问题**是，我让 update() 获取参数 pk 和查询是错误的，因为只有其中一个会被使用。这似乎是一个糟糕的 hack 和糟糕的逻辑，但我不知道有更好的方法。

这是代码

```
var xmlHttp
var layername
var url

function update(layer, part, pk, query) {
    alert ("update");
    if (part=="1") {
        alert ("part 1");
        url = "get_auction.php?cmd=GetAuctionData&pk="+pk+"&sid="+Math.random()
    } else if (part=="2") {
        alert ("part 2");
        url = "get_records.php?cmd=GetRecordSet&query="+query+"&sid="+Math.random()
    }
    xmlHttp=GetXmlHttpObject()
    if(xmlHttp==null) {
        alert("Your browser is not supported?")
    }
    xmlHttp.onreadystatechange = function() {
        if(xmlHttp.readyState==4 || xmlHttp.readyState=="complete") {
            document.getElementById(layer).innerHTML=xmlHttp.responseText
        } else if (xmlHttp.readyState==1 || xmlHttp.readyState=="loading") {
            document.getElementById(layer).innerHTML="loading"
        }
    };
    xmlHttp.open("GET",url,true)
    xmlHttp.send(null)
}

function GetXmlHttpObject() {
    var xmlHttp=null;
    try {
        xmlHttp = new XMLHttpRequest();
    } catch (e) {
        try {
            xmlHttp =new ActiveXObject("Microsoft.XMLHTTP");
        } catch (e) {}
    }
    return xmlHttp;
}

function makewindows() {
    child1 = window.open ("about:blank");
    child1.document.write(<?php echo htmlspecialchars(json_encode($row2["ARTICLE_DESC"]), ENT_QUOTES); ?>));
    child1.document.close(); 
} 
```

我将警报语句放入更新函数中，但没有显示，表明从未调用过更新函数？

我不想，也不能使用框架，也无法使用 firebug，所以请不要建议这些东西。我知道它们并尽可能使用它们。

我还想知道从 makewindows() 中调用 php 是否比让 makewindows 简单地接受一个参数..，每种方法有什么优点或缺点吗？

尝试调用该函数时似乎出现错误，这就是我在 PHP 中的操作方式：

```
echo "<li><a href='#' onclick=update('Layer3','2','0','hello')'>Link 1</a></li>" . 
```

这使得这个 html，应该没问题？"\n";

```
<li><a href='#' onclick='update('Layer3','2','0','hello')'>Link 1</a></li> 
```

编辑：我接受了 tester101 的建议并将其更改为：

```
echo '<li><a href="#" onclick="update(\'Layer3\',\'2\',\'0\',\'hello\')">Link 1</a></li>' . "\n"; 
```

这仍然给出了一个错误。我可能最终会使用 toms 答案，但想知道为什么这不起作用。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-11T14:27:37.220

如果您可以使用 Firefox 并重现错误，我强烈建议您使用[Firebug](http://getfirebug.com/)，因为它非常易于使用，并且可以逐步执行脚本、设置断点等。另外，您可以使用类似的东西而不是使用“警报”语句`console.info("unexpected value x=%o", some_object);`，它会将一个值记录到控制台（包括第 # 行），您可以稍后在不中断脚本的情况下进行检查。

编辑：事实上，如果您在服务器上使用 PHP，您可以使用[FirePHP](http://www.firephp.org/)来帮助在客户端进行调试。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-11T13:40:38.830

您是否验证过 PHP 代码返回的内容是合理的？（我假设您可以查看 html 的源代码。）

使用良好的警报调试：`windows.alert("GetXmlHttpObject started.");`在您的代码中插入警报语句（例如 ）以确保您可以访问它们。

[JSLint](http://www.jslint.com/)可能会帮助你。不过，我试了一下，并没有发现任何真正的错误。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-11T13:43:13.973

如果您可以在 Firefox 中打开您的页面，我会检查错误控制台 (csJ)。它帮助我找到了很多很多错别字。

此外，您的代码似乎缺少很多分号。也许其中一些是可选的，但......

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-11T13:45:31.877

您可以将 Url 作为 update() 的参数，然后您不需要在其中构建 url，也不需要“可选”参数

**编辑（回复评论）**

如果你有一个 update() 函数，它只接受 url 和元素 id（层）并根据 AJAX 调用的结果更新它，你可以做这样的事情来消除对可选参数的需要并使用一个函数来做两个不同的东西。

```
function update(layer, url) {
    var xmlHttp=GetXmlHttpObject(); //you have this defined elsewhere

    if(xmlHttp==null) {
        alert("Your browser is not supported?");
    }

    xmlHttp.onreadystatechange = function() {
        if(xmlHttp.readyState==4 || xmlHttp.readyState=="complete") {
            document.getElementById(layer).innerHTML=xmlHttp.responseText;
        } else if (xmlHttp.readyState==1 || xmlHttp.readyState=="loading") {
            document.getElementById(layer).innerHTML="loading";
        }

       //etc
    }

    xmlHttp.open("GET",url,true);
    xmlHttp.send(null);
}

function updateByPk(layer, pk) {
   url = "get_auction.php?cmd=GetAuctionData&pk="+pk+"&sid="+Math.random();
   update(layer, url);
}

function updateByQuery(layer, query) {
   url = "get_records.php?cmd=GetRecordSet&query="+query+"&sid="+Math.random();
   update(layer, url);
} 
```

然后调用其中一个，具体取决于您要执行的操作：

```
updateByPk('id_of_div', 2); 
```

或者

```
updateByQuery('id_of_div2', 'query'); 
```

例如在 HTML

```
<a href="#" onclick="updateByQuery('Layer3', 'hello');">Link 1</a> 
```

或在 PHP 中生成

```
<?php echo '<a href="#" onclick="updateByQuery(\'Layer3\', ' . json_encode($query) . ');">Link 1</a>'; 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-11T15:30:25.533

关于您的担忧，据我所知，如果您不提供所有参数，JavaScript 不会抱怨。

例如

```
function myFunction(var1, var2, var3, var4){ 
```

像这样调用这个函数：

```
myFunction('test1','test2'); 
```

不会产生错误。

它类似于在参数旁边放置一个默认值，默认值在 javascript 中为 null 或 undefined。

您可以通过检查来对此进行测试：

```
if(null != var3){ 
```

可能会帮助您稍微清理一下该功能；你也可以从网上收获一个小的 ajax 类，它会稍微整理你的 javascript。有很多包装函数可以封装 xmlHttpRequest 对象，允许跨浏览器使用并获得相同的结果。

如果您需要任何帮助，请告诉我。我有信心，如果您找到一些预构建的 ajax 方法（[jQuery](http://jquery.com)有一些很棒的功能！），您尝试完成的任务会容易得多。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-11T15:48:22.520

括号不匹配

```
child1.document.write(<?php echo htmlspecialchars(json_encode($row2["ARTICLE_DESC"]), ENT_QUOTES); ?>)); 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-11T15:53:07.517

```
 onclick=update('Layer3','2','0','hello')'>Link 1 
```

我不知道这是否是一个错字，但这条线应该是

```
 onclick="update('Layer3','2','0','hello')">Link 1 
```

这段代码会报错，永远不会调用update，因为onClick=之后的单引号终止于('。使用双引号。

```
 onclick='update('Layer3','2','0','hello')'>Link 1 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-11T16:40:01.417

也许换行太多？

在大多数语言中，您可以使用换行符作为命令分隔符，或者使用“;”。在 JavaScript 中，两者兼而有之：换行符*有时*用作“;”

试试这个，看看是否有帮助：

```
function update(layer, part, pk, query) {
   alert ("update");
   if (part=="1") {
      alert ("part 1");
      url = "get_auction.php?cmd=GetAuctionData&pk="+pk+"&sid="+Math.random()
   } else if (part=="2") {
      alert ("part 2");
      url = "get_records.php?cmd=GetRecordSet&query="+query+"&sid="+Math.random()
   }
   // and so on...
} 
```

唯一不同的是格式：开头的卷曲与使用它的构造在同一行（'if'，'else'，'function'，...）。

# .net - 从 x64 .NET 访问 x86 COM

> ID：359331
> 
> 赞同：27
> 
> 时间：2008-12-11T13:25:43.150
> 
> 标签：.net, com, interop, x86, 64-bit

我有一个 x64 服务器，因为我的库被编译为 AnyCPU，所以在 x64 下运行。我们需要访问在 x86 下注册的 COM 组件。我对 COM 知之甚少，我的谷歌搜索让我无处可去。

问题：我可以为 COM 组件使用从 x64 回到 x86 的符号注册表链接吗？我是否也需要在 x64 下注册 COM 组件？我可以（这里有任何声明......）吗？

谢谢。

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2008-12-11T13:46:45.587

如果一个组件正在运行 x64-native，它不能在进程中加载​​ 32 位 COM 服务器，因为它是错误的进程类型。有几种可能的解决方案：

1.  如果可以的话，构建一个 64 位版本的 COM 代码（它当然会在 64 位注册表中注册自己）。这是最干净的解决方案，但如果您没有 COM 服务器的代码，则可能无法实现。

2.  将 .NET 组件作为 32 位 x86 而不是 x64 运行。我假设你已经考虑过并出于某种原因拒绝了这个。

3.  使用[COM 代理](http://msdn.microsoft.com/en-us/library/ms684044(VS.85).aspx)DLLhost.exe 在进程外托管 COM 组件。这将使对 COM 服务器的调用慢得多（它们现在将是进程间 Windows 消息，而不是本机函数调用），但在其他方面是透明的（您不必做任何特别的事情）。

    如果服务器需要自定义代理存根而不是使用普通的 oleaut32 代理存根（尽管非常罕见），这可能不是一个选项，因为不会有 64 位版本的代理可用。只要它可以使用普通的 OLE 编组，您就可以[将其注册为代理激活](http://msdn.microsoft.com/en-us/library/ms686606(VS.85).aspx)。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-01-15T19:10:53.460

我找到了这个解决方案，[在 64 位 Windows 中处理旧版 32 位组件，](http://blogs.msdn.com/b/volkerw/archive/2006/03/23/559087.aspx)请参阅文章：
• 将项目类型从进程内转换为进程外
• 使用 COM+ 作为主机（这对我有用）
•使用 dllhost 作为代理主机

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-11T13:48:22.200

它是您的 COM 组件位于 COM 服务器（即单独的进程）中，然后您不需要做任何特别的事情，因为 COM 子系统会将您的调用从 x64 应用程序远程调用到 X86 应用程序并再次返回。

如果您的组件是进程内 COM 组件，那么您将不得不重新考虑，因为 64 位进程不能在进程 COM 组件中使用 32 位。您可以强制您的服务器在 x86 下运行，以便您可以访问组件（它们都是 32 位进程）。如果您不想这样做，那么您必须查看您正在使用的 COM 组件是否有 x64 位版本。

# ruby - 用andand查找和替换“！= null”代码的最佳方法是什么？

> ID：359332
> 
> 赞同：2
> 
> 时间：2008-12-11T13:25:44.180
> 
> 标签：ruby, groovy, null, grep

我重构了我的代码，我正在寻找一种解决方案来 grep 我的源文件，例如

```
if ( user && user.name && user.name.length() < 128 ) ... 
```

为了以后用 ruby​​ 的 andand 或 groovy 的 ? 替换它。操作员（安全导航操作员）。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-12T14:15:58.077

这是让您入门的东西，我想知道这是否可以更概括，而不必以编程方式生成正则表达式

```
line = "user && user.name && user.name.length()"
p line.match(/(?:(\w*)(?:\s\&\&\s(\1\.(\w*)))(?:\s\&\&\s(\2\.(\w*))))/).to_a.
  reject {|m| m.match(/\./)}.join('.andand.')

=> "user.andand.name.andand.length" 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-11T13:40:36.677

IntelliJ idea 有一个“结构搜索和替换”，可以让你做到这一点。这了解语言的语义，因此您可以执行各种有趣的替换操作。

[http://www.jetbrains.com/idea/documentation/ssr.html](http://www.jetbrains.com/idea/documentation/ssr.html)

# c# - 如果没有用户登录，服务器上的 Windows 服务将无法运行

> ID：359333
> 
> 赞同：1
> 
> 时间：2008-12-11T13:26:04.427
> 
> 标签：c#, .net, windows-services, windows-server-2003

我创建了一个 Windows 服务，它基本上是一个文件观察器，除非用户登录到它所在的机器，否则它不会运行。该服务在 Windows Server 2003 机器上运行。它旨在根据文件名中的关键字将放在一个目录中的文件移动到不同的目录中，但是在我登录之前没有文件移动，然后所有文件一次移动。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-11T14:49:48.347

您可能必须将服务设置为以特定用户身份登录，尝试进入服务，双击服务并选择“以帐户登录”，然后提供您的帐户详细信息（域\用户名和密码）。

LocalService 帐户具有广泛的权限，但可能缺乏对特定用户文件/文件夹的权限。您也可以尝试向 LocalService 帐户特别授予文件权限。但是，我会先尝试“登录为”技巧，因为这是一个 1 分钟的工作。如果它有效，您可以创建一个特定帐户来运行该服务，或者授予 LocalSystem 权限。

顺便说一句：如果是网络文件，您可以尝试使用 NetworkedService 帐户。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-11T14:43:08.890

您的服务必须存在一些设置问题。Windows Server 在没有用户登录的情况下运行应用程序没有问题（否则，计划任务的用处会少很多）。

你是如何*安装*服务的？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-11T14:49:10.203

需要澄清几点：

*   你提到

> 除非用户登录到机器上否则不会运行的文件观察器

这是如何实施的？一般情况下，服务会在机器启动时自动启动，因为每个windows服务运行在不同的windows station下，具有独立的安全上下文

*   你还提到

> 但是在我登录之前没有任何文件移动

这是否与第一点不矛盾，因为这是它已经实施的目的？[我假设上述观点已经实施]

*   服务是否配置为在特殊帐户下运行？
*   服务器是否已配置为需要特殊权限才能在文件系统上移动文件？

# c# - 加密许可证文件的有效方法？

> ID：359342
> 
> 赞同：22
> 
> 时间：2008-12-11T13:29:09.727
> 
> 标签：c#, encryption, cryptography

对于 Web 应用程序，我想创建一个简单但有效的许可系统。在 C# 中，这有点困难，因为任何安装了 Reflector 的人都可以查看我的解密方法。

在 C# 中加密文件有哪些相当防篡改的方法？

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2008-12-11T16:17:16.843

听起来您想使用公共/私有密码术来签署许可证令牌（例如 XML 片段或文件），以便检测篡改。处理它的最简单方法是执行以下步骤：

1) 为您的公司生成密钥对。您可以使用 SN 工具在 Visual Studio 命令行中执行此操作。语法是：

```
sn -k c:\keypair.snk 
```

2) 使用密钥对来强命名（即签名）您的客户端应用程序。您可以使用应用程序属性页面中的签名选项卡进行设置

3) 为您的客户创建一个许可证，这应该是一个 XML 文档并使用您的私钥对其进行签名。这涉及简单地计算数字签名和完成它的步骤可以在以下位置找到：

[http://msdn.microsoft.com/en-us/library/ms229745.aspx](http://msdn.microsoft.com/en-us/library/ms229745.aspx)

4) 在客户端，在检查许可证时，您加载 XmlDocument 并使用您的公钥验证签名，以证明许可证未被篡改。有关如何执行此操作的详细信息，请访问：

[http://msdn.microsoft.com/en-us/library/ms229950.aspx](http://msdn.microsoft.com/en-us/library/ms229950.aspx)

要绕过密钥分发（即确保您的客户端使用正确的公钥），您实际上可以从签名程序集本身中提取公钥。因此确保您没有另一个密钥可以分发，即使有人篡改程序集，.net 框架也会因安全异常而死，因为强名称将不再与程序集本身匹配。

要从客户端程序集中提取公钥，您需要使用类似于以下的代码：

```
 /// <summary>
    /// Retrieves an RSA public key from a signed assembly
    /// </summary>
    /// <param name="assembly">Signed assembly to retrieve the key from</param>
    /// <returns>RSA Crypto Service Provider initialised with the key from the assembly</returns>
    public static RSACryptoServiceProvider GetPublicKeyFromAssembly(Assembly assembly)
    {
        if (assembly == null)
            throw new ArgumentNullException("assembly", "Assembly may not be null");

        byte[] pubkey = assembly.GetName().GetPublicKey();
        if (pubkey.Length == 0)
            throw new ArgumentException("No public key in assembly.");

        RSAParameters rsaParams = EncryptionUtils.GetRSAParameters(pubkey);
        RSACryptoServiceProvider rsa = new RSACryptoServiceProvider();
        rsa.ImportParameters(rsaParams);

        return rsa;
    } 
```

我在 Snipt 上上传了一个示例类，其中包含许多有用的加密实用程序：http://snipt.net/Wolfwyrd/encryption-utilities/[以](http://snipt.net/Wolfwyrd/encryption-utilities/)帮助您上路。

我还在以下位置包含了一个示例程序：[https](https://snipt.net/Wolfwyrd/sign-and-verify-example/) ://snipt.net/Wolfwyrd/sign-and-verify-example/ 。该示例要求您将其添加到具有加密实用程序库的解决方案中，并提供一个测试 XML 文件和一个用于签名的 SNK 文件。该项目应设置为使用您生成的 SNK 进行签名。它演示了如何使用来自 SNK 的私钥对测试 XML 文件进行签名，然后通过程序集上的公钥进行验证。

**更新**

添加[了最新的博客文章](http://www.leapinggorilla.com/Blog/Read/1019/signed-xml-licenses)，其中包含许可证文件的详细介绍

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-12-11T14:05:03.850

使用签名的 XML 文件。使用密钥对的私钥部分对其进行签名，并使用软件中的公钥部分对其进行检查。这使您有机会检查许可证是否已被更改，并检查许可证文件是否有效。

MSDN 中记录了对已签名 XML 文件的签名和检查。

您在自己的公司签署许可证文件并将许可证文件发送给客户，然后客户将许可证文件放在一个文件夹中供您阅读，这当然是合乎逻辑的。

当然，人们可以剪切/破解您的分布式程序集并撕掉 xml 符号检查，但话又说回来，无论您做什么，他们总是能够这样做。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-10-29T11:25:29.530

Wolfwyrd 的回答非常好，但我只是想提供一个更简单的 Wolfwyrd`GetPublicKeyFromAssembly`方法版本（它使用了 Wolfwyrd 慷慨提供的库中的许多辅助方法）。

在这个版本中，这是您需要的所有代码：

```
/// <summary>
/// Extracts an RSA public key from a signed assembly
/// </summary>
/// <param name="assembly">Signed assembly to extract the key from</param>
/// <returns>RSA Crypto Service Provider initialised with the public key from the assembly</returns>
private RSACryptoServiceProvider GetPublicKeyFromAssembly(Assembly assembly)
{
    // Extract public key - note that public key stored in assembly has an extra 3 headers
    // (12 bytes) at the front that are not part of a CAPI public key blob, so they must be removed
    byte[] rawPublicKeyData = assembly.GetName().GetPublicKey();

    int extraHeadersLen = 12;
    int bytesToRead = rawPublicKeyData.Length - extraHeadersLen;
    byte[] publicKeyData = new byte[bytesToRead];
    Buffer.BlockCopy(rawPublicKeyData, extraHeadersLen, publicKeyData, 0, bytesToRead);

    RSACryptoServiceProvider publicKey = new RSACryptoServiceProvider();
    publicKey.ImportCspBlob(publicKeyData);

    return publicKey;
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-11T13:36:28.010

为什么需要加密它？如果您害怕它被篡改（例如有人增加了用户数量），您是否可以只使用例如您组织的数字证书对其进行签名？

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-11T13:53:20.490

为许可提供某种安全性的唯一方法是针对您自己持有的凭据强制在线登录（实际上是抽象的口语）。

所有其他方法都需要更多的时间，因此需要更多的钱来实施，以破解和滥用您的软件，而不是购买许可证。

.NET 有一些很好的加密类，但正如您所提到的，如果您正在编写许可证的编码/解密，每个人都可以轻松地对其进行反编译。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-08-22T20:02:32.080

似乎 MSDN 示例使用默认参数，这会导致特定于机器的签名，因此您无法在一台机器上签名并在任意其他机器上进行验证。我修改了这些示例中的逻辑，以使用签名机上我的 snk 中的密钥和验证机中我的程序集中的密钥。这是使用 MSDN 示例中的逻辑和上面链接的（非常出色的）ExcryptionUtils.cs 示例中的例程完成的。

为了签署文件，我使用了这个：

```
RSACryptoServiceProvider rsaKey = EncryptionUtils.GetRSAFromSnkFile(keyFilePath); 
```

为了验证文件，我使用了这个：

```
RSACryptoServiceProvider rsaKey = EncryptionUtils.GetPublicKeyFromAssembly
   (System.Reflection.Assembly.GetExecutingAssembly()); 
```

顺便说一句：我观察到 XML 签名验证会忽略 XML 注释。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-11T13:41:20.810

或者您可能希望将许可证绑定到特定机器，例如通过根据 PC 的 c 驱动器的 md5 值生成许可证密钥。那么您的许可证将是特定于机器的。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-11-07T06:43:31.957

当你实现你的签名/验证码时，注意不要把它放在一个单独的程序集中。代码访问安全防篡改现在很容易绕过，正如文章[CAS 防篡改被破坏：软件许可的后果 中](http://www.offbyzero.com/resources/cas_broken)所解释的那样。

强制性免责声明和插件：我共同创立的公司生产[OffByZero Cobalt 许可解决方案](https://cobalt.offbyzero.com/)。

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2009-08-21T19:50:25.497

RE：不要在代码中包含整个密钥。使用 sn -p 将公共部分提取到文件中。在您分发的代码中使用它来验证许可证。

使用 MSDN 文章中的代码，我创建了一个小应用程序 (LicMaker) 来实现这一点。该应用程序使用完整的密钥对进行签名。输入是一个未签名的 .XML 许可证文件。输出是签名的 .LIC 文件中的原始 XML + 签名。我的产品也由相同的完整密钥对文件签名。产品验证 .LIC 文件未被篡改。效果很好。我没有使用 sn -p 这个解决方案。

# svn - 如何设置非本地 svn-server？

> ID：359343
> 
> 赞同：3
> 
> 时间：2008-12-11T13:29:16.653
> 
> 标签：svn, visualsvn

嗨，我想知道如何设置 svn 服务器？现在，我使用 VisualSVN 和 TortoiseSVN，但我不知道目录“分支”“主干”“标签”是什么。谁能解释一下它是如何工作的？我阅读了 svn 书和许多关于它的网站文章，但我不明白。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-11T13:41:38.733

如何设置 SVN 服务器与使用“分支”、“主干”和“标签”是一个非常不同的问题。

可以使用许多不同的方法设置 SVN 服务器：Apache（使用 dav_svn）、通过 SSH 的 svnserve 或无数其他方法。

查看[svn-book 关于服务器设置的章节以](http://svnbook.red-bean.com/en/1.5/svn.serverconfig.html)获取更多信息。

如果您需要有关 SVN 的更多信息，[整本书](http://svnbook.red-bean.com/en/1.5/index.html)可能对您有用。

要快速了解 SVN、分支和标记，请查看以下 Wikipedia 文章：

*   [Subversion](http://en.wikipedia.org/wiki/Subversion_(software))，带有关于[分支和标记](http://en.wikipedia.org/wiki/Subversion_(software)#Branching_and_tagging)的部分。
*   [分枝](http://en.wikipedia.org/wiki/Branching_(software))
*   [标记](http://en.wikipedia.org/wiki/Revision_tag)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-11T13:44:11.770

这些是设置存储库时可选用 VisualSVN 创建的默认目录，这是存储库结构的长期约定：

*（免责声明：我不是 svn 律师）*

**trunk**：将包含您的开发主线，您在这里开发新功能

**分支**：是你开发的副业，分支通常是从主干或另一个父分支创建的。您通常使用分支来开发新功能，然后再将它们合并到主干中，或者执行维护任务

**tags** : 只是一个放置你的发布版本以供参考的地方，你不能（默认情况下）覆盖创建到标签中的分支

主要内容：在 svn 中，所有这些都是目录，您可以将任何现有分支分支到任何其他位置（标签受限制），您可以稍后将它们（或多或少痛苦）合并到另一个分支

这些都是笼统的描述，分支的使用模式多种多样，如果您需要更多信息，谢谢您更准确。

编辑：我也建议花时间阅读[第 4 章分支和合并](http://svnbook.red-bean.com/en/1.1/ch04.html)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-11T14:02:15.870

我有点不确定您的问题是关于设置 SVN 服务器，还是您更关心项目演变的结构（设置主干和各种分支）。

但是，请考虑您可能*不想*花费时间和精力来掌握 SVN 服务器管理 - 特别是如果您在阅读文档后仍然有这么多问题。在考虑了我们的源代码控制管理策略的各种选项后，我们决定使用第三方 SVN 托管服务。我们最终使用了 BeanStalk ( [http://www.beanstalkapp.com](http://www.beanstalkapp.com) ) 以及 Tortoise SVN 和 Visual SVN。我与 BeanStalk 无关，但我可以告诉你，每月 15 美元，我们对结果非常满意。请注意，我们管理一个网络服务器场，因此服务器可用性根本不是问题——只有时间和专业知识——我们仍然决定去找外部供应商。

# python - 在 Python 中按顺序执行命令？

> ID：359347
> 
> 赞同：24
> 
> 时间：2008-12-11T13:30:23.797
> 
> 标签：python, windows, subprocess

我想连续执行多个命令：

即（只是为了说明我的需要）：

`cmd`（贝壳）

然后

`cd dir`

和

`ls`

并读取`ls`.

`subprocess`对模块有任何想法吗？

**更新：**

`cd dir`并且`ls`只是一个例子。我需要运行复杂的命令（按照特定的顺序，没有任何流水线）。事实上，我想要一个子进程 shell 并能够在其上启动许多命令。

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2008-12-11T15:35:32.687

为此，您必须：

*   在调用中提供`shell=True`参数`subprocess.Popen`，并且
*   将命令分开：
    *   `;`如果在 *nix shell（bash、ash、sh、ksh、csh、tcsh、zsh 等）下运行
    *   `&`如果在`cmd.exe`Windows下运行

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2008-12-11T14:23:17.213

有一种简单的方法可以执行一系列命令。

使用以下内容`subprocess.Popen`

```
"command1; command2; command3" 
```

或者，如果您被 Windows 困住，您有多种选择。

*   创建一个临时的“.BAT”文件，并将其提供给`subprocess.Popen`

*   在单个长字符串中创建带有“\n”分隔符的命令序列。

像这样使用“””。

```
"""
command1
command2
command3
""" 
```

或者，如果你必须做一些零碎的事情，你必须做这样的事情。

```
class Command( object ):
    def __init__( self, text ):
        self.text = text
    def execute( self ):
        self.proc= subprocess.Popen( ... self.text ... )
        self.proc.wait()

class CommandSequence( Command ):
    def __init__( self, *steps ):
        self.steps = steps
    def execute( self ):
        for s in self.steps:
            s.execute() 
```

这将允许您构建一系列命令。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-12-11T13:59:46.997

在名称包含“foo”的每个文件中查找“bar”：

```
from subprocess import Popen, PIPE
find_process = Popen(['find', '-iname', '*foo*'], stdout=PIPE)
grep_process = Popen(['xargs', 'grep', 'bar'], stdin=find_process.stdout, stdout=PIPE)
out, err = grep_process.communicate() 
```

'out' 和 'err' 是包含标准输出和最终错误输出的字符串对象。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-11T13:35:39.243

是的，该`[subprocess.Popen](http://docs.python.org/library/subprocess.html)()`函数支持`cwd`关键字参数，您可以使用它设置运行进程的目录。

我想第一步，shell，是不需要的，如果你只想运行`ls`，就不需要通过 shell 运行它。

当然，您也可以将所需目录作为参数传递给`ls`.

更新：可能值得注意的是，对于典型`cd`的 shell，它是在 shell 本身中实现的，它不是磁盘上的外部命令。这是因为它需要更改进程的当前目录，这必须在进程内完成。由于命令作为由 shell 生成的子进程运行，因此它们无法执行此操作。

* * *

## 回答 #5

> 赞同：-3
> 
> 时间：2015-10-03T14:18:30.167

下面的python脚本有3个你刚刚执行的函数：

```
import sys
import subprocess

def cd(self,line):
    proc1 = subprocess.Popen(['cd'],stdin=subprocess.PIPE)
    proc1.communicate()

def ls(self,line):
    proc2 = subprocess.Popen(['ls','-l'],stdin=subprocess.PIPE)
    proc2.communicate()

def dir(silf,line):
    proc3 = subprocess.Popen(['cd',args],stdin=subprocess.PIPE)
    proc3.communicate(sys.argv[1]) 
```

# eclipse - eclipse：覆盖 config.ini 中的 user.name

> ID：359351
> 
> 赞同：4
> 
> 时间：2008-12-11T13:33:14.600
> 
> 标签：eclipse, configuration

我有一个带有共享主配置区域的多用户 Eclipse (3.4) 安装。用户需要`user.name`用他们的全名覆盖，而通常的方法（将 -Duser.name=... 添加到 eclipse.ini）不合适，因为覆盖必须是每个用户的。我尝试在 config.ini 中设置 user.name （在每个用户的`configuration`目录中）：

```
user.name=Luca Tettamanti 
```

但它确实有效，eclipse 仍然保留登录名。奇怪的是：

```
user.foobar=Luca Tettamanti 
```

被正确拾取。是否可以在此配置中以某种方式覆盖 user.name ？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-11T13:54:14.013

这确实是[以前报道过的。](http://www.eclipsezone.com/eclipse/forums/t111686.html)

为什么不使用自定义 eclipse 启动器（脚本`.cmd`），它会修改 eclipse.ini，然后调用 eclipse.exe？

该脚本可以使用以下命令检索全名：

```
net user %username% /domain | find /i "full" 
```

* * *

这样，在 Windows 中，您的自定义启动器将运行 eclipse：

```
eclipse.exe -clean --launcher.ini shared\eclipse.ini -vmargs -Duser.name=%FULL_NAME% 
```

使用共享的 eclipse.ini，但指定`user.name`值。

* * *

在 Linux 中，要将 shell 变量的内容传递`USER`给 Eclipse，您需要执行以下操作：

```
exec eclipse -clean --launcher.ini shared/eclipse.ini -vmargs -Duser.name=`eval "echo $USER"` 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-11T14:02:34.090

我有点不清楚你的意图。

System 属性`user.name`很重要，因为它应该反映曾经调用 JVM 的用户名。

如果您这样做是出于显示目的，并且您可以控制使用它的插件，那么您可能应该使用自己的方法来发现显示名称。

@VonC 描述的自定义 config.ini 或快捷方式将适用于此。

# .net - Entlib 和互操作：它有效吗，配置文件在哪里？

> ID：359354
> 
> 赞同：1
> 
> 时间：2008-12-11T13:34:10.310
> 
> 标签：.net, interop, enterprise-library, com-interop

我正在尝试将.net 代码中的 EntLib 3.1 用于为 COM 互操作注册的 dll。我在哪里放置配置文件？

或者，有没有办法在 dll 代码中指定它应该从哪里获取 entlib 配置？由于我的 dll 将从 COM 调用，所以我并不总是知道什么 exe 会调用它。

我创建了一个使用 entlib Logging 的简单应用程序，它有两个类：“CallingApp”和“MyComThing”。当我从 CallingApp 调用 MyComThing 的方法时，它会使用 CallingApp 的配置文件中的配置进行记录。当我从 vbs 脚本（即通过 COM）调用 MyComThing 的方法时，出现错误“在配置源中找不到 Logging 的配置部分”。我的 COMThing.dll.config 文件与注册的 COMThing.dll 位于同一文件夹中，即 bin\debug\ 文件夹中。

谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-11T18:07:33.407

答案是企业库默认使用 exe 的配置文件。如果您正在生成一个 dll，包括 COM，那么出于充分的理由，您可能不想依赖调用可执行文件。对此的一种解决方案（可能还有其他解决方案）是自己创建企业库对象而不是使用默认对象，并告诉他们从哪里获取配置。这并不像看起来那么可怕，并且不需要重新编译 entlib 或类似的东西。

而不是简单地使用 Logger.Write() 我做了以下事情： a) 创建日志写入器，使用 dll 的配置文件：

```
 string dllConfigFilename = Assembly.GetExecutingAssembly().Location + ".config";
        FileConfigurationSource exceptionsSource = new FileConfigurationSource(dllConfigFilename);
        LogWriterFactory writerFactory = new LogWriterFactory(exceptionsSource);
        logWriter = writerFactory.Create(); 
```

b）然后在您的代码中使用此日志编写器：

```
 LogEntry log = new LogEntry();
        log.Message = message;
        log.Categories = new string[] { "General" };
        logWriter.Write(log); 
```

这是我创建的示例对象的完整代码。引用为 Microsoft.Practices.EnterpriseLibrary.Common、Microsoft.Practices.EnterpriseLibrary.Logging、Microsoft.Practices.ObjectBuilder、System、System.Data、System.Windows.Forms、System.Xml：

```
using System;
using System.Collections.Generic;
using System.Text;
using System.Runtime.InteropServices;
using System.Windows.Forms;
using System.Reflection;
using System.IO;
using Microsoft.Practices.EnterpriseLibrary.Logging;
using Microsoft.Practices.EnterpriseLibrary.Common.Configuration;

namespace COMThing
{
    [ComVisible(true)]
    public class MyComThing : MyComInterface
    {
        LogWriter logWriter; 

        public MyComThing()
        {
            string dllConfigFilename = Assembly.GetExecutingAssembly().Location + ".config";
            FileConfigurationSource exceptionsSource = new FileConfigurationSource(dllConfigFilename);
            LogWriterFactory writerFactory = new LogWriterFactory(exceptionsSource);
            logWriter = writerFactory.Create();
        }

        public bool ProcessMessage(string message)
        {
            LogEntry log = new LogEntry();
            log.Message = message;
            log.Categories = new string[] { "General" };
            logWriter.Write(log);
            MessageBox.Show(message);
            return true;
        }
    }

} 
```

该项目包括一个 COMThing.dll.config 文件，我将“复制到输出目录”设置为“始终复制”。这是一个将日志信息写入应用程序事件日志的简单配置。配置文件的内容是：

```
<?xml version="1.0" encoding="utf-8"?>
<configuration>
  <configSections>
    <section name="loggingConfiguration" type="Microsoft.Practices.EnterpriseLibrary.Logging.Configuration.LoggingSettings, Microsoft.Practices.EnterpriseLibrary.Logging, Version=3.1.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a" />
    <section name="dataConfiguration" type="Microsoft.Practices.EnterpriseLibrary.Data.Configuration.DatabaseSettings, Microsoft.Practices.EnterpriseLibrary.Data, Version=3.1.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a" />
  </configSections>
  <loggingConfiguration name="Logging Application Block" tracingEnabled="true"
    defaultCategory="General" logWarningsWhenNoCategoriesMatch="true">
    <listeners>
      <add source="COMThing Logger" formatter="Text Formatter" log="Application"
        machineName="" listenerDataType="Microsoft.Practices.EnterpriseLibrary.Logging.Configuration.FormattedEventLogTraceListenerData, Microsoft.Practices.EnterpriseLibrary.Logging, Version=3.1.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a"
        traceOutputOptions="None" type="Microsoft.Practices.EnterpriseLibrary.Logging.TraceListeners.FormattedEventLogTraceListener, Microsoft.Practices.EnterpriseLibrary.Logging, Version=3.1.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a"
        name="Formatted EventLog TraceListener" />
    </listeners>
    <formatters>
      <add template="Timestamp: {timestamp}&#xD;&#xA;Message: {message}&#xD;&#xA;Category: {category}&#xD;&#xA;Priority: {priority}&#xD;&#xA;EventId: {eventid}&#xD;&#xA;Severity: {severity}&#xD;&#xA;Title:{title}&#xD;&#xA;Machine: {machine}&#xD;&#xA;Application Domain: {appDomain}&#xD;&#xA;Process Id: {processId}&#xD;&#xA;Process Name: {processName}&#xD;&#xA;Win32 Thread Id: {win32ThreadId}&#xD;&#xA;Thread Name: {threadName}&#xD;&#xA;Extended Properties: {dictionary({key} - {value}&#xD;&#xA;)}"
        type="Microsoft.Practices.EnterpriseLibrary.Logging.Formatters.TextFormatter, Microsoft.Practices.EnterpriseLibrary.Logging, Version=3.1.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a"
        name="Text Formatter" />
    </formatters>
    <categorySources>
      <add switchValue="All" name="General">
        <listeners>
          <add name="Formatted EventLog TraceListener" />
        </listeners>
      </add>
    </categorySources>
    <specialSources>
      <allEvents switchValue="All" name="All Events">
        <listeners>
          <add name="Formatted EventLog TraceListener" />
        </listeners>
      </allEvents>
      <notProcessed switchValue="All" name="Unprocessed Category" />
      <errors switchValue="All" name="Logging Errors &amp; Warnings">
        <listeners>
          <add name="Formatted EventLog TraceListener" />
        </listeners>
      </errors>
    </specialSources>
  </loggingConfiguration>
</configuration> 
```

在 Build 下的项目属性中，检查“Register for COM interop”。构建项目，然后创建以下 .vbs 文件：

```
Set obj = CreateObject("COMThing.MyComThing")
obj.ProcessMessage("called from com by vbs") 
```

如果你双击这个 vbs 文件，它应该会显示一个带有文本“由 vbs 从 com 调用”的消息框，并在应用程序事件日志中写入一个条目。这表明，虽然执行过程是 C:\WINDOWS\System32\WScript.exe（或类似的），但它正在从您的 dll 的配置文件中获取配置。

我基于“使用多个配置源”下[的信息。](http://blogs.msdn.com/tomholl/archive/2006/04/02/entlib2externalconfig.aspx)

请注意，Logger 类包含许多具有不同参数的好帮手方法。由于我们使用的是 LogWriter 类，因此我们无法获得这种魔力。就我个人而言，我将在我的库中创建另一个类来执行相同的工作，基于 Logger。

引用的文章显示了应用于数据库和异常应用程序块的相同原理。大概相同的模型可以应用于大多数/全部。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-11T13:47:19.643

检查我遇到的相关问题。也许它有一些帮助。

[如何在已发布的 .Net 站点上包含 COM 组件？](https://stackoverflow.com/questions/333595/how-to-include-com-components-on-a-published-net-site)

# xml - 简单类型字符串的 XML 模式不区分大小写枚举

> ID：359359
> 
> 赞同：16
> 
> 时间：2008-12-11T13:37:32.487
> 
> 标签：xml, schema, simpletype, case-sensitive

我的 XML 模式 (.xsd) 文件中需要不区分大小写的字符串枚举类型。通过执行以下操作，我可以不区分大小写。

```
<xs:simpleType name="setDigitalPointType">
    <xs:restriction base="xs:string">
        <xs:pattern value="[Oo][Nn]" />
        <xs:pattern value="[Oo][Ff][Ff]" />
    </xs:restriction>
</xs:simpleType> 
```

唯一的问题是我没有得到枚举值。使用 Visual Studio 编写我的 XML 时，我不会得到很好的智能感知。以下将给我枚举，但它区分大小写。

```
<xs:simpleType name="setDigitalPointType">
    <xs:restriction base="xs:string">
        <xs:enumeration value="on" />
        <xs:enumeration value="off" />
    </xs:restriction>
</xs:simpleType> 
```

这会给我我的枚举，但如果我收到“开”、“开”或“开”的值，验证将失败。

我想要枚举“on”、“off”并允许输入不区分大小写的版本。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2013-03-16T03:51:04.750

如果您既想保持不区分大小写的验证，又想在 Visual Studio 2010 中获得 Intellisense，则可以使用联合：

```
<xs:simpleType name="setDigitalPointType">
    <xs:union>
        <xs:simpleType>
            <xs:restriction base="xs:string">
                <xs:enumeration value="on" />
                <xs:enumeration value="off" />
            </xs:restriction>
        </xs:simpleType>
        <xs:simpleType>
            <xs:restriction base="xs:string">
                <xs:pattern value="[Oo][Nn]" />
                <xs:pattern value="[Oo][Ff][Ff]" />
            </xs:restriction>
        </xs:simpleType>
    </xs:union>
</xs:simpleType> 
```

这是因为它利用了 Visual Studio 2010 在构建它的 Intellisense 数据时只处理联合中的第一个简单类型这一事实。但是，当它验证一个文档时，它会同时处理这两个，这意味着“打开”仍然被确定为有效，即使它不在枚举值列表中。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-12-11T19:29:07.957

IBM developerWorks 有[一篇](https://web.archive.org/web/20091206195708/http://www.ibm.com/developerworks/xml/library/x-case/)关于如何使用 XSLT 以自动化方式构建完整的枚举替代方案的文章。它是作为缺少不区分大小写的枚举的一种解决方法。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-11T13:40:07.473

好吧，您可以将所有排列列为模式:)

# sql-server - 如何评估 MDX 在 OLAP 处理中的性能

> ID：359374
> 
> 赞同：2
> 
> 时间：2008-12-11T13:41:58.703
> 
> 标签：sql-server, performance, olap, mdx

我熟悉使用 SQL Server 2000/2005/2008 评估性能查询或存储过程的标准做法。评估 MDX 性能的最佳方法是什么？我假设它可以像使用标准 T-SQL 一样轻松地编写结构正确但性能较差的 MDX 查询？有什么建议么？

仅供参考：我的任务可能是彻底检查使用 MS SQL 分析服务和 Proclarity 客户端的当前数据挖掘项目。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-11T15:17:11.317

有多种工具可帮助调整 Analysis Services（截至 2005 年）。

*   您可以获得 MDX 的查询计划，其方式与 SQL Server 支持它们的方式大致相同，尽管引擎中的实际原语具有一些不同的性质。

*   运行基于使用的聚合将获取在实践中实际查看的切片。

*   SSAS 还支持分析器，因此您可以获取跟踪文件以查看服务器实际在做什么。

*   BIDS 中的调试器允许您跟踪多维数据集脚本。

但是，与 SQL Server 相比，这些内容的文档记录要少得多，因此您可能需要让 MS 技术支持、第三方顾问或 Stackoverflow 参与进来；-}

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-13T10:18:29.290

尝试运行[MDX Studio](http://www.mosha.com/msolap/mdxstudio.htm)。它分析 MDX 查询并针对常见问题提供一般性能提示。

我发现它非常有用，通过遵循提示，我将某些查询的性能提高了 8 倍。

它也是免费的！

# html - 如何编码html邮件？

> ID：359381
> 
> 赞同：3
> 
> 时间：2008-12-11T13:44:07.433
> 
> 标签：html, css, mailing

我正准备向客户发送大量使用 html + 图像的电子邮件。什么是使它在最流行的邮件客户端中正确显示的一般规则？

编辑：

好吧，这是为我的客户准备的-大约有几个客户。

我的问题是 - 如何编码这封电子邮件，它将在客户邮件客户端（thunderbird、outlook、gmail）中正确显示。我可以使用哪些 CSS 标签？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-11T14:27:13.867

看看[email-standards.org](http://www.email-standards.org/)，他们有一个[ACID 测试](http://www.email-standards.org/acid-test/)，可以在[最流行的客户端](http://www.email-standards.org/clients/)上运行，你可以看到他们测试的不同 css 选择器和 html 标签的列表，以及实际[结果的](http://www.email-standards.org/clients/microsoft-outlook-2007/)[屏幕截图](http://www.email-standards.org/clients/microsoft-outlook-2007/screenshot/)，哪些是有效的什么没有。

希望这可以帮助！

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-11T13:50:03.130

HTML 电子邮件的一般规则：

*   没有Javascript...永远！
*   使用基于表格的布局（无浮动）
*   否`<style>`或`<link>`用于 CSS -`style=""`仅使用属性

这应该让您的电子邮件在大多数邮件客户端中看起来都不错，包括基于 Web 的客户端（hotmail、yahoo、gmail）。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-11T13:53:16.667

这两个参考是很好的起点

*   [http://www.alistapart.com/articles/cssemail/](http://www.alistapart.com/articles/cssemail/)
*   [http://www.campaignmonitor.com/css/](http://www.campaignmonitor.com/css/)

显然，使用**HTML 3.0 兼容的标签和格式最**适合所有电子邮件阅读器和提供商。

我问了一个类似的问题[使用 System.Net.Mail 时格式化电子邮件的最佳方法是什么](https://stackoverflow.com/questions/340250/what-is-the-best-method-for-formatting-email-when-using-systemnetmail)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-11T13:47:55.070

如果您想在某处托管它们，您可以包含内联图像。

您的 html 中的 img src 是 cid:mime-part-name

并将图像附加为哑剧部分。

但除此之外，请确保您的 HTML 和 CSS 保持简单 - 电子邮件程序比浏览器更糟糕的渲染器 - 并在几个电子邮件程序以及 hotmail 和 gmail 上对其进行测试。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-11T13:49:09.217

您需要考虑一些电子邮件客户端不呈现 html 的事实。MIME 标准支持多部分电子邮件。您为消息的不同部分定义不同的边界。

[http://en.wikipedia.org/wiki/MIME](http://en.wikipedia.org/wiki/MIME)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-11T14:04:51.387

如果您必须使用图像，请保持它们非常小并保持一致。许多邮件客户端拒绝呈现指向外部图像的链接，因为垃圾邮件发送者使用它们来跟踪谁愚蠢到可以阅读他们的电子邮件。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-11T22:07:59.273

其中有几个非常好。我将总结并添加一些其他提示。

*   使用基于表格的布局
*   没有 javascript
*   最小的 CSS - 很多东西都行不通
*   任何 CSS 都应该是内联的
*   没有任何类型的背景图像，不会在 Outlook 2007 中呈现
*   链接到托管图像。内联图像可能会起作用，但如果您不小心，邮件服务器上的大小限制会退回它们。
*   确保在图像上使用 alt 标签，以便在邮件客户端阻止图像时显示某些内容
*   为阻止图像的客户提供文本版本的电子邮件
*   尽可能多地测试客户端。特别是 Outlook 2007 和 Gmail。Gmail 倾向于在文本对齐方面做一些奇怪的事情

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-11T13:44:59.180

HTML 电子邮件类型。您的图像需要托管在 Internet 上的某个位置，然后作为链接包含在 HTML 中。

您生成 HTML 代码，这就是消息正文。邮件信息的类型是 HTML！

每个人都这样做，那里有一百万个例子。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-12-11T13:49:02.073

我知道这不是你问的，但你试过[MailChimp](http://www.mailchimp.com)吗？他们有很棒的服务。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-12-11T13:50:25.907

我还推荐像 MailChimp 或 CampainMonitor 这样的第 3 方，他们处理很多额外的事情，比如管理订阅和检查弹跳，加上他们提供开放等统计信息。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-12-11T14:06:52.007

避免使用背景图像，因为 Outlook 2007 不会显示它们。（2007 版 Outlook 使用 Word 中的 HTML 呈现引擎...）

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-12-11T15:51:35.447

我倾向于使用表格布局，带有标签以允许以正确的面和颜色以及大致正确的大小呈现文本，然后使用 style="" 在支持 CSS 的电子邮件客户端中正确呈现它。

只是不要让你的 CSS 太复杂......

# mysql - 您如何确定服务器所需的硬件？

> ID：359384
> 
> 赞同：9
> 
> 时间：2008-12-11T13:44:33.703
> 
> 标签：mysql, server-hardware

我想知道您如何确定服务器所需的硬件？

我有一个运行 MySQL 的数据库服务器，现在我想购买一个服务器，但我不知道我需要什么硬件规格。这是用于托管网页的服务器。

**编辑：** 该软件只是 MySQL 服务器

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-12-11T13:53:43.110

这完全取决于应用程序的预期负载量。但至少，我会选择 2 个 cpu 或多核单 cpu，至少 4GB RAM 和一个不错的 RAID 控制器。根据您的性能和存储要求 - 我将从 RAID 1（镜像）开始，并将其扩展到 RAID 10（镜像条带）（SAME - Stripe and Mirror Everything）。

也获得一些不错的网络积分。

如果您需要扩展，那至少应该为您提供足够的空间。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-11T15:59:12.840

数据库的大小可能很难。CPU 速度通常不是关键，但如果是并行工作负载，则更多内核会更好。大量内存和快速磁盘通常是关键。现在在 MySQL 服务器中看到 16 或 32GB 的内存并不少见。当然，如果您的数据集只有 2 或 4GB，这没有多大意义。

如果你能负担得起足够的 RAM 来将整个数据集放入内存（不是 ram 磁盘，而是让数据库缓存它），那么就获得那么多 RAM。如果您期望您的数据大幅增长，这不一定是一个好的长期策略。

如果您的数据量大于您可以承受的 RAM 量，您可以尝试使用更快的磁盘和更小的磁盘（8 x 74GB 而不是 4x 136GB）来弥补。

您可以通过使用您现在拥有的硬件（假设您没有大型服务器运行）并使用一些示例数据运行按比例缩小的基准测试来获得一些关于性能的想法。这应该让您了解瓶颈在哪里以及您需要在哪里花费更多现金。

如果您与大型供应商（戴尔、惠普、Sun、IBM 等）合作，您可以询问他们是否会发送带有您考虑的规格的演示单元。这样，您就可以在购买设备之前运行基准测试。

最后，如果这是您的应用程序的第一个数据库服务器并且您不知道它是否会成功，请不要太担心。如果您从“低端”服务器开始并且您的应用程序成功，您可以轻松地叉车升级到强大的服务器。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-11T13:57:34.893

一种方法是为您的系统建模并模拟您的预期负载。有一些工具可以进行这种离散事件模拟：

*   [超形式](http://www.hyperformix.com/products/performance-optimizer)
*   [模拟](http://simpy.sourceforge.net/)
*   [维基百科的模拟工具列表](http://en.wikipedia.org/wiki/List_of_computer_simulation_software)

这东西不容易，商业工具会花你的钱。

您还可以尝试寻找与预期负载接近的基准，看看哪些系统可以为您提供所需的性能。[TPC 基准测试](http://www.tpc.org/)将是一个很好的起点。

祝你好运 ：）

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-11T13:56:32.977

为什么不在您当前的开发服务器上进行一些负载测试并以此为基础做出决定呢？您可能会发现您可以在您的第一台服务器上使用比预期更少的资源，然后在/当业务证明它合理时进行扩展。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-02T17:47:46.820

这取决于客户的看法和可用预算的重要性。

如果您的预算很少，我会添加更多内存，目前它非常便宜，特别是如果您使用 4GG 模块（8GB 模块的价格是我居住的 4GB 模块的两倍多）。

如果您还有更多，请考虑购买四核或双四核系统。

如果您还有更多的资源，请购买一个好的磁盘控制器，最好是带有硬件 RAID 的 SAS 控制器。

如果客户感知是最重要的，那么请使用具有冗余电源的 HP 或 IBM 以及以上所有设备，如果您可能会受到打扰，也请考虑将您的 NIC 中继。

祝你好运。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-11T13:50:41.790

这完全取决于它将托管的应用程序的性质，以及它将使服务器承受的负载（现在和将来）。

当我“指定”服务器时，我总是购买我能买得起的最好的规格。

我通常会购买相当标准的规格，但当我尝试获得我能负担得起的最快磁盘时，我会购买数据库服务器。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-11T14:00:00.913

另一种选择不是为数据库获取单独的服务器，而是在现有服务器上托管数据库。虚拟化（vmware，xen）或将单个服务器专用为“后端数据库服务器”有许多不同的选项

现代硬件不太可能在专用服务器上看到显着的 CPU 使用率。

从长远来看，服务器蔓延是昂贵的。最终，该服务器将需要升级和更换。如果您必须更换几十个（或几百个），那可能是一场噩梦。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-12-11T14:01:26.010

这取决于您需要它提供多少次点击。如果可以的话，在旧的标准 PC 上运行程序，运行分析器并查看系统的税费。MySQL Gui 工具有一个健康监视器，它会告诉你系统正在使用的百分比。很有可能，您可以使用任何旧 PC。除非您服务很多或像这样的公共网站（这算作服务很多）

# jquery - 被点击元素的 jQuery 子元素

> ID：359393
> 
> 赞同：20
> 
> 时间：2008-12-11T13:48:43.790
> 
> 标签：jquery, jquery-selectors

我有一个链接列表，其中附加了一个点击事件，我需要从子 A 链接获取 ID。因此，在下面的示例中，如果我单击第一个列表元素，我需要重新调整谷歌。

我已经尝试过`'$this a'`，但无法完全确定语法。

```
$("ul li").click(function(event){
  $("input").val($(this).html());             
}); 
```

```
<ul>
    <li><a href="http://www.google.com" id="google">Google</a>
</ul> 
```

* * *

## 回答 #1

> 赞同：56
> 
> 时间：2008-12-11T13:52:12.830

我没有看到示例 HTML，但是

```
$(this).find('a:first').attr('id') 
```

会这样做（如果不是您的意思，请修复*a:first选择器）*

**这**指的是触发您的事件的元素

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-11T14:22:18.573

为了使您的代码更整洁，让我们使用如下函数绑定触发器：（我建议您给您的 UL 一个 ID，以便它仅特定于该 UL 中的元素）

```
$('ul li').bind('click', getAnchorId); 
```

被调用的函数 (getAnchorId) 获取被点击元素 (ul li) 的子元素 (a) 的 ID 属性并将其应用于变量 (anchorId)，并显示其获取正确的信息，我将结果放入一个警报。

```
function getAnchorId() {
    var anchorId = $(this).children('a').attr('id');
    alert(anchorId);
} 
```

现在你可以用这个变量做任何你想做的事情:)

希望这可以帮助 ：）

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-11T14:21:46.437

您可以使用以下[`children`](http://docs.jquery.com/Traversing/children)方法：

```
$(this).children('a').eq(0).attr('id'); 
```

我不确定语法，但是这样的东西应该可以。

# java - 使用 java 代码运行进程的路径名和参数

> ID：359400
> 
> 赞同：4
> 
> 时间：2008-12-11T13:50:16.407
> 
> 标签：java, process

我想使用 java 代码获取正在运行的进程的路径名和参数。有什么解决办法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-11T14:02:01.173

例如，在 Windows 上，一种可能性是将[系统调用封装到`TASKLIST.EXE`](http://www.rgagnon.com/javadetails/java-0593.html)

从代码中提取：

```
Process p = Runtime.getRuntime().exec("tasklist.exe /fo csv /nh");
      BufferedReader input = new BufferedReader
          (new InputStreamReader(p.getInputStream()));
      while ((line = input.readLine()) != null) {
          if (!line.trim().equals("")) {
              // keep only the process name
              line = line.substring(1);
              processes.add(line.substring(0, line.indexOf(""")));
          }

      } 
```

不过，您应该使用`tasklist /V`它，因为它带有流程的参数。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-11T16:59:59.707

您可以使用[SIGAR](http://support.hyperic.com/display/SIGAR/Home)框架，它为您提供对 Linux、FreeBSD、Windows、Solaris、AIX、HP-UX 和 Mac OSX 的原生支持

# python - Postgres中'money'和'OID'的sqlalchemy等效列类型是什么？

> ID：359409
> 
> 赞同：7
> 
> 时间：2008-12-11T13:52:21.147
> 
> 标签：python, postgresql, sqlalchemy

Postgres 中“money”和“OID”列类型的 sqlalchemy 等效列类型是什么？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2016-06-02T00:37:12.373

从这个[链接](https://groups.google.com/forum/#!topic/sqlalchemy/USD3cdng9-s)上的论点 最后得出的结论是：

由于存储和算术的不精确性，将 FLOAT 用于货币金额是一个非常糟糕的主意。不鼓励使用 MONEY，因为它对语言环境过于敏感，应该改用 NUMERIC

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-02T02:49:08.410

我们从来没有专门的“OID”类型，尽管我们在 0.4 系列中支持每个表上的隐式“OID”列的概念，主要是为了 postgres 的利益。然而，由于用户表定义的 OID 列在 Postgres 中已被弃用，而且我们实际上从未真正使用过存在的 OID 功能，因此我们已从库中删除了此功能。

如果 SQLA 中没有提供特定类型，作为指定自定义类型的替代方法，您始终可以使用 NullType，这意味着 SQLA 不知道任何关于该类型的具体信息。如果 psycopg2 已经为该列发送/接收有用的 Python 类型，则实际上不需要 SQLA 类型对象，除了发出 CREATE TABLE 语句。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-16T22:51:45.643

这就是我能找到的所有内容：http: [//docs.sqlalchemy.org/en/rel_0_9/core/types.html](http://docs.sqlalchemy.org/en/rel_0_9/core/types.html)

如果您愿意，您也可以制作自己的类型。

# asp.net - Web 用户控制和验证

> ID：359422
> 
> 赞同：12
> 
> 时间：2008-12-11T13:55:27.130
> 
> 标签：asp.net, validation, user-controls

我有一个 ASP.Net Web 用户控件，其中包含来自 Ajax 控件工具包的文本框和日历。

当我在我的页面上包含这个用户控件时，我希望它参与输入验证（在 UC 内的 TextBox 上设置了一个必需的归档验证器），即。当页面被验证时，UC 的内容也应该被验证。所以我让我的 UC 实现了 IValidator 接口，它运行良好，只是我无法在用户控件上设置验证组。显然我应该从 BaseValidator 继承来做到这一点，但我不能，因为我已经继承了 UserControl。

必须有一种方法来处理这种常见情况。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2011-06-28T10:11:19.800

您可以通过用美元符号分隔两者来引用用户控件中的控件：

```
<asp:RequiredFieldValidator ControlToValidate="MyUserControl$ControlId" runat="server" /> 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-12-11T14:06:30.993

在新用户控件上创建一个属性，该属性在包含的验证器上设置验证组。然后从您的标记中，您只需在控件上设置 ValidationGroup 属性，这将滚动到用户控件中包含的验证器。您可能不需要接口或从 BaseValidator 继承，除非您创建的只是一个验证用户控件。

```
public string ValidationGroup
{
   get
   {
      return MyRequiredFieldValidator.ValidationGroup;
   }
   set
   {
      MyRequiredFieldValidator.ValidationGroup = value;
   }
} 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-11T14:07:52.613

尝试添加`[ValidationProperty("NameOfPropertyToBeValidated")`您的用户控件类。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-11T17:47:43.697

[如果您计划在未来添加大量验证，那么查看 Peter Blum 的DES](http://www.peterblum.com/Home.aspx) （数据输入套件）可能会有所回报- 它具有许多增强的数据输入和验证控件，包括条件验证场景和您所描述的场景。与自己开发所需的时间相比，许可非常合理。

# git - 分离（移动）子目录到单独的 Git 存储库

> ID：359424
> 
> 赞同：1889
> 
> 时间：2008-12-11T13:57:03.617
> 
> 标签：git, git-subtree, git-filter-branch

我有一个[Git](http://en.wikipedia.org/wiki/Git_%28software%29)存储库，其中包含许多子目录。现在我发现其中一个子目录与另一个无关，应该分离到一个单独的存储库。

如何在将文件历史记录保留在子目录中的同时做到这一点？

我想我可以制作一个克隆并删除每个克隆的不需要的部分，但我想这会在检查旧版本等时给我完整的树。这可能是可以接受的，但我更愿意假装两个存储库没有共享历史记录。

为了清楚起见，我有以下结构：

```
XYZ/
    .git/
    XY1/
    ABC/
    XY2/ 
```

但我想要这个：

```
XYZ/
    .git/
    XY1/
    XY2/
ABC/
    .git/
    ABC/ 
```

* * *

## 回答 #1

> 赞同：1503
> 
> 时间：2013-07-25T17:10:06.293

# The Easy Way™</h1>

事实证明，这是一种常见且有用的做法，Git 的霸主们让它变得非常容易，但你必须拥有更新版本的 Git (>= 1.7.11 May 2012)。有关如何安装最新 Git 的信息，请参阅**附录。**此外，下面的**演练中有一个****真实的示例**。

 **0.  准备旧仓库

    ```
     cd <big-repo>
     git subtree split -P <name-of-folder> -b <name-of-new-branch> 
    ```

**注意：** `<name-of-folder>`不得包含前导或尾随字符。例如，名为`subproject`MUST 的文件夹必须传递为`subproject`，而不是`./subproject/`

**Windows 用户注意事项：**当您的文件夹深度大于 1 时，`<name-of-folder>`必须使用 *nix 样式的文件夹分隔符 (/)。例如，名为的文件夹`path1\path2\subproject`必须作为`path1/path2/subproject`

1.  创建新的仓库

    ```
     mkdir ~/<new-repo> && cd ~/<new-repo>
     git init
     git pull </path/to/big-repo> <name-of-new-branch> 
    ```

2.  将新的 repo 链接到 GitHub 或任何地方

    ```
     git remote add origin <git@github.com:user/new-repo.git>
     git push -u origin master 
    ```

3.  *如果需要*`<big-repo>`，清理内部

     *```
     git rm -rf <name-of-folder> 
    ```* 

 ***注意**：这会在存储库中留下所有历史参考。如果您确实担心已提交密码或需要减小文件夹的文件大小，请参阅下面的**附录**`.git`。

* * *

# 演练

这些**步骤与上面相同**，但遵循我的存储库的确切步骤，而不是使用`<meta-named-things>`.

这是我在节点中实现 JavaScript 浏览器模块的项目：

```
tree ~/node-browser-compat

node-browser-compat
├── ArrayBuffer
├── Audio
├── Blob
├── FormData
├── atob
├── btoa
├── location
└── navigator 
```

我想将单个文件夹 ,`btoa`拆分为单独的 Git 存储库

```
cd ~/node-browser-compat/
git subtree split -P btoa -b btoa-only 
```

我现在有一个新的分支，`btoa-only`只有提交`btoa`，我想创建一个新的存储库。

```
mkdir ~/btoa/ && cd ~/btoa/
git init
git pull ~/node-browser-compat btoa-only 
```

接下来，我在 GitHub 或 Bitbucket 或其他任何地方创建一个新的存储库并将其添加为`origin`

```
git remote add origin git@github.com:node-browser-compat/btoa.git
git push -u origin master 
```

愉快的一天！

**注意：**如果您创建了一个带有`README.md`,`.gitignore`和的仓库`LICENSE`，您需要先拉取：

```
git pull origin master
git push origin master 
```

最后，我想从更大的仓库中删除该文件夹

```
git rm -rf btoa 
```

* * *

# 附录

## macOS 上的最新 Git

[使用Homebrew](https://brew.sh/)获取最新版本的 Git ：

```
brew install git 
```

## Ubuntu 上的最新 Git

```
sudo apt-get update
sudo apt-get install git
git --version 
```

如果这不起作用（您的 Ubuntu 版本非常旧），请尝试

```
sudo add-apt-repository ppa:git-core/ppa
sudo apt-get update
sudo apt-get install git 
```

如果这仍然不起作用，请尝试

```
sudo chmod +x /usr/share/doc/git/contrib/subtree/git-subtree.sh
sudo ln -s \
/usr/share/doc/git/contrib/subtree/git-subtree.sh \
/usr/lib/git-core/git-subtree 
```

感谢评论中的[rui.araujo](https://stackoverflow.com/users/854896/rui-araujo)。

## 清除您的历史记录

默认情况下，从 Git 中删除文件实际上并没有删除它们，它只是提交它们不再存在。如果您想实际删除历史引用（即您提交了密码），您需要这样做：

```
git filter-branch --prune-empty --tree-filter 'rm -rf <name-of-folder>' HEAD 
```

之后，您可以检查您的文件或文件夹是否不再显示在 Git 历史记录中

```
git log -- <name-of-folder> # should show nothing 
```

但是，您**不能将删除“推送”到 GitHub**等。如果你尝试，你会得到一个错误，你必须`git pull`在你能做到之前`git push`- 然后你又回到你的历史中。

因此，如果您想从“来源”中删除历史记录（即从 GitHub、Bitbucket 等中删除），您需要删除存储库并重新推送经过修剪的存储库副本。但是等等 -**还有更多**！- 如果您真的担心删除密码或类似的东西，您需要修剪备份（见下文）。

## 变`.git`小

前面提到的删除历史命令仍然会留下一堆备份文件——因为 Git 非常好心地帮助您避免意外破坏您的存储库。它最终会在几天和几个月内删除孤立的文件，但它会将它们保留一段时间，以防您意识到您不小心删除了您不想删除的内容。

因此，如果您真的想立即*清空垃圾箱*以**减少 repo 的克隆大小**，您必须执行所有这些非常奇怪的事情：

```
rm -rf .git/refs/original/ && \
git reflog expire --all && \
git gc --aggressive --prune=now

git reflog expire --all --expire-unreachable=0
git repack -A -d
git prune 
```

也就是说，除非你知道你需要这样做，否则我建议不要执行这些步骤——以防万一你修剪了错误的子目录，你知道吗？推送存储库时不应克隆备份文件，它们只会在您的本地副本中。

# 信用

*   [http://psionides.eu/2010/02/04/sharing-code-between-projects-with-git-subtree/](http://psionides.eu/2010/02/04/sharing-code-between-projects-with-git-subtree/)
*   [从 git 中永久删除目录](https://stackoverflow.com/questions/1216733/remove-a-directory-permanently-from-git)
*   [http://blogs.atlassian.com/2013/05/alternatives-to-git-submodule-git-subtree/](http://blogs.atlassian.com/2013/05/alternatives-to-git-submodule-git-subtree/)
*   [如何从我的 git repo 中删除未引用的 blob](https://stackoverflow.com/questions/1904860/how-to-remove-unreferenced-blobs-from-my-git-repo)

* * *

## 回答 #2

> 赞同：1264
> 
> 时间：2008-12-11T15:40:54.280

**更新**：这个过程非常普遍，以至于 git 团队使用新工具使其变得更加简单，`git subtree`. 请参阅此处：[将子目录分离（移动）到单独的 Git 存储库中](https://stackoverflow.com/questions/359424/detach-subdirectory-into-separate-git-repository/17864475#17864475)

* * *

您想要克隆您的存储库，然后使用`git filter-branch`标记除您希望在新存储库中被垃圾收集的子目录之外的所有内容。

1.  要克隆本地存储库：

    ```
    git clone /XYZ /ABC 
    ```

    （注意：存储库将使用硬链接克隆，但这不是问题，因为硬链接文件本身不会被修改 - 将创建新文件。）

2.  现在，让我们保留我们想要重写的有趣分支，然后删除源以避免推送到那里，并确保源不会引用旧提交：

    ```
    cd /ABC
    for i in branch1 br2 br3; do git branch -t $i origin/$i; done
    git remote rm origin 
    ```

    或所有远程分支：

    ```
    cd /ABC
    for i in $(git branch -r | sed "s/.*origin\///"); do git branch -t $i origin/$i; done
    git remote rm origin 
    ```

3.  现在您可能还想删除与子项目无关的标签；你也可以稍后再做，但你可能需要再次修剪你的回购。我没有这样做并且得到了`WARNING: Ref 'refs/tags/v0.1' is unchanged`所有标签（因为它们都与子项目无关）；此外，删除此类标签后，将回收更多空间。显然`git filter-branch`应该能够重写其他标签，但我无法验证这一点。如果要删除所有标签，请使用`git tag -l | xargs git tag -d`.

4.  然后使用 filter-branch 和 reset 排除其他文件，以便修剪它们。让我们还添加`--tag-name-filter cat --prune-empty`以删除空提交并重写标签（请注意，这将不得不剥离它们的签名）：

    ```
    git filter-branch --tag-name-filter cat --prune-empty --subdirectory-filter ABC -- --all 
    ```

    或者，仅重写 HEAD 分支并忽略标签和其他分支：

    ```
    git filter-branch --tag-name-filter cat --prune-empty --subdirectory-filter ABC HEAD 
    ```

5.  然后删除备份的 reflogs 以便真正回收空间（尽管现在该操作是破坏性的）

    ```
    git reset --hard
    git for-each-ref --format="%(refname)" refs/original/ | xargs -n 1 git update-ref -d
    git reflog expire --expire=now --all
    git gc --aggressive --prune=now 
    ```

    现在你有一个 ABC 子目录的本地 git 存储库，它的所有历史都保留了。

注意：对于大多数用途，`git filter-branch`确实应该有添加的参数`-- --all`。是的，确实如此`-``-``space``-``-` `all`。这需要是命令的最后一个参数。正如 Matli 发现的那样，这会使项目分支和标签包含在新的 repo 中。

编辑：合并了来自以下评论的各种建议，以确保例如存储库实际上已缩小（以前并非总是如此）。

* * *

## 回答 #3

> 赞同：139
> 
> 时间：2009-06-05T13:15:20.737

[Paul 的回答](https://stackoverflow.com/a/359759/42473)创建了一个包含 /ABC 的新存储库，但没有从 /XYZ 中删除 /ABC。以下命令将从 /XYZ 中删除 /ABC：

```
git filter-branch --tree-filter "rm -rf ABC" --prune-empty HEAD 
```

当然，首先在 'clone --no-hardlinks' 存储库中对其进行测试，然后使用 Paul 列出的 reset、gc 和 prune 命令进行跟踪。

* * *

## 回答 #4

> 赞同：98
> 
> 时间：2009-10-19T21:10:21.860

我发现为了从新存储库中正确删除旧历史记录，您必须在该`filter-branch`步骤之后做更多的工作。

1.  进行克隆和过滤：

    ```
    git clone --no-hardlinks foo bar; cd bar
    git filter-branch --subdirectory-filter subdir/you/want 
    ```

2.  删除所有对旧历史的引用。“origin” 跟踪你的克隆，“original” 是 filter-branch 保存旧东西的地方：

    ```
    git remote rm origin
    git update-ref -d refs/original/refs/heads/master
    git reflog expire --expire=now --all 
    ```

3.  即使是现在，您的历史记录也可能被困在 fsck 不会触及的包文件中。将其撕成碎片，创建一个新的包文件并删除未使用的对象：

    ```
    git repack -ad 
    ```

在 filter-branch的[手册中](http://git-scm.com/docs/git-filter-branch#_checklist_for_shrinking_a_repository)有对此[的解释](http://git.kernel.org/?p=git/git.git;a=commitdiff;h=d0268de6d755c72ff375ec95a0cc0dbd99dc31e2)。

* * *

## 回答 #5

> 赞同：40
> 
> 时间：2011-06-09T15:41:37.473

*编辑：添加了 Bash 脚本。*

这里给出的答案对我来说只是部分工作；许多大文件留在缓存中。最终奏效的方法（在 freenode 上的 #git 下班后）：

```
git clone --no-hardlinks file:///SOURCE /tmp/blubb
cd blubb
git filter-branch --subdirectory-filter ./PATH_TO_EXTRACT  --prune-empty --tag-name-filter cat -- --all
git clone file:///tmp/blubb/ /tmp/blooh
cd /tmp/blooh
git reflog expire --expire=now --all
git repack -ad
git gc --prune=now 
```

使用以前的解决方案，存储库大小约为 100 MB。这个使它下降到 1.7 MB。也许它可以帮助某人:)

* * *

以下 bash 脚本自动执行该任务：

```
!/bin/bash

if (( $# < 3 ))
then
    echo "Usage:   $0 </path/to/repo/> <directory/to/extract/> <newName>"
    echo
    echo "Example: $0 /Projects/42.git first/answer/ firstAnswer"
    exit 1
fi

clone=/tmp/${3}Clone
newN=/tmp/${3}

git clone --no-hardlinks file://$1 ${clone}
cd ${clone}

git filter-branch --subdirectory-filter $2  --prune-empty --tag-name-filter cat -- --all

git clone file://${clone} ${newN}
cd ${newN}

git reflog expire --expire=now --all
git repack -ad
git gc --prune=now 
```

* * *

## 回答 #6

> 赞同：28
> 
> 时间：2019-11-21T21:22:41.743

当`git filter-branch`使用更新版本的`git`（`2.22+`也许？）运行时，它说要使用这个新工具[git-filter-repo](https://github.com/newren/git-filter-repo)。这个工具无疑为我简化了事情。

## 使用 filter-repo 过滤

`XYZ`从原始问题创建 repo 的命令：

```
# create local clone of original repo in directory XYZ
tmp $ git clone git@github.com:user/original.git XYZ

# switch to working in XYZ
tmp $ cd XYZ

# keep subdirectories XY1 and XY2 (dropping ABC)
XYZ $ git filter-repo --path XY1 --path XY2

# note: original remote origin was dropped
# (protecting against accidental pushes overwriting original repo data)

# XYZ $ ls -1
# XY1
# XY2

# XYZ $ git log --oneline
# last commit modifying ./XY1 or ./XY2
# first commit modifying ./XY1 or ./XY2

# point at new hosted, dedicated repo
XYZ $ git remote add origin git@github.com:user/XYZ.git

# push (and track) remote master
XYZ $ git push -u origin master 
```

*假设：* * 远程 XYZ 仓库在推送之前是新的并且是空的

## 过滤和移动

就我而言，我还想移动几个目录以获得更一致的结构。最初，我运行那个简单`filter-repo`的命令，然后运行 ​​，但我发现使用该选项`git mv dir-to-rename`可以获得稍微“更好”的历史记录。我现在看到（在 GitHub UI 中），而`--path-rename`不是在新存储库中看到移动文件的最后修改时间，它与原始存储库中的修改时间相匹配。`5 hours ago``last year`

代替...

```
git filter-repo --path XY1 --path XY2 --path inconsistent
git mv inconsistent XY3  # which updates last modification time 
```

最后我跑了...

```
git filter-repo --path XY1 --path XY2 --path inconsistent --path-rename inconsistent:XY3 
```

笔记：

*   我认为[Git Rev News 博客文章](https://git.github.io/rev_news/2019/08/21/edition-54/#an-introduction-to-git-filter-repo--written-by-elijah-newren)很好地解释了创建另一个回购过滤工具的原因。
*   我最初尝试了在原始存储库中创建与目标存储库名称匹配的子目录*然后*过滤（使用`git filter-repo --subdirectory-filter dir-matching-new-repo-name`）的路径。该命令正确地将该子目录转换为复制的本地 repo 的根目录，但它也导致仅创建子目录的三个提交的历史记录。（我没有意识到`--path`可以多次指定；因此，无需在源代码库中创建子目录。）因为当我注意到我未能继续执行时，有人已经提交了源代码库历史，我只是`git reset commit-before-subdir-move --hard`在`clone`命令之后使用，并添加`--force`到`filter-repo`命令中以使其对稍微修改的本地克隆进行操作。

```
git clone ...
git reset HEAD~7 --hard      # roll back before mistake
git filter-repo ... --force  # tell filter-repo the alterations are expected 
```

*   因为我不知道扩展模式，所以我很难安装`git`，但最终我克隆了[git-filter-repo](https://github.com/newren/git-filter-repo)并将其符号链接到`$(git --exec-path)`：

```
ln -s ~/github/newren/git-filter-repo/git-filter-repo $(git --exec-path) 
```

* * *

## 回答 #7

> 赞同：27
> 
> 时间：2014-08-20T14:11:53.687

这不再那么复杂，您只需在您的 repo 的克隆上使用[git filter-branch](http://git-scm.com/docs/git-filter-branch)命令来剔除您不想要的子目录，然后推送到新的远程。

```
git filter-branch --prune-empty --subdirectory-filter <YOUR_SUBDIR_TO_KEEP> master
git push <MY_NEW_REMOTE_URL> -f . 
```

* * *

## 回答 #8

> 赞同：19
> 
> 时间：2010-03-22T20:55:26.383

**更新**： git-subtree 模块非常有用，以至于 git 团队将其拉入核心并制作了它`git subtree`。请参阅此处：[将子目录分离（移动）到单独的 Git 存储库中](https://stackoverflow.com/questions/359424/detach-subdirectory-into-separate-git-repository/17864475#17864475)

git-subtree 可能对此有用

[http://github.com/apenwarr/git-subtree/blob/master/git-subtree.txt](http://github.com/apenwarr/git-subtree/blob/master/git-subtree.txt)（已弃用）

[http://psionides.jogger.pl/2010/02/04/sharing-code-between-projects-with-git-subtree/](http://psionides.jogger.pl/2010/02/04/sharing-code-between-projects-with-git-subtree/)

* * *

## 回答 #9

> 赞同：19
> 
> 时间：2015-08-06T15:26:51.363

[这是对CoolAJ86](https://stackoverflow.com/users/151312/coolaj86)的[“The Easy Way™”答案](https://stackoverflow.com/a/17864475/535203)的一个小修改，以便将**多个子文件夹**（比如说`sub1`和`sub2`）拆分到一个新的 git 存储库中。

# The Easy Way™（多个子文件夹）

1.  准备旧仓库

    ```
    pushd <big-repo>
    git filter-branch --tree-filter "mkdir <name-of-folder>; mv <sub1> <sub2> <name-of-folder>/" HEAD
    git subtree split -P <name-of-folder> -b <name-of-new-branch>
    popd 
    ```

    **注意：** `<name-of-folder>`不得包含前导或尾随字符。例如，名为`subproject`MUST 的文件夹必须传递为`subproject`，而不是`./subproject/`

    **Windows 用户注意：**当您的文件夹深度大于 1 时，`<name-of-folder>`必须使用 *nix 样式的文件夹分隔符 (/)。例如，名为的文件夹`path1\path2\subproject`必须作为`path1/path2/subproject`. 此外，不要使用`mv`命令但是`move`.

    **最后说明：**与基本答案的独特而巨大的区别是脚本的第二行“ `git filter-branch...`”

2.  创建新的仓库

    ```
    mkdir <new-repo>
    pushd <new-repo>

    git init
    git pull </path/to/big-repo> <name-of-new-branch> 
    ```

3.  将新的 repo 链接到 Github 或其他任何地方

    ```
    git remote add origin <git@github.com:my-user/new-repo.git>
    git push origin -u master 
    ```

4.  清理，*如果需要*

    ```
    popd # get out of <new-repo>
    pushd <big-repo>

    git rm -rf <name-of-folder> 
    ```

    **注意**：这会保留存储库中的所有历史参考。如果您真的担心提交密码或需要减小文件夹的文件大小，请参阅原始答案中的**附录**`.git`。

* * *

## 回答 #10

> 赞同：13
> 
> 时间：2012-04-17T05:12:06.860

原始问题希望 XYZ/ABC/(*files) 变为 ABC/ABC/(*files)。在为我自己的代码实现可接受的答案后，我注意到它实际上将 XYZ/ABC/(*files) 更改为 ABC/(*files)。filter-branch 手册页甚至说，

> 结果将包含该目录（并且仅包含该目录）*作为其项目根目录*。”

换句话说，它将顶级文件夹“向上”提升一级。这是一个重要的区别，因为例如，在我的历史中，我重命名了一个顶级文件夹。通过将文件夹“向上”提升一级，git 在我进行重命名的提交时失去了连续性。

![过滤器分支后我失去了连续性](https://i.stack.imgur.com/qR1zI.png)

我对这个问题的回答是制作 2 个存储库副本并手动删除要保留在每个中的文件夹。手册页支持我：

> [...] 如果一个简单的单次提交足以解决您的问题，请避免使用 [此命令]

* * *

## 回答 #11

> 赞同：7
> 
> 时间：2009-07-25T10:01:26.310

为了补充[Paul 的答案](https://stackoverflow.com/a/359759/42473)，我发现要最终恢复空间，我必须将 HEAD 推送到一个干净的存储库，并减少 .git/objects/pack 目录的大小。

IE

```
$ mkdir ...ABC.git
$ cd ...ABC.git
$ git init --bare

```

在 gc prune 之后，还要执行以下操作：

```
$ git push ...ABC.git HEAD

```

然后你可以做

```
$ git clone ...ABC.git

```

并且 ABC/.git 的大小减小了

实际上，推送清理存储库不需要一些耗时的步骤（例如 git gc），即：

```
$ git clone --no-hardlinks /XYZ /ABC
$ git filter-branch --subdirectory-filter ABC HEAD
$ git reset --hard
$ git push ...ABC.git HEAD

```

* * *

## 回答 #12

> 赞同：7
> 
> 时间：2014-11-12T13:22:04.530

现在正确的方法如下：

`git filter-branch --prune-empty --subdirectory-filter FOLDER_NAME [first_branch] [another_branch]`

GitHub 现在甚至有关于此类案例的[小文章。](https://help.github.com/articles/splitting-a-subfolder-out-into-a-new-repository/)

但请务必先将原始存储库克隆到单独的目录（因为它会删除所有文件和其他目录，您可能需要使用它们）。

所以你的算法应该是：

1.  将您的远程仓库克隆到另一个目录
2.  仅使用`git filter-branch`某些子目录下的文件，推送到新的远程
3.  创建提交以从原始远程存储库中删除此子目录

* * *

## 回答 #13

> 赞同：6
> 
> 时间：2016-09-19T18:46:40.660

似乎这里的大多数（全部？）答案都依赖于某种形式`git filter-branch --subdirectory-filter`及其同类。这可能在“大多数时候”有效，但是在某些情况下，例如当您重命名文件夹时，例如：

```
 ABC/
    /move_this_dir # did some work here, then renamed it to

ABC/
    /move_this_dir_renamed 
```

如果您使用普通的 git 过滤器样式来提取“move_this_dir_renamed”，您将丢失最初为“move_this_dir”（[ref](https://stackoverflow.com/questions/2797191/how-to-split-a-git-repository-while-preserving-subdirectories)）时发生的文件更改历史记录。

因此，似乎真正保留*所有*更改历史记录的唯一方法（如果你的情况是这样的话）本质上是复制存储库（创建一个新的存储库，将其设置为原点），然后核对其他所有内容并将子目录重命名为父目录，如下所示：

1.  在本地克隆多模块项目
2.  分支 - 检查那里有什么：`git branch -a`
3.  对要包含在拆分中的每个分支进行检查，以在您的工作站上获取本地副本：`git checkout --track origin/branchABC`
4.  在新目录中制作副本：`cp -r oldmultimod simple`
5.  进入新的项目副本：`cd simple`
6.  去掉这个项目中不需要的其他模块：
7.  `git rm otherModule1 other2 other3`
8.  现在只剩下目标模块的子目录
9.  去掉模块子目录，使模块根成为新的项目根
10.  `git mv moduleSubdir1/* .`
11.  删除 relic 子目录：`rmdir moduleSubdir1`
12.  随时检查更改：`git status`
13.  创建新的 git 存储库并复制其 URL 以将此项目指向其中：
14.  `git remote set-url origin http://mygithost:8080/git/our-splitted-module-repo`
15.  验证这是好的：`git remote -v`
16.  将更改推送到远程仓库：`git push`
17.  转到远程仓库并检查它是否都在那里
18.  对需要的任何其他分支重复此操作：`git checkout branch2`

这遵循[github 文档“将子文件夹拆分到新存储库”](https://help.github.com/articles/splitting-a-subfolder-out-into-a-new-repository/)步骤 6-11 将模块推送到新存储库。

这不会在您的 .git 文件夹中为您节省任何空间，但它会保留您对这些文件的所有更改历史记录，即使在重命名时也是如此。如果没有“很多”历史丢失等，这可能不值得。但至少可以保证您不会丢失较旧的提交！

* * *

## 回答 #14

> 赞同：6
> 
> 时间：2017-08-31T14:02:49.557

我推荐[GitHub 的将子文件夹拆分为新存储库的指南](https://help.github.com/articles/splitting-a-subfolder-out-into-a-new-repository/)。这些步骤类似于[保罗的回答](https://stackoverflow.com/a/359759/3357935)，但我发现他们的说明更容易理解。

我已经修改了说明，以便它们申请本地存储库，而不是托管在 GitHub 上的存储库。

* * *

> ### [将子文件夹拆分到新存储库中](https://help.github.com/articles/splitting-a-subfolder-out-into-a-new-repository/)
> 
> 1.  打开 Git Bash。
>     
>     
> 2.  将当前工作目录更改为您要创建新存储库的位置。
>     
>     
> 3.  克隆包含子文件夹的存储库。
>     
>     
> 
> ```
> git clone OLD-REPOSITORY-FOLDER NEW-REPOSITORY-FOLDER 
> ```
> 
> 4.  将当前工作目录更改为克隆的存储库。
> 
> ```
> cd REPOSITORY-NAME 
> ```
> 
> 5.  要从存储库中的其余文件中过滤掉子文件夹，请运行`git filter-branch`，并提供以下信息：
>     *   `FOLDER-NAME`：项目中您要从中创建单独存储库的文件夹。
>         *   提示：Windows 用户应该使用`/`来分隔文件夹。
>     *   `BRANCH-NAME`：当前项目的默认分支，例如，`master`或`gh-pages`.
> 
> ```
> git filter-branch --prune-empty --subdirectory-filter FOLDER-NAME  BRANCH-NAME 
> # Filter the specified branch in your directory and remove empty commits
> Rewrite 48dc599c80e20527ed902928085e7861e6b3cbe6 (89/89)
> Ref 'refs/heads/BRANCH-NAME' was rewritten 
> ```

* * *

## 回答 #15

> 赞同：5
> 
> 时间：2014-03-10T17:39:13.373

我确实遇到了这个问题，但是所有基于 git filter-branch 的标准解决方案都非常慢。如果您有一个小型存储库，那么这可能不是问题，它适合我。我编写了另一个基于 libgit2 的 git 过滤程序，它首先为主存储库的每个过滤创建分支，然后将它们推送到清理存储库作为下一步。在我的存储库（500Mb 100000 次提交）上，标准的 git filter-branch 方法需要几天时间。我的程序需要几分钟来做同样的过滤。

它有一个神话般的名字 git_filter 并住在这里：

[https://github.com/slobobaby/git_filter](https://github.com/slobobaby/git_filter)

在 GitHub 上。

我希望它对某人有用。

* * *

## 回答 #16

> 赞同：4
> 
> 时间：2010-10-28T02:36:37.497

使用此过滤器命令删除子目录，同时保留您的标签和分支：

```
git filter-branch --index-filter \
"git rm -r -f --cached --ignore-unmatch DIR" --prune-empty \
--tag-name-filter cat -- --all 
```

* * *

## 回答 #17

> 赞同：4
> 
> 时间：2012-02-07T19:07:35.393

对于它的价值，这里是在 Windows 机器上使用 GitHub 的方法。假设您有一个克隆的 repo 驻留在`C:\dir1`. 目录结构如下所示：`C:\dir1\dir2\dir3`. 该`dir3`目录是我想成为一个新的独立仓库的目录。

**GitHub：**

1.  创建新的存储库：`MyTeam/mynewrepo`

**重击提示：**

2.  `$ cd c:/Dir1`
3.  `$ git filter-branch --prune-empty --subdirectory-filter dir2/dir3 HEAD`
    返回：（`Ref 'refs/heads/master' was rewritten`仅供参考：dir2/dir3 区分大小写。）

4.  `$ git remote add some_name git@github.com:MyTeam/mynewrepo.git`
    `git remote add origin etc`. 没用，退了“ `remote origin already exists`”

5.  `$ git push --progress some_name master`

* * *

## 回答 #18

> 赞同：3
> 
> 时间：2013-05-31T10:01:26.073

正如我[上面提到的](https://stackoverflow.com/questions/359424/detach-subdirectory-into-separate-git-repository#comment24306261_10185428)，我不得不使用反向解决方案（删除所有未触及我的提交`dir/subdir/targetdir`），这似乎可以很好地删除大约 95% 的提交（根据需要）。然而，还有两个小问题。

**首先，`filter-branch`在删除引入或修改代码的提交方面做得很出色，但显然，**合并提交位于****Gitiverse**中的位置之下。**

 ***   **[截图：合并疯狂！](https://www.evernote.com/shard/s4/sh/a3d2bdfb-119e-4c06-bbe7-31caa1e7f33c/40bf20f0378670f9f3307e03119fbdfc)**

这是一个我可能可以忍受的化妆品问题*（他说......慢慢后退，避开眼睛）*。

**第二**，剩下的少数提交几乎都是**重复**的！我似乎获得了第二条冗余的时间线，它几乎涵盖了该项目的整个历史。有趣的是（您可以从下图中看到），我的三个本地分支并不都在同一时间线上（这当然是它存在的原因，而不仅仅是垃圾收集）。

*   **[截图：双双，Git 过滤器分支风格](https://www.evernote.com/shard/s4/sh/f474a082-1aa6-4fc5-a2ea-3a8978cf7eb0/b5ef88551c266df9af3d8b86d5a7dd56)**

我唯一能想象的是，其中一个已删除的提交可能是`filter-branch` *实际执行 delete*的单个合并提交，并且创建了并行时间线，因为每个现在未合并的链都获取了自己的提交副本。（*耸耸肩*，我的 TARDiS 在哪里？）我很确定我可以解决这个问题，尽管我*真的*很想了解它是如何发生的。

在疯狂的 mergefest-O-RAMA 的情况下，我可能会不理会它，因为它已在我的提交历史中如此牢固地根深蒂固——每当我靠近时都会威胁我——它似乎并没有真正导致任何非美容问题，因为它在 Tower.app 中非常漂亮。

* * *

## 回答 #19

> 赞同：3
> 
> 时间：2015-02-11T10:28:34.997

# 更简单的方法

1.  安装[`git splits`](https://github.com/simpliwp/git-splits). 我根据[jkeating 的解决方案](https://stackoverflow.com/a/6006679/3306354)将它创建为 git 扩展。
2.  将目录拆分为本地分支 `#change into your repo's directory cd /path/to/repo #checkout the branch git checkout XYZ
    #split multiple directories into new branch XYZ git splits -b XYZ XY1 XY2`

3.  在某处创建一个空仓库。我们假设我们已经`xyz`在 GitHub 上创建了一个空仓库，其路径为：`git@github.com:simpliwp/xyz.git`

4.  推送到新的仓库。 `#add a new remote origin for the empty repo so we can push to the empty repo on GitHub git remote add origin_xyz git@github.com:simpliwp/xyz.git #push the branch to the empty repo's master branch git push origin_xyz XYZ:master`

5.  将新创建的远程仓库克隆到新的本地目录中
    `#change current directory out of the old repo cd /path/to/where/you/want/the/new/local/repo #clone the remote repo you just pushed to git clone git@github.com:simpliwp/xyz.git`

* * *

## 回答 #20

> 赞同：2
> 
> 时间：2009-06-12T02:49:26.910

在垃圾收集之前，您可能需要“git reflog expire --expire=now --all”之类的东西来实际清除文件。git filter-branch 仅删除历史记录中的引用，但不会删除包含数据的 reflog 条目。当然，先测试一下。

这样做时我的磁盘使用量急剧下降，尽管我的初始条件有些不同。也许 --subdirectory-filter 否定了这种需求，但我对此表示怀疑。

* * *

## 回答 #21

> 赞同：2
> 
> 时间：2016-01-06T02:42:05.683

[在https://github.com/vangorra/git_split](https://github.com/vangorra/git_split)查看 git_split 项目

在自己的位置将 git 目录变成自己的存储库。没有子树有趣的事情。该脚本将获取您的 git 存储库中的现有目录，并将该目录转换为它自己的独立存储库。在此过程中，它将复制您提供的目录的整个更改历史记录。

```
./git_split.sh <src_repo> <src_branch> <relative_dir_path> <dest_repo>
        src_repo  - The source repo to pull from.
        src_branch - The branch of the source repo to pull from. (usually master)
        relative_dir_path   - Relative path of the directory in the source repo to split.
        dest_repo - The repo to push to. 
```

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2013-03-29T20:18:09.520

把它放到你的 gitconfig 中：

```
reduce-to-subfolder = !sh -c 'git filter-branch --tag-name-filter cat --prune-empty --subdirectory-filter cookbooks/unicorn HEAD && git reset --hard && git for-each-ref refs/original/ | cut -f 2 | xargs -n 1 git update-ref -d && git reflog expire --expire=now --all && git gc --aggressive --prune=now && git remote rm origin' 
```

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2016-02-10T16:57:12.867

我确信 git subtree 一切都很好，但是我想要移动的 git 托管代码的子目录都在 eclipse 中。因此，如果您使用的是 egit，这非常容易。获取您要移动的项目并组队->断开连接，然后组队->将其共享到新位置。它将默认尝试使用旧的 repo 位置，但您可以取消选中 use-existing 选择并选择新的位置来移动它。万岁万岁。

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2019-01-10T07:23:15.530

您可以轻松尝试[https://help.github.com/enterprise/2.15/user/articles/splitting-a-subfolder-out-into-a-new-repository/](https://help.github.com/enterprise/2.15/user/articles/splitting-a-subfolder-out-into-a-new-repository/)

这对我有用。我在上面给出的步骤中遇到的问题是

1.  在这个命令`git filter-branch --prune-empty --subdirectory-filter FOLDER-NAME BRANCH-NAME` 中`BRANCH-NAME`是**主**

2.  如果由于保护问题而在提交时最后一步失败，请遵循 - [https://docs.gitlab.com/ee/user/project/protected_branches.html](https://docs.gitlab.com/ee/user/project/protected_branches.html)

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2019-03-28T14:07:25.410

我找到了非常直接的解决方案，想法是复制存储库，然后删除不必要的部分。这是它的工作原理：

1) 克隆一个你想要拆分的仓库

```
git clone git@git.thehost.io:testrepo/test.git 
```

2）移动到git文件夹

```
cd test/ 
```

2）删除不必要的文件夹并提交

```
rm -r ABC/
git add .
enter code here
git commit -m 'Remove ABC' 
```

3) 使用[BFG删除不必要的文件夹表单历史记录](https://rtyley.github.io/bfg-repo-cleaner/)

```
cd ..
java -jar bfg.jar --delete-folders "{ABC}" test
cd test/
git reflog expire --expire=now --all && git gc --prune=now --aggressive 
```

> 对于多个文件夹，您可以使用逗号
> 
> ```
> java -jar bfg.jar --delete-folders "{ABC1,ABC2}" metric.git 
> ```

4）检查历史记录不包含您刚刚删除的文件/文件夹

```
git log --diff-filter=D --summary | grep delete 
```

5) 现在你有了没有 ABC 的干净存储库，所以只需将其推送到新的来源

```
remote add origin git@github.com:username/new_repo
git push -u origin master 
```

就是这样。您可以重复这些步骤以获取另一个存储库，

只需删除 XY1,XY2 并在第 3 步重命名 XYZ -> ABC

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2021-07-10T12:13:06.293

发现这篇精彩的文章[原始参考](https://www.deployhq.com/git/faqs/detatch-subdirectory-git-submodule)很容易理解。如果无法访问，请在此处记录。

**1\. 准备当前仓库**

```
$ cd path/to/repository
$ git subtree split -P my-folder -b my-folder
Created branch 'my-folder'
aecbdc3c8fe2932529658f5ed40d95c135352eff 
```

*文件夹的名称必须是相对路径，从存储库的根目录开始。*

**2\. 创建新的存储库**

```
$ cd my-folder
$ git init
Initialized empty Git repository in /Users/adamwest/Projects/learngit/shop/my-folder/.git/
$ git add .
$ git commit -m "initial commit"
[master (root-commit) 192c10b] initial commit
 1 file changed, 0 insertions(+), 0 deletions(-)
 create mode 100644 file 
```

*在这里，我们只需要 cd 到新文件夹，初始化新存储库，并提交任何内容。*

**3.新增远程仓库并推送**

```
$ git remote add origin git@github.com:robertlyall/my-folder.git
$ git push origin -u master
Enumerating objects: 3, done.
Counting objects: 100% (3/3), done.
Writing objects: 100% (3/3), 199 bytes | 199.00 KiB/s, done.
Total 3 (delta 0), reused 0 (delta 0)
To github.com:robertlyall/my-folder.git
 * [new branch]      master -> master
Branch 'master' set up to track remote branch 'master' from 'origin'. 
```

*我们从 GitHub 远程添加新的存储库，然后将我们的第一个提交推送到它。*

**4.从主存储库中删除文件夹并推送**

```
$ cd ../
$ git rm -rf my-folder
rm 'my-folder/file'
$ git commit -m "Remove old folder"
[master 56aedbe] remove old folder
 1 file changed, 0 insertions(+), 0 deletions(-)
 delete mode 100644 my-folder/file
$ git push
Enumerating objects: 3, done.
Counting objects: 100% (3/3), done.
Delta compression using up to 4 threads
Compressing objects: 100% (2/2), done.
Writing objects: 100% (2/2), 217 bytes | 217.00 KiB/s, done.
Total 2 (delta 1), reused 0 (delta 0)
remote: Resolving deltas: 100% (1/1), completed with 1 local object.
To github.com:robertlyall/shop.git
   74dd8b3..56aedbe  master -> master 
```

*最后，我们 cd 回到根目录，从我们的主存储库中删除该文件夹，然后提交并推送更改。现在，我们的主存储库中有该文件夹，但链接到一个完全独立的存储库，可以跨多个项目重用。*

# java - 分布式项目中的负载均衡

> ID：359426
> 
> 赞同：3
> 
> 时间：2008-12-11T13:57:58.980
> 
> 标签：java, algorithm, distributed, load-balancing

有谁知道一个简单的负载平衡算法（公式），它将连接的用户、cpu 负载、网络负载和内存使用情况联系起来？这将用于比较各种服务器并分配给新用户目前最好的。谢谢你。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-11T14:44:03.710

如果您使用 Apache Web Server 代理应用程序服务器，我建议您使用`mod_proxy`和`mod_proxy_balancer`. [您可以在此处](http://docs.codehaus.org/display/JETTY/Configuring+mod_proxy)找到有关 mod_proxy 的快速介绍。这是关于 Jetty 的，但它很容易适用于其他服务器。

您需要担心集群的第一件事是处理会话的方式。您需要确保属于会话的请求被定向到同一台服务器（或者会话以某种方式被持久化然后总是被检索）。Mod_proxy 可以为您做到这一点。

关于负载均衡算法，请参见[`mod_proxy_balancer`](http://httpd.apache.org/docs/2.2/mod/mod_proxy_balancer.html). 根据它，有 3 种负载均衡器调度算法。

较旧的负载平衡解决方案是 mod_jk。

一般来说，即使我有更好的算法，我也不会自己实现。最好使用现有的解决方案。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-12-09T09:47:10.107

看看[nginx](http://nginx.org/)。它易于配置，速度非常快，并且可以处理服务器之间的负载平衡。

相应地需要分布式会话处理（请参阅 kgiannakakis）了解详细信息。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-12-09T09:53:25.153

看看[haproxy](http://haproxy.1wt.eu/)。它是一个非常稳定和快速加载的 HTTP/TCP 负载均衡器，正在被一些流量非常大的网站使用。

相应地需要分布式会话处理（请参阅 kgiannakakis）了解详细信息。

# jsp - cookie 和会话之间的区别？

> ID：359434
> 
> 赞同：157
> 
> 时间：2008-12-11T14:00:47.323
> 
> 标签：jsp, session, servlets, cookies

我正在接受 Web 开发培训，并且正在学习**JSP**和**Servlets**。我有一些知识`HttpSession`- 我在一些示例项目中使用过它。

在浏览器中，我看到了“删除 cookie”的选项。如果我删除 cookie，它`HttpSession`也会删除。

cookie 和 session 是一样的吗？它们之间有什么区别？

* * *

## 回答 #1

> 赞同：308
> 
> 时间：2008-12-11T14:15:30.053

cookie 只是在客户端和服务器之间来回发送的短文本字符串。您可以将其存储`name=bob; password=asdfas`在 cookie 中并来回发送以识别服务器端的客户端。您可以将其视为与没有短期记忆的银行柜员进行交换，并且需要您为每笔交易确定自己的身份。当然，使用 cookie 来存储此类信息是非常不安全的。Cookie 的大小也有限制。

现在，当银行柜员知道他/她的记忆问题时，他/她可以在一张纸上写下您的信息，并为您分配一个简短的身份证号码。然后，不用为每笔交易提供您的帐号和驾照，您只需说“我是客户 12”

将其转换为 Web 服务器：服务器将相关信息存储在会话对象中，并创建一个会话 ID，它将在 cookie 中发送回客户端。当客户端发回 cookie 时，服务器可以简单地使用 ID 查找会话对象。因此，如果您删除 cookie，会话将丢失。

另一种选择是让服务器使用 URL 重写来交换会话 ID。

假设您有一个链接 -`www.myserver.com/myApp.jsp` 您可以浏览该页面并将每个 URL 重写为`www.myserver.com/myApp.jsp?sessionID=asdf`甚至`www.myserver.com/asdf/myApp.jsp`以这种方式交换标识符。此技术由 Web 应用程序容器处理，通常通过将配置设置为使用无 cookie 会话来启用。

* * *

## 回答 #2

> 赞同：183
> 
> 时间：2008-12-11T14:06:35.173

会话是包含用户信息的服务器端文件，而 Cookie 是包含用户信息的客户端文件。会话具有将它们映射到特定用户的唯一标识符。此标识符可以在 URL 中传递或保存到会话 cookie 中。

大多数现代站点使用第二种方法，将标识符保存在 Cookie 中，而不是在 URL 中传递（这会带来安全风险）。您可能在不知情的情况下使用了这种方法，并且通过删除 cookie，您在删除 cookie 中包含的唯一会话标识符时有效地删除了它们的匹配会话。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2013-09-05T08:51:40.227

cookie 和 session 都存储有关用户的信息（使 HTTP 请求有状态），但不同之处在于 cookie 将信息存储在客户端（浏览器）上，而 session 将信息存储在服务器端。cookie 是有限的，因为它存储有关有限用户的信息，并且只为每个用户存储有限的内容。会话不受这种方式的限制。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2019-03-14T08:49:47.593

在这个线程上已经有很多贡献了，只需总结一个序列图以另一种方式说明它。

[![在此处输入图像描述](https://i.stack.imgur.com/gREWR.png)](https://i.stack.imgur.com/gREWR.png)

这也是关于这个主题的一个很好的链接，[https://web.stanford.edu/~ouster/cgi-bin/cs142-fall10/lecture.php? topic=cookie](https://web.stanford.edu/~ouster/cgi-bin/cs142-fall10/lecture.php?topic=cookie)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2015-04-08T10:20:21.747

Cookie 基本上是一个跨网络浏览器访问的全局数组。多次用于发送/接收值。它作为一种存储机制来访问表单之间的值。与会话相比，浏览器可以禁用 Cookie，这对它们的使用增加了限制。

会话可以定义为登录和注销之间的东西。用户登录和注销之间的时间是一个会话。会话仅存储会话时间的值，即在注销之前。会话用于跟踪用户登录后的活动。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-11T14:12:07.690

谷歌*JSESSIONID*。这将解释 Servlet API 最初如何使用 URL 重写，然后，如果启用了 cookie，则使用 cookie 来管理会话。

HTTP 是无状态的，因此客户端浏览器必须在每次请求时将其会话的 id 发送到服务器。服务器通过任何方式使用此 id 来检索该会话的任何数据，使其在请求的生命周期内可用。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2015-02-12T08:40:43.687

Asp.net 中的会话：

1.维护整个应用程序的数据。

2.如果当前会话处于活动状态，则保留数据。如果我们需要从多个控制器和视图中访问一些数据，则会话是存储和检索数据的方式。

3.Sessions是包含用户信息的服务器端文件。[会话是将它们映射到特定用户的唯一标识符]

将其转换为 Web 服务器：服务器将相关信息存储在会话对象中，并创建一个会话 ID，它将在 cookie 中发送回客户端。当客户端发回 cookie 时，服务器可以简单地使用 ID 查找会话对象。因此，如果您删除 cookie，会话将丢失。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2015-04-01T10:03:29.123

**Cookies**以文本文件格式存储在浏览器中。它存储的数据量是有限的。它只允许**4kb[4096bytes]** .$_COOKIE 变量不会保存多个同名 cookie

我们可以轻松地访问 cookie 值。因此它的**安全性较低**。**setcookie()**函数必须出现在

```
<html> 
```

标签。

**会话**存储在服务器端。它存储无限量的数据。它在会话中保存多个变量。我们无法轻松访问 cookie 值。因此**更安全**。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2015-07-03T01:51:01.093

Cookie 是一种实现客户端和服务器之间会话的方式，这种方式将会话信息存储在 cookie 中。但这不是保存会话信息的唯一方法，另一种方法是将会话信息存储在 Url 中。

# c# - C# 相当于 Java 的 continue ？

> ID：359436
> 
> 赞同：35
> 
> 时间：2008-12-11T14:01:54.730
> 
> 标签：c#, java

应该简单快捷：我想要一个等效于以下 Java 代码的 C#：

```
orig: for(String a : foo) {
  for (String b : bar) {
    if (b.equals("buzz")) {
      continue orig;
    }
  }
  // other code comes here...
} 
```

* * *

***编辑***：好的，似乎没有这样的等价物（嘿 - Jon Skeet 自己说没有，这解决了它；））。所以对我来说“解决方案”（在它的 Java 中）是：

```
for(String a : foo) {
  bool foundBuzz = false;
  for (String b : bar) {
    if (b.equals("buzz")) {
      foundBuzz = true;
      break;
    }
  }
  if (foundBuzz) {
    continue;
  }
  // other code comes here...
} 
```

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2008-12-11T14:05:10.263

恐怕我不相信有等价物。您必须使用布尔值，或者只是“转到”外部循环内部的末尾。它甚至比听起来更混乱，因为必须将标签应用于声明 - 但我们不想在这里做任何事情。但是，我认为这可以满足您的要求：

```
using System;

public class Test
{
    static void Main()
    {
        for (int i=0; i < 5; i++)
        {
            for (int j = 0; j < 5; j++)
            {
               Console.WriteLine("i={0} j={1}", i, j);
               if (j == i + 2)
               {
                   goto end_of_loop;   
               }
            }
            Console.WriteLine("After inner loop");
            end_of_loop: {}
        }
    }
} 
```

然而，我*强烈*推荐一种不同的表达方式。我不能认为有很多时候没有更易读的编码方式。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2011-02-15T16:43:17.220

其他可能性是使用内部循环创建一个函数：

```
void mainFunc(string[] foo, string[] bar)
{
  foreach (string a in foo)
    if (hasBuzz(bar))
      continue;
  // other code comes here...
}

bool hasBuzz(string[] bar)
{
  foreach (string b in bar)
    if (b.equals("buzz"))
      return true;
  return false;
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-11T14:07:41.973

在 VB.Net 中，您可能只有一个`while`循环和一个`for`循环，然后`exit`是所需的范围级别。

在 C# 中，也许`break;`？

这可能会打破内部循环并允许外部循环继续进行。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-11T14:25:45.993

我认为您正在寻找简单的“继续”关键字......但是，不是一个 Java 人，我并没有真正了解代码片段想要实现的目标。

不过，请考虑以下内容。

```
foreach(int i in new int[] {1,2,3,5,6,7})
{
    if(i % 2 == 0)
        continue;
    else
        Console.WriteLine(i.ToString());    
} 
```

第 4 行的 continue 语句是在下一个值处继续循环的指令。这里的输出将是 1、3、5 和 7。

用“break”代替“continue”，如下，

```
foreach(int i in new int[] {1,2,3,5,6,7})
{
    if(i % 2 == 0)
       break;
    else
        Console.WriteLine(i.ToString());    
} 
```

将给出输出 1\. Break 指示循环终止，最常用于在满足条件时停止处理。

我希望这能给你一些你正在寻找的东西，但如果没有，请随时再次询问。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-11T14:27:31.607

您可以执行以下操作：

```
for(int i=0; i< foo.Length -1 ; i++) {
  for (int j=0; j< bar.Length -1; j++) {
    if (condition) {
      break;
    }
    if(j != bar.Length -1)
        continue;
    /*The rest of the code that will not run if the previous loop doesn't go all the way*/
  }
} 
```

# r - R 的优化包

> ID：359438
> 
> 赞同：11
> 
> 时间：2008-12-11T14:02:06.167
> 
> 标签：r, mathematical-optimization

有谁知道 R 的任何优化包（类似于 S+ 的 NUOPT）？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-07-27T21:23:39.600

R有很多很多的优化包；检查关于优化的 CRAN 任务视图：http: [//cran.r-project.org/web/views/Optimization.html](http://cran.r-project.org/web/views/Optimization.html)。当然，对于非线性程序，有`optim()`标准的，包括 Broyden-Fletcher-Goldfarb-Shanno 算法和 Nelder-Mead。这是一个很好的开始。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2013-01-06T05:13:54.077

您还应该尝试使用[Rglpk](http://cran.r-project.org/web/packages/Rglpk/index.html)包解决[GLPK（GNU 线性编程工具包）](http://www.gnu.org/software/glpk/)的 LP 问题。

一个例子：

```
## Simple linear program.
## maximize:   2 x_1 + 4 x_2 + 3 x_3
## subject to: 3 x_1 + 4 x_2 + 2 x_3 <= 60
##             2 x_1 +   x_2 +   x_3 <= 40
##               x_1 + 3 x_2 + 2 x_3 <= 80
##               x_1, x_2, x_3 are non-negative real numbers

obj <- c(2, 4, 3)
mat <- matrix(c(3, 2, 1, 4, 1, 3, 2, 2, 2), nrow = 3)
dir <- c("<=", "<=", "<=")
rhs <- c(60, 40, 80)
max <- TRUE

Rglpk_solve_LP(obj, mat, dir, rhs, max = max) 
```

R 输出：（
请注意，`$status`返回一个整数，其中包含有关解决方案的状态信息。如果设置了控制参数 canonicalize_status（默认值），那么它将返回 0 以找到最佳解决方案，否则返回非零。如果控制参数是设置为 FALSE 它将返回 GLPK 状态代码）。

```
$optimum
[1] 76.66667

$solution
[1]  0.000000  6.666667 16.666667

$status
[1] 0 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-01-12T16:20:54.740

Galwegian 提到的 Linprog 专注于通过单纯形算法进行线性规划。此外，如果您正在进行投资组合优化，您可能会对[fPortfolio感兴趣。](http://cran.r-project.org/web/packages/fPortfolio/)

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2013-01-06T04:55:30.267

使用 R尝试[lpSolve 。](http://lpsolve.sourceforge.net/5.5/R.htm)

一个简单的例子：

```
# Maximize 
#   x1 + 9 x2 +   x3 
# Subject to: 
#   x1 + 2 x2 + 3 x3 <= 9
# 3 x1 + 2 x2 + 2 x3 <= 15
f.obj <- c(1, 9, 3)
f.con <- matrix(c(1, 2, 3, 3, 2, 2), nrow = 2, byrow = TRUE)
f.dir <- c("<=", "<=")
f.rhs <- c(9, 15)

lp("max", f.obj, f.con, f.dir, f.rhs)
lp("max", f.obj, f.con, f.dir, f.rhs)$solution 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-12-11T14:06:56.157

我过去曾将[linprog](http://cran.r-project.org/web/packages/linprog/index.html)用于线性问题。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2021-11-03T05:51:58.157

另一个包是[ompr](https://cran.r-project.org/web/packages/ompr/index.html)。该软件包的一个优点是可以使用许多求解器，并且可以`binary`轻松添加所有变量。一个简单的例子：`continuous``integer`

```
library(tidyverse)
library(ompr)
library(ompr.roi)

model <-  MIPModel() %>%
  add_variable(x1, type = "integer") %>%
  add_variable(x2, type = "integer") %>%
  set_bounds(x1, lb = 0) %>%
  set_bounds(x2, lb = 0) %>%
  set_objective(x1 - x2, "max") %>%
  add_constraint(x1 + 2*x2 <= 150) %>%
  add_constraint(x1 >= 30) %>%
  add_constraint(x2 >= 40) 
```

解决`glpk`：

```
library(ROI.plugin.glpk)
result <- solve_model(model, with_ROI(solver = "glpk", verbose = TRUE))

get_solution(result, x1)
get_solution(result, x2) 
```

也可以使用其他求解器来求解，例如`symphony`在`gap_limit`问题复杂且需要多次迭代才能收敛的情况下可以设置的位置：

```
library(ROI.plugin.symphony)
result <- solve_model(model, with_ROI(solver = "symphony",
                                      verbosity=-1, gap_limit=1.5)) 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2019-06-20T13:44:55.183

看看[NLoptr](https://cran.r-project.org/web/packages/nloptr/nloptr.pdf)包。它有相当广泛的文档，其中包含示例和大量算法可供选择，具体取决于您要解决的问题（等线性、非线性、约束）

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2017-01-11T01:47:08.087

我喜欢古罗比。许可证非常昂贵，但可以通过许多大学获得。见这里[http://www.gurobi.com/products/modeling-languages/r](http://www.gurobi.com/products/modeling-languages/r)

# java - 如何使用 Java 从网站检索 URL？

> ID：359439
> 
> 赞同：18
> 
> 时间：2008-12-11T14:02:10.657
> 
> 标签：java, http, url, connection

我想使用 HTTP GET 和 POST 命令从网站检索 URL 并解析 HTML。我该怎么做呢？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-12-11T18:02:05.527

您可以将[HttpURLConnection](http://java.sun.com/javase/6/docs/api/java/net/HttpURLConnection.html)与[URL](http://java.sun.com/javase/6/docs/api/java/net/URL.html)结合使用。

```
URL url = new URL("http://example.com");
HttpURLConnection connection = (HttpURLConnection)url.openConnection();
connection.setRequestMethod("GET");
connection.connect();

InputStream stream = connection.getInputStream();
// read the contents using an InputStreamReader 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-11T14:25:44.323

执行 GET 的最简单方法是使用内置的 java.net.URL。但是，如前所述，httpclient 是正确的方法，因为它可以让您在其他人中处理重定向。

要解析 html，您可以使用[html parser](http://htmlparser.sourceforge.net/)。

# email - CDO 消息：文本附件已损坏

> ID：359452
> 
> 赞同：1
> 
> 时间：2008-12-11T14:05:33.460
> 
> 标签：email, attachment, cdo.message

我正在使用 CDO 对象（和 VB6，但这并不重要）创建一封电子邮件。

```
With New CDO.Message
  .To = "<address>"
  .Subject = "Manifest test 8"
  .Organization = "<company>"
  .From = "<address>"
  .Sender = .From

  With .Configuration
    .Fields(cdoSendUsingMethod).Value = cdoSendUsingPort
    .Fields(cdoSMTPServer).Value = "192.168.0.4"
    .Fields.Update
  End With

  With .AddAttachment("c:\import\customermanifestOURACCOUNT11122008110032.dat")
    .Fields(cdoContentDisposition).Value = "attachment; filename=""Consignor.dat"""
    .Fields.Update
  End With

  .Send
End With 
```

如您所见，该消息是空的，并且包含我在电子邮件中重命名的附件。

附件是一个固定宽度的 ASCII 文本文件，其中包含我们系统的一些输出，每行一条记录，用 CRLF 分隔。

当消息被发送时，**所有的 CR 都会被删除附件，因此接收者会得到一个只有 LF 的文件，因此已损坏。**

我尝试更改`ContentEncoding`为 7bit 和 base64，没有工作。

我尝试将`ContentMediaType`附件设置为`text/plain`，没有用。

添加后我尝试不重命名附件，没有用。

`ContentMediaType`附件的默认设置为，`application/octet-stream`所以我无法弄清楚为什么（以及通过什么）它首先被更改。

如果我`.SaveToFile()`在 之后立即执行附件`.Send()`，它会将有效文件保存在磁盘上。

这是我的代码中的问题，还是邮件服务器设置或其他问题？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-11T14:43:56.393

好吧，那很奇怪。

我们使用我们的 gmail 帐户来测试那个东西，更具体地说，是 gmail 网络界面。我们单击附件链接以保存接收的文件。并且文件已损坏。

一旦我们尝试了一些厚客户端，结果就很好。所有文件都可以正确下载，没有任何损坏。

所以我认为这是 gmail Web 界面中的一个错误（与 gmail POP3 界面相反）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-11T14:20:36.190

我很长时间没有使用 CDO，但我记得过去遇到过这个问题。通过尝试不同的方法，我们发现如果邮件正文中有任何内容，附件就会正确发送。

很奇怪，我知道。

试试看，让我们知道。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-07T03:42:16.673

我也遇到了同样的麻烦。我切换到 Jmail，当我从 gmail 读取它时，我的 CSV（文本文件）现在与原始文件完全一样。

我比较了原始邮件（在 Gmail 中，选项 - 查看原始邮件），发现使用 CDO.Message，附件的编码不是很好，它以文本格式保存，邮件客户端可以用它做他想做的事。使用 Jmail，消息以 Base64 编码，因此从头到尾都保持其原始状态。因此，在使用带有文本文件附件的 CDO.Message 时要小心！尝试改用 Jmail（免费）。

CDO.message：内容传输编码：quoted-printable

Jmail.message：内容传输编码：base64

# ddl - 保持参照完整性

> ID：359459
> 
> 赞同：2
> 
> 时间：2008-12-11T14:07:07.030
> 
> 标签：ddl, referential-integrity

给定架构：

```
MACHINE_TYPE { machine_type }
机器{机器，机器类型}
排序计划{排序计划，机器类型}
SCHEDULE { day_of_week, machine, sort_plan }

```

和业务规则：

> 可以将排序计划分配给相同 machine_type 的任何机器。

如何在 SCHEDULE 中强制执行*machine*和*sort_plan*引用的元组具有相同的*machine_type*？

如有必要，可以更改架构。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-11T14:14:45.330

我会在 SCHEDULE 表上使用插入触发器。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-11T14:25:01.267

您可以更改计划表，使其没有 MachineType，并添加一个名为 machinePlan 的新表，其中包含可以使用该计划的每台机器的一行，带有 MachineId 和 PlanId。然后从这个新表的父机器表而不是从计划表本身为计划派生 MachineType。

最后，更改计划表，使其 FK 回到这个新的 MachinePlan 表，而不是您当前拥有的表

```
MACHINE_TYPE { machine_type }
MACHINE { machine, machine_type }
SORT_PLAN { sort_plan}
MACHINE_SORTPLAN {machine, sort_plan }
SCHEDULE { day_of_week, machine_Sortplan } 
```

这还带来了额外的好处，因为您不会不可撤销地为它们适用于哪种机器类型的计划键入规则。您单独保留此关联，如有必要，可以决定使用相同的规则集（相同的计划，用于不止一种机器类型的机器......

# javascript - jQuery 闭包、循环和事件

> ID：359467
> 
> 赞同：9
> 
> 时间：2008-12-11T14:08:24.357
> 
> 标签：javascript, jquery, loops, closures

我有一个与此处类似的问题：[Javascript 循环中的事件处理程序 - 需要闭包吗？](https://stackoverflow.com/questions/341723/event-handlers-inside-a-javascript-loop-need-a-closure#341759)但我正在使用 jQuery，并且给出的解决方案似乎在绑定而不是单击时触发事件。

这是我的代码：

```
for(var i in DisplayGlobals.Indicators)
{
    var div = d.createElement("div");
    div.style.width = "100%";
    td.appendChild(div);

    for(var j = 0;j<3;j++)
    {
        var test = j;
        if(DisplayGlobals.Indicators[i][j].length > 0)
        {   
             var img = d.createElement("img");
             jQuery(img).attr({
                     src : DisplayGlobals.Indicators[i][j],
                     alt : i,
                     className: "IndicatorImage"
              }).click(
                     function(indGroup,indValue){ 
                         jQuery(".IndicatorImage").removeClass("active");
                         _this.Indicator.TrueImage = DisplayGlobals.Indicators[indGroup][indValue];
                         _this.Indicator.FalseImage = DisplayGlobals.IndicatorsSpecial["BlankSmall"];
                         jQuery(this).addClass("active"); 
                     }(i,j)
               );
               div.appendChild(img);   
          }
     }
} 
```

我尝试了几种不同的方法都没有成功...

最初的问题是 _this.Indicator.TrueImage 始终是最后一个值，因为我使用循环计数器而不是参数来选择正确的图像。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-12-11T14:22:55.437

你缺少一个功能。.click 函数需要一个函数作为参数，因此您需要这样做：

```
.click(
    function(indGroup,indValue)
    {
        return function()
        {
            jQuery(".IndicatorImage").removeClass("active");
            _this.Indicator.TrueImage = DisplayGlobals.Indicators[indGroup][indValue];
            _this.Indicator.FalseImage = DisplayGlobals.IndicatorsSpecial["BlankSmall"];
            jQuery(this).addClass("active"); 
        }
    }(i,j);
); 
```

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2010-10-21T17:00:16.283

**Greg**的解决方案仍然有效，但您现在可以通过使用`eventData`jQuery [click](http://api.jquery.com/click/)方法（或[绑定](http://api.jquery.com/bind/)或任何其他事件绑定方法）的参数来实现它，而无需创建额外的闭包。

```
.click({indGroup: i, indValue : j}, function(event) {
    alert(event.data.indGroup);
    alert(event.data.indValue);
    ...
}); 
```

看起来更简单，可能更有效（每次迭代少一个闭包）。

[bind](http://api.jquery.com/bind/)方法的文档有关于事件数据的描述和一些示例。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2011-03-27T01:06:14.290

**只要您使用 jQuery 1.4.3 及更高版本，**Nikita的答案就可以正常工作。**对于此之前的版本（回到 1.0），您必须使用**[bind](http://api.jquery.com/bind/)**，如下所示：**

 **```
.bind('click', {indGroup: i, indValue : j}, function(event) {
    alert(event.data.indGroup);
    alert(event.data.indValue);
    ...
}); 
```

希望这可以帮助其他仍在使用 1.4.2 的人（比如我）

# web-services - 如何验证 Google 身份验证 API 访问令牌？

> ID：359472
> 
> 赞同：165
> 
> 时间：2008-12-11T14:11:04.290
> 
> 标签：web-services, oauth, google-oauth, google-authentication

**如何验证 Google 身份验证访问令牌？**

**我需要以某种方式查询 Google 并询问：[给定访问令牌] 对 [example@example.com] Google 帐户有效吗？**

## 精简版

很明显，通过[Google Authentication Api :: OAuth Authentication for Web Applications](https://code.google.com/apis/accounts/docs/OAuth.html)提供的访问令牌如何用于从一系列 Google 服务请求数据。目前尚不清楚如何检查给定的访问令牌是否对给定的 Google 帐户有效。我想知道怎么做。

## 长版

我正在开发一个使用基于令牌的身份验证的 API。*在提供有效的用户名+密码或提供来自N*个可验证服务中的任何一个的第三方令牌时，将返回一个令牌。

其中一项第三方服务将是 Google，它允许用户使用他们的 Google 帐户对我的服务进行身份验证。稍后将扩展到包括 Yahoo 帐户、受信任的 OpenID 提供商等。

**基于 Google 的访问的示意图示例：**

![替代文字](https://webignition.net/images/figures/auth_figure002.png)

“API”实体在我的完全控制之下。“公共界面”实体是任何基于 Web 或桌面的应用程序。一些公共接口在我的控制之下，其他的不会，还有一些我可能永远都不知道。

因此，我不能信任在第 3 步中提供给 API 的令牌。这将与相应的 Google 帐户电子邮件地址一起提供。

我需要以某种方式查询 Google 并询问：*此访问令牌对 example@example.com 有效*吗？

在这种情况下，example@example.com 是 Google 帐户的唯一标识符 - 某人用于登录其 Google 帐户的电子邮件地址。这不能被假定为 Gmail 地址 - 有人可以拥有 Google 帐户而没有 Gmail 帐户。

Google 文档清楚地说明了如何使用访问令牌从许多 Google 服务中检索数据。似乎没有任何说明如何首先检查给定的访问令牌是否有效。

**更新** 令牌对 N 个 Google 服务有效。我无法针对 Google 服务尝试使用令牌来验证它，因为我不知道给定用户实际使用的所有 Google 服务的哪个子集。

此外，我永远不会使用 Google 身份验证访问令牌来访问任何 Google 服务，只是作为一种验证假定的 Google 用户实际上是他们所说的人的手段。如果有另一种方法可以做到这一点，我很乐意尝试。

* * *

## 回答 #1

> 赞同：167
> 
> 时间：2014-07-09T06:01:59.820

对于用户检查，只需发布​​获取访问令牌作为 accessToken 并发布它并获取响应

```
https://www.googleapis.com/oauth2/v1/tokeninfo?access_token=accessToken 
```

您也可以在浏览器的地址栏中尝试，也可以在 java 中使用 httppost 和 response

反应会像

```
{
     "issued_to": "xxxxxxxxxxxxx-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx.apps.googleusercontent.com",
     "audience": "xxxxxxxxxxxxxxx-xxxxxxxxxxxxxxxxxxxxxxxxxx.apps.googleusercontent.com",
     "user_id": "xxxxxxxxxxxxxxxxxxxxxxx",
     "scope": "https://www.googleapis.com/auth/userinfo.profile https://gdata.youtube.com",
     "expires_in": 3340,
     "access_type": "offline"
    } 
```

范围是 accessToken 的给定权限。[您可以在此链接](https://developers.google.com/oauthplayground/)中检查范围 ID

**更新：** 新的 API 帖子如下

```
https://oauth2.googleapis.com/tokeninfo?id_token=XYZ123 
```

响应将是

```
 {
 // These six fields are included in all Google ID Tokens.
 "iss": "https://accounts.google.com",
 "sub": "110169484474386276334",
 "azp": "1008719970978-hb24n2dstb40o45d4feuo2ukqmcc6381.apps.googleusercontent.com",
 "aud": "1008719970978-hb24n2dstb40o45d4feuo2ukqmcc6381.apps.googleusercontent.com",
 "iat": "1433978353",
 "exp": "1433981953",

 // These seven fields are only included when the user has granted the "profile" and
 // "email" OAuth scopes to the application.
 "email": "testuser@gmail.com",
 "email_verified": "true",
 "name" : "Test User",
 "picture": "https://lh4.googleusercontent.com/-kYgzyAWpZzJ/ABCDEFGHI/AAAJKLMNOP/tIXL9Ir44LE/s99-c/photo.jpg",
 "given_name": "Test",
 "family_name": "User",
 "locale": "en"
} 
```

欲了解更多信息，[https://developers.google.com/identity/sign-in/android/backend-auth](https://developers.google.com/identity/sign-in/android/backend-auth)

* * *

## 回答 #2

> 赞同：67
> 
> 时间：2016-08-02T11:20:52.863

好的，大多数答案都是有效的，但并不完全正确。JWT 的想法是您可以验证令牌，而无需每次都联系颁发者。您必须检查 id 并使用用于签署令牌的证书的已知公钥验证令牌的签名。

请参阅下一篇文章为什么以及如何做到这一点。

[http://ncona.com/2015/02/sumption-a-google-id-token-from-a-server/](http://ncona.com/2015/02/consuming-a-google-id-token-from-a-server/)

* * *

## 回答 #3

> 赞同：40
> 
> 时间：2017-05-26T02:21:57.030

您可以使用此端点验证 Google 身份验证访问令牌：

```
https://www.googleapis.com/oauth2/v3/tokeninfo?access_token=<access_token> 
```

这是 Google V3 OAuth AccessToken 验证端点，您可以参考下面的 google 文档：（在`OAUTH 2.0 ENDPOINTS`Tab 中）

[https://developers.google.com/identity/protocols/OAuth2UserAgent#validate-access-token](https://developers.google.com/identity/protocols/OAuth2UserAgent#validate-access-token)

* * *

## 回答 #4

> 赞同：19
> 
> 时间：2012-05-08T12:35:22.083

```
function authenticate_google_OAuthtoken($user_id)
{
    $access_token   = google_get_user_token($user_id); // get existing token from DB
    $redirecturl    = $Google_Permissions->redirecturl;
    $client_id      = $Google_Permissions->client_id;
    $client_secret  = $Google_Permissions->client_secret;
    $redirect_uri   = $Google_Permissions->redirect_uri;
    $max_results    = $Google_Permissions->max_results;

    $url = 'https://www.googleapis.com/oauth2/v1/tokeninfo?access_token='.$access_token;
    $response_contacts  =  curl_get_responce_contents($url);
    $response   =   (json_decode($response_contacts));

    if(isset($response->issued_to))
    {
        return true;
    }
    else if(isset($response->error))
    {
        return false;
    }
} 
```

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2015-07-23T20:03:38.757

[Google oauth 代码流响应](https://developers.google.com/identity/protocols/OpenIDConnect#exchangecode)还`access_token`返回`id_token`包含对加密形式的验证信息有用的信息。

> 使 ID 令牌有用的一件事是，您可以在应用程序的不同组件中传递它们。这些组件可以使用 ID 令牌作为对应用程序和用户进行身份验证的轻量级身份验证机制。但在您可以使用 ID 令牌中的信息或将其作为用户已通过身份验证的断言之前，您必须对其进行验证。
> 
> 验证 ID 令牌需要几个步骤：

*   验证 ID 令牌是使用适当的 Google 公钥正确签名的 JWT。
*   验证 ID 令牌中的 aud 值是否等于您应用的客户端 ID。
*   验证 ID 令牌中 iss 的值是否等于 accounts.google.com 或[https://accounts.google.com](https://accounts.google.com)。
*   验证 ID 令牌的到期时间 (exp) 是否尚未过去。
*   如果您在请求中传递了 hd 参数，请验证 ID 令牌具有与您的 Google Apps 托管域匹配的 hd 声明。

[https://developers.google.com/identity/protocols/OpenIDConnect#validatinganidtoken](https://developers.google.com/identity/protocols/OpenIDConnect#validatinganidtoken)链接包含用于验证 ID 令牌的代码示例。

另请参阅[https://security.stackexchange.com/questions/37818/why-use-openid-connect-instead-of-plain-oauth](https://security.stackexchange.com/questions/37818/why-use-openid-connect-instead-of-plain-oauth)。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2021-04-05T18:01:20.967

使用以下代码获取用户信息，例如姓名、电子邮件、照片等。

```
https://www.googleapis.com/oauth2/v3/userinfo?access_token=<access token> 
```

使用以下代码获取令牌信息，例如到期时间、令牌范围等。

```
https://www.googleapis.com/oauth2/v3/tokeninfo?access_token=<access token> 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2020-10-17T02:36:37.213

1.  根据 Google 的[文档](https://developers.google.com/identity/sign-in/web/backend-auth#using-a-google-api-client-library)，您应该使用 Google 的 AP 客户端库，这使得这（令牌验证、声明提取等）比编写自己的自定义代码更容易。

2.  从性能的角度来看，应该在本地解析令牌，而无需再次调用 Google。离场谷歌的公钥是必需的，并且该密钥的检索是使用缓存策略完成的，在上面＃1的谷歌客户端库中实现。

3.  仅供参考。Google 还使用 JWT 令牌。请参阅下图以供参考。

[![在此处输入图像描述](https://i.stack.imgur.com/18tuc.png)](https://i.stack.imgur.com/18tuc.png)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-01-12T01:59:34.603

> 我需要以某种方式查询 Google 并询问：此访问令牌对 example@example.com 有效吗？

不需要。您只需为您的 API 域中[的 Google 帐户用户请求标准登录并使用联合登录。](http://code.google.com/intl/uk/apis/accounts/docs/OpenID.html)只有在那之后，您才能将“持久用户 ID”与“公共界面”中的用户 ID 进行比较。

> 在 Google 联合登录页面上使用 realm 的值来向用户识别请求站点。它还用于确定 Google 返回的持久用户 ID 的值。

因此，您需要来自与“公共接口”相同的域。

并且不要忘记用户需要确保您的 API 是可信的；）因此 Google 会询问用户是否允许您检查他的身份。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2015-07-13T03:09:21.347

这是使用[Guzzle](https://github.com/guzzle/guzzle)的示例：

```
/**
 * @param string $accessToken JSON-encoded access token as returned by \Google_Client->getAccessToken() or raw access token
 * @return array|false False if token is invalid or array in the form
 * 
 * array (
 *   'issued_to' => 'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx.apps.googleusercontent.com',
 *   'audience' => 'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx.apps.googleusercontent.com',
 *   'scope' => 'https://www.googleapis.com/auth/calendar',
 *   'expires_in' => 3350,
 *   'access_type' => 'offline',
 * )
 */
public static function tokenInfo($accessToken) {
    if(!strlen($accessToken)) {
        return false;
    }

    if($accessToken[0] === '{') {
        $accessToken = json_decode($accessToken)->access_token;
    }

    $guzzle = new \GuzzleHttp\Client();

    try {
        $resp = $guzzle->get('https://www.googleapis.com/oauth2/v1/tokeninfo', [
            'query' => ['access_token' => $accessToken],
        ]);
    } catch(ClientException $ex) {
        return false;
    }

    return $resp->json();
} 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-02-26T06:51:51.513

[尝试使用您的令牌向https://www.google.com/accounts/AuthSubTokenInfo](https://www.google.com/accounts/AuthSubTokenInfo)发出 OAuth 身份验证请求。这仅被记录为适用于 AuthSub，但它也适用于 OAuth。它不会告诉您令牌适用于哪个用户，但会告诉您它对哪些服务有效，并且如果令牌无效或已被撤销，请求将失败。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-08-28T23:45:18.707

任意 OAuth 访问令牌不能用于身份验证，因为令牌的含义超出了 OAuth 核心规范。它可以用于单次使用或狭窄的过期窗口，也可以提供用户不想提供的访问权限。它也是不透明的，获得它的 OAuth 消费者可能从未见过任何类型的用户标识符。

OAuth 服务提供者和一个或多个消费者可以轻松地使用 OAuth 来提供可验证的身份验证令牌，并且有一些建议和想法可以做到这一点，但是一个只讲 OAuth 核心的任意服务提供者在没有其他合作伙伴的情况下无法提供这个与消费者的协调。Google 特定的 AuthSubTokenInfo REST 方法以及用户的标识符很接近，但它也不合适，因为它可能会使令牌无效，或者令牌可能已过期。

如果您的 Google ID 是 OpenId 标识符，并且您的“公共界面”是网络应用程序或可以调用用户的浏览器，那么您可能应该使用 Google 的 OpenID OP。

OpenID 包括仅将用户发送到 OP 并返回已签名的断言。互动完全是为了 RP 的利益。没有长期存在的令牌或其他特定于用户的句柄可用于指示 RP 已成功通过 OP 对用户进行身份验证。

针对 OpenID 标识符验证先前身份验证的一种方法是再次执行身份验证，假设正在使用相同的用户代理。OP 应该能够在没有用户交互的情况下返回肯定的断言（例如，通过验证 cookie 或客户端证书）。OP 可以自由地要求另一个用户交互，如果身份验证请求来自另一个域，则可能会这样做（我的 OP 让我可以选择重新验证这个特定的 RP，而无需在未来进行交互）。在 Google 的案例中，用户获取 OAuth 令牌所经过的 UI 可能不会使用相同的会话标识符，因此用户必须重新进行身份验证。但无论如何，您都可以断言身份。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2022-02-27T06:14:15.130

检查以下网址。它运作良好。它的官方文件来自谷歌本身。

推荐使用 Google API 客户端库之一（例如 Java、Node.js、PHP、Python）在生产环境中验证 Google ID 令牌。

[https://developers.google.com/identity/sign-in/android/backend-auth#using-a-google-api-client-library](https://developers.google.com/identity/sign-in/android/backend-auth#using-a-google-api-client-library)

# visual-studio-2008 - VS 2008 打开 Word 文档 - 内存错误

> ID：359478
> 
> 赞同：0
> 
> 时间：2008-12-11T14:13:01.493
> 
> 标签：visual-studio-2008, automation, ms-word, ms-office

我正在执行以下在 vs2003(1.1) 中运行良好的代码，但现在我似乎已经决定使用 vs2008(2.0/3.5)：

```
Dim wordApp As Microsoft.Office.Interop.Word.Application
Dim wordDoc As Microsoft.Office.Interop.Word.Document

missing = System.Reflection.Missing.Value
wordApp = New Microsoft.Office.Interop.Word.Application()
Dim wordfile As Object
wordfile = "" ' path and file name goes here

wordDoc = wordApp.Documents.Open(wordfile, missing, missing, missing, missing, missing, missing, missing, missing, missing, missing, missing, missing, missing, missing, missing) 
```

尝试打开时抛出的错误是：“尝试读取或写入受保护的内存。这通常表明其他内存已损坏。”

有谁知道如何纠正这个问题？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-29T14:23:41.820

检查事项：

*   Word 安装是否正常（通过双击打开一个简单的文档是否有效）？
*   没有防病毒工具在运行（也许该工具对 COM 自动化很严格）？

还有一句话：由于您使用的是 VB.Net，因此无需编写所有“缺失”参数，以下代码看起来要简单得多：

```
Dim wordApp As Microsoft.Office.Interop.Word.Application
Dim wordDoc As Microsoft.Office.Interop.Word.Document
Dim wordfile As String

wordApp = New Microsoft.Office.Interop.Word.Application
wordfile = "" ' path and file name goes here

wordDoc = wordApp.Documents.Open(wordfile) 
```

# sql - 经典 ASP 数据库错误

> ID：359492
> 
> 赞同：0
> 
> 时间：2008-12-11T14:19:36.737
> 
> 标签：sql, asp-classic, odbc

好吧，我正在查询我的数据库，一个名为 bookBilling 的表，以获取 billingID 列下的值。

在我的第一个查询中，我根据 cookie 所持有的值从表中获取客户 ID。在我的第二个查询中，我采用该 custID 值，并希望获取与其关联的 billingID。

```
query = "SELECT custID FROM bookSession WHERE session='"&theCookie&"'"
'--Connect to DB'
 Set objConn = ConnectDB()
'--Query to DB'
 Set objRS = objConn.Execute(query)
 custID = objRS.Fields("custID")

  query = "SELECT billingID FROM bookBilling WHERE custID="&custID&""
  objConn.Execute(query) 
```

这就是它成为问题的地方。我尝试使用它来获取值：

```
billingID = objRS.Fields("billingID") 
```

当这不起作用时，我将查询打印到浏览器以确保它正常工作并且返回良好，我在 SQL Server Management Studio 中检查了它以确保。在那之后，我决定尝试一下，发现使用“0”作为参考是有效的，因为它是我表中的第一项。

```
billingID = objRS.Fields(0) 
```

这样就行了，我知道我的表列标题是正确的，我之前已经查看过它并在其他查询中使用过它。有谁知道为什么会发生这种情况？是没有清除我的连接或之后关闭它的结果吗？

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-11T14:31:30.583

无论如何，运行两个单独的查询很慢。将它们组合成一个语句几乎总是更快：

```
SELECT billingID
FROM bookBilling bb
INNER JOIN bookSession bs ON bs.custID=bb.custID
WHERE bs.session= @theCookie 
```

另外：cookies 只是文本文件，任何人都可以编辑文本文件。如果您像这样直接在查询中替换 cookie 值，则可能存在 sql 注入。这不是正常的攻击向量，但仍有可能。

至于您的具体错误，您直接从连接执行第二个查询，而不是在记录集中打开它：

```
objConn.Execute(query) 
```

我很惊讶你什么都得到了，我希望你看到的值`objRS.Fields(0)`可能只是`custID`上一个查询的值。但是，如果您像我推荐的那样整合查询，那么这一切都变得毫无意义。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-11T14:51:26.783

嘿，你没有这个是错字吗？

> query = "SELECT billingID FROM bookBilling WHERE custID="&custID&""
> 
> ***objRS =*** objConn.Execute（查询）

用第二个查询的数据和定义重新加载记录集.....

只是一个想法，首先尝试将 ObjRS 设置/实例化为 Recordset，然后将 query.execute 应用到它之后，而不是与第一个 CustId 查询的初始全合一

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-11T14:53:25.720

```
query = "SELECT billingID FROM bookBilling WHERE custID="&custID&""
objConn.Execute(query) 
```

您没有为第二个查询打开 resordset。而且，不确定这是否有任何影响，但我从不将我的查询命名为相同的。可以肯定的是我猜。

编辑，这就是我上面的人所说的，我是一个慢吞吞的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-11T14:56:23.810

该死，是的，这是一个错字。我不确定我是否理解为什么它仍然使用列号而不是列名，即使我没有打开记录集。

@Joel Coehoorn 感谢您提供有关内部加入查询的信息。我的老师一直在告诉我们这样做，但直到我看到它，我才真正理解它。

对于我的表，我不能真正使用它，因为注册时不一定有 billingID，所以我偶尔会遇到一些“EOF”。

谢谢大家！

# javascript - 在 JavaScript 比较中应该使用哪个等号运算符（== vs ===）？

> ID：359494
> 
> 赞同：5656
> 
> 时间：2008-12-11T14:19:49.123
> 
> 标签：javascript, operators, equality, equality-operator, identity-operator

我正在使用[JSLint](http://en.wikipedia.org/wiki/JSLint)来浏览 JavaScript，并且在执行诸如比较语句内部之类的操作时，它会返回许多建议以将`==`（两个等号）替换为（三个等号）。`===``idSele_UNVEHtype.value.length == 0``if`

`==`替换为 有性能优势`===`吗？

由于存在许多比较运算符，因此欢迎任何性能改进。

如果不进行类型转换，是否会提高性能`==`？

* * *

## 回答 #1

> 赞同：6941
> 
> 时间：2008-12-11T14:25:06.430

严格相等运算符 ( `===`) 的行为与抽象相等运算符 ( `==`) 相同，只是不进行类型转换，并且类型必须相同才能被视为相等。

参考：[Javascript 教程：比较运算符](http://www.c-point.com/javascript_tutorial/jsgrpComparison.htm)

运算符将*在进行任何必要的类型转换后*`==`比较是否相等。运算符**不会**进行转换，因此如果两个值的类型不同，将简单地返回。两者都同样快。*`===`**`===``false`***

 ***引用 Douglas Crockford 的优秀[JavaScript: The Good Parts 的](https://rads.stackoverflow.com/amzn/click/com/0596517742)话，

> JavaScript 有两组相等运算符：`===`and `!==`，以及它们的邪恶双胞胎`==`and `!=`。好的工作按您期望的方式工作。如果两个操作数类型相同且值相同，则`===`产生`true`和`!==`产生`false`。当操作数是相同类型时，邪恶双胞胎会做正确的事情，但如果它们是不同类型，它们会尝试强制值。他们这样做的规则既复杂又难以忘怀。这些是一些有趣的案例：
> 
> ```
> '' == '0'           // false
> 0 == ''             // true
> 0 == '0'            // true
> 
> false == 'false'    // false
> false == '0'        // true
> 
> false == undefined  // false
> false == null       // false
> null == undefined   // true
> 
> ' \t\r\n ' == 0     // true 
> ```

[![平等比较表](https://i.stack.imgur.com/yISob.png)](https://i.stack.imgur.com/yISob.png)

> 缺乏传递性令人担忧。我的建议是永远不要使用邪恶的双胞胎。相反，请始终使用`===`and `!==`。刚才显示的所有比较都是由操作员产生`false`的`===`。

* * *

### 更新：

[@Casebash](https://stackoverflow.com/users/165495/casebash)在评论和[@Phillipe Laybaert](https://stackoverflow.com/users/113570/philippe-leybaert) 关于对象的[回答](https://stackoverflow.com/a/957602/1288)中提出了一个很好的观点。对于对象，`==`并且`===`彼此一致（特殊情况除外）。

```
var a = [1,2,3];
var b = [1,2,3];

var c = { x: 1, y: 2 };
var d = { x: 1, y: 2 };

var e = "text";
var f = "te" + "xt";

a == b            // false
a === b           // false

c == d            // false
c === d           // false

e == f            // true
e === f           // true 
```

特殊情况是当您将一个原语与一个对象进行比较时，由于其`toString`or`valueOf`方法，该对象的计算结果为相同的原语。例如，考虑将字符串原语与使用`String`构造函数创建的字符串对象进行比较。

```
"abc" == new String("abc")    // true
"abc" === new String("abc")   // false 
```

在这里，`==`操作员检查两个对象的值并返回`true`，但`===`看到它们的类型不同并返回`false`。哪一个是正确的？这实际上取决于您要比较的内容。我的建议是完全绕过这个问题，只是不要使用`String`构造函数从字符串文字创建字符串对象。

**参考**
[http://www.ecma-international.org/ecma-262/5.1/#sec-11.9.3](http://www.ecma-international.org/ecma-262/5.1/#sec-11.9.3)

* * *

## 回答 #2

> 赞同：1214
> 
> 时间：2008-12-11T14:33:58.317

使用`==`运算符（*平等*）

```
true == 1; //true, because 'true' is converted to 1 and then compared
"2" == 2;  //true, because "2" is converted to 2 and then compared 
```

使用`===`运算符 ( *Identity* )

```
true === 1; //false
"2" === 2;  //false 
```

这是因为**相等运算符`==`确实键入 coercion**，这意味着解释器会在比较之前隐式尝试转换值。

另一方面，**身份运算符`===`不执行类型强制**，因此在比较时不转换值，因此跳过一个步骤，因此速度更快（根据[This JS benchmark](http://jsben.ch/JUOm2) test）。

* * *

## 回答 #3

> 赞同：837
> 
> 时间：2014-05-05T05:21:25.513

`==`这是和之间相等比较的有趣可视化`===`。

**来源：[https](https://github.com/dorey/JavaScript-Equality-Table)** ://github.com/dorey/JavaScript-Equality-Table （[demo](https://dorey.github.io/JavaScript-Equality-Table/)，[统一demo](https://dorey.github.io/JavaScript-Equality-Table/unified/)）

* * *

## `var1 === var2`

当`===`用于 JavaScript 相等性测试时，一切都保持原样。
在评估之前没有任何东西被转换。

![JS中===的平等评价](https://i.stack.imgur.com/62vxI.png)

## `var1 == var2`

当`==`用于 JavaScript 相等测试时，会发生一些***时髦的转换***。

![JS中==的平等评价](https://i.stack.imgur.com/35MpY.png)

### Javascript中的相等总结

![Javascript中的平等](https://i.stack.imgur.com/FX7z1.png)

* * *

### 结论：

除非您完全理解发生的[时髦转换](https://dorey.github.io/JavaScript-Equality-Table/#two-equals)，否则`==`请**始终使用`===`.**

* * *

## 回答 #4

> 赞同：646
> 
> 时间：2009-06-05T19:11:36.920

在这里的答案中，我没有读到任何关于**平等**的意思。有人会说这`===`意味着**相等且属于同一类型**，但事实并非如此。这实际上意味着**两个操作数都引用同一个对象**，或者在**值类型的情况下，具有相同的值**。

因此，让我们采用以下代码：

```
var a = [1,2,3];
var b = [1,2,3];
var c = a;

var ab_eq = (a === b); // false (even though a and b are the same type)
var ac_eq = (a === c); // true 
```

这里也是：

```
var a = { x: 1, y: 2 };
var b = { x: 1, y: 2 };
var c = a;

var ab_eq = (a === b); // false (even though a and b are the same type)
var ac_eq = (a === c); // true 
```

甚至：

```
var a = { };
var b = { };
var c = a;

var ab_eq = (a === b); // false (even though a and b are the same type)
var ac_eq = (a === c); // true 
```

这种行为并不总是很明显。这个故事不仅仅是平等和同一类型。

规则是：

***对于值类型（数字）：***如果和具有相同的值并且属于相同的类型，则
`a === b`返回 true`a``b`

***对于引用类型：***如果和引用完全相同的对象
`a === b`则返回 true`a``b`

***对于字符串：***如果和都是字符串并且包含完全相同的字符
`a === b`返回 true`a``b`

* * *

## 字符串：特殊情况...

字符串不是值类型，但在 Javascript 中它们的行为类似于值类型，因此当字符串中的字符相同且长度相同时，它们将“相等”（如第三条规则中所述）

现在变得有趣了：

```
var a = "12" + "3";
var b = "123";

alert(a === b); // returns true, because strings behave like value types 
```

但是这个怎么样？：

```
var a = new String("123");
var b = "123";

alert(a === b); // returns false !! (but they are equal and of the same type) 
```

我认为字符串的行为类似于值类型？好吧，这取决于你问谁......在这种情况下，a 和 b 不是同一类型。`a`是类型`Object`，`b`而是类型`string`。请记住，使用`String`构造函数创建字符串对象会创建在*大多数情况下*`Object`表现为字符串的类型。

 ** * *

## 回答 #5

> 赞同：281
> 
> 时间：2009-11-28T18:18:00.283

让我补充一下这个忠告：

***如有疑问，请阅读[规范](http://www.ecma-international.org/publications/standards/Ecma-262.htm)！***

ECMA-262 是一种脚本语言规范，JavaScript 是其方言。当然，在实践中，最重要的浏览器的行为方式比对应该如何处理某事的深奥定义更重要。但是理解为什么**new String("a") !== "a"**会很有帮助。

请让我解释如何阅读规范以澄清这个问题。我看到在这个非常古老的话题中，没有人对非常奇怪的效果有答案。因此，如果您能阅读规范，这将对您的职业有极大的帮助。这是一种后天习得的技能。所以，让我们继续。

在 PDF 文件中搜索 === 会将我带到规范的第 56 页：**11.9.4。Strict Equals Operator ( === )**，经过规范后，我发现：

> **11.9.6 严格等式比较算法**
> 比较 x === y，其中 x 和 y 是值，产生**true**或**false**。这样的比较执行如下：
>   1\. 如果 Type(x) 与 Type(y) 不同，则返回**false**。
>   2\. 如果 Type(x) 未定义，则返回**true**。
>   3\. 如果 Type(x) 为 Null，则返回**true**。
>   4\. 如果 Type(x) 不是 Number，转到步骤 11。
>   5\. 如果 x 是**NaN**，返回**false**。
>   6\. 如果 y 是**NaN**，则返回**false**。
>   7\. 如果 x 与 y 的数值相同，则返回**true**。
>   8\. 如果 x 为 +0 且 y 为 -0，则返回**true**。
>   9\. 如果 x 为 -0 且 y 为 +0，则返回**true**。
>   10.返回**假**。
>   11.如果Type(x)是String，那么如果x和y是完全相同的字符序列（长度相同，对应位置的字符相同），则返回**true ；**否则，返回**false**。
>   12\. 如果 Type(x) 是 Boolean，如果 x 和 y 都为**真**或都为**假，则返回****真**；否则，返回**false**。   13\. 返回**真** ********如果 x 和 y 指的是同一个对象，或者如果它们指的是相互连接的对象（见 13.1.2）。否则，返回**false**。********

 ****有趣的是第 11 步。是的，字符串被视为值类型。但这并不能解释为什么**new String("a") !== "a"**。我们是否有不符合 ECMA-262 的浏览器？

没那么快！

让我们检查操作数的类型。**通过将它们包装在typeof()**中自己尝试一下。我发现**new String("a")**是一个对象，使用第 1 步：如果类型不同则返回**false 。**

如果您想知道为什么**new String("a")**不返回字符串，那么来做一些阅读规范的练习怎么样？玩得开心！

* * *

Aidiakapi 在下面的评论中写道：

> 从规范
> 
> **11.2.2 新运营商**：
> 
> 如果 Type(constructor) 不是 Object，则抛出 TypeError 异常。
> 
> 换句话说，如果 String 不是 Object 类型，它就不能与 new 运算符一起使用。

**new**总是返回一个 Object，即使对于**String**构造函数也是如此。唉！字符串的值语义（参见步骤 11）丢失。

这最终意味着：**new String("a") !== "a"**。

* * *

## 回答 #6

> 赞同：109
> 
> 时间：2008-12-25T11:17:35.473

我使用这样的代码在 Firefox 中使用[Firebug](http://en.wikipedia.org/wiki/Firebug_%28software%29)进行了测试：

```
console.time("testEquality");
var n = 0;
while (true) {
  n++;
  if (n == 100000)
    break;
}
console.timeEnd("testEquality");
```

和

```
console.time("testTypeEquality");
var n = 0;
while (true) {
  n++;
  if (n === 100000)
    break;
}
console.timeEnd("testTypeEquality");
```

我的结果（每次测试五次并取平均值）：

```
==: 115.2
===: 114.4 
```

所以我想说微小的差异（这是超过 100000 次迭代，记住）可以忽略不计。性能***不是***这样做的理由`===`。类型安全（好吧，就像你将在 JavaScript 中获得的一样安全），代码质量也是如此。

* * *

## 回答 #7

> 赞同：105
> 
> 时间：2010-05-12T12:58:39.810

在 PHP 和 JavaScript 中，它是一个严格的相等运算符。这意味着，它将比较类型和值。

* * *

## 回答 #8

> 赞同：101
> 
> 时间：2010-05-12T12:58:24.723

在 JavaScript 中，它意味着相同的值和类型。

例如，

```
4 == "4" // will return true 
```

但

```
4 === "4" // will return false 
```

* * *

## 回答 #9

> 赞同：92
> 
> 时间：2016-08-09T16:50:12.523

**为什么`==`如此不可预测？**

当您将空字符串`""`与数字零进行比较时，您会得到什么`0`？

`true`

是的，根据`==`空字符串和数字零是相同的时间是正确的。

它并没有就此结束，这是另一个：

```
'0' == false // true 
```

**数组的事情变得非常奇怪。**

```
[1] == true // true
[] == false // true
[[]] == false // true
[0] == false // true 
```

**然后用字符串更奇怪**

```
[1,2,3] == '1,2,3' // true - REALLY?!
'\r\n\t' == 0 // true - Come on! 
```

情况变得更糟：

**什么时候相等不相等？**

```
let A = ''  // empty string
let B = 0   // zero
let C = '0' // zero string

A == B // true - ok... 
B == C // true - so far so good...
A == C // **FALSE** - Plot twist! 
```

让我再说一遍：

```
(A == B) && (B == C) // true
(A == C) // **FALSE** 
```

这只是你用原语得到的疯狂的东西。

`==`与对象一起使用时，这是一个全新的疯狂水平。

在这一点上，您可能想知道...

**为什么会这样？**

嗯，这是因为与“三等号”( `===`) 不同，它只检查两个值是否相同。

`==`做了***一大堆其他的事情***。

它对函数有特殊处理，对空值、未定义、字符串有特殊处理，你可以命名它。

它变得很古怪。

事实上，如果你试图编写一个函数来完成它的工作，`==`它看起来像这样：

```
function isEqual(x, y) { // if `==` were a function
    if(typeof y === typeof x) return y === x;
    // treat null and undefined the same
    var xIsNothing = (y === undefined) || (y === null);
    var yIsNothing = (x === undefined) || (x === null);

    if(xIsNothing || yIsNothing) return (xIsNothing && yIsNothing);

    if(typeof y === "function" || typeof x === "function") {
        // if either value is a string 
        // convert the function into a string and compare
        if(typeof x === "string") {
            return x === y.toString();
        } else if(typeof y === "string") {
            return x.toString() === y;
        } 
        return false;
    }

    if(typeof x === "object") x = toPrimitive(x);
    if(typeof y === "object") y = toPrimitive(y);
    if(typeof y === typeof x) return y === x;

    // convert x and y into numbers if they are not already use the "+" trick
    if(typeof x !== "number") x = +x;
    if(typeof y !== "number") y = +y;
    // actually the real `==` is even more complicated than this, especially in ES6
    return x === y;
}

function toPrimitive(obj) {
    var value = obj.valueOf();
    if(obj !== value) return value;
    return obj.toString();
} 
```

**那么这是什么意思？**

意思`==`是复杂。

因为它很复杂，所以很难知道使用它时会发生什么。

这意味着您最终可能会遇到错误。

**所以这个故事的寓意是……**

让你的生活不那么复杂。

使用`===`而不是`==`.

结束。

* * *

## 回答 #10

> 赞同：91
> 
> 时间：2008-12-11T14:58:51.417

**===**运算符称为严格比较运算符，它确实**不同于**==**运算**符。

让我们取 2 个变量 a 和 b。

对于**"a == b"**评估为真 a 和 b 需要是**相同的 value**。

在**“a === b”**的情况下， a 和 b 必须是**相同的值**和**相同的类型**才能评估为真。

举个例子

```
var a = 1;
var b = "1";

if (a == b) //evaluates to true as a and b are both 1
{
    alert("a == b");
}

if (a === b) //evaluates to false as a is not the same type as b
{
    alert("a === b");
} 
```

**总之**; 在您不希望使用 == 运算符的情况下，使用**==运算符可能会评估为 true，因此使用****===**运算符会更安全。

在 90% 的使用场景中，你使用哪一个并不重要，但是当你有一天遇到一些意想不到的行为时，很容易知道其中的区别。

* * *

## 回答 #11

> 赞同：86
> 
> 时间：2010-05-12T12:58:12.090

# `===`*检查相同边的类型*和*值*是否相等。

* * *

## 例子：

```
'1' === 1 // will return "false" because `string` is not a `number` 
```

## 常见示例：

```
0 == ''  // will be "true", but it's very common to want this check to be "false" 
```

## 另一个常见的例子：

```
null == undefined // returns "true", but in most cases a distinction is necessary 
```

* * *

很多时候，*无类型*检查会很方便 ，因为您不在乎值是`undefined`,`null`还是`0``""`

* * *

## 回答 #12

> 赞同：75
> 
> 时间：2015-09-05T13:53:16.283

严格相等/比较'==='的Javascript执行流程图

[![Javascript 严格相等](https://i.stack.imgur.com/A27Be.png)](https://i.stack.imgur.com/A27Be.png)

非严格相等/比较'=='的Javascript执行流程图

[![Javascript 不相等](https://i.stack.imgur.com/Ccyb8.png)](https://i.stack.imgur.com/Ccyb8.png)

* * *

## 回答 #13

> 赞同：57
> 
> 时间：2013-07-03T04:08:25.257

JavaScript`===` **与** `==`.

```
0==false   // true
0===false  // false, because they are of a different type
1=="1"     // true, auto type coercion
1==="1"    // false, because they are of a different type 
```

* * *

## 回答 #14

> 赞同：56
> 
> 时间：2010-05-12T12:59:09.960

这意味着**没有类型强制的相等** 类型强制意味着 JavaScript 不会自动将任何其他数据类型转换为字符串数据类型

```
0==false   // true,although they are different types

0===false  // false,as they are different types

2=='2'    //true,different types,one is string and another is integer but 
            javaScript convert 2 to string by using == operator 

2==='2'  //false because by using === operator ,javaScript do not convert 
           integer to string 

2===2   //true because both have same value and same types 
```

* * *

## 回答 #15

> 赞同：50
> 
> 时间：2008-12-16T14:29:16.423

在典型的脚本中不会有性能差异。更重要的可能是千个“===”比千个“==”重 1 KB :) [JavaScript 分析器](https://stackoverflow.com/questions/tagged/javascript+performance)可以告诉您在您的情况下是否存在性能差异。

但就我个人而言，我会按照 JSLint 的建议去做。这个建议不是因为性能问题，而是因为类型强制意味着`('\t\r\n' == 0)`是真的。

* * *

## 回答 #16

> 赞同：48
> 
> 时间：2011-09-16T14:25:11.027

***相等比较运算符 == 令人困惑，应避免使用。***

如果您必须**忍受**它，请记住以下三件事：

1.  **它不是传递的：*(a == b)*和*(b == c)*不会导致*(a == c)***
2.  **它与其否定互斥：*(a == b)*和*(a != b)*始终保持相反的布尔值，所有 a 和 b。**
3.  **如有疑问，请记住以下真值表：**

JAVASCRIPT 中的相等运算符真值表

*   表中的每一行都是一组 3 个相互“相等”的值，这意味着它们中的任何 2 个值都使用等号 == 符号*

**奇怪：请注意，第一列上的任何两个值在这个意义上都不相等。**

```
''       == 0 == false   // Any two values among these 3 ones are equal with the == operator
'0'      == 0 == false   // Also a set of 3 equal values, note that only 0 and false are repeated
'\t'     == 0 == false   // -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
'\r'     == 0 == false   // -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
'\n'     == 0 == false   // -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
'\t\r\n' == 0 == false   // -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --

null == undefined  // These two "default" values are not-equal to any of the listed values above
NaN                // NaN is not equal to any thing, even to itself. 
```

* * *

## 回答 #17

> 赞同：41
> 
> 时间：2008-12-11T14:44:55.783

在您的使用中，这两个操作之间不太可能有任何性能差异。无需进行类型转换，因为两个参数已经是相同的类型。这两个操作都有一个类型比较，然后是一个值比较。

* * *

## 回答 #18

> 赞同：39
> 
> 时间：2014-11-14T06:02:51.787

**是的！**这很重要。

`===`javascript 中的运算符**检查值和类型**，其中`==`运算符只检查**值（如果需要，进行类型转换）**。

![在此处输入图像描述](https://i.stack.imgur.com/5ttlR.png)

您可以轻松地对其进行测试。将以下代码粘贴到 HTML 文件中并在浏览器中打开

```
<script>

function onPageLoad()
{
    var x = "5";
    var y = 5;
    alert(x === 5);
};

</script>

</head>

<body onload='onPageLoad();'> 
```

您将在警报中收到“**错误”。**现在修改`onPageLoad()`方法，`alert(x == 5);`你会得到**true**。

* * *

## 回答 #19

> 赞同：39
> 
> 时间：2015-03-20T05:05:48.057

简单地

`==`表示操作数之间**的**类型强制**比较**

 **和

`===`表示**没有**类型强制的操作数之间的**比较。**

 **JavaScript 中的类型强制意味着自动将数据类型转换为其他数据类型。

例如：

```
123 == "123"  // Returns true, because JS coerces string "123" to number 123
              // and then goes on to compare `123 == 123`.

123 === "123" // Returns false, because JS does not coerce values of different types here. 
```

* * *

## 回答 #20

> 赞同：34
> 
> 时间：2010-05-12T13:03:37.447

`===`运算符检查值以及变量的类型是否相等。

`==`运算符只检查变量的值是否相等。

* * *

## 回答 #21

> 赞同：34
> 
> 时间：2010-05-12T13:19:21.230

这是一个严格的检查测试。

这是一件好事，尤其是当您在 0 和 false 和 null 之间进行检查时。

例如，如果您有：

```
$a = 0; 
```

然后：

```
$a==0; 
$a==NULL;
$a==false; 
```

全部返回 true，您可能不希望这样。假设您有一个函数可以返回数组的第 0 个索引或在失败时返回 false。如果你用“==”检查，你会得到一个令人困惑的结果。

所以和上面一样，但是经过严格的测试：

```
$a = 0;

$a===0; // returns true
$a===NULL; // returns false
$a===false; // returns false 
```

* * *

## 回答 #22

> 赞同：33
> 
> 时间：2012-06-05T07:53:04.983

JSLint 有时会给你不切实际的理由来修改东西。具有与类型已经相同的`===`完全相同的性能。`==`

只有当类型不同时它才会更快，在这种情况下它不会尝试转换类型而是直接返回false。

因此，*恕我直言，* JSLint 可能用于编写新代码，但应不惜一切代价避免无用的过度优化。

这意味着，当您知道 a 只能是字符串这一事实时，没有理由更改`==`为`===`检查。`if (a == 'test')`

以这种方式修改大量代码会浪费开发人员和审阅者的时间，而且一无所获。

* * *

## 回答 #23

> 赞同：33
> 
> 时间：2013-04-27T14:15:38.290

根据经验，我通常会使用`===`代替`==`（和`!==`代替`!=`）。

原因在上面的答案中进行了解释，Douglas Crockford 也很清楚（[JavaScript：The Good Parts](https://rads.stackoverflow.com/amzn/click/com/0596517742)）。

但是有**一个例外**： `== null`是一种检查“为空或未定义”的有效方法：

```
if( value == null ){
    // value is either null or undefined
} 
```

例如 jQuery 1.9.1 使用这种模式 43 次，[JSHint 语法检查器](http://www.jshint.com/docs/#options)甚至`eqnull`为此提供了放松选项。

来自[jQuery 风格指南](http://contribute.jquery.org/style-guide/js/)：

> 应该使用严格的相等检查 (===) 来支持 ==。唯一的例外是在通过 null 检查未定义和 null 时。

```
// Check for both undefined and null values, for some important reason. 
undefOrNull == null; 
```

编辑 2021-03：

现在[大多数浏览器都](https://caniuse.com/mdn-javascript_operators_logical_nullish_assignment) 支持[Nullish 合并运算符 ( `??`)](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Nullish_coalescing_operator) 和[Logical nullish assignment`(??=)`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Logical_nullish_assignment)，如果变量为 null 或未定义，则可以更简洁地分配默认值，例如：

```
if (a.speed == null) {
  // Set default if null or undefined
  a.speed = 42;
} 
```

可以写成这些形式中的任何一种

```
a.speed ??= 42;
a.speed ?? a.speed = 42;
a.speed = a.speed ?? 42; 
```

* * *

## 回答 #24

> 赞同：28
> 
> 时间：2015-05-14T14:45:00.333

一个简单的例子是

```
2 == '2'  -> true, values are SAME because of type conversion.

2 === '2'  -> false, values are NOT SAME because of no type conversion. 
```

* * *

## 回答 #25

> 赞同：26
> 
> 时间：2013-09-09T08:31:45.250

前 2 个答案都提到 == 表示平等， === 表示身份。不幸的是，这种说法是不正确的。

如果 == 的两个操作数都是对象，则比较它们是否是同一个对象。如果两个操作数都指向同一个对象，则等号运算符返回 true。否则，两者不相等。

```
var a = [1, 2, 3];  
var b = [1, 2, 3];  
console.log(a == b)  // false  
console.log(a === b) // false 
```

在上面的代码中，== 和 === 都为 false，因为 a 和 b 不是同一个对象。

也就是说：如果 == 的两个操作数都是对象，那么 == 的行为与 === 相同，这也意味着身份。这两个运算符的本质区别在于类型转换。== 在检查相等性之前进行了转换，但 === 没有。

* * *

## 回答 #26

> 赞同：23
> 
> 时间：2008-12-29T11:54:44.320

问题是你可能很容易遇到麻烦，因为 JavaScript 有很多隐式转换意味着......

```
var x = 0;
var isTrue = x == null;
var isFalse = x === null; 
```

这很快就会成为一个问题。可以从[MFC](http://en.wikipedia.org/wiki/Microsoft_Foundation_Class_Library) / C++ 中的这段代码中获取为什么隐式转换是“邪恶”的最佳示例，由于从 CString 到 HANDLE 的隐式转换，它实际上将编译，这是一个指针 typedef 类型......

```
CString x;
delete x; 
```

这显然在运行时做*了非常*未定义的事情......

谷歌在 C++ 和[STL](http://en.wikipedia.org/wiki/Standard_Template_Library)中进行隐式转换以获得一些反对它的论点......

* * *

## 回答 #27

> 赞同：23
> 
> 时间：2010-05-12T12:59:13.563

来自[核心 javascript 参考](https://developer.mozilla.org/en/Core_JavaScript_1.5_Reference/Operators/Comparison_Operators)

> `===``true`如果操作数严格相等（见上文）且没有类型转换，则返回。

* * *

## 回答 #28

> 赞同：22
> 
> 时间：2013-10-02T21:54:43.567

**平等比较：**

操作员`==`

当两个操作数相等时返回真。在比较之前，操作数被转换为相同的类型。

```
>>> 1 == 1
true
>>> 1 == 2
false
>>> 1 == '1'
true 
```

**相等和类型比较：**

操作员`===`

如果两个操作数相等且类型相同，则返回 true。如果以这种方式进行比较，通常会更好、更安全，因为没有幕后的类型转换。

```
>>> 1 === '1'
false
>>> 1 === 1
true 
```

* * *

## 回答 #29

> 赞同：21
> 
> 时间：2014-03-27T00:18:06.257

`==`这是一个方便的比较表，显示了发生的转换以及和之间的差异`===`。

正如结论所说：

> “除非您完全理解二等式的转换，否则请使用三等式。”

[http://dorey.github.io/JavaScript-Equality-Table/](http://dorey.github.io/JavaScript-Equality-Table/)

* * *

## 回答 #30

> 赞同：21
> 
> 时间：2014-04-14T09:28:25.317

null 和 undefined 是虚无，也就是说，

```
var a;
var b = null; 
```

这里`a`并`b`没有值。而 0、false 和 '' 都是值。所有这些之间的共同点是它们都是虚假值，这意味着它们都**满足**虚假条件。

所以，0、false 和 '' 一起构成了一个子组。另一方面， null & undefined 形成第二个子组。检查下图中的比较。null 和 undefined 将相等。其他三个将彼此相等。但是，它们在 JavaScript 中都被视为虚假条件。

![在此处输入图像描述](https://i.stack.imgur.com/11I0i.jpg)

这与任何对象（如 {}、数组等）相同，非空字符串和布尔值 true 都是真值条件。但是，它们都不是平等的。

* * *

## 回答 #31

> 赞同：18
> 
> 时间：2014-03-19T12:08:11.163

****运算符 === 与 == ****

```
1 == true    =>    true
true == true    =>    true
1 === true    =>    false
true === true    =>    true 
```

* * *

## 回答 #32

> 赞同：18
> 
> 时间：2014-08-08T16:52:43.807

JavaScript 既有严格的比较，也有类型转换的比较。严格比较（例如`===`）仅在操作数属于同一类型时才成立。更常用的抽象比较（例如`==`）在进行比较之前将操作数转换为相同的类型。

*   `==`如果操作数不是同一类型，则相等 ( ) 运算符转换操作数，然后应用严格比较。如果任一操作数是数字或布尔值，则尽可能将操作数转换为数字；否则，如果任一操作数是字符串，则尽可能将字符串操作数转换为数字。如果两个操作数都是对象，那么当操作数引用内存中的同一个对象时，JavaScript 会比较相等的内部引用。

    句法：

    `x == y`

    例子：

    ```
    3 == 3     // true
    "3" == 3   // true
    3 == '3'   // true 
    ```

*   `===`如果操作数严格相等（见上文）且没有类型转换，则标识/严格相等（ ）运算符返回 true。

    句法：

    `x === y`

    例子：

    `3 === 3 // true`

供参考：*[比较运算符](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Comparison_Operators)*（Mozilla 开发者网络）

* * *

## 回答 #33

> 赞同：17
> 
> 时间：2014-11-28T20:06:49.420

如果您正在制作 Web 应用程序或安全页面，则应始终使用（仅在可能的情况下）

```
=== 
```

因为它会检查它是否是相同的内容以及它是否是相同的类型！

所以当有人进入时：

```
var check = 1;
if(check == '1') {
    //someone continued with a string instead of number, most of the time useless for your webapp, most of the time entered by a user who does not now what he is doing (this will sometimes let your app crash), or even worse it is a hacker searching for weaknesses in your webapp!
} 
```

但与

```
var check = 1;
if(check === 1) {
    //some continued with a number (no string) for your script
} else {
    alert('please enter a real number');
} 
```

黑客永远不会深入系统来发现错误并破解您的应用程序或用户

我的观点是

```
=== 
```

将为您的脚本增加更多安全性

当然，您也可以检查输入的数字是否有效，是否为字符串等。在第一个示例中使用其他 if 语句，但这至少对我来说更容易理解和使用

我发布此内容的原因是，在此对话中从未提及“更安全”或“安全”一词（如果您查看 iCloud.com，它使用 2019 次 === 和 1308 次 ==，这也意味着您有时使用 == 而不是 === 因为它会阻塞你的功能，但正如开头所说，你应该尽可能使用 ===）

* * *

## 回答 #34

> 赞同：13
> 
> 时间：2015-08-06T05:44:24.543

我的推理过程使用 emacs org-mode 和 node.js 运行测试。

```
| use ==     | '' | '0' | false | 'false' | undefined | null | ' \t\r\n ' |
| ''         | x  | f   | t     | f       | f         | f    | f          |
| '0'        |    | x   | t     | f       | f         | f    | f          |
| false      |    |     | x     | f       | f         | f    | t          |
| 'false'    |    |     |       | x       | f         | f    | f          |
| undefined  |    |     |       |         | x         | t    | f          |
| null       |    |     |       |         |           | x    | f          |
| ' \t\r\n ' |    |     |       |         |           |      | x          | 

| use ===    | '' | '0' | false | 'false' | undefined | null | ' \t\r\n ' |
| ''         | x  | f   | f     | f       | f         | f    | f          |
| '0'        |    | x   | f     | f       | f         | f    | f          |
| false      |    |     | x     | f       | f         | f    | f          |
| 'false'    |    |     |       | x       | f         | f    | f          |
| undefined  |    |     |       |         | x         | f    | f          |
| null       |    |     |       |         |           | x    | f          |
| ' \t\r\n ' |    |     |       |         |           |      | x          | 
```

我的测试脚本如下： run > node xxx.js

```
var rowItems = ['', '0', false, 'false', undefined, null, ' \t\r\n ']
var colItems = rowItems

for(var i = 0; i < rowItems.length; i++) {
    for (var j = 0; j < colItems.length; j++) {
        var r = (rowItems[i] === colItems[j]) ? true : false;
        console.log(rowItems[i] + " = " + colItems[j] + " " + r + " [" + i + "] ==> [" + j + "]")
    };
} 
```

* * *

## 回答 #35

> 赞同：12
> 
> 时间：2015-03-29T21:48:22.663

`===`关心对象是否相同。因此，`new String("Hello world") === "Hello world"`返回 false。但是，`==`不关心对象是否相同；它只是简单地将一个参数转换为另一个参数的类型：如果无法转换，则返回 false。然后`new String("Hello world") == "Hello world"`返回 true 而不是 false。

* * *

## 回答 #36

> 赞同：11
> 
> 时间：2015-07-22T13:28:42.450

javascript 是一种**弱类型语言**，即没有任何数据类型，例如 C、c++。int、boolean、float 等，因此变量可以保存任何类型的值，这就是为什么这些特殊的比较运算符存在的原因

例如

```
var i = 20;var j = "20"; 
```

如果我们应用比较运算符，这些变量的结果将是

```
i==j //result is true 
```

或者

```
j != i//result is false 
```

为此，我们需要一个特殊的比较运算符来检查变量的**值和数据类型**

如果我们这样做

```
i===j //result is false 
```

* * *

## 回答 #37

> 赞同：10
> 
> 时间：2017-04-28T04:55:20.440

`==`运算符只比较值而不是数据类型。

`===`运算符将值与其数据类型的比较进行比较。

例如：

```
1 == "1" //true

1 === "1" //false 
```

此运算符 ( `"==="`) 用于执行自动类型转换的语言，例如。PHP, Javascript。
`"==="`运算符有助于防止由自动类型转换引起的意外比较。

* * *

## 回答 #38

> 赞同：8
> 
> 时间：2017-06-25T10:21:33.693

> 不同的介于`=`, `= =`,`= = =`

*   `=`运算符用于仅分配`value`.
*   `= =`运算符用于仅比较`values`非`datatype`
*   `= = =`运算符用于比较`values`以及`datatype`。

* * *

## 回答 #39

> 赞同：7
> 
> 时间：2016-07-01T13:29:08.937

**总是**使用' **​​===** '，你会避免成千上万的错误。如今，不同的风格指南更倾向于使用**三等**式，因为它比较考虑了操作数的类型。

* * *

## 回答 #40

> 赞同：5
> 
> 时间：2016-01-04T13:26:38.350

`==`是的，相等和身份运算符之间存在很大差异`===`。
通常身份运算符执行得更快，因为没有进行类型转换。但是，如果这些值属于同一类型，您将看不到任何区别。
查看我的帖子[The legend of JavaScript equal operator](http://rainsoft.io/the-legend-of-javascript-equality-operator/)，其中解释了细节，包括类型转换和比较算法，并附有大量示例。

* * *

## 回答 #41

> 赞同：5
> 
> 时间：2016-05-15T00:06:41.707

*一个*未提及的使用原因`===`- 是在您与 / 交叉编译 to/from 共存的情况下`coffee-script`。从[CoffeeScript 小书](https://arcturo.github.io/library/coffeescript/07_the_bad_parts.html)...

> JavaScript 中的弱相等比较有一些令人困惑的行为，并且通常是令人困惑的错误的根源。
> 
> 解决方案是改用严格相等运算符，它由三个等号组成：===。它的工作方式与普通的相等运算符完全相同，但没有任何类型强制。建议始终使用严格相等运算符，并在需要时显式转换类型。

如果您经常来回转换`coffee-script`，您应该只使用`===`. 事实上，`coffee-script`编译器会**强迫你**...

> CoffeeScript 通过简单地将所有弱比较替换为严格比较来解决这个问题，换句话说，将所有 == 比较器转换为 ===。您不能在 CoffeeScript 中进行弱相等比较，如果需要，您应该在比较它们之前显式转换类型。

* * *

## 回答 #42

> 赞同：3
> 
> 时间：2017-11-16T10:56:45.980

# 严格的平等在很大程度上更好

Javascript 是一种松散类型的语言这一事实​​需要在您使用它时不断出现在您的脑海中。只要数据结构相同，就没有理由不使用严格相等，通过常规相等，您通常会自动进行值的隐式转换，这会对您的代码产生深远的影响。这种转换很容易出现问题，因为它们是自动发生的。

在严格相等的情况下，没有自动隐式转换，因为值必须已经是正确的数据结构。

* * *

## 回答 #43

> 赞同：1
> 
> 时间：2016-07-01T17:00:02.753

Javascript 的类型很松散，就像 php 一样，

```
var x = "20";
var y =20;

if (x===y) // false 
```

这总是会给你一个错误，因为即使变量的值相同，数据类型也不同

一个是字符串，另一个是整数

```
If(x==y)//true 
```

然而，这只是检查内容是否相同，无论数据类型如何......

我不想说值相等，因为字符串值在逻辑上不能等于 int 值

* * *

## 回答 #44

> 赞同：1
> 
> 时间：2017-04-24T12:11:33.383

首先，关于 Javascript 字符串等号的一些术语：双等号正式称为抽象相等比较运算符，而三等号称为严格相等比较运算符。它们之间的区别可以总结如下：抽象相等会在进行比较之前尝试通过类型强制来解析数据类型。如果类型不同，严格相等将返回 false。考虑以下示例：

```
console.log(3 == "3"); // true
console.log(3 === "3"); // false.
console.log(3 == "3"); // true
console.log(3 === "3"); // false. 
```

使用两个等号返回 true，因为字符串“3”在进行比较之前被转换为数字 3。三个等号看出类型不同，返回false。这是另一个：

```
console.log(true == '1'); // true
console.log(true === '1'); // false
console.log(true == '1'); // true
console.log(true === '1'); // false 
```

同样，抽象相等比较执行类型转换。在这种情况下，布尔值 true 和字符串 '1' 都被转换为数字 1，结果为 true。严格相等返回 false。

如果您了解您在区分 == 和 === 方面做得很好。但是，在某些情况下，这些运算符的行为是不直观的。让我们再看一些例子：

```
console.log(undefined == null); // true
console.log(undefined === null); // false. Undefined and null are distinct types and are not interchangeable.
console.log(undefined == null); // true     
console.log(undefined === null); // false. Undefined and null are distinct types and are not interchangeable.

console.log(true == 'true'); // false. A string will not be converted to a boolean and vice versa.
console.log(true === 'true'); // false
console.log(true == 'true'); // false. A string will not be converted to a boolean and vice versa.
console.log(true === 'true'); // false 
```

下面的示例很有趣，因为它说明了字符串文字与字符串对象不同。

```
console.log("This is a string." == new String("This is a string.")); // true
console.log("This is a string." === new String("This is a string.")); // false
console.log("This is a string." == new String("This is a string.")); // true
console.log("This is a string." === new String("This is a string.")); // false 
```

* * *

## 回答 #45

> 赞同：1
> 
> 时间：2017-05-07T12:10:32.903

如果`===`你想在 JavaScript 中比较一些东西，那就使用它，它被称为**严格相等，这意味着如果****只有类型和值都相同**，这将返回 true ，所以如果你使用，就不会有任何不需要的类型更正`==`，您基本上不关心类型，并且在许多情况下您可能会面临松散相等比较的问题。

**使用 === 严格相等**

> 严格相等比较两个值是否相等。在比较之前，这两个值都不会隐式转换为其他值。如果值具有不同的类型，则认为这些值不相等。否则，如果值具有相同的类型并且不是数字，则如果它们具有相同的值，则它们被认为是相等的。最后，如果两个值都是数字，如果它们都不是 NaN 并且是相同的值，或者如果一个是 +0 而一个是 -0，则它们被认为是相等的。

```
var num = 0;
var obj = new String('0');
var str = '0';

console.log(num === num); // true
console.log(obj === obj); // true
console.log(str === str); // true

console.log(num === obj); // false
console.log(num === str); // false
console.log(obj === str); // false
console.log(null === undefined); // false
console.log(obj === null); // false
console.log(obj === undefined); // false 
```

**使用 == 的松散相等**

> 在将两个值转换为通用类型之后，松散相等比较两个值是否相等。转换后（一方或双方可能进行转换），最终的相等比较完全按照 === 执行。松散相等是对称的：对于 A 和 B 的任何值，A == B 始终具有与 B == A 相同的语义（应用转换的顺序除外）。

```
var num = 0;
var obj = new String('0');
var str = '0';

console.log(num == num); // true
console.log(obj == obj); // true
console.log(str == str); // true

console.log(num == obj); // true
console.log(num == str); // true
console.log(obj == str); // true
console.log(null == undefined); // true

// both false, except in rare cases
console.log(obj == null);
console.log(obj == undefined); 
```

* * *

## 回答 #46

> 赞同：1
> 
> 时间：2017-08-01T09:13:53.673

它建议替换为的原因`==`是`===`操作`===`符比`==`. 在我们的上下文中，可靠的方法`===`也适用于类型检查。考虑到最佳编程实践，我们应该始终选择更可靠的功能而不是不太可靠的功能。同样，每当我们在大多数情况下考虑完全等于运算符时，我们默认认为类型应该是相同的。正如`===`规定一样，我们应该去争取它。

* * *

## 回答 #47

> 赞同：1
> 
> 时间：2017-11-26T19:38:41.510

`==`“我应该使用还是在 JavaScript 中比较”的困境`===`等于或类似于以下问题：“我应该使用'勺子'还是'叉子'来吃饭？

这个问题唯一合理的答案是

1.  您应该使用**动态类型**比较，例如：`==`用于***松散类型***比较。
2.  您应该使用**静态类型**比较，例如：`===`用于***强类型***比较。

那是因为它们不一样。它们没有相同的目的，也不打算用于相同的目的。

当然，“叉子”和“勺子”都是用来“吃”的，但你会根据你吃的东西来选择使用它们。

含义：您将决定使用“勺子”，即：`==`用于喝“汤”，和/或“叉子”，即：`===`用于采摘。

询问是否更好地使用“叉子”或“勺子”来“吃” - 等于询问使用静态 [===] 与动态 [==] 等式是否更好，同上。在 JS 中。这两个问题同样是错误的，反映了对所讨论主题的非常狭隘或肤浅的理解。

* * *

## 回答 #48

> 赞同：0
> 
> 时间：2016-07-05T12:53:56.197

```
var a = new String("123");
var b = "123";

alert(a === b); // returns false !! (but they are equal and of the same type) 
```

在其中一个答案中看到了这一点。 `a`并且`b`在这种情况下并不是真正的同一类型，如果你检查`typeof(a)` 你会得到*'object'*和`typeof(b)`is *'string'*。

# c# - 如何使 IEnumerable 只读？

> ID：359495
> 
> 赞同：16
> 
> 时间：2008-12-11T14:20:26.923
> 
> 标签：c#, .net, generics, ienumerable

为什么列表`list1Instance`和下面代码`p`的`Main`方法指向同一个集合？

```
class Person
    {
        public string FirstName = string.Empty;
        public string LastName = string.Empty;

        public Person(string firstName, string lastName) {
            this.FirstName = firstName;
            this.LastName = lastName;
        }
    }

    class List1
    {
        public List<Person> l1 = new List<Person>();

        public List1()
        {
            l1.Add(new Person("f1","l1"));
            l1.Add(new Person("f2", "l2"));
            l1.Add(new Person("f3", "l3"));
            l1.Add(new Person("f4", "l4"));
            l1.Add(new Person("f5", "l5"));
        }
        public IEnumerable<Person> Get()
        {
            foreach (Person p in l1)
            {
                yield return p;
            }

            //return l1.AsReadOnly(); 
        }

    }  

    class Program
    {

        static void Main(string[] args)
        {
            List1 list1Instance = new List1();

            List<Person> p = new List<Person>(list1Instance.Get());           

            UpdatePersons(p);

            bool sameFirstName = (list1Instance.l1[0].FirstName == p[0].FirstName);
        }

        private static void UpdatePersons(List<Person> list)
        {
            list[0].FirstName = "uf1";
        }
    } 
```

我们可以在不改变返回类型的情况下改变这种行为`List1.Get()`吗？

谢谢

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2008-12-11T14:24:04.170

事实上，`IEnumerable<T>` **已经是 readonly 了**。这意味着您不能用不同的项目替换基础集合中的任何项目。也就是说，您不能更改对集合中保存的对象的*引用。*`Person`但是，该类型`Person`不是只读的，而且由于它是引用类型（即 a `class`），您可以通过引用更改其成员。

有两种解决方案：

*   使用 a`struct`作为返回类型（每次返回时都会复制该值，因此原始值不会被更改 - 顺便说一句，这可能会很昂贵）
*   使用该类型的只读属性`Person`来完成此任务。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-12-11T14:29:38.713

在 Get() 中返回一个新的 Person 实例，它是 的副本`p`而不是自身。`p`您需要一种方法来制作 Person 对象的深层副本来执行此操作。这不会使它们成为只读的，但它们将与原始列表中的不同。

```
public IEnumerable<Person> Get()
{
    foreach (Person p in l1)
    {
        yield return p.Clone();
    }
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-11T14:26:15.057

它们不是指向同一个 .Net 集合，而是指向同一个`Person`对象。该行：

```
List<Person> p = new List<Person>(list1Instance.Get()); 
```

将所有 Person 元素从复制`list1Instance.Get()`到 list `p`。这里的“副本”一词是指复制参考文献。因此，您的列表`IEnumerable`恰好指向相同的`Person`对象。

`IEnumerable<T>`根据定义，它**始终**是只读的。但是，内部的对象可能是可变的，就像在这种情况下一样。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-11T14:40:11.330

您可以对列表中的每个项目进行深度克隆，并且永远不要返回对原始项目的引用。

```
public IEnumerable<Person> Get()
{
  return l1
    .Select(p => new Person(){
      FirstName = p.FirstName,
      LastName = p.LastName
    });
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-11T14:42:59.750

如果您的 person 对象是真实对象，那么您应该考虑使用不可变版本。

```
 public class Person
 {
     public FirstName {get; private set;}
     public LastName {get; private set;}
     public Person(firstName, lastName)
     {
         FirstName = firstName;
         LastName = lastName;
     }
  } 
```

通过这种方式，一旦创建实例就不可能更改其内容，因此在多个列表中重用现有实例并不重要。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-11T14:30:34.453

`IEnumerable<T>` *是*只读的

`p`是一个不依赖于`list1instance`. 您犯的错误是您认为这一行 `list[0].FirstName = "uf1";`
只会修改其中一个列表，而实际上您正在修改`Person`对象。
这两个集合是不同的，它们只是碰巧有相同的项目。
要证明它们不同，请尝试从其中一个列表中添加和删除项目，您会发现另一个不受影响。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-11T14:33:03.717

首先，您班级中的列表是公开的，因此没有什么可以阻止任何人直接访问列表本身。

其次，我将实现 IEnumerable 并在我的 GetEnumerator 方法中返回它

```
return l1.AsReadOnly().GetEnumerator(); 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2018-11-28T01:53:58.367

此代码返回一个派生类，因此请求的返回类型没有改变。

如果您尝试更改字段（通过属性），它确实会引发错误，因此“**只读**”也是如此。如果您确实希望能够在不影响原始值的情况下更改值，那么上面的克隆答案会更好。

```
class  Person
{
    public virtual string FirstName { get; set; }
    public virtual string LastName { get; set; }

    public Person(string firstName, string lastName) {
        this.FirstName = firstName;
        this.LastName = lastName;
    }

}

class PersonReadOnly : Person
{
    public override string FirstName { get { return base.FirstName; } set { throw new Exception("setting a readonly field"); } }
    public override string LastName { get { return base.LastName; } set { throw new Exception("setting a readonly field"); } }

    public PersonReadOnly(string firstName, string lastName) : base(firstName, lastName)
    {
    }
    public PersonReadOnly(Person p) : base(p.FirstName, p.LastName)
    {

    }

}

class List1
{
    public List<Person> l1 = new List<Person>();

    public List1()
    {
        l1.Add(new Person("f1", "l1"));
        l1.Add(new Person("f2", "l2"));
        l1.Add(new Person("f3", "l3"));
        l1.Add(new Person("f4", "l4"));
        l1.Add(new Person("f5", "l5"));
    }
    public IEnumerable<Person> Get()
    {
        foreach (Person p in l1)
        {
            yield return new PersonReadOnly(p);
        }
        //return l1.AsReadOnly(); 
    }

}  
class Program
{

    static void Main(string[] args)
    {
        List1 list1Instance = new List1();

        List<Person> p = new List<Person>(list1Instance.Get());           

        UpdatePersons(p);

        bool sameFirstName = (list1Instance.l1[0].FirstName == p[0].FirstName);
    }

    private static void UpdatePersons(List<Person> list)
    {
        // readonly message thrown
        list[0].FirstName = "uf1";
    } 
```

# emacs - 便携式 Emacs？（Emacs 服务器不工作）

> ID：359497
> 
> 赞同：7
> 
> 时间：2008-12-11T14:20:48.263
> 
> 标签：emacs, portability

我已经看到了一些关于使 emacs 可移植（在 Windows 上）的建议。我的 site-start.el 中有这个：

```
(defvar program-dir (substring data-directory 0 -4))

(setq inhibit-startup-message t)
(setenv "HOME" program-dir) 
```

我更改了 HOME 变量，这样不仅读取了我的 .emacs 初始化文件（和其他初始化文件），而且 emacs 生成的所有内容都将保留在程序目录中，不需要我一一指定所有内容的路径。

好吧，这很好用，但是 emacs 服务器不工作；我收到错误消息“无法建立连接，因为目标机器主动拒绝了它。” 如果我不更改我的 HOME var，那么 emacs 服务器就可以工作。有没有办法解决这个问题？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-11T14:35:39.217

引用[Emacs 手册](http://www.gnu.org/software/emacs/manual/html_node/emacs/Invoking-emacsclient.html)：

> 当您启动 Emacs 服务器（通过调用 server-start）时，Emacs 会创建一个文件，其中包含有关与服务器的 TCP 连接的信息：运行 Emacs 的主机、它正在侦听的端口以及一个身份验证字符串。如果 emacsclient 需要通过 TCP 连接到服务器，它会使用此信息。默认情况下，该文件位于 ~/.emacs.d/server/ 目录中。您可以指定要与 `-f file' 或 `--server-file=file' 选项一起使用的文件名，或者通过将 EMACS_SERVER_FILE 环境变量设置为文件名。

换句话说：无论您`emacsclient`从哪里调用，您都必须告诉*它*使用 in 中的文件`${program-dir}/.emacs.d/server/`，无论是使用环境变量`-f`还是设置`EMACS_SERVER_FILE`环境变量。（在您开始的环境中`emacsclient`，而不是在 Emacs 中。）
[您*也*可以告诉 Emacsclient 使用`-s`for "socket" 在正确的位置查找，但这在 Windows 上不起作用。而在 Unix 上（至少在带有 Aquamacs 的 Mac OS X 上），套接字将类似于 `/tmp/emacs501/server`（501 是我的 UID）。]

[哦，顺便说一句，看看这个问题：[我怎样才能拥有便携式 Emacs？](https://stackoverflow.com/questions/350345/how-can-i-have-a-portable-emacs)也许有什么可以帮助你，或者你有什么要补充的:-)]

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-06-16T14:30:53.777

这里有一个便携式应用程序版本的 emacs 23.2 的初始打包[。](http://portableapps.com/node/23470) 初始测试在这里工作。

# python - 如何在 Python 中使用 ctypes 卸载 DLL？

> ID：359498
> 
> 赞同：23
> 
> 时间：2008-12-11T14:21:06.970
> 
> 标签：python, dll, ctypes

我正在使用 ctypes 在 Python 中加载 DLL。这很好用。

现在我们希望能够在运行时重新加载该 DLL。

直接的方法似乎是： 1\. 卸载 DLL 2\. 加载 DLL

不幸的是，我不确定卸载 DLL 的正确方法是什么。

_ctypes.FreeLibrary 可用，但私有。

还有其他方法可以卸载 DLL 吗？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-12-11T14:41:16.007

你应该能够通过处理对象来做到这一点

```
mydll = ctypes.CDLL('...')
del mydll
mydll = ctypes.CDLL('...') 
```

**编辑：** Hop 的评论是正确的，这解除了名称的绑定，但是垃圾收集并没有那么快发生，事实上我什至怀疑它甚至会释放加载的库。

Ctypes 似乎没有提供一种干净的方式来释放资源，它只为`_handle`dlopen 句柄提供了一个字段......

所以我看到的唯一方法，一个非常**非常不干净的方法**，是系统依赖 dlclose 句柄，但它非常非常不干净，因为此外 ctypes 保持对这个句柄的内部引用。所以卸载需要以下形式：

```
mydll = ctypes.CDLL('./mylib.so')
handle = mydll._handle
del mydll
while isLoaded('./mylib.so'):
    dlclose(handle) 
```

它太不干净了，我只检查了它是否可以使用：

```
def isLoaded(lib):
   libp = os.path.abspath(lib)
   ret = os.system("lsof -p %d | grep %s > /dev/null" % (os.getpid(), libp))
   return (ret == 0)

def dlclose(handle)
   libdl = ctypes.CDLL("libdl.so")
   libdl.dlclose(handle) 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2015-02-19T15:31:41.900

如果您使用 iPython 或类似的工作流程，能够卸载 DLL 以便您无需重新启动会话即可重建 DLL 会很有帮助。在 Windows 中工作我只尝试使用与 Windows DLL 相关的方法。

```
REBUILD = True
if REBUILD:
  from subprocess import call
  call('g++ -c -DBUILDING_EXAMPLE_DLL test.cpp')
  call('g++ -shared -o test.dll test.o -Wl,--out-implib,test.a')

import ctypes
import numpy

# Simplest way to load the DLL
mydll = ctypes.cdll.LoadLibrary('test.dll')

# Call a function in the DLL
print mydll.test(10)

# Unload the DLL so that it can be rebuilt
libHandle = mydll._handle
del mydll
ctypes.windll.kernel32.FreeLibrary(libHandle) 
```

我不太了解内部结构，所以我不确定这有多干净。我认为删除 mydll 会释放 Python 资源，并且 FreeLibrary 调用会告诉 Windows 释放它。我假设首先使用 FreeLibary 释放会产生问题，所以我保存了库句柄的副本并按照示例中显示的顺序释放它。

我将此方法基于[ctypes unload dll](https://stackoverflow.com/questions/13128995/ctypes-unload-dll)，它预先显式加载了句柄。然而，加载约定不像简单的“ctypes.cdll.LoadLibrary('test.dll')”那样干净，所以我选择了所示的方法。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2020-06-11T14:09:21.323

[Piotr 的回答](https://stackoverflow.com/a/359570/602216)帮助了我，但我确实在 64 位 Windows 上遇到了一个问题：

```
Traceback (most recent call last):
...
ctypes.ArgumentError: argument 1: <class 'OverflowError'>: int too long to convert 
```

[按照此答案](https://stackoverflow.com/a/23524745/602216)`FreeLibrary`中的建议调整调用的参数类型为我解决了这个问题。

因此，我们得出以下完整的解决方案：

```
import ctypes, ctypes.windll

def free_library(handle):
    kernel32 = ctypes.WinDLL('kernel32', use_last_error=True)
    kernel32.FreeLibrary.argtypes = [ctypes.wintypes.HMODULE]
    kernel32.FreeLibrary(handle) 
```

用法：

```
lib = ctypes.CDLL("foobar.dll")
free_library(lib._handle) 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2018-03-22T03:13:34.950

如果您需要此功能，您可以编写 2 个 dll，其中 dll_A 从 dll_B 加载/卸载库。使用 dll_A 作为 python 接口加载器和 dll_B 中函数的传递。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2021-04-06T15:37:55.230

为了完全的交叉兼容性：我维护了`dlclose()`每个平台的各种等价物列表以及从哪个库中获取它们。这是一个有点长的列表，但您可以随意复制/粘贴它。

```
import sys
import ctypes
import platform

OS = platform.system()

if OS == "Windows":  # pragma: Windows
    dll_close = ctypes.windll.kernel32.FreeLibrary

elif OS == "Darwin":
    try:
        try:
            # macOS 11 (Big Sur). Possibly also later macOS 10s.
            stdlib = ctypes.CDLL("libc.dylib")
        except OSError:
            stdlib = ctypes.CDLL("libSystem")
    except OSError:
        # Older macOSs. Not only is the name inconsistent but it's
        # not even in PATH.
        stdlib = ctypes.CDLL("/usr/lib/system/libsystem_c.dylib")
    dll_close = stdlib.dlclose

elif OS == "Linux":
    try:
        stdlib = ctypes.CDLL("")
    except OSError:
        # Alpine Linux.
        stdlib = ctypes.CDLL("libc.so")
    dll_close = stdlib.dlclose

elif sys.platform == "msys":
    # msys can also use `ctypes.CDLL("kernel32.dll").FreeLibrary()`. Not sure
    # if or what the difference is.
    stdlib = ctypes.CDLL("msys-2.0.dll")
    dll_close = stdlib.dlclose

elif sys.platform == "cygwin":
    stdlib = ctypes.CDLL("cygwin1.dll")
    dll_close = stdlib.dlclose

elif OS == "FreeBSD":
    # FreeBSD uses `/usr/lib/libc.so.7` where `7` is another version number.
    # It is not in PATH but using its name instead of its path is somehow the
    # only way to open it. The name must include the .so.7 suffix.
    stdlib = ctypes.CDLL("libc.so.7")
    dll_close = stdlib.close

else:
    raise NotImplementedError("Unknown platform.")

dll_close.argtypes = [ctypes.c_void_p] 
```

然后您可以使用`dll_close(dll._handle)`卸载库`dll = ctypes.CDLL("your-library")`。

此列表取自[此文件](https://github.com/bwoodsend/cslug/blob/db3f50273e887250d001673981163d25913e247a/cslug/_stdlib.py)。每次遇到新平台我都会更新[master分支。](https://github.com/bwoodsend/cslug/blob/master/cslug/_stdlib.py)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2020-10-22T13:24:43.850

# 2020 年与 Windows 和 linux 兼容的最小可重现示例

## 类似讨论的概述

这里是类似讨论的概述（我从中构建了这个答案）。

*   [如何在 Python 中使用 ctypes 卸载 DLL？](https://stackoverflow.com/questions/359498/how-can-i-unload-a-dll-using-ctypes-in-python)
*   [ctypes卸载dll](https://stackoverflow.com/questions/13128995/ctypes-unload-dll/13129176#13129176)
*   [在 ctypes 加载共享库中卸载共享库](https://stackoverflow.com/questions/52179325/unload-shared-library-inside-ctypes-loaded-shared-library/52223168#52223168)
*   [强制 ctypes.cdll.LoadLibrary() 从文件重新加载库](https://stackoverflow.com/questions/50964033/forcing-ctypes-cdll-loadlibrary-to-reload-library-from-file/50986803#50986803)

## 最小可重现示例

这适用于 windows 和 linux，因此有 2 个脚本用于编译。测试下：

*   Win 8.1, Python 3.8.3 (anaconda), ctypes 1.1.0, mingw-w64 x86_64-8.1.0-posix-seh-rt_v6-rev0
*   Linux Fedora 32、Python 3.7.6 (anaconda)、ctypes 1.1.0、g++ 10.2.1

**cpp_code.cpp**

```
extern "C" int my_fct(int n)
{
    int factor = 10;
    return factor * n;
} 
```

**编译-linux.sh**

```
#!/bin/bash
g++ cpp_code.cpp -shared -o myso.so 
```

**编译-windows.cmd**

```
set gpp="C:\Program Files\mingw-w64\x86_64-8.1.0-posix-seh-rt_v6-rev0\mingw64\bin\g++.exe"
%gpp% cpp_code.cpp -shared -o mydll.dll
PAUSE 
```

**Python代码**

```
from sys import platform
import ctypes

if platform == "linux" or platform == "linux2":
    # https://stackoverflow.com/a/50986803/7128154
    # https://stackoverflow.com/a/52223168/7128154

    dlclose_func = ctypes.cdll.LoadLibrary('').dlclose
    dlclose_func.argtypes = [ctypes.c_void_p]

    fn_lib = './myso.so'
    ctypes_lib = ctypes.cdll.LoadLibrary(fn_lib)
    handle = ctypes_lib._handle

    valIn = 42
    valOut = ctypes_lib.my_fct(valIn)
    print(valIn, valOut)

    del ctypes_lib
    dlclose_func(handle)

elif platform == "win32": # Windows
    # https://stackoverflow.com/a/13129176/7128154
    # https://stackoverflow.com/questions/359498/how-can-i-unload-a-dll-using-ctypes-in-python

    lib = ctypes.WinDLL('./mydll.dll')
    libHandle = lib._handle

    # do stuff with lib in the usual way
    valIn = 42
    valOut = lib.my_fct(valIn)
    print(valIn, valOut)

    del lib
    ctypes.windll.kernel32.FreeLibrary(libHandle) 
```

## 更通用的解决方案（面向对象的具有依赖关系的共享库）

如果共享库有`dependencies`，这不一定工作（但它可以 - 取决于依赖 ^^）。我没有调查细节，但看起来机制如下：加载了库和依赖项。由于未卸载依赖项，因此无法卸载库。

我发现，如果我将`OpenCv`（4.2 版）包含到我的共享库中，这会打乱卸载过程。以下示例仅在 linux 系统上进行了测试：

**代码.cpp**

```
#include <opencv2/core/core.hpp>
#include <iostream> 

extern "C" int my_fct(int n)
{
    cv::Mat1b mat = cv::Mat1b(10,8,(unsigned char) 1 );  // change 1 to test unloading

    return mat(0,1) * n;
} 
```

**编译** `g++ code.cpp -shared -fPIC -Wall -std=c++17 -I/usr/include/opencv4 -lopencv_core -o so_opencv.so`

**Python代码**

```
from sys import platform
import ctypes

class CtypesLib:

    def __init__(self, fp_lib, dependencies=[]):
        self._dependencies = [CtypesLib(fp_dep) for fp_dep in dependencies]

        if platform == "linux" or platform == "linux2":  # Linux
            self._dlclose_func = ctypes.cdll.LoadLibrary('').dlclose
            self._dlclose_func.argtypes = [ctypes.c_void_p]
            self._ctypes_lib = ctypes.cdll.LoadLibrary(fp_lib)
        elif platform == "win32":  # Windows
            self._ctypes_lib = ctypes.WinDLL(fp_lib)

        self._handle = self._ctypes_lib._handle

    def __getattr__(self, attr):
        return self._ctypes_lib.__getattr__(attr)

    def __del__(self):
        for dep in self._dependencies:
            del dep

        del self._ctypes_lib

        if platform == "linux" or platform == "linux2":  # Linux
            self._dlclose_func(self._handle)
        elif platform == "win32":  # Windows
            ctypes.windll.kernel32.FreeLibrary(self._handle)

fp_lib = './so_opencv.so'

ctypes_lib = CtypesLib(fp_lib, ['/usr/lib64/libopencv_core.so'])

valIn = 1
ctypes_lib.my_fct.argtypes = [ctypes.c_int]
ctypes_lib.my_fct.restype = ctypes.c_int
valOut = ctypes_lib.my_fct(valIn)
print(valIn, valOut)

del ctypes_lib 
```

当代码示例或到目前为止给出的解释有任何问题时，请告诉我。另外，如果您知道更好的方法！如果我们能一劳永逸地解决这个问题，那就太好了。

# compact-framework - 如何在 CF 2.0 上以编程方式更改 DNS IP

> ID：359504
> 
> 赞同：2
> 
> 时间：2008-12-11T14:22:40.150
> 
> 标签：compact-framework, dns

我想以编程方式将 DNS IP 地址更改为 Compact Framework 上的适配器。我也检查了 OpenNetCF 2.3 的 NetworkInterface 类，但我不希望设备在设置后重新启动。

请问有人可以开灯吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-07-19T18:00:29.170

适配器的 DNS 服务器地址存储在注册表中，如下所示：

`[HKEY_LOCAL_MACHINE\Comm\<Adapter Name>\Parms\Tcpip]`
`"DNS"=REG_MULTI_SZ:<IP address of the DNS name server>.`

请注意，它是一个**multi_sz**值。

`NetworkInterface.Rebind()`只需更新注册表并使用 SDF 的方法或通过调用`DeviceIoControl`NDIS 设备`IOCTL_NDIS_REBIND_ADAPTER`（这是 SDF 的调用正在执行的操作）重新绑定适配器。

# asp.net - 有没有一种简单的方法可以读取外部网页的源代码？ASP.NET

> ID：359516
> 
> 赞同：1
> 
> 时间：2008-12-11T14:26:39.050
> 
> 标签：asp.net, vb.net

我希望能够编写一个函数来读取外部新闻站点并返回目标页面的源代码。有什么想法和/或信息可以让我开始吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-11T14:27:52.587

```
string GetOtherPage(System.Uri url)
{
    return new System.Net.WebClient().DownloadString(url);
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-11T14:30:55.653

您可以查看[System.Net.WebRequest](http://msdn.microsoft.com/en-us/library/system.net.webrequest.aspx)类和示例

但是，请不要自己编写像 MSDN 示例那样*糟糕的代码，在适当的情况下*[使用 using](http://aspnetresources.com/blog/the_very_handy_using_statement.aspx)成语

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-11T14:31:33.720

如果您在谈论 HTML 源代码，那么 Joel 的回答是正确的。

但是，如果您谈论的是动态页面的实际代码隐藏，答案是“谢天谢地，不”。大多数正确配置的站点不会返回动态执行以创建页面的源代码。

# asp.net - ashx 通用处理程序中的 Visual Studio ASP.Net 展开和折叠问题

> ID：359528
> 
> 赞同：15
> 
> 时间：2008-12-11T14:29:11.633
> 
> 标签：asp.net, visual-studio, visual-studio-2008, ashx

我有 Visual Studio 2008 Professional，但在 ASP.Net 通用处理程序页面 (.ashx) 中展开和折叠方法代码块时遇到问题

我原以为你可以在 .aspx 网页后面的代码中做同样的事情。

即使使用 VS 2008 Standard 和 VS 2005 Professional，我在其他机器上也有同样的问题。所有盒子都已完全修补（OS 和 Visual Studio。）

有人对启用此功能有任何建议吗？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-12-11T15:57:59.223

您可以强制 Visual Studio 忽略您正在使用的代码这一事实，方法是：

工具 | 选项

并打开“文本编辑器|文件扩展名”选项卡。

为扩展“ashx”创建一个新条目，映射到编辑器“Microsoft Visual C#”（或“Microsoft Visual Basic”，根据您的喜好），然后“添加”它。

确定对话框，关闭并重新打开您的 ashx 文件，您的代码块将崩溃到您的内心深处，但 @ 指令会相当难看。

如果您在 .aspx 文件中有服务器端脚本（例如在网站项目中并且您没有“将代码放在单独的文件中”），您也会遇到同样的问题，那么您也无法折叠其中的类块。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2011-04-21T07:53:26.580

在目录中创建一个类，`App_Code`ashx 文件只是引用它......像这样：

SomeHandler.ashx：

```
<%@ WebHandler Language="C#" Class="SomethingHandler" %> 
```

在`App_Code`文件夹中，我`SomethingHandler.cs`用类创建了文件`SomethingHandler`

```
using System;
using System.Web;
// using blabla...

public class SomethingHandler : IHttpHandler
{
        public void ProcessRequest(HttpContext c)
        {
    etc... 
```

现在我可以打开SomethingHandler.cs，用#region collapsing编辑我的C#代码，因为.cs文件是在正确的编辑器中打开的:)

[@WebHandler 文档](https://docs.microsoft.com/en-us/previous-versions/dotnet/netframework-4.0/ms366713(v=vs.100))

在 VS 2019 中测试。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2015-06-30T16:58:02.363

只需选择一段代码，例如：

```
using System;
using System.Web;
using System.Web.Security;
using System.Collections.Generic;
using System.Configuration;
using System.Data.SqlClient;
using System.Data; 
```

然后按“ **Ctrl+M+H** ”和 Vualá...大纲正在运行...还有 Intellisense...

要停止大纲按“ **Ctrl+M+P** ”...

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2011-07-26T11:07:11.790

在第一行前面添加 ///。

像这样：

```
///<%@ WebHandler Language="C#" Class="FooBar"%> 
```

# .net - 在 Visual Studio 安装项目中将 DLL 部署到 GAC 时出现问题

> ID：359534
> 
> 赞同：3
> 
> 时间：2008-12-11T14:30:50.507
> 
> 标签：.net, dll, installation, windows-installer

“程序集 [AssemblyName] 必须有一个共享名称才能全局安装”

当我尝试将我的应用程序的一些组件 DLL 部署到全局程序集缓存时，我收到此错误消息。

什么是共享名，我如何确保我的 DLL 有一个？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-11T14:41:03.230

“共享名称”必须是“[强名称](http://msdn.microsoft.com/en-us/library/xc31ft41.aspx)”的同义词，这是我一直阅读/听到的名称。该链接显示如何使用强名称对程序集进行签名，以便将其添加到 GAC。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-11T14:42:55.677

你确定这不是“强名”吗？在将它们安装到 gac 之前，您必须对程序集进行签名（请参阅 vs.net 中的项目属性）。

虽然一般来说，程序集不应该安装在 GAC 中。MS 建议只安装许多应用程序（例如控制库）使用的组件 dll 以安装在 GAC 中。通常，应该将使用过的程序集保留在应用程序本身的本地，以便可以进行 xcopy 部署（因为应用程序正常运行不需要安装 GAC）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-11T14:44:43.163

没错，您需要使用[强名称](http://msdn.microsoft.com/en-us/library/szdke3d6.aspx)对您的程序集进行签名。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-07-01T13:41:48.617

我想说，如果我有一个应用程序，并且如果这个应用程序使用另一个应用程序，比如 devexpress 组件，并且这个组件总是有一个组件，我该怎么办。但最后我用 GAC 实用程序解决了这个问题，我还看到，如果我们将该 dll 复制到 GAC 的共享文件夹，它也总是同意这个问题

对不起，因为当时我很长时间都没有这样做。

谢谢大家

# c# - C# 和非托管 C 库之间的互操作

> ID：359541
> 
> 赞同：3
> 
> 时间：2008-12-11T14:32:21.533
> 
> 标签：c#, c, interop, marshalling

我在 DLL 中有一个小型 C 库，我需要调用它的一些方法。

它使用指针和一些结构，但在其他方面非常简单。问题是我对 .NET 与非托管世界的互操作并不是非常了解，而且到目前为止我的尝试一直遇到内存访问冲突异常（可能是因为我没有得到完全正确的指针）。

谁能给我一些关于解决这个问题的最佳方法的指示（哦，双关语！）？

谢谢

```
extern vconfig_t *Pobsopen(Ppoly_t ** obstacles, int n_obstacles);

extern int Pobspath(vconfig_t * config, Ppoint_t p0, int poly0,
            Ppoint_t p1, int poly1,
            Ppolyline_t * output_route);

extern void Pobsclose(vconfig_t * config);

struct vconfig_t {
    int Npoly;
    int N;
    Ppoint_t *P;
    int *start;
    int *next;
    int *prev;
};

typedef struct Ppoly_t {
    Ppoint_t *ps;
    int pn;
} Ppoly_t;

typedef Ppoly_t Ppolyline_t;

typedef struct Pxy_t {
    double x, y;
} Pxy_t;

typedef struct Pxy_t Ppoint_t;
typedef struct Pxy_t Pvector_t; 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-11T16:01:30.370

您应该查看这篇 MSDN 杂志[文章中提供的](http://msdn.microsoft.com/en-us/magazine/cc164193.aspx)[工具](http://download.microsoft.com/download/f/2/7/f279e71e-efb0-4155-873d-5554a0608523/CLRInsideOut2008_01.exe)，该工具可以将 C 代码段转换为 C# P/Invoke 签名，当然还有帖子。

为您的代码片段运行该工具可为您提供以下信息：

```
[System.Runtime.InteropServices.StructLayoutAttribute(System.Runtime.InteropServices.LayoutKind.Sequential)]
public struct vconfig_t {

    /// int
    public int Npoly;

    /// int
    public int N;

    /// Ppoint_t*
    public System.IntPtr P;

    /// int*
    public System.IntPtr start;

    /// int*
    public System.IntPtr next;

    /// int*
    public System.IntPtr prev;
}

[System.Runtime.InteropServices.StructLayoutAttribute(System.Runtime.InteropServices.LayoutKind.Sequential)]
public struct Ppoly_t {

    /// Ppoint_t*
    public System.IntPtr ps;

    /// int
    public int pn;
}

[System.Runtime.InteropServices.StructLayoutAttribute(System.Runtime.InteropServices.LayoutKind.Sequential)]
public struct Pxy_t {

    /// double
    public double x;

    /// double
    public double y;
}

public partial class NativeMethods {

    /// Return Type: vconfig_t*
    ///obstacles: Ppoly_t**
    ///n_obstacles: int
    [System.Runtime.InteropServices.DllImportAttribute("<Unknown>", EntryPoint="Pobsopen")]
public static extern  System.IntPtr Pobsopen(ref System.IntPtr obstacles, int n_obstacles) ;

    /// Return Type: int
    ///config: vconfig_t*
    ///p0: Ppoint_t->Pxy_t
    ///poly0: int
    ///p1: Ppoint_t->Pxy_t
    ///poly1: int
    ///output_route: Ppolyline_t*
    [System.Runtime.InteropServices.DllImportAttribute("<Unknown>", EntryPoint="Pobspath")]
public static extern  int Pobspath(ref vconfig_t config, Pxy_t p0, int poly0, Pxy_t p1, int poly1, ref Ppoly_t output_route) ;

    /// Return Type: void
    ///config: vconfig_t*
    [System.Runtime.InteropServices.DllImportAttribute("<Unknown>", EntryPoint="Pobsclose")]
public static extern  void Pobsclose(ref vconfig_t config) ;

} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-11T14:37:36.670

也许您应该用 C++/CLI 编写包装器，因为托管代码和非托管代码之间的互操作非常无缝。

**更新**

这是一个简单示例的链接：[C data structure to mimic C#'s List>?](https://stackoverflow.com/questions/343654/c-data-structure-to-mimic-cs-listlistint#343683)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-11T16:38:46.520

我写了一个长而有用的答案，当我发布它时，StackOverflow 将其丢弃。

要点是：

1.  您可能会发现 pinvoke.net 网站很有用，尽管它并不总是准确的。
2.  .NET 框架源代码是一个非常有用的 Win32 函数正确 p/invoke 签名的存储库，并且经常为我自己的 p/invoke 问题提供灵感。
3.  Marshal 类包含许多有用的函数——其中一些可能有助于解释您实际使用 IntPtr 所做的事情。

您可能还需要注意固定/固定 - 特别是对于您的链表结构之类的东西，我认为我不确定它将如何在您的托管应用程序中使用。

# java - 在同一 EAR 中的 WAR 之间进行通信的选项

> ID：359548
> 
> 赞同：6
> 
> 时间：2008-12-11T14:34:07.707
> 
> 标签：java, web-services, deployment, jakarta-ee

您必须在 EAR 中的 WAR 之间进行通信的选项是什么？我们在一个 EAR 中部署了多个提供不同 Web 服务的 WAR。对于他们的任务，他们需要与其他 WAR 进行通信。当然，他们可以使用 Web 服务进行通信。还有哪些其他可能更有效的选择？

编辑：通信的原因是模块使用了一些共享功能，我们只想在一个地方找到这个功能，因为它需要大量的资源。此外，这需要同步通信。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-11T17:36:37.667

由于您的编辑似乎暗示 WARS 之间实际上不需要通信，但两者都需要访问相同的共享资源。最简单的解决方案是将此资源的 jar 放在 EAR 中，并将这些 jar 的依赖项添加到两个 Web 项目中，以便它们使用共享资源。

如果两个 Web 项目中都有需要更新的有状态代码，那么您唯一的选择是调用 Web 项目的 servlet（假设有状态代码包含在 Web 项目中）。

请记住，共享资源必须是线程安全的。

类似的问题[在这里](https://stackoverflow.com/questions/334425/different-war-files-shared-resources#334443)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-11T16:23:31.510

首先，您应该清楚您要分享的是什么。您应该区分服务和库。库允许您共享通用功能，例如，这是您使用 log4j 库时实现的。在这种情况下，您在每个使用它的项目中设置 log4j。另一方面，您可以拥有具有自己的日志配置的集中式日志服务，并允许您在一个地方进行管理。在这种情况下，您需要共享服务。

您可以通过将罐子放在每个战争或耳朵内来共享图书馆。您可以通过成为服务客户端来共享服务。因此，您的 Web 服务可以使用其他服务。在这种情况下，一个 Web 服务是另一个 Web 服务的客户端，实现服务组合（企业开发中的常见模式）

如果服务客户端和服务本身都驻留在同一个耳朵中，那么您可以通过“直接”调用服务来避免一些开销，例如使用 Spring 的父上下文功能： [http ://springtips.blogspot.com/2007/06/ using-shared-parent-application-context.html](http://springtips.blogspot.com/2007/06/using-shared-parent-application-context.html) 但我建议不要扁平化服务，因为您将失去首先拥有服务提供的不同好处，例如治理、可管理性等。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-11T14:37:30.243

想到两件事

1.  有用于发送信号的 JMS。
2.  EJB 可以记录共享信息。
3.  EAR 的 lib 目录中的一个 lib jar。

如果您只需要共享方法，那么 3 就是您想要的。但是您的编辑点告诉我您拥有对共享数据进行操作的共享功能。例如，您拥有可供 WAR 访问和更新的用户记录。如果是这样，您需要一个 EJB。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-11T15:11:35.417

为什么不将公共类放入 JAR 并直接使用它们呢？或者稍微重一些的重量使普通类会话bean？

# asp.net-mvc - 用于新 Asp.net CMS 站点的 Oxite 或 S#arp 架构

> ID：359550
> 
> 赞同：4
> 
> 时间：2008-12-11T14:34:12.043
> 
> 标签：asp.net-mvc, nhibernate, content-management-system, s#arp-architecture, oxite

我想建立一个基于 Asp.Net Mvc 的 CMS 站点，我想选择我的起点。

我已经看到，如果在生产项目中采用它似乎还为时过早，那么人们对新的 Microsoft Oxite 项目也很感兴趣。
我还查看了 S#arp 架构，但它不能与 Oxite 进行正确比较，因为它只是一般 Asp.Net Mvc 站点的起点。

对我来说，S#arp 架构比 Oxite 有一些优势，因为它的复杂性要低得多，并且它使用 Nhibernate 作为数据访问层。
Oxite 代码使用 Linq2Sql 作为 DAL，并且在解决方案中已经有一个项目需要 VS2008 的 DB 版本。
在我看来，Oxite 似乎更面向博客而不是面向 CMS，但我没有深入查看代码。

以下是一些将我指向 S#arp Ar 的选择。开始。

*   简单干净的架构
*   冬眠木豆
*   社区支持

氧化物：

*   微软项目
*   潜在的巨大社区
*   早期阶段，但代码质量非常好
*   允许轻松切换 DAL 的提供程序模型

如果有人看过这两个项目的代码，请提出您的意见。

谢谢

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-12-16T18:54:36.467

Oxite 可能功能丰富，但代码质量非常低。

当我检查代码并发现控制器操作包含 100 多行非常不干净的代码、tagsoup 视图、没有单元测试等时，我感到非常惊讶。

这些批评在这些博客文章中得到了很好的总结：

[http://blog.wekeroad.com/blog/some-thoughts-on-oxite/](http://blog.wekeroad.com/blog/some-thoughts-on-oxite/)

[http://codebetter.com/blogs/karlseguin/archive/2008/12/15/oxite-oh-dear-lord-why.aspx](http://codebetter.com/blogs/karlseguin/archive/2008/12/15/oxite-oh-dear-lord-why.aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-11T18:13:34.363

与往常一样，这取决于您的需求。听起来您需要更多基于 CMS 的东西。Oxite 恰好有一些类似 CMS 的功能，但它并不是真正的 CMS。它可能在未来，因为它是一个社区项目，但现在不是（你所能做的就是添加内容页面）。

我们很高兴每个人似乎都喜欢 Oxite，但现在还为时过早。不要阻止任何人在生产中使用它，因为我们这样做。我们在其上运行[MIX Online](http://visitmix.com)，但如果您对此不满意，我们完全理解。我们需要一个稳定期。同时我们也需要人来运行它，这样我们才能让它稳定。我会说鸡肉和鸡蛋。:)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-11T15:05:44.837

我在 SO 上关于 Oxite 的问题没有得到太多回应（在[Oxite 找到：你打算用它做什么？](https://stackoverflow.com/questions/353605/oxite-what-are-you-going-to-do-with-it)），但它真的很新，所以人们需要一些时间来热身对它进行全面检查。Oxite 的架构非常容易上手；那是它最强的套装。

在阅读您的问题之前，我从未听说过 S#arp，所以我一定会检查一下。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-09-18T07:30:31.350

Oxite 已经很详细了，完全是负面的。

我将补充一点，我已经使用[S#arp 架构](http://sharparchitecture.net/)几个月了，发现它非常易于维护和灵活。它周围还有一个非常稳固、不断发展和活跃的用户社区。

它非常干净，而且很容易升级到 Fluent NHibernate RC 1.0

# c++ - 指针值 0x7c7c7c7c 的特殊含义

> ID：359553
> 
> 赞同：2
> 
> 时间：2008-12-11T14:34:39.203
> 
> 标签：c++, linux, pointers

在调试 Linux 应用程序时，我发现了一个带有可疑值 0x7c7c7c7c 的指针。该特定值是否表明了什么？

（我问是因为我从我的 MSVC 时代就知道，在调试版本中，0xcdcdcdcd 或 0xdddddddd 之类的值将存储到未初始化、已释放或以其他方式无效的堆块中。有些人在未初始化的内存中使用 0xdeadbeef 或 0xcafebabe 之类的魔法值。我猜 libc 或其他地方的某些东西使用 0x7c7c7c7c 作为魔法值，但我找不到它的记录。）

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-11T14:42:21.233

[我不认识那个神奇的数字，维基百科](http://en.wikipedia.org/wiki/Magic_number_(programming))也不认识。我猜您的程序（或您正在使用的库中）中的某些代码正在使用`memset()`并点击您的指针。您是否已经为字符串“0x7c”不区分大小写地grep了您的代码库？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-11T14:51:23.227

0x7C 是 ASCII 管道“|” 特点。[您可以按照亚当](https://stackoverflow.com/users/9530/adam-rosenfield)的建议搜索该字符的写入以及 124 和 0x7C 。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-11T14:39:04.717

0x7c7c = 01111100 01111100 二进制。这可能是格式化实用程序填充硬盘驱动器上未使用空间的那些“最难读取”的位模式之一。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-11T15:48:03.207

也许`MALLOC_PERTURB_`设置了环境变量？如果设置，它会影响 malloc() 如何初始化分配的内存。

# sql - 进入Web界面时，sql报告服务不显示任何内容

> ID：359582
> 
> 赞同：0
> 
> 时间：2008-12-11T14:44:06.703
> 
> 标签：sql, reporting-services, reporting

客户端已安装 Sql server 2005 报告服务。当我们访问网站时，`http://servername/reports/`我们只会看到一个空白屏幕，例如： ![http://img91.imageshack.us/img91/3787/rsblankqx4.jpg](https://i.stack.imgur.com/nGQXH.jpg)

我们正在使用 Windows 身份验证，我认为它已经在“站点设置”按钮出现时对我们进行了身份验证，我们可以更改站点安全性、添加到角色等。

我以前有过这个，不记得我是如何修复它的。

有任何想法吗？

谢谢，

亚历克斯

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-11T15:09:41.770

用户是否有权访问任何报告？以管理员用户身份登录并确保授予他访问报告的权限

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-11T16:21:01.440

您是否检查过报告网站和报告服务器是否在正确版本的 ASP.Net 上运行？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-07T12:06:59.863

客户端重新安装，然后工作正常。一定是以某种方式被破坏了。

# .net - 有没有办法在 ASP.net 中设置 Tab 键顺序？

> ID：359583
> 
> 赞同：11
> 
> 时间：2008-12-11T14:44:17.017
> 
> 标签：.net, asp.net, html, asp.net-mvc

我正在尝试在项目的 html 端设置标签顺序。如何设置标签顺序。通常在 Visual Basic 中，该选项位于视图/选项卡 Order 下的菜单栏中。我如何在asp中做到这一点？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-12-11T14:48:04.840

将 TabIndex="x" 添加到可以接收焦点的每个控件，其中 x 是一个整数，指示控件的所需顺序。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-11T14:47:13.657

[在这里](http://stackoverflow.com/questions/234704/tabbing-behavior-in-webforms)回答：

例如：您可以使用 ASP 控件上的 TabIndex 属性进行设置。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-11T14:46:28.820

使用[TabIndex](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.webcontrol.tabindex.aspx)属性

# c# - .net 数据集主键 - 强制唯一性？

> ID：359589
> 
> 赞同：3
> 
> 时间：2008-12-11T14:44:56.423
> 
> 标签：c#, .net, datatable, dataset, primary-key

我有一个带有几个数据表的小数据集。我从各种数据库加载数据表，并读取了一个配置文件，以确定我想在给定数据表上强制执行的主键。如果配置不包含正确的（非唯一）主键，那么在将主键应用于数据表时如何捕获此事件？目前看来它允许我应用主键，即使它不是唯一的......

```
 DataTable dtbl = ds.Tables[t.tblname];

       DataColumn[] pks = new DataColumn[t.Get_Key_Columns().Count];
       int i = 0;
        foreach(DataColumn c in dtbl.Columns)
        {
            if(t.Get_Key_Columns().Exists(delegate(App_Column ac) 
                  {return (ac.column_name == c.ColumnName);}))
            {
                pks[i] = c;
                i++;
            }
        }
        try
        {
            dtbl.PrimaryKey = pks; 
        } 
         catch etc....... 
```

有人指出我缺少什么吗？谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-11T14:52:23.287

将它们添加为约束怎么样？

```
dt.Constraints.Add("PKC", Columns, true) 
```

如果仍然允许重复，.HasErrors 属性是否提供任何指示？

* * *

**从评论中**编辑：****

 **最终对 OP 有用的是这种解决方法：在填充表格*之前添加约束。*

# cocoa - .NET 的 Environment.SpecialFolder 的 Cocoa 等价物用于保存首选项/设置？

> ID：359590
> 
> 赞同：4
> 
> 时间：2008-12-11T14:45:46.373
> 
> 标签：cocoa, preferences

在 Xcode 中编写 Objective-C Cocoa 应用程序时，如何获取对存储每个用户每个应用程序设置的文件夹的引用？

在 .NET 中，我会使用`Environment.SpecialFolder`枚举：

```
Environment.GetFolderPath(Environment.SpecialFolder.ApplicationData); 
```

可可等价物是什么？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-12-11T15:55:51.020

在 Mac OSX 中，应用程序首选项通过 NSUserDefaults 自动存储，将它们保存到 .plist 文件`~/Library/Preferences/`中。你不需要对这个文件做任何事情，NSUserDefaults 会为你处理一切。

如果您在非基于文档的应用程序（例如 AddressBook.app）中有数据文件，则应将其存储在`~/Library/Application Support/Your App Name/`. 没有内置方法来查找或创建此文件夹，您需要自己做。这是我自己的一个应用程序的示例，如果您查看一些 Xcode 项目模板，您会看到类似的方法。

```
+ (NSString *)applicationSupportFolder;
{
    // Find this application's Application Support Folder, creating it if 
    // needed.

    NSString *appName, *supportPath = nil;
    NSArray *paths = NSSearchPathForDirectoriesInDomains( NSApplicationSupportDirectory, NSUserDomainMask, YES );

    if ( [paths count] > 0)
    {
        appName = [[NSBundle mainBundle] objectForInfoDictionaryKey:@"CFBundleExecutable"];
        supportPath = [[paths objectAtIndex:0] stringByAppendingPathComponent:appName];

        if ( ![[NSFileManager defaultManager] fileExistsAtPath:supportPath] )
            if ( ![[NSFileManager defaultManager] createDirectoryAtPath:supportPath attributes:nil] )
                supportPath = nil;
    }

    return supportPath;
} 
```

请记住，如果您的应用程序很受欢迎，您可能会收到请求，以便为共享同一帐户的不同用户提供多个库文件。如果您想支持这一点，约定是在应用程序启动时提示要使用的路径，并按住 alt/option 键。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-11T18:03:38.487

对于大多数东西，你应该只使用 NSUserDefaults API，它会为你在磁盘上持久化设置。

# c# - 识别活动网络接口

> ID：359596
> 
> 赞同：25
> 
> 时间：2008-12-11T14:48:44.293
> 
> 标签：c#, .net, networking

在 .NET 应用程序中，如何识别用于与给定 IP 地址通信的网络接口？

我在具有多个网络接口、IPv4 和 v6 的工作站上运行，我需要获取用于到给定数据库服务器的流量的“正确”接口的地址。

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2009-03-07T11:13:55.240

最简单的方法是：

```
UdpClient u = new UdpClient(remoteAddress, 1);
IPAddress localAddr = ((IPEndPoint)u.Client.LocalEndPoint).Address; 
```

现在，如果您想要 NetworkInterface 对象，您可以执行以下操作：

```
 foreach (NetworkInterface nic in NetworkInterface.GetAllNetworkInterfaces())
{
   IPInterfaceProperties ipProps = nic.GetIPProperties();
   // check if localAddr is in ipProps.UnicastAddresses
} 
```

Another option is to use P/Invoke and call [GetBestInterface()](http://msdn.microsoft.com/en-us/library/aa365920(vs.85).aspx) to get the interface index, then again loop over all the network interfaces. As before, you'll have to dig through `GetIPProperties()` to get to the `IPv4InterfaceProperties.Index` property).

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-11T17:22:12.003

这些都不会真正为 OP 提供他正在寻找的信息——他想知道哪个接口将用于到达给定的目的地。做你想做的事情的一种方法是使用 System.Diagnostics.Process 类对**路由**命令进行外壳处理，然后对输出进行屏幕抓取。 `route PRINT (destination IP)`会给你一些有用的东西。这可能不是*最好*的解决方案，但这是我现在可以给你的唯一解决方案。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-11T15:02:10.210

您所追求的信息将在 WMI 中。

这个使用 WMI 的示例可能会帮助您了解大部分情况：

```
using System.Management;
string query = "SELECT * FROM Win32_NetworkAdapterConfiguration";
ManagementObjectSearcher moSearch = new ManagementObjectSearcher(query);
ManagementObjectCollection moCollection = moSearch.Get();// Every record in this collection is a network interface
foreach (ManagementObject mo in moCollection)
{    
    // Do what you need to here....
} 
```

[Win32_NetworkAdapterConfiguration](http://msdn.microsoft.com/en-us/library/aa394217.aspx)类将为您提供有关适配器配置的信息，例如 IP 地址等。

您还可以查询[Win32_NetworkAdapter](http://msdn.microsoft.com/en-us/library/aa394216(VS.85).aspx)类以找出每个适配器的“静态”（最大速度、制造商等）

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-11T15:06:08.783

至少你可以从那开始，给你本地机器的 dns 中的所有地址。

```
IPHostEntry hostEntry = Dns.GetHostEntry(Environment.MachineName);

foreach (System.Net.IPAddress address in hostEntry.AddressList)
{
    Console.WriteLine(address);
} 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2013-11-20T10:09:38.627

Just to give a complete picture: another approach would be to use `Socket.IOControl( SIO_ROUTING_INTERFACE_QUERY, ... )`

ConferenceXP includes rather comprehensive function wrapping this, works with IPv4/6 and multicast addresses: [https://github.com/conferencexp/conferencexp/blob/master/MSR.LST.Net.Rtp/NetworkingBasics/utility.cs#L84](https://github.com/conferencexp/conferencexp/blob/master/MSR.LST.Net.Rtp/NetworkingBasics/utility.cs#L84)

# html - 用于 HTML 属性替换/添加的正则表达式

> ID：359601
> 
> 赞同：2
> 
> 时间：2008-12-11T14:49:38.923
> 
> 标签：html, regex

我正在寻找执行以下操作的单行正则表达式：

给定一个带有“name”属性的 HTML 标记，我想用我自己的属性替换它。如果该标签缺少名称属性，我想植入我自己的属性。结果应如下所示：

```
<IMG name="img1" ...> => <IMG name="myImg1" ...>
<IMG ...> => <IMG name="myImg1" ...> 
```

这可以用单行正则表达式完成吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-11T23:03:42.250

诀窍是匹配每个完整的“attribute=value”对，但只*捕获*属性名称不是“name”的那些。然后插入您自己的“名称”属性以及所有捕获的属性。

```
s/<IMG
  ((?:\s+(?!name\b)\w+="[^"]+")*)
  (?:\s+name="[^"]+")?
  ((?:\s+(?!name\b)\w+="[^"]+")*)
  >
 /<IMG name="myName"$1$2>
 /xg; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-11T15:44:28.750

这不是一个完美的解决方案，标签内的间距和位置可能不是您想要的，但它确实实现了目标。这是一个 perl 正则表达式，但没有什么特别的 perl 特定的。

```
s/(&lt;IMG)((\s+[^&gt;]*)name="[^"]*")?(.*)/$1$3 name="myID"$4/g 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-11T15:32:22.833

如果像在您的示例中一样，名称属性始终是 IMG 标记内的第一个属性，那么这很容易。搜索

`<(?!/)(/w+)\s+(name="[^"]+")?`

并替换为

`<\1 name="myImg1"`

但我怀疑这是你真正想要的。

如果 name 属性可以出现在其他位置，则变得更加困难。

# c# - 如何将 RGB 颜色转换为 HSV？

> ID：359612
> 
> 赞同：71
> 
> 时间：2008-12-11T14:53:36.030
> 
> 标签：c#, colors, rgb, hsv

如何使用 C# 将 RGB 颜色转换为 HSV？
我在不使用任何外部库的情况下搜索了一种快速方法。

* * *

## 回答 #1

> 赞同：114
> 
> 时间：2009-10-26T17:34:29.300

请注意`Color.GetSaturation()`并`Color.GetBrightness()`返回 HSL 值，而不是 HSV。
下面的代码演示了不同之处。

```
Color original = Color.FromArgb(50, 120, 200);
// original = {Name=ff3278c8, ARGB=(255, 50, 120, 200)}

double hue;
double saturation;
double value;
ColorToHSV(original, out hue, out saturation, out value);
// hue        = 212.0
// saturation = 0.75
// value      = 0.78431372549019607

Color copy = ColorFromHSV(hue, saturation, value);
// copy = {Name=ff3278c8, ARGB=(255, 50, 120, 200)}

// Compare that to the HSL values that the .NET framework provides: 
original.GetHue();        // 212.0
original.GetSaturation(); // 0.6
original.GetBrightness(); // 0.490196079 
```

以下 C# 代码是您想要的。[它使用Wikipedia](http://en.wikipedia.org/wiki/HSL_and_HSV)上描述的算法在 RGB 和 HSV 之间进行转换。范围为 0 - 360`hue`和 0 - 1 为`saturation`or `value`。

```
public static void ColorToHSV(Color color, out double hue, out double saturation, out double value)
{
    int max = Math.Max(color.R, Math.Max(color.G, color.B));
    int min = Math.Min(color.R, Math.Min(color.G, color.B));

    hue = color.GetHue();
    saturation = (max == 0) ? 0 : 1d - (1d * min / max);
    value = max / 255d;
}

public static Color ColorFromHSV(double hue, double saturation, double value)
{
    int hi = Convert.ToInt32(Math.Floor(hue / 60)) % 6;
    double f = hue / 60 - Math.Floor(hue / 60);

    value = value * 255;
    int v = Convert.ToInt32(value);
    int p = Convert.ToInt32(value * (1 - saturation));
    int q = Convert.ToInt32(value * (1 - f * saturation));
    int t = Convert.ToInt32(value * (1 - (1 - f) * saturation));

    if (hi == 0)
        return Color.FromArgb(255, v, t, p);
    else if (hi == 1)
        return Color.FromArgb(255, q, v, p);
    else if (hi == 2)
        return Color.FromArgb(255, p, v, t);
    else if (hi == 3)
        return Color.FromArgb(255, p, q, v);
    else if (hi == 4)
        return Color.FromArgb(255, t, p, v);
    else
        return Color.FromArgb(255, v, p, q);
} 
```

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2009-03-12T01:07:59.757

您是否考虑过简单地使用 System.Drawing 命名空间？例如：

```
System.Drawing.Color color = System.Drawing.Color.FromArgb(red, green, blue);
float hue = color.GetHue();
float saturation = color.GetSaturation();
float lightness = color.GetBrightness(); 
```

请注意，这并不完全符合您的要求（请参阅[HSL 和 HSV 之间的差异，](http://en.wikipedia.org/wiki/HSL_color_space)并且 Color 类没有从 HSL/HSV 转换回来，但后者相当[容易添加](https://web.archive.org/web/20120307233434/http://christogreeff.blogspot.com/2008/06/hsl-to-rgb-conversion-for-gdi.html).

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-12-11T14:57:43.963

这里有一个 C 实现：

[http://www.cs.rit.edu/~ncs/color/t_convert.html](http://www.cs.rit.edu/~ncs/color/t_convert.html)

转换为 C# 应该非常简单，因为几乎没有调用任何函数 - 只是计算。

通过[谷歌找到](http://www.google.de/search?q=rgb+hsv+algorithm)

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2012-10-09T21:45:58.197

EasyRGB[有](http://www.easyrgb.com)许多色彩空间转换。[这是](http://www.easyrgb.com/index.php?X=MATH&H=20#text20)RGB->HSV 转换的代码。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-07-27T10:51:28.810

这是从 BlaM 帖子中的 C 代码移植的 VB.net 版本，对我来说效果很好。

> 这里有一个 C 实现：
> 
> [http://www.cs.rit.edu/~ncs/color/t_convert.html](http://www.cs.rit.edu/%7Encs/color/t_convert.html)
> 
> 转换为 C# 应该非常简单，因为几乎没有调用任何函数 - 只是 > 计算。

* * *

```
Public Sub HSVtoRGB(ByRef r As Double, ByRef g As Double, ByRef b As Double, ByVal h As Double, ByVal s As Double, ByVal v As Double)
    Dim i As Integer
    Dim f, p, q, t As Double

    If (s = 0) Then
        ' achromatic (grey)
        r = v
        g = v
        b = v
        Exit Sub
    End If

    h /= 60 'sector 0 to 5
    i = Math.Floor(h)
    f = h - i 'factorial part of h
    p = v * (1 - s)
    q = v * (1 - s * f)
    t = v * (1 - s * (1 - f))

    Select Case (i)
        Case 0
            r = v
            g = t
            b = p
            Exit Select
        Case 1
            r = q
            g = v
            b = p
            Exit Select
        Case 2
            r = p
            g = v
            b = t
            Exit Select
        Case 3
            r = p
            g = q
            b = v
            Exit Select
        Case 4
            r = t
            g = p
            b = v
            Exit Select
        Case Else   'case 5:
            r = v
            g = p
            b = q
            Exit Select
    End Select
End Sub 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2021-10-28T19:32:20.753

I've ended up here by having the same need.

Bellow I'm sharing the best and simpler solution I could find so far.
This is a modified answer from Greg's ([found here](https://stackoverflow.com/questions/359612/how-to-convert-rgb-color-to-hsv)); but with a humbler and understandable code.

For those who are learning I've added a few references that are worth checking for the sake of understanding.

* * *

**References**

1.  ["Lukas Stratmann" HSV Model Tool (Incl. Other Model Systems: CMY / CMYK / HSL)](https://color.lukas-stratmann.com/color-systems/hsv.html)
2.  ["The HSV Color Model in Graphic Design"](https://www.lifewire.com/what-is-hsv-in-design-1078068)
3.  ["Formula to Determine Perceived Brightness of RGB Color"](https://stackoverflow.com/questions/596216/formula-to-determine-perceived-brightness-of-rgb-color)
4.  [Fastest Formula to Get Hue from RGB](https://stackoverflow.com/questions/23090019/fastest-formula-to-get-hue-from-rgb)
5.  ["Color Conversion Algorithms"](https://www.cs.rit.edu/%7Encs/color/t_convert.html)
6.  ["Program to Change RGB color model to HSV color model"](https://www.geeksforgeeks.org/program-change-rgb-color-model-hsv-color-model/)
7.  ["RGB to HSV Color Conversion Algorithm"](https://math.stackexchange.com/questions/556341/rgb-to-hsv-color-conversion-algorithm)
8.  ["RGB to HSV Color Space Conversion (C)"](https://web.archive.org/web/20150906055359/http://en.literateprograms.org/RGB_to_HSV_color_space_conversion_(C))
9.  ["How to Convert RGB Color to HSV"](https://stackoverflow.com/questions/359612/how-to-convert-rgb-color-to-hsv)

* * *

**Code**

```
 /// <summary> Convert RGB Color to HSV. </summary>
    /// <param name="color"></param>
    /// <returns> A double[] Containing HSV Color Values. </returns>
    public double[] rgbToHSV(Color color)
    {
        double[] output = new double[3];

        double hue, saturation, value;

        int max = Math.Max(color.R, Math.Max(color.G, color.B));
        int min = Math.Min(color.R, Math.Min(color.G, color.B));

        hue = color.GetHue();
        saturation = (max == 0) ? 0 : 1d - (1d * min / max);
        value = max / 255d;

        output[0] = hue;
        output[1] = saturation;
        output[2] = value;

        return output;
    } 
```

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2016-07-02T11:34:42.987

第一：确保你有一个颜色作为位图，像这样：

```
Bitmap bmp = (Bitmap)pictureBox1.Image.Clone();
paintcolor = bmp.GetPixel(e.X, e.Y); 
```

（e 来自事件处理程序，它选择了我的颜色！）

What I did when I had this problem a whilke ago, I first got the rgba (red, green, blue and alpha) values. Next I created 3 floats: float hue, float saturation, float brightness. Then you simply do:

```
hue = yourcolor.Gethue;
saturation = yourcolor.GetSaturation;
brightness = yourcolor.GetBrightness; 
```

The whole lot looks like this:

```
Bitmap bmp = (Bitmap)pictureBox1.Image.Clone();
            paintcolor = bmp.GetPixel(e.X, e.Y);
            float hue;
            float saturation;
            float brightness;
            hue = paintcolor.GetHue();
            saturation = paintcolor.GetSaturation();
            brightness = paintcolor.GetBrightness(); 
```

If you now want to display them in a label, just do:

```
yourlabelname.Text = hue.ToString;
yourlabelname.Text = saturation.ToString;
yourlabelname.Text = brightness.ToString; 
```

Here you go, you now have RGB Values into HSV values :)

Hope this helps

# asp.net-mvc - ASP.NET MVC：控制器 ViewData 和 ViewPage ViewData

> ID：359615
> 
> 赞同：0
> 
> 时间：2008-12-11T14:54:32.627
> 
> 标签：asp.net-mvc, model-view-controller

我似乎无法找到控制器的 ViewData 集合和 ViewPage 的 ViewData 集合之间的“链接”。谁能指出我在 MVC 框架中将控件的 ViewData 集合转移到 ViewPage 的 ViewData 集合的位置？

我花了很多时间使用 Reflector 来尝试解决这个问题，但我显然没有找对地方。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-11T15:18:48.570

Controller.View 方法将 ViewData 传输到 ViewResult。

ViewResult.ExecuteResult 将其传输到它的 ViewContext 中。

在 WebFormView 中，私有的 RenderViewPage 方法将 ViewData 从上下文参数传输到视图本身。基因的其他观点可能会有所不同。

# java - Spring-WS：如何将 WebserviceTemplate 与预先生成的 SOAP 信封一起使用

> ID：359620
> 
> 赞同：4
> 
> 时间：2008-12-11T14:56:13.450
> 
> 标签：java, web-services, spring, ws-security, spring-ws

您可以使用 Spring-WS WebserviceTemplate 来调用 Web 服务并避免它生成 SOAP 信封吗？也就是说，该消息已经包含一个 SOAP 信封，我不希望 WebserviceTemplate 将另一个包裹在它周围。:-)

我想要这个的原因是我想调用一个使用 ws-security 的 web 服务，并且不想将 ws-security 的东西放入 WebserviceTemplate，而只是想用预先生成的 ws-security 向它提供一条消息SOAP 信封中的信息。我尝试使用 Source 调用方法[sendSourceAndReceiveToResult](http://static.springsource.org/spring-ws/sites/1.5/apidocs/org/springframework/ws/client/core/WebServiceTemplate.html#sendSourceAndReceiveToResult(java.lang.String,%20javax.xml.transform.Source,%20javax.xml.transform.Result))已经包含带有 WS-Security 内容的 Soap-Envelope，并且 Web 服务模板环绕另一个 Soap-Envelope 并因此破坏了消息。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-06T07:58:55.107

您正在以一种奇怪的方式使用 ws-security ......我猜您正在尝试通过使用预先生成的消息来避免 ws-security 依赖 - 对于简单的客户端可能是有道理的，尽管它绝对不是书本上的.

您可以通过将 WebServiceTemplate 上的 messageFactory 设置为此 bean 来配置 WebServiceTemplate 以使用没有 SOAP 的纯 XML：

```
<bean id="webServiceTemplate" class="org.springframework.ws.client.core.WebServiceTemplate">
    <property name="messageFactory" ref="poxMessageFactory" />
</bean>    

<bean id="poxMessageFactory" class="org.springframework.ws.pox.dom.DomPoxMessageFactory" /> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-13T03:17:56.640

拦截器可以为您尝试做的事情派上用场。在此处查看拦截器层次结构：http: [//static.springframework.org/spring-ws/docs/1.0-m1/api/org/springframework/ws/EndpointInterceptor.html](http://static.springframework.org/spring-ws/docs/1.0-m1/api/org/springframework/ws/EndpointInterceptor.html) 您可以使用 spring-ws 注册 EndpointInterceptor 和操纵你喜欢的反应。

# java - 检测字符串是否为数字的最优雅方法？

> ID：359625
> 
> 赞同：8
> 
> 时间：2008-12-11T14:56:44.650
> 
> 标签：java, string, parsing, numbers

有没有更好，更优雅（和/或可能更快）的方式比

```
boolean isNumber = false;
try{
   Double.valueOf(myNumber);
   isNumber = true;
} catch (NumberFormatException e) {
} 
```

...？

* * *

**编辑**：由于我无法选择两个答案，我将使用正则表达式一个，因为a）它很优雅，b）说“Jon Skeet 解决了问题”是一个重言式，因为 Jon Skeet 自己是所有问题的解决方案。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-12-11T15:00:20.040

我不相信 Java 中内置了任何东西可以更快且更可靠地执行此操作，假设稍后您将希望使用 Double.valueOf （或类似的）实际解析它。

我会使用 Double.parseDouble 而不是 Double.valueOf 来避免不必要地创建 Double ，*而且*您还可以通过检查数字、e/E 和 - 来比异常更快地摆脱明显愚蠢的数字。预先。所以，像：

```
public boolean isDouble(String value)
{        
    boolean seenDot = false;
    boolean seenExp = false;
    boolean justSeenExp = false;
    boolean seenDigit = false;
    for (int i=0; i < value.length(); i++)
    {
        char c = value.charAt(i);
        if (c >= '0' && c <= '9')
        {
            seenDigit = true;
            continue;
        }
        if ((c == '-' || c=='+') && (i == 0 || justSeenExp))
        {
            continue;
        }
        if (c == '.' && !seenDot)
        {
            seenDot = true;
            continue;
        }
        justSeenExp = false;
        if ((c == 'e' || c == 'E') && !seenExp)
        {
            seenExp = true;
            justSeenExp = true;
            continue;
        }
        return false;
    }
    if (!seenDigit)
    {
        return false;
    }
    try
    {
        Double.parseDouble(value);
        return true;
    }
    catch (NumberFormatException e)
    {
        return false;
    }
} 
```

请注意，尽管尝试了几次，但这*仍然*不包括“NaN”或十六进制值。您是否希望这些通过取决于上下文。

以我的经验，正则表达式比上面的硬编码检查要慢。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-12-11T14:59:56.297

您可以使用正则表达式，即类似的东西`String.matches("^[\\d\\-\\.]+$");`（如果您不测试负数或浮点数，您可以简化一点）。

不确定这是否会比您概述的方法更快。

**编辑：**鉴于所有这些争议，我决定进行测试并获取一些有关每种方法的速度的数据。与其说是正确性，不如说是他们跑得有多快。

[你可以在我的博客上](http://sacrephill.wordpress.com/2008/12/15/how-to-over-analyse/)阅读我的结果。（提示：Jon Skeet FTW）。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-12-11T16:01:52.197

请参阅[java.text.NumberFormat](http://java.sun.com/j2se/1.5.0/docs/api/java/text/NumberFormat.html) (javadoc)。

```
NumberFormat nf = NumberFormat.getInstance(Locale.FRENCH);
Number myNumber = nf.parse(myString);
int myInt = myNumber.intValue();
double myDouble = myNumber.doubleValue(); 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-12-12T16:23:56.617

[Double javadocs](http://java.sun.com/javase/6/docs/api/java/lang/Double.html#valueOf(java.lang.String))中实际上给出了正确的正则表达式：

> 为避免在无效字符串上调用此方法并引发 NumberFormatException，可以使用下面的正则表达式来筛选输入字符串：

```
 final String Digits     = "(\\p{Digit}+)";
    final String HexDigits  = "(\\p{XDigit}+)";
    // an exponent is 'e' or 'E' followed by an optionally 
    // signed decimal integer.
    final String Exp        = "[eE][+-]?"+Digits;
    final String fpRegex    =
        ("[\\x00-\\x20]*"+  // Optional leading "whitespace"
         "[+-]?(" + // Optional sign character
         "NaN|" +           // "NaN" string
         "Infinity|" +      // "Infinity" string

         // A decimal floating-point string representing a finite positive
         // number without a leading sign has at most five basic pieces:
         // Digits . Digits ExponentPart FloatTypeSuffix
         // 
         // Since this method allows integer-only strings as input
         // in addition to strings of floating-point literals, the
         // two sub-patterns below are simplifications of the grammar
         // productions from the Java Language Specification, 2nd 
         // edition, section 3.10.2.

         // Digits ._opt Digits_opt ExponentPart_opt FloatTypeSuffix_opt
         "((("+Digits+"(\\.)?("+Digits+"?)("+Exp+")?)|"+

         // . Digits ExponentPart_opt FloatTypeSuffix_opt
         "(\\.("+Digits+")("+Exp+")?)|"+

   // Hexadecimal strings
   "((" +
    // 0[xX] HexDigits ._opt BinaryExponent FloatTypeSuffix_opt
    "(0[xX]" + HexDigits + "(\\.)?)|" +

    // 0[xX] HexDigits_opt . HexDigits BinaryExponent FloatTypeSuffix_opt
    "(0[xX]" + HexDigits + "?(\\.)" + HexDigits + ")" +

    ")[pP][+-]?" + Digits + "))" +
         "[fFdD]?))" +
         "[\\x00-\\x20]*");// Optional trailing "whitespace"

    if (Pattern.matches(fpRegex, myString))
        Double.valueOf(myString); // Will not throw NumberFormatException
    else {
        // Perform suitable alternative action
    } 
```

但是，这不允许本地化表示：

> 要解释浮点值的本地化字符串表示，请使用[NumberFormat](http://java.sun.com/javase/6/docs/api/java/text/NumberFormat.html)的子类。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-12-11T15:04:02.187

`StringUtils.isDouble(String)`在 Apache Commons 中使用。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-12-11T16:05:15.963

利用斯基特先生：

```
private boolean IsValidDoubleChar(char c)
{
    return "0123456789.+-eE".indexOf(c) >= 0;
}

public boolean isDouble(String value)
{
    for (int i=0; i < value.length(); i++)
    {
        char c = value.charAt(i);
        if (IsValidDoubleChar(c))
            continue;
        return false;
    }
    try
    {
        Double.parseDouble(value);
        return true;
    }
    catch (NumberFormatException e)
    {
        return false;
    }
} 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-12-11T15:01:53.300

我会一如既往地使用[Jakarta commons-lang ！](https://commons.apache.org/proper/commons-lang/javadocs/api-3.10/org/apache/commons/lang3/math/NumberUtils.html#isNumber-java.lang.String-)但我不知道[他们的实施](https://github.com/apache/commons-lang/blob/master/src/main/java/org/apache/commons/lang3/math/NumberUtils.java)是否很快。它不依赖于异常，这可能是一个很好的表现......

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-12-11T15:21:42.730

这些答案中的大多数都是*可以*接受的解决方案。所有正则表达式解决方案都存在一个问题，即对于您可能关心的所有情况*都不正确。*

如果你真的想确保 String 是一个有效的数字，那么我会使用你自己的解决方案。不要忘记，我想，大多数时候 String 将是一个*有效*数字并且不会引发异常。所以大多数时候性能与 Double.valueOf() 相同。

我想这真的不是一个答案，只是它验证了你最初的直觉。

兰迪

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-12-11T15:14:42.447

按照菲尔的回答，我可以建议另一个正则表达式吗？

```
String.matches("^-?\\d+(\\.\\d+)?$"); 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-12-15T13:53:16.230

我更喜欢在字符串的 char[] 表示上使用循环并使用 Character.isDigit() 方法。如果需要优雅，我认为这是最*易读*的：

```
package tias;

public class Main {
  private static final String NUMERIC = "123456789";
  private static final String NOT_NUMERIC = "1L5C";

  public static void main(String[] args) {
    System.out.println(isStringNumeric(NUMERIC));
    System.out.println(isStringNumeric(NOT_NUMERIC));
  }

  private static boolean isStringNumeric(String aString) {
    if (aString == null || aString.length() == 0) {
      return false;
    }
    for (char c : aString.toCharArray() ) {
      if (!Character.isDigit(c)) {
        return false;
      }
    }
    return true;
  } 
```

}

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2008-12-12T16:24:19.283

如果你想要一个非常快的东西，并且你非常清楚你想要接受什么格式，你可以手动构建一个状态机[DFA](http://en.wikipedia.org/wiki/Deterministic_finite-state_machine)。无论如何，这基本上是正则表达式在后台工作的方式，但是您可以通过这种方式避免正则表达式编译步骤，而且它可能比通用正则表达式编译器更快。

# .net - 使用 wpf/linq 到 sql 的主细节绑定

> ID：359627
> 
> 赞同：1
> 
> 时间：2008-12-11T14:57:29.783
> 
> 标签：.net, sql, wpf, linq

我正在尝试在 wpf 中创建 linq to sql 关系的主详细信息视图。该视图将有两个组合框。一个用于选择主项目，另一个用于选择详细项目。

我使用包含两个表和表之间关系的 ADO.Net 数据集实现了这一点。其中第一个组合框绑定到主字段，第二个组合框绑定到关系。

```
DataContext="{Binding Source={StaticResource ContactDataSet}, Path=Company}" 
```

掌握

```
<ComboBox Name="comboBox_CompanyName" 
          ItemsSource="{Binding}"
          DisplayMemberPath="Company"
          IsSynchronizedWithCurrentItem="True"
          /> 
```

详细信息，Company2Contact 是关系

```
<ComboBox Name="comboBox_ContactName" 
          ItemsSource="{Binding Path=Company2Contact}"
          DisplayMemberPath="Contact"                                  
          IsSynchronizedWithCurrentItem="True"                                  
          /> 
```

我希望使用 linq to SQL 来获得类似的结果。如果将 wpf 数据上下文设置为 linqDataContext，我可以绑定到主数据，但不能绑定到关系。

我查看了 datacontext 对象，它似乎已正确设置。每个公司对象都存在并包含联系人对象的集合。

有谁知道如何绑定到存储在所选公司对象中的联系人对象集合？

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-11T18:39:36.900

如果启用延迟加载（默认情况下），则仅在需要时检索您的子对象（即在第二个数据绑定访问它们时）。但是，要使延迟加载正常工作，数据上下文需要保持活动状态。如果您正在加载主/详细对象，但只是查询主对象的数据上下文，此时它实际上并没有检索到详细信息。

另一个选项是使用数据上下文的 LoadWith 选项。您需要指定在加载主对象时还需要详细对象。

就我个人而言，我在做什么（这可能很有争议），但我倾向于让 DataContext 在我的屏幕生命周期内保持活跃。它使事情变得如此简单，并且根本没有性能受到影响。我在我的 ViewModel 中执行此操作。我在那里保留了对 DataContext 的引用。

# asp.net - 在 try/catch 块中包装 Web 服务

> ID：359633
> 
> 赞同：5
> 
> 时间：2008-12-11T14:59:58.000
> 
> 标签：asp.net, web-services, wcf, exception

将 Web 服务方法/调用包装到 try/catch 块中是最佳实践吗？

我不 Web 服务请求往往是 .NET 桌面应用程序崩溃的原因？所以我想所有的调用都应该包含在 try/catch 中以防止这种情况发生。

好主意？

另外，它应该抛出异常还是只有一个空捕获？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-15T13:36:46.637

我假设您正在使用 WCF，因为您的问题已被标记。使用 WFC 处理异常的一个好的做法是不允许异常通过网络冒泡到您的使用者，而是抛出有意义的 FaultExceptions。

如果它有可能产生异常，你应该在你的操作中总是有一个 try...catch 块。如果您允许原始异常冒泡，则只会导致两种情况：如果您已将服务配置为在故障中允许异常详细信息，您将暴露服务的内部结构，从而为安全漏洞打开自己的大门。或者您没有在您的服务中配置此功能，并且消费者会收到一条非常通用的消息，表明出现了问题，这对他们或支持团队来说不是很有用。

您应该做的是声明一个或多个 FaultExceptions，具体取决于您希望用户从您的操作中接收哪些消息，在您的操作声明中将它们装饰为 FaultContracts。然后您可以尝试...捕获特定异常并抛出特定故障。你也可以有一个 try...catch 来捕获异常并抛出一个非常普遍的错误。

这里的关键是不要透露太多关于内部操作的信息——尤其是堆栈跟踪！

错误只是另一个数据协定，因此它在您的 WSDL 中声明。这意味着您的消费者可以专门捕获故障，并且可以对您的操作引发的故障做出反应，就好像它是从他们的代码中抛出的异常一样。

希望这可以帮助。

乔。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-11T15:28:19.470

没关系，但尝试只捕获您可以处理的异常类型。

避免捕获任何“异常”，或者，如果这样做，请记录和/或提醒用户和/或重试调用 Web 服务。

如果它是 Windows 窗体应用程序，我通常将最后一个“异常”捕获包装在 #if DEBUG 块中，以避免在调试或测试时隐藏异常。

```
#if !DEBUG
catch (Exception ex)
{
    // show messagebox, log, etc
}
#endif 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-11T15:11:53.060

是的，您应该将 Web 服务调用包装在 try-catch 中。不要使用空捕获，因为它们（大部分）是纯粹的邪恶。你的 catch 块至少应该记录异常。我不知道您的应用程序逻辑，但可能应该向用户显示一些消息（例如“由于技术错误而未获取来自服务的信息”）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-01-04T12:57:58.820

```
using System;
using System.ServiceModel;
using Entities; //my entities
using AuthenticationService; //my webservice reference

namespace Application.SL.Model
{
    public class AuthenticationServiceHelper
    {
        /// <summary>
        /// User log in
        /// </summary>
        /// <param name="callback"></param>
        public void UserLogIn(Action<C48PR01IzhodOut, Exception> callback)
        {
            var proxy = new AuthenticationServiceClient();

        try
        {
            proxy.UserLogInCompleted += (sender, eventargs) =>
            {
                var userCallback = eventargs.UserState as Action<C48PR01IzhodOut, Exception>;
                if (userCallback == null)
                    return;

                if (eventargs.Error != null)
                {
                    userCallback(null, eventargs.Error);
                    return;
                }
                userCallback(eventargs.Result, null);
            };
            proxy.UserLogInAsync(callback);
        }
        catch (Exception ex)
        {
            proxy.Abort();
            ErrorHelper.WriteErrorLog(ex.ToString());
        }
        finally
        {
            if (proxy.State != CommunicationState.Closed)
            {
                proxy.CloseAsync();
            }
        }
        }
} 
```

这是一个好的做法还是有改进的余地？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-11T15:09:32.130

这是一种可能导致抛出异常的情况，所以是的，它应该被包装在 try catch 块中。

如何处理异常处理程序取决于程序逻辑......

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-11T15:11:50.720

将 Web 服务方法放在 try catch 块中是一个好主意，正如您所说，您不想因为 Web 服务方法出现问题而使调用应用程序崩溃。

此外，与其将异常抛回给客户端，后者无论如何也无能为力，您可以考虑让您的所有 Web 服务方法返回一个可以包含调用状态的结构或小类，一个错误代码以及可以解释错误的友好消息。

# apache-flex - Flex：在 actionscript 中实现经典的 curry 函数？

> ID：359635
> 
> 赞同：7
> 
> 时间：2008-12-11T15:00:46.203
> 
> 标签：apache-flex, actionscript-3

在具有良好语法的动作脚本中实现经典咖喱函数的最佳方法是什么？

我试过了：

```
Function.prototype.curry = function()
{
return "helloWorld";
}

trace((function():void {}).curry()); 
```

...方法，但没有奏效。

我想我陷入了一种丑陋的方法，例如：

```
FunctionUtils.curry(fp, ... args) 
```

？？？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-13T15:57:14.177

我必须承认我从来没有理解“咖喱”和“部分”之间的区别。我使用以下功能或多或少地做你想做的事情：

```
package {
  public function partial( func : Function, ...boundArgs ) : Function {
    return function( ...dynamicArgs ) : * {
      return func.apply(null, boundArgs.concat(dynamicArgs))
    }
  }
} 
```

使用示例：

```
var multiply : Function = function( a : Number, b : Number ) : Number { return a * b; }
var multiplyByFour : Function = partial(multiply, 4);

trace(multiplyByFour(3)); // => 12 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-11T15:45:07.237

结束（深受dojo实施的启发）：

```
public static function curry(func:Function, ... args:Array):*
{
    var arity:int = func.length;
    var currying:Function = function(func:Function, arity:int, args:Array):*
    {
        return function(... moreArgs:Array):* {
            if(moreArgs.length + args.length < arity)
            {
                return currying(func, arity, args.concat(moreArgs));
            }
            return func.apply(this, args.concat(moreArgs));
        }
    }
    return currying(func, arity, args);
} 
```

在评论部分请求显示如何使用它的示例：

```
function foo(i:int, j:int):void
{
   trace(i+j);
}

function bar(fp:Function):void
{
   fp(2);
}

bar(FunctionUtils.curry(foo, 1)); //trace==3 
```

愚蠢的例子，我知道，但是 curry:ing 非常有用。看看[http://www.svendtofte.com/code/curried_javascript/](http://www.svendtofte.com/code/curried_javascript/)的理论。

# javascript - 从 EXTJS 组合框的 JSON 存储中检索 url 参数

> ID：359643
> 
> 赞同：1
> 
> 时间：2008-12-11T15:03:12.797
> 
> 标签：javascript, c#, extjs, combobox, datastore

我在从 C# 中的代码隐藏页面中检索 EXTJS 中组合框的 JSON 存储的 URL 部分的参数时遇到问题。以下是商店中的代码：

```
var ColorStore = new Ext.data.JsonStore({
    autoLoad: true,
    url: '/proxies/ReturnJSON.aspx?view=rm_colour_view',
    root: 'Rows',
    fields: ['company', 'raw_mat_col_code', 'raw_mat_col_desc']
}); 
```

以下代码在我的代码后台页面中：

```
protected void Page_Load(object sender, EventArgs e)
{
    string jSonString = "";
    connectionClass.connClass func = new connectionClass.connClass();
    DataTable dt = func.getDataTable("sELECT * from rm_colour_view");
    //Response.Write(Request.QueryString["view"]);
    string w = Request.Params.Get("url");
    string z = Request.Params.Get("view");
    string x = Request.Params.Get("view=");
    string c = Request.Params.Get("?view");
    string s = Request.QueryString.Get("view");
    string d = Request.Params["?view="];
    string f = Request.Form["ColorStore"];
    jSonString = Serialize(dt);
    Response.Write(jSonString);
} 
```

该字符串`w`具有以下输出：

> /proxies/ReturnJSON.aspx

但是，所有其他字符串都返回`null`。

如何`rm_colour_view`从数据存储中检索？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-12T11:36:12.560

Try the following:

```
string s = Request.QueryString("view") 
```

# asp.net-mvc - 如何使用 Autofac 确保每个请求都有一个 NHibernate ISession？

> ID：359644
> 
> 赞同：3
> 
> 时间：2008-12-11T15:03:24.997
> 
> 标签：asp.net-mvc, nhibernate, dependency-injection, autofac

我在 Application_Start 方法中使用的 Autofac 模块中有以下代码：

```
builder.Register(c => new Configuration().Configure().BuildSessionFactory())
    .SingletonScoped();
builder.Register(c => c.Resolve<ISessionFactory>().OpenSession())
    .HttpRequestScoped();

builder.Register<NHibernateSomethingRepository>().As<ISomethingRepository>(); 
```

存储库的构造函数将 ISession 作为参数。但是我最终得到了整个应用程序的一个会话，即使我明确要求它是 HttpRequestScoped。

我已经配置了 ContainerDisposal HTTP 模块。

根据[文档](http://code.google.com/p/autofac/wiki/DeterministicDisposal)，您必须创建一个嵌套容器，但我让 Autofac 自动装配依赖项。

我该怎么办？

谢谢！

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-12T10:00:27.480

我发现了问题，所以我将回答我自己的问题。

我使用默认范围注册了我的存储库，在 Autofac 中是单例范围。我应该这样做：

```
builder.Register<NHibernateSomethingRepository>()
    .As<ISomethingRepository>()
    .HttpRequestScoped; 
```

# asp.net - 允许在线注释 PDF 文件的 ASP.NET 组件

> ID：359656
> 
> 赞同：1
> 
> 时间：2008-12-11T15:08:31.477
> 
> 标签：asp.net, pdf, components

我们正在尝试开发一个应用程序来查看和注释 ASP.net 中的 PDF 文件。

该功能涉及通过单击捕获 x,y 坐标并将注释放置在该特定位置。

是否有可用的组件来执行此操作？

提前致谢。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-18T14:02:37.293

I've used [iTextSharp](http://itextsharp.sourceforge.net/) in the past, to annotate PDFs of Piping & Instrumentation diagrams - worked rather well.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-18T13:14:02.807

我们还在qoppa 上[查看](https://www.qoppa.com/pdfnotes/)了**jPDFNotes**，并取得了不错的效果。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-07T11:52:11.920

我们也在研究这个，发现[这个 Java 小程序](http://www.qoppa.com/pdfnotes/jpnindex.html)做得很好。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-11T20:00:15.413

我不确定我是否有足够的信息来为您的问题提供具体答案，但也许这些信息可以让您开始......

如果我理解正确，您将提供一些 UI，使用户能够在查看文档时指向注释的位置，然后您将在服务器上修改 PDF，并在所选点处使用注释呈现它由用户。

您可以捕获鼠标输入以使用户能够选择注释位置的一种方法可能是呈现 PDF 文档页面的图像并将其显示在页面上，然后在单击事件上捕获鼠标位置。

然后，如果您有注释和所需位置，则可以使用 PDF 库更新 PDF 并将注释绘制到指定页面上指定 X、Y 坐标的文档中。

我们正在使用一个我们非常满意的 PDF 生成库来在 Web 服务器上呈现 PDF 文档，我们通过我们的 ASP.NET 应用程序将其交付给浏览器。

您可能想看看这个产品，看看它是否能满足您的需求： ceTe 软件中的 DynamicPDF：[http ://dynamicpdf.com/](http://dynamicpdf.com/)

希望这可以帮助。

# testing - 你如何模拟你的存储库？

> ID：359657
> 
> 赞同：8
> 
> 时间：2008-12-11T15:08:53.380
> 
> 标签：testing, repository-pattern, mocking

我使用 Moq 来模拟我的[存储库](http://martinfowler.com/eaaCatalog/repository.html)。但是，最近有人说他们更喜欢创建存储库接口的硬编码测试实现。

每种方法的优缺点是什么？

**编辑：**通过指向 Fowler 的链接阐明了存储库的含义。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-11T15:23:39.450

我通常会看到存储库的两种情况。我要求一些东西，我得到它，或者我要求一些东西，它不存在。

如果您正在模拟您的存储库，这意味着您的被测系统 (SUT) 正在使用您的存储库。因此，您通常希望测试您的 SUT 在从存储库中获得对象时是否正确运行。而且您还想测试它是否正确地处理了当您期望取回某些东西而没有取回或不确定您是否要取回某些东西时的情况。

如果您正在进行集成测试，硬编码的测试替身是可以的。比如说，你想保存一个对象，然后取回它。但这是在测试两个对象的交互，而不仅仅是 SUT 的行为。他们是两个不同的东西。如果您开始编写虚假存储库，则还需要对它们进行单元测试，否则您最终会将代码的成功和失败建立在未经测试的代码上。

这就是我对 Mocking vs. Test Doubles 的看法。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-11T15:36:33.650

信噪比：

“你称自己为仓库？我见过容量更大的火柴盒！”

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-11T15:22:01.073

我假设“存储库”是指[DAO](http://en.wikipedia.org/wiki/Data_Access_Object)；如果不是，那么这个答案将不适用。

最近我一直在做我的 DAO 的“内存中”“模拟”（或测试）实现，它基本上是根据传递给模拟构造函数的数据（列表、地图等）进行操作的。这样，单元测试类可以自由地输入测试所需的任何数据，可以更改它等，而不会强制对“内存中”DAO 上运行的所有单元测试进行编码以使用相同的测试数据。

我在这种方法中看到的一个优点是，如果我有十几个单元测试需要使用相同的 DAO 进行测试（例如，注入到被测类中），我不需要记住所有的每次测试数据的详细信息（就像“模拟”被硬编码一样） - 单元测试自己创建测试数据。不利的一面是，这意味着每个单元测试都必须花费几行代码来创建和连接它的测试数据；但这对我来说是一个小缺点。

代码示例：

```
public interface UserDao {
    User getUser(int userid);
    User getUser(String login);
}

public class InMemoryUserDao implements UserDao {

    private List users;

    public InMemoryUserDao(List users) {
        this.users = users;
    }

    public User getUser(int userid) {
        for (Iterator it = users.iterator(); it.hasNext();) {
            User user = (User) it.next();
            if (userid == user.getId()) {
                return user;
            }
        }

        return null;
    }

    public User getUser(String login) {
        for (Iterator it = users.iterator(); it.hasNext();) {
            User user = (User) it.next();
            if (login.equals(user.getLogin())) {
                return user;
            }
        }

        return null;
    }
} 
```

# c++ - 如何从 MSXML::IXMLDOMElement 中获取值数据

> ID：359660
> 
> 赞同：2
> 
> 时间：2008-12-11T15:09:39.103
> 
> 标签：c++, xml, msxml

我有一个 xml 字符串

```
<grandparent>
   <parent>
       <child>dave</child>
       <child>laurie</child>
       <child>gabrielle</child>
   </parent>
</grandparrent> 
```

我想要得到的是父级内部的数据原始 xml。我正在使用 MSXML

```
iXMLElm->get_xml(&bStr); 
```

正在返回

```
<parent>
   <child>dave</child>
   <child>laurie</child>
   <child>gabrielle</child>
</parent> 
```

.

```
iXMLElm->get_text(&bStr); 
```

返回 davelauriegabrielle

**如果我想获得，我应该使用什么功能？**

```
<child>dave</child>
   <child>laurie</child>
   <child>gabrielle</child> 
```

有人知道关于这些功能的一些好的文档吗？我所看到的一切都是一个相关的噩梦。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-11T15:19:34.183

迭代子节点并手动构建字符串。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-11T21:59:24.203

如果您使用的是 MSXML，这应该是获取祖父节点的子节点的情况。

所以，如果`iXMLElm`是祖父母并且它只有一个子节点，你可以使用...

```
 iXMLElm->get_firstChild(&iXMLChildElm) 
```

...接着...

```
 iXMLChildElm->get_xml(&bStr) 
```

...获得三个`child`元素。

如果下面有多个项目，则`grandparent`可以`selectSingleNode`改用 XPath 来选择具有所需内部 XML 的节点。

[MSDN 文档](http://msdn.microsoft.com/en-us/library/ms757048(VS.85).aspx)在可用的接口和调用上是相当合理的。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2011-06-07T06:09:07.663

如果您使用的是 IXMLDOMElement，那么

```
HRESULT getAttribute(
    BSTR name,
    VARIANT *value); 
```

是方法，其中“名称”是属性名称，“值”是输出参数，它将包含字符串格式的属性值。

# svn - 我可以看到谁从我的颠覆服务器上签出了什么吗？

> ID：359665
> 
> 赞同：2
> 
> 时间：2008-12-11T15:11:07.570
> 
> 标签：svn, logging

有谁知道谁连接到我的颠覆服务器的日志以及他们用它做了什么？

我正在寻找签出的时间和文件。

我假设它在某处有类似网络服务器日志的东西，但我找不到它。

编辑：从下面的回复中，我不知道有不同的方式来做 svn 服务器。我将 svnserve 作为 Windows 包装器上的服务运行。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-11T15:16:42.473

你没有说你的 SVN 服务器实际上是什么。如果它是 svnserve，那么默认情况下它不会保留日志，而且我不知道它可以配置为这样做，尽管我可能已经过时了。

如果您使用的是 Apache/mod_svn，那么您需要查看 Apache 日志记录。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-11T16:14:07.023

这个程序并没有完全按照你的要求做，但我认为它会给你真正想要的洞察力：CommitMonitor 监视 Subversion 存储库中的新提交，并在发生这种情况时向用户显示通知。本质上，它位于您的托盘通知区域并弹出警报（如 MSN），让您了解对存储库的新提交并为您提供更新文件的完整列表 - 双击每个条目以查看每个单独文件的差异。

[提交监控网站](http://code.google.com/p/commitmonitor/)

# sharepoint - 如何确定文件是否存在于 SharePoint SPFolder 中

> ID：359672
> 
> 赞同：18
> 
> 时间：2008-12-11T15:13:54.117
> 
> 标签：sharepoint

除了遍历 SPFolder 中的文件以确定给定文件名（字符串）是否存在之外，还有其他方法吗？

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2008-12-12T19:26:57.810

如果您知道 URL，您也可以使用 SPFile.Exists 属性，如下所示：

```
using (SPSite site = new SPSite("http://server/site"))
using (SPWeb web = site.OpenWeb())
{
  SPFile file = web.GetFile("/site/doclib/folder/filename.ext");
  if (file.Exists)
  {
    ...
  }
} 
```

如果文件不存在，首先会假设 SPWeb.GetFile 会引发异常。但如您所见，情况并非如此——它实际上会返回一个 SPFile 对象。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2011-11-04T14:46:03.233

但是，如果您使用的是 SP 2010 Client OM，如果文件不存在，它实际上会引发异常：

```
using(var clientContext = new ClientContext(site))
{
     Web web = clientContext.Web;
     Microsoft.SharePoint.Client.File file = web.GetFileByServerRelativeUrl("/site/doclib/folder/filename.ext");
     bool bExists = false;
     try
     {
         clientContext.Load(file);
         clientContext.ExecuteQuery(); //Raises exception if the file doesn't exist
         bExists = file.Exists;  //may not be needed - here for good measure
     }
     catch{   }

     if (bExists )
     {
           .
           .
     }
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-11T15:23:49.667

使用[CAML](http://msdn.microsoft.com/en-us/library/ms467521.aspx)查询是最有效的方式（[此处为示例](http://www.devx.com/dotnet/Article/31762/0/page/1)）

CAML 可能有点笨拙，因此也值得看看[Linq to Sharepoint](http://www.codeplex.com/LINQtoSharePoint)提供程序，它对您隐藏了 CAML 的详细信息。

# algorithm - 随机但规则的多边形生成器

> ID：359673
> 
> 赞同：2
> 
> 时间：2008-12-11T15:14:32.603
> 
> 标签：algorithm

我正在寻找一种在给定矩形或圆的扇区内生成一组随机边但规则的多边形的方法。为了更好地解释，我给定的 2d 空间应该随机排列具有不同边数的正多边形，因此，例如，如果两个六边形被一个边长相等的矩形隔开，整个空间不能只填充更多六边形，可能需要一些三角形等。

我正在寻找一种万花筒效果的一部分。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-11T16:52:21.453

您正在寻找平铺算法。例如，请参阅[Penrose Tiler](http://www.westmaster.com/zidek/research/ "彭罗斯平铺机")和[Tilings 和 Tesselations](http://www.scienceu.com/geometry/articles/tiling/index.html "平铺和镶嵌")页面。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-12T05:46:12.733

我能想到的另一种方法：首先决定你想要多少个对象。说“N”

在您的 2D 空间中随机选择 3 个点。

利用 3 个点得到一个虚拟三角形。

现在选择另一个点，使该点位于虚拟三角形之外。现在通过将此点连接到前一个虚拟三角形的2个点来形成另一个虚拟三角形，然后递归地形成“N”个虚拟三角形。如果虚拟三角形交叉，则忽略较大的三角形并将由于交叉点而形成的三角形作为新的虚拟三角形

现在为所有虚拟三角形生成一个 INSCRIBED 圆，这些虚拟三角形将永远无法与另一个虚拟三角形相交，因为所有虚拟三角形都是通过不与上述任何三角形相交而形成的。

通过将 360 度分成相等的切片，利用虚拟圆形成任意数量的规则边。现在您可以绘制随机正多边形

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-11T15:31:54.860

我不确定我是否理解要求，但您可以通过随机生成以下数字来生成随机正多边形：

*   半径（0 到任何值）
*   中心的 x 和 y（必须在边缘的半径内）
*   点数（3到任何）
*   旋转（0 到 360）

为防止重叠，您可以针对每个现有多边形测试每个新多边形，如果中心之间的距离小于半径之和，则拒绝新多边形。

绘制多边形是一个简单的三角练习。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-01-21T20:41:10.743

请参阅：“[生成随机多边形的启发式](http://www.cccg.ca/proceedings/1996/cccg1996_0007.pdf)”

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-12T11:22:28.810

在一个平面上生成N个随机点并提取对象的凸包（即如果所有多边形都应该是凸的）。

如果其中一个点在另一个多边形内，您可以在生成凸包之前轻松拒绝。如果不是，您仍然需要针对附近的其他多边形测试生成的多边形。（如果你需要经常这样做，空间数据结构可能是一个需要研究的东西）。

# java - 没有架构的 Java REST 客户端

> ID：359675
> 
> 赞同：10
> 
> 时间：2008-12-11T15:15:14.660
> 
> 标签：java, xml, jaxb, jax-rs

## 目标

雅虎 HotJobs [Resumé Search REST API](http://developer.yahoo.com/hotjobs/resume_search_user_guide/index.html)的 Java 客户端。

## 背景

我习惯于为 SOAP API 编写 Web 服务客户端，其中[wsimport](https://jax-ws.dev.java.net/jax-ws-ea3/docs/wsimport.html)会生成代理存根，而您正在运行。但这是一个 REST API，对我来说是新的。

## 细节

*   [REST](http://en.wikipedia.org/wiki/Representational_State_Transfer) API
*   没有[WADL](http://en.wikipedia.org/wiki/Web_Application_Description_Language)
*   没有正式的 XML 模式（XSD 或 DTD 文件）。有[示例 XML 请求/响应对](http://developer.yahoo.com/hotjobs/resume_search_user_guide/auth.html)。
*   未提供示例代码

## 进步

我看了问题[Rest clients for Java?](https://stackoverflow.com/questions/221442/rest-clients-for-java) ，但是那里的自动化解决方案假定您同时提供服务器和客户端，并在 POJO 上调用 JAXB 以生成模式和 REST API。

使用[Jersey](http://jersey.java.net/)（一个[JAX-RS](http://jcp.org/en/jsr/detail?id=311)实现），我已经能够发出手动 HTTP 请求：

```
import com.sun.jersey.api.client.*;

...

ClientConfig clientConfig = new DefaultClientConfig();
Client client = Client.create(clientConfig);

WebResource webResource = client.resource("https://hj.yahooapis.com/v1/HJAuthTokens");
webResource.accept("application/xml");

// body is a hard-coded string, with replacements for the variable bits
String response = webResource.post(String.class, body);

// parse response into a org.w3c.dom.Document
// interface with Document via XPATH, or write my own POJO mappings 
```

响应可能如下所示：

```
<?xml version="1.0" encoding="utf-8"?>   
<Response>   
    <ResponseCode>0</ResponseCode>   
    <ResponseMessage>Login successful</ResponseMessage>
    <Token>NTlEMTdFNjk3Qjg4NUJBNDA3MkJFOTI3NzJEMTdDNDU7bG9jYWxob3N0LmVnbGJwLmNvcnAueWFob28uY29tO0pVNWpzRGRhN3VhSS4yQVRqRi4wWE5jTWl0RHVVYzQyX3luYWd1TjIxaGx6U0lhTXN3LS07NjY2MzM1OzIzNDY3NTsxMjA5MDE2OTE5OzZCM1RBMVNudHdLbl9VdFFKMFEydWctLQ==</Token>   
</Response> 
```

或者，它可能看起来像：

```
<?xml version="1.0" encoding="utf-8"?>   
<yahoo:error xmlns:yahoo="http://www.yahooapis.com/v1/base.rng" xml:lang="en-US">   
    <yahoo:description>description</yahoo:description>   
    <yahoo:detail>   
        <ErrorCode>errorCode</ErrorCode>   
    </yahoo:detail>   
</yahoo:error> 
```

## 问题

*   有没有办法自动生成可以在没有正式模式的情况下编组/解组的[POJO ？](http://en.wikipedia.org/wiki/POJO)
*   我是否应该尝试使用[JAXB](http://jaxb.java.net/)注释手动生成这些 POJO？
*   ***是否有一些我应该利用的工具，所以我不必手动完成所有这些操作？***

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-11T15:32:02.270

有趣的是，他们提供了一个 HTTP URL 作为模式的命名空间 URI，但实际上并没有将他们的模式保存在那里。这可能是他们的疏忽，电子邮件或讨论列表张贴可以纠正。

一种方法是创建您自己的模式，但这似乎需要做很多工作却收效甚微。鉴于消息是如此简单，我想知道您是否甚至需要一个 POJO 来包装它们？为什么不使用 XPath 提取所需数据的处理程序呢？

* * *

编辑：过去的爆炸，但我看到了评论，重新阅读了这个问题，并意识到第一句话很难理解。所以，澄清：

如果您要编写可公开访问的 Web 服务，一个非常好的习惯是使您的架构文档在您用于架构的命名空间 URI 的同一 URL 上可用——或者更好的是，让该 URL 成为要完成的链接文档（W3C XSD 命名空间本身就是一个很好的例子：[http](http://www.w3.org/2001/XMLSchema) ://www.w3.org/2001/XMLSchema ）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-28T00:59:01.767

我建议手工编写 bean，并且仅在必要时使用 JAXB 注释进行注释。对于大多数访问器/突变器（getter/setter），您不必这样做；默认情况下，所有公共 bean 访问器和字段都被考虑，名称是使用 bean 约定派生的，默认是使用元素而不是属性（因此需要对属性进行注释）。

或者，如果您非常喜欢 W3C Schema，您当然可以手动编写模式，使用 JAXB 生成 bean。并且只需使用生成的代码而不是模式来进行数据绑定。

至于 POJO：这可以很简单。就像是：

```
@XmlRootElement("Response")
class Response {
  public int responseCode;
  public String responseMessage;
  public String token; // or perhaps byte[] works for automated base64?
} 
```

对于其他人也是如此。或者，如果您喜欢它们并且不介意更多冗长，请使用 getter/setter。这些只是数据容器，不需要太花哨。

如果您必须从内容中自动检测类型，请考虑使用 Stax 解析器来查看根元素，然后使用 JAXB Unmarshaller 进行绑定，将指向该根元素的 XMLStreamReader 交给它。这样你就可以传递不同的对象类型来绑定。

最后：发送/接收请求：普通的旧 HttpURLConnection 适用于 GET 和 POST 请求（例如，使用 URL.openConnection() 构建）。如果需要，Jakarta HttpClient 具有更多功能。因此，您通常并不需要单独的 REST 客户端——它们可能会派上用场，但通常构建在简单的 http 客户端部分之上。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-15T00:49:36.830

我发现 HTTP4E 对于进行 REST 调用非常有用。这是一个很棒的 Eclipse 插件，它有选项卡、语法着色、自动建议、代码生成、REST HTTP 调用重放等。它在 HTTP 调试、HTTP 篡改、黑客攻击方面做得很好。我玩得很开心。

[http://www.ywebb.com/](http://www.ywebb.com/)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-06-29T08:14:25.013

`JdkRequest`从[jcabi-http](http://http.jcabi.com/)尝试（我是开发人员）。这是它的工作原理：

```
String body = new JdkRequest("http://www.google.com")
  .header("User-Agent", "it's me")
  .fetch()
  .body() 
```

查看此博客文章了解更多详细信息：[http ://www.yegor256.com/2014/04/11/jcabi-http-intro.html](http://www.yegor256.com/2014/04/11/jcabi-http-intro.html)

# java - JavaFX 脚本和 Java

> ID：359683
> 
> 赞同：3
> 
> 时间：2008-12-11T15:17:46.217
> 
> 标签：java, interop, javafx, javafx-1

简单的问题：我可以在我的桌面应用程序中混合使用 Java 和 JavaFX 脚本代码吗？如果可能的话，你能给我一些例子链接吗？或者我可以将我定制的 javafx CustomNode-s 打包到一个 jar 中，并在我的项目中与标准 SWING 组件一起使用它们吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-11T19:18:41.440

是的，您可以混合使用 Java 和 JavaFX。

根据[常见问题解答条目之一](http://www.javafx.com/faq/#1.10)：

> 此外，开发人员可以在其 JavaFX 应用程序中使用任何 Java 库。这允许 JavaFX 应用程序利用丰富的 JavaFX UI 库，以及 Java 提供的惊人的广泛功能。

包括工具下载、常见问题解答和教程在内的官方信息来源是[JavaFX 网站](http://www.javafx.com/)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-11T19:38:06.940

[本文](http://java.dzone.com/news/calling-javafx-from-java)给出了一个使用[Scripting API](http://java.sun.com/javase/6/docs/technotes/guides/scripting/programmer_guide/index.html)从 Java 调用 JavaFX 的示例。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-19T11:52:43.920

我建议你看看[dotFX](http://www.dotfx.com)。它可能对您有用。它也有一个[netbeans 插件](http://www.dotfx.com/netbeans/)。

请先阅读[此处](http://www.netbeans.org/community/articles/javaone/2008/dotfx.html)以获取更多信息。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-10-17T18:24:50.337

您可以将 JavaFX 2.0 与 Swing [http://javafx.com/about-javafx/一起使用](http://javafx.com/about-javafx/)

如果您先安装 JavaFX 2.0 运行时，则启动一个示例[http://download.oracle.com/otndocs/products/javafx/samples/SwingInterop/index.html](http://download.oracle.com/otndocs/products/javafx/samples/SwingInterop/index.html)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-11T15:30:24.117

假设您所要做的就是将 JavaFX 应用程序拖放到您的桌面上，以使其成为桌面应用程序。您还可以在 JavaFX 应用程序中使用 Java 代码。不确定反过来。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-08-22T07:47:20.447

是的，Javafx 和 java api 可以在您的应用程序中混合使用，没有任何问题。

# java - 如何撤消对 JSpinner 的更改？

> ID：359689
> 
> 赞同：0
> 
> 时间：2008-12-11T15:20:59.860
> 
> 标签：java, undo, jspinner

我需要验证 a 的用户输入`JSpinner`，如果无效，我需要撤消（回滚）值更改。最好的方法是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-11T15:24:39.960

好吧，如果您保存上次验证输入时的旧值，则可以将微调器的值重置回最后一个有效值。

```
boolean valid = validate(spinner);
if (valid)
    validValue = spinner.getValue();
else
    spinner.setValue(validValue); 
```

也许是这样的。

# .net - 如何强制 PropertyGrid 显示特定属性的自定义对话框？

> ID：359690
> 
> 赞同：11
> 
> 时间：2008-12-11T15:21:04.993
> 
> 标签：.net, attributes, propertygrid

我有一个带有字符串属性的类，同时具有 getter 和 setter，通常太长，以至于 PropertyGrid 会截断字符串值。如何强制 PropertyGrid 显示省略号，然后启动包含多行文本框的对话框，以便轻松编辑属性？我知道我可能必须在属性上设置某种属性，但是什么属性以及如何设置？我的对话框是否必须实现一些特殊的设计器界面？

**更新：** [这](https://stackoverflow.com/questions/130032/multi-line-string-in-a-propertygrid)可能是我的问题的答案，但我无法通过搜索找到它。我的问题更笼统，它的答案可用于构建任何类型的自定义编辑器。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-12-11T15:35:25.883

您需要`[Editor(...)]`为属性设置一个，给它一个`UITypeEditor`进行编辑的；像这样（用你自己的编辑器......）

```
using System;
using System.ComponentModel;
using System.Drawing.Design;
using System.Windows.Forms;
using System.Windows.Forms.Design;

static class Program
{
    static void Main()
    {
        Application.Run(new Form { Controls = { new PropertyGrid { SelectedObject = new Foo() } } });
    }
}

class Foo
{
    [Editor(typeof(StringEditor), typeof(UITypeEditor))]
    public string Bar { get; set; }
}

class StringEditor : UITypeEditor
{
    public override UITypeEditorEditStyle GetEditStyle(ITypeDescriptorContext context)
    {
        return UITypeEditorEditStyle.Modal;
    }
    public override object EditValue(ITypeDescriptorContext context, IServiceProvider provider, object value)
    {
        IWindowsFormsEditorService svc = (IWindowsFormsEditorService)
            provider.GetService(typeof(IWindowsFormsEditorService));
        if (svc != null)
        {
            svc.ShowDialog(new Form());
            // update etc
        }
        return value;
    }
} 
```

您可能会通过查看行为符合您需要的现有属性来追踪现有编辑器。

# .net - 从 XAML 传递枚举值作为命令参数

> ID：359699
> 
> 赞同：198
> 
> 时间：2008-12-11T15:23:48.573
> 
> 标签：.net, wpf, silverlight, xaml, command

我想在 WPF 中将枚举值作为命令参数传递，使用如下所示：

```
<Button 
    x:Name="uxSearchButton" 
    Command="{Binding Path=SearchMembersCommand}" 
    CommandParameter="SearchPageType.First"
    Content="Search">
</Button> 
```

`SearchPageType`是一个枚举，这是为了知道从哪个按钮搜索命令被调用。

这在 WPF 中是否可行，或者如何将枚举值作为命令参数传递？

* * *

## 回答 #1

> 赞同：309
> 
> 时间：2008-12-11T16:55:03.710

试试这个

```
<Button CommandParameter="{x:Static local:SearchPageType.First}" .../> 
```

`local`- 是您在 XAML 中的[命名空间引用](http://msdn.microsoft.com/en-us/library/ms747086.aspx#The_WPF_and_XAML_Namespace_Declarations)

* * *

## 回答 #2

> 赞同：182
> 
> 时间：2010-12-04T05:26:21.820

还要记住，如果您的枚举在另一个类中，则需要使用`+`运算符。

```
<Button CommandParameter="{x:Static local:MyOuterType+SearchPageType.First}".../> 
```

* * *

## 回答 #3

> 赞同：52
> 
> 时间：2008-12-11T19:48:32.143

您可以为此使用属性元素语法而不是属性语法：

```
<Button x:Name="uxSearchButton"
        Command="{Binding Path=SearchMembersCommand}"
        Content="Search">
    <Button.CommandParameter>
        <SearchPageType>First</SearchPageType>
    </Button.CommandParameter>
</Button> 
```

* * *

## 回答 #4

> 赞同：33
> 
> 时间：2014-08-22T05:38:07.050

此外，如果您想提供 [ `Flags`] 枚举，您可以使用属性元素语法：

```
<Button>
  <Button.CommandParameter>
    <SearchPageType>First,Second</SearchPageType>
  <Button.CommandParameter>
</Button> 
```

# python-imaging-library - 如何绘制透明多边形？

> ID：359706
> 
> 赞同：27
> 
> 时间：2008-12-11T15:26:43.217
> 
> 标签：python-imaging-library, polygon, alpha

我正在使用 PIL（Python 图像库）。我想画透明的多边形。似乎指定包含 alpha 级别的填充颜色不起作用。他们的解决方法是什么？

如果使用 PIL 无法完成，我愿意使用其他东西。

如果有多个解决方案，则应考虑性能。绘图需要尽可能快。

* * *

## 回答 #1

> 赞同：66
> 
> 时间：2014-02-13T23:56:17.457

这是给 Pillow 的，PIL 的一个更维护的分支。[http://pillow.readthedocs.org/](http://pillow.readthedocs.org/)

如果要绘制相对于彼此透明的多边形，则基本 Image 必须是 RGB 类型，而不是 RGBA，并且 ImageDraw 必须是 RGBA 类型。例子：

```
from PIL import Image, ImageDraw

img = Image.new('RGB', (100, 100))
drw = ImageDraw.Draw(img, 'RGBA')
drw.polygon(xy=[(50, 0), (100, 100), (0, 100)], fill=(255, 0, 0, 125))
drw.polygon(xy=[(50, 100), (100, 0), (0, 0)], fill=(0, 255, 0, 125))
del drw

img.save('out.png', 'PNG') 
```

这将绘制两个重叠的三角形，它们的两种颜色混合。这比为每个多边形合成多个“层”要快得多。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-11T20:35:37.753

使用 PIL 绘制透明图像时，我必须做的是创建一个颜色层，一个带有多边形的不透明层，然后将它们与基础层合成如下：

```
color_layer = Image.new('RGBA', base_layer.size, fill_rgb)
alpha_mask = Image.new('L', base_layer.size, 0)
alpha_mask_draw = ImageDraw.Draw(alpha_mask)
alpha_mask_draw.polygon(self.outline, fill=fill_alpha)
base_layer = Image.composite(color_layer, base_layer, alpha_mask) 
```

使用 Image.Blend 时，我在绘制的多边形上遇到了奇怪的轮廓行为问题。

这种方法的唯一问题是在绘制大量合理大小的多边形时性能很差。一个更快的解决方案是像“手动”在图像的 numpy 数组表示上绘制多边形。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-22T09:40:34.033

PIL 的 Image 模块提供了一种混合方法。

创建与第一个大小相同的第二个图像，背景为黑色。在上面画出你的多边形（全彩色）。然后调用 Image.blend 传递两个图像和一个 alpha 级别。它返回第三张图像，上面应该有一个半透明的多边形。

我没有测量性能（嘿，我什至没有尝试过！）所以我无法评论它的适用性。我建议你计算出你的性能预算，然后测量它是否足够快以满足你的目的。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-18T14:44:16.517

我为此使用[cairo](http://www.cairographics.org/ "开罗") + pycairo，效果很好。如果 pil 中存在无法在 cairo 中完成的操作，您可以使用 python 缓冲区接口在 PIL 和 cairo 之间共享图像数据。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-05-11T16:28:52.640

从我发现它不能直接用 PIL 完成。这是 PyCairo 的解决方案。Cairo 也被 Mozilla、GTX+、Mono、Inkscape 和 WebKit 使用，所以我认为在未来的支持方面使用它是安全的。也可以使用 aggdraw 来完成，它是 PIL 的可选插件。有关更多详细信息，请参阅我列出的来源。使用 Python 版本 2.7.3。

来源： http: [//livingcode.org/2008/12/14/drawing-with-opacity.1.html](http://livingcode.org/2008/12/14/drawing-with-opacity.1.html)

帮助文件：random_polys_util.py

```
 MIN_ALPHA = 50
    MAX_ALPHA = 100

    WIDTH = 500
    HEIGHT = 250

    #
    #   Utilities
    #
    def hex2tuple(hex_color):
        return tuple([int(hex_color[i:i+2], 16) for i in range(1,9,2)])

    def tuple2hex(tuple_color):
        return "#%0.2X%0.2X%0.2X%0.2X" % tuple_color

    def ints2floats(tuple_color):
        return tuple([c / 255.0 for c in tuple_color])

    def inc_point(p, dp):
        return (p[0] + dp[0]) % WIDTH, (p[1] + dp[1]) % HEIGHT

    def inc_triangle(t, dt):
        return tuple([inc_point(t[i], dt[i]) for i in range(3)])

    def inc_color(c, dc):
        new_c = [(c[i] + dc[i]) % 256 for i in range(3)]
        new_a = (c[3] + dc[3]) % MAX_ALPHA
        if new_a < MIN_ALPHA: new_a += MIN_ALPHA
        new_c.append(new_a)
        return tuple(new_c)

    def draw_all(draw_fn):
        triangle = start_t
        color = start_c
        for i in range(50):
            triangle = inc_triangle(triangle, dt)
            color = inc_color(color, dc)
            draw_fn(triangle, color)

    #
    #   Starting and incrementing values
    #
    start_c = hex2tuple('E6A20644')
    start_t = (127, 132), (341, 171), (434, 125)
    dt = (107, 23), (47, 73), (13, 97)
    dc = 61, 113, 109, 41 
```

主文件：random_polys.py

```
from random_polys_util import *

def cairo_poly(pts, clr):
    ctx.set_source_rgba(*ints2floats(clr))
    ctx.move_to(*pts[-1])
    for pt in pts:
        ctx.line_to(*pt)
    ctx.close_path()
    ctx.fill()

def cairo_main():
    # Setup Cairo
    import cairo
    global ctx
    surface = cairo.ImageSurface(cairo.FORMAT_ARGB32, WIDTH, HEIGHT)
    ctx = cairo.Context(surface)
    # fill background white
    cairo_poly(((0,0),(WIDTH,0),(WIDTH,HEIGHT),(0,HEIGHT)),(255,255,255,255))
    draw_all(cairo_poly)
    surface.write_to_png('cairo_example.png')

def main():
    cairo_main()

if __name__ == "__main__":
    main() 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-03-13T14:43:12.477

我必须用轮廓绘制外部多边形，并减去内部多边形（GIS 中的常见操作）。像使用 color 的魅力一样工作`(255,255,255,0)`。

```
image = Image.new("RGBA", (100,100))
drawing = ImageDraw.Draw(i)
for index, p in enumerate(polygons):
    if index == 0:
        options = { 'fill': "#AA5544",
                    'outline': "#993300"}
    else:
        options = {'fill': (255,255,255,0)}
    drawing.polygon( p, **options )

buf= StringIO.StringIO()
i.save(buf, format= 'PNG')
# do something with buf 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2020-05-28T14:07:31.110

为此，您可以像这样使用[Shapely](https://pypi.org/project/Shapely/)和[OpenCV](https://pypi.org/project/opencv-python/)：

```
import cv2
import numpy as np
from shapely.geometry import Polygon

alpha = 0.5 # that's your transparency factor
path = 'path_to_image.jpg'
image = cv2.imread(path)
(H, W) = image.shape[:2]

xmin = 0
ymin = 0 
xmax = int(W / 2)
ymax = int(H / 2)

polygon = Polygon([(xmin, ymin), (xmax, ymin), (xmax, ymax), (xmin, ymax)])
int_coords = lambda x: np.array(x).round().astype(np.int32)
exterior = [int_coords(polygon.exterior.coords)]

overlay = image.copy()
cv2.fillPoly(overlay, exterior, color=(255, 255, 0))
cv2.addWeighted(overlay, alpha, image, 1 - alpha, 0, image)
cv2.imshow("Polygon", image)
cv2.waitKey(0)
cv2.destroyAllWindows() 
```

# c++ - Cygwin vs Linux下g++创建的可执行文件的默认文件扩展名

> ID：359707
> 
> 赞同：9
> 
> 时间：2008-12-11T15:26:49.800
> 
> 标签：c++, compiler-construction, cygwin, g++, portability

我在 VisualStudio 上完成了大部分工作，但对 gcc 或 g++ 没有太多经验。今天早上，当我尝试使用 cygwin 在我的电脑上编译（例如 aprogram.cpp）时，当我尝试在我的 Ubuntu 机器上编译相同的东西时，我得到了（aprogram.exe），我得到了（aprogram），没有任何扩展. 我只是想知道是否有人好心告诉我原因。这个问题只是出于好奇。:)

提前致谢！

编辑：（来自 Jimmy 的评论）Cygwin 下的 g++ 默认为 .exe

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-12-11T15:30:10.933

这很简单：在 UNIX 上，[您不需要任何 steenkin 扩展](http://en.wikipedia.org/wiki/Stinking_badges)。事实上，像 .c 这样的“扩展名”只是一种方便的命名约定；与 Windows 不同，文件系统将文件名视为一个字符串、.c 和所有。

在一段*非常*`-o`好的时间里，编译一个完全没有标志的 C 程序。您的可执行文件仍将显示 --- 命名为可执行文件的默认名称：`a.out`.

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-12-11T15:29:31.433

这只是一个命名约定。在 Unix/Linux 上，可执行文件没有扩展名，只有一个可执行位。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-12-11T15:28:44.307

.exe 是 Windows 的东西。Unix 不关心扩展。可执行性基于文件的元数据以及文件的内容。通过 cygwin 的 g++ 并不是**真正**的 Windows 应用程序，因此它带有它的 unix 根源。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-12-11T15:33:13.237

如果您想知道如何在 UNIX 上执行该程序，只需导航到您希望执行的程序所在的文件夹（aprogram）并键入

```
./aprogram 
```

这将告诉 shell 您希望在当前目录中执行“aprogram”。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-01-05T00:31:44.837

可执行文件在 unix 世界中没有扩展名，因为它们旨在在 shell 中执行。想象一下：

```
cat.bin file.txt | less.bin 
```

太丑了！Unix 在每个文件的开头使用所谓的魔术字节来检测文件类型。对于称为 ELF 的默认二进制格式，`7f 45 4c 46`开头有一个 4 字节的字。这对所有文件格式都是不可能的。考虑 C 代码或 Java 代码。它们都可以从注释开始，并且可以看起来完全相同。因此，您仍然必须使用文件扩展名，并且在适当的地方使用它是一件好事。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-12-11T15:40:32.190

如果您希望输出具有 .exe 扩展名，那么只需使用 -o 标志即可（例如 -o aprogram.exe）。无论哪种方式，它都可以在 linux 下正常工作。

在 linux 下执行程序的能力取决于文件的权限（请参阅[chmod](http://en.wikipedia.org/wiki/Chmod)）。执行权限将由 gcc/g++ 自动设置。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-05T01:18:05.930

ls /bin 有很多程序，而且都没有扩展名:)

ls -l /bin 你会看到它们都有 +x 标志来将它们标记为可执行文件。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2012-08-13T19:56:00.640

老实说，只是命名它们`.elf`。如果您不确定它们是什么文件类型，请执行：

```
$ file MyFile 
```

这将告诉您文件的内容是什么，并且您可以通过这种方式选择一个名称，但这不是必需的 - 如果您已经习惯于扩展所有生命，则只是装饰性的。

# iis - 了解 Ms IIS 的最佳免费资源是什么？

> ID：359717
> 
> 赞同：1
> 
> 时间：2008-12-11T15:30:30.840
> 
> 标签：iis, outsystems

我通常将 IIS 与 OutSystems 开发平台结合使用，该平台为 Web 应用程序生成代码。

由于它负责将应用程序编译和部署到 IIS，因此我对它的实际工作原理知之甚少，有时它非常有用。

谢谢

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-11T15:32:59.553

[http://learn.iis.net/](http://learn.iis.net/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-11T15:34:37.553

我发现真正有用的是[Microsoft 的官方 IIS 站点](http://www.iis.net/)。许多有用的文章、下载和来自论坛中知识渊博的人的建议。

您是否在寻求一些具体的建议/信息？

试试看...

安迪

# c# - 告诉 StructureMap 使用特定的构造函数

> ID：359719
> 
> 赞同：38
> 
> 时间：2008-12-11T15:30:32.040
> 
> 标签：c#, structuremap, xmlreader, xpathdocument

我有两项服务需要`XPathDocument`. 我希望能够定义`XPathDocumnet`在两个服务的配置中使用的命名实例。我还希望能够告诉 StuctureMap`XPathDocument`使用哪个构造函数。当我尝试获取它的实例时，`XPathDocument`它告诉我它找不到`XmlReader`. 我想使用需要 xml 文件的字符串 uri 的构造函数。我似乎无法让它发挥作用。这是 StructureMap 配置代码。

```
public class Service1 : IService1 {
    public Service1(XPathDocument document) {}
}
public class Service2 : IService2 {
    public Service2(XPathDocument document) {}
}

public class Registry1 : Registry {
    ForRequestedType<IService1>().TheDefault.Is.OfConcreteType<Service1>()
        .CtorDependency<XPathDocument>()
        .Is(x => x.TheInstanceNamed("XPathDocument1"));
    ForRequestedType<IService2>().TheDefault.Is.OfConcreteType<Service2>()
        .CtorDependency<XPathDocument>()
        .Is(x => x.TheInstanceNamed("XPathDocument2"));

    ForRequestedType<XPathDocument>().AddInstances(x => {
        x.OfConcreteType<XPathDocument>()
            .WithCtorArg("uri").EqualToAppSetting("XmlFile1")
            .WithName("XPathDocument1");
        x.OfConcreteType<XPathDocument>()
            .WithCtorArg("uri").EqualToAppSetting("XmlFile2")
            .WithName("XPathDocument2");
    });
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2013-12-27T19:15:52.667

看看[这个](https://stackoverflow.com/questions/289512/structuremap-how-to-define-default-constructor-by-code)。简而言之，您需要更改`OfConcreteType<Service1>()`为`ConstructedBy(() => new Service1());`.

# web-applications - 从网络获取文件的脚本

> ID：359722
> 
> 赞同：0
> 
> 时间：2008-12-11T15:32:16.983
> 
> 标签：web-applications, download, scripting

我拥有一个网站，我想知道是否有一个脚本可以从网络上的其他链接为我获取文件并将其加载到我的服务器。

假设我找到一个大小为 400 mb 的文件，我想将它托管在我的服务器上。我使用的正常方法是将文件下载到我的电脑，然后将其上传到我的服务器，但是是否有脚本或方法可以直接传输和托管文件而不下载它。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-11T15:35:34.247

wget 从你的服务器。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-11T15:38:27.267

只要你有 PHP 使用：

```
<?php
$remotefh = fopen('http://domain.tld/path/to/file.ext', 'r'); 
$localfh = fopen('local/file.ext', 'w');
while(!feof($remotefh)) 
 {
    fwrite($localfh, fread($remotefh, '4096'));
 }
fclose($remotefh);
fclose($localfh);
?> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-11T15:37:01.013

如果您可以远程访问您的服务器，您只需从服务器内导航到包含您的下载内容的网页，然后以这种方式将其直接保存到服务器。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-11T16:49:01.647

我认为 FTP 协议支持服务器到服务器的传输。

# apache-flex - 为什么 Flash Media Server 不调用 application.onDisconnect 处理程序？

> ID：359727
> 
> 赞同：1
> 
> 时间：2008-12-11T15:33:19.087
> 
> 标签：apache-flex, flash, flash-media-server

我在我的 Flex/Flashcom 应用程序中遇到了奇怪的问题。如果客户端应用程序意外断开与服务器的连接，后者不会调用 application.onDisconnect 处理函数。我应该朝女巫的方向看吗？谢谢你。

**更新**我没有使用服务器组件，但我确实在 Linux 上托管了这个东西。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-01-28T05:17:52.490

如果是这样，它已记录在案，并且[这里](https://www.adobe.com/cfusion/webforums/forum/messageview.cfm?forumid=15&catid=578&threadid=1401786&enterthread=y)有一个有趣的论坛可以关注..基本上在 Linux 上它可能会有点疯狂，比如:)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-01T23:26:42.643

在（Flash Media-）服务器“知道”这一点之前，客户端可能已断开连接。因此，直到非常非常晚才会调用“onDisconnect”函数（它*永远不会*被客户端调用）。

如果您想及早检测（并采取行动）“延迟”断开连接，请使用 client.getStats() 方法。

我有这个服务器端动作脚本示例：

```
// add method to standard class
Client.prototype.isAlive = function() {
        var stats = this.getStats();
        var timeout_value = 3 * 1000;  // in ms.
        //trace('Measured timeout: ' + stats['ping_rtt']);
        if (stats)
                return (stats['ping_rtt'] < timeout_value);
}

// use this in an interval which traverses the application.clients list
if (! client.isAlive())
    application.disconnect(client); 
```

您可以通过从连接的 Flash 客户端移除网络电缆来触发和测试这种“丢失 onDisconnect”行为。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-28T05:11:14.127

正如[Artem Tikhomirov](https://stackoverflow.com/users/2313/artem-tikhomirov)（问题的作者）在他[自己的回答](https://stackoverflow.com/questions/359727#509843)中提到的那样，我的回答没有帮助（我在下面作为 wiki 保留在那里，用于存档）。

[Ric Tokyo就](https://stackoverflow.com/users/42019/ric-tokyo)[Linux 上](https://stackoverflow.com/questions/359727#486550)的一个错误给出了真正的答案，并记录在[此线程](https://www.adobe.com/cfusion/webforums/forum/messageview.cfm?forumid=15&catid=578&threadid=1401786&enterthread=y)中。

我的答案是“选择”的唯一原因是因为 Artem 在 7 天限制之前没有选择任何其他答案（或他自己的答案），给了我（第一个也是最受好评的答案）一半的赏金积分（超过 75 150)*自动*[如此 SO 博客条目中](https://blog.stackoverflow.com/2009/01/reputation-bounty-for-unanswered-questions/)所述。

* * *

第一条线索：

如果客户端是基于组件的应用程序，它需要[正确处理连接事件][9]。

> 当您开发应用程序时，请注意使用组件会引入显式`onConnectAccept`和`onConnectReject`事件。

> 您需要包含处理这些事件的代码。
> 使用组件时，必须修改`application.onConnect`服务器端代码中的语句以包含事件处理程序`application.onConnectAccept`和`application.onConnectReject`事件处理程序。
> 处理程序的最后一行（按执行顺序）`onConnect`应该是`application.acceptConnection()`或`application.rejectConnection()`。

> `acceptConnection()`如果您的应用程序在显式or方法之后需要额外的代码`rejectConnection()`，例如指示用户已被授予或拒绝对应用程序的权限的消息，您应该将该代码放在`application.onConnectAccept`or`application.onConnectReject`语句中。

> 提示：如果您不使用媒体组件，则不能使用`application.onConnectAccept`和`application.onConnectReject`。

* * *

然后，您可能需要检查 Flash 输出面板中的任何错误消息，例如：

```
Error #2044: NetStatusEvent non pris en charge : level=error, code=NetStream.Play.Failed
    at MethodInfo-1()
Error #2044: NetStatusEvent non pris en charge : level=error, code=NetStream.Record.NoAccess
    at MethodInfo-1() 
```

这将表明客户端未考虑服务器异常，从而强制意外退出。

如果客户端从服务器读取流，它必须确保：

*   NetConnection 已成功
*   NetStreams（进出）监听 NET_STATUS

一个好的代码应该是这样的：

```
var status:Function = function( e:NetStatusEvent ):void
{
    trace( "status : " + e.info.code ) ;
    if ( e.info.code == "NetConnection.Connect.Success" )
    {
        streamOut = new NetStream( nc ) ;
        streamOut.addEventListener( NetStatusEvent.NET_STATUS , status ) ;

        streamIn  = new NetStream( nc ) ;
        streamIn.addEventListener( NetStatusEvent.NET_STATUS , status ) ;

        streamOut.attachCamera( cam ) ;
        video.attachNetStream( streamIn ) ;

        streamOut.publish( "private" ) ;
        streamIn.play( "private" ) ;       
    }
} 
```

由于新版本的 FlashPlayer 确实会传播此类异常，因此必须对其进行监视，然后在客户端应用程序中捕获它们

# .net - Windows Workflow Foundation 持久性架构解释？

> ID：359728
> 
> 赞同：2
> 
> 时间：2008-12-11T15:33:33.780
> 
> 标签：.net, sql, workflow, workflow-foundation

我正在尝试调试使用默认 WF SQL 持久性架构的工作流项目。有谁知道每个表中的数据代表什么的一个很好的解释？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-11T18:36:39.370

持久性模式中仅有的两个表是 InstanceState 和 CompletedScope 表。InstanceState 表存储工作流在卸载时发生的位置/时间/人员。CompletedScope 表存储了我认为可补偿的已完成工作流。

如果您还想了解更多关于跟踪表的信息，这里有一个很好的链接：

[http://msdn.microsoft.com/en-us/library/aa347864.aspx](http://msdn.microsoft.com/en-us/library/aa347864.aspx)

# flash - 如何在我的 Wordpress 博客顶部添加一个大的 Flash 横幅？

> ID：359730
> 
> 赞同：-5
> 
> 时间：2008-12-11T15:34:01.830
> 
> 标签：flash, wordpress, banner

我不知道是否可以将 Flash 横幅添加到 Wordpress 主题中...理想情况下，此横幅将始终位于网站的标题中。关于我如何做到这一点的任何想法？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-12T08:11:29.617

Yes, it's very much possible. What I would recommend is to use [swfobject](http://code.google.com/p/swfobject/) to replace the your current header with a Flash movie. This way it will degrade gracefully for everyone that lacks a proper flash player, and also you get the benefit of proper google indexing.

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2008-12-11T16:48:00.027

您需要编辑包含您的横幅的相应 .php 文件（我不知道您使用的是什么版本的 WordPress）。

不过，代码将是资源密集型且丑陋的。

# java - 为什么省略花括号被认为是一种不好的做法？

> ID：359732
> 
> 赞同：183
> 
> 时间：2008-12-11T15:34:22.827
> 
> 标签：java, c#, c++, c, coding-style

为什么每个人都告诉我这样写代码是一种不好的做法？

```
if (foo)
    Bar();

//or

for(int i = 0 i < count; i++)
    Bar(i); 
```

省略花括号的最大理由是，有时它们的行数可能是它们的两倍。例如，下面是一些在 C# 中为标签绘制发光效果的代码。

```
using (Brush br = new SolidBrush(Color.FromArgb(15, GlowColor)))
{
    for (int x = 0; x <= GlowAmount; x++)
    {
        for (int y = 0; y <= GlowAmount; y++)
        {
            g.DrawString(Text, this.Font, br, new Point(IconOffset + x, y));
        }
     }
 }
 //versus
using (Brush br = new SolidBrush(Color.FromArgb(15, GlowColor)))
    for (int x = 0; x <= GlowAmount; x++)
        for (int y = 0; y <= GlowAmount; y++)
            g.DrawString(Text, this.Font, br, new Point(IconOffset + x, y)); 
```

您还可以获得链接`usings`在一起的额外好处，而无需缩进一百万次。

```
using (Graphics g = Graphics.FromImage(bmp))
{
    using (Brush brush = new SolidBrush(backgroundColor))
    {
        using (Pen pen = new Pen(Color.FromArgb(penColor)))
        {
            //do lots of work
        }
    }
 }
//versus
using (Graphics g = Graphics.FromImage(bmp))
using (Brush brush = new SolidBrush(backgroundColor))
using (Pen pen = new Pen(Color.FromArgb(penColor)))
{
    //do lots of work
} 
```

* * *

花括号最常见的论点围绕维护编程，以及在原始 if 语句与其预期结果之间插入代码会产生的问题：

```
if (foo)
    Bar();
    Biz(); 
```

* * *

### 问题：

1.  想要使用该语言提供的更紧凑的语法是错误的吗？设计这些语言的人很聪明，我无法想象他们会放一个总是不好用的功能。
2.  我们应该还是不应该编写代码，以便最低公分母可以理解并且使用它没有问题？
3.  我还缺少另一个论点吗？

* * *

## 回答 #1

> 赞同：187
> 
> 时间：2008-12-11T15:39:14.737

实际上，唯一真正让我感到痛苦的是在我调试时，并注释掉了 bar()：

```
if(foo)
  // bar();
doSomethingElse(); 
```

除此之外，我倾向于使用：

```
if(foo) bar(); 
```

它处理了上述情况。

**编辑**感谢您澄清问题，我同意，我们不应该将代码写入最低公分母。

* * *

## 回答 #2

> 赞同：158
> 
> 时间：2008-12-11T22:58:52.197

**阅读速度...**

除了已经提到的。在这一点上，我已经习惯于解析带有大括号和空格的 if 语句。所以我读到：

```
if (condition)
{
    DoSomething();
}

DoSomethingElse(); 
```

比我读的要快一点：

```
if (condition) DoSomething();

DoSomethingElse(); 
```

如果它看起来像这样，我读起来会慢一点：

```
if (condition) DoSomething();
DoSomethingElse(); 
```

我读这个比以前慢得多：

```
if (condition) 
    DoSomething();
DoSomethingElse(); 
```

因为我忍不住又读了一遍，以防万一，想知道作者是否打算：

```
if (condition)
{
    DoSomething();
    DoSomethingElse();
} 
```

已经大致介绍了，但是在**阅读**以下内容时，我将研究一段时间以确保作者的意图。我什至可能会寻找原作者来确认。

```
if (condition) 
    DoSomething();
    DoSomethingElse(); 
```

* * *

## 回答 #3

> 赞同：55
> 
> 时间：2008-12-11T15:47:07.967

如果它很小，请这样写：

```
if(foo()) bar();
```

如果它足够长，可以分成两行，请使用大括号。

* * *

## 回答 #4

> 赞同：48
> 
> 时间：2008-12-11T16:22:16.943

我也曾经认为最好只在真正需要时使用大括号。但现在不是了，主要原因是，当你有很多代码时，它确实使它更具可读性，并且当你有一致的大括号样式时，你可以更快地解析代码。

除了有人在 if 中添加第二条语句之外，总是使用大括号的另一个很好的理由是可能会发生这样的事情：

```
if(a)
   if(b)
     c();
else
   d(); 
```

您是否注意到 else 子句实际上是“if(b)”的子句？你可能做到了，但你会相信任何人都熟悉这个问题吗？

所以，如果只是为了保持一致性，并且因为你永远不知道当*其他人*（总是愚蠢的其他人）更改代码时会发生什么意想不到的事情，我总是放大括号，因为它使源代码更具可读性，更快地解析你的脑。仅对于最简单的 if 语句，例如进行委托或类似于 switch 的 if 语句，您知道该子句永远不会被扩展，我会省略大括号。

* * *

## 回答 #5

> 赞同：37
> 
> 时间：2008-12-11T16:47:02.137

线路很便宜。处理器功率便宜。开发人员的时间非常昂贵。

作为一般规则，除非我正在开发一些绝对资源/速度关键的应用程序，否则我总是会在编写代码方面犯错

(a) 任何其他开发人员都很容易跟随我正在做的事情

(b) 注释代码中可能需要的特定部分

(c) 如果出现问题，易于调试

(d) 如果将来需要，易于修改（即添加/删除代码）

从业务的角度来看，代码的速度或学术优雅次于这些因素。这并不是说我开始编写笨拙或丑陋的代码，但这是我的优先顺序。

通过在大多数情况下省略花括号，对我来说，它使 (b)、(c) 和 (d) 变得更加困难（但请注意并非不可能）。我会说是否使用花括号对（a）没有影响。

* * *

## 回答 #6

> 赞同：35
> 
> 时间：2008-12-11T15:48:32.393

这并不总是被认为是一种不好的做法。[Mono Project Coding Guidelines](http://www.mono-project.com/Coding_Guidelines)建议在没有必要的情况下不要使用花括号。[GNU 编码标准](http://www.gnu.org/prep/standards/standards.html)也是如此。我认为与编码标准一样，这是个人品味的问题。

* * *

## 回答 #7

> 赞同：34
> 
> 时间：2008-12-11T15:47:13.333

我更喜欢花括号提供的清晰度。您确切地知道是什么意思，并且不必猜测是否有人只是犯了错误并离开了他们（并引入了一个错误）。我唯一一次省略它们是当我将 if 和 action 放在同一行时。我也不经常这样做。我实际上更喜欢通过将花括号放在自己的行中引入的空格，尽管从多年的 K&R C 类编程中，如果 IDE 不强制执行它，用大括号结束行是我必须努力克服的一种做法我。

```
if (condition) action();  // ok by me

if (condition) // normal/standard for me
{
   action();
} 
```

* * *

## 回答 #8

> 赞同：23
> 
> 时间：2008-12-11T16:05:27.070

我认为这是您正在从事的项目的指导方针和个人品味的问题。

我通常在不需要它们时省略它们，除了以下情况：

```
if (something)
    just one statement; // i find this ugly
else
{
    // many
    // lines
    // of code
} 
```

我更喜欢

```
if (something)
{
    just one statement; // looks better:)
}
else
{
    // many
    // lines
    // of code
} 
```

* * *

## 回答 #9

> 赞同：15
> 
> 时间：2008-12-11T16:10:55.080

在过去的 C/C++ 宏中，这可能会咬你一口。我知道这是一个 C# 问题，但编码标准通常会在没有最初创建该标准的原因的情况下延续。

如果您在创建宏时不够小心，最终可能会导致不使用 {} 的 if 语句出现问题。

```
#define BADLY_MADE_MACRO(x) function1(x); function2(x);

if (myCondition) BADLY_MADE_MACRO(myValue) 
```

现在，不要误会我的意思，我并不是说你应该总是做 {} 只是为了避免 C/C++ 中的这个问题，但我因此不得不处理一些非常奇怪的错误。

* * *

## 回答 #10

> 赞同：15
> 
> 时间：2009-11-13T18:48:01.973

坦率地说，我认为它是：

优秀的程序员会进行防御性编程，而糟糕的程序员则不会。

由于上面有几个示例以及我自己与忘记大括号相关的错误的类似经历，因此我学会了始终放置大括号的艰难方法。

其他任何事情都是选择个人风格而不是安全，这显然是糟糕的编程。

[Joel 甚至在让错误的代码看起来错误](http://www.joelonsoftware.com/articles/Wrong.html)中提到了这一点

一旦你因为缺少大括号而被一个 bug 咬住，你就会发现缺少大括号看起来是错误的，因为你知道这是另一个 bug 发生的潜在地方。

* * *

## 回答 #11

> 赞同：14
> 
> 时间：2009-02-26T02:07:56.423

我以前也是这么想的。

直到有一天（为什么总有那个“一天”永远改变你的生活？）我们连续 24 到 36 小时不睡觉地调试生产代码，结果发现有人没有把大括号和搜索/替换更改结合起来.

是这样的。

```
 if( debugEnabled ) 
      println( "About to save 1 day of work to some very important place.");
 saveDayData(); 
```

之后发生的是

```
 if( debugEnabled ) 
 //     println( "About to save 1 day of work to some very important place.");
 saveDayData(); 
```

事实证明，该系统每天生成 500 mb 的日志，我们被要求停止它。调试标志是不够的，所以搜索和替换 println 是有序的。

尽管如此，当应用程序投入生产时，调试标志仍处于关闭状态，并且从未调用过重要的“saveDayData”。

**编辑**

现在我唯一不使用大括号的地方是 if/try 构造。

```
if( object != null ) try { 
     object.close();
} catch( ..... 
```

在看到一个超级明星开发者这样做之后。

* * *

## 回答 #12

> 赞同：14
> 
> 时间：2011-04-21T04:25:43.097

我很高兴：

```
foreach (Foo f in foos)
  foreach (Bar b in bars)
    if (f.Equals(b))
      return true;

return false; 
```

就个人而言，我不明白为什么

```
foreach (Foo f in foos)
{
  foreach (Bar b in bars)
  {
    if (f.Equals(b))
    {
      return true;
    }
  }
}

return false; 
```

更具可读性。

是的，行是免费的，但是当它可能只有一半大小时，为什么我必须滚动页面和代码页面？

如果在可读性或可维护性方面存在差异，那么当然，将大括号放入......但在这种情况下，我看不出有任何理由。

另外，我*总是*将嵌套的 if 放在我嵌套 else 的地方

```
if (condition1)
  if (condition2)
    doSomething();
  else (condition2)
    doSomethingElse(); 
```

对比

```
if (condition1)
  if (condition2)
    doSomething();
else (condition2)
  doSomethingElse(); 
```

非常令人困惑，所以我总是把它写成：

```
if (condition1)
{
  if (condition2)
    doSomething();
  else (condition2)
    doSomethingElse();
} 
```

只要有可能，我就使用三元运算符，但我*从不* [嵌套它们](http://thedailywtf.com/Articles/Turn_it_up_to_Eleven.aspx)。

* * *

## 回答 #13

> 赞同：11
> 
> 时间：2008-12-11T15:43:02.483

我同意“如果你足够聪明，可以让别人付钱给你写代码，那么你应该足够聪明，不要仅仅依靠缩进来查看代码的流程。”

但是......可能会犯错误，而且这个调试起来很痛苦......特别是如果您正在查看其他人的代码。

* * *

## 回答 #14

> 赞同：11
> 
> 时间：2008-12-11T21:14:48.460

当您跳过单行块上的大括号时，我在计算机编程领域的同行（你们很多）并没有被潜在错误的前景吓倒，这给我留下了深刻的印象和谦卑。

我想这意味着我不聪明。我在这方面犯了很多次错误。我已经调试了其他人的错误。由于这个原因，我看到软件附带错误（RDP 到运行 VS2002 的机器，你的监视窗口字体会变得不稳定）。

如果我看看我所犯的所有错误，这些错误本可以通过改变编码风格来避免，这个列表很长。如果我没有在这些情况下改变我的方法，我可能永远不会成为一名程序员。再说一次，我想我不聪明。作为补偿，我长期以来一直是单行块上大括号的忠实用户。

也就是说，世界上的一些事情已经发生了变化，使得“你应该在单行块上使用大括号”规则在今天没有摩西把它带给我们的时候那么重要：

*   一些流行的语言通过让计算机读取缩进来解决问题，就像程序员一样（例如Python）。

*   我的编辑器会**自动为我格式化**，因此我被缩进误导的机会大大减少了。

*   **TDD**意味着如果我因为对单行代码块感到困惑而引入了一个错误，我更有可能快速发现这个错误。

*   **重构和语言表达能力**意味着我的代码块要短得多，单行代码块比以前更频繁地出现。假设，通过无情地应用 ExtractMethod，我的整个程序中可能*只有*单行块。（我想知道那会是什么样子？）

事实上，无情地重构和在单行块上省略大括号有一个明显的好处：当你看到大括号时，你的脑海中会响起一个小警报，说“这里很复杂！小心！”。想象一下，如果这是常态：

```
if (condition) Foo();   // normal, everyday code

if (condition) 
{
    // something non-trivial hapening; pay attention!
    Foo();
    Bar();
} 
```

我愿意将我的编码约定更改为“单行块可能永远不会有大括号”或“如果你可以将块放在与条件相同的行上，并且它都适合 80 个字符，省略括号”。我们拭目以待。

* * *

## 回答 #15

> 赞同：10
> 
> 时间：2008-12-11T15:39:06.250

总是有例外，但我反对仅在以下形式之一时才省略大括号：

> ```
> if(x == y)
>    for(/* loop */)
>    {
>       //200 lines
>    }
> 
> //rampion's example:
> for(/* loop */)
> {
>    for(/* loop */)
>       for(/* loop */)
>       {
>          //several lines
>       }
> } 
> ```

否则，我没有问题。

* * *

## 回答 #16

> 赞同：10
> 
> 时间：2008-12-11T15:39:56.873

我偶尔会使用最底层的代码（多个 using 语句），但除此之外，我总是把大括号放进去。我只是发现它使代码更清晰。从不仅仅是缩进中可以明显看出语句是块的一部分（因此可能是 if 等的一部分）。

我看过

```
if (...)
    foo();
    bar(); 
```

*bug 咬了我一次*（或者更确切地说是“我和同事”——我实际上并没有介绍这个 bug）。尽管我们当时的编码标准建议在任何地方都使用大括号，但这仍然是事实。我花了很长时间才发现——因为你看到了你想看到的。（这是大约 10 年前的事了。也许我现在会发现它更快。）

当然，如果您使用“行尾大括号”，它会减少产生的额外行，但我个人还是不喜欢这种风格。（我在工作中使用它，发现它没有我想象的那么不愉快，但还是有点不愉快。）

* * *

## 回答 #17

> 赞同：10
> 
> 时间：2008-12-11T15:47:44.300

我的理念是，如果它使代码更具可读性，为什么不这样做呢？

显然，您必须在某处划清界限，例如在简洁和过度描述的变量名称之间找到快乐的媒介。但是括号确实可以避免错误并提高代码的可读性。

您可以争辩说，足够聪明成为编码人员的人将足够聪明，可以避免导致无括号语句的错误。但是你能诚实地说你从来没有被拼写错误这样简单的事情绊倒吗？在查看大型项目时，这样的细节可能会让人不知所措。

* * *

## 回答 #18

> 赞同：9
> 
> 时间：2008-12-11T22:43:28.267

在三个约定中：

```
if(addCurleyBraces()) bugFreeSofware.hooray(); 
```

和：

```
if(addCurleyBraces())
    bugFreeSofware.hooray(); 
```

和（使用左大括号和右大括号表示任何缩进样式）：

```
if(addCurleyBraces()) {
    bugFreeSofware.hooray();
} 
```

我更喜欢最后一个：

*   如果所有 if 语句都以统一的方式编写，我发现更容易阅读。
*   它可能会使软件更加健壮并且没有错误。然而，所有现代 IDE 和高级文本编辑器都具有很好的自动缩进功能，我认为每个人都应该使用它们，只要它不会弄乱评论格式或违反团队标准（在很多情况下，可以创建自定义格式方案并与团队分享）。我的观点是，如果缩进正确完成，错误引入的风险会降低一点。
*   我更喜欢布尔表达式和语句在不同的行上执行。我喜欢能够标记一行以进行调试。即使我使用的是可以标记语句并单步执行的 IDE，它也是一个交互式操作，我可能会忘记我从哪里开始调试，或者至少我需要多一点时间来单步调试代码次（因为我必须在调试期间每次手动标记位置）。

* * *

## 回答 #19

> 赞同：8
> 
> 时间：2008-12-11T15:45:45.737

您反对使用大括号的主要论点是它们使用了额外的行并且需要额外的缩进。

行（几乎）是免费的，尽量减少代码中的行数不应该是一个目标。

并且缩进独立于大括号的使用。在您的级联“使用”示例中，即使您省略了大括号，我仍然认为您应该缩进它们。

* * *

## 回答 #20

> 赞同：8
> 
> 时间：2008-12-11T16:40:24.457

我坚信编写整洁简洁的代码，但我总是使用花括号。我发现它们是一种快速查看特定代码行存在范围的便捷方式。没有歧义，它只是明确地摆在你面前。

有人可能会说这是一种偏好，但我发现如果程序的逻辑流程内部一致，则更容易遵循，而且我不认为像这样编写一个 IF 语句是一致的；

```
if(x < y)
    x = y;
else
    y = x; 
```

还有一个这样的；

```
if(x < y)
{
    x = y;
    x++;
}
else
{
    y = x;
    y++;
} 
```

我更喜欢只选择一种通用风格并坚持下去:)

* * *

## 回答 #21

> 赞同：7
> 
> 时间：2008-12-11T15:41:46.417

主要问题之一是当您有单行和非单行区域时，以及与控制语句（`for`, `if`，您有什么）和语句结尾的分离。

例如：

```
for (...)
{
  for (...)
    for (...) 
    {
      // a couple pages of code
    }
  // which for block is ending here?  A good text editor will tell you, 
  // but it's not obvious when you're reading the code
} 
```

* * *

## 回答 #22

> 赞同：7
> 
> 时间：2008-12-11T15:43:59.580

为了防止带大括号的代码占用大量空间，我使用了[Code Complete](http://www.cc2e.com/Default.aspx "代码完成")书中推荐的技术：

```
if (...) {
    foo();
    bar();
}
else {
    ...
} 
```

* * *

## 回答 #23

> 赞同：7
> 
> 时间：2008-12-11T15:46:52.740

我曾经是“大括号是必须的！”的大力支持者，但自从采用单元测试后，我发现我的单元测试可以保护无括号语句免受以下场景的影响：

```
if (foo)
    snafu();
    bar(); 
```

通过良好的单元测试，我可以自信地省略简单语句的花括号以提高可读性（是的，这可能是主观的）。

或者，对于像上面这样的东西，我可能会内联它看起来像：

```
if (foo) snafu(); 
```

这样，需要在条件中添加 bar() 的开发人员将更容易识别缺少花括号并添加它们。

* * *

## 回答 #24

> 赞同：7
> 
> 时间：2009-06-19T00:21:33.567

好吧，这是一个老问题，已经回答得要死了。我有话要补充。

首先，我只需要说使用大括号。它们只能提高可读性，并且可读性（对您自己和他人！）应该在您的优先级列表中非常高，除非您正在编写汇编。不可读的代码总是会导致错误。如果您发现大括号使您的代码占用了太多空间，那么您的方法可能太长了。如果你做得对，任何方法的大部分或全部都应该适合一个屏幕高度，而 Find (F3) 是你的朋友。

现在我要补充：这有一个问题：

```
if (foo) bar(); 
```

尝试设置一个仅在 bar() 将要运行时才会被命中的断点。您可以在 C# 中通过将光标放在代码的后半部分来执行此操作，但这并不明显并且有点痛苦。在 C++ 中你根本做不到。出于这个原因，我们从事 C++ 代码工作的一位最资深的开发人员坚持将“if”语句分成两行。我同意他的看法。

所以这样做：

```
if (foo)
{
    bar(); //It is easy to put a breakpoint here, and that is useful.
} 
```

* * *

## 回答 #25

> 赞同：6
> 
> 时间：2008-12-11T15:37:44.787

假设您有一些代码：

```
if (foo)
    bar(); 
```

然后其他人出现并补充说：

```
if (foo)
    snafu();
    bar(); 
```

根据它的写法，bar(); 现在无条件执行。通过包含花括号，可以防止这种意外错误。代码的编写方式应使此类错误难以或不可能发生。如果我在进行代码审查并看到缺少​​的大括号，特别是分布在多行中，我会创建一个缺陷。在合理的情况下，将其保留在一行上，以便再次将犯此类错误的机会降至最低。

* * *

## 回答 #26

> 赞同：6
> 
> 时间：2008-12-11T15:45:45.003

我总是在适当的时候省略它们，比如在你的第一个例子中。我可以通过浏览来查看和理解的干净、简洁的代码比我必须逐行滚动和阅读的代码更容易维护、调试和理解。我想大多数程序员都会同意这一点。

如果您开始执行多个嵌套、if/else 子句等，它很容易失控，但我认为大多数程序员应该能够知道在哪里划线。

我认为它有点像`if ( foo == 0 )`vs的论点`if ( 0 == foo )`。后者可以防止新程序员（甚至可能偶尔为老手）的错误，而前者在您维护代码时更容易快速阅读和理解。

* * *

## 回答 #27

> 赞同：6
> 
> 时间：2008-12-11T16:44:13.997

减少行并不是删除大括号的好理由。如果您的方法太大，它可能应该被重构为更小的部分或重组。这样做无疑会增加可读性，而不是简单地取出大括号。

* * *

## 回答 #28

> 赞同：6
> 
> 时间：2008-12-13T20:59:48.727

使用一些个人判断。

```
if (foo)
  bar(); 
```

本身很好。除非你真的担心白痴以后会这样做：

```
if (foo)
  bar();
  baz(); 
```

如果你不担心白痴，那你很好（我不是——如果他们不能正确掌握基本的代码语法，这是他们最少的问题）>

作为交换，它更具可读性。

其余时间：

```
if (foo) {
  bar();
  baz();
} 
```

从我记事起，这就是我最喜欢的。此外：

```
if (foo) {
  bar();
  baz();
} else {
  qux();
} 
```

为我工作。

垂直空间本身并不是非常相关，可读性是。一行上的左大括号本身只是停止了一个句法元素的对话，直到你的视线移到下一行。不是我喜欢的。

* * *

## 回答 #29

> 赞同：4
> 
> 时间：2008-12-11T15:41:18.790

大多数时候，无论是对于公司还是 FOSS 项目，它都作为一种编码标准根深蒂固。

最终，其他人将需要深入了解您的代码，并且每个开发人员都必须弄清楚他们正在处理的代码部分的特定样式是一个主要的时间消耗。

另外，想象一下有人每天不止一次地在 Python 和 Cish 语言之间切换……在 Python 中，缩进是语言块语义的一部分，很容易犯像你引用的错误。

* * *

## 回答 #30

> 赞同：4
> 
> 时间：2008-12-11T16:14:24.073

更安全的一面是错误的 - 只是你可能不必修复的另一个错误。

如果我所有的积木都包裹在卷曲中，我个人会觉得更安全。即使对于单行，这些都是很容易防止错误的简单符号。它使代码更具可读性，因为您可以清楚地看到块中的内容，以免将块的主体与块外的以下语句混淆。

如果我有一个单行，我通常将其格式化如下：

```
if( some_condition ) { do_some_operation; } 
```

如果该行太麻烦，请使用以下内容：

```
if( some_condition )
{
    do_some_operation;
} 
```

* * *

## 回答 #31

> 赞同：3
> 
> 时间：2009-09-02T00:24:43.050

他们告诉你是因为他们仍然使用古老的或通用的（不是语言感知的）源代码编辑器。如果您使用具有自动缩进功能的编辑器，您将永远不会犯任何可以通过一直使用大括号来避免的错误。

* * *

## 回答 #32

> 赞同：2
> 
> 时间：2008-12-11T23:56:36.200

结合两全其美的另一种方法是：

```
if(foo)
   {DoSomething();} 
```

如果该行被注释掉，或者在其下方添加另一行，这可以避免任何混淆。

此外，我们使用[MISRA-C](http://www.misra.org.uk/)作为编码标准，它要求所有像这样的结构在所有情况下都使用大括号。

* * *

## 回答 #33

> 赞同：2
> 
> 时间：2008-12-19T02:51:45.067

1.  空白是免费的。
2.  为将来的可读性而依赖缩进意味着依赖于选项卡设置，这不是一个好主意。曾经编写过十年前不受修订控制的代码吗？
3.  我的经验是，您通过不输入花括号节省的任何时间都比我花费额外的时间来弄清楚您的意思所浪费的时间要多。

* * *

## 回答 #34

> 赞同：1
> 
> 时间：2008-12-11T15:38:38.170

如果他/她向应用程序添加逻辑，您的维护程序员可能会忘记添加花括号。所以会发生以下情况：

```
if(foo)
bar();
bar(delete); 
```

代替

```
if(foo) {
bar();
}
 bar(delete); 
```

* * *

## 回答 #35

> 赞同：1
> 
> 时间：2008-12-11T15:48:09.087

*   将打开的括号写在与上一条语句相同的行上：

    ```
    if ( any ) {
        DoSomething();
    } 
    ```

    *   如果你觉得，这太大了，你可以写成一行：

    ```
    if ( any ) { DoSomething(); } 
    ```

    如果你觉得，一行不可读那么好，你可以写成两行：

    ```
    if ( any ) {
        DoSomething(); }
    if ( any )
        { DoSomething(); } 
    ```

    *   将来有人需要将一个语句更改为更多语句。没有括号是更改更复杂。是的，只是一点点，但更好地防止错误。写括号是一种非常简单的廉价方法。

* * *

## 回答 #36

> 赞同：1
> 
> 时间：2008-12-11T15:50:11.470

我不认为省略括号总是一个不好的做法，但是否应该允许以及在什么情况下必须在团队中达成一致。

我觉得这非常易读：-

```
if (foo)
    bar(); 
```

还有这个：-

```
if (foo)
    bar()
else
    snafu(); 
```

如果在这些中添加额外的行：-

```
if (foo)
    bar();
    snafu(); 
```

这看起来全错了，有一段代码，缩进了。但没有支撑。

类似的论点适用于 for 循环。但是，当我开始嵌套时：-

```
if (foo)
    if (bar)
        snafu() 
```

现在我遇到了麻烦，它看起来像一个语句块。就个人而言，我只会在更深的层次上跳过大括号的使用，我会让外部代码使用大括号：-

```
if (foo) {
   if (bar)
       snafu()
} 
```

当我输入这个时，我看到答案从 1 跳到 17，显然这将是一个情绪化的问题（我建议你在标签列表中添加主观性（我这样做的能力已经消失了，这是怎么回事？ ））。

最重要的是在团队中就是否以及如何接受并坚持下去达成一致。

* * *

## 回答 #37

> 赞同：1
> 
> 时间：2008-12-11T23:11:38.927

我认为这一切都归结为偏好和可读性。通常添加花括号会使您的代码更具可读性，因为代码的实际行之间有额外的空间。另外，考虑这个例子（不是故意缩进）：

```
if (condition1)
if (condition2)
doSomething();
else
doSomethingElse(); 
```

doSomethingElse 什么时候被调用？当条件1 为真但条件2 为假时，或者条件1 为假时？添加花括号可以快速解决这个可读性问题并避免混淆。

* * *

## 回答 #38

> 赞同：1
> 
> 时间：2008-12-13T20:53:26.757

我自己曾经讨厌牙套。直到有一天我找到了它们的用途。我在不同的平台上工作，将应用程序从一个平台移植到另一个平台（总共在 6 个平台上工作）。在 UNIX 上，如果您安装了 vim，那么您可以通过按“Shift + 5”轻松跳转到代码块的结尾或开头。这些主要是 if/else 块或循环。

因此，如果我在 vim 上查看 Rampion 的问题，我会完全迷失方向，并且需要一段时间才能完全理解代码。

* * *

## 回答 #39

> 赞同：1
> 
> 时间：2009-06-19T19:54:42.223

因为 StyleCop 是这么说的。

* * *

## 回答 #40

> 赞同：0
> 
> 时间：2008-12-11T15:43:10.347

这是一种折衷，更短的代码（更好的可读性）与更安全的代码（更不容易出错）。

我的 2 美分：

1.  这个规则是有原因的。它是由无数程序员通过长时间的工作开发的，一直工作到深夜或第二天早上，试图修复一个由于一点疏忽而导致的错误。
2.  你不必自己决定这种交易是否值得。
3.  以我的经验，我是无数程序员中的一员，他们彻夜工作以寻找一个讨厌的错误的原因。原因是我懒惰。

* * *

## 回答 #41

> 赞同：0
> 
> 时间：2008-12-11T16:18:34.487

好吧，在我看来，这对我来说更像是个人喜好。但是我注意到为了便于阅读，最好有 { } 然后没有它们。我注意到使用 ReSharper 时，ReSharper 倾向于删除它们，并且如果像这样的语句会执行大多数操作

```
if(this == yes)
      DoSomething(); 
```

但为了可读性，我总是这样做

```
if(this == yes)
{
 DoSomething();
} 
```

尽管“if”语句中只有一行代码的可读性并没有真正的不同，但是如果您将 20-30 行代码放在一个 if 语句中，那么在其中使用 {} 会更容易阅读，并且它留下的错误空间更小，并且代码中的错误。

* * *

## 回答 #42

> 赞同：0
> 
> 时间：2008-12-11T16:40:26.640

当我看到“这种风格节省空间”时，我总是感到困惑。
由于我很少（如果有的话）打印出代码，因此获得空间对我来说没有明显的优势：在磁盘上节省一些字节不值得，而且我不为屏幕上的空间付费。
有些人发现紧凑的代码更具可读性，我不会反对（高度主观），但作为业余艺术家和排版，我非常重视空格的使用......

我不会重复上述论点，但我会补充，我认为，一致性：我不喜欢这样的代码

```
if (foo)
{
  // Lot of code
}
else
  DoStuff(); 
```

话虽如此，有时我沉迷于没有括号：在守卫条件下，当我提前退出时：

```
if (somethingBadHappened)
  return; 
```

总而言之，我认为（几乎）系统地在重要代码周围添加大括号可以提高可读性（代码“呼吸”，而不是局促），一致性，并且可能避免一些愚蠢的错误（是的，这种错误很明显，但编码器是人类（一般来说），可能会累，新手，压力大......）。

我为 SciTE 制作了一个 Lua 宏，可以在任何代码块或当前行周围添加这些大括号，只需一次击键和正确的缩进：这对我来说真的没有任何成本。

现在，如果您选择省略这些大括号，我不会起诉您。正如其他人指出的那样，可以在编码规则中设置一个选项。各有各的。

* * *

## 回答 #43

> 赞同：0
> 
> 时间：2008-12-11T16:50:06.013

一方面，我将大括号留给单个语句。另一方面，我使用 PC-Lint ( [http://www.gimpel.com/](http://www.gimpel.com/) ) 检查所有 C 代码，它将 if() 语句后面的两个或多个缩进行标记为“可疑缩进”。

顺便说一句，将单个语句与 if() 放在同一行看起来是个好主意。

* * *

## 回答 #44

> 赞同：0
> 
> 时间：2008-12-11T21:48:07.380

我总是使用花括号，除了最里面的语句，假设最里面的语句是单行的。所以我的代码看起来像：

```
for (int i=0; i<10; i++) 
{
    for (int x=0; x<20; x++) 
    {
        if (someBoolValue)
            DoThis(x,y);
    }
} 
```

另一个例外当然是堆叠 using 语句。

写作完全没有意义

```
using (Stream x = File.Open(...)) 
{
    using (Stream y = File.Create(...)) 
    {
        ...
    }
} 
```

什么时候可以写

```
using (Stream x = File.Open(...))
using (Stream y = File.Create(...)) 
{
    ....
} 
```

* * *

## 回答 #45

> 赞同：0
> 
> 时间：2008-12-11T22:28:56.970

保罗说：

> 并且缩进独立于大括号的使用。

对于某些编码风格，情况并非如此。在我工作的地方，公司的编码标准允许我们不用大括号，如果不是绝对必要的话；然而，编码标准让我们缩进大括号以及其中的内容，所以我们最终得到这样的结果：

```
if (something)
  {
    for (i = 0; i < count; i++)
      {
        foo();
      }
  } 
```

没有大括号，这变成：

```
if (something
  for (i = 0; i < count; i++)
    foo(); 
```

使用这种编码风格，当存在深度嵌套，以及长变量和函数名并且您总是使用大括号时，您要么会在屏幕右侧看到大量代码，要么会出现大量换行，这两种情况，IMO ，使代码阅读或调试繁琐。出于这个原因，只要我能侥幸逃脱，我总是倾向于不使用牙套。

至于将单个语句与 if 放在同一行，一些公司的编码标准（包括我们的）禁止这样做，所以它并不总是一种选择。

如果这是我的选择，我会更改公司编码标准，使大括号与 if、for 等保持一致，并且正文中的第一行（或注释）与左大括号位于同一行，因此：

```
if (something)
{ for (i = 0; i < count; i++)
  { foo();
  }
} 
```

我会更愿意（并且更有可能）总是使用大括号（甚至会支持“总是使用大括号”规则），因为每对大括号只会添加一个额外的行而不会缩进，使它几乎和没有大括号一样紧凑。

* * *

## 回答 #46

> 赞同：0
> 
> 时间：2008-12-30T00:28:36.620

我也喜欢更紧凑的格式。这就是为什么我经常按 Ctrl+K、Ctrl+D 在 Visual Studio 中重新格式化的原因。我只是希望每次按键后都能让它为我做这件事。

* * *

## 回答 #47

> 赞同：0
> 
> 时间：2009-06-19T21:11:33.253

如果您觉得“有时”使用大括号很有用，那么您应该添加大括号以保持一致。程序应该写给人而不是计算机来阅读。我更喜欢大括号，例如：

```
if (mybool)
{
  doMyStuff();
}
else
{
  doMyOtherStuff();
  checkStuff();
} 
```

不喜欢

```
if (mybool) {
  doMyStuff();
}
else {
  doMyOtherStuff();
  checkStuff();
} 
```

不喜欢

```
 if (mybool)
     doMyStuff(); 
   else 
   {  
     doMyOtherStuff();
     checkStuff(); 
   } 
```

* * *

## 回答 #48

> 赞同：0
> 
> 时间：2009-06-19T21:16:35.740

另一方面，如果您要删除/不使用大括号来保存行，则需要重构代码。

* * *

## 回答 #49

> 赞同：-1
> 
> 时间：2008-12-11T16:38:24.430

您是否考虑过为单行 if else 语句探索此选项：

```
(!a) ? Foo() : Bar(); 
```

* * *

## 回答 #50

> 赞同：-1
> 
> 时间：2008-12-12T03:53:22.773

在大多数情况下，我更喜欢大括号。通常，您会回到代码中添加更多代码行，无论如何您都必须添加它们。

* * *

## 回答 #51

> 赞同：-1
> 
> 时间：2008-12-12T16:38:35.123

这里有很多关于你为什么不应该的很好的答案——我站在同意你不应该省略大括号的一边。

如果您正在寻找更简洁的代码，我实际上会使用三元语句。它们提供了紧凑性和一定程度的明确性，并且更能抵抗事故。

如前所述，省略括号的问题是事后出错的可能性。大多数程序员会同意他们可以阅读：

```
if( foo )
    bar(); 
```

当人们来改变陈述而不注意时，问题就来了。在我工作的最后一个地方，实际上有人修改了语句或注释掉了一行。制定了编码标准，以确保此类错误不再发生。

正如其他人所说，程序员的时间是昂贵的。就像注释代码一样，省略位通常更快，因为它们是可选的，但易于维护的代码通常依赖于那些“可选”的东西。

最后，有人提到现代编辑器和 IDE 应该自动缩进并自动显示范围。我的回答是不要使用拐杖之类的东西。有时您会从源存储库或远程连接甚至电子邮件中查看代码——这些都是开发的现实。您可能没有 IDE 或高级编辑器来显示您做错了什么。始终编​​写代码，以便无论您加载什么代码都可以理解。

* * *

## 回答 #52

> 赞同：-2
> 
> 时间：2008-12-11T16:00:15.427

AFAIR 花括号始终是一个作用域，因此每次都使用它们是件好事。

没有大括号：

```
if(DoSomething)
    MyClass myClass = new MyClass();

myClass.DoAnythingElse(); 
```

这将编译，但很容易导致空引用。（C# 编译器不编译这个，好东西！）

而这种方式：

```
if(doSomething)
{
    MyClass myClass = new MyClass();
}

myClass.DoAnythingElse(); 
```

甚至不会编译。

它比在编译时最小化异常要好得多，而不是在运行时找到它们。

# sql - Oracle 记录历史使用截至时间戳在一个范围内

> ID：359733
> 
> 赞同：3
> 
> 时间：2008-12-11T15:34:28.583
> 
> 标签：sql, oracle, caching, timestamp, range

我最近了解到 oracle 有一个对我非常有用的特性——因为设计者/实现者不太关心数据历史——我可以查询记录的历史状态（如果它在 oracle 缓存中可用），如下所示：

```
select * 
  from ( select * 
           from sometable where some_condition ) 
as of timestamp sysdate-1 
```

但是现在我需要检查一个范围内的历史数据。无论如何，使用缓存有可能吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-11T15:53:54.317

是的，像这样：

```
SQL> select sal from emp where empno=7369;

       SAL
----------
      5800

SQL> update emp set sal = sal+100 where empno=7369;

1 row updated.

SQL> commit;

Commit complete.

SQL> update emp set sal = sal-100 where empno=7369;

1 row updated.      

SQL> commit;

Commit complete.

SQL> select empno, sal, versions_starttime,versions_xid
  2  from emp
  3  versions between timestamp sysdate-1 and sysdate
  4  where empno=7369;

     EMPNO        SAL VERSIONS_STARTTIME                                                          VERSIONS_XID
---------- ---------- --------------------------------------------------------------------------- --
      7369       5900 11-DEC-08 16.05.32                                                          0014001300002A74
      7369       5800 11-DEC-08 16.03.32                                                          000D002200012EB1
      7369       5800 
```

请注意，您可以返回多远受 UNDO_RETENTION 参数的限制，通常是几小时而不是几天。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-11T16:59:44.217

需要注意的一点是，这种闪回查询依赖于写入 UNDO 表空间的 UNDO 信息。而且这些信息不会永远保留——大多数处于合理负载下的生产系统不会有 24 小时的 UNDO 信息可用。

根据 Oracle 版本，您可能需要将该`UNDO_RETENTION`参数设置为比您尝试闪回的时间段更长的值。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-11T15:51:41.793

```
SELECT *
  FROM sometable
  VERSIONS BETWEEN TIMESTAMP systimestamp - 1 AND systimestamp 
```

将为您提供最后一天所有行的所有版本。

你可以用这个做更多的事情。查看[文档](http://download.oracle.com/docs/cd/B28359_01/server.111/b28286/statements_10002.htm)（您可能希望找到适合您的版本的文档）。

# windows-services - 如何将我的应用程序作为 Windows 服务启动？

> ID：359742
> 
> 赞同：3
> 
> 时间：2008-12-11T15:36:29.813
> 
> 标签：windows-services

我有一个想要作为 Windows 服务运行的 Windows 应用程序 - 我该怎么做？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-11T15:49:48.333

您可以使用一个工具来执行此操作：[XYNTService](http://mysite.verizon.net/XiangYangL/XYNTService.htm)。

这是一项可以启动常规应用程序的服务，我们在工作中使用它，它也适用于 GUI 应用程序。由于该服务在本地 SERVICE 帐户下运行，因此您无法看到 GUI 或以任何方式访问它，因为它正在另一个 winlogon 会话中运行。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-11T15:45:53.990

Quick-n-dirty 方式，使用 Windows 资源工具包中的 INSTSRV 和 SRVANY 工具： [如何创建用户定义的服务](http://support.microsoft.com/kb/137890)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-11T15:54:50.150

### 您拥有源代码的 .Net 应用程序的解决方案：

如果您的项目有一个分离良好的控制器和业务逻辑 (MVC)，这将非常容易和快速。

首先，在您的解决方案中创建一个新项目并选择“Windows 服务”。这将为您创建一个带有包含 Main 的 Program 类的新项目。

在 Main 中，您需要附加 Service Base 类。

```
static class Program
{
    static void Main()
    {
        ServiceBase[] ServicesToRun;
        ServicesToRun = new ServiceBase[] {new Service1(), new MySecondUserService()};
        ServiceBase.Run(ServicesToRun);       
    }
} 
```

在您的服务内部（您需要覆盖的扩展 ServiceBase 的服务：

```
protected override void OnStart(string[] args) 
```

要调用您的控制器来开始工作，或者您可以简单地从 while(...) 开始使用线程。

否则，Patrick Cuff 的链接是一个很好的链接。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-07-24T08:22:09.163

尝试这个：

[http://support.microsoft.com/kb/137890](http://support.microsoft.com/kb/137890)

它适用于任何版本的 Windows。我最近使用 Server 2008 对其进行了测试。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-07-24T08:12:21.367

除了已经推荐的 XYNTService 和 SRVANY 之外，您还应该考虑[AlwaysUp，这是一种商业产品，旨在将任何应用程序作为 Windows 服务运行](http://www.CoreTechnologies.com/products/AlwaysUp)。您可以免费试用 30 天，以确保它能为您完成这项工作。

祝你好运！

# c - 您如何在内存非常有限的嵌入式系统上处理大量数据传输？

> ID：359745
> 
> 赞同：6
> 
> 时间：2008-12-11T15:37:17.690
> 
> 标签：c, embedded, serial-port, interrupt, spi

我有一个微控制器，它必须从 PC 串行端口（115200 波特）下载一个大文件，然后通过 SPI（~2 MHz）将其写入串行闪存。闪存写入必须在 256 字节块中，前面有写入命令和页面地址。系统上可用的总 RAM 为 1 kB，堆栈大小为 80 字节。

这目前是通过从 UART 填充一个 256 字节缓冲区然后乒乓到另一个 256 字节缓冲区来工作的，该缓冲区由 RX 缓冲区就绪信号上的中断填充，同时使用忙写入写入闪存。重复缓冲区交换，直到操作完成。

我更愿意为在单独的循环缓冲区上运行的 SPI 和 UART 端口设置 TX/RX 中断处理程序。因此，我可以简单地填充 TX 缓冲区并启用中断或检查缓冲区是否有传入数据，而不是轮询新字节并等待操作完成。这将为实际工作提供更多时钟周期，而不是等待外围设备。

在使用 128 字节循环缓冲区实现 IRQ 后，我轮询 UART RX 缓冲区中的数据并立即将其放入 SPI TX 缓冲区以进行文件传输。我使用这种方法遇到的问题是我没有足够的 RAM 用于缓冲区，并且 PC 接收缓冲区的填充速度比我将数据传输到闪存传输缓冲区的速度要快。显然，传输速度不是问题（115.2 kHz 输入和 2 MHz 输出），但在传输每个 256 字节页面后有一个写周期等待。

* * *

似乎频繁的 SPI 中断阻塞了一些 UART 中断并导致字节丢失。我选择的解决方案是为 UART 接收中断使用一个环形缓冲区，并将数据馈送到一个 256 字节的页面缓冲区，该缓冲区通过轮询字节传输和写入完成来发送到串行闪存。一个 128 的环形缓冲区足够大，可以防止 SPI 写入期间的溢出。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-11T15:49:14.717

应用程序的 UART 和 PC 端是否支持 RS-232 握手（流控制）？如果是这样，当您的接收缓冲区接近满时，让 ISR 删除 CTS 线 - 如果 PC 端配置为尊重硬件流控制，它应该在看到这种情况时停止发送。一旦你耗尽（或几乎耗尽）接收缓冲区，再次断言 CTS，PC 应该再次开始发送。

请注意，这会使嵌入式设备上的软件变得相当复杂 - 您是否愿意做出权衡，必须由您和您的经理和团队进行分析。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-11T15:50:07.397

这正是创建流量控制的目的，我知道设置它是一个巨大的痛苦，但如果您在串行线路上启用流量控制，您的问题将成为历史。

我假设您正在传输二进制文件，所以 XON-XOFF 不是最好的解决方案，它留下了硬件流控制。

另一种选择是使用具有内置流量控制的协议，例如 XModem。我有一个类似的嵌入式项目，其中闪存写入 128 字节页面。XModem 以 128 字节的块发送数据然后在发送下一个之前等待 ACK 是多么巧合。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-11T16:24:22.757

我会在PC上做一些分散收集的事情。创建一个结构的链表，如下所示：

```
typedef struct data_buffer {
    char flags;
    char[128] data;
} 
```

标志中的一位表示“ReadyToFlash”，一位表示“Flashing”。您应该能够调整链接列表中的缓冲区数量，以防止闪存在写入时捕获 UART，反之亦然。

如果闪存到达不是“ReadyToFlash”的缓冲区块，它将停止，您需要让您的 UART IRQ 重新启​​动它。如果 UART 到达“ReadyToFlash”或“Flashing”的块，它填充太快，您可能需要另一个缓冲区，如果您有动态内存，您可以在运行时进行此调整并动态添加一个缓冲区到列表中，否则你只需要做一些经验测试。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-11T16:05:04.670

不确定我在这里遗漏了什么，但如果事实是来自 PC 的数据的平均速率高于您可以将其写入闪存的平均速率，那么您要么需要大量 RAM ，否则您将需要流量控制。

但是你是说当你有块缓冲区时它工作，但现在你有字节缓冲区它没有？

您能否坚持使用由 UART RX 中断填充的块缓冲区，当每个缓冲区已满时，将其交给 SPI/Flash 代码以使用 SPI 中断清空该缓冲区？这将节省您复制每个字节的时间，并且不必为每个字节执行两次循环缓冲区逻辑，您只需为每个块执行此操作。

# wpf - WPF 应用程序创建安装程序

> ID：359751
> 
> 赞同：3
> 
> 时间：2008-12-11T15:39:03.677
> 
> 标签：wpf

我正在使用 VS 2005 创建 WPF 应用程序。我下载了插件以创建 WPF 应用程序。现在为了部署应用程序，我需要安装程序来自动下载 WPF 组件。请注意，我无法在客户端机器上安装 3.5 框架。有一些规则和事情可以防止这种情况发生。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-14T10:15:11.600

.NET 框架客户端配置文件将为您提供帮助。[去这里了解更多细节](http://blogs.windowsclient.net/trickster92/archive/2008/05/21/introducing-the-net-framework-client-profile.aspx) 或[视频在这里](http://channel9.msdn.com/posts/mtaulty/WPF-ClickOnce-and-the-NET-Client-Profile/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-14T10:09:04.263

为了运行 WPF 应用程序，您需要安装 .net 3.0（它总是预装在 Vista 上）。

有一些技巧可以将一些 dll 从 3.0 或 3.5 复制到 .net 2.0 安装中，但这是不受支持的 - 这意味着它可能会工作，但也可能会破坏其他应用程序，并且每次在系统中更新某些内容时它可能会停止工作 -所以请不要这样做。

好消息是 .net 3.5sp1（以及一些错误修复）将很快出现在 Windows 更新中 - 所以这个问题可能是暂时的。

如果您决定以 3.0 而不是 3.5 为目标，您只需要注意不要使用 3.5 中的任何新内容，并在发布之前在 3.0 上进行测试。

顺便说一句，VS2005 对 WPF 的支持真的很差，而且从来没有正式发布过，你可能要考虑升级到 VS2008，即使是 VS2008 的免费快递版本，WPF 开发工具也比 VS2005 好得多。

# .net - 在 WPF 中设置 Tab 键顺序

> ID：359758
> 
> 赞同：94
> 
> 时间：2008-12-11T15:40:48.930
> 
> 标签：.net, wpf, tab-ordering, keyboard-navigation

如何在 WPF 中设置制表符排序？我有一个 ItemsControl，其中一些项目已展开，有些项目已折叠，并且希望在我进行选项卡时跳过折叠的项目。

有任何想法吗？

* * *

## 回答 #1

> 赞同：92
> 
> 时间：2009-02-26T17:52:28.243

如果您想为表单中的元素显式设置制表符顺序，以下附加属性应该会有所帮助：

```
<Control KeyboardNavigation.TabIndex="0" ... /> 
```

我说“应该有帮助”，因为我发现它不是很可靠，尽管我可能需要阅读更多关于它打算如何使用的信息。我只发布这个半生不熟的答案，因为没有其他人提到这个属性。

* * *

请注意，在 Win RT 中，该属性只是`TabIndex="0"`.

* * *

## 回答 #2

> 赞同：65
> 
> 时间：2008-12-11T19:34:54.887

您可以通过在 XAML 中的元素上设置[KeyboardNavigation.IsTabStop](http://msdn.microsoft.com/en-us/library/system.windows.input.keyboardnavigation.istabstop.aspx)来跳过选项卡序列中的元素。

```
KeyboardNavigation.IsTabStop="False" 
```

您可以设置一个触发器，该触发器将根据展开状态切换此属性。

* * *

## 回答 #3

> 赞同：25
> 
> 时间：2010-05-25T03:16:45.433

`<Control KeyboardNavigation.TabIndex="0" ... />`工作得很好......例如 -

```
<ComboBox Height="23" 
          Margin="148,24,78,0" 
          Name="comboBoxDataSet"
          VerticalAlignment="Top"
          SelectionChanged="comboBoxDestMarketDataSet_SelectionChanged"
          DropDownOpened="comboBoxDestMarketDataSet_DropDownOpened"
          KeyboardNavigation.TabIndex="0" />
<ComboBox Height="23" 
          Margin="148,56,78,0" 
          Name="comboBoxCategory" 
          VerticalAlignment="Top" 
          SelectionChanged="comboBoxDestCategory_SelectionChanged"
          DropDownOpened="comboBoxDestCategory_DropDownOpened"
          KeyboardNavigation.TabIndex="1" /> 
```

将允许您使用 TAB 键浏览这两个组合框。

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2011-11-30T13:50:33.890

我认为这里有一个更简单的解决方案，在您的控件或窗口或其他任何内容的顶部，您可以添加：

```
KeyboardNavigation.TabNavigation="Cycle" 
```

这也会自动忽略折叠的选项卡。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2014-06-06T16:59:43.310

过去对我有用的另一种选择是简单地删除所有显式`TabIndex`语句，并让控件使用它们在 XAML 中声明的顺序来发挥它们的魔力。

当然，这可能需要您重新排序控件。但这是一个简单的复制粘贴操作。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2020-06-22T18:38:44.620

您可以使用 KeyboardNavigation.TabNavigation="None" 完全跳过特定控件的 Tabbing。

# .net - .NET WinForms：如何使用需要窗口句柄的 API 调用？

> ID：359763
> 
> 赞同：2
> 
> 时间：2008-12-11T15:41:55.417
> 
> 标签：.net, winforms, pinvoke

## 精简版

当我无法保证窗口句柄将保持有效时，如何使用 API 调用？

我可以保证我持有对我的表单的引用（因此不会处理该表单）。这并不能保证表单的**句柄**将一直保持有效。

*即使没有处理表单，表单的窗口句柄如何变得无效*？

因为窗体的底层 Windows 窗口被破坏并重新创建。

## 长版

我想 P/Invoke 一个需要 hwnd（窗口句柄）的 API。需要 hWnd 的 API 调用的一些示例是：

[IVMRWindowlessControl::SetVideoClippingWindow](http://msdn.microsoft.com/en-us/library/ms787175(VS.85).aspx)

```
 HRESULT SetVideoClippingWindow(
    HWND  hwnd
 ); 
```

[发信息](http://msdn.microsoft.com/en-us/library/ms644950.aspx)

```
SendMessage(          
   HWND hWnd,
   UINT Msg,
   WPARAM wParam,
   LPARAM lParam
); 
```

[设置剪贴板查看器](http://msdn.microsoft.com/en-us/library/ms649052.aspx)

```
HWND SetClipboardViewer(
   HWND hWndNewViewer
); 
```

[设置定时器](http://msdn.microsoft.com/en-us/library/ms644906.aspx)

```
UINT_PTR SetTimer(
   HWND hWnd,
   UINT_PTR nIDEvent,
   UINT uElapse,
   TIMERPROC lpTimerFunc
); 
```

[IProgressDialog::StartProgressDialog](http://msdn.microsoft.com/en-us/library/bb775262(VS.85).aspx)

```
HRESULT StartProgressDialog(          
   HWND hwndParent,
   IUnknown *punkEnableModless,
   DWORD dwFlags,
   LPCVOID pvReserved
); 
```

[Shell_NotifyIcon](http://msdn.microsoft.com/en-us/library/bb762159(VS.85).aspx)

```
BOOL Shell_NotifyIcon(          
   DWORD dwMessage,
   PNOTIFYICONDATA lpdata  //<--hWnd in there
); 
```

[动画窗口](http://msdn.microsoft.com/en-us/library/ms632669.aspx)

```
BOOL AnimateWindow(   
   HWND hwnd,
   DWORD dwTime,
   DWORD dwFlags
); 
```

**注意：**其中一些 API 调用具有托管等效项，有些则没有 - 但这一事实与我的问题无关。

## 解释

我可以调用其中一个需要长期窗口句柄的 API 函数，例如：

```
private void TellTheGuyToDoTheThing()
{
   SendMessage(this.Handle, 
      WM_MyCustomMessage, 
      paramOneForTheThing, 
      paramTwoForTheThing);
} 
```

有人建议上述对 SendMessage 的调用是危险的，因为对窗口句柄的非托管使用。他们建议您将 hwnd 包装在 HandleRef 对象中：

```
private void TellTheGuyToDoTheThing()
{
   SendMessage(new HandleRef(this, this.Handle),
      WM_MyCustomMessage, 
      paramOneForTheThing, paramTwoForTheThing); 
```

这样：窗口句柄在调用 SendMessage 期间保证保持有效。但它并不总是这样。以下 API 调用需要长期访问窗口句柄：

```
private void RegisterWithTheThing()
{
   this.nextClipboardViewerInChain = SetClipboardViewer(
       new HandleRef(this, this.Handle));
} 
```

即使我将句柄包装在 HandleRef 中，表单的窗口句柄仍有可能（在子序列秒、分钟、小时、天、周、月或年）变得无效。当窗体的底层 Windows 窗口被销毁并创建一个新窗口时，就会发生这种情况。尽管事实上我在 HandleRef 中保护了表单的句柄。

我可以说出表单句柄无效的*一种方式：*

```
this.RightToLeft = RightToLeft.Yes; 
```

重新创建窗体的窗口，旧的 hwnd 现在无效。

那么问题来了：如何使用需要窗口句柄的 API 调用？

## 不能做吗？

我期待答案：*你不能这样做。只要您需要保留句柄，就无法保护表单的句柄以确保其有效。*

这意味着我需要知道句柄何时被销毁，所以我可以告诉 Windows 放手，例如：

```
protected override void TheHandleIsAboutToBeDestroyed()
{
    ChangeClipboardChain(this.Handle, this.nextClipboardViewerInChain);
} 
```

然后在创建新句柄时被告知：

```
protected override void TheHandleWasJustCreated()
{
   RegisterTheThing();
} 
```

除了不存在这样的祖先方法。

**替代问题：**是否有我可以覆盖的方法，以便我知道窗口的句柄何时即将被销毁，以及它何时刚刚被创建？

不得不打破重新创建句柄的 .NET WinForms 封装是丑陋的，但这是唯一的方法吗？

* * *

## 更新一

处理表单的**Close** / **OnClose**事件是不够的，同样如此

*   处理 IDisposable
*   GC 固定表单

因为我可以在不关闭或处置表单的情况下使表单的底层窗口句柄无效。例如：

```
private void InvalidThisFormsWindowHandleForFun()
{
   this.RightToLeft = RightToLeft.Yes;
} 
```

**注意：**您*销毁*了 Windows 窗口句柄，而不是处置它。.NET 中的对象是被处理掉的东西；如果它是一个 Form 对象，则很可能涉及*破坏*Windows 窗口句柄。

Windows 是 Microsoft 的产品。

窗口是一个带有消息循环的东西，有时可以在屏幕上显示东西。

* * *

## 更新二

[me.yahoo.com/a/BrYwg](https://stackoverflow.com/questions/359763/net-winforms-how-to-use-an-api-call-that-requires-a-window-handle#360023)有一个很好的建议，即使用[NativeWindow](http://msdn.microsoft.com/en-us/library/system.windows.forms.nativewindow.aspx)对象充当需要用于侦听消息的 hWnd 的项目的侦听器。这可以用来解决一些问题，例如：

*   设置剪贴板查看器
*   设置定时器
*   IProgressDialgo::StartProgressDialog
*   Shell_NotifyIcon

但不适用于

*   动画窗口
*   发信息
*   IVMRWindowlessControl::SetVideoClippingWindow

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-11T16:44:50.173

您是否查看过 NativeWindow 类中的功能？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-12T14:12:23.310

你能忍受在你的表单上覆盖 OnHandleCreated 和 OnHandleDestroyed 并采取相应的行动吗？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-11T16:16:48.170

您可能希望为此使用 GCHandle (System.Runtime.InteropServices.GCHandle)。GCHandle 可用于“固定”对象，以便 .NET 将其保存在一个内存位置。我广泛使用它来与 waveOut API 交互；没有固定，该应用程序只是偶尔神秘地崩溃。

显然，这在窗口实际被破坏然后重新创建的情况下没有用。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-11T15:46:54.410

我认为应该覆盖表单的 OnClose 函数（或相关事件）。

替代方案 - 每个表单都实现 IDisposable - 为什么不将代码添加到属于该句柄的表单的 Dispose 方法。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-12-30T14:05:10.317

> 我可以说出表单句柄无效的一种方式：
> 
> ```
> this.RightToLeft = RightToLeft.Yes; 
> ```

我知道另一种方式：

```
this.ShowInTaskbar = false; 
```

# highrise - 删除 Highrise 应用程序中的所有电子邮件

> ID：359770
> 
> 赞同：1
> 
> 时间：2008-12-11T15:43:59.110
> 
> 标签：highrise

如何删除[高层](http://highrisehq.com/)应用程序中的所有电子邮件？我不想删除整个事情并重新开始，我有公司、标签和元数据。最简单的方法是什么？

这个问题转述自[Tibor Holoda](http://getsatisfaction.com/people/tiborholoda)关于[GetSatisfaction](http://getsatisfaction.com)的[问题](http://getsatisfaction.com/37signals/topics/can_you_help_me_deleting_all_emails_and_start_again_please)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-11T15:46:35.783

看起来这可以通过[API获得，并且使用](http://developer.37signals.com/highrise)[ruby​​ 绑定](http://developer.37signals.com/highrise/highrise.rb)应该很容易：

```
#!/usr/bin/env ruby
ENV['SITE'] = "http://passkey:X@my.hirisehq.com"
require 'highrise'
Highrise::Person.each do |person|
  person.emails.each {|email|
    email.destroy
  }
end 
```

# wpf - 如何在 DataTemplate 中为数据绑定值添加下划线？

> ID：359775
> 
> 赞同：0
> 
> 时间：2008-12-11T15:45:21.557
> 
> 标签：wpf, data-binding, xaml, .net-3.5

如果我想在 TextBlock 中显示带下划线的值，我必须使用 Run 元素。（如果有更好/更简单的方法，我很想听听。）

```
<TextBlock>
  <Run TextDecorations="Underline" Text="MyText" />
</TextBlock> 
```

理想情况下，要在 DataTemplate 中实现这一点，它看起来像这样：

```
<DataTemplate x:Key="underlineTemplate">
  <TextBlock>
    <Run TextDecorations="Underline" Text="{Binding Value}" />
  </TextBlock>
</DataTemplate> 
```

但是，这不起作用，因为 Run 的 Text 属性不是 DependencyProperty，因此您无法对其进行数据绑定。有谁知道我怎么能做到这一点？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-11T16:03:23.050

TextDecoration 是一个附加属性，因此它也可以应用于 TextBlock。您可以通过模板化 TextDecorations 属性来创建一些非常酷的效果。

请参阅此[MSDN 文章](http://msdn.microsoft.com/en-us/library/system.windows.textdecorations.underline.aspx)。

```
<TextBlock TextDecorations="Underline" Text="{Binding Value}" /> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-11T15:59:19.173

这对我有用：

```
<TextBlock Text="MyText" TextDecorations="Underline" /> 
```

# windows - 获取蓝牙映射文件夹的文件系统句柄

> ID：359780
> 
> 赞同：1
> 
> 时间：2008-12-11T15:45:55.020
> 
> 标签：windows, filesystems, bluetooth

有没有办法让代码级访问蓝牙映射驱动器？一个简单的用例是我在资源管理器中有一个蓝牙文件夹，看起来像：

“我的蓝牙位置\整个蓝牙邻居\DEV1\OBEX 文件传输\E:\”

它映射到设备根目录，我希望能够通过将其视为标准目录来读取/写入文件系统。

这可能吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-16T16:10:29.373

这是不可能的。实现此目的的方法是打开与相关设备的蓝牙串行连接，并使用[OBEX 文件传输配置文件](https://obex4j.dev.java.net/files/documents/2519/9269/OBEX13.pdf)遍历其文件系统。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-07-09T20:44:46.997

是的。

您在资源管理器中看到的是 PIDL 的字符串表示形式——标识符列表。

你应该学习 COM 作为技术，然后是 Shell 扩展。

对于您在资源管理器中看到的，是一个虚拟的“文件”系统。蓝牙软件对其进行了扩展。

这里有一扇门：[IShellFolder](http://msdn.microsoft.com/en-us/library/bb775075(VS.85).aspx)接口。请注意，这不是开始学习的最佳场所。

# php - 使用 PHP 将 mm/dd/yyyy 格式转换为纪元

> ID：359782
> 
> 赞同：11
> 
> 时间：2008-12-11T15:46:21.057
> 
> 标签：php, timestamp, epoch

我有一个 mysql 表，它依赖于与条目日期等效的 unix 纪元时间戳，以在网站的各个部分进行排序和过滤。我正在尝试实现一个日期选择器，它将日期以 mm/dd/yyyy 格式输入到表单字段中。我一直在努力将该日期转换为 unix 纪元格式以将该条目添加到行字段中。我所做的所有尝试都导致生成当天的纪元时间戳。有谁知道我如何采用该日期格式并转换为等效的纪元时间戳？

提前致谢。

**附加信息：**

我一直在尝试 mktime，我得到的只是今天的时代。抱歉，我应该早点添加一些代码来更好地解释：

表单 ID 为“日期” 数据库字段为“纪元”

这是我发布 for 日期时正在尝试的（未成功）：

```
$epochhold = ($_POST['date']);
$epoch = mktime(0,0,0,$epochhold); 
```

我从之前的帖子中了解到，这仍然会将值提交为 mm/dd/yyyy 而不是 mktime 期望的 mm、dd、yyyy，但是该帖子没有提供有关如何执行此操作的解决方案。我尝试使用 str_replace 将“/”更改为“”，这产生了相同的结果 - 无论输入的日期如何，都可以获取今天的纪元日期。

这是该代码示例 - 这同样不起作用，但我添加它以帮助说明我尝试过的内容

```
$epochhold = ($_POST['date']);
$epochold2 = str_replace('/', ', ', $epochhold)
$epoch = mktime(0,0,0,$epochhold2); 
```

也感谢您之前的回复，我不希望快速回复被忽视！

**谢谢大家！**

感谢大家的回复 - strtotime 似乎在最初的测试中工作得最好，并且可能是要走的路，因为这种格式在整个网站上都是一致的。但是所有的建议都对其他一些事情有所帮助，所以再次感谢大家！

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-12-11T16:16:12.900

如果您知道它将始终采用该格式，strtotime 会将其直接转换为 unix 时间戳。

```
strtotime($_POST['app_date']); 
```

！

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-11T15:48:18.947

您应该查看[mktime()](http://lv2.php.net/manual/en/function.mktime.php)函数。将其与正则表达式或[strtotime()](http://us3.php.net/strtotime)结合使用，您将拥有它。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-11T16:21:08.880

```
if ( ! preg_match('#\d{2}/\d{2}/\d{4}#', $_POST['date']) ) {
    // complain about invalid input
}

list($m, $d, $y) = explode('/', $_POST['date']);
$timestamp = mktime(0, 0, 0, $m, $d, $y); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-11T16:38:45.473

您需要将 dd、mm、yyyy 作为单独的变量发送到 mktime。它将 $epochold2 中的值作为一个对 mktime 无效的字符串。

您最好的选择是使用我之前所说的 strtotime，或者使用 mktime 遵循 Ant P 的建议。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-11T17:01:25.787

[strtotime()](http://us2.php.net/strtotime)将解析几乎任何日期格式并返回 Unix 时间戳。您所要做的就是将您的日期/时间字符串传递给它：

```
$unix_time = strtotime($_POST['date']);
if($unix_time < 0) {
    //error case
}
else {
    //value OK!
} 
```

正如您在上面看到的，您甚至可以使用它来帮助验证输入 - 如果用户输入像 02/31/2008 这样的日期，它将返回 -1。

# javascript - 当我将其名称作为字符串时如何执行 JavaScript 函数

> ID：359788
> 
> 赞同：1196
> 
> 时间：2008-12-11T15:47:10.663
> 
> 标签：javascript

我将 JavaScript 中的函数名称作为字符串。如何将其转换为函数指针，以便以后调用它？

根据具体情况，我可能还需要将各种参数传递给方法。

某些功能可能采用`namespace.namespace.function(args[...])`.

* * *

## 回答 #1

> 赞同：1575
> 
> 时间：2008-12-11T16:15:36.067

`eval`除非您*绝对、肯定*别无选择，否则不要使用。

如前所述，使用类似这样的方法是最好的方法：

```
window["functionName"](arguments); 
```

但是，这不适用于命名空间的函数：

```
window["My.Namespace.functionName"](arguments); // fail 
```

这就是你要这样做的方式：

```
window["My"]["Namespace"]["functionName"](arguments); // succeeds 
```

为了使这更容易并提供一些灵活性，这里有一个方便的功能：

```
function executeFunctionByName(functionName, context /*, args */) {
  var args = Array.prototype.slice.call(arguments, 2);
  var namespaces = functionName.split(".");
  var func = namespaces.pop();
  for(var i = 0; i < namespaces.length; i++) {
    context = context[namespaces[i]];
  }
  return context[func].apply(context, args);
} 
```

你会这样称呼它：

```
executeFunctionByName("My.Namespace.functionName", window, arguments); 
```

注意，你可以传入任何你想要的上下文，所以这和上面的一样：

```
executeFunctionByName("Namespace.functionName", My, arguments); 
```

* * *

## 回答 #2

> 赞同：105
> 
> 时间：2010-12-04T02:16:46.673

[只是想我会发布一个对Jason Bunting 非常有用的功能](https://stackoverflow.com/questions/359788/javascript-function-name-as-a-string/359910#359910)稍作修改的版本。

首先，我通过向*slice()*提供第二个参数来简化第一条语句。原始版本在除 IE 之外的所有浏览器中都可以正常工作。

其次，我在 return 语句中用*上下文替换了**它；*否则，在执行目标函数时，*它*总是指向*窗口。*

 ***```
function executeFunctionByName(functionName, context /*, args */) {
    var args = Array.prototype.slice.call(arguments, 2);
    var namespaces = functionName.split(".");
    var func = namespaces.pop();
    for (var i = 0; i < namespaces.length; i++) {
        context = context[namespaces[i]];
    }
    return context[func].apply(context, args);
} 
```

* * *

## 回答 #3

> 赞同：76
> 
> 时间：2008-12-11T15:49:12.830

另一个问题的答案向您展示了如何做到这一点：[Javascript 等效于 Python 的 locals()？](https://stackoverflow.com/questions/39960/javascript-locals)

基本上可以说

```
window["foo"](arg1, arg2); 
```

或者正如许多其他人所建议的那样，您可以只使用 eval：

```
eval(fname)(arg1, arg2); 
```

虽然这是非常不安全的，除非你完全确定你正在评估什么。

* * *

## 回答 #4

> 赞同：69
> 
> 时间：2015-06-02T17:13:51.510

我认为这样做的一种优雅方法是在哈希对象中定义你的函数。然后，您可以使用字符串从哈希中引用这些函数。例如

```
var customObject = {
  customFunction: function(param){...}
}; 
```

然后你可以调用：

```
customObject['customFunction'](param); 
```

其中 customFunction 将是与对象中定义的函数匹配的字符串。

**更新**

似乎这个答案对许多其他编码员都有帮助，所以这里有一个更新版本。

使用 ES6，您还可以使用*计算属性名称*，这将允许您避免使用魔法字符串。

```
const FunctionNames = Object.freeze({ 
  FirstFunction: "firstFunction", 
  SecondFunction: "secondFunction" 
});

...

var customObject = {
  [FunctionNames.FirstFunction]: function(param){...},
  [FunctionNames.SecondFunction]: function(param){...}
};

...

customObject[FunctionNames.FirstFunction](param);
```

* * *

## 回答 #5

> 赞同：62
> 
> 时间：2013-08-16T20:56:32.373

你能不能这样做：

```
var codeToExecute = "My.Namespace.functionName()";
var tmpFunc = new Function(codeToExecute);
tmpFunc(); 
```

您还可以使用此方法执行任何其他 JavaScript。

* * *

## 回答 #6

> 赞同：47
> 
> 时间：2015-07-08T10:22:31.807

使用 ES6，您可以按名称访问类方法：

```
class X {
  method1(){
    console.log("1");
  }
  method2(){
    this['method1']();
    console.log("2");
  }
}
let x  = new X();
x['method2'](); 
```

输出将是：

```
1
2 
```

* * *

## 回答 #7

> 赞同：27
> 
> 时间：2008-12-11T16:01:21.963

两件事情：

*   避免评估，这是非常危险和缓慢的

*   其次，你的函数存在于哪里并不重要，“全局”是无关紧要的。`x.y.foo()`可以通过`x.y['foo']()`或`x['y']['foo']()`什至启用`window['x']['y']['foo']()`。你可以像这样无限地链接。

* * *

## 回答 #8

> 赞同：24
> 
> 时间：2014-02-04T18:03:50.327

所有答案都假设可以通过全局范围（窗口）访问这些函数。但是，OP 没有做出这个假设。

如果函数位于本地范围内（也称为闭包）并且没有被其他本地对象引用，那么运气不好：您必须使用`eval()`AFAIK，请参阅 [在 javascript 中动态调用本地函数](https://stackoverflow.com/questions/9464921/dynamically-call-local-function-in-javascript)

* * *

## 回答 #9

> 赞同：20
> 
> 时间：2019-02-25T22:57:19.770

根据您所在的位置，您还可以使用：

```
this["funcname"]();
self["funcname"]();
window["funcname"]();
top["funcname"]();
globalThis["funcname"](); 
```

或者，在 nodejs 中

```
global["funcname"]() 
```

* * *

## 回答 #10

> 赞同：14
> 
> 时间：2011-11-11T18:22:20.800

您只需要将字符串转换为指针 by `window[<method name>]`。例子：

```
var function_name = "string";
function_name = window[function_name]; 
```

现在你可以像指针一样使用它了。

* * *

## 回答 #11

> 赞同：13
> 
> 时间：2017-02-11T01:08:39.203

这是我对 Jason Bunting / Alex Nazarov 出色答案的贡献，其中包括 Crashalot 要求的错误检查。

鉴于这个（人为的）序言：

```
a = function( args ) {
    console.log( 'global func passed:' );
    for( var i = 0; i < arguments.length; i++ ) {
        console.log( '-> ' + arguments[ i ] );
    }
};
ns = {};
ns.a = function( args ) {
    console.log( 'namespace func passed:' );
    for( var i = 0; i < arguments.length; i++ ) {
        console.log( '-> ' + arguments[ i ] ); 
    }
};
name = 'nsa';
n_s_a = [ 'Snowden' ];
noSuchAgency = function(){}; 
```

然后是以下功能：

```
function executeFunctionByName( functionName, context /*, args */ ) {
    var args, namespaces, func;

    if( typeof functionName === 'undefined' ) { throw 'function name not specified'; }

    if( typeof eval( functionName ) !== 'function' ) { throw functionName + ' is not a function'; }

    if( typeof context !== 'undefined' ) { 
        if( typeof context === 'object' && context instanceof Array === false ) { 
            if( typeof context[ functionName ] !== 'function' ) {
                throw context + '.' + functionName + ' is not a function';
            }
            args = Array.prototype.slice.call( arguments, 2 );

        } else {
            args = Array.prototype.slice.call( arguments, 1 );
            context = window;
        }

    } else {
        context = window;
    }

    namespaces = functionName.split( "." );
    func = namespaces.pop();

    for( var i = 0; i < namespaces.length; i++ ) {
        context = context[ namespaces[ i ] ];
    }

    return context[ func ].apply( context, args );
} 
```

将允许您按存储在命名空间或全局字符串中的名称调用 javascript 函数，带或不带参数（包括 Array 对象），提供遇到的任何错误的反馈（希望能捕获它们）。

示例输出显示了它是如何工作的：

```
// calling a global function without parms
executeFunctionByName( 'a' );
  /* OUTPUT:
  global func passed:
  */

// calling a global function passing a number (with implicit window context)
executeFunctionByName( 'a', 123 );
  /* OUTPUT:
  global func passed:
  -> 123
  */

// calling a namespaced function without parms
executeFunctionByName( 'ns.a' );
  /* OUTPUT:
  namespace func passed:
  */

// calling a namespaced function passing a string literal
executeFunctionByName( 'ns.a', 'No Such Agency!' );
  /* OUTPUT:
  namespace func passed:
  -> No Such Agency!
  */

// calling a namespaced function, with explicit context as separate arg, passing a string literal and array 
executeFunctionByName( 'a', ns, 'No Such Agency!', [ 007, 'is the man' ] );
  /* OUTPUT:
  namespace func passed:
  -> No Such Agency!
  -> 7,is the man
  */

// calling a global function passing a string variable (with implicit window context)
executeFunctionByName( 'a', name );
  /* OUTPUT:
  global func passed:
  -> nsa
  */

// calling a non-existing function via string literal
executeFunctionByName( 'n_s_a' );
  /* OUTPUT:
  Uncaught n_s_a is not a function
  */

// calling a non-existing function by string variable
executeFunctionByName( n_s_a );
  /* OUTPUT:
  Uncaught Snowden is not a function
  */

// calling an existing function with the wrong namespace reference
executeFunctionByName( 'a', {} );
  /* OUTPUT:
  Uncaught [object Object].a is not a function
  */

// calling no function
executeFunctionByName();
  /* OUTPUT:
  Uncaught function name not specified
  */

// calling by empty string
executeFunctionByName( '' );
  /* OUTPUT:
  Uncaught  is not a function
  */

// calling an existing global function with a namespace reference
executeFunctionByName( 'noSuchAgency', ns );
  /* OUTPUT:
  Uncaught [object Object].noSuchAgency is not a function
  */ 
```

* * *

## 回答 #12

> 赞同：11
> 
> 时间：2013-01-25T13:38:18.960

如果你想调用一个对象的函数而不是一个全局函数`window["functionName"]`。你可以这样做；

```
var myObject=new Object();
myObject["functionName"](arguments); 
```

例子：

```
var now=new Date();
now["getFullYear"]() 
```

* * *

## 回答 #13

> 赞同：10
> 
> 时间：2014-08-20T14:21:48.100

**当心！！！**

应该尽量避免在 JavaScript 中通过字符串调用函数，原因有二：

原因 1：某些代码混淆器会破坏您的代码，因为它们会更改函数名称，使字符串无效。

原因 2：维护使用这种方法的代码要困难得多，因为要找到字符串调用的方法的用法要困难得多。

* * *

## 回答 #14

> 赞同：9
> 
> 时间：2018-10-17T14:56:35.090

这是我的 Es6 方法，它使您可以通过函数名称或函数名称来调用函数，还可以将不同数量的参数传递给不同类型的函数：

```
function fnCall(fn, ...args)
{
  let func = (typeof fn =="string")?window[fn]:fn;
  if (typeof func == "function") func(...args);
  else throw new Error(`${fn} is Not a function!`);
}

function example1(arg1){console.log(arg1)}
function example2(arg1, arg2){console.log(arg1 + "  and   " + arg2)}
function example3(){console.log("No arguments!")}

fnCall("example1", "test_1");
fnCall("example2", "test_2", "test3");
fnCall(example3);
fnCall("example4"); // should raise an error in console
```

* * *

## 回答 #15

> 赞同：7
> 
> 时间：2014-10-17T20:10:33.347

惊讶地看到没有提到 setTimeout。

要运行不带参数的函数：

```
var functionWithoutArguments = function(){
    console.log("Executing functionWithoutArguments");
}
setTimeout("functionWithoutArguments()", 0); 
```

使用参数运行函数：

```
var functionWithArguments = function(arg1, arg2) {
    console.log("Executing functionWithArguments", arg1, arg2);
}
setTimeout("functionWithArguments(10, 20)"); 
```

要运行深度命名空间函数：

```
var _very = {
    _deeply: {
        _defined: {
            _function: function(num1, num2) {
                console.log("Execution _very _deeply _defined _function : ", num1, num2);
            }
        }
    }
}
setTimeout("_very._deeply._defined._function(40,50)", 0); 
```

* * *

## 回答 #16

> 赞同：7
> 
> 时间：2020-05-01T11:30:42.033

我认为您不需要复杂的中间函数或 eval 或依赖于诸如窗口之类的全局变量：

```
function fun1(arg) {
  console.log(arg);
}

function fun2(arg) {
  console.log(arg);
}

const operations = {
  fun1,
  fun2
};

operations["fun1"]("Hello World");
operations.fun2("Hello World");

// You can use intermediate variables, if you like
let temp = "fun1";
operations[temp]("Hello World"); 
```

它也适用于导入的函数：

```
// mode.js
export function fun1(arg) {
  console.log(arg);
}

export function fun2(arg) {
  console.log(arg);
} 
```

```
// index.js
import { fun1, fun2 } from "./mod";

const operations = {
  fun1,
  fun2
};

operations["fun1"]("Hello World");
operations["fun2"]("Hello World"); 
```

由于它使用属性访问，因此它可以在最小化或混淆中幸存下来，这与您在此处找到的一些答案相反。

* * *

## 回答 #17

> 赞同：3
> 
> 时间：2015-05-21T23:08:21.707

因此，就像其他人所说，绝对最好的选择是：

```
window['myfunction'](arguments) 
```

就像[Jason Bunting 所说](https://stackoverflow.com/a/359910/1895428)的那样，如果你的函数名称包含一个对象，它将不起作用：

```
window['myobject.myfunction'](arguments); // won't work
window['myobject']['myfunction'](arguments); // will work 
```

所以这是我的函数版本，它将按名称执行所有函数（包括或不包括对象）：

```
my = {
    code : {
        is : {
            nice : function(a, b){ alert(a + "," + b); }
        }
    }
};

guy = function(){ alert('awesome'); }

function executeFunctionByName(str, args)
{
    var arr = str.split('.');
    var fn = window[ arr[0] ];

    for (var i = 1; i < arr.length; i++)
    { fn = fn[ arr[i] ]; }
    fn.apply(window, args);
}

executeFunctionByName('my.code.is.nice', ['arg1', 'arg2']);
executeFunctionByName('guy');
```

* * *

## 回答 #18

> 赞同：3
> 
> 时间：2017-06-27T13:52:24.540

```
 let t0 = () => { alert('red0') }
  var t1 = () =>{ alert('red1') }
  var t2 = () =>{ alert('red2') }
  var t3 = () =>{ alert('red3') }
  var t4 = () =>{ alert('red4') }
  var t5 = () =>{ alert('red5') }
  var t6 = () =>{ alert('red6') }

  function getSelection(type) {
    var evalSelection = {
      'title0': t0,
      'title1': t1,
      'title2': t2,
      'title3': t3,
      'title4': t4,
      'title5': t5,
      'title6': t6,
      'default': function() {
        return 'Default';
      }
    };
    return (evalSelection[type] || evalSelection['default'])();
  }
  getSelection('title1'); 
```

*更OOP的解决方案...*

* * *

## 回答 #19

> 赞同：2
> 
> 时间：2012-12-28T05:43:30.280

关于 Jason 和 Alex 帖子的更多细节。我发现向上下文添加默认值很有帮助。只需放在`context = context == undefined? window:context;`函数的开头即可。您可以更改`window`为您喜欢的任何上下文，然后每次在默认上下文中调用它时都不需要传递相同的变量。

* * *

## 回答 #20

> 赞同：2
> 
> 时间：2014-06-29T16:45:14.340

要添加到 Jason Bunting 的答案，如果您使用的是 nodejs 或其他东西（这也适用于 dom js），您可以使用`this`代替`window`（并记住：eval 是**邪恶**的：

```
this['fun'+'ctionName'](); 
```

* * *

## 回答 #21

> 赞同：2
> 
> 时间：2015-04-29T14:46:55.190

我的代码中有一个非常相似的东西。我有一个服务器生成的字符串，其中包含一个函数名称，我需要将其作为第 3 方库的回调传递。所以我有一个代码，它接受字符串并返回一个指向函数的“指针”，如果没有找到，则返回 null。

[我的解决方案与“ Jason Bunting 的非常有用的功能](https://stackoverflow.com/questions/359788/javascript-function-name-as-a-string/359910#359910)” [*](https://stackoverflow.com/questions/359788/how-to-execute-a-javascript-function-when-i-have-its-name-as-a-string/4351575#4351575)非常相似，尽管它不会自动执行，并且上下文始终在窗口中。但这可以很容易地修改。

希望这对某人有所帮助。

```
/**
 * Converts a string containing a function or object method name to a function pointer.
 * @param  string   func
 * @return function
 */
function getFuncFromString(func) {
    // if already a function, return
    if (typeof func === 'function') return func;

    // if string, try to find function or method of object (of "obj.func" format)
    if (typeof func === 'string') {
        if (!func.length) return null;
        var target = window;
        var func = func.split('.');
        while (func.length) {
            var ns = func.shift();
            if (typeof target[ns] === 'undefined') return null;
            target = target[ns];
        }
        if (typeof target === 'function') return target;
    }

    // return null if could not parse
    return null;
} 
```

* * *

## 回答 #22

> 赞同：2
> 
> 时间：2021-03-21T08:16:51.650

这是我最终为我的一个项目实施的一个强大且可重用的解决方案。

一个 FunctionExecutor 构造函数

**用法：**

```
let executor = new FunctionExecutor();
executor.addFunction(two)
executor.addFunction(three)

executor.execute("one");
executor.execute("three"); 
```

显然，在项目中，所有需要按名称调用的函数的添加都是通过循环完成的。

**函数执行器：**

```
function FunctionExecutor() {
  this.functions = {};

  this.addFunction = function (fn) {
    let fnName = fn.name;
    this.functions[fnName] = fn;
  }

  this.execute = function execute(fnName, ...args) {
    if (fnName in this.functions && typeof this.functions[fnName] === "function") {
      return this.functions[fnName](...args);
    }
    else {
      console.log("could not find " + fnName + " function");
    }
  }

  this.logFunctions = function () {
    console.log(this.functions);
  }
} 
```

**示例用法：**

```
function two() {
  console.log("two"); 
}

function three() {
  console.log("three");
}

let executor = new FunctionExecutor();
executor.addFunction(two)
executor.addFunction(three)

executor.execute("one");
executor.execute("three"); 
```

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2012-11-23T00:38:55.090

还有一些非常有用的方法。

[http://devlicio.us/blogs/sergio_pereira/archive/2009/02/09/javascript-5-ways-to-call-a-function.aspx](http://devlicio.us/blogs/sergio_pereira/archive/2009/02/09/javascript-5-ways-to-call-a-function.aspx)

```
var arrayMaker = {  
    someProperty: 'some value here',  
    make: function (arg1, arg2) {  
        return [ this, arg1, arg2 ];  
    },
    execute: function_name
}; 
```

* * *

## 回答 #24

> 赞同：1
> 
> 时间：2015-10-29T12:45:49.927

我忍不住提到另一个技巧，**如果您有未知数量的参数也作为**包含函数名称的字符串的一部分传递，这会有所帮助。例如：

`var annoyingstring = 'call_my_func(123, true, "blah")';`

如果您的 Javascript 在 HTML 页面上运行，您所需要的只是一个不可见的链接；您可以将字符串传递给`onclick`属性，然后调用`click`方法。

`<a href="#" id="link_secret"><!-- invisible --></a>`

```
$('#link_secret').attr('onclick', annoyingstring);
$('#link_secret').click(); 
```

或者`<a>`在运行时创建元素。

* * *

## 回答 #25

> 赞同：1
> 
> 时间：2016-04-20T07:46:47.727

最简单的方法是像拥有元素一样访问它

```
window.ClientSideValidations.forms.location_form 
```

和

```
window.ClientSideValidations.forms['location_form'] 
```

* * *

## 回答 #26

> 赞同：1
> 
> 时间：2019-12-08T05:45:31.997

人们一直说这`eval`是危险和邪恶的，因为它可以运行任意代码。但是，如果您将 eval 与**白名单**方法一起使用，假设您知道所有可能需要提前运行的函数名称，那么 eval 不再是安全问题，因为输入**不再是任意**的。白名单是一种良好且常见的安全模式。这是一个例子：

```
function runDynamicFn(fnName, ...args) {
  // can also be fed from a tightly controlled config
  const allowedFnNames = ['fn1', 'ns1.ns2.fn3', 'ns4.fn4'];

  return allowedFnNames.includes(fnName) ? eval(fnName)(...args) : undefined; 
}

// test function:
function fn1(a) { 
  console.log('fn1 called with', a)
}

runDynamicFn('alert("got you!")')
runDynamicFn('fn1', 'foo')
```

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2014-04-22T13:59:17.483

这对我有用：

```
var command = "Add";
var tempFunction = new Function("Arg1","Arg2", "window." + command + "(Arg1,Arg2)");
tempFunction(x,y); 
```

我希望这行得通。

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2016-06-03T14:36:58.833

看基本：

```
var namefunction = 'jspure'; // String

function jspure(msg1 = '', msg2 = '') { 
  console.log(msg1+(msg2!=''?'/'+msg2:''));
} // multiple argument

// Results ur test
window[namefunction]('hello','hello again'); // something...
eval[namefunction] = 'hello'; // use string or something, but its eval just one argument and not exist multiple 
```

存在其他类型的函数是**类**和看看例子*nils petersohn*

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2016-10-11T13:25:36.690

感谢您提供非常有帮助的答案。我在我的项目中使用[Jason Bunting 的功能](https://stackoverflow.com/questions/359788/how-to-execute-a-javascript-function-when-i-have-its-name-as-a-string/359910#359910)。

我将它扩展为使用可选超时，因为设置超时的正常方法不起作用。请参阅[abhishekisnot 的问题](https://stackoverflow.com/questions/359788/how-to-execute-a-javascript-function-when-i-have-its-name-as-a-string/26432746#26432746)

```
function executeFunctionByName(functionName, context, timeout /*, args */ ) {
	var args = Array.prototype.slice.call(arguments, 3);
	var namespaces = functionName.split(".");
	var func = namespaces.pop();
	for (var i = 0; i < namespaces.length; i++) {
		context = context[namespaces[i]];
	}
	var timeoutID = setTimeout(
		function(){ context[func].apply(context, args)},
		timeout
	);
    return timeoutID;
}

var _very = {
    _deeply: {
        _defined: {
            _function: function(num1, num2) {
                console.log("Execution _very _deeply _defined _function : ", num1, num2);
            }
        }
    }
}

console.log('now wait')
executeFunctionByName("_very._deeply._defined._function", window, 2000, 40, 50 );
```

* * *

## 回答 #30

> 赞同：0
> 
> 时间：2016-11-15T10:37:41.473

这里有几个`executeByName`函数可以正常工作，除非名称包含**方括号**- 我遇到的问题 - 因为我有动态生成的名称。所以上面的函数会在名字上失败，比如

`app.widget['872LfCHc']['toggleFolders']`

作为补救措施，我也考虑了这一点，也许有人会发现它很有用：

从 CoffeeScript 生成：

```
var executeByName = function(name, context) {
  var args, func, i, j, k, len, len1, n, normalizedName, ns;
  if (context == null) {
    context = window;
  }
  args = Array.prototype.slice.call(arguments, 2);
  normalizedName = name.replace(/[\]'"]/g, '').replace(/\[/g, '.');
  ns = normalizedName.split(".");
  func = context;
  for (i = j = 0, len = ns.length; j < len; i = ++j) {
    n = ns[i];
    func = func[n];
  }
  ns.pop();
  for (i = k = 0, len1 = ns.length; k < len1; i = ++k) {
    n = ns[i];
    context = context[n];
  }
  if (typeof func !== 'function') {
    throw new TypeError('Cannot execute function ' + name);
  }
  return func.apply(context, args);
} 
```

为了更好的可读性，还要检查 CoffeeScript 版本：

```
executeByName = (name, context = window) ->
    args = Array.prototype.slice.call(arguments, 2)
    normalizedName = name.replace(/[\]'"]/g, '').replace(/\[/g, '.')
    ns = normalizedName.split "."
    func = context
    for n, i in ns
        func = func[n]

    ns.pop()
    for n, i in ns
        context = context[n];
    if typeof func != 'function'
        throw new TypeError 'Cannot execute function ' + name
    func.apply(context, args) 
```

* * *

## 回答 #31

> 赞同：0
> 
> 时间：2017-01-16T13:27:12.967

您可以在其中一个中调用 javascript 函数`eval("functionname as string")`。如下所示：（eval 是纯 javascript 函数）

```
function testfunc(){
    return "hello world";
}

$( document ).ready(function() {

     $("div").html(eval("testfunc"));
}); 
```

工作示例：[https ://jsfiddle.net/suatatan/24ms0fna/4/](https://jsfiddle.net/suatatan/24ms0fna/4/)

* * *

## 回答 #32

> 赞同：0
> 
> 时间：2017-09-07T07:49:04.037

您所要做的就是使用上下文或定义您所在函数所在的新上下文。你不限于`window["f"]();`

这是我如何对某些 REST 服务使用一些动态调用的示例。

```
/* 
Author: Hugo Reyes
@ www.teamsrunner.com

*/

    (function ( W, D) { // enclose it as self invoking function to avoid name collisions.

    // to call function1 as string
    // initialize your FunctionHUB as your namespace - context
    // you can use W["functionX"](), if you want to call a function at the window scope.
    var container = new FunctionHUB();

    // call a function1 by name with one parameter.

    container["function1"](' Hugo ');

    // call a function2 by name.
    container["function2"](' Hugo Leon');

    // OO style class
    function FunctionHUB() {

        this.function1 = function (name) {

            console.log('Hi ' + name + ' inside function 1')
        }

        this.function2 = function (name) {

            console.log('Hi' + name + ' inside function 2 ')
        }
    }

})(window, document); // in case you need window context inside your namespace. 
```

如果你想从一个字符串生成整个函数，那是一个不同的答案。另请注意，您不仅限于单个名称空间，如果您的名称空间存在，因为您 的名称空间`my.name.space.for.functions.etc.etc.etc`的最后一个分支包含以下功能`my.name.space.for.functions.etc.etc["function"]();`

希望能帮助到你。H。

* * *

## 回答 #33

> 赞同：0
> 
> 时间：2018-06-02T15:58:43.917

既然`eval()`是邪恶的，而且`new Function()`不是实现这一点的最有效方法，这里有一个快速的 JS 函数，它从字符串中的函数名返回函数。

*   适用于命名空间的功能
*   在空/未定义字符串的情况下回退到空函数
*   如果未找到函数，则回退到空函数

```
    函数转换字符串到函数（函数名）{

        var nullFunc = function(){}; // 后备空函数
        var ret = 窗口；// 顶级命名空间

        // 如果为空/未定义字符串，则返回 Null-Function
        如果（函数名==null）返回nullFunc；

        // 将字符串转换为函数名
        functionName.split('.').forEach(function(key){ ret = ret[key]; });

        // 如果函数名不可用，则返回 Null-Function 否则返回实际函数
        返回 (ret==null ? nullFunc : ret);

    }

```

**用法：**

```
    convertStringtoFunction("level1.midLevel.myFunction")(arg1, arg2, ...);

```

* * *

## 回答 #34

> 赞同：-1
> 
> 时间：2016-03-10T12:52:39.533

如果不使用`eval('function()')`，您可以使用`new Function(strName)`. 以下代码使用 FF、Chrome、IE 进行了测试。

```
<html>
<body>
<button onclick="test()">Try it</button>
</body>
</html>
<script type="text/javascript">

  function test() {
    try {    
        var fnName = "myFunction()";
        var fn = new Function(fnName);
        fn();
      } catch (err) {
        console.log("error:"+err.message);
      }
  }

  function myFunction() {
    console.log('Executing myFunction()');
  }

</script> 
```

# agile - 敏捷开发方法的陷阱是什么？

> ID：359790
> 
> 赞同：4
> 
> 时间：2008-12-11T15:47:21.803
> 
> 标签：agile

敏捷开发方法的陷阱是什么？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-11T15:54:43.643

常见的[批评](http://en.wikipedia.org/wiki/Agile_software_development)包括：

*   缺乏结构和必要的文件
*   仅与高级开发人员合作
*   包含不足的软件设计
*   需要太多的文化变革才能采用
*   可能导致更困难的合同谈判
*   效率可能非常低——如果某个代码区域的需求通过各种迭代发生变化，则可能需要多次执行相同的编程。然而，如果要遵循一个计划，那么一个单一的代码区域应该被编写一次。
*   不可能对提供报价所需的工作量做出切合实际的估计，因为在项目开始时，没有人知道整个范围/要求
*   由于缺乏详细的需求文档，可能会增加范围蔓延的风险
*   敏捷是功能驱动的，非功能性的质量属性很难作为用户故事

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-12-11T15:57:00.007

以敏捷为借口，在规划、需求定义和文档编制上花费的时间和精力不足。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-12-11T16:25:42.490

来自[@George Stocker 的引用列表](https://stackoverflow.com/a/359817/16587)，以及我的反驳......

*   缺乏结构和必要的文件

    1.  许多敏捷方法都高度规范了基本实践并具有结构，尽管其中大部分是非正式的。
    2.  定义*必要*的。计划驱动方法所需的许多文档未使用和/或已过时。敏捷性专注于生产那些实际需要的可交付成果。
*   仅与高级开发人员合作

    1.  最适合可以独立（或成对）工作的开发人员。
    2.  高级/初级开发人员的组合工作得很好。
*   包含不足的软件设计

    1.  具有积极重构的增量设计可以带来更好的设计，因为大部分设计都是在更好地理解应用程序的情况下完成的。
    2.  一个有效的批评可能是敏捷实施者可能因为害怕不“敏捷”而害怕预先做任何设计——没有一个方法学家会建议完全跳过前端设计。
*   需要太多的文化变革才能采用

    1.  可以是有效的，但在我看来这是值得的
*   可能导致更困难的合同谈判

    1.  确实。随着更多敏捷成功的实现，这种情况应该会改变。
*   效率可能非常低——如果某个代码区域的需求通过各种迭代发生变化，则可能需要多次执行相同的编程。然而，如果要遵循一个计划，那么一个单一的代码区域应该被编写一次。

    1.  只有以牺牲实际期望行为为代价而严格遵守计划，否则您会遇到同样的问题。
    2.  如果确实发生了变化，敏捷方法比计划驱动的方法更好地处理这个问题。
*   不可能对提供报价所需的工作量做出切合实际的估计，因为在项目开始时，没有人知道整个范围/要求

    1.  大多数敏捷方法都为您提供了了解速度的好工具。
    2.  所有方法都很难规划。这不是敏捷方法所独有的。
    3.  敏捷方法，通过将软件放在客户手中，比严格的预先计划更快地发现真正的需求，因为客户在看到之前不知道他真正想要什么。
*   由于缺乏详细的需求文档，可能会增加范围蔓延的风险

    1.  敏捷对此采取了完全不同的观点。它侧重于范围/时间的权衡，而不是限制范围以保持固定时间。
    2.  客户可以选择敏捷中的范围/时间权衡，因此他们可以完全控制范围。
*   敏捷是功能驱动的，非功能性的质量属性很难作为用户故事

    1.  您可以使用任何您想要跟踪质量属性的方法，如果您愿意，包括来自计划驱动实践的传统方法。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-12-11T16:05:33.467

我认为第一个陷阱是认为“敏捷方法”意味着您可以做或不做任何您想做的事情。我会大胆猜测大多数使用敏捷的人，真正使用“临时”而不是实施那些导致敏捷的实践。敏捷性需要工作和纪律，也许比计划驱动的开发更需要。

有人说敏捷效率较低，因为可能会发生变化并且您必须重新做一些事情，所以我不禁发笑。现实情况是发生了变化，无论采用何种方法，您都必须重新处理（或最终导致客户不满意）。敏捷方法只是接受这种情况会发生，并尝试使用允许它以最少破坏性的方式发生的方法。为了提高效率，您仍然需要对允许的更改保持自律，使用敏捷只会让您有更好的机会说“是”并且仍然按时完成。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-12-11T17:48:00.063

这里的很多答案不是*陷阱*，而是*批评*。在我看来，“陷阱”是需要注意的潜在问题，而不是避免敏捷的理由。

以下是我的一些极限编程：

*   在结对编程中，个人卫生、性舒适和亲密的社交技巧突然变得更加重要

*   很容易对重构感到兴奋，以至于您想重构无关紧要的代码，将高级模式应用于琐碎的例程，并在截止日期之前进行重构。

*   这些实践在重要方面相互支持。如果你放弃了一个，你就会在另一个中遇到麻烦。例如，如果您停止执行 TDD，您的重构将变得更加困难和风险更大。

*   仅仅因为你认为你正在遵循这些做法并不意味着你做对了。您确实需要有才华的人，了解 XP 的工作原理，并正确地进行操作。

*   你可能仍然失败。仅仅因为你都敏捷并不能保证你会完成你的项目，或者它会是你的客户想要的好软件。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-12-11T16:29:32.123

认为敏捷是做“坐飞机”开发的借口。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-12-11T15:56:30.723

这是一个非常哲学的问题。这里有一个陷阱：认为敏捷开发可以原谅每两周 180 度转变的管理层。另一个陷阱是，如果做错了，团队成员之间的工作量就不能很好地平衡。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-12-11T16:00:35.427

[认为“敏捷”意味着“用更少的人完成工作”的 PHB](http://runningagile.files.wordpress.com/2008/05/dilbert_need_more_programers.gif)；）

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-12-11T16:07:07.520

我的感觉是，敏捷方法的最大风险在于其“灵活”的声誉。也就是说，您冒着开发人员开始填写他们自己的敏捷方法定义的风险。如果发生这种情况，您最终将根本没有方法论。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-12-11T16:33:09.590

最大的陷阱是人们在看实践时会错过一件事：

*   检查和调整

如果您作为一个团队没有不断地评估您的实践并找出哪些有效，哪些无效，哪些需要调整，哪些需要调整，那么您很可能会失败。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-12-11T17:11:23.490

*   只有至少有一个 sprint 的要求，敏捷才能成功。
*   大多数客户往往没有适当的要求，或者他们在 sprint 中间经常更改，这导致重新计划和重新开始 sprint。
*   当应用程序处于维护模式时，敏捷可能会更成功，其中应用程序已经投入生产，而开发人员只是在每个 sprint 中为应用程序添加更多功能。
*   管理层有一个优势，他们可以在工作中潜入 devs/qa 的日常生活（在每天的 sprint 会议中）。
*   如果没有适当的计划，它可能会很快通过budjet 吃掉（大多数情况下，这是由于需要采用的更改）。
*   由于文档较少/没有文档，因此您不能让一个人对错误传达或误解的功能负责。
*   这种缺乏责任感可能会导致更多的问题，即一个人故意不履行他们在团队中的职责。
*   开发人员可能会对不断变化的需求和所涉及的返工感到沮丧。（想象在 5 个 sprint 中调整相同的功能，可以在一个 sprint 中通过适当分析的需求来完成）。
*   业务/客户代表往往不承担提供适当要求的责任。

我已经使用敏捷流程工作了 3 年。在此之前，我曾在遵循瀑布方法的 CMM 5 级公司工作。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-12-11T16:03:51.550

我不同意所有常见的批评，除了“可能导致更困难的合同谈判”。如果您的客户不想与您的开发流程有任何关系，则很难解决这个问题。

仅当您的开发流程以其他方式中断时，其他项目才适用，例如您不进行单元测试或持续集成或版本控制。

主要的缺陷是试图在没有阅读[敏捷宣言](http://agilemanifesto.org/)或对该主题的行为进行任何研究的情况下尝试采用“某种敏捷”方法。

# algorithm - 在 Web 上创建动态地图

> ID：359793
> 
> 赞同：0
> 
> 时间：2008-12-11T15:48:05.407
> 
> 标签：algorithm, language-agnostic, graphics, mapping, platform-agnostic

我的公司使用经销商、区域经理和区域经理的销售模式，每个经理都有不同级别的区域范围（IE 基于邮政编码、州或地区进行管理。）

[我想创建一个类似于这张美国州地图](http://www.onlineatlas.us/map/united-states-map.gif)的精简地图，它允许我们的用户操纵谁来管理什么。

有哪些好的资源可以开始这条道路？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-11T15:59:27.770

我想说您可以将自己建立在[OpenStreetMap](http://openstreetmap.org/)上，该数据库在知识共享许可下。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-11T16:02:23.940

[KML](http://code.google.com/apis/kml/documentation/mapsSupport.html)和[Tiger](http://www.census.gov/geo/www/tiger/)（美国）还是[Maps 和 Geo](http://www.statcan.gc.ca/mgeo/geography-geographie-eng.htm)（Can）？或者，使用较少交互的东西，您可能仍然可以使用拓扑集成地理编码和参考系统。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-29T18:57:22.373

用于存储数据的[PostGIS](http://postgis.refractions.net/) 、用于生成地图切片的[MapServer和用于界面的](http://mapserver.osgeo.org/)[OpenLayers](http://openlayers.org/)的组合应该可以为您提供一些帮助。包括一些 PHP 库，你就在那里！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-23T17:26:16.927

我发现的一个有用的工具是下面的[GPS Visualization](http://www.gpsvisualizer.com/map_input?form=data)。

# java - 如何使用来自 64 位进程的 32 位 COM 对象？

> ID：359807
> 
> 赞同：1
> 
> 时间：2008-12-11T15:50:45.913
> 
> 标签：java, com, jacob

我在 64 位机器上使用 Jacob（JAVA COM 桥）并希望从 32 位 DLL 加载 COM 对象。我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-11T15:56:30.317

您需要在 32 位进程中托管 32 位 COM 对象。因此，要么您的整个应用程序必须运行 32 位，要么您需要将 COM 对象放在 COM+ 之类的东西中并使用跨进程调用。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-30T10:42:26.293

我解决了如下问题：创建了一个小型 32 位进程外 COM 服务器 (.exe)，用作工厂 COM 对象来创建所需的 32 位对象。所以现在我的应用程序运行 64 位并使用 32 位 COM 对象。

My64bitApp<-->32BitOutOfProcFactory<-->32bitCOMServerDLL

# grails - 在 gsp(grails) 中显示图像

> ID：359816
> 
> 赞同：7
> 
> 时间：2008-12-11T15:54:31.103
> 
> 标签：grails, frameworks

我对 grails 很陌生。我正在做一个用于图像上传和显示的示例项目。现在我的项目将图像上传并存储到图像目录中。现在我想显示存储在“图像”目录中的所有图像。我不知道如何编写显示所有图像的 gsp 代码。

为了显示图像，我在 list.gsp 页面中编写了以下代码。

我的 gsp 代码是：

```
<g:each in="${imageList}" var="image">
<img src="${createLinkTo(dir: 'images', file: '1.jpg')}" alt="Grails"/>
</g:each> 
```

imageList 具有图像目录中图像的文件名。

在第二行中，我想放置文件名而不是“1.jpg”。

谁能告诉我如何显示图像。

谢谢

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-14T02:18:28.880

如果您的 imageList 有图像对象列表，请尝试以下操作

**${createLinkTo(dir: 'images', file: image.filename)}。**

如果您的 imageList 像这样['1.jpg','2.jpg','3.jpg'] 尝试以下操作

```
**${createLinkTo(dir: 'images', file: image)}** 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-11T16:01:49.730

根据您的 imageList 中的内容，您可以执行以下操作：

```
<g:each in="${imageList}" var="image">
<img src="${createLinkTo(dir: 'images', file: image.filename)}" alt="Grails"/>
</g:each> 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-11T16:03:09.760

假设你`imageList`是这样的`['1.jpg', '2.jpg', ...]`，你`createLinkTo`应该看起来像：

```
${createLinkTo(dir: 'images', file: image)} 
```

由于您已经将迭代器变量定义为“图像”。如果这不起作用，它可能有助于澄清您的`imageList`收藏内容中的内容。

# html - 使用 css 为表格中的最后一个 td 设置样式

> ID：359821
> 
> 赞同：71
> 
> 时间：2008-12-11T15:56:04.813
> 
> 标签：html, css, html-table

我想在表格中设置最后一个 TD 的样式，而不在特定 TD 上使用 CSS 类。

```
<table>
  <tbody>
    <tr>
      <td>One</td>
      <td>Two</td>
      <td>Three</td>
      <td>Four</td>
      <td>Five</td>
    </tr>
  </tbody>
</table>

table td 
{ 
  border: 1px solid black;
} 
```

我希望包含文本“五”的 TD 没有边框，但同样，我不想使用类。

* * *

## 回答 #1

> 赞同：91
> 
> 时间：2008-12-11T16:02:34.190

选择`:last-child`器应该这样做，但[任何版本的 IE 都不支持](http://www.quirksmode.org/css/contents.html)它。

恐怕你别无选择，只能使用类。

* * *

## 回答 #2

> 赞同：43
> 
> 时间：2012-05-09T15:04:34.870

您可以使用`:last-of-type`伪类：

```
tr > td:last-of-type {
    /* styling here */
} 
```

有关更多信息以及与不同浏览器的兼容性，请参阅[MDN 。](https://developer.mozilla.org/en/CSS/:last-of-type)
查看[W3C CSS 指南](http://www.w3.org/Style/CSS/)以获取更多信息。

* * *

## 回答 #3

> 赞同：39
> 
> 时间：2008-12-11T16:00:07.283

您可以使用相对规则：

```
table td + td + td + td + td {
  border: none;
} 
```

这仅适用于在运行时未确定列数的情况。

* * *

## 回答 #4

> 赞同：27
> 
> 时间：2008-12-11T16:05:52.623

你可以使用 last-child psuedo 类

```
table tr td:last-child {
    border: none;
} 
```

这将仅设置最后一个 td 的样式。它尚未完全支持，因此可能不合适

* * *

## 回答 #5

> 赞同：19
> 
> 时间：2016-01-28T19:09:19.343

尝试：

```
tr:last-child td:last-child{
    border:none;
    /*any other style*/
} 
```

这只会影响表中的最后一个 td 元素，假设是唯一的一个（否则，您只需要识别您的表）。虽然，非常通用，如果您向表格添加更多内容，它将适应最后一个 TD。所以如果是特殊情况

```
td:nth-child(5){
    border:none;
} 
```

应该足够了。

* * *

## 回答 #6

> 赞同：16
> 
> 时间：2008-12-11T16:06:57.550

如果您已经在使用 javascript，请查看 jQuery。它支持一个独立于浏览器的“last-child”选择器，你可以做这样的事情。

```
$("td:last-child").css({border:"none"}) 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-12-11T16:04:49.897

Javascript 是唯一可行的方式来做这个客户端（也就是说，CSS 不会帮助你）。在 jQuery 中：

```
$("table td:last").css("border", "none"); 
```

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-12-11T21:41:18.843

[您可以使用 HTML 4.0 ( link](http://www.w3.org/TR/html4/struct/tables.html#edef-COL) )中指定的 col 元素。它适用于每个浏览器。您可以给它一个 ID 或一个类或一个内联样式。唯一需要注意的是，它会影响所有行的整列。例子：

```
<table>
    <col />
    <col width="50" />
    <col id="anId" />
    <col class="whatever" />
    <col style="border:1px solid #000;" />
    <tbody>
        <tr>
            <td>One</td>
            <td>Two</td>
            <td>Three</td>
            <td>Four</td>
            <td>Five</td>
        </tr>
    </tbody>
</table> 
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2020-07-02T11:25:37.483

您可以使用 :last-of-type 来捕获表格的最后一列。

```
<style>
.table > tbody > tr > td:last-of-type {
    /* Give your style Here; */
}
</style> 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-09-03T15:03:18.140

在 jQuery 中，如果表是在执行以下操作之前静态或动态创建的：

```
$("table tr td:not(:last-child)").css({ "border-right":"1px solid #aaaaaa" }); 
```

只需为表格行中的每个单元格添加右边框，最后一个单元格除外。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-12-11T16:06:23.683

不是直接回答您的问题，但使用 <tfoot> 可能会帮助您实现所需的功能，当然您可以设置 tfoot 样式。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-12-11T16:16:00.683

对于 IE，如何使用 CSS 表达式：

```
<style type="text/css">
table td { 
  h: expression(this.style.border = (this == this.parentNode.lastChild ? 'none' : '1px solid #000' ) );
}
</style> 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2011-10-27T17:05:26.893

我也在寻找一种方法来做到这一点，并发现这可能对其他人有用：

```
#table td:last-of-type { border: none; } 
```

请注意，IE 也不支持它。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-08-29T10:37:35.010

这是将为所有节点添加边框并删除最后一个节点（TD）的边框的代码。

```
<style type="text/css">
    body {  
        font-family:arial;font-size: 8pt;  
    }  
    table td{
        border-right: #666 1px solid
    }  

    table td {  
        h: expression(this.style.border = (this == this.parentNode.lastChild ? 'none' : 'border-right:  0px solid' ) );  
    }  
</style>
<table>
    <tr>
        <td>Home</td>
        <td>sunil</td>
        <td>Kumar</td>
        <td>Rayadurg</td>
        <td>Five</td>
        <td>Six</td>
    </tr>
</table> 
```

享受 ...

我想要相同的而不是边框​​我想要它使用图像... :-)

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-09-26T06:58:34.683

还有一种不同的方法..这适用于非静态表...基本上使用`<th>`而不是`<td>`用于该列：

```
<style type="text/css">
 table td { border: 1px solid black; }
 table th { border: 0px; }
<style>
<table>
  <tbody>
    <tr>
      <td>One</td>
      <td>Two</td>
      <td>Three</td>
      <td>Four</td>
      <th>Five</th>
    </tr>
    <tr>
      <td>One</td>
      <td>Two</td>
      <td>Three</td>
      <td>Four</td>
      <th>Five</th>
    </tr>
  </tbody>
</table> 
```

# .net - VB.NET 中的 MDX 示例

> ID：359824
> 
> 赞同：0
> 
> 时间：2008-12-11T15:56:39.180
> 
> 标签：.net, mdx, dmx-ssas

我有一大块[MDX](http://en.wikipedia.org/wiki/MultiDimensional_eXpressions)想放入 ASP.NET 表单中。希望只是将结果绑定到gridview。有没有好的链接或片段？我正在使用 VB.NET，但如果没有可用的 Visual Basic 代码，我可以从 C# 移植。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-20T11:36:14.360

有一种方法可以使用 SQL 执行 MDX，我想这会给您一种将结果绑定到网格视图的偷偷摸摸的方法！

```
select top 100 * from openrowset(
    'MSOLAP',
    'Datasource=MyDBServerName;Initial catalog=MyCubeName',
    'SELECT {dimensions(0).members} on rows, 
    {time.defaultmember} on columns 
    from sales'
) 
```

当然有一个合适的方法（在经典的 ASP 中过去称为 ADOMD，它为您提供了一个可以循环的 Cellset 对象）。

许多人使用第三方 .NET 组件（例如 Dundas 的组件）来显示来自多维数据集数据的表格和图形。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2020-05-21T22:02:46.743

我知道这可能会“有点”晚，也许我误解了你的问题。但是，如果你想显示一个带有 MDX 查询结果的网格，你可以查看 codeproject 上的这个示例教程。我亲自尝试过，对我来说效果很好。将它与一些图表库结合起来，您可以进一步开发此原型。

[https://www.codeproject.com/Articles/28290/Microsoft-Analysis-Services-2005-Displaying-a-grid](https://www.codeproject.com/Articles/28290/Microsoft-Analysis-Services-2005-Displaying-a-grid)

它将基本上帮助您构建和理解如何使用 CellSets，以一种实用的、逐步的方法。结果将或多或少如下图所示，只是有点像 2020 :) 您可以使用一些个人 css 或为什么不使用 Bootstrap 轻松自定义它。

[![在此处输入图像描述](https://i.stack.imgur.com/YnaAJ.png)](https://i.stack.imgur.com/YnaAJ.png)

# c# - 忽略字符串比较中的重音字母

> ID：359827
> 
> 赞同：153
> 
> 时间：2008-12-11T15:57:05.030
> 
> 标签：c#, string, localization

我需要比较 C# 中的 2 个字符串，并将重音字母与非重音字母相同。例如：

```
string s1 = "hello";
string s2 = "héllo";

s1.Equals(s2, StringComparison.InvariantCultureIgnoreCase);
s1.Equals(s2, StringComparison.OrdinalIgnoreCase); 
```

这两个字符串必须相同（就我的应用程序而言），但是这两个语句的计算结果都是假的。C# 中有没有办法做到这一点？

* * *

## 回答 #1

> 赞同：267
> 
> 时间：2008-12-15T16:06:54.883

编辑 2012-01-20：天哪！解决方案要简单得多，并且几乎永远存在于框架中。[正如 knightpfhor 所指出的](https://stackoverflow.com/a/7720903/12379)：

```
string.Compare(s1, s2, CultureInfo.CurrentCulture, CompareOptions.IgnoreNonSpace); 
```

* * *

这是一个从字符串中去除变音符号的函数：

```
static string RemoveDiacritics(string text)
{
  string formD = text.Normalize(NormalizationForm.FormD);
  StringBuilder sb = new StringBuilder();

  foreach (char ch in formD)
  {
    UnicodeCategory uc = CharUnicodeInfo.GetUnicodeCategory(ch);
    if (uc != UnicodeCategory.NonSpacingMark)
    {
      sb.Append(ch);
    }
  }

  return sb.ToString().Normalize(NormalizationForm.FormC);
} 
```

[有关MichKap 博客](http://www.siao2.com/2007/05/14/2629747.aspx)( [RIP...](http://www.siao2.com/) )的更多详细信息。

原理是它将'é'变成2个连续的字符'e'，尖锐。然后它遍历字符并跳过变音符号。

“你好”变成了“他<acute>llo”，而后者又变成了“你好”。

```
Debug.Assert("hello"==RemoveDiacritics("héllo")); 
```

* * *

注意：这是相同功能的更紧凑的 .NET4+ 友好版本：

```
static string RemoveDiacritics(string text)
{
  return string.Concat( 
      text.Normalize(NormalizationForm.FormD)
      .Where(ch => CharUnicodeInfo.GetUnicodeCategory(ch)!=
                                    UnicodeCategory.NonSpacingMark)
    ).Normalize(NormalizationForm.FormC);
} 
```

* * *

## 回答 #2

> 赞同：148
> 
> 时间：2011-10-11T02:48:30.910

如果您不需要转换字符串并且只想检查是否相等，则可以使用

```
string s1 = "hello";
string s2 = "héllo";

if (String.Compare(s1, s2, CultureInfo.CurrentCulture, CompareOptions.IgnoreNonSpace) == 0)
{
    // both strings are equal
} 
```

或者如果您希望比较也不区分大小写

```
string s1 = "HEllO";
string s2 = "héLLo";

if (String.Compare(s1, s2, CultureInfo.CurrentCulture, CompareOptions.IgnoreNonSpace | CompareOptions.IgnoreCase) == 0)
{
    // both strings are equal
} 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2013-12-19T16:15:38.253

我不得不做类似的事情，但使用 StartsWith 方法。这是一个源自@Serge - appTranslator 的简单解决方案。

这是一个扩展方法：

```
 public static bool StartsWith(this string str, string value, CultureInfo culture, CompareOptions options)
    {
        if (str.Length >= value.Length)
            return string.Compare(str.Substring(0, value.Length), value, culture, options) == 0;
        else
            return false;            
    } 
```

对于一个班轮怪胎；）

```
 public static bool StartsWith(this string str, string value, CultureInfo culture, CompareOptions options)
    {
        return str.Length >= value.Length && string.Compare(str.Substring(0, value.Length), value, culture, options) == 0;
    } 
```

口音激励和大小写激励的startsWith可以这样调用

```
value.ToString().StartsWith(str, CultureInfo.InvariantCulture, CompareOptions.IgnoreNonSpace | CompareOptions.IgnoreCase) 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-12-11T16:57:06.297

以下方法`CompareIgnoreAccents(...)`适用于您的示例数据。这是我获得背景信息的文章：http: [//www.codeproject.com/KB/cs/EncodingAccents.aspx](http://www.codeproject.com/KB/cs/EncodingAccents.aspx)

```
private static bool CompareIgnoreAccents(string s1, string s2)
{
    return string.Compare(
        RemoveAccents(s1), RemoveAccents(s2), StringComparison.InvariantCultureIgnoreCase) == 0;
}

private static string RemoveAccents(string s)
{
    Encoding destEncoding = Encoding.GetEncoding("iso-8859-8");

    return destEncoding.GetString(
        Encoding.Convert(Encoding.UTF8, destEncoding, Encoding.UTF8.GetBytes(s)));
} 
```

我认为扩展方法会更好：

```
public static string RemoveAccents(this string s)
{
    Encoding destEncoding = Encoding.GetEncoding("iso-8859-8");

    return destEncoding.GetString(
        Encoding.Convert(Encoding.UTF8, destEncoding, Encoding.UTF8.GetBytes(s)));
} 
```

那么使用将是这样的：

```
if(string.Compare(s1.RemoveAccents(), s2.RemoveAccents(), true) == 0) {
   ... 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2014-09-01T13:05:46.770

删除重音的更简单方法：

```
 Dim source As String = "áéíóúç"
    Dim result As String

    Dim bytes As Byte() = Encoding.GetEncoding("Cyrillic").GetBytes(source)
    result = Encoding.ASCII.GetString(bytes) 
```

* * *

## 回答 #6

> 赞同：-3
> 
> 时间：2008-12-11T16:07:54.773

在 String.Compare 方法上尝试这个重载。

String.Compare 方法（字符串、字符串、布尔值、CultureInfo）

它根据包括cultureinfo 在内的比较操作生成一个int 值。页面中的示例比较了 en-US 和 en-CZ 中的“更改”。en-CZ 中的 CH 是单个“字母”。

链接中的示例

```
using System;
using System.Globalization;

class Sample {
    public static void Main() {
    String str1 = "change";
    String str2 = "dollar";
    String relation = null;

    relation = symbol( String.Compare(str1, str2, false, new CultureInfo("en-US")) );
    Console.WriteLine("For en-US: {0} {1} {2}", str1, relation, str2);

    relation = symbol( String.Compare(str1, str2, false, new CultureInfo("cs-CZ")) );
    Console.WriteLine("For cs-CZ: {0} {1} {2}", str1, relation, str2);
    }

    private static String symbol(int r) {
    String s = "=";
    if      (r < 0) s = "<";
    else if (r > 0) s = ">";
    return s;
    }
}
/*
This example produces the following results.
For en-US: change < dollar
For cs-CZ: change > dollar
*/ 
```

因此，对于重音语言，您需要获取文化，然后根据该文化测试字符串。

[http://msdn.microsoft.com/en-us/library/hyxc48dt.aspx](http://msdn.microsoft.com/en-us/library/hyxc48dt.aspx)

# .net - 调整组合框箭头的大小

> ID：359828
> 
> 赞同：2
> 
> 时间：2008-12-11T15:57:18.133
> 
> 标签：.net, winforms, combobox, touchscreen

我正在编写一个触摸屏 .net winforms 应用程序，需要一个带有更大下拉箭头的组合框。有什么方法可以调整箭头的大小，还是我正在考虑编写自定义控件？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-11T16:02:18.077

我认为按钮的大小是由系统字体大小和系统滚动条尺寸的组合决定的，这两者都由显示属性控制。

另一种选择是将组合框配置为在获得焦点时下拉。这样，触摸盒子上的任何地方都会使其下降。用户可能没有意识到这一点，并且“瞄准”了窄按钮，但我认为这并没有真正的危害。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-16T13:49:41.713

你能切换到WPF吗？在 wpf 中制作/派生自定义控件更容易。或者，您可以在您的 winform 中嵌入一个 WPF 控件。

在 Winforms 中滚动你自己的控件是可怕的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-02-10T19:53:03.233

看看 JCSelector，它是一个可以帮助您的开源 .NET 控件。访问 codeplex 网站 jcselector.codeplex.com

# php - __autoload 的最佳解决方案

> ID：359829
> 
> 赞同：10
> 
> 时间：2008-12-11T15:57:32.733
> 
> 标签：php, oop, autoload

随着我们的 PHP5 OO 应用程序的增长（在大小和流量方面），我们决定重新审视 __autoload() 策略。

我们总是通过它包含的类定义来命名文件，因此类 Customer 将包含在 Customer.php 中。我们过去常常列出文件可能存在的目录，直到找到正确的 .php 文件。

这是非常低效的，因为您可能会遍历许多您不需要的目录，并且对每个请求都这样做（因此，会进行大量的 stat() 调用）。

我想到的解决方案...

- 使用指定目录名称的命名约定（类似于 PEAR）。缺点：扩展性不是很大，导致类名很糟糕。

- 提出某种预先构建的位置数组（propel 为其 __autoload 执行此操作）。缺点：在部署新代码之前需要重新构建。

-“即时”构建数组并缓存它。这似乎是最好的解决方案，因为它允许任何您想要的类名和目录结构，并且在将新文件添加到列表中时非常灵活。问题是：将其存储在哪里以及删除/移动的文件如何。对于存储，我们选择了 APC，因为它没有磁盘 I/O 开销。关于文件删除，没关系，因为您可能不想在任何地方要求它们。至于移动……这还没有解决（我们忽略它，因为从历史上看它对我们来说并不经常发生）。

还有其他解决方案吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-11T16:50:53.530

我也玩了一段时间的自动加载，最后我实现了某种命名空间的自动加载器（是的，它也适用于 PHP5.2）。

策略很简单：首先我有一个单例类（加载器），它有一个模拟`import`. 此调用采用一个参数（要加载的完整类名）并在内部计算调用它的文件名（使用`debug_backtrace()`）。调用将此信息存储在关联数组中以供以后使用（使用调用文件作为键，以及每个键的导入类列表）。

典型代码如下所示：

```
<?php

    loader::import('foo::bar::SomeClass');
    loader::import('foo::bar::OtherClass');

    $sc = new SomeClass();

?> 
```

触发自动加载时，存储在数组中的完整类名将转换为真实的文件系统位置（双冒号替换为目录分隔符），并包含生成的文件名。

我知道这不是您所要求的，但它可以解决目录遍历问题，因为加载器直接知道文件的确切位置（具有附加功能，您可以将类组织在目录中，但没有明显的性能惩罚）。

我可以为您提供一些工作示例，但我太害羞了，不敢向公众展示我的蹩脚代码。希望上面的解释有用...

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-12T01:36:49.773

有 2 种通用方法效果很好。
首先是使用 PEAR 标准类命名结构，因此您只需将 '_' 替换为 / 即可找到该类。

[http://pear.php.net/manual/en/pear2cs.rules.php](http://pear.php.net/manual/en/pear2cs.rules.php)

或者您可以搜索 php 类的目录并将类名映射到文件。您可以将类映射保存到缓存以保存每次页面加载的搜索目录。
Symfony 框架使用这些方法。

通常最好遵循标准结构，因为它更简单，并且您不需要缓存任何内容，而且您遵循推荐的准则。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-10T03:28:12.880

我们使用与最后一个选项非常相似的东西，除了在要求之前检查 file_exists()。如果它不存在，请重建缓存并再次尝试。您可以获得每个文件的额外统计信息，但它可以透明地处理移动。对于我经常移动或重命名事物的快速开发非常方便。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-07-31T19:46:16.477

我过去使用过这个解决方案，我在博客上写过它以供参考，你们中的一些人可能会感兴趣......

[这里是](http://blog.dougalmatthews.com/2008/04/php-__autoload/)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-06-16T13:19:36.593

旧线程，但我认为无论如何我都可以在这里公开我的方法，也许它可以帮助某人。这是我`__autoload()`在我的网站入口点`/path/to/root/www/index.php`中定义的方式，例如：

```
function __autoload($call) {
    require('../php/'.implode('/', explode('___', $call)).'.php');
} 
```

所有 PHP 文件都以树的形式组织

```
/path/to/root/php
  /应用
    /网站
      服务器.php
  /模型
    用户.php
  /图书馆
    /HTTP
      客户端.php
    套接字.php

```

类名是：

```
应用程序___网站___服务器
型号___用户
库___HTTP___客户端
库___Socket

```

它很快，如果文件不存在，那么它会崩溃，你的错误日志会告诉你哪个文件丢失了。这可能看起来有点苛刻，但如果你尝试使用错误的类，那是你的问题。

注意：它适用于 PHP 5 < 5.3，所以对于 PHP 5.3，您可以使用命名空间，我使用 3 _ 作为分隔符的原因是它很容易替代 5.3 命名空间使用

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-11T17:49:22.323

如果您使用 APC，则应启用操作码缓存。我相信与您使用的任何类/文件策略相比，这对性能有更多好处，并且是一个更透明的解决方案。

第二个建议是使用最容易开发的任何类/文件策略，但是在您的生产站点上，您应该将最常用的类连接到一个文件中，并确保在每次请求期间都加载该文件（或使用 APC 缓存）。

做一些性能实验，增加你的类集。您可能会发现减少文件 I/O 的好处是如此显着，即使您在每次请求期间都不需要所有类，将所有类放在一个文件中也是一种净赢。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-11T16:14:42.137

CodeIgniter 对 load_class 函数做了类似的事情。如果我没记错的话，它是一个包含对象数组的静态函数。该函数的调用是：

```
 load_class($class_name, $instansiate); 
```

所以在你的情况下

```
 load_class('Customer', TRUE); 
```

这会将 Customer 类的实例加载到 objects 数组中。

该功能非常简单。抱歉，我不记得它所在的类的名称。但我确实记得有几个类被加载，例如我认为 Routing 类、Benchmark 类和 URI 类。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-09-14T23:55:27.080

我对每个“类型”的类（控制器、模型、库文件等）都有特定的命名约定，所以目前我做的事情类似于：

```
function __autoload($class){
    if($class matches pattern_1 and file_exists($class.pattern_1)){
        //include the file somehow
    } elseif($class matches pattern_2 and file_exists($class.pattern_2)){
        //include the file somehow
    } elseif(file_exists($class.pattern_3)){
        //include the file somehow
    } else {
       //throw an error because that class does not exist?
    }
} 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2014-12-14T18:08:50.937

```
function __autoload($class_name) {
   $class_name = strtolower($class_name);
   $path       = "../includes/{$class_name}.php";
   if (file_exists($path)) {
       require_once($path);
   } else {
       die("The file {$class_name}.php could not be found!");
   }
} 
```

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2008-12-11T16:27:22.377

您是否调查过使用[Zend_Loader](http://framework.zend.com/manual/en/zend.loader.html)（使用[registerAutoload()](http://framework.zend.com/manual/en/zend.loader.html#zend.loader.load.autoload)）而不仅仅是 native `__autoload()`？我使用过 Zend_Loader 并且对它很满意，但还没有从性能的角度来看待它。不过[这篇博文](http://php100.wordpress.com/2008/05/16/benchmarking-zend-framework-loader/)好像对它做了一些性能分析；您可以将这些结果与您在当前自动装载机上进行的内部性能测试进行比较，看看它是否能满足您的期望。

* * *

## 回答 #11

> 赞同：-3
> 
> 时间：2008-12-12T14:32:16.047

```
function __autoload( $class )
{
    $patterns = array( '%s.class.php', '%s.interface.php' );

    foreach( explode( ';', ini_get( 'include_path' ) ) as $dir )
    {
        foreach( $patterns as $pattern )
        {
            $file    = sprintf( $pattern, $class );
            $command = sprintf( 'find -L %s -name "%s" -print', $dir, $file );
            $output  = array();
            $result  = -1;

            exec( $command, $output, $result );

            if ( count( $output ) == 1 )
            {
                require_once( $output[ 0 ] );
                return;
            }
        }
    }

    if ( is_integer( strpos( $class, 'Exception' ) ) )
    {
        eval( sprintf( 'class %s extends Exception {}', $class ) );
        return;
    }

    if ( ! class_exists( $class, false ) )
    {
        // no exceptions in autoload :(
        die( sprintf( 'Failure to autoload class: "%s"', $class ) );
        // or perhaps: die ( '<pre>'.var_export( debug_backtrace(), true ).'</pre>' );        
    }
} 
```

您还可以找到一些其他的、较少依赖 posix 的方法来迭代目录，但这是我一直在使用的。

它遍历 include_path 中的所有目录（在 php.ini 或 .htaccess 中设置）以查找类或接口。

# unit-testing - RhinoMock 测试模拟接口无效函数？

> ID：359831
> 
> 赞同：0
> 
> 时间：2008-12-11T15:59:11.593
> 
> 标签：unit-testing, rhino-mocks

我是 RhinoMock 的新手，到目前为止一直在进行状态单元测试。

你如何测试 void 函数？

设置期望时出现以下编译错误，

*表达式不产生值*

基本上我想测试某个模拟的方法被调用了一定次数。

干杯

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-11T16:57:48.620

您想使用 LastCall。

[http://ayende.com/projects/rhino-mocks/api/files/LastCall-cs.html](http://ayende.com/projects/rhino-mocks/api/files/LastCall-cs.html)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-17T06:14:28.307

更好的是，您可以使用带有 lambda 的 Expect.Call 方法：

```
Expect.Call(() => someVoidFunction()); 
```

# vb.net - 如何判断 SubmitChanges() 是否会实际更改 LINQ to SQL 中特定实体的任何内容

> ID：359836
> 
> 赞同：4
> 
> 时间：2008-12-11T15:59:55.147
> 
> 标签：vb.net, linq-to-sql

我正在尝试确定是否对特定实体对象进行了任何更改。本质上，我想知道 SubmitChanges() 是否真的会改变任何东西。我希望能够在调用 SubmitChanges() 之后确定这一点，但这并不重要。

有人知道我会怎么做吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-11T16:11:32.130

查看DataContext 上的[GetChangeset函数。](http://msdn.microsoft.com/en-us/library/system.data.linq.datacontext.getchangeset.aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-12T02:40:56.367

您可以使用父表直接访问附加实体实例的更改：

```
var entityType = typeof(myEntity);
var table = dataContext.GetTable<entityType>();
var modifiedMembers = table.GetModifiedMembers(myEntity);

if (modifiedMembers.Any())
{
      ... changes were made
}
else
{
      ... no changes were made
} 
```

但是 - 当然，您必须在 SubmitChanges() 之前执行此操作。我使用这种方法而不是 GetChangeSet()，因为它具有更好的类型保真度，而且您可以轻松地检查更改本身。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2015-08-29T06:54:49.617

你也可以试试这个 linq2sql 的 Helper 类：

```
 public static class DataContextExtensions
{
    /// <summary>
    ///     Discard all pending changes of current DataContext.
    ///     All un-submitted changes, including insert/delete/modify will lost.
    /// </summary>
    /// <param name="context"></param>
    public static void DiscardPendingChanges(this DataContext context)
    {
        context.RefreshPendingChanges(RefreshMode.OverwriteCurrentValues);
        ChangeSet changeSet = context.GetChangeSet();
        if (changeSet != null)
        {
            //Undo inserts
            foreach (object objToInsert in changeSet.Inserts)
            {
                context.GetTable(objToInsert.GetType()).DeleteOnSubmit(objToInsert);
            }

            //Undo deletes
            foreach (object objToDelete in changeSet.Deletes)
            {
                context.GetTable(objToDelete.GetType()).InsertOnSubmit(objToDelete);
            }

            //Undo updates
            foreach (object objToUpdate in changeSet.Updates)
            {
                context.Refresh(RefreshMode.OverwriteCurrentValues, objToUpdate);
            }
        }
    }

    /// <summary>
    ///     Refreshes all pending Delete/Update entity objects of current DataContext according to the specified mode.
    ///     Nothing will do on Pending Insert entity objects.
    /// </summary>
    /// <param name="context"></param>
    /// <param name="refreshMode">A value that specifies how optimistic concurrency conflicts are handled.</param>
    public static void RefreshPendingChanges(this DataContext context, RefreshMode refreshMode)
    {
        ChangeSet changeSet = context.GetChangeSet();
        if (changeSet != null)
        {
            context.Refresh(refreshMode, changeSet.Deletes);
            context.Refresh(refreshMode, changeSet.Updates);
        }
    }
    /// <summary>
    /// Get list of items of specific type that have been changed in a context.including their original and new values
    /// </summary>
    /// <typeparam name="TItem"></typeparam>
    /// <param name="context"></param>
    /// <returns></returns>
    public static List<ChangedItems<TItem>> GetChangedItems<TItem>(DataContext context)
    {
        // create a dictionary of type TItem for return to caller
        List<ChangedItems<TItem>> changedItems = new List<ChangedItems<TItem>>();

        // use reflection to get changed items from data context
        object services = context.GetType().BaseType.GetField("services",
            BindingFlags.NonPublic |
            BindingFlags.Instance |
            BindingFlags.GetField).GetValue(context);

        object tracker = services.GetType().GetField("tracker",
            BindingFlags.NonPublic |
            BindingFlags.Instance |
            BindingFlags.GetField).GetValue(services);
        System.Collections.IDictionary trackerItems =
            (System.Collections.IDictionary)tracker.GetType().GetField("items",
                BindingFlags.NonPublic |
                BindingFlags.Instance |
                BindingFlags.GetField).GetValue(tracker);

        // iterate through each item in context, adding
        // only those that are of type TItem to the changedItems dictionary
        foreach (System.Collections.DictionaryEntry entry in trackerItems)
        {
            object original = entry.Value.GetType().GetField("original",
                BindingFlags.NonPublic |
                BindingFlags.Instance |
                BindingFlags.GetField).GetValue(entry.Value);

            if (entry.Key is TItem && original is TItem)
            {
                changedItems.Add(
                    new ChangedItems<TItem>((TItem)entry.Key, (TItem)original)
                    );
            }
        }
        return changedItems;
    }

    /// <summary>
    /// Returns a list consist a pair if original-current values of each property for the given type.
    /// First KeyValue is current and second one is original.
    /// </summary>/// <typeparam name="T"></typeparam>
    /// <param name="context"></param>
    /// <returns></returns>
    public static List<Dictionary<string, object>> GetObjectDiff<T>(this DataContext context)
    {
        List<Dictionary<string, object>> diff = new List<Dictionary<string, object>>();

        try
        {
            Debuging.Info("Try to GetObjectDiff");
            var changes = DataContextExtensions.GetChangedItems<T>(context);

            foreach (ChangedItems<T> changedItem in changes)
            {
                PropertyInfo[] props = typeof(T).GetProperties();

                var dictCurrent = new Dictionary<string, object>();

                foreach (PropertyInfo prp in props)
                {
                    object value = prp.GetValue(changedItem.Current, new object[] { });
                    dictCurrent.Add(prp.Name, value);
                }

                var dictOrigin = new Dictionary<string, object>();

                foreach (PropertyInfo prp in props)
                {
                    object value = prp.GetValue(changedItem.Original, new object[] { });
                    dictOrigin.Add(prp.Name, value);
                }

                foreach (var item in dictCurrent)
                {
                    var paired = dictOrigin.SingleOrDefault(a => a.Key == item.Key);
                    if (paired.Value != item.Value)
                    {
                        var first = new Dictionary<string, object>();
                        first.Add(item.Key,item.Value);
                        diff.Add(first);

                        var second = new Dictionary<string, object>();
                        second.Add(paired.Key, paired.Value);
                        diff.Add(second);
                    }
                }
            }
        }
        catch (Exception ex)
        {
            Debuging.Error(ex, "DataContextExtensions.GetObjectDiff");
        }
        return diff;
    }

    /// <summary>
    /// Detect if there is any changed object in the context or not.
    /// </summary>
    public static bool HasChanges(this DataContext context)
    {
        ChangeSet changeSet = context.GetChangeSet();

        if (changeSet != null)
        {
            return changeSet.Inserts.Any() || changeSet.Deletes.Any() || changeSet.Updates.Any();
        }

        return false;
    }

    public class ChangedItems<T>
    {
        public ChangedItems(T current, T original)
        {
            this.Current = current;
            this.Original = original;
        }

        public T Current { get; set; }
        public T Original { get; set; }
    }

} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-11T22:13:38.140

这就是我想出的：

```
Public Function HasChanges(ByVal obj As Object) As Boolean
    Dim cs = GetChangeSet()
    If cs.Updates.Contains(obj) Or cs.Inserts.Contains(obj) Or cs.Deletes.Contains(obj) Then Return True
    Return False
End Function 
```

# wpf - 向 WrapPanel 添加滚动条

> ID：359847
> 
> 赞同：10
> 
> 时间：2008-12-11T16:02:20.837
> 
> 标签：wpf, scroll, wrappanel

如何将滚动条添加到 WPF 中的 wrappanel 控件。由于没有滚动条，我的一些控件在宽度方面被切断了。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-12-11T16:07:46.130

在这种情况下，ScrollViewer 将对您有所帮助。否则，您将需要使用 ScrollBar 控件并手动控制可见的内容。

滚动查看器的使用示例：

```
<DockPanel>
   <ScrollViewer VerticalScrollBarVisibility="Auto">
       <StackPanel />
   </ScrollViewer >
</DockPanel> 
```

# java - 从 java java->jni.dll ->app.dll -> app.dll 调试 dll

> ID：359851
> 
> 赞同：5
> 
> 时间：2008-12-11T16:02:53.113
> 
> 标签：java, dll, java-native-interface

如何调试 java 应用程序未加载的 dll。

场景是这样的：我的 java 应用程序正在加载使用另一个 dll 的 jni.dll，而该 dll 正在使用另一个 dll。

java<->jni.dll<->dll<->dll

我有所有模块的源代码

我在调试 jni.dll 时使用了 Visual Studio Express，但我应该怎么做才能调试其他 dll？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-12T07:10:50.363

但这是一样的。

我也这样做，所以让我解释一下我的工作集。

我正在使用 eclipse 3.1 和 Visual C++ 2003 7.1.3088（德语...对不起；））和 Windows XP。我在 java 中加载 some_jni.dll 和 some.dll 并使用 jni 类。some.dll 在内部加载 other.dll。我可以在 Visual Studio 中调试 some.dll 和 other.dll。

启动您的应用程序并在第一个 jni 类调用中放置一个断点。打开VS并转到（德语）“Debuggen”（调试）->“Prozesse”（进程）他们你会看到javaw.exe

选择 javaw.exe 并按“Anfügen”（附加）。

当我记得时，放置断点的c ++中的代码页必须在VS中打开。自动命中断点时VS不会打开页面。当加载完 dll 并执行放置断点的代码行时，VS 中的调试器将停止在该位置。注意：这只会发生，当您使用调试选项编译要调试的 dll 时！！！否则调试器将不会在 C++ 断点处停止。

我半年前就这样做了，但这应该是正确的步骤。

它希望你得到它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-11T17:38:13.453

在 Visual Studio 中，您可以使调试器适应正在运行的 Java 进程。当 C++ 代码中的断点被命中时，调试器将在 Visual Studio 中显示并停止进程。

目前我没有安装 Visual Studio，但在调试选项中有一个窗口，您可以在其中看到所有正在运行的进程。查找 java 进程并将该进程添加到调试会话。

当 dll 执行断点所在的行时，您将看到它。

编辑：您必须使用调试信息而不是在发布模式下编译的 dll，否则 Visual Studio 中的调试器将不会在断点处停止！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-13T05:17:24.950

作为替代方案，请尝试 IKVM。[http://www.ikvm.net/](http://www.ikvm.net/)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-11T16:22:48.517

自从我上次这样做以来已经有很长时间了，即便如此，它还是在 Linux 和 Solaris 上。一个不完整的解决方案是使用“”在您的 DLL 中嵌入“硬编码断点`_asm int 3;`”

每当 Windows 执行此指令时，它都会让桌面用户有机会将适当配置的调试器附加到受影响的进程。

它不像将调试器指向已知的进程 ID 那样顺利，但它应该能让你继续前进。

M。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-02-06T02:33:19.037

一种粗略的做法是在要调试的 dll 中创建一个无限循环：

`int x = 1;
while(x);`

一旦 Java 应用程序进入此循环，通过调试器附加到此进程并将值设置`x`为`0`以中断循环，现在您可以使用调试器逐步完成。

# com - Nant 中的互斥锁

> ID：359867
> 
> 赞同：0
> 
> 时间：2008-12-11T16:06:07.240
> 
> 标签：com, nant, mutex

如何在 Nant 中实现互斥锁？我需要这个功能的原因是因为我注册了 COM 组件以使我的构建工作。然后在构建结束时，我取消注册 COM 组件。

没有互斥锁，不同版本的 COM 被注册并面临一些问题。

因此，如果我们在 Nant 脚本中应用互斥锁会更好。这样，如果构建正在运行，其他项目将等到它完成。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-15T05:15:55.580

我知道这样做的唯一方法是创建您自己的任务，该任务允许您锁定全局互斥体，然后另一个任务来解锁它。这些新任务可以单独构建并通过将 dll 复制到 NAnt\bin 文件夹中添加到 NAnt，或者直接从构建文件扩展 NAnt

[可以在<script/> 任务](http://nant.sourceforge.net/release/0.85/help/tasks/script.html)中找到帮助您入门的信息

# .net - 本地化系统生成的状态消息

> ID：359870
> 
> 赞同：4
> 
> 时间：2008-12-11T16:06:39.410
> 
> 标签：.net, localization

我在 .NET 环境中工作，系统偶尔会为客户生成日志条目。然后将消息附加到客户日志中，以后可以查看该日志。

例如，如果客户正在订阅一项新服务，或者客户的付款尝试失败，则这些消息会附加到客户日志中。

目前，所有消息都被硬编码到代码中，例如“客户未能完成XX的支付”。

现在的问题是这些消息需要以一种智能的方式进行本地化，这样当一个英语用户查看客户日志时，他会得到英文消息，而当外国用户查看日志时，他会得到他的语言的消息。

处理这种情况的最佳方法是什么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-11T22:18:18.923

*   记录事件标识符而不是消息。
*   捕获事件特定数据以及事件标识符。
*   当用户查看日志时，根据唯一标识符本地化事件消息。

您将遇到的问题是，如果您尝试以会话方式将动态数据插入到消息中。例如，如果您必须写“未找到消息”与“找到一条消息”与“找到 X 条消息”是有问题的 - 在英语中，我们有不同的复数表示零、一和多于一……但它是不一定像其他语言那样。像数字或日期这样的东西在 String.Format 形式中插入的问题较少，但您不想参与尝试以本地化方式动态生成真实语言的业务。

我建议遵循类似于 Windows 事件日志的模式，您可以在其中输出事件 ID、基于事件 ID 的本地化消息，然后捕获某些“字段”，您将在其中本地化字段名称和显示格式该字段，例如“金额：$ 2.00”或其他。这可能不是最漂亮的方法，但除非你有一个专职的语言学家专门研究这个并且你打算考虑每种语言的所有细微差别，否则我会选择更简单的日志输出格式.

在您给定的示例中，您将日志消息与数据分开，例如：

客户未能完成付款。
金额：XX

You'd log a message ID, like "13579" might be the unique ID for the event when a customer fails to finish a payment. Finally, you could store the value as a separate field.

How you go about figuring out how many fields to allocate to an event or how to store the data is... well, an exercise best left to the reader.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-11T17:08:58.580

您可以在数据库中定义本地化字符串，并将日志消息的 id 记录到日志表中。日志消息表还将包含一个指示语言的字段。

如果您要进行大量日志记录，那也会减少日志的大小（即使这可能不相关，考虑到现代计算机中可用的存储空间;-)

该方法有两个问题：

2.  您需要将应用程序中的日志记录与日志消息表同步。
3.  您不能记录任何动态数据，例如客户姓名。

第一点可以通过使用具有描述性名称的枚举来处理，例如

```
enum LogMessages
{
    OutOfDiskSpace = 1;
    OutOfMemory = 2;
    OutOfCoffee = 3;
} 
```

在您的应用程序中，您会这样调用`void LogToDatabase(LogMessages)`：

```
// forgot to buy coffee again!
Log(OutOfCoffee); 
```

第二个问题需要更多的工作。您可以定义您的字符串，以便您可以使用`string.Format()`：

```
 string.format("{0} forgot to buy coffee again. Lazy geek!", "I");
// yields: "I forgot to buy coffee again. Lazy geek!" 
```

为此，您必须将变化数据（“I”、“you”、“My little brother”...）与日志消息 ID 一起存储在日志表中。（或者您将其规范化一点并将其放在第三个表中，但这很可能是过早的规范化;-)。

# c# - (web.config|app.config) 中的配置设置与静态类对象

> ID：359875
> 
> 赞同：2
> 
> 时间：2008-12-11T16:08:50.747
> 
> 标签：c#, asp.net

我只是在看 BlogEngine.Net 源代码，并对它如何存储应用程序设置很感兴趣。

源代码没有使用我习惯的 web.config 或 app.config，而是使用使用单例模式实现的静态类对象来实现应用程序设置。信息仍存储在设置文件中，但任何检索信息的调用都是通过类对象完成的，该类对象将所有信息预加载到属性值中。

不同方法的任何优点？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-11T16:19:51.677

如果您有一个可以更改配置设置的管理区域，则写入 web.config 将导致应用程序重新启动并且所有用户都丢失他们的会话数据。使用单独的配置文件将防止这种情况发生。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-07T15:05:42.063

此模型的一个严重缺点是无法获取在应用程序之外进行的更改。由于配置设置在启动时加载并保存在内存中，因此所有更改都必须通过管理页面或在应用程序脱机时完成。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-07T15:14:25.693

拥有充当配置设置访问器的属性有利有弊。

一方面，拥有这样一个具有属性的类为开发团队提供了更好的组织和更可重用的代码。

另一方面，每次添加新的配置设置时，是否都必须更新类并重建应用程序？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-07T15:24:43.660

据我了解，web.config 文件在应用程序启动时被加载到缓存中。好久没看这个了，可能会误会。如果这是真的，那么我真的不明白为什么单例静态类模式会有好处。如果使用 ASP.Net 状态服务或 SQL 状态服务器而不是默认的进程内会话管理，则重新启动 Web 应用程序（通过 IIS 或通过修改配置）不会影响会话。总而言之，我不完全确定为什么 blogengine.net 会走这条路。

# c# - 如何设置 MySQL 以使用 C#？

> ID：359880
> 
> 赞同：3
> 
> 时间：2008-12-11T16:10:24.953
> 
> 标签：c#, mysql, odbc

我的任务是为旧网站创建一个新的前端。

它是用 php (pre-oo) 编写的，并使用 MySQL 数据库。主机提供了一个 .Net 包，但不提供 Ms Sql Server。

这很好，因为数据库工作正常，但我真的想使用 Asp.net 来处理页面。但是，我看到的大多数关于从 C# 连接到 MySQL 的教程都需要安装专门用于 MySQL 的 ODBC 驱动程序。不控制托管环境，我怀疑我能做到这一点:)

你有什么见解可以分享这个问题吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-11T16:12:01.783

MySql 确实有.Net 的[连接器](http://dev.mysql.com/downloads/connector/net/5.2.html)。您不需要使用 ODBC，

MySql 连接器将让您与您的 MySql 数据库进行交互，并且是完全托管的 ADO.Net 提供程序。如果您愿意，您可以拥有二进制文件 (dll) 或源代码。这很简单，一旦你导入了 dll，你只需要一个连接字符串（用户名、密码、位置）就可以设置好了！

这是一个代码示例（参考：[bitdaddy.com](http://bitdaddys.com/MySQL-ConnectorNet.html)）：

```
string MyConString = "SERVER=localhost;" +
    "DATABASE=mydatabase;" +
    "UID=testuser;" +
    "PASSWORD=testpassword;";
MySqlConnection connection = new MySqlConnection(MyConString);
MySqlCommand command = connection.CreateCommand();
MySqlDataReader Reader;
command.CommandText = "select * from mycustomers";
connection.Open();
Reader = command.ExecuteReader();
while (Reader.Read())
{
    string thisrow = "";
    for (int i= 0;i<Reader.FieldCount;i++)
            thisrow+=Reader.GetValue(i).ToString() + ",";
    listBox1.Items.Add(thisrow);
}
connection.Close(); 
```

我建议你不要把你的代码和持久性放在同一个地方，把你的连接字符串放在你的 App.Config 中，但我认为这会告诉你如何去做。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-11T14:53:36.013

同意 Patrick Desjardins 的观点，并且想补充一下与 MySQL 交互的最简单方法是

1.  获取[.Net v6.0 的 MySQL 连接器](http://dev.mysql.com/downloads/connector/net/6.0.html)- 这支持 [实体框架](http://msdn.microsoft.com/en-us/library/aa697427(VS.80).aspx)
2.  使用 ADO.Net 实体模型创建数据模型层以与数据库交互

或者

您还可以查看[Linq to MySQL 提供程序](http://code2code.net/Linq_Mysql/)的实现——它非常好。

当我有类似的要求时，我选择了前一个选项。

# c# - 如何使用线性索引在多维数组中设置值

> ID：359881
> 
> 赞同：2
> 
> 时间：2008-12-11T16:10:28.137
> 
> 标签：c#, .net

使用线性索引在 C# 多维数组中设置值的最有效方法是什么？例如给定一个数组...

```
int[,,] arr2 = {   {{0,1,2}, {3,4,5}, {6,7,8}}
                , {{9,10,11}, {12,13,14}, {15,16,17}}
                , {{18,19,20}, {21,22,23}, {24,25,26}}
        }; 
```

如何使用线性索引将所有元素设置为 30 ...

```
//This code does not work
for (int i = 0; i < arr.Length; i++)
{
    arr.SetValue(30, i);
} 
```

显然上面的 SetValue() 不适用于多维数组。

这是我能想到的最佳解决方案...

编辑：为代码添加了一些说明...

```
static class Program
{
    static void Main(string[] args)
    {
        //Sample input. 
        int[,,] arr2 = {   {{0,1,2}, {3,4,5}, {6,7,8}}
                        , {{9,10,11}, {12,13,14}, {15,16,17}}
                        , {{18,19,20}, {21,22,23}, {24,25,26}}
                };

        int[] arr1 = { 1, 2, 3, 4 };

        setElementsTo30(arr2);
        setElementsTo30(arr1);

    }

    //Must be able to process int arrays of arbitrary dimensions and content
    private static void setElementsTo30(Array arr)
    {
        IList<int> cumulativeLength = getCumulativeLengths(arr);

        for (int i = 0; i < arr.Length; i++)
        {
            SetValue(arr, i, 30, cumulativeLength);
        }
    }

    public static void SetValue(this Array arr, int index, object value, IList<int> cumulativeLength)
    {
        int[] arrayIndex = new int[arr.Rank];

        for (int dim = arr.Rank-1; dim >= 0; dim--)
        {
            arrayIndex[dim] = index / cumulativeLength[dim] % arr.GetLength(dim);
        }

        arr.SetValue(value, arrayIndex);
    }

    private static IList<int> getCumulativeLengths(Array arr)
    {
        List<int> lengths = new List<int>(arr.Rank);

        for (int dim = 0; dim < arr.Rank; dim++)
        {
            int prod = 1;
            for (int i = dim + 1; i < arr.Rank; i++)
            {
                prod *= arr.GetLength(i);
            }
            lengths.Add(prod);
        }

        return (IList<int>)lengths;
    }
} 
```

有没有办法更有效地做同样的事情，并且可能使用框架本身提供的东西（即可以毫不费力地使用的东西。）

谢谢，
SDX2000。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-11T16:50:36.527

为什么需要 IList ？

```
static void SetValue2(this Array a, object value, int i) {
    int[] indices = new int[a.Rank];
    for (int d = a.Rank - 1; d >= 0; d--) {
        var l = a.GetLength(d);
        indices[d] = i % l;
        i /= l
    }
    a.SetValue(value, indices);
} 
```

测试代码：

```
static void Main(string[] args) {
    int[, ,] arr2 = {   
        {{0,1,2}, {3,4,5}, {6,7,8}}, 
        {{9,10,11}, {12,13,14}, {15,16,17}}, 
        {{18,19,20}, {21,22,23}, {24,25,26}}
    };
    for (int i = 0; i < arr2.Length; i++) {
        arr2.SetValue2(30, i);
    }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-11T16:44:36.290

你知道最初会存在多少个元组吗？如果您说一个尺寸为 axbxcxd 的矩阵，您不能使用以下内容获取所有索引的列表：

```
for i=0 to (a*b*c*d)

       Array[i % a, (i/a) % b, (i/(a*b) % c, i / (a*b*c)] = 30 
```

因此，随着计数器在各种范围内滚动，每个后续索引都会增加。如果还有更多，这确实可以概括为一个 n 元组，只是将先前的值相乘。如果想以不同的方式遍历，可以反转索引的算术。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-11T16:17:22.273

`SetValue()`应该管用。看看[这个](http://msdn.microsoft.com/en-us/library/758awxk7.aspx)以获得更多灵感。

编辑：你能不能不做

```
{{30,30,30}, {30,30,30}, {30,30,30}}
 , {{30,30,30}, {30,30,30}, {30,30,30}}
  , {{30,30,30}, {30,30,30}, {30,30,30}

} 
```

作为旁注，您确定要返回`IList<int>`from`getCumulativeLengths`吗？

我一直认为，要慷慨输入，严格输出。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2017-07-03T19:20:32.780

```
 public static void CopyToMultidimensionalArray(this IList<object> source, Array target, IList<int> dimensions)
    {
        var indices = new int[dimensions.Count];
        for (var i = 0; i < source.Count; i++)
        {
            var t = i;
            for (var j = indices.Length - 1; j >= 0; j--)
            {
                indices[j] = t % dimensions[j];
                t /= dimensions[j];
            }

            target.SetValue(source[i], indices);
        }
    } 
```

# c++ - Symbian C++ - S60 应用程序通过 TRK 和 Carbide 启动，但不是在之后或下载时启动

> ID：359885
> 
> 赞同：0
> 
> 时间：2008-12-11T16:10:45.063
> 
> 标签：c++, symbian, s60, carbide

我的应用程序刚刚开始出现奇怪的行为。

我可以通过 Carbide Debugger（使用 TRK）启动它，它工作正常，没有明显的错误，并且安装在设备上。

任何启动应用程序的进一步尝试都会失败，即使在重新启动后也是如此。手动卸载和下载 .sisx 文件也不起作用。

有没有人有过这样的经历？可能是缺少一些资源文件，还是有其他方法可以找出发生了什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-12T07:20:34.837

您应该安装[ErrRd](http://wiki.forum.nokia.com/index.php/Extended_panic_code) sis 文件以使您的手机显示扩展的恐慌 - 也许这会给您一些提示。如果您得到“菜单 -1”，那么很可能您缺少一些资源文件或库。此外，如果您使用 DLL 文件，请检查它们是否至少具有与您的 EXE 文件相同的功能。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-15T19:28:46.693

我还建议注册到诺基亚开发者论坛——您可以从那里更快地和专家那里找到答案。

# javascript - 确定用户何时键入

> ID：359887
> 
> 赞同：17
> 
> 时间：2008-12-11T16:11:10.413
> 
> 标签：javascript, ajax

我正在构建一个搜索框（输入字段），它应该进行服务器调用以过滤插入了文本的网格，但我需要以一种智能的方式进行此操作，只有在用户有时才需要触发服务器调用停了下来。现在我正在尝试实现它，但如果有人知道怎么做，我会很高兴。无论如何，如果我先这样做，我会在这里发布答案......最好的问候，Jaime。

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2008-12-11T16:15:10.687

1.  当一个键被按下时：
    1.  检查是否有一个现有的计时器 - 如果有一个就停止它
    2.  启动计时器。
2.  当计时器到期时，调用服务器方法。

```
var searchTimeout;
document.getElementById('searchBox').onkeypress = function () {
    if (searchTimeout != undefined) clearTimeout(searchTimeout);
    searchTimeout = setTimeout(callServerScript, 250);
};
function callServerScript() {
    // your code here
} 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-11T16:16:56.673

您可以`setTimeout`在按键事件上使用调用您的服务器功能的调用（可能有 2-3 秒的延迟）。按下 a 键后，立即取消上一个`setTimeout`呼叫并创建一个新呼叫。

然后，在没有按键的情况下经过 2-3 秒，将触发服务器事件。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-11T18:43:11.200

这是一个无需 jQuery 的简单方法：

```
<input type="text" id="TxtSearch" onchange="countDown=10;" />

<script type="text/javascript">

var countDown = 0;
function SearchTimerTick()
{
   if(countDown == 1)
   {
      StopTypingCommand();
      countDown = 0;
   }

   if(countDown > 0)
      countDown--;
}

window.setInterval(SearchTimerTick,1000);

</script> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-11T16:16:28.127

我对 JavaScript 了解不多，但您可以使用一个计时器（假设设置为 5 秒），该计时器会在您输入框中的每个更改事件时重置。如果用户停止输入超过 5 秒，则计时器到期并触发提交。

这种方法的问题在于，每次暂停都会触发提交，例如，如果用户停止打字来记录咖啡休息时间。您将不得不看看这是否为用户所接受。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-11T17:55:36.943

感谢您的反馈意见。我已经实现了这段代码，它似乎完成了这项工作（使用 jquery）：

```
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"> 
```

```
<script src="jquery.js" type="text/javascript"></script>

<script type="text/javascript">
    var interval = 500;
    var filterValue = "";
    $(document).ready(function() {
        $(".txtSearch").bind("keypress", logKeyPress);
    });
    function logKeyPress() {
        var now = new Date().getTime();
        var lastTime = this._keyPressedAt || now;
        this._keyPressedAt = now;
        if (!this._monitoringSearch) {
            this._monitoringSearch = true;
            var input = this;
            window.setTimeout(
                function() {
                    search(input);
                }, 0);
        }
    }
    function search(input) {
        var now = new Date().getTime();
        var lastTime = input._keyPressedAt;
        if ((now - lastTime) > interval) {
            /*console.log(now);
            console.log(lastTime);
            console.log(now - lastTime);*/
            if (input.value != filterValue) {
                filterValue = input.value;
                //console.log("search!");
                alert("search!");
            }
            input._monitoringSearch = false;
        }
        else {
            window.setTimeout(
                function() {
                    search(input);
                }, 0);
        }
    }
</script> 
```

# c++ - 如何在不同用户下为目标进程复制套接字

> ID：359891
> 
> 赞同：1
> 
> 时间：2008-12-11T16:11:43.330
> 
> 标签：c++, winapi, sockets

我遇到了 WSADuplicateSocket 的问题，我用它来复制套接字以供不同的进程使用。当两个进程在同一个 Windows 用户下运行时，它可以找到，但当它们在不同用户下运行时失败并出现错误代码 10022 (WSAEINVAL)。

具体来说，调用 WSADuplicateSocket 的进程在 admin 用户帐户下运行，而目标进程在 System 帐户下运行。

在网上搜索，我发现了有关该问题的其他参考，但没有解决方案。有谁知道解决这个问题的方法？

这是当前代码：

```
bool Duplicate(
    SOCKET s,
    WSAPROTOCOL_INFO* pSocketInfo,
    int targetProcessID,
    int& errorNum
)
{
    memset(pSocketInfo, 0, sizeof(WSAPROTOCOL_INFO));
    if (::WSADuplicateSocket(s, targetProcessID, pSocketInfo)
        == SOCKET_ERROR)
    {
        errorNum = ::WSAGetLastError();
        return false;
    }
    return true;
} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-03T23:03:53.067

也许目标用户（系统）没有访问网络的权限？我认为在 windows xp 周围已经创建了一个特殊的服务帐户（网络服务）来分隔需要访问网络的服务。您是否为系统以外的其他用户测试过您的代码？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-08T22:26:49.300

MSDN 关于这个主题有点不清楚，我没有时间自己测试，但可能套接字句柄作为内核​​对象附加了一个安全描述符，不允许其他任何人访问它比创造者。

尝试调用 GetKernelObjectSecurity 以检查附加到句柄的 ACL，然后尝试调用 SetKernelObjectSecurity 以允许其他用户访问句柄。也许然后 WSADuplicateSocket 会正常工作？

# c# - 如何从 HttpPostedFile 创建字节数组

> ID：359894
> 
> 赞同：160
> 
> 时间：2008-12-11T16:13:32.327
> 
> 标签：c#, arrays

我正在使用具有 FromBinary 方法的图像组件。想知道如何将输入流转换为字节数组

```
HttpPostedFile file = context.Request.Files[0];
byte[] buffer = new byte[file.ContentLength];
file.InputStream.Read(buffer, 0, file.ContentLength);

ImageElement image = ImageElement.FromBinary(byteArray); 
```

* * *

## 回答 #1

> 赞同：306
> 
> 时间：2008-12-11T16:32:10.480

使用 BinaryReader 对象从流中返回一个字节数组，例如：

```
byte[] fileData = null;
using (var binaryReader = new BinaryReader(Request.Files[0].InputStream))
{
    fileData = binaryReader.ReadBytes(Request.Files[0].ContentLength);
} 
```

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2009-03-18T17:11:06.140

```
BinaryReader b = new BinaryReader(file.InputStream);
byte[] binData = b.ReadBytes(file.InputStream.Length); 
```

第 2 行应替换为

```
byte[] binData = b.ReadBytes(file.ContentLength); 
```

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2012-12-10T17:20:33.567

如果您的文件 InputStream.Position 设置为流的末尾，它将不起作用。我的附加线路：

```
Stream stream = file.InputStream;
stream.Position = 0; 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-12-11T16:36:25.107

在您的问题中，缓冲区和 byteArray 似乎都是 byte[]。所以：

```
ImageElement image = ImageElement.FromBinary(buffer); 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2014-01-23T07:29:13.590

在 stream.copyto 之前，您必须将 stream.position 重置为 0；然后它工作正常。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2016-05-13T11:07:47.413

对于图像，如果您使用 Web Pages v2，请使用 [WebImage 类](https://msdn.microsoft.com/en-us/library/system.web.helpers.webimage%28v=vs.111%29.aspx)

```
var webImage = new System.Web.Helpers.WebImage(Request.Files[0].InputStream);
byte[] imgByteArray = webImage.GetBytes(); 
```

# javascript - IE8 中 Javascript 错误的最可能原因是什么？

> ID：359895
> 
> 赞同：20
> 
> 时间：2008-12-11T16:13:39.143
> 
> 标签：javascript, internet-explorer, internet-explorer-8

我在 IE7（以及 Firefox、Chrome 和 Safari）中运行良好的页面上看到了 IE8 中的许多 Javascript 错误。我知道 IE 对 Javascript 安全性等内容进行了一些更改。其中一些没有给出明确的错误消息——诸如跨域违规之类的事情最终可能会引发非常模糊的异常。

当我们对 IE8 Javascript 错误进行故障排除时，让我们列出最严重的问题。请列出**一项**对 IE8 Javascript 方式的更改会导致 Javascript 错误。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-12-12T15:33:19.717

我可以验证“unique_username”发布的内容是否准确！

（引用）实际上很多东西已经改变了。

首先，您所处的模式非常重要。在 IE8 中，有 3（三种）模式。

*   IE5 Quirks - 你的页面没有文档类型，页面呈现像 IE5 一样
*   IE 7 标准模式 - 你有一个 doctype，但要么选择退出 IE8 标准模式，要么在 localhost 上运行，要么处于“兼容模式”
*   IE 8 标准模式 - 你有一个 doctype，并且在 INTRANET 上（默认模式）

现在，如果您在 IE5/IE7 模式下进行渲染，那么除了将添加一些*不会*干扰您的页面的方法之外，没有任何变化。

但是，如果像大多数人一样，您正在使用 doctype 集运行，因此在 IE8 标准模式下，会发生以下更改。

```
1.) document.getElementById( id ); //now only returns the CORRECT matches! 
```

2.) ~~.getElementsByName( 名称 ); //现在只返回正确的匹配！~~不，不固定！

```
3.) .getAttribute( name ); //returns the CORRECT value for the given attribute!
4.) .setAttribute( name, value ); //actually SETS the name/value CORRECTLY (no more cAmElCaSe crud)!
5.) CSS Expressions are NO LONGER allowed (deprecated)
6.) Operation Aborted errors will still be thrown (in some cases) however the cases are fewer, and the error won't kill the entire page/DOM
7.) The attributes[] array on elements should (from the RC build onwards) be correct in terms of contents, have a length, etc.
8.) Button elements now submit the contents of the value attribute, NOT the HTML contents of the Button Tag 
```

还有一堆 CSS 2.1 修复，所以之前呈现怪异或需要 hack 的东西应该会好得多。（有关 alpha/透明度的详细信息，请参见下文 - 发生了很大变化）

有关详细信息，请参阅[IE 博客](http://blogs.msdn.com/ie/)。

另请参阅[Web Bug Track](http://webbugtrack.blogspot.com/2008/01/internet-explorer-8-ie8-facts-and.html)以获取有关 IE8（和所有其他浏览器）的错误、修复的详细信息

SVG、圆角、基于 ECMAScript 的事件监听器、更好的表单元素设计/事件等仍然缺失。

PS 如果您有具体问题，请告诉我们，我们会帮助您解决问题。;-)

更新：

~~window.resize 事件目前在 IE8 Beta2 和 IE8 Partner Release 1 中被破坏（不会触发）~~现在在 RTM 构建中修复

```
window.open(); in IE8 Partner Release is sometimes failing "claiming" that the target url is not available (quirky, hard to reproduce) 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-04-01T00:27:30.593

这是我发现的一个非常有趣的（/讽刺关闭）。如果您的 MIME 类型为“application/javascript”，而不是“text/javascript”，Internet Explorer 将：

A) 忽略意外的 MIME 类型并使用该文件？

B）根本不加载文件？

C）取文件的前一百行左右，将它们添加到 HTML 中它之前的另一个 JS 文件中，然后给你各种错误，因为你的乱序半文件 + 实际文件没有工作？

没错，答案是C……我不骗你。我们曾经使用“application/javascript” MIME 类型来防止 IE6/7 中的 JS 文件缓存，结果我浪费了一整天的时间试图弄清楚为什么 IE8 会给出一些非常疯狂的错误。幸运的是，当它告诉我在 500 行文件的第 650 行出现错误时，我终于弄清楚发生了什么（然后当我在调试器中查看该文件时，我看到了附加的其他文件）。

故事的寓意：如果您希望 IE8 工作，请不要将“应用程序/javascript”用于您的 JS 文件的 MIME 类型。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-11T16:31:23.103

我在这里找到了一些列表：http: [//social.msdn.microsoft.com/forums/en-US/iewebdevelopment/thread/772e4b07-29e1-4909-b77f-f61c503f9579/](http://social.msdn.microsoft.com/forums/en-US/iewebdevelopment/thread/772e4b07-29e1-4909-b77f-f61c503f9579/)

我还没有验证这些，其中一些非常模糊。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-09-04T19:46:59.350

这个聚会有点晚了，但在研究同样的问题时，我遇到了这篇[MSDN](http://msdn.microsoft.com/en-us/library/s4esdbwz%28v=vs.94%29.aspx)文章，它强调了 IE 8 的 JScript 引擎不支持的功能。

# python - 将参数列表与其自身进行比较？

> ID：359903
> 
> 赞同：2
> 
> 时间：2008-12-11T16:14:25.087
> 
> 标签：python

有点奇怪的问题，但是。我需要一个字符串列表，我需要确保该列表中的每个字符串都是相同的。

例如：

```
a = ['foo', 'foo', 'boo'] #not valid
b = ['foo', 'foo', 'foo'] #valid 
```

这样做的最佳方法是什么？

仅供参考，我不知道列表中有多少字符串。这也是一个超级简单的问题，但我太累了，无法思考。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-11T16:21:34.823

使用 list.count 获取列表中与某个值匹配的项目数。如果该数字与项目数不匹配，则您知道它们并不完全相同。

```
if a.count( "foo" ) != len(a) 
```

看起来像...

```
if a.count( a[0] ) != len(a) 
```

...在生产代码中。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-11T16:54:36.270

也许

```
all(a[0] == x for x in a) 
```

是最易读的方式。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-11T17:49:23.150

供参考。对不同大小的输入列表进行 5000 次匹配和不匹配版本的测试迭代。

```
List Size 10
0.00530 aList.count(aList[0] ) == len(aList)
0.00699 for with return False if no match found.
0.00892 aList == [aList[0]] * len(aList)
0.00974 len(set(aList)) == 1
0.02334 all(aList[0] == x for x in aList)
0.02693 reduce(lambda x,y:x==y and x,aList)

List Size 100
0.01547 aList.count(aList[0] ) == len(aList)
0.01623 aList == [aList[0]] * len(aList)
0.03525 for with return False if no match found.
0.05122 len(set(aList)) == 1
0.08079 all(aList[0] == x for x in aList)
0.22797 reduce(lambda x,y:x==y and x,aList)

List Size 1000
0.09198 aList == [aList[0]] * len(aList)
0.11862 aList.count(aList[0] ) == len(aList)
0.31874 for with return False if no match found.
0.36145 len(set(aList)) == 1
0.65861 all(aList[0] == x for x in aList)
2.24386 reduce(lambda x,y:x==y and x,aList) 
```

明确的赢家和输家。计数规则。

这是运行很快的 quickExit 版本，但不是单行的。

```
def quickExit( aList ):
    """for with return False if no match found."""
    value= aList[0]
    for x in aList:
        if x != value: return False
    return True 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-11T16:27:04.517

尝试从该列表创建一个集合：

```
if len(set(my_list)) != 1:
    return False 
```

集合不能有重复的项目。

编辑：S.Lott 的建议更简洁：

```
all_items_are_same = len(set(my_list)) == 1 
```

可以这样想：

```
# Equality returns True or False
all_items_are_same = (len(set(my_list)) == 1) 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-11T16:22:17.817

无论您使用什么函数，您都必须至少遍历整个数组一次。

因此，只需使用 for 循环并将第一个值与每个后续值进行比较。没有什么比这更快了，它将是三行。实际上，以更少的行数完成的任何事情都可能在计算上更加复杂。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-11T16:22:51.140

尝试（如果列表不太长）：

```
b == [b[0]] * len(b) #valid
a == [a[0]] * len(a) #not valid 
```

这使您可以将列表与相同大小的列表进行比较，这些列表都是相同的第一个元素

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-11T17:00:51.733

我认为这应该是你用 reduce 函数做的事情......

```
>>> a = ['foo', 'foo', 'boo'] #not valid
>>> b = ['foo', 'foo', 'foo'] #valid
>>> reduce(lambda x,y:x==y and x,a)
False
>>> reduce(lambda x,y:x==y and x,b)
'foo' 
```

不过，我不确定这是否比将其变成一套解决方案有任何优势。如果你想测试数组中的每个值是否都是 False，它会失败。

# c# - c#中的配置文件

> ID：359905
> 
> 赞同：2
> 
> 时间：2008-12-11T16:14:41.873
> 
> 标签：c#, file, config

我有一个 UserControl Library 解决方案，它具有以下内容

用户控件---用户控件项目

```
 ---UserControl Test Project 
```

在我的测试项目中，我可以将我的用户控件添加到工具箱中。当我将它拖放到我的表单中时，它失败了。我输入日志，发现我的用户控件读取了一个配置文件。配置文件被标记为始终复制并存在于 obj\debug 和 bin\debug 目录/中。

但是，当我将用户控件拖到我的测试项目上的表单时，它正试图从中获取文件

C:\Documents and Settings\jondoe\Local Settings\Application Data\Microsoft\VisualStudio\8.0\ProjectAssemblies\vqjlihdl01

以上就是这个结果

```
string pluginAssemblyPath = Assembly.GetExecutingAssembly().Location;
            DirectoryInfo dirInfo = new DirectoryInfo(pluginAssemblyPath);
            pluginAssemblyPath = pluginAssemblyPath.Replace(dirInfo.Name.ToString(),"");
            string configFilePath = pluginAssemblyPath + "FileConfig.xml"; 
```

我会假设如果我在调试模式下编译，文件应该在 obj\debug 下，那应该是我的程序集路径。什么给出了或者我需要做一些设置才能让它正确运行，以便它可以在正确的位置找到我的配置文件？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-11T16:40:15.300

当心，我发现 DesignMode 属性是不可靠的，如果您在表单上的另一个控件上有一个控件（例如）。它似乎只适用于直接放置在设计表面上的控件。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-11T16:20:46.807

您在设计时需要配置文件吗？如果没有，您可以更改代码以测试它是否在设计时运行，例如：

```
if (this.Site != null && this.Site.DesignMode)
{
    ... design time behavior
}
else
{
    ... runtime behavior (read config file)
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-11T16:21:52.513

您的用户控件真的需要读取配置文件吗？使用户控件成为单独项目的主要优点之一是您可以在多个其他项目中重用它。如果您的用户控件必须读取配置文件，这会使重用它变得更加困难和复杂（如您所见）。

如果您实际上不需要在多个项目中使用该控件，那么解决当前问题的最快方法可能是将用户控件合并到您的主项目中（即不要将其作为单独的项目保留）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-11T16:31:53.087

我必须在各种项目中使用我的控件，因此我使用配置文件来根据项目调整设置。

在我以类似方式完成工作的其他项目中，我没有看到这个问题。它总是使用 obj\debug 路径来构建程序集执行路径

# iphone - iPhone - 安装固件 2.2 导致奇怪的显示行为

> ID：359907
> 
> 赞同：1
> 
> 时间：2008-12-11T16:15:02.387
> 
> 标签：iphone

我有一个 UINavigationController 包含一个用 UIView 初始化的 UIViewController。

UINavigationController 也像往常一样有一个 UINavigationBar。

以前，当我将 UIView 中的新元素定位在 0,0 时，使用

```
CGRectMake(0,0,height,width); 
```

它将直接定位在 UINavigationController 下方。但是，自从使用 2.2 编译后，它现在将 0,0 直接定位在 UINavigationBar 后面（您通常期望 0,0 位于该位置）。

这仅在使用 2.2 SDK 重新编译应用程序时发生 - 升级前留在 iPhone 上的应用程序仍按预期工作。

问题是，我非常希望我的应用程序能够正确绘制 2.2 并向后兼容 2.1

有没有人看到这种行为，或者对此有更多了解？

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-11T17:59:43.050

在 Apple 开发论坛上有一个关于 2.2 突破的完整（非常有用的）主题。它包括这个问题（尽管没有任何修复）。我在其他地方也看到过它。

值得一试

[https://devforums.apple.com/message/12297#12297](https://devforums.apple.com/message/12297#12297)（链接已修复）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-11T18:39:35.467

看来这种新行为是“有意的”行为，这是有道理的。

遗憾的是，在 2.1*和*2.2 中使我的应用程序正确呈现会很困难。

似乎如果我摆弄我的 UINavigationBar 透明/不透明设置，我会找到一些正确的错误组合，使其在两者中都正确显示。

会让你知道我的发现。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-23T05:15:41.990

从上面的链接线程：

“通过使我的导航栏不透明（以前是半透明的）来修复。我认为这可能是一个错误修复，因为在我看来，视图应该出现在半透明栏后面。”

所以是的，这似乎是预期的行为。有道理，但还是很可惜！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-06T16:49:17.517

通过执行以下操作，我能够在 2.1 和 2.2 中使用 UIBarStyleTranslucent 时使视图的定位相同：

将我的视图控制器的视图设置为我创建的自定义视图。使自定义视图扩展 UIScrollView 并在其 drawRect 方法中绘制黑色背景并将其 contentsize 设置为视图的大小。

我希望这会有所帮助 = )

# php - 使用php上传图片

> ID：359918
> 
> 赞同：-3
> 
> 时间：2008-12-11T16:16:47.127
> 
> 标签：php, file-upload

我使用此代码上传图片。我从stackoverflow得到了这段代码。我仍然无法上传图片。我更改了表设置2中的db连接设置。我制作了表，但我不确定我创建的表的属性是否正确。

```
<html>
<head><title>Store Some Binary File to a DB</title></head>
<body>

<?php
if ($submit) {
    $conn = mysql_connect("localhost", "your_username", "your_password") 
        or die ("Error connecting to database.");

    mysql_select_db("your_database", $conn) 
        or die ("error connecting to database.");

    $data = addslashes(file_get_contents($_FILES['form_data']['tmp_name'])

    $result = mysql_query ("INSERT INTO your_table ".
         "(description,bin_data,filename,filesize,filetype) ".
         "VALUES ('$form_description','$data','$form_data_name',".
         "'$form_data_size','$form_data_type')",
         $conn);

    $id = mysql_insert_id();
    print "<p>This file has the following Database ID: <b>$id</b>";

    mysql_close();

} else {
?>

    <form method="post" action="<?php echo $PHP_SELF; ?>" enctype="multipart/form-data">
    File Description:<br>
    <input type="text" name="form_description"  size="40">
    <input type="hidden" name="MAX_FILE_SIZE" value="1000000">
    <br>File to upload/store in database:<br>
    <input type="file" name="form_data"  size="40">
    <p><input type="submit" name="submit" value="submit">
    </form>

<?php

}

?>

</body>
</html> 
```

另外，帮助我从数据库中检索图像并将其显示在页面上。

你认为这现在行得通吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-12T12:28:23.380

The problem with storing images on the filesystem comes down to database replication. You would also need filesystem replication which can sometimes be harder than database replication especially when some servers may be remote.

None of your $form_ variables are set (unless theres code I cant see or you 'dangerously' have register globals on). Also you will want to addslashes (or mysql_real_escape_string) on any queries that accept REQUEST values, else your script is prone to SQL injection.

You want to:

```
$form_description = isset($_POST['form_description']) ? $_POST['form_description'] : false; 
```

The other variables are not even being posted. Do you know any HTML and PHP? this is easy to resolve but I am not writing this for you!

What we need is some feedback what the script produces.. you can get the image back by doing:

```
$result = mysql_query ("SELECT `bin_data` FROM `your_table` WHERE `id` = ".$id, $conn); 
```

Then do for example (replacing the content type with the relevant type determined from the files array):

```
$result_data = mysql_fetch_array($result, MYSQL_ASSOC);
header('Content-Type: image/jpg');
echo $result_data['bin_data'];
exit; 
```

You need to do a bit more work to that script, and that requires knowledge of HTML, PHP and MySQL.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-11T17:33:26.847

我不建议将您的二进制图像文件直接存储在数据库中。相反，将其存储在磁盘上并将文件指针（文件目录+文件名）存储在数据库中。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-11T16:27:38.167

见[http://www.php.net/manual/en/features.file-upload.php](http://www.php.net/manual/en/features.file-upload.php)

而不是使用 $form_data 作为上传文件的文件名，尝试`$_FILES['form_data']['tmp_name']`

你也可以替换相当笨拙的

```
fread(fopen($form_data, "r"), filesize($form_data)) 
```

和

```
file_get_contents($_FILES['form_data']['tmp_name']) 
```

# java - 测试类扩展依赖模块中的测试类

> ID：359921
> 
> 赞同：25
> 
> 时间：2008-12-11T16:16:59.450
> 
> 标签：java, maven-2

我在一个模块中有一个测试类，它扩展了它的一个依赖模块中的另一个测试类。如何将依赖项的测试代码导入依赖模块的测试范围？

为了不识字，我有两个模块，“模块一”是“模块二”的依赖项。`SubTestCase`是 的子类`TestCase`。

```
模块一
          \src\test\java\com\example\TestCase.java
模块二
          \src\test\java\com\example\SubTestCase.java

```

但是构建失败了，因为“模块一”的测试代码没有被导入“模块二”，只是主代码。

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2009-07-30T13:53:00.260

[您可以使用maven-jar-plugin 的 test-jar 目标](http://maven.apache.org/plugins/maven-jar-plugin/test-jar-mojo.html)将测试代码部署为附加工件。它将附加到项目中并与分类器测试一起部署。

```
 <plugin>
    <groupId>org.apache.maven.plugins</groupId>
    <artifactId>maven-jar-plugin</artifactId>
    <executions>
      <execution>
        <phase>package</phase>
        <goals>
          <goal>test-jar</goal>
        </goals>
      </execution>
    </executions>
  </plugin> 
```

然后其他项目可以通过在依赖项中声明测试分类器来引用测试 jar。

```
<dependency>
  <groupId>name.seller.rich</groupId>
  <artifactId>foo</artifactId>
  <version>1.0.0</version>
  <classifier>tests</classifier>
  <scope>test</scope>
</dependency> 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2012-09-06T11:38:16.493

关于 Rich Seller 的回答： 的使用`<classifier>tests</classifier>`已过时，请参阅[用户指南](http://maven.apache.org/guides/mini/guide-attached-tests.html)。

我正在使用 maven 2.2.1 和 maven-jar-plugin 2.2，它需要切换`<type>test-jar</type>`而不是`<classifier>tests</classifier>`.

请注意，测试 jar 不具有传递性，因此您可能需要显式添加它们。

```
<project>
    ...
    <dependencies>
        <dependency>
            <groupId>name.seller.rich</groupId>
            <artifactId>foo</artifactId>
            <version>1.0.0</version>
            <type>test-jar</type>
            <scope>test</scope>
         </dependency>
    </dependencies>
     ...
</project> 
```

**在 Mike Sokolov 评论之后更新：**
maven 3 的用户公会于 2014-03-28 更新，请参见上面的链接

> 请注意，本指南的先前版本建议使用 <classifier>tests</classifier> 而不是 <type>test-jar</type>。 虽然这目前适用于某些情况，但如果调用安装之前的生命周期阶段，它在测试 JAR 模块和任何消费者的反应器构建期间**无法正常工作。**在这种情况下，Maven 不会从反应器构建的输出中解析测试 JAR，而是从本地/远程存储库中解析。显然，存储库中的 JAR 可能已过时或完全丢失，从而导致构建失败（参见 MNG-2045）。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-12-11T17:05:19.167

通常，除了常规的 modulename.jar 文件之外，还可以通过构建和部署 modulename-test.jar 文件来解决此问题。您可以像常规工件一样将它们部署到存储库。这不是完全完美的，但对于代码工件来说工作得很好。

然后，您可以将测试范围的依赖项添加到其他模块的测试罐中。

您还可以通过将测试范围内的工件放在其自己的单独模块中的“主”范围内，然后将其包含在其他模块的常规测试范围中来解决此问题。此解决方案在每个模块导出一些测试工件的多模块构建中效果不佳，因为您基本上获得了 2N 个模块。

当我们意识到类的数量相当有限并且这两种解决方案都存在相关问题时，我们很多人实际上放弃了这两种解决方案。我们只是将它们放在“主”范围内的适当命名的包中。我只是一直忘记为什么前两个解决方案很痛苦。

# c++ - 我应该选择哪个 C++ 信号/插槽库？

> ID：359928
> 
> 赞同：39
> 
> 时间：2008-12-11T16:18:22.303
> 
> 标签：c++, boost, signals-slots

我想在不使用 QT 的项目中使用信号/插槽库。我有非常基本的要求：

1.  用任意数量的参数连接两个函数。
2.  信号可以连接到多个插槽。
3.  手动断开信号/插槽连接。
4.  体面的性能 - 应用程序是基于框架的（即不是基于事件的），我想在每个框架中使用连接。

我读过[libsigc++ 和 Boost.Signals 之间的比较](https://web.archive.org/web/20130626010123/http://www.3sinc.com/opensource/boost.bind-vs-sigc2.html)。我还读到 Boost.Signals 性能不佳。但是，我知道还有其他库，但我仍然不确定应该选择哪个库。

对信号/插槽库有什么建议吗？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-12-13T21:07:08.383

首先，无论如何都尝试使用 boost::signal 。在您尝试您的应用程序的特定情况之前，不要认为它不够快

如果它不够高效，也许像[FastDelegate](http://www.codeproject.com/KB/cpp/FastDelegate.aspx)这样的东西会满足您的需求？（我没有尝试过，但听说在 boost::signal 似乎不适合的某些情况下这是一个不错的解决方案）。

无论如何，如果在您的应用程序中每帧都使用信号，则可能值得用更简单的东西替换信号系统，例如保存将在每帧调用的对象/函子的容器。信号更多地允许即时“事件”管理，而不是使循环周期动态化（允许更改调用每个帧的函数）。（我有[自己的解决方案](https://github.com/Klaim/gamecore/blob/master/GCore/GC_TaskManager.h)（更新：它现在非常古老且过时），我在游戏中大量使用，例如我对性能没有问题，所以也许类似的东西可能会有所帮助）。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-09-11T22:34:11.277

Gamedev.net 表单上[非常非常快速的事件库](http://www.gamedev.net/topic/456646-very-very-fast-event-library)

> 在分析我最近一直在处理的一些代码时，看到 boost::signals 函数浮动到顶部，我感到惊讶和沮丧。对于那些不知道的人，boost::signals 是一个非常有用的信号/槽库，它可以与 boost::bind 一起用于基于委托的事件处理，例如在 C# 中看到的。它健壮、功能丰富且灵活。它也是，我了解到，令人难以置信的，可怕的缓慢。对于很多使用 boost::signals 的人来说，这很好，因为他们很少调用事件。我在每个对象的每帧调用几个事件，结果可预测。
> 
> 所以我自己写了。灵活性和功能性稍差。它针对每个人实际使用事件的方式进行了优化。而且事件调用比 boost::signals 快十五到八十倍。

见链接

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-09-11T22:30:07.563

你列出的两个是我所知道的唯一两个值得的。我所看到的一切都表明 libsigc++ 在性能方面表现出色。正如您在比较中看到的那样，在某些情况下 boost 的语法更漂亮一些，但只是一点点。

我个人使用过 libsigc++ 并且对它很满意。Libsigc++ 似乎被更多的项目使用。快速浏览一下我的包管理器，列出了 100 多个依赖于 libsigc++2 的项目。在我看来，仅这一点就足以使平衡倾斜，特别是考虑到性能优势和缺乏其他显着差异。

我说 libsigc++2。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2014-08-28T16:54:31.757

最近继承了一个项目，该项目`connect`为我们的项目目标产生了过多的开销。分析显示在信号中使用了互斥锁，鉴于我们的信号使用情况，这是不需要的。[根据文档](http://www.boost.org/doc/libs/1_56_0/doc/html/signals2/tutorial.html#signals2.tutorial.signal-mutex-template-parameter)成功替换为虚拟互斥锁。互斥锁“非常慢”，因此请确保您需要它。这可能对其他浏览这篇文章的人有用。

原来的 `typedef boost::signals2::signal_type<void()>::type signal_type;`

新的 `typedef boost::signals2::signal_type<void(), boost::signals2::keywords::mutex_type<boost::signals2::dummy_mutex> >::type signal_type;`

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2010-12-30T09:39:14.427

我会投票给[Sigslots](http://sigslot.sourceforge.net/)，我尝试了其他几个替代方案（boost、libsig++、Fas​​tDelegates），但似乎没有一个能做到*我*想要的：以匿名方式将函数绑定在一起，并自动断开对象销毁。

Sigslots 对我们来说很棒，因为它是完全可读的 C++，它快速、简单，并且可以在不妨碍工作的情况下完成工作。一件小事，如果您想从多个库中使用它，您可能需要添加：

```
COREEXTERN template class COREIMPEXP has_slots<SIGSLOT_DEFAULT_MT_POLICY>; 
```

以避免与已定义对象相关的链接问题。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-12-11T16:57:07.247

我以前使用过 libsigc++，它非常简单。我认为它不会对性能造成太大影响，而且实际上我学会了喜欢在一些地方使用插槽而不是函数指针。

需要注意的一件事是，截至我上次使用它时（2 多年前），它被限制为最多六个参数通过连接传递。

我对 boost 库没有任何经验，所以我无法帮助你。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2013-12-08T04:43:39.650

我使用了 boost signals2 库，它非常慢。在构造带有升压信号的对象时，升压信号堆栈消耗了 99% 的处理器时间。在使用单个simle slot 发出的信号上，它也有非常大的开销。我尝试了 libsigc++，它明显更快。Libsigc++ 似乎非常快速和灵活地创建 40000 个对象，具有 9 个升压信号和 9 个 libsigc++ 信号：
![](https://i.stack.imgur.com/Ltpjq.png)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2010-01-07T14:48:02.237

我没有使用 libsig++，但我已经阅读了它。我之前对信号和插槽的经验来自 Qt，还有一点来自 Boost。如果您没有可用的任何一个，那么您可以尝试我自己的信号和插槽库（ksignals），它既适用于嵌入式代码（无动态内存分配），也适用于“普通”c++ 代码（连接时的动态内存分配）。

您可以在以下网址找到它：www.kjellkod.cc/signalandslots

在该页面上，您还可以找到一个比较：KSignals Vs Boost 信号。

速度虎钳 ksignals 非常快速且非常轻量级的代码。它应该非常易于使用、理解，并在需要时对其进行修改。

祝你好运 问候 Kjell H

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2010-03-11T13:32:45.193

要考虑的另一种 sig-slot 实现：

[http://code.google.com/p/ting/wiki/SignalSlotUsage](http://code.google.com/p/ting/wiki/SignalSlotUsage)

它不假装是最好的，但仍然是另一个有权存在的人。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2014-09-04T21:56:53.897

另一个选项可以是[YSignalSlot](https://github.com/yigityuce/YSignalSlot)。我用过。我觉得还不错。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2014-11-26T17:08:59.940

这个看起来不错的替代实现怎么样：http: [//endl.ch/content/fastsig](http://endl.ch/content/fastsig)？

# c# - 在 C# 中使用泛型方法编译错误

> ID：359931
> 
> 赞同：0
> 
> 时间：2008-12-11T16:18:36.000
> 
> 标签：c#, generics

编辑：我发现如果我将 IMetadataType 对象转换为 TMetadata 类型，我可以编译它。为什么我需要这样做？

编辑#2：“值”属性是一个 <TMetadata, TData> 类型的 .NET 字典。

我有这个通用方法：

```
private void FillMetadata<TMetadata, TData>
    (Metadata<TMetadata, TData> oMetadata) where TMetadata : IMetadataType
{
    IMetadataType o;
    oMetadata.Values.Add(o, (TData)(object)GetValue());
} 
```

我已经剥离了实现以简化它（我实际上使用了一个真实的对象，而不是此处声明的 IMetadataType）。

我的问题是，为什么不编译？编译错误出现在 Add() 方法上：“无法从 'IMetadataType' 转换为 'TMetadata'。” 这不就是方法上的“where”子句的用途吗？

我错过了什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-11T16:20:43.123

.Add 方法是如何声明的？

好的，如果 .Add 方法需要一个 TMetadata，你不能指望它接受一个 IMetadataType，因为你说 TMetadata 是一个 IMetadataType，而不是相反。

基本上，就编译器所知，您可以尝试添加与 TMetadata 完全不同的东西，而您实现通用接口这一事实并不重要。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-11T16:26:33.567

`where TMetadata : IMetadataType`是泛型类型参数的一个约束，表示`TMetadata`它应该派生自`IMetadataType`. 由于`oMetadata`仅知道`TMetadata`并且`TData`作为要使用的类型，因此您必须在方法体中使用它们。这应该有效：

```
private void FillMetadata<TMetadata, TData>(Metadata<TMetadata, TData> oMetadata) 
    where TMetadata : IMetadataType
{
    TMetadata o;
    oMetadata.Values.Add(o, (TData)(object)GetValue());
} 
```

# .net - 如何向 IronPython 中定义的方法和类型添加属性？

> ID：359933
> 
> 赞同：1
> 
> 时间：2008-12-11T16:18:47.137
> 
> 标签：.net, attributes, ironpython

由于 IronPython 不支持属性，我想知道是否有另一种方法来装饰 IronPython 类的属性，也许是反射？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2010-08-22T23:41:08.647

我不确定这是否是您要查找的内容，但 clrtype 允许您使用属性。

```
import clr
import clrtype
from System.Runtime.InteropServices import DllImportAttribute
import System

class PInvoke(object):

    __metaclass__ = clrtype.ClrClass
    DllImport = clrtype.attribute(DllImportAttribute)

    @staticmethod
    @DllImport("user32.dll")
    @clrtype.accepts(System.UInt32)
    @clrtype.returns(System.Boolean)
    def MessageBeep(beepType): raise RuntimeError("Something went wrong.")

PInvoke.MessageBeep(0) 
```

我不确定它是否适用于课程。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-11T23:43:50.267

一种，虽然丑陋且有时不切实际，但解决方法是在 C# 中创建一个存根类并用属性装饰它并从 IronPython 中派生。

# sql - 为大型表更新表架构的最佳方法 (SQL Server)

> ID：359934
> 
> 赞同：4
> 
> 时间：2008-12-11T16:19:01.397
> 
> 标签：sql, sql-server, sql-server-2005, tsql

我在生产 SQL 2005 数据库上有几个需要模式更新的大表。这主要是添加了具有默认值的列，以及一些需要一些简单转换的列类型更改。整个事情可以通过一个简单的“SELECT INTO”来完成，其中目标是具有新模式的表。

到目前为止，我们的测试表明，即使是这个完全在服务器内部完成的简单操作（不获取或推送任何数据），在具有数百万行的表上也可能需要数小时甚至数天。

此类表是否有更好的更新策略？

编辑 1：我们仍在试验，没有明确的结论。如果我对新表的转换之一涉及将每五行合并为一行，会发生什么情况。每次转换都必须运行一些代码。我们可以在这方面获得的最佳性能让我们以至少需要几天时间来转换 30M 行表的速度

在这种情况下使用 SQLCLR（使用在服务器内部运行的代码进行转换）会给我带来很大的速度提升吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-11T16:23:03.713

您是立即应用索引，还是在第二步应用索引？在构建过程中没有索引的情况下应该会更快。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-11T16:32:04.710

您是否尝试过使用 alter table 而不是将数据移动到新表？为什么你会使用 Select into？只需更改您当前的结构。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-11T17:21:03.050

我们有一个类似的问题，我发现最快的方法是将数据导出到分隔文件（在块中 - 取决于行的大小 - 在我们的例子中，每个文件有 500,000 行），做任何在导出期间进行转换，删除并使用新架构重新创建表，然后从文件执行 bcp 导入。

一个 3000 万行的表使用该方法需要几个小时，而一个 alter table 需要 30 多个小时。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-11T17:22:25.060

添加允许 null 的列，然后手动更新默认值，然后重新更改表以添加默认值。通过这种方式，您可以控制更新并以较小的块进行更新。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-11T17:37:16.870

我有一个类似的声音问题，它经常发生。

我们的数据库缓存了远程存储过程的结果，该过程偶尔会扩展新字段。

该表有数百万行（现在多达大约 80 个字段），带有几个索引，并且使用过 #temp 表等（甚至使用 bcp 到临时文件）；我使用 select into a new table 选项：

*   创建具有新结构的新表
*   对该表进行选择
*   丢掉原来的
*   将新表重命名为旧表名

# c# - 可以使用 Pulse & Wait 吗？或者它是邪恶的并且是只写代码的原因？

> ID：359935
> 
> 赞同：0
> 
> 时间：2008-12-11T16:19:13.300
> 
> 标签：c#, .net, multithreading, synchronization

`Monitor.Pulse/All`并且`Monitor.Wait`是有用的方法，但是我抱怨说，当大量使用它们时（我有一个 DSL 设计器将它们吐出一打），生成的代码变得不可读。你怎么看？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-11T17:10:57.407

如果它散布在您实际必须阅读的代码上，那可能是个问题。为什么它一开始就经常出现？功能实际上可以封装在其他地方吗？

从根本上说，Wait/Pulse 没有任何问题——但就像生活中的其他一切一样，如果使用不当，它就会成为一个问题。不看代码就很难判断你的使用是否不当:(

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-11T17:25:21.277

我真的建议不要使用这种方法 - 来自 PulseEvent 的 MSDN 页面：

> 等待同步对象的线程可以通过内核模式 APC 暂时从等待状态中移除，然后在 APC 完成后返回等待状态。如果对 PulseEvent 的调用发生在线程已从等待状态中移除的时间内，则不会释放线程，因为 PulseEvent 仅释放在调用它时正在等待的那些线程。因此，**PulseEvent 不可靠，不应被新应用程序使用**。相反，使用条件变量。

现在，Monitor.Pulse 可能使用 PulseEvent 以外的东西编写，但整个概念存在很大缺陷 - 正确使用锁和条件变量。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-12-11T17:19:15.707

听起来像是应该通过注入作为方面进行编码的东西。但是，我对 C# 中 AOP 支持的了解可以忽略不计，因此我无法提供更多信息。

# c# - 如何将 ANSEL 文本转换为 UTF-8

> ID：359942
> 
> 赞同：3
> 
> 时间：2008-12-11T16:21:08.257
> 
> 标签：c#, encoding

如何在 C# 中将 ANSEL 编码的文本更改为 UTF-8？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-11T16:31:15.537

这是一个重要的转换，因为 Windows/.NET Framework 没有 ANSEL 代码页。请参阅[此处](http://www.heiner-eichmann.de/gedcom/charintr.htm)了解另一个尝试此转换的人的艰辛。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-17T00:34:19.040

乔什佩里是正确的。Eichmann 的网站基本上是唯一试图解释 ANSEL 编码的文档。不幸的是，那里没有程序代码，因此您必须自己编写代码。

ANSEL 还有另一个代码表（日期为 2007 年 12 月 - 我不知道还有人感兴趣），网址为：http: [//lcweb2.loc.gov/diglib/codetables/45.html](http://lcweb2.loc.gov/diglib/codetables/45.html)，值得将 Eichmann 的工作与之进行比较，因为他确实承认有一些他不确定的代码。

如果您从家谱的角度感兴趣，GEDCOM 标准版本 5.5[在其附录 D 中](http://homepages.rootsweb.ancestry.com/~pmcbride/gedcom/55gcappd.htm)有一个缩写的 ANSEL 字符集和一些编码。

* * *

2017 年 9 月更新：在我最初回答这个问题很久之后，Tamura Jones 写了一系列关于 ANSEL 的优秀文章，值得一看：

*   [GEDCOM ANSEL 表](https://www.tamurajones.net/GEDCOMANSELTable.xhtml)- 2013 年 5 月 14 日
*   [LDS ANSEL 与 LDS ANSEL](https://www.tamurajones.net/LDSANSELVersusLDSANSEL.xhtml) - 2013 年 5 月 18 日
*   [ANSEL 行政撤回](https://www.tamurajones.net/ANSELAdministrativelyWithdrawn.xhtml)- 2013 年 7 月 8 日

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-08-22T17:42:24.623

[在http://sourceforge.net/projects/gedcom-net/](http://sourceforge.net/projects/gedcom-net/)有一个 AnselEncoding 类（源自标准 Encoding 类）作为 Gedcom.NET 的一部分，它还包括对一些 LDS 扩展的支持。

# wmi - WMI 和计算机电源设置 - 上次退出待机的日期/时间

> ID：359957
> 
> 赞同：0
> 
> 时间：2008-12-11T16:25:24.597
> 
> 标签：wmi, power-management

我试图找出上次计算机退出待机/休眠状态的时间。我知道我可以通过观看 Win32_PowerManagementEvent 来获得它，但在这种情况下这不起作用，因为我需要一些我可以轮询的东西 - 有什么想法吗？它不一定是 WMI，我只是假设它会在那里。

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-11T17:17:29.267

实际上，正如通常发生的那样，我一发布它就想到了这一点。

因此，为了观察计算机何时退出待机状态，即 Win32_PowerManagementEvent 中的 EventType 7，我使用了 Powershell。

```
Register-WmiEvent -query "Select * From Win32_PowerManagementEvent where EventType=7" -messagedata "Power Management Resume" -sourceidentifier "Resume" 
```

然后我进入并退出待机状态，然后执行 Get-PSEvent，它显示了我创建的事件。我本来可以使用 -action 来分配一个脚本块以在该事件发生时运行，但我正在寻找要轮询的东西。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2021-08-01T09:27:00.027

Awesome, thank you for this solution! I managed to get my script working using yours as a template. I can just run this using Task Scheduler.

```
Register-WMIEvent -query "Select * From Win32_PowerManagementEvent where EventType=4" `
 -sourceIdentifier "Action Before Sleep" `
 -action {
    write-host "Sleeping time!"
    nircmd.exe speak text "Remember Keyboard cover"
      }

#Get-EventSubscriber
#unregister-Event -subscriptionid 3 
```

# c# - 为部分 utf8 编码的 URL 查找解析 API

> ID：359959
> 
> 赞同：8
> 
> 时间：2008-12-11T16:25:31.943
> 
> 标签：c#, .net, uri

在为某些网页（尤其是任何 Windows 实时页面）解析 HTML 时，我会遇到很多以下格式的 URL。

http\x3a\x2f\x2fjs.wlxrs.com\x2fjt6xQREgnzkhGufPqwcJjg\x2fempty.htm

这些似乎是部分 UTF8 转义字符串（\x2f = /、\x3a=: 等……）。是否有可用于将这些字符串转换为 System.Uri 的 .Net API？似乎很容易解析，但我试图避免今天建造一个新轮子。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-09-14T13:54:27.623

您发布的内容不是有效的 HTTP。这样，当然`HttpUtility.UrlDecode()`行不通。但不管怎样，您可以将其转回正常文本，如下所示：

```
string input = @"http\x3a\x2f\x2fjs.wlxrs.com\x2fjt6xQREgnzkhGufPqwcJjg\x2fempty.htm";
string output = Regex.Replace(input, @"\\x([0-9a-f][0-9a-f])",
    m => ((char) int.Parse(m.Groups[1].Value, NumberStyles.HexNumber)).ToString()); 
```

但请注意，这是假设编码是 Latin-1 而不是 UTF-8。您提供的输入在这方面没有定论。如果需要 UTF-8 才能工作，则需要稍长的路由；您必须将字符串转换为字节并将转义序列替换为进程中的相关字节（可能需要一个 while 循环），然后`Encoding.UTF8.GetString()`在生成的字节数组上使用。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-01-11T21:02:12.517

这是另一个解决方案：（从@timwi解决方案继续）

```
string output = Regex.Replace(input, @"\\x([0-9a-f][0-9a-f])",
            m => ((char)Convert.ToInt32(m.Groups[1].Value, 16)).ToString()); 
```

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-12-11T17:59:11.723

你试过[HttpUtility.UrlDecode](http://msdn.microsoft.com/en-us/library/system.web.httputility.urldecode.aspx)吗？

# java - Apache POI 单词支持有多好？

> ID：359970
> 
> 赞同：2
> 
> 时间：2008-12-11T16:29:40.547
> 
> 标签：java, apache, ms-word, ms-office

在网页上，旧样式的 .doc 似乎没有当前的开发。

*   是否足以创建复杂的文档？
*   它可以读取所有 .docs 而不会崩溃吗？
*   哪些功能（不）起作用？

我目前对基于 XML 的格式不感兴趣，因为我不控制客户端。

excel支持似乎要好得多。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-24T21:23:16.983

如果您正在寻找以编程方式读取或写入 doc 文件，我相信您最好使用远程 OpenOffice 或 StarOffice。我们在一家前公司做过这个，尽管这是一个相当繁重的解决方案，但效果很好。OpenOffice（紧跟 Word 之后）有非常好的文档支持。对于远程处理，它比 Word 本身要好得多。在上述公司，我们（早期）过去常常远程控制 Word 经常出现问题，因为 Word（在保存文档时）坚持不时显示警告对话框。在某个数据中心深处的服务器上，没有人靠近它，这是个坏主意。

由于这是一家 Java 商店，因此非常好的 OpenOffice 对 Java 的支持就派上用场了。事实上，他们甚至曾经捆绑了商业版 StarOffice，并且在 Sun 有一些很好的联系和帮助。

免责声明：正如 andHapp 和 alepuzio 所说，POI 在 Excel 支持方面非常出色，我使用它取得了巨大成功。上次我看到文档支持时，我不敢在生产中使用它（对于客户）。我至少有两年没有看过文档支持了。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-12T11:02:03.860

我已经使用 Apache POI 来读取和写入 Excel 文件 (.xls)，它就像一个魅力。有一些问题，但我找到了简单的解决方法，所以我认为 word 文档也是一样的。您遇到的唯一问题是读取和写入 .docx（在我的情况下为 .xlsx）格式，因为 Apache POI 尚不支持它们。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-15T15:48:23.893

这取决于你的目标。我用 POI 编写 Excel 格式的报告，简单的报告也可以，因为简单操作的代码很多。我编写了一些用于重复任务的实用方法。如果您为 java =>1.5 编写代码，您可以尝试 JXLS（扩展 POI 并使用 XML/XSLT 技术）。

# c# - 从映射驱动器或共享文件夹运行 .NET 程序

> ID：359978
> 
> 赞同：7
> 
> 时间：2008-12-11T16:31:11.480
> 
> 标签：c#, .net, unc

我编写了一个 C# Windows Forms 应用程序，用于将一台机器上远程文件夹中的文件和文件夹（“源”文件夹是一个映射驱动器 - “Z:\folder”）与另一台机器上的另一个远程文件夹（“目标”文件夹是共享文件夹的 UNC 路径 - “\\computername\sharedfolder”）。我对这两个文件夹都有完全权限。当我在本地计算机上运行该程序时，它工作正常，但是当我尝试从源文件夹中运行它时，它会因安全异常而失败。

为目标文件夹（即 DirectoryInfo(@"\\computername\sharedfolder") 调用 DirectoryInfo 构造函数时发生故障。我认为问题是因为我正在从映射驱动器运行程序。有解决方法吗？

* * *

具体的例外是：请求“System.Security.Permissions.FileIOPermission, mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089”类型的权限失败。

* * *

**更新**

好的，我将我的应用程序放入 Visual Studio 2008（之前在 2005 年编码），针对 .NET 3.5 框架，编译并再次尝试。

我得到了完全相同的错误。

* * *

**更新 - 解决方案**

我用 .NET 3.5 尝试过，但没有用，然后我注意到你说的是 3.5 SP1。肯定需要该服务包。

问题解决了。谢谢你。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-11T16:36:45.433

[.NET 3.5 SP1 允许在网络共享之外运行应用程序](http://blogs.msdn.com/vancem/archive/2008/08/13/net-framework-3-5-sp1-allows-managed-code-to-be-launched-from-a-network-share.aspx)。以前的版本不允许这样做。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-11T16:45:05.120

您需要为应用程序启用 FullTrust 权限。在网络共享上运行的 .NET 应用程序被授予本地 Intranet 安全权限，因此在沙箱中运行。

这是我为我们的一个在网络外运行的测试应用程序编写的批处理文件。它应该可以让您在稍作修改的情况下启动并运行。

```
@ECHO OFF
SET CASPOL=%windir%\Microsoft.NET\Framework\v2.0.50727\CasPol.exe
CLS

%CASPOL% -pp off
%CASPOL% -m -ag 1.2 -url file://server/directory/* FullTrust 
```

如上所述，.NET 3.5 删除了这种行为。

# asp.net - 如何在公历中显示阿拉伯日期？

> ID：359986
> 
> 赞同：5
> 
> 时间：2008-12-11T16:32:27.140
> 
> 标签：asp.net, vb.net, localization, arabic

我有一个多语言的 ASP.NET 站点；其中一种语言是阿拉伯语（ar-SA）。要在文化之间切换，我使用以下代码：

```
Thread.CurrentThread.CurrentCulture = CultureInfo.CreateSpecificCulture(Name)
Thread.CurrentThread.CurrentUICulture = New CultureInfo(Name) 
```

例如，当显示一篇文章的日期时，我只是这样做，本地化 API 会处理所有事情：

```
<%#Eval("DatelineDate","{0:d MMMM yyyy}")%> 
```

问题是它使用 Hijiri（伊斯兰）日历显示日期（例如，2008 年呈现为 1429）。客户希望使用公历显示日期（当然，仍然用阿拉伯语呈现月份名称和其他所有内容）。我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-12-11T17:20:38.137

## 回答：

原来 ar-SA 文化是唯一使用 Hijiri 日历的文化；所有其他阿拉伯文化都使用公历。以下是阿拉伯语的不同日期格式（有点混乱，因为 WMD 不支持似乎支持 RTL 文本）。

```
ar-AE 11 ديسمبر 2008 
ar-BH 11 ديسمبر 2008 
ar-DZ 11 ديسمبر 2008 
ar-EG 11 ديسمبر 2008 
ar-IQ 11 كانون الأول 2008 
ar-JO 11 كانون الأول 2008 
ar-KW 11 ديسمبر 2008 
ar-LB 11 كانون الأول 2008 
ar-LY 11 ديسمبر 2008 
ar-MA 11 دجنبر 2008 
ar-OM 11 ديسمبر 2008 
ar-QA 11 ديسمبر 2008 
ar-SA 13 ذو الحجة 1429 
ar-SY 11 كانون الأول 2008 
ar-TN 11 ديسمبر 2008 
ar-YE 11 ديسمبر 2008 
```

值得一提的是我用来生成这个列表的快速而肮脏的代码：

```
 Response.Write("<table width=300px>")
    For Each ci As CultureInfo In (From c As CultureInfo In CultureInfo.GetCultures(CultureTypes.AllCultures) Order By c.Name Where c.Name.StartsWith("ar-"))
        Thread.CurrentThread.CurrentCulture = CultureInfo.GetCultureInfo(ci.Name)
        Thread.CurrentThread.CurrentUICulture = New CultureInfo(ci.Name)
        Response.Write(String.Format("<tr><td>{0}</td> <td style='direction:rtl;font-size:20px;'>{1:d MMMM yyyy}</td></tr>", ci.Name, Today))

    Next
    Response.Write("</table>")
    Response.End() 
```

更多文化请访问[http://www.massimilianobianchi.info/max/articles/22/UI-culture-list-and-codes.aspx](http://www.massimilianobianchi.info/max/articles/22/UI-culture-list-and-codes.aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-25T04:38:16.137

您可以只使用另一个阿拉伯语语言环境，它们之间的唯一区别是日期格式......

# c++ - S60 应用程序 - Symbian C++ - 退出按钮不起作用

> ID：359992
> 
> 赞同：2
> 
> 时间：2008-12-11T16:34:04.580
> 
> 标签：c++, symbian, exit, s60, carbide

在我的 Symbian S60 应用程序中，我的选项菜单按预期工作。但是退出按钮什么也不做。

我正在使用 Carbide 进行开发，并使用 UI Designer 将项目添加到选项菜单中。

有谁知道如何启用退出按钮，或者为什么它可能不起作用？

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-11T16:46:33.180

您是否正在处理（在您的`appui::HandleCommandL`）命令 ID`EEikCmdExit`和`EAknSoftkeyExit?`

```
 if ( aCommand == EAknSoftkeyExit || aCommand == EEikCmdExit )
        {
        Exit();
        } 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-11T16:49:21.677

您是否查看过应用程序类的`HandleCommandL( TInt aCommand )`方法`AppUi`？例如，在我使用 Carbide 创建的所有 UI 项目中，`HandleCommandL()`方法中会自动显示以下内容：

```
void MyAppUi::HandleCommandL( TInt aCommand )
{
    TBool commandHandled = False;
    switch ( aCommand )
    {
        default:
            break;
    }

    if ( !commandHandled )
    {
        if ( aCommand == EAknSoftkeyExit || aCommand == EEikCmdExit )
        {
            Exit();
        }
     }
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-11T17:15:54.120

您使用的是什么 CBA 资源（软键按钮布局）？`R_AVKON_OPTIONS_EXIT`? 您是否以任何其他方式处理退出命令？还是您在`Exit()`接听电话？你甚至收到`EEikCmdExit`代码？如果你有[`commandHandled`布尔值](https://stackoverflow.com/questions/359992/s60-application-symbian-c-exit-button-doesnt-work#360044)，它是否设置为`EFalse`？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-11T17:19:55.190

我的主视图中正在处理命令

所以我把它改成了这个......

```
void CMyContainerView::HandleCommandL( TInt aCommand )
    {

    TBool commandHandled = EFalse;
    switch ( aCommand )
        {   
                // ...
        default:
            break;
        }

    if ( !commandHandled ) 
        {
            AppUi()->HandleCommandL(aCommand);
        }

    } 
```

谢谢大家:)

# java - 是否有在 Swing 中生成 CRUD UI 的工具或框架？

> ID：359993
> 
> 赞同：11
> 
> 时间：2008-12-11T16:34:29.073
> 
> 标签：java, swing, user-interface, crud

我正在寻找一个工具/框架来（自动）生成一个 Swing 用户界面来对底层数据库执行 CRUD 操作。

我还想配置应该公开的数据库字段。类似于 django（通过[modelforms](http://docs.djangoproject.com/en/dev/topics/forms/modelforms)）或 ruby​​ on rails 功能，但在 Java 桌面环境中。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2011-11-09T17:01:12.700

看看以下工具：

MetaWidget [http://www.metawidget.org/](http://www.metawidget.org/)

[阿帕奇伊希斯](http://isis.apache.org/)

它们会“即时”生成 UI，但允许您在必要时自定义 UI。

比代码生成好得多。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-12T07:15:52.863

NetBeans 似乎是一个显而易见的答案。这些人制作了一个 NetBeans 插件来做到这一点： [http ://www.morelisland.com/java_services/netbeans_tutorial/midbmetadata_se.htm](http://www.morelisland.com/java_services/netbeans_tutorial/midbmetadata_se.htm)

我听说 jgoodies 做了类似的事情： [http ://www.jgoodies.com/products/index.html](http://www.jgoodies.com/products/index.html)

更具体地说，他们的子项目 Binding： [https ://binding.dev.java.net/](https://binding.dev.java.net/)

我对 SwingLabs 数据绑定项目知之甚少，但它看起来值得研究： [https ://databinding.dev.java.net/](https://databinding.dev.java.net/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-12T07:08:45.657

我正在使用 Netbeans（最新）。我想它与 Django 相去甚远（还没有尝试过，但据我了解，它有点像 rails/symfony），但它确实对数据库进行了逆向工程，并为您提供了一个基本应用程序，包括主/详细视图。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2019-11-19T11:15:01.760

您可以使用 hibernate 来生成映射，并使用 Djf 在 Swing 组件上查看这些映射。桌面 Java 表单位于：[https ://github.com/smart-flex/Djf](https://github.com/smart-flex/Djf)

但是，不幸的是，生成 Swing 用户界面来执行 CRUD 操作并不是完全自动化的方式。********************************