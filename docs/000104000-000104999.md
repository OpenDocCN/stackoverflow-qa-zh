# StackOverflow 问答 104000-104999

# c++ - 如何在 VC6 监视窗口中获取变量的完整字符串值？

> ID：104009
> 
> 赞同：6
> 
> 时间：2008-09-19T17:44:49.427
> 
> 标签：c++, debugging, visual-c++-6

我想在 VC6 监视窗口中获取 char[] 变量的完整值，但它只显示截断版本。我可以从调试内存窗口复制值，但其中包含混合行的十六进制和字符串值。肯定有更好的方法吗？？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-19T18:46:07.767

对于大字符串，您几乎被内存窗口卡住了——工具提示最终会被截断。

幸运的是，内存窗口很容易从中获取数据 - 我倾向于以 8 字节块的形式显示它，因此它易于管理，找到您的字符串数据并将该批次剪切并粘贴到空白窗口中，然后使用 alt+drag 选择列并删除十六进制值。然后从字符串的底部开始并不断向上翻页/删除（换行符）以构建您的字符串（我为该位使用宏）。

一旦你得到长字符串，我认为没有更好的方法。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-19T17:48:31.400

推来推去你可以把手表

给定

```
char bigArray[1000]; 
```

手表：

```
&bigArray[0]
&bigArray[100]
&bigArray[200]
... 
```

或更改要查找的字符串中的索引...

它很笨重，但它在过去对我有用。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-19T18:29:26.433

我没有VC6了，所以我不能尝试。我不知道它是否有效，但也许你可以输入

```
(char*)textArray; 
```

在监视窗口中。

**更好的解决方案可能**是：VS2008 会自动以您想要的方式显示文本。并且有一个免更改的VS2008 Express Edition，据我所知，可以用来开发商业应用程序。您甚至可以尝试继续使用 VC6 进行开发，仅使用 VS2008 进行调试。使用 VS2003 是可能的。大约 5 年前，我不得不维护一个使用 VC6 开发的应用程序。我一直使用 VC6 进行开发，但调试时我使用了 VS2003。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-19T21:54:51.933

我见过的唯一技术是观察字符串，然后观察字符串 + 50、+ 100 等。

Eugene Ivakhiv 为 msvc 6 编写了一个[插件](http://www.codeguru.com/cpp/v-s/devstudio_macros/debugging/article.php/c5989/)，可让您在编辑框中显示完整的字符串。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-06-26T21:54:28.780

VC6 有一个可爱的插件，叫做[XDebug](http://www.codeguru.com/cpp/v-s/devstudio_macros/debugging/article.php/c5989/StringWatch-Addin-for-Visual-C-60.htm)。它添加了一个用于查看不同类型字符串的对话框。它对我很有用。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-19T20:15:01.593

也许，习惯于创建日志文件，并直接将输出写入文件，然后在您最喜欢的文本编辑器中打开。

# javascript - 在 Javascript 中本地化字符串

> ID：104022
> 
> 赞同：42
> 
> 时间：2008-09-19T17:46:28.083
> 
> 标签：javascript, .net, localization, resx

我目前正在使用`.resx`文件来管理 .NET 的服务器端资源。

我正在处理的应用程序还允许开发人员将 JavaScript 插入到各种事件处理程序中以进行客户端验证等。对我来说本地化 JavaScript 消息和字符串的最佳方法是什么？

理想情况下，我想将字符串存储在`.resx`文件中，以将它们与其他本地化资源一起保存。

我愿意接受建议。

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-09-19T17:53:07.007

一个基本的 JavaScript 对象是一个关联数组，因此它可以很容易地用于存储键/值对。因此，使用[JSON](http://www.json.org)，您可以为每个要本地化的字符串创建一个对象，如下所示：

```
var localizedStrings={
    confirmMessage:{
        'en/US':'Are you sure?',
        'fr/FR':'Est-ce que vous êtes certain?',
        ...
    },

    ...
} 
```

然后你可以像这样得到每个字符串的语言环境版本：

```
var locale='en/US';
var confirm=localizedStrings['confirmMessage'][locale]; 
```

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-09-19T18:06:52.777

受[SproutCore](http://www.sproutcore.com/)启发您可以设置字符串的属性：

```
'Hello'.fr = 'Bonjour';
'Hello'.es = 'Hola'; 
```

然后根据您的语言环境简单地吐出正确的本地化：

```
var locale = 'en';
alert( message[locale] ); 
```

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2013-02-08T22:15:01.563

在谷歌搜索了很多并且对提供的大多数解决方案不满意之后，我刚刚找到了一个使用[T4 模板](http://www.leniel.net/2011/06/c-code-with-preprocessed-t4-templates.html)的惊人/通用解决方案。您可以在此处阅读[Jochen van Wylick](http://www.blogger.com/profile/01681886305363941109)的完整帖子：

[使用 T4 本地化基于 .resx 文件的 JavaScript 资源](http://jiffie.blogspot.com.br/2012/11/localized-javascript-resources-based-on.html)

主要优点是：

1.  只有 1 个管理资源的地方（即 .resx 文件）
2.  支持多种文化
3.  利用 IntelliSense - 允许代码完成

缺点：

> 这个解决方案的缺点当然是 .js 文件的大小可能会变得非常大。但是，由于它被浏览器缓存，我们不认为这对我们的应用程序来说是个问题。但是 - 这种缓存也可能导致浏览器找不到从代码调用的资源。

* * *

**这是如何工作的？**

基本上，他定义了一个指向您的 .resx 文件的 T4 模板。使用一些 C# 代码，他遍历每个资源字符串并将其添加到 JavaScript 纯键值属性，然后在一个名为的 JavaScript 文件中输出`Resources.js`（如果您愿意，可以调整名称）。

* * *

**T4 模板**[相应更改以指向您的 .resx 文件位置]

```
<#@ template language="C#" debug="false" hostspecific="true"#>
<#@ assembly name="System.Windows.Forms" #>
<#@ import namespace="System.Resources" #>
<#@ import namespace="System.Collections" #>
<#@ import namespace="System.IO" #>
<#@ output extension=".js"#>
<#
 var path = Path.GetDirectoryName(Host.TemplateFile) + "/../App_GlobalResources/";
 var resourceNames = new string[1]
 {
  "Common"
 };

#>
/**
* Resources
* ---------
* This file is auto-generated by a tool
* 2012 Jochen van Wylick
**/
var Resources = {
 <# foreach (var name in resourceNames) { #>
 <#=name #>: {},
 <# } #>
};
<# foreach (var name in resourceNames) {
 var nlFile = Host.ResolvePath(path + name + ".nl.resx" );
 var enFile = Host.ResolvePath(path + name + ".resx" );
 ResXResourceSet nlResxSet = new ResXResourceSet(nlFile);
 ResXResourceSet enResxSet = new ResXResourceSet(enFile);
#>

<# foreach (DictionaryEntry item in nlResxSet) { #>
Resources.<#=name#>.<#=item.Key.ToString()#> = {
 'nl-NL': '<#= ("" + item.Value).Replace("\r\n", string.Empty).Replace("'","\\'")#>',
 'en-GB': '<#= ("" + enResxSet.GetString(item.Key.ToString())).Replace("\r\n", string.Empty).Replace("'","\\'")#>'
 };
<# } #>
<# } #> 
```

**在表单/视图端**

要获得正确的翻译，如果您使用 WebForms，请将其添加到您的主文件中：

```
<script type="text/javascript">

    var locale = '<%= System.Threading.Thread.CurrentThread.CurrentCulture.Name %>';

</script>

<script type="text/javascript" src="/Scripts/Resources.js"></script> 
```

如果你使用 ASP.NET MVC（像我一样），你可以这样做：

```
<script type="text/javascript">

    // Setting Locale that will be used by JavaScript translations
    var locale = $("meta[name='accept-language']").attr("content");

</script>

<script type="text/javascript" src="/Scripts/Resources.js"></script> 
```

`MetaAcceptLanguage`我从 Scott Hanselman 的这篇很棒的帖子中得到的帮助：

[ASP.NET MVC 3、JavaScript 和 jQuery 中的全球化、国际化和本地化 - 第 1 部分](http://www.hanselman.com/blog/GlobalizationInternationalizationAndLocalizationInASPNETMVC3JavaScriptAndJQueryPart1.aspx)

```
public static IHtmlString MetaAcceptLanguage<T>(this HtmlHelper<T> html)
{
     var acceptLanguage =
         HttpUtility.HtmlAttributeEncode(
                     Thread.CurrentThread.CurrentUICulture.ToString());

      return new HtmlString(
      String.Format("<meta name=\"{0}\" content=\"{1}\">", "accept-language",
                    acceptLanguage));
 } 
```

**用它**

```
var msg = Resources.Common.Greeting[locale];
alert(msg); 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-19T17:49:16.827

我会使用对象/数组表示法：

```
var phrases={};
phrases['fatalError'] ='On no!'; 
```

然后您可以只交换 JS 文件，或使用 Ajax 调用来重新定义您的短语列表。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-11-10T15:53:40.640

使用附属程序集（而不是 resx 文件），您可以枚举服务器上您知道该语言的所有字符串，从而生成一个 Javascript 对象，其中仅包含正确语言的字符串。

这样的东西对我们有用（VB.NET 代码）：

```
Dim rm As New ResourceManager([resource name], [your assembly])
Dim rs As ResourceSet = 
    rm.GetResourceSet(Thread.CurrentThread.CurrentCulture, True, True)
For Each kvp As DictionaryEntry In rs
    [Write out kvp.Key and kvp.Value]
Next 
```

但是，遗憾的是，我们还没有找到对 .resx 文件执行此操作的方法。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-05-29T14:26:37.653

JSGettext 做得很好——在后端使用几乎任何语言动态加载 GNU Gettext .po 文件。谷歌“使用 Gettext 和 PHP 进行动态 Javascript 本地化”以找到使用 PHP 的 JSGettext 的演练（我会发布链接，但这个愚蠢的网站不会让我，叹息......）

**编辑**：[这](http://openflights.org/blog/2009/05/29/dynamic-javascript-localization-with-gettext-and-php/)应该是链接

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2012-11-15T07:01:58.047

有一个用于本地化 JavaScript 应用程序的库： [https ://github.com/wikimedia/jquery.i18n](https://github.com/wikimedia/jquery.i18n)

可以做参数替换，支持性别（巧妙处理他/她）、数字（巧妙处理复数，包括有多个复数形式的语言），以及一些语言需要的自定义语法规则。

字符串存储在 JSON 文件中。

唯一的要求是 jQuery。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2014-10-17T10:00:27.717

嗯，我觉得你可以考虑这个。英语-西班牙语示例：

编写 2 个 Js 脚本，如下所示：

```
en-GB.js
lang = {
    date_message: 'The start date is incorrect',
    ...
};
es-ES.js
lang = {
    date_message: 'Fecha de inicio incorrecta',
    ...
}; 
```

服务器端 - 后面的代码：

```
Protected Overrides Sub InitializeCulture()
    Dim sLang As String 
    sLang = "es-ES" 

    Me.Culture = sLang
    Me.UICulture = sLang
    Page.ClientScript.RegisterClientScriptInclude(sLang & ".js", "../Scripts/" & sLang & ".js")

    MyBase.InitializeCulture()
End Sub 
```

你知道，俚语可能是“en-GB”，这取决于当前用户的选择......

Javascript调用：

```
alert (lang.date_message); 
```

我认为它很有效，非常简单。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2011-08-21T23:42:35.230

我为运行 HTML5 的移动应用程序执行了以下操作来本地化 JavaScript：

1.为每种语言创建了一组资源文件，将它们称为英语的“en.js”。每个都包含应用程序的不同字符串，如下所示：

```
 var localString = {
        appName: "your app name",
        message1: "blah blah"
      }; 
```

2.使用Lazyload根据应用的locale语言加载合适的资源文件：[https ://github.com/rgrove/lazyload](https://github.com/rgrove/lazyload)

3.通过查询字符串传递语言代码（当我使用PhoneGap从Android启动html文件时）

4.然后我编写了以下代码来动态加载正确的资源文件：

```
 var lang = getQueryString("language");
localization(lang);
function localization(languageCode) {
    try {
        var defaultLang = "en";
        var resourcesFolder = "values/";
        if(!languageCode || languageCode.length == 0)
            languageCode = defaultLang;
        // var LOCALIZATION = null;
        LazyLoad.js(resourcesFolder + languageCode + ".js", function() {
            if( typeof LOCALIZATION == 'undefined') {
                LazyLoad.js(resourcesFolder + defaultLang + ".js", function() {
                    for(var propertyName in LOCALIZATION) {
                        $("#" + propertyName).html(LOCALIZATION[propertyName]);
                    }
                });
            } else {
                for(var propertyName in LOCALIZATION) {
                    $("#" + propertyName).html(LOCALIZATION[propertyName]);
                }
            }
        });
    } catch (e) {
        errorEvent(e);
    }
}
function getQueryString(name)
{
  name = name.replace(/[\[]/, "\\\[").replace(/[\]]/, "\\\]");
  var regexS = "[\\?&]" + name + "=([^&#]*)";
  var regex = new RegExp(regexS);
  var results = regex.exec(window.location.href);
  if(results == null)
    return "";
  else
    return decodeURIComponent(results[1].replace(/\+/g, " "));
} 
```

5.从 html 文件中，我引用的字符串如下：

```
 span id="appName" 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-19T17:52:38.880

扩展diodeus.myopenid.com的答案：让你的代码写出一个包含所有必需字符串的JS数组的文件，然后在其他JS代码之前加载适当的文件/脚本。

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2010-03-22T01:43:50.907

[`MSDN`这样做](http://msdn.microsoft.com/en-us/library/bb398935.aspx)的方式，基本上是：

> 您为每种支持的语言和文化创建一个单独的脚本文件。在每个脚本文件中，您都包含一个 JSON 格式的对象，其中包含该语言和文化的本地化资源值。

我无法告诉您问题的最佳解决方案，但恕我直言，这是最糟糕的方法。至少现在你知道如何不去做。

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2014-06-27T21:24:52.877

我们使用 MVC 并简单地创建了一个控制器操作来返回一个本地化的字符串。我们在会话中维护用户的文化，并在任何调用检索语言字符串、AJAX 或其他方式之前设置线程文化。这意味着我们总是返回一个本地化的字符串。

我承认，这不是最有效的方法，但很少需要在 javascript 中获取本地化字符串，因为大多数本地化都是在我们的局部视图中完成的。

**全球.asax.cs**

```
protected void Application_PreRequestHandlerExecute(object sender, EventArgs e)
{
    if (Context.Handler is IRequiresSessionState || Context.Handler is IReadOnlySessionState)
    {
        // Set the current thread's culture
        var culture = (CultureInfo)Session["CultureInfo"];
        if (culture != null)
        {
            Thread.CurrentThread.CurrentCulture = culture;
            Thread.CurrentThread.CurrentUICulture = culture;
        }
    }
} 
```

**控制器动作**

```
public string GetString(string key)
{
    return Language.ResourceManager.GetString(key);
} 
```

**Javascript**

```
/*
    Retrieve a localized language string given a lookup key.
    Example use:
      var str = language.getString('MyString');
*/
var language = new function () {
    this.getString = function (key) {
        var retVal = '';
        $.ajax({
            url: rootUrl + 'Language/GetString?key=' + key,
            async: false,
            success: function (results) {
                retVal = results;
            }
        });
        return retVal;
    }
}; 
```

# linux - 如何使用 YUM 列出一个包的内容？

> ID：104055
> 
> 赞同：337
> 
> 时间：2008-09-19T17:49:27.733
> 
> 标签：linux, fedora, rpm, yum, package-managers

我知道如何使用 rpm 列出包的内容（`rpm -qpil package.rpm`）。但是，这需要知道 .rpm 文件在文件系统上的位置。一个更优雅的解决方案是使用包管理器，在我的例子中是 YUM。如何使用 YUM 来实现这一点？

* * *

## 回答 #1

> 赞同：451
> 
> 时间：2008-09-20T07:31:24.900

有一个名为`yum-utils`YUM 的软件包，其中包含一个名为的工具`repoquery`，可以执行此操作。

```
$ repoquery --help | grep -E "list\ files" 
  -l, --list            list files in this package/group 
```

合并为一个例子：

```
$ repoquery -l time
/usr/bin/time
/usr/share/doc/time-1.7
/usr/share/doc/time-1.7/COPYING
/usr/share/doc/time-1.7/NEWS
/usr/share/doc/time-1.7/README
/usr/share/info/time.info.gz 
```

在至少一个带有 rpm v4.8.0、yum v3.2.29 和 repoquery v0.0.11 的 RH 系统上，不会`repoquery -l rpm`打印任何内容。

如果您遇到此问题，请尝试添加`--installed`标志：`repoquery --installed -l rpm`。

* * *

## `DNF`更新：

要使用`dnf`代替`yum-utils`，请使用以下命令：

```
$ dnf repoquery -l time
/usr/bin/time
/usr/share/doc/time-1.7
/usr/share/doc/time-1.7/COPYING
/usr/share/doc/time-1.7/NEWS
/usr/share/doc/time-1.7/README
/usr/share/info/time.info.gz 
```

* * *

## 回答 #2

> 赞同：169
> 
> 时间：2014-11-03T09:37:38.393

```
rpm -ql [packageName] 
```

## 例子

```
# rpm -ql php-fpm

/etc/php-fpm.conf
/etc/php-fpm.d
/etc/php-fpm.d/www.conf
/etc/sysconfig/php-fpm
...
/run/php-fpm
/usr/lib/systemd/system/php-fpm.service
/usr/sbin/php-fpm
/usr/share/doc/php-fpm-5.6.0
/usr/share/man/man8/php-fpm.8.gz
...
/var/lib/php/sessions
/var/log/php-fpm 
```

无需安装 yum-utils，也无需知道 rpm 文件的位置。

* * *

## 回答 #3

> 赞同：78
> 
> 时间：2012-02-06T13:26:41.857

```
$ yum install -y yum-utils

$ repoquery -l packagename 
```

* * *

## 回答 #4

> 赞同：32
> 
> 时间：2008-09-19T17:54:36.783

我不认为您可以使用 yum 列出软件包的内容，但如果您的本地系统上有 .rpm 文件（很可能所有已安装的软件包都是这种情况），您可以使用 rpm 命令列出该包的内容如下：

```
rpm -qlp /path/to/fileToList.rpm 
```

如果您没有软件包文件 (.rpm)，但已安装该软件包，请尝试以下操作：

```
rpm -ql packageName 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2016-12-01T19:17:34.240

这里有几个很好的答案，所以让我提供一个糟糕的答案：

```
: you can type in anything below, doesnt have to match anything

yum whatprovides "me with a life"

: result of the above (some liberties taken with spacing):

Loaded plugins: fastestmirror
base | 3.6 kB 00:00 
extras | 3.4 kB 00:00 
updates | 3.4 kB 00:00 
(1/4): extras/7/x86_64/primary_db | 166 kB 00:00 
(2/4): base/7/x86_64/group_gz | 155 kB 00:00 
(3/4): updates/7/x86_64/primary_db | 9.1 MB 00:04 
(4/4): base/7/x86_64/primary_db | 5.3 MB 00:05 
Determining fastest mirrors
 * base: mirrors.xmission.com
 * extras: mirrors.xmission.com
 * updates: mirrors.xmission.com
base/7/x86_64/filelists_db | 6.2 MB 00:02 
extras/7/x86_64/filelists_db | 468 kB 00:00 
updates/7/x86_64/filelists_db | 5.3 MB 00:01 
No matches found

: the key result above is that "primary_db" files were downloaded

: filelists are downloaded EVEN IF you have keepcache=0 in your yum.conf

: note you can limit this to "primary_db.sqlite" if you really want

find /var/cache/yum -name '*.sqlite'

: if you download/install a new repo, run the exact same command again
: to get the databases for the new repo

: if you know sqlite you can stop reading here

: if not heres a sample command to dump the contents

echo 'SELECT packages.name, GROUP_CONCAT(files.name, ", ") AS files FROM files JOIN packages ON (files.pkgKey = packages.pkgKey) GROUP BY packages.name LIMIT 10;' | sqlite3 -line /var/cache/yum/x86_64/7/base/gen/primary_db.sqlite 

: remove "LIMIT 10" above for the whole list

: format chosen for proof-of-concept purposes, probably can be improved a lot
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2018-08-13T12:36:53.410

当前`reopquery`已集成到`dnf`and`yum`中，因此键入：

```
dnf repoquery -l <pkg-name> 
```

将列出来自远程存储库的包内容（即使对于尚未安装的包）

这意味着该功能不再需要安装单独的`dnf-utils`或软件包，因为它现在受到本地支持。`yum-utils`

* * *

列出*已安装*或*本地*（`*.rpm`文件）包的内容`rpm -ql`

我认为`yum`org `dnf`（不是`repoquery`子命令）不可能

如果我错了，请纠正我

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-19T17:55:28.340

Yum 没有自己的包装类型。Yum 运营并帮助管理 RPM。因此，您可以使用 yum 列出可用的 RPM，然后运行 ​​rpm -qlp 命令来查看该软件包的内容。

# sql-server-2005 - SQL Server 2005 - 单击作业-> 属性产生“新作业”窗口

> ID：104057
> 
> 赞同：1
> 
> 时间：2008-09-19T17:49:44.067
> 
> 标签：sql-server-2005

最近，我在 Windows XP 上运行的 SQL Server 2005 客户端开始出现问题，右键单击任何作业并选择“属性”会将我带到“新建作业”窗口。另外，如果我选择“查看历史记录”，我会得到所有作业的历史记录，而不是我右键单击的那个。

我以前也遇到过这种情况，发现没有安装SQL 2005的Service Pack，安装后问题就消失了，大约一年没见了。从那以后我没有对其进行任何更新，我不确定是什么原因造成的。

作为一个可能相关的说明，我已经尝试在我的机器上安装 XP Service Pack 3 两次，它只是挂在我的机器上（我在星期五开始运行它，然后周末离开，它没有超过 5-10 % 当我星期一回来时）。我不确定这个事实是否相关，但我认为 XP 更新可能以某种方式覆盖了 SQL 2005 在挂起之前使用的东西。

关于可能导致这种情况的任何想法？我已经包含了 SQL 2005 中显示的当前版本信息。

Microsoft SQL Server Management Studio - 9.00.1399.00
Microsoft Analysis Services 客户端工具 - 2005.090.1399.00
Microsoft 数据访问组件 (MDAC) - 2000.085.1117.00 (xpsp_sp2_rtm.040803-2158)
Microsoft MSXML - 2.6 3.0 4.0 5.0 6.0
Microsoft Internet Explorer - 7.0。 5730.13
Microsoft .NET Framework - 2.0.50727.1433
操作系统 - 5.1.2600

更新：我在我的机器上重新安装了 SQL 2005 service pack 2，它解决了这个问题。我将不得不查看问题是否是在我尝试安装 xp sp3 时引起的。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-09-19T17:57:38.210

我会建议以下路径：

1.  确保您有服务器的当前备份
2.  尝试全新安装 XP 服务包
3.  尝试在机器上重新安装客户端工具
4.  如果失败，请尝试安装（或重新安装）SP2 for SQL Server

# c# - System.Convert.ToInt vs (int)

> ID：104063
> 
> 赞同：12
> 
> 时间：2008-09-19T17:50:35.483
> 
> 标签：c#, types

我注意到在另一篇文章中，有人做了类似的事情：

```
double d = 3.1415;
int i = Convert.ToInt32(Math.Floor(d)); 
```

他们为什么使用转换功能，而不是：

```
double d = 3.1415;
int i = (int)d; 
```

它有一个隐式的地板和转换。

此外，更令人担忧的是，我注意到我正在阅读的一些生产代码：

```
double d = 3.1415;
float f = Convert.ToSingle(d); 
```

是否与以下内容相同：

```
float f = (float)d; 
```

所有其他隐式转换只是为了完整性而在 Convert 类中进行，还是有目的？我可以理解对 .ToString() 的需求，但不是其余的。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-09-19T18:36:58.820

转换为 int 是隐式截断，而不是隐式地板：

```
double d = -3.14;
int i = (int)d;
// i == -3 
```

我选择 Math.Floor 或 Math.Round 以使我的意图更加明确。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-29T13:58:26.713

舍入的处理方式也不同：

x=-2.5 (int)x=-2 Convert.ToInt32(x)=-2
x=-1.5 (int)x=-1 Convert.ToInt32(x)=-2
x=-0.5 (int)x= 0 Convert.ToInt32(x)= 0
x= 0.5 (int)x= 0 Convert.ToInt32(x)= 0
x= 1.5 (int)x= 1 Convert.ToInt32(x)= 2
x= 2.5 (int)x= 2 转换.ToInt32(x)= 2

注意 x=-1.5 和 x=1.5 的情况。
在某些算法中，使用的舍入方法对于获得正确答案至关重要。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-19T18:10:55.077

当您有一个要转换为 int 的字符串时，您可以使用 Convert

```
int i = Convert.ToInt32("1234"); 
```

如果转换和强制转换失败，它们都会抛出异常。

即，这仍然会抛出异常，它不会返回 0：

```
Convert.ToInt32("1234NonNumber"); 
```

在许多情况下，转换和强制转换会产生相同的结果，但强制转换通常更容易阅读。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-20T02:26:43.823

Convert.ToInt32() 用于字符串（[http://msdn.microsoft.com/en-us/library/sf1aw27b.aspx](http://msdn.microsoft.com/en-us/library/sf1aw27b.aspx)），而强制转换只能用于具有内部转换器的类型（数字类型）。真正的诀窍在于在 Int32.Parse 和 Convert.ToInt32() 之间做出决定。Convert.ToInt32() 容忍空参数并返回 0，而 Int32.Parse() 将抛出 ArgumentNullException。

# database - 如何解决 Oracle SQL 语句的性能问题

> ID：104066
> 
> 赞同：5
> 
> 时间：2008-09-19T17:51:09.037
> 
> 标签：database, performance, oracle

我有两个几乎完全相同的插入语句，它们在同一个 Oracle 实例上的两个不同模式中运行。插入语句的外观无关紧要 - 我在这里寻找故障排除策略。

两种模式有 99% 的结构相同。一些列的名称略有不同，除了它们是相同的。插入语句几乎完全相同。一个解释计划的成本为 6，另一个解释计划的成本为 7。两组插入语句中涉及的表具有完全相同的索引。已经为这两种模式收集了统计信息。

一条插入语句在 5 秒内插入 12,000 条记录。

另一个插入语句在 4 分 19 秒内插入 25,000 条记录。

插入的记录数是正确的。执行时间的巨大差异让我感到困惑。鉴于解释计划中没有任何突出之处，您将如何确定导致运行时差异的原因？

（我在 Windows 机器上使用 Oracle 10.2.0.4）。

**编辑：**问题最终成为一个效率低下的查询计划，涉及不需要完成的笛卡尔合并。明智地使用索引提示和哈希连接提示解决了这个问题。现在需要 10 秒。Sql Trace / TKProf 给了我方向，因为它向我展示了计划中的每个步骤花费了多少秒，以及生成了多少行。因此 TKPROF 向我展示了：-

```
Rows     Row Source Operation
-------  ---------------------------------------------------
  23690  NESTED LOOPS OUTER (cr=3310466 pr=17 pw=0 time=174881374 us)
  23690   NESTED LOOPS  (cr=3310464 pr=17 pw=0 time=174478629 us)
2160900    MERGE JOIN CARTESIAN (cr=102 pr=0 pw=0 time=6491451 us)
   1470     TABLE ACCESS BY INDEX ROWID TBL1 (cr=57 pr=0 pw=0 time=23978 us)
   8820      INDEX RANGE SCAN XIF5TBL1 (cr=16 pr=0 pw=0 time=8859 us)(object id 272041)
2160900     BUFFER SORT (cr=45 pr=0 pw=0 time=4334777 us)
   1470      TABLE ACCESS BY INDEX ROWID TBL1 (cr=45 pr=0 pw=0 time=2956 us)
   8820       INDEX RANGE SCAN XIF5TBL1 (cr=10 pr=0 pw=0 time=8830 us)(object id 272041)
  23690    MAT_VIEW ACCESS BY INDEX ROWID TBL2 (cr=3310362 pr=17 pw=0 time=235116546 us)
  96565     INDEX RANGE SCAN XPK_TBL2 (cr=3219374 pr=3 pw=0 time=217869652 us)(object id 272084)
      0   TABLE ACCESS BY INDEX ROWID TBL3 (cr=2 pr=0 pw=0 time=293390 us)
      0    INDEX RANGE SCAN XIF1TBL3 (cr=2 pr=0 pw=0 time=180345 us)(object id 271983) 
```

注意操作是 MERGE JOIN CARTESIAN 和 BUFFER SORT 的行。让我关注的事情是生成的行数（超过 200 万！），以及每个操作花费的时间（与其他操作相比）。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-19T17:56:40.290

使用[SQL Trace 工具和 TKPROF](http://docs.oracle.com/cd/B19306_01/server.102/b14211/sqltrace.htm#g33356)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-19T18:05:01.267

插入速度变慢的罪魁祸首是索引、约束和 oninsert 触发器。在没有尽可能多的这些的情况下进行测试，看看它是否很快。然后将它们重新引入，看看是哪一个导致了问题。

我见过在批量插入之前删除索引并在最后重建的系统——而且速度更快。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-19T18:15:03.007

首先要意识到的是，正如[文档](http://download.oracle.com/docs/cd/A87860_01/doc/server.817/a76965/c20a_opt.htm#16287)所述，您看到的显示成本与其中一个查询计划有关。2 种不同解释的成本**不可**比较。其次，成本基于内部估计。尽管 Oracle 努力尝试，但这些估计并不准确。特别是当优化器行为不端时。您的情况表明有两个查询计划，根据 Oracle 的说法，它们的性能非常接近。但事实上，它的表现非常不同。

您要查看的实际信息是实际的解释计划本身。这可以准确地告诉您 Oracle 如何执行该查询。它有很多技术性的 gobbeldy-gook，但你真正关心的是知道它从最缩进的部分开始工作，并且在每一步它都根据少数规则之一进行合并。这将告诉您 Oracle 在您的两个实例中的不同之处。

接下来是什么？好吧，有多种策略可以调整不良陈述。如果您使用的是 Oracle 10g，我建议的第一个选项是尝试他们的[SQL 调优顾问](http://www.oracle-base.com/articles/10g/AutomaticSQLTuning10g.php)，看看更详细的分析是否会告诉 Oracle 其方式的错误。然后它可以存储该计划，您将使用更有效的计划。

如果您不能这样做，或者如果这不起作用，那么您需要进行诸如提供查询提示、手动存储的查询大纲等之类的事情。这是一个复杂的话题。这就是拥有真正的 DBA 有帮助的地方。如果你不这样做，那么你会想要开始阅读[文档](http://download-west.oracle.com/docs/cd/B10501_01/server.920/a96533/toc.htm)，但要知道有很多东西要学。（Oracle 也有一个 SQL 调优类，或者至少曾经非常好。不过它并不便宜。）

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-22T17:20:07.667

我已经列出了要检查以提高性能的一般事项清单，以回答另一个问题：

[最喜欢的性能调优技巧](https://stackoverflow.com/questions/18783/sql-what-are-your-favorite-performance-tricks#103176)

...它作为一个清单可能会有所帮助，即使它不是特定于 Oracle 的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-19T18:25:00.860

我同意之前的海报，即 SQL Trace 和 tkprof 是一个很好的起点。我还强烈推荐《[优化 Oracle 性能](https://rads.stackoverflow.com/amzn/click/com/059600527X)》一书，其中讨论了用于跟踪执行和分析输出的类似工具。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-23T18:57:49.017

SQL Trace 和 tkprof 仅在您可以访问这些工具时才有用。我工作的大多数大公司都不允许开发人员访问 Oracle unix ID 下的任何内容。

我相信您应该能够通过首先了解所提出的问题并阅读每个查询的解释计划来确定问题。很多时候我发现最大的不同是有一些表和索引没有被分析。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-23T19:07:45.687

另一个提供查询调优通用技术的好参考是Dan Tow的《 [SQL Tuning 》一书。](https://rads.stackoverflow.com/amzn/click/com/0596005733)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2013-12-27T07:38:39.793

当 sql 语句的性能不如预期/期望时，我要做的第一件事就是检查执行计划。

诀窍是检查与预期不符的事情。例如，您可能会发现您认为索引扫描应该更快的表​​扫描，反之亦然。

oracle优化器有时会出错的一点是估计一个步骤将返回多少行。如果执行计划需要 2 行，但您知道它将更像 2000 行，那么执行计划必然不是最优的。

通过两个语句进行比较，您显然可以比较两个执行计划以查看它们的不同之处。

从这个分析中，我提出了一个我认为应该更适合的执行计划。这不是一个确切的执行计划，而只是我发现的一些关键更改，例如：它应该使用 Index X 或 Hash Join 而不是嵌套循环。

接下来是想办法让 Oracle 使用该执行计划。通常通过使用提示，或创建附加索引，有时更改 SQL 语句。然后当然测试更改后的语句

a) 仍然做它应该做的事情

b) 实际上更快

使用 b 确保您正在测试正确的用例非常重要。典型的坑洼是返回第一行与返回最后一行之间的差异。大多数工具一旦可用就会立即向您显示第一个结果，没有直接指示，表明还有更多工作要做。但是如果您的实际程序必须在继续下一个处理步骤之前处理所有行，那么第一行出现时几乎无关紧要，只有当最后一行可用时才相关。

如果你找到更好的执行计划，最后一步就是让你的数据库在实际程序中实际使用它。如果你添加了一个索引，这通常会开箱即用。提示是一种选择，但如果库创建您的 sql 语句可能会出现问题，这些通常不支持提示。作为最后的手段，您可以保存和修复特定 sql 语句的执行计划。我会避免这种方法，因为它很容易被遗忘，并且在一年左右的时间里，一些可怜的开发人员会摸不着头脑，为什么该语句的执行方式可能与一年前的数据相符，但不适用于当前数据 ...

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2009-04-30T11:56:47.293

***分析 oI 还强烈推荐《优化 Oracle 性能》一书，其中讨论了用于跟踪执行和输出的类似工具。***

# .net - VB.NET 可选参数如何“在幕后”工作？它们是否符合 CLS 标准？

> ID：104068
> 
> 赞同：5
> 
> 时间：2008-09-19T17:51:26.400
> 
> 标签：.net, vb.net, clr, cil

假设我们有以下方法声明：

```
Public Function MyMethod(ByVal param1 As Integer, _
    Optional ByVal param2 As Integer = 0, _
    Optional ByVal param3 As Integer = 1) As Integer

    Return param1 + param2 + param3
End Function 
```

VB.NET 如何使可选参数在 CLR 范围内工作？可选参数是否符合 CLS？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-19T18:10:05.357

有趣的是，这是通过反射器获得的反编译的 C# 代码。

```
public int MyMethod(int param1, 
                   [Optional, DefaultParameterValue(0)] int param2, 
                   [Optional, DefaultParameterValue(1)] int param3)
{
    return ((param1 + param2) + param3);
} 
```

注意 Optional 和 DefaultParameterValue 属性。尝试将它们放入 C# 方法中。您会发现您仍然需要将值传递给该方法。然而，在 VB 代码中，它变成了默认值！话虽如此，我个人从未在 VB 代码中使用过 Default 。感觉就像一个黑客。方法重载对我有用。

但是，在处理 Excel 互操作时，默认确实有帮助，在 C# 中直接使用开箱即用是一件很痛苦的事情。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-19T17:55:42.273

与普遍的看法相反，可选参数似乎确实符合 CLS。（但是，我对此的主要检查是使用 CLSCompliant 属性标记程序集、类和方法，设置为 True。）

那么这在 MSIL 中是什么样子的呢？

```
.method public static int32  MyMethod(int32 param1,
                                      [opt] int32 param2,
                                      [opt] int32 param3) cil managed
{
  .custom instance void [mscorlib]System.CLSCompliantAttribute::.ctor(bool) = ( 01 00 01 00 00 ) 
  .param [2] = int32(0x00000000)
  .param [3] = int32(0x00000001)
  // Code size       11 (0xb)
  .maxstack  2
  .locals init ([0] int32 MyMethod)
  IL_0000:  nop
  IL_0001:  ldarg.0
  IL_0002:  ldarg.1
  IL_0003:  add.ovf
  IL_0004:  ldarg.2
  IL_0005:  add.ovf
  IL_0006:  stloc.0
  IL_0007:  br.s       IL_0009
  IL_0009:  ldloc.0
  IL_000a:  ret
} // end of method Module1::MyMethod 
```

请注意参数上的 [opt] 标记——MSIL 本身就支持这一点，没有任何技巧。（与 MSIL 对 VB 的 Static 关键字的支持不同，这完全是另一个话题。）

那么，为什么这些不在 C# 中呢？我无法回答这个问题，除了我猜测这可能是假定的需求不足。我自己的偏好一直是指定参数，即使它们是可选的——对我来说，代码看起来更干净，更容易阅读。（如果有省略的参数，我通常会首先寻找与可见签名匹配的重载——只有在我找不到一个之后，我才意识到涉及可选参数。）

# pageviews - 是否可以判断用户是否查看了页面的一部分？

> ID：104076
> 
> 赞同：0
> 
> 时间：2008-09-19T17:52:38.973
> 
> 标签：pageviews

正如网站上的标题所说，是否可以判断用户是否查看了页面的一部分？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-19T17:55:57.077

将那部分移动到单独的 iframe 工作吗？然后如果他们滚动到底部，发出一个小图像文件的获取请求..忘记了技术的名称..

更新：它被称为[Web Bug](http://en.wikipedia.org/wiki/Web_bug) ..Web Bug 是嵌入在网页或电子邮件中的对象，通常对用户不可见，但允许检查用户是否查看了页面或电子邮件。一种常见的用途是在电子邮件跟踪中。替代名称是 Web beacon、tracking bug、tracking pixel、pixel tag、1×1 gif 和 clear gif。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-19T17:55:16.440

如果您要检查用户是否确实查看了页面的某些部分，则需要安装网络摄像头并跟踪他的眼球运动。

如果您正在谈论检测用户向下滚动页面的距离，您可以使用 Javascript 在 OnScroll 事件中检测这一点。然后，如果您需要记录这些，您可以向服务器触发一些 ajax。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-19T17:56:05.283

我不确定这是否合乎道德 - 但从技术上讲，如果您使用 javascript，您可以检测文档中每个段落标记的 mouseover 事件，然后将该信息 AJAX 返回到服务器。当用户向下滚动页面时，他们可能会将鼠标悬停在段落上，然后您至少大致知道他们读到了哪里。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-19T18:04:53.203

不可靠，不。

简单的例子：我在一个链接上单击鼠标中键，它会在一个新的背景选项卡中打开它。然后我决定反对它，并关闭标签而不看它。任何 JavaScript 技巧都会报告我查看了首屏上的所有内容。

更复杂的例子：新手用户没有最大化浏览器窗口，并且浏览器窗口的一部分在屏幕外。任何 JavaScript 技巧都会报告好像正在查看整个视口，因此即使将查询限制为仅发生滚动的情况也无济于事。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-19T17:54:01.247

除非您需要某种类型的用户操作，否则您所能知道的只是他们下载了某些部分，而不是他们实际查看了它。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-01-15T17:27:37.180

当然。将该内容放在一个 div 中，然后在您的 html 中，使用一些 javascript，捕获 onmouseover 事件并在那里完成您的工作。如果他们将鼠标放在某物上，那么可以肯定他们已经看到了，我会说...

希望这可以帮助。

# ruby-on-rails - Ruby on Rails 中的多态模型？

> ID：104086
> 
> 赞同：0
> 
> 时间：2008-09-19T17:54:24.303
> 
> 标签：ruby-on-rails, ruby

对于我正在做的一个项目，商店有两种类型的产品——一个真实的产品和一组产品。

对于本次讨论，我们称它们为“一件 T 恤”和“一盒 T 恤”。对于一件 T 恤，我需要存储正常属性 - 价格、sku、尺寸、颜色、描述等。对于一盒 T 恤，我需要有价格、sku、描述和 t- 列表包括在内的衬衫。

所以现在，我用 Shirt 和 ShirtCollection 模型来表示这一点。当我需要进行报告和订单管理并确保 SKU 是唯一的时，我可以看到这会导致困难。

那么，最好的表现方式是什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-19T23:29:33.203

您可以拥有一个 Tshirt 表，然后使用 has_many :through 关联对其进行自我引用。

T 恤 - id、sku、价格、尺寸、颜色、描述、is_box

TshirtBox - parent_tshirt（引用 tshirt 的 id），child_tshirt（引用 tshirt 的 id）

查看此链接以获取有关自我参照 has_many 的更多信息：通过[http://www.aldenta.com/2006/11/10/has_many-through-self-referential-example/](http://www.aldenta.com/2006/11/10/has_many-through-self-referential-example/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-19T19:19:54.503

我会有以下型号

Tshirt
TshirtBox has_many TshirtItems
TshirtBoxItems （这基本上是一个带有 id tshirt_box_id 和 tshirt_id 的连接表） belongs_to TshirtBox

TshirtBoxItems 是一种将 T 恤与盒子和未来可能的其他东西联系起来的方法。

# c# - 集成测试 Http 代理服务器

> ID：104097
> 
> 赞同：0
> 
> 时间：2008-09-19T17:55:49.683
> 
> 标签：c#, proxy, automated-tests, testing, integration-testing

我用 C# 编写了一个简单的 HTTP 代理服务器，我想进行集成/功能测试。是否已经创建了可以用来执行此操作的产品？如果没有，为此编写我自己的测试的最佳方法是什么（我已经有单元测试）？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-19T18:05:15.463

要通过提供网页来测试集成，您可以尝试以下方法之一：

*   [硒](http://selenium.openqa.org/)
*   [氮化硅](http://watin.sourceforge.net/)
*   [瓦提尔](http://wtr.rubyforge.org/)

您也可以在 C# 中直接从 xUnit 运行 Watin 测试 - 我们为我们的应用程序执行此操作。我也相信可以在浏览器中为 Watin（可能还有其他人）动态设置代理设置。

或者，要向给定地址发出 HTTP 请求，请尝试[JMeter](http://jakarta.apache.org/jmeter/)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-19T20:31:23.583

稍微偏离主题：看到自定义 HTTP 代理的份额后，他们的作者忘记（后来发现他们需要）的通常功能是对 CONNECT 方法的支持。如果没有 CONNECT，您的代理将无法用于 TLS/SSL 连接。此外，通过代理传输非 HTTP 流量的软件也无法运行。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-29T08:27:28.553

还有两种产品可以使用：

*   网络测谎仪
*   下载

两者都可以通过 Google 轻松找到。两者都执行 Web 服务器/代理的功能和负载测试。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-01T18:44:33.637

[当您使用上述方法时，我还建议运行模拟 WAN 网络的最佳方式中](https://stackoverflow.com/questions/182077/best-way-to-simulate-a-wan-network)讨论的延迟/丢包注入工具之一。令人遗憾的是，当您在非混乱环境中测试您的代理时，它很容易确定它是稳定的。

# .net - 何时使用 Windows Workflow Foundation？

> ID：104099
> 
> 赞同：154
> 
> 时间：2008-09-19T17:56:02.117
> 
> 标签：.net, workflow, workflow-foundation

有些事情通过手工（代码）更容易实现，但有些事情通过 WF 更容易实现。看起来 WF 可以用来创建（几乎）任何类型的算法。所以（理论上）我可以在 WF 中完成所有逻辑，但对所有项目都这样做可能是个坏主意。

在什么情况下使用 WF 是个好主意，什么时候它会让事情变得更难？WF 与手工编码的优缺点/成本是什么？

* * *

## 回答 #1

> 赞同：125
> 
> 时间：2008-09-21T16:05:10.367

仅当满足以下任一条件时，您才可能需要 WF：

1.  你有一个长期运行的过程。
2.  你有一个经常变化的过程。
3.  你想要一个过程的可视化模型。

有关更多详细信息，请参阅 Paul Andrew 的帖子：[使用 Windows Workflow Foundation 做什么？](https://blogs.msdn.microsoft.com/pandrew/2007/02/01/what-to-use-windows-workflow-foundation-for/)

请不要将 WF 与任何类型的可视化编程混淆或联系起来。这是错误的，可能导致非常糟糕的架构/设计决策。

* * *

## 回答 #2

> 赞同：86
> 
> 时间：2011-12-21T18:11:09.693

绝不。你可能会后悔：

*   陡峭的学习曲线
*   难以调试
*   难以维护
*   无法提供足够的功能、灵活性或生产力增益来证明其使用的合理性
*   可以并且将破坏无法恢复的应用程序状态

我唯一能想到使用 WF 的情况是，如果我想为最终用户托管设计器，甚至可能不会。

相信我，没有什么比您编写的代码更直接、强大或灵活的了，它可以完全按照您的需要去做。远离WF。

当然，这只是我的意见，但我认为这是一个该死的好。:)

* * *

## 回答 #3

> 赞同：46
> 
> 时间：2008-09-19T18:02:17.497

WF生成的代码很讨厌。WF 带来的价值在于系统的可视化表示，尽管我还没有看到任何我不喜欢更简单的手工编码项目的东西（现在有 6-7 个与 WF 合作的项目） .

* * *

## 回答 #4

> 赞同：42
> 
> 时间：2013-07-29T11:14:38.313

一般来说，如果您不需要持久性和跟踪功能（我认为这是主要功能），您不应该使用 Workflow Foundation。

以下是我从经验中收集到的 Workflow Foundation 的优缺点：

**好处**

*   持久性：如果您将有许多长时间运行的流程（想想几天、几周、几个月），那么工作流程非常适合。空闲的工作流实例被持久化到数据库中，因此它不会占用内存。
*   跟踪：WF 提供了跟踪工作流中执行的每个活动的机制
*   *视觉设计师：我把它作为*，因为我认为这真的只对营销目的有用。作为一名开发人员，我更喜欢编写代码而不是视觉上将事物拼凑在一起。而且，当您让非开发人员制作工作流程时，您通常会遇到巨大的混乱局面。

**缺点**

*   编程模型：您在编程功能方面确实受到限制。想想你在 C# 中拥有的所有伟大特性，然后忘记它们。C#中简单的一两行语句变成了相当大的块活动。这对于输入验证来说尤其痛苦。话虽如此，如果您真的非常小心地只在工作流中保留高级逻辑，而在 C# 中保留其他所有内容，那么这可能不是问题。
*   性能：工作流会占用大量内存。如果您在服务器上部署大量工作流，请确保您有大量内存。另请注意，工作流比普通 C# 代码慢得多。
*   陡峭的学习曲线，难以调试：如上所述。您将花费大量时间来弄清楚如何让事情发挥作用，并找出做某事的最佳方法。
*   工作流版本不兼容：如果您部署具有持久性的工作流，并且需要对工作流进行更新，则旧的工作流实例不再兼容。据说这在 .NET 4.5 中已修复。
*   您必须使用 VB 表达式（.NET 4.5 允许使用 C# 表达式）。
*   不灵活：如果您需要一些 Workflow Foundation 未提供的特殊或特定功能，请准备好承受很多痛苦。在某些情况下，它甚至可能是不可能的。在你尝试之前谁知道？这里有很多风险。
*   没有接口的 WCF XAML 服务：通常使用 WCF 服务，您针对接口进行开发。使用 WCF XAML 服务，您无法确保 WCF XAML 服务已实现接口中的所有内容。您甚至不需要定义接口。（据我所知...）

* * *

## 回答 #5

> 赞同：27
> 
> 时间：2008-09-19T18:10:12.660

我发现使用工作流基础的主要原因是它在跟踪和持久性方面让您开箱即用。持久化服务很容易启动和运行，这带来了多个实例和主机之间的可靠性和负载分布。

另一方面，就像表单应用程序一样，工作流设计师推动您使用的代码模式很糟糕。但是您可以通过在工作流中不编写代码并将所有工作委托给其他类来避免问题，这些类可以比工作流更优雅地组织和单元测试。然后，您将获得设计师的酷炫视觉方面，而无需背后的意大利面条代码。

* * *

## 回答 #6

> 赞同：11
> 
> 时间：2008-09-19T18:03:42.347

就个人而言，我不卖WF。它的用处对我来说并不像 WPF 或 WCF 等其他新的 MS 技术那样明显。

我认为 WF 将来会在商业应用程序中大量使用，但我没有使用它的计划，因为它似乎不是我项目工作的正确工具。

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2009-03-30T16:22:28.053

我目前工作的公司建立了一个 Windows Workflow Foundation (WF)，他们选择使用它的原因是因为规则会经常发生变化，这将迫使他们重新编译各种 dll 等，因此他们的解决方案是将规则放在数据库中并从那里调用它们。这样他们就可以更改规则，而不必重新编译和重新分发 dll 等。

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2014-08-15T05:58:38.610

Windows 工作流吸引了非编码 IT 经理、BA 等，就像它的表亲 BizTalk 一样，但在实践中，单元测试、调试和代码覆盖只是众多陷阱中的三个。你可以克服其中的一些，但你必须投入大量资金来实现这一目标，而使用纯代码你就能做到这一点。如果你真的有一个长期运行的需求，那么你可能需要更复杂的东西。我听说过关于能够在不重新编译 dll 的情况下将新的 xaml 文件投入生产的争论，但老实说，工作流将消耗的时间可以更好地用于改进您的持续集成，使编译的部署不成问题。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-09-21T18:13:11.947

我会在需要使用工作流的任何环境中使用它，但是当它与 K2 甚至 SharePoint 2007 结合使用时，该平台的强大功能确实非常有用。与 BI 专家一起开发业务应用程序时，建议使用该平台，这通常只与简化和改进业务流程相关。

WF 是与 K2 的开发团队共同开发的，新的 K2 Blackpearl 是建立在 WF 之上的，MOSS 2007 和 WSS 3.0 的工作流引擎也是如此。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2013-04-15T08:44:54.670

当您不想手动编写所有这些代码来维护可视化界面、跟踪和持久性时，选择 WF 是一个明智的选择。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2018-03-06T08:53:11.693

几个月来，我一直在使用 Windows 工作流来开发自定义活动和重新托管的设计器，非开发人员可以使用它来构建工作流。WF 非常强大，但仅与开发人员构建的自定义活动一样好。归根结底，开发人员必须查看由非开发人员构建的工作流以进行测试和调试，但从他们可以创建草案工作流的角度来看，这太棒了。

此外，如果您的进程运行时间较长，当您需要动态更新进程时，WF 是一个很好的技术堆栈 - 无需重新安装/下载或执行任何操作，只需将新的 XAML 文件添加到目录中，您的体系结构应该是设置版本控制以废弃旧版本并使用新版本。

# windows - 成本最低的 Windows VPS 托管？

> ID：104106
> 
> 赞同：4
> 
> 时间：2008-09-19T17:57:21.410
> 
> 标签：windows, hosting, vps

有一段时间，我想我会在家里举办一些东西，因为我可以做任何我想做的事情。然而，飓风艾克让我断电了一周，我终于意识到这种情况是行不通的。

我的网站流量极低（每天 20 个访问者），所以我不需要大量的 CPU 或带宽。VPS 托管有哪些便宜的选择，可以让我灵活地做我需要配置服务器的事情，但成本不会很高。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-19T18:02:09.370

RapidVPS 提供 Windows 托管。29,99 美元/月

[https://www.rapidvps.com/index.php?page=Hosting.Windows.Specs](https://www.rapidvps.com/index.php?page=Hosting.Windows.Specs)

我是他们的 linux vps 托管的客户，并且遇到了零问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-19T17:59:57.347

我将[Applied Innovations](http://www.appliedi.net/)用于我的 .NET 托管。他们似乎也有便宜的 VPS。

我从来没有注意到停机时间，他们的计费和支持是可靠的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-23T01:03:52.413

查看 KickAssVPS 我已经使用 Windows VPS 一年多了。

[http://www.kickassvps.com/](http://www.kickassvps.com/)

我有 35 美元的套餐，即 960 MB RAM 10GB 空间 100GB 传输

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-01-10T08:30:50.547

[http://www.ajkservers.co.uk](http://www.ajkservers.co.uk)

从他们那里获得高质量的 VPS :) 他们支持 linux。

# javac - 如何在 Borland JBuilder 2005/2006 中增加 javac 进程的最大堆大小

> ID：104115
> 
> 赞同：2
> 
> 时间：2008-09-19T17:58:16.337
> 
> 标签：javac, heap-memory, jbuilder

在大多数现代 IDE 中，您可以设置一个参数以确保 javac 获得足够的堆内存来进行编译。由于不值得在这里讨论的原因，我们暂时与 JBuilder 2005/2006 相关联，而且源代码的数量似乎已经超过了 javac 可以处理的数量。

请保留特定于 JBuilder 2005/2006 javac 的答案（我们现在无法迁移，并且 Borland Make 编译器不正确支持 Java 1.6）

我意识到应该如何以及*应该*将哪些参数传递给 javac，问题是 IDE 似乎不允许在任何地方设置这些参数。很多配置都隐藏在 Jbuilder Install\bin*.config 文件中，我觉得答案可能在某个地方，但还没有找到。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-09-03T11:51:46.567

你找到解决这个问题的好方法了吗？

我有同样的问题，我找到的唯一解决方案如下： 环境变量 JAVA_TOOL_OPTIONS 可用于为 JVM 提供参数。

[http://java.sun.com/javase/6/docs/platform/jvmti/jvmti.html#tooloptions](http://java.sun.com/javase/6/docs/platform/jvmti/jvmti.html#tooloptions)

我创建了一个包含以下内容的批处理文件“JBuilderw.bat”：

* * *

设置 JAVA_TOOL_OPTIONS=-Xmx256m

JBuilderw.exe

* * *

每次我使用这个批处理文件 env.var 启动 JBuilder。JAVA_TOOL_OPTIONS 将被设置，javac.exe 将接收设置。JVM 在末尾显示以下消息：“Picked up JAVA_TOOL_OPTIONS: -Xmx256m”

缺点：所有由 JBuilder 启动的虚拟机都将获得该设置。:(

谢谢，JB

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-19T18:08:48.043

看看[http://javahowto.blogspot.com/2006/06/fix-javac-java-lang-outofmemoryerror.html](http://javahowto.blogspot.com/2006/06/fix-javac-java-lang-outofmemoryerror.html)

您需要传递给 JBuilder 的 javac 的参数是“-J-Xms256m -J-Xmx256m”。用适合您情况的任何东西替换 256m。另外，删除引号。

这应该适用于 java 1.4、java 1.5 及更高版本。

BR，~A

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-19T19:24:27.333

“我意识到应该如何以及应该将哪些参数传递给 javac，问题是 IDE 似乎不允许在任何地方设置这些参数。”

我现在意识到你只知道如何传递正确的参数而不是在哪里/如何传递这些参数:-(

这个怎么样：你能找到borland使用的JAVA_HOME/bin目录在哪里吗？如果是，那么您可以用 javac.bat 重命名 javac.exe（比如说 javacnew.exe），这反过来又会调用 javacnew.exe（以及传递所需的参数）？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-07T20:58:37.980

我不知道这是否会有所帮助，因为我不使用 Borland，但在 Eclipse 中，这是一个附加到要运行的程序的设置。您在 IDE 中运行的每个程序都有特定的配置，包括 VM 的参数。有没有类似的东西？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-24T03:10:02.423

你有一个位于 JBuilder2005/bin/ 中的 jdk.config 文件吗？

您应该能够修改该文件中的 vm 参数，例如：

```
vmparam -Xms256m 
vmparam -Xmx256m 
```

让我知道这是否有效，我在一个讨论在 JBuilder 2005 中编辑相关设置的[页面上找到了它。](http://support.codegear.com/article/34582)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-06-09T07:37:57.107

编辑`jbuilder.config`文件。把这两行注释掉：

*   最大 75%

*   vmmemmin 32m

他们应该是`<1Gb and with a >`1Gb PC，75% 太大了吗？

# asp.net - Sitecore Droplink 字段中的最大结果数？

> ID：104121
> 
> 赞同：4
> 
> 时间：2008-09-19T18:00:10.983
> 
> 标签：asp.net, sitecore

在 Sitecore 6 中，我的一个模板包含一个绑定到特定 sitecore 查询结果的“Droplink”字段。此查询当前返回大约 200 个项目。

当我在内容编辑器中查看实现此模板的项目时，我只能看到字段下拉列表中的前 50 个项目。

如何在编辑器的下拉列表中显示从此查询返回的所有项目？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-22T02:47:14.957

web.config 中有一个设置可以控制查询可以返回的最大项目数：

```
<setting name="Query.MaxItems" value="100" /> 
```

默认情况下，它设置为 100，所以我不太确定为什么您的查询只返回 50，也许其他人更改了设置？

此外，当退回超过 100 件商品时，请注意性能下降。根据您的硬件和整体 Sitecore 架构，它可能不会那么明显，但需要提防。

# windows - 从故障转储中查找 GDI/用户资源使用情况

> ID：104122
> 
> 赞同：6
> 
> 时间：2008-09-19T18:00:40.967
> 
> 标签：windows, resources, gdi, windbg

我有一个应用程序的故障转储，据说该应用程序正在泄漏 GDI。该应用程序在 XP 上运行，我可以毫无问题地将其加载到 WinDbg 中查看它。以前我们使用[Gdikdx.dll 扩展](http://msdn.microsoft.com/en-us/library/cc267206.aspx)来查看 Gdi 信息，但 XP 或 Vista 不支持此扩展。

有没有人有任何指针可以在 WinDbg 中查找 GDI 对象的使用情况。

或者，我确实可以访问失败的程序（及其压力测试套件），因此如果您知道 XP 和 Vista（或 Windows 2000，尽管这不是我们的目标）的任何“实时”调试工具，我可以在正在运行的系统上重现.

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-17T19:33:13.697

上周我一直在研究 GDI 泄漏查找工具。我们还执行定期压力测试，并且由于用户/gdi 对象句柄过度消耗，它的持续时间永远不会超过一天的价值。

据我所知，我的尝试非常成功。当然，我事先花了一些时间寻找另一种更快的解决方案。值得一提的是，我之前在上面提到的 msdn 文章中对 GDILeaks 工具有过一些半幸运的经验。更不用说在投入使用之前我必须解决一些问题，而这一次它只是没有给我想要的东西和方式。他们的方法的缺点是重量级的调试器接口（它使研究目标减慢了几个数量级，我认为这是不可接受的）。另一个缺点是它并非一直有效 - 在某些运行中，我根本无法让它报告/计算任何东西！它的复杂性（从代码量来看）是另一个吓人的因素。我不是 GUI 的忠实粉丝，因为我相信我 完全没有窗户的情况下，我的工作效率更高；o)。我还发现很难让它找到并使用我的符号。

在开始编写自己的工具之前，我还使用了另一种工具，即[泄漏浏览器](http://www.bugbrowser.com/dev/bugbrowser/index.php)。

无论如何，我最终确定了一种迭代方法来实现以下目标：

*   轻微的性能惩罚
*   实现简单
*   非侵入性（用于多种产品）
*   依靠尽可能多的可用

我为核心功能（它是一个可注入的 DLL）使用了 detours（非商业用途）。将 Javascript 用于自动代码生成（15K 脚本生成 100K 源代码 - 我无法手动编写代码，也不涉及 C 预处理器！）加上用于数据分析和快照/差异支持的 windbg 扩展。

长话短说——在我完成之后，在另一个压力测试期间收集信息只需要几个小时，而分析和修复泄漏则需要另外一个小时。

我很乐意分享我的发现。

PS我花了一些时间来尝试改进以前的工作。我的意图是尽量减少误报（我在开发过程中看到的误报太多了），因此它还将检查分配/释放的一致性，并避免考虑从未泄露的分配。

编辑：在[这里找到工具](http://code.google.com/p/leaktrap)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-19T18:05:33.030

[几年前](http://msdn.microsoft.com/en-us/magazine/cc188782.aspx)有一篇MSDN 杂志文章谈到了 GDI 泄漏。这指向了几个具有良好信息的不同地方。

在 WinDbg 中，您也可以尝试该`!poolused`命令以获取一些信息。

从崩溃转储（事后分析）中查找资源泄漏可能很困难——如果它总是在同一个地方，使用泄漏内存的同一个变量，而且你很幸运，你可以看到它会出现的最后一个地方被泄露等等。使用在调试器下运行的实时程序可能会容易得多。

您也可以尝试使用[Microsoft Detours](http://research.microsoft.com/sn/detours/)，但许可证并不总是有效。它也更具侵入性和先进性。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2016-06-27T08:58:11.840

我为此创建了一个 Windbg 脚本。看答案

[从故障转储中获取 GDI 句柄计数的命令](https://stackoverflow.com/questions/1626941/windbg-command-to-get-all-gdi-handle-count-from-a-crash-dump)

要跟踪分配堆栈，您可以在最后分配的 GDICell 对象之后设置一个 ba（访问中断）断点，以便在另一个 GDI 分配发生时中断。这可能有点复杂，因为地址发生了变化，但它可能足以找到几乎任何泄漏。

# c# - 在 Visual Studio 中使用不同语言的多个 Web 项目

> ID：104133
> 
> 赞同：2
> 
> 时间：2008-09-19T18:01:53.163
> 
> 标签：c#, vb.net, visual-studio, ide

我需要结合一个 VB Web 项目和一个 C# Web 项目，并让它们在同一个 Web 根目录中一起运行。例如，我需要能够导航到`localhost:1234/vbProjPage.aspx`然后重定向到`localhost:1234/cSharpProjPage.aspx`. 这可能在 Visual Studio 2008 中实现吗？

我知道您有能力创建一个网站并将所有内容放入根目录，但在这种情况下最好将每个项目彼此分开。

更新：要回答 Wes 的问题，可以但不希望更改这样的路径（`/vb/vbPage.aspx`& `/cs/csPage.aspx`）

更新：特拉维斯建议使用子网络项目。此[链接](http://blogs.msdn.com/webdevtools/archive/2006/07/01/652986.aspx)说明了如何执行此操作，但解决方案涉及将项目放入项目中，这正是我试图避免的。我需要物理上分开的项目。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-19T18:04:37.023

您可以使用子 Web 项目来执行此操作。自 2005 年以来，它已在 Visual Studio 中可用，并且适用于网站的 Web 应用程序项目样式。[ScottGu 有一篇很棒的博客文章描述了这个过程。](http://weblogs.asp.net/scottgu/archive/2006/08/16/tip_2f00_trick_3a00_-creating-sub_2d00_web-projects-using-the-vs-2005-web-application-project-option.aspx)您可能会面临一些有趣的挑战，让页面混合在同一个文件夹中，但子 Web 项目结构仍应为您提供一些想法。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-19T19:44:10.640

您可以使用带有过滤器的 URL 重写来在每个文件的开头查找“cs”或“vb”并将其定向到适当的目录。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-19T18:04:10.240

我不认为您将能够拥有两个单独的项目，但将它们混合在一个项目中不是问题。如果您觉得有必要，您可以随时将文件整理到文件夹中，以便将它们分开。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-19T18:20:52.507

只是出于好奇，更改您的 url 路径是不可能的吗？而不是 1234/vbpage 和 1234/cspage 怎么样 1234/vb/page 和 1234/cs/page ？我知道你说的是同一个网络根，但我只是好奇:)

# c# - 比较引用类型的两个实例的“最佳实践”是什么？

> ID：104158
> 
> 赞同：48
> 
> 时间：2008-09-19T18:07:02.760
> 
> 标签：c#, .net, comparison, operator-overloading, equality

我最近遇到了这个问题，到目前为止，我一直很高兴地覆盖相等运算符（**==**）和/或**Equals**方法，以查看两个引用类型是否实际上包含相同的**数据**（即看起来相同的两个不同实例）。

自从我更多地参与自动化测试（将参考/预期数据与返回的数据进行比较）以来，我一直在使用它。

在查看[MSDN 中的一些编码标准指南时，](http://msdn.microsoft.com/en-us/library/ms229042(VS.80).aspx)我遇到了[一篇](http://msdn.microsoft.com/en-us/library/7h9bszxx(VS.80).aspx)反对它的文章。现在我明白这篇文章*为什么*这么说（因为它们不是同一个*实例*）但它没有回答这个问题：

1.  **比较两种引用类型的最佳方法是什么？**
2.  我们应该实现[IComparable](http://msdn.microsoft.com/en-us/library/system.icomparable.aspx)吗？（我还看到有人提到这应该只为值类型保留）。
3.  有什么我不知道的接口吗？
4.  我们应该自己动手吗？！

非常感谢^_^

## 更新

看起来我误读了一些文档（这是漫长的一天）并且覆盖[Equals](http://msdn.microsoft.com/en-us/library/336aedhh(VS.71).aspx)可能是要走的路..

> 如果您正在实现引用类型，如果您的类型看起来像 Point、String、BigNumber 等基本类型，则应考虑覆盖引用类型上的 Equals 方法。大多数引用类型不应重载**相等**运算符，即使**它们覆盖 Equals**也是如此。但是，如果您正在实现旨在具有值语义的引用类型，例如复数类型，则应覆盖相等运算符。

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2008-09-19T18:27:11.260

在 .NET 中正确、高效*且不重复代码*地实现相等是很困难的。具体来说，对于具有值语义的引用类型（即[，将等价视为相等的不可变类型](https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/statements-expressions-operators/how-to-define-value-equality-for-a-type)[）`System.IEquatable<T>`](https://msdn.microsoft.com/en-us/library/ms131187%28v=vs.110%29.aspx)，您应该实现[接口](https://msdn.microsoft.com/en-us/library/ms131187%28v=vs.110%29.aspx)，并且您应该实现所有不同的操作（`Equals`,`GetHashCode`和`==`, `!=`）。

例如，这是一个实现值相等的类：

```
class Point : IEquatable<Point> {
    public int X { get; }
    public int Y { get; }

    public Point(int x = 0, int y = 0) { X = x; Y = y; }

    public bool Equals(Point other) {
        if (other is null) return false;
        **return X.Equals(other.X) && Y.Equals(other.Y);**
    }

    public override bool Equals(object obj) => Equals(obj as Point);

    public static bool operator ==(Point lhs, Point rhs) => object.Equals(lhs, rhs);

    public static bool operator !=(Point lhs, Point rhs) => ! (lhs == rhs);

    public override int GetHashCode() => **X.GetHashCode() ^ Y.GetHashCode();**
}
```

上面代码中唯一可移动的部分是粗体部分：第二行`Equals(Point other)`和`GetHashCode()`方法。其他代码应保持不变。

对于不代表不可变值的引用类，不要实现运算符`==`和`!=`。相反，使用它们的默认含义，即比较对象身份。

代码*故意*等同于派生类类型的对象。通常，这可能是不可取的，因为基类和派生类之间的相等性没有明确定义。不幸的是，.NET 和编码指南在这里不是很清楚。Resharper 创建的代码发布[在另一个答案](https://stackoverflow.com/q/104158/1968#104209)中，在这种情况下容易受到不良行为的影响，因为`Equals(object x)`并且`Equals(SecurableResourcePermission x)` *会以*不同的方式处理这种情况。

为了改变这种行为，必须在`Equals`上面的强类型方法中插入额外的类型检查：

```
public bool Equals(Point other) {
    if (other is null) return false;
    if (other.GetType() != GetType()) return false;
    **return X.Equals(other.X) && Y.Equals(other.Y);**
}
```

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2008-09-19T18:13:21.217

看起来你正在用 C# 编码，它有一个名为 Equals 的方法，你的类应该实现，如果你想使用其他度量来比较两个对象，而不是“这两个指针是”（因为对象句柄就是指针）相同的内存地址？”。

我从[这里](http://msdn.microsoft.com/en-us/library/ms173147(VS.80).aspx)获取了一些示例代码：

```
class TwoDPoint : System.Object
{
    public readonly int x, y;

    public TwoDPoint(int x, int y)  //constructor
    {
        this.x = x;
        this.y = y;
    }

    public override bool Equals(System.Object obj)
    {
        // If parameter is null return false.
        if (obj == null)
        {
            return false;
        }

        // If parameter cannot be cast to Point return false.
        TwoDPoint p = obj as TwoDPoint;
        if ((System.Object)p == null)
        {
            return false;
        }

        // Return true if the fields match:
        return (x == p.x) && (y == p.y);
    }

    public bool Equals(TwoDPoint p)
    {
        // If parameter is null return false:
        if ((object)p == null)
        {
            return false;
        }

        // Return true if the fields match:
        return (x == p.x) && (y == p.y);
    }

    public override int GetHashCode()
    {
        return x ^ y;
    }
} 
```

Java 有非常相似的机制。*equals()*方法是*Object*类的一部分，如果你想要这种类型的功能，你的类会重载它。

重载 '==' 对对象来说可能不是一个好主意的原因是，通常，您仍然希望能够进行“这些指针是否相同”的比较。例如，这些通常依赖于将元素插入到不允许重复的列表中，并且如果此运算符以非标准方式重载，您的某些框架内容可能无法工作。

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2009-04-08T16:49:31.980

下面我总结了实现 IEquatable 时需要做的事情，并从各种 MSDN 文档页面中提供了理由。

* * *

## 概括

*   当需要测试值相等时（例如在集合中使用对象时），您应该为您的类实现 IEquatable 接口、覆盖 Object.Equals 和 GetHashCode。
*   当需要测试引用相等性时，您应该使用 operator==,operator!= 和[Object.ReferenceEquals](http://msdn.microsoft.com/en-us/library/system.object.referenceequals.aspx)。
*   [您应该只为ValueTypes](http://msdn.microsoft.com/en-us/library/system.valuetype.aspx)和不可变引用类型覆盖 operator== 和 operator!= 。

* * *

## 理由

**[IEquatable](http://msdn.microsoft.com/en-us/library/ms131187.aspx)**

> System.IEquatable 接口用于比较对象的两个实例是否相等。根据类中实现的逻辑比较对象。比较结果是一个布尔值，指示对象是否不同。这与 System.IComparable 接口相反，后者返回一个整数，指示对象值的不同之处。
> 
> IEquatable 接口声明了两个必须重写的方法。Equals 方法包含执行实际比较的实现，如果对象值相等则返回 true，否则返回 false。GetHashCode 方法应返回一个唯一的哈希值，该值可用于唯一标识包含不同值的相同对象。使用的散列算法类型是特定于实现的。

**[IEquatable.Equals 方法](http://msdn.microsoft.com/en-us/library/ms131190.aspx)**

> *   您应该为您的对象实现 IEquatable 以处理它们将存储在数组或通用集合中的可能性。
> *   如果您实现 IEquatable，您还应该重写 Object.Equals(Object) 和 GetHashCode 的基类实现，以便它们的行为与 IEquatable.Equals 方法的行为一致

**[覆盖 Equals() 和运算符 == 的指南（C# 编程指南）](http://msdn.microsoft.com/en-us/library/ms173147.aspx)**

> *   x.Equals(x) 返回真。
> *   x.Equals(y) 返回与 y.Equals(x) 相同的值
> *   如果 (x.Equals(y) && y.Equals(z)) 返回 true，则 x.Equals(z) 返回 true。
> *   x 的连续调用。只要 x 和 y 引用的对象没有被修改，等于 (y) 就会返回相同的值。
> *   X。Equals (null) 返回 false（仅适用于不可为空的值类型。有关更多信息，请参阅[可空类型（C# 编程指南）](http://msdn.microsoft.com/en-us/library/1t3y8s4s.aspx)。）
> *   Equals 的新实现不应该抛出异常。
> *   建议任何覆盖 Equals 的类也覆盖 Object.GetHashCode。
> *   建议任何类除了实现 Equals(object) 外，还为自己的类型实现 Equals(type)，以提高性能。
> 
> **默认情况下，运算符 == 通过确定两个引用是否指示同一个对象来测试引用是否相等。**因此，引用类型不必实现 operator == 即可获得此功能。当类型是不可变的，即实例中包含的数据不能更改时，重载运算符 == 来比较值相等而不是引用相等可能很有用，因为作为不可变对象，它们可以被视为与 long 相同因为它们具有相同的价值。**在非不可变类型中覆盖 operator == 不是一个好主意。**
> 
> *   重载的运算符 == 实现不应抛出异常。
> *   任何重载运算符 == 的类型也应该重载运算符 !=。

**[== 运算符（C# 参考）](http://msdn.microsoft.com/en-us/library/53k8ybth.aspx)**

> *   对于预定义的值类型，相等运算符 (==) 如果其操作数的值相等则返回 true，否则返回 false。
> *   对于字符串以外的引用类型，== 如果它的两个操作数引用同一个对象，则返回 true。
> *   对于字符串类型，== 比较字符串的值。
> *   在 operator== 覆盖中使用 == 比较测试 null 时，请确保使用基对象类运算符。如果不这样做，将发生无限递归，从而导致堆栈溢出。

**[Object.Equals 方法（对象）](http://msdn.microsoft.com/en-us/library/bsc2ak47.aspx)**

> 如果您的编程语言支持运算符重载，并且您选择为给定类型重载相等运算符，则该类型必须覆盖 Equals 方法。Equals 方法的此类实现必须返回与相等运算符相同的结果
> 
> 以下指南用于实现**值类型**：
> 
> *   考虑覆盖 Equals 以获得比 ValueType 上 Equals 的默认实现所提供的性能更高的性能。
> *   如果重写 Equals 并且语言支持运算符重载，则必须为值类型重载相等运算符。
> 
> 以下指南用于实现**引用类型**：
> 
> *   如果类型的语义基​​于该类型表示某些值这一事实，请考虑在引用类型上覆盖 Equals。
> *   大多数引用类型不能重载相等运算符，即使它们重写了 Equals。但是，如果您正在实现旨在具有值语义的引用类型，例如复数类型，则必须覆盖相等运算符。

* * *

## 额外的陷阱

*   覆盖 GetHashCode() 时，请确保在哈希码中使用它们之前测试 NULL 的引用类型。
*   我遇到了此处描述的基于接口的编程和运算符重载的问题：[Operator Overloading with Interface-Based Programming in C#](https://stackoverflow.com/questions/728434/operator-overloading-with-interface-based-programming-in-c)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-19T18:15:27.687

那篇文章只是建议不要重写相等运算符（对于引用类型），而不是反对重写 Equals。如果相等检查不仅仅意味着引用检查，您应该在对象（引用或值）中覆盖 Equals。如果你想要一个接口，你也可以实现[IEquatable](http://msdn.microsoft.com/en-us/library/ms131187.aspx)（由泛型集合使用）。但是，如果您确实实现了 IEquatable，则还应该覆盖 equals，正如 IEquatable 备注部分所述：

> 如果实现 IEquatable<T>，还应该重写 Object.Equals(Object) 和 GetHashCode 的基类实现，以使它们的行为与 IEquatable<T>.Equals 方法的行为一致。如果您确实重写了 Object.Equals(Object)，那么在调用类上的静态 Equals(System.Object, System.Object) 方法时也会调用您重写的实现。这确保了 Equals 方法的所有调用都返回一致的结果。

关于是否应该实现 Equals 和/或相等运算符：

从[实现 Equals 方法](http://msdn.microsoft.com/en-us/library/336aedhh(VS.80).aspx)

> 大多数引用类型不应该重载相等运算符，即使它们覆盖了 Equals。

来自[实现等式和等式运算符的指南 (==)](http://msdn.microsoft.com/en-us/library/7h9bszxx(VS.80).aspx)

> 每当您实现相等运算符 (==) 时，重写 Equals 方法，并使它们执行相同的操作。

这仅表示您需要在实现相等运算符时覆盖 Equals。它并*没有*说在重写 Equals 时需要重写相等运算符。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-19T18:10:33.110

对于将产生特定比较的复杂对象，实现 IComparable 并在 Compare 方法中定义比较是一个很好的实现。

例如，我们有“车辆”对象，其中唯一的区别可能是注册号，我们使用它来比较以确保测试中返回的预期值是我们想要的。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-19T18:15:37.717

我倾向于使用 Resharper 自动制作的东西。例如，它为我的一种引用类型自动创建了这个：

```
public override bool Equals(object obj)
{
    if (ReferenceEquals(null, obj)) return false;
    if (ReferenceEquals(this, obj)) return true;
    return obj.GetType() == typeof(SecurableResourcePermission) && Equals((SecurableResourcePermission)obj);
}

public bool Equals(SecurableResourcePermission obj)
{
    if (ReferenceEquals(null, obj)) return false;
    if (ReferenceEquals(this, obj)) return true;
    return obj.ResourceUid == ResourceUid && Equals(obj.ActionCode, ActionCode) && Equals(obj.AllowDeny, AllowDeny);
}

public override int GetHashCode()
{
    unchecked
    {
        int result = (int)ResourceUid;
        result = (result * 397) ^ (ActionCode != null ? ActionCode.GetHashCode() : 0);
        result = (result * 397) ^ AllowDeny.GetHashCode();
        return result;
    }
} 
```

如果您想覆盖`==`并仍然进行 ref 检查，您仍然可以使用`Object.ReferenceEquals`.

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2016-09-19T20:02:02.673

微软似乎改变了他们的态度，或者至少有关于不重载相等运算符的相互矛盾的信息。根据这篇题为“如何：为类型定义值相等”的[Microsoft 文章：](https://msdn.microsoft.com/en-us/library/dd183755.aspx)

“== 和 != 运算符可以与类一起使用，即使类没有重载它们。但是，默认行为是执行引用相等检查。在类中，如果重载 Equals 方法，则应该重载== 和 != 运算符，但这不是必需的。”

根据 Eric Lippert 在他对我询问的关于[C# 中相等的最小代码的问题的](https://stackoverflow.com/questions/32172273/minimal-code-for-equality-in-c-sharp)[回答](https://stackoverflow.com/a/32184635/643828)中- 他说：

“你在这里遇到的危险是你得到一个为你定义的 == 运算符，它默认引用相等。你很容易陷入重载的 Equals 方法确实值相等而 == 引用相等的情况，然后你不小心在值相等的非引用相等的事物上使用了引用相等。这是一种容易出错的做法，人工代码审查很难发现。

几年前，我研究了一种静态分析算法来统计检测这种情况，我们发现在我们研究的所有代码库中，每百万行代码中大约有两个实例的缺陷率。仅考虑在某处覆盖了 Equals 的代码库时，缺陷率显然要高得多！

此外，考虑成本与风险。如果您已经有 IComparable 的实现，那么编写所有运算符是微不足道的单行代码，不会有错误并且永远不会更改。这是您编写的最便宜的代码。如果要在编写和测试十几个小方法的固定成本与查找和修复使用引用相等而不是值相等的难以发现的错误的无限成本之间进行选择，我知道我会选择哪一个。”

.NET Framework 永远不会将 == 或 != 用于您编写的任何类型。但是，危险是如果其他人这样做会发生什么。因此，如果课程是为第 3 方准备的，那么我将始终提供 == 和 != 运算符。如果该类仅打算由组内部使用，我仍然可能会实现 == 和 != 运算符。

如果实现了 IComparable，我只会实现 <、<=、> 和 >= 运算符。只有在类型需要支持排序时才应实现 IComparable - 例如在排序或在有序通用容器（如 SortedSet）中使用时。

如果集团或公司制定了永远不实施 == 和 != 运算符的政策 - 那么我当然会遵循该政策。如果有这样的策略，那么明智的做法是使用 Q/A 代码分析工具来执行它，该工具在与引用类型一起使用时标记 == 和 != 运算符的任何出现。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2012-12-16T20:17:47.890

我相信使用 .NET 的设计来获得像检查对象是否相等这样简单的东西有点棘手。

**对于结构**

1）实施`IEquatable<T>`。它显着提高了性能。

2）既然你现在有自己的`Equals`，覆盖`GetHashCode`，并与各种相等检查覆盖保持一致`object.Equals`。

3) 重载`==`和`!=`运算符不需要认真地完成，因为如果您无意地将一个结构与另一个等同于 a ，编译器会发出警告`==`or `!=`，但这样做是为了与`Equals`方法保持一致。

```
public struct Entity : IEquatable<Entity>
{
    public bool Equals(Entity other)
    {
        throw new NotImplementedException("Your equality check here...");
    }

    public override bool Equals(object obj)
    {
        if (obj == null || !(obj is Entity))
            return false;

        return Equals((Entity)obj);
    }

    public static bool operator ==(Entity e1, Entity e2)
    {
        return e1.Equals(e2);
    }

    public static bool operator !=(Entity e1, Entity e2)
    {
        return !(e1 == e2);
    }

    public override int GetHashCode()
    {
        throw new NotImplementedException("Your lightweight hashing algorithm, consistent with Equals method, here...");
    }
} 
```

**上课**

来自女士：

> 大多数引用类型不应该重载相等运算符，即使它们覆盖了 Equals。

对我来说`==`，感觉就像价值平等，更像是`Equals`方法的语法糖。写作`a == b`比写作更直观`a.Equals(b)`。我们很少需要检查引用相等性。在处理物理对象的逻辑表示的抽象级别中，这不是我们需要检查的。我认为具有不同的语义`==`并且`Equals`实际上可能会令人困惑。我相信它首先应该是`==`为了价值平等和`Equals`参考（或更好的名字，比如`IsSameAs`）平等。*我不想在这里认真对待 MS 指南，不仅因为它对我来说不自然，而且因为超载`==`不会造成任何重大伤害。*这不像不覆盖非泛型`Equals`或者`GetHashCode`可以反击，因为框架不会`==`在任何地方使用，只有当我们自己使用它时。*我从不重载`==``!=`*中获得的唯一真正好处是*与*我无法控制的整个框架的设计保持一致。这确实是一件大事，**所以很遗憾我会坚持下去**。

*使用引用语义（可变对象）*

1) 覆盖`Equals`和`GetHashCode`。

2）实施`IEquatable<T>`不是必须的，但如果你有一个会很好。

```
public class Entity : IEquatable<Entity>
{
    public bool Equals(Entity other)
    {
        if (ReferenceEquals(this, other))
            return true;

        if (ReferenceEquals(null, other))
            return false;

        //if your below implementation will involve objects of derived classes, then do a 
        //GetType == other.GetType comparison
        throw new NotImplementedException("Your equality check here...");
    }

    public override bool Equals(object obj)
    {
        return Equals(obj as Entity);
    }

    public override int GetHashCode()
    {
        throw new NotImplementedException("Your lightweight hashing algorithm, consistent with Equals method, here...");
    }
} 
```

*具有值语义（不可变对象）*

这是棘手的部分。不小心很容易搞砸。。

1) 覆盖`Equals`和`GetHashCode`。

2）重载`==`和`!=`匹配`Equals`。*确保它适用于 nulls*。

2）实施`IEquatable<T>`不是必须的，但如果你有一个会很好。

```
public class Entity : IEquatable<Entity>
{
    public bool Equals(Entity other)
    {
        if (ReferenceEquals(this, other))
            return true;

        if (ReferenceEquals(null, other))
            return false;

        //if your below implementation will involve objects of derived classes, then do a 
        //GetType == other.GetType comparison
        throw new NotImplementedException("Your equality check here...");
    }

    public override bool Equals(object obj)
    {
        return Equals(obj as Entity);
    }

    public static bool operator ==(Entity e1, Entity e2)
    {
        if (ReferenceEquals(e1, null))
            return ReferenceEquals(e2, null);

        return e1.Equals(e2);
    }

    public static bool operator !=(Entity e1, Entity e2)
    {
        return !(e1 == e2);
    }

    public override int GetHashCode()
    {
        throw new NotImplementedException("Your lightweight hashing algorithm, consistent with Equals method, here...");
    }
} 
```

**如果您的类可以被继承，请特别注意看看它应该如何处理，在这种情况下，您必须确定基类对象是否可以等于派生类对象。理想情况下，如果没有派生类的对象用于相等性检查，则基类实例可以等于派生类实例，在这种情况下，不需要在基类`Type`的泛型中检查相等性。`Equals`**

通常注意不要重复代码。我本可以制作一个通用抽象基类（`IEqualizable<T>`或其他）作为模板，以便更轻松地重用，但遗憾的是在 C# 中这阻止了我从其他类派生。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2018-07-02T06:30:32.117

上面的所有答案都没有考虑多态性，通常您希望派生引用使用派生 Equals，即使通过基本引用进行比较也是如此。请在此处查看问题/讨论/答案 -[平等和多态性](https://stackoverflow.com/questions/54877077/equality-and-polymorphism/54934113#54934113)

# c# - 如何在 .NET HTML 邮件消息中嵌入图像？

> ID：104177
> 
> 赞同：23
> 
> 时间：2008-09-19T18:10:26.917
> 
> 标签：c#, .net, html

我有一个 HTML 邮件模板，带有图像的占位符。我正在从数据库中获取需要发送的图像并将其保存到照片目录中。我需要将图像嵌入 HTML 消息中。

我已经探索过使用 AlternateView：

```
AlternateView htmlView = AlternateView.CreateAlternateViewFromString("<HTML> <img src=cid:VisitorImage> </HTML>");

LinkedResource VisitorImage = new LinkedResource(p_ImagePath);
VisitorImage.ContentId= "VisitorImage";
htmlView.LinkedResources.Add(VisitorImage); 
```

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-09-19T18:17:01.707

试试这个：

```
LinkedResource objLinkedRes = new LinkedResource(
            Server.MapPath(".") + "\\fuzzydev-logo.jpg", 
            "image/jpeg");
objLinkedRes.ContentId = "fuzzydev-logo";       
AlternateView objHTLMAltView = AlternateView.CreateAlternateViewFromString(
            "<img src='cid:fuzzydev-logo' />", 
            new System.Net.Mime.ContentType("text/html"));
objHTLMAltView.LinkedResources.Add(objLinkedRes);
objMailMessage.AlternateViews.Add(objHTLMAltView); 
```

# java - 从多个线程（不修改）从 java.util.HashMap 获取值是否安全？

> ID：104184
> 
> 赞同：156
> 
> 时间：2008-09-19T18:11:38.660
> 
> 标签：java, multithreading, concurrency, hashmap

有一种情况，地图会被构造出来，一旦初始化，就再也不会被修改了。但是，它将被多个线程访问（仅通过 get(key)）。以这种方式使用 a 是否安全`java.util.HashMap`？

（目前，我很高兴使用 a `java.util.concurrent.ConcurrentHashMap`，并且没有衡量提高性能的需要，但我只是好奇一个简单`HashMap`是否就足够了。因此，这个问题*不是*“我应该使用哪个？”也不是性能问题。相反，问题是“它安全吗？”）

* * *

## 回答 #1

> 赞同：70
> 
> 时间：2008-09-19T18:56:36.713

杰里米·曼森（Jeremy Manson），Java 内存模型之神，有一篇关于这个主题的三部分博客——因为本质上你是在问“访问不可变的 HashMap 是否安全”这个问题——答案是肯定的。但是您必须回答该问题的谓词 - “我的 HashMap 是否不可变”。答案可能会让您大吃一惊——Java 有一组相对复杂的规则来确定不变性。

有关该主题的更多信息，请阅读 Jeremy 的博客文章：

第 1 部分关于 Java 中的不变性：http: [//jeremymanson.blogspot.com/2008/04/immutability-in-java.html](http://jeremymanson.blogspot.com/2008/04/immutability-in-java.html)

关于 Java 中的不变性的第 2 部分：http: [//jeremymanson.blogspot.com/2008/07/immutability-in-java-part-2.html](http://jeremymanson.blogspot.com/2008/07/immutability-in-java-part-2.html)

第 3 部分关于 Java 中的不变性：http: [//jeremymanson.blogspot.com/2008/07/immutability-in-java-part-3.html](http://jeremymanson.blogspot.com/2008/07/immutability-in-java-part-3.html)

* * *

## 回答 #2

> 赞同：63
> 
> 时间：2017-02-01T21:45:51.173

**当且仅当**对 的引用`HashMap`被*安全发布*时，您的习语才是安全的。与任何与`HashMap`自身内部相关的内容不同，*安全发布*处理的是构造线程如何使对映射的引用对其他线程可见。

基本上，这里唯一可能的竞争是在它的构建`HashMap`和任何可能在它完全构建之前访问它的读取线程之间。大部分讨论是关于地图对象的状态会发生什么，但这无关紧要，因为您从不修改它 - 所以唯一有趣的部分是`HashMap`引用是如何发布的。

例如，假设您像这样发布地图：

```
class SomeClass {
   public static HashMap<Object, Object> MAP;

   public synchronized static setMap(HashMap<Object, Object> m) {
     MAP = m;
   }
} 
```

...并且在某些时候`setMap()`使用地图调用，并且其他线程正在使用`SomeClass.MAP`来访问地图，并像这样检查 null ：

```
HashMap<Object,Object> map = SomeClass.MAP;
if (map != null) {
  .. use the map
} else {
  .. some default behavior
} 
```

这是**不安全**的，即使它看起来好像是。问题是在另一个线程上的集合和后续读取之间没有[*发生之前*](https://docs.oracle.com/javase/tutorial/essential/concurrency/memconsist.html)的关系`SomeObject.MAP`，因此读取线程可以自由地看到部分构造的映射。这几乎可以做*任何事情*，甚至在实践中它也会做一些事情，比如[将阅读线程放入无限循环](http://mailinator.blogspot.com/2009/06/beautiful-race-condition.html)中。

为了安全地发布地图，您需要在对 的引用（即*发布）的**编写和该引用*的后续读者（即消费）之间建立*发生前的*关系。方便的是，只有几种容易记住的方法可以[实现](https://stackoverflow.com/q/5458848/149138)这一点^([1])：*`HashMap`*

 **1.  通过正确锁定的字段交换引用 ( [JLS 17.4.5](http://docs.oracle.com/javase/specs/jls/se8/html/jls-17.html#jls-17.4.5) )
2.  使用静态初始化器进行初始化存储（[JLS 12.4](http://docs.oracle.com/javase/specs/jls/se8/html/jls-12.html#jls-12.4)）
3.  通过 volatile 字段 ( [JLS 17.4.5](http://docs.oracle.com/javase/specs/jls/se8/html/jls-17.html#jls-17.4.5) ) 或作为此规则的结果，通过 AtomicX 类交换引用
4.  将值初始化为最终字段（[JLS 17.5](http://docs.oracle.com/javase/specs/jls/se8/html/jls-17.html#jls-17.5)）。

您的场景中最有趣的是 (2)、(3) 和 (4)。特别是，（3）直接适用于我上面的代码：如果您将声明转换`MAP`为：

```
public static volatile HashMap<Object, Object> MAP; 
```

*那么一切都是 kosher：看到非空*值的读者必然与 store 有*发生前的*关系，`MAP`因此可以看到与地图初始化相关联的所有商店。

其他方法会更改方法的语义，因为 (2)（使用静态初始化程序）和 (4)（使用*final*）都暗示您不能`MAP`在运行时动态设置。如果您*不需*要这样做，那么只需声明`MAP`为 a`static final HashMap<>`即可保证安全发布。

在实践中，安全访问“从未修改过的对象”的规则很简单：

如果您发布的对象*本质上不是不可变*的（如在声明的所有字段中`final`）并且：

*   您已经可以创建将在声明时分配的对象^a：只需使用一个`final`字段（包括`static final`静态成员）。
*   在引用已经可见之后，您想稍后分配对象：使用 volatile 字段^b。

就是这样！

在实践中，它非常有效。例如，使用`static final`字段允许 JVM 假定该值在程序的生命周期内保持不变并对其进行大量优化。成员字段的使用`final`允许*大多数*架构以与普通字段读取等效的方式读取字段，并且不会抑制进一步的优化^c。

最后，使用`volatile`确实会产生一些影响：在许多架构（例如 x86，特别是那些不允许读取通过读取的架构上）不需要硬件屏障，但是在编译时可能不会发生一些优化和重新排序 - 但这一般影响不大。作为交换，您实际上得到的比您所要求的要多——您不仅可以安全地发布一个`HashMap`，您还可以存储尽可能多的未修改`HashMap`的 s 到同一参考，并确保所有读者都会看到安全发布的地图.

有关更多详细信息，请参阅[Shipilev](https://shipilev.net/blog/2014/safe-public-construction/)或[Manson 和 Goetz 的此常见问题解答](https://www.cs.umd.edu/~pugh/java/memoryModel/jsr-133-faq.html#finalRight)。

* * *

[1] 直接引自[shipilev](https://shipilev.net/blog/2014/safe-public-construction/)。

* * *

^a这听起来很复杂，但我的意思是您可以在构造时分配引用 - 在声明点或构造函数（成员字段）或静态初始化程序（静态字段）中。

^b或者，您可以使用一种`synchronized`方法来获取/设置，或者一个`AtomicReference`或其他东西，但我们谈论的是您可以做的最少工作。

c 一些内存模型非常弱的架构（我在看*你*，Alpha）在读取之前可能需要某种类型的读取屏障`final`——但这些在今天非常罕见。

* * *

## 回答 #3

> 赞同：37
> 
> 时间：2008-09-19T19:10:10.317

从同步的角度来看，读取是安全的，但从内存的角度来看却不是。这在包括 Stackoverflow 在内的 Java 开发人员中被广泛误解。（观察[这个答案](https://stackoverflow.com/questions/84285/calling-threadstart-within-its-own-constructor#84937)的评级以作证明。）

如果您有其他线程正在运行，如果当前线程没有内存写入，他们可能看不到 HashMap 的更新副本。内存写入是通过使用 synchronized 或 volatile 关键字，或者通过使用一些 java 并发结构来实现的。

有关详细信息，请参阅[Brian Goetz 关于新 Java 内存模型的文章](http://www.ibm.com/developerworks/java/library/j-jtp03304/)。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2008-09-19T18:20:40.137

多看几眼后，我在[java doc](http://java.sun.com/javase/6/docs/api/java/util/HashMap.html)中找到了这个（强调我的）：

> 请注意，此实现不同步。 **如果多个线程同时访问一个哈希映射，并且至少有一个线程在结构上修改了映射，则它必须在外部同步。**（结构修改是添加或删除一个或多个映射的任何操作；仅更改与实例已包含的键关联的值不是结构修改。）

这似乎意味着它将是安全的，假设陈述的相反是真实的。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2008-09-19T21:13:09.287

需要注意的是，在某些情况下，来自未同步 HashMap 的 get() 可能会导致无限循环。如果并发 put() 导致 Map 重新散列，则可能发生这种情况。

[http://lightbody.net/blog/2005/07/hashmapget_can_cause_an_infini.html](http://lightbody.net/blog/2005/07/hashmapget_can_cause_an_infini.html)

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2008-09-19T19:16:10.410

不过有一个重要的转折。访问映射是安全的，但通常不能保证所有线程都会看到完全相同的 HashMap 状态（以及值）。这可能发生在多处理器系统上，其中一个线程（例如，填充它的线程）对 HashMap 的修改可以位于该 CPU 的缓存中，并且不会被其他 CPU 上运行的线程看到，直到内存栅栏操作发生执行确保缓存一致性。Java 语言规范对此有明确的说明：解决方案是获取一个锁（同步（...）），它会发出内存围栏操作。因此，如果您确定在填充 HashMap 后每个线程都获得了 ANY 锁，那么从那时起就可以从任何线程访问 HashMap，直到再次修改 HashMap。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2012-08-30T16:08:32.307

根据[http://www.ibm.com/developerworks/java/library/j-jtp03304/](http://www.ibm.com/developerworks/java/library/j-jtp03304/) # Initialization safety 您可以将 HashMap 设置为 final 字段，并在构造函数完成后将其安全发布。

...在新的内存模型下，在构造函数中写入最终字段与在另一个线程中对该对象的共享引用的初始加载之间存在类似于发生前的关系。...

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2019-11-19T12:31:42.587

这个问题在 Brian Goetz 的“Java Concurrency in Practice”一书（清单 16.8，第 350 页）中得到了解决：

```
@ThreadSafe
public class SafeStates {
    private final Map<String, String> states;

    public SafeStates() {
        states = new HashMap<String, String>();
        states.put("alaska", "AK");
        states.put("alabama", "AL");
        ...
        states.put("wyoming", "WY");
    }

    public String getAbbreviation(String s) {
        return states.get(s);
    }
} 
```

由于`states`被声明为`final`并且它的初始化是在所有者的类构造函数中完成的，因此以后读取此映射的任何线程都可以保证在构造函数完成时看到它，前提是没有其他线程会尝试修改映射的内容。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-11-09T16:37:06.927

因此，您描述的场景是您需要将一堆数据放入 Map 中，然后当您完成填充它时，您将其视为不可变的。一种“安全”的方法（意味着您正在强制它确实被视为不可变）是`Collections.unmodifiableMap(originalMap)`在您准备好使其不可变时替换引用。

有关如果同时使用地图可能会失败的严重程度以及我提到的建议解决方法的示例，请查看此错误游行条目：[bug_id=6423457](http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=6423457)

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-19T18:38:06.257

请注意，即使在单线程代码中，用 HashMap 替换 ConcurrentHashMap 也可能不安全。ConcurrentHashMap 禁止将 null 作为键或值。HashMap 并没有禁止它们（不要问）。

因此，在不太可能的情况下，您的现有代码可能会在设置期间将 null 添加到集合中（可能是在某种失败情况下），按照描述替换集合将改变功能行为。

也就是说，只要你什么都不做，从 HashMap 并发读取是安全的。

[编辑：通过“并发读取”，我的意思是没有并发修改。

其他答案解释了如何确保这一点。一种方法是使地图不可变，但这不是必需的。例如，JSR133 内存模型明确将启动线程定义为同步操作，这意味着线程 A 在启动线程 B 之前所做的更改在线程 B 中是可见的。

我的意图不是与那些关于 Java 内存模型的更详细的答案相矛盾。这个答案旨在指出，即使除了并发问题，ConcurrentHashMap 和 HashMap 之间至少存在一个 API 差异，这甚至可能破坏一个用另一个替换一个的单线程程序。]

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-19T18:19:21.857

[http://www.docjar.com/html/api/java/util/HashMap.java.html](http://www.docjar.com/html/api/java/util/HashMap.java.html)

这是HashMap的来源。如您所知，那里绝对没有锁定/互斥代码。

这意味着虽然在多线程情况下可以从 HashMap 读取，但如果有多次写入，我肯定会使用 ConcurrentHashMap。

有趣的是 .NET HashTable 和 Dictionary<K,V> 都内置了同步代码。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2016-09-28T11:38:27.630

如果初始化和每个 put 是同步的，那么您就可以保存了。

以下代码被保存，因为类加载器将负责同步：

```
public static final HashMap<String, String> map = new HashMap<>();
static {
  map.put("A","A");

} 
```

以下代码被保存，因为 volatile 的编写将负责同步。

```
class Foo {
  volatile HashMap<String, String> map;
  public void init() {
    final HashMap<String, String> tmp = new HashMap<>();
    tmp.put("A","A");
    // writing to volatile has to be after the modification of the map
    this.map = tmp;
  }
} 
```

如果成员变量是 final 的，这也将起作用，因为 final 也是 volatile。如果方法是构造函数。**

# java - JPA 1 不够好

> ID：104185
> 
> 赞同：1
> 
> 时间：2008-09-19T18:11:40.393
> 
> 标签：java, hibernate, jpa

过去 4 个月在一个中等规模的项目中工作——我们正在使用 JPA 和 Spring——我很确定 JPA 对于需要超过 CRUD 屏幕的项目来说并不强大......查询界面很差，Hibernate 不尊重 JPA规范一直很多时候我需要使用休眠类、注释和配置。大家觉得JPA怎么样？还不够好吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-19T19:11:57.877

Hibernate 已经走了很长时间。这就是为什么它具有许多 JPA 中尚不可用的功能。但随着时间的推移，JPA 会迎头赶上。在此之前，在必要时使用 JPA 和 Hibernate 特定设置。如果您以后需要切换，它会容易得多。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-19T18:16:29.850

好吧，我认为大多数时候 JPA “足够好”，但我非常想念 Criteria API（仅由 Hibernate 提供）

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-19T18:19:37.130

好吧，如果不了解您的具体情况，我无法提供具体指导。似乎您正在使用 Hibernate 的 JPA 实现。如果您不喜欢 Hibernate 的某些内容，您可以尝试其他 JPA 实现。就查询界面而言，如果 JPA 的查询没有按照您的意愿执行，您始终能够获得一个普通的旧 Connection 并使用它。该框架的天才之处在于——至少——您不必再编写所有的 CRUD 代码。我永远不会声称 JPA 是完美的，但它比一直手写 SQL 来做琐碎的事情要好。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2010-05-28T11:29:16.483

我们通过我们的内部包装框架结合了 JPA 2.0、Hibernate Core、Hibernate Search 和 Hibernate Validator。它完成了我们投入的一切:)

将它与 Maven 结合起来，我们也为我们构建了一个数据库！将 DBUnit 添加到组合中，您就拥有了所需的一切。

通过 Lucene 快速搜索，但使用 Hibernate Criteria/HQL 查询非常酷。GWT 建议框背后的所有这些功能都很棒。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-19T21:03:22.050

我的建议是简单地使用 Hibernate。Hibernate 加上 JPA​​ 注释 + Hibernate 注释非常强大。您甚至可以配置一个 EntityManagerFactory 来自动发现类路径上的实体，然后调用 getSessionFactory() 来利用应用程序中的本机 Hibernate API。如果您使用 Spring，则使用 LocalContainerEntityManagerFactoryBean 和 HibernateJpaVendorAdapter 很容易做到这一点。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-19T19:11:35.087

使用 JPA 与 Hibernate Annotations 的好处之一是持久类的自动配置和发现。此外，这取决于您需要在多少时间内停止使用 JPA API，如果您只使用 10% 的时间，与使用 hibernate 100 相比，它仍然会使切换提供程序容易得多% 的查询。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-19T18:27:32.553

当然，任何 ORM 都比用于 CRUD 操作的手写 SQL 更好……问题是：我认为没有理由使用 JPA 代替纯 Hibernate，因为我经常混合使用两者。如果我没有获得隐藏的提供者，为什么还要使用 JPA？

# wmi - 如何删除已发布的 wmi 架构？

> ID：104188
> 
> 赞同：2
> 
> 时间：2008-09-19T18:12:08.817
> 
> 标签：wmi

我已经发布了架构，并且不再拥有包含发布架构的 wmi 提供程序的 dll。如何删除架构？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-19T19:11:28.627

如果您从其他问题谈论程序集，您可以简单地使用 wbemtest.exe：

*   连接到根命名空间
*   枚举实例...按钮（超类名称：__Namespace）
*   删除名为 Test 或 MyTest 的实例

这将删除整个命名空间，包括您创建的所有类。如果你想删除一个类并离开命名空间

*   连接到根\测试
*   枚举类...按钮（递归）
*   删除你想要的课程

如果有多台机器，可以使用 WMI 脚本库或 System.Management 自动执行此操作。使用 MOF，您可以使用#pragma deleteclass。如果架构是使用 #pragma autorecover 创建的，则需要从

HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\WBEM\CIMOM\autorecover mofs

# code-analysis - 静态代码分析的好处

> ID：104196
> 
> 赞同：11
> 
> 时间：2008-09-19T18:12:55.960
> 
> 标签：code-analysis

对源代码进行静态代码分析有什么好处？我正在玩 FxCop，我想知道除了确保您遵循编码标准之外是否还有其他好处。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-09-19T18:18:30.253

有各种各样的好处：

1.  如果您的代码中有反模式，您可能会收到警告。
2.  有某些指标（例如 McCabe 的圈复杂度）可以说明有关源代码的有用信息。
3.  您还可以从静态分析中获得很棒的东西，例如调用图和类图。如果你正在攻击一个新的代码库，那真是太好了。

看看[SourceMonitor](http://www.campwoodsw.com/sourcemonitor.html)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-19T18:17:55.933

许多类的内存泄漏和常见的逻辑错误也可以静态捕获。您还可以查看圈复杂度等，这可能是您提到的“编码标准”的一部分，但可能是您用来评估代码的算法“清洁度”的单独指标。

在任何情况下，只有将分析（动态或运行时分析）和静态分析/linting 巧妙地结合起来才能确保代码库的一致、可靠。哦，那，还有一点运气；-)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-19T18:19:26.397

这是一个权衡。对于想要提高对框架和指南的理解的个人开发人员，我肯定会鼓励它。FxCop 会产生很多噪音/误报，但我还发现了以下好处：

*   它检测错误（例如，关于未使用参数的警告可能表明您在方法主体中使用了错误的参数）。

*   了解 FxCop 所遵循的指南有助于您成为更好的开发人员。

然而，对于一个混合能力的团队，FxCop 很可能会产生太多的误报而无用。初级开发人员将难以理解 FxCop 提出的一些更深奥的违规行为是否应该引起他们的关注，或者仅仅是噪音。

底线：

*   如果您正在开发可重用的类库，例如内部框架，请确保您有优秀的开发人员并使用 FxCop。

*   对于具有混合能力团队的日常应用程序开发，这可能是不切实际的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-19T18:16:12.037

实际上，fxcop 并不能特别帮助您遵循编码标准。它确实可以帮助您设计一个经过深思熟虑的框架/API。FxCop 确实会捕获部分编码标准（例如公共成员的外壳），但编码标准不是重点。

可以使用[stylecop](http://code.msdn.microsoft.com/sourceanalysis)检查编码标准，它检查源代码而不是像 fxcop 那样检查 MSIL。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-19T18:17:22.610

它可以捕获实际的错误，例如忘记 Dispose IDisposables。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-19T18:18:13.030

取决于规则，但可以避免许多细微的缺陷，可以清理代码，可以检测潜在的性能问题等。

换一种方式...如果它便宜或免费（在时间和财务成本方面）并且不会破坏任何东西，为什么不使用它呢？

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-19T18:30:16.743

# FxCop

FxCop中有一个[所有警告](http://msdn.microsoft.com/en-us/library/bb429379(VS.80).aspx)的列表。您可以看到来自以下区域的警告：

> ## 设计警告
> 
> 支持 .NET Framework 设计指南指定的正确库设计的警告。
> 
> ## 全球化警告
> 
> 支持全球通用库和应用程序的警告。
> 
> ## 互操作性警告
> 
> 支持与 COM 客户端交互的警告。
> 
> ## 命名警告
> 
> 支持遵守 .NET Framework 设计指南的命名约定的警告。
> 
> ## 性能警告
> 
> 支持高性能库和应用程序的警告。
> 
> ## 安全警告
> 
> 支持更安全的库和应用程序的警告。

根据您的应用程序，其中一些领域可能不是很有趣，但如果您需要 COM 互操作性，这些测试确实可以帮助您避免这些陷阱。

# 其他工具

其他静态检查工具可以帮助您检测错误，例如[未处理 IDisposable](https://stackoverflow.com/questions/104196/benefits-of-static-code-analysis#104226)、内存泄漏和其他细微错误。对于极端情况，请参阅尚未发布的[NStatic](http://codebetter.com/blogs/raymond.lewallen/archive/2007/03/18/Another-big-splash-in-Redmond-_2D00_-NStatic.aspx)工具。

> NStatic 用于跟踪诸如冗余参数、评估为常量的表达式、无限循环和许多其他指标之类的东西。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2011-05-06T06:54:39.207

好处是您可以自动查找和量化软件应用程序中的[技术债务。](http://andrewmatthewthompson.blogspot.com/2011/05/technical-debt.html)

我发现静态代码分析工具在大型企业应用程序开发中必不可少，许多开发人员和测试人员在应用程序的生命周期中来来往往，但仍然需要保持较高的代码质量并妥善管理技术债务。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2011-09-26T12:36:53.437

*对源代码进行静态代码分析有什么好处？*

好处取决于所执行的静态代码分析的类型。静态代码分析的范围可以从简单到复杂的技术。例如，生成有关源代码的指标以识别容易出错的代码是一种技术。其他技术积极尝试在您的代码中查找错误。复杂的技术使用正式的方法来证明您的代码没有错误。

因此，好处取决于所使用的静态代码分析的类型。如果该技术产生度量（例如代码复杂性等），那么好处是可以在代码审查期间使用这些度量来识别容易出错的代码。如果该技术检测到错误，那么好处是开发人员可以在单元测试之前识别错误。如果使用基于形式方法的技术来证明代码不包含错误，那么好处是可以使用此信息向 QA 部门（或认证机构）证明代码没有某些类型的错误。

更详细的技术和好处描述也可以在这个页面上找到：[www.mathworks.com/static-analysis](http://www.mathworks.com/static-analysis)

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2017-06-30T18:05:19.420

我将尝试描述主要的：

*   静态代码分析在早期阶段识别程序中的检测，从而降低修复它们的成本。
*   它可以检测程序输入和输出中无法通过动态测试看到的缺陷。
*   它会自动扫描未编译的代码并识别漏洞。
*   我从与 checkmarx 打交道中了解到，静态代码分析可以一次性修复多个漏洞，这为开发人员节省了大量时间。

# php - PHP 中的 cURL 在 _FILE 和 _RETURNTRANSFER 中返回不同的数据

> ID：104223
> 
> 赞同：1
> 
> 时间：2008-09-19T18:17:02.457
> 
> 标签：php, curl

我注意到 PHP 中的 cURL 在被告知通过 输出到文件时返回不同的数据，`CURLOPT_FILE`就像在被告知通过`CURLOPT_RETURNTRANSFER`.

`_RETURNTRANSFER`似乎去除了换行符和额外的空白，就好像解析它以显示为标准 HTML 代码一样。 `_FILE`另一方面，完全按照预期保留文件。

我已经阅读了 php.net 上的文档，但没有找到任何似乎可以解决我的问题的东西。理想情况下，我希望`_RETURNTRANSFER`返回确切的内容，这样我就可以消除一个中间文件，但我看不出有任何方法可以做到这一点。

这是我正在使用的代码。有问题的数据是带有 \r\n 行结尾的 CSV 文件。

```
function update_roster() {
  $url         = "http://example.com/";  
  $userID      = "xx";  
  $apikey      = "xxx";  
  $passfields  = "userID=$userID&apikey=$apikey";

  $file = fopen("roster.csv","w+");

  $ch = curl_init();  
  curl_setopt($ch, CURLOPT_POST, 1);  
  curl_setopt($ch, CURLOPT_URL,$url);  
  curl_setopt($ch, CURLOPT_POSTFIELDS, $passfields);  
  curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
  curl_setopt($ch, CURLOPT_FILE, $file);
  $variable_in_question = curl_exec  ($ch);  
  curl_close ($ch);

  fclose($file);
  return $variable_in_question;
  } 
```

* * *

事实证明，错误不在于返回的内容，而在于我解析它的方式。\r\n 没有按照我在单引号中的预期方式进行解析，切换到双引号解决了我的问题。我不知道这会在这样的函数调用中产生影响。

这工作得很好：`$cresult = split("\r\n", $cresult);`

这不会：`$cresult = split('\r\n', $cresult);`

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-19T22:23:49.290

事实证明，错误不在于返回的内容，而在于我解析它的方式。\r\n 没有按照我在单引号中的预期方式进行解析，切换到双引号解决了我的问题。我不知道这会在这样的函数调用中产生影响。

这工作得很好：`$cresult = split("\r\n", $cresult);`

这不会：`$cresult = split('\r\n', $cresult);`

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-20T13:58:08.543

在大多数脚本语言中（例如，在 Bash 中也是如此），简单的引号用于表示编写的内容，而双引号是“分析的”（我认为这不是合适的词，但我找不到更好的）。

```
$str = 'foo';
echo '$str'; // print “$str” to the screen
echo "$str"; // print “foo” to the screen 
```

对于变量和转义字符也是如此。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-19T19:21:36.340

我没有尝试重现“错误”（如果它是实际行为，我认为我们可以将其视为错误），但也许你可以克服它。

PHP Doc 说默认的做法是将结果写入文件，默认文件是 STDOUT（浏览器的窗口）。您想要的是获得与文件中​​但在变量中相同的结果。

您可以使用`ob_start();`and来做到这一点`ob_get_clean();`。

```
$ch = curl_init(...);
// ...
ob_start();
curl_exec($ch);
$yourResult = ob_get_clean();
curl_close($ch); 
```

我知道这不是真正的干净方式（如果有的话），但至少它可以正常工作。

（如果我的英语不完美，请原谅;-)...）

# wpf - 您如何解决 WPF UI 问题？

> ID：104224
> 
> 赞同：11
> 
> 时间：2008-09-19T18:17:20.753
> 
> 标签：wpf, debugging, user-interface, xaml

我正在开发一个 WPF 应用程序，该应用程序有时会出现奇怪的问题并且似乎*挂*在 UI 中。它是不一致的，它发生在不同的页面中，但它经常发生，这是一个大问题。我应该提一下，这不是一个真正的挂起，如下所述。

我的第一个想法是某些按钮的动画是问题，因为它们在大多数页面上都使用过，但是在删除它们之后仍然会出现挂起，尽管看起来不太常见。发生挂起时，我试图闯入调试器；但是从来没有任何代码可以查看。我的代码没有运行。我还注意到“挂起”并不完整。我有代码可以让我拖动表单（它没有边框或标题），它可以继续工作。我也有我赢得的关闭按钮，当我点击它时它会起作用。在我的代码运行时，单击按钮似乎实际上可以工作，但 UI 根本不会更新以显示新页面。

我正在寻找任何建议、工具或技术来追踪这个奇怪的问题，所以如果你有任何想法，我将不胜感激。

编辑：它又发生了，所以这次当我试图闯入调试器时，我选择了“显示反汇编”。它把我带到了 MS.Win32.UnsafeNativeMethods.GetMessageW。堆栈跟踪如下：

```
[Managed to Native Transition] 
```

> WindowsBase.dll!MS.Win32.UnsafeNativeMethods.GetMessageW(ref System.Windows.Interop.MSG msg, System.Runtime.InteropServices.HandleRef hWnd, int uMsgFilterMin, int uMsgFilterMax) + 0x15 bytes
> WindowsBase.dll!System.Windows.Threading。 Dispatcher.GetMessage（参考 System.Windows.Interop.MSG msg，System.IntPtr hwnd，int minMessage，int maxMessage）+ 0x48 字节 WindowsBase.dll！System.Windows.Threading.Dispatcher.PushFrameImpl（System.Windows.Threading.DispatcherFrame 帧= {System.Windows.Threading.DispatcherFrame}) + 0x8b 字节 WindowsBase.dll!System.Windows.Threading.Dispatcher.PushFrame(System.Windows.Threading.DispatcherFrame 帧) + 0x49 字节
> WindowsBase.dll!System.Windows.Threading。 Dispatcher.Run() + 0x4c 字节
> PresentationFramework.dll!System.Windows.Application.RunDispatcher(对象忽略) + 0x1e 字节
> PresentationFramework.dll!System.Windows.Application.RunInternal(System.Windows.Window 窗口) + 0x6f 字节 PresentationFramework.dll!System.Windows.Application。 Run(System.Windows.Window window) + 0x26 bytes PresentationFramework.dll!System.Windows.Application.Run() + 0x19 bytes WinterGreen.exe!WinterGreen.App.Main() + 0x5e bytes C# [Native to Managed Transition]
> [管理到本地转换]
> mscorlib.dll!System.AppDomain.nExecuteAssembly(System.Reflection.Assembly 程序集，string[] args) + 0x19 字节 mscorlib.dll!System.Runtime.Hosting.ManifestRunner.Run(bool checkAptModel) + 0x6e 字节 mscorlib.dll!System .Runtime.Hosting.ManifestRunner.ExecuteAsAssembly() + 0x84 字节 mscorlib.dll!System.Runtime.Hosting.ApplicationActivator.CreateInstance(System.ActivationContext activationContext, string[] activationCustomData) + 0x65 字节 mscorlib.dll!System.Runtime.Hosting。 ApplicationActivator.CreateInstance(System.ActivationContext activationContext) + 0xa 字节 mscorlib.dll!System.Activator.CreateInstance(System.ActivationContext activationContext) + 0x3e 字节
> Microsoft.VisualStudio.HostingProcess.Utilities.dll!Microsoft.VisualStudio.HostingProcess.HostProc.RunUsersAssemblyDebugInZone() + 0x23 字节
> mscorlib.dll!System.Threading.ThreadHelper.ThreadStart_Context(对象状态) + 0x66 字节
> mscorlib.dll!System.Threading。 ExecutionContext.Run(System.Threading.ExecutionContext executionContext, System.Threading.ContextCallback 回调, 对象状态) + 0x6f 字节
> mscorlib.dll!System.Threading.ThreadHelper.ThreadStart() + 0x44 字节

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-19T18:21:30.417

尝试删除窗口的无边界行为，看看是否有帮助。此外，您是否正在 BeginInvoke()'ing 或 Invoke()'ing 任何长期运行的操作？

另一件要注意的事情：当您闯入代码时，请尝试查看主线程以外的线程。其中之一可能会阻塞 UI 线程。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-19T18:26:48.127

由于性能问题，您的 WPF 应用程序可能会挂起。尝试使用[Perforator](http://msdn.microsoft.com/en-us/library/aa969767.aspx)查看您是否有任何软件渲染的部分，或者您的应用程序是否使用了过多的视频内存。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-19T18:21:39.777

一个很棒的工具是[Snoop](http://blois.us/Snoop/)。非常适合查看在给定时间在可视树上显示的 WPF 对象。我不确定它会有多大帮助，但你可能会因为它必须做的很多额外的事情而干扰 UI 线程。Snoop 可以帮助您追踪屏幕上的内容，让您了解要查找的内容。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-22T17:12:31.260

我已按照 Bob King 的建议删除了无边界行为。到目前为止，这似乎已经解决了这个问题。

现在的问题是，为什么以及如何解决这个问题？该产品设计为无边框，带有一些圆角和透明部分。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-12-15T15:41:06.693

万岁，...似乎问题与无边框窗口无关（至少在我的情况下）。

`AllowsTransparency`当您设置为 true时，性能会受到很大影响。看起来很受欢迎，整个事情都可以挂起 UI 线程。非常奇怪的行为。可能与[这张票有关](http://support.microsoft.com/kb/937106)

# language-agnostic - TRUE 是否始终具有非零值？

> ID：104225
> 
> 赞同：22
> 
> 时间：2008-09-19T18:17:22.423
> 
> 标签：language-agnostic, boolean

我有一位同事坚持认为 TRUE 曾经被定义为 0，而所有其他值都是 FALSE。我可以发誓我使用过的每一种语言，如果你甚至可以得到一个布尔值，那么 FALSE 的值是 0。TRUE 曾经是 0 吗？如果是这样，我们什么时候切换的？

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2008-09-19T18:28:37.280

您的同事对 0 / 非 0 感到困惑的事情可能是指人们使用数值作为表示成功的返回值，而不是真相（即在 bash 脚本和某些 C/C++ 风格中）。

使用 0 = 成功可以更精确地指定失败的原因（例如 1 = 丢失文件，2 = 丢失肢体，等等）。

附带说明：在 Ruby 中，唯一的 false 值是 nil 和 false。0 是正确的，但与其他数字不同。0 为真，因为它是对象 0 的一个实例。

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2008-09-19T18:19:03.213

它可能指的是结果代码 0，在大多数情况下，在进程运行后，结果代码 0 表示“嘿，一切正常，这里没有问题”。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-09-22T00:46:33.703

我在一家拥有大量旧 C 代码的公司工作。一些共享标头为 TRUE 和 FALSE 定义了自己的值，有些确实将 TRUE 设置为 0，将 FALSE 设置为 1。这导致了“真相大战”：

```
/* like my constants better */
#undef TRUE
#define TRUE 1

#undef FALSE
#define FALSE 0 
```

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2008-09-19T18:18:58.270

如果不出意外，bash shell 仍然使用 0 表示真，使用 1 表示假。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-09-19T18:58:37.113

C 标准库中的几个函数返回一个“错误代码”整数作为结果。由于 noErr 被定义为 0，因此快速检查可以是“如果它是 0，那就没问题”。Unix 进程的“结果代码”采用相同的约定；也就是说，一个整数，它给出了一些关于给定进程如何完成的指示。

在 Unix shell 脚本中，刚刚执行的命令的结果代码是可用的，并且通常用于表示命令是否“成功”，0 表示成功，其他任何内容都表示特定的不成功条件。

因此，shell 脚本中的所有类似测试的构造都使用“成功”（即结果代码 0）来表示 TRUE，而其他任何东西都表示 FALSE。

在完全不同的平面上，数字电路经常使用“负逻辑”。也就是说，即使 0 伏被称为“二进制 0”并且某些正值（通常是 +5v 或 +3.3v，但现在使用 +1.8v 并不少见）被称为“二进制 1”，某些事件也会被“断言”由给定的引脚变为 0。我认为有一些抗噪声优势，但我不确定原因。

但是请注意，这并没有什么“古老”或一些“切换时间”。我所知道的一切都是基于旧的约定，但在今天是完全最新的和相关的。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-09-19T18:19:52.057

我不确定，但我可以告诉你：依赖 TRUE 和 FALSE 的基本性质的技巧很容易出错，因为这些值的定义由语言的实现者决定（或者，至少，说明符）。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-19T18:41:44.673

C 标准库中的系统调用通常在错误时返回 -1，在成功时返回 0。此外，Fotran 计算的 if 语句将（并且可能仍然会）跳转到三个行号之一，具体取决于评估为小于、等于或大于零的条件。

例如：IF (I-15) 10,20,10

将测试 I == 15 如果为真（计算为零）跳转到第 20 行，否则跳转到第 10 行的条件。

Sam 对依赖实现细节的特定知识的问题是正确的。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-09-19T19:32:24.520

一般规则：

1.  外壳（包括 DOS）使用“0”作为“无错误”......不一定是真的。

2.  编程语言使用非零来表示真。

也就是说，如果您使用的语言允许您定义 TRUE 或 FALSE，请定义它并始终使用常量。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-19T18:26:12.463

即使在今天，在某些语言（Ruby、lisp、...）中，0 也是正确的，因为除了 nil 之外的所有内容都是正确的。更常见的是 1 为真。这是一个常见的问题，因此有时认为不依赖 0 为假，而是进行显式测试是一种很好的做法。Java 要求您这样做。

而不是这个

```
int x;    
....
x = 0;
if (x)  // might be ambiguous
{
} 
```

Make 是明确的

```
if (0 != x)
{
} 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-19T18:35:28.650

我记得在 True 为 -1 的访问形式中进行了一些 VB 编程。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-09-19T18:54:06.563

我记得 PL/1 没有布尔类。您可以创建一个位并将其分配为布尔表达式的结果。然后，要使用它，你必须记住 1 是假的，0 是真的。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-09-19T19:25:18.983

当 bash 的真/假返回语句相反时，很容易混淆：

```
$ false; echo $?
1
$ true; echo $?
0 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-09-19T19:28:29.630

在大多数情况下，false 被定义为 0，而 true 是非零。一些编程语言使用 1，一些使用 -1，还有一些使用任何非零值。

但是对于 Unix shell，它们使用相反的约定。

大多数在 Unix shell 中运行的命令实际上都是小程序。它们传回退出代码，以便您可以确定命令是否成功（值为 0），或者它是否由于某种原因失败（1 或更多，取决于失败的类型）。

这在 if/while/until 命令中的 sh/ksh/bash shell 解释器中用于检查条件：

```
如果命令
然后
   ＃ 成功的
菲
```

如果命令成功（即返回零退出代码），则执行语句中的代码。通常，使用的命令是 [ 命令，它是 test 命令的别名。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-09-19T20:19:18.590

有趣的是，这取决于您使用的语言。在[Lua](http://www.lua.org)中是 true == 内部性能为零。对于 C 中的许多系统调用也是如此。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2008-09-19T20:43:48.437

在 C 语言中，在 C++ 之前，没有布尔值这样的东西。条件是通过测试整数来完成的。零表示假，任何非零都表示真。所以你可以写

```
if (2) {
  alwaysDoThis();
} else {
  neverDothis();
} 
```

幸运的是，C++ 允许使用专用的布尔类型。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2008-09-21T22:32:10.610

我听说过并使用过 true > 0 和 false <= 0 的旧编译器。

这是您不想使用 if(pointer) 或 if(number) 检查零的原因之一，它们可能会意外评估为 false。

同样，我曾在 NULL 不为零的系统上工作过。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2008-09-19T18:19:17.333

在我曾经使用过的任何语言中（回到 70 年代后期的 BASIC），false 被认为是 0，true 被认为是非零。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2008-09-19T18:21:38.527

我不记得`TRUE`是`0`。 `0`不过，C 程序员会返回以表示成功。这可能与`TRUE`.

也不总是这样`1`。它可以是`-1`或只是非零。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2008-09-19T18:22:31.210

对于没有内置布尔类型的语言，我看到的唯一约定是将 TRUE 定义为 1，将 FALSE 定义为 0。例如，在 C 中，`if`如果条件表达式的计算结果不是 0，则语句将执行 if 子句.

我什至曾经看过一份编码指南文档，其中明确指出不要重新定义 TRUE 和 FALSE。:)

如果您使用的是具有内置布尔值的语言，例如 C++，那么关键字`true`和`false`是该语言的一部分，您不应依赖于它们的实际实现方式。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2008-09-19T18:38:29.457

在像 C 这样的语言中，没有布尔值，因此您必须定义自己的值。他们可以处理非标准的 BOOL 覆盖吗？

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2008-09-19T19:10:44.277

应用程序的 DOS 和退出代码通常使用 0 表示成功，非零表示某种类型的失败！

DOS 错误代码是 0-255，当使用 'errorlevel' 语法进行测试时，表示高于或包括指定值的任何内容，因此以下将 2 及以上匹配到第一个 goto，1 到第二个，0（成功）到最后一个！

```
IF errorlevel 2 goto CRS
IF errorlevel 1 goto DLR
IF errorlevel 0 goto STR 
```

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2016-09-09T11:46:42.660

SQL Server 数据库引擎优化了位列的存储。如果表中有 8 个或更少的位列，则这些列存储为 1 个字节。如果有 9 到 16 位列，则这些列存储为 2 个字节，依此类推。字符串值 TRUE 和 FALSE 可以转换为位值：TRUE 转换为 1，FALSE 转换为 0。转换为位可将任何非零值提升为 1。

每种语言都可以有 0 作为真或假所以停止使用数字使用单词 true Lol 或 t 和 f 1 字节存储

# sql - 如何查询多个 SQL 表以获取特定的键值对？

> ID：104230
> 
> 赞同：1
> 
> 时间：2008-09-19T18:17:47.367
> 
> 标签：sql, lazy-evaluation

情况：具有多个可安装模块的 PHP 应用程序在数据库中为每个模块创建一个新表，样式为 mod_A、mod_B、mod_C 等。每个都有列 section_id。

现在，我正在寻找特定 section_id 的所有条目，我希望除了“Select * from mod_a, mod_b, mod_c ... mod_xyzzy where section_id=value”之外还有另一种方法......甚至更糟，使用单独的查询每个模块。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-19T18:20:05.520

关于什么？

```
SELECT * FROM mod_a WHERE section_id=value
UNION ALL
SELECT * FROM mod_b WHERE section_id=value
UNION ALL
SELECT * FROM mod_c WHERE section_id=value 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-19T18:54:01.837

如果表格随时间变化，您可以在 SP 中内联代码生成您的解决方案（伪代码 - 您必须填写）：

```
SET @sql = ''

DECLARE CURSOR FOR
SELECT t.[name] AS TABLE_NAME
FROM sys.tables t
WHERE t.[name] LIKE 'SOME_PATTERN_TO_IDENTIFY_THE_TABLES' 
```

- 或这个

```
DECLARE CURSOR FOR
SELECT t.[name] AS TABLE_NAME
FROM TABLE_OF_TABLES_TO_SEACRH t

START LOOP

IF @sql <> '' SET @sql = @sql + 'UNION ALL '
SET @sql = 'SELECT * FROM [' + @TABLE_NAME + '] WHERE section_id=value '

END LOOP

EXEC(@sql) 
```

我偶尔会使用这种技术，当时没有任何明显的方法可以让它在没有动态 SQL 的情况下面向未来。

注意：在您的循环中，您可以使用 COALESCE/NULL 传播技巧并在循环之前将字符串保留为 NULL，但如果您不熟悉该习语，则不清楚：

```
SET @sql = COALESCE(@sql + ' UNION ALL ', '')
    + 'SELECT * FROM [' + @TABLE_NAME + '] WHERE section_id=value ' 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-19T19:08:37.090

我有两个建议。

1.  也许您需要合并所有表格。如果它们都包含相同的结构，那么为什么不拥有一个“主”模块表，它只添加一个标识模块的新列（“A”、“B”、“C”……）

    如果您的模块表基本相同，但有几列不同，您可能仍然能够将所有常见信息合并到一个表中，并保留具有这些差异的较小的模块特定表。然后你只需要加入他们。

    此建议假定您对您提到的 section_id 列的查询对于快速查找非常关键。通过一个查询，您可以获得所有常见信息，如果您需要，您可以通过第二个查询获得任何特定信息。（而且您可能不会——例如，如果您试图验证该部分的存在性，那么在公用表中找到它就足够了）

2.  或者，您可以添加另一个表，将 section_id 映射到它们所在的模块。

    ```
    section_id | 模块
    -----------+--------
          1 | 一种
          2 | 乙
          3 | 一种
         ... | ...

    ```

    这确实意味着您必须运行两个查询，一个针对此映射表，另一个针对模块表以提取任何有用的数据。

    如果您需要查找所有模块共有的其他列，您可以使用其他列和这些列上的索引来扩展此表。

    这种方法有一定的缺点，即数据重复。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-19T18:22:23.427

我将建议与 borjab 相同的想法。唯一的问题是，如果添加另一个表，则必须更新所有这些查询。我看到的唯一其他选项是存储过程。

我确实在这里想到了另一种选择，或者至少是一种更简单的方式来呈现这一点。您还可以对这些多个表使用视图以使它们显示为一个，然后您的查询将看起来更清晰，更易于理解，并且当您想对这些表执行其他查询时，您不必重写长联合查询多个表。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-19T18:26:08.893

也许一些额外的信息会有所帮助，但听起来你已经有了解决方案。您必须从所有带有 section_id 的表中进行选择。您可以使用连接而不是表列表，在 section_id 上连接。例如

```
select a.some_field, b.some_field.... 
from mod_a a
inner join mod_b b on a.section_id = b.section_id
...
where a.section_id = <parameter> 
```

您也可以将其打包为视图。还要注意字段列表而不是 *，如果您打算实际使用 *，我会推荐它。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-19T18:27:38.060

好吧，从多个表中聚合信息的方法只有这么多。您可以加入，就像您在示例中提到的那样，或者您可以运行多个查询并将它们联合在一起，如 borjab 的答案。我不知道创建一个与所有模块表相交的表的想法是否对您有用，但如果 section_id 在这样的表上，您将能够从单个查询中获取所有内容。否则，我为你的懒惰喝彩，但我不敢说，我看不出有什么办法可以让这份工作更轻松:)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-19T21:41:03.103

```
SELECT * FROM (
    SELECT * FROM table1
    UNION ALL
    SELECT * FROM table2
    UNION ALL
    SELECT * FROM table3
) subQry
WHERE field=value 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-19T21:58:32.143

数据库方面的一个选项是创建各种表的 UNION ALL 视图。添加表格时，您需要将其添加到视图中，否则它看起来就像一个单独的表格。

```
CREATE VIEW modules AS (
    SELECT * FROM mod_A
    UNION ALL 
    SELECT * FROM mod_B
    UNION ALL 
    SELECT * FROM mod_C
);

select * from modules where section_id=value; 
```

# c# - 如何在 C# 中使用 DebugBreak()？

> ID：104235
> 
> 赞同：32
> 
> 时间：2008-09-19T18:18:01.143
> 
> 标签：c#, debugging, debugbreak

语法是什么以及需要导入哪个命名空间/类？如果可能的话，给我示例代码。这会有很大帮助。

* * *

## 回答 #1

> 赞同：44
> 
> 时间：2008-09-19T21:01:38.520

我还想检查是否附加了调试器 - 如果在没有调试器时调用 Debugger.Break，它会提示用户是否要附加一个。根据您想要的行为，您可能希望仅在（或如果没有）已附加一个时才调用 Debugger.Break()

```
using System.Diagnostics;

//.... in the method:

if( Debugger.IsAttached) //or if(!Debugger.IsAttached)
{
  Debugger.Break();
} 
```

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2008-09-19T18:20:22.353

将以下内容放在您需要的地方：

```
System.Diagnostics.Debugger.Break(); 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-09-19T18:20:58.640

[https://docs.microsoft.com/en-us/dotnet/api/system.diagnostics.debugger.break#System_Diagnostics_Debugger_Break](https://docs.microsoft.com/en-us/dotnet/api/system.diagnostics.debugger.break#System_Diagnostics_Debugger_Break)

```
#if DEBUG
  System.Diagnostics.Debugger.Break();
#endif 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-19T18:20:23.913

你可以`System.Diagnostics.Debugger.Break()`用来在特定的地方休息。这可以在调试服务等情况下提供帮助。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2016-03-21T09:39:35.633

@Philip Rieck 和 @John 的答案略有不同。

约翰的...

```
#if DEBUG
  System.Diagnostics.Debugger.Break();
#endif 
```

仅当您使用 DEBUG 条件编译符号集编译时才有效。

菲利普的回答...

```
if( Debugger.IsAttached) //or if(!Debugger.IsAttached)
{
  Debugger.Break();
} 
```

将适用于任何调试器，因此您也会让任何黑客感到害怕。

还要注意`SecurityException`它可能会抛出，所以不要让该代码泄露出去。

另一个理由不...

> 如果没有附加调试器，则会询问用户是否要附加调试器。如果用户说是，则启动调试器。如果附加了调试器，调试器会收到用户断点事件的信号，并且调试器会暂停进程的执行，就像遇到了调试器断点一样。

来自[https://msdn.microsoft.com/en-us/library/system.diagnostics.debugger.break(v=vs.110).aspx](https://msdn.microsoft.com/en-us/library/system.diagnostics.debugger.break(v=vs.110).aspx)

# php - 如何在 PHP preg_split 样式正则表达式中匹配一个或多个字母

> ID：104238
> 
> 赞同：2
> 
> 时间：2008-09-19T18:18:13.730
> 
> 标签：php, regex

我的正则表达式有问题。

我想捕获 <% some stuff %> 并且我需要 <% 和 %> 里面的东西

这个正则表达式对此非常有效。

```
$matches = preg_split("/<%[\s]*(.*?)[\s]*%>/i",$markup,-1,(PREG_SPLIT_NO_EMPTY  |  PREG_SPLIT_DELIM_CAPTURE)); 
```

我也想抓，`&amp;% some stuff %&amp;gt;` 所以需要`<% or &amp;lt;% and %> or %&amp;gt;`分别抓。

如果我放入第二组括号，它会使 preg_split 功能不同（因为您可以从标志中看到，我试图捕获括号内的内容。

最好，它也只会匹配`&amp;lt; to &amp;gt; and < to >`，但这不是完全必要的

编辑：主题可能包含多个匹配项，我需要所有匹配项

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-19T18:25:04.073

在您的情况下，最好使用 preg_match 及其附加参数和括号：

```
preg_match("#((?:<|&lt;)%)([\s]*(?:[^ø]*)[\s]*?)(%(?:>|&gt;))#i",$markup, $out);
print_r($out);

Array
(
    [0] => <% your stuff %>
    [1] => <%
    [2] => your stuff
    [3] => %>
) 
```

顺便看看这个在线调试 PHP regexp 的工具，它太有用了！

[http://regex.larsolavtorvik.com/](http://regex.larsolavtorvik.com/)

编辑：我稍微修改了正则表达式，所以它更快。测试它，它的工作原理:-)

现在让我们解释所有这些东西：

*   preg_match 会将他捕获的所有内容存储在作为第三个参数传递的 var 中（此处为 $out）
*   如果 preg_match 匹配某些东西，它将存储在 $out[0]
*   模式中 () 但不在 (?:) 内的任何内容都将存储在 $out

详细模式：

```
#((?:<|&lt;)%)([\s]*(?:[^ø]*)[\s]*?)(%(?:>|&gt;))#i can be viewed as ((?:<|&lt;)%) + ([\s]*(?:[^ø]*)[\s]*?) + (%(?:>|&gt;)).

((?:<|&lt;)%) is capturing < or &lt; then %
(%(?:>|&gt;)) is capturing % then < or &gt; 
([\s]*(?:[^ø]*)[\s]*?) means 0 or more spaces, then 0 or more times anything that is not the ø symbol, the 0 or more spaces. 
```

为什么我们使用 [^ø] 而不是 . ? 这是因为 。非常耗时，正则表达式引擎将检查所有现有字符。[^ø] 只需检查字符是否不是 ø。没有人使用 ø，它是一个国际货币符号，但如果你关心，你可以用 chr(7) 替换它，它是显然永远不会在网页中输入的 shell bell char。

EDIT2：我刚刚阅读了您关于捕获所有匹配项的编辑。在这种情况下，您将以相同的方式使用 preg_match_all。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-19T18:32:48.207

```
<?php
$code = 'Here is a <% test %> and &lt;% another test %&gt; for you';
preg_match_all('/(<|&lt;)%\s*(.*?)\s*%(>|&gt;)/', $code, $matches);
print_r($matches[2]);
?> 
```

结果：

```
Array
(
    [0] => test
    [1] => another test
) 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-19T18:28:32.910

`preg_split`如果您真正想要的是括号内的匹配项，为什么要使用？似乎只使用它会更简单`preg_match`。

正则表达式通常会出现一个问题，即括号既用于对逻辑进行分组又用于捕获模式。

根据关于正则表达式语法的 PHP 文档，

> 简单的括号满足两个功能这一事实并不总是有帮助的。经常需要分组子模式而没有捕获要求。如果左括号后跟“?:”，则子模式不进行任何捕获，并且在计算任何后续捕获子模式的数量时不计算在内。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-19T18:41:24.660

如果你想匹配，试试这样`preg_match_all`的***正则表达式***：

```
preg_match_all('/((\<\%)(\s)(.*?)(\s)(\%\>))/i', '<% wtf %> <% sadfdsafds %>', $result); 
```

这导致了太阳下几乎所有事物的匹配。您可以添加/删除括号以匹配更多/更少：

```
Array
(
 [0] => Array
    (
        [0] => <% wtf %>
        [1] => <% sadfdsafds %>
    )

[1] => Array
    (
        [0] => <% wtf %>
        [1] => <% sadfdsafds %>
    )

[2] => Array
    (
        [0] => <%
        [1] => <%
    )

[3] => Array
    (
        [0] =>  
        [1] =>  
    )

[4] => Array
    (
        [0] => wtf
        [1] => sadfdsafds
    )

[5] => Array
    (
        [0] =>  
        [1] =>  
    )

[6] => Array
    (
        [0] => %>
        [1] => %>
    )

) 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-19T18:27:24.943

一种可能的解决方案是使用额外的括号，就像这样，但要在结果中放弃那些，所以你实际上只*使用*了总结果的 1/2。

这个正则表达式

```
$matches = preg_split("/(<|&lt;)%[\s]*(.*?)[\s]*%(>|&gt;)/i",$markup,-1,(PREG_SPLIT_NO_EMPTY  |  PREG_SPLIT_DELIM_CAPTURE)); 
```

用于输入

```
Hi my name is <h1>Issac</h1><% some stuff %>here&lt;% more stuff %&gt; 
```

输出将是

```
Array(
 [0]=>Hi my name is <h1>Issac</h1>
 [1]=><
 [2]=>some stuff
 [3]=>>
 [4]=>here
 [5]=>&;lt;
 [6]=>more stuff
 [7]=>&gt;
) 
```

如果我只使用偶数，这将给出所需的结果

# xml - 在 W3C 的 XML Schema 语言 (XSD) 中是否有可能允许一系列元素按任何顺序排列但仍然限制出现？

> ID：104248
> 
> 赞同：2
> 
> 时间：2008-09-19T18:19:12.637
> 
> 标签：xml, schema, xsd

我知道`all`and `choice`，但它们并没有说明我确实希望某些元素能够多次出现的情况，例如：

```
<Root>
    <ThingA/>
    <ThingB/>
    <ThingC/>
    <ThingC/>
    <ThingC/>
</Root> 
```

我可以使用`sequence`，但我更愿意让这些孩子按任何顺序排列。我可以使用`any`，但我不能拥有超过一个`ThingC`。我可以使用`choice`，但我无法将`ThingA`and限制`ThingB`为 0 或 1。

我想我可能在某处读到过，这在 XSD 中要么困难要么不可能，但使用 RELAX NG 可能是可能的。不幸的是，我不记得我在哪里读到的。

谢谢你的帮助！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-19T19:08:58.057

没错：你不能在 XML Schema 中做你想做的事，但你可以在 RELAX NG 中使用：

```
<element name="Root">
  <interleave>
    <element name="ThingA"><empty /></element>
    <element name="ThingB"><empty /></element>
    <oneOrMore><element name="ThingC"><empty /></element></oneOrMore>
  </interleave>
</element> 
```

您在 XML Schema 中的选项是：

*   添加一个预处理步骤，将您的输入 XML 规范化为特定顺序，然后使用`<xs:sequence>`
*   使用`<xs:choice>`，并添加额外的验证（例如使用 Schematron）来检查不超过一个`<ThingA>`或`<ThingB>`
*   决定修复标记语言中元素的顺序

事实证明，第三种通常是最好的选择；XML 生成器以特定顺序输出元素通常不会花费太多成本，而且它不仅有助于验证，而且如果可以提前知道顺序，它还有助于 XML 的使用。

# java - Eclipse IDE 中的 java.io.Console 支持

> ID：104254
> 
> 赞同：107
> 
> 时间：2008-09-19T18:19:31.153
> 
> 标签：java, eclipse, console, java-io

我使用 Eclipse IDE 来开发、编译和运行我的 Java 项目。今天，我尝试使用`java.io.Console`该类来管理输出，更重要的是，管理用户输入。

问题是当应用程序“通过”Eclipse 运行时`System.console()`返回。`null`Eclipse 在后台进程上运行程序，而不是我们熟悉的带有控制台窗口的顶级进程。

有没有办法强制 Eclipse 将程序作为顶级进程运行，或者至少创建一个 JVM 可以识别的控制台？否则，我不得不将项目打包并在 Eclipse 外部的命令行环境中运行。

* * *

## 回答 #1

> 赞同：50
> 
> 时间：2008-09-19T20:37:36.253

我假设您希望能够使用 Eclipse 中的逐步调试。您可以通过在 JRE 类路径上的 bin 目录中设置构建的类来在外部运行这些类。

```
java -cp workspace\p1\bin;workspace\p2\bin foo.Main 
```

您可以使用远程调试器进行调试，并利用项目中内置的类文件。

在此示例中，Eclipse 项目结构如下所示：

```
workspace\project\
                 \.classpath
                 \.project
                 \debug.bat
                 \bin\Main.class
                 \src\Main.java 
```

**1.以调试模式启动JVM控制台**

**debug.bat**是一个 Windows 批处理文件，应该从**cmd.exe**控制台外部运行。

```
@ECHO OFF
SET A_PORT=8787
SET A_DBG=-Xdebug -Xnoagent -Xrunjdwp:transport=dt_socket,address=%A_PORT%,server=y,suspend=y
java.exe %A_DBG% -cp .\bin Main 
```

在参数中，调试端口已设置为*8787*。*suspend=y*参数告诉 JVM 等到调试器附加。

**2\. 创建调试启动配置**

在 Eclipse 中，打开调试对话框（运行 > 打开调试对话框...）并使用以下设置创建一个新的**远程 Java 应用程序配置：**

*   *项目：*您的项目名称
*   *连接类型：*标准（插座连接）
*   *主机：*本地主机
*   *端口：* 8787

**3\. 调试**

因此，只要您想调试应用程序，您所要做的就是：

*   设置断点
*   在控制台中启动批处理文件
*   启动调试配置

* * *

您可以在[错误 122429](https://bugs.eclipse.org/bugs/show_bug.cgi?id=122429)中跟踪此问题。您可以使用[此处](http://illegalargumentexception.blogspot.com/2010/09/java-systemconsole-ides-and-testing.html)描述的抽象层在您的应用程序中解决此问题。

* * *

## 回答 #2

> 赞同：34
> 
> 时间：2010-12-20T16:54:14.990

我使用的解决方法是在使用 Eclipse 时只使用 System.in/System.out 而不是 Console。例如，而不是：

```
String line = System.console().readLine(); 
```

您可以使用：

```
BufferedReader bufferedReader = new BufferedReader(new InputStreamReader(System.in));
String line = bufferedReader.readLine(); 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-19T18:40:06.800

发生这种情况的原因是因为 eclipse 将您的应用程序作为后台进程而不是作为具有系统控制台的顶级进程运行。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2013-03-21T04:22:13.387

你可以自己实现一个类。下面是一个例子：

```
public class Console {
    BufferedReader br;
    PrintStream ps;

    public Console(){
        br = new BufferedReader(new InputStreamReader(System.in));
        ps = System.out;
    }

    public String readLine(String out){
        ps.format(out);
        try{
            return br.readLine();
        }catch(IOException e)
        {
            return null;
        }
    }
    public PrintStream format(String format, Object...objects){
        return ps.format(format, objects);
    }
} 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-09-19T18:49:07.683

[在http://www.stupidjavatricks.com/?p=43](http://www.stupidjavatricks.com/?p=43)找到了一些关于此的内容。

可悲的是，由于控制台是最终的，你不能扩展它来创建一个围绕 system.in 和 system.out 的包装器。即使在 Eclipse 控制台中，您仍然可以访问这些控制台。这可能就是为什么 eclipse 还没有将它插入他们的控制台的原因......

我理解为什么您不希望有任何其他方式来获得 System.console 以外的控制台，没有设置器，但我不明白为什么您不希望有人能够覆盖该类来制作一个模拟/测试控制台...

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2012-08-17T01:46:58.683

另一种选择是创建一个方法来包装这两个选项，并在 Console 不可用时“故障转移”到 System.in 方法。下面的示例是一个相当基本的示例 - 您可以按照相同的过程根据需要在控制台（readPassword、格式）中封装其他方法。这样，您就可以在 Eclipse 中愉快地运行它，并且在部署它时，您可以获得控制台功能（例如密码隐藏）。

```
 private static String readLine(String prompt) {
        String line = null;
        Console c = System.console();
        if (c != null) {
             line = c.readLine(prompt);
        } else {
            System.out.print(prompt);
            BufferedReader bufferedReader = new BufferedReader(new InputStreamReader(System.in));
            try {
                 line = bufferedReader.readLine();
            } catch (IOException e) { 
                //Ignore    
            }
        }
        return line;
    } 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-19T18:37:41.377

据我所知，没有办法从 Eclipse 中获取 Console 对象。我只是确保控制台！= null，然后将其 JAR 并从命令行运行它。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-19T18:56:36.540

通过 Eclipse 运行应用程序时，似乎无法获取 java.io.Console 对象。命令行控制台窗口不会随应用程序一起打开，因为它作为后台进程运行（Eclipse 的后台？）。目前，没有 Eclipse 插件来处理这个问题，主要是因为 java.io.Console 是一个 final 类。

您真正能做的就是测试返回的 Console 对象是否为 null 并从那里继续。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2012-07-11T11:05:27.197

此[链接](http://www.xyzws.com/Javafaq/how-to-read-input-from-console-keyboard-in-java/195)提供了使用 System.console() 的替代方法。一种是使用包裹在 System.in 中的 BufferedReader，第二种是使用包裹在 System.in 中的 Scanner。

两者都不像控制台那样简洁，但两者都可以在 Eclipse 中工作，而无需求助于愚蠢的调试！

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2017-02-09T14:35:38.873

假设您的 Eclipse 工作区是 C:\MyWorkspace，您在 maven 项目 MyProject 中创建了 Java 应用程序，并且您的 Java 主类是 com.mydomain.mypackage.MyClass。

在这种情况下，您可以运行`System.console()`在命令行上使用的主类：

```
java -cp C:\MyWorkspace\MyProject\target\classes com.mydomain.mypackage.MyClass 
```

NB1：如果它不在 maven 项目中，请检查项目属性中的输出文件夹 | Java 构建路径 | 来源。它可能不是“目标/类”

NB2：如果它是一个 maven 项目，但你的类在 src/test/java 中，你可能不得不使用“target\test-classes”而不是“target\classes”

# javascript - xul：在 xul 浏览器中打开相对于“myapp.xul”的本地 html 文件

> ID：104267
> 
> 赞同：3
> 
> 时间：2008-09-19T18:20:53.803
> 
> 标签：javascript, file-io, xul

简而言之：**有没有办法找到 xul 应用程序的当前目录完整路径？**

长解释：

我想在 xul 浏览器应用程序中打开一些 html 文件。应从 xul 应用程序以编程方式设置 html 文件的路径。html 文件位于我的 xul 应用程序的文件夹之外，但在同一级别。（用户将从 SVN 签出这两个文件夹，xul 应用程序没有可用的安装）

如果我设置像“file:///c:\temp\processing-sample\index.html”这样的完整路径，它会很好地打开文件

我想要做的是打开与我的 xul 应用程序相关的文件。

我发现我可以打开用户的个人资料路径：

```
var DIR_SERVICE = new Components.Constructor("@mozilla.org/file/directory_service;1", "nsIProperties");
var path = (new DIR_SERVICE()).get("UChrm", Components.interfaces.nsIFile).path;
var appletPath;

// find directory separator type
if (path.search(/\\/) != -1)
{
appletPath = path + "\\myApp\\content\\applet.html"
}
else
{
appletPath = path + "/myApp/content/applet.html"
}

// Cargar el applet en el iframe
var appletFile = Components.classes["@mozilla.org/file/local;1"].createInstance(Components.interfaces.nsILocalFile);
appletFile.initWithPath(appletPath);
var appletURL = Components.classes["@mozilla.org/network/protocol;1?name=file"].createInstance(Components.interfaces.nsIFileProtocolHandler).getURLSpecFromFile(appletFile);
var appletFrame = document.getElementById("appletFrame");
appletFrame.setAttribute("src", appletURL); 
```

**有没有办法找到 xul 应用程序的当前目录完整路径？**

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-19T19:48:13.173

我找到了一种解决方法：http: [//developer.mozilla.org/en/Code_snippets/File_I%2F%2FO](http://developer.mozilla.org/en/Code_snippets/File_I%2F%2FO)我无法使用相对路径“../../index.html”完全打开文件，但我可以得到app 目录并使用它。

```
var DIR_SERVICE = new Components.Constructor("@mozilla.org/file/directory_service;1", "nsIProperties");
var path = (new DIR_SERVICE()).get(resource:app, Components.interfaces.nsIFile).path;
var appletPath; 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-25T03:57:21.317

是的，您的扩展程序中的 html 文件可以使用 chrome URI 进行寻址。我的一个扩展中的一个例子：

```
content.document.location.href = "chrome://{appname}/content/logManager/index.html" 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-20T05:14:29.520

在 xul 应用程序中，您可以使用 chrome url 访问应用程序的 chrome 文件夹。

我对 element 的经验相对较少，所以我不确定这是否适合你。这是您在 xul 文件中包含 javascript 源文件的方式：

```
<script src="chrome://includes/content/XSLTemplate.js" type="application/x-javascript"/> 
```

因此，也许如果文件位于 c:\applicationFolder\chrome\content\index.html ，您可以在以下位置访问它：

```
chrome://content/index.html 
```

以某种方式。

您还可以查看[jslib](http://jslib.mozdev.org/libraries/io/dir.js.html)，这是一个简化很多事情的库，包括文件 i/o。IIRC，不过，我无法使用“../”找到相对路径。

# flash - Flash 与 Silverlight

> ID：104270
> 
> 赞同：5
> 
> 时间：2008-09-19T18:21:22.133
> 
> 标签：flash, silverlight

我们正在建立一个培训网站，我们需要在其中跟踪观看视频的观众并存储有关观看的详细信息（他们何时暂停，是否观看了整个视频等）

在选择这两种技术时我们应该考虑什么？

我忘了补充。这是一个内部应用程序。我们可以完全控制环境。如果这是用于公共应用程序，我肯定会使用 Flash。

我只是在从同时使用两者的人那里寻找其中一个的技术优势。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-08-04T15:04:42.323

我会插话，因为似乎人们错过了问题的重点：Flash 与 Silverlight 的技术优势是什么？（因为它与*内部*应用程序有关）

**闪存专家**

*   在我看来，“艺术”界面要好得多。如果您有习惯使用 Illustrator 或 Photoshop 的艺术家和设计师，这非常简单。
*   他们的环境集成基于帧的电影时间线的方式非常巧妙，并且已经使用了多年。它可以很容易地将许多不同的动画元素和声音集成和分层到您的电影或动画中。
*   所有编码都是在 JavaScript 式语言 ActionScript 中完成的，因此对于非 Microsoft 开发人员来说，至少语法的学习曲线相当低。
*   在线支持。有很多年的帖子可以帮助你弄清楚你需要做什么才能在 Flash 中获得你想要的东西。

**Silverlight 优点**

*   它使用.Net 作为后端。如果您有很多 .Net 开发人员，您将能够利用 .Net 框架，从编程上讲，它是一组功能更强大的工具。
*   更容易调试。以我的经验，它比 Actionscript 更容易调试，这主要归功于卓越的 IDE。
*   把我带到IDE。*编码*IDE 远优于 Flash 笨重、拼凑而成的精美文本板。它具有智能感知、自动完成等功能。

**闪存缺点**

*   在我丰富的 Flash 经验中，如果你正在制作一个高度交互的应用程序，那么它可能会出现问题。一些错误接近无稽之谈，解决方法充其量是骇人听闻的。
*   IDE很烂。时期。它是记事本，带有一些执行不力的智能感知式关键字识别。
*   语言有时会落在它的脸上。我曾见过突然间，一个 var 对我的所有类型都敏感的情况，而这不仅仅是之前的两个节。我的错？也许。大概。但尽管如此，我还是从 ActionScript 中看到了一些奇怪的行为，而 C# 总是按照我的吩咐去做。
*   没有真正的标准做事方式。没有“最佳实践将您的代码放在这里”的方式来做事。Flash 允许您将代码放在*任何东西*上。一个帧、一个电影剪辑、一个对象、一个数组……不管怎样，只要在一些东西上弹出一些功能就可以了！这使得在其他人的应用程序中查找错误成为一件真正的苦差事。

**Silverlight 缺点**

*   在我看来，还没有很多文档。
*   相比之下，不合标准的“艺术家”界面。如果您想要某种外观，您的设计师可能更难实现。
*   如果您不习惯 XAML，那么布局可能会让人头疼。如果您从未使用过 XAML，并且您有一个排序时间表来完成这件事，那么您最好准备好投入一些额外的时间，或者接受不太出色的外观和感觉。使用 XAML 获得所需的外观并不像在 Flash 中那样容易。

同样，所有这些都是我自己的*观点*和我的*经验*。其他人可能有不同的看法。

如果您有一些设计师和一些 Flash 经验，请使用 Flash。如果您想学习新的东西，请填写您的简历，并且除了 .Net 经验之外您什么都没有，请选择 Silverlight。

最后，做任何让你喜欢上班的事情。（只要它符合你的最后期限。哈哈）

哦，我应该注意，我在这里说的不是 FLEX，而是 Flash。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-19T18:28:38.417

最近不得不在 silverlight 和 flash 之间调用一个非常激烈的交互组件，我不得不使用 flash。原因之一：在线支持。如果我在 Flash 中构建某些东西时遇到问题，很有可能我会在网上某个地方从克服相同问题的人那里找到帮助。由于 Silverlight 是新的，并且在 beta 迭代中仍然很新鲜，因此不太可能找到同样数量的帮助（至少现在是这样）。最后，我的 Flash 应用程序非常复杂，我仍然有很多我无法解决的问题寻找帮助，只需要挖掘 api 并尝试一些事情。如果我选择了 Silverlight，我会非常无所事事。不要误会我的意思，我很想跳入 Silverlight，我很想有一天将我的 Flash 应用程序转换为 SL。我只需要在线社区/论坛的存在来成长。它会的。我很高兴看到 Silverlight 将走向何方。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-09-19T23:02:45.980

您的开发人员知道什么？如果他们已经了解 ActionScript，则使用 Flash；如果他们了解 C#、VB.NET、JavaScript、Ruby 或 Python，则使用 Silverlight。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-09-19T18:32:06.193

如果您正在寻找可维护性，那么它的 Silverlight 和他们的编程 api 会更干净。

但是，它不仅没有安装在任何地方，而且不是每个浏览器或客户端操作系统都支持它。

如果可以，请在两者中都进行，但如果不能，请在 flash 中进行，并在安装基数较大时将其移植，因为 silverlight 在工程方面更容易。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-19T18:26:03.680

由于安装基础，我个人会使用 Flash。在我看来，如果 YouTube 和 Google 视频都使用 Flash，那么地球上几乎每台计算机都拥有它，所以它会胜出。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-09-19T18:26:14.430

我还没有找到在 Firefox 中正常工作的 silverlight 视频。据我所知，也没有 linux 查看器。

还有更多的用户已经安装了 Flash，因此不必安装另一个应用程序来观看视频将有更多的人观看视频

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-09-19T18:36:15.933

我发现这个[博客](http://neilmiddleton.com/2008/06/29/flex-vs-silverlight-in-my-eyes/)（不是我的！）在这个主题上非常有趣。我个人会根据需要采用解决方案，如果我正在为 Windows 网络上的公司构建内部应用程序，那么 silverlight 似乎很棒。否则，您似乎通过在公共站点上使用 Silverlight 来忽略整个世界。

我完全是为了竞争，两者仍然是专有产品。尽管 flex3 编译器和框架已经开源，但实际的 flash 播放器仍然是专有的。也就是说，几乎每台在线计算机都有某种形式的 flash 播放器，尽管它可能不是 flex 应用程序所需的第 9 版，但可以通过在浏览器中简单单击来轻松升级。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-09-19T18:23:04.517

请在此处找到一些其他信息：

[Silverlight 与 Flex](https://stackoverflow.com/questions/20910/silverlight-vs-flex)

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-09-19T18:28:09.107

如果您需要统计信息来支持 Flash 的决定，您可以在此处获取它的安装统计信息：http: [//www.adobe.com/products/player_census/flashplayer/version_penetration.html](http://www.adobe.com/products/player_census/flashplayer/version_penetration.html)

大约 97% 的安装率。这很甜蜜。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-09-19T18:51:33.620

您正在等待多少并发查询并不重要。这也是Olympic-Website 的决策基础，因为需要更多的服务器资源来通过flash 而不是silverlight 传送视频。所以silverlight可能会节省成本。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-09-21T17:19:38.363

听起来您已经完全控制了环境所以最好选择 Silverlight，因为这项新技术易于开发和可扩展的特性。它支持最好的脚本语言（C#，有史以来最成熟的语言）。我敢打赌，你在这项新技术上的投资不会让你在未来感到沮丧。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2008-10-10T05:59:12.670

有一个有价值的博客，作者从开发人员和最终用户的角度比较了 Silverlight 和 Flash。

显示了运行相同用例的 Silverlight 和 Flash，可以下载代码，用户可以上下左右最好的一个。

我认为这个网站是一个很棒的 Silverlight vs Flash 资源。

[http://www.shinedraw.com/](http://www.shinedraw.com/)

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2009-08-04T14:12:33.437

Silverlight 实际上正在接近 flash，并且最近获得的功能 flash 正在迅速在 silverlight 中实现，但是使用 flash 的用户仍然比使用 silverlight 的用户多得多，因此您将使用 flash 接触更多。

这是安装了多少% 的用户的统计数据。

[http://riastats.com/#](http://riastats.com/#)

如您所见，闪光灯遥遥领先

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2009-08-04T14:36:26.020

我不得不说 silverlight 有一个更好的 API，而且使用 .NET 它有一个巨大的好处

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2008-09-19T18:25:47.147

Flash 的使用更为广泛，但 SilverLight 在奥运会期间得到了很好的宣传。难道你不能同时拥有更多的用户。因为如果您只停止使用 SilverLight，您可能会削减所有不想安装所需文件的用户。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-09-19T18:27:18.233

两者都可以满足您的所有要求，因此请选择安装基数较高的那个 - 毫无疑问，Flash。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2009-08-04T14:48:53.563

如果您可以完全控制环境，请考虑 WPF/Web 浏览器应用程序。与 Silverlight 相比，开发更容易一些，典型的 .NET 开发人员的学习曲线几乎是平坦的。

# licensing - 试用软件/许可策略

> ID：104291
> 
> 赞同：13
> 
> 时间：2008-09-19T18:24:27.897
> 
> 标签：licensing, trialware

我为摄影师编写了一个实用程序，我打算在网上以相当便宜的价格（10 美元）出售它。我想让用户在申请许可证之前试用该软件一周左右。由于这是一个个人项目，而且软件不是很贵，我认为购买专业许可提供商的服务不值得，我自己动手。

当前，该应用程序检查包含加密字符串的注册表项，该字符串指定试用期何时到期或它们具有有效许可证。如果密钥不存在，则会创建试用期密钥。

**因此，您只需删除注册表项即可免费获得一周的时间。**我不认为很多用户会这样做，尤其是当应用程序只有 10 美元时，但我很好奇是否有更好的方法来做到这一点，这对合法用户来说并不麻烦。我正常编写网络应用程序，以前没有处理过这些东西。

该应用程序位于 .NET 2.0 中，如果这很重要的话。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-09-19T18:43:44.810

编辑：通过将注册表信息存储在本地安全机构 (LSA) 中，您可以使当前的许可方案更难破解。大多数用户将无法从那里删除您的关键信息。在 MSDN 上搜索 LSA 应该会为您提供所需的信息。

对许可方案的看法因人而异，开发人员之间的看法比特定用户群体（例如摄影师）更多。考虑到您的应用程序将解决的业务需求，您应该深呼吸并尝试看看您的目标用户会接受什么。

这是我对这个问题的个人看法。会有不同意的声音个人。

这个问题的答案很大程度上取决于您希望如何使用您的应用程序。如果您希望该应用程序每天被使用多次，那么您将从很长的试用期（几个月）中获益最多，从而造成锁定情况。为此，您必须有一个宽限期，软件会提醒用户很快需要付款。在宽限期之前，如果软件对试用期保持沉默，您将获得更大的成功。

你是否选择相信这个相当大胆的声明当然完全取决于你。但是如果你这样做了，你应该意识到你的应用程序被使用的频率越低，试用期就越短。付款对用户来说非常快速和容易（尽可能少的数据输入和尽可能少的点击）也非常重要。

如果您对应用程序的使用情况非常不确定，您应该选择非常短的试用期。根据我的经验，如果应用程序对在这种情况下处于试用期这一事实保持沉默，您将获得更好的结果。

尽管对许可目的有效，但“Call home”功能被许多人视为隐私威胁。我个人不同意这样的观点，即这对于愿意为他/她正在使用的软件付费的客户来说是一件坏事。因此，我建议实施一种许可方案，让应用程序定期检查许可状态（试用、付费），并在需要时帮助用户为软件付费。但是，对于小型实用程序应用程序来说，这可能有点过头了。

对于非常小的甚至简单的实用程序应用程序，我认为无需试用期的预付款是最有效的。

关于解决方案的安全性，您必须使其与开发工作成正比。在我的工作中，安全是非常关键的，因为有合作伙伴和经销商参与，因为在开发上的投资非常高。对于小型实用程序应用程序，正确定价并依靠诚实的用户为满足其业务需求的软件付费更有意义。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-09-19T18:31:48.253

做复杂的保护方案没有多大意义。基本上会发生以下两种情况之一：

1.  你的应用程序不够流行，没有人破解它。

2.  您的应用程序变得流行，有人破解并发布它，然后任何知识为零的人都可以简单地下载该破解程序，如果他们想欺骗您。

在 #1 的情况下，不值得在计划中投入大量精力，因为您可能会让一两个额外的人购买您的应用程序。在＃2的情况下，不值得付出很多努力，因为无论如何都会有人破解它，而努力会白费。

基本上我的建议是做一些简单的事情，就像你已经做的那样，这同样有效。不想欺骗/偷窃你的人会付出代价，想欺骗你的人无论如何都会这样做。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-19T18:31:57.800

如果您将主页托管在您控制的服务器上，您可以让软件的可下载试用版每晚自动编译为新的二进制文件。此编译将在软件到期时替换程序中的硬编码日期时间值。这样，“作弊”的唯一方法就是更改计算机上的日期，而大多数人不会这样做，因为会产生问题。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-19T18:39:48.313

试试共享软件入门工具包。它是我的 Microsoft 开发的，可能具有您想要的其他一些功能。

[http://msdn.microsoft.com/en-us/vs2005/aa718342.aspx](http://msdn.microsoft.com/en-us/vs2005/aa718342.aspx)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-19T18:34:57.920

如果你打算继续开发你的软件，你可以考虑勒索模型：

[http://en.wikipedia.org/wiki/Street_Performer_Protocol](http://en.wikipedia.org/wiki/Street_Performer_Protocol)

本质上，您开发了对软件的改进，然后在发布它们之前要求一定数量的捐款（没有任何 DRM）。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-19T18:39:24.680

一种对用户来说很容易但对您来说并不容易的方法是硬编码到期日期并不时制作新版本的安装程序...... :)

如果我是你，我不会让它比你已经在做的更先进。就像你说的只有 10 美元，如果有人真的想破解你的系统，不管你做得多么复杂，他们都会这样做。

您可以通过要求网络连接并让服务器生成试用密钥来对您的方案进行稍微高级的版本。如果您按照 sign(hash(unique_computer_id+when_to_expire)) 的方式执行某些操作，并让应用程序使用公钥检查您的服务器已签署过期日期，则它应该需要“真正的”破解才能绕过。

这样，您可以存储唯一 ID 的服务器端并拒绝生成超过一次或两次的到期日期。不确定使用什么作为唯一 ID，但应该有一些方法可以从 Windows 中获得有用的东西。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-19T18:43:19.177

我以非常低的价格出售的应用程序也面临同样的问题。

除了混淆应用程序之外，我还想出了一个系统，它使用注册表中的两个密钥，其中一个用于确定安装时间，另一个是实际的许可证密钥。密钥的命名不明确，缺少密钥表示安装被篡改。

当然，删除这两个密钥并重新安装应用程序将再次开始评估时间。

我认为无论如何都没有关系，因为想要破解应用程序的人会成功地这样做，或者找到成功的人破解。

所以最终我只是实现了让破解应用程序变得不太容易的目标，我猜这将阻止 80-90% 的客户这样做。毕竟：由于该应用程序以非常低的价格出售，我没有理由在这个问题上投入比我已经拥有的更多的时间。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-09-19T18:48:43.033

对许可证保持冷静。预先解释这是你的激情和你的劳动成果。让人们有机会做正确的事。如果有人想盗版它，它最终会发生。我仍然记得看到我在 bittorrent 上的书时的绝望，但这是你必须处理的事情。不要屈服于随意的盗版（你现在正在做的事情听起来很棒），但不要削弱除此之外的东西。我仍然相信，有足够多的诚实的人来进行以营利为目的的编码工作。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-09-19T19:02:19.523

不要根据“安装后的天数”进行评估，而是根据使用天数、运行次数或类似情况进行评估。人们倾向于下载共享软件，运行一次或两次，然后在几周内忘记它，直到他们再次需要它。到那时，试用版可能已经过期，因此即使他们已经安装了一段时间，他们也只尝试过几次就迷上了使用您的应用程序。相反，激活/天数让他们养成使用您的应用程序执行任务的习惯，并且还可以提高销售量（即您已使用此应用程序 30 次......）。

更好的是，限制功能比超时更好。例如，也许您的摄影应用程序可以将用户限制为 1 兆像素的图像，但让他们可以随心所欲地使用它。

此外，考虑将您的应用定价为 20 美元（或 19.95 美元）。除非已经有小额支付设置（如 iPhone 商店或 XBoxLive 之类的），否则人们往往会厌恶在某个价格点以下（大约 20 美元，具体取决于应用程序的类型）在线购买东西，并且人们会下意识地假设如果东西不贵，一定不是很好。您实际上可以以更高的价格提高转化率（当然可以达到一定程度）。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-19T18:31:26.210

在这种情况下，我真的认为你做什么并不重要。如果您有某种保护，它将阻止 90% 的用户。剩下的 10%——如果他们不想为您的软件付费，无论您做什么，他们几乎都会找到绕过保护的方法。

如果你想要一些不太明显的东西，你可以在 System32 中放置一个听起来像系统文件的文件，应用程序会在启动时检查它的存在。这可能有点难以追踪。

# tfs - 如何更改 MSBuild 在 Team Foundation Build 下使用的构建目录？

> ID：104292
> 
> 赞同：8
> 
> 时间：2008-09-19T18:24:29.737
> 
> 标签：tfs, msbuild, tfsbuild

尝试使用 Team Foundation Build 构建我的应用程序时出现以下错误：

> C:\WINDOWS\Microsoft.NET\Framework\v3.5\Microsoft.Common.targets(1682,9)：错误 MSB3554：无法写入输出文件“obj\Release\Company.Redacted.BlahBlah.Localization.Subsystems. Startup_Shutdown_Processing.StartupShutdownProcessingMessages.de.resources”。指定的路径、文件名或两者都太长。完全限定的文件名必须少于 260 个字符，目录名必须少于 248 个字符。

我的项目在我的开发机器上构建良好，因为源只有两个文件夹深，但 TF Build 似乎使用了一个非常深的目录，导致它中断。如何更改使用的文件夹？

**编辑：**我检查了存储在源代码管理中的构建的 .proj 文件，发现以下内容：

```
<!--  BUILD DIRECTORY
 This property is included only for backwards compatibility. The build directory used for a build 
 definition is now stored in the database, as the BuildDirectory property of the definition's 
 DefaultBuildAgent. For compatibility with V1 clients, keep this property in sync with the value 
 in the database.
-->
<BuildDirectoryPath>UNKNOWN</BuildDirectoryPath> 
```

如果这是存储在数据库中，我该如何更改它？

**编辑：**找到以下博客文章，它可能指向我的解决方案。现在我只需要弄清楚如何更改 Build Agent 中的设置。 [http://blogs.msdn.com/jpricket/archive/2007/04/30/build-type-builddirectorypath-build-agent-working-directory.aspx](http://blogs.msdn.com/jpricket/archive/2007/04/30/build-type-builddirectorypath-build-agent-working-directory.aspx)

目前我的工作目录是“$(Temp)\$(BuildDefinitionPath)”，但现在我不知道有哪些通配符可用于指定不同的文件夹。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-09-19T18:53:16.033

您需要编辑您的构建代理的构建工作目录，使乞求路径更小一些。要编辑构建代理，请右键单击“构建”节点并选择“管理构建代理...”

我个人使用 c:\bw\$(BuildDefinitionId) 之类的东西。$(BuildDefinitionId) 转换为构建定义的 id（因此得名 :-) ），这意味着您获得的构建路径以 c:\bw\36 而不是 c:\Documents and Settings\tfsbuild\Local 之类的内容开头Settings\Temp\BuildDefinitionName

祝你好运，

马丁。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-19T18:26:11.280

您必须从源代码管理资源管理器中签出构建脚本文件，并用肘部替换路径。

# sharepoint - 如何与 Sharepoint 并行运行另一个网站或 Web 服务？

> ID：104293
> 
> 赞同：1
> 
> 时间：2008-09-19T18:24:58.363
> 
> 标签：sharepoint, iis

我在尝试在同样运行 Sharepoint 2003 的 IIS 6 服务器上运行另一个 Web 服务时遇到 404 错误。我很确定这是 sharepoint 接管 IIS 配置的问题。有没有办法让 Sharepoint 所做的任何事情都忽略某个 Web 服务或网站？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-19T18:39:43.477

我找到了命令行解决方案。

```
STSADM.EXE -o addpath -url http://localhost/<your web service/app> -type exclusion 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-19T21:05:59.960

我取决于你的意思，如果你试图在与 sharepoint 相同的 URL 路径中做一些事情，那么上面关于托管路径的答案应该为你做，但也没有什么能阻止你仅仅创建另一个 Web IIS 内部的站点，sharepoint 只会接管进入其特定 Web 的请求。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-19T18:29:46.823

您必须进入 SharePoint 管理控制台并明确允许该 Web 应用程序在与 SharePoint 相同的网站上运行。

我相信它在定义的管理路径下。

管理中心 > 应用程序管理 > 定义托管路径

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-22T03:57:57.613

这不是从 2003 年到 2007 年的变化吗？不再有排除路径选项。

# c - C中的Apache模块FORM处理

> ID：104313
> 
> 赞同：4
> 
> 时间：2008-09-19T18:27:18.453
> 
> 标签：c, forms, apache, apache2

我正在用 C 语言实现一个 Apache 2.0.x 模块，以与我们现有的产品进​​行交互。我需要处理 FORM 数据，很可能使用 POST，但我也想处理 GET 案例。

Nick Kew 的[Apache Modules](https://rads.stackoverflow.com/amzn/click/com/0132409674)书中有一节是关于处理表单数据的。它提供了 POST 和 GET 的代码示例，它们返回表单中键+值对的 apr_hash_t。parse_form_from_POST 编组桶旅并将其展平到缓冲区中，而 parse_form_from_GET 可以简单地引用 URL。这两个例程都依赖于 parse_form_from_string 例程来遍历每个分隔字段并将信息提取到哈希表中。

这很好，但似乎应该有比在我的模块中添加几百行代码更简单的方法。apache、apr 或 apr-util 中是否存在现有模块或例程，可将字段名称和相关数据从 GET 或 POST FORM 提取到 C 代码更容易访问的结构中？我找不到任何相关的东西，但这似乎是一个应该有解决方案的共同需求。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2010-12-16T11:47:20.703

我切换到 G-WAN，它为 GET 和 POST 表单（以及许多其他好东西，如图表、GIF I/O 等）提供了一个透明的 ANSI C 脚本接口。

[GWAN 开发人员页面](http://gwan.com/developers)上提供了几个 AJAX 示例

希望能帮助到你！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-19T18:39:16.693

虽然从表面上看，这似乎很常见，但 apache 上的 C 语言中的 cgi 样式的内容处理程序却很少见。大多数人只使用 CGI、FastCGI 或无数框架，例如 mod_perl。

我编写的大多数 C apache 模块都旨在以适用于每个请求的特定、有针对性的方式修改 Web 服务器的特定行为。

如果完全有可能在 apache 模块之外编写处理程序，我会鼓励您采用这种策略。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-10-20T14:22:08.003

我还没有尝试过任何解决方案，因为我自己也对“Apache Modules”书中的示例感到沮丧，因此我发现了这个 SO 问题。但到目前为止，这是我发现的。当我进行更多研究时，我会更新这个答案。

幸运的是，现在这似乎是 Apache 2.4 中使用该功能解决的问题[`ap_parse_form_data`](http://ci.apache.org/projects/httpd/trunk/doxygen/group__APACHE__CORE__DAEMON.html#ga9d426b6382b49754d4f87c55f65af202)。

不知道这与您的示例相比有多好，但这里有一个[更简洁的`read_post`函数](http://docstore.mik.ua/orelly/apache_mod/139.htm)。

也有[`mod_form`](http://apache.webthing.com/mod_form/)可能是有价值的。

# c++ - 如何在 MacOS 上安装 Boost？

> ID：104322
> 
> 赞同：190
> 
> 时间：2008-09-19T18:28:16.017
> 
> 标签：c++, macos, boost

如何在 MacOS 上安装 Boost？现在我找不到适用于 Mac 的 bjam。

* * *

## 回答 #1

> 赞同：306
> 
> 时间：2012-02-08T15:49:05.247

您可以使用[Homebrew](http://brew.sh/)获得最新版本的 Boost 。

`brew install boost`.

* * *

## 回答 #2

> 赞同：163
> 
> 时间：2008-09-19T18:37:27.117

下载[MacPorts](https://www.macports.org/)，然后运行以下命令：

```
sudo port install boost 
```

* * *

## 回答 #3

> 赞同：115
> 
> 时间：2012-07-02T16:29:12.900

只需获取源代码，然后自己编译 Boost；它变得非常容易。以下是撰写本文时当前 macOS 上当前版本的 Boost 的示例：

1.  [从https://www.boost.org/users/download/#live](https://www.boost.org/users/download/#live)下载 .tar.gz
2.  解压并进入目录：

    ```
    tar -xzf boost_1_50_0.tar.gz
    cd boost_1_50_0
    ```

3.  配置（和构建`bjam`）：

    ```
    ./bootstrap.sh --prefix=/some/dir/you/would/like/to/prefix
    ```

4.  建造：

    ```
    ./b2
    ```

5.  安装：

    ```
    ./b2 install
    ```

根据您在步骤 3 中选择的前缀，如果脚本尝试将文件复制到受保护的位置，您可能需要执行步骤 5。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-11-12T13:46:39.600

除非您的编译器与 Mac XCode Dev 工具提供的编译器不同，否则只需按照[Unix 变体入门指南](http://www.boost.org/more/getting_started/unix-variants.html)5.1 节中的说明进行操作。最新源代码的配置和构建再简单不过了，配置大约需要 1 分钟，编译大约需要 10 分钟。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-09-19T19:10:55.460

[Fink](http://www.finkproject.org/)似乎拥有一整套 Boost 软件包...

安装并运行 fink 即可

```
fink install boost1.35.nopython 
```

在终端并接受它坚持的依赖关系。或使用

```
fink list boost 
```

获取可用的不同软件包的列表。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2015-10-09T13:40:17.277

分别使用自制软件安装它们。

> 冲泡安装提升
> 冲泡安装bjam

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2019-02-17T16:18:10.373

从 Mac 应用商店安装 Xcode。然后使用命令：

```
 /usr/bin/ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)" 
```

以上将安装自制软件并允许您在终端中使用 brew

然后只需使用命令：

```
brew install boost 
```

然后将boost库安装到`<your macusername>/usr/local/Cellar/boost`

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2014-10-10T13:27:40.073

为了避免编译需要在系统中安装 boost 的第三方库时出现问题，请运行以下命令：

```
sudo port install boost +universal 
```

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2016-04-15T22:04:24.423

# 尝试`+universal`

需要注意的一件事：为了有所作为，您需要使用 构建`python`，`+universal`如果您还没有或者您不确定是否可以重新构建`python +universal`。这适用于**brew**和**macports**。

```
$ brew reinstall python
$ brew install boost 
```

或者

```
$ sudo port -f uninstall python
$ sudo port install python +universal
$ sudo port install boost +universal 
```

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2008-09-19T18:38:01.483

你可以在这里下载适用于 OSX（或任何其他操作系统）的[bjam](http://sourceforge.net/project/showfiles.php?group_id=7586&package_id=72941)

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2020-12-30T03:42:50.583

如果你像我一样懒惰： `conda install -c conda-forge boost`

# javascript - 使用 jQuery 替换 XMLHttpRequest

> ID：104323
> 
> 赞同：14
> 
> 时间：2008-09-19T18:28:29.057
> 
> 标签：javascript, jquery, ajax

我对 JavaScript 库很陌生。我想用 jQuery 替换我当前的代码。我当前的代码如下所示：

```
var req;

function createRequest() {
   var key = document.getElementById("key");
   var keypressed = document.getElementById("keypressed");
   keypressed.value = key.value;
   var url = "/My_Servlet/response?key=" + escape(key.value);
   if (window.XMLHttpRequest) {
      req = new XMLHttpRequest();
   } else if (window.ActiveXObject) {
      req = new ActiveXObject("Microsoft.XMLHTTP");
   }
   req.open("Get", url, true);
   req.onreadystatechange = callback;
   req.send(null);
}

function callback() {
   if (req.readyState == 4) {
      if (req.status == 200) {
         var decimal = document.getElementById('decimal');
         decimal.value = req.responseText;
      }
   }
   clear();
} 
```

我想用 jQuery 之类的更友好的代码替换我的代码

```
$.get(url, callback); 
```

但是它不会调用我的回调函数。

另外我想调用一个`createRequest`连续调用的函数。jQuery 有一个很好的方法吗？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-09-19T18:39:39.890

```
$.get(url, {}, callback); 
```

应该做的伎俩。您的回调可以这样简化：

```
function callback(content){
    $('#decimal').val(content);
} 
```

甚至更短：

```
$.get(url, {}, function(content){
    $('#decimal').val(content);
}); 
```

总而言之，我认为这应该可行：

```
function createRequest() {
    var keyValue = $('#key').val();
    $('#keypressed').val(keyValue);
    var url = "/My_Servlet/response";
    $.get(url, {key: keyValue}, function(content){
        $('#decimal').val(content);
    });
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-19T18:42:57.633

取出 readyState 和状态检查。jQuery 仅在成功时调用您的回调。您的回调提供了参数`(data, textStatus)`，因此您应该使用`data`而不是`req.responseText`.

`window.setTimeout()`正如另一个答案所建议的那样，不会做你想做的事 - 只会等待然后调用你的函数一次。您需要`window.setInterval()`改用它，它将定期调用您的函数，直到您取消它。

所以，总结一下：

```
var interval = 500; /* Milliseconds between requests. */
window.setInterval(function() {
    var val = $("#key").val();
    $("#keypressed").val(val);
    $.get("/My_Servlet/response", { "key": val }, function(data, textStatus) {
        $("#decimal").val(data);
    });
}), interval); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-19T18:46:17.970

不需要在 URL 上设置 GET 参数，jQuery 会自动设置它们。试试这个代码：

```
var key = document.getElementById("key");
[...]
var url = "/My_Servlet/response";
$.get (url, {'key': key}, function (responseText)
{
    var decimal = document.getElementById ('decimal'); 
    decimal.value = responseText;
}); 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-19T18:30:21.893

我不认为 jQuery 实现了超时功能，但是普通的旧 javascript 做得很好:)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-19T18:31:06.680

根据[文档](http://docs.jquery.com/Ajax/jQuery.get)，jQuery.get 的论点是`url, data, callback`，不是`url, callback`。

在回调函数结束时调用 JavaScript 的 setTimeout 函数应该足以让它持续执行。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-19T21:07:42.733

最后我猜它被添加了类型。这似乎对我有用。

```
 function convertToDecimal(){ 
    var key = document.getElementById("key"); 
    var keypressed = document.getElementById("keypressed"); 
    keypressed.value = key.value; 
    var url = "/My_Servlet/response?key="+ escape(key.value);
    jQuery.get(url, {}, function(data){
       callback(data);}
       , "text" );
  }

  function callback(data){
    var decimal = document.getElementById('decimal');
    decimal.value = data;
    clear();
  } 
```

谢谢大家的帮助。我会投票给你。

# php - php中try-catch的性能

> ID：104329
> 
> 赞同：65
> 
> 时间：2008-09-19T18:29:00.977
> 
> 标签：php, performance, exception-handling, try-catch

在 php 5 中使用 try-catch 语句时需要考虑什么样的性能影响？

我以前在网上读过一些关于这个主题的古老且看似矛盾的信息。我目前必须使用的许多框架都是在 php 4 上创建的，并且缺乏 php 5 的许多细节。所以，我自己在使用 php 的 try-catchs 方面没有太多经验。

* * *

## 回答 #1

> 赞同：72
> 
> 时间：2008-09-19T18:58:02.090

要考虑的一件事是，没有抛出异常的 try 块的成本与实际抛出和捕获异常的成本是不同的问题。

如果仅在失败情况下抛出异常，那么您几乎肯定不会关心性能，因为每次执行程序都不会失败很多次。如果你在一个紧密的循环中失败了（又名：把你的头撞在砖墙上），你的应用程序可能会遇到比速度慢更严重的问题。所以不要担心抛出异常的成本，除非你被迫将它们用于常规控制流。

有人发布了一个关于引发异常的分析代码的答案。我自己从未测试过它，但我有信心地预测，这将显示出比只进出 try 块而不抛出任何东西更大的性能影响。

另一件要考虑的事情是，在嵌套调用很多级别的地方，在顶部进行一次 try...catch 甚至比检查返回值并在每次调用时传播错误更快。

在与这种情况相反的情况下，您发现将每个调用都包装在自己的 try...catch 块中，您的代码会变慢。而且更丑。

* * *

## 回答 #2

> 赞同：57
> 
> 时间：2009-01-14T23:28:00.257

我很无聊，并分析了以下内容（我将计时代码省略了）：

```
function no_except($a, $b) { 
    $a += $b;
    return $a;
}
function except($a, $b) { 
    try {
        $a += $b;
    } catch (Exception $e) {}
    return $a;
} 
```

使用两个不同的循环：

```
echo 'no except with no surrounding try';
for ($i = 0; $i < NUM_TESTS; ++$i) {
    no_except(5, 7);
}
echo 'no except with surrounding try';
for ($i = 0; $i < NUM_TESTS; ++$i) {
    try {
        no_except(5, 7);
    } catch (Exception $e) {}
}
echo 'except with no surrounding try';
for ($i = 0; $i < NUM_TESTS; ++$i) {
    except(5, 7);
}
echo 'except with surrounding try';
for ($i = 0; $i < NUM_TESTS; ++$i) {
    try {
        except(5, 7);
    } catch (Exception $e) {}
} 
```

在我的 WinXP 机器上运行 1000000 次运行 apache 和 PHP 5.2.6：

```
no except with no surrounding try = 3.3296
no except with surrounding try = 3.4246
except with no surrounding try = 3.2548
except with surrounding try = 3.2913 
```

这些结果是一致的，并且无论以何种顺序进行测试，都保持相似的比例。

结论：添加处理罕见异常的代码并不比忽略异常的代码慢。

* * *

## 回答 #3

> 赞同：24
> 
> 时间：2013-07-16T19:07:25.377

Try-catch 块不是性能问题——真正的性能瓶颈来自于创建异常对象。

测试代码：

```
function shuffle_assoc($array) { 
    $keys = array_keys($array);
    shuffle($keys);
    return array_merge(array_flip($keys), $array);
}

$c_e = new Exception('n');

function no_try($a, $b) { 
    $a = new stdclass;
    return $a;
}
function no_except($a, $b) { 
    try {
        $a = new Exception('k');
    } catch (Exception $e) {
        return $a + $b;
    }
    return $a;
}
function except($a, $b) { 
    try {
        throw new Exception('k');
    } catch (Exception $e) {
        return $a + $b;
    }
    return $a;
}
function constant_except($a, $b) {
    global $c_e;
    try {
        throw $c_e;
    } catch (Exception $e) {
        return $a + $b;
    }
    return $a;
}

$tests = array(
    'no try with no surrounding try'=>function() {
        no_try(5, 7);
    },
    'no try with surrounding try'=>function() {
        try {
            no_try(5, 7);
        } catch (Exception $e) {}
    },
    'no except with no surrounding try'=>function() {
        no_except(5, 7);
    },
    'no except with surrounding try'=>function() {
        try {
            no_except(5, 7);
        } catch (Exception $e) {}
    },
    'except with no surrounding try'=>function() {
        except(5, 7);
    },
    'except with surrounding try'=>function() {
        try {
            except(5, 7);
        } catch (Exception $e) {}
    },
    'constant except with no surrounding try'=>function() {
        constant_except(5, 7);
    },
    'constant except with surrounding try'=>function() {
        try {
            constant_except(5, 7);
        } catch (Exception $e) {}
    },
);
$tests = shuffle_assoc($tests);

foreach($tests as $k=>$f) {
    echo $k;
    $start = microtime(true);
    for ($i = 0; $i < 1000000; ++$i) {
        $f();
    }
    echo ' = '.number_format((microtime(true) - $start), 4)."<br>\n";
} 
```

结果：

```
no try with no surrounding try = 0.5130
no try with surrounding try = 0.5665
no except with no surrounding try = 3.6469
no except with surrounding try = 3.6979
except with no surrounding try = 3.8729
except with surrounding try = 3.8978
constant except with no surrounding try = 0.5741
constant except with surrounding try = 0.6234 
```

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2008-09-19T18:36:04.470

通常，使用异常来防止意外故障，并在代码中使用错误检查来防止属于正常程序状态的故障。为了显示：

1.  在数据库中找不到记录 - 有效状态，您应该检查查询结果并适当地向用户发送消息。

2.  尝试获取记录时出现 SQL 错误 - 意外失败，记录可能存在也可能不存在，但您有程序错误 - 这是异常的好地方 - 在错误日志中记录错误，通过电子邮件向管理员发送堆栈跟踪，并显示向用户发送一条礼貌的错误消息，告知他出了点问题，您正在处理它。

异常是昂贵的，但除非您使用它们处理整个程序流程，否则任何性能差异都不应该是人为的。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-09-19T18:35:45.657

我在 Google 上没有发现任何有关 Try/Catch 性能的信息，但是一个简单的测试使用循环抛出错误而不是 IF 语句在 5000 个循环中产生 329 毫秒和 6 毫秒。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2012-10-08T16:29:07.663

很抱歉发布了一条非常旧的消息，但我阅读了评论，但我有点不同意，简单的代码段差异可能很小，或者在 Try/Catch 用于特定代码部分的情况下可能可以忽略不计总是可以预测的，但我也相信（未经测试）一个简单的：

```
if(isset($var) && is_array($var)){
    foreach($var as $k=>$v){
         $var[$k] = $v+1;
    }
} 
```

比

```
try{
    foreach($var as $k=>$v){
        $var[$k] = $v+1;
    }
}catch(Exception($e)){
} 
```

我也相信（未经测试）：

```
<?php
//beginning code
try{
    //some more code
    foreach($var as $k=>$v){
        $var[$k] = $v+1;
    }
    //more code
}catch(Exception($e)){
}
//output everything
?> 
```

比代码中额外的 IF 更昂贵

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-12-03T11:43:34.860

这是一个非常好的问题！

我已经对其进行了多次测试，从未发现任何性能问题；-) 10 年前在 C++ 中确实如此，但我认为今天他们已经改进了很多，因为它非常有用和清洁。

但我仍然害怕用它来包围我的第一个入口点：

```
try {Controller::run();}catch(...) 
```

我没有用大量的函数调用和大的包含进行测试....有人已经完全测试了吗？

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2020-04-09T21:30:10.417

我更新了 Brilliand 的测试代码，使其报告更易于理解，并且通过增加更多随机性在统计上更真实。由于我更改了一些测试以使其更公平，因此结果会有所不同，因此我将其写为不同的答案。

我的测试执行者：PHP 7.4.4 (cli) (build: Mar 20 2020 13:47:45) (NTS)

```
<?php

function shuffle_assoc($array) {
    $keys = array_keys($array);
    shuffle($keys);
    return array_merge(array_flip($keys), $array);
}

$c_e = new Exception('n');

function do_nothing($a, $b) {
    return $a + $b;
}
function new_exception_but_not_throw($a, $b) {
    try {
        new Exception('k');
    } catch (Exception $e) {
        return $a + $b;
    }
    return $a + $b;
}
function new_exception_and_throw($a, $b) {
    try {
        throw new Exception('k');
    } catch (Exception $e) {
        return $a + $b;
    }
    return $a + $b;
}
function constant_exception_and_throw($a, $b) {
    global $c_e;
    try {
        throw $c_e;
    } catch (Exception $e) {
        return $a + $b;
    }
    return $a + $b;
}

$tests = array(
    'do_nothing with no surrounding try'=>function() {
        do_nothing(5, 7);
    },
    'do_nothing with surrounding try'=>function() {
        try {
            do_nothing(5, 7);
        } catch (Exception $e) {}
    },
    'new_exception_but_not_throw with no surrounding try'=>function() {
        new_exception_but_not_throw(5, 7);
    },
    'new_exception_but_not_throw with surrounding try'=>function() {
        try {
            new_exception_but_not_throw(5, 7);
        } catch (Exception $e) {}
    },
    'new_exception_and_throw with no surrounding try'=>function() {
        new_exception_and_throw(5, 7);
    },
    'new_exception_and_throw with surrounding try'=>function() {
        try {
            new_exception_and_throw(5, 7);
        } catch (Exception $e) {}
    },
    'constant_exception_and_throw with no surrounding try'=>function() {
        constant_exception_and_throw(5, 7);
    },
    'constant_exception_and_throw with surrounding try'=>function() {
        try {
            constant_exception_and_throw(5, 7);
        } catch (Exception $e) {}
    },
);
$results = array_fill_keys(array_keys($tests), 0);
$testCount = 30;
const LINE_SEPARATOR = PHP_EOL; //"<br>";

for ($x = 0; $x < $testCount; ++$x) {
    if (($testCount-$x) % 5 === 0) {
        echo "$x test cycles done so far".LINE_SEPARATOR;
    }
    $tests = shuffle_assoc($tests);
    foreach ($tests as $k => $f) {
        $start = microtime(true);
        for ($i = 0; $i < 1000000; ++$i) {
            $f();
        }
        $results[$k] += microtime(true) - $start;
    }
}
echo LINE_SEPARATOR;
foreach ($results as $type => $result) {
    echo $type.' = '.number_format($result/$testCount, 4).LINE_SEPARATOR;
} 
```

结果如下：

```
do_nothing with no surrounding try = 0.1873
do_nothing with surrounding try = 0.1990
new_exception_but_not_throw with no surrounding try = 1.1046
new_exception_but_not_throw with surrounding try = 1.1079
new_exception_and_throw with no surrounding try = 1.2114
new_exception_and_throw with surrounding try = 1.2208
constant_exception_and_throw with no surrounding try = 0.3214
constant_exception_and_throw with surrounding try = 0.3312 
```

结论是：

*   添加额外的 try-catch 每 1000000 次迭代增加约 0.01 微秒
*   异常抛出和捕获增加了 ~0.12 微秒（x12 与之前没有抛出任何东西并且没有捕获任何东西相比）
*   异常创建增加了 ~0.91 微秒（x7.6 与前一行计算的 try-catch 机制的执行相比）

所以最昂贵的部分是异常创建 - 不是 throw-catch 机制，但是后者使这个简单的例程比 do_nothing 场景慢 2 倍。

* 结论中的所有测量值都是四舍五入的，并不假装科学准确。

* * *

## 回答 #9

> 赞同：-9
> 
> 时间：2008-09-19T18:31:57.020

一般来说，它们在 PHP 中很昂贵且不值得。

由于它是一种检查表达式语言，因此您必须捕获任何引发异常的东西。

在处理不会抛出的遗留代码和会抛出的新代码时，只会导致混乱。

祝你好运！

# sql - SQL 查询帮助：以不平凡的方式转换日期

> ID：104330
> 
> 赞同：3
> 
> 时间：2008-09-19T18:29:01.053
> 
> 标签：sql, sql-server, date, sql-server-2000, dateadd

我有一个带有“日期”列的表，我想做一个执行以下操作的查询：

如果日期是**Monday**、**Tuesday**、**Wednesday**或**Thursday**，则显示的日期应上移 1 天，如

```
DATEADD（天，1，[日期]）
```

另一方面，如果是**Friday**，则显示的日期应增加 3 天（即变为下一个*Monday*）。

如何在我的 SELECT 语句中执行此操作？如中，

```
SELECT somewayofdoingthis([Date]) FROM myTable
```

（这是 SQL Server 2000。）

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-19T18:36:54.653

这是我将如何做到的。如果您将在其他地方使用它，我建议您使用上述功能。

```
CASE
WHEN
    DATEPART(dw, [Date]) IN (2,3,4,5)
THEN
    DATEADD(d, 1, [Date])
WHEN
    DATEPART(dw, [Date]) = 6
THEN
    DATEADD(d, 3, [Date])
ELSE
    [Date]
END AS [ConvertedDate] 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-19T18:37:33.980

```
CREATE FUNCTION dbo.GetNextWDay(@Day datetime)
RETURNS DATETIME
AS
BEGIN 
    DECLARE @ReturnDate DateTime

    set @ReturnDate = dateadd(dd, 1, @Day)

    if (select datename(@ReturnDate))) = 'Saturday'
        set @ReturnDate = dateadd(dd, 2, @ReturnDate)

    if (select datename(@ReturnDate) = 'Sunday'
        set @ReturnDate = dateadd(dd, 1, @ReturnDate)

    RETURN @ReturnDate
END 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-19T18:38:25.383

尝试

```
select case  when datepart(dw,[Date]) between 2 and 5 then DATEADD(dd, 1, [Date])
when datepart(dw,[Date]) = 6 then DATEADD(dd, 3, [Date]) else [Date] end as [Date] 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-19T18:46:13.307

我假设您还希望周六和周日提前到下周一。如果不是这种情况，请从 (1,2,3,4,5) 中取出 1 并删除最后一个 when 子句。

```
case
   --Sunday thru Thursday are shifted forward 1 day
   when datepart(weekday, [Date]) in (1,2,3,4,5) then dateadd(day, 1, [Date]) 
   --Friday is shifted forward to Monday
   when datepart(weekday, [Date]) = 6  then dateadd(day, 3, [Date])
   --Saturday is shifted forward to Monday
   when datepart(weekday, [Date]) = 7  then dateadd(day, 2, [Date])
end 
```

您也可以在一行中完成：

```
select dateadd(day, 1 + (datepart(weekday, [Date])/6) * (8-datepart(weekday, [Date])), [Date]) 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-19T18:34:22.897

听起来像一个 CASE 表达式。我不知道 SQL Server 的正确数据操作，但基本上它看起来像这样：

```
CASE
  WHEN [Date] is a Friday THEN DATEADD( day, 3, [Date] )
  ELSE DATEADD( day, 1, [Date] )
END 
```

如果您想检查周末，您可以在 ELSE 之前添加额外的 WHEN 子句。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-19T18:36:32.160

这不在我的脑海中，可以清楚地清理，但以它为起点：

```
select case when DATENAME(dw, [date]) = 'Monday' then DATEADD(dw, 1, [Date])
                when DATENAME(dw, [date]) = 'Tuesday' then DATEADD(dw, 1, [Date])
                when DATENAME(dw, [date]) = 'Wednesday' then DATEADD(dw, 1, [Date])
                when DATENAME(dw, [date]) = 'Thursday' then DATEADD(dw, 1, [Date])
                when  DATENAME(dw, [date]) = 'Friday' then DATEADD(dw, 3, [Date])
          end as nextDay
    ... 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-19T18:36:51.003

你可以使用这个：

```
select dayname,newdayname =
    CASE dayname
    WHEN 'Monday' THEN 'Tuesday'
    WHEN 'Tuesday' THEN 'Wednesday'
    WHEN 'Wednesday' THEN 'Thursday'
    WHEN 'Thursday' THEN 'Friday'
    WHEN 'Friday' THEN 'Monday'
    WHEN 'Saturday' THEN 'Monday'
    WHEN 'Sunday' THEN 'Monday'
END
FROM UDO_DAYS 
```

```
结果：
星期一星期二
周二周三
星期三星期四
星期四星期五
周五 周一
星期六 星期一
星期天星期一

表数据：
周一
周二
周三
周四
星期五
周六
星期日

```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-19T18:38:04.167

查找 CASE 语句和 DATEPART 语句。您将希望将 dw 参数与 DATEPART 一起使用以获取表示星期几的整数。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-19T20:07:50.113

如何从[数据仓库](http://en.wikipedia.org/wiki/Data_warehouse)的人那里获取一页并制作一张表格。在 DW 术语中，这将是一个日期维度。一个[标准的日期维度](http://www.ipcdesigns.com/dim_date/)将包含诸如日期的各种名称（“MON”、“Monday”、“1998 年 8 月 22 日”）或诸如月末和月初的指标之类的东西。但是，您也可以拥有仅在您的环境中有意义的列。

例如，根据问题，您的问题可能有一个 next-work-day 列，该列将指向相关日期的键。这样，您可以进一步自定义它以考虑假期或其他非工作日。

DW 的人坚持使用无意义的密钥（也就是说，不要只使用截断的日期作为密钥，而是使用生成的密钥），但您可以自己决定。

[Date Dimension Toolkit](http://www.ipcdesigns.com/dim_date/)具有在各种 DBMS 中生成您自己的表的代码，并且它具有数年日期的 CSV 数据。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-19T18:32:39.720

您需要创建一个为您执行此转换的 SQL 函数。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-19T20:00:03.223

这很像 Brian 的，只是由于括号不匹配而没有编译，我将 IF 更改为没有选择。需要注意的是，我们在这里使用 DateNAME 而不是 datePART，因为 datePART 取决于 SET DATEFIRST 设置的值，它设置一周的第一天。

```
CREATE FUNCTION dbo.GetNextWDay(@Day datetime)
RETURNS DATETIME
AS
BEGIN
    DECLARE @ReturnDate DateTime

    set @ReturnDate = dateadd(dd, 1, @Day)
    if datename(dw, @ReturnDate) = 'Saturday'
        set @ReturnDate = dateadd(dd, 2, @ReturnDate)
    if datename(dw, @ReturnDate) = 'Sunday'
        set @ReturnDate = dateadd(dd, 1, @ReturnDate)
    RETURN @ReturnDate
END 
```

* * *

## 回答 #12

> 赞同：-2
> 
> 时间：2008-09-19T18:42:17.777

```
create table #dates (dt datetime)
insert into #dates (dt) values ('1/1/2001')
insert into #dates (dt) values ('1/2/2001')
insert into #dates (dt) values ('1/3/2001')
insert into #dates (dt) values ('1/4/2001')
insert into #dates (dt) values ('1/5/2001')

    select
        dt, day(dt), dateadd(dd,1,dt)
    from
        #dates
    where
        day(dt) between 1 and 4

    union all

    select
        dt, day(dt), dateadd(dd,3,dt)
    from
        #dates
    where
        day(dt) = 5

    drop table #dates 
```

# objective-c - Objective-C 使用对象切换？

> ID：104339
> 
> 赞同：14
> 
> 时间：2008-09-19T18:29:45.187
> 
> 标签：objective-c, design-patterns, switch-statement

我正在做一些涉及解析 NSXmlDocument 并从结果中填充对象属性的 Objective-C 编程。

第一个版本看起来像这样：

```
if([elementName compare:@"companyName"] == 0) 
  [character setCorporationName:currentElementText]; 
else if([elementName compare:@"corporationID"] == 0) 
  [character setCorporationID:currentElementText]; 
else if([elementName compare:@"name"] == 0) 
  ... 
```

但我不喜欢`if-else-if-else`这种产生的模式。查看`switch`语句，我发现我只能处理`ints`, `chars`etc 而不能处理对象......所以有没有更好的实现模式我不知道？

顺便说一句，我确实想出了一个更好的解决方案来设置对象的属性，但我想具体了解Objective-C 中`if`的`else`-vs模式`switch`

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-09-21T04:37:51.907

您应该利用键值编码：

```
[character setValue:currentElementText forKey:elementName]; 
```

如果数据不受信任，您可能需要检查密钥是否有效：

```
if (![validKeysCollection containsObject:elementName])
    // Exception or error 
```

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-09-26T09:26:59.737

我希望你们都原谅我在这里跑题了，但是我想解决在 Cocoa 中解析 XML 文档而不需要 if-else 语句的更一般的问题。最初陈述的问题将当前元素文本分配给字符对象的实例变量。正如 jmah 指出的，这可以使用键值编码来解决。但是，在更复杂的 XML 文档中，这可能是不可能的。例如，考虑以下内容。

```
<xmlroot>
    <corporationID>
        <stockSymbol>EXAM</stockSymbol>
        <uuid>31337</uuid>
    </corporationID>
    <companyName>Example Inc.</companyName>
</xmlroot> 
```

有多种方法可以处理这个问题。在我的脑海中，我可以想到两个使用 NSXMLDocument。第一个使用 NSXMLElement。它相当简单，根本不涉及 if-else 问题。您只需获取根元素并一一遍历其命名元素。

```
NSXMLElement* root = [xmlDocument rootElement];

// Assuming that we only have one of each element.
[character setCorperationName:[[[root elementsForName:@"companyName"] objectAtIndex:0] stringValue]];

NSXMLElement* corperationId = [root elementsForName:@"corporationID"];
[character setCorperationStockSymbol:[[[corperationId elementsForName:@"stockSymbol"] objectAtIndex:0] stringValue]];
[character setCorperationUUID:[[[corperationId elementsForName:@"uuid"] objectAtIndex:0] stringValue]]; 
```

下一个使用更通用的NSXMLNode，遍历树，直接使用if-else结构。

```
// The first line is the same as the last example, because NSXMLElement inherits from NSXMLNode
NSXMLNode* aNode = [xmlDocument rootElement];
while(aNode = [aNode nextNode]){
    if([[aNode name] isEqualToString:@"companyName"]){
        [character setCorperationName:[aNode stringValue]];
    }else if([[aNode name] isEqualToString:@"corporationID"]){
        NSXMLNode* correctParent = aNode;
        while((aNode = [aNode nextNode]) == nil && [aNode parent != correctParent){
            if([[aNode name] isEqualToString:@"stockSymbol"]){
                [character setCorperationStockSymbol:[aNode stringValue]];
            }else if([[aNode name] isEqualToString:@"uuid"]){
                [character setCorperationUUID:[aNode stringValue]];
            }
        }
    }
} 
```

这是消除 if-else 结构的一个很好的候选，但是像原来的问题一样，我们不能在这里简单地使用 switch-case。但是，我们仍然可以通过使用 performSelector 来消除 if-else。第一步是为每个元素定义一个方法。

```
- (NSNode*)parse_companyName:(NSNode*)aNode
{
    [character setCorperationName:[aNode stringValue]];
    return aNode;
}

- (NSNode*)parse_corporationID:(NSNode*)aNode
{
    NSXMLNode* correctParent = aNode;
    while((aNode = [aNode nextNode]) == nil && [aNode parent != correctParent){
        [self invokeMethodForNode:aNode prefix:@"parse_corporationID_"];
    }
    return [aNode previousNode];
}

- (NSNode*)parse_corporationID_stockSymbol:(NSNode*)aNode
{
    [character setCorperationStockSymbol:[aNode stringValue]];
    return aNode;
}

- (NSNode*)parse_corporationID_uuid:(NSNode*)aNode
{
    [character setCorperationUUID:[aNode stringValue]];
    return aNode;
} 
```

魔法发生在 invokeMethodForNode:prefix: 方法中。我们根据元素的名称生成选择器，并使用 aNode 作为唯一参数来执行该选择器。Presto Bango，我们已经消除了对 if-else 语句的需要。这是该方法的代码。

```
- (NSNode*)invokeMethodForNode:(NSNode*)aNode prefix:(NSString*)aPrefix
{
    NSNode* ret = nil;
    NSString* methodName = [NSString stringWithFormat:@"%@%@:", prefix, [aNode name]];
    SEL selector = NSSelectorFromString(methodName);
    if([self respondsToSelector:selector])
        ret = [self performSelector:selector withObject:aNode];
    return ret;
} 
```

现在，我们可以简单地编写一行代码，而不是我们更大的 if-else 语句（区分 companyName 和corporateID 的语句）

```
NSXMLNode* aNode = [xmlDocument rootElement];
while(aNode = [aNode nextNode]){
    aNode = [self invokeMethodForNode:aNode prefix:@"parse_"];
} 
```

现在，如果我有任何错误，我深表歉意，自从我用 NSXMLDocument 编写任何东西以来已经有一段时间了，现在已经很晚了，我实际上并没有测试这段代码。因此，如果您发现任何错误，请发表评论或编辑此答案。

但是，我相信我刚刚展示了如何在 Cocoa 中使用正确命名的选择器来完全消除这种情况下的 if-else 语句。有一些陷阱和极端情况。performSelector: 系列方法只接受 0、1 或 2 个参数方法，它们的参数和返回类型都是对象，所以如果参数和返回类型的类型不是对象，或者有两个以上的参数，那么你会必须使用 NSInvocation 来调用它。您必须确保您生成的方法名称不会调用其他方法，特别是如果调用的目标是另一个对象，并且此特定方法命名方案不适用于具有非字母数字字符的元素。您可以通过以某种方式转义方法名称中的 XML 元素名称来解决此问题，或者通过使用方法名称作为键和选择器作为值来构建一个 NSDictionary。这可能会占用大量内存并最终花费更长的时间。像我描述的 performSelector 调度非常快。对于非常大的 if-else 语句，此方法甚至可能比 if-else 语句更快。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-09-26T19:49:43.037

我敢建议使用宏吗？

```
#define TEST( _name, _method ) \
  if ([elementName isEqualToString:@ _name] ) \
    [character _method:currentElementText]; else
#define ENDTEST { /* empty */ }

TEST( "companyName",      setCorporationName )
TEST( "setCorporationID", setCorporationID   )
TEST( "name",             setName            )
:
:
ENDTEST 
```

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-09-26T21:35:18.383

如果您想使用尽可能少的代码，并且您的元素名称和 setter 都已命名，因此如果 elementName 为 @"foo" 则 setter 为 setFoo:，您可以执行以下操作：

```
SEL selector = NSSelectorFromString([NSString stringWithFormat:@"set%@:", [elementName capitalizedString]]);

[character performSelector:selector withObject:currentElementText]; 
```

甚至可能：

```
[character setValue:currentElementText forKey:elementName]; // KVC-style 
```

虽然这些当然比使用一堆 if 语句要慢一些。

[编辑：第二个选项已经有人提到过；哎呀！]

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-09-23T00:14:44.380

我使用 NSStrings 完成此操作的一种方法是使用 NSDictionary 和枚举。它可能不是最优雅的，但我认为它使代码更具可读性。以下伪代码是从[我的一个项目](http://sunsetlakesoftware.com/molecules)中提取的：

```
typedef enum { UNKNOWNRESIDUE, DEOXYADENINE, DEOXYCYTOSINE, DEOXYGUANINE, DEOXYTHYMINE } SLSResidueType;

static NSDictionary *pdbResidueLookupTable;
...

if (pdbResidueLookupTable == nil)
{
    pdbResidueLookupTable = [[NSDictionary alloc] initWithObjectsAndKeys:
                          [NSNumber numberWithInteger:DEOXYADENINE], @"DA", 
                          [NSNumber numberWithInteger:DEOXYCYTOSINE], @"DC",
                          [NSNumber numberWithInteger:DEOXYGUANINE], @"DG",
                          [NSNumber numberWithInteger:DEOXYTHYMINE], @"DT",
                          nil]; 
}

SLSResidueType residueIdentifier = [[pdbResidueLookupTable objectForKey:residueType] intValue];
switch (residueIdentifier)
{
    case DEOXYADENINE: do something; break;
    case DEOXYCYTOSINE: do something; break;
    case DEOXYGUANINE: do something; break;
    case DEOXYTHYMINE: do something; break;
} 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-09-19T19:07:00.043

您拥有的`if-else`实现是执行此操作的正确方法，因为它`switch`不适用于对象。除了可能有点难以阅读（这是主观的）之外，以`if-else`这种方式使用语句并没有真正的缺点。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-09-21T04:30:17.653

虽然不一定有更好的方法来做这样的事情一次性使用，但是当你可以使用“isEqualToString”时，为什么还要使用“compare”呢？这似乎更有效率，因为比较会在第一个不匹配的字符处停止，而不是通过整个事情来计算有效的比较结果（尽管想想看，比较可能在同一点很清楚） - 虽然它看起来更干净一些，因为该调用返回一个 BOOL。

```
if([elementName isEqualToString:@"companyName"] ) 
  [character setCorporationName:currentElementText]; 
else if([elementName isEqualToString:@"corporationID"] ) 
  [character setCorporationID:currentElementText]; 
else if([elementName isEqualToString:@"name"] ) 
```

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-09-27T08:00:28.147

实际上有一种相当简单的方法来处理像 Objective-C 这样的语言中的级联 if-else 语句。是的，您可以使用子类化和覆盖，创建一组以不同方式实现相同方法的子类，在运行时使用公共消息调用正确的实现。如果您希望选择几个实现之一，这很有效，但如果您有许多小的、稍微不同的实现，就像您在长 if-else 或 switch 语句中往往有的那样，它可能会导致子类不必要的扩散。

相反，将每个 if/else-if 子句的主体分解为它自己的方法，都在同一个类中。以类似的方式命名调用它们的消息。现在创建一个包含这些消息的选择器的 NSArray（使用 @selector() 获得）。使用 NSSelectorFromString() 将您在条件句中测试的字符串强制转换为选择器（您可能需要首先将其他单词或冒号连接到它，具体取决于您如何命名这些消息，以及它们是否带有参数）。现在使用 performSelector: 自行执行选择器。

这种方法的缺点是它可以用许多新消息将类弄乱，但是与使用新子类的整个类层次结构相比，将单个类弄乱可能更好。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2009-08-01T03:47:27.103

将其发布为对 Wevah 上述回答的回应——我会编辑，但我还没有足够高的声誉：

不幸的是，第一种方法会破坏其中包含多个单词的字段——比如 xPosition。capitalizedString 会将其转换为 Xposition，当与格式结合使用时，将为您提供 setXposition: 。绝对不是这里想要的。这是我在代码中使用的内容：

```
NSString *capName = [elementName stringByReplacingCharactersInRange:NSMakeRange(0, 1) withString:[[elementName substringToIndex:1] uppercaseString]];
SEL selector = NSSelectorFromString([NSString stringWithFormat:@"set%@:", capName]); 
```

不如第一种方法漂亮，但它有效。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2012-04-12T13:16:27.633

我想出了一个解决方案，它使用块为对象创建类似开关的结构。它是这样的：

```
BOOL switch_object(id aObject, ...)
{
    va_list args;
    va_start(args, aObject);

    id value = nil;
    BOOL matchFound = NO;

    while ( (value = va_arg(args,id)) )
    {
        void (^block)(void) = va_arg(args,id);
        if ( [aObject isEqual:value] )
        {
            block();
            matchFound = YES;
            break;
        }
    }

    va_end(args);
    return matchFound;
} 
```

如您所见，这是一个带有可变参数列表的老式 C 函数。我在第一个参数中传递要测试的对象，然后是 case_value-case_block 对。（回想一下，Objective-C 块只是对象。）`while`循环不断提取这些对，直到对象值匹配或没有剩余案例（见下面的注释）。

用法：

```
NSString* str = @"stuff";
switch_object(str,
              @"blah", ^{
                  NSLog(@"blah");
              },
              @"foobar", ^{
                  NSLog(@"foobar");
              },
              @"stuff", ^{
                  NSLog(@"stuff");
              },
              @"poing", ^{
                  NSLog(@"poing");
              },
              nil);   // <-- sentinel

// will print "stuff" 
```

笔记：

*   这是没有任何错误检查的第一个近似值
*   案例处理程序是块的事实，在涉及从内部引用的变量的可见性、范围和内存管理时需要额外注意
*   如果你忘记了哨兵，你注定要失败：P
*   当没有匹配的情况下，您可以使用布尔返回值触发“默认”情况

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-09-19T19:03:00.753

建议用于消除 if-else 或 switch 语句的最常见重构是引入多态性（参见[http://www.refactoring.com/catalog/replaceConditionalWithPolymorphism.html](http://www.refactoring.com/catalog/replaceConditionalWithPolymorphism.html)）。当它们被重复时，消除这些条件是最重要的。在像您的示例这样的 XML 解析的情况下，您实际上是将数据移动到更自然的结构中，这样您就不必在其他地方复制条件。在这种情况下，if-else 或 switch 语句可能就足够了。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-09-20T23:00:21.143

在这种情况下，我不确定您是否可以像 Bradley 建议的那样轻松重构该类以引入多态性，因为它是一个 Cocoa-native 类。相反，Objective-C 的做法是使用类类别`elementNameCode`向 NSSting 添加方法：

```
 typedef enum { 
       companyName = 0,
       companyID,  
       ...,
       Unknown
    } ElementCode;

    @interface NSString (ElementNameCodeAdditions)
    - (ElementCode)elementNameCode; 
    @end

    @implementation NSString (ElementNameCodeAdditions)
    - (ElementCode)elementNameCode {
        if([self compare:@"companyName"]==0) {
            return companyName;
        } else if([self compare:@"companyID"]==0) {
            return companyID;
        } ... {

        }

        return Unknown;
    }
    @end 
```

在您的代码中，您现在可以使用一个开关`[elementName elementNameCode]`（如果您忘记测试枚举成员之一等，则会获得相关的编译器警告）。

正如布拉德利指出的那样，如果逻辑只用在一个地方，这可能不值得。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-11-04T17:48:20.240

在我们的项目中，我们需要一遍又一遍地做这种事情，就是设置一个静态 CFDictionary，将要检查的字符串/对象映射到一个简单的整数值。它导致代码如下所示：

```
static CFDictionaryRef  map = NULL;
int count = 3;
const void *keys[count] = { @"key1", @"key2", @"key3" };
const void *values[count] = { (uintptr_t)1, (uintptr_t)2, (uintptr_t)3 };

if (map == NULL)
    map = CFDictionaryCreate(NULL,keys,values,count,&kCFTypeDictionaryKeyCallBacks,NULL);

switch((uintptr_t)CFDictionaryGetValue(map,[node name]))
{
    case 1:
        // do something
        break;
    case 2:
        // do something else
        break;
    case 3:
        // this other thing too
        break;
} 
```

如果您只针对 Leopard，您可以使用 NSMapTable 而不是 CFDictionary。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2013-02-09T15:16:35.807

与 Lvsti 类似，我使用块在对象上执行切换模式。

我编写了一个非常简单的基于过滤器块的链，它采用 n 个过滤器块并对对象执行每个过滤器。
每个过滤器都可以更改对象，但必须返回它。无论。

NSObject+Functional.h

```
#import <Foundation/Foundation.h>
typedef id(^FilterBlock)(id element, NSUInteger idx, BOOL *stop);

@interface NSObject (Functional)
-(id)processByPerformingFilterBlocks:(NSArray *)filterBlocks;
@end 
```

NSObject+Functional.m

```
@implementation NSObject (Functional)
-(id)processByPerformingFilterBlocks:(NSArray *)filterBlocks
{
    __block id blockSelf = self;
    [filterBlocks enumerateObjectsUsingBlock:^( id (^block)(id,NSUInteger idx, BOOL*) , NSUInteger idx, BOOL *stop) {
        blockSelf = block(blockSelf, idx, stop);
    }];

    return blockSelf;
}
@end 
```

现在我们可以设置`n`FilterBlocks 来测试不同的情况。

```
FilterBlock caseYES = ^id(id element, NSUInteger idx, BOOL *breakAfter){ 
    if ([element isEqualToString:@"YES"]) { 
        NSLog(@"You did it");  
        *breakAfter = YES;
    } 
    return element;
};

FilterBlock caseNO  = ^id(id element, NSUInteger idx, BOOL *breakAfter){ 
    if ([element isEqualToString:@"NO"] ) { 
        NSLog(@"Nope");
        *breakAfter = YES;
    }
    return element;
}; 
```

现在我们将要测试的那些块作为过滤器链粘贴到数组中：

```
NSArray *filters = @[caseYES, caseNO]; 
```

并且可以在一个对象上执行它

```
id obj1 = @"YES";
id obj2 = @"NO";
[obj1 processByPerformingFilterBlocks:filters];
[obj2 processByPerformingFilterBlocks:filters]; 
```

这种方法可用于切换，也可用于任何（条件）过滤器链应用程序，因为块可以编辑元素并将其传递。

# urlscan - URLSCAN 问题

> ID：104341
> 
> 赞同：0
> 
> 时间：2008-09-19T18:29:50.147
> 
> 标签：urlscan

我在 Win2003 服务器上安装了 uriscan，它阻止了旧的 ColdFusion 脚本。日志条目具有以下内容 -

2008-09-19 00:16:57 66.82.162.13 1416208729 GET /Admin/Uploads/Mountain/Wolf%2520Creek%2520gazeebo.jpg 拒绝 URL+is+double+转义 URL - -

如何在不关闭双转义 url 功能的情况下让 uriscan 允许这样的提交？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-20T22:10:18.003

引用关于该主题的另一篇文章，

> 您提交 URI 过程的某些方面正在执行一些错误的编码。
> 
> [http://www.usenet-forums.com/archive/index.php/t-39111.html](http://www.usenet-forums.com/archive/index.php/t-39111.html)

我建议将 JPG 的名称更改为不包含空格作为一种好习惯，然后尝试使用非生产页面找出为什么您不将 %20 解释为编码空格，而是将其解释为百分号和两位数。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-20T22:41:08.053

> 如何在不关闭双转义 url 功能的情况下让 uriscan 允许这样的提交？

如何在不关闭双转义 url 功能的情况下允许双转义 URL？我认为你正在尝试做的事情有问题。我的问题是：您的 HTML 源代码是否从字面上显示带有“%2520”的图像请求？这是您文件的正确名称吗？如果是这样，您实际上只有两个选择：重命名文件或关闭不允许双重转义的功能。

# user-interface - 任何元数据驱动的 UI 示例代码？

> ID：104348
> 
> 赞同：2
> 
> 时间：2008-09-19T18:31:17.570
> 
> 标签：user-interface, metadata

我正在设计一个使用元数据来驱动 UI 的 .net windows 窗体应用程序。除了找到[http://msdn.microsoft.com/en-us/library/ms954610.aspx](http://msdn.microsoft.com/en-us/library/ms954610.aspx)之外，我没有什么可期待的。这里有人从事元数据驱动的用户界面工作吗？遵循这种方法的含义是什么，任何指示都会非常有帮助。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-19T18:41:19.760

最明显的答案是微软自己通过在[Windows Presentation Foundation](http://en.wikipedia.org/wiki/Windows_Presentation_Foundation)中使用 Xaml 来接受这个概念，它在一定程度上取代了 WinForms。

如果您想坚持使用 WinForms，您可能需要考虑[MyXaml](http://www.myxaml.com/)，它是对 Xaml for WinForms 的一种致敬！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-24T12:23:32.747

您可能想查看 Evolutility CRUD 框架。它是一个开源元数据驱动框架，用于在运行时生成所有 UI 的 CRUD。

它带有源代码（在 C# 和 JS 中）和许多示例。

[http://www.evolutility.org](http://www.evolutility.org)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-24T12:46:49.183

你可以用 HTA 试试这个。前一段时间，我使用 HTA 和 XML 创建了一个元数据驱动的应用程序。我创建了类似 XAML 的结构和 HTA-VBScript 代码来解析此结构并呈现不同类型的 UI 元素以及验证。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-24T13:05:49.307

检查[Andromeda 项目](http://www.andromeda-project.org/)，该项目做得如此广泛。太糟糕了，堆栈对 .NET 不友好（PHP、Postgres、Perl）。

# linux - 为什么我的包不能用 yum 升级？

> ID：104363
> 
> 赞同：4
> 
> 时间：2008-09-19T18:34:31.260
> 
> 标签：linux, fedora, yum

我正在尝试在 Fedora 8 上使用 yum 升级软件包。该软件包是`elfutils`. 这是我在本地安装的：

```
$ yum info elfutils
Installed Packages
Name   : elfutils
Arch   : x86_64
Version: 0.130
Release: 3.fc8
Size   : 436 k
Repo   : installed
Summary: A collection of utilities and DSOs to handle compiled objects 
```

这个版本有一个 bug，根据[bug 报告](https://bugzilla.redhat.com/show_bug.cgi?id=377241)，一个更新的版本已经被推送到 Fedora 8 稳定库。但是，如果我尝试更新：

```
$ yum update elfutils
Setting up Update Process
Could not find update match for elfutils
No Packages marked for Update 
```

这是我的存储库：

```
$ yum repolist enabled
repo id              repo name                                 status
InstallMedia         Fedora 8                                  enabled
fedora               Fedora 8 - x86_64                         enabled
updates              Fedora 8 - x86_64 - Updates               enabled 
```

我错过了什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-19T19:26:56.530

好的，我想通了。我需要升级`fedora-release`软件包。这让我可以看到所有更新的包。感谢 ethyreal 将我指向 Yum 升级常见问题解答。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-19T18:49:54.717

我知道这看起来很傻，但是您是否尝试将其删除并重新安装？

```
yum remove elfutils 
```

然后

```
yum install elfutils 
```

或者，您可以尝试更新所有内容：

```
yum update 
```

...如果他们没有在存储库中标记更新，您可以尝试：

```
yum upgrade 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-19T19:13:06.860

如果您查看存储库包目录的列表

[链接到 Fedora 存储库](http://download.fedora.redhat.com/pub/fedora/linux/releases/8/Everything/x86_64/os/Packages/%22Fedora%20x86_64%20Repository)

您将看到该目录中有最新版本，这就是 yum 不升级您的软件包的原因。这在 i386 和 x86_64 包目录中是相同的。因此，您没有看到更新的原因是存储库中还没有更新的版本。错误报告中关于存储库中有新版本的通知不正确。

# java - Mac OS X Java Swing 按钮无故被禁用

> ID：104373
> 
> 赞同：-1
> 
> 时间：2008-09-19T18:35:41.740
> 
> 标签：java, macos, swing, button

我用 Java 编写了一个应用程序，当它在运行 OS X 的一位客户的计算机上运行时，保存和导出按钮被禁用。（其他一切都在应用程序中工作。）

这两个按钮都会打开一个标准的保存文件对话框。

有任何想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-19T19:07:04.567

这些按钮打开文件对话框的事实可能与它被禁用无关。由于多种原因，按钮最终可能会被禁用，

*   它`setEnabled`可以用`false`,
*   使用动作时，`setEnabled`可以使用`false`, 和
*   当使用一个动作时，它可以有一个“启用”的属性，它可能会禁用它；有关更多信息，请参阅[操作](http://java.sun.com/javase/6/docs/api/javax/swing/Action.html)，那里有一个属性列表。

你能发布你是如何“实现JButtons”的吗？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-19T19:36:12.110

暗中尝试，但大多数 Mac 仍在运行 Java 1.5；检查您当前的代码是否与您的 Java 1.5 不符。也许这就是你的问题所在。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-17T17:17:04.493

这是由于从客户那里收到的错误信息造成的。

事实证明，客户试图将文件保存到无法在他/她的硬盘上保存文件的位置。

# database - 重构过时数据库模式的技巧

> ID：104380
> 
> 赞同：14
> 
> 时间：2008-09-19T18:36:14.390
> 
> 标签：database, refactoring, schema

受困于不再反映您的数据模型的遗留数据库模式是每个开发人员的噩梦。然而，在所有关于重构代码以实现可维护性的讨论中，我并没有听到太多关于重构过时的数据库模式的消息。

关于如何在不破坏所有依赖于旧模式的代码的情况下过渡到更好的模式的技巧有哪些？我将提出一个特定的问题，我必须说明我的观点，但请随时就已证明有用的其他技术提供建议——这些技术也可能会派上用场。

* * *

我的例子：

我公司接收和运送产品。现在产品收据和产品发货有一些非常不同的数据与之关联，因此最初的数据库设计者为收据和发货创建了一个单独的表。

在我使用这个系统的一年中，我意识到当前的模式没有一点意义。毕竟收据和发货基本上都是一种交易，它们都涉及更改产品的数量，本质上只是+/-符号不同。事实上，我们经常需要找出产品在一段时间内的变化总量，而这个设计对于这个问题是非常棘手的。

显然，适当的设计是有一个单一的 Transactions 表，其中 Id 是 ReceiptInfo 或 ShipmentInfo 表的外键。不幸的是，错误的模式已经投入生产多年，并且有数百个存储过程和数千行代码。那么我怎样才能将架构转换为正常工作呢？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-19T18:42:46.153

这是数据库重构的完整目录：

[http://databaserefactoring.com/](http://databaserefactoring.com/)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-19T18:43:19.177

这是一件很难解决的事情。重构数据库后的几个快速选项是：

*   创建与原始模式匹配但从新模式中提取的视图；您可能需要在此处使用触发器，以便可以处理对视图的任何更新。*   创建新模式并在每一侧放置触发器以维护另一侧。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-19T18:44:37.910

[这本书（重构数据库）](https://rads.stackoverflow.com/amzn/click/com/0321293533)在处理遗留数据库模式时是上帝送给我的，包括当我不得不为我们的库存数据库处理几乎完全相同的问题时。

此外，拥有一个系统来跟踪对数据库模式的更改（例如存储在源代码控制存储库中的一系列更改脚本）有助于找出代码到数据库的依赖关系。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-19T18:44:08.270

存储过程和视图在这里是你的朋友。即使系统不使用它们，也改变它以使用它们，然后重构下面的数据库。

然后，您的收据和发货将成为视图。

请注意，在我使用过的大多数系统中，收据和发货实际上是两种截然不同的野兽。收据与供应商相关联，而发货与客户（或客户/收货地点）相关联。在库存级别，它们通常表示相同。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-19T18:40:43.803

所有数据访问都仅限于存储过程吗？如果没有，这项任务几乎是不可能的。如果是这样，您只需要确保您的数据迁移脚本在从旧模式过渡到新模式时运行良好，然后确保您的存储过程尊重他们的输入和输出。

希望他们都没有“选择*”查询。如果是这样，请使用“sp_help tablename”获取完整的列列表，将其复制出来并将每个 * 替换为完整的列列表，以确保您不会破坏客户端代码。

我建议逐步进行更改，并进行大量集成测试。如果不引入一些错误，就很难进行重大改造。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-19T18:41:26.000

首先是创建表模式。我已经使用 Enterprise Architect 为 Legacy 数据库做到了这一点。您可以选择数据库，它会为您创建每个表/字段。然后，您需要将所有内容分类。以您所有的收货和发货产品为例，其他类别的客户资料。一切就绪后，您将能够通过创建新表、新关系和新字段来重构字段。当然，如果在没有存储过程的情况下访问所有内容，这将需要进行大量更改。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-19T18:44:51.217

我认为事务表的 id 应该是 ReceiptInfo 或 ShipmentInfo 的外键并不明显。反过来想。在面向对象的模型中，您应该有一个事务表，并且 ReceiptInfo 或 ShipmentInfo 应该具有该事务表的外键。如果幸运的话，代码中只有 1 或 2 个点会在 ReceiptInfo 或 ShipmentInfo 中生成新记录。您应该在此处添加代码，在 Transaction 表中添加条目，然后在 ReceiptInfo 或 ShipmentInfo 中使用 Transaction 的外键创建条目。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-19T18:47:52.520

Sometimes you can create new tables that have better structures and then create views with the names of your old tables but are based on the data in the new tables. That way, you code doesnt break while you start to move to a better structure. Be careful with thsi though as sometimes you move from a non-relational table to a relational structure where you have multiple records while the code will be expecting only one. This is particulalry true if you have developers who use subqueries.

Then as each thing is changed, it will move away from the views to the real table. Eventually you can drop the views. This at least allows you to work incrementally to keep things working as you move stuff, but start to fix things to use a better design.

# vb6 - 访问“项目”>“参考”窗口时出错？

> ID：104383
> 
> 赞同：13
> 
> 时间：2008-09-19T18:36:22.737
> 
> 标签：vb6, registry, regtlib

在 Visual Basic 6 中，当我尝试访问*Project > References*时，它会引发错误：

> 访问系统注册表时出错

我是：

*   以本地计算机管理员身份登录
*   运行 Windows XP Professional 和
*   我可以`regedt32.exe`很好地执行和访问所有注册表项。

VB6 以本地管理员身份安装。

知道为什么会这样吗？

* * *

我正在运行水晶报告 8.5，它应该已经解决了这个问题，但显然我仍然遇到安装 8.5 的问题。我还尝试重新安装水晶报告，但在这个问题上没有运气。

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-11-12T18:36:43.780

根据您拥有的 Windows 操作系统（我有 Windows 7 企业版），您可能想尝试为 REGTLIB.EXE（位于 C:\Windws）授予管理员权限。右键单击 REGTLIB.EXE 文件。从弹出菜单中选择属性。然后选择兼容性选项卡。在兼容性选项卡上，选中/选中以管理员身份运行此程序复选框。单击确定以保存您的更改。它可能会为您解决问题。它对我有用。祝你好运。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2016-10-29T15:51:44.500

对我来说，这很有效：

1.  转到 C:\Program Files\Microsoft Visual Studio\VB98
2.  通过右键单击更改VB6.EXE的属性->兼容性在权限级别部分，选中以管理员身份运行此程序选项

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-12-10T21:46:11.840

如果您运行的是 Office 2010（测试版），Word（显然）会写入一个受限的注册表项。VB 在扫描注册表时抛出错误。我的关键是：

`HKCR\TypeLib\{00020905-0000-0000-C000-000000000046}\8.5`

对于 Regmon - 过滤进程名称 -> "vb6.exe" 和结果 -> `ACCESS DENIED`。帮助很快找到它。

使用 PSToosl (PSEXEC) 修复它以运行注册表编辑器。命令行是，

`psexec -i -d -s c:\windows\regedit.exe`

`psexec`需要以提升的权限运行。

* * *

Jim 编辑：我在 Windows 7 (x64) 机器上。提升权限需要 PSTools 解决方案。XP可以少一点。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-21T02:50:38.577

我在用于 VB6 开发的机器上得到了这个。我一直在从 VB6 构建大量 COM DLL（没有二进制兼容性），而在注册表中建立的杂乱无章最终变得太多了。

查看注册表的大小以及您设置的限制。我将注册表大小翻了一番，然后去寻找一个好的注册表胡佛。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-19T22:05:35.103

您可以尝试[Process Monitor](http://technet.microsoft.com/en-us/sysinternals/bb896645.aspx)以查看访问了哪些注册表项。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-12-11T20:18:45.223

这是微软的解决方案。它引用了 Crystal Reports 问题，但该解决方案仅使用 regedit32 遍历**HKEY_CLASSES_ROOT\TypeLib**和**HKEY_CLASSES_ROOT\CLSID**注册表分支以获取暗键并更正这些键的安全性。如果 regedit32 无法访问密钥，也有修复安全性的说明。[文章编号：269383](http://support.microsoft.com/default.aspx?scid=http%3A%2F%2Fsupport.microsoft.com%2Fsupport%2Fkb%2Farticles%2FQ269%2F3%2F83.ASP&NoWebContent=1)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2015-08-19T14:14:22.923

在 Windows 7 中，转到开始菜单，然后右键单击“Microsoft Visual Basic 6”，然后选择属性并从出现的对话框中单击兼容性，然后勾选“以管理员身份运行此程序”。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2013-12-27T22:07:41.517

这是VB6安装问题。尝试在您的系统上重新安装 VB6。否则，使用“以管理员身份运行”打开“visual studio 6.0”。然后通过 - 新项目 -> 现有选项卡打开/浏览您的项目 .vbp 文件。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-19T18:43:28.570

你试过[这个吗？](http://www.tek-tips.com/viewthread.cfm?qid=729496&page=6) 基本上，这似乎是一个水晶报告问题。希望有帮助。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2012-10-17T20:15:18.100

也许值得一试“用户帐户控制设置”。问候，

![在此处输入图像描述](../Images/6d043fa783408c013cc637b09af76d06.png)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2013-06-13T17:58:05.130

当我在 Win7-64 上安装 VB6（使用搜索引擎很容易找到的说明）时，它运行良好。UAC 已关闭——即设置为“从不通知”。

几周后，我打开了 UAC——即将它设置为默认值。由于“访问系统注册表时出错”问题，VB6 无法编译。不幸的是，再次关闭它并没有帮助。显然，打开它所造成的损害是不可逆转的。我无法解释为什么会这样，但这是我的经验。

在关闭 UAC 的同时授予 REGTLIB.EXE 管理权限听起来是个好主意，但这对我也不起作用。

最后，使用此处其他帖子中描述的 Process Monitor 和 PsTools 有效。但是，我不得不将大部分注册表的完全控制权交给所有人。这不仅仅适用于隔离键。看来编译器需要为主要节点添加键，所以我不得不打开这些整个节点。

除了完成这些步骤需要花费数小时这一事实之外，我现在比尝试通过 UAC 提高安全性之前暴露的要多得多，但是，我需要 VB6，并且没有看到没有新计算机的其他解决方案。

教训：不要将 UAC 与 VB6 一起使用。除非你已经到达这里，否则为时已​​晚。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2018-01-08T17:49:46.837

我已经解决了这个问题。但是上面的建议都没有奏效。我所做的是让每个人都完全控制`SYSTEM`注册表中的密钥。这会造成安全漏洞。我正在运行带有 vb6 服务包 6B 的 64 位 Windows 7。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2018-02-24T22:14:29.363

我正在运行 64 位 Windows 10 Pro（10.0.16299 Build 16299）。尝试编译 VB6 DLL 时出现此错误。

我在这篇文章中看到了几个关于以管理员身份在兼容模式下运行的答案。我想我会首先尝试在**Windows XP (sp2) 的兼容模式下**运行。选中该框后，我能够编译我的 DLL。我**不需要**以管理员身份运行。

# html - 有关如何使用边距的信息

> ID：104395
> 
> 赞同：2
> 
> 时间：2008-09-19T18:38:00.890
> 
> 标签：html, css, layout, padding, margins

我需要一些关于如何使用边距以及*填充*如何工作的信息。

例如：我应该放一条线来占据页面的整个宽度（无论使用什么分辨率来显示网页），让每边只有一个小边框，我怎么能做到这一点？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-19T18:38:32.933

看看这个：[http ://redmelon.net/tstme/box_model/](http://redmelon.net/tstme/box_model/)

基本上，一个元素由内容组成，被它的内边距包围，然后是边框，然后是外边距。背景图像仅延伸至边界。最好将边距描述为“此元素周围的空白”。

但是看看上面的 URL，让自己成为一个可以玩的测试页面，这一切都应该是有意义的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-19T18:56:52.780

我认为这应该做你想要的：

```
<table width="100%" cellpadding="5">
  <tr>
    <td>
One, two, three ... One, two, three ... One, two, three ... One, two, three ... One, two, three ... One, two, three ... One, two, three ... One, two, three ... One, two, three ... 
    </td>
  </tr>
</table> 
```

将宽度设置为“100%”会强制文本使用全宽，将单元格填充设置为“5”会设置 5 个像素的不可见边框。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-22T05:15:13.683

另一种说明它的方法是在盒子模型中，填充是盒子的内部“边距”，边距是盒子周围的缓冲区。

# python - 如何生成列表的所有排列？

> ID：104420
> 
> 赞同：756
> 
> 时间：2008-09-19T18:41:03.397
> 
> 标签：python, algorithm, permutation, combinatorics, python-2.5

如何在 Python 中生成列表的所有排列，而与列表中元素的类型无关？

例如：

```
permutations([])
[]

permutations([1])
[1]

permutations([1, 2])
[1, 2]
[2, 1]

permutations([1, 2, 3])
[1, 2, 3]
[1, 3, 2]
[2, 1, 3]
[2, 3, 1]
[3, 1, 2]
[3, 2, 1] 
```

* * *

## 回答 #1

> 赞同：675
> 
> 时间：2008-09-19T18:43:09.380

**标准库**中有一个功能：[`itertools.permutations`](https://docs.python.org/3/library/itertools.html#itertools.permutations).

```
import itertools
list(itertools.permutations([1, 2, 3])) 
```

如果出于某种原因您想自己实现它或者只是想知道它是如何工作的，这里有一个不错的方法，取自 [http://code.activestate.com/recipes/252178/](http://code.activestate.com/recipes/252178/)：

```
def all_perms(elements):
    if len(elements) <=1:
        yield elements
    else:
        for perm in all_perms(elements[1:]):
            for i in range(len(elements)):
                # nb elements[0:1] works in both string and list contexts
                yield perm[:i] + elements[0:1] + perm[i:] 
```

的文档中列出了几种替代方法`itertools.permutations`。这是一个：

```
def permutations(iterable, r=None):
    # permutations('ABCD', 2) --> AB AC AD BA BC BD CA CB CD DA DB DC
    # permutations(range(3)) --> 012 021 102 120 201 210
    pool = tuple(iterable)
    n = len(pool)
    r = n if r is None else r
    if r > n:
        return
    indices = range(n)
    cycles = range(n, n-r, -1)
    yield tuple(pool[i] for i in indices[:r])
    while n:
        for i in reversed(range(r)):
            cycles[i] -= 1
            if cycles[i] == 0:
                indices[i:] = indices[i+1:] + indices[i:i+1]
                cycles[i] = n - i
            else:
                j = cycles[i]
                indices[i], indices[-j] = indices[-j], indices[i]
                yield tuple(pool[i] for i in indices[:r])
                break
        else:
            return 
```

另一个，基于`itertools.product`：

```
def permutations(iterable, r=None):
    pool = tuple(iterable)
    n = len(pool)
    r = n if r is None else r
    for indices in product(range(n), repeat=r):
        if len(set(indices)) == r:
            yield tuple(pool[i] for i in indices) 
```

* * *

## 回答 #2

> 赞同：353
> 
> 时间：2008-09-19T18:48:48.043

在[Python 2.6](http://docs.python.org/dev/whatsnew/2.6.html)及以后版本中：

```
import itertools
itertools.permutations([1,2,3]) 
```

（作为生成器返回。用于`list(permutations(l))`作为列表返回。）

* * *

## 回答 #3

> 赞同：321
> 
> 时间：2008-10-04T12:18:56.230

*以下代码仅适用于 Python 2.6 及更高版本*

首先，导入`itertools`：

```
import itertools 
```

### 排列（顺序很重要）：

```
print list(itertools.permutations([1,2,3,4], 2))
[(1, 2), (1, 3), (1, 4),
(2, 1), (2, 3), (2, 4),
(3, 1), (3, 2), (3, 4),
(4, 1), (4, 2), (4, 3)] 
```

### 组合（顺序无关紧要）：

```
print list(itertools.combinations('123', 2))
[('1', '2'), ('1', '3'), ('2', '3')] 
```

### 笛卡尔积（有几个迭代）：

```
print list(itertools.product([1,2,3], [4,5,6]))
[(1, 4), (1, 5), (1, 6),
(2, 4), (2, 5), (2, 6),
(3, 4), (3, 5), (3, 6)] 
```

### 笛卡尔积（具有一个可迭代和自身）：

```
print list(itertools.product([1,2], repeat=3))
[(1, 1, 1), (1, 1, 2), (1, 2, 1), (1, 2, 2),
(2, 1, 1), (2, 1, 2), (2, 2, 1), (2, 2, 2)] 
```

* * *

## 回答 #4

> 赞同：57
> 
> 时间：2011-10-12T00:14:09.050

```
def permutations(head, tail=''):
    if len(head) == 0:
        print(tail)
    else:
        for i in range(len(head)):
            permutations(head[:i] + head[i+1:], tail + head[i]) 
```

称为：

```
permutations('abc') 
```

* * *

## 回答 #5

> 赞同：37
> 
> 时间：2012-08-14T23:58:40.090

```
#!/usr/bin/env python

def perm(a, k=0):
   if k == len(a):
      print a
   else:
      for i in xrange(k, len(a)):
         a[k], a[i] = a[i] ,a[k]
         perm(a, k+1)
         a[k], a[i] = a[i], a[k]

perm([1,2,3]) 
```

输出：

```
[1, 2, 3]
[1, 3, 2]
[2, 1, 3]
[2, 3, 1]
[3, 2, 1]
[3, 1, 2] 
```

当我交换列表的内容时，它需要一个可变序列类型作为输入。例如`perm(list("ball"))`，将工作，`perm("ball")`不会因为你不能改变一个字符串。

这个 Python 实现的灵感来自*Horowitz、Sahni 和 Rajasekeran 的 Computer Algorithms*一书中提出的算法。

* * *

## 回答 #6

> 赞同：24
> 
> 时间：2008-09-19T18:41:52.287

此解决方案实现了一个生成器，以避免将所有排列保存在内存中：

```
def permutations (orig_list):
    if not isinstance(orig_list, list):
        orig_list = list(orig_list)

    yield orig_list

    if len(orig_list) == 1:
        return

    for n in sorted(orig_list):
        new_list = orig_list[:]
        pos = new_list.index(n)
        del(new_list[pos])
        new_list.insert(0, n)
        for resto in permutations(new_list[1:]):
            if new_list[:1] + resto <> orig_list:
                yield new_list[:1] + resto 
```

* * *

## 回答 #7

> 赞同：19
> 
> 时间：2013-06-30T15:17:16.677

实用风格

```
def addperm(x,l):
    return [ l[0:i] + [x] + l[i:]  for i in range(len(l)+1) ]

def perm(l):
    if len(l) == 0:
        return [[]]
    return [x for y in perm(l[1:]) for x in addperm(l[0],y) ]

print perm([ i for i in range(3)]) 
```

结果：

```
[[0, 1, 2], [1, 0, 2], [1, 2, 0], [0, 2, 1], [2, 0, 1], [2, 1, 0]] 
```

* * *

## 回答 #8

> 赞同：17
> 
> 时间：2008-09-20T16:32:47.673

以下代码是给定列表的就地排列，实现为生成器。由于它只返回对列表的引用，因此不应在生成器之外修改列表。该解决方案是非递归的，因此使用低内存。也适用于输入列表中的多个元素副本。

```
def permute_in_place(a):
    a.sort()
    yield list(a)

    if len(a) <= 1:
        return

    first = 0
    last = len(a)
    while 1:
        i = last - 1

        while 1:
            i = i - 1
            if a[i] < a[i+1]:
                j = last - 1
                while not (a[i] < a[j]):
                    j = j - 1
                a[i], a[j] = a[j], a[i] # swap the values
                r = a[i+1:last]
                r.reverse()
                a[i+1:last] = r
                yield list(a)
                break
            if i == first:
                a.reverse()
                return

if __name__ == '__main__':
    for n in range(5):
        for a in permute_in_place(range(1, n+1)):
            print a
        print

    for a in permute_in_place([0, 0, 1, 1, 1]):
        print a
    print 
```

* * *

## 回答 #9

> 赞同：17
> 
> 时间：2011-03-31T13:58:40.663

在我看来，一个非常明显的方式也可能是：

```
def permutList(l):
    if not l:
            return [[]]
    res = []
    for e in l:
            temp = l[:]
            temp.remove(e)
            res.extend([[e] + r for r in permutList(temp)])

    return res 
```

* * *

## 回答 #10

> 赞同：12
> 
> 时间：2011-08-21T18:28:44.337

```
list2Perm = [1, 2.0, 'three']
listPerm = [[a, b, c]
            for a in list2Perm
            for b in list2Perm
            for c in list2Perm
            if ( a != b and b != c and a != c )
            ]
print listPerm 
```

输出：

```
[
    [1, 2.0, 'three'], 
    [1, 'three', 2.0], 
    [2.0, 1, 'three'], 
    [2.0, 'three', 1], 
    ['three', 1, 2.0], 
    ['three', 2.0, 1]
] 
```

* * *

## 回答 #11

> 赞同：11
> 
> 时间：2013-08-08T20:23:50.817

我使用了基于[阶乘数系统](http://en.wikipedia.org/wiki/Factorial_number_system)的算法- 对于长度为 n 的列表，您可以逐项组装每个排列，从每个阶段留下的项目中进行选择。第一项有 n 个选项，第二项有 n-1 个选项，最后一项只有一个选项，因此您可以使用阶乘数字系统中的数字的数字作为索引。这样，数字 0 到 n!-1 对应于字典顺序中的所有可能排列。

```
from math import factorial
def permutations(l):
    permutations=[]
    length=len(l)
    for x in xrange(factorial(length)):
        available=list(l)
        newPermutation=[]
        for radix in xrange(length, 0, -1):
            placeValue=factorial(radix-1)
            index=x/placeValue
            newPermutation.append(available.pop(index))
            x-=index*placeValue
        permutations.append(newPermutation)
    return permutations

permutations(range(3)) 
```

输出：

```
[[0, 1, 2], [0, 2, 1], [1, 0, 2], [1, 2, 0], [2, 0, 1], [2, 1, 0]] 
```

此方法是非递归的，但在我的计算机上速度稍慢，并且 xrange 在 n! 时会引发错误！太大而无法转换为 C 长整数（对我来说 n=13）。当我需要它时就足够了，但它远非 itertools.permutations。

* * *

## 回答 #12

> 赞同：11
> 
> 时间：2020-01-04T18:50:09.307

常规实施（无产量 - 将在内存中完成所有操作）：

```
def getPermutations(array):
    if len(array) == 1:
        return [array]
    permutations = []
    for i in range(len(array)): 
        # get all perm's of subarray w/o current item
        perms = getPermutations(array[:i] + array[i+1:])  
        for p in perms:
            permutations.append([array[i], *p])
    return permutations 
```

产量实施：

```
def getPermutations(array):
    if len(array) == 1:
        yield array
    else:
        for i in range(len(array)):
            perms = getPermutations(array[:i] + array[i+1:])
            for p in perms:
                yield [array[i], *p] 
```

基本思想是在第一个位置遍历数组中的所有元素，然后在第二个位置遍历所有其余元素，而不是在第一个位置选择元素，等等。您可以使用**recursion**来做到这一点，其中停止条件正在获取 1 个元素的数组 - 在这种情况下，您返回该数组。

[![在此处输入图像描述](../Images/4f651958be8a0d739d15e611fcac5244.png)](https://i.stack.imgur.com/eX3df.jpg)

* * *

## 回答 #13

> 赞同：10
> 
> 时间：2013-01-23T00:01:57.797

注意这个算法有`n factorial`时间复杂度，`n`输入列表的长度

打印运行结果：

```
global result
result = [] 

def permutation(li):
if li == [] or li == None:
    return

if len(li) == 1:
    result.append(li[0])
    print result
    result.pop()
    return

for i in range(0,len(li)):
    result.append(li[i])
    permutation(li[:i] + li[i+1:])
    result.pop() 
```

例子：

```
permutation([1,2,3]) 
```

输出：

```
[1, 2, 3]
[1, 3, 2]
[2, 1, 3]
[2, 3, 1]
[3, 1, 2]
[3, 2, 1] 
```

* * *

## 回答 #14

> 赞同：8
> 
> 时间：2012-05-29T13:08:55.587

确实可以迭代每个排列的第一个元素，如 tzwenn 的回答。然而，以这种方式编写此解决方案更有效：

```
def all_perms(elements):
    if len(elements) <= 1:
        yield elements  # Only permutation possible = no permutation
    else:
        # Iteration over the first element in the result permutation:
        for (index, first_elmt) in enumerate(elements):
            other_elmts = elements[:index]+elements[index+1:]
            for permutation in all_perms(other_elmts): 
                yield [first_elmt] + permutation 
```

这个解决方案快了大约 30%，显然是由于递归结束于`len(elements) <= 1`而不是`0`. 它的内存效率也更高，因为它使用生成器函数（通过`yield`），就像在 Riccardo Reyes 的解决方案中一样。

* * *

## 回答 #15

> 赞同：7
> 
> 时间：2013-11-16T04:10:33.230

这是受到使用列表理解的 Haskell 实现的启发：

```
def permutation(list):
    if len(list) == 0:
        return [[]]
    else:
        return [[x] + ys for x in list for ys in permutation(delete(list, x))]

def delete(list, item):
    lc = list[:]
    lc.remove(item)
    return lc 
```

* * *

## 回答 #16

> 赞同：6
> 
> 时间：2015-05-24T21:56:08.463

为了提高性能，受[Knuth](http://www.kcats.org/csci/464/doc/knuth/fascicles/fasc2b.pdf) (p22) 启发的 numpy 解决方案：

```
from numpy import empty, uint8
from math import factorial

def perms(n):
    f = 1
    p = empty((2*n-1, factorial(n)), uint8)
    for i in range(n):
        p[i, :f] = i
        p[i+1:2*i+1, :f] = p[:i, :f]  # constitution de blocs
        for j in range(i):
            p[:i+1, f*(j+1):f*(j+2)] = p[j+1:j+i+2, :f]  # copie de blocs
        f = f*(i+1)
    return p[:n, :] 
```

复制大块内存可以节省时间 - 它比以下方法快 20 倍`list(itertools.permutations(range(n))`：

```
In [1]: %timeit -n10 list(permutations(range(10)))
10 loops, best of 3: 815 ms per loop

In [2]: %timeit -n100 perms(10) 
100 loops, best of 3: 40 ms per loop 
```

* * *

## 回答 #17

> 赞同：5
> 
> 时间：2019-12-21T05:52:51.997

免责声明：包作者的无形插件。:)

[trotter](https://pypi.org/project/trotter/)包与大多数实现不同，它生成的伪列表实际上并不包含排列，而是描述排列和排序中各个位置之间的映射，从而可以处理非常大的排列“列表”，如图所示在[这个演示](https://permutation-products.netlify.com/)中，它在一个“包含”字母表中所有字母排列的伪列表中执行相当即时的操作和查找，而不使用比典型网页更多的内存或处理。

无论如何，要生成排列列表，我们可以执行以下操作。

```
import trotter

my_permutations = trotter.Permutations(3, [1, 2, 3])

print(my_permutations)

for p in my_permutations:
    print(p) 
```

输出：

```
包含 [1, 2, 3] 的 6 个 3 排列的伪列表。
[1、2、3]
[1, 3, 2]
[3, 1, 2]
[3, 2, 1]
[2, 3, 1]
[2, 1, 3]

```

* * *

## 回答 #18

> 赞同：5
> 
> 时间：2021-08-09T12:39:19.233

如果您不想使用内置方法，例如：

```
import itertools
list(itertools.permutations([1, 2, 3])) 
```

你可以自己实现置换功能

```
from collections.abc import Iterable

def permute(iterable: Iterable[str]) -> set[str]:
    perms = set()

    if len(iterable) == 1:
        return {*iterable}

    for index, char in enumerate(iterable):
        perms.update([char + perm for perm in permute(iterable[:index] + iterable[index + 1:])])

    return perms

if __name__ == '__main__':
    print(permute('abc'))
    # {'bca', 'abc', 'cab', 'acb', 'cba', 'bac'}
    print(permute(['1', '2', '3']))
    # {'123', '312', '132', '321', '213', '231'} 
```

* * *

## 回答 #19

> 赞同：4
> 
> 时间：2019-03-29T15:49:58.237

**另一种方法（没有库）**

```
def permutation(input):
    if len(input) == 1:
        return input if isinstance(input, list) else [input]

    result = []
    for i in range(len(input)):
        first = input[i]
        rest = input[:i] + input[i + 1:]
        rest_permutation = permutation(rest)
        for p in rest_permutation:
            result.append(first + p)
    return result 
```

**输入可以是字符串或列表**

```
print(permutation('abcd'))
print(permutation(['a', 'b', 'c', 'd'])) 
```

* * *

## 回答 #20

> 赞同：3
> 
> 时间：2013-05-08T16:48:44.497

```
from __future__ import print_function

def perm(n):
    p = []
    for i in range(0,n+1):
        p.append(i)
    while True:
        for i in range(1,n+1):
            print(p[i], end=' ')
        print("")
        i = n - 1
        found = 0
        while (not found and i>0):
            if p[i]<p[i+1]:
                found = 1
            else:
                i = i - 1
        k = n
        while p[i]>p[k]:
            k = k - 1
        aux = p[i]
        p[i] = p[k]
        p[k] = aux
        for j in range(1,(n-i)/2+1):
            aux = p[i+j]
            p[i+j] = p[n-j+1]
            p[n-j+1] = aux
        if not found:
            break

perm(5) 
```

* * *

## 回答 #21

> 赞同：3
> 
> 时间：2013-07-06T14:56:16.263

这是一种适用于列表的算法，无需创建类似于 Ber 在[https://stackoverflow.com/a/108651/184528](https://stackoverflow.com/a/108651/184528)的解决方案的新中间列表。

```
def permute(xs, low=0):
    if low + 1 >= len(xs):
        yield xs
    else:
        for p in permute(xs, low + 1):
            yield p        
        for i in range(low + 1, len(xs)):        
            xs[low], xs[i] = xs[i], xs[low]
            for p in permute(xs, low + 1):
                yield p        
            xs[low], xs[i] = xs[i], xs[low]

for p in permute([1, 2, 3, 4]):
    print p 
```

您可以在这里自己尝试代码：[http ://repl.it/J9v](http://repl.it/J9v)

* * *

## 回答 #22

> 赞同：3
> 
> 时间：2014-05-19T08:23:12.023

递归之美：

```
>>> import copy
>>> def perm(prefix,rest):
...      for e in rest:
...              new_rest=copy.copy(rest)
...              new_prefix=copy.copy(prefix)
...              new_prefix.append(e)
...              new_rest.remove(e)
...              if len(new_rest) == 0:
...                      print new_prefix + new_rest
...                      continue
...              perm(new_prefix,new_rest)
... 
>>> perm([],['a','b','c','d'])
['a', 'b', 'c', 'd']
['a', 'b', 'd', 'c']
['a', 'c', 'b', 'd']
['a', 'c', 'd', 'b']
['a', 'd', 'b', 'c']
['a', 'd', 'c', 'b']
['b', 'a', 'c', 'd']
['b', 'a', 'd', 'c']
['b', 'c', 'a', 'd']
['b', 'c', 'd', 'a']
['b', 'd', 'a', 'c']
['b', 'd', 'c', 'a']
['c', 'a', 'b', 'd']
['c', 'a', 'd', 'b']
['c', 'b', 'a', 'd']
['c', 'b', 'd', 'a']
['c', 'd', 'a', 'b']
['c', 'd', 'b', 'a']
['d', 'a', 'b', 'c']
['d', 'a', 'c', 'b']
['d', 'b', 'a', 'c']
['d', 'b', 'c', 'a']
['d', 'c', 'a', 'b']
['d', 'c', 'b', 'a'] 
```

* * *

## 回答 #23

> 赞同：3
> 
> 时间：2015-01-31T20:46:34.703

该算法是最有效的算法，它避免了递归调用中的数组传递和操作，适用于 Python 2、3：

```
def permute(items):
    length = len(items)
    def inner(ix=[]):
        do_yield = len(ix) == length - 1
        for i in range(0, length):
            if i in ix: #avoid duplicates
                continue
            if do_yield:
                yield tuple([items[y] for y in ix + [i]])
            else:
                for p in inner(ix + [i]):
                    yield p
    return inner() 
```

用法：

```
for p in permute((1,2,3)):
    print(p)

(1, 2, 3)
(1, 3, 2)
(2, 1, 3)
(2, 3, 1)
(3, 1, 2)
(3, 2, 1) 
```

* * *

## 回答 #24

> 赞同：3
> 
> 时间：2015-05-07T21:34:35.093

```
def pzip(c, seq):
    result = []
    for item in seq:
        for i in range(len(item)+1):
            result.append(item[i:]+c+item[:i])
    return result

def perm(line):
    seq = [c for c in line]
    if len(seq) <=1 :
        return seq
    else:
        return pzip(seq[0], perm(seq[1:])) 
```

* * *

## 回答 #25

> 赞同：3
> 
> 时间：2016-03-19T13:29:06.237

生成所有可能的排列

我正在使用python3.4：

```
def calcperm(arr, size):
    result = set([()])
    for dummy_idx in range(size):
        temp = set()
        for dummy_lst in result:
            for dummy_outcome in arr:
                if dummy_outcome not in dummy_lst:
                    new_seq = list(dummy_lst)
                    new_seq.append(dummy_outcome)
                    temp.add(tuple(new_seq))
        result = temp
    return result 
```

测试用例：

```
lst = [1, 2, 3, 4]
#lst = ["yellow", "magenta", "white", "blue"]
seq = 2
final = calcperm(lst, seq)
print(len(final))
print(final) 
```

* * *

## 回答 #26

> 赞同：2
> 
> 时间：2016-08-05T15:59:00.350

我看到这些递归函数内部进行了*很多*迭代，而不是*纯粹*的递归......

所以对于那些连一个循环都不能遵守的人来说，这是一个粗略的、完全不必要的完全递归解决方案

```
def all_insert(x, e, i=0):
    return [x[0:i]+[e]+x[i:]] + all_insert(x,e,i+1) if i<len(x)+1 else []

def for_each(X, e):
    return all_insert(X[0], e) + for_each(X[1:],e) if X else []

def permute(x):
    return [x] if len(x) < 2 else for_each( permute(x[1:]) , x[0])

perms = permute([1,2,3]) 
```

* * *

## 回答 #27

> 赞同：2
> 
> 时间：2018-12-14T19:31:08.440

为了节省大家可能的搜索和试验时间，这里是 Python 中的非递归排列解决方案，它也适用于 Numba（从 v.0.41 开始）：

```
@numba.njit()
def permutations(A, k):
    r = [[i for i in range(0)]]
    for i in range(k):
        r = [[a] + b for a in A for b in r if (a in b)==False]
    return r
permutations([1,2,3],3)
[[1, 2, 3], [1, 3, 2], [2, 1, 3], [2, 3, 1], [3, 1, 2], [3, 2, 1]] 
```

给人以关于性能的印象：

```
%timeit permutations(np.arange(5),5)

243 µs ± 11.1 µs per loop (mean ± std. dev. of 7 runs, 1 loop each)
time: 406 ms

%timeit list(itertools.permutations(np.arange(5),5))
15.9 µs ± 8.61 ns per loop (mean ± std. dev. of 7 runs, 100000 loops each)
time: 12.9 s 
```

因此，仅当您必须从 njitted 函数调用它时才使用此版本，否则更喜欢 itertools 实现。

* * *

## 回答 #28

> 赞同：1
> 
> 时间：2017-03-25T15:29:12.800

另一种解决方案：

```
def permutation(flag, k =1 ):
    N = len(flag)
    for i in xrange(0, N):
        if flag[i] != 0:
            continue
        flag[i] = k 
        if k == N:
            print flag
        permutation(flag, k+1)
        flag[i] = 0

permutation([0, 0, 0]) 
```

* * *

## 回答 #29

> 赞同：1
> 
> 时间：2020-07-07T07:38:44.040

无论如何，我们可以使用[sympy](https://docs.sympy.org/latest/)库，还支持多集排列

```
import sympy
from sympy.utilities.iterables import multiset_permutations
t = [1,2,3]
p = list(multiset_permutations(t))
print(p)

# [[1, 2, 3], [1, 3, 2], [2, 1, 3], [2, 3, 1], [3, 1, 2], [3, 2, 1]] 
```

答案受到[Get all permutations of a numpy array 的高度启发](https://stackoverflow.com/questions/41210142/get-all-permutations-of-a-numpy-array/41210450)

* * *

## 回答 #30

> 赞同：1
> 
> 时间：2021-01-02T19:04:41.557

这是在初始排序后生成排列的渐近最优方式 O(n*n!)。

有n！最多排列并且 hasNextPermutation(..) 以 O(n) 时间复杂度运行

3个步骤，

1.  找到最大的 j 使得 a[j] 可以增加
2.  将 a[j] 增加最小可行量
3.  找到扩展新的 a[0..j] 的词汇量最少的方法

```
'''
Lexicographic permutation generation

consider example array state of [1,5,6,4,3,2] for sorted [1,2,3,4,5,6]
after 56432(treat as number) ->nothing larger than 6432(using 6,4,3,2) beginning with 5
so 6 is next larger and 2345(least using numbers other than 6)
so [1, 6,2,3,4,5]
'''
def hasNextPermutation(array, len):
    ' Base Condition '
    if(len ==1):
        return False
    '''
    Set j = last-2 and find first j such that a[j] < a[j+1]
    If no such j(j==-1) then we have visited all permutations
    after this step a[j+1]>=..>=a[len-1] and a[j]<a[j+1]

    a[j]=5 or j=1, 6>5>4>3>2
    '''
    j = len -2
    while (j >= 0 and array[j] >= array[j + 1]):
        j= j-1
    if(j==-1):
        return False
    # print(f"After step 2 for j {j}  {array}")
    '''
    decrease l (from n-1 to j) repeatedly until a[j]<a[l]
    Then swap a[j], a[l]
    a[l] is the smallest element > a[j] that can follow a[l]...a[j-1] in permutation
    before swap we have a[j+1]>=..>=a[l-1]>=a[l]>a[j]>=a[l+1]>=..>=a[len-1]
    after swap -> a[j+1]>=..>=a[l-1]>=a[j]>a[l]>=a[l+1]>=..>=a[len-1]

    a[l]=6 or l=2, j=1 just before swap [1, 5, 6, 4, 3, 2] 
    after swap [1, 6, 5, 4, 3, 2] a[l]=5, a[j]=6
    '''
    l = len -1
    while(array[j] >= array[l]):
        l = l-1
    # print(f"After step 3 for l={l}, j={j} before swap {array}")
    array[j], array[l] = array[l], array[j]
    # print(f"After step 3 for l={l} j={j} after swap {array}")
    '''
    Reverse a[j+1...len-1](both inclusive)

    after reversing [1, 6, 2, 3, 4, 5]
    '''
    array[j+1:len] = reversed(array[j+1:len])
    # print(f"After step 4 reversing {array}")
    return True

array = [1,2,4,4,5]
array.sort()
len = len(array)
count =1
print(array)
'''
The algorithm visits every permutation in lexicographic order
generating one by one
'''
while(hasNextPermutation(array, len)):
    print(array)
    count = count +1
# The number of permutations will be n! if no duplicates are present, else less than that
# [1,4,3,3,2] -> 5!/2!=60
print(f"Number of permutations: {count}") 
```

* * *

## 回答 #31

> 赞同：1
> 
> 时间：2021-09-30T19:17:25.497

```
def permutate(l):
    for i, x in enumerate(l):
        for y in l[i + 1:]:
            yield x, y

if __name__ == '__main__':
    print(list(permutate(list('abcd'))))
    print(list(permutate([1, 2, 3, 4])))

#[('a', 'b'), ('a', 'c'), ('a', 'd'), ('b', 'c'), ('b', 'd'), ('c', 'd')]
#[(1, 2), (1, 3), (1, 4), (2, 3), (2, 4), (3, 4)] 
```

* * *

## 回答 #32

> 赞同：0
> 
> 时间：2018-03-02T15:21:28.427

我的 Python 解决方案：

```
def permutes(input,offset):
    if( len(input) == offset ):
        return [''.join(input)]

    result=[]        
    for i in range( offset, len(input) ):
         input[offset], input[i] = input[i], input[offset]
         result = result + permutes(input,offset+1)
         input[offset], input[i] = input[i], input[offset]
    return result

# input is a "string"
# return value is a list of strings
def permutations(input):
    return permutes( list(input), 0 )

# Main Program
print( permutations("wxyz") ) 
```

* * *

## 回答 #33

> 赞同：0
> 
> 时间：2018-05-12T23:36:28.873

```
def permutation(word, first_char=None):
    if word == None or len(word) == 0: return []
    if len(word) == 1: return [word]

    result = []
    first_char = word[0]
    for sub_word in permutation(word[1:], first_char):
        result += insert(first_char, sub_word)
    return sorted(result)

def insert(ch, sub_word):
    arr = [ch + sub_word]
    for i in range(len(sub_word)):
        arr.append(sub_word[i:] + ch + sub_word[:i])
    return arr

assert permutation(None) == []
assert permutation('') == []
assert permutation('1')  == ['1']
assert permutation('12') == ['12', '21']

print permutation('abc') 
```

输出：['abc', 'acb', 'bac', 'bca', 'cab', 'cba']

* * *

## 回答 #34

> 赞同：0
> 
> 时间：2019-03-08T20:08:16.400

使用`Counter`

```
from collections import Counter

def permutations(nums):
    ans = [[]]
    cache = Counter(nums)

    for idx, x in enumerate(nums):
        result = []
        for items in ans:
            cache1 = Counter(items)
            for id, n in enumerate(nums):
                if cache[n] != cache1[n] and items + [n] not in result:
                    result.append(items + [n])

        ans = result
    return ans
permutations([1, 2, 2])
> [[1, 2, 2], [2, 1, 2], [2, 2, 1]] 
```

* * *

## 回答 #35

> 赞同：0
> 
> 时间：2020-06-04T07:33:40.400

```
def permuteArray (arr):

    arraySize = len(arr)

    permutedList = []

    if arraySize == 1:
        return [arr]

    i = 0

    for item in arr:

        for elem in permuteArray(arr[:i] + arr[i + 1:]):
            permutedList.append([item] + elem)

        i = i + 1    

    return permutedList 
```

我打算不穷尽新产品线中的每一种可能性，以使其具有某种独特性。

* * *

## 回答 #36

> 赞同：0
> 
> 时间：2020-10-21T20:14:09.927

```
from typing import List
import time, random

def measure_time(func):
    def wrapper_time(*args, **kwargs):
        start_time = time.perf_counter()
        res = func(*args, **kwargs)
        end_time = time.perf_counter()
        return res, end_time - start_time

    return wrapper_time

class Solution:
    def permute(self, nums: List[int], method: int = 1) -> List[List[int]]:
        perms = []
        perm = []
        if method == 1:
            _, time_perm = self._permute_recur(nums, 0, len(nums) - 1, perms)
        elif method == 2:
            _, time_perm = self._permute_recur_agian(nums, perm, perms)
            print(perm)
        return perms, time_perm

    @measure_time
    def _permute_recur(self, nums: List[int], l: int, r: int, perms: List[List[int]]):
        # base case
        if l == r:
            perms.append(nums.copy())

        for i in range(l, r + 1):
            nums[l], nums[i] = nums[i], nums[l]
            self._permute_recur(nums, l + 1, r , perms)
            nums[l], nums[i] = nums[i], nums[l]

    @measure_time
    def _permute_recur_agian(self, nums: List[int], perm: List[int], perms_list: List[List[int]]):
        """
        The idea is similar to nestedForLoops visualized as a recursion tree.
        """
        if nums:
            for i in range(len(nums)):
                # perm.append(nums[i])  mistake, perm will be filled with all nums's elements.
                # Method1 perm_copy = copy.deepcopy(perm)
                # Method2 add in the parameter list using + (not in place)
                # caveat: list.append is in-place , which is useful for operating on global element perms_list
                # Note that:
                # perms_list pass by reference. shallow copy
                # perm + [nums[i]] pass by value instead of reference.
                self._permute_recur_agian(nums[:i] + nums[i+1:], perm + [nums[i]], perms_list)
        else:
            # Arrive at the last loop, i.e. leaf of the recursion tree.
            perms_list.append(perm)

if __name__ == "__main__":
    array = [random.randint(-10, 10) for _ in range(3)]
    sol = Solution()
    # perms, time_perm = sol.permute(array, 1)
    perms2, time_perm2 = sol.permute(array, 2)
    print(perms2)
    # print(perms, perms2)
    # print(time_perm, time_perm2)
``` 
```

* * *

## 回答 #37

> 赞同：0
> 
> 时间：2020-12-10T19:45:07.090

万一有人喜欢这种丑陋的单线（虽然仅适用于字符串）：

```
def p(a):
    return a if len(a) == 1 else [[a[i], *j] for i in range(len(a)) for j in p(a[:i] + a[i + 1:])] 
```

* * *

## 回答 #38

> 赞同：0
> 
> 时间：2022-02-20T18:34:12.353

使用递归求解，遍历元素，获取第 i 个元素，然后问自己：“其余元素的排列是什么”，直到没有元素为止。

我在这里解释了解决方案：[https ://www.youtube.com/watch?v=_7GE7psS2b4](https://www.youtube.com/watch?v=_7GE7psS2b4)

```
class Solution:
    def permute(self,nums:List[int])->List[List[int]]:
        res=[]
        def dfs(nums,path):
            if len(nums)==0:
                res.append(path)
            for i in range(len(nums)):
                dfs(nums[:i]+nums[i+1:],path+[nums[i]])
        dfs(nums,[])
        return res 
```

* * *

## 回答 #39

> 赞同：-3
> 
> 时间：2015-09-08T02:58:55.873

对于 Python，我们可以使用 itertools 并导入排列和组合来解决您的问题

```
from itertools import product, permutations
A = ([1,2,3])
print (list(permutations(sorted(A),2))) 
```

# eclipse - 如何下载 BIRT 的源代码？

> ID：104439
> 
> 赞同：5
> 
> 时间：2008-09-19T18:43:20.987
> 
> 标签：eclipse, cvs, birt

Eclipse 项目都存储在 Eclipse Foundation CVS 服务器中。使用源代码是调试代码和弄清楚如何做新事物的好方法。

不幸的是，在像 BIRT 这样的大型软件项目中，很难知道特定构建需要哪些项目和版本。那么获取特定构建源的最佳方法是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-19T18:45:38.767

好吧，我知道这个问题的答案...

Eclipse 有一个名为 Team Project Sets 的功能，它允许您定义一个项目集合，这些项目存储在可以作为包下载的各种版本控制系统中。我发布了一组团队项目集文件，可用于获取 BIRT 源代码。这些文件存储在[此处的 Subversion 存储库中](http://longlake.minnovent.com/repos/birt_example)

[我在BirtWorld](http://birtworld.blogspot.com)博客上有一篇更详细的短文。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-19T18:47:49.980

访问 BIRT 网站并按照他们的[指示](http://www.eclipse.org/birt/phoenix/build/buildInstructions.php#checkout)进行操作。

# java - JAVA、JNI 和 C 应用程序的内存占用问题

> ID：104442
> 
> 赞同：2
> 
> 时间：2008-09-19T18:44:05.730
> 
> 标签：java, c, memory, java-native-interface

我有一个用 C 编写的应用程序，它生成一个 JVM 并使用 JNI 与 Java 应用程序交互。我通过 Process Explorer 的内存占用达到 1GB 并且内存不足。现在据我所知，它应该能够达到 2GB。我相信的一件事是 JVM 正在使用的内存在 Process Explorer 中不可见。我的 xmx 设置为 256，我添加了一些语句来观察 java 端内存，它在 256 处达到峰值，而 GC 正在完成它的工作，这一切都很好。所以我的问题是，其他 700+ MB 的消耗在哪里？那里有 Java/JNI/C 内存专家吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-19T20:00:48.353

尝试使用 C 语言的测试应用程序，它不会产生 JVM，而是尝试分配越来越多的内存。查看测试应用程序是否可以达到 2 GB 的障碍。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-19T19:25:21.293

JNI 代码中可能存在泄漏。

记住，一旦你完成了任何对象引用，就使用 (*jni)->DeleteLocalRef()。如果您使用任何本机 C 缓冲区来创建新的 Java 对象，请确保在创建对象后释放它们。查看 JNI 规范以获取更多指南。

根据您使用的 VM，您可能能够打开 JNI 检查。例如，在 IBM JDK 上，您可以指定“-Xcheck:jni”。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-19T20:38:27.857

好吧，感谢您的所有帮助，尤其是@alexander，我发现Java Heap 正在使用通过Process Explorer 不可见的所有额外内存。事实上，通过我运行的其他测试，JVM 的内存消耗包含在我从 Process Explorer 中看到的内容中。所以堆占用了大量的内存，我将不得不对此做更多的研究，也许会问一个单独的问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-19T18:48:57.370

编写一个 C 测试工具并使用 valgrind/alleyoop 检查 C 代码中的泄漏，同样使用 java jvisualvm 工具。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-19T18:53:28.733

C 和 JNI 代码也可以分配内存（malloc/free/new/etc），这在 VM 的 256m 之外。xMX 仅限制 VM 将自行分配的内容。根据您在 C 代码中分配的内容，以及在内存中加载的其他内容，您可能无法达到 2GB，也可能无法达到。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-19T19:05:04.337

如果您说是 Windows 进程内存不足而不是 JVM，那么我最初的猜测是您可能从 JVM 调用了一些（您自己的）本机方法，而这些本机方法会泄漏内存。所以，我同意@John Gardner 的观点。

# flash - Flash - 一次拖动两个影片剪辑？

> ID：104448
> 
> 赞同：0
> 
> 时间：2008-09-19T18:46:02.027
> 
> 标签：flash, actionscript-3

我正在尝试创建与[此类](http://flashden.net/item/zoom-pan-controls-with-dynamic-image-settings/15713)似的地图应用程序。单击图像左侧的 SWF 预览选项卡。具体来说，注意您如何平移，地图上的可点击按钮随之移动。基本上，他们是怎么做到的？

我的应用程序有一个地图，您可以使用 startDrag() 函数单击并平移它。我有一个单独的图层，其中包含我想跟随地图图层的平移的其他可点击影片剪辑。不幸的是，Flash 限制您一次只能拖动[一个影片剪辑](http://www.adobe.com/support/flash/action_scripts/actionscript_dictionary/actionscript_dictionary681.html)。有人提出了一个使用[原型](http://proto.layer51.com/d.aspx?f=845)的解决方案，但我无法让它正常工作，我不确定是不是因为我使用的是 ActionScript 3.0。

任何人都可以为我概述一种更好的方式来完成我正在尝试做的事情，或者更好的方式来完成我目前正在做的事情吗？欣赏它。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-19T19:35:48.193

简单的。将您的地图**和**可点击按钮放入一个新的 MovieClip 中，您可以将其命名为*interactiveMapContainer或类似的名称，然后在**interactiveMapContainer*上调用您的 startDrag 方法，一旦您拖动它，您仍然可以点击按钮。

Jakub Kotrla 的方法也可以很好地工作，尽管它稍微复杂一些。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-19T19:36:07.337

我认为如果可以让所有东西都成为“主要”可拖动对象的子对象，我认为 defmeta 的方法是最好的方法——它是最快的（就 UI 响应时间而言）和最简单的，并且需要最少的代码。

如果这不是一个选项，您可以使用其他几种方法：

*   如果您使用的是 Flex，您可以通过监听其上的[MoveEvent](http://livedocs.adobe.com/flex/3/langref/mx/events/MoveEvent.html) .MOVE 事件并相应地移动自己来让其他对象与地图一起移动
*   您可以自己实现拖动功能，以便更好地控制它（见下文）。

这是一个为对象实现拖动功能的示例，该对象还将随之移动一堆“兄弟”对象。在这个例子中，

*   任何以下划线开头的变量都是包含此代码的类的私有成员
*   `_siblings`是一个字典，其中的键是需要移动的其他对象。

.

```
private var _dragStartCoordinates:Point = null;
private var _siblingsDragStartCoordinates:Dictionary = null;

private function mouseDownHandler(event:MouseEvent):void
{
    this.startDrag();
    _dragStartCoordinates = new Point(this.x, this.y);

    _siblingsDragStartCoordinates = new Dictionary(true);
    for (var sibling:DisplayObject in _siblings)
    {
        _siblingsDragStartCoordinates[sibling] = new Point(sibling.x, sibling.y);
    }

    stage.addEventListener(MouseEvent.MOUSE_UP, dragMouseUpHandler, false, 0, true);
    stage.addEventListener(MouseEvent.MOUSE_MOVE, dragMouseMoveHandler, false, 0, true);
}

private function dragMouseUpHandler(event:MouseEvent):void
{
    stage.removeEventListener(MouseEvent.MOUSE_UP, dragMouseUpHandler, false);
    stage.removeEventListener(MouseEvent.MOUSE_MOVE, dragMouseMoveHandler, false);
    this.stopDrag();
    moveSiblings();
    _dragStartCoordinates = null;
    _siblingsDragStartCoordinates = null;
}

private function dragMouseMoveHandler(event:MouseEvent):void
{
    moveSiblings();
}

// expects _dragStartCoordinates and _siblingsDragStartCoordinates
// to be set
private function moveSiblings():void
{
    var xDiff:Number = this.x - _dragStartCoordinates.x;
    var yDiff:Number = this.y - _dragStartCoordinates.y;

    for (var sibling:DisplayObject in _siblings)
    {
        sibling.x = _siblingsDragStartCoordinates[sibling].x + xDiff;
        sibling.y = _siblingsDragStartCoordinates[sibling].y + yDiff;
    }
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-19T19:23:52.980

我无法拖动您链接的任何 int SWF，只需通过 mouseWheel 进行缩放。

您可以使用事件 mousedown、mouseMove 和 mouseUp 一次拖动多个影片剪辑。

通过 Mouse.addListener(object) 为事件添加事件处理程序。

*   在 mouseDown 中设置一些标志并记住当前鼠标位置。
*   如果设置了标志，则在 mouseMove 中计算移动偏移量，只需更改要拖动的所有动画剪辑的 .x 和 .y。
*   在 mouseUp 中将标志设置为 false

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-03T20:43:32.097

感谢 hasseg 的代码，节省了一点时间。这是我对公众使用的看法...

```
 package Tools
{
    import flash.display.MovieClip; 
    import flash.events.*; 
    import flash.geom.Rectangle; 
    import flash.utils.setInterval; 
    import flash.utils.clearInterval; 
    import flash.display.MovieClip;
    import flash.display.DisplayObject;
    import flash.display.Sprite;
    import flash.geom.Point;
    import flash.utils.Dictionary;

    public class DragSync { 
        private var _dragStartCoordinates:Point = null;
        private var _siblingsDragStartCoordinates:Dictionary = null;
        private var _primaryItem:Object = null;
        private var _dragWithPrimary:Array = null;

        public function DragSync(primaryItem:Object,dragWithPrimary:Array)
        {
            _primaryItem = primaryItem;
            _dragWithPrimary = dragWithPrimary;

            _primaryItem.addEventListener(MouseEvent.MOUSE_DOWN, mouseDownHandler);
            _primaryItem.addEventListener(MouseEvent.MOUSE_UP, dragMouseUpHandler);
            _primaryItem.addEventListener(MouseEvent.MOUSE_MOVE, dragMouseMoveHandler);
        }

        private function mouseDownHandler(event:MouseEvent):void
        {
            _dragStartCoordinates = new Point(_primaryItem.x, _primaryItem.y);
            _siblingsDragStartCoordinates = new Dictionary(true);

            for each (var sibling:DisplayObject in _dragWithPrimary)
            {
                _siblingsDragStartCoordinates[sibling] = new Point(sibling.x, sibling.y)
            }
        }

        private function dragMouseUpHandler(event:MouseEvent):void
        {
            moveSiblings();
            _dragStartCoordinates = null;
            _siblingsDragStartCoordinates = null;
        }

        private function dragMouseMoveHandler(event:MouseEvent):void
        {
            moveSiblings();
        }

        // expects _dragStartCoordinates and _siblingsDragStartCoordinates
        // to be set
        private function moveSiblings():void
        {
            if (!_dragStartCoordinates || !_siblingsDragStartCoordinates) return;

            var xDiff:Number = _primaryItem.x - _dragStartCoordinates.x;
            var yDiff:Number = _primaryItem.y - _dragStartCoordinates.y;

            for each (var sibling:DisplayObject in _dragWithPrimary)
            {
                sibling.x = _siblingsDragStartCoordinates[sibling].x + xDiff;
                sibling.y = _siblingsDragStartCoordinates[sibling].y + yDiff;
            }
        }

    } 
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-03-04T01:42:57.040

非常感谢你。我已将其更改如下： package { import flash.display.MovieClip; 导入 flash.events.*；导入 flash.geom.Rectangle；导入 flash.utils.setInterval；导入 flash.utils.clearInterval；导入 flash.display.MovieClip；导入 flash.display.DisplayObject；导入 flash.display.Sprite；导入 flash.geom.Point；导入 flash.utils.Dictionary；

```
public class DragSync { 
    private var _dragStartCoordinates:Point = null;
    private var _siblingsDragStartCoordinates:Dictionary = null;
    private var _primaryItem:Object = null; 
```

私有 var _workSpace:Object = null; 私有变量 _dragWithPrimary:Array = null;

```
 public function DragSync(primaryItem:Object,workSpace:Object, dragWithPrimary:Array)
    {
            _primaryItem = primaryItem;
            _dragWithPrimary = dragWithPrimary;
_workSpace = workSpace;

            _workSpace.addEventListener(MouseEvent.MOUSE_DOWN, mouseDownHandler);
            _workSpace.addEventListener(MouseEvent.MOUSE_UP, dragMouseUpHandler);
            _workSpace.addEventListener(MouseEvent.MOUSE_MOVE, dragMouseMoveHandler);
_workSpace.addEventListener(MouseEvent.MOUSE_OUT, dragOut);
    }

    private function mouseDownHandler(event:MouseEvent):void
    {
            trace("event mouse down");
_primaryItem.startDrag();
_dragStartCoordinates = new Point(_primaryItem.x, _primaryItem.y);
            _siblingsDragStartCoordinates = new Dictionary(true);

            for each (var sibling:DisplayObject in _dragWithPrimary)
            {
                    _siblingsDragStartCoordinates[sibling] = new Point(sibling.x, sibling.y)
            }
    }

    private function dragMouseUpHandler(event:MouseEvent):void
    {
            moveSiblings();
_primaryItem.stopDrag();
            _dragStartCoordinates = null;
            _siblingsDragStartCoordinates = null;
    }

    private function dragMouseMoveHandler(event:MouseEvent):void
    {
            trace("event mouse MOVE MOVE");
moveSiblings();
    } 
```

私有函数dragOut（事件：MouseEvent）：无效{_primaryItem.stopDrag（）；}

```
 // expects _dragStartCoordinates and _siblingsDragStartCoordinates
    // to be set
    private function moveSiblings():void
    {
            if (!_dragStartCoordinates || !_siblingsDragStartCoordinates) return;

            var xDiff:Number = _primaryItem.x - _dragStartCoordinates.x;
            var yDiff:Number = _primaryItem.y - _dragStartCoordinates.y;

            for each (var sibling:DisplayObject in _dragWithPrimary)
            {
                    sibling.x = _siblingsDragStartCoordinates[sibling].x + xDiff;
                    sibling.y = _siblingsDragStartCoordinates[sibling].y + yDiff;
            }

    }

} 
```

}

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-19T19:29:57.523

您可以将影片剪辑添加到父剪辑并让事件处理程序拖动父剪辑吗？

# asp.net - 将样式应用于 CheckBoxList 中的 ListItems

> ID：104458
> 
> 赞同：27
> 
> 时间：2008-09-19T18:47:18.873
> 
> 标签：asp.net, html, controls, coding-style

如何将样式应用于 CheckBoxList ListItems。与其他控件不同，例如可以指定的 Repeater，您`<ItemStyle>`似乎无法为每个单独的控件指定样式。

有什么解决办法吗？

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-09-19T19:03:40.423

您可以按如下方式以编程方式将属性添加到 ListItems。

假设您有一个 CheckBoxList 并且您正在添加 ListItems。您可以一路添加属性。

```
ListItem li = new ListItem("Richard Byrd", "11");
li.Selected = false;
li.Attributes.Add("Style", "color: red;");
CheckBoxList1.Items.Add(li); 
```

这将使列表项文本的颜色变为红色。尝试并玩得开心。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-09-19T18:52:47.767

似乎最好的方法是创建一个新的 CssClass。ASP.NET 将 CheckBoxList 转换为表结构。

使用类似的东西

样式.css

```
.chkboxlist td 
{
    font-size:x-large;
} 
```

页面.aspx

```
<asp:CheckBoxList ID="chkboxlist1" runat="server" CssClass="chkboxlist" /> 
```

会成功的

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-09-23T00:17:52.127

除了安德鲁的回答......

根据您在`CheckBoxList`or上放置的其他属性`RadioButtonList`，ASP.Net 将使用不同的结构呈现输出。例如，如果您设置`RepeatLayout="Flow"`，它不会呈现为 TABLE，因此您必须注意您在 CSS 文件中使用的后代选择器。

在*大多数*情况下，您可以只在渲染页面上执行“查看源代码”，可能在几个不同的浏览器上，然后弄清楚 ASP.Net 在做什么。但是，存在一种危险，即新版本的服务器控件或不同的浏览器会以不同的方式呈现它们。

如果您想以不同的方式设置特定列表项或一组列表项的样式而不在代码隐藏中添加属性，则可以使用 CSS 属性选择器。唯一的缺点是 IE6 不支持它们。[jQuery](http://jquery.com)完全支持 CSS 3 样式属性选择器，因此您可能也可以将它用于更广泛的浏览器支持。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2012-03-09T10:23:13.650

您也可以在标记中实现这一点。

```
<asp:ListItem Text="Good" Value="True" style="background-color:green;color:white" />
<br />
<asp:ListItem Text="Bad" Value="False" style="background-color:red;color:white" /> 
```

单词 Style 将带有下划线，警告*属性“style”不是元素“ListItem”的有效属性。*，但无论如何，这些项目都按需要进行了格式化。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2013-10-25T18:04:24.993

您甚至可以为每个单词设置不同的字体样式和颜色。

```
<asp:ListItem Text="Other (<span style=font-weight:bold;>please </span><span>style=color:Red;font-weight:bold;>specify</span>):" Value="10"></asp:ListItem> 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-06-28T17:44:50.653

```
public bool Repeater_Bind()
{
    RadioButtonList objRadioButton = (RadioButtonList)eventArgs.Item.FindControl("rbList");
    if (curQuestionInfo.CorrectAnswer != -1) {
        objRadioButton.Items[curQuestionInfo.CorrectAnswer].Attributes.Add("Style", "color: #b4fbb1;");
    }
} 
```

# insert - 对于 std::map，如果必须调整容器大小并且内存不可用，插入将如何表现？

> ID：104483
> 
> 赞同：4
> 
> 时间：2008-09-19T18:50:32.203
> 
> 标签：insert, stdmap

对于 std::map，如果必须调整容器大小并且内存不可用，插入将如何表现？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-19T18:56:11.957

STL 映射不必“调整大小”容器。map（就像列表一样）是一个基于节点的容器；每个插入分配内存。

也就是说，内存不足情况的处理方式与 C++ 中的任何其他内存不足情况一样：它会抛出 std::bad_alloc。带有默认分配器的 STL 容器并没有做任何花哨的事情，它们最终都会*以某种方式*通过标准的 new/delete 运算符进行分配。

在 STL map 的情况下，它会抛出异常，否则会表现得好像它没有被调用一样。也就是说，容器将保持不变。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-19T18:53:00.420

New 会抛出异常。就这么简单。

插入不会发生，字典的内容也不会被修改或损坏。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-19T19:00:24.223

为了扩展 Nils 的答案（是的，它会抛出），但是当它抛出时会发生什么有时会在规范中令人困惑。

在规范的 17.2.2 中（关于映射/异常），如果 insert() 抛出，则该函数无效。这是对地图的有力保证。这与使用向量或双端队列等连续分配的容器不同。

# html - 有没有办法将样式强制到已经具有 style="" 属性的 div 元素

> ID：104485
> 
> 赞同：30
> 
> 时间：2008-09-19T18:50:48.443
> 
> 标签：html, css

我正在尝试对我无法控制的 HTML 输出进行皮肤处理。其中一个元素是`div`带有`style="overflow: auto"`属性的。
CSS中有没有办法强制`div`使用它`overflow: hidden;`？

* * *

## 回答 #1

> 赞同：86
> 
> 时间：2008-09-19T18:52:21.123

您可以添加`!important`到样式的末尾，如下所示：

```
element {
    overflow: hidden !important;
} 
```

这是您通常不应该依赖的东西，但在您的情况下，这是最好的选择。更改 Javascript 中的值偏离了分离标记、表示和行为 (html/css/javascript) 的最佳实践。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-09-19T18:52:47.440

您是否尝试过`!important`在 CSS 文件中进行设置？就像是：

```
#mydiv { overflow: hidden !important; } 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-19T18:53:20.573

不确定这是否可行，尚未使用`overflow`.

```
overflow:hidden !important 
```

也许？

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-19T18:53:26.970

如果 div 具有内联样式声明，那么在不更改源代码的情况下修改它的唯一方法是使用 JavaScript。内联样式属性每次都在 CSS 中“获胜”。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-19T19:14:11.600

正如下面粘贴的 W3C 规范所解释的，Magnar 是正确的。似乎添加了 !important 关键字以允许用户在元素级别覆盖甚至“烘焙”样式设置。由于您处于无法控制 html 的情况，这可能是您的最佳选择，尽管它不是正常的设计模式。

[W3C CSS 规范](http://www.w3.org/TR/CSS2/cascade.html)

摘抄：

> 6.4.2 !important 规则 CSS 试图在作者和用户样式表之间建立权力平衡。默认情况下，作者样式表中的规则会覆盖用户样式表中的规则（参见级联规则 3）。
> 
> ```
> However, for balance, an "!important" declaration (the keywords 
> ```
> 
> “！” 和“重要”跟随声明）优先于正常声明。作者和用户样式表都可能包含“！important”声明，并且用户“！important”规则覆盖作者“！important”规则。此 CSS 功能通过让具有特殊要求（大字体、颜色组合等）的用户控制演示文稿来提高文档的可访问性。
> 
> ```
> Note. This is a semantic change since CSS1\. In CSS1, author 
> ```
> 
> “！important”规则优先于用户“！important”规则。
> 
> ```
> Declaring a shorthand property (e.g., 'background') to be 
> ```
> 
> “！important”相当于将其所有子属性声明为“！important”。
> 
> ```
> Example(s):
> 
> The first rule in the user's style sheet in the following example 
> ```
> 
> 包含一个“！important”声明，它覆盖作者样式表中的相应声明。由于被标记为“！important”，第二个声明也将获胜。但是，用户样式表中的第三条规则不是“！important”，因此将输给作者样式表中的第二条规则（恰好在速记属性上设置样式）。此外，第三作者规则将输给第二作者规则，因为第二条规则是“！important”。这表明“！important”声明在作者样式表中也有一个功能。
> 
> ```
> /* From the user's style sheet */
> P { text-indent: 1em ! important }
> P { font-style: italic ! important }
> P { font-size: 18pt }
> 
> /* From the author's style sheet */
> P { text-indent: 1.5em !important }
> P { font: 12pt sans-serif !important }
> P { font-size: 24pt } 
> ```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-19T18:52:10.560

据我所知，实际 HTML 元素上的样式会覆盖您可以在单独的 CSS 样式中执行的任何操作。

但是，您可以使用 Javascript 来覆盖它。

# regex - Mod-rewrites on apache：更改所有 URL

> ID：104487
> 
> 赞同：1
> 
> 时间：2008-09-19T18:51:08.317
> 
> 标签：regex, apache, mod-rewrite

现在我正在做这样的事情：

```
RewriteRule ^/?logout(/)?$ logout.php
RewriteRule ^/?config(/)?$ config.php 
```

我宁愿有一个规则可以为每个 url 做同样的事情，所以我不必在每次添加新文件时都添加它们。

另外，如果可能的话，我喜欢将“/config/new”之类的内容与“config_new.php”相匹配。我猜一些正则表达式会让我完成这个？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-19T19:01:50.193

尝试：

重写规则 ^/?(\w+)/?$ $1.php

$1 是括号中第一个捕获的字符串的内容。不需要第二个斜线周围的括号。

编辑：对于另一场比赛，试试这个：

重写规则 ^/?(\w+)/(\w+)/?$ $1_$2.php

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-19T19:07:30.587

我会做这样的事情：

```
RewriteRule ^/?(logout|config|foo)/?$ $1.php
RewriteRule ^/?(logout|config|foo)/(new|edit|delete)$ $1_$2.php 
```

我更喜欢明确列出我想要匹配的 url，这样我就不必担心静态内容或以后添加不需要重写到 php 文件的新内容。

如果所有子 url 对所有根 url ( `book/new`, `movie/new`, `user/new`) 都有效，则上述方法是可以的，但如果您想根据根操作 (`logout/new`没有多大意义) 拥有不同的子 url，则不是很好。您可以使用更复杂的正则表达式来处理它，或者将所有内容路由到单个 php 文件，该文件将根据 url 确定要包含和显示的文件。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-19T19:04:32.903

Mod rewrite 不能像您在问题的第二部分中那样做（可能）无限的替换。[但请查看Apache URL 重写指南](http://httpd.apache.org/docs/2.2/misc/rewriteguide.html)底部的外部重写引擎：

> 外部重写引擎
> 
> 描述：
> 
> 常见问题解答：我们如何解决 FOO/BAR/QUUX/等问题。问题？使用 mod_rewrite 似乎没有解决方案...解决方案：
> 
> 使用一个外部的 RewriteMap，即一个类似于 RewriteMap 的程序。它在 Apache 启动时运行一次，在 STDIN 上接收请求的 URL，并且必须将结果（通常重写）的 URL 放在 STDOUT 上（相同的顺序！）。
> 
> ```
> RewriteEngine on
> RewriteMap    quux-map       prg:/path/to/map.quux.pl
> RewriteRule   ^/~quux/(.*)$  /~quux/${quux-map:$1}
> 
> #!/path/to/perl
> 
> #   disable buffered I/O which would lead
> #   to deadloops for the Apache server
> $| = 1;
> 
> #   read URLs one per line from stdin and
> #   generate substitution URL on stdout
> while (<>) {
>     s|^foo/|bar/|;
>     print $_;
> } 
> ```
> 
> 这是一个仅用于演示的示例，只是将所有 URL /~quux/foo/... 重写为 /~quux/bar/...。实际上您可以编写任何您喜欢的程序。但请注意，虽然普通用户也可以使用此类地图，但只有系统管理员可以定义它。

# visual-studio-2005 - 无法将负载测试结果存储在 TFS 2005 结果存储中

> ID：104494
> 
> 赞同：1
> 
> 时间：2008-09-19T18:51:45.803
> 
> 标签：visual-studio-2005, tfs, load-testing

我已经设置了一个结果存储，当我发布负载测试的结果时，我无法查看发布的测试详细信息。

从构建报告的测试运行部分，我单击已发布的构建，当我从“测试运行”快捷菜单中选择“查看测试结果详细信息”时，我收到一个错误，即无法查看测试结果详细信息，因为结果未存储在结果中店铺。

我在结果存储数据库中查找了数据，但那里没有任何内容，因此该错误是有道理的。

我已经在 Administer Test Controller 对话框中设置了一个与结果存储区的连接字符串。这是将测试结果送入商店唯一需要做的事情吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-09-19T20:10:09.173

在将数据复制到数据仓库之前，这些报告将不可用。这通常需要长达一小时才能完成。

请参阅[http://msdn.microsoft.com/en-us/library/ms404692(VS.80).aspx](http://msdn.microsoft.com/en-us/library/ms404692(VS.80).aspx)

# apache-flex - Flash/FLEX 3 参数错误 2082

> ID：104500
> 
> 赞同：1
> 
> 时间：2008-09-19T18:52:25.663
> 
> 标签：apache-flex, flash

有没有其他人遇到过这个错误？有时它会在开始加载应用程序时弹出参数错误 2082。我可以解决它的唯一方法是重新启动我的机器。重启浏览器也解决不了。我已经在网上阅读了一些解决方案，但我很想知道其他人尝试过使用什么来解决他们的错误？提前致谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-23T00:50:50.220

这是 Flash 中的一个已知错误，这里有相当长的讨论：

[http://tech.groups.yahoo.com/group/flexcoders/message/63829](http://tech.groups.yahoo.com/group/flexcoders/message/63829)

总而言之，您应该将 localConnection.connect() 包装在 try catch 中。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-19T19:02:03.143

您是在谈论[Actionscript 3.0 Runtime Error 2082](http://livedocs.adobe.com/flex/3/langref/runtimeErrors.html)吗？

# c# - BITS 最好的免费 C# 包装器是什么？

> ID：104505
> 
> 赞同：8
> 
> 时间：2008-09-19T18:53:01.620
> 
> 标签：c#, windows, interop, microsoft-bits

BITS，Windows 后台智能传输服务。

看起来有一些 C# 包装器可以管理与 BITS 的互操作，有人对最好的有任何意见吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-25T17:12:53.620

我发现使用 Managed_BITS 代码项目文章的问题，我发现了一个更好的包装器：

[http://www.codeplex.com/sharpbits](http://www.codeplex.com/sharpbits)
[http://nuget.org/packages/SharpBITS](http://nuget.org/packages/SharpBITS)

更少的代码，更简洁，与 codeproject 不同，它并没有隐藏我实际需要使用的 BITS 接口的那些部分。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-19T20:19:14.877

查看以下内容：

1.  [http://www.codeproject.com/KB/cs/Managed_BITS.aspx](http://www.codeproject.com/KB/cs/Managed_BITS.aspx)

2.  [http://www.simple-talk.com/dotnet/.net-tools/using-bits-to-upload-files-with-.net/](http://www.simple-talk.com/dotnet/.net-tools/using-bits-to-upload-files-with-.net/)

# php - 在 HEREDOC 字符串中调用 PHP 函数

> ID：104516
> 
> 赞同：99
> 
> 时间：2008-09-19T18:54:02.397
> 
> 标签：php, string, heredoc

在 PHP 中，HEREDOC 字符串声明对于输出 html 块非常有用。您可以通过在变量前加上 $ 来解析变量，但对于更复杂的语法（如 $var[2][3]），您必须将表达式放在 {} 大括号内。

在 PHP 5 中，*实际上*可以在 HEREDOC 字符串内的 {} 大括号内进行函数调用，但您必须做一些工作。函数名本身必须存储在一个变量中，并且您必须像调用它是动态命名的函数一样调用它。例如：

```
$fn = 'testfunction';
function testfunction() { return 'ok'; }
$string = <<< heredoc
plain text and now a function: {$fn()}
heredoc; 
```

如您所见，这比仅仅更混乱一点：

```
$string = <<< heredoc
plain text and now a function: {testfunction()}
heredoc; 
```

除了第一个代码示例之外，还有其他方法，例如突破 HEREDOC 来调用函数，或者扭转问题并执行以下操作：

```
?>
<!-- directly output html and only breaking into php for the function -->
plain text and now a function: <?PHP print testfunction(); ?> 
```

后者的缺点是输出直接放入输出流（除非我使用输出缓冲），这可能不是我想要的。

所以，我的问题的本质是：有没有更优雅的方法来解决这个问题？

**根据回复进行编辑：**看起来某种模板引擎确实会让我的生活更轻松，但它需要我基本上颠倒我通常的 PHP 风格。并不是说那是一件坏事，但它解释了我的惰性。不过，我正在想办法让生活更轻松，所以我现在正在研究模板。

* * *

## 回答 #1

> 赞同：76
> 
> 时间：2012-05-23T04:06:59.510

如果您真的想这样做但比使用类更简单，您可以使用：

```
function fn($data) {
  return $data;
}
$fn = 'fn';

$my_string = <<<EOT
Number of seconds since the Unix Epoch: {$fn(time())}
EOT; 
```

* * *

## 回答 #2

> 赞同：53
> 
> 时间：2008-09-19T19:10:54.043

就个人而言，我根本不会为此使用HEREDOC。它只是不构成一个好的“模板构建”系统。您所有的 HTML 都被锁定在一个有几个缺点的字符串中

*   所见即所得没有选项
*   IDE 中的 HTML 没有代码完成
*   输出 (HTML) 锁定到逻辑文件
*   您最终不得不使用像您现在尝试做的那样的技巧来实现更复杂的模板，例如循环

获取一个基本的模板引擎，或者只使用 PHP 和包含 - 这就是语言有`<?php`和`?>`分隔符的原因。

**模板文件.php**

```
<html>
<head>
  <title><?php echo $page_title; ?></title>
</head>
<body>
  <?php echo getPageContent(); ?>
</body> 
```

**索引.php**

```
<?php

$page_title = "This is a simple demo";

function getPageContent() {
    return '<p>Hello World!</p>';
}

include('template_file.php'); 
```

* * *

## 回答 #3

> 赞同：45
> 
> 时间：2008-09-19T18:59:53.973

我会做以下事情：

```
$string = <<< heredoc
plain text and now a function: %s
heredoc;
$string = sprintf($string, testfunction()); 
```

不知道你是否认为这更优雅......

* * *

## 回答 #4

> 赞同：17
> 
> 时间：2009-12-22T18:11:55.970

试试这个（或者作为全局变量，或者在需要时实例化）：

```
<?php
  class Fn {
    public function __call($name, $args) {
      if (function_exists($name)) {
        return call_user_func_array($name, $args);
      }
    }
  }

  $fn = new Fn();
?> 
```

现在任何函数调用都通过`$fn`实例。所以现有的函数`testfunction()`可以在heredoc中调用`{$fn->testfunction()}`

基本上我们将所有函数包装到一个类实例中，并使用 PHP 的`__call magic`方法将类方法映射到需要调用的实际函数。

* * *

## 回答 #5

> 赞同：17
> 
> 时间：2016-03-24T14:31:31.647

为了完整起见，您还可以使用`!${''}` ~~black magic~~ [parser hack](https://tpunt.github.io/jekyll/update/2016/01/25/php-parser-hack.html)：

```
echo <<<EOT
One month ago was ${!${''} = date('Y-m-d H:i:s', strtotime('-1 month'))}.
EOT; 
```

* * *

## 回答 #6

> 赞同：10
> 
> 时间：2009-09-06T20:49:04.003

我有点晚了，但我偶然发现了它。对于任何未来的读者，这就是我可能会做的事情：

我只会使用输出缓冲区。所以基本上，你使用 ob_start() 开始缓冲，然后在其中包含任何函数、变量等的“模板文件”，获取缓冲区的内容并将它们写入字符串，然后关闭缓冲区。然后，您使用了所需的任何变量，可以运行任何函数，并且您的 IDE 中仍然可以使用 HTML 语法突出显示。

这就是我的意思：

**模板文件：**

```
<?php echo "plain text and now a function: " . testfunction(); ?> 
```

**脚本：**

```
<?php
ob_start();
include "template_file.php";
$output_string = ob_get_contents();
ob_end_clean();
echo $output_string;
?> 
```

因此脚本将 template_file.php 包含在其缓冲区中，运行任何函数/方法并在此过程中分配任何变量。然后你只需将缓冲区的内容记录到一个变量中，然后用它做你想做的事。

这样，如果您不想在那一秒将其回显到页面上，则不必这样做。您可以在输出之前循环并继续添加到字符串。

如果您不想使用模板引擎，我认为这是最好的方法。

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2014-11-20T20:53:01.183

在这里找到了带有包装功能的好解决方案：http: [//blog.nazdrave.net/ ?p=626](http://blog.nazdrave.net/?p=626)

```
function heredoc($param) {
    // just return whatever has been passed to us
    return $param;
}

$heredoc = 'heredoc';

$string = <<<HEREDOC
\$heredoc is now a generic function that can be used in all sorts of ways:
Output the result of a function: {$heredoc(date('r'))}
Output the value of a constant: {$heredoc(__FILE__)}
Static methods work just as well: {$heredoc(MyClass::getSomething())}
2 + 2 equals {$heredoc(2+2)}
HEREDOC;

// The same works not only with HEREDOC strings,
// but with double-quoted strings as well:
$string = "{$heredoc(2+2)}"; 
```

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2010-12-08T13:02:34.787

此代码段将使用您在用户范围内定义的函数的名称定义变量，并将它们绑定到包含相同名称的字符串。让我演示一下。

```
function add ($int) { return $int + 1; }
$f=get_defined_functions();foreach($f[user]as$v){$$v=$v;}

$string = <<< heredoc
plain text and now a function: {$add(1)}
heredoc; 
```

现在可以工作了。

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2011-06-17T10:54:50.923

我认为使用 heredoc 非常适合生成 HTML 代码。例如，我发现以下内容几乎完全不可读。

```
<html>
<head>
  <title><?php echo $page_title; ?></title>
</head>
<body>
  <?php echo getPageContent(); ?>
</body> 
```

但是，为了实现简单性，您必须在开始之前评估功能。我不认为这是一个如此可怕的约束，因为这样做，您最终会将计算与显示分开，这通常是一个好主意。

我认为以下内容非常易读：

```
$page_content = getPageContent();

print <<<END
<html>
<head>
  <title>$page_title</title>
</head>
<body>
$page_content
</body>
END; 
```

不幸的是，即使您在问题中提出了将函数绑定到变量的一个很好的建议，但最终，它给代码增加了一定程度的复杂性，这是不值得的，并且使代码的可读性降低，这是heredoc 的主要优势。

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2008-09-19T23:42:49.287

我会把[Smarty](http://www.smarty.net/)看成一个模板引擎——我自己没有尝试过任何其他的，但它做得很好。

如果您想坚持当前的*无*模板方法，那么输出缓冲有什么不好呢？与必须声明作为您要调用的函数的字符串名称的变量相比，它会给您更大的灵活性。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2013-09-23T09:02:49.053

你忘记了 lambda 函数：

```
$or=function($c,$t,$f){return$c?$t:$f;};
echo <<<TRUEFALSE
    The best color ever is {$or(rand(0,1),'green','black')}
TRUEFALSE; 
```

您也可以使用函数 create_function

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2011-04-08T22:58:01.283

有点晚了，但还是。这在heredoc中是可能的！

[查看 php 手册的“复杂（卷曲）语法”部分](http://www.php.net/manual/en/language.types.string.php#language.types.string.syntax.nowdoc)

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2013-01-18T04:24:58.050

这是一个使用@CJDennis 提议的好例子：

```
function double($i)
{ return $i*2; }

function triple($i)
{ return $i*3;}

$tab = 'double';
echo "{$tab(5)} is $tab 5<br>";

$tab = 'triple';
echo "{$tab(5)} is $tab 5<br>"; 
```

例如，HEREDOC 语法的一个很好的用途是在数据库中生成具有主从关系的巨大表单。可以在 FOR 控件中使用 HEREDOC 功能，在每个字段名称后添加一个后缀。这是一个典型的服务器端任务。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2019-11-20T23:09:12.800

今天在 php 7.x 上更优雅一点

```
<?php

$test = function(){
    return 'it works!';
};

echo <<<HEREDOC
this is a test: {$test()}
HEREDOC; 
```

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2010-05-10T11:20:13.147

伙计们应该注意，它也适用于双引号字符串。

[http://www.php.net/manual/en/language.types.string.php](http://www.php.net/manual/en/language.types.string.php)

无论如何，有趣的提示。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2016-09-17T02:13:18.330

```
<div><?=<<<heredoc
Use heredoc and functions in ONE statement.
Show lower case ABC="
heredoc
. strtolower('ABC') . <<<heredoc
".  And that is it!
heredoc
?></div> 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2016-09-03T05:36:49.717

```
<?php
echo <<<ETO
<h1>Hellow ETO</h1>
ETO; 
```

你应该试试看 。ETO结束后；命令你应该回车。

# wpf - 整个表单的 WPF 验证

> ID：104520
> 
> 赞同：15
> 
> 时间：2008-09-19T18:54:18.467
> 
> 标签：wpf, validation

我对 WPF 验证系统感到非常失望。反正！如何通过单击“按钮”来验证完整的表格？

出于某种原因，WPF 中的一切都太复杂了！我可以在 ASP.NET 中的 1 行代码中进行验证，这需要 WPF 中的 10-20 行代码！

我可以使用我自己的 ValidationEngine 框架来做到这一点：

```
Customer customer = new Customer();
customer.FirstName = "John";
customer.LastName = String.Empty;

ValidationEngine.Validate(customer);

if (customer.BrokenRules.Count > 0)
{
   // do something display the broken rules! 
} 
```

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-10-08T11:50:38.813

如果输入的数据无效，WPF 应用程序应禁用提交表单的按钮。您可以通过在业务对象上实现[IDataErrorInfo](http://msdn.microsoft.com/en-us/library/system.componentmodel.idataerrorinfo.aspx)接口来实现这一点，使用 Bindings with . 要在出现错误时自定义各个控件的外观，请设置一个.[`ValidatesOnDataErrors`](http://msdn.microsoft.com/en-us/library/system.windows.data.binding.validatesondataerrors.aspx)`=true`[`Validation.ErrorTemplate`](http://msdn.microsoft.com/en-us/library/system.windows.controls.validation.errortemplate.aspx)

### XAML：

```
<Window x:Class="Example.CustomerWindow" ...>
    <Window.CommandBindings>
        <CommandBinding Command="ApplicationCommands.Save"
                        CanExecute="SaveCanExecute"
                        Executed="SaveExecuted" />
    </Window.CommandBindings>
    <StackPanel>
        <TextBox Text="{Binding FirstName, ValidatesOnDataErrors=true, UpdateSourceTrigger=PropertyChanged}" />
        <TextBox Text="{Binding LastName, ValidatesOnDataErrors=true, UpdateSourceTrigger=PropertyChanged}" />
        <Button Command="ApplicationCommands.Save" IsDefault="True">Save</Button>
        <TextBlock Text="{Binding Error}"/>
    </StackPanel>
</Window> 
```

这将创建一个`Window`带有两个`TextBox`es 的 es，您可以在其中编辑客户的名字和姓氏。只有在没有发生验证错误时才启用“保存”按钮。按钮下方`TextBlock`显示当前错误，因此用户知道发生了什么。

默认值`ErrorTemplate`是错误控件周围的细红色边框。如果这不符合您的视觉概念，请查看CodeProject 上[的 Windows Presentation Foundation](http://www.codeproject.com/KB/WPF/wpfvalidation.aspx)文章中的验证，以深入了解可以对此做些什么。

为了让窗口真正工作，窗口和客户中必须有一些基础设施。

### 代码背后

```
// The CustomerWindow class receives the Customer to display
// and manages the Save command
public class CustomerWindow : Window
{
    private Customer CurrentCustomer;
    public CustomerWindow(Customer c) 
    {
        // store the customer for the bindings
        DataContext = CurrentCustomer = c;
        InitializeComponent();
    }

    private void SaveCanExecute(object sender, CanExecuteRoutedEventArgs e)
    {
        e.CanExecute = ValidationEngine.Validate(CurrentCustomer);
    }

    private void SaveExecuted(object sender, ExecutedRoutedEventArgs e) 
    {
        CurrentCustomer.Save();
    }
}

public class Customer : IDataErrorInfo, INotifyPropertyChanged
{
    // holds the actual value of FirstName
    private string FirstNameBackingStore;
    // the accessor for FirstName. Only accepts valid values.
    public string FirstName {
        get { return FirstNameBackingStore; }
        set {
            FirstNameBackingStore = value;
            ValidationEngine.Validate(this);
            OnPropertyChanged("FirstName");
        }
    }
    // similar for LastName        

    string IDataErrorInfo.Error {
        get { return String.Join("\n", BrokenRules.Values); }
    }

    string IDataErrorInfo.this[string columnName]
    {
        get { return BrokenRules[columnName]; }
    }
} 
```

一个明显的改进是将`IDataErrorInfo`实现向上移动到类层次结构中，因为它只依赖于`ValidationEngine`，而不依赖于业务对象。

虽然这确实比您提供的简单示例代码更多，但它还具有比仅检查有效性更多的功能。这为您提供了细粒度的、自动更新的关于验证问题的用户指示，并且只要用户尝试输入无效数据，就会自动禁用“保存”按钮。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-19T19:49:41.953

我建议查看您的业务对象上的 IDataErrorInfo 接口。也看看这篇文章：[自我验证文本框](http://www.codeproject.com/KB/WPF/WPF_SelfValidatingTextBox.aspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-08-16T17:16:46.273

您可能对**[WPF 应用程序框架 (WAF)](http://waf.codeplex.com)****的BookLibrary**示例应用程序感兴趣。它展示了如何在 WPF 中使用验证，以及在存在验证错误时如何控制“保存”按钮。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-11-24T05:34:08.370

ValidatesOnDataError 用于根据您的视图模型验证业务规则，并且仅在绑定成功时才会验证。

ValidatesOnExceptions 需要与 ValidatesOnDataError 一起应用以处理由于数据类型不匹配而导致 wpf 无法执行绑定的情况，假设您要将 TextBox 绑定到视图模型中的 Age（整数）属性

```
<TextBox Text="{Binding Age, ValidatesOnDataErrors=true, UpdateSourceTrigger=PropertyChanged}" /> 
```

如果用户通过键入字母而不是数字作为年龄来输入无效条目，例如 xyz，wpf 数据绑定将默默地忽略该值，因为它无法将 xyz 绑定到 Age，并且除非绑定使用[ValidatesOnExceptions修饰，否则绑定错误将丢失](http://msdn.microsoft.com/en-us/library/system.windows.data.binding.validatesonexceptions.aspx)

```
<TextBox Text="{Binding Age, ValidatesOnDataErrors=true, ValidatesOnExceptions="True", UpdateSourceTrigger=PropertyChanged}" /> 
```

ValidatesOnException 使用 ExceptionValidationRule 对绑定错误使用默认异常处理，上面的语法是以下的简写形式

```
<TextBox>
    <TextBox.Text>
        <Binding Path="Age" UpdateSourceTrigger="PropertyChanged" ValidatesOnDataErrors="True">
            <Binding.ValidationRules>
                  <ExceptionValidationRule />
             </Binding.ValidationRules>
        </Binding>
    </TextBox.Text>
</TextBox> 
```

您可以定义自己的规则来验证用户输入，方法是从 ValidationRule 派生并实现 Validate 方法，在以下示例中为 NumericRule

```
<TextBox.Text>
 <Binding Path="Age" ValidatesOnDataErrors="True">
   <Binding.ValidationRules>
        <rules:NumericRule />
      </Binding.ValidationRules>
    </Binding>
  </TextBox.Text> 
```

验证规则应该是通用的并且不依赖于业务，因为后者是通过 IDataErrorInfo 和 ValidatesOnDataError 完成的。

与我们的单行绑定语法相比，上面的语法相当混乱，通过将 ValidationRule 实现为附加属性，可以改进语法，您可以在[这里查看](http://www.hardcodet.net/2009/01/combinding-wpf-validation-rules-and-idataerrorinfo-to-validate-conversion-errors)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-01T13:45:57.083

你的问题的描述对我来说有点模糊。我的意思是，我不确定你的困难是什么。假设 DataContext 是某种具有代表客户实例的属性的演示者或控制器，而 ValidateCommand 是 ICommand 类型的属性：

```
 <StackPanel>  
    <TextBox Text="{Binding CurrentCustomer.FirstName}" />
    <TextBox Text="{Binding CurrentCustomer.LastName}" />
    <Button Content="Validate" 
            Command="{Binding ValidateCommand}"
            CommandParameter="{Binding CurrentCustomer}" />
    <ItemsControl ItemsSource="{Binding CurrentCustomer.BrokenRules}" />
  </StackPanel> 
```

当然，这个 XAML 确实被简化了，还有其他方法可以做到这一点。作为一名现在大量参与 WPF 的 Web 开发人员，我发现大多数类似的任务在 WPF 中都变得容易得多。

# sql-server - 暖 SQL 备份

> ID：104525
> 
> 赞同：1
> 
> 时间：2008-09-19T18:55:16.827
> 
> 标签：sql-server, sql-server-2000, backup

我们有一个温暖的 sql 备份。每晚进行完整备份，txn 日志在白天每隔一段时间发送一次并恢复。我需要将数据文件移动到另一个磁盘。这些数据库处于“热备份”状态（因此我无法将它们取消标记为只读 - “错误 5063：数据库 '<dbname>' 处于热备用状态。热备用数据库是只读的。” ) 并且担心分离和重新连接。

分离/附加操作完成后，我们如何获得“热备份”状态？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-19T19:23:07.600

我知道的唯一解决方案是创建活动数据库的完整备份并将此备份还原到处于“热备份”状态的数据库副本。首先从活动数据库创建备份：

```
backup database activedb to disk='somefile' 
```

然后在另一个 sql server 上恢复备份。如果需要，您可以使用 WITH REPLACE 选项更改默认存储目录

```
restore database warmbackup from disk='somefile'
       with norecovery, replace .... 
```

现在您可以创建日志备份并使用 restore log 语句将它们恢复到热备份。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2021-04-13T13:06:45.633

看起来你没有完成恢复任务，只对TRANSACTOINAL LOG执行恢复任务。完成后立即就好了。

# html - 我是否一直使用 .css 文件？

> ID：104550
> 
> 赞同：4
> 
> 时间：2008-09-19T18:58:58.627
> 
> 标签：html, css

是否`.css`总是需要文件？或者我可以有一个`.css`“基本”文件并在 HTML 页面中定义其他样式项？

`padding`,`borders`等等总是必须在`.css`单独存储的文件中定义，或者我可以嵌入到 HTML 页面中吗？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-09-19T19:02:06.717

技术上可以专门使用内联 CSS 格式并且没有外部样式表。您还可以在 HTML 文档中嵌入样式表。网页设计的最佳实践是将 CSS 分离到单独的样式表中。原因是 CSS 样式表的存在是为了定义文档的表示样式。HTML 文件的存在是为了定义文档的结构和内容。也许您可能有 JavaScript 文件，这些文件可以为文档添加额外的行为。

将表示、标记和行为分开可以创建更简洁的设计。

从实际的角度来看，如果你有一个外部 CSS 样式表，浏览器可以缓存它。如果您网站上的多个页面具有相同的外观和感觉，它们可以使用相同的外部样式表，只需通过网络浏览器下载一次。这将使您的网络带宽费用更低，并创造更快的最终用户体验。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-19T19:04:10.517

您可以在 HTML 页面中包含 CSS。它在`<style>`标签内，在`<head>`标签内：

```
<head>
  <style type="text/css">
    body{ background-color: blue; }
  </style>
</head> 
```

但是请注意，使用 .css 文件是最佳实践。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-19T20:12:32.693

将规则放入 HTML 页面会赋予它们更大的“特异性”，因此优先于外部规则。**如果多个 CSS 规则发生冲突，ID 优先于类，内联样式优先于 ID。**

```
<头部>
  <style type="text/css">
    span.reminder {颜色：蓝色；}
    span#themostimportant {颜色：红色;}    
  </style>
</head>
<正文>
  <span class="reminder" id="themostimportant">
    此文本将为红色。
  </span>
  <span class="reminder" id="themostimportant" style="color: green;">
    此文本将为绿色。
  </span>
</正文>

```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-19T19:00:44.817

您可以在三个级别定义 CSS，外部、嵌入文档（在 <style> 标记内）或内联元素。

根据您的需要，您可以使用所有三个，根据经验，外部工作表适合整体样式，因为您可以全局应用它们。如果您有必须处理的特定情况，则可以使用其他级别。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-19T19:01:14.017

你可以做任何一个。但是，通过将 CSS 移出到单独的文件中，它可以被缓存。这减少了您需要为每个页面传输的数据量，从而降低了带宽成本并提高了速度。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-19T19:03:05.947

您不必*将*CSS 保存在外部文件中，不。您要问的是“内联”css：通过 <style> 块直接在页面本身内包含样式指令。

有时这可能是有道理的，适度的，但总的来说[，这不是你想要的方式](http://www.communitymx.com/content/article.cfm?cid=FAF76)。将 CSS 隔离在外部样式表中可以更轻松地维护 HTML 和样式，尤其是在项目扩展和易手时。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-19T20:01:18.837

在外部文件中包含 CSS 的一大优势是**一个规则可以应用于许多不同的页面**。下面是三种 CSS 方法的对比：

**内联样式**- 要将颜色更改为蓝色，您必须找到存在红色样式的每个位置 - 可能在许多页面上。

```
<span style="color: red;">这是一个警告。</span>

```

**页面样式**- 这允许您标记**某物是什么**- 在这种情况下，是一个警告 - 而不是**它看起来像什么**。您可以通过更改页面顶部的一行代码来将页面上的所有“警告”更改为黄色背景。

```
<头部>
  <style type="text/css">
    .warning {颜色：红色；}
  </style>
<正文>
<span class="warning">这是一个警告。</span*>

```

**外部文件**- 与上面的代码相同，但样式信息位于单独文件中的事实意味着您可以在许多页面上使用“警告”类。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-19T19:00:07.563

您可以在任何地方使用，css 文件不是必需的。但是建议使用 css 文件，因为它使站点更易于维护和将来更改

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-19T19:00:13.803

不得不？不，你*可以*随心所欲。

一般来说，最好尽可能将 CSS 保留在 html 之外。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-19T19:00:19.760

这就是我通常做的。

至少在开始时。当页面设计接近最终版时，我将大部分内容移至“主要”样式.css

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-19T19:00:48.997

我更喜欢在 CSS 中保留样式，因为它将视图与演示文稿分开，让我可以相当轻松地在演示文稿之间切换。另外，它将所有信息保存在一个地方，而不是在两个地方之间拆分。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-19T20:10:59.233

css 可以提高性能，因为它们是从浏览器缓存的，而且页面更小！

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-09-30T22:17:50.853

对站点范围内使用的所有样式使用外部文件，对仅在该页面上使用的样式使用文档样式表，并在样式仅影响该单个元素时使用内联样式。

外部样式表并不总是降低带宽。如果您将站点中每个页面的每种样式都放入一个巨大的 css 文件中，那么即使用户只访问您的主页一次，他们也会产生大量的初始下载。

深思熟虑地将您的样式划分为具有最常见样式的 main.css，然后随着用户深入挖掘而划分为其他样式表，这有助于使通过站点的某些路径的下载量更小。

# database - 了解数据库复制机制的最佳来源是什么？

> ID：104554
> 
> 赞同：1
> 
> 时间：2008-09-19T18:59:30.777
> 
> 标签：database, computer-science, replication

最广泛的概述是什么？对不同复制方法和问题的最深入分析在哪里？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-19T23:04:47.130

我将从这里开始：[维基百科的复制文章](http://en.wikipedia.org/wiki/Replication_(computer_science))，然后阅读一些关于一般复制技术的相关论文，例如复制的分布式状态机方法（[Paxos](http://research.microsoft.com/users/lamport/pubs/paxos-simple.pdf) (pdf)）和流行病复制（[谷歌“用于复制数据库维护的流行病算法”](http://research.microsoft.com/users/lamport/pubs/paxos-simple.pdf)）。

对于一个实用的概述，也许可以考虑研究 Postgresql 的源代码，它似乎内置了一些复制技术。[这个演示文稿](http://www.pgcon.org/2007/schedule/events/20.en.html)声称有一些细节。

但是，鉴于您正在谈论深度分析，最好的方法是确保您对基本的分布式数据库系统问题有非常透彻的理解。[我的 Date's Introduction to Database Systems](https://rads.stackoverflow.com/amzn/click/com/0321197844)的副本中有几页是关于分布式数据库及其伴随问题的。我应该认为一本专门用于分布式数据库的教科书会有更多的细节——例如，[这本看起来很有前途。](https://rads.stackoverflow.com/amzn/click/com/0136597076)

如果您阅读 Ken Birman 关于 Virtual Synchrony 的著作以及 Leslie Lamport 曾经写过的大部分内容，您可以更深入地了解。这些将从一般分布式系统方法的角度解决问题。

祝你好运！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-19T19:19:07.640

在我看来，您应该选择一个主流数据库（例如 Oracle）并研究它提供的所有内容，然后从那里开始。

甲骨文提供：

*   复制
*   数据保护（备用数据库和超物理、逻辑）
*   真正的应用程序集群——（多个实例，一个数据库）等等！

    动手操作不会有什么坏处，因此您可以下载 PC 版本并在一台 PC 上尝试各种复制方法！

享受 ！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-24T07:39:49.513

虽然它是特定于 MS-SQL 的，但您应该查看“Pro SQL SERVER 2005 Replication”（Sujoy P. PAUL，Apress）。我欠这个家伙许多安静的夜晚……我想你可以找到这本书的一些摘录作为 PDF 文件。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-27T13:32:32.420

维基百科对此事有一些概述：

[http://en.wikipedia.org/wiki/Multi-master_replication](http://en.wikipedia.org/wiki/Multi-master_replication) [http://en.wikipedia.org/wiki/Lazy_replication](http://en.wikipedia.org/wiki/Lazy_replication)

# javascript - 从脚本中访问 Greasemonkey 元数据？

> ID：104568
> 
> 赞同：11
> 
> 时间：2008-09-19T19:01:05.767
> 
> 标签：javascript, metadata, greasemonkey

有什么方法可以让我的脚本检索在其自己的标头中声明的元数据值？我在 API 中看不到任何有希望的东西，除了`GM_getValue()`. 这当然会涉及特殊的名称语法。我试过了，例如：`GM_getValue("@name")`.

这里的动机是避免冗余规范。

如果不能直接访问 GM 元数据，也许有一种方法可以读取脚本本身的正文。它肯定在内存中的某个地方，解析它不会太难`"// @"`。（在我的情况下这可能是必要的，因为我真正感兴趣的值是`@version`，这是[userscripts.org](http://userscripts.org/)读取的扩展值。）

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-19T19:28:40.303

**此答案已过时：**截至 Greasemonkey 0.9.16（2012 年 2 月），请参阅[Brock](https://stackoverflow.com/a/10475344/1820)关于`GM_info`

* * *

是的。一个非常简单的例子是：

```
var metadata=<> 
// ==UserScript==
// @name           Reading metadata
// @namespace      http://www.afunamatata.com/greasemonkey/
// @description    Read in metadata from the header
// @version        0.9
// @include        https://stackoverflow.com/questions/104568/accessing-greasemonkey-metadata-from-within-your-script
// ==/UserScript==
</>.toString();

GM_log(metadata); 
```

有关更多信息，请参阅[greasemonkey-users 组上的此线程](http://groups.google.com/group/greasemonkey-users/browse_thread/thread/2003daba08cc14b6/62a635f278d8f9fc)。在接近尾声时可以找到更健壮的实现。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2012-05-07T00:05:35.517

使用[在`GM_info`](http://wiki.greasespot.net/GM_info)0.9.16 版本中添加到 Greasemonkey 的 object [。](http://wiki.greasespot.net/GM_info)

例如，如果您运行此脚本：

```
// ==UserScript==
// @name            _GM_info demo
// @namespace       Stack Overflow
// @description     Tell me more about me, me, ME!
// @include         http://stackoverflow.com/questions/*
// @version         8.8
// ==/UserScript==

unsafeWindow.console.clear ();
unsafeWindow.console.log (GM_info); 
```

它将输出这个对象：

```
{
    version:            (new String("0.9.18")),
    scriptWillUpdate:   false,
    script: {
        description:    "Tell me more about me, me, ME!",
        excludes:       [],
        includes:       ["http://stackoverflow.com/questions/*"],
        matches:        [],
        name:           "_GM_info demo",
        namespace:      "Stack Overflow",
        'run-at':       "document-end",
        unwrap:         false,
        version:        "8.8"
    },
    scriptMetaStr:      "// @name            _GM_info demo\r\n// @namespace       Stack Overflow\r\n// @description     Tell me more about me, me, ME!\r\n// @include         http://stackoverflow.com/questions/*\r\n// @version         8.8\r\n"
} 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-21T21:01:34.913

基于 Athena 的回答，这是我的通用解决方案，它产生一个名称/值对对象，每个对象代表一个元数据属性。请注意，某些属性可以有多个值（@include、@exclude、@require、@resource），因此我的解析器将它们捕获为数组 - 或者在 @resource 的情况下，作为名称/值对的从属对象。

```
var scriptMetadata = parseMetadata(.toString());

函数 parseMetadata(headerBlock)
{
    // 拆分行，省略那些不包含“// @”的行
    function isAGmParm(element) { return /\/\/ @/.test(element); }
    var lines = headerBlock.split(/[\r\n]+/).filter(isAGmParm);
    // 使用枚举属性的空数组初始化结果对象
    var metadata = { 包括：[]，排除：[]，需要：[]，资源：{} };
    对于每个（var line in lines）
    {
        [行、名称、值] = line.match(/\/\/@(\S+)\s*(.*)/);
        if (metadata[name] instanceof 数组)
            元数据[名称].push（值）；
        else if (metadata[name] instanceof Object) {
            [rName, rValue] = value.split(/\s+/); // 每个资源都被命名
            元数据[名称][rName] = rValue；
        }
        别的
            元数据[名称] = 值；
    }
    返回元数据；
}

// 示例用法
GM_log("版本：" + scriptMetadata["版本"]);
GM_log("res1:" + scriptMetadata["resource"]["res1"]);

```

这在我的脚本中运行良好。

编辑：添加了在 Greasemonkey 0.8.0 中引入的 @resource 和 @require。

编辑：FF5+ 兼容性，Array.filter() 不再接受正则表达式

# visual-studio - CVS 和 Visual Studio 2008 - 集成选项

> ID：104579
> 
> 赞同：3
> 
> 时间：2008-09-19T19:02:31.237
> 
> 标签：visual-studio, cvs, integration

我想稍微提高我们团队中开发人员的“舒适度”。我们正在使用 Visual Studio 2008 和 TortoiseCVS + WinCVS，但目前还没有集成。

在您的 CVS/Visual Studio 体验中，在“支持基本 CVS 功能 add/diff/update/commit/annotate/etc”、“开箱即用”、几乎“无错误”方面，最好的集成工具是什么？

*   a) 商业
*   b) 免费或开源

* * *

### 编辑：

到目前为止，我发现了 2 个商业 MSSCCI 桥接解决方案：PushOk.com 和 TamTam (daveswebsite.com)。两者都是很久以前开发的，现在只有很小的更新。作为 MSSCCI 桥接器，它们的功能有些受限，无法提供 vsPackage SCC 提供程序的所有出色功能，但总比没有好。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-11T16:13:27.167

您可能会遇到您提到的那些 MSSCCI 桥接器之一。事实上，使用 CVS 的人并不多，尤其是那些使用 Visual Studio 的人（他们中的大多数人似乎使用 Team System 的修订控制或 Subversion）。

总是有可能将您自己的宏组合在一起来处理 CVS 操作，但这有一个缺点，即无法像 SCC 提供商甚至旧桥那样为您提供真正的、深入的集成。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-19T19:23:09.660

我不了解 CVS，但如果可以选择 SVN，总会有[Ankh](http://ankhsvn.open.collab.net/)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-19T19:24:37.410

Ankh 是一个开源的选择

[http://ankhsvn.open.collab.net/](http://ankhsvn.open.collab.net/)

# iphone - iPhone SDK 是否允许硬件访问扩展坞连接器？

> ID：104583
> 
> 赞同：7
> 
> 时间：2008-09-19T19:02:59.473
> 
> 标签：iphone, hardware

到目前为止，我还没有找到任何关于通过 iPhone SDK 访问硬件的文档。我希望能够通过扩展坞连接器将信号发送到外部硬件设备，但没有看到任何证据表明可以通过 SDK 访问它（对越狱 iPhone 的可能性不感兴趣）。

任何人都对此有任何指向文档的指针，或者对我应该看什么深暗角落有一些想法？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-04T20:10:44.120

它将使用新的 SDK (3.0)：

[iPhone 操作系统配件](http://developer.apple.com/iphone/program/accessories/)

> 使用 iPhone SDK 3.0，您的应用程序可以通过 30 针基座连接器或使用蓝牙与连接到 iPhone 或 iPod touch 的附件进行通信。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-03T09:45:34.973

在 iPhone SDK 3.0 中作为外部附件框架提供

[http://developer.apple.com/iphone/program/sdk.html](http://developer.apple.com/iphone/program/sdk.html)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-04T23:05:32.593

要获得 Doc 连接器的硬件规格，您需要成为为 ipod/iphone 程序制作的一部分。但是，如果您只想与支持它的现有硬件交谈，3.0 SDK 将允许您访问它。

我曾尝试以个人/爱好者的身份申请为 ipod/iphone 制作的计划，但到目前为止，在“填写公司信息”阶段之后还没有听到任何消息。

克里斯。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-26T19:13:13.000

这属于需要与 Apple 合作才能获得特殊许可的功能范围。在，我想，一个特别的价格。

随着 3.0 版本的 iPhone 固件，这在一定程度上有所改变。如果 PyjamaSam 是正确的，那么仍然需要一些特殊的活动来获取连接器规范。

# java - 如何在 Spring Framework 2.0 中配置 ResourceBundleViewResolver

> ID：104587
> 
> 赞同：4
> 
> 时间：2008-09-19T19:03:12.673
> 
> 标签：java, spring, frameworks

我所到之处总是弹出相同的解释。
配置视图解析器。

```
<bean id="viewMappings"
      class="org.springframework.web.servlet.view.ResourceBundleViewResolver">
    <property name="basename" value="views" />
</bean> 
```

然后将一个文件放在名为 view.properties 的类路径中，其中包含一些键值对（不要介意名称）。

```
logout.class=org.springframework.web.servlet.view.JstlView
logout.url=WEB-INF/jsp/logout.jsp 
```

是什么`logout.class`意思`logout.url`？
如何`ResourceBundleViewResolver`使用文件中的键值对？
我的目标是，当有人输入 URI 时`myserver/myapp/logout.htm`，文件`logout.jsp`就会得到服务。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-19T20:45:16.593

ResourceBundleViewResolver 使用views.properties 中的key/vals 来创建视图bean（实际上是在内部应用程序上下文中创建的）。在您的示例中，视图 bean 的名称将是“logout”，它将是 JstlView 类型的 bean。JstlView 有一个名为 URL 的属性，该属性将设置为“WEB-INF/jsp/logout.jsp”。您可以以类似的方式在视图类上设置任何属性。

您似乎缺少的是您的控制器/处理程序层。如果您希望 /myapp/logout.htm 为 logout.jsp 提供服务，则必须将控制器映射到 /myapp/logout.htm 并且该控制器需要返回视图名称“logout”。然后将向 ResourceBundleViewResolver 查询该名称的 bean，并返回您的 JstlView 实例。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-19T20:56:03.960

回答您的问题`logout`是从控制器返回的 ModelAndView 对象中获取的视图名称。如果您遇到问题，您可能需要以下附加配置。

您需要`*.htm`在您的 中添加一个 servlet 映射`web.xml`：

```
    <网络应用>
        <小服务程序>
            <servlet-name>htm</servlet-name>
            <servlet-class>org.springframework.web.servlet.DispatcherServlet</servlet-class>
            <加载时启动>1</加载时启动>
        </servlet>
        <servlet 映射>
            <servlet-name>htm</servlet-name>
            <url-pattern>*.htm</url-pattern>
        </servlet-mapping>
    </web-app>

```

如果您想直接映射到`*.jsp`而不创建自定义控制器，那么您需要将以下 bean 添加到您的 Spring 上下文中：

```
    <bean id="urlFilenameController"
        class="org.springframework.web.servlet.mvc.UrlFilenameViewController" />

```

# security - 什么是安全问题的好选择？

> ID：104592
> 
> 赞同：18
> 
> 时间：2008-09-19T19:03:50.987
> 
> 标签：security, authentication, passwords

> 来自[连线](http://blog.wired.com/27bstroke6/2008/09/palin-e-mail-ha.html)杂志：
> 
> ...佩林黑客不需要任何真正的技能。取而代之的是，黑客只需使用她的出生日期、邮政编码和她在哪里认识她的配偶的信息——她的雅虎账户上的安全问题，通过简单的谷歌搜索就得到了回答（瓦西拉高），重新设置了佩林的密码。

我们不能相信此类[安全问题](http://web.archive.org/web/20130327040434/http://stackoverflow.com:80/questions/104680/what-are-some-good-security-questions)可以重置忘记的密码。
你如何设计一个更好的系统？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-09-19T19:10:55.413

所谓“安全问题”的不安全性早已为人所知。正如[布鲁斯施奈尔所说](http://www.schneier.com/blog/archives/2005/02/the_curse_of_th.html)：

> 结果是正常的安全协议（密码）退回到安全性低得多的协议（秘密问题）。整个系统的安全性受到影响。
> 
> 一个人能做什么？我通常的技巧是输入一个完全随机的答案——我疯狂地敲击键盘几秒钟——然后忘记它。这确保了一些攻击者无法绕过我的密码并试图猜测我的秘密问题的答案，但如果我忘记了密码，那将是非常不愉快的。有一次这种情况发生在我身上，我不得不打电话给公司以重置我的密码和问题。（老实说，我不记得我是如何向电话另一端的客户服务代表验证自己的身份的。）

我认为更好的技术是只发送一封带有链接的电子邮件，他们可以使用该链接为用户最初用于注册的电子邮件帐户生成一个新的随机密码。如果他们没有请求新密码，他们可以忽略它并继续使用旧密码。正如其他人指出的那样，这不一定对雅虎有帮助，因为他们正在运行电子邮件服务，但对于大多数其他服务来说，电子邮件是一种体面的身份验证措施（实际上，您将身份验证问题强加于用户的电子邮件提供商）。

当然，您可以只使用 OpenID。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2008-09-20T20:15:38.590

带外通信是要走的路。

例如，在 SMS 中发送临时密码可能是可以接受的（取决于系统）。我已经看到电信经常实现这一点，其中 SMS 便宜/免费/业务的一部分，并且用户的手机号码是预先注册的......

银行通常需要拨打/拨打特定号码的电话，但我个人对此并不太疯狂......

当然，根据系统的不同，强迫用户进入分支机构以表明自己的身份也是可行的（只是让用户非常恼火）。

最重要的是，不要创建一个较弱的通道来绕过强密码要求。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-09-19T19:44:03.183

看到很多海报建议使用电子邮件，我只能建议**不要**使用电子邮件作为您的防线。

入侵某人的电子邮件帐户可能相对容易。许多基于 Web 的电子邮件服务**也不**提供任何真正的安全性，即使它们提供 SSL，它通常也不是*默认设置* ，您仍然依靠*电子邮件*密码的弱点来保护用户（这反过来又具有最常见的重置机制时间 ）。

电子邮件是最不安全的技术之一，有*充分*的理由说明通过电子邮件发送信用卡详细信息等信息是一个非常糟糕的主意。它们通常以明文形式在服务器之间传输，同样经常地，在服务器和桌面客户端之间同样未加密，只需要通过有线嗅探来获取重置 url 并触发它。（不要说我偏执，因为银行使用SSL加密是有*充分*理由的。你怎么能相信路由上的20-200台物理设备有好意呢？）

获得重置数据后，您可以重置密码，然后更改您（他们）的电子邮件地址，并永久控制他们的帐户（这种情况一直都在发生）。

如果他们获得了您的电子邮件帐户，他们所要做的就是浏览您的收件箱以找到您订阅的对象，然后轻松重置**所有这些人的密码**

所以现在，使用基于电子邮件的安全性，可能会导致*安全*漏洞！我相信那是有益的！

被问到的问题是我认为仅靠软件几乎是不可能的。这就是为什么我们使用硬件加密狗进行 2 因素身份验证，这些硬件加密狗使用自己独特的私钥签名来响应挑战，只有当你丢失它时，你才会被搞砸，然后你必须与人打交道（哦，不）才能获得新的一个。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-09-19T19:36:52.483

它“取决于”“系统”。

*   如果您是银行或信用卡提供商，您已经向您的客户发放了一些实物令牌，您可以根据这些令牌进行验证等等。

*   如果你是一个电子商务网站，你会要求一些最近的交易——确切的金额、使用的信用卡号码等。

*   如果您像雅虎一样，我会使用的一种自动化方法是通过电话或短信向手机发送激活码以及其他一些基本问题和答案。

周杰伦

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-09-19T19:38:04.180

让用户输入 3 个问题和答案。当他们要求重置时，会向他们展示 5 个问题的下拉菜单，其中一个是他们输入的 3 个问题中的一个随机问题。然后发送确认电子邮件以实际重置密码。

当然，没有什么是真正的“黑客证明”。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-09-19T19:15:43.280

完全消除（in）安全问题。它们是如此明显的安全漏洞，以至于我实际上有点惊讶于它们花了这么长时间才制造了一个严重的（嗯，高度宣传的）事件。

在它们消失之前，我会继续告诉使用它们的网站我上过“n4weu6vyeli4u5t”高中......

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-03-28T05:19:41.830

当用户参与时（而且大多数情况下也不参与），就没有安全性；只有安全的幻觉。您对此无能为力。您可能会遇到“不太常见”的安全问题，但即使它们也很容易被利用，因为有些人将所有事情都公之于众。

电子邮件等辅助渠道为问题提供了合理的解决方案。如果用户请求重置密码，您可以通过电子邮件向他们发送密码重置令牌。正如其他人所说，仍然不完美，但利用这一点需要攻击者位于网站、其 MTA 和用户 MUA 之间的视线范围内。这在技术上很容易，但我建议现实是，除了非常知名的个人之外，他们要打扰任何人都需要太多的工作/风险。

要求用户在创建帐户时提供 SSL 或 GPG 公钥将有很大帮助，但无知的用户不会知道这些东西是什么，更不用说能够保持他们的私钥安全和备份，以免丢失它们.

要求用户提供第二个紧急密码（类似于手机 SIM 卡上的 PIN/PUK）可能会有所帮助，但用户可能会使用相同的密码两次或忘记第二个密码。

简短的回答，你是 SOL，除非你想对用户进行安全教育，然后用线索打击他们，直到他们意识到有必要确保安全，并且少量的额外工作不仅仅是让他们感到痛苦屁股。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-09-19T19:09:47.507

通过发送电子邮件对所有内容进行身份验证是一种相当有效的解决方案。（尽管在这种情况下，这对雅虎来说可能不可行:)）。

与其用安全问题或其他方法来恢复密码，不如简单地通过向带有授权链接的预定义电子邮件帐户发送电子邮件来响应密码恢复请求。从那里您可以更改密码，或者您需要做的任何事情（尽管永远不要发送密码 - 您应该始终将其存储为盐渍哈希，始终更改它。然后，如果电子邮件帐户已被盗用，至少有一些迹象表明其他服务已被访问的用户）

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-09-19T19:10:40.830

真正的答案是，没有万无一失的方法可以阻止黑客。我讨厌安全问题，但如果您要使用它们，请允许用户定义安全问题。作为用户，如果我必须在网站上设置安全问题来设置帐户，我真的很喜欢能够设置自己的安全问题，以便我可以提出只有我知道如何回答的问题。在这种情况下，它甚至不必是一个真正的问题。但是用户帐户与用户的愚蠢一样安全，而且许多用户会使用诸如“问题？”之类的东西。和“回答！” 或同样愚蠢的东西。您无法将用户从自己的愚蠢中拯救出来。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2008-09-19T19:41:13.080

将这些安全问题视为实际上是两因素身份验证是完全误导的。从之前阅读的虚假项目来看，当某些（银行）网站被要求进行“双因素身份验证”时，他们开始将其作为一种*廉价*的方式来实现。布鲁斯·施奈尔 (Bruce Schneier) [前一段时间][1] 谈到了这一点。

多重因素是不一样的最好的东西。它不应该是你“知道”的所有东西，而是你知道的东西和你拥有的东西等等。这就是硬件身份验证令牌、智能卡和其他此类设备发挥作用的地方。

[1]：[http](http://www.schneier.com/blog/archives/2005/03/the_failure_of.html) ://www.schneier.com/blog/archives/2005/03/the_failure_of.html双重认证失败

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-09-19T19:10:45.633

当它不是电子邮件系统时，通过电子邮件向他们发送指向安全页面的链接，其中包含必须在查询字符串中返回的哈希以重置密码。

然后，如果有人试图重置您的密码，您就会知道，他们可能无法猜测哈希值。

我们使用 2 个 guid 相乘，以十六进制表示。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2008-09-19T19:12:18.483

好吧，它不应该直接重置密码，而是发送一封电子邮件，其中包含重置密码的链接。这样她就会收到电子邮件并知道不是她发起了重置，并且她的问题/答案已被泄露。

在电子邮件地址不再有效的情况下，它应该等待超时（几天或一周），然后才允许将新电子邮件附加到帐户。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2008-09-19T19:12:38.220

向不同的电子邮件帐户发送消息，或者给他们的手机发短信，或者给他们打电话，或者发送一个蜗牛邮件消息。任何不涉及随时可能改变的公共记录或偏好的事项。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2009-03-28T04:56:57.313

好的安全问题是用词不当。他们实际上在系统中创建了一个漏洞。我们应该称它们为不安全问题。然而，认识到它们提供的风险和价值，“好的”安全问题应该具有 4 个特征：1\. 不容易被猜测或研究（安全），2\. 不会​​随时间变化（稳定），3\. 令人难忘，4 . 是确定的或简单的。[您可以在http://www.goodsecurityquestions.com](http://www.goodsecurityquestions.com)阅读更多相关信息。

下面列出了[良好、公平和差的安全问题](http://goodsecurityquestions.com/examples.htm)。

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2012-12-07T13:35:03.513

IMO 秘密问题只能用作系统的一部分，具有时间限制的非常弱的控制。例如：密码重置系统。

1.  您已通过身份验证。注册您的手机号码和您的秘密（不是那么秘密）答案。

2.  您忘记了密码。

3.  您请求解锁。

a) 您的“不那么秘密”问题要求您提供“不那么秘密的答案”。b) 如果正确，将向预先注册的手机发送一条短信。

这样，如果您的手机被盗，并且手机上的 pin/lock 等控件也不起作用。在报告手机丢失/被盗并且可以禁用之前，您仍然可以对攻击者进行一定程度的混淆以重置密码。

这种用法是我认为“不那么秘密”问题/答案的唯一目的。

所以我会争辩说，在这个世界上他们有一席之地，通常需要一个系统来讨论。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2008-09-19T19:09:29.677

只提供不在公共记录中的问题。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2008-09-19T19:11:03.730

总是将密码重置发送到注册的电子邮件帐户（这对于电子邮件帐户来说很棘手）或将 PIN 码发送到注册的手机，或指向 IM 地址的链接等 - 基本上，在注册时捕获一些辅助联系信息和用它来发送“密码重置”链接。

永远不要让任何人直接更改他们的密码，始终确保他们完成额外的步骤。

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2008-09-19T19:21:40.537

我更喜欢保持简单并使用荣誉系统方法。例如，我将向用户展示类似的内容，

> **这真的是你？** **选择：是或否**。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2014-05-16T04:57:57.020

如何要求用户输入他们自己的安全问题和答案，以及第二封电子邮件（不是发送密码重置链接的电子邮件）。将散列的安全问题和答案存储在数据库中，以实现额外的安全步骤。

如果用户忘记了他/她的密码，请将**密码重置链接**发送到用户的**主电子邮件**。然后用户点击重定向的链接并询问安全问题和答案。如果此步骤成功，则允许用户重置他/她的密码。如果用户忘记了安全问题/答案，请发送链接以**将安全问题/答案重置**到用户的**辅助电子邮件**。

如果攻击者获得了其中一封电子邮件的访问权限，那么如果无法访问另一封电子邮件，它仍然是无用的（攻击者不太可能同时访问这两个电子邮件）。我知道这个过程需要开发人员和用户做很多额外的工作，但我认为这是值得的。（也许我们可以给用户一个推荐的选项来激活安全问题/答案，如果他们需要这种额外的安全性。）

底线是，这个系统的工作强度和强度在很大程度上取决于用户。安全问题/答案的强度以及两封电子邮件“解绑”的程度（即，无法通过另一封电子邮件访问）将决定该系统的强度。

我不知道这种方式是否有任何问题，但如果有的话，如果有人能指出这些我会很高兴:)

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2010-03-02T10:40:06.700

生成一个包含此人的用户名和密码的哈希，并通过 Https 将其作为文件发送给用户。用户将文件保存到磁盘。他们有责任将此文件存储在安全位置。或者，您可以将其发送到他们的电子邮件地址，但这会降低安全性。如果用户忘记了他们的登录凭据，他们必须上传此文件。一旦服务器验证了用户名和密码，他们就会看到一个对话框来更改他们的密码。

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2019-02-07T09:59:52.837

由于社交媒体的发展，网站提出的安全问题太容易破解。由于大多数问题都是个人信息，这些信息很容易在社交媒体平台上获得。避免帐户被盗的一种替代方法是对登录进行严格的密码规则，例如添加特殊字符、数字、大写字母等。这些密码很难解码，可以在很大程度上提高安全性。但是有新的替代方法，如多因素身份验证、无密码登录、短信身份验证等。短信身份验证是多因素身份验证的一部分，用户在他/她的手机上提供了一个 OTP，他/她需要按顺序输入登录网站。这是一种安全的方式，因为移动设备的访问仅限于（大部分）用户。另一种多因素身份验证方法是将验证链接发送到电子邮件以完成登录过程。关于这个主题有一个写得很好的博客以详细方式解释此概念的[媒体。](https://medium.com/@yashrathi29/alternatives-to-security-questions-ee48e46edb5b)

# java - 对可能包含数字的字符串进行排序

> ID：104599
> 
> 赞同：84
> 
> 时间：2008-09-19T19:05:21.060
> 
> 标签：java, algorithm, string, sorting, comparison

我需要编写一个比较字符串的 Java Comparator 类，但是有一个转折点。如果它要比较的两个字符串在字符串的开头和结尾相同，并且中间不同的部分是整数，则根据这些整数的数值进行比较。例如，我希望以下字符串按显示顺序结束：

*   啊啊啊
*   bbb 3 cc
*   bbb 12 cc
*   ccc 11
*   ddd
*   eee 3 ddd jpeg2000 eee
*   eee 12 ddd jpeg2000 eee

如您所见，字符串中可能还有其他整数，所以我不能只使用正则表达式来分解任何整数。我正在考虑从头开始遍历字符串，直到找到不匹配的位，然后从末尾走进直到找到不匹配的位，然后将中间的位与正则表达式“[0-9]+”，如果比较，则进行数值比较，否则进行词法比较。

有没有更好的办法？

**更新**我认为我不能保证字符串中的其他数字（可能匹配的数字）周围没有空格，或者不同的数字确实有空格。

* * *

## 回答 #1

> 赞同：107
> 
> 时间：2008-09-19T19:17:14.230

[字母算法](http://www.davekoelle.com/alphanum.html)

从网站

“人们用数字排序字符串的方式与软件不同。大多数排序算法都会比较 ASCII 值，这会产生与人类逻辑不一致的排序。下面是解决方法。”

编辑：这是来自该站点的[Java 比较器实现的链接。](http://www.davekoelle.com/files/AlphanumComparator.java)

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-09-19T21:12:42.050

有趣的小挑战，我喜欢解决它。

这是我对这个问题的看法：

```
String[] strs =
{
  "eee 5 ddd jpeg2001 eee",
  "eee 123 ddd jpeg2000 eee",
  "ddd",
  "aaa 5 yy 6",
  "ccc 555",
  "bbb 3 ccc",
  "bbb 9 a",
  "",
  "eee 4 ddd jpeg2001 eee",
  "ccc 11",
  "bbb 12 ccc",
  "aaa 5 yy 22",
  "aaa",
  "eee 3 ddd jpeg2000 eee",
  "ccc 5",
};

Pattern splitter = Pattern.compile("(\\d+|\\D+)");

public class InternalNumberComparator implements Comparator
{
  public int compare(Object o1, Object o2)
  {
    // I deliberately use the Java 1.4 syntax, 
    // all this can be improved with 1.5's generics
    String s1 = (String)o1, s2 = (String)o2;
    // We split each string as runs of number/non-number strings
    ArrayList sa1 = split(s1);
    ArrayList sa2 = split(s2);
    // Nothing or different structure
    if (sa1.size() == 0 || sa1.size() != sa2.size())
    {
      // Just compare the original strings
      return s1.compareTo(s2);
    }
    int i = 0;
    String si1 = "";
    String si2 = "";
    // Compare beginning of string
    for (; i < sa1.size(); i++)
    {
      si1 = (String)sa1.get(i);
      si2 = (String)sa2.get(i);
      if (!si1.equals(si2))
        break;  // Until we find a difference
    }
    // No difference found?
    if (i == sa1.size())
      return 0; // Same strings!

    // Try to convert the different run of characters to number
    int val1, val2;
    try
    {
      val1 = Integer.parseInt(si1);
      val2 = Integer.parseInt(si2);
    }
    catch (NumberFormatException e)
    {
      return s1.compareTo(s2);  // Strings differ on a non-number
    }

    // Compare remainder of string
    for (i++; i < sa1.size(); i++)
    {
      si1 = (String)sa1.get(i);
      si2 = (String)sa2.get(i);
      if (!si1.equals(si2))
      {
        return s1.compareTo(s2);  // Strings differ
      }
    }

    // Here, the strings differ only on a number
    return val1 < val2 ? -1 : 1;
  }

  ArrayList split(String s)
  {
    ArrayList r = new ArrayList();
    Matcher matcher = splitter.matcher(s);
    while (matcher.find())
    {
      String m = matcher.group(1);
      r.add(m);
    }
    return r;
  }
}

Arrays.sort(strs, new InternalNumberComparator()); 
```

这个算法需要更多的测试，但它似乎表现得相当好。

[编辑] 我添加了更多评论以更清楚。我发现答案比我开始编写代码时要多得多……但我希望我提供了一个良好的起点和/或一些想法。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-09-19T19:23:38.067

Microsoft 的 Ian Griffiths 有一个他称之为[Natural Sorting](http://www.interact-sw.co.uk/iangblog/2007/12/13/natural-sorting)的 C# 实现。移植到 Java 应该相当容易，比从 C 移植更容易！

**更新：**[eekboom](http://www.eekboom.com/java/compareNatural/src/com/eekboom/utils/Strings.java)上似乎有一个 Java 示例可以执行此操作，请参阅“compareNatural”并将其用作排序比较器。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2014-12-17T16:51:01.960

我在这里提出的实现简单而高效。它不会直接或间接地通过使用正则表达式或方法（如 substring()、split()、toCharArray() 等）分配任何额外的内存。

此实现首先遍历两个字符串以最大速度搜索不同的第一个字符，在此期间不进行任何特殊处理。只有当这些字符都是数字时才会触发特定数字比较。这个实现的副作用是一个数字被认为大于其他字母，这与默认的字典顺序相反。

```
public static final int compareNatural (String s1, String s2)
{
   // Skip all identical characters
   int len1 = s1.length();
   int len2 = s2.length();
   int i;
   char c1, c2;
   for (i = 0, c1 = 0, c2 = 0; (i < len1) && (i < len2) && (c1 = s1.charAt(i)) == (c2 = s2.charAt(i)); i++);

   // Check end of string
   if (c1 == c2)
      return(len1 - len2);

   // Check digit in first string
   if (Character.isDigit(c1))
   {
      // Check digit only in first string 
      if (!Character.isDigit(c2))
         return(1);

      // Scan all integer digits
      int x1, x2;
      for (x1 = i + 1; (x1 < len1) && Character.isDigit(s1.charAt(x1)); x1++);
      for (x2 = i + 1; (x2 < len2) && Character.isDigit(s2.charAt(x2)); x2++);

      // Longer integer wins, first digit otherwise
      return(x2 == x1 ? c1 - c2 : x1 - x2);
   }

   // Check digit only in second string
   if (Character.isDigit(c2))
      return(-1);

   // No digits
   return(c1 - c2);
} 
```

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2017-07-19T11:22:19.023

我使用正则表达式在 Java 中提出了一个非常简单的实现：

```
public static Comparator<String> naturalOrdering() {
    final Pattern compile = Pattern.compile("(\\d+)|(\\D+)");
    return (s1, s2) -> {
        final Matcher matcher1 = compile.matcher(s1);
        final Matcher matcher2 = compile.matcher(s2);
        while (true) {
            final boolean found1 = matcher1.find();
            final boolean found2 = matcher2.find();
            if (!found1 || !found2) {
                return Boolean.compare(found1, found2);
            } else if (!matcher1.group().equals(matcher2.group())) {
                if (matcher1.group(1) == null || matcher2.group(1) == null) {
                    return matcher1.group().compareTo(matcher2.group());
                } else {
                    return Integer.valueOf(matcher1.group(1)).compareTo(Integer.valueOf(matcher2.group(1)));
                }
            }
        }
    };
} 
```

下面是它的工作原理：

```
final List<String> strings = Arrays.asList("x15", "xa", "y16", "x2a", "y11", "z", "z5", "x2b", "z");
strings.sort(naturalOrdering());
System.out.println(strings); 
```

> [x2a，x2b，x15，xa，y11，y16，z，z，z5]

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-09-19T19:18:11.137

我知道您使用的是 java，但您可以看看 StrCmpLogicalW 的工作原理。这是资源管理器用来在 Windows 中对文件名进行排序的方法。您可以在[此处](http://source.winehq.org/source/dlls/shlwapi/string.c#L2113)查看 WINE 实现。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-09-19T19:07:53.503

将字符串拆分为字母和数字的运行，因此“foo 12 bar”成为列表（“foo”，12，“bar”），然后使用列表作为排序键。这样，数字将按数字顺序排列，而不是按字母顺序排列。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2019-10-05T15:57:39.967

这是与 Alphanum 算法相比具有以下优势的解决方案：

1.  快 3.25 倍（根据[Alphanum 描述](http://www.davekoelle.com/alphanum.html)的“尾声”一章的数据进行测试）
2.  不消耗额外内存（无字符串拆分，无数字解析）
3.  正确处理前导零（例如`"0001"`等于`"1"`、`"01234"`小于`"4567"`）

```
public class NumberAwareComparator implements Comparator<String>
{
    @Override
    public int compare(String s1, String s2)
    {
        int len1 = s1.length();
        int len2 = s2.length();
        int i1 = 0;
        int i2 = 0;
        while (true)
        {
            // handle the case when one string is longer than another
            if (i1 == len1)
                return i2 == len2 ? 0 : -1;
            if (i2 == len2)
                return 1;

            char ch1 = s1.charAt(i1);
            char ch2 = s2.charAt(i2);
            if (Character.isDigit(ch1) && Character.isDigit(ch2))
            {
                // skip leading zeros
                while (i1 < len1 && s1.charAt(i1) == '0')
                    i1++;
                while (i2 < len2 && s2.charAt(i2) == '0')
                    i2++;

                // find the ends of the numbers
                int end1 = i1;
                int end2 = i2;
                while (end1 < len1 && Character.isDigit(s1.charAt(end1)))
                    end1++;
                while (end2 < len2 && Character.isDigit(s2.charAt(end2)))
                    end2++;

                int diglen1 = end1 - i1;
                int diglen2 = end2 - i2;

                // if the lengths are different, then the longer number is bigger
                if (diglen1 != diglen2)
                    return diglen1 - diglen2;

                // compare numbers digit by digit
                while (i1 < end1)
                {
                    if (s1.charAt(i1) != s2.charAt(i2))
                        return s1.charAt(i1) - s2.charAt(i2);
                    i1++;
                    i2++;
                }
            }
            else
            {
                // plain characters comparison
                if (ch1 != ch2)
                    return ch1 - ch2;
                i1++;
                i2++;
            }
        }
    }
} 
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2020-11-17T17:20:29.297

[我建议不要重新发明轮子，而是使用具有来自ICU4J 库](https://unicode-org.github.io/icu-docs/apidoc/released/icu4j/com/ibm/icu/text/RuleBasedCollator.html#setNumericCollation-boolean-)的内置数字排序的区域设置感知 Unicode 兼容字符串比较器。

```
import com.ibm.icu.text.Collator;
import com.ibm.icu.text.RuleBasedCollator;

import java.util.Arrays;
import java.util.List;
import java.util.Locale;

public class CollatorExample {
    public static void main(String[] args) {
        // Make sure to choose correct locale: in Turkish uppercase of "i" is "İ", not "I"
        RuleBasedCollator collator = (RuleBasedCollator) Collator.getInstance(Locale.US);
        collator.setNumericCollation(true); // Place "10" after "2"
        collator.setStrength(Collator.PRIMARY); // Case-insensitive
        List<String> strings = Arrays.asList("10", "20", "A20", "2", "t1ab", "01", "T010T01", "t1aB",
            "_2", "001", "_200", "1", "A 02", "t1Ab", "a2", "_1", "t1A", "_01",
            "100", "02", "T0010T01", "t1AB", "10", "A01", "010", "t1a"
        );
        strings.sort(collator);
        System.out.println(String.join(", ", strings));
        // Output: _1, _01, _2, _200, 01, 001, 1,
        // 2, 02, 10, 10, 010, 20, 100, A 02, A01, 
        // a2, A20, t1A, t1a, t1ab, t1aB, t1Ab, t1AB,
        // T010T01, T0010T01
    }
} 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2011-05-19T23:57:59.650

[Alphanum](http://www.davekoelle.com/alphanum.html) algrothim 很好，但它不符合我正在从事的项目的要求。我需要能够正确排序负数和小数。这是我提出的实现。任何反馈将不胜感激。

```
public class StringAsNumberComparator implements Comparator<String> {

    public static final Pattern NUMBER_PATTERN = Pattern.compile("(\\-?\\d+\\.\\d+)|(\\-?\\.\\d+)|(\\-?\\d+)");

    /**
     * Splits strings into parts sorting each instance of a number as a number if there is
     * a matching number in the other String.
     * 
     * For example A1B, A2B, A11B, A11B1, A11B2, A11B11 will be sorted in that order instead
     * of alphabetically which will sort A1B and A11B together.
     */
    public int compare(String str1, String str2) {
        if(str1 == str2) return 0;
        else if(str1 == null) return 1;
        else if(str2 == null) return -1;

        List<String> split1 = split(str1);
        List<String> split2 = split(str2);
        int diff = 0;

        for(int i = 0; diff == 0 && i < split1.size() && i < split2.size(); i++) {
            String token1 = split1.get(i);
            String token2 = split2.get(i);

            if((NUMBER_PATTERN.matcher(token1).matches() && NUMBER_PATTERN.matcher(token2).matches()) {
                diff = (int) Math.signum(Double.parseDouble(token1) - Double.parseDouble(token2));
            } else {
                diff = token1.compareToIgnoreCase(token2);
            }
        }
        if(diff != 0) {
            return diff;
        } else {
            return split1.size() - split2.size();
        }
    }

    /**
     * Splits a string into strings and number tokens.
     */
    private List<String> split(String s) {
        List<String> list = new ArrayList<String>();
        try (Scanner scanner = new Scanner(s)) {
            int index = 0;
            String num = null;
            while ((num = scanner.findInLine(NUMBER_PATTERN)) != null) {
                int indexOfNumber = s.indexOf(num, index);
                if (indexOfNumber > index) {
                    list.add(s.substring(index, indexOfNumber));
                }
                list.add(num);
                index = indexOfNumber + num.length();
            }
            if (index < s.length()) {
                list.add(s.substring(index));
            }
        }
        return list;
    }
} 
```

PS。我想使用 java.lang.String.split() 方法并使用“lookahead/lookbehind”来保留标记，但我无法让它与我正在使用的正则表达式一起工作。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2012-07-21T22:13:02.250

有趣的问题，这里是我提出的解决方案：

```
import java.util.Collections;
import java.util.Vector;

public class CompareToken implements Comparable<CompareToken>
{
    int valN;
    String valS;
    String repr;

    public String toString() {
    return repr;
    }

    public CompareToken(String s) {
    int l = 0;
    char data[] = new char[s.length()];
    repr = s;
    valN = 0;
    for (char c : s.toCharArray()) {
        if(Character.isDigit(c))
        valN = valN * 10 + (c - '0');
        else
        data[l++] = c;
    }

    valS = new String(data, 0, l);
    }

    public int compareTo(CompareToken b) {
    int r = valS.compareTo(b.valS);
    if (r != 0)
        return r;

    return valN - b.valN;
    }

    public static void main(String [] args) {
    String [] strings = {
        "aaa",
        "bbb3ccc",
        "bbb12ccc",
        "ccc 11",
        "ddd",
        "eee3dddjpeg2000eee",
        "eee12dddjpeg2000eee"
    };

    Vector<CompareToken> data = new Vector<CompareToken>();
    for(String s : strings)
        data.add(new CompareToken(s));
    Collections.shuffle(data);

    Collections.sort(data);
    for (CompareToken c : data)
        System.out.println ("" + c);
    }

} 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2014-07-25T05:59:12.907

在发现这个线程之前，我在 javascript 中实现了一个类似的解决方案。尽管语法不同，也许我的策略会很好地找到您。与上面类似，我解析正在比较的两个字符串，并将它们都拆分为数组，将字符串划分为连续数字。

```
...
var regex = /(\d+)/g,
    str1Components = str1.split(regex),
    str2Components = str2.split(regex),
... 
```

即'hello22goodbye 33' => ['hello', 22, 'goodbye', 33]; 因此，您可以在 string1 和 string2 之间成对地遍历数组的元素，进行一些类型强制（例如，该元素真的是数字吗？），并在遍历时进行比较。

这里的工作示例：http: [//jsfiddle.net/F46s6/3/](http://jsfiddle.net/F46s6/3/)

注意，我目前只支持整数类型，虽然处理十进制值不会太难修改。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2015-06-07T14:53:23.183

我的 2 美分。对我来说效果很好。我主要将它用于文件名。

```
 private final boolean isDigit(char ch)
        {
            return ch >= 48 && ch <= 57;
        }

        private int compareNumericalString(String s1,String s2){

            int s1Counter=0;
            int s2Counter=0;
            while(true){
                if(s1Counter>=s1.length()){
                    break;
                }
                if(s2Counter>=s2.length()){
                    break;
                }
                char currentChar1=s1.charAt(s1Counter++);
                char currentChar2=s2.charAt(s2Counter++);
                if(isDigit(currentChar1) &&isDigit(currentChar2)){
                    String digitString1=""+currentChar1;
                    String digitString2=""+currentChar2;
                    while(true){
                        if(s1Counter>=s1.length()){
                            break;
                        }
                        if(s2Counter>=s2.length()){
                            break;
                        }

                        if(isDigit(s1.charAt(s1Counter))){
                            digitString1+=s1.charAt(s1Counter);
                            s1Counter++;
                        }

                        if(isDigit(s2.charAt(s2Counter))){
                            digitString2+=s2.charAt(s2Counter);
                            s2Counter++;
                        }

                        if((!isDigit(s1.charAt(s1Counter))) && (!isDigit(s2.charAt(s2Counter)))){
                            currentChar1=s1.charAt(s1Counter);
                            currentChar2=s2.charAt(s2Counter);
                            break;
                        }
                    }
                    if(!digitString1.equals(digitString2)){
                        return Integer.parseInt(digitString1)-Integer.parseInt(digitString2);
                    }
                }

                if(currentChar1!=currentChar2){
                    return currentChar1-currentChar2;
                }

            }
            return s1.compareTo(s2);
        } 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2019-09-07T20:09:31.963

我创建了一个[项目](https://github.com/ChristianLutz/natural-order-benchmark)来比较不同的实现。它远未完成，但它是一个起点。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2020-03-08T14:57:27.960

[补充](https://stackoverflow.com/users/2556378/stanislav)@stanislav的[答案](https://stackoverflow.com/a/58249974/13027997)。我在使用提供的答案时遇到的一些问题是：

1.  大写和小写字母由它们的 ASCII 代码之间的字符分隔。当正在排序的字符串具有 _ 或其他介于 ASCII 小写字母和大写字母之间的字符时，这会中断流程。
2.  如果除了前导零计数不同之外，两个字符串相同，则函数返回 0，这将使排序取决于字符串在列表中的原始位置。

这两个问题已在新代码中得到修复。我做了一些函数而不是一些重复的代码集。differentCaseCompared 变量跟踪两个字符串是否相同，除了大小写不同。如果是这样，则返回减去的第一个不同大小写字符的值。这样做是为了避免两个字符串因大小写不同而返回为 0 的问题。

```
 public class NaturalSortingComparator implements Comparator<String> {

    @Override
    public int compare(String string1, String string2) {
        int lengthOfString1 = string1.length();
        int lengthOfString2 = string2.length();
        int iteratorOfString1 = 0;
        int iteratorOfString2 = 0;
        int differentCaseCompared = 0;
        while (true) {
            if (iteratorOfString1 == lengthOfString1) {
                if (iteratorOfString2 == lengthOfString2) {
                    if (lengthOfString1 == lengthOfString2) {
                        // If both strings are the same except for the different cases, the differentCaseCompared will be returned
                        return differentCaseCompared;
                    }
                    //If the characters are the same at the point, returns the difference between length of the strings
                    else {
                        return lengthOfString1 - lengthOfString2;
                    }
                }
                //If String2 is bigger than String1
                else
                    return -1;
            }
            //Check if String1 is bigger than string2
            if (iteratorOfString2 == lengthOfString2) {
                return 1;
            }

            char ch1 = string1.charAt(iteratorOfString1);
            char ch2 = string2.charAt(iteratorOfString2);

            if (Character.isDigit(ch1) && Character.isDigit(ch2)) {
                // skip leading zeros
                iteratorOfString1 = skipLeadingZeroes(string1, lengthOfString1, iteratorOfString1);
                iteratorOfString2 = skipLeadingZeroes(string2, lengthOfString2, iteratorOfString2);

                // find the ends of the numbers
                int endPositionOfNumbersInString1 = findEndPositionOfNumber(string1, lengthOfString1, iteratorOfString1);
                int endPositionOfNumbersInString2 = findEndPositionOfNumber(string2, lengthOfString2, iteratorOfString2);

                int lengthOfDigitsInString1 = endPositionOfNumbersInString1 - iteratorOfString1;
                int lengthOfDigitsInString2 = endPositionOfNumbersInString2 - iteratorOfString2;

                // if the lengths are different, then the longer number is bigger
                if (lengthOfDigitsInString1 != lengthOfDigitsInString2)
                    return lengthOfDigitsInString1 - lengthOfDigitsInString2;

                // compare numbers digit by digit
                while (iteratorOfString1 < endPositionOfNumbersInString1) {

                    if (string1.charAt(iteratorOfString1) != string2.charAt(iteratorOfString2))
                        return string1.charAt(iteratorOfString1) - string2.charAt(iteratorOfString2);

                    iteratorOfString1++;
                    iteratorOfString2++;
                }
            } else {
                // plain characters comparison
                if (ch1 != ch2) {
                    if (!ignoreCharacterCaseEquals(ch1, ch2))
                        return Character.toLowerCase(ch1) - Character.toLowerCase(ch2);

                    // Set a differentCaseCompared if the characters being compared are different case.
                    // Should be done only once, hence the check with 0
                    if (differentCaseCompared == 0) {
                        differentCaseCompared = ch1 - ch2;
                    }
                }

                iteratorOfString1++;
                iteratorOfString2++;
            }
        }
    }

    private boolean ignoreCharacterCaseEquals(char character1, char character2) {

        return Character.toLowerCase(character1) == Character.toLowerCase(character2);
    }

    private int findEndPositionOfNumber(String string, int lengthOfString, int end) {

        while (end < lengthOfString && Character.isDigit(string.charAt(end)))
            end++;

        return end;
    }

    private int skipLeadingZeroes(String string, int lengthOfString, int iteratorOfString) {

        while (iteratorOfString < lengthOfString && string.charAt(iteratorOfString) == '0')
            iteratorOfString++;

        return iteratorOfString;
    }
} 
```

以下是我使用的单元测试。

```
 public class NaturalSortingComparatorTest {

    private int NUMBER_OF_TEST_CASES = 100000;

    @Test
    public void compare() {

        NaturalSortingComparator naturalSortingComparator = new NaturalSortingComparator();

        List<String> expectedStringList = getCorrectStringList();
        List<String> testListOfStrings = createTestListOfStrings();
        runTestCases(expectedStringList, testListOfStrings, NUMBER_OF_TEST_CASES, naturalSortingComparator);

    }

    private void runTestCases(List<String> expectedStringList, List<String> testListOfStrings,
                              int numberOfTestCases, Comparator<String> comparator) {

        for (int testCase = 0; testCase < numberOfTestCases; testCase++) {
            Collections.shuffle(testListOfStrings);
            testListOfStrings.sort(comparator);
            Assert.assertEquals(expectedStringList, testListOfStrings);
        }
    }

    private List<String> getCorrectStringList() {
        return Arrays.asList(
                "1", "01", "001", "2", "02", "10", "10", "010",
                "20", "100", "_1", "_01", "_2", "_200", "A 02",
                "A01", "a2", "A20", "t1A", "t1a", "t1AB", "t1Ab",
                "t1aB", "t1ab", "T010T01", "T0010T01");
    }

    private List<String> createTestListOfStrings() {
        return Arrays.asList(
                "10", "20", "A20", "2", "t1ab", "01", "T010T01", "t1aB",
                "_2", "001", "_200", "1", "A 02", "t1Ab", "a2", "_1", "t1A", "_01",
                "100", "02", "T0010T01", "t1AB", "10", "A01", "010", "t1a");
    }

} 
```

欢迎提出建议！我不确定添加这些功能是否会改变除了可读性部分之外的任何东西。

PS：很抱歉为这个问题添加另一个答案。但是我没有足够的代表来评论我为我使用而修改的答案。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-09-19T19:15:28.663

我认为您必须逐个字符地进行比较。抓取一个字符，如果是数字字符，继续抓取，然后将字符重新组合成单​​个数字字符串并将其转换为`int`. 在另一个字符串上重复，然后才进行比较。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2008-09-19T19:45:38.390

简短回答：根据上下文，我无法判断这只是一些供个人使用的快速而肮脏的代码，还是高盛最新内部会计软件的关键部分，所以我会说：eww . 这是一个相当时髦的排序算法。如果可以的话，尝试使用一些不那么“曲折”的东西。

长答案：

在您的案例中立即想到的两个问题是性能和正确性。非正式地，确保它很快，并确保你的算法是[全排序](http://en.wikipedia.org/wiki/Total_order)的。

（当然，如果你排序的项目不超过 100 个，你可以忽略这一段。）性能很重要，因为比较器的速度将是排序速度的最大因素（假设排序算法是“理想”到典型列表）。在您的情况下，比较器的速度将主要取决于字符串的大小。字符串似乎相当短，因此它们可能不会像列表的大小那样占主导地位。

将每个字符串转换为字符串-数字-字符串元组，然后按照另一个答案中的建议对这个元组列表进行排序，在某些情况下会失败，因为您显然会出现带有多个数字的字符串。

另一个问题是正确性。具体来说，如果您描述的算法将允许 A > B > ... > A，那么您的排序将是不确定的。在你的情况下，我担心它可能会，尽管我无法证明这一点。考虑一些解析案例，例如：

```
 aa 0 aa
  aa 23aa
  aa 2a3aa
  aa 113aa
  aa 113 aa
  a 1-2 a
  a 13 a
  a 12 a
  a 2-3 a
  a 21 a
  a 2.3 a 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2016-05-03T12:11:19.123

尽管问题询问了 java 解决方案，但对于任何想要 scala 解决方案的人来说：

```
object Alphanum {

   private[this] val regex = "((?<=[0-9])(?=[^0-9]))|((?<=[^0-9])(?=[0-9]))"

   private[this] val alphaNum: Ordering[String] = Ordering.fromLessThan((ss1: String, ss2: String) => (ss1, ss2) match {
     case (sss1, sss2) if sss1.matches("[0-9]+") && sss2.matches("[0-9]+") => sss1.toLong < sss2.toLong
     case (sss1, sss2) => sss1 < sss2
   })

   def ordering: Ordering[String] = Ordering.fromLessThan((s1: String, s2: String) => {
     import Ordering.Implicits.infixOrderingOps
     implicit val ord: Ordering[List[String]] = Ordering.Implicits.seqDerivedOrdering(alphaNum)

     s1.split(regex).toList < s2.split(regex).toList
   })

} 
```

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2018-11-09T15:38:32.430

我的问题是我的列表由字母数字字符串（例如 C22、C3、C5 等）、字母字符串（例如 A、H、R 等）和仅需要排序的数字（例如 99、45 等）组成顺序 A、C3、C5、C22、H、R、45、99。我也有需要删除的重复项，所以我只得到一个条目。

我也不只是使用字符串，我正在订购一个对象并使用对象中的特定字段来获得正确的顺序。

似乎对我有用的解决方案是：

```
SortedSet<Code> codeSet;
codeSet = new TreeSet<Code>(new Comparator<Code>() {

private boolean isThereAnyNumber(String a, String b) {
    return isNumber(a) || isNumber(b);
}

private boolean isNumber(String s) {
    return s.matches("[-+]?\\d*\\.?\\d+");
}

private String extractChars(String s) {
    String chars = s.replaceAll("\\d", "");
    return chars;
}

private int extractInt(String s) {
    String num = s.replaceAll("\\D", "");
    return num.isEmpty() ? 0 : Integer.parseInt(num);
}

private int compareStrings(String o1, String o2) {

    if (!extractChars(o1).equals(extractChars(o2))) {
        return o1.compareTo(o2);
    } else
        return extractInt(o1) - extractInt(o2);
}

@Override
public int compare(Code a, Code b) {

    return isThereAnyNumber(a.getPrimaryCode(), b.getPrimaryCode()) 
            ? isNumber(a.getPrimaryCode()) ? 1 : -1 
                : compareStrings(a.getPrimaryCode(), b.getPrimaryCode());
                }
            }); 
```

它“借用”了我在 Stackoverflow 上找到的一些代码以及我自己的一些调整，以使其按照我需要的方式工作。

由于尝试订购对象，需要比较器以及重复删除，我不得不采用的一个消极软糖是我首先必须将我的对象写入 TreeMap，然后再将它们写入 Treeset。它可能会稍微影响性能，但鉴于列表最多约为 80 个代码，这应该不是问题。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2019-06-27T16:41:09.987

我有一个类似的问题，我的字符串里面有空格分隔的段。我以这种方式解决了它：

```
public class StringWithNumberComparator implements Comparator<MyClass> {

@Override
public int compare(MyClass o1, MyClass o2) {
    if (o1.getStringToCompare().equals(o2.getStringToCompare())) {
        return 0;
    }
    String[] first = o1.getStringToCompare().split(" ");
    String[] second = o2.getStringToCompare().split(" ");
    if (first.length == second.length) {
        for (int i = 0; i < first.length; i++) {

            int segmentCompare = StringUtils.compare(first[i], second[i]);
            if (StringUtils.isNumeric(first[i]) && StringUtils.isNumeric(second[i])) {

                segmentCompare = NumberUtils.compare(Integer.valueOf(first[i]), Integer.valueOf(second[i]));
                if (0 != segmentCompare) {
                    // return only if uneven numbers in case there are more segments to be checked
                    return segmentCompare;
                }
            }
            if (0 != segmentCompare) {
                return segmentCompare;
            }
        }
    } else {
        return StringUtils.compare(o1.getDenominazione(), o2.getDenominazione());
    }

    return 0;
} 
```

如您所见，我使用了 Apaches StringUtils.compare() 和 NumberUtils.compere() 作为标准帮助。

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2021-03-19T00:31:26.453

修改[这个](https://stackoverflow.com/a/58249974/448078)答案

* * *

*   不区分大小写的顺序（1000a 小于 1000X）
*   空值处理

**执行：**

```
import static java.lang.Math.pow;

import java.util.Comparator;

public class AlphanumComparator implements Comparator<String> {

    public static final AlphanumComparator ALPHANUM_COMPARATOR = new AlphanumComparator();
    private static char[] upperCaseCache = new char[(int) pow(2, 16)];
    private boolean nullIsLess;

    public AlphanumComparator() {
    }

    public AlphanumComparator(boolean nullIsLess) {
        this.nullIsLess = nullIsLess;
    }

    @Override
    public int compare(String s1, String s2) {
        if (s1 == s2)
            return 0;
        if (s1 == null)
            return nullIsLess ? -1 : 1;
        if (s2 == null)
            return nullIsLess ? 1 : -1;

        int i1 = 0;
        int i2 = 0;
        int len1 = s1.length();
        int len2 = s2.length();
        while (true) {
            // handle the case when one string is longer than another
            if (i1 == len1)
                return i2 == len2 ? 0 : -1;
            if (i2 == len2)
                return 1;

            char ch1 = s1.charAt(i1);
            char ch2 = s2.charAt(i2);
            if (isDigit(ch1) && isDigit(ch2)) {
                // skip leading zeros
                while (i1 < len1 && s1.charAt(i1) == '0')
                    i1++;
                while (i2 < len2 && s2.charAt(i2) == '0')
                    i2++;

                // find the ends of the numbers
                int end1 = i1;
                int end2 = i2;
                while (end1 < len1 && isDigit(s1.charAt(end1)))
                    end1++;
                while (end2 != len2 && isDigit(s2.charAt(end2)))
                    end2++;

                // if the lengths are different, then the longer number is bigger
                int diglen1 = end1 - i1;
                int diglen2 = end2 - i2;
                if (diglen1 != diglen2)
                    return diglen1 - diglen2;

                // compare numbers digit by digit
                while (i1 < end1) {
                    ch1 = s1.charAt(i1);
                    ch2 = s2.charAt(i2);
                    if (ch1 != ch2)
                        return ch1 - ch2;
                    i1++;
                    i2++;
                }
            } else {
                ch1 = toUpperCase(ch1);
                ch2 = toUpperCase(ch2);
                if (ch1 != ch2)
                    return ch1 - ch2;
                i1++;
                i2++;
            }
        }
    }

    private boolean isDigit(char ch) {
        return ch >= 48 && ch <= 57;
    }

    private char toUpperCase(char ch) {
        char cached = upperCaseCache[ch];
        if (cached == 0) {
            cached = Character.toUpperCase(ch);
            upperCaseCache[ch] = cached;
        }
        return cached;
    }
} 
```

* * *

## 回答 #22

> 赞同：-1
> 
> 时间：2008-09-19T19:09:27.557

在您给定的示例中，您要比较的数字周围有空格，而其他数字没有，那么为什么正则表达式不起作用？

bbb **12** cc

对比

eee 12 ddd **jpeg2000** eee

* * *

## 回答 #23

> 赞同：-1
> 
> 时间：2008-09-19T19:27:49.447

如果您正在编写一个比较器类，您应该实现自己的比较方法，该方法将逐个字符地比较两个字符串。此比较方法应检查您处理的是字母字符、数字字符还是混合类型（包括空格）。您必须定义混合类型的行为方式，数字是在字母字符之前还是之后，以及空格适合的位置等。

* * *

## 回答 #24

> 赞同：-1
> 
> 时间：2008-09-19T19:30:29.143

在 Linux 上 glibc 提供了 strverscmp()，它也可以从 gnulib 获得以实现可移植性。然而，真正的“人类”排序还有很多其他的怪癖，比如“披头士”被排序为“披头士”。这个通用问题没有简单的解决方案。

# c# - 响应。重定向到新窗口

> ID：104601
> 
> 赞同：121
> 
> 时间：2008-09-19T19:05:56.143
> 
> 标签：c#, asp.net, response.redirect

我想做一个`Response.Redirect("MyPage.aspx")`，但让它在新的浏览器窗口中打开。我之前没有使用 JavaScript 注册脚本方法就完成了这项工作。我就是想不起来怎么办？

* * *

## 回答 #1

> 赞同：116
> 
> 时间：2008-09-19T19:39:17.437

我刚刚找到了答案，它有效:)

您需要将以下内容添加到服务器端链接/按钮：

```
OnClientClick="aspnetForm.target ='_blank';" 
```

我的整个按钮代码如下所示：

```
<asp:LinkButton ID="myButton" runat="server" Text="Click Me!" 
                OnClick="myButton_Click" 
                OnClientClick="aspnetForm.target ='_blank';"/> 
```

在服务器端 OnClick 我做了一个`Response.Redirect("MyPage.aspx");`，页面在新窗口中打开。

您需要添加的另一部分是修复表单的目标，否则每个链接都将在新窗口中打开。为此，请在 POPUP 窗口的标题中添加以下内容。

```
<script type="text/javascript">
    function fixform() {
        if (opener.document.getElementById("aspnetForm").target != "_blank") return;
        opener.document.getElementById("aspnetForm").target = "";
        opener.document.getElementById("aspnetForm").action = opener.location.href;
    }
</script> 
```

和

```
<body onload="fixform()"> 
```

* * *

## 回答 #2

> 赞同：62
> 
> 时间：2011-02-10T18:50:08.530

您可以将其用作扩展方法

```
public static class ResponseHelper
{ 
    public static void Redirect(this HttpResponse response, string url, string target, string windowFeatures) 
    { 

        if ((String.IsNullOrEmpty(target) || target.Equals("_self", StringComparison.OrdinalIgnoreCase)) && String.IsNullOrEmpty(windowFeatures)) 
        { 
            response.Redirect(url); 
        } 
        else 
        { 
            Page page = (Page)HttpContext.Current.Handler; 

            if (page == null) 
            { 
                throw new InvalidOperationException("Cannot redirect to new window outside Page context."); 
            } 
            url = page.ResolveClientUrl(url); 

            string script; 
            if (!String.IsNullOrEmpty(windowFeatures)) 
            { 
                script = @"window.open(""{0}"", ""{1}"", ""{2}"");"; 
            } 
            else 
            { 
                script = @"window.open(""{0}"", ""{1}"");"; 
            }
            script = String.Format(script, url, target, windowFeatures); 
            ScriptManager.RegisterStartupScript(page, typeof(Page), "Redirect", script, true); 
        } 
    }
} 
```

有了这个，您可以很好地覆盖实际的 Response 对象

```
Response.Redirect(redirectURL, "_blank", "menubar=0,scrollbars=1,width=780,height=900,top=10"); 
```

* * *

## 回答 #3

> 赞同：27
> 
> 时间：2011-08-15T23:26:37.607

通过点击事件处理程序构建您的网址：

```
string strUrl = "/some/url/path" + myvar; 
```

然后：

```
ScriptManager.RegisterStartupScript(Page, Page.GetType(), "popup", "window.open('" + strUrl + "','_blank')", true); 
```

* * *

## 回答 #4

> 赞同：26
> 
> 时间：2008-09-19T19:12:01.090

因为 Response.Redirect 是在服务器上启动的，所以您无法使用它来执行此操作。

如果您可以直接写入响应流，则可以尝试以下操作：

```
response.write("<script>");
response.write("window.open('page.html','_blank')");
response.write("</script>"); 
```

* * *

## 回答 #5

> 赞同：14
> 
> 时间：2010-05-13T20:17:06.723

fixform 技巧很简洁，但是：

1.  您可能无法访问新窗口中加载的代码。

2.  即使你这样做了，你也依赖于它总是加载，没有错误的事实。

3.  而且您取决于这样一个事实，即用户不会在另一个页面有机会加载和运行 fixform 之前单击另一个按钮。

我建议这样做：

```
OnClientClick="aspnetForm.target ='_blank';setTimeout('fixform()', 500);" 
```

*并在同一页面*上设置 fixform ，如下所示：

```
function fixform() {
   document.getElementById("aspnetForm").target = '';
} 
```

* * *

## 回答 #6

> 赞同：11
> 
> 时间：2009-05-06T10:42:47.997

您也可以像这样在后面的代码中使用

```
ClientScript.RegisterStartupScript(this.Page.GetType(), "",
  "window.open('page.aspx','Graph','height=400,width=500');", true); 
```

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2008-09-19T19:11:31.450

这对于 Response.Redirect 是不可能的，因为它发生在服务器端，并且无法指示您的浏览器执行该操作。初始窗口中会留下什么？空白页？

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2014-08-07T17:48:58.160

弹出方法会给访问者一个安全的问题..

这是我的简单解决方案：到处工作。

```
<script type="text/javascript">
    function targetMeBlank() {
        document.forms[0].target = "_blank";
    }
</script> 
```

* * *

```
<asp:linkbutton  runat="server" ID="lnkbtn1" Text="target me to blank dude" OnClick="lnkbtn1_Click" OnClientClick="targetMeBlank();"/> 
```

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2011-06-03T02:17:47.827

```
<asp:Button ID="btnNewEntry" runat="Server" CssClass="button" Text="New Entry"

OnClick="btnNewEntry_Click" OnClientClick="aspnetForm.target ='_blank';"/>

protected void btnNewEntry_Click(object sender, EventArgs e)
{
    Response.Redirect("New.aspx");
} 
```

资料来源：[http ://dotnetchris.wordpress.com/2008/11/04/c-aspnet-responseredirect-open-into-new-window/](http://dotnetchris.wordpress.com/2008/11/04/c-aspnet-responseredirect-open-into-new-window/)

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2011-07-25T13:08:40.083

如果您可以重新构造您的代码以便不需要回发，那么您可以在按钮的 PreRender 事件中使用此代码：

```
protected void MyButton_OnPreRender(object sender, EventArgs e)
{
    string URL = "~/MyPage.aspx";
    URL = Page.ResolveClientUrl(URL);
    MyButton.OnClientClick = "window.open('" + URL + "'); return false;";
} 
```

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2013-07-27T21:58:50.260

您还可以使用以下代码在新选项卡中打开新页面。

```
<asp:Button ID="Button1" runat="server" Text="Go" 
  OnClientClick="window.open('yourPage.aspx');return false;" 
  onclick="Button3_Click" /> 
```

只需调用 Response.Redirect("yourPage.aspx"); 按钮事件背后。

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2010-08-26T18:14:41.893

我总是使用此代码... **使用此代码**

```
String clientScriptName = "ButtonClickScript";
Type clientScriptType = this.GetType ();

// Get a ClientScriptManager reference from the Page class.
ClientScriptManager clientScript = Page.ClientScript;

// Check to see if the client script is already registered.
if (!clientScript.IsClientScriptBlockRegistered (clientScriptType, clientScriptName))
    {
     StringBuilder sb = new StringBuilder ();
     sb.Append ("<script type='text/javascript'>");
     sb.Append ("window.open(' " + url + "')"); //URL = where you want to redirect.
     sb.Append ("</script>");
     clientScript.RegisterClientScriptBlock (clientScriptType, clientScriptName, sb.ToString ());
     } 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2012-05-04T15:32:23.050

这是基于上面@takrl 和@tom 的答案的jQuery 版本。注意：没有硬编码的 formid（上面命名为 aspnetForm），也没有使用 Firefox 可能会发现有问题的直接 form.target 引用：

```
<asp:Button ID="btnSubmit" OnClientClick="openNewWin();"  Text="Submit" OnClick="btn_OnClick" runat="server"/> 
```

然后在 SAME 页面上引用的 js 文件中：

```
function openNewWin () {
    $('form').attr('target','_blank');
    setTimeout('resetFormTarget()', 500);
}

function resetFormTarget(){
    $('form').attr('target','');
} 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2012-10-12T13:46:12.800

我使用超链接而不是链接按钮，它工作得很好，它有目标属性，所以它解决了我的问题。有 Response.Write 的解决方案，但这弄乱了我的布局，而带有 ScriptManager 的解决方案在每次刷新或返回时都会重新打开窗口。所以这就是我解决它的方法：

```
<asp:HyperLink CssClass="hlk11" ID="hlkLink" runat="server" Text='<%# Eval("LinkText") %>' Visible='<%# !(bool)Eval("IsDocument") %>' Target="_blank" NavigateUrl='<%# Eval("WebAddress") %>'></asp:HyperLink> 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-09-19T19:14:19.463

您可能希望使用 Page.RegisterStartupScript 来确保 javascript 在页面加载时触发。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2013-11-08T17:17:06.823

前面的例子都不适合我，所以我决定发布我的解决方案。在按钮点击事件中，下面是代码。

```
Dim URL As String = "http://www.google/?Search=" + txtExample.Text.ToString
URL = Page.ResolveClientUrl(URL)
btnSearch.OnClientClick = "window.open('" + URL + "'); return false;" 
```

我不得不修改其他人的 response.redirect 代码才能在新浏览器中打开。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2014-02-17T16:42:55.970

我使用了这种方法，它不需要您在弹出窗口上做任何事情（我无法访问，因为我正在重定向到 PDF 文件）。它还使用类。

```
$(function () {
    //--- setup click event for elements that use a response.redirect in code behind but should open in a new window
    $(".new-window").on("click", function () {

        //--- change the form's target
        $("#aspnetForm").prop("target", "_blank");

        //--- change the target back after the window has opened
        setTimeout(function () {
            $("#aspnetForm").prop("target", "");
        }, 1);
    });
}); 
```

要使用，请将类“new-window”添加到任何元素。您不需要向 body 标记添加任何内容。此函数设置新窗口并将其固定在同一函数中。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2010-10-07T15:00:59.047

你可以像我在这里做的那样使用ajax [从asp.net代码后面打开新窗口](http://alexandershapovalov.com/open-new-window-from-code-behind-in-aspnet-68/)[http://alexandershapovalov.com/open-new-window-from-code-behind-in-aspnet-68/](http://alexandershapovalov.com/open-new-window-from-code-behind-in-aspnet-68/)

```
protected void Page_Load(object sender, EventArgs e)
{
    Calendar1.SelectionChanged += CalendarSelectionChanged;
}

private void CalendarSelectionChanged(object sender, EventArgs e)
{
    DateTime selectedDate = ((Calendar) sender).SelectedDate;
    string url = "HistoryRates.aspx?date="
+ HttpUtility.UrlEncode(selectedDate.ToShortDateString());
    ScriptManager.RegisterClientScriptBlock(this, GetType(),
"rates" + selectedDate, "openWindow('" + url + "');", true);
} 
```

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2015-05-05T10:14:22.310

我通过将 target="_blank" 放在链接按钮中来做到这一点

```
<asp:LinkButton ID="btn" runat="server" CausesValidation="false"  Text="Print" Visible="false" target="_blank"  /> 
```

然后在代码隐藏页面加载中设置 href 属性：

```
btn.Attributes("href") = String.Format(ResolveUrl("~/") + "test/TestForm.aspx?formId={0}", formId) 
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2018-01-30T02:02:33.710

HTML

```
<asp:Button ID="Button1" runat="server" Text="Button" onclick="Button1_Click" OnClientClick = "SetTarget();" /> 
```

Javascript：

```
function SetTarget() {
 document.forms[0].target = "_blank";} 
```

和代码隐藏：

```
Response.Redirect(URL); 
```

# c# - 通过反射访问集合

> ID：104603
> 
> 赞同：32
> 
> 时间：2008-09-19T19:06:01.837
> 
> 标签：c#, reflection, collections

有没有办法使用反射对集合进行迭代（最好通过 foreach）？我正在使用反射迭代对象中的属性，当程序到达一个集合类型时，我希望它迭代集合的内容并能够访问集合中的对象。

目前，我在所有属性上都设置了一个属性，在作为集合的属性上将 IsCollection 标志设置为 true。我的代码检查这个标志，如果它是真的，它使用反射获取类型。有没有办法在集合上以某种方式调用 GetEnumerator 或 Items 以便能够迭代项目？

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2008-09-19T19:12:19.263

我遇到了这个问题，但我没有使用反射，而是检查它是否是 IEnumerable。所有集合都实现了这一点。

```
if (item is IEnumerable)
{
    foreach (object o in (item as IEnumerable))
    {

    }
} else {
   // reflect over item
} 
```

* * *

## 回答 #2

> 赞同：31
> 
> 时间：2009-02-14T15:06:43.900

我尝试使用 Darren 建议的类似技术，但请注意，不仅仅是集合实现 IEnumerable。`string`例如也是 IEnumerable 并将遍历字符。

这是我用来确定对象是否为集合的小函数（这也是可枚举的，因为 ICollection 也是 IEnumerable）。

```
 public bool isCollection(object o)
    {
        return typeof(ICollection).IsAssignableFrom(o.GetType())
            || typeof(ICollection<>).IsAssignableFrom(o.GetType());
    } 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-09-19T19:22:24.030

只需获取属性的值，然后将其转换为 IEnumerable。这里有一些（未经测试的）代码可以给你一个想法：

```
ClassWithListProperty obj = new ClassWithListProperty();
obj.List.Add(1);
obj.List.Add(2);
obj.List.Add(3);

Type type = obj.GetType();
PropertyInfo listProperty = type.GetProperty("List", BindingFlags.Public);
IEnumerable listObject = (IEnumerable) listProperty.GetValue(obj, null);

foreach (int i in listObject)
    Console.Write(i); // should print out 123 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2012-05-23T19:16:39.143

仅供参考，可能会对某人有所帮助...我有一个带有嵌套类的类和一些其他类的集合。我想保存类的属性值以及嵌套类和类集合。我的代码如下：

```
 public void LogObject(object obj, int indent)
    {
        if (obj == null) return;
        string indentString = new string(' ', indent);
        Type objType = obj.GetType();
        PropertyInfo[] properties = objType.GetProperties();

        foreach (PropertyInfo property in properties)
        {
            Type tColl = typeof(ICollection<>);
            Type t = property.PropertyType;
            string name = property.Name;

            object propValue = property.GetValue(obj, null); 
            //check for nested classes as properties
            if (property.PropertyType.Assembly == objType.Assembly)
            {
                string _result = string.Format("{0}{1}:", indentString, property.Name);
                log.Info(_result);
                LogObject(propValue, indent + 2);
            }
            else
            {
                string _result = string.Format("{0}{1}: {2}", indentString, property.Name, propValue);
                log.Info(_result);
            }

            //check for collection
            if (t.IsGenericType && tColl.IsAssignableFrom(t.GetGenericTypeDefinition()) ||
                t.GetInterfaces().Any(x => x.IsGenericType && x.GetGenericTypeDefinition() == tColl))
            {
                //var get = property.GetGetMethod();
                IEnumerable listObject = (IEnumerable)property.GetValue(obj, null);
                if (listObject != null)
                {
                    foreach (object o in listObject)
                    {
                        LogObject(o, indent + 2);
                    }
                }
            }
        }
    } 
```

一个调用这个函数

```
LogObject(obj, 0); 
```

但是，我的类中有一些结构，我需要弄清楚如何获取它们的值。Moreoevr，我有一些清单。我也需要获得它们的价值......如果我更新我的代码，我会发布。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-19T19:11:48.597

您可能做的最好的事情是检查对象是否实现了某些集合接口——可能 IEnumerable 就是您所需要的。然后只需调用对象的 GetEnumerator()，并使用 IEnumerator.MoveNext() 和 IEnumerator.Current 来处理集合。

如果集合没有实现这些接口，这对您没有帮助，但如果是这种情况，我想它并不是一个真正的集合。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-19T19:11:35.460

当您使用反射时，您不一定使用该对象的实例。您必须创建一个能够遍历对象属性的类型的实例。因此，如果您使用反射，请使用 ConstructorInfo.Invoke() (?) 方法来创建新实例或指向该类型的实例。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-19T19:14:15.297

一种相当直接的方法是将对象类型转换为集合并直接使用它。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-20T16:17:13.217

我会看看 Type.FindInterfaces 方法。这可以过滤掉给定类型实现的接口。如在 PropertyInfo.PropertyType.FindInterfaces(filterMethod, filterObjects) 中。您可以按 IEnumerable 进行过滤，并查看是否返回任何结果。MSDN 在方法文档中有一个很好的例子。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-06-10T07:37:09.640

如果您不使用对象的实例，而是使用类型，则可以使用以下内容：

```
// type is IEnumerable
if (type.GetInterface("IEnumerable") != null)
{
} 
```

# mysql - 在不锁定表的情况下运行 MySQLDump

> ID：104612
> 
> 赞同：490
> 
> 时间：2008-09-19T19:07:09.293
> 
> 标签：mysql

我想将实时生产数据库复制到我的本地开发数据库中。有没有办法在不锁定生产数据库的情况下做到这一点？

我目前正在使用：

```
mysqldump -u root --password=xxx -h xxx my_db1 | mysql -u root --password=xxx -h localhost my_db1 
```

但它在运行时锁定了每个表。

* * *

## 回答 #1

> 赞同：698
> 
> 时间：2008-09-19T19:09:05.623

该`--lock-tables=false`选项是否有效？

根据[手册页](https://dev.mysql.com/doc/refman/5.7/en/mysqldump.html#option_mysqldump_lock-tables)，如果要转储 InnoDB 表，可以使用以下`--single-transaction`选项：

```
--lock-tables, -l

Lock all tables before dumping them. The tables are locked with READ
LOCAL to allow concurrent inserts in the case of MyISAM tables. For
transactional tables such as InnoDB and BDB, --single-transaction is
a much better option, because it does not need to lock the tables at
all. 
```

对于**innodb 数据库**：

```
mysqldump --single-transaction=TRUE -u username -p DB 
```

* * *

## 回答 #2

> 赞同：304
> 
> 时间：2009-08-11T22:20:37.450

这太晚了，但对任何正在搜索该主题的人都有好处。如果您不是 innoDB，并且您在转储时不担心锁定，只需使用以下选项：

```
--lock-tables=false 
```

* * *

## 回答 #3

> 赞同：47
> 
> 时间：2008-09-19T20:19:27.153

答案因您使用的存储引擎而异。理想的情况是您使用 InnoDB。在这种情况下，您可以使用该`--single-transaction`标志，它将在转储开始时为您提供数据库的一致快照。

* * *

## 回答 #4

> 赞同：44
> 
> 时间：2010-12-16T11:43:16.257

`--skip-add-locks`帮了我

* * *

## 回答 #5

> 赞同：18
> 
> 时间：2012-05-04T19:10:43.133

要转储大型表，您应该将 --single-transaction 选项与 --quick 结合使用。

[http://dev.mysql.com/doc/refman/5.1/en/mysqldump.html#option_mysqldump_single-transaction](http://dev.mysql.com/doc/refman/5.1/en/mysqldump.html#option_mysqldump_single-transaction)

* * *

## 回答 #6

> 赞同：13
> 
> 时间：2013-01-10T06:40:28.073

对于 InnoDB 表使用标志`--single-transaction`

> 它在发出 BEGIN 时转储数据库的一致状态，而不会阻塞任何应用程序

MySQL 文档

[http://dev.mysql.com/doc/refman/5.1/en/mysqldump.html#option_mysqldump_single-transaction](http://dev.mysql.com/doc/refman/5.1/en/mysqldump.html#option_mysqldump_single-transaction)

* * *

## 回答 #7

> 赞同：12
> 
> 时间：2012-05-23T19:48:09.027

与那个说他对原始答案迟到的人相比，这大约是迟到了，但就我而言（在 Windows 7 上通过 WAMP 的 MySQL），我不得不使用：

```
--skip-lock-tables 
```

* * *

## 回答 #8

> 赞同：10
> 
> 时间：2008-09-19T19:44:58.670

老实说，我会为此设置复制，就好像您不锁定表一样，您将从转储中获得不一致的数据。

如果转储需要更长的时间，那么已经转储的表可能会随着一些即将转储的表发生变化。

所以要么锁定表，要么使用复制。

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2012-05-01T09:07:22.710

```
 mysqldump -uuid -ppwd --skip-opt --single-transaction --max_allowed_packet=1G -q db |   mysql -u root --password=xxx -h localhost db 
```

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2019-02-28T18:08:02.523

使用 MySQL Workbench 时，在 Data Export 中单击 Advanced Options 并取消选中“lock-tables”选项。

[![在此处输入图像描述](../Images/5e5544d128bfba3c6fef6908616c420a.png)](https://i.stack.imgur.com/3d2Gg.png)

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2018-10-17T14:19:00.210

由于[https://dev.mysql.com/doc/refman/5.7/en/mysqldump.html#option_mysqldump_lock-tables](https://dev.mysql.com/doc/refman/5.7/en/mysqldump.html#option_mysqldump_lock-tables)：

> 某些选项，例如 --opt（默认启用）会自动启用 --lock-tables。如果要覆盖它，请在选项列表的末尾使用 --skip-lock-tables。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2021-01-14T10:35:03.423

如果您使用 Percona XtraDB Cluster - 我发现将 --skip-add-locks 添加
到 mysqldump 命令允许 Percona XtraDB Cluster 运行转储文件，而不会在转储文件中出现有关 LOCK TABLES 命令的问题。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2017-08-12T12:43:26.973

另一个迟到的答案：

如果您尝试制作服务器数据库的热副本（在 linux 环境中）并且所有表的数据库引擎都是 MyISAM，您**应该**使用`mysqlhotcopy`.

根据文档：

> 它使用 FLUSH TABLES、LOCK TABLES 和 cp 或 scp 来进行数据库备份。这是一种备份数据库或单个表的快速方法，但它只能在数据库目录所在的同一台机器上运行。mysqlhotcopy 仅适用于备份 MyISAM 和 ARCHIVE 表。

时间取决于服务器可以复制 MySQL 文件的`LOCK TABLES`时间（它不会进行转储）。

* * *

## 回答 #14

> 赞同：-1
> 
> 时间：2016-10-18T16:48:40.717

由于这些方法都不适合我，我只是做了一个：

```
mysqldump [...] | grep -v "LOCK TABLE" | mysql [...] 
```

它将同时排除`LOCK TABLE <x>`和`UNLOCK TABLES`命令。

**注意：**希望您的数据中不包含该字符串！

# c# - 什么是 .net / c# 套接字编程的好教程/howto

> ID：104617
> 
> 赞同：8
> 
> 时间：2008-09-19T19:07:38.263
> 
> 标签：c#, sockets, network-programming, winsock

我正在将使用 Winsock 控件的旧 VB6 代码移植到 C#。我没有做过任何套接字编程，我想知道是否有人有一个很好的参考/教程/howto，我可以用来开始加快速度。

当我继续进行通常效率低下的谷歌搜索时，我正在吸引蜂巢思维。

我现在使用的是 UDP，而不是 TCP。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-19T19:36:31.140

2005 年 8 月的 MSDN 杂志有一篇关于 System.Net.Sockets 和 WinSock 的文章：

[http://msdn.microsoft.com/en-us/magazine/cc300760.aspx](http://msdn.microsoft.com/en-us/magazine/cc300760.aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-20T21:53:36.700

*   对于大多数应用程序，我建议使用异步模型，特别是如果您想要性能或应用程序不会在出现网络问题时立即挂起。为此，有关[Socket.BeginConnect](http://msdn.microsoft.com/en-us/library/system.net.sockets.socket.beginconnect.aspx)和[Socket.BeginReceive](http://msdn.microsoft.com/en-us/library/system.net.sockets.socket.beginreceive.aspx)的 MSDN 文章是很好的起点。
*   以下链接不是 .NET，但许多建议仍然有效：http: [//tangentsoft.net/wskfaq/articles/lame-list.html](http://tangentsoft.net/wskfaq/articles/lame-list.html)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-19T19:34:56.777

[MSDN 是一个很好的起点](http://msdn.microsoft.com/en-us/library/b6xa24z5.aspx)

您正在处理：客户端 ( [TCPClient](http://www.google.com/search?q=TCPClient+Tutorials) ) 还是服务器 ( [TCPListener](http://www.google.com/search?q=TCPListener+Tutorials) )

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-08T04:34:38.717

提个醒：

我建议首先使用 TCP 而不是 UDP。UDP 不会像 TCP 那样自动重新传送丢失的数据包，因此它会在等式中添加另一个元素，这可能会让您在刚开始时感到困惑。

使用 .Net 库中提供的 TCPClient 类构建套接字客户端相对容易。TCPListener 很容易用于单个客户端，但是如果您希望开发一些服务器类型的应用程序（IE：处理多个连接）。您必须克服的真正障碍是理解多线程。

一旦你玩过单连接套接字，我建议你阅读多线程。

# f# - -> 在 F# 中是什么意思？

> ID：104618
> 
> 赞同：26
> 
> 时间：2008-09-19T19:07:50.307
> 
> 标签：f#, functional-programming

一段时间以来，我一直在尝试打开和关闭 F#，但我一直被推迟。为什么？

因为无论我尝试查看哪个“初学者”资源，我都会看到非常简单的示例，这些示例开始使用 operator `->`。

但是，到目前为止，我还没有找到任何地方可以清楚简单地解释此运算符的含义。就好像它必须如此明显，以至于即使完成新手也不需要解释。

因此，我必须非常密集，或者可能是近 3 年的经验使我退缩了。

有人可以请解释一下或指出一个真正可访问的资源来解释它吗？

* * *

## 回答 #1

> 赞同：50
> 
> 时间：2008-09-19T20:56:26.237

'->' 不是运算符。它在许多地方出现在 F# 语法中，其含义取决于它如何用作更大构造的一部分。

在类型内部，'->' 描述了人们上面描述的函数类型。例如

```
let f : int -> int = ... 
```

表示“f”是一个接受 int 并返回 int 的函数。

在 lambda（“以 'fun' 关键字开头的东西”）中，'->' 是将参数与正文分开的语法。例如

```
fun x y -> x + y + 1 
```

是一个表达式，它定义了具有给定实现的两个参数函数。

在“匹配”结构中，'->' 是将模式与模式匹配时应该运行的代码分开的语法。例如，在

```
match someList with
| [] -> 0
| h::t -> 1 
```

每个'->'左边的东西是模式，右边的东西是如果左边的模式匹配会发生什么。

理解的困难可能源于错误的假设，即“->”是具有单一含义的“运算符”。一个类比可能是“。” 在 C# 中，如果您以前从未见过任何代码，请尝试分析“.”。基于查看“obj.Method”和“3.14”和“System.Collections”的运算符，您可能会感到非常困惑，因为符号在不同的上下文中具有不同的含义。但是，一旦您对语言有足够的了解以识别这些上下文，事情就会变得清晰。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-09-19T19:21:05.173

它基本上意味着“映射到”。以这种方式阅读它，或者“转化为”或类似的东西。

因此，从[F# in 20 分钟](http://blogs.msdn.com/chrsmith/archive/2008/05/02/f-in-20-minutes-part-i.aspx)教程中，

```
> List.map (fun x -> x % 2 = 0) [1 .. 10];;
val it : bool list
= [false; true; false; true; false; true; false; true; false; true] 
```

> 代码 (fun i -> i % 2 = 0) 定义了一个匿名函数，称为 lambda 表达式，它有一个参数 x，该函数返回“x % 2 = 0”的结果，即 x 是否为甚至。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-09-19T20:29:10.110

第一个问题 - 你熟悉 C# 中的 lambda 表达式吗？如果是这样，F# 中的 -> 与 C# 中的 => 相同（我认为你读到它'goes to'）。

-> 运算符也可以在模式匹配的上下文中找到

```
match x with
| 1 -> dosomething
| _ -> dosomethingelse 
```

我不确定这是否也是一个 lambda 表达式或其他东西，但我想“去”仍然成立。

也许您真正指的是 F# 解析器的“神秘”响应：

```
> let add a b = a + b
val add: int -> int -> int 
```

这意味着（正如大多数示例所解释的）add 是一个“val”，它接受两个整数并返回一个整数。对我来说，这从一开始就完全不透明。我的意思是，我怎么知道 add 不是一个接受一个 int 并返回两个 int 的 val？

嗯，事情是，在某种意义上，它确实如此。如果我只添加一个 int，我会得到一个 (int -> int)：

```
> let inc = add 1
val inc: int -> int 
```

这（currying）是让 F# 如此性感的原因之一，对我来说。

有关 F# 的有用信息，我发现博客比任何官方“文档”都更有用：这里有一些名称可供查看

*   [达斯汀坎贝尔](http://diditwith.net)（这是 diditwith.net，在另一个答案中引用）
*   [唐赛姆斯](http://blogs.msdn.com/dsyme)（“那个”男人）
*   [Tomasp.net](http://Tomasp.net)（又名[Tomas Petricek](https://stackoverflow.com/users/33518/tomas-petricek)）
*   [安德鲁·肯尼迪](http://blogs.msdn.com/andrewkennedy)（测量单位）
*   [Fsharp.it](http://Fsharp.it)（以 Project Euler 解决方案而闻名）
*   [http://lorgonblog.spaces.live.com/Blog](http://lorgonblog.spaces.live.com/Blog)（又名[布赖恩](https://stackoverflow.com/users/19299/brian)）
*   [乔莫·费舍尔](http://blogs.msdn.com/jomo_fisher)

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-19T19:24:39.297

(a -> b) 表示“从 a 到 b 的函数”。在类型注解中，它表示一个函数类型。例如， f : (int -> String) 表示 f 指的是一个接受整数并返回字符串的函数。它也被用作此类值的构造函数，例如

```
val f : (int -> int) = fun n -> n * 2 
```

它创建了一个值，该值是从某个数字 n 到相同数字乘以 2 的函数。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-19T19:22:50.177

来自[微软](http://research.microsoft.com/fsharp/manual/quicktour.aspx?0sr=a)：

> 函数类型是赋予一等函数值的类型，写成 int -> int。它们类似于 .NET 委托类型，只是它们没有给定名称。所有 F# 函数标识符都可以用作一等函数值，并且可以使用 (fun ... -> ...) 表达式形式创建匿名函数值。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-19T19:58:04.443

这里已经有很多很好的答案，我只是想在对话中添加另一种思考方式。

' -> ' 表示功能。

'a -> 'b 是一个接受 'a 并返回 'b 的函数

('a * 'b) -> ('c * 'd) 是一个函数，它接受一个 ('a, 'b) 类型的元组并返回一个 ('c, 'd) 元组。比如int/string返回float/char。

有趣的地方在于 'a -> 'b -> 'c 的级联情况。这是一个接受 'a 并返回一个函数 ('b -> 'c) 的函数，或者一个接受 'b -> 'c 的函数。

所以如果你写： let fxyz = ()

类型将是 f : 'a -> 'b -> 'c -> unit，所以如果你只应用第一个参数，结果将是一个柯里化函数 'b -> 'c -> 'unit。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-19T20:15:18.927

在定义函数的上下文中，它类似于`=>`C# 3.0 中的 lambda 表达式。

```
F#: let f = fun x -> x*x
C#: Func<int, int> f = x => x * x; 
```

F# 中的`->`也用于模式匹配，它的意思是：如果表达式匹配 and 之间的部分`|`，`->`那么后面`->`的内容应该作为结果返回：

```
let isOne x = match x with
 | 1 -> true
 | _ -> false 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-20T21:15:45.137

这个问题有很多很好的答案，谢谢大家。我想在这里放一个可编辑的答案，将事情结合在一起。

对于那些熟悉 C# 理解的人来说 -> 与 => lamba 表达式相同是一个很好的第一步。这种用法是：-

```
fun x y -> x + y + 1 
```

可以理解为等价于：-

```
(x, y) => x + y + 1; 
```

然而，很明显 -> 具有更基本的含义，它源于一个概念，即采用上述两个参数的函数可以简化（这是正确的术语吗？）为一系列仅采用一个参数的函数。

因此，当上面这样描述时：-

```
Int -> Int -> Int 
```

知道 -> 是正确的关联真的很有帮助，因此可以考虑以上内容：-

```
Int -> (Int -> Int) 
```

啊哈！我们有一个接受 Int 并返回 (Int -> Int) 的函数（一个柯里化函数？）。

-> 也可以作为类型定义的一部分出现的解释也有帮助。(Int -> Int) 是任何接受 Int 并返回 Int 的函数的类型。

-> 出现在其他语法（例如匹配）中也很有帮助，但它的含义不同？那是对的吗？我不确定是不是。我怀疑它具有相同的含义，但我还没有表达的词汇。

请注意，此答案的目的不是产生进一步的答案，而是由你们协作编辑以创建更明确的答案。最终，最好删除所有不确定性和绒毛（例如本段）并添加更好的示例。让我们尽量让没有经验的人可以访问这个答案。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-19T19:45:11.090

诸如 Haskell 之类的语言的好处（它在 F# 中非常相似，但我不知道确切的语法 - 这应该有助于您理解 ->，不过）是您可以仅应用部分参数来创建*curried*职能：

```
adder n x y = n + x + y 
```

换句话说：“给我三样东西，我会把它们加在一起”。当你向它抛出数字时，编译器会推断出 nx 和 y 的类型。说你写

```
adder 1 2 3 
```

1、2 和 3 的类型是 Int。所以：

```
adder :: Int -> Int -> Int -> Int 
```

也就是说，给我三个整数，我最终会变成一个整数，或者说的一样：

```
five :: Int
five = 5 
```

但是，这是很好的部分！试试这个：

```
add5 = adder 5 
```

你还记得，adder 接受一个 int、一个 int、一个 int，然后返回一个 int。然而，这并不是全部真相，您很快就会看到。事实上，add5 会有这种类型：

```
add5 :: Int -> Int -> Int 
```

就好像你已经“剥离”了整数（最左边的），并将它直接粘到函数上。仔细观察函数签名，我们注意到 -> 是右关联的，即：

```
addder :: Int -> (Int -> (Int -> Int)) 
```

这应该很清楚：当你给加法器第一个整数时，它会评估第一个箭头右边的任何东西，或者：

```
add5andtwomore :: Int -> (Int -> Int)
add5andtwomore = adder 5 
```

现在您可以使用 add5andtwomore 而不是“adder 5”。这样，您可以应用另一个整数来获得（比如说）“add5and7andonemore”：

```
add5and7andonemore :: Int -> Int
add5and7andonemore = adder 5 7 
```

如你所见，add5and7andonemore 正好需要另一个参数，当你给它一个参数时，它会突然变成一个整数！

```
 > add5and7andonemore 9
 => ((add5andtwomore) 7) 9
 => ((adder 5) 7) 9)
<=> adder 5 7 9 
```

将参数代入加法器 (nxy) 中 (5 7 9)，我们得到：

```
 > adder 5 7 9 = 5 + 7 + 9
 => 5 + 7 + 9
 => 21 
```

*实际上*， plus 也只是一个接受一个 int 并返回另一个 int 的函数，所以上面的内容真的更像：

```
 > 5 + 7 + 9
 => (+ 5 (+ 7 9))
 => (+ 5 16)
 => 21 
```

给你！

# sql - 有什么好的 SQL Anywhere 数据库模式比较工具吗？

> ID：104620
> 
> 赞同：7
> 
> 时间：2008-09-19T19:07:54.923
> 
> 标签：sql, comparison, schema, sqlanywhere

是否有任何支持 Sybase SQL Anywhere 版本 10 的优秀数据库模式比较工具？我已经看到了 SQL Server 的一连串，MySQL 和 Oracle 的一些，但没有一个能正确支持 SQL Anywhere。

我尝试使用 DB Solo，但它把我所有的非唯一索引都变成了唯一索引，而且我没有看到任何改变它的选项。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-07T14:23:50.430

如果您愿意下载 SQL Anywhere 版本 11 并进行比较！，请查看此处显示的比较技术：

[http://sqlanywhere.blogspot.com/2008/08/comparing-database-schemas.html](http://sqlanywhere.blogspot.com/2008/08/comparing-database-schemas.html)

您不必升级 SQL Anywhere 版本 10 数据库。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-14T21:59:44.700

新来的孩子是[Qwerybuilder](http://www.werysoft.com/Features.aspx)。它支持 SQL Server、Sybase ASE、Sybase SQL Anywhere 和 Oracle。我已经成功地将它与 SQL Anywhere 一起使用来跟踪架构更改。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-09T02:13:27.407

我遇到的两个支持 SQL Anywhere：

Upscene 数据库工作台 - [http://www.upscene.com/products.dbw.sqlanywhere.php](http://www.upscene.com/products.dbw.sqlanywhere.php)

Aquafold - [http://www.aquafold.com/index-sybaseany.html](http://www.aquafold.com/index-sybaseany.html)

每个出现的都有一个模式比较工具，但是我没有使用任何一个来比较模式。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-19T19:11:54.460

[SQLDelta](http://www.sqldelta.com/)很棒。它适用于 SQL Server。我已经将它与 SQL 2000 和 2005 一起使用。它会比较存储过程、表、视图、权限、索引等。我相信它还可以比较表之间的数据。您可以同步更改或生成 SQL 脚本以供以后使用。我经常使用它来编写从开发到生产的数据库更改脚本。

啊...错过了 Sybase 的评论。不确定 SQLDelta 是否可以与之交谈..但我可能会试一试，因为 Sybase 是相似的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-19T20:05:23.413

试试 erwin（CA AllFusion ERwin 数据建模器）。它支持很多不同的数据库，包括 SQL Anywhere，并且在逆向/正向工程和模式比较方面非常出色。但是，您可能会发现它有点太复杂，无法用于比较......

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-14T17:26:00.133

我使用Red Gate 的[SQL 数据比较和](http://www.red-gate.com/products/SQL_Data_Compare/index.htm)[SQL 比较](http://www.red-gate.com/products/SQL_Compare/index.htm)，数据比较允许您比较两个数据库的内容并自动同步您的数据。SQL 比较允许您执行相同的操作，但使用数据库表。每个都有很好的 GUI，而且设置非常简单。他们还可以在远程数据库上工作。

那里并不便宜，但每个都有 30 条小径，所以你可以感受一下，如果你喜欢与否。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-18T09:12:06.217

Sybase PowerDesigner 还可以比较或合并您的数据库模式。

如果您有模式生成脚本，它还可以通过 ODBC 从各种数据库中加载模式，您也可以将它们加载到模型中。

它是一个昂贵的工具，但非常适合记录和开发架构更改恕我直言。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-07-10T05:39:00.413

布雷克卡特的想法是个好主意。对于快速扫描，我有一个名为 DBDelta 的旧产品。我将它安装在一台旧的 Windows 2000 机器上，因为我的安装无法在 XP 机器上运行。这是一个非常小的应用程序，可以通过 ODBC 连接比较两个 SQL Anywhere 数据库。

我已经进行了一些搜索以尝试找到以后的副本，但一直无法找到。开发商是查尔斯·布彻。我认为他支持了一段时间，然后在 2002 年左右停止了。

我会继续寻找链接。如果我发现了什么，我会在这里发布。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-03-19T16:48:15.290

QweryBuilder 5.5.0 将允许您一次性比较所有过程、函数、视图、表和触发器。此版本计划于 2010 年 5 月中旬发布。

它尚未最终确定，但我们也在考虑添加一个选项，将差异结果转换为可以在目标数据库上执行的脚本。

# eclipse - 如何禁用 eclipse 服务器启动超时？

> ID：104640
> 
> 赞同：62
> 
> 时间：2008-09-19T19:10:41.267
> 
> 标签：eclipse, eclipse-wtp

默认情况下，在 Eclipse Web Tools 中使用 webapp 服务器时，服务器启动将在 45 秒超时后失败。我可以在服务器实例属性中增加此超时，但我看不到完全禁用超时的方法（在调试应用程序启动时很有用）。有没有办法做到这一点？

* * *

## 回答 #1

> 赞同：99
> 
> 时间：2008-10-07T04:08:30.633

![在此处输入图像描述](../Images/a098fa8af424a1667d21aa9ada2dec64.png)在 Eclipse Indigo 中，您可以通过在“服务器”视图中双击服务器并更改启动超时来编辑默认超时（见图）。保存您的更改，一切顺利！

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2009-08-24T05:08:31.923

1.  在 EclipseIDE 上，双击服务器
2.  管理面板打开，单击“超时”选项卡
3.  在“开始（以秒为单位）”中输入较大的值，可能是 1800
4.  重启/启动服务器

如果一切正常，服务器应该启动。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2010-06-22T15:55:19.497

只是另一个数据点。如果您在控制台中看到“NNN ms 中的服务器启动”，但服务器视图仍然显示它正在尝试启动，然后超时最终终止服务器，则可能是您没有配置普通的 HTTP 连接器。例如，如果您在 Tomcat 中仅配置了 2 路 SSL 连接器，它将使用“TOMCAT_HOME/bin”中的脚本正常启动，但如果您尝试使用 Eclipse Server 视图启动它，则不会能够打开到 HTTP 端口的连接，并在超时时终止。（这是一个相当旧的 STS 2.1.0。不知道它是否在以后的版本中修复）

乔

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-02-02T21:45:00.367

朱莉的回答给了你一个很长的超时时间，但不是无限的。您可以将服务器配置文件移动到工作区，然后直接编辑 xml 文件并设置大于 1800 的限制。这是一个丑陋的 hack，但应该可以。 ![替代文字](../Images/051e0695957bf7043667163a03f957a9.png)

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2010-01-31T05:40:55.960

转到窗口 > 首选项 > 服务器

从下拉菜单中将“服务器超时延迟”设置为无限制。

或者

转到 $WORKSPACE/.metadata/.plugins/org.eclipse.core.runtime/.settings/org.eclipse.wst.server.core.prefs

添加/更新线机器速度= -1

在这里，-1 ~ 无限

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-15T02:29:21.017

是的，这是可行的，但最大限制是 1800，即 30 分钟。

有时在重建我们的整个数据库时（在服务器初始启动时），这可能会持续超过 30 分钟并导致问题。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-11-10T16:54:02.717

如果更改超时设置后仍然存在问题，那么最好在 Eclipse 中删除服务器配置（在服务器视图选项卡中）并重新创建它。

服务器 --> 新服务器。

它对我有用。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2021-01-13T19:41:52.413

在 eclipse 2019-09 (4.13.0) 中，没有设置无限值的 UI 功能。它必须在 1 到 84600 秒（一天）之间。

但是，如果您`.metadata/.plugins/org.eclipse.wst.server.core/servers.xml`在工作区中编辑文件并将服务器的`start-timeout`属性设置为大量，在我的情况下`-1`，它不会中止服务器启动，直到达到这个时间。我必须重新启动 eclipse 才能读取更改。

***注意：使用 UI 编辑其他值会将您的值合并为允许范围内的值。***

# unicode - 第一个正式支持 Unicode 的 MS Office 版本是什么？

> ID：104661
> 
> 赞同：0
> 
> 时间：2008-09-19T19:12:11.247
> 
> 标签：unicode, ms-office

我正在为我正在写的白皮书做一些关于 Unicode 的研究。有人记得 Windows 平台上完全兼容 Unicode 的第一个 MS Office 版本吗？没有太多运气从网上搜索这个答案。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-19T19:14:53.783

office 97：
“Unicode 提供的通用字符集克服了这个问题。Office 97 是第一个在除 Microsoft Access 和 Microsoft Outlook® 之外的所有应用程序中支持 Unicode 的 Office 版本。在 Office 2000 中，Access 和 Microsoft Publisher 获得了 Unicode 支持。Microsoft FrontPage® 2000 还支持网页上的 Unicode，但输入对话框和用户界面其他元素的文本仅限于用户代码页定义的字符。” - 微软
网址： http:
[//office.microsoft.com/en-us/ork2000/HA011382921033.aspx](http://office.microsoft.com/en-us/ork2000/HA011382921033.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-19T19:21:04.407

根据 DanWoolston 的回答，Microsoft Outlook 2003 是第一个提供完整 Unicode 支持的 Outlook 版本，因此根据您对“Office”的定义（因为有很多不同的版本），您的答案可能是 Microsoft Office 2003。

网址： http: [//office.microsoft.com/en-us/ork2003/HA011402611033.aspx](http://office.microsoft.com/en-us/ork2003/HA011402611033.aspx)

# firefox - 基于标头的特定客户端检测。火狐扩展？

> ID：104665
> 
> 赞同：1
> 
> 时间：2008-09-19T19:12:23.163
> 
> 标签：firefox, http-headers

我有一个网站，我希望能够根据特定用户的永久属性检测特定用户。

我最初的计划是使用一个 IP 地址，但这些地址很难维护，因为它们可以经常更改。Cookie 和 Session 几乎没有问题，因为它们会过期并且往往难以操作。

基本上我想要做的是检测当前访问网站的客户是否是特殊用户，而无需处理登录名/密码。使用更永久的东西。

用户代理插件可以工作，但是，如果我升级 Firefox 或任何我必须进入并手动更新用户代理字符串的东西。

我找到了这个脚本：[https](https://addons.mozilla.org/en-US/firefox/addon/6895) ://addons.mozilla.org/en-US/firefox/addon/6895但它不适用于最新版本的 Firefox 3。这将是一个完美的解决方案，因为它会在特定位置发送特殊标头网站。

没有写我自己的扩展，有人知道该怎么做吗？我需要延期吗？我应该尝试自己写吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-19T19:15:35.450

您可以生成 SSL 客户端证书，并让您的用户安装它。从那时起，他们的浏览器将使用他们的证书来识别他们。

*   [HOWTO：使用客户端 SSL 证书保护网站](http://it.toolbox.com/blogs/securitymonkey/howto-securing-a-website-with-client-ssl-certificates-11500)
*   [SSL 和证书 (IIS 6.0)](http://www.microsoft.com/technet/prodtechnol/windowsserver2003/library/IIS/559bb9d5-0515-4397-83e0-c403c5ed86fe.mspx)

# c# - 为什么 C# 中的事件应该采用 (sender, EventArgs)？

> ID：104674
> 
> 赞同：40
> 
> 时间：2008-09-19T19:13:14.787
> 
> 标签：c#, .net, events

众所周知，您应该声明以参数为参数的事件`(object sender, EventArgs args)`。为什么？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-09-19T19:16:27.913

这使消费开发人员能够为多个事件编写单个事件处理程序，而不管发送者或事件如何。

**编辑：**为什么你需要不同的模式？您可以继承 EventArgs 以提供任意数量的数据，而更改模式只会使任何被迫使用这种新模式的开发人员感到困惑和沮丧。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-09-19T19:40:47.760

实际上，这是否是进行活动的最佳实践方式是有争议的。有一种学派认为，由于事件旨在解耦两段代码，事件处理程序获取发送者，并且必须知道将发送者转换为什么类型才能对其进行任何处理这一事实是反图案。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-09-19T19:18:48.390

因为无论语言如何，它都是任何回调机制的好模式。您想知道谁发送了事件（发送者）以及与事件相关的数据（EventArgs）。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-09-19T20:04:45.957

对事件传递的数据使用单个参数 EventArgs 允许您在软件的未来版本中将数据添加到事件中，而不会破坏现有消费者。您只需将新成员添加到现有 EventArgs 派生类，或使用新成员创建派生类。

否则，一致性和最小意外原则证明使用 EventArgs 传递数据是合理的。

至于发送者，在某些（但不是全部）情况下，了解发送事件的类型很有用。为 sender 参数使用 object 以外的类型过于严格：这意味着其他发送者无法重用相同的事件签名。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-19T19:22:28.197

这是一个很好的使用模式，这样任何实现事件的人都可以找到发送它的内容。

覆盖 EventArgs 并通过它们传递数据也是最好的方法。EventArgs 是一个基类。如果您查看调用事件的各种控件，它们会覆盖 EventArgs，从而为您提供有关事件的更多信息。

即使您不需要参数来执行事件，如果您没有将它们包含在框架的第一次运行中并且想要稍后添加它们，那么您会破坏所有先前的实现，并且必须重新编写它们。另外，如果您创建一个框架并要分发它会变得更糟，因为使用您的框架的每个人都需要重构。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-19T20:49:34.990

Chris Anderson 在《框架设计指南》一书中说：

> [T]这只是一个模式。通过将事件参数打包在一个类中，您可以获得更好的版本控制语义。通过拥有一个共同的模式`(sender, e)`，它很容易被学习为所有事件的签名。

有些情况主要涉及互操作，需要偏离这种模式。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-19T19:20:24.643

这似乎是微软随着时间的推移演变事件模型的方式。似乎他们还允许使用另一种方式来使用“新”Action 委托及其变体来做到这一点。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-11-02T03:05:45.423

有时您希望强制所有事件使用者使用特定事件参数，例如，传递布尔参数的安全事件，true 表示好，false 表示坏。在这种情况下，您希望您的消费者痛苦地意识到新参数，即您希望您的消费者与该参数耦合。请注意，您的消费者仍然与您的事件触发类分离，但与您的事件无关。

我怀疑这种情况适用于大量情况，在这些情况下，EventArgs 的值会大大降低。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2011-07-05T08:34:22.350

当处理程序方法应该对引发事件的对象执行某些操作时，“对象发送者”允许为多个对象重用一种方法，例如 3 个文本框可以有一个处理程序来重置触发文本框的文本。

EventArgs 的主要优点是它允许重构事件信息，而无需更改订阅此类事件的所有项目中的所有处理程序的签名。

我想不出更聪明的方式来处理事件。

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2011-03-14T18:15:20.957

单独的**EventArgs**类是无用的，因为它必须派生以使用任何内容进行实例化。这表明应该使用一个子类，并且许多子类已经存在于 .NET 中。可悲的是，我找不到任何好的通用的。

假设您想将日志记录委托给通用事件...而不编写您自己的 EventArgs 子类。这似乎是一个毫无意义的练习，但我喜欢使用现有的功能。您可以通过 Object 参数传递您的字符串，但这违背了它的预期用途。尝试在 Google 上找到 EventArgs 子类的一个很好的参考，你会干的。（至少我做到了。）

ReSharper 有点帮助，因为当您键入“EventArgs”时，您会看到包含字符串“EventArgs”的所有类的列表（在您的使用/导入范围内）。仔细阅读列表，您会看到许多没有字符串成员的类。当您到达**ControlEventArgs**时，您会看到可能会使用 Text 属性，但会产生 Windows 控件的所有开销。 **ConvertEventArgs**可能很有用，因为您将类型与数据一起传递，但这仍然需要紧密耦合，既没有很好的文档记录，也没有本质上的类型安全。 **DataReceivedEventArgs**没有实现。 **EntryWrittenEventArgs**需要一个带有字节数组的 EventLogEntry 或数据的 StreamingContext。 **错误事件参数**如果您不介意在内部调用所有日志事件 Exception ErrorEvents ，则更接近，带有异常消息。 **FileSystemEventArgs**可能是最接近的，有两个字符串和一个必需的 WatcherChangeTypes 枚举参数，如果您知道自己在做什么，可以将其设置为 0。 如果您不介意需要 Windows.Forms 命名空间， **LabelEditEventArgs使用一个 int 和一个字符串。****RenamedEventArgs**类似于具有额外字符串的 FileSystemEventArgs。最后， System.Runtime.InteropServices 中的**ResolveEventArgs**传递一个字符串。还有其他库，但我坚持使用一些最常见的库。因此，根据实现我可以使用**ErrorEventArgs**，**用于记录的**FileSystemEventArgs**或**ResolveEventArgs 。****

# functional-programming - 是否有函数式编程语言的本机编译器

> ID：104725
> 
> 赞同：6
> 
> 时间：2008-09-19T19:18:46.550
> 
> 标签：functional-programming

Joel Spolsky[赞扬](http://www.joelonsoftware.com/articles/PleaseLinker.html)了不依赖于运行时的程序的本机代码版本。

哪些本机代码编译器可用于函数式语言？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-09-19T19:28:11.457

这个帖子真的很不清楚。问题似乎是“是否有功能语言的编译器可以生成本机可执行文件而无需安装其他软件？”

一般来说，答案是肯定的。例如，[Haskell](http://www.haskell.org/)有一个生成本机二进制文件[的编译器。](http://www.haskell.org/ghc/)许多其他函数式语言具有类似的编译器。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-19T19:49:13.717

是的，还有：

`ocamlc`是字节码编译器，`ocamlopt`是本机代码编译器。 `GCL`将 Common Lisp 编译为本机二进制文件。

F# 没有任何东西，因为据我所知，.NET 没有像 Joel 提到的本机编译器。实际上，CSML 可用于从 ocaml 调用 C#，呃，不确定是否可以将其编译为本机代码 - 似乎不太可能 - 尽管文档暗示了它，但它非常不完整。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2011-02-22T13:42:00.193

许多函数式语言的编译就像任何其他语言一样。

例如在 Clojure 中：

*   [读者](http://clojure.org/reader)将源代码文本翻译成代表程序的数据结构（一个[s-expression](http://en.wikipedia.org/wiki/S-expression)）
*   如果需要，然后应用宏来转换代码
*   Clojure 编译器然后将代码翻译成 Java 字节码——这与 Java、Scala 和其他 JVM 语言使用的机器可移植格式相同
*   最后，JVM 中的[JIT 编译器](http://en.wikipedia.org/wiki/Just-in-time_compilation)将字节码转换为本机机器码，可能会即时执行各种优化。这是然后在它运行的任何平台上直接执行的代码。

有趣的一点是，所有这些都是动态发生的，即在程序执行期间的任何时候，您都可以编写新的源代码，将其传递给阅读器和各种编译步骤，然后运行新编译的本机代码*，而*无需重新启动程序。这很重要，因为它可以[在 REPL 进行交互式开发，](http://en.wikipedia.org/wiki/Read-eval-print_loop)同时仍然提供完全编译代码的好处。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-20T21:39:55.563

[PLT Scheme](http://plt-scheme.org/)有一个 JIT 编译器。

[Stalin](http://community.schemewiki.org/?Stalin)是一个 Scheme 编译器，它进行了可笑的激进优化。

[除CLISP](http://clisp.cons.org/)外，我所知道的所有 Common Lisp 实现都编译为本机代码。（然而，是否应该将 CL 视为一种函数式语言取决于术语“函数式”的含义。）

[MLton](http://mlton.org/)是标准 ML 的高度优化编译器。

函数式语言可以并且已经被非常有效地编译了一段时间。在这方面，命令式语言没有区别。

# messaging - Web 应用程序到用户即时消息传递

> ID：104733
> 
> 赞同：1
> 
> 时间：2008-09-19T19:19:55.020
> 
> 标签：messaging

有哪些选项可用于从 Web 应用程序接收即时警报？

我需要处理一个时间敏感的 Web 应用程序（批准加急采购订单请求）。我曾想过通过电子邮件和短信收到通知。

是否有任何程序可以让我的网站直接向我的屏幕发送弹出窗口？或任何其他即时通知选项？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-19T19:30:42.263

在您的帐户详细信息中包含即时通讯器字段。当您的应用程序处理加急订单时，将通知放入队列中。如果他们的即时通讯工具字段为空，请提示他们。编写一个 XMPP (Jabber) 机器人，消耗该队列中的项目并将它们发送出去。使用传输来启用其他网络、MSN Messenger 用户等的功能。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-19T19:21:51.440

您总是可以让它通过 Jabber（或您选择的任何 IM 网络）发送消息。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-19T19:23:23.527

如果您打开了应用程序并且希望出现一个弹出窗口，您可以有一个 javascript 计时器，它每隔一段时间对您的服务器进行一次 ajax 样式轮询，以查看是否有需要发布的通知。然后你可以弹出一个带有通知的弹出窗口吗？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-19T19:27:18.573

您还可以将 RSS 提要绑定到应用程序中，该应用程序将在发生某些事情时立即发布更新。当然，这需要您有一个 RSS 阅读器不断 ping 应用程序。

同样，如果您使用 log4j/log4net 框架，您可以为这些操作记录“致命”或其他特殊事件，并配置 appender 以通过 SMS、电子邮件等方式通知您。

……哦，想想吧。如果您使用的是基于 .NET 的应用程序，log4net 有一个 NetSendAppender，它“将日志事件写入 Windows Messenger 服务。这些消息显示在用户终端的对话框中。”

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-19T19:27:47.403

这个问题还不够具体，无法回答。从高层次的角度来看，这个通知可能是从服务器进程而不是客户端通过 JavaScript 发送的。在不了解服务器端开发语言的情况下，我不能说可能有哪些特定的库可用，但是 SourceForge 上提供了[PhpTocLib](http://sourceforge.net/projects/phptoclib/) PHP 库，尽管我不确定它的最新程度。

另一种选择是注册 twitter 或类似服务，并在您有兴趣更新时向自己发送直接消息。这可以通过应用程序中的简单 HTTP POST 来完成，并且您可以使用各种微博服务提供的任何方法（包括 SMS）接收通知。

# php - 如何确定新商品的订单？

> ID：104747
> 
> 赞同：0
> 
> 时间：2008-09-19T19:21:16.403
> 
> 标签：php, mysql

我在 MySQL 中有一个成员表

```
CREATE TABLE  `members` (
  `id` int(10) unsigned NOT NULL auto_increment,
  `name` varchar(65) collate utf8_unicode_ci NOT NULL,
  `order` tinyint(3) unsigned NOT NULL default '0',
  PRIMARY KEY  (`id`)
) ENGINE=InnoDB; 
```

我想让用户按他们喜欢的方式订购会员。我将订单存储在`order`列中。

我想知道如何插入要添加到列表底部的新用户。这就是我今天所拥有的：

```
$db->query('insert into members VALUES (0, "new member", 0)');
$lastId = $db->lastInsertId();
$maxOrder = $db->fetchAll('select MAX(`order`) max_order FROM members');
$db->query('update members 
            SET 
                `order` = ?
            WHERE 
                 id = ?', 
           array(
               $maxOrder[0]['max_order'] + 1, 
               $lastId
        )); 
```

但这并不是很精确，当有多个用户同时添加新成员时，可能`MAX(order)`会返回相同的值。

您如何处理此类案件？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-19T19:50:13.697

您可以将 SELECT 作为 INSERT 的一部分执行，例如：

```
INSERT INTO members SELECT 0, "new member", max(`order`)+1 FROM members;
```

请记住，您将希望在`order`列上有一个索引以优化 SELECT 部分。

此外，您可能需要重新考虑用于订单的 tinyint，除非您只期望只有 255 个订单。

此外 order 是一个保留字，您总是需要将其写为 `order`，因此您也可以考虑重命名该列。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-19T19:25:35.207

由于您已经为每个新成员自动增加 id，因此您可以按 id 排序。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-19T19:27:05.517

我不确定我是否理解。如果每个用户想要不同的顺序，您将如何将个人用户偏好存储在“成员”表的一个字段中？

通常你只是让用户根据字段的自然顺序进行排序。订单字段的用途是什么？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-19T19:32:40.370

通常我让我所有的选择语句按“顺序，名称”排序；然后我总是为 Order 插入相同的值（0 或 9999999，具体取决于我想要它们是第一个还是最后一个）。然后用户可以根据自己的喜好重新排序。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-19T19:32:46.750

InnoDB 支持事务。在插入之前做一个“开始”语句，当你完成时做一个提交。有关mySql 中事务的说明，请参阅[本文。](http://www.databasejournal.com/features/mysql/article.php/3382171)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-19T20:21:02.267

您可以做的是创建一个带有映射到另一个 member_id 的键 (member_id,position) 的表。然后，您可以将排序与成员列表本身分开存储在该表中。（每个成员都保留自己的列表顺序，这就是我假设你想要的......？）

假设您有一个这样的成员表：

```
+-----------+--------------+
| member_id | name         |
+-----------+--------------+
|         1 | John Smith   |
|         2 | John Doe     |
|         3 | John Johnson |
|         4 | Sue Someone  |
+-----------+--------------+ 
```

然后，你可以有一个这样的排序表：

```
+---------------+----------+-----------------+
| member_id_key | position | member_id_value |
+---------------+----------+-----------------+
|             1 |        1 |               4 |
|             1 |        2 |               1 |
|             1 |        3 |               3 |
|             1 |        4 |               2 |
|             2 |        2 |               1 |
|             2 |        3 |               2 |
+---------------+----------+-----------------+ 
```

您可以使用内部连接来选择给定存储顺序的成员列表。例如：

```
SELECT name
FROM members inner join orderings 
  ON members.member_id = orderings.member_id_value
WHERE orderings.member_id_key = <ID for member you want to lookup>
ORDER BY position; 
```

例如，对 John Smith 的列表（即 WHERE member_id_key = 1）运行此查询的结果将是：

```
+--------------+
| name         |
+--------------+
| Sue Someone  |
| John Smith   |
| John Johnson |
| John Doe     |
+--------------+ 
```

您可以通过将给定 id 的最大位置值加一来计算添加到列表底部的位置。

# c# - Asp.net c# 并在每个页面和频率上记录 ip 访问

> ID：104764
> 
> 赞同：0
> 
> 时间：2008-09-19T19:23:10.893
> 
> 标签：c#, logging, ip-address

有没有为此预建的模块？每次加载页面时都会调用一个事件吗？我只是想保护我更重要的管理部分之一。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-19T19:38:44.817

正如吹镖所说，简单的 IP 地址日志记录已经由 IIS 处理。只需右键单击 Internet 信息服务 (IIS) 管理器工具中的网站，转到网站选项卡，然后选中启用日志记录框。您还可以自定义记录的信息。

如果要将站点甚至站点的文件夹限制为特定 IP，只需转到 IIS 管理器中要保护的 IIS 站点或文件夹属性，右键单击并选择属性。选择目录安全选项卡。在中间，您应该看到“IP 地址和域名限制。您可以在此处设置要阻止或允许的 IP。

如果您想在 ASP.Net 的代码隐藏中以编程方式执行此操作，您可以使用页面 preinit 事件。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-19T19:25:07.300

请提供更多信息；您要记录 IP 还是通过 IP 锁定访问？这两个功能都内置于 IIS 而不是 ASP.NET；那么您是否正在寻找如何以编程方式限制通过 IP 的访问？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-19T19:32:59.573

您可以使用以下方法获取用户的 IP 地址：

```
 Request.ServerVariables["REMOTE_ADDR"] 
```

获得 IP 后，您将不得不编写一些自定义内容来记录它或按 IP 阻止。asp.net 中没有内置的东西可以为您执行此操作。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-19T20:34:54.933

> *每次加载页面时都会调用一个事件吗？*

`Page_Load`可能是你正在寻找的。

但是，我真的不想在这里刻薄，如果您不知道这一点，您可能不应该尝试保护应用程序。你只是经验不够`.Net`

我敢肯定，无论你在什么平台上体验过，你都擅长你所做的事情。但这`.Net WebForms`不是你的强项。这是您应该退后并让其他人处理的时候之一。

# oracle - 使用 SQL*LDR 直接路径加载时间戳数据

> ID：104791
> 
> 赞同：1
> 
> 时间：2008-09-19T19:25:44.023
> 
> 标签：oracle, sql-loader

SQL-LDR 文档指出您需要执行常规路径加载：

> 当您想将 SQL 函数应用于数据字段时。SQL 函数在直接路径加载期间不可用

我将时间戳数据存储在一个 CSV 文件中，我通过如下描述字段来使用 SQL-LDR 加载该文件：

```
STARTTIME       "To_TimeStamp(:STARTTIME,'YYYY-MM-DD HH24:MI:SS.FF6')",
COMPLETIONTIME  "To_TimeStamp(:COMPLETIONTIME,'YYYY-MM-DD HH24:MI:SS.FF6')" 
```

所以我的问题是：您可以在没有函数的情况下加载时间戳数据，还是在加载时间戳数据时无法进行直接路径加载？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-09-19T20:39:40.803

从[这个](http://forums.oracle.com/forums/thread.jspa?messageID=2661160)OTN 论坛线程：

> 你只需要设置环境变量 NLS_TIMESTAMP_FORMAT 来告诉 SQL*Loader 期望时间戳采用什么格式：
> 
> 设置 NLS_TIMESTAMP_FORMAT=YYYY-MM-DD HH24:MI:SS.FF
> 
> ..并从控制文件中完全删除对 to_timestamp 函数的引用。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-19T20:47:43.077

这是某人成功直接加载时间戳数据的示例：
[`Loading Data (Part 4): sqlldr (direct, skip_index_maintainance)`](http://oracle-unix.blogspot.com/2007/07/loading-data-part-4-sqlldr-direct.html)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-23T18:52:42.367

附带说明一下，假设您使用的是更新版本的 Oracle，我们大多数人已经停止使用“sql loader”来获取更高级的版本“外部表”。

# .net - 用于接收图像的 WCF 服务

> ID：104797
> 
> 赞同：1
> 
> 时间：2008-09-19T19:26:43.753
> 
> 标签：.net, wcf, web-services, image

创建用于接受图像的 Web 服务的最佳方法是什么。图像可能很大，我不想更改 Web 应用程序的默认接收大小。我写了一个接受二值图像但我觉得必须有更好的选择。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-19T19:41:55.683

这个图像在哪里“生活”？它可以在本地文件系统还是在 Web 上访问？如果是这样，我建议让您的 WebService 接受 URI（可以是 URL 或本地文件）并将其作为 Stream 打开，然后使用 StreamReader 读取它的内容。

示例（但将异常包装在 FaultExceptions 中，并添加 FaultContractAttributes）：

```
using System.Drawing;
using System.IO;
using System.Net;
using System.Net.Sockets;

[OperationContract]
public void FetchImage(Uri url)
{
    // Validate url

    if (url == null)
    {
        throw new ArgumentNullException(url);
    }

    // If the service doesn't know how to resolve relative URI paths

    /*if (!uri.IsAbsoluteUri)
    {
        throw new ArgumentException("Must be absolute.", url);
    }*/

    // Download and load the image

    Image image = new Func<Bitmap>(() =>
    {
        try
        {
            using (WebClient downloader = new WebClient())
            {
                return new Bitmap(downloader.OpenRead(url));
            }
        }
        catch (ArgumentException exception)
        {
            throw new ResourceNotImageException(url, exception);
        }
        catch (WebException exception)
        {
            throw new ImageDownloadFailedException(url, exception);
        }

        // IOException and SocketException are not wrapped by WebException :(            

        catch (IOException exception)
        {
            throw new ImageDownloadFailedException(url, exception);
        }
        catch (SocketException exception)
        {
            throw new ImageDownloadFailedException(url, exception);
        }
    })();

    // Do something with image

} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-04-06T07:10:37.863

您不能使用 FTP 将图像上传到服务器，然后当服务器（以及 WCF 服务）完成后可以轻松访问它？这样你就不需要考虑接收大小设置等。

至少，我是这样做的。

# java - 为什么 Java 集合不删除通用方法？

> ID：104799
> 
> 赞同：150
> 
> 时间：2008-09-19T19:26:55.330
> 
> 标签：java, generics, collections

为什么[Collection.remove(Object o)](http://java.sun.com/javase/6/docs/api/java/util/Collection.html#remove(java.lang.Object))不是通用的？

好像`Collection<E>`可以有`boolean remove(E o);`

然后，当您不小心尝试从 a 中删除（例如）`Set<String>`而不是每个单独的 String 时`Collection<String>`，这将是编译时错误，而不是稍后的调试问题。

* * *

## 回答 #1

> 赞同：77
> 
> 时间：2008-09-19T21:32:37.757

Josh Bloch 和 Bill Pugh 在[*Java Puzzlers IV: The Phantom Reference Menace, Attack of the Clone 和 Revenge of The Shift*](https://www.youtube.com/watch?v=wDN_EYUvUq0)中提到了这个问题。

Josh Bloch 说（6:41）他们试图泛化 Map 的 get 方法、remove 方法和其他一些方法，但“它根本不起作用”。

如果只允许集合的泛型作为参数类型，有太多合理的程序无法泛化。他给出的例子是s的a和s 的a`List`的交集。`Number``List``Long`

* * *

## 回答 #2

> 赞同：77
> 
> 时间：2009-05-02T19:42:45.253

`remove()`(in`Map`和 in `Collection`) 不是通用的，因为您应该能够将任何类型的对象传递给`remove()`. 移除的对象不必与传入的对象类型相同`remove()`；它只要求它们是平等的。从 的规范中`remove()`，`remove(o)`删除对象`e`是。请注意，没有什么要求和必须是同一类型。这是因为该方法接受一个as 参数，而不仅仅是与对象相同的类型。`(o==null ? e==null : o.equals(e))``true``o``e``equals()``Object`

`equals()`虽然，许多类已经定义了它的对象只能等于它自己的类的对象，这可能是普遍正确的，但情况肯定并非总是如此。例如，规范`List.equals()`说如果两个 List 对象都是 List 并且具有相同的内容，则它们是相等的，即使它们是不同的实现`List`。所以回到这个问题中的例子，`Map<ArrayList, Something>`我可以使用 a 和`remove()`a`LinkedList`作为参数调用，它应该删除作为具有相同内容的列表的键。`remove()`如果是通用的并且限制了它的参数类型，这是不可能的。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-09-19T19:28:52.610

因为如果你的类型参数是通配符，你就不能使用通用的 remove 方法。

我似乎记得使用 Map 的 get(Object) 方法遇到了这个问题。在这种情况下，get 方法不是通用的，尽管它应该合理地期望传递一个与第一个类型参数相同类型的对象。我意识到，如果您使用通配符作为第一个类型参数传递 Maps，那么如果该参数是通用的，则无法使用该方法从 Map 中获取元素。通配符参数不能真正得到满足，因为编译器不能保证类型是正确的。我推测 add 是通用的原因是您应该在将其添加到集合之前保证类型是正确的。但是，当删除一个对象时，如果类型不正确，那么它无论如何都不会匹配任何东西。

我可能没有很好地解释它，但对我来说似乎足够合乎逻辑。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-01-27T11:12:38.937

除了其他答案之外，该方法应该接受一个`Object`谓词还有另一个原因。考虑以下示例：

```
class Person {
    public String name;
    // override equals()
}
class Employee extends Person {
    public String company;
    // override equals()
}
class Developer extends Employee {
    public int yearsOfExperience;
    // override equals()
}

class Test {
    public static void main(String[] args) {
        Collection<? extends Person> people = new ArrayList<Employee>();
        // ...

        // to remove the first employee with a specific name:
        people.remove(new Person(someName1));

        // to remove the first developer that matches some criteria:
        people.remove(new Developer(someName2, someCompany, 10));

        // to remove the first employee who is either
        // a developer or an employee of someCompany:
        people.remove(new Object() {
            public boolean equals(Object employee) {
                return employee instanceof Developer
                    || ((Employee) employee).company.equals(someCompany);
        }});
    }
} 
```

关键是传递给`remove`方法的对象负责定义`equals`方法。通过这种方式构建谓词变得非常简单。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2012-05-28T20:49:08.787

假设一个人有一个集合`Cat`，以及一些类型为`Animal`、`Cat`、`SiameseCat`和的对象引用`Dog`。询问集合是否包含`Cat`or`SiameseCat`引用所指的对象似乎是合理的。询问它是否包含`Animal`引用所指的对象可能看起来很狡猾，但它仍然是完全合理的。毕竟，有问题的对象可能是`Cat`, 并且可能出现在集合中。

此外，即使对象碰巧不是 a `Cat`，也没有问题说它是否出现在集合中——只需回答“不，它没有”。某种类型的“查找样式”集合应该能够有意义地接受任何超类型的引用并确定该对象是否存在于集合中。如果传入的对象引用是不相关的类型，则集合不可能包含它，因此查询在某种意义上是没有意义的（它总是回答“否”）。尽管如此，由于没有任何方法可以将参数限制为子类型或超类型，因此最实际的做法是简单地接受任何类型并对类型与集合无关的任何对象回答“否”。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-09-19T20:40:40.830

我一直认为这是因为 remove() 没有理由关心你给它什么类型的对象。无论如何，检查该对象是否是 Collection 包含的对象之一是很容易的，因为它可以在任何东西上调用 equals()。有必要检查 add() 上的类型以确保它只包含该类型的对象。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2019-07-24T08:21:36.810

这是一种妥协。这两种方法都有其优势：

*   `remove(Object o)`
    *   更灵活。例如，它允许遍历数字列表并将它们从长列表中删除。
    *   使用这种灵活性的代码可以更容易地泛化
*   `remove(E e)`通过在编译时检测细微的错误（例如错误地尝试从短裤列表中删除整数）来为大多数程序想要做的事情带来更多的类型安全性。

向后兼容一直是 Java API 发展的主要目标，因此选择 remove(Object o) 是因为它使生成现有代码更容易。如果向后兼容性不是问题，我猜设计师会选择 remove(E e)。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2008-09-19T19:32:57.890

Remove 不是泛型方法，因此使用非泛型集合的现有代码仍然可以编译并且仍然具有相同的行为。

有关详细信息，请参阅[http://www.ibm.com/developerworks/java/library/j-jtp01255.html](http://www.ibm.com/developerworks/java/library/j-jtp01255.html)。

编辑：评论者问为什么 add 方法是通用的。[...删除了我的解释...] 第二个评论者回答了 firebird84 的问题，比我好得多。

* * *

## 回答 #9

> 赞同：-2
> 
> 时间：2015-11-26T13:25:12.040

另一个原因是接口。这是一个显示它的示例：

```
public interface A {}

public interface B {}

public class MyClass implements A, B {}

public static void main(String[] args) {
   Collection<A> collection = new ArrayList<>();
   MyClass item = new MyClass();
   collection.add(item);  // works fine
   B b = item; // valid
   collection.remove(b); /* It works because the remove method accepts an Object. If it was generic, this would not work */
} 
```

* * *

## 回答 #10

> 赞同：-3
> 
> 时间：2008-09-19T19:47:35.107

因为它会破坏现有的（Java5 之前的）代码。例如，

```
Set stringSet = new HashSet();
// do some stuff...
Object o = "foobar";
stringSet.remove(o); 
```

现在您可能会说上面的代码是错误的，但假设 o 来自一组异构对象（即，它包含字符串、数字、对象等）。您想删除所有匹配项，这是合法的，因为 remove 只会忽略非字符串，因为它们不相等。但是，如果您将其设为 remove(String o)，则不再有效。

# java - 如何使用 JUnit 创建 Maven 插件的自动化测试？

> ID：104803
> 
> 赞同：4
> 
> 时间：2008-09-19T19:27:09.510
> 
> 标签：java, maven-2, automated-tests

我已经开发了一个（大部分）工作插件，但由于它的功能与它处理的项目直接相关，你如何为插件开发单元和集成测试。我的最佳想法是为插件创建一个集成测试项目，该项目在其生命周期内使用该插件，并具有报告插件处理数据成功或失败的测试。

有人有更好的想法吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-19T20:24:07.547

您需要使用[maven-plugin-testing-harness](http://maven.apache.org/shared/maven-plugin-testing-harness/)，

```
    <依赖>
        <groupId>org.apache.maven.shared</groupId>
        <artifactId>maven-plugin-testing-harness</artifactId>
        <版本>1.1</版本>
        <scope>测试</scope>
    </依赖>

```

您从[AbstractMojoTestCase](http://maven.apache.org/shared/maven-plugin-testing-harness/apidocs/org/apache/maven/plugin/testing/AbstractMojoTestCase.html)派生单元测试类。

您需要创建一个简单的 POM，通常在`src/test/resources`文件夹中。

```
    <项目>
        <构建>
            <插件>
                <插件>
                    <groupId>com.mydomain,mytools</groupId>
                    <artifactId>mytool-maven-plugin</artifactId>
                    <配置>
                        <!-- 在此处插入配置设置 -->
                    </配置>
                    <执行>
                        <执行>
                            <目标>
                                <目标>我的目标</目标>
                            </目标>
                        </执行>
                    </执行>
                </插件>
            </插件>
        </build>
    </项目>

```

使用 AbstractMojoTest.lookupMojo(String,File) （或其他变体之一）为特定目标加载 Mojo 并执行它。

```
    最终文件 testPom = new File(PlexusTestCase.getBasedir(), "/target/test-classes/mytools-plugin-config.xml");
    Mojo mojo = this.lookupMojo("mygoal", testPom);
    // 插入断言以验证您的插件是否已正确初始化
    mojo.execute();
    // 插入断言以验证您的插件是否按预期运行

```

我创建了我自己的插件，您可以参考[http://ldap-plugin.btmatthews.com](http://ldap-plugin.btmatthews.com)进行澄清，

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-19T20:58:31.677

如果你想看一些真实世界的例子，Terracotta Maven 插件 (tc-maven-plugin) 有一些测试，你可以在开源 forge 中仔细阅读。

该插件位于： http: [//forge.terracotta.org/releases/projects/tc-maven-plugin/](http://forge.terracotta.org/releases/projects/tc-maven-plugin/)

源代码在 svn 中：[http ://svn.terracotta.org/svn/forge/projects/tc-maven-plugin/trunk/](http://svn.terracotta.org/svn/forge/projects/tc-maven-plugin/trunk/)

在该源代码中，您可以在以下位置找到一些实际的 Maven 插件测试：src/test/java/org/terracotta/maven/plugins/tc/

# .net - 减少在网络驱动器上运行的 .NET Windows 窗体应用程序的启动时间

> ID：104815
> 
> 赞同：3
> 
> 时间：2008-09-19T19:28:51.987
> 
> 标签：.net, performance, startup

我有一个简单的 .NET 2.0 windows 窗体应用程序，它通过网络驱动器运行（例如 \MyServer\MyShare\app.exe）。它非常基础，只加载最少量的 .NET 库。但是，加载仍然需要大约 6-10 秒。人们认为一定有问题，这么小的应用程序需要这么长时间才能加载。

有什么提高启动速度的建议吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-19T19:34:17.027

试用[Sysinternals Process Explorer](http://technet.microsoft.com/en-us/sysinternals/bb896653.aspx)。它有一列“JIT 中的时间百分比”。如果这个数字很大，您可以在您的应用程序上运行[ngen](http://msdn.microsoft.com/en-us/library/6t9t5wcf(VS.80).aspx)。如果不是，则可能是网络连接速度较慢。CodeGuru 有一个关于 ngen[用法的](http://www.codeguru.com/Csharp/.NET/net_general/toolsand3rdparty/article.php/c4651)教程。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-19T19:37:50.810

为了加快加载时间，您可以编译一个小型启动应用程序，并让该应用程序在运行时从 bin 文件夹外的库加载程序集。

[http://support.microsoft.com/kb/837908](http://support.microsoft.com/kb/837908)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-19T19:53:11.147

确定衡量 NGEN 可行性的 JIT 时间无疑是一个很好的起点。我也同意那些希望通过使用另一个入口点然后加载程序集来捏造加载时间的人。通常，改善用户体验的是速度的***外观***与***实际速度的对比。***

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-19T19:32:18.483

为应用程序设置 Clickonce，以便将其部署到本地计算机。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-19T19:32:47.267

您可以像 Microsoft Office（我认为是 Adob​​e）那样作弊，并在 Startup 组中添加一个应用程序，告诉应用程序加载然后立即卸载。这样，当用户尝试启动应用程序时，DLL 就会预先缓存在内存中。只有抓住：我不完全确定它是否以这种方式与网络文件一起工作 - 如果不是，这可能是慢启动的原因（即你总是在做冷启动而不是可能的热启动如果从本地计算机运行）。

# c# - Winform 应用程序分析 CPU 使用率/峰值。

> ID：104831
> 
> 赞同：1
> 
> 时间：2008-09-19T19:32:04.787
> 
> 标签：c#, winforms, performance, optimization, cpu

我有一个 Winforms 应用程序，它通常占用大约 2-4% 的 CPU。我们在有限的时间内看到了高达 27% 的 CPU 峰值。什么是最好的分析工具来确定究竟是什么导致了这个峰值。我们使用 dottrace，但我不知道如何将其准确映射到 CPU 峰值？

感谢帮助

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-19T19:47:56.480

我之前使用过 2 个分析工具 - RedGate 的 ANTS 分析器，以及 Visual Studio Team System 中的内置分析器。

自从我使用 RedGate 的 ( [http://www.red-gate.com/products/ants_profiler/index.htm](http://www.red-gate.com/products/ants_profiler/index.htm) ) 分析器已经有一段时间了，尽管我最近使用了 Visual Studio 2008 中的内置工具。

话虽如此，我觉得 RedGate 产品使用起来更直观。当我使用 RedGate 产品时，让我感到沮丧的一件事是，我无法指示分析器仅从某个点开始分析我的代码 - 我遇到了性能损失，直到有相当数量的代码才达到已经执行，因此污染了我的结果。从那时起，他们可能已经添加了该功能。

Visual Studio 的内置版本仅在其非常高端的产品版本中可用。如果我错了，请有人纠正我，但我认为即使是“专业”版本也没有分析器。我目前正在使用 Team System Developer Edition，它*确实*具有代码分析工具。

VS 版本确实做的一件事是让您暂停分析，甚至在暂停分析的情况下启动您的应用程序，这样您就可以真正专注于非常具体的事情的性能。当您试图理解分析结果时，这会非常有用。

编辑：这两个工具都会显示内存使用情况，特定方法被调用的次数，以及每个方法花费了多少时间。据我所知，他们不做的是向您显示任何给定时间点的 CPU 使用情况。但是，CPU 使用率和在给定代码块中花费的时间之间可能存在很强的相关性。

如果您可以通过在 APP 中调用某些操作来持续复制 CPU 峰值，那么我要做的就是尝试使用 VS 分析器，在分析暂停的情况下启动应用程序，在您执行任何通常会导致的操作之前启用分析尖峰，并检查这些结果。

这当然假设您有某种确定性行为来重新创建尖峰。如果不是……您可能会考虑将线程进程或垃圾收集作为您的性能影响的候选者。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-26T04:40:41.000

我发现 Compuware [http://www.compuware.com/](http://www.compuware.com/)的 DevPartner 是一个出色的分析工具。不幸的是，目前他们似乎不支持 VS 2008。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-01T16:17:41.477

另外，这个峰值真的令人担忧吗？你在什么样的硬件上看到了这个？在四核 CPU 上飙升至 27% 可能会令人担忧，但在 800Mhz P3 上则不会。

它会保持多长时间？[@Matt](https://stackoverflow.com/questions/104831/winform-application-profiling-cpu-usage-spikes#104945)有一个很好的观点，即垃圾收集可能有问题。或者可能交换到磁盘。

它是长时间影响整体系统性能，还是时不时地影响几秒钟？

并不是说找到解决方案不应该被关注，但它有多重要？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-10T15:08:30.180

您还可以使用 Sysinternal Process Explorer 和 Perfmon 了解有关您的应用程序的很多信息（就像 GC 上出现峰值一样）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-04T23:26:29.463

如果您的应用程序是单线程的，[那么最好的分析工具就是您的 IDE。](http://www.wikihow.com/Optimize-Your-Program%27s-Performance)

补充：也许这很明显，但是百分比 CPU 使用率并不是一个很明确的概念。当你的程序完全运行时，它是 100%。如果不是，则为 0%。因此，部分百分比必须基于某种随时间推移的平滑积分。但是，无论它是什么，您都会看到一个峰值。一些分析器可让您了解这样的峰值并仅分析该间隔。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-06-05T01:10:40.857

Xperf/Xperfview 工具是向您显示尖峰并允许您深入了解导致它的原因的最佳工具。

查看 [http://msdn.microsoft.com/en-us/performance/cc825801.aspx](http://msdn.microsoft.com/en-us/performance/cc825801.aspx)

和 [http://msdn.microsoft.com/en-us/library/cc305221.aspx](http://msdn.microsoft.com/en-us/library/cc305221.aspx)

这些工具基于 ETW 技术（Windows 事件跟踪），它可以让您超级准确地了解您的流程和整个系统正在发生的事情。

这些工具还允许您捕获跟踪以进行事后分析，以及附加/分离功能。希望这可以帮助。

# ruby-on-rails - 服务器上的 Rails 会话

> ID：104837
> 
> 赞同：6
> 
> 时间：2008-09-19T19:32:51.727
> 
> 标签：ruby-on-rails, session, cross-server

我希望在不同服务器上共享相同会话的一些 Rails 应用程序。我可以在同一台服务器上完成，但不知道是否可以在不同的服务器上共享。有人已经做过或知道怎么做吗？

谢谢

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-19T19:55:54.013

使用[数据库会话存储](https://github.com/rails/activerecord-session_store)。它的短处是这样的：

> 要生成表，请在控制台中运行
> 
> ```
> rake db:sessions:create 
> ```
> 
> 在你的 environment.rb 中，包括这一行
> 
> ```
> config.action_controller.session_store = :active_record_store 
> ```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-19T19:39:06.127

根据您的应用程序的设置方式，您*可以通过将您的应用程序设置为使用相同的秘密：* [http://www.russellquinn](http://www.russellquinn.com/2008/01/30/multiple-rails-applications/)，轻松地共享来自同一域（foo.domain、bar.domain、域）中的站点的 cookie 。 [com/2008/01/30/multiple-rails-applications/](http://www.russellquinn.com/2008/01/30/multiple-rails-applications/)

现在，如果您有不同的站点，例如 sdfsf.com、dsfsadfsdafdsaf.com 等，您将不得不做更多的技巧，因为 cookie 的本质将它们限制在特定的域中。本质上，您尝试做的是使用跨站点脚本，而不是劫持您的会话，而是从其他会话中读取它。

在这种情况下，结合使用相同的 cookie 秘密等，然后使用一些跨站点脚本，您可以手动提取会话信息并在每个站点上重新创建它（或者如果您使用 ActiveRecord 会话 {或 NFS 会话目录}，请链接与现有的一样）。这并不容易，但可以做到。

或者，低技术的方式（我以前做过）只是让登录页面访问每个站点上的特制登录页面，该页面设置一个应用程序 cookie 并将您弹回下一个。它不漂亮。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-19T19:39:03.677

尝试使用数据库支持的会话。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-19T19:55:56.570

在 Rails 2.0 中，现在有一个 CookieStore，它将所有会话数据存储在客户端机器上的加密 cookie 中。

[http://izumi.plan99.net/blog/index.php/2007/11/25/rails-20-cookie-session-store-and-security/](http://izumi.plan99.net/blog/index.php/2007/11/25/rails-20-cookie-session-store-and-security/)

# c++ - 非托管 C++ 中的默认打印机

> ID：104844
> 
> 赞同：2
> 
> 时间：2008-09-19T19:34:43.347
> 
> 标签：c++, windows, unmanaged, default, printing

我正在寻找一种方法来使用非托管 C++ 查找 Windows 默认打印机的名称（找到大量 .NET 示例，但没有成功非托管）。谢谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-19T19:39:36.953

以下内容非常适合使用 C++ 中的 win32api 进行打印

```
char szPrinterName[255];
unsigned long lPrinterNameLength;
GetDefaultPrinter( szPrinterName, &lPrinterNameLength );
HDC hPrinterDC;
hPrinterDC = CreateDC("WINSPOOL\0", szPrinterName, NULL, NULL); 
```

将来不要使用谷歌搜索“非托管”，而是尝试谷歌搜索“win32 /subject/”或“win32 api /subject/”

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-19T19:42:35.293

以下是如何获取当前打印机列表和默认打印机列表（如果有一台设置为默认打印机）。

另请注意：如果用户没有打印机或未将默认设置为 1，则默认打印机名称长度为零是有效的。

还应该支持处理长打印机名称，因此首先使用 NULL 作为缓冲区指针调用 GetDefaultPrinter 将返回名称长度，然后您可以分配一个足够大的名称缓冲区来保存名称。

```
DWORD numprinters;
DWORD defprinter=0;
DWORD               dwSizeNeeded=0;
DWORD               dwItem;
LPPRINTER_INFO_2    printerinfo = NULL;

// Get buffer size

EnumPrinters ( PRINTER_ENUM_LOCAL | PRINTER_ENUM_CONNECTIONS , NULL, 2, NULL, 0, &dwSizeNeeded, &numprinters );

// allocate memory
//printerinfo = (LPPRINTER_INFO_2)HeapAlloc ( GetProcessHeap (), HEAP_ZERO_MEMORY, dwSizeNeeded );
printerinfo = (LPPRINTER_INFO_2)new char[dwSizeNeeded];

if ( EnumPrinters ( PRINTER_ENUM_LOCAL | PRINTER_ENUM_CONNECTIONS,      // what to enumerate
            NULL,           // printer name (NULL for all)
            2,              // level
            (LPBYTE)printerinfo,        // buffer
            dwSizeNeeded,       // size of buffer
            &dwSizeNeeded,      // returns size
            &numprinters            // return num. items
          ) == 0 )
{
    numprinters=0;
}

{
    DWORD size=0;   

    // Get the size of the default printer name.
    GetDefaultPrinter(NULL, &size);
    if(size)
    {
       // Allocate a buffer large enough to hold the printer name.
        TCHAR* buffer = new TCHAR[size];

          // Get the printer name.
        GetDefaultPrinter(buffer, &size);

        for ( dwItem = 0; dwItem < numprinters; dwItem++ )
        {
                          if(!strcmp(buffer,printerinfo[dwItem].pPrinterName))
                defprinter=dwItem;
        }
        delete buffer;
    }
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-19T19:46:03.553

如何在 Windows 中检索和设置默认打印机：

[http://support.microsoft.com/default.aspx?scid=kb;EN-US;246772](http://support.microsoft.com/default.aspx?scid=kb;EN-US;246772)

来自现在不可用文章的代码：

```
// You are explicitly linking to GetDefaultPrinter because linking 
// implicitly on Windows 95/98 or NT4 results in a runtime error.
// This block specifies which text version you explicitly link to.
#ifdef UNICODE
  #define GETDEFAULTPRINTER "GetDefaultPrinterW"
#else
  #define GETDEFAULTPRINTER "GetDefaultPrinterA"
#endif

// Size of internal buffer used to hold "printername,drivername,portname"
// string. You may have to increase this for huge strings.
#define MAXBUFFERSIZE 250

/*----------------------------------------------------------------*/ 
/* DPGetDefaultPrinter                                            */ 
/*                                                                */ 
/* Parameters:                                                    */ 
/*   pPrinterName: Buffer alloc'd by caller to hold printer name. */ 
/*   pdwBufferSize: On input, ptr to size of pPrinterName.        */ 
/*          On output, min required size of pPrinterName.         */ 
/*                                                                */ 
/* NOTE: You must include enough space for the NULL terminator!   */ 
/*                                                                */ 
/* Returns: TRUE for success, FALSE for failure.                  */ 
/*----------------------------------------------------------------*/ 
BOOL DPGetDefaultPrinter(LPTSTR pPrinterName, LPDWORD pdwBufferSize)
{
  BOOL bFlag;
  OSVERSIONINFO osv;
  TCHAR cBuffer[MAXBUFFERSIZE];
  PRINTER_INFO_2 *ppi2 = NULL;
  DWORD dwNeeded = 0;
  DWORD dwReturned = 0;
  HMODULE hWinSpool = NULL;
  PROC fnGetDefaultPrinter = NULL;

  // What version of Windows are you running?
  osv.dwOSVersionInfoSize = sizeof(OSVERSIONINFO);
  GetVersionEx(&osv);

  // If Windows 95 or 98, use EnumPrinters.
  if (osv.dwPlatformId == VER_PLATFORM_WIN32_WINDOWS)
  {
    // The first EnumPrinters() tells you how big our buffer must
    // be to hold ALL of PRINTER_INFO_2\. Note that this will
    // typically return FALSE. This only means that the buffer (the 4th
    // parameter) was not filled in. You do not want it filled in here.
    SetLastError(0);
    bFlag = EnumPrinters(PRINTER_ENUM_DEFAULT, NULL, 2, NULL, 0, &dwNeeded, &dwReturned);
    {
      if ((GetLastError() != ERROR_INSUFFICIENT_BUFFER) || (dwNeeded == 0))
        return FALSE;
    }

    // Allocate enough space for PRINTER_INFO_2.
    ppi2 = (PRINTER_INFO_2 *)GlobalAlloc(GPTR, dwNeeded);
    if (!ppi2)
      return FALSE;

    // The second EnumPrinters() will fill in all the current information.
    bFlag = EnumPrinters(PRINTER_ENUM_DEFAULT, NULL, 2, (LPBYTE)ppi2, dwNeeded, &dwNeeded, &dwReturned);
    if (!bFlag)
    {
      GlobalFree(ppi2);
      return FALSE;
    }

    // If specified buffer is too small, set required size and fail.
    if ((DWORD)lstrlen(ppi2->pPrinterName) >= *pdwBufferSize)
    {
      *pdwBufferSize = (DWORD)lstrlen(ppi2->pPrinterName) + 1;
      GlobalFree(ppi2);
      return FALSE;
    }

    // Copy printer name into passed-in buffer.
    lstrcpy(pPrinterName, ppi2->pPrinterName);

    // Set buffer size parameter to minimum required buffer size.
    *pdwBufferSize = (DWORD)lstrlen(ppi2->pPrinterName) + 1;
  }

  // If Windows NT, use the GetDefaultPrinter API for Windows 2000,
  // or GetProfileString for version 4.0 and earlier.
  else if (osv.dwPlatformId == VER_PLATFORM_WIN32_NT)
  {
    if (osv.dwMajorVersion >= 5) // Windows 2000 or later (use explicit call)
    {
      hWinSpool = LoadLibrary("winspool.drv");
      if (!hWinSpool)
        return FALSE;
      fnGetDefaultPrinter = GetProcAddress(hWinSpool, GETDEFAULTPRINTER);
      if (!fnGetDefaultPrinter)
      {
        FreeLibrary(hWinSpool);
        return FALSE;
      }

      bFlag = fnGetDefaultPrinter(pPrinterName, pdwBufferSize);
        FreeLibrary(hWinSpool);
      if (!bFlag)
        return FALSE;
    }

    else // NT4.0 or earlier
    {
      // Retrieve the default string from Win.ini (the registry).
      // String will be in form "printername,drivername,portname".
      if (GetProfileString("windows", "device", ",,,", cBuffer, MAXBUFFERSIZE) <= 0)
        return FALSE;

      // Printer name precedes first "," character.
      strtok(cBuffer, ",");

      // If specified buffer is too small, set required size and fail.
      if ((DWORD)lstrlen(cBuffer) >= *pdwBufferSize)
      {
        *pdwBufferSize = (DWORD)lstrlen(cBuffer) + 1;
        return FALSE;
      }

      // Copy printer name into passed-in buffer.
      lstrcpy(pPrinterName, cBuffer);

      // Set buffer size parameter to minimum required buffer size.
      *pdwBufferSize = (DWORD)lstrlen(cBuffer) + 1;
    }
  }

  // Clean up.
  if (ppi2)
    GlobalFree(ppi2);

  return TRUE;
}
#undef MAXBUFFERSIZE
#undef GETDEFAULTPRINTER

// You are explicitly linking to SetDefaultPrinter because implicitly
// linking on Windows 95/98 or NT4 results in a runtime error.
// This block specifies which text version you explicitly link to.
#ifdef UNICODE
  #define SETDEFAULTPRINTER "SetDefaultPrinterW"
#else
  #define SETDEFAULTPRINTER "SetDefaultPrinterA"
#endif

/*-----------------------------------------------------------------*/ 
/* DPSetDefaultPrinter                                             */ 
/*                                                                 */ 
/* Parameters:                                                     */ 
/*   pPrinterName: Valid name of existing printer to make default. */ 
/*                                                                 */ 
/* Returns: TRUE for success, FALSE for failure.                   */ 
/*-----------------------------------------------------------------*/ 
BOOL DPSetDefaultPrinter(LPTSTR pPrinterName)

{
  BOOL bFlag;
  OSVERSIONINFO osv;
  DWORD dwNeeded = 0;
  HANDLE hPrinter = NULL;
  PRINTER_INFO_2 *ppi2 = NULL;
  LPTSTR pBuffer = NULL;
  LONG lResult;
  HMODULE hWinSpool = NULL;
  PROC fnSetDefaultPrinter = NULL;

  // What version of Windows are you running?
  osv.dwOSVersionInfoSize = sizeof(OSVERSIONINFO);
  GetVersionEx(&osv);

  if (!pPrinterName)
    return FALSE;

  // If Windows 95 or 98, use SetPrinter.
  if (osv.dwPlatformId == VER_PLATFORM_WIN32_WINDOWS)
  {
    // Open this printer so you can get information about it.
    bFlag = OpenPrinter(pPrinterName, &hPrinter, NULL);
    if (!bFlag || !hPrinter)
      return FALSE;

    // The first GetPrinter() tells you how big our buffer must
    // be to hold ALL of PRINTER_INFO_2\. Note that this will
    // typically return FALSE. This only means that the buffer (the 3rd
    // parameter) was not filled in. You do not want it filled in here.
    SetLastError(0);
    bFlag = GetPrinter(hPrinter, 2, 0, 0, &dwNeeded);
    if (!bFlag)
    {
      if ((GetLastError() != ERROR_INSUFFICIENT_BUFFER) || (dwNeeded == 0))
      {
        ClosePrinter(hPrinter);
        return FALSE;
      }
    }

    // Allocate enough space for PRINTER_INFO_2.
    ppi2 = (PRINTER_INFO_2 *)GlobalAlloc(GPTR, dwNeeded);
    if (!ppi2)
    {
      ClosePrinter(hPrinter);
      return FALSE;
    }

    // The second GetPrinter() will fill in all the current information
    // so that all you have to do is modify what you are interested in.
    bFlag = GetPrinter(hPrinter, 2, (LPBYTE)ppi2, dwNeeded, &dwNeeded);
    if (!bFlag)
    {
      ClosePrinter(hPrinter);
      GlobalFree(ppi2);
      return FALSE;
    }

    // Set default printer attribute for this printer.
    ppi2->Attributes |= PRINTER_ATTRIBUTE_DEFAULT;
    bFlag = SetPrinter(hPrinter, 2, (LPBYTE)ppi2, 0);
    if (!bFlag)
    {
      ClosePrinter(hPrinter);
      GlobalFree(ppi2);
      return FALSE;
    }

    // Tell all open programs that this change occurred. 
    // Allow each program 1 second to handle this message.
    lResult = SendMessageTimeout(HWND_BROADCAST, WM_SETTINGCHANGE, 0L,
      (LPARAM)(LPCTSTR)"windows", SMTO_NORMAL, 1000, NULL);
  }

  // If Windows NT, use the SetDefaultPrinter API for Windows 2000,
  // or WriteProfileString for version 4.0 and earlier.
  else if (osv.dwPlatformId == VER_PLATFORM_WIN32_NT)
  {
    if (osv.dwMajorVersion >= 5) // Windows 2000 or later (use explicit call)
    {
      hWinSpool = LoadLibrary("winspool.drv");
      if (!hWinSpool)
        return FALSE;
      fnSetDefaultPrinter = GetProcAddress(hWinSpool, SETDEFAULTPRINTER);
      if (!fnSetDefaultPrinter)
      {
        FreeLibrary(hWinSpool);
        return FALSE;
      }

      bFlag = fnSetDefaultPrinter(pPrinterName);
      FreeLibrary(hWinSpool);
      if (!bFlag)
        return FALSE;
    }

    else // NT4.0 or earlier
    {
      // Open this printer so you can get information about it.
      bFlag = OpenPrinter(pPrinterName, &hPrinter, NULL);
      if (!bFlag || !hPrinter)
        return FALSE;

      // The first GetPrinter() tells you how big our buffer must
      // be to hold ALL of PRINTER_INFO_2\. Note that this will
      // typically return FALSE. This only means that the buffer (the 3rd
      // parameter) was not filled in. You do not want it filled in here.
      SetLastError(0);
      bFlag = GetPrinter(hPrinter, 2, 0, 0, &dwNeeded);
      if (!bFlag)
      {
        if ((GetLastError() != ERROR_INSUFFICIENT_BUFFER) || (dwNeeded == 0))
        {
          ClosePrinter(hPrinter);
          return FALSE;
        }
      }

      // Allocate enough space for PRINTER_INFO_2.
      ppi2 = (PRINTER_INFO_2 *)GlobalAlloc(GPTR, dwNeeded);
      if (!ppi2)
      {
        ClosePrinter(hPrinter);
        return FALSE;
      }

      // The second GetPrinter() fills in all the current<BR/>
      // information.
      bFlag = GetPrinter(hPrinter, 2, (LPBYTE)ppi2, dwNeeded, &dwNeeded);
      if ((!bFlag) || (!ppi2->pDriverName) || (!ppi2->pPortName))
      {
        ClosePrinter(hPrinter);
        GlobalFree(ppi2);
        return FALSE;
      }

      // Allocate buffer big enough for concatenated string.
      // String will be in form "printername,drivername,portname".
      pBuffer = (LPTSTR)GlobalAlloc(GPTR,
        lstrlen(pPrinterName) +
        lstrlen(ppi2->pDriverName) +
        lstrlen(ppi2->pPortName) + 3);
      if (!pBuffer)
      {
        ClosePrinter(hPrinter);
        GlobalFree(ppi2);
        return FALSE;
      }

      // Build string in form "printername,drivername,portname".
      lstrcpy(pBuffer, pPrinterName);  lstrcat(pBuffer, ",");
      lstrcat(pBuffer, ppi2->pDriverName);  lstrcat(pBuffer, ",");
      lstrcat(pBuffer, ppi2->pPortName);

      // Set the default printer in Win.ini and registry.
      bFlag = WriteProfileString("windows", "device", pBuffer);
      if (!bFlag)
      {
        ClosePrinter(hPrinter);
        GlobalFree(ppi2);
        GlobalFree(pBuffer);
        return FALSE;
      }
    }

    // Tell all open programs that this change occurred. 
    // Allow each app 1 second to handle this message.
    lResult = SendMessageTimeout(HWND_BROADCAST, WM_SETTINGCHANGE, 0L, 0L,
      SMTO_NORMAL, 1000, NULL);
  }

  // Clean up.
  if (hPrinter)
    ClosePrinter(hPrinter);
  if (ppi2)
    GlobalFree(ppi2);
  if (pBuffer)
    GlobalFree(pBuffer);

  return TRUE;
}
#undef SETDEFAULTPRINTER 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-19T19:41:59.723

GetDefaultPrinter [(MSDN)](http://msdn.microsoft.com/en-us/library/ms535475(VS.85).aspx)应该可以解决问题。这将使您获得传递给 CreateDC 以进行打印的名称。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-09-19T19:43:50.453

非托管 C++ 不存在（托管 C++ 现在是 C++/CLI），如果您指的是 C++，则使用非托管作为标记只是可悲...

# c# - 测试字符串是否是一个没有抛出异常的 guid？

> ID：104850
> 
> 赞同：185
> 
> 时间：2008-09-19T19:35:34.123
> 
> 标签：c#, string, parsing, guid

我想尝试将字符串转换为 Guid，但我不想依赖捕获异常（

*   出于性能原因 - 异常是昂贵的
*   出于可用性原因 - 调试器弹出
*   出于设计原因 - 预期也不例外

换句话说，代码：

```
public static Boolean TryStrToGuid(String s, out Guid value)
{
    try
    {
        value = new Guid(s);
        return true;
    }
    catch (FormatException)
    {
        value = Guid.Empty;
        return false;
    }
} 
```

不适合。

我会尝试使用正则表达式，但由于 guid 可以用括号包裹、大括号包裹、不包裹，所以很难。

此外，我认为某些 Guid 值无效（？）

* * *

**更新 1**

[ChristianK](https://stackoverflow.com/questions/104850/c-test-if-string-is-a-guid-without-throwing-exceptions#137829)有一个好主意，只捕获`FormatException`，而不是全部。更改了问题的代码示例以包含建议。

* * *

**更新 2**

为什么要担心抛出的异常？我真的经常期待无效的 GUID 吗？

答案是*肯定*的。这就是我使用 TryStrToGuid 的原因 - 我**期待**错误的数据。

**示例 1** [可以通过将 GUID 附加到文件夹名称来指定命名空间扩展](http://msdn.microsoft.com/en-us/library/cc144096(VS.85).aspx)。我可能正在解析文件夹名称，检查最后的**.** 是一个 GUID。

```
c:\Program Files
c:\Program Files.old
c:\Users
c:\Users.old
c:\UserManager.{CE7F5AA5-6832-43FE-BAE1-80D14CD8F666}
c:\Windows
c:\Windows.old 
```

**示例 2**我可能正在运行一个频繁使用的 Web 服务器，想要检查一些回发数据的有效性。我不希望无效数据占用比所需资源高 2-3 个数量级的资源。

**示例 3**我可能正在解析用户输入的搜索表达式。

![在此处输入图像描述](../Images/d00c05a7fa8855d9c274818176331b71.png)

如果他们输入 GUID，我想专门处理它们（例如专门搜索该对象，或在响应文本中突出显示和格式化该特定搜索词。）

* * *

**更新 3 - 性能基准**

测试转换 10,000 个好的 Guid 和 10,000 个坏的 Guid。

```
Catch FormatException:
   10,000 good:     63,668 ticks
   10,000 bad:   6,435,609 ticks

Regex Pre-Screen with try-catch:
   10,000 good:    637,633 ticks
   10,000 bad:     717,894 ticks

COM Interop CLSIDFromString
   10,000 good:    126,120 ticks
   10,000 bad:      23,134 ticks 
```

*ps 我不应该证明一个问题的合理性。*

* * *

## 回答 #1

> 赞同：109
> 
> 时间：2008-11-13T19:00:03.017

**性能基准**

```
Catch exception:
   10,000 good:    63,668 ticks
   10,000 bad:  6,435,609 ticks

Regex Pre-Screen:
   10,000 good:   637,633 ticks
   10,000 bad:    717,894 ticks

COM Interop CLSIDFromString
   10,000 good:   126,120 ticks
   10,000 bad:     23,134 ticks 
```

**COM Intertop（最快）答案：**

```
/// <summary>
/// Attempts to convert a string to a guid.
/// </summary>
/// <param name="s">The string to try to convert</param>
/// <param name="value">Upon return will contain the Guid</param>
/// <returns>Returns true if successful, otherwise false</returns>
public static Boolean TryStrToGuid(String s, out Guid value)
{
   //ClsidFromString returns the empty guid for null strings   
   if ((s == null) || (s == ""))   
   {      
      value = Guid.Empty;      
      return false;   
   }

   int hresult = PInvoke.ObjBase.CLSIDFromString(s, out value);
   if (hresult >= 0)
   {
      return true;
   }
   else
   {
      value = Guid.Empty;
      return false;
   }
}

namespace PInvoke
{
    class ObjBase
    {
        /// <summary>
        /// This function converts a string generated by the StringFromCLSID function back into the original class identifier.
        /// </summary>
        /// <param name="sz">String that represents the class identifier</param>
        /// <param name="clsid">On return will contain the class identifier</param>
        /// <returns>
        /// Positive or zero if class identifier was obtained successfully
        /// Negative if the call failed
        /// </returns>
        [DllImport("ole32.dll", CharSet = CharSet.Unicode, ExactSpelling = true, PreserveSig = true)]
        public static extern int CLSIDFromString(string sz, out Guid clsid);
    }
} 
```

* * *

底线：如果您需要检查字符串是否为 guid，并且您关心性能，请使用 COM 互操作。

如果您需要将字符串表示形式的 guid 转换为 Guid，请使用

```
new Guid(someString); 
```

* * *

## 回答 #2

> 赞同：91
> 
> 时间：2009-12-31T04:58:34.490

一旦 .net 4.0 可用，您就可以使用[`Guid.TryParse()`](https://msdn.microsoft.com/en-us/library/system.guid.tryparse(v=vs.110).aspx).

* * *

## 回答 #3

> 赞同：67
> 
> 时间：2008-09-19T19:41:21.003

您不会喜欢这样，但是是什么让您认为捕获异常会变慢？

与成功的尝试相比，您期望解析 GUID 的尝试失败次数是多少？

我的建议是使用您刚刚创建的函数并分析您的代码。如果您发现此功能确实是热点**，**请修复它，但不要在此之前修复它。

* * *

## 回答 #4

> 赞同：42
> 
> 时间：2011-06-30T10:18:11.950

在 .NET 4.0 中，您可以编写如下：

```
public static bool IsValidGuid(string str)
{
    Guid guid;
    return Guid.TryParse(str, out guid);
} 
```

* * *

## 回答 #5

> 赞同：22
> 
> 时间：2008-09-26T04:49:46.363

我至少会将其重写为：

```
try
{
  value = new Guid(s);
  return true;
}
catch (FormatException)
{
  value = Guid.Empty;
  return false;
} 
```

您不想在 SEHException、ThreadAbortException 或其他致命或不相关的东西上说“无效的 GUID”。

**更新**：从 .NET 4.0 开始，有一组可用于 Guid 的新方法：

*   [`Guid.TryParse`](http://msdn.microsoft.com/en-us/library/system.guid.tryparse(v=vs.100).aspx)
*   [`Guid.TryParseExact`](http://msdn.microsoft.com/en-us/library/system.guid.tryparseexact(v=vs.100).aspx)

真的，应该使用那些（如果只是因为它们不是“天真地”在内部使用 try-catch 实现的）。

* * *

## 回答 #6

> 赞同：14
> 
> 时间：2008-11-14T17:02:10.183

互操作比捕获异常要慢：

在幸福的道路上，有 10,000 个向导：

```
Exception:    26ms
Interop:   1,201ms 
```

在不愉快的道路上：

```
Exception: 1,150ms
  Interop: 1,201ms 
```

它更加一致，但也始终较慢。在我看来，您最好将调试器配置为仅在未处理的异常上中断。

* * *

## 回答 #7

> 赞同：10
> 
> 时间：2008-09-19T19:46:19.870

好吧，这是您需要的正则表达式...

```
^[A-Fa-f0-9]{32}$|^({|\\()?[A-Fa-f0-9]{8}-([A-Fa-f0-9]{4}-){3}[A-Fa-f0-9]{12}(}|\\))?$|^({)?[0xA-Fa-f0-9]{3,10}(, {0,1}[0xA-Fa-f0-9]{3,6}){2}, {0,1}({)([0xA-Fa-f0-9]{3,4}, {0,1}){7}[0xA-Fa-f0-9]{3,4}(}})$ 
```

但这只是初学者。您还必须验证日期/时间等各个部分是否在可接受的范围内。我无法想象这比您已经概述的 try/catch 方法更快。希望您没有收到那么多无效的 GUID 来保证这种类型的检查！

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2009-05-27T17:54:49.447

> 出于可用性原因 - 调试器弹出

如果您要使用 try/catch 方法，您可以添加 [System.Diagnostics.DebuggerHidden] 属性以确保调试器不会中断，即使您已将其设置为在抛出时中断。

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2008-09-19T19:52:20.213

虽然使用错误*确实*更昂贵，但大多数人认为他们的大部分 GUID 将由计算机生成，因此 a`TRY-CATCH`并不会太昂贵，因为它只会在`CATCH`. [您可以通过对两者](https://fserv-web.finsel.com:8443/svn/PublicSource/NET/Testing/TestGuidValidation)的简单测试（用户公开，无密码）向自己证明这一点。

干得好：

```
using System.Text.RegularExpressions;

 /// <summary>
  /// Validate that a string is a valid GUID
  /// </summary>
  /// <param name="GUIDCheck"></param>
  /// <returns></returns>
  private bool IsValidGUID(string GUIDCheck)
  {
   if (!string.IsNullOrEmpty(GUIDCheck))
   {
    return new Regex(@"^(\{{0,1}([0-9a-fA-F]){8}-([0-9a-fA-F]){4}-([0-9a-fA-F]){4}-([0-9a-fA-F]){4}-([0-9a-fA-F]){12}\}{0,1})$").IsMatch(GUIDCheck);
   }
   return false;
  } 
```

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2009-07-26T19:56:40.260

我遇到了类似的情况，我注意到无效字符串几乎没有 36 个字符长。因此，基于这一事实，我稍微更改了您的代码以获得更好的性能，同时仍然保持简单。

```
public static Boolean TryStrToGuid(String s, out Guid value)
{

     // this is before the overhead of setting up the try/catch block.
     if(value == null || value.Length != 36)
     {  
        value = Guid.Empty;
        return false;
     }

    try
    {
        value = new Guid(s);
        return true;
    }
    catch (FormatException)
    {
        value = Guid.Empty;
        return false;
    }
} 
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-09-19T19:41:07.760

通过 RegEx 或一些执行完整性检查的自定义代码运行潜在的 GUID，以确保字符串至少看起来像 GUID 并且仅包含有效字符（并且可能它似乎适合整体格式）。如果它没有通过完整性检查，则返回一个错误——这可能会清除绝大多数无效字符串。

然后像上面那样转换字符串，仍然捕获通过完整性检查的少数无效字符串的异常。

Jon Skeet 对解析 Ints 的类似内容进行了分析（在 TryParse 在框架中之前）： [检查字符串是否可以转换为 Int32](http://groups.google.com/group/microsoft.public.dotnet.framework/browse_thread/thread/3a72ac6eb7d88cc7/dc9241dff1dc524d?lnk=st&q=%22Checking+if+a+string+can+be+converted+to+Int32%22++jon+skeet#dc9241dff1dc524d)

但是，正如[AnthonyWJones](https://stackoverflow.com/questions/104850/c-test-if-string-is-a-guid-without-throwing-exceptions#104896)所说，您可能不应该担心这一点。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2008-09-19T19:48:06.293

据我所知，mscrolib 中没有类似 Guid.TryParse 的东西。根据参考资料，Guid 类型有一个超级复杂的构造函数，它检查各种 guid 格式并尝试解析它们。没有可以调用的辅助方法，即使通过反射也是如此。我认为您必须搜索第 3 方 Guid 解析器，或编写自己的解析器。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-09-19T19:50:27.770

```
 bool IsProbablyGuid(string s)
    {
        int hexchars = 0;
        foreach(character c in string s)
        {
           if(IsValidHexChar(c)) 
               hexchars++;          
        }
        return hexchars==32;
    } 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2009-05-27T17:59:13.150

*   获取反射器
*   复制'n'粘贴 Guid 的 .ctor(String)
*   用“return false”替换每次出现的“throw new ...”。

Guid 的 ctor 几乎是一个已编译的正则表达式，这样您将获得完全相同的行为，而不会产生异常开销。

1.  这是否构成逆向工程？我认为确实如此，因此可能是非法的。
2.  如果 GUID 表单发生更改，将会中断。

更酷的解决方案是动态地检测一种方法，通过动态替换“throw new”。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2009-08-22T23:21:18.247

[我投票支持Jon](https://stackoverflow.com/users/731/jon-sagara)上面发布的 GuidTryParse 链接或类似的解决方案 (IsProbablyGuid)。我将为我的转换库写一个类似的。

我认为这个问题必须如此复杂，这完全是蹩脚的。如果 Guid 可以为空，“is”或“as”关键字就可以了。但是由于某种原因，即使 SQL Server 可以接受，.NET 也不能。为什么？Guid.Empty 的值是多少？这只是 .NET 设计造成的一个愚蠢问题，当语言的约定超越自身时，它真的让我很烦恼。迄今为止表现最好的答案是使用 COM 互操作，因为框架不能很好地处理它？“这个字符串可以是 GUID 吗？” 应该是一个容易回答的问题。

依靠抛出的异常是可以的，直到应用程序上线。那时我只是为拒绝服务攻击做好了准备。即使我没有受到“攻击”，我也知道一些雅虎会使用 URL 进行欺骗，或者我的营销部门可能会发送一个格式错误的链接，然后我的应用程序必须遭受相当严重的性能打击，这可能会带来关闭服务器，因为我没有编写代码来处理不应该发生的问题，但我们都知道会发生。

这模糊了“异常”的界限 - 但最重要的是，即使问题不常见，如果它可以在短时间内发生足够多的时间以使您的应用程序崩溃为所有的捕获提供服务，那么我认为抛出异常是糟糕的形式。

狂暴3K

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2009-05-23T14:20:55.867

如果 TypeOf ctype(myvar,Object) 是 Guid 那么.....

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2009-08-20T11:54:44.483

```
Private Function IsGuidWithOptionalBraces(ByRef strValue As String) As Boolean
    If String.IsNullOrEmpty(strValue) Then
        Return False
    End If

    Return System.Text.RegularExpressions.Regex.IsMatch(strValue, "^[\{]?[0-9a-fA-F]{8}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{12}[\}]?$", System.Text.RegularExpressions.RegexOptions.IgnoreCase)
End Function

Private Function IsGuidWithoutBraces(ByRef strValue As String) As Boolean
    If String.IsNullOrEmpty(strValue) Then
        Return False
    End If

    Return System.Text.RegularExpressions.Regex.IsMatch(strValue, "^[0-9a-fA-F]{8}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{12}$", System.Text.RegularExpressions.RegexOptions.IgnoreCase)
End Function

Private Function IsGuidWithBraces(ByRef strValue As String) As Boolean
    If String.IsNullOrEmpty(strValue) Then
        Return False
    End If

    Return System.Text.RegularExpressions.Regex.IsMatch(strValue, "^\{[0-9a-fA-F]{8}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{12}\}$", System.Text.RegularExpressions.RegexOptions.IgnoreCase)
End Function 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2017-07-20T20:29:54.777

使用 C# 中的扩展方法

```
public static bool IsGUID(this string text)
{
    return Guid.TryParse(text, out Guid guid);
} 
```

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2021-11-08T17:51:10.223

从字符串返回 Guid 值。如果 Guid 值无效，则返回 Guid.Empty。无法返回 Null 值，因为 Guid 是结构类型

```
 /// <summary>
    /// Gets the GUID from string.
    /// </summary>
    /// <param name="guid">The GUID.</param>
    /// <returns></returns>
    public static Guid GetGuidFromString(string guid)
    {
        try
        {
            if (Guid.TryParse(guid, out Guid value))
            {
                return value;
            }
            else
            {
                return Guid.Empty;
            }
        }
        catch (Exception)
        {
            return Guid.Empty;
        }
    } 
```

# java - 从 Eclipse 启动 Tomcat 时出现“SetPropertiesRule”警告消息

> ID：104854
> 
> 赞同：111
> 
> 时间：2008-09-19T19:36:00.707
> 
> 标签：java, eclipse, tomcat, eclipse-3.4

当我从 Eclipse (3.4) 启动 Tomcat (6.0.18) 时，我收到此消息（日志中的第一个）：

> 警告：[SetPropertiesRule]{Server/Service/Engine/Host/Context} 将属性 'source' 设置为 'org.eclipse.jst.jee.server: (project name)' 没有找到匹配的属性。

似乎此消息没有任何严重影响，但是，有人知道如何摆脱它吗？

* * *

## 回答 #1

> 赞同：151
> 
> 时间：2009-04-13T18:19:43.223

这个问题的解决方案非常简单。双击您的 Tomcat 服务器。它将打开服务器配置。在服务器选项下选中“将模块内容发布到单独的 XML 文件”复选框。重新启动您的服务器。这次您的页面将没有任何问题。

* * *

## 回答 #2

> 赞同：32
> 
> 时间：2008-09-19T22:40:39.327

来自[Eclipse 新闻组](http://dev.eclipse.org/newslists/news.eclipse.webtools/msg16008.html "Eclipse 新闻组")：

> 关于源属性的警告是 Tomcat 6.0.16 中的新警告，可能会被忽略。WTP 添加一个“源”属性来标识工作空间中的哪个项目与上下文相关联。Tomcat 中的 Context 对象没有相应的源属性这一事实不会导致任何问题。

我意识到这并不能回答如何摆脱警告，但我希望它有所帮助。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-10-01T00:53:53.220

服务器选项卡

--> 双击服务器名

--> 服务器选项：勾选“将模块上下文发布到单独的 XML 文件”

重启你的服务器

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2011-06-13T09:21:45.237

我正在使用 Eclipse。我已经通过以下方式解决了这个问题：

1.  打开服务器选项卡。
2.  双击您正在使用的服务器。
3.  在服务器配置页面上，转到服务器选项页面。
4.  检查服务模块而不发布。
5.  然后保存页面和配置。
6.  通过重建所有应用程序重新启动服务器。

您不会收到任何此类错误。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2011-09-05T19:48:29.900

从 Eclipse 中删除服务器实例并创建一个新实例。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-10T07:53:00.263

我对 Eclipse 3.4(Ganymede) 和动态 web 项目有同样的问题。
该消息不影响成功部署。但我不得不删除行

```
<wb-resource deploy-path="/WEB-INF/classes" source-path="/src/main/resources"/> 
```

来自 Eclipse 的 .settings 文件夹中的 org.eclipse.wst.common.component 文件

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-02-26T22:01:19.783

在问题出现之前，我复制了动态 Webproject。因此，更改 .settings 目录中的 org.eclipse.wst.common.component 文件为我解决了这个问题。其他解决方案不起作用。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2013-05-14T14:45:50.580

单独的 XML 解决方案从未对我和其他人最近...

我通常遵循这个过程并且有一些帮助：

1.  停止服务器（确保它通过任务管理器停止，我多次杀死 javaw.exe Eclipse 并没有真正正确关闭）
2.  右键单击服务器->“添加和删除”。删除项目。结束。
3.  右键单击服务器->“添加和删除”。添加项目。结束。
4.  重启看看能不能用，如果不行就继续
5.  双击服务器...查看它的发布位置（服务器路径：我认为它对我来说是一个 tmp# 目录，因为我使用了一个已经安装的 Tomcat 实例，我会重复使用，不确定如果使用 Eclipse 是否会有所不同内部/捆绑的 tomcat 服务器）
6.  右键单击服务器并“清理”...上次对我有用（所以可能想先尝试一下），添加/删除项目在其他时候对我有用。如果不起作用，请继续...
7.  从服务器路径中删除所有文件，并查看是否所有文件实际上都在那里构建和发布（/WEB-INF/classes 和 /webroot 中的其他常规文件）。
8.  重新启动 Eclipse 和/或机器（不确定我是否需要达到这一点）

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2014-06-30T19:45:27.730

我发布我的答案是因为我怀疑上面的解决方案可能对某些人不起作用。

所以，你得到一个警告，

> 警告：[SetPropertiesRule]{Server/Service/Engine/Host/Context} 将属性 'source' 设置为 'org.eclipse.jst.jee.server: (project name)' 没有找到匹配的属性。

而不是通过检查服务器配置中的该选项来禁用此警告（我确实尝试过），我建议您这样做：

1.  首先通过右键单击项目资源管理器关闭所有现有项目。
2.  删除所有已经与服务器同步的项目。
3.  删除服务器并重新部署它。
4.  创建一个新的动态项目，什么都不做，只是尝试在服务器上运行它。
5.  检查控制台，您现在是否收到警告。（我的情况我没有得到任何）。
    这意味着您的项目有问题，而不是 Eclipse 或服务器。
6.  现在重新启动服务器。暂时不要运行任何应用程序。
    您可能知道 Tomcat 容器在开始时会加载所有同步应用程序的上下文。
7.  它将加载任何已经同步的应用程序的上下文。
8.  这里有一个问题，如果你的项目真的有问题，它会显示异常的堆栈跟踪。仔细看，你会发现你的应用程序中的错误在哪里。

现在，如果您成功发现应用程序中存在错误，则可能的位置是查找容器用于加载应用程序的 web.xml 文件。就我而言，我在 servlet 映射中拼错了一个名称，这使我毫无意义地调试了 3 个小时。你的问题可能在其他地方。

还有一件事，如果您有许多应用程序与服务器同步，则其他应用程序的上下文可能是问题的根源。尝试一一调试。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2014-11-03T01:12:49.553

我尊重这里给出的所有解决方案。

但是我在阅读所有这些后才知道，我们没有观察到 struts.xml 文件或 Web 应用程序所需的任何配置文件位于哪个文件夹。

我的解决方案是：

1.  将 struts.xml 文件复制到我们项目的 src 文件夹中。
2.  在eclipse中单击“文件-->全部保存”，然后单击“项目-->清理”。
3.  重新启动服务器。

希望问题解决了。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2015-08-12T22:24:49.197

确保您在 web.xml 文件中有正确的 jsp 文件名。通过用我当前的文件名替换 web.xml 中的默认 .jsp 文件名解决了这个问题

* * *

## 回答 #12

> 赞同：-2
> 
> 时间：2009-05-21T15:55:33.550

我发现 Tomcat 似乎无法找到在其他项目中定义的类，甚至可能在主项目中。它在过滤器定义上失败，这是 web.xml 中的第一个定义。如果我将项目及其依赖项添加到服务器的启动配置中，那么我将继续遇到一个新错误，所有这些似乎都表明它没有正确设置项目。

我们的设置相当复杂。我们在 Eclipse 中有多个组件作为项目，具有单独的输出项目。我们有一个单独的 webapp 目录，其中包含静态 HTML 和图像，以及我们的 WEB-INF。

Eclipse 是“欧洲冬季版本”。Tomcat 是 6.0.18。我尝试了“动态 Web 模块”方面的 2.4 和 2.5 版。

谢谢你的帮助！

*   理查德

# c# - 寻找 C# 注册表类

> ID：104866
> 
> 赞同：4
> 
> 时间：2008-09-19T19:37:19.313
> 
> 标签：c#, registry

寻找包装调用以执行以下操作的 C# 类：

读取和写入键值 读取和写入键条目

枚举键中的条目。这个很重要。例如，需要列出所有条目：HKEY_LOCAL_MACHINE\SOFTWARE\ODBC\ODBC.INI\ODBC Data Sources

（我扫描了一些 codeproject.com 注册表类，但它们没有枚举）

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-09-19T19:42:10.347

[Microsoft.Win32.Registry](http://msdn.microsoft.com/en-us/library/microsoft.win32.registry.aspx)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-19T19:41:20.117

使用标准 C# / .NET 注册表类并枚举 GetSubKeyNames() 的结果。

有关示例，请参见[此处。](http://www.java2s.com/Code/CSharp/Development-Class/EnumeratingRegistryKeys.htm)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-19T19:43:26.710

查看“Microsoft.Win32”命名空间。在那里您会找到用于创建和读取注册表项的功能。

```
 Registry.CurrentUser.OpenSubKey()
   Registry.CurrentUser.CreateSubKey() 
```

ETC..

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-09-18T13:04:57.440

我希望这段代码对你有很多帮助，看看这篇文章 [Registry Iteration in C#](http://forum.codeproblem.com/c/i-want-to-iterate-subkeys-of-a-registry-key-using-c/)

代码也包含在其中。

# php - PHP :: 模拟 , 将用户转发到页面

> ID：104872
> 
> 赞同：5
> 
> 时间：2008-09-19T19:38:04.397
> 
> 标签：php, curl, protx

我正在开发一个`PHP`链接到`Protx VSP Direct payment gateway`. 为了处理来自信用卡处理公司的“3D Secure”请求，我需要将用户转发到另一个网站，模仿已发布的表格。我正在尝试使用这些`cURL`库，但似乎遇到了问题。我的代码如下：

```
<?php  
$ch = curl_init();  
// Set the URL  
curl_setopt($ch, CURLOPT_URL, 'http://www.google.com/');  
// Perform a POST  
curl_setopt($ch, CURLOPT_POST, 1);  
// If not set, curl prints output to the browser  
curl_setopt($ch, CURLOPT_RETURNTRANSFER, 0);   
// Set the "form fields"  
curl_setopt($ch, CURLOPT_POSTFIELDS, $fields);  
$output = curl_exec($ch);  
curl_close($ch);  
?> 
```

所有这一切都是抓取通过的 URL 的内容，并且不会将用户转发到任何地方。我已经尽可能多地尝试谷歌搜索和阅读，但无法弄清楚我错过了什么。有任何想法吗？如果可以避免的话，我不想创建一个自动提交的 HTML 表单。

谢谢你的帮助 ：-）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-19T19:40:25.140

3D Secure API 不允许您在后台执行请求。您需要将用户转发到 3D 安全站点。使用 javascript 自动提交您的表单。以下是我们的供应商的建议：

```
<html> 
    <head> 
        <title>Processing your request...</title> 
    </head> 
    <body OnLoad="OnLoadEvent();"> 
        <form name="downloadForm" action="<%=RedirURL%>" method="POST"> 
            <noscript> 
                <br> 
                <br> 
                <div align="center"> 
                    <h1>Processing your 3-D Secure Transaction</h1> 
                    <h2>JavaScript is currently disabled or is not supported by your browser.</h2><BR> 
                    <h3>Please click Submit to continue the processing of your 3-D Secure transaction.</h3><BR> 
                    <input type="submit" value="Submit"> 
                </div> 
            </noscript> 
            <input type="hidden" name="PaReq" value="<%=PAREQ%>"> 
            <input type="hidden" name="MD" value="<%=TransactionID%>"> 
            <input type="hidden" name="TermUrl" value="<%=TermUrl%>"> 
        </form> 
        <SCRIPT LANGUAGE="Javascript"> 
            <!-- 
            function OnLoadEvent() { 
                document.downloadForm.submit(); 
            } 
            //--> 
        </SCRIPT> 
    </body> 
</html> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-19T19:42:32.360

我认为您对 curl 的作用有些困惑。它完全按照您的解释执行，它的行为有点像浏览器，并调用该站点并返回该帖子的内容。我不知道您可以通过任何方式实际重定向浏览器服务器端并表示帖子。我实际上会创建一个 Javascript 解决方案来做这样的事情。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-19T19:42:33.030

要将用户重定向到 PHP 中的另一个页面，您可以发送一个`header("Location: http://example.com/newpage");`. 但是，不幸的是，您的程序重定向会导致所有 POST 变量被删除（出于安全原因）。如果您想让用户的浏览器向不同的 URL 发送 POST 请求，则必须创建一个提交自身的表单。:(

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-19T19:43:42.043

我宁愿在幕后使用 cURL 之类的东西，因为我不能保证我的用户会启用 JS，并且显示表单会导致一些我宁愿避免的其他问题。这是我的 B 计划 ;-)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-19T19:45:38.920

您可以使用 fsockopen() 重定向到新网站，同时保留您的 POST 变量。有一个很好的教程来说明如何做到这一点[here](http://www.faqts.com/knowledge_base/view.phtml/aid/12039/fid/51)。

万一该网站被互联网怪物吃掉了，我已经复制并粘贴了该功能，但我建议查看原始网站的上下文。

```
function sendToHost($host,$method,$path,$data,$useragent=0)
{
    // Supply a default method of GET if the one passed was empty
    if (empty($method)) {
        $method = 'GET';
    }
    $method = strtoupper($method);
    $fp = fsockopen($host, 80);
    if ($method == 'GET') {
        $path .= '?' . $data;
    }
    fputs($fp, "$method $path HTTP/1.1\r\n");
    fputs($fp, "Host: $host\r\n");
    fputs($fp,"Content-type: application/x-www-form- urlencoded\r\n");
    fputs($fp, "Content-length: " . strlen($data) . "\r\n");
    if ($useragent) {
        fputs($fp, "User-Agent: MSIE\r\n");
    }
    fputs($fp, "Connection: close\r\n\r\n");
    if ($method == 'POST') {
        fputs($fp, $data);
    }

    while (!feof($fp)) {
        $buf .= fgets($fp,128);
    }
    fclose($fp);
    return $buf;
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-19T19:45:49.700

啊，如果我误解了 cURL 的作用，我想我会接受带有 JS 自动提交的 HTML 表单。为我创造了更多的工作，但如果这是唯一的方法，我将不得不这样做。

感谢大家的帮助。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-19T20:07:20.740

我认为在这种情况下，您需要使用表格。信用卡支付公司的网站需要通过用户的浏览器访问，而不是您的服务器端代码。

是的，3dsecure 等集成起来很烦人，但它们确实提供了真正的安全性提升——按预期使用它。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-19T21:50:49.243

也许我错过了一些东西；看起来您正在尝试接收用户的数据，通过 cURL 将其转发到支付处理器，然后将用户重定向到某个地方。对？

如果是这样，您只需将其放在代码的末尾即可：

header("位置：[http](http://www.yoursite.com/yoururl) ://www.yoursite.com/yoururl ");

但是，要使其正常工作，脚本在处理时不能向客户端发送任何内容；这意味着脚本不应在模板中间执行，另一个问题是文件开头开始标记之前的空白。

如果您需要保存原始 POST 事务中的数据，请使用会话来保存它。

这应该适用于无 JS 的解决方案。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-19T23:06:11.013

我可能完全错了，但听起来你正在尝试做一些类似于代理模式的事情。

我已经为我合作过的其他网站实现了类似的模式，它确实需要一些修补才能正确。

我将 RETURN_TRANSFER 设置为 TRUE，以便您可以分析检索到的响应并根据它进行应用程序级别的操作。

[http://en.wikipedia.org/wiki/Proxy_pattern](http://en.wikipedia.org/wiki/Proxy_pattern)

祝你好运。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-05-28T18:02:47.310

我发现上面的 sendToHost() 函数非常有用，但是源代码中有一个错字需要一些时间来调试：Content-type 标头值在 'form-' 和 'urlencoded' 之间包含一个空格 - 应该是 'application/ x-www-form-urlencoded'

# c# - 使用 C# 自动与 HTML 游戏交互？

> ID：104878
> 
> 赞同：2
> 
> 时间：2008-09-19T19:39:01.743
> 
> 标签：c#, automation

有一些基于 HTML 的游戏（例如 bootleggers.us）有一个简单的登录表单，然后您的整个游戏体验就围绕着提交各种表单和从网站本身读取信息展开。

我的问题是，**使用 C# 编写机器人/自动化基于 html 的游戏的最佳方法是什么**？

我最初的想法是使用 System.Net.HttpRequest 和 WebRequest 类来获取源 html 并使用正则表达式进行解析以获取所需的信息。

但是，如果可能的话，我想避免这种情况。是否有任何解决方案可以抽象出其中的一些并使自动化网站交互更容易？即填写表格、提交表格、从网站读取值等？某个图书馆？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-19T19:40:18.527

您可以使用 Watin：[http ://watin.sourceforge.net/](http://watin.sourceforge.net/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-19T19:45:29.823

不，您几乎将不得不“屏幕抓取”每一页。您可能会考虑用 JavaScript 而不是 C# 来编写大部分内容。根据游戏网站的 HTML，这可能或多或少是困难的，具体取决于它们是否在页面元素上提供了良好的 id 属性等......

# language-agnostic - 处理软件开发的变化率

> ID：104890
> 
> 赞同：4
> 
> 时间：2008-09-19T19:40:45.017
> 
> 标签：language-agnostic

我主要是一名 .NET 开发人员，仅在这个领域，在任何时候都可能有近十种令人着迷的新兴技术，其中一些是真正改变游戏规则的技术，我很想深入研究。

可悲的是，这似乎超出了人类的能力范围。

我读了 Rocky Lhotka（.NET 传奇人物，CSLA 的发明者等）的一篇文章，他几乎顺便提到，去年他对变化的速度感到非常不知所措。他说得好像不可能再保持在最前沿，也许他不会那么努力，因为那是徒劳的。

令我惊讶的是，像 Lhotka 这样的真正天才（他们可能会花费大量时间来使用最新技术，并且应该能够快速掌握东西）也感到灼伤！

那么，你们是怎么处理这个问题的呢？您是否只是将其归咎于开发是巨大的，并且能够快速找到东西比学习所有东西更重要？或者你有一个继续教育策略，实际上可以让你保持接近最前沿？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-19T20:02:02.797

我已经在 IT 领域工作了 30 年，所以也许我可以提供一些观点。是的，有越来越多的材料需要跟上。但是*变化*率（如“进展”）并没有增加——如果有的话，它正在减少。我们看到的是该领域的*扩大*。

举个简单的例子：从前有 HTML/1。然后是 HTML/2，这就是进步。现在我们有了 HTML/4、HTML/5、XHTML/1、Flash、Silverlight 等等。其中任何一项都是进步，但每一项都是不同方向的进步，并且都在积极使用中。

保持领先？算了吧——这是不可能的。另一方面，优秀的 IT 人员最多可以在几周内掌握一门新语言或新技术——没什么大不了的。尝试挑选出真正的新想法并了解它们。忽略所有特定技术（IIS 7、SQL Server 2008 等），除非您需要它们。

继续以 Internet 为例，最后一个真正的创新是 Web 2.0 背后的想法。我同时利用这个机会学习了 Ruby——在 Ruby on Rails 中做了几个小型的一次性项目。如果这个领域的项目出现了，无论在什么环境下，想法都是一样的。

一个人偶尔会感到沮丧。在所有营销炒作中挑选出真正的新想法并不总是那么容易。

祝一切顺利...

布拉德

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-19T19:45:46.407

参加会议和本地用户组会议，上推特并开始关注一群人。加入或启动您所在地区的邮件列表（谷歌群组是我最喜欢的提供商，雅虎群组也不错）来讨论问题。

提议在您当地的 DNUG 进行一次演讲，让某人对所有这些新技术进行快速概述，或者进行一次公开讨论/闪电演讲，让人们站起来并就他们最喜欢的新技术进行 5-10 分钟的讨论。

简而言之：走出去，与人交谈和分享。这是您掌握一切的唯一方法。除非你不睡觉不工作，否则你不能自己做。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-19T19:59:56.203

我发现自己时不时会担心错过一些事情，但当我真正坐下来学习一些热门的新技术时，我发现它主要是我已经见过的基础技术的新组合。

我的方法是确保我对算法、数据结构、通信协议、一些硬件知识和一般工程技能有很好的掌握。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-19T19:53:40.413

很难不想要全部学习，但我尽量不跳入任何“太新”的东西，我似乎最终会因为没有很多资源可以提供帮助而感到沮丧。虽然确实有人必须首先采取潜水头，但我尊重这些人（我想这就是 beta 测试人员的生活），但我只是不认为责任落在每个人身上。但是，如果您有时间和耐心，那么潜入新事物会很有趣。我想这不是对您问题的直接答案，但我希望它能给您一些思考。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-19T19:42:56.897

我说只要选择一个让你着迷的发展环境并深入研究它。例如，如果您喜欢处理分布式系统，请开始阅读 WCF 并成为它的专家。

除了对技术的随意理解之外，我认为不可能熟悉*所有内容。*比成为万事通，但一无所获要好得多。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-19T19:46:44.953

因为我从来没有时间去涉足或玩新技术，通常我会根据一些少量的信息来选择一个——可能是一篇文章，也可能是朋友的推荐——然后我强迫自己在我正在做的一个项目。这就是我目前学习[SCSF](http://msdn.microsoft.com/en-us/library/aa480482.aspx)和[CAB](http://msdn.microsoft.com/en-us/library/aa480450.aspx)的过程。开始时可能会很痛苦，甚至可能很慢，因为您必须顺势而为，最终它通常对您有利（前提是您选择的技术会带来好处）。这就是我学习 LINQ、泛型和其他所有内容的方式。选择一种声称比已知方式更能解决问题的技术，然后强迫自己以这种方式实施。

# logging - 如何从我的访问日志中删除负载均衡器污染

> ID：104892
> 
> 赞同：0
> 
> 时间：2008-09-19T19:41:07.090
> 
> 标签：logging, webserver, load-balancing, sun

我有一对位于负载平衡器后面的 Sun Web 服务器 (iws6)。它想知道 Web 服务器是否已启动并不断请求 /alive.html。这很好，但我怎么不把它记录在我的访问日志中呢？

如果做不到这一点，我怎样才能让存档器在它角色文件时删除访问？

我更喜欢 cron 调用 grep -v alive.html 的更优雅的东西

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-06T11:58:49.483

您可以为 Apache 提供有关要抑制哪些日志的规则。也许IWS有类似的东西？

[http://httpd.apache.org/docs/1.3/logs.html#conditional](http://httpd.apache.org/docs/1.3/logs.html#conditional)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-19T20:12:30.773

日志通常是每个条目一行，以便您可以 grep 查找您想要的内容。这个想法是在文件中包含所有内容，但使用 grep 来读取您关心的部分。当您阅读它们时，除了负载平衡器之外的所有内容都使用 Grep。

# visual-studio - 在 Visual Studio 中共享二进制文件夹

> ID：104901
> 
> 赞同：1
> 
> 时间：2008-09-19T19:41:54.373
> 
> 标签：visual-studio

很长一段时间以来，我一直试图找出访问某些站点文件的最佳方式，这些文件我不希望成为项目的一部分，或者简化与多个开发人员（和人才，例如设计师）在单个项目中的集成。

我创建的许多网站都有包含大量图像和其他二进制文件的文件夹，我不想将它们包含在 Visual Studio 项目和/或源代码控制中，主要是因为它们的内容不断更新。我见过有些人使用虚拟目录，但是如果您使用 Visual Studio 的内置 Web 服务器，则无法使用虚拟目录。

据我所知，理想情况下，包含二进制文件的文件夹可以位于中央服务器上并映射到项目。或者，我已经考虑为每个项目创建单独的子域，所有图像/二进制文件都可以通过这些子域进行引用，例如`http://project.client.customer.com/images`

有什么想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-11T07:01:51.923

它们真的应该像其他所有东西一样受到源代码控制。如果您使用 Subversion，您可以将它们存储在不同的存储库中，并作为[svn-external](http://svnbook.red-bean.com/en/1.0/ch07s03.html)包含在您的主项目存储库中，如果您不希望它们弄乱您的主存储库。我确信其他源代码控制解决方案也提供类似的功能。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-11T15:01:55.043

你真的应该把它们放在源代码控制中。如果您使用 Subversion，正如 Beepcake 所说，您可以使用 svn:externals 在不同项目之间共享文件。

或者，您可以有一个自定义构建操作，从您保存共享文件的任何位置获取共享文件的最新副本。我们以多种方式执行此操作——或者我们为子目录发出“svn checkout”（但 svn:externals 可以解决这个问题），或者我们执行“wget ...”来获取上次成功的输出构建另一个项目（我们使用 TeamCity 进行持续集成，它使“工件”通过 HTTP 可用）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-19T20:28:29.643

图像和其他二进制文件应该像您的代码文件一样在源代码管理中。特别是因为它们经常变化。

也就是说，建立一个只包含二进制文件的不同项目绝对没有害处；并将其置于不同的部署计划中。

# c# - 命令模式：如何将参数传递给命令？

> ID：104918
> 
> 赞同：66
> 
> 时间：2008-09-19T19:44:20.123
> 
> 标签：c#, design-patterns, command-pattern

我的问题与命令模式有关，我们有以下抽象（C# 代码）：

```
public interface ICommand
{
    void Execute();
} 
```

让我们使用一个简单的具体命令，该命令旨在从我们的应用程序中删除一个实体。以一个`Person`实例为例。

我会有一个`DeletePersonCommand`，它实现`ICommand`. 该命令需要`Person`删除作为参数，以便在`Execute`调用方法时将其删除。

管理参数化命令的最佳方法是什么？如何在执行命令之前将参数传递给命令？

* * *

## 回答 #1

> 赞同：71
> 
> 时间：2008-09-19T19:48:06.793

您需要通过构造函数或 setter 注入（或等效方法）将参数与命令对象相关联。也许是这样的：

```
public class DeletePersonCommand: ICommand
{
     private Person personToDelete;
     public DeletePersonCommand(Person personToDelete)
     {
         this.personToDelete = personToDelete;
     }

     public void Execute()
     {
        doSomethingWith(personToDelete);
     }
} 
```

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2008-09-25T22:21:27.497

通过构造函数或设置器传递数据是可行的，但需要命令的创建者知道命令需要的数据......

“上下文”的想法非常好，我正在研究（一个内部）框架，不久前就利用了它。

如果您设置控制器（与用户交互的 UI 组件、解释用户命令的 CLI、解释传入参数和会话数据的 servlet 等）以提供对可用数据的命名访问，命令可以直接请求它们想要的数据。

我真的很喜欢这样的设置允许的分离。考虑分层如下：

```
User Interface (GUI controls, CLI, etc)
    |
[syncs with/gets data]
    V
Controller / Presentation Model
    |                    ^
[executes]               |
    V                    |
Commands --------> [gets data by name]
    |
[updates]
    V
Domain Model 
```

如果您“正确”地执行此操作，则可以将相同的命令和演示模型用于任何类型的用户界面。

更进一步，上面的“控制器”非常通用。UI 控件只需要知道它们将调用的命令的*名称*——它们（或控制器）不需要知道如何创建该命令或该命令需要什么数据。这才是这里真正的优势。

例如，您可以保存要在 Map 中执行的命令的名称。每当组件被“触发”（通常是 actionPerformed）时，控制器都会查找命令名称、实例化它、调用执行并将其推送到撤消堆栈（如果您使用的话）。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-09-19T19:48:11.690

有一些选项：

您可以通过属性或构造函数传递参数。

其他选项可能是：

```
interface ICommand<T>
{
    void Execute(T args);
} 
```

并将所有命令参数封装在一个值对象中。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2010-03-21T05:31:45.550

我的实现是这样的（使用 Juanma 提出的 ICommand ）：

```
public class DeletePersonCommand: ICommand<Person>
{
    public DeletePersonCommand(IPersonService personService)
    {  
        this.personService = personService;
    }

    public void Execute(Person person)
    {
        this.personService.DeletePerson(person);
    }
} 
```

IPersonService 可以是 IPersonRepository，这取决于您的命令是什么“层”。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-09-19T19:53:23.817

创建命令对象时传递人员：

```
ICommand command = new DeletePersonCommand(person); 
```

这样当你执行命令时，它就已经知道它需要知道的一切。

```
class DeletePersonCommand : ICommand
{
   private Person person;
   public DeletePersonCommand(Person person)
   {
      this.person = person;
   }

   public void Execute()
   {
      RealDelete(person);
   }
} 
```

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2008-09-19T19:55:00.520

在这种情况下，我们对 Command 对象所做的是创建一个本质上是地图的 Context 对象。该映射包含名称值对，其中键是常量，值是命令实现使用的参数。如果您有一个命令链，其中后面的命令依赖于早期命令的上下文更改，则特别有用。

所以实际的方法变成了

```
void execute(Context ctx); 
```

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2008-09-19T19:46:31.477

在构造函数中并存储为字段。

您还希望最终使您的 ICommands 可序列化以用于撤消堆栈或文件持久性。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-09-19T20:02:49.533

基于 C#/WPF 中的模式，ICommand 接口 (System.Windows.Input.ICommand) 被定义为将对象作为 Execute 以及 CanExecute 方法的参数。

```
interface ICommand
            {
                bool CanExecute(object parameter);
                void Execute(object parameter);
            } 
```

这允许您将您的命令定义为一个静态公共字段，它是您实现 ICommand 的自定义命令对象的一个​​实例。

```
public static ICommand DeleteCommand = new DeleteCommandInstance(); 
```

这样，在调用 execute 时，相关对象（在您的情况下为人）被传入。然后 Execute 方法可以转换对象并调用 Delete() 方法。

```
public void Execute(object parameter)
            {
                person target = (person)parameter;
                target.Delete();
            } 
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2020-03-28T23:12:35.047

已经提到的 Blair Conrad 的代码（不知道如何标记他）工作得很好**，如果你知道在实例化类时要删除什么人**并且他的方法就足够了。但是，如果你不知道你会删除，直到您按下按钮，您可以使用返回人员的方法引用来实例化命令。

```
 class DeletePersonCommand implements ICommand
{
     private Supplier<Person> personSupplier;

     public DeletePersonCommand(Supplier<Person> personSupplier)
     {
         this.personSupplier = personSupplier;
     }

     public void Execute()
     {
        personSupplier.get().delete();
     }
} 
```

这样，在执行命令时，供应商会获取您要删除的人，并在执行时执行此操作。直到那时，该命令还没有关于删除谁的信息。

供应商上的有用[链接](https://stackoverflow.com/questions/38842853/what-is-the-c-equivalent-of-a-java-util-function-supplier)。

**注意：用 java 编写的代码**。有 c# 知识的人可以调整它。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-09-21T15:43:14.507

您应该创建一个 CommandArgs 对象来包含您要使用的参数。使用 Command 对象的构造函数注入 CommandArgs 对象。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-19T19:47:04.470

DeletePersonCommand 可以在其构造函数或方法中有参数。DeletePersonCommand 将具有 Execute() 并且在执行中可以检查将由 Getter/Setter 之前传递的 Execute() 调用的属性。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-19T19:47:05.220

我会将任何必要的参数添加到`DeletePersonCommand`. 然后，当`Execute()`被调用时，使用在构造时传递给对象的那些参数。

* * *

## 回答 #13

> 赞同：-5
> 
> 时间：2008-09-19T19:48:04.857

让“Person”实现某种 IDeletable 接口，然后使命令采用您的实体使用的任何基类或接口。这样，您可以创建一个 DeleteCommand，它会尝试将实体转换为 IDeletable，如果可行，请调用 .Delete

```
public class DeleteCommand : ICommand
{
   public void Execute(Entity entity)
   {
      IDeletable del = entity as IDeletable;
      if (del != null) del.Delete();
   }
} 
```

# .net - 是否有 .NET 性能计数器来显示 p/invoke 调用的速率？

> ID：104920
> 
> 赞同：2
> 
> 时间：2008-09-19T19:44:41.277
> 
> 标签：.net, performance, interop, pinvoke, analysis

是否有 .NET 性能计数器来显示 p/invoke 调用的速率？我刚刚注意到我正在调试的应用程序正在一个紧密循环中从托管土地调用本机代码。预期的实现是进行一次 ap/invoke 调用，然后进行缓存。我想知道我是否可以通过 CLR Interop 或 Remoting .NET 性能计数器注意到这个错误。有任何想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-19T19:57:57.190

尝试使用“.NET CLR Interop”作为“# of marshalling”性能计数器。

有关更多信息，请参阅本文[http://msdn.microsoft.com/en-us/library/ms998551.aspx](http://msdn.microsoft.com/en-us/library/ms998551.aspx)。

# report - VS.NET ReportViewer 的网页设计器

> ID：104951
> 
> 赞同：2
> 
> 时间：2008-09-19T19:48:16.183
> 
> 标签：report, reportviewer, designer, rdl

是否有任何可在 Web 浏览器上使用的 rdl 文件（visual studio .net 报告）设计器？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-19T21:19:52.220

我见过的最好的是 RsInteract：[http ://www.rsinteract.com/](http://www.rsinteract.com/)

# c++ - 我想告诉 VC++ 编译器编译所有代码。可以做到吗？

> ID：104952
> 
> 赞同：1
> 
> 时间：2008-09-19T19:48:18.837
> 
> 标签：c++, compiler-construction, visual-studio-2005, code-coverage

我将 VS2005 VC++ 用于非托管 C++。我有 VSTS 并且正在尝试使用代码覆盖率工具来完成关于单元测试的两件事：

1.  看看我有多少被测试的引用代码正在执行
2.  查看我的测试代码中有多少方法（如果有）根本没有经过单元测试

设置 VSTS 代码覆盖工具（请参阅[链接文本](https://blogs.msdn.com/ms_joc/articles/406608.aspx "MSDN 代码覆盖率博客")）并完成任务 #1 非常简单。然而＃2对我来说是一个令人惊讶的挑战。这是我的测试代码。

```
class CodeCoverageTarget
{
public:
    std::string ThisMethodRuns() {
         return "Running";
    }

    std::string ThisMethodDoesNotRun() {
        return "Not Running";
    }
};

#include <iostream>
#include "CodeCoverageTarget.h"
using namespace std;
int main()

{
    CodeCoverageTarget cct; 
    cout<<cct.ThisMethodRuns()<<endl;
} 
```

当这两种方法都在上面的类中定义时，编译器会自动从 obj 文件中删除 ThisMethodDoesNotRun()。如果我将它的定义移到类之外，那么它会包含在 obj 文件中，并且代码覆盖率工具显示它根本没有被执行过。在大多数情况下，我希望编译器为我完成这种消除，但对于代码覆盖工具，它会破坏大部分价值（例如，寻找未经测试的方法）。我已经尝试了很多方法来告诉编译器停止对我聪明并编译所有东西，但我很难过。如果代码覆盖工具能弥补这一点会很好（我想通过扫描源代码并将其与链接器输出匹配），但我没有发现任何迹象表明它有一个特殊的模式可以打开。

在此先感谢克格勃

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-20T06:51:29.910

确保您的函数不被丢弃的一种方法是导出它们。您可以通过添加[`__declspec(dllexport)`](http://msdn.microsoft.com/en-us/library/3y1sfaz2(VS.80).aspx)到您的函数声明来做到这一点。最好将其包装在 C 预处理器宏中，以便您可以将其关闭，因为它是特定于编译器的，您可能不希望所有构建都导出符号。导出函数的另一种方法是创建一个[`.DEF`文件](http://msdn.microsoft.com/en-us/library/d91k01sh(VS.80).aspx)。

如果内联是问题所在，您也可能在[`__declspec(noinline)`](http://msdn.microsoft.com/en-us/library/kxybs02x(VS.80).aspx).

您的代码是否在静态库中，然后编译成测试 EXE/DLL？链接器将自动丢弃静态库中未引用的目标文件。示例：如果静态库包含`a.obj`and`b.obj`以及您将其链接到引用符号 from `b.obj`but not的 EXE/DLL `a.obj`，则其内容`a.obj`将不会链接到可执行文件或 DLL。但是，在重新阅读您的描述后，这听起来不像是这里发生的事情。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-19T20:22:20.983

您可以尝试添加一行代码以仅在某些条件为真时调用该函数，并保证该条件永远不会为真。只要确保编译器无法解决这个问题。例如，

```
 int main(int argc, char **argv)
{
  if(argv == NULL)  // C runtime says this won't happen
    someMethodWhichIsntReallyEverCalled();
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-19T20:43:18.377

另一种选择是使用 .inl 文件根据您的构建在内联和非内联函数之间切换，如下所示：

在 foo.inl 文件中：

```
inline std::string Foo::ThisMethodDoesNotRun()
{
    return "Not Running";
} 
```

在 foo.h 中：

```
#if !COVERAGE_BUILD
#include "foo.inl"
#endif 
```

在 foo.cpp 中：

```
#if COVERAGE_BUILD
#define inline
#include "foo.inl"
#endif 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-19T19:52:26.703

关闭函数的内联。最简单的方法是在调试模式下编译。

**编辑：**看到你的澄清后，我发现我的答案是错误的。也许如果您使用“inline”关键字将函数体移动到 .h 文件的另一部分？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-19T20:05:02.883

抱歉，我应该澄清一下，我正在使用内联和所有优化来构建调试模式。此外，代码甚至在内联发生之前就被删除了，因为它甚至从未被考虑过内联。

# html - 相对于其容器定位元素

> ID：104953
> 
> 赞同：194
> 
> 时间：2008-09-19T19:48:22.937
> 
> 标签：html, css, positioning

我正在尝试使用 HTML 和 CSS 创建一个水平的 100% 堆叠条形图。我想`DIVs`根据我想要绘制的值使用背景颜色和百分比宽度来创建条形图。我还想要一条网格线来标记图表上的任意位置。

在我的实验中，我已经通过分配 CSS 属性让条形图水平堆叠`float: left`。但是，我想避免这种情况，因为它似乎确实以令人困惑的方式混淆了布局。此外，当条形图浮动时，网格线似乎效果不佳。

我认为CSS定位应该能够处理这个问题，但我还不知道该怎么做。我希望能够指定几个元素相对于其容器左上角的位置。我经常遇到这类问题（甚至在这个特定的图形项目之外），所以我想要一种方法：

1.  跨浏览器（理想情况下没有太多浏览器黑客）
2.  以 Quirks 模式运行
3.  尽可能清晰/干净，以方便定制
4.  如果可能，不使用 JavaScript 完成。

* * *

## 回答 #1

> 赞同：396
> 
> 时间：2008-09-19T20:01:06.260

你是对的，CSS定位是要走的路。这是一个快速运行：

`position: relative`*将相对于自身*布局一个元素。换句话说，元素以正常流程布局，然后从正常流程中移除并偏移您指定的任何值（上、右、下、左）。重要的是要注意，因为它已从流程中移除，它周围的其他元素不会随之移动（如果你想要这种行为，请使用负边距）。

但是，您很可能对`position: absolute`将元素相对于容器定位的位置感兴趣。默认情况下，容器是浏览器窗口，但如果父元素具有`position: relative`或`position: absolute`设置在其上，则它将充当父元素，为其子元素定位坐标。

展示：

```
#container {
  position: relative;
  border: 1px solid red;
  height: 100px;
}

#box {
  position: absolute;
  top: 50px;
  left: 20px;
}
```

```
<div id="container">
  <div id="box">absolute</div>
</div>
```

在该示例中， 的左上角`#box`将是 100px 向下和 50px 左上角的左上角`#container`。如果`#container`没有`position: relative`设置，坐标`#box`将相对于浏览器视口的左上角。

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2008-09-19T19:50:53.510

您必须明确设置父容器的位置以及子容器的位置。这样做的典型方法是这样的：

```
div.parent{
    position: relative;
    left: 0px;  /* stick it wherever it was positioned by default */
    top: 0px;
}

div.child{
    position: absolute;
    left: 10px;
    top: 10px;
} 
```

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2017-06-29T08:09:41.610

我知道我迟到了，但希望这会有所帮助。

以下是 position 属性的值。

*   静止的
*   固定的
*   相对的
*   绝对

**位置：静态**

这是默认设置。这意味着该元素将出现在它通常会出现的位置。

```
#myelem {
    position : static;
} 
```

**位置：固定**

这将设置元素相对于浏览器窗口（视口）的位置。即使页面滚动，固定定位的元素也将保持在其位置。

（如果您想要页面右下角的滚动到顶部按钮是理想的）。

```
#myelem {
    position : fixed;
    bottom : 30px;
    right : 30px;
} 
```

**位置：相对**

将元素放置在相对于其原始位置的新位置。

```
#myelem {
    position : relative;
    left : 30px;
    top : 30px;
} 
```

上面的 CSS 会将 #myelem 元素向左移动 30px，距离其实际位置的顶部 30px。

**位置：绝对**

如果我们希望将元素放置在页面中的确切位置。

```
#myelem {
    position : absolute;
    top : 30px;
    left : 300px;
} 
```

上面的 CSS 将 #myelem 元素定位在页面中距顶部 30px 和距左侧 300px 的位置，并且它将随页面滚动。

最后...

**相对位置 + 绝对位置**

我们可以将父元素的位置属性设置为*相对*，然后将子元素的位置属性设置为*绝对*。通过这种方式，我们可以将子代相对于父代定位在绝对位置。

```
#container {
    position : relative;
}

#div-2 {
    position : absolute;
    top : 0;
    right : 0;
} 
```

[![子元素相对定位的父元素的绝对位置。](../Images/bfe9e6fa4da49d902c5eadd22fbbb04e.png)](https://i.stack.imgur.com/NgOYQ.png)

我们可以在上图中看到**#div-2元素位于****#container**元素内的右上角。

GitHub：您可以在此处找到上图的 HTML，并[在](https://github.com/yusufshakeel/css-project/blob/master/css/position.css)[此处](https://github.com/yusufshakeel/css-project/blob/master/position.html)找到CSS 。

希望本[教程有所](https://www.dyclassroom.com/css/css-position)帮助。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-19T19:53:05.610

绝对定位相对于其最近的定位祖先定位元素。所以放在`position: relative`容器上，然后是子元素，只要子元素有`top`，`left`就会相对于容器的左上角`position: absolute`。[CSS 2.1 规范](http://www.w3.org/TR/CSS21/visuren.html#comp-abspos)中提供了更多信息。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2018-05-16T14:17:21.987

如果您需要先相对于其包含元素定位元素，则需要添加`position: relative` **到容器元素**。您要相对于父元素定位的子元素**必须具有** `position: absolute`. 绝对定位的工作方式是**相对于第一个相对（或绝对）定位的父元素完成**。如果**没有相对**定位的父元素，则元素将相对于**根元素**定位（直接定位到 HTML 元素）。

所以如果你想把你的子元素放在父容器的左上角，你应该这样做：

```
.parent {
  position: relative;
} 

.child {
  position: absolute;
  top: 0;
  left: 0;  
} 
```

[您将从阅读这篇文章](https://kolosek.com/css-position-relative-vs-position-absolute/)中受益匪浅。希望这可以帮助！

# c# - 测试抽象类的具体方法

> ID：104958
> 
> 赞同：8
> 
> 时间：2008-09-19T19:49:47.647
> 
> 标签：c#, .net, unit-testing

我将如何为抽象类的具体方法设计和组织测试？特别是在 .NET 中。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-19T19:53:24.143

您必须创建一个实现抽象方法（使用空方法）的子类，但没有具体方法。这个子类应该只用于测试（它不应该进入你的生产代码）。忽略单元测试中被覆盖的抽象方法并专注于具体方法。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-19T20:16:35.600

使用 Rhino Mocks，它可以在运行时生成抽象类的实现，您可以调用非抽象方法。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-19T19:52:29.357

首先想到的是在具体的子类中测试这些方法。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-19T19:51:50.900

有什么理由不将其包含在其中一个实例的测试中？

如果这不起作用，您可能会创建一个仅用于测试的子类，而没有它自己的独特功能。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-19T19:53:42.957

我总是使用 Stub/Mock 对象

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-19T19:55:09.020

您必须定义并创建一个继承自抽象的具体测试类。通常，它将是一个轻垫片，除了通过调用之外什么都不做。

# c++ - 在 Visual Studio 调试中检查 STL 容器

> ID：104959
> 
> 赞同：35
> 
> 时间：2008-09-19T19:49:50.190
> 
> 标签：c++, visual-studio, debugging, stl

如果我有一个`std::vector`or`std::map`变量，并且我想查看内容，那么在调试时看到第 n 个元素会很痛苦。是否有插件或一些技巧可以在调试时更轻松地查看 STL 容器变量`(VS2003/2005/2008)`？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-09-19T20:57:09.917

如果您想同时观看多个元素，可以附加一个逗号和元素数量，如下所示：

`(v._Myfirst)[startIndex], count`

但是，请注意 count 必须是一个常量，它不能是另一个表达式的结果。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-09-19T20:00:46.027

对于矢量，msdn 论坛上的这个[线程](http://social.msdn.microsoft.com/forums/en-US/vsdebug/thread/c09f4fe4-4783-4dbb-8d36-85489fa2a4ae)有一个代码片段，用于在矢量索引上设置监视，这可能会有所帮助。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-09-21T18:28:50.973

在 VS2005 和 VS 2008 中，您可以看到 STL 容器的内容。获取数据的规则位于 autoexp.dat "c:\Program Files\Microsoft Visual Studio 9\Common7\Packages\Debugger\autoexp.dat" 中。

AutoExp.dat 旨在定制。但是，STL 定义位于称为 [Visualizer] 的部分下。如果您能弄清楚该部分中使用的语言，那么您将获得更大的力量，但是我建议您不要理会该部分。

Autoexp.dat 存在于 VS2003 中，但不支持 STL 容器（[Visualizer] 不存在）。在 VS2003 中，您必须手动导航底层数据表示。

通过修改 autoexp.dat 可以添加用于导航您自己类型的数据表示的规则，以便它们更易于调试。如果你这样做，你应该只添加到[AutoExp]下的东西。在修改它之前，请小心并备份此文件。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2015-03-28T14:51:43.677

要在 Visual Studio 调试器中查看容器的第 n 个元素，请使用：

```
container.operator[](n) 
```

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-09-19T20:18:56.857

您可以创建一个自定义可视化器检查一下：[http ://www.virtualdub.org/blog/pivot/entry.php?id=120](http://www.virtualdub.org/blog/pivot/entry.php?id=120)

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2016-10-31T02:32:09.317

最简单的方法是你必须准备一个指针来监视这样的变量。

```
vector<int> a = { 0,1,2,3,4,5 };
int* ptr = &a[0]; // watch this ptr in VisualStudio Watch window like this "ptr,6". 
```

我在 VisualStudio2015 中尝试了“a._Myfirst[0]”，但它不是显示数组数据。

如果您可以使用“ [natvis](https://msdn.microsoft.com/en-us/library/jj620914.aspx) ”，它将解决您的问题。

这是用于显示 Visual Studio 2015 的 std::vector 数据的“sample.natvis”。

```
<?xml version="1.0" encoding="utf-8"?> 
<AutoVisualizer xmlns="http://schemas.microsoft.com/vstudio/debugger/natvis/2010">
  <Type Name="std::vector&lt;*&gt;">
    <DisplayString>{{ size={_Mypair._Myval2._Mylast - _Mypair._Myval2._Myfirst} }}</DisplayString>
    <Expand>
      <Item Name="[size]" ExcludeView="simple">_Mypair._Myval2._Mylast - _Mypair._Myval2._Myfirst</Item>
      <Item Name="[capacity]" ExcludeView="simple">_Mypair._Myval2._Myend - _Mypair._Myval2._Myfirst</Item>
      <ArrayItems>
        <Size>_Mypair._Myval2._Mylast - _Mypair._Myval2._Myfirst</Size>
        <ValuePointer>_Mypair._Myval2._Myfirst</ValuePointer>
      </ArrayItems>
    </Expand>
  </Type>
</AutoVisualizer> 
```

**前** [![在此处输入图像描述](../Images/a4e38660da01c0351774a0f87f92af25.png)](https://i.stack.imgur.com/DhEus.png)

**后** [![在此处输入图像描述](../Images/7b39fb289b960299bf01d05dac01ec40.png)](https://i.stack.imgur.com/JwWd7.png)

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-09-19T20:13:13.067

至少对我而言，Visual Studio 2008 会在标准的鼠标悬停内容框中显示 STL 容器的内容。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-19T20:53:36.417

您也可以右键单击手表中的任何值，然后选择“添加手表”。如果您只需要查看地图或集合的一个元素，这将很有用。

它还导致了 christopher_f 为向量发布的解决方案 - ((v)._Myfirst)[index]

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2013-08-06T15:38:02.153

上面讨论的方法**[((v)._Myfirst)[index]]**仅适用于特定容器（std::vector），不适用于所有可能的 STL 容器。例如，如果您想查看 std::deque 的内容，那么您必须寻找其他方法来浏览 std::deque 中的内容。

也许您可以尝试以下类似的设置来解决您的问题

**[我仅针对随 Microsoft Visual Studio 2010 Service Pack 1 安装的 Visual Studio 2010 Professional 版本测试了此设置]**

第 1 步：卸载 Microsoft Visual Studio 2010 Service Pack 1 - 对于我的项目工作，我真的不需要 Service Pack 1，因此卸载 Service Pack 1 不会对我的情况造成任何问题。

第 2 步：重新启动系统。

第 3 步：如果您没有收到错误“链接：致命错误 LNK1123：转换为 COFF 期间失败：文件无效或损坏”，则无需执行此步骤。否则浏览

项目属性 -> 链接器（常规） -> 将启用增量链接更改为否（/INCREMENTAL:NO）

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2016-06-08T05:33:31.357

在 vs 2015 中，我无法让这些工作中的任何一个工作
，所以我写了一些代码

# 1：我有**long long 元素的向量向量**

```
std::vector<std::string> vs(M_coins + 1);
for (unsigned long long i = 0; i <= M_coins; i++) {
    std::for_each(memo[i].begin(), memo[i].end(), [i, &vs](long long &n) {
        vs[i].append(std::to_string(n));
        });
}
// now vs is ready for use as vs[0], vs[1].. so on, for your debugger 
```

基本上我所做的是将向量转换为字符串。我有向量的向量，所以我有要填充的字符串向量。

# 2：如果你只有**一个 long long 元素的向量**，那么只需转换如下：

```
std::vector<std::string> s;
std::for_each(v1.begin(), v1.end(), [&s](long long &n) {
    s.append(std::to_string(n));
    });
// now s is ready for use, for your debugger 
```

希望它有所帮助。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2022-02-01T02:52:43.303

这是旧的，但由于我经常偶然发现这篇文章，因为它在谷歌上的引用率仍然很高，截至 Visual Studio 2019，人们可以简单地在调试器的 Watch 中编写：

```
vectorName.data() 
```

（用您的变量名替换vectorName）以获取指向内容的指针。

然后，知道向量的当前大小，您可以告诉调试器显示前 N 个单元格：

```
vectorName.data(),N 
```

（N 是你的向量的大小）

如果像我一样，你有很多实际存储另一个数据结构的字节向量，你甚至可以告诉调试器将指针解释为其他东西的数组：

```
(float*)vectorName.data(),4 
```

例如，我有一个 16 字节的 std::vector，使用它我可以告诉调试器向我显示一个包含 4 个浮点数的数组（这对我来说比单独的字节更有用）。

# database - Haskell 有 ORM 工具吗？

> ID：104960
> 
> 赞同：37
> 
> 时间：2008-09-19T19:50:12.793
> 
> 标签：database, orm, haskell

使用 Haskell 与数据库交互的最佳方式是什么？我习惯于使用某种 ORM（Django 的 ORM、hibernate 等），在使用[HAppS](http://www.happs.org/)创建应用程序时，类似的东西会很好。

**编辑：**就实际数据库而言，我想自由选择 Postgresql MySql 和 SQLite。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-09-19T22:48:34.580

我想到的库不是 ORM，但它仍然可以做你想做的事。

如果你想要一些东西可以让你的数据库访问安全，同时很好地将东西集成到你的程序中，那么试试[HaskellDB](http://www.haskell.org/haskellwiki/Applications_and_libraries/Database_interfaces/HaskellDB)。它基本上会查看您的架构，生成一些数据结构，然后为您提供类型安全的查询方式。它已经存在了很长一段时间，社区认为它很好且稳定。

要使用它，您需要一些底层的 Haskell DB 库，例如 HSQL。

祝你好运！

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-11-15T22:52:56.103

ORM 库存在的原因是 C# 或 Java 中的对象与您存储在数据库中的对象之间存在相对较大的差异。这在 Haskell 中不是什么大问题，因为：

1.  它没有对象
2.  数据库和 Haskell 列表都受到数学集合论的启发，因此它们之间的摩擦比数据库和对象之间的摩擦要小得多。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2013-05-28T22:26:09.910

Persistent 使用起来相当不错，它可以让您依靠类型推断来确定您的查询所涉及的表。例如，如果我的“模型”文件中有以下内容：

```
User
    name Text
    age Int

Login
    user UserId
    login Text
    passwd Text 
```

然后我可以这样做：

```
Just (Entity uid _)          <- selectFirst [ UserName ==. "exampleUser" ] []
Just (Entity lid Login {..}) <- selectFirst [ LoginUser ==. uid ] [] 
```

它会知道我指的是哪些表。当然，您可能不想编写这样的部分代码，但我只想强调查询。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2013-05-28T19:26:14.377

我个人只使用了“Real World Haskell”推荐的 [Database.HDBC ：http:](http://github.com/hdbc/hdbc) [//book.realworldhaskell.org/read/using-databases.html](http://book.realworldhaskell.org/read/using-databases.html)

但我同意使用更高级别的数据库访问层绝对是有意义的，我可能会尝试在未来的项目中使用这种模型。关于这个主题，我发现了 2012 年的这篇文章，它提供了 Haskell 此类解决方案的历史和比较： [http ://www.yesodweb.com/blog/2012/03/history-of-persistence](http://www.yesodweb.com/blog/2012/03/history-of-persistence)

从中，我收集到 Persistent（[文档](http://www.yesodweb.com/book/persistent/ "执着的")）和 Groundhog（[一些文档](http://hackage.haskell.org/package/groundhog/docs/Database-Groundhog.html)、[示例](https://github.com/lykahb/groundhog/tree/master/examples)）是该领域最有前途的库。这两个库都支持您提到的数据库；对于土拨鼠，它没有写在这篇文章中，但[在这个公告中](http://www.reddit.com/r/haskell/comments/1co402/ann_groundhog_03_mysql_schemas_and_enhanced/ "在本公告中")你可以看到它完全支持你感兴趣的数据库。

还要注意[Haskell-beginners 上的这个线程](http://www.haskell.org/pipermail/beginners/2013-June/012223.html)，其中提到[Esqueletto](http://hackage.haskell.org/packages/archive/esqueleto/latest/doc/html/Database-Esqueleto.html)是更新操作的更好选择。

请注意，持久性与 Yesod 一起提供，因此可能有更多的追随者。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-02T06:36:37.770

实际上，我非常喜欢 HAppS ( [HAppS-State](http://hackage.haskell.org/cgi-bin/hackage-scripts/package/HAppS-State) ) 的方法，它可以让你忘记经历 ORM 的编组/解编组，让你简单地使用 Haskell 的数据类型。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-19T21:13:05.230

您是否查看了 [http://hackage.haskell.org/packages/archive/pkg-list.html#cat:Database上的数据库映射和访问包](http://hackage.haskell.org/packages/archive/pkg-list.html#cat:Database)

我没有使用过它们，所以不能推荐任何特定的。我也不知道你打算使用什么数据库。

# parsing - 如何使用 Flex 实现两遍扫描仪？

> ID：104967
> 
> 赞同：8
> 
> 时间：2008-09-19T19:51:22.620
> 
> 标签：parsing, bison, flex-lexer, lexical-analysis

作为一个宠物项目，我想尝试实现一种我自己设计的基本语言，可以用作网络脚本语言。将 C++ 程序作为 Apache CGI 运行是微不足道的，因此真正的工作在于如何解析包含非代码（HTML/CSS 标记）和服务器端代码的输入文件。

在我本科的编译器课程中，我们使用[Flex](http://www.gnu.org/software/flex/)和[Bison](http://www.gnu.org/software/bison/)为一种简单的语言生成扫描器和解析器。我们得到了一份语法副本，并编写了一个解析器，将简单的语言翻译成虚拟机的简单程序集。flex 扫描器对输入进行标记，并将标记传递给 Bison 解析器。

这与我想做的不同之处在于，就像 PHP 一样，这种语言可以有纯 HTML 标记，而脚本语言可以像下面这样穿插：

```
<p>Hello,
<? echo "World ?>
</p> 
```

我假设按如下方式解析输入文件会很有效，我是否不正确：

1.  扫描输入，直到找到脚本开始标记（'
2.  第二个扫描器标记输入文件的服务器端脚本部分（来自打开标记：''）并将标记传递给解析器，它不需要知道文件中的标记。
3.  控制权返回到继续这种一般模式的第一个扫描仪。

基本上，第一个扫描器只区分标记（直接返回到浏览器未修改）和代码，它被传递给第二个扫描器，第二个扫描器反过来标记代码并将标记传递给解析器。

如果这*不是*一个可靠的设计模式，PHP 等语言如何有效地处理扫描输入和解析代码？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-21T15:23:08.113

您想查看开始条件。例如：

```
"<?"            { BEGIN (PHP); }
<PHP>[a-zA-Z]*  { return PHP_TOKEN; }
<PHP>">?"       { BEGIN (0); }
[a-zA-Z]*       { return HTML_TOKEN; } 
```

您从状态 0 开始，使用 BEGIN 宏来更改状态。要仅在特定状态下匹配 RE，请在 RE 前面加上用尖括号括起来的状态名称。

In the example above, "PHP" is state. "PHP_TOKEN" and "HTML_TOKEN" are _%token_s defined by your yacc file.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-19T20:06:15.517

PHP 不区分扫描和标记。它只是在标记模式下输出到缓冲区，然后在代码模式下切换到解析。您不需要两遍扫描仪，只需一个弹性词法分析器即可完成此操作。

如果您对 PHP 本身的工作原理感兴趣，请下载源代码（试试 PHP4 源代码，它更容易理解）。您要查看的是 Zend 目录中的`zend_language_scanner.l`.

我自己写过类似的东西，我真的建议重新考虑走 Flex 和 Bison 路线，并使用像[Antlr](http://www.antlr.org/)这样的现代东西。它更容易、更容易理解（lex 语法中使用的宏变得非常混乱且难以阅读）并且它具有内置调试器（[AntlrWorks](http://www.antlr.org/works/index.html)），因此您不必花费数小时查看 3 Meg 调试文件. 它还支持多种语言（Java、c#、C、Python、Actionscript），并拥有一本优秀的书籍和一个非常好的网站，应该能够让您立即启动并运行。

# sql - SQL 查询帮助：选择出现一定次数的行

> ID：104971
> 
> 赞同：5
> 
> 时间：2008-09-19T19:51:56.847
> 
> 标签：sql, date, select

我有一个带有“日期”列的表。每个日期可能出现多次。如何仅选择出现 < k 次的日期？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-19T19:53:22.740

```
SELECT * FROM [MyTable] WHERE [Date] IN
(
    SELECT [Date] 
    FROM [MyTable] 
    GROUP By [Date] 
    HAVING COUNT(*) < @Max
) 
```

另请参阅 @[SQLMenace] 的回复。它与此非常相似，但根据您的数据库，他的 JOIN 可能会运行得更快，假设优化器不会产生影响。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-19T19:55:45.057

```
select dates 
  from table t 
 group by dates having count(dates) < k ; 
```

希望它适用于 ORACLE。高温高压

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-19T19:54:46.637

使用 COUNT 聚合：

```
SELECT Date
FROM SomeTable
GROUP BY Date
HAVING COUNT(*) < @k 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-19T19:54:48.883

对于“出现 x 次”的查询，最好使用 HAVING 子句。在您的情况下，查询可能类似于：

```
SELECT Date FROM table GROUP BY Date HAVING COUNT(*)<k 
```

或者，您需要选择除日期以外的其他列：

```
SELECT * FROM Table WHERE Date IN (
SELECT Date FROM table GROUP BY Date HAVING COUNT(*)<k) 
```

您也可以将 IN 重写为 INNER JOIN，但这不会提高性能，因为事实上，查询优化器会在大多数 RDBMS 中为您执行此操作。在 Date 上有索引肯定会提高此查询的性能。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-19T19:56:17.317

例子

```
DECLARE @Max int
SELECT @Max =  5

SELECT t1.* 
FROM [MyTable] t1 
JOIN(
    SELECT [Date] 
    FROM [MyTable] 
    GROUP By [Date] 
    HAVING COUNT(*) < @Max
) t2 on t1.[Date]  = t2.[Date] 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-19T19:54:56.307

```
SELECT date, COUNT(date)
FROM table
GROUP BY date
HAVING COUNT(date) < k 
```

然后取回原始数据：

```
SELECT table.*
FROM table
INNER JOIN (
  SELECT date, COUNT(date) 
  FROM table
  GROUP BY date
  HAVING COUNT(date) < k) dates ON table.date = dates.date 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-19T19:55:10.347

假设您使用的是 Oracle，并且 k = 5：-

```
select date_col,count(*)
from your_table
group by date_col
having count(*) < 5; 
```

如果您的日期列也填写了时间，并且您想忽略它，请修改查询，使其如下所示：-

```
select trunc(date_col) as date_col,count(*)
from your_table
group by trunc(date_col)
having count(*) < 5; 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-22T15:06:36.087

如果您的日期包括时间，您可能无法直接在日期字段上进行计数。您可能需要先转换为年/月/日格式，然后再计算。

否则，您的计数将被取消，因为通常很少有记录具有完全相同的时间。

# c# - ReSharper 向 .NET 2.0 项目发出 C# 3.0 代码检查警告

> ID：104978
> 
> 赞同：6
> 
> 时间：2008-09-19T19:52:42.740
> 
> 标签：c#, .net, visual-studio, asp.net-2.0, resharper

当我使用最新版本的 ReSharper (4.1) 处理 .NET 2.0 项目时，我收到有关使用 var 关键字和 lambadas 等的警告。知道如何仅为 .NET 2.0 项目禁用此功能吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-19T20:41:54.853

实际上，您可以在面向 .NET 2.0 时使用 C# 3.0 编译器功能，但扩展方法和默认 LINQ 实现除外，它们位于较新的程序集中。但是如果您需要与 VS2005 用户合作，您可以打开给定项目的 Properties 视图（不是 Project Properties，而是 Edit \ Properties Window，或 F4）并选择所需的语言级别。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-19T19:57:33.680

您实际上可以在 2.0 项目中使用 var。它是语法糖，编译器使用它。查看此以获取更多信息。

[http://weblogs.asp.net/shahar/archive/2008/01/23/use-c-3-features-from-c-2-and-net-2-0-code.aspx](http://weblogs.asp.net/shahar/archive/2008/01/23/use-c-3-features-from-c-2-and-net-2-0-code.aspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-26T04:49:00.357

Daniel Moth 有一篇很棒的[博客文章](http://www.danielmoth.com/Blog/2007/05/using-c-30-from-net-20.html)，介绍了如何在 .Net 2.0 中使用 C# 3.0 功能（包括扩展方法）。

重读问题后，这确实无济于事。您可以通过 R# 选项窗口关闭特定检查。我不知道如何在不手动更改项目设置的情况下在 2.0 和 3.5 项目设置之间来回切换：S。

# python - 什么是 Python 中的“线程本地存储”，为什么需要它？

> ID：104983
> 
> 赞同：120
> 
> 时间：2008-09-19T19:53:19.447
> 
> 标签：python, multithreading, thread-local

特别是在 Python 中，变量如何在线程之间共享？

尽管我以前使用`threading.Thread`过，但我从未真正理解或看到变量如何共享的示例。它们是在主线程和子线程之间共享还是仅在子线程之间共享？我什么时候需要使用线程本地存储来避免这种共享？

我已经看到很多关于使用锁在线程之间同步访问共享数据的警告，但我还没有看到一个非常好的问题示例。

提前致谢！

* * *

## 回答 #1

> 赞同：105
> 
> 时间：2008-09-19T19:59:40.587

在 Python 中，所有东西都是共享的，除了函数局部变量（因为每个函数调用都有自己的一组局部变量，并且线程总是单独的函数调用。）即使那样，只有变量本身（引用对象的名称）是函数的局部；对象本身总是全局的，任何东西都可以引用它们。`Thread`在这方面，特定线程的对象不是特殊对象。如果您将`Thread`对象存储在所有线程都可以访问的位置（如全局变量），那么所有线程都可以访问该`Thread`对象。如果你想原子地修改另一个线程可以访问的*任何东西，你必须用锁来保护它。*当然，所有线程都必须共享这个相同的锁，否则它不会很有效。

如果您想要实际的线程本地存储，那就是`threading.local`进来的地方。`threading.local`线程之间不共享的属性；每个线程只看到它自己放置在那里的属性。如果您对它的实现感到好奇，源代码在标准库的[_threading_local.py中。](https://github.com/python/cpython/blob/master/Lib/_threading_local.py)

* * *

## 回答 #2

> 赞同：89
> 
> 时间：2009-12-12T18:58:50.557

考虑以下代码：

```
#/usr/bin/env python

from time import sleep
from random import random
from threading import Thread, local

data = local()

def bar():
    print("I'm called from", data.v)

def foo():
    bar()

class T(Thread):
    def run(self):
        sleep(random())
        data.v = self.getName()   # Thread-1 and Thread-2 accordingly
        sleep(1)
        foo() 
```

```
>> T().start(); T().start()
我是从 Thread-2 调用的
我是从 Thread-1 调用的
```

这里 threading.local() 被用作一种快速而肮脏的方式来将一些数据从 run() 传递到 bar() 而不更改 foo() 的接口。

请注意，使用全局变量不会成功：

```
#/usr/bin/env python

from time import sleep
from random import random
from threading import Thread

def bar():
    global v
    print("I'm called from", v)

def foo():
    bar()

class T(Thread):
    def run(self):
        global v
        sleep(random())
        v = self.getName()   # Thread-1 and Thread-2 accordingly
        sleep(1)
        foo() 
```

```
>> T().start(); T().start()
我是从 Thread-2 调用的
我是从 Thread-2 调用的
```

同时，如果您能负担得起将这些数据作为 foo() 的参数传递 - 这将是一种更优雅且设计良好的方式：

```
from threading import Thread

def bar(v):
    print("I'm called from", v)

def foo(v):
    bar(v)

class T(Thread):
    def run(self):
        foo(self.getName()) 
```

但在使用第三方或设计不佳的代码时，这并不总是可行的。

* * *

## 回答 #3

> 赞同：26
> 
> 时间：2008-09-20T00:31:24.037

您可以使用创建线程本地存储`threading.local()`。

```
>>> tls = threading.local()
>>> tls.x = 4 
>>> tls.x
4 
```

存储到 tls 的数据对于每个线程都是唯一的，这将有助于确保不会发生意外共享。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-19T20:03:30.640

就像其他所有语言一样，Python 中的每个线程都可以访问相同的变量。“主线程”和子线程之间没有区别。

与 Python 的一个区别是全局解释器锁意味着一次只能有一个线程运行 Python 代码。然而，在同步访问方面，这并没有多大帮助，因为所有常见的抢占问题仍然适用，并且您必须像在其他语言中一样使用线程原语。但是，这确实意味着您需要重新考虑是否使用线程来提高性能。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2020-02-15T18:26:56.477

我在这里可能错了。如果您知道其他情况，请进行说明，因为这将有助于解释为什么需要使用线程 local()。

这句话似乎不对，没有错：“如果你想原子地修改另一个线程可以访问的任何东西，你必须用锁来保护它。” 我认为这句话 -> 有效<- 正确，但并不完全准确。我认为术语“原子”意味着 Python 解释器创建了一个字节码块，它没有为 CPU 的中断信号留下空间。

我认为原子操作是不能访问中断的 Python 字节码块。像“running = True”这样的 Python 语句是原子的。在这种情况下，您不需要锁定 CPU 以防止中断（我相信）。Python 字节码分解不会受到线程中断的影响。

像“threads_running[5] = True”这样的 Python 代码不是原子的。这里有两块 Python 字节码；一个用于取消引用对象的 list() 和另一个字节码块以将值分配给对象，在这种情况下是列表中的“位置”。可以引发中断-->在<-两个字节码->块<-之间。那是坏事发生了。

线程 local() 与“原子”有何关系？这就是为什么该声明似乎误导了我。如果不是，你能解释一下吗？

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2021-12-22T14:15:00.913

值得一提`threading.local()`的是不是单例。

您可以在每个线程中使用更多。它**不是一个存储**。