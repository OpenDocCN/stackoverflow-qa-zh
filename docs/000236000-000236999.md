# StackOverflow 问答 000236000-000236999

# computer-science - 什么是图灵机？

> ID：236000
> 
> 赞同：47
> 
> 时间：2008-10-25T06:25:10.650
> 
> 标签：computer-science, theory, turing-machines, computability

什么是图灵机，为什么人们一直提到它？我只需要我的 IBM PC 来进行计算！为什么有人关心这些机器？

* * *

## 回答 #1

> 赞同：60
> 
> 时间：2008-10-25T06:52:51.330

图灵机之所以如此重要，与对经典计算科学或计算理论类东西的研究有关。它基本上是关于分析计算机的一般属性，例如计算机具有哪些理论能力和局限性，以及我们在谈论“计算”时的含义。

可以使用图灵机研究的一个例子是[停机问题](http://en.wikipedia.org/wiki/Halting_problem)。虽然这个问题是一种学术练习，但它很容易在现实世界中产生切实的影响。为什么不编写一个调试器，它会简单地告诉您程序是否包含任何无限循环？停止问题确定了在一般情况下解决此问题是不可能的。

图灵机的研究也有助于研究语言语法及其类，从而导致编程语言的发展。术语“正则表达式”的出现是因为它们是一种[正则文法](http://en.wikipedia.org/wiki/Regular_grammar)，对这些文法（计算理论的一部分）的研究将告诉你更多关于正则表达式可以解决哪些问题以及它们不能解决什么问题的更多信息。例如，传统的正则表达式语法将无法解决以下问题：在输入中解析一些 N 个 'a' 字符，然后解析相同数量 N 个 char 'b'。

如果你对这类事情的好文章感兴趣，请查看Michael Sipser[的计算理论导论。](https://rads.stackoverflow.com/amzn/click/com/053494728X)很好。

* * *

## 回答 #2

> 赞同：33
> 
> 时间：2008-10-25T06:43:04.140

图灵机是艾伦·图灵发明的一种理论计算机，作为数学计算的理想模型，基本上是一种简单的计算机形式，由*磁带*（纸带）组成，有一个可以读取符号的*头*，在原处写一个新符号，然后向左或向右移动。

据说图灵机处于某种*状态*，然后一个程序就是一个*转换*列表，有一个当前状态和一个符号，在磁带上应该写什么，下一个状态是什么，以及在哪里头部应该移动。

这是一个[基本的图灵机](https://gist.github.com/azproduction/1400509)，用 JavaScript 实现......

和草图：

![图灵机](https://i.stack.imgur.com/iMTUb.jpg)

* * *

## 回答 #3

> 赞同：28
> 
> 时间：2008-10-28T17:53:15.120

> *我只需要我的 IBM PC 来进行计算！*

其他人没有指出的事情：您的 IBM PC*是*图灵机。更准确地说，它等同于它，在某种意义上，您的 PC 可以做的任何事情，图灵机都可以做，而图灵机可以做的任何事情，您的 PC 都可以。

具体来说，图灵机是一种**计算模型，**它完全捕捉了可计算性的概念，同时保持简单的推理，没有你 PC 架构的所有具体细节。

（普遍接受的）“Church-Turing 论点”断言，每个设备或计算模型并不比图灵机更强大。因此，许多理论问题（例如 P 和 NP 等类，“多项式时间算法”的概念等）都以图灵机的形式正式表述，当然，它们可以适用于其他模型：好。（例如，有时用 lambda 演算、组合逻辑或其他任何东西来考虑计算会很方便……它们在能力上彼此相等，对你的 IBM PC 也一样。）

所以你去吧：人们谈论图灵机是因为它是一种精确且完全指定的方式来说明“计算机”是什么，而不必描述 CPU 架构的每个细节、它的约束等等。

* * *

## 回答 #4

> 赞同：27
> 
> 时间：2008-10-25T22:31:19.130

自然界中实际上有图灵机的例子。具体来说，将 RNA 翻译成蛋白质的**核糖体实现了图灵机。**

首先，一些背景：

1.  RNA 由一串核苷酸（“碱基”）组成，这些核苷酸定义了遗传字母表中的字母。
2.  RNA字母表中有4个碱基——A、C、G、U。
3.  碱基是定向的：按照惯例，末端被称为五素数和三素数（5'，3'）
4.  RNA 串中的一个碱基可以以“反平行互补对”的形式吸引另一个 RNA 串上的一个碱基，其中 A 粘在 U 上，C 粘在 G 上。
5.  碱基以 3 个为一组组合形成“密码子”（单词）。
6.  密码子有 64 种可能的组合 (4^3)。
7.  每个密码子都可以匹配一个“反密码子”。例如 AUG <-> UAC
8.  有特殊的载体分子（“tRNA”）具有特殊的反密码子并连接到特定的氨基酸（蛋白质）。

**核糖体的操作很简单：**

1.  转录起始于“起始密码子”，它定义了“阅读框”
2.  转录总是沿 5'->3' 方向进行
3.  阅读框下的密码子与包含特定氨基酸的特定 tRNA 匹配
4.  起始密码子总是编码氨基酸蛋氨酸。
5.  新的氨基酸附着在生长的蛋白质上
6.  然后框架前进 3 个碱基到下一个密码子，蛋白质不断延伸
7.  在遇到“终止”密码子时，翻译终止，没有氨基酸连接，核糖体从 mRNA 上解离。

如您所见，这是一个非常简单的图灵机，它执行最复杂的操作——自然本身！

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-10-25T10:02:24.863

图灵机是一种理论机器，可用于推理计算机的局限性。简单地说，它是一台具有无限内存的假想计算机。

我们关心图灵机，因为它们帮助我们发现用真正的计算机（比如你的 IBM PC）不可能完成的事情。如果图灵机不可能执行特定的计算（例如决定[停机问题](http://en.wikipedia.org/wiki/Halting_problem)），那么您的 IBM PC 也不可能执行相同的计算。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-10-25T09:02:45.560

为什么设计飞机的人会关心莱特兄弟，或者让固定翼飞机飞行的“升力”背后的科学？

艾伦·图灵被誉为现代计算之父。图灵机是所有现代计算机的先驱。

可计算性理论是我在大学里最难的一门课，但我很高兴我上了。它让我思考我永远不会有的事情，或者以我永远不会有的方式思考事情，这些都是好事。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-10-25T06:28:35.760

图灵机是一种能够计算的抽象机器。

来自维基百科：

> 图灵机是基本的抽象符号操作设备，尽管它们很简单，但可以适应模拟任何计算机算法的逻辑。艾伦·图灵在 1936 年描述了它们。图灵机并不是一种实用的计算技术，而是一种关于机械计算极限的思想实验。因此，它们实际上并没有被建造。研究它们的抽象属性可以对计算机科学和复杂性理论产生许多见解。
> 
> 能够模拟任何其他图灵机的图灵机称为通用图灵机（UTM，或简称为通用机）。Alonzo Church 引入了一个具有类似“普遍”性质的更面向数学的定义，他在 lambda 演算方面的工作与 Turing 在正式的计算理论中交织在一起，称为 Church-Turing 论文。该论文指出，图灵机确实捕捉到了逻辑和数学中有效方法的非正式概念，并提供了算法或“机械程序”的精确定义。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-10-25T06:44:44.153

图灵机是一种抽象机器，它可以对一系列数据进行操作，并且可以根据某种逻辑在操作时改变自己的状态以及数据。

这是一个构成算法、存储程序和一般计算基础的概念。如果您正在处理算法、状态、数据等，它提供了很好的见解和抽象。

对于大多数人来说，值得深思。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-11-02T02:16:04.740

除了 Wikipedia 条目之外，您可能还想阅读Charles Petzold所著[的 The Annotated Turing一书。](https://rads.stackoverflow.com/amzn/click/com/0470229055)副标题是“Alan Turing 关于可计算性和图灵机的历史论文的导览”，它包括完整的论文，分成多个块，包含许多关于该主题的论述，包括历史观点。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2016-02-16T16:55:53.237

图灵机相当于一种算法。它在接受字符串时停止，在不接受字符串时拒绝或进入无限循环。

磁带充当存储器，转换规则充当“if then else”条件

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2019-11-27T00:55:05.113

图灵机的惊人之处在于，它是现存的最基本的计算机，它可以执行与当今存在的任何计算机一样强大的计算。没有图灵机无法解决的计算机问题。实际上，如果您想这样看，您的计算机就是 TM。

Alan Turing 发明了 TM 并使用它的某个版本来解码纳粹加密机 Enigma。

所以总而言之，它是一个非常强大的机器，在理论计算机科学中有很多应用。（顺便说一句，这也是一个超级有趣和刺激的主题）。

# windows - UNIX 与 Windows 内存释放

> ID：236001
> 
> 赞同：7
> 
> 时间：2008-10-25T06:25:27.623
> 
> 标签：windows, language-agnostic, unix, memory-management

我的理解是，在 unix 中，当内存被释放时，内存不会返回给操作系统，它会留在进程中以再次用于下一次调用 malloc。

在 Windows 上，我知道内存实际上是返回给操作系统的。

这两种做事方式之间有什么大区别，还是只是做同一件事的两种不同方式？如果这两种方法有任何优点/缺点，它们是什么？

**编辑：** 感谢您的澄清。我一直认为这是操作系统的问题（因为在类 UNIX 系统中进程的大小似乎从未减小，但在 Windows 中却如此）。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-10-25T12:40:45.713

在这方面，Windows 和 Unix 之间没有太大区别。

两者都有两个级别的分配。操作系统以大块（一页或更多；在 x86 上，页面大小通常为 4096 字节）为进程分配内存。在进程中运行的运行时库会细分该空间并将其中的一部分分配给您的代码。

要将内存返回给操作系统，首先必须将从这些大块之一分配的所有内存释放到运行时库。如果需要，运行时库可以告诉操作系统释放那块内存。

在 Linux 上，您有`brk`和`mmap`. `brk`控制分配给您的进程的大块内存的大小；你可以扩大或缩小它，但只能在一端。`malloc`传统上，当它需要更多内存来分配时，会扩展这块内存，并在可能的情况下缩小它。但是，缩小并不容易；最后需要一个单字节的不合时宜的分配，使其无法收缩，即使在该分配之前的所有内容都已被释放。这就是“Unix 不释放内存”模因的来源。

但是，也有匿名的`mmap`。Anonymous`mmap`从操作系统请求一块内存，它可以放在进程内存空间的任何地方。当不再需要这个块时，可以很容易地返回它，即使有后来的分配还没有释放。`malloc`也使用`mmap`（特别是对于大型分配，其中一整块内存在被释放后可以很容易地返回）。

当然，在 Windows 和 Linux 上，如果您不喜欢运行时库中的内存分配器（或分配器）的行为，您可以使用自己的，从操作系统询问内存并按照您想要的方式（或者有时从另一个分配器请求内存，但在更大的块中）。一个有趣的用途是为与任务相关的所有内存分配器（例如，Web 服务器请求），在任务结束时完全丢弃（无需单独释放所有部分）；另一个有趣的用途是固定大小对象（例如，五字节对象）的分配器，它可以避免内存碎片。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-25T07:22:12.453

请注意，在接下来的内容中，我对 Windows 的了解比对 Unix 的多得多……

无论如何，内存分配和释放实际发生的情况并不完全是您所描述的。这是因为这里有两个非常不同的概念在起作用：计算机拥有的物理内存，以及程序的虚拟地址空间，即您的程序认为它可以使用的内存。

当您的程序向操作系统请求更多内存时，实际发生的是程序中以前不可用的虚拟地址空间被设置为程序可访问。现代操作系统不能仅仅通过拥有一个“真实”（即物理）内存池来工作，当它们发出分配请求时它会分发给进程：它为每个正在运行的程序维护虚拟地址空间，并且，当程序实际访问该虚拟地址空间的一部分，确保将其映射到某些物理内存，可能通过将另一个程序的地址空间的某些部分换出到磁盘上的交换文件。

例如，在 Windows 上，每个线程都以（默认情况下）为其分配的 1 MB 堆栈空间开始。这并不意味着每个线程都消耗一兆字节的机器物理内存：只是设置了地址空间以便它可以使用。从这个意义上说，考虑操作系统给你的程序内存然后程序把它还给它是行不通的——它只是不能那样工作。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-25T07:30:59.927

这完全取决于您使用的 C 运行时库。没有特定的 UNIX 方式或 WINDOWS 方式。每个编译器供应商（HP、SUN、MS、GNU）都附带了他们自己的包含 malloc 逻辑的运行时库。malloc 的每个实现将根据操作系统运行相同/不同。UNIX/LINUX/Windows 都不需要免费的“实际返回”内存给操作系统。那太贵了（因为你的 alloc() 会是非常小的块）

最近 mozilla Firefox 从 *BSD OS 借用了 malloc() 实现。他们选择使用与他们的编译器供应商（在本例中为多个——gcc 和 VC++）提供的不同的 malloc。既然他们想要某种行为，他们就得到了他们想要的。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-25T08:37:33.193

正如其他提到的，这与 malloc 实现的联系比操作系统本身更多。在 linux 上，使用 glibc，内存实际上总是返回给操作系统，超过一定大小：glibc malloc 使用 mmap 进行大分配（由 MMAP_THRESHOLD 控制），在这种情况下，free 调用 munmap，它会自动释放保留的内存。低于该阈值，它使用 brk，并且 free 在这种情况下不会“返回”内存。

请注意，上面的解释并不准确：准确地说，你需要知道物理内存、虚拟内存等之间的区别……这里解释得很好：

[http://blogs.msdn.com/oldnewthing/archive/2004/08/22/218527.aspx](http://blogs.msdn.com/oldnewthing/archive/2004/08/22/218527.aspx)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-25T06:32:28.750

从这篇[内存管理](http://www.onlamp.com/pub/a/onlamp/2005/10/27/memory-management.html)文章

> Malloc 通常不会将释放的内存返回给操作系统；它一直归进程所有，直到它终止。该进程可以在下次请求更多内存时重用它，但其他程序将无法访问它，即使没有其他内存可用。作为推论，程序的内存占用量是在任何时候进行的最大分配的大小。因此，明智的做法是尽快释放不需要的对象，尤其是大型对象，以尽量减少占用空间。

那篇文章确实建议在 Windows 中，至少对于 C 程序，内存不会返回给操作系统。

因此，我不确定您对 Windows 内存释放的概括。

也就是说，您可以通过在 Windows 上实现低级系统调用 sbrk 和 mmap/munmap来尝试[在 Microsoft Windows 下模拟 UNIX 内存管理。](http://www.genesys-e.de/jwalter/mix4win.htm)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-25T08:01:52.127

唯一不能轻易将分配的内存归还给系统的操作系统是 OS X - 引用[Firefox 3 Memory Usage](http://blog.pavlov.net/2008/03/11/firefox-3-memory-usage/)：

> 经过 Apple 员工的广泛测试和确认后，我们意识到分配器无法在保留地址范围的同时归还未使用的内存页面。（您可以取消映射它们并重新映射它们，但这会导致一些竞争条件并且是'不如性能。）有些 API 声称可以做到这一点（madvise() 和 msync()），但它们实际上并没有做任何事情。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-25T06:37:05.493

我不了解 Windows，但在 UNIX 上，`brk()`调用用于将更多内存带入地址空间以供`malloc()`调用使用。

在进程终止之前，我从未见过此内存返回操作系统。您通常可以使用诸如`top`.

我怀疑 Windows 的行为是相同的，但我知道 Windows 有其他分配功能，而不是`malloc()`可以这样做（Win32 API 的一部分）。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-25T08:38:03.643

其他发帖者则对平台特定角度发表了评论。但是由于您专门询问 malloc，让我们看看 C 标准是怎么说的：

“free 函数导致 ptr 指向的空间被释放，也就是说，可用于进一步分配。”

这似乎是一个非常明确的要求，即内存不会返回给操作系统。你偶尔会看到依赖这种行为的程序：

```
int main(void)
{

    void *p = malloc(AS_MUCH_MEMORY_AS_I_WILL_EVER_NEED);

    if (p != 0)
    {
        free(p);
        /* malloc should always work for rest of program */
    }
} 
```

然而，当这个问题出现在 comp.lang.c 上时，一些发帖者指出了这一部分：

“malloc 函数返回空指针或指向分配空间的指针。”

这表明对 malloc 的任何调用都可能失败。该标准的意图似乎是不将内存归还给操作系统，但在语言律师看来，这个问题并不是 100% 确定的。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2015-03-18T07:21:44.037

malloc 函数返回空指针或指向已分配空间的指针。”

这表明对 malloc 的任何调用都可能失败。似乎该标准的意图是不将内存返回给操作系统。

# linux - 如何实现一个diff功能？

> ID：236031
> 
> 赞同：1
> 
> 时间：2008-10-25T06:58:43.970
> 
> 标签：linux, diff

如何实现一个`diff`功能，例如 Stack Overflow 的问题修订历史？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-25T07:04:09.653

您在这里有一个 diff 算法实现的[javascript 示例](http://ejohn.org/projects/javascript-diff-algorithm/)。

基于：

[P. Heckel，一种隔离文件](http://www.scribd.com/doc/1461552/A-technique-for-isolating-differences-between-files) Comm 之间差异的技术。ACM, 21, (4), 264--268 (1978)。

该实现本身有两个功能，推荐使用其中之一：

```
diffString( String oldFile, String newFile ) 
```

此方法采用两个字符串并计算每个字符串的差异。最终结果是用 HTML 标记的“newFile”（表示从 oldFile 中删除和向 newFile 添加）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-25T07:38:40.470

我会找到 FreeBSD diff 实用程序的代码并将其用作基线。当许可证允许这种复制时，重新发明轮子是没有意义的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-25T13:52:19.847

大多数算法都基于 LCS: [Longest common subsequence](http://en.wikipedia.org/wiki/Longest_common_subsequence_problem "最长公共子序列问题 - 维基百科，免费的百科全书")。以有效的方式实现它并不明显。您可能会在网上找到各种语言的各种实现。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-25T07:12:53.940

我想唯一的方法是比较形成 2 个字符串的每个字符。像这样的东西：

```
 void diff(String first,String second) {
   int biggest = (first.length() > second.length()) ? first.length() : second.length();
   for(int i = 0;i < biggest;i++) {
      //compare each char from the longest string with each char from the shorter
      // do something with them if they're not equal
   }
} 
```

这只是我将如何做的草图。一切都取决于您想对数据做什么。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-25T07:49:12.790

如果您想要的是修订历史记录，请不要从 diff 开始重新发明轮子。只需将所有内容都放入版本控制并使用其差异和日志记录工具。对于简单的线性历史，就像[RCS](http://www.gnu.org/software/rcs/)一样简单。或者您可以向它扔最新的大炮并使用[git](http://git.or.cz/)。

大多数差异实用程序都会进行逐行差异。堆栈溢出会进行逐字比较。为此，需要类似[wdiff](http://www.gnu.org/software/wdiff/)的东西。大多数版本控制系统都允许您插入 diff 实用程序。开箱即用，`git diff --color-words`与这里所做的非常接近。稍微摆弄一下设置，你可能会让它吐出一些东西，然后你可以把它做成一个漂亮的网页。

# c++ - C++ 中的非托管 DLL

> ID：236035
> 
> 赞同：8
> 
> 时间：2008-10-25T07:04:22.273
> 
> 标签：c++, dll, unmanaged

我一直在阅读许多关于 C++ 中非托管 DLL 的教程/文章。然而，就我的一生而言，我似乎无法理解这个概念。我很容易被关于它是否需要头文件、如何导出它、我是否需要 .lib 文件以及你有什么的看似分歧而感到困惑。

所以，让我们假设我只有一个这样的函数：

```
public int calculateSquare(int num)
{
    return num*num;
} 
```

忽略实际代码，我需要什么才能将这个简单的函数本身变成一个我可以调用的 DLL？我只是将 __dllexport 或其他任何内容添加到第一行还是需要标题？我对这一切感到困惑。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-10-25T07:27:17.857

我不能强调这一点，C++ 编译器看不到头文件，在预处理器完成后，只有一个大源文件（也称为编译单元）。所以严格来说，您不需要标头来从 dll 导出此函数。您需要的是某种形式的条件编译来导出正在编译的 dll 中的函数并将其导入客户端代码中。

通常这是通过宏和头文件的组合来完成的。您创建了一个名为 MYIMPORTEXPORT 的宏，并通过使用宏条件语句使其像 dll 中的 __declspec ( dllexport ) 和客户端代码中的 __declspec ( dllimport ) 一样工作。

在文件 MYIMPORTEXPORT.h

```
#ifdef SOME_CONDITION
#define MYIMPORTEXPORT __declspec( dllexport )
#else
#define MYIMPORTEXPORT __declspec( dllimport )
#endif 
```

在文件 MyHeader.h

```
#include <MyImportExport.h>

MYIMPORTEXPORT public int calculateSquare(int num)
{
    return num*num;
} 
```

在 dll .cpp 文件中

```
#define SOME_CONDITION

#include <MyHeader.h> 
```

在客户端代码 .cpp 文件中

```
#include <MyHeader.h> 
```

当然，您还需要向链接器发出信号，表明您正在使用[/DLL 选项](http://msdn.microsoft.com/en-us/library/y0zzbyt4(VS.80).aspx)构建 dll 。

构建过程还将生成一个 .lib 文件，这是一个静态库 - 在这种情况下称为存根 - 客户端代码需要链接到它，就好像它正在链接到一个真正的静态库一样。运行客户端代码时会自动加载 dll。当然 dll 需要操作系统通过其查找机制找到，这意味着您不能将 dll 放在任何地方，而是放在特定位置。[这里](http://msdn.microsoft.com/en-us/library/ms682586.aspx)有更多内容。

[dumpbin](http://support.microsoft.com/kb/177429)是一个非常方便的工具，可以查看您是否从 dll 中导出了正确的函数，以及客户端代码是否正确导入。分别使用 /EXPORTS 和 /IMPORTS 运行它。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-25T08:55:56.383

QBziZ 的回答是正确的。请参阅[C++ 中的非托管 DLL](https://stackoverflow.com/questions/236035/unmanaged-dlls-in-c#236052)

完成它：*在 C++ 中，如果你需要使用一个符号，你必须告诉编译器它存在，并且通常，它的原型*。

在其他语言中，编译器只会自行探索库，并找到符号，*等等*。

在 C++ 中，您必须告诉编译器。

## 将 C/C++ 标头视为书籍目录

最好的方法是将所需的代码放在某个公共位置。“界面”，如果你愿意的话。这通常在头文件中完成，称为头文件，因为这通常不是独立的源文件。标头只是一个文件，其目的是包含（即由预处理器复制/粘贴）到真正的源文件中。

实际上，您似乎必须声明两次符号（函数、类等）。与其他语言相比，这几乎是异端。

您应该将其视为一本书，带有摘要表或索引。在表中，您拥有所有章节。在文本中，您有章节及其内容。

有时，您很高兴拥有章节列表。

在 C++ 中，这是标题。

## DLL 呢？

所以，回到 DLL 问题：DLL 的目的是导出代码将使用的符号。

因此，以 C++ 方式，您必须在编译时导出代码（例如，在 Windows 中，使用 __declspec）并“发布”导出内容的表（即具有包含导出声明的“公共”标题） .

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-25T09:42:19.600

导出函数的清单：

*   调用约定是否适合调用者？（这决定了如何传递参数和结果，以及谁负责清理堆栈）。您应该明确说明您的调用约定。
*   将以哪个名称导出符号？C++ 通常需要修饰（“mangle”）符号的名称，例如区分不同的重载。
*   告诉链接器使函数作为 DLL 导出可见

在 MSVC 上：

*   `__stdcall`（这是帕斯卡调用约定）是导出符号的典型调用约定 - 我猜大多数客户端都支持。
*   extern "C" 允许您在不修改名称的情况下导出符号 C 样式
*   用于`__declspec(dllexport)`标记要导出的符号，或链接一个单独的 .def 文件，其中列出了要导出的符号。使用 .def 文件，您还可以仅按序号（而不是名称）导出，并更改导出符号的名称。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-25T07:29:40.223

您需要使用`__declspec( dllexport )`或将函数添加到模块定义文件 (.def) 来导出函数。然后将项目编译为 DLL。

在客户端，您有两种选择。使用编译 DLL 时生成的导入库 (.lib)。只需使用此库与您的客户端项目链接，您就可以访问从 DLL 导出的函数。你需要一个头文件，因为编译器需要知道你的函数的签名——它返回 int 并接受一个 int。回顾一下，您需要链接一个导入库 (.lib) 和一个包含函数头的头文件。

另一种方法是使用`WinAPI`call动态加载 DLL `LoadLibrary`，然后`GetProcAddress`获取指向函数的指针。指向函数的指针必须具有正确的类型，以便编译器可以为其提供正确的参数并使用正确的调用约定。

# java - Tomcat5.5中的上下文信息

> ID：236038
> 
> 赞同：1
> 
> 时间：2008-10-25T07:08:17.490
> 
> 标签：java, tomcat, hosting, shared-hosting

我正面临这个特殊的问题。我的 webapp 在我的本地主机上运行良好。它是一个 JSP/Struts-Tomcat-MySQL 应用程序。但是，当我在 hostjava.net（共享 tomcat）上托管它时，它无法连接到数据库。

经过一些调试，我已经确定了问题，即使用 JNDI 查找数据源。如果需要，可以查看[http://rohitesh.hostjava.net/MapsDummyLog.htm上的日志](http://rohitesh.hostjava.net/MapsDummyLog.htm)

有关上下文信息位置的一些详细信息：/META-INF/context.xml 包含：

```
<Context path="" docBase="" debug="5" reloadable="true" crossContext="true" override="true">
   <Resource name="jdbc/ConnectionPooling" auth="Container" type="javax.sql.DataSource"
    maxActive="10" maxIdle="5" username="[username]" password="[password]" driverClassName="com.mysql.jdbc.Driver"
    url="jdbc:mysql://localhost/[db name]?autoReconnect=true" />
</Context> 
```

谁能帮我找出问题所在，拜托？

干杯，Rohitesh。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-25T14:31:27.383

这不应该：

```
url="jdbc:mysql://localhost/[db name]?autoReconnect=true" 
```

真的指向托管数据库的服务器的名称吗？在远程主机上，数据库服务器可能与 tomcat 实例不是同一台机器。我认为你必须说

url="jdbc:mysql://[Server_Name]/[db name]?autoReconnect=true"

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-26T02:53:41.567

这是我的猜测：

你说这是共享主机。那么不应该

```
<Context path="" 
```

包含您的特定应用程序的上下文路径？

[http://tomcat.apache.org/tomcat-5.5-doc/config/context.html](http://tomcat.apache.org/tomcat-5.5-doc/config/context.html) *此 Web 应用程序的上下文路径，与每个请求 URI 的开头相匹配，以选择适当的 Web 应用程序进行处理。特定主机中的所有上下文路径都必须是唯一的。如果您指定空字符串 ("") 的上下文路径，则您正在为此主机定义默认 Web 应用程序，它将处理所有未分配给其他上下文的请求。*

所以你的上下文是无效的，我认为，只是不可见的（这就是为什么 null 驱动程序和 null url）。

它可以在您的本地工作，因为“”是所有已部署应用程序的共享上下文，包括您的应用程序。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-26T12:51:49.160

这个限制怎么样：

[http://wiki.hostjava.net/index.php/HostJava.net_FAQ](http://wiki.hostjava.net/index.php/HostJava.net_FAQ) *共享 Tomcat 对 server.xml 文件的访问受到限制。只有支持人员才能将 Realm（例如 JDBC Realm）添加到 server.xml 文件中。*

看起来您需要寻求支持以添加您的数据源。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-26T18:44:26.687

罗希特什，

根据 Vladimir 的回答和评论，您可能需要考虑请求更新服务器上下文（server.xml，或更全局范围的 context.xml）。

如果不出意外，在我看来，这是一个最佳实践。虽然 Tomcat 允许您从 Web 应用程序本身定义上下文（包括 JNDI 资源），但您应该使用此功能的唯一地方是开发人员的本地测试服务器。它使您的 Web 应用程序更具可移植性，因为它允许独立于您的应用程序更改外部资源（在本例中为数据库，但它可以是邮件服务器或内容服务器、规则引擎等）的配置。

我希望这有帮助。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-25T15:05:52.980

奇怪的是，同一应用程序的另一部分使用硬编码的 url 访问数据库（使用 DriverManager，而**不是**来自 JNDI 查找的数据源），并且工作正常（查看日志中的前两行，以及从数据库中读取的带有美食名称的下几行）。因此，可以肯定的是，数据库也在同一台服务器上。

干杯，R

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-25T21:38:44.293

*   驱动程序可用吗？试试 Class.forName("com.mysql.jdbc.Driver"); - 它不能位于您的 webapps WEB-INF/lib 中，因为您要求容器（tomcat）为您实例化它：它需要位于服务器类路径中
*   您运行的是 Tomcat 5.5.x 还是 6.0.x？在 5.0.x 上，context.xml 语法，尤其是资源定义，已经不同：更多的 xml 标记，而不是自 5.5 以来更好更简单的属性。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-25T07:25:08.847

“在 org.apache.struts.action.RequestProcessor.processActionPerform(RequestProcessor) 的 com.Actions.UserAction.execute(UserAction.java:66) 的 com.DAO.UserDAO.userLogin(UserDAO.java:109) 的 java.lang.NullPointerException .java:431) 在 org.apache.struts.action.RequestProcessor.process(RequestProcessor.java:236) 在 org.apache.struts.action.ActionServlet.process(ActionServlet.java:1196) "

这告诉我某些东西没有被正确初始化。您在 UserDAO.java 的第 109 行调用什么对象？

“10/25/08（2:08 AM）ajp-127.0.0.1-8015-1 错误 UserDAO.java:104 无法为连接 URL 'null' 创建类 '' 的 JDBC 驱动程序 2008
年 10 月 25 日（2:08 AM) ajp-127.0.0.1-8015-1 错误 UserDAO.java:105 org.apache.tomcat.dbcp.dbcp.SQLNestedException: 无法为连接 URL 'null' 创建类 '' 的 JDBC 驱动程序"

您是否检查了数据库的 URL。看来该 URL 无效或为 NULL。你能给 JDBC 连接 URL 手动赋值吗？

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-26T18:48:16.663

另一个注意事项：除了您发布的日志文件之外，您是否可以访问任何其他日志文件？如果您有权访问服务器日志/catalina.out 文件，它可能会向您显示 Tomcat 在设置数据源时遇到的确切问题（这在您启动 Tomcat 时是正确的）。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-27T19:11:18.580

对不起大家。这是我和托管设施的支持团队之间沟通不畅的问题。配置冲突。他们在 server.xml 中设置了一些旧设置。由于这优先于任何其他上下文信息，因此我面临着这些问题。现在它得到了照顾。

但我仍然觉得，允许人们在共享配置中，将他们的上下文信息放在 META-INF/context.xml 文件中，是一个更好的选择。这样，他们对它有更多的控制权。

但我感谢所有抽出时间做出回应的人。我从你身上学到了很多。再次感谢你。

干杯，R

# delphi - delphi 的代码文档，类似于 javadoc 或 c# xml doc

> ID：236047
> 
> 赞同：16
> 
> 时间：2008-10-25T07:24:19.143
> 
> 标签：delphi, javadoc, sandcastle

对于 delphi 代码，我需要一个类似于 javadoc 或 c# xml doc 的代码文档工具。什么是最好的工具？我更喜欢一种技术，它在未来与微软沙堡项目兼容。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2011-02-09T08:12:37.140

看看[SynProject](http://synopse.info/fossil/wiki?name=SynProject)，一个用 Delphi 编写的开源工具。

它旨在处理完整的文档工作流程，从规范到发布说明，包括测试、架构和设计；当然还有一个集成的 Delphi 解析器可以从现有的 Delphi 源代码生成架构文档。

对于架构文档，源代码可以提取注释（ala PasDoc），然后将此文本嵌入到主架构文档中（带有类层次结构图和单元依赖关系）。

您在专用文本编辑器中使用类似于 wiki 的语法编写纯文本文件，然后 SynProject 会从中创建格式良好的 Word 文档。一些向导可用于访问内容。但由于它存储为普通文件，因此多个程序员可以使用任何 SCM 工具（SVN、Fossil ...）在其上进行编写。

例如，我目前使用它来为一个庞大而古老的 Delphi 应用程序（大约 2,000,000 行用 Delphi 5 和 6 编写的代码）编写维护文档，之前没有可用的文档。您描述对代码所做的更改（通过引用单元/类/方法），然后该工具将更新所有文档以反映和跟踪这些修改。SynProject 的设计符合一些非常“精细”的法规（IEC 62304），但由于其独特的“扁平”设计，可用于任何项目。

*注意*：我在这个问题之后很长时间才发布这个问题，因为 SynProject 此时不存在，值得一看。该线程[已被定义为该问题的参考](https://stackoverflow.com/questions/4937229)。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-25T08:14:07.577

据我所知，没有任何工具可以轻松与 Microsoft Sandcastle 兼容 - 至少在有人真正费心编写一个、修改现有的或创建一个工具链来正确转换输出之前。

我个人使用[PasDoc](http://pasdoc.sipsolutions.net)取得了巨大成功。我建议构建最新的 SVN 版本，因为当前版本偶尔会出现复杂的接口定义。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-25T07:49:15.893

Delphi + JavaDoc = [DelphiCodeToDoc](http://dephicodetodoc.sourceforge.net/)

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-10-25T16:44:23.357

尝试： - [Doxygen](http://www.doxygen.nl/index.html)文档 - [Pas2Dox](http://sourceforge.net/projects/pas2dox/)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-28T12:32:22.630

自 Delphi 2005 以来，它在 Delphi 编译器中构建。它使用使用 XML 样式注释的 XMLDoc 标准。就像 C# 一样，所以我猜 Sandcastle 可以处理它。请参阅[http://dn.codegear.com/article/32770](http://dn.codegear.com/article/32770)和[http://tondrej.blogspot.com/2006/03/xml-documentation-in-delphi-2006.html](http://tondrej.blogspot.com/2006/03/xml-documentation-in-delphi-2006.html)

另见[记录 Delphi](https://stackoverflow.com/questions/33336/documenting-delphi)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-27T14:34:27.720

Sandcastle 需要访问程序集才能生成它的文档，这意味着它仅适用于 .net 语言（尽管我不确定 Delphi.Net 是否可行）。但是，Delphi 2007 和 2009 具有与 C# 非常相似的内联 XML 文档。当您在项目选项中打开“生成 XML 文档”选项时，它将根据这些注释构建 XML 文档。然后可以使用 XSLT 生成您需要的任何文档格式（这是困难的一点）。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-12-17T22:55:51.790

[DelphiCodeToDoc](http://dephicodetodoc.sourceforge.net/)也有一个命令行来使用它和持续集成工具（例如）。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2016-01-18T11:59:09.373

这个问题很老了，但我今天遇到了同样的问题，发现了这篇文章。Delphi 2007 允许以下语法，这似乎等同于 C# 文档：

```
/// <summary>
/// Summary of the function / class
/// </summary>
/// <param name="param1">Description of the parameter param1</param>
/// <param name="param2">Description of the parameter param2</param>
/// <param name="param3">Description of the parameter param3</param>
/// <returns>Description of the return value</returns>
function test(param1, param2, param3: string): string; 
```

对于`<summary>`，似乎不可能允许换行符。`<br />`不起作用。

# php - PHP 脚本版本检查/通知

> ID：236070
> 
> 赞同：7
> 
> 时间：2008-10-25T07:55:21.360
> 
> 标签：php

如何根据在线文件检查我的脚本版本以查看它是否是最新版本？

*为澄清起见，我说的是我编写的脚本，而不是 PHP 的版本。我想为最终用户提供一种方式来告诉我何时更新了脚本。*

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-10-25T08:40:21.267

要指定第二个（更简单的）解决方案[phjr](https://stackoverflow.com/questions/236070/php-version-checking#236098)建议：

在您自己的公共服务器上有一个文件`version.txt`，并将以下功能包含到您部署的项目/脚本中：

```
define('REMOTE_VERSION', 'http://your.public.server/version.txt');

// this is the version of the deployed script
define('VERSION', '1.0.1');

function isUpToDate()
{
    $remoteVersion=trim(file_get_contents(REMOTE_VERSION));
    return version_compare(VERSION, $remoteVersion, 'ge');
} 
```

`version.txt`应该只包含最新的版本号，例如：

```
1.0.2 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-25T08:28:03.010

根据[对此答案的评论](https://stackoverflow.com/questions/236070/php-version-checking#236084)

```
// Substitue path to script with the version information in place of __FILE__ if necessary
$script = file_get_contents(__FILE__);
$version = SOME_SENSIBLE_DEFAULT_IN_CASE_OF_FAILURE;
if(preg_match('/<!-- Script version (\d*(\.\d+)*) -->/', $script, $version_match)) {
    $version = $version_match[1];
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-01-26T17:06:47.117

```
define('REMOTE_VERSION', 'http://your.public.server/version.txt');
define('VERSION', '1.0.1');
$script = file_get_contents(REMOTE_VERSION);
$version = VERSION;
if($version == $script) {
    echo "<div class=success> 
<p>You have the latest version!</p> 
</div>";
} else {
    echo "<div class=error> 
<p>There is a update available!</p> 
</div>";
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-25T08:27:09.750

拥有带有更新信息的 RSS 或 Atom**提要。**Wordpress 做了类似的事情。然后您可以在本地保存已向用户显示更新的信息等。

对于更简单的解决方案，请在项目网站上有一个仅包含版本号的文件。然后将它与存储在程序中的版本号进行比较，可能在一个常量内。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2021-10-03T14:24:08.953

改变

```
if($version == $script) 
```

到

```
if($version >= $script)` 
```

> ID：236073
> 
> 赞同：
> 
> 时间：
> 
> 标签：

None

# c++ - 解析 C++ 以生成单元测试存根

> ID：236086
> 
> 赞同：11
> 
> 时间：2008-10-25T08:14:04.613
> 
> 标签：c++, unit-testing, parsing, stub

我最近一直在尝试为一些遗留代码创建单元测试。

我一直在采用使用链接器的方法来向我展示哪些函数会导致链接错误，查找源代码以查找定义并从中创建存根。

有没有更简单的方法？是否有某种 C++ 解析器可以以某种易于使用的形式为我提供类定义，我可以从中生成存根？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-25T09:15:54.393

您可能需要调查[http://os.inf.tu-dresden.de/vfiasco/related.html#parsing](http://os.inf.tu-dresden.de/vfiasco/related.html#parsing)。但是 C++ 解析很难。

另一方面，也许 ctags 或类似的东西可以提取类定义......

您也可以尝试编写自己的简单（？）解析器来从头文件生成类存根......

我试图给你一些指示。如您所见，问题并不容易。但希望您至少可以自动化其中的一部分。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-25T09:31:15.597

[Gcc XML](http://www.gccxml.org/HTML/Index.html)用于一些项目，例如[Common Lisp 的自动 FFI。](http://www.cliki.net/Verrazano) 它与 G++ 编译器相关联以生成表示源的 XML。从那里开始，任何 XML 处理工具都可以帮助您实现目标。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2012-09-22T19:20:54.433

abi [-compliance-checker](https://github.com/lvc/abi-compliance-checker)工具可用作 C/C++ 头文件的解析器：

```
abi-compliance-checker -lib NAME -dump VER.xml -headers-only -xml -stdout > api.xml 
```

`VER.xml`输入文件如下：

```
<version>
  1.0
</version>

<headers>
  /path1/to/header(s)/
  /path2/to/header(s)/
   ...
</headers> 
```

输出`api.xml`文件包含结构化形式的头文件中的函数签名和其他信息：

```
...
<symbol>
    <id>37348</id>
    <mangled>_ZN7MWidget11qt_metacallEN11QMetaObject4CallEiPPv</mangled>
    <short>qt_metacall</short>
    <class>13749</class>
    <header>mwidget.h</header>
    <line>45</line>
    <return>44</return>
    <spec>virtual</spec>
    <parameters>
        <param>
            <name>p1</name>
            <type>4078</type>
            <algn>4</algn>
            <pos>0</pos>
        </param>
        <param>
            <name>p2</name>
            <type>44</type>
            <algn>4</algn>
            <pos>1</pos>
        </param>
        <param>
            <name>p3</name>
            <type>3905</type>
            <algn>8</algn>
            <pos>2</pos>
        </param>
    </parameters>
</symbol>
... 
```

另请参阅有关[api-sanity-checker](https://github.com/lvc/api-sanity-checker)工具的信息，该工具可以通过分析头文件中的声明为 API 中的每个函数生成基本的单元测试用例。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-25T11:45:46.517

[http://clang.llvm.org/](http://clang.llvm.org/)看起来很有希望，但不完整。

[http://www.boost.org/doc/libs/1_36_0/libs/python/pyste/index.html](http://www.boost.org/doc/libs/1_36_0/libs/python/pyste/index.html)使用 GCCXML 为 C++ 代码生成包装器以连接 python。这证明 GCCXML 已被用于类似的概念。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-25T16:45:56.893

如果您在使用 DWARF 调试格式（主要是 UNIX）的平台上，则可以使用 libdwarf 解析调试信息并提取有关所有内容（函数原型、类定义等）的信息。比 C++ 更结构化且更易于解析。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-25T12:09:25.087

doxygen 通常可以解析足够多的 C++ 来为代码创建文档。它还有一个 XML 输出选项。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-08T12:28:59.553

你看过[Mockcpp](http://code.google.com/p/mockcpp/)、 [AMOP](http://code.google.com/p/amop/)和[mockpp](http://mockpp.sourceforge.net/)吗？您可以看到它们如何解析 C++ - 如果它们都不符合您的需求。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-12-13T01:54:52.487

Eclipse CDT 项目提供了一个高级 C++ 解析器。界面非常简单。以下代码片段可以提供足够的提示。

ITranslationUnit tu = CoreModelUtil.findTranslationUnit(file);
ICElement[] 元素 = tu.getChildren();

IStructure结构=（IStructure）元素；
IMethodDeclaration[] 方法 = 结构.getMethods();
IField[] 字段 = 结构.getFields();

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-25T11:25:39.750

如果您使用的是 Windows 平台，您可能想看看[Microsoft Phoenix 项目](http://research.microsoft.com/Phoenix/)。这是一个新的编译器框架，可让您进入编译过程的任何阶段。

# project-management - 您知道哪些在线协作网站？

> ID：236091
> 
> 赞同：2
> 
> 时间：2008-10-25T08:17:38.007
> 
> 标签：project-management, collaboration

基本上我需要一个托管解决方案，其中可以为项目创建一个帐户，并且分布式团队成员可以在项目实施期间通过该站点进行交互。我知道很多这样的软件，但不是托管的。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-25T08:27:48.500

我认为[Basecamp](http://basecamphq.com)是最受欢迎的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-25T10:07:44.290

我现在正在尝试[CodeSpaces](http://www.codespaces.com/)。看起来很有希望。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-25T08:42:51.823

我使用Microsoft 的**codeplex.com**并发现它非常好，它现在接受 svn 连接以及 Team System。

一个很好的选择是**code.google.com**，我没有发现想要的。

我建议这两个都非常受欢迎并且质量最高，许多人会对哪个更适合您的需求提出意见。如果不了解您的更多特定需求和偏好，我无法给出更狭窄的答案。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-25T09:53:59.810

我认为[VersionOne](http://www.versionone.com/)提供其工具的托管版本和基于 Web 的现场版本。团队版也是限时免费的。 [Rally Software](http://www.rallydev.com/)提供与其软件基本相同的交易（托管和现场）版本。同样，社区版是免费的。

# ms-office - 为 Microsoft Office 套件开发集成产品时的注意事项

> ID：236096
> 
> 赞同：0
> 
> 时间：2008-10-25T08:23:39.337
> 
> 标签：ms-office, integration

我有一个产品创意，需要集成到 Microsoft Office 套件中。

是否有任何许可/限制问题需要我注意才能继续？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-25T09:18:50.660

依靠...

如果您的产品使用他们发布的 API，并且您没有“在您的盒子中”运送他们的任何组件，那么您（可能）只是他们平台之上的增值供应商。您会告诉您的客户准备好适当的 MS 产品，然后在顶部安装您的应用程序。这种方法很好，您需要告诉 MS 的唯一原因是，如果您是首选/认证供应商/合作伙伴，您将获得更多业务。（根据您正在集成的产品，您应该检查 MS 以确保没有关于使用它们的特定许可条款）。

如果你把他们的任何代码放在你的盒子里，那么你必须确保你在他们的许可条款范围内操作，他们几乎肯定会让你跳过一些障碍来获得他们的批准。您还面临分享收入的问题，这不太可能对您有利。

根据我的经验，MS 不喜欢对任何人这样做——无论其规模大小——当然也不喜欢与非常小的玩家一起这样做。

您最好在开始之前直接与他们联系，并了解是否有可以加入的孵化项目来表达您的想法。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-25T09:25:58.850

我意识到我也有一个技术性的答案给你。大约 10 年前，我为 Excel 编写了一个插件，它利用他们的电子表格来显示来自我的提供商的数据。它非常成功，作为一种可行的创收产品存在了大约 8 年。这是我当时工作的 BI 公司的一个关键差异化因素。

我们代码库中的主要问题是 Excel 版本之间的 API 差异，以及不同的 DLL 依赖项。MS 喜欢说他们不会在发布之间破坏他们的 API，但实际上并非如此。他们可能在这方面做得更好，但对于我们来说，获得他们新软件的预发布版本以了解我们必须做些什么才能让我们的软件继续使用它始终是一个真正的问题。然后我们必须支持几个不同的 Ecel 版本并在它们之间升级我们的内容。总而言之，它给我们的生活增添了巨大的复杂性。

他们的 API 在风格上发生了显着变化，Office 比以前更加开放，但您要求考虑因素，这肯定是其中之一。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-25T09:38:33.367

There arent any special limitations as long as you follow the published APIs. Hacking around them breaks Microsoft supoort license and no bussiness out there will want to buy your solution in that case.

Furthermore you should know that the Office APIs are a world of pain. Its a lot better with Office 2007 (and there's lots of cool stuff coming with Office 14) but anything older than that is just asking for trouble... then again, depends on what exactly you're trying to do..

In any case, you should check out some reference project like Duet (www.duet.com) jointly developed by SAP and Microsoft. I got some info on that on my blog: [http://www.developerzen.com/category/sap/sapduetmendocino/](http://www.developerzen.com/category/sap/sapduetmendocino/)

There's also [https://www.obacentral.com/default.aspx](https://www.obacentral.com/default.aspx)

# emacs - 在 GNU Emacs 中查找字符的 Unicode 代码点

> ID：236097
> 
> 赞同：26
> 
> 时间：2008-10-25T08:25:22.967
> 
> 标签：emacs, unicode

在 XEmacs 中，这是通过在字符上调用函数 char-to-ucs 来完成的。GNU Emacs 似乎没有这个功能。在 GNU Emacs 中，字符似乎是普通的整数。在拉丁字符上运行 Cx = 表明 Emacs 代码点与对应字符的 Unicode 代码点不同。如何在 GNU Emacs 中找到字符的 Unicode 代码点？

* * *

## 回答 #1

> 赞同：50
> 
> 时间：2008-10-25T09:35:54.777

在现代 Emacs 中，Mx describe-char 会告诉你当前的字符。
一个例子：

```
 character: ¢ (2210, #o4242, #x8a2, U+00A2)
    charset: latin-iso8859-1
         (Right-Hand Part of Latin Alphabet 1 (ISO/IEC 8859-1): ISO-IR-100.)
 code point: #x22
     syntax: w  which means: word
   category: l:Latin
buffer code: #x81 #xA2
  file code: #xC2 #xA2 (encoded by coding system utf-8)
    display: by this font (glyph code)
     -apple-monaco-medium-r-normal--12-120-72-72-m-120-mac-roman (#xA2) 
```

注意第一部分中的 U+00A2，它给出了字符的 Unicode 代码点。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-25T09:55:22.693

感谢您的快速回答。我查看了 describe-char 的源代码，发现以下代码片段解决了我的问题。我在 XEmacs 21.4.13 Mule 和 GNU Emacs 22.1.1 中都对其进行了测试，它似乎可以工作。

```
(or (get-char-property (point) 'untranslated-utf-8)
    (encode-char (char-after) 'ucs)) 
```

# c# - Receiving MessageQueue msgs without reading them from the receiving Queue?

> ID：236123
> 
> 赞同：1
> 
> 时间：2008-10-25T08:54:55.013
> 
> 标签：c#, sockets, message-queue, pgm-protocol

I am using the **System.Messaging.MessageQueue** to send and receive multicast **System.Messaging.Messag**e’s on my LAN – this works fine.

However, I have a requirement to receive the msgs without using a message queue.

As the **MessageQueue** uses the PGM protocol (113) to send messages I am trying to build a type that listens on PGM (protocol 113) using a socket (e.g. new **Socket(AddressFamily.InterNetwork, SocketType.Rdm, (ProtocolType)113);**). The type is receiving message data but it is in a text format (with a soap formatter section -see example this example on msdn [http://msdn.microsoft.com/en-us/library/cc219170.aspx](http://msdn.microsoft.com/en-us/library/cc219170.aspx))

I obviously want binary data so i can cast it into a **System.Messaging.Message** and get at the real data.

Any ideas on how i can do this are greatly appreciated .

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-09T23:16:37.780

如果您纯粹是在寻找在 MS Windows 上使用 PGM，那么[Emcaster](http://code.google.com/p/emcaster/)是非常好的信息源，其中包含如何使用它的示例。

但是，如果您正在寻找具有更广泛功能的更成熟的解决方案，那么[nServiceBus](http://www.nservicebus.com/Default.aspx)框架应该是您的选择。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-08-18T02:01:55.693

你可以偷看他们吗？MSMQ 支持该功能。或者您只是想阅读您通常不收听的队列上的消息？

# c++ - 如何在 Windows 的 wchar_t 和 GCC/Linux 之间进行转换（不一定以编程方式）？

> ID：236125
> 
> 赞同：4
> 
> 时间：2008-10-25T08:55:22.157
> 
> 标签：c++, linux, utf, wchar-t

假设我有这个 Windows wchar_t 字符串：

```
L"\x4f60\x597d" 
```

和

```
L"\x00e4\x00a0\x597d" 
```

并希望将其（不一定以编程方式；这将是一次性的）转换为 GCC/Linux wchar_t 格式，即 UTF-32 AFAIK。我该怎么做？（一般的解释会很好，但基于这个具体案例的例子也会有帮助）

*请不要将我引导到字符转换站点。我想从 L"\x(something)" 形式转换，而不是 "end character" 形式。*

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-25T15:28:19.320

从 UTF-16（Visual C++`wchar_t`形式）转换为 UTF-8，然后可能从 UTF-8 转换为 UCS-4（GCC`wchar_t`形式），是一个可以接受的答案吗？

如果是这样，那么在 Windows 中，您可以将`WideCharToMultiByte`函数（with`CP_UTF8`用于`CodePage`参数）用于转换的第一部分。然后，您可以将生成的 UTF-8 字符串直接粘贴到您的程序中，或者进一步转换它们。[这](http://osdir.com/ml/org.user-groups.slug.coders/2006-12/msg00006.html)是一条消息，显示了一个人是如何做到的；您也可以编写自己的代码或手动执行（官方规范，其中包含关于如何将 UTF-8 转换为 UCS-4 的部分，可以在[这里](http://www.cl.cam.ac.uk/~mgk25/ucs/ISO-10646-UTF-8.html)找到）。可能有更简单的方法，我对 Linux 中的转换内容还不太熟悉。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-26T06:43:04.800

您只需要担心[\xD800 和 \xDFFF inclusive 之间](http://en.wikipedia.org/wiki/UTF-16#Encoding_of_characters_outside_the_BMP)的字符。填充零时，其他所有字符都应从 UTF-16 映射到 UCS-4 完全相同。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-08T23:10:18.697

最常用的字符转换库之一是 ICU 库[http://icu-project.org/](http://icu-project.org/)它被一些 boost [http://www.boost.org/](http://www.boost.org/)库使用。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-07-24T08:53:04.030

伊格纳西奥是对的，如果你不使用一些稀有的汉字（或者一些绝迹的文字），那么映射是一对一的。（官方的“行话”是“如果你没有 BMP 之外的字符”）

这是算法，以防万一： [http](http://unicode.org/faq/utf_bom.html#utf16-3) ://unicode.org/faq/utf_bom.html#utf16-3 但同样，很可能对您的实际情况无用。

您还可以使用来自 Unicode 的免费资源 ( [ftp://ftp.unicode.org/Public/PROGRAMS/CVTUTF](ftp://ftp.unicode.org/Public/PROGRAMS/CVTUTF) )

# c++ - 如何迭代字符串的单词？

> ID：236129
> 
> 赞同：3238
> 
> 时间：2008-10-25T08:58:21.013
> 
> 标签：c++, string, split

我正在尝试遍历字符串的单词。

可以假定该字符串由由空格分隔的单词组成。

请注意，我对 C 字符串函数或那种字符操作/访问不感兴趣。另外，请在您的回答中优先考虑优雅而不是效率。

我现在最好的解决方案是：

```
#include <iostream>
#include <sstream>
#include <string>

using namespace std;

int main()
{
    string s = "Somewhere down the road";
    istringstream iss(s);

    do
    {
        string subs;
        iss >> subs;
        cout << "Substring: " << subs << endl;
    } while (iss);
} 
```

有没有更优雅的方法来做到这一点？

* * *

## 回答 #1

> 赞同：2510
> 
> 时间：2008-10-25T18:21:27.483

我用它通过分隔符分割字符串。第一个将结果放入预先构建的向量中，第二个返回一个新向量。

```
#include <string>
#include <sstream>
#include <vector>
#include <iterator>

template <typename Out>
void split(const std::string &s, char delim, Out result) {
    std::istringstream iss(s);
    std::string item;
    while (std::getline(iss, item, delim)) {
        *result++ = item;
    }
}

std::vector<std::string> split(const std::string &s, char delim) {
    std::vector<std::string> elems;
    split(s, delim, std::back_inserter(elems));
    return elems;
} 
```

* * *

请注意，此解决方案不会跳过空标记，因此以下将找到 4 项，其中一项为空：

```
std::vector<std::string> x = split("one:two::three", ':'); 
```

* * *

## 回答 #2

> 赞同：1478
> 
> 时间：2008-10-26T00:43:09.317

值得一提的是，这是从输入字符串中提取标记的另一种方法，仅依赖于标准库设施。这是 STL 设计背后的力量和优雅的一个例子。

```
#include <iostream>
#include <string>
#include <sstream>
#include <algorithm>
#include <iterator>

int main() {
    using namespace std;
    string sentence = "And I feel fine...";
    istringstream iss(sentence);
    copy(istream_iterator<string>(iss),
         istream_iterator<string>(),
         ostream_iterator<string>(cout, "\n"));
} 
```

[`copy`](https://en.cppreference.com/w/cpp/algorithm/copy)可以使用相同的通用算​​法将提取的标记插入到容器中，而不是将提取的标记复制到输出流中。

```
vector<string> tokens;
copy(istream_iterator<string>(iss),
     istream_iterator<string>(),
     back_inserter(tokens)); 
```

...或`vector`直接创建：

```
vector<string> tokens{istream_iterator<string>{iss},
                      istream_iterator<string>{}}; 
```

* * *

## 回答 #3

> 赞同：862
> 
> 时间：2008-10-25T20:28:20.720

使用 Boost 的可能解决方案可能是：

```
#include <boost/algorithm/string.hpp>
std::vector<std::string> strs;
boost::split(strs, "string to split", boost::is_any_of("\t ")); 
```

这种方法可能比这种`stringstream`方法更快。由于这是一个通用模板函数，它可用于使用各种分隔符拆分其他类型的字符串（wchar 等或 UTF-8）。

有关详细信息，请参阅[文档](http://www.boost.org/doc/libs/1_36_0/doc/html/string_algo/usage.html)。

* * *

## 回答 #4

> 赞同：401
> 
> 时间：2011-03-06T05:52:15.883

```
#include <vector>
#include <string>
#include <sstream>

int main()
{
    std::string str("Split me by whitespaces");
    std::string buf;                 // Have a buffer string
    std::stringstream ss(str);       // Insert the string into a stream

    std::vector<std::string> tokens; // Create vector to hold our words

    while (ss >> buf)
        tokens.push_back(buf);

    return 0;
} 
```

* * *

## 回答 #5

> 赞同：196
> 
> 时间：2009-09-29T15:12:11.753

对于那些不适合牺牲代码大小的所有效率并将“高效”视为一种优雅的人来说，下面的内容应该是一个最佳点（我认为模板容器类是一个非常优雅的补充。）：

```
template < class ContainerT >
void tokenize(const std::string& str, ContainerT& tokens,
              const std::string& delimiters = " ", bool trimEmpty = false)
{
   std::string::size_type pos, lastPos = 0, length = str.length();

   using value_type = typename ContainerT::value_type;
   using size_type  = typename ContainerT::size_type;

   while(lastPos < length + 1)
   {
      pos = str.find_first_of(delimiters, lastPos);
      if(pos == std::string::npos)
      {
         pos = length;
      }

      if(pos != lastPos || !trimEmpty)
         tokens.push_back(value_type(str.data()+lastPos,
               (size_type)pos-lastPos ));

      lastPos = pos + 1;
   }
} 
```

我通常选择使用类型作为我的第二个`std::vector<std::string>`参数（增加。`ContainerT``list<>``vector<>``std::list<subString>``subString`

它比此页面上最快的标记化速度快了一倍多，比其他一些快了近 5 倍。此外，使用完美的参数类型，您可以消除所有字符串和列表副本，以提高速度。

此外，它不会执行（极其低效的）结果返回，而是将标记作为参考传递，因此如果您愿意，还允许您使用多个调用来构建标记。

最后，它允许您通过最后一个可选参数指定是否从结果中修剪空标记。

它所需要的只是`std::string`……其余的都是可选的。它不使用流或 boost 库，但足够灵活，能够自然地接受其中一些外来类型。

* * *

## 回答 #6

> 赞同：172
> 
> 时间：2011-09-13T20:46:07.410

这是另一个解决方案。它紧凑且相当高效：

```
std::vector<std::string> split(const std::string &text, char sep) {
  std::vector<std::string> tokens;
  std::size_t start = 0, end = 0;
  while ((end = text.find(sep, start)) != std::string::npos) {
    tokens.push_back(text.substr(start, end - start));
    start = end + 1;
  }
  tokens.push_back(text.substr(start));
  return tokens;
} 
```

它可以很容易地被模板化来处理字符串分隔符、宽字符串等。

请注意，拆分`""`会产生一个空字符串，而拆分`","`（即 sep）会产生两个空字符串。

它也可以轻松扩展以跳过空标记：

```
std::vector<std::string> split(const std::string &text, char sep) {
    std::vector<std::string> tokens;
    std::size_t start = 0, end = 0;
    while ((end = text.find(sep, start)) != std::string::npos) {
        if (end != start) {
          tokens.push_back(text.substr(start, end - start));
        }
        start = end + 1;
    }
    if (end != start) {
       tokens.push_back(text.substr(start));
    }
    return tokens;
} 
```

* * *

如果希望在跳过空标记的同时在多个分隔符处拆分字符串，则可以使用此版本：

```
std::vector<std::string> split(const std::string& text, const std::string& delims)
{
    std::vector<std::string> tokens;
    std::size_t start = text.find_first_not_of(delims), end = 0;

    while((end = text.find_first_of(delims, start)) != std::string::npos)
    {
        tokens.push_back(text.substr(start, end - start));
        start = text.find_first_not_of(delims, end);
    }
    if(start != std::string::npos)
        tokens.push_back(text.substr(start));

    return tokens;
} 
```

* * *

## 回答 #7

> 赞同：139
> 
> 时间：2008-10-25T09:16:30.837

这是我最喜欢的遍历字符串的方式。您可以按单词做任何您想做的事情。

```
string line = "a line of text to iterate through";
string word;

istringstream iss(line, istringstream::in);

while( iss >> word )     
{
    // Do something on `word` here...
} 
```

* * *

## 回答 #8

> 赞同：87
> 
> 时间：2008-10-25T10:58:25.577

这类似于 Stack Overflow 问题*[How do I tokenize a string in C++?](https://stackoverflow.com/questions/53849/how-do-i-tokenize-a-string-in-c)* . **需要 Boost 外部库**

```
#include <iostream>
#include <string>
#include <boost/tokenizer.hpp>

using namespace std;
using namespace boost;

int main(int argc, char** argv)
{
    string text = "token  test\tstring";

    char_separator<char> sep(" \t");
    tokenizer<char_separator<char>> tokens(text, sep);
    for (const string& t : tokens)
    {
        cout << t << "." << endl;
    }
} 
```

* * *

## 回答 #9

> 赞同：69
> 
> 时间：2008-10-25T10:01:56.063

我喜欢以下内容，因为它将结果放入向量中，支持字符串作为分隔符并控制保留空值。但是，那时看起来并不那么好。

```
#include <ostream>
#include <string>
#include <vector>
#include <algorithm>
#include <iterator>
using namespace std;

vector<string> split(const string& s, const string& delim, const bool keep_empty = true) {
    vector<string> result;
    if (delim.empty()) {
        result.push_back(s);
        return result;
    }
    string::const_iterator substart = s.begin(), subend;
    while (true) {
        subend = search(substart, s.end(), delim.begin(), delim.end());
        string temp(substart, subend);
        if (keep_empty || !temp.empty()) {
            result.push_back(temp);
        }
        if (subend == s.end()) {
            break;
        }
        substart = subend + delim.size();
    }
    return result;
}

int main() {
    const vector<string> words = split("So close no matter how far", " ");
    copy(words.begin(), words.end(), ostream_iterator<string>(cout, "\n"));
} 
```

当然，Boost 有一个[`split()`](http://www.boost.org/doc/libs/1_36_0/doc/html/string_algo/usage.html#id3483755)部分类似的功能。而且，如果通过“空白”，您确实是指任何类型的空白，使用 Boost 的 split with`is_any_of()`效果很好。

* * *

## 回答 #10

> 赞同：57
> 
> 时间：2008-10-25T09:08:17.857

STL 还没有这样的方法可用。

但是，您可以[`strtok()`](http://en.cppreference.com/w/c/string/byte/strtok)通过使用成员来使用 C 的函数[`std::string::c_str()`](http://en.cppreference.com/w/cpp/string/basic_string/c_str)，也可以编写自己的函数。这是我在 Google 快速搜索后找到的代码示例（**“STL 字符串拆分”**）：

```
void Tokenize(const string& str,
              vector<string>& tokens,
              const string& delimiters = " ")
{
    // Skip delimiters at beginning.
    string::size_type lastPos = str.find_first_not_of(delimiters, 0);
    // Find first "non-delimiter".
    string::size_type pos     = str.find_first_of(delimiters, lastPos);

    while (string::npos != pos || string::npos != lastPos)
    {
        // Found a token, add it to the vector.
        tokens.push_back(str.substr(lastPos, pos - lastPos));
        // Skip delimiters.  Note the "not_of"
        lastPos = str.find_first_not_of(delimiters, pos);
        // Find next "non-delimiter"
        pos = str.find_first_of(delimiters, lastPos);
    }
} 
```

取自： http: [//oopweb.com/CPP/Documents/CPPHOWTO/Volume/C++Programming-HOWTO-7.html](http://oopweb.com/CPP/Documents/CPPHOWTO/Volume/C++Programming-HOWTO-7.html)

如果您对代码示例有任何疑问，请发表评论，我会解释。

仅仅因为它没有实现`typedef`被调用的迭代器或重载`<<`运算符并不意味着它是糟糕的代码。我经常使用 C 函数。例如，[`printf`](http://en.cppreference.com/w/c/io/fprintf)两者[`scanf`](http://en.cppreference.com/w/c/io/fscanf)都比[`std::cin`](http://en.cppreference.com/w/cpp/io/cin)和[`std::cout`](http://en.cppreference.com/w/cpp/io/cout)（显着）更快，[`fopen`](http://en.cppreference.com/w/c/io/fopen)语法对二进制类型更友好，而且它们也倾向于生成更小的 EXE。

不要被这种**“优雅胜过性能”**的交易所吸引。

* * *

## 回答 #11

> 赞同：44
> 
> 时间：2012-03-13T00:09:42.743

这是一个拆分函数：

*   是通用的
*   使用标准 C++（无提升）
*   接受多个分隔符
*   忽略空标记（可以轻松更改）

    ```
    template<typename T>
    vector<T> 
    split(const T & str, const T & delimiters) {
        vector<T> v;
        typename T::size_type start = 0;
        auto pos = str.find_first_of(delimiters, start);
        while(pos != T::npos) {
            if(pos != start) // ignore empty tokens
                v.emplace_back(str, start, pos - start);
            start = pos + 1;
            pos = str.find_first_of(delimiters, start);
        }
        if(start < str.length()) // ignore trailing delimiter
            v.emplace_back(str, start, str.length() - start); // add what's left of the string
        return v;
    } 
    ```

示例用法：

```
 vector<string> v = split<string>("Hello, there; World", ";,");
    vector<wstring> v = split<wstring>(L"Hello, there; World", L";,"); 
```

* * *

## 回答 #12

> 赞同：38
> 
> 时间：2012-09-16T14:06:03.947

我有这个问题的 2 行解决方案：

```
char sep = ' ';
std::string s="1 This is an example";

for(size_t p=0, q=0; p!=s.npos; p=q)
  std::cout << s.substr(p+(p!=0), (q=s.find(sep, p+1))-p-(p!=0)) << std::endl; 
```

然后，您可以将其放入向量中，而不是打印。

* * *

## 回答 #13

> 赞同：36
> 
> 时间：2010-04-01T14:16:43.863

另一种灵活快速的方式

```
template<typename Operator>
void tokenize(Operator& op, const char* input, const char* delimiters) {
  const char* s = input;
  const char* e = s;
  while (*e != 0) {
    e = s;
    while (*e != 0 && strchr(delimiters, *e) == 0) ++e;
    if (e - s > 0) {
      op(s, e - s);
    }
    s = e + 1;
  }
} 
```

将它与字符串向量一起使用（编辑：因为有人指出不要继承 STL 类...... hrmf ;)）：

```
template<class ContainerType>
class Appender {
public:
  Appender(ContainerType& container) : container_(container) {;}
  void operator() (const char* s, unsigned length) { 
    container_.push_back(std::string(s,length));
  }
private:
  ContainerType& container_;
};

std::vector<std::string> strVector;
Appender v(strVector);
tokenize(v, "A number of words to be tokenized", " \t"); 
```

就是这样！这只是使用标记器的一种方法，例如如何计算单词：

```
class WordCounter {
public:
  WordCounter() : noOfWords(0) {}
  void operator() (const char*, unsigned) {
    ++noOfWords;
  }
  unsigned noOfWords;
};

WordCounter wc;
tokenize(wc, "A number of words to be counted", " \t"); 
ASSERT( wc.noOfWords == 7 ); 
```

受想象力限制；）

* * *

## 回答 #14

> 赞同：36
> 
> 时间：2014-05-06T05:49:21.267

这是一个仅使用标准正则表达式库的简单解决方案

```
#include <regex>
#include <string>
#include <vector>

std::vector<string> Tokenize( const string str, const std::regex regex )
{
    using namespace std;

    std::vector<string> result;

    sregex_token_iterator it( str.begin(), str.end(), regex, -1 );
    sregex_token_iterator reg_end;

    for ( ; it != reg_end; ++it ) {
        if ( !it->str().empty() ) //token could be empty:check
            result.emplace_back( it->str() );
    }

    return result;
} 
```

regex 参数允许检查多个参数（空格、逗号等）

我通常只检查空格和逗号，所以我也有这个默认功能：

```
std::vector<string> TokenizeDefault( const string str )
{
    using namespace std;

    regex re( "[\\s,]+" );

    return Tokenize( str, re );
} 
```

`"[\\s,]+"`检查空格 ( )`\\s`和逗号 ( `,`)。

请注意，如果您想拆分`wstring`而不是`string`,

*   全部更改`std::regex`为`std::wregex`
*   全部更改`sregex_token_iterator`为`wsregex_token_iterator`

请注意，您可能还希望通过引用获取字符串参数，具体取决于您的编译器。

* * *

## 回答 #15

> 赞同：31
> 
> 时间：2008-10-25T09:28:35.257

使用`std::stringstream`as you have 可以很好地工作，并且完全按照您的意愿行事。如果你只是在寻找不同的做事方式，你可以使用[`std::find()`](http://en.cppreference.com/w/cpp/algorithm/find)/[`std::find_first_of()`](http://en.cppreference.com/w/cpp/algorithm/find_first_of)和[`std::string::substr()`](http://en.cppreference.com/w/cpp/string/basic_string/substr).

这是一个例子：

```
#include <iostream>
#include <string>

int main()
{
    std::string s("Somewhere down the road");
    std::string::size_type prev_pos = 0, pos = 0;

    while( (pos = s.find(' ', pos)) != std::string::npos )
    {
        std::string substring( s.substr(prev_pos, pos-prev_pos) );

        std::cout << substring << '\n';

        prev_pos = ++pos;
    }

    std::string substring( s.substr(prev_pos, pos-prev_pos) ); // Last word
    std::cout << substring << '\n';

    return 0;
} 
```

* * *

## 回答 #16

> 赞同：26
> 
> 时间：2011-03-24T12:47:28.403

如果您喜欢使用 boost，但想使用整个字符串作为分隔符（而不是之前提出的大多数解决方案中的单个字符），您可以使用`boost_split_iterator`.

示例代码，包括方便的模板：

```
#include <iostream>
#include <vector>
#include <boost/algorithm/string.hpp>

template<typename _OutputIterator>
inline void split(
    const std::string& str, 
    const std::string& delim, 
    _OutputIterator result)
{
    using namespace boost::algorithm;
    typedef split_iterator<std::string::const_iterator> It;

    for(It iter=make_split_iterator(str, first_finder(delim, is_equal()));
            iter!=It();
            ++iter)
    {
        *(result++) = boost::copy_range<std::string>(*iter);
    }
}

int main(int argc, char* argv[])
{
    using namespace std;

    vector<string> splitted;
    split("HelloFOOworldFOO!", "FOO", back_inserter(splitted));

    // or directly to console, for example
    split("HelloFOOworldFOO!", "FOO", ostream_iterator<string>(cout, "\n"));
    return 0;
} 
```

* * *

## 回答 #17

> 赞同：22
> 
> 时间：2012-10-29T16:15:47.527

这是一个仅使用标准正则表达式库的正则表达式解决方案。（我有点生疏，所以可能会有一些语法错误，但这至少是大体思路）

```
#include <regex.h>
#include <string.h>
#include <vector.h>

using namespace std;

vector<string> split(string s){
    regex r ("\\w+"); //regex matches whole words, (greedy, so no fragment words)
    regex_iterator<string::iterator> rit ( s.begin(), s.end(), r );
    regex_iterator<string::iterator> rend; //iterators to iterate thru words
    vector<string> result<regex_iterator>(rit, rend);
    return result;  //iterates through the matches to fill the vector
} 
```

* * *

## 回答 #18

> 赞同：21
> 
> 时间：2010-06-14T12:17:08.900

有一个名为 的函数[`strtok`](http://www.cplusplus.com/reference/clibrary/cstring/strtok/)。

```
#include<string>
using namespace std;

vector<string> split(char* str,const char* delim)
{
    char* saveptr;
    char* token = strtok_r(str,delim,&saveptr);

    vector<string> result;

    while(token != NULL)
    {
        result.push_back(token);
        token = strtok_r(NULL,delim,&saveptr);
    }
    return result;
} 
```

* * *

## 回答 #19

> 赞同：17
> 
> 时间：2011-08-12T19:05:26.817

如果您需要通过非空格符号解析字符串，则 stringstream 会很方便[：](http://www.cplusplus.com/reference/sstream/stringstream/)

```
string s = "Name:JAck; Spouse:Susan; ...";
string dummy, name, spouse;

istringstream iss(s);
getline(iss, dummy, ':');
getline(iss, name, ';');
getline(iss, dummy, ':');
getline(iss, spouse, ';') 
```

* * *

## 回答 #20

> 赞同：17
> 
> 时间：2019-01-10T17:46:09.837

使用`std::string_view`和 Eric Niebler 的`range-v3`库：

[https://wandbox.org/permlink/kW5lwRCL1pxjp2pW](https://wandbox.org/permlink/kW5lwRCL1pxjp2pW)

```
#include <iostream>
#include <string>
#include <string_view>
#include "range/v3/view.hpp"
#include "range/v3/algorithm.hpp"

int main() {
    std::string s = "Somewhere down the range v3 library";
    ranges::for_each(s  
        |   ranges::view::split(' ')
        |   ranges::view::transform([](auto &&sub) {
                return std::string_view(&*sub.begin(), ranges::distance(sub));
            }),
        [](auto s) {std::cout << "Substring: " << s << "\n";}
    );
} 
```

通过使用范围`for`循环而不是`ranges::for_each`算法：

```
#include <iostream>
#include <string>
#include <string_view>
#include "range/v3/view.hpp"

int main()
{
    std::string str = "Somewhere down the range v3 library";
    for (auto s : str | ranges::view::split(' ')
                      | ranges::view::transform([](auto&& sub) { return std::string_view(&*sub.begin(), ranges::distance(sub)); }
                      ))
    {
        std::cout << "Substring: " << s << "\n";
    }
} 
```

* * *

## 回答 #21

> 赞同：17
> 
> 时间：2020-05-05T19:31:43.247

C++20 终于给我们带来了一个`split`函数。或者更确切地说，一个范围适配器。[神螺栓链接](https://godbolt.org/z/6mZ8hG)。

```
#include <iostream>
#include <ranges>
#include <string_view>

namespace ranges = std::ranges;
namespace views = std::views;

using str = std::string_view;

constexpr auto view =
    "Multiple words"
    | views::split(' ')
    | views::transform([](auto &&r) -> str {
        return {
            &*r.begin(),
            static_cast<str::size_type>(ranges::distance(r))
        };
    });

auto main() -> int {
    for (str &&sv : view) {
        std::cout << sv << '\n';
    }
} 
```

* * *

## 回答 #22

> 赞同：14
> 
> 时间：2011-01-14T09:22:54.947

到目前为止，我在[Boost](http://en.wikipedia.org/wiki/Boost_C++_Libraries)中使用了那个，但我需要一些不依赖它的东西，所以我来到了这个：

```
static void Split(std::vector<std::string>& lst, const std::string& input, const std::string& separators, bool remove_empty = true)
{
    std::ostringstream word;
    for (size_t n = 0; n < input.size(); ++n)
    {
        if (std::string::npos == separators.find(input[n]))
            word << input[n];
        else
        {
            if (!word.str().empty() || !remove_empty)
                lst.push_back(word.str());
            word.str("");
        }
    }
    if (!word.str().empty() || !remove_empty)
        lst.push_back(word.str());
} 
```

一个好处是`separators`你可以传递多个字符。

* * *

## 回答 #23

> 赞同：14
> 
> 时间：2015-11-02T14:39:08.223

短而优雅

```
#include <vector>
#include <string>
using namespace std;

vector<string> split(string data, string token)
{
    vector<string> output;
    size_t pos = string::npos; // size_t to avoid improbable overflow
    do
    {
        pos = data.find(token);
        output.push_back(data.substr(0, pos));
        if (string::npos != pos)
            data = data.substr(pos + token.size());
    } while (string::npos != pos);
    return output;
} 
```

可以使用任何字符串作为分隔符，也可以与二进制数据一起使用（std::string 支持二进制数据，包括空值）

使用：

```
auto a = split("this!!is!!!example!string", "!!"); 
```

输出：

```
this
is
!example!string 
```

* * *

## 回答 #24

> 赞同：13
> 
> 时间：2014-01-07T20:28:03.033

我已经使用 strtok 推出了自己的产品，并使用 boost 来拆分字符串。我发现的最好的方法是[C++ String Toolkit Library](http://www.partow.net/programming/strtk/)。它非常灵活和快速。

```
#include <iostream>
#include <vector>
#include <string>
#include <strtk.hpp>

const char *whitespace  = " \t\r\n\f";
const char *whitespace_and_punctuation  = " \t\r\n\f;,=";

int main()
{
    {   // normal parsing of a string into a vector of strings
        std::string s("Somewhere down the road");
        std::vector<std::string> result;
        if( strtk::parse( s, whitespace, result ) )
        {
            for(size_t i = 0; i < result.size(); ++i )
                std::cout << result[i] << std::endl;
        }
    }

    {  // parsing a string into a vector of floats with other separators
        // besides spaces

        std::string s("3.0, 3.14; 4.0");
        std::vector<float> values;
        if( strtk::parse( s, whitespace_and_punctuation, values ) )
        {
            for(size_t i = 0; i < values.size(); ++i )
                std::cout << values[i] << std::endl;
        }
    }

    {  // parsing a string into specific variables

        std::string s("angle = 45; radius = 9.9");
        std::string w1, w2;
        float v1, v2;
        if( strtk::parse( s, whitespace_and_punctuation, w1, v1, w2, v2) )
        {
            std::cout << "word " << w1 << ", value " << v1 << std::endl;
            std::cout << "word " << w2 << ", value " << v2 << std::endl;
        }
    }

    return 0;
} 
```

该工具包比这个简单示例显示的灵活得多，但它在将字符串解析为有用元素方面的实用性令人难以置信。

* * *

## 回答 #25

> 赞同：12
> 
> 时间：2012-08-31T19:11:05.340

我这样做是因为我需要一种简单的方法来拆分字符串和基于 c 的字符串......希望其他人也能发现它也很有用。此外，它不依赖于标记，您可以使用字段作为分隔符，这是我需要的另一个键。

我确信可以进行改进以进一步提高其优雅性，请务必这样做

StringSplitter.hpp：

```
#include <vector>
#include <iostream>
#include <string.h>

using namespace std;

class StringSplit
{
private:
    void copy_fragment(char*, char*, char*);
    void copy_fragment(char*, char*, char);
    bool match_fragment(char*, char*, int);
    int untilnextdelim(char*, char);
    int untilnextdelim(char*, char*);
    void assimilate(char*, char);
    void assimilate(char*, char*);
    bool string_contains(char*, char*);
    long calc_string_size(char*);
    void copy_string(char*, char*);

public:
    vector<char*> split_cstr(char);
    vector<char*> split_cstr(char*);
    vector<string> split_string(char);
    vector<string> split_string(char*);
    char* String;
    bool do_string;
    bool keep_empty;
    vector<char*> Container;
    vector<string> ContainerS;

    StringSplit(char * in)
    {
        String = in;
    }

    StringSplit(string in)
    {
        size_t len = calc_string_size((char*)in.c_str());
        String = new char[len + 1];
        memset(String, 0, len + 1);
        copy_string(String, (char*)in.c_str());
        do_string = true;
    }

    ~StringSplit()
    {
        for (int i = 0; i < Container.size(); i++)
        {
            if (Container[i] != NULL)
            {
                delete[] Container[i];
            }
        }
        if (do_string)
        {
            delete[] String;
        }
    }
}; 
```

StringSplitter.cpp：

```
#include <string.h>
#include <iostream>
#include <vector>
#include "StringSplit.hpp"

using namespace std;

void StringSplit::assimilate(char*src, char delim)
{
    int until = untilnextdelim(src, delim);
    if (until > 0)
    {
        char * temp = new char[until + 1];
        memset(temp, 0, until + 1);
        copy_fragment(temp, src, delim);
        if (keep_empty || *temp != 0)
        {
            if (!do_string)
            {
                Container.push_back(temp);
            }
            else
            {
                string x = temp;
                ContainerS.push_back(x);
            }

        }
        else
        {
            delete[] temp;
        }
    }
}

void StringSplit::assimilate(char*src, char* delim)
{
    int until = untilnextdelim(src, delim);
    if (until > 0)
    {
        char * temp = new char[until + 1];
        memset(temp, 0, until + 1);
        copy_fragment(temp, src, delim);
        if (keep_empty || *temp != 0)
        {
            if (!do_string)
            {
                Container.push_back(temp);
            }
            else
            {
                string x = temp;
                ContainerS.push_back(x);
            }
        }
        else
        {
            delete[] temp;
        }
    }
}

long StringSplit::calc_string_size(char* _in)
{
    long i = 0;
    while (*_in++)
    {
        i++;
    }
    return i;
}

bool StringSplit::string_contains(char* haystack, char* needle)
{
    size_t len = calc_string_size(needle);
    size_t lenh = calc_string_size(haystack);
    while (lenh--)
    {
        if (match_fragment(haystack + lenh, needle, len))
        {
            return true;
        }
    }
    return false;
}

bool StringSplit::match_fragment(char* _src, char* cmp, int len)
{
    while (len--)
    {
        if (*(_src + len) != *(cmp + len))
        {
            return false;
        }
    }
    return true;
}

int StringSplit::untilnextdelim(char* _in, char delim)
{
    size_t len = calc_string_size(_in);
    if (*_in == delim)
    {
        _in += 1;
        return len - 1;
    }

    int c = 0;
    while (*(_in + c) != delim && c < len)
    {
        c++;
    }

    return c;
}

int StringSplit::untilnextdelim(char* _in, char* delim)
{
    int s = calc_string_size(delim);
    int c = 1 + s;

    if (!string_contains(_in, delim))
    {
        return calc_string_size(_in);
    }
    else if (match_fragment(_in, delim, s))
    {
        _in += s;
        return calc_string_size(_in);
    }

    while (!match_fragment(_in + c, delim, s))
    {
        c++;
    }

    return c;
}

void StringSplit::copy_fragment(char* dest, char* src, char delim)
{
    if (*src == delim)
    {
        src++;
    }

    int c = 0;
    while (*(src + c) != delim && *(src + c))
    {
        *(dest + c) = *(src + c);
        c++;
    }
    *(dest + c) = 0;
}

void StringSplit::copy_string(char* dest, char* src)
{
    int i = 0;
    while (*(src + i))
    {
        *(dest + i) = *(src + i);
        i++;
    }
}

void StringSplit::copy_fragment(char* dest, char* src, char* delim)
{
    size_t len = calc_string_size(delim);
    size_t lens = calc_string_size(src);

    if (match_fragment(src, delim, len))
    {
        src += len;
        lens -= len;
    }

    int c = 0;
    while (!match_fragment(src + c, delim, len) && (c < lens))
    {
        *(dest + c) = *(src + c);
        c++;
    }
    *(dest + c) = 0;
}

vector<char*> StringSplit::split_cstr(char Delimiter)
{
    int i = 0;
    while (*String)
    {
        if (*String != Delimiter && i == 0)
        {
            assimilate(String, Delimiter);
        }
        if (*String == Delimiter)
        {
            assimilate(String, Delimiter);
        }
        i++;
        String++;
    }

    String -= i;
    delete[] String;

    return Container;
}

vector<string> StringSplit::split_string(char Delimiter)
{
    do_string = true;

    int i = 0;
    while (*String)
    {
        if (*String != Delimiter && i == 0)
        {
            assimilate(String, Delimiter);
        }
        if (*String == Delimiter)
        {
            assimilate(String, Delimiter);
        }
        i++;
        String++;
    }

    String -= i;
    delete[] String;

    return ContainerS;
}

vector<char*> StringSplit::split_cstr(char* Delimiter)
{
    int i = 0;
    size_t LenDelim = calc_string_size(Delimiter);

    while(*String)
    {
        if (!match_fragment(String, Delimiter, LenDelim) && i == 0)
        {
            assimilate(String, Delimiter);
        }
        if (match_fragment(String, Delimiter, LenDelim))
        {
            assimilate(String,Delimiter);
        }
        i++;
        String++;
    }

    String -= i;
    delete[] String;

    return Container;
}

vector<string> StringSplit::split_string(char* Delimiter)
{
    do_string = true;
    int i = 0;
    size_t LenDelim = calc_string_size(Delimiter);

    while (*String)
    {
        if (!match_fragment(String, Delimiter, LenDelim) && i == 0)
        {
            assimilate(String, Delimiter);
        }
        if (match_fragment(String, Delimiter, LenDelim))
        {
            assimilate(String, Delimiter);
        }
        i++;
        String++;
    }

    String -= i;
    delete[] String;

    return ContainerS;
} 
```

例子：

```
int main(int argc, char*argv[])
{
    StringSplit ss = "This:CUT:is:CUT:an:CUT:example:CUT:cstring";
    vector<char*> Split = ss.split_cstr(":CUT:");

    for (int i = 0; i < Split.size(); i++)
    {
        cout << Split[i] << endl;
    }

    return 0;
} 
```

将输出：

这
是
一个
示例
cstring

```
int main(int argc, char*argv[])
{
    StringSplit ss = "This:is:an:example:cstring";
    vector<char*> Split = ss.split_cstr(':');

    for (int i = 0; i < Split.size(); i++)
    {
        cout << Split[i] << endl;
    }

    return 0;
}

int main(int argc, char*argv[])
{
    string mystring = "This[SPLIT]is[SPLIT]an[SPLIT]example[SPLIT]string";
    StringSplit ss = mystring;
    vector<string> Split = ss.split_string("[SPLIT]");

    for (int i = 0; i < Split.size(); i++)
    {
        cout << Split[i] << endl;
    }

    return 0;
}

int main(int argc, char*argv[])
{
    string mystring = "This|is|an|example|string";
    StringSplit ss = mystring;
    vector<string> Split = ss.split_string('|');

    for (int i = 0; i < Split.size(); i++)
    {
        cout << Split[i] << endl;
    }

    return 0;
} 
```

要保留空条目（默认情况下将排除空条目）：

```
StringSplit ss = mystring;
ss.keep_empty = true;
vector<string> Split = ss.split_string(":DELIM:"); 
```

目标是使其类似于 C# 的 Split() 方法，其中拆分字符串非常简单：

```
String[] Split = 
    "Hey:cut:what's:cut:your:cut:name?".Split(new[]{":cut:"}, StringSplitOptions.None);

foreach(String X in Split)
{
    Console.Write(X);
} 
```

我希望其他人能像我一样发现这很有用。

* * *

## 回答 #26

> 赞同：12
> 
> 时间：2017-12-09T21:14:38.850

这个答案接受字符串并将其放入字符串向量中。它使用 boost 库。

```
#include <boost/algorithm/string.hpp>
std::vector<std::string> strs;
boost::split(strs, "string to split", boost::is_any_of("\t ")); 
```

* * *

## 回答 #27

> 赞同：10
> 
> 时间：2011-06-23T22:04:29.483

那这个呢：

```
#include <string>
#include <vector>

using namespace std;

vector<string> split(string str, const char delim) {
    vector<string> v;
    string tmp;

    for(string::const_iterator i; i = str.begin(); i <= str.end(); ++i) {
        if(*i != delim && i != str.end()) {
            tmp += *i; 
        } else {
            v.push_back(tmp);
            tmp = ""; 
        }   
    }   

    return v;
} 
```

* * *

## 回答 #28

> 赞同：9
> 
> 时间：2010-01-08T03:21:16.157

这是另一种方法..

```
void split_string(string text,vector<string>& words)
{
  int i=0;
  char ch;
  string word;

  while(ch=text[i++])
  {
    if (isspace(ch))
    {
      if (!word.empty())
      {
        words.push_back(word);
      }
      word = "";
    }
    else
    {
      word += ch;
    }
  }
  if (!word.empty())
  {
    words.push_back(word);
  }
} 
```

* * *

## 回答 #29

> 赞同：9
> 
> 时间：2011-06-12T09:25:38.673

我喜欢在这个任务中使用 boost/regex 方法，因为它们为指定拆分标准提供了最大的灵活性。

```
#include <iostream>
#include <string>
#include <boost/regex.hpp>

int main() {
    std::string line("A:::line::to:split");
    const boost::regex re(":+"); // one or more colons

    // -1 means find inverse matches aka split
    boost::sregex_token_iterator tokens(line.begin(),line.end(),re,-1);
    boost::sregex_token_iterator end;

    for (; tokens != end; ++tokens)
        std::cout << *tokens << std::endl;
} 
```

* * *

## 回答 #30

> 赞同：9
> 
> 时间：2011-09-14T09:42:56.257

最近我不得不将一个驼峰式单词拆分成子词。没有分隔符，只有大写字符。

```
#include <string>
#include <list>
#include <locale> // std::isupper

template<class String>
const std::list<String> split_camel_case_string(const String &s)
{
    std::list<String> R;
    String w;

    for (String::const_iterator i = s.begin(); i < s.end(); ++i) {  {
        if (std::isupper(*i)) {
            if (w.length()) {
                R.push_back(w);
                w.clear();
            }
        }
        w += *i;
    }

    if (w.length())
        R.push_back(w);
    return R;
} 
```

例如，这会将“AQueryTrades”拆分为“A”、“Query”和“Trades”。该函数适用于窄字符串和宽字符串。因为它尊重当前的语言环境，所以它将“RaumfahrtÜberwachungsVerordnung”拆分为“Raumfahrt”、“Überwachungs”和“Verordnung”。

注意`std::upper`应该真正作为函数模板参数传递。然后这个函数的更广义的 from 可以在分隔符处拆分，例如`","`, `";"`or `" "`too。

* * *

## 回答 #31

> 赞同：9
> 
> 时间：2013-10-03T08:41:44.560

```
#include<iostream>
#include<string>
#include<sstream>
#include<vector>
using namespace std;

    vector<string> split(const string &s, char delim) {
        vector<string> elems;
        stringstream ss(s);
        string item;
        while (getline(ss, item, delim)) {
            elems.push_back(item);
        }
        return elems;
    }

int main() {

        vector<string> x = split("thi is an sample test",' ');
        unsigned int i;
        for(i=0;i<x.size();i++)
            cout<<i<<":"<<x[i]<<endl;
        return 0;
} 
```

* * *

## 回答 #32

> 赞同：8
> 
> 时间：2011-12-10T13:58:22.117

下面的代码用于`strtok()`将字符串拆分为标记并将标记存储在向量中。

```
#include <iostream>
#include <algorithm>
#include <vector>
#include <string>

using namespace std;

char one_line_string[] = "hello hi how are you nice weather we are having ok then bye";
char seps[]   = " ,\t\n";
char *token;

int main()
{
   vector<string> vec_String_Lines;
   token = strtok( one_line_string, seps );

   cout << "Extracting and storing data in a vector..\n\n\n";

   while( token != NULL )
   {
      vec_String_Lines.push_back(token);
      token = strtok( NULL, seps );
   }
     cout << "Displaying end result in vector line storage..\n\n";

    for ( int i = 0; i < vec_String_Lines.size(); ++i)
    cout << vec_String_Lines[i] << "\n";
    cout << "\n\n\n";

return 0;
} 
```

* * *

## 回答 #33

> 赞同：8
> 
> 时间：2013-04-07T16:07:55.803

获得[提升](http://www.boost.org/)！:-)

```
#include <boost/algorithm/string/split.hpp>
#include <boost/algorithm/string.hpp>
#include <iostream>
#include <vector>

using namespace std;
using namespace boost;

int main(int argc, char**argv) {
    typedef vector < string > list_type;

    list_type list;
    string line;

    line = "Somewhere down the road";
    split(list, line, is_any_of(" "));

    for(int i = 0; i < list.size(); i++)
    {
        cout << list[i] << endl;
    }

    return 0;
} 
```

这个例子给出了输出 -

```
Somewhere
down
the
road 
```

* * *

## 回答 #34

> 赞同：8
> 
> 时间：2016-09-06T23:42:20.293

```
#include <iostream>
#include <regex>

using namespace std;

int main() {
   string s = "foo bar  baz";
   regex e("\\s+");
   regex_token_iterator<string::iterator> i(s.begin(), s.end(), e, -1);
   regex_token_iterator<string::iterator> end;
   while (i != end)
      cout << " [" << *i++ << "]";
} 
```

IMO，这是最接近 python 的 re.split() 的东西。有关[regex_token_iterator](http://www.cplusplus.com/reference/regex/regex_token_iterator/regex_token_iterator/)的更多信息，请参阅 cplusplus.com。-1（regex_token_iterator ctor 中的第 4 个参数）是序列中不匹配的部分，使用匹配作为分隔符。

* * *

## 回答 #35

> 赞同：7
> 
> 时间：2010-09-01T09:25:52.350

我使用这个 simpleton 是因为我们的 String 类是“特殊的”（即不是标准的）：

```
void splitString(const String &s, const String &delim, std::vector<String> &result) {
    const int l = delim.length();
    int f = 0;
    int i = s.indexOf(delim,f);
    while (i>=0) {
        String token( i-f > 0 ? s.substring(f,i-f) : "");
        result.push_back(token);
        f=i+l;
        i = s.indexOf(delim,f);
    }
    String token = s.substring(f);
    result.push_back(token);
} 
```

* * *

## 回答 #36

> 赞同：7
> 
> 时间：2020-06-07T11:35:43.737

每个人都回答了预定义的字符串输入。我认为这个答案将帮助某人进行扫描输入。

我使用标记向量来保存字符串标记。这是可选的。

```
#include <bits/stdc++.h>

using namespace std ;
int main()
{
    string str, token ;
    getline(cin, str) ; // get the string as input
    istringstream ss(str); // insert the string into tokenizer

    vector<string> tokens; // vector tokens holds the tokens

    while (ss >> token) tokens.push_back(token); // splits the tokens
    for(auto x : tokens) cout << x << endl ; // prints the tokens

    return 0;
} 
```

样本输入：

```
port city international university 
```

样本输出：

```
port
city
international
university 
```

请注意，默认情况下，这仅适用于作为分隔符的空格。您可以使用自定义分隔符。为此，您已经自定义了代码。让分隔符为'，'。所以用

```
char delimiter = ',' ;
while(getline(ss, token, delimiter)) tokens.push_back(token) ; 
```

代替

```
while (ss >> token) tokens.push_back(token); 
```

* * *

## 回答 #37

> 赞同：6
> 
> 时间：2011-05-15T18:48:44.507

以下是执行此操作的更好方法。它可以采用任何字符，并且除非您愿意，否则不会拆分行。不需要特殊的库（好吧，除了std，但谁真的认为这是一个额外的库），没有指针，没有引用，而且它是静态的。只是简单的普通 C++。

```
#pragma once
#include <vector>
#include <sstream>
using namespace std;
class Helpers
{
    public:
        static vector<string> split(string s, char delim)
        {
            stringstream temp (stringstream::in | stringstream::out);
            vector<string> elems(0);
            if (s.size() == 0 || delim == 0)
                return elems;
            for(char c : s)
            {
                if(c == delim)
                {
                    elems.push_back(temp.str());
                    temp = stringstream(stringstream::in | stringstream::out);
                }
                else
                    temp << c;
            }
            if (temp.str().size() > 0)
                elems.push_back(temp.str());
                return elems;
            }

        //Splits string s with a list of delimiters in delims (it's just a list, like if we wanted to
        //split at the following letters, a, b, c we would make delims="abc".
        static vector<string> split(string s, string delims)
        {
            stringstream temp (stringstream::in | stringstream::out);
            vector<string> elems(0);
            bool found;
            if(s.size() == 0 || delims.size() == 0)
                return elems;
            for(char c : s)
            {
                found = false;
                for(char d : delims)
                {
                    if (c == d)
                    {
                        elems.push_back(temp.str());
                        temp = stringstream(stringstream::in | stringstream::out);
                        found = true;
                        break;
                    }
                }
                if(!found)
                    temp << c;
            }
            if(temp.str().size() > 0)
                elems.push_back(temp.str());
            return elems;
        }
}; 
```

* * *

## 回答 #38

> 赞同：5
> 
> 时间：2012-10-07T05:26:11.647

我写了以下一段代码。您可以指定分隔符，它可以是字符串。结果类似于 Java 的 String.split，结果为空字符串。

例如，如果我们调用 split("ABCPICKABCANYABCTWO:ABC", "ABC")，结果如下：

```
0  <len:0>
1 PICK <len:4>
2 ANY <len:3>
3 TWO: <len:4>
4  <len:0> 
```

代码：

```
vector <string> split(const string& str, const string& delimiter = " ") {
    vector <string> tokens;

    string::size_type lastPos = 0;
    string::size_type pos = str.find(delimiter, lastPos);

    while (string::npos != pos) {
        // Found a token, add it to the vector.
        cout << str.substr(lastPos, pos - lastPos) << endl;
        tokens.push_back(str.substr(lastPos, pos - lastPos));
        lastPos = pos + delimiter.size();
        pos = str.find(delimiter, lastPos);
    }

    tokens.push_back(str.substr(lastPos, str.size() - lastPos));
    return tokens;
} 
```

* * *

## 回答 #39

> 赞同：5
> 
> 时间：2014-11-25T11:43:20.957

这是我使用**C++11**和**STL**的解决方案。它应该是相当有效的：

```
#include <vector>
#include <string>
#include <cstring>
#include <iostream>
#include <algorithm>
#include <functional>

std::vector<std::string> split(const std::string& s)
{
    std::vector<std::string> v;

    const auto end = s.end();
    auto to = s.begin();
    decltype(to) from;

    while((from = std::find_if(to, end,
        [](char c){ return !std::isspace(c); })) != end)
    {
        to = std::find_if(from, end, [](char c){ return std::isspace(c); });
        v.emplace_back(from, to);
    }

    return v;
}

int main()
{
    std::string s = "this is the string  to  split";

    auto v = split(s);

    for(auto&& s: v)
        std::cout << s << '\n';
} 
```

**输出：**

```
this
is
the
string
to
split 
```

* * *

## 回答 #40

> 赞同：5
> 
> 时间：2014-12-18T21:31:43.893

在处理空格作为分隔符时，使用的明显答案`std::istream_iterator<T>`已经给出并被大量投票。当然，元素可能不是由空格分隔，而是由一些分隔符分隔。我没有发现任何答案，它只是将空格的含义重新定义为分隔符，然后使用传统方法。

更改流考虑空格的方法，您只需更改流的`std::locale`using ( `std::istream::imbue()`) 与一个`std::ctype<char>`方面，它具有自己定义的空格含义（它也可以为 完成`std::ctype<wchar_t>`，但它实际上略有不同，因为`std::ctype<char>`它是表驱动的而`std::ctype<wchar_t>`由虚函数驱动）。

```
#include <iostream>
#include <algorithm>
#include <iterator>
#include <sstream>
#include <locale>

struct whitespace_mask {
    std::ctype_base::mask mask_table[std::ctype<char>::table_size];
    whitespace_mask(std::string const& spaces) {
        std::ctype_base::mask* table = this->mask_table;
        std::ctype_base::mask const* tab
            = std::use_facet<std::ctype<char>>(std::locale()).table();
        for (std::size_t i(0); i != std::ctype<char>::table_size; ++i) {
            table[i] = tab[i] & ~std::ctype_base::space;
        }
        std::for_each(spaces.begin(), spaces.end(), [=](unsigned char c) {
            table[c] |= std::ctype_base::space;
        });
    }
};
class whitespace_facet
    : private whitespace_mask
    , public std::ctype<char> {
public:
    whitespace_facet(std::string const& spaces)
        : whitespace_mask(spaces)
        , std::ctype<char>(this->mask_table) {
    }
};

struct whitespace {
    std::string spaces;
    whitespace(std::string const& spaces): spaces(spaces) {}
};
std::istream& operator>>(std::istream& in, whitespace const& ws) {
    std::locale loc(in.getloc(), new whitespace_facet(ws.spaces));
    in.imbue(loc);
    return in;
}
// everything above would probably go into a utility library...

int main() {
    std::istringstream in("a, b, c, d, e");
    std::copy(std::istream_iterator<std::string>(in >> whitespace(", ")),
              std::istream_iterator<std::string>(),
              std::ostream_iterator<std::string>(std::cout, "\n"));

    std::istringstream pipes("a b c|  d |e     e");
    std::copy(std::istream_iterator<std::string>(pipes >> whitespace("|")),
              std::istream_iterator<std::string>(),
              std::ostream_iterator<std::string>(std::cout, "\n"));   
} 
```

*大部分代码用于打包提供软分隔符*的通用工具：合并连续的多个分隔符。没有办法产生一个空序列。当流中需要不同的分隔符时，您可能会使用共享流缓冲区使用不同的设置流：

```
void f(std::istream& in) {
    std::istream pipes(in.rdbuf());
    pipes >> whitespace("|");
    std::istream comma(in.rdbuf());
    comma >> whitespace(",");

    std::string s0, s1;
    if (pipes >> s0 >> std::ws   // read up to first pipe and ignore sequence of pipes
        && comma >> s1 >> std::ws) { // read up to first comma and ignore commas
        // ...
    }
} 
```

* * *

## 回答 #41

> 赞同：5
> 
> 时间：2015-09-02T15:01:31.207

作为一个爱好者，这是我想到的第一个解决方案。我有点好奇为什么我还没有在这里看到类似的解决方案，我是怎么做的有什么根本错误吗？

```
#include <iostream>
#include <string>
#include <vector>

std::vector<std::string> split(const std::string &s, const std::string &delims)
{
    std::vector<std::string> result;
    std::string::size_type pos = 0;
    while (std::string::npos != (pos = s.find_first_not_of(delims, pos))) {
        auto pos2 = s.find_first_of(delims, pos);
        result.emplace_back(s.substr(pos, std::string::npos == pos2 ? pos2 : pos2 - pos));
        pos = pos2;
    }
    return result;
}

int main()
{
    std::string text{"And then I said: \"I don't get it, why would you even do that!?\""};
    std::string delims{" :;\".,?!"};
    auto words = split(text, delims);
    std::cout << "\nSentence:\n  " << text << "\n\nWords:";
    for (const auto &w : words) {
        std::cout << "\n  " << w;
    }
    return 0;
} 
```

[http://cpp.sh/7wmzy](http://cpp.sh/7wmzy)

* * *

## 回答 #42

> 赞同：4
> 
> 时间：2011-07-28T12:38:50.030

这是我采用 Kev 的来源的版本：

```
#include <string>
#include <vector>
void split(vector<string> &result, string str, char delim ) {
  string tmp;
  string::iterator i;
  result.clear();

  for(i = str.begin(); i <= str.end(); ++i) {
    if((const char)*i != delim  && i != str.end()) {
      tmp += *i;
    } else {
      result.push_back(tmp);
      tmp = "";
    }
  }
} 
```

之后，调用该函数并对其执行一些操作：

```
vector<string> hosts;
split(hosts, "192.168.1.2,192.168.1.3", ',');
for( size_t i = 0; i < hosts.size(); i++){
  cout <<  "Connecting host : " << hosts.at(i) << "..." << endl;
} 
```

* * *

## 回答 #43

> 赞同：4
> 
> 时间：2021-08-04T17:42:09.727

尽管有一些答案提供了 C++20 解决方案，但自从发布以来，已经进行了一些更改并将其作为缺陷报告应用于 C++20。因此，该解决方案更短且更好：

```
#include <iostream>
#include <ranges>
#include <string_view>

namespace views = std::views;
using str = std::string_view;

constexpr str text = "Lorem ipsum dolor sit amet, consectetur adipiscing elit.";

auto splitByWords(str input) {
    return input
    | views::split(' ')
    | views::transform([](auto &&r) -> str {
        return {r.begin(), r.end()};
    });
}

auto main() -> int {
    for (str &&word : splitByWords(text)) {
        std::cout << word << '\n';
    }
} 
```

到今天为止，它仍然只在 GCC 的主干分支上可用（[Godbolt 链接](https://godbolt.org/z/x6a7rzTKn)）。它基于两个更改：P1391 迭代器构造函数`std::string_view`和 P2210 DR 修复`std::views::split`以保留范围类型。

在 C++23 中不需要任何`transform`样板，因为 P1989 向 std::string_view 添加了范围构造函数：

```
#include <iostream>
#include <ranges>
#include <string_view>

namespace views = std::views;

constexpr std::string_view text = "Lorem ipsum dolor sit amet, consectetur adipiscing elit.";

auto main() -> int {
    for (std::string_view&& word : text | views::split(' ')) {
        std::cout << word << '\n';
    }
} 
```

（[神螺栓链接](https://godbolt.org/z/64Gdjnb6x)）

* * *

## 回答 #44

> 赞同：3
> 
> 时间：2012-07-25T14:43:51.510

我使用以下代码：

```
namespace Core
{
    typedef std::wstring String;

    void SplitString(const Core::String& input, const Core::String& splitter, std::list<Core::String>& output)
    {
        if (splitter.empty())
        {
            throw std::invalid_argument(); // for example
        }

        std::list<Core::String> lines;

        Core::String::size_type offset = 0;

        for (;;)
        {
            Core::String::size_type splitterPos = input.find(splitter, offset);

            if (splitterPos != Core::String::npos)
            {
                lines.push_back(input.substr(offset, splitterPos - offset));
                offset = splitterPos + splitter.size();
            }
            else
            {
                lines.push_back(input.substr(offset));
                break;
            }
        }

        lines.swap(output);
    }
}

// gtest:

class SplitStringTest: public testing::Test
{
};

TEST_F(SplitStringTest, EmptyStringAndSplitter)
{
    std::list<Core::String> result;
    ASSERT_ANY_THROW(Core::SplitString(Core::String(), Core::String(), result));
}

TEST_F(SplitStringTest, NonEmptyStringAndEmptySplitter)
{
    std::list<Core::String> result;
    ASSERT_ANY_THROW(Core::SplitString(L"xy", Core::String(), result));
}

TEST_F(SplitStringTest, EmptyStringAndNonEmptySplitter)
{
    std::list<Core::String> result;
    Core::SplitString(Core::String(), Core::String(L","), result);
    ASSERT_EQ(1, result.size());
    ASSERT_EQ(Core::String(), *result.begin());
}

TEST_F(SplitStringTest, OneCharSplitter)
{
    std::list<Core::String> result;

    Core::SplitString(L"x,y", L",", result);
    ASSERT_EQ(2, result.size());
    ASSERT_EQ(L"x", *result.begin());
    ASSERT_EQ(L"y", *result.rbegin());

    Core::SplitString(L",xy", L",", result);
    ASSERT_EQ(2, result.size());
    ASSERT_EQ(Core::String(), *result.begin());
    ASSERT_EQ(L"xy", *result.rbegin());

    Core::SplitString(L"xy,", L",", result);
    ASSERT_EQ(2, result.size());
    ASSERT_EQ(L"xy", *result.begin());
    ASSERT_EQ(Core::String(), *result.rbegin());
}

TEST_F(SplitStringTest, TwoCharsSplitter)
{
    std::list<Core::String> result;

    Core::SplitString(L"x,.y,z", L",.", result);
    ASSERT_EQ(2, result.size());
    ASSERT_EQ(L"x", *result.begin());
    ASSERT_EQ(L"y,z", *result.rbegin());

    Core::SplitString(L"x,,y,z", L",,", result);
    ASSERT_EQ(2, result.size());
    ASSERT_EQ(L"x", *result.begin());
    ASSERT_EQ(L"y,z", *result.rbegin());
}

TEST_F(SplitStringTest, RecursiveSplitter)
{
    std::list<Core::String> result;

    Core::SplitString(L",,,", L",,", result);
    ASSERT_EQ(2, result.size());
    ASSERT_EQ(Core::String(), *result.begin());
    ASSERT_EQ(L",", *result.rbegin());

    Core::SplitString(L",.,.,", L",.,", result);
    ASSERT_EQ(2, result.size());
    ASSERT_EQ(Core::String(), *result.begin());
    ASSERT_EQ(L".,", *result.rbegin());

    Core::SplitString(L"x,.,.,y", L",.,", result);
    ASSERT_EQ(2, result.size());
    ASSERT_EQ(L"x", *result.begin());
    ASSERT_EQ(L".,y", *result.rbegin());

    Core::SplitString(L",.,,.,", L",.,", result);
    ASSERT_EQ(3, result.size());
    ASSERT_EQ(Core::String(), *result.begin());
    ASSERT_EQ(Core::String(), *(++result.begin()));
    ASSERT_EQ(Core::String(), *result.rbegin());
}

TEST_F(SplitStringTest, NullTerminators)
{
    std::list<Core::String> result;

    Core::SplitString(L"xy", Core::String(L"\0", 1), result);
    ASSERT_EQ(1, result.size());
    ASSERT_EQ(L"xy", *result.begin());

    Core::SplitString(Core::String(L"x\0y", 3), Core::String(L"\0", 1), result);
    ASSERT_EQ(2, result.size());
    ASSERT_EQ(L"x", *result.begin());
    ASSERT_EQ(L"y", *result.rbegin());
} 
```

* * *

## 回答 #45

> 赞同：3
> 
> 时间：2015-06-03T12:23:03.660

我们可以在 c++ 中使用 strtok ，

```
#include <iostream>
#include <cstring>
using namespace std;

int main()
{
    char str[]="Mickey M;12034;911416313;M;01a;9001;NULL;0;13;12;0;CPP,C;MSC,3D;FEND,BEND,SEC;";
    char *pch = strtok (str,";,");
    while (pch != NULL)
    {
        cout<<pch<<"\n";
        pch = strtok (NULL, ";,");
    }
    return 0;
} 
```

* * *

## 回答 #46

> 赞同：3
> 
> 时间：2016-09-05T16:10:15.747

这是我对这个问题的解决方案：

```
vector<string> get_tokens(string str) {
    vector<string> dt;
    stringstream ss;
    string tmp; 
    ss << str;
    for (size_t i; !ss.eof(); ++i) {
        ss >> tmp;
        dt.push_back(tmp);
    }
    return dt;
} 
```

该函数返回一个字符串向量。

* * *

## 回答 #47

> 赞同：3
> 
> 时间：2017-05-16T10:40:37.317

根据[Galik 的回答](https://stackoverflow.com/a/27125803/265521)，我做了这个。这主要是在这里，所以我不必一次又一次地写它。C++ 仍然没有本机拆分功能，这太疯狂了。特征：

*   应该非常快。
*   容易理解（我认为）。
*   合并空白部分。
*   使用多个分隔符很简单（例如`"\r\n"`）

```
#include <string>
#include <vector>
#include <algorithm>

std::vector<std::string> split(const std::string& s, const std::string& delims)
{
    using namespace std;

    vector<string> v;

    // Start of an element.
    size_t elemStart = 0;

    // We start searching from the end of the previous element, which
    // initially is the start of the string.
    size_t elemEnd = 0;

    // Find the first non-delim, i.e. the start of an element, after the end of the previous element.
    while((elemStart = s.find_first_not_of(delims, elemEnd)) != string::npos)
    {
        // Find the first delem, i.e. the end of the element (or if this fails it is the end of the string).
        elemEnd = s.find_first_of(delims, elemStart);
        // Add it.
        v.emplace_back(s, elemStart, elemEnd == string::npos ? string::npos : elemEnd - elemStart);
    }
    // When there are no more non-spaces, we are done.

    return v;
} 
```

* * *

## 回答 #48

> 赞同：2
> 
> 时间：2012-02-21T21:31:35.680

用作基类的快速版本`vector`，可以完全访问其所有运算符：

```
 // Split string into parts.
    class Split : public std::vector<std::string>
    {
        public:
            Split(const std::string& str, char* delimList)
            {
               size_t lastPos = 0;
               size_t pos = str.find_first_of(delimList);

               while (pos != std::string::npos)
               {
                    if (pos != lastPos)
                        push_back(str.substr(lastPos, pos-lastPos));
                    lastPos = pos + 1;
                    pos = str.find_first_of(delimList, lastPos);
               }
               if (lastPos < str.length())
                   push_back(str.substr(lastPos, pos-lastPos));
            }
    }; 
```

用于填充 STL 集的示例：

```
std::set<std::string> words;
Split split("Hello,World", ",");
words.insert(split.begin(), split.end()); 
```

* * *

## 回答 #49

> 赞同：2
> 
> 时间：2012-03-08T14:54:39.770

我使用以下

```
void split(string in, vector<string>& parts, char separator) {
    string::iterator  ts, curr;
    ts = curr = in.begin();
    for(; curr <= in.end(); curr++ ) {
        if( (curr == in.end() || *curr == separator) && curr > ts )
               parts.push_back( string( ts, curr ));
        if( curr == in.end() )
               break;
        if( *curr == separator ) ts = curr + 1; 
    }
} 
```

PlasmaHH，我忘记包含用于删除带有空格的标记的额外检查（curr > ts）。

* * *

## 回答 #50

> 赞同：2
> 
> 时间：2012-09-27T08:47:29.647

这是我编写的一个函数，可以帮助我做很多事情。它在为`WebSockets`.

```
using namespace std;
#include <iostream>
#include <vector>
#include <sstream>
#include <string>

vector<string> split ( string input , string split_id ) {
  vector<string> result;
  int i = 0;
  bool add;
  string temp;
  stringstream ss;
  size_t found;
  string real;
  int r = 0;
    while ( i != input.length() ) {
        add = false;
        ss << input.at(i);
        temp = ss.str();
        found = temp.find(split_id);
        if ( found != string::npos ) {
            add = true;
            real.append ( temp , 0 , found );
        } else if ( r > 0 &&  ( i+1 ) == input.length() ) {
            add = true;
            real.append ( temp , 0 , found );
        }
        if ( add ) {
            result.push_back(real);
            ss.str(string());
            ss.clear();
            temp.clear();
            real.clear();
            r = 0;
        }
        i++;
        r++;
    }
  return result;
}

int main() {
    string s = "S,o,m,e,w,h,e,r,e, down the road \n In a really big C++ house.  \n  Lives a little old lady.   \n   That no one ever knew.    \n    She comes outside.     \n     In the very hot sun.      \n\n\n\n\n\n\n\n   And throws C++ at us.    \n    The End.  FIN.";
    vector < string > Token;
    Token = split ( s , "," );
    for ( int i = 0 ; i < Token.size(); i++)    cout << Token.at(i) << endl;
    cout << endl << Token.size();
    int a;
    cin >> a;
    return a;
} 
```

* * *

## 回答 #51

> 赞同：2
> 
> 时间：2013-12-27T21:00:26.097

**LazyStringSplitter：**

```
#include <string>
#include <algorithm>
#include <unordered_set>

using namespace std;

class LazyStringSplitter
{
    string::const_iterator start, finish;
    unordered_set<char> chop;

public:

    // Empty Constructor
    explicit LazyStringSplitter()
    {}

    explicit LazyStringSplitter (const string cstr, const string delims)
        : start(cstr.begin())
        , finish(cstr.end())
        , chop(delims.begin(), delims.end())
    {}

    void operator () (const string cstr, const string delims)
    {
        chop.insert(delims.begin(), delims.end());
        start = cstr.begin();
        finish = cstr.end();
    }

    bool empty() const { return (start >= finish); }

    string next()
    {
        // return empty string
        // if ran out of characters
        if (empty())
            return string("");

        auto runner = find_if(start, finish, [&](char c) {
            return chop.count(c) == 1;
        });

        // construct next string
        string ret(start, runner);
        start = runner + 1;

        // Never return empty string
        // + tail recursion makes this method efficient
        return !ret.empty() ? ret : next();
    }
}; 
```

*   我称这种方法为`LazyStringSplitter`有一个原因 - 它不会一次性拆分字符串。
*   本质上它的行为就像一个 python 生成器
*   它公开了一个名为的方法，该方法`next`返回从原始字符串中拆分出来的下一个字符串
*   我使用了 c++11 STL 中的[unordered_set](http://en.cppreference.com/w/cpp/container/unordered_set)，因此查找分隔符的速度要快得多
*   这就是它的工作原理

**测试程序**

```
#include <iostream>
using namespace std;

int main()
{
    LazyStringSplitter splitter;

    // split at the characters ' ', '!', '.', ','
    splitter("This, is a string. And here is another string! Let's test and see how well this does.", " !.,");

    while (!splitter.empty())
        cout << splitter.next() << endl;
    return 0;
} 
```

**输出**

```
This
is
a
string
And
here
is
another
string
Let's
test
and
see
how
well
this
does 
```

下一个改进计划是实施`begin`和`end`方法，以便可以执行以下操作：

```
vector<string> split_string(splitter.begin(), splitter.end()); 
```

* * *

## 回答 #52

> 赞同：2
> 
> 时间：2014-03-17T16:39:15.087

我一直在寻找一种用任意长度的分隔符分割字符串的方法，所以我从头开始编写它，因为现有的解决方案不适合我。

这是我的小算法，仅使用 STL：

```
//use like this
//std::vector<std::wstring> vec = Split<std::wstring> (L"Hello##world##!", L"##");

template <typename valueType>
static std::vector <valueType> Split (valueType text, const valueType& delimiter)
{
    std::vector <valueType> tokens;
    size_t pos = 0;
    valueType token;

    while ((pos = text.find(delimiter)) != valueType::npos) 
    {
        token = text.substr(0, pos);
        tokens.push_back (token);
        text.erase(0, pos + delimiter.length());
    }
    tokens.push_back (text);

    return tokens;
} 
```

据我测试，它可以与任何长度和形式的分隔符一起使用。使用 string 或 wstring 类型实例化。

该算法所做的只是搜索定界符，获取到定界符的字符串部分，删除定界符并再次搜索，直到找不到为止。

当然，您可以使用任意数量的空格作为分隔符。

我希望它有所帮助。

* * *

## 回答 #53

> 赞同：2
> 
> 时间：2014-04-07T23:42:23.033

`std::string`没有 Boost，没有字符串流，只有标准 C 库与and协作`std::list`：便于分析的 C 库函数，便于内存管理的 C++ 数据类型。

空白被认为是换行符、制表符和空格的任意组合。空白字符集由`wschars`变量建立。

```
#include <string>
#include <list>
#include <iostream>
#include <cstring>

using namespace std;

const char *wschars = "\t\n ";

list<string> split(const string &str)
{
  const char *cstr = str.c_str();
  list<string> out;

  while (*cstr) {                     // while remaining string not empty
    size_t toklen;
    cstr += strspn(cstr, wschars);    // skip leading whitespace
    toklen = strcspn(cstr, wschars);  // figure out token length
    if (toklen)                       // if we have a token, add to list
      out.push_back(string(cstr, toklen));
    cstr += toklen;                   // skip over token
  }

  // ran out of string; return list

  return out;
}

int main(int argc, char **argv)
{
  list<string> li = split(argv[1]);
  for (list<string>::iterator i = li.begin(); i != li.end(); i++)
    cout << "{" << *i << "}" << endl;
  return 0;
} 
```

跑：

```
$ ./split ""
$ ./split "a"
{a}
$ ./split " a "
{a}
$ ./split " a b"
{a}
{b}
$ ./split " a b c"
{a}
{b}
{c}
$ ./split " a b c d  "
{a}
{b}
{c}
{d} 
```

尾递归版本`split`（本身分为两个函数）。除了将字符串推入列表之外，所有对变量的破坏性操作都消失了！

```
void split_rec(const char *cstr, list<string> &li)
{
  if (*cstr) {
    const size_t leadsp = strspn(cstr, wschars);
    const size_t toklen = strcspn(cstr + leadsp, wschars);

    if (toklen)
      li.push_back(string(cstr + leadsp, toklen));

    split_rec(cstr + leadsp + toklen, li);
  }
}

list<string> split(const string &str)
{
  list<string> out;
  split_rec(str.c_str(), out);
  return out;
} 
```

* * *

## 回答 #54

> 赞同：2
> 
> 时间：2014-08-19T12:23:12.020

这是我的版本

```
#include <vector>

inline std::vector<std::string> Split(const std::string &str, const std::string &delim = " ")
{
    std::vector<std::string> tokens;
    if (str.size() > 0)
    {
        if (delim.size() > 0)
        {
            std::string::size_type currPos = 0, prevPos = 0;
            while ((currPos = str.find(delim, prevPos)) != std::string::npos)
            {
                std::string item = str.substr(prevPos, currPos - prevPos);
                if (item.size() > 0)
                {
                    tokens.push_back(item);
                }
                prevPos = currPos + 1;
            }
            tokens.push_back(str.substr(prevPos));
        }
        else
        {
            tokens.push_back(str);
        }
    }
    return tokens;
} 
```

它适用于多字符分隔符。它可以防止空令牌进入您的结果。它使用单个标题。当您不提供分隔符时，它将字符串作为单个标记返回。如果字符串为空，它也会返回一个空结果。不幸的是，由于`std::vector`复制巨大，*除非*您使用 C++11 进行编译，否则效率低下，它应该使用移动原理图。在 C++11 中，这段代码应该很快。

* * *

## 回答 #55

> 赞同：2
> 
> 时间：2016-04-20T09:38:02.593

对于那些需要使用字符串分隔符分割字符串的替代方法的人，也许您可​​以尝试我的以下解决方案。

```
std::vector<size_t> str_pos(const std::string &search, const std::string &target)
{
    std::vector<size_t> founds;

    if(!search.empty())
    {
        size_t start_pos = 0;

        while (true)
        {
            size_t found_pos = target.find(search, start_pos);

            if(found_pos != std::string::npos)
            {
                size_t found = found_pos;

                founds.push_back(found);

                start_pos = (found_pos + 1);
            }
            else
            {
                break;
            }
        }
    }

    return founds;
}

std::string str_sub_index(size_t begin_index, size_t end_index, const std::string &target)
{
    std::string sub;

    size_t size = target.length();

    const char* copy = target.c_str();

    for(size_t i = begin_index; i <= end_index; i++)
    {
        if(i >= size)
        {
            break;
        }
        else
        {
            char c = copy[i];

            sub += c;
        }
    }

    return sub;
}

std::vector<std::string> str_split(const std::string &delimiter, const std::string &target)
{
    std::vector<std::string> splits;

    if(!delimiter.empty())
    {
        std::vector<size_t> founds = str_pos(delimiter, target);

        size_t founds_size = founds.size();

        if(founds_size > 0)
        {
            size_t search_len = delimiter.length();

            size_t begin_index = 0;

            for(int i = 0; i <= founds_size; i++)
            {
                std::string sub;

                if(i != founds_size)
                {
                    size_t pos  = founds.at(i);

                    sub = str_sub_index(begin_index, pos - 1, target);

                    begin_index = (pos + search_len);
                }
                else
                {
                    sub = str_sub_index(begin_index, (target.length() - 1), target);
                }

                splits.push_back(sub);
            }
        }
    }

    return splits;
} 
```

这些片段包含 3 个功能。坏消息是使用`str_split`您将需要其他两个功能的功能。是的，这是一大段代码。但好消息是这两个额外的功能能够独立工作，有时也很有用.. :)

像这样测试`main()`块中的功能：

```
int main()
{
    std::string s = "Hello, world! We need to make the world a better place. Because your world is also my world, and our children's world.";

    std::vector<std::string> split = str_split("world", s);

    for(int i = 0; i < split.size(); i++)
    {
        std::cout << split[i] << std::endl;
    }
} 
```

它会产生：

```
Hello, 
! We need to make the 
 a better place. Because your 
 is also my 
, and our children's 
. 
```

我相信这不是最有效的代码，但至少它有效。希望能帮助到你。

* * *

## 回答 #56

> 赞同：2
> 
> 时间：2016-09-10T17:07:56.290

这是我对此的看法。我必须逐字处理输入字符串，这可以通过使用空间来计算单词来完成，但我觉得这会很乏味，我应该将单词拆分为向量。

```
#include<iostream>
#include<vector>
#include<string>
#include<stdio.h>
using namespace std;
int main()
{
    char x = '\0';
    string s = "";
    vector<string> q;
    x = getchar();
    while(x != '\n')
    {
        if(x == ' ')
        {
            q.push_back(s);
            s = "";
            x = getchar();
            continue;
        }
        s = s + x;
        x = getchar();
    }
    q.push_back(s);
    for(int i = 0; i<q.size(); i++)
        cout<<q[i]<<" ";
    return 0;
} 
```

1.  不照顾多个空间。
2.  如果最后一个单词没有紧跟换行符，则它包括最后一个单词的最后一个字符和换行符之间的空格。

* * *

## 回答 #57

> 赞同：2
> 
> 时间：2017-05-31T20:34:44.127

是的，我浏览了所有 30 个示例。

我找不到`split`适用于多字符分隔符的版本，所以这是我的：

```
#include <string>
#include <vector>

using namespace std;

vector<string> split(const string &str, const string &delim)
{   
    const auto delim_pos = str.find(delim);

    if (delim_pos == string::npos)
        return {str};

    vector<string> ret{str.substr(0, delim_pos)};
    auto tail = split(str.substr(delim_pos + delim.size(), string::npos), delim);

    ret.insert(ret.end(), tail.begin(), tail.end());

    return ret;
} 
```

可能不是最有效的实现，但它是一个非常简单的递归解决方案，仅使用`<string>`and `<vector>`。

啊，它是用 C++11 编写的，但是这段代码没有什么特别之处，所以你可以很容易地把它改编成 C++98。

* * *

## 回答 #58

> 赞同：2
> 
> 时间：2022-02-21T14:26:57.607

我无法相信这些答案中的大多数都过于复杂。为什么没有人建议这么简单的事情？

```
#include <iostream>
#include <sstream>

std::string input = "This is a sentence to read";
std::istringstream ss(input);
std::string token;

while(std::getline(ss, token, ' ')) {
    std::cout << token << endl;
} 
```

* * *

## 回答 #59

> 赞同：1
> 
> 时间：2010-11-02T19:22:00.960

`getline`以 ' ' 作为标记循环。

* * *

## 回答 #60

> 赞同：1
> 
> 时间：2013-07-28T02:33:06.707

我相信还没有人发布这个解决方案。与直接使用分隔符不同，它与 boost::split() 的作用基本相同，即，它允许您传递一个谓词，如果 char 是分隔符则返回 true，否则返回 false。我认为这给了程序员更多的控制权，最棒的是你不需要提升。

```
template <class Container, class String, class Predicate>
void split(Container& output, const String& input,
           const Predicate& pred, bool trimEmpty = false) {
    auto it = begin(input);
    auto itLast = it;
    while (it = find_if(it, end(input), pred), it != end(input)) {
        if (not (trimEmpty and it == itLast)) {
            output.emplace_back(itLast, it);
        }
        ++it;
        itLast = it;
    }
} 
```

然后你可以像这样使用它：

```
struct Delim {
    bool operator()(char c) {
        return not isalpha(c);
    }
};    

int main() {
    string s("#include<iostream>\n"
             "int main() { std::cout << \"Hello world!\" << std::endl; }");

    vector<string> v;

    split(v, s, Delim(), true);
    /* Which is also the same as */
    split(v, s, [](char c) { return not isalpha(c); }, true);

    for (const auto& i : v) {
        cout << i << endl;
    }
} 
```

* * *

## 回答 #61

> 赞同：1
> 
> 时间：2013-08-04T03:37:31.383

我刚刚写了一个很好的例子，说明如何按符号拆分字符，然后将每个字符数组（由符号分隔的单词）放入一个向量中。为简单起见，我制作了标准字符串的向量类型。

我希望这对您有所帮助并且可以阅读。

```
#include <vector>
#include <string>
#include <iostream>

void push(std::vector<std::string> &WORDS, std::string &TMP){
    WORDS.push_back(TMP);
    TMP = "";
}
std::vector<std::string> mySplit(char STRING[]){
        std::vector<std::string> words;
        std::string s;
        for(unsigned short i = 0; i < strlen(STRING); i++){
            if(STRING[i] != ' '){
                s += STRING[i];
            }else{
                push(words, s);
            }
        }
        push(words, s);//Used to get last split
        return words;
}

int main(){
    char string[] = "My awesome string.";
    std::cout << mySplit(string)[2];
    std::cin.get();
    return 0;
} 
```

* * *

## 回答 #62

> 赞同：1
> 
> 时间：2014-07-25T21:40:00.557

```
// adapted from a "regular" csv parse
std::string stringIn = "my csv  is 10233478 NOTseparated by commas";
std::vector<std::string> commaSeparated(1);
int commaCounter = 0;
for (int i=0; i<stringIn.size(); i++) {
    if (stringIn[i] == " ") {
        commaSeparated.push_back("");
        commaCounter++;
    } else {
        commaSeparated.at(commaCounter) += stringIn[i];
    }
} 
```

最后，您将拥有一个字符串向量，句子中的每个元素都用空格分隔。只有非标准资源是 std::vector （但由于涉及 std::string，我认为它是可以接受的）。

空字符串保存为单独的项目。

* * *

## 回答 #63

> 赞同：1
> 
> 时间：2015-10-03T08:06:45.917

这是我的条目：

```
template <typename Container, typename InputIter, typename ForwardIter>
Container
split(InputIter first, InputIter last,
      ForwardIter s_first, ForwardIter s_last)
{
    Container output;

    while (true) {
        auto pos = std::find_first_of(first, last, s_first, s_last);
        output.emplace_back(first, pos);
        if (pos == last) {
            break;
        }

        first = ++pos;
    }

    return output;
}

template <typename Output = std::vector<std::string>,
          typename Input = std::string,
          typename Delims = std::string>
Output
split(const Input& input, const Delims& delims = " ")
{
    using std::cbegin;
    using std::cend;
    return split<Output>(cbegin(input), cend(input),
                         cbegin(delims), cend(delims));
}

auto vec = split("Mary had a little lamb"); 
```

第一个定义是采用两对迭代器的 STL 风格的泛型函数。第二个是一个方便的功能，让你不必自己做所有`begin()`的`end()`事情。例如，如果您想使用 a `list`，也可以将输出容器类型指定为模板参数。

使它优雅（IMO）的原因在于，与大多数其他答案不同，它不限于字符串，而是适用于任何与 STL 兼容的容器。无需对上面的代码进行任何更改，您可以说：

```
using vec_of_vecs_t = std::vector<std::vector<int>>;

std::vector<int> v{1, 2, 0, 3, 4, 5, 0, 7, 8, 0, 9};
auto r = split<vec_of_vecs_t>(v, std::initializer_list<int>{0, 2}); 
```

`v`每次遇到 a`0`或 a时，都会将向量拆分为单独的向量`2`。

（还有一个额外的好处是使用字符串，这个实现比基于`strtok()`- 和 -`getline()`的版本都快，至少在我的系统上是这样。）

* * *

## 回答 #64

> 赞同：1
> 
> 时间：2016-01-10T08:30:43.753

```
#include <iostream>
#include <vector>
using namespace std;

int main() {
  string str = "ABC AABCD CDDD RABC GHTTYU FR";
  str += " "; //dirty hack: adding extra space to the end
  vector<string> v;

  for (int i=0; i<(int)str.size(); i++) {
    int a, b;
    a = i;

    for (int j=i; j<(int)str.size(); j++) {
      if (str[j] == ' ') {
        b = j;
        i = j;
        break;
      }
    }
    v.push_back(str.substr(a, b-a));
  }

  for (int i=0; i<v.size(); i++) {
    cout<<v[i].size()<<" "<<v[i]<<endl;
  }
  return 0;
} 
```

* * *

## 回答 #65

> 赞同：1
> 
> 时间：2016-01-10T12:38:50.290

只是为了方便：

```
template<class V, typename T>
bool in(const V &v, const T &el) {
    return std::find(v.begin(), v.end(), el) != v.end();
} 
```

基于多个分隔符的实际拆分：

```
std::vector<std::string> split(const std::string &s,
                               const std::vector<char> &delims) {
    std::vector<std::string> res;
    auto stuff = [&delims](char c) { return !in(delims, c); };
    auto space = [&delims](char c) { return in(delims, c); };
    auto first = std::find_if(s.begin(), s.end(), stuff);
    while (first != s.end()) {
        auto last = std::find_if(first, s.end(), space);
        res.push_back(std::string(first, last));
        first = std::find_if(last + 1, s.end(), stuff);
    }
    return res;
} 
```

用法：

```
int main() {
    std::string s = "   aaa,  bb  cc ";
    for (auto el: split(s, {' ', ','}))
        std::cout << el << std::endl;
    return 0;
} 
```

* * *

## 回答 #66

> 赞同：1
> 
> 时间：2019-01-16T15:14:15.603

我有一种与其他解决方案非常不同的方法，它提供了很多其他解决方案所缺乏的价值，但当然也有其自身的缺点。[这](https://repl.it/repls/FirmPapayawhipArtificialintelligence)是工作实现，以放置`<tag></tag>`单词为例。

首先，这个问题可以通过一个循环来解决，不需要额外的内存，并且只考虑四种逻辑情况。从概念上讲，我们对边界感兴趣。我们的代码应该反映这一点：让我们遍历字符串并一次查看两个字符，记住我们在字符串的开头和结尾有特殊情况。

缺点是我们必须编写实现，这有点冗长，但主要是方便的样板文件。

好处是我们编写了实现，因此很容易根据特定需求对其进行自定义，例如区分左和写字边界，使用任何一组分隔符，或处理其他情况，例如无边界或错误位置。

```
using namespace std;

#include <iostream>
#include <string>

#include <cctype>

typedef enum boundary_type_e {
    E_BOUNDARY_TYPE_ERROR = -1,
    E_BOUNDARY_TYPE_NONE,
    E_BOUNDARY_TYPE_LEFT,
    E_BOUNDARY_TYPE_RIGHT,
} boundary_type_t;

typedef struct boundary_s {
    boundary_type_t type;
    int pos;
} boundary_t;

bool is_delim_char(int c) {
    return isspace(c); // also compare against any other chars you want to use as delimiters
}

bool is_word_char(int c) {
    return ' ' <= c && c <= '~' && !is_delim_char(c);
}

boundary_t maybe_word_boundary(string str, int pos) {
    int len = str.length();
    if (pos < 0 || pos >= len) {
        return (boundary_t){.type = E_BOUNDARY_TYPE_ERROR};
    } else {
        if (pos == 0 && is_word_char(str[pos])) {
            // if the first character is word-y, we have a left boundary at the beginning
            return (boundary_t){.type = E_BOUNDARY_TYPE_LEFT, .pos = pos};
        } else if (pos == len - 1 && is_word_char(str[pos])) {
            // if the last character is word-y, we have a right boundary left of the null terminator
            return (boundary_t){.type = E_BOUNDARY_TYPE_RIGHT, .pos = pos + 1};
        } else if (!is_word_char(str[pos]) && is_word_char(str[pos + 1])) {
            // if we have a delimiter followed by a word char, we have a left boundary left of the word char
            return (boundary_t){.type = E_BOUNDARY_TYPE_LEFT, .pos = pos + 1};
        } else if (is_word_char(str[pos]) && !is_word_char(str[pos + 1])) {
            // if we have a word char followed by a delimiter, we have a right boundary right of the word char
            return (boundary_t){.type = E_BOUNDARY_TYPE_RIGHT, .pos = pos + 1};
        }
        return (boundary_t){.type = E_BOUNDARY_TYPE_NONE};
    }
}

int main() {
    string str;
    getline(cin, str);

    int len = str.length();
    for (int i = 0; i < len; i++) {
        boundary_t boundary = maybe_word_boundary(str, i);
        if (boundary.type == E_BOUNDARY_TYPE_LEFT) {
            // whatever
        } else if (boundary.type == E_BOUNDARY_TYPE_RIGHT) {
            // whatever
        }
    }
} 
```

可以看到，代码很容易理解和微调，代码的实际使用也很简短。使用 C++ 不应该阻止我们编写最简单和最容易定制的代码，即使这意味着不使用 STL。我认为这是 Linus Torvalds 可能称之为[“品味”](https://medium.com/@bartobri/applying-the-linus-tarvolds-good-taste-coding-requirement-99749f37684a)的一个例子，因为我们已经消除了所有我们不需要的逻辑，同时以一种自然允许在需要处理它们时处理更多案例的风格来处理它们出现。

可以改进此代码的可能是使用`enum class`，接受指向`is_word_char`in的函数指针`maybe_word_boundary`而不是直接调用`is_word_char`，并传递 lambda。

* * *

## 回答 #67

> 赞同：1
> 
> 时间：2020-03-18T02:12:56.363

没有任何内存分配的 C++17 版本（可能是 for 除外`std::function`）

```
void iter_words(const std::string_view& input, const std::function<void(std::string_view)>& process_word) {

    auto itr = input.begin();

    auto consume_whitespace = [&]() {
        for(; itr != input.end(); ++itr) {
            if(!isspace(*itr))
                return;
        }
    };

    auto consume_letters = [&]() {
        for(; itr != input.end(); ++itr) {
            if(isspace(*itr))
                return;
        }
    };

    while(true) {
        consume_whitespace();
        if(itr == input.end())
            return;
        auto word_start = itr - input.begin();
        consume_letters();
        auto word_end = itr - input.begin();
        process_word(input.substr(word_start, word_end - word_start));
    }
}

int main() {
    iter_words("foo bar", [](std::string_view sv) {
        std::cout << "Got word: " <<  sv << '\n';
    });
    return 0;
} 
```

* * *

## 回答 #68

> 赞同：1
> 
> 时间：2021-10-22T12:15:34.773

一个最小的解决方案是一个函数，它将 a`std::string`和一组分隔符（作为 a `std::string`）作为输入，并返回 a `std::vector`of `std::strings`。

```
#include <string>
#include <vector>

std::vector<std::string>
tokenize(const std::string& str, const std::string& delimiters)
{
  using ssize_t = std::string::size_type;
  const ssize_t str_ln = str.length();
  ssize_t last_pos = 0;

  // container for the extracted tokens
  std::vector<std::string> tokens;

  while (last_pos < str_ln) {
      // find the position of the next delimiter
      ssize_t pos = str.find_first_of(delimiters, last_pos);

      // if no delimiters found, set the position to the length of string
      if (pos == std::string::npos)
         pos = str_ln;

      // if the substring is nonempty, store it in the container
      if (pos != last_pos)
         tokens.emplace_back(str.substr(last_pos, pos - last_pos));

      // scan past the previous substring
      last_pos = pos + 1;
  }

  return tokens;
} 
```

一个使用示例：

```
#include <iostream>

int main()
{
    std::string input_str = "one + two * (three - four)!!---! ";
    const char* delimiters = "! +- (*)";
    std::vector<std::string> tokens = tokenize(input_str, delimiters);

    std::cout << "input = '" << input_str << "'\n"
              << "delimiters = '" << delimiters << "'\n"
              << "nr of tokens found = " << tokens.size() << std::endl;
    for (const std::string& tk : tokens) {
        std::cout << "token = '" << tk << "'\n";
    }

  return 0;
} 
```

* * *

## 回答 #69

> 赞同：0
> 
> 时间：2012-03-13T16:35:20.573

**我的代码是：**

```
#include <list>
#include <string>
template<class StringType = std::string, class ContainerType = std::list<StringType> >
class DSplitString:public ContainerType
{
public:
    explicit DSplitString(const StringType& strString, char cChar, bool bSkipEmptyParts = true)
    {
        size_t iPos = 0;
        size_t iPos_char = 0;
        while(StringType::npos != (iPos_char = strString.find(cChar, iPos)))
        {
            StringType strTemp = strString.substr(iPos, iPos_char - iPos);
            if((bSkipEmptyParts && !strTemp.empty()) || (!bSkipEmptyParts))
                push_back(strTemp);
            iPos = iPos_char + 1;
        }
    }
    explicit DSplitString(const StringType& strString, const StringType& strSub, bool bSkipEmptyParts = true)
    {
        size_t iPos = 0;
        size_t iPos_char = 0;
        while(StringType::npos != (iPos_char = strString.find(strSub, iPos)))
        {
            StringType strTemp = strString.substr(iPos, iPos_char - iPos);
            if((bSkipEmptyParts && !strTemp.empty()) || (!bSkipEmptyParts))
                push_back(strTemp);
            iPos = iPos_char + strSub.length();
        }
    }
}; 
```

**例子：**

```
#include <iostream>
#include <string>
int _tmain(int argc, _TCHAR* argv[])
{
    DSplitString<> aa("doicanhden1;doicanhden2;doicanhden3;", ';');
    for each (std::string var in aa)
    {
        std::cout << var << std::endl;
    }
    std::cin.get();
    return 0;
} 
```

* * *

## 回答 #70

> 赞同：0
> 
> 时间：2013-08-09T16:36:11.100

我的实现可以是另一种解决方案：

```
std::vector<std::wstring> SplitString(const std::wstring & String, const std::wstring & Seperator)
{
    std::vector<std::wstring> Lines;
    size_t stSearchPos = 0;
    size_t stFoundPos;
    while (stSearchPos < String.size() - 1)
    {
        stFoundPos = String.find(Seperator, stSearchPos);
        stFoundPos = (stFoundPos == std::string::npos) ? String.size() : stFoundPos;
        Lines.push_back(String.substr(stSearchPos, stFoundPos - stSearchPos));
        stSearchPos = stFoundPos + Seperator.size();
    }
    return Lines;
} 
```

测试代码：

```
std::wstring MyString(L"Part 1SEPsecond partSEPlast partSEPend");
std::vector<std::wstring> Parts = IniFile::SplitString(MyString, L"SEP");
std::wcout << L"The string: " << MyString << std::endl;
for (std::vector<std::wstring>::const_iterator it=Parts.begin(); it<Parts.end(); ++it)
{
    std::wcout << *it << L"<---" << std::endl;
}
std::wcout << std::endl;
MyString = L"this,time,a,comma separated,string";
std::wcout << L"The string: " << MyString << std::endl;
Parts = IniFile::SplitString(MyString, L",");
for (std::vector<std::wstring>::const_iterator it=Parts.begin(); it<Parts.end(); ++it)
{
    std::wcout << *it << L"<---" << std::endl;
} 
```

测试代码的输出：

```
The string: Part 1SEPsecond partSEPlast partSEPend
Part 1<---
second part<---
last part<---
end<---

The string: this,time,a,comma separated,string
this<---
time<---
a<---
comma separated<---
string<--- 
```

* * *

## 回答 #71

> 赞同：0
> 
> 时间：2014-12-16T19:23:30.787

我知道在这里聚会很晚，但我正在考虑最优雅的方法，如果给你一系列分隔符而不是空格，并且只使用标准库。

以下是我的想法：

通过一系列分隔符将单词拆分为字符串向量：

```
template<class Container>
std::vector<std::string> split_by_delimiters(const std::string& input, const Container& delimiters)
{
    std::vector<std::string> result;

    for (auto current = begin(input) ; current != end(input) ; )
    {
        auto first = find_if(current, end(input), not_in(delimiters));
        if (first == end(input)) break;
        auto last = find_if(first, end(input), is_in(delimiters));
        result.emplace_back(first, last);
        current = last;
    }
    return result;
} 
```

通过提供一系列有效字符来拆分另一种方式：

```
template<class Container>
std::vector<std::string> split_by_valid_chars(const std::string& input, const Container& valid_chars)
{
    std::vector<std::string> result;

    for (auto current = begin(input) ; current != end(input) ; )
    {
        auto first = find_if(current, end(input), is_in(valid_chars));
        if (first == end(input)) break;
        auto last = find_if(first, end(input), not_in(valid_chars));
        result.emplace_back(first, last);
        current = last;
    }
    return result;
} 
```

is_in 和 not_in 是这样定义的：

```
namespace detail {
    template<class Container>
    struct is_in {
        is_in(const Container& charset)
        : _charset(charset)
        {}

        bool operator()(char c) const
        {
            return find(begin(_charset), end(_charset), c) != end(_charset);
        }

        const Container& _charset;
    };

    template<class Container>
    struct not_in {
        not_in(const Container& charset)
        : _charset(charset)
        {}

        bool operator()(char c) const
        {
            return find(begin(_charset), end(_charset), c) == end(_charset);
        }

        const Container& _charset;
    };

}

template<class Container>
detail::not_in<Container> not_in(const Container& c)
{
    return detail::not_in<Container>(c);
}

template<class Container>
detail::is_in<Container> is_in(const Container& c)
{
    return detail::is_in<Container>(c);
} 
```

* * *

## 回答 #72

> 赞同：0
> 
> 时间：2015-03-12T10:25:02.403

谢谢@Jairo Abdiel Toribio Cisneros。它对我有用，但你的函数返回一些空元素。因此，对于没有空的返回，我编辑了以下内容：

```
std::vector<std::string> split(std::string str, const char* delim) {
    std::vector<std::string> v;
    std::string tmp;

    for(std::string::const_iterator i = str.begin(); i <= str.end(); ++i) {
        if(*i != *delim && i != str.end()) {
            tmp += *i;
        } else {
            if (tmp.length() > 0) {
                v.push_back(tmp);
            }
            tmp = "";
        }
    }

    return v;
} 
```

使用：

```
std::string s = "one:two::three";
std::string delim = ":";
std::vector<std::string> vv = split(s, delim.c_str()); 
```

* * *

## 回答 #73

> 赞同：0
> 
> 时间：2015-10-22T17:57:40.050

如果你想用一些字符分割字符串，你可以使用

```
#include<iostream>
#include<string>
#include<vector>
#include<iterator>
#include<sstream>
#include<string>

using namespace std;
void replaceOtherChars(string &input, vector<char> &dividers)
{
    const char divider = dividers.at(0);
    int replaceIndex = 0;
    vector<char>::iterator it_begin = dividers.begin()+1,
        it_end= dividers.end();
    for(;it_begin!=it_end;++it_begin)
    {
        replaceIndex = 0;
        while(true)
        {
            replaceIndex=input.find_first_of(*it_begin,replaceIndex);
            if(replaceIndex==-1)
                break;
            input.at(replaceIndex)=divider;
        }
    }
}
vector<string> split(string str, vector<char> chars, bool missEmptySpace =true )
{
    vector<string> result;
    const char divider = chars.at(0);
    replaceOtherChars(str,chars);
    stringstream stream;
    stream<<str;    
    string temp;
    while(getline(stream,temp,divider))
    {
        if(missEmptySpace && temp.empty())
            continue;
        result.push_back(temp);
    }
    return result;
}
int main()
{
    string str ="milk, pigs.... hot-dogs ";
    vector<char> arr;
    arr.push_back(' '); arr.push_back(','); arr.push_back('.');
    vector<string> result = split(str,arr);
    vector<string>::iterator it_begin= result.begin(),
        it_end= result.end();
    for(;it_begin!=it_end;++it_begin)
    {
        cout<<*it_begin<<endl;
    }
return 0;
} 
```

* * *

## 回答 #74

> 赞同：0
> 
> 时间：2015-10-29T01:45:37.623

这是最佳答案之一的扩展。它现在支持设置返回元素的最大数量 N。字符串的最后一位将在第 N 个元素中结束。MAXELEMENTS 参数是可选的，如果设置为默认值 0，它将返回*无限*数量的元素。:-)

。H：

```
class Myneatclass {
public:
    static std::vector<std::string>& split(const std::string &s, char delim, std::vector<std::string> &elems, const size_t MAXELEMENTS = 0);
    static std::vector<std::string> split(const std::string &s, char delim, const size_t MAXELEMENTS = 0);
}; 
```

.cpp：

```
std::vector<std::string>& Myneatclass::split(const std::string &s, char delim, std::vector<std::string> &elems, const size_t MAXELEMENTS) {
    std::stringstream ss(s);
    std::string item;
    while (std::getline(ss, item, delim)) {
        elems.push_back(item);
        if (MAXELEMENTS > 0 && !ss.eof() && elems.size() + 1 >= MAXELEMENTS) {
            std::getline(ss, item);
            elems.push_back(item);
            break;
        }
    }
    return elems;
}
std::vector<std::string> Myneatclass::split(const std::string &s, char delim, const size_t MAXELEMENTS) {
    std::vector<std::string> elems;
    split(s, delim, elems, MAXELEMENTS);
    return elems;
} 
```

* * *

## 回答 #75

> 赞同：0
> 
> 时间：2017-05-29T15:49:56.527

`string`我对and `u32string`~的一般实现，使用`boost::algorithm::split`签名。

```
template<typename CharT, typename UnaryPredicate>
void split(std::vector<std::basic_string<CharT>>& split_result,
           const std::basic_string<CharT>& s,
           UnaryPredicate predicate)
{
    using ST = std::basic_string<CharT>;
    using std::swap;
    std::vector<ST> tmp_result;
    auto iter = s.cbegin(),
         end_iter = s.cend();
    while (true)
    {
        /**
         * edge case: empty str -> push an empty str and exit.
         */
        auto find_iter = find_if(iter, end_iter, predicate);
        tmp_result.emplace_back(iter, find_iter);
        if (find_iter == end_iter) { break; }
        iter = ++find_iter; 
    }
    swap(tmp_result, split_result);
}

template<typename CharT>
void split(std::vector<std::basic_string<CharT>>& split_result,
           const std::basic_string<CharT>& s,
           const std::basic_string<CharT>& char_candidate)
{
    std::unordered_set<CharT> candidate_set(char_candidate.cbegin(),
                                            char_candidate.cend());
    auto predicate = [&candidate_set](const CharT& c) {
        return candidate_set.count(c) > 0U;
    };
    return split(split_result, s, predicate);
}

template<typename CharT>
void split(std::vector<std::basic_string<CharT>>& split_result,
           const std::basic_string<CharT>& s,
           const CharT* literals)
{
    return split(split_result, s, std::basic_string<CharT>(literals));
} 
```

* * *

## 回答 #76

> 赞同：0
> 
> 时间：2017-11-24T12:21:27.053

```
#include <iostream>
#include <string>
#include <deque>

std::deque<std::string> split(
    const std::string& line, 
    std::string::value_type delimiter,
    bool skipEmpty = false
) {
    std::deque<std::string> parts{};

    if (!skipEmpty && !line.empty() && delimiter == line.at(0)) {
        parts.push_back({});
    }

    for (const std::string::value_type& c : line) {
        if (
            (
                c == delimiter 
                &&
                (skipEmpty ? (!parts.empty() && !parts.back().empty()) : true)
            )
            ||
            (c != delimiter && parts.empty())
        ) {
            parts.push_back({});
        }

        if (c != delimiter) {
            parts.back().push_back(c);
        }
    }

    if (skipEmpty && !parts.empty() && parts.back().empty()) {
        parts.pop_back();
    }

    return parts;
}

void test(const std::string& line) {
    std::cout << line << std::endl;

    std::cout << "skipEmpty=0 |";
    for (const std::string& part : split(line, ':')) {
        std::cout << part << '|';
    }
    std::cout << std::endl;

    std::cout << "skipEmpty=1 |";
    for (const std::string& part : split(line, ':', true)) {
        std::cout << part << '|';
    }
    std::cout << std::endl;

    std::cout << std::endl;
}

int main() {
    test("foo:bar:::baz");
    test("");
    test("foo");
    test(":");
    test("::");
    test(":foo");
    test("::foo");
    test(":foo:");
    test(":foo::");

    return 0;
} 
```

输出：

```
foo:bar:::baz
skipEmpty=0 |foo|bar|||baz|
skipEmpty=1 |foo|bar|baz|

skipEmpty=0 |
skipEmpty=1 |

foo
skipEmpty=0 |foo|
skipEmpty=1 |foo|

:
skipEmpty=0 |||
skipEmpty=1 |

::
skipEmpty=0 ||||
skipEmpty=1 |

:foo
skipEmpty=0 ||foo|
skipEmpty=1 |foo|

::foo
skipEmpty=0 |||foo|
skipEmpty=1 |foo|

:foo:
skipEmpty=0 ||foo||
skipEmpty=1 |foo|

:foo::
skipEmpty=0 ||foo|||
skipEmpty=1 |foo| 
```

* * *

## 回答 #77

> 赞同：0
> 
> 时间：2021-09-16T14:33:37.480

有一种更简单的方法可以做到这一点！

```
#include <vector>
#include <string>
std::vector<std::string> splitby(std::string string, char splitter) {
    int splits = 0;
    std::vector<std::string> result = {};
    std::string locresult = "";
    for (unsigned int i = 0; i < string.size(); i++) {
        if ((char)string.at(i) != splitter) {
            locresult += string.at(i);
        }
        else {
            result.push_back(locresult);
            locresult = "";
        }
    }
    if (splits == 0) {
        result.push_back(locresult);
    }
    return result;
}

void printvector(std::vector<std::string> v) {
    std::cout << '{';
    for (unsigned int i = 0; i < v.size(); i++) {
        if (i < v.size() - 1) {
            std::cout << '"' << v.at(i) << "\",";
        }
        else {
            std::cout << '"' << v.at(i) << "\"";
        }
    }
    std::cout << "}\n";
} 
```

* * *

## 回答 #78

> 赞同：-1
> 
> 时间：2014-05-21T07:31:01.263

这是我的方法，切分：

```
string cut (string& str, const string& del)
{
    string f = str;

    if (in.find_first_of(del) != string::npos)
    {
        f = str.substr(0,str.find_first_of(del));
        str = str.substr(str.find_first_of(del)+del.length());
    }

    return f;
}

vector<string> split (const string& in, const string& del=" ")
{
    vector<string> out();
    string t = in;

    while (t.length() > del.length())
        out.push_back(cut(t,del));

    return out;
} 
```

顺便说一句，如果我能做些什么来优化这个..

* * *

## 回答 #79

> 赞同：-1
> 
> 时间：2017-06-27T08:57:55.123

并不是说我们需要更多答案，但这是我在受到 Evan Teran 的启发后想出的。

```
std::vector <std::string> split(const string &input, auto delimiter, bool skipEmpty=true) {
  /*
  Splits a string at each delimiter and returns these strings as a string vector.
  If the delimiter is not found then nothing is returned.
  If skipEmpty is true then strings between delimiters that are 0 in length will be skipped.
  */
  bool delimiterFound = false;
  int pos=0, pPos=0;
  std::vector <std::string> result;
  while (true) {
    pos = input.find(delimiter,pPos);
    if (pos != std::string::npos) {
      if (skipEmpty==false or pos-pPos > 0) // if empty values are to be kept or not
        result.push_back(input.substr(pPos,pos-pPos));
      delimiterFound = true;
    } else {
      if (pPos < input.length() and delimiterFound) {
        if (skipEmpty==false or input.length()-pPos > 0) // if empty values are to be kept or not
          result.push_back(input.substr(pPos,input.length()-pPos));
      }
      break;
    }
    pPos = pos+1;
  }
  return result;
} 
```

* * *

## 回答 #80

> 赞同：-3
> 
> 时间：2015-07-01T19:33:04.850

```
#include <iostream>
#include <string>
#include <sstream>
#include <algorithm>
#include <iterator>
#include <vector>

int main() {
    using namespace std;
   int n=8;
    string sentence = "10 20 30 40 5 6 7 8";
    istringstream iss(sentence);

  vector<string> tokens;
copy(istream_iterator<string>(iss),
     istream_iterator<string>(),
     back_inserter(tokens));

     for(int i=0;i<n;i++){
        cout<<tokens.at(i);
     }

} 
```

* * *

## 回答 #81

> 赞同：-5
> 
> 时间：2012-12-04T22:53:25.563

```
void splitString(string str, char delim, string array[], const int arraySize)
{
    int delimPosition, subStrSize, subStrStart = 0;

    for (int index = 0; delimPosition != -1; index++)
    {
        delimPosition = str.find(delim, subStrStart);
        subStrSize = delimPosition - subStrStart;
        array[index] = str.substr(subStrStart, subStrSize);
        subStrStart =+ (delimPosition + 1);
    }
} 
```

* * *

## 回答 #82

> 赞同：-10
> 
> 时间：2008-10-25T09:34:36.353

对于一个大得离谱且可能冗余的版本，请尝试大量的 for 循环。

```
string stringlist[10];
int count = 0;

for (int i = 0; i < sequence.length(); i++)
{
    if (sequence[i] == ' ')
    {
        stringlist[count] = sequence.substr(0, i);
        sequence.erase(0, i+1);
        i = 0;
        count++;
    }
    else if (i == sequence.length()-1)  // Last word
    {
        stringlist[count] = sequence.substr(0, i+1);
    }
} 
```

它不漂亮，但总的来说（除非标点符号和许多其他错误）它有效！

# ruby-on-rails - 雪貂在铁轨上出现“无法将数组添加到 BooleanQuery”错误

> ID：236133
> 
> 赞同：0
> 
> 时间：2008-10-25T09:00:37.077
> 
> 标签：ruby-on-rails, ruby, ferret

我正在尝试在我的 RoR 网站上使用一个简单的搜索表单。我有以下代码：

（在 note_controller.rb 中）

```
 def search
    @results = Note.find_with_ferret(params[:term]).sort_by(&:ferret_rank)

    respond_to do |format|
      format.html
      format.xml { render :xml => @nootes }
    end
  end 
```

（在 note.rb 中）

```
class Note < ActiveRecord::Base
  acts_as_ferret :fields => [ :title, :body ]
end 
```

（在 index.html.erb 中）

```
<%= form_tag :action => 'search'%>
<%= text_field 'term', nil  %>
  <%= submit_tag 'Search' %>
</form> 
```

（在 search.html.erb 中）

```
<h1><%= pluralize(@results.size, 'result') %></h1>

<ul>
<% for result in @results %>
  <li><%= result.ferret_score %>: <%= link_to result.tile, result %></li>
<% end %>
</ul> 
```

正如您希望从上面看到的那样，我有一个模型，我已经告诉acts_as_ferret。然后，我的控制器中有一个搜索操作，它尝试呈现到 search.html.erb 视图。我在索引视图中有一个用于搜索的表单。但是，当我运行它时，我收到以下错误：

> 无法将数组添加到 BooleanQuery

我想我的表格做错了，所以雪貂以某种方式获取了错误的数据。我所做的 form_tag 事情是正确的吗？任何帮助将非常感激。

**更新：**

以下是我似乎可以从日志中提取的唯一一点。我正在使用 Heroku，它似乎并没有给出标准的日志文件。希望这会有所帮助。

```
Processing NotesController#search (for 152.78.202.74, 127.0.0.1 at 2008-10-25 07:32:23)
[POST] Session ID: BAh7BzoMY3NyZl9pZCIlZmEyMzcxZTdlYTUyODRkNzlmMzdjZWJlOGNlOGYz M2UiCmZsYXNoSUM6J0FjdGlvbkNvbnRyb2xsZXI6OkZsYXNoOjpGbGFzaEhh c2h7AAY6CkB1c2VkewA=--450f51b45e38cba302e8ac6bd9b03c7ae79981e9
Parameters: {"commit"=>"Search", "term"=>["wheelbarrow"], "authenticity_token"=>"1879a835ded87e7a28861725ec668b690de6b7f5", "action"=>"search", "controller"=>"notes"}
configured index for class Note: {
    :index_dir=>"/mnt/home/userapps/38385/index/development/note",
    :mysql_fast_batches=>true, :name=>:note, :single_index=>false,
    :index_base_dir=>"/mnt/home/userapps/38385/index/development/note",
    :reindex_batch_size=>1000,
    :registered_models=>[Note(id: integer, title: string, body: text, created_at: datetime, updated_at: datetime)],
    :ferret=>{:dir=>#,
    :key=>[:id, :class_name],
    :or_default=>false,
    :handle_parse_errors=>true,
    :auto_flush=>true,
    :create_if_missing=>true,
    :path=>"/mnt/home/userapps/38385/index/development/note",
    :default_field=>[:title, :body],
    :analyzer=>#,
    :lock_retry_time=>2},
    :ferret_fields=>{:title=>{:via=>:title, :term_vector=>:with_positions_offsets, :boost=>1.0, :store=>:no, :highlight=>:yes, :index=>:yes},
    :body=>{:via=>:body, :term_vector=>:with_positions_offsets, :boost=>1.0, :store=>:no, :highlight=>:yes, :index=>:yes}},
    :fields=>[:title, :body],
    :raise_drb_errors=>false,
    :user_default_field=>nil,
    :enabled=>true}

ArgumentError (Cannot add Array to a BooleanQuery): /vendor/plugins/acts_as_ferret/lib/ferret_find_methods.rb:124:in `add_query'
    /vendor/plugins/acts_as_ferret/lib/ferret_find_methods.rb:124:in `scope_query_to_models'
    /vendor/plugins/acts_as_ferret/lib/ferret_find_methods.rb:102:in `find_ids'
    /vendor/plugins/acts_as_ferret/lib/ferret_find_methods.rb:85:in `find_id_model_arrays'
    /vendor/plugins/acts_as_ferret/lib/ferret_find_methods.rb:41:in `ar_find'
    /vendor/plugins/acts_as_ferret/lib/ferret_find_methods.rb:12:in `find_records'
    /vendor/plugins/acts_as_ferret/lib/acts_as_ferret.rb:342:in `find'
    /vendor/plugins/acts_as_ferret/lib/class_methods.rb:155:in `find_with_ferret'
    /app/controllers/notes_controller.rb:14:in `search'
    /usr/lib/ruby/gems/1.8/gems/actionpack-2.1.0/lib/action_controller/base.rb:1162:in `send'
    /usr/lib/ruby/gems/1.8/gems/actionpack-2.1.0/lib/action_controller/base.rb:1162:in `perform_action_without_filters'
    /usr/lib/ruby/gems/1.8/gems/actionpack-2.1.0/lib/action_controller/filters.rb:580:in `call_filters'
    /usr/lib/ruby/gems/1.8/gems/actionpack-2.1.0/lib/action_controller/filters.rb:573:in `perform_action_without_benchmark'
    /usr/lib/ruby/gems/1.8/gems/actionpack-2.1.0/lib/action_controller/benchmarking.rb:68:in `perform_action_without_rescue_without_timeout'
    /usr/lib/ruby/1.8/benchmark.rb:293:in `measure'
    /usr/lib/ruby/gems/1.8/gems/actionpack-2.1.0/lib/action_controller/benchmarking.rb:68:in `perform_action_without_rescue_without_timeout'
    /home/userapps_plugins/preload/request_timeout/lib/request_timeout.rb:9:in `perform_action_without_rescue'
    /usr/lib/ruby/1.8/timeout.rb:48:in `timeout'
    /home/userapps_plugins/preload/request_timeout/lib/request_timeout.rb:8:in `perform_action_without_rescue'
    /usr/lib/ruby/gems/1.8/gems/actionpack-2.1.0/lib/action_controller/rescue.rb:201:in `perform_action_without_caching'
    /usr/lib/ruby/gems/1.8/gems/actionpack-2.1.0/lib/action_controller/caching/sql_cache.rb:13:in `perform_action'
    /usr/lib/ruby/gems/1.8/gems/activerecord-2.1.0/lib/active_record/connection_adapters/abstract/query_cache.rb:33:in `cache'
    /usr/lib/ruby/gems/1.8/gems/activerecord-2.1.0/lib/active_record/query_cache.rb:8:in `cache'
    /usr/lib/ruby/gems/1.8/gems/actionpack-2.1.0/lib/action_controller/caching/sql_cache.rb:12:in `perform_action'
    /usr/lib/ruby/gems/1.8/gems/actionpack-2.1.0/lib/action_controller/base.rb:529:in `send'
    /usr/lib/ruby/gems/1.8/gems/actionpack-2.1.0/lib/action_controller/base.rb:529:in `process_without_filters'
    /usr/lib/ruby/gems/1.8/gems/actionpack-2.1.0/lib/action_controller/filters.rb:569:in `process_without_session_management_support'
    /usr/lib/ruby/gems/1.8/gems/actionpack-2.1.0/lib/action_controller/session_management.rb:130:in `process'
    /usr/lib/ruby/gems/1.8/gems/actionpack-2.1.0/lib/action_controller/base.rb:389:in `process'
    /usr/lib/ruby/gems/1.8/gems/actionpack-2.1.0/lib/action_controller/dispatcher.rb:149:in `handle_request'
    /usr/lib/ruby/gems/1.8/gems/actionpack-2.1.0/lib/action_controller/dispatcher.rb:107:in `dispatch'
    /usr/lib/ruby/1.8/thread.rb:135:in `synchronize'
    /usr/lib/ruby/gems/1.8/gems/actionpack-2.1.0/lib/action_controller/dispatcher.rb:104:in `dispatch'
    /usr/lib/ruby/gems/1.8/gems/actionpack-2.1.0/lib/action_controller/dispatcher.rb:120:in `dispatch_cgi'
    /usr/lib/ruby/gems/1.8/gems/actionpack-2.1.0/lib/action_controller/dispatcher.rb:35:in `dispatch'
    /usr/lib/ruby/gems/1.8/gems/thin-0.8.2/lib/rack/adapter/rails.rb:54:in `serve_rails'
    /usr/lib/ruby/gems/1.8/gems/thin-0.8.2/lib/rack/adapter/rails.rb:74:in `call'
    /home/heroku_rack/lib/toolbar.rb:16:in `call'
    /usr/lib/ruby/gems/1.8/gems/rack-0.4.0/lib/rack/urlmap.rb:42:in `call'
    /usr/lib/ruby/gems/1.8/gems/rack-0.4.0/lib/rack/urlmap.rb:35:in `each'
    /usr/lib/ruby/gems/1.8/gems/rack-0.4.0/lib/rack/urlmap.rb:35:in `call'
    /usr/lib/ruby/gems/1.8/gems/rack-0.4.0/lib/rack/builder.rb:53:in `call'
    /usr/lib/ruby/gems/1.8/gems/thin-0.8.2/lib/thin/connection.rb:59:in `pre_process'
    /usr/lib/ruby/gems/1.8/gems/thin-0.8.2/lib/thin/connection.rb:50:in `process'
    /usr/lib/ruby/gems/1.8/gems/thin-0.8.2/lib/thin/connection.rb:35:in `receive_data'
    /usr/lib/ruby/gems/1.8/gems/eventmachine-0.12.0/lib/eventmachine.rb:224:in `run_machine'
    /usr/lib/ruby/gems/1.8/gems/eventmachine-0.12.0/lib/eventmachine.rb:224:in `run'
    /usr/lib/ruby/gems/1.8/gems/thin-0.8.2/lib/thin/backends/base.rb:45:in `start'
    /usr/lib/ruby/gems/1.8/gems/thin-0.8.2/lib/thin/server.rb:146:in `start'
    /usr/lib/ruby/gems/1.8/gems/thin-0.8.2/lib/thin/controllers/controller.rb:79:in `start'
    /usr/lib/ruby/gems/1.8/gems/thin-0.8.2/lib/thin/runner.rb:166:in `send'
    /usr/lib/ruby/gems/1.8/gems/thin-0.8.2/lib/thin/runner.rb:166:in `run_command'
    /usr/lib/ruby/gems/1.8/gems/thin-0.8.2/lib/thin/runner.rb:136:in `run!'
    /usr/lib/ruby/gems/1.8/gems/thin-0.8.2/bin/thin:6 /usr/bin/thin:19:in `load'
    /usr/bin/thin:19 Rendering /usr/lib/ruby/gems/1.8/gems/actionpack-2.1.0/lib/action_controller/templates/res 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-25T15:56:37.303

我不记得曾经见过那个雪貂错误。有两个基本诊断：进入脚本/控制台，然后执行

```
Notes.find_with_ferret("一些应该在索引中的词")
```

然后看看当你删除索引的目录（/appname/index/development）时会发生什么，做另一个find_with_ferret来强制重新索引？

背景信息：表中的“标题”和“正文”列，或以实例方法计算，或来自例如 has_many 的子项？如果是表中的字段，迁移中声明的“title”和“body”是什么列类型，mySQL 的列类型是什么？

包括您的操作系统、ruby、rails、ferret 和您正在使用的 a_a_f 的版本通常也很有帮助。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-25T18:45:30.803

我已经删除了索引目录，它似乎已经重新生成了自己，但现在我在控制台上的搜索没有给出任何结果。在我删除索引目录之前，我在控制台上得到了结果，但在我的应用程序的表单中使用时却没有。

Title 和 Body 都是我的 MySQL 表中的列。它们是分别使用 Rails 迁移作为类型字符串和文本创建的。

我在 Heroku 上运行 - 所以我不完全确定是什么操作系统（可能是 linux）或版本，尽管我知道它至少是 rails 2.1。我似乎也找不到 AAF 的版本号 - 但我想它是相对较新的。

抱歉，我无法提供更多帮助——我所说的有用吗？

罗宾

# php - 如何最好地在服务器外调整图像大小

> ID：236139
> 
> 赞同：2
> 
> 时间：2008-10-25T09:10:04.063
> 
> 标签：php, image-processing, amazon-web-services, cloud

我有一个用户上传图片的网站。这些图像被调整为各种尺寸。我目前在我的服务器上这样做，但正在考虑在 AWS 或类似的东西上处理它。这是一个好主意吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-27T00:03:23.377

我一直在使用 EC2 和专用服务器来完成类似的任务，这里有一些提示：

1.  使用尽可能少的 IO。如果您打算使用 ImageMagick 之类的东西，请知道写入磁盘是浪费 io 资源（除非您想缓存它。） PHP/GD 允许您直接在 http 响应中发送 jpeg。

2.  尽快释放 RAM：尽可能释放源图像和调整大小的图像。消除服务器换出内存的机会。

3.  EC2 的上下文切换非常慢。所以尽量少尝试。像 Gimp 这样的处理器非常慢（专用的缩减需要 0.2 秒，EC2 需要 7 秒。）此外，ImageMagick 非常慢。如果可以，请使用 PHP/GD 进行所有处理。

4.  记得设置最大内存。您将需要内存中图像的两个副本（源和按比例缩小。）

5.  最后但同样重要的是：从实时开始。不要从 mysql 队列和外部守护进程的过度杀伤解决方案开始。从长远来看，这些将难以维持。所以在你建造火箭之前先试试看。

祝你好运！

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-25T15:33:10.730

您需要弄清楚处理图像需要多少时间以及您预计处理多少。

如果您的服务器可以在您的峰值负载下实时处理它们，那么现在不要担心。

我想说，如果你的服务器可以处理负载，但不是实时的，我会在服务器上建立一个队列，让一个 cron 作业或守护进程处理请求之外的图像。如果队列开始增长或您的服务器开始过载，您可以将其移动到另一台机器上。

如果另一台机器无法处理负载，您应该能够稍微轻松地添加更多机器来处理队列。

那时，您可能已经相当成熟，可以开始利用 EC2 进行按需扩展等事情。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-25T11:35:49.073

如果您预计需要大规模扩展和加载，您可以使用 EC2 服务器进行大小调整并将它们存储在 S3 中。最终，这将取决于很多因素，具体取决于您的增长和预算。您的服务器上的当前负载是多少，您是否接近容量？调整图像大小所需的 CPU 大小和数量是多少？它们可以被缓存和重用吗？图片是如何使用的？

# cocoa - 在 Cocoa 项目中使用版本控制的最佳实践

> ID：236151
> 
> 赞同：6
> 
> 时间：2008-10-25T09:25:16.373
> 
> 标签：cocoa, svn, git, version-control

我最近开始使用 Git 作为我正在处理的一些 Cocoa 项目的版本控制系统，并想知道是否有在 Cocoa 项目上使用版本控制系统的最佳实践。

有一个明显的“构建”目录，我从版本控制中排除了它，因为它并不重要，并且在调试一些代码时会发生相当大的变化，然后有那些 .pbxuser 和 .perspectivev3 每次我在 Xcode 中打开项目时都会发生变化，但我没有真的不知道他们是否“重要”到可以登记入住。

是否有排除不重要文件的常用配置？

提前致谢

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-25T10:08:14.880

这是我的 Mercurial`.hgignore`文件，它基于[Peter Hosey 的](http://boredzo.org/blog/archives/2008-03-20/hgignore-for-mac-os-x-applications).

```
syntax: glob

.DS_Store

*.swp
*~.nib

build

*.pbxuser
*.perspective
*.perspectivev3
*.mode1v3

*.pyc 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-25T09:49:01.783

我从不提交 ${LOGNAME}.* 文件，因为它们基本上是当前用户的偏好信息；项目源、目标、依赖项等都在 project.pbxproj 文件中。正如您在问题中提到的那样，构建目录（假设您有 Place Build Products in: Project directory 选项集）是派生文件所在的位置，因此无需签入。您始终可以重新生成其内容从源代码。

# c++ - 您能否推荐任何开源项目，其中源代码通过单元测试进行了广泛的测试？

> ID：236156
> 
> 赞同：8
> 
> 时间：2008-10-25T09:31:02.210
> 
> 标签：c++, unit-testing, open-source

编程是通过编写程序来学习的。但据说代码阅读是另一种很好的学习方式。我想通过阅读、检查真实世界的代码来提高我的单元测试技能。您能否推荐任何开源项目，其中源代码通过单元测试进行了广泛的测试？

我对用 C++ 编写的代码很感兴趣。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-25T11:34:47.860

AFAIK C++ Boost 库 - [http://boost.org/](http://boost.org/) - 广泛涵盖了代码库，以及每条新代码都必须进行单元测试的政策。可能值得检查。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-25T15:21:56.653

[铬](http://code.google.com/chromium/)项目。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-25T12:34:29.253

我不会广泛地称呼它，但[wxWidgets用](http://www.wxwidgets.org/)[CppUnit](http://cppunit.sourceforge.net)做了一些 UnitTest 。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-25T15:19:17.237

[Bazaar](http://bazaar-vcs.org/)版本控制系统对自动化测试非常着迷。单元测试、功能测试、集成测试、黑盒测试、测试替身测试、测试框架测试、参数化测试套件、平台特定测试等。

这对项目有各种各样的好处，但我必须避免在这里过度的 VCS 狂热。

编辑：哎呀，我没有注意到你说你对 C++ 感兴趣。Bazaar 是一个 Python 项目。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-03-26T00:02:03.167

trucov项目是一个用于验证单元测试覆盖率的开源工具[。](http://code.google.com/p/trucov/)该工具本身使用[谷歌的测试框架进行](http://code.google.com/p/googletest/)[了广泛](http://code.google.com/p/trucov/wiki/Final_Package_Report)的单元测试。

*免责声明*：虽然我没有自己编写项目，但我确实指导了编写项目的学生。

# c# - 如何在 Web 服务中获取当前目录

> ID：236166
> 
> 赞同：34
> 
> 时间：2008-10-25T09:39:51.960
> 
> 标签：c#, web-services

我正在使用 System.IO.Directory.GetCurrentDirectory() 来获取我的 Web 服务中的当前目录，但这并没有给我当前目录。如何在 Web 服务中获取当前目录？

谢谢斯图尔特

* * *

## 回答 #1

> 赞同：48
> 
> 时间：2008-10-25T09:47:27.763

在 web 服务中，您在 http 上下文中运行。所以，

```
HttpContext.Current.Server.MapPath("~/") 
```

会给你答案。

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2014-07-22T19:20:55.843

您可以使用

```
AppDomain.CurrentDomain.BaseDirectory; 
```

这为您提供了应用程序的根目录。

* * *

## 回答 #3

> 赞同：22
> 
> 时间：2010-05-17T18:38:04.783

`HttpContext.Current.Server.MapPath(".")`会给你当前的工作目录。

但是对于 Rohan West 关于可能在 HttpContext 之外的评论，最好直接调用：

```
HostingEnvironment.MapPath(".") 
```

[在此处](https://stackoverflow.com/questions/944219/what-is-the-difference-between-server-mappath-and-hostingenvironment-mappath)查看详细信息

* * *

## 回答 #4

> 赞同：20
> 
> 时间：2011-07-15T13:11:48.387

HttpContext.Current.Server.MapPath("~/") 映射回应用程序或虚拟目录的根目录。

HttpContext.Current.Server.MapPath("~/") <-- 根
HttpContext.Current.Server.MapPath(".") <-- 当前目录
HttpContext.Current.Server.MapPath("..") <--父目录

以上都是相对的，所以你可以任意组合遍历目录树。

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2011-08-02T18:20:52.777

最好的方法是使用

`HostingEnvironment.ApplicationPhysicalPath`在下面`System.Web.Hosting`

有关更多信息，请参阅[此链接](http://msdn.microsoft.com/en-us/library/system.web.hosting.virtualpathprovider.aspx)

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2008-10-25T12:00:52.237

`HttpContext.Current.Server.MapPath("~/")`会给你应用程序的根吗？

这是最有可能的，因为您可能知道从那里开始的路径。

另一个可能感兴趣的选项：

```
HttpContext.Current.Server.MapPath("/Directory/") 
```

无论如何，这都是从应用程序的根目录构建的。

如果没有第一个斜杠，这将从您调用的目录开始：

```
HttpContext.Current.Server.MapPath("Directory/") 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-12-24T16:52:16.653

HttpContext.Current.Server.MapPath("..") [观察两个（..）点而不是（.）] 给出站点的虚拟目录的物理目录！

# c# - .NET 没有可靠的异步套接字通信？

> ID：236171
> 
> 赞同：9
> 
> 时间：2008-10-25T09:49:08.180
> 
> 标签：c#, .net, sockets, stream, web-crawler

我曾经在 .NET 中写过一个 Crawler。为了提高它的可扩展性，我尝试利用 .NET 的异步 API。

System.Net.HttpWebRequest 具有异步 API BeginGetResponse/EndGetResponse。但是，这对 API 只是为了获取一个 HTTP 响应头和一个 Stream 实例，我们可以从中提取 HTTP 响应内容。所以，我的策略是使用 BeginGetResponse/EndGetResponse 异步获取响应 Stream，然后使用 BeginRead/EndRead 从响应 Stream 实例中异步获取字节。

在 Crawler 进行压力测试之前，一切似乎都很完美。在压力测试下，Crawler 内存使用率很高。我用 WinDbg+SoS 检查了内存，发现很多字节数组都被 System.Threading.OverlappedData 实例固定了。在互联网上搜索后，我从微软找到了这个 KB [http://support.microsoft.com/kb/947862 。](http://support.microsoft.com/kb/947862)

根据 KB，异步 I/O 的数量应该有一个“上限”，但它并没有告诉一个“建议的”界限值。所以，在我看来，这个知识库没有任何帮助。这显然是一个 .NET 错误。最后，我不得不放弃从响应流中异步提取字节的想法，而只是以同步的方式进行。

> .NET 库允许使用点网套接字（Socket.BeginSend / Socket.BeginReceive / NetworkStream.BeginRead / NetworkStream.BeginWrite）进行异步 IO，其异步 IO 的未完成缓冲区数量（发送或接收）必须具有上限.
> 
> *网络应用程序应该对其发布的未完成*异步 IO的数量有一个上限 。

编辑：添加一些问号。

有人有在 Socket 和 NetworkStream 上进行异步 I/O 的经验吗？一般来说，生产中的爬虫是同步还是异步与互联网进行I/O？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-25T14:56:04.483

嗯，这不是 .NET 框架问题。链接的知识库文章可能更明确一点：“你使用的是一把上膛的枪，当你将它瞄准你的脚时会发生这种情况”。那把枪中的子弹是 .NET，使您能够启动尽可能多的异步 I/O 请求。它会做你要求它做的事情，直到你达到某种资源限制。在这种情况下，可能是在第 0 代堆中有太多固定的接收缓冲区。

资源管理仍然是我们的工作，而不是 .NET。这与无限制地分配内存没有什么不同。解决这个特定问题需要您限制未完成的 BeginGetResponse() 请求的数量。拥有数百个毫无意义，每个人都必须一次挤过 Intertube。添加另一个请求只会导致它需要更长的时间才能完成。或者让你的程序崩溃。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2011-05-20T17:16:14.030

这不仅限于 .Net。

这是一个简单的事实，每个异步请求（文件、网络等）都使用内存和（在某些时候，至少用于网络请求）非分页池（有关在非托管代码中可能遇到的问题的详细信息，请参见[此处](http://www.serverframework.com/asynchronousevents/2011/04/avoiding-non-paged-pool-exhaustion-when-using-asynchronous-file-writers.html)）。因此，未完成请求的数量受内存量的限制。Pre-Vista 有一些非常低的非分页池限制，它们会在内存不足之前给您带来问题，但在后 vista 环境中，对于非分页池的使用情况要好得多（请参阅[此处](http://www.lenholgate.com/blog/2009/03/excellent-article-on-non-paged-pool.html)）。

它在托管代码中稍微复杂一些，因为除了在非托管世界中遇到的问题之外，您还必须处理用于异步请求的内存缓冲区在这些请求完成之前被固定的事实。听起来您在读取时遇到了这些问题，但对于写入而言，即使不是更糟，也同样糟糕（一旦 TCP 流控制在连接上启动，这些发送完成将开始花费更长的时间发生，因此这些缓冲区被固定的时间越来越长 - 请参见[此处](http://www.lenholgate.com/blog/2008/07/write-completion-flow-control.html)和[此处](http://www.serverframework.com/asynchronousevents/2011/06/tcp-flow-control-and-asynchronous-writes.html)）。

问题不在于 .Net 异步的东西被破坏了，而在于抽象使得它看起来比实际容易得多。例如，为了避免固定问题，请在程序启动时将所有缓冲区分配在一个大的连续块中，而不是按需分配......

就我个人而言，我会用非托管代码编写这样的爬虫，但这只是我;) 你仍然会面临许多问题，但你对它们有更多的控制权。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-25T09:57:51.207

无论您的爬虫是同步/异步，您显然都想限制并发请求的数量。这个限制不是固定的，它取决于你的硬件、网络……

我不太确定你的问题是什么，因为 HTTP/Sockets 的 .NET 实现是“好的”。有一些漏洞（请参阅[我](http://ripper234.com/p/timeoutstream/)关于正确控制超时的帖子），但它可以完成工作（我们有一个生产爬虫，每秒可获取数百页）。

顺便说一句，我们使用同步 IO，只是为了方便。每个任务都有一个线程，我们限制并发线程的数量。对于线程管理，我们使用了[Microsoft CCR](http://msdn.microsoft.com/en-us/magazine/cc163556.aspx)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-09-14T22:53:53.303

没有知识库文章可以给你一个上限。上限可能因可用硬件而异 - 2G 内存机器的上限对于具有 16g 内存的机器会有所不同。它还取决于 GC 堆的大小、碎片程度等。

您应该做的是使用信封背面计算得出您自己的指标。弄清楚每分钟要下载多少页。这应该确定您想要处理多少异步请求（N）。

一旦你知道了 N，就可以创建一段代码（比如生产者-消费者管道的消费者端），它可以创建 N 个未完成的异步下载请求。一旦请求完成（由于超时或由于成功），通过从队列中拉出一个工作项来启动另一个异步请求。

您还需要确保队列不会超出界限，例如，如果由于某种原因导致下载变慢。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-05-20T10:18:25.020

当您使用套接字的异步发送 (BeginSend) 方法时，就会发生这种情况。如果您使用自己的自定义线程池，并使用同步发送方法通过线程发送数据主要是解决这个问题。经过测试和证明。

# c++ - How do I sort a std::vector by the values of a different std::vector?

> ID：236172
> 
> 赞同：59
> 
> 时间：2008-10-25T09:52:58.423
> 
> 标签：c++, stl, boost, vector, sorting

I have several `std::vector`, all of the same length. I want to sort one of these vectors, and apply the same transformation to all of the other vectors. Is there a neat way of doing this? (preferably using the STL or Boost)? Some of the vectors hold `int`s and some of them `std::string`s.

Pseudo code:

```
std::vector<int> Index = { 3, 1, 2 };
std::vector<std::string> Values = { "Third", "First", "Second" };

Transformation = sort(Index);
Index is now { 1, 2, 3};

... magic happens as Transformation is applied to Values ...
Values are now { "First", "Second", "Third" }; 
```

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2008-10-25T10:24:07.063

friol's approach is good when coupled with yours. First, build a vector consisting of the numbers 1…<em>n, along with the elements from the vector dictating the sorting order:

```
typedef vector<int>::const_iterator myiter;

vector<pair<size_t, myiter> > order(Index.size());

size_t n = 0;
for (myiter it = Index.begin(); it != Index.end(); ++it, ++n)
    order[n] = make_pair(n, it); 
```

Now you can sort this array using a custom sorter:

```
struct ordering {
    bool operator ()(pair<size_t, myiter> const& a, pair<size_t, myiter> const& b) {
        return *(a.second) < *(b.second);
    }
};

sort(order.begin(), order.end(), ordering()); 
```

Now you've captured the order of rearrangement inside `order` (more precisely, in the first component of the items). You can now use this ordering to sort your other vectors. There's probably a very clever in-place variant running in the same time, but until someone else comes up with it, here's one variant that isn't in-place. It uses `order` as a look-up table for the new index of each element.

```
template <typename T>
vector<T> sort_from_ref(
    vector<T> const& in,
    vector<pair<size_t, myiter> > const& reference
) {
    vector<T> ret(in.size());

    size_t const size = in.size();
    for (size_t i = 0; i < size; ++i)
        ret[i] = in[reference[i].first];

    return ret;
} 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-12-05T04:47:38.177

```
typedef std::vector<int> int_vec_t;
typedef std::vector<std::string> str_vec_t;
typedef std::vector<size_t> index_vec_t;

class SequenceGen {
  public:
    SequenceGen (int start = 0) : current(start) { }
    int operator() () { return current++; }
  private:
    int current;
};

class Comp{
    int_vec_t& _v;
  public:
    Comp(int_vec_t& v) : _v(v) {}
    bool operator()(size_t i, size_t j){
         return _v[i] < _v[j];
   }
};

index_vec_t indices(3);
std::generate(indices.begin(), indices.end(), SequenceGen(0));
//indices are {0, 1, 2}

int_vec_t Index = { 3, 1, 2 };
str_vec_t Values = { "Third", "First", "Second" };

std::sort(indices.begin(), indices.end(), Comp(Index));
//now indices are {1,2,0} 
```

Now you can use the "indices" vector to index into "Values" vector.

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-10-26T14:48:07.897

Put your values in a [Boost Multi-Index container](http://www.boost.org/doc/libs/1_36_0/libs/multi_index/doc/index.html) then iterate over to read the values in the order you want. You can even copy them to another vector if you want to.

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-25T10:15:33.727

Only one rough solution comes to my mind: create a vector that is the sum of all other vectors (a vector of structures, like {3,Third,...},{1,First,...}) then sort this vector by the first field, and then split the structures again.

Probably there is a better solution inside Boost or using the standard library.

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-26T14:33:26.303

I think what you *really* need (but correct me if I'm wrong) is a way to access elements of a container in some order.

Rather than rearranging my original collection, I would borrow a concept from Database design: keep an index, ordered by a certain criterion. This index is an extra indirection that offers great flexibility.

This way it is possible to generate multiple indices according to different members of a class.

```
using namespace std;

template< typename Iterator, typename Comparator >
struct Index {
    vector<Iterator> v;

    Index( Iterator from, Iterator end, Comparator& c ){
        v.reserve( std::distance(from,end) );
        for( ; from != end; ++from ){
            v.push_back(from); // no deref!
        }
        sort( v.begin(), v.end(), c );
    }

};

template< typename Iterator, typename Comparator >
Index<Iterator,Comparator> index ( Iterator from, Iterator end, Comparator& c ){
    return Index<Iterator,Comparator>(from,end,c);
}

struct mytype {
    string name;
    double number;
};

template< typename Iter >
struct NameLess : public binary_function<Iter, Iter, bool> {
    bool operator()( const Iter& t1, const Iter& t2 ) const { return t1->name < t2->name; }
};

template< typename Iter >
struct NumLess : public binary_function<Iter, Iter, bool> {
    bool operator()( const Iter& t1, const Iter& t2 ) const { return t1->number < t2->number; }
};

void indices() {

    mytype v[] =    { { "me"    ,  0.0 }
                    , { "you"   ,  1.0 }
                    , { "them"  , -1.0 }
                    };
    mytype* vend = v + _countof(v);

    Index<mytype*, NameLess<mytype*> > byname( v, vend, NameLess<mytype*>() );
    Index<mytype*, NumLess <mytype*> > bynum ( v, vend, NumLess <mytype*>() );

    assert( byname.v[0] == v+0 );
    assert( byname.v[1] == v+2 );
    assert( byname.v[2] == v+1 );

    assert( bynum.v[0] == v+2 );
    assert( bynum.v[1] == v+0 );
    assert( bynum.v[2] == v+1 );

} 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2010-11-24T10:42:00.320

You can probably define a custom "facade" iterator that does what you need here. It would store iterators to all your vectors or alternatively derive the iterators for all but the first vector from the offset of the first. The tricky part is what that iterator dereferences to: think of something like boost::tuple and make clever use of boost::tie. (If you wanna extend on this idea, you can build these iterator types recursively using templates but you probably never want to write down the type of that - so you either need c++0x auto or a wrapper function for sort that takes ranges)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-12-21T02:53:27.387

ltjax's answer is a great approach - which is actually implemented in boost's zip_iterator [http://www.boost.org/doc/libs/1_43_0/libs/iterator/doc/zip_iterator.html](http://www.boost.org/doc/libs/1_43_0/libs/iterator/doc/zip_iterator.html)

It packages together into a tuple whatever iterators you provide it.

You can then create your own comparison function for a sort based on any combination of iterator values in your tuple. For this question, it would just be the first iterator in your tuple.

A nice feature of this approach is that it allows you to keep the memory of each individual vector contiguous (if you're using vectors and that's what you want). You also don't need to store a separate index vector of ints.

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2014-10-23T16:38:14.087

A slightly more compact variant of xtofl's answer for if you are just looking to iterate through all your vectors based on the of a single `keys` vector. Create a permutation vector and use this to index into your other vectors.

```
#include <boost/iterator/counting_iterator.hpp>
#include <vector>
#include <algorithm>

std::vector<double> keys = ...
std::vector<double> values = ...

std::vector<size_t> indices(boost::counting_iterator<size_t>(0u), boost::counting_iterator<size_t>(keys.size()));
std::sort(begin(indices), end(indices), [&](size_t lhs, size_t rhs) {
    return keys[lhs] < keys[rhs];
});

// Now to iterate through the values array.
for (size_t i: indices)
{
    std::cout << values[i] << std::endl;
} 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2014-12-11T12:54:19.750

This would have been an addendum to Konrad's answer as it an approach for a in-place variant of applying the sort order to a vector. Anyhow since the edit won't go through I will put it here

Here is a in-place variant with a slightly higher time complexity that is due to a primitive operation of checking a boolean. The additional space complexity is of a vector which can be a space efficient compiler dependent implementation. The complexity of a vector can be eliminated if the given order itself can be modified.

Here is a in-place variant with a slightly higher time complexity that is due to a primitive operation of checking a boolean. The additional space complexity is of a vector which can be a space efficient compiler dependent implementation. The complexity of a vector can be eliminated if the given order itself can be modified. This is a example of what the algorithm is doing. If the order is 3 0 4 1 2, the movement of the elements as indicated by the position indices would be 3--->0; 0--->1; 1--->3; 2--->4; 4--->2.

```
template<typename T>
struct applyOrderinPlace
{
void operator()(const vector<size_t>& order, vector<T>& vectoOrder)
{
vector<bool> indicator(order.size(),0);
size_t start = 0, cur = 0, next = order[cur];
size_t indx = 0;
T tmp; 

while(indx < order.size())
{
//find unprocessed index
if(indicator[indx])
{   
++indx;
continue;
}

start = indx;
cur = start;
next = order[cur];
tmp = vectoOrder[start];

while(next != start)
{
vectoOrder[cur] = vectoOrder[next];
indicator[cur] = true; 
cur = next;
next = order[next];
}
vectoOrder[cur] = tmp;
indicator[cur] = true;
}
}
}; 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2016-03-09T19:58:36.313

Here is a relatively simple implementation using *index mapping* between the ordered and unordered `names` that will be used to match the `ages` to the ordered `names`:

```
void ordered_pairs()
{
    std::vector<std::string> names;
    std::vector<int> ages;

    // read input and populate the vectors
    populate(names, ages);

    // print input
    print(names, ages);

    // sort pairs
    std::vector<std::string> sortedNames(names);
    std::sort(sortedNames.begin(), sortedNames.end());

    std::vector<int> indexMap;
    for(unsigned int i = 0; i < sortedNames.size(); ++i)
    {
        for (unsigned int j = 0; j < names.size(); ++j)
        {
            if (sortedNames[i] == names[j]) 
            {
                indexMap.push_back(j);
                break;
            }
        }
    }
    // use the index mapping to match the ages to the names
    std::vector<int> sortedAges;
    for(size_t i = 0; i < indexMap.size(); ++i)
    {
        sortedAges.push_back(ages[indexMap[i]]);
    }

    std::cout << "Ordered pairs:\n";
    print(sortedNames, sortedAges); 
} 
```

For the sake of completeness, here are the functions `populate()` and `print()`:

```
void populate(std::vector<std::string>& n, std::vector<int>& a)
{
    std::string prompt("Type name and age, separated by white space; 'q' to exit.\n>>");
    std::string sentinel = "q";

    while (true)
    {
        // read input
        std::cout << prompt;
        std::string input;
        getline(std::cin, input);

        // exit input loop
        if (input == sentinel)
        {
            break;
        }

        std::stringstream ss(input);

        // extract input
        std::string name;
        int age;
        if (ss >> name >> age)
        {
            n.push_back(name);
            a.push_back(age);
        }
        else
        {
            std::cout <<"Wrong input format!\n";
        }
    }
} 
```

and:

```
void print(const std::vector<std::string>& n, const std::vector<int>& a)
{
    if (n.size() != a.size())
    {
        std::cerr <<"Different number of names and ages!\n";
        return;
    }

    for (unsigned int i = 0; i < n.size(); ++i)
    {
         std::cout <<'(' << n[i] << ", " << a[i] << ')' << "\n";
    }
} 
```

And finally, `main()` becomes:

```
#include <iostream>
#include <sstream>
#include <string>
#include <vector>
#include <algorithm>

void ordered_pairs();
void populate(std::vector<std::string>&, std::vector<int>&);
void print(const std::vector<std::string>&, const std::vector<int>&);

//=======================================================================
int main()
{
    std::cout << "\t\tSimple name - age sorting.\n";
    ordered_pairs();
}
//=======================================================================
// Function Definitions... 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2017-07-08T13:55:24.730

```
**// C++ program to demonstrate sorting in vector
// of pair according to 2nd element of pair
#include <iostream>
#include<string>
#include<vector>
#include <algorithm>

using namespace std;

// Driver function to sort the vector elements
// by second element of pairs
bool sortbysec(const pair<char,char> &a,
              const pair<int,int> &b)
{
    return (a.second < b.second);
}

int main()
{
    // declaring vector of pairs
    vector< pair <char, int> > vect;

    // Initialising 1st and 2nd element of pairs
    // with array values
    //int arr[] = {10, 20, 5, 40 };
    //int arr1[] = {30, 60, 20, 50};
    char arr[] = { ' a', 'b', 'c' };
    int arr1[] = { 4, 7, 1 };

    int n = sizeof(arr)/sizeof(arr[0]);

    // Entering values in vector of pairs
    for (int i=0; i<n; i++)
        vect.push_back( make_pair(arr[i],arr1[i]) );

    // Printing the original vector(before sort())
    cout << "The vector before sort operation is:\n" ;
    for (int i=0; i<n; i++)
    {
        // "first" and "second" are used to access
        // 1st and 2nd element of pair respectively
        cout << vect[i].first << " "
             << vect[i].second << endl;

    }

    // Using sort() function to sort by 2nd element
    // of pair
    sort(vect.begin(), vect.end(), sortbysec);

    // Printing the sorted vector(after using sort())
    cout << "The vector after sort operation is:\n" ;
    for (int i=0; i<n; i++)
    {
        // "first" and "second" are used to access
        // 1st and 2nd element of pair respectively
        cout << vect[i].first << " "
             << vect[i].second << endl;
    }
    getchar();
    return 0;`enter code here`
}** 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2019-05-08T15:43:52.193

with C++11 lambdas and the STL algorithms based on answers from Konrad Rudolph and Gabriele D'Antona:

```
template< typename T, typename U >
std::vector<T> sortVecAByVecB( std::vector<T> & a, std::vector<U> & b ){

    // zip the two vectors (A,B)
    std::vector<std::pair<T,U>> zipped(a.size());
    for( size_t i = 0; i < a.size(); i++ ) zipped[i] = std::make_pair( a[i], b[i] );

    // sort according to B
    std::sort(zipped.begin(), zipped.end(), []( auto & lop, auto & rop ) { return lop.second < rop.second; }); 

    // extract sorted A
    std::vector<T> sorted;
    std::transform(zipped.begin(), zipped.end(), std::back_inserter(sorted), []( auto & pair ){ return pair.first; }); 

    return sorted;
} 
```

* * *

## 回答 #13

> 赞同：-2
> 
> 时间：2017-09-22T17:42:41.220

So many asked this question and nobody came up with a satisfactory answer. Here is a std::sort helper that enables to sort two vectors simultaneously, taking into account the values of only one vector. This solution is based on a custom RadomIt (random iterator), and operates directly on the original vector data, without temporary copies, structure rearrangement or additional indices:

[C++, Sort One Vector Based On Another One](https://stackoverflow.com/questions/37368787/c-sort-one-vector-based-on-another-one/46370189#46370189)

# lzh - LZH 压缩库

> ID：236179
> 
> 赞同：2
> 
> 时间：2008-10-25T09:59:02.577
> 
> 标签：lzh

我正在寻找一个 LHarc 解压缩库，如果可能的话，请提供源代码。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-25T10:11:11.273

不久前我发现了一些

PASCAL 源代码（从未看过它的有效性） [http://www.bsdg.org/SWAG/ARCHIVES/0040.PAS.html](http://www.bsdg.org/SWAG/ARCHIVES/0040.PAS.html)

Java 版本 [http://homepage1.nifty.com/dangan/en/Content/Program/Java/jLHA/jLHA.html](http://homepage1.nifty.com/dangan/en/Content/Program/Java/jLHA/jLHA.html)

[带有源http://sourceforge.jp/projects/lha/](http://sourceforge.jp/projects/lha/)的 Unix 版本

# fitnesse - 如何将预先格式化的文本放入 FitNesse 夹具表格单元格中？

> ID：236183
> 
> 赞同：9
> 
> 时间：2008-10-25T10:03:03.723
> 
> 标签：fitnesse

我希望能够将预先格式化的文本（即包含换行符）放入 FitNesse 夹具表的单个单元格中。有没有办法操纵 FitNesse wiki 标记来做到这一点？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-02-25T21:18:13.577

采用 ！- -！获取多行表格单元格和 {{{ }}} 以获取预格式化的文本。{{{ 必须在 !- 之外

例如：

```
|sql|
|{{{!- SELECT *
     FROM bar
     WHERE gaz = 14
-!}}}| 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-25T10:31:45.990

一种方法是使用多行文本定义一个变量，然后从表格单元格中引用它：

```
!define sql {  SELECT *
  FROM bar
  WHERE gaz = 14
}

|sql|
|${sql}| 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2014-08-29T15:57:46.707

[理查德对约翰内斯·布罗德沃尔的回答](https://stackoverflow.com/a/587889/173497)的评论对我有用，即您不需要[“按原样格式化”行/块标记，只需要“按原样”/转义字符格式](http://www.fitnesse.org/FitNesse.UserGuide.QuickReferenceGuide)，因此如果您不这样做，以下内容就足够了也不需要或想要预先格式化的样式：

```
|sql|
|!-Some text
that spans
multiple lines.
-!| 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2014-09-30T12:06:58.667

这种方式允许您在源代码中的同一行上保留表格行：

```
| col1 | col2 |
| !- col1 cell <br /> with line break -! | col2 cell without line break | 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2020-10-08T15:27:34.847

最终对我来说效果最好的方法是一起使用上面列出的几个解决方案。定义变量并使用 !- -!

```
define myVarWithLineBreaks {!-This is my
text with line
breaks-!}

|col                   |col2       |
|${myVarWithLineBreaks}|other value| 
```

# c# - Windows Mobile - Compact Framework 程序即服务？

> ID：236184
> 
> 赞同：4
> 
> 时间：2008-10-25T10:03:48.727
> 
> 标签：c#, windows-mobile, compact-framework

让我的 C# Compact Framework 程序在 Windows Mobile 设备的后台运行的最佳方式是什么？我需要响应不同的事件，例如带有特定内容的文本消息。我不想在进程启动时启动任何 UI，而只是在后台运行直到需要 UI。

如何才能做到这一点 ？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-26T00:00:46.313

只需将应用程序创建为控制台应用程序。如果您需要消息泵，则需要不带任何参数调用 Run，而 CF 没有。[SDF](http://www.smartdeviceframework.com)中的OpenNETCF 的[Application2 类](http://opennetcf.com/library/sdf/html/2105e26d-8657-81a4-f0f7-b569ddab14fa.htm)确实如此。此时，您可以像往常一样通过创建和显示表单来随时提升 UI。

您无法使用托管代码为 CE 或 WinMo 创建真正的服务，因为不支持 EE 托管。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-22T03:41:31.750

这个项目怎么样？

[managedserviceswm.codeplex.com](http://managedserviceswm.codeplex.com)

# asp.net - 生成 HTML 和 Excel 的 ASP.Net Web 服务器控件

> ID：236185
> 
> 赞同：3
> 
> 时间：2008-10-25T10:04:39.070
> 
> 标签：asp.net, excel, reporting, servercontrols

我正在开发一个包含大量报告的 Web 应用程序。这些报告相当基本，但有些报告有多个数据集或嵌入的图表。关键要求之一是每个报告都可以导出到 Excel。报表的 Excel 版本已断开连接，应该与 Web 报表看起来相同（或非常相似）。这包括值的格式、单元格样式、行/列数、图表等。

我遇到的问题是我看过的 ASP.Net 报告工具在创建报告方面做得很好，但是导出到 Excel 并没有我想要的那么强大。ASP.Net 电子表格工具在生成 Excel 工作表方面做得很好，但它们不提供在浏览器中查看信息的方法，而无需在本地下载并在 Excel 中查看它们。

有什么建议么？谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-25T11:28:23.580

[Infragistics](http://www.infragistics.com)有一些相当强大的 Web 控件，其中之一是可以导出到 Excel 的网格。Excel 导出组件允许您格式化结果、添加图像和其他内容，因此它应该满足您的需求。

Infragistics 的唯一问题是他们的 API 非常……什么词……笨重？因此，需要一些工作来适应，并且通常需要大量代码才能正确完成工作。但最终的结果是好的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-25T10:25:19.527

SQL 服务器附带的 MS Reporting Services 可以生成非常高保真的 Excel 电子表格。

否则，您可以使用 Excel Services 和 Excel Viewer Web 部件对 MOSS Enterprise 执行此操作。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-25T12:23:01.170

如果您只想生成只是单元格数据而不是图表的 Excel 文档，您可以使用 Excel 的 XML 标记，不是 OpenXML 规范版本，而是标准的 Microsoft Excel XML 格式。

我的博客上有一个如何实现这一目标的示例：[http](http://www.aaron-powell.com/blog.aspx?id=1237) ://www.aaron-powell.com/blog.aspx?id=1237 。如果您确实想做图表，我不能 100% 确定它是否支持这种方式。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-18T12:09:06.030

您可以使用[SpreadsheetGear](http://www.spreadsheetgear.com/)生成报告的 Excel 版本，包括宏和格式。该产品为您提供完整的编程控制，以创建符合 97 - 07 的电子表格。

# perl - 如何将曲线拟合到直方图分布？

> ID：236195
> 
> 赞同：5
> 
> 时间：2008-10-25T10:18:59.400
> 
> 标签：perl, integer, equation, curve-fitting, data-partitioning

前几天有人通过电子邮件问我一个关于整数分区的问题（因为我发布了一个 Perl 模块，Integer::Partition，来生成它们），我无法回答。

背景：这里是7的所有整数分区（每行之和等于7）。

```
7
6 1
5 2
5 1 1
4 3
4 2 1
4 1 1 1
3 3 1
3 2 2
3 2 1 1
3 1 1 1 1
2 2 2 1
2 2 1 1 1
2 1 1 1 1 1
1 1 1 1 1 1 1 
```

现在，如果我们查看每个分区的长度并计算每个长度有多少：

```
1 1
2 3
3 4
4 3
5 2
6 1
7 1 
```

...我们看到一个分区的长度为 1 (7)，一个分区的长度为 7 (1 1 1 1 1 1 1)。有 4 个长度为 3 的分区：(5 1 1)、(4 2 1)、(3 3 1)、(3 2 2)。

对于较大数量的 N，如果您绘制分区长度的分布图，则会出现一条不对称曲线，向原点倾斜。如果您好奇，请绘制以下 N=40 的分区长度计数。

1兆

如果您对生成这些分布计数感兴趣，这是我使用的代码：

```
#! /usr/local/bin/perl

use strict;
use warnings;

use Integer::Partition;

my $n = shift || 1;

while (1) {
    my $start = time;
    my $i = Integer::Partition->new($n);
    my %size;
    while (my $p = $i->next) {
        $size{scalar @$p}++;
    }

    open my $out, '>>', "bucket-count.out";
    for my $s (sort {$a <=> $b} keys %size) {
        print $out "$n\t$s\t$size{$s}\n";
    }
    close $out;
    my $delta = time - $start;
    print "$n\t$delta secs\n";
    ++$n;
} 
```

（注意：在我的电脑上，生成 N=90 大约需要 10 分钟）。

所以我的问题是：什么方程可以用来匹配观察到的分布曲线？它是高斯分布（高斯分布可以是不对称的吗？）还是泊松分布，还是别的什么？

我如何解决它的N？如果我记得我高中的数学，我可以通过求解导数与 0 相交的时间来确定峰值。如何产生导数？我在网上搜索过，但我得到的只是深奥的数学论文。我只需要一些代码:)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-25T11:12:40.820

我认为泊松分布是一个合理的估计。鉴于假设您的问题现在转向寻找最大频率 k 之一，给定 N。我认为您有两种方法：

1.  从数学的角度弄清楚（我会从[组合](http://en.wikipedia.org/wiki/Combinatorics)数学开始，但这可能不是一个特别好的指导）
2.  假设它是泊松，并测量任何给定 N 的峰值，如上所述。

一旦你有了峰值 (k)，估计 lambda 应该很简单（尝试一些）并且你有你的曲线。

另一种方法是在 python 中完成整个工作并在 numpy 或 scipy 板上询问:-)

高温高压

# visual-studio-2008 - 在 Visual Studio 2008 中为具有非标准扩展名的文件着色的语法

> ID：236202
> 
> 赞同：4
> 
> 时间：2008-10-25T10:26:23.830
> 
> 标签：visual-studio-2008

我可能在这里遗漏了一些非常明显的东西。我有扩展名为 .st 的文件，其中包含（大部分）C++ 代码。当我用 Visual Studio 打开它时，我希望那里的 C++ 突出显示。我去工具->选项->文本编辑器->文件扩展名。我在“扩展”框中输入“st”并选择“Microsoft Visual C++”作为编辑器（我也尝试了“源代码编辑器”，但没有帮助）。但我仍然没有得到语法着色。还有其他方法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-25T10:46:50.310

我刚刚尝试过，正如您所描述的那样，它工作正常，尽管我不得不关闭 .st 文件并重新打开它以查看更改。

# html - 为什么设置 doctype 时，h1 标签在 div 中显示不同？

> ID：236203
> 
> 赞同：4
> 
> 时间：2008-10-25T10:28:42.907
> 
> 标签：html, css

我有一个 div，`<h1>`在 div 中有一个标签，没有边距。如果我定义任何文档类型，则 div 上方会出现一个空格。

如果我删除`<h1>`标签或删除 doctype 定义，则没有空格（应该有。为什么？

示例 HTML：

```
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
    "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
    <style>
        body { 
          margin:0
        }
        #thediv {
          background-color:green
        }
    </style>
</head>
<body>
    <div id="thediv">
        <h1>test</h1>
    </div>
</body>
</html> 
```

问题是绿色div上面的空格，去掉DOCTYPE，空格消失，把`<h1>`tag 改成`<b>`，空格也消失。它发生在任何文档类型（XHTML/HTML、严格/过渡/等）

发生在几乎所有浏览器中（使用[http://browsershots.org](http://browsershots.org)）。有趣的是，唯一似乎正确显示它的浏览器是 Internet Explorer 6.0..

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-25T10:51:19.943

根据[CSS 规范](http://www.w3.org/TR/CSS21/box.html#collapsing-margins)，绿色 div 上方的空间是正确的行为。这是因为 h1 的上边距与 div 的上边距相邻。

将 h1 的边距保持在 div 内的一种方法是为 div 添加边框：

```
#thediv{ background-color:green; border: 1px transparent solid; } 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-25T10:43:50.863

这可能与某些浏览器在没有文档类型（或存在格式错误的类型）的情况下调用的“怪癖”模式有关。

我建议您[重置](http://meyerweb.com/eric/thoughts/2007/05/01/reset-reloaded/)页面的 CSS 并继续。生命太短暂了。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-25T10:41:23.473

DOCTYPE 信号标准模式；这就是 IE6 显示它“正确”（实际上是错误的）的原因，因为它的标准支持很烂。基本上，在标准模式下，它遵循规范中定义的 CSS 布局规则，而不是您所期望的（“怪癖模式”）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-25T10:39:38.330

请参阅[http://www.opera.com/docs/specs/doctype/](http://www.opera.com/docs/specs/doctype/)和[http://hsivonen.iki.fi/doctype/](http://hsivonen.iki.fi/doctype/)。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-25T16:50:38.430

您在这里有几个问题：

1.  没有 DOCTYPE 会使浏览器使用“怪癖模式”，而不是按照标准解释您的代码。这是为旧的“标签汤”代码设计的 - 如果您正在编写新代码，您应该使用 DOCTYPE 并对其进行验证。

2.  浏览器可以自由地为 HTML 元素提供“默认样式”。如果你想让你的页面看起来不同，你必须指定如何。大多数页面至少指定`body`和`div`元素的样式。您还想控制`h1`元素，因此您也需要对其进行样式设置。

# python - 是否有任何用 python 编写的基于 Web 的电子邮件客户端？

> ID：236205
> 
> 赞同：4
> 
> 时间：2008-10-25T10:30:57.753
> 
> 标签：python, email

我需要在我当前的 python web 应用程序中集成一个电子邮件客户端。有什么可用的吗？

LE：我正在 CherryPy 之上构建我的应用程序

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2013-11-18T07:40:16.057

对于可能找到此线程的其他人，请查看[Mailpile](http://www.mailpile.is/)。我还没有使用它，它是一个基于 python 的邮件客户端，我相信它也可以被修改为一个 webmail 应用程序。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-28T03:23:37.700

你可以试试[Quotient](https://launchpad.net/quotient)。这是一个有点不寻常的 webmail 系统，它肯定不会像 CherryPy 那样适合同一个进程——但它是在 Python 中的；）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-25T10:45:09.253

您可以构建一个，使用[电子邮件](http://docs.python.org/library/email.html)生成和解析邮件，使用[imaplib](http://docs.python.org/library/imaplib.html#module-imaplib)读取（和管理）来自您的邮件服务器的传入邮件，以及使用[smtplib](http://docs.python.org/library/smtplib.html)向世界发送邮件。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-25T15:14:41.477

在[pypi](http://pypi.python.org/pypi)上查找[webmail](http://pypi.python.org/pypi?%3Aaction=search&term=webmail&submit=search)给了[后世](http://pypi.python.org/pypi/Posterity/)。

[很可能有一些方法可以使用Zope3](http://www.zope.org/Products/Zope3)组件或其他一些 CMS构建 web 邮件，只需很少的工作。

我想如果你正在编写一个 webapp，你可能正在使用一种流行的框架。我们需要知道哪个可以给出更具体的答案。

# java - Java - 包含变量的抽象类？

> ID：236211
> 
> 赞同：30
> 
> 时间：2008-10-25T10:37:35.320
> 
> 标签：java, class, variables, abstract

让抽象类定义实例变量是一种好习惯吗？

```
public abstract class ExternalScript extends Script {

    String source;

    public abstract void setSource(String file);

    public abstract String getSource();
} 
```

子类 ExternalJavaScript.class 然后会自动获取源变量，但我觉得如果所有子类自己定义源而不是继承，则代码更容易阅读。

你有什么建议？

/亚当

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2008-10-25T10:52:28.303

我会认为这样的事情会好得多，因为您要添加一个变量，那么为什么不限制访问并使其更清洁呢？你的 getter/setter 应该按照他们在罐子上说的去做。

```
public abstract class ExternalScript extends Script {

    private String source;

    public void setSource(String file) {
        source = file;
    }

    public String getSource() {
        return source;
    }
} 
```

回到问题上来，你有没有在阅读 getter/setter 代码时费心查看它的位置？如果它们都进行了获取和设置，那么您在阅读代码时无需担心函数的“作用”。还有一些其他的原因需要考虑：

*   如果源代码受到保护（子类可以访问），那么代码就会变得混乱：谁在更改变量？当它是一个对象时，当你需要重构时它会变得很困难，而一种方法往往会使这一步更容易。
*   如果您的 getter/setter 方法没有获取和设置，则将它们描述为其他内容。

总是想你的课是否真的是一个不同的东西，这应该有助于决定你是否需要更多的东西。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-10-25T10:40:47.047

当然……为什么不呢？
抽象基类只是为了方便将 2 个或多个类共有的行为和数据存放在一个地方，以提高存储和维护的效率。它是一个实现细节。
但是请注意，您没有在应该使用接口的地方使用抽象基类。请参阅[接口与基类](https://stackoverflow.com/questions/56867/interface-vs-base-class)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-25T11:49:29.347

当然。抽象类的整个想法是它们可以包含一些您需要所有子类包含的行为或数据。想想 WheeledVehicle 的简单示例——它应该有一个 numWheels 成员变量。您希望所有子类都具有此变量。请记住，抽象类在开发 API 时是一个非常有用的功能，因为它们可以确保扩展您的 API 的人不会破坏它。

# .net - 是否有 Windows 窗体本机方式来闪烁窗体的标题栏？

> ID：236220
> 
> 赞同：2
> 
> 时间：2008-10-25T10:43:52.423
> 
> 标签：.net, winapi, .net-2.0

Windows 窗体中是否有正确的方法来闪烁标题栏而不必下降到 P/Invoking FlashWindow？

出于兼容性和大小的原因，我使用 .NET 2.0，所以也许我只是错过了该方法，因为它位于 .NET 框架的较新版本中。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-25T11:21:34.657

不，我不这么认为。PInvoking 该`FlashWindowEx`方法是我认为的唯一方法。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-25T11:36:32.783

MSDN：[System.Windows.Form.Activate()](http://msdn.microsoft.com/en-us/library/system.windows.forms.form.activate.aspx)

如果这是活动应用程序，则激活表单会将其置于最前面，如果这不是活动应用程序，则它会闪烁窗口标题。表单必须可见，此方法才能生效。

支持：3.5、3.0 SP1、3.0、2.0 SP1、2.0、1.1、1.0

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-25T11:43:52.823

@DrJokepu：

.Activate() 方法，在 2.0 中，也将窗口带到前面，尽管文档说了什么（即前面的其他应用程序失去焦点）。刚试过这个。

不幸的是，这正是我试图避免的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-25T17:30:16.197

如果您确实找到了一种“.NET”方式，它可能会在幕后调用 p/invoke。

这不是 Java，您不必害怕操作系统。

# networking - 如何为我的应用程序选择多播地址？

> ID：236231
> 
> 赞同：71
> 
> 时间：2008-10-25T10:57:05.937
> 
> 标签：networking, udp, multicast, ipv4

我应该如何为我的应用程序选择 IPv4 多播地址？我可能需要不止一个（最终可能需要整个范围），但只是想避免与其他应用程序发生冲突。

*   数据包将完全包含在管理域中，可能是 LAN
*   如果我的应用程序的多个独立实例在同一个网络上使用，它们每个都可以使用自己的多播地址 - 但如果它们不这样做，它们无论如何都可以共存，它们只会有少量的开销忽略彼此的包。
*   我的数据包已经包含一个“幻数”以避免出现问题
*   我将检查发起者地址（我知道当然可以被欺骗）、TTL 和其他东西，以防止意外的数据包搞砸。

请想法:)

目前我刚刚从“本地使用”空间中分配了一个任意一个，239.255.42.99

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2008-11-03T08:26:59.123

It seems you've already found [`http://www.iana.org/assignments/multicast-addresses`](http://www.iana.org/assignments/multicast-addresses), so you've done the right thing by picking an address from the `239.255/16` range.

As those ranges are entirely for site-local use it's no ones else's business which particular address you pick, but you *may* need to coordinate with the network manager (assuming that's not you) to pick an alternate address pool.

As others have suggested, just make sure there's an easy way to change the address just in case it does conflict with another address on the local LAN.

If the multiple applications issue becomes a problem, provide a (locally) well-known multicast address which the applications can talk to which will issue unique local-scope IP addresses for clients' use.

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-25T12:51:47.403

如前所述，允许配置范围。但更进一步，不需要配置。您选择范围并在必要时允许配置覆盖。

您的应用程序中应该有一些逻辑来处理外部数据包，通过日志或其他机制提醒用户您的应用程序已检测到来自另一个应用程序的多播数据包，并提供有关如何更改配置的说明。

如果事实证明存在冲突，请在彩票中玩这些数字！

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-03T07:47:58.750

Have you seen this ?

[MADCAP](http://www.networksorcery.com/enp/protocol/madcap.htm)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-25T11:10:54.817

如果只是供内部使用，那么为什么不将地址范围外部化为配置并继续使用内部使用。

[互联网号码分配机构](http://www.iana.org/numbers/)负责分配 IP 地址。他们不分配给 ISP 或个人，但他们有[信息](http://http://www.iana.org/numbers/)根据您所在的地区在哪里获得分配的号码。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-05-28T06:46:47.767

[ZMAAP是](https://datatracker.ietf.org/doc/html/draft-ietf-zeroconf-zmaap)[MADCAP](https://www.rfc-editor.org/rfc/rfc2730)的零配置替代方案。我怀疑它是否有任何公共源代码实现。如果你找到一个，那么我想知道它。

# .net - .NET：使用配置文件选择具体类

> ID：236235
> 
> 赞同：1
> 
> 时间：2008-10-25T11:00:23.327
> 
> 标签：.net, inversion-of-control, interface, configuration-files, concreteclass

*（这个问题专门在 C# 中，但一般适用于 .NET）*

我有一个大型应用程序，它的设计相当不错，并且通过接口分为主要部分（这样做是为了帮助并行开发）。

我们现在有一组主要的具体类来实现所需的接口，但我们也有额外的具体类集用于替代情况和测试。

目前，我们将所有这些类放在代码的顶层：

```
IMyInterface xComponent = new ConcreteXComponent1(); 
```

如果我想换出组件，那么我只需要更改该行并重新编译：

```
// IMyInterface xComponent = new ConcreteXComponent1();
IMyInterface xComponent = new ConcreteXComponentAlternative(); 
```

这很好用，但显然需要重新编译——我宁愿使用配置文件中的值选择具体类。

使用配置文件更改具体类的标准模式是什么？有没有我可以使用的标准库来为我解决这个问题？

谢谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-25T11:07:28.100

您想查看 IoC 容器。（Spring.NET、StructureMap、Windsor 等）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-25T11:17:03.930

您可以使用该`Activator.CreateInstance`方法。其中一种方法重载采用类型名称并使用默认构造函数创建它的实例。然后，您可以将类的类型名称存储在您的配置文件中并从您的应用程序中读取它。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-25T11:03:57.843

试试工厂模式

[http://en.wikipedia.org/wiki/Abstract_factory_pattern](http://en.wikipedia.org/wiki/Abstract_factory_pattern)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-25T11:29:39.833

使用 IoC 容器将创建一个可以动态加载的对象池或对象集合。Romain 建议的框架将使用描述对象及其实例化方式的配置文件。

# sql - 行在自己的列中，具体取决于它们的值

> ID：236236
> 
> 赞同：3
> 
> 时间：2008-10-25T11:01:23.637
> 
> 标签：sql, select

我有一个选择查询，目前产生以下结果：

```
Description   Code    Price
 Product 1     A        5
 Product 1     B        4
 Product 1     C        2 
```

使用以下查询：

```
SELECT DISTINCT np.Description, p.promotionalCode, p.Price
FROM            Price AS p INNER JOIN
                         nProduct AS np ON p.nProduct = np.Id 
```

我想制作以下内容：

```
Description  A  B  C
 Product 1   5  4  2 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-25T11:27:47.297

```
SELECT 
    np.Id, 
    np.Description, 
    MIN(Case promotionalCode WHEN 'A' THEN Price ELSE NULL END) AS 'A',
    MIN(Case promotionalCode WHEN 'B' THEN Price ELSE NULL END) AS 'B',
    MIN(Case promotionalCode WHEN 'C' THEN Price ELSE NULL END) AS 'C'
FROM 
    Price AS p 
INNER JOIN nProduct AS np ON p.nProduct = np.Id
GROUP BY 
    np.Id,
    np.Description 
```

* * *

这是一个简单的测试示例：

```
DECLARE @temp TABLE (
    id INT,
    description varchar(50),
    promotionalCode char(1),
    Price smallmoney
)

INSERT INTO @temp
select 1, 'Product 1', 'A', 5
    union
SELECT 1, 'Product 1',  'B', 4
    union
SELECT 1, 'Product 1', 'C', 2

SELECT
    id,
    description,
    MIN(Case promotionalCode WHEN 'A' THEN Price ELSE NULL END) AS 'A',
    MIN(Case promotionalCode WHEN 'B' THEN Price ELSE NULL END) AS 'B',
    MIN(Case promotionalCode WHEN 'C' THEN Price ELSE NULL END) AS 'C'
FROM
     @temp
GROUP BY 
    id,
    description 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-25T14:06:52.513

如果您使用的是 SQL Server 2005，则可以使用新的 PIVOT 运算符。

简单 PIVOT——客户为单个产品下的订单数量。

简单订单表的结构：

```
CREATE TABLE Sales.[Order]
    (Customer varchar(8), Product varchar(5), Quantity int) 
```

该表包含以下值：

```
Customer Product Quantity
    Mike     Bike    3
    Mike     Chain   2
    Mike     Bike    5
    Lisa     Bike    3
    Lisa     Chain   3
    Lisa     Chain   4 
```

例如：Order 表上的 PIVOT 操作：

```
SELECT *
    FROM Sales.[Order]
    PIVOT (SUM(Quantity) FOR Product IN ([Bike],[Chain])) AS PVT 
```

此查询的预期输出为：

```
Customer Bike Chain
Lisa        3    7
Mike        8    2 
```

如果您不使用 SQL Server，则可以为您的数据库搜索“pivot”。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-25T12:05:29.840

达克沃斯的回答很好。如果您可以为每个单元格获取多个值，则可能需要使用 AVG 或 SUM 而不是 MIN，具体取决于您要查看的内容。

如果您的 DBMS 支持它，您可能还想查看交叉表查询或数据透视查询。例如，MS Access 具有交叉表查询。

# sql - 使用 SQLite 查找查询中的行差异

> ID：236239
> 
> 赞同：7
> 
> 时间：2008-10-25T11:05:29.430
> 
> 标签：sql, sqlite, limit, xulrunner

我有一个*SQLite*表，其中包含各种产品的价格。这是一个快照表，因此它包含 5 分钟间隔的价格。我想编写一个查询，返回每个项目从一行到下一行的价格差异。

列是 id（汽车公司）、record_id（产品的 id）、价格（当时的价格）、时间（距纪元仅几秒）

我正在尝试返回一个“差异”列，其中包含间隔之间的差异值。

```
鉴于以下

id record_id 价格时间
1 苹果001 36.00 ...
67 苹果001 37.87 ...
765 苹果001 45.82 ...
892 苹果001 26.76 ...

我希望它返回
id record_id 价格时差
1 苹果001 36.00 ... 0
67 苹果001 37.87 ... 1.87
765 苹果001 45.82 ... 7.95
892 苹果001 26.76 ... -19.06

```

SQLite可以吗？

其次，是否有可能 - 有没有办法将其限制为最后 5 条左右的记录？

我会很感激任何帮助，谢谢。

* * *

只是想补充一些东西。我在其他数据库中找到了这样做的方法，但我使用的是 XULRunner，因此使用的是 SQLite。这就是我改用它的原因。

第二个问题可能需要澄清，我希望按时间订购并分析最后 5 条记录。如果需要，我可以单独解决这个问题。

这是一个 MySQL[解决方案](http://www.freeopenbook.com/mysqlcookbook/mysqlckbk-CHP-12-SECT-13.html)。这是我正在走向的方法，但交易破坏者是“如果表包含序列列但存在间隙，请重新编号。如果表不包含这样的列，请添加一个”。根据设计，这种情况存在差距，因为一次更新了许多记录并且不会按顺序进行。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-25T11:58:20.450

我不知道 SQLite 是否有一些限制，但是您可以尝试以下在 Sql Server 中工作的语句。

如果时间差是恒定的（你说它是 5 分钟），你可以写：

```
SELECT A.id, A.record_id, A.price, A.time, ISNULL(A.price - B.price, 0) AS difference
FROM Table1 as A 
    LEFT OUTER JOIN Table1 B ON A.record_id = B.record_id AND A.time - B.time = 5 
```

否则

```
SELECT A.id, A.record_id, A.price, A.time, ISNULL(A.price - B.price, 0) AS difference
FROM Table1 as A 
    LEFT OUTER JOIN Table1 B ON B.record_id = A.record_id 
         AND B.time = (SELECT MAX(time) FROM Table1 C WHERE C.time < A.time AND C.record_id = A.record_id) 
```

没有连接的语句如下

```
SELECT id, record_id, price, time,
    (SELECT A.price - B.price
        FROM Table1 as B
        WHERE B.record_id = A.record_id AND
            B.time = (SELECT MAX(time) FROM Table1 C WHERE C.time < A.time AND C.record_id = A.record_id)) AS difference
FROM Table1 as A 
```

我希望其中一位能帮助你。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2020-04-03T21:24:45.697

是的，**有点晚了**，但为了完整性。*2018 年的 SQLite Release 3.25.0 增加了对窗口函数的支持*。现在可以使用[LAG() 和 LEAD()](https://www.sqlite.org/windowfunctions.html)函数完成上述任务。

取自：[https ://www.sqlitetutorial.net/sqlite-window-functions/](https://www.sqlitetutorial.net/sqlite-window-functions/)

**LAG** *提供对位于当前行之前的给定物理偏移量的行的访问。*

因此，在 Linux 中使用 sqlite3 命令，以下内容应与您的问题中列出的输出相匹配。前 2 个命令仅用于显示正确的输出格式。

```
sqlite> .mode columns
sqlite> .headers on
sqlite> CREATE TABLE data(id INT, record_id TEXT, price REAL);
sqlite> INSERT INTO data VALUES(1,"apple001",36.00);
sqlite> INSERT INTO data VALUES(67,"apple001",37.87);
sqlite> INSERT INTO data VALUES(765,"apple001",45.82);
sqlite> INSERT INTO data VALUES(892,"apple001",26.76);
sqlite> SELECT id, record_id, price, (price - LAG(price, 1) OVER (ORDER BY id)) AS difference FROM data;
id          record_id   price       difference
----------  ----------  ----------  ----------
1           apple001    36.0                  
67          apple001    37.87       1.87      
765         apple001    45.82       7.95      
892         apple001    26.76       -19.06 
```

我希望这将为新用户节省一些时间。

# sql-server-2005 - 我可以通过 SSH 隧道进行 SQL Server 2005 合并复制吗？

> ID：236242
> 
> 赞同：7
> 
> 时间：2008-10-25T11:12:19.603
> 
> 标签：sql-server-2005, ssh, replication, vpn, tunnel

我们的用例是一个负责帐户、会话、许可证等的数据库——它需要在客户端启动时进行轮询，因此高可靠性至关重要。因此，我们希望在物理上独立的网络中跨不同服务器进行复制，以防整个数据中心发生故障。我已经成功设置了对同一网络中另一台服务器的推送订阅，所以这通常有效。这是我现在需要开始工作的与网络*外部*服务器的连接。

复制不能直接跨网络工作。Microsoft[建议使用 VPN 或 Web 复制](http://msdn.microsoft.com/en-us/library/ms151319(SQL.90).aspx)。后者让我觉得效率低下（他们确实说“注意：Web 同步是为与便携式计算机、手持设备和其他客户端同步数据而设计的。Web 同步不适用于大容量的服务器到服务器应用程序。”）

前者，VPN，可以工作，但我仍然认为它是一个不必要的复杂解决方案（更不用说增加的安全问题的可能性），以持续运行 VPN 连接。**我宁愿只运行一个 SSH 隧道。**然而，我找不到任何文章解释如何做到这一点，而不是关于 MySQL。

我在订阅者上设置了一个 SSH 服务器，并使用 PuTTY 建立了一个从`<publisher>:1434`到的隧道`<subscriber>:1433`。但是，我无法让 SQL Server Management Studio 以这种方式连接（我不确定它是否支持`:`端口语法）。我还在`<publisher>`的 SQL Server 配置管理器上设置了一个别名，其中`@@servername`of`<subscriber>`指向`localhost:1434`. 连接到那个似乎也不起作用。

我使用了推送订阅选项，所以我认为发布者需要连接到订阅者，而不是相反。

两台服务器都使用默认实例，并在 Windows Server 2003 SP 2 上运行 SQL Server 2005 SP 2。订阅服务器上的 SSH 服务器是 freeSSHd 1.2.1。

这可能吗？有没有另一种方法可以利用 SSH 来假装机器存在于同一个网络中？还是我必须使用VPN？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-28T09:29:49.533

当您谈论服务器的不同位置时，这是否也意味着不同的域？您对 Web 复制的评论是正确的，但仅适用于对数据库所做的日常更改。您的初始快照可以是任意大小，即使它是一个巨大的数据库。如果您的每日更新是有限的（对我来说几 1000 次似乎没问题），那就去吧。很快！

编辑：

当您开始考虑在服务器之间交换数据时，存在一个主要的域/安全问题。如果您需要通过 VPN 或任何专用链接连接属于不同域的服务器，并且如果您不想通过 SQL 安全（避免它！），您将面临与域信任相关的特定（和许可！）问题. Web 复制的聪明之处之一是通过通过 https 协议保护连接来避免此类问题（和额外成本）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-10-18T23:30:51.387

我知道这是一篇旧文章，但希望这会有所帮助：SQL Server Management Studio 使用逗号将主机与端口分开。

[如何在 SQL Management Studio 中指定不同的端口号？](https://stackoverflow.com/questions/89576/how-do-you-specify-a-different-port-number-in-sql-management-studio)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2019-09-03T04:45:02.623

作为从业者，我认为 SSH 隧道（它允许客户端调用自身以调用服务器）不会起作用。如果您打开 ssh 隧道，您可能需要保持 ssh 会话打开。SSH 不适合将长时间打开的连接作为第一优先级，它会失败。

最好的选择是一个合适的虚拟专用网络（不是那些来自互联网的代理服务器每年向您收取 10 美元）。如果您想节省成本，可以使用 OpenVPN。VPN 的好处是所有这些节点（数据库服务器）都可以假装它们在同一个本地网络中并且......它会工作。

# asp.net - ASP.NET MVC - 包括 JS 文件

> ID：236248
> 
> 赞同：0
> 
> 时间：2008-10-25T11:21:48.273
> 
> 标签：asp.net, javascript, asp.net-mvc

我正在玩 MVC 并开始建立一个我们用标准 .Net Forms 构建的现有站点。

我只包含一个 JS 文件，并且由于所有请求都通过 .Net 路由，因此它正在尝试编译它。

这是您在无效 c# 中看到的标准编译错误：

CS1012：字符文字中的字符过多

你如何防止客户资产被编译？

非常感谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-25T12:31:11.167

我已经解决了我的问题。我的母版页中有脚本标记，声明中有 runat="server"。然后这让 .NET 尝试编译包含的 JavaScript 文件？我在 .NET 2.0 中非常高兴地做到了这一点，没有任何问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-27T00:38:31.323

据我所知，这是自 ASP.NET 1.0 以来 ASP.NET 的行为。任何带有 runat="server" 的标签都会被解释为服务器代码，而不是客户端脚本。

# algorithm - 如何自动计算轴刻度和间隔？

> ID：236261
> 
> 赞同：9
> 
> 时间：2008-10-25T11:32:29.487
> 
> 标签：algorithm, graph

有谁知道我在哪里可以找到一种算法，该算法给定轴的一组值（日期），我可以计算出合理的比例和刻度间隔？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-25T12:56:46.627

滴答间隔将取决于您的显示区域。您需要考虑图表的宽度（我假设时间在 X 轴上）和所选字体中日期字符串的宽度，以便得出良好的比例。

基本算法将是这样的。

*   扫描日期列表以查找最小值和最大值。
*   将图形宽度除以日期字符串宽度（如果*两个*宽度都是恒定的，则可以将结果存储在变量中）。如果您使用固定宽度字体和 MM-DD-YYYY 日期格式，此步骤会更容易。如果您使用可变宽度字体和日期格式来拼写月份的名称，则需要在字符串中添加额外的填充以确保每个日期字符串的宽度相同。请注意，我说的是 *extra* 填充。即使您使用固定的日期格式，您也需要至少填充一个空格以避免拥挤。我将把这个值称为“ticks”，因为它正是你的轴上的多少个刻度将根据你的图表的宽度来拟合。
*   计算最短日期和最长日期之间的天数（含）。如何执行此操作取决于您使用的语言。希望你有好的日期和日历实现可以依靠。我将把这个值称为“天”。
*   使用公式“interval = days / (ticks - 1)”计算刻度间隔。
*   通过将“间隔”添加到您的最短日期直到达到最长日期，确定哪些天属于刻度间隔。同样，这将取决于您使用的语言。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-27T05:42:24.970

我一直在使用 jQuery [flot](http://flot.googlecode.com/)图形库。它是开源的，并且可以很好地生成轴/刻度线。我建议查看它的代码并从中汲取一些想法。

# php - 将 PHP 函数转换为 JavaScript

> ID：236279
> 
> 赞同：2
> 
> 时间：2008-10-25T11:48:32.297
> 
> 标签：php, javascript

```
<?php
function toconv(string)
{
    $gogo = array("a" => "b","cd" => "e");
    $string = str_replace(
        array_keys( $gogo ),
        array_values( $gogo ),
        $string
    );
    return $string;
}
?> 
```

我如何在 JavaScript 中实现它？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-25T13:00:50.423

并以某种方式实现，您可以直接从数组中进行操作：

```
<script type="text/javascript">
function toconv(string){
    var gogo = {"a":"b", "cd":"e"}, reg;
    for(x in gogo) {
        reg = new RegExp(x, "g");
        string.replace(x, gogo[x]);
    }
    return string;
}
</script> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-25T11:59:36.437

Javascript 中的 String.replace() 接收正则表达式而不是字符串，这是一个翻译。您需要将 g 修饰符附加到正则表达式以替换所有出现而不是仅替换第一个。

```
<script>
function toconv(str) {
    replacements = ['b','e'];
    regexes = [/a/g,/cd/g];

    for (i=0; i < regexes.length; i++) {
       str = str.replace(regexes[i],replacements[i]);
    }
    return str;
}

alert(toconv('acdacd'));
alert(toconv('foobar'));
</script> 
```

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2015-10-14T06:56:24.980

将 PHP 函数转换为 JavaScript

```
if (preg_match('/0/', $check) || preg_match('/1/', $check) || preg_match('/2/', $check) || preg_match('/3/', $check) || preg_match('/4/', $check) || preg_match('/5/', $check) || preg_match('/6/', $check) || preg_match('/7/', $check) || preg_match('/8/', $check) || preg_match('/9/', $check))
{
    exception("personal info not allowed");
    redirect(base_url() . 'edit_profile');
}
else if ((preg_match("~\b@\b~",$check)) || (preg_match("~\b.net\b~",$check)) || (preg_match("~\b.com\b~",$check)) || (preg_match("~\b@\b~",$check)) || (preg_match("~\b.edu\b~",$check)) || (preg_match("~\b.gov\b~",$check)))
{
    exception("personal info not allowed");
    redirect(base_url() . 'edit_profile');
} 
```

# json - 使用 JSon 和 Prototype 的 Ajax.Request 问题

> ID：236283
> 
> 赞同：2
> 
> 时间：2008-10-25T11:53:58.900
> 
> 标签：json, prototypejs

我正在使用以下函数从“PlayListJSON.aspx”加载歌曲播放列表，但似乎有些错误，evrytime OnFailure 被调用，我无法进一步调试它。任何帮助都将是真正的 gr8。

```
Player.prototype.loadPlaylist = function(playlistId, play) {
  req = new Ajax.Request('/PlaylistJSON.aspx?id=' + playlistId, {
    method: 'GET',
    onSuccess: function(transport, json) {
      eval(transport.responseText);

      player.setPlaylist(playlist.tracklist, playlist.title, playlistId);
      player.firstTrack();

      if (play) player.playSong();
    },
    onFailure: function() {
      //error
    }
  });
} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-25T12:11:19.513

通常，当您调用的页面由于某种原因无法访问时，会调用 OnFailure。

您确定 URL **/PlaylistJSON.aspx**有效吗？

* * *

您是否尝试过传递参数参数而不是将它们指定为 url 的一部分？

```
req = new Ajax.Request('/PlaylistJSON.aspx', 
    { 

        method: 'GET',    
        parameters:  {
                     'id': playlistId
                     },
        onSuccess: function(transport,json){                                                                                    

            eval(transport.responseText);                              

            player.setPlaylist(playlist.tracklist,playlist.title, playlistId);
            player.firstTrack();

            if (play)
                player.playSong();  

         },
         onFailure: function() {
           //error

         }
     }); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-11T11:43:46.913

If you are developing in windows install [Fiddler](http://www.fiddlertool.com/fiddler/). With [Fiddler](http://www.fiddlertool.com/fiddler/) you will be able to see exactly what request is doing the Ajax call and what response comes from the server. This way you will know if the url is right, or if the server is responding some status code different from 200/OK.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-25T12:12:51.193

是的，Page PlayListJSon.aspx 位于根目录中。

# language-agnostic - 垃圾收集可以与显式内存管理共存吗？

> ID：236290
> 
> 赞同：8
> 
> 时间：2008-10-25T12:01:14.840
> 
> 标签：language-agnostic, garbage-collection, computer-science, theory

例如，假设在 C# 4 中包含一个“删除”关键字。由于基于引用的系统，是否可以保证您永远不会有野指针，但仍然能够依赖垃圾收集器?

我可以看到它可能发生的唯一方法是，如果不是对内存位置的引用，而是对指向实际对象的指针表的索引。但是，我确信在某些情况下会破坏，并且有可能破坏类型安全/具有悬空指针。

编辑：我说的不是.net。我只是以 C# 为例。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-25T12:27:23.313

你可以 - 有点：让你的对象一次性，然后自己处理。

手动删除不太可能提高托管环境中的内存性能。它可能有助于非托管资源，处置的全部内容。

我宁愿更容易实现和使用 Disposable 对象。我不知道这应该是什么样子，但是在 .NET 下管理非托管资源是一个冗长的痛苦。

* * *

实现删除的一个想法：删除标记一个手动删除的对象。在下一个垃圾回收周期中，该对象被删除，所有对它的引用都设置为 null。

起初听起来很酷（至少对我而言），但我怀疑它是否有用。这也不是特别安全 - 例如，另一个线程可能正忙于执行该对象的成员方法，例如在访问对象数据时需要抛出这样的方法。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-25T12:13:59.740

使用垃圾回收，只要您有对对象的引用引用，它就会保持活动状态。使用手动删除，您无法保证。

示例（伪代码）：

```
obj1 = new instance;
obj2 = obj1;

// 

delete obj2;
// obj1 now references the twilightzone. 
```

简而言之，将手动内存管理与垃圾收集相结合违背了 GC 的目的。此外，何苦呢？如果你真的想拥有控制权，请使用 C++ 而不是 C#。;-)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-25T12:14:32.080

你能得到的最好的结果是划分成两个“半球”，其中一个半球被管理，并且可以保证没有悬空指针。另一个半球有明确的内存管理并且不提供任何保证。这两者可以共存，但是不行，你不能给第二半球强硬的保证。您所能做的就是跟踪所有指针。如果一个被删除，那么指向同一实例的所有其他指针都可以设置为零。不用说，这是相当昂贵的。您的表会有所帮助，但会引入其他成本（双重间接）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-25T23:04:31.357

我的第一反应是：为什么不呢？我无法想象您想要做的事情只是在堆上留下一个未引用的块以便稍后再次找到它。好像一个指向堆的四字节指针太多了，以至于无法跟踪这个块。

所以问题不在于分配未引用的内存，而是有意处置仍在引用中的内存。由于垃圾收集在某些时候执行了将内存标记为空闲的功能，因此我们似乎应该能够调用备用指令序列来处理这个特定的内存块。

然而，问题出在这里：

```
String s = "Here is a string."; 
String t = s;
String u = s;
junk( s ); 
```

做什么`t`和`u`指向什么？在严格的参考体系中，`t`应该`u`是`null`. 所以这意味着你不仅要进行引用*计数*，还可能要进行*跟踪*。

但是，我可以看到您*应该*在代码中完成`s`这一点。因此`junk`可以将引用设置为 null，并使用某种优先级代码将其传递给清扫器。gc 可以被激活以进行有限的运行，并且只有在无法访问时才释放内存。所以我们不能明确地释放任何人已经编码以再次以某种方式使用的东西。*但是*如果`s`是唯一的引用，那么块就会被释放。

所以，我认为它只能在*有限*地遵守*明确*的一面的情况下工作。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-25T14:43:20.943

Chris Sells 也在 .NET Rocks 上讨论了这个问题。我想那是在他第一次露面时，但在后来的采访中可能会重新讨论这个话题。

[http://www.dotnetrocks.com/default.aspx?showNum=10](http://www.dotnetrocks.com/default.aspx?showNum=10)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-08-15T00:10:20.957

在 C++ 等非托管语言中，这是可能的，并且已经实现。基本上，您实现或使用现有的垃圾收集器：当您需要手动内存管理时，您可以正常调用 new 和 delete，而当您需要垃圾收集时，您可以调用 GC_MALLOC 或任何用于垃圾收集器的函数或宏。

有关示例，请参见[http://www.hpl.hp.com/personal/Hans_Boehm/gc/ 。](http://www.hpl.hp.com/personal/Hans_Boehm/gc/)

由于您使用 C# 作为示例，因此您可能只想在托管语言中实现手动内存管理，但这是为了向您展示相反的情况是可能的。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-08-16T08:48:16.920

这将有助于具有长寿命对象的情况。当对象在短时间内使用并快速取消引用时，垃圾收集工作得很好。问题是当某些对象存在很长时间时。清理它们的唯一方法是执行资源密集型垃圾收集。

在这些情况下，如果有一种方法可以显式删除对象，或者至少有一种方法可以将对象图移回第 0 代，事情就会变得容易得多。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-01-30T04:14:09.710

如果对象引用上的删除语义将使引用该对象的所有其他引用为空，那么您可以使用 2 级间接（比您提示的多 1 级）来执行此操作。尽管请注意，虽然底层对象将被销毁，但必须在堆上保持固定数量的信息（足以保存引用）。

用户使用的所有引用都会引用真实对象的隐藏引用（可能存在于堆中）。当对对象进行某些操作时（例如调用方法或依赖其标识，例如使用 == 运算符），程序员使用的引用将取消引用它指向的隐藏引用。删除对象时，实际对象将从堆中删除，隐藏引用将设置为 null。因此，参考程序员会看到评估为空。

清除这些隐藏的引用将是 GC 的工作。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2011-12-19T19:11:38.320

是的……但有一些滥用。

可以稍微滥用 C# 来实现这一点。如果您愿意使用`Marshal`类、`StructLayout`属性和`unsafe code`，您可以编写自己的手动内存管理器。

您可以在此处找到该概念的演示：[Writing a Manual Memory Manager in C#](http://www.liranchen.com/2011/08/writing-manual-memory-manager-in-c.html)。

# qa - 您从 QA 收到的最可疑的错误报告是什么？

> ID：236294
> 
> 赞同：12
> 
> 时间：2008-10-25T12:05:14.490
> 
> 标签：qa, bug-reporting

偶尔你会收到一个错误报告，通常是来自可能还没有完全理解产品的 QA 新手，这会让你大吃一惊。

我将从一个我的团队（开发人员和 QA）在它发生几年后仍然笑的开始。

我正在开发的产品有一个带有一组按钮的工具栏，可以切换应用程序状态的某些方面。我收到了一个错误报告，上面写着“当你按下按钮 [x] 时，它会卡住。你必须再次按下它才能让它松开。”

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-10-25T12:13:14.203

> > 我无法读取输入密码的字段。当我在这个字段中输入时，它只显示圆圈。

我发誓这是来自专业的 QA 测试人员，而不是来自用户。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-01-08T16:21:35.090

你读过一个故事[“我们不能发送超过 500 英里的电子邮件”](http://www.ibiblio.org/harris/500milemail.html) :)

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2008-10-29T03:13:26.283

这是我最喜欢的错误报告和响应，归属于很久以前的“vmsnet.misc”新闻组 **。****DEC**是 Digital Equipment Corporation，对于年轻人来说，**VMS**是当时更好的操作系统之一。

> 这本书的作者是“Stanley Rabinowitz”，他是 DEC 世界著名的 SMG$ 库、WHAT 实用程序和 VMS 的许多其他部分的作者。因此，这可能是他的版权，但他现在已经离开了 DEC。
> 
> 发布日期：1983 年 14 月 14 日 @ 03:08:00 主题：我的 SPR 答案（供您查看）
> 
> 弹簧编号：11-60903
> 
> 答案类别：UE 维护时间：1 重复问题：N 重复 SPR 编号：
> 
> 操作系统：VAX/VMS
> 操作系统版本：V3.2 产品：VAX/VMS 产品版本：V3.2 组件：运行时库 子组件：
> LIB$ 例程
> 
> 答复日期：
> 1983 年 10 月 13 日
> 
> 维护者：斯坦利·拉比诺维茨
> 
> 附件：N
> 
> 出版说明：N
> 
> SPR 问题摘要：用户声称 2000 年不应是闰年。
> 
> 标题： - 出版物： - 其他操作系统版本： 其他产品版本： 组件序列号： 取代：
> 文章类型：
> 
> ```
>  ANSWER CATEGORIES 
> ```
> 
> CG=1=更正
> RS=5=限制
> SG=9=建议 FN=2=在下一个版本中修复 CS=6=客户支持
> IQ=10=查询 DE=3=文档错误 NR=7=不可复制
> 硬件= 11=硬件 UE=4=用户错误
> II=8=信息不足
> 
> ```
>  TYPE OF ARTICLE 
> ```
> 
> F=可选功能补丁 N=注意 M=强制补丁
> R=限制
> 
> ```
>  FOR MAINTENANCE USE
> 
>                         D I G I T A L
> 
>                        SPR ANSWER FORM 
> ```
> 
> SPR 编号 11-60903
> 
> ```
>  SYSTEM   VERSION   PRODUCT   VERSION   COMPONENT SOFTWARE:  VAX/VMS 
> ```
> 
> V3.2 VAX/VMS V3.2 运行库
> 
> 问题：
> 
> LIB$DAY 运行时库服务“错误地”假定 2000 年是闰年。
> 
> 回复：
> 
> 感谢您的前瞻性 SPR。
> 
> 各种系统服务，例如 SYS$ASCTIM 假设 2000 年将是闰年。虽然人们永远无法确定未来某个时间会发生什么，但有一个强有力的历史先例可以假设现在的公历到 2000 年仍然有效。由于我们也希望到那时 VMS 仍然存在，我们选择遵守这些先例。
> 
> 日历的目的是提前计算时间，显示在未来发生某个事件之前必须经过多少天，例如收获或 VMS V6 的发布。最早的历法自然是粗糙的，往往基于季节或月球周期。
> 
> 例如，亚述人的日历是基于月相的。他们知道一个月亮（从一个满月到下一个满月的时间）是 29 1/2 天，所以他们的农历年有 354 天。这比太阳年少了大约 11 天。太阳年的准确时间约为 365 天 5 小时 48 分 46 秒。3年后，这样的阴历会差一整月，所以亚述人不时增加一个月，以保持他们的日历与季节同步。
> 
> 古代可能的最佳近似值是 19 年，这 19 年中有 7 年有 13 个月（闰月）。该方案被采纳为犹太人使用的宗教日历的基础。阿拉伯人也使用这个日历，直到穆罕默德禁止将 12 个月改为 13 个月。
> 
> 当罗马成为世界强国时，制作日历的困难是众所周知的，但罗马人因为迷信偶数不吉利而使他们的生活变得复杂。因此，他们的月份是 29 或 31 天，除了 2 月有 28 天。每隔一年，罗马日历就会增加一个称为 Mercedonius 的月份，即 22 或 23 天，以跟上太阳年。
> 
> 甚至这个算法也很差，所以在公元前 45 年，凯撒在天文学家索西吉内斯的建议下，下令进行彻底的改革。下令将一年定为 445 天，以使历法与季节同步。与我们现在使用的类似的新日历称为儒略历（以朱利叶斯凯撒命名）。它的月份长度为 30 或 31 天，每四年为闰年（有 366 天）。凯撒还下令从一月一日开始，而不是三月下旬的春分。
> 
> 凯撒的年份比 Sosigenes 建议的计算时间少 11 1/2 分钟，最终春分的日期开始漂移。罗杰·培根惊慌失措，给教皇克莱门特四世写了一封信，他显然没有留下深刻的印象。教皇西斯图斯四世后来确信需要进行另一次改革，并召集德国天文学家雷吉奥蒙塔努斯到罗马为他提供建议。不幸的是，雷吉奥蒙塔努斯不久后死于瘟疫，计划也宣告失败。
> 
> 1545年，特伦特议会授权教皇格里高利十三世再次改革历法。大部分数学工作是由 SJ 的克里斯托弗·克拉维乌斯神父完成的。立即通过的修正是 1582 年 10 月 4 日星期四是儒略历的最后一天。第二天是星期五，日期为 10 月 15 日。为了获得远距离精度，采用了梵蒂冈图书管理员 Aloysius Giglio 建议的公式。它说每隔四年是闰年，除了不能被400整除的世纪年。因此1700、1800和1900不会是闰年，但2000年将是闰年，因为2000可以被400整除。这条规则消除了每 4 个世纪有 3 个闰年，使得日历对于大多数普通用途来说都足够正确。这个日历被称为公历，是我们今天使用的日历。有趣的是，在 1582 年，所有新教王子都无视教皇法令，因此许多国家继续使用儒略历，直到 1698 年或 1752 年。在俄罗斯，它需要革命在 1918 年引入公历。
> 
> 这就解释了为什么 VMS 选择将 2000 年视为闰年。
> 
> 尽管公历非常准确，但每隔几年它仍然略微落后。如果您非常关心这个问题，我们建议您收听短波电台 WWV，该电台播放美国官方时间信号。大约每 3 年一次，他们会宣布闰秒，此时您应该小心调整系统时钟。如果您无法接收到他们的信号，我们建议您购买原子钟（不是由 Digital 制造，目前也不是 VAX 选项）。
> 
> ```
>  END OF SPR RESPONSE 
> ```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-14T02:16:10.763

> “悬停炮塔似乎漂浮在半空中。”

为什么是。对，他们是。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-01-14T02:42:01.880

昨天处理了这个：

问题报告 X：“启用分组后 FileSize 列仍然可见。应该隐藏 FileSize 列。”

（问题已解决）

问题报告 Y，在部署修复后立即出现：“启用分组后，FileSize 列消失。”

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-11-17T15:35:39.590

QA 人员打电话给我，告诉我同事代码中的错误（程序员兼同事那天病了）。她抱怨基于 Web 的登录屏幕中的某些字段为浅黄色（姓名等），而其他字段则不是。这很容易解释——我刚刚在程序员生病前一天向他解释过——这是谷歌工具栏的自动填充试图提供帮助。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-10-27T15:37:34.520

我有一个错误报告说一个按钮“变成蓝色”。

原来，测试人员报告了 Windows 按钮的正常行为，即带有焦点的按钮的非常微妙的蓝色突出显示。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-11-27T05:39:59.460

“素数生成器认为 2 是素数。”

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-11-27T05:53:56.750

用户在 5 分钟内没有使用计算机进行任何操作后屏幕变黑。用户付费请人为他们重新安装 Windows。将来，也许我最好在我为他人工作的所有 PC 上禁用电源管理选项。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-01-14T02:47:11.980

我收到了一个缺陷，仅说明了这一点：

`"It is wrong"`

我不得不回过头来弄清楚*它*到底是什么。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-10-29T02:08:55.040

这不是来自 QA，而是当我在支持团队时。

我们曾经收到一个客户的报告，说他们系统中的 20GB 硬盘不够大，他们想订购一个“更大的 d#ck”（我会让你填空）。

我真的很惊讶这封电子邮件通过了我们的垃圾邮件过滤器。毫不奇怪，它做了很多工作。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-10-29T03:27:14.353

“页面设计/颜色与补偿不匹配。”

如果他们不将页面与线框进行比较，那就不会那么奇怪了。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2014-01-22T21:38:40.023

同一位 QA 人员在几分钟内创建了两个缺陷。1 - 无法删除值，因为没有删除值按钮，2 - 当清空值并点击保存时，值被删除。

不管是好是坏，这个应用程序中的标准是通过消隐和保存来删除值。显然她希望改变标准。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2012-05-02T13:39:22.813

“有时一面旗帜会飘过屏幕，而我们看不到*其他任何东西*！”。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-10-29T03:17:43.217

因为我们确实正确地验证了货币字段（针对 ISO 列表），所以打开了一个错误。他们打开它是因为用例说：货币 [alpha-num]，所以他们期望“2”作为有效货币。

我仍然在问自己关于那个。

# image - 如何使粉红色背景的图标透明？

> ID：236322
> 
> 赞同：2
> 
> 时间：2008-10-25T12:29:08.800
> 
> 标签：image, image-manipulation, icons

我正在使用 Visual Studio 图标库（VS2008ImageLibrary），有一些粉红色背景的 BMP 文件。我怎样才能让粉红色的背景变得透明？我可以使用什么软件来做到这一点？有免费的吗？

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-25T12:35:50.000

我使用了 IrfanView 的批量转换工具。这仍然是一些工作，因为您必须单击每个图标上的粉红色区域，而不是仅仅将粉红色指定为透明颜色，但它确实有效。不过，使用 GDI+ 编写一个简单的转换工具会很容易，我也考虑过。

请注意，即使您可以将它们用作透明图像，但不幸的是，当您在深色背景上渲染它们或将它们用作叠加层时，它们中的许多仍然具有难看的边缘。如果您只想要其中的很少一部分，如果您认为您并不总是拥有明亮的背景，请考虑单独调整它们。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-25T12:41:51.203

你可以[在线尝试，](http://www.gifworks.com/cgi-bin/gifworks.pl?com=transfer_open)前提是你可以先将你的 bmp 转换为 gif。

或者您可以获取[PAINT.Net （免费软件），并按照此](http://www.getpaint.net/index.html)[视频说明](http://revver.com/video/1057314/create-transparent-background-using-paintnet/)应用透明背景。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2014-02-23T21:13:14.627

您可以使用 ImageMagick 转换来做到这一点：

```
convert input.png -transparent magenta  output.png 
```

顺便说一句，它不是粉红色，而是洋红色。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-25T12:46:49.037

虽然我不知道现代 .NET 对您的问题的回答，但值得注意的是这些具有洋红色背景的位图的历史原因：

早在只有 Win32 的日子里，有一些通用控件（如工具栏和 ListView）将这些位图和一种颜色视为透明，然后将该颜色呈现为透明。我想，在幕后，他们使用了像[TransparentBtl](http://msdn.microsoft.com/en-us/library/dd145141(VS.85).aspx)这样的功能。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-28T01:12:42.703

我知道这与 Form.TransparencyKey 有关，但我不知道粉红色到底是什么，你必须知道确切的 RGB / 系统或 Web 颜色。

如果你知道请分享我们

# .net - 比较两个非整数的整数部分的最佳方法是什么？

> ID：236323
> 
> 赞同：2
> 
> 时间：2008-10-25T12:30:33.257
> 
> 标签：.net, integer, double, compare

我需要比较两个双精度的整数部分是否不相等，我目前正在这样做：

```
int iA = (int)dA;
int iB = (int)dB;

if( iA != iB )
{
    ...
} 
```

但我想知道是否有比这更好的方法。

谢谢。

如果我使用 Math.Truncate() 而不是强制转换为 int，那么比较两个得到的双精度值是否相等仍然准确吗？

关于匈牙利符号评论：

我自己从不使用 HN，至少不像大多数人那样使用。但这是变量的语义与其类型直接相关的罕见情况之一。我本可以选择另一种语法，例如 A_As_Integer 和 B_As_NonInteger，但那会有什么区别呢？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-25T12:42:14.650

使用 Math.Truncate() 即

```
if (Math.Truncate(x) == Math.Truncate(y)) 
```

[编辑] 意识到如果您要比较双精度的整数部分，如果您的双精度超出可以表示为 int 的范围，则转换为 int 值首先会存在溢出的风险。

截断返回 Decimal 或 double，避免了这个问题。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-25T12:36:00.437

是的，这是最好的方法。

假设您在问题中的措辞不担心四舍五入……只是整数部分本身。

IE。(int)4.1 将给出与 (int)4.9 相同的结果

*正如 Ovid 所说，如果您只需要比较变量，那么您只需要在比较语句中转换双精度数。我只看理论。*

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-25T12:36:30.217

就个人而言，我尽量避免创建额外的变量，除非我需要它们。

```
if ( (int)dA != (int)dB ) {
    ...
} 
```

随着代码随着时间的推移而发展，无目的的额外变量会导致混乱。当然，如果您需要这些变量，那是另一个问题 :)

旁注：您似乎试图通过简单的匈牙利符号来暗示数据类型。我可以建议不要这样做吗？如果您必须为变量添加信息前缀，请尝试为变量的用途添加前缀，而不是其类型。如果你这样做，代码中的错误会更容易看到：

```
if ( (int)ageA != (int)idB ) {
    ...
} 
```

在这种情况下，甚至不知道数据是什么，看到您正在尝试将“年龄”与“身份证”进行比较，这是一个很好的线索，表明这里有问题。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-25T13:34:37.847

我同意截断是你想要的。

[来自MSDN](http://msdn.microsoft.com/en-us/library/c2eabd70.aspx)的一些有用信息：

截断返回任何小数位被丢弃后剩余的数字。

它向零舍入到最接近的整数。

```
double floatNumber;

floatNumber = 32.7865;
// Displays 32      
Console.WriteLine(Math.Truncate(floatNumber));

floatNumber = -32.9012;
// Displays -32       
Console.WriteLine(Math.Truncate(floatNumber)); 
```

# c++ - 当我计算一个大的阶乘时，为什么我得到一个负数？

> ID：236335
> 
> 赞同：1
> 
> 时间：2008-10-25T12:38:28.340
> 
> 标签：c++, signed, factorial

所以，简单的程序，计算一个阶乘数。代码如下。

```
int calcFactorial(int num)
{
    int total = 1;

    if (num == 0)
    {
        return 0;
    }

    for (num; num > 0; num--)
    {
        total *= num;
    }

    return total;
} 
```

现在，对于大多数数字来说，这工作得很好而且很漂亮（当然有更快、更优雅的解决方案，但这对我有用）。但是，当输入更大的数字（例如 250）时，坦率地说，就是废话。现在，250 的前几个阶乘“位”是 { 250, 62250, 15126750, 15438000, 3813186000 } 以供参考。

我的代码吐出 { 250, 62250, 15126750, 15438000, **-481781296** } 这显然是关闭的。我的第一个怀疑可能是我违反了 32 位整数的限制，但鉴于 2^32 是 4294967296，我不这么认为。我唯一能想到的可能是它违反了有**符号**的32 位限制，但它不应该能够考虑这种事情吗？如果被签名是问题，我可以通过使整数无符号来解决这个问题，但这只是一个临时解决方案，因为下一次迭代产生 938043756000 远高于 4294967296 限制。

那么，我的问题是签名限制吗？如果是这样，我能做些什么来计算大数（虽然我有一个“LargeInteger”类我前一段时间可能适合！）而不会再次遇到这个问题？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-10-25T12:41:50.890

2^32 没有给你有符号整数的限制。

有符号整数限制实际上是[2147483647](http://msdn.microsoft.com/en-us/library/296az74e(VS.80).aspx)（如果您使用 MS 工具在 Windows 上进行开发，其他工具套件/平台将有自己的限制，可能类似）。

[您将需要一个像这样](http://mattmccutchen.net/bigint/)的 C++ 大量库。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-10-25T12:46:25.903

除了其他评论之外，我想指出您的代码中的两个严重错误。

*   你对负数毫无防备。
*   零的阶乘是一，而不是零。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-10-25T12:43:19.670

是的，你达到了极限。根据定义，C++ 中的 int 是有符号的。而且，呃，不，C++ 永远不会思考。如果你告诉它做一件事，它就会做，即使它显然是错误的。

考虑使用大量库。对于 C++，它们中有很多。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-25T12:44:36.907

如果您不指定有符号或无符号，则默认为有符号。您可以使用编译器上的命令行开关来修改它。

请记住，C（或 C++）是一种非常低级的语言，并且完全*按照您的指示去做*。如果你告诉它把这个值存储在一个有符号的 int 中，它就会这样做。**作为程序员，你**必须弄清楚什么时候会出现问题。这不是语言的工作。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-25T12:50:20.183

我的 Windows 计算器 ( *Start-Run-Calc* ) 告诉我

```
hex (3813186000) =         E34899D0
hex (-481781296) = FFFFFFFFE34899D0 
```

所以是的，原因是签名限制。由于阶乘在定义上只能是正数，并且只能为正数计算，因此参数和返回值都应该是无符号数。（我知道每个人都使用`int i = 0`for 循环，我也是。但抛开这一点，如果值不能为负，我们应该始终使用无符号变量，这是 IMO 的好习惯）。

阶乘的一般问题是，它们很容易生成*非常*大的数字。您可以使用浮点数，从而牺牲精度但避免整数溢出问题。

哦等等，根据我上面写的，你应该把它设为一个无符号浮点数;-)

* * *

## 回答 #6

> 赞同：-3
> 
> 时间：2008-10-25T12:42:38.393

如果我没记错的话：

无符号短整数 = 最大值 65535

无符号整数 = 最大值 4294967295

无符号长 = 最大值 4294967295

unsigned long long (Int64)= max 18446744073709551615

### 编辑来源：

[Int/Long 最大值](http://home.att.net/%7Ejackklein/c/inttypes.html#int)

[现代编译器变量](http://www.cplusplus.com/doc/tutorial/variables.html)

# asp.net - 适用于 Amazon S3 的 .NET 库或 asp.net 应用程序

> ID：236346
> 
> 赞同：7
> 
> 时间：2008-10-25T12:46:33.983
> 
> 标签：asp.net, amazon-s3

我希望有一个基于 Web 的管理员来上传、删除 ASP.NET 网站上 Amazon S3 中的文件和文件夹。
我很确定这样的东西已经存在，有人见过吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-25T13:03:55.737

你试过这个吗？[http://www.codeplex.com/ThreeSharp](http://www.codeplex.com/ThreeSharp)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-20T22:27:30.490

[LitS3](http://code.google.com/p/lits3/)效果很好

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-01-03T21:23:18.990

[Cloudberry 有一些很酷的产品，我喜欢除了资源管理器之外的备份。](http://www.cloudberrylab.com)

# asp.net-mvc - ASP.Net MVC - 处理错误的 URL 参数

> ID：236349
> 
> 赞同：16
> 
> 时间：2008-10-25T12:47:20.253
> 
> 标签：asp.net-mvc, url, error-handling

处理构建自己的 URL 并用他们喜欢的任何东西替换我们期望的 ID 的访问者的最佳方法是什么？

例如：

[ASP.Net MVC - 处理错误的 URL 参数](https://stackoverflow.com/questions/236349)

但用户可以轻松地将 URL 替换为：

[https://stackoverflow.com/questions/foo](https://stackoverflow.com/questions/foo)

我考虑过让每个控制器函数参数 a `String`，并`Integer.TryParse()`在它们上使用 - 如果通过了，那么我有一个 ID 并且可以继续，否则我可以将用户重定向到一个未知/未找到或索引视图。

Stack Overflow 可以很好地处理它，我也想这样做 - 你是怎么做的，或者你有什么建议？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-10-26T02:14:59.413

这是一个像你这样的路线的例子，对数量有限制：

```
routes.MapRoute(
    "Question",
    "questions/{questionID}",
    new { controller = "StackOverflow", action = "Question" },
    new { questionID = @"\d+" } //Regex constraint specifying that it must be a number.
); 
```

这里我们设置 questionID 至少有一个数字。这也将阻止任何包含除整数以外的任何 url，并且还可以防止需要可为空的 int。

*注意：*这不考虑大于 Int32 (-2147483647 - +2147483647) 范围的数字。我将此作为练习留给用户解决。:)

如果用户输入 url “questions/foo”，他们将不会点击 Question 操作，并通过它，因为它失败了参数约束。如果需要，您可以在包罗万象/默认路由中进一步处理它：

```
routes.MapRoute(
    "Catchall",
    "{*catchall}", // This is a wildcard routes
    new { controller = "Home", action = "Lost" }
); 
```

这会将用户发送到 Home 控制器中的 Lost 操作。可以在[此处](http://richarddingwall.name/2008/08/09/three-common-aspnet-mvc-url-routing-issues/)找到有关通配符的更多信息。

**注意：Catchall 应该作为 LAST 路由驻留。**考虑到 ASP.NET MVC 中路由的惰性特性，将其置于链的更上方意味着它将处理其下方的所有其他路由。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-26T00:08:19.030

这里有一些有用的信息可能会有所帮助。如果你有一个动作方法

```
public ActionResult Edit(int? id)
{} 
```

那么如果有人输入

```
/Home/Edit/23 
```

参数 id 将为 23。但是如果有人输入

```
/Home/Edit/Junk 
```

那么 id 将是 null 这很酷。我认为它会抛出一个演员错误或什么的。这意味着如果 id 不是空值，那么它是一个有效的整数，可以传递给您的服务等以进行数据库交互。

希望这可以为您提供一些我在测试时发现的信息。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-25T13:13:49.783

在 ASP.NET MVC 中，您可以定义一个实现 IActionFilter 接口的过滤器。您将能够使用此属性装饰您的操作，以便在您的操作之前、之前或之后执行它。

在您的情况下，您将定义它在您的操作“之前”执行。因此，如果传递的参数中有错误，您将能够取消它。这里的主要好处是您只需编写检查传递参数一次的代码（即您在过滤器中定义它）并在控制器操作中的任何地方使用它。

在此处阅读有关 MVC 过滤器的更多信息：http: [//haacked.com/archive/2008/08/14/aspnetmvc-filters.aspx](http://haacked.com/archive/2008/08/14/aspnetmvc-filters.aspx)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-25T13:30:06.687

您可以将约束指定为正则表达式或定义自定义约束。请查看此博客文章以获取更多信息：

[http://weblogs.asp.net/stephenwalther/archive/2008/08/06/asp-net-mvc-tip-30-create-custom-route-constraints.aspx](http://weblogs.asp.net/stephenwalther/archive/2008/08/06/asp-net-mvc-tip-30-create-custom-route-constraints.aspx)

您仍然需要处理 id 43243 没有映射到可以作为 IActionFilter 或直接在控制器中处理的任何内容的情况。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-25T12:50:55.987

这种方法的问题是它们仍然可能传递一个不映射到页面的整数。如果他们这样做，只需返回 404，就像使用“foo”一样。除非您有明确的安全隐患，否则无需担心。

# c++ - 接受用户输入时的错误处理

> ID：236354
> 
> 赞同：1
> 
> 时间：2008-10-25T12:50:59.043
> 
> 标签：c++

我是 C++ 的初学者，我有一个小问题：

我的代码向用户显示一个简单的菜单，提供三个选项：

```
cout << "\nQuadratic equation: a*X^2 + b*X + c = 0 main menu: "; 
cout << "\n <r>  Give new coefficients"; 
cout << "\n <c>  Calculate equations solutions"; 
cout << "\n <t>  Terminate the program"; 
```

我现在想要的是，当用户输入时：

*   aer -> 输入了无效的输入，再试一次
*   1 或任何其他数字 -> 输入无效输入，重试
*   rt -> 输入了无效的输入，再试一次（这里第一个字符是正确的，但他输入了 2 个字符）
*   cf -> 输入了无效的输入，再试一次

仅当用户正确输入 3 个简单字符之一（r,c,t 非敏感案例）来做某事时。否则应打印无效输入消息，然后应再次出现主菜单

我试过这个但它不起作用：

```
char displayMainMenu()
{
char mainMenuChoice;
cout << "\nQuadratic equation: a*X^2 + b*X + c = 0 main menu: "; 
cout << "\n <r>  Give new coefficients"; 
cout << "\n <c>  Calculate equations solutions"; 
cout << "\n <t>  Terminate the program";
cout<<"Enter choice : ";
cin>>mainMenuChoice;
return mainMenuChoice;
}

int main()
{
bool done = false;
while(!done)
{
    char choice = displayMainMenu();  

    if( isalpha(choice) )
    {

        switch(tolower(choice))
        {
        case 'r':
            DoSTH1();
            break;
        case 'c':
            DoSTH2();
            break;  
        case 't':
            DoSTH3();                   
            break;
        default:
            cout<<"Invalid choice!\n"<<endl;
        }   

    }

}
return 0;
} 
```

我希望你能帮助我

添加：当我输入错误时，例如：cbbbbbb 它把它当作'c'

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-25T15:46:27.187

要通过“cbbb”被接受为“c”，您必须改为使用 getline() 读取一行。然后您可以检查是否只输入了一个字符，然后检查是哪个字符。

如果使用 cin 读取字符，它只会读取输入流中可用的第一个字符。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-25T12:59:27.993

更改此行：

```
cout<<"Enter choice : " << std::endl;
                    // ^^^^^^^^^^^^^^^ 
```

这个 print '\n' 然后强制缓冲区刷新到输出，以便可以读取它。

如果您只想刷新缓冲区：

```
cout<<"Enter choice : " << std::flush; 
```

删除 if 语句。不需要您使用开关进行错误检查。

```
// if( isalpha(choice) ) 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-25T13:00:42.513

首先，省略`if( isalpha(choice) )`. 它不是必需的，因为任何输入但`r`,`c`或`t`将落入 `default`.

实际上，这可能是您的问题的原因。如果输入的字符不是字母数字，函数将结束而不显示您的错误消息。

总的来说，我的建议是：不要想得太复杂。切换的美妙之处在于您可以对完全匹配采取行动，而*所有其他人*都将落入`default`

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-25T13:03:10.903

“我试过了，但没用”是什么意思？你得到什么输出？你的意思是它不编译？（它不会处于您展示它的状态）。你的意思是说这个程序比我们看到的更多，但它产生了意想不到的结果？我们无法调试这个。对于它的价值，我没有看到任何错误（除了它显然不完整）：

```
#include <iostream>
using namespace std;

char displayMainMenu() {
    char mainMenuChoice;
    cout << "\nQuadratic equation: a*X^2 + b*X + c = 0 main menu: ";
    cout << "\n <r>  Give new coefficients";
    cout << "\n <c>  Calculate equations solutions";
    cout << "\n <t>  Terminate the program";
    cout<<"\nEnter choice : ";
    cin>>mainMenuChoice;
    return mainMenuChoice;
}

int main() {
    bool done = false;
    while(!done) {
        char choice = displayMainMenu();

        if( isalpha(choice) ) {

            switch(tolower(choice))
            {
            case 'r':
                    cout << "got 'r'\n";
                    break;
            case 'c':
                    cout << "got 'c'\n";
                    break;
            case 't':
                    cout << "got 't'\n";
                    done = true;
                    break;
            default:
                    cout<<"Invalid choice!\n"<<endl;
            }
        }
    }
    return 0;
} 
```

和输出：

```
~ $ g++ input.cc -o input
~ $ ./input

Quadratic equation: a*X^2 + b*X + c = 0 main menu:
 <r>  Give new coefficients
 <c>  Calculate equations solutions
 <t>  Terminate the program
Enter choice : a
Invalid choice!

Quadratic equation: a*X^2 + b*X + c = 0 main menu:
 <r>  Give new coefficients
 <c>  Calculate equations solutions
 <t>  Terminate the program
Enter choice : c
got 'c'

Quadratic equation: a*X^2 + b*X + c = 0 main menu:
 <r>  Give new coefficients
 <c>  Calculate equations solutions
 <t>  Terminate the program
Enter choice : t
got 't'
~ $ 
```

**更新** 我看到它没有为非数字提供“无效选择”消息，但这可以通过删除“isalpha”检查来解决。

# java-me - 为诺基亚 5310 开发应用程序

> ID：236357
> 
> 赞同：2
> 
> 时间：2008-10-25T12:53:24.967
> 
> 标签：java-me, sms, nokia

编辑：

是否有任何其他电话系统允许连接到本机消息系统以读取作曲家中的输入？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-25T20:19:48.087

在标准 J2ME 中绝对没有办法做到这一点。

Symbian 手机将允许您编写与您描述的功能接近的 C++ 代码。

您可能无法直接查询文本编辑器 GUI 控件的内容，但您可以创建自己的消息模块并拥有自己的消息编辑器，或者您可以阅读本地商店的草稿和发件箱文件夹中的消息。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-25T14:22:33.770

5310 是基于 Series 40 的，所以我假设您无法从本地消息编辑器捕获输入。S40 平台相当封闭。

# python - 您区分要由外部调用的对象方法和要由子类调用的对象方法的约定是什么？

> ID：236359
> 
> 赞同：1
> 
> 时间：2008-10-25T12:54:37.303
> 
> 标签：python, subclass, private

我知道 Python 处理私有变量/成员/函数/...的方法的大部分来龙去脉。

但是，我无法决定如何区分外部使用的方法或子类使用的方法。

考虑以下示例：

```
class EventMixin(object):
    def subscribe(self, **kwargs):
        '''kwargs should be a dict of event -> callable, to be specialized in the subclass'''

    def event(self, name, *args, **kwargs):
        ...

    def _somePrivateMethod(self):
        ... 
```

在这个例子中，我想明确指出 subscribe 是一个由类/对象的外部用户使用的方法，而 event 是一个不应该从外部调用的方法，而应该由子类实现调用。

现在，我认为这两个部分都是公共 API，因此不要使用任何下划线。但是，对于这种特殊情况，例如，外部 API 不使用下划线，可子类化 API 使用一个下划线，私有/内部 API 使用两个下划线会感觉更简洁。但是，这将变得笨拙，因为需要调用内部 API

```
self._EventMixin__somePrivateMethod() 
```

那么，您的约定是什么，编码方面、文档方面或其他方面？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-25T13:26:57.710

```
use no underscores for the external API,
one underscore for the subclassable API,
and two underscores for the private/internal API 
```

这是一种合理且相对普遍的做法，是的。实际私有的双下划线（与 C++ 术语中的“保护”相反）在实践中非常罕见。您永远不会真正知道子类可能想要覆盖哪些行为，因此假设“受保护”通常是一个不错的选择，除非有充分的理由说明与成员搞乱可能特别危险。

```
However, that would become unwieldy because then the internal API would
need to be invoked as self._EventMixin__somePrivateMethod() 
```

不，你可以只使用双下划线的版本，它会自动被修改。这很丑陋，但它有效。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-25T15:45:28.280

我通常发现使用 double __ 会带来更多麻烦，因为它使单元测试非常痛苦。使用单个 _ 作为不打算成为特定类/模块的公共接口一部分的方法/属性的约定是我的首选方法。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-26T12:48:00.323

我想提出的建议是，当您发现自己遇到这种区别时，考虑使用组合而不是继承可能是个好主意；换句话说，实例化`EventMixin`（可能名称会改变）而不是继承它。

# asp.net - 如何提供用于 Windows 和 Web 应用程序的 Session/Host 对象？

> ID：236362
> 
> 赞同：2
> 
> 时间：2008-10-25T12:56:41.027
> 
> 标签：asp.net, winforms, session, multi-tier

我有一个 Web 应用程序，它大量使用会话状态来存储有关当前用户、他们的个人设置、记录他们的会话历史等的信息。

我发现自己在业务层中检索此会话信息，如下所示：

```
((UserSession)HttpContext.Current.Session["UserSession"]).User.Info 
```

这带来了一个问题——在未来的某个时候，我的应用程序将有一个 Windows 客户端，它显然无法引用 Web 会话状态。因此，我需要一个可以在业务层中引用的主机或自定义会话类，它与应用程序是在 Web 上运行还是在桌面上运行无关。就像是：

```
IHost.User.Info 
```

在幕后，Web 实现显然会利用 Session 状态来存储信息，但我需要将其隐藏在业务层之外。有没有人解决了这个问题或得到任何关于如何最好地解决这个问题的实用建议？

帮助表示赞赏。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-25T14:08:45.813

假设业务层是一个单独的 DLL，我永远不会添加对对象的引用`System.Web`，因此我永远不会`Session`直接使用该对象。这将导致业务层和客户端（Web 或 Winforms）的公开接口的不同设计。

也就是说，作为一种快速解决方法，我建议在您的业务层中编写一个包装类，以隐藏`Session`您的代码中的对象。您的代码调用将是这样的：

```
((UserSession) DualContext.Current["UserSession"]).User.Info 
```

并且包装器实现将是这样的（未完成和测试）：

```
public class DualContext 
{
   private Dictionary<string, object> winFormsSession = new Dictionary<string, object>();
   private static readonly DualContext instance = new DualContext();

   public static DualContext Current
   {
      get {  return instance; }
   }

   public object this[string key]
   {
      get 
      {
         if (HttpContext.Current != null)
            return HttpContext.Current.Session[key];
         else
            return winFormsSession[key];
      }
      set 
      {
         if (HttpContext.Current != null)
            HttpContext.Current.Session[key] = value;
         else
            winFormsSession[key] = value;
      }
   }
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-25T14:47:02.773

这需要重新设计架构，但如果您从使用会话状态切换到用户配置文件，则可以使用客户端应用程序服务来共享信息。

[http://msdn.microsoft.com/en-us/library/bb384297.aspx](http://msdn.microsoft.com/en-us/library/bb384297.aspx)

* * *

## 回答 #3

> 赞同：-2
> 
> 时间：2008-10-25T13:04:41.180

我猜你需要创建一个 web 服务或 RESTfull 服务。该服务将返回一个表示您的用户信息的 XML 文件。您将能够从您的 Windows 或 Web 应用程序调用该服务。

# iphone - 你如何覆盖 iPhone 应用程序的图标？

> ID：236376
> 
> 赞同：4
> 
> 时间：2008-10-25T13:04:28.043
> 
> 标签：iphone, icons

我记得在某处读过，您可以提供自己的图标，而无需在编译 iphone 应用程序时让它们通过自动光泽效果，但我不记得如何做到这一点，也不知道它在文档中的位置。这里有人记得吗？

谢谢！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-25T13:11:49.757

将“UIPrerenderedIcon”添加到您的 info.plist 文件中，将其更改为布尔值并使其为真。（在 iPhone OS 2.0 中，您也可以将其保留为字符串并使用“是”或“否”，但在 2.1 中不再适用。）

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-25T14:02:17.530

斯蒂芬是正确的。在 2.1 中工作的确切语法是：

```
 <key>UIPrerenderedIcon</key>
    <true/> 
```

# .net - 将 POP3 客户端功能集成到 C# 应用程序中？

> ID：236381
> 
> 赞同：53
> 
> 时间：2008-10-25T13:09:57.720
> 
> 标签：.net, pop3, review

我有一个 Web 应用程序，它需要基于服务器的组件来定期访问 POP3 邮箱和检索电子邮件。然后，该服务需要处理涉及以下内容的电子邮件：

*   根据某些业务规则验证电子邮件（它是否在主题行中包含有效的引用、发送邮件的用户等）
*   分析任何附件并将其保存到磁盘
*   获取电子邮件正文和附件详细信息并在数据库中创建一个新项目
*   或更新引用与传入电子邮件主题行匹配的现有项目

解决这个问题的最佳方法是什么？我真的不想从头开始编写 POP3 客户端，但我需要能够自定义电子邮件的处理。理想情况下，我将能够插入一些为我进行访问和检索的组件，返回附件数组、正文、主题行等，以供我处理......

**[更新：评论]**

好的，所以我花了相当多的时间研究（主要是免费的）.NET POP3 库，所以我想对下面提到的一些库和其他一些库进行简短的回顾：

*   [Pop3.net](http://weblogs.shockbyte.com.ar/rodolfof/archive/2008/07/07/pop3.net-library.aspx) - 免费 - 工作正常，就提供的功能而言非常基本。这几乎只是 POP3 命令和一些 base64 编码，但它非常简单 - 可能是一个很好的介绍
*   [Pop3 向导](http://www.componentsource.com/products/seekford-net-pop3-wizard/index.html)- 商业/一些开源代码 - 无法构建，缺少 DLL，我不会为此烦恼
*   [C#Mail](http://www.codeplex.com/csharpmail) - 免费供个人使用 - 运行良好，附带 Mime 解析器和 SMTP 客户端，但是评论是日文的（没什么大不了的），它不适用于 SSL '开箱即用' - 我不得不更改 SslStream 构造函数，之后它没有问题
*   [OpenPOP](http://sourceforge.net/projects/hpop/) - 免费 - 大约 5 年没有更新了，所以它的当前状态是 .NET 1.0，不支持 SSL，但这没有问题要解决 - 我只是用 SslStream 替换了现有的流并且它工作。附带 Mime 解析器。

在免费库中，我会选择 C#Mail 或 OpenPOP。

我查看了一些商业库：[Chillkat](http://www.chilkatsoft.com/)、[Rebex](http://www.rebex.net/)、[RemObjects](http://remobjects.com/)、[JMail.net](http://tech.dimac.net/default2.asp?M=Products/MenuDOTNET.asp&P=Products/JMaildotnet/start.htm)。根据公司的功能、价格和印象，我可能会选择 Rebex，如果我的需求发生变化或者我遇到 C#Mail 或 OpenPOP 的生产问题，我可能会选择 Rebex。

如果有人需要，这是我用来使用 C#Mail 和 OpenPOP 启用 SSL 的替代 SslStream 构造函数：

```
SslStream stream = new SslStream(clientSocket.GetStream(), false,
                 delegate(object sender, X509Certificate cert,
                 X509Chain chain, SslPolicyErrors errors) { return true; }); 
```

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2010-12-25T11:56:00.887

我是[OpenPop.NET](http://sourceforge.net/projects/hpop/)的主要开发人员之一。我刚刚看完这篇评论，不得不对 OpenPop.NET 的当前状态发表一些评论，因为评论似乎随着开发的发展而过时。

OpenPop.NET 重新开始积极开发。SSL 已在半年前推出。该项目进行了重大重构，现在更加稳定和易于使用。当我接手这个项目时，它有很多错误，截至目前我一无所知。已经实现了很多额外的功能，主要是在 MIME 解析器部分。该项目由单元测试支持，每次发现错误时，都会创建一个单元测试以在修复之前显示此错误。现在有一个附有示例的[网站。](http://hpop.sourceforge.net/)还有其他更新，但我不想全部提及。

此外，OpenPop.NET 的许可证已从[LGPL](http://www.gnu.org/licenses/lgpl-3.0.txt)更改为[Public Domain](http://en.wikipedia.org/wiki/Public_domain)（又名，没有限制）。我认为这对商业用户来说是一个重大改进。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-25T14:57:28.600

我最近为一个项目实现了[OpenPop](http://sourceforge.net/projects/hpop/) ，对此我很满意。它按照它在锡上说的做。（而且它是免费的。）

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-12-24T14:50:04.517

SslStream类的构造函数被修改并上传。推荐版本使用没有问题。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2014-08-21T00:20:43.267

一个新选项（截至 2014 年）是Xamarin 的[MailKit](https://github.com/jstedfast/MailKit)，它在 MIT 许可下可用。它从磁盘解析消息的速度比 OpenPOP.NET 快 25 倍。它包括对 IMAP、POP3 和 SMTP 的支持，并且看起来非常快速和强大。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-25T14:51:53.823

[C# Mail](http://www.codeplex.com/csharpmail)在 Codeplex 上可用，并且非常易于使用。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2010-05-18T10:51:08.780

您可能希望在排名中包含[Mail.dll .NET 邮件组件](http://www.lesnikowski.com/mail/)。它具有 SSL 支持、Unicode 和多国电子邮件支持：

```
using(Pop3 pop3 = new Pop3())
{
    pop3.Connect("mail.host.com");      // Connect to server
    pop3.Login("user", "password");     // Login

    foreach(string uid in pop3.GetAll())
    {
        IMail email = new MailBuilder()
   .CreateFromEml(pop3.GetMessageByUID(uid));

        Console.WriteLine(email.Subject);
    }
    pop3.Close(true);  
} 
```

还支持 IMAP 协议。

请注意，这是我创建的**商业产品。**

你可以在这里下载：http: [//www.lesnikowski.com/mail](http://www.lesnikowski.com/mail/)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-25T17:32:05.193

看看我的开源应用程序 BugTracker.NET 中的 POP3 集成，网址为[http://ifdefined.com/bugtrackernet.html](http://ifdefined.com/bugtrackernet.html)。所有免费和开源。最难的部分是 mime 解析，由 SharpMimeTools 在 BugTracker.NET 中完成，网址为[http://anmar.eu.org/projects/sharpmimetools/](http://anmar.eu.org/projects/sharpmimetools/)

显示我如何使用 POP3 和 MIME 逻辑的重要文件是 POP3Client.cs 和 insert_bug.aspx。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-25T17:45:35.947

DasBlog 使用了一个很好的（而且免费的）——获取源包。我用过它（但我不记得是谁写的，而且我不在笔记本电脑上——Pavel LI 认为？）。它并不完美，而且它不使用 SSL，但它在其他方面工作得很好。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-12-08T14:04:19.767

[Lumisoft](http://www.lumisoft.ee/lsWWW/Download/Downloads/Net/)是开源的，包括一个 POP 客户端（以及其他东西）。已经存在很多年了，非常稳定。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2011-02-25T14:54:13.290

因为我不得不自动化一些电子邮件处理的事情。我使用了 OpenPop.net 我正在搜索如何使用这个库转发邮件消息并遇到了这个惊人的功能：[http ://hpop.sourceforge.net/documentation/OpenPop~OpenPop.Mime.Message.ToMailMessage.html](http://hpop.sourceforge.net/documentation/OpenPop~OpenPop.Mime.Message.ToMailMessage.html)

总而言之，我选择**了 OpenPop.Net**并推荐它！

最好的问候，JP

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-12-06T06:24:20.193

我制作了自己的 Mime 解析器并将其添加到 CodePlex，因为当涉及到奇怪的编码和奇怪的附件组合时，我一直遇到其他未处理的异常。pop3 客户端实现很粗糙，只是为了测试目的而制作的，但可以处理。Mime 解析器部分填充标准 MailMessage 对象，以便您可以轻松地转发它。我可以根据要求扩展/改进它，但现在它可以满足我的需要。随意检查一下。

[http://www.codeplex.com/mimeParser](http://www.codeplex.com/mimeParser)

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-10-25T13:19:48.180

在 codeproject.com 上有几个 POP3 客户端实现。我没有对它们进行评估，但也许你可以在那里找到你需要的东西。如果不是，我可以说 POP3 是一个非常简单的协议。如果您知道 4-5 个命令，您甚至可以使用 telnet 读取您的 POP3 框。

您实际上只需要[这些](http://www.pnambic.com/Goodies/POP3Ref.html)命令，也许还需要对附件进行一些 base64 解码。而已。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-10-25T13:23:26.533

[邮件.NET](http://www.dimac.net)。不要再看下去了。请注意，免费版本不包括 POP3。您需要使用标准版（或更多）。别担心，它不贵。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2009-07-11T21:38:19.023

如果您需要 SSL 来访问 gmail.. 这里是对提供 SSL 支持的 OpenPOP.net 库的一些修改。

[OpenPop.net 修改为包含 SSL 支持以访问 Gmail](http://trixcomp.blogspot.com/2009/07/c-pop3-library-with-ssl-for-gmail.html)

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-10-25T13:33:10.610

如果您不介意为组件付费，我们过去在 chilkat 方面取得了巨大成功。花几百美元，你就可以得到一个挤满了善良的图书馆。

# java - 让 stringTokenizer 将一行文本拆分为预定义变量的最佳方法是什么

> ID：236387
> 
> 赞同：2
> 
> 时间：2008-10-25T13:14:06.693
> 
> 标签：java, string, tokenize

我不确定标题是否很清楚，但基本上我要做的就是从文件中读取一行文本并将其拆分为 8 个不同的字符串变量。每行将有相同的 8 个块以相同的顺序（标题、作者、价格等）。因此，对于每一行文本，我想以 8 个字符串结尾。

第一个问题是该行的最后两个字段可能存在也可能不存在，所以我需要对 stringTokenizer.hasMoreTokens 做一些事情，否则当字段 7 和 8 不存在时它会乱七八糟地死掉。

理想情况下，我希望在 for 循环的一段时间内执行此操作，但我不确定如何告诉该循环字段的顺序是什么，以便它可以正确填充所有 8 个（或 6 个）字符串。请告诉我使用 8 个嵌套 if 语句有更好的方法！

编辑：String.split 解决方案似乎肯定是其中的一部分，所以我将使用它而不是 stringTokenizer。但是，我仍然不确定将单个字符串输入构造函数的最佳方法是什么。最好的方法是让类期待一个数组，然后在构造函数中做这样的事情：

```
line[1] = isbn;
line[2] = title; 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-25T13:46:49.283

最好的方法是根本不使用 StringTokenizer，而是使用 String 的[split](http://java.sun.com/j2se/1.5.0/docs/api/java/lang/String.html#split(java.lang.String))方法。它返回一个字符串数组，您可以从中获取长度。

对于文件中的每一行，您可以执行以下操作：

```
String[] tokens = line.split("#"); 
```

`tokens`现在将有 6 - 8 个字符串。用于`tokens.length()`找出有多少，然后从数组中创建您的对象。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-25T13:22:10.123

正则表达式是方法。您可以使用 split 方法将传入的字符串转换为字符串数组

[http://java.sun.com/j2se/1.4.2/docs/api/java/lang/String.html#split(java.lang.String)](http://java.sun.com/j2se/1.4.2/docs/api/java/lang/String.html#split(java.lang.String))

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-25T13:17:12.490

带有捕获组的正则表达式对您有用吗？您当然可以使表达式的某些部分成为可选的。

一个或三个示例数据行可能会有所帮助。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-25T13:19:12.877

这是一个CSV或类似的文件吗？如果是这样，有一些库可以帮助您，例如[Apache Commons CSV](http://commons.apache.org/sandbox/csv/)（链接到他们页面上的替代方案）。它会为文件中的每一行提供一个 String[] 。只需检查数组大小即可了解存在哪些可选字段。

# c++ - What advantages does C++ have over other languages for Qt development?

> ID：236399
> 
> 赞同：0
> 
> 时间：2008-10-25T13:25:07.790
> 
> 标签：c++, qt

As well-known, C++ has steeper learning curve than most of the mainstream languages, which results in better performance . But, does using C++ over other languages[like Java,Ruby,Python] for Qt development have still (major) advantages,let's say about Qtopia? If any, what are they?

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-25T13:40:30.283

Qt is natively a C++ API, so any other languages have to have wrapper code around it which needs to be maintained, etc. The primary documentation will also be for the C++ API.

I'm not sure if there are any "official" bindings to other languages which are maintained and released together with Qt.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-25T14:53:08.953

If you are looking at Qtopia, you are probably looking into embedded systems. In that case, C++ will likely be the one you want to choose, specifically for those performance reasons.

Otherwise, Trolltech maintains a Java binding, and I imagine that some of the other language bindings aren't too bad either, since those languages can interact directly with c/c++ code. However, those bindings are likely to always be a little out of date.

* * *

## 回答 #3

> 赞同：-2
> 
> 时间：2008-10-25T13:28:44.070

it's easier to create a single executable.

don't know if that will be for long...

# .net - .NET 上有 Smalltalk 吗？

> ID：236400
> 
> 赞同：12
> 
> 时间：2008-10-25T13:25:19.257
> 
> 标签：.net, smalltalk

.NET 运行时是否有任何可用的 Smalltalk 实现？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-25T14:17:06.950

有一个在 DLR 之上构建 Smalltalk 的项目。不出所料，它被称为[IronSmaltalk](http://www.codeplex.com/IronSmalltalk)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-09-01T03:33:12.040

有[LSW Vision-Smalltalk](http://www.lesser-software.com/lswvst.htm)，这似乎是一个私有的 Smalltalk 环境，他们声称支持 .NET：

“LSWVST 有一个 .NET 集成，使我们能够开发我们的 .NET 工具。LSWVST 现在包括 LSW DotNet-Lab 一个用于 .NET 编程的工具集。我们创建了一个“纯 .NET 实验性 Smalltalk (LSWVST.Net)。”

您可能需要私下索取可下载的副本。

# xml - 如何在代码隐藏文件中读取使用 XMLHTTP 发送的 XML？

> ID：236403
> 
> 赞同：1
> 
> 时间：2008-10-25T13:28:29.017
> 
> 标签：xml, code-behind, xmlhttprequest, c#

我有一个 javascript 代码，我在其中创建 XML Dom 并将其发送（使用 XMLHTTP）到代码隐藏页面（server.aspx.cs）。我怎样才能在那里读取 XML？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-27T08:47:24.380

实现此目的的一种方法是简单地将 InputStream 从 Request 对象加载到 XmlDocument 对象中

```
protected void Page_Load(object sender, EventArgs e)
{
    XmlDocument postedXml;
    postedXml = new XmlDocument();
    postedXml.Load(Request.InputStream); 
```

然后您可以正常访问postedXML 文档。

# php - is_int() 和 ctype_digit() 有区别吗？

> ID：236406
> 
> 赞同：40
> 
> 时间：2008-10-25T13:30:27.780
> 
> 标签：php, function, numbers

一个更受欢迎，还是比另一个表现更好？

* * *

## 回答 #1

> 赞同：103
> 
> 时间：2008-10-25T13:34:51.310

[`is_int()`](http://php.net/is_int)如果参数是整数类型，[`ctype_digit()`](http://www.php.net/ctype_digit)则返回 true，接受字符串参数，如果字符串中的所有字符都是数字，则返回 true。

**例子：**

```
┌──────────┬───────────┬────────────────┐
│          │  is_int:  │  ctype_digit:  │
├──────────┼───────────┼────────────────┤
│ 123      │  true     │  false         │
├──────────┼───────────┼────────────────┤
│ 12.3     │  false    │  false         │
├──────────┼───────────┼────────────────┤
│ "123"    │  false    │  true          │
├──────────┼───────────┼────────────────┤
│ "12.3"   │  false    │  false         │
├──────────┼───────────┼────────────────┤
│ "-1"     │  false    │  false         │
├──────────┼───────────┼────────────────┤
│ -1       │  true     │  false         │
└──────────┴───────────┴────────────────┘ 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2016-06-02T07:48:21.117

[`is_numeric`](http://php.net/manual/en/function.is-numeric.php)如果传入的值可以解析为数字，也有返回 true。

[![在此处输入图像描述](https://i.stack.imgur.com/iwREU.png)](https://i.stack.imgur.com/iwREU.png)

如果我尝试比较**PHP 5.5.30**上的函数性能，结果如下：

[![在此处输入图像描述](https://i.stack.imgur.com/apq2O.png)](https://i.stack.imgur.com/apq2O.png)

这是我用于基准测试的代码

```
// print table cell and highlight if lowest value is used
function wr($time1, $time2, $time3, $i) {
    if($i == 1) $time = $time1;
    if($i == 2) $time = $time2;
    if($i == 3) $time = $time3;

    echo('<td>');
    if(min($time1, $time2, $time3) === $time) printf('<b>%.4f</b>', $time);
    else printf('%.4f', $time);
    echo('</td>');
}

$test_cases = array( 123, 12.3, '123', true);
$tests = 1000000;
$result = true;  // Used just to make sure cycles won't get optimized out
echo('<table>'.PHP_EOL);
echo('<tr><td>&nbsp;</td><th>is_int</th><th>ctype_digit</th><th>is_numeric</th></tr>');
foreach($test_cases as $case) {
    echo('<tr><th>'.gettype($case).'</th>');

    $time = microtime(true);
    for($i = 0; $i < $tests; $i++) {
        $result |= is_int((int)rand());
    }
    $time1 = microtime(true)-$time;

    $time = microtime(true);
    for($i = 0; $i < $tests; $i++) {
        $result |= ctype_digit((int)rand());
    }
    $time2 = microtime(true)-$time;

    $time = microtime(true);
    for($i = 0; $i < $tests; $i++) {
        $result |= is_numeric((int)rand());
    }
    $time3 = microtime(true)-$time;

    wr($time1, $time2, $time3, 1);
    wr($time1, $time2, $time3, 2);
    wr($time1, $time2, $time3, 3);
    echo('</tr>'.PHP_EOL);
}

echo('</table>');

exit(); 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-25T13:40:18.020

您应该担心的最后一件事是其中一个有多快。检查字符串是否为整数是不可能成为代码中的瓶颈的。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2011-09-16T01:18:36.673

ctype**并不**总是在整数类型上*返回 false 。*

```
foreach(range(-1000 , 1000)as $num){
    if(ctype_digit($num)){
        echo $num . ", ";
    }    
} 
```

ctype_digit 为以下整数类型编号返回 true。

-78,-77,-71,48,49,50,51,52,53,54,55,56,57,178,179,185, 256,257,258,259,260,261,262,263,264,265,266,267,268,269,270 至 1000

基本做法是将每个数字大小写为字符串 eq strval($num) 或 (String) $num 在这种情况下，负值 (-78) 将始终返回 false。

is_int 将在 -2147483647 到 2147483647 之间的 int 类型值上返回 true。假设它在 32 位系统上运行，任何超过该数字的值都会返回 false。在 64 位上，它可以达到 -9223372036854775807 到 9223372036854775807 的范围

在性能方面个人很难说。ctype_digit 可能比 is_int 快，但是如果您必须将每个值都转换为字符串，则总体上会降低性能。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2017-03-08T18:31:21.090

嗯，这很有趣:) 这是所有故事：

> **`is_numeric:`**- 查找变量是数字还是数字字符串，无论 value 是负数还是 Boolean 或 String 或任何类型的数字，如果 value 是纯数字，它将返回**`'true'`**else **`'false'`**。
> 
> **记住：没有字符只有数字任何类型:)**

* * *

> **`is_init`**— 查找变量的类型是否为整数，如果值是纯整数则返回 'true' 否则返回 'false'。
> 
> **记住：没有字符，双精度或负数，只有整数**

* * *

> **`in_integer`**— is_int() 的别名

* * *

> **`intval:`**— 获取变量的整数值，它接受所有类型的值并且只返回整数值，如果值为负则返回' **`-Integer`**'值。无论值是 Integer、Float、Negative 还是 ' **`NumberString`**' 或 ' **`NumberStringCharacter`**'。它从字符串“”中减去整数值**`If String Starts with Number`**。
> 
> *   **NumberString** = 字符串格式的数字值
> *   **NumberStringCharacter** = 以数字开头的字符串
> 
> **请记住：您将从以 Number 开头的 Number、Float、Negative 或 String 获得整数值。**

* * *

> **`ctype_digit`**— 检查数字字符，如果以字符串格式提供整数，您将得到 ' **`true`**' else ' **`false`**'。它仅适用于 StringNumber、No Float、No Negative only Whole Number as String。
> 
> **记住：整数作为字符串，没有负数，没有浮点数，没有数字类型，没有字符，只有数字作为字符串。**

**鸟瞰图：**

[![在此处输入图像描述](https://i.stack.imgur.com/gQIGu.jpg)](https://i.stack.imgur.com/gQIGu.jpg)

**感谢[http://php.net/](http://php.net/)**

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-26T12:05:02.217

如果您不关心参数是 int 类型还是带数字的字符串，请使用 is_numeric。它也会为浮点数返回 true，尽管如此。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-06-15T13:52:13.280

如果整数范围在负数范围内或介于 0 和 47 或 58 和 255 之间，则 Ctype_digit 返回 false。您可以使用以下代码段检查 ctype_digit 的行为。

```
setlocale(LC_ALL, 'en_US.UTF-8');
var_dump(
    true === array_every(range(-1000, -1), 'ctype_digit_returns_false'),
    true === array_every(range(0, 47), 'ctype_digit_returns_false'),
    true === array_every(range(48, 57), 'ctype_digit_returns_true'),
    true === array_every(range(58, 255), 'ctype_digit_returns_false'),
    true === array_every(range(256, 1000), 'ctype_digit_returns_true')
);

// https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/Array/every
function array_every(array $array, $callable)
{
    $count = count($array);

    for ($i = 0; $i < $count; $i +=1) {

        if (!$callable($array[$i])) {

            return false;

        }

    }

    return true;
}

function ctype_digit_returns_true($v)
{
    return true === ctype_digit($v);
}

function ctype_digit_returns_false($v)
{
    return false === ctype_digit($v);
} 
```

# python - 如何使用 Python 进行大规模开发？

> ID：236407
> 
> 赞同：62
> 
> 时间：2008-10-25T13:30:27.933
> 
> 标签：python, development-environment

我有兴趣了解 Python 中的大规模开发，尤其是如何维护大型代码库？

*   当您对方法的签名进行不兼容更改时，如何找到调用该方法的所有位置。在 C++/Java 中，编译器会为你找到它，你如何在 Python 中做到这一点？

*   当您在代码深处进行更改时，您如何找出实例提供的操作，因为您没有要查找的静态类型？

*   你如何处理/防止打字错误（错别字）？

*   UnitTest 是否用作静态类型检查的替代品？

你可以猜到我几乎只使用静态类型语言（C++/Java），但我想尝试使用 Python 来处理更大的程序。但是我在很久以前使用clipper (dBase) 语言时有过非常糟糕的体验，该语言也是动态类型的。

* * *

## 回答 #1

> 赞同：69
> 
> 时间：2008-10-25T14:46:30.577

## 不要用螺丝刀当锤子

Python 不是静态类型的语言，所以不要尝试那样使用它。

当您使用特定工具时，您将其用于已构建的内容。对于 Python，这意味着：

*   **鸭子打字**：没有类型检查。只有行为很重要。因此，您的代码必须设计为使用此功能。一个好的设计意味着通用签名、组件之间没有依赖关系、高抽象级别。因此，如果您更改任何内容，则无需更改其余代码。Python 也不会抱怨它的构建目的。类型不是问题。

*   **庞大的标准库**。如果您使用自己未编码的标准功能，则无需更改程序中的所有调用。Python 随附电池。我每天都在不断地发现它们。当我开始尝试重写现有的东西时，我不知道我可以使用多少个模块。没关系，你不能从一开始就做好。

您不会以相同的方式编写 Java、C++、Python、PHP、Erlang 等等。它们是为什么有这么多不同语言中的每一种都有空间的很好的理由，它们不做同样的事情。

## 单元测试不是替代品

必须使用任何语言执行单元测试。最著名的单元测试库 ( [JUnit](http://en.wikipedia.org/wiki/JUnit) ) 来自 Java 世界！

这与类型无关。你再次检查行为。你避免了回归的麻烦。您确保您的客户在轨道上。

## 用于大型项目的 Python

> 语言、库和框架无法扩展。架构可以。

如果你设计了一个坚实的架构，如果你能够让它快速发展，那么它就会扩展。单元测试帮助，自动代码检查也是如此。但它们只是安全网。还有小的。

Python 特别适合大型项目，因为它强制执行了一些良好的实践，并且内置了许多常用的设计模式。但同样，不要将其用于未设计的用途。例如：Python 不是 CPU 密集型任务的技术。

在一个巨大的项目中，无论如何你很可能会使用几种不同的技术。作为[SGBD](https://stackoverflow.com/questions/980813/what-is-sgbd)（[DBMS](https://en.wikipedia.org/wiki/Database)的法语）和模板语言，或者其他。Python也不例外。

您可能希望将 C/C++ 用于需要快速的代码部分。或 Java 以适应[Tomcat](http://en.wikipedia.org/wiki/Apache_Tomcat)环境。不知道，不在意。Python 可以很好地处理这些。

## 作为结论

我的回答可能有点粗鲁，但不要误会我的意思：这是一个非常好的问题。

很多人带着旧习惯来到 Python。我把自己搞砸了，试图像 Python 一样编写 Java。你可以，但永远不会得到最好的。

如果你玩过/想玩 Python，那就太好了！这是一个很棒的工具。但只是一个工具，真的。

* * *

## 回答 #2

> 赞同：38
> 
> 时间：2008-10-25T14:01:28.907

我有一些修改“Frets On Fire”的经验，这是一个开源的python“吉他英雄”克隆。

在我看来，python 并不真正适合真正大规模的项目。

我发现自己花费了大部分开发时间来调试与分配不兼容类型相关的问题，静态类型语言在编译时会毫不费力地揭示这些问题。此外，由于类型是在运行时确定的，因此尝试理解现有代码变得更加困难，因为您不知道当前正在查看的参数的类型是什么。

除此之外，`__getattr__`在 Python 中使用内置函数的名称字符串调用函数通常比在其他编程语言中更常见，因此使调用图到某个函数有点困难（尽管您可以在某些静态类型语言也是如此）。

我认为 Python 在小型软件、快速原型开发以及将现有程序粘合在一起方面确实很出色，但我不会将它用于大型软件项目，因为在这些类型的程序中，可维护性成为真正的问题，在我看来，python那里比较弱。

* * *

## 回答 #3

> 赞同：24
> 
> 时间：2008-10-25T15:05:10.720

由于没有人指出 pychecker、pylint 和类似工具，我将：pychecker 和 pylint 是可以帮助您找到错误假设（关于函数签名、对象属性等）的工具。它们不会找到编译器可能在静态类型语言——但他们可以找到此类语言的编译器也找不到的问题。

Python（以及任何动态类型语言）在您可能导致的错误以及如何检测和修复它们方面有着根本的不同。它有明显的缺点和优点，但许多人（包括我）会争辩说，在 Python 的情况下，编写代码的便利性（以及使其结构合理的便利性）和在*不*破坏 API 兼容性的情况下修改代码（添加新的可选参数） ，提供具有相同方法和属性集的不同对象）使其非常适合大型代码库。

* * *

## 回答 #4

> 赞同：16
> 
> 时间：2008-10-25T13:44:41.253

我的 0.10 欧元：

我有几个处于“生产”状态的 python 应用程序。我们公司使用java、c++和python。我们使用 eclipse ide (pydev for python) 进行开发

**单元测试是问题的关键解决方案。**（也适用于 c++ 和 java）

“动态类型”的不太安全的世界将使您对代码质量不那么粗心

**顺便说一句**：

大规模开发并不意味着您使用一种语言！

大规模开发通常使用**少数特定于问题的语言**。

所以我同意*锤子问题*:-)

* * *

PS：[静态类型和python](http://www.xoltar.org/old_site/misc/static_typing_eckel.html)

* * *

## 回答 #5

> 赞同：16
> 
> 时间：2008-10-25T15:36:01.470

这里有一些项目帮助我在 python 中维护了一个相当大的系统。

*   分层构建代码。即独立的商业逻辑、表示逻辑和你的持久层。花一些时间来定义这些层，并确保项目中的每个人都参与进来。对于大型系统，创建一个迫使您进入某种开发方式的框架也可能是关键。

*   测试是关键，如果没有单元测试，你可能会以比使用其他语言快几倍的速度结束无法管理的代码库。请记住，单元测试通常是不够的，请确保有几个集成/验收测试可以在任何重大更改后快速运行。

*   使用[快速失败](http://en.wikipedia.org/wiki/Fail-fast)原则。为您认为您的代码可能易受攻击的情况添加断言。

*   具有标准的日志记录/错误处理，这将帮助您快速定位到问题

*   使用提供提前输入、pyLint/Checker 集成的 IDE（pyDev 为我工作）来帮助您立即检测常见的拼写错误并推广一些编码标准

*   小心你的进口，永远不要做 from x import * 或做相对进口而不使用 .

*   进行重构，带有正则表达式的搜索/替换工具通常是您进行移动方法/类类型重构所需的全部。

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2008-10-25T17:21:41.690

**对方法签名的不兼容更改。**这在 Python 中不会像在 Java 和 C++ 中那样发生。

Python 在定义方法签名方面具有可选参数、默认值和更大的灵活性。此外，鸭子类型意味着——例如——作为重大软件更改的一部分，您不必从某个类切换到接口。事情没有那么复杂。

**您如何找到调用该方法的所有位置？** grep 适用于动态语言。如果您需要知道使用方法的每个地方，grep（或等效的 IDE 支持的搜索）非常有用。

**由于您没有要查找的静态类型，您如何找出实例提供的操作？**

一种。看源头。您无需处理对象库和 jar 文件的 Java/C++ 问题。您不需要这些语言所需的所有复杂的辅助工具和工具。

湾。IDE 可以在许多常见情况下提供签名信息。您可以轻松击败 IDE 的推理能力。发生这种情况时，您可能应该检查您正在做的事情以确保它有意义。如果您的 IDE 无法推断出您的类型信息，那么它可能过于动态。

C。在 Python 中，您经常通过交互式解释器工作。与 Java 和 C++ 不同，您可以直接交互式地探索您的实例。您不需要复杂的 IDE。

例子：

```
 >>> x= SomeClass()
  >>> dir(x) 
```

**你如何处理/防止打字错误？** 与静态语言相同：您不会阻止它们。你找到并纠正它们。Java 只能找到某一类拼写错误。如果你有两个相似的类或变量名，你可能会遇到很大的麻烦，即使是静态类型检查。

例子：

```
class MyClass { }
class MyClassx extends MyClass { } 
```

这两个类名的拼写错误可能会造成严重破坏。[“但我不会把自己放在 Java 的那个位置上，”人们说。同意。我也不会把自己放在 Python 的那个位置上。你制作的课程完全不同，如果被滥用，它们会很早就失败。]

**UnitTest 是否用作静态类型检查的替代品？** 这是另一种观点：静态类型检查替代了清晰、简单的设计。

我曾与不确定应用程序为什么工作的程序员一起工作。他们无法弄清楚为什么事情没有编译；不知道抽象超类和接口之间的区别，也不知道为什么一个地方的改变会导致一个单独的 JAR 文件中的一堆其他模块崩溃。静态类型检查使他们对有缺陷的设计产生了错误的信心。

动态语言使程序变得简单。简单性是静态类型检查的替代品。Clarity 是静态类型检查的替代品。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-10-25T15:26:39.480

我的一般经验法则是对小型非关键任务项目使用动态语言，对大型项目使用静态类型语言。我发现用诸如 python 之类的动态语言编写的代码会更快地“纠结”。部分原因是用动态语言编写代码要快得多，这会导致捷径和更糟糕的设计，至少在我的情况下是这样。部分原因是当我使用 Java 时，我有 IntelliJ 可以快速轻松地重构，而 python 没有。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-10-25T14:24:17.290

通常的答案是测试测试测试。您应该拥有一个广泛的单元测试套件并经常运行它，尤其是在新版本上线之前。

动态类型语言的支持者认为您无论如何都必须进行测试，因为即使在静态类型语言中，与类型系统的粗略规则的一致性也只涵盖了可能出错的一小部分。

# .net - .NET / LINQ-SQL / ASP.NET 中的连接字符串地狱

> ID：236412
> 
> 赞同：28
> 
> 时间：2008-10-25T13:36:11.087
> 
> 标签：.net, asp.net, linq-to-sql, configuration, connection-string

我有一个包含以下内容的 Web 应用程序：

*   一个 Web 项目（带有一个包含连接字符串的 web.config 文件 - 但在 Web 项目中没有数据访问代码）
*   使用 LINQ-SQL 类向 Web 项目 UI 提供实体的数据访问项目（该项目有一个设置文件和一个 app.config - 两者都有连接字符串）

当我构建和部署时，Bin 目录中没有设置文件或 app.config 与数据访问 .dll，但更改 web.config 文件中的连接字符串不会相应地更改数据库 - 所以连接字符串必须被编译成数据访问dll。

我需要一个用于我的整个部署的配置文件——网站、数据访问 dll、一切——它有一个可以使用的连接字符串。目前，似乎有多个连接字符串在各处被使用或硬编码。

我如何最好地解决这个烂摊子？

谢谢你的帮助。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-10-25T14:20:04.430

我从来没有遇到过*数据访问层*(DAL) 能够使用我`web.config`文件中的连接字符串的问题。通常我只是从 DAL 复制连接字符串部分并将其粘贴到`web.config`. 我正在使用 DBML 设计器来创建数据上下文。

如果这对您不起作用，您可以在数据上下文构造函数中指定连接字符串。在您的 Web 项目中有一个静态类来加载您的设置，包括您的连接字符串，并且当您创建 DAL 对象（或数据上下文，如果直接创建它）时，只需将其传递给构造函数。

```
public static class GlobalSettings
{
    private static string dalConnectionString;
    public static string DALConnectionString
    {
       get
       {
           if (dalConnectionString == null)
           {
              dalConnectionString = WebConfigurationManager
                                      .ConnectionStrings["DALConnectionString"]
                                        .ConnectionString;
           }
           return dalConnectionString;
       }
    }
}
...

using (var context = new DALDataContext(GlobalSettings.DALConnectionString))
{
   ...
} 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-25T13:53:27.100

启动项目的配置文件将定义所有包含项目的配置设置。例如，如果您的 Web 项目是启动项目，则对“appSettings”的任何引用都会从 web.config 中查找设置，这包括从您的数据访问项目中对“appSettings”的任何引用。因此，将任何配置设置从数据访问项目的 app.config 复制到 Web 项目的 web.config。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-25T14:45:12.200

根据注册表滚动您自己的 ConnectionFactory：

*   在 SOFTWARE/[YOUR_COMPANY]/[YOUR_APP] 下为您的应用程序添加注册表项
*   为 ConnectionString 添加一个字符串值
*   教您的 ConnectionFactory 破解打开适当的注册表项（在静态构造函数中，而不是每个页面加载！）。
*   将注册表信息导出为 .reg 文件，将其添加到源代码管理中，根据需要对其进行修改和应用以设置其他机器。

临：

*   设置简单
*   连接字符串位于一个地方
*   不在 web/app.config 中，因此无需对特定于环境的设置进行硬编码。
*   不在 web/app.config 中，所以 Junior Dev Jimmy 不能不小心告诉您的生产服务器查看 DEV 数据库

缺点：

*   重要的事情存在于注册表中并不是很明显，因此新的开发人员将需要指导。
*   配置新部署机器时的额外步骤
*   注册表是oldskool。初级开发者会嘲笑你。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-25T18:25:44.027

感谢您的回复。

那些说该应用程序将使用 web.config 中的设置的人对于我在自己的代码中引用它的情况是正确的：

```
_connectionString = ConfigurationManager.AppSettings["ConnectionString"]; 
```

..但是 LINQ-SQL 数据上下文存在不同的问题 - 我认为它们在编译的 dll 中包含连接字符串，以便在无参数构造函数中使用。正如 tvanofosson 所说，我需要通过传入对 web.config 中连接字符串的引用来创建数据上下文。这就是我陷入困境的地方:)

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-25T13:58:28.443

您的应用程序将仅使用 web.config 文件中的配置条目。只要结构正确，您就可以将 dll 配置设置放在 web.config 文件中。我的示例是使用 My Namespace 的 VB 特定的，但它为您提供了总体思路。

在配置文件的 configSections 部分中，您将需要一个条目：

```
<configSections>
    <sectionGroup name="applicationSettings" type="System.Configuration.ApplicationSettingsGroup, System, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" >
        <section name="YourAssembly.My.MySettings" type="System.Configuration.ClientSettingsSection, System, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" requirePermission="false" />
    </sectionGroup></configSections> 
```

然后在配置文件的 applicationSettings 部分中放置每个 dll 的条目：

```
 <applicationSettings>
      <YourAssembly.My.MySettings>
        <setting name="DebugMode" serializeAs="String">
            <value>False</value>
        </setting>
      </YourAssembly.My.MySettings>
    </applicationSettings> 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-04-23T07:02:01.770

我在这个问题上也有点挣扎。我通过使用 c# 部分类定义并扩展 dbml 设计器创建的数据上下文找到了解决方案。该解决方案与 tvanfosson 的答案非常相似。您需要做的是创建部分数据上下文类，使用默认构造函数从设置中获取 ConnectionString，并在 dbml 设计器 DC 属性中将连接设置为无。这样连接字符串就不会被编译成dll。Datacontext 将自动从 web.config 连接字符串设置中获取连接字符串。我还没有测试这是否也适用于 app.config，但我认为它应该可以正常工作。

这是部分 DC 类的示例：

```
namespace MyApplication {
    /// <summary>
    /// Summary description for MyDataContext
    /// </summary>
    /// 
    public partial class MyDataContext
    {
        public MyDataContext() :
            base(global::System.Configuration.ConfigurationManager.ConnectionStrings["MyConnectionString"].ConnectionString, mappingSource)
        {
            OnCreated();
        }
    }
} 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2010-08-15T08:05:17.207

为了保证它不受自动生成代码中任何内容的影响，请覆盖数据上下文的 OnCreated() 方法中的连接信息：

```
using System.Configuration;
namespace MyApplication 
{
    partial void OnCreated()
    {
        // attempt to use named connection string from the calling config file
        var conn = ConfigurationManager.ConnectionStrings["MyConnectionString"];
        if (conn != null) Connection.ConnectionString = conn.ConnectionString;
    }
} 
```

这样，dbml 设计器可以按照自己的方式进行连接（这在 Web 项目之外并不好），但是您可以在应用程序运行时获得对连接的最终控制权。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-25T13:53:52.200

这是看待它的一种方式。哪个组件应该决定使用哪个数据库？数据库（或至少连接字符串）将来可能会更改。网站是否决定使用哪个数据库？或者，由 DAL 决定？

如果您有 dev、QA、UAT 和 prod 数据库，管理这些连接字符串至关重要。

如果网站决定，它应该将连接字符串从其 web.config 传递到 DAL。如果网站不应该知道或关心数据的来源，则连接字符串属于 DAL。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-25T13:47:28.610

如何定义一个 ConnectionFactory 对象，它将一个枚举作为参数并返回一个完整的连接对象？

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-10-25T13:54:48.483

您还可以让 Web 应用程序在需要使用数据访问项目时提供连接字符串。你可以让它成为构造函数的一部分。

此外，您可以编写自己的逻辑来在数据访问项目进行调用时从外部文件加载连接字符串。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-25T14:13:21.763

在一个完美的世界里，我认为你会重构你的数据层以通过 System.Configuration 或相关的构造函数/工厂来获取配置设置。这意味着，您要么需要重新连接其隐式配置源，要么显式设置来自其主机/消费者的连接。集中这些类型的常量的另一个相关模式是将只读属性放入静态帮助器类，并让该类管理来自配置等的实际解析。

NHibernate 及其配置/映射管理是您可以看到的一个地方，我认为它展示了如何优雅地做到这一点的好例子。诚然，这有点像 xml 地狱，而且 Fluent NHib 更甜美，但大多数现实世界的示例将向您展示如何协调支持程序集与执行程序集的配置。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-10-25T14:35:11.010

根据 .config 文件滚动您自己的 ConnectionFactory：

*   定义自定义配置部分以映射键/连接字符串对
*   教您的 ConnectionFactory 使用适当的主机名或机器名嗅探该配置部分
*   为您的各种 dev/qa/prod 服务器填充键/连接字符串值，并将它们放入您的各种 app.config、web.config 等文件中。

临：

*   所有人都生活在项目中，所以没有惊喜
*   添加其他部署目标是 .config 文件中的复制/粘贴操作

缺点：

*   造成大的丑陋的 XML 部分，特别是如果您有十几个生产服务器
*   需要在项目之间复制
*   需要更改代码并重新部署以添加新目标
*   代码需要了解它的生存环境

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2010-11-30T04:12:54.313

我知道这很旧，但这就是我的做法（我非常喜欢@Seba 的方式，但我没有尝试过）

这假设您的 DBML 文件位于其自己的类库中，我发现在跨多个网站和其他类库共享实体和数据访问时最方便。它还假设您在每个项目中都将连接字符串命名为相同。当我部署到不同的环境时，我使用 NAnt 来设置它。

我基于上面来自@tvanfosson 的最佳答案 - 对那个人表示敬意。

1.  创建您自己的基类，它派生自 LinqDataContext

这是VB代码：

```
 Imports System.Configuration

Public Class CustomDataContextBase
    Inherits System.Data.Linq.DataContext
    Implements IDisposable

    Private Shared overrideConnectionString As String

    Public Shared ReadOnly Property CustomConnectionString As String
        Get
            If String.IsNullOrEmpty(overrideConnectionString) Then
                overrideConnectionString = ConfigurationManager.ConnectionStrings("MyAppConnectionString").ConnectionString
            End If

            Return overrideConnectionString
        End Get
    End Property

    Public Sub New()
        MyBase.New(CustomConnectionString)
    End Sub

    Public Sub New(ByVal connectionString As String)
        MyBase.New(CustomConnectionString)
    End Sub

    Public Sub New(ByVal connectionString As String, ByVal mappingSource As System.Data.Linq.Mapping.MappingSource)
        MyBase.New(CustomConnectionString, mappingSource)
    End Sub

    Public Sub New(ByVal connection As IDbConnection, ByVal mappingSource As System.Data.Linq.Mapping.MappingSource)
        MyBase.New(CustomConnectionString, mappingSource)
    End Sub

End Class 
```

1.  打开您的 DBML 文件，然后在“属性”中，将上述类名添加到“基类”属性中。

注意，如果您将自定义数据上下文类放在同一个程序集中，只需包含类名，例如 CustomDataContext。

如果它们位于不同的程序集中，请使用完全限定名称，例如 MyCo.MyApp.Data.CustomDataContext

1.  为确保 Designer 的东西正常工作，请将您的连接字符串复制到类库的 app.config 文件中。这不会在 IDE 之外使用。

就是这样。

您需要将连接字符串命名为相同

您实际上所做的是强制数据上下文忽略 DBML 文件中设置的连接信息。使用 ConfigurationManager 方法意味着它将从调用程序集中获取连接字符串。

高温高压

# compression - 允许在文件中随机读/写的最佳压缩算法是什么？

> ID：236414
> 
> 赞同：29
> 
> 时间：2008-10-25T13:38:37.743
> 
> 标签：compression, random-access, huffman-code, adaptive-compression

允许在文件中随机读/写的最佳压缩算法是什么？

我知道任何自适应压缩算法都是不可能的。

而且我知道霍夫曼编码是不可能的。

有没有人有更好的压缩算法来允许随机读/写？

我认为如果你将它写成块，你可以使用任何压缩算法，但理想情况下我不希望一次解压缩整个块。但是，如果您对执行此操作的简单方法以及如何知道块边界有任何建议，请告诉我。如果这是您的解决方案的一部分，请让我知道当您要读取的数据跨越块边界时您会做什么？

在您的答案的上下文中，请假设有问题的文件是 100GB，有时我想读取前 10 个字节，有时我想读取最后 19 个字节，有时我想读取 17中间的字节。.

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2010-08-08T05:20:32.853

我对暗示这种事情是不可能的回应的数量感到震惊。

难道这些人从来没有听说过“压缩文件系统”吗？自 1993 年微软因压缩文件系统技术被 Stac Electronics 起诉之前就已经存在了？

我听说[LZS](http://en.wikibooks.org/wiki/Data_Compression/Dictionary_compression#LZS)和[LZJB](http://en.wikibooks.org/wiki/Data_Compression/Dictionary_compression#LZJB)是人们实现压缩文件系统的流行算法，它们必然需要随机访问读取和随机访问写入。

也许最简单和最好的做法是为该文件打开文件系统压缩，让操作系统处理细节。但是如果你坚持手动处理，也许你可以通过阅读[NTFS 透明文件压缩](http://www.informit.com/articles/article.aspx?p=26353&seqNum=4)来获得一些技巧。

另请查看： [“StackOverflow：对档案内随机访问具有良好支持的压缩格式？”](https://stackoverflow.com/questions/429987/compression-formats-with-good-support-for-random-access-within-archives)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2011-08-23T15:23:58.473

razip 格式支持随机访问读取，其性能比 gzip/bzip2 更好，而 gzip/bzip2 必须对此支持进行调整：

[http://sourceforge.net/projects/razip/](http://sourceforge.net/projects/razip/)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-06T10:03:18.570

基于字典的压缩方案，每个字典条目的代码以相同大小编码，将导致能够以代码大小的任意倍数开始读取，并且如果代码不使用其上下文，则写入和更新很容易/邻居。

如果编码包括区分代码开头或结尾的方法，那么您不需要代码长度相同，您可以从文件中间的任何位置开始读取。如果您从流中的未知位置读取，此技术会更有用。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2010-07-30T14:56:53.513

我认为 Stephen Denne 可能在这里有所作为。想象：

*   类似 zip 的序列压缩到代码
*   字典映射代码 -> 序列
*   文件就像一个文件系统
    *   每次写入都会生成一个新的“文件”（字节序列，根据字典压缩）
    *   “文件系统”跟踪哪个“文件”属于哪个字节（开始，结束）
    *   每个“文件”都根据字典进行压缩
    *   根据“文件系统”读取工作文件，解压缩和检索字节
    *   写入使“文件”无效，附加新的“文件”以替换无效的文件
*   该系统将需要：
    *   文件系统的碎片整理机制
    *   不时压缩字典（删除未使用的代码）
*   正确完成后，可以在无人看管时（空闲时间）或通过创建新文件并最终“切换”来完成内务管理

一个积极的影响是字典将适用于整个文件。如果您可以节省 CPU 周期，您可以定期检查与“文件”边界重叠的序列，然后重新组合它们。

这个想法适用于真正的随机读取。如果您只打算阅读固定大小的记录，那么这个想法的某些部分可能会变得更容易。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-25T13:51:03.003

我不知道任何允许随机读取的压缩算法，更不用说随机写入了。如果您需要这种能力，最好的办法是将文件压缩成块而不是整体。

例如
，我们将首先查看只读情况。假设您将文件分成 8K 块。您压缩每个块并按顺序存储每个压缩块。您需要记录每个压缩块的存储位置和大小。然后，假设您需要从偏移量 O 开始读取 N 个字节。您需要确定它在哪个块中（O / 8K），解压缩该块并获取这些字节。您需要的数据可能跨越多个块，因此您必须处理这种情况。

当您希望能够写入压缩文件时，事情会变得复杂。您必须处理越来越大的压缩块。您可能需要为每个块添加一些额外的填充以防它扩展（它仍然是未压缩的相同大小，但不同的数据将压缩为不同的大小）。如果压缩数据太大而无法放回给定的原始空间，您甚至可能需要移动块。

这基本上就是压缩文件系统的工作方式。您最好为文件打开文件系统压缩并正常读取/写入它们。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-04T04:35:54.067

压缩就是从数据中删除冗余。不幸的是，冗余不太可能以单调的均匀度分布在整个文件中，这是您可以预期压缩*和*细粒度随机访问的唯一场景。

但是，您可以通过维护一个在压缩期间构建的外部列表来*接近*随机访问，该列表显示未压缩数据流中的选定点与其在压缩数据流中的位置之间的对应关系。您显然必须选择一种方法，其中源流与其压缩版本之间的转换方案不会随流中的位置而变化（即没有 LZ77 或 LZ78；相反，您可能想要使用 Huffman 或字节-对编码。）显然，这会产生很多开销，并且您必须决定如何在“书签点”所需的存储空间和从 a 开始解压缩流所需的处理器时间之间进行权衡书签点以获取您的数据

至于随机访问写作……那几乎是不可能的。如前所述，压缩是关于从数据中删除冗余。如果您尝试用不*具有*相同冗余的数据替换可能已经被压缩的数据，因为它是冗余的，那么它根本不适合。

但是，取决于您要进行*多少*随机访问写入——您可以通过维护一个稀疏矩阵来模拟它，该矩阵表示压缩后写入文件的所有数据。在所有读取中，您将检查矩阵以查看您是否正在读取压缩后写入的区域。如果没有，那么您将转到数据的压缩文件。

# deployment - 培训员工如何使用您刚刚创建的软件的好方法是什么？

> ID：236416
> 
> 赞同：9
> 
> 时间：2008-10-25T13:39:11.330
> 
> 标签：deployment

我在一家小公司工作，距离部署一个会被大量使用的网络应用程序还有几周的时间。一个地方的每个人都必须学会使用它，虽然我认为它非常简单和直观，但我可能有偏见。
我写了一份帮助指南，每个页面都有大量的屏幕截图，但我仍然需要培训每个人。最好的方法是什么？您如何退后一步并解释您已经工作了数周的代码？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-25T13:44:48.213

**首先尽量避免训练：**

执行[可用性测试](http://en.wikipedia.org/wiki/Usability_testing)以确保您的 Web 应用程序直观。可用性测试是测试的一个非常重要的方面，它经常被忽略。您如何看待您的系统可能与新用户如何看待您的系统大不相同。

还要尽可能多地添加上下文帮助。例如，当我将鼠标悬停在堆栈溢出中的标签上时，我确切地知道单击它会做什么，因为它会告诉我。

此外，这似乎很明显，但请确保您从网站本身链接到您的文档。人们可能不会想到查看您的文档，除非它就在他们眼前。

**关于培训文档：**

尝试将您的材料分解为您的用户将如何使用系统。我个人喜欢 Sun 为他们的[Java 教程](http://java.sun.com/docs/books/tutorial/)创建的“trails”选项。在本教程中，您可以做几件事，并且可以选择您想走的路线。

在帮助文档中支持随机读取。如果他们在您的网络应用程序中有任务要做，那么他们应该能够在不阅读一堆不相关内容的情况下获得帮助。

确保您的文档是可搜索的。

**关于实际培训课程：**

如果您实际上正在执行培训课程，请远离解释与您的代码相关的任何内容。您无需了解发动机即可驾驶汽车。

尝试将您的培训课程分成系统中非常集中的方面。如果您只有 1 个培训课程可供您使用，那么只需做一个系统的专门用例 + 系统的整体描述。请参阅文档的不同部分以获得帮助。

**让社区自助：**

无论您的文档有多么广泛，您总会遇到未涵盖的案例。这就是为什么最好为系统的所有用户提供一个论坛。让他们互相提问。

您可以查看此论坛并根据需要将内容添加到您的文档中。

您也可以为文档本身打开一个 wiki，但如果您的用户群不是很大，这可能是不可取的。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-25T13:49:54.580

几个想法：

你有一些预设的演练场景吗？不知道它是否适用于您的产品，但几年前我构建了一个相当强大的产品，并开发了一些他们可以完成的培训模块——时间不长，每个模块最多 15 分钟。

我整理了一个幻灯片演示，突出了亮点来谈论它的作用。在动手操作之前，我会花大约 10 分钟浏览应用程序的亮点，让他们熟悉它。

不幸的是，人们不倾向于阅读东西。您可以在帮助文档中花费数小时，但仍然会发现人们根本不阅读或浏览它。这可能令人沮丧。期望您指南中的答案将成为您的用户将遇到的问题的主题。

将您进行的任何培训分解为可管理的部分。我之前参加过全天的训练练习，教练把它分成小段，让我很容易把训练主题放在脑海里。您不想对它们进行数据转储，因为它们的眼睛会遮盖住它们，而您会丢失它们。

最终，如果您的应用程序高度可用，那么它应该是小菜一碟。如果不是，你会发现。你可能想让一些你认识的人提前完成你的训练，并给你建设性的批评。最好在训练大组之前修复它。您将对产品和培训材料（无论它们是什么）更有信心，并且您可能会获得更好的培训体验。

如果适用，请为他们提供在线帮助/wiki/faq。有时这很有帮助。

祝你好运！

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-25T14:27:54.240

您确实应该在开发周期中比您现在更早地解决这个**问题**。

在我看来，企业软件的理想场景是用户设计自己的应用程序并编写自己的文档，我一直在为此努力。您应该尽早确定关键用户并与他们一起设计系统（我试图让我的用户在 Excel 或类似工具中进行基本的屏幕设计和菜单布局 - 然后我将其实现为静态页面并在编写一行重要代码之前进行审查，显然他们不会在第一次就得到正确的设计，但*指导*他们是你的工作——理想情况下，他们认为他们提出了正确的设计决策，而不是你 :-) )。

然后，这些用户应该在您开发系统的同时编写此设计的用户文档。我*从未*见过 IT 部门/软件公司提供的帮助文档在公司环境中得到了显着使用。取而代之的是，用户将创建自己的笔记和解决方法文件夹并参考此文件（实际上，如果您曾经进行系统分析以替换现有系统，则为旧系统找到“用户圣经”是关键战略）。让用户预先编写自己的文档只是利用了无论如何都会发生的事情——但如果用户觉得他们拥有系统的所有权，这会容易得多，因为他们首先是自己设计的。

当然，这种方法需要用户的承诺和时间，但通常并不难推销。这很陈词滥调，但作为促进者工作，因此用户可以在那里开发自己的系统，而不是作为第三方给他们一个系统，这几乎可以保证用户接受。

既然您现在就在您所在的位置，那么实施所有这些已经为时已晚，但是如果您可以确定几个热心的关键用户并从他们那里获得时间来编写自己的文档，那将是一个不错的举措。如果你连这个都做不到，那么你需要确定一个传道者，你可以将他培训为“部门”专家，并给予他们 110% 的精力来支持他们。

底线是用户接受度是基于感知的，这不一定与系统的实际可用性相关。您必须像关注系统现实一样关注群体心理，这对开发人员来说往往很棘手，因为我们比大多数人更注重事实。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-25T13:51:12.567

在接下来的几个月里，我也会研究类似的事情。

在您的情况下，希望 UI 已经经过用户验收测试。你说你在一家小公司工作。是否有可能让最不精通技术的人在那里尝试一下？事实上，除了他们提出的问题外，让他们在没有任何指导的情况下尝试一下。记录问题并确保您的用户指南回答这些问题。

对我来说最重要的是逻辑和一致性。如果应用程序的工作流程与其设计完成的任务在逻辑上相关并且 UI 是一致的，那么您应该没问题。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-25T13:52:00.583

创建一个 wiki 页面来描述您的系统的使用。授予系统用户编辑权限可以让用户：

*   更新文档以更正文档初始版本中的任何错误，
*   分享他们可能发现的任何使用技巧。
*   分享您可能没有想到的系统的不寻常用途。
*   请求功能。
*   提供他们在等待新功能实施时发现的任何变通方法。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-25T14:44:32.577

先尝试几个用户，小公司的一两个。主要是看，尽量少帮助。这会告诉您需要修复什么，并创建经验丰富的用户群——因此您不再是“培训瓶颈”。

将核心需求/用例/故事卡转化为文档的 HowTo/演练。

对于公开培训，请准备一个 10..15 分钟的演示文稿（仅此而已！），涵盖**用户**绝对必须理解的关键概念，而不是展示您的核心演练。为有关如何解决各种任务的问题预留额外时间。

以用户而非技术人员的身份思考： - 没有人关心它是否是 SQL 数据库，而且您花了很多时间来正确设置锁定机制。他们确实关心“这会让我慢下来”和“当两个人同时这样做时会不会发生不好的事情”。我们的工作是让复杂的事情看起来简单。

将文档以可编辑的形式放在 Intranet 上可能会有所帮助 - 页面“评论”或 wiki。和/或为错误消息和 blips 建立一个“错误 wiki”——您或您的用户可以在其中快速添加建议、解决方法和任何未按预期进行的原因。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-25T15:57:36.193

我选择了几个超级用户（每个部门至少一个人）并培训他们来教其他员工，而不是培训所有这些人。那些超级用户当然是至关重要的

*   在他们的部门中很受尊重
*   能教
*   喜欢应用程序

确保他们喜欢该应用程序的简单方法是让他们定义它的工作方式:-)。因为他们每天都应该使用这个应用程序，所以他们是主要的利益相关者，不管管理层是什么状态

# c++ - 用户输入时的错误处理第 2 部分

> ID：236436
> 
> 赞同：1
> 
> 时间：2008-10-25T13:53:46.227
> 
> 标签：c++

我之前提出了一个问题： [接受用户输入时的错误处理](https://stackoverflow.com/questions/236354/error-handling-when-taking-user-input)

我做了建议的改变：

```
char displayMainMenu()
{
char mainMenuChoice;
cout << "\nQuadratic equation: a*X^2 + b*X + c = 0 main menu: "; 
cout << "\n <r>  Give new coefficients"; 
cout << "\n <c>  Calculate equations solutions"; 
cout << "\n <t>  Terminate the program";
cout<<"Enter choice : ";
cin>>mainMenuChoice;
return mainMenuChoice;
}

int main()
{
bool done = false;
while(!done)
{
    char choice = displayMainMenu();  
    switch(tolower(choice))
    {
        case 'r':
                cout<<"Entered case 'r'";
                break;
        case 'c':
                cout<<"Entered case 'c'";
                break;  
        case 't':
                cout<<"Entered case 't'";                   
                break;
        default:
                cout<<"Invalid choice! Try again"<<endl;   
    }
}
return 0;
} 
```

新问题是，如果用户输入错误，让我们说“ter”，我会得到以下信息:(:

```
Quadratic equation: a*X^2 + b*X + c = 0 main menu:   
 <r>  Give new coefficients 
 <c>  Calculate equations solutions  
 <t>  Terminate the program 
Enter choice : ter 
Entered case 't'

Quadratic equation: a*X^2 + b*X + c = 0 main menu:  
 <r>  Give new coefficients 
 <c>  Calculate equations solutions  
 <t>  Terminate the program 
Enter choice : Invalid choice! Try again

Quadratic equation: a*X^2 + b*X + c = 0 main menu:  
 <r>  Give new coefficients 
 <c>  Calculate equations solutions  
 <t>  Terminate the program 
Enter choice : Invalid choice! Try again 
```

我怎样才能避免这种情况发生？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-25T14:17:01.257

在您的`displayMainMenu()`函数中，不是读入 a ，而是`char`读入一个字符串。丢弃（带有警告）长度大于一个字符的任何输入。

您可以使用

```
char str[101]
std::cin.getline(str, 101); 
```

代替

```
cin >> mainMenuChoice; 
```

为了读取字符串。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-25T21:20:35.233

尝试这个：

```
string displayMainMenu()
{
    string mainMenuChoice;
    cout << "\nQuadratic equation: a*X^2 + b*X + c = 0 main menu: "; 
    cout << "\n <r>  Give new coefficients"; 
    cout << "\n <c>  Calculate equations solutions"; 
    cout << "\n <t>  Terminate the program";
    cout << "\nEnter choice : ";
    getline(cin, mainMenuChoice);
    return mainMenuChoice;
}

int main()
{
    bool done = false;
    while(!done)
    {
        string choice = displayMainMenu();
        if (choice.size() > 1 || choice.size() < 0)
            cout<<"Invalid choice! Try again"<<endl;

        switch(tolower(choice[0]))
        {
        case 'r':
            cout<<"Entered case 'r'";
            break;
        case 'c':
            cout<<"Entered case 'c'";
            break;  
        case 't':
            cout<<"Entered case 't'";
            break;
        default:
            cout<<"Invalid choice! Try again"<<endl;   
        }
    }
    return 0;
} 
```

使用 getline(istream, string &) 一次读取整行（不包括 eol）。检查它的长度是否正确，然后只查看第一个字符。

# .net - 使用 == 运算符比较两个舍入浮点数是否正确？

> ID：236439
> 
> 赞同：6
> 
> 时间：2008-10-25T13:54:35.397
> 
> 标签：.net, floating-point, compare, rounding

还是有可能操作会失败？

谢谢。

我选择了错误的术语，我真正的意思是四舍五入到 0，而不是截断。

关键是，我需要比较两个双精度的整数部分，我只是将它们转换为 int，然后使用 ==，但是，正如有人在我之前的一个问题中指出的那样，如果double 不能放入整数。

所以问题是'使用 == 运算符比较之前舍入为 0 的两个双精度值是否正确，或者我应该坚持转换为 int 方法并捕获可能的异常？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-10-25T14:06:35.757

[这是更新的站点](https://randomascii.wordpress.com/2012/02/25/comparing-floating-point-numbers-2012-edition)，它讨论了几种比较浮点数的方法的优缺点。（您仍然可以在[此处查看旧网站](http://www.cygnus-software.com/papers/comparingfloats/Obsolete%20comparing%20floating%20point%20numbers.htm)。）

我要采用的方法是“相对误差”方法。找出两个数字之间的差异，将其转换为数字的百分比，如果这个百分比足够小，那么你就得到了平等。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-13T21:48:27.307

更糟糕的是，有时，即使是完全相同的数字，它也会失败。这是因为一些编译器或处理器将在 CPU 寄存器中使用比在内存中更多的精度位（例如，MSVC 有 3 种不同的浮点行为选项）。因此，最近计算的值可能不会截断这些位，并且看起来不相等。永远不要在浮动上使用 ==。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-25T13:58:32.890

由于浮点表示的正常问题，它仍然可能失败。与其截断它们，不如使用表示等效精度的增量。

如果您有两个通常认为相同的浮点数，它可能会失败，

> > 10.19999999
> > 
> > 10.20000001

但是当你截断它们时，它们会给出不同的结果。

> > 10.19
> > 
> > 10.20

然而，如果我使用 0.001 的增量来比较差异，我会发现这两个值实际上是相同的。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-25T14:30:27.900

`==`与浮点一起使用永远不正确。

在浮点上下文中“截断”是什么意思？你在调用什么特定的库函数？结果是什么？是什么让您相信“截断”值比非截断值更具可比性？

浮点数是十进制值的近似值。浮点数只能精确表示二的幂。无论您执行何种浮点运算，所有其他值都会出现一些错误。

但是，如果您转换为整数，则可以使用`==`.

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-10-28T12:32:15.853

[http://www.windojitsu.com/code/floatcomparer.html](http://www.windojitsu.com/code/floatcomparer.html)

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-10-25T14:44:02.000

如果你的绝对值小于 2^23 单声道或 2^52 双声道，你可以使用 round() 然后进行比较。较大的值无法精确存储，这适用于 N == N+1 的情况。

# compression - 纯文本压缩算法的当前状态是什么？

> ID：236456
> 
> 赞同：31
> 
> 时间：2008-10-25T14:11:28.773
> 
> 标签：compression, lossless-compression, text-compression

为了纪念[Hutter 奖](http://prize.hutter1.net/)，文本压缩的顶级算法（以及每种算法的简要说明）是什么？

注意：这个问题的目的是了解压缩算法，而不是压缩程序。

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2008-10-26T18:37:57.790

边界推动压缩器结合了疯狂结果的算法。常用算法包括：

*   [Burrows-Wheeler 变换](http://en.wikipedia.org/wiki/Burrows-Wheeler_transform)和[此处](http://marknelson.us/1996/09/01/bwt/)- 使用可预测的算法对字符（或其他位块）进行洗牌，以增加重复块，从而使源更易于压缩。解压缩正常进行，结果未使用反向变换进行混洗。注意：单独的 BWT 实际上并不压缩任何东西。它只是使源更容易压缩。
*   [部分匹配预测 (PPM) -](http://books.google.com/books?id=ChSOjgiY84YC&pg=PA141&lpg=PA141&dq=Prediction+by+Partial+Match+PPM&source=web&ots=HIq05xfhjB&sig=b5JSuIz9D9C7yJJCwLcoTL2ECnM&hl=en&sa=X&oi=book_result&resnum=3&ct=result)[算术编码](http://en.wikipedia.org/wiki/Arithmetic_coding)的演变，其中预测模型（上下文）是通过处理有关源的统计数据而不是使用静态概率来创建的。尽管它的根源在于算术编码，但结果可以用霍夫曼编码或字典以及算术编码来表示。
*   上下文混合——算术编码使用静态上下文进行预测，PPM 动态选择单个上下文，上下文混合使用许多上下文并权衡它们的结果。PAQ 使用上下文混合。[这是](http://en.wikipedia.org/wiki/PAQ#Algorithm)一个高级概述。
*   [动态马尔可夫压缩](http://en.wikipedia.org/wiki/Dynamic_Markov_Compression)- 与 PPM 相关，但使用位级上下文而不是字节或更长。
*   此外，Hutter 奖参赛者可以用来自外部词典的小字节条目替换普通文本，并用特殊符号区分大小写文本，而不是使用两个不同的条目。这就是为什么它们如此擅长压缩文本（尤其是 ASCII 文本）而对一般压缩没有那么有价值。

[最大压缩](http://www.maximumcompression.com/index.php)是一个非常酷的文本和通用压缩基准站点。Matt Mahoney 发布了另一个[基准](http://www.cs.fit.edu/~mmahoney/compression/text.html)。Mahoney's 可能特别有趣，因为它列出了每个条目使用的主要算法。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-25T14:29:44.923

总是有[lzip](http://web.archive.org/web/20050514074112/lzip.sourceforge.net/)。

开个玩笑：

*   在考虑兼容性的情况下，PKZIP（`DEFLATE`算法）仍然获胜。
*   bzip2 是享受相对广泛的安装基础和相当好的压缩比之间的最佳折衷方案，但需要单独的存档器。
*   [7-Zip](http://7-zip.org/)（`LZMA`算法）压缩得非常好，可用于 LGPL。然而，很少有操作系统附带内置支持。
*   [rzip](http://rzip.samba.org/)是 bzip2 的一个变体，在我看来它值得更多关注。对于需要长期归档的大型日志文件，这可能特别有趣。它还需要一个单独的存档器。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2018-01-21T10:53:35.503

如果您想将 PAQ 用作程序，您可以在`zpaq`基于 debian 的系统上安装该软件包。用法是（另见`man zpaq`）

```
zpaq c archivename.zpaq file1 file2 file3 
```

压缩到大约**zip 文件大小的 1/10**。（1.9M 对 15M）

# emacs - 在 Emacs font-lock-mode 中对字符串文字中的变量引用进行字体化

> ID：236463
> 
> 赞同：4
> 
> 时间：2008-10-25T14:18:16.493
> 
> 标签：emacs, font-lock

当我在 Emacs ruby​​-mode 中键入以下代码时，“#{foo}”的字体颜色与封闭字符串不同。如何在我自己的 Emacs 模式下执行此操作？我试图破译 ruby​​ 模式的源代码，但在合理的时间内无法理解它。

```
"a #{foo} a" 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-25T15:47:27.107

终于想通了。答案是字体化规则中的“override”参数应该设置为 t，这意味着给定的 face 将覆盖字符串 face。有关详细信息，请参阅变量“font-lock-keywords”的文档。这是一个例子：

```
(define-derived-mode temp-mode fundamental-mode "Temp"
  "Temporary major mode."
  (set (make-local-variable 'font-lock-defaults)
       '((temp-mode-font-lock-keywords) nil nil nil nil)))

(defconst temp-mode-font-lock-keywords
  (list (list "$[A-Za-z0-9]+" 0 font-lock-variable-name-face t))) 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-25T15:44:25.587

搜索 ruby​​-mode.el 设置的位置`font-lock-syntactic-keywords`：

```
(setq ruby-font-lock-syntactic-keywords
  '(
    ;; #{ }, #$hoge, #@foo are not comments
    ("\\(#\\)[{$@]" 1 (1 . nil)) 
```

这是关于类似[`font-lock-keywords`](http://www.delorie.com/gnu/docs/elisp-manual-21/elisp_367.html)变量的一些文档，您应该使用它来完成相同类型的字体化。

# .net - rhino-mocks - 很好的示例应用程序

> ID：236466
> 
> 赞同：6
> 
> 时间：2008-10-25T14:22:23.397
> 
> 标签：.net, testing, ado.net, mocking, rhino-mocks

我知道有几个关于 rhino-mocks 教程的问题。但我想知道是否有任何示例应用程序在使用 ado.net 的 n 层业务应用程序的上下文中使用 rhino-mocks。

我觉得 tutes 很好，但它们似乎并没有把所有东西都放在一起。因此，我正在寻找一个能够将全貌结合在一起的示例应用程序。

另外，我认为缺少专门处理模拟和测试数据访问层中的逻辑的示例。

干杯安东尼

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-20T13:25:46.573

我有一个来自我关于测试的演讲的演示应用程序。它使用 Rhino Mocks 进行了一些模拟。如果您愿意，可以下载它：

[http://www.houseofbilz.com/archive/2008/10/18/gui-testing-resources.aspx](http://www.houseofbilz.com/archive/2008/10/18/gui-testing-resources.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-25T15:45:26.270

[Rhino Mocks 文档](http://ayende.com/wiki/Rhino+Mocks+Documentation.ashx)
[TDD：Rhino Mocks 简介](http://weblogs.asp.net/stephenwalther/archive/2008/03/22/tdd-introduction-to-rhino-mocks.aspx)

使用谷歌你会更好。
您应该尝试理解模拟，其目的是通过[模拟](http://www.answers.com/mocking)一些较低层来使测试成为可能。它提供了将**大图片**拆分为许多独立的小图片的方法。这样您就可以在不访问数据库的情况下测试业务层。

[Stackoverflow：什么是模拟，什么时候应该使用它？](https://stackoverflow.com/questions/214092/what-is-a-mock-and-when-should-you-use-it)

# php - 如何在 PHP 中向套接字发送控制字符？

> ID：236467
> 
> 赞同：1
> 
> 时间：2008-10-25T14:22:27.827
> 
> 标签：php, control-characters, php-socket

在我正在编写的 PHP 脚本中，我需要将 control+z 字符发送到我之前创建的网络套接字。我知道 ctrl+z 字符是 chr(26)，所以在我发送的字符串的末尾我添加了一个新行 (\r\n)，然后是 chr(26)，如下所示：

```
$socket=fsockopen($host['host'],$host['port']);
fputs($socket, "I am a message\r\n" . chr(26));
fclose($socket); 
```

可悲的是，这并没有像我希望的那样发送 Ctrl+Z。

问候，

乔恩

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-25T14:36:37.713

它可能被发送得很好。在 ^Z 之后添加额外的文本以确认。

问题是当它到达那里时你希望它做什么？您正在与之通信的程序是否按照您的预期处理 ^Z 字符？

# .net - 显示对话框时如何处理可重入验证事件

> ID：236476
> 
> 赞同：0
> 
> 时间：2008-10-25T14:28:45.923
> 
> 标签：.net, winforms, validation, events

我想知道人们如何处理这样的情况，当您有一个验证事件时，您需要向用户显示一个对话框，询问他是继续还是取消。

问题是，当显示该对话框时，它会导致另一个验证事件，因为它被认为再次失去对控件的关注，并且您最终会出现对话框弹出的无限循环。

我也无法在验证事件之前或之后显示消息框，因为用户尚未完成对控件的编辑，或者该值已经提交并且回滚会导致其自身的问题。

我现在正在做的是在显示对话框之前设置一个标志并在之后清除它，然后在验证事件函数中，检查是否设置了标志，如果是，则跳过该功能。它可以工作，但很麻烦并且容易出现程序员错误。

有没有更简单的方法来处理这样的事情？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-25T14:43:39.897

查看控件上的[CausesValidation属性。](http://msdn.microsoft.com/en-us/library/system.windows.forms.control.causesvalidation.aspx)您可以设置您按下的按钮是否会触发您的验证事件。您还可以通过编程方式设置它以防止您的验证逻辑在不合时宜的时间触发。

# database - 我在哪里可以下载可以用作数据仓库的示例数据库？

> ID：236478
> 
> 赞同：10
> 
> 时间：2008-10-25T14:29:55.653
> 
> 标签：database, data-warehouse

在哪里可以下载可用于创建数据仓库的示例数据库？它不应该是来自 Microsoft（Northwind 等）的样本。

编辑：很抱歉没有澄清我的问题。在我的大学，我们有必须创建一些数据仓库的课程，由于 Northwind 在网络上如此受欢迎，所以教授告诉我们不要使用这个数据库。我们将使用此 SQL Server 2008，但禁止使用 Northwind。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-25T14:44:48.490

这是一个免费的在线数据库数据生成器： [www.generateddata.com](http://www.generatedata.com/)

您可以设计一个表结构并让脚本生成行来填充它。这不完全是您所需要的，但我认为它可以提供帮助。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-25T15:32:24.210

NOT Northwind 发生了什么？

[http://www.hanselman.com/blog/CommunityCallToActionNOTNorthwind.aspx](http://www.hanselman.com/blog/CommunityCallToActionNOTNorthwind.aspx)

还有来自 Redgate 的 SQL 数据生成器：

[http://www.red-gate.com/products/SQL_Data_Generator/index.htm](http://www.red-gate.com/products/SQL_Data_Generator/index.htm)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2014-04-03T23:59:06.183

本学期我一直在为 BI 使用 Open Flights 数据集。这个飞行数据可以用于未来的项目，以及任何与[Kimball](http://www.kimballgroup.com/category/kimball-classics/)或 Red Gate 相关的项目。我喜欢在此页面上学习方法之间的区别，[数据仓库架构](http://www.jamesserra.com/archive/2012/03/data-warehouse-architecture-kimball-and-inmon-methodologies/)。

[OpenFlights.org](http://openflights.org/data.html)

此外，它可以在这个[可视化数据网页上的数据集、全球飞行网络数据下下载。](http://www.visualizing.org/datasets/global-flights-network)

在 DataHub了解有关[OpenFlights 数据的](http://datahub.io/dataset/open-flights)更多信息。

此外，数据在 dat 文件中，我在 Excel 中使用分隔列将其导入。之后，使用数据就没有那么难了。[这是在 Excel 中使用逗号分隔符导入这些数据文件的一个很好的教程](http://www.excel-easy.com/examples/import-export-text-files.html)。

此外，我[还在 Databaseanswers.org 上找到了这个数据集页面，其中还有一些其他有用的企业数据模型数据示例](http://www.databaseanswers.org/data_models/enterprise_data_models.htm)。

如果您发现任何其他有用的数据集学习示例，请告诉我。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-11-27T01:22:29.223

Hey Just use Adventure works SR4

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-07-12T16:49:04.777

最好的学习方法是使用 AdventureWorks 数据库。它有一个关系版本，用于演示源数据，还有一个星型模式版本，它是从关系版本构建的，用于数据仓库/OLTP 系统。

从这里下载 - 许多关于 SQL Server / SSAS 的 Microsoft 书籍都以此为例。我的一个朋友用它来学习数据仓库并获得了他的第一份 BI 工作。

[http://msftdbprodsamples.codeplex.com/](http://msftdbprodsamples.codeplex.com/)

# php - 仅 PHP 文件的 PHP 结束标记有哪些参数？

> ID：236493
> 
> 赞同：26
> 
> 时间：2008-10-25T14:37:36.680
> 
> 标签：php

Zend Framework 编码标准提到以下内容：

> 对于仅包含 PHP 代码的文件，从不允许使用结束标记 ("?>")。PHP 不需要它，并且省略它可以防止意外地将尾随空格注入响应中。

*   [Zend Framework 编码标准：文件格式化](http://framework.zend.com/manual/en/coding-standard.php-file-formatting.html)

但是我确实记得听说过一个问题（使用工具或可能包括？）文件需要有结束标记。

有谁知道您需要关闭标签的任何问题（除了需要对称的开发人员问题），或者它们通常是一个坏主意吗？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-10-25T15:25:46.253

尽可能删除结束标签可能是一个最佳实践。这样做的原因是因为如果您在 ?> 之外有任何字符（甚至空格）在 php 文件中，如果在设置标题之前将字符发送到浏览器，它可以停止诸如标题之类的事情停止工作。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-10-25T17:59:48.570

如果您使用关闭 PHP 标记，那么您可以轻松找到被意外截断的文件（例如，尚未完全上传）。
但是，应该通过使文件系统和传输可靠而不是添加 PHP“金丝雀”标签来解决此类问题 :)

另一个可能的原因是 PEAR 编码标准要求它。他们需要它，因为他们需要它，而且你不能质疑 PEAR 编码标准。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-25T17:39:28.317

您可以将仅用于 php 的文件的 php 开始标记视为一种 shebang 行（如 #!/bin/bash），这样您就不需要结束标记。

我们也遵循 ZF 标准，php-only 文件没有结束标记。但是我从来没有听说过任何工具因为缺少结束标签而无法解析文件，而且我还没有因为不使用它而遇到任何问题。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-25T19:18:06.480

我总是为 php 文件编写结束标记，并且故意不使用空格或 eol。

该标准暗示，如果省略结束标记，则将隐式提供一个。但这并不能免除开发人员编写正确的 html/xml 的责任。

并且可能存在两个文件在 html/php 处理之外合并的情况，缺少标签会导致极度悲痛。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-28T20:36:24.573

我总是把它们放进去，因为我把它们看作是一个花哨的右大括号——当我写条件和循环时，我在编写代码之前放入开/关大括号对，我对 PHP 文件做。

不管它是否“正确”，我经常发现自己将“纯”PHP 文件变成“非纯”，而结束标记非常有帮助。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-25T14:43:20.177

我们使用 Drupal，它总是省略结束标签，因此从来没有任何问题。

因为它总是适用于 Drupal（我从阅读手册中知道它是可选的），我曾经创建了一个没有结束标记的配置文件（仅包含 PHP 代码）。由于某种原因，直到（在同事的坚持下）我添加了结束标签，它才起作用。我们当时并没有试图找出原因。

我一直在编写的代码中使用结束标记；它看起来更简洁，从概念上“关闭”开始标签，我总是小心不要在结束标签后留下任何额外的空白。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-25T17:08:02.107

我总是使用结束标签，没有它们看起来就不好看。没有它们，它也不是有效的 xml 处理指令（不是你关心文件中唯一的东西是否是 php）

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-29T01:04:44.360

连接多个文件时，检查编码错误不起作用。我使用以下 shell 命令来检查错误。

```
find . -name '*.php' | xargs cat | php -l 
```

当然以下命令仍然有效（并显示损坏文件的文件名）

```
find . -name '*.php' | while read filename; do php -l $filename | grep -v 'No syntax errors '; done 
```

但是这个要慢得多。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-25T14:42:10.803

我们的办公室使用内置于 Flash 中的电子学习应用程序，我们很早就发现，如果服务器端脚本中省略了结束标记，那么它会破坏我们与电子学习应用程序的通信机制。

对此的一个警告是，我们的调试过程没有首先在简化的环境中尝试它，以确保它不是缺少结束标记和来自其他脚本的一些错误输出的组合......

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-10-25T17:03:52.943

回复@gabriel1836，服务器端的结束标签对于Flash应用程序是无关紧要的；相关的是服务器为响应 Flash 应用程序的远程处理请求而返回的有效负载。省略仅 PHP 文件上的结束标记只会影响这一点，以确保在将标头发送到您的 Flash 应用程序之前不返回虚假输出。

作为对@CesarB 的回复，除非你能给出一个具体的、可重复的例子，否则你所做的就是传播 FUD。PHP手册非常清楚结束标记是可选的。

# c# - 压缩 XML 指标。

> ID：236496
> 
> 赞同：3
> 
> 时间：2008-10-25T14:38:16.290
> 
> 标签：c#, xml, winforms, vb6, compression

我有一个客户端服务器应用程序，它通过 TCP/IP 从客户端向服务器发送 XML，然后广播到其他客户端。我如何知道通过压缩 XML 而不是通过常规流发送来保证性能改进的 XML 的最小大小。

有没有关于这个或例子的好的指标？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-25T15:15:30.927

Xml 通常压缩得很好，因为它往往有很多重复。

另一种选择是交换为二进制格式；BinaryFormatter 或 NetDataContractSerializer 是简单的选项，但与 xml 相比，两者都是出了名的不兼容（例如与 java）。

另一种选择是可移植的二进制格式，例如谷歌的“协议缓冲区”。我维护了一个名为[protobuf-net](http://code.google.com/p/protobuf-net/)的 .NET/C# 版本。这旨在与常规 .NET 方法（例如 XmlSerializer / DataContractSerializer）并行兼容，但比 xml 小得多，并且序列化和反序列化所需的处理（CPU 等）要少得多。

[此页面](http://code.google.com/p/protobuf-net/wiki/Performance)显示了 XmlSerializer、DataContractSerializer 和 protobuf-net 的一些数字；我*认为*它包括有/没有压缩的统计数据，但它们似乎已经消失了......

[更新] 我应该说 - 在 QuickStart 项目中有一个 TCP/IP 示例。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-25T14:57:47.773

一个松散的度量标准是压缩比单个数据包更大的任何东西，但这只是吹毛求疵。

没有理由避免在应用程序内部使用二进制格式——无论压缩需要多少时间，网络开销都会比压缩慢几个数量级（除非我们谈论的是非常慢的设备）。

如果这两个建议不让您放心，您可以随时进行基准测试以找到要压缩的位置。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-25T14:42:32.800

无论如何总是压缩它。

它将为您节省超过 2 个标签的带宽。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-25T14:56:03.173

要确定压缩是否对您有任何好处，您需要使用实际或预期的数据量来运行一些测试，这些数据预计将流经您的系统。

希望这可以帮助。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-25T16:52:55.553

在我们所做的测试中，我们发现了一个巨大的好处，但要注意 CPU 的影响。

在我参与的一个项目中，我们向运行 .NET 的客户端发送了大量的 XML 数据（> 10 meg）。（我不建议将其作为一种处理方式，这只是我们发现自己所处的情况！！）我们发现随着 XML 文件变得足够大，Microsoft XML 库无法解析 XML 文件（机器耗尽内存，即使在 > 1 gig 的机器上）。更改 XML 解析库最终会有所帮助，但在我们这样做之前，我们对传输的数据启用了 GZIP 压缩，这有助于我们解析大型文档。在我们的两个基于 linux 的 websphere 服务器上，我们能够生成 XML，然后相当容易地 gzip 它。我认为有 50 个用户同时执行此操作（加载大约 10 到 20 个这些文件）我们能够做到这一点，大约 50% 的 cpu。XML 的压缩在服务器上似乎比在 .net gui 上处理得更好（即解析/cpu 时间），但这可能是由于上面使用的 Microsoft XML 库的不足。正如我所提到的，有更好的库可用，它们更快并且使用更少的内存。

In our case, we got massive improvements in size too -- we were compressing 50 meg XML files in some cases down to about 10 meg. This obviously helped out network performance too.

Since we were concerned about the impact, and whether this would have other consequences (our users seemed to do things in large waves, so we were concerned we'd run out of CPU) we had a config variable which we could use to turn gzip on/off. I'd recommend that you do this too.

Another thing: we also zipped XML files before persisting them in databases, and this saved about 50% space (XML files ranging from a few K to a few meg, but mostly fairly small). It's probably easier to do everything than choose a specific level to differentiate when to use compression or not.

# visual-studio - 如何让 Visual Studio 以 80 个字符换行？

> ID：236517
> 
> 赞同：126
> 
> 时间：2008-10-25T14:47:48.530
> 
> 标签：visual-studio

有没有办法让 Visual Studio 自动换行 80 个字符？我正在使用VS2008。

[这篇文章是松散相关的。](https://stackoverflow.com/questions/84209/vertical-line-after-a-certain-amount-characters-in-visual-studio)

* * *

## 回答 #1

> 赞同：121
> 
> 时间：2008-10-26T22:45:16.670

除非有人可以推荐免费工具来执行此操作，否则您可以使用[ReSharper](http://www.jetbrains.com/resharper/)实现此目的：

ReSharper >> 选项... >> 语言/C# >> 换行和换行

*   勾选“换行”
*   将“右边距（列）”设置为所需的值（默认为 120）

希望有帮助。

* * *

## 回答 #2

> 赞同：77
> 
> 时间：2008-10-25T14:56:24.390

工具>>选项>>文本编辑器>>所有语言>>常规>>选择自动换行。

我不知道您是否可以选择特定数量的列？

* * *

## 回答 #3

> 赞同：36
> 
> 时间：2008-10-25T15:10:27.850

我不认为你可以让 VS 在 80 列处换行（我觉得这非常烦人），但你可以在 80 列处插入视觉指南，这样你就知道何时是插入换行符的好时机。

[有关为 3 个不同版本的 Visual Studio 插入 80 个字符的指南的详细信息](http://dream-runner.blogspot.com/2007/06/visual-studio-tips-80-character.html)。

* * *

## 回答 #4

> 赞同：20
> 
> 时间：2015-03-05T17:06:40.023

你也可以使用

`Ctrl+E, Ctrl+W`

打开和关闭换行的键盘快捷键。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2009-03-23T23:21:05.997

要使用[Visual Assist](http://www.wholetomato.com/)（另一个非免费工具）执行此操作：

VAssistX >> Visual Assist X 选项 >> 高级 >> 显示

*   选中“列后显示指示符”并将数字字段设置为 80。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2015-07-27T20:18:13.673

将垂直列指南添加到 Visual Studio 文本编辑器。此版本适用于 Visual Studio 2012、Visual Studio 2013 或 Visual Studio 2015。

查看[插件。](https://visualstudiogallery.msdn.microsoft.com/da227a0b-0e31-4a11-8f6b-3a149cf2e459/view/Reviews)

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2018-03-01T18:55:29.387

我在实际寻找这个问题的答案时偶然发现了这个问题[（](https://stackoverflow.com/questions/84209/adding-a-guideline-to-the-editor-in-visual-studio)如何在字符限制处添加视觉线/指南）。所以我想在这里为像我这样的人留下一个参考。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2018-10-12T12:39:08.543

如果问题只是您想知道何时为单行传递 80 个字符，这是常见的编码指南限制，您可以使用不同的方法：[编辑器指南](https://marketplace.visualstudio.com/items?itemName=PaulHarrington.EditorGuidelines)。这将在您的代码后面添加垂直列指南。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2015-01-04T16:22:32.220

另请参阅[此答案](https://stackoverflow.com/a/315531/193017)以方便地切换模式。

引文：

> 我经常使用此功能，因此我在命令栏上添加了一个自定义按钮。
> 
> 单击添加或删除 -> 自定义
> 单击命令选项卡
> 从列表中选择编辑|高级
> 查找切换自动换行并将其拖到您的栏上

# c# - 在 C# 中使用典型的 get set 属性...带参数

> ID：236530
> 
> 赞同：9
> 
> 时间：2008-10-25T14:56:48.447
> 
> 标签：c#, vb.net, properties

我想在 C# 中做同样的事情。无论如何在 C# 中使用带有参数的属性，就像我在这个 VB.NET 示例中使用参数“Key”一样？

> ```
> Private Shared m_Dictionary As IDictionary(Of String, Object) = New Dictionary(Of String, Object) 
> ```

```
Public Shared Property DictionaryElement(ByVal Key As String) As Object
    Get
        If m_Dictionary.ContainsKey(Key) Then
            Return m_Dictionary(Key)
        Else
            Return [String].Empty
        End If
    End Get
    Set(ByVal value As Object)
        If m_Dictionary.ContainsKey(Key) Then
            m_Dictionary(Key) = value
        Else
            m_Dictionary.Add(Key, value)
        End If

    End Set
End Property 
```

谢谢

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-10-25T15:05:37.520

> 无论如何在 C# 中使用带参数的属性

不可以。您只能在 C# 中提供带有参数的*默认属性，以对索引访问进行建模（如在字典中）：*

```
public T this[string key] {
    get { return m_Dictionary[key]; }
    set { m_Dictionary[key] = value; }
} 
```

其他属性不能有参数。改用函数。顺便说一句，建议在 VB 中执行相同的操作，以便其他 .NET 语言（C# ...）可以使用您的代码。

顺便说一句，您的代码过于复杂。四件事：

*   您不需要转义`String`标识符。直接使用关键字。
*   为什么不使用`""`？
*   使用`TryGetValue`，它更快。您查询字典两次。
*   您的 setter 不必测试该值是否已经存在。

* * *

```
Public Shared Property DictionaryElement(ByVal Key As String) As Object
    Get
        Dim ret As String
        If m_Dictionary.TryGetValue(Key, ret) Then Return ret
        Return "" ' Same as String.Empty! '
    End Get
    Set(ByVal value As Object)
        m_Dictionary(Key) = value
    End Set
End Property 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-25T17:35:45.437

在 C# 中执行此操作的“正确”方法是专门创建子类来访问集合。它应该要么持有集合本身，要么与父类有内部链接。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2011-06-11T00:55:36.237

针对您的问题的更通用、更安全和可重用的解决方案可能是实现一个通用的“参数化”属性类，如下所示：

```
 // Generic, parameterized (indexed) "property" template
    public class Property<T>
    {
        // The internal property value
        private T PropVal = default(T);

        // The indexed property get/set accessor 
        //  (Property<T>[index] = newvalue; value = Property<T>[index];)
        public T this[object key]
        {
            get { return PropVal; }     // Get the value
            set { PropVal = value; }    // Set the value
        }
    } 
```

然后，您可以在公共类中实现任意数量的属性，以便客户端可以使用索引、描述符、安全密钥或其他任何内容设置/获取属性，如下所示：

```
 public class ParameterizedProperties
    {
        // Parameterized properties
        private Property<int> m_IntProp = new Property<int>();
        private Property<string> m_StringProp = new Property<string>();

        // Parameterized int property accessor for client access
        //  (ex: ParameterizedProperties.PublicIntProp[index])
        public Property<int> PublicIntProp
        {
            get { return m_IntProp; }
        }

        // Parameterized string property accessor
        //  (ex: ParameterizedProperties.PublicStringProp[index])
        public Property<string> PublicStringProp
        {
            get { return m_StringProp; }
        }
    } 
```

最后，客户端代码将访问您的公共类的“参数化”属性，如下所示：

```
 ParameterizedProperties parmProperties = new ParameterizedProperties();
        parmProperties.PublicIntProp[1] = 100;
        parmProperties.PublicStringProp[1] = "whatever";
        int ival = parmProperties.PublicIntProp[1];
        string strVal = parmProperties.PublicStringProp[1]; 
```

当然，这看起来很奇怪，但它确实可以解决问题。此外，从客户端代码的角度来看，它一点也不奇怪——它简单直观，就像真实的属性一样。它不会破坏任何 C# 规则，也不会与其他 .NET 托管语言不兼容。从类实现者的角度来看，创建一个可重用、通用、“参数化”的属性模板类使得组件编码变得相对容易，如下所示。

注意：您始终可以覆盖通用属性类以提供自定义处理，例如索引查找、安全控制的属性访问或您想要的任何东西。

干杯!

马克琼斯

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-25T19:13:16.503

这是给您的示例（根据 Grauenwolf 的建议进行了更改）：

```
using System;
using System.Collections.Generic;

public class Test
{
    public FakeIndexedPropertyInCSharp DictionaryElement { get; set; }

    public Test()
    {
        DictionaryElement = new FakeIndexedPropertyInCSharp();
    }

    public class FakeIndexedPropertyInCSharp
    {
        private Dictionary<string, object> m_Dictionary = new Dictionary<string, object>();

        public object this[string index]
        {
            get 
            {
                object result;
                return m_Dictionary.TryGetValue(index, out result) ? result : null;
            }
            set 
            {
                m_Dictionary[index] = value; 
            }
        }
    }

}

class Program
{
    static void Main(string[] args)
    {
        Test t = new Test();
        t.DictionaryElement["hello"] = "world";
        Console.WriteLine(t.DictionaryElement["hello"]);
    }
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-25T15:11:33.417

您的代码示例让我觉得这是一个非常奇怪的设计，并且滥用了预期的属性。为什么不只是一个实例方法`AddOrUpdateKey`：

```
Public Sub AddOrUpdateKey(ByVal Key As String, ByVal Value as Object)
    If m_Dictionary.ContainsKey(Key) Then
        m_Dictionary(Key) = Value
    Else
        m_Dictionary.Add(Key, Value)
    End If
End Sub 
```

`String.Empty`如果键不存在，您的属性也会返回，但声称返回 a`Object`或 a `String`。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-26T15:52:18.687

谢谢康拉德、艾伦、格劳恩沃尔夫，

总之，我不能以与在 VB.NET 中完全相同的方式使用 C# 属性... :_( 无论如何，您的答案对我非常有用，我可能会将这些想法带到我的 C# 代码中。

除了属性问题的答案之外，还有其他优点。例如，

> *   *使用 TryGetValue，它更快。您查询字典两次。*
> *   *您的 setter 不必测试该值是否已经存在。*

也感谢 Sören，使用一种方法并不适合我最初的目标，但非常感谢。

# windows - 如何在 Windows 中自动复制路径太深的文件？

> ID：236533
> 
> 赞同：4
> 
> 时间：2008-10-25T14:58:47.193
> 
> 标签：windows, copy

我希望能够有选择地复制文件列表并保留它们的目录结构。问题是有不少文件的路径超过 256 个字符。这个问题一般是怎么处理的？

编辑：我应该明确表示我只想选择性地复制文件，而不是文件夹。我认为 robocopy 不能有效地用于复制单个文件及其文件夹结构。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-25T15:06:21.823

Robocopy 是[Windows Resource Kit](http://www.microsoft.com/downloads/details.aspx?familyid=9d467a69-57ff-4ae7-96ee-b18c4790cffd)的一部分，旨在处理此类情况。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-25T17:02:34.053

您想自己实施复制过程吗？如果是这样，您是否尝试过 UNC 路径？我从来不需要使用它们，但是简单地说，您使用前缀并且路径可以比 MAX_PATH 长得多，如[MSDN 文章中所述](http://msdn.microsoft.com/en-us/library/aa365247.aspx)。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-25T15:04:34.183

我写了一个 VBscript 来检查路径长度和调用`subst`，一旦达到某个阈值。这些调用相互堆叠，因此在递归中间，存在以下布局：

```
C:\a\very\long\path
subst K: "C:\a\very\long\path"

K:\another\very\long\path
subst L: "K:\another\very\long\path"

L:\yet\another\very\long\path
subst M: "L:\yet\another\very\long\path"

xcopy M:\*.* "D:\target" 
```

这样，对于每个 subst 级别，都会生成更短的路径。这也意味着，您必须按顺序复制文件夹，以便在发出复制命令之前能够检查长路径。

复制文件夹中的所有文件后，递归确实会跳回一级 ( `subst /d`)，从而释放一个驱动器号。

使用 4-5 个驱动器号，当路径变深时相互替代，我能够复制长度超过 MAX_PATH 限制的路径。

* * *

编辑

这描述了使用 subst 执行此操作的一般过程。你怎么做取决于你的需要，我总是以最小的“解决这个单一问题”的方式使用这个小技巧。

例如，复制到同样深的目标路径意味着您需要另一堆替换的驱动器号。

将所有 .zip 文件解压缩在一个深度嵌套的目录结构中可能只需要在堆栈上，但您需要稍微缩短阈值以考虑 .zip 中的文件夹等。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-25T17:56:39.420

过去的一个技巧是为目录的一部分分配一个驱动器号。

一种选择是 SUBST 命令。这将允许您用驱动器号替换驱动器号和路径组合。我已经在安装包中看到了这一点，以获得更短版本的目录。

Alternativly you can use a shared folder and map it to a drive letter. Or you can use the an administrative share.

But really if you have code that you can run, then handling it there is much better that these hacks.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-07-23T16:24:35.977

As Sören suggested, try Robocopy:

```
robocopy empty_dir base_nested_dir /purge 
```

# ruby - 耙子和当前目录

> ID：236538
> 
> 赞同：27
> 
> 时间：2008-10-25T15:05:17.317
> 
> 标签：ruby, rake

如何获取 rakefile.rb 所在的目录？

我想用它作为我的根目录来定位一切。

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2008-10-25T15:19:40.263

用于`__FILE__`获取文件名，然后您可以从那里获取目录：

在`test.rb`

```
puts __FILE__ 
```

输出：

```
/users/foo/test.rb 
```

`__FILE__`解析为它所在文件的完整路径。

使用它来获取目录名称：

```
File.dirname(__FILE__) 
```

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2008-11-03T21:59:05.303

您可以通过调用**application.original_dir**方法来获取它。在任务中，您可以使用任务对象上的应用程序方法来实现应用**程序***对象*。

 *** * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-05-01T08:30:30.917

为什么不直接使用 Dir.pwd

?

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2018-07-23T17:43:22.263

从 Ruby 2 开始，您可以使用[`__dir__`而不是`File.dirname(__FILE__)`](https://bogdanvlviv.com/posts/ruby/with-__dir__-we-can-restore-order-in-the-universe.html)获取包含当前脚本的目录。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-25T15:18:54.210

如果这是一个 RoR 应用程序，您的 Rakefile.rb 应该在您的 RAILS_ROOT 目录中。因此，在任何脚本中，您都可以指定文件位置，例如

```
 config.load_paths += %W( #{RAILS_ROOT}/extras ) 
```

# c# - 比较数据表

> ID：236555
> 
> 赞同：2
> 
> 时间：2008-10-25T15:19:02.463
> 
> 标签：c#, datatable

我构建了一个应用程序，它在窗口中显示数据库中的记录，并每隔几秒钟检查一次数据库中的新记录。问题是每次我检查新记录时窗口都会闪烁并且我想修复它。我试图将旧数据表与新数据表进行比较，只有在它们不同时才刷新。有谁知道这种情况的最佳做法是什么？我尝试按照以下方式进行操作，但它不起作用：

```
private bool GetBelongingMessages()
        {
            bool result = false;
            DataTable dtTemp = OleDbWorks.GetBelongingMessages(currentCallID);
            if(dtTemp != dtMessages)
            {
                dtMessages = dtTemp;
                result = true;
            }
            else
            {
                result = false;
            }
            return result;
        } 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-25T15:30:15.150

首先，重要的是要认识到您在代码中比较的是数据表的*引用*，而不是数据表的*内容*。为了确定两个数据表是否具有相同的内容，您将不得不遍历所有行和列并查看它们是否相等：

```
//This assumes the datatables have the same schema...
        public bool DatatablesAreSame(DataTable t1, DataTable t2) {         
            if (t1.Rows.Count != t2.Rows.Count)
                return false;

            foreach (DataColumn dc in t1.Columns) {
                for (int i = 0; i < t1.Rows.Count; i++) {
                    if (t1.Rows[i][dc.ColumnName] != t2.Rows[i][dc.ColumnName]) {
                        return false;
                    }
                }
            }
            return true;
        } 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-17T19:35:13.163

我一直在尝试寻找一种方法来进行 DataTable 比较，最后编写了自己的函数，这就是我得到的：

```
bool tablesAreIdentical = true;

// loop through first table
foreach (DataRow row in firstTable.Rows)
{
    foundIdenticalRow = false;

    // loop through tempTable to find an identical row
    foreach (DataRow tempRow in tempTable.Rows)
    {
        allFieldsAreIdentical = true;

        // compare fields, if any fields are different move on to next row in tempTable
        for (int i = 0; i < row.ItemArray.Length && allFieldsAreIdentical; i++)
        {
            if (!row[i].Equals(tempRow[i]))
            {
                allFieldsAreIdentical = false;
            }
        }

        // if an identical row is found, remove this row from tempTable 
        //  (in case of duplicated row exist in firstTable, so tempTable needs
        //   to have the same number of duplicated rows to be considered equivalent)
        // and move on to next row in firstTable
        if (allFieldsAreIdentical)
        {
            tempTable.Rows.Remove(tempRow);
            foundIdenticalRow = true;
            break;
        }
    }
    // if no identical row is found for current row in firstTable, 
    // the two tables are different
    if (!foundIdenticalRow)
    {
        tablesAreIdentical = false;
        break;
    }
}

return tablesAreIdentical; 
```

与 Dave Markle 的解决方案相比，我将两个具有相同记录但顺序不同的表视为相同。希望这对再次偶然发现此线程的人有所帮助。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-25T16:10:35.797

您必须投射对象 t1.Rows[i][dc.ColumnName] 和 t1.Rows[i][dc.ColumnName] 否则语句 t1.Rows[i][dc.ColumnName] != t2.Rows[i] [dc.ColumnName] 始终为真。我通过以下方式修改了代码：

```
for(int i = 0; i < t1.Rows.Count; i++)
            {
                if((string)t1.Rows[i][1] != (string)t2.Rows[i][1])
                    return false;
            } 
```

它有效，但它不是一个优雅的解决方案。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-08-30T05:53:00.113

```
 public Boolean CompareDataTables(DataTable table1, DataTable table2)
   {
       bool flag = true;
       DataRow[] row3 = table2.Select();
       int i = 0;// row3.Length;
       if (table1.Rows.Count == table2.Rows.Count)
       {
           foreach (DataRow row1 in table1.Rows)
           {
               if (!row1.ItemArray.SequenceEqual(row3[i].ItemArray))
               {
                   flag = false;
                   break;
               }
               i++;
           }

       }
       else
       {
           flag = false;
       }
       return flag;
   } 
```

// 这里这个函数将给出布尔值作为结果如果两者相同则返回true否则如果两者不同则返回false

# .net - Linq to Sql - 查找祖先的分层查询

> ID：236575
> 
> 赞同：4
> 
> 时间：2008-10-25T15:29:16.450
> 
> 标签：.net, linq-to-sql, hierarchy

给定一个 EmployeeId，我如何构造一个 Linq to Sql 查询来查找该员工的所有祖先？每个 EmployeeId 都有一个关联的 SupervisorId（见下文）。

例如，对 EmployeeId 6 (Frank Black) 的祖先的查询应返回 Jane Doe、Bob Smith、Joe Bloggs 和 Head Honcho。

如有必要，我可以缓存所有员工的列表以提高绩效。

**更新：**

我创建了以下粗略的方法来完成任务。它遍历employee.Supervisor关系一直到根节点。但是，这将为每个员工发出一个数据库调用。有人有更简洁或更高效的方法吗？谢谢。

```
private List<Employee> GetAncestors(int EmployeeId)
{
    List<Employee> emps = new List<Employee>();
    using (L2STestDataContext dc = new L2STestDataContext())
    {
        Employee emp = dc.Employees.FirstOrDefault(p => p.EmployeeId == EmployeeId);
        if (emp != null)
        {
            while (emp.Supervisor != null)
            {
                emps.Add(emp.Supervisor);
                emp = emp.Supervisor;
            }
        }
    }
    return emps;
} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-25T22:03:15.723

首先，欢迎您在我的[LINQ 扩展方法项目](http://www.codeplex.com/linqext/)中使用分层查询。我认为可能有助于简化您的代码。

这里的问题是这将为层次结构中的每个节点创建一个数据库调用。在您的示例中，您将有 5 次往返数据库。

我会走一条不同的路并创建一个存储过程来为我做这件事并返回整个`Employee`对象集。由于您在返回对象（处理上下文）之前断开了对象的连接，因此您可以简单地从存储过程的结果集中创建新对象。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-27T11:29:20.293

避免加载整个 Employee 表（但遍历深度有限）的简单解决方案是......

```
var emps = dc.Employees.Where(e => (e.EmployeeId == EmployeeId) ||
                                   (e.SupervisorId == EmployeeId) ||
                                   (e.Supervisor.SupervisorId == EmployeeId) ||
                                   (e.Supervisor.Supervisor.SupervisorId == EmployeeId) ||
                                   ...); 
```

最终，您应该使用[公用表表达式](http://msdn.microsoft.com/en-us/library/ms186243.aspx)来展平层次结构，但 LINQ to SQL 目前不支持这一点。您可以考虑编写自己的扩展方法（例如 Omer 库中的扩展方法，但使用 IQueryable 而不是 IEnumerable 来支持服务器端执行）。

# svn - 多个文件的SVN更新

> ID：236593
> 
> 赞同：2
> 
> 时间：2008-10-25T15:45:09.703
> 
> 标签：svn

如何对位于不同目录的多个文件进行 svn 更新？

对于从不同目录提交多个文件，我们可以将它们全部放在一个文本文件中，并将该文件作为参数提供给 svn commit，它会愉快地提交所有这些文件。但是**更新**？

**编辑：** Fooz 先生的回答绝对是一个选项，我可以创建一个包含所有 svn 更新的 .bat 或 .sh 文件。但我想知道 svn 提供的任何特殊参数是否可以用来代替包含大量 svn update 命令的文件。请注意，svn commit 使用的文件*只*包含文件名，没有 svn 命令。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-25T20:48:07.827

鉴于当有很多可用的下游更改可用时，有充分的理由从存储库选择性地更新，我的问题是您是否尝试在 UNIX/Linux/等上执行此操作。系统或 Windows。如果是 Windows，我不知道如何执行以下等效操作：

```
svn update `cat list_of_files` 
```

（有一些极端情况，类似于运行“find ... | xargs cmd ...”，文件名中的空格或 shell 敏感字符可能会导致问题。您必须通过正确转义来处理这些问题问题字符。）

如果出于某种可怕的原因，您的文件列表非常庞大，以至于打破了 shell 命令行长度限制，您可以这样做：

```
cat list_of_files | xargs svn update 
```

使用其中任何一种时要记住两件事：

1.  所有文件名都必须是绝对的，或者相对于您运行命令的点。
2.  如果列表中的“文件”之一实际上是一个目录，则该目录中具有可用更改的***所有***文件都将被更新。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-25T20:58:48.367

Subversion 有一个“更改列表”功能（我相信 1.5 中的新功能），它允许您通过执行以下操作来定义一个命名的更改列表：

```
svn changelist yourlist file1 file2 file3 ... 
```

定义后，您可以传递`--changelist`给多个命令，包括`svn update`，它们只会对与该更改列表关联的文件进行操作。例如：

```
svn update --changelist yourlist 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-25T16:12:30.720

您可以在更新命令中指定多个*文件夹：*

```
svn update docs foo/bar/ /repos/bar 
```

如果您真的想限制自己更新单个文件，我必须同意[Jon Topper](https://stackoverflow.com/questions/236593/svn-update-of-multiple-files#236615)的观点，即您可能会偏离轨道。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-25T15:47:05.627

如果您不介意创建一个带有固定目录列表的单独文件，您可以将其设为 shell 脚本或 .bat 文件（取决于您的平台）并在其中放置 N 个单独的 svn update 调用。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-25T15:59:56.500

您甚至想要这样做的事实向我表明，您可能没有特别明智地使用颠覆。

# c# - 如果我的对象真的可序列化，如何进行单元测试？

> ID：236599
> 
> 赞同：36
> 
> 时间：2008-10-25T15:47:00.977
> 
> 标签：c#, .net, unit-testing, serialization, .net-2.0

我正在使用带有 Nunit 测试的 C# 2.0。我有一些需要序列化的对象。这些对象相当复杂（不同层次的继承并包含大量对象、事件和委托）。

如何创建单元测试以确保我的对象可以安全地序列化？

* * *

## 回答 #1

> 赞同：48
> 
> 时间：2008-10-25T17:04:17.357

这是一个通用的方法：

```
public static Stream Serialize(object source)
{
    IFormatter formatter = new BinaryFormatter();
    Stream stream = new MemoryStream();
    formatter.Serialize(stream, source);
    return stream;
}

public static T Deserialize<T>(Stream stream)
{
    IFormatter formatter = new BinaryFormatter();
    stream.Position = 0;
    return (T)formatter.Deserialize(stream);
}

public static T Clone<T>(object source)
{
    return Deserialize<T>(Serialize(source));
} 
```

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2008-10-25T15:47:35.297

我在工作中的一些单元测试中有这个：

```
MyComplexObject dto = new MyComplexObject();
MemoryStream mem = new MemoryStream();
BinaryFormatter b = new BinaryFormatter();
try
{
    b.Serialize(mem, dto);
}
catch (Exception ex)
{
    Assert.Fail(ex.Message);
} 
```

可能会帮助你......也许其他方法可以更好，但这个效果很好。

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2008-10-25T15:54:12.800

除了上面的测试——确保序列化器接受你的对象，你需要做一个往返测试。将结果反序列化回一个新对象，并确保两个实例是等价的。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-25T16:19:31.097

序列化对象（到内存或磁盘），反序列化，使用反射比较两者，然后再次*运行该对象的所有单元测试*（当然序列化除外）

这假设您的单元测试可以接受一个对象作为目标，而不是自己创建

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2010-11-01T18:23:00.830

这是一个递归使用 IsSerializable 来检查对象及其所有属性是否可序列化的解决方案。

```
 private static void AssertThatTypeAndPropertiesAreSerializable(Type type)
    {
        // base case
        if (type.IsValueType || type == typeof(string)) return;

        Assert.IsTrue(type.IsSerializable, type + " must be marked [Serializable]");

        foreach (var propertyInfo in type.GetProperties(BindingFlags.Public | BindingFlags.NonPublic | BindingFlags.Instance))
        {
            if (propertyInfo.PropertyType.IsGenericType)
            {
                foreach (var genericArgument in propertyInfo.PropertyType.GetGenericArguments())
                {
                    if (genericArgument == type) continue; // base case for circularly referenced properties
                    AssertThatTypeAndPropertiesAreSerializable(genericArgument);
                }
            }
            else if (propertyInfo.GetType() != type) // base case for circularly referenced properties
                AssertThatTypeAndPropertiesAreSerializable(propertyInfo.PropertyType);
        }
    } 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2017-07-03T03:49:49.720

可能有点晚了，但是如果您使用的是[FluentAssertions](http://fluentassertions.com/documentation.html)库，那么它具有用于 XML 序列化、二进制序列化和数据协定序列化的自定义断言。

```
theObject.Should().BeXmlSerializable();
theObject.Should().BeBinarySerializable();
theObject.Should().BeDataContractSerializable();

theObject.Should().BeBinarySerializable<MyClass>(
    options => options.Excluding(s => s.SomeNonSerializableProperty)); 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2010-12-16T19:09:59.620

不幸的是，您无法对此进行真正的测试。想象一下这种情况：

```
[Serializable]
class Foo {
    public Bar MyBar { get; set; }
}

[Serializable]
class Bar {
    int x;
}

class DerivedBar : Bar {
}

public void TestSerializeFoo() {
    Serialize(new Foo()); // OK
    Serialize(new Foo() { MyBar = new Bar() }; // OK
    Serialize(new Foo() { MyBar = new DerivedBar() }; // Boom
} 
```

# api - 是否有一些关于最常用的 Java API 函数的统计数据？

> ID：236609
> 
> 赞同：5
> 
> 时间：2008-10-25T15:54:21.117
> 
> 标签：api, java

给定一个大型 API（特别是 Java 或 J2EE 标准库），是否有工具或搜索引擎或其他资源可以告诉我人们通常最常使用哪些方法、类甚至包？我正在注释（见下文）API，并希望将注意力集中在热门领域。我唯一能想到的就是使用具有不同方法名称的谷歌代码，但这当然很乏味。

一些背景（如果有人感兴趣的话）：作为我博士研究的一部分，我开发了一个[工具](http://emoose.cs.cmu.edu)，允许用户在方法文档（他们自己的或现有的 API）中突出显示重要的“指令”，然后将这些注释推送给用户以增加他们意识到这一点的机会。我们的实验室研究表明这是有潜力的，但为了让人们在现场使用它，我必须提供带注释的 API 的“语料库”，并且我正在尝试优先考虑要注释的库。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-25T16:16:59.107

我不知道这样的统计数据是否可行，但我认为一个非常安全的选择是从基础知识和一些著名的第三方库开始。例如：

*   [收藏品](http://java.sun.com/j2se/1.5.0/docs/guide/collections/index.html)
*   [常用表达](http://java.sun.com/j2se/1.5.0/docs/api/java/util/regex/package-summary.html)
*   [联网](http://java.sun.com/j2se/1.5.0/docs/guide/net/index.html)
*   [反射](http://java.sun.com/j2se/1.5.0/docs/guide/reflection/index.html)
*   [摇摆](http://java.sun.com/j2se/1.5.0/docs/guide/swing/index.html)（和[AWT](http://java.sun.com/j2se/1.5.0/docs/guide/awt/index.html)）

至于第三方

*   [乔达时间](http://joda-time.sourceforge.net/)
*   [阿帕奇公地](http://commons.apache.org/)
*   [Jetty](http://www.mortbay.org/)（Servlet 容器，但通常是嵌入式的）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-25T17:11:41.633

这个“简单”的 bash 脚本将计算您当前项目代码库中最常用的类。

```
寻找 。-名称“*.java”| xargs 猫 | grep "^import java" | 排序 | 唯一的-c | 排序-nr | 头 -100

```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-25T19:55:35.047

似乎可以自动化一个过程，其中 J2SE 或 J2EE 包列表可以提交到 Koders.com、Google Code 或其他开源代码搜索存储库，计算每个包的结果并排序最流行的。

请注意，这不会为您提供绝对完整的结果，因为 java.lang（或任何其他隐式导入的包/类）不会出现在该搜索中。

尽管我可能弄错了，但我认为不存在此类信息的现有工具或发布者。

另一种可能性是选择一些“代表性”项目，下载它们并使用依赖分析工具，如[JDepend](http://www.clarkware.com/software/jdepend.zip)，生成依赖报告并处理*它们*以获得一组正在使用的包/类。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-25T20:49:16.637

我想，您想根据使用频率对它们进行排名。我建议你下载一些开源的java项目，运行一个静态分析工具。然后在同一个集合上运行内存分析器，最后推断这些统计信息

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-11-15T21:50:31.450

您可以为此使用 MethodRank 指标，以检测一些开源项目中最常用的方法和类。

您可以获取[JavaDepend](http://www.javadepend.com)的试用版，分析一些流行的 java 开源项目，并执行一些 CQL 请求（如 SQL），以获取这些项目中所有最常用的方法、类、字段。

PS：试用版满足你的需求，没有时间限制。

# javascript - 如何访问没有 ID 的 HTML 元素？

> ID：236624
> 
> 赞同：24
> 
> 时间：2008-10-25T16:11:24.203
> 
> 标签：javascript, dom, xhtml

例如在下面的代码片段中 - 我如何在知道父元素 ID（header-inner div）的情况下访问 h1 元素？

```
<div id='header-inner'> 
   <div class='titlewrapper'> 
      <h1 class='title'> 
      Some text I want to change
      </h1> 
   </div> 
</div> 
```

谢谢！

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-10-25T16:31:00.823

```
function findFirstDescendant(parent, tagname)
{
   parent = document.getElementById(parent);
   var descendants = parent.getElementsByTagName(tagname);
   if ( descendants.length )
      return descendants[0];
   return null;
}

var header = findFirstDescendant("header-inner", "h1"); 
```

查找具有给定 ID 的元素，查询具有给定标签名称的后代，返回第一个。您还可以循环`descendants`以按其他条件进行过滤；如果你开始朝那个方向发展，我建议你检查一个预先构建的库，比如 jQuery（这将为你节省大量的时间来编写这些东西，它会变得有些棘手）。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-10-25T16:56:16.530

如果您要使用一些海报中提到的[jQuery](http://jquery.com/)，您可以像这样非常容易地访问该元素（尽管从技术上讲，如果有多个 H1 后代，这将返回一组匹配元素）：

```
var element = $('#header-inner h1'); 
```

与其他帖子中提到的常规方法相比，使用 JQuery 之类的库可以使这样的事情变得微不足道。然后，一旦您在 jQuery 对象中引用了它，您就可以使用更多的函数来轻松地操纵它的内容和外观。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-10-25T16:35:49.910

如果您确定 div 中只有一个 H1 元素：

```
var parent = document.getElementById('header-inner');
var element = parent.GetElementsByTagName('h1')[0]; 
```

正如 Shog9 所展示的，通过后代也是一个好方法。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-25T16:42:16.713

使用当前标记的最简单方法是：

`document.getElementById('header-inner').getElementsByTagName('h1')[0].innerHTML = 'new text';`

这假设您的 H1 标签始终是`'header-inner'`元素中的第一个标签。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-25T16:45:50.937

要获取子节点，请使用`obj.childNodes`，它返回一个集合对象。

要获得第一个孩子，请使用`list[0]`，它返回一个节点。

所以完整的代码应该是：

```
var div = document.getElementById('header-inner');
var divTitleWrapper = div.childNodes[0];
var h1 = divTitleWrapper.childNodes[0]; 
```

如果要遍历所有子项，比较它们是否属于“title”类，可以使用 for 循环和`className`属性进行迭代。

代码应该是：

```
var h1 = null;
var nodeList = divTitleWrapper.childNodes;
for (i =0;i < nodeList.length;i++){
    var node = nodeList[i];
    if(node.className == 'title' && node.tagName == 'H1'){
        h1 = node;
    }
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-25T16:38:53.337

在这里，我在具有 CSS class="myheader" 的 H1 元素的 div 中获取 H1 元素值：

```
var nodes = document.getElementById("mydiv")
                    .getElementsByTagName("H1");

for(i=0;i<nodes.length;i++)
{
    if(nodes.item(i).getAttribute("class") == "myheader")
        alert(nodes.item(i).innerHTML);
} 
```

这是标记：

```
<div id="mydiv">
   <h1 class="myheader">Hello</h1>
</div> 
```

如果您需要对 DOM 进行大量解析，我还建议您使用[jQuery 。](http://www.jquery.com)

# qt - Qt 的矢量图形剪贴板格式

> ID：236627
> 
> 赞同：7
> 
> 时间：2008-10-25T16:13:54.370
> 
> 标签：qt, svg, ms-office, .emf, metafile

我希望我的 Qt 应用程序能够以兼容的方式将简单的矢量图形保存到剪贴板。在 Windows 上，我希望能够将图形粘贴到 Microsoft Word 或 Powerpoint 中。在 Linux 上，我希望与 Open Office 兼容。

你会推荐哪种格式？Qt 能否以简单的方式生成 EMF？SVG是一种选择吗？

更新：

我目前的计划是添加一段本机 win32 代码来将图形渲染到 windows 上的 emf。此代码在 linux 上不可用。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-26T22:00:20.737

[QGraphicsView](http://doc.qt.io/qt-5/qgraphicsview.html)类及其关联的帮助程序可以通过[QPicture](http://doc.qt.io/qt-5/qpicture.html)类（您可以为其编写 EMF 的翻译器）呈现为 QT 元文件格式，通过[QSVGGenerator类呈现为 SVG，并通过](http://doc.qt.io/qt-5/qsvggenerator.html)[QPrinter](http://doc.qt.io/qt-5/qprinter.html)呈现为 postscript/pdf 。它还可以渲染为位图格式和各种其他目标。

AFAIK 它没有通用的“渲染到 EMF”设施 - 您必须写入 QT Metafile 之类的其他内容并转换为 EMF。如果您只需要图形基元的一个子集，您可能只需要在转换器中支持该子集。否则，您可以使用 SVG，您可以通过 QSVGGenerator 直接从 QT 获取。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2011-06-29T13:57:01.783

我在这里有一个 EMF 生成 PyQt QPaintEngine 类：[https](https://github.com/jeremysanders/veusz/blob/master/document/emf_export.py) ://github.com/jeremysanders/veusz/blob/master/document/emf_export.py 。它使用 pyemf 库，但我认为移植到 C++ 会相当容易。不幸的是，这些文件与 OpenOffice 不兼容，因为 OO 在 EMF 文件中的路径支持非常糟糕。它还将文本转换为所见即所得的路径。

# ruby - 还有哪些其他语言具有类似于 Perl 格式的功能和/或库？

> ID：236629
> 
> 赞同：6
> 
> 时间：2008-10-25T16:15:52.320
> 
> 标签：ruby, perl, format

我在这里可能是少数，但我非常喜欢[Perl 的格式](https://perldoc.perl.org/perlform)。我特别喜欢能够在一列中包含一段长文本（“~~ ^<<<<<<<<<<<<<<<<”类型的东西）。是否有任何其他具有类似功能的编程语言或实现类似功能的库？我对任何为 Ruby 实现类似功能的库特别感兴趣，但我也对任何其他选项感到好奇。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-10-25T21:23:19.610

当我多年前使用 Fortran 时，我似乎想起了类似的东西（但是，它很可能是一个第三方库）。

至于 Perl 中的其他选项，请查看[`Perl6::Form`](http://search.cpan.org/perldoc/Perl6::Form).

该`form`函数[`format`](http://perldoc.perl.org/functions/format.html)在 Perl6 中替换。Damian Conway 在“ [Perl 最佳实践](http://google.com/search?btnI=&q=%22Perl+Best+Practices%22)”中建议使用[`Perl6::Form`](http://search.cpan.org/perldoc/Perl6::Form)Perl5，并引用以下问题[`format`](http://perldoc.perl.org/perlform.html)......

*   静态定义
*   依赖全局变量进行配置，依赖 pkg 变量来格式化数据
*   使用命名文件句柄（仅）
*   不是递归的或可重入的

这是[`Perl6::Form`](http://search.cpan.org/perldoc/Perl6::Form)Robert Gamble 对 Ruby 示例的一个变体......

```
use Perl6::Form;

my ( $month, $day, $year ) = qw'Sep 18 2001';
my ( $num, $numb, $location, $toe_size );

for ( "Market", "Home", "Eating Roast Beef", "Having None", "On the way home" ) {
    push @$numb,     ++$num;
    push @$location, $_;
    push @$toe_size, $num * 3.5;
}

print form
    '   Piggy Locations for {>>>}{>>}, {<<<<}',
                          $month, $day, $year ,
    "",
    '  Number: location              toe size',
    '  --------------------------------------',
    '{]})      {[[[[[[[[[[[[[[[}       {].0} ',
     $numb,    $location,              $toe_size; 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-25T16:30:46.287

[FormatR](http://formatr.rubyforge.org/)为 Ruby 提供了类似 Perl 的格式。

这是文档中的一个示例：

```
require "formatr"
include FormatR

top_ex = <<DOT
   Piggy Locations for @<< @#, @###
                     month, day, year

Number: location              toe size
-------------------------------------------
DOT

ex = <<TOD
@)      @<<<<<<<<<<<<<<<<       @#.##
num,    location,             toe_size
TOD

body_fmt = Format.new (top_ex, ex)

body_fmt.setPageLength(10)
num = 1

month = "Sep"
day = 18
year = 2001
["Market", "Home", "Eating Roast Beef", "Having None", "On the way home"].each {|location|
    toe_size = (num * 3.5)
    body_fmt.printFormat(binding)
    num += 1
} 
```

产生：

```
 Piggy Locations for Sep 18, 2001

Number: location              toe size
-------------------------------------------
1)      Market                   3.50
2)      Home                     7.00
3)      Eating Roast Beef       10.50
4)      Having None             14.00
5)      On the way home         17.50 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-25T16:30:02.963

有[Lisp`(format ...)`功能](http://gigamonkeys.com/book/a-few-format-recipes.html)。它支持循环、条件和一大堆其他有趣的东西。

例如（从上面的链接复制）：

```
(defparameter *english-list*
  "~{~#[~;~a~;~a and ~a~:;~@{~a~#[~;, and ~:;, ~]~}~]~}")

(format nil *english-list* '())       ;' ==> ""
(format nil *english-list* '(1))      ;' ==> "1"
(format nil *english-list* '(1 2))    ;' ==> "1 and 2"
(format nil *english-list* '(1 2 3))  ;' ==> "1, 2, and 3"
(format nil *english-list* '(1 2 3 4));' ==> "1, 2, 3, and 4" 
```

# html - 打印滚动的 div

> ID：236630
> 
> 赞同：1
> 
> 时间：2008-10-25T16:16:23.833
> 
> 标签：html, css, printing-web-page

我有一个网页，它在一个带有溢出-x 的 div 内显示一个长线图：滚动。这作为一个网页效果很好，允许用户在图表中前后滚动。

但是，在打印页面时，滚动位置会重置为零。有没有办法克服这个问题？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-25T16:22:06.397

我认为您将不得不指定一个备用 CSS 来打印您需要以某种方式删除溢出的地方：

```
<link rel="stylesheet" type="text/css” href="sheet.css" media="print" /> 
```

但是，也许有一种使用 JavaScript 甚至 Flash 的方法？如果我理解正确，您只想打印图表的一部分（用户“选择”的那个？）而不是完整的？我很确定使用纯 HTML/CSS 是不可能的，但我坚信 Flash 或 JavaScript/AJAX（一次只加载图像的一部分）可以解决它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-25T19:14:02.227

你不能在纯 CSS 中做到这一点——你必须使用你选择的 Javascript UI 库重新实现滚动以获得你想要的。

打印时不使用滚动条的用户状态（想想看，如果您在页面上向下滚动 3 个屏幕并点击“打印”，浏览器是否只打印文档中的部分内容是否有意义？当时的窗口？）。但是，如果您使用 JS，它实际上操纵 DOM（即，如果该人向右滚动了 293 像素，则将 x 位置偏移设置为 -293，就像`style="left: -293px; overflow: hidden;"`在 CSS 中一样），那么它将在打印文档中显示为这样。

我的建议是，除非图表*非常*宽，否则只需跳过所有这些废话并使用打印机样式表与`width: 100%`图表一起使用，`<div>`以便图表缩小到页面宽度。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-25T16:59:03.310

一个简单的方法是让一些 javascript 回发到您的页面，并在链接上显示用户选择的滚动位置，上面写着“设置打印”。然后服务器端返回一个页面，其中图形相对位于滚动位置，`overflow:hidden`以适当地剪切图形。

当然，这对于禁用 javascript 的用户不起作用 - 如果您想支持这一点，您需要用户在文本输入元素和提交按钮之类的东西中指定滚动位置，启用时您使用 javascript 隐藏这些按钮。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2016-09-13T14:57:29.137

您需要暂时将父级的滚动位置变为子级的负边距，并将该父级设置为溢出：隐藏。

下面是如何在 Javascript 中做到这一点（这是唯一的方法，css 不能做到这一点）

请注意，您需要在打印后执行 printDone() 以恢复一切正常。您可以使用滚轮事件触发它，例如因为用户在尝试滚动时只会遇到问题。或者您可以像我一样放置一个按钮，并仅在调用 printGo() 时显示它。

```
<html>
<head>
<style>
#wrapper {
    width:800px;
    overflow-x:scroll;
}
#content {
    width:2000px;
    border:2px solid red;
}
@media print { /* This overwrites the css when printing */
    #wrapper {
        overflow-x:hidden;
    }
}
</style>
</head>
<body>
<a href="#" onclick="printGo()">Print</a><br>
<a href="#" onclick="printDone()">I'm done printing!</a>
<div id=wrapper>
    <div id=content>
        Hello this is my content.
    </div>
</div>
<script>
var wrapper = document.getElementById('wrapper');
var content = document.getElementById('content');
var scrollPos;
function printGo(){
    scrollPos = wrapper.scrollLeft; // Save scroll position
    wrapper.scrollLeft = 0;
    wrapper.style.overflowX = 'hidden'; // Optional since css does it
    content.style.marginLeft = -scrollPos+'px'; // Put it as a negative margin of child instead
    window.print();
}
function printDone(){
    wrapper.scrollLeft = scrollPos; // Restore scroll position
    wrapper.style.overflowX = 'scroll'; // Optional since css does it
    content.style.marginLeft = '';
}
</script>
</body></html> 
```

# linq-to-sql - 最简洁的 LINQ To SQL 用于获取多对多任一侧的 COUNT(*)？

> ID：236632
> 
> 赞同：4
> 
> 时间：2008-10-25T16:17:43.410
> 
> 标签：linq-to-sql, many-to-many, aggregate

请帮助我进行健全性检查。假设多对多关系：

[发布，PostTagAssoc，标签 http://www.codingthewheel.com/pics/many_to_many.gif](http://www.codingthewheel.com/pics/many_to_many.gif)

什么是最简洁的方式（使用 LINQ to SQL）来获得一个结果集，显示**每个**标签（或帖子）分配给它的帖子（或标签）的总数？

谢谢！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-25T16:54:50.777

```
 from pta in db.PostTagAssoc
 group pta by pta.PostID into t
 select new {PostID = t.Key, TagCount=t.Count()} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-09T09:54:13.433

这也将显示那些带有 0 标签的帖子，并且在我看来更清晰一些。

```
from p in db.Post
select new {PostID = p.ID, TagCount = t.PostTagAssoc.Count} 
```

# c# - 部署后修改连接字符串

> ID：236644
> 
> 赞同：3
> 
> 时间：2008-10-25T16:24:07.390
> 
> 标签：c#, .net, database, deployment, sql-server-express

我为应用程序创建了安装项目，我可以看到配置文件（Application.exe.config）的后期修改不会影响应用程序的执行。

我正在开发一个包含数据库文件的应用程序，我希望用户能够移动数据库文件并修改连接字符串。

有谁知道使用数据库文件部署应用程序的最佳实践是什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-25T18:37:31.270

它应该可以工作，前提是您在 DB 访问 DLL 的 Settings.settings 文件和应用程序的配置文件中使用完全相同的连接字符串设置。

一个适合我的例子：

```
 <connectionStrings>
  <add name="YourApp.Properties.Settings.DatabaseConnectionString"
  connectionString="Data Source=localhost;Initial Catalog=xxx;Integrated Security=True;"
  providerName="System.Data.SqlClient" />
 </connectionStrings> 
```

当在两个位置（即 dll 的 Settings.settings 和 exe 的 App.config 文件）正确输入时，这确实允许我在应用程序运行之前更改 YourApp.exe.config 中的数据库连接。

（我假设您已经知道您需要更改应用程序的配置文件，因为 DLL 不直接支持 app.config 机制。）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-27T17:33:01.823

您是否使用[UDL 文件](http://support.microsoft.com/kb/308426)签出？如果您将连接字符串保存在 udl 文件中，用户只需双击该文件即可通过界面更改连接。您可以在应用程序中设置连接字符串以指向 udl 文件。如果需要，您还可以通过编程方式启动 udl 接口。唯一的缺点是如果用户将他们的密码保存到文件中，它会保存为纯文本。但是，如果您使用 Windows 身份验证，这不是问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-25T16:32:36.577

您是否确保删除设置默认值？这些是从 dll 而不是从配置文件中编译和获取的。

# c - timerfd_create 在 amd64 上使用 debian linux 测试

> ID：236652
> 
> 赞同：2
> 
> 时间：2008-10-25T16:30:31.323
> 
> 标签：c, linux, timer, debian

我正在尝试在 Debian Linux lenny 下使用 timerfd_create 和 timerfd_settime。手册页说包括`<sys/timerfd.h>`. 此文件无法在我的系统上找到。根据 Debian 包搜索，唯一带有 timerfd.h 的包是 linux-headers-* 包。

我已经安装了包 linux-headers-2.6.26-1-amd64 和 linux-headers-2.6.26-1-common。我尝试包括 /lib/modules/2.6.26-1-amd64/build/include/linux/timerfd.h 文件（不包括`<sys/timerfd.h>`）。但后来我得到以下链接器错误：
slave.c:(.text+0x166): undefined reference to `timerfd_ceate`
slave.c:(.text+0x1e5): undefined reference to`timerfd_settime`

我的构建命令是 gcc -o slave slave.c -L../libs -lcan -lutils -lrt

can 和 utils 库是我自己的。他们都不使用或定义 timerfd_* 函数之一。我尝试了 -lrt 因为 timer_create 和 timer_settimer 需要它，即使它不在手册页中。带有 timer_create 和 timer_settimer 的测试程序可以正常工作并且符合预期。

我需要安装哪些数据包，需要链接到哪些库，以及使用 timerfd_create 和 timerfd_settimer 需要哪些包含文件。

谢谢埃格

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-25T16:37:54.790

对这些功能的支持是 linux 和 glibc 中的新功能，您需要 linux 内核 2.6.25 或更高版本**以及**glibc 2.8 或更高版本。

# asp.net - 好的复杂的 linq to sql 示例？

> ID：236665
> 
> 赞同：6
> 
> 时间：2008-10-25T16:39:10.853
> 
> 标签：asp.net, linq-to-sql

我正在寻找一种更复杂的方式来使用 Linq to SQL。我倾向于 L2Q，但我只看到简单的业务对象示例和其中的简单 CRUD 操作。

任何包含这些的示例应用程序：

1- 从多张表和多到多表中获取数据的业务对象。

2- 跟踪数据更改，并自动能够通过简单的操作对多个表进行更改。一个智能的 SubmitChanges？（不知道这是否可能 - 现在我编写自己的存储过程来完成所有工作，而且我正在以某种方式设计我的数据库，因此我使用 Linq to SQL 更容易！）

3- 善用表之间的关系。它应该不仅仅是将表格拖入设计器。

4- 交易

5-断开数据。在 ASP.NET 中使用。

6- N 层架构

7- 基本上，更复杂地使用 LINQ to SQL 并学习良好的设计模式

8- 跳过 Linq 到 SQL 并转移到 Linq 到实体？

我觉得我没有很好地利用 Linq，它只是给了我很好的智能感知和更简单的查询，我觉得它可以提供更多，但不确定是什么以及如何提供。我正在寻找现实生活中复杂的示例，这些示例可以作为从书籍和教程提供的内容中学习的一个很好的来源。

CodePlex 上有什么东西吗？谷歌代码...等？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-25T16:40:49.493

Scott Gutherie 在他的博客上做了一个 9 部分的系列，你可能会感兴趣

[http://weblogs.asp.net/scottgu/archive/2007/05/19/using-linq-to-sql-part-1.aspx](http://weblogs.asp.net/scottgu/archive/2007/05/19/using-linq-to-sql-part-1.aspx)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-25T16:55:38.933

这是另外两个内容广泛的来源：

[这个](http://www.hookedonlinq.com/LINQtoSQL.ashx)网站是一个包含大量信息的 wiki。

[这](http://msdn.microsoft.com/en-us/vcsharp/aa336746.aspx)是一个组织良好的 MSDN 参考，包含数百个代码示例。

# sql - MySQL中的外键？

> ID：236668
> 
> 赞同：26
> 
> 时间：2008-10-25T16:43:19.380
> 
> 标签：sql, mysql, foreign-keys

最近几周我一直在慢慢学习 SQL。我已经学习了所有的关系代数和关系数据库如何工作的基础知识。我现在要做的是了解它是如何实现的。

我遇到的一个绊脚石是 MySQL 中的外键。[除了它们存在于 MySQL 的InnoDB](http://en.wikipedia.org/wiki/InnoDB)存储模式中之外，我似乎找不到太多关于它们的信息。

什么是在 MySQL 中实现的外键的简单示例？

这是我编写的架构的一部分，如果您宁愿指出我的缺陷而不是向我展示一个有效的示例，它似乎不起作用。

```
CREATE TABLE `posts` (
`pID` bigint(20) NOT NULL auto_increment,
`content` text NOT NULL,
`time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
`uID` bigint(20) NOT NULL,
`wikiptr` bigint(20) default NULL,
`cID` bigint(20) NOT NULL,
PRIMARY KEY  (`pID`),
Foreign Key(`cID`) references categories,
Foreign Key(`uID`) references users
) ENGINE=InnoDB; 
```

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2008-10-25T16:57:43.937

假设您的类别和用户表已经存在并且分别包含 cID 和 uID 作为主键，这应该可以工作：

```
CREATE TABLE `posts` (
`pID` bigint(20) NOT NULL auto_increment,
`content` text NOT NULL,
`time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
`uID` bigint(20) NOT NULL,
`wikiptr` bigint(20) default NULL,
`cID` bigint(20) NOT NULL,
PRIMARY KEY  (`pID`),
Foreign Key(`cID`) references categories(`cID`),
Foreign Key(`uID`) references users(`uID`)
) ENGINE=InnoDB; 
```

`references`子句中需要列名。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-10-25T17:50:44.797

**编辑：** Robert 和 Vinko 声明您需要在外键约束中声明引用列的名称。这在 InnoDB 中是必需的，尽管在标准 SQL 中，如果引用的列名与父表中的名称相同，则可以省略它。

我在 MySQL 中遇到的一个特点是外键声明会在以下几种情况下静默失败：

*   您的 MySQL 安装不包括 innodb 引擎
*   您的 MySQL 配置文件未启用 innodb 引擎
*   您不使用 ENGINE=InnoDB 表修饰符声明您的表
*   外键列与引用表中的主键列的数据类型不完全相同

不幸的是，MySQL 没有给出未能创建外键约束的消息。它只是忽略该请求，并创建没有外键的表（如果您 SHOW CREATE TABLE 帖子，您可能会看到没有外键声明）。我一直认为这是 MySQL 的一个坏特性！

**提示：**整数数据类型（例如 BIGINT(20)）的整数参数不是必需的。它与列的存储大小或范围无关。无论您给出什么参数，BIGINT 的大小始终相同。该数字是指如果您使用 ZEROFILL 列修饰符，MySQL 将填充该列的位数。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-25T16:50:22.940

[这](http://dev.mysql.com/doc/refman/5.0/en/innodb-foreign-key-constraints.html)有一些代码显示了如何自己创建外键，以及在 CREATE TABLE 中。

这是其中一个更简单的示例：

```
CREATE TABLE parent (
    id INT NOT NULL,
    PRIMARY KEY (id)
) ENGINE=INNODB;

CREATE TABLE child (
    id INT, 
    parent_id INT,
    INDEX par_ind (parent_id),
    FOREIGN KEY (parent_id) REFERENCES parent(id)
    ON DELETE CASCADE
) ENGINE=INNODB; 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-25T17:01:36.597

我同意罗伯特。您在引用子句中缺少列的名称（并且您应该收到错误 150）。我将补充一点，您可以通过以下方式检查表是如何创建的：

```
SHOW CREATE TABLE posts; 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-25T19:48:49.303

前面的答案处理外键约束。虽然外键约束对于维护引用完整性绝对有用，但“外键”概念本身是数据关系模型的基础，无论您是否使用约束。

每当您执行[equijoin](http://en.wikipedia.org/wiki/Join_%28SQL%29#Equi-join)时，您就是在将外键等同于某物，通常是它引用的键。例子：

```
select *
from 
   Students
inner join
   StudentCourses
on Students.StudentId = StudentCourses.StudentId 
```

StudentCourses.StudentId 是引用Student.StudentId 的外键。

# c++ - 在 c++ Visual Studio 应用程序中获取当前 svn 版本的简单方法是什么

> ID：236669
> 
> 赞同：5
> 
> 时间：2008-10-25T16:43:40.080
> 
> 标签：c++, svn

是否有任何简单的方法可以访问 SVN 存储库修订号并将其存储在 c++ Visual Studio 应用程序中的 c++ 字符串中？

提前感谢您的帮助！

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-25T16:48:36.843

如果你有乌龟 SVN，你可以使用 SubWCRev.exe

创建一个名为：

修订信息.tmpl

```
int SvnRevision = $WCREV$; 
```

然后执行这个命令：

```
SubWCRev.exe . RevisionInfo.tmpl RevisionInfo.cpp 
```

它将使用您的修订号创建一个文件 ReivisonInfo.cpp，如下所示：

```
int SvnRevision = 5000; 
```

从您的其他文件中，只需执行以下操作：

外部 int SvnRevision; 从该文件中访问全局变量。

你也可以使用[SvnRev](http://www.compuphase.com/svnrev.htm)

# .net - 在文本框的 keyup 事件中按下回车键后消除回车键

> ID：236675
> 
> 赞同：4
> 
> 时间：2008-10-25T16:49:27.370
> 
> 标签：.net, textbox

按下返回键后如何取消文本框中的按键事件。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-25T16:58:05.543

将 KeyPressEventArgs 处理程序参数的 Handled 属性设置为 true。

来自 msdn 的示例：

```
private void keypressed(Object o, KeyPressEventArgs e)
{
    if (e.KeyChar == (char)Keys.Return)
    {
        e.Handled = true;
    }
} 
```

有关详细信息，请参阅[http://msdn.microsoft.com/en-us/library/system.windows.forms.keypresseventargs.handled.aspx](http://msdn.microsoft.com/en-us/library/system.windows.forms.keypresseventargs.handled.aspx)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-25T17:02:00.310

你的意思是，你想让它忽略回车键吗？

您可以添加一个 keydown 事件并忽略那里的输入键...

```
private void textBox1_KeyDown(object sender, KeyEventArgs e)
    {
        if (e.KeyCode == Keys.Enter)
        {
            e.SuppressKeyPress = true;
        }
    } 
```

# linq - 这可以重构为漂亮的 LINQ 吗？

> ID：236676
> 
> 赞同：1
> 
> 时间：2008-10-25T16:49:37.730
> 
> 标签：linq, refactoring

我有一个 Breadcrumb 类型的 IList，它只是一个具有 NavigationTitle、NavigationUrl 和 IsCurrent 属性的轻量级类。它缓存在网络服务器上。我有一个方法可以构建当前的面包屑跟踪，直到第一个将 IsCurrent 设置为 true 的面包屑......使用下面的代码。它非常丑陋，绝对是一个快速的垃圾袋威利解决方案，但我很好奇，这可以很容易地重构为 LINQ 吗？

```
IList<Breadcrumb> crumbs = new List<Breadcrumb>();
bool foundCurrent = false;
for (int a = 0; a < cachedCrumbs.Count; a++)
{
    crumbs.Add(crumbs[a]);
    if (foundCurrent)
    {
      break;
    }
    foundCurrent = (crumbs[a + 1] != null && ((Breadcrumb)crumbs[a + 1]).IsCurrent);
} 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-25T17:08:18.813

我正在按我的想法输入这个，以便它显示一个思路以及一个答案。

*   您的来源只是 cachedCrumbs
*   您想添加第一个确实设置了 IsCurrent 的碎屑*，*但之后什么都没有
*   TakeWhile 听起来像是要走的路，但获得“以前的值有 IsCurrent”有点痛苦
*   我们可以使用闭包来有效地保持变量确定最后一个值是否设置了 IsCurrent
*   我们可以做一个有点“无操作”的选择，以将 TakeWhile 与是否继续进行的工作区分开来

所以，我们最终得到：

```
bool foundCurrent = false;

var crumbs = cachedCrumbs.TakeWhile(crumb => !foundCurrent)
                         .Select(crumb => { 
                                 foundCurrent = crumb == null || !crumb.IsCurrent; 
                                 return crumb; }); 
```

我还没有尝试过，但我*认为*它应该可以工作......不过可能有更简单的方法。

编辑：我认为在这种情况下，实际上直接的 foreach 循环更简单*。*话虽如此，您可以编写另一个类似于 TakeWhile 的扩展方法，除了它还*返回*导致条件失败的元素。然后它会很简单：

```
var crumbs = cachedCrumbs.NewMethod(crumb => crumb == null || !crumb.IsCurrent); 
```

（我现在想不出一个像样的名字，因此`NewMethod`！）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-25T17:06:56.523

首先，该代码不起作用。我猜你使用“crumbs”的一些地方是指“cachedCrumbs”。如果是这样，代码可以简化为：

```
IList<Breadcrumb> crumbs = new List<Breadcrumb>();
for (int a = 0; a < cachedCrumbs.Count; a++)
{
    crumbs.Add(cachedCrumbs[a]);
    if (cachedCrumbs[a] != null && cachedCrumbs[a].IsCurrent)
    {
          break;
    }
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-25T17:10:23.617

基于 James Curran 的替代答案 - 这当然可以使用 foreach 语句来改进：

```
IList<Breadcrumb> crumbs = new List<BreadCrumb>();
foreach (Breadcrumb crumb in cachedCrumbs)
{
    crumbs.Add(crumb);
    if (crumb != null && crumb.IsCurrent)
    {
        break;
    }
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-25T17:45:29.317

怎么样...

```
// find the current item
var currentItem = cachedCrumbs.First(c => c.IsCurrent);
var currentIdx = cachedCrumbs.IndexOf(currentItem);

// get all items upto current item
var crumbs = cachedCrumbs.Take(currentIdx + 2); 
```

您可以将其转换为 TakeUpto 方法，该方法将所有项目带到与您提供的谓词匹配的项目。

怎么样：

```
public static IEnumerable<T> TakeUpto<T>(this IList<T> theList, Func<T, bool> predicate)
{
    var targetItem = theList.First(predicate);
    var targetIdx = theList.IndexOf(targetItem);

    return theList.Take(targetIdx + 2);
} 
```

然后你可以这样使用它：

```
var crumbs = cachedCrumbs.TakeUpto(c => c.IsCurrent); 
```

干净多了！

没有检查空值和非一案例以及 IList/IEnumerable 差异，但您应该明白这一点。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-25T19:19:45.383

这个答案是 chakrit 的 TakeUpTo 的另一种实现：

```
public static IEnumerable<T> TakeUpto<T>(this IEnumerable<T> theList, Func<T, bool> predicate)
{
    foreach (T element in theList)
    {
        yield return element;
        if (predicate(element))
        {
            break;
        }
    }
} 
```

这只会遍历列表一次，这在各种情况下都可能相关。（假设上游序列是 OrderBy 子句的结果——你真的不希望它无缘无故地对结果进行多次排序。）

它还允许任何`IEnumerable<T>`作为源，这使得它更加灵活。

LINQ 的美妙之处之一是实现同一目标的多种方式。

# python - 如何使用 Python 图像库将任何图像转换为 4 色调色板图像？

> ID：236692
> 
> 赞同：12
> 
> 时间：2008-10-25T17:00:09.410
> 
> 标签：python, image-processing, python-imaging-library

我有一台支持 4 色图形的设备（很像过去的 CGA）。

我想使用[PIL](http://www.pythonware.com/products/pil/)读取图像并使用我的 4 色调色板（红色、绿色、黄色、黑色）对其进行转换，但我根本不知道它是否可能。我发现一些邮件列表存档帖子似乎暗示其他人尝试这样做但失败了。

一个简单的python示例将不胜感激！

如果您添加一些东西然后将图像转换为字节字符串，其中每个字节代表 4 个像素的数据（每两个位代表从 0 到 3 的颜色），则奖励积分

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-10-25T23:26:14.607

首先：您的四种调色板（黑色、绿色、红色、黄色）*没有*蓝色成分。因此，您必须接受您的输出图像几乎不会接近输入图像，除非开始时没有蓝色分量。

试试这个代码：

```
import Image

def estimate_color(c, bit, c_error):
    c_new= c -  c_error
    if c_new > 127:
        c_bit= bit
        c_error= 255 - c_new
    else:
        c_bit= 0
        c_error= -c_new
    return c_bit, c_error

def image2cga(im):
    "Produce a sequence of CGA pixels from image im"
    im_width= im.size[0]
    for index, (r, g, b) in enumerate(im.getdata()):
        if index % im_width == 0: # start of a line
            r_error= g_error= 0
        r_bit, r_error= estimate_color(r, 1, r_error)
        g_bit, g_error= estimate_color(g, 2, g_error)
        yield r_bit|g_bit

def cvt2cga(imgfn):
    "Convert an RGB image to (K, R, G, Y) CGA image"
    inp_im= Image.open(imgfn) # assume it's RGB
    out_im= Image.new("P", inp_im.size, None)
    out_im.putpalette( (
        0, 0, 0,
        255, 0, 0,
        0, 255, 0,
        255, 255, 0,
    ) )
    out_im.putdata(list(image2cga(inp_im)))
    return out_im

if __name__ == "__main__":
    import sys, os

    for imgfn in sys.argv[1:]:
        im= cvt2cga(imgfn)
        dirname, filename= os.path.split(imgfn)
        name, ext= os.path.splitext(filename)
        newpathname= os.path.join(dirname, "cga-%s.png" % name)
        im.save(newpathname) 
```

这将创建一个 PNG 调色板图像，其中只有前四个调色板条目设置为您的颜色。此示例图像：

[![](https://i.stack.imgur.com/BBxf1.jpg)](https://i.stack.imgur.com/BBxf1.jpg)

变成

[![](https://i.stack.imgur.com/QxtCD.png)](https://i.stack.imgur.com/QxtCD.png)

`image2cga`获取（产生一系列 0-3 个值的序列）的输出并将每四个值打包到一个字节是很简单的。

如果您需要有关代码功能的帮助，请询问，我会解释。

### EDIT1：不要重新发明轮子

当然，事实证明我太热情了——正如 Thomas 发现的那样——Image.quantize 方法可以将调色板图像作为参数，并以比我上面的 ad-hoc 方法更好的结果进行量化：

```
def cga_quantize(image):
    pal_image= Image.new("P", (1,1))
    pal_image.putpalette( (0,0,0, 0,255,0, 255,0,0, 255,255,0) + (0,0,0)*252)
    return image.convert("RGB").quantize(palette=pal_image) 
```

### EDIT1，续：将像素打包成字节

对于“附加值”，以下代码生成打包字符串（每字节 4 个像素）：

```
import itertools as it

# setup: create a map with tuples [(0,0,0,0)‥(3,3,3,3)] as keys
# and values [chr(0)‥chr(255)], because PIL does not yet support
# 4 colour palette images

TUPLE2CHAR= {}

# Assume (b7, b6) are pixel0, (b5, b4) are pixel1…
# Call it "big endian"

KEY_BUILDER= [
    (0, 64, 128, 192), # pixel0 value used as index
    (0, 16, 32, 48), # pixel1
    (0, 4, 8, 12), # pixel2
    (0, 1, 2, 3), # pixel3
]
# For "little endian", uncomment the following line
## KEY_BUILDER.reverse()

# python2.6 has itertools.product, but for compatibility purposes
# let's do it verbosely:
for ix0, px0 in enumerate(KEY_BUILDER[0]):
    for ix1, px1 in enumerate(KEY_BUILDER[1]):
        for ix2, px2 in enumerate(KEY_BUILDER[2]):
            for ix3, px3 in enumerate(KEY_BUILDER[3]):
                TUPLE2CHAR[ix0,ix1,ix2,ix3]= chr(px0+px1+px2+px3)

# Another helper function, copied almost verbatim from itertools docs
def grouper(n, iterable, padvalue=None):
    "grouper(3, 'abcdefg', 'x') --> ('a','b','c'), ('d','e','f'), ('g','x','x')"
    return it.izip(*[it.chain(iterable, it.repeat(padvalue, n-1))]*n)

# now the functions
def seq2str(seq):
    """Takes a sequence of [0..3] values and packs them into bytes
    using two bits per value"""
    return ''.join(
        TUPLE2CHAR[four_pixel]
        for four_pixel in grouper(4, seq, 0))

# and the image related function
# Note that the following function is correct,
# but is not useful for Windows 16 colour bitmaps,
# which start at the *bottom* row…
def image2str(img):
    return seq2str(img.getdata()) 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-26T08:41:58.133

约翰，我也找到了第一个链接，但它并没有直接帮助我解决问题。它确实让我更深入地了解量化。

我昨天睡前想出了这个：

```
import sys

import PIL
import Image

PALETTE = [
    0,   0,   0,  # black,  00
    0,   255, 0,  # green,  01
    255, 0,   0,  # red,    10
    255, 255, 0,  # yellow, 11
] + [0, ] * 252 * 3

# a palette image to use for quant
pimage = Image.new("P", (1, 1), 0)
pimage.putpalette(PALETTE)

# open the source image
image = Image.open(sys.argv[1])
image = image.convert("RGB")

# quantize it using our palette image
imagep = image.quantize(palette=pimage)

# save
imagep.save('/tmp/cga.png') 
```

TZ.TZIOY，您的解决方案似乎遵循相同的原则。荣誉，我应该停止工作并等待您的回复。我的有点简单，虽然肯定不比你的更合乎逻辑。PIL 使用起来很麻烦。你的解释了发生了什么。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2017-06-21T10:32:31.670

```
import sys
import PIL
from PIL import Image

def quantizetopalette(silf, palette, dither=False):
    """Convert an RGB or L mode image to use a given P image's palette."""

    silf.load()

    # use palette from reference image
    palette.load()
    if palette.mode != "P":
        raise ValueError("bad mode for palette image")
    if silf.mode != "RGB" and silf.mode != "L":
        raise ValueError(
            "only RGB or L mode images can be quantized to a palette"
            )
    im = silf.im.convert("P", 1 if dither else 0, palette.im)
    # the 0 above means turn OFF dithering
    return silf._makeself(im)

if __name__ == "__main__":
    import sys, os

for imgfn in sys.argv[1:]:
    palettedata = [ 0, 0, 0, 0, 255, 0, 255, 0, 0, 255, 255, 0,] 
    palimage = Image.new('P', (16, 16))
    palimage.putpalette(palettedata + [0, ] * 252 * 3)
    oldimage = Image.open(sys.argv[1])
    newimage = quantizetopalette(oldimage, palimage, dither=False)
    dirname, filename= os.path.split(imgfn)
    name, ext= os.path.splitext(filename)
    newpathname= os.path.join(dirname, "cga-%s.png" % name)
    newimage.save(newpathname) 
```

对于那些不希望通过抖动来获得纯色的人。我修改了：[使用 PIL 将图像转换为特定的调色板，而无需使用](https://stackoverflow.com/questions/29433243/convert-image-to-specific-palette-using-pil-without-dithering) 此线程中的两种解决方案进行抖动。即使这个线程很旧，我们中的一些人也想要这些信息。库迪奥斯

# ruby - 无法将 Ruby 块分类到文件

> ID：236713
> 
> 赞同：1
> 
> 时间：2008-10-25T17:17:43.413
> 
> 标签：ruby, bash, heredoc

请帮忙，我被困在这里---

```
irb> a = "line of text\n  line two\n  line three"
irb> system("cat > test_file << #{a}")
cat: of: No such file or directory
cat: text: No such file or directory
=> false 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-25T17:33:58.000

写入一个名为“testfile”的文件：

```
File.open("testfile", "w") do |io| io.print a done 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-25T17:30:30.017

您需要引用插值参数：

```
system("cat > test_file << \"#{a}\"") 
```

而且， cat 需要一个文件名，而不是一些要附加到 test_file 的文本，所以，这将按照我的想法工作：

```
system("echo \"#{a}\" >> test_file") 
```

如果你想在纯 Ruby 中做到这一点，请告诉我，我会给你一个例子。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-25T17:55:47.410

JesperE 已经涵盖了直接写入文件。要写入进程（在本例中为“cat”进程），请使用 popen。

```
IO.popen("cat > foo", "w") do
    |f|
    f.write("line1\nline2\n")
end 
```

# javascript - 每当输入文本字段更改时，如何在 RoR 中提交表单？

> ID：236715
> 
> 赞同：3
> 
> 时间：2008-10-25T17:18:05.393
> 
> 标签：javascript, ruby-on-rails, forms

我正在使用 Ruby on Rails。

我想在页面上创建一个过滤器字段，以便每当输入字段的值更改时，我都会通过 ajax 过滤下面显示的列表。（就像 Stackoverflow 中的用户搜索一样）

现在，我使用包含 text_field_tag 和 submit_tag 的 form_remote_tag 运行它，并在我按下提交按钮时过滤我的列表。每次文本输入的值发生变化时，我想删除提交按钮并执行过滤。每次输入字段中的文本更改时，如何触发表单提交？

我在我的表格里试过

`<%= text_field_tag (:filter), "" , :onchange => "alert ('This is a Javascript Alert')" %>`

只是为了获得 onchange 事件，但不知何故甚至没有出现这个警报......

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-25T17:24:01.903

使用带有单个输入的**observe_field助手，如下面的代码：**

```
<%= text_field_tag 'filter' %>
<%= observe_field 'filter', 
    :url => {:controller => 'your_controller', :action => 'filter'},
    :frequency => 1.2,
    :update => 'results',
    :with => "'typed_filter=' + $('filter').value" %> 
```

然后只需编写一个控制器，给定一个名为“typed_filter”的参数，呈现结果，它将显示在 id 为“results”的元素中（可能是一个 div）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-25T18:39:49.863

一般来说，对于文本输入，您希望使用 onkeypress、onkeyup、onkeydown 事件，而不是 onchange 用于这种类型的自动完成。@Ricardo Acras 解决方案比编写自己的解决方案要好得多，但我想您可能想知道 onchange 不起作用，因为在您导航出文本输入（并且文本已更改）之前它不会触发。

我发现 w3schools.com 是获取此类信息的绝佳资源。[这](http://w3schools.com/js/js_obj_htmldom.asp)是关于 Javascript HTML DOM 的页面。这是事件参考[。](http://w3schools.com/htmldom/dom_obj_event.asp)

# sql-server-ce - 您可以创建从 SQL Server（任何版本）到 SQL Server CE (3.5) 数据库的链接服务器吗？

> ID：236719
> 
> 赞同：1
> 
> 时间：2008-10-25T17:22:24.917
> 
> 标签：sql-server-ce, linked-server

我们从 Redgate 购买了一个名为 SQL Data Compare 的工具。我主要将它用于测试目的，以证明我的应用程序正在对我认为的数据库进行修改，而不是进行任何其他更改。

我当前的应用程序同时具有“在线”和“离线”编辑功能。在联机模式下，您直接使用 SQL Server，而在脱机模式下，您正在使用 SQL CE (3.5) 文件中的表子集。

无论如何，SQL 数据比较工具不支持 SQLCE，所以我希望我可以创建一个链接到 SQLCE 数据库的服务器，并创建一个通过视图镜像 CE 数据库的 SQL Server 数据库，这样我就可以进行测试了。

所以，我不知道如何创建到 SQLCE 数据库的链接服务器。有谁知道这是怎么做到的吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-26T00:10:55.390

我不认为这是可能的。我想如果此时我处于你的位置，我会编写一个小程序（我认为 SSIS 可以做到），它可以将 SQL CE 数据库的内容传输到 SQL Server 数据库，然后运行 ​​SQL 数据比较。:(

# algorithm - Google 的 In Quotes 是如何工作的？

> ID：236722
> 
> 赞同：4
> 
> 时间：2008-10-25T17:25:38.420
> 
> 标签：algorithm, nlp

我发现 Google 的[In Quotes](http://labs.google.com/inquotes/)是一个非常漂亮的应用程序，作为一名 CS 人员，我必须了解它是如何工作的。你认为它如何将新闻文章转化为特定人的引用列表？当然，有一些错误，但他们的算法似乎比简单的启发式或多个正则表达式更聪明。例如，即使在最后一段中只提到了他/她的名字，也可以将引用归因于某人。

有任何想法吗？关于这个主题的任何已知论文？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-25T13:21:18.500

很简单，它会检查单词，但它们之间可以有任何东西，只要它们仍然是有序的。“你好世界！” 将成为正则表达式 /hello [ .]* world/

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-25T18:17:19.737

我没有任何文件，但有一些想法。谷歌引用一组人的名言。使用 Google 新闻和其他媒体访问对他们来说很容易。

他们有另一组主题。谷歌将主题集与人员集进行匹配（两者都是有限的）。最后一组都是报价单，

如果您注意到，主题包含 1 个在引文中突出显示的单词。所以它在主题集和每组人的引用集之间存在关系。由于谷歌是信息的主人，因此很容易在所有这些集合之间建立联系。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-25T22:45:02.410

对于您的问题，我没有答案，但我的建议是您直接通过[Google 版主](http://moderator.appspot.com)询问 Google 工程师。您可能不会很快（或根本没有）得到答案，但您会在那里得到准确的答案。

# netbeans - Netbeans - 关闭 - 波浪红色下划线 - 如何？

> ID：236733
> 
> 赞同：7
> 
> 时间：2008-10-25T17:39:24.370
> 
> 标签：netbeans, settings

如何关闭 Netbeans 中的波浪形红色下划线？我不想在打字时被打断，并被告知半行代码是错误的。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-02-24T00:04:32.913

这实际上已经在 Arnold 对[NetBeans 的回答中得到解决和说明。禁用错误检查下划线](https://stackoverflow.com/a/3693583/45773)（+1）；选择*工具 -> 选项 -> 字体和颜色 -> 语法 -> 类别错误*，然后根据自己的喜好调整字体效果（或任何其他样式）：

![在此处输入图像描述](https://i.stack.imgur.com/Er6er.png)

我已经确认它仍然可以这样工作 - 请注意，在您触发编辑器更新之前，新设置不会有任何效果，例如通过输入字母。

不幸的是，这似乎并不能以任何立即可见的方式帮助提高性能（尽管删除这样的字体效果确实用于在过去加快速度）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-25T18:14:12.597

如果要关闭它们，请遵循此路径，（我使用的是 NeatBeans 5.5.1）

工具->选项->高级选项->打开“编辑”节点，点击“Java源”->“错误注释限制”输入0

这将完全关闭红色下划线。如果您想要更长的暂停时间，您还可以在同一位置更改“自动解析延迟”。

# language-agnostic - 进行系统调用，将 stdout 输出作为字符串返回

> ID：236737
> 
> 赞同：16
> 
> 时间：2008-10-25T17:44:53.717
> 
> 标签：language-agnostic, terminology

Perl 和 PHP 使用反引号来做到这一点。例如，

```
$output = `ls`; 
```

返回目录列表。一个类似的函数，`system("foo")`返回给定命令 foo 的操作系统返回码。我说的是一种将 foo 打印到标准输出的变体。

其他语言如何做到这一点？这个函数有一个规范的名字吗？（我要使用“反引号”；尽管也许我可以使用“syslurp”。）

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-10-25T19:35:50.810

## Python

```
from subprocess import check_output as qx

output = qx(['ls', '-lt']) 
```

### Python < [2.7](http://docs.python.org/dev/library/subprocess.html#subprocess.check_output)或 < [3.1](http://docs.python.org/py3k/library/subprocess.html#subprocess.check_output)

`subprocess.check_output()`从[subprocess.py](http://svn.python.org/view/python/trunk/Lib/subprocess.py?view=markup)中提取或改编类似于：

```
import subprocess

def cmd_output(args, **kwds):
  kwds.setdefault("stdout", subprocess.PIPE)
  kwds.setdefault("stderr", subprocess.STDOUT)
  p = subprocess.Popen(args, **kwds)
  return p.communicate()[0]

print cmd_output("ls -lt".split()) 
```

subprocess模块自 2.4 以来一直在 stdlib 中[。](http://docs.python.org/library/subprocess.html)

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-10-25T17:53:24.917

Python：

```
import os
output = os.popen("foo").read() 
```

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-10-25T19:19:25.057

[应[Alexman](https://stackoverflow.com/users/11289/axeman)和[dreeves](https://stackoverflow.com/users/4234/dreeves)的要求——请参阅评论——，您将在此**[DZones Java Snippet 页面上](http://snippets.dzone.com/posts/show/6335)**找到一个独立于操作系统的完整版本，用于在这种情况下制作“ls”。***[这是对他们的代码挑战](https://stackoverflow.com/questions/172184/are-you-elite-coder-enough-to-take-a-code-challenge-closed)***的直接回答。
下面的只是核心：Runtime.exec，加上 2 个线程来监听 stdout 和 stderr。]

**[Java](http://www.javaworld.com/javaworld/jw-12-2000/jw-1229-traps.html?page=4)** “简单！”：

```
E:\classes\com\javaworld\jpitfalls\article2>java GoodWindowsExec "dir *.java"
Executing cmd.exe /C dir *.java
... 
```

或者在java代码中

```
String output = GoodWindowsExec.execute("dir"); 
```

但要做到这一点，你需要编码
......这很尴尬。

```
import java.util.*;
import java.io.*;
class StreamGobbler extends Thread
{
    InputStream is;
    String type;
    StringBuffer output = new StringBuffer();

    StreamGobbler(InputStream is, String type)
    {
        this.is = is;
        this.type = type;
    }

    public void run()
    {
        try
        {
            InputStreamReader isr = new InputStreamReader(is);
            BufferedReader br = new BufferedReader(isr);
            String line=null;
            while ( (line = br.readLine()) != null)
                System.out.println(type + ">" + line);
                output.append(line+"\r\n")
            } catch (IOException ioe)
              {
                ioe.printStackTrace();  
              }
    }
    public String getOutput()
    {
        return this.output.toString();
    }
}
public class GoodWindowsExec
{
    public static void main(String args[])
    {
        if (args.length < 1)
        {
            System.out.println("USAGE: java GoodWindowsExec <cmd>");
            System.exit(1);
        }
    }
    public static String execute(String aCommand)
    {
        String output = "";
        try
        {            
            String osName = System.getProperty("os.name" );
            String[] cmd = new String[3];
            if( osName.equals( "Windows 95" ) )
            {
                cmd[0] = "command.com" ;
                cmd[1] = "/C" ;
                cmd[2] = aCommand;
            }
            else if( osName.startsWith( "Windows" ) )
            {
                cmd[0] = "cmd.exe" ;
                cmd[1] = "/C" ;
                cmd[2] = aCommand;
            }

            Runtime rt = Runtime.getRuntime();
            System.out.println("Executing " + cmd[0] + " " + cmd[1] 
                               + " " + cmd[2]);
            Process proc = rt.exec(cmd);
            // any error message?
            StreamGobbler errorGobbler = new 
                StreamGobbler(proc.getErrorStream(), "ERROR");            

            // any output?
            StreamGobbler outputGobbler = new 
                StreamGobbler(proc.getInputStream(), "OUTPUT");

            // kick them off
            errorGobbler.start();
            outputGobbler.start();

            // any error???
            int exitVal = proc.waitFor();
            System.out.println("ExitValue: " + exitVal);   

            output = outputGobbler.getOutput();
            System.out.println("Final output: " + output);   

        } catch (Throwable t)
          {
            t.printStackTrace();
          }
        return output;
    }
} 
```

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2008-10-25T18:12:30.153

Perl 中的另一种方法 (TIMTOWTDI)

```
$output = <<`END`;
ls
END 
```

当在 Perl 程序中嵌入相对较大的 shell 脚本时，这特别有用

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2008-10-25T18:02:29.237

Ruby：反引号或 '%x' 内置语法。

```
puts `ls`;
puts %x{ls}; 
```

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2008-10-25T18:08:02.860

perl 中的另一种方法

```
$output = qx/ls/; 
```

这样做的好处是您可以选择分隔符，从而可以在命令中使用 `（尽管恕我直言，如果您真的需要这样做，您应该重新考虑您的设计）。另一个重要的好处是，如果你使用单引号作为分隔符，变量将不会被插值（非常有用）

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2008-10-27T21:43:51.940

哈斯克尔：

```
import Control.Exception
import System.IO
import System.Process
main = bracket (runInteractiveCommand "ls") close $ \(_, hOut, _, _) -> do
    output <- hGetContents hOut
    putStr output
  where close (hIn, hOut, hErr, pid) =
          mapM_ hClose [hIn, hOut, hErr] >> waitForProcess pid 
```

安装MissingH[后](http://software.complete.org/software/projects/show/missingh)：

```
import System.Cmd.Utils
main = do
    (pid, output) <- pipeFrom "ls" []
    putStr output
    forceSuccess pid 
```

在 Perl 和 Ruby 等“粘合”语言中，这是一个简单的操作，但 Haskell 不是。

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2008-10-25T18:00:43.327

壳内

```
OUTPUT=`ls` 
```

或者

```
OUTPUT=$(ls) 
```

第二种方法更好，因为它允许嵌套，但与第一种方法不同，并非所有 shell 都支持。

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2008-10-25T18:10:11.170

二郎：

```
os:cmd("ls") 
```

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2008-12-12T23:12:26.497

好吧，由于这是依赖于系统的，因此有许多语言没有用于所需的各种系统调用的内置包装器。

例如，Common Lisp 本身并不是为在任何特定系统上运行而设计的。不过，SBCL（Steel Banks Common Lisp 实现）确实为类 Unix 系统提供了扩展，就像大多数其他 CL 实现一样。当然，这比仅仅获取输出要“强大”得多（您可以控制运行过程，可以指定各种流方向等，请参阅 SBCL 手册，第 6.3 章），但是很容易为此特定目的编写一个小宏：

```
(defmacro with-input-from-command ((stream-name command args) &body body)
  "将command的输出流绑定到stream-name，然后执行body
   在一个隐含的预测中。”
  `（与开放流
       (,流名称
         (sb-ext:process-output (sb-ext:run-program ,command
                                                    , 参数
                                                    :搜索
                                                    ：输出：流）））
     ，@身体））
```

现在，您可以像这样使用它：

```
(with-input-from-command (ls "ls" '("-l"))
  ;;用 ls 流做一些花哨的事情
  )
```

也许你想把它全部塞进一根弦里。宏是微不足道的（尽管可能更简洁的代码是可能的）：

```
(defmacro syslurp (命令参数)
  “将命令的输出作为字符串返回。要提供命令
   作为字符串，args 作为字符串列表。”
  (让 ((istream (gensym)))
        (ostream (gensym))
        （线（gensym）））
    `(with-input-from-command (,istream ,command ,args)
       (with-output-to-string (,ostream)
         (loop (let ((,line (read-line ,istream nil)))
                 (当 (null ,line) (return))
                 （写线，线，ostream）））））））

```

现在你可以通过这个调用得到一个字符串：

```
(syslurp "ls" '("-l"))
```

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2008-10-25T17:46:09.097

数学：

```
output = Import["!foo", "Text"]; 
```

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2008-10-25T20:57:18.587

Perl 中的另一种方式（或 2！）....

```
open my $pipe, 'ps |';
my @output = < $pipe >;
say @output; 
```

[open](http://perldoc.perl.org/functions/open.html)也可以这样写……

```
open my $pipe, '-|', 'ps' 
```

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2008-10-30T21:10:11.773

几年前，我为[jEdit](http://jedit.org)编写了一个与本机应用程序接口的[插件。](https://sourceforge.net/projects/jpop)这就是我用来从正在运行的可执行文件中获取流的方法。剩下要做的就是：`while((String s = stdout.readLine())!=null){...}`

```
/* File:    IOControl.java
 *
 * created: 10 July 2003
 * author:  dsm
 */
package org.jpop.io;

import java.io.BufferedReader;
import java.io.InputStreamReader;
import java.io.PrintStream;

/**
 *  Controls the I/O for a process. When using the std[in|out|err] streams, they must all be put on
 *  different threads to avoid blocking!
 *
 * @author     dsm
 * @version    1.5
 */
public class IOControl extends Object {
    private Process process;
    private BufferedReader stdout;
    private BufferedReader stderr;
    private PrintStream stdin;

    /**
     *  Constructor for the IOControl object
     *
     * @param  process  The process to control I/O for
     */
    public IOControl(Process process) {
        this.process = process;
        this.stdin = new PrintStream(process.getOutputStream());
        this.stdout = new BufferedReader(new InputStreamReader(process.getInputStream()));
        this.stderr = new BufferedReader(new InputStreamReader(process.getErrorStream()));
    }

    /**
     *  Gets the stdin attribute of the IOControl object
     *
     * @return    The stdin value
     */
    public PrintStream getStdin() {
        return this.stdin;
    }

    /**
     *  Gets the stdout attribute of the IOControl object
     *
     * @return    The stdout value
     */
    public BufferedReader getStdout() {
        return this.stdout;
    }

    /**
     *  Gets the stderr attribute of the IOControl object
     *
     * @return    The stderr value
     */
    public BufferedReader getStderr() {
        return this.stderr;
    }

    /**
     *  Gets the process attribute of the IOControl object. To monitor the process (as opposed to
     *  just letting it run by itself) its necessary to create a thread like this: <pre>
     *. IOControl ioc;
     *.
     *. new Thread(){
     *.     public void run(){
     *.         while(true){    // only necessary if you want the process to respawn
     *.             try{
     *.                 ioc = new IOControl(Runtime.getRuntime().exec("procname"));
     *.                 // add some code to handle the IO streams
     *.                 ioc.getProcess().waitFor();
     *.             }catch(InterruptedException ie){
     *.                 // deal with exception
     *.             }catch(IOException ioe){
     *.                 // deal with exception
     *.             }
     *.
     *.             // a break condition can be included here to terminate the loop
     *.         }               // only necessary if you want the process to respawn
     *.     }
     *. }.start();
     *  </pre>
     *
     * @return    The process value
     */
    public Process getProcess() {
        return this.process;
    }
} 
```

* * *

## 回答 #14

> 赞同：4
> 
> 时间：2008-12-02T19:57:15.160

不要忘记 Tcl：

```
set result [exec ls] 
```

* * *

## 回答 #15

> 赞同：4
> 
> 时间：2009-01-11T12:37:39.573

C# 3.0，比[这个](https://stackoverflow.com/questions/236737/language-showdown-how-do-you-make-a-system-call-that-returns-the-stdout-output-a#388176)更简洁：

```
using System;
using System.Diagnostics;

class Program
{
    static void Main()
    {
        var info = new ProcessStartInfo("cmd", "/c dir") { UseShellExecute = false, RedirectStandardOutput = true };
        Console.WriteLine(Process.Start(info).StandardOutput.ReadToEnd());
    }
} 
```

警告：生产代码应正确处理 Process 对象...

* * *

## 回答 #16

> 赞同：3
> 
> 时间：2008-10-25T17:45:31.250

珀尔：

```
$output = `foo`; 
```

补充：这真的是一个多向领带。上面的 PHP 也是有效的，例如，Ruby 也使用相同的反引号。

* * *

## 回答 #17

> 赞同：3
> 
> 时间：2008-10-25T18:03:59.873

在 PHP 中

```
$output = `ls`; 
```

或者

```
$output = shell_exec('ls'); 
```

* * *

## 回答 #18

> 赞同：3
> 
> 时间：2008-10-27T21:19:53.080

C（带`glibc`扩展名）：

```
#define _GNU_SOURCE
#include <stdio.h>
int main() {
    char *s = NULL;
    FILE *p = popen("ls", "r");
    getdelim(&s, NULL, '\0', p);
    pclose(p);
    printf("%s", s);
    return 0;
} 
```

好吧，不是很简洁或干净。这就是C的生活...

* * *

## 回答 #19

> 赞同：3
> 
> 时间：2008-12-16T22:59:24.833

在 C on Posix 兼容系统中：

```
#include <stdio.h> 

FILE* stream = popen("/path/to/program", "rw");
fprintf(stream, "foo\n"); /* Use like you would a file stream. */
fclose(stream); 
```

* * *

## 回答 #20

> 赞同：3
> 
> 时间：2008-12-23T04:26:56.193

为什么这里仍然没有 c# 人:)

这是在 C# 中的操作方法。内置方式。

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Diagnostics;

namespace TestConsole
{
    class Program
    {
        static void Main(string[] args)
        {
            Process p = new Process();

            p.StartInfo.UseShellExecute = false;
            p.StartInfo.CreateNoWindow = true;
            p.StartInfo.RedirectStandardOutput = true;
            p.StartInfo.RedirectStandardError = true;
            p.StartInfo.FileName = "cmd";
            p.StartInfo.Arguments = "/c dir";
            p.Start();

            string res = p.StandardOutput.ReadToEnd();
            Console.WriteLine(res);
        }

    }
} 
```

* * *

## 回答 #21

> 赞同：3
> 
> 时间：2009-09-03T07:36:54.480

这是另一种 Lisp 方式：

```
(defun execute (program parameters &optional (buffer-size 1000))
  (let ((proc (sb-ext:run-program program parameters :search t :output :stream))
        (output (make-array buffer-size :adjustable t :fill-pointer t 
                            :element-type 'character)))
    (with-open-stream (stream (sb-ext:process-output proc))
      (setf (fill-pointer output) (read-sequence output stream)))
    output)) 
```

然后，获取您的字符串：

```
(execute "cat" '("/etc/hosts")) 
```

如果你想运行一个创建打印大量信息到 STDOUT 的命令，你可以像这样运行它：

```
(execute "big-writer" '("some" "parameters") 1000000) 
```

最后一个参数为 big-writer 的输出预分配大量空间。我猜这个函数可能比一次读取一行输出流更快。

* * *

## 回答 #22

> 赞同：3
> 
> 时间：2009-09-03T07:48:54.467

[卢阿](http://lua.org)：

```
 foo = io.popen("ls"):read("*a") 
```

* * *

## 回答 #23

> 赞同：2
> 
> 时间：2008-10-27T21:21:56.697

[Ĵ](http://www.jsoftware.com/)：

```
output=:2!:0'ls' 
```

* * *

## 回答 #24

> 赞同：2
> 
> 时间：2008-12-16T19:39:36.030

Perl，另一种方式：

```
use IPC::Run3

my ($stdout, $stderr);
run3 ['ls'], undef, \$stdout, \$stderr
    or die "ls failed"; 
```

很有用，因为您可以输入命令输入，并分别返回 stderr 和 stdout。远不及整洁/可怕/缓慢/令人不安`IPC::Run`，它可以设置子程序的管道。

* * *

## 回答 #25

> 赞同：2
> 
> 时间：2008-12-23T05:07:00.637

### 图标/独角兽：

```
stream := open("ls", "p")
while line := read(stream) do { 
    # stuff
} 
```

文档称之为管道。好处之一是它使输出看起来就像您正在阅读文件一样。这也意味着您可以在必要时写入应用程序的标准输入。

* * *

## 回答 #26

> 赞同：2
> 
> 时间：2009-09-03T10:07:12.637

Clozure Common Lisp：

```
(with-output-to-string (stream)
   (run-program "ls" '("-l") :output stream)) 
```

LispWorks

```
(with-output-to-string (*standard-output*)
  (sys:call-system-showing-output "ls -l" :prefix "" :show-cmd nil)) 
```

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2008-12-16T23:57:57.647

当然，它不是更小（来自所有可用的语言），但它不应该那么冗长。

这个版本很脏。应处理异常，阅读可能会有所改善。这只是为了说明如何启动 java 版本。

```
Process p = Runtime.getRuntime().exec( "cmd /c " + command );
InputStream i = p.getInputStream();
StringBuilder sb = new StringBuilder();
for(  int c = 0 ; ( c =  i.read() ) > -1  ; ) {
    sb.append( ( char ) c );
} 
```

下面完成程序。

```
import java.io.*;

public class Test { 
    public static void main ( String [] args ) throws IOException { 
        String result = execute( args[0] );
        System.out.println( result );
    }
    private static String execute( String command ) throws IOException  { 
        Process p = Runtime.getRuntime().exec( "cmd /c " + command );
        InputStream i = p.getInputStream();
        StringBuilder sb = new StringBuilder();
        for(  int c = 0 ; ( c =  i.read() ) > -1  ; ) {
            sb.append( ( char ) c );
        }
        i.close();
        return sb.toString();
    }
} 
```

样本输出（使用 type 命令）

```
C:\oreyes\samples\java\readinput>java Test "type hello.txt"
This is a sample file
with some
lines 
```

样本输出（目录）

```
 C:\oreyes\samples\java\readinput>java Test "dir"
 El volumen de la unidad C no tiene etiqueta.
 El número de serie del volumen es:

 Directorio de C:\oreyes\samples\java\readinput

12/16/2008  05:51 PM    <DIR>          .
12/16/2008  05:51 PM    <DIR>          ..
12/16/2008  05:50 PM                42 hello.txt
12/16/2008  05:38 PM             1,209 Test.class
12/16/2008  05:47 PM               682 Test.java
               3 archivos          1,933 bytes
               2 dirs            840 bytes libres 
```

尝试任何

```
java Test netstat
java Test tasklist
java Test "taskkill /pid 416" 
```

**编辑**

我必须承认我不是 100% 确定这是做到这一点的“最佳”方式。随意发布参考和/或代码，以展示如何改进它或这有什么问题。

# process - 小部分敏捷：物超所值

> ID：236744
> 
> 赞同：6
> 
> 时间：2008-10-25T17:47:03.573
> 
> 标签：process, agile

我们应该首先实施敏捷开发的哪个方面来改进我们的开发过程，为什么？

我的处境需要我“调整”我的流程，而不是重新设计它，而“敏捷”似乎是当今的口头禅。如果我们只能做出一项改变来改善某些东西——质量、上市时间、文档、透明度*等*，那么什么会产生最明显、最积极的影响？

如果我们选择正确，我们将能够做出第二选择。:-)

**更新：** *您当前的 SDLC 是什么？*
环境：本质上是“重启”。少数*开发*人员；具有 10^5-10^6 LOC 并在全球部署数万个的遗留产品；产品具有很强的相互依存性；多年来添加的重要功能，包括许多一次性的，没有重构；时间紧迫；表面质量保证；没有*验尸*或“过程大师”。

典型流程：

1.  创建设计/规范。所有利益相关者的审查。
2.  编码一个或多个功能/修复。
3.  修改设计/规格以解决意外情况。
4.  测试功能，记录缺陷。
5.  优先处理新的和剩余的任务。
6.  修改设计/规格/时间表。
7.  必要时返回步骤 2。
8.  发布测试版，记录反馈。
9.  必要时返回步骤 2。
10.  正式发布。

感谢您提供这么多有用的建议和见解！

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-25T18:10:34.180

**迭代构建**

当我们开始在一致的基础上进行构建时（在我们的例子中是每周或每周两次），我们看到了最大的改进。

每次构建完成后，我们都会与开发团队、QA 团队和产品管理团队坐下来，并创建一个包含在新构建中的工作列表。

然后每个人都帮助回答了下一个构建中应该包含什么的问题。

从那以后，我们添加了敏捷开发的许多其他特性（包括尝试实施 Scrum），但没有什么比迭代构建更能“物有所值”了。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-25T18:07:03.283

迭代开发。在小迭代中工作（比如 2 周），在每次迭代结束时“准备好”应用程序，即您的测试人员应该乐于将结果发布给您的客户。

这是核心。你可以以此为基础。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-25T18:17:51.187

请参阅[有关管理测试驱动和/或敏捷开发的最佳具体“操作手册”？](https://stackoverflow.com/questions/184025/best-concrete-how-to-manual-on-managing-test-driven-andor-agile-development).

我的建议是先从 TDD 开始。这很容易做到，并且对质量有深远的影响。

这有几个部分。

1.  每个人都必须获得工具（JUnit 或其他任何东西——这在某些文化中可能很难。）

2.  经理必须要求完成测试。他们绝不能（永远）规避单元测试。一旦有人说“那些测试无关紧要，无论如何都要发布它”，你就破坏了 TDD 带来的所有好处。

3.  你必须通过测试用例来管理：写了多少，通过了多少。您必须通过测试用例定义功能：特性 [X] 有 [n] 个测试用例，其中一些已经完成，一些正在处理中。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-26T00:24:02.040

我非常喜欢混搭，以及开发过程的增量变化。我同意迭代开发应该是你的首要目标，但我认为你可以更小的步骤来实现它。

根据我的经验，我会推荐以下顺序 - 选择你还没有做的第一个：

*   *首先修复错误。*我希望我不必这么说。这是理智的召唤，也需要更短的周期。

*   *小步骤。*培养实现最小更改的习惯，这是迈向下一个功能的明显步骤，然后编译和测试。在开始编码之前，将所有任务分解为小于 1 小时的单元。至少每 15 分钟编写一次可构建的功能代码。这不需要太多的基础架构更改 - 除了可能修复增量构建并拥有快速机器。

是的！首先确保开发人员拥有快速的机器。能得到多少更好的建议？！

*   *每日构建一切。*设置从源代码管理到安装介质的双击完整版本，最好是在单独的 PC 上。这是频繁构建的第一步，但它们本身已经有很大帮助。对我们来说，这是获得可靠、可重现的构建结果的关键一步。

*   *开始编写单元测试。*不要为覆盖而烦恼，不要强制“先编写测试”，而是将框架放在适当的位置。为新代码和更改编写测试。然后使用您的日常构建运行它们。

*   *短周期。*现在是时候了，您拥有所有工具，可以每周或每两周进行一次内部发布：代码库每天多次处于可交付状态，只需双击即可进行构建，至少有些东西正在工作.

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-25T17:57:18.733

与程序员、测试人员、技术作家和可能的销售/服务人员一起组成一个跨职能团队。让他们意识到“完成”的概念，即要完成的东西是经过编写、测试、记录、安装、部署并准备好供客户使用的东西。

这很重要，因为除非来自不同职能领域的每个人都聚在一起并专注于为客户提供东西的单一目标，否则您无法实现敏捷框架的任何其他方面。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-10-25T18:09:09.677

敏捷现在是一个流行词，但请记住，它**不是**[灵丹妙药](http://en.wikipedia.org/wiki/No_Silver_Bullet)；它不会像那样修复您的开发过程。您可能想阅读[Steve Yegge 关于敏捷开发的优秀文章](http://steve-yegge.blogspot.com/2006/09/good-agile-bad-agile_27.html)以平衡炒作。

如果您不掌握敏捷的核心，那么“挑选”敏捷开发的某些方面可能会很困难。敏捷最重要**的是一种思考方式**：保持灵活性，接受事情会发生变化，在短期迭代中编写代码，专注于**完成**一个或几个功能。与获得一个单一的、完整的、单一的规范、编写所有代码、文档然后发布它相反。

如果你想证明敏捷开发是有效的，我可能会投票支持使用 sprint 来展示“尽早发布，经常发布”的含义。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-10-25T18:28:54.660

完全取决于你现有的流程，但我会告诉你，我们所做的最好的举措之一是了解项目积压和每日 3 个问题的概念（自从我们上次见面以来你做了什么？你打算做什么？今天继续工作？阻碍你前进的障碍是什么？）早上开会，看看我们在哪里以及我们可以做些什么来朝着我们的短迭代周期终点前进。

很高兴能够看到要完成的动态积压工作以及现在正在处理的工作以及将使其进入下一次迭代的工作。能够了解各个开发人员的位置并帮助他们消除前进的任何障碍是件好事。它可以防止开发人员[陷入困境](http://www.codinghorror.com/blog/archives/001134.html)。

无论如何，这是我的想法。它对我们有用。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-25T18:17:12.577

如果您还没有这样做，请从单元测试开始。如果您进行单元测试，请切换到测试驱动开发。这些都很容易添加到现有流程中，并且会立即获得回报。当您准备好应对流程变更时，请引入迭代开发。如果您当前的流程已经是迭代的，那么开始频繁地向客户发布您的迭代以获得反馈。

如果我必须总结“敏捷”的方式，我会说尽早并经常提供高质量的商业价值。上述做法将使您在这条道路上走得很远。

[编辑] 我想我的建议是采用敏捷方法来采用敏捷方法，并从立即提供大量价值的简单事物开始。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-10-25T19:31:56.543

在自动化构建中运行的自动化测试。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-10-25T21:44:27.930

我会尝试使用测试驱动开发。这会给你很多东西：

*   您将获得很好的单元测试覆盖率（我并不是说单元测试覆盖率很重要）。
*   开发人员将更有信心相信代码真的可以工作（更多信息请参阅*）
*   您将能够更轻松地重构代码（因为您有测试）。

* * *

[*] - Kent Beck 在这个领域提到了影响图。在影响图中，节点之间的箭头表示第一个节点的增加意味着第二个节点的增加。带圆圈的箭头表示第一个节点的增加意味着第二个节点的减少。

```
-----> [Stress] <--o-- / --o--> [RunTests] 
```

你感到的压力越大，你做的测试就越少。你做的测试越少，你犯的错误就越多。你犯的错误越多，你的压力就越大。重复...

如何解决这个导致压力过大的开发人员一段时间后不信任自己的代码的循环？

测试先开发改变影响图：

```
[TestFirst] <--o-- / --o--> [Stress] 
```

你做的第一次开发测试越多，你感受到的压力就越小。您感到的压力越小，您进行的首次开发测试就越多。

这可以更好地测试由信任其代码的开发人员开发的代码。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-11-02T08:10:13.213

除了已经提供并且我同意的所有好的建议之外，我建议通过自动、可重复的测试来加强 QA。投资自动化将使您在更改已部署的代码时更加自信。

在实现新功能的同时为新功能创建回归套件。

QA 可以使用[探索性测试](http://www.satisfice.com/articles/what_is_et.shtml)作为替代方法来查找开发过程中的漏洞。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-10-25T21:04:18.887

我认为敏捷的两个最有价值和最容易实现的方面是

1.  每日站立会议 - 与团队进行简短的每日会议以审查状态。使用 3 个问题。避免串音、喋喋不休和唠叨。保持快速和准确。

2.  有时间限制的迭代——将项目分成两到三周的周期，迫使你在合理的期限内努力实现可管理的目标

# asp.net - 如何在 ASP.NET 中连接网页

> ID：236749
> 
> 赞同：3
> 
> 时间：2008-10-25T17:50:30.413
> 
> 标签：asp.net, webpage, concatenation

我有一堆作为产品文档的 ASP.NET 网页（具有标准布局）。我想创建某种组合页面，它将所有其他页面内容拉入并将它们连接到一个长页面中。

IFrame 不起作用，因为我不知道每个页面的大小。我可以让组合页面执行大量#includes，这会起作用，但我不想让主更新保持最新（我们有一个页面名称数据库可以随时间变化）。

最终，我追求的是可以获取页面列表的东西，并且为每个页面执行相当于 #include 的该页面到当前页面的操作。

我希望这是有道理的。有什么想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-25T18:05:08.763

您的“文档页面”静态 html 或 .aspx 是否也...

如果它只是静态内容，您可以执行以下操作

```
//assume that the array of page names has come from the DB.
protected void Page_Load(object sender, EventArgs e)
{
    string[] pages = new string [] { "~/Default.html", 
             "~/Default2.html", "~/Default3.html", "~/Default4.html" };

    foreach (string p in pages)
    {
        Response.WriteFile(p);
    }
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-25T18:01:43.763

你的页面是什么样的？

我认为它只是普通的 HTML，并且在所有页面上都有一致的模式，不是吗？就像，它有适当的 HTML 标记以及 HEAD 和 BODY 等？

在这种情况下，您可以像阅读普通文本文件一样阅读它，并对它们进行一些字符串解析以提取 BODY 标签内的部分，然后您可以将它们连接起来并将它们打印出 ASP-#include 样式。

要获取 ASP.NET 网站上文件的实际路径名，可以使用`Server.MapPath`

```
var actualDiskFilename = Server.MapPath("~/somewhere/somepage.html"); 
```

所有`System.IO`类在 ASP.NET 中的工作方式都相同，要获取虚拟目录中的文件列表，您可以执行以下操作：

```
var virtualDir = "~/somefolder/";
var actualDir = Server.MapPath(virtualDir);

var files = Directory.GetFiles(actualDir); 
```

那是你要找的吗？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-25T18:37:42.440

如果页面是 aspx 文档，您可以使用它`Server.Execute`来执行页面并返回生成的 html。然后您可以解析 html 并删除 head- 和 body-tags 并将剩余的 html 连接到您的页面中。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-25T19:01:22.283

你说 IFRAMES 不能工作是因为你不知道尺寸？那么为什么不根据大小更新 IFRAMES 的大小。

创建一个默认大小 IFRAME 并加载页面，然后借助 javascript 更新大小。你应该看看一些 javascript 框架，如原型或[jquery](http://www.jquery.com)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-25T19:43:08.003

听起来你应该从一开始就重新考虑格式，如果可能的话。例如，如果您将内容存储在数据库或 XML 文件中，那么您的单个页面可以提供它们的部分，而您的联合页面可以提供您想要的总数的任何组合。

Wouldn't be that hard to convert to if you're only talking a few pages (less than a dozen). Then keeping the documentation up to date is a matter of editing the content, not the display files (admittedly, XML is easier than a database in this respect).

# mysql - 帮忙写一个查询：对GROUP BY和ORDER BY操作顺序的混淆

> ID：236778
> 
> 赞同：2
> 
> 时间：2008-10-25T18:06:03.363
> 
> 标签：mysql, sql, database

我有一个名为 Info 这个模式的表：

```
int objectId;
int time;
int x, y; 
```

系统中有很多冗余数据——即`objectId`不是唯一的。对于每个`objectId`可以有多个条目`time, x, y`。

我想检索每个对象的最新位置列表。我从这个查询开始：

```
SELECT * FROM Info GROUP BY objectId 
```

这让我得到了我正在寻找的那种清单。但是我还想获得每个对象的最新时间，所以我尝试了：

```
SELECT * FROM Info GROUP BY objectId ORDER BY time DESC 
```

这给了我一个`time`下降的信息列表。但是，**我认为它没有达到我想要的效果 - 即返回`time, x, y`每个 object 的最新信息**。

谁能想象一个查询来做我想做的事？

**更新**我已经尝试了前三种解决方案，看看它们在大约 50,000 个信息的数据集上的表现如何。结果如下：

```
-- NO INDEX: forever
-- INDEX: 7.67 s

SELECT a.*
FROM Info AS a
  LEFT OUTER JOIN Info AS b ON (a.objectId = b.objectId AND a.time < b.time)
WHERE b.objectId IS NULL;

-- NO INDEX: 8.05 s
-- INDEX: 0.17 s

select a.objectId, a.time, a.x, a.y
  from Info a,
       (select objectId, max(time) time from Info group by objectId) b
  where a.objectId = b.objectId and a.time = b.time;

-- NO INDEX: 8.30 s
-- INDEX: 0.18 s

SELECT A.time, A.objectId, B.x, B.y
FROM
(
   SELECT max(time) as time, objectId 
   FROM Info
   GROUP by objectId
) as A 
INNER JOIN Info B
   ON A.objectId = b.objectId AND A.time = b.time; 
```

在一定程度上，它似乎`where`优于大盘`inner join`。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-25T18:09:54.447

```
SELECT A.time, A.objectID, B.X, B.Y
FROM
(
   SELECT max(time) as time, objectID 
   FROM table
   GROUP by objectID
) as A 
INNER JOIN table B
   ON A.objectID = b.objectID AND A.Time = b.Time 
```

投票者，如果 x 和 y 在时间线上的任何点递减，解决方案将不起作用。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-25T18:11:38.110

一种方法是使用子查询。

```
select distinct a.objectID, a.time, a.x, a.y
  from Info a,
       (select objectID, max(time) time from Info group by objectID) b
  where a.objectID = b.objectID and a.time = b.time 
```

编辑：添加 DISTINCT 以防止在一个 objectId 有多个同时记录的情况下重复行。如果有必要，取决于您的数据，问题作者提到有很多重复的行。（*由[托马拉克](https://stackoverflow.com/users/18771/tomalak)*添加）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-25T18:44:22.473

对于它的价值，这是获得所需结果的另一种方法。在支持子查询之前，我在 MySQL 4.0 的日子里养成了这样做的习惯。

```
SELECT a.*
FROM Info AS a
  LEFT OUTER JOIN Info AS b ON (a.objectID = b.objectID AND a.time < b.time)
WHERE b.objectID IS NULL; 
```

换句话说，向我显示不存在具有相同 objectID 和更长时间的其他行的行。这自然会返回每个 objectID 具有最大时间的行。不需要 GROUP BY。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-25T19:41:16.307

对于属于组的一行，这是获取一行中所有信息的一种非常常见的方式。

```
Select Info.*
from Info
inner join
   (select ObjectId, max(time) as Latest
    from Info
    group by ObjectId)  I
on Info.ObjectId = I.ObjectID and Info.time = I.Latest 
```

在过去的几周里，同样的问题以不同的形式被问了几次。我忘记了问题是如何措辞的。

# c++ - 设计业务消息解析器/从头开始重写

> ID：236792
> 
> 赞同：1
> 
> 时间：2008-10-25T18:12:35.130
> 
> 标签：c++, design-patterns, oop, templates

我负责我项目中的关键应用程序。它执行与解析业务消息（传统标准）相关的工作，处理它们，然后将一些结果存储在数据库中（另一个应用程序会选择它）。经过一年多的工作（我还有其他应用程序需要照顾），该应用程序终于稳定了。我引入了严格的 TDD 政策，并且我有 20% 的单元测试覆盖率（感谢 Michael Feathers 的书！），其中大部分都在关键部分。我也有一些白盒健身测试（那里涵盖了整个业务场景）。我觉得我无法进一步重构这个应用程序，我可以放心地使用它。设计的太差了，我想重写。应用程序本身大约有 20k 具有挑战性的遗留 C/C++ 代码。还有其他依赖项，但我设法将它们中的大多数解耦。

* * *

我只有 Sun C++ 编译器、cppunitlite、STLPort 和 Boost。请不要建议其他技术（没有 XML、Java 等），因为这不是我的组织中的选项。我想用现代 C++（也许玩元编程......），从头到尾的 TDD 来做。

我需要解析大约 30 种类型的消息。它们每个都由 3-10 行组成，其中大多数都非常相似。这是万恶之源-> 大量代码重复。每个 msgs 都有一个类描述它应该如何被解析。看一下主继承树：

```
 MSG_A                     MSG_B
                            /     \                   /     \
                    MSG_A_NEW   MSG_A_CNL      MSG_B_NEW   MSG_B_CNL 
```

两棵树都深入得多。MSG_A_NEW 和 MSG_B_NEW 之间有非常小的差异。它应该由可以注入一些小的定制的单个类处理。

我最初的计划是拥有一个可以定制的通用 msg 类。一些实体（构建器...？）将查看味精并初始化能够解析味精的适当对象。另一个实体将能够发现它是哪一行，并且此信息将由构建器使用。我打算编写几个解析器，它们只负责解析一个特定的行。这将允许我在解析不同的 msgs 时重用它。

我努力以一种优雅且可扩展的方式解决几个挑战。每种类型的味精：

有最小和最大数量如果行 - 有一些必须有的行 - 有一些可选的行 - 某些行必须在某些地方（即日期不能在味精类型之前），顺序很重要

我需要能够验证消息的格式。

* * *

我不确定我在这里解释的设计挑战是否足够好。我的设计经验非常有限。我已经修复了一段时间的错误，最后我将进行一些更改以进行一些有趣的编码:)

你对此有什么高层次的建议？您可以在此描述中识别哪些设计模式？主要的设计约束是可维护性和可扩展性，性能处于底层（无论如何我们还有其他瓶颈......）。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-28T09:41:48.497

我建议您**不要**从包含以下通用代码的基类继承特定的消息处理类：

```
 CommonHandler
            ^                                   ^
            |                                   |  = inheritance
       MsgAHandler
        ^       ^
        |       |
ANewHandler     ACnlHandler 
```

这种方法的可重用性很差：例如，如果你想处理某种需要从 A_NEW 和 A_CNL 做事的消息，你会很快得到多重继承。

相反，我会选择一个包含公共代码的类，该类调用接口来自定义该公共代码。像这样的东西：

```
 BasicHandler <>--- IMsgHandler    ------------\
             1  1  ^  ^   ^  ^    *           |            ^
                   |  |   |  |                |            |   = inheritance
         MsgAHandler  |   |  ANewHandler    1 |
             ACnlHandler  HandlerContainer <>-/           <>-  = containment HandlerContainer 类可用于将其他处理程序的行为组合在一起。

如果我没记错的话，这种模式称为“复合”。要创建正确的处理程序实例，您当然需要某种工厂。

祝你好运！

            回答 #2

赞同：0

时间：2008-10-25T21:53:41.437

这听起来确实是一个有趣的挑战*。*:-)

您的“初始计划”听起来不错：排除所有消息之间的所有类似处理，并将它们的代码放在基本消息类中。更改的项目可以成为虚拟函数（例如`CheckForRequiredLines`or `VerifyLineOrder`，也许），在最常见的情况下可能具有默认实现。然后为特定的消息类型派生其他类。

对于这样的设计问题，很难给出通用的建议。在我看来，您的主要解析器函数对应于工厂方法模式，但这是我可以轻松识别的唯一一个。（我对设计模式的名称不太熟悉——我使用了很多，但几年前我才知道它们*有名字。）*

            回答 #3

赞同：0

时间：2008-10-26T03:39:39.540

您可能已经意识到这一点，但以防万一……您应该拿起/借用《[四人组设计模式》一书](https://rads.stackoverflow.com/amzn/click/com/0201633612)，以帮助识别和应用适当的模式。这是规范参考，它包含交叉参考和表格，可帮助您确定哪些模式适合您的应用程序。仅根据该描述，这里的人们可能很难确定可能对您有帮助的特定模式。

            回答 #4

赞同：0

时间：2008-10-27T12:18:56.417

我建议查看 boost 提供的库，例如`Tuple`或`mpl::vector`. 这些库允许您创建不相关类型的列表，然后对它们进行操作。非常粗略的想法是，您对每种消息类型都有类型序列：

```
Seq1 -> MSG_A_NEW, MSG_A_CNL
Seq2 -> MSG_B_NEW, MSG_B_CNL 
```

一旦你知道你的消息类型，你就可以使用适当的元组和一个函数模板，将第一个元组类型应用于数据。然后是元组中的下一个条目，依此类推。

这确实假设您的数据流的布局在编译时是已知的，但它确实具有您无需为数据结构支付任何运行时开销的优势。

        ajax - 如何对 gwt-rpc 调用进行分组？

ID：236793

赞同：7

时间：2008-10-25T18:12:58.153

标签：ajax, gwt, gwt-rpc, dwr

使用 DWR 可以将多个服务调用组合成一个 HTTP 请求：

[dwr 批处理功能](http://directwebremoting.org/dwr/browser/engine/batch)

 此功能对于减少 ajax 应用程序的延迟非常有用。有没有办法用 GWT / GWT-RPC 做类似的事情？

谢谢你的帮助

            回答 #1

赞同：8

时间：2009-10-09T15:13:51.500

Google 的 Ray Ryan 做了一个关于构建[GWT 应用程序的最佳实践](http://code.google.com/events/io/sessions/GoogleWebToolkitBestPractices.html)的演讲，他在演讲中谈到了使用命令模式。您可能想要发送碰巧通过 RPC 的异步命令。一旦您发送命令而不是 RPC，就很容易对它们进行批处理。

有关为您实现此模式的库，请参阅[gwt-dispatch](http://code.google.com/p/gwt-dispatch/)。我刚刚开始使用它，所以我不知道它是否会自动批处理，但它都是具有许可许可证的开源软件，因此如果没有，您可以修复它。

            回答 #2

赞同：1

时间：2008-10-25T19:15:29.057

GWT 不提供批处理多个任意 RPC 的一步式解决方案。但是，请记住，GWT 的自动序列化使得编写每个 RPC 方法的串行版本和批处理版本变得非常容易。例如，假设您已经定义了这个 RPC：

```
FooResponse callFoo(FooRequest request); 
```

自己编写同一个 RPC 的“批处理”版本就这么容易：

```
ArrayList<FooResponse> batchCallFoo(ArrayList<FooRequest> requests) {
  ArrayList<FooResponse> responses = new ArrayList<FooResponse>();
  for (FooRequest request : requests) {
    responses.add(callFoo(request));
  }
} 
```

            回答 #3

赞同：1

时间：2008-12-30T11:49:37.450

这是一个很好的问题，但我认为没有一个简单的解决方案。

我相信您必须创建一个单独的方法，将您的方法组合在一起，以与 DWR 类似的方式实现批处理。

即，如果您有：

```
public int add(int x, int y);
public int sub(int i, int j); 
```

您将创建一个新方法来组合它们：

```
public Map<String, Integer> addAndSub(Map methodsAndArguments) {
    // Call add and sub methods with it's arguments
} 
```

当然，您仍然需要在相同的回调方法中处理整个响应。

我意识到这可能不是最优雅的解决方案，但由于 GWT RPC 的工作方式，我认为这是要走的路。使用 GWT，我认为您通常应该尝试编写您的方法，以便批处理甚至不会成为您需要考虑的问题。

            回答 #4

赞同：1

时间：2010-06-11T06:55:36.827

如果您的应用程序适合 Comet 的域（服务器端推送），您也可以使用[GWTEventService ：](http://code.google.com/p/gwteventservice/)

GWTEventService 是一个基于事件的客户端-服务器通信框架。它使用 GWT-RPC 和 Comet / server-push 技术。客户端提供了一个高级 API，可以将侦听器注册到服务器，就像注册一个 GUI 组件一样。事件可以添加到服务器端的上下文/域中，客户端的侦听器会收到有关传入事件的通知。服务器端完全独立于客户端实现并且是高度可配置的。

因为此事件模型提供的优势之一是：

捆绑事件以减少服务器调用

        php - PHP：析构函数与 register_shutdown_function

ID：236795

赞同：12

时间：2008-10-25T18:14:57.417

标签：php, image-processing, memory-leaks, destructor

我有一个 PHP 类，可以动态创建一个 PNG 图像并将其发送到浏览器。PHP手册说我需要确保最后调用*imagedestroy*函数来释放内存。现在，如果我不使用类，我会有一些这样的代码：

```
function shutdown_func() 
{
    global $img;
    if ($img)
        imagedestroy($img);
}
register_shutdown_function("shutdown_func"); 
```

但是，我相信适合我班级的地方是在班级的析构函数中调用*imagedestroy*。

我没有弄清楚析构函数是否以与关闭函数相同的方式被调用？例如，如果用户在浏览器中按下 STOP 按钮时执行停止。

注意：无论您在答案中写什么，请指向一些支持它的文章或手册页（URL）。

            回答 #1

赞同：14

时间：2008-10-25T18:47:11.970

我刚刚用 Apache 进行了测试，PHP 被用作 Apache 模块。我创建了一个这样的无限循环：

```
<?php
class X
{
    function __destruct()
    {
        $fp = fopen("/var/www/htdocs/dtor.txt", "w+");
        fputs($fp, "Destroyed\n");
        fclose($fp);
    }
};

$obj = new X();
while (true) {
    // do nothing
}
?> 
```

这是我发现的：

*   在 Firefox 中按 STOP 按钮不会停止此脚本
*   如果我关闭 Apache，则不会调用析构函数
*   它在达到 PHP max_execution_time 并且没有调用析构函数时停止

但是，这样做：

```
<?php
function shutdown_func() {
    $fp = fopen("/var/www/htdocs/dtor.txt", "w+");
    fputs($fp, "Destroyed2\n");
    fclose($fp);
}
register_shutdown_function("shutdown_func");

while (true) {
    // do nothing
}
?> 
```

shutdown_func 被调用。所以这意味着类析构函数不如关闭函数好。

            回答 #2

赞同：2

时间：2008-10-25T23:25:11.037

基于你应该[完成你开始](http://www.pragprog.com/the-pragmatic-programmer/extracts/tips)的原则，我会说析构函数是免费调用的正确位置。

[析构函数](http://www.php.net/manual/en/language.oop5.decon.php)将在对象被释放时被调用，而[关闭函数](http://php.net/manual/en/function.register-shutdown-function.php)在脚本执行完成之前不会被调用。正如 Wolfie 所指出的，如果您强制停止服务器或脚本，这些情况不一定会发生，但到那时，PHP 分配的内存无论如何都会被释放。

Wolfie 还指出，当脚本关闭时，PHP 将释放脚本资源，因此如果您只是实例化这些对象之一，那么您可能不会注意到巨大的差异。但是，如果您稍后确实实例化了这些东西，或者在循环中这样做，那么您可能不想担心内存使用量突然飙升，所以为了将来的理智，我回到我的原始推荐；把它放在析构函数中。

            回答 #3

赞同：1

时间：2015-07-29T02:24:17.440

我最近遇到了麻烦，因为我试图专门针对服务器超时的情况处理破坏，并且我想在错误日志中包含类数据。引用 &$this 时我会收到一个错误（尽管我已经在几个示例中看到过它，可能是版本问题或 symfony 副作用），我想出的解决方案相当干净：

```
class MyClass
{
    protected $myVar;

    /**
     * constructor, registers shutdown handling
     */
    public function __construct()
    {
        $this->myVar = array();

        // workaround: set $self because $this fails
        $self = $this;
        // register for error logging in case of timeout
        $shutdown = function () use (&$self) {
            $self->shutdown();
        };
        register_shutdown_function($shutdown);
    }

    /**
     * handle shutdown events
     */
    public function shutdown()
    {
        $error = error_get_last();
        // if shutdown in error
        if ($error['type'] === E_ERROR) {
            // write contents to error log
            error_log('MyClass->myVar on shutdown' . json_encode($this->myVar), 0);
        }
    }

    ... 
```

希望这对某人有帮助！

            回答 #4

赞同：0

时间：2008-10-25T18:28:37.123

我认为您错过的一件大事是，一旦脚本终止，PHP 在脚本执行期间分配的所有内存都会被释放。即使用户按下停止按钮，PHP 也会处理脚本直到完成，然后将其返回给 HTTP 守护程序以提供给访问者（或不提供，取决于守护程序的聪明程度）。

因此，在脚本执行结束时显式释放内存有点多余。有些人可能会争辩说这样做是件好事，但它仍然是多余的。

但是，在类析构函数的主题上，只要对象被显式销毁`unset()`或在脚本完成/终止时，就会调用它们。

开发人员明确释放图像处理中使用的内存的建议肯定只是为了确保绝对不会发生内存泄漏，因为位图可能会占用内存方面的东西（高度 * 宽度 * 位深度 * 3 (+ 1 如果您有 Alpha 通道））

为了满足您的维基百科需求：

*   [http://php.net/manual/en/language.oop5.decon.php](http://php.net/manual/en/language.oop5.decon.php)
*   [http://php.net/manual/en/function.unset.php](http://php.net/manual/en/function.unset.php)

        c++ - 应该将 operator<< 实现为友元还是成员函数？

ID：236801

赞同：150

时间：2008-10-25T18:19:26.283

标签：c++, operator-overloading

这基本上是一个问题，是否有“正确”的实施方式`operator<<`？读到[这里](http://bytes.com/forum/thread170304.html)，我可以看到类似：

```
friend bool operator<<(obj const& lhs, obj const& rhs); 
```

比类似的东西更受欢迎

```
ostream& operator<<(obj const& rhs); 
```

但我不太明白为什么要使用其中一个。

我的个人情况是：

```
friend ostream & operator<<(ostream &os, const Paragraph& p) {
    return os << p.to_str();
} 
```

但我可能会这样做：

```
ostream & operator<<(ostream &os) {
    return os << paragraph;
} 
```

我应该根据什么理由做出这个决定？

*注意*：

```
 Paragraph::to_str = (return paragraph) 
```

其中段落是一个字符串。

            回答 #1

赞同：140

时间：2008-10-25T21:53:00.707

这里的问题在于您对所[链接](http://bytes.com/forum/thread170304.html)文章的解释。

平等

本文是关于在正确定义布尔关系运算符时遇到问题的人。

运营商：

*   平等 == 和 !=
*   关系 < > <= >=

这些运算符在比较相同类型的两个对象时应该返回一个布尔值。通常最容易将这些运算符定义为类的一部分。这是因为类自动成为自身的朋友，因此 Paragraph 类型的对象可以相互检查（甚至是相互的私有成员）。

制作这些独立函数有一个论据，因为如果它们不是同一类型，这允许自动转换转换两边，而成员函数只允许自动转换 rhs。我发现这是一个纸人论点，因为你真的不希望首先发生自动转换（通常）。但是，如果这是您想要的（我不推荐），那么使比较器独立存在可能是有利的。

流媒体

流运算符：

*   运算符 << 输出
*   运算符 >> 输入

当您将它们用作流运算符（而不是二进制移位）时，第一个参数是流。由于您无权访问流对象（它不是您可以修改的），因此它们不能是成员运算符，它们必须在类的外部。因此，他们必须要么是班级的朋友，要么有权访问将为您进行流式传输的公共方法。

这些对象返回对流对象的引用也是传统的做法，因此您可以将流操作链接在一起。

```
#include <iostream>

class Paragraph
{
    public:
        explicit Paragraph(std::string const& init)
            :m_para(init)
        {}

        std::string const&  to_str() const
        {
            return m_para;
        }

        bool operator==(Paragraph const& rhs) const
        {
            return m_para == rhs.m_para;
        }
        bool operator!=(Paragraph const& rhs) const
        {
            // Define != operator in terms of the == operator
            return !(this->operator==(rhs));
        }
        bool operator<(Paragraph const& rhs) const
        {
            return  m_para < rhs.m_para;
        }
    private:
        friend std::ostream & operator<<(std::ostream &os, const Paragraph& p);
        std::string     m_para;
};

std::ostream & operator<<(std::ostream &os, const Paragraph& p)
{
    return os << p.to_str();
}

int main()
{
    Paragraph   p("Plop");
    Paragraph   q(p);

    std::cout << p << std::endl << (p == q) << std::endl;
} 
```

            回答 #2

赞同：55

时间：2008-10-25T18:24:38.317

您不能将其作为成员函数执行，因为隐式参数是 -运算符`this`的左侧。`<<`（因此，您需要将其作为成员函数添加到`ostream`-class。不好 :)

你可以在没有`friend`ing 的情况下将它作为一个免费功能来做吗？这就是我更喜欢的，因为它清楚地表明这是与您的类的集成`ostream`，而不是您的类的核心功能。

            回答 #3

赞同：31

时间：2008-10-25T22:22:15.123

如果可能，作为非会员和非朋友功能。

正如 Herb Sutter 和 Scott Meyers 所描述的，与成员函数相比，更喜欢非朋友非成员函数，以帮助增加封装。

在某些情况下，例如 C++ 流，您没有选择权，必须使用非成员函数。

但是，这并不意味着你必须让这些函数成为你的类的朋友：这些函数仍然可以通过你的类访问器访问你的类。如果您以这种方式成功编写了这些函数，那么您就赢了。

关于运算符 << 和 >> 原型

我相信你在问题中给出的例子是错误的。例如;

```
ostream & operator<<(ostream &os) {
    return os << paragraph;
} 
```

我什至无法开始思考这种方法如何在流中工作。

以下是实现 << 和 >> 运算符的两种方法。

假设您想使用类型为 T 的类流对象。

并且您想从/插入到 T 中您的段落类型对象的相关数据。

通用运算符 << 和 >> 函数原型

第一个是作为函数：

```
// T << Paragraph
T & operator << (T & p_oOutputStream, const Paragraph & p_oParagraph)
{
   // do the insertion of p_oParagraph
   return p_oOutputStream ;
}

// T >> Paragraph
T & operator >> (T & p_oInputStream, const Paragraph & p_oParagraph)
{
   // do the extraction of p_oParagraph
   return p_oInputStream ;
} 
```

通用运算符 << 和 >> 方法原型

第二个是作为方法：

```
// T << Paragraph
T & T::operator << (const Paragraph & p_oParagraph)
{
   // do the insertion of p_oParagraph
   return *this ;
}

// T >> Paragraph
T & T::operator >> (const Paragraph & p_oParagraph)
{
   // do the extraction of p_oParagraph
   return *this ;
} 
```

请注意，要使用此表示法，您必须扩展 T 的类声明。对于 STL 对象，这是不可能的（您不应该修改它们......）。

如果 T 是 C++ 流呢？

以下是 C++ 流的相同 << 和 >> 运算符的原型。

对于通用 basic_istream 和 basic_ostream

请注意，这是流的情况，因为您不能修改 C++ 流，所以必须实现函数。这意味着类似：

```
// OUTPUT << Paragraph
template <typename charT, typename traits>
std::basic_ostream<charT,traits> & operator << (std::basic_ostream<charT,traits> & p_oOutputStream, const Paragraph & p_oParagraph)
{
   // do the insertion of p_oParagraph
   return p_oOutputStream ;
}

// INPUT >> Paragraph
template <typename charT, typename traits>
std::basic_istream<charT,traits> & operator >> (std::basic_istream<charT,traits> & p_oInputStream, const CMyObject & p_oParagraph)
{
   // do the extract of p_oParagraph
   return p_oInputStream ;
} 
```

对于 char istream 和 ostream

以下代码仅适用于基于字符的流。

```
// OUTPUT << A
std::ostream & operator << (std::ostream & p_oOutputStream, const Paragraph & p_oParagraph)
{
   // do the insertion of p_oParagraph
   return p_oOutputStream ;
}

// INPUT >> A
std::istream & operator >> (std::istream & p_oInputStream, const Paragraph & p_oParagraph)
{
   // do the extract of p_oParagraph
   return p_oInputStream ;
} 
```

Rhys Ulerich 评论说基于字符的代码只是它上面的通用代码的“专业化”。当然，Rhys 是对的：我不推荐使用基于 char 的示例。仅在此处给出它是因为它更易于阅读。因为它只有在你只使用基于字符的流时才可行，所以你应该避免在 wchar_t 代码很常见的平台上（即在 Windows 上）。

希望这会有所帮助。

            回答 #4

赞同：11

时间：2008-10-25T18:59:38.573

它应该作为一个免费的、非友元函数来实现，特别是如果像现在的大多数事情一样，输出主要用于诊断和日志记录。为所有需要进入输出的东西添加 const 访问器，然后让输出器调用它们并进行格式化。

实际上，我已经开始在“ostreamhelpers”头文件和实现文件中收集所有这些 ostream 输出自由函数，它使次要功能远离类的真正目的。

            回答 #5

赞同：8

时间：2008-10-25T18:29:00.447

签名：

```
bool operator<<(const obj&, const obj&); 
```

似乎相当可疑，这不符合`stream`约定也不符合按位约定，因此它看起来像是运算符重载滥用的情况，`operator <`应该返回`bool`但`operator <<`可能应该返回其他内容。

如果你的意思是这样说：

```
ostream& operator<<(ostream&, const obj&); 
```

然后，由于您不能`ostream`根据需要添加函数，因此该函数必须是自由函数，它是否`friend`取决于它必须访问的内容（如果它不需要访问私有或受保护的成员，则无需创建它朋友）。

            回答 #6

赞同：3

时间：2017-06-02T09:42:08.513

为了完整起见，我想补充一点，您确实**可以**在类中创建一个运算符`ostream& operator << (ostream& os)`并且它可以工作。据我所知，使用它不是一个好主意，因为它非常复杂且不直观。

假设我们有这段代码：

```
#include <iostream>
#include <string>

using namespace std;

struct Widget
{
    string name;

    Widget(string _name) : name(_name) {}

    ostream& operator << (ostream& os)
    {
        return os << name;
    }
};

int main()
{
    Widget w1("w1");
    Widget w2("w2");

    // These two won't work
    {
        // Error: operand types are std::ostream << std::ostream
        // cout << w1.operator<<(cout) << '\n';

        // Error: operand types are std::ostream << Widget
        // cout << w1 << '\n';
    }

    // However these two work
    {
        w1 << cout << '\n';

        // Call to w1.operator<<(cout) returns a reference to ostream&
        w2 << w1.operator<<(cout) << '\n';
    }

    return 0;
} 
```

所以总结一下 - 你可以做到，但你很可能不应该:)

            回答 #7

赞同：0

时间：2012-01-20T11:15:09.857

`operator<<`实现为友元函数：

```
#include <iostream>
#include <string>
using namespace std;

class Samp
{
public:
    int ID;
    string strName; 
    friend std::ostream& operator<<(std::ostream &os, const Samp& obj);
};
 std::ostream& operator<<(std::ostream &os, const Samp& obj)
    {
        os << obj.ID<< “ ” << obj.strName;
        return os;
    }

int main()
{
   Samp obj, obj1;
    obj.ID = 100;
    obj.strName = "Hello";
    obj1=obj;
    cout << obj <<endl<< obj1;

} 
```

输出：

  100 你好

  100 你好

这只能是友元函数，因为对象在右侧，`operator<<`而参数`cout`在左侧。所以这不能是类的成员函数，它只能是友元函数。

            回答 #8

赞同：0

时间：2016-02-01T12:02:36.600

朋友运算符 = 与班级同等的权利

```
friend std::ostream& operator<<(std::ostream& os, const Object& object) {
    os << object._atribute1 << " " << object._atribute2 << " " << atribute._atribute3 << std::endl;
    return os;
} 
```

        ruby-on-rails - 如何使用 ruby zip 库获取压缩文件的内容？

ID：236810

赞同：7

时间：2008-10-25T18:28:35.627

标签：ruby-on-rails, ruby, unzip, rubyzip

我正在尝试提取上传的 zip 文件并将其内容存储在数据库中，每个文件一个条目。rubyzip 库几乎没有有用的文档。

有一个 assets 表，它有 key :string （文件名）和 data :binary （文件内容）。

我正在使用 ruby​​zip 库，并且已经做到了这一点：

```
Zip::ZipFile.open(@file_data.local_path) do |zipfile|
  zipfile.each do |entry|
    next if entry.name =~ /__MACOSX/ or entry.name =~ /\.DS_Store/ or !entry.file?

    asset = self.assets.build
    asset.key = entry.name
    asset.data = ??  # what goes here?
  end
end 
```

如何从 ZipEntry 设置数据？我必须使用临时文件吗？

            回答 #1

赞同：11

时间：2008-10-25T18:59:14.800

找到了一个更简单的方法：

```
asset.data = entry.get_input_stream.read 
```

            回答 #2

赞同：6

时间：2008-10-25T18:43:00.560

您似乎可以像这样使用 read_local_entry 方法：

```
asset.data = entry.read_local_entry {|z| z.read } 
```

或者，您可以使用以下方法保存条目：

```
data = entry.extract "#{RAILS_ROOT}/#{entry.name}"
asset.data = File.read("#{RAILS_ROOT}/#{entry.name}") 
```

我不确定这些将如何工作，但也许它们会帮助您找到正确的方法（如果不是这样的话）。

而且，另一种选择：

```
asset.data = zipfile.file.read(entry.name) 
```

        linq - .NET 3.5 (lambdas, Linq) 是如何演变的

ID：236818

赞同：1

时间：2008-10-25T18:32:08.770

标签：linq, .net-3.5, lambda, anonymous-types

我记得大约一年前，Scott Hanselman（可能是 scott Guthrie）读过一篇关于 Linq 如何演变的文章。它记得它表明任何匿名类型都会导致 lambda 表达式，然后以某种方式导致 Linq。我似乎无法在谷歌上找到它。还有人记得这个帖子吗？如果是这样，你能发一下吗？

            回答 #1

赞同：3

时间：2008-10-25T18:35:04.880

这是[链接](http://msdn.microsoft.com/en-us/magazine/cc163400.aspx)。我通过搜索“linq c# 3.0 features”找到了它

            回答 #2

赞同：2

时间：2008-10-25T18:33:33.493

[http://msdn.microsoft.com/en-us/magazine/cc163400.aspx](http://msdn.microsoft.com/en-us/magazine/cc163400.aspx)

        client - 如何处理愚蠢的客户请求？

ID：236835

赞同：5

时间：2008-10-25T18:58:29.810

标签：client, specifications

我赢得了一个项目的投标，现在客户（本身来自 IT 部门）希望我以非常特殊的方式构建/实施解决方案。我确信应用程序会因为性能问题而失败。而且它不容易扩展。

这个特定的客户/用户对我将使用的平台和语言（ASP.NET / SQL Server）一无所知。他唯一的知识是 Cobol，试图让他理解我的 POV 只会让他生气。

他联系了我。他是在竞标中选择我作为获胜者的人。他将批准我的支票。他是我与这家公司的唯一联系人。

我对提供一个我知道会失败的解决方案感到不舒服，我不想被称为导致它失败的愚蠢程序员。我确实知道他们对这个应用程序的真正需求和使用模式，因为我过去曾为他们做过项目。

另一方面，以他的方式这样做只会延长我的合同更多时间（因此，更多的经济收益），以便通过修改代码来解决问题。

我是否应该从这个项目中辞职，因为我可能会永远失去这个客户？

或者……</p>

我是否应该服药并从扩展项目中获得经济利益，而只是将坏名声视为成本？

            回答 #1

赞同：27

时间：2008-10-25T22:25:09.317

你从完全错误的角度看待这个问题。这不是来自对技术一无所知的客户提出的愚蠢要求。您认为这是一种设计约束，会在项目中引入风险。

因此，当您在项目中遇到风险时，您会做任何事情：定义风险、评估风险并推荐缓解策略。

*   **定义风险。**  说它会导致“性能问题”和“不容易扩展”并不是定义风险。您需要准确说明您的意思。什么不会执行，为什么？什么规模的变化会遇到这些问题？
*   **评估风险。**  好的，所以你认为有问题。有多糟糕？您如何确定这些性能问题会实际发生？如果他们这样做会对用户产生什么影响？您说程序无法扩展：规模的增长是否会暴露设计缺陷，即使在卡片中？最重要的是，*你怎么知道这个？*  在这里花时间构建和基准测试原型可以为您节省很多毫无意义的争论。
*   **推荐缓解策略。**  实现这一点的*正确*方法是什么？为什么它是正确的方法？再说一次，*你怎么知道的？*  同样，原型设计是您的朋友。

做这个练习会产生一些事情。

首先，你可能会发现，虽然你对每一个细节都是正确的，但当你把它们放在一起时，这并不重要。是的，这个程序不会很好地执行或扩展，但如果它的预期用例都不会遇到这些问题，那么它很容易不值得解决。

其次，告诉某人“这不会执行，我只知道它”和告诉他“我对我们期望的用例进行了基准测试，看起来这种方法将导致四个——或每个用户事务的 5 秒响应时间。”

第三，如果你知道什么条件会导致软件失败，并且你向客户表达了这些担忧，而客户说“我们真的只是希望它以这种方式工作”，那么你已经履行了你的责任。如果由于客户选择不减轻您确定的风险而导致失败，那么没有人可以指向您并说这是程序员的错。

最重要的是，*证据胜过观点*。您已经将整个问题构建为您的意见与客户的意见的案例。这是一个失败的提议。您需要做的就是将其框定为“这是我们需要解决的问题”。要以这种方式提出问题，您必须证明问题的存在，为此，您需要证据。

最终，决定是否减轻风险的是客户，而不是您。您可以向他提供最好的信息来支持他的决定。而且你需要清楚地表明这是他的决定。

我发现，不止一次，一封简单的电子邮件完美地集中了注意力：

我一直在审查设计，我认为这里有一个风险需要我们讨论。[方法 A] 对交易量非常敏感，我担心我们将拥有足够多的用户，我们会遇到麻烦。

我使用 [Approach B] 进行了一个小测试，它的敏感度要低得多；在我的简单原型中，我能够从中获得每秒 X 笔交易。这是有道理的，因为[两种方法如何处理事情的技术比较]。  

我特别担心这一点，因为[描述如果程序表现不佳将如何失败]。

这对我来说似乎是一个重大问题。如果是我，我会使用 [方法 B]，因为 [描述这种方法将如何降低风险]。  

但是你比我更熟悉[方法A]，我很乐意在这件事上听从你的指导。你认为我们应该怎么做？

This message very clearly says "If you disregard what I'm telling you, here's how the project is going to fail, and I'm going to have documentation demonstrating that you told me to do it that way."  It also doesn't actually *say* that.

            回答 #2

赞同：6

时间：2008-10-25T19:04:20.063

我认为你需要和他坐下来，问一些澄清问题。

您将需要了解他为什么希望以这种特定方式实施它。您需要证明您希望提供满足业务需求的有效解决方案。

可能存在一些潜在的担忧，需要解决的问题，正如您所说，他可能只是不熟悉您提出的技术并且需要一些保证。

未能确保事情得到充分记录并签署。

            回答 #3

赞同：4

时间：2008-10-25T19:16:03.830

**选项1：**走开，你们的关系已经很糟糕，而且不太可能改善。  

但是，不要因为你想延长合同而这样做，这充其量是狡猾，最坏的是不诚实，但如果你需要合同......

**选项 2：**让他记录他的架构选择和原因，并将其作为规范签署。在合同中添加一个条款，说明您不保证使用他制作的规范的性能和/或可扩展性，然后按照他的方式实施。向他发送您喜欢的方法和推理的介绍。

如果项目失败（他可能是对的），那么你总是可以指出你告诉过他并提供了一个替代方案。

确保您真诚地实施他的架构，即不要故意让它失败。做早期的测试来证明你的观点，并确保他知道他们失败了。在项目的整个生命周期中向他发出明确的书面警告，说明项目正在偏离轨道。

祝你好运。认真考虑选项 1。与这个人进行一次不公开的心对心是值得一试的。

            回答 #4

赞同：3

时间：2008-10-25T19:03:17.740

是否可以创建一个类似应用程序的小型原型来证明他是错的而你是对的？如果你有确凿的证据，谈话会容易得多。

            回答 #5

赞同：3

时间：2008-10-25T19:14:25.987

我讨厌成为客户服务警察，但是将其称为“愚蠢的客户请求”可能是个坏主意，除非确实如此（在这种情况下，您应该毫无疑问地走开）。我认为更好的术语是“消息灵通的客户请求”。

考虑到这一点，请记住您的客户可能有真正的需求，您应该认识到这一点（口头上对他们）。这只是被他们（知之甚少）的解决方案想法所掩盖。稍微探究一下并尝试了解他们真正在寻找什么，然后提出一个您认为会更好的解决方案并解释*为什么*它会更好。这样做的方式是不要质疑客户的能力。没有人愿意与任何让他们感到愚蠢的人一起工作。

            回答 #6

赞同：2

时间：2008-10-25T19:25:07.447

由于我不知道此处的详细信息，因此很难建议要采取的具体步骤，但这是我的想法：

如果你为他建造他*想要*的（而不是他*需要*的）并且你知道解决方案是错误的，那么你就是项目失败的同谋。如果你*知道*它行不通并且无法扩展并且无论如何你都要构建它，那么如果你最终成为项目失败的“替罪羊”并且没有得到更多的钱，那就不要感到惊讶下次做对。

如果这个人生气，可能有很多原因，其中之一可能是他不了解技术，这让他很困扰。但是，我不知道情况，所以谁知道呢？我个人宁愿让那个人生气并提出**正确**的解决方案并**坚持**正确的解决方案，而不是让他的情绪驱动船。

他可能是客户，他可能持有支票，但这并不意味着他聪明或正确。尽管有句老话，但客户总是错的。现在，你可以以错误的方式或正确的方式接近他，他可能会对两者做出相同的反应。但无论如何，你都想以正确的方式接近他。  

如果最后他坚持要你按照他的方式去做，除了断言和情感之外什么都不能支持他的方式，我会礼貌地离开这份工作。这笔钱不值得，说实话。他可能会生你的气，但知道*你*没有把他公司的钱浪费在问题的糟糕解决方案上，你可以睡得很好。

*   说实话。
*   听听他要说什么。
*   不要让他的情绪影响你的判断。
*   最后，做正确的事。  

至少，我会这样做。

祝你好运！

            回答 #7

赞同：2

时间：2008-10-25T19:51:39.327

**边听边****学**。_ 对客户方法的利弊真正感兴趣。

**以客户可以理解的方式**声明您自己解决问题的方法，并确保也记录您的方法的优缺点。

然后**讨论与客户做事的两种方法**，但不要以“你的方法很愚蠢，我是对的”的方式，而是真正感兴趣**他的方法可能带来什么好处**。

如果您发现**他的方法有问题，请询问他**。但不是以“这行不通”的方式，而是好奇“这将如何扩展”。**不要只是猜测**他的想法，而是要知道事实和数据“这样做，这些情况下流量过多会不会有问题”？

你甚至可能学到一些东西。努力吧！最后，你可能不得不按照他的方式编码，如果你真正**了解其中的陷阱**会更好！

            回答 #8

赞同：1

时间：2008-10-25T19:03:39.487

基本上只有你可以回答这个问题。你最了解你的客户和你的情况，如果你能找到一种方法来完成这项工作，这就是你的决定。

就个人而言，我会拒绝这个项目。如果他们想留住你，请解释为什么你不能按照规定的要求接受这个项目。

告诉他们，如果他们希望*您*实施该项目，那么他们聘请了*您的*专业知识，而不是他们*IT 部门*人员的专业知识。

            回答 #9

赞同：1

时间：2008-10-25T19:04:58.533

如果你觉得不舒服，那就走开。尽管我们有最好的祝愿和最好的建议，但我们之前一直被迫为客户提供特定的解决方案，这给我们带来了未来无尽的悲痛。

如果它是一个财务问题并且你“需要”这项业务，那么我肯定会从时间盒的角度来处理这个项目。

告诉他们在什么样的时间表内可以实现什么。确保您在达到不同的里程碑时以模块化方式获得报酬。至少这样，如果它对你来说没有赢家，它会给你机会在未来走开。

另一种选择可能是向他们展示按照他们的方式做这件事比你的成本高多少。

            回答 #10

赞同：1

时间：2008-10-25T19:07:09.357

只需提出您的解决方案并解释（借助**演示文稿**/**文档**）为什么它是更好的解决方案。或者甚至用它做一个原型。

如果您证明了这一点，您的客户应该了解您在该领域具有技术领先地位，并信任您。

            回答 #11

赞同：1

时间：2008-10-25T19:08:52.487

如果您需要客户，他也需要您（可能更多）。毕竟，他是选择了你的人。他是需要解决问题的人。

表明你不会被他关于“如何”工作的指示所支配——做什么当然是他的召唤。您可能会看到一些冰融化。

            回答 #12

赞同：1

时间：2008-10-25T19:09:50.193

我建议与他尝试一些误导策略。让他知道您对他的方法有什么顾虑，并为他提供一些适合您和他的需要的其他解决方案。尽量避免咄咄逼人（不要说他错了），但要说你认为有一个更好的解决方案可以整合你的两种选择。  

尝试练习“口头柔道”。与他对抗并不会让你得到任何分数，只会让他更加确定你只是在为难。同意他的观点，就共同的想法建立融洽的关系，然后温柔地引导他走向你的解决方案。

            回答 #13

赞同：1

时间：2008-10-25T19:16:47.993

制定一份包含您的顾虑的合同，即使由于客户的错误决定而导致失败，他们也会支付这笔钱。然后让他们签字。

不过，请务必由经验丰富的律师执行该合同，因为它很容易出现轻微错误，因此法院会通过您，如果情况变得更糟并且您需要起诉钱财。

在签署之前让客户了解合同中的那部分，也许他们会重新考虑。

或者，不要像其他人建议的那样经历所有这些麻烦：保释，走开，或者更好的是：逃跑。以你最快的速度。除非它真的是很多钱，否则卖掉它是不值得的。

（编辑：该死，西蒙领先我几秒钟。）

            回答 #14

赞同：1

时间：2008-10-25T19:54:31.523

除非我饿了，否则我会放弃这个项目。作为一名顾问，我觉得**我给客户带来的唯一价值是我拥有的知识**（而他们没有，否则他们不会雇用我）。从事我“知道”会失败的事情会违反顾问的道德准则（如果有的话）。

我会尽我最大的努力说服客户他的方式可能会失败，然后我会尽我最大的努力找到其他人为他做这项工作。

        linux - 对于高级用户来说，有哪些好的 Linux/Unix 书籍？

ID：236838

赞同：84

时间：2008-10-25T19:01:16.620

标签：linux, unix, command-line

对于一个相对较新但不是全新的 *nix 用户，有没有什么好书可以让他们获得更深入的知识（所以没有“Linux for dummies”）？在大多数情况下，我并不是在寻找可以从头到尾阅读的东西。相反，当我需要知道如何做某事或当我有其中一个“我该如何再做一次？” 时刻。我希望看到的一些领域是：

*   命令行管理
*   bash 脚本
*   编程（虽然我想要一些不仅仅与 C 程序员相关的东西）

我希望它尽可能独立于平台（这意味着它具有与任何 linux 发行版以及 BSD、Solaris、OS X 等相关的信息），但我使用最多的 unix 系统是 OS X 和Debian/Ubuntu。因此，如果我能从一本更加依赖平台的书中获益最多，那么这些就是目标平台。

如果我能在一本书中得到所有这些，那就太好了，但我宁愿拥有更深入的材料而不是涵盖**所有内容**。因此，如果有任何书籍仅涵盖其中一个领域，请将其发布。见鬼，发布它，即使它与任何这些领域都不相关，并且你认为这是我职位的人应该知道的事情。

            回答 #1

赞同：63

时间：2008-10-25T20:18:00.553

我已经在维基上找到了这篇文章 - 那些有足够代表的人可以在其中添加项目。

系统管理、一般使用书籍

*   内梅特等。al, [Linux 系统管理](https://rads.stackoverflow.com/amzn/click/com/0131480049)

*   犰[狳](https://rads.stackoverflow.com/amzn/click/com/0596003439)的书，如[下面](https://stackoverflow.com/questions/236838/what-are-good-linuxunix-books-for-an-advancing-user#236932)的蜥蜴比尔所述。

*   [马克索贝尔](http://www.amazon.com/s/ref=nb_ss_gw?url=search-alias%3Daps&field-keywords=mark+G+sobell&x=0&y=0)的任何东西。他为各种风格的 unix 做了一种主题和变体，所以选择最适合手头环境的书。书相当不错。当我攻读理学学士学位时，他的其中一个是规定的文本。

*   Stevens 的[TCP/IP 插图，卷。1：](https://rads.stackoverflow.com/amzn/click/com/0201633469)全面了解 TCP/IP 工作原理的协议。

*   我从未读过这本特别的书，但这里的许多人都在推荐[Hortitude](https://stackoverflow.com/questions/236838/what-are-good-linuxunix-books-for-an-advancing-user#236858)提到的[Unix Power Tools 。](https://rads.stackoverflow.com/amzn/click/com/0596003307)

编程：

*   已故 W. Richard Stevens 的任何作品，特别[是 Unix 环境中的高级编程](https://rads.stackoverflow.com/amzn/click/com/0201433079)和[Unix 网络编程卷。1](https://rads.stackoverflow.com/amzn/click/com/0131411551) [和卷。2](https://rads.stackoverflow.com/amzn/click/com/0130810819)

*   各种经典的 c/unix 书籍，例如[The Unix Programming Environment](https://rads.stackoverflow.com/amzn/click/com/013937681X)、[Advanced Unix Programming](https://rads.stackoverflow.com/amzn/click/com/0131411543)、[Programming Pearls](https://rads.stackoverflow.com/amzn/click/com/0201657880)，当然还有[K&R](https://rads.stackoverflow.com/amzn/click/com/0131103628)。C/Unix 书籍倾向于深入底层架构，并提供相当程度的全面相关的洞察力——这些是系统内的底层机制。任何尝试进行系统级编程的人（基本上任何使用系统服务的东西，不管是什么语言）都会发现这方面的基础是有益的。

特定工具（例如 Sendmail）

来自 O'Reilly 和其他出版商的各种书籍都涵盖了特定主题。其中一些关键是：

*   关于 sendmail的[蝙蝠](https://rads.stackoverflow.com/amzn/click/com/0596510292)书 - 如果您有机会体验使用[sendmail.cf](http://okmij.org/ftp/Computation/sendmail-as-turing-machine.txt)的乐趣。如果您可以选择 MTA，[postfix](http://www.postfix.org/)或[qmail](http://www.qmail.org/top.html)会更容易使用（我从 2000 年左右开始使用 postfix）。O'reilly 发布了[他们](https://rads.stackoverflow.com/amzn/click/com/1565926285)[俩](https://rads.stackoverflow.com/amzn/click/com/0596002122)的指南。

*   [一些关于perl](http://www.cpan.org/)的经典作品：[骆驼](https://rads.stackoverflow.com/amzn/click/com/0596000278)和[骆驼](https://rads.stackoverflow.com/amzn/click/com/0596520107)的书（后者由[Randal Schwartz](https://stackoverflow.com/users/22483/randal-schwartz)撰写）。

*   [sed 和 awk](https://rads.stackoverflow.com/amzn/click/com/1565922255)。不知道封面上的小动物是什么。我的副本不久前去了南方。在这个主题上，[Mastering Regular Expressions](https://rads.stackoverflow.com/amzn/click/com/0596528124)也在这里得到了提及，是一本关于这个主题的好书。  

*   [桑巴舞](http://us3.samba.org/samba/)。  [犀鸟（？）](https://rads.stackoverflow.com/amzn/click/com/0596007698)书涵盖了这一点；还有[相当](http://us3.samba.org/samba/docs/man/Samba-HOWTO-Collection/) [多](http://us3.samba.org/samba/docs/man/Samba-Guide/) [的](http://us3.samba.org/samba/docs/using_samba/toc.html) [在线](http://us3.samba.org/samba/docs/) [文档](http://wiki.samba.org/)。

*   [NFS/NIS](https://rads.stackoverflow.com/amzn/click/com/1565925106)适用于使用或维护 unix 或 linux 客户端的用户。

其中一些书籍已经出版了很长一段时间，并且仍然具有相关性。因此，它们也经常以远低于标价的价格出售。亚马逊市场是寻找此类商品的好地方。这是一个很好的方法，可以用很少的钱来解决这样的主题。  

例如，由于新西兰比索疲软（因为新西兰元在外籍人士圈子中被亲切地称为）和曲折的供应链，在新西兰，技术书籍非常昂贵。你可以把刚毕业的学生一周的税后工资的 20% 用在一本书上。当我刚从大学毕业住在那儿时，我经常使用这种类型的市场，经常以标价的 1/4 购买书籍——包括运往新西兰的运费。如果您不住在具有一级收入的地方，我建议您这样做。

电子书和在线资源（感谢[israkir](https://stackoverflow.com/questions/236838/what-are-good-linuxunix-books-for-an-advancing-user#237015)提醒我）：

*   Linux 文档项目 ( [www.tldp.org](http://www.tldp.org/) ) 有许多称为 HowTos 的特定主题指南，这些指南[也](http://www.tldp.org/docs.html#howto)经常涉及第三方 OSS 工具，并且与其他 Unix 变体相关。它还有一系列[常见问题解答](http://www.tldp.org/docs.html#faq)和[指南](http://www.tldp.org/guides.html)。

*   [Unix Guru's Universe](http://www.ugu.com/sui/ugu/warp.ugu)是一个 unix 资源的集合，带有一些更老派的味道。

*   谷歌。网络上有很多很多的 unix 和 linux 资源。[搜索诸如unix 命令](http://www.google.co.uk/search?hl=en&client=firefox-a&rls=org.mozilla:en-GB:official&hs=vbh&q=unix+commands&revid=120646170&sa=X&oi=revisions_inline&resnum=0&ct=broad-revision&cd=2)或[学习 unix](http://www.google.co.uk/search?hl=en&client=firefox-a&rls=org.mozilla:en-GB:official&hs=vbh&q=learn+unix&revid=120646170&sa=X&oi=revisions_inline&resnum=0&ct=broad-revision&cd=3)之类的字符串会找到任何数量的在线资源。

*   [野生动物园](http://safari.oreilly.com/?cid=orm-nav-global)。这是一项订阅服务，但您可以搜索大量书籍的文本。我可以推荐这个，因为我已经使用它了。他们还为企业客户提供站点许可。

Unix的一些哲学：

*   ES Raymond[的《UNIX 编程艺术》 （可在线获取和印刷版）。](http://catb.org/esr/writings/taoup/)

*   BW Kernighan 和 R Pike[的编程实践。](http://cm.bell-labs.com/cm/cs/tpop/)

            回答 #2

赞同：20

时间：2008-10-25T19:11:02.343

我发现[Unix Power Tools](http://oreilly.com/catalog/9780596003302/)是我最好的资源之一。它可能没有教程，但它是一个很好的参考。

            回答 #3

赞同：15

时间：2008-10-25T19:01:53.593

[《Unix 编程艺术》](http://www.faqs.org/docs/artu/)是一本我过去发现很有帮助的书，尽管它对其他非 Unix 平台有点倾斜。

            回答 #4

赞同：11

时间：2008-10-25T19:26:58.753

O'Reilly 的书籍具有出色的 *nix 覆盖率。我有这些：  

[学习 bash Shell](http://oreilly.com/catalog/9780596009656/index.html)

* 涵盖了几个基本的 *nix 命令行工具以及更高级的 shell 脚本技术。

[学习 vi 和 Vim 编辑器](http://oreilly.com/catalog/9780596529833/index.html)

* 无价之宝。让我能够从 shell 快速编辑或创建 shell 脚本、配置文件和 Python 脚本。

            回答 #5

赞同：10

时间：2008-10-25T19:49:00.677

我推荐 O'Reilly 的[Armadillo](https://rads.stackoverflow.com/amzn/click/com/0596003439)书，用于命令行管理和 shell 脚本。

![替代文字](https://d.gr-assets.com/books/1328834229l/376238.jpg)

            回答 #6

赞同：7

时间：2008-10-25T21:11:47.840

杰森，

[Kernighan 和 Pike 的Unix Programming Environment](http://www.amazon.co.uk/Unix-Programming-Environment-Prentice-Hall-Software/dp/013937681X/ref=sr_1_1?ie=UTF8&s=books&qid=1224968700&sr=8-1)将为您提供有关 Unix 的所有东西的坚实基础，并且应该涵盖您关于 shell 命令行脚本等的大部分问题。

O'Reilly的[Armadillo](https://rads.stackoverflow.com/amzn/click/com/0596003439)书将增加管理角度。它对我很有帮助！

祝你好运！

            回答 #7

赞同：4

时间：2008-10-25T21:15:13.327

我可以在这里推荐一堆书：

[http://www.linux.org/docs/online_books.html](http://www.linux.org/docs/online_books.html)

祝你好运;）

            回答 #8

赞同：4

时间：2008-10-26T03:42:23.263

前面提到的*Unix Power Tools*是必须的。其他经典有*sed&awk*和*Mastering Regular Expressions*。我也喜欢 O'Reilly “食谱”系列中的一些书：

*   [Albing 等人的Bash 食谱](https://rads.stackoverflow.com/amzn/click/com/0596526784)。
*   Carla Schroder 的[Linux 食谱](https://rads.stackoverflow.com/amzn/click/com/0596006403)
*   Carla Schroder 的[Linux 网络手册](https://rads.stackoverflow.com/amzn/click/com/0596102488)

            回答 #9

赞同：4

时间：2008-11-05T13:16:57.523

[Advanced Bash-Scripting Guide](http://www.tldp.org/LDP/abs/html/)是唯一一本真正让读者了解 bash 脚本的书。您需要这种能力来完全理解如何启动/停止守护进程并自动执行许多任务。

            回答 #10

赞同：2

时间：2008-12-11T17:01:01.920

[![替代文字](https://i.stack.imgur.com/k0KfV.gif)](https://i.stack.imgur.com/k0KfV.gif)

在我看来，只要在 *nix 盒子上摆弄你觉得有趣的东西，你就会学到更多。如果您对网络不感兴趣，那么阅读 BIND 是浪费时间。

            回答 #11

赞同：2

时间：2009-02-19T14:42:35.200

[AWK 编程语言](https://rads.stackoverflow.com/amzn/click/com/020107981X)

不仅介绍了多功能工具`awk`，而且还提供了有关基于 Unix 的哲学和一些`awk`“设计模式”的见解。

            回答 #12

赞同：1

时间：2008-10-26T03:23:56.247

*Essential System Adminstration*和*Unix Power Tools*的大协议。

此外，无论您喜欢哪种编辑器，vim 或 emacs，都可以来回学习。如果你喜欢 vim，那就去看看 Steve Oualline 的 vim 书。

            回答 #13

赞同：1

时间：2009-01-04T01:39:04.983

关于一般的 Ubuntu 和 Linux，一本好书：

*   [Neal Krawetz 破解 Ubuntu](http://www.amazon.co.uk/s/ref=nb_ss_w_h_?url=search-alias%3Daps&field-keywords=hacking+ubuntu&x=0&y=0)
*   [极客的 Linux 烦恼 Michael Jang](http://www.amazon.co.uk/s/ref=nb_ss_w_h_?url=search-alias%3Daps&field-keywords=Linux+annoyances+for+geeks&x=0&y=0)

            回答 #14

赞同：1

时间：2010-01-08T15:10:22.140

Stephen Kochan 的“Unix Shell 编程”和“探索 Unix 系统”

            回答 #15

赞同：1

时间：2010-03-10T11:27:01.287

*   sed & awk 多尔蒂和罗宾斯
*   掌握正则表达式 Jeffrey Friedl
*   简而言之，Linux 进行查找，尽管大部分信息也在联机帮助页中
*   史蒂夫 Oualline 的 Vim

        asp.net - 实时/生产 Web 应用程序中的错误跟踪

ID：236851

赞同：3

时间：2008-10-25T19:05:30.730

标签：asp.net, error-logging

我目前在一家拥有大量内部定制应用程序的公司工作。目前很多东西都没有标准。我想实现一种方法来记录/跟踪此程序中发生的错误（大多数是 asp.net）。

我目前正在考虑在应用程序错误方法中的 Global.asax 中处理这个问题。首先尝试将信息保存到错误日志/跟踪数据库，如果失败，请尝试发送电子邮件。

从错误消息和其他应用程序变量（页面、用户名等）中获取最有用的信息类型。

我目前正在考虑使用两张表，一张用于获取一般错误和应用程序信息，另一张用于保存异常信息。这将是一对多的关系来处理可能来自一个应用程序级别异常的内部异常。

我确信我遗漏了很多细节，并想听听您处理此问题的策略。

            回答 #1

赞同：3

时间：2008-10-26T05:49:30.743

我认为[ELMAH](http://code.google.com/p/elmah/)可能是您正在寻找的。

            回答 #2

赞同：2

时间：2008-10-26T05:59:27.697

如果您使用日志库（如 Log4Net），您可以设置各种日志附加器来记录到电子邮件、数据库、文件、事件日志等，同时在代码中调用单个日志。这篇[文章](http://mitch-wheat.blogspot.com/2007/04/log4net-net-logging-tool.html)涵盖了您入门所需的一切。

还有[ASP.NET 健康监控](http://msdn.microsoft.com/en-us/library/ms998306.aspx)。

编辑：另一张海报提到 ELMAH，它非常适合记录 ASP.NET 错误，并且可以动态“注入”到正在运行的应用程序中。

            回答 #3

赞同：1

时间：2008-10-25T19:16:21.083

Jeff Atwood 写了一个很棒的异常处理程序，你应该在[CodeProject上看看](http://www.codeproject.com/KB/exception/ExceptionHandling.aspx)

我会尝试收集尽可能多的信息。堆栈信息 会话信息 错误位置

我还将设置应用程序调用的 Web 服务，以将异常信息保存到您的系统中。

            回答 #4

赞同：1

时间：2008-10-25T19:36:17.143

这就是我所做的，但由于电子邮件问题，我仍然遇到了错误。

我从不在数据库上保留任何东西，因为如果数据库有错误，我将永远不会在数据库上出现该错误，从逻辑上讲，插入将失败！

所以我通过电子邮件发送到一个特殊的电子邮件地址，例如 bugs@mydomain.com

**主题**：[应用程序名称] [时间戳：ddmmyyyy hhmmss]
**消息**：应用程序、错误消息、堆栈跟踪信息以及会话变量（如用户名）和服务器变量（如引用者）。

*ASP.NET 开发人员最好的朋友是*堆栈**跟踪信息**，在这里您会知道出了什么问题、调用了什么以及调用的位置。

**您在此系统中遇到的唯一问题**是，如果电子邮件有问题（发送电子邮件时出现一些异常），您将不会得到任何东西，为此我开始添加到每月 XML 文件 [errorLog_ mmm_yyyy.xml] 为好吧，并制作了一个简单的“拖放”页面，其中包含一个网格视图，该页面加载了我想要检查错误的月份和年份的 XML。

```
try 
{
   // production code
}
catch(Exception ex)
{
   Utilities.Mail.SendError(ex);
} 
```

或最好的方法：将其添加到global.asax中的**Application_Error中：**

```
<%@ Application Language="C#" %>
<%@ Import Namespace="System.Diagnostics" %>
<script language="C#" runat="server">
void Application_Error(object sender, EventArgs e)
{
   //get reference to the source of the exception chain
   Exception ex = Server.GetLastError().GetBaseException();

   //log the details of the exception and page state to the
   //Windows Event Log
   EventLog.WriteEntry("myWebApplication name",
     "MESSAGE: " + ex.Message + 
     "\nSOURCE: " + ex.Source +
     "\nFORM: " + Request.Form.ToString() + 
     "\nQUERYSTRING: " + Request.QueryString.ToString() +
     "\nTARGETSITE: " + ex.TargetSite +
     "\nSTACKTRACE: " + ex.StackTrace, 
     EventLogEntryType.Error);

   Utilities.Mail.SendError(ex);
}
</script> 
```

使用上面的代码将错误添加到事件日志中，我将错误附加到 SendError(Exception) 函数中的 XML 文件中。

            回答 #5

赞同：1

时间：2008-10-26T05:57:17.593

在记录通过 https 到达的潜在机密信息时要非常小心。用户会期望它被端到端加密（这可能是法律要求）。确保您不通过普通电子邮件发送。

通常我会说记录所有请求，包括获取、发布、cookie、表单状态（在 ASPNET 中）、用户代理、其他标头、日期/时间、服务器机器等

但在某些情况下，这会导致某些您不应该永久记录的信息被记录（例如信用卡号码被传递给支付提供商）。通过电子邮件发送更糟糕。

值得检查 HTTPS 是否打开，如果打开，请减少您记录的信息量以避免此问题。我只是通过一个字符串发送来说明该字段是空的还是非空的。

            回答 #6

赞同：0

时间：2008-10-25T19:15:53.347

听起来您实际上已经很好地考虑了解决方案。

我在 web 开发商店工作，所以除了记录错误之外，我还确保任何系统严重错误（例如失败的数据库查询等）也会通过电子邮件发送，以便我们可以立即处理它们。

可以考虑的一种替代方法是每天通过电子邮件发送一份报告，其中提供有关每个应用程序中引发的每个错误的信息以及您希望在电子邮件中提供的任何相关信息。

我们将所有错误记录到该应用程序的单个表中（当然，当您处理数据库都包含在内部的应用程序时，这更容易做到），包括错误的时间戳和异常消息的全文也已通过电子邮件发送。

异常消息包含函数跟踪，因此您知道原始调用函数是什么以及堆栈中所有函数的文件和行号。这使得回溯任何给定的错误变得超级简单。

            回答 #7

赞同：0

时间：2008-10-25T19:17:40.457

当登录到数据库失败时，您可以写入服务器的事件日志或 Log.txt 文件。您在此处的选择部分取决于您是否有权访问包含这些内容的 Web 服务器。

如果您需要快速响应，发送错误通知电子邮件是一个好主意。但是没有要扫描的错误列表。

为此，我创建了一个特殊的自定义异常类，其属性包括用户信息（ID、名称，如果可用）、所有会话变量、所有表单变量（这样您就可以看到表单是如何填充的以及用户输入的内容） ，以及错误发生位置（哪个页面，哪个类，哪个方法）的堆栈跟踪之外的一些指示。还包括调用的存储过程的名称和发送的参数，或 SQL 本身。还有所有异常属性（堆栈跟踪等）。以及 DisplayMessage 和 InternalMessage 字段。DisplayMessage 显示给用户。InternalMessage 记录在日志中，并在调试模式下显示在自定义错误页面上。

我在基本页面上的 Page_Error 中进行日志记录，并在 Application_Error 中作为故障保护。

有时我会在 web.config 中添加一个键值对来包含我的电子邮件地址（或分发列表）。如果该键中有值，则会发送通知电子邮件。如果没有价值，则不发送电子邮件。然后，在测试或早期生产期间，我可以立即收到有关问题的个人通知。初始阶段过去后，我删除了 web.config 中的电子邮件地址。

            回答 #8

赞同：0

时间：2008-10-26T05:46:27.537

日志记录很好，但[应用程序监控](http://www.nov8r.com/calm.aspx)更好。

警告：我是 CALM 的作者

            回答 #9

赞同：0

时间：2009-09-09T01:12:08.287

我们对现有的网站错误报告应用程序感到沮丧，因此我们在 Clearwind Consulting 编写了自己的应用程序。它是免费的，我们在内部将其用于我们的项目。它提供完整的错误信息，例如完整的错误代码、浏览器类型、回溯、导致错误的代码片段、30 天以上的错误频率图表等等。在 Clearwind，我们进行 Web 应用程序开发。我们需要一种工具，它可以为我们提供可以有效使用网站的真实数据。

您可以选择如何在您的网站出现错误时获得通知。RSS、电子邮件或任何最适合您的方法都可用于获取错误通知。是的，您可以在喝酒时将错误发送到您的 iPhone。它完全用 Django 编写，因此如果您希望标记或格式化数据，您可以使用 JSON、RoR、XML、CSV 等。或者只是来网站。

如果您愿意，请访问 www.areciboapp.com。  

它是免费的，可以轻松添加到任何网站（或从中删除），并提供真实信息以使您能够修复错误，而不仅仅是 404。这里没有硬性销售。只是一个邀请来看看，看看它是否可以帮助你和你的网站。我们认为可能。

            回答 #10

赞同：0

时间：2009-09-09T01:25:18.820

It's a pretty good idea to log to a custom event log on the server as well as any other logging & notification.  If the error was caused by an infrastructure issue, the same problem might also keep the error handler from sending emails or saving to a database.

        python - 任何用于解析绑定区域文件的 python 库？

ID：236859

赞同：8

时间：2008-10-25T19:12:33.650

标签：python, bind

任何用于解析绑定区域文件的 python 库？基本上可以帮助添加/删除区域和记录。即使有人手动修改区域文件，这也需要工作，因此每次都覆盖区域文件不是解决方案。  

            回答 #1

赞同：7

时间：2011-11-04T02:59:19.657

[easyzone](http://pypi.python.org/pypi/easyzone)是 dnspython 上的一个很好的层

[Zoner](http://pypi.python.org/pypi/zoner/1.4.1)提供了一个用于编辑区域文件的 Web 界面，并利用了 easyzone。

            回答 #2

赞同：6

时间：2010-01-27T09:48:52.803

我无法将 bicop 用于此类经典区域文件：

```
 $TTL 86400
@   IN SOA ns1.first-ns.de. postmaster.robot.first-ns.de. (
    2006040800   ; serial
    14400        ; refresh
    1800         ; retry
    604800       ; expire
    86400 )      ; minimum

@

                    IN NS      ns1.first-ns.de. 
```

我会看看[dnspython](http://www.dnspython.org/)

            回答 #3

赞同：0

时间：2008-10-26T00:09:16.983

请参阅上面关于 bicop 的答案。

[顺便说一句，http: //pypi.python.org/pypi](http://pypi.python.org/pypi)上的 Python 包索引是查找 Python 包的好地方。

**编辑**：以下内容可能仍然对试图弄清楚简单解析的人有所帮助，但 bicop 显然是一个现有的解决方案。

如果有人手动修改了配置，而您不想覆盖它，这是否意味着您希望从现有配置中插入/删除行，而保留所有注释等完整？这确实会阻止解析然后重新输出配置，但这也是一个积极的方面——您不需要完全解析文件来实现您的目标。

要添加记录，您可以尝试一种简单的方法，例如

```
# define zone_you_care_about and line_you_wish_to_insert first, then:
for line in bindfile.read():
    out.write(line + '\n')
    if ('zone "%s" in' % zone_you_care_about) in line:
        out.write(line_you_wish_to_insert) 
```

类似的代码适用于删除一行：

```
# define zone_you_care_about and relevant_text_to_remove, then:
for line in bindfile.read():
    if not relevant_text_to_remove in line:
        out.write(line + '\n') 
```

使用像这样的简单代码片段，您可能会得到尽可能多的信息。

            回答 #4

赞同：0

时间：2011-07-15T17:05:56.840

我知道这是旧的，但我能找到的唯一有效的是 iscpy。你可以做一个easy_install。

```
easy_install iscpy 
```

然后在python中：

```
import iscpy
iscpy.ParseISCString(open('somefile.conf', 'r').read()) 
```

它返回一个字典。

            回答 #5

赞同：-1

时间：2008-10-28T03:19:04.963

您可以尝试[`bicop`](http://pypi.python.org/pypi/bicop)“处理 ISC 绑定样式配置文件的 python 库”。

        java - 使用 FileInputStream 时如何确定理想的缓冲区大小？

ID：236861

赞同：168

时间：2008-10-25T19:13:51.837

标签：java, performance, file-io, filesystems, buffer

我有一种从文件创建 MessageDigest（哈希）的方法，我需要对很多文件（> = 100,000）执行此操作。我应该使用于从文件中读取的缓冲区有多大以最大限度地提高性能？

大多数人都熟悉基本代码（为了以防万一，我将在这里重复）：

```
MessageDigest md = MessageDigest.getInstance( "SHA" );
FileInputStream ios = new FileInputStream( "myfile.bmp" );
byte[] buffer = new byte[4 * 1024]; // what should this value be?
int read = 0;
while( ( read = ios.read( buffer ) ) > 0 )
    md.update( buffer, 0, read );
ios.close();
md.digest(); 
```

最大化吞吐量的理想缓冲区大小是多少？我知道这是系统依赖的，我很确定它的操作系统、文件系统*和*硬盘驱动器依赖，并且可能还有其他硬件/软件混合在一起。

（我应该指出，我对 Java 有点陌生，所以这可能只是一些我不知道的 Java API 调用。）

**编辑：**我不提前知道这将用于哪种系统，所以我不能假设很多。（出于这个原因，我使用 Java。）

**编辑：**上面的代码缺少诸如 try..catch 之类的东西以使帖子更小

            回答 #1

赞同：226

时间：2008-10-26T03:44:20.997

最佳缓冲区大小与许多因素有关：文件系统块大小、CPU 缓存大小和缓存延迟。

大多数文件系统配置为使用 4096 或 8192 的块大小。理论上，如果您配置缓冲区大小以便读取比磁盘块多几个字节，则文件系统的操作可能会非常低效（即，如果您将缓冲区配置为一次读取 4100 个字节，每次读取需要文件系统读取 2 次块）。如果这些块已经在缓存中，那么您最终会付出 RAM -> L3/L2 缓存延迟的代价。如果你不走运并且块还没有在缓存中，那么你也要付出磁盘-> RAM 延迟的代价。

这就是为什么您会看到大多数缓冲区大小为 2 的幂，并且通常大于（或等于）磁盘块大小。这意味着您的一个流读取可能会导致多个磁盘块读取 - 但这些读取将始终使用完整块 - 不会浪费读取。

现在，这在典型的流式传输场景中偏移了很多，因为当您进行下一次读取时，从磁盘读取的块仍将在内存中（毕竟我们在这里进行顺序读取） - 所以你结束了在下一次读取时支付 RAM -> L3/L2 缓存延迟价格，而不是磁盘 -> RAM 延迟。就数量级而言，磁盘-> RAM 延迟非常慢，几乎超过了您可能正在处理的任何其他延迟。

因此，我怀疑如果您使用不同的缓存大小运行测试（我自己没有这样做），您可能会发现缓存大小对文件系统块大小的影响很大。除此之外，我怀疑事情会很快趋于平稳。

这里有*大量*的条件和例外——系统的复杂性实际上是相当惊人的（仅仅处理 L3 -> L2 缓存传输就非常复杂，而且它会随着每种 CPU 类型而变化）。

这导致了“现实世界”的答案：如果您的应用程序的 99% 存在，请将缓存大小设置为 8192 并继续（更好的是，选择封装而不是性能并使用 BufferedInputStream 隐藏细节）。如果您属于高度依赖磁盘吞吐量的 1% 的应用程序，请精心设计您的实现，以便您可以更换不同的磁盘交互策略，并提供旋钮和转盘以允许您的用户测试和优化（或提出一些自优化系统）。

            回答 #2

赞同：21

时间：2008-10-25T19:21:21.090

是的，它可能取决于各种各样的东西——但我怀疑它会产生很大的不同。我倾向于选择 16K 或 32K 作为内存使用和性能之间的良好平衡。

请注意，您应该在代码中有一个 try/finally 块，以确保即使抛出异常也关闭流。

            回答 #3

赞同：9

时间：2008-10-25T20:49:46.607

在大多数情况下，这真的没那么重要。只需选择一个合适的尺寸，例如 4K 或 16K 并坚持下去。如果您*确定*这是您的应用程序的瓶颈，那么您应该开始分析以找到最佳缓冲区大小。如果您选择的尺寸太小，您将浪费时间进行额外的 I/O 操作和额外的函数调用。如果你选择的尺寸太大，你会开始看到很多缓存未命中，这真的会减慢你的速度。不要使用大于 L2 缓存大小的缓冲区。

            回答 #4

赞同：5

时间：2008-10-25T20:00:23.147

在理想情况下，我们应该有足够的内存在一次读取操作中读取文件。那将是最好的表现，因为我们让系统随意管理文件系统、分配单元和硬盘。实际上，您很幸运能够提前知道文件大小，只需使用向上取整为 4K 的平均文件大小（NTFS 上的默认分配单位）。最重要的是：创建一个基准来测试多个选项。   

            回答 #5

赞同：4

时间：2008-10-25T20:29:51.217

您可以使用 BufferedStreams/readers，然后使用它们的缓冲区大小。

我相信 BufferedXStreams 使用 8192 作为缓冲区大小，但就像 Ovidiu 所说，您可能应该对一大堆选项进行测试。它真的将取决于文件系统和磁盘配置来确定最佳大小。

            回答 #6

赞同：4

时间：2008-10-25T21:27:18.870

使用 Java NIO 的 FileChannel 和 MappedByteBuffer 读取文件很可能会产生比任何涉及 FileInputStream 的解决方案都要快得多的解决方案。基本上，内存映射大文件，并为小文件使用直接缓冲区。

            回答 #7

赞同：4

时间：2017-01-05T08:33:51.857

在 BufferedInputStream 的源代码中你会发现： private static int DEFAULT_BUFFER_SIZE = 8192; 

因此，您可以使用该默认值。

但如果你能找出更多的信息，你就会得到更有价值的答案。

例如，您的 adsl 可能会提供 1454 字节的缓冲区，这是因为 TCP/IP 的有效负载。对于磁盘，您可以使用与磁盘块大小匹配的值。

            回答 #8

赞同：1

时间：2008-10-25T21:20:13.487

正如其他答案中已经提到的，使用 BufferedInputStreams。

在那之后，我猜缓冲区大小并不重要。要么程序受 I/O 限制，而且缓冲区大小超过 BIS 默认值，不会对性能产生任何重大影响。

或者程序在 MessageDigest.update() 中受 CPU 限制，并且大部分时间没有花费在应用程序代码中，因此对其进行调整将无济于事。

（嗯......有多个核心，线程可能会有所帮助。）

            回答 #9

赞同：0

时间：2017-01-05T08:06:48.337

1024 适用于各种情况，尽管在实践中您可能会看到更大或更小的缓冲区大小会获得更好的性能。

这将取决于许多因素，包括文件系统块大小和 CPU 硬件。

为缓冲区大小选择 2 的幂也很常见，因为大多数底层硬件的结构都是 2 的幂的文件块和缓存大小。 Buffered 类允许您在构造函数中指定缓冲区大小。如果没有提供，它们使用默认值，在大多数 JVM 中是 2 的幂。

无论您选择哪种缓冲区大小，您将看到的最大性能提升是从非缓冲文件访问转变为缓冲文件访问。调整缓冲区大小可能会略微提高性能，但除非您使用非常小或非常大的缓冲区大小，否则不太可能产生显着影响。

        c# - 使用什么：var 或对象名称类型？

ID：236878

赞同：55

时间：2008-10-25T19:21:21.153

标签：c#, .net-3.5, c#-3.0, anonymous-objects

这是我在编程时总是想知道的一个问题：我们在编写代码时要使用什么：

```
var myFiles = Directory.GetFiles(fullPath); 
```

或者

```
string[] myFiles = Directory.GetFiles(fullPath); 
```

***var***是新的，是一个*隐式类型的局部变量*，所以我们只能在本地使用，它有不能为空等规则，但我想知道我们是否能“正常”使用它。

“通常”部分说，不是在**Anonymous Types**、**Object 和 Collection Initializers**和**Query Expressions**中使用 var 匿名对象的意图，所以我的意思是......就像上面的例子一样。

你怎么认为？

            回答 #1

赞同：62

时间：2008-10-25T20:58:35.107

除了明显使用`var`LINQ 之外，我还使用它来缩写毛茸茸的变量声明以提高可读性，例如：

```
var d = new Dictionary<string, Dictionary<string, Queue<SomeClass>>>(); 
```

总的来说，我从静态类型中获得了一种安慰（因为需要一个更好的词），这让我不愿意放弃它。我喜欢在声明变量时知道自己在做什么的感觉。声明一个变量不仅仅是告诉编译器一些事情，它是告诉阅读你的代码的人一些事情。

让我给你举个例子。假设我有一个返回`List<string>`. 这段代码当然是正确的，我认为 90% 的 C# 开发人员可能会这样写：

```
List<string> list = MyMethod(); 
```

很明显，对吧？事实上，这是一个您可以轻松使用的地方`var`。

真是的。但是*这个*版本的代码不仅仅是声明一个变量，它告诉我编写它的人打算做什么：

```
IEnumerable<string> list = MyMethod(); 
```

编写该代码的开发人员告诉我“我不会更改此列表，也不会使用索引来访问其成员。我要做的就是遍历它。” 在一行代码中可以获取大量信息。如果您使用`var`.

当然，如果你一开始没有使用它，你就不会放弃它。如果你是那种会编写那行代码的开发人员，你已经知道你不会`var`在那里使用。

**编辑：**  

我刚刚重读了 Jon Skeet 的帖子，Eric Lippert 的这句话让我大吃一惊：

隐式键入的本地人只是一种小方法，您可以通过这种方式不强调如何，从而强调什么。

我认为实际上在很多情况下使用隐式类型会留下隐含的内容。不纠结于什么也没关系。例如，我会随便写一个 LINQ 查询，如：

```
var rows = from DataRow r in parentRow.GetChildRows(myRelation)
           where r.Field<bool>("Flag")
           orderby r.Field<int>("SortKey")
           select r; 
```

当我阅读该代码时，我在阅读它时想到的一件事是“`rows`是一个`IEnumerable<DataRow>`.”。因为我知道 LINQ 查询返回的是`IEnumerable<T>`，并且我可以在此处看到正在选择的对象的类型。

这是一个*没有*明确说明的情况。留给我去推断。

现在，在我使用 LINQ 的大约 90% 的情况下，这一点都不重要。因为 90% 的时间，下一行代码是：

```
foreach (DataRow r in rows) 
```

但是不难想象在其中声明`rows`为非常有用的`IEnumerable<DataRow>`代码 - 查询许多不同类型的对象的代码，将查询声明放在迭代旁边是不可行的，它会是能够`rows`使用 IntelliSense 进行检查很有用。那是什么，而不是如何。

            回答 #2

赞同：43

时间：2008-10-25T19:25:47.727

你会在这个问题上得到各种各样的意见——从“到处使用 var”到“只使用匿名类型的 var，你基本上必须这样做”。我喜欢[Eric Lippert 的看法](http://csharpindepth.com/ViewNote.aspx?NoteID=61)：

所有的代码都是抽象的。代码“真正”在做什么是在操纵数据？不，数字？位？不，电压？不，电子？是的，但是在电子级别理解代码是个坏主意！编码的艺术是弄清楚对观众来说正确的抽象级别是什么。

在高级语言中，代码做什么（语义上）和代码如何完成它之间总是存在这种张力。如果要成功进行更改，维护程序员需要了解内容和方式。

LINQ 的全部意义在于它大大地淡化了“如何”并大量强调了“什么”。通过使用查询理解，程序员对未来的听众说“我相信你不应该知道也不应该关心这个结果集是如何计算的，但你应该非常关心结果集的语义是什么。” 它们使代码更接近正在实现的业务流程，而远离实现它的比特和电子。

隐式键入的本地人只是一种小方法，您可以通过这种方式不强调如何，从而强调什么。在特定情况下这是否是正确的做法是一个判断电话。所以我告诉人们，如果类型的知识是相关的，并且它的选择对于方法的持续运行至关重要，那么不要使用隐式类型。显式输入说“我告诉你这是有原因的，请注意”。隐式类型表示“这个东西是 List 还是 Customer[] 并不重要，重要的是它是一个客户的集合。”

如果类型不是相当明显，我个人不*倾向于使用它 - 我将 LINQ 查询包括为“相当明显”。*例如，我不会这样做，因为返回 a而不是（比如说） a （或完全是其他东西）`Directory.GetFiles`并不是很明显- 这对你以后做的事情有很大的影响。`string[]``FileInfo[]`

如果在赋值运算符的右侧有一个构造函数调用，我更有可能使用`var`: 很明显类型是什么。这对于复杂的泛型类型特别方便，例如`Dictionary<string,List<int>>`.

            回答 #3

赞同：12

时间：2008-10-25T19:30:53.723

就我个人而言，我只在两个地方使用 var：

1.  使用匿名类型，即。LINQ 相关（在某些情况下需要 var）
2.  当语句声明并构造相同类型的特定类型时

IE。这是第 2 点的示例：

```
var names = new List<String>(); 
```

**编辑**：这是为了回应 Jon Skeet 的问题。

上面的答案实际上被简化了。基本上，我使用*var*类型为：

1.  没必要知道（虽然不是很多地方）
2.  不可能知道（LINQ，匿名类型）
3.  否则已知，或从代码中清除

在工厂方法的情况下，您在编写代码的地方只需要知道您返回的对象是某种类型的后代，并且*某种类型*具有静态工厂方法，那么我会使用*变量*。像这样：

```
var connection = DatabaseConnection.CreateFromConnectionString("..."); 
```

上面的例子是我的代码中的一个真实例子。很明显，至少对我和使用此代码的人来说，该*连接*是 DatabaseConnection 的后代，但既不需要理解代码也不需要使用它的确切类型。

            回答 #4

赞同：9

时间：2008-10-25T19:41:45.213

我尝试了“到处使用 var”的风格……这就是我没有继续使用它的原因。

1.  有时会降低可读性
2.  在 = 之后限制 Intellisense
3.  键入“var”实际上并不比键入“int”、“string”等短很多，尤其是使用智能感知。

话虽如此，我仍然将它与 LINQ 一起使用。

            回答 #5

赞同：4

时间：2008-10-26T04:21:12.873

来自函数式编程领域，类型推断占主导地位，我`var`尽可能为所有本地人使用。

在 Visual Studio 中，如果您想知道任何 local 的类型是什么，您所要做的就是将鼠标悬停在它上面。

            回答 #6

赞同：3

时间：2008-10-25T20:15:41.837

这篇[文章](http://community.bartdesmet.net/blogs/bart/archive/2008/08/23/appropriate-use-of-local-variable-type-inference.aspx)对何时使用 var 类型接口或对象类型有一些很好的指导。

            回答 #7

赞同：3

时间：2008-12-13T16:41:04.790

我倾向于在`var`任何地方使用，但我的同事说停止，它对我们来说不太可读。所以我现在`var`只使用匿名类型、LINQ 查询以及右侧的构造函数在哪里。

            回答 #8

赞同：1

时间：2008-10-25T21:46:39.893

我认为注意到 Haskell 通常如何处理这很有趣。由于[Curry-Howard 同构](http://en.wikipedia.org/wiki/Curry-Howard_correspondence)，可以推断 Haskell 中任何表达式的（最一般的）类型，因此基本上不需要类型声明，除了少数例外；例如，有时您有意将类型限制为比推断出的更具体的内容。

当然，需要什么和推荐什么不是一回事；在实践中，约定似乎是顶级定义始终具有类型声明，而本地化定义则省略了类型声明。这似乎在整个定义的明确性和可读性之间取得了很好的平衡，与本地“帮助”或“临时”定义的简洁性形成对比。如果我理解正确，首先你不能使用`var`“顶级”定义（如方法或全局函数），所以我猜这`var`在 C# 世界中转化为“在任何地方都可以使用”。当然，键入“ `int`”与“ ”的击键次数相同`var`，但大多数示例会比这更长。

        php - 是否有 PHP 的标识库

ID：236879

赞同：3

时间：2008-10-25T19:21:54.363

标签：php, identicon

我正在寻找可以创建[Identicon](http://en.wikipedia.org/wiki/Identicon)的 PHP 库/函数/类。

            回答 #1

赞同：11

时间：2008-10-25T22:42:13.320

我用这个：

```
class Gravatar
{
    static public function GetGravatarUrl( $email, $size = 128, $type = 'identicon', $rating = 'pg' )
    {
        $gravatar = sprintf( 'http://www.gravatar.com/avatar/%s?d=%s&s=%d&r=%s',
                              md5( $email ), $type, $size, $rating );
        return $gravatar;
    }
} 
```

这与 SO 使用的基本相同。它支持[gravatar.com](http://en.gravatar.com/site/implement)支持的所有内容。

            回答 #2

赞同：3

时间：2008-10-25T19:24:46.637

[这个](http://scott.sherrillmix.com/blog/blogger/wp_identicon/)怎么样

这就是 Scott 为 Wordpress 制作标识符的方式，您可以下载代码并亲自查看。

希望能帮助到你。

            回答 #3

赞同：2

时间：2009-08-01T04:12:10.953

[Sourceforge](http://sourceforge.net/projects/identicons)有一个 PHP 标识符实现

            回答 #4

赞同：1

时间：2008-10-25T19:29:47.843

[PHPClasses](http://www.phpclasses.org/)没有任何东西——但你可以看看这个[MonsterID](http://www.splitbrain.org/blog/2007-01/20_monsterid_as_gravatar_fallback)实现。

            回答 #5

赞同：0

时间：2008-10-25T20:41:36.107

嗯，我想知道你为什么问，因为你链接到维基百科文章，它指向很多实现，包括 PHP 的。顺便说一句，谢谢你的问题，我不知道这些图标的名字......

但是经过一番探索，我发现很多链接都已经过时了... 继[Visiglyphs](http://digitalconsumption.com/forum/Visiglyphs-for-IP-visualisation "象形文字")之后，原始代码不再可用，但作者指出了一个替代方案，可以下载的 OO 版本。:-)

请注意，作者还写了一篇有趣的补充文章：[如何创建 Visiglyph 缓存](http://digitalconsumption.com/forum/Howto-create-a-Visiglyph-cache "如何创建 Visiglyph 缓存")。

        algorithm - 友谊关系追踪算法

ID：236881

赞同：2

时间：2008-10-25T19:23:01.477

标签：algorithm, social-networking

我正在考虑一个应用程序，它试图用一组属于社交网络的用户来证明“[六度分离”理论。](http://en.wikipedia.org/wiki/Six_degrees_of_separation)

我会有这些元素：

1.  我想证明六度理论的几个用户
2.  对于每个用户，我都知道社交网络中的好友列表

哪个是查看两个用户是否连接、连接程度以及显示连接中最终步骤的最佳算法？

            回答 #1

赞同：4

时间：2008-10-25T19:38:17.420

求社交网络中两个人之间的分离程度只是求图中两点之间最短路径的一个特例。最常见的方法是[Dijkstra 算法](http://en.wikipedia.org/wiki/Dijkstra%27s_algorithm)，但另请参阅对[最短路径问题](http://en.wikipedia.org/wiki/Shortest_path_problem)的更长讨论。

此外，通过运行 All-pairs 最短路径算法，您可以找出整个网络的最小、最大和平均分离度数。

            回答 #2

赞同：3

时间：2008-10-25T19:33:14.013

一些额外的背景材料：

要普遍解决此问题，您需要避免网络抓取和其他特定于某个社交网络的临时技术。相反，您可能希望查看[XHTML Friends Network (XFN)](http://gmpg.org/xfn/)   ，这是一种使用超链接的 rel="" 属性来指示该超链接的目标与您之间的关系的方法。还有一个名为[FOAF](http://www.foaf-project.org/)的竞争标准，它使用[RDF](http://www.w3.org/RDF/)。

这些[微格式](http://www.microformats.org)已经存在了一段时间，但是最近对它们的支持有了很大的增长。StackOverflow 在您的个人资料页面的链接中使用“我”。WordPress 博客在编辑界面中为 blogroll 添加这些标签提供了一种简单的方法。许多社交网站在朋友之间的链接中使用这些来表示关系。

正因为如此，谷歌对此产生了兴趣，并开始挖掘这些数据。他们有一个[社交图谱 API](http://code.google.com/apis/socialgraph/)，可以挖掘 XFN 和 FOAF 数据来做一些你想做的事情。我建议你从那里开始。谷歌 API 的好处是因为他们在整个网络上挖掘这个，你可以扩大你的搜索范围，超出你所想的特定社交网络。

        java - 是否存在 Java 1.5 API 的打印版本？

ID：236892

赞同：2

时间：2008-10-25T19:27:42.637

标签：java, api

Java >= 1.5 API 的打印版本是否存在？我在哪里可以在线购买？最好在加拿大，但只是一个标题就很棒。

            回答 #1

赞同：6

时间：2008-10-25T19:52:32.930

O'Reilly[的 Java 简述](http://www.amazon.co.uk/gp/reader/0596007736/ref=sib_dp_pt/026-8599590-2045232#reader-link)

            回答 #2

赞同：0

时间：2008-10-26T18:41:21.763

[您可以从这里](http://java.sun.com/javase/downloads/?intcmp=1281 "这里")下载整个 api 文档作为静态网站。当我远离互联网连接时，我经常使用它。

        php - php: open_basedir 和 /dev/urandom

ID：236896

赞同：2

时间：2008-10-25T19:28:32.980

标签：php, open-basedir

在某些情况下调用[Pear Mail 类](http://pear.php.net/package/Mail/)会自动尝试读取`/dev/urandom`，但是由于`open_basedir`设置限制了访问。添加`/dev`到 中是否安全`open_basedir`？或者有没有更好的方法来解决这个问题？

            回答 #1

赞同：1

时间：2008-10-25T20:35:11.223

你相信每个将为你的服务器编写 PHP 的人吗？如果没有，那么将 /dev 添加到 open_basedir 可能是个坏主意。

至于为什么，我能想到的为什么需要随机数的唯一原因是，如果您尝试启动与 SMTP 服务器的 SSL 连接。您是否尝试使用 SSL？

            回答 #2

赞同：1

时间：2019-02-05T16:52:36.783

实证测试（在 PHP 7.1.18 中）表明您可以添加`/dev/urandom`to`open_basedir`以仅允许访问该“设备”（前提是没有尾随斜杠，即没有`/dev/urandom/`）。更一般地，您可以允许访问目录中的特定文件，而不允许访问目录本身、其中的其他文件或子目录。

我不知道在提出问题时 PHP 中是否存在此（显然未记录的）功能。

        xna - 如何为 Xbox 创建自定义 DVD 播放器？

ID：236923

赞同：1

时间：2008-10-25T19:42:30.360

标签：xna, xbox360, dvd

我想创建一个在 XBox 360 上运行的应用程序（使用 XBox Live 下载），它将播放托盘中的 DVD 电影。我知道 XBox 已经具备这种能力，但我希望我的定制 DVD 播放器允许用户为他们真正喜欢的电影部分保存书签，然后在他们放回 DVD 时浏览他们的书签。这听起来可能很傻，但是这是为了我正在进行的一项商业冒险。

我的问题是：

1\. 这可能吗？

2.我可以使用什么平台来制作这个？（XNA？）

3\. 我应该去哪里学习如何做？

我是一位非常有经验的 .NET 开发人员，但我还不是媒体或游戏编程方面的专家。谢谢！

            回答 #1

赞同：3

时间：2008-10-26T04:01:21.070

您需要与 Microsoft 达成正式协议，因为 XNA Community Games 是唯一可以通过 Xbox Live 下载的自制应用程序，并且没有用于访问 360 的 DVD 播放功能的公共 API。

        excel - 如何以编程方式连接 Excel 电子表格？

ID：236926

赞同：4

时间：2008-10-25T19:45:11.650

标签：excel, interface

[我有一个使用Excel 作为数据库](http://www.neopoleon.com/home/blogs/neo/archive/2003/09/29/5458.aspx)并希望通过真实数据库对 Excel 数据进行一些工作的组织请求一些合同工作。（是的，我知道，没关系……）

客户有一个 Excel 表，他们在内部使用它来跟踪一些政府计划。此 Excel 表中的数据过去通过 CSV 作为中间格式手动导入 SQL 数据库，并通过一个小型 Web 应用程序提供。电子表格或数据库中的更改都是手动完成的（由不同的人），并且必须手动保持同步。

新功能的规范包括：

*   将 Excel 文件上传到 Web 应用程序
*   通过网络应用程序进行微小的更改（当然，这一点很简单）
*   偶尔将数据导出回 Excel

电子表格（实际上，它是工作簿中的几个）实施了与其他机构交互所必需的一些准则，因此在导入之前和之后必须在结构上保持相同。它包含大量格式设置、隐藏列和排序按钮，以及不同工作表中单元格之间的大量数据链接。

我不想从头开始复制电子表格来提供导出，也不想在导入之前手动将正确的列提取到 CSV 中。我宁愿寻找一种方法来加载 Excel，“查询”某些字段，将它们写入数据库，然后从数据库中加载数据并仅操作正确单元格的内容。

有没有办法以编程方式与现有电子表格进行交互，并且只读取或更改您需要的位？

            回答 #1

赞同：10

时间：2008-10-25T20:05:50.390

Excel 是一个“支持 COM 的应用程序”，因此您可以使用 COM 访问和操作 Excel 文档中的数据。你没有说你正在使用什么平台 - 但如果它是 .NET 那么它真的很容易。有关如何开始使用 C#，请参阅[http://support.microsoft.com/kb/302084 。](http://support.microsoft.com/kb/302084)

如果您不使用 .net，那么任何可以与 COM 组件交互的语言都可以使用。

            回答 #2

赞同：4

时间：2008-10-25T20:54:39.420

VBA 使用的相同 API 可通过外部 COM 接口使用。有[很多](http://www.amazon.com/s/ref=nb_ss_gw?url=search-alias%3Daps&field-keywords=excel+programming&x=0&y=0)关于这个主题的书。我推荐Steven Roman的[O'Reilly ，但您的口味可能会有所不同。](https://rads.stackoverflow.com/amzn/click/com/0596003595)

            回答 #3

赞同：3

时间：2008-10-29T20:07:53.350

您没有指定语言，因此如果您不了解语言，.Net 会为您提供一些非常强大的数据处理类：

打开 csv 文件：

导入 System.Data.OleDb，导入 Excel = Microsoft.Office.Interop.Excel

```
 Dim ConnectionString As String = "Provider=Microsoft.Jet.OLEDB.4.0;Data Source=" + DataFolder + "\;Extended Properties='text;HDR=Yes'"

    Dim conn As New System.Data.OleDb.OleDbConnection(ConnectionString)
    conn.Open()

    Dim CommandText As String = CommandText = "select * from [" + CSVFileName + "]"
    If Filter.Length > 0 Then
        CommandText += " WHERE " + Filter
    End If

    Dim daAsset As New OleDbDataAdapter(CommandText, conn)
    Dim dsAsset As New DataSet
    daAsset.Fill(dsAsset, "Asset") 
```

在工作簿中打开工作表非常相似 - 您指定工作表名称，然后可以用整个工作表填充 DataSet - 然后您可以访问 DataSet 的 Tables().Rows() 以获取每一行和字段，迭代每行等

            回答 #4

赞同：2

时间：2008-10-25T20:17:10.010

我们正在通过[Apache POI](http://poi.apache.org/)读取和操作 Excel-Data ，这在解码 Excel 文件时并不完整（即不完全支持公式单元格），但我们的客户对我们非常满意。

POI 是一个 Java 库，所以如果你是一个纯 Windows 商店，可能还有其他更自然的选择，但正如我所说，我们对 POI 的体验非常好，人们很高兴。

另外：我相信听说过 Excel ODBC 驱动程序 - 也许这就是您想要/需要的？（对不起，我从来没有和他们合作过）

            回答 #5

赞同：1

时间：2008-10-25T19:59:03.853

您可能对 Excel 2007[协作功能](http://office.microsoft.com/en-us/excel/HA100738731033.aspx#Collaboration)（如从网络编辑 xls）感兴趣。

            回答 #6

赞同：1

时间：2009-05-08T19:13:08.713

另一种方法是编写一个直接与数据库对话并将结果作为数组返回的 excel 函数。

如果您认为这种方法效果很好，您可以尝试[XLLoop](http://xlloop.sourceforge.net/ "XLloop") - 这使您可以轻松地用 Java、Python、Ruby、Perl、R、Lisp、Erlang 编写 excel 函数。

        algorithm - 如何为饼图选择调色板？

ID：236936

赞同：56

时间：2008-10-25T19:53:09.137

标签：algorithm, colors, rgb

我有一些生成饼图图像的代码。这是一个通用类，因此可以给出任意数量的切片作为输入。现在我很难为切片挑选好的颜色。有没有一些擅长的算法？
颜色需要遵循一些规则：

*   他们需要看起来不错
*   相邻的颜色不应该相似（绿色旁边的蓝色是不行的）
*   饼图背景颜色为白色，因此无法选择白色

一些使用 RGB 值进行操作的算法将是首选解决方案。

            回答 #1

赞同：69

时间：2011-04-13T15:23:25.053

我解决了如下：

1.  选择**基色**。
2.  计算其**色调**( `baseHue`)。
3.  创建具有相同饱和度和亮度的颜色，其色调计算如下：

    ```
      色调 = baseHue + ((240 / 件) * 件 % 240

    ```

在 C# 中：

```
int n = 12;

Color baseColor = System.Drawing.ColorTranslator.FromHtml("#8A56E2");
double baseHue = (new HSLColor(baseColor)).Hue;

List<Color> colors = new List<Color>();
colors.Add(baseColor);

double step = (240.0 / (double)n);

for (int i = 1; i < n; ++i)
{
    HSLColor nextColor = new HSLColor(baseColor);
    nextColor.Hue = (baseHue + step * ((double)i)) % 240.0;
    colors.Add((Color)nextColor);
}

string colors = string.Join(",", colors.Select(e => e.Name.Substring(2)).ToArray()); 
```

我使用了[HSLColor 类](http://richnewman.wordpress.com/hslcolor-class/)。

使用 12 块和 #8A56E2 基色的[Google Charts 示例：](http://chart.apis.google.com/chart?chs=400x225&cht=p&chco=8a56e2,cf56e2,e256ae,e25668,e28956,e2cf56,aee256,68e256,56e289,56e2cf,56aee2,5668e2&chd=t:10,10,10,10,10,10,10,10,10,10,10,10)

![图表示例](https://i.stack.imgur.com/DWsLK.png)

            回答 #2

赞同：17

时间：2008-10-25T19:57:31.720

我会预先编译一个大约 20 种颜色的列表，然后开始用*第二种*颜色重复。这样你就不会违反第二条规则。此外，如果有人制作超过 20 个切片的饼图，他们的问题就会更大。:)

            回答 #3

赞同：12

时间：2008-10-25T20:45:08.550

看看[Color Brewer](http://colorbrewer.org)，这是一个帮助定义配色方案以传达定性或定量信息的工具：地图、图表等。在此工具可以生成的三种“类型”调色板中 - 顺序、定性和发散 -你可能需要后者，发散...

您甚至可以下载所有调色板的 RGB 定义的 Excel 文件。

            回答 #4

赞同：10

时间：2013-10-15T19:30:23.043

在[此解决方案](https://stackoverflow.com/a/5651670/59087)的基础上解决问题的规则 #2，以下算法在饼图的中点周围交换颜色。两个参数：

1.  **pNbColors**是饼图中的切片数
2.  **pNonAdjacentSimilarColor**一个布尔值，表示您是否想要相邻的相似颜色。

我正在使用**ColorHSL**、**ColorRGB**和**ColorUtils**（如下提供）。

```
public static function ColorArrayGenerator(
    pNbColors:int,
    pNonAdjacentSimilarColor:Boolean = false):Array
{       
    var colors:Array = new Array();
    var baseRGB:ColorRGB = new ColorRGB();
    baseRGB.setRGBFromUint(0x8A56E2);

    var baseHSL:ColorHSL = new ColorHSL();
    rgbToHsl(baseHSL, baseRGB);

    var currentHue:Number = baseHSL.Hue;

    colors.push(baseRGB.getUintFromRGB());

    var step:Number = (360.0 / pNbColors);
    var nextHSL:ColorHSL;
    var nextRGB:ColorRGB;
    var i:int;

    for (i = 1; i < pNbColors; i++)
    {
        currentHue += step;
        if (currentHue > 360)
        {
            currentHue -= 360;
        }

        nextHSL = new ColorHSL(currentHue, baseHSL.Saturation, aseHSL.Luminance);
        nextRGB = new ColorRGB();
        hslToRgb(nextRGB, nextHSL);

        colors.push(nextRGB.getUintFromRGB());
    }

    if (pNonAdjacentSimilarColor == true &&
        pNbColors > 2)
    {
        var holder:uint = 0;
        var j:int;

        for (i = 0, j = pNbColors / 2; i < pNbColors / 2; i += 2, j += 2)
        {
            holder = colors[i];
            colors[i] = colors[j];
            colors[j] = holder;
        }
    }

    return colors;
} 
```

这会产生右侧的输出：

![比较图像](https://i.stack.imgur.com/lCuiy.png)

ColorHSL 类：

```
 final public class ColorHSL
{
    private var _hue:Number;    // 0.0 .. 359.99999

    private var _sat:Number;    // 0.0 .. 100.0

    private var _lum:Number;    // 0.0 .. 100.0

    public function ColorHSL(
        hue:Number = 0,
        sat:Number = 0,
        lum:Number = 0)
    {
        _hue = hue;
        _sat = sat;
        _lum = lum;
    }

    [Bindable]public function get Hue():Number
    {
        return _hue;
    }

    public function set Hue(value:Number):void
    {
        if (value > 360) 
        {
            _hue = value % 360;
        }    // remember, hue is modulo 360
        else if (value < 0)
        {
            _hue = 0;
        }
        else
        {
            _hue = value;
        }
    }

    [Bindable]public function get Saturation():Number
    {
        return _sat;
    }

    public function set Saturation(value:Number):void
    {
        if (value > 100.0)
        {
            _sat = 100.0;
        }
        else if (value < 0)
        {
            _sat = 0;
        }
        else
        {
            _sat = value;
        }
    }

    [Bindable]public function get Luminance():Number
    {
        return _lum;
    }

    public function set Luminance(value:Number):void
    {
        if (value > 100.0)
        {
            _lum = 100.0;
        }
        else if (value < 0)
        {
            _lum = 0;
        }
        else
        {
            _lum = value;
        }
    }
} 
```

颜色RGB类：

```
 final public class ColorRGB
{
    private var _red:uint;
    private var _grn:uint;
    private var _blu:uint;
    private var _rgb:uint;        // composite form: 0xRRGGBB or #RRGGBB

    public function ColorRGB(red:uint = 0, grn:uint = 0, blu:uint = 0)
    {
        setRGB(red, grn, blu);
    }

    [Bindable]public function get red():uint
    {
        return _red;
    }

    public function set red(value:uint):void
    {
        _red = (value & 0xFF);
        updateRGB();
    }

    [Bindable]public function get grn():uint
    {
        return _grn;
    }

    public function set grn(value:uint):void
    {
        _grn = (value & 0xFF);
        updateRGB();
    }

    [Bindable]public function get blu():uint
    {
        return _blu;
    }

    public function set blu(value:uint):void
    {
        _blu = (value & 0xFF);
        updateRGB();
    }

    [Bindable]public function get rgb():uint
    {
        return _rgb;
    }

    public function set rgb(value:uint):void
    {
        _rgb = value;
        _red = (value >> 16) & 0xFF;
        _grn = (value >>  8) & 0xFF;
        _blu =  value        & 0xFF;
    }

    public function setRGB(red:uint, grn:uint, blu:uint):void
    {
        this.red = red;
        this.grn = grn;
        this.blu = blu;
    }

    public function setRGBFromUint(pValue:uint):void
    {
        setRGB((( pValue >> 16 ) & 0xFF ), ( (pValue >> 8) & 0xFF ), ( pValue & 0xFF ));
    }

    public function getUintFromRGB():uint
    {
        return ( ( red << 16 ) | ( grn << 8 ) | blu );
    }

    private function updateRGB():void
    {
        _rgb = (_red << 16) + (_grn << 8) + blu;
    }
} 
```

ColorUtils 类：

```
final public class ColorUtils
{
    public static function HSV2RGB(hue:Number, sat:Number, val:Number):uint
    {
        var red:Number = 0;
        var grn:Number = 0;
        var blu:Number = 0;
        var i:Number;
        var f:Number;
        var p:Number;
        var q:Number;
        var t:Number;
        hue%=360;
        sat/=100;
        val/=100;
        hue/=60;
        i = Math.floor(hue);
        f = hue-i;
        p = val*(1-sat);
        q = val*(1-(sat*f));
        t = val*(1-(sat*(1-f)));
        if (i==0)
        {
            red=val;
            grn=t;
            blu=p;
        }
        else if (i==1)
        {
            red=q;
            grn=val;
            blu=p;
        }
        else if (i==2)
        {
            red=p;
            grn=val;
            blu=t;
        }
        else if (i==3)
        {
            red=p;
            grn=q;
            blu=val;
        }
        else if (i==4)
        {
            red=t;
            grn=p;
            blu=val;
        }
        else if (i==5)
        {
            red=val;
            grn=p;
            blu=q;
        }
        red = Math.floor(red*255);
        grn = Math.floor(grn*255);
        blu = Math.floor(blu*255);

        return (red<<16) | (grn << 8) | (blu);
    }

    //
    public static function RGB2HSV(pColor:uint):Object
    {
        var red:uint = (pColor >> 16) & 0xff;
        var grn:uint = (pColor >> 8) & 0xff;
        var blu:uint = pColor & 0xff;

        var x:Number;
        var val:Number;
        var f:Number;
        var i:Number;
        var hue:Number;
        var sat:Number;
        red/=255;
        grn/=255;
        blu/=255;
        x = Math.min(Math.min(red, grn), blu);
        val = Math.max(Math.max(red, grn), blu);
        if (x==val){
            return({h:undefined, s:0, v:val*100});
        }
        f = (red == x) ? grn-blu : ((grn == x) ? blu-red : red-grn);
        i = (red == x) ? 3 : ((grn == x) ? 5 : 1);
        hue = Math.floor((i-f/(val-x))*60)%360;
        sat = Math.floor(((val-x)/val)*100);
        val = Math.floor(val*100);
        return({h:hue, s:sat, v:val});
    }

    /**
     * Generates an array of pNbColors colors (uint) 
     * The colors are generated to fill a pie chart (meaning that they circle back to the starting color)
     * @param pNbColors The number of colors to generate (ex: Number of slices in the pie chart)
     * @param pNonAdjacentSimilarColor Should the colors stay Adjacent or not ?
     */
    public static function ColorArrayGenerator(
        pNbColors:int,
        pNonAdjacentSimilarColor:Boolean = false):Array
    {
        // Based on http://www.flexspectrum.com/?p=10

        var colors:Array = [];
        var baseRGB:ColorRGB = new ColorRGB();
        baseRGB.setRGBFromUint(0x8A56E2);

        var baseHSL:ColorHSL = new ColorHSL();
        rgbToHsl(baseHSL, baseRGB);

        var currentHue:Number = baseHSL.Hue;

        colors.push(baseRGB.getUintFromRGB());

        var step:Number = (360.0 / pNbColors);
        var nextHSL:ColorHSL;
        var nextRGB:ColorRGB;
        var i:int;

        for (i = 1; i < pNbColors; i++)
        {
            currentHue += step;

            if (currentHue > 360)
            {
                currentHue -= 360;
            }

            nextHSL = new ColorHSL(currentHue, baseHSL.Saturation, baseHSL.Luminance);
            nextRGB = new ColorRGB();
            hslToRgb(nextRGB, nextHSL);

            colors.push(nextRGB.getUintFromRGB());
        }

        if (pNonAdjacentSimilarColor == true &&
            pNbColors > 2)
        {
            var holder:uint = 0;
            var j:int;

            for (i = 0, j = pNbColors / 2; i < pNbColors / 2; i += 2, j += 2)
            {
                holder = colors[i];
                colors[i] = colors[j];
                colors[j] = holder;
            }
        }

        return colors;
    }

    static public function rgbToHsl(hsl:ColorHSL, rgb:ColorRGB):void
    {
        var h:Number = 0;
        var s:Number = 0;
        var l:Number = 0;

        // Normalizes incoming RGB values.
        //
        var dRed:Number = (Number)(rgb.red / 255.0);
        var dGrn:Number = (Number)(rgb.grn / 255.0);
        var dBlu:Number = (Number)(rgb.blu / 255.0);

        var dMax:Number = Math.max(dRed, Math.max(dGrn, dBlu));
        var dMin:Number = Math.min(dRed, Math.min(dGrn, dBlu));

        //-------------------------
        // hue
        //
        if (dMax == dMin)
        {
            h = 0;                 // undefined
        }
        else if (dMax == dRed && dGrn >= dBlu)
        {
            h = 60.0 * (dGrn - dBlu) / (dMax - dMin);
        }
        else if (dMax == dRed && dGrn < dBlu)
        {
            h = 60.0 * (dGrn - dBlu) / (dMax - dMin) + 360.0;
        }
        else if (dMax == dGrn)
        {
            h = 60.0 * (dBlu - dRed) / (dMax-dMin) + 120.0;
        }
        else if (dMax == dBlu)
        {
            h = 60.0 * (dRed - dGrn) / (dMax - dMin) + 240.0;
        }

        //-------------------------
        // luminance
        //
        l = (dMax + dMin) / 2.0;

        //-------------------------
        // saturation
        //
        if (l == 0 || dMax == dMin)
        {
            s = 0;
        }
        else if (0 < l && l <= 0.5)
        {
            s = (dMax - dMin) / (dMax + dMin);
        }
        else if (l>0.5)
        {
            s = (dMax - dMin) / (2 - (dMax + dMin));    //(dMax-dMin > 0)?
        }

        hsl.Hue = h;
        hsl.Luminance = l;
        hsl.Saturation = s;

    } // rgbToHsl

    //---------------------------------------
    // Convert the input RGB values to the corresponding HSL values.
    //
    static public function hslToRgb(rgb:ColorRGB, hsl:ColorHSL):void
    {
        if (hsl.Saturation == 0)
        {
            // Achromatic color case, luminance only.
            //
            var lumScaled:int = (int)(hsl.Luminance * 255.0); 
            rgb.setRGB(lumScaled, lumScaled, lumScaled);
            return;
        }

        // Chromatic case...
        //
        var dQ:Number = (hsl.Luminance < 0.5) ? (hsl.Luminance * (1.0 + hsl.Saturation)): ((hsl.Luminance + hsl.Saturation) - (hsl.Luminance * hsl.Saturation));
        var dP:Number = (2.0 * hsl.Luminance) - dQ;

        var dHueAng:Number = hsl.Hue / 360.0;

        var dFactor:Number = 1.0 / 3.0;

        var adT:Array = [];

        adT[0] = dHueAng + dFactor;                // Tr
        adT[1] = dHueAng;                        // Tg
        adT[2] = dHueAng - dFactor;                // Tb

        for (var i:int = 0; i < 3; i++)
        {
            if (adT[i] < 0)
            {
                adT[i] += 1.0;
            }

            if (adT[i] > 1)
            {
                adT[i] -= 1.0;
            }

            if ((adT[i] * 6) < 1)
            {
                adT[i] = dP + ((dQ - dP) * 6.0 * adT[i]);
            }
            else if ((adT[i] * 2.0) < 1)        // (1.0 / 6.0) <= adT[i] && adT[i] < 0.5
            {
                adT[i] = dQ;
            }
            else if ((adT[i] * 3.0) < 2)        // 0.5 <= adT[i] && adT[i] < (2.0 / 3.0)
            {
                adT[i] = dP + (dQ-dP) * ((2.0/3.0) - adT[i]) * 6.0;
            }
            else
            {
                adT[i] = dP;
            }
        }

        rgb.setRGB(adT[0] * 255.0, adT[1] * 255.0, adT[2] * 255.0);

    } // hslToRgb

    //---------------------------------------
    // Adjust the luminance value by the specified factor.
    //
    static public function adjustRgbLuminance(rgb:ColorRGB, factor:Number):void
    {
        var hsl:ColorHSL = new ColorHSL();

        rgbToHsl(hsl, rgb);

        hsl.Luminance *= factor;

        if (hsl.Luminance < 0.0)
        {
            hsl.Luminance = 0.0;
        }

        if (hsl.Luminance > 1.0)
        {
            hsl.Luminance = 1.0;
        }

        hslToRgb(rgb, hsl);
    }

    //---------------------------------------
    //
    static public function uintTo2DigitHex(value:uint):String
    {
        var str:String = value.toString(16).toUpperCase();

        if (1 == str.length)
        {
            str = "0" + str;
        }

        return str;
    }

    //---------------------------------------
    //
    static public function uintTo6DigitHex(value:uint):String
    {
        var str:String = value.toString(16).toUpperCase();

        if (1 == str.length)    {return "00000" + str;}
        if (2 == str.length)    {return "0000" + str;}
        if (3 == str.length)    {return "000" + str;}
        if (4 == str.length)    {return "00" + str;}
        if (5 == str.length)    {return "0" + str;}

        return str;
    }
} 
```

            回答 #5

赞同：5

时间：2014-08-25T07:31:18.820

概述

从 RGB 转换为 HSV，然后调整色调（如此处[回答](https://stackoverflow.com/a/5651670/59087)）会产生不一致的感知亮度。黄色/绿色明显比蓝色/紫色浅：

![不一致](https://i.stack.imgur.com/1ONdx.png)

没有这种变化的类似结果是可能的：

![持续的](https://i.stack.imgur.com/sHtyh.png)

算法

然而，该算法要复杂得多：

1.  将 HTML 十六进制代码转换为标称 RGB 值（将分量除以 255）。
2.  将 RGB 值转换为[XYZ 颜色空间](http://www.brucelindbloom.com/index.html?Eqn_RGB_to_XYZ.html)；使用[D65 参考白色](http://www.brucelindbloom.com/index.html?Eqn_RGB_XYZ_Matrix.html)sRGB[工作空间](http://www.brucelindbloom.com/index.html?WorkingSpaceInfo.html)。
3.  从 XYZ 转换为[L *a* b 颜色空间](http://www.brucelindbloom.com/index.html?Eqn_XYZ_to_Lab.html)。
4.  从 L *a* b 转换为[LCH 颜色空间](http://www.brucelindbloom.com/index.html?Eqn_Lab_to_LCH.html)。
5.  计算 LCH 颜色空间中的饼楔色度：

    ```
    (360.0 div $wedges) * $wedge
    ```

6.  以弧度重新计算新色调。
7.  使用新色调从 LCH 转换回[L *a* b 颜色空间。](http://www.brucelindbloom.com/index.html?Eqn_LCH_to_Lab.html)
8.  从 L *a* b 转换为[XYZ 颜色空间](http://www.brucelindbloom.com/index.html?Eqn_Lab_to_XYZ.html)。
9.  从 XYZ 转换为[sRGB 颜色空间](http://www.brucelindbloom.com/index.html?Eqn_RGB_XYZ_Matrix.html)。
10.  将 RGB 值乘以 255。

执行

下面是 XSLT 1.0 中的一个示例实现：

```
<?xml version="1.0"?>
<!--
 | The MIT License
 |
 | Copyright 2014 White Magic Software, Inc.
 | 
 | Permission is hereby granted, free of charge, to any person
 | obtaining a copy of this software and associated documentation
 | files (the "Software"), to deal in the Software without
 | restriction, including without limitation the rights to use,
 | copy, modify, merge, publish, distribute, sublicense, and/or
 | sell copies of the Software, and to permit persons to whom the
 | Software is furnished to do so, subject to the following
 | conditions:
 | 
 | The above copyright notice and this permission notice shall be
 | included in all copies or substantial portions of the Software.
 | 
 | THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 | EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
 | OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 | NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
 | HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
 | WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
 | FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
 | OTHER DEALINGS IN THE SOFTWARE.
 +-->
<xsl:stylesheet version="1.0"
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform">

<!-- Reference white (X, Y, and Z components) -->
<xsl:variable name="X_r" select="0.950456"/>
<xsl:variable name="Y_r" select="1.000000"/>
<xsl:variable name="Z_r" select="1.088754"/>
<xsl:variable name="LAB_EPSILON" select="216.0 div 24389.0"/>
<xsl:variable name="LAB_K" select="24389.0 div 27.0"/>

<!-- Pie wedge colours based on this hue. -->
<xsl:variable name="base_colour" select="'46A5E5'"/>

<!-- Pie wedge stroke colour. -->
<xsl:variable name="stroke_colour" select="'white'"/>

<!--
 | Creates a colour for a particular pie wedge.
 |
 | http://en.wikipedia.org/wiki/HSL_and_HSV 
 +-->
<xsl:template name="fill">
  <!-- Current wedge number for generating a colour. -->
  <xsl:param name="wedge"/>
  <!-- Total number of wedges in the pie. -->
  <xsl:param name="wedges"/>
  <!-- RGB colour in hexadecimal. -->
  <xsl:param name="colour"/>

  <!-- Derive the colour decimal values from $colour's HEX code. -->
  <xsl:variable name="r">
    <xsl:call-template name="hex2dec">
      <xsl:with-param name="hex"
        select="substring( $colour, 1, 2 )"/>
    </xsl:call-template>
  </xsl:variable>
  <xsl:variable name="g">
    <xsl:call-template name="hex2dec">
      <xsl:with-param name="hex"
        select="substring( $colour, 3, 2 )"/>
    </xsl:call-template>
  </xsl:variable>
  <xsl:variable name="b">
    <xsl:call-template name="hex2dec">
      <xsl:with-param name="hex"
        select="substring( $colour, 5, 2 )"/>
    </xsl:call-template>
  </xsl:variable>

  <!--
   | Convert RGB to XYZ, using nominal range for RGB.
   | http://www.brucelindbloom.com/index.html?Eqn_RGB_to_XYZ.html
   +-->
  <xsl:variable name="r_n" select="$r div 255" />
  <xsl:variable name="g_n" select="$g div 255" />
  <xsl:variable name="b_n" select="$b div 255" />

  <!--
   | Assume colours are in sRGB.
   | http://www.brucelindbloom.com/index.html?Eqn_RGB_XYZ_Matrix.html
   -->
  <xsl:variable name="x"
    select=".4124564 * $r_n + .3575761 * $g_n + .1804375 * $b_n"/>
  <xsl:variable name="y"
    select=".2126729 * $r_n + .7151522 * $g_n + .0721750 * $b_n"/>
  <xsl:variable name="z"
    select=".0193339 * $r_n + .1191920 * $g_n + .9503041 * $b_n"/>

  <!--
   | Convert XYZ to L*a*b.
   | http://www.brucelindbloom.com/index.html?Eqn_XYZ_to_Lab.html
   +-->
  <xsl:variable name="if_x">
    <xsl:call-template name="lab_f">
      <xsl:with-param name="xyz_n" select="$x div $X_r"/>
    </xsl:call-template>
  </xsl:variable>
  <xsl:variable name="if_y">
    <xsl:call-template name="lab_f">
      <xsl:with-param name="xyz_n" select="$y div $Y_r"/>
    </xsl:call-template>
  </xsl:variable>
  <xsl:variable name="if_z">
    <xsl:call-template name="lab_f">
      <xsl:with-param name="xyz_n" select="$z div $Z_r"/>
    </xsl:call-template>
  </xsl:variable>

  <xsl:variable name="lab_l" select="(116.0 * $if_y) - 16.0"/>
  <xsl:variable name="lab_a" select="500.0 * ($if_x - $if_y)"/>
  <xsl:variable name="lab_b" select="200.0 * ($if_y - $if_z)"/>

  <!--
   | Convert L*a*b to LCH.
   | http://www.brucelindbloom.com/index.html?Eqn_Lab_to_LCH.html
   +-->
  <xsl:variable name="lch_l" select="$lab_l"/>

  <xsl:variable name="lch_c">
    <xsl:call-template name="sqrt">
      <xsl:with-param name="n" select="($lab_a * $lab_a) + ($lab_b * $lab_b)"/>
    </xsl:call-template>
  </xsl:variable>

  <xsl:variable name="lch_h">
    <xsl:call-template name="atan2">
      <xsl:with-param name="x" select="$lab_b"/>
      <xsl:with-param name="y" select="$lab_a"/>
    </xsl:call-template>
  </xsl:variable>

  <!--
   | Prevent similar adjacent colours.
   | http://math.stackexchange.com/a/936767/7932
   +-->
  <xsl:variable name="wi" select="$wedge"/>
  <xsl:variable name="wt" select="$wedges"/>
  <xsl:variable name="w">
    <xsl:choose>
      <xsl:when test="$wt &gt; 5">
        <xsl:variable name="weven" select="(($wi+4) mod ($wt + $wt mod 2))"/>
        <xsl:value-of
          select="$weven * (1-($wi mod 2)) + ($wi mod 2 * $wi)"/>
      </xsl:when>
      <xsl:otherwise>
        <xsl:value-of select="$wedge"/>
      </xsl:otherwise>
    </xsl:choose>
  </xsl:variable>
  <!-- lch_l, lch_c, and lch_h are now set; rotate the hue. -->
  <xsl:variable name="lch_wedge_h" select="(360.0 div $wedges) * $wedge"/>

  <!--
   | Convert wedge's hue-adjusted LCH to L*a*b.
   | http://www.brucelindbloom.com/index.html?Eqn_LCH_to_Lab.html
   +-->
  <xsl:variable name="lab_sin_h">
    <xsl:call-template name="sine">
      <xsl:with-param name="degrees" select="$lch_wedge_h"/>
    </xsl:call-template>
  </xsl:variable>
  <xsl:variable name="lab_cos_h">
    <xsl:call-template name="cosine">
      <xsl:with-param name="degrees" select="$lch_wedge_h"/>
    </xsl:call-template>
  </xsl:variable>

  <xsl:variable name="final_lab_l" select="$lch_l"/>
  <xsl:variable name="final_lab_a" select="$lch_c * $lab_cos_h"/>
  <xsl:variable name="final_lab_b" select="$lch_c * $lab_sin_h"/>

  <!--
   | Convert L*a*b to XYZ.
   | http://www.brucelindbloom.com/index.html?Eqn_Lab_to_XYZ.html
   +-->
  <xsl:variable name="of_y" select="($final_lab_l + 16.0) div 116.0"/>
  <xsl:variable name="of_x" select="($final_lab_a div 500.0) + $of_y"/>
  <xsl:variable name="of_z" select="$of_y - ($final_lab_b div 200.0)"/>

  <xsl:variable name="of_x_pow">
    <xsl:call-template name="power">
      <xsl:with-param name="base" select="$of_x"/>
      <xsl:with-param name="exponent" select="3"/>
    </xsl:call-template>
  </xsl:variable>
  <xsl:variable name="of_z_pow">
    <xsl:call-template name="power">
      <xsl:with-param name="base" select="$of_z"/>
      <xsl:with-param name="exponent" select="3"/>
    </xsl:call-template>
  </xsl:variable>

  <xsl:variable name="ox_r">
    <xsl:choose>
      <xsl:when test="$of_x_pow &gt; $LAB_EPSILON">
        <xsl:value-of select="$of_x_pow"/>
      </xsl:when>
      <xsl:otherwise>
        <xsl:value-of select="((116.0 * $of_x) - 16.0) div $LAB_K"/>
      </xsl:otherwise>
    </xsl:choose>
  </xsl:variable>
  <xsl:variable name="oy_r">
    <xsl:choose>
      <xsl:when test="$final_lab_l &gt; ($LAB_K * $LAB_EPSILON)">
        <xsl:call-template name="power">
          <xsl:with-param name="base"
            select="($final_lab_l + 16.0) div 116.0"/>
          <xsl:with-param name="exponent"
            select="3"/>
        </xsl:call-template>
      </xsl:when>
      <xsl:otherwise>
        <xsl:value-of select="$final_lab_l div $LAB_K"/>
      </xsl:otherwise>
    </xsl:choose>
  </xsl:variable>
  <xsl:variable name="oz_r">
    <xsl:choose>
      <xsl:when test="$of_z_pow &gt; $LAB_EPSILON">
        <xsl:value-of select="$of_z_pow"/>
      </xsl:when>
      <xsl:otherwise>
        <xsl:value-of select="((116.0 * $of_z) - 16.0) div $LAB_K"/>
      </xsl:otherwise>
    </xsl:choose>
  </xsl:variable>

  <xsl:variable name="X" select="$ox_r * $X_r"/>
  <xsl:variable name="Y" select="$oy_r * $Y_r"/>
  <xsl:variable name="Z" select="$oz_r * $Z_r"/>

  <!--
   | Convert XYZ to sRGB.
   | http://www.brucelindbloom.com/index.html?Eqn_RGB_XYZ_Matrix.html
   +-->
  <xsl:variable name="R"
    select="3.2404542 * $X + -1.5371385 * $Y + -0.4985314 * $Z"/>
  <xsl:variable name="G"
    select="-0.9692660 * $X + 1.8760108 * $Y + 0.0415560 * $Z"/>
  <xsl:variable name="B"
    select="0.0556434 * $X + -0.2040259 * $Y + 1.0572252 * $Z"/>

  <!-- Round the result. -->
  <xsl:variable name="R_r" select="round( $R * 255 )"/>
  <xsl:variable name="G_r" select="round( $G * 255 )"/>
  <xsl:variable name="B_r" select="round( $B * 255 )"/>

  <xsl:text>rgb(</xsl:text>
  <xsl:value-of select="concat( $R_r, ',', $G_r, ',', $B_r )"/>
  <xsl:text>)</xsl:text>
</xsl:template>

<xsl:template name="lab_f">
  <xsl:param name="xyz_n"/>

  <xsl:choose>
    <xsl:when test="$xyz_n &gt; $LAB_EPSILON">
      <xsl:call-template name="nthroot">
        <xsl:with-param name="index" select="3"/>
        <xsl:with-param name="radicand" select="$xyz_n"/>
      </xsl:call-template>
    </xsl:when>
    <xsl:otherwise>
      <xsl:value-of select="($LAB_K * $xyz_n + 16.0) div 116.0" />
    </xsl:otherwise>
  </xsl:choose>
</xsl:template>

<!-- Converts a two-digit hexadecimal number to decimal. -->
<xsl:template name="hex2dec">
  <xsl:param name="hex"/>

  <xsl:variable name="digits" select="'0123456789ABCDEF'"/>
  <xsl:variable name="X" select="substring( $hex, 1, 1 )"/>
  <xsl:variable name="Y" select="substring( $hex, 2, 1 )"/>
  <xsl:variable name="Xval"
    select="string-length(substring-before($digits,$X))"/>
  <xsl:variable name="Yval"
    select="string-length(substring-before($digits,$Y))"/>
  <xsl:value-of select="16 * $Xval + $Yval"/>
</xsl:template>

</xsl:stylesheet> 
```

三角函数、根函数和其他数学函数留给读者作为练习。此外，没有人会想在 XSLT 1.0 中编写所有这些代码。另一方面，XSLT 2.0 在[这里有一个实现](https://bitbucket.org/djarvis/world-politics/src/master/source/xsl/chart.xsl)。

资源

进一步阅读：

*   [使用直观的参数生成调色板](https://pdfs.semanticscholar.org/0977/49c130c1cf35b8b9c236916de3b0455ffce0.pdf)
*   [调色板的合成](http://alexandria.tue.nl/extra1/afstversl/wsk-i/wijffelaars2008.pdf)
*   [有用的颜色方程](http://www.brucelindbloom.com/index.html?Equations.html)
*   [色彩空间简介](http://www.colourphil.co.uk/lab_lch_colour_space.shtml)
*   [在感知一致的空间中均匀分布颜色](http://tools.medialab.sciences-po.fr/iwanthue/theory.php)
*   [一种选择高对比度颜色集的算法](http://www.researchgate.net/publication/230497323_An_algorithm_for_the_selection_of_highcontrast_color_sets)
*   [为统计图形选择颜色](http://epub.wu.ac.at/1692/1/document.pdf)
*   [色彩空间转换](http://paulbourke.net/texture_colour/colourspace/)
*   [布鲁尔调色板](http://mkweb.bcgsc.ca/brewer/)

            回答 #6

赞同：4

时间：2012-06-21T17:09:59.227

这篇 1985 年由“ROSS E. ROLEY, CAPT”撰写的论文给出了一种算法，用于最大化任意颜色集的颜色分离（[包含 FORTRAN 中的代码](http://www.dtic.mil/dtic/tr/fulltext/u2/a272919.pdf)）。

（颜色分离似乎是军队防止蓝对蓝事件的重要可视化问题。）

但是，如果您想坚持一组 20 种颜色，一个快速简单的解决方案是选择十二面体的顶点并将 (x,y,z) 坐标（适当缩放）转换为 (r,g,乙）。

            回答 #7

赞同：2

时间：2008-10-25T20:42:36.590

[这里](http://colorschemedesigner.com/)有一个发电机。它适用于网页设计，但颜色在饼图上看起来也很棒。

你可以预先编译一个漂亮的颜色列表，或者检查生成器背后的逻辑并自己做类似的事情。

            回答 #8

赞同：1

时间：2008-10-25T20:17:56.903

我发现这个伪代码公式可能会有所帮助。你可以从一组开始播种。

色差公式

以下是 W3C 建议的用于确定两种颜色之间差异的公式。

（最大值（红色值 1，红色值 2）-最小值（红色值 1，红色值 2））+（最大值（绿色值 1，绿色值 2）-最小值（绿色值 1，绿色值 2））+（最大值（蓝色值 1，蓝色值 2）- 最小值（蓝色值 1，蓝色值 2））

背景色与前景色之差应大于500。

[这里是源](http://juicystudio.com/services/colourcontrast.php)

        php - PHP的sleep函数和客户端连接

ID：236941

赞同：4

时间：2008-10-25T19:55:46.277

标签：php, connection

PHP如何在睡眠时处理客户端连接？

或者换一种说法......如果客户端在处理页面时关闭与服务器的连接会发生什么？

它只是杀死进程，还是继续处理页面直到结束？

由于我不确定上述问题的答案，我将如何在 PHP 中实现以下伪代码。

```
Record user entered

while (user is still connected) {
    fetch changes in state since last awake
    send changes to user

    sleep(5);
}

Record user exit 
```

任何想法将不胜感激。

谢谢。

            回答 #1

赞同：2

时间：2008-10-25T20:03:31.800

谁知道？

连接处理文档 - [http://php.net/manual/en/features.connection-handling.php](http://php.net/manual/en/features.connection-handling.php)

从那个页面`register_shutdown_function`解决了这个问题。

精彩的。

        asp.net - 使用 VirtualPathProvider 从 DLL 加载 ASP.NET MVC 视图

ID：236972

赞同：40

时间：2008-10-25T20:24:12.617

标签：asp.net, asp.net-mvc, virtualpathprovider

基于this question [here](https://stackoverflow.com/questions/19746/views-in-seperate-assemblies-in-aspnet-mvc)并使用此处找到的代码[，](http://www.codeproject.com/KB/aspnet/ASP2UserControlLibrary.aspx)我正在尝试将嵌入资源的视图加载到单独的DLL项目中，而原始问题的作者说他已经成功地做到了这一点 - 但我无法让它发挥作用似乎 MVC 视图引擎正在拦截请求并仍在查看文件系统的视图。例外：

```
Server Error in '/' Application.
The view 'Index' or its master could not be found. The following locations were searched:
~/Views/admin/Index.aspx
~/Views/admin/Index.ascx
~/Views/Shared/Index.aspx
~/Views/Shared/Index.ascx
~/App/Views/admin/Index.aspx
~/App/Views/admin/Index.ascx
~/App/Views/Shared/Index.aspx
~/App/Views/Shared/Index.ascx 
```

我正在使用`CustomViewEngine`类似 Rob Connery 的 /App 结构之一，如下所示：

```
public class CustomViewEngine : WebFormViewEngine
    {
         public CustomViewEngine()
         {
             MasterLocationFormats = new[] { 
                "~/App/Views/{1}/{0}.master", 
                "~/App/Views/Shared/{0}.master" 
                };

             ViewLocationFormats = new[] { 
                "~/App/Views/{1}/{0}.aspx", 
                "~/App/Views/{1}/{0}.ascx", 
                "~/App/Views/Shared/{0}.aspx", 
                "~/App/Views/Shared/{0}.ascx" 
                };

             PartialViewLocationFormats = ViewLocationFormats;
         }
    } 
```

这是我的路线：

```
 routes.IgnoreRoute("{resource}.axd/{*pathInfo}");

    routes.MapRoute("Home", "", new {controller = "Page", action = "Index", id = "Default"});
    routes.MapRoute("Default", "Page/{id}", new { controller = "Page", action = "Index", id = "" });
    routes.MapRoute("Plugins", "plugin/{controller}/{action}", new { controller = "", action = "Index", id = "" });
    routes.MapRoute("Error", "{*url}", new { controller = "Error", action = "ResourceNotFound404" }); 
```

在我的[`AssemblyResourceProvider`](http://www.codeproject.com/KB/aspnet/ASP2UserControlLibrary.aspx)我正在检查路径是否开始`~/plugin/`，然后使用 dll 文件名约定`plugin.{controller}.dll`

有什么建议么？

**更新：**当路由请求`http://localhost/plugin/admin`到达 VirtualFileProvider 时，它最后没有附加任何视图。因此，在`VirtualFileProvider`'s Open 方法`~/plugin/admin`中，当它应该`~/plugin/admin/Index.aspx`在我上面的路线中定义时，它被传入。我是否搞砸了我的路线，或者我期望这种情况发生是正确的？

            回答 #1

赞同：24

时间：2008-10-26T17:58:22.380

1.  您必须`VirtualPathProvider`在`Global.asax` `Application_Start`处理程序中注册您的。
2.  您必须使用特殊路径调用 DLL 中的视图，如下所示：`return View("~/Plugin/YOURDLL.dll/FULLNAME_YOUR_VIEW.aspx");`

这是一篇带有可下载代码示例的文章，演示了这一点：

[http://www.wynia.org/wordpress/2008/12/aspnet-mvc-plugins/](http://www.wynia.org/wordpress/2008/12/aspnet-mvc-plugins/)

            回答 #2

赞同：4

时间：2008-10-26T15:07:48.153

内置的 WebFormsViewEngine 使用 VirtualPathProviders，因此如果您编写 VPP 并注册它，则无需对视图引擎进行任何更改。

        php - 通过正则表达式解析 CSS

ID：236979

赞同：12

时间：2008-10-25T20:32:48.467

标签：php, css, regex, css-parsing

我正在创建一个 CSS 编辑器，并试图创建一个可以从 CSS 文档中获取数据的正则表达式。如果我有一个属性，但我无法让它适用于所有属性，则此正则表达式有效。我在 PHP 中使用 preg/perl 语法。

正则表达式

```
(?<selector>[A-Za-z]+[\s]*)[\s]*{[\s]*((?<properties>[A-Za-z0-9-_]+)[\s]*:[\s]*(?<values>[A-Za-z0-9#, ]+);[\s]*)*[\s]*} 
```

测试用例

```
body { background: #f00; font: 12px Arial; } 
```

预期结果

```
Array(
    [0] => Array(
            [0] => body { background: #f00; font: 12px Arial; }
            [selector] => Array(
                [0] => body
            )
            [1] => Array(
                [0] => body
            )
            [2] => font: 12px Arial; 
            [properties] => Array(
                [0] => font
            )
            [3] => Array(
                [0] => font
            )
            [values] => Array(
                [0] => 12px Arial
                [1] => background: #f00
            )
            [4] => Array(
                [0] => 12px Arial
                [1] => background: #f00
            )
        )
) 
```

实际结果

```
Array(
    [0] => Array
        (
            [0] => body { background: #f00; font: 12px Arial; }
            [selector] => body 
            [1] => body 
            [2] => font: 12px Arial; 
            [properties] => font
            [3] => font
            [values] => 12px Arial
            [4] => 12px Arial
        )
    ) 
```

提前感谢您的帮助 - 这让我整个下午都感到困惑！

            回答 #1

赞同：20

时间：2008-10-25T20:42:06.810

对于单个正则表达式来说，这似乎太复杂了。好吧，我确信通过正确的扩展，高级用户可以创建正确的正则表达式。但是你需要一个更高级的用户来调试它。

相反，我建议使用正则表达式来提取碎片，然后分别标记每个碎片。例如，

```
/([^{])\s*\{\s*([^}]*?)\s*}/ 
```

然后你最终得到选择器和不同字段中的属性，然后将它们分开。（即使选择器解析起来也会很有趣。）请注意，如果 } 可以出现在引号或其他内容中，即使这样也会很痛苦。您可以再次将其复杂化以避免这种情况，但最好在这里完全避免正则表达式，并通过一次解析一个字段来处理它，也许通过使用递归下降解析器或 yacc/bison 或任何。

            回答 #2

赞同：11

时间：2008-10-25T20:43:39.083

您正试图从数据中提取结构，而不仅仅是单个值。正则表达式可能会很痛苦地完成这项工作，但你真的进入了解析器领域，应该拿出大枪，即解析器。

我从未使用过 PHP 解析器生成工具，但在对文档进行简单扫描后，它们看起来还不错。查看[LexerGenerator](http://pear.php.net/package/PHP_LexerGenerator)和[ParserGenerator](http://pear.php.net/package/PHP_ParserGenerator)。LexerGenerator 将采用一堆正则表达式来描述一种语言（在本例中为 CSS）中不同类型的标记，并生成一些识别各个标记的代码。ParserGenerator 将采用语法，一种语言中的哪些事物由哪些其他事物组成的描述，并吐出一个解析器，该代码采用一堆标记并返回语法树（您所追求的数据结构。

            回答 #3

赞同：11

时间：2009-06-18T13:11:22.693

不要使用您自己的正则表达式来解析 CSS。为什么要在有代码等着你、准备好使用并且（希望）没有错误的时候重新发明轮子？

有两个通用类可以为您解析 CSS：

pear.php.net 上的 HTML_CSS PEAR 包

和

PHPCLasses 上的 CSS Parser 类：

[http://www.phpclasses.org/browse/package/1289.html](http://www.phpclasses.org/browse/package/1289.html)

            回答 #4

赞同：8

时间：2008-10-26T02:06:30.587

我建议不要使用正则表达式来解析 CSS——尤其是在单个正则表达式中！

如果您坚持在正则表达式中进行解析，请将其拆分为合理的部分 - 使用一个正则表达式来拆分所有`body{..}`块，然后使用另一个来解析`color:rgb(1,2,3);`属性。

如果您实际上是在尝试编写“有用”的东西（而不是尝试学习正则表达式），请寻找预先编写的 CSS 解析器。

我发现[这个 cssparser.php](http://websvn.atrc.utoronto.ca/websvn/wsvn/Atutor/trunk/docs/include/classes/cssparser.php)似乎工作得很好：

```
$cssp = new cssparser;
$cssp -> ParseStr("body { background: #f00;font: 12px Arial; }");
print_r($cssp->css); 
```

..输出以下内容：

```
Array
(
    [body] => Array
        (
            [background] => #f00
            [font] => 12px arial
        )
) 
```

解析器非常简单，所以应该很容易弄清楚它在做什么。哦，我不得不删除读取的行`if($this->html) {$this->Add("VAR", "");}`（它似乎是一个调试的东西留在里面）

我在[这里](http://github.com/dbr/so_scripts/tree/master/csssparser.php)镜像了脚本，上面的更改在

            回答 #5

赞同：6

时间：2010-04-22T20:11:48.370

我正在使用下面的正则表达式，它几乎可以工作......当然这个问题现在很老了，我看到你已经放弃了你的努力......但万一其他人遇到它：

```
(?<selector>(?:(?:[^,{]+),?)*?)\{(?:(?<name>[^}:]+):?(?<value>[^};]+);?)*?\} 
```

（为了安全起见，首先从您的 CSS中删除所有**/* 注释 */ ）**

            回答 #6

赞同：6

时间：2011-03-29T19:27:03.883

我写了一段很容易解析 CSS 的代码。你所要做的就是做一些真正的爆炸...... $css 变量是 CSS 的字符串。你所要做的就是`print_r($css)`得到一个很好的 CSS 数组，完全解析。

```
$css_array = array(); // master array to hold all values
$element = explode('}', $css);
foreach ($element as $element) {
    // get the name of the CSS element
    $a_name = explode('{', $element);
    $name = $a_name[0];
    // get all the key:value pair styles
    $a_styles = explode(';', $element);
    // remove element name from first property element
    $a_styles[0] = str_replace($name . '{', '', $a_styles[0]);
    // loop through each style and split apart the key from the value
    $count = count($a_styles);
    for ($a=0;$a<$count;$a++) {
        if ($a_styles[$a] != '') {
            $a_key_value = explode(':', $a_styles[$a]);
            // build the master css array
            $css_array[$name][$a_key_value[0]] = $a_key_value[1];
        }
    }               
} 
```

给你这个：

```
Array
(
    [body] => Array
        (
            [background] => #f00
            [font] => 12px arial
        )
) 
```

            回答 #7

赞同：2

时间：2018-02-22T20:57:34.797

在 Tanktalus 的当前答案的基础上，有一些改进和边缘情况需要注意。

CSS 解析正则表达式

```
\s*([^{]+)\s*\{\s*([^}]*?)\s*} 
```

此正则表达式将对本示例中列出的一些其他边缘情况进行一些空间修剪和命中：[https ://regex101.com/r/qQRIHx/5](https://regex101.com/r/qQRIHx/5)

键：值对；更复杂的正则表达式的陷阱

我也开始尝试界定键：值对，但很快发现在每个选择器有多种样式的情况下，事情开始变得比我想要的更棘手。您可以在此处查看我尝试分隔键的正则表达式的版本 1：值以及它如何因多个声明而失败：[https ://regex101.com/r/qQRIHx/1](https://regex101.com/r/qQRIHx/1)

执行

正如其他人提到的，您应该将其分解为多个步骤来解析和标记您的 css。此正则表达式将帮助您获得声明，但您需要将其解析出来。

声明解析器

在获得第一组匹配项后，您可以使用类似的方法来解析声明。

`([^:\s]+)*\s*:\s*([^;]+);`

示例：[https ://regex101.com/r/py9OKO/1/](https://regex101.com/r/py9OKO/1/)

边缘案例

上面的示例适用于多个声明，但它可能只是 1 个没有分号结尾的声明，它将在 [大多数] 浏览器中呈现，但会破坏这个正则表达式。

著名案例

如果有媒体查询，您可能还需要考虑嵌套规则。在这种情况下，我会尝试针对提取的声明运行 css 匹配正则表达式。如果你得到匹配，你可以在它上面运行递归（尽管我不确定在某些情况下你会为 vanilla CSS 嵌套超过 1 级）。

边缘案例

*   这不处理字符串中的右花括号

明天的研究

我决定改用 npm 包，如`css`or `cssom`。我知道这是在 PHP 中，但它会为我做很多繁重的工作并处理我不断遇到的边缘情况。

**编辑**：

我最终使用了 Jotform 的公共 css.js 库。它的占用空间非常小，这是我在选择库来解析 CSS 时的主要要求之一。

*   [https://github.com/jotform/css.js/tree/master](https://github.com/jotform/css.js/tree/master)
*   他们还发表了这篇文章，解释了他们的过程： 

    *   [https://stories.jotform.com/writing-a-css-parser-in-javascript-3ecaa1719a43](https://stories.jotform.com/writing-a-css-parser-in-javascript-3ecaa1719a43)

            回答 #8

赞同：0

时间：2010-05-09T17:54:10.143

试试这个

```
function trimStringArray($stringArray){
    $result = array();
    for($i=0; $i < count($stringArray); $i++){
        $trimmed = trim($stringArray[$i]);
        if($trimmed != '') $result[] = $trimmed;
    }
    return $result;
}
$regExp = '/\{|\}/';
$rawCssData = preg_split($regExp, $style);

$cssArray = array();
for($i=0; $i < count($rawCssData); $i++){
    if($i % 2 == 0){
        $cssStyle['selectors'] = array();
        $selectors = split(',', $rawCssData[$i]);
        $cssStyle['selectors'] = trimStringArray($selectors);
    }
    if($i % 2 == 1){
        $attributes = split(';', $rawCssData[$i]);
        $cssStyle['attributes'] = trimStringArray($attributes);
        $cssArray[] = $cssStyle;
    }

}
//return false;
echo '<pre>'."\n";
print_r($cssArray);
echo '</pre>'."\n"; 
```

        cocoa - 在 Cocoa 中嵌入 Opera

ID：236990

赞同：1

时间：2008-10-25T20:45:24.103

标签：cocoa, embed, opera

因此，我正在编写一个 Cocoa 应用程序，该应用程序需要能够使用 Opera 的渲染引擎显示 Web 内容。这是一个功能，而不是因为我是 Opera fanboi（我不是）。关于这个主题，我所能找到的只是这份[关于 Adob​​e 使用 Opera 引擎的新闻稿](http://www.opera.com/pressreleases/en/2003/09/30/)。

有人做过吗？API是什么样的？他们会想要特许权使用费、付款、保密协议等吗？

编辑添加：这是一个跨引擎的网络调试工具。我将与 WebKit 一起使用它。

            回答 #1

赞同：1

时间：2008-10-25T21:23:11.857

Adobe 已经使用 Opera 并以一些（过高？）的价格许可了他们的软件。这可能意味着 Adob​​e 可以访问库和 SDK 文档，以便他们可以将其嵌入到他们的应用程序中。Opera 不会像啤酒或自由一样免费提供引擎。似乎有几个 B2B 机会，我敢肯定，您可以获得合适的金额。如需更多信息，[请访问 http://www.opera.com/b2b/](http://www.opera.com/b2b/)。

            回答 #2

赞同：0

时间：2008-10-26T02:39:40.143

为什么需要嵌入 Opera 引擎，而不是平台标准的渲染引擎？

“平台之间的一致性”——我听到的关于这种事情的典型论点——通过仔细管理你的内容、提供适当的样式表等等来更好地实现。

从用户和平台集成的角度来看，在 Mac OS X 上的应用程序中使用 WebKit 并使用在 Windows 上调用的任何 IE 控件，你会做得更好。

```**