# StackOverflow 问答 000278000-000278999

# project-management - MS项目服务器的替代品

> ID：278017
> 
> 赞同：7
> 
> 时间：2008-11-10T14:40:12.440
> 
> 标签：project-management, ms-project

我管理一个小组，我会把我的工作分解在项目中。但是，很难让我的团队充分了解项目并报告他们的进度。我查看了 MS Project Server（sharepoint webpart），但这是一个昂贵的提议。

有没有人有任何其他工具（商业很好）的经验，可以帮助团队查看和报告他们由 MS Project 管理的工作？FWIW，我看过 OpenProj，它似乎是在桌面上查看项目文件的一个不错的解决方案。任何基于 Web 的内容，请记住，我希望人们报告他们的工作，而不仅仅是查看他们的工作。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-29T17:22:33.600

**一个适合我 EPM 需求的基于 Web 的托管项目管理软件称为 valleyspeak 项目服务器，我在 www.valleyspeak.com 上找到了它。我喜欢该软件的主要原因之一是我可以继续在 Microsoft Project 2007 中工作，同时与我的团队分享我的 Microsoft Project 计划。

因为它是一项托管服务，所以我不必购买昂贵的软件或处理安装和维护的难题。我使用 valleyspeak 管理地理上分散的团队的功能非常适合我。**

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-10T14:46:22.540

你可以试试[工作台](http://www.openworkbench.org/)。    

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-10T14:50:56.647

不完全是工具，而是技术，但我最近开始阅读有关[scrum](https://stackoverflow.com/questions/tagged/scrum)的内容，发现它有趣且有用。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-10T15:07:00.890

正如“llya”之前建议的那样，也许您应该将 scrum 视为一种方法论。

但是关于你的问题，你有一些非常好的基于网络的替代方案：

*   [acunote](http://www.acunote.com/)也可以很好地工作，并且是基于网络的，对小型团队是免费的。
*   我个人使用的[trac](http://trac.edgewall.org/)
*   scrumworks

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-11T14:50:08.303

以下是一些可供查看的开源应用程序：

Joynet 连接器 [http://joyent.com/connector/](http://joyent.com/connector/)

计时 IT [http://www.clockingit.com/](http://www.clockingit.com/)

RedMine [http://www.redmine.org/](http://www.redmine.org/)

您可以自己托管它们，但前两个确实提供托管版本

杰森

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-21T08:42:57.643

看看[www.ibnportal.com](http://www.ibnportal.com) _

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-12-22T16:50:33.917

看看 Projec.to[在线 Microsoft Project 查看器](http://www.onlineprojectviewer.com/)。它允许上传 MS Project 文件 (.mpp)，在线查看它们，并通过浏览器与其他人共享，除了 Microsoft Project。

披露：我是这项服务的开发人员之一。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-11-19T18:14:22.417

Daptiv 可能值得一看。[http://www.daptiv.com/](http://www.daptiv.com/)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2011-02-06T13:27:29.373

试试 InTask Professional (www.intaskrnd.com) - 快速、便宜、大量功能、多用户多项目、频繁更新。非常不错的一款软件。或者，您可以尝试大本营，但它要贵得多...

# c# - 如何强制控件不向上传递单击事件？WPF C#

> ID：278019
> 
> 赞同：2
> 
> 时间：2008-11-10T14:40:35.297
> 
> 标签：c#, wpf, events

是否可以将 Grid 或其他容器控件设置为某种事件大坝？因此，当任何事件，特别是左键单击，在其中开始时，它们会在该控件处停止并且不再继续？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-10T15:25:15.690

PreviewMouseDown 是你的朋友...

将此事件添加到您的控件，并将 Handled 属性设置为 true...

所有事件在预览阶段首先从根到叶子，然后在实际事件案例中从叶子到根处理......

所以 PreviewMouseDown 在 Button 之前处理 Grid，而 MouseDown 事件在 Grid 之前处理 Button...

希望这可以帮助...

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-10T14:42:29.940

您应该能够扩展您想要的任何控件（假设它不是密封的）。在您的扩展类中，您可以覆盖单击事件并将其吞下（不要将其传递给基类）。

# ssl - 无法使用 DirectoryServices.Protocols.LdapConnection 打开 SecureSocketLayer

> ID：278020
> 
> 赞同：6
> 
> 时间：2008-11-10T14:40:47.790
> 
> 标签：ssl, ldap, directoryservices, ldapconnection

我正在尝试修复产品中的 SSL 错误，并注意到尽管代码将 SSL 设置为 true，但在代码的下一行中，SSL 仍然为 false。我为此编写了一个单元测试，单元测试证实了我的怀疑。

```
 [TestMethod]
  public void SecureSocketLayerSetToTrue( )
  {
     var ldapConnection = new LdapConnection( 
                                new LdapDirectoryIdentifier( "ldap.test.com", 636 ));
     ldapConnection.SessionOptions.SecureSocketLayer = true;
     Assert.IsTrue( ldapConnection.SessionOptions.SecureSocketLayer );
  } 
```

测试失败。这里有什么我想念的吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-16T09:14:39.687

事实证明，DirectoryServices.Protocols 实现其 LDAP 调用的方式是将它们传递给低级 LDAP API。此 LDAP API 是在属性上完成获取时查询的内容。

低级 API 仅在方法执行时更新。您可以将其视为为尚未启动的可执行文件构建命令行参数。

当进行像 Bind() 这样的调用时，将启动可执行文件并且属性将报告正确的值。

因此，仅仅因为该属性说该值为 false，它在必要时使用了 true。

# c++ - 从（非托管）C++ 调用 XLL

> ID：278025
> 
> 赞同：0
> 
> 时间：2008-11-10T14:43:52.277
> 
> 标签：c++, xll

我有一个 XLL Excel 插件，现在另一个团队想在他们的项目中使用相同的功能（非托管 C++）。有没有办法直接从 C++ 与这个 XLL 交互？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-11T13:33:14.200

您是 XLL 非托管代码还是非托管代码？

据我所知，非托管 C++ XLL 文件实际上是一个导出 Excel 调用的特定方法的 DLL。

如果您的 XLL 有一个 .def 文件，也许您可​​以添加其他团队将调用的方法。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-11-19T13:52:44.773

您可以使用 GET.WORKSPACE(44) 获取加载项列表及其参数签名。如果您没有 hablo 宏表，请从[http://sdrv.ms/JtaMIV](http://sdrv.ms/JtaMIV)加载 xllutility.xll并在单元格中调用 =GET_WORKSPACE(44)。（注意下划线。）

第二列是函数的名称，第三列是编码的参数列表，如下所述：http: [//msdn.microsoft.com/en-us/library/office/bb687900.aspx](http://msdn.microsoft.com/en-us/library/office/bb687900.aspx)

使用上面链接中方便的 adjust.xll 将输出调整为正确的大小。

# mysql - 为不同时区存储日期/时间的最佳方式

> ID：278031
> 
> 赞同：10
> 
> 时间：2008-11-10T14:48:41.737
> 
> 标签：mysql

以统一的方式存储带有日期/时间的时区信息的最佳方法是什么，以便人们可以在自己的当地时间从世界任何地方输入时间？然后其他用户将能够在网页上查看他们自己的当地时间和原始当地时间的时间。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-10T14:55:08.747

将时间数据存储为 GMT。使用当地时间显示。这需要与 GMT 的简单偏移。现在，如果政客们只留下夏令时的开始和结束日期......

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-11-10T14:55:26.763

我同意 Staale 的观点，但补充说时间应该以祖鲁时间（通常称为 UTC）存储，以便更容易地转换到其他时区。不要依赖在服务器使用的时区中存储数据。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-09-26T15:57:21.833

我建议在 UTC 时区插入日期。这将在未来为您省去很多麻烦（夏令时问题等......）

```
"INSERT INTO abc_table (registrationtime) VALUES (UTC_TIMESTAMP())" 
```

当我查询我的数据时，我使用以下 PHP 脚本

```
<?  while($row = mysql_fetch_array($registration)){ 

  $dt_obj = new DateTime($row['message_sent_timestamp']." UTC");
  $dt_obj->setTimezone(new DateTimeZone('Europe/Istanbul'));
  echo $formatted_date_long=date_format($dt_obj, 'Y-m-d H:i:s'); } ?> 
```

您可以在此处将 datetimezone 值替换为可用的[php 时区](http://us3.php.net/manual/en/timezones.php)之一：

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-10T14:51:26.350

我的观点一直是存储精确的数字时间戳（自格林威治标准时间 1970 年 1 月 1 日午夜以来的秒数或毫秒数），因为这种格式很容易转换为任何时区的实际日期和时间。

这样做的缺点是无法通过普通 SQL 工具立即查看数据。mysql cli 客户端确实有这方面的方法（FROM_UNIXTIMESTAMP）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-10T14:57:01.457

始终存储为 UTC/GMT 的时间。检查 mysql 文档以查看最适合您想要支持的日期范围和/或精度的列类型。

在输入时，转换为 UTC 并将客户端时区偏移量存储在第二列中。然后您可以轻松转换为您想要显示的任何时区，或使用提交的偏移量重新创建原始时间戳。

# asp.net - 操作方法：使用相对 URL 正确重定向 ASP.NET

> ID：278034
> 
> 赞同：1
> 
> 时间：2008-11-10T14:50:04.183
> 
> 标签：asp.net, redirect

我有一个身份验证脚本 ( **`CheckLogin.aspx`**)，如果任何凭据不匹配，我的应用程序将 (通过**`Server.Transfer`**) 重定向到拒绝访问页面 ( **`forbidden.aspx`**)。每次我的脚本运行时，它都会得到一个**`InvalidOperationException: Failed to map the path '/forbidden.aspx'`**. 这是我的应用程序文件结构的模型：

```
<root>
..default.aspx
..forbidden.aspx
..<inc>
....scripts.js
..<auth>
....CheckLogin.aspx 
```

如您所见，该**`CheckLogin.aspx`**页面位于根目录内的文件夹中，而该**`forbidden.aspx`**页面位于根目录本身内。我告诉我的应用程序重定向到的路径是**`/forbidden.aspx`**.

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-10T14:53:24.177

有时您必须在页面路径前加上波浪号来指示根目录：

```
'~/forbidden.aspx' 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-10T14:54:30.493

您是否使用“~/...”来确保所有路径都是相对的？

`<location>`顺便说一句，您应该使用标签通过 Web.config 设置页面访问。这样您就可以拥有某种基于角色的访问权限，而无需太多自定义代码。

# c# - C# 中的 SOAP 客户端，无需访问 WSDL 文件

> ID：278037
> 
> 赞同：13
> 
> 时间：2008-11-10T14:51:10.877
> 
> 标签：c#, .net, soap, wsdl

我正在与第三方合作，将我们的一些系统与他们的系统集成在一起，他们为我们提供了一个 SOAP 接口，以便在他们连接的系统中提出某些请求和更改。对我来说，问题是他们没有提供 WSDL 文件供我使用。如果我有一个 WSDL 文件，那么只需运行提供的 .NET 命令 (wsdl.exe) 并生成一个代理类来与服务交互就可以了。

没有 WSDL 文件有没有“简单”的方法来做到这一点？我拥有我们可以访问的所有功能以及我需要发送的参数以及我应该期望的回报。

没有 WSDL 文件的 SOAP 服务很常见吗？（我问这个是因为我们将来会添加更多的外部系统）

有没有人针对无 WDSL 服务做过代理类或任何其他形式的客户端，并且对如何做有任何好的指导？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2010-09-14T10:46:41.550

```
string EndPoints = "http://203.189.91.127:7777/services/spm/spm";

string New_Xml_Request_String = "<?xml version=\"1.0\" encoding=\"UTF-8\"?><soapenv:Envelope xmlns:soapenv=\"http://schemas.xmlsoap.org/soap/envelope/\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"><soapenv:Body><OTA_AirLowFareSearchRQ EchoToken=\"0\" SequenceNmbr=\"0\" TransactionIdentifier=\"0\" xmlns=\"http://www.opentravel.org/OTA/2003/05\"><POS xmlns=\"http://www.opentravel.org/OTA/2003/05\"><Source AgentSine=\"\" PseudoCityCode=\"NPCK\"  TerminalID=\"1\"><RequestorID ID=\"\"/></Source><YatraRequests><YatraRequest DoNotHitCache=\"true\" DoNotCache=\"false\" MidOfficeAgentID=\"\" AffiliateID=\"\" YatraRequestTypeCode=\"SMPA\"/></YatraRequests></POS><TravelerInfoSummary><AirTravelerAvail><PassengerTypeQuantity Code=\"ADT\" Quantity=\"1\"/><PassengerTypeQuantity Code=\"CHD\" Quantity=\"1\"/><PassengerTypeQuantity Code=\"INF\" Quantity=\"1\"/></AirTravelerAvail></TravelerInfoSummary> <SpecificFlightInfo><Airline Code=\"\"/></SpecificFlightInfo><OriginDestinationInformation><DepartureDateTime>" + DateTime.Now.ToString("o").Remove(19, 14) + "</DepartureDateTime><OriginLocation CodeContext=\"IATA\" LocationCode=\"DEL\">" + Source + "</OriginLocation><DestinationLocation CodeContext=\"IATA\" LocationCode=\"BOM\">" + Destincation + "</DestinationLocation></OriginDestinationInformation><TravelPreferences><CabinPref Cabin=\"Economy\"/></TravelPreferences></OTA_AirLowFareSearchRQ></soapenv:Body></soapenv:Envelope>";

 protected string HttpSOAPRequest_Test(string xmlfile, string proxy)
    {
        try
        {
            System.Xml.XmlDocument doc = new System.Xml.XmlDocument();
            doc.InnerXml = xmlfile.ToString();
            HttpWebRequest req = (HttpWebRequest)WebRequest.Create(EndPoints);
            req.Timeout = 100000000;
            if (proxy != null)
                req.Proxy = new WebProxy(proxy, true);
            req.Headers.Add("SOAPAction", "");
            req.ContentType = "application/soap+xml;charset=\"utf-8\"";
            req.Accept = "application/x-www-form-urlencoded"; //"application/soap+xml";
            req.Method = "POST";
            Stream stm = req.GetRequestStream();
            doc.Save(stm);
            stm.Close();
            WebResponse resp = req.GetResponse();
            stm = resp.GetResponseStream();
            StreamReader r = new StreamReader(stm);
            string myd = r.ReadToEnd();
            return myd;
        }

   catch (Exception se)
        {
            throw new Exception("Error Occurred in AuditAdapter.getXMLDocumentFromXMLTemplate()", se);
        }
    } 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-10T15:01:59.107

如果您编写的类派生自`System.Web.Services.Protocols.SoapHttpClientProtocol`（并具有正确的属性，例如，`WebServiceBinding`应用`SoapDocumentMethod`到它及其方法），您可以相当容易地调用 SOAP 方法，而无需 WSDL 文件。

最简单的方法可能是编写自己的 ASP.NET Web 服务来复制第三方的 SOAP API，从中生成代理类，然后手动编辑文件以确保 URL、命名空间、方法名称、参数types 等对于您要调用的第三方 API 是正确的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-10T15:01:41.337

我还没有构建一个没有访问 WSDL 文件的 SOAP 接口，但是格式是[相当有据可查的](http://www.w3.org/TR/wsdl)。您最好的选择可能是创建一个您自己的简化 WSDL 文件，以反映您对所订阅服务的了解......

如果您决定走这条路，[现有的 stackoverflow 问题](https://stackoverflow.com/questions/152023/wsdl-validator)指向一些用于验证您的 WSDL 的工具。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-05T14:57:04.357

the code here is in VB.NET but I think you'll get the idea. The following is a client that invokes the 'processConfirmation' method and it expects a response (MyBase.SendRequestResponse).

```
Imports Microsoft.Web.Services3
Imports Microsoft.Web.Services3.Addressing
Imports Microsoft.Web.Services3.Messaging

Namespace Logic
    Public Class HTTPClient
        Inherits Soapclient

        Sub New(ByVal destination As EndpointReference)
            MyBase.Destination = destination
        End Sub

        <SoapMethod("processConfirmation")> _
        Public Function processConfirmation(ByVal envelope As SoapEnvelope) As SoapEnvelope
            Return MyBase.SendRequestResponse("processConfirmation", envelope)
        End Function
    End Class
End Namespace 
```

And you use it by doing the following:

```
Dim hc As New HTTPClient(New Microsoft.Web.Services3.Addressing.EndpointReference(New System.Uri("http://whatever.srv")))

Dim envelope As New Microsoft.Web.Services3.SoapEnvelope
Dim doc As New Xml.XmlDocument
doc.LoadXml("<hey>there</hey>")
envelope.SetBodyObject(doc)

Dim return_envelope As Microsoft.Web.Services3.SoapEnvelope = hc.processConfirmation(envelope) 
```

I think this should work .... success!

# .net - 如何将鼠标光标设置为代码中的混合沙漏和箭头？（。网）

> ID：278039
> 
> 赞同：10
> 
> 时间：2008-11-10T14:51:33.840
> 
> 标签：.net, vb.net, user-interface

我有一个在后台线程上运行的及时操作。在运行时，我目前将光标置于等待状态：

```
Mouse.OverrideCursor = Cursors.Wait 
```

我刚刚实现了一项功能，允许用户在厌倦了等待时单击“取消”按钮。然而，一些用户可能没有意识到他们可以做到这一点（尽管取消按钮是过程中唯一的活动控件），因为他们的鼠标光标是一个沙漏。

我见过程序使用显示沙漏的光标并附有箭头指针。如何将鼠标光标设置为这种状态？我查看了 .NET 文档，但找不到这个光标。

谢谢！

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-11-10T14:56:28.710

```
Me.Cursor = Cursors.AppStarting 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-10T14:55:50.820

我认为您应该使用“System.Windows.Forms.Cursros”类的“AppStarting”属性。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-10T14:58:11.483

我怀疑“鼠标光标+沙漏”是[Cursors.AppStarting](http://msdn.microsoft.com/en-us/library/system.windows.input.cursors.appstarting.aspx)。当然，理想情况下，您希望 UI 的其余部分使用普通沙漏，而该光标仅用于取消按钮，但是...

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-10T15:29:31.390

可能您还应该更改取消按钮的背景颜色（或一些图形线索），以使用户意识到取消是可能的。

# iphone - iPhone图片在后台上传

> ID：278045
> 
> 赞同：2
> 
> 时间：2008-11-10T14:54:55.110
> 
> 标签：iphone

我正在编写一个具有图像上传功能的应用程序。现在我正在使用 NSURL POST 像：[125306](https://stackoverflow.com/questions/125306)。

据我所知，当应用程序关闭时，所有上传都中止并且线程死亡。在那儿

1）当应用程序不再处于前台时，使这些上传线程持续存在的方法？

2) iPhone OS 服务将接受对作业进行排队的请求并以操作系统管理的模式运行它？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-10T14:58:26.133

编辑：这是 2009 年的旧答案。当前 iOS (2016) 具有后台 URL 任务。请参阅 NSURLSessionUploadTask。

原答案如下：

您不得在 iPhone 上在后台运行（根据 Apple 的指南）。如果您这样做，您的应用将被 AppStore 拒绝。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-10T16:57:02.760

As has been failry well documented, no background processes are allowed using the SDK.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-11T00:28:38.620

如前所述，您不能有后台进程 - 一个好的折衷方案是将照片调整为可以在合理时间内传输的大小（用户可配置最好），并显示某种活动指示器，以便用户会知道上传正在进行中。

一个更好的解决方案是调整大小，以及提供当前上传百分比的进度指示器——但这涉及一些自定义的低级 HTTP 代码。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-05-31T08:38:23.383

应用程序暂停后，您只有约 10 分钟的时间来完成这项工作。当应用程序挂起时，您应该创建一个后台进程线程。而且你没有保证操作系统会让应用程序保持活力。这取决于过程的复杂性。

# .net - 免费的 NHibernate 辅助工具？

> ID：278046
> 
> 赞同：12
> 
> 时间：2008-11-10T14:55:06.453
> 
> 标签：.net, nhibernate, .net-3.5, code-generation

是否有任何免费工具可帮助简化 .NET 3.5 中的 NHibernate 项目的工作？首先，我正在寻找某种代码和配置文件生成器来自动化使用 NHibernate 的一些更繁琐的部分。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-11-11T08:40:13.150

[Fluent-NHibernate](http://code.google.com/p/fluent-nhibernate/)提供了另一种编写映射的方法，例如，它比标准 XML 方法更易于重构。

例子：

```
public CustomerMap : ClassMap<Customer>
{
  public CustomerMap()
  {
    Id(x => x.ID);
    Map(x => x.Name);
    Map(x => x.Credit);
    HasMany<Product>(x => x.Products)
      .AsBag();
    Component<Address>(x => x.Address, m =>  
    {  
        m.Map(x => x.AddressLine1);  
        m.Map(x => x.AddressLine2);  
        m.Map(x => x.CityName);  
        m.Map(x => x.CountryName);  
    });
} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-10T15:31:13.180

[NHibernate 查询分析器](http://ayende.com/Blog/archive/2007/06/02/NHibernate-Query-Analyzer-for-NHibernate-1.2-GA.aspx)是构建查询的必备工具。我知道，这不是为了配置，而是在尝试了解 HQL 时必须这样做。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-13T03:03:35.247

留意 Oren (Ayende) 的 NHhibernate Profiler：

[http://ayende.com/Blog/archive/2008/11/04/nh-prof-a-guided-tour.aspx](http://ayende.com/Blog/archive/2008/11/04/nh-prof-a-guided-tour.aspx)

它尚未发布，但看起来很有希望。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-10T15:00:33.570

[ActiveWriter](http://altinoren.com/activewriter/)是 Visual Studio 的一个插件，可为 NHibernate 生成一些文件，但我还没有机会深入研究它。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-11-10T15:17:16.283

[MyGeneration](http://www.mygenerationsoftware.com/portal/Home/tabid/36/Default.aspx)有一些用于代码生成的[nHibernate 模板。](http://www.mygenerationsoftware.com/templatelibrary/default.aspx)

Code-Smith 的免费版本曾经也有一些，但我认为它们已经有一段时间没有更新了。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-11-10T15:42:59.100

在 nhibernate 之上使用基于属性的定义的[活动记录实现](http://www.castleproject.org/activerecord/index.html)怎么样？

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-12-29T22:40:58.943

David Hayden 已将[T4 模板](http://www.olegsych.com/2007/12/text-template-transformation-toolkit/)放在一起，这些模板可生成示例 Fluent NHibernate 映射类。

[http://codebetter.com/blogs/david.hayden/archive/2008/12/14/t4-templates-for-fluent-nhibernate.aspx](http://codebetter.com/blogs/david.hayden/archive/2008/12/14/t4-templates-for-fluent-nhibernate.aspx)

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2010-03-26T11:10:19.187

NConstruct Lite 怎么样，一个用于生成映射文件和实体的小而强大的工具......

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-10-19T12:08:19.617

看看：[dPulpo](http://www.dpulpo.com)，一个数据层生成工具，它可以生成 NHibernate 映射文件、C# 实体类和你的 SQL 数据库。有一个 Visual Studio 插件，目前处于测试阶段，可以免费下载。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2011-05-16T13:25:11.440

最新版本的 LLBLGen 能够生成示例 Fluent NHibernate 映射类和实体。

# vb.net - 将 HDD Serial # VB6 代码转换为 VB.NET 代码

> ID：278062
> 
> 赞同：5
> 
> 时间：2008-11-10T14:59:48.033
> 
> 标签：vb.net, vb6, vb6-migration, hard-drive

我有一段很酷的代码取自一个 VC++ 项目，它可以在不使用 WMI 的情况下获取硬盘驱动器的完整信息（因为 WMI 有自己的问题）。

我请那些熟悉 API 函数的人尝试将这个 VB6 代码转换为 VB.NET（或 C#）并帮助很多非常需要这个实用程序类的人。

我花了很多时间搜索整个网络以找到获取硬盘的实际型号和序列号的方法，最终找到了这个，如果它在.NET中的话......

这是代码，对于它的格式问题很抱歉，只需将其粘贴到 VB6 IDE 中：

```
Option Explicit

''// Antonio Giuliana, 2001-2003 
''// Costanti per l'individuazione della versione di OS
Private Const VER_PLATFORM_WIN32S = 0
Private Const VER_PLATFORM_WIN32_WINDOWS = 1
Private Const VER_PLATFORM_WIN32_NT = 2

''// Costanti per la comunicazione con il driver IDE
Private Const DFP_RECEIVE_DRIVE_DATA = &H7C088

''// Costanti per la CreateFile
Private Const FILE_SHARE_READ = &H1
Private Const FILE_SHARE_WRITE = &H2
Private Const GENERIC_READ = &H80000000
Private Const GENERIC_WRITE = &H40000000
Private Const OPEN_EXISTING = 3
Private Const CREATE_NEW = 1

''// Enumerazione dei comandi per la CmnGetHDData
Private Enum HDINFO
   HD_MODEL_NUMBER
   HD_SERIAL_NUMBER
   HD_FIRMWARE_REVISION
End Enum

''// Struttura per l'individuazione della versione di OS
Private Type OSVERSIONINFO
   dwOSVersionInfoSize As Long
   dwMajorVersion As Long
   dwMinorVersion As Long
   dwBuildNumber As Long
   dwPlatformId As Long
   szCSDVersion As String * 128
End Type

''// Struttura per il campo irDriveRegs della struttura SENDCMDINPARAMS
Private Type IDEREGS
   bFeaturesReg As Byte
   bSectorCountReg As Byte
   bSectorNumberReg As Byte
   bCylLowReg As Byte
   bCylHighReg As Byte
   bDriveHeadReg As Byte
   bCommandReg As Byte
   bReserved As Byte
End Type

''// Struttura per l'I/O dei comandi al driver IDE
Private Type SENDCMDINPARAMS
    cBufferSize As Long
    irDriveRegs As IDEREGS
    bDriveNumber As Byte
    bReserved(1 To 3) As Byte
    dwReserved(1 To 4) As Long
End Type

''// Struttura per il campo DStatus della struttura SENDCMDOUTPARAMS
Private Type DRIVERSTATUS
    bDriveError As Byte
    bIDEStatus As Byte
    bReserved(1 To 2) As Byte
    dwReserved(1 To 2) As Long
End Type

''// Struttura per l'I/O dei comandi al driver IDE
Private Type SENDCMDOUTPARAMS
    cBufferSize As Long
    DStatus As DRIVERSTATUS     ''// ovvero DriverStatus
    bBuffer(1 To 512) As Byte
End Type

''// Per ottenere la versione del SO
Private Declare Function GetVersionEx _
    Lib "kernel32" Alias "GetVersionExA" _
    (lpVersionInformation As OSVERSIONINFO) As Long

''// Per ottenere un handle al device IDE
Private Declare Function CreateFile _
    Lib "kernel32" Alias "CreateFileA" _
    (ByVal lpFileName As String, _
    ByVal dwDesiredAccess As Long, _
    ByVal dwShareMode As Long, _
    ByVal lpSecurityAttributes As Long, _
    ByVal dwCreationDisposition As Long, _
    ByVal dwFlagsAndAttributes As Long, _
    ByVal hTemplateFile As Long) As Long

''// Per chiudere l'handle del device IDE
Private Declare Function CloseHandle _
    Lib "kernel32" _
    (ByVal hObject As Long) As Long

''// Per comunicare con il driver IDE
Private Declare Function DeviceIoControl _
    Lib "kernel32" _
    (ByVal hDevice As Long, _
    ByVal dwIoControlCode As Long, _
    lpInBuffer As Any, _
    ByVal nInBufferSize As Long, _
    lpOutBuffer As Any, _
    ByVal nOutBufferSize As Long, _
    lpBytesReturned As Long, _
    ByVal lpOverlapped As Long) As Long

''// Per azzerare buffer di scambio dati
Private Declare Sub ZeroMemory _
    Lib "kernel32" Alias "RtlZeroMemory" _
    (dest As Any, _
    ByVal numBytes As Long)

''// Per copiare porzioni di memoria
Private Declare Sub CopyMemory _
    Lib "kernel32" Alias "RtlMoveMemory" _
    (Destination As Any, _
    Source As Any, _
    ByVal Length As Long)

Private Declare Function GetLastError _
    Lib "kernel32" () As Long

Private mvarCurrentDrive As Byte    ''// Drive corrente
Private mvarPlatform As String      ''// Piattaforma usata

Public Property Get Copyright() As String
    ''// Copyright
    Copyright = "HDSN Vrs. 1.00, (C) Antonio Giuliana, 2001-2003"
End Property

''// Metodo GetModelNumber
Public Function GetModelNumber() As String
       ''// Ottiene il ModelNumber
    GetModelNumber = CmnGetHDData(HD_MODEL_NUMBER)
End Function

''// Metodo GetSerialNumber
Public Function GetSerialNumber() As String
   ''// Ottiene il SerialNumber
    GetSerialNumber = CmnGetHDData(HD_SERIAL_NUMBER)
End Function

''// Metodo GetFirmwareRevision
Public Function GetFirmwareRevision() As String
   ''// Ottiene la FirmwareRevision
    GetFirmwareRevision = CmnGetHDData(HD_FIRMWARE_REVISION)
End Function

''// Proprieta' CurrentDrive
Public Property Let CurrentDrive(ByVal vData As Byte)
    ''// Controllo numero di drive fisico IDE
    If vData < 0 Or vData > 3 Then
        Err.Raise 10000, , "Illegal drive number"   ''// IDE drive 0..3
    End If

    ''// Nuovo drive da considerare
    mvarCurrentDrive = vData
End Property

''// Proprieta' CurrentDrive
Public Property Get CurrentDrive() As Byte
    ''// Restituisce drive fisico corrente (IDE 0..3)
    CurrentDrive = mvarCurrentDrive
End Property

''// Proprieta' Platform
Public Property Get Platform() As String
    ''// Restituisce tipo OS
    Platform = mvarPlatform
End Property

Private Sub Class_Initialize()
    ''// Individuazione del tipo di OS
    Dim OS As OSVERSIONINFO

    OS.dwOSVersionInfoSize = Len(OS)
    Call GetVersionEx(OS)
    mvarPlatform = "Unk"

    Select Case OS.dwPlatformId
        Case Is = VER_PLATFORM_WIN32S
            mvarPlatform = "32S"                ''// Win32S
        Case Is = VER_PLATFORM_WIN32_WINDOWS
            If OS.dwMinorVersion = 0 Then
                mvarPlatform = "W95"            ''// Win 95
            Else
                mvarPlatform = "W98"            ''// Win 98
            End If
        Case Is = VER_PLATFORM_WIN32_NT
            mvarPlatform = "WNT"                ''// Win NT/2000
    End Select
End Sub

Private Function CmnGetHDData(hdi As HDINFO) As String

    ''// Rilevazione proprieta' IDE 
    Dim bin As SENDCMDINPARAMS
    Dim bout As SENDCMDOUTPARAMS
    Dim hdh As Long
    Dim br As Long
    Dim ix As Long
    Dim hddfr As Long
    Dim hddln As Long
    Dim s As String

    Select Case hdi             ''// Selezione tipo caratteristica richiesta
        Case HD_MODEL_NUMBER
            hddfr = 55          ''// Posizione nel buffer del ModelNumber
            hddln = 40          ''// Lunghezza nel buffer del ModelNumber
        Case HD_SERIAL_NUMBER
            hddfr = 21          ''// Posizione nel buffer del SerialNumber
            hddln = 20          ''// Lunghezza nel buffer del SerialNumber
        Case HD_FIRMWARE_REVISION
            hddfr = 47          ''// Posizione nel buffer del FirmwareRevision
            hddln = 8           ''// Lunghezza nel buffer del FirmwareRevision
        Case Else
            Err.Raise 10001, "Illegal HD Data type" 
        End Select

        Select Case mvarPlatform
        Case "WNT"
            ''// Per Win NT/2000 apertura handle al drive fisico
            hdh = CreateFile("\\.\PhysicalDrive" & mvarCurrentDrive, _
                GENERIC_READ + GENERIC_WRITE, FILE_SHARE_READ + FILE_SHARE_WRITE, _
                0, OPEN_EXISTING, 0, 0)
        Case "W95", "W98"
            ''// Per Win 9X apertura handle al driver SMART
            ''// (in \WINDOWS\SYSTEM da spostare in \WINDOWS\SYSTEM\IOSUBSYS)
            ''// che comunica con il driver IDE
            hdh = CreateFile("\\.\Smartvsd", _
                0, 0, 0, CREATE_NEW, 0, 0)
        Case Else
            ''// Piattaforma non supportata (Win32S)
            Err.Raise 10002, , "Illegal platform (only WNT, W98 or W95)"    
    End Select

    ''// Controllo validità handle
    If hdh = 0 Then
        Err.Raise 10003, , "Error on CreateFile"
    End If

    ''// Azzeramento strutture per l'I/O da driver
    ZeroMemory bin, Len(bin)
    ZeroMemory bout, Len(bout)

    ''// Preparazione parametri struttura di richiesta al driver
    With bin
        .bDriveNumber = mvarCurrentDrive
        .cBufferSize = 512
        With .irDriveRegs
            If (mvarCurrentDrive And 1) Then
                .bDriveHeadReg = &HB0
            Else
                .bDriveHeadReg = &HA0
            End If
            .bCommandReg = &HEC
            .bSectorCountReg = 1
            .bSectorNumberReg = 1
        End With
    End With

    ''// Richiesta al driver
    DeviceIoControl hdh, DFP_RECEIVE_DRIVE_DATA, _
                bin, Len(bin), bout, Len(bout), br, 0

    ''// Formazione stringa di risposta
    ''// da buffer di uscita
    ''// L'ordine dei byte e' invertito
    s = ""
    For ix = hddfr To hddfr + hddln - 1 Step 2
        If bout.bBuffer(ix + 1) = 0 Then Exit For
        s = s & Chr(bout.bBuffer(ix + 1))
        If bout.bBuffer(ix) = 0 Then Exit For
        s = s & Chr(bout.bBuffer(ix))
    Next ix

    ''// Chiusura handle
    CloseHandle hdh

    ''// Restituzione informazione richiesta
    CmnGetHDData = Trim(s)

End Function 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-13T15:37:31.460

我找到了！这是等效的 VB.NET 代码。它不完全是 VB6 代码的转换版本，但做同样的事情。享受！

```
Public Class HDDInfo
#Region " Declatrations "
Private Declare Function CreateFile Lib "kernel32" Alias "CreateFileA" (ByVal lpFileName As String, ByVal dwDesiredAccess As Integer, ByVal dwShareMode As Integer, ByVal lpSecurityAttributes As Integer, ByVal dwCreationDisposition As Integer, ByVal dwFlagsAndAttributes As Integer, ByVal hTemplateFile As Integer) As Integer
<System.Runtime.InteropServices.DllImport("kernel32.dll")> _
Private Shared Function CloseHandle(ByVal hObject As Integer) As Integer
End Function
<System.Runtime.InteropServices.DllImport("kernel32.dll")> _
Private Shared Function DeviceIoControl(ByVal hDevice As Integer, ByVal dwIoControlCode As Integer, <[In](), Out()> ByVal lpInBuffer As SENDCMDINPARAMS, ByVal lpInBufferSize As Integer, <[In](), Out()> ByVal lpOutBuffer As SENDCMDOUTPARAMS, ByVal lpOutBufferSize As Integer, _
 ByRef lpBytesReturned As Integer, ByVal lpOverlapped As Integer) As Integer
End Function
Private Const FILE_SHARE_READ As Short = &H1
Private Const FILE_SHARE_WRITE As Short = &H2
Private Const GENERIC_READ As Integer = &H80000000
Private Const GENERIC_WRITE As Integer = &H40000000
Private Const OPEN_EXISTING As Short = 3
Private Const CREATE_NEW As Short = 1
Private Const VER_PLATFORM_WIN32_NT As Integer = 2
Private Const DFP_RECEIVE_DRIVE_DATA As Integer = &H7C088
Private Const INVALID_HANDLE_VALUE As Integer = -1
#End Region
#Region " Classes "
<StructLayout(LayoutKind.Sequential, Size:=8)> _
Private Class IDEREGS
    Public Features As Byte
    Public SectorCount As Byte
    Public SectorNumber As Byte
    Public CylinderLow As Byte
    Public CylinderHigh As Byte
    Public DriveHead As Byte
    Public Command As Byte
    Public Reserved As Byte
End Class
<StructLayout(LayoutKind.Sequential, Size:=32)> _
Private Class SENDCMDINPARAMS
    Public BufferSize As Integer
    Public DriveRegs As IDEREGS
    Public DriveNumber As Byte
    <MarshalAs(UnmanagedType.ByValArray, SizeConst:=3)> _
    Public Reserved As Byte()
    <MarshalAs(UnmanagedType.ByValArray, SizeConst:=4)> _
    Public Reserved2 As Integer()
    Public Sub New()
        DriveRegs = New IDEREGS()
        Reserved = New Byte(2) {}
        Reserved2 = New Integer(3) {}
    End Sub
End Class
<StructLayout(LayoutKind.Sequential, Size:=12)> _
Private Class DRIVERSTATUS
    Public DriveError As Byte
    Public IDEStatus As Byte
    <MarshalAs(UnmanagedType.ByValArray, SizeConst:=2)> _
    Public Reserved As Byte()
    <MarshalAs(UnmanagedType.ByValArray, SizeConst:=2)> _
    Public Reserved2 As Integer()
    Public Sub New()
        Reserved = New Byte(1) {}
        Reserved2 = New Integer(1) {}
    End Sub
End Class
<StructLayout(LayoutKind.Sequential)> _
Private Class IDSECTOR
    Public GenConfig As Short
    Public NumberCylinders As Short
    Public Reserved As Short
    Public NumberHeads As Short
    Public BytesPerTrack As Short
    Public BytesPerSector As Short
    Public SectorsPerTrack As Short
    <MarshalAs(UnmanagedType.ByValArray, SizeConst:=3)> _
    Public VendorUnique As Short()
    <MarshalAs(UnmanagedType.ByValArray, SizeConst:=20)> _
    Public SerialNumber As Char()
    Public BufferClass As Short
    Public BufferSize As Short
    Public ECCSize As Short
    <MarshalAs(UnmanagedType.ByValArray, SizeConst:=8)> _
    Public FirmwareRevision As Char()
    <MarshalAs(UnmanagedType.ByValArray, SizeConst:=40)> _
    Public ModelNumber As Char()
    Public MoreVendorUnique As Short
    Public DoubleWordIO As Short
    Public Capabilities As Short
    Public Reserved1 As Short
    Public PIOTiming As Short
    Public DMATiming As Short
    Public BS As Short
    Public NumberCurrentCyls As Short
    Public NumberCurrentHeads As Short
    Public NumberCurrentSectorsPerTrack As Short
    Public CurrentSectorCapacity As Integer
    Public MultipleSectorCapacity As Short
    Public MultipleSectorStuff As Short
    Public TotalAddressableSectors As Integer
    Public SingleWordDMA As Short
    Public MultiWordDMA As Short
    <MarshalAs(UnmanagedType.ByValArray, SizeConst:=382)> _
    Public Reserved2 As Byte()
End Class
<StructLayout(LayoutKind.Sequential)> _
Private Class SENDCMDOUTPARAMS
    Public BufferSize As Integer
    Public Status As DRIVERSTATUS
    Public IDS As IDSECTOR
    Public Sub New()
        Status = New DRIVERSTATUS()
        IDS = New IDSECTOR()
    End Sub
End Class
#End Region
#Region " Methods and Functions "
Private Shared Function SwapChars(ByVal chars As Char()) As String
    For i As Integer = 0 To chars.Length - 2 Step 2
        Dim t As Char
        t = chars(i)
        chars(i) = chars(i + 1)
        chars(i + 1) = t
    Next
    Dim s As New String(chars)
    Return s
End Function
Public Shared Function GetHDDInfoString() As String
    Dim serialNumber As String = " ", model As String = " ", firmware As String = " "
    Dim handle As Integer, returnSize As Integer = 0
    Dim driveNumber As Integer = 0
    Dim sci As New SENDCMDINPARAMS()
    Dim sco As New SENDCMDOUTPARAMS()

    If Environment.OSVersion.Platform = PlatformID.Win32NT Then
        handle = CreateFile("\\.\PhysicalDrive" & "0", GENERIC_READ + GENERIC_WRITE, FILE_SHARE_READ + FILE_SHARE_WRITE, 0, OPEN_EXISTING, 0, 0)
    Else
        handle = CreateFile("\\.\Smartvsd", 0, 0, 0, CREATE_NEW, 0, 0)
    End If
    If handle <> INVALID_HANDLE_VALUE Then
        sci.DriveNumber = CByte(driveNumber)
        sci.BufferSize = Marshal.SizeOf(sco)
        sci.DriveRegs.DriveHead = CByte((&HA0 Or driveNumber << 4))
        sci.DriveRegs.Command = &HEC
        sci.DriveRegs.SectorCount = 1
        sci.DriveRegs.SectorNumber = 1
        If DeviceIoControl(handle, DFP_RECEIVE_DRIVE_DATA, sci, Marshal.SizeOf(sci), sco, Marshal.SizeOf(sco), _
         returnSize, 0) <> 0 Then
            serialNumber = SwapChars(sco.IDS.SerialNumber)
            model = SwapChars(sco.IDS.ModelNumber)
            firmware = SwapChars(sco.IDS.FirmwareRevision)
        End If
        CloseHandle(handle)
    End If
    Return model.Trim & " " & serialNumber.Trim
End Function
#End Region
End Class 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-10T15:35:37.103

对不起，我没有时间为你转换它，但如果没有其他人想出代码，你可以做的比看看[http://www.pinvoke.net更糟糕](http://www.pinvoke.net)做得更糟。您的 VB6 代码必须调用 Windows API 函数来完成这项工作，而 VB.NET 代码也必须这样做。它将调用相同的 API 函数。

例如，[这里](http://www.pinvoke.net/default.aspx/kernel32/DeviceIoControl.html)是 DeviceIoControl 的页面。

但是，如果您等待的时间足够长，其他人可能只会手头有代码 :-)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-10T15:44:09.053

```
Try
Dim Searcher_P As New ManagementObjectSearcher("root\CIMV2", "SELECT * FROM Win32_PhysicalMedia")
For Each queryObj As ManagementObject In Searcher_P.Get()
If queryObj("SerialNumber").ToString.Trim = "Y2S0RKFE" Then
Me.Cursor = Cursors.Default
Return True
End If
Next
Catch ex As Exception
MessageBox.Show("An error occurred while querying for WMI data: Win32_PhysicalMedia " & ex.Message)
End Try

Try
Dim Searcher_L As New ManagementObjectSearcher("root\CIMV2", "SELECT * FROM Win32_LogicalDisk WHERE DeviceID = 'C:'")
For Each queryObj As ManagementObject In Searcher_L.Get()
If queryObj("VolumeSerialNumber").ToString.Trim = "226C1A0B" Then
Me.Cursor = Cursors.Default
Return True
End If
Next
Catch ex As Exception
MessageBox.Show("An error occurred while querying for WMI data: VolumeSerialNumber " & ex.Message)
Return False
End Try 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-10T15:21:02.233

对于不懂评论中使用的口语的人来说，这是一大堆代码。

我会这样说：在该代码的任何地方，您都可以看到`Type`您可能想要使用的关键字`Structure`，.Net 中用于 Properties 的语法略有不同，函数调用需要括号，而 VB.Net 没有“Any”类型（也许`System.IntPtr`相反？不确定）。

VB.Net 中的其他大部分语法都是相同的，因此您可能会更幸运地进行我已经提到的修复，然后解决您在单独构建生成的代码时遇到的每个错误（或错误类型）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-10T15:27:06.683

是的，我知道 VB6，但问题在于 API 函数声明以及将这些结构（类型）传递给它们所需的属性。那是我没有时间花的地方！如果您有自动 VB6 到 VB.NET 工具和 VB6 本身，请将代码保存为 VB6 项目并转换代码。我没有我的VB6。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-11-10T15:41:22.630

你可以得到这个WMI的数据。让我给你举个例子

# c# - Application.ExecutablePath 是否根据测试运行程序返回不同的值？

> ID：278064
> 
> 赞同：3
> 
> 时间：2008-11-10T15:00:02.807
> 
> 标签：c#, unit-testing, nunit, resharper, automated-tests

我正在尝试查看是否有办法在多个测试运行器中获得一致的单元测试结果。目前的情况是我们有一个测试程序集，如果您在 NUnit GUI 中运行它们，其中 4 个测试通过，但如果您使用 TestDriven.NET 或 ReSharper 测试运行器运行它们，则失败。在这些测试失败的情况下（抛出 System.NullReferenceException），Application.ExecutablePath 似乎返回的是测试运行程序的可执行文件，而不是测试程序集的 DLL。

除了我应该使用的 Application.ExecutablePath 之外，是否还有其他值（我们目前正在使用它来访问 DLL 的 .config 文件中的值）？NUnit GUI 在做什么（或不做什么）导致它在其他测试运行程序失败时正常运行？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-10T15:38:32.340

您可以尝试改用 System.Reflection.Assembly 类，例如

```
String strPath = System.IO.Path.GetDirectoryName(System.Reflection.Assembly.GetExecutingAssembly().CodeBase); 
```

这个类中还有一些其他的方法和属性，所以我相信你会找到你需要的。

# java - 如何在图像中添加聚光灯

> ID：278068
> 
> 赞同：1
> 
> 时间：2008-11-10T15:01:12.540
> 
> 标签：java

我有一个图像，我想在其上显示一些“聚光灯”，就像他们在电视上所做的那样。图像的其余部分应该比原图更暗，我所聚焦的人应该是正常的。我有聚光灯的 x、y 和半径，但我不确定如何更改该位置的亮度。

另外，如果我有两个聚光灯并且它们相交，则交叉点应该比任何一个聚光灯都亮。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-10T16:00:18.317

在原始图像和子图像上使用 RescaleOp。假设您有一个包含图像的缓冲图像（称为 biDest），请在其上调用 RescaleOp(0.6, 0, null) 以使其更暗。然后，要添加（矩形）聚光灯，请调用以下命令：

```
 public void spotLight(int x, int y, int w, int h)
    {
        BufferedImage i = biDest.getSubimage(x, y, w, h);

        RescaleOp rescale = new RescaleOp(SPOTLIGHT_BRIGHTNESS, 0, null);
        rescale.filter(i, i);

        repaint();
    } 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-10T15:17:16.220

一个简单的方法是将颜色转换为HSL，降低L变暗，增加变亮，然后转换回RGB并设置像素。

[http://www.mpa-garching.mpg.de/MPA-GRAPHICS/hsl-rgb.html](http://www.mpa-garching.mpg.de/MPA-GRAPHICS/hsl-rgb.html)

# c# - 如何在 C# 中获取 CPU 使用率？

> ID：278071
> 
> 赞同：235
> 
> 时间：2008-11-10T15:01:39.997
> 
> 标签：c#, cpu-usage

我想在 C# 中获取应用程序的总体总 CPU 使用率。我找到了很多方法来挖掘进程的属性，但我只想要进程的 CPU 使用率，以及你在 TaskManager 中获得的总 CPU。

我怎么做？

* * *

## 回答 #1

> 赞同：227
> 
> 时间：2008-11-10T15:09:36.063

您可以使用[System.Diagnostics中的](http://msdn.microsoft.com/en-us/library/system.diagnostics.aspx)[PerformanceCounter](http://msdn.microsoft.com/en-us/library/system.diagnostics.performancecounter(VS.80).aspx)类。

像这样初始化：

```
PerformanceCounter cpuCounter;
PerformanceCounter ramCounter;

cpuCounter = new PerformanceCounter("Processor", "% Processor Time", "_Total");
ramCounter = new PerformanceCounter("Memory", "Available MBytes"); 
```

像这样消费：

```
public string getCurrentCpuUsage(){
            return cpuCounter.NextValue()+"%";
}

public string getAvailableRAM(){
            return ramCounter.NextValue()+"MB";
} 
```

* * *

## 回答 #2

> 赞同：74
> 
> 时间：2011-05-29T14:54:04.323

比要求的多一点，但我使用额外的计时器代码来跟踪和提醒 CPU 使用率是否持续 1 分钟或更长时间的 90% 或更高。

```
public class Form1
{

    int totalHits = 0;

    public object getCPUCounter()
    {

        PerformanceCounter cpuCounter = new PerformanceCounter();
        cpuCounter.CategoryName = "Processor";
        cpuCounter.CounterName = "% Processor Time";
        cpuCounter.InstanceName = "_Total";

                     // will always start at 0
        dynamic firstValue = cpuCounter.NextValue();
        System.Threading.Thread.Sleep(1000);
                    // now matches task manager reading
        dynamic secondValue = cpuCounter.NextValue();

        return secondValue;

    }

    private void Timer1_Tick(Object sender, EventArgs e)
    {
        int cpuPercent = (int)getCPUCounter();
        if (cpuPercent >= 90)
        {
            totalHits = totalHits + 1;
            if (totalHits == 60)
            {
                Interaction.MsgBox("ALERT 90% usage for 1 minute");
                totalHits = 0;
            }                        
        }
        else
        {
            totalHits = 0;
        }
        Label1.Text = cpuPercent + " % CPU";
        //Label2.Text = getRAMCounter() + " RAM Free";
        Label3.Text = totalHits + " seconds over 20% usage";
    }
} 
```

* * *

## 回答 #3

> 赞同：21
> 
> 时间：2012-08-09T20:06:33.513

在花了一些时间阅读了几个看起来很复杂的不同线程之后，我想出了这个。我需要一台 8 核机器来监控 SQL 服务器。对于下面的代码，我将“sqlservr”作为 appName 传入。

```
private static void RunTest(string appName)
{
    bool done = false;
    PerformanceCounter total_cpu = new PerformanceCounter("Process", "% Processor Time", "_Total");
    PerformanceCounter process_cpu = new PerformanceCounter("Process", "% Processor Time", appName);
    while (!done)
    {
        float t = total_cpu.NextValue();
        float p = process_cpu.NextValue();
        Console.WriteLine(String.Format("_Total = {0}  App = {1} {2}%\n", t, p, p / t * 100));
        System.Threading.Thread.Sleep(1000);
    }
} 
```

它似乎正确测量了我的 8 核服务器上 SQL 使用的 CPU 百分比。

* * *

## 回答 #4

> 赞同：16
> 
> 时间：2008-11-10T17:07:34.687

It's OK, I got it! Thanks for your help!

Here is the code to do it:

```
private void button1_Click(object sender, EventArgs e)
{
    selectedServer = "JS000943";
    listBox1.Items.Add(GetProcessorIdleTime(selectedServer).ToString());
}

private static int GetProcessorIdleTime(string selectedServer)
{
    try
    {
        var searcher = new
           ManagementObjectSearcher
             (@"\\"+ selectedServer +@"\root\CIMV2",
              "SELECT * FROM Win32_PerfFormattedData_PerfOS_Processor WHERE Name=\"_Total\"");

        ManagementObjectCollection collection = searcher.Get();
        ManagementObject queryObj = collection.Cast<ManagementObject>().First();

        return Convert.ToInt32(queryObj["PercentIdleTime"]);
    }
    catch (ManagementException e)
    {
        MessageBox.Show("An error occurred while querying for WMI data: " + e.Message);
    }
    return -1;
} 
```

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2008-11-10T15:30:56.847

您可以使用 WMI 获取 CPU 百分比信息。如果您拥有正确的权限，您甚至可以登录到远程计算机。查看[http://www.csharphelp.com/archives2/archive334.html](http://www.csharphelp.com/archives2/archive334.html)以了解您可以完成的工作。

也有帮助的可能是 MSDN 参考[Win32_Process](http://msdn.microsoft.com/en-us/library/aa394372%28VS.85%29.aspx)。

另请参阅 CodeProject 示例[How To: (Almost) Everything In WMI via C#](http://www.codeproject.com/KB/cs/EverythingInWmi02.aspx)。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-11-10T15:14:03.590

CMS 是正确的，但如果您在 Visual Studio 中使用服务器资源管理器并使用性能计数器选项卡，那么您可以弄清楚如何获得许多有用的指标。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2012-04-19T17:03:41.283

此类每 1 秒自动轮询一次计数器，并且也是线程安全的：

```
public class ProcessorUsage
{
    const float sampleFrequencyMillis = 1000;

    protected object syncLock = new object();
    protected PerformanceCounter counter;
    protected float lastSample;
    protected DateTime lastSampleTime;

    /// <summary>
    /// 
    /// </summary>
    public ProcessorUsage()
    {
        this.counter = new PerformanceCounter("Processor", "% Processor Time", "_Total", true);
    }

    /// <summary>
    /// 
    /// </summary>
    /// <returns></returns>
    public float GetCurrentValue()
    {
        if ((DateTime.UtcNow - lastSampleTime).TotalMilliseconds > sampleFrequencyMillis)
        {
            lock (syncLock)
            {
                if ((DateTime.UtcNow - lastSampleTime).TotalMilliseconds > sampleFrequencyMillis)
                {
                    lastSample = counter.NextValue();
                    lastSampleTime = DateTime.UtcNow;
                }
            }
        }

        return lastSample;
    }
} 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2013-09-02T13:11:57.643

这似乎对我有用，一个等待处理器达到一定百分比的例子

```
var cpuCounter = new PerformanceCounter("Processor", "% Processor Time", "_Total");
int usage = (int) cpuCounter.NextValue();
while (usage == 0 || usage > 80)
{
     Thread.Sleep(250);
     usage = (int)cpuCounter.NextValue();
} 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2013-07-19T15:07:59.103

我不喜欢在所有`PerformanceCounter`解决方案中添加 1 秒的停顿。相反，我选择使用`WMI`解决方案。存在 1 秒等待/停顿的原因是为了在使用`PerformanceCounter`. 但是，如果您经常调用此方法并刷新此信息，我建议不要经常产生延迟......即使考虑执行异步进程来获取它。

我从这里的代码片段开始[使用 C# 在 WMI 中返回 CPU 使用情况，](https://stackoverflow.com/questions/9777661/returning-cpu-usage-in-wmi-using-c-sharp)并在下面的博客文章中添加了对该解决方案的完整说明：

[使用 WMI 获取 C# 中所有内核的 CPU 使用率](http://allen-conway-dotnet.blogspot.com/2013/07/get-cpu-usage-across-all-cores-in-c.html)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2020-03-03T20:17:24.917

```
public int GetCpuUsage()
{
    var cpuCounter = new PerformanceCounter("Processor", "% Processor Time", "_Total", Environment.MachineName);
    cpuCounter.NextValue();
    System.Threading.Thread.Sleep(1000); //This avoid that answer always 0
    return (int)cpuCounter.NextValue();
} 
```

此链接中的原始信息[https://gavindraper.com/2011/03/01/retrieving-accurate-cpu-usage-in-c/](https://gavindraper.com/2011/03/01/retrieving-accurate-cpu-usage-in-c/)

# .net - Filewatcher 创建事件

> ID：278075
> 
> 赞同：3
> 
> 时间：2008-11-10T15:02:02.117
> 
> 标签：.net

我正在监视带有 .net 文件监视程序的文件夹以查找某些类型的文件（* .mbxml）。我正在为它使用创建的 filewatcher 事件。一旦创建的事件触发，我必须将此文件移动到另一个文件夹。这种方法的问题在于，一旦文件复制开始，就会触发 created 事件。因此，如果将文件复制到正在监视的文件夹所需的时间过长，则移动文件的代码将失败。我已经搜索过，我在网上找到的唯一解决方案是将文件移动到 try-catch 块中并继续尝试直到整个文件被复制。我不喜欢这个解决方案，如果创建的事件在整个文件完成复制或有一个单独的事件后被触发会更好。还有另一种方法可以实现这一目标吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-10T15:46:59.250

您可以通过从 FileSystemWatcher 继承并触发您自己的 FileReady 事件来简化代码，如下所示：

```
public class CustomFileSystemWatcher : System.IO.FileSystemWatcher
{
    public CustomFileSystemWatcher()
    {
        this.Created += new FileSystemEventHandler(CustomFileSystemWatcher_Created);
    }

    private void CustomFileSystemWatcher_Created(object sender, FileSystemEventArgs e)
    {
        ThreadPool.QueueUserWorkItem((n) => { WaitFileReady(e); });
    }

    private void WaitFileReady(FileSystemEventArgs e)
    {
        while (true)
        {
            try
            {
                using (FileStream fs = File.Open(e.FullPath, FileMode.Open, FileAccess.ReadWrite, FileShare.None))
                {
                    //exit
                    break;
                }
            }
            catch (Exception)
            {
                //wait if you like
                Thread.Sleep(100);
            }
        }
        OnFileReady(e);
    }

    public event FileSystemEventHandler FileReady;

    protected virtual void OnFileReady(FileSystemEventArgs e)
    {
        if (this.EnableRaisingEvents && FileReady != null) FileReady(this, e);
    }
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-10T15:05:28.897

你能改变创建文件的程序吗？如果是这样，请将其更改为在一个文件夹中创建它们，然后将它们（原子地）移动到另一个文件夹 - 或使用不同的扩展名（任何你可以跟踪的东西，真的）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-10T15:17:49.777

除了使用 try catch 块外，我还没有看到这样做。通常在 oncreate 事件中，我设置了一个尝试打开文件的布尔值。这决定了代码的其余部分是否继续，如果还有另一种我也会感兴趣的方式。

```
 private static bool creationComplete(string fileName)
    {
        // if the file can be opened it is no longer locked and now available
        try
        {
            using (FileStream inputStream = File.Open(fileName, FileMode.Open, FileAccess.Read, FileShare.None))
            {
                return true;
            }
        }
        catch (IOException)
        {
            return false;
        }
    } 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-10T15:38:17.737

来自：http: [//msdn.microsoft.com/en-us/library/system.io.filesystemwatcher.aspx](http://msdn.microsoft.com/en-us/library/system.io.filesystemwatcher.aspx)

“常见的文件系统操作可能会引发多个事件。例如，当文件从一个目录移动到另一个目录时，可能会引发多个 OnChanged 以及一些 OnCreated 和 OnDeleted 事件。移动文件是一项复杂的操作，由多个简单的操作，因此引发多个事件。同样，某些应用程序（例如，防病毒软件）可能会导致 FileSystemWatcher 检测到的其他文件系统事件。

您对移动文件的要求对时间有多敏感？

如果您不喜欢尝试移动它、捕获异常并重复直到获得成功的想法，您可以采取稍微不同的方法。

一旦您收到 Created 事件，您如何开始监视文件的最后写入时间。一旦自上次写入时间过去了一定时间，比如两秒钟，您可以尝试移动文件。您可能会发现“失败”的动作要少得多，但最终结果将是相同的。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-10T15:38:49.717

注意 on created 事件，但等待最后一次写入时间更改事件。文件复制完成后，最后写入时间将更新。由于您正在移动文件，因此您可能只需处理最后一次写入时间更改事件。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-10T15:29:04.527

您是否尝试过使用 BinaryReader 和 BinaryWriter 移动文件？您可能可以在复制文件时读取文件并以较慢的速度写入，这样您的移动不会超过其他进程创建文件的速度。您还可以在读取之间插入一些等待时间。进行最后一次读取并验证文件创建完成后，您可以将其删除。

祝你好运！

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-10T15:31:50.043

使用 try/catch 解决方案的全部原因是，知道其他程序是否完成对文件的写入的唯一方法是文件 open() 调用 SUCCEED。那是 FAILURE 是仍在写入的文件的定义。

通常，在您的情况下，while() 循环与其中的 thread.sleep 计时器一起使用，它会一直尝试直到 A) 超时或 B) 成功。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-10T15:37:25.180

如果我没记错的话，FileWatcher 在给定文件/文件夹上的每个 IO 都会引发几个事件。您可能能够缩小与完成关联的 FileSystemEventArgs。可能有必要推迟检查文件是否可访问，但我认为这是一个不太理想的解决方案。

# git - 解决与二进制文件的 Git 冲突

> ID：278081
> 
> 赞同：527
> 
> 时间：2008-11-10T15:03:44.827
> 
> 标签：git, merge-conflict-resolution

我一直在 Windows 上使用 Git (msysgit) 来跟踪我一直在做的一些设计工作的更改。

今天我一直在另一台 PC 上工作（带有远程仓库`brian`），我现在正试图将今天完成的编辑合并回我笔记本电脑上的常规本地版本。

在我的笔记本电脑上，我习惯于`git pull brian master`将更改拉入我的本地版本。除了主要的 InDesign 文档外，一切都很好——这显示为冲突。

PC 上的版本 ( `brian`) 是我想保留的最新版本，但我不知道是什么命令告诉 repo 使用这个版本。

我尝试直接将文件复制到我的笔记本电脑上，但这似乎破坏了整个合并过程。

谁能指出我正确的方向？

* * *

## 回答 #1

> 赞同：972
> 
> 时间：2010-01-29T17:48:13.670

`git checkout`接受这种情况的`--ours`or`--theirs`选项。因此，如果您有合并冲突，并且您知道您只想要正在合并的分支中的文件，您可以执行以下操作：

```
$ git checkout --theirs -- path/to/conflicted-file.txt 
```

使用该版本的文件。同样，如果您知道您想要您的版本（而不是被合并的版本），您可以使用

```
$ git checkout --ours -- path/to/conflicted-file.txt 
```

* * *

## 回答 #2

> 赞同：155
> 
> 时间：2008-11-10T15:49:46.670

您必须手动解决冲突（将文件复制过来），然后像这样提交文件（无论您是复制它还是使用本地版本）

```
git commit -a -m "Fix merge conflict in test.foo" 
```

Git 通常会在合并后自动提交，但是当它检测到无法自行解决的冲突时，它会应用它发现的所有补丁，并将其余部分留给您手动解决和提交。[Git Merge Man Page](http://www.kernel.org/pub/software/scm/git/docs/git-merge.html)、[Git-SVN Crash Course](http://git.or.cz/course/svn.html#merge)或此博客条目可能会阐明它应该如何工作[。](http://www.bluishcoder.co.nz/2007/09/git-binary-files-and-cherry-picking.html)

**编辑：**请参阅下面的帖子，您实际上不必自己复制文件，但可以使用

```
git checkout --ours -- path/to/file.txt
git checkout --theirs -- path/to/file.txt 
```

选择所需文件的版本。仅当您想要混合使用两个版本时，才需要复制/编辑文件。

请将 mipadis 答案标记为正确答案。

* * *

## 回答 #3

> 赞同：126
> 
> 时间：2009-08-24T11:31:23.227

您也可以通过以下方式解决此问题

```
git mergetool 
```

这会导致`git`创建冲突二进制文件的本地副本并在其上生成默认编辑器：

*   `{conflicted}.HEAD`
*   `{conflicted}`
*   `{conflicted}.REMOTE`

显然，您无法在文本编辑器中有效地编辑二进制文件。相反，您无需关闭编辑器即可复制新`{conflicted}.REMOTE`文件。`{conflicted}`然后，当您关闭时，编辑器`git`将看到未修饰的工作副本已更改，并且您的合并冲突以通常的方式解决。

* * *

## 回答 #4

> 赞同：20
> 
> 时间：2010-01-29T17:43:30.793

要通过将版本保留在当前分支中来解决（忽略要合并的分支中的版本），只需添加并提交文件：

```
git commit -a 
```

要通过使用您正在合并的分支中的版本覆盖当前分支中的版本来解决问题，您需要先将该版本检索到您的工作目录中，然后添加/提交它：

```
git checkout otherbranch theconflictedfile
git commit -a 
```

[解释得更详细](http://www.lostechies.com/blogs/joshuaflanagan/archive/2010/01/28/how-to-resolve-a-binary-file-conflict-with-git.aspx)

* * *

## 回答 #5

> 赞同：14
> 
> 时间：2014-11-24T02:45:01.247

mipadi 的回答对我来说不太有效，我需要这样做：

> git checkout --ours path/to/file.bin

或者，要保留正在合并的版本：

> git checkout --他们的路径/到/file.bin

然后

> git 添加路径/到/file.bin

然后我能够再次执行“git mergetool”并继续下一个冲突。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2013-05-30T01:07:13.673

从[`git checkout`文档](http://git-scm.com/docs/git-checkout)

> `git checkout [-f|--ours|--theirs|-m|--conflict=<style>] [<tree-ish>] [--] <paths>...`
> 
> **`--ours`**
> **`--theirs`**
> 从索引中检出路径时，请检出阶段 #2 ( `ours`) 或 #3 ( `theirs`) 以获取未合并的路径。
> 
> 由于先前的合并失败，索引可能包含未合并的条目。默认情况下，如果您尝试从索引中签出这样的条目，则签出操作将失败并且不会签出任何内容。使用`-f`将忽略这些未合并的条目。`--ours`可以使用或将来自合并特定侧的内容从索引中检出`--theirs`。使用`-m`，可以丢弃对工作树文件所做的更改，以重新创建原始的冲突合并结果。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2009-07-21T22:29:34.150

我遇到了一个类似的问题（想要拉出一个包含一些在合并时会导致冲突的二进制文件的提交），但遇到了一个可以完全使用 git 完成的不同解决方案（即不必手动复制文件）。我想我会把它放在这里，这样至少下次我需要它时我能记住它。:) 步骤如下所示：

```
% git fetch 
```

这会从远程存储库中获取最新的提交（您可能需要指定远程分支名称，具体取决于您的设置），但不会尝试合并它们。它在 FETCH_HEAD 中记录提交

```
% git checkout FETCH_HEAD stuff/to/update 
```

这将获取我想要的二进制文件的副本，并用从远程分支获取的版本覆盖工作树中的内容。git 不会尝试进行任何合并，因此您最终会得到来自远程分支的二进制文件的精确副本。完成后，您可以像往常一样添加/提交新副本。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2019-03-27T03:54:33.830

此过程用于在您向 Github 提交拉取请求后解决二进制文件冲突：

1.  所以在 Github 上，你发现你的拉取请求在二进制文件上有冲突。
2.  现在回到本地计算机上的同一个 git 分支。
3.  您 (a) 再次重新制作/重新构建此二进制文件，并且 (b) 将生成的二进制文件提交到同一个 git 分支。
4.  然后你再次将这个相同的 git 分支推送到 Github。

在 Github 上，根据您的拉取请求，冲突应该会消失。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2014-11-27T15:46:40.420

我遇到了两种在 Windows 上使用 Git 管理二进制文件差异/合并的策略。

1.  Tortoise git 允许您根据文件扩展名为不同文件类型配置差异/合并工具。见 2.35.4.3。区分/合并高级设置[http://tortoisegit.org/docs/tortoisegit/tgit-dug-settings.html](http://tortoisegit.org/docs/tortoisegit/tgit-dug-settings.html)。这种策略当然依赖于可用的合适的差异/合并工具。

2.  使用 git 属性，您可以指定一个工具/命令来将二进制文件转换为文本，然后让您的默认 diff/merge 工具来做这件事。请参阅[http://git-scm.com/book/it/v2/Customizing-Git-Git-Attributes](http://git-scm.com/book/it/v2/Customizing-Git-Git-Attributes)。这篇文章甚至给出了一个使用元数据来区分图像的例子。

我有两种策略来处理软件模型的二进制文件，但我们使用了 tortoise git，因为配置很简单。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2015-08-13T21:03:13.720

如果二进制文件**不仅仅是 dll**或可以像图像或混合文件一样**直接编辑**的东西（并且您不需要丢弃/选择一个文件或另一个），那么真正的合并将类似于：

我建议搜索一个针对你的二进制文件的差异工具，例如，有一些免费的图像文件

*   npm install -g imagediff IIRC 来自[https://github.com/uber/image-diff](https://github.com/uber/image-diff)
*   或 python [https://github.com/kaikuehne/mirror.git](https://github.com/kaikuehne/mirror.git)
*   还有其他人在那里

并比较它们。

如果没有用于比较文件的 diff 工具，那么如果您有 bin 文件的**原始生成器**（也就是说，**存在**用于它的编辑器...例如 blender 3d，那么您也可以手动检查这些文件查看日志，并询问其他人您应该包含哪些内容）并使用[https://git-scm.com/book/es/v2/Git-Tools-Advanced-Merging#_manual_remerge输出文件](https://git-scm.com/book/es/v2/Git-Tools-Advanced-Merging#_manual_remerge)

```
$ git show :1:hello.blend > hello.common.blend
$ git show :2:hello.blend > hello.ours.blend
$ git show :3:hello.blend > hello.theirs.blend 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2019-03-19T18:55:04.320

我使用 Git Workflow for Excel - [https://www.xltrail.com/blog/git-workflow-for-excel](https://www.xltrail.com/blog/git-workflow-for-excel)应用程序来解决我的大多数与二进制文件相关的合并问题。这个开源应用程序可以帮助我高效地解决问题，而无需花费太多时间，并且让我可以挑选正确的文件版本而不会产生任何混淆。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2019-04-11T08:55:38.013

我的情况似乎是一个错误....使用 git 2.21.0

我做了一个拉......它抱怨二进制文件：

```
warning: Cannot merge binary files: <path>
Auto-merging <path>
CONFLICT (content): Merge conflict in <path>
Automatic merge failed; fix conflicts and then commit the result. 
```

然后，这里的任何答案都没有导致任何有意义的输出。

如果我查看我现在拥有的文件……那是我编辑的那个。如果我这样做：

```
git checkout --theirs -- <path>
git checkout --ours -- <path> 
```

我得到输出：

```
Updated 0 paths from the index 
```

我仍然有我的文件版本。如果我 rm 然后结帐，它会改为 1，但它仍然给我我的文件版本。

git mergetool 说

```
No files need merging 
```

和 git status 说

```
 All conflicts fixed but you are still merging.
    (use "git commit" to conclude merge) 
```

一种选择是[撤消提交](https://stackoverflow.com/questions/927358/how-do-i-undo-the-most-recent-local-commits-in-git)......但我很不幸，我有很多提交，而这个糟糕的提交是第一个。我不想浪费时间重复这一点。

**所以要解决这个疯狂：**

我刚跑

```
git commit 
```

这会丢失远程版本，并且可能会浪费一些空间来存储额外的二进制文件......然后

```
git checkout <commit where the remote version exists> <path> 
```

这给了我远程版本

然后再次编辑文件......然后提交并推送，这可能再次意味着浪费空间与二进制文件的另一个副本。

# openoffice.org - OpenOffice 电子表格导入 HSQLDB

> ID：278082
> 
> 赞同：0
> 
> 时间：2008-11-10T15:03:45.420
> 
> 标签：openoffice.org, hsqldb, file-conversion

OpenOffice 附带 HSQLDB。是否可以轻松地将 OO 电子表格的内容导入内置数据库？一个额外的好处是包含单元格内容的格式。IE。颜色，换行符等。

这个问题没有答案，所以我提供赏金。请提供解决方案的代码。

提供的链接确实有效，不需要编码。总结一下：

1.  创建并注册一个 Open Office DB。
    1.1 看起来您可以注册任何拥有 JDBC 驱动程序的数据库。（即MySql，Postgres）
2.  在第 1 行中创建列标题。
3.  选择数据并将其复制到剪贴板。
    3.1 将选择限制为仅所需的行，因为当我选择所有行时 OO 崩溃。
4.  转到数据库的表（表窗格）视图。
5.  右键单击并粘贴您的数据。
6.  按照打开的向导提供的说明进行操作。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-10T20:08:55.850

我不知道您是否认为这很容易，但显然有一些方法可以将数据导入开放式办公室的基础数据库。

本文[介绍](http://sheepdogguides.com/fdb/fdb1imp1.htm)如何手动将数据导入数据库。这篇[文章](http://searchenterpriselinux.techtarget.com/tip/0,289483,sid39_gci1222186,00.html)有更多关于相同过程的漂亮图片。您可能没有得到您想要的答案的一个原因是您的问题中的细节很少。您可以添加更多，也许有人可以提供帮助。

# visual-studio - 如何在 Visual Studio 6.0 或 Embedded VC++ (eVC) 中将对话框资源从一个项目复制到另一个项目？

> ID：278085
> 
> 赞同：6
> 
> 时间：2008-11-10T15:06:16.460
> 
> 标签：visual-studio, resource-files

我有两个代码分支。1 有一个对话框，另一个没有，但由于政治原因，对话框没有移到最新的分支中。现在他们想要它...

那么是否可以将对话框从一个项目复制到另一个项目。似乎有一个导出和导入功能，但是它是灰色的。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-10T16:37:29.320

.RC ​​文件是简单的文本文件。您可以简单地将 DIALOG 文本从一个 .RC 文件复制/粘贴到另一个文件。确保您也复制了相应的 RESOURCE.H 条目。

或者，您可以打开两个 .RC 文件，然后简单地将对话框从一个拖放到另一个。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2014-08-21T00:05:25.497

Visual Studio 2010 - 2013 更新：

您仍然可以拖放和复制粘贴，但只能**在**您的项目/解决方案之外。

关闭解决方案，将两个 RC 作为文件打开，没有任何打开的解决方案，然后继续。对于拖动，“按住 CTRL 键并将资源拖动到第二个 .rc 文件。例如，将 IDD_DIALOG1 从 Source1.rc 拖动到 Source2.rc。”

Microsoft -[如何复制资源](http://msdn.microsoft.com/en-us/library/a5axa064.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-07-14T15:54:34.563

拖放在 Visual Studio 2010 中不起作用。编辑 .RC 文件确实有效，但要小心。对我来说，对话框的 ID 显示为 *ID_etc*。我复制了它并删除了*，它似乎解决了这个问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2019-10-17T13:37:28.383

我终于弄清楚如何将对话框从一个解决方案复制到另一个解决方案。脚步：

1.  在单独的窗口中打开这两个解决方案。
2.  添加一个新的空白对话框-添加资源->添加->新对话框
3.  打开两个对话框打开二进制数据。
4.  将二进制数据从源解决方案对话框复制到目标对话框

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2021-05-27T10:36:41.023

这只是为接受的答案（Roger Lipscombe）及其步骤添加一些视觉细节。

为了从一个项目复制一个资源，例如另一个项目的对话框，可以遵循以下步骤。

1.  启动 Visual Studio 的新实例。
2.  如图所示，将源和目标 .RC 文件作为文件打开。
3.  从源 RC 文件中，复制所需的对话框。
4.  切换到目标 RC 文件选项卡并简单地粘贴它。

请注意，此操作会更新 resource.h 文件。这是 Visual Studio 的绝佳帮助。

必须确保 resource.h 文件中不存在重复的资源 ID。在处理一些遗留项目时，发现有一些重复的资源 Id 必须手动更正。看起来这样的努力值得考虑否则需要完成的艰巨任务。

[![在此处输入图像描述](https://i.stack.imgur.com/B5Hdx.png)](https://i.stack.imgur.com/B5Hdx.png)

# javascript - Javascript对选择元素的内容进行排序

> ID：278089
> 
> 赞同：47
> 
> 时间：2008-11-10T15:09:56.627
> 
> 标签：javascript, select

有没有一种快速的方法来对选择元素的项目进行排序？还是我不得不求助于编写javascript？

请有任何想法。

```
<select size="4" name="lstALL" multiple="multiple" id="lstALL" tabindex="12" style="font-size:XX-Small;height:95%;width:100%;">
<option value="0"> XXX</option>
<option value="1203">ABC</option>
<option value="1013">MMM</option>
</select> 
```

* * *

## 回答 #1

> 赞同：75
> 
> 时间：2008-11-10T17:08:40.240

这会成功的。只需将您的选择元素传递给它：`document.getElementById('lstALL')`当您需要对列表进行排序时。

```
function sortSelect(selElem) {
    var tmpAry = new Array();
    for (var i=0;i<selElem.options.length;i++) {
        tmpAry[i] = new Array();
        tmpAry[i][0] = selElem.options[i].text;
        tmpAry[i][1] = selElem.options[i].value;
    }
    tmpAry.sort();
    while (selElem.options.length > 0) {
        selElem.options[0] = null;
    }
    for (var i=0;i<tmpAry.length;i++) {
        var op = new Option(tmpAry[i][0], tmpAry[i][1]);
        selElem.options[i] = op;
    }
    return;
} 
```

* * *

## 回答 #2

> 赞同：46
> 
> 时间：2011-09-19T03:33:42.613

这个解决方案对我使用 jquery 非常有效，我想我会在这里交叉引用它，因为我在另一个页面之前找到了这个页面。其他人可能也会这样做。

```
$("#id").html($("#id option").sort(function (a, b) {
    return a.text == b.text ? 0 : a.text < b.text ? -1 : 1
})) 
```

从[使用 Javascript 排序下拉列表](https://stackoverflow.com/questions/667010/sorting-dropdown-list-using-javascript/667198#667198)

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2012-02-08T19:55:04.697

使用 Marco Lazzeri 和 Terre Porter 提供的答案（如果这个答案有用，请投票），我想出了一个稍微不同的解决方案，可以保留所选值（可能不保留事件处理程序或附加数据）使用**jQuery** .

```
// save the selected value for sorting
var v = jQuery("#id").val();

// sort the options and select the value that was saved
j$("#id")
    .html(j$("#id option").sort(function(a,b){
        return a.text == b.text ? 0 : a.text < b.text ? -1 : 1;}))
    .val(v); 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2019-06-21T22:12:46.713

## Vanilla JS es6 本地化选项排序示例

```
const optionNodes = Array.from(selectNode.children);
const comparator = new Intl.Collator(lang.slice(0, 2)).compare;

optionNodes.sort((a, b) => comparator(a.textContent, b.textContent));
optionNodes.forEach((option) => selectNode.appendChild(option)); 
```

我的用例是使用区域感知排序来本地化国家/地区选择下拉列表。这用于 250 + 选项，并且在我的机器上性能非常好**~ 10 毫秒。**

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-11-10T15:18:13.020

来自[W3C 常见问题解答](http://www.w3.org/International/questions/qa-select-sorting.en.php)：

> 尽管许多编程语言都有像下拉框这样的设备，它们能够在显示项目列表之前对其进行排序，作为其功能的一部分，但 HTML <select> 函数没有这样的能力。它按收到的顺序列出 <options>。

对于静态 HTML 文档，您必须手动对它们进行排序，或者对动态文档使用 Javascript 或其他一些编程排序。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2011-03-30T18:14:33.737

另外一个选项：

```
function sortSelect(elem) {
    var tmpAry = [];
    // Retain selected value before sorting
    var selectedValue = elem[elem.selectedIndex].value;
    // Grab all existing entries
    for (var i=0;i<elem.options.length;i++) tmpAry.push(elem.options[i]);
    // Sort array by text attribute
    tmpAry.sort(function(a,b){ return (a.text < b.text)?-1:1; });
    // Wipe out existing elements
    while (elem.options.length > 0) elem.options[0] = null;
    // Restore sorted elements
    var newSelectedIndex = 0;
    for (var i=0;i<tmpAry.length;i++) {
        elem.options[i] = tmpAry[i];
        if(elem.options[i].value == selectedValue) newSelectedIndex = i;
    }
    elem.selectedIndex = newSelectedIndex; // Set new selected index after sorting
    return;
} 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2013-10-19T07:00:38.573

这是我在这个板上最喜欢的 3 个答案的重新编译：

*   jOk 的最佳和最简单的答案。
*   Terry Porter 的简单 jQuery 方法。
*   SmokeyPHP 的可配置函数。

结果是一个易于使用且易于配置的功能。

第一个参数可以是选择对象、选择对象的 ID 或至少具有 2 维的数组。

第二个参数是可选的。默认按选项文本排序，索引 0。可以传递任何其他索引，因此对其进行排序。可以传递 1 或文本“值”，以按值排序。

## 按文本示例排序（全部按文本排序）：

```
 sortSelect('select_object_id');
 sortSelect('select_object_id', 0);
 sortSelect(selectObject);
 sortSelect(selectObject, 0); 
```

## 按值排序（全部按值排序）：

```
 sortSelect('select_object_id', 'value');
 sortSelect('select_object_id', 1);
 sortSelect(selectObject, 1); 
```

## 按另一个索引对任何数组进行排序：

```
var myArray = [
  ['ignored0', 'ignored1', 'Z-sortme2'],
  ['ignored0', 'ignored1', 'A-sortme2'],
  ['ignored0', 'ignored1', 'C-sortme2'],
];

sortSelect(myArray,2); 
```

最后一个将按 index-2 对数组进行排序，即 sortme 的。

# 主要排序功能

```
function sortSelect(selElem, sortVal) {

    // Checks for an object or string. Uses string as ID. 
    switch(typeof selElem) {
        case "string":
            selElem = document.getElementById(selElem);
            break;
        case "object":
            if(selElem==null) return false;
            break;
        default:
            return false;
    }

    // Builds the options list.
    var tmpAry = new Array();
    for (var i=0;i<selElem.options.length;i++) {
        tmpAry[i] = new Array();
        tmpAry[i][0] = selElem.options[i].text;
        tmpAry[i][1] = selElem.options[i].value;
    }

    // allows sortVal to be optional, defaults to text.
    switch(sortVal) {
        case "value": // sort by value
            sortVal = 1;
            break;
        default: // sort by text
            sortVal = 0;
    }
    tmpAry.sort(function(a, b) {
        return a[sortVal] == b[sortVal] ? 0 : a[sortVal] < b[sortVal] ? -1 : 1;
    });

    // removes all options from the select.
    while (selElem.options.length > 0) {
        selElem.options[0] = null;
    }

    // recreates all options with the new order.
    for (var i=0;i<tmpAry.length;i++) {
        var op = new Option(tmpAry[i][0], tmpAry[i][1]);
        selElem.options[i] = op;
    }

    return true;
} 
```

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-06-05T13:17:00.797

我有同样的问题。这是我想出的**jQuery 解决方案：**

```
 var options = jQuery.makeArray(optionElements).
                       sort(function(a,b) {
                         return (a.innerHTML > b.innerHTML) ? 1 : -1;
                       });
  selectElement.html(options); 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2013-07-17T14:54:00.997

我有一个类似的问题，除了我希望所选项目显示在顶部，并且我不想清除哪些项目被选中（多选列表）。我的是基于jQuery的...

```
function SortMultiSelect_SelectedTop(slt) {
    var options =
        $(slt).find("option").sort(function (a, b) {
            if (a.selected && !b.selected) return -1;
            if (!a.selected && b.selected) return 1;
            if (a.text < b.text) return -1;
            if (a.text > b.text) return 1;
            return 0;
        });
    $(slt).empty().append(options).scrollTop(0);
} 
```

如果没有在顶部选择，它看起来像这样。

```
function SortMultiSelect(slt) {
    var options =
        $(slt).find("option").sort(function (a, b) {
            if (a.text < b.text) return -1;
            if (a.text > b.text) return 1;
            return 0;
        });
    $(slt).empty().append(options).scrollTop(0);
} 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-11-10T15:16:35.100

是的，DOK 有正确的答案......要么在编写 HTML 之前对结果进行预排序（假设它是动态的并且你负责输出），要么你编写 javascript。

[Javascript 排序](http://www.w3schools.com/jsref/jsref_sort.asp)方法将成为您的朋友。只需将值从选择列表中拉出，然后对其进行排序，然后将它们放回去:-)

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2011-03-04T20:46:31.417

Í 认为这是一个更好的选择（我使用@Matty 的代码并进行了改进！）：

```
function sortSelect(selElem, bCase) {
                var tmpAry = new Array();
                bCase = (bCase ? true : false);
                for (var i=0;i<selElem.options.length;i++) {
                        tmpAry[i] = new Array();
                        tmpAry[i][0] = selElem.options[i].text;
                        tmpAry[i][1] = selElem.options[i].value;
                }
                if (bCase)
                    tmpAry.sort(function (a, b) {
                        var ret = 0;
                        var iPos = 0;
                        while (ret == 0 && iPos < a.length && iPos < b.length)
                        {
                            ret = (String(a).toLowerCase().charCodeAt(iPos) - String(b).toLowerCase().charCodeAt(iPos));
                            iPos ++;
                        }
                        if (ret == 0)
                        {
                            ret = (String(a).length - String(b).length);
                        }
                        return ret;
                        });
                else
                    tmpAry.sort();
                while (selElem.options.length > 0) {
                    selElem.options[0] = null;
                }
                for (var i=0;i<tmpAry.length;i++) {
                        var op = new Option(tmpAry[i][0], tmpAry[i][1]);
                        selElem.options[i] = op;
                }
                return;
        } 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2011-06-29T13:26:38.010

我使用了这种冒泡排序，因为我无法通过选项数组中的 .value 对它们进行排序，并且它是一个数字。这样我就可以正确订购它们。我希望它对你也有用。

```
function sortSelect(selElem) {
  for (var i=0; i<(selElem.options.length-1); i++)
      for (var j=i+1; j<selElem.options.length; j++)
          if (parseInt(selElem.options[j].value) < parseInt(selElem.options[i].value)) {
              var dummy = new Option(selElem.options[i].text, selElem.options[i].value);
              selElem.options[i] = new Option(selElem.options[j].text, selElem.options[j].value);
              selElem.options[j] = dummy;
          }
} 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2013-07-17T15:44:07.677

我很快将一个允许选择方向（“asc”或“desc”）、是否应在选项值（真或假）上进行比较以及是否应在比较前修剪前导和尾随空格的方法放在一起（布尔值）。

这种方法的好处是保留了选定的选项，并且还应保留所有其他特殊属性/触发器。

```
function sortOpts(select,dir,value,trim)
{
    value = typeof value == 'boolean' ? value : false;
    dir = ['asc','desc'].indexOf(dir) > -1 ? dir : 'asc';
    trim = typeof trim == 'boolean' ? trim : true;
    if(!select) return false;
    var opts = select.getElementsByTagName('option');

    var options = [];
    for(var i in opts)
    {
        if(parseInt(i)==i)
        {
            if(trim)
            {
                opts[i].innerHTML = opts[i].innerHTML.replace(/^\s*(.*)\s*$/,'$1');
                opts[i].value = opts[i].value.replace(/^\s*(.*)\s*$/,'$1');
            }
            options.push(opts[i]);
        }
    }
    options.sort(value ? sortOpts.sortVals : sortOpts.sortText);
    if(dir == 'desc') options.reverse();
    options.reverse();
    for(var i in options)
    {
        select.insertBefore(options[i],select.getElementsByTagName('option')[0]);
    }
}
sortOpts.sortText = function(a,b) {
    return a.innerHTML > b.innerHTML ? 1 : -1;
}
sortOpts.sortVals = function(a,b) {
    return a.value > b.value ? 1 : -1;
} 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2014-06-27T19:52:26.890

受@Terre Porter 回答的启发，我认为这个实现起来非常简单（使用jQuery）

```
var $options = jQuery("#my-dropdownlist-id > option"); 
// or jQuery("#my-dropdownlist-id").find("option")

$options.sort(function(a, b) {
    return a.text == b.text ? 0 : a.text < b.text ? -1 : 1
}) 
```

但是，对于字母/数字下拉列表：

灵感来自：[https ://stackoverflow.com/a/4340339/1598891](https://stackoverflow.com/a/4340339/1598891)

```
var $options = jQuery(dropDownList).find("option");

var reAlpha = /[^a-zA-Z]/g;
var reNumeric = /[^0-9]/g;
$options.sort(function AlphaNumericSort($a,$b) {
    var a = $a.text;
    var b = $b.text;
    var aAlpha = a.replace(reAlpha, "");
    var bAlpha = b.replace(reAlpha, "");
    if(aAlpha === bAlpha) {
        var aNumeric = parseInt(a.replace(reNumeric, ""), 10);
        var bNumeric = parseInt(b.replace(reNumeric, ""), 10);
        return aNumeric === bNumeric ? 0 : aNumeric > bNumeric ? 1 : -1;
    } else {
        return aAlpha > bAlpha ? 1 : -1;
    }
}) 
```

希望它会有所帮助

![第一个例子](https://i.stack.imgur.com/MI8xi.png) ![第二个例子](https://i.stack.imgur.com/IUtac.png)

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2015-01-07T17:37:25.813

```
function call() {
    var x = document.getElementById("mySelect");
    var optionVal = new Array();

    for (i = 0; i < x.length; i++) {
        optionVal.push(x.options[i].text);
    }

    for (i = x.length; i >= 0; i--) {
        x.remove(i);
    }

    optionVal.sort();

    for (var i = 0; i < optionVal.length; i++) {
        var opt = optionVal[i];
        var el = document.createElement("option");
        el.textContent = opt;
        el.value = opt;
        x.appendChild(el);
    }
} 
```

想法是将选择框的所有元素拉出到一个数组中，删除选择框值以避免覆盖，对数组进行排序，然后将排序后的数组推回选择框

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2010-04-13T19:50:20.403

不像 Marco 的 JQuery 示例那么漂亮，但使用原型（我可能缺少更优雅的解决方案）它将是：

```
function sort_select(select) {
  var options = $A(select.options).sortBy(function(o) { return o.innerHTML });
  select.innerHTML = "";
  options.each(function(o) { select.insert(o); } );
} 
```

然后只需传递一个选择元素：

```
sort_select( $('category-select') ); 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2012-08-31T07:39:12.967

使用 jQuery 的另一种方法：

```
// sorting;
var selectElm = $("select"),
    selectSorted = selectElm.find("option").toArray().sort(function (a, b) {
        return (a.innerHTML.toLowerCase() > b.innerHTML.toLowerCase()) ? 1 : -1;
    });
selectElm.empty();
$.each(selectSorted, function (key, value) {
    selectElm.append(value);
}); 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2013-11-29T07:01:26.523

试试这个......希望它会为您提供解决方案：

```
function sortlist_name()
{

    var lb = document.getElementById('mylist');
    arrTexts = new Array();
    newTexts = new Array();
    txt = new Array();
    newArray =new Array();
    for(i=0; i<lb.length; i++)
    {
      arrTexts[i] = lb.options[i].text;
    }
    for(i=0;i<arrTexts.length; i++)
    {
        str = arrTexts[i].split(" -> ");
        newTexts[i] = str[1]+' -> '+str[0];
    }
    newTexts.sort();
    for(i=0;i<newTexts.length; i++)
    {
        txt = newTexts[i].split(' -> ');
        newArray[i] = txt[1]+' -> '+txt[0];
    }
    for(i=0; i<lb.length; i++)
    {
        lb.options[i].text = newArray[i];
        lb.options[i].value = newArray[i];
    }
}
/***********revrse by name******/
function sortreverse_name()
{

    var lb = document.getElementById('mylist');
    arrTexts = new Array();
    newTexts = new Array();
    txt = new Array();
    newArray =new Array();
    for(i=0; i<lb.length; i++)
    {
      arrTexts[i] = lb.options[i].text;
    }
    for(i=0;i<arrTexts.length; i++)
    {
        str = arrTexts[i].split(" -> ");
        newTexts[i] = str[1]+' -> '+str[0];
    }
    newTexts.reverse();
    for(i=0;i<newTexts.length; i++)
    {
        txt = newTexts[i].split(' -> ');
        newArray[i] = txt[1]+' -> '+txt[0];
    }
    for(i=0; i<lb.length; i++)
    {
        lb.options[i].text = newArray[i];
        lb.options[i].value = newArray[i];
    }
}

function sortlist_id() {
var lb = document.getElementById('mylist');
arrTexts = new Array();

for(i=0; i<lb.length; i++)  {
  arrTexts[i] = lb.options[i].text;
}

arrTexts.sort();

for(i=0; i<lb.length; i++)  {
  lb.options[i].text = arrTexts[i];
  lb.options[i].value = arrTexts[i];
}
}

/***********revrse by id******/
function sortreverse_id() {
var lb = document.getElementById('mylist');
arrTexts = new Array();

for(i=0; i<lb.length; i++)  {
  arrTexts[i] = lb.options[i].text;
}

arrTexts.reverse();

for(i=0; i<lb.length; i++)  {
  lb.options[i].text = arrTexts[i];
  lb.options[i].value = arrTexts[i];
}
}
</script>

  ID<a href="javascript:sortlist_id()"> &#x25B2;  </a> <a href="javascript:sortreverse_id()">&#x25BC;</a> |  Name<a href="javascript:sortlist_name()"> &#x25B2;  </a> <a href="javascript:sortreverse_name()">&#x25BC;</a><br/>

<select name=mylist id=mylist size=8 style='width:150px'>

<option value="bill">4 -> Bill</option>
<option value="carl">5 -> Carl</option>
<option value="Anton">1 -> Anton</option>
<option value="mike">2 -> Mike</option>
<option value="peter">3 -> Peter</option>
</select>
<br> 
```

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2015-07-27T12:21:27.050

```
function sortItems(c) {
var options = c.options;
Array.prototype.sort.call(options, function (a, b) {
    var aText = a.text.toLowerCase();
    var bText = b.text.toLowerCase();
    if (aText < bText) {
        return -1;
    } else if (aText > bText) {
        return 1;
    } else {
        return 0;
    }
});
}

sortItems(document.getElementById('lstALL')); 
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2019-09-18T17:29:44.913

对于那些想要排序是否有[optgroup](https://www.w3schools.com/tags/tag_optgroup.asp)的人：

```
/**
 * Sorting options 
 * and optgroups
 * 
 * @param selElem select element
 * @param optionBeforeGroup ?bool if null ignores, if true option appear before group else option appear after group
 */
function sortSelect(selElem, optionBeforeGroup = null) {
    let initialValue = selElem.tagName === "SELECT" ? selElem.value : null; 
    let allChildrens = Array.prototype.slice.call(selElem.childNodes);
    let childrens = [];

    for (let i = 0; i < allChildrens.length; i++) {
        if (allChildrens[i].parentNode === selElem && ["OPTGROUP", "OPTION"].includes(allChildrens[i].tagName||"")) {
            if (allChildrens[i].tagName == "OPTGROUP") {
                sortSelect(allChildrens[i]);
            }
            childrens.push(allChildrens[i]);
        }
    }

    childrens.sort(function(a, b){
        let x = a.tagName == "OPTGROUP" ? a.getAttribute("label") : a.innerHTML;
        let y = b.tagName == "OPTGROUP" ? b.getAttribute("label") : b.innerHTML;
        x = typeof x === "undefined" || x === null ? "" : (x+"");
        y = typeof y === "undefined" || y === null ? "" : (y+"");

        if (optionBeforeGroup === null) {
            if (x.toLowerCase().trim() < y.toLowerCase().trim()) {return -1;}
            if (x.toLowerCase().trim() > y.toLowerCase().trim()) {return 1;}
        } else if (optionBeforeGroup === true) {
            if ((a.tagName == "OPTION" && b.tagName == "OPTGROUP") || x.toLowerCase().trim() < y.toLowerCase().trim()) {return -1;}
            if ((a.tagName == "OPTGROUP" && b.tagName == "OPTION") || x.toLowerCase().trim() > y.toLowerCase().trim()) {return 1;}
        } else if (optionBeforeGroup === false) {
            if ((a.tagName == "OPTGROUP" && b.tagName == "OPTION") || x.toLowerCase().trim() < y.toLowerCase().trim()) {return -1;}
            if ((a.tagName == "OPTION" && b.tagName == "OPTGROUP") || x.toLowerCase().trim() > y.toLowerCase().trim()) {return 1;}
        }
        return 0;
    });

    if (optionBeforeGroup !== null) {
        childrens.sort(function(a, b){
            if (optionBeforeGroup === true) {
                if (a.tagName == "OPTION" && b.tagName == "OPTGROUP") {return -1;}
                if (a.tagName == "OPTGROUP" && b.tagName == "OPTION") {return 1;}
            } else {
                if (a.tagName == "OPTGROUP" && b.tagName == "OPTION") {return -1;}
                if (a.tagName == "OPTION" && b.tagName == "OPTGROUP") {return 1;}
            }
            return 0;
        });
    }

    selElem.innerHTML = "";
    for (let i = 0; i < childrens.length; i++) {
        selElem.appendChild(childrens[i]);
    }

    if (selElem.tagName === "SELECT") {
        selElem.value = initialValue;
    }
} 
```

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2021-06-06T16:15:16.723

我认为我的函数对于字符串或数字更通用，并且如果第一个元素可能意味着全部，则不会对其进行排序。

```
/** Check if a string can be parsed as a number. */
function isNumber(n) { return !isNaN(parseFloat(n)) && !isNaN(n - 0) };

/** Sort options of HTML elements. */
function sortOptions(selectElement, exceptFirstOpt=false) {

    // List of options.
    var options = selectElement.options;
    // If empty list, do nothing.
    if(!options || options.length==0) return;

    // Array.
    var optionsArray = [];
    for (var i = (exceptFirstOpt ? 1 : 0); i < options.length; i++)
        optionsArray.push(options[i]);
    // Sort.
    optionsArray = optionsArray.sort(function (a, b) {      
        let v1 = a.innerHTML.toLowerCase();
        let v2 = b.innerHTML.toLowerCase();
        if((v1==undefined || v1 == '') && (v2==undefined || v2 == ''))
            return 0;
        else if(v1==undefined || v1.trim() == '') return 1;
        else if(v2==undefined || v2.trim() == '') return -1;

        // If number.
        if(isNumber(v1) && isNumber(v2))
            return parseFloat(v1)>parseFloat(v2);

        return v1.localeCompare(v2);   
    });

    // Update options.
    for (var i = 0; i <= optionsArray.length; i++)            
        options[i + (exceptFirstOpt ? 1 : 0)] = optionsArray[i];
    // First option selected by default.
    options[0].selected = true;
} 
```

# perl - 如何从 Perl 创建或读取 OpenOffice 电子表格？

> ID：278090
> 
> 赞同：4
> 
> 时间：2008-11-10T15:10:26.717
> 
> 标签：perl, openoffice.org, spreadsheet

在 Perl 中创建和读取 OpenOffice 电子表格的好方法是什么？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-11-10T15:41:24.550

我认为 Open Office 原生文档格式基于 OpenDocument 规范，基本上是一种 zip 压缩的 XML 格式。这是真的，您可能可以使用您选择的 perl XML 操作工具来操作它。

或者，[CPAN 上有 Open Office OpenDocument 连接器模块套件，](http://search.cpan.org/perldoc?OpenOffice::OODoc::Intro)它为 OpenDocument 规范提供了高级 API。

据我所知，这些模块中的表格方法应该允许在 OO Calc 文档中读取和写入数据。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-10T15:32:00.637

我使用[OpenOffice::OOCBuilder](http://search.cpan.org/dist/OpenOffice-OOBuilder/)创建大型颜色编码表。非常喜欢。对于更简单的任务，我经常使用任何电子表格程序都可以轻松打开的纯 CSV 格式

但是，您可能会选择 Excel 的东西来与其他人兼容。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-10T15:14:14.993

OpenOffice 支持多种格式，如果您正在寻找可以读/写与 Excel 兼容的电子表格的东西，请查看[Spreadsheet::ParseExcel](http://search.cpan.org/~jmcnamara/Spreadsheet-ParseExcel-0.41/lib/Spreadsheet/ParseExcel.pm)进行阅读，并使用[Spreadsheet::WriteExcel](http://search.cpan.org/~jmcnamara/Spreadsheet-WriteExcel-2.25/lib/Spreadsheet/WriteExcel.pm)进行写作。我都用过它们，它们非常成熟并且运行良好。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-05-06T10:05:59.580

这是 2.4 版本，因为最新版本不稳定。尽管有时它确实适用于最新版本。这将允许 Calc 中的实时 DDE 功能，而不是操作文件。这是在 XP 上使用 Cygwin Perl，但应该与其他人一起使用。我只想说 Excel VBA 编程 API 好 10 倍，而混乱少 10 倍。这很糟糕。

[代码]

```
use Win32::OLE;

Win32::OLE->Option(Warn => 3); # Turn on warnings for easier debugging

#Win32::OLE->GetActiveObject
# Get the currently running process or create a new one
$objServiceManager = Win32::OLE->GetActiveObject("com.sun.star.ServiceManager") || Win32::OLE->new("com.sun.star.ServiceManager") || die "CreateObject: $!"; 

$Stardesktop = $objServiceManager->createInstance("com.sun.star.frame.Desktop");

# $Stardesktop->terminate();exit; # will kill ALL OpenOffice docs!!!
# Doc = StarDesktop.loadComponentFromURL(sURL, "_default", 0, aMediaDesc)

$propValue[0] = $objServiceManager->Bridge_GetStruct("com.sun.star.beans.PropertyValue");
$propValue[0]->{Name} = "Hidden"; # This does not work!
$propValue[0]->{Value} = 1;

#Open the file and update its links if you have DDE links in your file
$propValue[1] = $objServiceManager->Bridge_GetStruct("com.sun.star.beans.PropertyValue");
$propValue[1]->{Name} = "UpdateDocMode";
$propValue[1]->{Value} = 3; # com.sun.star.document.UpdateDocMode.FULL_UPDATE

$calc = $Stardesktop->loadComponentfromUrl("file:///C:/Documents and Settings/Chloe/Desktop/MyFile.ods", "MyCalc", 0, \@propValue );
# load a new blank spreadsheet
$calc = $Stardesktop->loadComponentFromURL( "private:factory/scalc", "_blank", 0, [] );

# How to hide, as loading the document hidden does not work.
$calc->getCurrentController->getFrame->getContainerWindow()->setVisible(0);

$oSheet = $calc->getSheets->getByIndex(0);

# how to execute an UNO command, such as menu items
# http://wiki.services.openoffice.org/wiki/Framework/Article/OpenOffice.org_2.x_Commands
$frame = $calc->getCurrentController->getFrame;
$dispatchHelper = $objServiceManager->createInstance("com.sun.star.frame.DispatchHelper");
$dispatchHelper->executeDispatch(
    $frame, 
    ".uno:CalculateHard",
    #".uno:UpdateAll", 
    #".uno:UpdateAllLinks", 
    #".uno:DataAreaRefresh",
    "_self",
    0,
    []
);

$row = 5;
$cellValue = $oSheet->getCellByPosition(0, $row)->getString(); # get a cell value

# sort in decending order
$range = $oSheet->getCellRangeByName("A1:P$row");
$fields[0] = $objServiceManager->Bridge_GetStruct("com.sun.star.table.TableSortField");
$fields[0]->{Field} = 7; # column number
$fields[0]->{IsAscending} = 0;
$unoWrap = $objServiceManager->Bridge_GetValueObject;
$unoWrap->Set ("[]com.sun.star.table.TableSortField", \@fields);
$sortDx = $range->createSortDescriptor();
$sortDx->[0]->{Name} = "ContainsHeader";
$sortDx->[0]->{Value} = 1;
$sortDx->[3]->{Name} = "SortFields";
$sortDx->[3]->{Value} = $unoWrap;
#$sortDx->[3]->{Value} = \@fields; # You would think this would work? It doesn't.
$range->sort($sortDx);

# create a new sheet to paste to
$calc->getSheets->insertNewByName("NewSheet", 1 );
$sheet2 = $calc->getSheets->getByIndex(1);
$calc->CurrentController->Select($sheet2);

# copy row
$pasteHere = $sheet2->getCellByPosition(0, 0)->CellAddress;
$copyRange = $oSheet->getCellRangeByName("A1:Q1")->RangeAddress;
$oSheet->copyRange($pasteHere, $copyRange);

$cellValue = $sheet2->getCellByPosition(16, $row)->getValue()); # get cell value as integer
$date = $sheet2->getCellByPosition(5, $row)->getString(); # must get dates as strings

$calc->getCurrentController->getFrame->getContainerWindow()->setVisible(1); # set visible
$calc->close(0); # close program window
#print Win32::OLE->LastError, "\n"; 
```

[/代码]

# parallel-processing - 免费的 OpenMosix 替换？

> ID：278096
> 
> 赞同：10
> 
> 时间：2008-11-10T15:11:12.940
> 
> 标签：parallel-processing, cluster-computing, mosix

得知 OpenMosix 已[关闭](http://openmosix.sourceforge.net/)，我感到很震惊。你能推荐任何类似的Linux免费工具吗？

对于那些不知道的人，OpenMosix 是

> 一个软件包，它将运行 GNU/Linux 的联网计算机变成一个集群。它自动平衡集群不同节点之间的负载，节点可以在不中断服务的情况下加入或离开正在运行的集群。负载根据节点的连接和 CPU 速度分布在节点之间。

最好的部分是您不需要将程序与任何特殊库链接，也不需要修改程序。只是“分叉并忘记”。

另一个不错的（但不是必须的）功能是它不必安装在专用计算机上，而是可以安装在组织/实验室/家庭等中的各种台式计算机上。

我知道几种可能的解决方案的名称（[例如](http://en.wikipedia.org/wiki/Single-system_image)）。我正在寻找个人经验和/或好评

**EDIT** [Mosix](http://www.mosix.org/)是 OpenMosix 的前身，曾经是免费的（作为免费啤酒）。不过现在要[花钱了](http://www.mosix.com.au/prices.html)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-10T16:25:51.870

我不确定它在功能方面与 OpenMosix 相比如何，但[Rocks](http://www.rocksclusters.org/)是一个开源集群 Linux 发行版。

[从网站](http://www.rocksclusters.org/wordpress/?page_id=57)：

> Rocks 是一个开源 Linux 集群发行版，使最终用户能够轻松构建计算集群、网格端点和可视化平铺显示墙。来自世界各地的数百名研究人员已经使用 Rocks 部署了自己的集群

您可能想收听[这一集](http://twit.tv/floss30)关于岩石的 FLOSS Weekly。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-10T18:57:23.703

无耻地从 Beowulf 邮件列表中删除：

[OpenSSI](http://openssi.org)或

[Mosix](http://www.mosix.org)如果您不需要完全开源的解决方案并且是非营利组织。

如需更深入的讨论，请查看此线程： [Beowulf - open mosix Alternative](http://www.beowulf.org/pipermail/beowulf/2008-July/021978.html)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-04-16T07:25:06.577

与 openMosix 技术类似的壁橱免费解决方案是[Kerriged](http://www.kerrighed.org/wiki/index.php/Main_Page)。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2016-01-20T17:18:54.150

为了帮助使这个死线程更有用，一个更现代的替代方案是 criu（用户空间中的检查点和恢复）。

参见例如：

[https://chandanduttachowdhury.wordpress.com/2015/08/10/test-driving-criu-live-migrate-any-process-on-linux/](https://chandanduttachowdhury.wordpress.com/2015/08/10/test-driving-criu-live-migrate-any-process-on-linux/)

[http://criu.org/](http://criu.org/)

您也可以考虑像 Docker 这样的容器，或者代替 Eg

[http://blog.circleci.com/checkpoint-and-restore-docker-container-with-criu/](http://blog.circleci.com/checkpoint-and-restore-docker-container-with-criu/)

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2017-06-26T20:08:07.993

我看这里是为了获得更新，因为我从毕业后就没有使用过 openmosix，但是现在有一种称为“网格计算”的新技术，还有比特币的以太，因此进程必须将获取数据的方法传输到合适的节点以安全的方式运行，然后尝试以容错方式运行。我认为答案是 HURD，在网格之前，这更像是一个白日梦。如果你有时间，我认为你应该去[https://www.gnu.org/software/hurd/hurd.html](https://www.gnu.org/software/hurd/hurd.html)并参与其中。网格在我们身上，除了代理托管在网格上之外，无法访问任何东西。

# asp.net - 如何在报告中对多个结果集进行分组？

> ID：278101
> 
> 赞同：1
> 
> 时间：2008-11-10T15:13:52.983
> 
> 标签：asp.net, reporting, activereports

我在 ASP.NET 中使用 ActiveReports，但我认为任何类似报告组件的答案都可以。

我有两个结果集要合并并显示在一个报告中，例如：

```
Table 1:

Name Job              Start End
Jack Some service     1992  1997
Jack Some Sales Exp   1998  2007
Jane Some programming 2000  2003

Table 2:

Name Training
Jack Shiny French Certificate
Jane Crappy database certificate
Jane Some courses in management 
```

报告应如下所示：

```
Jack
  Job History:
    Some Corp, 1992-1997
    Some Sales Exp, 1998-2007
  Training History:
    Shiny French Certificate
Jane
  Job History:
    Some programming, 2000-2003
  Training History:
    Crappy database certificate
    Some courses in management 
```

我应该如何合并这两个表，我应该如何设计布局以实现给定示例中的报告？

更新：

正如您可能注意到的，我并不想通过一次选择来做到这一点。我有两个数据表作为源，我可以手动合并它们以获得单个数据源。我正在尝试使用分组，但我需要为每个员工设置两种组。一份用于工作，一份用于培训。如何使用组或子报表功能来绑定此类数据（以及如果需要我应该如何处理数据）？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-06T14:38:03.117

使用子报表... 创建一个包含两个子报表的主报表。一份工作历史子报告和一份培训历史子报告。主报告将需要一个返回人员列表的查询。然后，对于主报表详细信息中的每个人，在每个子子报表上设置一个参数，该参数将细化这两个子报表中的查询，以仅列出父报表中显示的当前人员的工作历史或培训历史。

Data Dynamics 网站上提供了详细说明如何逐步执行此操作的[演练](http://www.datadynamics.com/Help/ARNET/ParameterswithSubreports.html)。一些概述信息也在[这里](http://www.datadynamics.com/forums/539/ShowPost.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-10T15:28:30.690

通常，您不能在单个 SELECT 语句中执行此操作。大多数报告工具都提供某种“子报告”或“内部部分”，它们针对不同的 SQL 问题运行，并从主报告传递一些参数。您可以使用两个子报表和一个主报表。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-10T15:32:11.853

您应该使用“左连接”选择这两个表，在报表中创建一个“GroupHeader/Footer”部分，并将“GroupHeader”部分的“DataField”设置为字段，该字段应用作分组。

查看 ActiveReports 中的示例，它们肯定有用于分组的示例。

# c - Linux 上的 C 网络摄像头库？

> ID：278112
> 
> 赞同：19
> 
> 时间：2008-11-10T15:16:43.647
> 
> 标签：c, linux, webcam

是否有任何 c 库可以从 linux 上的网络摄像头获取视频？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2010-10-26T16:32:01.163

我们很多人使用[OpenCV](http://opencv.willowgarage.com/wiki/)（跨平台计算机视觉库，目前在 v2.1 上）

以下片段从相机中抓取帧，将它们转换为灰度并显示在屏幕上：

```
#include <stdio.h>
#include "cv.h"
#include "highgui.h"

typedef IplImage* (*callback_prototype)(IplImage*);

/* 
 * make_it_gray: custom callback to convert a colored frame to its grayscale version.
 * Remember that you must deallocate the returned IplImage* yourself after calling this function.
 */
IplImage* make_it_gray(IplImage* frame)
{
    // Allocate space for a new image
    IplImage* gray_frame = 0;
    gray_frame = cvCreateImage(cvSize(frame->width, frame->height), frame->depth, 1);
    if (!gray_frame)
    {
      fprintf(stderr, "!!! cvCreateImage failed!\n" );
      return NULL;
    }

    cvCvtColor(frame, gray_frame, CV_RGB2GRAY);
    return gray_frame; 
}

/*
 * process_video: retrieves frames from camera and executes a callback to do individual frame processing.
 * Keep in mind that if your callback takes too much time to execute, you might loose a few frames from 
 * the camera.
 */
void process_video(callback_prototype custom_cb)
{           
    // Initialize camera
    CvCapture *capture = 0;
    capture = cvCaptureFromCAM(-1);
    if (!capture) 
    {
      fprintf(stderr, "!!! Cannot open initialize webcam!\n" );
      return;
    }

    // Create a window for the video 
    cvNamedWindow("result", CV_WINDOW_AUTOSIZE);

    IplImage* frame = 0;
    char key = 0;
    while (key != 27) // ESC
    {    
      frame = cvQueryFrame(capture);
      if(!frame) 
      {
          fprintf( stderr, "!!! cvQueryFrame failed!\n" );
          break;
      }

      // Execute callback on each frame
      IplImage* processed_frame = (*custom_cb)(frame);

      // Display processed frame
      cvShowImage("result", processed_frame);

      // Release resources
      cvReleaseImage(&processed_frame);

      // Exit when user press ESC
      key = cvWaitKey(10);
    }

    // Free memory
    cvDestroyWindow("result");
    cvReleaseCapture(&capture);
}

int main( int argc, char **argv )
{
    process_video(make_it_gray);

    return 0;
} 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2016-11-12T09:49:54.157

**`v4l2`官方例子**

你得到什么：

*   `./v4l2grab`：捕获一些快照到文件`outNNN.ppm`
*   `./v4l2gl`：使用 OpenGL 纹理（立即渲染，嘿！）和原始 X11 窗口（加上 GLUT 的`gluLookAt`良好措施）在窗口上实时显示视频。

如何在 Ubuntu 16.04 上获得它：

```
sudo apt-get install libv4l-dev
sudo apt-get build-dep libv4l-dev
git clone git://linuxtv.org/v4l-utils.git
cd v4l-utils
# Matching the installed version of dpkg -s libv4l-dev
git checkout v4l-utils-1.10.0
./bootstrap.sh
./configure
make
# TODO: fails halfway, but it does not matter for us now.
cd contrib/tests
make 
```

在 Git 树之外使用这些示例也很容易，只需将它们复制出来，使 relative 包含`""`absolute`<>`和 remove `config.h`。我已经为您完成了：[https ://github.com/cirosantilli/cpp-cheat/tree/09fe73d248f7da2e9c9f3eff2520a143c259f4a6/v4l2](https://github.com/cirosantilli/cpp-cheat/tree/09fe73d248f7da2e9c9f3eff2520a143c259f4a6/v4l2)

**来自文档的最小示例**

文档 4.9.0 包含似乎是 https://linuxtv.org/downloads/v4l-dvb-apis-new/uapi/v4l/v4l2grab-example.html 的`./v4l2grab`最小[版本](https://linuxtv.org/downloads/v4l-dvb-apis-new/uapi/v4l/v4l2grab-example.html)。我需要对它进行最低限度的修补，我已经将修补程序发送到[http://www.spinics.net/lists/linux-media/](http://www.spinics.net/lists/linux-media/)（他们的文档作为 rst 存在于 Linux 内核树中，整洁），在那里它被愚蠢地忽略了.

用法：

```
gcc v4l2grab.c -lv4l2
./a.out 
```

补丁代码：

```
/* V4L2 video picture grabber
Copyright (C) 2009 Mauro Carvalho Chehab <mchehab@infradead.org>

This program is free software; you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation version 2 of the License.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.
*/

#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <fcntl.h>
#include <errno.h>
#include <sys/ioctl.h>
#include <sys/types.h>
#include <sys/time.h>
#include <sys/mman.h>
#include <linux/videodev2.h>
#include <libv4l2.h>

#define CLEAR(x) memset(&(x), 0, sizeof(x))

struct buffer {
        void   *start;
        size_t length;
};

static void xioctl(int fh, int request, void *arg)
{
        int r;

        do {
                r = v4l2_ioctl(fh, request, arg);
        } while (r == -1 && ((errno == EINTR) || (errno == EAGAIN)));

        if (r == -1) {
                fprintf(stderr, "error %d, %s\\n", errno, strerror(errno));
                exit(EXIT_FAILURE);
        }
}

int main(int argc, char **argv)
{
        struct v4l2_format              fmt;
        struct v4l2_buffer              buf;
        struct v4l2_requestbuffers      req;
        enum v4l2_buf_type              type;
        fd_set                          fds;
        struct timeval                  tv;
        int                             r, fd = -1;
        unsigned int                    i, n_buffers;
        char                            *dev_name = "/dev/video0";
        char                            out_name[256];
        FILE                            *fout;
        struct buffer                   *buffers;

        fd = v4l2_open(dev_name, O_RDWR | O_NONBLOCK, 0);
        if (fd < 0) {
                perror("Cannot open device");
                exit(EXIT_FAILURE);
        }

        CLEAR(fmt);
        fmt.type = V4L2_BUF_TYPE_VIDEO_CAPTURE;
        fmt.fmt.pix.width       = 640;
        fmt.fmt.pix.height      = 480;
        fmt.fmt.pix.pixelformat = V4L2_PIX_FMT_RGB24;
        fmt.fmt.pix.field       = V4L2_FIELD_INTERLACED;
        xioctl(fd, VIDIOC_S_FMT, &fmt);
        if (fmt.fmt.pix.pixelformat != V4L2_PIX_FMT_RGB24) {
                printf("Libv4l didn't accept RGB24 format. Can't proceed.\\n");
                exit(EXIT_FAILURE);
        }
        if ((fmt.fmt.pix.width != 640) || (fmt.fmt.pix.height != 480))
                printf("Warning: driver is sending image at %dx%d\\n",
                        fmt.fmt.pix.width, fmt.fmt.pix.height);

        CLEAR(req);
        req.count = 2;
        req.type = V4L2_BUF_TYPE_VIDEO_CAPTURE;
        req.memory = V4L2_MEMORY_MMAP;
        xioctl(fd, VIDIOC_REQBUFS, &req);

        buffers = calloc(req.count, sizeof(*buffers));
        for (n_buffers = 0; n_buffers < req.count; ++n_buffers) {
                CLEAR(buf);

                buf.type        = V4L2_BUF_TYPE_VIDEO_CAPTURE;
                buf.memory      = V4L2_MEMORY_MMAP;
                buf.index       = n_buffers;

                xioctl(fd, VIDIOC_QUERYBUF, &buf);

                buffers[n_buffers].length = buf.length;
                buffers[n_buffers].start = v4l2_mmap(NULL, buf.length,
                            PROT_READ | PROT_WRITE, MAP_SHARED,
                            fd, buf.m.offset);

                if (MAP_FAILED == buffers[n_buffers].start) {
                        perror("mmap");
                        exit(EXIT_FAILURE);
                }
        }

        for (i = 0; i < n_buffers; ++i) {
                CLEAR(buf);
                buf.type = V4L2_BUF_TYPE_VIDEO_CAPTURE;
                buf.memory = V4L2_MEMORY_MMAP;
                buf.index = i;
                xioctl(fd, VIDIOC_QBUF, &buf);
        }
        type = V4L2_BUF_TYPE_VIDEO_CAPTURE;

        xioctl(fd, VIDIOC_STREAMON, &type);
        for (i = 0; i < 20; i++) {
                do {
                        FD_ZERO(&fds);
                        FD_SET(fd, &fds);

                        /* Timeout. */
                        tv.tv_sec = 2;
                        tv.tv_usec = 0;

                        r = select(fd + 1, &fds, NULL, NULL, &tv);
                } while ((r == -1 && (errno = EINTR)));
                if (r == -1) {
                        perror("select");
                        return errno;
                }

                CLEAR(buf);
                buf.type = V4L2_BUF_TYPE_VIDEO_CAPTURE;
                buf.memory = V4L2_MEMORY_MMAP;
                xioctl(fd, VIDIOC_DQBUF, &buf);

                sprintf(out_name, "out%03d.ppm", i);
                fout = fopen(out_name, "w");
                if (!fout) {
                        perror("Cannot open image");
                        exit(EXIT_FAILURE);
                }
                fprintf(fout, "P6\n%d %d 255\n",
                        fmt.fmt.pix.width, fmt.fmt.pix.height);
                fwrite(buffers[buf.index].start, buf.bytesused, 1, fout);
                fclose(fout);

                xioctl(fd, VIDIOC_QBUF, &buf);
        }

        type = V4L2_BUF_TYPE_VIDEO_CAPTURE;
        xioctl(fd, VIDIOC_STREAMOFF, &type);
        for (i = 0; i < n_buffers; ++i)
                v4l2_munmap(buffers[i].start, buffers[i].length);
        v4l2_close(fd);

        return 0;
} 
```

**仅用于重用的面向对象的标头版本**

从文档中的示例中提取，但以一种非常易于重用的形式。

common_v4l2.h

```
#ifndef COMMON_V4L2_H
#define COMMON_V4L2_H

#include <errno.h>
#include <fcntl.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <sys/ioctl.h>
#include <sys/mman.h>
#include <sys/time.h>
#include <sys/types.h>

#include <libv4l2.h>
#include <linux/videodev2.h>

#define COMMON_V4L2_CLEAR(x) memset(&(x), 0, sizeof(x))

typedef struct {
    void *start;
    size_t length;
} CommonV4l2_Buffer;

typedef struct {
    int fd;
    CommonV4l2_Buffer *buffers;
    struct v4l2_buffer buf;
    unsigned int n_buffers;
} CommonV4l2;

void CommonV4l2_xioctl(int fh, unsigned long int request, void *arg)
{
    int r;
    do {
        r = v4l2_ioctl(fh, request, arg);
    } while (r == -1 && ((errno == EINTR) || (errno == EAGAIN)));
    if (r == -1) {
        fprintf(stderr, "error %d, %s\n", errno, strerror(errno));
        exit(EXIT_FAILURE);
    }
}

void CommonV4l2_init(CommonV4l2 *this, char *dev_name, unsigned int x_res, unsigned int y_res) {
    enum v4l2_buf_type type;
    struct v4l2_format fmt;
    struct v4l2_requestbuffers req;
    unsigned int i;

    this->fd = v4l2_open(dev_name, O_RDWR | O_NONBLOCK, 0);
    if (this->fd < 0) {
        perror("Cannot open device");
        exit(EXIT_FAILURE);
    }
    COMMON_V4L2_CLEAR(fmt);
    fmt.type = V4L2_BUF_TYPE_VIDEO_CAPTURE;
    fmt.fmt.pix.width       = x_res;
    fmt.fmt.pix.height      = y_res;
    fmt.fmt.pix.pixelformat = V4L2_PIX_FMT_RGB24;
    fmt.fmt.pix.field       = V4L2_FIELD_INTERLACED;
    CommonV4l2_xioctl(this->fd, VIDIOC_S_FMT, &fmt);
    if ((fmt.fmt.pix.width != x_res) || (fmt.fmt.pix.height != y_res))
        printf("Warning: driver is sending image at %dx%d\n",
            fmt.fmt.pix.width, fmt.fmt.pix.height);
    COMMON_V4L2_CLEAR(req);
    req.count = 2;
    req.type = V4L2_BUF_TYPE_VIDEO_CAPTURE;
    req.memory = V4L2_MEMORY_MMAP;
    CommonV4l2_xioctl(this->fd, VIDIOC_REQBUFS, &req);
    this->buffers = calloc(req.count, sizeof(*this->buffers));
    for (this->n_buffers = 0; this->n_buffers < req.count; ++this->n_buffers) {
        COMMON_V4L2_CLEAR(this->buf);
        this->buf.type = V4L2_BUF_TYPE_VIDEO_CAPTURE;
        this->buf.memory = V4L2_MEMORY_MMAP;
        this->buf.index = this->n_buffers;
        CommonV4l2_xioctl(this->fd, VIDIOC_QUERYBUF, &this->buf);
        this->buffers[this->n_buffers].length = this->buf.length;
        this->buffers[this->n_buffers].start = v4l2_mmap(NULL, this->buf.length,
            PROT_READ | PROT_WRITE, MAP_SHARED, this->fd, this->buf.m.offset);
        if (MAP_FAILED == this->buffers[this->n_buffers].start) {
            perror("mmap");
            exit(EXIT_FAILURE);
        }
    }
    for (i = 0; i < this->n_buffers; ++i) {
        COMMON_V4L2_CLEAR(this->buf);
        this->buf.type = V4L2_BUF_TYPE_VIDEO_CAPTURE;
        this->buf.memory = V4L2_MEMORY_MMAP;
        this->buf.index = i;
        CommonV4l2_xioctl(this->fd, VIDIOC_QBUF, &this->buf);
    }
    type = V4L2_BUF_TYPE_VIDEO_CAPTURE;
    CommonV4l2_xioctl(this->fd, VIDIOC_STREAMON, &type);
}

void CommonV4l2_update_image(CommonV4l2 *this) {
    fd_set fds;
    int r;
    struct timeval tv;

    do {
        FD_ZERO(&fds);
        FD_SET(this->fd, &fds);

        /* Timeout. */
        tv.tv_sec = 2;
        tv.tv_usec = 0;

        r = select(this->fd + 1, &fds, NULL, NULL, &tv);
    } while ((r == -1 && (errno == EINTR)));
    if (r == -1) {
        perror("select");
        exit(EXIT_FAILURE);
    }
    COMMON_V4L2_CLEAR(this->buf);
    this->buf.type = V4L2_BUF_TYPE_VIDEO_CAPTURE;
    this->buf.memory = V4L2_MEMORY_MMAP;
    CommonV4l2_xioctl(this->fd, VIDIOC_DQBUF, &this->buf);
    CommonV4l2_xioctl(this->fd, VIDIOC_QBUF, &this->buf);
}

char * CommonV4l2_get_image(CommonV4l2 *this) {
    return ((char *)this->buffers[this->buf.index].start);
}

size_t CommonV4l2_get_image_size(CommonV4l2 *this) {
    return this->buffers[this->buf.index].length;
}

void CommonV4l2_deinit(CommonV4l2 *this) {
    unsigned int i;
    enum v4l2_buf_type type;

    type = V4L2_BUF_TYPE_VIDEO_CAPTURE;
    CommonV4l2_xioctl(this->fd, VIDIOC_STREAMOFF, &type);
    for (i = 0; i < this->n_buffers; ++i)
        v4l2_munmap(this->buffers[i].start, this->buffers[i].length);
    v4l2_close(this->fd);
    free(this->buffers);
}

#endif 
```

主程序

```
#include <stdio.h>
#include <stdlib.h>

#include "common_v4l2.h"

static void save_ppm(
    unsigned int i,
    unsigned int x_res,
    unsigned int y_res,
    size_t data_lenght,
    char *data
) {
    FILE *fout;
    char out_name[256];

    sprintf(out_name, "out%03d.ppm", i);
    fout = fopen(out_name, "w");
    if (!fout) {
        perror("error: fopen");
        exit(EXIT_FAILURE);
    }
    fprintf(fout, "P6\n%d %d 255\n", x_res, y_res);
    fwrite(data, data_lenght, 1, fout);
    fclose(fout);
}

int main(void) {
    CommonV4l2 common_v4l2;
    char *dev_name = "/dev/video0";
    struct buffer *buffers;
    unsigned int
        i,
        x_res = 640,
        y_res = 480
    ;

    CommonV4l2_init(&common_v4l2, dev_name, x_res, y_res);
    for (i = 0; i < 20; i++) {
        CommonV4l2_update_image(&common_v4l2);
        save_ppm(
            i,
            x_res,
            y_res,
            CommonV4l2_get_image_size(&common_v4l2),
            CommonV4l2_get_image(&common_v4l2)
        );
    }
    CommonV4l2_deinit(&common_v4l2);
    return EXIT_SUCCESS;
} 
```

上游：[https ://github.com/cirosantilli/cpp-cheat/blob/be5d6444bddab93e95949b3388d92007b5ca916f/v4l2/common_v4l2.h](https://github.com/cirosantilli/cpp-cheat/blob/be5d6444bddab93e95949b3388d92007b5ca916f/v4l2/common_v4l2.h)

**SDL**

视频捕获在他们的路线图中：[https](https://wiki.libsdl.org/Roadmap) : //wiki.libsdl.org/Roadmap 我敢打赌它将在 Linux 上包装 v4l。

当我们得到那个可移植层时会很甜蜜，比 OpenCV 更少臃肿。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-11-10T15:18:39.477

您最好的选择可能是：[video4linux (V4L)](http://en.wikipedia.org/wiki/Video4Linux)

它易于使用且功能强大。

# javascript - 文件夹主页中的用户控件未初始化

> ID：278119
> 
> 赞同：2
> 
> 时间：2008-11-10T15:19:40.803
> 
> 标签：javascript, html, outlook, outlook-addin, outlook-2003

我正在使用 Visual Studio 2008 对 Outlook 2003 加载项进行编程。

加载项使用文件夹主页中的嵌入式用户控件，就像推荐的那样。这是文件夹主页的 HTML 代码：

```
<html><head><style type="text/css">body{overflow: hidden}</style></head>
    <body rightmargin = '0' leftmargin ='0' topmargin ='0' bottommargin = '0' onload='OnBodyLoad()'>
        <script>
            function OnBodyLoad()
            {
                var outlook = window.external.OutlookApplication;
                FolderView.Initialize(outlook);
            }
        </script>
        <object classid='clsid:C718A848-6C31-4897-8DA8-0EDE3A4C6F14'
            id='FolderView' VIEWASTEXT width='100%' height='100%' />
    </body>
</html> 
```

在 FolderSwitch 事件期间，HTML 代码被插入到活动资源管理器的 HTMLDocument 属性中。

在控件的 OnLoad 事件中，使用了对应用程序实例的引用（作为参数传递给它的 Initialize 方法），但有时在触发 OnLoad 事件之前控件未初始化。它刚刚创建，但从未调用 Initialize 方法。

有人有类似的经历吗？这是通常的行为吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-08-07T15:15:32.707

我没有使用 Outlook 2003 或任何其他版本的经验，但我知道 html 和 JavaScript，所以我建议不要立即触发该方法，因为在某些“浏览器/客户端”中使用的值或需要它的东西continue 里面的方法还不可用。您最好在调用该方法时添加延迟，也许这会解决您的问题，因为这解决了我过去的许多问题。

例子：

```
document.addEventListener('onload', function (e) { yourFunction(params); }, false); 
```

**注意：**它可能是 onload 或 onbodyload。

# wpf - 在单个卫星组件中结合 LocBaml 和资源

> ID：278121
> 
> 赞同：5
> 
> 时间：2008-11-10T15:20:17.853
> 
> 标签：wpf, localization, resources, resgen

我的理解是，推荐的 WPF 本地化方法是使用 LocBaml 工具将可本地化的项目提取到例如 csv 文件中，将项目翻译成所需的语言并从此 csv 文件重新生成新的卫星程序集。然而，从我的实验来看，这似乎与从 resources.resx 文件生成附属程序集相冲突，因为两者都没有将资源组合到单个资源文件中，而是简单地覆盖任何现有的附属程序集。

是否有推荐的方法（甚至更好的现有工具）来“合并”来自 LocBaml /generate 的输出和在 resources.resx 文件上运行 resgen 的输出（默认情况下由 VS 在构建时完成）。有没有人在解决同样的问题？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-14T08:08:27.143

您必须手动执行此操作，从 LocBaml 生成 .resources，然后使用 Assembly 链接器合并 Resx 和 BAML 资源。

该过程如下所示：

```
LocBaml.exe /generate ..\obj\WpfLocalization.g.en-US.resources 
            /trans:Res\de.csv /out:de /culture:de

REM Combine resource files w/ Assembly Linker
al /template:WpfLocalization.exe 
   /embed:de\WpfLocalization.g.de.resources 
   /embed:..\..\obj\WpfLocalization.Properties.Resources.de.resources   
   /culture:de  /out:de\WpfLocalization.resources.dll 
```

（批处理文件中的所有内容都在一行中）。

您可以将上述内容放在为您的项目定制的批处理文件中。请记住，LocBaml 必须与输出文件位于同一文件夹中。您可以将此添加为后期构建任务。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-10T22:41:01.253

我更喜欢使用您可以在[codeplex上找到的](http://www.codeplex.com)[WPF 本地化扩展](http://www.codeplex.com/WPFLocalizeExtension)项目来本地化我的 WPF 项目。

它允许您使用与 WinForms 相同的方法，并且比 LocBaml 更易于使用。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-11T14:38:57.810

谷歌了一下，发现这个页面描述了一些使用 LocBaml 的方法，其中包含一个非常详细的描述，关于如何将 resources.resx 和 locbaml 生成的资源合并到一个文件中（使用 al.exe）。

[使用 LocBaml 本地化 WPF](http://www.codeproject.com/KB/WPF/WPFUsingLocbaml.aspx#link_29 "使用 LocBaml 本地化 WPF")

该页面描述了三种使用 LocBaml 的方法，我一直在寻找方法 3 的最后一步。顺便说一下，那篇文章中有很多好东西

# javascript - 如何强制 Javascript 在对 Ajax 请求的 HTML 响应中执行

> ID：278122
> 
> 赞同：12
> 
> 时间：2008-11-10T15:20:24.123
> 
> 标签：javascript, html, ajax, prototypejs

我们使用 Prototype 处理所有的 Ajax 请求，为了简单起见，我们简单地渲染 HTML 内容，然后使用以下函数将其分配给适当的 div：

```
function ajaxModify(controller, parameters, div_id)
{
    var div = $(div_id);

    var request = new Ajax.Request 
    (
        controller, 
        {
            method: "post",
            parameters: parameters,
            onSuccess: function(data) {
                div.innerHTML = data.responseText;
            },
            onFailure: function() {
                div.innerHTML = "Information Temporarily Unavailable";  
            }
        }
    );
} 
```

但是，我偶尔需要在 HTML 响应中执行 Javascript，而这种方法似乎无法做到这一点。

出于多种原因，我试图将 Ajax 调用的函数列表保持在最低限度，因此如果有一种方法可以修改现有函数而不会破坏当前正在使用的任何地方，或者有一种方法可以修改 HTML 响应将导致任何嵌入式 javascript 执行，这会很棒。

顺便说一句，我已经尝试将“evalJS：'force'”添加到函数中以查看它会做什么，但它没有任何帮助。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-11-10T15:27:30.723

参数为：

```
evalScripts:true 
```

请注意，您应该使用**Ajax.Updater**，而不是**Ajax.Request**

见： http: [//www.prototypejs.org/api/ajax/updater](http://www.prototypejs.org/api/ajax/updater)

Ajax.Request 将仅在响应标头为以下时处理 JavaScript：

> application/ecmascript、application/javascript、application/x-ecmascript、application/x-javascript、text/ecmascript、text/javascript、text/x-ecmascript 或 text/x-javascript

而 Ajax.Updater 将处理 JS 是 evalScripts:true 设置。Ajax.Request 面向数据传输，例如获取 JSON 响应。

由于您正在更新 HTML，因此无论如何都应该使用 Ajax.Updater。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-10T15:30:41.840

设置`evalScripts: true`为选项有帮助吗？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-10T15:27:58.570

你应该能够做这样的事情：

```
div.innerHTML = "<div onclick='someOtherFunctionTocall();'>"; 
```

如果您需要在注入 HTML 的同时执行某些操作，您是否可以通过传递另一个参数来修改 ajaxModify() 的签名，这将是您要执行的 javascript 函数（如果它不为空 - 让您保持它是可选的，因为您肯定不想在每个 AJAX 响应上执行某些操作）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-01-18T10:46:00.387

只需在 ajax 响应后执行自定义 my_function()

```
div.innerHTML=...ajax response text...
my_function() 
```

然后执行自定义 my_function() 中的任何函数

```
function my_function() {
  function_1()
  ...
} 
```

注意 my_function() 应该在 div.innerHTML 之外的某个地方。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2010-12-23T01:12:19.097

您需要使用 eval() 函数在 Ajax repose 中运行 javascript 这可以使用 full 来分离脚本并运行它

```

函数 PaseAjaxResponse(somemixedcode)
{
    var source = somemixedcode;
    var scripts = new Array();
    while(source.indexOf("<script") > -1 || source.indexOf("</script") > -1) {
    var s = source.indexOf("<script");
    var s_e = source.indexOf(">", s);
    var e = source.indexOf("</script", s);
    var e_e = source.indexOf(">", e);
    scripts.push(source.substring(s_e+1, e));
    source = source.substring(0, s) + source.substring(e_e+1);
}
for(var x=0; x<scripts.length; x++) {
尝试 {
    评估（脚本[x]）；
}
抓住（前）{
}
}
返回源；
}

```

头韵有关更多信息，请参阅此 [http://www.yasha.co/Ajax/execute-javascript-on-Ajax-return/article-2.html](http://www.yasha.co/Ajax/execute-javascript-on-Ajax-return/article-2.html)

# syntax - 富文本可以使用哪些简单的语法？

> ID：278126
> 
> 赞同：2
> 
> 时间：2008-11-10T15:22:39.690
> 
> 标签：syntax, wiki, markup, richtext

我希望在一个具有简单文本输入的应用程序中，丰富一些标记以包括格式或语义标签。我希望语法尽可能简单，并且我想包含自定义标签。

示例：[bold]Stackoverflow[/bold] 是程序员的 [tag]good[/tag] 资源。

桌子也需要。

HTML/XML 和 LaTeX 足以支持这一点，但太复杂了。Wiki-Syntax 看起来很简单，但每个标记使用另一个符号，引用不明确，每个 Wiki 似乎都有另一种语法。对于表格和类似的东西，Wiki 变得非常复杂。

是否存在符合我需要的语言/语法，或者可以稍微改变一下？还是我必须自己发明一些东西？在这种情况下，您有什么建议吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-10T15:38:00.483

绝对不要自己发明。已经有很多简单的标记语言，用户讨厌学习新的标记语言。相信我！

我建议使用以下方法之一：

*   [纺织品](http://www.textism.com/tools/textile/)
*   [降价](http://daringfireball.net/projects/markdown/)
*   [BB码](http://en.wikipedia.org/wiki/BBCode)

根据您的用户群以及您选择的语言中可用的工具和解析器做出决定。对于我的网站，我们使用 Textile，但我发现 BBCode 往往是大多数人已经知道的语言。但是，这会因不同的用户人口统计数据而异。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-10T15:26:46.107

StackOverflow 以及其他几个站点都使用[Markdown](http://daringfireball.net/projects/markdown/)。我认为它将为您提供功能和简单性之间的最佳平衡。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-10T16:22:55.947

让我将**[ReStructuredText](http://docutils.sourceforge.net/rst.html)**添加到列表中。

使用它的另一个好处是**[ReStructuredText to Anything](http://rst2a.com/)**服务的可用性，这使得创建文档的 HTML 或 PDF 版本变得非常容易。

正如已经指出的那样，有很多轻量级标记语言（很多都在这里列出：**[维基百科文章](http://en.wikipedia.org/wiki/Lightweight_markup_language)**），应该没有必要创建自己的。

# asp.net - ASP.NET：模拟 VMWare 上的域

> ID：278132
> 
> 赞同：2
> 
> 时间：2008-11-10T15:26:46.950
> 
> 标签：asp.net, windows, dns, vmware, impersonation

我需要在 VMWare 机器上运行的 ASP.NET 应用程序中将自己伪装成域用户。由于 VMWare 机器本身不在域中，因此 ASP.NET 无法解析用户令牌（在 web.config 中指定）。有没有办法做到这一点？

在此先感谢，彼得

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-10T16:50:05.113

我使用我一直写的这个课程，它就像一个魅力！

```
using System;
using System.Security.Principal;

/// <summary>
/// Changes the security context the application runs under.
/// </summary>
public class ImpersonateHelper : IDisposable
{
    [System.Runtime.InteropServices.DllImport("Kernel32")]
    private extern static Boolean CloseHandle(IntPtr handle);

    private IntPtr _token = IntPtr.Zero;
    private WindowsImpersonationContext _impersonatedUser = null;

    public IntPtr Token
    {
        get { return _token; }
        set { _token = value; }
    }

    public ImpersonateHelper(IntPtr token)
    {
        _token = token;
    }

    /// <summary>
    /// Switch the user to that set by the Token property
    /// </summary>
    public void Impersonate()
    {
        if (_token == IntPtr.Zero)
            _token = WindowsIdentity.GetCurrent().Token;

        _impersonatedUser = WindowsIdentity.Impersonate(_token);
    }

    /// <summary>
    /// Revert to the identity (user) before Impersonate() was called
    /// </summary>
    public void Undo()
    {
        if (_impersonatedUser != null)
            _impersonatedUser.Undo();
    }

    #region IDisposable Members
    private bool _isDisposed;

    public void Dispose()
    {
        Dispose(true);
        GC.SuppressFinalize(this);
    }

    protected virtual void Dispose(bool disposing)
    {
        if (!_isDisposed)
        {
            if (disposing)
            {
                if (_impersonatedUser != null)
                    _impersonatedUser.Dispose();

            }
            CloseHandle(_token);
            _token = IntPtr.Zero;
        }
        _isDisposed = true;
    }

    ~ImpersonateHelper()
    {
        Dispose(false);
    }
    #endregion
} 
```

然后你从客户端类调用它：

```
//Run task as the impersonated user and not as NETWORKSERVICE or ASPNET (in IIS5)
try{
   impersonate.Impersonate();
   //Do work that needs to run as domain user here...
}
finally
{
            //Revert impersonation to NETWORKSERVICE or ASPNET
            if (impersonate != null)
            {
                impersonate.Undo();
                impersonate.Dispose();
            }
} 
```

祝你好运！

* * *

## 回答 #2

> 赞同：-4
> 
> 时间：2008-11-10T16:38:48.833

这可能是显而易见的答案，但您可以将您的 VMWare 机器添加到域中。

# asp.net - 什么是 system.globalization 和本地化有什么区别

> ID：278136
> 
> 赞同：7
> 
> 时间：2008-11-10T15:27:13.360
> 
> 标签：asp.net, globalization

为了让事情更有趣，在 Asp.net Mvc App 中实现全球化的最佳方法是什么

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-10T15:43:58.583

**全球化**是关于生成从字符串或标识符到其他语言翻译的映射，而**本地化**是关于使用该映射来找到正确的翻译。全球化发生在开发过程中，本地化发生在运行时。

我对使用 ASP.NET 执行此操作不是很有经验，但是...

至于*如何*，我看到的最常见的方法是每个程序集（或每个 UI 组件）的每种语言都有一个字典，其中值是本地化字符串。键通常是静态类或枚举上的只读成员。通常有一个便利类，其成员*是*从标识符到本地化消息的映射。

字典通常存储在单独的文件中，并以针对人工翻译的格式存储。

更多信息：http: [//msdn.microsoft.com/en-us/library/aa478974.aspx](http://msdn.microsoft.com/en-us/library/aa478974.aspx)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-10T15:30:07.457

来自[W3C I18n 常见问题解答](http://www.w3.org/International/questions/qa-i18n)：

> 本地化是指调整产品、应用程序或文档内容以满足特定目标市场（“区域设置”）的语言、文化和其他要求。
> 
> 国际化（或全球化）是产品、应用程序或文档内容的设计和开发，可以为不同文化、地区或语言的目标受众轻松本地化。

我从来没有全球化过 ASP.NET MVC 应用程序，如果我不能帮助你，很抱歉。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-10T15:39:19.170

> **System.Globalization**命名空间包含定义文化相关信息的类，包括语言、国家/地区、使用的日历、日期、货币和数字的格式模式以及字符串的排序顺序。

至于它和本地化有什么区别？我想这可以解释为汽车和城市之间的区别。一个是目的地，另一个是你如何到达那里。

我没有使用过 ASP.NET MVC，但我使用过类似的 Monorail。如果我想本地化一个 MR 应用程序，我可能会使用一个单独的视图文件树。所以，虽然，只有英文，我有：

```
\Views\Home\*.asp
\Views\Admin\*.asp
\Views\Products\*.asp 
```

对于一个国际化的应用程序，我会有类似的东西：

```
\en\Views\Home\*.asp
\en\Views\Admin\*.asp
\en\Views\Products\*.asp
\de\Views\Home\*.asp
\de\Views\Admin\*.asp
\de\Views\Products\*.asp
\es\Views\Home\*.asp
\es\Views\Admin\*.asp
\es\Views\Products\*.asp 
```

# c# - .NET 设置图像显示大小

> ID：278137
> 
> 赞同：2
> 
> 时间：2008-11-10T15:27:28.867
> 
> 标签：c#, winforms, image-processing

我正在使用一些自定义控件，其中一个是可以显示图像的工具提示控制器，所以我使用下面的代码来实例化它：

```
Image newImage = Image.FromFile(imagePath);
e.ToolTipImage = newImage; 
```

显然可以内联它，但目前只是测试。问题是图像有时尺寸不对，有没有办法设置显示尺寸。我目前能看到的唯一方法是使用 GDI+ 或类似的东西编辑图像。当我只想调整显示大小而不影响实际图像时，似乎需要进行很多额外的处理。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-10T15:35:33.377

从源加载图像对象后，高度和宽度（和大小以及所有辅助属性）都是只读的。因此，您只能使用 GDI+ 方法在 RAM 中调整它的大小，然后相应地显示它。

您可以采取很多方法，但是如果您要将其封装到一个库中，以便在此问题再次发生时可以重用，那么您就可以开始了。这不是完全优化的（IE，可能有一些错误），但应该让您了解如何处理它：

```
Image newImage = Image.FromFile(myFilePath);
Size outputSize = new Size(200, 200);
Bitmap backgroundBitmap = new Bitmap(outputSize.Width, outputSize.Height);
using (Bitmap tempBitmap = new Bitmap(newImage))
{
    using (Graphics g = Graphics.FromImage(backgroundBitmap))
    {
        g.InterpolationMode = InterpolationMode.HighQualityBicubic;
        // Get the set of points that determine our rectangle for resizing.
        Point[] corners = {
            new Point(0, 0),
            new Point(backgroundBitmap.Width, 0),
            new Point(0, backgroundBitmap.Height)
        };
        g.DrawImage(tempBitmap, corners);
    }
}
this.BackgroundImage = backgroundBitmap; 
```

我确实对此进行了测试，并且有效。（它创建了我的一个桌面壁纸的 200x200 调整大小版本，然后将其设置为草稿 WinForms 项目中主窗体的背景图像。您将需要和`using`的语句。`System.Drawing``System.Drawing.Drawing2D`

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-10T15:53:11.063

在 Winforms 中，如果您在 PictureBox 控件中包含图像，则可以将 PictureBox 控件设置为缩放到特定的高度/宽度，并且图像应该符合。

至少那是我做这个练习时在我的 Head First C# 书中发生的事情。

# asp.net - DropDownList 上的 ASP.Net 客户端事件？

> ID：278140
> 
> 赞同：2
> 
> 时间：2008-11-10T15:28:10.630
> 
> 标签：asp.net, events, drop-down-menu, client

当 DropDownList 的数据已加载/绑定到控件上时，是否有我可以使用的客户端事件？发生这种情况时，我需要在他们这边触发事件。

* * *

基本上，我试图在加载数据时锁定控件，就好像用户可以开始输入数据并在输入时失去焦点一样减速（并不少见）。

我尝试在标签中执行此操作，但位于那里的方法似乎在第一次回发后停止工作！（任何帮助将不胜感激）。作为一种解决方法，我尝试将事件附加到元素本身，虽然这适用于锁定，但使用 onchange 事件，我无法在数据成功加载后解锁它！

有任何想法吗？感谢到目前为止的答案:)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-10T15:49:47.200

由于数据将绑定在服务器端，因此您没有针对该特定事件的客户端事件，但是，页面已呈现，数据将在那里，因此您可能希望在document.load 事件，或者使用类似 jQuery 的 document.ready 事件。一旦页面（包括您绑定的下拉菜单）完成加载，这将触发您的脚本运行。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-10T15:48:15.067

Jason 在这里是正确的，因为当此类事件发生时，您无法“通知”客户。您可以做的一件事是调用 Page.RegisterStartupScript() 方法，以便在页面完成加载后使用 JavaScript 执行某些操作（并且假设已经发生了完成数据绑定的回发）。同样，这假设您想在数据绑定完成后在客户端执行某些操作，而不是服务器端。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-13T15:13:55.457

你能在你的应用程序中使用 ASP.NET AJAX 吗？如果是这样，您可以让选定的事件打开一个模式对话框，您可以在填充下拉列表时在其中显示“处理”文本。这样用户就无法访问任何其他控件，您可以放心地做您需要的事情。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-11T19:24:16.823

我在我的网站的母版页中使用以下代码。这会阻止用户在完全绑定之前尝试使用控件。我发现如果控件没有完全绑定（连接速度慢），那么页面就会爆炸。

本质上，如果该页面未完成，脚本会劫持回帖。允许用户在页面完成处理之前不做任何事情。我在一年前写了这篇文章，它非常方便。

1.  首先将 onload body 标签设置为 setdopostback()

2.  将此添加到正文中的脚本块中。

    ```
     var boolDoPostBack = false;

        if (__doPostBack)
        {
           // save a reference to the original __doPostBack
           var __oldDoPostBack = __doPostBack;

          //replace __doPostBack with another function
          __doPostBack = AlwaysFireBeforeFormSubmit;
        }
        function setdopostback()
        {
            boolDoPostBack = true;
        }
        function AlwaysFireBeforeFormSubmit (eventTarget, eventArgument)
        {
            var x= document.readyState

            if (x != "complete")
            {
                if (x == "loading" || x == "interactive" || x == "unitialized" || x == "loaded")
                { 
                    //do nothing with IE postback
                }
                else if (!boolDoPostBack)
                {
                    //do nothing with FireFox postback
                }
                else
                {
                    //alert('Allow Postback 1');
                    return __oldDoPostBack (eventTarget, eventArgument);
                }
            }
            else
            {
                //alert('Allow Postback 2');
                return __oldDoPostBack (eventTarget, eventArgument);
            }       
        } 
    ```

# c++ - 以编程方式导航到 Windows Mobile 主屏幕

> ID：278149
> 
> 赞同：1
> 
> 时间：2008-11-10T15:30:18.673
> 
> 标签：c++, windows-mobile, navigation, background, homescreen

我们有一个在后台下载一些文件的应用程序。当建立 Internet 连接时，我们的应用程序会弹出，并且在提示用户接受下载后，我们希望在执行操作时切换回主屏幕。

我们不知道该怎么做。我们可以模拟几次按下“返回”，这有时会起作用，但最终的结果取决于互联网连接发生时用户在做什么。

那么，有人可以提供如何做到这一点的指针吗？

谢谢。

保罗。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-10T15:44:32.937

您可以尝试将今天的屏幕设置为前景窗口吗？

HWND hWnd = FindWindow(_T("DesktopExplorerWindow"), _T("Desktop")); SetForegroundWindow(hWnd);

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-10T15:53:52.433

你为什么不简单地隐藏你的应用程序？

使用通知外壳对象而不是弹出全屏窗口可能是更好的选择。[详情在这里](http://www.christec.co.nz/blog/archives/104)。

# c# - 从动作中提取表达式树

> ID：278151
> 
> 赞同：3
> 
> 时间：2008-11-10T15:30:40.327
> 
> 标签：c#, lambda

我刚开始玩 Linq Expressions 并且碰壁了。我需要从一个动作创建一个表达式树。不幸的是，我无法将动作作为表达式，这基本上是我必须使用的：

```
public void Something(Action action){} 
```

我需要访问 Action 的主体来提取变量和值。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-10T15:49:32.723

一个`Action`不是一个`Expression`；它只是一个委托（在某些时候可能是一个表达式，可能是一个 lambda，也可能不是）。

为了使这个可行，您需要重构：

```
public void Something(Expression<Action> action) {...} 
```

此外，C# 3.0 / .NET 3.5 lambda 表达式不适用于`Action`-type 表达式。你能表达的东西非常有限。`Func`-type 表达式效果更好。在 .NET 4.0 (CTP) 中，这里有[更多的灵活性](http://marcgravell.blogspot.com/2008/11/future-expressions.html)，尽管仍然不清楚该语言 (C# 4.0) 将通过 lambdas 提供什么。

基本上，我不确定您是否可以（方便地）做您希望使用`Expression`.

# .net - 模拟 .NET HttpWebRequest 的连接问题

> ID：278160
> 
> 赞同：2
> 
> 时间：2008-11-10T15:31:55.270
> 
> 标签：.net, testing, httpwebrequest, connection

使用 HttpWebRequest 类时，有没有办法以编程方式模拟连接问题（连接缓慢、响应未完成、连接断开等）？

谢谢

编辑：为了详细说明，我需要这个来调试，但最终想把它变成一个测试。我正在使用异步方法 BeginGetRequestStream、EndGetRequestStream、BeginGetResponse 和 EndGetResponse。我已经将它们全部包装在适当的（我希望）Try Catch 块中，记录发生的异常。

我知道这适用于某些情况（例如，当我拔出网络电缆时）。但在极少数情况下（即仅当我请求的网站速度很慢时）我的系统崩溃了，我在事件日志中得到了这个

```
Exception: System.Net.WebException

Message: The request was aborted: The connection was closed unexpectedly.

StackTrace:    at System.Net.ConnectStream.BeginRead(Byte[] buffer, Int32 offset, Int32 size, AsyncCallback callback, Object state)
   at System.IO.Compression.DeflateStream.ReadCallback(IAsyncResult baseStreamResult)
   at System.Net.LazyAsyncResult.Complete(IntPtr userToken)
   at System.Net.ContextAwareResult.CompleteCallback(Object state)
   at System.Threading.ExecutionContext.runTryCode(Object userData)
   at System.Runtime.CompilerServices.RuntimeHelpers.ExecuteCodeWithGuaranteedCleanup(TryCode code, CleanupCode backoutCode, Object userData)
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.ExecutionContext.Run(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Net.ContextAwareResult.Complete(IntPtr userToken)
   at System.Net.LazyAsyncResult.ProtectedInvokeCallback(Object result, IntPtr userToken)
   at System.Net.Sockets.BaseOverlappedAsyncResult.CompletionPortCallback(UInt32 errorCode, UInt32 numBytes, NativeOverlapped* nativeOverlapped)
   at System.Threading._IOCompletionCallback.PerformIOCompletionCallback(UInt32 errorCode, UInt32 numBytes, NativeOverlapped* pOVERLAP) 
```

我假设它来自 HttpWebRequest 但我的所有代码再次包装在 Try Catch 块中。

在这种情况下，模拟会有所帮助吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-25T06:19:05.393

@Chris 不幸的是，Microsoft 忽略了[使许多 BCL 对象易于模拟](http://bartling.blogspot.com/2009/01/net-base-class-library-types-not.html)，因为它们倾向于使用抽象类，并且 .NET 类在设计上是封闭的（换句话说，对于被子类覆盖的方法，它需要被显式标记为虚拟），而 Java 是按设计开放的（即，子类可以覆盖任何方法，除非它们被标记为最终方法）。使用接口或将方法标记为虚拟会在测试空间中省去很多麻烦。微软现在可能有可测试性信仰（例如 ASP.NET MVC），但对于 BCL 来说有点晚了。

Typemock Isolator[可能会有所帮助](http://blog.typemock.com/2008/07/is-visibility-of-tested-methods.html)，但在这种情况下，我不相信 Moq 可以。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-10T16:00:59.643

如果这是出于测试目的 - 即检查您的代码行为，我建议创建一个继承自 HttpWebRequest/HttpWebResponse 的类，并覆盖您感兴趣的方法以按照您想要的方式运行 - 即 Thread.Sleep 延迟, 抛出异常等。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-10T15:59:12.593

如果您控制响应请求的站点，我会说让线程休眠一段时间会模拟缓慢的响应。System.Threading.Thread.Sleep（毫秒数）

至于断开的连接，我想不出任何程序化的东西，但我确实拔出了我的网络电缆来模拟这种情况。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-10T16:03:32.210

假设您正在编写单元测试来覆盖代码，您可以使用模拟框架（我个人更喜欢[Moq](http://code.google.com/p/moq/)）来模拟类上任何虚拟方法的 HttpWebRequest 的实现。在您的模拟中，您可以自己实现您希望测试用例的行为方式。

# asp.net - 在将页面发送到客户端之前修改页面的 HTML

> ID：278163
> 
> 赞同：9
> 
> 时间：2008-11-10T15:34:20.087
> 
> 标签：asp.net, html

我需要在将 ASP.NET 的 HTML 发送到客户端之前捕获它，以便对其进行最后一分钟的字符串操作，然后将修改后的版本发送到客户端。

例如

页面已加载每个控件都已正确呈现页面的完整 html 已准备好传输回客户端

在 ASP.NET 中有没有办法做到这一点？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-13T23:28:02.133

您可以覆盖页面的 Render 方法。然后调用基本实现并提供您的 HtmlTextWriter 对象。这是一个例子

```
protected override void Render(HtmlTextWriter writer)
{
    StringWriter output = new StringWriter();
    base.Render(new HtmlTextWriter(output));
    //This is the rendered HTML of your page. Feel free to manipulate it.
    string outputAsString = output.ToString();

    writer.Write(outputAsString);
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-10T15:38:58.330

您可以使用[HTTPModule](http://msdn.microsoft.com/en-us/library/system.web.ihttpmodule.aspx)来更改 html。这是一个[示例](http://www.darkside.co.za/archive/2008/03/03/web-page-optmisation-using-httpmodule.aspx)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2013-07-14T13:15:03.090

使用[Atanas Korchev 的答案](https://stackoverflow.com/a/288740/107625)几天，我发现我收到类似于以下内容的 JavaScript 错误：

> “无法解析从服务器收到的消息”

当将此与 ASP.NET Ajax[`UpdatePanel`控件](http://msdn.microsoft.com/en-us/library/system.web.ui.updatepanel.aspx)结合使用时。[原因在这篇博文中有所描述](http://weblogs.asp.net/leftslipper/archive/2007/02/26/sys-webforms-pagerequestmanagerparsererrorexception-what-it-is-and-how-to-avoid-it.aspx)。

基本上，`UpdatePanel`对于呈现字符串的确切长度是否恒定似乎很关键。即如果更改字符串并*保持*长度，则成功，如果更改文本以使字符串长度发生变化，则会出现上述JavaScript错误。

我不完美但可行的解决方案是假设`UpdatePanel`总是做一个 POST 并将其过滤掉：

```
protected override void Render(HtmlTextWriter writer)
{
    if (IsPostBack || IsCallback)
    {
        base.Render(writer);
    }
    else
    {
        using (var output = new StringWriter())
        {
            base.Render(new HtmlTextWriter(output));

            var outputAsString = output.ToString();
            outputAsString = doSomeManipulation(outputAsString);

            writer.Write(outputAsString);
        }
    }
} 
```

这适用于我的场景，但有一些可能不适用于您的场景的缺点：

*   在回发时，不会更改任何字符串。
*   因此，用户看到的字符串是未经处理的字符串
*   `UpdatePanel`也可能会因非回发而触发。

不过，我希望这可以帮助其他发现类似问题的人。此外，[请参阅本文讨论`UpdatePanel`和`Page.Render`更多详细信息](http://7daysageek.blogspot.de/2009/03/aspnet-updatepanel-and-overriding.html)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-10T15:39:49.140

查看 ASP.NET 页面生命周期中的事件序列。 [这](http://msdn.microsoft.com/en-us/library/dct97kc3.aspx)是列出事件的一页。您可能会找到一个事件来处理，该事件在页面的生命周期中已经足够晚来进行更改，但仍会呈现这些更改。

如果没有，您总是可以编写一个 HttpModule 在页面本身完成渲染后处理 HTTP 响应。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-10T15:53:47.050

显然，如果您首先可以从 ASP.Net 中获取所需的标记，那么效率会高得多。

考虑到这一点，您是否考虑过使用[控制适配器](http://msdn.microsoft.com/en-us/library/system.web.ui.adapters.controladapter.aspx)？它们将允许您首先覆盖每个控件的呈现方式，而不必稍后修改字符串。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-11-10T15:42:12.003

我认为页面中没有可以挂钩的特定事件；这是 ASP.Net 生命周期：http: [//msdn.microsoft.com/en-us/library/ms178472.aspx](http://msdn.microsoft.com/en-us/library/ms178472.aspx)

您可能需要考虑挂钩到 prerender 事件以“调整”控件的值，或执行一些客户端编辑/回调。

# .net - RIA 服务器架构 .NET

> ID：278164
> 
> 赞同：0
> 
> 时间：2008-11-10T15:34:24.173
> 
> 标签：.net, architecture, transactions, ria, weborb

我使用 WebORB 作为[Flex](http://en.wikipedia.org/wiki/Adobe_Flex)项目的远程网关。我想知道在 Server .NET 端使用的最佳架构是什么。此时我们正在使用[SubSonic](http://en.wikipedia.org/wiki/Subsonic_%28software%29)生成数据访问层。除此之外，来自 Flex 的每个调用都使用了一点事务脚本模式，因为服务器端实际上只是将数据从[SQL Server 2005](http://en.wikipedia.org/wiki/Microsoft_SQL_Server#SQL_Server_2005)数据库获取到 Flex 以及从 Flex 到 SQL Server 2005 的一种方式。

是否有关于如何在服务器端处理[RIA的最佳实践？](http://en.wikipedia.org/wiki/Rich_Internet_application)我一直在玩[LINQ](http://en.wikipedia.org/wiki/Language_Integrated_Query)（具有多个结果集的存储过程让我们头疼），我想知道[ADO.NET 实体框架](http://en.wikipedia.org/wiki/ADO.NET_Entity_Framework)......

并发也是一个大问题。我知道这些事情是由数据集处理的，LINQ 也对此提供支持，但是一旦将数据发送到 Flex，就真的不再与原始数据集有任何联系。

还有其他人有大型 RIA 的经验吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-02-04T10:53:43.023

我创建了一个具有如下架构的应用程序：

[带有ActionScript](http://en.wikipedia.org/wiki/ActionScript)的 Flash/Flex -> AMF.NET 调用 .NET 方法 -> 用于传入和传出参数格式化的外观层 ->使用数据提供程序模型和调用[存储过程的 Microsoft SqlHelper 的简单](http://en.wikipedia.org/wiki/Stored_procedure)[ADO.NET](http://en.wikipedia.org/wiki/ADO.NET)。

我对结果很满意，因为我是 .NET 开发人员，响应时间很好，而且我能够获得可以直接绑定到诸如网格之类的 Flash/Flex 控件的响应数据集。

查看[这篇文章](http://lakhlaniprashant.blogspot.com/2009/03/flash-remoting-with-aspnet.html)以获取有关我的工作和源代码的更多信息。

我希望这有帮助。

# .net - 如何禁用 WPF WebBrowser 控件的点击噪音？

> ID：278186
> 
> 赞同：2
> 
> 时间：2008-11-10T15:41:21.397
> 
> 标签：.net, wpf, browser

我有一个带有 TextBox 和 WebBrowser 控件的简单 WPF 小应用程序。当我在 TextBox 中输入内容时，WebBrowser 会更新其内容。

但是在每次击键时，当 WebBrowser 更新时，它会发出咔哒声。如何禁用 WebBrowser 控件的刷新单击声音？

[WPF TextBox 和 WebBrowser 控件 http://img411.imageshack.us/img411/2296/appbz9.jpg](http://img411.imageshack.us/img411/2296/appbz9.jpg)

我的 XAML...

```
<TextBox Name="MyTextBox"
         ...
         TextChanged="MyTextBox_TextChanged"
         TextWrapping="Wrap"
         AcceptsReturn="True"
         VerticalScrollBarVisibility="Visible" />
<WebBrowser Name="MyWebBrowser" ... /> 
```

我的 Visual Basic 代码...

```
Private Sub MyTextBox_TextChanged(ByVal sender As System.Object, ByVal e As System.Windows.Controls.TextChangedEventArgs)
    If Not MyTextBox.Text = String.Empty Then
        MyWebBrowser.NavigateToString(MyTextBox.Text)
    别的
        MyWebBrowser.Source = 没有
    万一
结束子

```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-10T15:50:51.347

好吧，如果我没记错的话，它使用的是 IE7/8 容器，所以它可能需要通过 Windows Sounds 来完成。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-10T15:55:37.547

该点击是由于导航，没有它不应该出现。

我将在 webbrowser 中加载的空 HTML 中引入我的 div 标签，并在更新时在 div 的 innerHTML 属性中引入文本框的文本。没有导航。

Visual Basic 代码...

```
Private Sub Window1_Loaded(ByVal sender As System.Object, ByVal e As System.Windows.RoutedEventArgs) Handles MyBase.Loaded
    MyWebBrowser.NavigateToString("&lt;html&gt;&lt;body&gt;&lt;div id=&quot;&quot;MyDiv&quot;&quot;&gt;&lt;/div&gt;&lt;/body&gt;&lt;html&gt;")
End Sub

Private Sub MyTextBox_TextChanged(ByVal sender As System.Object, ByVal e As System.Windows.Controls.TextChangedEventArgs)
    MyWebBrowser.Document.GetElementById("MyDiv").InnerHtml = MyTextBox.Text
End Sub 
```

# sql - Oracle中的字符串连接运算符是什么？

> ID：278189
> 
> 赞同：179
> 
> 时间：2008-11-10T15:42:01.070
> 
> 标签：sql, oracle, plsql, string-concatenation

Oracle SQL 中的字符串连接运算符是什么？

有没有我应该注意的“有趣”功能？

（这似乎很明显，但我找不到以前的问题问它）。

* * *

## 回答 #1

> 赞同：252
> 
> 时间：2008-11-10T15:45:06.647

它是`||`，例如：

```
select 'Mr ' || ename from emp; 
```

我能想到的唯一“有趣”的功能是`'x' || null`返回`'x'`，而不是`null`您可能期望的那样。

* * *

## 回答 #2

> 赞同：64
> 
> 时间：2008-11-10T22:09:11.693

还有concat，不过用的不多

```
select concat('a','b') from dual; 
```

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2015-11-11T08:57:09.620

我建议在处理 2 个字符串时使用 concat 和 || 当这些字符串超过 2 时：

```
select concat(a,b)
  from dual 
```

或者

```
 select 'a'||'b'||'c'||'d'
        from dual 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2015-11-11T00:55:51.547

```
DECLARE
     a      VARCHAR2(30);
     b      VARCHAR2(30);
     c      VARCHAR2(30);
 BEGIN
      a  := ' Abc '; 
      b  := ' def ';
      c  := a || b;
 DBMS_OUTPUT.PUT_LINE(c);  
   END; 
```

输出:: Abc def

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2020-03-30T19:51:52.773

`CONCAT(CONCAT(,),)`连接两个以上的字符串时，使用对我有用。

我的问题需要使用日期字符串（仅）并按如下方式创建（即不转换为日期格式）`YYYYMMDD`：`YYYY-MM-DD`

```
CONCAT(CONCAT(SUBSTR(DATECOL,1,4),SUBSTR(DATECOL,6,2)),SUBSTR(DATECOL,9,2)) AS YYYYMMDD 
```

# git - 使用 Git 版本控制查看文件的更改历史记录

> ID：278192
> 
> 赞同：3503
> 
> 时间：2008-11-10T15:42:32.737
> 
> 标签：git, git-log

如何在 Git 中查看单个文件的更改历史记录，以及更改内容的完整详细信息？

我已经做到了：

```
git log -- [filename] 
```

它向我显示了文件的提交历史记录，但我如何获得每个文件更改的内容？

我正在尝试从 Microsoft [Visual SourceSafe](https://en.wikipedia.org/wiki/Microsoft_Visual_SourceSafe)进行转换，这曾经是一个简单的右键单击 → *Show history*。

* * *

## 回答 #1

> 赞同：2618
> 
> 时间：2009-08-24T12:05:51.537

对于图形视图，我将使用`gitk`：

```
gitk [filename] 
```

或者按照文件名过去重命名：

```
gitk --follow [filename] 
```

* * *

## 回答 #2

> 赞同：2590
> 
> 时间：2008-11-10T15:56:44.393

您可以使用

```
git log -p -- filename 
```

让 Git 为每个日志条目生成补丁。

看

```
git help log 
```

更多选项 - 它实际上可以做很多好事 :) 要获得特定提交的差异，您可以

```
git show HEAD 
```

或标识符的任何其他修订。或使用

```
gitk 
```

以直观地浏览更改。

* * *

## 回答 #3

> 赞同：1689
> 
> 时间：2011-03-30T23:25:11.130

`git log --follow -p -- path-to-file`

这将显示文件的**整个**历史记录（包括重命名之外的历史记录以及每次更改的差异）。

换句话说，如果命名的文件`bar`曾经被命名`foo`，那么`git log -p bar`（没有`--follow`选项）将只显示文件的历史，直到它被重命名 - 它不会显示文件的历史，当它被称为`foo`. 使用`git log --follow -p bar`将显示文件的整个历史记录，包括文件被称为`foo`. 该`-p`选项确保每次更改都包含差异。

* * *

## 回答 #4

> 赞同：190
> 
> 时间：2012-06-07T10:23:33.150

如果您更喜欢基于文本，您可能需要使用**[tig](https://github.com/jonas/tig)**。

快速安装：

*   **[APT](https://en.wikipedia.org/wiki/APT_(software))**：`# apt-get install tig`
*   **[自制](https://en.wikipedia.org/wiki/Homebrew_(package_manager))（OS X）**：`$ brew install tig`

使用它来查看单个文件的历史记录：`tig [filename]`

或浏览详细的存储库历史记录：`tig`

它类似于[gitk](https://git-scm.com/docs/gitk)，但基于文本。它支持终端中的颜色！

* * *

## 回答 #5

> 赞同：124
> 
> 时间：2008-11-11T06:12:16.553

[`git whatchanged -p filename`](http://www.kernel.org/pub/software/scm/git/docs/git-whatchanged.html)[`git log -p filename`](http://git-scm.com/docs/git-log)在这种情况下也等价于。

您还可以查看文件中的特定代码行何时更改为[`git blame filename`](http://www.kernel.org/pub/software/scm/git/docs/git-blame.html). 这将为文件中的每一行打印出一个简短的提交 ID、作者、时间戳和完整的代码行。在您发现错误并且想知道它是什么时候引入的（或者是谁的错）之后，这非常有用。

* * *

## 回答 #6

> 赞同：116
> 
> 时间：2013-07-30T18:55:48.307

## 源树用户

如果您使用 Sourcetree 来可视化您的存储库（它是免费的并且非常好），您可以右键单击一个文件并选择**Log Selected**

![在此处输入图像描述](https://i.stack.imgur.com/CHvfE.png)

显示（下图）比[gitk](https://git-scm.com/docs/gitk)和列出的大多数其他选项更友好。不幸的是（此时）没有简单的方法可以从命令行启动这个视图——Sourcetree 的 CLI 目前只是打开存储库。

![在此处输入图像描述](https://i.stack.imgur.com/Y9ALz.png)

* * *

## 回答 #7

> 赞同：72
> 
> 时间：2010-08-11T13:01:24.953

要显示上次修改文件每一行的版本和作者：

```
git blame filename 
```

或者如果你想使用强大的责备 GUI：

```
git gui blame filename 
```

* * *

## 回答 #8

> 赞同：60
> 
> 时间：2012-12-05T18:38:20.240

阅读并玩了一下其他答案的摘要：

通常的命令行命令是

```
git log --follow --all -p dir/file.c 
```

但是您也可以使用[gitk](https://git-scm.com/docs/gitk) (GUI) 或 tig (文本 UI) 来提供更多人类可读的方式来查看它。

```
gitk --follow --all -p dir/file.c

tig --follow --all -p dir/file.c 
```

在[Debian](https://en.wikipedia.org/wiki/Debian) / [Ubuntu](https://en.wikipedia.org/wiki/Ubuntu_%28operating_system%29)下，这些可爱工具的安装命令符合预期：

```
sudo apt-get install gitk tig 
```

我目前正在使用：

```
alias gdf='gitk --follow --all -p' 
```

这样我就可以键入`gdf dir`以获取子目录中所有内容的集中历史记录`dir`。

* * *

## 回答 #9

> 赞同：29
> 
> 时间：2019-05-14T04:08:29.140

您可以将 Visual Studio Code 与[GitLens](https://marketplace.visualstudio.com/items?itemName=eamodio.gitlens)一起使用。这是一个非常强大的工具。

安装 GitLens 后，进入 GitLens 选项卡，选择`FILE HISTORY`并浏览它。

[![在此处输入图像描述](https://i.stack.imgur.com/H0j9A.png)](https://i.stack.imgur.com/H0j9A.png)

* * *

## 回答 #10

> 赞同：28
> 
> 时间：2013-06-26T20:12:30.963

将此别名添加到您的 .gitconfig：

```
[alias]
    lg = log --all --graph --pretty=format:'%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr) %C(bold blue)<%an>%Creset'\n--abbrev-commit --date=relative 
```

并使用如下命令：

```
> git lg
> git lg -- filename 
```

输出看起来与 gitk 输出几乎完全相同。享受。

* * *

## 回答 #11

> 赞同：23
> 
> 时间：2015-11-10T11:53:57.213

最近我发现`tig`并发现它非常有用。在某些情况下，我希望它是 A 或 B，但大多数时候它相当整洁。

对于您的情况，`tig <filename>`可能是您正在寻找的。

[https://jonas.github.io/tig/](https://jonas.github.io/tig/)

* * *

## 回答 #12

> 赞同：16
> 
> 时间：2015-08-13T05:41:19.673

你也可以试试这个，它列出了更改文件特定部分的提交（在 Git 1.8.4 中实现）。

返回的结果将是修改此特定部分的提交列表。命令：

```
git log --pretty=short -u -L <upperLimit>,<lowerLimit>:<path_to_filename> 
```

其中，upperLimit 是起始行号，lowerLimit 是文件的结束行号。

更多详情见*[https://web.archive.org/web/20210120153550/http://techpurohit.com/list-some-useful-git-commands](https://web.archive.org/web/20210120153550/http://techpurohit.com/list-some-useful-git-commands)*。

* * *

## 回答 #13

> 赞同：15
> 
> 时间：2012-11-19T06:25:32.557

我为此目的写了[git-playback](https://github.com/jianli/git-playback)

```
pip install git-playback
git playback [filename] 
```

这样做的好处是既可以在命令行中显示结果（例如`git log -p`），又可以让您使用箭头键逐步完成每个提交（例如`gitk`）。

* * *

## 回答 #14

> 赞同：14
> 
> 时间：2010-09-17T16:50:30.143

或者：

`gitx -- <path/to/filename>`

如果您使用的是[gitx](http://gitx.frim.nl/)

* * *

## 回答 #15

> 赞同：11
> 
> 时间：2020-03-31T01:28:27.733

在[Sourcetree](https://www.sourcetreeapp.com/) UI 中，您可以通过在右键单击上下文菜单中选择“Log Selected”选项来查找文件的历史记录：

[![在此处输入图像描述](https://i.stack.imgur.com/uxBTn.png)](https://i.stack.imgur.com/uxBTn.png)

它将显示所有提交的历史记录。

* * *

## 回答 #16

> 赞同：9
> 
> 时间：2012-08-07T13:57:47.363

如果您想查看文件的整个历史记录，*包括**所有其他*分支，请使用：

```
gitk --all <filename> 
```

* * *

## 回答 #17

> 赞同：8
> 
> 时间：2008-11-10T15:56:29.307

如果您使用的是[Git GUI](https://git-scm.com/docs/git-gui)（在 Windows 上）：

在 Repository 菜单下，您可以使用“Visualize master's History”。突出显示顶部窗格中的提交和右下角的文件，您将在左下角看到该提交的差异。

* * *

## 回答 #18

> 赞同：7
> 
> 时间：2012-11-28T15:58:50.320

使用出色的[Git Extensions](http://gitextensions.github.io/)，您可以转到文件仍然存在的历史记录中的某个点（如果它已被删除，否则只需转到 HEAD），切换到`File tree`选项卡，右键单击文件并选择`File history`.

默认情况下，它通过重命名跟随文件，并且`Blame`选项卡允许查看给定修订的名称。

它有一些小问题，例如单击删除修订时`fatal: Not a valid object name`在`View`选项卡中显示，但我可以忍受。:-)

* * *

## 回答 #19

> 赞同：6
> 
> 时间：2016-06-01T10:44:13.030

**[聪明的](http://www.syntevo.com/smartgit/)：**

1.  在菜单中启用以显示未更改的文件：查看/显示未更改的文件
2.  右键单击文件并选择“日志”或按“Ctrl-L”

* * *

## 回答 #20

> 赞同：5
> 
> 时间：2011-12-01T05:24:23.167

我要找的答案不在这里。这是为了查看我为提交暂存的文件中的更改。IE，

```
git diff --cached 
```

* * *

## 回答 #21

> 赞同：5
> 
> 时间：2015-08-12T21:22:40.653

如果您使用 TortoiseGit，您应该能够右键单击该文件并执行`TortoiseGit --> Show Log`. 在弹出的窗口中，确保：

*   ' `Show Whole Project`' 选项未选中。

*   ' `All Branches`' 选项被选中。

* * *

## 回答 #22

> 赞同：4
> 
> 时间：2013-05-20T17:17:01.760

`git diff -U <filename>`给你一个统一的差异。

它应该用红色和绿色着色。如果不是，请运行：`git config color.ui auto`首先。

* * *

## 回答 #23

> 赞同：2
> 
> 时间：2013-01-02T19:35:17.630

如果您将[Eclipse](https://en.wikipedia.org/wiki/Eclipse_%28software%29)与 Git 插件一起使用，它有一个很好的历史比较视图。右键单击文件并选择“比较”→“历史记录”。

* * *

## 回答 #24

> 赞同：1
> 
> 时间：2020-03-27T19:43:59.657

我可能是关于 OP 开始时的位置，寻找一些简单的东西，让我可以使用*git difftool*和*vimdiff*来查看从特定提交开始对我的 repo 中文件的更改。我对找到的答案不太满意，所以我把这个**git inc** remental **rep** orter (gitincrep) 脚本放在一起，它对我很有用：

```
#!/usr/bin/env bash

STARTWITH="${1:-}"
shift 1

DFILES=( "$@" )

RunDiff()
{
        GIT1=$1
        GIT2=$2
        shift 2

        if [ "$(git diff $GIT1 $GIT2 "$@")" ]
        then
                git log ${GIT1}..${GIT2}
                git difftool --tool=vimdiff $GIT1 $GIT2 "$@"
        fi
}

OLDVERS=""
RUNDIFF=""

for NEWVERS in $(git log --format=format:%h  --reverse)
do
        if [ "$RUNDIFF" ]
        then
                RunDiff $OLDVERS $NEWVERS "${DFILES[@]}"
        elif [ "$OLDVERS" ]
        then
                if [ "$NEWVERS" = "${STARTWITH:=${NEWVERS}}" ]
                then
                        RUNDIFF=true
                        RunDiff $OLDVERS $NEWVERS "${DFILES[@]}"
                fi
        fi
        OLDVERS=$NEWVERS
done 
```

不带参数调用，这将从回购历史的开头开始，否则它将以您提供的任何缩写提交哈希开始并继续到现在 - 您可以随时 ctrl-C 退出。第一个之后的任何参数都将限制差异报告以仅包含这些参数中列出的文件（我认为这是 OP 想要的，我建议除了小型项目之外的所有项目）。如果您要检查对特定文件的更改**并**希望从头开始，则需要为 arg1 提供一个空字符串。如果你不是 vim 用户，你可以用你最喜欢的 diff 工具替换*vimdiff 。*

行为是在找到相关更改时输出提交注释并开始为每个更改的文件提供*vimdiff运行（这是**git difftool*行为，但它在这里有效）。

这种方法可能非常幼稚，但是在这里和相关帖子中查看了很多解决方案，其中许多涉及在我没有管理员访问权限的系统上安装新工具，并且界面有自己的学习曲线。上面的脚本做了我想要的，没有处理任何这些。当我需要更复杂的东西时，我会在这里研究许多优秀的建议——但我认为这直接响应了 OP。

# linux - 为什么各种 Linux 发行版使用不同的包管理器？

> ID：278213
> 
> 赞同：14
> 
> 时间：2008-11-10T15:50:01.507
> 
> 标签：linux, unix, installation, package-managers

为什么 Linux 发行版有不同的包管理器？

我觉得这很奇怪，因为其他软件，如文本编辑器、桌面环境和图形软件（Inkscape、Blender、GIMP）在发行版之间共享。为什么没有通用的设置工具？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-11-10T16:11:07.470

与 UNIX 世界中存在重复行为的大多数事物一样，它是许多事物的组合，但主要是历史、政治/宗教以及建立更好的捕鼠器 / NiH 综合症的愿望。执行等效任务的多个系统组件的存在通常被开源支持者称赞为有用的功能。

一般来说，您最需要担心四种包管理系统。您拥有 debian 派生系统，例如使用 debian、ubuntu`.deb`和**apt/dpkg**系列管理工具。您拥有使用该`.rpm`格式和**rpm/yum**系列管理工具的 redhat 派生系统。在我看来，就功能而言，这两者大致相同。

重要的是尝试并学习您正在使用的工具集，它们都有很好的文档记录。了解如何检查依赖关系并验证包签名和完整性，并找出包提供的服务，以及相反的包负责特定安装的文件或程序，使用本地包工具为您选择的分发。理想情况下，为 yum 和 rpm 以及 dpkg 和 aptitude 学习命令行选项，您将涵盖大多数基础。然后，如果您愿意，可以使用 GUI 工具。

我认为要记住的最重要的事情是，在同一系统中混合来自不同发行版或发行版的软件包通常是错误的，即使它们使用相同的软件包格式，例如不要在您的 ubuntu 系统或 SuSE rpm 上安装 debian .deb 文件Fedora 系统上的文件，除非你真的明白你在做什么。

我提到的其他两种口味不太主流，但为了完整起见，我将它们列出来。这些都是

*   a）在二进制/源代码tarball之外没有包系统，*例如*经典的slackware，和

*   b) 仿照 BSD 移植的源代码构建工具，*一个*经典的 gentoo。

再说一次，在我看来，你不想在这里，直到你明白你**为什么想要。**

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-10T15:57:08.310

历史原因。同样，您可能会问为什么有多家公司提供类似的服务，而只有一家公司整体效率更高。

请参阅[http://kitenet.net/~joey/pkg-comp/](http://kitenet.net/~joey/pkg-comp/)从 Debian 开发人员的角度比较不同的包格式。另请注意，您可以使用名为[alien](http://kitenet.net/~joey/code/alien/)的程序在其他类型的系统上安装一种包。它并不完美，但当供应商为您选择的发行版以“错误”的软件包格式提供软件时，它会有所帮助。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-10T16:08:16.663

历史惯性。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-10T19:10:20.167

Fedora 现在同时使用 APT 和 YUM，他们在他们的 Wiki 上有一点关于它的介绍，当他们开始制作 Fedora 时，他们选择了 YUM，因为 APT 有一段时间没有任何更新，他们现在支持 APT，但默认使用 YUM 因为这就是 Anaconda 安装程序使用的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-10T15:52:37.287

还有许多不同的文本编辑器、桌面环境等等。不同的发行版只共享这一点，因为它们提供了所有这些程序。

但是他们必须决定一个包管理器。不同的包管理器不会知道另一个包管理器安装的软件。因此，发行版会根据自己的特定需求来决定一个或自己开发一个。

两个非常常见的包管理器是 RPM 和 apt，它们都被不同的发行版使用。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-10T15:57:10.493

有些确实共享一个包管理器。我在几个发行版上使用过 Apt。一些发行版需要更具体的理念。例如，Gentoo 需要获取源代码并进行编译的东西，而不仅仅是安装二进制文件。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-11-12T15:02:08.417

在某些情况下，只是发行版的制造商更喜欢一种包管理系统而不是另一种。Linux 的好处在于选择，多个包管理系统意味着更多选择。

# c# - LINQ to XML 可选元素查询

> ID：278215
> 
> 赞同：14
> 
> 时间：2008-11-10T15:50:29.103
> 
> 标签：c#, linq, linq-to-xml, anonymous-types

我正在使用现有的 XML 文档，该文档的结构（部分）如下：

```
<Group>
    <Entry>
        <Name> Bob </Name>
        <ID> 1 </ID>
    </Entry>
    <Entry>
        <Name> Larry </Name>
    </Entry>
</Group> 
```

我正在使用 LINQ to XML 查询 XDocument 以检索所有这些条目，如下所示：

```
var items = from g in xDocument.Root.Descendants("Group").Elements("Entry")
    select new
    {
        name = (string)g.element("Name").Value,
        id = g.Elements("ID").Count() > 0 ? (string)g.Element("ID").Value : "none"
    }; 
```

“ID”元素并不总是存在，所以我的解决方案是上面的 Count() 爵士乐。但我想知道是否有人有更好的方法来做到这一点。我仍然对这些新东西感到满意，我怀疑可能有比我目前做的更好的方法来做到这一点。

有没有更好/更喜欢的方式来做我想做的事？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-11-10T16:32:20.470

[XElement](http://msdn.microsoft.com/en-us/library/system.xml.linq.xelement.aspx)实际上有[有趣的显式转换运算符](http://msdn.microsoft.com/en-us/library/system.xml.linq.xelement.op_explicit.aspx)，在这种情况下可以做正确的事情。

因此，您实际上很少需要访问该`.Value`属性。

这就是您的投影所需的全部内容：

```
var items =
    from g in xDocument.Root.Descendants("Group").Elements("Entry")
    select new
    {
        name = (string) g.Element("Name"),
        id = (string) g.Element("ID") ?? "none",
    }; 
```

如果您希望`ID`在匿名类型中使用 的值作为整数：

```
var items =
    from g in xDocument.Root.Descendants("Group").Elements("Entry")
    select new
    {
        name = (string) g.Element("Name"),
        id = (int?) g.Element("ID"),
    }; 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-10T15:55:19.187

在类似的情况下，我使用了扩展方法：

```
 public static string OptionalElement(this XElement actionElement, string elementName)
    {
        var element = actionElement.Element(elementName);
        return (element != null) ? element.Value : null;
    } 
```

用法：

```
 id = g.OptionalElement("ID") ?? "none" 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-10T15:57:34.517

怎么样：

```
var items = from g in xDocument.Root.Descendants("Group").Elements("Entry")
            let idEl = g.Element("ID")
            select new
            {
                name = (string)g.element("Name").Value,
                id = idEl == null ? "none" : idEl.Value;
            }; 
```

如果这个 barfs, then `FirstOrDefault()`etc 可能有用，否则只需使用扩展方法（如已经建议的那样）。

# sql - 您建议使用哪些工具或方法来创建大量 SQL 测试数据？

> ID：278226
> 
> 赞同：0
> 
> 时间：2008-11-10T15:53:14.650
> 
> 标签：sql, sql-server, database, performance, testing

我想对我的一些 SQL 查询进行压力测试，并找出错误的查询计划和瓶颈。我计划**用随机测试数据填充一些表格**。

是否有可用于此目的的工具或一组脚本，最好是用于 SQL Server？

*谢谢！*

***更新：对不起，不知道这两个问题已经存在：***

*   [SQL 服务器的数据生成器？](https://stackoverflow.com/questions/157600/data-generators-for-sql-server)
*   [在数据库中创建测试数据](https://stackoverflow.com/questions/16317/creating-test-data-in-a-database)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-10T15:56:51.087

[本网站](http://www.generatedata.com/#about)将为您生成大量定制数据。

从那个网站：

> 曾经需要自定义格式的样本/测试数据，比如，不好？嗯，这就是数据生成器的想法。它是用 JavaScript、PHP 和 MySQL 编写的免费开源脚本，可让您快速生成各种格式的大量自定义数据，用于测试软件、填充数据库和与女孩一起评分。
> 
> 该站点提供了一个在线演示，欢迎您在其中修补以了解该脚本的功能、它提供的功能以及它是如何工作的。然后，一旦您大快朵颐，就有一个免费的、功能齐全的 GNU 许可版本可供下载。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-10T15:56:35.127

我过去曾成功使用过[这个数据生成器](http://www.generatedata.com/#generator)——但可能不足以满足您的需求。

# c# - 将窗口保持在顶部并在 WinForms 中窃取焦点

> ID：278237
> 
> 赞同：25
> 
> 时间：2008-11-10T15:56:14.380
> 
> 标签：c#, .net, winforms

我意识到在正常情况下这将是完全不好的做法，但这仅适用于需要从条形码扫描仪（模拟键盘）获取输入的测试应用程序。问题是我需要在扫描时启动一些脚本，所以我需要在单击脚本运行后直接重新获得焦点。我尝试过使用 Activate()、BringToFront()、Focus() 以及一些 Win32 调用，如 SetForegroundWindow()、Setcapture() 和 SetActiveWindow()……但是我能得到的最好的方法是让任务栏项目开始闪烁，告诉我它*想要*获得焦点，但有东西阻止它。顺便说一句，我在 XP SP2 上运行它并使用 .NET 2.0。

这可能吗？

编辑：为了澄清，我通过在资源管理器中双击它们来运行脚本。所以我需要它从资源管理器和测试应用程序中窃取焦点。

* * *

## 回答 #1

> 赞同：46
> 
> 时间：2011-05-02T04:48:52.617

我在类似的问题上挣扎了很长一段时间。经过大量的实验和猜测，这就是我解决它的方法：

```
// Get the window to the front.
this.TopMost = true;
this.TopMost = false;

// 'Steal' the focus.
this.Activate(); 
```

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-11-10T15:59:11.237

## 能见度

使窗口成为“Top-Most”窗口。这是任务管理器可以保持在其他窗口之上的方式。这是 a 的一个属性，`Form`您可以通过将值设置为 来使表单位于最顶层（浮动在其他窗口之上）**`true`**。

您不需要使用最高设置覆盖任何“活动窗口”行为。

## 重点

[我之前在 StackOverflow 上](https://stackoverflow.com/questions/91234/multiple-keyboards-and-low-level-hooks)问过一个类似的问题，答案将解决您的问题。您可以使应用程序使用低级输入挂钩并获取来自扫描仪的键码的通知。这样，即使应用程序没有焦点，您的应用程序也始终可以获取这些键。

您可能需要增强解决方案以压缩键代码，以便它们不会传输到“焦点”应用程序（例如记事本）。

从 Windows 2000 开始，没有官方机制可以让应用程序在没有用户直接干预的情况下获取焦点。通过 RawInputDevices 挂钩查看输入流是唯一明智的方法。

许多文章可能会有所帮助（C# 实现）

*   [关于 CodeProject 的 RawInput 文章](http://www.codeproject.com/KB/system/rawinput.aspx)
*   [RawInput 的 MSDN 文档](http://msdn.microsoft.com/en-us/library/ms645536(VS.85).aspx)

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2009-10-22T19:30:28.547

我遇到了类似的问题，并发现以下方法可以解决问题。[从这里](http://www.tek-tips.com/faqs.cfm?fid=4262)适应 C#

```
 // force window to have focus
        uint foreThread = GetWindowThreadProcessId(GetForegroundWindow(), IntPtr.Zero);
        uint appThread = GetCurrentThreadId();
        const uint SW_SHOW = 5;
        if (foreThread != appThread)
        {
            AttachThreadInput(foreThread, appThread, true);
            BringWindowToTop(form.Handle);
            ShowWindow(form.Handle, SW_SHOW);
            AttachThreadInput(foreThread, appThread, false);
        }
        else
        {
            BringWindowToTop(form.Handle);
            ShowWindow(form.Handle, SW_SHOW);
        }
        form.Activate(); 
```

**编辑：**以下是 C# 的必要 PInvoke 定义：

```
[DllImport("user32.dll", SetLastError = true)]
static extern uint GetWindowThreadProcessId(IntPtr hWnd, out uint lpdwProcessId);

// When you don't want the ProcessId, use this overload and pass IntPtr.Zero for the second parameter
[DllImport("user32.dll")]
static extern uint GetWindowThreadProcessId(IntPtr hWnd, IntPtr ProcessId);

[DllImport("kernel32.dll")]
static extern uint GetCurrentThreadId();

/// <summary>The GetForegroundWindow function returns a handle to the foreground window.</summary>
[DllImport("user32.dll")]
private static extern IntPtr GetForegroundWindow();

[DllImport("user32.dll")]
static extern bool AttachThreadInput(uint idAttach, uint idAttachTo, bool fAttach);

[DllImport("user32.dll", SetLastError = true)]
static extern bool BringWindowToTop(IntPtr hWnd);

[DllImport("user32.dll", SetLastError = true)]
static extern bool BringWindowToTop(HandleRef hWnd);

[DllImport("user32.dll")]
static extern bool ShowWindow(IntPtr hWnd, uint nCmdShow); 
```

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2011-11-09T17:33:55.463

我解决这个问题的方法是生成另一个线程，其唯一目的是确保 Form 是 TopMost 并且始终具有焦点。此代码将使所有其他应用程序在运行时无法使用，这是我的特定应用程序所需要的。您可以在 keepFocus 中添加 Sleep 或让其他事件触发它。

```
using System.Threading;          // be sure to include the System.Threading namespace

    //Delegates for safe multi-threading.
    delegate void DelegateGetFocus();
    private DelegateGetFocus m_getFocus;

    //Constructor.
    myForm()
    {
        m_getFocus = new DelegateGetFocus(this.getFocus);   // initialise getFocus
        InitializeComponent();
        spawnThread(keepFocus);                             // call spawnThread method
    }

    //Spawns a new Thread.
    private void spawnThread(ThreadStart ts)
    {
        try
        {
            Thread newThread = new Thread(ts);
            newThread.IsBackground = true;
            newThread.Start();
        }
        catch(Exception e)
        {
            MessageBox.Show(e.Message, "Exception!", MessageBoxButtons.OK, 
                MessageBoxIcon.Error);
        }
    }

    //Continuously call getFocus.
    private void keepFocus()
    {
        while(true)
        {
            getFocus();
        }
    }

    //Keeps Form on top and gives focus.
    private void getFocus()
    {
        //If we need to invoke this call from another thread.
        if (this.InvokeRequired)
        {
            try
            {
                this.Invoke(m_getFocus, new object[] { });
            }
            catch (System.ObjectDisposedException e)
            {
                // Window was destroyed. No problem but terminate application.
                Application.Exit();
            }
        }
        //Otherwise, we're safe.
        else
        {
            this.TopMost = true;
            this.Activate();
        }
    }       
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-10T16:00:24.183

您可以尝试专注于特定输入，或尝试将 .TopMost 属性设置为 true（然后再次取消设置）。

但我怀疑您的问题是这些方法都只是将消息放入 Windows 事件队列中，并且您的程序必须等待所有现有事件完成处理，然后才能处理该事件并关注应用程序。

# .net - 枚举 resx 中的所有字符串

> ID：278249
> 
> 赞同：4
> 
> 时间：2008-11-10T15:57:29.273
> 
> 标签：.net, javascript, localization, internationalization, resx

我们想枚举 .NET 资源文件（resx 文件）中的所有字符串。我们希望它生成一个包含所有这些键值对的 javascript 对象。我们现在使用这样的代码对附属程序集执行此操作（这是 VB.NET，但任何示例代码都可以）：

```
Dim rm As ResourceManager
rm = New ResourceManager([resource name], [your assembly])
Dim Rs As ResourceSet
Rs = rm.GetResourceSet(Thread.CurrentThread.CurrentCulture, True, True)
For Each Kvp As DictionaryEntry In Rs
    [Write out Kvp.Key and Kvp.Value]
Next 
```

但是，遗憾的是，我们还没有找到对 .resx 文件执行此操作的方法。我们如何枚举 resx 文件中的所有本地化字符串？

更新：

根据 Dennis Myren 的评论和[这里](http://blechie.com/WPierce/archive/2007/08/01/Using-Resx-Files-with-a-ResourceManager.aspx)的想法，我构建了一个 ResXResourceManager。现在我可以对 .resx 文件执行与嵌入资源相同的操作。这是代码。请注意，Microsoft 将所需的构造函数设为私有，因此我使用反射来访问它。使用它时您需要完全信任。

```
Imports System.Globalization
Imports System.Reflection
Imports System.Resources
Imports System.Windows.Forms

Public Class ResXResourceManager
    Inherits ResourceManager

    Public Sub New(ByVal BaseName As String, ByVal ResourceDir As String)
        Me.New(BaseName, ResourceDir, GetType(ResXResourceSet))
    End Sub

    Protected Sub New(ByVal BaseName As String, ByVal ResourceDir As String, ByVal UsingResourceSet As Type)
        Dim BaseType As Type = Me.GetType().BaseType
        Dim Flags As BindingFlags = BindingFlags.NonPublic Or BindingFlags.Instance
        Dim Constructor As ConstructorInfo = BaseType.GetConstructor(Flags, Nothing, New Type() { GetType(String), GetType(String), GetType(Type) }, Nothing)
        Constructor.Invoke(Me, Flags, Nothing, New Object() { BaseName, ResourceDir, UsingResourceSet }, Nothing)
    End Sub

    Protected Overrides Function GetResourceFileName(ByVal culture As CultureInfo) As String
        Dim FileName As String
        FileName = MyBase.GetResourceFileName(culture)
        If FileName IsNot Nothing AndAlso FileName.Length > 10 Then
            Return FileName.Substring(0, FileName.Length - 10) & ".resx"
        End If
        Return Nothing
    End Function
End Class 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-10T16:42:08.030

使用[System.Resources.ResXResourceReader](http://msdn.microsoft.com/en-us/library/system.resources.resxresourcereader.aspx)（在 System.Windows.Forms.dll 中）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-02-16T05:38:46.120

[http://tonesdotnetblog.wordpress.com/2010/02/14/string-enumerations-and-resource-files-in-c/](http://tonesdotnetblog.wordpress.com/2010/02/14/string-enumerations-and-resource-files-in-c/)有一个替代解决方案，它涉及将属性放在能够从资源文件中读取字符串的枚举上。这使用了另一种自定义工具。

# php - 是否可以回退 PDO 结果？

> ID：278259
> 
> 赞同：14
> 
> 时间：2008-11-10T15:59:46.120
> 
> 标签：php, iterator, pdo

我正在尝试为 PDO 语句的结果编写一个迭代器，但我找不到任何倒回第一行的方法。我想避免调用 fetchAll 并存储所有结果数据的开销。

```
// first loop works fine
foreach($statement as $result) {
    // do something with result
}

// but subsequent loops don't
foreach($statement as $result) {
    // never called 
} 
```

有没有办法重置语句或寻找第一行？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-10T18:10:43.453

我很确定这取决于数据库。正因为如此，这是你应该尽量避免的事情。[但是，我认为您可以通过启用缓冲查询](http://www.php.net/pdo-mysql#pdo-mysql.constants)来实现您想要的。如果这不起作用，您始终可以使用[`fetchAll`](http://www.php.net/manual/en/pdostatement.fetchall.php). 这两种解决方案都会影响您的应用程序性能，因此如果结果集很大，请三思而后行。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-11-10T18:46:08.497

请参阅[此演示文稿中的幻灯片 31](http://somabo.de/talks/200311_apachecon_php5_and_databases.pdf "介绍")`$statement->rewind()` ，如果它适用于缓冲查询，您可以执行此操作。如果您使用 mysql，则可以使用以下命令模拟缓冲查询`PDO_MYSQL_ATTR_USE_BUFFERED_QUERY`：

```
$pdo->setAttribute(PDO::MYSQL_ATTR_USE_BUFFERED_QUERY, 1); 
```

@NoahGoodrich 向您指出 spl。这是一个始终有效的示例：

```
$it = new ArrayIterator($stmt->fetchAll()); 
```

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2013-06-14T06:03:51.250

我写的这个小类包装了一个 PDOStatement。它只存储获取的数据。如果这不起作用，您可以移动缓存以读取和写入文件。

```
// Wrap a PDOStatement to iterate through all result rows. Uses a 
// local cache to allow rewinding.
class PDOStatementIterator implements Iterator
{
    public
        $stmt,
        $cache,
        $next;

    public function __construct($stmt)
    {
        $this->cache = array();
        $this->stmt = $stmt;
    }

    public function rewind()
    {
        reset($this->cache);
        $this->next();
    }

    public function valid()
    {
        return (FALSE !== $this->next);
    }

    public function current()
    {
        return $this->next[1];
    }

    public function key()
    {
        return $this->next[0];
    }

    public function next()
    {
        // Try to get the next element in our data cache.
        $this->next = each($this->cache);

        // Past the end of the data cache
        if (FALSE === $this->next)
        {
            // Fetch the next row of data
            $row = $this->stmt->fetch(PDO::FETCH_ASSOC);

            // Fetch successful
            if ($row)
            {
                // Add row to data cache
                $this->cache[] = $row;
            }

            $this->next = each($this->cache);
        }
    }
} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2016-08-10T14:52:14.917

很久以前问过，但目前有另一种解决方案。

该方法可以接收具有常数`PDOStatement::fetch()`之一的第二参数，即光标方向。这些参数仅在使用as属性创建`PDO::FETCH_ORI_*`时才有效。`PDOStatement``PDO::ATTR_CURSOR``PDO::CURSOR_SCROLL`

这样，您可以按如下方式导航。

```
$sql = "Select * From Tabela";
$statement = $db->prepare($sql, array(
    PDO::ATTR_CURSOR => PDO::CURSOR_SCROLL,
));
$statement->execute();
$statement->fetch(PDO::FETCH_BOTH, PDO::FETCH_ORI_NEXT);  // return next
$statement->fetch(PDO::FETCH_BOTH, PDO::FETCH_ORI_PRIOR); // return previous
$statement->fetch(PDO::FETCH_BOTH, PDO::FETCH_ORI_FIRST); // return first
$statement->fetch(PDO::FETCH_BOTH, PDO::FETCH_ORI_LAST);  // return last
$statement->fetch(PDO::FETCH_BOTH, PDO::FETCH_ORI_ABS, $n); // return to $n position
$statement->fetch(PDO::FETCH_BOTH, PDO::FETCH_ORI_REL, $n); // return to $n position relative to current 
```

[文档](http://php.net/manual/en/pdostatement.fetch.php#refsect1-pdostatement.fetch-parameters)和[PDO 预定义常量](http://php.net/manual/en/pdo.constants.php)中的更多信息。

注意：使用`PDO::FETCH_BOTH`是因为是默认设置，只需为您的项目自定义即可。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-10T16:20:17.233

您可能希望了解一些 PHP SPL 类，这些类可以扩展以提供对对象的类似数组的访问。

*   [标准 PHP 库 (SPL)](http://us.php.net/spl)我特别建议您查看 ArrayIterator、ArrayObject，也许还有 Iterator 接口。
*   简单教程
*   另一个快速教程

# c++ - 如何实现 CEditListCtrl

> ID：278260
> 
> 赞同：0
> 
> 时间：2008-11-10T15:59:57.710
> 
> 标签：c++, visual-c++, mfc

如何实现 CEditListCtrl？。具有编辑功能的列表控件（报表/网格视图）。我在报告视图中有一个列表视图。它有一些价值。我需要扩展它以编辑列表视图中存在的值。我声明了一个继承自 CListCtrl 的类。我已经处理了两个窗口消息来开始和结束编辑。收到消息后，我正在显示一个文本框。但我没有在这些消息处理程序中获得控制权。有没有办法知道原因？

或者是否有其他方法来实现这一点。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-10T17:37:01.430

Code Project 上有一些简洁的网格控件可能会有所帮助：

[http://www.codeproject.com/KB/miscctrl/gridctrl.aspx](http://www.codeproject.com/KB/miscctrl/gridctrl.aspx)

[http://www.codeproject.com/KB/library/gridprojects.aspx](http://www.codeproject.com/KB/library/gridprojects.aspx)

[http://www.codeproject.com/KB/MFC/UltimateGrid.aspx](http://www.codeproject.com/KB/MFC/UltimateGrid.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-11T15:34:39.040

感谢所有答案

我很容易做到了。

1.  我已经处理了 WM_LBUTTONDOWN。此处理程序弹出编辑框以获取该字段的新值
2.  处理 LVN_ENDLABELEDIT 以了解更新结束。
3.  收到上述消息后，更新值。

“我忘记的一件事是在资源视图中为 CListCtrl 设置标志（将标签编辑为 TRUE）”</p>

我们还必须实现 OnPaint()（在 CListCtrl 的派生类中），否则 UI 将无法正确更新

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-10T16:04:40.883

您需要使用一个 CComboBox，它基本上是 CEdit 和 CListCtrl 的组合

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-11T23:23:13.807

这个问题也在这里被问到：

[如何使用 CListCtrl 就地编辑列？](https://stackoverflow.com/questions/253919/how-to-edit-columns-in-place-with-clistctrl#257598)

您可以在该页面上阅读我的答案。

# git - git仓库的部分共享

> ID：278270
> 
> 赞同：5
> 
> 时间：2008-11-10T16:04:42.413
> 
> 标签：git, github

我是 git 新手。我想知道是否支持以下场景，如果支持（即用于设置和更新的 git 命令）。

存储库可从三个不同的位置获得：“本地”、“镜像”和“github”。“mirror”完全镜像“local”，“github”镜像“local”，但“受版权保护”目录除外。

谢谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-10T22:55:14.393

子模块可以工作，但如果您尝试克隆包含其中一个遥控器不可用的子模块的内容，您将遇到更严重的错误。

我的替代方法是使用“filter-branch”命令来维护一个公共分支，该分支将忽略受版权保护的文件以供在 GitHub 上公开使用。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-10T18:04:39.800

您可以使用[git 子模块](http://git-scm.com/docs/git-submodule)支持将“受版权保护”目录保存在单独的 Git 存储库中。将这个单独的存储库保存在应该能够看到它的人可以访问的地方，并且不要将它推送到 github。对于访问公共存储库的人，他们会看到对“受版权保护”存储库的引用，但无法填充它。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-10T16:10:09.483

我认为这是不可能的。您可以尝试将“受版权保护”的目录放在未镜像的单独分支中，但这只会带来更多麻烦。

# delphi - 使用 Delphi 6 将图片添加到 Excel 工作表

> ID：278272
> 
> 赞同：2
> 
> 时间：2008-11-10T16:05:51.053
> 
> 标签：delphi, excel, spreadsheet, image

我已经用 Delphi 6 创建了一个 excel 表。现在我必须在我的表中添加一张图片。有人知道该怎么做吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-10T16:14:02.143

你可以这样尝试：

```
procedure InsertPicture(ActiveSheet: OleVariant; ImageFilePath: string: ImageHeight, PictureTop: Integer); 
var
  Picture: OleVariant;
begin
  Picture := ActiveSheet.Pictures.Insert(ImageFilePath);
  Picture.Width := ImageHeight * Picture.Width / Picture.Height;
  Picture.Height := ImageHeight;
  Picture.ShapeRange.Left := 0;
  Picture.ShapeRange.Top := PictureTop;
  Picture.Placement := xlMove;
end; 
```

# c++ - 如何保证在运行时解密的文件被清理干净？

> ID：278273
> 
> 赞同：3
> 
> 时间：2008-11-10T16:06:04.000
> 
> 标签：c++, c, encryption, filesystems

使用 C 或 C++，在我将文件解密到磁盘后 - 如果应用程序崩溃或系统关闭并且无法正确清理它，我如何保证它被删除？在 Windows 和 Linux 上使用 C 或 C++？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-10T16:28:47.247

不幸的是，没有 100% 万无一失的方法来确保在整个系统崩溃的情况下文件将被删除。想想如果用户只是在文件在磁盘上时拔掉插头会发生什么。再多的异常处理都无法保护您免受这种（最坏的）情况的影响。

您可以做的最好的事情是首先不要将解密的文件写入磁盘。如果文件以加密和解密的形式存在，那么这就是您的安全性的一个弱点。

您可以做的下一个最好的事情是使用 Brian 的结构化异常处理建议来确保清理临时文件。这不会保护你免受所有可能性的影响，但它会有很长的路要走。

最后，我建议您在应用程序启动时检查临时解密文件。这将允许您在应用程序完全崩溃的情况下进行清理。将这些文件保留一段时间并不理想*，*但至少这可以让您尽快摆脱它们。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-10T16:30:09.397

根本不要将解密的文件写入磁盘。

如果系统断电，文件仍在磁盘上，则可以访问磁盘和文件。

例外情况是使用加密的文件系统，但这是您的程序无法控制的。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-10T16:10:10.247

**尽量避免它：**

如果文件是敏感文件，最好的办法是首先不要将其以解密格式写入磁盘。

**防止崩溃：结构化异常处理：**

但是，您可以添加结构化异常处理来捕获任何崩溃。

[__try 和 __except](http://msdn.microsoft.com/en-us/library/s58ftw19.aspx)

**如果他们拔掉插头怎么办？：**

有一种方法可以防止这种情况...

如果您在 Windows 上，您可以使用 MoveFileEx 和选项 MOVEFILE_DELAY_UNTIL_REBOOT 与 NULL 的目的地在下次启动时删除文件。这将防止计算机因未删除的文件而意外关机。您还可以确保您拥有该文件的独占打开句柄（指定不共享权限，例如 FILE_SHARE_READ 并使用 CreateFile 打开它）。这样一来，任何人都无法从中读取。

**避免该问题的其他方法：** 所有这些都不是在磁盘上拥有解密文件的借口，而是：

*   您还可以考虑通过 \\?\ 的文件语法写入大于 MAX_PATH 的文件。这将确保文件不能被 Windows 资源管理器浏览。

*   您应该将文件设置为具有临时属性

*   您应该将文件设置为具有隐藏属性

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-11-10T16:15:30.907

我不知道这是否适用于Windows，但在Linux上，假设您只需要一个进程来访问解密文件，您可以打开该文件，然后调用unlink()删除该文件。只要进程保持打开，文件就会继续存在，但当它关闭或进程终止时，文件将不再可访问。

当然文件的内容仍然在磁盘上，所以你需要的不仅仅是删除它，而是清零内容。解密文件是否需要在磁盘上（大小？）。最好将解密的版本保存在内存中，最好标记为不可交换，这样它就不会碰到磁盘。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-10T17:58:57.097

在 C 中（因此，我假设在 C++ 中也是如此），只要您的程序没有崩溃，您就可以注册一个`atexit()`处理程序来进行清理。只是避免使用`_exit()`or`_Exit()`因为那些绕过`atexit()`处理程序。

但是，正如其他人指出的那样，最好避免将解密的数据写入磁盘。仅仅使用`unlink()`（或等效）是不够的；您需要在原始数据上重写一些其他数据。日志文件系统使这变得非常困难。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-10T16:10:28.657

一个进程不能保护或监视自己。您唯一的可能是启动第二个进程作为一种看门狗，它会定期检查解密其他进程的健康状况。如果其他进程崩溃，看门狗会注意到并删除文件本身。

您可以使用 hearth-beats（定期轮询其他进程以查看它是否还活着）或使用从其他进程本身发送的中断来做到这一点，如果它已经崩溃，这将触发超时。

例如，您可以使用套接字来使看门狗和您的应用程序之间的连接正常工作。

很明显，您需要一些锁定机制来防止交换到页面文件/交换分区。在 Posix 系统上，这可以通过`m(un)lock* family of functions`.

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-10T16:34:04.910

查看 tmpfile()。

它是 BSD UNIX 的一部分，不确定它是否是标准的。
但它会创建一个临时文件并自动取消链接，以便在关闭时将其删除。

写入文件系统（即使是暂时的）是不安全的。
只有当你真的必须这样做时才这样做。

或者，您可以创建一个内存文件系统。
我自己从来没有使用过，所以没有推荐，但快速谷歌发现了一些。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-11-10T16:52:33.267

删除文件有问题。它并没有真正消失。当您从硬盘驱动器中删除文件（不包括回收站）时，该文件并没有真正消失。只是删除了指向文件的指针。

曾经看过那些他们覆盖硬盘驱动器 6、8,24 次的间谍电影，这就是他们如何知道它是干净的.. 他们这样做是有原因的。我会尽一切努力不存储文件的解密数据。或者，如果必须，使其成为少量数据。甚至，脱节的数据。

如果你必须，那么他们尝试抓住应该保护你一点。虽然没有什么可以保护你免受停电的影响。

祝你好运。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-11-10T22:51:36.553

在 C++ 中，您应该使用[RAII](http://en.wikipedia.org/wiki/Resource_Acquisition_Is_Initialization)策略：

```
class Clean_Up_File {
    std::string filename_;
    public Clean_Up_File(std::string filename) { ... } //open/create file
    public ~Clean_Up_File() { ... } //delete file
}

int main()
{
    Clean_Up_File file_will_be_deleted_on_program_exit("my_file.txt");
} 
```

RAII 有助于自动化大量清理工作。您只需在堆栈上创建一个对象，并让该对象在其生命周期结束时进行清理（在对象超出范围时将调用的析构函数中）。 [ScopeGuard](http://www.ddj.com/cpp/184403758)甚至使它更容易一些。

但是，正如其他人所提到的，这只适用于“正常”情况。如果用户拔下计算机，您不能保证该文件将被删除。并且可以取消删除文件（即使在 UNIX 上也可以“ [grep the harddrive](http://www.google.com/search?q=grep+harddrive) ”）。

* * *

此外，正如评论中所指出的，在某些情况下对象不会超出范围（例如，`std::exit(int)`函数退出程序而不离开当前范围），因此 RAII 在这些情况下不起作用。就个人而言，我从不调用`std::exit(int)`，而是抛出异常（这将展开堆栈并调用析构函数；我认为这是“异常退出”）或从中返回错误代码`main()`（这将调用析构函数，我也认为这是“异常出口”）。IIRC，发送 a`SIGKILL`也不会调用析构函数，`SIGKILL`也不会被捕获，所以你也不走运。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-11-10T16:16:27.943

这是一个棘手的话题。通常，如果可以避免，您不想将解密文件写入磁盘。但是将它们保存在内存中并不总是保证它们不会作为页面文件的一部分或其他方式写入磁盘。

我很久以前读过有关这方面的文章，我记得 Windows 和 Linux 之间存在一些区别，即一个可以保证内存页面不会写入磁盘而一个不能。但我记不太清楚了。

如果您想进行尽职调查，可以查找该主题并阅读相关内容。这完全取决于您的威胁模型以及您愿意防范的内容。毕竟，您可以使用压缩空气来冷却 RAM 并从中取出加密密钥（这实际上是在新的 Christian Slater 间谍节目 My Own Worst Enemy 中 - 我认为这是对尖端、准确、计算机的最佳使用媒体中的安全技术）

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-11-12T08:58:24.767

在 Linux/Unix 上，创建文件后立即使用 unlink。一旦您的程序关闭文件描述符或退出，该文件将被删除。

更好的是，即使整个系统崩溃，该文件也会被删除 - 因为一旦您取消链接，它就会被删除。

当然，这些数据不会从磁盘上被物理删除，因此它仍然可以被黑客攻击。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-11-12T20:37:27.697

请记住，计算机可能随时关闭。然后，您不喜欢的人可以使用 Linux live CD 启动，并以所需的任何详细程度检查您的磁盘，而无需更改任何内容。将明文写入磁盘的任何系统都无法抵御此类攻击，而且它们并不难做到。

您可以设置一个函数，用 1 和 0 重复覆盖文件，最好注入一些随机性，并将其设置为在程序结束或退出时运行。如果没有硬件或软件故障、电源故障或其他中断，并且文件系统只写入它声称正在使用的扇区（例如，日志文件系统可能会将部分文件留在其他地方），这将起作用）。

因此，如果你想要安全，你需要确保没有明文被写出，这也意味着它不能被写入交换空间或等价物。了解如何在您编写的所有平台上将内存标记为不可交换。确保解密密钥等以与明文相同的方式处理：在任何情况下都不要写入磁盘，并保存在不可交换的内存中。

然后，您的系统应该是安全的，不会受到敌方入侵、中断和在断电前冻结您的 RAM 芯片的攻击，因此它们在被转移进行检查之前不会丢失其内容。或者当局合法地（在此处查看当地法律）或非法地要求您提供密钥。

故事的寓意：真正的安全是很难的。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-11-15T15:27:49.343

我将要实现的方法是流式解密——以便内存中唯一的部分是在读取期间在使用数据时解密的部分。下面是管道示意图：

这将是一个流式实现，因此内存中的唯一数据是我在任何给定点在应用程序中使用的数据。这使得一些事情变得棘手 - 考虑到许多传统的文件技巧不再可用，但由于实现将基于流，我仍然能够寻找文件的不同点，这些点将被转换为加密流以解密不同的部分。

基本上，它将一次加密文件的块-因此，如果我尝试寻找到某个点，它将解密该块以进行读取。当我读过一个块时，它会解密下一个块并释放前一个块（在加密流中）。

此实现不需要我解密到文件或内存，并且与其他流消费者和提供者 (fstream) 兼容。

这是我的“计划”。我以前没有用 fstream 做过这种类型的工作，一旦我准备好处理这个问题，我很可能会发布一个问题。

感谢所有其他答案 - 它非常有用。

# html - 重写此代码：可点击的 div

> ID：278278
> 
> 赞同：2
> 
> 时间：2008-11-10T16:09:07.597
> 
> 标签：html, css, w3c

我想改变这个：

```
<a href='foo'> 
    <div> Moo </div>
</a> 
```

符合标准（内联元素中不应该有块元素）。将 javascript 连接到 div 仅用于导航似乎是一种 hack，并且会降低可访问性。在这种情况下，我的要求是在我的固定尺寸链接上设置 2 组边框，因此上述不兼容的代码在应用样式后可以完美运行。

另外，“ `a { display:block; }`”是规避验证的合法方式吗？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-11-10T16:12:11.960

为什么不使用**<span>**而不是**<div>**并在两个元素上设置**display:block ？**

另外，回答你的后一个问题：我不相信添加**display:block;** 到您的锚点将使其通过验证。验证器检查您是否遵循 (X)HTML 规则，而不是如何将页面呈现给用户。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-10T17:27:49.420

如果仅用于显示目的，您可能需要考虑将`div`外部放置，除非外部边框可单击很重要。`a`要么：

```
<div class="dbl_border_links"><a href="blah">Blah text</a></div> 
```

或这个：

```
<a class="dbl_border_links" href="blah"><span>Blah text</span></a> 
```

将工作，你可以使用这样的东西：

```
<style>
  .dbl_border_links, .dbl_border_links>* {
    display: block;
    border: 1px solid;
    padding: 1px;
  }
  .dbl_border_links {
    border-color: red;
  }
  .dbl_border_links > * {
    border-color: blue;
  }
</style> 
```

指定样式。就我个人而言，我会选择`div`包含`a`但任何一种方法都有效。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-10T16:16:37.177

我通常认为`<a >`标签是为此目的的特例。你应该能够将它应用到几乎任何东西上——它是在超文本的全部意义之后（`<tr >`想到一个很好的例子）。但是，如果您必须在我理解的某个地方通过验证器。

您可以为 div 使用 javascript`onclick`处理程序，并完全消除锚点吗？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-11T01:44:54.800

首先，给一个锚点 display:block; 肯定没有错。我想说这是人们使用 CSS 做的最常见的事情之一，并且完全符合标准。其次，有很多方法可以在 HTML 元素上实现双边框。一方面，查看“大纲”属性：

[http://webdesign.about.com/od/advancedcss/a/outline_style.htm](http://webdesign.about.com/od/advancedcss/a/outline_style.htm)

诚然，这仅适用于更现代的浏览器，但应该优雅地降级，因为大纲不会占用页面中的任何空间。如果链接的内容是图像，您可以简单地为 <a> 提供一点填充和背景颜色以及正常边框（另一种颜色）以创建双边框的印象。或者给图像一个自己的边框。当然，您也可以按照您最初的想法做一些事情，尽管以相反的方式嵌套您的 HTML，并简单地为每个元素分配不同的边框。或者您可以在链接中使用内联元素（如 <span> 或 <em> 或其他东西），您也可以将其设置为 display:block; （是的，这也是有效的！）。快乐编码！

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-11T02:13:17.380

如果我正确理解您的意图，您应该如前所述将 div 放在锚之外，并且为了获得相同的演示文稿，请制作 anchor `width:100%;height:100%`。跨浏览器里程可能会有所不同。此外，您可以完全转储 div 并提供锚点`display:block;`

你到底想做什么？

# linq-to-sql - 我可以为 Linq-to-sql DataContext 指定一组基本参数吗？

> ID：278281
> 
> 赞同：-1
> 
> 时间：2008-11-10T16:09:58.860
> 
> 标签：linq-to-sql, datacontext

我有一个 LINQ-to-SQL 数据上下文，它表示产品与价格的父子关系。我正在遍历产品列表并检索每个产品的价格。问题是产品和价格后面的表都包含多个环境的产品或价格列表，由 3 字段复合键确定。我只想检索其中一个环境的产品和价格。

为此，我可以在每个 LINQ 查询中指定一个长 where 子句，该子句由产品密钥和复杂环境密钥组成，如下所示：

```
var price = ( from condition in conditiontype where condition.MaterialNumber == material && condition.Client == "400" && condition.SalesOrg == "1000" && condition.DistributionChannel == "10" select condition.ConditionDetails[0].ConditionValue ); 
```

我希望能够为 DataContext 全局指定 Client、SalesOrg 和 DistributionChannel，这样我需要在查询本身中指定的只是产品 ID（MaterialNumber）。这样，当我开始查询我们的生产环境时，对 DataContext 的简单更改将改变我正在查询的环境。

这可能吗？一个简短的代码示例或指向背景理论的指针都会很棒！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-12T00:08:08.193

您可以预先编写`Expression<T>`一个，然后在其中包含这些值：

```
public Expression<Func<int>> GetPrices = p => // do Lambda here 
```

或者，您可以将属性放入您设置的 DataContext 中（请记住，它是一个**部分**类，因此很容易扩展），然后由您的表达式读取。

# asp.net - 无法构建网站，构建时出现 Visual Studio 2008 错误（临时文件）

> ID：278286
> 
> 赞同：0
> 
> 时间：2008-11-10T16:10:54.707
> 
> 标签：asp.net, visual-studio-2008, build-process

~~所有错误都在自动生成的文件上，而不是在我创建的文件中。这里有几个：~~

 ~~```
'Context' is not a member of 'auth_cookies'
'ProcessRequest' cannot be declared 'Overrides' because it does not override a sub in a base class
'Server' is not a member of 'ASP.auth_cookies_aspx'
Class 'auth_cookies_aspx' must implement 'Sub ProcessRequest(context As HttpContext)' for interface 'System.Web.IHttpHandler' 
```~~ 

~~任何帮助，将不胜感激。~~

编辑：发现它正在寻找的文件不存在，修复了该问题并消除了除一个之外的所有错误：

```
 Error-5: There can be only one 'page' directive.
 >> C:\Users\darren\Documents\Visual Studio 2008\WebSites\gs_ontheweb\auth\cookies.aspx 
```

这是**`cookies.aspx`**页面的内容：

```
<%@ Page Language="VB" MasterPageFile="~/theMaster.master" AutoEventWireup="false" CodeFile="cookies.aspx.vb" Inherits="auth_cookies" title="NOM COOKIES" %> 
```

更新：原来一个链接文件有一个链接到另一个 .aspx 页面，导致 2 个页面指令被加载。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-10T16:20:25.797

您是否在母版页中放置了`<%@Page%>`指令？它应该只有一个`<%@Master%>`指令。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-10T16:23:06.027

不，我的 MasterPage 的标题是：

```
<%@ Master Language="VB" CodeFile="theMaster.master.vb" Inherits="theMaster" %> 
```

MasterPage 上没有`<%@Page%>`指令。

# asp.net - 带有 LinqDataSource 和空选项的 DropDownList

> ID：278290
> 
> 赞同：5
> 
> 时间：2008-11-10T16:11:21.837
> 
> 标签：asp.net, linq, drop-down-menu

是否有一些优雅的方法可以向与 LinqDataSource 绑定的 DropDownList 添加一个空选项？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-10T16:19:21.167

以下是在列表顶部添加值的方法。它可以是一个空字符串，也可以是一些文本。

```
<asp:DropDownList ID="categories" runat="server" AppendDataBoundItems="True" AutoPostBack="True" DataSourceID="categoriesDataSource" DataTextField="CategoryName" DataValueField="CategoryID" EnableViewState="False">
    <asp:ListItem Value="-1">
       -- Choose a Category --
    </asp:ListItem>           
</asp:DropDownList> 
```

一定要设置 DropDownList 的 AppendDataBoundItems=True。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-08-13T14:41:20.393

标记：

```
<asp:DropDownList ID="ddlQualQuestion" runat="server" DataSourceID="sdsQualQuestion" DataTextField="ShortQuestionText" DataValueField="QualificationQuestionKey" AutoPostBack="true" OnSelectedIndexChanged="ddlQualQuestion_SelectedIndexChanged" OnDataBound="ddlQualQuestion_DataBound" />; 
```

后面的代码：

```
protected void ddlQualQuestion_DataBound(object sender, EventArgs e)   
{  
  ddlQualQuestion.Items.Insert(0, new ListItem("", "0"));  
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2013-01-22T10:14:11.123

采用 DOK 提供的解决方案：

```
<asp:DropDownList ID="categories" runat="server" AppendDataBoundItems="True" AutoPostBack="True" DataSourceID="categoriesDataSource" DataTextField="CategoryName" DataValueField="CategoryID" EnableViewState="False">
    <asp:ListItem Value="-1">
       -- Choose a Category --
    </asp:ListItem>           
</asp:DropDownList> 
```

另外，如果您不想强制用户进行选择，您可以向 GridView 的 LinqDataSource 添加一个方法：

```
OnSelecting="myGridview_Selecting" 
```

像这样在后面添加代码：

```
protected void myGridview_Selecting(object sender, LinqDataSourceSelectEventArgs e)
{
    if (categories.SelectedValue == "-1")
    {
        e.WhereParameters.Remove("CategoryID");
    }
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-10T16:22:50.160

我会提供一个扩展方法，`IEnumerable<string>`将一个项目附加到列表的开头：

```
 public static IEnumerable<string> Prepend(this IEnumerable<string> data, string item)
    {
        return new string[] { item == null ? string.Empty : item }.Union(data);
    } 
```

它是一种 linq-y，因为它使用了 linq 扩展方法 Union。它比这样做更清洁：

```
var result = new string[]{string.Empty}.Union(from x in data select x.ToString()); 
```

# windows-vista - 用于探索 Windows Vista 音频设备链（树？）的工具

> ID：278294
> 
> 赞同：3
> 
> 时间：2008-11-10T16:12:29.043
> 
> 标签：windows-vista, audio

新的 Vista 音频子系统设置为一个设备链，从输入开始，经过所有各种控制（如混音器和音量控制），然后在各种端点（如扬声器或耳机）结束。

我的问题是：是否有一个工具可以显示系统中的所有端点设备，以及哪些设备链接在一起？理想情况下，它会绘制拓扑图，显示连接到哪些输出的输入，您将能够看到音频系统每个部分的所有属性。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-28T03:58:36.563

您应该查看专为您的问题设计的[IDeviceTopology API。](http://msdn.microsoft.com/en-us/library/dd371376(VS.85).aspx)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-10T19:36:18.600

Larry Osterman（Vista Audio 开发人员之一）有一个很棒的[博客](http://blogs.msdn.com/larryosterman/)，里面有很多关于[Vista Audio](http://blogs.msdn.com/larryosterman/archive/tags/Audio/default.aspx)的帖子。一些可能有用的帖子：

*   [http://blogs.msdn.com/larryosterman/archive/2005/06/13/428724.aspx](http://blogs.msdn.com/larryosterman/archive/2005/06/13/428724.aspx)
*   [http://blogs.msdn.com/larryosterman/archive/2005/06/14/428962.aspx](http://blogs.msdn.com/larryosterman/archive/2005/06/14/428962.aspx)
*   [http://blogs.msdn.com/larryosterman/archive/2005/09/21/472480.aspx](http://blogs.msdn.com/larryosterman/archive/2005/09/21/472480.aspx)
*   [http://blogs.msdn.com/larryosterman/archive/2005/09/23/473351.aspx](http://blogs.msdn.com/larryosterman/archive/2005/09/23/473351.aspx)
*   [http://blogs.msdn.com/larryosterman/archive/2007/03/06/how-do-i-change-the-master-volume-in-windows-vista.aspx](http://blogs.msdn.com/larryosterman/archive/2007/03/06/how-do-i-change-the-master-volume-in-windows-vista.aspx)
*   [http://blogs.msdn.com/larryosterman/archive/2007/10/31/what-happens-when-audio-rendering-fails.aspx](http://blogs.msdn.com/larryosterman/archive/2007/10/31/what-happens-when-audio-rendering-fails.aspx)

还：

*   [枚举音频设备](http://msdn.microsoft.com/en-us/library/ms678716(VS.85).aspx)
*   [Vista 中的音频端点](http://ampalliance.org/files/folders/53/download.aspx)(PPT)

我以为我记得他有一些示例代码可以完全按照您的描述进行操作，但我可能记错了，因为我找不到它。

# windows - 如何通过 Windows CMD 捕获和显示任务的输出

> ID：278296
> 
> 赞同：1
> 
> 时间：2008-11-10T16:15:03.280
> 
> 标签：windows, command-line, scripting, capture

我有一个 PHP 脚本，我正在从执行各种任务的命令行（windows）运行它，它提供的唯一输出是通过直接输出到屏幕的“打印”语句。

我想要做的是将它也捕获到日志文件中。

我知道我可以做到：

```
php-cli script.php > log.txt 
```

但是这种方法的问题是所有输出都写入了日志文件，但我看不到同时事情是如何运行的（所以如果发生任何可疑的事情我可以停止这个过程）。

只是为了抢占其他可能的问题，我无法将所有打印内容更改为日志语句，因为它们太多了，我宁愿不更改代码中的任何内容，以免我因某些事情而受到指责。另外还有时间方面的不足。我还必须在 Windows 机器上运行它。

提前致谢 ：）

编辑：感谢大家的回答，最后我选择了浏览器方法，因为这是最简单、最快捷的设置，尽管我相信在某个地方有这个问题的实际答案。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-10T16:22:51.767

您可以创建一个运行命令的 powershell 脚本，从命令的 STDOUT 读取数据，然后将输出输出到日志文件和终端供您观看。您可以使用命令 Write-Output 和 Write-Host。

微软网站： http: [//www.microsoft.com/technet/scriptcenter/topics/msh/cmdlets/tee-object.mspx](http://www.microsoft.com/technet/scriptcenter/topics/msh/cmdlets/tee-object.mspx)

另一种选择是使用查找 tee 程序来读取输入并将其转移到两个不同的输出。我相信我已经在 windows 上看到了这些，但我认为它们不是标准的。

维基百科：[http://en.wikipedia.org/wiki/Tee_(command)](http://en.wikipedia.org/wiki/Tee_(command))

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-10T16:40:28.143

我总是在我的网络浏览器中打开日志文件。这使我可以轻松地刷新它，并且不会中断 windows 对文件的任何写入。它不是特别优雅，但确实有效！

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-05T05:39:49.023

您需要适用于 Windows 的“tee”命令。见[http://en.wikipedia.org/wiki/Tee_(command)](http://en.wikipedia.org/wiki/Tee_(command))

Powershell 包含一个 tee 命令，并且还有许多适用于 Windows 的 tee 版本，例如：

*   [http://unxutils.sourceforge.net/](http://unxutils.sourceforge.net/)
*   [http://www.chipstips.com/?p=129](http://www.chipstips.com/?p=129)

如果您愿意，也可以[在 VBScript 中实现。](http://www.fpschultze.de/uploads/tee.vbs.txt)

**编辑**：我刚想到我还应该提到tail命令：[http://en.wikipedia.org/wiki/Tail_(Unix)](http://en.wikipedia.org/wiki/Tail_(Unix))。Tail 允许您读取文件的最后*N*行，并且还包括一个“文件监视器”模式，该模式只是不断地实时显示文件的结尾。这非常适合日志文件监控，因为它允许您实时查看日志，而不会干扰写入日志的进程。对于 Windows，tail 有多种实现，包括基于命令行和 GUI 的。Microsoft 的 Services For UNIX 包（或他们现在所称的任何东西）也包括一个版本的 tail。一些例子：

*   [移动尾巴](http://ophilipp.free.fr/op_tail.htm)
*   [Win32的尾巴](http://tailforwin32.sourceforge.net/)
*   [赢尾](http://www.baremetalsoft.com/wintail/)
*   [MakeLogic 尾巴](http://www.makelogic.com/tail/TailHome.htm)

Some of these go far beyond just displaying the file in real-time as it updates and can send email alerts and colorize string matches, monitor multiple files at once, etc.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-10T16:41:12.883

慢的：

```
for /f "delims=" %a in ('php-cli script.php') do @echo %a&echo %a>>log.txt 
```

或在批处理文件中：

```
for /f "delims=" %%a in ('php-cli script.php') do @echo %%a&echo %%a>>log.txt 
```

# sql-server - 如何在 SSRS 中自动化报告交付

> ID：278297
> 
> 赞同：18
> 
> 时间：2008-11-10T16:15:17.133
> 
> 标签：sql-server, reporting-services, reporting

我在 SQL Server Reporting Services (SSRS) 中有一个报告，我想安排它作为电子邮件自动运行。我希望将报告作为 Excel 文件附加。
根据[微软的概述](http://www.microsoft.com/Sqlserver/2005/en/us/reporting-services.aspx)，这应该是可能的。

> **报告交付**。SQL Server Reporting Services 支持按需（拉）和基于事件（推送）的报表交付。用户可以查看基于 Web 格式或电子邮件的报告。

但是，我找不到有关如何实际执行此操作的任何信息。有谁知道应该使用什么工具或哪里有好的教程？

谢谢！

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-11-10T16:18:37.877

当您在报告服务站点中浏览到报告时，您应该会看到订阅选项卡。您可以在此处指定自动投递的收件人和投递方式。

这是描述该过程的[页面。](http://msdn.microsoft.com/en-us/library/ms160334.aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2019-06-04T05:09:09.380

我发现这个主题的这个很好的 youtube 链接对我有帮助：

[https://www.youtube.com/watch?v=sO0Y_IxdE8w](https://www.youtube.com/watch?v=sO0Y_IxdE8w)

基本上步骤（SQL server 2012）是：

让包含报告（或报告链接）的 Web SSRS 文件夹（在 Internet Explorer 浏览器中）显示，将鼠标悬停在报告上，此鼠标悬停操作然后以黄色轮廓边框突出显示报告并在右侧提供下拉菜单，单击向下箭头打开下拉菜单并获取选项列表。一个选项是“管理”，选择此选项。

[![在此处输入图像描述](https://i.stack.imgur.com/TO694.png)](https://i.stack.imgur.com/TO694.png)

屏幕左侧下方提供：

特性

参数

订阅

处理选项

缓存刷新选项

报告历史

安全

在此处选择“订阅”选项。

[![在此处输入图像描述](https://i.stack.imgur.com/GhFNi.png)](https://i.stack.imgur.com/GhFNi.png)

然后，您可以编辑现有订阅.. 或添加新订阅.. 例如按照此屏幕打印

[![在此处输入图像描述](https://i.stack.imgur.com/Hopxh.png)](https://i.stack.imgur.com/Hopxh.png)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2014-03-19T05:02:14.927

您可以将 SQL-RD 应用程序用于动态计划

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2014-12-08T06:29:30.870

首先在报告服务器配置管理器中设置电子邮件，然后从您的 SSRS Web 浏览器单击报告，然后订阅，并提供收件人邮件 ID 和主题名称，然后是邮件消息。选择附件类型的**渲染格式，设置时间和日期，就是这样！**

问候， 普拉蒂克·普拉卡什

# wpf - 阻止用户调整用 WPF 编写的应用程序的顶级窗口大小的最佳方法是什么？

> ID：278304
> 
> 赞同：44
> 
> 时间：2008-11-10T16:16:30.017
> 
> 标签：wpf, resize, size

阻止用户调整用 WPF 编写的应用程序的顶级窗口大小的最佳方法是什么？

* * *

## 回答 #1

> 赞同：91
> 
> 时间：2008-11-10T16:23:58.817

您将要使用[`ResizeMode.NoResize`](http://msdn.microsoft.com/en-us/library/system.windows.resizemode.aspx)窗口上的 。

```
<Window x:Class="WpfApplication5.Window1"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    ResizeMode="NoResize">
</Window> 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-07-17T11:02:30.750

`ResizeMode="NoResize"`需要注意的 WPF 怪癖是，如果您将在 Vista Aero中*完全*`WindowStyle="None"`失去镀铬。

 *# sql-server-2005 - OLE DB 提供程序和 openrecordset

> ID：278306
> 
> 赞同：0
> 
> 时间：2008-11-10T16:16:47.427
> 
> 标签：sql-server-2005

在使用 SSMS 的 SQL Server 2005 中，当我运行它时：

SELECT * FROM OPENROWSET('Microsoft.Jet.OLEDB.4.0','Excel 8.0;Database=C:\TestIDs.xls', 'SELECT * FROM [Sheet1$]')

得到这个：

OLE DB 提供程序“Microsoft.Jet.OLEDB.4.0”尚未注册。

它是指服务器还是我的本地机器？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-10T17:34:45.227

它指的是服务器。

# java - Java小程序/Firefox不兼容问题

> ID：278308
> 
> 赞同：1
> 
> 时间：2008-11-10T16:17:00.373
> 
> 标签：java, firefox, macos, applet, incompatibility

我编写[了一个 Java 小程序](http://www.automatous-monk.com/bluepoles/BluePoles.htm)。一位用户报告说他试图在 OS X 10.5.5 上的 Firefox 3.0.3 中运行它，但没有成功。它希望他下载一个插件，但是当他告诉它安装缺少的插件时，它找不到合适的安装程序...

这里出了什么问题？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-10T16:20:58.947

你必须从 Apple 而不是 Sun 获得 java。这是[下载页面](http://www.apple.com/downloads/macosx/apple/application_updates/javaformacosx105update2.html)上的链接。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-11T01:47:57.820

我不得不更改我的 HTML。我不得不改变：

```
<param name = "type" value = "application/x-java-applet;version=1.6"> 
```

到

```
<param name = "type" value = "application/x-java-applet;version=1.5"> 
```

和

```
type = "application/x-java-applet;version=1.6" \ 
```

到

```
type = "application/x-java-applet;version=1.5" \ 
```

# asp.net - 从哪里获取以及如何安装（或迁移）缺少的 ASP.NET 服务器程序集？

> ID：278312
> 
> 赞同：0
> 
> 时间：2008-11-10T16:18:15.053
> 
> 标签：asp.net, assemblies, server-migration

我正在将 Web 应用程序迁移到新的托管服务器，但是当我尝试访问它们以在新服务器上进行测试时，我得到所有这些未找到的程序集错误，例如：

```
Configuration Error
Description: An error occurred during the processing of a configuration file required to service this request. Please review the specific error details below and modify your configuration file appropriately.

Parser Error Message: Could not load file or assembly 'System.Web.Extensions, Version=1.0.61025.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35' or one of its dependencies. The system cannot find the file specified.

Source Error:

Line 28:        <compilation debug="false">
Line 29:            <assemblies>
Line 30:                <add assembly="System.Web.Extensions, Version=1.0.61025.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35"/>
Line 31:                <add assembly="System.Design, Version=2.0.0.0, Culture=neutral, PublicKeyToken=B03F5F7F11D50A3A"/>
Line 32:                <add assembly="System.Web.Extensions.Design, Version=1.0.61025.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35"/> 
```

有谁知道你在哪里找到这些安装或如何迁移它们？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-10T16:19:42.990

这是 ASP.Net AJAX 工具包的一部分。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-10T16:37:30.037

您必须在服务器上安装 ASP.AJAX 工具包，或者在您的项目中包含这些程序集。[这个问题](https://stackoverflow.com/questions/273418/any-way-to-use-aspnet-ajax-when-my-server-does-not-and-can-not-have-the-aspnet)和[这个问题](https://stackoverflow.com/questions/221761/how-do-i-force-aspnet-ajax-to-use-a-script-from-the-fs-and-not-webresourceaxd-o)告诉你如何将库包含为 DLL 或 JS。

# sql-server - Sql Server CE 3.5 合并复制同步挂起

> ID：278320
> 
> 赞同：1
> 
> 时间：2008-11-10T16:20:42.833
> 
> 标签：sql-server, sql-server-2005, replication, handhelddevice

我正在使用 SQL Server 2005 CE 框架 3.5 并尝试在我的手持设备和我的 SQL Server 之间使用合并复制。当我运行代码进行同步时，它似乎永远存在，当我在代码中放置断点时，它永远不会超过对 S​​ynchronize() 的调用。

如果我查看 sql server 中的复制监视器，它会说订阅不再同步并且不显示任何错误。因此，我假设这意味着同步已完成。

[http://server/virtualdirectory/sqlcesa35.dll?diag](http://server/virtualdirectory/sqlcesa35.dll?diag)没有报告任何问题。

这是我第一次尝试任何手持式开发，所以我可能做了一些愚蠢的事情。但是，SQL Server 似乎报告了成功的同步。

任何帮助将不胜感激，因为我已经为此花费了很多时间！

这是我的代码。

```
const string DatabasePath = @"SD Card\mydb.sdf";
var repl = new SqlCeReplication
               {
                   ConnectionManager = true,
                   InternetUrl = @"http://server/virtualdirectory/sqlcesa35.dll",
                   Publisher = @"servername",
                   PublisherDatabase = @"databasename",
                   PublisherSecurityMode = SecurityType.DBAuthentication,
                   PublisherLogin = @"username",
                   PublisherPassword = @"password",
                   Publication = @"publicationname",
                   Subscriber = @"PPC",
                   SubscriberConnectionString = "Data Source=" + DatabasePath
               };
try
{
    Cursor.Current = Cursors.WaitCursor;
    if (!File.Exists(DatabasePath))
    {
        repl.AddSubscription(AddOption.CreateDatabase);
    }
    repl.Synchronize();
    MessageBox.Show("Successfully synchronised");
}
catch (SqlCeException e)
{
    DisplaySqlCeErrors(e.Errors, e);
}
finally
{
    repl.Dispose();
    Cursor.Current = Cursors.Default;
} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-11T05:28:36.203

Another thing you can do to speed up the Synchronize operation is to specify a db file path that is in your PDA's main program memory (instead of on the SD Card as in your example). You should see a speed improvement of up to 4X (meaning the Sync may take only 25% as long as it's taking now).

If you're running out of main program memory on your PDA, you can use System.IO.File.Move() to move the file to the SD Card after the Synchronize call. This seems a bit strange, I know, but it's much faster to sync to program memory and copy to the SD card then it is to sync directly to the SD card.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-10T17:08:59.770

I have since discovered that it was just taking a long time to copy the data to the physical disk. Although the sql server replication had completed, it was still copying the data to the sd card.

I identified this by reducing the amount of tables I am replicating and I got a more immediate response (well another error but unrelated to this issue).

Thanks anyway :)

# mysql - 在同一台 Windows 服务器上运行 MSSQL 和 MySQL 有哪些技术注意事项？

> ID：278323
> 
> 赞同：0
> 
> 时间：2008-11-10T16:21:41.473
> 
> 标签：mysql, sql-server

我们的应用程序在 MySQL 上运行，但客户端有另一个需要 SQL 的应用程序。我们想在同一个盒子上运行它们。这种配置有哪些技术考虑...这真的只是确保没有端口冲突的问题吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-10T16:30:00.677

他们还将争夺硬盘驱动器、内存和 CPU 使用率。前两个比最后一个多。如果它们都被积极使用，它们都将想要写入/读取磁盘。*如果*它们被大量使用，您可能需要考虑将它们放在自己的驱动器上。

测试一下，看看性能如何。有关更多详细信息，请打开性能监视器并查看磁盘和内存统计信息。

# ruby - 为 iPhone 控制器使用 RSpec

> ID：278331
> 
> 赞同：3
> 
> 时间：2008-11-10T16:23:29.083
> 
> 标签：ruby, iphone, rspec, ruby-cocoa

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-11T02:10:38.803

iPhone 根本不支持 RubyCocoa。没有桥接支持库，我不相信电话上有任何 ruby​​ 解释器。

你也许可以让它在模拟器中工作，如果你真的尝试，它不会阻止你使用仅 OS X 的库，但这仍然不会让它在 iPhone 上工作。

如果您真的想在 iPhone 上使用 RubyCocoa，您需要将 ruby​​ 构建为静态库并将桥接器移植到手机，这是可行的，但可能非常困难。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-12T05:54:52.547

你好！尽管我不熟悉 Ruby/Cocoa 如何包装外部方法调用（或与 Objective C 相关），但在测试中似乎可能断开连接的第一个地方是将 Ruby 模拟传递给本机实现的控制器。在保龄球教程中，ruby 控制器代理将其接口暴露给 Cocoa 桥，而在此实现中，代理包装了一个暴露的 Cocoa 接口。那么，当用 ruby​​ 模拟代替原生字段与用 ruby​​ 模拟代替 ruby​​ 字段时，可能会出现问题。

但是，引脚的 roll() 测试成功了，因此消息可能被正确传递，但参数被破坏或丢弃。

这可能没有多大帮助，但这是一个有趣的问题。祝项目顺利！

# vsto - Visual Studio Tools for Office (VSTO 2005) 新手部署问题

> ID：278335
> 
> 赞同：0
> 
> 时间：2008-11-10T16:25:36.440
> 
> 标签：vsto, officedev

我有一个带有 VSTO 字项目的 Visual Studio 设置，当我点击运行时它运行良好。

但是，如何在不运行 Visual Studio 的情况下设置 Word 文档以使用我的代码？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-10T16:37:34.357

您可以使用 Windows Installer 项目来执行此操作；起点[在这里](http://msdn.microsoft.com/en-us/library/bb332051.aspx)。您也可以使用发布向导。

可以在 MSDN [here](http://msdn.microsoft.com/en-us/library/hesc2788.aspx)中找到更通用的起点。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-07T01:12:48.853

您必须手动或使用安装程序部署[VSTO运行时。](http://www.microsoft.com/downloads/details.aspx?FamilyID=F5539A90-DC41-4792-8EF8-F4DE62FF1E81&displaylang=en)查看此[博客文章](http://blogs.msdn.com/johnrdurant/archive/2006/01/04/windows-installer.aspx)以获取详细说明。

# winforms - WinForms .NET 2.0+ 的标签云控件

> ID：278342
> 
> 赞同：2
> 
> 时间：2008-11-10T16:27:04.003
> 
> 标签：winforms, controls, tag-cloud

您将如何在 .NET 2.0+ WinForm 应用程序中呈现标签云？

我正在考虑的一种解决方案是使用 WebBrowser 控件并生成一些临时 HTML，但这似乎是一个非常繁重的解决方案。

我错过了更简单的东西吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-17T17:54:00.153

如何创建一个实现 Flow 布局控件的用户控件？您可以为“Add(string tagName)”创建一个动态链接标签并将其添加到 Flow Layout 控件的方法。Flow Layout 就像 web 一样工作，添加到它的控件按创建顺序放置。

然后，您只需添加一些逻辑即可根据该标签的命中数调整链接标签的大小。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-10T17:44:10.387

那么，您将需要具有以下主要功能的控件：

*   可变大小字符串片段的自动布局
*   自动鼠标命中测试

这些在WF控件中有点难以获得。带有 ReadOnly = true 的 RichTextBox 为您提供自动布局，但不提供命中测试。带有 DrawItem 的 ListBox 可以为您提供可变大小的字符串和命中测试，但不是自然布局。

我想我会使用 RTB 并使用 MouseDown 事件和 GetCharIndexFromPosition() 进行命中测试，在点击的位置读回标签。您需要一些逻辑来找到单词周围的开始和结束空白。

# visual-studio - “源文件中存在类 xx 的重复插入块”

> ID：278348
> 
> 赞同：1
> 
> 时间：2008-11-10T16:29:05.123
> 
> 标签：visual-studio, evc4

在`Embedded Visual Studio 4`中，我试图添加一个`class`虽然`class wizard.` ，文件已经存在，但第一次尝试失败。所以我删除了该文件并尝试再次添加该类。

现在我收到错误消息

```
“源文件中存在类 xx 的重复插入块”

```

除了回滚我的代码之外，我不知道该怎么做。

有没有人看到这个，如果有，你知道如何解决它吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2014-08-21T12:28:25.980

这是说你有重复的块，而不是重复的条目。也许您错误地重命名了一个块。

例如在 AFX 块中说，

检查您在 MyClass.h 中是否只有一个：

```
//{{AFX_DATA(CMyClass)
//{{AFX_VIRTUAL(CMyClass)
//{{AFX_MSG(CMyClass) 
```

...并且您在 MyClass.cpp 中只有一个：

```
//{{AFX_DATA_INIT(CMyClass)
//{{AFX_DATA_MAP(CMyClass)
//{{AFX_MSG_MAP(CMyClass) 
```

# php - PHP5：调用外部函数，并记录错误

> ID：278351
> 
> 赞同：2
> 
> 时间：2008-11-10T16:29:48.337
> 
> 标签：php, mysql, pear

我对 PHP 很陌生，并试图在我的本地站点上设置 phpBB。我有 apache2 和 php5 的股票 debian 安装。phpBB 安装程序运行良好，连接到数据库并毫无问题地创建了所有表。但是当我试图打开登录页面时，我得到了一个 0 字节的响应。

一点点挖掘表明它从来没有通过对 mysql_pconnect() 的调用。php 二进制文件只是退出而没有错误或消息。什么都没有。我尝试运行以下代码：

```
<?php
$id = @mysql_pconnect('localhost','myusername', 'mypassword', true);
print "id=".$id."\n";
?> 
```

并且 "id=" 字符串从不打印。它什么也不做。我不知道去哪里查看发生了什么错误，或者根本不知道发生了什么。我安装的只是使用梨的“mysql”......也许我还缺少其他东西？

这一定是某个地方的路径问题。mysql 扩展很好地构建在

```
/usr/lib/php5/20060613+lfs/mysql.so 
```

**回答：**

jishi：通知我“@”运算符禁止输出，包括错误消息（@echo off，有人吗？）

tomhaigh：扩展必须在 php.ini 文件中显式启用。将“extension=mysql.so”行添加到 php.ini 后，以下代码运行良好：

```
% cat d.php 
<?php
ini_set('display_errors', true);
error_reporting(E_ALL | E_NOTICE);
$id = mysql_pconnect('localhost','myusername', 'mypassword', true);
print "id=".$id."\n";
?>
% php -c /etc/php5/apache2/php.ini  d.php
id=Resource id #4 
```

喜悦！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-10T16:48:24.710

刚刚注意到您在 mysql_pconnect() 前面使用了一个 @。这会抑制所有错误，在这种情况下这是一个非常糟糕的主意。删除它，您可能会看到输出。

除此以外：

检查你的 php.ini，对于 debian，应该在 /etc/php5/apache2/php.ini 中。

检查名为 display_errors 的行，如果您想在浏览器中输出错误，请将其设置为 true（不推荐用于生产系统，但在调试和开发期间很有用）。

为 apache 指定 log_errors 以将您的错误记录到 apache 的错误日志文件中，在 debian 中默认为（除非为 phpBB 站点指定了其他错误文件）：

/var/log/apache2/error.log

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-10T16:50:15.113

删除“@”，即静音 mysql_pconnect 抛出的错误消息。

[文档](http://us.php.net/@)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-10T17:27:25.083

尝试这样做：

```
<?php
ini_set('display_errors', true);
error_reporting(E_ALL | E_NOTICE);
$id = mysql_pconnect('localhost','myusername', 'mypassword', true);
print "id=".$id."\n";
?> 
```

看看反应是什么

**编辑**

从您的评论看来，mysql 模块没有安装或启用。你可以看看你的 php.ini 文件，看看是否有类似的行

```
extension=mysql.so 
```

如果用分号注释，请尝试将其删除并重新启动 apache

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-10T16:38:47.507

当 PHP 找到一个它找不到的函数时，我有时会让它陷入“黑洞”。

你能验证mysql扩展是否安装正确吗？

您可以通过创建这样的 php 页面来做到这一点：

```
<?php
phpinfo();
?> 
```

将其保存在您的 webroot 中，然后访问它。它应该包含有关您的服务器当前运行的 PHP 模块的所有信息。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-10T16:57:50.760

我认为你没有为你的 PHP 安装 mysql 扩展。自 PHP5 以来，我认为它是一个 PECL 扩展。如果你在 Windows 上工作，你的 php 目录中应该有一个 pecl.bat 或类似的东西。只需通过控制台去那里并输入

```
pecl download mysql 
```

然后一切都应该按预期工作。

# visual-studio-2005 - Visual Studio 2005：文件->新建->项目与文件->新建->网站？

> ID：278355
> 
> 赞同：0
> 
> 时间：2008-11-10T16:30:52.513
> 
> 标签：visual-studio-2005

*假设我想在 Visual Studio 2005 中创建 vb.net 应用程序。 File->New->Project*与*File->New->Web Site*有什么区别？

**编辑**

我知道，当使用 New->Project 时，还有更多可用选项，但如果只想创建 .net Web 应用程序，那么选择什么选项会有所不同吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-10T16:41:45.847

[这是关于 WAP](http://msdn.microsoft.com/en-us/library/aa730880(VS.80).aspx)（Web 应用程序项目）以及 WAP 和网站项目之间差异的一个很好的链接。

在 2003 年，您唯一的选择（如果我没记错的话）是 WAP。2005 年引入了网站项目的概念，您的所有代码都上传到服务器并在首次访问时编译成 DLL。这使您可以轻松更改代码，而无需编译和发布 dll。

没有多少人喜欢这种新的做法，所以 MS 在 2005 年创建了一个更新以允许 2003 年风格的 WAP。2008 年保留了这两个选项。

File->New->Web site 选项是创建网站应用程序的唯一方法（或者，至少在 2k8 中）。创建 WAP 的唯一方法是执行 File->New Project->Web->...

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-10T16:34:56.657

如果你创建一个项目，你项目中的所有cs文件都会被编译成一个DLL。相反，如果您选择创建一个网站，您的所有 app_code 都将被即时编译和缓存。

# sql-server - 通过 ODBC 的 SQL Server 备份数据库

> ID：278359
> 
> 赞同：1
> 
> 时间：2008-11-10T16:31:10.940
> 
> 标签：sql-server, odbc

我正在尝试编写一个能够从 Microsoft SQL Server 数据库导入和导出特定数据库以及用户和登录名的程序。我的代码和 ODBC 之间有一个抽象层，我们的许多其他软件都使用该抽象层。抽象层通常在关闭自动提交的情况下运行并自行处理事务，但由于 BACKUP 命令不喜欢在任何事务中运行，我正在使用该层的另一种方法，称为 executeDirect，它在自动提交的情况下运行它。

该方法使用 SQLExecDirect 函数来运行 BACKUP 命令。完成后，函数返回 SUCCESS_WITH_INFO，因为 BACKUP 命令喜欢提供三行输出。然后代码尝试使用 SQLGetDiagField 获取输出，并能够从记录 #1 中收集第一行，但没有记录 #2。

该方法要做的最后一件事是将连接重置为自动提交关闭，但是当它尝试这样做时，会发生错误，说“连接正忙于另一个命令的结果”，SQL 状态为“HY000”。所以，显然，连接想要汇出另外两行输出，但我不知道如何让它这样做。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-12T15:31:47.640

BACKUP DATABASE 命令作为批处理运行，需要调用 SQLMoreResults 才能继续备份。

# sql-server - 存储过程错误附近的语法不正确

> ID：278361
> 
> 赞同：5
> 
> 时间：2008-11-10T16:31:24.790
> 
> 标签：sql-server, stored-procedures, ado.net, .net-3.5

我正在更新一长串记录。在我的代码中，一切都按预期运行，直到它执行查询。我得到一个

> “TempUpdatePhysicalCityStateZip”附近的语法不正确

（我的存储过程名称）。我已经使用 SQL Server Management Studio 对其进行了测试，并且运行良好。所以，我不太确定我哪里弄错了。下面是我的存储过程和代码：

```
ALTER PROCEDURE [dbo].[TempUpdateCityStateZip] 
    @StoreNo nvarchar (11),
    @City nvarchar(50),
    @State nvarchar(2),
    @Zip nvarchar(5)    
AS
BEGIN
    SET NOCOUNT ON;

    UPDATE StoreContact
    SET City = @City, State = @State, Zip = @Zip
    WHERE StoreNo = @StoreNo
END 
```

这是我的代码：

```
Dictionary<string, string> CityStateZipList = getCityStateZipList(dbPath);

using (SqlConnection conn = new SqlConnection(dbPath))
{
    conn.Open();

    SqlCommand cmdUpdate = new SqlCommand("TempUpdateCityStateZip", conn);

    foreach (KeyValuePair<string, string> frKeyValue in CityStateZipList)
    {
        cmdUpdate.Parameters.Clear();

        string[] strCityStateZip = frKeyValue.Value.Split(' ');
        cmdUpdate.Parameters.AddWithValue("StoreNo", frKeyValue.Key.ToString());

        foreach (String i in strCityStateZip)
        {
            double zipCode;

            if (i.Length == 2)
            {
                cmdUpdate.Parameters.AddWithValue("State", i);
            }
            else if (i.Length == 5 && double.TryParse(i, out zipCode))
            {
                cmdUpdate.Parameters.AddWithValue("Zip", i);
            }
            else
            {
                cmdUpdate.Parameters.AddWithValue("City", i);
            }
        }

        cmdUpdate.ExecuteNonQuery();
    }
} 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-10T16:35:35.907

如果您不指定命令类型，我相信您会收到令人费解的错误消息：

```
cmdUpdate.CommandType = CommandType.StoredProcedure; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-10T16:41:18.517

参数前不需要@符号吗？

```
 cmdUpdate.Parameters.AddWithValue("@State", i); 
```

FWIW，那是一段肮脏的代码，你可能会在试图维护它时遇到很多问题。出于性能原因，您可能希望在打开连接之前解析出 CityStateZipList，这样您就不会将其保持打开的时间超过您的需要。

# c# - C# 10 秒后禁用控件的最简单方法是什么？计时器还是秒表？

> ID：278362
> 
> 赞同：2
> 
> 时间：2008-11-10T16:31:40.097
> 
> 标签：c#, timer

C# 10 秒后禁用控件的最简单方法是什么？使用计时器或秒表？我都是新手，所以感谢您的帮助。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-10T16:34:23.537

我不确定您希望秒表如何提供帮助。计时器对我来说当然是正确的答案。您应该知道有[几个不同的计时器可用](http://pobox.com/~skeet/csharp/threads/timers.shtml)- 在这种情况下[`System.Windows.Forms.Timer`](http://msdn.microsoft.com/en-us/library/system.windows.forms.timer.aspx)，可能是您想要用于 WinForms 应用程序或[`System.Windows.Threading.DispatcherTimer`](http://msdn.microsoft.com/en-us/library/system.windows.threading.dispatchertimer.aspx)WPF 的计时器。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-10T16:34:39.620

Windows 窗体有一个[Timer](http://msdn.microsoft.com/en-us/library/system.windows.forms.timer.aspx)控件（这里是[WPF 的版本](http://msdn.microsoft.com/en-us/library/system.windows.threading.dispatchertimer.aspx)）。

您使用这些的原因是因为这些计时器在 UI 线程上触发，因此您不必执行通常的多线程[if-InvokeRequried-Invoke](http://msdn.microsoft.com/en-us/library/ms171728(VS.80).aspx)舞蹈，如果您使用[System.Threading.Timer](http://msdn.microsoft.com/en-us/library/system.threading.timer.aspx)或其他一些您必须这样做在不同线程上运行的方法。

（从 Jon 那里偷走了 WPF 链接）

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-10T16:38:27.837

与@Jon Skeet 的回答相关，您需要 System.Windows.Forms.Timer 计时器（在框架中的 3 个之外）的原因是它会为您在 UI 线程上执行计时器代码。其他计时器不会为您执行此操作，因此您只能调用 .CanInvoke 和 Invoke() （或使用更简单但仍然很麻烦的 SynchronizationContext）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-10T16:34:05.817

使用计时器。它更适合您的需求。

编辑：正如其他人所说，与`System.Windows.Forms.Timer`

# c++ - C++ 字符串操作

> ID：278363
> 
> 赞同：6
> 
> 时间：2008-11-10T16:31:44.480
> 
> 标签：c++, c, string, character

我缺乏 C++ 经验，或者更确切地说，我在垃圾收集语言方面的早期学习现在真的让我很痛苦，我在使用 C++ 中的字符串时遇到了问题。

说得很清楚，使用 std::string 或 equlivents 不是一种选择——这一直是 char* 。

所以：我需要做的非常简单，基本上可以归结为连接字符串。在运行时，我有 2 个类。

一个类包含基本文件名形式的“类型”信息。

在标题中：

```
char* mBaseName; 
```

后来，在 .cpp 中，它加载了从其他地方传入的信息。

```
mBaseName = attributes->BaseName; 
```

第二个类以基本文件名后缀的形式提供版本信息，它是一个静态类，目前实现如下：

```
static const char* const suffixes[] = {"Version1", "Version", "Version3"}; //etc.

static char* GetSuffix()
{
    int i = 0;
    //perform checks on some data structures
    i = somevalue;
   return suffixes[i];
} 
```

然后，在运行时基类创建它需要的文件名：

```
void LoadStuff()
{
    char* suffix = GetSuffix();
    char* nameToUse = new char[50];
    sprintf(nameToUse, "%s%s",mBaseName,suffix);

    LoadAndSetupData(nameToUse);
} 
```

您可以立即看到问题。nameToUse 永远不会被删除，内存泄漏。

后缀是一个固定列表，但基本文件名是任意的。创建的名称需要在“LoadStuff()”的末尾持续存在，因为不清楚随后何时以及如何使用它。

我可能担心太多，或者很愚蠢，但是类似于 LoadStuff() 的代码也发生在其他地方，所以需要解决。这很令人沮丧，因为我对事物的工作方式知之甚少，无法看到一个安全且“非黑客”的解决方案。在 C# 中，我只想写：

```
LoadAndSetupData(mBaseName + GetSuffix()); 
```

并且不需要担心。

非常感谢任何意见、建议或建议。

## 更新

我调用 LoadAndSetupData() 的代码的问题在于，在某些时候它可能会复制文件名并将其保存在本地，但实际的实例化是异步的，LoadAndSetupData 实际上将事物放入队列中，至少在那时，它期望传入的字符串仍然存在。

我不控制此代码，因此无法更新它的功能。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-10T16:56:44.570

Seeing now that the issue is how to clean up the string that you created and passed to LoadAndSetUpData()

I am assuming that:

1.  LoadAndSetUpData() does not make its own copy
2.  You can't change LoadAndSetUpData() to do that
3.  You need the string to still exist for some time after LoadAndSetupData() returns

Here are suggestions:

1.  Can you make your own queue objects to be called? Are they guaranteed to be called after the ones that use your string. If so, create cleanup queue events with the same string that call delete[] on them

2.  Is there a maximum number you can count on. If you created a large array of strings, could you use them in a cycle and be assured that when you got back to the beginning, it would be ok to reuse that string

3.  Is there an amount of time you can count on? If so, register them for deletion somewhere and check that after some time.

The best thing would be for functions that take char* to take ownership or copy. Shared ownership is the hardest thing to do without reference counting or garbage collection.

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-10T16:57:27.297

The thing to remember with C++ memory management is ownership. If the LoadAndSetupData data is not going to take ownership of the string, then it's still your responsibility. Since you can't delete it immediately (because of the asynchronicity issue), you're going to have to hold on to those pointers until such time as you know you can delete them.

Maintain a pool of strings that you have created:

*   If you have some point in time where you know that the queue has been completely dealt with, you can simply delete all the strings in the pool.
*   If you know that all strings created after a certain point in time have been dealt with, then keep track of when the strings were created, and you can delete that subset. - If you can somehow find out when an individual string has been dealt with, then just delete that string.

* * *

```
class StringPool
{
    struct StringReference {
        char *buffer;
        time_t created;
    } *Pool;

    size_t PoolSize;
    size_t Allocated;

    static const size_t INITIAL_SIZE = 100;

    void GrowBuffer()
    {
        StringReference *newPool = new StringReference[PoolSize * 2];
        for (size_t i = 0; i < Allocated; ++i)
            newPool[i] = Pool[i];
        StringReference *oldPool = Pool;
        Pool = newPool;
        delete[] oldPool;
    }

public:

    StringPool() : Pool(new StringReference[INITIAL_SIZE]), PoolSize(INITIAL_SIZE)
    {
    }

    ~StringPool()
    {
        ClearPool();
        delete[] Pool;
    }

    char *GetBuffer(size_t size)
    {
        if (Allocated == PoolSize)
            GrowBuffer();
        Pool[Allocated].buffer = new char[size];
        Pool[Allocated].buffer = time(NULL);
        ++Allocated;
    }

    void ClearPool()
    {
        for (size_t i = 0; i < Allocated; ++i)
            delete[] Pool[i].buffer;
        Allocated = 0;
    }

    void ClearBefore(time_t knownCleared)
    {
        size_t newAllocated = 0;
        for (size_t i = 0; i < Allocated; ++i)
        {
            if (Pool[i].created < knownCleared)
            {
                delete[] Pool[i].buffer;
            }
            else
            {
                Pool[newAllocated] = Pool[i];
                ++newAllocated;
            }
        }
        Allocated = newAllocated;
    }

    // This compares pointers, not strings!
    void ReleaseBuffer(char *knownCleared)
    {
        size_t newAllocated = 0;
        for (size_t i = 0; i < Allocated; ++i)
        {
            if (Pool[i].buffer == knownCleared)
            {
                delete[] Pool[i].buffer;
            }
            else
            {
                Pool[newAllocated] = Pool[i];
                ++newAllocated;
            }
        }
        Allocated = newAllocated;
    }

}; 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-10T16:44:14.237

编辑：这个答案并没有完全解决他的问题——我在这里提出了其他建议： [C++ 字符串操作](https://stackoverflow.com/questions/278363/c-string-manipulation#278460)

他的问题是他需要将他创建的 char* 的范围扩展到函数之外，直到异步作业完成。

原答案：

在 C++ 中，如果我不能使用标准库或 Boost，我仍然有一个这样的类：

```
template<class T>
class ArrayGuard {
  public:
    ArrayGuard(T* ptr) { _ptr = ptr; }
    ~ArrayGuard() { delete[] _ptr; }
  private:
    T* _ptr;
    ArrayGuard(const ArrayGuard&);
    ArrayGuard& operator=(const ArrayGuard&);
} 
```

你像这样使用它：

```
char* buffer = new char[50];
ArrayGuard<char *> bufferGuard(buffer); 
```

缓冲区将在作用域结束时被删除（返回或抛出）。

对于动态大小的数组的简单数组删除，我希望将其视为在作用域结束时释放的静态大小的数组。

保持简单——如果您需要更高级的智能指针，请使用 Boost。

如果您的示例中的 50 是可变的，这将很有用。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-10T16:52:14.780

If you must use char*'s, then LoadAndSetupData() should explicitly document who owns the memory for the char* after the call. You can do one of two things:

1.  **Copy the string.** This is probably the simplest thing. LoadAndSetupData copies the string into some internal buffer, and the caller is always responsible for the memory.

2.  **Transfer ownership.** LoadAndSetupData() documents that it will be responsible for eventually freeing the memory for the char*. The caller doesn't need to worry about freeing the memory.

I generally prefer safe copying as in #1, because the allocator of the string is also responsible for freeing it. If you go with #2, the allocator has to remember NOT to free things, and memory management happens in two places, which I find harder to maintain. In either case, it's a matter of **explicitly documenting** the policy so that the caller knows what to expect.

If you go with #1, take a look at Lou Franco's answer to see how you might allocate a char[] in an exception-safe, sure to be freed way using a guard class. Note that you can't (safely) use std::auto_ptr for arrays.

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-10T16:41:20.013

由于 std::string 不是一个选项，无论出于何种原因，您是否研究过智能指针？见[提升](http://www.boost.org/doc/libs/1_37_0/libs/smart_ptr/smart_ptr.htm)

但我只能鼓励你使用 std::string。

基督教

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-11-10T16:41:53.663

由于您需要 nameToUse 在函数之后仍然存在，因此您无法使用 new，我要做的是返回一个指向它的指针，因此调用者可以在以后不再需要它时“删除”它。

```
char * LoadStuff()
{
    char* suffix = GetSuffix();
    char* nameToUse = new char[50];
    sprintf("%s%s",mBaseName,suffix);

    LoadAndSetupData(nameToUse);
    return nameToUse;
} 
```

然后：

```
char *name = LoadStuff();
// do whatever you need to do:
delete [] name; 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-10T16:58:42.397

There is no need to allocate on heap in this case. And always use snprintf:

```
char nameToUse[50];
snprintf(nameToUse, sizeof(nameToUse), "%s%s",mBaseName,suffix); 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-10T16:49:36.503

First: Why do you need for the allocated string to persist beyond the end of LoadStuff()? Is there a way you can refactor to remove that requirement.

Since C++ doesn't provide a straightforward way to do this kind of stuff, most programming environments use a set of guidelines about pointers to prevent delete/free problems. Since things can only be allocated/freed once, it needs to be very clear who "owns" the pointer. Some sample guidelines:

1) Usually the person that allocates the string is the owner, and is also responsible for freeing the string.

2) If you need to free in a different function/class than you allocated in, there must be an explicit hand-off of ownership to another class/function.

3) Unless explicitly stated otherwise, pointers (including strings) belong to the caller. A function, constructor, etc. cannot assume that the string pointer it gets will persist beyond the end of the function call. If they need a persistent copy of the pointer, they should make a local copy with strdup().

What this boils down to in your specific case is that LoadStuff() should delete[] nameToUse, and the function that it calls should make a local copy.

One alternate solution: if nameToUse is going to be passed lots of places and needs to persist for the lifetime of the program, you could make it a global variable. (This saves the trouble of making lots of copies of it.) If you don't want to pollute your global namespace, you could just declare it static local to the function:

```
static char *nameToUse = new char[50]; 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-10T19:09:41.837

你可以在这里结合一些想法。

根据您模块化应用程序的方式，可能有一个方法（main？），其执行决定了 nameToUse 可定义为固定大小局部变量的范围。您可以将指针（&nameToUse[0] 或简单地 nameToUse）传递给需要填充它的其他方法（因此也传递大小）或使用它，知道当具有局部变量的函数退出或您的程序以任何其他方式终止。

这与使用动态分配和删除几乎没有区别（因为保存该位置的指针必须或多或少以相同的方式进行管理）。在许多情况下，本地分配更直接，并且在将最大所需生存期与特定函数执行的持续时间相关联没有问题时非常便宜。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-11-10T16:42:27.360

在 LoadStuff 的范围之外，究竟在哪里使用了 nameToUse？如果有人在 LoadStuff 之后需要它，它需要传递它，以及内存释放的责任

如果你会按照你的建议在 c# 中完成它

```
LoadAndSetupData(mBaseName + GetSuffix()); 
```

那么什么都不会引用 LoadAndSetupData 的参数，因此您可以安全地将其更改为

```
char nameToUse[50]; 
```

正如马丁建议的那样。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-11-10T16:46:56.197

您将不得不管理为 nameToUse 分配的内存的生命周期。将它包装在诸如 std::string 之类的类中会使您的生活更简单一些。

我想这是一个小小的愤怒，但由于我想不出任何更好的解决方案来解决您的问题，我会指出另一个潜在的问题。在复制或连接字符串时，您需要非常小心地检查正在写入的缓冲区的大小。strcat、strcpy 和 sprintf 等函数很容易覆盖其目标缓冲区的末尾，从而导致虚假的运行时错误和安全漏洞。

抱歉，我自己的经验主要是在 Windows 平台上，他们引入了这些函数的“安全”版本，称为 strcat_s、strcpy_s 和 sprintf_s。它们的许多相关功能也是如此。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-11-10T17:35:26.287

谢谢大家的回答。我没有选择一个作为“答案”，因为这个问题没有具体的解决方案，而且无论如何最好的讨论都是我和其他人。

您的建议都很好，您对我的问题的笨拙非常耐心。我相信你可以看到，这是一个更复杂问题的简化，还有更多与我给出的示例有关的事情，因此它的一些部分可能并不完全有意义。

为了您的利益，我决定暂时“作弊”以摆脱困境。我说基本名称是任意的，但这并不完全正确。事实上，它们也是一组有限的名称，只是一组可能会在某些时候改变的有限名称，所以我试图解决一个更普遍的问题。

现在我将把“静态”解决方案扩展到后缀并建立一个可能的名称表。这非常“hacky”，但会起作用，而且可以避免重构大量我无法做到的复杂代码。

反馈非常好，非常感谢。

* * *

## 回答 #13

> 赞同：-1
> 
> 时间：2008-11-10T16:41:35.270

我并不完全清楚 LoadAndSetupData 的定义位置，但看起来它保留了自己的字符串副本。因此，您应该在调用 LoadAndSetupData 后删除本地分配的副本，并让它管理自己的副本。

或者，确保 LoadAndSetupData 清理你给它分配的 char[]。

我的偏好是让另一个函数保留自己的副本并管理它，这样您就不会为另一个类分配对象。

编辑：由于您使用具有固定大小 [50] 的 new，因此您不妨按照建议将其设为本地，并让 LoadAndSetupData 制作自己的副本。

# java - 将图像从 C 程序移动到 Java 并显示在屏幕上的最有效方法是什么？

> ID：278381
> 
> 赞同：1
> 
> 时间：2008-11-10T16:35:44.830
> 
> 标签：java, c, ipc, video-capture, image-capture

**背景**

我正在使用 video4linux 2 规范捕获视频。它是使用 C 程序实时捕获的。我还有一个可以在本地和远程运行的 Java 前端。远程端很简单，我只需将图像压缩为 JPEG，然后通过 mini-http 服务器将它们发送到客户端，客户端将它们解压缩并显示在屏幕上。

当我们在本地运行时，我希望通过某种方式 IPC 直接连接到该内存并从 Java 访问图像。然后，使用尽可能少的 CPU 资源将它们粘贴到屏幕上。这是一个“监视”类型的系统，所以我可以同时运行 8-16 个摄像机源。

**问题**

将图像数据（YUV420P）从 v4l2 mmap 缓冲区移动到我的 Java 应用程序以在屏幕上显示的最有效方法是什么？如果有可用的，请显示代码或指向一些 api/specs。

**回答**

考虑到时间，我决定只使用普通的套接字并以 RGB 格式发送数据。当 Java 客户端在同一台机器上运行时，我能够显着提高性能。如果客户端远程运行，我仍然会通过网络发送 JPEG。接下来，我需要找到一个优化的 JPEG 解码器。

顺便说一句，这不是 2 个客户端，只是我的 CameraStream 小部件读取并解析这两种类型。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-10T16:54:05.213

Unless you use a `Socket`, you're going to have to use JNI to hook into a more primitive IPC mechanism.

Given that you've got a memory buffer containing the video data, you may be able to use the "shared memory" APIs to get access to that memory from within your JVM. Have a look at the man page for `shmat`.

You'll also need some sort of signal to tell the Java client that new video data is available.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-10T18:34:38.943

您可能想考虑让“远程”界面在这两种情况下都可以接受。

维护双前端（在这种情况下，还有一些后端）只会意味着两倍的维护和两倍的（潜在）错误。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-12-05T00:48:32.087

[您可以尝试JNA](https://github.com/twall/jna)（Java Native Access），而不是使用 JNI 。通过使用它，您可以直接从 Java 调用 C API，而无需编写 JNI 代码。请考虑准备小 DLL，它定义了所有必需的方法，例如打开、关闭网络摄像头设备并将图像获取为字节数组。然后使用[JNAreator](http://code.google.com/p/jnaerator/)从这个 DLL 中准备 Java 类。它工作得很好。几年后，当我发现这个项目时，我再次开始使用本机代码。

您还可以考虑使用[BridJ](http://code.google.com/p/bridj/)，它是本机代码的其他 Java API。它也和 JNA 一样透明，但速度更快，而且您也不需要使用 JNI。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-12-11T23:10:33.343

您可以考虑使用 JNI 来公开本机内存。请参阅有关直接字节缓冲区的 JNI API。

一旦您在 Java 中像这样公开您的本机内存，将字节从 DirectByteBuffer 复制到 Java byte[] 数组中，它应该比您的套接字方法快得多。

# c# - 是否可能有同一个组件的两个 COM STA 实例？

> ID：278389
> 
> 赞同：1
> 
> 时间：2008-11-10T16:38:09.210
> 
> 标签：c#, multithreading, com, sta, mta

我在[这里的另一个线程上发现](https://stackoverflow.com/questions/265919/why-doesnt-multithreading-in-c-reach-100-cpu)了一个问题，我需要访问一个 STA 的 COM 组件。我将在双核计算机上运行它，使用该组件的进程仅达到50％的CPU。可惜车主说不能把组件改成MTA，因为组件是Matlab编译的混合系统，核心是C。

所以我试图在同一个进程上加载 COM 类的两个实例，不同的线程访问它，但我做不到，只有最后一个 COM 实例可用。你知道什么可以解决这个问题吗？

我正在考虑在同一台计算机上运行我的服务的两个进程，以实现 100% cpu。这不是一个好的解决方案，主要是因为这些服务器将安装在我们的基础设施之外。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-10T17:00:57.447

**On the topic of multiple STA components**

It is possible to have two instances of the same STA COM component and access them from C#. The only thing that could prevent you from such scenario is the object itself if implemented as a singleton object.

However, if both instances are on the same STA thread, an active call in one of the instances will block any other calls into that thread. Thus, if you want those two instances to work in parallel, you need to have them be on separate STA threads. Just to be on the safe side, I'd create both instances on background threads. That should prevent your UI from locking.

**On the topic of STA vs. MTA for the external component**

I am not sure why the component being in C would prevent it from being an MTA object. Being MTA just means the object needs to internally synchronize it's state access and management code between multiple threads.

**WARNING: Ugly hack!** :-) If you want to experiment a bit, you could go to the registry and change the external component threading model from Apartment to Free, just to verify that your code would work properly with an MTA. Their component will probably break, though, as they probably did not write thread-safe code, relying on COM to guard them.

Make a note on a prominent place to revert that change later, so that you don't end up with a system where their code doesn't work and spent countless hours chasing ghosts. :-)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-11T11:16:58.903

弗朗西·佩尔诺夫，

我尝试使用两个线程，并在每个线程的上下文中初始化 com 实例，但错误是相同的：（来自 HRESULT 的异常：0x80004005 (E_FAIL)）

我正在通过 CallContext GetData 和 SetData 存储和检索实例。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-11-10T16:59:52.143

Try registering a second class using the same DLL. Consider that you may actually need a separate copy of the DLL with a different name in order to be completely safe.

Just remember that the STA COM class (and perhaps its DLL) is not considered thread safe for multi-threading and there is nothing you can do about that external to the COM class.

# c# - 如何在静态类中覆盖 ToString？

> ID：278390
> 
> 赞同：11
> 
> 时间：2008-11-10T16:38:17.570
> 
> 标签：c#, .net, static, overriding

我有一个公共静态类，我想在其中有一个 ToString() 方法。

我已将其定义为公共静态字符串 ToS​​tring()，但收到以下警告：

> 'Class.ToString()' 隐藏继承的成员 'object.ToString()'。要使当前成员覆盖该实现，请添加 override 关键字。否则添加新关键字。

如果我添加 override 关键字，则会收到此错误：

> 静态成员“Class.ToString()”不能标记为覆盖、虚拟或抽象

如何摆脱该警告并让我的静态类具有 ToString() 方法。

谢谢你，
基思

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-11-10T17:04:11.323

是的，使用“new”修饰符将有效地使编译器警告静音，但您正在使用静态方法**显式隐藏**实例方法。（这与覆盖该方法不同。）通常您不想隐藏实例方法，除非有很好的理由，而且您真的不应该使用静态方法隐藏它，因为这确实会改变调用的行为语义。.NET 中的每个对象都有一个名为 ToString() 的实例方法，它具有开发人员期望的特定行为；通过使用新的静态方法隐藏该行为，您正在改变可能导致很多混乱的期望。

你在“串”什么？静态类通常不保存内部状态，因此实际上不应该提供任何内部数据作为 ToString() 调用的逻辑输出。您可能需要重新考虑您的类设计或提供一个不同的方法名称，以便在不隐藏实例 ToString() 的情况下更清楚地指示方法的用途。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-10T16:40:19.907

在静态类中，您不能覆盖 ToString。.ToString 是一个实例方法，根据定义，静态类只能有静态成员。

另外，为什么要覆盖 .ToString()？无法获取类的实例，因此无法调用该函数。

注意：使用新语法不会覆盖 .ToString。它将创建一个与 Object.ToString() 方法完全无关的新成员。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-10T16:39:43.980

好的，所以在问这个问题时，我找到了答案：

新修改器：

> [http://msdn.microsoft.com/en-us/library/51y09td4(VS.71).aspx#vclrfnew_newmodifier](http://msdn.microsoft.com/en-us/library/51y09td4(VS.71).aspx#vclrfnew_newmodifier)

这是现在的方法：

> 公共新静态字符串 ToS​​tring()

谢谢你，基思

# sql - 我应该使用 CASCADE DELETE 规则吗？

> ID：278392
> 
> 赞同：43
> 
> 时间：2008-11-10T16:38:41.703
> 
> 标签：sql, sql-server, cascade

> **重复：[何时/为什么在 SQL Server 中使用级联？](https://stackoverflow.com/q/59297/1288)**

我一直不敢使用 DELETE CASCADE，但是随着我变得更加自信（懒惰：D），我在想它有多糟糕，是使用它的最佳做法还是应该避免它并清理我的外键等老式方式（使用存储过程）？

* * *

## 回答 #1

> 赞同：92
> 
> 时间：2008-11-10T17:16:21.847

ON DELETE CASCADE 很好，但仅当相关行确实是被删除行的逻辑扩展时。例如，DELETE ORDERS 可以删除关联的 ORDER_LINES，因为显然您想删除这个订单，它由一个标题和一些行组成。另一方面，DELETE CUSTOMER 不应删除关联的订单，因为订单本身很重要，它们不仅仅是客户的属性。

思考这个问题的一种方法是：如果我发出 DELETE X 并且它也删除了 Y，我会高​​兴还是不高兴？如果我发出 DELETE X 并被告知“不能删除 X，因为 Y 存在”，我会对保护感到高兴，还是对不便感到恼火？

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-11-10T16:40:08.737

我更喜欢准确控制要删除的内容（通过显式声明），所以我通常选择通过存储过程删除，而不是使用级联删除。

# bash - 在 bash 提示符中倒退

> ID：278398
> 
> 赞同：8
> 
> 时间：2008-11-10T16:39:45.460
> 
> 标签：bash, prompt

我想在我的 bash 提示之后和我的 Mac 上的输出之前有一个空行。它应该看起来像这样：

```
echo; ls 
```

我可以在我的 bash 提示符中添加一个换行符，然后返回一行等待用户输入吗？我有什么明显的遗漏吗？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2012-10-22T20:30:40.350

我知道这是旧的，但对于像我这样在谷歌搜索时遇到这个的人来说。这就是你这样做的方式......它实际上很简单！

查看此链接 -->[光标移动](http://tldp.org/HOWTO/Bash-Prompt-HOWTO/x361.html)

基本上向上移动 N 行：

```
echo -e "\033[<N>A HELLO WORLD\n" 
```

只需将“ *< N >* ”更改为您想要返回的行数......例如，向上移动 5 行将是**“/033 [5A”**

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-10T16:42:11.323

据我所知，除非你深入研究更底层的东西，比如全屏模拟器，比如 curses，否则这是不可能的。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-10T16:46:28.333

这有点像在黑暗中刺伤，但您*可以*使用[VT102 终端代码](http://www.ibiblio.org/pub/historic-linux/ftp-archives/tsx-11.mit.edu/Oct-07-1996/info/vt102.codes)来控制光标，而无需使用 Curses。您感兴趣的相关 VT102 命令都包括发送 ESC，然后是 [，然后是特定的命令参数。

例如，要将光标向上移动一行，需要输出：

```
ESC  [    1    A
0x1B 0x5B 0x31 0x41 
```

请注意，VT102 文档通常使用八进制，因此如果您使用十六进制，请随身携带一个[ascii 表。](http://www.asciitable.com/)

所有这些建议都是在未经测试的情况下给出的——我不知道是否可以将 VT102 命令嵌入到您的 bash 提示符中，但我认为这可能值得一试。

编辑：是的——看起来[很多人](http://www.mail-archive.com/xfree86@xfree86.org/msg05109.html)在他们的 bash 提示中使用 VT102 格式化代码。要将上面的示例翻译成 Bash 可以识别的内容，请输入：

```
\e[1A 
```

进入您的提示应该将光标向上移动一行。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-13T13:38:06.253

这是很有可能的。如果您的 bash 已`C-v`设置为 readlinequoted-insert 命令，您只需将以下内容添加到您的`~/.inputrc`：

```
RETURN: "\C-e\C-v\n\C-v\n\n"
```

这将使 bash（实际上是 readline）在常规解释换行符之前插入两个逐字换行符。默认情况下，只插入一个，这就是导致输出在提示后的行开始的原因。

您可以测试是否`C-v`设置为quoted-insert，方法是在bash（即`Ctrl+V`）中键入它，然后是向上箭头。这应该打印`^[[A`或类似的东西。如果没有，您也可以将其绑定`~/.inputrc`：

```
C-v: quoted-insert
RETURN: "\C-e\C-v\n\C-v\n\n"
```

`~/.inputrc`如果不存在可以创建。`C-x C-r`除非您发出 readline re-read-init-file 命令（默认为 on ），否则更改不会在运行 bash 时生效。不过要小心。如果你做错了什么，enter 将不再发出命令，而且修复你的错误可能会很困难。如果您做错了什么，`C-o`默认情况下也会接受该行。

添加换行符然后将光标移回常规提示符（如您所描述的）是可能的，但不会产生您想要的效果。您插入的换行符只会被应用程序输出覆盖，因为您将光标移回了它的前面。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2010-08-02T23:53:32.470

这有效：

```
trap echo DEBUG 
```

如果您在空提示下按回车，它不会添加额外的换行符。

上面的命令将导致为管道或多命令行的每个成员输出一个换行符，例如：

```
$ echo foo; echo bar
\n
foo
\n
bar 
```

为了防止这种情况，在所有命令输出之前只输出一个额外的换行符：

```
PROMPT_COMMAND='_nl=true'; trap -- '$_nl && [[ $BASH_COMMAND != $PROMPT_COMMAND ]] && echo; _nl=false' DEBUG 
```

陷阱在每个命令之前执行，`DEBUG`因此在第一个命令之前它检查标志是否为真，如果是，则输出换行符。然后它将标志设置为 false，因此该行之后的每个命令都不会触发额外的换行符。

的内容`$PROMPT_COMMAND`在提示输出之前执行，因此标志设置为真 - 为下一个周期做好准备。

因为在空命令行上按 enter 仍会触发陷阱中测试内容的执行，也会将这些内容作为当前命令检查，如果它们匹配`$PROMPT_COMMAND`则不执行。`echo`

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-10T17:06:56.327

I believe (but haven't tried) if you put `'\n\b'` in the prompt string it would do that.

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-06-10T18:05:09.443

一般来说，如果你想找出终端可以做的任何事情的代码，请阅读`terminfo`手册页。

在这种情况下，*光标向上一行*代码可以通过以下方式确定：

```
tput cuu1 
```

如果将 tput 输出重定向到文件，则可以查看使用了哪些控制字符。

Bash 还支持 PROMPT_COMMAND 变量，允许您在发出每个提示之前运行任意命令。

# .net - VS2008 XAML 设计视图阻塞命名空间 C++ 程序集

> ID：278416
> 
> 赞同：1
> 
> 时间：2008-11-10T16:43:03.583
> 
> 标签：.net, wpf, xaml, c++-cli

我有一个 C++ 程序集，其中托管和非托管代码都编译为 DLL。它已正确导入到项目引用中，因为我可以使用对象浏览器查看我的所有类及其成员。

问题在于 XAML 设计视图。在我的 XAML 代码中，我想用我的 C++ 程序集进行数据绑定，所以我有这样的命名空间：

```
xmlns:kudu="clr-namespace:kudu;assembly=CLI" 
```

CLI 是 dll 的名称，它内部有一个名为 kudu 的命名空间。设计视图拒绝显示 XAML 并给我这个错误：

```
未找到程序集“CLI”。确认您没有遗漏
装配参考。另外，验证您的项目和所有引用的
组件已建成。
```

最好的部分是我实际上可以构建整个解决方案并且一切正常！窗口会随着 C++ 对象的变化而更新，而不是什么。然而，如果没有设计视图，这会使继续开发变得相当困难。

有没有人回答为什么会发生这种情况以及我该如何解决？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-15T19:52:41.293

我发现的另一种解决方案是将包含所有 DLL 的程序集的 bin 目录添加到 windows PATH 变量中。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-10T17:16:56.900

这可能是因为 ide 无法加载非托管 dll 之一。您可能必须将它们移动到 windows/system32 中。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-08T02:51:43.527

非常有帮助，感谢您的见解。

我的解决方案是使用 Post-Build 事件将 DLL 复制到输出目录中。方法如下 1\. 项目属性/构建事件 2\. 设置构建后事件命令行：

复制 path_to_dependent_dlls 。

哦，我发现它需要重新启动 VStudio 才能开始工作......

# .net - 使用参数化的 Alter Database 命令时，@[参数名称] 附近的语法不正确

> ID：278421
> 
> 赞同：0
> 
> 时间：2008-11-10T16:46:20.517
> 
> 标签：.net, sql-server, ado.net

我正在尝试使用以下代码删除 SQL Server 数据库：

```
SqlCommand command = new SqlCommand("USE MASTER; ALTER DATABASE @database SET SINGLE_USER WITH ROLLBACK IMMEDIATE; DROP DATABASE @Database", connection);
command.Parameters.AddWithValue("@database", TestingEnvironment.DatabaseName);
command.ExecuteNonQuery(); 
```

当我执行它时，我收到错误：

> '@database' 附近的语法不正确。关键字“with”附近的语法不正确。如果此语句是公用表表达式或 xmlnamespaces 子句，则前面的语句必须以分号结束。'IMMEDIATE' 附近的语法不正确。

我究竟做错了什么？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-10T17:28:51.027

简单地说，Alter Database 命令不支持您想要的参数。你必须在这里连接字符串。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-10T17:05:15.097

参数是否区分大小写？您在第二个 @Database 中有一个大写字母 D。

# c++ - 什么可能导致 dynamic_cast 崩溃？

> ID：278429
> 
> 赞同：18
> 
> 时间：2008-11-10T16:48:26.113
> 
> 标签：c++, crash, casting, dynamic-cast

我有一段看起来像这样的代码：

```
TAxis *axis = 0;
if (dynamic_cast<MonitorObjectH1C*>(obj))
   axis = (dynamic_cast<MonitorObjectH1C*>(obj))->GetXaxis(); 
```

有时它会崩溃：

```
Thread 1 (Thread -1208658240 (LWP 11400)):
#0  0x0019e7a2 in _dl_sysinfo_int80 () from /lib/ld-linux.so.2
#1  0x048c67fb in __waitpid_nocancel () from /lib/tls/libc.so.6
#2  0x04870649 in do_system () from /lib/tls/libc.so.6
#3  0x048709c1 in system () from /lib/tls/libc.so.6
#4  0x001848bd in system () from /lib/tls/libpthread.so.0
#5  0x0117a5bb in TUnixSystem::Exec () from /opt/root/lib/libCore.so.5.21
#6  0x01180045 in TUnixSystem::StackTrace () from /opt/root/lib/libCore.so.5.21
#7  0x0117cc8a in TUnixSystem::DispatchSignals ()
   from /opt/root/lib/libCore.so.5.21
#8  0x0117cd18 in SigHandler () from /opt/root/lib/libCore.so.5.21
#9  0x0117bf5d in sighandler () from /opt/root/lib/libCore.so.5.21
#10 <signal handler called>
#11 0x0533ddf4 in __dynamic_cast () from /usr/lib/libstdc++.so.6 
```

我不知道它为什么会崩溃。*obj*不为空（如果是的话，它不会是一个问题，不是吗？）。

动态演员崩溃的原因可能是什么？

如果它不能转换，它应该只返回 NULL no 吗？

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2008-11-11T04:45:21.050

崩溃的一些可能原因：

*   `obj`指向具有非多态类型的对象（没有虚方法的类或结构，或基本类型）。
*   `obj`指向一个已被释放的对象。
*   `obj`指向未映射的内存，或已以在访问时生成异常的方式映射的内存（例如保护页或不可访问页）。
*   `obj` points to an object with a polymorphic type, but that type was defined in an external library that was compiled with RTTI disabled.

Not all of these problems necessarily cause a crash in all situations.

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-11-10T17:30:58.587

我建议对此代码片段使用不同的语法。

```
if (MonitorObjectH1C* monitorObject = dynamic_cast<MonitorObjectH1C*>(obj))
{
    axis = monitorObject->GetXaxis();
} 
```

如果其他线程正在删除 monitorObject 指向的内容或者 obj 是疯狂的垃圾，您仍然可能崩溃，但至少您的问题不再与强制转换相关并且您没有执行两次 dynamic_cast。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-10T17:26:08.520

因为它只是有时会崩溃，我敢打赌这是一个线程问题。检查所有对“obj”的引用：

```
grep -R 'obj.*=' 。
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-10T17:00:59.520

如果转换失败并且您正在转换为指针，dynamic_cast 将返回 0，这是您的情况。问题是您在代码的早期损坏了堆，或者未启用 rtti。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-10T17:12:34.943

您确定“obj”的值已正确定义吗？

例如，如果它是未初始化的（即随机的）它们我可以看到它导致崩溃。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-10T16:59:59.493

obj 的值可以由不同的线程更改吗？

# java - wsdl2java 错误：发射器故障。端口中的端点地址无效

> ID：278432
> 
> 赞同：1
> 
> 时间：2008-11-10T16:49:12.883
> 
> 标签：java, web-services

我正在尝试对我公司另一组提供给我的 WSDL 文件运行 wsdl2java 命令。我知道 wsdl2java 有效，因为我可以运行这些示例，但是当我在给我的 wsdl 上尝试它时它失败了。最大的不同是提供给我的 WSDL 使用 SSL。

我正在使用 Java 1.4（检查了几次）并确保所有正确的 jar 都在我的类路径中，jsse.jar 在那里。

命令：java org.apache.axis.wsdl.WSDL2Java --server-side GenericWebService.wsdl

错误：

log4j:WARN 找不到记录器 (org.apache.axis.i18n.ProjectResourceBundle) 的附加程序。log4j:WARN 请正确初始化 log4j 系统。**java.io.IOException：发射器故障。服务 AC_x0020_Generic_x0020_Web_x0020_ServiceLocator 中的端口 AC_x0020_Generic_x0020_Web_0020_ServiceSoap 中的端点地址无效：** at org.apache.axis.wsdl.toJava.JavaServiceImplWriter.writeFileBody(JavaServiceImplWriter.ja a:242) at org.apache.axis.wsdl.toJava.JavaWriter.generate(JavaWriter.generate(JavaWriter.generate) .java:127) 在 org.apache.axis.wsdl.toJava.JavaServiceWriter.generate(JavaServiceWriter.java:112) 在 org.apache.axis.wsdl.toJava.JavaGeneratorFactory$Writers.generate(JavaGeneratorFactory.j va:421)在 org.apache.axis.wsdl.gen.Parser.generate(Parser.java:476) 在 org.apache.axis.wsdl.gen.Parser.access$000(Parser.java:

自卫队

```
<wsdl:portType name="AC_x0020_Generic_x0020_Web_x0020_ServiceSoap">
  <wsdl:operation name="Provision">
    <wsdl:input message="tns:ProvisionSoapIn" />
    <wsdl:output message="tns:ProvisionSoapOut" />
  </wsdl:operation>
</wsdl:portType>

<wsdl:binding name="AC_x0020_Generic_x0020_Web_x0020_ServiceSoap" type="tns:AC_x0020_Generic_x0020_Web_x0020_ServiceSoap">
  <soap:binding transport="http://schemas.xmlsoap.org/soap/http" />
  <wsdl:operation name="Provision">
    <soap:operation soapAction="http://xmlns.fmr.com/systems/dev/aar/2008/05/GenericWebService/Provision" style="document" />
    <wsdl:input>
      <soap:body use="literal" />
      <soap:header message="tns:ProvisionServiceProcessingDirectives" part="ServiceProcessingDirectives" use="literal" />
      <soap:header message="tns:ProvisionServiceCallContext" part="ServiceCallContext" use="literal" />
    </wsdl:input>
    <wsdl:output>
      <soap:body use="literal" />
    </wsdl:output>
  </wsdl:operation>
</wsdl:binding>

<wsdl:service name="AC_x0020_Generic_x0020_Web_x0020_Service">
  <wsdl:documentation xmlns:wsdl="http://schemas.xmlsoap.org/wsdl/">Generic web service definition for provisioning requests callable by AccessCENTRAL</wsdl:documentation>
  <wsdl:port name="AC_x0020_Generic_x0020_Web_x0020_ServiceSoap" binding="tns:AC_x0020_Generic_x0020_Web_x0020_ServiceSoap">
    <soap:address location="" />
  </wsdl:port>
</wsdl:service> 
```

**更新的解决方案：** 问题是解析器需要 <soap:address location="" /> 中的值才能完成。我添加了我的服务的 URL，它起作用了。
新线看起来像：

```
<soap:address location="" http://localhost:8080/axis/services/AC_x0020_Generic_x0020_Web_x0020_Service" /> 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-10T19:15:28.877

**soap:address**指定的**位置**为空白。它应该是 SOAP 服务的 URI。请参阅[肥皂：地址](http://www.w3.org/TR/wsdl#_soap:address)。

 **查看soapAction， http: *[//xmlns.fmr.com/systems/dev/aar/2008/05/GenericWebService](http://xmlns.fmr.com/systems/dev/aar/2008/05/GenericWebService)*可能是正确的位置值。

# c# - 在 Windows 中创建临时目录？

> ID：278439
> 
> 赞同：145
> 
> 时间：2008-11-10T16:50:34.673
> 
> 标签：c#, .net, windows, temporary-directory

在 Windows 中获取临时目录名称的最佳方法是什么？我看到我可以使用`GetTempPath`and`GetTempFileName`来创建一个临时文件，但是有没有相当于 Linux/BSD 的[`mkdtemp`](http://linux.die.net/man/3/mkdtemp)功能来创建一个临时目录呢？

* * *

## 回答 #1

> 赞同：270
> 
> 时间：2008-11-10T16:55:57.770

不，没有等效于 mkdtemp。最好的选择是结合使用[GetTempPath](https://docs.microsoft.com/en-us/dotnet/api/system.io.path.gettemppath)和[GetRandomFileName](https://docs.microsoft.com/en-us/dotnet/api/system.io.path.getrandomfilename)。

您将需要与此类似的代码：

```
public string GetTemporaryDirectory()
{
   string tempDirectory = Path.Combine(Path.GetTempPath(), Path.GetRandomFileName());
   Directory.CreateDirectory(tempDirectory);
   return tempDirectory;
} 
```

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2013-12-07T20:01:11.943

我`Path.GetTempFileName()`在磁盘上给了我一个有效的伪随机文件路径，然后删除该文件，并创建一个具有相同文件路径的目录。

根据 Chris 对 Scott Dorman 的回答的评论，这避免了检查文件路径是否在一段时间或循环中可用的需要。

```
public string GetTemporaryDirectory()
{
  string tempFolder = Path.GetTempFileName();
  File.Delete(tempFolder);
  Directory.CreateDirectory(tempFolder);

  return tempFolder;
} 
```

如果您确实需要一个加密安全的随机名称，您可能需要调整 Scott 的答案以使用 while 或 do loop 以继续尝试在磁盘上创建路径。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2010-08-06T04:59:18.273

我喜欢使用 GetTempPath()、一个 GUID 创建函数，如 CoCreateGuid() 和 CreateDirectory()。

GUID 被设计为具有很高的唯一性，并且也极不可能有人手动创建与 GUID 具有相同形式的目录（如果他们这样做，则 CreateDirectory() 将无法指示其存在。）

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2016-01-10T22:42:45.930

@克里斯。我也沉迷于临时目录可能已经存在的远程风险。关于随机和密码强的讨论也不完全让我满意。

我的方法建立在一个基本事实之上，即 O/S 不能允许 2 次调用来创建文件都成功。.NET 设计人员选择隐藏目录的 Win32 API 功能有点令人惊讶，这使得这更容易，因为当您第二次尝试创建目录时它会返回错误。这是我使用的：

```
 [DllImport(@"kernel32.dll", EntryPoint = "CreateDirectory", SetLastError = true, CharSet = CharSet.Unicode)]
    [return: MarshalAs(UnmanagedType.Bool)]
    private static extern bool CreateDirectoryApi
        ([MarshalAs(UnmanagedType.LPTStr)] string lpPathName, IntPtr lpSecurityAttributes);

    /// <summary>
    /// Creates the directory if it does not exist.
    /// </summary>
    /// <param name="directoryPath">The directory path.</param>
    /// <returns>Returns false if directory already exists. Exceptions for any other errors</returns>
    /// <exception cref="System.ComponentModel.Win32Exception"></exception>
    internal static bool CreateDirectoryIfItDoesNotExist([NotNull] string directoryPath)
    {
        if (directoryPath == null) throw new ArgumentNullException("directoryPath");

        // First ensure parent exists, since the WIN Api does not
        CreateParentFolder(directoryPath);

        if (!CreateDirectoryApi(directoryPath, lpSecurityAttributes: IntPtr.Zero))
        {
            Win32Exception lastException = new Win32Exception();

            const int ERROR_ALREADY_EXISTS = 183;
            if (lastException.NativeErrorCode == ERROR_ALREADY_EXISTS) return false;

            throw new System.IO.IOException(
                "An exception occurred while creating directory'" + directoryPath + "'".NewLine() + lastException);
        }

        return true;
    } 
```

您可以决定非托管 p/invoke 代码的“成本/风险”是否值得。大多数人会说不是，但至少你现在有一个选择。

CreateParentFolder() 留给学生作为练习。我使用 Directory.CreateDirectory()。获取目录的父目录时要小心，因为它在根目录时为空。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2016-09-02T07:25:32.983

我通常使用这个：

```
 /// <summary>
    /// Creates the unique temporary directory.
    /// </summary>
    /// <returns>
    /// Directory path.
    /// </returns>
    public string CreateUniqueTempDirectory()
    {
        var uniqueTempDir = Path.GetFullPath(Path.Combine(Path.GetTempPath(), Guid.NewGuid().ToString()));
        Directory.CreateDirectory(uniqueTempDir);
        return uniqueTempDir;
    } 
```

如果您想绝对确定临时路径中不存在此目录名称，则需要检查此唯一目录名称是否存在，如果确实存在，请尝试创建另一个目录名称。

但是这种基于 GUID 的实现就足够了。在这种情况下，我没有任何问题的经验。一些 MS 应用程序也使用基于 GUID 的临时目录。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2020-12-14T14:24:01.263

我以这种方式使用了一些答案并实现`GetTmpDirectory`了方法。

```
public string GetTmpDirectory()
{
    string tmpDirectory;

    do
    {
        tmpDirectory = Path.Combine(Path.GetTempPath(), Path.GetFileNameWithoutExtension(Path.GetRandomFileName()));
    } while (Directory.Exists(tmpDirectory));

    Directory.CreateDirectory(tmpDirectory);
    return tmpDirectory;
} 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2013-12-09T23:48:49.183

这是解决临时目录名称冲突问题的一种更暴力的方法。这不是一个可靠的方法，但它显着减少了文件夹路径冲突的机会。

可以潜在地将其他进程或程序集相关信息添加到目录名称中，以降低冲突的可能性，尽管可能不希望在临时目录名称上显示此类信息。还可以混合时间相关字段的组合顺序，以使文件夹名称看起来更随机。我个人更喜欢这样保留它，因为在调试过程中我更容易找到它们。

```
string randomlyGeneratedFolderNamePart = Path.GetFileNameWithoutExtension(Path.GetRandomFileName());

string timeRelatedFolderNamePart = DateTime.Now.Year.ToString()
                                 + DateTime.Now.Month.ToString()
                                 + DateTime.Now.Day.ToString()
                                 + DateTime.Now.Hour.ToString()
                                 + DateTime.Now.Minute.ToString()
                                 + DateTime.Now.Second.ToString()
                                 + DateTime.Now.Millisecond.ToString();

string processRelatedFolderNamePart = System.Diagnostics.Process.GetCurrentProcess().Id.ToString();

string temporaryDirectoryName = Path.Combine( Path.GetTempPath()
                                            , timeRelatedFolderNamePart 
                                            + processRelatedFolderNamePart 
                                            + randomlyGeneratedFolderNamePart); 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-10T17:05:46.127

如上所述， Path.GetTempPath() 是一种方法。如果用户设置了 TEMP 环境变量，您也可以调用[Environment.GetEnvironmentVariable("TEMP") 。](http://msdn.microsoft.com/en-us/library/77zkk0b6.aspx)

如果您打算使用 temp 目录作为在应用程序中持久化数据的一种方式，您可能应该考虑使用[IsolatedStorage](http://msdn.microsoft.com/en-us/library/bdts8hk0.aspx)作为配置/状态/等的存储库...

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2008-11-10T16:55:18.987

[GetTempPath](http://msdn.microsoft.com/en-us/library/system.io.path.gettemppath.aspx)是正确的做法；我不确定您对这种方法的关注是什么。然后，您可以使用[CreateDirectory](http://msdn.microsoft.com/en-us/library/system.io.directory.createdirectory.aspx)来制作它。

# .net - 执行大量模数？

> ID：278440
> 
> 赞同：5
> 
> 时间：2008-11-10T16:50:47.437
> 
> 标签：.net, modulo

我需要对非常大的整数进行模运算。我的平台支持的最大整数（编辑：.NET 2.0）是一个 64 位整数，对于我正在使用的数字来说不够大。

如何对非常大的整数进行取模，例如 12654875632126424875387321657498462167853687516876876？

我有一个解决方案，将数字视为字符串并逐个处理，但我想知道是否有更好的方法。

这是我将数字视为字符串的函数。它基本上按照您手动进行的方式进行长除法。

```
 Public Function MyMod(ByVal numberString As String, ByVal modby As Integer) As Integer
        Dim position As Integer = -1
        Dim curSubtraction As Integer = 0

        While position < numberString.Length - 1
            position += 1
            curSubtraction = curSubtraction * 10 + CInt(numberString.Substring(position, 1))

            If (curSubtraction / modby) < 1 And position = numberString.Length - 1 Then
                Return curSubtraction
            ElseIf (curSubtraction / modby) < 1 Then
                Continue While
            Else
                curSubtraction = curSubtraction Mod modby
            End If
        End While
        Return curSubtraction
    End Function 
```

有没有更清洁、更有效的方法？

编辑：为了澄清，整数来自 IBAN 银行帐号。根据规范，您必须将 IBAN 帐号（包含字母）转换为一个整数。然后，您对整数进行取模。所以，我想你可以说执行模数的整数的真正来源是一串数字。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-10T16:57:59.480

您尚未指定数字的来源，但您可以进行一些简化。如果数字最初较小，请考虑以下事项：

```
(a + b) MOD n = ((a MOD n) + (b MOD n)) MOD n 
```

或者

```
ab MOD n = (a MOD n)(b MOD n) MOD n 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-10T16:52:58.337

使用加密/数学库。谷歌搜索 bignum。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-16T13:58:57.483

您需要一个任意精度的整数数学库，例如[IntX](http://www.codeplex.com/IntX/)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-04-21T09:36:22.673

如果您使用的是 .NET 4，则可以只使用 BigInteger。但这是使用早期版本的方法。

mods 有一个数学技巧，您可以只取前*x*个数字，计算该值的 mod，然后将该 mod 的*结果*添加到剩余的数字上，并继续重复该过程直到您到达末尾你的“巨大”数字。

引入递归方法！（对不起我不做VB）

```
private static int Mod(string value, int mod) {
    if (string.IsNullOrEmpty(value)) throw new ArgumentException("Invalid value.", "value");
    if (mod <= 0) throw new ArgumentException("Invalid mod.", "mod");

    int maxLength = long.MaxValue.ToString().Length - 1;

    return value.Length > maxLength
        ? Mod((Convert.ToInt64(value.Substring(0, maxLength)) % mod).ToString() + value.Substring(maxLength), mod)
        : Convert.ToInt32(Convert.ToInt64(value) % mod);} 
```

# eclipse - Eclipse：将命令行参数添加到 OS X .app 目录

> ID：278451
> 
> 赞同：-1
> 
> 时间：2008-11-10T16:54:05.777
> 
> 标签：eclipse, macos, command-line

是否可以将自定义命令行参数添加到 Eclipse .app 文件夹？在我的特殊情况下，我正在使用 ZendStudio。我假设基本 Eclipse 版本的行为方式相同。

我发现看起来像两个不同的地方可以工作，但都没有产生任何结果：

```
ZendStudio.app\Contents\info.plist
ZendStudio.app\Contents\MacOS\ZendStudio.ini 
```

我找对地方了吗，或者这甚至可能吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-10T17:13:01.557

如果您的意思是要使用一些命令行参数启动 Eclipse，那么没有文件可以添加这些作为默认值。但是您可以制作一个小脚本，使用您想要的参数启动 Eclipse，例如：

`/Applications/Eclipse.app/Context/MacOS/eclipse some command line arguments`

然后通过终端窗口为您的脚本添加可执行权限：

`chmod 755 your_file`

您可以`chmod 755` 在终端上键入“”，然后将脚本文件拖放到终端窗口上，它将在其上键入文件的完整路径，按 ENTER 即可。您可以双击您的脚本文件，它将使用您键入的命令行参数启动 Eclipse。

# c# - 在 .Net/C# 中引发多个异常

> ID：278466
> 
> 赞同：41
> 
> 时间：2008-11-10T16:57:38.937
> 
> 标签：c#, .net, exception

在我处理的应用程序中，任何业务逻辑错误都会引发异常，调用代码会处理异常。此模式在整个应用程序中使用并且运行良好。

我有一种情况，我将尝试从业务层内部执行许多业务任务。对此的要求是一项任务的失败不应导致进程终止。其他任务应该仍然能够执行。换句话说，这不是原子操作。我遇到的问题是，在操作结束时，我希望通过抛出异常来通知调用代码确实发生了一个或多个异常。考虑以下伪代码片段：

```
function DoTasks(MyTask[] taskList)
{
  foreach(MyTask task in taskList)
  {
    try
    {
       DoTask(task);
    }
    catch(Exception ex)
    {
        log.add(ex);
    }
  }

  //I want to throw something here if any exception occurred
} 
```

我扔什么？我以前在职业生涯中遇到过这种模式。过去我保留了所有异常的列表，然后抛出一个包含所有捕获的异常的异常。这似乎不是最优雅的方法。从每个异常中保留尽可能多的细节以呈现给调用代码非常重要。

想法？

* * *

编辑：解决方案必须用 .Net 3.5 编写。我不能使用任何 beta 库，或者[Bradley Grainger](/users/23633/bradley-grainger)（如下）提到的 .Net 4.0 中的 AggregateException 将是抛出集合异常的一个很好的解决方案。

* * *

## 回答 #1

> 赞同：44
> 
> 时间：2008-11-10T17:22:14.487

.NET的[任务并行库扩展](http://msdn.microsoft.com/magazine/cc163340.aspx)（[将成为 .NET 4.0 的一部分](http://blogs.msdn.com/pfxteam/archive/2008/10/10/8994927.aspx)）遵循其他答案中建议的模式：收集所有已抛出到 AggregateException 类中的异常。

通过总是抛出相同的类型（无论子工作有一个异常还是多个），处理异常的调用代码更容易编写。

在 .NET 4.0 CTP 中，`AggregateException`有一个公共构造函数（采用`IEnumerable<Exception>`）；对于您的应用程序来说，它可能是一个不错的选择。

如果您的目标是 .NET 3.5，请考虑`System.Threading.AggregateException`在您自己的代码中克隆您需要的类部分，例如，一些构造函数和 InnerExceptions 属性。（您可以将您的克隆`System.Threading`放在程序集内的命名空间中，如果您公开它可能会引起混淆，但以后升级到 4.0 会更容易。）当 .NET 4.0 发布时，您应该能够“升级”到通过从项目中删除包含克隆的源文件，将项目更改为以新框架版本为目标，然后重新构建来选择框架类型。当然，如果您这样做，您需要在 Microsoft 发布新的 CTP 时仔细跟踪此类的更改，以免您的代码变得不兼容。（例如，这似乎是一个有用的通用类，他们可以将它从`System.Threading`to `System`.) 在最坏的情况下，您可以重命名类型并将其移回您自己的命名空间（这对于大多数重构工具来说非常容易）。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-11-10T17:10:19.190

我头顶的两种方法是创建一个自定义异常并将异常添加到此类并抛出该类：

```
public class TaskExceptionList : Exception
{
    public List<Exception> TaskExceptions { get; set; }
    public TaskExceptionList()
    {
        TaskExceptions = new List<Exception>();
    }
}

    public void DoTasks(MyTask[] taskList)
    {
        TaskExceptionList log = new TaskExceptionList();
        foreach (MyTask task in taskList)
        {
            try
            {
                DoTask(task);
            }
            catch (Exception ex)
            {
                log.TaskExceptions.Add(ex);
            }
        }

        if (log.TaskExceptions.Count > 0)
        {
            throw log;
        }
    } 
```

如果任务失败并且有一个“out List”变量，则返回 true 或 false。

```
 public bool TryDoTasks(MyTask[] taskList, out List<Exception> exceptions)
    {
        exceptions = new List<Exception>();
        foreach (MyTask task in taskList)
        {
            try
            {
                DoTask(task);
            }
            catch (Exception ex)
            {
                exceptions.Add(ex);
            }
        }

        if (exceptions.Count > 0)
        {
            return false;
        }
        else
        {
            exceptions = null;
            return true;
        }
    } 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-10T17:07:47.370

您可以创建一个自定义异常，该异常本身具有一组异常。然后，在您的 Catch 块中，将其添加到该集合中。在您的流程结束时，检查异常计数是否 > 0，然后抛出您的自定义异常。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-10T17:07:33.220

您可能希望使用[BackgroundWorker](http://msdn.microsoft.com/en-us/library/system.componentmodel.backgroundworker.runworkercompleted.aspx)为您执行此操作。它会在完成后自动捕获并呈现任何异常，然后您可以抛出或记录或执行任何操作。此外，您还可以获得多线程的好处。

[BackgroundWorker 是对委托的异步编程模型](http://infosysblogs.com/microsoft/2006/09/asynchronous_programming_model.html)的一个很好的包装。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-10T17:05:29.043

这里没有超级优雅的解决方案，但有一些想法：

*   将错误处理函数作为参数传递给 DoTasks，以便用户决定是否继续
*   使用跟踪记录发生的错误
*   在异常包的消息中连接来自其他异常的消息

# cocoa - 我应该为我的最新项目使用 Cocoa 绑定吗？

> ID：278469
> 
> 赞同：10
> 
> 时间：2008-11-10T16:58:16.047
> 
> 标签：cocoa, cocoa-bindings

我正在启动一个我认为会从绑定中受益的项目（我有一个源列表、几个浏览器视图等），但我认为如果没有它们，它也是非常可行的，也许更容易理解。根据我有限的经验，我发现绑定很难排除故障并且非常“神奇”（例如，很难在任何地方插入日志以找出东西在哪里破坏，一切要么正常，要么不正常）。

这只是我的缺乏经验（在这种情况下，我可以坐下来花一些时间来研究我对绑定的理解，并期望事情开始变得更清晰/更容易）还是我自己编写所有的胶水代码会更好我确信我可以理解和排除故障的方式。

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-11-10T17:36:31.743

使用绑定。

请注意，您*必须*遵循 MVC 模式才能充分利用绑定。**这比看起来要容易**，因为如今 Cocoa 几乎为您做了所有事情：

1.  查看：`NSView`和子类（当然），`NSCell`和子类，`NSWindow`和子类
2.  控制器：`NSController`和子类（尤其是`NSArrayController`）
3.  模型：核心数据

如果您不打算使用 Core Data，那么您可以滚动自己的模型对象，但这很容易。大多数这些对象的方法都是简单的访问器，只要`@synthesize`您以 Leopard 为目标就可以。

不编写任何代码通常无法摆脱困境，但绑定可以使您编写很少的代码。

推荐阅读：

*   [键值编码 (KVC) 编程指南](http://developer.apple.com/documentation/Cocoa/Conceptual/KeyValueCoding/)
*   [键值观察 (KVO) 编程指南](http://developer.apple.com/documentation/Cocoa/Conceptual/KeyValueObserving/KeyValueObserving.html)
*   [模型对象实施指南](http://developer.apple.com/documentation/Cocoa/Conceptual/ModelObjects/)
*   [KVC 访问器方法](http://developer.apple.com/documentation/Cocoa/Conceptual/KeyValueCoding/Concepts/AccessorConventions.html)（前面提到的 KVC 编程指南的一部分）和[我的 KVC 兼容访问器选择器格式的完整列表](http://boredzo.org/blog/archives/2007-08-07/a-complete-raw-list-of-kvc-accessor-selector-formats)

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-11-10T17:10:23.450

绑定在本质上看起来很神奇。要了解绑定背后的魔力，我认为必须彻底了解 KVC/KVO。我真的是彻底的意思。

然而，就我而言（Obj-C 的新手——9 个月），一旦我获得了 KVC/KVO 绑定，我就感到很兴奋。它大大减少了我的胶水代码，让我的生活变得更加轻松。调试绑定成为确保我的键值更改是可观察的情况。我发现我可以花更多时间编写我的应用程序应该做的事情，而不是确保视图反映数据。

我确实同意，虽然绑定起初非常令人生畏。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-11-10T18:18:17.073

我的一般方法是尽可能多地使用绑定开始，看看事情进展如何。然而，如果一个特定的界面元素在使用绑定时开始出现问题，或者付出的努力超出了它的价值，那么我会毫不犹豫地回退到使用更传统的方法（例如，数据源、操作）。我发现这些事情很难提前预测，但我认为从长远来看，支持绑定会更好，只要你在不提供绑定的情况下不要过于教条地坚持使用它们任何好处。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-11-10T19:05:02.017

在使用 Bindings 一段时间后，我发现它根本不是魔法，认为它是足够先进的技术。调试绑定接口与胶合接口采用不同的技术，但一旦你掌握了这些技术，在重用、可维护性和一致性方面的优势就在 IMO 显着。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-17T20:39:51.253

似乎我在我的应用程序中几乎同等地使用了绑定、KVO 和数据源方法。这真的取决于上下文。例如，在我的一个项目中，除了主窗口的大纲视图之外，我几乎在任何地方都使用了绑定，这非常复杂，以至于我什至不想尝试将其放入 NSTreeController 中。同时，我还使用 KVO 重新加载 UI 对象并跟踪模型对象中的依赖关系。

在学习 Bindings 或 Core Data 等高级 Cocoa 主题时要记住的重要一点是，您必须了解它们背​​后的所有技术；数据源协议、通知 KVO 等等。一旦你有足够的经验与他们一起工作来了解“魔法”是如何工作的，你就可以轻松地将更高级别的东西集成到你的应用程序中。

在您的特定情况下，您必须决定是否值得在开发应用程序的基础上花额外的时间来学习绑定。如果可能，使用绑定开发应用程序的简化原型可能对您有益，这样您就知道在开始实际项目时如何最好地将各个部分组合在一起。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-01-15T19:36:11.630

我的意见是，是的，您应该采用绑定；该技术现在已被充分理解且稳定，并且对于您不再需要编写的大量代码而言，这是值得的。当我第一次切换到绑定时，我在让观察对象和被观察对象的生命周期匹配方面遇到了很多麻烦，并且 UI 损坏，因为它正在观察一个有效的对象，但它是不正确的对象。一旦你多次看到这些问题，知道如何避免它们以及如果它们确实出现如何发现它们就变得很简单了。伊什。我仍然希望在调试器中出现“这里的事件导致这里的更新”的痕迹，但我仍然很高兴我采取了行动。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-15T17:29:52.243

出于好奇，我确实最终使用了绑定，几天后它们突然开始“有意义”。因此，我绝对建议您继续并花时间学习它们。

我还发现 Brian Webster 的建议很有帮助，因为我确实最终以老式的方式做了一些事情，要么是因为绑定不能做我想要的，要么是因为做我需要的事情会非常复杂。绑定。

# sql-server - The application sorts strings differently than the database

> ID：278471
> 
> 赞同：2
> 
> 时间：2008-11-10T16:58:49.353
> 
> 标签：sql-server, sorting, sql-order-by, collation

I am trying to sort a list of products by their name in a .Net application written in C#, to obtain the same list that I would get from an SQL Server database through an order by: select * from Products order by ProductName

Unfortunately, the application sorting behaves differently than the database sorting. It is probably related to the collation: the database has an SQL_Latin1_General_CP1_CI_AS collation.

How can I make the application sort these strings exactly like the database does?

Thanks.

* * *

UPDATE: I finally obtained a good result by using the code from the comments below, and changing the compare options to Ordinal:

private CompareOptions myOptions = CompareOptions.Ordinal ;

Also, this link contains some very useful information related to SQL collations: [http://www.siao2.com/2005/11/08/490305.aspx](http://www.siao2.com/2005/11/08/490305.aspx)

* * *

Thanks. It does not work yet, but this is probably the right direction. Here is the code I am trying now:

((List)orderDetails).Sort(new OrderDetailComparer());

where OrderDetailComparer is:

```
public class OrderDetailComparer : IComparer<OrderDetail>
{
  private CompareInfo myComp = CompareInfo.GetCompareInfo("en-US");
  private CompareOptions myOptions = CompareOptions.StringSort;

  public int Compare(OrderDetail a, OrderDetail b)
  {
    if (a == b) return 0;
    if (a == null) return -1;
    if (b == null) return 1;

    return myComp.Compare ( a.Product.ProductNameForSorting, b.Product.ProductNameForSorting, myOptions );
  }
} 
```

Still no result.

What do you think? How do I get the information from the database, to know what culture I should use?

Thanks.

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-10T17:26:13.153

您可能需要使用您希望排序的文化。查看 StringComparer 的示例：http: [//msdn.microsoft.com/en-us/library/system.stringcomparer.currentculture.aspx](http://msdn.microsoft.com/en-us/library/system.stringcomparer.currentculture.aspx)

# vba - Visio 对象的 VBA 动画

> ID：278475
> 
> 赞同：2
> 
> 时间：2008-11-10T16:59:30.897
> 
> 标签：vba, visio

我正在尝试使用循环为 Visio 对象设置动画，例如：

```
For reposition = 2 To 6
    xpos = reposition
    ypos = reposition

    sh1.SetCenter xpos, ypos

    Sleep 1000

Next reposition 
```

虽然这确实将对象从起始位置移动到结束位置，但中间步骤是不可见的。延迟后仅显示最终位置。

如果我将 a`MsgBox`放入循环中，则每个中间位置都是可见的，但必须单击一个分散注意力的居中位置的框才能看到这些。

如何在没有用户交互和模式窗口覆盖屏幕的情况下使流程可见？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-10T19:42:19.540

`DoEvents`在睡前尝试声明

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-11T18:24:09.867

谢谢，DJ！那工作得很好。为了下一个需要示例的人的利益，下面是我的代码，它移动了已放置在 Visio 网格上的进程图标并显示连续运动（动画）（查看预览，似乎我的缩进已被消除):

```
Private Declare Sub Sleep Lib "kernel32" (ByVal dwMilliseconds As Long)
Sub testa()
    Dim sh1 As Visio.Shape

    Dim pagObj As Visio.Page
    Dim xpos As Double
    Dim ypos As Double

    Set pagObj = ThisDocument.Pages.Item(1)
    Set sh1 = pagObj.Shapes.Item(1)

    Dim reposition As Double

    reposition = 2#

    While reposition < 6#
        xpos = reposition
        ypos = reposition

        sh1.SetCenter xpos, ypos

        DoEvents

        Sleep 100

        reposition = reposition + 0.2
    Wend

End Sub 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-11T15:36:43.077

确保您将 Application.Screenupdating 设置为 true...我有一个类似的宏可以为形状设置动画，我不需要使用 DoEvents 来更新屏幕...

# oop - 真的需要继承吗？

> ID：278476
> 
> 赞同：34
> 
> 时间：2008-11-10T16:59:44.250
> 
> 标签：oop, inheritance

我必须承认我有点像 OOP 怀疑论者。面向对象的糟糕的教学和劳动经验并没有帮助。所以我变成了 Visual Basic 的狂热信徒（经典的！）。

然后有一天我发现 C++ 发生了变化，现在有了 STL 和模板。我真的很喜欢！使语言变得有用。然后另一天 MS 决定对 VB 进行面部手术，我真的很讨厌无端更改的最终结果（使用“end while”而不是“wend”会让我成为一个更好的开发人员？为什么不放弃“next”为“ end for" 也是如此？为什么要在 setter 旁边强制使用 getter？等等）以及我发现无用的许多 Java 功能（例如，继承和分层框架的概念）。

而现在，几年后，我发现自己在问这个哲学问题：**真的**需要继承吗？

四人组说我们应该支持对象组合而不是继承。在考虑之后，我找不到可以用继承做的事情，而用对象聚合和接口做不到的事情。所以我想知道，为什么我们甚至首先拥有它？

有任何想法吗？我很想看到一个肯定需要继承的例子，或者在哪里使用继承而不是组合+接口可以导致更简单和更容易修改设计。在以前的工作中，我发现如果您需要更改基类，您还需要修改几乎所有派生类，因为它们取决于父类的行为。而且，如果您将基类的方法设为虚拟...则不会发生太多代码共享:(

否则，当我最终创建自己的编程语言时（我发现大多数开发人员都有一个长期未实现的愿望），我认为向它添加继承没有意义......

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2008-11-10T17:25:27.240

非常简短的回答：不。不需要继承，因为真正需要的只是字节码。但显然，字节码或汇编并不是编写程序的实用方法。OOP 并不是编程的唯一范式。但是，我离题了。

我在 2000 年代初上计算机科学学院，当时继承（是 a）、组合（有 a）和接口（是否 a）是在平等的基础上教授的。因此，我很少使用继承，因为它通常更适合组合。之所以强调这一点，是因为许多教授由于滥用继承而看到了糟糕的代码（以及您所描述的）。

**无论创建一种具有或不具有继承的语言，您能否创建一种能够防止不良习惯和不良设计决策的编程语言？**

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2008-11-10T17:32:00.300

我认为询问**真正**需要继承的情况有点忽略了这一点。您可以通过使用接口和一些组合来伪造继承。这并不意味着继承是无用的。您可以通过一些额外的输入在汇编代码中执行您在 VB6 中所做的任何事情，这并不意味着 VB6 没有用。

我通常只是开始使用界面。有时我注意到我实际上想要继承行为。这通常意味着我需要一个基类。就是这么简单。

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2008-11-10T17:16:01.863

继承定义了“Is-A”关系。

```
class Point( object ):
    # some set of features: attributes, methods, etc.

class PointWithMass( Point ):
    # An additional feature: mass. 
```

上面，我使用继承来正式声明 PointWithMass 是一个 Point。

有几种方法可以处理`P1`作为 PointWithMass 和 Point 的对象。这里有两个。

1.  有从`PointWithMass`object`p1`到某个 Point object的引用`p1-friend`。有属性`p1-friend`。`Point`当`p1`需要从事`Point`类似行为时，它需要将工作委托给它的朋友。

2.  依靠语言继承来确保 的所有功能`Point`也适用于我的`PointWithMass`对象，`p1`. 当`p1`需要从事类似`Point`行为时，它已经*是*一个`Point`对象，可以做需要做的事情。

我宁愿不管理浮动的额外对象，以确保所有超类功能都是子类对象的一部分。我宁愿继承以确保每个子类都是它自己的类的实例，而且也是所有超类的实例。

编辑。

对于静态类型的语言，有一个好处。当我依靠语言来处理这个问题时， a`PointWithMass`可以在任何`Point`预期 a 的地方使用。

对于真正晦涩的继承滥用，请阅读有关 C++ 奇怪的“通过私有继承进行组合”的泥潭。请参阅[在不创建子类型关系的情况下创建继承的任何明智示例？](https://stackoverflow.com/questions/255447/any-sensible-examples-of-creating-inheritance-without-creating-subtyping-relati)对此进行进一步讨论。它将继承和组合混为一谈；它似乎并没有为生成的代码增加清晰度或精度；它仅适用于 C++。

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2008-11-10T17:34:54.320

GoF（和许多其他人）建议您只*支持*组合而不是继承。如果你有一个 API 非常大的类，而你只想向它添加非常少的方法，而只留下基本实现，我会发现使用组合是不合适的。您必须重新实现封装类的所有公共方法才能返回它们的值。当您可以继承所有这些行为并将时间花在新方法上时，这是浪费时间（程序员和 CPU）。

因此，要回答您的问题，不，您绝对*不需要*继承。然而，在许多情况下，它是正确的设计选择。

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2008-11-10T18:09:03.410

继承的问题在于它混淆了子类型（断言 is-a 关系）和代码重用（例如，私有继承仅用于重用）的问题。

所以，不，这是一个我们不需要的超载词。我更喜欢子类型（使用'implements'关键字）和导入（有点像Ruby在类定义中这样做）

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2008-11-10T17:30:53.657

继承让我将一大堆簿记推到编译器上，因为它为我提供了对象层次结构的多态行为，否则我必须自己创建和维护。不管 OOP 的灵丹妙药有多好，总会有一些情况下您希望采用某种类型的行为，因为这样做才有意义。归根结底，这就是 OOP 的意义所在：它使某类问题更容易解决。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-11-10T19:13:05.947

组合的缺点是它*可能会*掩盖元素的相关性，并且*可能*让其他人更难理解。例如，使用 2D Point 类并希望将其扩展到更高维度，您可能必须添加（至少）Z getter/setter，修改 getDistance()，并可能添加 getVolume() 方法。所以你有对象 101 元素：相关的状态和行为。

具有组合思维的开发人员可能已经定义了一个 getDistance(x, y) -> double 方法，现在将定义一个 getDistance(x, y, z) -> double 方法。或者，一般来说，他们可能会定义一个 getDistance(lambdaGeneratingACoordinateForEveryAxis()) -> double 方法。然后他们可能会编写 createTwoDimensionalPoint() 和 createThreeDimensionalPoint() 工厂方法（或者可能是 createNDimensionalPoint(n) ），将各种状态和行为拼接在一起。

具有 OO 思维方式的开发人员会使用继承。实现领域特征的复杂性相同，初始化对象的复杂性较低（构造函数处理它与工厂方法相比），但就可以初始化的内容而言没有那么*灵活*。

现在从可理解性/可读性的角度考虑它。为了理解组合，有大量的函数以编程方式组合在另一个函数中。因此，就静态代码“结构”（文件和关键字等）而言，几乎没有使 Z 和 distance() 的相关性*跳出来*。在 OO 世界中，您有一个巨大的闪烁红灯，告诉您层次结构。此外，您有一个基本通用的词汇来讨论结构、广为人知的图形符号、自然层次结构（至少对于单继承）等。

现在，另一方面，一个命名良好且构造良好的 Factory 方法通常会使状态和行为之间有时晦涩难懂的关系更加明确，因为组合思维促进了函数式代码（即通过参数传递状态的代码，而不是通过参数传递状态的代码）。通过 **这个**）。

在拥有经验丰富的开发人员的专业环境中，组合的灵活性通常胜过其更抽象的性质。然而，我们永远不应忽视可理解性的重要性，尤其是在经验和/或人员流动率高的团队中。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2008-11-10T22:29:50.137

继承是一个实现决策。接口几乎总是代表更好的设计，通常应该在外部 API 中使用。

当编译器将通过继承为您完成时，为什么要编写大量样板代码转发方法调用到组合成员对象？

[这个](https://stackoverflow.com/questions/269496/inheritance-vs-aggregation#269553)对另一个问题的回答很好地总结了我的想法。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-11-10T17:39:14.577

是否还有其他人记得所有面向对象的纯粹主义者都对“包含”而不是“继承”的 COM 实现进行抨击？它基本上实现了相同的目标，但实现方式不同。这让我想起了你的问题。

我严格避免软件开发中的宗教战争。（“vi”或“emacs”......当每个人都知道它的“vi”时！）我认为它们是小头脑的标志。Comp Sci 教授可以坐下来辩论这些事情。我在现实世界中工作，可能不在乎。所有这些东西都只是试图为实际问题提供有用的解决方案。如果它们有效，人们就会使用它们。OO 语言和工具已经在 20 年内大规模商业化，这是一个很好的赌注，它们对很多人都很有用。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2008-11-10T17:47:58.817

编程语言中有很多**并不是真正需要**的特性。但是它们存在的原因有很多，基本上都归结为可重用性和可维护性。

一个企业所关心的只是**廉价**和**快速**地生产（当然是质量） 。

作为开发人员，您通过提高效率和生产力来帮助做到这一点。因此，您需要确保您编写的代码易于**重用**和**维护**。

而且，除其他外，这就是继承给您的 - 无需重新发明轮子即可**重用**的能力，以及无需对所有相似对象执行维护即可轻松**维护基础对象的能力。**

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-11-10T17:21:34.863

继承有很多有用的用法，可能也有很多用处不大的用法。有用的类之一是流类。

您有一个应该能够流式传输数据的方法。通过使用流基类作为方法的输入，您可以确保您的方法可用于写入多种流而无需更改。到文件系统，通过网络，压缩等。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2008-11-10T17:40:45.760

不。

对我来说，OOP 主要是关于状态、行为和多态性的封装。

那就是。但是如果你想要静态类型检查，你需要一些方法来对不同的类型进行分组，这样编译器可以在检查的同时仍然允许你使用新类型来代替另一个相关类型。创建类型的层次结构允许您对类型和类型组使用相同的概念（类），因此它是使用最广泛的形式。

但是还有其他方法，我认为最通用的方法是鸭子类型，以及密切相关的基于原型的 OOP（实际上不是继承，但通常称为基于原型的继承）。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2008-11-10T17:41:31.000

取决于你对“需要”的定义。不，没有继承是*不可能*的，尽管替代方案可能需要更冗长的代码，或者对您的应用程序进行重大重写。

但是在某些情况下继承是有用的。正如您所说，组合加上接口几乎涵盖了所有情况，但是如果我想提供默认行为怎么办？接口不能做到这一点。一个基类可以。有时，您想要做的实际上只是覆盖单个方法。不是从头开始重新实现类（如使用接口），而只是改变它的一个方面。或者你可能不希望类的所有成员都是可覆盖的。也许您只有一两个希望用户覆盖的成员方法，其余*调用*这些（并在用户覆盖的方法之前和之后执行验证和其他重要任务）在基类中一劳永逸地指定，并且不能被覆盖。

继承通常被那些过于痴迷于 Java 对 OOP 的狭隘定义（和痴迷）的人用作拐杖，但在大多数情况下，我同意，这是错误的解决方案，好像你的类层次结构越深，你的软件就越好.

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-11-10T17:30:14.843

当子类确实与超类是同一类对象时，继承是一件好事。例如，如果您正在实现 Active Record 模式，您正在尝试将一个类映射到数据库中的一个表，并将该类的实例映射到数据库中的一行。因此，您的 Active Record 类很可能会共享一个通用接口和方法实现，例如：主键是什么、当前实例是否被持久化、保存当前实例、验证当前实例、在验证时执行回调以及/ 或保存、删除当前实例、运行 SQL 查询、返回类映射到的表的名称等。

从您如何表达您的问题看来，您假设继承是单一的而不是多重的。如果我们需要多重继承，那么我们必须使用接口和组合来完成这项工作。为了说明这一点，Java 假设实现继承是单一的，而接口继承可以是多重的。不必走这条路。例如，C++ 和 Ruby 允许对您的实现和接口进行多重继承。也就是说，应该谨慎使用多重继承（即保持您的抽象类虚拟和/或无状态）。

也就是说，正如您所注意到的，有太多现实生活中的类层次结构，其中子类出于方便而从超类继承，而不是具有真正的 is-a 关系。因此，超类的变化会对子类产生副作用也就不足为奇了。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2008-11-10T17:34:20.110

不需要，但很有用。

每种语言都有自己的方法来编写更少的代码。OOP 有时会令人费解，但我认为这是开发人员的责任，OOP 平台在使用得当时是有用的和敏锐的。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2008-11-10T17:56:22.560

我同意其他所有人关于必要/有用区别的看法。

我喜欢 OOP 的原因是因为它让我可以编写更简洁、更有逻辑组织的代码。最大的好处之一是能够“分解”许多类共有的逻辑。我可以给你具体的例子，OOP 已经严重降低了我的代码的复杂性，但这对你来说会很无聊。

我只想说，我很高兴。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2008-11-10T17:59:25.660

绝对需要？不，但是想想灯。您可以在每次制作时从头开始创建一个新灯，或者您可以从原始灯中获取属性，并制作各种新样式的灯，它们与原始灯具有相同的属性，每种都有自己的风格。

或者你可以从头开始制作一盏新灯，或者告诉人们以某种​​方式看待它以看到光，或者，或者，或者

不是必需的，但很好:)

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2008-11-10T22:19:31.173

感谢大家的回答。我坚持我的立场，严格来说，不需要继承，尽管我相信我对这个特性有了新的认识。

其他：在我的工作经验中，我发现继承在项目后期引入时会导致更简单、更清晰的设计，因为它注意到很多类有很多共性并且你创建了一个基类。在从一开始就创建宏模式的项目中，在继承层次结构中有很多类，重构通常是痛苦和困难的。

看到一些提到类似内容的答案让我想知道这是否可能不是应该如何使用继承：事后。让我想起了 Stepanov 的名言：“你不是从公理开始的，而是在拥有一堆相关证明之后才得到公理”。他是个数学家，所以他应该知道一些事情。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2010-01-05T16:20:04.877

接口最大的问题是它们不能被改变。公开一个接口，然后更改它（向它添加一个新方法）并在全世界打破数百万个应用程序，因为他们已经实现了您的接口，但没有实现新方法。该应用程序甚至可能无法启动，VM 可能会拒绝加载它。

使用其他程序员可以继承的基类（非抽象类）（并根据需要覆盖方法）；然后向它添加一个方法。每个使用你的类的应用程序仍然可以工作，这个方法不会被任何人覆盖，但是由于你提供了一个基本实现，这个方法将被使用，它可能适用于你的类的所有子类......它可能也会导致奇怪的行为，因为有时覆盖它是必要的，好吧，可能是这种情况，但至少世界上所有那些数以百万计的应用程序仍然会启动！

我宁愿让我的 Java 应用程序在将 JDK 从 1.6 更新到 1.7 后仍然运行，但有一些小错误（可以随着时间的推移而修复），而不是根本不运行它（强制立即修复，否则对人们毫无用处）。

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2013-03-30T17:34:20.887

//我发现这个 QA 非常有用。许多人都回答了这个问题。但我想补充...

1：能够定义抽象接口——例如，为插件开发者。当然，你可以使用函数指针，但这样更好更简单。

2：继承有助于模型类型非常接近它们的实际关系。有时在编译时会发现很多错误，因为您拥有正确的类型层次结构。例如，`shape <-- triangle`（假设有很多代码要重用）。您可能想用一个`shape`对象组成三角形，但`shape`它是一个不完整的类型。插入虚拟实现`double getArea() {return -1;}`就可以了，但是您正在为错误打开空间。总有一天`return -1`会被执行的！

3：`void func(B* b); ... func(new D());`隐式类型转换提供了极大的方便，因为`Derived` *is* `Base`。我记得读过 Straustrup 说他想让类成为一等公民，就像基本数据类型一样（因此重载运算符等）。从 Derived 到 Base 的隐式转换就像从数据类型到更广泛兼容的类​​型（短到 int）的隐式转换一样。

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2016-11-07T18:32:52.160

**继承**和**组合**各有利弊。

请参阅有关继承的优点和组合的缺点的相关 SE 问题。

[更喜欢组合而不是继承？](https://stackoverflow.com/questions/49002/prefer-composition-over-inheritance/39635299#39635299)

查看此[文档链接](https://docs.oracle.com/javase/tutorial/java/IandI/polymorphism.html)中的示例：

该示例显示了通过使用继承作为实现多态性的手段来覆盖的不同用例。

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2008-11-10T17:49:49.890

在下文中，继承用于为同一类型事物的所有几个特定化身呈现特定属性。在这种情况下，GeneralPresenation 具有与所有“表示”（传递给 MVC 视图的数据）相关的属性。母版页是唯一使用它的东西，并且需要 GeneralPresentation，尽管特定视图需要更多信息，根据他们的需要量身定制。

```
 public abstract class GeneralPresentation
    {
        public GeneralPresentation()
        {
            MenuPages = new List<Page>();
        }
        public IEnumerable<Page> MenuPages { get; set; }
        public string Title { get; set; }
    }

    public class IndexPresentation : GeneralPresentation
    {
        public IndexPresentation() { IndexPage = new Page(); }
        public Page IndexPage { get; set; }
    }

    public class InsertPresentation : GeneralPresentation
    {
        public InsertPresentation() { 
          InsertPage = new Page(); 
          ValidationInfo = new PageValidationInfo(); 
        }
        public PageValidationInfo ValidationInfo { get; set; }
        public Page InsertPage { get; set; }
    } 
```

# ms-office - ms office 文件扩展名

> ID：278481
> 
> 赞同：6
> 
> 时间：2008-11-10T17:00:45.060
> 
> 标签：ms-office, file-association

前段时间我有一个发现。只需按照以下步骤操作：

在 office 2003 中创建一个 .doc/.xls/.ppt 文件。在其中保留一些测试数据并关闭该文件。现在重命名文件以将其文件扩展名更改为随机字符串，注意它是未关联的，例如 test.asdfghjkl 等。双击该文件，它会在父应用程序中无缝打开。

现在 AFAIK，Windows 检查文件的文件扩展名并使用它来执行操作，即打开应用程序并将文件传递给它以打开。那么办公套件是如何做到这一点的呢？

编辑：扩展名更改为与另一个应用程序相关联的情况如何。是否有处理该问题的优先级算法？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-10T17:06:31.990

你有“查看已知类型的扩展”选项吗？

编辑：@Comments....是的，这是一个愚蠢/侮辱性的问题，但是在解决问题时，我学会了什么都不做，并且信任用户 0%。

但是，我试过了，你是对的。MS有这种行为是愚蠢的，它只能导致安全漏洞，这导致我搜索你的答案。

[来自http://seclists.org/fulldisclosure/2007/Jan/0444.html](http://seclists.org/fulldisclosure/2007/Jan/0444.html)的帖子

> “您偶然发现了 Windows 一个古老的古怪行为。Office 文档格式基于标准的 Windows 容器格式、OLE 结构化存储文件，也称为“docfiles”。docfile 的名称和扩展名无关紧要 - 文件是，从概念上讲，OLE 对象的序列化，并且像所有序列化格式一样，它包含生成它的应用程序的标识符，在这种情况下以 OLE 类 ID（GUID 格式）的形式。您可以轻松验证它没有不能使用较新的 Office XML 格式”

确实它不适用于 2007 *X 文件类型，但 2K3 仍然是个问题。为了解决这个问题...升级！=)

这里是TOC 第 2 点下[的安全焦点。](http://www.securityfocus.com/infocus/1874)

所以，你去吧。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-11T02:08:03.147

我现在似乎无法做到这一点，但我知道几年前我看到[Windows 阅读 XML 处理指令。](http://nedbatchelder.com/blog/200506/windows_shell_reads_xml_processing_instructions.html)也许这就是正在发生的事情？

# algorithm - 查找数组中最常见的条目

> ID：278488
> 
> 赞同：26
> 
> 时间：2008-11-10T17:02:42.653
> 
> 标签：algorithm, language-agnostic, time-complexity

^(给定一个长度为 2 32)的 32 位无符号整数数组，对于某些 32 位无符号整数 N，该数组中超过一半的条目等于 N。查找 N 查看每个数字在数组中只使用一次，最多使用 2 kB 的内存。

您的解决方案必须是确定性的，并保证找到 N。

* * *

## 回答 #1

> 赞同：61
> 
> 时间：2008-11-10T17:13:27.750

为每一位保留一个整数，并为数组中的每个整数适当地增加此集合。

最后，一些位的计数将高于数组长度的一半——这些位决定了 N。当然，计数将高于 N 发生的次数，但这没关系。重要的是，任何不属于 N 的位*不能*出现超过一半的次数（因为 N 有超过一半的条目）并且任何属于 N 的位*必须*出现超过一半的时间（因为它会发生每次出现 N 时，以及任何额外内容）。

（目前没有代码 - 即将失去网络访问权限。但希望以上内容足够清楚。）

* * *

## 回答 #2

> 赞同：43
> 
> 时间：2008-11-10T18:22:16.860

[Boyer 和 Moore 的“线性时间多数投票算法”](http://www.cs.utexas.edu/users/moore/best-ideas/mjrty/index.html) ——沿着数组向下走，保持你当前对答案的猜测。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-11-11T02:55:45.170

你可以只用两个变量来做到这一点。

```
public uint MostCommon(UInt32[] numberList)
{
    uint suspect = 0;
    int suspicionStrength = -1; 
    foreach (uint number in numberList)
    {
        if (number==suspect)
        {
            suspicionStrength++;
        }
        else
        {
            suspicionStrength--;
        }

        if (suspicionStrength<=0)
        {
            suspect = number;
        }
    }
    return suspect;
} 
```

将第一个数字设为可疑数字，然后继续循环遍历列表。如果数字匹配，则将怀疑强度增加一；如果不匹配，则将怀疑强度降低1。如果怀疑强度达到 0，则当前号码成为怀疑号码。这将*无法*找到最常见的数字，只能找到超过该组 50% 的数字。抵制添加检查是否`suspicionStrength`大于列表长度的一半的冲动 - 它总是会导致更多的总比较。

PS 我没有测试过这个代码 - 使用它需要您自担风险。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-11-10T17:37:51.303

乔恩算法的伪代码（记事本 C++ :-)）：

```
int lNumbers = (size_of(arrNumbers)/size_of(arrNumbers[0]);

for (int i = 0; i < lNumbers; i++)
  for (int bi = 0; bi < 32; bi++)
    arrBits[i] = arrBits[i] + (arrNumbers[i] & (1 << bi)) == (1 << bi) ? 1 : 0;

int N = 0;

for (int bc = 0; bc < 32; bc++)
  if (arrBits[bc] > lNumbers/2)
    N = N | (1 << bc); 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2015-05-29T17:58:11.780

请注意，如果序列`a0, a1, . . . , an−1`包含一个领导者，那么在删除一对不同值的元素后，剩余的序列仍然具有相同的领导者。事实上，如果我们删除两个不同的元素，那么其中只有一个可能是领导者。新序列中的领导者出现超过`n/2 − 1`=`(n−2)/2` 次。因此，它仍然是新`n − 2`元素序列的领导者。

这是一个 Python 实现，时间复杂度为 O(n)：

```
def goldenLeader(A):
    n = len(A)
    size = 0
    for k in xrange(n):
        if (size == 0):
            size += 1
            value = A[k]
        else:
            if (value != A[k]):
                size -= 1
            else:
                size += 1
    candidate = -1
    if (size > 0):
        candidate = value
    leader = -1
    count = 0
    for k in xrange(n):
        if (A[k] == candidate):
            count += 1
    if (count > n // 2):
        leader = candidate
    return leader 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2016-03-27T04:02:12.407

这是流算法中的一个标准问题（您有一个巨大的（可能是无限的）数据流），您必须从这个流中计算一些统计数据，通过这个流一次。

* * *

显然，您可以通过散列或排序来处理它，但是对于潜在的无限流，您显然会耗尽内存。所以你必须在这里做一些聪明的事情。

* * *

**多数元素是出现超过数组大小一半的元素**。这意味着多数元素出现的次数比所有其他元素的总和还要多，或者如果您计算出现的次数，多数元素出现，然后减去所有其他元素的数量，您将得到一个正数。

因此，如果您计算某个元素的数量，并减去所有其他元素的数量并得到数字 0 - 那么您的原始元素不能是多数元素。这如果是正确算法的基础：

*有两个变量，计数器和可能元素。迭代流，如果计数器为 0 - 您覆盖可能的元素并初始化计数器，如果数字与可能的元素相同 - 增加计数器，否则减少它。*Python代码：

```
def majority_element(arr):
    counter, possible_element = 0, None
    for i in arr:
        if counter == 0:
            possible_element, counter = i, 1
        elif i == possible_element:
            counter += 1
        else:
            counter -= 1

    return possible_element 
```

很明显，该算法`O(n)`之前的常数非常小`O(n)`（如 3）。看起来空间复杂度也是`O(1)`，因为我们只初始化了三个变量。问题是这些变量之一是一个计数器，它可能会增长到`n`（当数组包含相同的数字时）。并存储`n`您需要`O(log (n))`空间的号码。所以**从理论的角度来看**，它是`O(n)`时间和`O(log(n))`空间。**从实际来看**，您可以在一个 longint 中放入 2^128 个数字，而数组中的这个元素数量是难以想象的巨大。

另请注意，该算法仅在存在多数元素时才有效。如果这样的元素不存在，它仍然会返回一些数字，这肯定是错误的。（很容易修改算法来判断多数元素是否存在）

历史频道：这个算法是 1982 年由 Boyer, Moore 发明的，被称为[Boyer-Moore 多数投票算法](https://en.wikipedia.org/wiki/Boyer%E2%80%93Moore_majority_vote_algorithm)。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-10T18:04:52.840

我记得这个算法，它可能遵循也可能不遵循 2K 规则。它可能需要用堆栈等重写以避免因函数调用而打破内存限制，但这可能是不必要的，因为它只有对数的此类调用。无论如何，我对大学有模糊的回忆，或者对此涉及分而治之的递归解决方案，秘密是当你将组分成两半时，至少有一半的一半以上的值等于最大值. 划分时的基本规则是返回两个候选的最高值，其中一个是最高值，其中一个是其他值（可能是也可能不是第二位）。我忘记了算法本身。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-12T22:37:20.777

buti-oxa / Jason Hernandez 答案的正确性证明，假设 Jason 的答案与 buti-oxa 的答案相同，并且两者都按照所描述的算法应该工作的方式工作：

如果选择了最高值，我们将调整后的怀疑强度定义为等于怀疑强度，如果没有选择最高值，我们将其定义为 - 怀疑强度。每次选择正确的数字，当前调整的怀疑强度增加1。每次选择错误的数字，它要么下降1，要么增加1，具体取决于当前是否选择了错误的数字。因此，最小可能的结束调整怀疑强度等于 number-of[top values] - number-of[other values]

# asp.net - 与 DataSet 模型相比，XML 数据模型有哪些优势？

> ID：278507
> 
> 赞同：1
> 
> 时间：2008-11-10T17:07:59.867
> 
> 标签：asp.net, xml, data-structures, data-modeling, presentation-model

在我目前的工作中，我们有一个基于 .NET/SQL Server 的 CMS 系统。在为一些内部使用定制几个模块时，我有点惊讶地发现，API 没有通过绑定到 DataGrid/DataList/Repeater 控件的典型结果集返回数据，而是返回 XML节点/集合，然后将其传递给 XSLT 转换并以这种方式呈现在页面上。

使用这样的模型有什么好处？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-10T17:12:02.633

使用 XSLT 转换将使您能够使用与标准 .Net 网格控件不同的布局和格式。有些人不赞成使用 .Net 网格，因为它们可以包含比必要更多的 HTML，而且如果不仔细管理，它们可能会使 ViewState 膨胀。

最近有一个关于 .Net 网格是英国媒体报道（但开发人员仍然使用它们）的[讨论。](https://stackoverflow.com/questions/16963/who-actually-uses-datagridgridviewformviewetc-in-production-apps#212346)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-10T17:13:06.657

输出的页面可以是任何类型，如 html、php 等。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-10T17:24:16.620

通过设置页面仅转换的数据源和 xml，您还立即创建了一个可以被其他软件使用的简单“Web 服务”。例如，将那个网格变成一个 RSS 提要或编写一个程序来定期抓取该数据并发送更紧迫的警报将是微不足道的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-10T17:25:19.847

XSLT 方法非常 MVC、单元测试、单独关注友好，而 ASP.NET 控制良好......不是。

警告：我拒绝 MS 可以编写比我更好的 html/css/js 的假设。ASP.NET 控件是笨重的可憎之物。

# c# - Using DataAdapter .Update to insert/upd rows in dataset (not based on DBs PK) problem

> ID：278518
> 
> 赞同：1
> 
> 时间：2008-11-10T17:13:04.380
> 
> 标签：c#, dataset, dataadapter

I have a batch process that reads data from multiple tables into a dataset based on a common key. I then build a second dataset of the destination data querying on the same key.

At this point I have two Datasets that are structurally identical (from a table/column layout perspective). I then have a process that adds any row that exists in source to the destination dataset. In addition, the process will attempt to update certain columns based on the common key as well.

The problem seems to come in when the DataAdapter.UPDATE command is called with existing rows that it needs to update. Error: System.InvalidOperationException was unhandled Message="The table specified in the SELECT statement does not contain a unique key or identifier column, or the SELECT statement does not include all of the key columns."

Since I have no way of controlling what the PK is on the destination DB, is there a way to tell the Adapter what the key is for this particular update? I have "custom" set the primary keys for each DataTable in the Dataset.

This is a non user interfacing batch process and its perf requirements are quite low. (to explain the use of datasets, etc)

Any Thoughts?

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-18T08:14:30.690

分析数据库并查看正在触发哪些查询。从 Profiler 复制查询并尝试手动执行它们。如果它们失败了，那么问题出在 sql 上，错误来自 db，只是被传递给您的应用程序。

这至少应该告诉你问题是否是由于数据库中缺少真正的 PK 引起的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-10T17:17:08.287

您必须像以前一样为数据集中的每个表设置 PK。我认为适配器没有办法自己弄清楚PK是什么。如果有并且有人知道，我会全神贯注。

# c# - 读取 MSMQ 事务死信队列

> ID：278524
> 
> 赞同：1
> 
> 时间：2008-11-10T17:15:13.033
> 
> 标签：c#, .net, msmq

我正在尝试使用 C#.NET 读取 MSMQ 中的事务性交易信队列，并且得到：

> 工作组安装电脑不支持操作

对于 10 个堆栈溢出点，我做错了什么？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-10T19:56:54.457

试试这个格式名，看看它是否有效：

```
@"FORMATNAME:DIRECT=OS:.\SYSTEM$;DeadXact" 
```

# sql-server - SQL CE Merge Replication: Error 28532: A read operation from the transport returned no data

> ID：278525
> 
> 赞同：1
> 
> 时间：2008-11-10T17:15:15.170
> 
> 标签：sql-server, replication, sql-server-ce, handheld

I am using sql server 2005 and ce framework 3.5 and attempting to use merge replication between my hand held and my sql server. I am getting the following error:

Error 28532 : A read operation from the transport returned no data. The version of SQL Server Compact 3.5 Client Agent and SQL Server Compact 3.5 Server Agent should match.

I am finding little to no information on the net. Can anyone tell me either how to check the versions of Server Compact 3.5 Client Agent and SQL Server Compact 3.5 Server Agent or any steps i can take to resolve the issue ?

Thanks Loads Cheryl

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-10T17:48:20.800

这（可能）与您的特定错误无关，但一般来说，SqlCE 和 SQL Server 之间的合并复制在网络连接经常丢失的情况下（例如通过无线或更糟，通过手机网络）是不可靠的，并且不仅可能导致丢失的数据，但奇怪地损坏了服务器上的数据。这个问题（据我所知）在 SqlCE 3.5 中没有得到解决。

当然，MS 没有宣传这一点，尽管经过长时间的努力来诊断问题，他们的技术支持最终承认了这个问题，并说 SqlCE 副本数据库*最终*保证会合并（即，如果你尝试同步足够多的时间，它*最终会*正常工作）。

# 3d - 将变换应用于 3D 模型 - 法线 pb

> ID：278528
> 
> 赞同：1
> 
> 时间：2008-11-10T17:16:14.920
> 
> 标签：3d, geometry, transform

我正在尝试将转换应用于 STL 文件中的 3D 对象（不创建结构化网格对象）。以下是我的操作步骤：我在 STL 文件中一一读取法线和面信息，将我的变换应用于每个顶点和面法线，然后将新的计算值写回另一个 STL 文件中。生成的文件中的顶点正常，但我的法线错误。似乎我不能像对顶点一样将变换应用于法线。这怎么可能？？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-10T18:34:37.833

你应该看看[转换法线](http://www.cs.berkeley.edu/~ug/slide/pipeline/assignments/backfacecull.shtml#planes)。

实际上，杰夫，你只说对了一部分。对于矢量，你是对的。但是对于一个法线，它的含义有点不同，你必须通过上面的 3x3 进行变换，然后反转，然后转置。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-10T19:27:54.607

您可以对两者应用几乎相同的转换，但请记住以下两点：

*   法线是方向，因此不应应用 4x4 矩阵的位置部分。为了避免应用它，您可以在与矩阵相乘之前将向量格式化为 Vector(x,y,z,0)，或者使用专用的 TransformVector() 函数来避免指令最终与零相乘。
*   如果您应用的矩阵包含比例，您的法线也会被缩放，这意味着，如果您执行典型的 NL 照明点积，您的结果将比应有的更亮或更暗。通常，您希望在应用变换后重新归一化，或确保变换不会对法线进行反归一化（这就是矩阵的反转置的用途。）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-10T17:22:26.717

变换向量与变换点不同——不能应用变换，只能应用旋转。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-10T19:40:57.763

> 引用 Rodrigo Lopez：法线是方向，因此不应该真正应用 4x4 矩阵的位置部分，尽管**重整化无论如何都会修复它**。

重整化不会解决它：假设法线是 (1,0,0) 然后用 (-2,0,0) 翻译它 => 法线将是 (-1,0,0) 这是规范化的并且是错误的，因为法线应该保持不变。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-11-10T19:12:27.243

您需要将矩阵的反转置应用于法线，而不是使用原始矩阵。

此外，在转换法线时，您需要将法线的 w 坐标视为 0（而不是点的 1）。

# search - 应该影响决定使用哪个搜索专有数据的搜索引擎之间的主要区别是什么？

> ID：278535
> 
> 赞同：2
> 
> 时间：2008-11-10T17:19:06.193
> 
> 标签：search, lucene.net, requirements, dtsearch

搜索引擎（DtSearch、Lucene.net、Sphinx、Google 等）之间的主要区别是什么，它们应该会影响决定使用哪个来搜索专有数据？

要搜索的数据由无显示数据组成，这些数据以名称/值对的形式使用元数据进行标记。我们对各种工具的格式解析能力不感兴趣。此外，搜索结果需要是结构良好、无显示的数据，可以与来自其他（类似结构的存储库）的搜索结果进行聚合。

下面列出了一些需要告知决策的相关搜索引擎特征。欢迎进一步的建议或经验描述。

• 成本 • 易于使用 • 可以配置为仅返回特定标签 • 可以“识别”特定术语，为这些结果提供更高的搜索结果权重 • 快速 < 0.3 秒返回搜索结果或 %E6 记录/文档 • 支持带有类型的标签（find weather='sunny' 但不是personality=sunny） • 支持权重以提供相关性排名 • 按相关性排序返回结果 • 支持同义词 • 支持词干提取 • 支持停用词 • 支持拼写更正 • 适合并行化或索引构建（如果基于索引） • 快速重新索引（如果基于索引） • 快速更新索引（如果基于索引） • 合并来自多个索引的结果（如果基于索引） • 接近度检查：与找到的靠近在一起的单词提供更高的相关性

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-21T05:10:06.777

我喜欢 Solr 和 DataImportHandler。它支持您的大部分要点，并且设置起来并不难，只要您不介意编辑一些 XML 配置文件。它比许多企业级搜索引擎更容易。

GSA（Google Search Appliance）没有任何问题，但对于您想要的控制量，Solr 是一个更好的选择。

[Lucene/Solr](http://lucene.apache.org/solr)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-14T09:44:38.270

关于相关性，Google Search Appliance 允许进行一些调整。他们认为允许过多的调整会导致相关性变差，我相信谷歌知道相关性。

用户不太可能会发现 Google 以外的搜索引擎更易于使用。

# powershell - 是否可以从过滤器中终止或停止 PowerShell 管道

> ID：278539
> 
> 赞同：16
> 
> 时间：2008-11-10T17:20:17.877
> 
> 标签：powershell, pipeline

我编写了一个简单的 PowerShell 过滤器，如果它的日期在指定的开始日期和结束日期之间，它会将当前对象推送到管道中。管道中的对象总是按日期升序排列，所以只要日期超过指定的结束日期，我就知道我的工作已经完成，我想告诉管道上游命令可以放弃他们的工作，以便管道可以完成它的工作。我正在阅读一些非常大的日志文件，并且我经常只想检查日志的一部分。我很确定这是不可能的，但我想问一下。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2015-06-19T17:29:19.090

可以使用任何会破坏外部循环或完全停止脚本执行（如抛出异常）的东西来破坏管道。然后解决方案是将管道包装在一个循环中，如果您需要停止管道，您可以中断该循环。例如，以下代码将返回管道中的第一项，然后通过中断外部 do-while 循环来中断管道：

```
do {
    Get-ChildItem|% { $_;break }
} while ($false) 
```

这个功能可以包装成这样的函数，其中最后一行完成与上面相同的事情：

```
function Breakable-Pipeline([ScriptBlock]$ScriptBlock) {
    do {
        . $ScriptBlock
    } while ($false)
}

Breakable-Pipeline { Get-ChildItem|% { $_;break } } 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-10T17:31:58.493

无法从下游命令停止上游命令。它将继续过滤掉与您的条件不匹配的对象，但第一个命令将处理它设置为处理的所有内容。

解决方法是对上游 cmdlet 或函数/过滤器进行更多过滤。使用日志文件会使事情变得更加复杂，但也许使用 Select-String 和正则表达式来过滤掉不需要的日期可能对您有用。

除非您知道要取多少行以及从哪里取，否则将读取整个文件以检查模式。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2012-03-19T08:09:58.643

结束管道时可以抛出异常。

```
gc demo.txt -ReadCount 1 | %{$num=0}{$num++; if($num -eq 5){throw "terminated pipeline!"}else{write-host $_}} 
```

或者

查看有关如何终止管道的帖子：[https ://web.archive.org/web/20160829015320/http://powershell.com/cs/blogs/tobias/archive/2010/01/01/cancelling-a -管道.aspx](https://web.archive.org/web/20160829015320/http://powershell.com/cs/blogs/tobias/archive/2010/01/01/cancelling-a-pipeline.aspx)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-10T20:00:24.323

不确定您的确切需求，但可能值得您花时间查看[Log Parser](http://www.microsoft.com/downloads/details.aspx?FamilyID=890cd06b-abf8-4c25-91b2-f8d975cf8c07&displaylang=en)，看看您是否不能在数据到达管道之前使用查询来过滤数据。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2016-02-19T18:26:22.203

如果您愿意使用非公共成员，这是一种停止管道的方法。它模仿了什么`select-object`。`invoke-method`（别名`im`）是调用非公共方法的函数。`select-property`(alias `selp`) 是一个选择（类似于 select-object）非公共属性的函数 - 但是`-ExpandProperty`如果只找到一个匹配的属性，它会自动运行。（我写的`select-property`和`invoke-method`工作的，所以不能分享那些的源代码）。

```
# Get the system.management.automation assembly
$script:smaa=[appdomain]::currentdomain.getassemblies()|
         ? location -like "*system.management.automation*"
# Get the StopUpstreamCommandsException class 
$script:upcet=$smaa.gettypes()| ? name -like "*StopUpstreamCommandsException *"

function stop-pipeline {
    # Create a StopUpstreamCommandsException
    $upce = [activator]::CreateInstance($upcet,@($pscmdlet))

    $PipelineProcessor=$pscmdlet.CommandRuntime|select-property PipelineProcessor
    $commands = $PipelineProcessor|select-property commands
    $commandProcessor= $commands[0]

    $ci = $commandProcessor|select-property commandinfo
    $upce.RequestingCommandProcessor | im set_commandinfo @($ci)

    $cr = $commandProcessor|select-property commandruntime
    $upce.RequestingCommandProcessor| im set_commandruntime @($cr)

    $null = $PipelineProcessor|
        invoke-method recordfailure @($upce, $commandProcessor.command)

    if ($commands.count -gt 1) {
      $doCompletes = @()
      1..($commands.count-1) | % {
        write-debug "Stop-pipeline: added DoComplete for $($commands[$_])"
        $doCompletes += $commands[$_] | invoke-method DoComplete -returnClosure
      }
      foreach ($DoComplete in $doCompletes) {
        $null = & $DoComplete
      }
    }

    throw $upce
} 
```

* * *

编辑：根据 mklement0 的评论：

这是“poke”模块上脚本上的 Nivot ink 博客的[链接](http://www.nivot.org/blog/post/2013/04/24/PowerShell-A-Peek-at-the-Poke-Module)，该模块同样允许非公共成员访问。

至于其他评论，我目前没有有意义的评论。这段代码只是模仿了反编译所`select-object`揭示的内容。原始的 MS 注释（如果有的话）当然不在反编译中。坦率地说，我不知道函数使用的各种类型的目的。获得这种程度的理解可能需要大量的努力。

我的建议：获取 Oisin 的 poke 模块。调整代码以使用该模块。然后尝试一下。如果你喜欢它的工作方式，那么就使用它，不要担心它是如何工作的（这就是我所做的）。

注意：我没有深入研究“poke”，但我猜它没有类似`-returnClosure`. 但是添加应该很容易，因为：

```
if (-not $returnClosure) {
  $methodInfo.Invoke($arguments)
} else {
  {$methodInfo.Invoke($arguments)}.GetNewClosure()
} 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2016-01-16T22:01:28.170

这是一个不完美的`Stop-Pipeline`cmdlet 实现（需要 PS v3+），非常感谢地改编自[这个答案](https://stackoverflow.com/a/16968855/45375)：

```
#requires -version 3
Filter Stop-Pipeline {
  $sp = { Select-Object -First 1 }.GetSteppablePipeline($MyInvocation.CommandOrigin)
  $sp.Begin($true)
  $sp.Process(0)
}

# Example
1..5 | % { if ($_ -gt 2) { Stop-Pipeline }; $_ } # -> 1, 2 
```

**警告**：我不完全理解它是如何工作的，尽管它从根本上利用了`Select -First`' 过早停止管道的能力（PS v3+）。`Select -First`但是，在这种情况下，终止管道的方式有一个关键区别：***下游*cmdlet（管道中*稍后*的命令）没有机会运行它们的`end`块。**
因此，**聚合 cmdlet**（必须在生成输出之前接收*所有*输入的命令，例如`Sort-Object`、`Group-Object`和`Measure-Object`）**如果稍后放置在同一管道中，则不会生成输出**；例如：

```
# !! NO output, because Sort-Object never finishes.
1..5 | % { if ($_ -gt 2) { Stop-Pipeline }; $_ } | Sort-Object 
```

* * *

**可能导致更好解决方案的背景信息：**

感谢[PetSerAl](https://stackoverflow.com/users/4003407/petseral)，我[在这里的回答](https://stackoverflow.com/a/34800670/45375)显示了如何产生相同的异常，该异常在`Select-Object -First`内部使用来停止上游 cmdlet。

*但是，从本身连接到要停止的管道*的 cmdlet 内部抛出异常，这里不是这种情况：

`Stop-Pipeline`，如上面示例中使用的，*没有*连接到应该停止的管道（只有封闭的`ForEach-Object`( `%`) 块是），所以问题是：如何在目标管道的上下文中抛出异常？

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-10T18:52:37.127

试试这些过滤器，它们会强制管道在第一个对象（或前 n 个元素）之后停止，并将其存储在一个变量中；您需要传递变量的名称，如果您不将对象推出但不能分配给变量。

```
filter FirstObject ([string]$vName = '') {
 if ($vName) {sv $vName $_ -s 1} else {$_}
 break
}

filter FirstElements ([int]$max = 2, [string]$vName = '') {
 if ($max -le 0) {break} else {$_arr += ,$_}
 if (!--$max) {
  if ($vName) {sv $vName $_arr -s 1} else {$_arr}
  break
 }
}

# can't assign to a variable directly
$myLog = get-eventLog security | ... | firstObject

# pass the the varName
get-eventLog security | ... | firstObject myLog
$myLog

# can't assign to a variable directly
$myLogs = get-eventLog security | ... | firstElements 3

# pass the number of elements and the varName
get-eventLog security | ... | firstElements 3 myLogs
$myLogs

####################################

get-eventLog security | % {
 if ($_.timegenerated -lt (date 11.09.08) -and`
  $_.timegenerated -gt (date 11.01.08)) {$log1 = $_; break}
}

#
$log1 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-16T18:46:48.393

另一种选择是在语句中使用`-file`参数。`switch`using`-file`将一次读取文件一行，您可以使用`break`立即退出而不读取文件的其余部分。

```
switch -file $someFile {
  # Parse current line for later matches.
  { $script:line = [DateTime]$_ } { }
  # If less than min date, keep looking.
  { $line -lt $minDate } { Write-Host "skipping: $line"; continue }
  # If greater than max date, stop checking.
  { $line -gt $maxDate } { Write-Host "stopping: $line"; break }
  # Otherwise, date is between min and max.
  default { Write-Host "match: $line" }
} 
```

# c# - 自动压缩多个 MP3 的最佳过程

> ID：278540
> 
> 赞同：1
> 
> 时间：2008-11-10T17:20:18.890
> 
> 标签：c#, asp.net, zip, amazon-s3

我有一个项目需要一个相当复杂的过程，我想确保我知道最好的方法来做到这一点。我正在使用带有 Adob​​e Flex 3 的 ASP.net C#。应用程序服务器是 Mosso（云服务器），文件存储服务器是 Amazon S3。现有网站可在[NoiseTrade.com上查看](https://www.noisetrade.com)

我需要这样做：

*   允许用户将 MP3 文件上传到专辑“小部件”
*   用户上传他们的专辑/小部件后，我需要自动压缩 mp3（供其他用户下载）并将 zip 与 mp3 曲目一起上传到 Amazon S3

我实际上已经有这个工作了（在 Flex 中使用客户端处理），但是由于 Adob​​e 的 flash 10“安全”更新，这不再工作了。所以现在我需要实现这个服务器端。

我正在考虑这样做的方式是：

*   将 mp3 存储在应用服务器上的临时文件夹中
*   当艺术家“发布”时，使用 ac# 库在该文件夹中创建文件的 zip
*   启动 amazon S3 上传过程（zip 和 mp3s）并在完成后向用户发送电子邮件（以及删除临时文件夹）

我看到这种方法的主要问题是，如果用户稍后删除或添加曲目，我将不得不更新 zip 文件，但临时文件将不再存在。

我不知道最好的方法来做到这一点，如果你有任何建议，我将不胜感激。

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-10T17:29:09.340

如果用户添加或删除曲目，则有关更新 zip 但没有临时文件的一点让我怀疑您想要构建包含多个曲目的 zip，可能是完整的专辑。如果这是不正确的，并且您只是将一个 mp3 放入每个 zip，那么 StingyJack 是正确的，您最终可能会通过压缩文件（稍微）*更大*而不是更小。

如果我的解释是正确的，那么你很幸运。命令行 zip 工具通常具有可用于将文件添加到现有 zip 存档或从现有 zip 存档中删除文件的标志。您没有说明您使用哪个库或其他方法进行压缩，但我希望它也可能具有此功能。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-10T17:22:20.710

MP3 被压缩。为什么要拉上拉链？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-10T17:23:50.893

我会说没有必要压缩压缩文件格式，你只需要减少 5% 的文件大小，给予或接受一点。Mp3 本质上并没有真正压缩，而是已经压缩了大部分可能的数据。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-04T04:47:33.933

[DotNetZip](http://www.codeplex.com/DotNetZip)可以压缩来自 C#/ASP.NET 的文件。我同意之前关于 MP3 可压缩性的海报。DotNetZip 将自动*跳过*MP3 上的压缩，并仅存储文件，正是出于这个原因。除了压缩之外，使用 zip 作为打包/存档容器仍然可能很有趣。

如果您稍后更改 zip 文件（用户添加曲目），您可以从 S3 获取 .zip 文件，然后更新它。DotNetZip 也可以更新 zip 文件。但在这种情况下，您必须支付进出 S3 的传输费用。

DotNetZip 可以通过在内存中处理 zip 来完成所有这些工作——尽管这对于具有大量 MP3 和大量并发用户的大型档案来说可能是不可行的。

# ajax - 重新加载页面而不将其提交回服务器

> ID：278542
> 
> 赞同：1
> 
> 时间：2008-11-10T17:22:10.743
> 
> 标签：ajax, jsp, struts, tags

我遇到的问题是我在下拉列表中有两组值。如果选择了“A”类型，我希望用数据库中的值填充文本框并且是只读的。如果选择类型“B”，则该框为空且可编辑。

我的原始代码是用 jsp/struts 编写的，我通过使用实现了这一点

`onchange="javascript:submit()"`重新加载页面，但这有一个明显的缺点，即保存您所做的任何更改，这意味着您无法真正取消。

由于这种方法，我在服务器端验证方面也有其他问题。

有没有办法让 jsp 页面在更改时重新加载，这样我可以编写 javascript 来根据会话中保存的值更改页面的外观。这样，只有在正确填写页面并且服务器端验证将按设计工作时才会调用保存/提交功能。

我知道这是 AJAX 擅长做的事情，但如果可能的话，我会尽量避免它。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-10T17:32:28.087

我的朋友，AJAX 是您唯一的其他选择，除非在原始页面加载时加载文本框的所有其他可能值，这样您就不需要返回数据库。好吧，您可以尝试将文本框放在 IFRAME 中，但是使用这种方法可能会遇到比仅使用 AJAX 更多的问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-11T05:23:45.233

I know a taglib that can fit to your problem: [AjaxTags](http://ajaxtags.sourceforge.net/). I use this taglib in my J2EE projects and it is very simple to integrate it into web applications.

This taglib give you several tags designed to execute AJAX request in your jsp files.

Here is the description of each tags: [http://ajaxtags.sourceforge.net/usage.html](http://ajaxtags.sourceforge.net/usage.html)

The tag which will help you is the ajax:select tag. It allows you to populate a select tag which depends on an other field without reloading the entire jsp page.

If you more informations about it, ask me and i'll try to answer quicky.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-13T13:13:31.690

如果我对您的理解正确，您是否想要一个下拉菜单 ( `<select>`) 或一个文本字段 ( `<input type="text">`)，具体取决于表单上方某处的选择（通常是复选框或单选按钮）？

在这种情况下，您可能需要在服务器上以不同的方式处理这两种类型的输入，那么为什么不在表单区域中同时使用具有不同名称和 id 的选择框和文本字段，其中一个是隐藏的（`display = none`）。然后在选择更改时切换可见性。在服务器上，您选择选择框或文本区域输入（除非您也禁用（`disabled="disabled"`）它们，否则两者都会出现，我认为这是不必要的）取决于选择输入。

当然，如果您期望用户通常只需要文本输入，并且只需要几次，则需要大量列表；最好使用 ajax 来检索列表。但是，如果它是相反的方式（你只需要偶尔的文本字段），正如我上面假设的那样，将两者都以初始形式出现会更快。

如果下拉列表仅包含易于生成的数据，例如从现在到数百年前，使用 Javascript 中的 for 循环生成数据客户端甚至可能更快（在服务器上需要更少的带宽）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-15T16:51:26.567

按照斯特林德豪格所说的，但如果你需要动态数据：

能否让后端将JS写入页面，然后JS根据需要更改表单？后端可以传播一些用于描述等的变量，然后 JS 可以相应地更改/更新表单。如果你不熟悉这个，像[jQuery](http://jquery.com/ "jQuery")这样的库比rolling-your-own（至少以我的经验）更容易和跨浏览器。

旁白：如果您不使用 AJAX，因为它很难编码（因为我有一段时间没有使用 AJAX，因为我的第一次体验是从零开始，并不漂亮），正如其他人所说，像[MooTools](http://mootools.net/ "MooTools")之类的库可以做到现在真的很容易。此外，正确使用 AJAX 并不丢人。它的名声很差，因为人们用它做愚蠢的事情，但是如果您不能简单地将预制值写入表单或者您必须进行实时查找，这是 AJAX 的正确用途之一。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-10T17:35:39.263

如果没有 AJAX，您所要求的将是困难的。另一种选择（这很丑陋）是将第二个列表框的所有可能值写入数组或字典之类的数据结构中。

然后编写一些 javascript 以在用户从第一个列表框中选择时从数据结构中获取值。完成这项工作并以跨浏览器的方式正确完成工作需要编写大量的 javascript，这比简单地使用 AJAX 困难得多。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-10T17:45:57.387

不知道为什么在当今世界你会尝试避免 AJAX，今天的 JS 库让它变得如此简单以至于不尝试它是疯狂的。

我只需要替换文森特指出的那样写的页面。考虑到 4 年前数据的相对大小，我认为当时它对应用程序是有意义的。现在应用程序已经扩展了，页面重复解析数据结构需要超过 30 秒（可能是写得不好的 JS？也许）。

我用一个非常简单的对 servlet 的 AJAX 调用替换了所有逻辑，该 servlet 只是根据传递给它的内容返回第二个下拉列表值的 JSON 响应，并且响应基本上是即时的。

祝你好运。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-10T20:13:59.630

一种方法是更改​​表单的操作，以便将表单提交到与“保存”网址不同的网址。这使您可以重新加载表单的某些方面并返回到表单本身，而不是提交数据。

```
<script>
  function reload() {
    document.forms[0].action="reloadFormData.jsp";
    document.forms[0].submit();
  }
</script>
<form action="saveData.jsp" method="post">
  <select id="A" name="B" onchange="reload()"><!-- blah --></select>
  <select id="B" name="B"><!-- blah B --></select>
  <input type="submit">
</form> 
```

# git - 如何更新包含子模块的 git repo？

> ID：278564
> 
> 赞同：5
> 
> 时间：2008-11-10T17:28:09.590
> 
> 标签：git, git-submodules

过了一段时间，我想更新我的 git repo，然后出了点问题。摆脱这种情况的正确方法是什么？

```
mblsha@siruba:~/src/psi/ $ git status
iris: needs merge
# On branch master
# Changes to be committed:
#   (use "git reset HEAD <file>..." to unstage)
#
#   modified:   src/common.cpp
#
# Changed but not updated:
#   (use "git add <file>..." to update what will be committed)
#
#   unmerged:   iris
#
# Untracked files:
#   (use "git add <file>..." to include in what will be committed)
#
#   gupdate.sh
mblsha@siruba:~/src/psi/ $ git submodule status
+cf237ef8f3d9dc058dbde47e6973e6388608ce60 iris (heads/master)
+cf237ef8f3d9dc058dbde47e6973e6388608ce60 iris (heads/master)
+cf237ef8f3d9dc058dbde47e6973e6388608ce60 iris (heads/master)
mblsha@siruba:~/src/psi/ $ cd iris 
mblsha@siruba:~/src/psi/iris/ $ cat .git/HEAD 
cf237ef8f3d9dc058dbde47e6973e6388608ce60 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-20T18:18:37.233

说到 git 子模块，你遇到的几乎所有问题都可以通过以下方式解决：

```
1\. deleting the submodule (rm -r iris)
2\. recreating it again (git submodule update) 
```

显然，如果您对子模块进行了本地更改，这将永久删除它们，因此如果您有本地更改，请确保您首先推送它们。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-07T15:41:48.630

我在 stackoverflow 上发布了一个类似的[问题](https://stackoverflow.com/questions/826715/how-do-i-manage-conflicts-with-git-submodules/835368#835368)，最后我自己回答了，但我发现 using 可以`git reset HEAD iris`解决我的子模块冲突问题。

# php - 清理 URL 变量的整洁方法？

> ID：278571
> 
> 赞同：2
> 
> 时间：2008-11-10T17:30:13.847
> 
> 标签：php, security, sanitization

我想知道在我使用它们之前是否有一个快速简便的函数来清理我的 url 中的 get 变量。（或者 $_POST 想到它......）

我想我可以使用正则表达式来替换不允许的字符，但我很想听听人们用什么来做这种事情？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-10T18:02:19.570

清理输入的概念对我来说从来没有多大意义。它基于某些类型的输入是危险的假设，但实际上不存在危险输入这样的东西；只是错误处理输入的代码。

它的罪魁祸首是，如果您将变量嵌入某种字符串（代码）中，然后由任何类型的解释器评估，**您必须确保该变量被正确转义**。例如，如果您在 SQL 语句中嵌入了一个字符串，那么您必须引用和转义该字符串中的某些字符。如果您在 URL 中嵌入值，则必须使用[`urlencode`](http://www.php.net/urlencode). 如果在 HTML 文档中嵌入字符串，则必须使用[`htmlspecialchars`](http://www.php.net/htmlspecialchars). 等等等等。

尝试预先“清理”数据是一种注定失败的策略，因为您无法知道 - 在这一点上 - 数据将在哪个上下文中使用。PHP 臭名昭著的[magic_quotes](http://www.php.net/magic_quotes)反特性就是一个很好的例子被误导的想法。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-10T17:45:46.403

我使用 PHP[输入过滤器](http://us2.php.net/manual/en/function.filter-input.php)和函数[urlencode](http://php.net/urlencode)。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-10T17:47:55.900

正则表达式可能会有所帮助，而且 PHP 5.2.0 还引入了一个完整的[过滤器](http://php.net/filter)扩展，专门用于以不同方式过滤输入变量。

很难推荐一个单一的解决方案，因为输入变量的性质是如此……多变。:-)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-11T06:11:40.847

我使用下面的方法来清理 MYSQL 数据库使用的输入。总而言之，通过 foreach 遍历 $_POST 或 $_GET 数组，并通过 DBSafe 函数传递每个 $_POST 或 $_GET 以清理它。DBSafe 可以很容易地修改为数据变量的其他用途（例如 HTML 输出等）。

```
// 迭代 POST 数组，将每个数组传递给 DBSafe 函数以清理数据
foreach ($_POST as $key => $PostVal) {

  // 将 POST 变量转换为常规变量
  $$key=DBSafe($PostVal);

  // 使用上述语句保持 POST 或 GET 数组不变，并使用新的单个变量
  // 或者，使用下面来更新 POST 或 GET 数组变量

  // 更新 POST 变量
  $_POST[$key]=DBSafe($PostVal);
}

函数 DBS​​afe($InputVal) {
// 返回数据库更新的 MySQL 安全值。未加引号的数值；空输入为 NULL；转义的“单引号”字符串值；

  if (is_numeric($InputVal)) {
    返回 $InputVal;
  } 别的 {
    // 根据服务器 PHP 和 MySQL（即 magic_quotes）设置，可能不需要 escape_string。如果需要，请在下面取消注释。
    // $InputVal=mysql_escape_string($InputVal);
    $InputVal=(!$InputVal?'NULL':"'$InputVal'");
    返回 $InputVal;
  }
}

```

# sql-server - 为什么 SSRS 会忽略 Web 方法返回的某些列中的数据？

> ID：278588
> 
> 赞同：3
> 
> 时间：2008-11-10T17:35:07.597
> 
> 标签：sql-server, web-services, soap, reporting-services

我正在使用 Reporting Services 2005 中的 XML 数据源功能，但在丢失数据时遇到了一些问题。当一行中的第一列没有值时，SSRS 似乎忽略了整列！

web方法请求很简单：

```
<Query>
   <Method Name="GetIssues" 
Namespace="http://www.mycompany.com/App/">
   </Method>
   <SoapAction>http://www.mycompany.com/App/GetIssues</SoapAction>
   <ElementPath IgnoreNamespaces="true">*</ElementPath>
</Query> 
```

同样，响应非常简单：

```
<?xml version="1.0" encoding="utf-8"?>
<soap:Envelope xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema">
  <soap:Body>
    <GetIssuesResponse xmlns="http://www.mycompany.com/App/">
      <GetIssuesResult>
        <Issue>
          <Title>ABC</Title>
          <RaisedBy />
          <Action>Do something</Action>
        </Issue>
        <Issue>
          <Title>ABC</Title>
          <RaisedBy>Jeff Smith</RaisedBy>
          <Action>Do something</Action>
        </Issue>
      </GetIssuesResult>
    </GetIssuesResponse>
  </soap:Body>
</soap:Envelope> 
```

在此示例中，RaisedBy 列将完全为空。如果“问题”被颠倒，那么 RaisedBy 首先有一个值，就没有问题。有任何想法吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-10T17:53:16.687

在查询本身中，尝试明确定义您的列，而不是让 SSRS 为您确定它们。

换句话说，你有：

```
<ElementPath IgnoreNamespaces="true">*</ElementPath> 
```

将 * 替换为以下内容：

```
<ElementPath IgnoreNamespaces="true">GetIssues/GetIssuesItemsResult/listitems/data/row{@Title,@RaisedBy,@Action}</ElementPath> 
```

当然，对于您的示例，确切的 XPath 可能不正确。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-10T17:45:07.733

是否可以消除 XML 中的 NULL？用空字符串替换它们？这样您就不必与 SSRS 搏斗了。

如果 XML 是从数据库调用生成的，那很容易做到（SQL Server 中的 ISNULL）。

# java - Maven中的依赖jar文件列表

> ID：278596
> 
> 赞同：98
> 
> 时间：2008-11-10T17:36:11.947
> 
> 标签：java, maven-2, dependencies, classpath

使用 Maven 2，有没有一种方法可以列出 jar 依赖项作为文件名？

```
mvn dependency:build-classpath 
```

可以列出 jar 文件，但这将包括它们在我的本地存储库中位置的完整路径。我需要的基本上只是一个文件名列表（或复制依赖目标复制的文件名）。

所以我需要的清单类似于

```
activation-1.1.jar,antlr-2.7.6.jar,aopalliance-1.0.jar etc... 
```

理想情况下，作为一个 Maven 属性，但我想，像 build-classpath 这样的文件可以生成。

我想要实现的是`Bundle-ClassPath`为 OSGi 包写入一个手动维护的 MANIFEST.MF 文件。（您不需要理解这一点来回答这个问题。）

澄清一下：问题**不**在于如何将清单标头写入 jar 中的 MANIFEST.MF 文件（这很容易 googleble）。我在问如何获取我想要写入的数据，即上面显示的列表。

* * *

## 回答 #1

> 赞同：116
> 
> 时间：2010-05-14T13:09:25.053

此命令将生成 maven 项目的依赖关系树：

```
$ mvn dependency:tree 
```

我相信你会喜欢这个结果:-)

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2018-03-30T18:52:08.110

实际上，对于 jar 的最终列表，只需使用

```
mvn dependency:list 
```

这比 dependency:tree 简单得多，因为它显示了详细的传递树和冲突解决方案（带有详细信息），所以简单地获取最终列表是一种过大的杀伤力。

这是[附加参数的文档](https://maven.apache.org/plugins/maven-dependency-plugin/list-mojo.html)

* * *

## 回答 #3

> 赞同：21
> 
> 时间：2009-04-02T06:06:03.363

据我所知，您无法获得准确的输出，只有逗号且没有空格。`pathSeparator`无论是通过命令行还是通过 pom.xml 文件，如果您指定空格或''（空字符串）作为替代，maven-dependency-plugin 或 CLI 都会崩溃`fileSeparator`。因此，您可能被迫达成某种妥协。你可以

```
    mvn 依赖：build-classpath -Dmdep.pathSeparator=":" -Dmdep.prefix='' -Dmdep.fileSeparator=":" -Dmdep.outputFile=classpath

```

但是，这应该会给你一个完整的列表，用 分隔`'::'`而不是 just `','`，但它确实有效。如果你运行：

```
    mvn 依赖：build-classpath -Dmdep.pathSeparator="@REPLACEWITHCOMMA" -Dmdep.prefix='' -Dmdep.fileSeparator="@" -Dmdep.outputFile=classpath

```

**并将**其附加到`generate-resources`阶段**并**稍后通过在生命周期的阶段中设置正确的属性来过滤该资源`process-resources`，您**应该**能够只获得逗号。

您可以在以下位置查看完整的选项列表：[http://maven.apache.org/plugins/maven-dependency-plugin/build-classpath-mojo.html](http://maven.apache.org/plugins/maven-dependency-plugin/build-classpath-mojo.html)

* * *

## 回答 #4

> 赞同：19
> 
> 时间：2017-11-24T13:50:46.280

这是您要的命令

```
$ mvn dependency:tree 
```

对于大型项目，它可以输出大量文本。我假设您要检查依赖关系树是否包含某个依赖关系，因此您不需要完整列表。

以下是在 Windows 上过滤输出的方法：

```
$ mvn dependency:tree | findstr javax.persistence 
```

以下是在 Linux 上的操作方法：

```
$ mvn dependency:tree | grep javax.persistence 
```

[过滤依赖树的](https://maven.apache.org/plugins/maven-dependency-plugin/examples/filtering-the-dependency-tree.html)Maven 方式（适用于 Windows cmd、MacOS 和 Linux shell）：

```
$ mvn dependency:tree -Dincludes=javax.persistence:* 
```

Maven方式（Windows PowerShell）：

```
$ mvn dependency:tree '-Dincludes=javax.persistence:*' 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-11-10T17:45:51.460

你看过[Apache Felix](http://felix.apache.org/site/index.html)项目吗？它有一大堆插件，包括一个应该做你想做的事情的[捆绑插件。](http://felix.apache.org/site/apache-felix-maven-bundle-plugin-bnd.html)

另外，您是否尝试过`<addClasspath>`带有 的标签`<manifestFile>`？这应该具有将类路径合并到清单中的预期效果。

```
<plugin>
  <groupId>org.apache.maven.plugins</groupId>
  <artifactId>maven-jar-plugin</artifactId>
  ...
  <configuration>
    <archive>
      <addClasspath>true</addClasspath>
      <manifestFile>src/main/resources/META-INF/MANIFEST.MF</manifestFile>
    </archive>
  </configuration>
  ...
</plugin> 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2010-01-09T01:05:55.643

我可能在这里遗漏了一些东西，但是由于您已经使用了复制依赖项，因此听起来您真正想要的只是指定目录中的文件列表。

Ant 可以毫无问题地为您做到这一点，shell 脚本也可以。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-11-10T17:44:10.400

Maven 可以自动在清单中构建类路径：[http ://maven.apache.org/guides/mini/guide-manifest.html](http://maven.apache.org/guides/mini/guide-manifest.html)

它是 Maven 存档插件的配置。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2013-08-16T00:24:19.457

为了给现有答案添加一个缺口，当前的 maven-dependency-plugin 允许将类路径保存到带有[`outputProperty`](http://maven.apache.org/plugins/maven-dependency-plugin/build-classpath-mojo.html#outputProperty)参数的属性中。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2019-09-02T11:06:44.057

这是一个用于管道的 awk 脚本`mvn dependency:list`：

```
mvn dependency:list | awk -f mvnfmt.awk 
```

如果`| sort`要按名称排序或`| tr '\n' ':'`将其格式化为类路径，则可以。

`mvnfmt.awk`是：

```
BEGIN {
    found = 0
}

/The following files have been resolved/ {
    found = 1
    next
}

/^\[INFO\] \$/ {
    print "Empty " found
    if (found != 0) found = 0
}

{
    if (!found) next
    n = split($0, a, " ")
    if (n != 2) {
        found = 0
        next
    }
    split(a[2], a, ":")
    print a[2] "-" a[4] "." a[3]
} 
```

# asp.net - 在 ASP.NET 中实现 WebControl 工厂

> ID：278604
> 
> 赞同：0
> 
> 时间：2008-11-10T17:39:54.293
> 
> 标签：asp.net, design-patterns, controls, factory

我需要在 ASP.NET 中实现经典的工厂方法模式来动态创建服务器控件。

我发现创建 .ascx 控件的唯一方法是使用 Page/UserControl 类的 LoadControl 方法。但是，我发现将我的工厂与页面链接或将页面参数传递给工厂很麻烦。

有谁知道创建此类控件的另一种方法（例如我忽略的某个静态方法）？

谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-10T19:23:43.523

最后，我决定将页面作为参数传递给工厂。为了更容易调用工厂方法，我将工厂类从单例更改为通用类，并将页面传递给构造函数：

```
public ControlsFactory
{
    private Page _containingPage;

    public ControlsFactory(Page containingPage)
    {
        _containingPage = containingPage;
    }

    public CustomControlClass GetControl(string type)
    {
        ... snip ...
        CustomControlClass result = (CustomControlClass)_containingPage.LoadControl(controlLocation);

        return result;
    }
} 
```

由于我必须使用工厂在每个页面上实例化许多控件，这可能是实现该模式的最简洁和可用的方式。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-10T18:17:12.533

打开反射器之后，Page 中使用的 LoadControl 功能在任何 TemplateControl 中都可用。

在实际的 LoadControl 内部使用 BuildManager 中的内部方法，所以我认为没有办法在不使用反射的情况下使用静态方法。

好吧，至少您不需要传递页面。子类化 TemplateControl 会起作用。

# ruby - 从 URL 字符串中提取主机的 Ruby 代码

> ID：278622
> 
> 赞同：37
> 
> 时间：2008-11-10T17:45:47.403
> 
> 标签：ruby

我正在寻找一种方法来可靠地从 Ruby 中的 URL 字符串中提取主机名。

例如 [http://www.mglenn.com/directory](http://www.mglenn.com/directory) = www.mglenn.com 或 [http://www.mglenn.com?param=x](http://www.mglenn.com?param=x) = www.mglenn.com

* * *

## 回答 #1

> 赞同：76
> 
> 时间：2008-11-10T18:07:43.287

你可以尝试这样的事情：

```
require 'uri'

myUri = URI.parse( 'http://www.mglenn.com/directory' )
print myUri.host
# =>  www.mglenn.com 
```

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2012-08-08T20:20:19.337

```
URI("http://www.mglenn.com/directory").host 
```

# .net - 为什么我的网站项目不适应 .NET 3.5？

> ID：278627
> 
> 赞同：5
> 
> 时间：2008-11-10T17:47:00.223
> 
> 标签：.net, asp.net, .net-3.5, .net-2.0, web-site-project

我们已将我们的解决方案从 .NET 2.0 转换为 .NET 3.5。所有项目都转换得很好，除了网站项目，它仍然不明白我在使用“var”等时的意思。

我查看了 Web 项目的属性页，目标框架设置为“.NET Framework 3.5”。

还有其他想法吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-11T11:37:21.000

将以下内容添加到 web.config：

```
 <system.codedom>
    <compilers>
      <compiler language="c#;cs;csharp" extension=".cs" warningLevel="4"
                type="Microsoft.CSharp.CSharpCodeProvider, System, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089">
        <providerOption name="CompilerVersion" value="v3.5"/>
        <providerOption name="WarnAsError" value="false"/>
      </compiler>
    </compilers>
  </system.codedom> 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-10T17:57:04.057

默认情况下，3.5 中的新 Web 应用程序具有以下参考：

*   系统 System.Configuration
*   系统核心
*   系统数据
*   System.Data.DataSetExtensions
*   系统绘图
*   System.EnterpriseServices
*   系统.Web
*   System.WebExtensions
*   System.Web.Mobile
*   系统.Web.服务
*   系统文件
*   System.Xml.Linq

此外，在 web.config 文件中，您会在 web.config 文件顶部附近找到以下程序集信息：

```
 <assemblies>
      <add assembly="System.Core, Version=3.5.0.0, Culture=neutral, PublicKeyToken=B77A5C561934E089"/>
      <add assembly="System.Data.DataSetExtensions, Version=3.5.0.0, Culture=neutral, PublicKeyToken=B77A5C561934E089"/>
      <add assembly="System.Web.Extensions, Version=3.5.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35"/>
      <add assembly="System.Xml.Linq, Version=3.5.0.0, Culture=neutral, PublicKeyToken=B77A5C561934E089"/>
    </assemblies> 
```

您还将在文件底部找到运行时程序集绑定：

```
 <runtime>
      <assemblyBinding xmlns="urn:schemas-microsoft-com:asm.v1">
        <dependentAssembly>
          <assemblyIdentity name="System.Web.Extensions" publicKeyToken="31bf3856ad364e35"/>
          <bindingRedirect oldVersion="1.0.0.0-1.1.0.0" newVersion="3.5.0.0"/>
        </dependentAssembly>
        <dependentAssembly>
          <assemblyIdentity name="System.Web.Extensions.Design" publicKeyToken="31bf3856ad364e35"/>
          <bindingRedirect oldVersion="1.0.0.0-1.1.0.0" newVersion="3.5.0.0"/>
        </dependentAssembly>
      </assemblyBinding>
    </runtime> 
```

我敢打赌，没有所有这些引用会导致您的 var 声明出现问题。验证所有这些内容均已正确添加/创建。

# mysql - 如何在更新记录时保持 MySQL 存储过程中的变量值不发生变化？

> ID：278633
> 
> 赞同：4
> 
> 时间：2008-11-10T17:50:29.470
> 
> 标签：mysql, database, stored-procedures

我必须忽略一些简单的事情。我正在从 MySQL 存储过程中的查询结果中设置一个变量，如下所示：

```
SELECT @myName := username FROM User WHERE ID=1; 
```

因此，@myName 存储的是用户 ID 1 的用户名，即“Paul”。伟大的。

但稍后在存储过程中，我对此记录运行更新：

```
UPDATE User SET username = 'Fred' WHERE ID=1; 
```

现在，由于某种原因，@myName = 'Fred' 当它仍然应该等于 'Paul' 时，对吗？看起来 MySQL 只是在创建一个指向记录的指针，而不是在 @myName 变量中存储一个静态值。

所以简而言之，我希望能够将查询结果中的值存储在变量中，并确保我的变量的值不会改变，即使它设置的表中的数据发生了变化。

我错过了什么？提前致谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-10T18:10:26.247

这非常令人惊讶，我同意。我不知道如何解释它，但为了它的价值，试试这个：

```
SELECT username INTO myName FROM User WHERE ID=1; 
```

请参阅[http://dev.mysql.com/doc/refman/5.0/en/select-into-statement.html](http://dev.mysql.com/doc/refman/5.0/en/select-into-statement.html)

**更新：**我正在尝试重现此问题，但我不能。我在 Mac OS X 上使用 MySQL 5.0.51。

```
drop table if exists user;
create table user (
  id serial primary key,
  username varchar(10)
);
insert into user (username) values ('Paul');

drop procedure if exists doit;
delimiter !!
create procedure doit()
begin
  declare name varchar(10);
  select @name:=username from user where id=1;
  select @name; -- shows 'Paul' as expected
  update user set username = 'Fred' where id=1;
  select @name; -- still shows 'Paul'
end!!
delimiter ;

call doit(); 
```

您能否在您的测试数据库中尝试上面的代码，并让我们知道它是否存在您描述的问题？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-08-04T15:02:39.057

变量`@name`仍然具有值 Paul。如果要更新变量，则应分配新值：

```
drop procedure if exists doit;
delimiter !!
create procedure doit()
begin
  declare name varchar(10);
  select @name:=username from user where id=1;
  select @name; -- shows 'Paul' as expected
  update user set username = 'Fred' where id=1;
  select @name:=username from user where id=1; -- this will update the @name value
  select @name; -- shows 'Fred'
end!!
delimiter ;

call doit(); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-07-19T12:11:53.040

```
drop table if exists user;
create table user (
id serial primary key,
username varchar(10)
);
insert into user (username) values ('Paul');

drop procedure if exists doit;
delimiter !!
create procedure doit()
begin
declare name varchar(10);
select @name:=username from user where id=1;
select @name; -- shows 'Paul' as expected

set  @name = '' /*Initialize @name with '' and then get the result as you expected*/

update user set username = 'Fred' where id=1;
select @name; -- now you will get exepected results
end!!
delimiter ;

call doit(); 
```

问候， Jitendra Pasi。（Ugam）

# sql - 如何创建动态和安全的查询

> ID：278644
> 
> 赞同：6
> 
> 时间：2008-11-10T17:56:03.623
> 
> 标签：sql, database, dynamic

“静态”查询是始终保持不变的查询。例如，Stackoverflow 上的“标签”按钮，或 Digg 上的“7 天”按钮。简而言之，它们总是映射到特定的数据库查询，因此您可以在设计时创建它们。

但我试图弄清楚如何在用户基本上决定如何在运行时创建数据库查询的情况下进行“动态”查询。例如，在 Stackoverflow 上，您可以组合标签并以您选择的方式过滤帖子。这是一个动态查询，尽管它非常简单，因为您可以组合在标签的世界中。一个更复杂的例子是如果你可以结合标签和用户。

首先，当您有一个动态查询时，听起来您不能再使用替换 api 来避免 sql 注入，因为查询元素将取决于用户决定在查询中包含的内容。除了使用字符串追加之外，我看不到如何构建此查询。

其次，查询可能跨越多个表。例如，如果 SO 允许用户根据用户和标签进行过滤，并且这些可能存在于两个不同的表中，则构建查询比仅附加列和 WHERE 子句要复杂一些。

我该如何实施这样的事情？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-10T18:07:26.673

第一条规则是允许用户在 SQL 表达式中指定*值*，但不能在 SQL*语法*中指定值。所有查询语法都应该由您的代码指定，而不是用户输入。用户指定的值可以作为查询参数提供给 SQL。这是限制 SQL 注入风险的最有效方法。

许多应用程序需要通过代码“构建” SQL 查询，因为正如您所指出的，某些表达式、表连接、按条件排序等取决于用户的选择。当您逐段构建 SQL 查询时，有时很难确保结果是有效的 SQL 语法。

我研究了一个名为的 PHP 类[`Zend_Db_Select`](http://framework.zend.com/manual/en/zend.db.select.html)，它提供了一个 API 来帮助解决这个问题。如果您喜欢 PHP，您可以查看该代码以获取想法。它不处理任何可以想象的查询，但它做了很多。

其他一些 PHP 数据库框架也有类似的解决方案。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-10T18:27:16.010

虽然不是通用解决方案，但您可以采取一些步骤来缓解动态但安全的查询问题。

列值属于基数是任意值的一组值的条件不需要是动态的。考虑使用 instr 函数或使用您加入的特殊过滤表。只要知道列数，这种方法就可以很容易地扩展到多列。使用这种方法可以轻松处理对用户和标签的过滤。

当过滤条件中的列数是任意的但又很小时，请考虑对每种可能性使用不同的静态查询。

只有当过滤条件中的列数是任意的并且可能很大时，您才应该考虑使用动态查询。在这种情况下...

为了避免 SQL 注入，请构建或获取一个库来防御该攻击。虽然难度更大，但这并非不可能完成的任务。这主要是关于在要过滤的值中转义 SQL 字符串分隔符。

为了避免昂贵的查询，请考虑使用专门为此目的设计的视图和一些预先逻辑来限制这些视图将如何被调用。就开发人员的时间和精力而言，这是最具挑战性的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-10T18:01:17.420

那么选项必须映射到某些东西。

如果您仍然为选项使用参数，则SQL 查询字符串`CONCAT`不是问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-10T20:11:03.007

如果您使用 python 访问您的数据库，我建议您使用[Django 模型系统](http://docs.djangoproject.com/en/dev/topics/db/queries/)。对于 python 和其他语言（尤其是在 ruby​​ on rails 中），有许多类似的 api。通过避免使用 SQL 直接与数据库对话，我节省了很多时间。

从[示例链接](http://docs.djangoproject.com/en/dev/topics/db/queries/)：

```
#Model definition
class Blog(models.Model):
    name = models.CharField(max_length=100)
    tagline = models.TextField()

    def __unicode__(self):
        return self.name 
```

模型使用（这实际上是一个插入语句）

```
from mysite.blog.models import Blog
b = Blog(name='Beatles Blog', tagline='All the latest Beatles news.')
b.save() 
```

查询变得更加复杂 - 你传递一个查询对象，你可以向它添加过滤器/排序元素。当您最终准备好使用查询时，Django 会创建一个 SQL 语句来反映您调整查询对象的所有方式。我认为它很可爱。

这种抽象的其他优点

*   您的模型可以通过 Django 创建为具有外键和约束的数据库表
*   支持许多数据库（Postgresql、Mysql、sql lite 等）
*   DJango 分析您的模板并从中创建一个[自动管理站点](http://docs.djangoproject.com/en/dev/ref/contrib/admin/#ref-contrib-admin)。

# entity-framework - 如何通过 ADO.NET 数据服务 (Astoria) 调用作为实体框架函数导入公开的存储过程？

> ID：278647
> 
> 赞同：1
> 
> 时间：2008-11-10T17:56:23.403
> 
> 标签：entity-framework, stored-procedures, wcf-data-services

我创建了一个实体数据模型并导入了几个存储过程作为函数导入。我通过 ADO.NET 数据服务 (ANDS) 公开 EDM。ANDS 是否通过其 REST API 自动公开功能，还是我需要手动向服务添加操作？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-12T04:12:33.003

您将需要通过 ServiceOperation 公开存储过程。据我所知，到 FunctionImport 的所有映射都是通过 CurrentDataSource 在服务中使用。将其视为概念和商店之间的唯一链接。

# c# - Linq to XML：XElement.Save 到文件

> ID：278649
> 
> 赞同：3
> 
> 时间：2008-11-10T17:56:52.310
> 
> 标签：c#, xml, linq

使用 XElement.Save(filepath) 的正确方法是什么？我是否需要一直在 try/catch 块中调用它？它如何处理并发？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-10T18:03:42.857

例外：正常的策略 - 抓住任何你可以明智地处理的东西（这是相对罕见的），让其他任何东西冒泡。

并发性：我不希望 LINQ to XML 一开始就是线程安全的。如果您从多个线程更新相同的元素，请使用适当的锁定。

# javascript - 是否存在任何已知的 HTA 文件安全问题？

> ID：278651
> 
> 赞同：1
> 
> 时间：2008-11-10T17:57:43.713
> 
> 标签：javascript, security, hta

是否存在与通过 .hta 文件运行 Web 应用程序相关的任何已知安全问题。我对与 .hta 文件和框架相关的拖放问题特别感兴趣

见：[http ://sqlblogcasts.com/blogs/jonsayce/archive/2008/01/10/drag-and-drop-problems-in-hta-frames.aspx](http://sqlblogcasts.com/blogs/jonsayce/archive/2008/01/10/drag-and-drop-problems-in-hta-frames.aspx)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-10T18:03:20.160

我想这取决于您是指当前的（未修补的）漏洞，还是自首次引入 HTML 应用程序以来的漏洞？有关后者的示例，请参阅[此](http://www.google.com/search?hl=en&sa=X&oi=spell&resnum=0&ct=result&cd=1&q=vulnerability+ie+HTA&spell=1)Google 搜索。您还应该检查未来版本的 Windows/IE 是否仍将支持 HTA。

# java - Websphere 门户 6.1 入门

> ID：278654
> 
> 赞同：1
> 
> 时间：2008-11-10T17:59:01.277
> 
> 标签：java, jakarta-ee, websphere, portal

好的，我的公司是银行。高层管理人员在 websphere IBM 门户网站上死气沉沉。显然，IBM 正在向他们扔一块他们无法拒绝的骨头。无论如何，我们还是一家非常大的 IBM 商店，拥有大量的 LotusNotes 应用程序。

根据我在 IBM 的经验，它们通常会让你通过它们来学习他们的东西。我必须先跳起来，这样我才能向开发团队概述产品。我特别想寻找免费的门户开发资源。哎呀，你好世界门户会很好。此外，当我说门户时，这也包括 portlet。

另一个问题是我通过实践学得最好。有人可以指出我的免费试用链接或 websphere 门户的东西吗？真的，我只需要任何能让我用我需要为实际门户做的那种编码来沾沾自喜的东西。

欢迎以任何方式/形状/形式提出想法、评论和建议。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-10T18:45:43.787

查看 IBM[红皮书](http://www.redbooks.ibm.com/portals/websphere)和[在线帮助](http://www.ibm.com/developerworks/websphere/zones/portal/proddoc.html)以获取文档和开发指南。尝试[Rational Application Developer](http://www.ibm.com/developerworks/downloads/r/rad/)试用版的 portlet 开发——它带有 WPS 测试服务器。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-01-23T00:26:05.470

对我来说，这两个是非常好的 CMS 解决方案：

*   生命射线
*   露天

Liferay 是一个基于 Java 的开源门户。它已经支付了解决方案。Alfresco 只是一个 CMS 解决方案，但它具有社交应用程序和许多不错的内容管理功能。

老实说，我已经测试过 Liferay 和 WebSphere Portal（我是一名认证管理员）。Liferay 一开始似乎更有吸引力，但它缺少一些特性（至少是我使用的版本），这些特性会在部署过程中减慢你的速度。它从一开始就没有很多 portlet（你必须开发它们）

此外，如果您计划创建一个严重依赖定制和个性化的网站，Liferay 没有那么多支持。

WepSphere 门户对 SSO（单点登录）也有更好的支持，并且安全性更好（因为您是银行）

希望能帮助到你。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-10T20:06:03.127

如果我记得从我使用它的那一天起，RAD 就有一些用于 WPS 的示例“hello world”项目。您还可以[从这里导入示例 portlet](http://www.skywayradio.com/tech/WAS51/portal/wps/wpsbscfg.html)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-03-13T07:13:12.147

[在此处](http://www.ibm.com/developerworks/downloads/ls/wpe/)下载 IBM WebSphere Portal Express 60 天试用版。

IBM WebSphere Portal Express V8 在针对中小型企业的单一、易于部署的解决方案中提供应用程序集成、文档管理、Web 内容管理和协作功能。现在包括流行的社交功能，包括博客、wiki、标记和评级，以及更新的配置向导和增强的分析支持。

# user-interface - 什么时候应该在菜单项中使用省略号

> ID：278655
> 
> 赞同：11
> 
> 时间：2008-11-10T17:59:25.300
> 
> 标签：user-interface, coding-style, popupmenu

我什么时候应该把 ... 放在菜单项的末尾？我似乎记得读过一些规则，但我一生都找不到它们。

对于上下文-我正在向右键单击菜单添加一个属性选项，并且想知道添加它们是否合适。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-09-10T14:57:46.690

据我了解，这表明该选项会在实际执行任何操作之前询问您其他问题。这 3 个点实际上被称为省略号，如果您查看英语使用它是有道理的：

[http://en.wikipedia.org/wiki/Ellipsis](http://en.wikipedia.org/wiki/Ellipsis)

顺便说一句，我注意到 OpenOffice 有时会打破这个约定！

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-11-10T18:01:10.367

当该选项将用户发送到某种对话框时，用户必须在进行真正更改之前执行某些操作。没有椭圆的选项立即生效。

例如，“保存”没有省略号，而“另存为...”有，因为用户必须输入文件的新名称/位置。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-11-10T18:16:57.683

前两个答案的一个例外：如果菜单命令的全部**目的**是打开一个窗口或对话框，那么您不需要省略号。例如，“获取信息”或“属性”命令不应该有它，即使它正在打开一个允许您编辑内容的窗口。

仅当菜单命令的目的是执行其他操作时，它需要对话框或确认才能执行此操作。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-09-10T14:56:11.123

这意味着选择该选项后将出现另一个对话框，它实际上不会“做”任何事情。会有另一个提示。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-11-12T18:14:43.723

确切地说，规则是如果需要用户提供更多信息来完成操作，则包括省略号。在 MS Vista 用户体验指南中，获得确认相当于“更多信息”（参见[http://msdn.microsoft.com/en-us/library/aa511502.aspx](http://msdn.microsoft.com/en-us/library/aa511502.aspx)）。显示属性、关于、帮助、选项的命令没有省略号，因为执行该命令不需要更多信息，即“显示属性”或“显示文档”或“显示选项”。File Open 命令得到一个省略号，因为打开文件需要额外的信息，即文件名。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-01-30T16:32:01.717

如果菜单是用户将要执行的操作，但在我们从用户那里获得更多信息之前该操作不会完成，则显示省略号，例如：

*   格式化硬盘…（我们需要知道是哪一个，以及文件系统类型）
*   另存为...（我们需要知道要另存为的文件名和类型）
*   打印...（我们需要知道什么打印机和质量设置）
*   查找...（我们显示一个文本框，询问要搜索的文本以及搜索位置）
*   重命名...（重命名为什么）

与单击菜单项时将发生的操作相反，例如：

*   节省
*   撤消
*   重做
*   全选

省略号不仅仅表示将出现一个*对话框*。即，如果它不是“*动作*”，则没有省略号，例如：

*   关于小发明
*   页面设置
*   打印预览
*   选项
*   文件属性

并且询问用户是否想做某事并不能算作“从用户那里获取更多信息”，例如：

*   删除文件
*   回收文件
*   新建文本文档

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-11-10T18:01:40.570

Whenever selecting that item results in another dialog box appearing. 对于立即发生的操作（想想保存与另存为），没有省略号。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-09-10T15:21:39.050

*最初*，它的意思是：

> 菜单项后的省略号 (...) 表示选择该项后，在执行操作之前将要求用户提供更多信息。通常，用户必须填写一个对话框并单击“确定”按钮或其等效项。当出现的对话框仅仅是确认或警告时（例如，“退出前保存更改？”），不要使用省略号。

（Apple 人机界面指南，第 69 页）

请注意，这*并不*意味着“显示对话框”，即使这通常是这样做的结果。例如，在 Mac OS（不是 X）上，“页面设置”窗口中的“选项”按钮没有省略号，即使它显示的是模式对话框。没有使用省略号，因为显示选项窗口*是*操作。

（切换界面，第 46-47 页）

当然，现在没有人关心诸如人机界面指南之类的事情，甚至苹果也不在乎，所以你几乎可以做你想做的事情，并且仍然比大多数其他应用程序更一致。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-11-10T18:06:31.620

我通常在完成操作之前需要用户进行更多输入的地方看到它。如果您的属性对话框允许用户更改属性，我将包括省略号。如果它只是显示信息，请不要包含它。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-09-10T14:56:11.203

它们通常表示单击该条目将打开一个对话窗口。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-09-10T14:56:36.193

它通常意味着`Dialog`单击该项目时将显示a。

* * *

## 回答 #12

> 赞同：-2
> 
> 时间：2008-11-10T18:02:59.553

只有在截断文本时才应在文本末尾添加省略号（这适用于任何地方）。如果文本太长而无法合理地放置在您放置的位置，您应该截断文本。

编辑：有趣的是，我从未注意到**Windows 中的菜单使用省略号来表示被截断的文本，但也在短文本上使用省略号来表示在采取行动之前将收集更多信息**。 **这是不一致的界面设计**，但由于菜单是在个别程序员的控制之下，这是不可避免的。

* * *

## 回答 #13

> 赞同：-3
> 
> 时间：2009-09-10T15:02:35.460

这通常意味着它会将您的注意力从当前窗口移开。例如，记事本有一个“查找...”，这意味着您将专注于另一个窗口（即对话框）以输入内容。但在 Firefox 中，它只有“查找”，然后专注于同一窗口上的文本输入。

# asp.net-mvc - 是否可以基于子域创建 ASP.NET MVC 路由？

> ID：278668
> 
> 赞同：241
> 
> 时间：2008-11-10T18:04:23.170
> 
> 标签：asp.net-mvc, routing, asp.net-mvc-routing

是否可以有一个使用子域信息来确定其路由的 ASP.NET MVC 路由？例如：

*   ***user1*** *.domain.com*去一个地方
*   ***user2*** *.domain.com*转到另一个？

`username`或者，我可以让它们都使用参数进入同一个控制器/动作吗？

* * *

## 回答 #1

> 赞同：170
> 
> 时间：2009-02-12T14:30:49.993

您可以通过创建新路由并将其添加到 global.asax 中 RegisterRoutes 中的路由集合来实现。下面是一个非常简单的自定义路由示例：

```
public class ExampleRoute : RouteBase
{

    public override RouteData GetRouteData(HttpContextBase httpContext)
    {
        var url = httpContext.Request.Headers["HOST"];
        var index = url.IndexOf(".");

        if (index < 0)
            return null;

        var subDomain = url.Substring(0, index);

        if (subDomain == "user1")
        {
            var routeData = new RouteData(this, new MvcRouteHandler());
            routeData.Values.Add("controller", "User1"); //Goes to the User1Controller class
            routeData.Values.Add("action", "Index"); //Goes to the Index action on the User1Controller

            return routeData;
        }

        if (subDomain == "user2")
        {
            var routeData = new RouteData(this, new MvcRouteHandler());
            routeData.Values.Add("controller", "User2"); //Goes to the User2Controller class
            routeData.Values.Add("action", "Index"); //Goes to the Index action on the User2Controller

            return routeData;
        }

        return null;
    }

    public override VirtualPathData GetVirtualPath(RequestContext requestContext, RouteValueDictionary values)
    {
        //Implement your formating Url formating here
        return null;
    }
} 
```

* * *

## 回答 #2

> 赞同：55
> 
> 时间：2013-03-08T05:50:33.400

要**在保留标准 MVC5 路由功能的同时捕获子域**，请使用以下`SubdomainRoute`派生自`Route`.

此外，`SubdomainRoute`允许选择将子域指定为**查询参数**、制作`sub.example.com/foo/bar`和`example.com/foo/bar?subdomain=sub`等效项。这允许您在配置 DNS 子域之前进行测试。`Url.Action`查询参数（使用时）通过由等生成的新链接传播。

查询参数还可以使用 Visual Studio 2013 进行本地调试，而无需[使用 netsh 进行配置或以管理员身份运行](https://stackoverflow.com/a/14967651/145173)。默认情况下，IIS Express 仅在非提升时绑定到*localhost ；*它不会绑定到*sub.localtest.me*等同义主机名。

```
class SubdomainRoute : Route
{
    public SubdomainRoute(string url) : base(url, new MvcRouteHandler()) {}

    public override RouteData GetRouteData(HttpContextBase httpContext)
    {
        var routeData = base.GetRouteData(httpContext);
        if (routeData == null) return null; // Only look at the subdomain if this route matches in the first place.
        string subdomain = httpContext.Request.Params["subdomain"]; // A subdomain specified as a query parameter takes precedence over the hostname.
        if (subdomain == null) {
            string host = httpContext.Request.Headers["Host"];
            int index = host.IndexOf('.');
            if (index >= 0)
                subdomain = host.Substring(0, index);
        }
        if (subdomain != null)
            routeData.Values["subdomain"] = subdomain;
        return routeData;
    }

    public override VirtualPathData GetVirtualPath(RequestContext requestContext, RouteValueDictionary values)
    {
        object subdomainParam = requestContext.HttpContext.Request.Params["subdomain"];
        if (subdomainParam != null)
            values["subdomain"] = subdomainParam;
        return base.GetVirtualPath(requestContext, values);
    }
} 
```

`MapSubdomainRoute`为方便起见，从您的方法中调用以下方法，`RegisterRoutes`就像您使用普通的 old 一样`MapRoute`：

```
static void MapSubdomainRoute(this RouteCollection routes, string name, string url, object defaults = null, object constraints = null)
{
    routes.Add(name, new SubdomainRoute(url) {
        Defaults = new RouteValueDictionary(defaults),
        Constraints = new RouteValueDictionary(constraints),
        DataTokens = new RouteValueDictionary()
    });
} 
```

最后，为了方便地访问子域（从真正的子域或查询参数），创建具有此`Subdomain`属性的 Controller 基类会很有帮助：

```
protected string Subdomain
{
    get { return (string)Request.RequestContext.RouteData.Values["subdomain"]; }
} 
```

* * *

## 回答 #3

> 赞同：23
> 
> 时间：2010-04-27T18:22:52.860

这不是我的工作，但我不得不在这个答案中添加它。

这是一个很好的解决这个问题的方法。Maartin Balliauw 编写了创建 DomainRoute 类的代码，该类的使用与普通路由非常相似。

[http://blog.maartenballiauw.be/post/2009/05/20/ASPNET-MVC-Domain-Routing.aspx](http://blog.maartenballiauw.be/post/2009/05/20/ASPNET-MVC-Domain-Routing.aspx)

样品使用将是这样的......

```
routes.Add("DomainRoute", new DomainRoute( 
    "{customer}.example.com", // Domain with parameters 
    "{action}/{id}",    // URL with parameters 
    new { controller = "Home", action = "Index", id = "" }  // Parameter defaults 
)) 
```

;

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2013-09-10T19:33:46.597

要在使用**Web API**时捕获子域，请覆盖 Action Selector 以注入`subdomain`查询参数。然后在控制器的操作中使用子域查询参数，如下所示：

```
public string Get(string id, string subdomain) 
```

这种方法使调试方便，因为您可以在使用*localhost*而不是实际主机名时手动指定查询参数（有关详细信息，请参阅[标准 MVC5 路由答案](https://stackoverflow.com/a/15287579/145173)）。这是动作选择器的代码：

```
class SubdomainActionSelector : IHttpActionSelector
{
    private readonly IHttpActionSelector defaultSelector;

    public SubdomainActionSelector(IHttpActionSelector defaultSelector)
    {
        this.defaultSelector = defaultSelector;
    }

    public ILookup<string, HttpActionDescriptor> GetActionMapping(HttpControllerDescriptor controllerDescriptor)
    {
        return defaultSelector.GetActionMapping(controllerDescriptor);
    }

    public HttpActionDescriptor SelectAction(HttpControllerContext controllerContext)
    {
        var routeValues = controllerContext.Request.GetRouteData().Values;
        if (!routeValues.ContainsKey("subdomain")) {
            string host = controllerContext.Request.Headers.Host;
            int index = host.IndexOf('.');
            if (index >= 0)
                controllerContext.Request.GetRouteData().Values.Add("subdomain", host.Substring(0, index));
        }
        return defaultSelector.SelectAction(controllerContext);
    }
} 
```

通过将其添加到以下内容来替换默认的操作选择器`WebApiConfig.Register`：

```
config.Services.Replace(typeof(IHttpActionSelector), new SubdomainActionSelector(config.Services.GetActionSelector())); 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-11-10T18:13:16.427

是的，但您必须创建自己的路由处理程序。

通常，路由不知道域，因为应用程序可以部署到任何域，并且路由不会以一种或另一种方式关心。但是在您的情况下，您希望控制器和操作基于域，因此您必须创建一个知道域的自定义路由。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2017-10-17T17:08:17.127

我[为子域路由创建了库](https://github.com/mariuszkerl/AspNetCoreSubdomain)，您可以创建这样的路由。它目前适用于 .NET Core 1.1 和 .NET Framework 4.6.1，但将在不久的将来进行更新。它是这样工作的：
1) 在 Startup.cs 中映射子域路由

```
public void Configure(IApplicationBuilder app, IHostingEnvironment env, ILoggerFactory loggerFactory)
{
    var hostnames = new[] { "localhost:54575" };

    app.UseMvc(routes =>
    {
        routes.MapSubdomainRoute(
            hostnames,
            "SubdomainRoute",
            "{username}",
            "{controller}/{action}",
            new { controller = "Home", action = "Index" });
    )}; 
```

2) 控制器/HomeController.cs

```
public IActionResult Index(string username)
{
    //code
} 
```

3) 该库还将允许您生成 URL 和表单。代码：

```
@Html.ActionLink("User home", "Index", "Home" new { username = "user1" }, null) 
```

将生成`<a href="http://user1.localhost:54575/Home/Index">User home</a>` 生成的 URL 还将取决于当前主机位置和架构。
您还可以将 html 助手用于`BeginForm`和`UrlHelper`。如果您愿意，您还可以使用称为标签助手 ( `FormTagHelper`, `AnchorTagHelper`)的新功能，
该库还没有任何文档，但是有一些测试和示例项目，因此请随意探索。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2016-10-12T10:34:08.537

在**ASP.NET Core**中，主机可通过`Request.Host.Host`. 如果您想允许通过查询参数覆盖主机，请首先检查`Request.Query`.

要使主机查询参数传播到新的基于路由的 URL，请将此代码添加到`app.UseMvc`路由配置：

```
routes.Routes.Add(new HostPropagationRouter(routes.DefaultHandler)); 
```

并像这样定义`HostPropagationRouter`：

```
/// <summary>
/// A router that propagates the request's "host" query parameter to the response.
/// </summary>
class HostPropagationRouter : IRouter
{
    readonly IRouter router;

    public HostPropagationRouter(IRouter router)
    {
        this.router = router;
    }

    public VirtualPathData GetVirtualPath(VirtualPathContext context)
    {
        if (context.HttpContext.Request.Query.TryGetValue("host", out var host))
            context.Values["host"] = host;
        return router.GetVirtualPath(context);
    }

    public Task RouteAsync(RouteContext context) => router.RouteAsync(context);
} 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2015-06-19T08:10:33.577

*在定义了一个新的 Route 处理程序来查看在 URL 中传递的主机之后*，您可以采用一个基本控制器的想法，该控制器知道它正在被访问的站点。它看起来像这样：

```
public abstract class SiteController : Controller {
    ISiteProvider _siteProvider;

    public SiteController() {
        _siteProvider = new SiteProvider();
    }

    public SiteController(ISiteProvider siteProvider) {
        _siteProvider = siteProvider;
    }

    protected override void Initialize(RequestContext requestContext) {
        string[] host = requestContext.HttpContext.Request.Headers["Host"].Split(':');

        _siteProvider.Initialise(host[0]);

        base.Initialize(requestContext);
    }

    protected override void OnActionExecuting(ActionExecutingContext filterContext) {
        ViewData["Site"] = Site;

        base.OnActionExecuting(filterContext);
    }

    public Site Site {
        get {
            return _siteProvider.GetCurrentSite();
        }
    }

} 
```

`ISiteProvider`是一个简单的界面：

```
public interface ISiteProvider {
    void Initialise(string host);
    Site GetCurrentSite();
} 
```

我推荐你去 [卢克桑普森博客](http://blog.lukesampson.com/subdomains-for-a-single-application-with-asp-net-mvc)

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2016-10-05T22:35:37.720

如果您正在考虑为您的项目提供 MultiTenancy 功能，每个租户具有不同的域/子域，您应该看看 SaasKit：

[https://github.com/saaskit/saaskit](https://github.com/saaskit/saaskit)

代码示例可以在这里看到：http: [//benfoster.io/blog/saaskit-multi-tenancy-made-easy](http://benfoster.io/blog/saaskit-multi-tenancy-made-easy)

使用 ASP.NET 核心的一些示例：http: [//andrewlock.net/forking-the-pipeline-adding-tenant-specific-files-with-saaskit-in-asp-net-core/](http://andrewlock.net/forking-the-pipeline-adding-tenant-specific-files-with-saaskit-in-asp-net-core/)

编辑：如果您不想在 ASP.NET 核心项目中使用 SaasKit，您可以查看 Maarten 为 MVC6 实现的域路由：[https ://blog.maartenballiauw.be/post/2015/02/17/domain -routing-and-resolving-current-tenant-with-aspnet-mvc-6-aspnet-5.html](https://blog.maartenballiauw.be/post/2015/02/17/domain-routing-and-resolving-current-tenant-with-aspnet-mvc-6-aspnet-5.html)

然而，这些要点没有得到维护，需要进行调整才能与最新版本的 ASP.NET 核心一起使用。

直接链接代码：[https ://gist.github.com/maartenba/77ca6f9cfef50efa96ec#file-domaintemplateroutebuilderextensions-cs](https://gist.github.com/maartenba/77ca6f9cfef50efa96ec#file-domaintemplateroutebuilderextensions-cs)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2019-01-22T16:52:47.517

几个月前，我开发了一个将方法或控制器限制在特定域中的属性。

它很容易使用：

```
[IsDomain("localhost","example.com","www.example.com","*.t1.example.com")]
[HttpGet("RestrictedByHost")]
public IActionResult Test(){} 
```

您也可以直接在控制器上应用它。

```
public class IsDomainAttribute : Attribute, Microsoft.AspNetCore.Mvc.Filters.IAuthorizationFilter
{

    public IsDomainAttribute(params string[]  domains)
    {
        Domains = domains;
    }

    public string[] Domains { get; }

    public void OnAuthorization(AuthorizationFilterContext context)
    {
        var host = context.HttpContext.Request.Host.Host;
        if (Domains.Contains(host))
            return;
        if (Domains.Any(d => d.EndsWith("*"))
                && Domains.Any(d => host.StartsWith(d.Substring(0, d.Length - 1))))
            return;
        if (Domains.Any(d => d.StartsWith("*"))
                && Domains.Any(d => host.EndsWith(d.Substring(1))))
            return;

        context.Result = new Microsoft.AspNetCore.Mvc.NotFoundResult();//.ChallengeResult
    }
} 
```

限制：您可能无法在具有不同过滤器的不同方法上拥有两条相同的路由我的意思是以下可能会为重复路由引发异常：

```
[IsDomain("test1.example.com")]
[HttpGet("/Test")]
public IActionResult Test1(){}

[IsDomain("test2.example.com")]
[HttpGet("/Test")]
public IActionResult Test2(){} 
```

# java - 点网和 Java 文化代码

> ID：278674
> 
> 赞同：1
> 
> 时间：2008-11-10T18:08:14.130
> 
> 标签：java, .net, globalization, culture

我的任务是为我们的应用程序文化信息生成一个查找表。我需要为其生成数据的列是：

*   点网代码
*   版本
*   文化名称
*   国家的名字
*   语言名称
*   Java 国家代码
*   Java 语言代码
*   国家代码
*   语言代码

我找到了全球化名称空间，但我敢肯定有人问过同样的问题，或者已经有一个可用的表。

谢谢你的帮助

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-10T19:22:56.443

Java 使用 2 个字母的 ISO 国家和语言代码。我建议去掉查找表中的“Java Country Code”和“Java Language Code”字段，因为它们是多余的。

我假设无论您在哪里获得 ISO[国家](http://en.wikipedia.org/wiki/ISO_3166-1_alpha-2)和[语言](http://www.loc.gov/standards/iso639-2/php/code_list.php)代码，您都会找到相应的英文名称。但是，如果您需要，Java [Locale](http://java.sun.com/j2se/1.5.0/docs/api/java/util/Locale.html) API 还会为您提供国家和语言的本地化名称。（即，美国在日本叫什么？）

例如，您可以这样做：

```
Locale l = Locale.ITALY;
System.out.println(l.getDisplayCountry() + ": " + l.getDisplayLanguage());
System.out.println(l.getDisplayCountry(l) + ": " + l.getDisplayLanguage(l)); 
```

其中，在美国英语语言环境中运行打印：

```
Italy: Italian 
Italia: italiano 
```

请注意，您可以从 Locale 类中获取 3 个字母的 ISO 代码，但在构造它们时，请确保仅使用 2 个字母的代码。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-10T19:35:21.613

这很奇怪，我上次访问此页面时，有人殴打我发布指向本地化 Java 参考的链接。

但是，由于他们的帖子不见了，这就是我在他们击败我之前写的内容。

Java 使用两个 ISO 标准进行本地化[java,util.Locale](http://java.sun.com/javase/6/docs/api/java/util/Locale.html)。

*   用于语言的2 个字母[ISO-639 。](http://www.loc.gov/standards/iso639-2/php/English_list.php)
*   国家/地区的2 个字母[ISO-3166](http://www.iso.ch/iso/en/prods-services/iso3166ma/02iso-3166-code-lists/list-en1.html)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-10T19:26:03.333

Java 使用语言环境来存储这些信息。您需要的大部分信息都可以在 Sun 的[国际](http://java.sun.com/developer/technicalArticles/J2SE/locale/)化页面上找到。Java 使用类似于“en-us”语法的语法，但是它不是使用连字符而是用下划线来描述。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-10T19:26:26.310

我猜你的意思是本地化或国际化或 i18n。

试试这个教程：http:
    [//java.sun.com/docs/books/tutorial/i18n/index.html](http://java.sun.com/docs/books/tutorial/i18n/index.html)

祝你好运，兰迪·施泰格鲍尔

# php - 如何设置FCKEditor文件浏览器的默认位置？

> ID：278676
> 
> 赞同：1
> 
> 时间：2008-11-10T18:08:41.710
> 
> 标签：php, fckeditor

我正在处理[FCKEditor](http://www.fckeditor.net/)的图像上传部分，并且上传工作正常，但被服务器文件浏览器卡住了。

![FCKEditor 图像属性对话框](https://farm4.static.flickr.com/3184/3019956718_f7ab198c16.jpg?v=0)

您可以在上面的对话框中看到有一个**浏览服务器**按钮，它会弹出以下对话框

![FCKEditor 资源浏览器](https://farm4.static.flickr.com/3054/3019956722_712ae75d24.jpg?v=0)

问题是我不知道文件浏览器指向哪个文件夹。

我在 PHP 连接器 config.php 中设置了**UserFilePath**和**USerFilesAbsolutePath**来控制我的图像上传到哪里。

### 如何配置文件浏览器，使其开始指向我的上传文件所在的同一文件夹？

* * *

**编辑**

**ImageBrowserURL**属性*不是*我要找的。该属性用于使*浏览器服务器*按钮指向默认文件浏览器以外的其他位置。

我的问题是弄清楚如何将默认文件浏览器指向特定目录。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-12T16:34:42.863

请阅读[我](http://www.fckeditor.net/forums/viewtopic.php?f=6&t=10432)在 FCKeditor 论坛上的这篇文章。你有和我一样的问题吗？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-10T18:46:26.627

是这个吗？

ImageBrowserURL (string) 设置当用户单击“图像”对话框窗口中的“浏览服务器”按钮时调用的页面的 URL。通过这种方式，您可以创建与您的系统完美集成的自定义图像浏览器。

见[http://www.clinicaestet.ro/FCKeditor/_docs/contents/012.html](http://www.clinicaestet.ro/FCKeditor/_docs/contents/012.html)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-11T18:53:36.283

您需要为 FCKEditor 设置一些配置信息。这可以在网页中的 javascript 代码中完成，也可以在 FCKEditor 配置文件中完成，该文件通常位于 /fckeditor/fckconfig.js 文件中。如果您没有将 fckeditor 安装到典型的 fckeditor 目录，则需要将路径的那部分替换为正确的路径。

在 fckconfig.js 文件中，您需要将“ImageBrowserURL”设置更改为您想要的任何内容。

```
FCKConfig.ImageBrowserURL = '/myfilebrowserpath/browser.php' ; 
```

对话框将在此处查找您的文件。这是关于此的[FCKEditor 文档](http://docs.fckeditor.net/FCKeditor_2.x/Developers_Guide/Configuration/Configuration_Options/ImageBrowserURL)的链接。我希望这会有所帮助。

# c# - 如何在 C# 中创建表达式树来表示“String.Contains("term")”？

> ID：278684
> 
> 赞同：71
> 
> 时间：2008-11-10T18:11:28.677
> 
> 标签：c#, .net, lambda, expression-trees

我刚刚开始使用表达式树，所以我希望这是有道理的。我正在尝试创建一个表达式树来表示：

```
t => t.SomeProperty.Contains("stringValue"); 
```

到目前为止，我得到了：

```
 private static Expression.Lambda<Func<string, bool>> GetContainsExpression<T>(string propertyName, string propertyValue)
    {
        var parameterExp = Expression.Parameter(typeof(T), "type");
        var propertyExp = Expression.Property(parameter, propertyName);
        var containsMethodExp = Expression.*SomeMemberReferenceFunction*("Contains", propertyExp) //this is where I got lost, obviously :)
        ...
        return Expression.Lambda<Func<string, bool>>(containsMethodExp, parameterExp); //then something like this
    } 
```

我只是不知道如何引用 String.Contains() 方法。

帮助表示赞赏。

* * *

## 回答 #1

> 赞同：150
> 
> 时间：2008-11-10T18:20:29.080

就像是：

```
class Foo
{
    public string Bar { get; set; }
}
static void Main()
{
    var lambda = GetExpression<Foo>("Bar", "abc");
    Foo foo = new Foo { Bar = "aabca" };
    bool test = lambda.Compile()(foo);
}
static Expression<Func<T, bool>> GetExpression<T>(string propertyName, string propertyValue)
{
    var parameterExp = Expression.Parameter(typeof(T), "type");
    var propertyExp = Expression.Property(parameterExp, propertyName);
    MethodInfo method = typeof(string).GetMethod("Contains", new[] { typeof(string) });
    var someValue = Expression.Constant(propertyValue, typeof(string));
    var containsMethodExp = Expression.Call(propertyExp, method, someValue);

    return Expression.Lambda<Func<T, bool>>(containsMethodExp, parameterExp);
} 
```

您可能会发现[这](http://marcgravell.blogspot.com/2008/10/express-yourself.html)很有帮助。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2012-03-13T04:12:12.830

执行如下搜索：

```
ef.Entities.Where(entity => arr.Contains(entity.Name)).ToArray(); 
```

跟踪字符串将是：

```
SELECT .... From Entities ... Where Name In ("abc", "def", "qaz") 
```

我使用下面创建的方法：

```
ef.Entities.Where(ContainsPredicate<Entity, string>(arr, "Name")).ToArray();

public Expression<Func<TEntity, bool>> ContainsPredicate<TEntity, T>(T[] arr, string fieldname) where TEntity : class {
  ParameterExpression entity = Expression.Parameter(typeof(TEntity), "entity");
  MemberExpression member = Expression.Property(entity, fieldname);

  var containsMethods = typeof(Enumerable).GetMethods(BindingFlags.Static | BindingFlags.Public)
  .Where(m => m.Name == "Contains");
  MethodInfo method = null;
  foreach (var m in containsMethods) {
    if (m.GetParameters().Count() == 2) {
      method = m;
      break;
    }
  }
  method = method.MakeGenericMethod(member.Type);
  var exprContains = Expression.Call(method, new Expression[] { Expression.Constant(arr), member });
  return Expression.Lambda<Func<TEntity, bool>>(exprContains, entity);
} 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-07-15T06:34:12.410

这个怎么样：

```
Expression<Func<string, string, bool>> expFunc = (name, value) => name.Contains(value); 
```

在客户端代码中：

```
 bool result = expFunc.Compile()("FooBar", "Foo");   //result true
    result = expFunc.Compile()("FooBar", "Boo");        //result false 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2017-12-07T06:29:46.477

以下是如何创建 string.Contains 的表达式树。

```
var method = typeof(Enumerable)
    .GetRuntimeMethods()
    .Single(m => m.Name == nameof(Enumerable.Contains) && m.GetParameters().Length == 2);
var containsMethod = method.MakeGenericMethod(typeof(string));
var doesContain = Expression
.Call(containsMethod, Expression.Constant(criteria.ToArray()),
 Expression.Property(p, "MyParam")); 
```

[https://raw.githubusercontent.com/xavierjohn/Its.Cqrs/e44797ef6f47424a1b145d69889bf940b5581eb8/Domain.Sql/CatchupEventFilter.cs](https://raw.githubusercontent.com/xavierjohn/Its.Cqrs/e44797ef6f47424a1b145d69889bf940b5581eb8/Domain.Sql/CatchupEventFilter.cs)的实际用法

# rest - 版本控制 RESTful 服务？

> ID：278686
> 
> 赞同：11
> 
> 时间：2008-11-10T18:11:45.337
> 
> 标签：rest, versioning

我在[http://example.com/v1/SomeResource](http://example.com/v1/SomeResource)部署了一个 RESTful Web 服务。有一天，一个新的协议版本（**不向后兼容**）被部署到[http://example.com/v2/SomeResource](http://example.com/v2/SomeResource)。从客户端的角度来看，这种升级可能发生在两个 HTTP 请求之间的任何时间。

服务器如何向客户端表明它不再支持 v1 调用并且客户端应该升级到 v2？我可以使用适当的响应代码吗？

我想向客户提供以下信息：

1.  发生了不兼容的升级。客户端无法使用新服务，因为协议可能完全不同。
2.  新客户端软件的 URL。
3.  向用户解释他们必须升级的消息。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-26T12:55:05.290

我推荐彼得威廉姆斯的以下文章

*   [版本控制 REST Web 服务](http://barelyenough.org/blog/2008/05/versioning-rest-web-services/)

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-11-10T18:15:12.727

**最佳实践：**

最好将版本控制保留在 URL 之外，并使新资源与旧资源向后兼容。

**向后兼容：**

如果您必须在 URL 中保留 v1，并且正在制作 v2 URL，那么您必须决定是要支持这两种格式，还是要废弃旧的 v1。如果您决定废弃旧的 v1，那么我建议为任何请求 v1 URL 的人返回 303 或 401。

**使旧 URL 过时：**

我建议使用 303 See Other。或者，如果没有关联的重定向，则使用 410 Gone。

[来源](http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html)

> 303 查看其他
> 
> 可以在不同的 URI 下找到对请求的响应，并且应该使用该资源上的 GET 方法来检索。此方法的存在主要是为了允许 POST 激活脚本的输出将用户代理重定向到选定的资源。新的 URI 不是原始请求资源的替代引用。303 响应不能被缓存，但对第二个（重定向）请求的响应可能是可缓存的。
> 
> 不同的 URI 应该由响应中的 Location 字段给出。除非请求方法是 HEAD，否则响应的实体应该包含一个简短的超文本注释，其中包含指向新 URI 的超链接。
> 
> 注意：许多 HTTP/1.1 之前的用户代理不理解 303 状态。当与此类客户端的互操作性是一个问题时，可以使用 302 状态代码代替，因为大多数用户代理对 302 响应做出反应，如此处针对 303 所述。

**记录一切：**

要关心的主要事情是您选择返回的任何内容，只需将其记录在您的文档中即可。您可以决定您希望您的服务如何工作，其他想要使用它的人将遵循文档。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-10T20:39:58.970

我认为你不应该首先这样做，但可能为时已晚。

> URI 也应该是静态的，这样当资源更改或服务的实现发生更改时，链接保持不变。这允许添加书签。同样重要的是，在 URI 中编码的资源之间的关系保持独立于关系在其存储位置的表示方式。

来自文章[RESTful Web 服务：基础知识](http://www.ibm.com/developerworks/webservices/library/ws-restful/index.html?ca=drs-)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-10T18:27:26.197

我建议改用 301（301 永久移动）。阅读[为什么](http://www.bombaycrow.com/blog/index.php/2008/03/e-directing-web-content-for-seo-301-moved-permanently/)。

希望它有所帮助，布鲁诺·菲格雷多

# c# - List Clear() 方法是否会破坏子级 [C#.NET]？

> ID：278687
> 
> 赞同：5
> 
> 时间：2008-11-10T18:12:50.233
> 
> 标签：c#, .net, memory-management, recursion

如果我创建列表的递归列表：

```
class myList
{
  List<myList> childLists;
  List<string> things;

  //...
}

List<myList> tempList = new List<myList>(); 
```

然后稍后调用 tempList.Clear()，它会破坏内存中的所有 childList，还是我应该创建一个递归方法先清除所有 childList？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-11-10T18:14:51.713

如果不存在对子列表的*其他*引用，它们将像往常一样被垃圾收集。诀窍是注意对子项的任何悬空引用（数据绑定尤其容易在完成后被忽视）。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-10T19:25:09.667

您似乎来自 C++ 背景。

阅读[.NET 的垃圾收集](http://msdn.microsoft.com/en-us/library/0xy59wtx.aspx)应该为您清除很多东西。

在您的情况下，您不需要“销毁”所有子列表。事实上，您甚至无法以正常的良好实践 .NET 方式自行销毁或处置通用 List 对象。如果您不再希望使用它，那么只需删除对它的所有引用。对象的实际销毁将由垃圾收集器（又名 GC）在认为合适时完成。

GC 也非常聪明，它会检测循环引用和 a->b->c->d 对象树以及大多数你可以找到它并正确清理整个对象图的东西。因此，您无需创建递归清理例程。

但请注意，GC 的行为是不确定的，即您不知道实际的“清理”何时会发生，因此如果您的列表包含一些应该立即释放的重要资源，即文件句柄、数据库连接，那么您应该明确地“释放“正如@lassevk 推荐的那样。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-10T18:20:09.410

您不需要清除子列表。

您唯一需要做的就是如果列表中的对象实现 IDisposable，那么您应该遍历对象并在清除列表之前调用 .Dispose() 方法。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-12-17T11:03:46.367

您可以将列表对象设置为空！检查[http://social.msdn.microsoft.com/Forums/en/csharpgeneral/thread/31809230-83f6-4e86-9a33-ee7dc4ec2b10](http://social.msdn.microsoft.com/Forums/en/csharpgeneral/thread/31809230-83f6-4e86-9a33-ee7dc4ec2b10)

# perl - 当其中一个字段有换行符时，如何在 CSV 文件中加入行？

> ID：278692
> 
> 赞同：1
> 
> 时间：2008-11-10T18:14:58.513
> 
> 标签：perl, groovy, csv, newline

如果我有一个逗号分隔的文件，如下所示：

```
富，酒吧，n
，A B C D
一二三
，A B C D

```

我想加入`\n,`制作这个：

```
foo,bar,n,a,bc,d
一、二、三、a、bc、d

```

什么是正则表达式技巧？我以为 an`if (/\n,/)`会抓住这个。

另外，我需要对 UTF-8 编码文件做任何特别的事情吗？

最后，Groovy 中的解决方案也会有所帮助。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-11-10T18:26:38.397

您应该使用[Text::CSV_XS](http://search.cpan.org/perldoc?Text::CSV_XS)而不是自己这样做。它支持嵌入在记录中的换行符以及 Unicode 文件。创建解析器时需要指定正确的选项，因此请务必仔细阅读文档。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-10T18:27:21.423

这对我有用：

```
open(F, "test.txt") or die;
undef $/;
$s = <F>;
close(F);
$s =~ s/\n,/,/g;
print $s;

$ cat test.txt
foo,bar,n
,a,bc,d
one,two,three
,a,bc,d
$ perl test.pl 
foo,bar,n,a,bc,d
one,two,three,a,bc,d 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-11T05:26:30.327

这是一个时髦的版本。根据要求，这可能无法捕捉到一些细微差别（例如可以在其中包含逗号的带引号的字符串）。如果换行符可以发生在字段的中间而不是总是在末尾，那么它也必须进行调整。

```
def input = """foo,bar,n
,a,bc,d
one,two,three
,a,bc,d"""

def answer = (input =~ /(.*\n?,){5}.*(\n|$)/).inject ("") { ans, match  ->
    ans << match.replaceAll("\n","") << "\n"
}

assert answer.toString() == 
"""foo,bar,n,a,bc,d
one,two,three,a,bc,d
""" 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-12T03:27:25.217

这可能太简单了（或者不能很好地处理一般情况），

```
def input = """foo,bar,n
,a,bc,d
one,two,three
,a,bc,d"""

def last
input.eachLine {
    if(it.startsWith(',')) {
        last += it;
        return;
    }
    if(last)
        println last;
    last = it
}
println last 
```

发出；

```
foo,bar,n,a,bc,d
one,two,three,a,bc,d 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-12T23:04:11.470

这主要是为了回答您的 UTF-8 编码问题。

根据特定的编码，您*可能*还需要查找空字节。如果上述建议对您不起作用，将 's/\n,/,/g' 替换为 's/\c@?\n(\c@?,)/$1/g' 可能会在不破坏编码的情况下工作，尽管迭代地执行它可能更安全（将 's/\c@?\n(\c@?,)/$1/' 应用于每一行，而不是将它们连接起来并全局应用）。这确实是一个 hack，不能替代真正的 unicode 支持，但如果您只需要快速修复，或者如果您对编码有保证，它可能会有所帮助。

# c# - 使用空合并运算符的独特方法

> ID：278703
> 
> 赞同：170
> 
> 时间：2008-11-10T18:21:27.003
> 
> 标签：c#, coding-style, null, conditional-operator, null-coalescing-operator

我知道在 C# 中使用[空合并运算符](https://en.wikipedia.org/wiki/Null_coalescing_operator)的标准方法是设置默认值。

```
string nobody = null;
string somebody = "Bob Saget";
string anybody = "";

anybody = nobody   ?? "Mr. T"; // Returns Mr. T
anybody = somebody ?? "Mr. T"; // Returns "Bob Saget" 
```

但是还能`??`用来做什么呢？它似乎不如[三元运算符](https://en.wikipedia.org/wiki/%3F:)有用，除了更简洁和更易于阅读之外：

```
nobody = null;
anybody = nobody == null ? "Bob Saget" : nobody; // Returns Bob Saget 
```

因此，鉴于很少有人知道空合并运算符...

*   你用过`??`别的吗？

*   是`??`必要的，或者您应该只使用三元运算符（大多数人都熟悉）

* * *

## 回答 #1

> 赞同：224
> 
> 时间：2008-11-10T18:25:22.957

嗯，首先，它比标准的三元运算符更容易链接：

```
string anybody = parm1 ?? localDefault ?? globalDefault; 
```

对比

```
string anyboby = (parm1 != null) ? parm1
               : ((localDefault != null) ? localDefault
               : globalDefault); 
```

如果可能为 null 的对象不是变量，它也可以很好地工作：

```
string anybody = Parameters["Name"]
              ?? Settings["Name"]
              ?? GlobalSetting["Name"]; 
```

对比

```
string anybody = (Parameters["Name"] != null ? Parameters["Name"]
                 : (Settings["Name"] != null) ? Settings["Name"]
                 :  GlobalSetting["Name"]; 
```

* * *

## 回答 #2

> 赞同：178
> 
> 时间：2008-11-10T18:25:55.573

我用它作为一个惰性加载单行：

```
public MyClass LazyProp
{
    get { return lazyField ?? (lazyField = new MyClass()); }
} 
```

可读吗？自己决定。

* * *

## 回答 #3

> 赞同：53
> 
> 时间：2008-11-10T19:30:56.957

我发现它以两种“有点奇怪”的方式有用：

*   `out`作为编写例程时使用参数的替代方法`TryParse`（即，如果解析失败，则返回空值）
*   作为比较的“不知道”表示

后者需要更多信息。通常，当您创建与多个元素的比较时，您需要查看比较的第一部分（例如年龄）是否给出了明确的答案，然后只有在第一部分没有帮助时才查看下一部分（例如姓名）。使用空合并运算符意味着您可以编写非常简单的比较（无论是排序还是相等）。例如，在[MiscUtil](http://pobox.com/~skeet/csharp/miscutil)中使用几个帮助类：

```
public int Compare(Person p1, Person p2)
{
    return PartialComparer.Compare(p1.Age, p2.Age)
        ?? PartialComparer.Compare(p1.Name, p2.Name)
        ?? PartialComparer.Compare(p1.Salary, p2.Salary)
        ?? 0;
} 
```

诚然，我现在在 MiscUtil 中拥有 ProjectionComparer，以及一些扩展，这使得这种事情变得更加容易——但它仍然很整洁。

在开始实现 Equals 时检查引用相等（或无效）也可以这样做。

* * *

## 回答 #4

> 赞同：34
> 
> 时间：2008-12-19T21:30:48.813

另一个优点是三元运算符需要双重评估或临时变量。

考虑一下，例如：

```
string result = MyMethod() ?? "default value"; 
```

而使用三元运算符时，您剩下的是：

```
string result = (MyMethod () != null ? MyMethod () : "default value"); 
```

它调用 MyMethod 两次，或者：

```
string methodResult = MyMethod ();
string result = (methodResult != null ? methodResult : "default value"); 
```

无论哪种方式，空合并运算符都更干净，而且我猜想效率更高。

* * *

## 回答 #5

> 赞同：24
> 
> 时间：2015-08-17T13:52:03.330

要考虑的另一件事是，coalesce 运算符不会像三元组那样调用属性的 get 方法两次。

所以有些场景你不应该使用三元运算符，例如：

```
public class A
{
    var count = 0;
    private int? _prop = null;
    public int? Prop
    {
        get 
        {
            ++count;
            return _prop
        }
        set
        {
            _prop = value;
        }
    }
} 
```

如果您使用：

```
var a = new A();
var b = a.Prop == null ? 0 : a.Prop; 
```

getter 将被调用两次，`count`变量将等于 2，如果您使用：

```
var b = a.Prop ?? 0 
```

`count`变量应该等于 1 。

* * *

## 回答 #6

> 赞同：15
> 
> 时间：2012-11-27T22:25:08.233

我发现`??`运算符的最大优势是您可以轻松地将可为空的值类型转换为不可为空的类型：

```
int? test = null;
var result = test ?? 0; // 'result' is int, not int? 
```

我经常在 LINQ 查询中使用它：

```
Dictionary<int, int?> PurchaseQuantities;
// PurchaseQuantities populated via ASP .NET MVC form.
var totalPurchased = PurchaseQuantities.Sum(kvp => kvp.Value ?? 0);
// totalPurchased is int, not int? 
```

* * *

## 回答 #7

> 赞同：9
> 
> 时间：2008-11-11T09:56:36.490

我`??`在 IDataErrorInfo 的实现中使用过：

```
public string Error
{
    get
    {
        return this["Name"] ?? this["Address"] ?? this["Phone"];
    }
}

public string this[string columnName]
{
    get { ... }
} 
```

如果任何单个属性处于“错误”状态，我会得到那个错误，否则我会得到 null。它真的很好用。

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2013-07-01T07:45:01.867

您可以使用 null 合并运算符使其更清晰地处理未设置可选参数的情况：

```
public void Method(Arg arg = null)
{
    arg = arg ?? Arg.Default;
    ... 
```

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2014-06-19T14:51:43.467

我喜欢使用空合并运算符来延迟加载某些属性。

一个非常简单（和人为）的例子只是为了说明我的观点：

```
public class StackOverflow
{
    private IEnumerable<string> _definitions;
    public IEnumerable<string> Definitions
    {
        get
        {
            return _definitions ?? (
                _definitions = new List<string>
                {
                    "definition 1",
                    "definition 2",
                    "definition 3"
                }
            );
        }
    } 
} 
```

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2016-06-29T14:09:47.800

我最近一直在做的一件事是使用空合并来备份到`as`. 例如：

```
object boxed = 4;
int i = (boxed as int?) ?? 99;

Console.WriteLine(i); // Prints 4 
```

它对于备份`?.`可能会失败的长链也很有用

```
int result = MyObj?.Prop?.Foo?.Val ?? 4;
string other = (MyObj?.Prop?.Foo?.Name as string)?.ToLower() ?? "not there"; 
```

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2011-02-15T13:12:03.567

> 是 ？？必要的，或者您应该只使用三元运算符（大多数人都熟悉）

实际上，我的经验是，很少有人熟悉三元运算符（或更准确地说，*条件*运算符；在与二元或一元或二元`?:`相同的意义上是“三元” ；但它确实恰好是只有许多语言的三元运算符），所以至少在那个有限的样本中，你的陈述在那里失败了。`||``+`

此外，如前所述，当空合并运算符非常有用时，存在一种主要情况，即每当要计算的表达式有任何副作用时。在这种情况下，您*不能*在不 (a) 引入临时变量或 (b) 更改应用程序的实际逻辑的情况下使用条件运算符。(b) 显然在任何情况下都不合适，虽然这是个人喜好，但我不喜欢用大量无关紧要的变量来混淆声明范围，即使是短暂的变量，所以 (a) 也在其中特定场景。

当然，如果您需要对结果进行多次检查，条件运算符或一组`if`块可能是这项工作的工具。但是对于简单的“如果 this 为 null，则使用 that，否则使用它”，null 合并运算符`??`是完美的。

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2009-03-10T16:01:25.633

唯一的问题是 null-coalesce 运算符不检测空字符串。

* * *

IE

```
string result1 = string.empty ?? "dead code!";

string result2 = null ?? "coalesced!"; 
```

### 输出

> ```
> result1 = ""
> 
> result2 = coalesced! 
> ```

* * *

我目前正在研究覆盖 ?? 操作员来解决这个问题。将它内置到框架中肯定会很方便。

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2008-11-10T18:24:38.340

> 是 ？？必要的，或者您应该只使用三元运算符（大多数人都熟悉）

你应该使用最能表达你意图的东西。由于有*一个*空合并运算符，请*使用它*。

另一方面，由于它是如此专业，我认为它没有其他用途。我会更喜欢运算符的适当重载`||`，就像其他语言一样。这在语言设计中会更加简洁。不过还好……</p>

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2008-11-10T18:31:37.607

凉爽的！把我算作一个不知道空合并运算符的人——这是非常漂亮的东西。

我发现它比三元运算符更容易阅读。

我首先想到的可能使用它的地方是将所有默认参数保存在一个地方。

```
public void someMethod(object parm2, ArrayList parm3)
{
  someMethod(null, parm2, parm3);
}

public void someMethod(string parm1, ArrayList parm3)
{
  someMethod(parm1, null, parm3);
}

public void someMethod(string parm1, object parm2)
{
  someMethod(parm1, parm2, null);
}

public void someMethod(string parm1)
{
  someMethod(parm1, null, null);
}

public void someMethod(object parm2)
{
  someMethod(null, parm2, null);
}

public void someMethod(ArrayList parm3)
{
  someMethod(null, null, parm3);
}

public void someMethod(string parm1, object parm2, ArrayList parm3)
{
  // Set your default parameters here rather than scattered 
  // through the above function overloads
  parm1 = parm1 ?? "Default User Name";
  parm2 = parm2 ?? GetCurrentUserObj();
  parm3 = parm3 ?? DefaultCustomerList;

  // Do the rest of the stuff here
} 
```

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2016-12-19T18:23:02.990

这是一个有点奇怪的用例，但我有一个方法，其中一个`IDisposable`对象可能作为参数传递（因此由父级处理），但它也可能是 null （因此应该在本地创建和处理方法）

要使用它，代码要么看起来像

```
Channel channel;
Authentication authentication;

if (entities == null)
{
    using (entities = Entities.GetEntities())
    {
        channel = entities.GetChannelById(googleShoppingChannelCredential.ChannelId);
        [...]
    }
}
else
{
    channel = entities.GetChannelById(googleShoppingChannelCredential.ChannelId);
    [...]
} 
```

但是使用空合并它变得更加整洁：

```
using (entities ?? Entities.GetEntities())
{
    channel = entities.GetChannelById(googleShoppingChannelCredential.ChannelId);
    [...]
} 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2019-09-02T13:53:10.120

我这样使用它：

```
for (int i = 0; i < result.Count; i++)
{
    object[] atom = result[i];

    atom[3] = atom[3] ?? 0;
    atom[4] = atom[4] != null ? "Test" : string.Empty;
    atom[5] = atom[5] ?? "";
    atom[6] = atom[6] ?? "";
    atom[7] = atom[7] ?? "";
    atom[8] = atom[8] ?? "";
    atom[9] = atom[9] ?? "";
    atom[10] = atom[10] ?? "";
    atom[12] = atom[12] ?? false;
} 
```

# css - 允许标签覆盖 CSS？

> ID：278709
> 
> 赞同：0
> 
> 时间：2008-11-10T18:23:04.987
> 
> 标签：css

我有一些用户生成的内容试图在我的网站上呈现。我正在使用的富文本框编辑器使用`<font />`标签呈现字体更改，这些标签被页面上的 CSS 覆盖。

有谁知道是否有办法让使用`<font />`标签定义的规则显示出来？

**更新**
由于更改我用于富文本编辑器的控件不是一种选择，而且我的用户不了解 HTML 来理解`<font>`标签和任何其他类型的标签之间的区别，我别无选择，只能创建一个 hack解决我的问题。下面是我用来解决它的代码。这是一个 jQuery 脚本，可将所有`<font />`标签属性更改为内联 CSS。

```
(function() {
    $('font[size]').each(function() {
        var fontSize = this.size;
        if (fontSize == 1) {
            $(this).css("font-size", 8);
        } else if (fontSize == 2) {
            $(this).css("font-size", 9);
        } else if (fontSize == 3) {
            $(this).css("font-size", 11);
        } else if (fontSize == 4) {
            $(this).css("font-size", 15);
        } else if (fontSize == 5) {
            $(this).css("font-size", 20);
        } else if (fontSize == 6) {
            $(this).css("font-size", 25);
        }
    });
    $('font[face]').each(function() {
        $(this).css('font-family', this.face);
    });
    $('font[color]').each(function() {
        $(this).css('color', this.color);
    });
})(); 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2010-01-04T07:58:57.347

晚了一年，但我还是想分享一下。

我也为此感到沮丧。我使用了一个生成`<FONT />`标签的免费 RTE JavaScript 组件。替换它并不方便，因为它是针对客户端的，并且它是修复此 CSS 覆盖问题的回调。

不幸的是，其他解决方案都不适用于我的情况，所以在思考后我想出了这个 JavaScript 解决方案：

```
var fontEl=document.getElementsByTagName("font");
for(var i=0;i<fontEl.length;i++) {
    var f = fontEl[i];
    if(f.size)
        f.style.fontSize=(Math.round(parseInt(f.size)*12*0.6)).toString()+'px';
    if(f.face)
        f.style.fontFamily=f.face;
    if(f.color)
        f.style.color=f.color;
} 
```

转换字体大小的公式不正确，但足够准确以产生可信的结果。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-10T18:25:41.597

我建议用您自己的实现 !important 属性的样式覆盖 CSS。

```
div.MyClass p 
{  
font-size: 0.7em !important; 
} 
```

字体标签在技术上应该覆盖大多数样式，只要它是最接近原始文本的元素。

如果它失败了，很可能是由于 CSS 使用 !important 属性来覆盖它。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-10T18:28:02.327

您可以将其转换为`style`元素上的标签。其中的任何内容都将优先于样式表定义的规则。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-10T18:36:50.937

诚实地？获取新的富文本编辑器！[TinyMCE](http://tinymce.moxiecode.com/)或[FCKeditor](http://www.fckeditor.net/)都是不错的选择。要么这样，要么教育您的用户了解他们在编辑器中设置的样式在发布时不一定会以这种方式出现。过去我对 FCKeditor 所做的事情是将其工具栏限制为基本功能，如列表、链接、标题等，没有任何样式选项。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-10T20:05:26.967

<font> 和其他元素一样只是一个元素；它可以使用 CSS 设置样式。您可以编写 CSS 以允许字体标签的样式下推，如下所示：

```
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
  <head>
    <title></title>
    <style type="text/css">
    body { color: black}
    a { color: red; font-family: Sans; font-size: 14px;}
    font * { color: inherit; font-family: inherit; font-size: inherit}
    </style>
  </head>
  <body>
    This is outside <a href="#">inside</a> outside. <font color="green" face="Times New Roman" size="20">Outside <a href="#">inside</a> outside</font>.
  </body>
</html> 
```

# javascript - IE7 中的 getElementsByName

> ID：278719
> 
> 赞同：17
> 
> 时间：2008-11-10T18:26:23.983
> 
> 标签：javascript, dom, internet-explorer-7

我有一些代码这样做：

```
 var changes = document.getElementsByName(from);
 for (var c=0; c<changes.length; c++) {
   var ch = changes[c];
   var current = new String(ch.innerHTML);
   etc.
 } 
```

这在 FF 和 Chrome 中运行良好，但在 IE7 中不行。大概是因为 getElementsByName 在 IE 中不起作用。最好的解决方法是什么？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-11-10T18:48:20.850

In case you don't know why this isn't working in IE, here is [the MSDN documentation on that function](http://msdn.microsoft.com/en-us/library/ms536438(VS.85).aspx):

> When you use the getElementsByName method, all elements in the document that have the specified NAME attribute or ID attribute value are returned.
> 
> Elements that support both the NAME attribute and the ID attribute are included in the collection returned by the getElementsByName method, but elements with a NAME expando are not included in the collection; therefore, this method cannot be used to retrieve custom tags by name.

Firefox allows [`getElementsByName()`](http://msdn.microsoft.com/en-us/library/ms536438(VS.85).aspx) to retrieve elements that use a NAME expando, which is why it works. Whether or not that is a Good Thing™ may be up for debate, but that is the reality of it.

So, one option is to use the [`getAttribute()`](http://msdn.microsoft.com/en-us/library/ms536429(VS.85).aspx) DOM method to ask for the NAME attribute and then test the value to see if it is what you want, and if so, add it to an array. This would require, however, that you iterate over all of the nodes in the page or at least within a subsection, which wouldn't be the most efficient. You could constrain that list beforehand by using something like [`getElementsByTagName()`](http://msdn.microsoft.com/en-us/library/ms536439(VS.85).aspx) perhaps.

Another way to do this, if you are in control of the HTML of the page, is to give all of the elements of interest an Id that varies only by number, e.g.:

```
<div id="Change0">...</div>
<div id="Change1">...</div>
<div id="Change2">...</div>
<div id="Change3">...</div> 
```

And then have JavaScript like this:

```
// assumes consecutive numbering, starting at 0
function getElementsByModifiedId(baseIdentifier) {
    var allWantedElements = [];
    var idMod = 0;
    while(document.getElementById(baseIdentifier + idMod)) { // will stop when it can't find any more
        allWantedElements.push(document.getElementById(baseIdentifier + idMod++));
    }
    return allWantedElements;
}

// call it like so:
var changes = getElementsByModifiedId("Change"); 
```

That is a hack, of course, but it would do the job you need and not be too inefficient compare to some other hacks.

If you are using a JavaScript framework/toolkit of some kind, you options are much better, but I don't have time to get into those specifics unless you indicate you are using one. Personally, I don't know how people live without one, they save so much time, effort and frustration that you can't afford *not* to use one.

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-10T18:33:07.260

有几个问题：

1.  IE 确实令人`id=""`困惑`name=""`
2.  `name=""`不允许在`<span>`

要修复，我建议：

1.  将所有更改`name=""`为`class=""`
2.  像这样更改您的代码：

-

```
var changes = document.getElementById('text').getElementsByTagName('span');
for (var c=0; c<changes.length; c++) {
 var ch = changes[c];

 if (ch.className != from)
continue;

 var current = new String(ch.innerHTML); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-10T18:57:53.013

It's not very common to find elements using the NAME property. I would recommend switching to the ID property.

You can however find elements with a specific name using jQuery:

```
 $("*[name='whatevernameYouWant']"); 
```

this will return all elements with the given name.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-10T18:43:39.517

IE 支持 getElementsByName，但存在一些错误。特别是它返回“id”与给定值匹配的元素，以及“name”。如果没有更多上下文、代码和实际错误消息，则无法判断这是否是您遇到的问题。

In general, getElementsByName is probably best avoided, because the ‘name’ attribute in HTML has several overlapping purposes which can confuse. Using getElementById is much more reliable. When specifically working with form fields, you can more reliably use form.elements[name] to retrieve the fields you're looking for.

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-10T22:54:09.340

Just another DOM bug in IE:

Bug 1: [Click here](http://webbugtrack.blogspot.com/2007/08/bug-411-getelementsbyname-doesnt-work.html)

Bug 2: [Click here](http://webbugtrack.blogspot.com/2008/04/bug-403-another-getelementsbyname-bugs.html)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2013-07-19T16:06:22.320

I've had success using a wrapper to return an array of the elements. Works in IE 6, and 7 too. Keep in mind it's not 100% the exact same thing as document.getElementsByName, since it's not a NodeList. But for what I need it for, which is to just run a for loop on an array of elements to do simple things like setting .disabled = true, it works well enough.

Even though this function still uses getElementsByName, it works if used this way. See for yourself.

```
function getElementsByNameWrapper(name) {
  a = new Array();

  for (var i = 0; i < document.getElementsByName(name).length; ++i) {
    a.push(document.getElementsByName(name)[i]);
  }

  return a;
} 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2013-11-06T18:45:30.760

Workaround

```
 var listOfElements = document.getElementsByName('aName'); // Replace aName with the name you're looking for
            // IE hack, because it doesn't properly support getElementsByName
            if (listOfElements.length == 0) { // If IE, which hasn't returned any elements
                var listOfElements = [];
                var spanList = document.getElementsByTagName('*'); // If all the elements are the same type of tag, enter it here (e.g.: SPAN)
                for(var i = 0; i < spanList.length; i++) {
                    if(spanList[i].getAttribute('name') == 'aName') {
                        listOfElements.push(spanList[i]);
                    }
                }
            } 
```

# nhibernate - NHibernate - 从存储过程填充单个属性

> ID：278732
> 
> 赞同：3
> 
> 时间：2008-11-10T18:30:51.523
> 
> 标签：nhibernate

目前有以下映射文件：

```
<?xml version="1.0" encoding="utf-8" ?>
<hibernate-mapping xmlns="urn:nhibernate-mapping-2.2" 
    namespace="NHibernateHelpers"
    assembly="App_Code.NHibernateHelpers">
  <class name="NHibernateHelpers.Fixture, App_Code" table="Fixture_Lists">
    <id name="Id" column="UniqRefNo">
      <generator class="guid" />
    </id>
    <property name="Date" column="FixDate"/>
    <property name="HomeTeamId" column="HomeId"/>
    <property name="HomeTeamName" column="Home_Team"/>
    <property name="AwayTeamId" column="AwayId"/>
    <property name="AwayTeamName" column="Away_Team"/>
    <property name="Kickoff" column="Kickoff"/>
    <bag name="Goals">
      <key column="FixID" />
      <one-to-many class="NHibernateHelpers.Goal, App_Code"/>
    </bag>
    <bag name="Bookings">
      <key column="FixID" />
      <one-to-many class="NHibernateHelpers.Booking, App_Code"/>
    </bag>
    <many-to-one name="HomeTeam" class="NHibernateHelpers.Team" column="HomeId" />
    <many-to-one name="AwayTeam" class="NHibernateHelpers.Team" column="AwayId" />
    <many-to-one name="Division" class="NHibernateHelpers.Division" column="Div_Comp" />
    <property name="HomeFullTimeScoreCode" column="Home_FT_Score"/>
    <property name="AwayFullTimeScoreCode" column="Away_FT_Score"/>
  </class>
</hibernate-mapping> 
```

它很好地映射到我继承的遗留数据库，但我想添加一个名为“MatchTime”的属性，其中包含存储过程的输出：

```
EXEC GetMatchTime @FixtureId = :Id 
```

其中 :Id 是当前 Fixture 对象的 ID。

这可能在映射文件中吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-11T13:35:10.997

有点笨拙——但是不将 sp 转换为函数，而是创建新函数并将它们用作现有 sp 的包装器呢？您可以将 Id 添加到函数中，并将其传递给存储过程，获取执行 sp 的结果，然后将它们传回。

[http://sqlblog.com/blogs/denis_gobo/archive/2008/05/08/6703.aspx](http://sqlblog.com/blogs/denis_gobo/archive/2008/05/08/6703.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-10T18:59:35.693

您可能需要稍微调整一下参数，但它应该可以工作（Id 与 Fixture.Id 的名称匹配）：

```
<property name='MatchTime' formula='(EXEC GetMatchTime Id)'/> 
```

[http://ayende.com/Blog/archive/2006/12/26/LocalizingNHibernateContextualParameters.aspx](http://ayende.com/Blog/archive/2006/12/26/LocalizingNHibernateContextualParameters.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-10T19:55:45.957

@沃森

NHibernate 将公式的内容添加为子查询，因此生成的 SQL 最终看起来像：

```
SELECT FieldA, FieldB, FieldC, ( EXEC GetMatchTime Id ) FROM Fixture_Lists 
```

不幸的是，由于不允许将存储过程作为子查询，它失败了。

我可以将存储过程转换为函数，但其​​中有很多，它可能会破坏遗留代码。

# xml - 在产品（项目）XML 模式中表示图像节点的最佳方式是什么？

> ID：278738
> 
> 赞同：0
> 
> 时间：2008-11-10T18:32:02.257
> 
> 标签：xml, schema

我有一个表示数据库中产品的 XML 模式，我试图找出将产品图像引用存储为 XML 节点的最佳方法。将有一个主图像，然后是备用图像，每个图像都有序列（显示顺序）。这将是一种适当的格式，还是有更好的方法：

```
<item>
    <id></id>
    <images>
        <image width="" height="" href="" alt="" sequence="1" />
        <image width="" height="" href="" alt="" sequence="2" />
        <image width="" height="" href="" alt="" sequence="3" />
        <image width="" height="" href="" alt="" sequence="4" />
    </images>
</item> 
```

显然会有比这更多的节点，但我不会全部显示。我想我的主图像将永远是序列中的第一个。我遇到的问题是这些图像中的每一个都有一个缩略图，中型和大型图像，所以我认为这需要进一步分解。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-10T18:37:09.717

由于 XML 元素具有自然顺序（即它们在 XML 文件中出现的顺序），因此包含该`sequence`属性可能是多余的。您仍然可以谈论元素的顺序，并且主要产品图像仍然存在“第一个”。

所以也许：

```
<images>
    <imageset>
        <image size="thumbnail" width="" height="" href="" alt="" />
        <image size="medium" width="" height="" href="" alt="" />
        <image size="large" width="" height="" href="" alt="" />
    </imageset>
    <imageset>
        <image size="thumbnail" width="" height="" href="" alt="" />
        <image size="medium" width="" height="" href="" alt="" />
        <image size="large" width="" height="" href="" alt="" />
    </imageset>
</images> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-10T20:20:45.657

稍微扩展一下 Greg 的设计：将图像大小设置为元素名称而不是设置`size`属性可能是合适的，即：

```
<imageset>
   <thumbnail width=""... />
   <medium width="".../>
   <large width="".../>
</imageset> 
```

有两个原因。

首先，名称`imageset`已经告诉您它的子元素将是图像，因此命名子元素`image`是多余的。使用 XPath 模式和`imageset/*`使用`imageset/image`它一样容易，而且编写`imageset/medium`起来比编写简单一点`imageset/image[@size='medium']`。

一个更重要的原因是这种设计允许您的模式指定`imageset`元素必须包含每种类型的图像中的一种。（或者指定一种或多种图像类型是可选的。）

# html - XHTML strict 解决了什么问题？

> ID：278746
> 
> 赞同：21
> 
> 时间：2008-11-10T18:36:05.943
> 
> 标签：html, xhtml, project-planning, xhtml-1.0-strict, buzzword-compliance

我真的不明白对 XHTML 严格的迷恋。内联 JavaScript 通常需要大量的转义符，以使其与 XHTML 兼容并与 MSIE 5 和 6 半向后兼容。然后是用户输入的强迫症不足，以确保您不会错过任何非法字符. 这似乎比它的价值更多的努力。没关系，几乎每个与我一起工作的开发人员都忘记确保从服务器返回的内容类型被重置为 XHTML 页面从 text/html 到 application/xhtml+xml。

希望我知道博主的名字，但其他人指出，大多数所谓的 XHTML 兼容网站和开源软件包实际上并不是因为最后一个问题，忘记正确设置内容类型标题。

我希望了解 XHTML 为何有用，或者构建足够多的论据以防止它在我有影响力的未来项目中被使用。

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-11-10T19:22:29.813

XHTML1 vs HTML4 和 Strict vs Transitional 是完全正交的问题。

XML 可能不会给今天的浏览器带来任何巨大的优势，但在服务器端，使用 XML 处理文档比尝试解析老式 SGML 的混乱情况要容易一个数量级，除了不是真正的 HTML4。

将自己限制在 [X]HTML Strict 本身并没有任何意义，只是它不鼓励使用您不应该使用的旧的、不易维护的技术。

> 内联 javascript 通常需要大量的转义来使其与 XHTML 兼容

只要您不使用字符 < 或 &，您就可以逃脱而无需任何转义。'// < [CDATA[' 并不比 '< ！--' 是在过去。

无论如何，将脚本保持在外部更易于管理；您不想内联做任何重要的事情。

> 然后是用户输入不够强迫症以确保您不会错过任何非法字符的问题。

带外字符在 HTML4 Transitional 中与在 XHTML1 Strict 中一样无效。

如果您接受用户提交的 HTML 并且没有使用足够的细齿梳来检查/转义它以防止格式错误，那么您遇到的问题比仅仅遵守文档类型要大得多。您将让注入黑客通过并使您的站点容易受到跨站点脚本安全漏洞的攻击。

> 忘记确保从服务器返回的内容类型被重置为 XHTML 页面从 text/html 到 application/html+xml。

这不是“忘记”，而是故意的：今天为 application/xhtml+xml 提供服务并没有那么大的意义。要考虑到 IE，您必须嗅探 UA，然后确保您了解在两种解析模式中弹出的 CSS 和 JavaScript 差异……您可以这样做来证明您的技术实力，但它并没有真正让您得到任何东西.

将 XHTML 用作遗留 HTML 可能并不理想，但它可以让您保留更简单、更可处理的 XML 语法（以及与其他 XML 语言（如 SVG）的潜在互操作性），同时仍然对浏览器友好。

人们抱怨格式正确的错误的挑剔，但是让这些错误立即被你修复它们比让它们静静地留在那里，准备绊倒一些未来的浏览器要好得多。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-11-10T18:42:58.740

有一篇很棒的关于 XHTML 的使用[@Beware of XHTML](http://www.webdevout.net/articles/beware-of-xhtml)的帖子。

希望它有所帮助，布鲁诺·菲格雷多

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-11-11T13:01:06.633

XHTML 1.0 Strict 试图解决四个问题：

1.  XML 是 W3C 技术，而 HTML4 没有使用它。不是你的问题。

2.  在表现主义方面，严格寻求比过渡更纯粹的理论。但这不是[XHTML 与 HTML 的问题](http://hsivonen.iki.fi/wannabe/)。

3.  XML 解析器应该更简单。（不完全正确；处理 DTD 部分的代码相当复杂。）现在，您可以使用[现成的 XML 和 HTML 解析器](https://stackoverflow.com/questions/2861/options-for-html-scraping#189170)，所以这不是您的问题。（旁白：[移动论点完全是假的](http://simon.html5.org/articles/mobile-results)。）

4.  application/xhtml+xml（虽然不是有效的 XHTML 1.0 Strict！）允许您混合其他词汇表。如果你今天想使用内联 MathML 或 SVG，这就是今天使用 application/xhtml+xml 的主要原因。然而，HTML5 工作的方向是使在 text/html 中使用 MathML 和 SVG 成为可能。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-11-10T18:40:36.700

XHTML 很有用，因为它比 HTML 更容易创建一个简单的转换样式表或为它滚动您自己的解析器。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-11-10T18:49:19.507

您是否必须使用程序解析您的 HTML，或者进行一些测试？然后，使用 XHTML。

对于其他一切，HTML 4.01（严格的、松散的、过渡的，等等）是完全“标准”的，而且“麻烦”更少。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-11-10T20:02:24.880

XHTML 使您能够像 SVG（可缩放矢量图形）一样进行高级渲染，它本身是一种 XML，但可以通过 XML 命名空间扩展轻松嵌入 XHTML，而无需 <embed> 或 <object>。不幸的是，只有 Firefox 和 Safari 支持它。对不起 IE6 用户。

有关 SVG 的更多信息，请访问[http://en.wikipedia.org/wiki/Svg](http://en.wikipedia.org/wiki/Svg)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-10T18:41:37.510

XHTML 使 HTML 与我们世界中所有其他基于 xml 的结构正交，这有两个主要好处。

我们在处理 xml 时使用的设计模式可以应用于 html。

软件工具同上。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-10T18:50:12.267

XHTML 具有 xml 的优点。但是为什么是严格的变体呢？

我看到与不推荐使用的功能有一些相似之处。您仍然可以在这个版本中使用它们，但它们可能会在下一个版本中被删除。所以我认为过渡版本已被弃用。它仍然有效，并且适用于几个版本，但如果您想为未来构建，请使用严格版本。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-10T18:50:47.303

Strict 旨在通过使两者更难混合来形式化内容和样式之间的分离。Elliotte Rusty Harold 在他的一本书中对 XHTML 有很好的论述，这里是关于“ [Why XHTML](http://cafe.elharo.com/web/refactoring-html/why-xhtml/) ”的相关摘录。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-11-11T09:13:06.610

我看到 XHTML 解决的唯一问题是用户使用 Safari 的“问题”：我不知道这个 bug 是否仍然存在，但是当我们最后一次被要求用 XHTML 编写时，我们遇到了一个导致XHTML 无法与 Safari 一起使用。在 XHTML 中，锚标记中不允许使用以下 URL，因为与符号没有转义：

```
http://www.example.com/page.php?arg1=val1&arg2=val2 
```

所以你要做的就是用 & 替换它 像这样：

```
http://www.example.com/page.php?arg1=val1&amp;arg2=val2 
```

但 Safari 转换 & 到 & 所以你得到这个网址：

```
http://www.example.com/page.php?arg1=val1&#38;arg2=val2 
```

...就 PHP 而言，井号结束 URL。我知道有一些丑陋的 hack 允许您以其他方式传递两个变量，但是如果 XHTML 会迫使您使用丑陋的 hack，那么您最好没有它。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-11-11T09:22:24.953

就个人而言，我喜欢 XHTML 的概念：比我们看到的大多数 HTML 更干净，更易于解析和验证。和大家一样，我开始编写 XHTML 页面。顺便说一句，我认为内联 JavaScript 没有问题，如果您将代码放在 CDATA 中，则无需转义。幸运的是 IE5 有点脱离了浏览器领域，就像 Netscape 4 迫使我们写`/ >`而不是`/>`，有时我仍然会在纯 XML 中看到...

现在，我已经阅读了许多文章，例如 Bruno 所链接的一篇文章，其中有很多很好的论据反对它*在大多数情况下*的使用。基本上，它说大多数浏览器不仅为严格的 XHTML（作为 XML 服务）做好了准备，将 XHTML 作为 HTML 服务没有多大意义，而且无论如何它在大多数站点中都不是很有用。

看看上面的论点：它们是完全有效的，能够将 MathML 或 SVG 直接放在页面中，用 XSLT 解析器转换 XML，用 XML 解析器处理页面，这真是太好了。

但你多久这样做一次？解析页面是最终用户最常遇到的问题，可以使用好的 HTML 解析器。鉴于能够管理 MathML、SVG 或 XSLT 的浏览器数量众多，与庞大的 Internet 相比，对 Intranet 的需求更大。

您可以拥有一个电子商务、博客或论坛，它们会输出良好的 XHTML 页面。写描述、文章或消息的人插入`<p><p><p>`跳过一些行，当它不是`<p/>`或其他一些异国情调的结构时......

我相信 XHTML，但我认为我不会再将它用于我为我的站点所做的小页面。我将使用 HTML 4 和编写良好的代码（引用的属性、关闭标签，即使是可选的，等等）。
毕竟，如果 W3C 在 HTML 5 中工作，那是有原因的：HTML 仍然有前途，否则它就会被 XHTML 2 淘汰。

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2008-11-10T18:42:43.077

XHTML 根据定义是 XML，与 HTML 不同。

这意味着您可以用它做一些时髦有用的事情，例如轻松验证和解析它（因为您知道它是 XML，因此可以使用无数可用的工具）。

此外，极客喜欢让事情“更正确”;-)

* * *

## 回答 #13

> 赞同：-1
> 
> 时间：2008-11-10T18:51:20.000

## 这是一个全球标准问题

这不仅仅是关于 xHTML，而是关于世界上所有的标准。你需要让事情更清楚，从一个版本到另一个版本。

xHTML 是方形的，它促使编码人员为代码添加语义价值。它完全兼容 XML，因此更易于解析、样式化等。

请记住，代码不仅适用于编码员，机器人也适用于机器。在 10 年内，创建浏览器或库的人不会希望为旧的 HTML 处理实现相同的复杂规则，而是希望得到尽可能干净的东西。

搜索引擎需要依靠一些东西来建立价值之间的语义联系，因此最好只有一种简单的方法来做到这一点。

而且我不是在谈论屏幕阅读器......

标准，首先是关于走向一种适合每个人需要的独特开放解决方案。不仅仅是添加新的闪亮功能。

# language-agnostic - 使用配置文件是否等同于使用全局变量？

> ID：278754
> 
> 赞同：7
> 
> 时间：2008-11-10T18:41:31.300
> 
> 标签：language-agnostic, coding-style

我已经阅读了很多次并同意避免使用全局变量来保持代码正交。使用配置文件来保留程序使用的只读信息是否类似于使用 Globals？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-10T18:50:14.730

如果您使用配置文件代替全局变量，那么是的，它们是相似的。

配置文件只应在最终用户（可能是精通计算机的用户，如开发人员）需要声明应用程序或代码段的设置的情况下使用，同时让他们的手远离代码本身。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-10T18:50:19.177

我的第一反应是不一样。我认为全局变量的问题在于读写场景。配置文件是只读的（至少在执行方面）。同样，常量不被认为是不好的编程行为。配置文件，至少在我使用它们的方式上，只是易于更改的常量。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-10T18:58:57.927

好吧，因为配置文件和全局变量都可以具有在整个系统中传播更改的效果 - 它们大致相似。

但是......在配置文件的情况下，更改通常会发生在一个单一的、高度可见的（对开发人员）位置，并且全局变量会以非常隐秘且难以追踪的方式影响更改——所以在这种方式下，这两个概念并不相似。

拥有一个配置文件通常有助于[DRY 概念](http://en.wikipedia.org/wiki/Don%27t_repeat_yourself)，它也不应该损害系统的[正交](http://en.wikipedia.org/wiki/Orthogonal#Computer_science)性。

使用 25 美元单词“正交”的奖励积分。我不得不在 Wikipedia 中查找那个以找出非欧几里得定义。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-10T18:55:09.557

配置文件实际上是为了让最终用户可以轻松编辑，作为告诉程序如何运行的一种方式。

一种更专业的配置文件形式，即用户首选项，用于记住程序执行之间的事情。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-10T18:58:04.323

全局与永远不会更改的对象的唯一实例相关，而配置文件用作引用值的容器，用于应用程序中可以更改的对象。

一个“全局”对象在运行时永远不会改变，另一个对象通过配置文件初始化，但可以在以后更改。

实际上，这些对象不仅可以在应用程序的生命周期内更改，它们还可以监视配置文件以实现“热更改”（修改其值而不停止/重新启动应用程序），如果该配置文件被修改.

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-10T19:15:47.423

它们绝对不是相同的或相互替代的。配置文件或对象可以非全局使用，即显式传递。

您当然可以有一个引用配置对象的全局变量，这将违背目的。

# sql-server - 将标题存储在数据库中以允许在没有前导“The”、“A”的情况下进行排序的最佳方式是什么

> ID：278758
> 
> 赞同：8
> 
> 时间：2008-11-10T18:43:21.657
> 
> 标签：sql-server, database-design, sql-server-2000

我运行（并且目前正在彻底检修）一个处理剧院的网站（如果您有兴趣，请访问 njtheater.com）。

当我从数据库中查询戏剧列表时，我希望“威尼斯商人”在“M”下排序。当然，当我显示剧名时，我需要前面的“The”。

设计数据库来处理这个问题的最佳方法是什么？

（我使用的是 MS-SQL 2000）

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-11-10T19:12:23.623

您在两列的正确轨道上，但我建议将整个可显示的标题存储在一列中，而不是连接列。另一列纯粹用于排序。这使您在排序和显示方面具有完全的灵活性，而不是被简单的前缀所束缚。

这是搜索时相当常见的方法（与排序有关）。一列（带有索引）是大小写折叠、取消标点符号等。在您的情况下，您还可以将删除前导文章的语法约定应用于该字段中的值。然后将此列用作搜索或排序的比较键。另一列未编入索引，并保留原始键以供显示。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-10T18:47:19.463

将标题存储在两个字段中：TITLE-PREFIX 和 TITLE-TEXT（或类似的）。然后对第二个进行排序，但显示两者的串联，中间有一个空格。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-10T18:47:42.503

我自己的解决方案是在数据库中创建三列。

```
article   varchar(4)
sorttitle varchar(255)
title     computed (article + sortitle) 
```

“article” 只能是“The”、“A”、“An”（注意每个尾随空格）或空字符串（非空）

"sorttitle" 将是删除了前导文章的标题。

这样，我可以对 SORTTITLE 进行排序并显示 TITLE。计算域上几乎没有实际处理（所以它很快），插入时只需做一点工作。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-10T18:49:22.737

我同意 doofledorfer，但我建议将输入的空格存储为前缀的一部分，而不是假设它是单个空格。它为您的用户提供了更大的灵活性。您也可以在查询本身中进行一些连接，因此您不必将字段合并为业务逻辑的一部分。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-10T22:41:24.997

我不知道这是否可以在 SQL Server 中完成。如果您可以创建基于函数的索引，则可以创建一个在该字段上执行正则表达式或使用您自己的函数的索引。这将比附加字段占用更少的空间，由数据库本身保持最新，并允许将完整的标题存储在一起。

# c# - 是否有用于将文件 URI 转换为带有驱动器号的路径的 .NET Framework 方法？

> ID：278761
> 
> 赞同：6
> 
> 时间：2008-11-10T18:45:28.827
> 
> 标签：c#, .net, winforms, uri

我在 ASP.NET 领域中寻找类似 Server.MapPath 的东西，以将 Assembly.GetExecutingAssembly().CodeBase 的输出转换为带有驱动器号的文件路径。

以下代码适用于我尝试过的测试用例：

```
私有静态字符串 ConvertUriToPath(字符串文件名)
{
    fileName = fileName.Replace("file:///", "");
    fileName = fileName.Replace("/", "\\");
    返回文件名；
}

```

似乎 .NET Framework 中应该有一些更好的东西——我只是没能找到它。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-11-10T19:08:54.287

尝试查看[Uri.LocalPath](http://msdn.microsoft.com/en-us/library/system.uri.localpath.aspx)属性。

```
private static string ConvertUriToPath(string fileName)
{
   Uri uri = new Uri(fileName);
   return uri.LocalPath;

   // Some people have indicated that uri.LocalPath doesn't 
   // always return the corret path. If that's the case, use
   // the following line:
   // return uri.GetComponents(UriComponents.Path, UriFormat.SafeUnescaped);
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2012-02-22T22:48:03.373

我找了很多答案，最流行的答案是使用[Uri.LocalPath](http://msdn.microsoft.com/en-us/library/system.uri.localpath.aspx)。但是如果路径包含“#”，System.Uri 无法给出正确的 LocalPath。详情在[这里](https://stackoverflow.com/questions/896572/system-uri-fails-to-give-correct-absolutepath-and-localpath-if-the-path-contains)。

我的解决方案是：

```
private static string ConvertUriToPath(string fileName)
{
   Uri uri = new Uri(fileName);
   return uri.LocalPath + Uri.UnescapeDataString(uri.Fragment).Replace('/', '\\');
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-10T19:01:24.910

你能用`Assembly.Location`吗？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-10T07:59:03.067

位置可以与 CodeBase 不同。例如，对于 ASP.NET 中的文件，它可能会在 c:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\Temporary ASP.NET 下解析。请参阅“Assembly.CodeBase 与 Assembly.Location” [http://blogs.msdn.com/suzcook/archive/2003/06/26/57198.aspx](http://blogs.msdn.com/suzcook/archive/2003/06/26/57198.aspx)

# c# - 如何在 C# 中检测截断的文件

> ID：278768
> 
> 赞同：1
> 
> 时间：2008-11-10T18:46:41.117
> 
> 标签：c#, .net

如果我正在以共享访问模式读取文本文件并且另一个进程将其截断，那么最简单的检测方法是什么？（我排除了定期刷新 FileInfo 对象以检查其大小的明显选择）是否有一些方便的方法来捕获事件？（文件观察者？）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-10T18:55:39.993

有，**它被称为[FileSystemWatcher](http://msdn.microsoft.com/en-us/library/system.io.filesystemwatcher.aspx)**。

如果您正在开发 Windows 窗体应用程序，您可以从工具箱中拖放它。

这是一些使用示例：

```
private void myForm_Load(object sender, EventArgs e)
{
    var fileWatcher = new System.IO.FileSystemWatcher();

    // Monitor changes to PNG files in C:\temp and subdirectories
    fileWatcher.Path = @"C:\temp";
    fileWatcher.IncludeSubdirectories = true;
    fileWatcher.Filter = @"*.png";

    // Attach event handlers to handle each file system events
    fileWatcher.Changed += fileChanged;
    fileWatcher.Created += fileCreated;
    fileWatcher.Renamed += fileRenamed;

    // Start monitoring!
    fileWatcher.EnableRaisingEvents = true;
}

void fileRenamed(object sender, System.IO.FileSystemEventArgs e)
{
    // a file has been renamed!
}

void fileCreated(object sender, System.IO.FileSystemEventArgs e)
{
    // a file has been created!
}

void fileChanged(object sender, System.IO.FileSystemEventArgs e)
{
    // a file is modified!
} 
```

它位于 System.IO 和 System.dll 中，因此您应该能够在大多数类型的项目中使用它。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-10T21:41:24.057

FSW 不能可靠地工作，它是异步的。假设您没有收到异常，StreamReader.ReadLine() 将在文件被截断时返回 null。然后检查大小是否改变。当心不可避免的竞争条件，您需要验证有关时间的假设。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-10T19:10:23.567

只是一些值得咀嚼的东西；它可能不适用于您的情况：

chakrit 的解决方案对于您的要求是正确的，但我不得不问 - 为什么您正在读取文件而另一个进程截断它？

特别是，如果你没有一些同步，并发读/写文件不是特别安全，你可能会发现你还有其他神秘的问题。

# asp.net - 如何在客户端取消服务器控制事件？

> ID：278769
> 
> 赞同：0
> 
> 时间：2008-11-10T18:46:42.007
> 
> 标签：asp.net, events, validation

我有一个 asp.net 图像按钮，我想取消点击事件，以防他未能通过客户端验证......我该怎么做？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-10T18:58:39.673

有一个 OnClientClick 事件，您可以将其设置为您的 javascript 函数。如果您返回 true，它将继续回帖。如果您返回 false，则不会发生回帖。

```
<asp:Button ID="NavigateAway" runat="server" OnClientClick="javascript:return PromptToNavigateOff();" OnClick="NavigateAwayButton_Click" Text="Go Away" />

  <script type="text/javascript">
    function PromptToNavigateOff()
    {
        return confirm("Are you sure you want to continue  and loose all your changes?");
    }

  </script> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-10T19:04:17.340

```
<asp:ImageButton OnClientClick="return ValidatorOnSubmit()" /> 
```

如果表单上有验证器，则 ASP.NET 框架应该已经包含 ValidatorOnSubmit() 函数。标准的 WebForm onsubmit 函数如下所示：

```
function WebForm_OnSubmit() {
   if (   typeof(ValidatorOnSubmit) == "function" 
       && ValidatorOnSubmit() == false) return false;

   return true;
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-10T18:59:53.947

我会简单地反转逻辑，并且在用户填写信息之前不允许用户单击按钮。放置强制性标记，如果已填充，则启用该按钮。

# sql-server - Amazon EC2 Sql 性能

> ID：278776
> 
> 赞同：13
> 
> 时间：2008-11-10T18:49:26.073
> 
> 标签：sql-server, performance, amazon-ec2

我正在考虑将亚马逊的 EC2 与 Windows 实例和 SQL 一起使用。我在这里看到[了一些对](http://www.brentozar.com/archive/2008/11/bad-storage-performance-on-amazon-ec2-windows-servers/)SQL 实例性能的批评。我想知道是否有任何 SOers 有第一手经验并且可以对性能发表评论。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-11T17:48:05.043

我刚刚启动了一个带有 SQL 2005 Express 的 32 位 Server 2003 m1 小型实例，并进行了快速操作。只是使用提供的机器磁盘，而不是附加的卷。在阅读了您帖子中链接的文章后，我预计性能会非常糟糕。这不是很好，但也不错。

我的“测试”相当简单。创建了一个表，其中包含一个标识列、一些文本 (varchar) 列和一些与一些基本查找有关系的整数外键列。

插入 100 万条记录大约需要一分钟，使用 Like '% 强制执行表扫描大约需要一秒钟来更新 200,000 行数据块。

这并没有告诉我们任何关于重负载下性能的信息。

结论：不是很好，但可能会更糟——尤其是考虑到“磁盘”存储在 aws 上的方式。我不认为这真的是一个大型 SQL Server 安装的地方，许多小型安装可能是一个更有趣的前景。我也有兴趣了解 db 在许多小型附加卷上的性能如何。

我希望在即将到来的项目中使用 EC2，并将在接下来的几周内进行一些更彻底的测试。- 我会在结果可用时发布。

期待看到其他人的经历。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-11T21:53:34.047

请记住，EC2 在首次写入临时存储上的块以及首次访问 EBS 时会影响性能。因此，没有考虑到这一点的基准可能不能代表长期运行系统的性能。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-11T21:30:41.410

我自己对此非常感兴趣，但还没有机会进行任何测试。关于您的测试的一个问题，您是使用 EC2 实例附带的标准存储，还是 Server Server EC2 实例自动使用 Amazon 的[Elastic Block Storage](http://aws.amazon.com/ebs/)？我对ABS知之甚少，但他们确实这么说

> “几乎在所有情况下，Amazon EBS 卷的延迟和吞吐量都明显优于 Amazon EC2 实例存储。您还可以将多个卷附加到一个实例并跨卷进行条带化。”

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-31T18:15:48.493

到目前为止，我有限的经验表明，将 Elastic Block Storage 用于数据库存储是必不可少的。使用 EBS 时，性能似乎与独立的开发机器大致相当。我还没有运行详细的性能统计数据——只是总体感觉。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-15T07:33:37.393

EC2 论坛中有一个帖子讨论了这个问题：

[http://developer.amazonwebservices.com/connect/thread.jspa?threadID=26118&start=0&tstart=0](http://developer.amazonwebservices.com/connect/thread.jspa?threadID=26118&start=0&tstart=0)

AWS 人员的最后几篇文章指出，考虑到这种随机 I/O 负载，8MB/秒几乎是您对任何单个磁盘所能期望的。

# sql-server - T-SQL：在 WHERE 中使用 { fn NOW() }

> ID：278777
> 
> 赞同：16
> 
> 时间：2008-11-10T18:49:33.453
> 
> 标签：sql-server, tsql

我正在查看一些 SQL 查询，我看到一个看起来像这样的 select 语句

```
SELECT *
FROM dbo.mytable
WHERE (dbo.mytable.[Date] < { fn NOW() }) 
```

使用这样的 WHERE 语句的目的是什么？

使用简单的 GETDATE() 会不会更容易？

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-11-10T19:06:39.097

[http://www.sqlservercentral.com/Forums/Topic183904-8-1.aspx](http://www.sqlservercentral.com/Forums/Topic183904-8-1.aspx)

GETDATE() 是一个 T-SQL 特定函数，它返回当前系统日期和时间。SQL 标准等效项是 CURRENT_TIMESTAMP，它也适用于 T-SQL。{fn Now()} 是一个 ODBC 规范函数，可以在 T-SQL 中使用，因为 SQL Server 的 OLE DB 提供程序支持它们。但是，它们之间没有显着的性能差异。您还可以使用规范格式，例如：

```
SELECT {fn CURRENT_TIMESTAMP()} AS "date & time",
       {fn CURRENT_DATE()} AS "date only",
       {fn CURRENT_TIME()} AS "time only" ; 
```

# c++ - 当您想试验 C++0x 功能时，最好使用什么编译器？

> ID：278784
> 
> 赞同：5
> 
> 时间：2008-11-10T18:52:17.627
> 
> 标签：c++, compiler-construction

试验 C++0x 功能的最佳编译器是什么？我一直在试验 GNU g++ 4.4。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-10T19:06:49.737

绝对是**GCC 中继线**。**ConceptGCC**错过了 GCC 主干的许多功能。它目前正在合并到 GCC 中。它具有所有这些功能，包括新的`auto`类型变量（虽然还没有新的函数声明语法）：[http](http://gcc.gnu.org/projects/cxx0x.html) ://gcc.gnu.org/projects/cxx0x.html 。

有一个包含部分 lambda 支持的 GCC 分支，它还包含其他 C++0x 功能。我建议你也试试那个。它正在使用中`#geordi at irc.freenode.org`，您可以在那里进行试验。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-10T19:19:51.003

**[Comeau](http://www.comeaucomputing.com/tryitout/)** - 只是为了在线尝试

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-10T18:56:34.407

如果我没记错的话，[ConceptGCC](http://www.generic-programming.org/software/ConceptGCC/) [（wiki）就是为此目的而制作的。](http://en.wikipedia.org/wiki/ConceptGCC)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-10T19:26:33.270

它可能不是 C++0x 实验的最佳选择，但对于面向 MSVC 的人来说，有一个 VS2010 的“社区技术预览”（CTP），其中包含 VC10 的预览，其中实现了 C++0x 的*某些*部分（注意即使 VC10 发布，VC10 也不会实现完整的 C++0x 更改集）：

[http://www.microsoft.com/downloads/details.aspx?FamilyId=922B4655-93D0-4476-BDA4-94CF5F8D4814&displaylang=en](http://www.microsoft.com/downloads/details.aspx?FamilyId=922B4655-93D0-4476-BDA4-94CF5F8D4814&displaylang=en)

有关 VC10 CTP 中的新功能的一些详细信息：

*   [Visual Studio 2010 CTP 发布](http://blogs.msdn.com/vcblog/archive/2008/10/28/visual-studio-2010-ctp-released.aspx)
*   [Lambdas、auto 和 static_assert：VC10 中的 C++0x 特性，第 1 部分](http://blogs.msdn.com/vcblog/archive/2008/10/28/lambdas-auto-and-static-assert-c-0x-features-in-vc10-part-1.aspx)

如上文所述，“Microsoft Visual Studio 2010 年 9 月社区技术预览版 (CTP) 中的 Visual C++ 编译器包含对四种 C++0x 语言功能的支持，即：”

*   拉姆达，
*   汽车，
*   静态断言，
*   右值引用

# c# - 从引用的回复中解析电子邮件内容

> ID：278788
> 
> 赞同：90
> 
> 时间：2008-11-10T18:54:29.900
> 
> 标签：c#, ruby, email, email-parsing

我试图弄清楚如何从它可能包含的任何引用的回复文本中解析出电子邮件的文本。我注意到，通常电子邮件客户会写上“在某某日期某某某写”或在行前加上尖括号。不幸的是，并不是每个人都这样做。有谁知道如何以编程方式检测回复文本？我正在使用 C# 编写此解析器。

* * *

## 回答 #1

> 赞同：61
> 
> 时间：2008-11-10T22:35:28.753

我对此进行了更多搜索，这就是我发现的。基本上有两种情况下你会这样做：当你有整个线程时，当你没有时。我将其分为以下两类：

**当你有线程时：**

如果您拥有整个系列的电子邮件，则可以高度确保您删除的内容实际上是引用的文本。有两种方法可以做到这一点。一，您可以使用消息的 Message-ID、In-Reply-To ID 和 Thread-Index 来确定单个消息、它的父级以及它所属的线程。有关这方面的更多信息，请参阅[RFC822](http://www.faqs.org/rfcs/rfc822.html)、[RFC2822](http://www.faqs.org/rfcs/rfc2822.html)、这篇关于线程的[有趣文章](http://www.jwz.org/doc/threading.html)或[这篇关于线程](http://people.dsv.su.se/~jpalme/ietf/message-threading.html)的文章。重新组装线程后，您可以删除外部文本（例如 To、From、CC 等...行），您就完成了。

如果您正在处理的邮件没有标题，您还可以使用相似性匹配来确定电子邮件的哪些部分是回复文本。在这种情况下，您只能进行相似性匹配以确定重复的文本。在这种情况下，您可能需要查看[Levenshtein 距离算法](http://en.wikipedia.org/wiki/Levenshtein_distance)，例如[Code Project 上](http://www.codeproject.com/KB/recipes/Levenshtein.aspx)的这个或[这个](http://www.codeproject.com/KB/recipes/improvestringsimilarity.aspx)。

无论如何，如果您对线程处理过程感兴趣，请查看[这个关于重新组装电子邮件线程的精彩 PDF](http://academiccommons.columbia.edu/download/fedora_content/download/ac:162861/CONTENT/yeh_harnly_06.pdf)。

**当你没有线程时：**

如果您只被线程中的一条消息卡住，那么您将不得不尝试猜测引用是什么。在这种情况下，以下是我见过的不同报价方法：

1.  一条线（如前景中所见）。
2.  尖括号
3.  “ - -原始信息 - -”
4.  “某某某日，某某写道：”

从那里删除文本，你就完成了。其中任何一个的缺点是他们都假设发件人将他们的回复放在引用的文本之上并且没有交错（就像互联网上的旧风格一样）。如果发生这种情况，祝你好运。我希望这对你们中的一些人有帮助！

* * *

## 回答 #2

> 赞同：34
> 
> 时间：2009-01-23T19:33:34.897

首先，这是一项棘手的任务。

您应该收集来自不同电子邮件客户端的典型响应，并准备正确的正则表达式（或其他）来解析它们。我收集了来自 Outlook、Thunderbird、Gmail、Apple 邮件和 mail.ru 的回复。

我正在使用正则表达式以下列方式解析响应：如果表达式不匹配，我尝试使用下一个。

```
new Regex("From:\\s*" + Regex.Escape(_mail), RegexOptions.IgnoreCase);
new Regex("<" + Regex.Escape(_mail) + ">", RegexOptions.IgnoreCase);
new Regex(Regex.Escape(_mail) + "\\s+wrote:", RegexOptions.IgnoreCase);
new Regex("\\n.*On.*(\\r\\n)?wrote:\\r\\n", RegexOptions.IgnoreCase | RegexOptions.Multiline);
new Regex("-+original\\s+message-+\\s*$", RegexOptions.IgnoreCase);
new Regex("from:\\s*$", RegexOptions.IgnoreCase); 
```

最后删除报价：

```
new Regex("^>.*$", RegexOptions.IgnoreCase | RegexOptions.Multiline); 
```

这是我的一小部分测试响应（样本除以**---**）：

```
From: test@test.com [mailto:test@test.com] 
Sent: Tuesday, January 13, 2009 1:27 PM
----
2008/12/26 <test@test.com>

>  text
----
test@test.com wrote:
> text
----
      test@test.com wrote:         text
text
----
2009/1/13 <test@test.com>

>  text
----
 test@test.com wrote:         text
 text
----
2009/1/13 <test@test.com>

> text
> text
----
2009/1/13 <test@test.com>

> text
> text
----
test@test.com wrote:
> text
> text
<response here>
----
--- On Fri, 23/1/09, test@test.com <test@test.com> wrote:

> text
> text 
```

* * *

## 回答 #3

> 赞同：26
> 
> 时间：2011-09-11T03:02:08.243

谢谢你，Goleg，为正则表达式！真的有帮助。这不是 C#，但对于那里的 googlers，这是我的 Ruby 解析脚本：

```
def extract_reply(text, address)
    regex_arr = [
      Regexp.new("From:\s*" + Regexp.escape(address), Regexp::IGNORECASE),
      Regexp.new("<" + Regexp.escape(address) + ">", Regexp::IGNORECASE),
      Regexp.new(Regexp.escape(address) + "\s+wrote:", Regexp::IGNORECASE),
      Regexp.new("^.*On.*(\n)?wrote:$", Regexp::IGNORECASE),
      Regexp.new("-+original\s+message-+\s*$", Regexp::IGNORECASE),
      Regexp.new("from:\s*$", Regexp::IGNORECASE)
    ]

    text_length = text.length
    #calculates the matching regex closest to top of page
    index = regex_arr.inject(text_length) do |min, regex|
        [(text.index(regex) || text_length), min].min
    end

    text[0, index].strip
end 
```

到目前为止，它工作得很好。

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2012-07-13T13:41:49.820

到目前为止，最简单的方法是在您的内容中放置一个标记，例如：

--- 请在此行上方回复 ---

正如您毫无疑问地注意到的那样，解析引用的文本并非易事，因为不同的电子邮件客户端以不同的方式引用文本。要正确解决此问题，您需要在每个电子邮件客户端中进行说明和测试。

Facebook 可以做到这一点，但除非你的项目有很大的预算，否则你可能做不到。

Oleg 已使用正则表达式解决了该问题，以查找“2012 年 7 月 13 日，13:09，xxx 写道：”文本。但是，如果用户像许多人一样删​​除此文本或在电子邮件底部回复，则此解决方案将不起作用。

同样，如果电子邮件客户端使用不同的日期字符串，或者不包含日期字符串，则正则表达式将失败。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2008-11-10T19:08:02.620

电子邮件中没有通用的回复指标。您能做的最好的事情就是尝试捕捉最常见的模式并在遇到新模式时对其进行解析。

请记住，有些人会在引用的文本中插入回复（例如，我的老板在我问他们的同一行回答问题）所以无论您做什么，您都可能会丢失一些您希望保留的信息。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2013-02-15T21:29:49.937

这是我的 C# 版本的 @hurshagrawal 的 Ruby 代码。我不太了解 Ruby，所以它可能会关闭，但我认为我做对了。

```
public string ExtractReply(string text, string address)
{
    var regexes = new List<Regex>() { new Regex("From:\\s*" + Regex.Escape(address), RegexOptions.IgnoreCase),
                        new Regex("<" + Regex.Escape(address) + ">", RegexOptions.IgnoreCase),
                        new Regex(Regex.Escape(address) + "\\s+wrote:", RegexOptions.IgnoreCase),
                        new Regex("\\n.*On.*(\\r\\n)?wrote:\\r\\n", RegexOptions.IgnoreCase | RegexOptions.Multiline),
                        new Regex("-+original\\s+message-+\\s*$", RegexOptions.IgnoreCase),
                        new Regex("from:\\s*$", RegexOptions.IgnoreCase),
                        new Regex("^>.*$", RegexOptions.IgnoreCase | RegexOptions.Multiline)
                    };

    var index = text.Length;

    foreach(var regex in regexes){
        var match = regex.Match(text);

        if(match.Success && match.Index < index)
            index = match.Index;
    }

    return text.Substring(0, index).Trim();
} 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2011-06-01T23:40:23.817

如果您控制原始消息（例如来自 Web 应用程序的通知），您可以放置​​一个独特的、可识别的标题，并将其用作原始帖子的分隔符。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2013-04-02T11:01:00.323

这是一个很好的解决方案。找了这么久才找到。

另外，如上所述，这是明智的，因此上述表达式没有正确解析我的 gmail 和 Outlook (2010) 响应，为此我添加了以下两个正则表达式。让我知道任何问题。

```
//Works for Gmail
new Regex("\\n.*On.*<(\\r\\n)?" + Regex.Escape(address) + "(\\r\\n)?>", RegexOptions.IgnoreCase),
//Works for Outlook 2010
new Regex("From:.*" + Regex.Escape(address), RegexOptions.IgnoreCase), 
```

干杯

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2016-10-19T23:22:00.093

这是旧帖子，但是，不确定您是否知道 github 有一个提取回复[的 Ruby 库。](https://github.com/github/email_reply_parser)[如果您使用 .NET，我在https://github.com/EricJWHuang/EmailReplyParser](https://github.com/EricJWHuang/EmailReplyParser)有一个 .NET

* * *

## 回答 #10

> 赞同：-2
> 
> 时间：2018-05-30T19:42:52.187

如果您使用[SigParser.com](http://SigParser.com)的 API，它将为您提供来自单个电子邮件文本字符串的回复链中的所有中断电子邮件的数组。因此，如果有 10 封电子邮件，您将获得所有 10 封电子邮件的文本。

[![在此处输入图像描述](https://i.stack.imgur.com/2QMon.png)](https://i.stack.imgur.com/2QMon.png)

您可以在此处查看详细的 API 规范。

[https://api.sigparser.com/](https://api.sigparser.com/)

[![在此处输入图像描述](https://i.stack.imgur.com/n4QDj.png)](https://i.stack.imgur.com/n4QDj.png)

# javascript - 如何防止网络表单在“输入”上提交

> ID：278789
> 
> 赞同：2
> 
> 时间：2008-11-10T18:54:58.590
> 
> 标签：javascript, html, ruby-on-rails, webforms

我有一个预先输入的文本字段，当用户点击“Enter”时，我想进行 ajax 调用而不是同时提交表单。我的 html 看起来像这样：

```
<input id="drug_name" class="drugs_field" type="text" size="30" onkeypress="handleKeyPress(event,this.form); return false;" name="drug[name]" autocomplete="off"/>
<div id="drug_name_auto_complete" class="auto_complete" style="display: none;"/>
<script type="text/javascript">
  //<![CDATA[
  var drug_name_auto_completer = new Ajax.Autocompleter('drug_name', 'drug_name_auto_complete', '/sfc/pharmacy/auto_complete_for_drug_name', {})
  //]]>
</script> 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-10T19:07:55.193

您应该向表单本身添加一个事件处理程序，该处理程序调用一个函数来决定要做什么。

```
<form onsubmit="return someFunction();"> 
```

然后确保您的 someFunction() 在成功时返回 false。如果它返回 true，则表单将正常提交（这是您试图阻止的！）。所以你可以做你的 AJAX 调用，看看它是否成功，然后返回 false。

这样做可以在 AJAX 调用失败的情况下提供回退，并通过从函数返回 true 来正常提交表单。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-10T18:58:31.610

捕获事件并取消它。

它类似于陷阱 onSubmit(event) 和 event.ignoreDefault()。该事件可以告诉您它是由击键触发的，以及是哪个触发的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-10T19:01:05.583

您可以使用在单击时提交表单的常规按钮而不是提交按钮。

如果您希望回车键在其他字段中起作用，只需在此处处理并提交表单即可。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-10T19:03:42.783

在按钮的输入元素中执行：

```
<input type='submit' value='submit' onclick='submiFunction(); return false;'> 
```

或在表格本身

```
<form blabla onsubmit='someAjaxCall(); return false;'> 
```

这应该会阻止表单提交。
return false 是实际阻止表单提交的操作（它取消当前事件，即 sbumit）

# java - 与休眠合并导致脏对象出错

> ID：278808
> 
> 赞同：2
> 
> 时间：2008-11-10T18:59:38.940
> 
> 标签：java, hibernate, spring

我在我的应用程序中使用 Hibernate 和 Spring。我一直在使用分离的对象，并在需要调用数据库时重新附加它们。我正在使用休眠模板来为我管理连接。

我的数据结构如下：

```
classA: 
   <one-to-many name="classB" inverse="true" cascade="all,delete-orphan" lazy="true">

classB:
   <one-to-many name="classC" inverse="true" cascade="all,delete-orphan" lazy="false" fetch="subselect"> 
```

当我进行以下调用时，可能 classB 或 classC 中的某些项目已更改，我收到错误消息：

```
classA a = (classA)hibernateTemplate.merge(newClassA); 
```

我得到的错误是：

```
[11/10/08 12:08:39:126 EST] 00000024 SystemOut     O 2008-11-10 12:08:38,876  -  - ca.thedominion.cfa.persistence.hibernate.ClassADAOImpl  :updateClassA Technical Exception occurred: 
org.springframework.dao.InvalidDataAccessApiUsageException: deleted object would be re-saved by cascade (remove deleted object from associations): [ca...classC#715590]; nested exception is org.hibernate.ObjectDeletedException: deleted object would be re-saved by cascade (remove deleted object from associations): [ca...classC#715590]
    at org.springframework.orm.hibernate3.SessionFactoryUtils.convertHibernateAccessException(SessionFactoryUtils.java:639)
    at org.springframework.orm.hibernate3.HibernateAccessor.convertHibernateAccessException(HibernateAccessor.java:412)
    at org.springframework.orm.hibernate3.HibernateTemplate.doExecute(HibernateTemplate.java:424)
    at org.springframework.orm.hibernate3.HibernateTemplate.executeWithNativeSession(HibernateTemplate.java:374)
    at org.springframework.orm.hibernate3.HibernateTemplate.merge(HibernateTemplate.java:820) 
```

有人可以向我解释为什么这会产生错误吗？据我了解，合并应确定树中的哪些对象（如果有）已更改，并更新/删除/插入这些对象，而不是尝试删除和重新插入任何其他对象。但这似乎是试图删除所有 classC 类型的元素并重新插入它们。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-11T01:20:37.673

显然，您删除了其中一个 classC，但它仍保留在其中一个集合中。现在 Hibernate 很困惑该怎么办：你删除了它，但集合有 cascade="all" （包括保存，即），你要保存集合（包括删除的对象）。

您应该从集合中删除 classC 对象，而不是直接删除它，或者两者都做（从集合中删除和移除）。

# java - 通过 CreateProcess() 启动的 JVM 丢失了类路径库

> ID：278821
> 
> 赞同：2
> 
> 时间：2008-11-10T19:04:35.293
> 
> 标签：java, windows, process, jvm, classpath

我使用 CreateProcess（或 _spawnv()）从 Windows VC++ 6 程序启动以下命令行（进程）：

*   java -cp c:\dir\updates.jar;c:\dir\main.jar 主要

并且updates.jar中的类更新（覆盖main.jar中的一些）未被读取或找到。就好像无法找到或读取updates.jar 库一样。

如果我从快捷方式或从适当的命令行启动同一行，则会找到并正确执行所有内容。

如果我从命令行启动 JVM，让它保持运行，然后启动可执行存根（上图），那么一切正常。（这使得问题看起来像是文件权限问题）。

任何见解将不胜感激！

——爱德华

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-16T21:39:56.157

尝试使用 Microsoft 的 FileMon 实用程序找出发生了什么。将包含过滤器设置为“更新”以关注问题。

[http://technet.microsoft.com/en-us/sysinternals/bb896642.aspx](http://technet.microsoft.com/en-us/sysinternals/bb896642.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-13T10:59:12.573

你在另一台机器上试过这个吗？另一个操作系统？您使用的是哪个 JVM？您是否尝试过不同的 JVM？

您能否为我们提供一个演示该问题的最小示例？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-17T20:35:09.737

谢谢**jdigital**！

我尝试了 FileMon，它向我展示了我做错了什么。调用 CreateProcess() 的可执行文件有一个未关闭的更新 JAR 文件句柄，该句柄来自之前尝试复制更新 JAR 的尝试。在生产环境中有效但在测试环境中无效的错误代码。

# c# - 带有项目/数据模板的 WPF 自定义控件

> ID：278835
> 
> 赞同：6
> 
> 时间：2008-11-10T19:07:56.393
> 
> 标签：c#, wpf, wpf-controls, user-controls

我知道如何在 WPF 中创建自定义用户控件，但我怎样才能做到这一点，以便有人可以提供 ItemTemplate？

我有一个用户控件，它混合了几个其他 WPF 控件，其中一个是 ListBox。我想让控件的用户指定列表框的内容，但我不确定如何传递该信息。

编辑：接受的答案适用于以下更正：

```
<UserControl x:Class="WpfApplication6.MyControl"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:src="clr-namespace:WpfApplication6">
    <ListBox ItemTemplate="{Binding RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type src:MyControl}}, Path=ItemsSource}" />
</UserControl> 
```

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-11-10T20:19:12.617

您需要将 DependencyProperty 添加到您的控件中。如果您从 UserControl 或 Control 派生，xaml 看起来会略有不同。

```
public partial class MyControl : UserControl
{
    public MyControl()
    {
        InitializeComponent();
    }

    public static readonly DependencyProperty ItemTemplateProperty =
        DependencyProperty.Register("ItemTemplate", typeof(DataTemplate), typeof(MyControl), new UIPropertyMetadata(null));
    public DataTemplate ItemTemplate
    {
        get { return (DataTemplate) GetValue(ItemTemplateProperty); }
        set { SetValue(ItemTemplateProperty, value); }
    }
} 
```

这是 UserControl 的 xaml。

```
<UserControl x:Class="WpfApplication6.MyControl"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:src="clr-namespace:WpfApplication6">
    <ListBox ItemTemplate="{Binding ItemTemplate, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type src:MyControl}}}" />
</UserControl> 
```

这是控件的 xaml：

```
<Style TargetType="{x:Type src:MyControl}">
    <Setter Property="Template">
        <Setter.Value>
            <ControlTemplate TargetType="{x:Type src:MyControl}">
                <Border Background="{TemplateBinding Background}"
                        BorderBrush="{TemplateBinding BorderBrush}"
                        BorderThickness="{TemplateBinding BorderThickness}">

                    <ListBox ItemTemplate="{TemplateBinding ItemTemplate}" />
                </Border>
            </ControlTemplate>
        </Setter.Value>
    </Setter>
</Style> 
```

# visual-studio - Visual Studio：如何将图像资源存储为嵌入式资源？

> ID：278838
> 
> 赞同：25
> 
> 时间：2008-11-10T19:08:03.947
> 
> 标签：visual-studio, image

默认情况下，当您将图像（图标、位图等）作为资源添加到项目时，图像的**Build Action**设置为**None**。这样做是因为图像神奇地存储在 .resources 文件中。

***我***希望将资源存储为嵌入式资源（我的原因无关紧要，但让我们假设它是这样，以便我可以在**[RedGate 的 Reflector](http://reflector.red-gate.com/)**中看到它们）。

所以我将每个图像的**Build Action**更改为**Embedded Resource**，然后资源就会出现在 Lutz 的 Reflector 中 - 正是我想要的。

**不幸**的是，[微软明确表示不要这样做](http://msdn.microsoft.com/en-us/library/0c6xyb66(VS.80).aspx)：

> 请注意，当资源编辑器添加图像时，它将**Build Action**设置为 **None**，因为 .resx 文件引用了图像文件。在构建时，图像被拉入由 .resx 文件创建的 .resources 文件中。然后可以通过为 .resx 文件自动生成的强类型类轻松访问该图像。
> 
> 因此，您不应将此设置更改为**Embedded Resource**，因为这样做会在程序集中包含两次图像。

那么将图像作为嵌入式资源包含在内的**正确方法是什么？**

* * *

## 回答 #1

> 赞同：43
> 
> 时间：2009-01-27T15:39:03.157

***注意：此答案不是处理图像资源的推荐方式。它只是解决了问题所描述的特定问题（即，将图像作为嵌入式资源包含在内）。***

不要将图像添加为资源。我宁愿做以下事情：

*   创建图像/图标并将其保存到文件
*   选择 Project -> Add Existing Item 并添加文件
*   将构建操作设置为嵌入式资源

然后，您可以使用

```
Assembly.GetExecutingAssembly().GetManifestResourceStream(resourceUri) 
```

这样，图像就*不会*神奇地添加到项目资源文件中，并且您将只有一个图像副本存储在程序集的资源中。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-01-30T05:39:16.717

在项目视图中，打开属性子树；双击 Resources.resx 项。

（如果没有，右击属性项，选择打开，然后点击左侧的资源选项卡，点击页面中间的链接，即可创建默认资源文件。）

单击 resources.resx 页面顶部的第一个下拉列表。它可能会说一些无用的内容，例如“字符串”，然后选择图像。或者，您可以按`Ctrl`+ `2`。这将更改为图像资源视图。现在单击添加资源下拉列表并选择“现有文件”。选择您的图像文件并单击打开。如果您愿意，可以重命名资源。

单击保存图标。

您现在可以通过以下方式以编程方式访问您的嵌入式资源：

```
[namespace].Properties.Resources.[yourResourceName] 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-01-29T11:19:12.787

在 VS 2005 中：

*   右键单击您的项目并选择添加新项目。
*   添加资源文件。调用的是 ***myImages.resx***
    *将此文件放在项目的根文件夹中。*
*   右键单击***myImages.resx*** 并选择视图设计器
*   选择添加资源、添加现有文件。
*   浏览图像，例如***stop.bmp***
    *此图像在此阶段不必包含在项目中。资源文件将自动执行此操作。*

要在代码中引用图像，请使用以下内容：

```
btnStop.Image = myImages.Stop; 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-11-10T19:37:17.927

这取决于您要如何使用图像。

如果您想本地化和访问特定文化的特定图像，那么使用`ResourceManager`是一个很好的方法，因为它为附属程序集、搜索、回退等提供了一些很好的功能。

如果您只想在程序集中嵌入资源并且不担心本地化（使用`Assembly.GetManifestResourceStream`），那么只需添加图像并将构建操作设置为即可`Embedded Resource`。

该文档警告您不要将构建操作设置为，`Embedded Resource`因为资源编译器已通过 .resx 文件将资源编译到程序集中。

# oracle - SCN_TO_TIMESTAMP 是如何工作的？

> ID：278848
> 
> 赞同：1
> 
> 时间：2008-11-10T19:12:48.290
> 
> 标签：oracle, oracleinternals

SCN 本身是编码时间戳还是从某个表中查找。

从 AskTom 帖子中，他解释说 +/-3 秒的时间戳存储在 smon_scn_time 的原始字段中。这是函数将获得价值的地方吗？

如果是这样，那么该表何时被清除（如果有的话）？如果是这样，是什么触发了清除？

如果是，那是否就无法将旧的 SCN 转换为时间戳？

如果这是不可能的，那么它将消除该领域的任何长期使用（阅读：审计）。

如果我将该函数放入查询中，加入该表会更快吗？

如果是这样，有人知道如何隐藏那个 Raw 列吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-10T19:26:47.653

SCN 不编码时间值。我相信这是一个自动递增的数字。

我猜想 SMON 每次增加 SCN（包括当前时间戳）时都会在 SMON_SCN_TIME（或它下面的任何表）中插入一行。

我查询了几个数据库中记录的最小时间戳，它们都可以追溯到大约 5 天，并且表中的行数略低于 1500 行。所以它小于实例生命周期。

我想数据保留时间的下限可能由 DB_FLASHBACK_RETENTION_TARGET 参数确定，默认为 1 天。

我建议使用该功能，他们可能已经提供了它，因此他们可以随意更改内部结构。

不知道 RAW 列 TIM_SCN_MAP 包含什么，但 TIME_DP 和 SCN 列似乎会为您提供映射。

# asp.net - 如何在 asp.net 2 中创建友好的 url

> ID：278856
> 
> 赞同：1
> 
> 时间：2008-11-10T19:16:39.233
> 
> 标签：asp.net, url-rewriting, asp.net-2.0, friendly-url

我尝试使用 IHttpModule 并设法将 url 转换得很好，但是我所有的图像都返回了路径错误（全部通过新的 url 目录）。

解决方案是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-10T20:00:52.873

您需要确保在图像上使用“~/”路径符号，并确保它们都是带有 runat='server' 的服务器控件。否则图像 url 将不会被重写。

例如，如果您有一个从以下位置重写的页面：

/项目/自行车.aspx

至

/Item.aspx?id=1234

然后会发生这样的图像引用：

```
<img src='images/something.gif' /> 
```

会破裂。因此，您必须执行以下操作：

```
<asp:image imageurl='~/images/something.gif' runat='server' id='img1'/> 
```

或者，您可以为图像使用绝对路径。或者您可以将尽可能多的内容推送到您的 .css 文件中。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-11T01:29:05.173

解决方案是什么？使用在 MVC 项目中启动并提升为独立状态的 .NET 3.5 中的新路由引擎。:)

如果 Keltex 的建议不能解决您的具体问题，请查看 ResolveUrl 和 ResolveClientUrl。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-10T19:19:37.213

您可以尝试使用 URL 重写器，例如[IIRF](http://cheeso.members.winisp.net/IIRF.aspx)。

使用 IIRF，您可以根据需要使用正则表达式解析传入的 URL，然后将其发送到正确的位置。

他们在 IIRF 下载中内置了有关如何执行所有这些操作的示例。

# .net - 此代码中的 .NET 线程

> ID：278858
> 
> 赞同：1
> 
> 时间：2008-11-10T19:17:43.630
> 
> 标签：.net, multithreading

这是我的代码：

```
ThreadStart threadStart = controller.OpenFile;
Thread thread = new Thread(threadStart);
thread.Start(); 
```

在 OpenFile 函数中，我的代码如下所示：

```
System.Console.Error.WriteLine("Launching"); 
```

OpenFile 中的代码不会在 30 秒内准确执行。它立即在我的机器上启动，但在我们的生产环境中，打印语句执行需要 30 秒。

是否有设置或可能会这样做的东西？我会从哪里开始寻找？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-10T19:23:12.433

如果您使用其他线程方法（例如，Threadpool），您是否有同样的问题？这将告诉它是否与这种线程方法或所有方法有关。另外，WriteLine 语句是您的 OpenFile 过程中唯一的语句吗？30 秒是一个常见的超时长度，所以也许这就是这里发生的事情。

除此之外，我不确定为什么线程处理程序会在处理前暂停 30 秒。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-10T20:17:54.523

正如其他人指出的那样 - 首先尝试生成一个演示该行为的测试程序。

如果不能，请尝试通过以下方式进行故障排除： 1\. 直接调用该方法，而不是在线程中，然后查看它的行为。2\. 注释掉 System.Error.WriteLine 行之外的其余代码

如果您在 (1) 中仍然看到延迟，但在 (2) 中没有看到，则尝试附加到[AppDomain.AssemblyLoad Event](http://msdn.microsoft.com/en-us/library/system.appdomain.assemblyload.aspx)。我已经看到在被调用的方法中有对 Web 服务的调用（它动态生成序列化程序集，因此需要时间），或者如果有对外部程序集的第一次引用，并且需要时间找到并加载它。这是非常罕见的，但我不得不处理这个，所以值得一试。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-10T21:03:38.737

不幸的是，jeremyZX 在评论中回答，因此无法投票，但是“如果您正在寻找日志文件的输出，则在刷新条目之前，您正在使用的任何跟踪侦听器都可能有 30 秒的超时"非常值得一看。每当您在系统中看到人类可感知的延迟时，与超时相关的代码都是首先要检查的事情之一。*特别是*如果您看到延迟落在某个类似于超时的整数 10、30、60 秒...

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-10T19:31:22.620

我的第一步是构建应用程序的测试版本，以正常方式调用 OpenFile 函数（不使用线程），看看你是否仍然得到延迟。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-10T20:13:30.460

我无法重现此问题。以下程序不会出现 30 秒延迟：

```
using System;
using System.Threading;

namespace Net_Threading_Problem
{
    class Program
    {
        static void Main()
        {
            Controller controller = new Controller();
            ThreadStart threadStart = controller.OpenFile;
            Thread thread = new Thread(threadStart);
            thread.Start();

            thread.Join();
        }
    }

    internal class Controller
    {
        public void OpenFile()
        {
            Console.Error.WriteLine("Launching");
        }
    }
} 
```

你能提供更多的上下文吗？理想情况下，一个简短但完整的程序可以演示该问题。

并且没有任何编译错误...

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-10T20:40:40.250

您的应用程序是否必须将其他程序集加载到内存中，这些程序集可能已经在您的计算机内存中？[.NET](http://en.wikipedia.org/wiki/.NET_Framework)应用程序不会立即启动，更多的程序集意味着更多的加载时间。[您可以尝试使用Native Image Generator](http://msdn.microsoft.com/en-us/library/6t9t5wcf(VS.71).aspx)进行预编译。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-10T20:57:56.610

也许您正在经历线程饥饿，这意味着您的线程没有获得执行量，因为在您的进程中有更高优先级的线程正在执行。如果此更高级别的线程仅存在于您的生产环境中而不存在于您的测试环境中，这可能会导致不同的结果。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-10T21:36:42.430

有时输出（Console、StreamWriters 等）可能会由于刷新问题而延迟。如果可以，请使用更好的日志平台，例如 log4net 或 NLog，它将记录实际调用该方法的时间戳。我有时会使用 log4net 的“OutputDebugString”功能以及 SysInternals 的 DebugView 来获得更真实的输出，尽管即使这样也容易受到时间延迟的影响。

您描述的问题似乎是缓存或性能设置，我怀疑它实际上是被立即调用的。

# type-conversion - 如何在统一 javascript 中将字符串转换为小数？

> ID：278859
> 
> 赞同：2
> 
> 时间：2008-11-10T19:18:52.987
> 
> 标签：type-conversion

如何在统一 javascript 中将字符串转换为小数？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-10T19:31:24.850

您是指 Unity 3D 中的 javascript 吗？

如果您是：Unity 使用 Mono，因此您应该可以访问**`float.Parse(str)`**or **`decimal.Parse(str)`**。（或限定名称**`System.Single.Parse(str)`**或**`System.Decimal.Parse(str)`**）

# c# - 从基类访问应用于派生类中方法的属性

> ID：278867
> 
> 赞同：4
> 
> 时间：2008-11-10T19:19:51.660
> 
> 标签：c#, attributes, custom-attributes

所以我有一个案例，我希望能够将属性应用于派生类中的（虚拟）方法，但我希望能够提供一个在我的基类中使用这些属性的默认实现.

我最初的计划是重写派生类中的方法并只调用基本实现，此时应用所需的属性，如下所示：

```
public class Base {

    [MyAttribute("A Base Value For Testing")]
    public virtual void GetAttributes() {
        MethodInfo method = typeof(Base).GetMethod("GetAttributes");
        Attribute[] attributes = Attribute.GetCustomAttributes(method, typeof(MyAttribute), true);

        foreach (Attibute attr in attributes) {
            MyAttribute ma = attr as MyAttribute;
            Console.Writeline(ma.Value);
        }
    }
}

public class Derived : Base {

    [MyAttribute("A Value")]
    [MyAttribute("Another Value")]
    public override void GetAttributes() {
        return base.GetAttributes();
    }
} 
```

这只会打印“A Base Value For Testing”，而不是我真正想要的其他值。

有人对我如何修改它以获得所需的行为有任何建议吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-10T19:25:39.153

你明确地反映了`Base`类的`GetAttributes`方法。

将实现改为使用`GetType()`。如：

```
public virtual void GetAttributes() {
    MethodInfo method = GetType().GetMethod("GetAttributes");
    // ... 
```

# java - 从 PHP exec 调用 java

> ID：278868
> 
> 赞同：6
> 
> 时间：2008-11-10T19:20:05.357
> 
> 标签：java, php, apache-flex, exec

我在 PHP 中执行以下操作：

```
exec('java -jar "/opt/flex3/lib/mxmlc.jar" +flexlib "/opt/flex3/frameworks" MyAS3App.as -default-size 360 280 -output MyAS3App.swf'); 
```

当我从命令行运行它时，它运行良好并在一两秒内完成。

当我从 PHP exec 运行此命令时，java 进程占用 100% CPU 并且永远不会返回。

有任何想法吗？

我还尝试使用“/usr/bin/java -Djava.awt.headless=true”运行上述命令。

我正在运行 Mac OS X 10.5.5、MAMP 1.7、PHP 5.2.5

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-12-12T18:45:15.880

原来这是一个特定于 PHP 堆栈 MAMP ( [http://www.mamp.info/](http://www.mamp.info/) ) 的错误。

原来在 MAMP 下任何 JVM 调用都失败了，例如：

```
exec('java -version'); 
```

解决方法是在命令前面加上

```
export DYLD_LIBRARY_PATH=""; 
```

我也意识到没有理由使用调用 mxmlc 的方法。

所以这是最终的工作命令：

```
exec('export DYLD_LIBRARY_PATH=""; mxmlc MyAS3App.as -default-size 360 280 -output MyAS3App.swf'); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-12-20T10:58:29.110

我设法让它与 MAMP 一起工作。解决方案是包括：

```
export DYLD_LIBRARY_PATH="";
in the exec call:

$argss = "export DYLD_LIBRARY_PATH=\"\"; /usr/bin/java -jar /Applications/yourjarfile.jar";
$resultXML = exec($argss, $output); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-10T19:27:08.947

您使用 mxmlc jar 文件编译您的 flex 应用程序有什么原因吗？您是否尝试过使用可执行文件或 ant 任务？

也许编译时间太长以至于您的 PHP 脚本超时？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-10T19:37:48.707

Exec 总是很棘手，在任何语言上 :-)

尝试：

*   使用后台执行（在末尾添加 & 符号）
*   改用 shell_exec
*   指定 java 可执行文件的完整路径（可能是 PHP 可用的路径不是您需要的路径？）
*   运行一个简单的 HelloWorld java 应用程序以查看问题是在 Java 中还是在 mxmlc 中

奇怪的是java占用了100%的CPU。我无法用使用 exec() 时犯的任何常见错误来解释它...尝试向它发送一个 SIGQUIT 以转储线程，然后读取转储 - 可能你会弄清楚一些事情。

# c++ - VS2008 有多少 C++0x 支持？

> ID：278870
> 
> 赞同：0
> 
> 时间：2008-11-10T19:20:54.823
> 
> 标签：c++, c++11, visual-studio-2008

VS2008 是否有某种 C++0x 标准支持？

DUPLICATE [Visual Studio 是否支持新的 C/C++ 标准？](https://stackoverflow.com/questions/146381/visual-studio-support-for-new-c-c-standards)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-10T19:33:20.180

没有啊。相信VS2010会有更多的支持：

[http://www.microsoft.com/downloads/details.aspx?FamilyId=922B4655-93D0-4476-BDA4-94CF5F8D4814&displaylang=en](http://www.microsoft.com/downloads/details.aspx?FamilyId=922B4655-93D0-4476-BDA4-94CF5F8D4814&displaylang=en)

[http://blogs.msdn.com/vcblog/archive/2008/10/28/lambdas-auto-and-static-assert-c-0x-features-in-vc10-part-1.aspx](http://blogs.msdn.com/vcblog/archive/2008/10/28/lambdas-auto-and-static-assert-c-0x-features-in-vc10-part-1.aspx)

# oracle - 使用 Oracle SET CONSTRAINTS ALL DEFERRED 查找所有外键错误

> ID：278871
> 
> 赞同：4
> 
> 时间：2008-11-10T19:21:42.593
> 
> 标签：oracle

我在用：

```
set constraints all deferred;
(lots of deletes and inserts)
commit; 
```

这按预期工作。如果存在任何损坏的关系，则提交失败并引发错误，列出它失败的 FK 之一。

用户修复有问题的数据并再次运行。然后遇到另一个 FK 问题并重复该过程。

我真正想要的是一次性列出所有 FK，这会导致提交失败。

我当然可以写一些东西来通过一个 select 语句检查每个 FK 关系（每个 FK 一个选择），但是使用延迟会话的美妙之处在于这一切都是为我处理的。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-14T18:37:00.287

设置的即时答案对我来说很好。

以另一篇文章中的 A、B、C 为例：

```
SQL> create table a (id number primary key);

Table created.

SQL> create table b (id number primary key, a_id number, constraint fk_b_to_a foreign key (a_id) references a deferrable initially immediate);

Table created.

SQL> create table c (id number primary key, b_id number, constraint fk_c_to_b foreign key (b_id) references b deferrable initially immediate);

Table created.

SQL> insert into a values (1);

1 row created.

SQL> insert into b values (1,1);

1 row created.

SQL> insert into c values (1,1);

1 row created.

SQL> commit;

Commit complete. 
```

我有一组一致的数据……我的出发点。现在我开始一个会话来更新一些数据——这就是我试图在我的帖子中描述的内容。

```
SQL> set constraints all deferred;

Constraint set.

SQL> delete from a;

1 row deleted.

SQL> delete from b;

1 row deleted.

SQL> insert into b values (10,10);

1 row created.

SQL> set constraint fk_b_to_a immediate;
set constraint fk_b_to_a immediate
*
ERROR at line 1:
ORA-02291: integrity constraint (GW.FK_B_TO_A) violated - parent key not foun

SQL> set constraint fk_c_to_b immediate;
set constraint fk_c_to_b immediate
*
ERROR at line 1:
ORA-02291: integrity constraint (GW.FK_C_TO_B) violated - parent key not foun 
```

这告诉我有关破坏的约束（C 到 B）和（B 到 A），而不回滚事务。这正是我想要的。

谢谢

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-10T19:56:46.220

Oracle 的错误机制过于原始，无法返回所有可能发生的错误的集合。我的意思是，这是一个很酷的想法，但想想如果你写了代码你必须做什么。您的标准错误处理将需要被阻止。与其在遇到错误时立即返回错误，不如继续以某种方式查看是否可以继续，如果您捕获的第一个错误根本不是错误。即使你做了所有这些，你仍然会面临你添加的修复第一个错误的行实际上会导致第二个错误的可能性。

例如：

A 是 B 的父级是 C 的父级。我推迟并插入 C。我收到一个错误，即没有 B 记录父级。我推迟并添加 B。现在我得到另一个错误，即没有 A。

这当然是可能的，没有办法提前告诉。

我认为您正在寻找服务器来完成一些真正由您负责的工作。冒着 mod -1 的风险，你正在使用一种名为“Spray and Pray”的自动武器发射技术——尽可能多地发射子弹并希望你能杀死目标。这种方法在这里行不通。您禁用您的 RI 并执行一系列步骤，并希望当数据库“评分”您的 DML 时所有 RI 最终都能正常工作。

我认为您必须编写代码。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-10T22:07:56.360

第一个选项，您可以查看[DML 错误日志记录](http://download.oracle.com/docs/cd/B19306_01/server.102/b14200/statements_9014.htm#BGBEIACB)。这样你就可以让你的约束保持活动状态，然后进行插入，错误的行进入错误表。您可以在那里找到它们、修复它们、重新插入行并将它们从错误表中删除。

第二个选项是尝试动态重新启用每个延迟约束，而不是尝试提交，以捕获错误。您将查看一个查询 ALL_CONSTRAINTS 的可延迟的 PL/SQL 过程，然后执行 EXECUTE IMMEDIATE 以使该约束立即生效。最后一点将在带有异常处理程序的块中，因此您可以捕获失败的块，但继续。

就个人而言，我会选择选项 (1)，因为您确实获得了失败的单个记录，而且您不必担心可延迟的约束并记住在此脚本之后立即再次使它们成为可能，这样以后就不会破坏某些东西.

我猜想在内存中的某个地方，Oracle 必须维护一个列表，至少是那些失败的约束，如果不是实际的行的话。我非常有信心它不会在提交时重新扫描整个表集以检查所有约束。

# unix - 在 SAP ABAP 中创建文件时如何设置（unix）权限？

> ID：278873
> 
> 赞同：6
> 
> 时间：2008-11-10T19:22:01.063
> 
> 标签：unix, abap

您会认为这很明显，但是通过文档、SAP 论坛、谷歌搜索等搜索，我非常不成功。我正在使用以下代码在 solaris 文件系统上的 ABAP 中创建一个文件：

```
OPEN DATASET p_file FOR OUTPUT IN TEXT MODE ENCODING DEFAULT. 
```

生成的文件是根据预定义的管理员用户拥有和分组的，这很好，但棘手的问题是权限设置为 660/rw-rw----，这意味着我无法检查结果。有没有办法（可能使用模糊定义的类型添加？）我可以指定新文件的结果权限？

谢谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-19T19:54:55.867

去SM69，创建一个逻辑系统命令，你可以叫它ZCHMOD。

将该命令映射到`chmod`，然后使用适当的参数调用（`man chmod`在命令行上是你的朋友）。

```
CALL FUNCTION 'SXPG_COMMAND_EXECUTE'
  EXPORTING
    commandname                   = 'ZCHMOD'
    additional_parameters         = l_par
    operatingsystem               = l_os
  TABLES
    exec_protocol                 = it_log
  EXCEPTIONS
    no_permission                 = 1
    command_not_found             = 2
    parameters_too_long           = 3
    security_risk                 = 4
    wrong_check_call_interface    = 5
    program_start_error           = 6
    program_termination_error     = 7
    x_error                       = 8
    parameter_expected            = 9
    too_many_parameters           = 10
    illegal_command               = 11
    wrong_asynchronous_parameters = 12
    cant_enq_tbtco_entry          = 13
    jobcount_generation_error     = 14
    OTHERS                        = 15. 
```

显然，这将是一个两步的过程，但它确实有效。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-01T09:23:12.943

这适用于 4.6B：

```
 CONCATENATE 'chmod ugo=rw ' lc_filename
          INTO lc_chmod SEPARATED BY space.
        CALL 'SYSTEM' ID 'COMMAND' FIELD lc_chmod. 
```

希望这可以帮助。

干杯，海科

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-24T15:14:06.103

在 RZ10 添加参数**install/umask**。默认值为007，您可以更改它：000, 002... 所以，创建的文件将是-rw-rw-rw-, -rw-rw-r--...

# oracle - 在 PL/SQL 中，我可以通过存储过程参数传递游标 FROM 子句的表模式吗？

> ID：278882
> 
> 赞同：3
> 
> 时间：2008-11-10T19:25:17.873
> 
> 标签：oracle, plsql

在 PL/SQL 中，我想将“源”模式作为参数传递给存储过程。例如：

```
BEGIN
    CURSOR my_cursor IS
      SELECT my_field FROM <schema>.my_table
... 
```

我希望“模式”值来自存储过程的输入参数。有谁知道我该怎么做？

PS 对不起，如果这是一个愚蠢的简单问题，但我是 PL/SQL 的新手，必须快速编写一些函数。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-10T19:32:21.963

除了 Mark Brady 所说的之外，另一个动态 SQL 选项是使用 REF CURSOR。由于您的示例代码包含一个游标，这将是最相关的。

```
PROCEDURE select_from_schema( the_schema VARCHAR2)
IS
  TYPE my_cursor_type IS REF CURSOR;
  my_cursor  my_cursor_type;
BEGIN
  OPEN my_cursor FOR 'SELECT my_field FROM '||the_schema||'.my_table';

  -- Do your FETCHes just as with a normal cursor

  CLOSE my_cursor;
END; 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-10T19:26:26.030

这必须使用动态 sql 来完成。

DBMS_SQL 包或 Execute Immediate 语句。

您不能在 FROM 子句中使用变量。

一个潜在的解决方案可能是

ALTER SESSION SET Current_Schema = '' <-- 你想要的模式。

该命令更改默认模式。因此，如果您有一堆同名的表，您可以保存自己的动态 SQL 并进行动态更改会话。

# javascript - 脚本缩小和与 MSBuild 的持续集成

> ID：278890
> 
> 赞同：18
> 
> 时间：2008-11-10T19:26:51.410
> 
> 标签：javascript, msbuild, continuous-integration, build-automation, minify

在我最近在 C#/ASP.NET 中工作的一个项目中，我有一些相当复杂的 JavaScript 文件和一些漂亮的样式表。当然，随着这些脚本资源的大小不断增长，[建议缩小资源](http://developer.yahoo.com/yui/compressor/)并使您的网页尽可能轻巧。我知道许多开发人员在调试后将其 JavaScript 资源手动输入压缩器，然后部署他们的应用程序。

当谈到源代码控制和在令人满意的持续集成世界中自动构建时（感谢[CruiseControl.NET](http://confluence.public.thoughtworks.org/display/CCNET/Welcome+to+CruiseControl.NET)）；手压根本不行。维护源代码控制和提供压缩资源的唯一方法是将 JS/CSS 源代码及其缩小的兄弟保存在单独的目录结构中。然后在代码隐藏中仅注册一组资源或另一组。但是，如果开发人员对 JS/CSS 源代码进行了更改，然后无法重新压缩它并签入两个版本，那么您的代码行现在不同步了。更别提不雅了。

我认为最好为 CC.NET 任务块编写一个自定义可执行文件（如果尚不存在），它将在构建操作之后但在 asp 之前找到并压缩目标目录中的所有 JavaScript 和 CSS 资源.net 发布到目标。这样，开发人员将只使用 JS 和 CSS 源代码，而用户只能获得缩小的资源。

**是否有已执行此任务的应用程序，如果没有，我应该在构建服务器上安装哪种资源以执行 CC.NET？**

（我在这里能找到的[最接近这个问题](https://stackoverflow.com/questions/258781/best-packing-strategy-for-js-during-continuous-integration)的问题需要 NAnt，在我的情况下这不是一个选项。）

**编辑：** Dave Ward 现在在他的网站 上有一篇关于[如何在 Visual Studio 中自动缩小的精彩文章。](http://encosia.com/2009/05/20/automatically-minify-and-combine-javascript-in-visual-studio/)

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-11-10T19:48:37.000

MSBuildCommunityTasks[项目](https://github.com/loresoft/msbuildtasks/)有一些 MSBuild 任务可以执行您正在寻找的任务，包括 Merge 和 JSCompress。

您可以将这些添加到 AfterBuild 目标中的 MSBuild 项目中，以允许项目在每次构建项目时执行此操作，并且不会出现任何不同步的情况。然后，您的 Web 应用程序可以引用压缩版本来运行，但开发人员将编辑完整版本。

除了 MSBuild 社区任务程序集之外，服务器上不需要其他任何东西。您可以将此程序集放在您自己的源代码树中并从那里引用，您的 CI 构建应该获得该程序集以及构建时所需的一切。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-09T05:33:06.507

另一个用于 MSBuild 的 JS（和 CSS！）压缩库：

[http://www.codeplex.com/YUICompressor](http://www.codeplex.com/YUICompressor)

这是基于 java 的[Yahoo!的 .NET 端口。压缩机](http://developer.yahoo.com/yui/compressor/)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2013-04-05T00:32:13.533

这不是一个完美的答案，但如果您使用的是 MVC4，他们会将其作为新功能内置。运行 Debug 配置时，它会输出带有注释等的单个文件，但是当您切换到 Release 时，它​​会自动捆绑、缩小和更改对缩小文件的页面引用。您可以为 jquery 和您自己的 js 设置单独的包。这适用于 CSS 和 JS 文件。

[http://www.asp.net/mvc/tutorials/mvc-4/bundling-and-minification](http://www.asp.net/mvc/tutorials/mvc-4/bundling-and-minification)

如果 MVC4 不适合您，您还可以在 Nuget 上找到可以提供帮助的软件包，例如：

[https://www.nuget.org/packages?q=minify](https://www.nuget.org/packages?q=minify)

# excel - 如何在不依赖 Office 的情况下最好地将本机数据导出到 Excel？

> ID：278896
> 
> 赞同：3
> 
> 时间：2008-11-10T19:29:41.873
> 
> 标签：excel

我们的产品需要将其原生格式（本质上是 XML 文件）导出到 Excel 以供查看/编辑。然而，这意味着我们的产品构建依赖于 Excel（或 Office）本身——这是我们不想要的。

我们所做的是将数据从我们的本机格式导出到可以在 Excel 中打开的 csv 文件。如果用户也选择了打开生成的报告的选项，我们（尝试）启动 Excel 应用程序来打开它（当然它需要 Excel 已经存在于客户端系统上）。

大部分数据是平面记录列表。

是否有更好的格式（甚至更好的方法）来处理这个要求？这是许多产品的共同要求 - 您如何处理？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-10T20:03:23.723

Excel 版本，包括 2007 年和之前的几个版本，都具有原生 XML 格式。2007 显然默认是 XML 的，更早的版本可以保存为 XML。[这个 SO question](https://stackoverflow.com/questions/174446/how-to-automate-converting-excel-xls-files-to-excel-xml-fromat)处理这个问题。我想稍微检查一下就会知道需要什么。我不知道旧版本是否存在 XSD/DTD，但稍微有创意的谷歌搜索可能会产生一些东西。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-10T20:37:18.057

正如其他人所指出的，生成 Excel XML 文件相当容易。您可以通过多种方式执行此操作。例如：

1.  通过创建模板 Excel XML 文档，然后使用 XML DOM 将数据填充到模板中，或者
2.  将模板 Excel XML 转换为 XSLT，然后简单地将您的专有 XML 作为输入传递给 XSLT。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-10T19:36:49.567

我正在使用[ExcelPackage](http://www.codeplex.com/ExcelPackage)在我的一个副项目中创建电子表格。效果很好，但是（至少我正在使用的版本）在样式和计算方面有点受限。

ExcelPackage 允许您创建与 2k7 原生兼容的 OOXML 文档（.xslx 文件），但您可以从 MS[下载适用于以前版本的 Office 的插件](http://www.microsoft.com/downloads/details.aspx?familyid=941b3470-3ae9-4aee-8f43-c6bb74cd1466&displaylang=en)。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-10T19:44:06.573

我们在客户端使用 Excel 对象（基于 COM 的代码）或 CSV 文件（通常在服务器端，但也可以在客户端使用）导出数据。我们允许以简单的 html 格式从网格中复制数据，可以毫无问题地粘贴到 Excel 中。对于一位客户，我们甚至必须将数据 [从 sql 存储过程] 导出为类似 csv 的制表符分隔格式，但命名文件如 xxxxx.xls - 这样 excel 以比 csv 文件更正确的方式打开该文件。丑陋的黑客，但运作良好。

CSV 是最兼容的格式（不依赖于外部应用程序或库），但客户不喜欢它。也许我们需要合并一些 XLS 导出代码，这样所有用户都会很高兴 :)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-10T19:54:43.727

如果 .csv 格式不够，您可以在 Excel 中创建一个模板，并使用一点 VBA 代码来导入 CSV 并对其进行适当的格式化。这样，您的应用程序只关心生成 .CSV，并且每次导出都使用相同的 .XLS。

如果你小心，你应该能够让它与大多数版本的 Excel 无缝协作。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-10T19:51:55.917

如果您使用 Java，请从 APACHE 签出 POI 项目。 [http://poi.apache.org/](http://poi.apache.org/)

简单，漂亮，完整，强大。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-10T19:52:33.917

我们从服务器上的 Office 开始，但这不是很好。我们不得不杀死挂起的进程，并且性能下降不少。我们曾考虑将它放在另一台机器上，但在尝试使用 Aspose（商业版）后并没有打扰。我们没有非常多的同时用户，但有复杂的文档。使用 csv 可以更轻松地处理简单的问题。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-10T20:02:52.913

我现在已经在几个项目中使用了 FlexCel Studio。它非常实用且快速。100% 托管代码，无依赖性。听起来您会使用“报告”功能，该功能允许您在 Excel 中定义一个空的报告模板，然后传递数据表和 volia，它会填充您的数据。

[TMS 软件](http://www.tmssoftware.com/site/flexcelnet.asp)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2011-10-21T13:19:11.893

我们使用 OleDB 和 Interop 的组合。我们发现 Interop 速度更快，使用的内存更少，但兼容性问题很麻烦，尤其是在使用不同语言安装的 Office 时。OleDb 的优点是您不需要在客户端计算机上安装 Excel。Interop 和 OleDb 都支持每个工作簿的多个工作表（表），而 csv 无法做到这一点。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2013-03-05T15:12:43.837

如果您使用的是 C# 或 VB.Net，并且您的数据位于 DataSet、DataTable 或 List<> 中，那么您可以使用我的免费“导出到 Excel”类。

它使用免费的 Microsoft *OpenXML*库（因此您*不需要*在服务器上安装 Excel），并让您只需一行代码即可将数据导出到“真实”的 .xlsx 文件中，例如：

```
DataSet ds = CreateSampleData();
CreateExcelFile.CreateExcelDocument(ds, "C:\\Sample.xlsx"); 
```

所有源代码都在下一页上提供了一个演示项目，完全免费（和弹出窗口！）

[http://mikesknowledgebase.com/pages/CSharp/ExportToExcel.htm](http://mikesknowledgebase.com/pages/CSharp/ExportToExcel.htm)

希望这可以帮助 ！

# asp.net - Membership.GetUser() & MARS

> ID：278900
> 
> 赞同：1
> 
> 时间：2008-11-10T19:31:34.163
> 
> 标签：asp.net, asp.net-membership, sql-server-mars

我正在使用 asp.net 成员资格，并且需要在我有另一个打开的 SQL 连接时调用 Membership.GetUser()，但我的代码在那个调用中死掉了。我的代码和成员资格提供程序都使用的连接字符串中有 MultipleActiveResultSets=True。Membership 类似乎忽略了连接字符串的 MARS 部分。

关于如何让 MARS 与 Membership 类一起工作的任何建议，以便我可以解决这个问题？

谢谢，

斯科特

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-11T08:27:13.083

您是否尝试在没有选项 'MultipleActiveResultSets=True' 的情况下使用单独的连接字符串（一个用于成员资格提供者的数据）？

那么它有效吗？如果它有效，您可以使用*SqlConnectionStringBuilder*创建新的连接字符串（从原始），而不使用 MARS 选项。

# c# - “使用”语句与“最终尝试”

> ID：278902
> 
> 赞同：85
> 
> 时间：2008-11-10T19:31:56.830
> 
> 标签：c#, .net, multithreading, using-statement

我有一堆属性，我将在这些属性上使用读/写锁。我可以用一个`try finally`或一个`using`子句来实现它们。

在 .`try finally`之前我会获取锁`try`，并在`finally`. 在该`using`子句中，我将创建一个类，该类在其构造函数中获取锁，并在其 Dispose 方法中释放。

我在很多地方都使用读/写锁，所以我一直在寻找可能比`try finally`. 我很想听听一些关于为什么一种方法可能不被推荐的想法，或者为什么一种方法可能比另一种更好。

方法一（`try finally`）：

```
static ReaderWriterLock rwlMyLock_m  = new ReaderWriterLock();
private DateTime dtMyDateTime_m
public DateTime MyDateTime
{
    get
    {
        rwlMyLock_m .AcquireReaderLock(0);
        try
        {
            return dtMyDateTime_m
        }
        finally
        {
            rwlMyLock_m .ReleaseReaderLock();
        }
    }
    set
    {
        rwlMyLock_m .AcquireWriterLock(0);
        try
        {
            dtMyDateTime_m = value;
        }
        finally
        {
            rwlMyLock_m .ReleaseWriterLock();
        }
    }
} 
```

方法二：

```
static ReaderWriterLock rwlMyLock_m  = new ReaderWriterLock();
private DateTime dtMyDateTime_m
public DateTime MyDateTime
{
    get
    {
        using (new ReadLock(rwlMyLock_m))
        {
            return dtMyDateTime_m;
        }
    }
    set
    {
        using (new WriteLock(rwlMyLock_m))
        {
            dtMyDateTime_m = value;
        }
    }
}

public class ReadLock : IDisposable
{
    private ReaderWriterLock rwl;
    public ReadLock(ReaderWriterLock rwl)
    {
        this.rwl = rwl;
        rwl.AcquireReaderLock(0);
    }

    public void Dispose()
    {
        rwl.ReleaseReaderLock();
    }
}

public class WriteLock : IDisposable
{
    private ReaderWriterLock rwl;
    public WriteLock(ReaderWriterLock rwl)
    {
        this.rwl = rwl;
        rwl.AcquireWriterLock(0);
    }

    public void Dispose()
    {
        rwl.ReleaseWriterLock();
    }
} 
```

* * *

## 回答 #1

> 赞同：97
> 
> 时间：2008-11-10T19:43:02.067

来自 MSDN，[使用语句（C# 参考）](http://msdn.microsoft.com/en-us/library/yh598w02.aspx)

> using 语句可确保调用 Dispose，即使在调用对象上的方法时发生异常也是如此。您可以通过将对象放在 try 块中，然后在 finally 块中调用 Dispose 来获得相同的结果；事实上，这就是编译器翻译 using 语句的方式。前面的代码示例在编译时扩展为以下代码（注意额外的花括号以创建对象的有限范围）：

```
{
  Font font1 = new Font("Arial", 10.0f);
  try
  {
    byte charset = font1.GdiCharSet;
  }
  finally
  {
    if (font1 != null)
      ((IDisposable)font1).Dispose();
  }
} 
```

所以基本上，**它是相同的代码，但有一个很好的自动空检查和一个额外的变量范围**。该文档还指出它“确保正确使用 IDisposable 对象”，因此您将来可能会为任何晦涩的情况获得更好的框架支持。

所以选择选项2。

将变量放在不再需要后立即结束*的范围内也是一个优点。*

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-11-10T19:36:22.797

我绝对更喜欢第二种方法。它在使用时更简洁，更不容易出错。

在第一种情况下，编辑代码的人必须小心不要在 Acquire(Read|Write)Lock 调用和 try 之间插入任何内容。

（不过，在像这样的单个属性上使用读/写锁通常是矫枉过正。它们最好应用在更高的级别。一个简单的锁通常就足够了，因为考虑到锁被持有的时间，争用的可能性可能非常小对于，并且获取读/写锁是比简单锁更昂贵的操作）。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-11-10T19:52:04.730

考虑两种解决方案都不好的可能性，因为**它们掩盖了异常**。

A`try`没有 a`catch`显然是个坏主意；请参阅[MSDN](http://msdn.microsoft.com/en-us/library/aa355056.aspx)，了解为什么该`using`声明同样危险。

另请注意，Microsoft 现在推荐[ReaderWriterLockSlim](http://msdn.microsoft.com/en-us/library/system.threading.readerwriterlockslim.aspx)而不是 ReaderWriterLock。

最后，请注意 Microsoft 示例使用**两个 try-catch 块**来避免这些问题，例如

```
try
{
    try
    {
         //Reader-writer lock stuff
    }
    finally
    {
         //Release lock
    }
 }
 catch(Exception ex)
 {
    //Do something with exception
 } 
```

一个简单、一致、干净的解决方案是一个很好的目标，但假设您不能只使用`lock(this){return mydateetc;}`，您可能会重新考虑该方法；有更多信息，我确信 Stack Overflow 可以提供帮助；-)

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-11-10T20:40:18.143

我个人尽可能频繁地使用 C#“使用”语句，但我会同时做一些特定的事情来避免提到的潜在问题。为了显示：

```
void doSomething()
{
    using (CustomResource aResource = new CustomResource())
    {
        using (CustomThingy aThingy = new CustomThingy(aResource))
        {
            doSomething(aThingy);
        }
    }
}

void doSomething(CustomThingy theThingy)
{
    try
    {
        // play with theThingy, which might result in exceptions
    }
    catch (SomeException aException)
    {
        // resolve aException somehow
    }
} 
```

请注意，我将“使用”语句分隔为一个方法，并将对象的使用分隔为带有“try”/“catch”块的另一种方法。我可能会为相关对象嵌套几个这样的“使用”语句（我有时会在我的生产代码中深入三到四个）。

在`Dispose()`这些自定义`IDisposable`类的方法中，我捕获异常（但不是错误）并记录它们（使用 Log4net）。我从未遇到过任何这些异常都可能影响我的处理的情况。像往常一样，允许潜在的错误向上传播调用堆栈，并且通常会通过记录适当的消息（错误和堆栈跟踪）来终止处理。

如果我以某种方式遇到在 期间可能发生重大异常的情况`Dispose()`，我会针对这种情况重新设计。坦率地说，我怀疑这永远不会发生。

同时，“使用”的范围和清理优势使其成为我最喜欢的 C# 功能之一。顺便说一句，我使用 Java、C# 和 Python 作为我的主要语言，还有很多其他的语言，“使用”是我最喜欢的语言功能之一，因为它是一种实用的日常主力.

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-11-10T19:42:06.450

[DRY](http://en.wikipedia.org/wiki/Don%27t_repeat_yourself)说：第二种解决方案。第一个解决方案重复了使用锁的逻辑，而第二个没有。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-11-10T19:43:34.280

我喜欢第三个选项

```
private object _myDateTimeLock = new object();
private DateTime _myDateTime;

public DateTime MyDateTime{
  get{
    lock(_myDateTimeLock){return _myDateTime;}
  }
  set{
    lock(_myDateTimeLock){_myDateTime = value;}
  }
} 
```

在您的两个选项中，第二个选项是最简洁且更容易理解发生了什么的。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-11-10T21:32:14.310

“一堆属性”和锁定在属性 getter 和 setter 级别看起来是错误的。您的锁定过于细粒度。在最典型的对象用法中，您需要确保获得了一个锁以同时访问*多个*属性。你的具体情况可能会有所不同，但我有点怀疑。

无论如何，当您访问对象而不是属性时获取锁将显着减少您必须编写的锁定代码量。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-11-10T19:43:13.220

Try/Catch 块通常用于异常处理，而 using 块用于确保对象被释放。

对于读/写锁，try/catch 可能是最有用的，但您也可以同时使用两者，如下所示：

```
using (obj)
{
  try { }
  catch { }
} 
```

这样您就可以隐式调用您的 IDisposable 接口以及使异常处理简洁。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2013-09-09T23:03:27.667

下面为 ReaderWriterLockSlim 类创建扩展方法，允许您执行以下操作：

```
var rwlock = new ReaderWriterLockSlim();
using (var l = rwlock.ReadLock())
{
     // read data
}
using (var l = rwlock.WriteLock())
{
    // write data
} 
```

这是代码：

```
static class ReaderWriterLockExtensions() {
    /// <summary>
    /// Allows you to enter and exit a read lock with a using statement
    /// </summary>
    /// <param name="readerWriterLockSlim">The lock</param>
    /// <returns>A new object that will ExitReadLock on dispose</returns>
    public static OnDispose ReadLock(this ReaderWriterLockSlim readerWriterLockSlim)
    {
        // Enter the read lock
        readerWriterLockSlim.EnterReadLock();
        // Setup the ExitReadLock to be called at the end of the using block
        return new OnDispose(() => readerWriterLockSlim.ExitReadLock());
    }
    /// <summary>
    /// Allows you to enter and exit a write lock with a using statement
    /// </summary>
    /// <param name="readerWriterLockSlim">The lock</param>
    /// <returns>A new object that will ExitWriteLock on dispose</returns>
    public static OnDispose WriteLock(this ReaderWriterLockSlim rwlock)
    {
        // Enter the write lock
        rwlock.EnterWriteLock();
        // Setup the ExitWriteLock to be called at the end of the using block
        return new OnDispose(() => rwlock.ExitWriteLock());
    }
}

/// <summary>
/// Calls the finished action on dispose.  For use with a using statement.
/// </summary>
public class OnDispose : IDisposable
{
    Action _finished;

    public OnDispose(Action finished) 
    {
        _finished = finished;
    }

    public void Dispose()
    {
        _finished();
    }
} 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-11-10T19:41:04.767

我认为方法2会更好。

*   属性中更简单、更易读的代码。
*   由于锁定代码不必多次重写，因此不易出错。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-11-11T05:04:19.203

虽然我同意上述许多评论，包括锁定的粒度和可疑的异常处理，但问题是方法之一。让我给你一个重要的理由，为什么我更喜欢使用 try {} finally 模型...抽象。

我有一个与您的模型非常相似的模型，但有一个例外。我定义了一个基本接口 ILock，并在其中提供了一个名为 Acquire() 的方法。Acquire() 方法返回 IDisposable 对象，因此意味着只要我正在处理的对象是 ILock 类型，它就可以用于执行锁定范围。为什么这很重要？

我们处理许多不同的锁定机制和行为。您的锁定对象可能具有特定的超时时间。您的锁实现可能是监视器锁、读取器锁、写入器锁或自旋锁。然而，从调用者的角度来看，所有这些都是无关紧要的，他们关心的是锁定资源的合约是否得到兑现，并且锁定以与其实现一致的方式执行。

```
interface ILock {
    IDisposable Acquire();
}

class MonitorLock : ILock {
    IDisposable Acquire() { ... acquire the lock for real ... }
} 
```

我喜欢你的模型，但我会考虑对调用者隐藏锁机制。FWIW，我测量了 using 技术与 try-finally 的开销，分配一次性对象的开销将有 2-3% 的性能开销。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-05-31T19:22:57.027

我很惊讶没有人建议将 try-finally 封装在匿名函数中。就像使用 using 语句实例化和处理类的技术一样，这将锁定保持在一个位置。我自己更喜欢这个，只是因为当我考虑释放锁时，我宁愿读“finally”这个词而不是“Dispose”这个词。

```
class StackOTest
{
    private delegate DateTime ReadLockMethod();
    private delegate void WriteLockMethod();

    static ReaderWriterLock rwlMyLock_m  = new ReaderWriterLock();
    private DateTime dtMyDateTime_m;
    public DateTime MyDateTime
    {
        get
        {
            return ReadLockedMethod(
                rwlMyLock_m,
                delegate () { return dtMyDateTime_m; }
            );
        }
        set
        {
            WriteLockedMethod(
                rwlMyLock_m,
                delegate () { dtMyDateTime_m = value; }
            );
        }
    }

    private static DateTime ReadLockedMethod(
        ReaderWriterLock rwl,
        ReadLockMethod method
    )
    {
        rwl.AcquireReaderLock(0);
        try
        {
            return method();
        }
        finally
        {
            rwl.ReleaseReaderLock();
        }
    }

    private static void WriteLockedMethod(
        ReaderWriterLock rwl,
        WriteLockMethod method
    )
    {
        rwl.AcquireWriterLock(0);
        try
        {
            method();
        }
        finally
        {
            rwl.ReleaseWriterLock();
        }
    }
} 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-05-31T19:54:03.297

SoftwareJedi，我没有帐户，所以我无法编辑我的答案。

无论如何，以前的版本对于通用用途来说并不是很好，因为读锁总是需要一个返回值。这解决了：

```
class StackOTest
{
    static ReaderWriterLock rwlMyLock_m  = new ReaderWriterLock();
    private DateTime dtMyDateTime_m;
    public DateTime MyDateTime
    {
        get
        {
            DateTime retval = default(DateTime);
            ReadLockedMethod(
                delegate () { retval = dtMyDateTime_m; }
            );
            return retval;
        }
        set
        {
            WriteLockedMethod(
                delegate () { dtMyDateTime_m = value; }
            );
        }
    }

    private void ReadLockedMethod(Action method)
    {
        rwlMyLock_m.AcquireReaderLock(0);
        try
        {
            method();
        }
        finally
        {
            rwlMyLock_m.ReleaseReaderLock();
        }
    }

    private void WriteLockedMethod(Action method)
    {
        rwlMyLock_m.AcquireWriterLock(0);
        try
        {
            method();
        }
        finally
        {
            rwlMyLock_m.ReleaseWriterLock();
        }
    }
} 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2012-03-26T03:49:42.030

实际上，在您的第一个示例中，为了使解决方案具有可比性，您也可以`IDisposable`在那里实现。然后你会`Dispose()`从`finally`块中调用而不是直接释放锁。

然后，您将成为“苹果对苹果”的实施（和 MSIL）（两种解决方案的 MSIL 将相同）。`using`由于增加了范围，并且框架将确保正确使用`IDisposable`（如果您自己实现，后者不太有用），因此使用它仍然可能是一个好主意`IDisposable`。

* * *

## 回答 #15

> 赞同：-1
> 
> 时间：2009-05-31T19:29:41.133

傻我。有一种方法可以使锁定方法成为每个实例的一部分（而不是像我之前的帖子中那样的静态方法），从而使事情变得更简单。现在我真的更喜欢这个，因为没有必要将 `rwlMyLock_m' 传递给其他一些类或方法。

```
class StackOTest
{
    private delegate DateTime ReadLockMethod();
    private delegate void WriteLockMethod();

    static ReaderWriterLock rwlMyLock_m  = new ReaderWriterLock();
    private DateTime dtMyDateTime_m;
    public DateTime MyDateTime
    {
        get
        {
            return ReadLockedMethod(
                delegate () { return dtMyDateTime_m; }
            );
        }
        set
        {
            WriteLockedMethod(
                delegate () { dtMyDateTime_m = value; }
            );
        }
    }

    private DateTime ReadLockedMethod(ReadLockMethod method)
    {
        rwlMyLock_m.AcquireReaderLock(0);
        try
        {
            return method();
        }
        finally
        {
            rwlMyLock_m.ReleaseReaderLock();
        }
    }

    private void WriteLockedMethod(WriteLockMethod method)
    {
        rwlMyLock_m.AcquireWriterLock(0);
        try
        {
            method();
        }
        finally
        {
            rwlMyLock_m.ReleaseWriterLock();
        }
    }
} 
```

# reporting-services - 如何折叠报表表中的元素？

> ID：278910
> 
> 赞同：2
> 
> 时间：2008-11-10T19:36:59.957
> 
> 标签：reporting-services

我有一个 SSRS 报告，我需要将数据折叠到一个汇总列中，如下所示：
+Program
-Program2
  Program2DataElement1 | 程序2数据元素2 | 等等

如何做到这一点？我在其他报告中看到它，但我一生都找不到设置它的区域。当我加入一个组时，我在所有记录上都得到了这样的信息：
Program
  ProgramDataElement | 程序数据元素 | ...

我错过了什么？提前致谢！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-10T19:52:54.883

我相信这些是步骤：

1.  编辑组
2.  单击可见性选项卡
3.  对于初始可见性，选择“隐藏”单选按钮。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2012-04-26T19:02:43.637

对于 SSRS 2008 - 我们有：

1.  在行组中选择 Program2DataElement 的组属性
2.  选择选项可见性
3.  报告最初运行时：**隐藏**
4.  可以通过此报告项切换检查显示：**Program2**

# java - 在 JSP 中呈现 JSON 数据的最佳实践是什么？

> ID：278912
> 
> 赞同：3
> 
> 时间：2008-11-10T19:37:37.163
> 
> 标签：java, ajax, json, jsp

对于一些 AJAX 请求，我需要在我的 JSP 中呈现 JSON 数据。我想知道在易于使用和稳定性方面最好的方法是什么。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-10T19:58:25.077

假设您想从一个或多个 Java 对象生成 JSON，以下是一种相当简单的方法：

*   将 Java 对象设置为请求/会话范围内的属性
*   使用标签库将对象转换为 JSON，例如[http://json-taglib.sourceforge.net/index.html](http://json-taglib.sourceforge.net/index.html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-10T20:40:11.717

我假设你已经检查了 json.org...

我最近从 json-lib 切换到 XStream：

[http://x-stream.github.io/](http://x-stream.github.io/)

肯定容易多了。只需几行代码，您就完成了。注意，它最初是一个 XML 序列化器、反序列化器。它现在支持 JSON 输出。

# html - span的语义值

> ID：278914
> 
> 赞同：14
> 
> 时间：2008-11-10T19:38:17.473
> 
> 标签：html, semantics, semantic-markup

span 元素似乎与 div 完全一样，但在行内级别而不是在块级别。但是，我似乎想不出 span 元素可以提供的任何有益的逻辑划分。

一个句子，或者一个词如果不包含在一个句子中，似乎是最小的逻辑部分。忽略 CSS，由于 CSS 仅用于布局而不用于语义，**span 何时通过切分句子或单词字符串来提供额外的语义价值**？

似乎在所有情况下，其他元素更适合添加语义值，使 span 成为纯粹的布局元素。这是真的？

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2008-11-10T19:52:27.303

Span 可用于添加超出 HTML 范围的语义含义。这可以通过使用标识某些属性的类来完成。例如，如果您正在写一部科幻小说，您可以使用 span 来识别虚构的单词，因为您可能希望以不同的方式格式化它们，或者因为您可能希望拼写检查器忽略它们：

> 然后巫师召唤<span class="wizardword">gravenwist</span>并命令它攻击正在逼近的军队。<span class="wizardword">gavenwist</span>反抗了，但巫师的<span class="wizardword">wistwand</span>太强大了。

这可以呈现为

> 然后巫师召唤了*铭文*，命令它攻击正在逼近的军队。神之*魔杖*反抗，但巫师的*魔杖*太强大了。

这种事情的另一个很好的例子是[微格式](http://microformats.org/)，它允许在 HTML 中创建任意结构：

```
<span class="tel">
 <span class="type">home</span>:
 <span class="value">+1.415.555.1212</span>
</span> 
```

与 div 相比，span 的优势在于，span 几乎可以出现在任何地方，因为它们是内联内容，而 div 是块元素，因此它们只能出现在某些其他元素内部。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-11-10T20:11:37.157

一个非常有用的好处是标记语言的变化。例如

```
<p>Welcome to Audi UK, <span lang="de">Vorsprung durch Technik</span>.</p> 
```

具有多种语言功能的屏幕阅读器可以利用这一点。

所以它们不是表象的，只是通用的。事实上，跨度很少是表现性的，只要使用语义上有意义的类名，比如“拼写错误”而不是“粗体红色文本”。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-11-10T19:44:21.360

```
<div class="name">
  <span class="firstname">John</span>
  <span class="lastname">Doe</span>
</div> 
```

这完全取决于你想表达什么。如果标记名字对您来说具有语义价值（只是为了让 CSS 挂钩来格式化名字或使用某些脚本语言提取它们），那么您可以使用跨度。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-11-10T19:45:39.627

当我想让 JavaScript 解析元素并在标签内插入一些值时，我经常使用 SPAN，例如：

```
<span datafield="firstname"></span> 
```

稍后会在其中插入一个值，因此在这种情况下它确实有意义，尽管只是我决定赋予它的意义。在这种情况下，跨度对布局没有影响的事实是理想的。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-10T19:44:37.240

`span`s实际上可以是属性形式的语义信息的*载体*`class`。这是由微格式使用的。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-11-10T19:48:51.493

span 标签需要一个 class 或 id 属性来赋予它们意义。

例如 <span class="personal_phone_number">0123 456789</span>

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-11-10T21:30:26.623

> 忽略 CSS，因为这将给出语义含义，span 什么时候通过切分句子或单词串来提供额外的语义价值？

永远不要忽略 CSS（和其他非 HTML 标记）。< `span`> 在生活中的唯一目的是携带您无法在 HTML 中表达的标记。诸如 < `span style="dropCap"`> 之类的标记，它在 HTML 中没有等价物，但在印刷出版中已经存在了数百年，并且始终只应用于一个字符 - 项目（文章等）的第一个字母，而不会导致一个分词（或任何更大的分词）。

> 似乎在所有情况下，其他元素更适合添加语义值，使 span 成为纯粹的布局元素。这是真的？

是和不是。< > 唯一真正的价值`span`是它在语义上是中性的。也就是说，与例如 < `p`> 不同，当您使用它来携带其他标记时，它不会做任何您可能希望它不会做的事情。有时，就像`span style="dropCap"`上面的 < > 一样，您不想要任何其他效果。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-11-10T19:44:03.203

如果要将格式化规则应用于标签的部分内容（例如单个单词或句子）。您可以使用 span 标签。它有时被称为无标签格式。

我在我的 EBNF -> XHTML 转换器中使用 span 将不同的格式应用于文字和标记。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-11-10T21:32:53.777

SPAN（和 DIV）元素本身通常被认为是语义中性的。一个好的方法是尽可能适当地使用语义标记，但有时您会遇到确实提供语义含义的现有 html 元素（EM、STRONG、ABBR、ACRONYM 等）在语义上不合适的情况为您的内容。所以下一步是使用语义中性的 SPAN 或 DIV 与语义上有意义的 id 或类。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-11-10T20:46:17.443

我认为他在询问 div 和 span 之间的区别，除了默认行为之外，真的没有区别。

这是一个约定俗成的问题。使用样式时，`div`通常用于划分内容的划分，而`span`用于划分内联文本。您可以轻松地`div`在任何地方使用或在任何地方使用`span`，但将它们视为不同是有帮助的，即使只是按照惯例。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-02-03T17:48:05.120

在 HTML 中可用于微格式。但是由于实际的 HTML 规范是**X** HTML，所以没有意义。代替：

```
<P>Hello, my name is <SPAN class="name"> Joe Sixpack </SPAN></P> 
```

我宁愿使用：

```
<P>Hello, my name is <FOAF:name> Joe Sixpack </FOAF:name></P> 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-04-07T16:17:07.247

SPAN 的含义是“这是（例如，文本）内容的（通用）范围”。与 DIV 比较，这意味着“这是一个逻辑划分（即，通用文档部分）”。

SPAN 主要是用于悬挂样式的挂钩（因此您可以使用`<span style='color:blue'>`代替`<font color='blue'>`）。

从[规格](http://www.w3.org/TR/REC-html40/struct/global.html#h-7.5.4)：

> DIV 和 SPAN 元素与 id 和 class 属性一起，提供了一种向文档添加结构的通用机制。这些元素将内容定义为内联 (SPAN) 或块级 (DIV)，但不会对内容强加其他表现形式。因此，作者可以将这些元素与样式表、语言属性等结合使用，以根据自己的需要和品味来定制 HTML。
> 
> 例如，假设我们想要基于客户信息数据库生成 HTML 文档。由于 HTML 不包含识别“客户”、“电话号码”、“电子邮件地址”等对象的元素，因此我们使用 DIV 和 SPAN 来实现所需的结构和呈现效果。我们可以按如下方式使用 TABLE 元素来构造信息：

```
<!-- Example of data from the client database: -->
<!-- Name: Stephane Boyera, Tel: (212) 555-1212, Email: sb@foo.org -->

<DIV id="client-boyera" class="client">
<P><SPAN class="client-title">Client information:</SPAN>
<TABLE class="client-data">
<TR><TH>Last name:<TD>Boyera</TR>
<TR><TH>First name:<TD>Stephane</TR>
<TR><TH>Tel:<TD>(212) 555-1212</TR>
<TR><TH>Email:<TD>sb@foo.org</TR>
</TABLE>
</DIV>

<DIV id="client-lafon" class="client">
<P><SPAN class="client-title">Client information:</SPAN>
<TABLE class="client-data">
<TR><TH>Last name:<TD>Lafon</TR>
<TR><TH>First name:<TD>Yves</TR>
<TR><TH>Tel:<TD>(617) 555-1212</TR>
<TR><TH>Email:<TD>yves@coucou.com</TR>
</TABLE>
</DIV> 
```

# javascript - 如何使用 Prototype new Element() 构造函数添加事件处理程序？

> ID：278927
> 
> 赞同：0
> 
> 时间：2008-11-10T19:43:59.177
> 
> 标签：javascript, html, prototypejs

我正在使用新的 Element 构造函数将一个 img 标签插入到我的文档中（这很好用）：

```
$('placeholder').insert(new Element("img", {id:'something', src:myImage})) 
```

我想在加载此图像时触发一个函数，但我无法找出正确的语法。我猜它是这样的（这是行不通的）。

```
$('placeholder').insert(new Element("img", 
    {id:'something', src:myImage, onload:function(){alert("MOO")}})) 
```

我希望在同一行代码中执行此操作，而不必单独附加事件观察器。

**编辑：**该事件需要在**创建**元素时注册，而不是之后。如果图像在附加事件之前加载，则该事件将永远不会触发。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-10-10T20:38:32.963

在这种情况下，最好的解决方案是不使用 Prototype 或至少不完全使用。这有效：

```
var img = new Element('img',{id:'logo',alt:'Hooray!'});
img.onload = function(){ alert(this.alt); };
img.src = 'logo.jpg'; 
```

The key is setting the onload directly instead of letting Prototype's wrapper do it for you, and set the src last (actually not sure about that, but I do it last to be safe).

One-liners are overrated. With proper use of local variables the above is just as good. If you must have a one-liner, create a wrapper function or hack the Prototype core to ensure proper assignment (submit a patch!).

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-10T20:04:37.730

尝试

```
$('placeholder').insert(new Element("img", {
    id: 'something', 
    src:myImage
}).observe('load', function() {
    // onload code here
})); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-10T20:03:04.520

您可能必须将函数移到其他地方并按名称调用它

```
$('placeholder').insert(new Element("img", 
    {id:'something', src:myImage, onload:"javascript:moo()"}))

function moo() {
    alert("MOO");
} 
```

当然，因为`insert`返回元素，你可以内联`Element.observe`

```
$('placeholder').insert(new Element("img", 
    {id:'something', src:myImage})).observe('load', function(){alert("MOO")}); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-04T01:05:55.910

“onload”代码不需要包装到事件处理程序中。您实际上是在此处加载元素，只需将代码放在插入之后。

```
var img = new Element('img', {id: 'something', src:'myImage.jpg'});
$('placeholder').insert(img);
// Element has loaded! It can now be mucked around with.
// The onload code goes here... 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-11T22:29:27.873

这有点糟糕，但这是你需要做的：

```
$('placeholder').insert(new Element("img", {
    id:'something', src:myImage, onload:'alert("MOO")'
})); 
```

* * *

属性对象中的值只是作为字符串插入，所以当你执行“onload：function（）{...}”时，它变成：

```
<img onload="function() {...}" /> 
```

它实际上并没有执行函数内部的代码，它只是定义了一个新的匿名函数，除非你告诉它，否则它不会执行。

* * *

如果你想成为一个忍者，你可以这样做：

```
var moo = function() { alert("MOO"); };
$('placeholder').insert(new Element("img", {
    id:'something', src:myImage, onload:'(' + moo + ')()'
})); 
```

甚至：

```
$('placeholder').insert(new Element("img", {
    id:'something', src:myImage, onload:'(' + function() { alert("MOO"); } + ')()'
})); 
```

虽然有点疯狂，但这些选项为您提供了实际的函数对象以供您在需要时使用。

# soap - JIRA SOAP API 文档？

> ID：278932
> 
> 赞同：6
> 
> 时间：2008-11-10T19:44:39.393
> 
> 标签：soap, automation, jira

我正在构建一些自定义工具来处理 JIRA 安装，并且公开的 SOAP API 很棒，除了没有命名任何参数。

例如，getIssue 的原型是：

```
RemoteIssue getIssue (string in0, string in1); 
```

所有的 SOAP RPC 方法都遵循这个约定，所以如果没有文档，我很难弄清楚要传递很多这些方法。

有人知道权威的 API 文档指南吗？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-11-10T20:01:18.940

找到javadoc：

[http://docs.atlassian.com/software/jira/docs/api/rpc-jira-plugin/latest/index.html?com/atlassian/jira/rpc/soap/JiraSoapService.html](http://docs.atlassian.com/software/jira/docs/api/rpc-jira-plugin/latest/index.html?com/atlassian/jira/rpc/soap/JiraSoapService.html)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-10T20:39:34.900

我发现直觉参数应该是什么非常简单。根据你的复杂程度，你可能会猜到你应该通过什么。

不过有一个非常重要的（这是带有 SOAPpy 的 Python）：

```
self.proxy = WSDL.Proxy( jiraUrl )
self.token = self.proxy.login(self.username, self.password)
...
issues = self.proxy.getIssuesFromFilter(self.token, args[0]) 
```

从 login() 方法获取令牌后，您需要将其作为参数传递给所有其他 SOAP 调用。在弄清楚这一点之后，很容易弄清楚参数应该是什么（例如，getIssuesFromFilter 应该将 filterId 作为它的另一个参数）

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-11T21:56:20.060

有关所有 JIRA RPC 服务，请参阅[http://confluence.atlassian.com/display/JIRA/JIRA+RPC+Services](http://confluence.atlassian.com/display/JIRA/JIRA+RPC+Services)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-10T20:33:46.283

您找到的 javadoc 链接是正确的。您还应该知道，并非所有内容都通过 SOAP 或 RPC 接口公开，但您可以使用 REST 接口执行任何操作。不幸的是，REST 接口没有很好的文档记录，但是您可以使用 HTML 流量检查器工具（如 IE 的 Fiddler）来获取从 Web 界面发送到服务器的实际 POST 数据，并将特定呼叫的接口拼凑在一起需要。并不总是最简单的方法，但它确实有效。

# c# - 如何在 C# 中设置日期/时间

> ID：278936
> 
> 赞同：2
> 
> 时间：2008-11-10T19:47:42.070
> 
> 标签：c#, datetime

如何在 C# 中设置计算机的日期/时间？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-10T20:06:40.083

您可以使用[Microsoft.VisualBasic.Today](http://msdn.microsoft.com/en-us/library/9z20y6ha(VS.80).aspx)和[Microsoft.VisualBasic.TimeOfDay](http://msdn.microsoft.com/en-us/library/8hhbhw4c(VS.80).aspx)设置日期，尽管它们受到安全限制。

是的，访问 Microsoft,VisualBasic 命名空间很奇怪，但似乎没有 C# 等价物。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-10T19:51:58.240

您必须对 Windows API 使用 P/Invoke。

这是C# 中的一些[示例代码](http://pinvoke.net/default.aspx/kernel32.SetLocalTime)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-10T19:51:57.647

您将需要通过 P/Invoke 调用[SetSystemTime Win32 API 函数。](http://www.pinvoke.net/default.aspx/kernel32.SetSystemTime)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-10T19:52:57.770

[这里](http://forums.asp.net/p/638253/639273.aspx)有一些代码来展示如何使用 Pinvoke。

# jquery - 使用 jQuery 的垂直文本

> ID：278940
> 
> 赞同：8
> 
> 时间：2008-11-10T19:49:52.910
> 
> 标签：jquery, vertical-text

我希望通过`<br />`使用 jQuery 在字符之间添加标签来垂直对齐文本。

```
<div id="foo"><label>Vertical Text</label></div> 
```

看起来像这样：

V
e
r
t
i
c
a
l

T
e
x
t

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2008-11-10T20:44:45.873

我们去打高尔夫球吧！

```
$('#foo label').html($('#foo label').text().replace(/(.)/g,"$1<br />")); 
```

完全未经测试，但正则表达式中的模式看起来像一个胸部。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2010-08-09T15:16:48.470

Kurt 先生的答案适用于单个 id，但如果您想要更有用的东西可以应用于多个元素，请尝试以下操作：

`$.each( $(".verticalText"), function () { $(this).html($(this).text().replace(/(.)/g, "$1<br />")) } );`

然后只需设置`class="verticalText"`要像这样格式化的元素。

作为奖励，它保留了 boob 正则表达式。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-10T20:04:24.567

未经测试，但它应该可以工作。

```
var element = $( '#foo label' );
var newData = '';
var data = element.text();
var length = data.length;
var i = 0;

while( i < length )
{

    newData += data.charAt( i ) + '<br />';
    i++;

}

element.html( newData ); 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2010-08-09T15:27:11.023

`document.write("vertical text".split("").join("<br/>"));`

编辑：一杆进洞！

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-10T20:15:46.290

这建立在塞巴斯蒂安 H 的回答之上，但我对其进行了测试，这很有效

```
 var element = $( '#foo label' );
    var newData = '';
    var data = element.text();
    var length = data.length;
    var i = 0;
    $( '#foo label' ).html("");
    while( i < length )
    {
            $( '#foo label' ).append(data.charAt( i ) + "<br />")
            i++;
    } 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-10T22:41:50.550

既然可以使用 jQuery 的内置 each 方法，为什么还要使用 while 循环？

`$.each( $('#foo').text(), function(){ $('#foo').append(this + '
'); } );`

那里。有用。你可以测试一下。

# asp.net-mvc - MVC LINQ to SQL 表连接记录显示

> ID：278941
> 
> 赞同：2
> 
> 时间：2008-11-10T19:49:54.580
> 
> 标签：asp.net-mvc, linq, linq-to-sql, join, html-helper

将视图数据传递给用户控件时，我无法在视图中显示记录。这仅对我使用表连接的 linq to sql 对象很明显。

我收到的异常是“无法转换类型为 '<>f__AnonymousType4 `10[System.String,System.Int32,System.Nullable`1[System.DateTime],System.String,System.String,System.String,System.String,System.String,System.Nullable `1[System.Single],System.Nullable`1[System. Double]]' 键入 App.Models.table1。"

我已经搜索了解决此问题的方法，但对这里的问题不太熟悉，我无法搜索正确的主题。这在理论上应该是可行的，这适用于单表检索，但是当我在它们中添加一个连接时，我遇到了问题。我目前正在使用 foreach 语句通过单个表声明来查询我的数据。任何帮助将不胜感激。提前致谢。

我目前的设置是：

CViewDataUC.cs（我的类专门为用户控件保存视图数据和数据连接）

```
public void Info(ViewDataDictionary viewData, int id)
    {
        var dataContext = new testDataContext();

        var info = from table1 in dataContext.table1
                   join table2 in dataContext.table2 on table1.type_id equals table2.type_id
                   join table3 in dataContext.table3 on table1.id equals table3.id
                   join table4 in dataContext.table4 on table1.id equals table4.id
                   where table1.id == id
                   select new
                   {
                       table1.column1,
                       table1.column2,
                       table1.column3,
                       table1.column4,
                       table1.column5,
                       table1.column6,
                       table1.column7,
                       table2.column1,
                       table3.column1,
                       table4.column1
                   };         

        viewData["vd_Info"] = info;

    } 
```

HomeController.cs(控制器)

```
public ActionResult Information(int id)
        {
            ViewData["Title"] = "Information";

            CViewDataUC o_info = new CViewDataUC();

            o_info.Info(this.ViewData, id);

            return View();
        } 
```

Information.aspx(查看)

```
<%@ Page Title="" Language="C#" MasterPageFile="~/Views/Shared/Site.Master" AutoEventWireup="true"
    CodeBehind="Info.aspx.cs" Inherits="App.Views.Info" %>

<asp:Content ID="Content1" ContentPlaceHolderID="MainContent" runat="server">
    <%Html.RenderPartial("~/Views/UserControls/Info.ascx", ViewData["vd_Info"]);%>
</asp:Content> 
```

Info.ascx（用户控制）

```
<%foreach (table1 m in (IEnumerable)ViewData.Model)
  { %>
<div class="left">
    <br />
    <br />
    <p id="medium">
        Column 1
        <br />
        <%= Html.TextBox("column1", m.column1, new {@class = "textBox", @readonly = "readonly" })%>
        Column 1
        <br />
        <%= Html.TextBox("column2", m.column2, new {@class = "textBox", @readonly = "readonly" })%>
        <br />
        Column 1
        <br />
        <%= Html.TextBox("column3", m.column3, new {@class = "textBox", @readonly = "readonly" })%>
                </p>
</div>
<%}%> 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-10T19:55:39.543

```
foreach (table1 m in (IEnumerable)ViewData.Model) 
```

`m`不是类型`table1`。它是一个匿名类型（`select new { ... }`在 CViewDataUC.cs 中）。

您应该创建一个类来表示您从控制器传递到视图的模型对象的类型。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-10T20:56:40.997

谢谢，这就像一个魅力。我完全忽略了这个问题，我想这是星期一，这就是为什么：P。但是对于遇到同样问题并且对 MVC 和 LINQ to SQL 还是新手的人来说，问题很容易解决，请执行以下步骤：

1.  创建一个类 CInformation.cs 添加与您的查询类似的变量

    公共类 CInformation {

    ```
    public CInformation() { }

    public string _column1{ get; set; }
    public string _column2{ get; set; }
    ... 
    ```

    }

2.  在您的查询中

    公共无效uc_VDGenInfoDC（ViewDataDictionary viewData，int id）{

    ```
     var dataContext = new testDataContext();

        IQueryable<CInformation> info = from table1 in dataContext.table1
                                        join table2 in dataContext.table2 on table1.type_id equals table2.type_id        
                                        join table3 in dataContext.table3 on table1.id equals table3.id                  
                                        join table4 in dataContext.table4 on table1.id equals table4.id                       
                   where table1.test_id == id
                   select new CInformation
                   {
                       _column1 = table1.column1.ToString(),
                       _column2 = table2.column1.ToString(),
                       ...
                   };         

        viewData["vd_Info"] = info;

    } 
    ```

3.  在您的用户控制或视图中

    foreach (CInformation m in (IEnumerable)ViewData.Model){

    ```
     m.column1
     m.column2
     ... 
    ```

    }

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-16T11:00:50.830

谢谢，这对我帮助很大！

一个小评论，你必须使用尖括号：

```
IQueryable<CInformation> info = from table1 in dataContext.table1 
```

# monitoring - 使用 MSTest 作为站点/环境监控工具

> ID：278942
> 
> 赞同：1
> 
> 时间：2008-11-10T19:50:10.133
> 
> 标签：monitoring, mstest

我们目前使用 Hp SiteScope 来监控我们的一些 Web 应用程序中的综合事务。这工作得很好，除了每个合成交易的许可成本使得确保我们的应用程序有足够的覆盖范围变得令人望而却步。

因此，另一种方法是使用 SiteScope 的 URL 监控，它基本上可以调用 URL，然后为某些字符串提供一些基本检查。使用这种方法，我想创建一个页面，该页面要么调用一堆页面，要么尝试以某种方式进入 MSTest 组以运行测试。

最后，我想要一组可用于多种环境的测试用例，用于生产验证、正常运行时间、状态等。

谢谢，马特

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-10T21:18:21.123

您看过 System Center Operations Manager 2007 吗？

我才刚刚开始，但它似乎做了你在问题中描述的事情。

我们希望监控我们的数据中心和 Web 应用程序……从我在 Web 上找到的几件事来看，它将满足我们的需求。

**更新**

我已经转移到 Application Insights。可以在这里找到一个很好的概述，[https://azure.microsoft.com/en-us/documentation/articles/app-insights-monitor-web-app-availability/](https://azure.microsoft.com/en-us/documentation/articles/app-insights-monitor-web-app-availability/)

有两种方法可以使用，一种是简单的 ping，一种是记录多步合成用户“体验”。基本上，您充当用户，并使用 IE 和 Visual Studio Web 测试项目记录您的站点导航并将该文件上传到 Azure。

例如，我记录登录、浏览几页，然后退出。只要所有这些事件及时发生，站点就处于良好的运行状态。

如果测试失败，例如响应时间过长，我会收到一封电子邮件，提醒我有些事情不完全正确。

# wpf - 在 WPF 中，如何使用 XAML 指定嵌套在目录中的文件的路径？

> ID：278943
> 
> 赞同：7
> 
> 时间：2008-11-10T19:50:26.980
> 
> 标签：wpf, xaml, file, path

我正在尝试这样做...

```
<Image x:Name="imgGroupImage" Source="Images\unlock.png" Margin="0,0,5,0" /> 
```

但我得到这个错误......

> 无法将属性“Source”中的字符串“Images\unlock.png”转换为“System.Windows.Media.ImageSource”类型的对象。找不到资源“forms/images/unlock.png”。标记文件“Fuse;component/forms/mainwindow.xaml”第 273 行位置 51 中的对象“System.Windows.HierarchicalDataTemplate”出错。

如您所见，包含此 XAML 的表单位于名为 Forms 的文件夹中。我的图像位于名为 Images 的文件夹中。如何从表单映射到图像？

我试过`Source="..Images\unlock.png"`在 WPF 中不起作用。

有什么帮助吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-10T19:57:26.950

尝试使用斜杠而不是反斜杠，并使用斜杠开头的绝对路径：

```
Source="/Images/unlock.png" 
```

这通常对我有用。

如果做不到这一点，请查看[Pack URIs](http://msdn.microsoft.com/en-us/library/aa970069.aspx)。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2011-11-29T17:46:46.480

1.  将您的图像添加到 VS 中的项目中
2.  右键单击该图像**unlock.png**
3.  转到上下文菜单/属性
4.  将构建操作更改为资源

就是这样 ：-）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-10T19:58:20.520

您是否尝试将源设置为[BitmapImage](http://msdn.microsoft.com/en-us/library/system.windows.media.imaging.bitmapimage.aspx)？

```
<Image x:Name="imgGroupImage" Margin="0,0,5,0"  >
   <Image.Source>
      <BitmapImage UriSource="Images/unlock.png" />
   </Image.Source>
</Image> 
```

`Uri`我相信for的默认类型`UriSource`是 relative `Uri`，它适用于应用程序的基类。您可能会发现您可以配置`BitmapSource`比尝试找到必须在`Source`属性中输入文件路径的确切方式更容易一些。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2017-09-04T22:01:47.250

为了使用位于与 XAML 所在文件夹不同的文件夹中的资源，请执行以下操作：

```
<Image Source="pack://application:,,,/Resources/image.png"/> 
```

其中**Resources**是您要从中使用资源的目录的名称，而**image.png 是**要显示的图像的名称。感谢@matt-hamilton 和@brian-hinchey 以及他们提到的Pack URI 找到了答案。
与您自己的转换器完美配合。您只需要返回上面的字符串匹配模式。

# xml - Flex - URLLoader 和 HTTPService

> ID：278965
> 
> 赞同：9
> 
> 时间：2008-11-10T19:55:40.917
> 
> 标签：xml, apache-flex, flash, actionscript-3

我使用 URLLoader 将数据加载到我的 Flex 应用程序（主要是 XML）中，而我做同样事情的伙伴大多使用 HTTPService。是否有特定或有效的理由在另一个上使用？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-11-11T12:50:12.350

HTTPService 继承 AbstractInvoker，它允许您使用不能与 URLLoader 一起使用的令牌和响应程序。当您需要传递与请求相关的特定变量时，令牌是很好的，您希望这些变量与响应一起返回。

除此之外，使用 URLLoader 或 HttpService 加载 xml 是相同的。

例子：

```
var token:AsyncToken = httpService.send({someVariable: 123});
token.requestStartTime = getTimer();
token.addResponder(new AsyncResponder(
    function (evt:ResultEvent, token:Object):void {
        var xml:XML = evt.result as XML;
        var startTime = token.requestStartTime;
        var runTime = getTimer() - startTime;
        Alert.show("Request took " + runTime + " ms");
        //handle response here
    },
    function (info:Object, token:Object):void {
        //handle fault here
    },
    token
)); 
```

* * *

## 回答 #2

> 赞同：-3
> 
> 时间：2008-11-10T21:13:53.630

使用两者之间确实没有区别。两种实现都可以被认为是“正确的”。

# sharepoint - 如何将评论添加到现有 Sharepoint 2007 新闻站点的新闻文章中？

> ID：278971
> 
> 赞同：2
> 
> 时间：2008-11-10T19:58:04.080
> 
> 标签：sharepoint, moss

一位客户要求在他们的新闻文章中加入评论。他们使用 Sharepoint 新闻站点模板进行新闻发布等。他们想要一个简单的评论系统，就像大多数博客引擎上可用的一样，只是他们希望在每篇新闻文章的底部都有它。

我只是想在引用自定义开发解决方案之前先询问一下开箱即用的解决方案。提前致谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-12T09:04:06.987

前段时间我为此苦苦挣扎，我们找到的解决方案是使用讨论区列表（开箱即用），我们创建了一个自定义 Web 部件，将其添加到新闻页面布局中。

我们不得不做一些诡计来添加对匿名评论的支持，但总的来说它工作得很好并且没有太多代码。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-10T22:05:56.723

[SharePoint 社区工具包](http://www.codeplex.com/CKS)为博客完成了整个评论工作。但是，您可能必须删除其中的评论部分才能使其与您的新闻部分一起使用。

CKS 增强版博客版的评论部分用于批准评论和垃圾邮件检查。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-31T11:05:30.453

我也有同样的要求。我没有找到现有的解决方案，所以我通过从标准博客站点模板复制并加上自定义编码来做到这一点。

从模板：复制博客评论列表的定义。删除查找字段，并使用一项功能在所有发布站点上创建列表。

自定义代码：向评论功能添加功能接收器，并使用它来添加页面 id 和标题的查找字段（使用页面列表作为目标）。这需要在代码中完成，因为您无法为 XML 中的查找字段配置目标列表（或者至少我不知道如何配置）。

编写用于查询和添加评论列表的控件，并放置在页面布局上。

更简单的方法：不要使用标准的博客评论列表，只需创建自己的，其中页面引用只是一个数字而不是查找字段。优点：工作量少。缺点：您错过了标准列表附带的视图。

# objective-c - 您可以使用 NSPasteBoard 粘贴到另一个应用程序中吗？

> ID：278972
> 
> 赞同：0
> 
> 时间：2008-11-10T19:58:08.603
> 
> 标签：objective-c, copy-paste

我发现了如何获取 NSPasteboard 的内容，并将其复制到我的活动应用程序中。我还没有找到将它粘贴到另一个应用程序的方法，只是如何将它粘贴到我当前的应用程序中。

如果您想知道我为什么要这样做，我正在研究是否有办法改进 Jumpcut 开源应用程序 (jumpcut.sf.net)。目前，它伪造 Cmd+v 将内容粘贴到另一个应用程序中，但这在 X11 上不起作用（需要 Ctrl+v）。

谢谢

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-10T20:11:15.923

问题是 X11 根本不真正理解 OS X 粘贴板，所以有一些特殊的魔法可以将 OS X 粘贴板上的任何内容映射到可以用作 X 粘贴板的形式。根据您准备“了解”目标应用程序的内容，您可以在发送模拟的 Ctrl-V 事件和强制应用程序请求剪贴板的内容（不是主剪辑缓冲区，它是中间-单击 X 中的一个）

# sql - 关于如何使用sql server集成服务的问题

> ID：278980
> 
> 赞同：1
> 
> 时间：2008-11-10T20:01:11.670
> 
> 标签：sql, sql-server

我有一个名为 book 的表，其属性是booked_id、yearmon 和 day_01....day_31。现在我需要取消透视表并将 day_01...day_31 转换为行，我已经成功地做到了，但问题是我的 yearmon 是 200805 的格式，我需要根据 day_01 或 day_02 在其上附加一天等等，这样我就可以创建一个包含日期信息的新列，例如，如果它是 day_01，它看起来像 20080501。而不是编写巨大的查询，有没有人如何使用 ssis 来转换它

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-10T20:56:13.150

您应该能够使用 Unpivot 组件和 Derived Column 组件来完成您需要的操作。如果他们似乎没有做你需要的事情，请查看并回发。

# sql-server - 外键是否在 SQL Server 中自动建立索引？

> ID：278982
> 
> 赞同：73
> 
> 时间：2008-11-10T20:01:30.420
> 
> 标签：sql-server, indexing, foreign-keys

下面的 SQL 语句会自动在 Table1.Table1Column 上创建一个索引，还是必须显式创建一个？

数据库引擎是 SQL Server 2000

```
 CREATE TABLE [Table1] (
. . .
            CONSTRAINT [FK_Table1_Table2] FOREIGN KEY 
            (
                [Table1Column]
            ) REFERENCES [Table2] (
                [Table2ID]
            )

        ) 
```

* * *

## 回答 #1

> 赞同：65
> 
> 时间：2008-11-10T20:05:11.927

SQL Server 不会自动在外键上创建索引。同样来自 MSDN：

> FOREIGN KEY 约束不必只链接到另一个表中的 PRIMARY KEY 约束；它也可以定义为引用另一个表中唯一约束的列。FOREIGN KEY 约束可以包含空值；但是，如果复合 FOREIGN KEY 约束的任何列包含空值，则会跳过对构成 FOREIGN KEY 约束的所有值的验证。要确保验证复合 FOREIGN KEY 约束的所有值，请在所有参与列上指定 NOT NULL。

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2008-11-10T20:35:36.547

当我阅读 Mike 的问题时，他在询问 FK 约束是否会在 FK 所在的表（表 1）中的 FK 列上创建索引。答案是否定的，而且一般来说。（出于约束的目的），没有必要这样做 另一方面，定义为约束的“目标”的列必须是引用表中的唯一索引，或者是主键或备用键。（唯一索引）或 Create Constraint 语句将失败。

（编辑：添加以明确处理下面的评论-）具体来说，当提供外键约束的数据一致性时。索引可以影响 DRI 约束的性能，仅用于删除 FK 端的一个或多个行。使用约束时，在插入或更新期间，处理器知道 FK 值，并且必须检查 PK 端的引用表中是否存在行。那里已经有一个索引。在PK端删除一行时，必须验证FK端没有行。在这种情况下，索引可能会有点帮助。但这不是常见的情况。

除此之外，在某些类型的查询中，查询处理器需要在使用该外键列的连接的多端查找记录。当该外键上存在索引时，连接性能*会提高。*但是这种情况是在连接查询中使用 FK 列所特有的，而不是外键约束的存在......连接的另一端是 PK 还是其他任意列都没有关系。此外，如果您需要根据该 FK 列过滤或排序查询结果，索引将有所帮助……同样，这与该列上的外键约束无关。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2015-11-24T23:20:51.947

不，在列上创建外键不会自动在该列上创建索引。未能索引外键列将在以下每种情况下导致表扫描：

*   每次从引用（父）表中删除一条记录。
*   每次这两个表在外键上连接。
*   每次更新 FK 列。

在此示例架构中：

```
CREATE TABLE MasterOrder (
   MasterOrderID INT PRIMARY KEY)

CREATE TABLE OrderDetail(
   OrderDetailID INT,
   MasterOrderID INT  FOREIGN KEY REFERENCES MasterOrder(MasterOrderID)
) 
```

每次删除 MasterOrder 表中的记录时都会扫描 OrderDetail。每次加入 OrderMaster 和 OrderDetail 时，也会扫描整个 OrderDetail 表。

```
 SELECT ..
   FROM 
      MasterOrder ord
      LEFT JOIN OrderDetail det
       ON det.MasterOrderID = ord.MasterOrderID
   WHERE ord.OrderMasterID = @OrderMasterID 
```

**一般来说，不索引外键更多的是例外而不是规则。**

不索引外键的情况是永远不会使用它。这将使服务器不必要的维护开销。类型表可能不时属于这一类，一个例子可能是：

```
CREATE TABLE CarType (
   CarTypeID INT PRIMARY KEY,
   CarTypeName VARCHAR(25)
)

INSERT CarType .. VALUES(1,'SEDAN')
INSERT CarType .. VALUES(2,'COUP')
INSERT CarType .. VALUES(3,'CONVERTABLE')

CREATE TABLE CarInventory (
   CarInventoryID INT,
   CarTypeID INT  FOREIGN KEY REFERENCES CarType(CarTypeID)
) 
```

假设 CarType.CarTypeID 字段永远不会被更新并且几乎永远不会删除记录，如果 CarTypeID 从未搜索过 CarInventory，那么维护 CarInventory.CarTypeID 上的索引的服务器开销将是不必要的。

# xml - 在网格视图中显示 XML-新手

> ID：278996
> 
> 赞同：2
> 
> 时间：2008-11-10T20:06:07.213
> 
> 标签：xml, visual-studio, gridview

我正在尝试在 VisualWebDev 2008 Express 中做一些我认为很简单的事情，但它不起作用。我想显示 XML 文件中的数据，所以我将 XMLDataSource 添加到我的页面，将其指向 XML 文件，然后添加 GridView 并将其连接到数据源。我收到以下错误：GridView - GridView1呈现控件时出错。id 为“GridView1”的 GridView 的数据源没有用于生成列的属性或属性。确保您的数据源有内容。

有人可以告诉我我可能做错了什么吗，TIA Dean

我的 XML 中的一个片段如下：

```
<?xml version="1.0" encoding="utf-8" standalone="yes"?>
    <Schools xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
        <SchoolProjects>
            <Project>6019 - Renaissance MS - New School</Project>
            <School>Renaissance MS</School>
            <School_Address>7155 Hall Road Fairburn, GA 30213</School_Address>
            <Cluster> NS-6019200-LA-01 </Cluster>
            <Project_Type>New School</Project_Type>
            <Phase>Close-out</Phase>
            <Proj_Num>NS-6019200</Proj_Num>
            <SqFt>0.000000000000000e+000</SqFt>
            <Scope>The construction of the new Renaissance MS will be at the intersection of Jones/Hall Road, in the districts 7th &amp; 9F and Land Lots 117, 143 &amp; 146 of Fulton County, GA.  The work includes the construction of the 180,500 square foot building that will house 34 standard classrooms, 12 standard science labs, 20 special purpose classrooms, cafeteria and litchen, gymnasium, media center and administrative offices.  The site will also have multi-purpose playfields with track, softball field, tennis courts and basketball/volleyball court.</Scope>
            <Project_Manager>Terry O'Brien</Project_Manager>
            <PM_Firm>Parsons</PM_Firm>
            <AE_Firm>Stevens Wilkinson Stang Newdow</AE_Firm>
            <Contractor>Barton Malow</Contractor>
            <Start_date xsi:nil="true" />
            <End_Date xsi:nil="true" />
            <WebAddress></WebAddress>
            <Longitude>-84.62242</Longitude>
            <Latitude>33.61497</Latitude>
        </SchoolProjects>
        ...
    </Schools> 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-10T20:32:07.880

您的 XML 格式不[正确](http://en.wikipedia.org/wiki/XML)。浏览 XML 并使用适当的[实体引用](http://en.wikipedia.org/wiki/List_of_XML_and_HTML_character_entity_references)删除或转换非法字符。检查格式是否正确的一种简单方法是将数据保存在 xml 文件中，然后尝试使用 IE 或 Firefox 打开它。浏览器会告诉它在哪里阻塞了数据。

# c# - 如何使用反射来获取显式实现接口的属性？

> ID：278997
> 
> 赞同：27
> 
> 时间：2008-11-10T20:06:19.320
> 
> 标签：c#, reflection, explicit-interface

更具体地说，如果我有：

```
public class TempClass : TempInterface
{

    int TempInterface.TempProperty
    {
        get;
        set;
    }
    int TempInterface.TempProperty2
    {
        get;
        set;
    }

    public int TempProperty
    {
        get;
        set;
    }
}

public interface TempInterface
{
    int TempProperty
    {
        get;
        set;
    }
    int TempProperty2
    {
        get;
        set;
    }
} 
```

如何使用反射来获取显式实现 TempInterface 的属性的所有 propertyInfos？

谢谢。

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2009-06-18T22:50:51.440

我认为您正在寻找的课程是 System.Reflection.InterfaceMapping。

```
Type ifaceType = typeof(TempInterface);
Type tempType = typeof(TempClass);
InterfaceMapping map = tempType.GetInterfaceMap(ifaceType);
for (int i = 0; i < map.InterfaceMethods.Length; i++)
{
    MethodInfo ifaceMethod = map.InterfaceMethods[i];
    MethodInfo targetMethod = map.TargetMethods[i];
    Debug.WriteLine(String.Format("{0} maps to {1}", ifaceMethod, targetMethod));
} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-10T20:56:43.867

显式实现的接口属性的属性 getter 和 setter 具有不寻常的属性。它的 IsFinal 属性为 True，即使它不是密封类的成员。试试这个代码来验证我的断言：

```
 foreach (AssemblyName name in Assembly.GetEntryAssembly().GetReferencedAssemblies()) {
    Assembly asm = Assembly.Load(name);
    foreach (Type t in asm.GetTypes()) {
      if (t.IsAbstract) continue;
      foreach (MethodInfo mi in t.GetMethods(BindingFlags.NonPublic | BindingFlags.Instance)) {
        int dot = mi.Name.LastIndexOf('.');
        string s = mi.Name.Substring(dot + 1);
        if (!s.StartsWith("get_") && !s.StartsWith("set_")) continue;
        if (mi.IsFinal)
          Console.WriteLine(mi.Name);
      }
    }
  } 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-11T01:40:37.570

这是基于[此博客文章](http://weblogs.asp.net/rosherove/archive/2008/10/15/use-reflection-to-find-methods-that-implement-explicit-interfaces.aspx)中给出的实现的修改后的解决方案：

```
var explicitProperties =
    from prop in typeof(TempClass).GetProperties(
        BindingFlags.NonPublic | BindingFlags.Instance | BindingFlags.DeclaredOnly)
    let getAccessor = prop.GetGetMethod(true)
    where getAccessor.IsFinal && getAccessor.IsPrivate
    select prop;

foreach (var p in explicitProperties)
    Console.WriteLine(p.Name); 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2011-06-30T03:06:47.203

基于[MrKurt 的回答](https://stackoverflow.com/questions/278997/how-do-i-use-reflection-to-get-properties-explicitly-implementing-an-interface/279014#279014)：

```
var targetMethods =
    from iface in typeof(TempClass).GetInterfaces()
    from method in typeof(TempClass).GetInterfaceMap(iface).TargetMethods
    select method;

var explicitProps =
    from prop in typeof(TempClass).GetProperties(BindingFlags.Instance |
                                                 BindingFlags.NonPublic)
    where targetMethods.Contains(prop.GetGetMethod(true)) ||
          targetMethods.Contains(prop.GetSetMethod(true))
    select prop; 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-10T20:13:47.777

它过于复杂。您必须反思接口类型的方法/属性，查看它们是否存在于您的类类型中，并比较它们以查看它们是否存在时是否“相同”。

如果接口中有内容但不是您正在测试的类型，则它是显式实现。如果两者都存在，但两者不同，则它是显式接口。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-11T14:45:51.193

我不得不修改 Jacob Carpenter 的答案，但效果很好。nobugz 也可以，但 Jacobs 更紧凑。

```
var explicitProperties =
from method in typeof(TempClass).GetMethods(BindingFlags.NonPublic | BindingFlags.Instance)
where method.IsFinal && method.IsPrivate
select method; 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2012-04-17T13:05:35.040

一个可以提供帮助的简单助手类：

```
public class InterfacesPropertiesMap
{
    private readonly Dictionary<Type, PropertyInfo[]> map;

    public InterfacesPropertiesMap(Type type)
    {
        this.Interfaces = type.GetInterfaces();
        var properties = type.GetProperties(BindingFlags.NonPublic | BindingFlags.Instance | BindingFlags.Public);

        this.map = new Dictionary<Type, PropertyInfo[]>(this.Interfaces.Length);

        foreach (var intr in this.Interfaces)
        {
            var interfaceMap = type.GetInterfaceMap(intr);
            this.map.Add(intr, properties.Where(p => interfaceMap.TargetMethods
                                                    .Any(t => t == p.GetGetMethod(true) ||
                                                              t == p.GetSetMethod(true)))
                                         .Distinct().ToArray());
        }
    }

    public Type[] Interfaces { get; private set; }

    public PropertyInfo[] this[Type interfaceType]
    {
        get { return this.map[interfaceType]; }
    }
} 
```

您将获得每个接口的属性，甚至是显式实现的。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-10T20:40:36.473

Jacob 的代码缺少过滤器：

```
 var props = typeof(TempClass).GetInterfaces().Where(i => i.Name=="TempInterface").SelectMany(i => i.GetProperties());
        foreach (var prop in props)
            Console.WriteLine(prop); 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2011-10-24T16:20:47.037

这似乎有点痛苦，没有明显的原因！

我的解决方案适用于您知道要查找的属性的名称并且非常简单的情况。

我有一门课可以让反射变得更容易一些，我只需要将这个案例添加到：

```
public class PropertyInfoWrapper
{
    private readonly object _parent;
    private readonly PropertyInfo _property;

    public PropertyInfoWrapper(object parent, string propertyToChange)
    {
        var type = parent.GetType();
        var privateProperties= type.GetProperties(BindingFlags.NonPublic | BindingFlags.Instance);

        var property = type.GetProperty(propertyToChange) ??
                       privateProperties.FirstOrDefault(p => UnQualifiedNameFor(p) == propertyName);

        if (property == null)
            throw new Exception(string.Format("cant find property |{0}|", propertyToChange));

        _parent = parent;
        _property = property;
    }

    private static string UnQualifiedNameFor(PropertyInfo p)
    {
        return p.Name.Split('.').Last();
    }

    public object Value
    {
        get { return _property.GetValue(_parent, null); }
        set { _property.SetValue(_parent, value, null); }
    }
} 
```

您不能只对 name 执行 == ，因为显式实现的属性具有完全限定的名称。

GetProperties 需要两个搜索标志才能获取私有属性。

# vbscript - 当我的 InstallShield 设置尝试运行我的 VBS 自定义操作时，为什么会收到 1720 错误？

> ID：278999
> 
> 赞同：2
> 
> 时间：2008-11-10T20:07:27.913
> 
> 标签：vbscript, windows-installer, installshield

自定义操作配置如下：

> **自定义操作名称**：MyCustomAction
> 
> **VBScript 文件名**：`<PathVar01`>\MyFolder\MyVBSfile.vbs
> 
> **脚本函数**：我的函数
> 
> **返回处理**：同步（检查退出代码）
> 
> **脚本内执行**：立即执行

它通过以下 InstallScript 代码执行：

```
result = MsiDoAction(ISMSI_HANDLE,"MyCustomAction"); 
```

当安装程序到达 InstallScript 中的该行时，安装程​​序会显示错误警报，说明：

> “错误 1720。此 Windows Installer 程序包存在问题。无法运行完成此安装所需的脚本。请联系您的支持人员或程序包供应商。”

MsiDoAction 返回的结果代码是'1603'，[根据 winerror.h](http://msdn.microsoft.com/en-us/library/ms819773.aspx)，它是：

```
//
// MessageId: ERROR_INSTALL_FAILURE
//
// MessageText:
//
//  Fatal error during installation.
//
#define ERROR_INSTALL_FAILURE            1603L 
```

为什么会这样？我开始怀疑该文件是否正确包含。然而，我指向的是正确的文件，并且我尝试通过 InstallShield 支持文件包含 VBS，认为这将确保文件与设置一起存在，但结果相同。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-11-10T20:09:45.600

在启用日志记录的情况下运行设置会发现问题：

> 行动 13:29:19：MyCustomAction。
> 动作开始 13:29:19：MyCustomAction。
> 
> 错误 1720。此 Windows 安装程序包有问题。无法运行完成此安装所需的脚本。请联系您的支持人员或软件包供应商。自定义操作 MyCustomAction 脚本错误 -2146827278，Microsoft VBScript 编译错误：**预期标识符第 163 行，第 37 列，
> blnExample）**

要在启用日志记录的情况下运行设置：

> "C:\SetupFolder\setup.exe" /V"/l*v c:\Install.log"

[这个论坛帖子](http://community.acresso.com/showthread.php?p=392282&highlight=1720#post392282)很有帮助。***