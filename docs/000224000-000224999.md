# StackOverflow 问答 000224000-000224999

# session - 如何管理 Web 集群中的会话变量？

> ID：224009
> 
> 赞同：10
> 
> 时间：2008-10-22T00:01:13.780
> 
> 标签：session, cluster-analysis

会话变量通常保存在 Web 服务器 RAM 内存中。

在集群中，客户端发出的每个请求都可以由不同的集群节点处理。正确的？！

所以，在这种情况下...

*   会话变量会发生什么？它们不是存储在节点 RAM 内存中吗？
*   如果其他节点没有我的会话变量，或者至少没有我的会话变量，其他节点将如何正确处理我的请求？
*   这个问题是由 Web 服务器（Apache、IIS）还是由语言运行时（PHP、ASP.NET、Ruby、JSP）处理的？

**编辑： Classic ASP**有什么解决方案吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-22T01:11:01.017

扩展@yogman 的答案。

[Memcached](http://www.danga.com/memcached)真是太棒了！它是一个高性能的分布式对象缓存。

即使我提到分布式，它基本上就像在您的一台备用/空闲服务器上启动一个实例一样简单，您将其配置为 ip、端口和要使用多少内存，然后就完成了。

```
memcached -d -u www -m 2048 -l 10.0.0.8 -p 11211 
```

（在守护进程模式下运行 memcached，作为用户 www，IP 10.0.0.8 上的 2048 MB (2 GB) RAM，端口为 11211。）

从那时起，您向 memcached 询问数据，如果数据尚未缓存，则从原始源中提取数据并将其存储在 memcached 中。我确定您熟悉缓存基础知识。

在集群环境中，您可以将您的 memcached 链接到集群中并跨节点复制缓存。Memcached 在 Linux、Unix 和 Windows 上运行，在您有空闲 RAM 的任何地方启动它并开始使用您的资源。

memcached 的 API 应该[普遍可用](http://www.socialtext.net/memcached/index.cgi?clients)。我说*应该*是因为我只知道 Perl、Java 和 PHP。但我确信，例如在 Python 中，人们也有办法利用它。有一个[memcached wiki](http://www.socialtext.net/memcached/index.cgi)，以防您需要指针，或者如果我说得太多，请在评论中告诉我。;)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-22T00:03:29.657

有 3 种方法可以在 ASP.NET 中存储会话状态。第一个是在进程中，变量存储在内存中。第二种是通过将以下内容放入您的 web.config 文件中来使用会话状态服务：

```
<sessionState
    mode="StateServer"
    stateConnectionString="tcpip=127.0.0.1:42424"
    sqlConnectionString="data source=127.0.0.1;user id=sa;password="
    cookieless="false"
    timeout="20" /> 
```

正如您在 stateConnectionString 属性中看到的，会话状态服务可以位于不同的计算机上。

第三种选择是使用集中式 SQL 数据库。为此，您将以下内容放入 web.config 中：

```
<sessionState
    mode="SQLServer"
    stateConnectionString="tcpip=127.0.0.1:42424"
    sqlConnectionString=
     "data source=SERVERHAME;user id=sa;password="
    cookieless="false"
    timeout="20"
/> 
```

所有这些选项的更多细节都写在这里：[http ://www.ondotnet.com/pub/a/dotnet/2003/03/24/sessionstate.html](http://www.ondotnet.com/pub/a/dotnet/2003/03/24/sessionstate.html)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-22T00:06:11.320

获取一台 Linux 机器并设置[http://www.danga.com/memcached](http://www.danga.com/memcached)。与其他方法相比，它的速度是无与伦比的。（例如，cookies、表单隐藏变量、数据库）

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-29T17:45:30.593

使用[Hazelcast](http://www.hazelcast.com)，您可以使用 Hazelcast 分布式地图在集群中存储和共享会话，或者让 Hazelcast Webapp Manager 为您完成所有工作。请查看文档以获取详细信息。Hazelcast 是用于 Java 的分布式/分区、超级精简和简单、免费的数据分发解决方案。

问候，

-塔利普

[http://www.hazelcast.com](http://www.hazelcast.com)

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-22T00:23:52.203

与各种事情一样，“这取决于”。

有不同的解决方案和方法。

如前所述，会话状态（数据库、memcached、共享文件系统等）有一个集中存储的概念。

还有集群范围的缓存系统可用，使集群中的所有机器都可以使用本地数据。从概念上讲，它类似于集中式会话状态存储，但此数据不是持久的。相反，它存在于各个节点中，并使用您的提供者提供的某种机制进行复制。

另一种方法是服务器固定。当客户端第一次访问集群时，某种机制（通常是集群前面的负载平衡器）将客户端固定到特定服务器。在典型的客户端生命周期中，该客户端将把所有时间都花在一台机器上。

对于故障转移机制，集群的每台机器都与另一台机器配对，因此任何会话更改都与配对机器共享。如果客户端固定的机器遇到问题，客户端将撞到另一台机器。此时，可能由于 cookie 的原因，新机器发现它不是客户端的原始机器，因此它会 ping 原始机器和配对机器以获取客户端会话数据。

那时，客户端很可能被固定到新机器上。

不同的平台以不同的方式做到这一点，包括根本没有会话状态。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-11T14:47:38.730

为了实现**经典 ASP 的负载平衡**，您可以**将用户特定的值存储在数据库中**，并在 URL 中传递一个**引用唯一 ID，**如下所示。

在数据库中维护一个**会话表**，为每条记录生成一个**唯一的 id**。第一次要存储会话特定数据时，在会话表中生成一条记录并将会话值存储在其中。获取新会话记录的唯一 ID 并**重写**Web 应用程序中的所有链接，以将唯一 ID 作为查询字符串的一部分发送。

在您需要会话数据的每个后续页面中，使用在查询字符串中传递的唯一 ID 查询会话表。

**例子：**

假设您的网站有 4 个页面：Login.asp、welcome.asp、taskList.asp、newtask.asp

当用户使用 login.asp 页面登录时，在验证用户后，在**会话表**中创建一条记录并存储所需的会话特定值（假设此示例中用户的***登录日期/时间***）。获取**新会话记录的唯一 ID**（假设唯一 ID 为***abcd***）。

将您网站中的所有链接附加到以下唯一 ID：

*   欢迎.asp?sessionId=abcd
*   tasklist.asp?sessionId=abcd
*   newtask.asp?sessionId=abcd

现在，如果您想在上述任何网页中显示用户的登录日期/时间，您只需使用 sessionID 参数（在本例中为***abcd***）查询会话表并显示给用户。

由于**标识会话的唯一值是 URL 的一部分，因此**为用户服务的任何 Web 服务器都将能够显示正确的登录日期/时间值。

希望这可以帮助。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-22T00:02:02.653

在 ASP.NET 中，您可以将会话数据保存到 SQL Server 数据库中，该数据库对集群中的所有 Web 服务器都是通用的。

配置后（在您网站的 web.config 中），框架会为您处理所有持久性，您可以正常访问会话数据。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-11T13:01:21.627

正如 Will 所说，大多数负载平衡方法将在分发来自同一客户端的即将到来的请求的方式中使用某种粘性，这意味着一个唯一的客户端将访问同一台服务器，除非该实际服务器出现故障。

这最大限度地减少了会话数据分发的需要，这意味着只有在服务器最终发生故障时，客户端才会失去他的会话。根据您的应用程序，这或多或少至关重要。在大多数情况下，这不是一个大问题。

即使是最简单的负载平衡方式（轮询 DNS 查找）也会产生某种粘性，因为大多数浏览器都会缓存实际的查找，因此会继续访问它收到的第一条记录，AFAIK。

通常是运行时负责会话数据，例如在 PHP 中，可以定义自己的会话处理程序，它可以将数据保存到数据库中。默认情况下，PHP 将会话数据存储在文件中，并且可以在 SAN 或同等设备上共享这些文件以共享会话数据。这只是我的一个理论，但从未测试过，因为我们认为丢失会话并不重要并且不希望出现单点故障。

# python - 字典键的Javascript样式点符号unpythonic？

> ID：224026
> 
> 赞同：25
> 
> 时间：2008-10-22T00:08:01.410
> 
> 标签：python, coding-style

我已经开始使用这样的结构：

```
class DictObj(object):
    def __init__(self):
        self.d = {}
    def __getattr__(self, m):
        return self.d.get(m, None)
    def __setattr__(self, m, v):
        super.__setattr__(self, m, v) 
```

更新：基于此线程，我已将 DictObj 实现修改为：

```
class dotdict(dict):
    def __getattr__(self, attr):
        return self.get(attr, None)
    __setattr__= dict.__setitem__
    __delattr__= dict.__delitem__

class AutoEnum(object):
    def __init__(self):
        self.counter = 0
        self.d = {}
    def __getattr__(self, c):
        if c not in self.d:
            self.d[c] = self.counter
            self.counter += 1        
        return self.d[c] 
```

其中 DictObj 是可以通过点符号访问的字典：

```
d = DictObj()
d.something = 'one' 
```

我觉得它在美学上比`d['something']`. 请注意，访问未定义的键会返回 None 而不是引发异常，这也很好。

更新：Smashery 提出了一个很好的观点，mhawke 对此进行了扩展以获得更简单的解决方案。我想知道使用**dict**而不是定义新字典是否有任何不良副作用；如果没有，我非常喜欢 mhawke 的解决方案。

AutoEnum 是一个自动递增的枚举，使用如下：

```
CMD = AutoEnum()

cmds = {
    "peek":  CMD.PEEK,
    "look":  CMD.PEEK,
    "help":  CMD.HELP,
    "poke":  CMD.POKE,
    "modify": CMD.POKE,
} 
```

两者对我来说都很好，但我对它们感觉很奇怪。

这些实际上是坏的结构吗？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-10-22T08:29:47.480

您的 DictObj 示例实际上很常见。如果您正在处理“类似于对象的事物”，即对象样式的点符号访问可能是一个胜利。它们具有固定的属性名称，仅包含在 Python 标识符中有效的字符。诸如数据库行或表单提交之类的东西可以有用地存储在这种对象中，使代码更具可读性而没有过多的 ['item access']。

实现有点有限——你没有得到很好的构造函数语法 dict、len()、比较、'in'、迭代或很好的 reprs。你当然可以自己实现这些东西，但是在新式类的世界里，你可以通过简单地继承 dict 来免费获得它们：

```
class AttrDict(dict):
    __getattr__ = dict.__getitem__
    __setattr__ = dict.__setitem__
    __delattr__ = dict.__delitem__ 
```

要获得 default-to-None 行为，只需子类化 Python 2.5 的 collections.defaultdict 类而不是 dict。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-10-22T00:40:31.577

关于`DictObj`，以下内容对您有用吗？空白类将允许您任意添加或替换容器对象中的内容。

```
class Container(object):
    pass

>>> myContainer = Container()
>>> myContainer.spam = "in a can"
>>> myContainer.eggs = "in a shell" 
```

如果你想在没有属性的时候不抛出 AttributeError ，你怎么看下面的？就个人而言，为了清楚起见，我更喜欢使用 dict，或者使用 try/except 子句。

```
class QuietContainer(object):
    def __getattr__(self, attribute):
        try:
            return object.__getattr__(self,attribute)
        except AttributeError:
            return None

>>> cont = QuietContainer()
>>> print cont.me
None 
```

对？

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-10-22T07:06:02.453

这是您的 DictObj 类的更简单版本：

```
class DictObj(object):
    def __getattr__(self, attr):
        return self.__dict__.get(attr)

>>> d = DictObj()
>>> d.something = 'one'
>>> print d.something
one
>>> print d.somethingelse
None
>>> 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-22T00:22:11.130

据我所知，Python 类无论如何都使用字典来存储它们的属性（这对程序员来说是隐藏的），所以在我看来，你在那里所做的实际上是模拟一个 Python 类......使用一个 Python 类。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-25T00:33:25.307

这样做并没有“错误”，如果您的字典在某些时候很有可能变成对象，那就更好了，但首先要警惕使用括号访问的原因：

1.  点访问不能使用关键字作为键。
2.  点访问必须在键中使用 Python 标识符有效字符。
3.  字典可以保存任何可散列的元素——不仅仅是字符串。

另外请记住，如果您决定稍后切换到对象，则始终可以让您的对象像字典一样访问。

对于这样的情况，我会默认使用“可读性很重要”的口头禅：大概其他 Python 程序员会阅读您的代码，他们可能不会期望到处都有字典/对象混合。如果对于特定情况这是一个好的设计决策，请使用它，但我不会在没有必要的情况下使用它。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-25T00:17:16.633

使用诸如 DictObj 之类的东西的一个主要缺点是您要么必须限制允许的键，要么您的 DictObj 上不能有方法，例如`.keys()`, `.values()`,`.items()`等。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2012-07-23T21:07:16.780

[这个](https://stackoverflow.com/a/224876/1413374)和[这个](https://stackoverflow.com/a/224080/1413374)答案之间存在对称性：

```
class dotdict(dict):
    __getattr__= dict.__getitem__
    __setattr__= dict.__setitem__
    __delattr__= dict.__delitem__ 
```

相同的接口，只是以相反的方式实现...

```
class container(object):
    __getitem__ = object.__getattribute__
    __setitem__ = object.__setattr__
    __delitem__ = object.__delattr__ 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2014-10-24T18:15:52.570

不要忽视[Bunch](https://pypi.python.org/pypi/bunch/1.0.1 "束")。

它是字典的子代，可以导入 YAML 或 JSON，或将任何现有字典转换为 Bunch，反之亦然。一旦“bunchify”d，字典获得点符号，而不会丢失任何其他字典方法。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-10-22T00:34:59.047

我个人比字典字段更喜欢点符号。原因是它使自动完成工作得更好。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-10-22T07:55:24.413

如果它符合您的目的，那还不错。“实用胜于纯洁”。

我在其他地方看到了这种方法（例如在[Paver](http://www.blueskyonmars.com/projects/paver/)中），所以这可以被认为是*共同的需要*（或愿望）。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2012-07-05T19:01:28.710

因为您要求产生不良副作用：

一个缺点是在像 eclipse+pyDev 这样的可视化编辑器中，你会在使用点符号的行上看到许多未定义的变量错误。Pydef 将无法找到这样的运行时“对象”定义。而在普通字典的情况下，它知道你只是得到一个字典条目。

您需要 1) 忽略这些错误并忍受红十字；2) 使用 #@UndefinedVariable 逐行抑制这些警告或 3) 完全禁用未定义​​变量错误，导致您错过真正的未定义变量定义。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2019-10-23T02:14:23.973

如果您正在寻找处理嵌套字典的替代方法：

递归地将字典转换为所需类的实例

```
import json
from collections import namedtuple

class DictTransformer():
    @classmethod
    def constantize(self, d):
        return self.transform(d, klass=namedtuple, klassname='namedtuple')

    @classmethod
    def transform(self, d, klass, klassname):
        return self._from_json(self._to_json(d), klass=klass, klassname=klassname)

    @classmethod
    def _to_json(self, d, access_method='__dict__'):
        return json.dumps(d, default=lambda o: getattr(o, access_method, str(o)))

    @classmethod
    def _from_json(self, jsonstr, klass, klassname):
        return json.loads(jsonstr, object_hook=lambda d: klass(klassname, d.keys())(*d.values())) 
```

前任：

```
constants = {
  'A': {
    'B': {
      'C': 'D'
    }
  }
}
CONSTANTS = DictTransformer.transform(d, klass=namedtuple, klassname='namedtuple')
CONSTANTS.A.B.C == 'D' 
```

优点：

*   处理嵌套的字典
*   可能会生成其他类
*   namedtuples 为常量提供不变性

缺点：

*   `.keys`如果您的 klass 上没有提供这些，可能不会响应`.values`（尽管您有时可以用`._fields`and模仿`list(A.B.C)`）

想法？

h/t 到 @hlzr 获取原始课程的想法

# shell - C Shell：如何使用非命令行参数执行程序？

> ID：224038
> 
> 赞同：2
> 
> 时间：2008-10-22T00:14:03.597
> 
> 标签：shell, unix, scripting, csh

我的 $SHELL 是 tcsh。我想运行一个 C shell 脚本，它会多次调用一个程序，每次都会更改一些参数。我需要调用的程序是 Fortran。我不想编辑它。该程序仅在执行后才接受参数，而不是在命令行上。在脚本中调用程序后，程序将获得控制权（这是我目前卡住的地方，我永远无法脱身，因为在程序进程停止之前脚本不会执行任何操作）。此时我需要向它传递一些变量，然后经过几次迭代后，我需要`Ctrl`+`C`退出程序并继续执行脚本。

如何才能做到这一点？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-22T00:33:24.433

要添加@Toybuilder 所说的内容，您可以使用“此处文档”。即你的脚本可能有

```
./myfortranprogram << EOF
first line of input
second line of input
EOF 
```

`<<EOF`“ ”和“ ”之间的所有内容都`EOF`将被馈送到程序的标准输入（Fortran 是否仍然使用“read (5,*)”从标准输入中读取？）

而且因为我认为@ehemient 的评论应该出现在答案中：

> 更多提示： <<'EOF' 防止在 here-doc 正文中插值；<<-EOF 删除所有前导制表符（因此您可以缩进 here-doc 以匹配其周围环境），并且 EOF 可以替换为任何标记。空标记 (<<"") 表示在第一个空行处停止的 here-doc。

我不确定这些的可移植性如何，或者它们是否只是 tcsh 扩展——我自己只使用过`<<EOF`“here document”类型。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-22T00:21:47.683

您要使用的是[Expect](http://expect.nist.gov/)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-22T00:19:05.227

嗯，你能用重定向来输入你的 Fortran 代码吗？您可以使用输入创建一个临时文件，然后使用标准输入重定向 (<) 将其输入。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-22T00:17:44.527

不是`tcsh`用户，但如果程序运行然后通过 then 读取命令，`stdin`您可以使用 shell 重定向`<`为其提供所需的命令。如果您在后台运行它，`&`则执行时不会阻塞。然后你可以`sleep`稍等一下，然后使用你拥有的任何工具（`ps`, `grep`,`awk`等）来发现程序的 PID，然后使用`kill`它来发送它`SIGTERM`，这与执行`Ctrl`-相同`C`。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-22T01:19:49.330

这是 unix 程序期望的工作，它可以很好地轻松地交互式地命令程序并响应它们的提示。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2016-03-29T14:24:58.587

在被告知我的问题几乎与此问题重复后，我被送到了这里。

FWIW，我在使用 csh C shell 脚本时遇到了类似的问题。

这段代码允许 custom_command 在不获取任何输入参数的情况下执行：

```
foreach f ($forecastTimes)
    custom_command << EOF
        arg1=x$f;2
        arg2=ya
        arg3=z,z$f
        run
        exit
        EOF
end 
```

我第一次尝试时它没有用，但是在我退格了该部分代码中的所有空白之后，我删除了“<<”和“EOF”之间的空格。我还将结束的“EOF”一直退到左边距。之后它起作用了：

```
foreach f ($forecastTimes)
    custom_command <<EOF
        arg1=x$f;2
        arg2=ya
        arg3=z,z$f
        run
        exit
EOF
end 
```

# asp.net - 存储 ASP.NET 会话变量的最佳解决方案是什么？状态服务器还是 SQLServer？

> ID：224039
> 
> 赞同：8
> 
> 时间：2008-10-22T00:15:12.487
> 
> 标签：asp.net, session, load-balancing

状态服务器还是 SQLServer？

*   存储 ASP.NET 会话变量的最佳解决方案是什么？
*   各自的优缺点是什么？
*   在任何特定情况下，一个比另一个更好吗？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-19T08:12:31.057

这里有一些关于赞成/反对的想法。我还添加了 Microsoft Velocity 分布式缓存解决方案。

### InProc 的优点

*   最快的可选可用（全部在内存/内存中）
*   易于设置（.config 文件中不需要任何新内容。我认为这是默认行为）。
*   我相信大多数人都使用它。

### InProc 的缺点

*   如果网站（应用程序池）死了，那么所有会话信息都会丢失。
*   在 WebFarm 场景中不起作用 -> 会话信息仅针对每个应用程序池。
*   不能包含非会话信息。

### 用于 StateServer 的 Pro

*   在内存/内存中，它很快（但有一些净延迟......请阅读下文），所以它可能不如 Inproc 快。
*   Web 场方案的默认配置。多个 iis 站点使用状态服务器来控制状态会话信息。

### StateServer 的缺点

*   需要将 ASP.NET StateServer 服务设置为运行。
*   StateServer 需要一些配置调整以接受“远程 iis 机器”请求。
*   如果 iis 请求需要在另一台联网机器上获取/设置会话信息，则存在一些微小的网络延迟。
*   不能包含非会话信息。

### Pro's for SqlServer（作为状态服务器）

*   状态始终保留，即使在 iis 站点重新启动后也是如此。

### Con's for SqlServer（作为状态服务器）

*   最慢的解决方案-> 净延迟和硬盘延迟（因为 sql 服务器将状态存储在硬盘上/从硬盘读取）。
*   最难设置/配置。
*   不能包含非会话信息

### Pro's for Velocity（或其他分布式缓存系统）

*   可以处理的不仅仅是会话信息 -> 对象、应用程序设置、缓存等。（这是 IMO 非常好的事情！！）
*   可以仅是内存或持久到数据库。
*   如果一个“节点”发生故障，系统仍然可以工作。（假设有 2+ 个缓存节点）

### Con's for Velocity（或其他分布式缓存系统）

*   一般花费$$$
*   最难设置（必须安装东西，调整配置，添加额外的特殊代码）。
*   有网络延迟（通常没什么），但如果服务正在持久化数据（例如，到 Sql Server），则可能有硬盘延迟。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-22T00:56:16.337

我认为假设您正在使用某种网络农场。

状态服务的一种用途是在 Web Garden（同一台机器上的多个工作进程）中。在这种情况下，您可以使用负载平衡来保持用户与特定服务器的连接，并让 n 个工作进程共享相同的状态服务。

编辑：在网络花园 + 状态服务或 sql 服务器场景中，您还可以在没有连接的客户端丢失会话的情况下回收该机器上的工作进程。

我不熟悉将 SQL Server 用作会话状态存储，但我认为您可以通过在集群中使用 SQL Server 来获得稳健性。在这种情况下，您仍然可以拥有多个工作进程和多个服务器，但您不必使用粘性会话（服务器关联）。

还有一点需要注意的是，您可以在第二台机器上使用状态服务，并让场中的所有服务器都访问该机器，但您会遇到单点故障。

最后，还有第 3 方（和一些本土的）分布式状态服务类应用程序。其中一些比其他选项具有性能优势，而且 Session_End 事件实际上会触发。（在状态服务和 SQL Server 会话支持中，Global.asax 中的 Session_End 不会触发（可能有一种连接到 SQL Server 的方法））。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-22T02:41:54.580

在 n 层环境中，使用 SQL Server 托管会话状态，您将为后端创建额外的网络流量，同时丢失一些现在需要处理额外流量（与会话相关的请求）的 SQL Server 资源）。SQL Server 状态管理也比状态服务器慢。

但是，如果您的服务器在某些不可预见的事件中出现故障，SQL Server 很可能会维护会话信息，而不是状态服务器。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-22T02:51:37.867

根据我的个人经验，我在存储会话变量时遇到了一些问题。我一直在丢失会话，我相信这是防病毒软件，当它扫描服务器中的每个文件时，IIS 会重新编译站点以终止会话。（我必须说我对那台服务器没有任何权力，我被告知在那里托管应用程序）
所以我决定将会话存储在 SQL Server 中，现在每个人都很高兴......它非常快

查看[这篇文章](http://support.microsoft.com/kb/317604)以快速启动

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-22T11:23:45.803

Using a single machine to store state in a web garden means a single point of failure. We use SQL state, but it does add a bit of overhead.

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-09T10:33:32.283

在 Proc 中非常快。但有局限性。我们只能使用单个系统。当系统重新启动时，信息将丢失。同一台机器上的工作进程

StateServer 将会话信息存储在其他机器中。Web Farm 可以使用会话。例如：多个工作进程可以从服务器访问会话信息。当重新启动服务器时，信息将丢失。

SQLServer 用于将信息存储在表中。默认它将存储在 TempDB 中。这个 tempdb 会在调用 sqlservice 之后动态调用。所以这也不会持久化数据。在这个场景中，我们可以使用脚本存储在我们自己的数据库中，这称为自定义选项。

# shell - 如何在 ksh shell 脚本中计算前一个工作日？

> ID：224040
> 
> 赞同：6
> 
> 时间：2008-10-22T00:15:26.120
> 
> 标签：shell, date, ksh

在 shell ksh 脚本中计算前一个工作日的最优雅方法是什么？

到目前为止我得到的是：

```
#!/bin/ksh

set -x

DAY_DIFF=1
case `date '+%a'` in
"Sun")
   DAY_DIFF=2
   ;;
"Mon")
   DAY_DIFF=3
   ;;
esac

PREV_DT=`perl -e '($sec,$min,$hour,$mday,$mon,$year,$wday,$yday,$isdst)=localtime(time()-${DAY_DIFF}*24*60*60);printf "%4d%02d%02d",$year+1900,$mon+1,$mday;'`

echo $PREV_DT 
```

如何使 ${DAY_DIFF} 变量作为值而不是字符串传输？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-09-21T18:13:10.113

```
#!/bin/ksh
# GNU date is a veritable Swiss Army Knife...
((D=$(date +%w)+2))
if [ $D -gt 3 ]; then D=1; fi
PREV_DT=$(date -d "-$D days" +%F) 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-23T10:16:33.863

Here is a solution that doesn't use Perl. It works both with `ksh` and `sh`.

```
#!/bin/ksh

diff=-1
[ `date +%u` == 1 ] && diff=-3

seconds=$((`date +%s` + $diff * 24 * 3600))
format=+%Y-%m-%d

if date --help 2>/dev/null | grep -q -- -d ; then
    # GNU date (e.g., Linux)
    date -d "1970-01-01 00:00 UTC + $seconds seconds" $format
else
    # For BSD date (e.g., Mac OS X)
    date -r $seconds $format
fi 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-12-05T14:50:41.090

这应该适用于 Solaris 和 Linux。在 Unix 上，您不能在所有 Unix 衍生产品上使用相同的命令行参数，这真的很复杂。

在 Linux 上，您可以使用`date -d '-d24 hour ago'`Solaris 上的最后一天获取`TZ=CET+24 date`. 我猜其他 UNIX 的工作方式与 Solaris 相同。

```
#!/usr/bin/ksh

lbd=5               # last business day (1=Mon, 2=Thu ... 6=Sat, 7=Sun)
lbd_date=""         # last business day date

function lbdSunOS
{
    typeset back=$1
    typeset tz=`date '+%Z'`     # timezone

    lbd_date=`TZ=${tz}+$back date '+%Y%m%d'`
}

function lbdLinux
{
    typeset back=$1

    lbd_date=`date -d "-d$back hour ago"`
}

function calcHoursBack
{
    typeset lbd=$1
    typeset dow=`date '+%u'`    # day of the week

    if [ $dow -ge $lbd ]
    then
        return $(((dow-lbd)*24))
    else
        return $(((dow-lbd+7)*24))
    fi
}

# Main

calcHoursBack $lbd
lbd`uname -s` $?

echo $lbd_date 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-22T03:49:57.047

好吧，如果运行 Perl 算作脚本的一部分，那么在 Perl 中开发答案。下一个问题是 - 什么定义了工作日？您是周日营业的商店/商店吗？周六？还是周一到周五朝九晚五的生意？假期呢？

假设您认为周一到周五和假期暂时无关紧要，那么您可以使用 Perl 中的算法指出 wday 将在周日为 0 到周六为 6，因此如果 wday 为 1，则需要减去 3 * 86400从时间（）; 如果 wday 为 0，则需要减去 2 * 86400；如果 wday 是 6，你需要减去 1 * 86400。这就是你在 Korn shell 中得到的东西 - 只需在 Perl 中执行它：

```
#!/bin/perl -w
use strict;
use POSIX;
use constant SECS_PER_DAY => 24 * 60 * 60;
my(@days) = (2, 3, 1, 1, 1, 1, 1);
my($now) = time;
my($sec,$min,$hour,$mday,$mon,$year,$wday,$yday,$isdst)=localtime($now);
print strftime("%Y-%m-%d\n", localtime($now - $days[$wday] * SECS_PER_DAY)); 
```

这确实假设您有 POSIX 模块；如果没有，那么您将需要执行与您使用的大致相同的 printf() 。我还根据偏好使用 ISO 8601 日期格式（XSD 和 SQL 也使用） - 因此是图示格式。

# vba - 在打开任何表单之前运行 VBA

> ID：224041
> 
> 赞同：8
> 
> 时间：2008-10-22T00:16:00.690
> 
> 标签：vba, ms-access

所以我有一个带有前端和后端的 Access 数据库。我将很快将其分发给用户，但我无法控制他们将文件放在计算机上的确切位置。但是，我认为我可以指望他们将前端和后端放在同一个文件夹中。

因此，当前端打开时，我希望它检查链接表是否正确连接到后端数据库。我有这方面的工作代码；但是我不知道把它放在哪里。前端打开时，会自动打开一个菜单表单（通过启动对话框配置）。我已将代码放入`OnOpen`事件中，我认为这是在加载任何数据之前发生的，但是当我测试它时，我收到一条消息，告诉我找不到后端（它正在寻找它的旧位置）。

基本上，是否有一个我可以在任何表单打开之前运行的事件？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-22T00:25:54.993

创建一个宏并将其命名为“autoexec”。对于宏操作，选择“RunCode”，然后将函数名称设置为用于检查链接表的函数名称。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-22T09:00:46.217

我一般更喜欢创建一个运行多项检查的小型表单，例如查找后端等，并设置各种选项。此表单的打开事件的代码可能是：

```
Me.Visible = False
'Determines if the database window is displayed
SetProp "StartupShowDBWindow", False, dbBoolean
'Hide hidden and system objects
SetOption "Show Hidden Objects", False
SetOption "Show System Objects", False

'Find back end
CheckLinkPath 
```

我在前端保留了一个要链接的表格，如果缺少任何表格，可以使用此表格报告错误或任何其他错误。

```
Set RS = CurrentDb.OpenRecordset("Select TableName From sysTables " _
& "WHERE TableType = 'LINK'")

RS.MoveFirst
strConnect = db.TableDefs(RS!TableName).Connect
If Not FileExists(Mid(strConnect, InStr(strConnect, "DATABASE=") + 9)) Then
    'All is not well
    blnConnectError = True
Else
    Do Until RS.EOF()
        If db.TableDefs(RS!TableName).Connect <> strConnect Then
            blnConnectError = True
            Exit Do
        End If

        RS.MoveNext
    Loop
End If 
```

如果一切正常，小窗体调用主菜单或窗体，用户永远不会看到检查窗体。如果需要，我还会使用此表单打开密码提示。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-22T00:46:11.177

正如马特所说，创建一个宏，将其命名为“autoexec”，然后选择“RunCode”作为宏操作。Function Name 参数应该是您希望运行的函数的名称（而不是子函数），如果该函数没有参数，您仍然应该将 () 放在末尾，否则它将不起作用。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-22T08:43:52.647

在将前端和后端放在同一个文件夹中之前，请考虑一下。不值得拥有2个文件夹吗？同一台计算机上的多个用户访问同一个后端数据库会怎样？多个用户通过网络访问同一个数据库会怎样？如果您的应用程序基本上是单用户应用程序，那么拥有前端后端类型的必要性是什么？

你为什么不在你的应用程序中添加一个对话框，以防你的连接丢失？您可以在代码中创建一个 fileDialog 对象，允许用户在其计算机/网络的任何位置浏览 *mdb 文件。然后可以控制选定的 mdb 文件包含所有请求的表并打开相应的链接（我猜您正在使用 transferDatabase 命令）。

当您将应用程序分发给最终用户时，运行应用程序所需的其他工具/参考又如何呢？默认情况下，MS Access 记录 3 个基本的：

*   Visual Basic 应用程序
*   Microsoft Access 库
*   微软 DAO 库

如果您的应用需要其他任何东西，例如 ADO 或 Office 对象（例如 ADODB.recordset 或 Office 命令栏），您必须为每次安装手动添加引用，因为最终用户将无法打开 VBA 窗口并访问工具/参考菜单。

因此，如果您需要在多台计算机上部署您的应用程序，我强烈建议您使用[免费](http://www.download3k.com/Install-Install-Creator.html)的部署工具。您需要几个小时才能正确使用它，但结果是值得的。您将能够为您的客户提供一个真正的安装程序模块。它将创建文件夹、添加请求的快捷方式并管理计算机注册表中的引用。这将使您的部署绝对轻松！

编辑： autoexec 宏绝对是在任何事件之前调用代码的正确解决方案。

编辑：不要忘记您的最终用户可以从 Access 的运行时版本中获利，这是免费的！

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-01T17:00:02.453

正如其他人所建议的那样，在这种情况下，我会使用 AutoExec 宏。如果检查链接表的代码当前是子代码，请将其更改为如果成功则返回 TRUE 的函数。然后，如果链接表代码失败，您可以使用 AutoExec 宏中的“条件”列以用户友好的错误对话框退出应用程序。您的 AutoExec 宏可能类似于：

1.  调用您的 LinkTables() 函数，设置条件以在失败时终止启动。
2.  调用您的“主”启动菜单表单。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2015-04-03T13:03:32.873

您可以向他们发送一个 *.BAT 文件，该文件将数据库复制到 c:\temp （或您选择的任何文件夹。在创建 BAT 文件之前设置链接到该文件夹​​。将其压缩并通过电子邮件发送给他们。然后你就不会了不必担心额外需要的代码。

# c++ - win32服务中的定时器

> ID：224043
> 
> 赞同：9
> 
> 时间：2008-10-22T00:17:35.087
> 
> 标签：c++, windows, winapi, windows-services

有人可以指出在 Win32 服务中设置计时器的最简单方法吗？

我想我可以为此目的创建一个虚拟窗口，或者让第二个线程进行滴答计数，但什么是最好的？有没有更优雅的方式？

提前致谢。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-10-22T00:31:22.407

您可以使用计时器队列 ( [http://msdn.microsoft.com/en-us/library/ms686796.aspx](http://msdn.microsoft.com/en-us/library/ms686796.aspx) )。他们不需要 HWND。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-22T00:34:54.087

除了使用 UI 计时器（即使您可以使用 1800-INFO 先生所示的 NULL 窗口句柄），您还可以使用内核可等待计时器对象。请参阅API 文档中的[CreateWaitableTimer](http://msdn.microsoft.com/en-us/library/ms682492(VS.85).aspx)。然后可以使用 WaitForSingleObject 或 WaitForMultipleObjects 等来等待这些，如果这已经是您的服务等待外部事件的方式，这将特别有用。

如果从第一个链接中不清楚，SetWaitableTimer 函数可以将完成例程（用户回调）与计时器相关联。请记住使用...Ex 版本的 WaitForMultipleObjects （等），以便线程处于“可提醒”状态。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-22T00:30:30.180

您可以发送主线程 WM_TIMER 消息。消息的 lParam 是回调函数的地址，或者您可以将其保留为 NULL 并在消息泵中自行处理。

在这个例子中，我们将定时器发送到线程消息泵，不需要有一个与定时器关联的窗口。

```
UINT timer;

VOID CALLBACK Timer(HWND hwnd,
    UINT uMsg,
    UINT_PTR idEvent,
    DWORD dwTime
)
{
  KillTimer(0, timer);
}

timer=SetTimer(0, // window handle
    0, // id of the timer message, leave 0 in this case
    10000, // millis
    Timer // callback
  );

// pump messages
while (GetMessage) etc... 
```

Timer 回调将由 DispatchMessage 调用。这个问题让我想起了最近的[ONT](http://blogs.msdn.com/oldnewthing/archive/2008/10/16/9001218.aspx)。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-22T00:24:53.233

您可以使用 SetTimer 设置计时器，然后在消息循环中捕获 WM_TIMER 消息。

例子：

// 设置一个10秒后过期的定时器

SetTimer(hwnd,IDT_TIMER1, 10000,(TIMERPROC) NULL);

...然后在消息循环中：

开关（wParam）

```
{ 

    case IDT_TIMER1: 

        // Boom goes the dynamite 
```

如果您不想进行消息循环处理，您还可以取消 TIMERPROC 类型的函数并在计时器到期时调用该函数。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-23T12:30:55.777

在您的一条评论中，您说“......该服务正在处理其他线程中的内容，我只需要每秒检查几个文件的状态。”

轮询不是检查文件状态的最佳方式，并且会对系统性能产生不利影响。虽然（有时）通过网络执行此操作会出现问题，但您应该查看[http://msdn.microsoft.com/en-us/library/aa364417(VS.85).aspx](http://msdn.microsoft.com/en-us/library/aa364417(VS.85).aspx)或[http://msdn.microsoft.com /en-us/library/aa365261(VS.85).aspx](http://msdn.microsoft.com/en-us/library/aa365261(VS.85).aspx)了解如何操作，[http://blogs.msdn.com/oldnewthing/archive/2006/01/24/516808.aspx](http://blogs.msdn.com/oldnewthing/archive/2006/01/24/516808.aspx)了解您为什么应该这样做。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-22T00:41:51.623

你只是想时不时地“醒来”做一些工作吗？您始终可以使用 Sleep()。

此外，我通常有一个线程在 while(1 == 1) 循环中，里面有一个睡眠。在那里我可以检查关闭请求和其他杂项家务。您可以使用该系统为应用程序中的工作线程触发事件或互斥锁。

# windows - 需要 ActiveX 控件才能将 Excel 嵌入对话框

> ID：224044
> 
> 赞同：5
> 
> 时间：2008-10-22T00:17:40.627
> 
> 标签：windows, excel, mfc, activex, ole

我正在构建一个“从 Excel 导入”功能。它必须在一个 DLL 中，从非 MFC 应用程序调用。必须提供电子表格的图像，用户可以在其中拖动选择框（以选择单元格），然后单击 IMPORT 按钮，让正确的事情发生。无法启动电子表格，旁边有一个按钮，并且在 DLL 中发生。

我在 DLL 中使用了 MFC 对话框的路线，但在尝试在对话框的窗口上为 excel 调出 OLE 客户端时被阻止。我发现只有使用 OLE 显示 Excel 的支持需要 SDI。我能够让自动化功能工作，我可以读取单元格并在我的对话框中绘制它们的“假图像”......但我担心这将不符合我的要求。

所以我尝试创建一个 SDI。我能够创建一个将 Excel 用作 OLE 客户端的 SDI。我能够处理“选择更改”事件，并获取我需要的单元格数据。在这一点上，我被 2 项挫败：

1.  无法使此 SDI 在 MFC DLL 中工作。CWinApp 构造函数中的崩溃，断言 AfxGetThread 不为空。将“theApp”移动到单个导出的 DLL 函数中的本地范围内，但仍然无法使其工作，但出现不同的症状：添加时崩溃 AFX_MANAGE_STATE(AfxGetStaticModuleState()); 要导出的 DLL 函数，如果我不使用它，则永远不会输入 OnInitInstance。尝试添加对应用程序的 Run() 函数的调用，但这没有帮助。如果有人认为他们知道问题所在，我可以发布此代码。

2.  Excel 客户端项处于活动状态时无法显示工具栏。我可以将我的“导入”（和其他选项）放在顶部的菜单栏上，但这还不够明显。甚至一个浮动工具栏也被关闭了。这样做是有道理的，因为如果存在无法对当前活动项目执行操作的工具栏会令人困惑……但就我而言，这是一个问题。

所以现在我想我需要回到对话框方法，并嵌入一个 ActiveX 控件，该控件会显示一个要导入的 Excel 电子表格文件。

必须允许我处理选择更改事件，或者必须允许我找到选择了哪些单元格（或者如果单击对话框上的“导入”按钮导致所选单元格变为未选中，则最近选择了哪些单元格）。

它还必须附带合理的许可条款，因为这将用于公众广泛使用的商业应用程序中。

如果有人知道我一直在尝试的任何一种方法的“快速修复”，那也很有用。

希望可以有人帮帮我！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-10-23T13:25:52.203

如果您只想嵌入 Excel，则不需要任何东西。

只需将其嵌入到标准 OCX 主机控件中即可。

# sql - SQL Server 存储过程参数类型转换

> ID：224047
> 
> 赞同：2
> 
> 时间：2008-10-22T00:21:22.710
> 
> 标签：sql, sql-server, stored-procedures

假设我在一个表中有一堆 varchar(6000) 字段并且想要将它们更改为文本字段。参数为 varchar(6000) 类型的存储过程的后果是什么。每个存储过程是否也需要更改这些参数数据类型？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-22T00:31:33.233

在 SQL Server 2005 及更高版本中[不推荐使用](http://msdn.microsoft.com/en-us/library/ms187993.aspx)文本字段。如果可能，您应该使用 varchar(MAX)。如果您希望在存储过程的参数中传递超过 6000 个字符，那么您也需要更改它们。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-22T00:53:13.283

在 SQL Server 中很难使用文本字段。您实际上不能声明文本类型的局部变量（作为存储过程的参数除外），并且大多数字符串操作函数不再适用于文本字段。

此外，如果您有触发器，则文本字段将不会出现在 INSERTED 或 DELETED 表中。

基本上，如果该字段只是保存来自程序的数据并且您没有操纵它，那么没什么大不了的。但是，如果您有存储过程来操作字符串，那么您的任务将更加困难。

正如 tvanfosson 所提到的，如果您有 SQL Server 2005 使用 VARCHAR(MAX)，那么您将获得一个文本字段的长度，并且能够像 VARCHAR 一样对其进行操作。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-22T01:50:12.687

其他答案是正确的，但他们没有回答你的问题。Varchar(max) 是要走的路。如果您制作了 feilds varchar(max)/text，但保持存储的 proc 参数相同，则通过存储 proc 进入的任何字段都将被截断为 6000 个字符。既然你说它永远不会超过那个，你会没事的，直到，当然，事实并非如此。它不会引发错误。它只是截断。

我不确定 varchar(max) verses text 的确切行为，但我很确定一旦你开始将它们中的很多放在一张表中，你会得到一些疯狂的性能命中。为什么一张表中有这么多大字段？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-22T01:13:01.387

使用文本字段的原因是一行中的所有 varchar(6000) 字段都超过了最大行长度。文本字段只是在行中存储一个指针，因此不会超过 SQL Server 的最大行长度 8000。ATM 数据库无法正常化。数据不会被刚刚插入、更新和删除的存储过程操作。

VARCHAR(MAX) 的行为是否类似于文本字段并且仅存储指向行中数据的指针？

# security - CSRF 不是浏览器安全问题吗？

> ID：224049
> 
> 赞同：14
> 
> 时间：2008-10-22T00:21:41.787
> 
> 标签：security, browser, csrf

关于跨站点请求伪造 (CSRF) 攻击，如果 cookie 是最常用的身份验证方法，为什么 Web 浏览器允许从另一个域生成的页面发送某个域（以及该域）的 cookie？

通过禁止这种行为，CSRF 在浏览器中是否可以轻松预防？

据我所知，这种安全检查并没有在网络浏览器中实现，但我不明白为什么。我是不是搞错了什么？

关于 CSRF：

*   [在维基百科上](http://en.wikipedia.org/wiki/Csrf)
*   [关于编码恐怖](http://www.codinghorror.com/blog/archives/001171.html)

编辑：我认为在上述情况下不应在 http POST 上发送 cookie。这就是让我吃惊的浏览器行为。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-22T00:59:10.697

为什么浏览器不发送cookies？

站点 A ( [http://www.sitea.com](http://www.sitea.com) ) 为用户设置了一个 cookie。

用户导航到站点 B ( [http://www.siteb.com](http://www.siteb.com) )。站点 B 与站点 A 集成 - 单击此处在站点 A 上执行操作！用户点击“这里”。

据浏览器所知，用户是有意识地决定向站点 A 发出请求，因此它处理它的方式与处理对站点 A 的任何请求相同，包括在请求中向站点 A 发送 cookie站点 A。

* * *

**编辑**：我认为这里的主要问题是您认为身份验证 cookie 和其他 cookie 之间存在区别。Cookie 可用于存储任何内容 - 用户偏好、您最近的高分或会话令牌。浏览器不知道每个 cookie 的用途。我**希望**我的 cookie 始终可供设置它们的站点使用，并且我希望站点确保它采取了必要的预防措施。

或者你是说如果你在雅虎搜索“gmail”，然后点击带你到[http://mail.google.com](http://mail.google.com)的链接，你不应该登录，*即使你告诉 gmail 保留你登录*，因为您点击了另一个站点的链接？

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-22T00:30:00.867

并不是浏览器将 cookie 发送到外部域或从外部域发送 cookie，而是您已通过身份验证并且站点未验证请求的来源，因此它将其视为请求来自地点。

至于浏览器是否应该禁止这样做……在许多需要跨站点请求的情况下呢？

编辑：需要明确的是，您的 cookie 不会跨域发送。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-22T00:58:33.680

我不知道在这种情况下浏览器可以做很多事情，因为 XSRF 攻击的目的是将浏览器引导到应用程序中会执行不良操作的另一个点。不幸的是，浏览器不知道它被引导发送的请求是否是恶意的。例如，给定 XSRF 的经典示例：

```
<img src="http://domain.com/do_something_bad" /> 
```

浏览器看不出有什么不好的事情发生了。毕竟，如何知道that和this之间的区别：

```
<img src="http://domain.com/show_picture_if_authenticated" /> 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-22T01:48:48.710

许多旧协议都有很大的安全漏洞——回想一下最近发现的[DNS 漏洞](http://en.wikipedia.org/wiki/Dan_Kaminsky#Flaw_in_DNS)。就像基本上任何网络安全一样，它是端点的责任；是的，我们必须自己解决这个问题很糟糕，但是在浏览器级别修复要困难得多。有一些明显的情况（<img src="logoff.php"> 看起来很可疑，对吧？），但总会有边缘情况。（也许它毕竟是 PHP 文件中的 GD 脚本。） AJAX 查询呢？等等...

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-22T02:01:50.853

一个站点的 cookie 永远不会发送到另一个站点。事实上，要实施成功的 CSRF 攻击，攻击者不需要访问这些 cookie。

基本上，攻击者欺骗已经登录到目标网站的用户单击链接或加载图像，该图像将使用该用户的凭据在目标站点上执行某些操作。

即，用户正在执行该操作，而攻击者已诱骗用户这样做。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-01T08:47:25.777

有些人说他们不认为浏览器可以做很多事情。

看到这个：

[http://people.mozilla.org/~bsterne/content-security-policy/origin-header-proposal.html](http://people.mozilla.org/~bsterne/content-security-policy/origin-header-proposal.html)

这是对新 HTTP 标头提案的概述，以帮助减轻 CSRF 攻击。

建议的标题名称是“Origin”，它基本上是“Referer”标题减去路径等。

# distributed - 分布式随机数生成

> ID：224058
> 
> 赞同：14
> 
> 时间：2008-10-22T00:28:03.867
> 
> 标签：distributed, random

我想知道是否有办法让 N 个参与者的网络同意随机选择从 1 到 M 的数字。（例如，不受任何参与者的影响）这已经通过[抛硬币协议](http://everything2.com/title/Coin%2520tossing%2520protocol)解决了 n=2 和 m=2 的值。有谁知道任何适用于任意 N 和 M 值的解决方案？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-10-22T00:32:33.200

**编辑**

更好的算法（感谢 wnoise）：

1.  每个人都从 0 到 M-1 选择一个秘密数字
2.  每个人都会在他们的号码上附加大量随机垃圾，并使用安全哈希对结果进行哈希处理
3.  每个人都告诉其他人这个哈希
4.  每个人都告诉其他人他们的秘密号码，以及他们附加的随机垃圾
5.  每个人都验证数字和哈希 + gunk 匹配
6.  将所有秘密数字模M相加，然后加1得到最终结果

作为参与者，我应该对此感到满意，因为我知道我对最终结果有完全的影响——最终的数字可能是任何东西，这取决于我选择的秘密数字。因此，由于没有其他人可以预测我的数字，他们也无法预测最终结果。

> 有什么方法可以减少我怀疑广播方法需要的来自 3M^2 的消息？

我认为只有哈希发布必须是广播，但它仍然是 O(M^2)。我想解决这个问题的唯一方法是预先交换数字签名密钥，或者拥有一个受信任的通信中心。

**Edit2** - 散列的安全性如何？

可能的攻击包括：

1.  如果我可以生成哈希冲突，那么我有两个具有相同哈希的秘密数字。因此，一旦我知道了其他人的秘密号码，我就可以选择要透露我的哪个秘密号码，从而选择两种可能的结果之一。
2.  如果我使用 PRNG 生成我的秘密数字和随机 gunk，那么试图暴力破解我的哈希的攻击者不必尝试所有可能的数字+gunk，只需尝试 PRNG 的所有可能种子。
3.  我使用每个人透露的数字+gunk 来确定有关他们的 PRNG 的信息——我可以尝试猜测或暴力破解种子，或从输出中计算内部状态。这有助于我预测他们下次会生成什么数字，从而缩小了暴力攻击的搜索空间。

因此，您应该

1.  使用可信的、完整的散列算法。
2.  使用具有大种子/状态的加密安全随机数生成器，并尝试从良好的熵源中播种。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-22T00:50:05.630

我不知道人们是否可以就单个数字的随机性达成一致；它应该在统计中。如果许多随机数的统计信息与从[此处](http://random.irb.hr)获取的数字统计信息相匹配，那么我会认为您的数字是随机的，但我不知道网络上的下一个 N+1 人。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-22T00:34:35.897

这可能不是您要查找的内容，而只是开始此线程如何-
选择领导者，让领导者选择号码，然后将号码分发给每个人。

# language-agnostic - 测试循环在顶部还是底部？（同时与做同时）

> ID：224059
> 
> 赞同：26
> 
> 时间：2008-10-22T00:29:15.033
> 
> 标签：language-agnostic, loops, while-loop, do-while

当我在大学（80 年代中期）学习 CS 时，不断重复的想法之一是始终编写循环测试在顶部（while...）而不是底部（do ...while）环形。这些概念经常得到研究参考的支持，这些研究表明，在顶部测试的循环在统计上比底部测试的循环更可能是正确的。

结果，我几乎总是编写在顶部进行测试的循环。如果它在代码中引入额外的复杂性，我不会这样做，但这种情况似乎很少见。我注意到一些程序员倾向于几乎专门编写在底部进行测试的循环。当我看到如下结构时：

```
if (condition)
{
    do
    {
       ...
    } while (same condition);
} 
```

或者相反（`if`在内部`while`），这让我想知道他们是否真的是这样写的，或者`if`当他们意识到循环没有处理空情况时他们是否添加了语句。

我已经进行了一些谷歌搜索，但无法找到有关此主题的任何文献。你们（和女孩）如何编写循环？

* * *

## 回答 #1

> 赞同：78
> 
> 时间：2008-10-22T00:37:07.933

我总是遵循这样的规则，如果它应该运行零次或多次，则在开始时进行测试，如果必须运行*一次*或多次，则在结束时进行测试。我认为没有任何合乎逻辑的理由使用您在示例中列出的代码。它只会增加复杂性。

* * *

## 回答 #2

> 赞同：57
> 
> 时间：2010-06-22T16:17:13.000

Use while loops when you want to test a condition before the first iteration of the loop.

Use do-while loops when you want to test a condition after running the first iteration of the loop.

For example, if you find yourself doing something like either of these snippets:

```
func();
while (condition) {
   func();
}

//or:

while (true){
    func();
    if (!condition) break;
} 
```

You should rewrite it as:

```
do{
    func();
} while(condition); 
```

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2008-12-24T01:51:37.427

不同之处在于 do 循环执行一次“做某事”，然后检查条件以查看它是否应该重复“做某事”，而 while 循环在做任何事情之前检查条件

* * *

## 回答 #4

> 赞同：17
> 
> 时间：2010-07-31T02:30:47.277

> 避免`do`/`while`真的有助于使我的代码更具可读性吗？

不。

如果使用`do`/`while`循环更有意义，那么就这样做。如果您需要在测试条件之前执行一次循环体，那么`do`/`while`循环可能是最直接的实现。

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2008-12-24T01:51:52.463

如果条件为假，第一个可能根本不会执行。另一个将至少执行一次，然后检查条件。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2008-10-22T00:50:03.227

为了可读性，在顶部进行测试似乎是明智的。它是一个循环的事实很重要。阅读代码的人应该在尝试理解循环体之前了解循环条件。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2010-06-22T16:55:10.983

这是我最近遇到的一个很好的真实示例。假设您有许多处理任务（例如处理数组中的元素），并且您希望在每个 CPU 内核的一个线程之间分配工作。必须至少有一个内核才能运行当前代码！所以你可以使用类似的`do... while`东西：

```
do {
    get_tasks_for_core();
    launch_thread();
} while (cores_remaining()); 
```

它几乎可以忽略不计，但可能值得考虑性能优势：它同样可以编写为标准`while`循环，但这总是会进行不必要的初始比较，总是会评估`true`- 在单核上，do-while 条件分支更可预测（总是错误的，而不是标准的交替真/假`while`）。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2010-06-22T16:18:41.970

Yaa..its true.. do while will run atleast one time. Thats the only difference. Nothing else to debate on this

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2008-12-24T01:52:23.790

第一个在执行之前测试条件，因此您的代码可能永远不会进入下面的代码。第二个将在测试条件之前执行代码。

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2008-12-24T01:53:09.920

while 循环将首先检查“条件”；如果它是假的，它永远不会“做某事”。但是 do...while 循环将首先“做某事”，然后检查“条件”。

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2010-07-31T02:32:46.480

是的，就像使用 for 代替 while，或使用 foreach 代替 for 一样可以提高可读性。那就是说某些情况需要做while，我同意您将这些情况强制进入while循环是愚蠢的。

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2010-07-31T02:32:53.550

从常用用法的角度思考更有帮助。绝大多数 while 循环很自然地与 一起工作`while`，即使它们可以与 一起工作`do...while`，所以基本上你应该在差异无关紧要时使用它。因此，我将使用`do...while`它在可读性方面提供显着改进的罕见场景。

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2008-10-22T00:51:46.533

两者的用例不同。这不是“最佳实践”问题。

如果您希望循环仅基于条件执行，而不是使用 **for**或**while**

如果您想在任何条件下执行一次操作，然后根据条件评估继续执行此操作。 **做..虽然**

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2008-10-22T12:03:27.520

For anyone who can't think of a reason to have a one-or-more times loop:

```
try {
    someOperation();
} catch (Exception e) {
    do {
        if (e instanceof ExceptionIHandleInAWierdWay) {
            HandleWierdException((ExceptionIHandleInAWierdWay)e);
        }
    } while ((e = e.getInnerException())!= null);
} 
```

The same could be used for any sort of hierarchical structure.

in class Node:

```
public Node findSelfOrParentWithText(string text) {
    Node node = this;
    do {
        if(node.containsText(text)) {
            break;
        }
    } while((node = node.getParent()) != null);
    return node;
} 
```

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2008-12-24T02:15:35.070

**while()**在每次执行循环体之前检查条件，而**do...while()**在每次执行循环体之后检查条件。

因此，**do...while()**s 将始终至少执行一次循环体。

在功能上，while() 等价于

```
startOfLoop:
    if (!condition)
        goto endOfLoop;

    //loop body goes here

    goto startOfLoop;
endOfLoop: 
```

并且 do...while() 相当于

```
startOfLoop:

    //loop body

    //goes here
    if (condition)
        goto startOfLoop; 
```

请注意，实现可能比这更有效。但是， do...while() 确实比 while() 少了一个比较，因此它稍微快一些。在以下情况下使用 do...while()：

*   你*知道*第一次条件总是为真，或者
*   即使条件为假，您也*希望循环执行一次。*

* * *

## 回答 #16

> 赞同：3
> 
> 时间：2008-12-24T02:37:38.923

这是翻译：

```
do { y; } while(x); 
```

如同

```
{ y; } while(x) { y; } 
```

请注意，额外的大括号集适用于您在`y`. 这些范围必须像在 do-loop 情况下一样保持本地化。因此，do-while 循环至少执行一次它的主体。除此之外，这两个循环是相同的。因此，如果我们将此规则应用于您的代码

```
do {
    // do something
} while (condition is true); 
```

你的 do-loop 对应的 while 循环看起来像

```
{
    // do something
}
while (condition is true) {
    // do something
} 
```

是的，您看到 do 循环的相应 while 与您的 while 不同 :)

* * *

## 回答 #17

> 赞同：3
> 
> 时间：2010-07-31T04:28:21.900

我自己更喜欢 do-while 循环。如果条件在循环开始时*始终为真，我更愿意在结束时对其进行测试。*在我看来，测试条件（除了断言）的全部意义在于人们不知道测试的结果。如果我在顶部看到一个带有条件测试的 while 循环，我倾向于考虑循环执行零次的情况。如果这永远不会发生，为什么不以一种清楚地表明这一点的方式编码呢？

* * *

## 回答 #18

> 赞同：3
> 
> 时间：2010-06-22T17:52:17.327

正如 Piemasons 所指出的，不同之处在于循环是在执行测试之前执行一次，还是先执行测试以使循环体可能永远不会执行。

关键问题是哪个对您的应用程序有意义。

举两个简单的例子：

1.  假设您正在循环遍历数组的元素。如果数组没有元素，您不想处理第一个零。所以你应该使用 WHILE。

2.  您想显示一条消息，接受响应，如果响应无效，请再次询问，直到获得有效响应。所以你总是想问一次。在得到响应之前，您无法测试响应是否有效，因此您必须先遍历循环体一次，然后才能测试条件。您应该使用 DO/WHILE。

* * *

## 回答 #19

> 赞同：2
> 
> 时间：2008-10-22T00:50:28.423

它实际上是为了不同的东西。在 C 中，您可以使用 **do - while**构造来实现这两种情况（至少运行一次并在 true 时运行）。但是 PASCAL 对每个场景都有**重复 - 直到**和**同时**，如果我没记错的话，ADA 有另一个结构可以让你在中间退出，但当然这不是你要问的。我对您的问题的回答：我喜欢在顶部进行测试的循环。

* * *

## 回答 #20

> 赞同：2
> 
> 时间：2008-12-24T02:40:02.087

如果您知道如何正确编写代码，这两种约定都是正确的:)

通常使用第二个约定（*do {} while()*）是为了避免在循环之外有重复的语句。考虑以下（过度简化）示例：

```
a++;
while (a < n) {
  a++;
} 
```

可以更简洁地使用

```
do {
  a++;
} while (a < n) 
```

当然，这个特定的例子可以写成更简洁的方式（假设 C 语法）

```
while (++a < n) {} 
```

但我想你可以在这里看到重点。

* * *

## 回答 #21

> 赞同：2
> 
> 时间：2012-02-10T00:34:25.800

```
while( someConditionMayBeFalse ){

// this will never run...

}

// then the alternative

do{

// this will run once even if the condition is false

while( someConditionMayBeFalse ); 
```

区别很明显，允许您运行代码，然后评估结果以查看是否必须“再做一次”，而另一种 while 方法允许您在不满足条件时忽略脚本块。

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2008-10-22T00:56:41.593

这真的取决于有些情况你想在顶部进行测试，有些情况下你想在底部进行测试，还有一些情况你想在中间进行测试。

然而，给出的例子似乎很荒谬。如果您要在顶部进行测试，请不要使用 if 语句并在底部进行测试，只需使用 while 语句，这就是它的用途。

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2008-10-22T00:36:45.643

我几乎只在顶部编写我的测试。它的代码更少，所以至少对我来说，搞砸的可能性更小（例如，复制粘贴条件会使您总是需要更新两个地方）

* * *

## 回答 #24

> 赞同：1
> 
> 时间：2008-10-22T01:50:26.960

您应该首先将测试视为循环代码的一部分。如果测试在逻辑上属于循环处理的开始，则它是循环顶部测试。如果测试逻辑上属于循环的末尾（即它决定循环是否应该继续运行），那么它可能是循环底部测试。

如果测试在逻辑上属于它们中间，你将不得不做一些花哨的事情。:-)

* * *

## 回答 #25

> 赞同：1
> 
> 时间：2009-06-15T12:34:21.077

我猜有些人在底部进行测试，因为 30 年前这样做可以节省一个或几个机器周期。

* * *

## 回答 #26

> 赞同：1
> 
> 时间：2009-06-15T12:34:52.150

要编写正确的代码，基本上需要进行心理上的，也许是非正式的正确性证明。

要证明循环正确，标准方法是选择循环不变量和归纳证明。但是跳过复杂的词：你所做的，非正式地，找出循环的每次迭代都是真的，当循环完成时，你想要完成的现在是真的。循环不变量最后为假，循环终止。

如果循环条件很容易映射到不变量，并且不变量位于循环的顶部，并且通过处理循环的代码推断该不变量在循环的下一次迭代中为真，那么很容易找出循环是正确的。

但是，如果不变量位于循环的底部，那么除非您在循环之前有一个断言（一个好的做法），否则它会变得更加困难，因为您必须从本质上推断该不变量应该是什么，并且任何代码在循环之前运行使循环不变为真（因为没有循环前提条件，代码将在循环中执行）。即使它是非正式的头脑中的证明，证明正确也变得更加困难。

* * *

## 回答 #27

> 赞同：1
> 
> 时间：2009-06-15T12:39:27.240

这并不是一个真正的答案，而是我的一位讲师所说的话的重申，当时我很感兴趣。

这两种循环 while..do 和 do..while 实际上是第三个更通用的循环的实例，它在中间的某个地方进行了测试。

```
begin loop
  <Code block A>
  loop condition
  <Code block B>
end loop 
```

代码块 A 至少执行一次，B 执行零次或多次，但不会在最后一次（失败）迭代中运行。while 循环是当代码块 a 为空时，而 do..while 是当代码块 b 为空时。但是，如果您正在编写编译器，您可能会对将这两种情况推广到这样的循环感兴趣。

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2008-12-24T02:32:04.490

在计算机科学的典型离散结构课程中，很容易证明两者之间存在等价映射。

从风格上讲，我更喜欢 while (easy-expr) { } 当easy-expr 预先知道并准备就绪时，并且循环没有很多重复的开销/初始化。我更喜欢 do { } while (somewhat-less-easy-expr); 当有更多的重复开销并且提前设置条件可能不是那么简单时。如果我写一个无限循环，我总是使用 while (true) { }。我无法解释为什么，但我就是不喜欢为 (;;) { } 写作。

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2010-05-27T20:25:16.893

根据我对代码生成的有限知识，我认为编写底部测试循环可能是一个好主意，因为它们使编译器能够更好地执行循环优化。对于底部测试循环，保证循环至少执行一次。这意味着循环不变代码“支配”了出口节点。因此可以在循环开始之前安全地移动。

* * *

## 回答 #30

> 赞同：0
> 
> 时间：2009-06-15T13:01:05.193

我会说编写 if..do..while 循环是不好的做法，原因很简单，这会增加代码的大小并导致代码重复。代码重复很容易出错，应该避免，因为对一个部分的任何更改也必须在重复上执行，但情况并非总是如此。此外，更大的代码意味着 CPU 缓存上的时间更难。最后，它处理空情况，解决头痛问题。

只有当第一个循环根本不同时，才应该使用 do..while，例如，如果让您通过循环条件的代码（如初始化）在循环中执行。否则，如果确定该循环永远不会落在第一次迭代中，那么是的，do..while 是合适的。

* * *

## 回答 #31

> 赞同：0
> 
> 时间：2010-07-31T05:58:33.817

通常，这取决于您如何构建代码。正如有人已经回答的那样，某些算法至少需要执行一次迭代。因此，为了逃避额外的迭代计数或至少一个交互发生的标志 - 你使用 do/while。

# php - 是否有适用于 PHP/MySQL 的实体属性值 (EAV) 框架？

> ID：224065
> 
> 赞同：22
> 
> 时间：2008-10-22T00:31:39.647
> 
> 标签：php, data-structures, entity-attribute-value

是否有适用于 PHP/MySQL 的实体属性值框架？我开始写我自己的，但我觉得它已经完成了。有什么建议么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-22T19:49:30.340

我认为[Magento](http://www.magentocommerce.com/wiki/)使用了 EAV 风格的架构，可能值得一看。Magento 是一个基于 Zend 框架的电子商务平台。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-31T10:43:32.300

我一个都不知道。

话虽如此，[eZ Publish ECMS](http://ez.no/)（即 FOSS）使用 EAV 风格、高度规范化的数据模型。结构化内容类型的定义（[“内容类”](http://ez.no/doc/ez_publish/technical_manual/4_0/concepts_and_basics/content_management/the_content_class)）和内容的实际实例（文章、用户帐户、评论、产品等任何东西）都定义并存储在单个数据库表中。

这样，可以通过 Web 界面动态组合数据类型的任意组合以创建新的内容类型（“简单文章”可能包括标题的“文本行”、发布日期的“日期时间”和正文文本的“XML 字段” ）。在 EAV 中，“simplearticle”是实体，“headline”是属性名称，“Textline”是其值，而包含“Textline”数据类型的长度和验证规则是 EAV 上下文中的元数据。

正如任何 EAV 架构所期望的那样，这种灵活性是以降低性能为代价的，因为任何查找都需要多个自连接，一个用于透视结果集中的每一列。

不幸的是，这个堆栈还没有进入 eZ 的相关[eZ 组件](http://ez.no/ezcomponents)库（它具有数据库和数据访问对象/ORM 组件，但属于标准关系类型），所以使用它意味着要么处理整个 eZ Publish enchilada 要么翻录自己需要的类库。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-31T04:48:48.743

PHP / MySQL 目前似乎没有 EAV 框架；但是，我确实发现这两个链接可能会有所帮助：

[http://www.planetmysql.org/entry.php?id=14025](http://www.planetmysql.org/entry.php?id=14025)

[http://www.iwilldomybest.com/2008/08/php-mysql-tip-3/](http://www.iwilldomybest.com/2008/08/php-mysql-tip-3/)

# java - 开源 Jalopy Eclipse 插件是否与 Ganymede 兼容？

> ID：224072
> 
> 赞同：3
> 
> 时间：2008-10-22T00:35:57.733
> 
> 标签：java, eclipse-plugin, code-formatting, eclipse-3.4, jalopy

经过大量搜索，我找到了[jalopy 的 eclipse 版本](http://sourceforge.net/project/showfiles.php?group_id=45216)的下载。这与 Eclipse 3.4 兼容吗？它的日期是 2006 年。

我已将提取的文件夹复制到我的插件目录并运行`eclipse -clean`，但在首选项中找不到任何匹配“jalopy”的内容。

如果它不兼容，是否有任何（免费）替代品？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-09-17T06:31:25.837

只是一个更新：

注意：现在最新的 eclipse3.5 Galileo[代码格式化程序](http://help.eclipse.org/galileo/topic/org.eclipse.jdt.doc.user/tasks/tasks-230.htm)：

*   支持大部分 Jalopy 格式选项。
*   对格式化程序进行了相当多的改进（在[jdt-core 的构建说明中](http://giano.com.dist.unige.it/eclipseMirror/eclipse/downloads/drops/S-3.5.1RC4-200909111628/buildnotes/buildnotes_jdt-core.html)查找术语“格式化程序” 。

[如果需要](http://help.eclipse.org/galileo/index.jsp?topic=/org.eclipse.jdt.doc.user/tasks/tasks-230.htm)，它也可以从命令行运行。

对于 eclipse 无法正确管理的特定格式选项，您可以定义[`codeFormatter`扩展点](http://help.eclipse.org/galileo/topic/org.eclipse.jdt.doc.isv/reference/extension-points/org_eclipse_jdt_core_codeFormatter.html?resultof=%22%66%6f%72%6d%61%74%74%65%72%22%20%22%66%6f%72%6d%61%74%74%22%20). [这个SO question](https://stackoverflow.com/questions/975980/how-can-i-use-the-eclipse-indenter-from-my-code)中的更多实用细节。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-22T00:55:23.170

有人告诉我，jalopy 的开源版本不用于商业用途。

eclipse 本身有很好的源代码格式化能力。转到Java | 偏好/设置。输入格式，您应该会看到各种选项。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-28T00:31:28.373

答案是“是”。首选项位于 中`Window > Jalopy Preferences`，它是从右键单击上下文菜单中运行的。不过，似乎有点马车。

# css - 如何只打印页面的一部分？

> ID：224078
> 
> 赞同：17
> 
> 时间：2008-10-22T00:38:53.827
> 
> 标签：css, filter, printing

我试图在用户打印这个巨大的表单之前隐藏一些 div，然后再显示 div。因此我想忽略页面的其余部分，只打印表单本身。

当然，当用户单击打印按钮时，我*可以*打开一个单独的页面。唯一的问题是表格真的很长，这样做会很乏味。

编辑：我之前的问题实际上并没有反映我在寻找什么。所以我把它改成了现在的。

还要感谢所有建议的 window.onbeforeprint 和 window.onafterprint。这与我编辑的问题有关。

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2008-10-22T00:42:02.120

## 首先，好的方式：

看看 window.onbeforeprint 和 window.onafterprint （我相信最初的问题是关于如何以编程方式进行）。

## 现在，更好的方法：

更好的方法是使用专门用于打印的样式。换句话说，您的 div 可能如下所示：

```
<div class="someClass noPrint">My Info</div> 
```

然后你会在你的样式表中有这个：

```
.someClass {font-family:arial;}
@media print {
    .noPrint { display: none; }
} 
```

## 另外一个选项

如果需要，您也可以将其放在单独的样式表中，这样您就不必混合样式：

```
<link rel="stylesheet" type="text/css" media="print" href="print.css"> 
```

您的屏幕样式表可以以一种方式定义“.someClass”，然后您的打印样式表可以以完全不同的方式定义它。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2008-10-22T00:43:38.890

IE 支持`onbeforeprint`and `onafterprint`，但您真正想要的是打印样式表。

```
<link rel="stylesheet" type="text/css" media="print" href="print.css"> 
```

另见：[这个答案](https://stackoverflow.com/questions/224078/how-to-print-only-parts-of-a-page#224084)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-22T00:43:10.917

您可能需要考虑使用[media="print"创建专门用于打印的样式表](http://www.alistapart.com/stories/goingtoprint/)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-22T00:46:30.193

您应该真正将其实现为 CSS media=print 样式。链接元素的媒体属性可用于选择样式表应用于哪些媒体。检查[这篇文章](http://www.alistapart.com/stories/goingtoprint/)

# c++ - 不遵循构造函数中的局部变量。这是 gdb 中的错误吗？

> ID：224090
> 
> 赞同：4
> 
> 时间：2008-10-22T00:45:23.377
> 
> 标签：c++, debugging, gdb

我目前在 Ubuntu Linux 上运行 gdb 6.7.1 版，并在 C++ 项目中工作。

令人惊讶的是，我试图调试一个构造函数，我发现在构造函数范围内声明的局部变量没有被 gdb 遵循或注意到。这是一个错误吗？

感谢您提供任何信息..

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-05T07:44:09.507

这是 GCC 中的[错误](http://gcc.gnu.org/bugzilla/show_bug.cgi?id=27574)，而不是 GDB 中的错误。

它最近被[修复](http://gcc.gnu.org/bugzilla/show_bug.cgi?id=27574#c21)了。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-22T00:49:10.280

如果您正在使用优化 (-O)，请将其禁用（删除 -O 或使用 -O0）。编译器有时太聪明了，会猜测它不需要的变量，在编译时进行计算，更改变量的范围，或其他一些技巧。

请注意，即使使用“无优化”，仍然会进行一些微不足道的优化，但它们不应过多地干扰调试。此外，由于大量内联使用 C++（包括 STL），如果不进行优化，您的程序可能会变得更慢。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-22T01:09:27.650

听起来您正在调试优化的构建。

调试器“知道”局部变量的值，因为符号文件描述了它们在函数堆栈帧中的位置。

然后调试器可以从目标进程的内存中读取变量。但是，这要求堆栈帧包含局部变量的最新副本。在没有优化的情况下编译时，生成的代码总是会在每次修改局部变量时将它们写回它们的堆栈帧位置。这使调试变得容易，但在运行时会产生成本。

对于优化的构建，编译器会经常推断出这些步骤是不必要的，并在 CPU 寄存器中保留一个值，只要它需要。很可能局部变量根本就没有写入堆栈的值。在这种情况下，调试器无法跟踪变量的值，但也不知道这一点，并且经常会从堆栈中报告数据，就好像它是变量值一样。

# php - 在 PHP 中附加到父类中的数组变量

> ID：224106
> 
> 赞同：2
> 
> 时间：2008-10-22T00:50:55.083
> 
> 标签：php, oop

如何在 PHP 中为子类扩展我父母的选项数组？

我有这样的事情：

```
class ParentClass {

     public $options = array(
          'option1'=>'setting1'
     );

     //The rest of the functions would follow
} 
```

我想在子类中附加到该选项数组而不删除任何父选项。我试过做这样的事情，但还没有完全发挥作用：

```
class ChildClass extends ParentClass {

     public $options = parent::options + array(
          'option2'=>'setting2'
     );

     //The rest of the functions would follow
} 
```

做这样的事情的最好方法是什么？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-22T00:57:28.330

我认为最好在构造函数中初始化此属性，然后您可以在任何后代类中扩展该值：

```
<?php
class ParentClass {

    public $options;
    public function __construct() {
        $this->options = array(
            'option1'=>'setting1'
        );
    }
    //The rest of the functions would follow
}

class ChildClass extends ParentClass {
    public function __construct() {
        parent::__construct();
        $this->options['option2'] = 'setting2';
    }
    //The rest of the functions would follow
}
?> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-22T00:58:27.673

PHP 与否，你应该有一个访问器来做它，所以你可以调用`$self->append_elements( 'foo' => 'bar' );`而不用担心内部实现。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-22T01:26:36.120

你可以[array_merge](http://php.net/array_merge)吗？

假设您使用 ctr 创建类。

例如

```
public function __construct(array $foo)
{
  $this->options = array_merge(parent::$options, $foo);
} 
```

# ruby-on-rails - 如何使方法应用于 ActiveRecord 对象的集合

> ID：224128
> 
> 赞同：9
> 
> 时间：2008-10-22T00:59:31.197
> 
> 标签：ruby-on-rails, ruby

目前，如果我想将一个方法应用于一组 ActiveRecord 对象，我必须像这样构造调用：

```
messages = Message.find(:all)
csv = Message.to_csv(messages) 
```

我如何定义方法，使其结构像这样？

```
messages = Message.find(:all)
csv = messages.to_csv 
```

这是当前的模型代码：

```
require 'fastercsv'
class Message < ActiveRecord::Base
  def Message.to_csv(messages)
    FasterCSV.generate do |csv|
      csv << ["from","to", "received"]
      for m in messages
        csv << [m.from,m.to,m.created_at]
      end
    end
  end
end 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-25T06:31:16.253

以下将对消息数组中包含的所有实例调用 to_csv。

```
messages = Message.find(:all)
csv = messages.map { |message| message.to_csv } 
```

在 Rails、Ruby 1.9 或通过其他方式使用 Symbol#to_proc 时，您还可以将其缩短为：

```
csv = messages.map(&:to_csv) 
```

当您想要进行更复杂的操作时，较长的形式很有用：

```
csv = messages.map { |message| 
  if message.length < 1000
    message.to_csv
  else
    "Too long"
  end
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-23T08:42:17.380

把它放在*lib/*的一个文件中。我建议称它为`base_ext.rb`

```
require 'fastercsv'
class ActiveRecord::Base
  def self.to_csv(objects, skip_attributes=[])
    FasterCSV.generate do |csv|
      csv << attribute_names - skip_attributes
      objects.each do |object|
        csv << (attribute_names - skip_attributes).map { |a| "'#{object.attributes[a]}'" }.join(", ")
      end
    end
  end
end 
```

之后，转到*config/environment.rb*并放在`require 'base_ext'`文件底部以包含新扩展名。重新启动服务器后，您应该可以访问`to_csv`所有模型类的方法，并且当您传递它时，一组对象应该为您生成一个不错的 CSV 格式。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-22T03:06:21.410

FasterCSV 修补了 Array 类并已经为其添加了一个['to_csv'](http://fastercsv.rubyforge.org/classes/Array.html#M000003)方法，但它并没有达到你想要的效果。您可以通过执行以下操作自己覆盖它：

```
class Array
  def to_csv(options = Hash.new)
    collect { |item| item.to_csv }.join "\n"
  end
end 
```

或者类似的东西，但这有点糟糕。

老实说，将其作为模型上的类方法执行的方式更有意义。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-22T01:16:29.400

您可以在 Message 类上创建一个方法来执行以下操作...

在你的控制器中......

```
@csv_file = Message.send_all_to_csv 
```

在你的模型中...

```
require 'fastercsv'
class Message < ActiveRecord::Base
  def send_all_to_csv
    @messages = Find.all
    FasterCSV.generate do |csv|
      csv << ["from","to", "received"]
      for message in @messages
        csv << [message.from,message.to,message.created_at]
      end
    end
    # do something with your csv object (return it to the controller
    # or pass it on to another class method
  end
end 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-29T18:33:59.087

如果它被隔离到一个 AR 模型，我会添加一个 to_custom_csv_array 实例方法

```
def to_custom_csv_array
  [self.from,self.to,self.created_at]
end 
```

然后覆盖类上的查找

```
def self.find(*args)
  collection = super
  collection.extend(CustomToCSV) if collection.is_a?(Array)
end 
```

并在 CustomToCSV 中定义 to_custom_csv 以生成 csv

```
module CustomToCSV
  def to_custom_csv
    FasterCSV.generate do |csv|
      csv << ["from","to", "received"]
      csv << self.map {|obj| obj.to_custom_csv_array}
    end
  end
end 
```

这是来自记忆，但应该有效。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-22T01:35:52.480

您可以直接在`messages`对象本身上定义该方法，但如果您这样做，该方法将仅适用于该特定实例：

```
def messages.to_csv()

   FasterCSV.generate do |csv|
     csv << ["from", "to", "received"]
     self.each { |m| csv << [m.from, m.to, m.created_at] }   
   end

end 
```

然后你可以这样称呼它：

```
messages.to_csv 
```

我是 Ruby 新手，所以我不确定这是否是惯用的 Ruby：也就是说，我不确定直接在对象实例上定义新方法有多普遍或被接受，我只知道这是可能的； -)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-07-03T12:11:26.587

I know that it is a very old question but just thought to provide a feedback anyway. check blog [http://blog.zahiduzzaman.com/2013/07/adding-tocsv-method-to-active-record.html](http://blog.zahiduzzaman.com/2013/07/adding-tocsv-method-to-active-record.html) just another way of achieving this

# quickbooks - 需要 QuickBooks 项目查询帮助

> ID：224130
> 
> 赞同：0
> 
> 时间：2008-10-22T01:02:23.173
> 
> 标签：quickbooks

我确信这将是一个漫长的过程，但我需要有关 QuickBooks Items 查询的帮助。

我需要查询链接到收入帐户的所有 QuickBooks 项目。有没有一种简单的方法可以做到这一点，还是我需要进行 2 个查询（一个用于项目，一个用于帐户）然后检查帐户参考？

虽然不多，但我有这个：

```
 IItemQuery query = MsgSetRequest.AppendItemQueryRq(); 

```

任何想法，将不胜感激。谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-03T13:12:18.313

您至少需要使用两个查询。您需要获取帐户列表，然后将项目 AccountRef FullName 与列表中的收入帐户进行比较。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-04T20:29:25.560

至少使用 XML，如果您查询所有项目，您可以取回所有项目的帐户，并筛选出您想要的帐户。如果您在 IncludeRetElement 中明确要求，则该帐户的全名将包含在项目查询响应中。

# c++ - 无限循环——顶部还是底部？

> ID：224138
> 
> 赞同：9
> 
> 时间：2008-10-22T01:16:19.807
> 
> 标签：c++, c, coding-style

本着问题的精神，例如[您的循环是在顶部还是底部进行测试？](https://stackoverflow.com/questions/224059/do-your-loops-test-at-the-top-or-bottom)：

您将哪种样式用于*无限*循环，为什么？

*   而（真）{}
*   做{}同时（真）；
*   为了 （;;） { }
*   标签：...转到标签；

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2008-10-22T01:18:22.530

```
while(true) {} 
```

它似乎最有效地传达了循环的含义。

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2008-10-22T01:36:19.593

```
for (;;)
{
    /* No warnings are generated about constant value in the loop conditional
       plus it is easy to change when you realize you do need limits */ 
} 
```

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2008-10-22T07:18:17.220

```
#define forever for(;;)

forever {
    /*stuff*/
} 
```

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-10-22T01:19:28.690

```
while(1)
{
//do it 
} 
```

我就是这样滚动的。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-10-22T01:37:42.553

我喜欢使用**for(;;)**方法，因为**MSVC++**编译器*抱怨*while 循环方法：

```
void main()
{
  while(1) // test.cpp(5) : warning C4127: conditional expression is constant
  {
  }

  for(;;)
  {
  }
} 
```

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-10-22T01:19:48.333

我更喜欢`while(1)`或者`while(true)`——这是最清楚的。 `do { } while(true)`似乎是不必要的混淆。同样，`for(;;)`对于以前从未见过它的人来说可能会感到困惑，但`while(true)`非常直观。而且绝对没有理由这样做`label: ... goto label;`，只是更令人困惑。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-10-22T01:30:01.510

```
10 some l33t code
20 goto 10 
```

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-10-22T01:54:17.203

我通常使用`for(;;) { }`我一直认为的“永远”。

一些语言提供了一个`repeat { }`永远循环的结构。我发现该构造在视觉上与此最相似，因为它与正常构造`for(;;) { }`如此不同。这是一个真正没有`for()`的无限循环的重要属性。`while(1) { }`

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-10-22T01:58:08.457

无限尾递归；）

它有点依赖于编译器......

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2008-10-22T02:02:47.870

我使用`for (;;)`C 风格的语言和`while true`不支持该结构的语言。

我`for (;;)`在 K&R 中学习了该方法，对我来说它一直是惯用的 C。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2009-11-20T18:16:06.640

让燃烧开始...

如果循环是一个*真正*的无限循环（即没有中断条件——只有外部事件可以终止线程/进程的执行），那么我实际上更喜欢标签和`goto`. 原因如下：

首先，使用`while`,`for`和`do ... while`, 都意味着循环可能会终止。即使终止条件永远无法实现，这些结构的*句法含义*是存在**一些**终止条件。

其次，使用循环结构引入了额外的缩进级别。我讨厌没有必要的缩进。它浪费了宝贵的柱状房地产。

第三，唯一*真正*的无限循环是*无条件*跳回循环开头的循环。仅`goto`完全符合该目的。

事实是我并没有那么在意它。他们都完成了工作，而且大多数都会产生完全相同的组装说明。**然而**，生成的程序集很可能是一个无条件跳转（如果你是优化器，那该死的），它直接映射到哪个 C 构造，孩子们？没错……你的老朋友`goto`。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-10-22T01:20:28.580

为自己编写代码时，我使用 for(;;)。其他人往往会对其语法感到困惑，因此对于其他人必须看到/使用的代码，我使用 while(true)。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-10-22T01:33:33.797

题外话：如果您考虑要表达的内容，通常不需要无限循环。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-10-22T01:53:30.340

`for (;;)`是我通常看到的。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2008-10-22T01:56:23.390

```
for(;;); 
```

填充文本。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-10-22T01:54:09.743

无限循环是一个坏主意，但在实践中并不总是成立。

我更喜欢 while(1) { } 但要确保循环中的某些内容会导致它崩溃。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2008-10-22T02:22:23.043

我通常使用`while() {}`，但在了解到这`for(;;) {}`不是某种疯狂的无效语法之后，我一定会使用更独特的选项。

你看，将无限循环与实际条件区分开来。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2008-10-22T14:35:53.670

我现在更喜欢 " `for (;;)`" 成语，因为它似乎更“突出”。我曾经使用 " `while (true)`" 成语，因为我认为它更好地表达了意图，但我已经切换了，因为我认为 " `for (;;)`" 成语足够知名，可以充分表达意图，而且我相信它更明显会更好。

有点像 Stroustrup 如何故意让 C++ 中的新演员变得丑陋——所以它们很突出。

# python - 以锯齿状列表的字典顺序更好地实现所有组合是什么？

> ID：224145
> 
> 赞同：2
> 
> 时间：2008-10-22T01:19:39.643
> 
> 标签：python, algorithm

我今天处于一个需要枚举所有可能的锯齿状列表组合的位置。例如，一种天真的方法是：

```
for a in [1,2,3]:
    for b in [4,5,6,7,8,9]:
        for c in [1,2]:
            yield (a,b,c) 
```

这是功能性的，但在可以使用的列表数量方面并不通用。这是一个更通用的方法：

```
from numpy import zeros, array, nonzero, max

make_subset = lambda x,y: [x[i][j] for i,j in enumerate(y)]

def combinations(items):
    num_items = [len(i) - 1 for i in items]
    state = zeros(len(items), dtype=int)
    finished = array(num_items, dtype=int)
    yield grab_items(items, state)
    while True:
        if state[-1] != num_items[-1]:
            state[-1] += 1
            yield make_subset(items, state)
        else:
            incrementable = nonzero(state != finished)[0]
            if not len(incrementable):
                raise StopIteration
            rightmost = max(incrementable)
            state[rightmost] += 1
            state[rightmost+1:] = 0
            yield make_subset(items, state) 
```

关于更好的方法或反对上述方法的原因的任何建议？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-22T01:49:15.667

朴素的方法可以更紧凑地编写为生成器表达式：

```
((a,b,c) for a in [1,2,3] for b in [4,5,6,7,8,9] for c in [1,2]) 
```

使用递归函数可以更简单地编写通用方法：

```
def combinations(*seqs):
  if not seqs: return (item for item in ())
  first, rest = seqs[0], seqs[1:]
  if not rest: return ((item,) for item in first)
  return ((item,) + items for item in first for items in combinations(*rest)) 
```

示例用法：

```
>>> for pair in combinations('abc', [1,2,3]):
...   print pair
... 
('a', 1)
('a', 2)
('a', 3)
('b', 1)
('b', 2)
('b', 3)
('c', 1)
('c', 2)
('c', 3) 
```

# wpf - 清除 ObservableCollection 时，e.OldItems 中没有项目

> ID：224155
> 
> 赞同：97
> 
> 时间：2008-10-22T01:22:13.507
> 
> 标签：wpf, observablecollection

我这里有一些东西真的让我措手不及。

我有一个装满项目的 T 的 ObservableCollection。我还有一个附加到 CollectionChanged 事件的事件处理程序。

当您**清除**集合时，它会导致一个 CollectionChanged 事件，其中 e.Action 设置为 NotifyCollectionChangedAction.Reset。好吧，这很正常。但奇怪的是，e.OldItems 或 e.NewItems 中都没有任何内容。**我希望 e.OldItems 会填充从集合中删除的所有项目。**

有没有其他人看过这个？如果是这样，他们是如何绕过它的？

一些背景：我正在使用 CollectionChanged 事件来附加和分离另一个事件，因此如果我没有在 e.OldItems 中获得任何项目......我将无法从该事件中分离。

**澄清：** 我知道文档并没有*直接*说明它必须以这种方式运行。但是对于其他每一个动作，它都会通知我它做了什么。所以，我的假设是它会告诉我......在清除/重置的情况下也是如此。

如果您想自己重现它，下面是示例代码。首先关闭xaml：

```
<Window
    x:Class="ObservableCollection.Window1"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    Title="Window1"
    Height="300"
    Width="300"
>
    <StackPanel>
        <Button x:Name="addButton" Content="Add" Width="100" Height="25" Margin="10" Click="addButton_Click"/>
        <Button x:Name="moveButton" Content="Move" Width="100" Height="25" Margin="10" Click="moveButton_Click"/>
        <Button x:Name="removeButton" Content="Remove" Width="100" Height="25" Margin="10" Click="removeButton_Click"/>
        <Button x:Name="replaceButton" Content="Replace" Width="100" Height="25" Margin="10" Click="replaceButton_Click"/>
        <Button x:Name="resetButton" Content="Reset" Width="100" Height="25" Margin="10" Click="resetButton_Click"/>
    </StackPanel>
</Window> 
```

接下来是后面的代码：

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Windows;
using System.Windows.Controls;
using System.Windows.Data;
using System.Windows.Documents;
using System.Windows.Input;
using System.Windows.Media;
using System.Windows.Media.Imaging;
using System.Windows.Navigation;
using System.Windows.Shapes;
using System.Collections.ObjectModel;

namespace ObservableCollection
{
    /// <summary>
    /// Interaction logic for Window1.xaml
    /// </summary>
    public partial class Window1 : Window
    {
        public Window1()
        {
            InitializeComponent();
            _integerObservableCollection.CollectionChanged += new System.Collections.Specialized.NotifyCollectionChangedEventHandler(_integerObservableCollection_CollectionChanged);
        }

        private void _integerObservableCollection_CollectionChanged(object sender, System.Collections.Specialized.NotifyCollectionChangedEventArgs e)
        {
            switch (e.Action)
            {
                case System.Collections.Specialized.NotifyCollectionChangedAction.Add:
                    break;
                case System.Collections.Specialized.NotifyCollectionChangedAction.Move:
                    break;
                case System.Collections.Specialized.NotifyCollectionChangedAction.Remove:
                    break;
                case System.Collections.Specialized.NotifyCollectionChangedAction.Replace:
                    break;
                case System.Collections.Specialized.NotifyCollectionChangedAction.Reset:
                    break;
                default:
                    break;
            }
        }

        private void addButton_Click(object sender, RoutedEventArgs e)
        {
            _integerObservableCollection.Add(25);
        }

        private void moveButton_Click(object sender, RoutedEventArgs e)
        {
            _integerObservableCollection.Move(0, 19);
        }

        private void removeButton_Click(object sender, RoutedEventArgs e)
        {
            _integerObservableCollection.RemoveAt(0);
        }

        private void replaceButton_Click(object sender, RoutedEventArgs e)
        {
            _integerObservableCollection[0] = 50;
        }

        private void resetButton_Click(object sender, RoutedEventArgs e)
        {
            _integerObservableCollection.Clear();
        }

        private ObservableCollection<int> _integerObservableCollection = new ObservableCollection<int> { 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19 };
    }
} 
```

* * *

## 回答 #1

> 赞同：47
> 
> 时间：2010-06-03T04:37:35.387

它并没有声称包含旧项目，因为重置并不意味着列表已被清除

这意味着发生了一些戏剧性的事情，计算添加/删除的成本很可能超过从头开始重新扫描列表的成本......所以这就是你应该做的。

MSDN 建议将整个集合重新排序为重置候选者的示例。

重申。**重置并不意味着明确**，这意味着*您对列表的假设现在无效。把它当作一个全新的列表来对待*。Clear 恰好是其中的一个实例，但很可能还有其他实例。

一些例子：
我有一个像这样的列表，里面有很多项目，它已经被数据绑定到 WPF`ListView`以显示在屏幕上。
如果您清除列表并引发`.Reset`事件，则性能几乎是即时的，但如果您改为引发许多单独`.Remove`的事件，则性能很糟糕，因为 WPF 会一一删除项目。我还在`.Reset`我自己的代码中使用了表明列表已被重新排序，而不是发出数千个单独的`Move`操作。与 Clear 一样，在引发许多单个事件时，性能会受到很大影响。

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2008-10-22T12:46:45.980

我们在这里遇到了同样的问题。CollectionChanged 中的重置操作不包括 OldItems。我们有一个解决方法：我们使用了以下扩展方法：

```
public static void RemoveAll(this IList list)
{
   while (list.Count > 0)
   {
      list.RemoveAt(list.Count - 1);
   }
} 
```

我们最终不支持 Clear() 函数，并在 CollectionChanged 事件中为 Reset 操作抛出 NotSupportedException。RemoveAll 将在 CollectionChanged 事件中使用正确的 OldItems 触发 Remove 操作。

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2017-03-10T08:48:44.737

好的，我知道这是一个非常古老的问题，但我想出了一个很好的解决方案，并认为我会分享。此解决方案从此处的许多出色答案中汲取灵感，但具有以下优点：

*   无需创建新类并覆盖 ObservableCollection 中的方法
*   Does not tamper with the workings of NotifyCollectionChanged (so no messing with Reset)
*   Does not make use of reflection

Here is the code:

```
 public static void Clear<T>(this ObservableCollection<T> collection, Action<ObservableCollection<T>> unhookAction)
 {
     unhookAction.Invoke(collection);
     collection.Clear();
 } 
```

This extension method simply takes an `Action` which will be invoked before the collection is cleared.

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2012-01-21T03:49:57.357

另一种选择是将 Reset 事件替换为单个 Remove 事件，该事件在其 OldItems 属性中包含所有已清除的项目，如下所示：

```
public class ObservableCollectionNoReset<T> : ObservableCollection<T>
{
    protected override void ClearItems()
    {
        List<T> removed = new List<T>(this);
        base.ClearItems();
        base.OnCollectionChanged(new NotifyCollectionChangedEventArgs(NotifyCollectionChangedAction.Remove, removed));
    }

    protected override void OnCollectionChanged(NotifyCollectionChangedEventArgs e)
    {
        if (e.Action != NotifyCollectionChangedAction.Reset)
            base.OnCollectionChanged(e);
    }
    // Constructors omitted
    ...
} 
```

好处：

1.  无需订阅其他事件（根据已接受答案的要求）

2.  不会为每个移除的对象生成事件（其他一些建议的解决方案会导致多个 Removed 事件）。

3.  订阅者只需检查任何事件的 NewItems 和 OldItems 即可根据需要添加/删除事件处理程序。

缺点：

1.  没有重置事件

2.  创建列表副本的小 (?) 开销。

3.  ？？？

编辑 2012-02-23

不幸的是，当绑定到基于 WPF 列表的控件时，清除具有多个元素的 ObservableCollectionNoReset 集合将导致异常“不支持范围操作”。为了与具有此限制的控件一起使用，我将 ObservableCollectionNoReset 类更改为：

```
public class ObservableCollectionNoReset<T> : ObservableCollection<T>
{
    // Some CollectionChanged listeners don't support range actions.
    public Boolean RangeActionsSupported { get; set; }

    protected override void ClearItems()
    {
        if (RangeActionsSupported)
        {
            List<T> removed = new List<T>(this);
            base.ClearItems();
            base.OnCollectionChanged(new NotifyCollectionChangedEventArgs(NotifyCollectionChangedAction.Remove, removed));
        }
        else
        {
            while (Count > 0 )
                base.RemoveAt(Count - 1);
        }                
    }

    protected override void OnCollectionChanged(NotifyCollectionChangedEventArgs e)
    {
        if (e.Action != NotifyCollectionChangedAction.Reset)
            base.OnCollectionChanged(e);
    }

    public ObservableCollectionNoReset(Boolean rangeActionsSupported = false) 
    {
        RangeActionsSupported = rangeActionsSupported;
    }

    // Additional constructors omitted.
 } 
```

当 RangeActionsSupported 为 false（默认值）时，效率不高，因为集合中的每个对象都会生成一个 Remove 通知

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2012-02-23T15:57:02.020

我找到了一个解决方案，它允许用户在一次只触发一个事件的同时利用一次添加或删除许多项目的效率 - 并满足 UIElements 获取 Action.Reset 事件参数的需求，而所有其他用户会就像添加和删除的元素列表。

此解决方案涉及覆盖 CollectionChanged 事件。当我们去触发这个事件时，我们实际上可以查看每个注册的处理程序的目标并确定它们的类型。由于只有 ICollectionView 类`NotifyCollectionChangedAction.Reset`在多个项目更改时需要 args，因此我们可以将它们单独列出，并为其他所有人提供适当的事件 args，其中包含删除或添加的项目的完整列表。下面是实现。

```
public class BaseObservableCollection<T> : ObservableCollection<T>
{
    //Flag used to prevent OnCollectionChanged from firing during a bulk operation like Add(IEnumerable<T>) and Clear()
    private bool _SuppressCollectionChanged = false;

    /// Overridden so that we may manually call registered handlers and differentiate between those that do and don't require Action.Reset args.
    public override event NotifyCollectionChangedEventHandler CollectionChanged;

    public BaseObservableCollection() : base(){}
    public BaseObservableCollection(IEnumerable<T> data) : base(data){}

    #region Event Handlers
    protected override void OnCollectionChanged(NotifyCollectionChangedEventArgs e)
    {
        if( !_SuppressCollectionChanged )
        {
            base.OnCollectionChanged(e);
            if( CollectionChanged != null )
                CollectionChanged.Invoke(this, e);
        }
    }

    //CollectionViews raise an error when they are passed a NotifyCollectionChangedEventArgs that indicates more than
    //one element has been added or removed. They prefer to receive a "Action=Reset" notification, but this is not suitable
    //for applications in code, so we actually check the type we're notifying on and pass a customized event args.
    protected virtual void OnCollectionChangedMultiItem(NotifyCollectionChangedEventArgs e)
    {
        NotifyCollectionChangedEventHandler handlers = this.CollectionChanged;
        if( handlers != null )
            foreach( NotifyCollectionChangedEventHandler handler in handlers.GetInvocationList() )
                handler(this, !(handler.Target is ICollectionView) ? e : new NotifyCollectionChangedEventArgs(NotifyCollectionChangedAction.Reset));
    }
    #endregion

    #region Extended Collection Methods
    protected override void ClearItems()
    {
        if( this.Count == 0 ) return;

        List<T> removed = new List<T>(this);
        _SuppressCollectionChanged = true;
        base.ClearItems();
        _SuppressCollectionChanged = false;
        OnCollectionChangedMultiItem(new NotifyCollectionChangedEventArgs(NotifyCollectionChangedAction.Remove, removed));
    }

    public void Add(IEnumerable<T> toAdd)
    {
        if( this == toAdd )
            throw new Exception("Invalid operation. This would result in iterating over a collection as it is being modified.");

        _SuppressCollectionChanged = true;
        foreach( T item in toAdd )
            Add(item);
        _SuppressCollectionChanged = false;
        OnCollectionChangedMultiItem(new NotifyCollectionChangedEventArgs(NotifyCollectionChangedAction.Add, new List<T>(toAdd)));
    }

    public void Remove(IEnumerable<T> toRemove)
    {
        if( this == toRemove )
            throw new Exception("Invalid operation. This would result in iterating over a collection as it is being modified.");

        _SuppressCollectionChanged = true;
        foreach( T item in toRemove )
            Remove(item);
        _SuppressCollectionChanged = false;
        OnCollectionChangedMultiItem(new NotifyCollectionChangedEventArgs(NotifyCollectionChangedAction.Remove, new List<T>(toRemove)));
    }
    #endregion
} 
```

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2008-10-22T13:43:23.090

好的，尽管我仍然希望 ObservableCollection 的行为如我所愿......下面的代码是我最终要做的。基本上，我创建了一个名为 TrulyObservableCollection 的新 T 集合，并覆盖了 ClearItems 方法，然后我用它来引发 Clearing 事件。

在使用此 TrulyObservableCollection 的代码中，我使用此 Clearing 事件循环遍历此时*仍在集合中的项目，*以对我希望分离的事件执行分离。

希望这种方法对其他人也有帮助。

```
public class TrulyObservableCollection<T> : ObservableCollection<T>
{
    public event EventHandler<EventArgs> Clearing;
    protected virtual void OnClearing(EventArgs e)
    {
        if (Clearing != null)
            Clearing(this, e);
    }

    protected override void ClearItems()
    {
        OnClearing(EventArgs.Empty);
        base.ClearItems();
    }
} 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-07-04T20:15:05.957

我以稍微不同的方式解决了这个问题，因为我想注册一个事件并处理事件处理程序中的所有添加和删除。我开始覆盖集合更改事件并将重置操作重定向到带有项目列表的删除操作。这一切都出错了，因为我将可观察集合用作集合视图的项目源并得到“不支持范围操作”。

我最终创建了一个名为 CollectionChangedRange 的新事件，它以我期望内置版本的方式运行。

我无法想象为什么会允许这种限制，并希望这篇文章至少能阻止其他人走上我所做的死胡同。

```
/// <summary>
/// An observable collection with support for addrange and clear
/// </summary>
/// <typeparam name="T"></typeparam>
[Serializable]
[TypeConverter(typeof(ExpandableObjectConverter))]
public class ObservableCollectionRange<T> : ObservableCollection<T>
{
    private bool _addingRange;

    [field: NonSerialized]
    public event NotifyCollectionChangedEventHandler CollectionChangedRange;

    protected virtual void OnCollectionChangedRange(NotifyCollectionChangedEventArgs e)
    {
        if ((CollectionChangedRange == null) || _addingRange) return;
        using (BlockReentrancy())
        {
            CollectionChangedRange(this, e);
        }
    }

    public void AddRange(IEnumerable<T> collection)
    {
        CheckReentrancy();
        var newItems = new List<T>();
        if ((collection == null) || (Items == null)) return;
        using (var enumerator = collection.GetEnumerator())
        {
            while (enumerator.MoveNext())
            {
                _addingRange = true;
                Add(enumerator.Current);
                _addingRange = false;
                newItems.Add(enumerator.Current);
            }
        }
        OnCollectionChangedRange(new NotifyCollectionChangedEventArgs(NotifyCollectionChangedAction.Add, newItems));
    }

    protected override void ClearItems()
    {
        CheckReentrancy();
        var oldItems = new List<T>(this);
        base.ClearItems();
        OnCollectionChangedRange(new NotifyCollectionChangedEventArgs(NotifyCollectionChangedAction.Remove, oldItems));
    }

    protected override void InsertItem(int index, T item)
    {
        CheckReentrancy();
        base.InsertItem(index, item);
        OnCollectionChangedRange(new NotifyCollectionChangedEventArgs(NotifyCollectionChangedAction.Add, item, index));
    }

    protected override void MoveItem(int oldIndex, int newIndex)
    {
        CheckReentrancy();
        var item = base[oldIndex];
        base.MoveItem(oldIndex, newIndex);
        OnCollectionChangedRange(new NotifyCollectionChangedEventArgs(NotifyCollectionChangedAction.Move, item, newIndex, oldIndex));
    }

    protected override void RemoveItem(int index)
    {
        CheckReentrancy();
        var item = base[index];
        base.RemoveItem(index);
        OnCollectionChangedRange(new NotifyCollectionChangedEventArgs(NotifyCollectionChangedAction.Remove, item, index));
    }

    protected override void SetItem(int index, T item)
    {
        CheckReentrancy();
        var oldItem = base[index];
        base.SetItem(index, item);
        OnCollectionChanged(new NotifyCollectionChangedEventArgs(NotifyCollectionChangedAction.Replace, oldItem, item, index));
    }
}

/// <summary>
/// A read only observable collection with support for addrange and clear
/// </summary>
/// <typeparam name="T"></typeparam>
[Serializable]
[TypeConverter(typeof(ExpandableObjectConverter))]
public class ReadOnlyObservableCollectionRange<T> : ReadOnlyObservableCollection<T>
{
    [field: NonSerialized]
    public event NotifyCollectionChangedEventHandler CollectionChangedRange;

    public ReadOnlyObservableCollectionRange(ObservableCollectionRange<T> list) : base(list)
    {
        list.CollectionChangedRange += HandleCollectionChangedRange;
    }

    private void HandleCollectionChangedRange(object sender, NotifyCollectionChangedEventArgs e)
    {
        OnCollectionChangedRange(e);
    }

    protected virtual void OnCollectionChangedRange(NotifyCollectionChangedEventArgs args)
    {
        if (CollectionChangedRange != null)
        {
            CollectionChangedRange(this, args);
        }
    }

} 
```

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-10-22T10:53:46.490

这就是 ObservableCollection 的工作方式，您可以通过将自己的列表保留在 ObservableCollection 之外来解决此问题（当操作为添加时添加到列表中，当操作为移除时移除等）然后您可以获得所有已移除的项目（或添加的项目) 当通过将您的列表与 ObservableCollection 进行比较来重置操作时。

另一种选择是创建您自己的实现 IList 和 INotifyCollectionChanged 的​​类，然后您可以在该类中附加和分离事件（或者如果您愿意，可以将 OldItems 设置为 Clear）——这确实不难，但需要大量输入。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2010-05-28T17:25:17.150

对于将事件处理程序附加和分离到 ObservableCollection 元素的场景，还有一个“客户端”解决方案。在事件处理代码中，您可以使用 Contains 方法检查发送者是否在 ObservableCollection 中。优点：您可以使用任何现有的 ObservableCollection。缺点： Contains 方法以 O(n) 运行，其中 n 是 ObservableCollection 中的元素数。所以这是一个小的 ObservableCollections 的解决方案。

另一个“客户端”解决方案是在中间使用事件处理程序。只需将所有事件注册到中间的事件处理程序中即可。该事件处理程序反过来通过回调或事件通知真正的事件处理程序。如果发生重置操作，则删除回调或事件，在中间创建一个新的事件处理程序并忘记旧的。这种方法也适用于大型 ObservableCollections。我将它用于 PropertyChanged 事件（参见下面的代码）。

```
 /// <summary>
    /// Helper class that allows to "detach" all current Eventhandlers by setting
    /// DelegateHandler to null.
    /// </summary>
    public class PropertyChangedDelegator
    {
        /// <summary>
        /// Callback to the real event handling code.
        /// </summary>
        public PropertyChangedEventHandler DelegateHandler;
        /// <summary>
        /// Eventhandler that is registered by the elements.
        /// </summary>
        /// <param name="sender">the element that has been changed.</param>
        /// <param name="e">the event arguments</param>
        public void PropertyChangedHandler(Object sender, PropertyChangedEventArgs e)
        {
            if (DelegateHandler != null)
            {
                DelegateHandler(sender, e);
            }
            else
            {
                INotifyPropertyChanged s = sender as INotifyPropertyChanged;
                if (s != null)
                    s.PropertyChanged -= PropertyChangedHandler;
            }   
        }
    } 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-10-22T01:35:26.803

查看[NotifyCollectionChangedEventArgs](http://msdn.microsoft.com/en-us/library/system.collections.specialized.notifycollectionchangedeventargs_members.aspx)，似乎 OldItems 仅包含因替换、删除或移动操作而更改的项目。它并不表示它将在 Clear 上包含任何内容。我怀疑 Clear 触发了该事件，但没有注册已删除的项目，并且根本没有调用 Remove 代码。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2009-10-01T19:10:11.753

好吧，我决定自己弄脏它。

Microsoft 做了大量工作，始终确保 NotifyCollectionChangedEventArgs 在调用重置时没有任何数据。我假设这是一个性能/内存决定。如果您要重置包含 100,000 个元素的集合，我假设他们不想复制所有这些元素。

但鉴于我的收藏从来没有超过 100 个元素，我认为它没有问题。

无论如何，我使用以下方法创建了一个继承类：

```
protected override void ClearItems()
{
    CheckReentrancy();
    List<TItem> oldItems = new List<TItem>(Items);

    Items.Clear();

    OnPropertyChanged(new PropertyChangedEventArgs("Count"));
    OnPropertyChanged(new PropertyChangedEventArgs("Item[]"));

    NotifyCollectionChangedEventArgs e =
        new NotifyCollectionChangedEventArgs
        (
            NotifyCollectionChangedAction.Reset
        );

        FieldInfo field =
            e.GetType().GetField
            (
                "_oldItems",
                BindingFlags.Instance | BindingFlags.NonPublic
            );
        field.SetValue(e, oldItems);

        OnCollectionChanged(e);
    } 
```

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2010-07-13T12:18:28.053

ObservableCollection 和 INotifyCollectionChanged 接口在编写时明确考虑了特定用途：UI 构建及其特定的性能特征。

当您想要收集更改的通知时，您通常只对 Add 和 Remove 事件感兴趣。

我使用以下界面：

```
using System;
using System.Collections.Generic;

/// <summary>
/// Notifies listeners of the following situations:
/// <list type="bullet">
/// <item>Elements have been added.</item>
/// <item>Elements are about to be removed.</item>
/// </list>
/// </summary>
/// <typeparam name="T">The type of elements in the collection.</typeparam>
interface INotifyCollection<T>
{
    /// <summary>
    /// Occurs when elements have been added.
    /// </summary>
    event EventHandler<NotifyCollectionEventArgs<T>> Added;

    /// <summary>
    /// Occurs when elements are about to be removed.
    /// </summary>
    event EventHandler<NotifyCollectionEventArgs<T>> Removing;
}

/// <summary>
/// Provides data for the NotifyCollection event.
/// </summary>
/// <typeparam name="T">The type of elements in the collection.</typeparam>
public class NotifyCollectionEventArgs<T> : EventArgs
{
    /// <summary>
    /// Gets or sets the elements.
    /// </summary>
    /// <value>The elements.</value>
    public IEnumerable<T> Items
    {
        get;
        set;
    }
} 
```

我还编写了自己的 Collection 重载，其中：

*   ClearItems 提出移除
*   InsertItem 引发已添加
*   RemoveItem 引发删除
*   SetItem 提出删除和添加

当然，也可以添加 AddRange。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-07-16T16:05:57.793

我刚刚浏览了 Silverlight 和 WPF 工具包中的一些图表代码，并注意到他们也解决了这个问题（以一种类似的方式）......我想我会继续发布他们的解决方案。

基本上，他们还创建了一个派生的 ObservableCollection 并覆盖了 ClearItems，在每个被清除的项目上调用 Remove。

这是代码：

```
/// <summary>
/// An observable collection that cannot be reset.  When clear is called
/// items are removed individually, giving listeners the chance to detect
/// each remove event and perform operations such as unhooking event 
/// handlers.
/// </summary>
/// <typeparam name="T">The type of item in the collection.</typeparam>
public class NoResetObservableCollection<T> : ObservableCollection<T>
{
    public NoResetObservableCollection()
    {
    }

    /// <summary>
    /// Clears all items in the collection by removing them individually.
    /// </summary>
    protected override void ClearItems()
    {
        IList<T> items = new List<T>(this);
        foreach (T item in items)
        {
            Remove(item);
        }
    }
} 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2011-03-18T18:51:05.657

这是一个热门话题……因为在我看来，微软没有做好它的工作……再一次。不要误会我，我喜欢微软，但它们并不完美！

我阅读了之前的大部分评论。我同意所有认为微软没有正确编程 Clear() 的人的观点。

在我看来，至少，它需要一个论据才能将对象从事件中分离出来......但我也理解它的影响。然后，我想出了这个提议的解决方案。

我希望它能让每个人都开心，或者至少，大多数人......

埃里克

```
using System;
using System.Collections.Generic;
using System.Collections.ObjectModel;
using System.Collections.Specialized;
using System.Reflection;

namespace WpfUtil.Collections
{
    public static class ObservableCollectionExtension
    {
        public static void RemoveAllOneByOne<T>(this ObservableCollection<T> obsColl)
        {
            foreach (T item in obsColl)
            {
                while (obsColl.Count > 0)
                {
                    obsColl.RemoveAt(0);
                }
            }
        }

        public static void RemoveAll<T>(this ObservableCollection<T> obsColl)
        {
            if (obsColl.Count > 0)
            {
                List<T> removedItems = new List<T>(obsColl);
                obsColl.Clear();

                NotifyCollectionChangedEventArgs e =
                    new NotifyCollectionChangedEventArgs
                    (
                        NotifyCollectionChangedAction.Remove,
                        removedItems
                    );
                var eventInfo =
                    obsColl.GetType().GetField
                    (
                        "CollectionChanged",
                        BindingFlags.Instance | BindingFlags.NonPublic
                    );
                if (eventInfo != null)
                {
                    var eventMember = eventInfo.GetValue(obsColl);
                    // note: if eventMember is null
                    // nobody registered to the event, you can't call it.
                    if (eventMember != null)
                        eventMember.GetType().GetMethod("Invoke").
                            Invoke(eventMember, new object[] { obsColl, e });
                }
            }
        }
    }
} 
```

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2011-12-28T20:12:50.653

为简单起见，您为什么不重写 ClearItem 方法并在那里做任何您想做的事情，即从事件中分离项目。

```
public class PeopleAttributeList : ObservableCollection<PeopleAttributeDto>,    {
{
  protected override void ClearItems()
  {
    Do what ever you want
    base.ClearItems();
  }

  rest of the code omitted
} 
```

简单、干净并包含在集合代码中。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2013-11-21T01:31:12.963

我有同样的问题，这是我的解决方案。它似乎工作。有没有人看到这种方法有任何潜在的问题？

```
// overriden so that we can call GetInvocationList
public override event NotifyCollectionChangedEventHandler CollectionChanged;

protected override void OnCollectionChanged(NotifyCollectionChangedEventArgs e)
{
    NotifyCollectionChangedEventHandler collectionChanged = CollectionChanged;
    if (collectionChanged != null)
    {
        lock (collectionChanged)
        {
            foreach (NotifyCollectionChangedEventHandler handler in collectionChanged.GetInvocationList())
            {
                try
                {
                    handler(this, e);
                }
                catch (NotSupportedException ex)
                {
                    // this will occur if this collection is used as an ItemsControl.ItemsSource
                    if (ex.Message == "Range actions are not supported.")
                    {
                        handler(this, new NotifyCollectionChangedEventArgs(NotifyCollectionChangedAction.Reset));
                    }
                    else
                    {
                        throw ex;
                    }
                }
            }
        }
    }
} 
```

以下是我课堂上其他一些有用的方法：

```
public void SetItems(IEnumerable<T> newItems)
{
    Items.Clear();
    foreach (T newItem in newItems)
    {
        Items.Add(newItem);
    }
    NotifyCollectionChanged(new NotifyCollectionChangedEventArgs(NotifyCollectionChangedAction.Reset));
}

public void AddRange(IEnumerable<T> newItems)
{
    int index = Count;
    foreach (T item in newItems)
    {
        Items.Add(item);
    }
    NotifyCollectionChangedEventArgs e = new NotifyCollectionChangedEventArgs(NotifyCollectionChangedAction.Add, new List<T>(newItems), index);
    NotifyCollectionChanged(e);
}

public void RemoveRange(int startingIndex, int count)
{
    IList<T> oldItems = new List<T>();
    for (int i = 0; i < count; i++)
    {
        oldItems.Add(Items[startingIndex]);
        Items.RemoveAt(startingIndex);
    }
    NotifyCollectionChangedEventArgs e = new NotifyCollectionChangedEventArgs(NotifyCollectionChangedAction.Remove, new List<T>(oldItems), startingIndex);
    NotifyCollectionChanged(e);
}

// this needs to be overridden to avoid raising a NotifyCollectionChangedEvent with NotifyCollectionChangedAction.Reset, which our other lists don't support
new public void Clear()
{
    RemoveRange(0, Count);
}

public void RemoveWhere(Func<T, bool> criterion)
{
    List<T> removedItems = null;
    int startingIndex = default(int);
    int contiguousCount = default(int);
    for (int i = 0; i < Count; i++)
    {
        T item = Items[i];
        if (criterion(item))
        {
            if (removedItems == null)
            {
                removedItems = new List<T>();
                startingIndex = i;
                contiguousCount = 0;
            }
            Items.RemoveAt(i);
            removedItems.Add(item);
            contiguousCount++;
        }
        else if (removedItems != null)
        {
            NotifyCollectionChanged(new NotifyCollectionChangedEventArgs(NotifyCollectionChangedAction.Remove, removedItems, startingIndex));
            removedItems = null;
            i = startingIndex;
        }
    }
    if (removedItems != null)
    {
        NotifyCollectionChanged(new NotifyCollectionChangedEventArgs(NotifyCollectionChangedAction.Remove, removedItems, startingIndex));
    }
}

private void NotifyCollectionChanged(NotifyCollectionChangedEventArgs e)
{
    OnPropertyChanged(new PropertyChangedEventArgs("Count"));
    OnPropertyChanged(new PropertyChangedEventArgs("Item[]"));
    OnCollectionChanged(e);
} 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2014-08-27T14:09:13.817

我发现了另一个源自 ObservableCollection 的“简单”解决方案，但它不是很优雅，因为它使用反射......如果你喜欢这里是我的解决方案：

```
public class ObservableCollectionClearable<T> : ObservableCollection<T>
{
    private T[] ClearingItems = null;

    protected override void OnCollectionChanged(System.Collections.Specialized.NotifyCollectionChangedEventArgs e)
    {
        switch (e.Action)
        {
            case System.Collections.Specialized.NotifyCollectionChangedAction.Reset:
                if (this.ClearingItems != null)
                {
                    ReplaceOldItems(e, this.ClearingItems);
                    this.ClearingItems = null;
                }
                break;
        }
        base.OnCollectionChanged(e);
    }

    protected override void ClearItems()
    {
        this.ClearingItems = this.ToArray();
        base.ClearItems();
    }

    private static void ReplaceOldItems(System.Collections.Specialized.NotifyCollectionChangedEventArgs e, T[] olditems)
    {
        Type t = e.GetType();
        System.Reflection.FieldInfo foldItems = t.GetField("_oldItems", System.Reflection.BindingFlags.NonPublic | System.Reflection.BindingFlags.Instance);
        if (foldItems != null)
        {
            foldItems.SetValue(e, olditems);
        }
    }
} 
```

这里我将当前元素保存在 ClearItems 方法中的一个数组字段中，然后在启动 base.OnCollectionChanged 之前拦截 OnCollectionChanged 的​​调用并覆盖 e._oldItems 私有字段（通过反射）

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2015-09-18T10:59:33.627

您可以使用 Remove 操作和 OldItems 覆盖 ClearItems 方法并引发事件。

```
public class ObservableCollection<T> : System.Collections.ObjectModel.ObservableCollection<T>
{
    protected override void ClearItems()
    {
        CheckReentrancy();
        var items = Items.ToList();
        base.ClearItems();
        OnPropertyChanged(new PropertyChangedEventArgs("Count"));
        OnPropertyChanged(new PropertyChangedEventArgs("Item[]"));
        OnCollectionChanged(new NotifyCollectionChangedEventArgs(NotifyCollectionChangedAction.Remove, items, -1));
    }
} 
```

部分`System.Collections.ObjectModel.ObservableCollection<T>`实现：

```
public class ObservableCollection<T> : Collection<T>, INotifyCollectionChanged, INotifyPropertyChanged
{
    protected override void ClearItems()
    {
        CheckReentrancy();
        base.ClearItems();
        OnPropertyChanged(CountString);
        OnPropertyChanged(IndexerName);
        OnCollectionReset();
    }

    private void OnPropertyChanged(string propertyName)
    {
        OnPropertyChanged(new PropertyChangedEventArgs(propertyName));
    }

    private void OnCollectionReset()
    {
        OnCollectionChanged(new   NotifyCollectionChangedEventArgs(NotifyCollectionChangedAction.Reset));
    }

    private const string CountString = "Count";

    private const string IndexerName = "Item[]";
} 
```

* * *

## 回答 #19

> 赞同：-4
> 
> 时间：2011-04-06T13:48:52.250

[http://msdn.microsoft.com/en-us/library/system.collections.specialized.notifycollectionchangedaction(VS.95).aspx](http://msdn.microsoft.com/en-us/library/system.collections.specialized.notifycollectionchangedaction(VS.95).aspx)

请睁大眼睛并打开大脑阅读本文档。微软做对了一切。当它为您抛出重置通知时，您必须重新扫描您的收藏。您会收到重置通知，因为为每个项目（从集合中删除并重新添加到集合中）抛出 Add/Remove 太昂贵了。

Orion Edwards 是完全正确的（尊重，伙计）。请在阅读文档时考虑更广泛。

* * *

## 回答 #20

> 赞同：-5
> 
> 时间：2013-05-20T09:24:01.770

如果你`ObservableCollection`不清楚，那么你可以试试下面的代码。它可以帮助您：

```
private TestEntities context; // This is your context

context.Refresh(System.Data.Objects.RefreshMode.StoreWins, context.UserTables); // to refresh the object context 
```

# database-design - 基于公式的定价。存储在 RDBMS 中并在应用层使用

> ID：224162
> 
> 赞同：3
> 
> 时间：2008-10-22T01:27:42.980
> 
> 标签：database-design, rdbms, business-logic

我即将进入设计商品交易应用程序的第一阶段。该应用程序的一个主要功能是获取和评估定价信息。这个市场的定价不是固定的。它通常是市场基准 +/- 溢价。例如：（A和B是市场基准）

*   价格 = A + 1 美元
*   价格 = A + .5(AB)

交易的最终价格是使用在约定时间内应用的定价公式计算的。例如; 最终价格可能是装载商品前一周和后一周的平均 A + 1 美元。

目前，交易者正在 Excel 中捕获此详细信息，这使他们能够灵活地设置所需的公式，但此信息从未进入我们的会计系统，并且电子表格未连接到市场基准的实时预测，使得价格预测成为手动和缓慢的任务。

**我正在寻找关于我可以使用哪些工具/技术在应用程序中输入、存储和评估公式的输入。**

我们将使用 SQL Server 或 Oracle 作为数据库，客户端平台尚未固定，但您可以假设 WinForms/WPF、ASP.NET 或 Java webapp。

我知道这是一个相当广泛的问题，但我们还远远不够，无法更具体地说明将使用哪些技术。

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-22T02:39:25.050

我敢打赌，您的用户喜欢将公式输入 Excel 的灵活性，所以我建议采用这样的方法：-

1.  写一些东西，让他们使用他们实际将与关键字一起用于不同基本价格的运算符类型将公式输入到您的应用程序中。这可以作为字符串存储起来。
2.  使用白名单方法验证这一点（可能相当棘手，也许您需要查找一些基于堆栈的解析算法）。您可能允许：+ - / * ( ) {numeric constants} {keywords for base prices}。
3.  将这些公式翻译成您的数据库可以在 SELECT 列表中理解的内容。如果他们输入的公式与您在 SQL 中可以做的相似，这可能不会太难。关键字变成了列名，其他所有内容都可以不用管。

然后，您将能够通过插入特殊公式并在您的历史数据和/或预测上运行它来选择数据、在时间段内平均等。

第 2 步有一些技巧，但它会使其他一切变得简单（高效）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-22T11:15:26.383

您是否考虑过与 Excel 集成？这样，您就不必试图从他们的魔掌中撬开 Excel（商业用户**喜欢**Excel），他们可以使用他们多年来学到的所有技巧。您只需使用 VBA 在您的应用程序和 Excel 之间来回传输数据（或者现在他们告诉人们与 Excel 集成），您就可以开始使用了。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-22T12:17:46.070

我有一个与汉克的命题相关的简单得可笑的解决方案。创建一个数据库并按照您的 Excel 表对其进行建模。导出 Excel 数据并将其导入数据库。在客户端计算机上创建 ODBC 连接器以指向数据库。在 Excel 中，您可以连接到数据源。这样，您的客户将不会遇到 UI 更改的问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-22T01:55:07.997

有趣的场景。警告：此回复基于我对解决问题的一些想法，可能无法反映最佳实践。

我会尝试看看您是否可以将潜在的公式规则归结为更简单的结构。然后，这将允许您将规则组合在一起以创建复杂的公式。然后，您需要能够将规则存储在数据库中，这可以使用 DSL 或一些 XML 规则文件来完成。

听起来您当前的情况，excel中的公式，运行良好，但有一些小问题。您是否考虑过使用一些高级宏或 excel 自动化？您可能可以实现您的大部分目标，而您的客户不必离开 Excel。

祝你好运。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-22T03:11:02.227

如果数据来自受信任的来源（大 if），您可以将数据库表达式存储在列中，然后动态创建 SELECT 语句来执行它。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-22T03:15:49.377

您可以使用[GiNaC](http://www.ginac.de/)等符号数学包来解释您输入到表格中的公式。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-23T02:25:05.470

感谢您的回复。

用户自己想摆脱 Excel。他们正在与试图输入和更新数据的多个用户作斗争。我可能会调查 VSTO 为将小型 Excel 工作表嵌入到应用程序中提供了哪些选项。

我倾向于使用嵌入式“语言”来存储和评估公式。

使用简单的解析器将输入的公式转换为 SQL 可能是一个合理的想法，因为方程中的变量是时间序列向量而不是标量数据点，并且 SQL 方法应该更容易在所需时间段内计算结果。

谢谢

# c++ - 捕获 R6025 纯虚拟呼叫

> ID：224163
> 
> 赞同：15
> 
> 时间：2008-10-22T01:29:54.287
> 
> 标签：c++, windows, minidump, dbghelp

我目前使用捕获未处理异常的 MiniDumps，`SetUnhandledExceptionFilter`但有时我会收到“R6025：纯虚函数”。

我了解纯虚函数调用是如何发生的，我只是想知道是否可以捕获它们，以便我可以在那时创建一个 MiniDump。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-10-22T01:38:42.537

如果你想捕捉所有的崩溃，你要做的不仅仅是：SetUnhandledExceptionFilter

我还将设置中止处理程序、纯调用处理程序、意外、终止和无效参数处理程序。

```
#include <signal.h>

inline void signal_handler(int)
{
    terminator();
}

inline void terminator() 
{
    int*z = 0; *z=13; 
}

inline void __cdecl invalid_parameter_handler(const wchar_t *, const wchar_t *, const wchar_t *, unsigned int, uintptr_t)
{
   terminator();
} 
```

在你的主要放这个：

```
 signal(SIGABRT, signal_handler);
 _set_abort_behavior(0, _WRITE_ABORT_MSG|_CALL_REPORTFAULT);

 set_terminate( &terminator );
 set_unexpected( &terminator );
 _set_purecall_handler( &terminator );
 _set_invalid_parameter_handler( &invalid_parameter_handler ); 
```

以上会将所有崩溃发送到您未处理的异常处理程序。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-10-22T01:38:41.337

请参阅[此处对](https://stackoverflow.com/questions/99552/where-do-pure-virtual-function-call-crashes-come-from#100555)[“纯虚函数调用”崩溃从何而来](https://stackoverflow.com/questions/99552/where-do-pure-virtual-function-call-crashes-come-from)的问题的答案？.

> 为了帮助调试这些类型的问题，您可以在各种版本的 MSVC 中替换运行时库的 purecall 处理程序。您可以通过使用此签名提供您自己的函数来做到这一点：

```
int __cdecl _purecall(void) 
```

> 并在链接运行时库之前链接它。这使您可以控制检测到纯调用时发生的情况。一旦你有了控制权，你就可以做一些比标准处理程序更有用的事情。我有一个处理程序，可以提供纯调用发生位置的堆栈跟踪；请参阅此处： http: [//www.lenholgate.com/archives/000623.html](http://www.lenholgate.com/archives/000623.html) 了解更多详情。
> 
> （请注意，您也可以调用 `_set_purecall_handler()`以在某些版本的 MSVC 中安装您的处理程序）。

因此，在您的 purecall 处理程序中，制作您的小型转储。

* * *

## 回答 #3

> 赞同：-2
> 
> 时间：2008-10-22T01:40:16.933

尝试定义有问题的纯虚拟。C++ 规则中没有任何内容禁止您定义纯虚拟，您可以出于多种原因使用它，其中最少的原因是在调用中获得回溯。唯一需要注意的是定义必须在声明之外（`virtual void bla() = 0 { }`无效）。

# php - 在多个页面上使用 PHP 变量

> ID：224173
> 
> 赞同：0
> 
> 时间：2008-10-22T01:36:58.937
> 
> 标签：php, variables

是否可以在另一页的一段代码中使用一个页面中的变量？例如，在一个页面上提交一个表单，在第二个页面上使用 PHP 脚本将数据从表单添加到 MySQL 表

感谢所有的帮助

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-22T02:35:26.323

您最好的选择是使用 PHP 的会话函数。这样，如果用户离开您的页面然后返回，会话变量仍将存在（假设会话尚未过期）。您可以在此处获得更多信息 - [PHP 会话](http://www.php.net/manual/en/ref.session.php)。基本上你所要做的就是打电话

```
session_start(); 
```

在您想要访问会话变量的每个 php 页面的顶部（在任何内容输出到浏览器之前）。然后，您可以使用设置/检索变量

```
// set
$_SESSION['varname'] = "something";
// retrieve
$somevar = $_SESSION['varname']; 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-22T01:40:59.507

这就是 GET 和 POST 'super' 全局变量的用途。 [http://www.tizag.com/phpT/postget.php](http://www.tizag.com/phpT/postget.php)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-22T01:46:28.217

生成表单的脚本不必是处理表单的脚本。只需让 FORM 标记指向正确的脚本。唯一需要注意的是，无论您将表单数据提交到哪个页面，都必须生成一些合适的输出（除非您执行 AJAX POST）。

如果您问的是两个页面执行是否可以处理相同的 POST 数据，那么这是一个完全不同的问题。在简单的层面上，您可以让第一个 include() 成为第二个，这样它就可以访问所有相同的数据。更高级的是重新创建原始 POST 并合成一个 POST。这可能需要一些 JavaScript 帮助。另一种方法是使用 PHP 的会话功能并将值放在一边，以便以后的脚本可以访问它。然而，这依赖于用户然后跟随正确的链接！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2016-10-27T03:02:11.100

用于`session`访问您的变量到第二/其他页面。 **例子：**

**索引.php**

```
<?php

session_start();
$_SESSION['yourData'] = 'yourData';
?> 
```

==================================================== ========================

**second_page.php**

```
<?php
  echo $_SESSION['yourData'];
?> 
```

你可以试试这个。访问**[此链接](http://www.w3schools.com/php/php_sessions.asp)**了解更多详情。**[或者PHP的官网。](http://php.net/manual/en/book.session.php)**

# vb.net - 两台不同计算机上的不同互操作引用不起作用

> ID：224181
> 
> 赞同：11
> 
> 时间：2008-10-22T01:41:52.670
> 
> 标签：vb.net, excel, dll, interop

当我在我的计算机上添加对**Microsoft.Office.Interop.Excel**的引用时，Visual Studio 会将其添加到项目文件中：

```
<COMReference Include="Excel">
  <Guid>{00020813-0000-0000-C000-000000000046}</Guid>
  <VersionMajor>1</VersionMajor>
  <VersionMinor>5</VersionMinor>
  <Lcid>0</Lcid>
  <WrapperTool>primary</WrapperTool>
  <Isolated>False</Isolated>
</COMReference> 
```

团队中的另一位开发人员遇到错误，需要将一个名为 Interop.Excel.dll 的 DLL 文件添加到项目中，该文件将上面的代码替换为项目文件中的以下代码：

```
<Reference Include="Interop.Excel, Version=1.5.0.0, Culture=neutral, processorArchitecture=MSIL">
  <SpecificVersion>False</SpecificVersion>
  <HintPath>My Project\Interop.Excel.dll</HintPath>
</Reference> 
```

这确实适用于我的电脑。

您能否解释一下这两种方法之间的区别，哪种方法最好，以及如何让第一种方法在其他计算机上工作？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-11-25T12:01:24.713

我也不认为你的方法有问题。

通常，当您添加对组件的引用时，VS 会自动为 COM 组件生成互操作程序集。但是，当您添加对其中一个 Office 组件（XP 或任何更高版本）的引用时，会添加对来自 Microsoft 的预生成（和优化）主互操作程序集的引用，就像在您的第一个示例中一样。线

```
<WrapperTool>primary</WrapperTool> 
```

表示使用了此 PIA。

如果您正确添加了 PIA 引用，则该引用的*CopyLocal*属性应设置为 false，*Path*属性应类似于

```
C:\WINDOWS\assembly\GAC\Microsoft.Office.Interop.Excel\12.0.0.0__71e9bce111e9429c\Microsoft.Office.Interop.Excel.dll 
```

[您将在这篇 MSDN文章](http://msdn.microsoft.com/en-us/library/aa679806.aspx)中找到有关互操作程序集的更多详细信息。

要使第一种方法起作用，必须在计算机上安装 Office 主互操作程序集 (PIA)。Microsoft 提供了一个可再发行版本：

*   [Office 2003 PIA](http://www.microsoft.com/downloads/details.aspx?FamilyId=3C9A983A-AC14-4125-8BA0-D36D67E0F4AD&displaylang=en)
*   [Office 2007 PIA](http://www.microsoft.com/downloads/details.aspx?familyid=59DAEBAA-BED4-4282-A28C-B864D8BFA513&displaylang=en)

AFAIK，这些 PIA 仅在已安装 .NET Framework 时由 Office 安装程序安装，这就是为什么 PIA 有一个单独的可再发行组件。

注意: 请确保您引用了您所针对的 Office 版本。但是，当针对多个版本的 Office 时，您可能会遇到一些问题。这种情况下的解决方案可能是后期绑定（如果性能不是问题）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-22T01:55:48.853

我使用 Excel 自动化的方式比我想承认的要多，而且我从未引用过 Interop.Excel.dll。我一直提到前者。他为什么要引用它，他会遇到什么错误？

你们是否引用了相同版本的 excel（5.0 与 11.0）？你们有完全相同版本的office、service pakcs 等等吗？这可能是差异。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-11-25T12:16:23.170

我找到了使用它的最干净的方法，这也允许多个版本的互操作，是创建一个共享 bin\Office Interop\11 或 12\Microsoft.Office.Interop.Excel.dll\ 并从项目中引用它们，适用于不同版本

# sql - 如何增量更新列值

> ID：224185
> 
> 赞同：2
> 
> 时间：2008-10-22T01:48:34.000
> 
> 标签：sql

我正在尝试使用个人理财应用程序，并且正在考虑在帐户中输入交易时更新运行余额的方法。

目前我使用的方式涉及检索比插入/修改的记录更新的所有记录，并逐个增加它们的运行余额。

例如，给定以下交易：

t1 日期 = 2008-10-21，金额 = 500，流动余额 = 1000

t2 日期 = 2008-10-22，金额 = 300，流动余额 = 1300

t3 日期 = 2008-10-23，金额 = 100，流动余额 = 1400 ...

现在假设我在 t1 和 t2 之间插入一个事务，然后 t2 和所有后续事务都需要调整它们的运行余额。

呵呵，既然我写了这个问题，我想我知道答案了......所以我会把它留在这里以防它帮助别人（或者也许有更好的方法？）

首先，我从上一个事务中获取运行余额，在本例中为 t1。然后我更新以下所有交易（包括新交易）：

```
UPDATE transactions
SET running_balance = running_balance + <AMOUNT>
WHERE date > <t1.date> 
```

我看到的唯一问题是，现在我不仅要存储日期，还要存储时间。但是，如果两个交易具有完全相同的日期/时间会发生什么？

PS：我更喜欢不涉及专有功能的解决方案，因为我同时使用 PostgreSQL 和 SQLite ......虽然只有 Postgre 的解决方案也会有帮助。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-22T01:55:03.160

那里的某种身份/自动增量列也是明智的，如果有的话，纯粹是为了交易顺序。

此外，除了交易日期之外，将交易插入数据库的日期（并不总是相同）也是明智/有用的。

这些事情只是帮助您在系统中安排事情，并使其更容易改变事情，即交易，在以后的时间。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-22T05:10:40.330

如果您有大量交易，那么您最好将运行余额按日期或什至按周/月存储在单独的表中。如果您要插入同一日期的行，则只需在一行中更改运行余额。查询和报告将更加棘手，因为使用此运行余额您需要在每次交易后达到余额，这更像是使用最后几天的运行余额并添加或减去交易价值。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-22T11:42:37.153

我认为这可能有效：

我同时使用日期和 id 来订购交易，但现在我要将日期和 id 都存储在一列中，并使用它来订购。所以，使用比较（如 >）应该总是按预期工作，对吧？（与我之前描述的情况相反，其中两列具有确切的日期时间（但不太可能）。

# sql-server - SQL：如何仅选择特定列上具有唯一值的行？

> ID：224200
> 
> 赞同：18
> 
> 时间：2008-10-22T01:55:07.403
> 
> 标签：sql-server

感谢大家的百万回复。不幸的是，似乎没有一个解决方案对我有用，我的猜测是我提供的示例搞砸了。

所以让我再试一次。

我的表如下所示：

```
 contract    project activity
row1    1000    8000    10
row2    1000    8000    20
row3    1000    8001    10
row4    2000    9000    49
row5    2000    9001    49
row6    3000    9000    79
row7    3000    9000    78 
```

基本上，我正在寻找的查询将为“合同，活动”返回“2000,49”，因为只有合同 #2000 有一个，并且只有一个，唯一的活动值。

再次，提前一百万，boroatel

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-10-22T01:59:30.187

**更新为使用您新提供的数据：**

使用原始数据的解决方案可以在这个答案的末尾找到。

使用您的新数据：

```
DECLARE  @T TABLE( [contract] INT, project INT, activity INT )
INSERT INTO @T VALUES( 1000,    8000,    10 )
INSERT INTO @T VALUES( 1000,    8000,    20 )
INSERT INTO @T VALUES( 1000,    8001,    10 )
INSERT INTO @T VALUES( 2000,    9000,    49 )
INSERT INTO @T VALUES( 2000,    9001,    49 )
INSERT INTO @T VALUES( 3000,    9000,    79 )
INSERT INTO @T VALUES( 3000,    9000,    78 )

SELECT DISTINCT [contract], activity FROM @T AS A WHERE
    (SELECT COUNT( DISTINCT activity ) 
     FROM @T AS B WHERE B.[contract] = A.[contract]) = 1 
```

返回：2000, 49

**使用原始数据的解决方案**

**警告：** 以下解决方案使用问题中先前给出的数据，可能对当前问题没有意义。我只是为了完整性而将它们连接起来。

```
SELECT Col1, Count( col1 ) AS count FROM table 
GROUP BY col1
HAVING count > 1 
```

这应该为您提供 col1 中所有不明确的值的列表。您可以将其放在表 var 或临时表中并加入它。

这是使用子查询的示例：

```
DECLARE @t TABLE( col1 VARCHAR(1), col2 VARCHAR(1), col3 VARCHAR(1) )

INSERT INTO @t VALUES( 'A', 'B', 'C' );
INSERT INTO @t VALUES( 'D', 'E', 'F' );
INSERT INTO @t VALUES( 'A', 'J', 'K' );
INSERT INTO @t VALUES( 'G', 'H', 'H' );

SELECT * FROM @t

SELECT col1, col2 FROM @t WHERE col1 NOT IN 
    (SELECT col1 FROM @t AS t GROUP BY col1 HAVING COUNT( col1 ) > 1) 
```

这将返回：

```
D   E
G   H 
```

还有另一种用户使用临时表并加入的方法：

```
DECLARE @t TABLE( col1 VARCHAR(1), col2 VARCHAR(1), col3 VARCHAR(1) )

INSERT INTO @t VALUES( 'A', 'B', 'C' );
INSERT INTO @t VALUES( 'D', 'E', 'F' );
INSERT INTO @t VALUES( 'A', 'J', 'K' );
INSERT INTO @t VALUES( 'G', 'H', 'H' );

SELECT * FROM @t

DROP TABLE #temp_table  
SELECT col1 INTO #temp_table
    FROM @t AS t GROUP BY col1 HAVING COUNT( col1 ) = 1

SELECT t.col1, t.col2 FROM @t AS t
    INNER JOIN #temp_table AS tt ON t.col1 = tt.col1 
```

还返回：

```
D   E
G   H 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-22T02:10:40.693

对于 MySQL：

```
SELECT contract, activity
FROM table
GROUP BY contract
HAVING COUNT(DISTINCT activity) = 1 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-30T19:50:59.390

我是NOT EXISTS的粉丝

```
SELECT DISTINCT contract, activity FROM table t1
WHERE NOT EXISTS (
  SELECT * FROM table t2
  WHERE t2.contract = t1.contract AND t2.activity != t1.activity
) 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-22T02:36:02.813

修改的！

```
SELECT distinct contract, activity from @t a
WHERE (SELECT COUNT(DISTINCT activity) FROM @t b WHERE b.contract = a.contract) = 1 
```

这是另一个——没有子查询的更短/更干净

```
select contract, max(activity) from @t
group by contract
having count(distinct activity) = 1 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-22T02:56:32.397

尝试这个：

```
select 
         contract,
        max (activity) 
from
         mytable 
group by
         contract 
having
         count (activity) = 1 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-22T05:59:49.140

利用 SQL Server 中的“动态表”功能（针对带括号的查询进行查询），您可以返回 2000, 49 w/以下。如果您的平台不提供等效于“动态表”的 ANSI 扩展，您始终可以通过将“动态表”中的结果插入临时表，然后执行临时表上的后续选择。

```
DECLARE  @T TABLE(
    [contract] INT,
    project INT,
    activity INT
)

INSERT INTO @T VALUES( 1000,    8000,    10 )
INSERT INTO @T VALUES( 1000,    8000,    20 )
INSERT INTO @T VALUES( 1000,    8001,    10 )
INSERT INTO @T VALUES( 2000,    9000,    49 )
INSERT INTO @T VALUES( 2000,    9001,    49 )
INSERT INTO @T VALUES( 3000,    9000,    79 )
INSERT INTO @T VALUES( 3000,    9000,    78 )

SELECT
    [contract],
    [Activity] =  max (activity)
FROM
    (
    SELECT
        [contract],
        [Activity]
    FROM
        @T
    GROUP BY
        [contract],
        [Activity]
    ) t
GROUP BY
    [contract]
HAVING count (*) = 1 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-22T03:50:47.153

```
SELECT DISTINCT Contract, Activity
FROM Contract WHERE Contract IN (
SELECT Contract 
FROM Contract
GROUP BY Contract
HAVING COUNT( DISTINCT Activity ) = 1 ) 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-22T03:06:28.680

假设您的数据表称为 ProjectInfo：

```
SELECT DISTINCT Contract, Activity
    FROM ProjectInfo
    WHERE Contract = (SELECT Contract
                          FROM (SELECT DISTINCT Contract, Activity
                                    FROM ProjectInfo) AS ContractActivities
                          GROUP BY Contract
                          HAVING COUNT(*) = 1); 
```

最里面的查询标识合同和活动。查询的下一级（中间一级）识别只有一个活动的合同。然后，最外面的查询从 ProjectInfo 表中提取具有单个活动的合同的合同和活动。

使用 IBM Informix Dynamic Server 11.50 进行测试 - 也应该在其他地方工作。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-10-22T03:20:03.893

这是使用 sql server count distinct 的另一个选项：

```
DECLARE  @T TABLE( [contract] INT, project INT, activity INT )
INSERT INTO @T VALUES( 1000,    8000,    10 )
INSERT INTO @T VALUES( 1000,    8000,    20 )
INSERT INTO @T VALUES( 1000,    8001,    10 )
INSERT INTO @T VALUES( 2000,    9000,    49 )
INSERT INTO @T VALUES( 2000,    9001,    49 )
INSERT INTO @T VALUES( 3000,    9000,    79 )
INSERT INTO @T VALUES( 3000,    9000,    78 )

SELECT DISTINCT [contract], activity FROM @T AS A WHERE
    (SELECT COUNT( DISTINCT activity ) 
     FROM @T AS B WHERE B.[contract] = A.[contract]) = 1 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-10-30T19:20:31.587

抱歉，您没有使用 PostgreSQL...

SELECT DISTINCT ON contract, activity * FROM thetable ORDER BY contract, activity

[http://www.postgresql.org/docs/8.3/static/sql-select.html#SQL-DISTINCT](http://www.postgresql.org/docs/8.3/static/sql-select.html#SQL-DISTINCT)

等一下。你只想要一个恰好是一个的值......

SELECT contract, activity, count( *) FROM thetable GROUP BY contract, activity HAVING count(* ) = 1

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-05-26T22:47:05.347

抱歉，我知道旧帖子，但我遇到了同样的问题，无法让上述任何内容为我工作，但我想通了。

这对我有用：

SELECT DISTINCT [column]As UniqueValues FROM [db].[dbo].[table]

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2012-11-16T11:38:30.790

SELECT DISTINCT Col1,Col2 从表 GROUP BY Col1 HAVING COUNT(DISTINCT Col1) = 1

# c++ - 为什么要使用无限循环？

> ID：224204
> 
> 赞同：10
> 
> 时间：2008-10-22T01:56:18.197
> 
> 标签：c++, coding-style

另一位发帖人询问[了无限循环的首选语法](https://stackoverflow.com/questions/224138/infinite-loops-top-or-bottom)。

一个后续问题：*为什么*在代码中使用无限循环？我通常会看到这样的构造：

```
for (;;) {
  int scoped_variable = getSomeValue();
  if (scoped_variable == some_value) {
    break;
  }
} 
```

`for`这使您可以避免在or`while`子句中无法看到 scoped_variable 的值。“无限”循环还有哪些其他用途？

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2008-10-22T02:02:31.663

像这样的循环：

```
while (true)
{
    // do something
    if (something else) break;
    // do more
} 
```

让你在中间跳出循环，而不是在开始（while/for）或结束（do-while）。

如果您有一个复杂的条件，您可能还想使用这种样式来使代码更清晰。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-10-22T01:58:19.237

我对嵌入式控制代码的主体使用了无限循环，因为它被设计为一旦启动就永远运行。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-10-22T02:03:24.563

```
while( 1 )
{
    game->update();
    game->render();
} 
```

**编辑：**也就是说，我的应用程序基本上是基于无限循环的，我不会费心去重构所有东西，只是为了拥有总是通过从 main() 的末尾脱落而终止的美学纯度。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2008-10-22T02:02:07.903

有限状态机。在您达到结束状态之前，它们不应该结束，此时您会中断或返回。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-10-22T02:08:08.657

这是一个不完整的例子，因为它可以被重构为一个终端测试循环，而不会损失清晰度、功能或性能。

```
int scoped_variable;
do {
    scoped_variable = getSomeValue();
} while (scoped_variable != some_value); 
```

在最简单的情况下，当循环实例在顶部或底部*没有*终止测试时，最常使用无限循环。当循环有两个部分时，往往会发生这种情况：每次都必须执行的代码，以及只能在每次迭代之间执行的代码。这往往发生在像 C 这样的语言中，在执行诸如从文件读取或处理数据库结果集等需要明确完成很多事情时。大多数具有较新范例的语言都可以将此类代码实际构建到测试中。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2010-05-27T03:38:30.380

我会考虑使用无限循环来对导弹的制导系统进行编程。

```
while ( true ) { go2Target ( ) ; } 
```

从导弹的制导计算机的角度来看，循环一旦开始就会重复直到时间结束。

也许纯粹主义者会喜欢

```
while ( ! blown2Bits ( ) ) { go2Target ( ) ; } 
```

但是你如何实现blow2Bits 方法呢？如果 blow2Bits 返回 true 意味着什么？

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-10-22T08:50:04.710

几乎所有应用程序都使用*无限* **主循环**。;)

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-10-22T02:03:21.817

一个示例是在消息泵类型场景中，您希望永远循环处理任何进入的消息，直到被告知停止。另一种情况是，如果您想执行周期性操作，那么您可能会编写一个无限循环，其中包含睡眠（尽管为此使用某种形式的计时器可能会更好）。

可能在其他一些地方，循环必须执行一定量的工作来确定它是否应该退出，并且`break`在这个条件为真时使用它可能更干净，而不是设置一些外部标志来指示循环应该退出。

一般来说，尽管我认为如果可能的话，最好将退出条件放在循环语句中，而不是使其无限并使用`break`语句退出循环，因为循环的退出条件更明显。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-10-22T02:16:53.600

还有其他与是否/何时可以`break`在循环中使用有关的问题。让我们假设我们同意有时是可以的。在那种情况下（希望很少见），如果有许多终止条件并且没有可识别的“主要”终止条件，我会使用无限循环。

它避免了一长串的析取（or's），并且还提请读者注意循环中可能（几乎肯定会）有中断的事实。

归根结底，这是一个品味问题。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-10-22T02:47:26.860

我使用它们编写循环的 Linux 守护程序/服务，直到收到终止/其他终止信号。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-10-22T08:43:47.267

无限循环主要用于守护进程/服务进程或游戏中的主循环。你甚至可以和他们变得可爱，例如：

```
const bool heatDeathOfTheUniverse = false;
do 
{
     // stuff
} while(!heatDeathOfTheUniverse); 
```

[正如Fry](https://stackoverflow.com/questions/224204/why-use-infinite-loops#224217)所建议的那样，它们**不**应该被用来“等待”诸如线程之类的东西。为此，您可以使用线程对象的 Join 方法。

但是，如果您的技术主管说“无限循环是禁止的，多个方法/函数返回和中断也是如此”，您也可以执行以下操作：

```
bool done = false;
while(!done) 
{
    if(done = AreWeDone()) continue; // continue jumps back to start of the loop   
} 
```

当然，如果您的技术主管强迫您做这些事情，您应该开始寻找新工作。

有关 continue 关键字的更多详细信息，请参阅[此 MSDN](http://msdn.microsoft.com/en-us/library/6e3dc2z3(VS.80).aspx)文章。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-07-26T09:34:22.677

网络服务器使用无限的 while 循环：

```
while(true)
{
    //Do something like respond to requests
} 
```

除非您关闭网络服务器应用程序，否则它们不必结束。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-10-22T02:03:12.190

我以前在 C# 中等待多个线程完成时使用它们，但现在我使用 ThreadPool 类。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-10-22T02:15:00.780

除了嵌入式系统情况，无限循环总是真的是：

```
Repeat
   Something
Until Exit_Condition; 
```

但有时 Exit_Condition 并不是可以在循环结束时实际评估的东西。您始终可以设置一个标志，使用该标志跳过循环的其余部分，然后在最后对其进行测试，但这意味着您至少要对其进行两次测试（代码稍慢），而且我个人觉得它不太清楚。

有时候，用清晰度换取速度是有道理的，但一些既没有清晰度也没有速度的东西只是为了在技术上是正确的？对我来说听起来是个坏主意。任何称职的程序员都知道，while (true) 意味着终止条件位于循环内部的某个位置。

# c++ - 创建没有窗口的应用程序

> ID：224225
> 
> 赞同：28
> 
> 时间：2008-10-22T02:05:26.040
> 
> 标签：c++, c, winapi

您将如何编写一个无需打开窗口或控制台即可运行的 C/C++ 应用程序？

* * *

## 回答 #1

> 赞同：42
> 
> 时间：2008-10-22T03:21:39.960

当您编写 WinMain 程序时，您会自动将 /SUBSYSTEM 选项设置为编译器中的窗口。（假设您使用 Visual Studio）。对于任何其他编译器，可能存在类似的选项，但标志名称可能不同。

这会导致编译器以可执行文件格式（[PE 格式](http://webster.cs.ucr.edu/Page_TechDocs/pe.txt)）创建一个条目，将可执行文件标记为 Windows 可执行文件。

一旦此信息出现在可执行文件中，启动程序的系统加载程序会将您的二进制文件视为 Windows 可执行文件而不是控制台程序，因此它不会导致控制台窗口在运行时自动打开。

但是如果不需要，Windows 程序不需要创建任何窗口，就像您看到在任务栏中运行的所有那些程序和服务一样，但看不到它们的任何相应窗口。如果您创建一个窗口但选择不显示它，也会发生这种情况。

为了实现这一切，你需要做的就是，

```
#include <Windows.h>

int WinMain(HINSTANCE hInstance,
            HINSTANCE hPrevInstance, 
            LPTSTR    lpCmdLine, 
            int       cmdShow)
    {
    /* do your stuff here. If you return from this function the program ends */
    } 
```

您需要 WinMain 本身的原因是，一旦您将子系统标记为 Windows，链接器假定您的入口点函数（在程序加载和 C Run TIme 库初始化后调用）将是 WinMain 而不是 main。如果您没有在此类程序中提供 WinMain，您将在链接过程中收到未解决的符号错误。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2008-10-22T02:07:43.913

**在窗口中：**

```
#include <windows.h>

int APIENTRY WinMain(HINSTANCE hInstance,
                     HINSTANCE hPrevInstance,
                     LPTSTR    lpCmdLine,
                     int       nCmdShow)
{
    // <-- Program logic here
    return 0;
} 
```

请务必使用 Adam Mitz 提到的 /SUBSYSTEM 链接器开关。

**在其他平台上：**

```
int main(int argc, char**argv)
{
  // <-- Program logic here
  return 0;
} 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-22T06:39:58.187

如果您需要在没有控制台或窗口的情况下连续运行您的程序，您可能会[在 *NIX](http://www.netzmafia.de/skripten/unix/linux-daemon-howto.html)或Windows 上的[服务上](http://www.codeproject.com/KB/cs/hoytsoft_servicebase.aspx)找到有用的守护程序，如果您需要普通的 win32，则此 .NET 示例只需用谷歌搜索一下即可。
由于您的问题标记为 win32，因此我认为服务与您更相关。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2019-02-22T18:18:09.227

这也处理消息：

```
#include <windows.h>
#include <stdio.h>

int CALLBACK WinMain (HINSTANCE hInstance, HINSTANCE hPrevInstance, LPSTR lpCmdLine, int nCmdShow) {
    MSG msg;
    DWORD curThreadId;

    curThreadId = GetCurrentThreadId();

    // Send messages to self:
    PostThreadMessage(curThreadId, WM_USER, 1, 2);
    PostThreadMessage(curThreadId, WM_USER+1, 3, 4);
    PostThreadMessage(curThreadId, WM_USER+2, 5, 6);
    PostThreadMessage(curThreadId, WM_USER+3, 7, 8);
    PostThreadMessage(curThreadId, WM_QUIT, 9, 10);

    while (GetMessage(&msg, NULL, 0, 0)) {
        printf("message: %d; wParam: %d; lParam: %d\n", msg.message, msg.wParam, msg.lParam);
    }

    return (int) msg.wParam;
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2013-01-20T01:12:15.157

在 Visual Studio Express 2010 中，将子系统设置为 windows（如 user17224 所建议）后，或者将 main 更改为 WinMain（如 user17224 和 Brian R. Bondy 所建议），可以在属性、链接器、高级，入口点：只需在文本框中键入 main。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-22T15:39:18.970

使用 Visual Studio 向导创建 Win32 应用程序。但是不要创建窗口，即删除窗口创建功能。或者，我们可以创建 Win Service 应用程序。

* * *

## 回答 #7

> 赞同：-9
> 
> 时间：2008-10-22T04:01:21.143

如果您使用的是**MSVC**或**Visual Studio**，只需使用新的**Project Wizard**并选择**Console Application**。

# c# - .NET 反射的“成本”是多少？

> ID：224232
> 
> 赞同：79
> 
> 时间：2008-10-22T02:10:51.363
> 
> 标签：c#, .net, optimization, reflection

> **可能重复：**
> [.NET 反射的成本是多少？](https://stackoverflow.com/questions/25458/how-costly-is-net-reflection)

我目前的编程心态是反射是我最好的朋友。我经常使用它来动态加载允许“松散实现”而不是严格接口的内容，以及许多自定义属性。

使用反射的“实际”成本是多少？

频繁反射的类型是否值得努力缓存反射，例如我们自己的 pre-LINQ DAL 对象代码对表定义的所有属性？

缓存内存占用量会超过反射 CPU 使用率吗？

* * *

## 回答 #1

> 赞同：58
> 
> 时间：2008-10-22T02:17:50.820

反射需要加载大量类型元数据然后进行处理。这可能会导致更大的内存开销和更慢的执行速度。根据[这篇文章](http://www.west-wind.com/WebLog/posts/351.aspx)，属性修改大约慢 2.5x-3x，方法调用慢 3.5x-4x。

这是一篇出色的[MSDN 文章](http://web.archive.org/web/20150118044646/http://msdn.microsoft.com/en-us/magazine/cc163759.aspx)，概述了如何使反射更快以及开销在哪里。如果您想了解更多信息，我强烈建议您阅读。

还有一个复杂的元素，反射可以添加到代码中，使其更加混乱，因此难以使用。有些人，比如[Scott Hanselman](http://www.hanselman.com/blog/CategoryView.aspx?category=Back+to+Basics&page=2)相信，通过使用反射，你经常会遇到比你解决的问题更多的问题。如果您的团队主要是初级开发人员，情况尤其如此。

如果您需要很多动态行为，您最好查看 DLR（动态语言运行时）。随着 .NET 4.0 中的新变化，您可能想看看是否可以将其中的一些合并到您的解决方案中。VB 和 C# 对动态的添加支持使得使用动态代码非常优雅，并且可以相当直接地创建自己的动态对象。

祝你好运。

编辑：我在 Scott 的网站上做了更多的探索，并在反思中发现了这个[播客。](http://www.hanselman.com/blog/HanselminutesPodcast27Reflection.aspx)我还没有听过，但它可能是值得的。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2008-10-22T06:01:58.357

你可以做很多事情来加速反思。例如，如果您正在进行大量的属性访问，那么[HyperDescriptor](http://www.codeproject.com/KB/cs/HyperPropertyDescriptor.aspx)可能会很有用。

如果您正在执行大量方法调用，那么您可以将方法缓存到类型化的委托中`Delegate.CreateDelegate`- 然后只进行一次类型检查等（在 期间`CreateDelegate`）。

如果您正在做大量的对象构造，那么`Delegate.CreateDelegate`将无济于事（您不能在构造函数上使用它）-但是（在 3.5 中）`Expression`可以用来执行此操作，再次编译为类型化委托。

所以是的：反射很慢，但你可以优化它而不会太痛苦。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-22T02:18:58.650

拥有权利的同时也被赋予了重大的责任。

正如您所说，反射具有与之相关的成本，并且取决于您进行多少反射，它可能会显着减慢应用程序的速度。

使用它的非常合适的地方之一是 IoC（控制反转），因为根据您的应用程序的大小，可能会比没有更多的好处。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-22T02:30:58.143

感谢伟大的链接和伟大的评论，特别是在 Jr Devs 的部分，这在金钱上是正确的。

对我们来说，初级开发人员更容易做到这一点：

```
[TableName("Table")]
public class SomeDal : BaseDal
{
    [FieldName("Field")]
    public string Field
} 
```

而不是 DAL 的一些更大的实施。这加快了他们构建 DAL 对象的速度，同时隐藏了所有内部工作，供高级开发人员使用。

可惜 LINQ 没有早点出来，我觉得有时我们写了一半。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-24T15:58:05.113

使用反射时有时会咬你的一件事是在进行重构时不使用反射更新调用。当您更改方法名称时，像 resharper 之类的工具会提示您更新注释和字符串，因此您可以通过这种方式捕获大部分内容，但是当您调用已动态生成的方法或方法名称已动态生成时，您可能错过一些东西。

唯一的解决方案是良好的文档和彻底的单元测试。

# c++ - 有没有办法检查 istream 是否以二进制模式打开？

> ID：224234
> 
> 赞同：22
> 
> 时间：2008-10-22T02:11:46.510
> 
> 标签：c++, standard-library, iostream

我正在使用一个 istream，它可以是 stringstream、ifstream 或用户定义的流类型，我需要知道在 ifstream 的情况下它是否没有以二进制模式打开（所以我可以抛出异常）。我尝试了以下方法：

```
if ((_is.flags() & ios::binary) == 0)
    throw exception(...) 
```

但从来没有抛出异常。在这种情况下测试失败，因为 _is.flags() 返回 0x201 而 ios::binary 是 0x20。有没有办法找出流是否以文本模式打开？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-10-22T02:23:22.743

flags() 返回[ios_base::fmtflags](http://www.cplusplus.com/reference/iostream/ios_base/fmtflags.html)格式化标志，而 binary 是[ios_base::openmode](http://www.cplusplus.com/reference/iostream/ios_base/openmode.html)标志。我不确定一旦流已经打开，是否有办法找出这些。我在想也许 streambuf 类的虚拟成员可以提供帮助，但似乎并没有。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-22T02:22:31.623

不，没有办法对此进行测试。

# localization - 构建将本地化的网站

> ID：224235
> 
> 赞同：0
> 
> 时间：2008-10-22T02:11:47.353
> 
> 标签：localization

在设计需要以 20 多种语言本地化的网站时，是否有人有一些指南或文章链接？

最初的翻译不是问题，而是持续的维护（即，当在英文网站上进行更新时，人们如何通知需要新的翻译）。

提前致谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-22T15:39:06.460

以下是一些致力于国际化和全球化的网站：

[http://www.i18nguy.com/](http://www.i18nguy.com/) [http://multilingual.com/guides.php](http://multilingual.com/guides.php)（他们大力推动供应商，但他们的指南往往值得一读）

在 i18n（国际化）和 l10n 上的 Google 搜索通常也很有用。

不过，您询问了有关设计网站的问题，因此我假设您正在谈论编码最佳实践。一般来说，您希望尽可能多地重用。这意味着：

1.  将所有文本分离到资源文件中（.Net 天真地处理这个问题，在 PHP 中您可以使用模板来插入文本，您的语言可能会有所不同）

2.  （真的 1-a）不要在图像中放置文字。这只会在以后引起头痛，因为图像将不再可重用。每当文本更改时，您都必须更新图像，这通常是不值得的。

3.  流体/液体布局是优选的。德语文本可以比英语大 30%，亚洲语言可以比英语小得多，等等。

4.  为网页使用标准字符集（即 utf-8）。这将最大限度地减少语言之间的渲染问题。

这是很容易的部分。困难的部分是管理它。根据您的源代码控制系统，您可能会编写或获取一个工具来提醒相关方。

内容管理系统旨在帮助您自动管理更改。然而，好的 CMS 通常是昂贵的。上述网站可以为您指出您可能会寻找的功能，以帮助您管理您的网站。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-22T02:27:02.440

许多 SCM 支持可以在提交更改时触发的触发器，并且可以在例如 .pot 文件被更改时采取行动，以向适当的各方发送电子邮件。

# c# - 在 C# 中将换行符添加到字符串中

> ID：224236
> 
> 赞同：259
> 
> 时间：2008-10-22T02:14:56.723
> 
> 标签：c#, string

我有一个字符串。

```
string strToProcess = "fkdfdsfdflkdkfk@dfsdfjk72388389@kdkfkdfkkl@jkdjkfjd@jjjk@"; 
```

我需要在字符串中每次出现“@”符号后添加一个换行符。

我的输出应该是这样的

```
fkdfdsfdflkdkfk@
dfsdfjk72388389@
kdkfkdfkkl@
jkdjkfjd@
jjjk@ 
```

* * *

## 回答 #1

> 赞同：544
> 
> 时间：2008-10-22T02:17:49.713

`Environment.NewLine`在任何字符串中随时使用。一个例子：

```
string text = "fkdfdsfdflkdkfk@dfsdfjk72388389@kdkfkdfkkl@jkdjkfjd@jjjk@";

text = text.Replace("@", "@" + System.Environment.NewLine); 
```

* * *

## 回答 #2

> 赞同：75
> 
> 时间：2008-10-22T02:18:44.313

您可以在 @ 符号后添加一个换行符，如下所示：

```
string newString = oldString.Replace("@", "@\n"); 
```

您也可以`NewLine`在 Class 中使用该属性`Environment`（我认为它是 Environment）。

* * *

## 回答 #3

> 赞同：21
> 
> 时间：2008-10-22T02:23:41.730

以前的答案很接近，但为了满足`@`符号保持接近的实际要求，您希望它是`str.Replace("@", "@" + System.Environment.NewLine)`. 这将保留`@`符号并为当前平台添加适当的换行符。

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2008-10-22T03:42:16.530

然后只需将之前的答案修改为：

```
Console.Write(strToProcess.Replace("@", "@" + Environment.NewLine)); 
```

如果您不想要文本文件中的换行符，请不要保留它。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2008-10-22T02:19:03.860

一个简单的字符串替换就可以完成这项工作。看看下面的示例程序：

```
using System;

namespace NewLineThingy
{
    class Program
    {
        static void Main(string[] args)
        {
            string str = "fkdfdsfdflkdkfk@dfsdfjk72388389@kdkfkdfkkl@jkdjkfjd@jjjk@";
            str = str.Replace("@", "@" + Environment.NewLine);
            Console.WriteLine(str);
            Console.ReadKey();
        }
    }
} 
```

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2008-10-22T12:43:00.123

正如其他人所说，换行符会在 Windows 的文本文件中为您提供一个新行。尝试以下操作：

```
using System;
using System.IO;

static class Program
{
    static void Main()
    {
        WriteToFile
        (
        @"C:\test.txt",
        "fkdfdsfdflkdkfk@dfsdfjk72388389@kdkfkdfkkl@jkdjkfjd@jjjk@",
        "@"
        );

        /*
        output in test.txt in windows =
        fkdfdsfdflkdkfk@
        dfsdfjk72388389@
        kdkfkdfkkl@
        jkdjkfjd@
        jjjk@ 
        */
    }

    public static void WriteToFile(string filename, string text, string newLineDelim)
    {
        bool equal = Environment.NewLine == "\r\n";

        //Environment.NewLine == \r\n = True
        Console.WriteLine("Environment.NewLine == \\r\\n = {0}", equal);

        //replace newLineDelim with newLineDelim + a new line
        //trim to get rid of any new lines chars at the end of the file
        string filetext = text.Replace(newLineDelim, newLineDelim + Environment.NewLine).Trim();

        using (StreamWriter sw = new StreamWriter(File.OpenWrite(filename)))
        {
            sw.Write(filetext);
        }
    }
} 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2018-03-07T12:29:53.310

```
string strToProcess = "fkdfdsfdflkdkfk@dfsdfjk72388389@kdkfkdfkkl@jkdjkfjd@jjjk@";
var result = strToProcess.Replace("@", "@ \r\n");
Console.WriteLine(result); 
```

[输出](https://i.stack.imgur.com/TAIFU.png)

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-10-22T12:09:16.743

根据您对其他所有人的回复，您正在寻找类似这样的内容。

```
string file = @"C:\file.txt";
string strToProcess = "fkdfdsfdflkdkfk@dfsdfjk72388389@kdkfkdfkkl@jkdjkfjd@jjjk@";
string[] lines = strToProcess.Split(new char[] { '@' }, StringSplitOptions.RemoveEmptyEntries);

using (StreamWriter writer = new StreamWriter(file))
{
    foreach (string line in lines)
    {
        writer.WriteLine(line + "@");
    }
} 
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2010-11-25T12:01:02.050

```
string str = "fkdfdsfdflkdkfk@dfsdfjk72388389@kdkfkdfkkl@jkdjkfjd@jjjk@";
str = str.Replace("@", Environment.NewLine);
richTextBox1.Text = str; 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2021-08-27T07:26:41.580

如下所述更改您的字符串。

```
string strToProcess = "fkdfdsfdflkdkfk"+ System.Environment.NewLine +" dfsdfjk72388389"+ System.Environment.NewLine +"kdkfkdfkkl"+ System.Environment.NewLine +"jkdjkfjd"+ System.Environment.NewLine +"jjjk"+ System.Environment.NewLine; 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2015-12-25T22:30:07.197

你也可以使用`string[] something = text.Split('@')`. 确保使用单引号将“@”括起来以将其存储为`char`类型。这会将字符存储到并包括每个“@”作为数组中的单个单词。然后，您可以`element + System.Environment.NewLine`使用 for 循环输出每个 ()，或使用 .将其写入文本文件`System.IO.File.WriteAllLines([file path + name and extension], [array name])`。如果指定的文件在该位置不存在，它将被自动创建。

* * *

## 回答 #12

> 赞同：-2
> 
> 时间：2017-12-07T10:52:24.547

```
protected void Button1_Click(object sender, EventArgs e)
{
    string str = "fkdfdsfdflkdkfk@dfsdfjk72388389@kdkfkdfkkl@jkdjkfjd@jjjk@";
    str = str.Replace("@", "@" + "<br/>");
    Response.Write(str);       
} 
```

* * *

## 回答 #13

> 赞同：-2
> 
> 时间：2018-01-04T10:06:20.050

```
using System;
using System.IO;
using System.Text;

class Test
{
    public static void Main()
    {
             string strToProcess = "fkdfdsfdflkdkfk@dfsdfjk72388389@kdkfkdfkkl@jkdjkfjd@jjjk@";
            strToProcess.Replace("@", Environment.NewLine);
            Console.WriteLine(strToProcess);
    }
} 
```

# c# - 在 C# 中将 short[] 数组写入文件的最佳方法是什么？

> ID：224239
> 
> 赞同：6
> 
> 时间：2008-10-22T02:15:40.107
> 
> 标签：c#, .net, filestream

我有一个短裤数组（short []），我需要写出一个文件。最快的方法是什么？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-10-22T02:19:20.850

使用 BinaryWriter

```
 static void WriteShorts(short[] values, string path)
    {
        using (FileStream fs = new FileStream(path, FileMode.OpenOrCreate, FileAccess.Write))
        {
            using (BinaryWriter bw = new BinaryWriter(fs))
            {
                foreach (short value in values)
                {
                    bw.Write(value);
                }
            }
        }
    } 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-22T02:28:01.347

跟进 Jon B 的回答，如果您的文件包含任何其他数据，您可能希望在数据前面加上值的计数。

IE：

```
static void WriteShorts(short[] values, string path)
{
    using (FileStream fs = new FileStream(path, FileMode.OpenOrCreate, FileAccess.Write))
    {
        using (BinaryWriter bw = new BinaryWriter(fs))
        {
            // Write the number of items
            bw.Write(values.Length);

            foreach (short value in values)
            {
                bw.Write(value);
            }
        }
    }
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2017-03-20T15:11:41.087

**BinaryFormatter**实际上在与原始类型数组 (obj.GetType().IsPrimitive) 一起使用时的读取和写入**速度快了大约 10 倍**，即不适用于 Decimal 和 String（它们不是原始类型），当然也不适用于任何其他结构或相反，它的速度非常慢。

```
[Test]
public void TestShortArray()
{
  var n = 100000000;
  var input = new short[n];
  var r = new Random();
  for (var i = 0; i < n; i++) input[i] = (short)r.Next();
  var bf = new BinaryFormatter();
  var sw = new Stopwatch();
  using (var ms = new MemoryStream())
  {
    sw.Start();
    bf.Serialize(ms, input);
    sw.Stop();
    Console.WriteLine("BinaryFormatter serialize: " +
      sw.ElapsedMilliseconds + " ms, " + ms.ToArray().Length + " bytes");
    sw.Reset();
    ms.Seek(0, SeekOrigin.Begin);
    sw.Start();
    var output = (short[])bf.Deserialize(ms);
    sw.Stop();
    Console.WriteLine("BinaryFormatter deserialize: " +
      sw.ElapsedMilliseconds + " ms, " + ms.ToArray().Length + " bytes");
    Assert.AreEqual(input, output);
  }
  sw.Reset();
  using (var ms = new MemoryStream())
  {
    var bw = new BinaryWriter(ms, Encoding.UTF8, true);
    sw.Start();
    bw.Write(input.Length);
    for (var i = 0; i < input.Length; i++) bw.Write(input[i]);
    sw.Stop();
    Console.WriteLine("BinaryWriter serialize: " +
      sw.ElapsedMilliseconds + " ms, " + ms.ToArray().Length + " bytes");
    sw.Reset();
    ms.Seek(0, SeekOrigin.Begin);
    var br = new BinaryReader(ms, Encoding.UTF8, true);
    sw.Start();
    var length = br.ReadInt32();
    var output = new short[length];
    for (var i = 0; i < length; i++) output[i] = br.ReadInt16();
    sw.Stop();
    Console.WriteLine("BinaryReader deserialize: " +
      sw.ElapsedMilliseconds + " ms, " + ms.ToArray().Length + " bytes");
    Assert.AreEqual(input, output);
  }
} 
```

输出：

```
BinaryFormatter serialize: 175 ms, 200000028 bytes
BinaryFormatter deserialize: 79 ms, 200000028 bytes
BinaryWriter serialize: 1499 ms, 200000004 bytes
BinaryReader deserialize: 1599 ms, 200000004 bytes 
```

因此，只要您有原始类型的数组或数组数组但没有多维数组（！），请使用 BinaryFormatter。如果您的数据类型是例如 Point3(double) 您应该填写一个 double[] 并将其序列化。仅将 BinaryWriter 用于复杂/混合类型、字符串、小数和奇异值。

在处理 byte[] 时，BinaryFormatter 和 BinaryWriter 的性能相同（而且速度非常快）。如果您能以有效的方式将您的类型转换为字节数组，您可能会通过这种方式获得更快的性能。

# iphone - iPod touch 和 iPod touch 第 2 代有什么区别？

> ID：224240
> 
> 赞同：1
> 
> 时间：2008-10-22T02:16:18.047
> 
> 标签：iphone, ipod-touch

向应用商店提交应用程序时，iPod Touch 和 iPod Touch 第二代之间的真正区别是什么？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-12-16T10:13:02.307

以下：

*   稍微薄一点
*   对 Nike+ 的内置支持
*   音量条
*   外接扬声器
*   更快的处理器（533MHz vs 400MHz）
*   支持带有麦克风和音量控制的新耳机（允许您使用 VOIP 应用程序）

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-10-22T02:27:26.183

此外，2G iPod touch 具有麦克风输入功能、内置扬声器以及外部音量按钮。

此外，设备的物理背面是弯曲的，使其更易于握持。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-22T02:23:38.623

第一代 iPod touch 不附带运行 App Store 应用程序所需的 iPhone OS 2.0。最终用户可以为他们的第一代 iPod touch 从 Apple 购买 iPhone OS 2.0。

从 SDK 的角度来看，我不确定发生了什么变化（如果有的话）。

# c# - 使用 XDocument 更改 XML 的顺序

> ID：224253
> 
> 赞同：8
> 
> 时间：2008-10-22T02:19:31.533
> 
> 标签：c#, .net, linq, linq-to-xml

我想使用 XDocument 更改 XML 的顺序

```
<root>
  <one>1</one>
  <two>2</two>
</root> 
```

我想更改顺序，以便 2 出现在 1 之前。这个功能是内置的还是我必须自己做。例如，删除然后 AddBeforeSelf()？

谢谢

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-06T10:40:57.453

与上面类似，但将其包装在扩展方法中。在我的情况下，这对我来说很好，因为我只想确保在用户保存 xml 之前在我的文档中应用某个元素顺序。

```
public static class XElementExtensions
{
    public static void OrderElements(this XElement parent, params string[] orderedLocalNames)
    {            
        List<string> order = new List<string>(orderedLocalNames);            
        var orderedNodes = parent.Elements().OrderBy(e => order.IndexOf(e.Name.LocalName) >= 0? order.IndexOf(e.Name.LocalName): Int32.MaxValue);
        parent.ReplaceNodes(orderedNodes);
    }
}
// using the extension method before persisting xml
this.Root.Element("parentNode").OrderElements("one", "two", "three", "four"); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-10-15T10:33:25.093

试试这个解决方案...

```
XElement node = ...get the element...

//Move up
if (node.PreviousNode != null) {
    node.PreviousNode.AddBeforeSelf(node);
    node.Remove();
}

//Move down
if (node.NextNode != null) {
    node.NextNode.AddAfterSelf(node);
    node.Remove();
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-22T02:39:01.963

这应该可以解决问题。它根据内容对根的子节点进行排序，然后更改它们在文档中的顺序。这可能不是最有效的方法，但根据您希望使用 LINQ 看到的标签来判断。

```
static void Main(string[] args)
{
    XDocument doc = new XDocument(
        new XElement("root",
            new XElement("one", 1),
            new XElement("two", 2)
            ));

    var results = from XElement el in doc.Element("root").Descendants()
                  orderby el.Value descending
                  select el;

    foreach (var item in results)
        Console.WriteLine(item);

    doc.Root.ReplaceAll( results.ToArray());

    Console.WriteLine(doc);

    Console.ReadKey();
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-24T18:07:55.850

除了编写 C# 代码来实现这一点之外，您还可以使用 XSLT 来转换 XML。

# iphone - 我可以在 UITableView 上使用 -selectRowAtIndexPath: （或其他任何东西）来触发委托的 -didSelectRowAtIndexPath: 方法吗？

> ID：224254
> 
> 赞同：0
> 
> 时间：2008-10-22T02:20:24.280
> 
> 标签：iphone, cocoa-touch, uitableview

我有一个 UITableView 设置为导航控制器类型交易（如 Xcode 中的默认值）。我添加了一个“添加”按钮，用于向 UITableView 添加一个元素。当我调用`-selectRowAtIndexPath:`刚刚添加的新行时，它会突出显示该行，但下一个视图不会推送到堆栈上。我认为这是因为`-selectRowAtIndexPath:`不会触发`-didSelectRowAtIndexPath:`. 有没有办法以编程方式将下一个视图推送到堆栈上？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-10-22T07:23:57.567

```
[self.navigationController pushViewController:YourViewController animated:YES] 
```

# .net - 为什么 System.Security.Cryptography 中有多个不同的哈希算法提供程序？

> ID：224272
> 
> 赞同：8
> 
> 时间：2008-10-22T02:27:22.940
> 
> 标签：.net, cryptography, hash

正如[MSDN](http://msdn.microsoft.com/en-us/library/system.security.cryptography.aspx)所记录的，对于许多不同的散列算法（例如 MD5、SHA、RIPE），有几个提供者。对于每种算法，任何可用的实现似乎都属于 3 类之一：

*   [算法] **Cng**
*   [算法] **CryptoServiceProvider**
*   [算法]**托管**

为什么这些散列算法有多种实现？

实现之间有什么区别？

选择在应用程序中使用哪种实现时有哪些实际区别？

参考：

[http://msdn.microsoft.com/en-us/library/system.security.cryptography.aspx](http://msdn.microsoft.com/en-us/library/system.security.cryptography.aspx)

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-10-22T02:36:15.150

*   `[Algo]Managed`是算法的纯 IL 实现。
*   `[Algo]CryptoServiceProvider`委托给 CAPI，它允许您使用诸如硬件加密设备之类的东西。
*   `[Algo]Cng`使用 Cryptography API: Next Generation (CNG)，旨在替代 CAPI，但仅在 Vista 和 Server 2008 中受支持。

# asp.net - jQuery datepicker - 从服务器端限制日期 (ASP.NET)

> ID：224283
> 
> 赞同：2
> 
> 时间：2008-10-22T02:31:23.587
> 
> 标签：asp.net, jquery, datetime

我有一个 jQuery 日期选择器，我想限制非工作日 - 周末、公共假期等。我已经看到了如何从客户端（javascript）执行此操作的示例，但是有没有办法限制来自服务器端 ASP 的日期.NET 代码？

我认为您可以使用 Page.RegisterClientScriptBlock，但想知道有没有更简洁的方法？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-18T00:28:43.820

JQuery 的东西都是客户端，所以没有服务器端可言。我的建议是创建一些瘦服务器端包装器，它们会自动执行相当于编写 RegisterClientScriptBlock 的操作。这样，您只需要摆弄 Javascript 一次，它就可以正常工作。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-22T06:31:13.040

您只需在验证发布的数据时执行此操作，使用与客户端相同的逻辑。您应该始终在服务器端验证数据，即使您在那里有“验证代码”并且认为您需要启用 javascript 才能使其工作，客户端的任何内容都不能被信任。

在客户端进行验证应该是次要的，只是为了提供良好的用户体验。任何客户端代码都没有安全性。（如果您不相信我，请安装 firebug 和/或 firefox 的“篡改数据”扩展）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-10T16:29:28.010

只有两种方法可以限制日期：

*   使用 Javascript 的客户端
    这可以通过在服务器端生成或不生成 javascript 来完成，但您最终将始终使用 javascript

*   服务器端
    您必须比较 web 控件中的日期或使用您最喜爱的.net 语言（c# 或 vb.net）输入

为了获得更好的 UX 体验，您应该在客户端进行限制，但如果您想确保数据有效，则**必须**在服务器端进行检查。

# php - 如何获取重复值的计数并加入表以检索每个值的名称？

> ID：224295
> 
> 赞同：2
> 
> 时间：2008-10-22T02:36:59.533
> 
> 标签：php, mysql

我有两张桌子，一张是志愿者，一张是场地。**志愿者每人被分配一个场地**。

场地表 (venues.id) 的 id 放置在志愿者表中的场地_id 列 (volunteers.venue_id) 中。

我知道我可以通过

```
SELECT venue_id, COUNT(*) FROM volunteers GROUP BY venue_id 
```

我为什么要这样做：这样用户就可以进去查看每个场地分配了多少志愿者。

表：志愿者 -- 列：id、name、venue_id

表：场地 -- 列：id、场地名称

志愿者.venue_id = 场地.id

我知道这将是某种形式的 join 声明，因此它将获得每个场地的计数，然后将志愿者.venue_id 与场地.id 匹配并打印出场地.venue_name 以及计数。

我将如何加入这两个表以打印出场地名称并在其旁边列出每个具有该场地 ID 的志愿者的数量？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-22T02:47:30.293

这将为您提供所有场地，没有志愿者出现的场地的志愿者人数为 0

```
select venues.venue_name, count(*) as volunteer_count
from venues
left outer join volunteers
   on venues.id = volunteers.venue_id
group by venues.venue_name 
```

[编辑] 我刚刚意识到您要求使用 MySQL。我不记得 MySQL 是使用 LEFT JOIN 还是 LEFT OUTER JOIN。上面的语法对于 SQLSERVER 是正确的。关键点是外连接而不是内连接，以获得没有志愿者的场地。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-22T02:41:45.360

```
SELECT venues.venue_name, COUNT(volunteers.*) AS cvolun
  FROM venues
  INNER JOIN volunteers
    ON venues.id = volunteers.venue_id 
```

# ruby-on-rails - 在 Ruby on Rails 中，如何使多态模型与命名空间模型相关联？

> ID：224297
> 
> 赞同：4
> 
> 时间：2008-10-22T02:38:24.570
> 
> 标签：ruby-on-rails, ruby

我有以下型号。

```
# app/models/domain/domain_object.rb
class Domain::DomainObject < ActiveRecord::Base
  has_many :links_from, :class_name => "Link", :as => :from, :dependent => :destroy
end

# app/models/link.rb
class Link < ActiveRecord::Base
  belongs_to :from, :polymorphic => true 
  belongs_to :object_value, :polymorphic => true
end 
```

问题是，当我执行以下操作时， from_type 不会将域命名空间作为模型的前缀，例如

```
 Domain::DomainObject.all(:include=> :links_from ) 
```

这会导致以下 SELECT：

```
 SELECT `links`.* FROM `links` WHERE (`links`.`from_id` IN (5,6,12,13,18,24,25,27,29,30,31,32,34,35,39) and `links`.`from_type` = 'DomainObject') 
```

查询应该是：

```
 SELECT `links`.* FROM `links` WHERE (`links`.`from_id` IN (5,6,12,13,18,24,25,27,29,30,31,32,34,35,39) and `links`.`from_type` = 'Domain::DomainObject') 
```

因为 Rails 会自动使用命名空间保存模型。

我在 Rails 网站上看到了一些关于这样做的建议：

```
 belongs_to :from, :polymorphic => true, :class_name => "Domain::DomainObject" 
```

但是，这似乎也不起作用。

那么，有没有更好的方法来做到这一点？还是不支持？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-23T23:09:52.680

为了解决这个问题，我`include Domain`在`DomainObject`模型中做了一个并设置`ActiveRecord::Base.store_full_sti_class = true`了`config/environment.rb`.

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2016-05-15T03:02:19.547

hoyhoy 的回应是解决方案。这也解决了我的问题（我实际上希望剥离命名空间）。

但是，我建议仅在全局需要时`x.store_full_sti_class = true`将其添加到。`config/environment.rb`我想可能并不总是需要它，在这种情况下，我们可以轻松地将解决方案转换为类级别。

```
class User < ActiveRecord::Base
  self.store_full_sti_class = true
  ...
end 
```

# sql-server - 区分大小写的数据库有什么好处吗？

> ID：224298
> 
> 赞同：22
> 
> 时间：2008-10-22T02:38:44.630
> 
> 标签：sql-server, database

我们刚刚将一个 SQL Server 2005 数据库从 DEVEL 迁移到了 TEST。不知何故，在迁移过程中，数据库从不区分大小写变为敏感——因此大多数 SQL 查询都被严重破坏了。

我想知道的是 - 拥有区分大小写的模式有什么明显的好处吗？

注意：我的意思是表名、列名、存储的过程名等。我不是指存储在表中的实际数据。

乍一看，我找不到比不区分大小写更有利的正当理由。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-10-22T04:37:36.420

我刚刚发现为什么我们让它区分大小写。这是为了确保当我们在客户端站点上部署它时，无论客户端的 SQL Server 是否设置区分大小写，我们的数据库都可以正常工作。

这是我没想到的一个答案。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-22T03:09:10.000

我真的想不出任何好的理由 SQL 标识符应该区分大小写。我能想到一个**不好**的，它是 MySQL 给出的为什么他们的表名是区分大小写的。每个表都是磁盘上的一个文件，您的文件系统区分大小写，而 MySQL 开发人员忘记了`table_file = lc(table_name)`. 当您将 MySQL 模式移动到不区分大小写的文件系统时，这很有趣。

我可以想到他们不应该区分大小写的一个重要原因。

一些模式作者会很聪明，并决定这`this_table`显然意味着不同于`This_Table`并制作这两个表（或列）。您不妨在架构中的那一点写“*在此处插入错误”。*

此外，不区分大小写让您在 SQL 中更具表现力，以强调表和列与命令，而不必拘泥于架构作者决定做的事情。

```
SELECT this, that FROM Table; 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-22T02:43:47.680

并非 Unicode 的所有部分都具有大小写字符之间的双射映射——甚至是两组大小写。

在这些地区，“不区分大小写”有点没有意义，而且可能具有误导性。

这就是我现在能想到的一切；在 ASCII 集中，除非您希望 Foo 和 foo 不同，否则我不明白这一点。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-22T03:13:18.027

大多数语言都区分大小写，大多数比较算法、大多数文件系统等也是如此。不区分大小写适用于懒惰的用户。尽管它确实倾向于使输入更容易，并且确实导致许多相同名称的变体仅在大小写上有所不同。

就个人而言，在（MyTable、mytable、myTable、MYTABLE、MYTable、myTABLE、MyTaBlE）之间，我希望*看到*一个*通用*版本。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-22T02:53:38.643

当您的开发人员在编写 SQL 时未能遵循任何类型的约定或来自不区分大小写是标准的开发语言（例如 VB）时，不区分大小写是天赐之物。

一般来说，我发现处理 ID、id 和 Id 不可能是不同字段的数据库更容易。

除了个人偏好酷刑之外，我强烈建议您不要区分大小写。

我曾经为区分大小写而设置的唯一数据库是 Great Plains。我发现必须记住他们的模式命名的每一个外壳是很痛苦的。我没有使用更新版本的特权。

除非它已更改并且如果我没记错的话，您所说的区分大小写的性质是在安装时确定的，并且适用于所有数据库。运行 Great Plains 数据库的 SQL Server 安装就是这种情况，我提到该安装上的所有数据库都区分大小写。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-12-04T16:10:56.580

我喜欢区分大小写，主要是因为这是我在 Perl（以及大多数其他语言）编程中所习惯的。我喜欢使用 StudlyCaps 作为表名，所有小写字母和下划线作为列名。

当然，许多数据库允许您引用名称以强制大小写，就像 Postgres 一样。这似乎也是一种合理的方法。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-22T19:55:17.427

我确实支持 Sybase Advantage Database Server，它使用允许 DBF 以及我们自己专有的 ADT 格式的平面文件格式。我认为区分大小写是一个问题的情况是在使用我们的 Linux 版本的服务器时。Linux 是一个区分大小写的操作系统，因此我们可以在我们的数据库中选择小写所有调用。这要求表文件为小写。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-12-04T19:56:20.697

我很确定 SQL 规范要求标识符的大小写折叠（实际上与不敏感相同）。PostgreSQL 折叠到下，ORACLE 折叠到上。

# pdf - 通过 VBA 将 MS Excel 2003 工作簿导出为 PDF

> ID：224301
> 
> 赞同：3
> 
> 时间：2008-10-22T02:40:05.190
> 
> 标签：pdf, excel, pdf-generation, excel-2003, vba

我有一个 Excel 2003 工作簿，其中包含一个宏，用于将其某些工作表复制到新工作簿，然后保存并关闭新工作簿。它这样做了几十次，每次选择的工作表略有不同。

我想在宏中添加一个额外的步骤，以将辅助工作簿的电子表格导出为 PDF。显而易见的方法是使用 PDF 打印机和 Excel 的内置打印功能，但大多数 PDF 打印机在完成之前都会给您一个“另存为...”对话框。显然，在 70 多个场合单独输入它缺乏吸引力 - 所以我想要一些允许我提前设置它的东西（可能是“使用我正在打印的文件的文件名减去它的扩展名”）然后只需选择默认选项。

对免费的 PDF 打印机有什么想法吗？还是合适的替代品？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-22T09:05:47.393

Office 2007 允许这样做。我发现[PDFCreator](http://sourceforge.net/projects/pdfcreator/)很好，VBA包含在示例文件中，听说[CutePDF](http://www.cutepdf.com/)也很好。PDFCreator 和 CutePDF 是免费的。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2011-10-14T10:49:23.123

作为[Remou](https://stackoverflow.com/users/2548/remou) （明智）答案的发展，因为这也帮助我解决了我的问题。

我选择[了 pdfcreator](http://sourceforge.net/projects/pdfcreator/)（因为我已经安装了它），这就是我最终使用的：

```
Sub PDF_Print() 
    Dim p 
    p = ActivePrinter 
    ActivePrinter = "PDFCreator" 
    ActiveDocument.PrintOut 
    ActivePrinter = p 
End Sub 
```

奇迹般有效

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-22T08:03:49.640

这可能会有所帮助：[http ://www.pdf995.com](http://www.pdf995.com)

一项功能是“绕过另存为对话框的三个自动命名选项”

# asp.net - 有没有办法在 ASP.NET 中优先考虑 Web 服务

> ID：224306
> 
> 赞同：0
> 
> 时间：2008-10-22T02:42:02.067
> 
> 标签：asp.net, scalability

目标是有一种方法来保证某些 Web 服务的特定 SLA（服务级别协议），以保证后端数据库的正常运行时间。理想情况下，这应该在服务中没有特定代码的情况下实现，而是通过控制底层基础设施/管道来实现。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-22T06:08:20.060

就个人而言，至少作为部分解决方案，在 IIS 级别上进行适当的隔离是一个好主意。“高可用性”Web 服务的特定应用程序池，在 MINIMUM 将是我书中的要求。

# objective-c - 使用 iPhone SDK 设置约会

> ID：224309
> 
> 赞同：2
> 
> 时间：2008-10-22T02:43:47.007
> 
> 标签：objective-c, iphone, cocoa-touch

我知道您可以从 SDK 访问联系人存储，但是可以创建和读取约会数据吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-22T03:34:38.980

这目前无法通过 2.x SDK 访问。

如果这是您需要的，您应该访问[http://bugreport.apple.com/](http://bugreport.apple.com/)并使用您的开发者帐户登录并编写功能请求。它很可能会被标记为重复，但 Apple 会跟踪重复，并且对某些东西的请求越多，它在他们的雷达上的移动就越高。

# java - 在 Java 中切换布尔变量的最简洁方法？

> ID：224311
> 
> 赞同：229
> 
> 时间：2008-10-22T02:44:08.647
> 
> 标签：java, boolean

有没有比简单的 if-else 更好的方法来否定 Java 中的布尔值？

```
if (theBoolean) {
    theBoolean = false;
} else {
    theBoolean = true;
} 
```

* * *

## 回答 #1

> 赞同：580
> 
> 时间：2008-10-22T02:45:16.757

```
theBoolean = !theBoolean; 
```

* * *

## 回答 #2

> 赞同：179
> 
> 时间：2008-10-22T03:28:55.153

```
theBoolean ^= true; 
```

如果您的变量长于四个字母，则击键次数更少

**编辑**：当用作谷歌搜索词时，代码往往会返回有用的结果。上面的代码没有。对于那些需要它的人，它是[这里描述](https://www.tutorialspoint.com/Java-Bitwise-Operators)的***按位异或***。

* * *

## 回答 #3

> 赞同：47
> 
> 时间：2016-11-14T16:58:57.963

# 有几种

**“明显”的方式**（对大多数人来说）

```
theBoolean = !theBoolean; 
```

**“最短”的方式**（大部分时间）

```
theBoolean ^= true; 
```

**“最直观”的方式**（最不确定）

```
theBoolean = theBoolean ? false : true; 
```

# 额外：在方法调用中切换和使用

```
theMethod( theBoolean ^= true ); 
```

由于赋值运算符总是返回已分配的内容，这将通过按位运算符切换值，然后返回新分配的值以在方法调用中使用。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2019-08-16T01:27:46.963

搜索“java invert boolean function”时出现了这个答案。下面的示例将防止某些静态分析工具由于分支逻辑而导致构建失败。如果您需要反转布尔值并且没有构建全面的单元测试，这很有用；）

```
Boolean.valueOf(aBool).equals(false) 
```

或者：

```
Boolean.FALSE.equals(aBool) 
```

或者

```
Boolean.FALSE::equals 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2017-07-01T13:51:41.627

如果您使用布尔 NULL 值并认为它们为假，请尝试以下操作：

```
static public boolean toggle(Boolean aBoolean) {
    if (aBoolean == null) return true;
    else return !aBoolean;
} 
```

如果您不处理布尔 NULL 值，请尝试以下操作：

```
static public boolean toggle(boolean aBoolean) {
   return !aBoolean;
} 
```

这些是*最干净*的，因为它们在方法签名中显示了意图，与*!* 运算符，并且可以很容易地调试。

用法

```
boolean bTrue = true
boolean bFalse = false
boolean bNull = null

toggle(bTrue) // == false
toggle(bFalse) // == true
toggle(bNull) // == true 
```

当然，如果您使用*Groovy*或允许扩展方法的语言，您可以注册一个扩展并简单地执行以下操作：

```
Boolean b = false
b = b.toggle() // == true 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2020-06-04T15:24:39.353

该类`BooleanUtils`支持布尔值的否定。[你可以在commons-lang:commons-lang](https://mvnrepository.com/artifact/org.apache.commons/commons-lang3)中找到这个类

```
BooleanUtils.negate(theBoolean) 
```

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2019-04-11T17:37:49.990

如果你没有做任何特别专业的事情，你总是可以使用 Util 类。例如，来自项目的类的实用程序类。

```
public class Util {

public Util() {}
public boolean flip(boolean bool) { return !bool; }
public void sop(String str) { System.out.println(str); }

} 
```

然后只需创建一个 Util 对象 `Util u = new Util();` 并返回一些东西`System.out.println( u.flip(bool) );`

如果您最终要一遍又一遍地使用相同的东西，请使用一种方法，尤其是跨项目时，请创建一个 Util 类。不知道行业标准是什么。（有经验的程序员欢迎指正）

* * *

## 回答 #8

> 赞同：-2
> 
> 时间：2020-08-05T23:07:21.297

不幸的是，没有像数字一样具有递增/递减的简短形式：

我++；

我希望有类似的简短表达式来反转布尔值，dmth，例如：

是空的！;

* * *

## 回答 #9

> 赞同：-4
> 
> 时间：2015-04-02T09:49:38.663

前：

```
boolean result = isresult();
if (result) {
    result = false;
} else {
    result = true;
} 
```

后：

```
boolean result = isresult();
result ^= true; 
```

# ftp - Web 开发工具问题 - 自动文件上传

> ID：224315
> 
> 赞同：1
> 
> 时间：2008-10-22T02:47:02.540
> 
> 标签：ftp

对于一些简单的代表来说，这应该是一个快速的问题。

我正在做一些 PHP 网站开发，决定检查并使用 jQuery。我不想安装和管理本地 PHP 服务器/服务，但我想要一种快速的单击方法来自动将我正在处理的 PHP 文件上传到我的托管服务，以便我可以对其进行实时测试。

我正在研究一些不同的编辑器，例如 Komodo Edit、Notepad++，但我想知道什么工具能够为我一键点击 FTP？

* * *

在几个帖子进来后编辑：

Well Shoot，Ultra Edit 的成本在 100 美元左右，Aptana 允许你上传到他们的“云”，但你必须购买云空间。我已经有了自己的服务器。我会更多地研究 BlueFish ......谢谢你们的帮助。

我想我可能会尝试使用 Notepad++ 并编写一个批处理文件来运行内置于 FTP 的窗口，建立连接并以自动覆盖模式复制文件夹中的所有文件。看起来可行？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-22T12:10:21.997

我有一个设置，我使用 FileZilla 作为 FTP，NotePad++ 作为我的文本编辑器。

在 FileZilla 中，我将 NotePad++ 设置为默认文本编辑器，当我在当时正在处理的文件中点击`Ctrl`-`S`时，它会自动将这些更改上传到服务器。

您将能够在 FileZilla ( [http://filezilla-project.org](http://filezilla-project.org) ) 中编辑首选项以设置您的默认文本编辑器，这是您应该能够使用任何 FTP 程序执行的操作。

查看这篇文章了解更多信息： http: [//linhost.info/2008/01/notepad-and-filezilla-tip/](http://linhost.info/2008/01/notepad-and-filezilla-tip/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-22T02:49:53.110

[UEStudio](http://www.ultraedit.com)集成了 (S)FTP、SVN 等，以及通过 FTP 打开文件的能力——当然，它实际上只是下载到一个临时文件，但每次按下保存时，它都会再次将其上传到服务器。

刚才我不得不指出，您可能需要重新考虑避免使用本地开发环境的决定。使用[XAMPP](http://www.xampp.org)，设置本地 Web 服务器非常容易。这有很多好处，甚至无法列出。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-22T03:03:04.130

[Aptana IDE](http://www.aptana.com)可以通过 FTP 一键上传，也可以一键同步本地环境和远程服务器（基于时间戳）之间的所有文件。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-22T02:53:56.723

[Bluefish](http://bluefish.openoffice.nl/)可以直接在 FTP 服务器上编辑文件。我不确定[Win32](http://code.google.com/p/bluefish-win/)版本是否可以做到这一点。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-22T04:27:09.547

Zend Studio 等大多数高级编辑器/IDE 允许直接添加 FTP 服务器和编辑文件。修改后，按`Ctrl`+`S`将更新服务器上的文件。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-22T21:10:06.823

我使用电子文本编辑器。这是某种 textmate 克隆，只有更好：P

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2019-02-08T21:11:45.827

我在 sftp 插件中使用了 sublime text。 [sublime3](https://www.sublimetext.com/3)和 [sftp](https://wbond.net/sublime_packages/sftp)插件 您只需要在根文件夹中配置 sftp 文件。效果很好。问候

# ms-office - 美国州办公室形状

> ID：224322
> 
> 赞同：1
> 
> 时间：2008-10-22T02:50:28.213
> 
> 标签：ms-office, graph, data-visualization

我想为我的项目创建符合 CNN 对美国各州的“红州、蓝州”阴影的视觉效果。我打算做一些比仅仅用颜色着色国家的形状更花哨的事情。是否有状态形状/多边形的开源库（或 - 如果不是开源 - 其他）可以导入 Word、Excel 等，我可以用来显示基于状态的复杂图形？

我有地图点，但无法弄清楚如何以复杂的方式对状态进行着色。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-22T03:51:41.973

这是使用谷歌地图的一个很好的例子......我以前使用过这样的代码......也许来自这个确切的例子。

[http://econym.org.uk/gmap/example_states2.htm](http://econym.org.uk/gmap/example_states2.htm)

编辑：您可能需要考虑将 states.xml 转换为 JSON ......它会更小（现在是 136k 的 XML！）并且在大多数浏览器中加载速度应该更快。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-22T02:53:13.510

你可以试试谷歌图表，看起来[http://www.woot.com](http://www.woot.com)正在做类似于你需要的事情

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-01-05T16:25:00.333

您要问的问题可能有几个部分，但要解决第一部分“是否有状态形状/多边形的开源库......”，这里有一个资源可供查看：

[http://commons.wikimedia.org/wiki/Category:SVG_maps_of_the_United_States](http://commons.wikimedia.org/wiki/Category:SVG_maps_of_the_United_States)

它是各种 SVG（可缩放矢量图形）文件的列表，可以导入到许多应用程序中。基本上是线和端点的巨大 xml 表示。这可以直接转换为 XAML，如果您使用更编程的图表方式（即 C# w/Silverlight）。

但是，为了解决有关 MS Office 的第二部分，Visio 也可以导入 SVG 文件进行操作。我不确定您正在寻找哪种类型的图表，但我希望这可以在您通往令人敬畏的道路上以某种小方式帮助您；）

# python - 向导的替代品

> ID：224337
> 
> 赞同：3
> 
> 时间：2008-10-22T02:54:17.533
> 
> 标签：python, wxpython, wizard

我正在制作一个非常适合向导概念的程序；用户将逐步完成为游戏创建角色的步骤。

但是，我意识到向导的局限性使得设计“优雅”的逻辑流程变得困难。例如，因为向导的所有页面都是同时初始化的，所以我不能让在一个页面中输入的值对下一个页面可用。我必须在每一页上放置一个按钮来获取前一页的值，而不是简单地自动填充字段。

我已经考虑过使用向导的替代方法。我认为最好的办法是在一个面板上设置一些按钮来更改另一个面板上的信息，例如拆分器窗口。

但是，我在 wxPython 中找不到任何关于如何动态更改面板的文档。到目前为止，我发现的所有东西都非常静态，因此使用了向导。甚至“wxPython in Action”一书也没有提到它。

是否有制作“动态面板”或更好地管理向导的教程？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-22T08:04:52.057

这是一个简单的例子。这样，您可以使您的“向导”像有限状态机一样工作，其中状态是按需初始化的不同页面。此外，数据在页面之间共享。

```
import wx
import wx.lib.newevent

(PageChangeEvent, EVT_PAGE_CHANGE) = wx.lib.newevent.NewEvent()

class Data:
    foo = None
    bar = None

class Page1(wx.Panel):
    def __init__(self, parent, data):
        wx.Panel.__init__(self, parent)
        self.parent = parent
        self.data = data

        sizer = wx.BoxSizer(wx.VERTICAL)
        self.SetSizer(sizer)
        label = wx.StaticText(self, label="Page 1 - foo")
        self.foo = wx.TextCtrl(self)
        goto_page2 = wx.Button(self, label="Go to page 2")

        for c in (label, self.foo, goto_page2):
            sizer.Add(c, 0, wx.TOP, 5)

        goto_page2.Bind(wx.EVT_BUTTON, self.OnPage2)

    def OnPage2(self, event):
        self.data.foo = self.foo.Value
        wx.PostEvent(self.parent, PageChangeEvent(page=Page2))

class Page2(wx.Panel):
    def __init__(self, parent, data):
        wx.Panel.__init__(self, parent)
        self.parent = parent
        self.data = data

        sizer = wx.BoxSizer(wx.VERTICAL)
        self.SetSizer(sizer)
        label = wx.StaticText(self, label="Page 2 - bar")
        self.bar = wx.TextCtrl(self)
        goto_finish = wx.Button(self, label="Finish")

        for c in (label, self.bar, goto_finish):
            sizer.Add(c, 0, wx.TOP, 5)

        goto_finish.Bind(wx.EVT_BUTTON, self.OnFinish)

    def OnFinish(self, event):
        self.data.bar = self.bar.Value
        wx.PostEvent(self.parent, PageChangeEvent(page=finish))

def finish(parent, data):
    wx.MessageBox("foo = %s\nbar = %s" % (data.foo, data.bar))
    wx.GetApp().ExitMainLoop()

class Test(wx.Frame):
    def __init__(self):
        wx.Frame.__init__(self, None)
        self.data = Data()
        self.current_page = None

        self.Bind(EVT_PAGE_CHANGE, self.OnPageChange)
        wx.PostEvent(self, PageChangeEvent(page=Page1))

    def OnPageChange(self, event):
        page = event.page(self, self.data)
        if page == None:
            return
        if self.current_page:
            self.current_page.Destroy()
        self.current_page = page
        page.Layout()
        page.Fit()
        page.Refresh()

app = wx.PySimpleApp()
app.TopWindow = Test()
app.TopWindow.Show()
app.MainLoop() 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-29T16:09:32.753

wxPython 演示有一个“动态”向导的示例。页面覆盖 GetNext() 和 GetPrev() 以动态显示页面。这显示了基本技术；您可以扩展它以添加和删除页面、动态更改页面以及动态重新排列页面。

不过，向导类只是一种方便。您可以修改它，或创建自己的实现。现在流行的一种风格是使用基于 HTML 的演示文稿。您可以使用 wxHtml 控件或 IEHtmlWindow 控件来模拟它，如果您的应用程序仅适用于 Windows。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-22T12:06:03.987

您可以尝试使用像[WFTK](http://www.vivtek.com/wftk/)这样的工作流引擎。在这种特殊情况下，作者使用 WFTK 对基于 wx 的应用程序进行了一些工作，并且可能会指导您查看示例。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-29T17:14:33.433

我会彻底摆脱巫师。它们是我用过的最不愉快的东西。

需要单击“下一步”的向导应用程序的问题可能是您可以以稍微不同的方式应用更好的用户界面的问题。而不是用烦人的“下一步”按钮打开一个对话框。做这个：

调出一页。当用户在页面中插入信息时，根据输入进行扩展或缩短。如果您的应用程序需要进行一些处理才能继续，并且之后无法恢复，请编写一个新页面或禁用当前页面的早期部分。当您不再需要用户的任何输入或应用程序已完成时，您可以显示一个按钮或启用现有的此类。

我并不是说你应该在浏览器中实现它。简单地制作一个可以在平面列表中包含按钮和标签的滚动容器。

好处：用户只需单击一个选项卡，鼓励您将所有处理放在填充页面的末尾。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-29T17:38:48.610

应该注意的是，向导应该是多步骤、不经常执行的任务的接口。该向导用于引导用户完成他们并不真正理解的事情，因为他们几乎从不这样做。

如果某些用户可能经常执行该任务，您希望为这些高级用户提供一个轻量级的界面来执行相同的操作——即使它不那么自我解释。

请参阅：**[Windows Vista 用户体验指南 - 最常见的违规行为](http://msdn.microsoft.com/en-us/library/aa511331.aspx#wizards)**

> **奇才**
> 
> **首先考虑轻量级替代方案，例如对话框、任务窗格或单页。**向导是一个沉重的 UI，最适合用于多步骤、不经常执行的任务。您不必使用向导——您可以在任何 UI 中提供有用的信息和帮助。

# sql-server - 哪个版本的 SQL Server 2005 允许我继续运行 DTS 包？

> ID：224339
> 
> 赞同：0
> 
> 时间：2008-10-22T02:56:59.773
> 
> 标签：sql-server, sql-server-2005, ssis, licensing, dts

我听说过 SSIS，它是旧 DTS 的新替代品。我相信它具有与我过去执行相同的功能。现在，就像 Microsoft 的任何其他产品一样，您必须为单个软件包处理 10 种不同的选择。

我想听听您对我应该购买哪个版本的 SQL Server 2005 以确保我可以像 DTS 工作方式一样在我的主机服务器和本地数据存储之间复制数据的意见？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-22T02:59:56.990

抱歉，伙计，但 SSIS 不像 DTS 那样简单可靠……如果可能的话，我会保留 SQL 2000 的副本来使用 DTS

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-22T03:21:24.373

您可以安装 SQL Server 2005 的向后兼容组件，它允许您在 SQL Server 2005（和 2008）中运行旧的 DTS 包。这是链接：

[http://www.microsoft.com/downloads/details.aspx?familyid=d09c1d60-a13c-4479-9b91-9e8b9d835cdc&displaylang=en](http://www.microsoft.com/downloads/details.aspx?familyid=d09c1d60-a13c-4479-9b91-9e8b9d835cdc&displaylang=en)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-22T03:37:39.973

您可以在 SQL Server 2005 中使用 DTS。我的部门服务器已从 SQL Server 2000 升级到 SQL Server 2005。我的 DTS 包也已移动。您将需要 Microsoft SQL Server 2000 DTS 设计器组件才能对其进行编辑。

[http://msdn.microsoft.com/en-us/sqlserver/aa336314.aspx](http://msdn.microsoft.com/en-us/sqlserver/aa336314.aspx)

这样做的缺点是很难创建新的包。您可以这样做，但您需要先导出现有包，更改它，然后使用新名称导入它。

SSIS 有相当高的学习曲线。我已经使用它几年了，它在某些方面向前迈进了一步，但在其他方面却倒退了。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-23T13:50:55.633

如果您正在进行 Web 开发，升级后您需要记住这一点：

DTS 和 SSIS 包之间的一个区别是，如果您想通过代码执行它们，尽管您可以通过 SSIS 对包进行更多控制，但执行代码的机器需要安装 SQL Server。这意味着，如果您将其编写为 ASP.Net 应用程序，例如，它最终运行的任何机器也需要在其上安装 sql server（这在大多数环境中不太可能）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-23T13:09:58.757

我相信您可能想要**SQL Server 2005-Workgroup 版**。

SSIS 在 Express 版本中不可用，只要您不想将数据复制到各个订阅者，那么 Workgroup 可能就是您所需要的。这是一张比较 2005 年各种特征的 [图表。](http://www.microsoft.com/Sqlserver/2005/en/us/compare-features.aspx)

在您决定购买某个版本之前，我会下载您感兴趣的特定版本的试用版，并验证它是否为您提供了所需的功能。

# javascript - 在 JavaScript 中是否有“正确”的继承方式？如果是这样，它是什么？

> ID：224345
> 
> 赞同：9
> 
> 时间：2008-10-22T03:03:00.980
> 
> 标签：javascript, oop, refactoring, interface

我一直在尝试学习如何向现有代码添加测试——目前正在阅读[有效地使用遗留代码](https://rads.stackoverflow.com/amzn/click/com/0131177052)。我一直在尝试在 JavaScript 中应用一些原则，现在我正在尝试提取一个接口。

在寻找用 JavaScript 创建接口的过程中，我找不到很多东西——而我发现的关于继承的东西似乎有几种不同的方式。（有些人创建自己的基类以提供有用的方法，使继承更容易，有些人使用函数，有些人使用原型）。

什么是正确的方法？有一个在 JavaScript 中提取接口的简单示例吗？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-10-22T03:07:02.390

没有明确的**正确方法**，因为很多人在做很多不同的事情。有很多有用的模式。

**Crockford**建议您“随波逐流”，或者以符合 javascript 原型性质的方式编写 javascript。

当然，他继续表明 Netscape 建议的原始模型实际上已被破坏。他将其标记为“伪经典”，并指出了遵循该模型所涉及的许多误导和不必要的复杂性。

他编写了“对象”函数作为补救措施（现在称为 Object.create() ）。它允许一些非常强大的原型模式。

当您必须使用遗留 javascript 时，开发一个干净的界面并不总是那么容易，尤其是当您处理大型系统时，通常包括多个库，并且每个库都实现了独特的样式和不同的继承模式。一般来说，我会说进行继承的“正确方法”是允许您编写一个干净的接口，该接口在您的遗留代码的上下文中表现良好，但也允许您随着时间的推移重构和消除旧的依赖关系.

考虑到主要库模式之间的差异，我发现在我自己的工作中最成功的途径是让我的接口完全独立于库接口。如果有帮助，我将使用库或模块，但不会被绑定。这使我能够重构大量代码，逐步淘汰一些库，并将库用作以后可以优化的脚手架。

沿着这些思路，我编写了受 Crockford 寄生继承模式启发的接口。这真的是简单的胜利。

在硬币的另一面，我敢肯定你会争论选择一个库，在你的团队中强制执行它，并符合它的继承模式和接口约定。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-22T03:59:01.333

javascript中没有类，只有对象。
但是如果你坚持模拟基于类的面向对象模型，你可以使用这个：

```
函数子类（）{
    ParentClass.call(this);
    // 在此之后编写构造函数的其余部分。
};
ChildClass.prototype = jQuery.extend({}, ParentClass.prototype, ChildClass.prototype);

```

jQuery.extend 是 jQuery 库中的一个“浅拷贝”函数。您可以将其替换为任何其他对象复制/克隆功能。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-22T03:24:55.413

你在看两种不同的东西。

首先你有接口。实现这一点最被接受的方式是通过 Duck Typing（“如果它看起来像一只鸭子并且像鸭子一样嘎嘎叫，那么它就是一只鸭子”）。这意味着如果一个对象实现了接口的一组方法，那么它就是那个接口。您可以通过一组定义接口的方法名称来实现这一点。然后检查一个对象是否实现了那个干扰，你看看它是否实现了那些方法。这是我整理的一个代码示例：

```
function Implements(obj, inter)
{
    var len = inter.length, i = 0;
    for (; i < len; ++i)
    {
        if (!obj[inter[i]])
            return false;
    }
    return true;
}

var IUser = ["LoadUser", "SaveUser"];

var user = {
        LoadUser : function()
        {
            alert("Load");
        },

        SaveUser : function()
        {
            alert("Save");
        }
    };

var notUser = {
        LoadUser : function()
        {
            alert("Load");
        }
    };

alert(Implements(user, IUser));
alert(Implements(notUser, IUser)); 
```

现在你有了继承权。JS 没有内置继承；所以你必须手动实现它。这只是将一个对象的属性“复制”到另一个对象的问题。这是另一个代码示例（不完美，但它说明了这一点）：

```
function InheritObject(base, obj)
{
    for (name in base)
    {
        if (!obj[name])
            obj[name] = base[name];
    }
}

var Base = {
        BaseFunc : function() { alert("BaseFunc from base"); },
        InheritFunc : function() { alert("InheritFunc from base"); }
    }

var Inherit = {
        InheritFunc : function() { alert("InheritFunc from inherit"); },
        AnotherFunc : function() { alert("AnotherFunc from inherit"); }
    }

InheritObject(Base, Inherit);

Inherit.InheritFunc();
Inherit.BaseFunc();
Inherit.AnotherFunc();

Base.BaseFunc();
Base.InheritFunc(); 
```

你可能想看看[http://www.mootools.net](http://www.mootools.net)。它有我最喜欢的类实现。你肯定也想看看“Pro Javascript Design Patterns”

[http://www.amazon.com/JavaScript-Design-Patterns-Recipes-Problem-Solution/dp/159059908X](https://rads.stackoverflow.com/amzn/click/com/159059908X)

这本书详细介绍了如何在 javascript 中模拟 OOP。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-22T03:15:19.737

另请查看 Dean Edwards 的 Base.js。你可以看看[这里](http://dean.edwards.name/weblog/2006/03/base/)，博客文章是不言自明的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-22T13:23:00.307

Prototype 提供了自己的继承方式，来自[http://www.prototypejs.org/api/class/create](http://www.prototypejs.org/api/class/create)：

```
var Animal = Class.create({
  initialize: function(name, sound) {
    this.name  = name;
    this.sound = sound;
  },

  speak: function() {
    alert(this.name + " says: " + this.sound + "!");
  }
});

// subclassing Animal
var Snake = Class.create(Animal, {
  initialize: function($super, name) {
    $super(name, 'hissssssssss');
  }
}); 
```

# asp.net - 为什么会浮动浮动元素中的控件在 IE7 中向右滑动太远，但在 Firefox 中没有？

> ID：224352
> 
> 赞同：5
> 
> 时间：2008-10-22T03:06:44.793
> 
> 标签：asp.net, html, css, webforms, cross-browser

希望一张图片值一千行代码，因为我不想为了提供示例而剥离所有 ASP.Net 代码、HTML、JavaScript 和 CSS（但我会根据要求提供我能提供的如果有人没有说“哦，我以前见过！试试这个......”）[实际上，我确实发布了一些代码和 CSS - 见问题的底部]。

这是 Firefox 中显示的表单页面的一部分： ![替代文字](https://farm4.static.flickr.com/3191/2963487384_2c996e0bb6_o.png)

蓝色框是`<label>`标签的临时样式，橙色线是标签的临时边框样式`<div>`（所以我可以看到它们在哪里延伸和中断）。`<label>`'s 的样式与右侧的 's一样`float: left`。`<div`此外， 的后代控件`<div>`也是`float:left`纯粹的，因此它们将在顶部排列`<div>`（因为下面有一些更高的控件，例如多行文本框）。

单选按钮由 ASP 控件生成，因此它们被包裹在一个`<span>`- 中，因为它是`<div>`.

这是在 IE7 中呈现的屏幕的相同部分： ![替代文字](https://farm4.static.flickr.com/3272/2963487410_d76e422e78_o.jpg)

有一些细微的渲染差异，但让我抓狂的是`<input>`控件旁边的额外空白区域！请注意，`<span>`单选按钮和复选框周围的 ' 正确排列。

尽管它们没有显示出来，但下拉列表和列表框也会发生同样的事情。我没有尝试将输入控件包装在 a 中`<span>`，但这可能有效。不过，这是一个丑陋的黑客。

我已经尝试了几种 IE7 解决框问题的方法，并且我已经编辑了 CSS，直到我处于纯巫术模式（即，进行随机更改，希望某些东西有效）。就像我说的，我希望有人看到这个并说，“我以前见过！试试这个……”

任何人？

**跟进一：**

我正在使用 XHTML 1.0 Transitional `<DOCTYPE>`，所以我应该处于标准模式。

**跟进2：**

这是上面生成的代码的一小段（第一个控件和最后一个控件）。请注意，此代码由 ASP.Net 生成，然后由 JavaScript/jQuery 动态编辑。

```
 <fieldset id="RequestInformation">
   <legend>Request Information</legend>
   <ol>
     <li>
       <label id="ctl00_ContentPlaceHolder1_txtRequestDate_L" class="stdLabel" 
         for="ctl00_ContentPlaceHolder1_txtRequestDate">Request Date:</label>
       <div class="FormGroup">
         <input id="ctl00_ContentPlaceHolder1_txtRequestDate" class="RSV DateTextBox hasDatepicker" 
           type="text" value="10/05/2004" name="ctl00$ContentPlaceHolder1$txtRequestDate"/>
         <img class="ui-datepicker-trigger" src="/PROJECT/images/Calendar_scheduleHS.png" alt="..." title="..."/>
         <span id="txtRequestDate_error"/>
       </div>
     </li>
     --STUFF DELETED HERE--
     <li>
       <label id="ctl00_ContentPlaceHolder1_chkAppealed_L" class="stdLabel" 
         for="ctl00_ContentPlaceHolder1_chkAppealed"> Request Appealed?</label>
       <div class="FormGroup">
         <span class="stdCheckBox">
           <input id="ctl00_ContentPlaceHolder1_chkAppealed" type="checkbox" name="ctl00$ContentPlaceHolder1$chkAppealed"/>
         </span>
       </div>
     </li>
   </ol>
 </fieldset> 
```

这是CSS的相关部分（我仔细检查以确保这重复了问题）：

```
div
{
    border-style: solid;
    border-width: thin;
    border-color:Orange;
}

label
{
    border-style: solid;
    border-width: thin;
    border-color:Blue;
}

.FormGroup
{
    float:left;
    margin-left: 1em;
    clear: right;
    width: 75em;
}

.FormGroup > *
{
    float:left;
    background-color: Yellow;
}

fieldset ol
{
    list-style: none;
} 

fieldset li
{
    padding-bottom: 0.5em;
} 

li > label:first-child
{
    display: block;
    float: left;
    width: 10em;
    clear: left;
    margin-bottom: 0.5em;
}

em
{
    color: Red;
    font-weight: bold;
} 
```

# ****解决方案！****

**Matthew 将我指向有关[IE/Win Inherited Margins on Form Elements](http://www.positioniseverything.net/explorer/inherited_margin.html)的这个页面，这就是问题所在。输入框继承了所有包含元素的左边距。我选择的解决方案是将每个`<input>`元素包装在一个无样式的`<span>`. 我一直在努力使 HTML 的结构在语义上尽可能合理，所以我在`$(document).ready()`函数中使用 jQuery 命令解决了它：

```
//IE Margin fix: 
//  http://www.positioniseverything.net/explorer/inherited_margin.html
jQuery.each(jQuery.browser, function(i) {
    if($.browser.msie){
        $(":input").wrap("<span></span>");
    }
}); 
```

请注意，这只会`<span>`在 IE 上添加愚蠢的...

StackOverflow 再次救援！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-22T04:07:26.387

`input`是从周围继承边距`div`，而`ol`. 如果你用另一个标签（如 span 或 div）包围它，它应该可以解决你的问题。

**编辑：您可以在**[http://www.positioniseverything.net/explorer/inherited_margin.html](http://www.positioniseverything.net/explorer/inherited_margin.html)找到更多信息和解决方法

# open-source - 开源竞争或合作

> ID：224354
> 
> 赞同：2
> 
> 时间：2008-10-22T03:07:32.280
> 
> 标签：open-source

我一直觉得开源空间很有趣，但从未真正参与过任何项目。我最近有一个我认为很棒的想法，它与我在该领域看到的其他项目不同（如果重要的话，它是一个 .NET DI 框架）。

我的问题是，如果我有一个时髦的想法，我应该加入现有项目并分享我的想法，还是创建一个完全符合我想要的竞争项目。该领域有一些项目与我的想法相似，但它们并没有完全捕捉到相同的理想。

开源空间中是否存在额外的竞争？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-22T03:24:03.917

竞争与开源中的协作同样重要。假设许可证是兼容的，功能和想法可能是交叉传播的。每个人都赢了。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-22T03:16:18.860

对此的简短回答是另一个问题：您想为讨论做出贡献，还是按照自己的方式做事？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-22T03:30:44.293

您可能想考虑以自己的方式编写它，并将该过程变成您可以提交给 CodeProject 的文章。然后，如果似乎对这篇文章感兴趣，请将其添加到 SourceForge。我已经看到很多工具和小部件以这种方式获得了快速的受众和编码帮助。我经常使用的一个是 XPTable，它最初是一篇 CodeProject 文章，最终成为 SourceForge 上的一个开源项目。

顺便说一句，你会知道它是否很受欢迎，因为你会开始收到很多改进请求，或者人们甚至会为你的文章提交他们自己的修复和增强。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-27T03:23:37.837

感谢您的时间。我决定直接为他们伤害的一些领域的项目做出贡献。通过这样做，我可以帮助项目并向大师学习。

# .net - 在 linqtosql 中删除记录的最简洁语法

> ID：224359
> 
> 赞同：2
> 
> 时间：2008-10-22T03:11:01.853
> 
> 标签：.net, linq, linq-to-sql

当我有主键时，使用 LINQ 删除数据库记录的最佳方法是什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-22T03:36:15.607

这种方法是可以接受的和典型的。

这有点浪费，因为您要请求整个记录。鉴于 DeleteOnSubmit 方法签名，这是无法避免的。

为什么 LINQ to SQL 以这种方式工作？如果您考虑没有主键或使用复合键的表，答案显而易见。LINQ to SQL 在最坏的情况下需要整个记录，它需要将每个对象属性与表字段进行匹配。

但是应该询问所有有关性能的问题-您绝对确定这对您来说是性能问题吗？你的分析证明在哪里？

我还没有尝试过，但可能有一种方法可以使用[DataContext.ExecuteCommand](http://msdn.microsoft.com/en-us/library/system.data.linq.datacontext.executecommand.aspx)实现相同的目标。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-22T13:51:19.330

If you set **update checks** on all your columns to **never** or **when changed**, you can simply attach an instance with the primary key and delete the row without a load.

```
public void DeleteCustomer(int CustomerID)
{
    NorthwindContext c = new NorthwindContext c;
    Customer target = new Customer(){CustomerID = CustomerID};
    c.Customers.Attach(target);
    c.Customers.DeleteOnSubmit(target);
    c.SubmitChanges();                       
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-22T03:39:00.533

我最终做了一个选择，但改进了我认为我真正关心的语法：

老的：

```
var products = from p in db.Products select p;
db.Products.DeleteOnSubmit(products.Take(1).Single()); <--seemed nasty
db.SubmitChanges(); 
```

新的：

```
Service service = db.Services.Where(s => s.id == serviceID).FirstOrDefault(); <--nicer
db.Services.DeleteOnSubmit(service);
db.SubmitChanges(); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-22T04:02:14.293

```
 public static Delete(this ITable table, object key)
   { var t = table.GetType();
     var tableName  = t.GetCustomAttributes
                                    (typeof(TableAttribute),false)[0].Name;
     var primaryKey = (from p in t.GetProperties()
                       from c in p.GetCustomAttributes
                                            (typeof(ColumnAttribute),false)
                       where c.IsPrimaryKey
                       select c.Name).Single();
     using (var cmd = table.Context.Connection.CreateCommand())
      { cmd.CommandText = string.Format( "DELETE FROM {0} WHERE {1} = @key"
                                        ,tableName, primaryKey);
        cmd.Parameters.Add(new SqlParameter("@key", key));
        cmd.ExecuteNonQuery();        
      }            
   }

/* ... */
dataContext.Table1.Delete(id); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-22T03:14:41.190

您可以将存储过程映射到 DataContext 上的方法，该方法删除具有给定主键值的记录。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-22T03:16:59.250

我一直使用选择删除方法，因为它非常简单。正如 marxidad 所说，如果你真的想的话，你可以映射一个存储过程。我相信 ESQL 有计划在未来支持插入、更新和删除操作。

# sql-server-2005 - 支持 SSIS 的最低 SQL Server 2005 版本是什么？

> ID：224362
> 
> 赞同：0
> 
> 时间：2008-10-22T03:14:35.917
> 
> 标签：sql-server-2005

支持 SSIS 的最低 SQL Server 2005 版本是什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-22T03:23:34.103

基本转换的标准版本。

高级转换的高级版。

[http://www.microsoft.com/sqlserver/2005/en/us/compare-features.aspx#integration](http://www.microsoft.com/sqlserver/2005/en/us/compare-features.aspx#integration)

# java - 在 maven 中处理 Web 项目的非常规源目录

> ID：224373
> 
> 赞同：19
> 
> 时间：2008-10-22T03:22:34.590
> 
> 标签：java, maven-2

我继承了一个当前在 Eclipse 中构建的 Web 项目（Servlets）。

我想在它周围添加 Maven。但是项目的源目录没有遵循 maven 约定。它不是在 src/main/java 中，而是 src/package/name/...

我现在不想改变任何东西，因为他们正全速朝着里程碑迈进。我可以将 maven 配置为接受 src/ 作为 java 源目录吗？谢谢

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2008-10-22T03:44:01.880

只需将其添加到该`build`部分的 pom 中即可。

```
<sourceDirectory>${basedir}/src</sourceDirectory> 
```

[这是 POM 文档中关于配置目录](http://maven.apache.org/pom.html#Build_Element)的相关部分。

# asp.net - 通过 XSP2 运行守护程序有任何问题吗？

> ID：224378
> 
> 赞同：5
> 
> 时间：2008-10-22T03:27:14.223
> 
> 标签：asp.net, mono, hosting, xsp

我们希望使用 Mono 2.0（或更高版本）运行一个通过 ASMX 公开自身的守护进程。我们考虑在 Application_Start 事件中启动一个守护线程，而不是处理 ASP.NET 托管 API。XSP2 不应该重新启动 appdomain，所以我们的守护进程是安全的。

这有什么缺点吗（除了有点奇怪）？还有其他方法可以让我们的代码在与 ASMX 请求相同的 appdomain 中运行吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2011-11-15T10:02:08.957

当您可以构建一个 shell 控制台应用程序（使用相同的代码或接受参数）时，为什么需要 XSP 通过调用 ASXM 来运行守护程序？这可以在终端中调用或从任何 shell 脚本调用并添加到 cron。简单，不需要服务器来执行此操作。

如果你想这样做，而不是我这样做的方式，你可以在某个内部端口中设置一个基本服务器实例（使用 nginx、lighty 或 apache）列表，将该服务器添加到一个虚拟主机和 cron/shell 脚本你可以做

```
WGET http://dummyhost/mydaemon.asmx 
```

# ruby - __FILE__ 在 Ruby 中是什么意思？

> ID：224379
> 
> 赞同：221
> 
> 时间：2008-10-22T03:28:19.897
> 
> 标签：ruby

我一直在 Ruby 中看到这一点：

```
require File.dirname(__FILE__) + "/../../config/environment" 
```

是什么`__FILE__`意思？

* * *

## 回答 #1

> 赞同：151
> 
> 时间：2008-10-22T03:30:09.800

它是对当前文件名的引用。在文件`foo.rb`中，`__FILE__`将被解释为`"foo.rb"`.

**编辑： Ruby 1.9.2 和 1.9.3 的行为似乎与 Luke Bayes 在**[他的评论](https://stackoverflow.com/questions/224379/what-does-file-mean-in-ruby#comment1243516_224383)中所说的略有不同。使用这些文件：

```
# test.rb
puts __FILE__
require './dir2/test.rb' 
```

```
# dir2/test.rb
puts __FILE__ 
```

运行`ruby test.rb`会输出

```
test.rb
/full/path/to/dir2/test.rb 
```

* * *

## 回答 #2

> 赞同：62
> 
> 时间：2009-05-21T17:17:43.027

的值`__FILE__`是加载文件时创建和存储（但从未更新）的相对路径。这意味着，如果您对`Dir.chdir`应用程序中的其他任何地方有任何调用，则此路径将错误地扩展。

```
puts __FILE__
Dir.chdir '../../'
puts __FILE__ 
```

此问题的一种解决方法是将扩展值存储在`__FILE__`任何应用程序代码之外。只要您的`require`语句位于定义的顶部（或至少在任何调用之前`Dir.chdir`），此值在更改目录后将继续有用。

```
$MY_FILE_PATH = File.expand_path(File.dirname(__FILE__))

# open class and do some stuff that changes directory

puts $MY_FILE_PATH 
```

* * *

## 回答 #3

> 赞同：28
> 
> 时间：2008-12-02T19:47:03.137

`__FILE__`是包含正在执行的代码的文件扩展名的文件名。

在`foo.rb`，`__FILE__`将是“foo.rb”。

如果`foo.rb`在目录中，`/home/josh`则将`File.dirname(__FILE__)`返回`/home/josh`。

* * *

## 回答 #4

> 赞同：18
> 
> 时间：2009-04-24T06:59:09.617

无论如何，在 Windows 版本的 Ruby 中，我只是检查`__FILE__`并不包含文件的完整路径。相反，它包含文件相对于执行位置的路径。

在 PHP`__FILE__`中是完整的路径（我认为这是更可取的）。这就是为什么，为了让你的路径在 Ruby 中可移植，你真的需要使用这个：

```
File.expand_path(File.dirname(__FILE__) + "relative/path/to/file") 
```

我应该注意，在 Ruby 1.9.1`__FILE__`中包含文件的完整路径，上面的描述是针对我使用 Ruby 1.8.7 时的。

为了与 Ruby 1.8.7 和 1.9.1（不确定 1.9）兼容，您应该使用我上面显示的结构来 require 文件。

# svn - 我应该看看 Subversion 以外的版本控制系统吗？

> ID：224396
> 
> 赞同：28
> 
> 时间：2008-10-22T03:35:32.957
> 
> 标签：svn, git, version-control, mercurial, bazaar

在过去的一年里，我沉迷于颠覆。我是唯一的开发人员，我也从事一些我自己的项目。使用 SVN，它真的很容易管理一切 - 因为它通过 HTTPS 托管在在线服务器上，所以我可以从任何地方访问我的代码。它也非常适合将代码部署到我们的生产/开发服务器。

我的观点是，它完成了我需要它做的所有事情，并且从未让我失望过。

有更好的吗？我是否缺少其他产品中的某些功能，可以用来让我的生活更轻松？我一直都在使用最好的软件，并且在迁移到新技术方面没有问题。

我听说过 GIT 并做了一些研究。我打算尝试一下，但是当我对此感到困惑时，是否还有其他被认为是“行业标准”的源代码控制系统，它们是否比 SVN 做得更好？

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-10-22T03:41:07.470

Git、Mercurial 和 Bazaar 是分布式控制系统，其运行理念是您并不总是连接到网络，并且不需要一个存储库的中央版本。

如果您正在做很多独立的工作，有时称为“飞行模式”，例如您在飞机上并且无法提交，请查看 Bazaar。我发现它比 Git 或 Mercurial 更容易适应。

如果您一直在做与网络相关的工作，并且您是唯一的开发人员，那么您可能会坚持使用 Subversion。

另外，请考虑将[主目录保留在 Subversion 中](http://xoa.petdance.com/How_to:_Keep_your_home_directory_in_Subversion)的价值。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2008-10-22T05:20:12.667

**水银**

我主要用的是CVS和SVN，开心又满足，后来因为DSVC闹得沸沸扬扬，开始研究分布式源代码控制。在使用 DSVC 之后，我注意到我的开发风格发生了变化，我变得更加流畅和适应。允许我轻松地合并回主干或实验分支。

*   Mercurial 可以从一个人的团队扩展到庞大的即 OpenJDK，而不会让人头疼。
*   Mercurial 很快，可能不如 GIT 快，但仍然非常快
*   Mercurial Queues 是管理补丁的绝佳方式。以油脂照明的速度。
*   它可以在不同的操作系统上运行，兼容性很好，因为它基于 python。
*   学习曲线低于 GIT，在阅读了一些文档后，您会了解基本情况（[http://betterexplained.com/articles/intro-to-distributed-version-control-illustrated/](http://betterexplained.com/articles/intro-to-distributed-version-control-illustrated/)）
*   hg 允许（许多 DSVC 也是如此）您使用 hg-svn 和 hgsubversion 与公司 SVN 源代码控制进行交互，这是一个带有允许和签出功能的精彩扩展，但还没有推送或提交功能
*   你也可以设置一个 HTTP 服务器通过 SSH 运行推送和拉取
*   还可以与您的编码伙伴聚在一起，只需启动 HTTP 服务器在 localhost 上运行它，您的伙伴可以在您进行代码冲刺时进行推送和拉取。
*   您还可以通过此 HTTP 页面查看项目的当前状态。
*   最后在这里查看简单命令的简要说明（[http://edong.net/2008v1/docs/dongwoo-Hg-PDF.pdf](http://edong.net/2008v1/docs/dongwoo-Hg-PDF.pdf)）

**吉特**

*   试过了，它对svn的支持比mercurial好。但由于 hgsubversion 正在兴起并成为 git svn 的竞争者。

Git 很酷，但你需要不断地维护你的源代码仓库并重新打包它。由于它包含许多 bash 脚本，因此无法在 Windows 上运行。但它的速度非常快，有许多功能供您使用。实际上，功能的数量可能是一个缺点。

**BZR**

*   从未尝试过

自从我开始使用 HG 以来，我没有回头

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-10-22T03:40:38.673

我个人会留在 Subversion。从专业的角度来看，我看到更多的工作要求（并且知道）Subversion 与 GIT 的比较。还有很多围绕 Subversion 构建的开源和免费软件工具，更不用说 Subversion 的庞大社区了。

源代码控制并不总是关于最新和最伟大的，而是更多关于经过尝试和真实的东西。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2008-10-22T04:49:32.887

改变的最好理由是必要性。但是，听起来没有真正需要改变。您是“一体之军”，因此大多数强大的功能不适用于您的情况。是的，人们会在这个问题上与我争论，但是他们会推动这个功能或者你很可能真的不需要的那个功能。时间就是一切，如果将来您的需求发生变化，请更改您的解决方案。

对于问题空间，总会有更好或不同的解决方案，在这种情况下是源代码控制，但是您应该平衡个人发展、流程/实践改进和交付工作产品。您可以了解有关源代码控制的不同解决方案/应用程序的更多信息，以扩展您的知识，以识别何时需要切换解决方案，但坚持目前有效的方法。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2008-10-22T03:50:56.700

以下是从 Subversion （来自 MarkMcB）[切换到 git 的 3 个原因：](http://markmcb.com/2008/10/18/3-reasons-to-switch-to-git-from-subversion/)

*   无尽的、简单的、非基于文件系统的本地分支
*   暂存临时工作
*   公开提交之前的协作

（阅读链接文章以获得关于如何在 git 和 Subversion 中完成这三件事的完整解释和直接比较。）

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-10-22T04:19:33.180

我个人也会继续使用 Subversion， *还有什么更好的吗？*

Subversion 是一个很棒的版本控制系统，你对它很满意，所以如果你想进一步了解，我可以建议你获取一些关于[持续集成](http://martinfowler.com/articles/continuousIntegration.html)的信息，那里有很多工具可以帮助你进行自动构建，让您的构建进行自我测试，检查每个提交的完整性，等等...

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-10-22T03:51:07.810

Mercurial 也值得考虑；分支更友好，它可以在没有网络连接的情况下工作。在我从 SVN 迁移到 Mercurial 之前，我从未认真尝试过将工作分成多个分支。

我非常想念的一件事是 TortoiseSVN；有一个类似的（TortoiseHg）非常好，但它不一样..

无论如何，从 SVN 创建 Mercurial 存储库非常简单……试一试，看看它是否适合您。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-10-22T17:31:01.600

规则号 1：**“永远不要改变正在运行的系统”**

此外，由于有许多闪亮的新解决方案（对于您没有的问题，因为您独自工作），您应该考虑切换到新 VCS 的成本：将颠覆导入 Mercurial/git 不是一件容易的事

没有工具（AFAIK），它使用转储格式导入 svn repos。因此，如果您不使用转储格式，您将坚持从 svn 签出所有分支/标签并将它们手动/通过脚本添加到 git/BZR/Mercurial

所以我不知道你的仓库有多大（我的仓库从 20 MB 到 24GB 不等），但是检查整个仓库需要很**长时间，即使是带有很多标签的小项目也会吃掉很多****硬盘空间**。

另一个问题是在完成迁移之前您无法继续工作。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-11-01T16:26:01.263

有一句古老的洋基谚语。

*如果它没有坏，就不要修理它。*

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-11-19T01:10:18.150

我和你一样，为了获得最好的工具而不断调查。

我尝试使用 SVN 进行 SOLO 工作，有人推荐我 Mercurial (hg)。现在我做关于它的主题演讲。它比 windows 中的 git 更友好。我现在想“为什么 svn 会使标签之类的简单任务变得复杂”。SVN 不知道标签是什么。对于 SVN，标签是一个副本。在 mercurial 中，标签是修订版的别名。能有多复杂？

性能是另一个问题。在 Mercurial 中，您的存储库位于您的本地计算机中。因此，对于日志、差异或历史记录来说，它的速度非常快。

尽管我对支持 mercurial 以获取您的 repo 在线版本的服务器一无所知。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-06-18T09:12:44.233

即使您实际上并未使用分布式工作流程，也绝对值得研究“分布式”VC。能够拥有私有分支并控制本地提交是值得学习 git 的。我一直主要使用 git-svn（其他团队成员使用常规的 SVN 客户端，所以我们有一个正常的、集中的工作流程），它工作得非常完美。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-11-01T16:08:07.900

如果 SVN 满足您的所有需求，那么我看不出改变的原因。如果好奇心是您寻求不同源代码控制的驱动力，那么我建议您阅读有关 git 或其他分布式 scm 解决方案的信息，并尝试确定是否值得投资以进行切换（我怀疑您的情况）。

# c++ - 为什么人们在 C++ 中如此多地使用 __（双下划线）

> ID：224397
> 
> 赞同：99
> 
> 时间：2008-10-22T03:35:36.310
> 
> 标签：c++, syntax

我正在查看一些开源 C++ 代码，我注意到代码中使用了很多双下划线，主要是在变量名的开头。

```
return __CYGWIN__; 
```

只是想知道：这是有原因的，还是只是某些人的代码风格？我认为它使阅读变得困难。

* * *

## 回答 #1

> 赞同：136
> 
> 时间：2008-10-22T03:45:05.090

来自[C++ 编程、规则和建议](http://www.doc.ic.ac.uk/lab/cplus/c++.rules/chap5.html)：

> 根据 ANSI-C 标准，在标识符中使用两个下划线 (`__') 保留供编译器内部使用。
> 
> 下划线 (`_') 经常用于库函数的名称中（例如“_main”和“_exit”）。为避免冲突，请勿使用下划线开头的标识符。

* * *

## 回答 #2

> 赞同：52
> 
> 时间：2008-10-22T11:15:24.620

除非他们觉得自己是“实现的一部分”，即标准库，否则他们不应该这样做。

这些规则相当具体，并且比其他一些人建议的要详细一些。

所有包含双下划线或以下划线开头后跟大写字母的标识符都保留用于所有范围的实现，即它们可能用于宏。

此外，所有其他以下划线开头的标识符（即后面没有另一个下划线或大写字母）都保留用于全局范围的实现。这意味着您可以在自己的命名空间或类定义中使用这些标识符。

这就是为什么 Microsoft 使用带有前导下划线且全部小写的函数名称来表示其许多不属于 C++ 标准的核心运行时库函数。保证这些函数名称不会与标准 C++ 函数或用户代码函数发生冲突。

* * *

## 回答 #3

> 赞同：39
> 
> 时间：2008-10-22T03:42:25.313

根据 C++ 标准，以下划线开头的标识符是为库保留的。以两个下划线开头的标识符是为编译器供应商保留的。

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2008-10-22T03:49:24.287

上述评论是正确的。 `__Symbol__`通常是有用的编译器（或预处理器）供应商提供的魔法令牌。其中最广泛使用的可能是`__FILE__`and `__LINE__`，它们由 C 预处理器扩展以指示当前文件名和行号。当您想要记录某种程序断言失败时，这很方便，包括错误的文本位置。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2008-10-22T03:39:48.003

这是您在“正常”代码中不应该做的事情。这确保编译器和系统库可以定义不会与您的符号冲突的符号。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2019-05-31T04:56:15.117

# 双下划线保留给实现

投票最多的答案引用[了 C++ 编程：规则和建议](https://web.archive.org/web/20180423133417/http://www.doc.ic.ac.uk/lab/cplus/c++.rules/chap5.html)：

> “根据 ANSI-C 标准，在标识符中使用两个下划线 (`__') 保留供编译器内部使用。”

但是，在阅读了一些 C++ 和 C 标准之后，我找不到任何关于下划线仅限于*编译*器内部使用的提及。标准更通用，为**实施**保留双下划线。

## C++

[C++](https://timsong-cpp.github.io/cppwp/n4659/lex.name)（当前工作草案，于 2019 年 5 月 26 日访问）状态`lex.name`如下：

> *   每个包含双下划线 __ 或以下划线后跟大写字母的标识符都保留给实现以供任何使用。
> *   每个以下划线开头的标识符都保留给实现用作全局命名空间中的名称。

## C

尽管这个问题是针对 C++ 的，但我引用了 C 标准 99 和 17 中的相关部分：

[C99](https://busybox.net/~landley/c99-draft.html)第 7.1.3 节

> *   以下划线和大写字母或另一个下划线开头的所有标识符始终保留用于任何用途。
> *   所有以下划线开头的标识符始终保留用作普通和标记名称空间中具有文件范围的标识符。

[C17](https://web.archive.org/web/20181230041359if_/http://www.open-std.org/jtc1/sc22/wg14/www/abq/c17_updated_proposed_fdis.pdf)和 C99 说的一样。

# **执行情况**是什么？

对于 C/C++，[实现](https://en.wikipedia.org/wiki/Programming_language_implementation)松散地指的是从用户源文件生成可执行文件所需的集合资源。这包括：

*   预处理器
*   编译器
*   链接器
*   标准库

## 示例实现

[Wikipedia](https://en.wikipedia.org/wiki/C%2B%2B)上提到了许多不同的 C++ 实现。（无锚链接，ctrl+f“实现”）

[这是 Digital Mars 的 C/C++ 实现的示例，它为他们的特性保留了一些关键字。](https://digitalmars.com/ctg/contract.html)

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-10-22T03:50:11.680

除了许多其他人回应的库之外，有些人还命名宏或#define 值以与预处理器一起使用。这将使它更容易使用，并且可能允许解决旧编译器中的错误。

像其他人提到的那样，它有助于防止名称冲突，并有助于在库变量和您自己的变量之间进行描述。

# php - 使用 PHP 返回文件夹中的文件总数

> ID：224408
> 
> 赞同：12
> 
> 时间：2008-10-22T03:40:51.230
> 
> 标签：php, file, count, directory

有没有更好/更简单的方法来查找目录中的图像数量并将它们输出到变量？

```
function dirCount($dir) {
  $x = 0;
  while (($file = readdir($dir)) !== false) {
    if (isImage($file)) {$x = $x + 1}
  }
  return $x;
} 
```

这似乎是一个很长的路要走，没有更简单的方法吗？

**注意：**如果文件是图像，isImage() 函数将返回 true。

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-10-22T03:55:38.050

查看 DirectoryIterator 的标准 PHP 库（又名 SPL）：

```
$dir = new DirectoryIterator('/path/to/dir');
foreach($dir as $file ){
  $x += (isImage($file)) ? 1 : 0;
} 
```

（仅供参考，有一个名为 iterator_count() 的未记录函数，但我想现在最好不要依赖它。而且你需要过滤掉看不见的东西，比如 . 和 .. 无论如何。）

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-10-22T04:40:54.340

这将为您提供目录中的内容的计数。我将把关于只计算图像的部分留给你，因为我即将跌倒aaasssllleeelppppppzzzzzzzzzzzzzzz。

```
iterator_count(new DirectoryIterator('path/to/dir/')); 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2013-01-28T17:12:17.603

我这样做：

```
$files = scandir($dir);
$x = count($files);
echo $x; 
```

但它也算。和 ..

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2010-10-11T11:03:51.093

上述代码

```
$count = count(glob("*.{jpg,png,gif,bmp}")); 
```

是您最好的，但 {jpg,png,gif} 位仅在您`GLOB_BRACE`在末尾附加标志时才有效：

```
$count = count(glob("*.{jpg,png,gif,bmp}", GLOB_BRACE)); 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-22T04:45:50.507

你可以用`glob`...

```
$count = 0;
foreach (glob("*.*") as $file) {
    if (isImage($file)) ++$count;
} 
```

或者，我不确定这是否适合您的需求，但您可以这样做：

```
$count = count(glob("*.{jpg,png,gif,bmp}")); 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-31T11:21:23.617

您还可以使用 SPL通过扩展抽象类`DirectoryIterator`来使用您的函数过滤 a 的内容。`isImage``FilterIterator`

```
class ImageIterator extends FilterIterator {

    public function __construct($path)
    {
        parent::__construct(new DirectoryIterator($path));
    }

    public function accept()
    {
        return isImage($this->getInnerIterator());
    }
} 
```

然后，您可以使用`iterator_count`（或实现`Countable`接口并使用本机`count`函数）来确定图像的数量。例如：

```
$images = new ImageIterator('/path/to/images');
printf('Found %d images!', iterator_count($images)); 
```

使用这种方法，根据您需要如何使用此代码，将`isImage`函数移动到`ImageIterator`类中以将所有内容整齐地包装在一个地方可能更有意义。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2016-02-24T12:59:02.870

我使用以下内容来获取 Laravel 一个目录中所有类型文件的计数

```
 $dir = public_path('img/');
    $files = glob($dir . '*.*');

    if ( $files !== false )
    {
        $total_count = count( $files );
        return $totalCount;
    }
    else
    {
        return 0;
    } 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-22T04:09:33.357

您的答案似乎很简单。我想不出在 PHP 或 Perl 中更短的方法。

如果您使用的是 Linux，则可能可以使用涉及 ls、wc 和 grep 的 system / exec 命令，具体取决于 isImage() 的复杂程度。

无论如何，我认为你所拥有的已经足够了。您只需编写一次函数。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2013-05-08T15:18:28.027

我用它来返回目录中所有文件的计数，除了 . 和 ..

```
return count(glob("/path/to/file/[!\.]*")); 
```

这是用于文件匹配目的[的 glob 过滤器的一个很好的列表。](http://cowburn.info/2010/04/30/glob-patterns/)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2013-06-02T09:42:13.507

```
$nfiles = glob("/path/to/file/[!\\.]*");

if ($nfiles !== FALSE){

    return count($nfiles);

} else {

    return 0;

} 
```

# asp.net - log4net 与 ASP.NET 3.5 问题

> ID：224410
> 
> 赞同：13
> 
> 时间：2008-10-22T03:41:21.697
> 
> 标签：asp.net, .net-3.5, web-config, log4net, global-asax

我在让 log4net 从 ASP.NET 3.5 工作时遇到了一些麻烦。这是我第一次尝试使用 log4net，我觉得我错过了一块拼图。

我的项目引用了 log4net 程序集，据我所知，它已成功部署在我的服务器上。

我的 web.config 包含以下内容：

```
 <configSections>
    <section name="log4net"
      type="log4net.Config.Log4NetConfigurationSectionHandler
      , log4net"
      requirePermission="false"/>
  </configSections>

  <log4net>
    <appender name="InfoAppender" type="log4net.Appender.FileAppender">
      <file value="..\..\logs\\InfoLog.html" />
      <appendToFile value="true" />
      <layout type="log4net.Layout.PatternLayout">
        <conversionPattern
          value="%d [%t] %-5p %c [%x] - %m%n" />
      </layout>
    </appender>
    <logger name="_Default">
      <level value="INFO" />
      <appender-ref ref="InfoAppender" />
    </logger>
  </log4net> 
```

我正在使用以下代码来测试记录器：

```
using log4net;
using log4net.Config;

public partial class _Default : System.Web.UI.Page
{
    private static readonly ILog log = LogManager.GetLogger("_Default");

    protected void Page_Load(object sender, EventArgs e)
    {
        log.Info("Hello logging world!");
    }
} 
```

在我的 Global.asax 中，我正在执行以下操作：

```
void Application_Start(object sender, EventArgs e) 
{
    log4net.Config.XmlConfigurator.Configure();
} 
```

在这一点上，我想不出我可能做错了什么。我试图存储登录的目录是可写的，即使我尝试不同的目录，我也会得到相同的结果：没有文件，没有日志。

有什么建议么？:-)

* * *

编辑：我为日志文件的路径和名称尝试了几种不同的格式，其中一些包括“..\..\InfoLog.html”、“InfoLog.html”、“logs\InfoLog.html”等，以防万一有人想知道这是否是问题所在。

* * *

编辑：我已将根记录器节点添加回 log4net 部分，我在从示例中复制时无意中忽略了这一点。根记录器节点如下所示：

```
<root>
  <level value="INFO" />
  <appender-ref ref="InfoAppender" />
</root> 
```

然而，即使有了它，我仍然没有运气。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-10-22T03:46:27.070

我认为根记录器是强制性的。我怀疑配置失败是因为根不存在。

另一个潜在问题是 Configure 没有指向 Web.config。

尝试 Configure(Server.MapPath("~/web.config")) 代替。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-14T03:44:42.820

对我来说，这听起来很像文件权限问题。如果您指定的文件名没有任何路径，log4net 将写入 Web 应用程序的根目录。试试看。除非在那里取得任何成功，否则我建议您通过将以下内容放入 web.config 来启用内部 log4net 调试：

```
<?xml version="1.0" encoding="utf-8" ?>
<configuration>
    <appSettings>
        <add key="log4net.Internal.Debug" value="true"/>
    </appSettings>
</configuration> 
```

然后，部署在调试模式下编译的应用程序并运行[Visual Studio 远程调试器](https://web.archive.org/web/1/http://blogs.techrepublic%2ecom%2ecom/programming-and-development/?p=675)以查看引发的任何错误。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-05T20:11:58.087

iv 刚刚花了 3 个小时试图解决这个问题，最终它是 web.config 格式。

我有这个，但它没有用：

```
<section name="SubSonicService" type="SubSonic.SubSonicSection, SubSonic" requirePermission="false"/>
      <section name="log4net"
        type="log4net.Config.Log4NetConfigurationSectionHandler
      , log4net"
        requirePermission="false"/> 
```

将其更改为此修复了它：

```
 <section name="log4net" type="log4net.Config.Log4NetConfigurationSectionHandler,log4net" requirePermission="false"/> 
```

恼人的！！

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-19T09:49:42.803

仅供参考：文件路径的格式必须如下：

```
<file value="..\\..\\logs\\InfoLog.html" /> 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-20T13:31:25.947

来自[CodeProject的简单配置教程](http://www.codeproject.com/KB/aspnet/log4net.aspx)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-10-05T03:08:26.293

我没有在 .net 3.5 中运行的 Global.asx

这是我的代码...我在单独的文件 log4net.config 中配置 log4net

```
// Configure log4net using the .config file
[assembly: log4net.Config.XmlConfigurator(ConfigFile = "log4net.config", Watch = true)]

//My Web Services class name
private static readonly log4net.ILog log = log4net.LogManager.GetLogger("Service1"); 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-13T22:36:54.823

我有同样的（令人沮丧的）问题。我将根移动到 log4net 配置部分的顶部，一切正常。此外，我也有 root 和一个记录器元素，这导致每次我调用记录器时都会出现两行。我删除了记录器元素并简单地保持根及其工作良好。

* * *

## 回答 #8

> 赞同：-2
> 
> 时间：2008-11-14T03:30:02.927

这就是我在 Global.ASX 中所拥有的。一切都在asp.net 3.5中工作

```
<%@ Application Language="C#" %>

<script runat="server">

    void Application_Start(object sender, EventArgs e) 
    {
        // Code that runs on application startup
         log4net.Config.XmlConfigurator.Configure(); 
    }

    void Application_End(object sender, EventArgs e) 
    {
        //  Code that runs on application shutdown
        log4net.LogManager.Shutdown();
    }

    void Application_Error(object sender, EventArgs e) 
    { 
        // Code that runs when an unhandled error occurs
    }

    void Session_Start(object sender, EventArgs e) 
    {
        // Code that runs when a new session is started
    }

    void Session_End(object sender, EventArgs e) 
    {
        // Code that runs when a session ends. 
        // Note: The Session_End event is raised only when the sessionstate mode
        // is set to InProc in the Web.config file. If session mode is set to StateServer 
        // or SQLServer, the event is not raised.
    }
</script> 
```

* * *

## 回答 #9

> 赞同：-2
> 
> 时间：2008-12-19T10:03:42.540

如何使用页面类型创建记录器，如下所示：

```
private static readonly ILog log = LogManager.GetLogger(typeof(_Default)); 
```

# php - PHP + WSDL + SOAP - 如何在屏幕上显示 Web 服务结果

> ID：224417
> 
> 赞同：3
> 
> 时间：2008-10-22T03:43:58.680
> 
> 标签：php, web-services, soap

我刚开始使用 PHP，想要一些关于如何让 web 服务结果显示在数组中的建议。

例如，我想将货币代码从以下 WSDL 打印到数组中

```
$wsdl="http://www.webservicex.com/CurrencyConvertor.asmx?WSDL 
```

这是我到目前为止所拥有的，但没有真正发生：

```
$proxyhost="proxy.cpit.ac.nz";  
$proxyport = 8080;  

$wsdl="http://www.webservicex.com/CurrencyConvertor.asmx?WSDL";

$client = new SoapClient($wsdl,
  array('proxy_host' => "$proxyhost",'proxy_port' => 8080, 'trace' => 1));

$country=array();
$result = $client->ConversionRate($country);
print_r($result); 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-22T05:45:47.093

基本上，这是您的 $country 变量。

如果您查看 ConversionRate Webservice，它会根据需要定义 FromCurrency 和 ToCurrency。

```
 <s:element name="ConversionRate"> 
    <s:complexType> 
      <s:sequence> 
        <s:element minOccurs="1" maxOccurs="1" name="FromCurrency" type="tns:Currency" /> 
        <s:element minOccurs="1" maxOccurs="1" name="ToCurrency" type="tns:Currency" /> 
      </s:sequence> 
    </s:complexType> 
  </s:element> 
```

您需要像这样更新 $country ：

```
$country = array( "FromCurrency" => "AFA",
                  "ToCurrency" => "AUD"); 
```

那应该行得通。

# c++ - 条件表达式中的常量值

> ID：224421
> 
> 赞同：8
> 
> 时间：2008-10-22T03:46:12.530
> 
> 标签：c++, c, warnings, visual-c++

在[关于无限循环的编码风格问题](https://stackoverflow.com/questions/224138/infinite-loops-top-or-bottom)中，有些人提到他们更喜欢 for(;;) 风格，因为 while(true) 风格会在 MSVC 上给出关于条件表达式为常数的警告消息。

这让我非常惊讶，因为在条件表达式中使用常量值是避免#ifdef 地狱的有用方法。例如，您可以在标题中包含：

```
#ifdef CONFIG_FOO
extern int foo_enabled;
#else
#define foo_enabled 0
#endif 
```

并且代码可以简单地使用条件并信任编译器在未定义 CONFIG_FOO 时删除死代码：

```
if (foo_enabled) {
    ...
} 
```

不必每次使用 foo_enabled 时都测试 CONFIG_FOO：

```
#ifdef CONFIG_FOO
if (foo_enabled) {
    ...
}
#endif 
```

这种设计模式一直在 Linux 内核中使用（例如，include/linux/cpumask.h 在禁用 SMP 时将多个宏定义为 1 或 0，在启用 SMP 时定义为函数调用）。

MSVC 警告的原因是什么？此外，有没有更好的方法来避免 #ifdef 地狱而不必禁用该警告？或者它是一个过于宽泛的警告，一般不应该启用？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-22T03:57:48.450

警告并不意味着代码很*糟糕*，只是看起来很可疑。

就我个人而言，我从启用所有可能的警告的位置开始，然后关闭任何被证明比有用更烦人的警告。每当您将任何内容转换为布尔值时都会触发的那个通常是第一个触发的。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-22T03:54:11.890

我认为警告的原因是你可能无意中有一个更复杂的表达式，它在没有意识到的情况下计算为一个常量。假设您在标题中有这样的声明：

```
const int x = 0; 
```

然后稍后，远离 x 的声明，您有一个条件，例如：

```
if (x != 0) ... 
```

您可能没有注意到它是一个常量表达式。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-22T03:49:43.740

我相信这是为了抓住像

```
 if( x=0 ) 
```

当你的意思是

```
 if( x==0 ) 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-22T03:53:16.477

避免警告的一种简单方法是：

```
#ifdef CONFIG_FOO
extern int foo_enabled;
#else
extern int foo_enabled = 0;
#endif 
```

# apache-flex - 将远程 swf “引导”到应用程序 SecurityDomain (actionscript3)

> ID：224422
> 
> 赞同：0
> 
> 时间：2008-10-22T03:46:21.280
> 
> 标签：apache-flex, actionscript-3, air, applicationdomain, securitydomain

我的 Flash (AS3/AIR) 应用程序目前使用一种稍微不寻常的架构（对于 Flash 应用程序）来为运行时加载的内容提供特定的基类。外部内容是使用“存根”基类发布的，在加载时会在运行时被“真实”基类所掩盖。我听说这被 Adob​​e 称为*bootstrapping* ( [pdf](http://blogs.adobe.com/flexdoc/loadingSubApps.pdf) )，直到现在它对我来说一直运行良好。我相信它与 DLL 架构没有什么不同，尽管我没有资格肯定地说。

到目前为止，我一直在加载的外部内容是从同一个`SecurityDomain`（同一个沙箱）中加载的，这使我可以轻松地将内容加载到 child`ApplicationDomain`中。不幸的是，据我所知，`ApplicationDomain`跨度`SecurityDomain`s 的 s 不能相关 - 也就是说，我不能使一个 SecurityDom 的 AppDom 成为另一个 SecurityDom 的 AppDom 的子项。

但现在我需要从我的应用程序沙箱外部加载这些外部内容。有很多方法可以实现跨`SecurityDomain`s 的通信——尽管其中大多数都非常有限，但 AIR 的`sandboxBridge`API 可能是最强大的。不幸的是，这些通信方法都不允许我实现这种引导架构。

我注意到该`LoaderContext`对象有一个`securityDomain`属性，但 Flash 安全性禁止“本地 swfs”触摸它（它会抛出一个`SecurityError`或类似的）。

Flex's`SWFLoader`有一个`trustContent`看起来很有希望的属性，但我倾向于假设它与`SecurityDomain`在`Loader`'s中设置的限制相同`LoaderContext`。

我怀疑我将不得不重新设计（这并不容易），但我想我只是在这里检查一下我没有错过我的研究中的任何东西。

那么......任何想法或智慧的珍珠？如果从事安全模型工作的 Adob​​e 人员能给我一个明确的“是/否，它可以/不能完成”，我会特别喜欢它......

提前致谢！

*附录：*从那以后，我决定重新设计架构，以便引导全部发生在外部域上。然而，出于好奇，我的问题仍然存在。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-23T05:57:49.033

从技术上讲，您的 AIR 应用程序不能简单地将外部 SWF 保存在您的应用程序目录中，然后从那里加载它们以便它们存在于同一个安全沙箱中吗？

然而，这将是 Bad Karma 有一些非常明显的原因，所以似乎任何解决方案都必然会提出一个问题，即尝试将本地应用程序内容和远程不受信任的内容放入同一个应用程序域是否是正确的架构方法..？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-09-02T03:04:47.883

在撰写本文时，我确定如果它来自另一个域，即使使用 AIR ，您也无法将其加载`ApplicationDomain`到您自己的域中。`SecurityDomain`

我猜是设计使然。

# asp.net - xcopy ASP.NET 部署 Subversion 管理的项目

> ID：224430
> 
> 赞同：4
> 
> 时间：2008-10-22T03:50:30.337
> 
> 标签：asp.net, svn

我目前正在使用 Subversion 来管理我的 ASP.NET 网站。我发现每当我将我的网站上传到我的服务器时，我都会复制大量隐藏的 .svn 文件夹以及其中可能包含的任何内容。

有没有人有任何避免这种情况的建议？我并不特别想要生产服务器上那些隐藏的 .svn 文件夹，但是在上传我的网站之前没有手动删除每个 .svn 文件夹，我不知道如何拥有一个没有 .svn 文件夹的生产环境.

* * *

编辑：谢谢大家，这些都是很好的建议，我真的很感激！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-22T04:04:08.330

1.  您应该使用 subversion 的 export 命令。
2.  您可以调整注册表并将“删除 SVN 文件夹”添加到文件夹的上下文菜单中。[这是来自http://weblogs.asp.net/jgalloway/archive/2007/02/24/shell-command-remove-svn-folders.aspx](http://weblogs.asp.net/jgalloway/archive/2007/02/24/shell-command-remove-svn-folders.aspx)的示例脚本将其保存到 .reg 文件并执行。

右键单击您的项目文件夹并递归删除所有 .svn 文件夹。

```
Windows Registry Editor Version 5.00

[HKEY_LOCAL_MACHINE\SOFTWARE\Classes\Folder\shell\DeleteSVN]
@="Delete SVN Folders"

[HKEY_LOCAL_MACHINE\SOFTWARE\Classes\Folder\shell\DeleteSVN\command]
@="cmd.exe /c \"TITLE Removing SVN Folders in %1 && COLOR 9A && FOR /r \"%1\" %%f IN (.svn) DO RD /s /q \"%%f\" \"" 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-22T03:54:53.353

两个建议：

*   使用[robocopy](http://en.wikipedia.org/wiki/Robocopy)或 xcopy 过滤掉`.svn`文件夹
*   `svn export`网络服务器的存储库（[docs](http://svnbook.red-bean.com/en/1.0/re10.html)）。导出不会写入任何`.svn`文件夹

另请参阅：[乌龟 SVN 隐藏的 SVN 文件夹](https://stackoverflow.com/questions/222188/tortoise-svn-hidden-svn-folders)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-22T03:53:46.493

你如何在服务器上运行 Subversion，然后从存储库中执行 svn 导出？svn 导出就像一个结帐，但没有 .svn 文件夹（并且没有在该目录中进行 Subversion 工作的能力）。

或者，在您的本地计算机上执行 repo 的 svn 导出，然后通过 FTP 上传导出的版本。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-22T04:00:53.513

我有一个后期构建步骤，它准备一个干净的放置文件夹作为项目构建的一部分。这是我的做法：

```
 <PropertyGroup>
    <DropPath>..\..\drop\</DropPath>
    <TestDropPath>..\..\test\</TestDropPath>
  </PropertyGroup>
  <Target Name="AfterBuild">
    <ItemGroup>
      <Binaries Include="$(OutputPath)**\*.*" />
    </ItemGroup>
    <ConvertToAbsolutePath Paths="$(DropPath)">
      <Output TaskParameter="AbsolutePaths" ItemName="FullDropPath" />
    </ConvertToAbsolutePath>
    <Message Importance="High" Text="Binplacing -&gt; @(FullDropPath)" />
    <Copy SourceFiles="@(Compile)" DestinationFiles="@(Compile->'$(DropPath)%(Identity)')" />
    <Copy SourceFiles="@(Content)" DestinationFiles="@(Content->'$(DropPath)%(Identity)')" />
    <Copy SourceFiles="@(EntityDeploy)" DestinationFiles="@(EntityDeploy->'$(DropPath)%(Identity)')" />
    <Copy SourceFiles="@(Binaries)" DestinationFiles="@(Binaries->'$(DropPath)%(Identity)')" />
  </Target> 
```

当然，`svn export`也可以。:-) 但是，使用这种方法，您无法在构建期间修改任何源文件并将其提交回存储库。

# sql-server - 是否可以看到 sp_executesql 的代码？是 TSQL 吗？

> ID：224440
> 
> 赞同：2
> 
> 时间：2008-10-22T03:55:53.073
> 
> 标签：sql-server

是否可以看到 sp_executesql 的代码？我想看看实际的代码。我在 sql server management studio 中找不到它。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-22T04:28:41.227

sp_executesql 是一个扩展的存储过程。它是 DLL 中的二进制文件。

# c# - 在 C# 中解密 PHP 加密字符串

> ID：224453
> 
> 赞同：15
> 
> 时间：2008-10-22T04:03:03.243
> 
> 标签：c#, php, encryption

我有一个用 PHP 加密的字符串，我想用 C# 解密它。我使用下面的教程进行加密，但在解密时遇到问题。任何人都可以发布有关如何执行此操作的示例吗？

[http://www.sanity-free.org/131/triple_des_between_php_and_csharp.html](http://www.sanity-free.org/131/triple_des_between_php_and_csharp.html)

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-10-22T04:56:13.840

希望这可以帮助：

```
class Program
{
    static void Main(string[] args)
    {
        Console.WriteLine(Decrypt("47794945c0230c3d"));
    }

    static string Decrypt(string input)
    {
        TripleDES tripleDes = TripleDES.Create();
        tripleDes.IV = Encoding.ASCII.GetBytes("password");
        tripleDes.Key = Encoding.ASCII.GetBytes("passwordDR0wSS@P6660juht");
        tripleDes.Mode = CipherMode.CBC;
        tripleDes.Padding = PaddingMode.Zeros;

        ICryptoTransform crypto = tripleDes.CreateDecryptor();
        byte[] decodedInput = Decoder(input);
        byte[] decryptedBytes = crypto.TransformFinalBlock(decodedInput, 0, decodedInput.Length);
        return Encoding.ASCII.GetString(decryptedBytes);
    }

    static byte[] Decoder(string input)
    {
        byte[] bytes = new byte[input.Length/2];
        int targetPosition = 0;

        for( int sourcePosition=0; sourcePosition<input.Length; sourcePosition+=2 )
        {
            string hexCode = input.Substring(sourcePosition, 2);
            bytes[targetPosition++] = Byte.Parse(hexCode, NumberStyles.AllowHexSpecifier);
        }

        return bytes;
    }
} 
```

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-11-19T19:19:06.343

如果您没有绑定到 TripleDES，而只需要在 php 和 .net 之间传递加密数据，那么这对您有用。它在下面的VB和C#中。

### 开始 PHP 代码

```
<?php

ini_set('display_errors', 1);
error_reporting(E_ALL);

// I blantantly stole, tweaked and happily used this code from: 
// Lord of Ports http://www.experts-exchange.com/M_1736399.html

$ky = 'lkirwf897+22#bbtrm8814z5qq=498j5'; // 32 * 8 = 256 bit key
$iv = '741952hheeyy66#cs!9hjv887mxx7@8y'; // 32 * 8 = 256 bit iv

$text = "Here is my data to encrypt!!!";

$from_vb = "QBlgcQ2+v3wd8RLjhtu07ZBd8aQWjPMfTc/73TPzlyA=";   // enter value from vb.net app here to test

$etext = encryptRJ256($ky, $iv, $text);
$dtext = decryptRJ256($ky, $iv, $etext);
$vtext = decryptRJ256($ky, $iv, $from_vb);

echo "<HR>orignal string: $text";
echo "<HR>encrypted in php: $etext";
echo "<HR>decrypted in php: $dtext";
echo "<HR>encrypted in vb: $from_vb";
echo "<HR>from vb decrypted in php: $vtext"; 
echo "<HR>If you like it say thanks! richard dot varno at gmail dot com";

exit;

function decryptRJ256($key,$iv,$string_to_decrypt)
{
    $string_to_decrypt = base64_decode($string_to_decrypt);
    $rtn = mcrypt_decrypt(MCRYPT_RIJNDAEL_256, $key, $string_to_decrypt, MCRYPT_MODE_CBC, $iv);
    $rtn = rtrim($rtn, "\0\4");
    return($rtn);
}

function encryptRJ256($key,$iv,$string_to_encrypt)
{
    $rtn = mcrypt_encrypt(MCRYPT_RIJNDAEL_256, $key, $string_to_encrypt, MCRYPT_MODE_CBC, $iv);
    $rtn = base64_encode($rtn);
    return($rtn);
}    
?> 
```

### 开始 VB.NET 代码（控制台应用程序）

```
Imports System
Imports System.Text
Imports System.Security.Cryptography
Imports System.IO

Module Module1

    ' I blantantly stole, tweaked and happily used this code from: 
    ' Lord of Ports http://www.experts-exchange.com/M_1736399.html

    Sub Main()

        'Shared 256 bit Key and IV here
        Dim sKy As String = "lkirwf897+22#bbtrm8814z5qq=498j5"  '32 chr shared ascii string (32 * 8 = 256 bit)
        Dim sIV As String = "741952hheeyy66#cs!9hjv887mxx7@8y"  '32 chr shared ascii string (32 * 8 = 256 bit)

        Dim sTextVal As String = "Here is my data to encrypt!!!"

        Dim eText As String
        Dim dText As String

        eText = EncryptRJ256(sKy, sIV, sTextVal)
        dText = DecryptRJ256(sKy, sIV, eText)

        Console.WriteLine("key: " & sKy)
        Console.WriteLine()
        Console.WriteLine(" iv: " & sIV)
        Console.WriteLine("txt: " & sTextVal)
        Console.WriteLine("encrypted: " & eText)
        Console.WriteLine("decrypted: " & dText)
        Console.WriteLine("If you like it say thanks! richard dot varno at gmail dot com")
        Console.WriteLine("press any key to exit")
        Console.ReadKey(True)

    End Sub

    Public Function DecryptRJ256(ByVal prm_key As String, ByVal prm_iv As String, ByVal prm_text_to_decrypt As String)

        Dim sEncryptedString As String = prm_text_to_decrypt

        Dim myRijndael As New RijndaelManaged
        myRijndael.Padding = PaddingMode.Zeros
        myRijndael.Mode = CipherMode.CBC
        myRijndael.KeySize = 256
        myRijndael.BlockSize = 256

        Dim key() As Byte
        Dim IV() As Byte

        key = System.Text.Encoding.ASCII.GetBytes(prm_key)
        IV = System.Text.Encoding.ASCII.GetBytes(prm_iv)

        Dim decryptor As ICryptoTransform = myRijndael.CreateDecryptor(key, IV)

        Dim sEncrypted As Byte() = Convert.FromBase64String(sEncryptedString)

        Dim fromEncrypt() As Byte = New Byte(sEncrypted.Length) {}

        Dim msDecrypt As New MemoryStream(sEncrypted)
        Dim csDecrypt As New CryptoStream(msDecrypt, decryptor, CryptoStreamMode.Read)

        csDecrypt.Read(fromEncrypt, 0, fromEncrypt.Length)

        Return (System.Text.Encoding.ASCII.GetString(fromEncrypt))

    End Function

    Public Function EncryptRJ256(ByVal prm_key As String, ByVal prm_iv As String, ByVal prm_text_to_encrypt As String)

        Dim sToEncrypt As String = prm_text_to_encrypt

        Dim myRijndael As New RijndaelManaged
        myRijndael.Padding = PaddingMode.Zeros
        myRijndael.Mode = CipherMode.CBC
        myRijndael.KeySize = 256
        myRijndael.BlockSize = 256

        Dim encrypted() As Byte
        Dim toEncrypt() As Byte
        Dim key() As Byte
        Dim IV() As Byte

        key = System.Text.Encoding.ASCII.GetBytes(prm_key)
        IV = System.Text.Encoding.ASCII.GetBytes(prm_iv)

        Dim encryptor As ICryptoTransform = myRijndael.CreateEncryptor(key, IV)

        Dim msEncrypt As New MemoryStream()
        Dim csEncrypt As New CryptoStream(msEncrypt, encryptor, CryptoStreamMode.Write)

        toEncrypt = System.Text.Encoding.ASCII.GetBytes(sToEncrypt)

        csEncrypt.Write(toEncrypt, 0, toEncrypt.Length)
        csEncrypt.FlushFinalBlock()

        encrypted = msEncrypt.ToArray()

        Return (Convert.ToBase64String(encrypted))

    End Function

End Module 
```

### BEGIN C# ALTERNATIVE（控制台应用程序）

```
using System;
using System.IO;
using System.Security.Cryptography;
using System.Text;

class Program {
  static void Main(string[] args) {

    //Shared 256 bit Key and IV here
    const string sKy = "lkirwf897+22#bbtrm8814z5qq=498j5"; //32 chr shared ascii string (32 * 8 = 256 bit)
    const string sIV = "741952hheeyy66#cs!9hjv887mxx7@8y"; //32 chr shared ascii string (32 * 8 = 256 bit)

    var sTextVal = "Here is my data to encrypt!!!";

    var eText = EncryptRJ256(sKy, sIV, sTextVal);
    var dText = DecryptRJ256(sKy, sIV, eText);

    Console.WriteLine("key: " + sKy);
    Console.WriteLine();
    Console.WriteLine(" iv: " + sIV);
    Console.WriteLine("txt: " + sTextVal);
    Console.WriteLine("encrypted: " + eText);
    Console.WriteLine("decrypted: " + dText);
    Console.WriteLine("press any key to exit");
    Console.ReadKey(true);
  }

  public static string DecryptRJ256(string prm_key, string prm_iv, string prm_text_to_decrypt) {

    var sEncryptedString = prm_text_to_decrypt;

    var myRijndael = new RijndaelManaged() {
      Padding = PaddingMode.Zeros,
      Mode = CipherMode.CBC,
      KeySize = 256,
      BlockSize = 256
    };

    var key = Encoding.ASCII.GetBytes(prm_key);
    var IV = Encoding.ASCII.GetBytes(prm_iv);

    var decryptor = myRijndael.CreateDecryptor(key, IV);

    var sEncrypted = Convert.FromBase64String(sEncryptedString);

    var fromEncrypt = new byte[sEncrypted.Length];

    var msDecrypt = new MemoryStream(sEncrypted);
    var csDecrypt = new CryptoStream(msDecrypt, decryptor, CryptoStreamMode.Read);

    csDecrypt.Read(fromEncrypt, 0, fromEncrypt.Length);

    return (Encoding.ASCII.GetString(fromEncrypt));
  }

  public static string EncryptRJ256(string prm_key, string prm_iv, string prm_text_to_encrypt) {

    var sToEncrypt = prm_text_to_encrypt;

    var myRijndael = new RijndaelManaged() {
      Padding = PaddingMode.Zeros,
      Mode = CipherMode.CBC,
      KeySize = 256,
      BlockSize = 256
    };

    var key = Encoding.ASCII.GetBytes(prm_key);
    var IV = Encoding.ASCII.GetBytes(prm_iv);

    var encryptor = myRijndael.CreateEncryptor(key, IV);

    var msEncrypt = new MemoryStream();
    var csEncrypt = new CryptoStream(msEncrypt, encryptor, CryptoStreamMode.Write);

    var toEncrypt = Encoding.ASCII.GetBytes(sToEncrypt);

    csEncrypt.Write(toEncrypt, 0, toEncrypt.Length);
    csEncrypt.FlushFinalBlock();

    var encrypted = msEncrypt.ToArray();

    return (Convert.ToBase64String(encrypted));
  }

} 
```

# tfs - 使用 MSBuild 从 TFS 签出

> ID：224460
> 
> 赞同：14
> 
> 时间：2008-10-22T04:07:20.817
> 
> 标签：tfs, msbuild

使用 MSBUILD 从我们的 TFS 签出文件的最简单方法是什么？

从我所看到的情况来看，它是脱壳到 TF.EXE 并手动调用 checkout 命令。真的没有内置命令吗？！

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-22T04:24:20.177

确实没有内置命令。更糟糕的是，tf checkout 命令只接受一个文件规范。

最近发布的[MSBuildExtensionPack](http://www.codeplex.com/MSBuildExtensionPack)有一些用于 TFS 的 msbuild 命令，但没有性能增益。在引擎盖下，他们使用 tf.exe

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-17T17:28:40.267

'itemspec' 可以是空格分隔的项目列表，并且可以使用通配符。

# sql - 将钱存储在小数列中 - 什么精度和规模？

> ID：224462
> 
> 赞同：188
> 
> 时间：2008-10-22T04:08:18.803
> 
> 标签：sql, database, database-design, currency

我正在使用十进制列在数据库中存储货币值，今天我想知道使用什么精度和比例。

由于据说固定宽度的 char 列效率更高，我认为十进制列也是如此。是吗？

我应该使用什么精度和规模？我在想 24/8 精度。这是矫枉过正，不够还是可以？

* * *

这就是我决定做的事情：

*   将转换率（如果适用）存储在交易表本身中，作为浮点数
*   将货币存储在帐户表中
*   交易金额将为`DECIMAL(19,4)`
*   所有使用转换率的计算都将由我的应用程序处理，因此我可以控制舍入问题

我认为转换率的浮点数不是问题，因为它主要用于参考，无论如何我都会将其转换为小数。

谢谢大家的宝贵意见。

* * *

## 回答 #1

> 赞同：207
> 
> 时间：2008-10-22T08:26:49.220

如果您正在寻找一刀切，我建议这`DECIMAL(19, 4)`是一个流行的选择（快速谷歌证实了这一点）。我认为这源于旧的 VBA/Access/Jet Currency 数据类型，是该语言中第一个定点十进制类型；`Decimal`仅在 VB6/VBA6/Jet 4.0 中以“1.0 版”样式出现（即未完全实现）。

*存储*定点十进制值的经验法则是存储至少比实际需要的小数位允许舍入。`Currency`将前端的旧类型映射到后端的类型的原因之一`DECIMAL(19, 4)`是`Currency`表现出银行家的四舍五入性质，而`DECIMAL(p, s)`截断四舍五入。

存储中的额外小数位`DECIMAL`允许实现自定义舍入算法，而不是采用供应商的默认值（至少可以说，对于期望所有以 0.5 结尾的值从零舍入的设计人员来说，银行家的舍入令人担忧） .

是的，`DECIMAL(24, 8)`对我来说听起来有点矫枉过正。大多数货币的报价精确到小数点后四位或五位。我知道需要小数位数 8（或更多）的*情况*，但这是按比例分配“正常”货币金额（例如小数点后四位）的情况，这意味着小数精度应相应降低（也考虑这种情况下的浮点类型）。现在没有人有那么多钱来要求小数精度为 24 :)

然而，一些研究可能是有序的，而不是一刀切的方法。向您的设计师或领域专家询问可能适用的会计规则：GAAP、欧盟等。我模糊地回忆起一些欧盟国家内转移，其中明确规定了四舍五入到小数点后五位，因此`DECIMAL(p, 6)`用于存储。会计师通常似乎偏爱小数点后四位。

* * *

PS 避免使用 SQL Server 的`MONEY`数据类型，因为它在舍入时存在严重的准确性问题，以及可移植性等其他考虑因素。请参阅[Aaron Bertrand 的博客](https://sqlblog.org/2008/04/27/performance-storage-comparisons-money-vs-decimal)。

* * *

微软和语言设计师选择了银行家的四舍五入，因为硬件设计师选择了它[引文？]。例如，它被载入电气和电子工程师协会 (IEEE) 标准。硬件设计师之所以选择它，是因为数学家更喜欢它。见[维基百科](http://en.wikipedia.org/wiki/Rounding#History)；释义：1906 年版的《概率与错误理论》将此称为“计算机规则”（“计算机”是指执行计算的人）。

* * *

## 回答 #2

> 赞同：114
> 
> 时间：2008-10-22T12:47:39.380

我们最近实施了一个系统，需要处理多种货币的价值并在它们之间进行转换，并通过艰难的方式解决了一些问题。

**永远不要使用浮点数来赚钱**

浮点算术引入了一些不准确性，直到他们把事情搞砸了才会被注意到。所有值都应存储为整数或固定十进制类型，如果您选择使用固定十进制类型，请确保您准确了解该类型在后台的作用（即，它在内部使用整数还是浮点类型）。

当您确实需要进行计算或转换时：

1.  将值转换为浮点数
2.  计算新值
3.  将数字四舍五入并将其转换回整数

在步骤 3 中将浮点数转换回整数时，不要只转换它 - 首先使用数学函数对其进行舍入。这通常是`round`，尽管在特殊情况下可能是`floor`或`ceil`。了解差异并谨慎选择。

**将数字的类型与值一起存储**

如果您只处理一种货币，这对您来说可能不那么重要，但它对我们处理多种货币很重要。我们使用 3 字符代码来表示货币，例如 USD、GBP、JPY、EUR 等。

根据情况，存储：

*   这个数字是税前还是税后（以及税率是多少）
*   数字是否是转换的结果（以及它是从什么转换而来的）

**了解您正在处理的数字的准确度范围**

对于实际值，您希望与货币的最小单位一样精确。这意味着您没有小于一美分、一分钱、一日元、一分等的值。不要无缘无故地存储比这更准确的值。

在内部，您可以选择处理较小的值，在这种情况下，这是一种*不同类型的货币值*。确保您的代码知道哪个是哪个，并且不会混淆它们。即使在这里也避免使用浮点值。

* * *

将所有这些规则加在一起，我们决定了以下规则。在运行代码中，货币使用整数作为最小单位进行存储。

```
class Currency {
   String code;       //  eg "USD"
   int value;         //  eg 2500
   boolean converted;
}

class Price {
   Currency grossValue;
   Currency netValue;
   Tax taxRate;
} 
```

在数据库中，值以以下格式存储为字符串：

```
USD:2500 
```

这存储了 25.00 美元的价值。我们能够做到这一点只是因为处理货币的代码不需要在数据库层本身中，因此所有值都可以首先转换到内存中。毫无疑问，其他情况也适用于其他解决方案。

* * *

如果我之前没有说清楚，**请不要使用浮动！**

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2014-05-25T13:34:50.443

在 MySQL 中处理货币时，如果您知道货币值的精度，请使用 DECIMAL(13,2)，如果您只想快速获得足够好的近似值，请使用 DOUBLE。因此，如果您的应用程序需要处理高达一万亿美元（或欧元或英镑）的货币价值，那么这应该可行：

```
DECIMAL(13, 2) 
```

或者，如果您需要遵守[GAAP](http://www.fasab.gov/accounting-standards/) ，请使用：

```
DECIMAL(13, 4) 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-22T08:56:06.040

4 位小数可以让您准确地存储世界上最小的货币子单位。如果您需要小额支付（纳米支付？！）的准确性，您可以进一步降低它。

我也更喜欢`DECIMAL`DBMS 特定的货币类型，在应用程序 IMO 中保留这种逻辑会更安全。沿着相同思路的另一种方法是简单地使用 [long] 整数，并在应用程序级别完成格式化为 ¤unit.subunit 以提高人类可读性（¤ = 货币符号）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-22T04:10:49.827

SQL Server 上的货币数据类型在小数点后有四位数字。

来自 SQL Server 2000 联机丛书：

货币数据代表正数或负数的货币量。在 Microsoft® SQL Server™ 2000 中，货币数据使用 money 和 smallmoney 数据类型进行存储。货币数据可以精确到小数点后四位。使用 money 数据类型来存储从 -922,337,203,685,477.5808 到 +922,337,203,685,477.5807 范围内的值（需要 8 个字节来存储一个值）。使用 smallmoney 数据类型存储范围从 -214,748.3648 到 214,748.3647 的值（需要 4 个字节来存储一个值）。如果需要更多的小数位数，请改用小数数据类型。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-22T06:05:43.933

如果您使用的是 IBM Informix Dynamic Server，您将拥有一个 MONEY 类型，它是 DECIMAL 或 NUMERIC 类型的次要变体。它始终是定点类型（而 DECIMAL 可以是浮点类型）。您可以指定从 1 到 32 的比例，以及从 0 到 32 的精度（默认为 16 的比例和 2 的精度）。因此，根据您需要存储的内容，您可以使用 DECIMAL(16,2) - 仍然足够大以将美国联邦赤字保持到最接近的美分 - 或者您可以使用更小范围或更多小数位。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-22T06:11:10.583

有时您需要花费不到一分钱，并且有些国际货币使用非常大的恶魔。例如，您可能会向您的客户收取每笔交易 0.088 美分的费用。在我的 Oracle 数据库中，列定义为 NUMBER(20,4)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-22T11:34:07.000

如果您要在数据库中进行任何类型的算术运算（乘以计费率等），您可能需要比这里的人建议的更精确，原因与您永远不会希望在应用程序代码中使用小于双精度浮点值的任何值。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-22T06:16:16.893

我认为在很大程度上，您或您的客户的要求应该决定使用什么精度和规模。例如，对于我正在开发的仅处理英镑货币的电子商务网站，我被要求将其保留为 Decimal(6, 2)。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2015-08-24T12:54:16.390

这里的答案很晚，但我用过

```
DECIMAL(13,2) 
```

我的想法是正确的，应该允许最多 99,999,999,999.99。

# syntax - 避免语言细节混淆

> ID：224466
> 
> 赞同：2
> 
> 时间：2008-10-22T04:11:20.560
> 
> 标签：syntax

今天有人问我他们的源代码有什么问题。这很明显。“在 if 语句中使用双等号代替单等号。嗯，我认为......” 我记得有些语言实际上使用单等号进行比较。由于我有时会忘记或混淆我使用的几种语言的语法细节，所以我走到我的笔记本电脑前尝试了一个快速实验。

尝试“快速”实验会花费一些时间，并且会中断流程（尽管这种做法可能对记忆有好处。）你有什么技巧可以让你牢记多个语法（和其他）细节语言？

（如今，这同样适用于许多类似 wiki 的标记！）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-22T07:41:38.437

对我来说，最难的部分不是语法——通常你在查看正在处理的代码时会进入模式。真正困难的部分是记住语言的库，这样你就不会一遍又一遍地发明轮子。现在，如果只有人们会组织他们的帮助文件，那么在图书馆中搜索特定的东西就很容易了。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-22T04:18:39.000

就我而言，这只是经验。我认为，一旦你用一种语言编码足够长的时间，你的大脑似乎就能够用它进行语言上下文切换。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-22T04:34:30.733

可以绘制红色和黄色曲线的 IDE 可以提供帮助，直到您开发出这种心理肌肉记忆。

XCode（对于 Cocoa/ObjectiveC）令人讨厌的事情之一是，在编译之前你不会得到所说的曲线。（与您获得实时曲线的 Eclipse/Java 不同）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-22T06:21:57.380

事实上，在 SO 我建议不要忘记`if (a = b)`在 Java 中避免，有人提醒我只有当 a 和 b 是布尔值时它才是合法的！当然，该建议适用于 C、C++、JavaScript 和许多其他类似 C 的语言。

同样，我最近才意识到`var v`JavaScript 中只有函数级范围，而不是大括号级范围。

不知何故，这就是语法相似但行为不同的陷阱。

对于轶事，Lua 邮件列表中的一些人抱怨说这种语言不像 C 语言，它具有简洁而熟悉的花括号、+= 和 ++、位运算符。他们说这会损害该语言的采用，因为人们更熟悉类似 C 的语法。

这是无意义的，Basic 曾经（现在仍然）以其冗长的语法被广泛使用。Pascal 也是如此（Delphià。很多人发现 Lua 语法可读且易于学习，非常适合那些不熟悉编程的人（例如游戏 AI 专家）。

此外，明确地说，Lua 旨在与 C/C++ 程序集成并使用 C[++] 函数进行扩展。人们说完全不同的语法有助于思维方式的转变。

# c# - 我怎样才能使 WebTest 失败？

> ID：224467
> 
> 赞同：10
> 
> 时间：2008-10-22T04:11:24.943
> 
> 标签：c#, unit-testing, mstest, webtest

我正在使用 Microsoft WebTest 并希望能够做类似于 NUnit 的`Assert.Fail()`. 我想出的最好的方法是，`throw new webTestException()`但这在测试结果中显示为 a`Error`而不是 a `Failure`。

除了反映`WebTest`设置私有成员变量来指示失败之外，还有什么我错过的吗？

编辑：我也使用了该`Assert.Fail()`方法，但是当从 WebTest 中使用时，这仍然显示为错误而不是失败，并且该`Outcome`属性是只读的（没有公共设置器）。

编辑：现在我真的很难过。我使用反射将`Outcome`属性设置为失败，但测试*仍然*通过！

这是将 Oucome 设置为失败的代码：

```
public static class WebTestExtensions
{
    public static void Fail(this WebTest test)
    {
        var method = test.GetType().GetMethod("set_Outcome", BindingFlags.NonPublic | BindingFlags.Instance);
        method.Invoke(test, new object[] {Outcome.Fail});
    }
} 
```

这是我试图失败的代码：

```
 public override IEnumerator<WebTestRequest> GetRequestEnumerator()
    {
        this.Fail();
        yield return new WebTestRequest("http://google.com");
    } 
```

`Outcome`正在设置，`Oucome.Fail`但显然 WebTest 框架并没有真正使用它来确定测试通过/失败结果。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-22T04:15:15.107

将[Outcome 属性](http://msdn.microsoft.com/en-us/library/microsoft.visualstudio.testtools.webtesting.webtest.outcome.aspx)设置为*Fail*：

```
Outcome = Outcome.Fail; 
```

*Microsoft.VisualStudio.QualityTools.UnitTestFramework*程序[`Assert.Fail()`](http://msdn.microsoft.com/en-us/library/microsoft.visualstudio.testtools.unittesting.assert.fail.aspx)集中还有一个。

 ** * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-05-06T14:53:16.030

您可以通过添加始终失败的验证规则来使测试始终失败。例如，您可以像这样编写失败验证规则：

```
public class FailValidationRule : ValidationRule
{
    public override void Validate(object sender, ValidationEventArgs e)
    {
        e.IsValid = false;
    }
} 
```

然后将新的验证规则附加到您的 webtest 的 ValidateResponse 事件中，如下所示：

```
public class CodedWebTest : WebTest
{
    public override IEnumerator<WebTestRequest> GetRequestEnumerator()
    {
        WebTestRequest request1 = new WebTestRequest("http://www.google.com");
        FailValidationRule failValidation = new FailValidationRule();
        request1.ValidateResponse += new EventHandler<ValidationEventArgs>(failValidation.Validate);
        yield return request1;
    }
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-05-09T05:52:56.967

适用于声明性测试（以及编码）的解决方案是：

*   编写一个验证规则，当上下文中存在某个上下文参数（例如'FAIL'）时失败
*   当你想触发失败时，设置上下文参数并调用 WebTest.Stop()
*   将验证规则添加为 WebTest 级别规则（不是请求级别），以便它在所有请求上运行

我认为这是可以做到的尽可能简洁。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-25T06:25:17.163

Outcome 属性将在 vsts 2010 上公开 :-)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2013-06-10T15:39:35.037

首先，我正在使用 VB.net，但我也尝试将结果设置为失败，然后才发现它不起作用（这让我来到了这里）。

我终于设法通过抛出异常来做到这一点：

```
Public Overrides Sub PostRequest(ByVal sender As Object, ByVal e As PostRequestEventArgs)

    If YourTest = True Then

        Throw New WebTestException("My test Failed")

    End If

    MyBase.PostRequest(sender, e)

  End Sub 
```

我知道这个话题很老，但我希望它对某人有所帮助:)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-05-07T20:17:56.600

在 PostWebTest 事件处理程序中设置 Outcome 的值。

# javascript - iframe shimming 或 ie6（及以下）选择 z-index 错误

> ID：224471
> 
> 赞同：14
> 
> 时间：2008-10-22T04:15:12.127
> 
> 标签：javascript, internet-explorer-6, shim

嗯，我不确定是否有人遇到过这个问题
，简要说明是在 IE6 上，任何`<select>`对象都会显示在任何其他项目上，甚至是 div 的......这意味着如果你有一个花哨的 javascript 效果来显示一个应该在顶部的 div一切（例如：灯箱，多框等） onclick 某个元素并且该 div 与`<select>`您的 div 重叠显示，就好像它在`<select>`[在这种情况下，最大和最小 z-index 不起作用]

我试过谷歌搜索并找到了 iframe shim 解决方案
，但我想要一些非常干净的替代方案或更好的替代方案，但有人找到更好的解决方案吗？因为使用 iframe 的方法使用大约 130mb 的内存可能会减慢穷人的机器

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-22T08:01:35.463

您不必隐藏每个`select`使用循环。您所需要的只是一个 CSS 规则，例如：

```
* html .hideSelects select { visibility: hidden; } 
```

以及以下 JavaScript：

```
//hide:
document.body.className +=' hideSelects'

//show:
document.body.className = document.body.className.replace(' hideSelects', ''); 
```

（或者，你可以使用你最喜欢的`addClass`/`removeClass`实现）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-22T06:04:10.740

有一个名为[bgiframe](http://plugins.jquery.com/project/bgiframe)的 jquery 插件，它使 iframe 方法很容易实现。

就个人而言，作为一名 Web 开发人员，我已经到了不再关心 IE6 中的用户体验的地步。我会让它尽可能接近“正确”，并确保它可以正常工作，但就速度而言，太糟糕了。他们可以升级。IE7（虽然仍然很慢，与其他所有浏览器相比）已经推出了 2 年（几乎到今天！）。IE8 即将推出。Firefox 适用于所有平台。Safari 也是一种选择（而且速度非常快）。Opera 适用于大多数/每个平台。

IE6 于 7 年前发布。恕我直言，除了懒惰的用户和不称职的 IT 部门（或者如果您是 Web 开发人员），没有理由继续使用它。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-21T21:21:47.770

如果有人感兴趣，这里有一些 IE 匀场代码。

```
* html .shimmed {
    _azimuth: expression(
        this.shimmed = this.shimmed || 'shimmed:'+this.insertAdjacentHTML('beforeBegin','<iframe style="filter:progid:DXImageTransform.Microsoft.Alpha(style=0,opacity=0);position:absolute;top:0px;left:0px;width:100%;height:100%" frameBorder=0 scrolling=no src="javascript:false;document.write('+"''"+');"></iframe>'),
        'inherit');
} 
```

参考：[这个要点微妙渐变和](http://gist.github.com/7372)[扎克莱瑟曼](http://subtlegradient.com/articles/category/css)的这篇[文章](http://www.zachleat.com/web/2007/04/24/adventures-in-i-frame-shims-or-how-i-learned-to-love-the-bomb/)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-22T05:35:16.053

在 IE7 之前，下拉列表是一个“窗口”控件，这意味着它直接由 Windows 呈现为控件，而不是由浏览器合成它。因此，它不可能支持针对其他合成控件的 z 索引。

为了出现在 DDL 上，您必须使用另一个窗口控件，例如 IFRAME。您还可以使用一个鲜为人知的仅 IE 功能，称为 window.createPopup()，它本质上是一个无铬弹出窗口。它有一些限制，例如不可阻挡的点击，但如果您正在构建悬停菜单系统，它们实际上会有所帮助。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-11-17T20:27:16.067

解决这个烦人的 IE 错误的最简单和最优雅的解决方案位于：[http](http://docs.jquery.com/Plugins/bgiframe) ://docs.jquery.com/Plugins/bgiframe using jQuery。

在尝试了 2 天以使其与 WebSphere Portal / Portal Applications 一起工作后，我得出了这个结论，其中一切都是动态的，包括飞越菜单。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-21T18:45:52.293

还有我开始探索的 activex 方法。它需要创建条件代码来使用activex 控件而不是ie6 的选择框。有一个[演示脚本](http://www.hedgerwow.com/360/bugs/activex-listbox/demo.php)展示了该技术，[此处将对此进行更详细的讨论](http://www.devguru.com/features/tutorials/ComboControl/combocontrol.html)。

更新：似乎需要 MS Office 才能将 active-x 控件放在用户的机器上。从理论上讲，有可能以某种方式将其包含在某个地方，但这变得更加混乱。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2011-03-08T17:27:53.367

我知道很多人提出了他们自己的提示，但就我而言，我只是简单地使用 jquery 隐藏选择，如下所示。

```
$(':date').dateinput({
    format: 'dd/mm/yyyy',
    onBeforeShow: function(event) {
        $('select').hide();
    },
    onHide: function(event) {
        $('select').show();
    }
}); 
```

# java - 没有为 JBoss 应用程序找到合适的 MySQL 驱动程序

> ID：224473
> 
> 赞同：3
> 
> 时间：2008-10-22T04:16:34.513
> 
> 标签：java, mysql, eclipse, hibernate, jboss

我是创建 Java Web 应用程序的新手，在尝试通过我的应用程序与我的数据库（称为 ccdb）交互时遇到了这个问题：

`java.sql.SQLException: No suitable driver found for jdbc:mysql://localhost/ccdb/`

我的应用程序在 JBoss 上运行并使用 Hibernate 与 MySQL 数据库交互。我在项目的 lib\mysql-connector-java-5.1.6-bin.jar 中有 MySQL 驱动程序，并且在 Eclipse 中将 .jar 配置为“Java EE 模块依赖项”，以便将其复制到 web- inf\lib\ 当我通过 Eclipse 将它部署到 JBoss 时。我仔细检查了一下，驱动程序肯定在项目的 .war 文件中，所以应该可以找到，对吧？

我的 hibernate.cfg.xml 包含应该将休眠指向驱动程序的这一行。

`<property name="hibernate.connection.driver_class">com.mysql.jdbc.Driver</property>`

有谁知道我需要做什么才能让它工作？我是否必须将 MySQL 数据库配置为 JBoss 数据源才能正常工作？

提前致谢。

编辑：kauppi 的解决方案有效，但我更愿意将它与其他罐子放在 lib\ 中，我真的很好奇为什么它不能那样工作。有任何想法吗...？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-22T05:27:17.973

可能有更好的方法，但我通常将 MySQL 连接器 JAR 复制到 jboss\server\default\lib（假设您使用的是默认配置）。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-28T00:39:32.020

将外部库放在 lib 文件夹中是一种不好的做法。

您需要编辑文件：

server/${servername}/conf/jboss-service.xml 并添加

```
<classpath codebase="${jboss.server.lib.url:lib}ext" archives="*"/> 
```

紧随其后

```
<classpath codebase="${jboss.server.lib.url:lib}" archives="*"/> 
```

然后创建一个名为：server/${servername}/lib/ext 的目录

把你的外部罐子放在那里。

# .net - 如何让网络服务在.net中序列化/反序列化相同类型

> ID：224474
> 
> 赞同：1
> 
> 时间：2008-10-22T04:16:50.987
> 
> 标签：.net, web-services, visual-studio-2005

我想在 Web 方法中使用类型化参数。但是，当 Visual Studio 2005 为客户端创建 Web 引用时，它会自动创建自己的类型。我正在使用 .net Web 服务和 .net 客户端。

例如：

<WebMethod> _ Public Function Foo() as ServerNamespace.Bar ... End Function

在客户端，该方法变为 WebServiceInstance.Foo() 作为 ClientNamespace.Webservice.Bar

返回不同的类型。

我开始编写自己的序列化助手类来转换类型，但我本以为会有更好的方法......

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-22T04:30:21.800

如果您可以升级到 .Net 3.0，我建议您将客户端代理切换到 WCF。Svcutil.exe 是从 Web 服务生成 WCF 客户端代理的工具；它有一个选项 /reference，它接受一个程序集并重用其中的任何共享类型。（如果它在您的控制之下，我还建议将服务切换到 WCF :-)）

如果您无法升级，wsdl.exe 有一个选项 /sharetypes 可能会对您有所帮助，尽管我不确定如何准确地做到这一点。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-22T04:20:16.067

我之前问过同样的问题，所以我得到的答案可能会有所帮助：

[强制 .NET webservice 使用本地对象类，而不是代理类](https://stackoverflow.com/questions/216884/force-net-webservice-to-use-local-object-class-not-proxy-class)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-22T05:15:29.760

这里也有一个很好的答案：[.NET SOAP Common types](https://stackoverflow.com/questions/127395/net-soap-common-types)

基本上，您不*应该*在服务器和客户端之间共享数据结构。但如果你真的想缝有可能。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-07T04:08:45.943

我已经升级到 VS 2008 和 WCF。我仍然发现解决方案是半生不熟的。共享类型似乎可以正常工作，只要它们不是类型化的集合，它们会转换为数组或 List(Of T)。

我真的不明白在同一个对象类型、集合或其他对象之间进行序列化有什么难的。

很多人从代码项目[（文章）中引用了这篇文章](http://www.codeproject.com/KB/WCF/WCFCollectionTypeSharing.aspx)

这适用于某些对象，但对于我的数据对象会生成以下警告（如果我强制它使用 DataContractSerializer）：

> [警告：未处理命名空间“ http://schem](http://schem) as.xmlsoap.org/wsdl/soap12/”中的可选 WSDL 扩展元素“body” 。XPath : [//wsdl:definitions[@targetNamespace='http://tempuri.org/']/wsdl:binding[@name='WSHttpBinding_IService']/wsdl:operation[@name='GetData']/wsdl:output](http://tempuri.org/)

我找不到任何有意义的东西可以帮助我调试它。

# sql-server - 是否可以将全文搜索 (FTS) 与 LINQ 一起使用？

> ID：224475
> 
> 赞同：76
> 
> 时间：2008-10-22T04:16:55.823
> 
> 标签：sql-server, linq, full-text-search

我想知道是否可以使用 .NET Framework 3.5 将 FTS 与 LINQ 一起使用。我正在搜索尚未发现任何有用的文档。

有没有人有这方面的经验？

* * *

## 回答 #1

> 赞同：78
> 
> 时间：2008-12-22T08:52:48.950

是的。但是，您必须首先创建 SQL 服务器函数并调用它，因为默认情况下 LINQ 将使用 like。

这篇[博](http://sqlblogcasts.com/blogs/simons/archive/2008/12/18/LINQ-to-SQL---Enabling-Fulltext-searching.aspx)文将解释细节，但这是摘录：

> 要使其正常工作，您需要创建一个表值函数，该函数仅根据您传入的关键字执行 CONTAINSTABLE 查询，
> 
> ```
> create function udf_sessionSearch
>       (@keywords nvarchar(4000))
> returns table
> as
>   return (select [SessionId],[rank]
>             from containstable(Session,(description,title),@keywords)) 
> ```
> 
> 然后，您将此函数添加到您的 LINQ 2 SQL 模型中，然后您现在可以编写类似的查询。
> 
> ```
>  var sessList = from s   in DB.Sessions
>                    join fts in DB.udf_sessionSearch(SearchText) 
>                    on s.sessionId equals fts.SessionId
>                  select s; 
> ```

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-10-22T21:45:11.260

不可以。LINQ To SQL 不支持全文搜索。

也就是说，您*可以*使用利用 FTS 的存储过程，并让 LINQ To SQL 查询从中提取数据。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2010-11-19T06:54:28.590

如果您不想创建连接并想简化 C# 代码，您可以创建 SQL 函数并在“from”子句中使用它：

```
CREATE FUNCTION ad_Search
(
      @keyword nvarchar(4000)
)
RETURNS TABLE
AS
RETURN
(
      select * from Ad where 
      (CONTAINS(Description, @keyword) OR CONTAINS(Title, @keyword))
) 
```

更新 DBML 后，在 linq 中使用它：

```
string searchKeyword = "word and subword";
var result = from ad in context.ad_Search(searchKeyword)
                 select ad; 
```

这将产生简单的 SQL，如下所示：

```
SELECT [t0].ID, [t0].Title, [t0].Description
FROM [dbo].[ad_Search](@p0) AS [t0] 
```

正如您从 ad_Search 函数实现中看到的那样，这适用于多列搜索。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2008-10-22T04:22:30.477

我不相信。您可以在字段上使用“包含”，但它只会生成`LIKE`查询。如果您想使用全文，我建议您使用存储过程进行查询，然后将其传递回 LINQ

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-10-22T21:42:47.317

不，全文搜索是 sql server 特有的（其中文本由单词索引，查询命中该索引而不是遍历字符数组）。Linq 不支持这一点，任何 .Contains() 调用都会命中非托管字符串函数，但不会从索引中受益。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-07-31T11:31:20.350

我制作了一个工作原型，仅用于 SQL Server 的*CONTAINS*，没有通配符列。它实现的是让您像使用普通 LINQ 函数一样使用*CONTAINS ：*

```
var query = context.CreateObjectSet<MyFile>()
    .Where(file => file.FileName.Contains("pdf")
        && FullTextFunctions.ContainsBinary(file.FileTable_Ref.file_stream, "Hello")); 
```

### 你会需要：

1.代码和EDMX中的函数定义支持*CONTAINS*关键字。

2.通过EFProviderWrapperToolkit/EFTracingProvider重写EF SQL，因为CONTAINS不是函数，默认生成的SQL将其结果视为*bit*。

### 但：

1.Contains 并不是一个真正的函数，您不能从中选择布尔结果。它只能在条件下使用。

2.如果查询包含带有特殊字符的非参数化字符串，下面的SQL重写代码可能会中断。

## 我的原型的来源

### 函数定义：（EDMX）

在 edmx:StorageModels/Schema 下

```
<Function Name="conTAINs" BuiltIn="true" IsComposable="true" ParameterTypeSemantics="AllowImplicitConversion" ReturnType="bit" Schema="dbo">
    <Parameter Name="dataColumn" Type="varbinary" Mode="In" />
    <Parameter Name="keywords" Type="nvarchar" Mode="In" />
</Function>
<Function Name="conTAInS" BuiltIn="true" IsComposable="true" ParameterTypeSemantics="AllowImplicitConversion" ReturnType="bit" Schema="dbo">
    <Parameter Name="textColumn" Type="nvarchar" Mode="In" />
    <Parameter Name="keywords" Type="nvarchar" Mode="In" />
</Function> 
```

PS：chars 的奇怪情况用于启用具有不同参数类型（varbinary 和 nvarchar）的相同功能

### 函数定义：（代码）

```
using System.Data.Objects.DataClasses;

public static class FullTextFunctions
{
    [EdmFunction("MyModel.Store", "conTAINs")]
    public static bool ContainsBinary(byte[] dataColumn, string keywords)
    {
        throw new System.NotSupportedException("Direct calls are not supported.");
    }

    [EdmFunction("MyModel.Store", "conTAInS")]
    public static bool ContainsString(string textColumn, string keywords)
    {
        throw new System.NotSupportedException("Direct calls are not supported.");
    }
} 
```

PS：*“MyModel.Store”*与 edmx:StorageModels/Schema/@Namespace 中的值相同

### 重写 EF SQL：（通过 EFProviderWrapperToolkit）

```
using EFProviderWrapperToolkit;
using EFTracingProvider;

public class TracedMyDataContext : MyDataContext
{
    public TracedMyDataContext()
        : base(EntityConnectionWrapperUtils.CreateEntityConnectionWithWrappers(
            "name=MyDataContext", "EFTracingProvider"))
    {
        var tracingConnection = (EFTracingConnection) ((EntityConnection) Connection).StoreConnection;
        tracingConnection.CommandExecuting += TracedMyDataContext_CommandExecuting;
    }

    protected static void TracedMyDataContext_CommandExecuting(object sender, CommandExecutionEventArgs e)
    {
        e.Command.CommandText = FixFullTextContainsBinary(e.Command.CommandText);
        e.Command.CommandText = FixFullTextContainsString(e.Command.CommandText);
    }

    private static string FixFullTextContainsBinary(string commandText, int startIndex = 0)
    {
        var patternBeg = "(conTAINs(";
        var patternEnd = ")) = 1";
        var exprBeg = commandText.IndexOf(patternBeg, startIndex, StringComparison.Ordinal);
        if (exprBeg == -1)
            return commandText;
        var exprEnd = FindEnd(commandText, exprBeg + patternBeg.Length, ')');
        if (commandText.Substring(exprEnd).StartsWith(patternEnd))
        {
            var newCommandText = commandText.Substring(0, exprEnd + 2) + commandText.Substring(exprEnd + patternEnd.Length);
            return FixFullTextContainsBinary(newCommandText, exprEnd + 2);
        }
        return commandText;
    }

    private static string FixFullTextContainsString(string commandText, int startIndex = 0)
    {
        var patternBeg = "(conTAInS(";
        var patternEnd = ")) = 1";
        var exprBeg = commandText.IndexOf(patternBeg, startIndex, StringComparison.Ordinal);
        if (exprBeg == -1)
            return commandText;
        var exprEnd = FindEnd(commandText, exprBeg + patternBeg.Length, ')');
        if (exprEnd != -1 && commandText.Substring(exprEnd).StartsWith(patternEnd))
        {
            var newCommandText = commandText.Substring(0, exprEnd + 2) + commandText.Substring(exprEnd + patternEnd.Length);
            return FixFullTextContainsString(newCommandText, exprEnd + 2);
        }
        return commandText;
    }

    private static int FindEnd(string commandText, int startIndex, char endChar)
    {
        // TODO: handle escape chars between parens/squares/quotes
        var lvlParan = 0;
        var lvlSquare = 0;
        var lvlQuoteS = 0;
        var lvlQuoteD = 0;
        for (var i = startIndex; i < commandText.Length; i++)
        {
            var c = commandText[i];
            if (c == endChar && lvlParan == 0 && lvlSquare == 0
                && (lvlQuoteS % 2) == 0 && (lvlQuoteD % 2) == 0)
                return i;
            switch (c)
            {
                case '(':
                    ++lvlParan;
                    break;
                case ')':
                    --lvlParan;
                    break;
                case '[':
                    ++lvlSquare;
                    break;
                case ']':
                    --lvlSquare;
                    break;
                case '\'':
                    ++lvlQuoteS;
                    break;
                case '"':
                    ++lvlQuoteD;
                    break;
            }
        }
        return -1;
    }
} 
```

### 启用 EFProviderWrapperToolkit：

如果你通过 nuget 获得它，它应该将这些行添加到你的 app.config 或 web.config 中：

```
<system.data>
    <DbProviderFactories>
        <add name="EFTracingProvider" invariant="EFTracingProvider" description="Tracing Provider Wrapper" type="EFTracingProvider.EFTracingProviderFactory, EFTracingProvider, Version=1.0.0.0, Culture=neutral, PublicKeyToken=def642f226e0e59b" />
        <add name="EFProviderWrapper" invariant="EFProviderWrapper" description="Generic Provider Wrapper" type="EFProviderWrapperToolkit.EFProviderWrapperFactory, EFProviderWrapperToolkit, Version=1.0.0.0, Culture=neutral, PublicKeyToken=def642f226e0e59b" />
    </DbProviderFactories>
</system.data> 
```

# java - 创建自定义 Hibernate UserType - isMutable() 是什么意思？

> ID：224481
> 
> 赞同：9
> 
> 时间：2008-10-22T04:21:10.993
> 
> 标签：java, hibernate, orm

我正在为一个项目在 Hibernate 中创建一个自定义 UserType。在我使用 isMutable 方法之前，它一直相对简单。我试图弄清楚这种方法在合同方面意味着什么。

这是否意味着我正在为其创建 UserType 的类是不可变的，还是意味着持有对此类实例的引用的对象永远不会指向不同的实例？

[我在Hibernate Community Wiki](http://www.hibernate.org/37.html)中找到了一些返回 true 的示例，因为对象本身是可变的 - [http://www.hibernate.org/73.html](http://www.hibernate.org/73.html)。

社区 wiki 中的其他示例返回 false 并没有说明原因，即使它们也是可变的。

我检查了JavaDoc，但也不是很清楚。

[来自UserType](http://www.hibernate.org/hib_docs/v3/api/org/hibernate/usertype/UserType.html)的 JavaDoc ：

```
public boolean isMutable()
    Are objects of this type mutable?
    Returns:
        boolean 
```

来自 JavaDoc 的[Type](http://www.hibernate.org/hib_docs/v3/api/org/hibernate/type/Type.html)：

```
public boolean isMutable()
    Are objects of this type mutable. (With respect to the referencing
    object ... entities and collections are considered immutable because
    they manage their own internal state.)
    Returns:
        boolean 
```

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-11-23T13:13:28.930

Hibernate will treat types marked as "mutable" as though they could change (i.e. require an UPDATE) *without* pointing to a new reference. If you assign a new reference to a Hibernate-loaded property Hibernate will recognize this even if the type is immutable - this happens all the time with, for instance, String fields. But if, say, you have a StringBuilder field and you mark it as *immutable* Hibernate will **not** notice if you modify the StringBuilder.

See [this blog post](http://blog.xebia.com/2009/11/09/understanding-and-writing-hibernate-user-types/) for more details and a sample project.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-22T08:31:37.010

这里的典型示例是 String 类 - 它是不可变的，即一旦创建了字符串，您就无法更改其内容或状态，如果您愿意，您将不得不将其处理成一个新副本。

isMutable 返回 true 意味着您说这个对象可以通过外部对象更改其状态，返回 false 意味着您必须将此对象复制到一个新实例，以便在此过程中对状态进行更改。或者正如您所说：“这是否意味着持有对此类实例的引用的对象永远不会指向不同的实例”。

# c# - 为什么我的 ASP.NET MVC 路由中有查询字符串？

> ID：224484
> 
> 赞同：9
> 
> 时间：2008-10-22T04:23:17.680
> 
> 标签：c#, asp.net, asp.net-mvc, routing

在我正在开发的 ASP.NET MVC (Beta) 站点上，有时对 ActionLink 的调用会返回给我包含查询字符串的 URL。我已经隔离了产生这种行为的情况，但我仍然不明白为什么它决定使用查询字符串参数，而不是产生一个干净的 URL。我知道它们在功能上是相同的，但是为了 URL 的一致性（和外观），这不是我想要的。

这是我的路线：

```
routes.MapRoute(
    "Photo Gallery Shortcut",
    "group/{groupname}",
    new { controller = "Photos", action = "All", Id = "" });

routes.MapRoute(
    "Tagged Photos", //since the Tagged action takes an extra parameter, put it first
    "group/{groupname}/Photos/Tagged/{tagname}/{sortby}",
    new { controller = "Photos", action = "Tagged", Id = "", SortBy = "" });

routes.MapRoute(
    "Photo Gallery", //since the Gallery's defualt action is "All" not "Index" its listed seperatly
    "group/{groupname}/Photos/{action}/{sortby}",
    new { controller = "Photos", action = "All", Id = "", SortBy = "" });

routes.MapRoute(
    "Group",  //<-- "Group" Category defined above
    "group/{groupname}/{controller}/{action}/{id}",
    new {controller = "Photos", action = "Index", Id = ""}); 
```

现在问题只发生在我查看名为“标记照片”的路线描述的视图并通过以下方式执行 ActionLink 时：

```
Html.ActionLink<PhotosController>(p => p.All((string)ViewData["group"], ""), "Home") 
```

这会产生 URL：

```
http://domain/group/GROUPNAME?sortBy= 
```

从任何其他角度来看，生成的 URL 是：

```
http://domain/group/GROUPNAME 
```

我已经取消了 Phil 的[ASP.NET Routing Debugger](http://haacked.com/archive/2008/03/13/url-routing-debugger.aspx)，一切都按顺序显示。这个让我难住了。有任何想法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-22T06:58:48.757

不确定为什么不同的视图会产生不同的 URL。

但是您可以通过为第一条路由分配默认值来摆脱该 sortBy 参数。

新 { sortBy = "" }

在生成过程中，如果 sortBy 匹配默认值，路由引擎将跳过该参数（如果它在查询字符串中）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-22T14:07:26.893

您将不得不在此处使用命名路由，而不是操作路由，因为路由在 ASP.NET 中的工作方式，因为它是“第一次匹配”，而不是“最佳匹配”。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-22T04:54:06.480

我认为它正在选择您的第一条路线。它也有动作 All。并且由于未指定 sortby，因此将其公开为查询字符串参数

这仍然适用于 PhotosController 上的操作方法“All”，因为它只是用查询字符串值填充 sortby 参数。

在 Route Debugger 中是执行第三条路线还是第一条路线？

# sql - 为什么我的 SQL Server 游标很慢？

> ID：224485
> 
> 赞同：3
> 
> 时间：2008-10-22T04:23:20.303
> 
> 标签：sql, sql-server-2005

我在存储过程中使用游标。它适用于具有大量数据的数据库。对于光标中的每个项目，我都会执行更新操作。这需要花费大量时间才能完成。差不多25分钟。:( .. 无论如何我可以减少为此消耗的时间吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-22T04:28:02.290

快速的答案是不使用光标。更新大量记录的最有效方法是使用更新语句。在很多情况下，您必须使用游标而不是更新语句，您只需要了解如何编写更新语句即可。

如果您发布了 SQL 的快照，您可能会获得一些帮助来实现您所追求的目标。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-22T07:19:05.517

当您需要对每一行执行比简单更新所允许的更复杂的操作时，您可以尝试：

*   编写一个用户定义的函数并在更新中使用它（可能仍然很慢）
*   将数据放在临时表中并在 UPDATE ... FROM 中使用它：

你知道 UPDATE ... FROM 语法吗？当事情变得更复杂时，它非常强大：

```
UPDATE
  MyTable
SET
  Col1 = CASE WHEN b.Foo = "Bar" THEN LOWER(b.Baz) ELSE "" END,
  Col2 = ISNULL(c.Bling, 0) * 100 / Col3
FROM
  MyTable 
  INNER JOIN MySecondTable AS b ON b.Id = MyTable.SecondId
  LEFT  JOIN ##MyTempTable AS c ON c.Id = b.ThirdId
WHERE
  MyTabe.Col3 > 0
  AND b.Foo NOT IS NULL
  AND MyTable.TheDate > GETDATE() - 10 
```

该示例完全是虚构的，可能没有多大意义，但是您可以了解如何在不使用游标的情况下进行更复杂的更新。当然，它不一定需要临时表才能工作。:-)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-22T04:29:54.143

我会避免使用光标，并尽可能使用视图或物化视图。游标是 Microsoft 在 SQL Server 中没有进行太多优化的东西，因为大多数时候，您应该使用比游标更通用的 SQL 语句（SELECT、INSERT、UPDATE、DELETE）。

如果即使使用视图或子查询也无法执行相同的最终结果，您可能需要使用临时表或考虑改进数据模型。

您没有提供太多具体信息，所以我所能做的就是提供一些一般性提示。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-22T05:08:40.587

您是否正在更新游标正在操作的相同数据？

什么类型的光标？只转发？静止的？键集？动态的？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-22T07:37:42.080

上面提到的 UPDATE...FROM 语法是首选方法。您还可以执行子查询，如下所示。

```
UPDATE t1
SET t1.col1 = (SELECT top 1 col FROM other_table WHERE t1_id = t1.ID AND ...)
WHERE ... 
```

有时这是唯一的方法，因为每个列更新可能取决于不同的标准（或不同的表），并且可能存在您希望通过 order by 子句保留的“最佳情况”。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-22T16:24:09.193

您能否发布有关您正在进行的更新类型的更多信息？

游标在正确的上下文中可能非常有用（我使用了很多），但是如果您可以在游标和基于集合的操作之间进行选择，那么基于集合的操作*几乎*总是可行的。

但如果你没有选择，你就别无选择。没有更多的细节不能说。

# database - .NET CF 移动设备应用程序 - 处理潜在脱机的最佳方法？

> ID：224496
> 
> 赞同：3
> 
> 时间：2008-10-22T04:32:48.833
> 
> 标签：database, web-services, windows-mobile, compact-framework, offline

我正在 VB.NET（紧凑框架）中构建一个移动应用程序，我想知道在设备上处理潜在离线交互的最佳方法是什么。基本上，这些设备具有蜂窝和 802.11，但可能仍处于离线状态（接收不良等）。司机将在他们离开卡车时扫描箱子，我想更新新位置 - 如果有网络信号则立即更新，如果离线则排队并稍后处理。不过，这让我想到了如何处理一般的离线问题。

*   我是否将尽可能多的数据缓存到设备上，以便在离线时使用它 - 本质上，每个设备上都会有（相关）生产数据的副本？还是离线时禁用某些功能更好，以免以后同步的麻烦？我知道这是一个非常具体的问题，取决于我的应用程序，但我很想知道其他人是否采取了这条路线。
*   我是否构建应用程序本身以使其始终处于离线状态，将所有内容提交到本地类拥有的各种本地队列（本质上抽象出在线/离线事物），然后让该类将事物提交给服务器它可以？数据查找怎么样——如何以“半实时”的方式处理？
*   或者我应该让应用程序尝试直接、实时地向服务器提交请求，并在它本身的请求失败时处理它？我可以看到让用户等待超时的潜在问题，但这是最可靠的方法吗？

我不是在寻找特定的解决方案，而实际上只是关于开发人员如何以尽可能流畅的用户体验完成此任务的故事，并提供指向操作指南或以下内容的链接或类似内容的链接。感谢您对此的指点！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-22T13:12:22.747

我们无法给您一个明确的答案，因为没有适合所有使用场景的“正确”答案。例如，如果您在后端使用 SQL Server 并在本地使用 SQL CE，则您始终可以设置合并复制并让数据引擎为您处理所有这些。这很干净。使用离线应用程序块可能会解决它。使用存储和转发可能是一种选择。

您可以在本地存储，然后使用直接连接滚动您自己的同步，当检测到网络时使用 WCF 服务的 Web 服务。您可以使用 MSMQ 进行交付。

您需要考虑的不是“正确”的方式是什么，而是您的实现将如何影响应用程序的可用性。如果由于缺乏连接而禁用功能，该应用程序是否仍然可用？如果你有过时的数据，那有问题吗？当您拥有 GSM/GPRS（通常不是免费的）时，可能需要传输一些关键数据，而当您拥有 802.11 时，可能需要传输更多数据。也许您可以在早上拉下查找表并仅上传交易，然后设备跟踪它所做的更改。

基本上它真的取决于它的使用方式、数据的性质、现场设备之间数据交易的重要性、数据延迟的影响，以及可能我无法想到的其他因素。

因此，第一步是确定应用程序需要如何使用，*然后*确定基础设施和架构，以提供所需的连接和数据访问。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-22T04:45:02.350

我自己没有使用过，但是您是否研究过 CF 的“存储和转发”功能？它可能适合您的需求。我相信它使用 Exchange 邮箱作为消息队列来向设备发送 SOAP 数据包和从设备发送 SOAP 数据包。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-22T11:49:52.867

解决此问题的最佳方法是始终离线工作，然后使用消息队列来处理与设备之间的发送更改。例如，当驱动程序将某物标记为已送达时，将项目更新为在本地商店中已送达，并将消息放入传出队列中以告知服务器它已送达。当连接建立时，将所有排队的项目发送回服务器，并从服务器获取所有排队的消息。

# vb.net - 在 VB.NET 中计算词频的最佳方法是什么？

> ID：224499
> 
> 赞同：3
> 
> 时间：2008-10-22T04:34:52.167
> 
> 标签：vb.net, hashtable, word-frequency

有一些关于如何在 C# 中计算词频的好例子，但没有一个是全面的，我真的需要一个在 VB.NET 中。

我目前的方法仅限于每个频率计数一个单词。什么是最好的方法来改变这个，这样我就可以获得一个完全准确的词频列表？

```
wordFreq = New Hashtable()

Dim words As String() = Regex.Split(inputText, "(\W)")
    For i As Integer = 0 To words.Length - 1
        If words(i) <> "" Then
            Dim realWord As Boolean = True
            For j As Integer = 0 To words(i).Length - 1
                If Char.IsLetter(words(i).Chars(j)) = False Then
                    realWord = False
                End If
            Next j

            If realWord = True Then
                If wordFreq.Contains(words(i).ToLower()) Then
                    wordFreq(words(i).ToLower()) += 1
                Else
                    wordFreq.Add(words(i).ToLower, 1)
                End If
            End If
        End If
    Next

Me.wordCount = New SortedList

For Each de As DictionaryEntry In wordFreq
        If wordCount.ContainsKey(de.Value) = False Then
            wordCount.Add(de.Value, de.Key)
        End If
Next 
```

我更喜欢实际的代码片段，但通用的“哦，是的......使用这个并运行那个”也可以。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-22T04:48:49.953

这可能是您正在寻找的：

```
 Dim Words = "Hello World ))))) This is a test Hello World"
    Dim CountTheWords = From str In Words.Split(" ") _
                        Where Char.IsLetter(str) _
                        Group By str Into Count() 
```

我刚刚测试过它确实有效

编辑！我添加了代码以确保它只计算字母而不计算符号。

仅供参考：我发现一篇关于如何使用 LINQ 和目标 2.0 的文章，感觉有点脏，但它可能对某人有所帮助[http://weblogs.asp.net/fmarguerie/archive/2007/09/05/linq-support-on -net-2-0.aspx](http://weblogs.asp.net/fmarguerie/archive/2007/09/05/linq-support-on-net-2-0.aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-22T05:16:59.727

```
Public Class CountWords

    Public Function WordCount(ByVal str As String) As Dictionary(Of String, Integer)
        Dim ret As Dictionary(Of String, Integer) = New Dictionary(Of String, Integer)

        Dim word As String = ""
        Dim add As Boolean = True
        Dim ch As Char

        str = str.ToLower
        For index As Integer = 1 To str.Length - 1 Step index + 1
            ch = str(index)
            If Char.IsLetter(ch) Then
                add = True
                word += ch
            ElseIf add And word.Length Then
                If Not ret.ContainsKey(word) Then
                    ret(word) = 1
                Else
                    ret(word) += 1
                End If
                word = ""
            End If
        Next

        Return ret
    End Function

End Class 
```

然后，对于一个快速演示应用程序，创建一个带有一个名为 InputBox 的多行文本框、一个名为 OutputList 的列表视图和一个名为 CountBtn 的按钮的 winforms 应用程序。在列表视图中创建两列 - “Word”和“Freq”。选择“详细信息”列表类型。为 CountBtn 添加事件处理程序。然后使用此代码：

```
Imports System.Windows.Forms.ListViewItem

Public Class MainForm

    Private WordCounts As CountWords = New CountWords

    Private Sub CountBtn_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles CountBtn.Click
        OutputList.Items.Clear()
        Dim ret As Dictionary(Of String, Integer) = Me.WordCounts.WordCount(InputBox.Text)
        For Each item As String In ret.Keys
            Dim litem As ListViewItem = New ListViewItem
            litem.Text = item
            Dim csitem As ListViewSubItem = New ListViewSubItem(litem, ret.Item(item).ToString())

            litem.SubItems.Add(csitem)
            OutputList.Items.Add(litem)

            Word.Width = -1
            Freq.Width = -1
        Next
    End Sub
End Class 
```

你做了一件可怕的事情让我用VB写这个，我永远不会原谅你。

:p

祝你好运！

**编辑**

修复了空白字符串错误和大小写错误

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-22T04:46:21.440

这可能会有所帮助：

[自然语言处理的词频算法](https://stackoverflow.com/questions/90580/word-frequency-algorithm-for-natural-language-processing)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-22T05:23:33.287

非常接近，但 \w+ 是一个很好的匹配正则表达式（仅匹配单词字符）。

```
Public Function CountWords(ByVal inputText as String) As Dictionary(Of String, Integer)
    Dim frequency As New Dictionary(Of String, Integer)

    For Each wordMatch as Match in Regex.Match(inputText, "\w+")
        If frequency.ContainsKey(wordMatch.Value.ToLower()) Then
            frequency(wordMatch.Value.ToLower()) += 1
        Else
            frequency.Add(wordMatch.Value.ToLower(), 1)
        End If
    Next
    Return frequency
End Function 
```

# c++ - Visual Studio 中的“编辑并继续”如何工作？

> ID：224500
> 
> 赞同：26
> 
> 时间：2008-10-22T04:36:23.363
> 
> 标签：c++, visual-studio

我一直发现这是 Visual Studio 中一个非常有用的功能。对于那些不了解它的人，它允许您在调试正在运行的进程时编辑代码*，在二进制文件仍在运行时*重新编译代码，并继续使用新代码无缝地使用应用程序，而无需重新启动它。

这个功能是如何实现的？如果我正在修改的代码在应用程序加载的 DLL 中，应用程序是否只是卸载 DLL 并重新加载它？在我看来，这似乎很容易出现不稳定问题，所以我认为它会比这更聪明。有任何想法吗？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-10-22T04:54:43.140

我的理解是，当应用程序在启用编辑并继续支持的情况下编译时，编译器会在二进制映像中的函数周围留出额外的空间，以允许添加额外的代码。然后调试器可以编译新版本的函数，替换现有版本（根据需要使用填充空间），修复堆栈，设置指令指针，然后继续。这样你就不必修复任何跳转指针，只要你有足够的填充。

请注意，“编辑并继续”通常不适用于 libs/dll 中的代码，只能用于主要的可执行代码。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-10-22T04:44:07.733

我的*猜测*是它重新编译了应用程序（对于小的更改，这并不意味着必须重新编译很多）。然后，由于 Microsoft 制造了编译器和调试器，因此他们可以保证内存等的布局方式。因此，只要更改足够小，他们就可以使用调试 API 用新的代码段重写代码段。

如果更改重定向到全新的代码，这显然可以以与 DLL 类似的样式加载到内存中。

微软还有一种“热补丁”机制。函数在任何实际代码之前都有一个 2 字节的无操作指令，通常类似于“mov edx，edx”。这允许他们干净地重定向函数的执行。这也可能是一种选择。

要记住的关键是应用程序没有“运行”，它的所有线程都处于停止状态。因此，就过程而言，调试器所做的任何修改都是完全原子的。

当然，这都是猜测；）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-22T04:54:42.470

我的猜测是所有对象都与 4096 字节的内存边界对齐。因此，如果您对某些代码进行小的更改，那么对象仍将在这些边界内，因此会像以前一样运行。

我曾经遇到过更改几行将导致完全重新编译和链接的情况，而在其他情况下，对函数进行相当大的重构会很好。

# iphone - 在本机 iPhone 应用程序中重复背景图像

> ID：224503
> 
> 赞同：48
> 
> 时间：2008-10-22T04:38:07.403
> 
> 标签：iphone, cocoa-touch, native, repeat

如果没有将 UIWebView 作为我的 nib 文件中的最后一层，我如何将重复的背景图像添加到 iPhone 应用程序（如分组 UITableView 的背景中的灯芯绒外观）？

我是否需要创建一个 iPhone 屏幕大小的图像并使用复制和粘贴手动重复它？

* * *

## 回答 #1

> 赞同：161
> 
> 时间：2008-10-22T04:48:09.177

显然 UIColor 不一定是单一颜色，但也可以是一种模式。令人困惑的是，Interface Builder 不支持此功能。

相反，您可以使用便捷方法 +colorWithPatternImage: 设置视图的背景颜色（例如，在 -viewDidLoad 中），并将其传递给 UI 图像。例如：

```
- (void)viewDidLoad {
    [super viewDidLoad];
    self.view.backgroundColor = [UIColor colorWithPatternImage: [UIImage imageNamed:@"gingham.png"]]; 
} 
```

当然，不要忘记将图像文件添加到您的应用程序包中。

还有一些内置的背景图案“颜色”：

*   groupTableViewBackgroundColor
*   视图翻转背景颜色

因为它在全球范围内用于所有 iPhone 应用程序，所以你会招致操作系统更新的双刃剑，更新应用程序的外观和感觉（给它一个新的外观，可能会或可能不会正常工作）。

例如：

```
- (void)viewDidLoad {
    [super viewDidLoad];
    self.view.backgroundColor = [UIColor groupTableViewBackgroundColor]; 
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-22T09:12:58.347

您应该查看来自 Apple 的 QuartzDemo iPhone 示例代码，特别是 QuartzImageDrawing.m。应该使用下面的方法调用。

```
CGContextDrawTiledImage 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-22T16:51:49.200

您甚至可以让动画平铺背景图像移动。:D

[Apps Amuck](http://www.appsamuck.com/)有一个简单的教程，向您展示如何在他们的网站上执行此操作。

[31 天 iPhone 应用程序 - 第 16 天：世界巡回演唱会](http://appsamuck.com/blog/index.php/2008/10/16/31-days-of-iphone-apps-day-16-world-tour/)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-07-13T04:15:24.557

你应该使用 colorWithPatternImage

# ruby-on-rails - 为什么这条线路会在 DreamHost 上与乘客一起打破 Rails？

> ID：224504
> 
> 赞同：4
> 
> 时间：2008-10-22T04:39:23.250
> 
> 标签：ruby-on-rails, passenger, dreamhost

好的，所以我在 DreamHost 上设置了一个 Rails 应用程序，不久前我让它工作了，现在它坏了。我对部署环境或类似的东西不太了解，所以请原谅我的无知。无论如何，看起来应用程序在 config/environment.rb 中的这一行崩溃了：

```
require File.join(File.dirname(__FILE__), 'boot') 
```

config/boot.rb 非常正常，但无论如何我都会将它包含在这里。

```
# Don't change this file!
# Configure your app in config/environment.rb and config/environments/*.rb

RAILS_ROOT = "#{File.dirname(__FILE__)}/.." unless defined?(RAILS_ROOT)

module Rails
  class << self
    def boot!
      unless booted?
        preinitialize
        pick_boot.run
      end
    end

    def booted?
      defined? Rails::Initializer
    end

    def pick_boot
      (vendor_rails? ? VendorBoot : GemBoot).new
    end

    def vendor_rails?
      File.exist?("#{RAILS_ROOT}/vendor/rails")
    end

    def preinitialize
      load(preinitializer_path) if File.exist?(preinitializer_path)
    end

    def preinitializer_path
      "#{RAILS_ROOT}/config/preinitializer.rb"
    end
  end

  class Boot
    def run
      load_initializer
      Rails::Initializer.run(:set_load_path)
    end
  end

  class VendorBoot < Boot
    def load_initializer
      require "#{RAILS_ROOT}/vendor/rails/railties/lib/initializer"
      Rails::Initializer.run(:install_gem_spec_stubs)
    end
  end

  class GemBoot < Boot
    def load_initializer
      self.class.load_rubygems
      load_rails_gem
      require 'initializer'
    end

    def load_rails_gem
      if version = self.class.gem_version
        gem 'rails', version
      else
        gem 'rails'
      end
    rescue Gem::LoadError => load_error
      $stderr.puts %(Missing the Rails #{version} gem. Please `gem install -v=#{version} rails`, update your RAILS_GEM_VERSION setting in config/environment.rb for the Rails version you do have installed, or comment out RAILS_GEM_VERSION to use the latest version installed.)
      exit 1
    end

    class << self
      def rubygems_version
        Gem::RubyGemsVersion if defined? Gem::RubyGemsVersion
      end

      def gem_version
        if defined? RAILS_GEM_VERSION
          RAILS_GEM_VERSION
        elsif ENV.include?('RAILS_GEM_VERSION')
          ENV['RAILS_GEM_VERSION']
        else
          parse_gem_version(read_environment_rb)
        end
      end

      def load_rubygems
        require 'rubygems'
        min_version = '1.1.1'
        unless rubygems_version >= min_version
          $stderr.puts %Q(Rails requires RubyGems >= #{min_version} (you have #{rubygems_version}). Please `gem update --system` and try again.)
          exit 1
        end

      rescue LoadError
        $stderr.puts %Q(Rails requires RubyGems >= #{min_version}. Please install RubyGems and try again: http://rubygems.rubyforge.org)
        exit 1
      end

      def parse_gem_version(text)
        $1 if text =~ /^[^#]*RAILS_GEM_VERSION\s*=\s*["']([!~<>=]*\s*[\d.]+)["']/
      end

      private
        def read_environment_rb
          File.read("#{RAILS_ROOT}/config/environment.rb")
        end
    end
  end
end

# All that for this:
Rails.boot! 
```

有没有人有任何想法？我在日志或页面上没有收到任何错误。

-fREW

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-19T23:46:53.187

我在 DreamHost 上遇到了同样的问题。冻结铁轨并打开所有宝石的包装让我通过了它。

```
rake rails:freeze:gems
rake gems:unpack:dependencies 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-22T15:07:56.523

我的猜测是，由于 Dreamhost 上的 Rails gems 的更新版本，您正在崩溃。至少，当 boot.rb 之类的东西出现问题时，这就是我的问题。

尝试将开发环境中的 gem 冻结到 vendor/rails 目录中。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-03-12T13:40:02.343

是的 - 问题并不真正存在`boot.rb`- 它只是`boot.rb`实际加载 rails 的地方。

因此，如果您指定的 Rails 版本在您的 dreamhost 切片中不存在，您将收到类似的错误。如果您升级项目、启动新项目（同时忘记升级 Rails）或者您仍在使用旧版本的 Rails 并且现在已从您正在使用的 dreamhost 服务器中删除，则可能会发生这种情况上。

要弄清楚哪个是，请查看`config/environment.rb`将显示如下内容的行：

```
RAILS_GEM_VERSION = '2.3.4' unless defined? RAILS_GEM_VERSION 
```

然后 ssh 到您的 dreamhost 服务器并键入`gem list`并查看您的版本是否在列表中。

如果没有，您可以尝试几种选择。假设您使用的版本是 2.3.4 首先，尝试：`gem install rails -v=2.3.4`然后重新启动。这可能就是所有需要的。如果这不起作用，请尝试冻结并拆开宝石（根据此处的其他答案）。

还有另一种可能性——你实际上错过了一个 Rails 依赖的 gem，但它正在默默地失败——例如，对某个版本的 rack 的依赖让我有一次失望。但是您可能还有其他 gem 依赖项

如果您运行`rake gems`，您将能够列出您的项目知道它需要的所有 gem - 确保一开始就安装了它们。

然后，作为一种粗略的冒烟测试，尝试运行`script/console`- 如果您缺少重要的 rails gem，`script/console`将不会加载并且应该失败，并通知您需要的 gem。

**更新**：如果您尝试运行 v 2.3.5，您可能还会遇到此问题： [Bypassing rack version error using Rails 2.3.5](https://stackoverflow.com/questions/1814856/bypassing-rack-version-error-using-rails-2-3-5)

在这种情况下，您需要按照那里的说明进行操作。

# ruby - 将“puts”命令输出重定向到日志文件

> ID：224512
> 
> 赞同：18
> 
> 时间：2008-10-22T04:46:52.750
> 
> 标签：ruby, daemon

我正在使用 daemons gem 在 Ruby 中创建一个守护进程。我想将守护程序的输出添加到日志文件中。我想知道`puts`从控制台重定向到日志文件的最简单方法是什么。

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2010-03-19T20:36:54.837

如果您需要同时捕获 STDERR 和 STDOUT 并且不想使用日志记录，以下是改编自[这篇文章](http://www.justskins.com/forums/help-redirecting-stderr-1-6-x-and-1-8-differences-66862.html)的简单解决方案：

```
$stdout.reopen("my.log", "w")
$stdout.sync = true
$stderr.reopen($stdout) 
```

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-10-22T04:55:36.820

尝试

```
$stdout = File.new( '/tmp/output', 'w' ) 
```

恢复：

```
$stdout = STDOUT 
```

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2008-10-22T06:26:33.190

我应该推荐使用 ruby​​ 记录器，它比 puts 更好，您可以有多个可以打开/关闭的日志级别：调试、警告、信息、错误等。

```
 logger = Logger.new(STDOUT)
 logger = Logger.new("/var/log/my-daemon.log") 
```

我使用 runit 包来管理 ruby​​ 服务，它有 svlogd，而不是将守护进程输出重定向到日志文件，这里是记录器进程的运行脚本：

```
#!/bin/sh
set -e

LOG=/var/log/my-daemon

test -d "$LOG" || mkdir -p -m2750 "$LOG" && chown nobody:adm "$LOG"
exec chpst -unobody svlogd -tt "$LOG" 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-03-24T18:05:00.157

或者你可以重新定义`puts`命令？可能只在单个文件/类中工作

```
def puts(message)
   #write message to file
end 
```

# patch - Microsoft（和其他拥有大量安装基础的软件公司）如何管理补丁依赖关系？

> ID：224515
> 
> 赞同：5
> 
> 时间：2008-10-22T04:49:01.733
> 
> 标签：patch, hotfix

微软向社区发布的操作系统（通常是基于安全的）补丁和修补程序在我的理解中通常由一系列更新的 DLL 或其他二进制文件组成。

Microsoft 和其他喜欢它的公司如何确保修补程序不会相互冲突？他们是否总是采用累积补丁方法，其中单个修补程序将包含以前修补程序中的所有修补程序？*情况似乎*并非如此，因为许多修补程序似乎都专注于修复特定问题。如果它们是重点修补程序，它们如何防止一个修补程序破坏另一个修补程序（例如，彼此安装不兼容的 DLL）。

我一直很钦佩微软管理这个过程的能力。我工作的公司规模要小得多，几年前我在处理补丁过程时，我们总是采用累积方法，即单个补丁会立即取代基于该版本的所有先前补丁。这意味着补丁的大小会逐渐变大，直到下一个“官方”版本发布。

管理补丁依赖项有哪些好的做法？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-22T05:03:10.767

首先，Microsoft Windows Installer 能够直接修补二进制文件。给定文件的已知早期状态，它可以将它们带到已知的当前状态。我们曾经为我们的大型商业产品这样做，但在发布了几个版本之后，我们的四路系统需要超过 24 小时才能生成补丁 - 当您拥有（或想要拥有）时这并不好每晚构建。

一段时间后，我们选择了仅允许升级的累积修复。我们检查你是否处于较低的水平，然后基本上更换整个产品。（我们也遇到过这样的情况，即第二个或第三个“delta”基本上就是一切。）

在 Unix/Linux 上，显然我们不能使用 MSWI，所以我们提供了另一个安装程序，它基本上做同样的事情：将所有文件移开，像全新一样安装，然后删除备份。现实情况是，对于我们的业务来说，这已经足够了。我们没有收到任何我所知道的投诉（这些投诉会根据我目前的工作很快击中我），因为人们不开心到实际打电话投诉。大多数情况下，他们希望通过补丁获得更新的级别，以便他们可以继续他们的实际业务。 *奇怪的是，他们的业务不是安装补丁。*

# integration - 您如何使用功能点估算 EAI 项目？

> ID：224526
> 
> 赞同：2
> 
> 时间：2008-10-22T04:58:17.923
> 
> 标签：integration, eai, function-points

您如何使用功能点估算[EAI项目？](http://en.wikipedia.org/wiki/Enterprise_application_integration)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-22T11:58:50.990

FP analysis is inappropriate for integration projects of any sort as it presupposes that you can specify the application up-front. Most of the work in any integration project of non-trivial complexity is reverse-engineering the nuances of the environment. Typically the environment will not be exhaustively documented in the sort of cases you would expect to use an EAI system in.

By the time you have actually done this level of reverse engineering to the point of having a complete specification you have done most of the work in the project - the actual development is fairly short and sweet by comparison. Therefore the function point analysis is only providing an estimate for a small part of the system.

As an aside, much of the work I do is data warehouse systems in Commercial insurance companies, where extensive prototyping and reconciliation exercises to produce detailed specification documents are actually quite appropriate to the environment. Typically this takes longer than actually developing the production system as most of the data issues are resolved in the prototyping work. EAI systems have a similar class of implementation issues.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-22T05:23:59.883

好吧，鉴于 FP 计数基于存储和最终用户界面，不确定它是否对 EAI 有意义（据我所知很少）。

我会说你不能，至少不是以一种有用的方式。FP 计数通常被视为一种不同精度的可疑做法，将其用于集成项目只会增加更多的模糊性。

# .net - 不使用 Prism 的 WPF 中的松散耦合事件

> ID：224527
> 
> 赞同：4
> 
> 时间：2008-10-22T04:58:18.453
> 
> 标签：.net, wpf, design-patterns, mvvm

我正在开发一个 WPF 应用程序，并且正在使用 Model-View-ViewModel 模式。

该应用程序目前由两个模块组成：

*   左面板浏览树并选择一个节点
*   主面板显示所选树节点的内容。

我想将这两个模块分开，但是当我在左侧面板中选择一个节点时，我需要触发一个主面板可以订阅的事件。我不想耦合左面板和主面板，所以我不想共享 ViewModel 类的实例。

理想情况下，我很想使用 Prism（WPF 复合应用程序指南），但我目前正在扩展现有应用程序，无法引入更多依赖项。该项目也在 .NET 3.0（不是 3.5）上，所以我必须将 Prism 转换回 .NET 3.0，因为它是为 .NET 3.5 编写的。

在 Prism 中，我会使用松耦合事件基础设施来解决这个问题。它允许您在任何层中的任何类中触发事件，并在任何层中的任何类中侦听任何事件。基本上，事件的发布者和订阅者是分离的。

我使用命令来实现我的视图和我的视图模型之间的这种松散耦合，但我不确定如何进行正确的跨视图通信。

非常感谢任何提示或建议。

**我正在专门为 .NET 2.0/3.0（没有 LINQ 的东西）寻找一个*真正*轻量级的 pub/sub 事件模型，或者在不耦合两个模块的情况下实现跨视图（模块）通信的其他东西。**

**更新**：我最终以与 Glen 建议的方式类似的方式解决了这个问题。我有一个单独的 EventService（我称之为 CommandProxy），并通过我的服务定位器中的构造函数将它传递给每个 ViewModel（目前我使用的是服务定位器而不是 IoC 容器）。CommandProxy 公开了一组 MultiDelegateCommants，它是 Prism（复合 WPF 指导）中 DelegateCommand 的扩展。它基本上允许从可视树中分离出来的命令，并且支持多个订阅者。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-22T17:30:35.220

你有 IoC 容器吗？一种简单的方法是创建一个触发事件的自定义服务。事件聚合器是通用的，但您可以创建一个特定的服务来满足您的需求。

例如，创建一个具有 OnNodeSelected 方法的 EventingService。该方法会触发一个 NodeSelected 事件，该事件会挂起服务。然后在您的 IoC 容器中注册该服务，允许发布者和订阅者访问它。这样，如果说您的 MainPanel 需要订阅，那么您的 MainPanelViewModel 将在其构造函数中注入 EventingServiec。然后它将订阅。如果您使用 WPF，另一种方法是从复合应用程序库代码中提取 CompositeCommand，并让事件服务公开一个 CompositeCommand。然后每个订阅者（视图模型）向服务注册他们的命令。当 OnNodeSelected 被调用时，CompositeCommand 的执行被调用，从而通知所有相关方。

我们在位于 www.microsoft.com/compositewpf 的复合应用程序指南文档中讨论了为此使用您自己的服务，该文档位于通信主题的松散耦合事件部分。（[http://msdn.microsoft.com/en-us/library/cc707836.aspx](http://msdn.microsoft.com/en-us/library/cc707836.aspx)）。Francis Cheung 对此也有帖子。

# xml - XML 标准解析器是否比其他类型的自定义编写解析器更快？

> ID：224537
> 
> 赞同：-1
> 
> 时间：2008-10-22T05:12:24.167
> 
> 标签：xml, xml-parsing

XML 解析器（由标准库提供）是否比自定义编写的解析器更快？
如果是这样，为什么？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-22T06:15:18.440

自定义编写的解析器有什么用？还是 XML？如果是这样，我希望标准库通常比 J Random Developer 编写的代码具有更高质量、更快、更健壮的代码。毕竟，标准库背后往往有很多资源，解析器将被广泛使用——相对较快地清除错误。

话虽如此，XML 对解析器并不是*特别*友好。如果您将“使用标准库解析 XML”与“使用自定义代码解析自定义数据格式”进行比较，那么自定义数据格式可能会快很多，如果它是为特定任务精心设计的。

鉴于所有这些警告，您能否澄清您的问题？

# html - 服务器上未链接的网页 - 安全漏洞？

> ID：224541
> 
> 赞同：4
> 
> 时间：2008-10-22T05:15:48.667
> 
> 标签：html, security

在我的网站上，我有几个 html 文件没有链接到主门户页面。如果没有其他人链接到他们，Jimmy Evil Hacker 是否有可能找到他们？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-22T05:18:20.020

如果有人访问在其 Google 工具栏上打开了高级选项的页面，则该地址将被发送给 Google。这是我能弄清楚为什么我有一些页面在谷歌上的唯一原因。

所以，答案是肯定的。确保你有 robots.txt 甚至 .htaccess 什么的。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-22T09:51:06.177

隐藏页面**真的**很难找到。

首先，绝对确保您的 Web 服务器永远不会返回任何默认索引页面。`.htaccess`在您的配置和文件中随处使用以下内容。IIS 可能有类似的东西。

```
Options -Indexes 
```

其次，确保文件名不是字典单词——猜出非字典单词的几率非常小。非零，理论上有人可能会在某个地方耐心地猜测每个可能的文件名，直到他们找到你的文件名。[我讨厌这些理论上的攻击。是的，它们存在。不，它们永远不会在你的一生中发生，除非你给了某人一个搜索你隐藏内容的理由。]

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-22T05:17:28.803

您通过默默无闻（谷歌搜索）谈论安全性，依赖它从来都不是一个好主意。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-22T05:17:16.590

是的。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-22T05:18:41.983

他们不太可能被发现，但仍有可能。

[想到“通过默默无闻的安全”这个词](http://en.wikipedia.org/wiki/Security_through_obscurity)

# code-generation - 以图形方式布局 wx 应用程序

> ID：224547
> 
> 赞同：1
> 
> 时间：2008-10-22T05:18:30.847
> 
> 标签：code-generation, wxwidgets

作为 wx 的新手，我想知道是否有一个 IDE（尤其是用于 Linux）可以帮助我布置框架或对话框或其他任何东西来帮助我了解我在做什么。这意味着还要为这些更改创建代码。

我记得早在使用 OS/2 和 Windows 的资源编译器时，这些编译器生成的二进制文件会创建窗口，并希望得到类似的东西（尽管如果 wx 不支持，显然不是二进制文件）。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-22T05:29:17.237

我使用[wxFormBuilder](http://www.wxformbuilder.org)。它是用 wxWidgets 编写的，因此在 Linux 上运行良好。它可以生成 C++ 代码或 XRC 文件。确保您了解它的理念，并像这样使用它：

*   为 GUI 生成 C++ 代码
*   不要编辑 wxFormBuilder 生成的代码，而是创建新文件
*   在新文件中，从它生成的类派生新类
*   在您自己的类中实现事件处理程序（wxFB 为您希望使用的每个事件处理程序创建虚拟函数）

我通常将 wxFormBuilder 生成的类/文件命名为 MainFrameGUI，而一个具有实现的类/文件（派生的我在其中编写所有代码）将只是 MainFrame。这使您可以随时更改可视布局并从 wxFB 重新生成 C++ 文件，而不会覆盖您的代码。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-22T05:59:09.657

[DialogBlocks](http://www.anthemion.co.uk/dialogblocks/)对我来说效果很好，尽管有时您需要编辑代码以手动修复错误。它有一个看起来足够先进的属性编辑器。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-22T07:13:24.920

另一个选择是[wxGlade](http://wxglade.sourceforge.net/)。它没有提到的其他功能似乎有那么多功能，但它的工作原理足以让我不敢切换。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-06-26T22:56:56.443

[我使用来自http://www.codeblocks.org](http://www.codeblocks.org)的Code::Blocks IDE - 内置 GUI 编辑器 - 可交叉编译，因此您可以在 Linux、OSX 和 Windows 下使用它。

但我仍然使用 wxFormBuilder 而不是内置的 wxSmith 编辑器。但它们与内部 wxSmith 兼容。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-22T05:23:46.857

对于 Windows，你有“wx-devcpp”，它是 Blodsheed Dev C++，有一些插件提供你正在寻找的东西

这是项目页面 [http://wxdsgn.sourceforge.net/](http://wxdsgn.sourceforge.net/)

# embedded - 嵌入式代码中的事件处理

> ID：224553
> 
> 赞同：1
> 
> 时间：2008-10-22T05:22:16.330
> 
> 标签：embedded, event-handling

我想知道嵌入式系统代码中如何使用事件。

主要目的是了解事件标志在代码中的设置/重置方式。以及如何识别哪个任务正在使用哪个事件标志以及标志的哪些位被每个任务设置/重置。

请提出您的建议或意见。

提前致谢。

* * *

（编辑1：从下面的答案中的澄清复制）

很抱歉没有指定所需的详细信息。实际上，我对使用 vxworks/Itron/OSEK OS 分析任何用 C 语言编写的应用程序很感兴趣。例如 vxworks 中有 eventLib 库来支持事件处理。我想知道如何利用这样的系统例程来处理任务中的事件。什么是事件标志（是全局/本地......还是什么？），如何设置任何事件标志的位以及任务和事件标志之间可能的关系？

任务如何在 AND 和 OR 模式下等待多个事件？我遇到了一个示例，其中下面给出的场景看起来很危险，但是为什么呢？

```
 Scenarios is ==> *[Task1 : Set(e1), Task2 : Wait(e1) and Set(e2), Task3 : Wait(e2) ]* 
```

我知道一个任务等待的多个事件标志或多个任务之间的循环依赖（死锁）是任务事件关系中的危险情况，但上述情况有多危险，我不明白......请解释一下。

```
 (Are there any more such scenarios possible in task-event handling which should be reviewed in code ?? ) 
```

我希望以上信息足够......

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-22T17:01:38.867

VxWorks 中的 eventLib 类似于 unix 中的 signal() —— 它可以向不同的线程指示发生了什么事。如果您需要通过事件传递数据，您可能需要改用消息队列。

这些事件在发送者和接收者之间是“全局的”。由于每个发送者都指明了事件的目的是什么，因此系统中可以有多个事件掩码，每个发送者/接收者对都有自己的解释。

一个基本的例子：

```
 #define EVENT1       0x00000001
 #define EVENT2       0x00000002
 #define EVENT3       0x00000004
 ...
 #define EVENT_EXIT   0x80000000

 /* Spawn the event handler task (event receiver) */
 rcvTaskId = taskSpawn("tRcv",priority,0,stackSize,handleEvents,0,0,0,0,0,0,0,0,0,0);
 ...

 /* Receive thread: Loop to receive events */
 STATUS handleEvents(void)
 {
     UINT32 rcvEventMask = 0xFFFFFFFF;

     while(1)
     {
         UINT32 events = 0;

         if (eventReceive(rcvEventMask. EVENTS_WAIT_ANY, WAIT_FOREVER, &events) == OK)
         {
             /* Process events */
             if (events & EVENT1)
                 handleEvent1();
             if (events & EVENT2)
                 handleEvent2();
             ...
             if (events & EVENT_EXIT)
                 break;
         }
     }

     return OK;
 } 
```

事件发送者通常是硬件驱动程序 (BSP) 或另一个线程。当期望的动作发生时，驱动程序构建所有相关事件的掩码并将它们发送到接收器任务。

发送方需要获取接收方的taskID。taskID 可以是全局的，

```
int RcvTaskID = ERROR;
...
eventSend(RcvTaskID, eventMask); 
```

它可以由接收者向驱动程序/发送者任务注册，

```
static int RcvTaskID = ERROR;

void DRIVER_setRcvTaskID(int rcvTaskID)
{
    RcvTaskID = rcvTaskID;
}
...
eventSend(RcvTaskID, eventMask); 
```

或者驱动程序/发送者任务可以调用接收者 API 方法来发送事件（包装器）。

```
static int RcvTaskID;
void RECV_sendEvents(UINT32 eventMask)
{
    eventSend(RcvTaskID, eventMask);
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-22T05:32:09.883

许多嵌入式系统使用中断服务程序 (ISR) 来处理事件。您将为给定的“标志”定义 ISR，并在处理事件后重置该标志。

例如，假设您有一个执行模数转换 (ADC) 的设备。在设备上，您可以有一个 ISR，每次 ADC 完成转换时触发，然后在 ISR 中处理它或通知其他任务数据可用（如果您想通过某些通信协议发送它）。完成后，您将重置 ADC 标志，以便它可以在下一次转换时再次触发。

通常在设备手册中定义了一组 ISR。有时它们会提供通用标志，您也可以根据需要处理这些标志。每次重置导致例程触发的标志。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-06T05:21:17.483

如果您询问如何设置、清除和检查表示事件的各种位，此示例可能会有所帮助。基本策略是声明一个（通常是全局的）变量并使用一位来表示每个条件。

```
unsigned char bit_flags = 0; 
```

现在我们可以将事件分配给位：

```
#define TIMER_EXPIRED   0x01   // 0000 0001
#define DATA_READY      0x02   // 0000 0010
#define BUFFER_OVERFLOW 0x04   // 0000 0100 
```

我们可以使用位运算符设置、清除和检查位：

```
// Bitwise OR: bit_flags | 00000001 sets the first bit.
bit_flags |=  TIMER_EXPIRED;  // Set TIMER_EXPIRED bit.

// Bitwise AND w/complement clears bits: flags & 11111101 clears the 2nd bit.
bit_flags &= ~DATA_READY;     // Clear DATA_READY bit.

// Bitwise AND tests a bit.  The result is BUFFER_OVERFLOW
// if the bit is set, 0 if the bit is clear.
had_ovflow = bit_flags & BUFFER_OVERFLOW; 
```

我们还可以设置或清除位组合：

```
// Set DATA_READY and BUFFER_OVERFLOW bits.
bit_flags |=  (DATA_READY | BUFFER_OVERFLOW); 
```

您经常会看到这些操作以宏的形式实现：

```
#define SET_BITS(bits, data)    data |=  (bits)
#define CLEAR_BITS(bits, data)  data &= ~(bits)
#define CHECK_BITS(bits, data)  (data & (bits)) 
```

另外，关于中断和中断服务例程的说明：它们需要*快速*运行，因此典型的 ISR 将简单地设置一个标志、增加一个计数器或复制一些数据并立即退出。然后，您可以在闲暇时查看旗帜并参加活动。您可能不想*在*ISR 中进行冗长或容易出错的活动。

希望这会有所帮助！

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-22T05:31:17.543

这个问题需要提供更多的上下文。嵌入式系统可以使用广泛的语言、操作系统（包括无操作系统）、框架等来创建。在嵌入式系统中如何创建和处理事件并没有什么普遍性，就像事件的方式没有什么普遍性一样一般在计算中创建和处理。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-02-02T05:40:28.927

在我设计的一个嵌入式系统系列中（对于具有约 128KB 闪存和 3.5KB RAM 的 PIC18Fxx 微控制器），我编写了一个库来处理多达 16 个分辨率为 1/16 秒的定时器（通过输入到 CPU 的 16Hz 脉冲测量）。代码设置为确定是否有任何定时器处于过期状态或任何专用唤醒引脚正在发出信号，如果不是，则休眠直到下一个定时器到期或唤醒输入改变状态。相当方便的代码，尽管我回想起来可能已经将它设计为与多组 8 个计时器而不是一组 16 个计时器一起工作。

我发现定时例程的一个关键方面是有用的，它们大多不是由中断驱动的。相反，我有一个“方便时轮询”例程，它可以更新 16Hz 计数器的计时器。虽然有时让定时器不通过中断运行感觉很奇怪，但这样做可以避免担心在奇怪的时间发生中断。如果定时器控制的动作不能在中断中发生（由于堆栈嵌套和其他限制），则无需担心中断中的定时器——只需跟踪已经过去了多少时间。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-22T05:38:50.913

很抱歉没有指定所需的详细信息。实际上，我对使用 vxworks/Itron/OSEK OS 分析任何用 C 语言编写的应用程序很感兴趣。例如 vxworks 中有 eventLib 库来支持事件处理。我想知道如何利用这样的系统例程来处理任务中的事件。什么是事件标志（是全局/本地......还是什么？），如何设置任何事件标志的位以及任务和事件标志之间可能的关系？

我希望以上信息足够......

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2011-12-08T23:26:54.090

如果您对在嵌入式级别使用事件驱动编程感兴趣，那么您真的应该研究一下[QP](http://www.state-machine.com/)。这是一个优秀的轻量级框架，如果你得到 Miro Samek 的“C/C++ 中的实用 UML 状态图”一书，你会发现从如何在嵌入式 linux 内核（ISR 等）中处理系统事件到在构建中处理和创建它们的所有内容QP 作为您的环境。（[这里](http://www.state-machine.com/doxygen/qpcpp/struct_q_event.html)是一个示例事件的链接）。

# c - 自定义获取行输入功能

> ID：224562
> 
> 赞同：2
> 
> 时间：2008-10-22T05:29:50.357
> 
> 标签：c, buffer-overflow, kernighan-and-ritchie

我正在阅读 K&R 的书，有点卡住了。

以下有什么问题？

```
void getInput(int* output) {
   int c, i;
   for(i=0; (c = getchar()) != '\n'; i++)
     output[i] = c; // printf("%c", c) prints the c value as expected
   output[++i] = '\0';
} 
```

当我运行程序时，它永远不会退出循环，我必须`Ctrl+C`退出。但是，如果我用 替换第五行`printf("%c", c);`，它会在按 Enter 并创建新行后打印出所有输入。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-22T05:58:07.273

> 以下有什么问题？

```
1\. void getInput(int* output) { 
```

当您想将内容存储在字符数组中时，为什么输入参数是 int*？大概

```
void getInput(char* output) { 
```

更好。

另外，你怎么知道输出指针指向的地方有足够的内存来写入用户的输入？也许您必须将最大缓冲区长度作为额外参数，以避免[PW 指出的](https://stackoverflow.com/questions/224562/basic-c-question#224581)缓冲区溢出错误。

```
5\.   output[++i] = '\0'; 
```

i 已经在 for 循环中增加了一个额外的时间，所以你可以这样做：

```
output[i] = '\0'; 
```

除此之外，程序运行良好并输出我们输入的内容，直到返回。

FWIW，我通过这样称呼它来测试它：

```
 int main(void)
{
    char o[100];
    getInput(o);
    printf("%s", o);
    return 0;
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-22T05:39:14.407

它看起来对我来说是正确的，除了你不需要在循环之外增加 i 。i 在循环退出之前立即递增，因此它已经在您想要的位置。

确保一个 '\n' 实际上是把它变成 c。

有时，'\n' 会作为分隔符被丢弃。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-22T07:07:51.467

您发布的最后一个代码有 3 个错误，我可以看到：

```
char* userInput[MAX_INPUT_SIZE]; 
```

应该：

```
char userInput[MAX_INPUT_SIZE+1]; 
```

（Pax Diablo 已经提到了这一点）

```
getInput(&userInput); 
```

应该：

```
getInput( userInput ); 
```

最后一个错误意味着您将调用堆栈内的地址传递给 getInput。你有一个内存覆盖。您对 getchar() 的调用之一可能返回到错误的地址。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-22T05:42:11.173

一种冒险缓冲区溢出的简单方法，因为输出的大小永远不会通过/检查

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-22T06:00:17.173

这是完整的程序，其中包含您输入的一些更新，但它仍然无法退出循环。顺便说一句，这是第 34 页的练习 1-24

```
#include <stdio.h>

#define STACK_SIZE 50
#define MAX_INPUT_SIZE 1000
#define FALSE 0
#define TRUE 1

void getInput();
int validInput();

int main() {
  char* userInput[MAX_INPUT_SIZE];

  getInput(&userInput);

  if (validInput(&userInput) == TRUE)
    printf("Compile complete");
  else
    printf("Error");
}

// Functions
void getInput(char* output) {
  int c, i;
  for(i=0; (c = getchar()) != '\n' && c != EOF && i <= MAX_INPUT_SIZE; i++)
    output[i] = c;
  output[i] = '\0';
}

int validInput(char* input) {
  char stack[STACK_SIZE];
  int c;
  int j;

  for (j=0; (c = input[j]) != '\0'; ) {
    switch(c){
      case '[': case '(': case '{':
        stack[j++] = c;
        break;
      case ']': case ')': case '}':
        if (c == ']' && stack[j] != '[')
          return FALSE;
        else if (c == '}' && stack[j] != '{')
          return FALSE;
        else if (c == ')' && stack[j] != '(')
          return FALSE;

        // decrement the stack's index  
        --j;
        break;
    }
  }

  return TRUE;
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-22T06:52:37.193

您是否尝试过使用调试器？您应该单步执行 gdb 或 Visual Studio 或您正在使用的任何代码中的代码，看看发生了什么。你说你是一个初学者，所以也许你还没有考虑过 - 这是一种非常正常的调试技术。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-23T04:09:37.007

这是最终的工作代码。我必须说我从做这个中学到了很多。感谢您的帮助和指点。

关于如何做得更好的任何建议？

```
#include <stdio.h>

#define STACK_SIZE 50
#define MAX_INPUT_SIZE 1000
#define FALSE 0
#define TRUE !FALSE

void get_input();
int valid_input();

int main() {
  char user_input[MAX_INPUT_SIZE + 1]; // +1 for the \0

  get_input(user_input);

  if (valid_input(user_input))
    printf("Success\n");
  else
    printf("Error\n");
}

// Functions
void get_input(char* output) {
  int c, i;
  for(i=0; (c = getchar()) != '\n' && c != EOF && i <= MAX_INPUT_SIZE; i++)
    output[i] = c;
  output[i] = '\0';
}

int valid_input(char* input) {
  char stack[STACK_SIZE];
  char c;
  int i = 0;
  int stack_index = -1;

  while ((c = input[i]) != '\0' && i < STACK_SIZE) {
    switch(c){
      case '[': case '(': case '{':
        stack_index++; 
        stack[stack_index] = c;
        break;
      case ']': case ')': case '}':
        if ((c == ']' && stack[stack_index] != '[') ||
            (c == '}' && stack[stack_index] != '{') ||
            (c == ')' && stack[stack_index] != '('))
          return FALSE;

        // decrement the stack's index now that the closing bracket is found  
        stack_index--;
        break;
    }
    i++;
  }

  // stack index should be back where it started
  return (stack_index == -1);
} 
```

# asp.net - Server.Transfer Vs. Response.Redirect

> ID：224569
> 
> 赞同：272
> 
> 时间：2008-10-22T05:34:46.057
> 
> 标签：asp.net, redirect, server.transfer

What is difference between `Server.Transfer` and `Response.Redirect`?

*   What are advantages and disadvantages of each?
*   When is one appropriate over the other?
*   When is one not appropriate?

* * *

## 回答 #1

> 赞同：241
> 
> 时间：2008-10-22T05:41:06.637

`Response.Redirect` simply sends a message [(HTTP 302)](http://en.wikipedia.org/wiki/HTTP_302) down to the browser.

`Server.Transfer` happens without the browser knowing anything, the browser request a page, but the server returns the content of another.

* * *

## 回答 #2

> 赞同：103
> 
> 时间：2008-10-22T05:44:56.627

`Response.Redirect()` will send you to a new page, update the address bar and add it to the Browser History. On your browser you can click back.

`Server.Transfer()` does not change the address bar. You cannot hit back.

I use `Server.Transfer()` when I don't want the user to see where I am going. Sometimes on a "loading" type page.

Otherwise I'll always use `Response.Redirect()`.

* * *

## 回答 #3

> 赞同：76
> 
> 时间：2009-02-06T18:39:31.580

To be Short: `Response.Redirect` simply tells the browser to visit another page. `Server.Transfer` helps reduce server requests, keeps the URL the same and, with a little bug-bashing, allows you to transfer the query string and form variables.

Something I found and agree with ([source](http://www.developer.com/net/asp/article.php/3299641/ServerTransfer-Vs-ResponseRedirect.htm)):

> `Server.Transfer` is similar in that it sends the user to another page with a statement such as `Server.Transfer("WebForm2.aspx")`. However, the statement has a number of distinct advantages and disadvantages.
> 
> Firstly, transferring to another page using `Server.Transfer` conserves server resources. Instead of telling the browser to redirect, it simply changes the "focus" on the Web server and transfers the request. This means you don't get quite as many HTTP requests coming through, which therefore eases the pressure on your Web server and makes your applications run faster.
> 
> But watch out: because the "transfer" process can work on only those sites running on the server; you can't use `Server.Transfer` to send the user to an external site. Only `Response.Redirect` can do that.
> 
> Secondly, `Server.Transfer` maintains the original URL in the browser. This can really help streamline data entry techniques, although it may make for confusion when debugging.
> 
> That's not all: The `Server.Transfer` method also has a second parameter—"preserveForm". If you set this to `True`, using a statement such as `Server.Transfer("WebForm2.aspx", True)`, the existing query string and any form variables will still be available to the page you are transferring to.
> 
> For example, if your WebForm1.aspx has a TextBox control called TextBox1 and you transferred to WebForm2.aspx with the preserveForm parameter set to True, you'd be able to retrieve the value of the original page TextBox control by referencing `Request.Form("TextBox1")`.

* * *

## 回答 #4

> 赞同：38
> 
> 时间：2011-11-11T08:24:54.137

`Response.Redirect()` should be used when:

*   we want to redirect the request to some plain HTML pages on our server or to some other web server
*   we don't care about causing additional roundtrips to the server on each request
*   we do not need to preserve Query String and Form Variables from the original request
*   we want our users to be able to see the new redirected URL where he is redirected in his browser (and be able to bookmark it if its necessary)

`Server.Transfer()` should be used when:

*   we want to transfer current page request to another .aspx page on the same server
*   we want to preserve server resources and avoid the unnecessary roundtrips to the server
*   we want to preserve Query String and Form Variables (optionally)
*   we don't need to show the real URL where we redirected the request in the users Web Browser

* * *

## 回答 #5

> 赞同：28
> 
> 时间：2009-02-06T18:29:54.907

Response.Redirect redirects page to another page **after** first page arrives to client. So client knows the redirection.

Server.Transfer quits current execution of the page. Client does not know the redirection. It allows you to transfer the query string and form variables.

So it depends to your needs to choose which is better.

* * *

## 回答 #6

> 赞同：23
> 
> 时间：2014-05-19T10:07:29.217

![enter image description here](https://i.stack.imgur.com/s8pUx.png)

"response.redirect" and "server.transfer" helps to transfer user from one page to other page while the page is executing. But the way they do this transfer / redirect is very different.

In case you are visual guy and would like see demonstration rather than theory I would suggest to see the below facebook video which explains the difference in a more demonstrative way.

[https://www.facebook.com/photo.php?v=762186150488997](https://www.facebook.com/photo.php?v=762186150488997)

The main difference between them is who does the transfer. In "response.redirect" the transfer is done by the browser while in "server.transfer" it’s done by the server. Let us try to understand this statement in a more detail manner.

In "Server.Transfer" following is the sequence of how transfer happens:-

1.User sends a request to an ASP.NET page. In the below figure the request is sent to "WebForm1" and we would like to navigate to "Webform2".

2.Server starts executing "Webform1" and the life cycle of the page starts. But before the complete life cycle of the page is completed “Server.transfer” happens to "WebForm2".

3."Webform2" page object is created, full page life cycle is executed and output HTML response is then sent to the browser.

![enter image description here](https://i.stack.imgur.com/zvkcK.png)

While in "Response.Redirect" following is the sequence of events for navigation:-

1.Client (browser) sends a request to a page. In the below figure the request is sent to "WebForm1" and we would like to navigate to "Webform2".

2.Life cycle of "Webform1" starts executing. But in between of the life cycle "Response.Redirect" happens.

3.Now rather than server doing a redirect , he sends a HTTP 302 command to the browser. This command tells the browser that he has to initiate a GET request to "Webform2.aspx" page.

4.Browser interprets the 302 command and sends a GET request for "Webform2.aspx".

![enter image description here](https://i.stack.imgur.com/Bp9QX.png)

In other words "Server.Transfer" is executed by the server while "Response.Redirect" is executed by thr browser. "Response.Redirect" needs to two requests to do a redirect of the page.

**So when to use "Server.Transfer" and when to use "Response.Redirect" ?**

Use "Server.Transfer" when you want to navigate pages which reside on the same server, use "Response.Redirect" when you want to navigate between pages which resides on different server and domain.

![enter image description here](https://i.stack.imgur.com/aKITW.png)

Below is a summary table of which chalks out differences and in which scenario to use.

![enter image description here](https://i.stack.imgur.com/ThwSB.png)

* * *

## 回答 #7

> 赞同：11
> 
> 时间：2013-02-25T16:38:46.123

The beauty of Server.Transfer is what you can do with it:

```
TextBox myTxt = (TextBox)this.Page.PreviousPage.FindControl("TextBoxID"); 
```

You can get anything from your previous page using the above method as long as you use Server.Transfer but not Response.Redirect

* * *

## 回答 #8

> 赞同：10
> 
> 时间：2009-02-06T18:38:05.903

In addition to ScarletGarden's comment, you also need to consider the impact of search engines and your redirect. Has this page moved permanently? Temporarily? It makes a difference.

see: [Response.Redirect vs. "301 Moved Permanently"](http://www.asp101.com/tips/index.asp?id=161):

> We've all used Response.Redirect at one time or another. It's the quick and easy way to get visitors pointed in the right direction if they somehow end up in the wrong place. But did you know that Response.Redirect sends an HTTP response status code of "302 Found" when you might really want to send "301 Moved Permanently"?
> 
> The distinction seems small, but in certain cases it can actually make a big difference. For example, if you use a "301 Moved Permanently" response code, most search engines will remove the outdated link from their index and replace it with the new one. If you use "302 Found", they'll continue returning to the old page...

* * *

## 回答 #9

> 赞同：8
> 
> 时间：2013-08-09T11:07:24.230

There are many differences as specified above. Apart from above all, there is one more difference. `Response.Redirect()` can be used to redirect user to any page which is not part of the application but `Server.Transfer()` can only be used to redirect user within the application.

```
//This will work.
Response.Redirect("http://www.google.com");

//This will not work.
Server.Transfer("http://www.google.com"); 
```

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2008-10-22T05:42:15.230

Transfer is entirely server-side. Client address bar stays constant. Some complexity about the transfer of context between requests. Flushing and restarting page handlers can be expensive so do your transfer early in the pipeline e.g. in an HttpModule during BeginRequest. Read the MSDN docs carefully, and test and understand the new values of HttpContext.Request - especially in Postback scenarios. We usually use Server.Transfer for error scenarios.

Redirect terminates the request with a 302 status and client-side roundtrip response with and internally eats an exception (minor server perf hit - depends how many you do a day) Client then navigates to new address. Browser address bar & history updates etc. Client pays the cost of an extra roundtrip - cost varies depending on latency. In our business we redirect *a lot* we wrote our own module to avoid the exception cost.

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2008-10-22T05:41:53.747

Response.Redirect is more costly since it adds an extra trip to the server to figure out where to go.

Server.Transfer is more efficient however it can be a little mis-leading to the user since the Url doesn't physically change.

In my experience, the difference in performance has not been significant enough to use the latter approach

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2009-02-06T18:38:05.450

Server.Transfer doesn't change the URL in the client browser, so effectively the browser does not know you changed to another server-side handler. Response.Redirect tells the browser to move to a different page, so the url in the titlebar changes.

Server.Transfer is slightly faster since it avoids one roundtrip to the server, but the non-change of url may be either good or bad for you, depending on what you're trying to do.

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2012-01-24T01:43:20.143

**Response.Redirect:** tells the browser that the requested page can be found at a new location. The browser then initiates another request to the new page loading its contents in the browser. This results in two requests by the browser.

**Server.Transfer:** It transfers execution from the first page to the second page on the server. As far as the browser client is concerned, it made one request and the initial page is the one responding with content. The benefit of this approach is one less round trip to the server from the client browser. Also, any posted form variables and query string parameters are available to the second page as well.

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2013-09-12T05:43:30.217

Just more details about Transfer(), it's actually is Server.Execute() + Response.End(), its source code is below (from Mono/.net 4.0):

```
public void Transfer (string path, bool preserveForm)
{
    this.Execute (path, null, preserveForm, true);
    this.context.Response.End ();
} 
```

and for Execute(), what it is to run is the **handler** of the given path, see

> ASP.NET does not verify that the current user is authorized to view the resource delivered by the *Execute* method. Although the ASP.NET authorization and authentication logic runs before the original resource handler is called, ASP.NET directly calls the handler indicated by the *Execute* method and does not rerun authentication and authorization logic for the new resource. If your application's security policy requires clients to have appropriate authorization to access the resource, the application should force reauthorization or provide a custom access-control mechanism.
> 
> You can force reauthorization by using the *Redirect* method instead of the *Execute* method. *Redirect* performs a client-side redirect in which the browser requests the new resource. Because this redirect is a new request entering the system, it is subjected to all the authentication and authorization logic of both Internet Information Services (IIS) and ASP.NET security policy.
> 
> -[from MSDN](http://msdn.microsoft.com/en-us/library/23e7sy74.aspx)

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2014-05-14T01:23:28.217

Response.Redirect involves an extra round trip and updates the address bar.

Server.Transfer does not cause the address bar to change, the server responds to the request with content from another page

e.g.

**Response.Redirect:-**

1.  On the client the browser requests a page [http://InitiallyRequestedPage.aspx](http://InitiallyRequestedPage.aspx)
2.  On the server responds to the request with 302 passing the redirect address [http://AnotherPage.aspx](http://AnotherPage.aspx).
3.  On the client the browser makes a second request to the address [http://AnotherPage.aspx](http://AnotherPage.aspx).
4.  On the server responds with content from [http://AnotherPage.aspx](http://AnotherPage.aspx)

**Server.Transfer:-**

1.  On the client browser requests a page [http://InitiallyRequestedPage.aspx](http://InitiallyRequestedPage.aspx)
2.  On the server Server.Transfer to [http://AnotherPage.aspx](http://AnotherPage.aspx)
3.  On the server the response is made to the request for [http://InitiallyRequestedPage.aspx](http://InitiallyRequestedPage.aspx) passing back content from [http://AnotherPage.aspx](http://AnotherPage.aspx)

**Response.Redirect**

*Pros:-* RESTful - It changes the address bar, the address can be used to record changes of state inbetween requests.

*Cons:-* Slow - There is an extra round-trip between the client and server. This can be expensive when there is substantial latency between the client and the server.

**Server.Transfer**

*Pros:-* Quick.

*Cons:*- State lost - If you're using Server.Transfer to change the state of the application in response to post backs, if the page is then reloaded that state will be lost, as the address bar will be the same as it was on the first request.

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2015-07-20T13:33:53.640

**Response.Redirect** Response.Redirect() will send you to a new page, update the address bar and add it to the Browser History. On your browser you can click back. It redirects the request to some plain HTML pages on our server or to some other web server. It causes additional roundtrips to the server on each request. It doesn’t preserve Query String and Form Variables from the original request. It enables to see the new redirected URL where it is redirected in the browser (and be able to bookmark it if it’s necessary). Response. Redirect simply sends a message down to the (HTTP 302) browser.

**Server.Transfer** Server.Transfer() does not change the address bar, we cannot hit back.One should use Server.Transfer() when he/she doesn’t want the user to see where he is going. Sometime on a "loading" type page. It transfers current page request to another .aspx page on the same server. It preserves server resources and avoids the unnecessary roundtrips to the server. It preserves Query String and Form Variables (optionally). It doesn’t show the real URL where it redirects the request in the users Web Browser. Server.Transfer happens without the browser knowing anything, the browser request a page, but the server returns the content of another.

# image-processing - 如何从指纹图像中去除背景？

> ID：224570
> 
> 赞同：8
> 
> 时间：2008-10-22T05:34:50.690
> 
> 标签：image-processing, fingerprint

我有一张从滑动扫描仪拍摄的指纹图像。但是输出没有干净的背景。它看起来像这样：

[脏 http://img208.imageshack.us/img208/2622/dirtyie0.png](http://img208.imageshack.us/img208/2622/dirtyie0.png)

我想删除背景，以便进一步处理更准确。像这样的东西：

[清理 http://img515.imageshack.us/img515/7530/cleanhh6.png](http://img515.imageshack.us/img515/7530/cleanhh6.png)

怎么做？可以使用什么图像处理技术（如果有）？谢谢你。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-22T06:33:02.663

您可以检查像素周围区域的频谱。您拥有的高频分量越少，像素就越有可能是背景的一部分。

最复杂的方法是运行像素块的 FFT 并直接检查光谱。由于指纹具有不同的频谱，因此应该很容易将背景与指纹分开。

使用 Wavelets 也值得一试。这使您可以直接将图像分割成感兴趣频率的子带。找到一个好的小波需要大量的练习。

如果您想要一个不过度杀伤的解决方案，如果您运行图像的高通滤波器并将其用于简单的掩码查找通道，则*可能会很好。*以下是其工作原理的粗略概述：

1.  标准化图像：最暗像素变为 -1，最亮像素变为 1。如果您更喜欢使用字节，也可以使用 -128 / 127。

2.  在图像上运行高斯模糊。试验半径。

3.  从模糊图像中减去归一化图像。通过饱和到 -1 和 1 处理溢出。图像现在大致看起来像是边缘检测到的，但使用灰色阴影而不是二进制掩码。

4.  对步骤 3 中的图像运行掩码传递。每个像素的绝对值越高，它是指纹一部分的机会就越高。您可以通过选择一个好的阈值来生成掩码。

5.  使用掩码准备您的源图像。

为了完整起见，您还可以使用图像形态学来做到这一点：

1.  在图像上运行边缘检测器。使用 Canny 检测器是一个不错的选择，但简单的 3x3 边缘检测器内核也可以。

2.  在边缘上运行多个膨胀通道。这将在每次通过时在所有白色像素周围增加一个边框，并使边缘更厚。这样做直到指纹的所有区域都被白色像素覆盖。在您的示例中，我认为 4 或 5 次通过就足够了。

3.  您现在可以直接将扩张后的图像用作蒙版。

链接：扩张[http://homepages.inf.ed.ac.uk/rbf/HIPR2/dilate.htm](http://homepages.inf.ed.ac.uk/rbf/HIPR2/dilate.htm)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-22T06:04:08.540

您可以尝试使用边缘检测过滤器。这将有助于消除背景噪音，并可能在其余处理过程中增强指纹特征。

[Canny 边缘检测器](http://en.wikipedia.org/wiki/Canny_edge_detector)可能是第一个尝试的好方法。甚至还有一个[您可以尝试的免费 Web 实现](http://matlabserver.cs.rug.nl/cannyedgedetectionweb/web/index.html)和一个[可用的公共域 Java 实现](http://www.tomgibara.com/computer-vision/canny-edge-detector)。

编辑：很好奇它是如何工作的，所以我在默认设置下尝试了 Web 实现——还不错。它似乎确实在其中提出了一些“幻像”功能，但总的来说它看起来更容易处理。

[替代文字 http://img356.imageshack.us/img356/5/ml00055edgedetectionwp7.png](http://img356.imageshack.us/img356/5/ml00055edgedetectionwp7.png)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-22T06:43:27.663

尝试一些对比度增强（例如墨西哥帽子），然后进行一些高级增强。我们在使用 Gabor 滤波器技术改进树干年代学的树干 CT 图像时取得了良好的效果。我们使用了 gabor 过滤器，因为它们广泛用于指纹匹配系统，而且我们的图像有些相似。之后你所要做的就是一些（我建议本地自适应）阈值，你得到了你的二进制图像。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-22T05:53:30.103

首先，我将对比度增加到 100% 以获得纯黑白图像（不是灰度）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2015-07-10T17:13:53.787

有许多类型的算法可以对指纹进行分割。其中一个适用于传感器（您的情况）的方法是基于图像中每个像素的**均值**和**方差。**以下是算法的步骤，您可以在此处找到：

[指纹分割：各种技术的研究和基于方差的方法的参数研究](http://www.ijicic.org/ijicic-10-03078.pdf)

**1.**加载大小为 R x C 像素的图像。这里指纹里面的内容无所谓，所以我覆盖一下。您可以看到指纹周围的噪点（小点），这是从传感器拍摄的高质量图像，可能您的图像质量较差且背景噪点较多。![指纹 R x C 大小（以像素为单位）](https://i.stack.imgur.com/rWBpf.png)

**2.**我没有像论文中那样对图像进行归一化。因此，下一步是定义大小为*w* x *w*的像素块，并将图像划分为非重叠块。

**3.**对于每个像素移动块并计算均值和方差。将每个方差保存在矩阵中以供进一步比较。你将不得不威胁边界。 ![wxw的像素块](https://i.stack.imgur.com/aTrBD.png)

**4.**定义一个阈值。在 a **w = 15**的论文中，阈值是**T = 210**。

**5.**对于每个方差与阈值比较，如果较小则为背景，否则为指纹本身。

完成所有这些步骤后，您将获得背景噪点较少的图像。类似于这个：![分割图像](https://i.stack.imgur.com/Dz1fY.png)

这是论文中的算法：![论文算法](https://i.stack.imgur.com/QEtdn.png)

对于其他算法，请参阅：

[一种改进的基于均值和方差的指纹分割算法](http://ieeexplore.ieee.org/xpl/articleDetails.jsp?arnumber=5072716)

[使用新的改进的基于梯度的技术改进指纹图像分割](http://ieeexplore.ieee.org/xpl/articleDetails.jsp?arnumber=4564888)

# sql-server - SQL Server 2005 会惩罚我使用 nvarchar(50) 作为主键，而不是整数？

> ID：224576
> 
> 赞同：12
> 
> 时间：2008-10-22T05:40:23.157
> 
> 标签：sql-server, sql-server-2005, primary-key

我正在考虑更改一些表以使用 nvarchar(50) 作为主键而不是 int 主键。对键使用 int ID 确实是不相关的数据，它是我感兴趣的字符串。会发生什么样的性能损失，或者你在哪里研究这个？除了削减和尝试是。

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2008-10-22T05:54:42.100

您遇到了数据库设计的主要“圣战”之一。您所指的辩论是“代理与自然键”的争论，只要有 RDBMS（据我所知），它就一直在肆虐。

争论本质上归结为是否应该使用代表性键（代理，例如 IDENTITY 列）与使用唯一描述记录的实际数据（自然键）。

我会说没有“正确”的答案。性能度量是平台的产物，应该通过实验来评估，但性能不太可能是主要关注点。

我认为代理键的主要论点是主键的不变性。如果您选择使用自然密钥，您将放弃在该密钥建立后更改该密钥的选项。你也放弃了它在未来某个时候可能变得非唯一的可能性。由于这些原因，我通常（并非总是）对我的大多数表使用代理键。

然而，正如我所提到的，如果你愿意的话，有一个长期存在的争论，充满了关于索引策略和范式遵守的讨论。

我会谷歌“代理与自然键”。以下是一些帮助您入门的链接：

[系统工程和 RDBMS](http://decipherinfosys.wordpress.com/2007/02/01/surrogate-keys-vs-natural-keys-for-primary-key/)

[技术共和国](https://web.archive.org/web/1/http://articles.techrepublic%2ecom%2ecom/5100-10878_11-1045050.html)

[托尼·罗杰森的博客](http://sqlblogcasts.com/blogs/tonyrogerson/archive/2006/05/11/427.aspx)

希望这可以帮助。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-22T05:48:11.050

考虑使用代理键（int 主键）作为主键/聚集索引键。使用 nvarchar(50) 作为主键/聚集索引键的问题在于，您的表将按该键排序，这意味着它可能会变得高度碎片化，并且任何其他索引都会有引用这个沉重的负担首要的关键。

另一个问题是，您可能需要通过这种类型的值在其他表上 JOIN，随着键大小的增长，这是一个更昂贵的操作。

我认为很少有 nvarchar(50) 主键有意义的情况。

通常，主键应该是代理项，除非您有一个小的自然不可变键。可以说，例如，SSN 可以被视为天然的不可变密钥。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-22T05:49:47.007

对于性能，我通常会问以下问题：

*   多少行？1,000 或 1,000,000 或 1,0000,000 ??

*   它坐在什么服务器上？（内存，磁盘空间）

我会分析它然后看看。通常对我来说，瓶颈不是数据库，而是写得不好的代码，糟糕的部署等等……

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-22T11:41:21.633

为了彻底消除自然键解决方案（[cf surrogate vs natural key war](https://stackoverflow.com/questions/224576/will-sql-server-2005-penalize-me-for-using-an-nvarchar50-as-a-primary-key-inste#224596)）的领导者提出的所有论点，并简而言之，我应该说代理键总是有效，而自然键有一个松散的倾向遇到问题和沮丧，通常是在意想不到的时候。

我并不是说它们是每种情况的最佳解决方案，但是为了避免在创建表时浪费您（和其他人）的时间来考虑最佳自然键的适当参数，只需选择代理，就可以了。如果您的表似乎有一个适当的自然键，只需将其添加为具有（唯一？）索引的字段。

为了方便开发人员，始终将您的第一个字段作为主键，第二个字段是假定/伪自然键。你的表应该是这样的：

```
Tbl_whatever
     id_whatever, unique identifier, primary key
     code_whatever, nvarchar(your favorite length), indexed
     ..... 
```

其中 id_ 是主键的前缀，而 code_ 用于“自然”索引字段

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2008-10-22T10:42:20.490

为什么选择 UNICODE？例如，如果我将一个英文单词翻译成中文汉字，它们会被认为是重复的吗？

为什么是可变的？固定宽度是键的良好物理特性。

为什么是 50 个字符？这对用户来说是很多键控（我同意“密钥的 int ID 确实是不相关的数据”，并认为这种所谓的“代理键”永远不应该暴露给最终用户，顺便说一句）。

另外，对我`NVARCHAR(50)`来说有点“味道”：微软的默认设置，也许是 MS Access 的直接端口？这并不意味着您没有对您的密钥给予应有的考虑和考虑，当然，这只是其中一项可能需要审查的事情。

哦，等等：你的意思是专门的 PRIMARY KEY，对吧？假设您明确使用一个（每个表）聚集索引，AFAIK PRIMARY KEY 指定在 SQL Server 领域没有物理意义。当然，你所有的候选键都应该被 NOT NULL UNIQUE 约束所覆盖；您选择提升为 PRIMARY 键的那个是任意的。

# java - 深度初始化 Java Bean 属性

> ID：224583
> 
> 赞同：1
> 
> 时间：2008-10-22T05:44:38.313
> 
> 标签：java, javabeans

您是否为初始化 java bean 值而烦恼？比如说：

（[g|s] 字母省略）

```
public class SomeClass {

    private String foo;

    private Date bar;

    private Baz someObject;

} 
```

（是的，这是一个 POJO 被用作 bean，而不是严格意义上的 Java Bean）

在空的构造函数中，你是初始化这些成员，还是干脆什么都不做？同样，Baz 也会初始化它的成员吗？

还是您只是将它们保留为空？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-22T06:01:11.167

这取决于用例。

如果我使用属性作为服务依赖项，它们应该被初始化以正常运行（顺便说一句，Spring DI 有方便的方法来做到这一点）。

如果我使用 bean 作为域模型的一部分，那么拥有一些 null 属性通常是非法状态。它可能在启动时没有初始化，但是如果在业务操作期间某些字段为空，我会抛出 IllegalStateException。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-13T20:22:31.880

如果可能的话，如果需要初始化变量，我会在声明时初始化它们。这些初始化语句实际上最终是从构造函数中调用的。

如果没有令人信服的理由来初始化它们，我通常会将它们保留为空。

# html - 如何让 div 元素内联显示？

> ID：224602
> 
> 赞同：282
> 
> 时间：2008-10-22T05:59:35.943
> 
> 标签：html, css

鉴于此 HTML：

```
<div>foo</div><div>bar</div><div>baz</div> 
```

你如何让它们像这样内联显示：

> 富吧巴兹

不是这样的：

> 富
> 吧
> 巴兹

* * *

## 回答 #1

> 赞同：288
> 
> 时间：2008-10-22T06:09:47.560

那是另外一回事：

```
div.inline { float:left; }
.clearBoth { clear:both; }
```

```
<div class="inline">1<br />2<br />3</div>
<div class="inline">1<br />2<br />3</div>
<div class="inline">1<br />2<br />3</div>
<br class="clearBoth" /><!-- you may or may not need this -->
```

* * *

## 回答 #2

> 赞同：286
> 
> 时间：2008-12-31T15:01:29.933

内联 div 是网络的怪胎，应该被打败，直到它变成一个跨度（至少 9 次 / 10）......

```
<span>foo</span>
<span>bar</span>
<span>baz</span> 
```

...回答原来的问题...

* * *

## 回答 #3

> 赞同：191
> 
> 时间：2008-10-22T06:02:07.827

试着这样写：

```
div { border: 1px solid #CCC; }
```

```
 <div style="display: inline">a</div>
    <div style="display: inline">b</div>
    <div style="display: inline">c</div>
```

* * *

## 回答 #4

> 赞同：35
> 
> 时间：2008-12-31T16:07:51.373

在阅读了这个问题和答案几次之后，我所能做的就是假设正在进行相当多的编辑，我怀疑您由于没有提供足够的信息而得到了错误的答案。我的线索来自`br`标签的使用。

**向达里尔道歉。我将 class="inline" 读为 style="display: inline"。即使您确实使用了语义上有问题的类名，您也有正确的答案；-)**

提供结构布局而不是文本布局的错误使用`br`对我来说太普遍了。

如果您想在其中放置更多的内联元素，`divs`那么您应该浮动这些`div`s 而不是使它们内联。

浮动div：

```
===== ======= ==   **** ***** ******   +++++ ++++
===== ==== =====   ******** ***** **   ++ +++++++
=== ======== ===   ******* **** ****   
===== ==== =====                       +++++++ ++
====== == ====== 
```

内联 div：

```
====== ==== ===== ===== == ==== *** ******* ***** ***** 
**** ++++ +++ ++ ++++ ++ +++++++ +++ ++++ 
```

如果您追求前者，那么这就是您的解决方案并丢失这些`br`标签：

```
<div style="float: left;" >
  <p>block level content or <span>inline content</span>.</p>
  <p>block level content or <span>inline content</span>.</p>
</div>
<div style="float: left;" >
  <p>block level content or <span>inline content</span>.</p>
  <p>block level content or <span>inline content</span>.</p>
</div>
<div style="float: left;" >
  <p>block level content or <span>inline content</span>.</p>
  <p>block level content or <span>inline content</span>.</p>
</div> 
```

请注意，这些 div 的宽度是可变的，因此如果您想控制行为，请随意在它们上设置宽度。

谢谢，史蒂夫

* * *

## 回答 #5

> 赞同：24
> 
> 时间：2012-01-07T00:06:30.380

`display:inline-block`与 IE6/7 的边距和媒体查询一起使用：

```
<html>
  <head>
    <style>
      div { display:inline-block; }
      /* IE6-7 */
      @media,
          {
          div { display: inline; margin-right:10px; }
          }
   </style>
  </head>
  <div>foo</div>
  <div>bar</div>
  <div>baz</div>
</html> 
```

* * *

## 回答 #6

> 赞同：16
> 
> 时间：2015-11-10T11:41:03.283

> 您应该使用`<span>`而不是`<div>`正确的 **inline**方式。因为 div 是块级元素，而您的要求是内联块级元素。

这是根据您的要求的html代码：

```
<div class="main-div">
 <div>foo</div>
 <div>bar</div>
 <div>baz</div>`
</div> 
```

## 你有两种方法可以做到这一点

* * *

*   使用简单`display:inline-block;`
*   或使用`float:left;`

所以你必须`display:inline-block;`强行改变显示属性

**示例一**

```
div {
    display: inline-block;
} 
```

**示例二**

```
div {
    float: left;
} 
```

> 你需要清除浮动

```
.main-div:after {
    content: "";
    clear: both;
    display: table;
} 
```

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2008-12-31T15:06:49.000

如前所述， display:inline 可能是您想要的。一些浏览器还支持内联块。

[http://www.quirksmode.org/css/display.html#inlineblock](http://www.quirksmode.org/css/display.html#inlineblock)

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2011-09-20T11:42:49.060

只需使用带有“float：left”的包装器div，并将盒子放在里面也包含float：left：

CSS：

```
wrapperline{
width: 300px;
float: left;
height: 60px;
background-color:#CCCCCC;}

.boxinside{
width: 50px;
float: left;
height: 50px;
margin: 5px;
background-color:#9C0;
float:left;} 
```

HTML：

```
<div class="wrapperline">
<div class="boxinside">Box 1</div>
<div class="boxinside">Box 1</div>
<div class="boxinside">Box 1</div>
<div class="boxinside">Box 1</div>
<div class="boxinside">Box 1</div>
</div> 
```

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2014-12-22T10:31:18.550

我可以 ：

```
<style type="text/css">
    div{
        position: relative;
        display: inline-block;
        width:25px;
        height:25px;
    }
</style>
<div>toto</div>
<div>toto</div>
<div>toto</div> 
```

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2008-10-22T08:39:45.603

`<span>`?

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2008-10-22T06:04:33.140

```
<style type="text/css">
div.inline { display:inline; }
</style>
<div class="inline">a</div>
<div class="inline">b</div>
<div class="inline">c</div> 
```

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2011-02-12T02:56:37.440

我知道人们说这是一个糟糕的想法，但如果你想做一些像平铺图像这样在它们下面有评论的东西，它在实践中会很有用。例如，Picasaweb 使用它来显示相册中的缩略图。
参见示例/演示[http://closure-library.googlecode.com/svn/trunk/closure/goog/demos/inline_block_quirks.html](http://closure-library.googlecode.com/svn/trunk/closure/goog/demos/inline_block_quirks.html)（类 goog-inline-block ；我在这里将其缩写为 ib ）

```
/* below is a set of hacks to make inline-block work right on divs in IE. */
html > body .ib { display:inline-block; }
.ib {display:inline-block;position:relative;}
* html .ib { display: inline; }
:first-child + html .ib { display:inline; } 
```

鉴于该 CSS，将您的 div 设置为 ib 类，现在它神奇地成为一个内联块元素。

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2011-04-16T23:51:07.680

我会使用跨度或将 div 向左浮动。浮动的唯一问题是您必须在之后清除浮动，或者包含的 div 必须将溢出样式设置为 auto

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2011-01-26T13:55:11.430

您需要包含三个 div。这是一个例子：

**CSS**

```
div.contain
{
  margin:3%;
  border: none;
  height: auto;
  width: auto;
  float: left;
}

div.contain div
{
  display:inline;
  width:200px;
  height:300px;
  padding: 15px;
  margin: auto;
  border:1px solid red;
  background-color:#fffff7;
  -moz-border-radius:25px; /* Firefox */
  border-radius:25px;
} 
```

注意：border-radius 属性是可选的，仅在兼容 CSS3 的浏览器中有效。

**HTML**

```
<div class="contain">
  <div>Foo</div>
</div>

<div class="contain">
  <div>Bar</div>
</div>

<div class="contain">
  <div>Baz</div>
</div> 
```

请注意，div 'foo' 'bar' 和 'baz' 都保存在 'contain' div 中。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2015-02-23T10:03:04.150

我认为您可以在不使用任何 CSS 的情况下使用这种方式 -

```
<table>
    <tr>
        <td>foo</td>
    </tr>
    <tr>
        <td>bar</td>
    </tr>
    <tr>
        <td>baz</td>
    </tr>
</table> 
```

现在，您正在使用块级元素，这样您就会得到不需要的结果。所以你可以内联元素，如 span、small 等。

```
<span>foo</span><span>bar</span><span>baz</span> 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2012-09-25T02:53:58.943

我们可以这样做

```
.left {
    float:left;
    margin:3px;
}
<div class="left">foo</div>
<div class="left">bar</div>
<div class="left">baz</div> 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2014-08-20T03:54:20.457

```
<div class="cdiv">
<div class="inline"><p>para 1</p></div>
 <div class="inline">
     <p>para 1</p>
     <span>para 2</span>
     <h1>para 3</h1>
</div>
 <div class="inline"><p>para 1</p></div> 
```

[http://jsfiddle.net/f8L0y5wx/](http://jsfiddle.net/f8L0y5wx/)

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2016-02-08T02:29:52.313

```
<div>foo</div><div>bar</div><div>baz</div>
//solution 1
<style>
    #div01, #div02, #div03 {
                                float:left;
                                width:2%;
    }   
 </style>
 <div id="div01">foo</div><div id="div02">bar</div><div id="div03">baz</div>

 //solution 2

 <style>
      #div01, #div02, #div03 {
                                  display:inline;
                                  padding-left:5px;
      }   
</style>
<div id="div01">foo</div><div id="div02">bar</div><div id="div03">baz</div>

 /* I think this would help but if you have any other thoughts just let me knw      kk */ 
```

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2022-01-21T09:19:40.790

这对我有用。我正在使用引导程序，我想内联单选按钮：

```
 <div class="form-group form-inline-radio">
                    <div class="form-check form-radio-outline form-radio-primary mb-3">
                        <input type="radio" name="formRadio4" id="formRadio4" checked="" class="form-check-input">
                        <label for="formRadio4" class="form-check-label"> Radio Outline Warning </label>
                    </div>
                    <div class="form-check form-radio-outline form-radio-primary mb-3">
                        <input type="radio" name="formRadio4" id="formRadio4" checked="" class="form-check-input">
                        <label for="formRadio4" class="form-check-label"> Radio Outline Warning </label>
                    </div>
                </div> 
```

和CSS：

```
.form-inline-radio {
    display: flex;
    overflow: hidden;
}

.form-check {
    margin-right: 10px;
} 
```

* * *

## 回答 #20

> 赞同：-1
> 
> 时间：2010-01-08T11:18:14.063

我只是倾向于使它们固定宽度，以便它们加起来等于页面的总宽度 - 可能仅在您使用固定宽度页面时才有效。还有“浮动”。

# sql-server - 是否可以使用 sp_executesql 等动态参数编写存储过程？

> ID：224606
> 
> 赞同：0
> 
> 时间：2008-10-22T06:00:56.940
> 
> 标签：sql-server, tsql

是否可以使用 sp_executesql 等动态参数编写存储过程（在 tsql 或其他变体中）？

即事先不知道参数的数量和类型，应该在客户端动态构建。就像您可以将任意数量的任意类型的参数传递给 sp_executesql 一样。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-22T08:41:48.160

您可以将数组作为带有一些分隔符的字符串传递，例如 val1$datatype1$;val2$datatype2... 使用循环来构建字符串。有点老派，但在客户端和服务器端很容易做到。

一段 XML 会更好，你可以在服务器上使用 XML 函数对其进行转换（对我来说它们有点麻烦）。

如果您对这些值有更复杂的事情，您可以考虑使用服务器端 .NET 过程。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-22T08:54:33.750

看看[这个问题](https://stackoverflow.com/questions/144550/sql-server-dynamic-where-clause)中接受的答案。这里建议我使用 MS SQL 的内置 XML 函数来构造一个动态的 where 子句。

澄清一下：我建议您将动态参数包装在 XML 中。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-22T06:44:34.870

我使用自定义字段。类型和数量未知。

我可以使用 sp_executesql。问题是它不是 1,2,3 简单的更新。这就像将一个长存储过程传递给 sp_executesql。考虑到微小的变化，它会产生性能问题。

我想使用存储过程并多次使用参数调用 sp_executesql。至少静态部分被编译，总体上它比动态构建整个存储过程要快。

总结性能是主要关注点

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-22T06:21:05.790

我想你可以，但你必须在数据库服务器端提供一个解析器来解释这些参数和值。您还必须放弃运行时编译的好处，或者自己也这样做。

您可能还会有一个非常长的可选输入参数列表......

您不想使用 sp_executesql 是否有一些令人信服的理由？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-22T07:52:56.540

为了进一步澄清，它将与 C# 中的类似：

无效存储过程（参数对象 [] 动态字段）

{

// 开始传输

//...这里有一些工作

sp_executesql（SQL11，动态字段）；

//...这里有一些工作

sp_executesql（SQL22，动态字段）；

//...这里有一些工作

sp_executesql（SQL33，动态字段）；

//...这里有一些工作

// 提交 tran

}

您可以使用任意数量或类型的参数调用它，或者认为 C++ var args

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-22T10:21:55.087

类型和数量未知？您可以在单个参数上使用 .getType() 和数组的 .Length 来获取它。从中构建一个 XML 片段，并将其作为一个参数推送到只有一个 xml 输入参数的 SP。.getType() 也适用于普通的 object()，如果它们被分配了类型的对象。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-23T00:46:12.907

是的，总是可以构建整个 sql 字符串并将其传递给存储过程。但是这样你就不会获得 sql 参数化的性能和安全优势。sp_executesql 优于 adhoc sql 的全部原因。如果我没有其他选择，我将不得不做类似的事情（虽然有点不同）

# file - Gnuplot：如何在暂停后绘制文件中的每一行

> ID：224617
> 
> 赞同：5
> 
> 时间：2008-10-22T06:05:06.307
> 
> 标签：file, gnuplot

我有一个 3 列数据文件，我想使用 splot 来绘制相同的图。但我想要的是 gnuplot 绘制第一行（以某种颜色，比如红色），然后暂停 0.3 秒，然后继续绘制下一行（以其他颜色，不是红色，比如绿色），暂停 0.3秒，然后继续下一行....依此类推。

任何帮助将不胜感激。

提前致谢

问候潘卡伊

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-22T06:34:00.773

如果要制作动画，最好使用专门的工具（如 mplayer）。

使用 gnuplot 准备所有源图像（第一个绘制单行，第二个 - 两行等），然后使用 mplayer 或 convert（来自 imagemagic）从源文件中生成 avi 或动画 GIF。

您可以使用以下 shell 片段生成输入文件的部分副本，每个副本的行数都在增加。

```
file="your input file.dat"
lines=$(wc -l $file)
i=1
while [ $i -le $lines ] ; do
  head -${i} ${file} > ${file%.dat}-${i}lines.dat
done 
```

给定 somefile.dat 这将产生文件“somefile-1lines.dat”、“somefile-2lines.dat”等。然后你可以使用：

```
for f in *lines.dat ; do
  gnuplot ... $f 
done 
```

按顺序绘制它们。

如果我的假设是错误的并且您真正想要的只是这个暂停，那么您可以尝试进行设置，以便 gnuplot 将从标准输入获取数据，然后使用此 scipt（将其命名为 paused-input.sh）通过管道输入文件在每一行之后暂停：

```
#!/bin/bash
while read l ; do
  echo "$l"
  sleep 1
done 
```

然后像这样调用它：

```
(pause-input.sh | gnuplot ...) < somefile.dat 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-02-26T17:11:50.247

很好的尝试，但是......这将创建与数据文件中的行数一样多的文件。这在我看来很难看。

我们可以编写一个 shell/perl 脚本来创建带有如下命令的 gnuplot 脚本：

```
splot x1 y1 z1
pause 1
replot x2 y2 z2
pause 1
replot x3 y3 z3
pause 1
replot x4 y4 z4 
```

其中 xi, yi, zi = 数据文件中第 i 行号的坐标。pause 1 将暂停一秒钟。

这只是一个想法，虽然我不确定如何直接绘制坐标而不是向 gnuplot 提供数据文件。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2013-01-07T22:31:07.050

*使用当前版本的 gnuplot 可能更容易获得一次*绘制每一行的效果（中间有一点停顿）（这个问题发布已经超过 4 年了）。

您可以使用`for`-loop 和`every`关键字，如下所示：

```
# Find out the number of lines in the data somehow, 
# for example like this:
num_lines="`cat my_datafile.d | wc -l`"

# Plot the first line in the data-file:
plot './my_datafile.d' every 1::0::0

# For the remaining lines:
do for [line_index = 1:num_lines-1] { 
  pause 0.3
  # Replot (from the same datafile) each line 
  # in the data file from the first one up to 
  # the current line_index 
  replot '' every 1::0::line_index
} 
```

该`every 1::0::line_index`部分指示 gnuplot - 在每个循环中 - 绘制数据中的每一行 (the `1`)，从第一个 (the `0`) 到循环变量的当前值`line_index`。我们使用的是`<point_incr>`,`<start_point>`并`<end_point>`在 gnuplot 的帮助文本中提到：

```
 gnuplot> help every
 The `every` keyword allows a periodic sampling of a data set to be plotted.
 [...]

 Syntax:
    plot 'file' every {<point_incr>}
                       {:{<block_incr>}
                         {:{<start_point>}
                           {:{<start_block>}
                             {:{<end_point>}
                               {:<end_block>}}}}}
 [...] 
```

版本信息：

```
$ gnuplot --version
gnuplot 4.6 patchlevel 0 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-03-29T14:44:47.960

制作一个情节文件，例如。'myplotfile.plt'。并将您通常在 gnuplot 中键入的所有命令放入其中以绘制图形。

然后只需添加该行

```
!sleep $Number_of_Seconds_to_Pause
```

到您希望它暂停的绘图文件，然后从终端运行它

```
gnuplot myplotfile.plt
```

（绘图文件的扩展名无关紧要，如果您使用的是 windows 或 mac 机器，您可能希望使用 .txt）

绘图文件示例：

```
set title 'x squared'
plot x**2 title ''
!sleep 5
set title 'x cubed'
plot x**3 title ''
!sleep 5
```

# multithreading - MSMQ 线程安全吗？

> ID：224618
> 
> 赞同：7
> 
> 时间：2008-10-22T06:05:12.390
> 
> 标签：multithreading, msmq

我有多个进程监视一个 MSMQ 队列。我想做多步骤操作，例如先查看消息，然后根据某些标准接收消息。一条消息可能会通过多个进程的接收标准，因此多个进程可能会尝试接收相同的消息。这些操作会是线程安全的吗？如果不是，我应该怎么做才能防止一个进程无法接收到另一个进程已经收到的消息？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-10-22T06:22:30.593

根据[MSDN](http://msdn.microsoft.com/en-us/library/system.messaging.messagequeue.aspx)：

> 只有以下方法是线程安全的：BeginPeek、BeginReceive、EndPeek(IAsyncResult)、EndReceive(IAsyncResult)、GetAllMessages、Peek 和 Receive。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-27T13:16:09.547

你可能对我写的关于这个主题的[博客文章感兴趣。](http://msmq.spaces.live.com/blog/cns!393534E869CE55B7!293.entry)

简而言之，MSMQ C++ API 是线程安全的，但并非所有 System.Messaging 方法都是线程安全的。在博客条目中，我讨论了如何以线程安全的方式调用 MessageQueue.Send。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-22T06:20:06.387

操作本身是线程安全的。但是，如果您执行多步操作，您可能会发现结果不一致（例如，查看数据是否在队列中，然后调用接收数据，结果发现它不再存在）。

# vb.net - VB.NET 错误：索引超出了数组的范围

> ID：224624
> 
> 赞同：1
> 
> 时间：2008-10-22T06:08:25.147
> 
> 标签：vb.net, arrays

每当我单击数据网格时，就会出现此错误。

每次在组合框中选择数据时，程序都会填充数据网格。

比如我在datagrid中选择data1有4条记录，然后点击row index no 1。没问题，会显示，但是当我在combobox中再次选择另一个数据时，例如Data 2只有一条记录我将再次单击数据网格。

这是弹出错误的时间。

请参阅有关如何填充数据网格的代码：

```
Sub FillDtgPir(ByVal qry As String)
    Try
        If SQLConn1.State = ConnectionState.Closed Then SQLConn1.Open()
        Dim adap As New SqlDataAdapter(qry, SQLConn1)
        Me.DtsLineReq1.PRRMS_PIR.Clear()
        adap.Fill(Me.DtsLineReq1, "PRRMS_PIR")
    Catch ex As Exception
        MsgBox(ex.Message)
    End Try
End Sub 
```

代码中是否缺少某些内容？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-22T06:14:21.543

如果选定的行索引大于新数据中的最大索引（行数减一），那么在填充之前根据需要减小行索引吗？或者检查异常原因并减少行索引而不是显示错误消息？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-22T06:44:53.247

重新填充数据网格时 - 确保重置所选行（这是我希望 Clear() 执行的操作）。

数组边界之外的索引通常是由于您试图查看不再存在的行而引起的。您是否在任何地方都有指向数据网格中当前行的指针？

数据网格单击事件中是否发生了什么？

# gcc - ARM STR7xx 的加载程序脚本

> ID：224635
> 
> 赞同：1
> 
> 时间：2008-10-22T06:15:47.657
> 
> 标签：gcc, arm, ld, linker-scripts

我正在尝试使用 Eclipse + CDT + yagarto (gnu toolchain) + OpenOCD 对 ARM 进行编程。在几个示例项目（例如来自 yagarto 站点）中，我发现了链接器脚本 (*.ld)，其中指定了许多链接信息（以及节定义）。实际上我以前没有遇到过这些文件（IAR 不需要它们），我发现它们乍一看有点难以理解。所以我的问题是我是否可以在我的所有项目中为我的目标处理器（STR710FZ2T6）使用一个这样的脚本文件，或者我必须熟悉编写这些脚本并为每个项目编写它们。如果我可以为特定目标处理器的所有项目使用单个文件，请您建议我在哪里可以找到这样的通用文件。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-16T02:26:14.990

我的猜测是每三个人都有不同的脚本或解决方案。有许多问题需要解决，不同的链接器将以不同的方式解决这些问题。如果不是黑魔法，我认为 GNU 让它变得太难了。

对于嵌入式系统，您通常会使用闪存或 eeprom 或其他形式的只读存储器进行引导。与其他处理器一样，ARM 有一个向量表，可以基本上告诉它复位代码和中断等位置。所以该表必须位于特定位置，并且您必须告诉链接器将其放在该特定位置（首先） .

我喜欢使用的脚本之一是：

```
MEMORY
{
    bob (RX) : ORIGIN = 0x0000000, LENGTH = 32K
    joe (WAIL) : ORIGIN = 0x2000000, LENGTH = 256K
}

SECTIONS
{
    JANE : { startup.o } >bob
} 
```

我通常使用 ram 和 rom 作为名称而不是 bob 和 joe，但在这里证明名称是什么并不重要，它们只是标签。

主题的另一个变体：

```
MEMORY
{
    rom(RX)   : ORIGIN = 0x00000000, LENGTH = 0x8000
    ram(WAIL) : ORIGIN = 0x20000000, LENGTH = 0x2000
}

SECTIONS
{
    .text : { *(.text*) } > rom
} 
```

第一个允许您以任何顺序将文件放在链接器命令行上，但您必须在 startup.o 文件中有向量表。后者允许您使用任何文件名，但链接描述文件上的第一个文件需要具有向量表。

```
arm-thumb-elf-gcc -Wall $(COPS) vectors.o putget.o blinker2.c -T memmap -o blinker2.elf 
```

或者直接用ld

```
arm-thumb-elf-ld vectors.o putget.o blinker2.o -T memmap -o blinker2.elf 
```

RX 告诉链接器将读取和执行的内容放入该内存部分，而 WAIL 基本上就是其他所有内容。例如，如果您只有一个 ram，您可以将所有标志 RXWAIL 放在告诉 ram 在哪里的行上。在这种情况下，根据您的加载程序，您可以依靠 elf 文件告诉加载程序从哪里开始分支，或者您可以简单地将入口点设置为二进制文件的开头，加载程序可以更简单。手臂（不是 cortex-m3）有一个分支指令作为重置向量的第一个向量，因此您可以假装为 ram 解决方案构建一个向量表，并且可以正常工作。

该解决方案的许多问题不会打扰我。我在我的代码中初始化变量，而不是在声明期间。

这

```
int rx;

int main ( void )
{
  rx = 7; 
```

代替

```
int rx=7;

int main ( void )
{ 
```

我也从不假设代码开始时变量为零，我总是在开始之前将其初始化为某个值。您的启动代码和链接器脚本作为一个团队可以一起工作，以便更容易地自动重置 bss 代码并在启动时将非零初始化数据从 rom 复制到 ram。（上面的 int rx=7; 需要一些代码从 rom 中的某个位置复制值 7 并将其写入为变量 rx 分配的 ram 中的内存位置，以便当 main() 启动时 7 就在那里。

由于这种方法，我的引导代码也非常简单：

```
.globl _start
_start:
    b reset
    b hang
    b hang
    b hang
    b hang
    b hang
    b hang
    b hang
    b hang
    b hang
    b hang
    b hang
    b hang
    b hang
    b hang

hang : b hang

reset:
    ldr sp,=0x10004000
    bl main
    b hang 
```

您将看到或阅读有关允许启动代码和链接器脚本一起工作的解决方案，而不必对堆栈指针、堆空间等进行硬编码，同样您可以在复杂的启动代码和链接器中投入大量工作脚本来获得一些自动化，也许可以节省一些工作，也许不是。自动化，如果/何时工作可以并且将减少人为错误，这可能是一件好事，如果您经常更换芯片或尝试编写在一系列芯片中工作的代码，您可能也需要这种自动化.

我的底线是，您可以只使用一个链接器脚本来完成所有 ARM 工作。但是您必须根据该脚本调整您的工作。您可能不会找到适用于每个人的示例代码的脚本。脚本越复杂，借用就越困难。是的，我上面的脚本很可能可以在 ld 命令行上完成，但是当（gcc 2.95）我无法让它工作时，我开发了上面的最小脚本并从那时起一直在使用它们。出于某种原因不得不修改第二个脚本，但使用 4.xx，当然是 4.4.x，我可以使用其中任何一个。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-05T07:36:42.627

没有通用的链接描述文件。这些脚本非常重要，因为它们定义了各种数据和程序部分在内存（RAM 或 ROM）中的放置位置。IAR 编译器中有一些等价的东西（如果我没记错的话是 xcl 文件）。到目前为止，您显然只使用了默认值。

有一个关于 STR7xx 的好文档，名为“Using Open Source Tools for STR7xx Cross Development”。您可以在 yagarto 主页中找到链接。我建议您看一下它并尝试了解链接器文件的工作原理。您还需要了解一些其他配置文件。

# jsp-tags - JSP自定义标签库（传递属性）

> ID：224637
> 
> 赞同：2
> 
> 时间：2008-10-22T06:16:02.540
> 
> 标签：jsp-tags

我正在尝试在我的自定义标签中使用多个属性，例如：

```
<mytaglib:mytag firstname="Thadeus" lastname="Jones" /> 
```

如何访问 TagHandler 代码中的属性？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-22T06:41:51.380

为了访问参数，您的 TagHandler 类应该定义私有成员并提供访问器方法。

```
public class TagHandler extends TagSupport {
    private String firstName;
    private String lastName;

    public void setFirstName(String firstname) { firstName = firstname; }
    public void setLastName(String lastname) { lastName = lastname;}
} 
```

然后您可以通过 TagHandler 变量访问参数。

```
public int doStartTag() throws JspException {
    pageContext.getOut().print(lastName + ", " + firstName);
} 
```

如果您仍然有问题，请仔细检查您的命名约定，Java 解释器正试图猜测 setter 方法是什么。因此，如果您的参数是“FirstName”，那么设置方法必须是“setFirstName”，如果参数是“lastname”，则设置参数必须是“setlastname”。我更喜欢遵循前者，因为它是标准的 Java 命名约定。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-22T06:21:52.573

不是您所问问题的真正答案，但我讨厌（即从未写过）TagHandler，但我喜欢[标签文件](http://java.sun.com/j2ee/1.4/docs/tutorial/doc/JSPTags5.html)。允许您使用 jsp 文件编写自定义标签。您可能知道它们并且不可用/不适用 - 但我想我会提到它们以防万一。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2017-08-06T17:40:42.527

为了演示这个问题的解决方案，让我们做一个类比。假设我们有从 index.jsp 中检索到的“userName”和“password”，我们必须在自定义标签属性中传递我们的数据。在我的情况下它的工作

```
<body>

<%
String name=request.getParameter("name");
String password=request.getParameter("password");
%>

<%@ taglib prefix="c" uri="/WEB-INF/mytag.tld" %>

<c:logintag name="<%=name %>" password="<%=password %>"/> 
```

# java - Java Swing 应用程序到 OSX 的可移植性

> ID：224643
> 
> 赞同：0
> 
> 时间：2008-10-22T06:19:28.680
> 
> 标签：java, macos, swing

最近，我编写了一个非常基本的 Java Swing 程序，其中包含几个文本字段和按钮。该程序在带有 Java 1.5 的 Ubuntu 上运行良好。但是当我尝试在 OSX (10.4) 上运行它时，主窗口显示正确，但程序似乎没有响应。无论我点击哪个按钮，似乎都没有发生任何事情。

我对 Mac OSX 几乎一无所知，所以我可能做错了什么吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-22T08:20:53.677

会不会是您在 Event-Dispatch Thread 之外执行某些操作？例如，您可能`JTextArea`在`main`线程中创建、显示然后修改 a。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-22T20:27:01.993

通常 Java 程序在 OS X 中运行良好 - 例如，[Sound Bridge Commander](http://sbcommander.sourceforge.net/ "音桥指挥官")是一个在 Mac 和 Linux 上运行良好的 java 应用程序。不过，我肯定会确保 Mac 盒子是最新的。您提到它正在运行 Tiger，这意味着它已经有好几年了，它拥有的 JVM 可能与您编译的那个不兼容。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-29T00:28:54.600

您可能在类路径上有 SWT。这听起来类似于我遇到的问题。如果我没记错的话，mac SWT jar 使用某些启动挂钩来自动启动。然后 SWT 会干扰 Swing。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-02-20T09:39:11.183

这可能是您的某些代码是为 Java 5 而不是 Java 1.4 编译的，所以每当您尝试调用它时，JVM 就会抛出一个异常，您只是看不到？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-05T20:04:35.813

你有没有机会把代码放到网上某个地方让我们试试？我实际上也在使用 10.4，所以这不是问题。

# java - Double 小于零的双重强制转换

> ID：224646
> 
> 赞同：3
> 
> 时间：2008-10-22T06:20:15.450
> 
> 标签：java, syntax

```
Double out = otherTypes.someMethod(c, c2);
assertEquals((Double)-1.0D, out); 
```

我收到错误“无法解决双精度数”（assertEquals 中的双精度数），除了提取变量之外，还有什么方法可以破解它？

是 Java 中的这个错误还是只是非常有用的功能无法修复？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-22T07:33:17.050

一个重要的注意事项：由于浮点数的工作方式，您永远不应该直接比较两个双精度数（或通常所说的浮点数）是否相等，如果它们的差异在指定的 delta: 内，请始终进行比较`abs(double1 - double2) < delta`。

JUnit 有一种`assertEquals(double expected, double actual, double delta)`方法可以做到这一点。也就是说，您可能应该使用类似的东西

```
assertEquals(-1.0d, (double) out, 0.000001d) 
```

在你的代码中。

您可以在例如 Brian Goetz 的一篇文章中找到更多关于浮点数的技巧和陷阱的信息：[“你的观点在哪里？”](http://www.ibm.com/developerworks/java/library/j-jtp0114/)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-22T06:38:08.097

我的变化类似于 jjnguy 的

```
assertEquals(Double.valueOf(-1.0D), out) 
```

这个最大的区别是 Double.valueOf 可以返回一个缓存副本，而不必创建一个新对象。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-22T20:16:27.913

要将 -1.0D 转换为 Double，我们通常使用 Double.valueOf(-1.0D) 的最佳方式。Double 类缓存对 valueOf 的调用结果，因此您不会总是在堆上创建新对象。但更好的是转换成双倍，这样更便宜。用于`out.doubleValue()`获取双精度值。唯一需要注意的是 out 可能为空，这是一个单独的案例，可能值得单独检测。

在以这种方式测试直接相等时，您还应该警惕浮点不准确性。理论上相等的两个数字可能不具有完全相等的表示，因为大多数浮点运算都会引入一些舍入误差。在这种情况下可行的一个简单解决方案是测试差异是否小于某个增量：

```
assertTrue(Math.abs(-1.0D-out.doubleValue()) < delta); 
```

您还可以使用 JUnit 的便捷方法来执行此操作：

```
assertEquals(-1.0d, out.doubleValue(), delta); 
```

对 delta 使用非常小的值，例如 10E-10，或者适合您的应用程序的值。在最一般的情况下，如果您不知道要比较的值的范围，则需要将 delta 乘以每个数字的相对大小，如下所示：

```
double tDelta = delta*(Math.abs(-1.0D)+Math.abs(out.doubleValue()));
assertEquals(-1.0d, out.doubleValue(), tDelta); 
```

如果您要比较非常大的数字，您希望允许的增量更大，如果您要比较非常小的数字，您希望允许的增量更小。但是对于您的情况，您事先知道您的参数之一，因此您可以对增量进行硬编码。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-22T08:56:22.047

当您想检查两个双打是否完全相同时，我的建议是：

```
assertEquals(Double.doubleToLongBits(-1.0), Double.doubleToLongBits(out)); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-22T11:26:27.000

This goes through the compiler:

```
assertEquals(Double.class.cast(-1.0D), out); 
```

# java - 外部迭代器与内部迭代器

> ID：224648
> 
> 赞同：39
> 
> 时间：2008-10-22T06:21:17.507
> 
> 标签：java, iterator

什么是 Java 中的外部和内部迭代器？

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2008-10-22T06:32:24.927

# 外部迭代器

当你得到一个迭代器并越过它时，这就是一个外部迭代器

```
for (Iterator iter = var.iterator(); iter.hasNext(); ) {
  Object obj = iter.next();
  // Operate on obj
} 
```

# 内部迭代器

当您将函数对象传递给方法以在列表上运行时，这是一个内部迭代器

```
var.each( new Functor() {
  public void operate(Object arg) {
    arg *= 2;
  }
}); 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-10-22T06:27:22.453

我找到了这个[描述](http://www.oodesign.com/iterator-pattern.html)：

外部与内部迭代器。

外部迭代器 - 当迭代由集合对象控制时，我们说我们有一个外部迭代器。

在 .net 或 java 等语言中，创建外部迭代器非常容易。在我们的经典实现中，实现了一个外部迭代器。在以下示例中，使用了外部迭代器：

```
// using iterators for a clloection of String objects:
// using in a for loop
for (Iterator it = options.iterator(); it.hasNext(); ) {
   String name = (String)it.next();
   System.out.println(name);
}

// using in while loop
Iterator name = options.iterator();
    while (name.hasNext() ){
      System.out.println(name.next() );
    }

// using in a for-each loop (syntax available from java 1.5 and above)
    for (Object item : options)
        System.out.println(((String)item)); 
```

内部迭代器 - 当迭代器控制它时，我们有一个内部迭代器

另一方面，实现和使用内部迭代器确实很困难。当使用内部迭代器时，这意味着正在运行的代码被委托给聚合对象。例如，在提供支持的语言中，很容易调用内部迭代器：

```
collection do: [:each | each doSomething] (Smalltalk) 
```

主要思想是将要执行的代码传递给集合。然后集合将在内部调用每个组件的 doSomething 方法。在 C++ 中，可以将 doMethod 方法作为指针发送。在 C#、.NET 或 VB.NET 中，可以将方法作为委托发送。在java`Functor`中必须使用设计模式。主要思想是创建一个只有一种方法（doSomething）的基本接口。然后该方法将在实现接口的类中实现，并将该类传递给集合进行迭代。有关更多详细信息，请参阅`Functor`设计模式。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2018-10-25T11:17:12.797

外部迭代器示例：

```
int count = 0;
Iterator<SomeStaff> iterator = allTheStaffs.iterator();
while(iterator.hasNext()) {
    SomeStaff staff = iterator.next();
    if(staff.getSalary() > 25) {
        count++;
    }
} 
```

内部迭代器示例：

```
long count = allTheStaffs.stream()
                         .filter(staff -> staff.getSalary() > 25)
                         .count(); 
```

在图像中：

[![在此处输入图像描述](https://i.stack.imgur.com/556uD.jpg)](https://i.stack.imgur.com/556uD.jpg)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-22T06:25:35.470

这是关于[谁控制迭代](http://gafter.blogspot.com/2007/07/internal-versus-external-iterators.html)

其他细节在这个问题[中 Java 中的 Iterator 接口有什么好处？](https://stackoverflow.com/questions/89891/what-are-the-benefits-of-the-iterator-interface-in-java)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2018-08-12T16:58:54.123

[我在这里](https://www.quora.com/What-are-differences-between-External-Iterators-vs-Internal-Iterators-in-Java-8)找到了答案。

内部迭代器在后台管理迭代。这使得程序员只需要以声明方式对 Collection 的元素要做什么进行编码，而不是管理迭代并确保所有元素都被一个接一个地处理。前任：

```
public class InternalIterator {

   public static void main(String args[]){

      List<String> namesList=Arrays.asList("Tom", "Dick", "Harry");

      namesList.forEach(name -> System.out.println(name));//Internal Iteration

   }

} 
```

外部迭代器负责迭代元素，并确保此迭代考虑到记录的总数，是否存在要迭代的更多记录等等取决于程序员。

前任：

```
import java.util.*;

public class ExternalIterator {

   public static void main(String args[]){
      List<String> namesList=Arrays.asList("Tom", "Dick", "Harry");
      for(String name:namesList){
         System.out.println(name);
      }

   }

} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2018-08-03T06:46:15.843

**外部迭代器**：-使用它我们必须一个接一个地迭代所有元素并执行一些操作，因为程序员确实可以控制它，它是一个外部迭代器。

**内部迭代器**：-使用它我们可以根据我们的条件进行迭代，程序员可以控制它，它是一个内部迭代器。

让我们看看下面的一个例子： **Q - 我们想从一个等于或大于 5 的列表中添加整数的总和。**

```
package java8;

import java.util.ArrayList;
import java.util.List;

public class IteratorExpr {

    public static void main(String[] args) {
        List<Integer> myList = new ArrayList<Integer>();
        for(int i=0; i<10; i++) myList.add(i);

        //Get sum of all value which is more than 5 using External Iterator
        int sum = 0;
        for(int no: myList) {
            if(no >=5) {
                sum += no;
            }
        }
        System.out.println("Sum of numbers using External api : "+sum);

        int summ = myList.stream()
                .filter(p->p>=5)
                .mapToInt(p->p).sum();
        System.out.println("Sum of numbers using internal api : "+summ);
    }

} 
```

输出 ：

```
Sum of numbers using External api : 35
Sum of numbers using internal api : 35 
```

# oop - Lua 中 OOP 库的设计问题

> ID：224658
> 
> 赞同：2
> 
> 时间：2008-10-22T06:26:05.343
> 
> 标签：oop, lua

我在 Lua 中实现了一个小型 OOP 库，有两件事还不太对劲。我需要你的建议！

## 如何调用 super()？

我需要做出选择。我需要解决对 super() 的调用的三个参数是：

*   发出呼叫的类 (CallerClass)
*   要传递的实例（self）
*   方法名（方法）

我在这三种形式之间犹豫不决：

```
--# Current way:
self:super(CallerClass):method()

--# Variant, which I now find cleaner:
CallerClass:super(self):method()

--# Python style, which is nice too:
super(CallerClass, self):method() 
```

哪一个看起来更好或更容易让您记住？

## 我需要类符号吗？

在当前版本中，唯一的概念是一个名为 的表`Object`，您可以对其进行子类化。我有另一个版本，我在其中引入了 Class 符号。

它的用途是从类中区分实例。IE ：

```
assert(Object:isKindOf(Class))
local object = Object:new()
assert(not object:isKindOf(Class)) 
```

我发现通过以下方式开始方法来记录和强制必须从类中调用方法非常方便：

```
assert(self:isKindOf(Class)) 
```

它在 Lua 中有用吗？你怎么看？谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-22T06:36:46.553

```
--# Python style, which is nice too:
super(CallerClass, self):method() 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-22T06:37:27.207

我会说有一个类对象 - 更多信息/元数据更好

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-23T09:46:46.437

谢谢克里斯，完成。

对于那些感兴趣的人，代码发布在 Lua 用户 Wiki 上，请参阅[ObjectLua](http://lua-users.org/wiki/ObjectLua)。

# python - 使用 windows python 2.3 进行传入 poplib 重构

> ID：224660
> 
> 赞同：1
> 
> 时间：2008-10-22T06:26:33.500
> 
> 标签：python, email, refactoring, poplib

嗨，伙计们，你能帮我重构一下，让它看起来像 Python 一样。

```
import sys
import poplib
import string
import StringIO, rfc822
import datetime
import logging

def _dump_pop_emails(self):
    self.logger.info("open pop account %s with username: %s" % (self.account[0], self.account[1]))
    self.popinstance = poplib.POP3(self.account[0])
    self.logger.info(self.popinstance.getwelcome()) 
    self.popinstance.user(self.account[1])
    self.popinstance.pass_(self.account[2])
    try:
        (numMsgs, totalSize) = self.popinstance.stat()
        for thisNum in range(1, numMsgs+1):
            (server_msg, body, octets) = self.popinstance.retr(thisNum)
            text = string.join(body, '\n')
            mesg = StringIO.StringIO(text)                               
            msg = rfc822.Message(mesg)
            name, email = msg.getaddr("From")
            emailpath = str(self._emailpath + self._inboxfolder + "\\" + email + "_" + msg.getheader("Subject") + ".eml")
            emailpath = self._replace_whitespace(emailpath)
            file = open(emailpath,"wb")
            file.write(text)
            file.close()
            self.popinstance.dele(thisNum)
    finally:
        self.logger.info(self.popinstance.quit())

def _replace_whitespace(self,name):
    name = str(name)
    return name.replace(" ", "_") 
```

同样在 _replace_whitespace 方法中，我希望有某种清理例程，它可以删除所有可能导致处理的非法字符。

基本上我想以标准方式将电子邮件写入收件箱目录。

我在这里做错了吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-22T06:58:57.163

我没有看到该代码有任何重大错误——它的行为是否不正确，或者您只是在寻找一般的样式指南？

几点注意事项：

1.  而不是`logger.info ("foo %s %s" % (bar, baz))`，使用`"foo %s %s", bar, baz`. 如果不打印消息，这可以避免字符串格式化的开销。
2.  放一个`try...finally`左右开口`emailpath`。
3.  使用`'\n'.join (body)`, 而不是`string.join (body, '\n')`.
4.  而不是`msg.getaddr("From")`，只是`msg.From`。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-22T09:32:26.060

这不是重构（据我所知，它不需要重构），而是一些建议：

您应该使用电子邮件包而不是 rfc822。将 rfc822.Message 替换为 email.Message，并使用 email.Utils.parseaddr(msg["From"]) 获取姓名和电子邮件地址，使用 msg["Subject"] 获取主题。

使用 os.path.join 创建路径。这：

```
emailpath = str(self._emailpath + self._inboxfolder + "\\" + email + "_" + msg.getheader("Subject") + ".eml") 
```

变成：

```
emailpath = os.path.join(self._emailpath + self._inboxfolder, email + "_" + msg.getheader("Subject") + ".eml") 
```

（如果 self._inboxfolder 以斜杠开头或 self._emailpath 以一个结尾，您也可以将第一个 + 替换为逗号）。

它并没有真正伤害任何东西，但您可能不应该使用“file”作为变量名，因为它会影响内置类型（像 pylint 或 pychecker 这样的检查器会警告您）。

如果您没有在此函数之外使用 self.popinstance（鉴于您在函数内连接并退出，似乎不太可能），那么将其作为 self 的属性是没有意义的。只需单独使用“popinstance”。

使用 xrange 代替范围。

不只是导入 StringIO，而是这样做：

```
try:
    import cStringIO as StringIO
except ImportError:
    import StringIO 
```

如果这是一个可以由多个客户端一次访问的 POP 邮箱，您可能需要在 RETR 调用周围放置一个 try/except 以在您无法检索到一条消息时继续。

正如 John 所说，使用 "\n".join 而不是 string.join，使用 try/finally 仅在打开文件时关闭文件，并单独传递日志记录参数。

我能想到的一个重构问题是您实际上并不需要解析整个消息，因为您只是转储原始字节的副本，而您想要的只是 From 和 Subject 标头。您可以改为使用 popinstance.top(0) 来获取标头，从中创建消息（空白正文），并将其用于标头。然后执行完整的 RETR 以获取字节。仅当您的消息很大时才值得这样做（因此解析它们需要很长时间）。在进行此优化之前，我肯定会进行测量。

对于您清理名称的功能，这取决于您希望名称有多好，以及您对电子邮件和主题使文件名唯一性的确定程度（似乎不太可能）。您可以执行以下操作：

```
emailpath = "".join([c for c in emailpath if c in (string.letters + string.digits + "_ ")]) 
```

你最终只会得到字母数字字符、下划线和空格，这看起来像是一个可读的集合。鉴于您的文件系统（使用 Windows）可能不区分大小写，您也可以将其小写（将 .lower() 添加到末尾）。如果你想要更复杂的东西，你可以使用 emailpath.translate。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-22T07:30:20.347

除了我对约翰回答的评论

我发现问题出在哪里，名称字段和主题字段中有非法字符，这导致 python 遇到问题，因为它在看到“：”和“/”后试图将电子邮件写为目录。

约翰第 4 点不起作用！所以我像以前一样离开了它。第 1 点也是正确的，我是否正确实施了您的建议？

```
def _dump_pop_emails(self):
    self.logger.info("open pop account %s with username: %s", self.account[0], self.account[1])
    self.popinstance = poplib.POP3(self.account[0])
    self.logger.info(self.popinstance.getwelcome()) 
    self.popinstance.user(self.account[1])
    self.popinstance.pass_(self.account[2])
    try:
        (numMsgs, totalSize) = self.popinstance.stat()
        for thisNum in range(1, numMsgs+1):
            (server_msg, body, octets) = self.popinstance.retr(thisNum)
            text = '\n'.join(body)
            mesg = StringIO.StringIO(text)                               
            msg = rfc822.Message(mesg)
            name, email = msg.getaddr("From")
            emailpath = str(self._emailpath + self._inboxfolder + "\\" + self._sanitize_string(email + " " + msg.getheader("Subject") + ".eml"))
            emailpath = self._replace_whitespace(emailpath)
            print emailpath
            file = open(emailpath,"wb")
            file.write(text)
            file.close()
            self.popinstance.dele(thisNum)
    finally:
        self.logger.info(self.popinstance.quit())

def _replace_whitespace(self,name):
    name = str(name)
    return name.replace(" ", "_")   

def _sanitize_string(self,name):
    illegal_chars = ":", "/", "\\"
    name = str(name)
    for item in illegal_chars:
        name = name.replace(item, "_")
    return name 
```

# asp.net - 在标签上设置 AssociatedControlID 失败

> ID：224662
> 
> 赞同：3
> 
> 时间：2008-10-22T06:27:10.507
> 
> 标签：asp.net, composite-controls

我有一个复合控件，它将一个 TextBox 和一个 Label 控件添加到它的 Controls 集合中。当我尝试将标签的 AssociatedControlID 设置为文本框的 ClientID 时，我收到此错误

```
Unable to find control with id 
'ctl00_MainContentPlaceholder_MatrixSetControl_mec50_tb'
that is associated with the Label 'lb'. 
```

好的，有一点背景。我得到了这个主复合控件，它动态地将许多“元素”添加到它的控件集合中。其中一个元素恰好是这个“MatrixTextBox”，它是由一个文本框和一个标签组成的控件。

我将 Label 和 TextBox 作为受保护的类变量，并在 CreateChildControls 中初始化它们：

```
 ElementTextBox = new TextBox();
    ElementTextBox.ID = "tb";
    Controls.Add(ElementTextBox);

    ElementLabel = new Label();
    ElementLabel.ID = "lb";
    Controls.Add(ElementLabel); 
```

我尝试设置

```
ElementLabel.AssociatedControlID = ElementTextBox.ClientID; 
```

在将控件添加到 Controls 集合之后，甚至在 PreRender 中，两者都产生相同的错误。我究竟做错了什么？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-22T06:55:23.367

我认为您**不能使用**ElementTextBox 的 ClientID 属性，而是使用**ID**。ClientID 是您必须在 Javascript 中使用的页面唯一 ID，例如在 document.getElementyById 中，并且与服务器端 ID 不同 - 特别是如果您有母版页和/或控件等中的控件。

所以应该是：

```
ElementLabel.AssociatedControlID = ElementTextBox.ID; 
```

希望这可以帮助。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-15T17:30:22.247

可能对遇到错误的其他读者有帮助：

请注意，如果您在运行时将标签与输入控件相关联，而没有先明确设置输入控件的 ID，则设置 AssociatedControlID 也会失败。如果您要动态创建多个带有标签的文本框、复选框或单选按钮，这是一个需要注意的问题。

```
private void AddRadioButton(PlaceHolder placeholder, string groupname, string text)
{
    RadioButton radio = new RadioButton();
    radio.GroupName = groupname;
    radio.ID = Guid.NewGuid().ToString(); // Always set an ID.

    Label label = new Label();
    label.Text = text;
    label.AssociatedControlID = radio.ID;

    placeholder.Controls.Add(radio);
    placeholder.Controls.Add(label);
} 
```

# proxy - 代理服务器和反向代理服务器有什么区别？

> ID：224664
> 
> 赞同：1873
> 
> 时间：2008-10-22T06:27:32.923
> 
> 标签：proxy, webserver, terminology, reverse-proxy

代理服务器和反向代理服务器有什么区别？

* * *

## 回答 #1

> 赞同：3100
> 
> 时间：2008-12-14T05:49:08.377

之前的答案是准确的，但可能过于简洁。我将尝试添加一些示例。

首先，“代理”一词描述了代表他人行事的某人或某事。

在计算机领域，我们谈论的是一个服务器代表另一台计算机。

出于可访问性的目的，我将把我的讨论限制在网络代理上——但是，代理的想法并不局限于网站。

# 转发代理

大多数关于 Web 代理的讨论都是指称为“转发代理”的代理类型。

在这种情况下，代理事件是“转发代理”代表原始请求者从另一个网站检索数据。

## 3 台计算机的故事（上）

例如，我将列出三台连接到 Internet 的计算机。

*   X = 您的计算机，或 Internet 上的“客户端”计算机
*   Y = 代理网站 proxy.example.org
*   Z = 您要访问的网站，www.example.net

通常，一个人会直接从`X --> Z.`

但是，在某些场景下，最好是`Y --> Z`代表`X`，其中链如下：`X --> Y --> Z`.

## X 想要使用转发代理服务器的原因：

这是转发代理服务器的（非常）部分用途列表：

*   1) X 无法直接访问 Z，因为

    *   a) 对`X`互联网连接具有管理权限的人已决定阻止对站点的所有访问`Z`。

        *   例子：

            *   Storm Worm 病毒是通过诱骗人们访问来传播的`familypostcards2008.com`，因此系统管理员已经阻止了对该站点的访问，以防止用户无意中感染自己。

            *   一家大公司的员工在 .NET 上浪费了太多时间`facebook.com`，因此管理层希望在工作时间阻止访问。

            *   当地一所小学不允许互联网访问该`playboy.com`网站。

            *   政府无法控制新闻的发布，因此它通过封锁诸如`wikipedia.org`. 请参阅[TOR](https://www.onion-router.net/)或[FreeNet](https://freenetproject.org/)。

    *   b) 的管理员`Z`已阻止`X`。

        *   例子：

            *   Z 的管理员注意到来自 X 的黑客攻击，因此管理员决定阻止 X 的 IP 地址（和/或网络范围）。

            *   Z是一个论坛网站。 `X`正在向论坛发送垃圾邮件。Z 阻挡 X。

# 反向代理

## 3 台计算机的故事（第二部分）

对于这个例子，我将列出三台连接到互联网的计算机。

*   X = 您的计算机，或 Internet 上的“客户端”计算机
*   Y = 反向代理网站 proxy.example.com
*   Z = 您要访问的网站，www.example.net

通常，一个人会直接从`X --> Z.`

但是，在某些情况下，最好由管理员`Z`限制或禁止直接访问并强制访问者先通过 Y。因此，和以前一样，我们`Y --> Z`代表检索数据`X`，其链接如下`X --> Y --> Z`：

这次与“转发代理”不同的是，这一次用户`X`不知道他正在访问`Z`，因为用户`X`只看到他正在与 通信`Y`。服务器`Z`对客户端不可见，只有反向代理`Y`在外部可见。反向代理不需要在客户端进行（代理）配置。

客户`X`认为他只是在与`Y`( `X --> Y`) 通信，但实际情况是`Y`转发所有通信 (`X --> Y --> Z`再次)。

## Z 想要设置反向代理服务器的原因：

*   1) Z 想要强制其网站的所有流量首先通过 Y。
    *   a) Z 有一个数百万人想查看的大型网站，但单个 Web 服务器无法处理所有流量。因此 Z 设置了许多服务器并在 Internet 上放置了一个反向代理，当用户尝试访问 Z 时，该代理会将用户发送到离他们最近的服务器。这是内容分发网络 (CDN) 概念工作原理的一部分。
        *   例子：
            *   [Apple Trailers](https://www.apple.com/trailers/)使用[Akamai](https://www.akamai.com/)
            *   Jquery.com 使用[CloudFront CDN](https://aws.amazon.com/s3/)（[示例](https://static.jquery.com/files/rocker/scripts/custom.js)）托管其 JavaScript 文件。
            *   等等
*   2）Z的管理员担心托管在服务器上的内容遭到报复，不想将主服务器直接暴露给公众。
    *   a) “Canadian Pharmacy”等垃圾邮件品牌的所有者似乎拥有数千台服务器，而实际上大多数网站托管在更少的服务器上。此外，关于垃圾邮件的滥用投诉只会关闭公共服务器，而不是主服务器。

在以上场景中，`Z`都有选择的能力`Y`。

# 帖子中的主题链接：

## 内容交付网络

*   CDN 列表
    *   [http://www.mytestbox.com/miscellaneous/content-delivery-networks-cdn-list/](http://www.mytestbox.com/miscellaneous/content-delivery-networks-cdn-list/)
    *   [http://blog.streamingmedia.com/the_business_of_online_vi/2008/01/updated-list-of.html](http://blog.streamingmedia.com/the_business_of_online_vi/2008/01/updated-list-of.html)

## 转发代理软件（服务器端）

*   [PHP-代理](https://www.php-proxy.com/)
*   [cgi代理](https://www.jmarshall.com/tools/cgiproxy/)
*   [phproxy](https://sourceforge.net/projects/poxy/) （已停产）
*   [字形](http://www.glype.com/)
*   [互联网审查维基：网络代理列表](http://en.cship.org/wiki/Category:Webproxy)
*   [鱿鱼](http://www.squid-cache.org/) （显然，也可以作为反向代理）

## HTTP反向代理软件（服务器端）

*   [Apache mod_proxy](http://wiki.apache.org/cocoon/ApacheModProxy)（也可以作为 HTTP 的转发代理）
*   [nginx](https://nginx.org/) （用于 hulu.com、垃圾邮件网站等）
*   [HAProxy](https://www.haproxy.org/)
*   [球童网络服务器](https://caddyserver.com/docs/proxy)
*   [轻型httpd](https://redmine.lighttpd.net/projects/lighttpd)
*   [perlbal](https://github.com/perlbal/)（为 livejournal 编写）
*   [端口融合](https://github.com/corsis/PortFusion#readme)
*   [磅](http://www.apsis.ch/pound/)
*   [清漆缓存](https://varnish-cache.org/)（由[FreeBSD 内核大师](https://info.varnish-software.com/blog/celebrating-10-years-of-varnish-cache-qa-with-the-man-behind-the-idea)编写）
*   [休息](https://repose.atlassian.net/wiki/)

## TCP反向代理软件（服务器端）

*   [平衡](https://www.inlab.net/balance/)
*   [代表](http://www.delegate.org/delegate/nvproxy/)
*   [笔](http://siag.nu/pen/)
*   [端口融合](https://github.com/corsis/PortFusion#readme)
*   [纯负载均衡器](https://web.archive.org/web/20080113185334/http://plb.sunsite.dk/index.html)（网站已失效）
*   [蟒蛇导演](http://pythondirector.sourceforge.net/)

## 也可以看看：

*   [维基百科 - 内容交付网络](https://en.wikipedia.org/wiki/Content_Delivery_Network)
*   [维基百科 - 类别：Reverse_proxy](https://en.wikipedia.org/wiki/Category:Reverse_proxy)
*   [维基百科 - 负载平衡](https://en.wikipedia.org/wiki/Load_balancing_(computing))
*   [维基百科 - 可扩展性](https://en.wikipedia.org/wiki/Scalability)

* * *

## 回答 #2

> 赞同：569
> 
> 时间：2012-08-10T14:35:41.087

A pair of simple definitions would be:

Forward Proxy: Acting on behalf of a requestor (or service consumer)

Reverse Proxy: Acting on behalf of service/content producer.

* * *

## 回答 #3

> 赞同：456
> 
> 时间：2016-08-31T04:55:04.643

我发现下面的图表非常有帮助。它只是显示了通过 Internet 从客户端到服务器的*正向*与*反向代理设置的体系结构。*此图将帮助您更好地理解[qyb2zm302 的答案](https://stackoverflow.com/a/366212/452102)和其他答案。

[![正向代理与反向代理](https://i.stack.imgur.com/0qpxZ.png)](https://i.stack.imgur.com/0qpxZ.png)

您还可以观看Peter Silva的来自*F5*的*DevCentral的*[视频。](https://youtu.be/jGQTS1CxZTE)

 **图片来源：[知乎](http://qr.ae/TU1LIV)。然而，根据[Martijn Pieters](https://stackoverflow.com/users/100297/martijn-pieters)的说法，这张图片可能来自[Pulse Secure Community](https://community.pulsesecure.net/t5/Pulse-Secure-vADC/Using-Stingray-Traffic-Manager-as-a-Forward-Proxy/ta-p/28747)或 Julien Pauli 在developpez.com 上的[网站](https://julien-pauli.developpez.com/tutoriels/web/http/?page=page_7)（法语）。

这让我想起了一句经典谚语：

> 一张图片值1000字。

* * *

## 回答 #4

> 赞同：252
> 
> 时间：2013-01-07T05:29:22.767

*[Forward Proxy vs. Reverse Proxy](http://www.jscape.com/blog/bid/87783/Forward-Proxy-vs-Reverse-Proxy)* (2012) 非常清楚地解释了正向和反向代理之间的区别。

[qyb2zm302 的回答](https://stackoverflow.com/questions/224664/whats-the-difference-between-a-proxy-server-and-a-reverse-proxy-server/366212#366212)很好地详细说明了代理的应用程序，但它在正向和反向代理之间的基本概念上有所失误。对于反向代理，X → Y → Z，X 知道 Y 而不是 Z，反之亦然。

代理只是通信（请求+响应）的中间人。客户端 <-> 代理 <-> 服务器

*   客户端代理：（**客户**端<->代理**）** <->服务器

代理代表客户行事。客户端知道链中涉及的所有三台机器。服务器没有。

*   服务器代理：客户端<-> **（**代理<->服务器**）**

代理代表服务器行事。客户端只知道代理。服务器知道整个链。

在我看来，*正向*和*反向*只是*客户端*和*服务器*代理的令人困惑的、依赖于视角的名称。我建议为后者放弃前者，以进行明确的沟通。

当然，更复杂的是，并不是每台机器都只是客户端或服务器。如果上下文有歧义，最好明确指定代理所在的位置，以及它通过隧道传输的通信。

* * *

## 回答 #5

> 赞同：130
> 
> 时间：2015-01-17T16:14:23.933

一些图表可能会有所帮助：

**转发代理**

![转发代理](https://i.stack.imgur.com/MPQAt.png)

**反向代理**

![反向代理](https://i.stack.imgur.com/xrOba.png)

* * *

## 回答 #6

> 赞同：74
> 
> 时间：2008-10-23T00:04:48.343

区别主要在于部署。Web 正向和反向代理都具有相同的基本功能。它们接受各种格式的 HTTP 请求并提供响应，通常是通过访问源服务器或联系服务器。

功能齐全的服务器通常具有访问控制、缓存和一些链接映射功能。

转发代理是通过配置客户端机器访问的代理。客户端需要对代理功能（重定向、代理身份验证等）的协议支持。代理对用户体验是透明的，但对应用程序不透明。

反向代理是一种部署为 Web 服务器的代理，其行为类似于 Web 服务器，不同之处在于它不是在本地组合来自程序和磁盘的内容，而是将请求转发到源服务器。从客户端的角度来看，它*是*一个 Web 服务器，因此用户体验是完全透明的。

事实上，单个代理实例可以同时针对不同的客户端群体作为正向和反向代理运行。

* * *

## 回答 #7

> 赞同：69
> 
> 时间：2016-02-20T13:06:48.267

**代理：它代表客户端发出请求**。因此，服务器将响应返回给代理，代理将响应转发给客户端。事实上，服务器永远不会“知道”客户端是谁（客户端的 IP 地址）；它只会知道代理。但是，客户端肯定知道服务器，因为它本质上格式化了发往服务器的 HTTP 请求，但它只是将其交给代理。

[![在此处输入图像描述](https://i.stack.imgur.com/eeQP2.png)](https://i.stack.imgur.com/eeQP2.png)

**反向代理：它代表服务器接收请求**。它将请求转发到服务器，接收响应，然后将响应返回给客户端。在这种情况下，客户端永远不会“知道”谁是实际的服务器（服务器的 IP 地址）（有一些例外）；它只会知道代理。服务器将知道或不知道实际的客户端，具体取决于反向代理的配置。

[![在此处输入图像描述](https://i.stack.imgur.com/zOvvx.png)](https://i.stack.imgur.com/zOvvx.png)

* * *

## 回答 #8

> 赞同：51
> 
> 时间：2016-08-04T06:36:19.677

[最好的](http://www.jscape.com/blog/bid/87783/Forward-Proxy-vs-Reverse-Proxy)解释是用图表：

***正向代理***代表客户端（**或**请求主机**）**，***反向代理***代表服务器。

实际上，***正向代理***隐藏了客户端的身份，而***反向代理***隐藏了服务器的身份。

* * *

## 回答 #9

> 赞同：39
> 
> 时间：2008-10-22T06:45:58.253

代理服务器将传出的网络请求代理（并且可选地缓存）到 Internet 上的各种非必要相关的公共资源。反向代理捕获（并且可选地缓存）来自 Internet 的传入请求，并将它们分发到各种内部私有资源，通常用于高可用性目的。

* * *

## 回答 #10

> 赞同：33
> 
> 时间：2017-10-01T03:08:58.300

**代理（正向代理）：**

当 LAN 上的计算机连接到访问 Internet 的代理服务器时。好处仅包括暴露于 Internet 的服务器。外面的人无法直接访问计算机。转发代理可以通过缓存下载来改善用户的 Internet 访问。它们还可用于限制对某些站点的访问。此外，只有代理服务器需要公共地址，而不是连接到它的客户端。

**反向代理：**

反向代理与正向代理相反。相反，它代表所连接的服务器充当代理。用户不会直接访问远程服务器，而是通过反向代理并从那里定向到适当的服务器。只有反向代理需要 SSL 证书，只需要一个公共 IP 地址，并且它可以处理传入请求的负载平衡以增强整体用户体验。

[![在此处输入图像描述](https://i.stack.imgur.com/J7PA8.jpg)](https://i.stack.imgur.com/J7PA8.jpg)

*图片来源：[使用应用程序请求路由创建正向代理](https://docs.microsoft.com/en-us/iis/extensions/configuring-application-request-routing-arr/creating-a-forward-proxy-using-application-request-routing)*

* * *

## 回答 #11

> 赞同：32
> 
> 时间：2018-10-05T15:31:12.820

> [Cloudflare](https://en.wikipedia.org/wiki/Cloudflare)有一篇很棒的文章，其中包含详细解释这一点的图像。
> 
> 检查这里： *[什么是反向代理？| 代理服务器解释](https://www.cloudflare.com/learning/cdn/glossary/reverse-proxy/)*

[![在此处输入图像描述](https://i.stack.imgur.com/x2jwy.png)](https://i.stack.imgur.com/x2jwy.png)

* * *

[![在此处输入图像描述](https://i.stack.imgur.com/2ERPI.png)](https://i.stack.imgur.com/2ERPI.png)

* * *

## 回答 #12

> 赞同：13
> 
> 时间：2008-10-22T06:33:20.010

[从Apache](http://en.wikipedia.org/wiki/Apache_HTTP_Server)的角度来看，我的理解是代理意味着如果站点 x 代理站点 y，那么对 x 的请求返回 y。

反向代理意味着来自 y 的响应被调整，以便所有对 y 的引用都变为 x。

这样用户就无法分辨出涉及代理...

* * *

## 回答 #13

> 赞同：12
> 
> 时间：2017-08-30T11:21:26.513

**前向代理**授予客户端匿名性（即认为[Tor](http://en.wikipedia.org/wiki/Tor_%28anonymity_network%29)）。

**反向代理**授予后端服务器匿名性（即认为服务器位于 DMZ 后面）。

* * *

## 回答 #14

> 赞同：11
> 
> 时间：2012-12-08T19:00:55.053

据我了解...

首先，众所周知，代理的意思是“代表他人的权力”。现在有两件事，正向和反向代理。

### 转发代理

假设您要访问“Google”，而“Google”又将有 n 个服务器来响应该特定请求。

现在在这种情况下，当您向 Google 请求某些内容并且您不希望 Google 看到您的 IP 地址时，您将使用转发代理，如下所述。

A → B → C

现在你是A，通过B发送请求。所以C会认为请求来自B，而不是A。这样你可以防止你的客户端IP地址不暴露给外界。

### 反向代理

现在在这种情况下，为了让您理解，我们将采用相同的转发代理案例。在这里，您向 Google 请求了一些东西，然后 Google 会将一个请求发送到应用服务器或另一台代理服务器以获取响应。因此，这些事情将如下所述发生。

A → B → C

C → D

C ← D

A ← B ← C

从上图中可以看出，一个请求是从 B 发送到 C 的，而不是从 A 发送的。然后从 C 将有一个请求发送到 D。同样，响应将从 D 到 C，然后到 B 和 A。

上图表明，尽管两个代理的行为方式相同，但只有上下文很重要，但是客户端代理隐藏了客户端信息，而服务器端代理将隐藏服务器端信息。

* * *

## 回答 #15

> 赞同：9
> 
> 时间：2009-06-29T13:19:26.843

这是一个反向代理（作为负载均衡器）的示例。

一个客户端浏览到 website.com，它所访问的服务器上运行着一个反向代理。反向代理恰好是[Pound](https://en.wikipedia.org/wiki/Pound_%28networking%29)。Pound 接收请求并将其发送到位于其后面的三个应用程序服务器之一。在此示例中，Pound 是一个负载均衡器。也就是说，它正在平衡三个应用程序服务器之间的负载。

应用程序服务器将网站内容返回给客户端。

* * *

## 回答 #16

> 赞同：8
> 
> 时间：2019-03-08T07:34:43.110

**转发代理**服务于**用户**：它帮助**用户**访问**服务器**。

**反向代理**服务**于服务器**：它保护**服务器**免受**用户**的侵害。

* * *

## 回答 #17

> 赞同：5
> 
> 时间：2018-04-02T08:17:49.080

**如果没有代理**

从客户端和服务器端看是一样的：

客户端 -> 服务器

**代理人**

从客户端：

客户端 -> 代理 -> 服务器

从服务器端：

客户端 -> 服务器

**反向代理**

从客户端：

客户端 -> 服务器

从服务器端：

客户端 -> 代理 -> 服务器

所以我觉得如果是客户端用户设置的，就叫代理；如果是服务器管理员设置的，就是反向代理。

因为设置它的目的和原因不同，它们处理数据的方式不同，使用的软件也不同。

```
 User side          |      Server side
client  <->  proxy  <-->  reverse_proxy <-> real server 
```

* * *

## 回答 #18

> 赞同：3
> 
> 时间：2019-04-13T05:47:34.187

从用户的角度来看：向*代理*或*反向代理*服务器发送请求时：

*   *代理*- 需要**两个参数**：

    1）获取什么和 2）哪个代理服务器使用中间

*   *反向代理*- 需要**一个参数**：

    1）得到什么

反向代理从用户不知道的另一台服务器获取内容并**返回结果，就好像它来自反向代理服务器一样**。

* * *

## 回答 #19

> 赞同：3
> 
> 时间：2020-08-10T21:22:26.563

**代理服务器**（也称为正向代理）和**反向代理服务器**之间的区别取决于参考点。

从技术上讲，两者完全相同。两者都用于代表源将数据传输到目的地的相同目的。

区别在于**“代理服务器代表谁/代理服务器代表谁？”**

如果代理服务器代表最终用户将请求转发到互联网服务器（例如：大学中的学生通过大学代理服务器访问互联网。），则代理称为“转发代理”或简称为“代理”。

如果代理服务器代表服务器响应传入的请求，则代理称为**“反向代理”**，因为从最终用户的角度来看，它以相反的方向工作。

**反向代理的一些示例：**

1.  Web 服务器前面的负载均衡器代表实际的 Web 服务器充当反向代理。
2.  API网关
3.  免费的网站托管服务，如（facebook 页面/博客页面服务器）也是反向代理。实际内容可能在某个 Web 服务器中，但外界通过反向代理广告的特定 url 知道它。

**使用正向代理：**

1.  监控来自组织的所有出站 Internet 连接
2.  对互联网浏览应用安全策略并阻止下载恶意内容
3.  阻止访问特定网站

**使用反向代理：**

1.  为网站提供友好的 URL
2.  跨多个 Web 服务器执行负载平衡
3.  应用安全策略并保护实际 Web 服务器免受攻击

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2019-04-17T22:29:47.550

以前的大多数答案都很好，但在我看来，没有一个答案能够很好地解决区分两者的“反向”质量。为此，需要给出某种方式来可视化本质上相同的事物（代理）的“反向”性质，并且需要以一种非常抽象的方式给出。

*代理*（隐含的“转发代理”）将多个本地客户端连接到任何一个远程服务器：

```
c--
   |--p--s
c-- 
```

*反向代理*将多个本地服务器连接到任何一个远程客户端（注意布局如何反转）：

```
s--
   |--p--c
s-- 
```

真正正确地理解这个概念是一个视角问题，需要抽象出非必要的（对于特定概念的）细节，尽管它们在代理操作的语用学方面可能非常重要。这些细节包括这样一个事实，即在这两种情况下，现实情况是多个客户端连接到多个服务器，客户端和服务器可能不是真正的本地或远程的，互联网云位于何处或客户端和服务器之间存在什么样的可见性。

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2020-07-22T09:21:53.853

让我们考虑一下服务的目的。

在正向代理中：

代理帮助**用户**访问服务器。

在反向代理中：

代理帮助用户访问**服务器。**

在后一种情况下，被代理帮助的不再是用户，而是服务器，这就是我们称之为**反向**代理的原因。

# .net - 日期时间减去.net

> ID：224665
> 
> 赞同：4
> 
> 时间：2008-10-22T06:28:13.263
> 
> 标签：.net

我想获得两天前的日期时间。即）如何从 datetime.now 中减去 2 天

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-10-22T06:30:04.540

我想你只是在寻找：

```
DateTime.Now.AddDays(-2); 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-10-22T06:32:07.967

或尝试：

```
DateTime.Now.Subtract(TimeSpan.FromDays(2)); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-22T06:32:51.553

另一个解决方案：

```
DateTime twoDays = DateTime.Now.Subtract(new TimeSpan(2,0,0,0)); 
```

# ruby-on-rails - 正确的 Rails 2.1 处事方式

> ID：224669
> 
> 赞同：5
> 
> 时间：2008-10-22T06:30:35.007
> 
> 标签：ruby-on-rails, ruby

[我对 redirect_to 提出的问题](https://stackoverflow.com/questions/223354/rails-ignoring-render-and-redirectto)的一些答案让我想到了其他一些问题。

基本上我正在使用 Rails 2.1 编写博客应用程序。我一直在尝试自己完成大部分工作（因为我知道一点rails），但是当我需要时参考互联网上的教程和参考资料。

我设法让一个简单的博客正常工作，然后我尝试添加评论。我自己设法将它带到了可以添加评论的阶段，`script/console`但我无法让表单正常工作。

我遵循的教程之一建议在帖子控制器中创建一个“评论”操作，以添加评论。我的问题是：这是“标准”的方式吗？我的另一个问题的答案之一似乎表明应该有一个 CommentsController 参与......应该有吗？

我已经设法解决了我在另一个问题中提出的问题，但是我有点担心我是否只是在进行肮脏的快速黑客攻击而不是很好地编程 Rails。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-22T08:10:44.103

现在首选的 Rails 方法是使用 RESTful 样式，这意味着您将拥有一个 Post 资源和一个 Comment 资源，是的，这确实意味着单独的评论控制器。

Softies on Rails 博客上有一[组很好的文章解释了这一点，您应该会发现它们很有启发性。](http://www.softiesonrails.com/search?q=rest+101)不要因为它是针对 .NET 开发人员过渡到 Rails 的事实而让您失望！

# git - Git：在此树中查找重复的 blob（文件）

> ID：224687
> 
> 赞同：18
> 
> 时间：2008-10-22T06:39:23.443
> 
> 标签：git

[这是对这个问题](https://stackoverflow.com/questions/223678)的一种跟进。

如果有多个具有相同内容的 blob，它们只会在 git 存储库中存储一次，因为它们的 SHA-1 将相同。如何查找给定树的所有重复文件？

您是否必须遍历树并查找重复的哈希，或者 git 是否提供从每个 blob 到树中引用它的所有文件的反向链接？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2011-12-06T23:57:34.557

```
[alias]
    # find duplicate files from root
    alldupes = !"git ls-tree -r HEAD | cut -c 13- | sort | uniq -D -w 40"

    # find duplicate files from the current folder (can also be root)
    dupes = !"cd `pwd`/$GIT_PREFIX && git ls-tree -r HEAD | cut -c 13- | sort | uniq -D -w 40" 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-10-22T09:39:19.993

我可以告诉你，在我工作的代码库上运行它让你大开眼界！

```
#!/usr/bin/perl

# usage: git ls-tree -r HEAD | $PROGRAM_NAME

use strict;
use warnings;

my $sha1_path = {};

while (my $line = <STDIN>) {
    chomp $line;

    if ($line =~ m{ \A \d+ \s+ \w+ \s+ (\w+) \s+ (\S+) \z }xms) {
        my $sha1 = $1;
        my $path = $2;

        push @{$sha1_path->{$sha1}}, $path;
    }
}

foreach my $sha1 (keys %$sha1_path) {
    if (scalar @{$sha1_path->{$sha1}} > 1) {
        foreach my $path (@{$sha1_path->{$sha1}}) {
            print "$sha1  $path\n";
        }

        print '-' x 40, "\n";
    }
} 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2010-04-30T10:21:52.190

刚刚制作了一个突出显示由 git 呈现的重复项的单行`ls-tree`。
可能有用

```
git ls-tree -r HEAD |
    sort -t ' ' -k 3 |
    perl -ne '$1 && / $1\t/ && print "\e[0;31m" ; / ([0-9a-f]{40})\t/; print "$_\e[0m"' 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-22T09:03:38.770

您链接问题的脚本答案在这里也非常适用。

从 git 存储库的根目录尝试以下 git 命令。

```
git ls-tree -r HEAD 
```

这会生成当前 HEAD 中所有“blob”的递归列表，包括它们的路径和它们的 sha1 id。

git 不维护从 blob 到树的反向链接，因此解析`git ls-tree -r`输出并创建在列表中多次出现的所有 sha1 的摘要报告将是一个脚本任务（perl，python？）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2017-10-26T22:31:33.737

更一般的：

```
( for f in `find .`; do test -f $f && echo $(wc -c <$f) $(md5 -q $f)   ; done ) |sort |uniq -c |grep -vE '^\s*1\b' |sed 's/.* //' > ~/dup.md5 ; \
( for f in `find .`; do test -f $f && echo $(wc -c <$f) $(md5 -q $f) $f; done ) |fgrep -f ~/dup.md5 |sort 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2018-03-08T06:55:58.740

对于 Windows / PowerShell 用户：

```
git ls-tree -r HEAD | group { $_ -replace '.{12}(.{40}).*', '$1' } | ? { $_.Count -gt 1 } | select -expand Group 
```

这会输出如下内容：

```
100644 blob 8a49bcbae578c405ba2596c06f46fabbbc331c64    filename1
100644 blob 8a49bcbae578c405ba2596c06f46fabbbc331c64    filename2
100644 blob c1720b20bb3ad5761c1afb6a3113fbc2ba94994e    filename3
100644 blob c1720b20bb3ad5761c1afb6a3113fbc2ba94994e    filename4 
```

# c# - .net 中的交易

> ID：224689
> 
> 赞同：146
> 
> 时间：2008-10-22T06:41:02.257
> 
> 标签：c#, .net, transactions

在 C# .Net 2.0 中进行事务的最佳实践是什么。应该使用哪些类？有什么需要注意的陷阱等等。所有提交和回滚的东西。我刚刚开始一个项目，我可能需要在将数据插入数据库时​​进行一些事务。欢迎任何关于交易的基本内容的回复或链接。

* * *

## 回答 #1

> 赞同：274
> 
> 时间：2008-10-22T06:48:26.640

有两种主要的交易类型；连接事务和环境事务。连接事务（例如 SqlTransaction）直接绑定到数据库连接（例如 SqlConnection），这意味着您必须不断传递连接 - 在某些情况下可以，但不允许“创建/使用/释放”使用，并且不允许跨数据库工作。一个例子（格式化为空格）：

```
using (IDbTransaction tran = conn.BeginTransaction()) {
    try {
        // your code
        tran.Commit();
    }  catch {
        tran.Rollback();
        throw;
    }
} 
```

不太乱，但仅限于我们的连接“conn”。如果我们想调用不同的方法，我们现在需要传递“conn”。

另一种选择是环境交易；.NET 2.0 中的新增功能，[TransactionScope](http://msdn.microsoft.com/en-us/library/system.transactions.transactionscope.aspx)对象 (System.Transactions.dll) 允许使用一系列操作（合适的提供程序将自动加入环境事务）。这使得改造现有（非事务性）代码变得容易，并与多个提供者交谈（尽管如果您与多个提供者交谈，DTC 将参与其中）。

例如：

```
using(TransactionScope tran = new TransactionScope()) {
    CallAMethodThatDoesSomeWork();
    CallAMethodThatDoesSomeMoreWork();
    tran.Complete();
} 
```

请注意，这两种方法可以处理它们自己的连接（打开/使用/关闭/处置），但它们会默默地成为环境事务的一部分，而无需我们传入任何内容。

如果您的代码错误，Dispose() 将在没有 Complete() 的情况下被调用，因此它将被回滚。支持预期的嵌套等，尽管您不能回滚内部事务但完成外部事务：如果有人不满意，事务将中止。

TransactionScope 的另一个优点是它不仅与数据库相关联；它还与数据库相关联。任何事务感知提供商都可以使用它。例如，WCF。或者甚至还有一些与 TransactionScope 兼容的对象模型（即具有回滚功能的 .NET 类 - 可能比纪念品更容易，尽管我自己从未使用过这种方法）。

总而言之，一个非常非常有用的对象。

一些警告：

*   在 SQL Server 2000 上，TransactionScope 将立即转到 DTC；这在 SQL Server 2005 及更高版本中已修复，它可以使用 LTM（开销要少得多），直到您与 2 个源等交谈，当它被提升到 DTC 时。
*   有一个[小故障](https://stackoverflow.com/questions/195420/transactionscope-bug-in-net-more-information#195427)意味着您可能需要调整连接字符串

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2012-11-05T07:59:33.300

```
protected void Button1_Click(object sender, EventArgs e)
   {

       using (SqlConnection connection1 = new SqlConnection("Data Source=.\\SQLEXPRESS;AttachDbFilename=|DataDirectory|\\Database.mdf;Integrated Security=True;User Instance=True"))
       {
           connection1.Open();

           // Start a local transaction.
           SqlTransaction sqlTran = connection1.BeginTransaction();

           // Enlist a command in the current transaction.
           SqlCommand command = connection1.CreateCommand();
           command.Transaction = sqlTran;

           try
           {
               // Execute two separate commands.
               command.CommandText =
                "insert into [doctor](drname,drspecialization,drday) values ('a','b','c')";
               command.ExecuteNonQuery();
               command.CommandText =
                "insert into [doctor](drname,drspecialization,drday) values ('x','y','z')";
               command.ExecuteNonQuery();

               // Commit the transaction.
               sqlTran.Commit();
               Label3.Text = "Both records were written to database.";
           }
           catch (Exception ex)
           {
               // Handle the exception if the transaction fails to commit.
               Label4.Text = ex.Message;

               try
               {
                   // Attempt to roll back the transaction.
                   sqlTran.Rollback();
               }
               catch (Exception exRollback)
               {
                   // Throws an InvalidOperationException if the connection 
                   // is closed or the transaction has already been rolled 
                   // back on the server.
                   Label5.Text = exRollback.Message;

               }
           }
       }

   } 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-22T07:40:01.077

您还可以将事务包装到它自己的存储过程中并以这种方式处理它，而不是在 C# 本身中执行事务。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-22T06:46:32.183

如果您只需要它用于与 db 相关的东西，一些 OR Mapper（例如 NHibernate）默认支持开箱即用的 transactinos。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-22T06:51:20.660

这也取决于你需要什么。对于基本的 SQL 事务，您可以尝试在代码中使用 BEGIN TRANS 和 COMMIT TRANS 来执行 TSQL 事务。这是最简单的方法，但它确实具有复杂性，您必须小心正确提交（和回滚）。

我会使用类似的东西

```
SQLTransaction trans = null;
using(trans = new SqlTransaction)
{
    ...
    Do SQL stuff here passing my trans into my various SQL executers
    ...
    trans.Commit  // May not be quite right
} 
```

任何失败都会让您立即退出，`using`并且事务将始终提交或回滚（取决于您告诉它做什么）。我们面临的最大问题是确保它始终承诺。使用确保事务的范围是有限的。

# php - 如何让搜索引擎找到我的 AJAX 内容

> ID：224698
> 
> 赞同：1
> 
> 时间：2008-10-22T06:46:07.207
> 
> 标签：php, ajax, seo

我有一个通过 AJAX 动态加载部分内容的页面。我担心这意味着搜索引擎将找不到该内容。

为了向您展示我的意思，该站点位于[http://www.gold09.net](http://www.gold09.net)，动态内容位于[/speakers.php](http://www.gold09.net/speakers.php) - 通常没有人会访问第二个链接，它只是加载到第一页中。

我知道我可以告诉爬虫`speakers.php`通过使用 a来阅读`sitemap.xml`，但随后我会在搜索结果中显示到 speaker.php 的链接。

我想最终的解决方案是，如果有人请求`/speakers.php`它会将他们重定向到主页，而它让爬虫读取数据。

有什么建议么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-22T06:52:46.647

使指向要编入索引的页面的链接对内容具有真正的 HREF - 但使用 javascript 拦截事件并“返回 false；” 在末尾。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-22T07:13:07.543

正如 nelson laquet 所说，您需要提供 return: false; 在页面上的每个锚点上，不要省略它们的 href 值 [因为这对于像谷歌这样的屏幕阅读器来说真的很重要]

如果您使用重写方法来掩盖这一点，那也会很酷：
在您的服务器端代码上提供仅供您的 javascript 代码使用的参数，例如地址是

```
index.php?ajaxpageneeded=page1 
```

...

```
<body onload="ajaxloaderscript(<?=page1?>);" > 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-22T09:13:26.533

**更新：我所做的是：**

创建了另一个名为的页面[`viewSpeakers.php`](http://www.gold09.net/viewSpeakers.php)，其中仅包含`speakers.php`带有标准页眉和页脚的文件。这意味着如果有人访问该站点，那么他们会看到一个吸引人的页面。该页面的唯一链接位于页面的 HTML 中`index.php`（通过 javascript 立即将其删除）和我的 sitemap.xml。

这样做的效果是，搜索引擎爬虫和禁用 javascript 的用户可以看到指向演讲者信息的链接。启用了 javascript 的人获得了在同一索引页面上动态加载数据的 AJAXy 优势，他们永远不必知道该`viewSpeakers.php`页面。

我可以预见的唯一缺点是，有人可能会`viewSpeakers.php`通过搜索列表访问该页面，然后无法从`index.php`. 其实问题不大...

*这是作为答案添加的，而不是编辑问题，因为这是解决此问题的一种方法。我仍然很想知道是否有比这更好的方法。*

# iphone - iPhone OS 上结构对齐的确切规则是什么？

> ID：224701
> 
> 赞同：4
> 
> 时间：2008-10-22T06:48:17.983
> 
> 标签：iphone, objective-c

我正在使用 Objective-C NSMethodSignature / @encode 工具进行一些跨语言数据类型转换，这意味着我需要能够以编程方式将值复制到以 @encode() 格式描述的结构中。例如，我可能有 4 个浮点数，需要将它们插入到 CGRect 中，这是一个包含 2 个结构的结构，每个结构包含 2 个浮点数。在@encode 术语中，类型是这样的：

```
{CGRect={CGPoint=ff}{CGSize=ff}} 
```

为此，我需要能够猜测结构布局，只知道原始结构成员的数据类型——在本例中为 4 个浮点数。

从历史上看，ARM 结构对齐有两种不同的约定。一种是将结构的所有成员对齐到满足最大成员的边界大小。另一个是将所有成员对齐到适合每个成员数据类型的边界大小。

在 ARM 和 x86 / x86_64 上的 OS X / iPhone OS 中使用哪个？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-22T13:10:53.077

如果您只是想对 CGRect 进行编码，您可能应该为 NSCoder -encodeCGRect:forKey: 使用 UIGeometryKeyedCoding 类别添加。

如果您想在系统之间切换，您可以考虑使用 NSRectFromCGRect() 将 CGRect 转换为 NSRect，然后使用 -encodeValueOfObjCType:at: 对 NSRect 进行编码。

如果您想对其他 C 结构进行编码，Apple 在标有“编码和解码 C 数据类型”的文档中制定了非常明确的政策。正如它在“结构和位字段”下所述，“归档结构或位字段集合的最佳技术是独立归档字段并为每个字段选择适当类型的编码/解码方法。”

# c++ - boost lambda 或 phoenix 问题：使用 std::for_each 对容器的每个元素进行操作

> ID：224704
> 
> 赞同：2
> 
> 时间：2008-10-22T06:49:15.517
> 
> 标签：c++, boost-lambda, boost-phoenix

我在清理一些旧代码时遇到了问题。这是功能：

```
uint32_t ADT::get_connectivity_data( std::vector< std::vector<uint8_t> > &output )
{
    output.resize(chunks.size());
    for(chunk_vec_t::iterator it = chunks.begin(); it < chunks.end(); ++it)
    {
        uint32_t success = (*it)->get_connectivity_data(output[it-chunks.begin()]);
    }
    return TRUE;
} 
```

我感兴趣的是将 for 循环清理为 lambda 表达式，但很快就陷入了如何将正确的参数传递给 get_connectivity_data 的问题。get_connectivity_data 通过引用获取 std::vector 并用一些数据填充它。输出包含每个“块”的 std::vector。

基本上我的结论是，让我的代码保持原样更容易、更简洁、更*短。*

编辑：

因此，正如我所设想的那样，对我的问题最接近的答案是：

```
 std::for_each( chunks.begin(), chunks.end(), 
                   bind( &chunk_vec_t::value::type::get_connectivity_data, 
                         _1, 
                         output[ std::distance( _1, chunks.begn() ] 
                       )
                 ); 
```

然而该代码无法编译，我对代码进行了一些修改以使其编译，但我遇到了 2 个问题：

1.  _ 1 是一个智能 ptr，std::distance 对它不起作用，我想我需要使用 &chunks[0] 作为开始
2.  由于 _ 1 是一个智能指针，我不得不这样做： &chunk_vec_t::value_ type::ValueType::get_connectivity_data 导致 VC9 编译器崩溃...

关于 zip_ 迭代器的答案看起来不错，直到我进一步阅读并发现对于这种特定用途，所需的额外代码量很大（绑定这个和那个等）。

编辑2：

我找到了一个可接受的解决方案，它的无关语法低且清晰，我在此处和下面发布了该解决方案。

```
std::transform(chunks.begin(), chunks.end(), back_inserter(tmp), boost::bind(&ADTChunk::get_connectivity_data, _1) ); 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-23T19:15:17.973

经过一番工作，我想出了这个解决方案：

```
std::transform(chunks.begin(), chunks.end(), back_inserter(tmp), boost::bind(&ADTChunk::get_connectivity_data, _1) ); 
```

它要求我更改 get_connectivity_data 以返回 std::vector 而不是通过引用获取一个，并且还要求我将块的元素更改为 boost::shared_ptr 而不是 Loki::SmartPtr。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-22T07:32:08.690

我认为你认为最好的办法就是保持代码不变是正确的。如果您在（a）您正在编写它并且（b）您理解您要解决的确切问题时很难理解它，想象一下当有人在 3 年后出现并且必须了解您编写的问题和解决方案。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-22T15:02:33.663

如果没有看到整个类的代码，很难确定什么会起作用。就个人而言，我认为 BOOST_FOREACH 在这种情况下更干净，但出于参考目的，我可能会尝试使用 lambdas 做类似的事情（注意我无法测试编译）

```
uint32_t ADT::get_connectivity_data( std::vector< std::vector<uint8_t> > &output )
{
    using namespace boost::lambda;

    output.resize( chunks.size() );

    std::for_each( chunks.begin(), chunks.end(), 
                   bind( &chunk_vec_t::value::type::get_connectivity_data, 
                         _1, 
                         output[ std::distance( _1, chunks.begn() ] 
                       )
                 );
    return TRUE;
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-22T07:19:14.673

关于 lambda，我真的不明白你在做什么，但我可以就涉及 STL 容器的代码清理提出一些一般性建议。

使用所有 STL 容器类型的 typedef：

```
typedef std::vector<uint8_t> Chunks;
typedef std::vector<Chunks> Output;
uint32_t ADT::get_connectivity_data( Output &output ) 
```

既然您在谈论使用 Boost，请使用[Boost.Foreach](http://www.boost.org/doc/libs/1_35_0/doc/html/foreach.html)：

```
BOOST_FOREACH(chunk_vec_t::value_type &chunk, chunks)
  uint32_t success =
    chunk->get_connectivity_data(output[std::distance(&chunk, chunks.begin())]); 
```

在黑暗中刺穿“lambda”的东西：

```
typedef const boost::function2<uint32_t, chunk_vec_t::value_type, Chunks>
  GetConnectivity;
uint32_t ADT::get_connectivity_data(Output &output, GetConnectivity &getConnectivity)
{
  output.resize(chunks.size());
  BOOST_FOREACH(chunk_vec_t::value_type &chunk, chunks)
    uint32_t success =
      getConnectivity(chunk, output[std::distance(&chunk, chunks.begin())]);
  return TRUE;
} 
```

然后你可以这样称呼它：

```
get_connectivity_data(output,
  boost::bind(&chunk_vec_t::value_type::get_connectivity_data, _1, _2)); 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-22T08:32:48.410

您实际上在做的是对两个容器并行执行操作。这就是 boost::zip_iterator 的设计目的。

但是，您需要并行处理容器的唯一原因是 Chunk::get_connectivity_data 需要一个 out 参数。如果要按值返回（使用异常报告错误），您可以只使用插入迭代器。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-22T18:57:50.957

出于某种原因，STL 初学者总是坚持使用 vector::iterator 而不是更具可读性（和恒定时间）的 operator[]。该表达式`it-chunks.begin()`应该告诉原作者他已经输掉了 smartass 编码游戏，毕竟需要一个不起眼的索引：

```
for (size_t i = 0, size = chunks.size(); i < size; ++i)
{
    chunks[i]->get_connectivity_data(output[i]);
} 
```

OP 也可能会考虑丢失虚假的返回代码并将其设为 const 成员函数。

# linux - 使用 Shell 脚本提供密码

> ID：224712
> 
> 赞同：0
> 
> 时间：2008-10-22T06:58:53.500
> 
> 标签：linux, unix, networking, shell

我已经设置了我的客户端和服务器以进行无密码登录。就像通过将服务器的 RSA 密钥复制到所有客户端的 /root/.ssh/id-rsa.pub 来进行无密码登录一样。但是这个，我是手动完成的。我喜欢使用 shell 脚本自动化这个过程，并通过脚本向机器提供密码。如果这个问题得到解决，那么我还想使用 rsync 自动将项目推送到所有服务器。任何机构都可以在这方面帮助我。

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-22T07:01:54.087

该脚本出现在 Debian（和衍生产品）机器中，用于分发密钥。它被称为 ssh-copy-id。你会这样使用它：

```
ssh-copy-id [-i identity_file] [user@]machine 
```

然后你输入密码，复制就完成了。您只需要这样做一次，然后就可以像往常一样通过 ssh 使用 rsync。

```
#!/bin/sh

# Shell script to install your identity.pub on a remote machine
# Takes the remote machine name as an argument.
# Obviously, the remote machine must accept password authentication,
# or one of the other keys in your ssh-agent, for this to work.

ID_FILE="${HOME}/.ssh/identity.pub"

if [ "-i" = "$1" ]; then
  shift
  # check if we have 2 parameters left, if so the first is the new ID file
  if [ -n "$2" ]; then
    if expr "$1" : ".*\.pub" ; then
      ID_FILE="$1"
    else
      ID_FILE="$1.pub"
    fi
    shift         # and this should leave $1 as the target name
  fi
else
  if [ x$SSH_AUTH_SOCK != x ] ; then
    GET_ID="$GET_ID ssh-add -L"
  fi
fi

if [ -z "`eval $GET_ID`" ] && [ -r "${ID_FILE}" ] ; then
  GET_ID="cat ${ID_FILE}"
fi

if [ -z "`eval $GET_ID`" ]; then
  echo "$0: ERROR: No identities found" >&2
  exit 1
fi

if [ "$#" -lt 1 ] || [ "$1" = "-h" ] || [ "$1" = "--help" ]; then
  echo "Usage: $0 [-i [identity_file]] [user@]machine" >&2
  exit 1
fi

{ eval "$GET_ID" ; } | ssh $1 "umask 077; test -d .ssh || mkdir .ssh ; cat >> .ssh/authorized_keys" || exit 1

cat <<EOF
Now try logging into the machine, with "ssh '$1'", and check in:

  .ssh/authorized_keys

to make sure we haven't added extra keys that you weren't expecting.

EOF 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-22T07:02:55.253

如果您需要将更新/更改推送到网络中的多台计算机，那么您可能需要考虑查看像[Puppet](http://puppet.reductivelabs.com/)这样在正常渠道之外工作的东西。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-22T07:13:49.583

`.ssh/authorized_keys`当该方法不可用时，您可以使用 expect 登录到远程机器。例如：

```
#!/usr/bin/expect

spawn   ssh user@remote-host
expect  "*password: $"
send    "YOUR PASSWORD HERE\n"
send    "bash\n"
interact 
```

# sql - 什么是全文搜索与 LIKE

> ID：224714
> 
> 赞同：158
> 
> 时间：2008-10-22T07:00:39.813
> 
> 标签：sql, full-text-search, sql-like

我刚刚阅读了一篇在 SQL 中提到“全文搜索”的帖子。

我只是想知道 FTS 和 LIKE 之间的区别是什么。我确实阅读了几篇文章，但找不到任何可以很好地解释它的东西。

* * *

## 回答 #1

> 赞同：193
> 
> 时间：2008-10-22T07:08:04.183

一般来说，“精度”和“召回”之间存在权衡。高精度意味着呈现的不相关结果更少（没有误报），而高召回率意味着丢失的相关结果更少（没有误报）。使用 LIKE 运算符可为您提供 100% 的精确度，并且不会对召回做出任何让步。全文搜索工具为您提供了很大的灵活性来调整精度以获得更好的召回率。

大多数全文搜索实现使用“倒排索引”。这是一个索引，其中键是单个术语，关联的值是包含该术语的记录集。全文搜索被优化以计算这些记录集的交集、并集等，并且通常提供排名算法来量化给定记录与搜索关键字的匹配程度。

SQL LIKE 运算符效率极低。如果将其应用于未索引的列，将使用完整扫描来查找匹配项（就像对未索引字段的任何查询一样）。如果列被索引，则可以针对索引键执行匹配，但效率远低于大多数索引查找。在最坏的情况下，LIKE 模式将具有需要检查每个索引键的前导通配符。相比之下，许多信息检索系统可以通过在选定字段中预编译后缀树来支持前导通配符。

全文搜索的其他典型特征是

*   词法分析或标记化——将非结构化文本块分解为单个单词、短语和特殊标记
*   形态分析或词干提取——将给定单词的变体折叠成一个索引词；例如，将“mice”和“mouse”，或“electrification”和“electric”视为同一个词
*   排名——测量匹配记录与查询字符串的相似度

* * *

## 回答 #2

> 赞同：42
> 
> 时间：2008-10-22T07:04:44.983

FTS 涉及对文本字段中的各个单词进行索引，以便快速搜索许多记录。使用 LIKE 仍然需要您在字段内进行字符串搜索（线性等）。

* * *

## 回答 #3

> 赞同：30
> 
> 时间：2016-03-03T07:04:29.313

MySQL 从启用的全文搜索列的单词创建一个索引，并在该索引上执行搜索。MySQL 使用复杂的算法来确定与搜索查询匹配的行。

另外，从[这个 SO 答案](https://stackoverflow.com/a/17796826)：

> 全文搜索有几个优点。
> 
> **索引：**
> 
> 就像是：
> 
> ```
> WHERE Foo LIKE '%Bar'; 
> ```
> 
> 无法利用索引。它必须查看每一行，看看它是否匹配。但是，全文索引可以。事实上，全文索引可以在匹配单词的顺序、这些单词之间的距离等方面提供更多的灵活性。
> 
> **词干：**
> 
> 全文搜索可以词干。如果您搜索运行，您可以获得“运行”或“运行”的结果。大多数全文引擎都有多种语言的词干词典。
> 
> **加权结果：**
> 
> 全文索引可以包含多个列。例如，您可以搜索“桃派”，索引可以包括标题、关键字和正文。与标题匹配的结果可以被赋予更高的权重，因为更相关，并且可以排序以显示在顶部附近。
> 
> **缺点：**
> 
> 全文索引可能很大，比标准 B-TREE 索引大很多倍。出于这个原因，许多提供数据库实例的托管提供商禁用此功能，或者至少为此收取额外费用。例如，我上次检查时，Windows Azure 不支持全文查询。
> 
> 全文索引的更新速度也可能较慢。如果数据变化很大，与标准索引相比，更新索引可能会有一些滞后。

* * *

## 回答 #4

> 赞同：18
> 
> 时间：2008-10-22T07:05:11.770

Like 只使用通配符，并没有那么强大。

全文允许更复杂的搜索，包括 And、Or、Not，甚至类似的声音结果 (SOUNDEX) 和更多项目。

我将开始查看 SQL CONTAINS() FREETEXT() 和相关的全文搜索项，以帮助更好地了解可用的内容。

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2015-04-01T05:04:35.393

真正的区别在于扫描方法。对于全文搜索，单词（术语）被用作散列键 - 每一个都与键（术语）出现的文档数组相关联。它是这样的：

```
Document sets = {d1, d2, d3, d4, ... dn}
Term sets = {t1, t2, t3, .. tn} 
```

现在术语-文档矩阵（哪个文档的哪个术语成员）可以表示为：

```
t1 -> {d1, d5, d9,.. dn}
t2 -> {d11, d50, d2,.. dn}
t3 -> {d23, d67, d34,.. dn}
:
tn -> {d90, d87, d57,.. dn} 
```

当请求请求“获取包含单词/术语 t1 的所有文档”时 - 然后`{d1, d5, d9,.. dn`返回文档集 }。

您可以破解去规范化的表模式来存储文档 - MySQL 表中的每一行都将被视为“文档”，而 TEXT 列可以包含一个段落等。倒排索引将包含作为哈希键和行 ID 的术语作为文档 ID。

请记住，此 SQL 查询将具有或多或少的 O(1) 性能。查询将独立于

1.  TEXT 列中的单词/术语数
2.  符合条件的行数/文档数
3.  单词/术语的长度

例如，可以触发此 SQL 以提取与给定单词 XYZ 匹配的所有行：

```
SELECT * 
FROM   my_table 
WHERE  MATCH (my_text_column) against ('XYZ' IN boolean mode) ; 
```

警告：如果您将 ORDER BY 添加到此查询中，您的运行时将根据几个参数而有所不同，其中之一是匹配行/文档的数量。所以要小心。

然而，LIKE 对此一无所知。它被迫线性扫描句子/字符串并找到所有匹配的术语。添加通配符会增加混乱。正如您可以想象的那样，它适用于小长度的字符串，但对于较长的句子会失败。当有一段或一整页的文字等时，绝对没有可比性。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2012-02-09T15:13:22.100

FTS 更高效、更强大（特别是对于分词器和词干提取功能）......但请检查您的要求，因为有时 DB 不支持所有语言，例如 MSSQL 不支持希腊语（请查看此页面[http://msdn. microsoft.com/en-us/library/ms176076(v=sql.110).aspx](http://msdn.microsoft.com/en-us/library/ms176076%28v=sql.110%29.aspx) )

# java - 使用 JMockit 在抽象类中模拟非公共静态方法？

> ID：224721
> 
> 赞同：7
> 
> 时间：2008-10-22T07:05:40.520
> 
> 标签：java, unit-testing, mocking, jmockit

我有以下课程：

```
public abstract class AbstractParent {
    static String method() {
        return "OriginalOutput";
    }
} 
```

我想模拟这种方法。我决定使用[JMockit](http://jmockit.dev.java.net)。所以我创建了一个模拟类：

```
public class MockParent {
    static String method() {
        return "MOCK";
    }
} 
```

我的测试代码如下所示：

```
public class RealParentTest {

    @Before
    public void setUp() throws Exception {
        Mockit.redefineMethods( AbstractParent.class, MockParent.class );
    }

    @Test
    public void testMethod() {
        assertEquals(MockParent.method(),AbstractParent.method());
    }

} 
```

不幸的是，这个测试表明 AbstractParent 返回“OriginalOutput”而不是“MOCK”。任何想法为什么？难道我做错了什么？我也尝试将我的模拟类声明为抽象类，但无济于事。

**编辑**请注意，公开该方法会导致测试运行没有问题......这很奇怪，因为使用 JMockit 您应该能够模拟任何范围的方法。

**回答**只有模拟方法需要公开，您可以保持原始方法不变。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-22T07:42:24.330

找到了解决方案：您只需要将模拟的方法公开（原始方法可以保持其原始可见性）。

我不知道为什么这行得通，而原始方式却不行（非常欢迎有人加入），但您只需将上面示例中的模拟类更改为：

```
public class MockParent {
    public static String method() {
        return "MOCK";
    }
} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2010-12-14T13:49:48.910

显然，这样做的新方法是使用`MockUp<T>`

```
new MockUp<AbstractParent>(){
    @Mock String method() {
        return "MOCK";
    }
};

assertEquals("MOCK" AbstractParent.method()); 
```

另一种选择显然是继续使用annonation之类`MockParent`的东西。`@MockClass`我自己没有这样做，因为另一个内联版本可以完成这项工作。

[我已经在 github 上](https://github.com/gid79/q224721-jmockit-non-public-methods)的示例项目中实现了这一点。

# c# - 在 C# 3 中编写流畅接口的技巧

> ID：224730
> 
> 赞同：43
> 
> 时间：2008-10-22T07:13:49.133
> 
> 标签：c#, design-patterns, fluent-interface

我正在寻找一些关于 C# 中流畅接口的好技巧。我自己只是在学习，但很想听听我正在阅读的文章之外的其他人的想法。特别是我追求：

1.  什么时候流利太多了？
2.  有没有流畅的图案？
3.  C# 中有什么使流畅的接口更流畅（例如扩展方法）
4.  复杂的流畅界面仍然是流畅的界面吗？
5.  重构以达到流畅的界面或重构现有的流畅界面
6.  您使用过或可以推荐的任何好的例子？

如果您可以发布一个提示或想法，或者每个帖子的任何内容。我也想看看他们是如何被投票的。

先感谢您。

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2009-02-01T13:27:21.760

作为流畅接口的消费者，我遇到的最大挑战是它们中的大多数并不是真正的流畅接口——相反，它们实际上是我倾向于称之为“易读接口”的实例。

流畅的界面意味着它的主要目标是使其易于说，而清晰的界面意味着其主要目标是易于阅读。大多数流畅的接口往往难以编写代码，但反过来又非常容易被其他人阅读。

```
Assert().That().This(actual).Is().Equal().To(expected).
    Except().If(x => x.GreaterThan(10)); 
```

...比实际编写代码更容易阅读！

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2008-10-22T07:42:20.400

在你的第四点；

是的，我认为复杂的流畅界面仍然可以流畅。

我认为流畅的界面有点妥协。（虽然很好！）已经有很多关于使用自然语言进行编程的研究，并且通常自然语言不足以表达程序。

Fluent 接口的构造使得它们像编程语言一样编写，只允许您可以用自然语言表达的一小部分内容，但它们读起来像自然语言。

例如，如果您查看 rhino mocks，则与普通库相比，写作部分要复杂得多。由于流畅的界面，我花了更长的时间来学习，但它使代码更容易阅读。因为程序通常只编写一次，并且多次读取，这是一个很好的折衷方案。

所以要稍微说明一下我的观点。一个写起来复杂但易于阅读的流畅界面仍然可以流畅。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2009-02-16T17:52:15.847

将继承与流式接口一起使用时，您会遇到困难，因为使用多态方法会破坏您的调用链，并且您绝对不想通过在不需要它们的地方使用丑陋的强制转换和括号来使您的接口不流利。我写了一篇关于一种模式的文章，它为您提供了一种使用通用构建器和通用扩展方法以及通用约束的解决方法：http: [//liviutrifoi.wordpress.com/2009/02/16/fluent-interfaces-constraints-at-编译时/](http://liviutrifoi.wordpress.com/2009/02/16/fluent-interfaces-constraints-at-compile-time/)

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-08-25T10:44:55.547

Moq 隐藏了不相关的方法，例如 equals 等，`ToString`以使其流畅的界面更易于使用。

[隐藏系统对象](http://www.clariusconsulting.net/blogs/kzu/archive/2008/03/10/58301.aspx)是一篇解释这样做的好处的文章。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2008-10-22T07:57:24.737

关于你的第二个和第三个问题；

我注意到的三种流畅模式

第一个使用 using 语句 (C# 2.0) 在特定上下文中运行代码，例如：

```
using(var transaction = new Transaction())
{
  // ..
  // ..
} 
```

这使用 Transaction 的构造函数和处理器来设置事务，然后在此上下文中运行代码。

第二个几乎相同，但使用 lambda，这在 Rhino Mocks 中被大量使用。

```
(new Transaction()).Run( () => mycode(); ); 
```

最著名的 fluent 接口是使用返回类型来链接方法调用。大多数方法都会返回 this，因此您可以链接对同一对象的调用。但是您也可以根据调用的方法返回不同的对象来更改上下文。如果你有一个只能在事务中运行的对象（抱歉想不出一个不同的例子），你可以给它一个 StartTransaction 方法，它返回一个初始化的事务，你可以在伪代码中运行 call run 和 stoptransaction：

```
class Runner
{
  Transaction StartTransaction()
  {
    return new Transaction(this);
  }
}

class Transaction
{
  Transaction Run()
  Transaction StopTransaction()
} 
```

电话的样子

```
var runner = new Runner();
runner
  .StartTransaction()
  .Run()
  .StopTransaction(); 
```

当然，您需要添加各种错误处理等。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2009-11-25T05:54:57.977

我也刚刚开始学习如何为工作中的小型应用程序编写流畅的界面。我四处询问并进行了一些研究，发现编写流畅界面的一种好方法是使用“构建器模式”，请[在此处](http://en.wikipedia.org/wiki/Builder_pattern "Wiki Builder 模式")阅读更多信息。

本质上，这就是我开始我的方式：

```
public class Coffee
{
    private bool _cream;
    private int _ounces;

    public Coffee Make { get new Coffee(); }

    public Coffee WithCream()
    {
        _cream = true;
        return this;
    }

    public Coffee WithOuncesToServe(int ounces)
    {
        _ounces = ounces;
        return this;
    }
} 
```

这是我在流畅界面中实现闭包[的类似问题](https://stackoverflow.com/questions/1794848/writing-my-first-dsl-in-c-and-getting-hung-up-on-funct-action "Fluent 接口中的闭包")的交叉帖子。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2013-08-20T14:51:59.350

一件事是您必须考虑英语语法的形态，并确保您没有在下面引入未记录的顺序耦合。

```
// Snarky employees get a raise.
employees.WhereSnarky().GiveRaise(); 
```

对比

```
// Depending on implementation, everyone may get a raise.
employees.GiveRaise().WhereSnarky(); 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2010-08-05T01:24:26.673

前段时间我有你现在有同样的疑问。我已经做了一些研究，现在我正在写一些帖子来帮助这些主题。

在我的博客上查看：

[C# 流利界面设计指南第 1 部分](https://www.codeproject.com/articles/99542/guidelines-to-fluent-interface-design-in-c-part)

在接下来的帖子中，我将涵盖您提到的每一点。

最好的问候安德烈·维安娜

# sql - SQL 根据 ID 匹配从一个表更新到另一个表

> ID：224732
> 
> 赞同：1089
> 
> 时间：2008-10-22T07:14:03.313
> 
> 标签：sql, sql-server, select, join, sql-update

我有一个带有`account numbers`and的数据库`card numbers`。我将这些文件与`update`任何卡号与帐号相匹配，因此我只使用帐号。

我创建了一个将表链接到帐户/卡数据库以返回`Table ID`相关帐号的视图，现在我需要更新 ID 与帐号匹配的那些记录。

这是需要更新字段的`Sales_Import`表：`account number`

```
LeadID  AccountNumber
147         5807811235
150         5807811326
185         7006100100007267039 
```

这是`RetrieveAccountNumber`表格，我需要从中更新：

```
LeadID  AccountNumber
147         7006100100007266957
150         7006100100007267039 
```

我尝试了以下方法，但到目前为止没有运气：

```
UPDATE [Sales_Lead].[dbo].[Sales_Import] 
SET    [AccountNumber] = (SELECT RetrieveAccountNumber.AccountNumber 
                          FROM   RetrieveAccountNumber 
                          WHERE  [Sales_Lead].[dbo].[Sales_Import]. LeadID = 
                                                RetrieveAccountNumber.LeadID) 
```

它将卡号更新为帐号，但帐号被替换为`NULL`

* * *

## 回答 #1

> 赞同：1562
> 
> 时间：2008-10-22T07:19:54.610

我相信`UPDATE FROM`with a`JOIN`会有所帮助：

## 微软 SQL

```
UPDATE
    Sales_Import
SET
    Sales_Import.AccountNumber = RAN.AccountNumber
FROM
    Sales_Import SI
INNER JOIN
    RetrieveAccountNumber RAN
ON 
    SI.LeadID = RAN.LeadID; 
```

## MySQL 和 MariaDB

```
UPDATE
    Sales_Import SI,
    RetrieveAccountNumber RAN
SET
    SI.AccountNumber = RAN.AccountNumber
WHERE
    SI.LeadID = RAN.LeadID; 
```

* * *

## 回答 #2

> 赞同：320
> 
> 时间：2010-01-20T12:26:50.277

将内容从一个表复制到另一个表的简单方法如下：

```
UPDATE table2 
SET table2.col1 = table1.col1, 
table2.col2 = table1.col2,
...
FROM table1, table2 
WHERE table1.memberid = table2.memberid 
```

您还可以添加条件以获取复制的特定数据。

* * *

## 回答 #3

> 赞同：162
> 
> 时间：2012-02-11T15:13:15.727

对于 SQL Server 2008 + 使用`MERGE`而不是专有`UPDATE ... FROM`语法有一些吸引力。

除了作为标准 SQL 并因此更具可移植性之外，如果源端有多个连接行（因此在更新中使用多个可能的不同值）而不是最终结果不确定，它也会引发错误.

```
MERGE INTO Sales_Import
   USING RetrieveAccountNumber
      ON Sales_Import.LeadID = RetrieveAccountNumber.LeadID
WHEN MATCHED THEN
   UPDATE 
      SET AccountNumber = RetrieveAccountNumber.AccountNumber; 
```

不幸的是，选择使用哪一个可能不会完全归结为首选风格。SQL Server 中的实现`MERGE`受到各种错误的困扰。Aaron Bertrand 在这里编制了一份[报告的](http://www.mssqltips.com/sqlservertip/3074/use-caution-with-sql-servers-merge-statement/)清单。

* * *

## 回答 #4

> 赞同：132
> 
> 时间：2016-08-29T17:59:14.940

未来开发人员的通用答案。

# SQL 服务器

```
UPDATE 
     t1
SET 
     t1.column = t2.column
FROM 
     Table1 t1 
     INNER JOIN Table2 t2 
     ON t1.id = t2.id; 
```

# Oracle（和 SQL Server）

```
UPDATE 
     t1
SET 
     t1.colmun = t2.column 
FROM 
     Table1 t1, 
     Table2 t2 
WHERE 
     t1.ID = t2.ID; 
```

# MySQL

```
UPDATE 
     Table1 t1, 
     Table2 t2
SET 
     t1.column = t2.column 
WHERE
     t1.ID = t2.ID; 
```

* * *

## 回答 #5

> 赞同：55
> 
> 时间：2014-07-16T19:55:13.500

对于 PostgreSQL：

```
UPDATE Sales_Import SI
SET AccountNumber = RAN.AccountNumber
FROM RetrieveAccountNumber RAN
WHERE RAN.LeadID = SI.LeadID; 
```

* * *

## 回答 #6

> 赞同：39
> 
> 时间：2008-10-22T07:21:53.467

似乎您正在使用MSSQL，那么，如果我没记错的话，它是这样完成的：

```
UPDATE [Sales_Lead].[dbo].[Sales_Import] SET [AccountNumber] = 
RetrieveAccountNumber.AccountNumber 
FROM RetrieveAccountNumber 
WHERE [Sales_Lead].[dbo].[Sales_Import].LeadID = RetrieveAccountNumber.LeadID 
```

* * *

## 回答 #7

> 赞同：36
> 
> 时间：2009-04-29T18:32:22.233

对于没有匹配键的行`foo.new`设置为. 我在 Oracle 中做了这样的事情：`null``foo``bar`

```
更新 foo
设置 foo.new = (选择 bar.new
                  从酒吧
                  其中 foo.key = bar.key)
在哪里存在（选择 1
              从酒吧
              其中 foo.key = bar.key)

```

* * *

## 回答 #8

> 赞同：34
> 
> 时间：2018-09-07T12:49:12.937

以下是在 SQL Server 中对我有用的方法：

```
UPDATE [AspNetUsers] SET

[AspNetUsers].[OrganizationId] = [UserProfile].[OrganizationId],
[AspNetUsers].[Name] = [UserProfile].[Name]

FROM [AspNetUsers], [UserProfile]
WHERE [AspNetUsers].[Id] = [UserProfile].[Id]; 
```

* * *

## 回答 #9

> 赞同：29
> 
> 时间：2012-02-13T16:40:03.477

对于运行良好的 MySql：

```
UPDATE
    Sales_Import SI,RetrieveAccountNumber RAN
SET
    SI.AccountNumber = RAN.AccountNumber
WHERE
    SI.LeadID = RAN.LeadID 
```

* * *

## 回答 #10

> 赞同：22
> 
> 时间：2008-10-22T08:07:41.083

感谢您的回复。我找到了解决方案。

```
UPDATE Sales_Import 
SET    AccountNumber = (SELECT RetrieveAccountNumber.AccountNumber 
                          FROM   RetrieveAccountNumber 
                          WHERE  Sales_Import.leadid =RetrieveAccountNumber.LeadID) 
WHERE Sales_Import.leadid = (SELECT  RetrieveAccountNumber.LeadID 
                             FROM   RetrieveAccountNumber 
                             WHERE  Sales_Import.leadid = RetrieveAccountNumber.LeadID) 
```

* * *

## 回答 #11

> 赞同：20
> 
> 时间：2019-04-24T04:14:53.453

如果表在不同的数据库中。(MSSQL)

```
update database1..Ciudad
set CiudadDistrito=c2.CiudadDistrito

FROM database1..Ciudad c1
 inner join 
  database2..Ciudad c2 on c2.CiudadID=c1.CiudadID 
```

* * *

## 回答 #12

> 赞同：15
> 
> 时间：2017-11-12T16:34:09.543

使用以下查询块根据 ID 将 Table1 更新为 Table2：

```
UPDATE Sales_Import, RetrieveAccountNumber 
SET Sales_Import.AccountNumber = RetrieveAccountNumber.AccountNumber 
where Sales_Import.LeadID = RetrieveAccountNumber.LeadID; 
```

这是解决此问题的**最简单方法。**

* * *

## 回答 #13

> 赞同：12
> 
> 时间：2019-04-23T06:30:11.100

微软 SQL

```
UPDATE  c4 SET Price=cp.Price*p.FactorRate FROM TableNamea_A c4
inner join TableNamea_B p on c4.Calcid=p.calcid 
inner join TableNamea_A cp on c4.Calcid=cp.calcid 
WHERE c4..Name='MyName'; 
```

甲骨文 11g

```
 MERGE INTO  TableNamea_A u 
        using
        (
                SELECT c4.TableName_A_ID,(cp.Price*p.FactorRate) as CalcTot 
                FROM TableNamea_A c4
                inner join TableNamea_B p on c4.Calcid=p.calcid 
                inner join TableNamea_A cp on c4.Calcid=cp.calcid 
                WHERE p.Name='MyName' 
        )  rt
        on (u.TableNamea_A_ID=rt.TableNamea_B_ID)
        WHEN MATCHED THEN
        Update set Price=CalcTot  ; 
```

* * *

## 回答 #14

> 赞同：8
> 
> 时间：2020-12-21T13:25:30.673

在 id 匹配时从一个表更新到另一个表

```
UPDATE 
     TABLE1 t1, 
     TABLE2 t2
SET 
     t1.column_name = t2.column_name 
WHERE
     t1.id = t2.id; 
```

* * *

## 回答 #15

> 赞同：7
> 
> 时间：2016-06-12T20:54:06.687

有人建议的以下 SQL 在 SQL Server 中不起作用。这种语法让我想起了我的老学校课程：

```
UPDATE table2 
SET table2.col1 = table1.col1, 
table2.col2 = table1.col2,
...
FROM table1, table2 
WHERE table1.memberid = table2.memberid 
```

不推荐使用`NOT IN`or的所有其他查询。`NOT EXISTS`出现 NULL 是因为 OP 将整个数据集与较小的子集进行比较，那么当然会有匹配问题。这必须通过编写正确的 SQL 来解决，`JOIN`而不是使用`NOT IN`. 在这种情况下，使用`NOT IN`or可能会遇到其他问题。`NOT EXISTS`

我投票给了第一名，这是通过加入 SQL Server 来更新基于另一个表的表的传统方式。就像我说的，你不能`UPDATE`在 SQL Server 的同一个语句中使用两个表，除非你先加入它们。

* * *

## 回答 #16

> 赞同：4
> 
> 时间：2012-12-06T12:24:29.870

在同一个表中更新：

```
 DECLARE @TB1 TABLE
    (
        No Int
        ,Name NVarchar(50)
        ,linkNo int
    )

    DECLARE @TB2 TABLE
    (
        No Int
        ,Name NVarchar(50)
        ,linkNo int
    )

    INSERT INTO @TB1 VALUES(1,'changed person data',  0);
    INSERT INTO @TB1 VALUES(2,'old linked data of person', 1);

INSERT INTO @TB2 SELECT * FROM @TB1 WHERE linkNo = 0

SELECT * FROM @TB1
SELECT * FROM @TB2

    UPDATE @TB1 
        SET Name = T2.Name
    FROM        @TB1 T1
    INNER JOIN  @TB2 T2 ON T2.No = T1.linkNo

    SELECT * FROM @TB1 
```

* * *

## 回答 #17

> 赞同：4
> 
> 时间：2015-05-14T09:30:28.590

它适用于 postgresql

```
UPDATE application
SET omts_received_date = (
    SELECT
        date_created
    FROM
        application_history
    WHERE
        application.id = application_history.application_id
    AND application_history.application_status_id = 8
); 
```

* * *

## 回答 #18

> 赞同：4
> 
> 时间：2021-03-08T11:55:03.290

这是 Mysql 和 Maria DB 所见过的最简单和最好的

```
UPDATE table2, table1 SET table2.by_department = table1.department WHERE table1.id = table2.by_id 
```

注意：如果您遇到以下基于您的 Mysql/Maria DB 版本的错误“错误代码：1175。您正在使用安全更新模式，并且您尝试更新没有 WHERE 使用 KEY 列的表要禁用安全模式，请切换首选项中的选项”

然后像这样运行代码

```
SET SQL_SAFE_UPDATES=0;
UPDATE table2, table1 SET table2.by_department = table1.department WHERE table1.id = table2.by_id 
```

* * *

## 回答 #19

> 赞同：2
> 
> 时间：2012-06-04T11:55:41.443

我认为这是一个简单的例子可能有人会更容易，

```
 DECLARE @TB1 TABLE
        (
            No Int
            ,Name NVarchar(50)
        )

        DECLARE @TB2 TABLE
        (
            No Int
            ,Name NVarchar(50)
        )

        INSERT INTO @TB1 VALUES(1,'asdf');
        INSERT INTO @TB1 VALUES(2,'awerq');

        INSERT INTO @TB2 VALUES(1,';oiup');
        INSERT INTO @TB2 VALUES(2,'lkjhj');

        SELECT * FROM @TB1

        UPDATE @TB1 SET Name =S.Name
        FROM @TB1 T
        INNER JOIN @TB2 S
                ON S.No = T.No

        SELECT * FROM @TB1 
```

* * *

## 回答 #20

> 赞同：2
> 
> 时间：2021-01-06T09:46:14.027

**MYSQL** （这是我基于主键等效性恢复**所有**特定列值的首选方式）`reasonId``id`

```
UPDATE `site` AS destination  
INNER JOIN `site_copy` AS backupOnTuesday 
      ON backupOnTuesday.`id` = destination.`id`
SET destdestination.`reasonId` = backupOnTuesday.`reasonId` 
```

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2016-11-14T12:58:49.730

**尝试这个 ：**

```
UPDATE
    Table_A
SET
    Table_A.AccountNumber = Table_B.AccountNumber ,
FROM
    dbo.Sales_Import AS Table_A
    INNER JOIN dbo.RetrieveAccountNumber AS Table_B
        ON Table_A.LeadID = Table_B.LeadID 
WHERE
    Table_A.LeadID = Table_B.LeadID 
```

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2022-02-22T08:08:03.513

对于 Oracle SQL，请尝试使用别名

```
UPDATE Sales_Lead.dbo.Sales_Import SI 
SET SI.AccountNumber = (SELECT RAN.AccountNumber FROM RetrieveAccountNumber RAN WHERE RAN.LeadID = SI.LeadID); 
```

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2019-01-21T16:40:30.743

甲骨文 11g

```
merge into Sales_Import
using RetrieveAccountNumber
on (Sales_Import.LeadId = RetrieveAccountNumber.LeadId)
when matched then update set Sales_Import.AccountNumber = RetrieveAccountNumber.AccountNumber; 
```

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2015-04-02T15:27:50.667

这将允许您根据在另一个表中未找到的列值来更新表。

```
 UPDATE table1 SET table1.column = 'some_new_val' WHERE table1.id IN (
            SELECT * 
            FROM (
                    SELECT table1.id
                    FROM  table1 
                    LEFT JOIN table2 ON ( table2.column = table1.column ) 
                    WHERE table1.column = 'some_expected_val'
                    AND table12.column IS NULL
            ) AS Xalias
    ) 
```

这将根据在两个表中找到的列值更新表。

```
 UPDATE table1 SET table1.column = 'some_new_val' WHERE table1.id IN (
            SELECT * 
            FROM (
                    SELECT table1.id
                    FROM  table1 
                    JOIN table2 ON ( table2.column = table1.column ) 
                    WHERE table1.column = 'some_expected_val'
            ) AS Xalias
    ) 
```

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2016-12-13T23:46:41.007

我想补充一件额外的事情。

不要使用相同的值更新值，它会产生额外的日志记录和不必要的开销。请参见下面的示例 - 尽管链接到 3，但它只会对 2 条记录执行更新。

```
DROP TABLE #TMP1
DROP TABLE #TMP2
CREATE TABLE #TMP1(LeadID Int,AccountNumber NVarchar(50))
CREATE TABLE #TMP2(LeadID Int,AccountNumber NVarchar(50))

INSERT INTO #TMP1 VALUES
(147,'5807811235')
,(150,'5807811326')
,(185,'7006100100007267039');

INSERT INTO #TMP2 VALUES
(147,'7006100100007266957')
,(150,'7006100100007267039')
,(185,'7006100100007267039');

UPDATE A
SET A.AccountNumber = B.AccountNumber
FROM
    #TMP1 A 
        INNER JOIN #TMP2 B
        ON
        A.LeadID = B.LeadID
WHERE
    A.AccountNumber <> B.AccountNumber  --DON'T OVERWRITE A VALUE WITH THE SAME VALUE

SELECT * FROM #TMP1 
```

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2022-01-28T15:14:07.920

#### 甲骨文

利用

```
UPDATE suppliers
SET supplier_name = (SELECT customers.customer_name
                     FROM customers
                     WHERE customers.customer_id = suppliers.supplier_id)
WHERE EXISTS (SELECT customers.customer_name
              FROM customers
              WHERE customers.customer_id = suppliers.supplier_id); 
```

* * *

## 回答 #27

> 赞同：-3
> 
> 时间：2018-01-10T04:10:35.670

如果上述答案对您不起作用，请尝试此

```
Update Sales_Import A left join RetrieveAccountNumber B on A.LeadID = B.LeadID
Set A.AccountNumber = B.AccountNumber
where A.LeadID = B.LeadID 
```

# c# - 树视图加减号图标更大

> ID：224733
> 
> 赞同：2
> 
> 时间：2008-10-22T07:14:35.107
> 
> 标签：c#, treeview, icons

如何在不禁用视觉样式的情况下使 C# .net 的树视图中的加减号图标更大。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-22T08:21:55.797

我认为你无法控制它。您唯一能做的就是覆盖 DrawNode 事件并自己绘制节点。

首先，您需要将 DrawMode 更改为 OwnerDrawAll。看看相关的 msdn 页面，它包含令人惊讶的细节：http: [//msdn.microsoft.com/en-us/library/system.windows.forms.treeview.drawnode.aspx](http://msdn.microsoft.com/en-us/library/system.windows.forms.treeview.drawnode.aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-04-25T19:11:42.977

这有点晚了......但刚刚遇到这个问题，并且（偶然）发现有一种（间接）方法可以控制 TreeView 上的加号/减号的大小（在 WinForms 中）。

您基本上必须添加一个图像列表，并且 TreeView 加号/减号会随着图像的大小而变化。要在设计器中看到这一点，请执行以下操作：

1.  在表单上创建一个 TreeView，并为其创建一些虚拟节点（确保有子节点）
2.  创建一个图像列表并将其提供给树视图（将其设置到 ImageList 属性中）
3.  将图像列表的 ImageSize 设置为 16,16，将树视图的 Indent 设置为 3 + 图像的大小 (19)，将树视图的 ItemHeight 设置为图像列表的大小 (16)。
4.  进入 ImageList 并将 ImageSize 属性更改为 24、24，并按照步骤 3 更改 Indent 和 ItemHeight 属性（分别更改为 27 和 24）。您现在应该在树视图中有更大的加号/减号。

我不相信您必须在列表中包含图像，尽管我没有尝试过这种方式。希望这可以帮助某人。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-09-17T19:13:16.430

比默认的10px左右大吗？我认为遵循上面的答案，但是因为我在尝试确定如何恢复原始大小时遇到​​了这个问题：

事实证明，如果您设置 indent 属性，您可以进行一些控制 - 任何小于 10 像素的东西都会开始缩小 +/- 图标。我有一个缩进为 5 的树视图，我发现通过将其恢复为 15（甚至 10）可以恢复图标大小。

我希望这可以帮助其他人在该领域寻找解决方案。

# python - 开源分析框架？

> ID：224735
> 
> 赞同：7
> 
> 时间：2008-10-22T07:16:23.433
> 
> 标签：python, profiling

您是否曾经想测试并定量地显示您的应用程序作为静态构建或共享构建、剥离或非剥离、upx 或无 upx、gcc -O2 或 gcc -O3、hash 或 btree 等是否会表现得更好。如果所以这就是你的主题。调整应用程序的方法有数百种，但我们如何收集、组织、处理、可视化每个实验的结果。

几个月来，我一直在寻找一个在概念上类似于 Mozilla 的[Perftastic](http://graphs.mozilla.org)的开源应用程序性能工程/分析框架，我可以在其中开发/构建/测试/分析数百个不同调优实验的化身。

一些要求：

## 平台

SUSE32 和 SUSE64

## 数据格式

非常灵活、紧凑、简单、层次分明。有几种可能性，包括

*   自定义[CSV](http://en.wikipedia.org/wiki/Comma-separated_values)
*   [RRD](http://en.wikipedia.org/wiki/RRDtool)
*   [协议缓冲区](http://en.wikipedia.org/wiki/Protocol_buffers)
*   [JSON](http://en.wikipedia.org/wiki/Json)
*   没有 XML。有很多数据，XML 太冗长

## 数据采集

灵活和可定制的插件。从应用程序中收集大量数据，包括来自 /proc、sys 时间、wall time、cpu 利用率、内存配置文件、泄漏、valgrind 日志、arena 碎片、I/O、localhost 套接字、二进制大小、打开 fds 的性能数据，等等，还有一些来自主机系统。我选择的语言是 Python，我会开发这些插件来监控和/或解析所有不同格式的数据，并将它们存储在框架的数据格式中。

## 标记

所有实验都将被标记，包括 GCC 版本和编译选项、平台、主机、应用程序选项、实验、构建标签等数据。

## 绘图

历史，比较，分层，动态和静态。

*   应用程序构建由自定义 CI 服务器完成，该服务器连续 3 年每天多次发布新的应用程序版本。这就是为什么我们需要持续的趋势分析。当我们添加新功能、修复错误、更改构建选项时，我们希望自动收集分析数据并查看趋势。这是需要生成各种静态构建的地方。
*   对于分析， [Mozilla 动态图](http://graphs.mozilla.org)非常适合做比较图。在不同标签之间进行比较图表会很棒。例如比较 N 个构建版本、比较平台、比较构建选项等。
*   我们有一个包含 3K 测试的测试套件，每个测试都会收集数据，并从测试间数据到每个测试、每个标记组，再到完整的回归套件进行分组。
*   可能性包括[RRDTool](http://oss.oetiker.ch/rrdtool/index.en.html)、[Orca](http://www.orcaware.com/orca/example_sites.html)、[Graphite](http://graphite.wikidot.com/screen-shots)

## 分组分析

*   敏
*   最大限度
*   中位数
*   平均
*   标准差
*   ETC

## 介绍

所有这些都将通过应用服务器呈现和控制，最好是 Django 或 TG。

## 灵感

*   [中通](http://www.centreon.com/Product/Pre-requisits-Centreon-2.x.html)
*   [仙人掌](http://cactiusers.org/index.php)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-30T06:14:29.560

本周在 PyCon 上有一个演讲，讨论了今天 Python 上的各种分析方法。我不认为任何东西都像您所寻找的那样完整，但它可能值得一看。 [http://us.pycon.org/2009/conference/schedule/event/15/](http://us.pycon.org/2009/conference/schedule/event/15/)

您应该能够在本周晚些时候在 blip.tv [http://blip.tv/search?q=pycon&x=0&y=0上找到实际的谈话](http://blip.tv/search?q=pycon&x=0&y=0)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-10-30T11:37:11.203

您可能必须构建您正在寻找的东西，但您可能会从

*   [瓦尔格林德](https://stackoverflow.com/questions/tagged/valgrind)
*   卢克·斯塔克沃克
*   许多其他开源项目

此外，当目的不是*衡量*性能而是*改进*它时，您可能会从中获得一些想法，[这](https://stackoverflow.com/questions/375913/what-can-i-use-to-profile-c-code-in-linux/378024#378024)是它的使用示例[。](https://stackoverflow.com/questions/926266/performance-optimization-strategies-of-last-resort/927773#927773)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-22T13:05:50.823

我不确定您的问题究竟是什么，但是对于分析 Java (web) 应用程序，您可以使用 netbeans profiler 和 profiler4j（可在 sourceforge 上获得）。我已经使用了两者，并且可以通过 Eclipse tptp 推荐它们。

请参阅[如何设置 Eclipse TPTP](https://stackoverflow.com/questions/186615/how-to-set-up-eclipse-tptp)

和[http://profiler4j.sourceforge.net/](http://profiler4j.sourceforge.net/)

编辑：抱歉，刚刚注意到您将此标记为 Python 问题，因此这对您来说一定不是有效的答案。

# sql - 在 SQL Server 2005 中编写分页查询的最优化方法是什么？

> ID：224741
> 
> 赞同：1
> 
> 时间：2008-10-22T07:20:23.627
> 
> 标签：sql, sql-server-2005, optimization

我知道在 SQL Server 2005 中编写分页查询的几种方法。但我不知道它们的性能。哪一种是编写分页 SQL 查询的最佳和最优化的方法？

1.  使用 Row_Number()
2.  使用分区方式
3.  使用临时表
4.  将 Nest Top N 与 Order by 结合使用
5.  还有什么办法？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-22T07:24:20.920

根据我的经验，它使用 ROW_NUMBER()，只需确保 orderby 字段是聚集索引，这样您就不必为每次查询的数据集排序而付出代价。

# jsp-tags - JSP自定义标签库（找不到属性的setter方法）

> ID：224748
> 
> 赞同：9
> 
> 时间：2008-10-22T07:25:23.647
> 
> 标签：jsp-tags

我在使用自定义标签时遇到问题：-

org.apache.jasper.JasperException：/custom_tags.jsp(1,0) 找不到属性的设置方法：名字

这是我的 TagHandler 类：

```
package com.cg.tags;

import javax.servlet.jsp.JspException;
import javax.servlet.jsp.JspWriter;
import javax.servlet.jsp.tagext.TagSupport;

public class NameTag extends TagSupport{

    public String firstname;
    public String lastname;

    public void setFirstName(String firstname){

        this.firstname=firstname;
        }
    public void setLastName(String lastname){

        this.lastname=lastname;
        }

    public int doStartTag() throws JspException {
        try {
            JspWriter out=pageContext.getOut();
            out.println( "First name:  "+firstname+ "Last name: "+lastname);

        } catch (Exception ex) {
            throw new JspException("IO problems");
        }
        return SKIP_BODY;
    }

} 
```

这是我的 TLD 文件：

```
?xml version="1.0" encoding="UTF-8"?>
<taglib>
     <tlibversion>1.1</tlibversion>
     <jspversion>1.1</jspversion>
     <shortname>utility</shortname>
     <uri>/WEB-INF/nametagdesc.tld</uri>
     <info>
       A simple tag library for the examples
     </info>
   <tag>
       <name>name</name>
       <tagclass>com.cg.tags.NameTag</tagclass>
       <bodycontent>empty</bodycontent>
      <attribute>
      <name>firstname</name>
      <required>true</required>
      <rtexprvalue>true</rtexprvalue>
      </attribute>
      <attribute>
      <name>lastname</name>
      <required>true</required>
      <rtexprvalue>true</rtexprvalue>
    </attribute>
 </tag>
</taglib> 
```

这是我的 JSP 页面：

```
<%@ taglib uri="/WEB-INF/nametagdesc.tld" prefix="cg"  %>

<cg:name firstname="fname" lastname="lname"/> 
```

我已经检查过代码是否已正确重新编译和部署等等......

那么，问题来了，为什么找不到setter方法？？？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-10-22T08:43:27.033

检查标签元素中属性的大小写 - 它们应该与 setter 的大小写匹配，而不是成员变量的大小写（顺便说一下，这应该是私有的）。

规则是属性名称的第一个字母大写，然后结果以'set'为前缀，以到达setter名称。

在您的情况下，您调用了 attribute `'firstname'`，因此该规则导致 JSP 编译器寻找“setFirstname”方法。由于您已命名您的设置器`'setFirstName'`（使用大写“N”），您应该使用`'firstName'`（也使用大写“N”）作为属性名称。

将相同的规则应用于`'lastname'`属性，以达到`'lastName'`，并且您应该在做生意。

`IntelliJ`PS在这种情况下，使用好的 IDE（例如

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-22T08:16:43.497

您示例中的 TLD 文件看起来像废话，我不知道是不是因为您没有正确格式化它。

您的自定义标签的*标签*元素应该有一个*属性*元素，该元素对应于您要公开的每个属性。就像是：

```
<tag>
  <name>...</name>
  <tag-class>...</tag-class>
  <body-content>...</body-content>
  <display-name>...</display-name>
  <description>...</description>

  <attribute>
    <name>firstName</name>
    <required>true</required>
    <rtexprvalue>true</rtexprvalue>
    <description>...</description>
  </attribute>
</tag> 
```

请注意，默认情况下属性是字符串。这可以通过在*属性元素中添加**类型*元素来覆盖。

 *# java - Java 应用程序在 Linux 上的“java.io.UnixFileSystem.getBooleanAttributes0”处挂起

> ID：224756
> 
> 赞同：10
> 
> 时间：2008-10-22T07:32:57.160
> 
> 标签：java

我们的客户应用程序似乎挂起以下堆栈跟踪：

```
 java.lang.Thread.State: RUNNABLE
    at java.io.UnixFileSystem.getBooleanAttributes0(Native Method)
    at java.io.UnixFileSystem.getBooleanAttributes(Unknown Source)
    at java.io.File.isFile(Unknown Source)
    at org.tmatesoft.svn.core.internal.wc.SVNFileType.getType(SVNFileType.java:118)
    at org.tmatesoft.svn.core.internal.wc.SVNFileUtil.createUniqueFile(SVNFileUtil.java:299)
    - locked <0x92ebb2a0> (a java.lang.Class for org.tmatesoft.svn.core.internal.wc.SVNFileUtil)
    at org.tmatesoft.svn.core.internal.wc.SVNRemoteDiffEditor.createTempFile(SVNRemoteDiffEditor.java:415)
    at org.tmatesoft.svn.core.internal.wc.SVNRemoteDiffEditor.applyTextDelta(SVNRemoteDiffEditor.java:255) 
```

任何人都知道什么可能导致它挂在 isFile 中？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-22T08:18:19.097

`getBooleanAttributes0`调用`stat`（或`stat64`，如果可用）。如果您有 OpenJDK 源代码，则在文件中列出`jdk/src/solaris/native/java/io/UnixFileSystem_md.c`。

所以真正的问题是，为什么会被`stat`冻结？例如，正在访问的文件是否是已关闭服务器上的网络文件？如果这是一个可重现的问题，您可能希望使用`strace`附加到 Java 进程，就在冻结之前。然后在输出中查找对 的调用`stat`，以查看正在访问的内容。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-22T08:25:56.677

看起来`stat`导致的呼叫`getBooleanAttributes0`正在阻塞。这通常是因为文件位于已关闭的 NFS 共享上。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-05-07T09:31:40.557

当 Eclipse 统计 NFS 自动挂载目录中不存在的文件时，我们会在 Eclipse 中看到此问题。

如果您使用 -f -t -T（跟随分叉和时间）跟踪您的 java 进程，我们会看到*大多数*统计信息会在很短的时间内返回。automount 目录中的那些需要两个数量级的时间。

在许多情况下，操作系统将此作为上下文切换线程的机会。结果是执行统计的线程很长时间没有运行。如果您的 Java 代码（在我们的例子中是一个 Eclipse 插件）没有效率地为每个文件递归地声明树，那么您最终可能会锁定该线程很长时间。

解决方案是阻止您的 Java 这样做。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-22T07:49:51.603

不知道，但显而易见的问题是哪个 JDK/JRE 浮现在脑海中，以及您尝试过其他什么...

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-22T07:51:10.820

也许 SVN 存储库不知何故被锁定了我所能做的就是猜测。

应用程序是否访问 subversion 存储库？

它可能正在等待存储库不再被锁定，谁知道它是您的应用程序。

# wpf - 跨多个 Xaml 文件拆分 WPF 接口

> ID：224765
> 
> 赞同：56
> 
> 时间：2008-10-22T07:38:55.337
> 
> 标签：wpf, xaml

我正在尝试使用 XAML 创建用户界面。但是，该文件很快变得非常大并且难以处理。将其拆分为多个文件的最佳方法是什么。

我希望能够将诸如 ComboBox 之类的元素的内容设置为在不同 xaml 文件中定义的元素（但在同一个 VS 项目中）。

谢谢

* * *

## 回答 #1

> 赞同：48
> 
> 时间：2008-10-22T08:10:48.627

您可以通过定义 UserControls 来拆分大型用户界面。

右键单击解决方案树，选择 Add->New Item... 然后选择 User Control。您可以按常规方式进行设计。

然后，您可以使用命名空间声明在 XAML 中引用您的用户控件。假设您想在一个窗口中包含您的 UserControl。在以下示例中，我将一个名为“Foo”的 UserControl 添加到命名空间“YourCompany.Controls”中：

```
<Window x:Class="YourCompany.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:Controls="clr-namespace:YourCompany.Controls">

  <Controls:Foo ... /> 
```

对于您的特定示例，您将通过定义在您的用户控件中显示数据的 DataTemplate 在组合框中使用您的用户控件。

* * *

## 回答 #2

> 赞同：28
> 
> 时间：2008-10-22T08:06:42.833

[您可以使用ResourceDictionary](http://msdn.microsoft.com/en-us/library/system.windows.resourcedictionary.aspx)拆分 XAML 文件。ResourceDictionary 可用于合并其他文件：

```
<Page.Resources>
  <ResourceDictionary>
    <ResourceDictionary.MergedDictionaries>
      <ResourceDictionary Source="myresourcedictionary.xaml"/>
      <ResourceDictionary Source="myresourcedictionary2.xaml"/>
    </ResourceDictionary.MergedDictionaries>
  </ResourceDictionary>
</Page.Resources> 
```

在 ResourceDictionary 中，您还可以声明可以在元素中使用的样式，以便主 XAML 文件变得更小。

获得更小的 XAML 文件的另一种可能性是定义您自己的控件，然后在您的主应用程序中使用这些控件。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2016-10-17T06:11:51.553

您还可以创建[Page](https://msdn.microsoft.com/en-us/library/system.windows.controls.page(v=vs.110).aspx)，而不是`UserControl`. A`Page`可以由`Window`或[Frame](https://msdn.microsoft.com/en-us/library/system.windows.controls.frame(v=vs.110).aspx)托管。搜索 Page 与 UserControl 的优缺点。这在一定程度上取决于您对导航的要求，这将最适合您的需求。

[这是在框架中使用页面的示例。](http://www.c-sharpcorner.com/uploadfile/mahesh/using-xaml-frame-in-wpf857/)

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-10-22T08:07:01.443

使用样式和用户控件。将您的界面划分为较小的部分，并将它们编码到另一个 xaml 文件中。例子：

`<Window>
<VeryBigControl>
<VeryBigControl.Style>
... <!--very long style-->
</VeryBigControl.Style>
.. <!--content of very big control-->
</VeryBigControl
</Window>`

将其分成三个 xaml 文件：
Window.xaml - 这将是 Window VeryBigControl.xaml - 这
将是 UserControl
VeryBigControlStyle.xaml - 这将是资源字典
等等 :)

# itunes - 如何以编程方式将播放列表或视图添加到 iTunes？

> ID：224766
> 
> 赞同：3
> 
> 时间：2008-10-22T07:39:27.333
> 
> 标签：itunes, playlists

有没有办法以编程方式与 iTunes 交互以添加新的播放列表或智能视图？

例如，假设我从网站下载了 10 个新的 mp3 文件，有没有办法以编程方式将此 mp3 列表添加到名为“新专辑 xx”的新播放列表中？如果这更容易，新的智能视图也可以。

更具体地说，这是针对 Windows 项目的，因此执行此操作的方式应该与平台无关。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-24T01:36:04.477

Apple 确实提供了一个基于 COM 的 SDK，用于在 Windows 中自动执行 iTunes。它不是最好的（例如，我认为您必须确保 iTunes.exe 在桌面会话中运行，并且几个命令可能会导致对话框弹出并阻止您的自动化），但它确实可以让您执行诸如创建新播放列表之类的操作并添加歌曲。

[在这里安装](http://developer.apple.com/sdk/itunescomsdk.html)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-22T07:45:10.910

假设您在 Mac 上...我认为您可以使用 AppleScript 执行此操作，此[链接](http://dougscripts.com/itunes/scripts/scripts06.php)可能有用

# python - 如何使用光标在python中读取数据库中的多个文件

> ID：224771
> 
> 赞同：0
> 
> 时间：2008-10-22T07:41:50.917
> 
> 标签：python, mysql

在 python 中，如何使用游标从 mysql 数据库中读取多个文件或逐个循环并将输出存储在单独的表中？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-22T08:05:50.603

我不明白你的问题（什么是文件？，你的表结构是什么？），但这里有一个简单的示例：

```
>>> import MySQLdb
>>> conn = MySQLdb.connect(host="localhost",
                           user="root",
                           password="merlin",
                           db="files")
>>> cursor = conn.cursor()
>>> cursor.execute("SELECT * FROM files")
5L
>>> rows = cursor.fetchall()
>>> cursor.execute("CREATE TABLE destination (file varchar(255))")
0L
>>> for row in rows:
...   cursor.execute("INSERT INTO destination VALUES (%s)" % row[0])
...
1L
1L
1L
1L
1L 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-22T08:19:48.220

这是一个示例，假设您已经创建了要移动到的表，并带有描述性名称：

```
>>> import MySQLdb
>>> conn = MySQLdb.connect(user='username', db='dbname')
>>> cur = conn.cursor()
>>> cur.execute('select files from old_table where conditions=met')
>>> a = cur.fetchall()
>>> for item in a:
...     cur.execute('update new_table set new_field = %s' % item) # `item` should be tuple with one value, else use "(item,)" with comma 
```

# .net - 如何在 XNA 引擎中嵌入 Ruby？

> ID：224776
> 
> 赞同：3
> 
> 时间：2008-10-22T07:44:26.590
> 
> 标签：.net, ruby, scripting, xna, ironruby

我想知道是否可以将 Ruby 作为脚本语言嵌入到 Microsoft XNA 中，最好的方法是什么。我正在寻找[Xnua 之](http://www.xnua.com/xna_lua_xnua)类的东西，除了 Ruby。

我偶然发现了 Ruby.NET 和 IronRuby，它们似乎都处于非常早期的阶段，所以我不确定它们的可用性如何。此外，我不确定他们是否可以在 Xbox 360上工作。例如[，XNA 论坛上的这个主题](http://forums.xna.com/forums/t/1464.aspx)说 IronPython 不能工作。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-22T13:07:31.820

IronRuby 和 IronPython 不能在 Xbox 360 上运行，因为它们基于[DLR](http://en.wikipedia.org/wiki/Dynamic_Language_Runtime)（动态语言运行时），并且 DLR 大量使用[System.Reflection.Emit](http://msdn.microsoft.com/en-us/library/system.reflection.emit.aspx)类型，这些类型目前在 Xbox 360 .Net Framework 上不可用（经过修改Compact .Net 框架的版本）。

至于最好的方法，不幸的是，这取决于你游戏的其余部分。使 IronRuby 脚本能够在 XNA 程序的上下文中进行评估的工作相当容易，例如查看这篇[博客文章](http://orionedwards.blogspot.com/2008/09/embedded-ironruby-interactive-console.html)。除此之外，您还希望将一些有趣的对象暴露给您的脚本，而这完全取决于您的游戏代码/设计的其余部分。您可以查看[Unity 的脚本文档](http://unity3d.com/support/documentation/ScriptReference/index.html)以了解要公开的类型和命令。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-22T09:31:19.400

几乎可以肯定 IronRuby 不能在 Xbox 上运行，但如果您只想为 Windows 开发 XNA 游戏，那么您应该能够以与任何其他应用程序相同的方式使用它。

我真的不能告诉你你会*怎么*做，只是应该是可能的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-12T10:46:55.450

虽然我同意 Leaf Garland 的意见，但让我为您提供一个替代方案：

游戏的“首选”脚本语言是 Lua。例如《孤岛危机》和《孤岛惊魂》游戏广泛使用 LUA。在[wikipedia](http://en.wikipedia.org/wiki/Lua_(programming_language)#Applications)上浏览一下使用它的著名游戏列表。

就在 XNA 中使用它而言，自从我刚开始从事 XNA 开发的业余爱好以来，我只触及了皮毛，但我知道你不能直接在 XNA 中使用 LUA。这是因为 LUA 是用 C++（非托管）构建的，因此您将无法将其部署到您的 XBOX360。

[在http://www.xnua.com/](http://www.xnua.com/)有一个正在开发的项目正在构建一个 XNA 版本的 lua 。它也是一个免费产品，源代码也可供下载。

如果游戏行业认为 LUA 足以胜任 AAA 商业游戏，我个人也会遵循这个方向（基于他们在该领域的经验比我多得多）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-12T11:03:55.817

为什么不将 Ruby 用于 PC 开发，而将 Lua 用于 360？

编辑：也许[这](http://rubyluabridge.rubyforge.org/)会有用。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-06-29T07:13:07.690

尽管它不是 Ruby，而且这是一个老问题，但我想向您介绍我一直在构建的新脚本引擎。它基本上可以在任何有 .Net 框架的地方运行，包括在 XNA 下的 Xbox360 上。它不使用 Reflection.Emit，因此它可以在其他语言不使用的地方工作。它也是完全托管的代码，所以没有像 Lua 这样的 P/Invokes。

[您可以从我的博客](http://lastyearswishes.com/blog/view/4fe97af34aa5d825b303f18b)中获得更多信息，并可以在此[演示页面上试用](http://scripter2.lastyearswishes.com/)

它几乎已准备好进行 Beta 测试，但经过 Beta 测试后，它将成为商业许可组件

# .net - 带有 __declspec(thread) 的线程本地存储在 C++/CLI 中失败

> ID：224777
> 
> 赞同：6
> 
> 时间：2008-10-22T07:44:39.163
> 
> 标签：.net, c++, multithreading, interop

我正在做一个项目，我们通过 C++/CLI 层混合 .NET 代码和本机 C++ 代码。在这个解决方案中，我想通过 __declspec(thread) 声明使用线程本地存储：

```
__declspec(thread) int lastId = 0; 
```

但是，在第一次访问该变量时，我得到了 NullReferenceException。更准确地说，声明是在*ref 类*（在 C++/CLI 中实现的 .NET 类）中完成的。

我已经阅读了一些关于 __declspec(thread) 不适用于延迟加载的 DLL 的内容。如果我使用 .NET，我是否会自动使用延迟加载的 DLL？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-22T08:05:53.317

似乎[CLR 不支持](http://blogs.msdn.com/jeremykuhne/archive/2006/04/19/578670.aspx)__declspec(thread) 。

请记住，.net 线程不一定是本机线程，[但也可以是 fiber](http://blogs.msdn.com/cbrumme/archive/2003/04/15/51351.aspx)，因此线程的标准 API 不适用于它们。

如果你有一个托管类，那么你应该使用托管线程 API 的[线程本地存储](http://msdn.microsoft.com/en-us/library/system.threading.thread.getnameddataslot(vs.80).aspx)。

有很多关于这种差异的文章。这只是为了让你开始。

提示：您可以使用 ThreadStatic 属性而不是 TLS 来提高[性能](http://blogs.msdn.com/ricom/archive/2006/07/18/performance-quiz-10-thread-local-storage-solution.aspx)。如果您正在使用 ASP.NET 应用程序，您需要记住[一些](http://piers7.blogspot.com/2005/11/threadstatic-callcontext-and_02.html)关于 TLS 的事情。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-22T08:09:43.247

很遗憾不支持。这是一个带有解决方法的博客条目：

[http://blogs.msdn.com/jeremykuhne/archive/2006/04/19/578670.aspx](http://blogs.msdn.com/jeremykuhne/archive/2006/04/19/578670.aspx)

# visual-studio - Visual Studio 参考 x64 GAC

> ID：224786
> 
> 赞同：10
> 
> 时间：2008-10-22T07:53:22.423
> 
> 标签：visual-studio, 64-bit

如何让 Visual Studio 2005/2008 引用 64 位 GAC 而不是 32 位 GAC 中的程序集？我们将目标平台设置为 x64，编译器抛出错误

> 错误 2 警告为错误：程序集生成 -- 引用的程序集“System.Data.dll”针对不同的处理器
> 
> 错误 3 警告为错误：程序集生成 -- 引用的程序集“mscorlib.dll”针对不同的处理器
> 
> 错误 4 程序集签名失败；输出可能没有签名——系统找不到指定的文件。常见的

* * *

**2008 年 12 月 29 日更新**

一直在尝试[Aaron Stebner](http://blogs.msdn.com/astebner/archive/2005/11/28/497693.aspx)将 64 位程序集放置到隔离位置（例如 C:\Windows\Microsoft.NET\Framework64\v2.0.50727\GAC_64）的建议，并在注册表中创建其他条目，如 HKLM\SOFTWARE\Microsoft.NETFramework \AssemblyFolders\GAC_64 或 HKLM\SOFTWARE\Microsoft.NETFramework\v2.0.50727\AssemblyFoldersEx\GAC_64 但 Visual Studio 2005 仍然没有选择它....

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-01T00:12:57.137

我不确定你为什么需要这样做。如果可以，未专门为 32 位编译的 .NET 代码将运行 64 位。这包括基本框架库。简而言之，我知道没有理由专门为 64 位编译您的程序集（除了引用非托管 64 位 dll，但您说的是 GAC）。

更多信息可能会有所帮助。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-22T08:46:10.303

您是否在 Configuration Manager 中为解决方案中的所有项目设置了 x64 平台？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-04-29T07:05:41.157

我创建了一个完全免费的工具，它将帮助您实现目标。[Muse VSReferences](http://visualstudiogallery.msdn.microsoft.com/en-us/36a6eb45-a7b1-47c3-9e85-09f0aef6e879)将允许您从“添加 GAC 引用”菜单项添加对项目的全局程序集缓存引用。

# python - 如何从 django 视图生成报告文件（ODF、PDF）

> ID：224796
> 
> 赞同：6
> 
> 时间：2008-10-22T08:02:06.787
> 
> 标签：python, django, pdf, pdf-generation

我想从 django 中的视图和模板生成报告文件。首选文件格式是 OpenOffice/ODF 或 PDF。

做这个的最好方式是什么？

我确实想重用模板中定义的页面布局，可能通过重新定义派生模板中的一些块。

理想情况下，报告应该插入到现有的模板文件中，这样我就可以在生成的输出格式中提供整体页面布局、页眉和页脚。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-22T09:05:22.993

[pisa/xhtml2pdf](http://www.htmltopdf.org/)应该可以让您了解 PDF。它甚至包括一个示例 Django 项目。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-22T15:05:08.867

尝试使用 ReportLab 进行 PDF 输出：

[http://www.reportlab.org/](http://www.reportlab.org/)

# winapi - 结束win32进程vbscript

> ID：224797
> 
> 赞同：1
> 
> 时间：2008-10-22T08:03:13.870
> 
> 标签：winapi, vbscript, wmi

我有以下代码来结束进程，但我仍然收到错误代码 2（拒绝访问）。

```
strComputer = "." 
Set objWMIService = GetObject("winmgmts:\\" & strComputer & "\root\cimv2")
Set colProcessList = objWMIService.ExecQuery("SELECT * FROM Win32_Process WHERE Name = 'MSSEARCH.exe'")
For each objProcess in colProcessList
  wscript.echo objProcess.processid
  intrc = objProcess.Terminate()
  if intrc = 0 then wscript.echo "succesfully killed process" else wscript.echo "Could not kill process. Error code: " & intrc End if 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-22T08:11:36.130

结束程序而获得“拒绝访问”是非常合法的。如果它是一项服务（我猜是 mssearch.exe），那么它可能以“SYSTEM”用户身份运行，该用户甚至拥有比管理员帐户更高的权限。

您无法以 SYSTEM 帐户登录，但您可能会编写一个服务来管理其他服务...

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-22T08:23:30.147

作为非特权用户，您只能结束您拥有的进程。在多用户环境中，这可能会咬到你的脚踝，因为 WMI 也会从其他用户返回同名进程，除非你编写更具体的 WQL 查询。

如果您的进程是一项服务，并且您的脚本在特权帐户下运行，您可能仍需要采用“常规路线”来停止它，例如使用`WScript.Shell`to 调用`net stop`or `sc.exe`，或者更优雅地使用`Win32_Service`类：

```
Set Services = objWMIService.ExecQuery _
               ("SELECT * FROM Win32_Service WHERE Name = '" & ServiceName & "'")

For Each Service In Services
  Service.StopService()
  WSCript.Sleep 2000 ' wait for the service to terminate '
Next 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-22T08:34:28.173

如果您查看此页面： http: [//msdn.microsoft.com/en-us/library/aa393907](http://msdn.microsoft.com/en-us/library/aa393907(VS.85).aspx) (VS.85).aspx您会看到错误代码 2 是访问被拒绝而不是文件未找到

# php - 按位标志被放弃了？

> ID：224799
> 
> 赞同：20
> 
> 时间：2008-10-22T08:04:08.907
> 
> 标签：php, mysql, open-source

我注意到很多开源项目不再使用 BITWISE 标志，即使它完全被 web 通用编程环境 (php/Mysql) 支持。对于一些有效的问题，这是一种“丢失的做法”，还是只是很多 php 程序员不知道如何处理这种类型的实现？

没什么太重要的，只是很好奇:)谢谢大家

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-10-22T08:47:24.543

我会伸出脖子说每个技术职位都需要对位运算有充分的了解。

我有一个间接解决这个话题的轶事。

2007 年 1 月，我在印度科钦招聘长期开发人员。由于我没有参与候选人的初步筛选，所以我不知道期望什么标准，所以我准备了一系列问题和主题，从对二进制和十六进制的简单理解到架构、设计和项目管理。

当我与印度人力资源部的人讨论我的方法时，我（温和地）因为投球太低而受到指责。他明确表示，我关于 hex 的问题可能会被解释为对候选人经验或教育的侮辱。

但我在英国面试数百名候选人的经历让我坚信，不可能把调得太低。我的观点过去和现在仍然是，如果候选人很合格，那么调整讨论水平就很简单了。我从来没有人表达过被侮辱的感觉，相反，我认为一个合格的候选人可能会在面试的飞速开始时感到如释重负。它还有助于打破僵局并建立有意义的采访所需的融洽关系。另一方面，不合格的候选人通常会遇到这些较低的障碍。

但不想完全忽视当地的建议，我谨慎地决定将我的基本采访主题包括在内，并准备好在它们不起作用时放弃它们。

随着面试的进行，我很高兴我从那个级别开始。它没有冒犯任何人，不合适的候选人很容易被识别出来。

这并不是说我希望应聘者每天都在处理一些琐碎的事情，但无论是哪种语言，对编程基础知识的充分理解都是必不可少的。即使是更高抽象级别的开发人员也会定期接触十六进制（例如 RGB 值）。重复[你在网上找到的东西](http://www.codeproject.com/)只会在第一次完美运行的情况下有所帮助。

但是对于在过去五年中起步的开发人员来说，我认为掩饰基础知识太容易了，这些基础知识被善意的 IDE 和“无代码”编程的模因所宠爱。Visual Studio 安装闪屏吹嘘无需编写代码即可进行开发。确实，[Visual Studio 是否会腐烂](http://www.charlespetzold.com/etc/DoesVisualStudioRotTheMind.html)？

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-10-22T08:09:23.013

如今，许多程序员似乎只是脑子里装满了足够的知识来暴力破解代码，然后在没有被告知“按位”之类的词是什么意思的情况下被送入工作岗位。

我告诉你，这是一门垂死的艺术……

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-10-22T11:14:35.043

按位运算不仅仅是为了节省内存。它们对于编写清晰的代码非常有用。你更想看哪个？

```
OpenFile("...", true, false) 
```

或者

```
OpenFile("...", writeonly | append) 
```

这是一个荒谬/微不足道的例子，但你明白了。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-10-22T08:25:32.187

如果您有一个已经很复杂的应用程序，为什么要使用按位标志使其更复杂。如果没有更多的好处，我个人不会使用这种标志，然后只是很酷。而且凭经验，写起来还是挺容易的，以后调整就更难了，更别说自己没写了。

哦，为了记录，我确实知道如何使用它们。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2011-06-24T21:01:15.937

在内存管理至关重要的嵌入式编程之外，它们的成本超过了它们的最低价值。特别是，查询包含按位标志的 db 列会产生神秘的 SQL，它需要引用应用程序的代码来确定每个按位操作引用的值。

```
WHERE (ISNULL(flags, 0) & 4096 = 0 -- What does this bit refer to? 
```

如果必须以这种方式查询您的数据库不会吓到您，那么应该这样做。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-22T09:34:58.300

如果您对内存和速度有非常严格的要求，或者在进行低级硬件编程时，位域非常有用。

除非您正在做嵌入式编程或类似的事情，否则您不需要它们。执行相同任务有更多可读、更强大、更可扩展的机制。例如，Java 的 EnumSets。

我希望一个好的程序员了解它们而不是使用它们:-p

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-10-22T10:53:25.147

“Plenty”很笼统，我们想要名字！;-)

说真的，我来自汇编语言和 C 语言，并且非常精通按位运算。但我不会用它们来替换，比如说一个类中的 10 个不相关的布尔值，其中的二进制标志是一个整数......除非，也许，我有这个类的数百万个实例！

如果我必须处理大量布尔实例，我会使用一些位集类来优化和抽象这些位数组。

现在，位操作 fu 在编程中几乎是强制性的，如果你想访问 RGB[A] 值的组件，如果你想调用一些 API（即使这只是 ORing 多个命名标志）等等。

简而言之，我不会在我做的每个项目中都使用它，但你不能忽略如何去做（有点像正则表达式......）。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-22T08:17:53.247

我仍然使用按位运算符，尽管由于我选择的主要语言（和专业）是 C#，我经常使用 Flag 枚举 :) 但是，我认为很多编写 PHP 之类的代码的人都是自学的，而不是了解按位运算或它们的用法。

自学成才，在开始编写 C 和 C++ 代码之前，我对它们了解不多。现在我在有意义的地方使用它们:)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-22T09:54:11.977

他们总是有一个地方可以在很小的空间中存储大量的布尔标志；

想想如果你有 32 个标志（例如）；您可以将它们全部存储在一个“长整数”中并且只使用 4 个字节，现在假设您选择为每个标志使用 long（只是因为代码更易于维护 - 您现在有 128 个字节要处理。

我的背景主要是 C/C++，所以我从小就接触它们，所以我肯定会在我使用的每一种语言中使用它们；但我同意；新手程序员往往甚至不在乎——所有这些内存都在周围——谁在乎呢？

# regex - 正则表达式比较会消耗大量资源吗？

> ID：224804
> 
> 赞同：3
> 
> 时间：2008-10-22T08:06:47.263
> 
> 标签：regex

我不知道，但是如果您使用非常复杂的正则表达式，您的机器会严重减速吗？例如最近提出的著名的电子邮件验证模块？可以在这里找到[RFC822](http://ex-parrot.com/~pdw/Mail-RFC822-Address.html)

更新：对不起，无论如何我不得不匆忙问这个问题，我发布了我正在谈论的电子邮件正则表达式的链接

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-22T08:09:27.367

它高度依赖于单个正则表达式：后视或前瞻等功能可能会变得非常昂贵，而简单的正则表达式在大多数情况下都可以。

[http://www.regular-expressions.info/](http://www.regular-expressions.info/)上的教程提供了性能建议，因此可以作为一个好的开始。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-22T09:41:56.167

正则表达式通常实现为对应于两个不同 FSM的两种算法（ [NFA](http://en.wikipedia.org/wiki/Nondeterministic_finite_state_machine)或[DFA ）之一。](http://en.wikipedia.org/wiki/Deterministic_finite-state_machine)不同的语言，甚至同一种语言的不同版本可能有不同类型的正则表达式。自然地，一些正则表达式在一个中运行得更快，而另一些在另一个中运行得更快。如果它真的很重要，您可能想找到实现了哪种类型的正则表达式 FSM。

我不是这里的专家。我通过阅读Jeffrey EF Friedl 的[Mastering Regular Expressions获得了所有这些信息。](http://oreilly.com/catalog/9780596528126/index.html)你可能想查一下。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-22T08:53:51.753

还取决于您优化查询的程度以及了解正则表达式的内部工作。

例如，使用否定字符类可以节省引擎回溯字符的成本（即 /<[^>]+>/ 而不是 /<.+?>/）(*)。在小型匹配中微不足道，但节省了当您必须在一大段文本中进行匹配时，会出现很多循环。

还有许多其他方法可以在正则表达式操作中节省资源，因此性能可能会有很大差异。

*   示例取自[http://www.regular-expressions.info/repeat.html](http://www.regular-expressions.info/repeat.html)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-22T10:40:31.087

您可能会对以下文章感兴趣：[正则表达式匹配可以简单快速](http://swtch.com/~rsc/regexp/regexp1.html "正则表达式匹配可以简单快速")或[了解正则表达式](http://www.foo.be/docs/tpj/issues/vol1_2/tpj0102-0006.html "理解正则表达式")。

唉，写低效的 RE 是很容易的，它可以在成功时很快匹配，但如果找不到匹配，可能会寻找几个小时，因为引擎愚蠢地尝试对长字符串的每个位置进行长匹配！

有一些方法可以解决这个问题，比如尽可能锚定，尽可能避免贪婪等。

请注意，巨大的电子邮件表达不是最近的，也不一定很慢：简短的表达可能比更复杂的表达要慢！

另请注意，在某些情况下（例如电子邮件，确切地说），使用正则表达式和代码的混合来处理案例可能更有效（并且可维护！），例如在@处拆分，处理不同的案例（第一部分以" 与否，第二部分是 IP 地址或域等）。

正则表达式并不是万能的终极工具，但它是一个非常有用的工具，值得掌握！

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-22T10:37:43.993

这取决于您的正则表达式引擎。正如[这里所解释的（正则表达式匹配可以简单快速）](http://swtch.com/~rsc/regexp/regexp1.html)，根据实现的不同，性能可能会有一些重要的差异。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-22T21:28:01.810

你不能谈论一般的正则表达式，就像你不能谈论一般的代码一样。

正则表达式本身就是小程序。正如任何给定的程序可能快或慢一样，任何给定的正则表达式可能快或慢。

然而，要记住的一件事是，正则表达式处理程序经过了很好的优化，可以完成其工作并快速运行正则表达式。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-22T08:14:42.923

我曾经做过一个分析大量文本的程序（一个很大的代码库，>300k 行）。首先我使用了正则表达式，但是当我切换到使用常规字符串函数时，它变得更快了，比如占用了正则表达式版本的 40% 的时间。因此，虽然这当然取决于，但我的事情变得更快了。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-22T08:33:30.267

一旦我写了一个贪婪的 - 当然是偶然的:-) - 一个多行正则表达式并让它在 10 * 200 GB 的文本文件上搜索/替换。它太慢了......所以这取决于你写什么，你检查什么。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-22T08:39:42.670

取决于表达式的复杂性和表达式使用的语言。

在 JavaScript 中；你必须优化一切。在 C# 中；没那么多。

# mysql - 将firelog插入mysql

> ID：224806
> 
> 赞同：0
> 
> 时间：2008-10-22T08:07:40.473
> 
> 标签：mysql, insert

我也有兴趣将要打印到标准输出的防火墙日志插入到 mysql 数据库中。我该怎么做？

线路输出为：

`16:51:56 drop Nova <eth0 Attack Info: MS Word cascading style sheet vulnerability detected (MS08-026); attack: Content Protection Violation; viola profile: Default_Protection; src: udis; dst: Nova; proto: tcp; product: viola; service: http; s_port: 48125;`
`16:35:13 drop Nova <eth0 Attack Info: Macrovision InstallShield ActiveX memory corruption; attack: Web Client Enforcement Violation; SmartDefense profile: Default_Protection; src: udis; dst: Nova; proto: tcp; product: SmartDefense; service: http; s_port: 44607;`

我可以使用perl，bash。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-22T08:42:28.267

1.  定义一个表结构，哪些字段将对应行的哪一部分，
2.  使用正则表达式或拆分将每个定义的部分存储到变量中
3.  从步骤 2 中获得的变量构建 INSERT 字符串
4.  将其通过管道传输到 mysql

例子：

```
~> echo '16:51:56 drop foo <tcpip scan' | \
   perl -nle "m/(\d{2}:\d{2}:\d{2})\s(.+?)\s(.+?)\s<(.+)$/; \
   print \"INSERT INTO flog(date,action,machine,attack) \
   VALUES ('\$1','\$2','\$3','\$4')\"" | mysql -uroot -ppass flog 
```

您可以使用 perl 本身通过 DBI 插入带有占位符的值。如果日志有一些特殊的 SQL 字符，那会更安全。

# javascript - 如何将参数传递给 JavaScript 中的匿名函数？

> ID：224820
> 
> 赞同：86
> 
> 时间：2008-10-22T08:12:51.227
> 
> 标签：javascript, jquery

我试图弄清楚如何将参数传递给 JavaScript 中的匿名函数。

查看此示例代码，我想您会明白我的意思：

```
<input type="button" value="Click me" id="myButton" />

<script type="text/javascript">
    var myButton = document.getElementById("myButton");
    var myMessage = "it's working";
    myButton.onclick = function(myMessage) { alert(myMessage); };
</script> 
```

单击按钮时，`it's working`应显示消息：。但是`myMessage`匿名函数内的变量为空。

jQuery 使用了很多匿名函数，传递该参数的最佳方式是什么？

* * *

## 回答 #1

> 赞同：74
> 
> 时间：2008-10-22T08:17:20.253

您的具体情况可以简单地纠正为有效：

```
<script type="text/javascript">
  var myButton = document.getElementById("myButton");
  var myMessage = "it's working";
  myButton.onclick = function() { alert(myMessage); };
</script> 
```

此示例将起作用，因为创建并分配为元素处理程序的匿名函数将有权访问在创建它的上下文中定义的变量。

作为记录，处理程序（您通过设置 onxxx 属性分配）期望使用单个参数，即 DOM 传递的事件对象，并且您不能强制在其中传递其他参数

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2008-10-22T08:18:22.247

您所做的事情不起作用，因为您将事件绑定到函数。因此，事件定义了在引发事件时将调用的参数（即 JavaScript 不知道您绑定到 onclick 的函数中的参数，因此无法向其中传递任何内容）。

但是，您可以这样做：

```
<input type="button" value="Click me" id="myButton"/>

<script type="text/javascript">

    var myButton = document.getElementById("myButton");

    var myMessage = "it's working";

    var myDelegate = function(message) {
        alert(message);
    }

    myButton.onclick = function() { 
        myDelegate(myMessage);
    };

</script> 
```

* * *

## 回答 #3

> 赞同：21
> 
> 时间：2010-10-16T17:40:59.443

以下是使用闭包解决您提到的问题的方法。它还考虑到可以随时间改变消息而不影响绑定的事实。它使用 jQuery 简洁。

```
var msg = (function(message){
  var _message = message;
  return {
    say:function(){alert(_message)},
    change:function(message){_message = message}
  };
})("My Message");
$("#myButton").click(msg.say); 
```

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2008-10-22T08:17:21.610

通过从匿名函数中删除参数将在正文中可用。

```
 myButton.onclick = function() { alert(myMessage); }; 
```

有关更多信息，请搜索“javascript 闭包”

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-10-22T08:32:09.583

事件处理程序需要一个参数，即被触发的事件。您碰巧将其重命名为“myMessage”，因此您正在提醒事件对象而不是您的消息。

闭包可以让您引用您在函数外部定义的变量，但是如果您使用的是 Jquery，您可能需要查看其事件特定 API，例如

[http://docs.jquery.com/Events/bind#typedatafn](http://docs.jquery.com/Events/bind#typedatafn)

这有一个用于传递您自己的数据的选项。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2010-09-30T20:28:02.367

```
<input type="button" value="Click me" id="myButton" />

<script type="text/javascript">
    var myButton = document.getElementById("myButton");

    myButton.myMessage = "it's working";

    myButton.onclick = function() { alert(this.myMessage); };

</script> 
```

这适用于我的测试套件，其中包括来自 IE6+ 的所有内容。匿名函数知道它所属的对象，因此您可以使用调用它的对象（在本例中为 myButton ）传递*数据*。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-22T08:27:09.577

例子：

```
<input type="button" value="Click me" id="myButton">
<script>
    var myButton = document.getElementById("myButton");
    var test = "zipzambam";
    myButton.onclick = function(eventObject) {
        if (!eventObject) {
            eventObject = window.event;
        }
        if (!eventObject.target) {
            eventObject.target = eventObject.srcElement;
        }
        alert(eventObject.target);
        alert(test);
    };
    (function(myMessage) {
        alert(myMessage);
    })("Hello");
</script> 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-22T08:27:17.970

代表们：

```
function displayMessage(message, f)
{
    f(message); // execute function "f" with variable "message"
}

function alerter(message)
{
    alert(message);
}

function writer(message)
{
    document.write(message);
} 
```

运行 displayMessage 函数：

```
function runDelegate()
{
    displayMessage("Hello World!", alerter); // alert message

    displayMessage("Hello World!", writer); // write message to DOM
} 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-22T08:18:53.947

您所做的是创建了一个新的匿名函数，该函数接受一个参数，然后将其分配给函数内部的局部变量 myMessage。由于实际上没有传递任何参数，并且未传递值的参数变为 null，因此您的函数只会执行 alert(null)。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-10-22T08:18:56.863

如果你这样写

```
myButton.onclick = function() { alert(myMessage); }; 
```

它会起作用，但我不知道这是否能回答你的问题。

# asp.net-2.0 - 如何在生产环境中删除临时 ASP.net 文件？

> ID：224823
> 
> 赞同：13
> 
> 时间：2008-10-22T08:14:18.887
> 
> 标签：asp.net-2.0

我已经在生产服务器上部署了一个新版本，但我没有看到这个版本的变化。我发现这是由于临时 ASP.net 文件夹下的 DLL 文件的旧版本引起的

```
C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\Temporary ASP.NET Files 
```

在 DEV 环境中，我可以删除，但在 Prod 中。我限制了删除 ASP.net 临时文件夹中文件的访问权限。

谁能告诉我如何在部署新文件后立即重新创建新的 DLL 文件？

谢谢！

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-10-22T08:30:16.670

当您将新的 DLL 添加到 bin 文件夹时，它们应该立即覆盖 ASP.NET 临时文件夹中的文件。我自己注意到有时（我认为这是由于并发问题而发生的）dll 没有加载到内存中。

如果您有权访问 IIS 管理控制台，**则可以回收工作进程**。这应该确保加载新的临时程序集。

此外，如果您更改 aspx 或 ascx 文件，生成的程序集应自动替换到 temp 文件夹中。如果有同样的问题，我建议回收worker进程。也许您可以在部署过程中以某种自动化方式集成它。

# windows - 优化包含大量数据的 sqlite 数据库的提示？

> ID：224827
> 
> 赞同：11
> 
> 时间：2008-10-22T08:15:08.167
> 
> 标签：windows, linux, optimization, sqlite, configuration

我正在使用一个大于平均水平的 sqlite 数据库（用于 Windows 和 linux），并希望最大限度地提高我从中获得的性能。该数据库将与 sqlite gui 一起安装在商品硬件上。我交付给的用户精通 sql，但不太可能进行自己的优化（创建索引、设置 pragma 等），因此我渴望获得尽可能多的开箱即用性能（以确保最大限度地使用数据）。

一个问题 Windows 似乎比 Linux 更能限制查询的执行，另一个问题是我不太熟悉 sqlite 的索引方法（与 postgres 等其他数据库相比）。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-22T14:36:43.513

您是否阅读过[SQLite 优化常见问题解答](http://web.utk.edu/~jplyon/sqlite/SQLite_optimization_FAQ.html)（几年前，但似乎仍然有用）？

我不认为 1gb 特别大，即使对于 SQLite 也是如此。它当然可以稳定地处理更大的数据库。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-04T12:54:23.467

更新 - 我们在导入时对数据进行更智能的排序、积极的索引（在此过程中将 db 文件的大小增加一倍以上）、调整 Windows 中的设置以使 XP 的行为更像服务器，这方面取得了最大的成功而不是桌面，更改连接顺序（您不能仅仅依赖优化器）并通过创建性能测试套件（只是用于运行查询和进行测量的工具）来衡量您的进度。

体验很有趣，最终用户很高兴并且能够使用数据。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-23T00:31:13.517

如果您正在导入大量数据，我发现最有效的方法是

1.  最好按主索引顺序对插入的数据进行排序
2.  使用准备好的语句 (doh)
3.  删除任何索引
4.  批量插入包含事务的数据（例如一次命中 10,000 条记录）
5.  重新添加索引

另请记住，sqlite 尚不支持 where 子句中的 or 运算符。您可以通过将 where 子句贬低以使用 ands 来调整事情。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-22T15:55:01.497

您应该每天晚上查看“计划任务”和“优化表”的脚本，甚至可能重新创建索引。定期这样做可以为您节省大量时间和体力劳动。

# sql-server - 如何从脚本中设置 SQL Server 脚本的超时？

> ID：224830
> 
> 赞同：10
> 
> 时间：2008-10-22T08:15:41.487
> 
> 标签：sql-server, timeout, sql-scripts

我有一个正在尝试运行的大型脚本文件（近 300MB，未来可能会更大）。Gulzar 对我的[问题](https://stackoverflow.com/questions/222442/sql-server-running-large-script-files)的回答的评论中建议我应该将脚本超时更改为 0（无超时）。

从脚本中设置此超时的最佳方法是什么？目前，我将所有这些都放在脚本文件的顶部，希望其中一个能做一些事情：

```
sp_configure 'remote login timeout', 600
go
sp_configure 'remote query timeout', 0
go
sp_configure 'query wait', 0
go
reconfigure with override
go 
```

但是，我仍然得到相同的结果，我不知道我是否成功设置了超时，因为来自 sqlcmd.exe 的响应是世界上最没有帮助的错误消息：

> Sqlcmd：错误：脚本错误。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-20T16:16:21.783

您的解决方案 - 每 100 或 150 行添加 GO

[http://www.red-gate.com/MessageBoard/viewtopic.php?t=8109](http://www.red-gate.com/MessageBoard/viewtopic.php?t=8109)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-22T09:06:46.173

```
sqlcmd -t {n} 
```

其中 {n} 必须是 0 到 65535 之间的数字。

请注意，您的问题有点误导，因为[服务器没有超时的概念，](http://blogs.msdn.com/khen1234/archive/2005/10/20/483015.aspx)因此您无法在脚本中设置超时。

在您的上下文中，超时由**[sqlcmd强制执行](http://msdn.microsoft.com/en-us/library/ms170572.aspx)**

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-22T09:06:35.630

我认为SQL Server 上**的 SQL 脚本中没有超时的概念。**您必须在调用层/客户端中设置超时。

根据[这篇 MSDN 文章](http://support.microsoft.com/?scid=kb%3Ben-us%3B314530&x=14&y=12)，您可以尝试以这种方式增加超时：

```
exec sp_configure 'remote query timeout', 0 
go 
reconfigure with override 
go 
```

*“使用远程查询超时选项来指定远程操作在 Microsoft SQL Server 超时之前需要多长时间（以秒为单位）。默认值为 600，允许等待 10 分钟。此值适用于由数据库引擎作为远程查询。此值对数据库引擎接收的查询没有影响。"*

*PS：300 MB 你的意思是生成的文件是 300 MB？我不希望脚本文件本身是 300 MB。那将是一项世界纪录。;-)*

# ruby - Ruby 守护进程不会启动

> ID：224845
> 
> 赞同：3
> 
> 时间：2008-10-22T08:20:09.920
> 
> 标签：ruby, rubygems, daemon

我正在使用 ruby​​ daemons gem 为我的 rails 项目创建自定义守护程序。唯一的问题是，当我尝试启动守护进程时`ruby lib/daemons/test_ctl start`，它会失败并且不会启动。日志文件具有此输出。

```
# Logfile created on Wed Oct 22 16:14:23 +0000 2008 by /  
*** below you find the most recent exception thrown, this will be likely (but not certainly) the exception that made the application exit abnormally \*\*\*  
# MissingSourceFile: no such file to load -- utf8proc_native  
*** below you find all exception objects found in memory, some of them may have been thrown in your application, others may just be in memory because they are standard exceptions ***  
# NoMemoryError: failed to allocate memory>  
# SystemStackError: stack level too deep>  
# fatal: exception reentered>  
# LoadError: no such file to load -- daemons>  
# LoadError: no such file to load -- active_support>  
# MissingSourceFile: no such file to load -- lib/string>  
# MissingSourceFile: no such file to load -- utf8proc_native> 
```

当我生成一个守护进程（从 rails 插件）并尝试运行它时，它甚至会发生。有谁知道如何解决这个问题？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-22T09:17:17.730

好的，我实际上找到了这个问题的答案。我需要两个自定义文件`config/environment.rb`。我使用了相对路径名，因为守护进程是在 rails 主目录中执行的，所以找不到这两个文件。在使它们成为绝对路径后，它解决了问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-14T06:48:29.397

在尝试使守护程序插件正常工作时，我只花了 30 分钟尝试解决类似的错误：

```
LoadError: no such file to load -- active_support 
```

出于某种原因，它没有找到`active_support`lib，即使它已安装。（也许是因为我有冻结的铁轨）。
就我而言，解决方案是在我的
ctl 文件中使用 active_support 的绝对路径（例如`lib/daemons/mailer_ctl`）。

我需要将第 5 行从：

```
 require 'active_support' 
```

到

```
 require './vendor/rails/activesupport/lib/active_support.rb' 
```

# c# - 在 ASP.NET 页面中将项目从一个列表拖放到另一个列表？

> ID：224852
> 
> 赞同：4
> 
> 时间：2008-10-22T08:22:06.903
> 
> 标签：c#, .net, asp.net, javascript, ajax

我想在页面上将项目从一个列表移动到另一个列表，而且我对它的列表类型非常灵活。最好的方法是什么？ASP.NET Ajax？jQuery？还要别的吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-22T08:38:52.160

CodeProject 上有一个很好的教程，涵盖了使用 ASP.NET 和 jQuery 进行拖动：

[http://www.codeproject.com/KB/webforms/JQueryPersistantDragDrop.aspx](http://www.codeproject.com/KB/webforms/JQueryPersistantDragDrop.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-22T11:44:57.947

if you want to do this and PostBack instead of using AJAX to update your data based on from fields you'll need to get creative about what types of controls you use. Page validation will complain about ASP controls like dropdownlists, listboxes, etc. if they contain selected items that weren't in the list when it was rendered.

Better to use AJAX to send back your updates or use HTML controls like unordered lists or select added via javascript and stuff the selected data in another control that doesn't complain (hiddenfield) on PostBack. The alternative is turning off page validation and I don't think that's a good idea.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-01-19T15:18:17.897

你也可以看看 YUI 库，我会说它以一种非常简单和灵活的方式实现拖放：http: [//yuilibrary.com/yui/docs/dd/](http://yuilibrary.com/yui/docs/dd/)

有很多例子等等...

# c# - 如何获取所有已安装的固定宽度字体？

> ID：224865
> 
> 赞同：18
> 
> 时间：2008-10-22T08:26:22.510
> 
> 标签：c#, wpf, fonts, monospace

我想知道是否有任何简单的方法可以在 C# 中获取用户系统上安装的所有固定宽度（等宽）字体的列表？

我正在使用 .net 3.5，因此可以访问 WPF System.Windows.Media 命名空间和 LINQ 以获取字体信息，但我不确定我在寻找什么。

我希望能够提供过滤的等宽字体列表和/或从更大的字体列表中挑选等宽字体（如 VS 选项对话框中所示）。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-10-22T09:31:32.130

看一下：

[http://www.pinvoke.net/default.aspx/Structures/LOGFONT.html](http://www.pinvoke.net/default.aspx/Structures/LOGFONT.html)

使用其中的一种结构，然后遍历族，实例化字体，获取 LogFont 值并检查 lfPitchAndFamily。

以下代码是即时编写且未经测试的，但类似以下的代码应该可以工作：

```
foreach (FontFamily ff in System.Drawing.FontFamily.Families)
{
    if (ff.IsStyleAvailable(FontStyle.Regular))
    {
        Font font = new Font(ff, 10);
        LOGFONT lf = new LOGFONT();
        font.ToLogFont(lf);
        if (lf.lfPitchAndFamily ^ 1)
        {
            do stuff here......
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-22T08:44:32.273

AFAIK 你不能只使用 BCL 库来做到这一点。您必须使用 WinAPI 互操作。

您需要分析[LOGFONT](https://msdn.microsoft.com/en-us/library/dd145037(v=vs.85).aspx) .lfPitchAndFamily 成员的 2 个最低位。有一个常数 FIXED_PITCH（意味着字体是固定宽度的）可以用作 lfPitchAndFamily 的位掩码。

这是一篇有用的文章：

[枚举字体](http://www.catch22.net/tuts/fixed-width-font-enumeration)

> 枚举字体可能有点令人困惑，除非您想枚举系统上的所有字体，否则可能比 MSDN 建议的要困难一些。本文将准确解释您在系统上查找每种固定宽度字体所需的步骤，并列举每种字体的每种可能大小。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2011-12-17T13:18:58.327

不幸的是**，ToLogFont**函数不会填充**lfPitchAndFamily**字段以更正值。在我的情况下，它始终为 0。

检测哪些字体可能是固定的一种近似值如下

```
 foreach ( FontFamily ff in FontFamily.Families ) {
            if ( ff.IsStyleAvailable( FontStyle.Regular ) ) {
                float diff;
                using ( Font font = new Font( ff, 16 ) ) {
                    diff = TextRenderer.MeasureText( "WWW", font ).Width - TextRenderer.MeasureText( "...", font ).Width;
                }
                if ( Math.Abs( diff ) < float.Epsilon * 2 ) {
                    Debug.WriteLine( ff.ToString() );
                }
            }

        } 
```

请记住，它们是几个误报，例如 Wingdings

# java - 在java中简单易用的LRU缓存

> ID：224868
> 
> 赞同：74
> 
> 时间：2008-10-22T08:27:04.337
> 
> 标签：java, caching, lru

我知道实现起来很简单，但我想重用已经存在的东西。

我要解决的问题是我为不同的页面、角色加载配置（来自 XML，所以我想缓存它们）......所以输入的组合可以增长很多（但 99% 不会）。为了处理这 1%，我想在缓存中有一些最大数量的项目......

直到知道我在 apache commons 中找到了 org.apache.commons.collections.map.LRUMap ，它看起来不错，但还想检查其他内容。有什么建议吗？

* * *

## 回答 #1

> 赞同：119
> 
> 时间：2008-10-22T08:33:08.737

您可以使用[LinkedHashMap](http://docs.oracle.com/javase/6/docs/api/index.html?java/util/LinkedHashMap.html) (Java 1.4+)：

```
// Create cache
final int MAX_ENTRIES = 100;
Map cache = new LinkedHashMap(MAX_ENTRIES+1, .75F, true) {
    // This method is called just after a new entry has been added
    public boolean removeEldestEntry(Map.Entry eldest) {
        return size() > MAX_ENTRIES;
    }
};

// Add to cache
Object key = "key";
cache.put(key, object);

// Get object
Object o = cache.get(key);
if (o == null && !cache.containsKey(key)) {
    // Object not in cache. If null is not a possible value in the cache,
    // the call to cache.contains(key) is not needed
}

// If the cache is to be used by multiple threads,
// the cache must be wrapped with code to synchronize the methods
cache = (Map)Collections.synchronizedMap(cache); 
```

* * *

## 回答 #2

> 赞同：33
> 
> 时间：2011-09-28T13:41:04.600

这是一个老问题，但为了后代，我想列出[ConcurrentLinkedHashMap](https://github.com/ben-manes/concurrentlinkedhashmap)，它是线程安全的，不像[LRUMap](https://commons.apache.org/proper/commons-collections/apidocs/org/apache/commons/collections4/map/LRUMap.html)。用法很简单：

```
ConcurrentMap<K, V> cache = new ConcurrentLinkedHashMap.Builder<K, V>()
    .maximumWeightedCapacity(1000)
    .build(); 
```

并且文档有一些很好的[例子](https://github.com/ben-manes/concurrentlinkedhashmap/wiki/ExampleUsage)，比如如何使 LRU 缓存基于大小而不是基于项目数。

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2012-07-31T00:21:00.870

这是我的实现，它可以让我在内存中保留最佳数量的元素。

关键是我不需要跟踪当前正在使用哪些对象，因为我使用了 MRU 对象的 LinkedHashMap 和 LRU 对象的 WeakHashMap 的组合。所以缓存容量不小于 MRU 大小加上 GC 让我保留的任何内容。每当对象从 MRU 上掉下来时，只要 GC 有它们，它们就会进入 LRU。

```
public class Cache<K,V> {
final Map<K,V> MRUdata;
final Map<K,V> LRUdata;

public Cache(final int capacity)
{
    LRUdata = new WeakHashMap<K, V>();

    MRUdata = new LinkedHashMap<K, V>(capacity+1, 1.0f, true) {
        protected boolean removeEldestEntry(Map.Entry<K,V> entry)
        {
            if (this.size() > capacity) {
                LRUdata.put(entry.getKey(), entry.getValue());
                return true;
            }
            return false;
        };
    };
}

public synchronized V tryGet(K key)
{
    V value = MRUdata.get(key);
    if (value!=null)
        return value;
    value = LRUdata.get(key);
    if (value!=null) {
        LRUdata.remove(key);
        MRUdata.put(key, value);
    }
    return value;
}

public synchronized void set(K key, V value)
{
    LRUdata.remove(key);
    MRUdata.put(key, value);
}
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-12-21T12:09:35.633

我也有同样的问题，我还没有找到任何好的库......所以我创建了自己的库。

simplelrucache 提供线程安全、非常简单、非分布式 LRU 缓存，支持 TTL。它提供了两种实现

*   基于 ConcurrentLinkedHashMap 的并发
*   基于LinkedHashMap同步

你可以在[这里](http://code.google.com/p/simplelrucache/)找到它。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-02-19T09:40:42.003

[这](https://github.com/barakb/Cache)是一个非常简单易用的 Java 中的 LRU 缓存。尽管它简短而简单，但它是生产质量。对代码进行了解释（查看 README.md）并进行了一些单元测试。

# xml - xslt 中的嵌套谓词

> ID：224875
> 
> 赞同：1
> 
> 时间：2008-10-22T08:29:46.873
> 
> 标签：xml, xslt, msxml

是否可以在 xslt 中执行以下等效操作：

```
.//TagA[./TagB/[@AttrA='AttrAValue'] = 'TagBValue'] 
```

这在 Visual Studio 2008 中失败，并出现以下错误：

```
error: Unexpected token '[' in the expression.
.//TagA[./TagB/ -->[<-- @AttrA='AttrAValue'] = 'TagBValue'] 
```

这应该工作吗？这是 XSLT 的 MS 实现中的一个问题，还是有一种方法可以让所有 TagA 节点具有一个 TagB 节点，其 AttrA 等于 AttrAValue 并且其 TagB innerText 等于 TagBValue。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-10-22T08:33:07.707

我认为你需要在有问题的 [ 之前选择一个节点集，然后应用属性过滤器。

再三考虑，你甚至需要在冒犯 [?

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-22T08:35:44.317

谢谢Si，你是对的。以下工作：

```
.//TagA[./TagB[@AttrA='AttrAValue'] = 'TagBValue'] 
```

我会责怪它在清晨！

# math - 查找数字范围交点

> ID：224878
> 
> 赞同：9
> 
> 时间：2008-10-22T08:30:37.837
> 
> 标签：math

找出两个数字范围是否相交的最佳方法是什么？

我的号码范围是**3023-7430**，现在我想测试以下哪个号码范围与它相交：<3000、3000-6000、6000-8000、8000-10000、>10000。答案应该是**3000-6000**和**6000-8000**。

在任何编程语言中，有什么好的、高效的数学方法来做到这一点？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-10-22T08:37:21.523

只是一个伪代码猜测：

```
Set<Range> determineIntersectedRanges(Range range, Set<Range> setofRangesToTest)
{
  Set<Range> results;
  foreach (rangeToTest in setofRangesToTest)
  do
    if (rangeToTest.end <range.start) continue; // skip this one, its below our range
    if (rangeToTest.start >range.end) continue; // skip this one, its above our range
    results.add(rangeToTest);
  done
  return results;
} 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-22T08:42:05.693

我会创建一个 Range 类并给它一个方法 boolean intersects(Range) 。然后你可以做一个

```
foreach(Range r : rangeset) { if (range.intersects(r)) res.add(r) } 
```

或者，如果您为了清楚起见使用了一些 Java 8 风格的函数式编程：

```
rangeset.stream().filter(range::intersects).collect(Collectors.toSet()) 
```

十字路口本身就像

```
this.start <= other.end && this.end >= other.start 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-22T09:49:53.730

这在很大程度上取决于您的范围。范围可以大也可以小，可以聚集也可以不聚集。如果您有较大的集群范围（想想“所有可以被 2 整除的 32 位正整数），那么使用 Range(lower, upper) 的简单方法将不会成功。

我想我可以说以下内容：如果您的范围很小（聚类或不聚类在这里无关紧要），请考虑位向量。这些小动物在联合、交集和成员测试方面的速度非常快，尽管所有元素的迭代可能需要一段时间，具体取决于大小。此外，因为它们只为每个元素使用一个位，所以它们非常小，除非你对它们投入很大的范围。

如果您的范围更少，范围更大，那么其他人描述的 Range 类就足够了。这个类有属性lower和upper，intersection(a,b)基本上是b.upper < a.lower or a.upper > b.lower。联合和交集可以在单个范围和组合范围内以恒定时间实现，时间随着子范围的数量而增长（因此您不希望没有太多的小范围）

如果你有一个很大的空间可以存放你的数字，并且范围分布在一个令人讨厌的方式中，你应该看看二元决策图 (BDD)。这些漂亮的图有两个终端节点，True 和 False，以及输入的每*一位*的决策节点。一个决策节点有一个它查看的位和两个后续的图形节点——一个用于“位为一”，一个用于“位为零”。鉴于这些条件，您可以在狭小的空间中对大范围进行编码。任意大数的所有正整数都可以在图中的 3 个节点中编码 - 基本上是最低有效位的单个决策节点，在 1 上为假，在 0 上为真。

Intersection 和 Union 是非常优雅的递归算法，例如，intersection 基本上在每个 BDD 中取两个对应的节点，遍历 1-edge 直到弹出一些结果并检查：如果其中一个结果是 False-Terminal，则创建一个 1 - 分支到结果 BDD 中的 False 终端。如果两者都是真终端，则在结果 BDD 中为真终端创建一个 1 分支。如果它是其他东西，请在结果 BDD 中为这个东西创建一个 1 分支。之后，开始进行一些最小化（如果节点的 0 和 1 分支转到相同的以下 BDD / 终端，则将其删除并将传入的转换拉到目标），你就很成功了。我们甚至更进一步，我们致力于在 BDD 上模拟整数集的加法，以增强价值预测以优化条件。

这些考虑意味着您的操作受限于您的数字范围内的位数，即 log_2(MAX_NUMBER)。想想看，您可以在几乎恒定的时间内与任意 64 位整数集相交。

更多信息可以在例如[维基百科](http://en.wikipedia.org/wiki/Binary_decision_diagram) 和参考论文中。

此外，如果误报是可以忍受的并且您只需要进行存在性检查，则可以查看 Bloom 过滤器。布隆过滤器使用哈希向量来检查元素是否包含在表示的集合中。Intersection and Union 是常数时间。这里的主要问题是，如果布隆过滤器填得太多，误报率就会增加。再次，例如，在[Wikipedia中的信息。](http://en.wikipedia.org/wiki/Bloom_filter)

哈希，集合表示是一个有趣的领域。:)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-22T09:55:27.823

在蟒蛇

```
class nrange(object):
    def __init__(self, lower = None, upper = None):
        self.lower = lower
        self.upper = upper
    def intersection(self, aRange):
        if self.upper < aRange.lower or aRange.upper < self.lower:
            return None
        else:
            return nrange(max(self.lower,aRange.lower), \
                          min(self.upper,aRange.upper)) 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-11-16T22:43:05.897

如果你使用 Java [Commons Lang Range](http://commons.apache.org/lang/api-2.4/org/apache/commons/lang/math/Range.html#overlapsRange%28org.apache.commons.lang.math.Range%29) 有一个 overlaysRange(Range range) 方法。

# xml - 如何使用 Groovy 在 xml 中插入/移动/删除节点？

> ID：224926
> 
> 赞同：13
> 
> 时间：2008-10-22T08:50:00.747
> 
> 标签：xml, groovy

例如，我有以下 xml 文档：

```
def CAR_RECORDS = '''
    <records>
      <car name='HSV Maloo' make='Holden' year='2006'/>
      <car name='P50' make='Peel' year='1962'/>
      <car name='Royale' make='Bugatti' year='1931'/>
    </records>
''' 
```

我想将汽车“Royale”移动到第一个，并在汽车“HSV Maloo”之后插入一辆新车，结果将是：

```
'''
    <records>
      <car name='Royale' make='Bugatti' year='1931'/>
      <car name='HSV Maloo' make='Holden' year='2006'/>
      <car name='My New Car' make='Peel' year='1962'/>
      <car name='P50' make='Peel' year='1962'/>
    </records>
''' 
```

如何用 Groovy 做到这一点？欢迎评论。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-10-23T04:08:16.697

我走了一条类似的路线到 danb，但在实际打印出生成的 XML 时遇到了问题。然后我意识到，通过向根询问它的所有“汽车”孩子返回的 NodeList 与通过询问根的孩子得到的列表不同。即使在这种情况下它们碰巧是相同的列表，但如果根目录下有非“汽车”子级，它们也不会总是如此。因此，重新排列从查询返回的汽车列表不会影响初始列表。

这是一个附加和重新排序的解决方案：

```
def CAR_RECORDS = '''
   <records>
     <car name='HSV Maloo' make='Holden' year='2006'/>
     <car name='P50' make='Peel' year='1962'/>
     <car name='Royale' make='Bugatti' year='1931'/>
   </records>
 '''

def carRecords = new XmlParser().parseText(CAR_RECORDS)

def cars = carRecords.children()
def royale = cars.find { it.@name == 'Royale' } 
cars.remove(royale)
cars.add(0, royale)
def newCar = new Node(carRecords, 'car', [name:'My New Car', make:'Peel', year:'1962'])

assert ["Royale", "HSV Maloo", "P50", "My New Car"] == carRecords.car*.@name

new XmlNodePrinter().print(carRecords) 
```

正确排序的汽车的断言通过，XmlNodePrinter 输出：

```
<records>
  <car year="1931" make="Bugatti" name="Royale"/>
  <car year="2006" make="Holden" name="HSV Maloo"/>
  <car year="1962" make="Peel" name="P50"/>
  <car name="My New Car" make="Peel" year="1962"/>
</records> 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-23T08:06:52.970

特德，也许你没有注意到我想'''在汽车“HSV Maloo”'''之后插入一辆新车，所以我将你的代码修改为：

```
def newCar = new Node(null, 'car', [name:'My New Car', make:'Peel', year:'1962'])
cars.add(2, newCar)

new XmlNodePrinter().print(carRecords) 
```

现在，它以正确的顺序工作！感谢丹布和泰德。

```
<records>
  <car year="1931" make="Bugatti" name="Royale"/>
  <car year="2006" make="Holden" name="HSV Maloo"/>
  <car name="My New Car" make="Peel" year="1962"/>
  <car year="1962" make="Peel" name="P50"/>
</records> 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-22T20:42:25.177

<hand-wave> *这些不是你想要的* </hand-wave>

```
Node root = new XmlParser().parseText(CAR_RECORDS)
NodeList carNodes = root.car
Node royale = carNodes[2]
carNodes.remove(royale)
carNodes.add(0, royale)
carNodes.add(2, new Node(root, 'car', [name:'My New Card', make:'Peel', year:'1962'])) 
```

我不知道是否有更聪明的方法来创建新节点......但这对我有用。

编辑：呃...谢谢大家...当我测试这个而不是根目录时，我变得懒惰并且正在打印carNodes...哎呀。

# flash - Flash/AS3 中的运行时字体加载

> ID：224933
> 
> 赞同：2
> 
> 时间：2008-10-22T08:54:44.390
> 
> 标签：flash, actionscript-3, fonts, external

想象一下，您正在创建一个演示文稿，该演示文稿将被翻译成十几种不同的语言，包括带有非拉丁字符的语言（例如中文）。客户的品牌风格指南规定某些字体对于某些语言是可接受的。内容本身需要外部化，以便无需打开 .fla 或重新保存图形即可替换文本。

所以我们说的是动态 TextField ，从 XML 填充，字体被换出以适应查看者的语言环境 - 动态加载所需字体（不管文件大小）并在必要时应用它们的最简单方法是什么？我正在寻找**仅使用 Flash 而不是 Flex**的解决方案。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-23T07:48:21.713

这在 Flash 中有点麻烦，但完全有可能。您需要做的是将字体“嵌入”到单独的 swf 中，从主应用程序加载此 swf，然后将该字体也注册到该 swf 中。这将允许您执行字体的运行时加载。这将要求您在应用程序中或在存储翻译的任何文件中指定每种语言的字体，这可能并不完美，但也不是在主应用程序中嵌入所有字体。这可能会无缘无故地加载数百 kb 的字体。

[这篇博客文章](http://www.betriebsraum.de/blog/2007/06/22/runtime-font-loading-with-as3-flash-cs3-not-flex/)很好地概述了您需要做什么才能使其正常工作。我自己也做过这个，所以如果你有兴趣，我可以稍后用一些例子来扩展这篇文章。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-29T00:40:21.023

我对没有人知道这件事感到非常失望——哦，好吧。我终于找到了一个编写了一个小类来处理字体加载过程的人，并就如何创建 .swfs 以使其加载提供了指导：

[Flash AS3 加载字体](http://www.mokisystems.com/blog/flash-as3-loading-fonts/)

希望其他人会发现这很有帮助 - 它原来是解决我的问题的灵丹妙药。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-22T09:13:51.573

好吧，您将不得不知道您正在加载什么语言。自动检测可能非常困难。

假设您知道内容是什么语言，您可以使用[Font.registerFont()](http://livedocs.adobe.com/flex/3/langref/flash/text/Font.html#registerFont())注册要在运行时使用的字体；有了这个，您可以加载一个包含字体的 swf，注册它，它可以供将来在所有文本字段中使用。print("代码示例");

```
[Embed(src="someFont.ttf", fontFamily="myFont", mimeType="application/x-font")]
private var fontClass:Class;

...

Font.registerFont(fontClass); 
```

请注意，您必须使用 flex 编译器进行编译以支持 Embed 标签。

另外一个很好的实用程序是[Font.hasGlyphs()](http://livedocs.adobe.com/flex/3/langref/flash/text/Font.html#hasGlyphs())，您可以使用它来检查您正在使用的字符是否在嵌入字体中可用。这可用于跳回系统字体或向开发人员显示警告（如果您忘记了某些字符或其他）。将 TextField 子类化以自动执行此检查可能是一个好主意。

如果这要上线，一般来说嵌入中文是你应该三思而后行的事情。嵌入所有字符会大大增加文件大小，而且无论如何都没有那么多完整的中文字体可用**。**当然，上述技术对于许多其他语言仍然有用。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-22T09:31:14.317

首先，确保你设定了期望，这样没人会认为你会在中文和日文等亚洲语言中使用嵌入式字体。除非您打算加载几兆字节的字形，否则您将使用设备字体，句号。因此，有关于使用哪类字体的指南是合理的*-*，`_sans`，`_serif`或其`_typewriter`本地化的等价物 - 但没有关于字体本身的指南。

其次，在过去，我的方法一直是让人们相信，在大多数情况下，无论如何他们可能会更好地使用设备字体。使用设备字体将缩短您的开发时间并避免错误。它将使您的内容加载速度更快（如果通过网络），并且几乎在所有情况下都会更快地呈现。通常，它也会更清晰易读。

客户喜欢要求他们所有的正文都使用 Garamond-Extra-British 或其他格式，但要确保他们知道所涉及的成本。如果他们看到了光明，你就可以省去很大的痛苦。

# perl - 时区应该是常量还是变量？

> ID：224940
> 
> 赞同：2
> 
> 时间：2008-10-22T08:58:05.020
> 
> 标签：perl, datetime, timezone

我在代码中有几个地方需要使用 TimeZone。我可以使用[DateTime::TimeZone](http://search.cpan.org/dist/DateTime)获取时区名称。将时区名称放在常量中是否合理？还是应该在变量中？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-22T09:01:51.003

如果值可以改变，使用一个变量，它保证保持不变，使用一个常量。

对于一个时区，它改变的机会不大，但也不是0。用户可以改变时区，如果程序相应地表现就好了。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-22T09:11:47.380

我投票支持变量。您最终可能会在不同时区使用不同的用户来使用您的应用程序，即使您怀疑这种情况是否会发生。几年前发生在我身上。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-22T09:16:10.587

看看时区是从哪里来的。是一个城市的时区吗？让它保持不变。是用户的时区吗？使其可变 - 我们用户一直在旅行，我们在笔记本电脑上重置时区，以便 Outlook 计划在新位置正常工作。

# windows-vista - Windows Vista 中的原始分区访问

> ID：224942
> 
> 赞同：2
> 
> 时间：2008-10-22T09:00:05.063
> 
> 标签：windows-vista, disk-partitioning

在 Windows Vista 中访问原始磁盘分区需要内核模式控制，而在 WinXP 中您可以从用户模式访问它。

但是，我听说对于 USB 闪存，即使在 Windows Vista 上，仍然可以从用户模式访问分区。

这是真的？

问候

/罗伯特

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2010-03-02T21:26:55.270

您可以在 Vista 上执行此操作，您可能需要管理员权限，但不需要特殊的内核模式驱动程序。

这个问题显示了如何做[如何使用.Net 直接读取磁盘？](https://stackoverflow.com/questions/38190/how-do-i-read-a-disk-directly-with-net) 由于 U 盘上的文件系统已损坏，我直接从 U 盘上读取数据。

# eclipse - 为 Eclipse 中的接口实现添加缺少 @Override 注释的警告

> ID：224945
> 
> 赞同：11
> 
> 时间：2008-10-22T09:01:31.957
> 
> 标签：eclipse, eclipse-3.4, jdk1.6

在使用 JDK1.6.0_10 的 Eclipse 3.4.1 中，如何在`@Override`实现接口方法的方法上激活缺少注释的警告？

在“首选项”窗口中，此选项：

> Java > 编译器 > 错误/警告 > 注释 > 缺少“@Override”注释

对于覆盖超类方法的方法上缺少注释可以正常工作，但对于接口方法没有任何作用。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-22T15:33:18.640

这在 Eclipse 3.4.1 中是不可能的。这是一个[已知问题](https://bugs.eclipse.org/bugs/show_bug.cgi?id=163194)。有关更多信息，请参阅此错误报告页面。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-22T09:34:36.507

保护我在另一个线程中所说的话。显然这不是编译器选项，而是 Java 兼容性版本问题：如果您的兼容性版本是 5，您将无法注释接口实现方法。如果您的兼容版本是 6，那么您将能够。

但是，如果您不注释每个已实现的方法，我认为实际上没有办法强制 Eclipse 生成错误。从[这个页面](http://help.eclipse.org/ganymede/index.jsp?topic=/org.eclipse.jdt.doc.user/reference/preferences/java/compiler/ref-preferences-errors-warnings.htm)：

> 缺少“@Override”注解：启用后，当编译器遇到覆盖另一个已实现方法的方法时，编译器将发出错误或警告，并且“@Override”注解丢失。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-10-22T19:15:45.497

兼容性设置为 1.6 而不是 1.5 对我有用：Eclipse Java EE IDE for Web Developers。

版本号：20100218-1602

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-22T09:11:59.080

也许我遗漏了一些东西，但是接口方法已经需要由实现类来实现。

如果接口没有完全实现，编译器会产生错误。

# sql-server - 是否可以限制 SQL Server 2000 中查询的最长持续时间？

> ID：224949
> 
> 赞同：0
> 
> 时间：2008-10-22T09:04:10.953
> 
> 标签：sql-server

具体来说，我想检测查询何时执行超过 5 分钟，然后使其回滚，毫无疑问，我可以在应用程序级别执行此操作，但我正在调查 SQL Server 是否有任何内置机制可以为我执行此操作.

请注意，为澄清起见，遗憾的是，我仍在运行 SQL Server 2000。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-22T09:07:13.333

在 SQL Server Management Studio 中，转到工具 > 选项 > 查询执行。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-22T09:26:25.447

在这个问题的讨论中，[如何从脚本中设置 SQL Server 脚本的超时？](https://stackoverflow.com/questions/224830/how-do-i-set-a-sql-server-scripts-timeout-from-within-the-script)我找到了对[There's no such things as a query timeout...](http://blogs.msdn.com/khen1234/archive/2005/10/20/483015.aspx)文章的参考，其中说“查询超时只是客户端概念”。

你可以考虑使用

```
SET QUERY_GOVERNOR_COST_LIMIT value 
```

命令，但不幸的是，它并不是你要找的。

正如[文档](http://msdn.microsoft.com/en-us/library/ms176100.aspx)所述，它不允许执行任何具有**估计**经过时间（以秒为单位）的查询，这些查询需要在特定硬件配置上完成查询。

# java - 在 Java 中读取文件/输入流内容的最简洁方法？

> ID：224952
> 
> 赞同：4
> 
> 时间：2008-10-22T09:05:28.640
> 
> 标签：java

在 Java 中读取文件或输入流内容的最简洁的方法是什么？我是否总是必须创建一个缓冲区，（最多）逐行读取等等，还是有更简洁的方法？我希望我能做到

```
String content = new File("test.txt").readFully(); 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-23T11:37:39.917

使用[Apache Commons IOUtils](http://commons.apache.org/io/description.html)包。特别是`IOUtils`该类提供了一组方法来从流、读取器等中读取并处理所有异常等。

例如

```
InputStream is = ...
String contents = IOUtils.toString(is);
// or
List lines = IOUtils.readLines(is) 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-23T03:58:38.553

我认为就 Java 板载工具的简洁性而言，使用 Scanner 是相当不错的：

```
Scanner s = new Scanner(new File("file"));
StringBuilder builder = new StringBuilder();
while(s.hasNextLine()) builder.append(s.nextLine()); 
```

此外，它也非常灵活（例如，正则表达式支持、数字解析）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-22T09:30:31.663

辅助函数。我基本上用了几个，视情况而定

*   将 InputStream 传递到 OutputStream 的 cat 方法
*   将 cat 调用到 ByteArrayOutputStream 并提取字节数组的方法，从而可以将整个文件快速读取到字节数组
*   使用 Reader 构造的 Iterator<String> 的实现；它将它包装在一个 BufferedReader 和 readLine 的 next()
*   ...

要么自己动手，要么使用 commons-io 或你喜欢的实用程序库中的一些东西。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-22T09:12:28.143

```
String content = (new RandomAccessFile(new File("test.txt"))).readUTF(); 
```

不幸的是，Java 对源文件是否为有效的 UTF8 非常挑剔，否则您将收到 EOFException 或 UTFDataFormatException。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-22T11:07:07.430

举一个这样的辅助函数的例子：

```
String[] lines = NioUtils.readInFile(componentxml); 
```

关键是即使抛出 IOException 也要尝试关闭 BufferedReader。

```
/**
 * Read lines in a file. <br />
 * File must exist
 * @param f file to be read
 * @return array of lines, empty if file empty
 * @throws IOException if prb during access or closing of the file
 */
public static String[] readInFile(final File f) throws IOException
{
    final ArrayList lines = new ArrayList();
    IOException anioe = null;
    BufferedReader br = null; 
    try 
    {
        br = new BufferedReader(new FileReader(f));
        String line;
        line = br.readLine();
        while(line != null)
        {
            lines.add(line);
            line = br.readLine();
        }
        br.close();
        br = null;
    } 
    catch (final IOException e) 
    {
        anioe = e;
    }
    finally
    {
        if(br != null)
        {
            try {
                br.close();
            } catch (final IOException e) {
                anioe = e;
            }
        }
        if(anioe != null)
        {
            throw anioe;
        }
    }
    final String[] myStrings = new String[lines.size()];
    //myStrings = lines.toArray(myStrings);
    System.arraycopy(lines.toArray(), 0, myStrings, 0, lines.size());
    return myStrings;
} 
```

（如果您只想要一个字符串，请更改函数以将每一行附加到 StringBuffer（或 java5 或 6 中的 StringBuilder）

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-22T09:25:55.167

我想你必须创建自己的函数。问题是 Java 的读取例程（至少我知道的）通常采用给定长度的缓冲区参数。

我看到的一个解决方案是获取文件的大小，创建这个大小的缓冲区并立即读取文件。希望该文件不是千兆字节日志或 XML 文件...

通常的方法是使用固定大小的缓冲区或使用 readLine 并将结果连接到 StringBuffer/StringBuilder 中。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-23T03:47:12.357

我不认为使用 BufferedReader 阅读是一个好主意，因为 BufferedReader 将只返回不带分隔符的行的内容。当该行只包含换行符时，BR 将返回 null，尽管它仍然没有到达流的末尾。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-23T03:55:33.023

字符串 org.apache.commons.io.FileUtils.readFileToString（文件文件）

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-23T04:02:44.847

从这里选一个。

[如何从文件内容创建 Java 字符串？](https://stackoverflow.com/questions/326390/how-to-create-a-java-string-from-the-contents-of-a-file)

最喜欢的是：

```
private static String readFile(String path) throws IOException {
  FileInputStream stream = new FileInputStream(new File(path));
  try {
    FileChannel fc = stream.getChannel();
    MappedByteBuffer bb = fc.map(FileChannel.MapMode.READ_ONLY, 0, fc.size());
    /* Instead of using default, pass in a decoder. */
    return CharSet.defaultCharset().decode(bb).toString();
  }
  finally {
    stream.close();
  }
} 
```

[埃里克森](https://stackoverflow.com/users/3474/erickson)发表

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2017-01-11T12:34:11.027

或 Java 8 方式：

```
try {
    String str = new String(Files.readAllBytes(Paths.get("myfile.txt")));
    ...
} catch (IOException ex) {
    Logger.getLogger(getClass().getName()).log(Level.SEVERE, null, ex);
} 
```

可以将适当的 Charset 传递给 String 构造函数。

# c++ - C++ 类的私有成员和受保护成员有什么区别？

> ID：224966
> 
> 赞同：324
> 
> 时间：2008-10-22T09:11:21.937
> 
> 标签：c++, class, oop, private, protected

C ++类中的成员`private`和成员有什么区别？`protected`

我从最佳实践约定中了解到，应该创建不在类外调用的变量和函数`private`——但是看看我的 MFC 项目，MFC 似乎更喜欢`protected`.

有什么区别，我应该使用哪个？

* * *

## 回答 #1

> 赞同：423
> 
> 时间：2008-10-22T09:14:25.520

私有成员只能在定义它们的类中访问。

受保护的成员可以在定义它们的类和从该类继承的类中访问。

编辑：它们的类的朋友也可以访问两者，如果是受保护的成员，它们的派生类的朋友也可以访问它们。

编辑 2：在您的问题的上下文中使用任何有意义的东西。您应该尽可能将成员设为私有，以减少耦合并保护基类的实现，但如果这不可能，则使用受保护的成员。检查[C++ FAQ](https://isocpp.org/wiki/faq/basics-of-inheritance)以更好地理解该问题。[这个关于受保护变量的问题](https://stackoverflow.com/questions/37011/protected-member-variables)也可能有所帮助。

* * *

## 回答 #2

> 赞同：148
> 
> 时间：2008-10-22T09:22:10.120

**A 类的公共**成员可供所有人访问。

**类 A 的受保护**成员不能在 A 的代码之外访问，但可以从从 A 派生的任何类的代码中访问。

**类 A 的私有**成员不能在 A 的代码之外或从 A 派生的任何类的代码中访问。

所以，最终，在受保护或私有之间进行选择是在回答以下问题：**您愿意对派生类的程序员给予多少信任？**

**默认情况下**，假设派生类不可信，**并使您的成员成为私有的**。如果您有充分的理由让母类内部对其派生类的自由访问，那么您可以使它们受到保护。

* * *

## 回答 #3

> 赞同：76
> 
> 时间：2008-10-22T09:18:56.150

可以从派生类访问受保护的成员。私人的不行。

```
class Base {

private: 
  int MyPrivateInt;
protected: 
  int MyProtectedInt;
public:
  int MyPublicInt;
};

class Derived : Base
{
public:
  int foo1()  { return MyPrivateInt;} // Won't compile!
  int foo2()  { return MyProtectedInt;} // OK  
  int foo3()  { return MyPublicInt;} // OK
};‌‌

class Unrelated 
{
private:
  Base B;
public:
  int foo1()  { return B.MyPrivateInt;} // Won't compile!
  int foo2()  { return B.MyProtectedInt;} // Won't compile
  int foo3()  { return B.MyPublicInt;} // OK
}; 
```

就“最佳实践”而言，这取决于。如果甚至有微弱的可能性，有人可能想从您现有的类派生一个新类并需要访问内部成员，请将它们设为受保护的，而不是私有的。如果它们是私有的，您的类可能会变得难以轻松继承。

* * *

## 回答 #4

> 赞同：24
> 
> 时间：2008-10-22T09:19:01.297

MFC之所以偏爱protected，是因为它是一个框架。您可能希望对 MFC 类进行子类化，在这种情况下，需要一个受保护的接口来访问对该类的一般使用不可见的方法。

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2008-10-22T09:26:52.373

这完全取决于您想要做什么，以及您希望派生类能够看到什么。

```
class A
{
private:
    int _privInt = 0;
    int privFunc(){return 0;}
    virtual int privVirtFunc(){return 0;}
protected:
    int _protInt = 0;
    int protFunc(){return 0;}
public:
    int _publInt = 0;
    int publFunc()
    {
         return privVirtFunc();
    }
};

class B : public A
{
private:
    virtual int privVirtFunc(){return 1;}
public:
    void func()
    {
        _privInt = 1; // wont work
        _protInt = 1; // will work
        _publInt = 1; // will work
        privFunc(); // wont work
        privVirtFunc(); // will work, simply calls the derived version.
        protFunc(); // will work
        publFunc(); // will return 1 since it's overridden in this class
    }
} 
```

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2008-10-22T09:14:53.647

标记为`protected`的属性和方法——与私有的不同——在子类中仍然可见。

除非您不想在可能的子类中使用或提供覆盖该方法的可能性，否则我会将它们设为`private`.

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2008-10-22T09:48:07.650

当然看看[受保护的成员变量](https://stackoverflow.com/questions/37011/protected-member-variables)问题。建议使用 private 作为默认值（就像 C++ `class`ses 一样）以减少耦合。受保护的成员变量总是一个坏主意，受保护的成员函数可用于例如模板方法模式。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2008-10-22T09:15:35.767

受保护的成员只能由类的后代以及同一模块中的代码访问。私有成员只能被声明它们的类和同一模块中的代码访问。

当然，朋友功能会把它扔出窗外，但是哦，好吧。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2008-10-22T09:16:57.090

私有成员只能从类内部访问，受保护成员可以在类和派生类中访问。这是 OO 语言中的继承特性。

您可以在 C++ 中拥有私有、受保护和公共继承，这将决定继承层次结构中可以访问哪些派生类。例如，C# 只有公共继承。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2017-04-01T16:02:20.743

**private** = 只能由母舰（基类）访问（即只有我的父母可以进入我父母的卧室）

**protected** = 母舰（基类）和她的女儿可以访问（即只有我的父母可以进入我父母的卧室，但允许儿子/女儿走进父母的卧室）

**公共**= 母舰（基层）、女儿和其他所有人都可以访问（即只有我的父母可以进入我父母的卧室，但这是一个家庭聚会 - mi casa su casa）

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2013-02-22T07:40:28.413

由于不需要公共成员函数来获取和更新派生类中的受保护成员，这提高了代码的效率并减少了我们需要编写的代码量。然而，派生类的程序员应该知道他在做什么。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2018-06-15T06:12:53.283

`private`会员数据首选。`private`默认情况下，C++ 类中的成员。

`public`是成员函数的首选，尽管这是一个见仁见智的问题。至少某些方法必须是可访问的。`public`所有人都可以访问。这是最灵活的选择，也是最不安全的。任何人都可以使用它们，任何人都可以滥用它们。

`private`根本无法访问。没有人可以在课堂外使用它们，也没有人可以滥用它们。甚至在派生类中也没有。

`protected`是一种折衷方案，因为它可以在派生类中使用。当您从一个类派生时，您对基类有很好的理解，并且小心不要误用这些成员。

MFC 是 Windows API 的 C++ 包装器，它更喜欢`public`和`protected`. Visual Studio 向导生成的类具有丑陋的`protected`、`public`和`private`成员组合。但是 MFC 类本身有一些逻辑。

诸如此类的成员`SetWindowText`是`public`因为您经常需要访问这些成员。

等成员`OnLButtonDown`处理窗口收到的通知。它们不应该被访问，因此它们是`protected`. 您仍然可以在派生类中访问它们以覆盖这些函数。

有些成员必须做线程和消息循环，它们不应该被访问或覆盖，所以它们被声明为`private`

在 C++ 结构中，成员是`public`默认的。结构通常只用于数据，而不是方法，因此`public`声明被认为是安全的。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2019-02-25T11:45:56.467

**Private ：**可由类成员函数和朋友函数或朋友类访问。对于 C++ 类，这是默认访问说明符。

**受保护：**可由类成员函数、友元函数或友元类和派生类访问。

*   您可以根据您的要求将类成员变量或函数（甚至 typedef 或内部类）保持为私有或受保护。
*   大多数时候，您将类成员保持为私有并添加 get/set 函数进行封装。这有助于维护代码。
*   通常，当您希望保持公共函数模块化或消除重复代码而不是将整个代码写入单个函数时，通常会使用私有函数。这有助于维护代码。

[有关更多详细信息，请参阅此链接](https://en.cppreference.com/w/cpp/language/access)。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2016-09-10T16:36:02.620

*   **Private**：它是一个访问说明符。默认情况下，实例（成员）变量或 c++/java 中类的方法是私有的。在继承期间，代码和数据总是被继承，但在类外是不可访问的。我们可以将我们的数据成员声明为私有的，这样任何人都无法直接更改我们的成员变量，并且我们可以提供公共的 getter 和 setter 来更改我们的私有成员。而这个概念总是应用在业务规则中。

*   **Protected**：它也是一个访问说明符。在 C++ 中，受保护的成员可以在类内部和继承的类中访问，但不能在类外部访问。在 Java 中，受保护的成员可以在类中访问，对继承的类以及同一包中的所有类都是可访问的。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2014-07-14T14:38:29.957

私有成员只能在它声明为受保护成员的同一类中访问，可以在声明它的类中访问它以及由它继承的类。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2016-06-18T05:42:52.883

受保护的非静态基类成员可以由从该基类派生的任何类的成员和朋友使用以下方法之一访问：

*   指向直接或间接派生类的指针
*   对直接或间接派生类的引用
*   直接或间接派生类的对象

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2022-02-07T19:18:30.353

> 关键字指定对成员列表中的类成员的`protected`访问，直到下一个访问说明符（`public`或`private`）或类定义的结尾。`Class members`声明为`protected`只能由以下人员使用：
> 
> *   最初声明这些成员的类的成员函数。
> *   最初声明这些成员的类的朋友。
> *   从最初声明这些成员的类派生的具有公共或受保护访问权限的类。
> *   直接私有派生类，它们也对受保护成员具有私有访问权限。
> 
> 在基类名称之前，`protected`关键字指定基类的公共成员和受保护成员是其派生类的受保护成员。
> 
> 受保护的成员不像`private`成员那样私有，成员只能被声明它们的类的成员访问，但它们不像公共成员那样公开，公共成员可以在任何函数中访问。
> 
> 也被声明为可被派生类的`static`任何成员函数访问的受保护成员。`friend`未声明为静态的受保护成员只能通过派生类的指针、引用或对象访问派生类中的朋友和成员函数。

[受保护的 (C++)](https://docs.microsoft.com/en-us/cpp/cpp/protected-cpp?view=msvc-170)

* * *

## 回答 #18

> 赞同：-3
> 
> 时间：2016-12-05T08:45:46.230

private 和 protected 访问修饰符是相同的，只是基类的受保护成员可以在子（派生）类的基类范围之外访问。它也同样适用于继承。但是使用 private 修饰符，基类的成员只能在基类的范围或代码及其友元函数中访问''''

# c - 将一串数字转换为整数

> ID：224969
> 
> 赞同：3
> 
> 时间：2008-10-22T09:12:20.890
> 
> 标签：c, string

我有一个字符串（char），我想从中提取数字。

所以我有字符串：`1 2 3 4 /0`
现在我想要一些变量，所以我可以将它们用作整数：`a=1, a=2, a=3, a=4`

我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-22T09:26:12.967

到目前为止给出的答案是正确的，只要您的字符串按照您期望的方式格式化。您应该始终检查 sscanf 的返回值，以确保一切正常。sscanf 返回成功执行的转换次数，在上述情况下为 4。

```
if (4 != sscanf(buf, "%d %d %d %d", &a, &b, &c, &d))
{
    /* deal with error */
} 
```

如果 buf 是“1 2 3”或“1 2 a b”之类的，sscanf 将返回一个简短的项目计数。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-22T09:23:02.397

正如其他人所指出的，如果您知道预期有多少数字，则 sscanf 是最简单的解决方案。否则，以下概述了更通用的解决方案：

首先用空格标记字符串。标准的 C 方法是[strtok()](http://www.gnu.org/software/libtool/manual/libc/Finding-Tokens-in-a-String.html)：

```
char* copy;
char* token;

copy = strdup(string); /* strtok modifies the string, so we need a copy */

token = strtok(copy, " ");
while(token!=NULL){
  /* token now points to one number.
  token = strtok(copy, " ");      
} 
```

然后将字符串转换为整数。[atoi()](http://www.cplusplus.com/reference/clibrary/cstdlib/atoi.html)会这样做。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-22T09:20:18.627

sscanf() 可以做到这一点。

```
#include <stdio.h>

int main(void)
{
  int a, b, c, d;
  sscanf("1 2 3 4", "%d %d %d %d", &a, &b, &c, &d);
  printf("%d,%d,%d,%d\n", a, b, c, d);
} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-22T09:20:31.280

如果字符串总是包含 4 个用空格分隔的数字，那么可以使用 sscanf 来完成：

```
sscanf(string, "%d %d %d %d", &a, &b, &c, &d); 
```

如果数字的数量不同，那么您需要解析字符串。

请相应地澄清您的问题。

# asp.net - 如何让孩子出现在 ASP.NET 的自定义 web 控件中？

> ID：224978
> 
> 赞同：2
> 
> 时间：2008-10-22T09:14:41.523
> 
> 标签：asp.net, web-control

例如，我有一个名为 SampleControl 的自定义控件。为了简化这个问题，假设我只是从头开始制作面板控制克隆。

```
<CC:SampleControl ID="Sample1" runat="server">
   <asp:Label ID="Label1" runat="server" Text="Hi"></asp:Label>
   <asp:Button ID="Button1" runat="server" Text="Button1"></asp:Label>
</CC:SampleControl> 
```

输出：

```
<div id="Sample1">
   <span id=Label1>Hi</span>
   etc.....
</div> 
```

代码在哪里：

```
public class SampleControl: WebControl
{
    .....Render Stuff Goes Here.....
} 
```

中间的 ASP 控件没有被 ASP.NET 注册。当我在面板控件上做反射器时，我不知道他们是如何让中间控件渲染的。看起来他们没有使用模板化控件。

当我这样做时，我收到此错误：

解析器错误描述：解析服务此请求所需的资源时发生错误。请查看以下特定的解析错误详细信息并适当地修改您的源文件。

有任何想法吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-22T09:23:34.860

首先，[ParseChildren(false)] 属性让解析器知道您希望控件将嵌套内容视为子控件。

然后确保在 Render 中的某个地方调用了 RenderChildren 方法。它是 System.Web.UI.Control.Render() 的默认实现，因此您可以在覆盖的 Render 方法中执行 base.Render(writer)。

# unit-testing - 用一种新的编程语言实现 xunit

> ID：224996
> 
> 赞同：0
> 
> 时间：2008-10-22T09:21:02.493
> 
> 标签：unit-testing, language-agnostic, xunit

我们中的一些人仍然“生活”在尚未接受单元测试的编程环境中。首先，显而易见的第一步是尝试实现一个体面的单元测试框架，我猜 xUnit 是“标准”。

那么在新的编程语言中实现 xUnit 的良好起点是什么？

顺便说一句，因为人们在问：我的目标环境是 Visual Dataflex。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-22T09:31:00.087

它适用于哪种语言 - 已经有相当多的语言[了](http://opensourcetesting.org/unit_misc.php)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-22T09:58:14.353

如果这阻止您开始编写单元测试，您可以在没有测试框架的情况下开始。

C 风格语言的示例：

```
void Main() 
{
  var algorithmToTest = MyUniversalQuestionSolver();
  var question = Answer to { Life, Universe && Everything };

  var actual = algorithmToTest(question);
  var expected = 42;
  if (actual != expected) Error();

  // ... add a bunch of tests
} 
```

Cobol 风格语言的示例：

```
MAIN.
  COMPUTE EXPECTED_ANSWER = 42
  SOLVE ANSWER_TO_EVERYTHING GIVING ACTUAL_ANSWER
  SUBTRACT ACTUAL_ANSWER FROM EXPECTED_ANSWER GIVING DIFFERENCE
  IF DIFFERENCE NOT.EQ 0 THEN
    DISPLAY "ERROR!"
  END-IF

  * ... add a bunch of tests
  STOP RUN 
```

在对代码进行更改（并且可能编译）后运行 Main。每当有人向您的存储库提交代码时，在服务器上运行 main。

当您上瘾时，请多寻找一个框架，或者看看您是否可以将 Main 中的一些位分解到您自己的框架中。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-22T09:24:30.257

我建议一个好的起点是在其他几种语言上使用 xunit 来感受这种风格的单元测试框架是如何工作的。然后，您需要深入研究行为并开始研究如何以适合您的新语言的方式重新创建该行为。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-22T10:43:02.063

我在 VFP 中创建了一个体面的单元测试框架，它基于David Astels的[Test Driven Development: A Practical Guide中的代码。](https://rads.stackoverflow.com/amzn/click/com/0131016490)通过阅读示例、理解技术并将 Java 代码翻译成您的语言，您将获得很长的路要走。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-09-18T11:12:44.090

我发现[在 C# 中使用 NUnit 进行实用单元测试](http://www.pragprog.com/titles/utc2/pragmatic-unit-testing-in-c-with-nunit)非常有帮助！******