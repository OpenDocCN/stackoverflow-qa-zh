# StackOverflow 问答 000232000-000232999

# c# - 如何从 C# 中的 HTML 字符串操作 DOM？

> ID：232004
> 
> 赞同：11
> 
> 时间：2008-10-23T23:49:09.950
> 
> 标签：c#, .net, html, dom, .net-2.0

目前，我发现能够从包含 HTML 的字符串中操作 DOM 的最佳方法是：

```
WebBrowser webControl = new WebBrowser();
webControl.DocumentText = html;
HtmlDocument doc = webControl.Document; 
```

有两个问题：

1.  需要`WebBrowser`对象！
2.  这不能与多线程一起使用；我需要一些可以在不同线程（除了主线程）上工作的东西。

有任何想法吗？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-10-23T23:57:37.217

我在 GooglePlex 上搜索了 HTML，发现了[Html Agility Pack](https://html-agility-pack.net/)，我不知道它是否适合，我现在正在下载它尝试一下。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-10-23T23:54:52.760

根据您要执行的操作（也许您可以向我们提供更多详细信息？）并根据 HTML 是否格式正确，您*可以*将其转换为`XmlDocument`：

```
System.Xml.XmlDocument x = new System.Xml.XmlDocument();
x.LoadXml(html); // as long as html is well-formed, i.e. XHTML 
```

然后你可以很容易地操纵它，而不需要`WebBrowser`实例。至于线程，我对实现的了解还不够，无法知道`XmlDocument`那部分的答案。

* * *

如果文档的格式不正确，您可以使用[**NTidy**](http://sourceforge.net/projects/ntidy/)（[**HTML Tidy**](http://tidy.sourceforge.net/)的 .NET 包装器）先使其成型；我不得不为一个项目做一次这件事，而且真的还不错。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-10-28T09:55:31.107

JasonBunting 已经发布了这个，但它确实可以在 HTML tidy 周围使用 .net 包装器并将其加载到 XmlDocument 中。

我以前使用过这个 .net 包装器：

[http://www.codeproject.com/KB/cs/ZetaHtmlTidy.aspx](http://www.codeproject.com/KB/cs/ZetaHtmlTidy.aspx)

并实现它有点像这样：

```
string input = "<p>crappy html<br <img src=foo></div>";
HtmlTidy tidy = new HtmlTidy()
string output = tidy.CleanHtml(input, HtmlTidyOptions.ConvertToXhtml);
XmlDocument doc = new XmlDocument();
doc.LoadXml(output); 
```

抱歉，如果考虑转发:)

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2013-09-25T20:19:01.427

这是一个老问题。现在有：

*   [HTML 敏捷包](https://github.com/zzzprojects/html-agility-pack)（你已经找到了这个）
*   [CsQuery](https://github.com/jamietre/CsQuery)，一个 .Net jQuery 端口，非常适合 jQuery 开发人员

# python - 对于基于权限的 Web 应用程序，Django 会是一个不错的选择吗？

> ID：232008
> 
> 赞同：14
> 
> 时间：2008-10-23T23:50:15.687
> 
> 标签：python, django, permissions

我一直在探索 Django 的细节大约一个星期，并且喜欢我所看到的。但是，我遇到了一些.. 与细粒度控制 CRUD 接口权限相关的消极情绪。

我正在写的是一个 Intranet 客户端管理 web 应用程序。该组织大约有 6 层，我需要根据层限制对客户组的访问。不断扩大。我有一个相当好的想法，我将如何做到这一点，但我不确定我是否能够将它很好地集成到预建的管理界面中。

我已经完成了绝对零的 Django 开发，否则我可能会更好地了解这是否可行。如果生成的管理界面对这个项目毫无用处，我可能不会使用 Django - 但就像我说的，严重依赖细粒度的自定义权限。

Django 会让我构建自定义权限/规则并将其无缝集成到管理 CRUD 界面中吗？

更新一：我想使用管理应用程序来最小化生成 CRUD 接口的重复，所以是的，我认为它是必须的。

更新二：

我想描述这个项目所需的权限。

一个客户可以属于一个或多个“商店”。全职员工应该只能在他们的商店编辑客户（即使他们属于另一家商店）。但是，他们应该无法在另一家商店查看/编辑客户。Casuals 应该只能根据他们所登记的商店来查看客户（或者如果 Casuals 以商店用户身份登录 - 更有可能）。

他们上方的管理层需要能够看到他们管理的商店的所有员工，仅此而已。

高级管理层应该能够编辑所有员工并授予他们自己以下的权限。

阅读 django 文档后，它说您不能（自动）为组的子集设置权限。只有整个组。为此目的模拟您自己的权限是否足够容易？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-25T23:49:42.063

如果我正确阅读了您更新的要求，我认为 Django 现有的身份验证系统还不够。听起来您需要一个完整的 ACL 系统。

这个话题已经出现过好几次了。尝试在 django+acl 上搜索。

随机抽样...

几年前有一个 Summer of Code 项目，但我不确定他们去哪里了。请参阅[http://code.djangoproject.com/wiki/GenericAuthorization](http://code.djangoproject.com/wiki/GenericAuthorization)

djngoproject.org 上有一张新票，可能很有趣：

*   [http://code.djangoproject.com/ticket/9444](http://code.djangoproject.com/ticket/9444)

dumpz.org 上有一些有趣的代码片段：

*   [http://dumpz.org/274/models.py](http://dumpz.org/274/) _
*   [http://dumpz.org/273/signals.py](http://dumpz.org/273/) _

...但是有零个文档。

祝你好运！

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-24T01:58:34.120

Django 权限系统完全规则。每个模型都有一组默认权限。您也可以为模型添加新权限。

每个用户都有一组权限以及组成员身份。个人用户可以拥有个人权限。他们从他们的组成员中继承权限。

您的视图函数（和模板）可以在您需要使用的任何粒度级别轻松检查这些权限是否存在。

如果这对您来说还不够，配置文件插件为您提供了更多选项来定义“用户”及其能力、权限、角色、职责等。

如果这对您来说还不够，您可以定义自己的身份验证方案。

* * *

重要的是不要尝试定义作为实际用户子集的组，而不是*随意*定义的头衔或角色。您永远不需要“为组的子集设置权限”。你需要有更小的团体。围绕人的子集定义的组。

Django 的默认权限是围绕模型访问，而不是模型内的行访问。另一方面，您的问题与几个模型中的行子集有关：客户、商店、员工、经理。

在这些项目中，您需要一组基本的 FK，以及一些过滤器来对行进行子集化。您可能无法使用默认管理页面执行此操作。您可能需要自己的管理员版本才能使用专门的过滤器。

* * *

如果你不能用 Django 权限系统来做，你应该重新考虑你的用例。严重地。

[然而，Django-REST 接口完全是另一种野兽，需要一些照顾和喂养。]

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-24T00:06:33.113

[ModelAdmin](http://code.djangoproject.com/browser/django/trunk/django/contrib/admin/options.py#L154)对象具有`has_add_permission`、和方法`has_change_permission`，可用于对登录用户可以查看和修改的内容强制执行权限 - 您可以创建一个子类，使用这些子类来强制执行您想要实现的任何权限并将所有模型注册到应用程序使用你的子类。`has_delete_permission``queryset``admin`

但是，这一切都取决于您的权限系统将如何工作 - 您的细粒度权限的确切要求是什么？你越远离`admin`应用程序的设计目标，它需要做的工作就越多，但是其中有很多钩子可以用来实现你的自定义需求。这是[Luke Plant 的博客文章，](http://lukeplant.me.uk/blog.php?id=1107301686)其中提供了一些无需深入挖掘即可进行微调的示例。

它绝对必须基于`admin`应用程序吗？[通用视图](https://docs.djangoproject.com/en/1.4/ref/generic-views/#create-update-delete-generic-views)和[ModelForms](https://docs.djangoproject.com/en/1.4/topics/forms/modelforms/)可以处理实现 CRUD 所涉及的许多繁琐的部分，所以[要小心不要](http://www.jonathanbuchanan.plus.com/images/admin.jpg)过于依赖定制`admin`- 从挂断`admin`应用程序以及它可以做什么和可以做什么开始几乎是 Django 的传统'不这样做，最初认为你永远不必再编写任何代码;）

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-08-10T08:44:23.507

从 django 1.2 开始支持行级权限，[django-guardian](http://packages.python.org/django-guardian/)使得处理起来非常直观。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-27T10:40:14.097

您可能还想查看粒度权限猴子补丁： [http ://code.google.com/p/django-granular-permissions/](http://code.google.com/p/django-granular-permissions/)

它将行级权限添加到 django 的权限系统中。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-08-27T01:08:13.987

我刚刚找到[http://bitbucket.org/jezdez/django-authority/](http://bitbucket.org/jezdez/django-authority/)，它看起来很有希望。

# javascript - 您如何通过 JavaScript/Ajax 代码管理 Infragistics WebGrid 数据？

> ID：232020
> 
> 赞同：1
> 
> 时间：2008-10-23T23:53:48.957
> 
> 标签：javascript, ajax, infragistics, webgrid

我正在开发一个项目，我需要将 Infragistics WebGrid 控件用于某些数据列表。我正在使用 JavaScript 在客户端加载数据以在地图上显示，然后我需要在多个 WebGrid 中显示相同的数据。所有可用数据都将显示在 WebGrid 中，但在任何给定时间，只有一部分数据（仅当前在视图中的数据）将绘制在地图上。由于我使用 JavaScript/Ajax 加载数据，因此我只想加载一次，并使用相同的机制来使用数据填充 WebGrid 控件。

有没有人有关于完全从客户端 JavaScript/Ajax 代码中使用 WebGrid 的任何提示/指针？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-14T19:30:42.373

Infragistics webgrids 公开了一个非常复杂的客户端对象模型，您可以使用它来填充您的数据客户端。

您要做的第一件事是查看 webgrid 控件的完整 CSOM，您可以在以下位置找到当前文档版本：[http ://help.infragistics.com/NetAdvantage/NET/2008.3/CLR2.0/](http://help.infragistics.com/NetAdvantage/NET/2008.3/CLR2.0/)

举一个简短的例子，您需要获取对网格的引用，然后添加一些行和数据。在设计时为您的网格设置列定义可能会更容易，而不是尝试在 javascript 中完成所有操作。

首先：参考您的网格：

```
var grid = igtbl_getGridById('dataGridControlID'); 
```

然后添加一个新行：

```
var newRow = grid.Rows.addNew() 
```

完成后，您可以循环行中的列来填充数据：

```
var oCols = newRow.Band.Columns;
for(var i=0; i < oCols.length; i++) {
    newRow.getCell[i].setValue(yourValue)
} 
```

或通过按键处理每一个以填充其数据：

```
newRow.getCellFromKey(colKey).setValue(yourValue,fireEvents); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-24T08:18:51.667

想到的唯一想法是与性能相关的。我们发现为 UltraWebGrid 动态创建和填充行明显比我们希望的要慢。（在我们的例子中，我们将行从一个网格移动到另一个网格，当行数过多时会遇到性能问题。）

如果我正在做你今天描述的事情，我会尽可能从服务器端填充网格，并从那里在地图上显示相关值。

作为附加的免责声明，我们使用了 Infragistics 2007.1；我不知道 2008.x 在这方面是否更好。

# c++ - C++父类调用子虚函数

> ID：232030
> 
> 赞同：12
> 
> 时间：2008-10-23T23:58:34.203
> 
> 标签：c++, inheritance, virtual

我想要一个纯虚拟父类来调用函数的子实现，如下所示：

```
class parent
{
  public:
    void Read() { //read stuff }
    virtual void Process() = 0;
    parent() 
    {
        Read();
        Process();
    }
}
class child : public parent
{
  public:
    virtual void Process() { //process stuff }
    child() : parent() { }
}

int main()
{
   child c;
} 
```

这应该可以，但我得到一个未链接的错误：/ 这是使用 VC++ 2k3

或者它不应该工作，我错了吗？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-10-24T00:03:47.907

下一篇文章的标题说明了一切：[在构造或破坏期间不要调用虚函数](http://www.artima.com/cppsource/nevercall.html)。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-24T00:22:10.897

或者，创建一个用于创建对象的工厂方法并将构造函数设为私有，然后工厂方法可以在构造后初始化对象。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-24T00:01:18.787

通常可以工作，但不适用于纯虚拟基类的构造函数中的调用。在构造基类时，子类覆盖不存在，因此您不能调用它。只要您在构建整个对象后调用它，它就应该可以工作。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-24T00:02:58.673

这是因为您的调用在构造函数中。在构造函数完成之前，派生类将无效，因此您的编译器对此进行了正确的测试。

有两种解决方案：

1.  在派生类的构造函数中调用 Process()
2.  为 Process 定义一个空白函数体，如下例所示：

```
class parent
{
  public:
    void Read() { //read stuff }
    virtual void Process() { }
    parent() 
    {
        Read();
        Process();
    }
} 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-24T09:27:39.593

再走一步，您就可以引入某种功能，例如

```
class parent
{
    public:
        void initialize() {
            read();
            process();
        }
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-24T09:48:59.317

**表面**问题是您调用了一个未知的虚函数（对象是从父级到子级构造的，因此 vtables 也是如此）。你的编译器警告过你。

据我所知，**基本**问题是您尝试通过继承重用功能。这几乎总是一个坏主意。一个设计问题，可以这么说:)

本质上，您尝试实例化模板方法模式，以将*什么*与*何时*分开：首先读取一些数据（以某种方式），然后处理它（以某种方式）。

这可能会更好地使用聚合：将 Processing 函数赋予 Template 方法以在正确的时间调用。也许你甚至可以对 Read 功能做同样的事情。

聚合可以通过两种方式完成：

1.  使用虚函数（即运行时绑定）
2.  使用模板（即编译时绑定）

示例 1：运行时绑定

```
class Data {};
class IReader    { public: virtual Data read()            = 0; };
class IProcessor { public: virtual void process( Data& d) = 0; };

class ReadNProcess {
public:
    ReadNProcess( IReader& reader, IProcessor processor ){
       processor.process( reader.read() );
    }
}; 
```

示例 2：编译时绑定

```
template< typename Reader, typename Writer > // definitely could use concepts here :)
class ReadNProcess {
public:
     ReadNProcess( Reader& r, Processor& p ) {
         p.process( r.read() );
     }
}; 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-24T00:28:11.507

您需要在对象完全构造后调用虚拟方法的对象内部：

```
class parent
{
  public:
    void Read() { /*read stuff*/ }
    virtual void Process() = 0;
    parent()
    {
        Read();
    }
};

class child: public parent
{
  public:
    virtual void Process() { /*process stuff*/ }
    child() : parent() { }
};

template<typename T>
class Processor
{
    public:
        Processor()
            :processorObj() // Pass on any args here
        {
            processorObj.Process();
        }
    private:
        T   processorObj;

};

int main()
{
   Processor<child> c;
} 
```

# reporting-services - 您可以在 Reporting Services 中重新格式化日期参数值吗？

> ID：232038
> 
> 赞同：3
> 
> 时间：2008-10-24T00:01:18.020
> 
> 标签：reporting-services

是否可以转换传递给查询的日期值的格式？我正在尝试创建一个与 SAP 后端接口的报告，但查询对日期对象使用不同的格式。我需要选择所选日期并将其重新格式化为“yyyy.mm.dd”（包括引号）。这可能吗？我可以将其作为文本框进行，但这有点难看。任何意见，将不胜感激。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-24T18:30:41.373

由于参数在报表数据集中传递给您的 sql，因此您可以更改表达式。例如，这是默认代码

```
=Parameters!StartDate.Value 
```

可以改成，基本上表达式就像vb代码

```
="""" + Year(Parameters!StartDate.Value).ToString() + "." + Month(Parameters!StartDate.Value).ToString() + "." + Day(Parameters!StartDate.Value).ToString() + """" 
```

# rest - 如何提交 RESTful 部分更新？

> ID：232041
> 
> 赞同：23
> 
> 时间：2008-10-24T00:02:01.077
> 
> 标签：rest, http-put

Sam Ruby，“RESTful Web Services”的作者似乎反对使用 HTTP PUT 进行部分更新：http: [//intertwingly.net/blog/2008/02/15/Embrace-Extend-then-Innovate](http://intertwingly.net/blog/2008/02/15/Embrace-Extend-then-Innovate)

*尚不清楚应该*如何进行部分更新。正如我在他的博客底部评论的那样，目前尚不清楚使用 HTTP PATCH 比使用“补丁文档”对抗 HTTP PUT 更好。

值得注意的是，尽管 Sam 反对滥用 HTTP PUT，但他似乎也不提倡使用 HTTP PATCH。

应该如何提交 RESTful 部分更新？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-10-24T01:26:02.640

正如您从您引用的博客文章中的评论中看到的那样，没有就进行部分更新的方式达成一致。如果像 Sam Ruby、Joe Gregario、Mark Nottingham、Mark Pilgrim、Bill de hÓra 等重量级人物无法达成协议，我们还有什么希望。

就我而言，我不会太担心。创建适合您的部分更新媒体类型，使用 PATCH 来表明您的意图，当最终就通用媒体类型达成一致时，更改您的服务器以接受这两种格式。

值得庆幸的是，如果您的 REST api 犯下的最严重的罪行是滥用 PUT/PATCH，那么您做得很好。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2013-01-02T23:25:01.670

现在是 2013 年 - 您应该使用 PATCH 进行部分更新 - 使用 json-patch（参见[https://www.rfc-editor.org/rfc/rfc6902](https://www.rfc-editor.org/rfc/rfc6902)或[http://www.mnot.net/blog/2012 /09/05/patch](http://www.mnot.net/blog/2012/09/05/patch)）或 xml-patch 文档（参见[https://www.rfc-editor.org/rfc/rfc7351](https://www.rfc-editor.org/rfc/rfc7351)）。不过，在我看来，json-patch 最适合您的业务数据类型。

带有 JSON/XML 补丁文档的 PATCH 对于部分更新具有非常严格的前向语义。如果您开始使用带有原始文档的修改副本的 POST 进行部分更新，您很快就会遇到您希望缺失值（或者更确切地说是空值）表示“忽略此属性”或“将此属性设置为空值” - 这导致了黑客解决方案的兔子洞，最终将导致您自己的补丁格式。

您可以在这里找到更深入的答案：http: [//soabits.blogspot.dk/2013/01/http-put-patch-or-post-partial-updates.html](http://soabits.blogspot.dk/2013/01/http-put-patch-or-post-partial-updates.html)。

**更新：这是 RPC 吗？**

好吧，如果您将 RPC 定义为向服务器发送命令，那么任何和所有 HTTP 操作都是 RPC 调用 - 无论您是 GET 资源、PUT 新表示还是再次删除它 - 它们中的每一个都包含发送命令（动词）GET /PUT/DELETE 等和可选的有效负载。碰巧 HTTP 工作组（或者它是谁）引入了一个新动词 PATCH，它允许客户端对资源进行部分更新。

如果除了将完整的表示发送到服务器之外，其他任何东西都被认为是 RPC 样式，那么根据定义，部分更新不能是 RESTful。可以选择持有这种观点，但网络基础设施背后的人说不同 - 因此为此目的定义了一个新动词。

RPC 更多地是关于通过 HTTP 以对 Web 上的中介不可见的方式调用方法调用——例如使用 SOAP 来包装方法名称和参数。这些操作是“不可见的”，因为没有标准定义有效载荷内的方法和参数。

将其与具有媒体类型 application/json-patch 的 PATCH 进行比较 - 由于动词 PATCH 具有明确定义的含义，并且有效负载以另一种明确定义的公共可用格式编码，因此网络上的任何中介都清楚地看到了操作的意图通过网络上的共同权威 (IETF)。最终结果是每个人都完全可见，并且没有特定于应用程序的秘密语义。

REST 也是关于“偶然重用”，这正是 PATCH with application/json-patch 的含义——重用现有标准，而不是发明或多或少相同的应用程序特定协议。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2011-10-09T09:32:34.293

您可以为部分资源提供自己的 URI，而不是自制部分更新媒体类型并使用非标准 PATCH 方法。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-03-22T09:28:31.700

HTTP PATCH 现在有一个 RFC - [HTTP PATCH RFC](https://www.rfc-editor.org/rfc/rfc5789)

# msbuild - MSBuild：从命令行指定目标

> ID：232052
> 
> 赞同：24
> 
> 时间：2008-10-24T00:07:38.633
> 
> 标签：msbuild

我有一个 MSBuild 任务来在解决方案文件中构建特定项目。它看起来像这样：

```
<Target Name="Baz">
  <MSBuild Projects="Foo.sln" Targets="bar:$(BuildCmd)" />
</Target> 
```

从命令行，我可以将 my 设置`BuildCmd`为`Rebuild`or`Clean`并且它按预期工作：

> msbuild /target:Baz /property:BuildCmd=重建 MyMsbuildFile.xml msbuild /target:Baz /property:BuildCmd=Clean MyMsbuildFile.xml

`BuildCmd`但是为了构建，我使用什么词来设置？我已经尝试过`Build`，`Compile`只是将其留空或未定义，但我总是收到错误消息。

> msbuild /target:Baz /property:BuildCmd=Build MyMsbuildFile.xml Foo.sln：错误 MSB4057：项目中不存在目标“bar:Build”。
> 
> msbuild /target:Baz /property:BuildCmd=Compile MyMsbuildFile.xml Foo.sln：错误 MSB4057：项目中不存在目标“bar:Compile”。
> 
> msbuild /target:Baz MyMsbuildFile.xml Foo.sln：错误 MSB4057：项目中不存在目标“bar：”。

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-10-24T14:21:24.107

我知道您想使用特定命令构建目标：构建、清理等。

我就是这样做的。

创建一个属性以接收您的构建命令，如果未指定默认为 Build

```
<PropertyGroup>
  <BuildCmd Condition=" '$(BuildCmd)' == ''">Build</BuildCmd>
</PropertyGroup> 
```

之后，创建将使用参数中指定的目标启动 MSBuild 的目标：

```
<Target Name="Stackoverflow">
  <MsBuild Projects="Foo.sln" Targets="$(BuildCmd)" />
</Target> 
```

然后使用 target 和 BuildCmd 参数调用您的 MSBuild 文件，如下所示：

```
msbuild msbuild.xml /t:Stackoverflow /p:BuildCmd=Clean 
```

只需确保目标存在于解决方案或项目文件中。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-24T05:07:41.460

来自：http: [//msdn.microsoft.com/en-us/library/ms164311.aspx](http://msdn.microsoft.com/en-us/library/ms164311.aspx)

/目标：目标

在这个项目中构建这些目标。使用分号或逗号分隔多个目标，或分别指定每个目标。/t 也是可以接受的。例如：/target:Resources;编译

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-07-27T13:44:44.707

关键是条件化 BuildCmd 属性。

```
 <Target Name="Baz">
   <PropertyGroup>
     <BuildCmd Condition="'$(BuildCmd)' != ''">:$(BuildCmd)</BuildCmd>
   </PropertyGroup>
   <MSBuild Projects="Foo.sln" Targets="bar$(BuildCmd)" />
 </Target> 
```

这样，如果设置了 Clean 或 Rebuild，则会添加冒号。如果没有添加任何内容，BuildCmd 将只是空白，默认为 Build 目标。

*注*- 属性组必须驻留在目标中，否则当您在命令行中指定它时，它将被覆盖。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-24T21:04:31.017

使用 CheGueVerra 的模板，我想出了以下解决方案：

```
<PropertyGroup>
    <ProjBuildCmd Condition="'$(BuildCmd)' != 'Build'">:$(BuildCmd)</ProjBuildCmd>
    <SolnBuildCmd Condition="'$(BuildCmd)' != 'Build'">$(BuildCmd)</SolnBuildCmd>
</PropertyGroup> 
```

然后我不`$(BuildCmd)`直接使用，而是使用`$(ProjBuildCmd)`或`$(SolnBuildCmd)`喜欢这样：

```
<!-- Build the 'bar' project only -->
<Target Name="Baz">
  <MSBuild Projects="Foo.sln" Targets="bar$(ProjBuildCmd)" />
</Target>

<!-- Build the whole solution -->
<Target Name="Baz2">
  <MSBuild Projects="Foo.sln" Targets="$(SolnBuildCmd)" />
</Target> 
```

* * *

## 回答 #5

> 赞同：-9
> 
> 时间：2008-10-24T00:45:19.943

只需自己编辑 sln 文件并找出 - MSBuild 是一个真正简单的语法，只需查找目标。

# debugging - 调试类似greasemonkey的脚本

> ID：232053
> 
> 赞同：11
> 
> 时间：2008-10-24T00:07:58.630
> 
> 标签：debugging, firefox-addon, greasemonkey

我正在编写作为字符串读入并通过 eval() 由 firefox 扩展执行的 javascript 代码。Firebug 确实“看到”了我的脚本，因此我无法使用断点、查看对象等。

我目前正在使用 Firefox 的错误控制台，我开始发现它有限制。我还有哪些其他选择？理想情况下，我可以使用 Firebug 或类似的东西。人们通常如何调试 Greasemonkey 脚本？

我尝试过使用 Lint 和其他验证器，但我的脚本使用了扩展环境提供的大量对象和函数，导致报告的许多错误无关紧要。此外，输出往往过于挑剔（关注间距问题等）。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-19T05:10:29.957

我创建了一个交互式控制台来调试 Greasemonkey 脚本。它需要 Google Gears，但它包含输入命令的持久历史记录。

**更新**：这是一篇博客文章[的链接，该文章描述了使用 GreeasyThug 调试 GM 脚本。](http://strd6.com/?p=211)它有一个逐步的过程来复制错误并设计解决方案。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-08-14T12:22:46.510

我使用此代码是为了能够使用 jQuery 访问页面 DOM（不需要 unsafeWindow hacks）并将错误记录到 Firebug 控制台：

```
(function(_, $){
  try {
    var GM_log = function(obj) { _.console.log(obj); }

    // $("#my_div").reaplaceWith("hello world!");
    // _.someFunctionDefinedInTheWebsite();

  } catch(e) {
    GM_log(e);
  }
})(unsafeWindow, unsafeWindow.jQuery); 
```

*注意*：此示例假定您正在访问的页面已经使用 jQuery

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-24T01:31:02.833

据我所知，Firebug`eval()`从 1.1 开始就支持调试，特别是对于 GreaseMonkey，您可以使用[GM_log](http://wiki.greasespot.net/GM_log)进行基本日志记录，您可能会发现这个工具也很有用：

*   [Web 开发者扩展](http://chrispederick.com/work/web-developer/)
*   [JSUnit](https://github.com/pivotal/jsunit)
*   [JSLint](http://www.jslint.com/lint.html)

# jython - 是否可以使用 Jython 和 dom4j 在元素之间添加元素？

> ID：232056
> 
> 赞同：2
> 
> 时间：2008-10-24T00:09:52.840
> 
> 标签：jython, dom4j

只是在玩 dom4j，非常好。我做了一年半的 PHP 开发人员，刚找到一份新工作并开始使用 Jython，现在我有空闲时间，它是一门很棒的语言。正在考虑尝试在元素之间添加一个元素，示例如下：

```
<div id="content">
    <p>Some text in here</p>
    <!--New p tag here-->
    <p>Some text in here</p>
</div> 
```

是否可以在两者之间插入另一个**p**标签而不将 DOM 转换为字符串并再次返回 DOM，因为这是我能够做到的唯一方法？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-28T04:37:59.343

我对dom4j不太了解，但我会这样做：

1.  将 的所有子节点复制`div#content`到列表中，然后删除其子节点。
2.  将第一个节点重新插入到`div#content`节点中。
3.  将新`p`节点插入到`div#content`节点中。
4.  将最后一个节点重新插入到`div#content`节点中。

我不知道这在 DOM 方面是什么，但如果节点表示为 Jythonic 对象，那么这样做应该很容易。

# asp.net - 有没有类似于 Capistrano 的部署 IIS 网站的解决方案？

> ID：232059
> 
> 赞同：11
> 
> 时间：2008-10-24T00:12:29.417
> 
> 标签：asp.net, sql-server, iis, deployment

[Capistrano](http://www.capify.org/)是构建自动部署网站和/或数据库的脚本的绝佳解决方案。但是，它也非常以 *nix 为中心，从我的阅读来看，让它与 Windows 服务器一起工作可能会比让它工作更麻烦。是否有类似的解决方案可以让我将 ASP.Net 网站部署到 IIS 服务器和 SQL Server 数据库？

我正在寻找的是能够提供与 Capistrano 相同的灵活性的东西，至于自定义我希望如何部署站点，我想从哪个版本控制系统中提取，它将如何处理回滚到以前网站的版本等。到目前为止，我还没有找到与 Capistrano 具有相同功能的免费解决方案。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-09-28T15:42:32.310

我已经将 Capistrano 与 ASP.NET 和 IIS 一起使用。为了让它工作，我在目标机器上安装了 Cygwin 并修改了 Capistrano 以在释放或回滚时在 IIS 中拆除和设置虚拟目录。

作为奖励，我还让 Capistrano 根据部署到的机器重命名配置文件，这样我们就可以自动正确地建立数据库连接。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-24T00:31:50.503

我们使用由 Setup Factory 创建的 msi 文件。它几乎可以让您放置所需的任何设置参数。我们也正在考虑使用 AntHill Pro，它可能更符合您的需求，但要花很多钱。

IIS 中的所有内容都可以通过 vb 脚本进行修改。至于去可能是最便宜的免费路线。我相信您可以将它与批处理文件和一些自定义编程结合使用，您可以将所需的任何内容部署到 iis 和 sql server。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-24T00:21:44.627

我不知道有像 Capistrano 这么多功能的东西，但是有很好的老[nant](http://nant.sourceforge.net/)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-12-02T02:06:13.920

它绝对不是像 Capistrano 那样的完整工具，但[powershell](http://technet.microsoft.com/en-us/scriptcenter/dd742419.aspx)将为您提供执行脚本等的能力。您只需要自己编写部署片段即可。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-06-09T19:05:00.593

不完全是您正在寻找的东西，但[Hudson](http://hudson-ci.org/)与[MSBuild](http://en.wikipedia.org/wiki/MSBuild)和[webdeploy](http://www.iis.net/download/webdeploy)（又名 MSDeploy）相结合，除了提供持续集成外，还可以满足您的需求。这就是我要走的路。我希望 Hudson 通过 MSDeploy 创建包，这些包在本地保存并在构建成功时推送到登台服务器。然后稍后找出一键将包推送到生产。

更新：事实证明这相当容易。我没有构建包，而是让 msdeploy 将成功的构建推送到开发服务器。然后可以创建一个单独的任务，让 msdeploy 从开发推送到生产（或中间登台服务器）。

# c# - MessageBox.Show——字体改变？

> ID：232066
> 
> 赞同：28
> 
> 时间：2008-10-24T00:14:12.457
> 
> 标签：c#, fonts, messagebox

我正在使用 MessageBox 类向用户显示错误，虽然这可能不是正确的行为，但它非常方便。然而，这是一个触摸屏应用程序，所以我需要“确定”按钮比它大得多（诅咒我的手指太大了！）。

我认为如果我在对话框中增加字体大小，我应该没问题。有没有办法做到这一点？或者真的，有什么办法可以增加对话框的大小？

谢谢

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-10-24T00:19:21.620

据我所知，您不能，因为“正常”对话框正在使用您的默认系统字体设置。

自己动手可能是最好的前进方式。做起来很简单，而且很有趣！并且您可以构建标准对话框不支持的内容（没有 PInvoke 魔术），例如在屏幕中间居中等。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2014-12-19T13:25:26.773

请查看我的免费使用[FlexibleMessageBox](http://www.codeproject.com/Articles/601900/FlexibleMessageBox-A-flexible-replacement-for-the)可以代替 MessageBox 并具有（静态）字体属性。

问候，约尔格

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-24T00:45:14.640

为此，我会创建自己的 MessageBox 类 - 也许是 BigMessageBox？然后就是用 BigMessageBox.Show 替换 MessageBox.Show。

另一种选择是使用 Windows 挂钩来修改表单 - 查看[https://web.archive.org/web/20091208060754/http://msdn.microsoft.com/en-gb/magazine/cc188920.aspx](https://web.archive.org/web/20091208060754/http://msdn.microsoft.com/en-gb/magazine/cc188920.aspx) .net 1.0 中的示例。在当前版本中这可能更容易，但我找不到适合您的示例。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-11-04T16:45:04.683

使用带有文本框和两个按钮的表单，确定，取消就可以了。在整个项目中使用此表单而不是 MessageBox。您可以即时更改文本框的字体、背景颜色、多行等。您也可以更改按钮的大小、颜色和字体。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2010-05-12T14:31:46.203

有一个解决方案——通过安装 CBT 挂钩，可以动态调整各种 MessageBox 视觉设置：消息和按钮字体、对话框背景、对话框定位、图标、按钮标题、超时等。

扩展 MessageBox .NET 程序集 [http://www.news2news.com/vfp/?solution=5](http://www.news2news.com/vfp/?solution=5)

# c - Delphi 是否有任何等效于 C 的 volatile 变量？

> ID：232075
> 
> 赞同：14
> 
> 时间：2008-10-24T00:16:47.757
> 
> 标签：c, multithreading, delphi, volatile, memory-model

在 C 和 C++ 中，变量可以标记为[**volatile**](http://en.wikipedia.org/wiki/Volatile_variable)，这意味着编译器不会优化它，因为它可能在声明对象之外被修改。Delphi编程中是否有等价物？如果不是关键字，也许可以解决？

我的想法是使用**Absolute**，但我不确定，这可能会带来其他副作用。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-10-24T01:27:41.123

简短的回答：没有。

但是，如果您遵循这种方法，我不知道编译器的保守方法会改变读取或写入次数的任何情况：

读取跨线程可见位置时，在进行任何进一步操作之前将其值保存到本地；同样，将写入限制为单个分配。

当表达式之间存在对非内联方法的调用时，Delphi 编译器不会对非本地位置表达式执行公共子表达式消除 (CSE)，因为编译器不进行过程间优化，因此即使对于单个位置表达式也不正确-线程代码。

因此，您可能希望使用 InterlockedExchange() 进行读写以强制执行此操作；此外，这将导致内存完全屏障，因此处理器也不会重新排序读取和写入。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2016-05-10T17:37:38.837

根据[The Delphi Language for Mobile Development](https://www.embarcadero.com/white-papers/category/3-white-papers-application-development?download=102%3Athe-delphi-language-for-mobile-development)白皮书，Delphi 的移动编译器[`[volatile]`](http://docwiki.embarcadero.com/RADStudio/Berlin/en/Compiler_Attributes#Volatile)自首次推出以来就支持一个属性：

> 该`volatile`属性用于标记受不同线程更改的字段，以便代码生成不会优化将值复制到寄存器或另一个临时内存位置。
> 
> 您可以使用该`volatile`属性来标记以下声明：
> 
> *   变量（全局和局部）
> *   参数
> *   记录或类的字段。
> 
> 您不能使用 volatile 属性来标记以下声明：
> 
> *   类型
> *   过程、函数或方法
> *   表达式
> 
> ```
> type
>   TMyClass = class
>   private
>     [volatile] FMyVariable: TMyType;
>   end; 
> ```

从 Delphi 10.1 Berlin 开始，桌面编译器现在也支持`[volatile]`。

[所有编译器支持的属性](http://docwiki.embarcadero.com/RADStudio/Berlin/en/What%27s_New#Attributes_Supported_by_All_Compilers)

> 现在，所有 Delphi 编译器都支持以下属性：
> 
> *   [不安全](http://docwiki.embarcadero.com/RADStudio/en/Compiler_Attributes#Unsafe)
> *   [易挥发的](http://docwiki.embarcadero.com/RADStudio/en/Compiler_Attributes#Volatile)
> *   [虚弱的](http://docwiki.embarcadero.com/RADStudio/en/Compiler_Attributes#Weak)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-24T01:03:00.643

我不知道任何等价物，我也不认为**绝对**指令会对您有所帮助。**absolute**允许您拥有两个使用相同地址的变量，但我认为它不会阻止编译器优化对该内存的引用。

我想您可以使用指针并自己管理它。这样，无论编译器如何优化指针值的检索，它都不应该假设存储在地址中的值与上次读取它时相同，但这纯粹是推测。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-24T08:01:55.180

Delphi for .Net 也没有关键字，但 .Net 平台有它的 util 函数。请参阅[Thread.VolatileRead](http://msdn.microsoft.com/en-us/library/system.threading.thread.volatileread.aspx)和[Thread.VolatileWrite](http://msdn.microsoft.com/en-us/library/system.threading.thread.volatilewrite.aspx)。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-24T06:50:02.283

使用动态分配的指针？

```
var
  MyVarPtr: ^integer;
begin
  New(MyVarPtr);
  MyVarPtr^ := 5;
... 
```

这应该可以防止编译器将寄存器用于整数值（但它可能仍使用寄存器作为地址）。不过，我不确定这与 volatile 相比如何。

# wcf - 常见 WCF 异常：连接意外关闭

> ID：232078
> 
> 赞同：12
> 
> 时间：2008-10-24T00:20:25.893
> 
> 标签：wcf, exception, connection

我有三个项目。一个是 WCF 服务项目，一个是 WPF 项目，一个是 Microsoft 单元测试项目。我使用如下所示的数据对象设置 WCF 服务项目：

```
[DataContract]
public enum Priority
{
    Low,
    Medium,
    High
}

[DataContract]
public struct TimeInfo
{
    [DataMember]
    public Int16 EstimatedHours { get; set; }

    [DataMember]
    public Int16 ActualHours { get; set; }

    [DataMember]
    public DateTime StartDate { get; set; }

    [DataMember]
    public DateTime EndDate { get; set; }

    [DataMember]
    public DateTime CompletionDate { get; set; }
}

[DataContract]
public class Task
{
    [DataMember]
    public string Title { get; set; }

    [DataMember]
    public string Description { get; set; }

    [DataMember]
    public Priority Priority { get; set; }

    [DataMember]
    public TimeInfo TimeInformation { get; set; }

    [DataMember]
    public Decimal Cost { get; set; }
} 
```

我的合同是这样的：

```
[ServiceContract]
public interface ITaskManagement
{
    [OperationContract]
    List<Task> GetTasks();

    [OperationContract]
    void CreateTask(Task taskToCreate);

    [OperationContract]
    void UpdateTask(Task taskToCreate);

    [OperationContract]
    void DeleteTask(Task taskToDelete);
} 
```

当我尝试使用以下代码在 WPF 应用程序或单元测试项目中使用该服务时：

```
var client = new TaskManagementClient();

textBox1.Text = client.GetTasks().ToString();

client.Close(); 
```

我收到以下错误：“基础连接已关闭：连接意外关闭。”

WPF 和单元测试项目的 app.config 如下所示：

```
<system.serviceModel>
    <bindings>
        <wsHttpBinding>
            <binding name="WSHttpBinding_ITaskManagement" closeTimeout="00:01:00"
                openTimeout="00:01:00" receiveTimeout="00:10:00" sendTimeout="00:01:00"
                bypassProxyOnLocal="false" transactionFlow="false" hostNameComparisonMode="StrongWildcard"
                maxBufferPoolSize="524288" maxReceivedMessageSize="65536"
                messageEncoding="Text" textEncoding="utf-8" useDefaultWebProxy="true"
                allowCookies="false">
                <readerQuotas maxDepth="32" maxStringContentLength="8192" maxArrayLength="16384"
                    maxBytesPerRead="4096" maxNameTableCharCount="16384" />
                <reliableSession ordered="true" inactivityTimeout="00:10:00"
                    enabled="false" />
                <security mode="Message">
                    <transport clientCredentialType="Windows" proxyCredentialType="None"
                        realm="" />
                    <message clientCredentialType="Windows" negotiateServiceCredential="true"
                        algorithmSuite="Default" establishSecurityContext="true" />
                </security>
            </binding>
        </wsHttpBinding>
    </bindings>
    <client>
        <endpoint address="http://localhost:9999/TaskManagement.svc"
            binding="wsHttpBinding" bindingConfiguration="WSHttpBinding_ITaskManagement"
            contract="TaskManagement.ITaskManagement" name="WSHttpBinding_ITaskManagement">
            <identity>
                <dns value="localhost" />
            </identity>
        </endpoint>
    </client>
</system.serviceModel> 
```

WCF 服务的 web.config 如下所示：

```
 <system.serviceModel>
    <behaviors>
        <serviceBehaviors>
            <behavior name="InternetBasedWcfServices.TaskManagementBehavior">
                <serviceMetadata httpGetEnabled="true" />
                <serviceDebug includeExceptionDetailInFaults="false" />
            </behavior>
            <behavior name="InternetBasedWcfServices.ScheduleManagementBehavior">
                <serviceMetadata httpGetEnabled="true" />
                <serviceDebug includeExceptionDetailInFaults="false" />
            </behavior>
        </serviceBehaviors>
    </behaviors>
    <services>
        <service behaviorConfiguration="InternetBasedWcfServices.TaskManagementBehavior"
            name="InternetBasedWcfServices.TaskManagement">
            <endpoint address="" binding="wsHttpBinding" contract="InternetBasedWcfServices.ITaskManagement">
                <identity>
                    <dns value="localhost" />
                </identity>
            </endpoint>
            <endpoint address="mex" binding="mexHttpBinding" contract="IMetadataExchange" />
        </service>
        <service behaviorConfiguration="InternetBasedWcfServices.ScheduleManagementBehavior"
            name="InternetBasedWcfServices.ScheduleManagement">
            <endpoint address="" binding="wsHttpBinding" contract="InternetBasedWcfServices.IScheduleManagement">
                <identity>
                    <dns value="localhost" />
                </identity>
            </endpoint>
            <endpoint address="mex" binding="mexHttpBinding" contract="IMetadataExchange" />
        </service>
    </services>
</system.serviceModel> 
```

这不是第一次发生这种情况，我猜这是配置问题。但是每次我通常只是把我的服务吹走，然后把它放回去或者创建一个新的服务项目。然后一切都很好。如果有人有任何想法，那就太棒了。谢谢。

**

> 更新：我已经添加了评论，以便我对这个问题进行更多的故障排除。当答案可用时，如果答案未发布，我会将其添加为官方“答案”。

**

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-10-24T17:46:50.900

我找到了答案

好的，不确定它是否是 kewl 回答我自己的问题，但我们开始吧。出于某种原因，需要使用 [EnumMember] 属性标记枚举，如下所示：

```
[DataContract]
public enum Priority
{
    [EnumMember]
    Low,
    [EnumMember]
    Medium,
    [EnumMember]
    High
} 
```

一旦我这样做了，就可以调用我的测试和服务而不会发生错误。我仍然不确定为什么会显示该特定错误。该错误似乎与发生错误的功能原因没有任何关联，但此修复肯定使一切顺利。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-01-07T08:44:59.960

正如您自己所指出的，如果您将枚举标记为 DataContract，那么您也必须标记这些项目。

作为替代方案，您可以像这样在枚举之前删除 [DataContract]：

```
public enum Priority
{    
  Low,    
  Medium,    
  High
} 
```

这也可以，因为在这种情况下，WCF 自己处理枚举。如果您将其标记为 [DataContract]，则必须按照您自己注意到的方式标记每个项目。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2011-10-19T07:17:18.583

返回大型有效负载时出现此错误，结果是 DataContractSerialiser 停止了中间流，因为它已达到默认的 maxItemsInObjectGraph 设置，将以下内容添加到我的端点行为修复了问题

```
<dataContractSerializer maxItemsInObjectGraph="2147483647" /> 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-24T03:37:25.980

确保没有任何不是 FaultException 的东西被抛出并传回给客户端。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2011-08-23T00:16:03.870

我在使用 LINQ 和 Select、Where 等调用时注意到了这一点，而无需立即调用 .ToList() 或 ToArray()。迭代器会给你带来麻烦。它们不是 WCF 知道如何使用的原生类型，如 List、Array 等。它们的类型是 WhereEnumerable 或其他类型。从 NHibernate 或实体框架发回结果时请记住这一点。希望这可以帮助某人。我花了几个小时才弄清楚。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2012-04-12T05:13:47.787

如果其他人也在这样做，我将 linq 生成的对象列表返回到 sql / dbml 文件。我只需要在 dbml 文件中启用序列化：

[http://blogs.msdn.com/b/wriju/archive/2007/11/27/linq-to-sql-enabling-dbml-file-for-wcf.aspx](http://blogs.msdn.com/b/wriju/archive/2007/11/27/linq-to-sql-enabling-dbml-file-for-wcf.aspx)

干杯

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2013-09-06T07:53:01.990

就我而言，我的数据合约有一个 [datamember] 属性，它没有 set 方法。我使用 WCF 跟踪来获取真正的错误。[https://stackoverflow.com/a/4271528/463425](https://stackoverflow.com/a/4271528/463425)。我希望这可以帮助别人。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-24T02:53:27.033

我可能会走得很远，但这可能是一个安全问题......我以前遇到过这个错误，我解决了它......但我花了几天时间试图解决很多不同的错误。

我有一个示例文章做一些基本的事情，但我在这里使用 net.tcp（安全设置为“无”）：[Duplex WCF Services Hosted in IIS Using Net.Tcp](http://www.singingeels.com/Articles/Duplex_WCF_Services_Hosted_in_IIS_Using_NetTcp.aspx)

另外，你在哪里得到错误......它是在“.Close（）”行还是“.GetTasks（）.ToString（）”行？

您可以检查的另一件事是简单地在端口 9999 上 telnet 到 localhost，以查看该服务是否完全在侦听传入连接。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2010-04-07T14:27:37.440

有时，这个错误可能非常具有误导性。常见 WCF 异常：当文化设置不正确或字符串格式设置不正确时，可能会发生连接意外关闭。

以下失败：

```
new DateTime(adate.Year, adate.Month, firstday).ToString("d", cultureInfo); 
```

虽然这有效：

```
CultureInfo culture = new CultureInfo(this.aculture.Name);               
Convert.ToString(new DateTime(adate.Year, adate.Month, firstday), culture); 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2012-09-18T08:54:02.240

另一个原因：如果你有`DataContract/DataMember`属性`Interface`而不是具体类型（[糟糕的想法](https://stackoverflow.com/questions/3720474/why-cant-my-operation-contracts-in-my-wcf-client-take-interfaces-as-parameters)，不要这样做）并且你试图序列化`Concrete type`.

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2012-12-18T15:26:10.010

就我而言，我正在返回一个自定义类对象，其中一个成员是数据表。如果您在数据表上没有名称，则会引发此错误。

```
Dim oTable As DataTable = New DataTable 'this wont serialize
Dim oTable As DataTable = New DataTable("MyTable")  'this will serialize 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2012-03-01T21:11:34.393

该线程上的某人发布了将此元素添加到端点行为解决了该问题。

```
<dataContractSerializer maxItemsInObjectGraph="2147483647" /> 
```

这行得通，但它不仅必须添加到端点行为中，还必须添加到服务行为中（这是有道理的，因为那是序列化发生的地方）。

如果仅将其添加到服务中，我会收到此错误“对象图中可以序列化或反序列化的最大项目数为 '65536'。更改对象图或增加 MaxItemsInObjectGraph 配额。”

如果仅添加到端点，我仍然会收到连接意外关闭错误。

# selecteditem - 所选文件的外壳扩展名

> ID：232083
> 
> 赞同：2
> 
> 时间：2008-10-24T00:22:48.150
> 
> 标签：selecteditem, shell-extensions

有没有办法知道在 Windows 资源管理器中选择了哪个文件？我一直在看这里发布的教程[Idiots guide to ...](https://stackoverflow.com/questions/140312/tutorial-for-windows-shell-extensions)但描述的操作是：

徘徊

语境

菜单属性

拖

拖放

我想知道是否有在选择文件时调用的方法。例如创建文件的缩略图视图。

谢谢。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-10-24T01:02:13.263

我遇到了这个python脚本。

```
from win32com.client.gencache import EnsureDispatch 

for w in EnsureDispatch("Shell.Application").Windows(): 
    print w.LocationName + "=" + w.LocationURL 
```

但我只得到打开的文件夹，而不是该文件夹中当前选定的项目。

有人有更多信息吗？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-24T10:58:00.270

这是我在 AutoHotkey 中的操作方式：

```
GetWindowsExplorerSelectedFile(_hWnd)
{
    local selectedFiles, file

    ; I can send ^C and parse Clipboard, but this way don't mess with clipboard at all, seems nicer.
    ; Warning: with this, you get only what is displayed in Explorer!
    ; If you kept the default Windows setting of not displaying file extensions (bad idea...),
    ; you will get partial file names...
    ControlGet, selectedFiles, List, Selected Col1, SysListView321, ahk_id %_hWnd%
    Loop, Parse, selectedFiles, `n  ; Rows are delimited by linefeeds (`n).
    {
        If (A_Index = 1)
        {
            file := A_LoopField
        }
        Else
        {
            ; Indicate that several files are selected, we return only the first one
            ; but count the total number of selected files, to indicate we return a partial result
            ErrorLevel := A_Index
        }
    }
    Return file
} 
```

我从资源管理器的编辑字段中获取路径（这很容易出现问题！可以不存在或可以设置为不显示完整路径）。

其核心思想是询问Explorer的SysListView32控件有哪些被选中的项，并得到它们。

现在，这是一个黑客，可能有更清洁的方法......

PS.：还发现了这个：[使用 SendMessage 从 SysListView32 获取 C# 中的 ListView 项目](http://bytes.com/forum/thread258027.html "使用 SendMessage 从 SysListView32 获取 C# 中的 ListView 项目")
需要一些巫术来让它在另一个进程上工作......

[法国网站](http://www.developpez.net/forums/d225760/general-developpement/programmation-windows/lire-items-syslistview32-process/#post1446286)上的真实代码！

# .net - 向 MembershipProvider 添加额外的属性

> ID：232084
> 
> 赞同：4
> 
> 时间：2008-10-24T00:22:54.950
> 
> 标签：.net, asp.net, asp.net-membership

我正在使用 SqlMemberShipProvider，它运行良好，但我希望 MembershipUser 有一些额外的属性，例如名字、姓氏、电话号码等。最好的方法是什么？我是否必须创建自定义会员提供程序，或者是否有更好的方法向用户添加附加功能？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-24T00:45:36.607

关于用户的附加信息正是[ProfileProvider](http://msdn.microsoft.com/en-us/library/2y3fs9xs.aspx)的用途。您可以在 web.config 文件中指定您想要的额外属性，并且默认提供程序（[SqlProfileProvider](http://msdn.microsoft.com/en-us/library/system.web.profile.sqlprofileprovider.aspx)，如果您要保持当前使用的 SQL）将为您处理持久性。

这是有关[如何构建示例](http://msdn.microsoft.com/en-us/library/8zs47k7y.aspx)的链接。

# silverlight - 带有 Silverlight 的图像滑块

> ID：232100
> 
> 赞同：2
> 
> 时间：2008-10-24T00:33:24.540
> 
> 标签：silverlight, silverlight-2.0

我需要使用 Silverlight 创建一个图像滑块。我首先需要显示 5 张图像。将有上一个和下一个按钮。当我单击下一个按钮时，将显示另外 5 个新图像来代替以前显示的图像。有人可以告诉我解决方案吗？

有人请帮助我。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-24T00:40:13.653

看一下这个。 [Silverlight 2 中的图像滑块控件](http://www.silverlightshow.net/items/Image-slider-control-in-Silverlight-1.1.aspx)

Slide.Show 2 - 来自[Vertigo](http://www.vertigo.com/slideshow.aspx)的另一个很酷的示例。源代码可在[codeplex](http://www.codeplex.com/SlideShow2)获得。

# tfs - TFS 的源代码控制只是增强了 VSS 还是有显着不同？

> ID：232116
> 
> 赞同：5
> 
> 时间：2008-10-24T00:44:45.000
> 
> 标签：tfs, visual-sourcesafe

我的工作场所正计划迁移到 Team Foundation Server，现在还为时过早 - 任何可以摆脱 Visual SourceSafe 的癌症。

但是，我必须问 - TFS 中的源代码控制是否与 VSS 显着不同（并且更好），或者它只是同一事物的“增强”版本？

我现在问这个，因为这可能是我最后一个建议像 Subversion 这样的窗口。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-24T01:14:28.997

在过去的 18 个月里，我们一直在使用 TFS，并且像许多产品一样，第一个版本还有一些不足之处（TFS 2005 最喜欢的一个是它说它有最新版本，导致很多构建中断） .

但是现在我们在 TFS 2008 SP1 上运行得非常好。源代码控制系统快速直观，并与 Visual Studio 无缝集成。对于像重命名、移动、分支和合并这样的事情，它在跟踪事物的能力和合并分支的能力方面很容易超过其他工具，例如 Subversion。

不管别人怎么说，TFS 源代码控制和 VSS 之间根本没有可比性。而且您也不必担心您的存储库被损坏！

唯一看起来仍然很明显的问题是，每隔几周 TFS 就会变慢并且获取最新版本需要很长时间，需要重新启动 SQL Server 才能修复。我不知道这是为什么。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-24T00:56:43.400

TFS 源代码控制以 SQLServer 为后端。我过去使用过 CVS 和 SVN，而 TFS 源代码控制为我提供了所需的一切。请注意，我没有做很多分支，主要是带有发布标签的直线开发。我与多个开发人员一起使用过它，我喜欢合并功能——并排的 GUI 允许我选择应用哪个版本的冲突。我还没有遇到任何无法解决的问题。我很高兴我没有在寻找其他任何东西。我更喜欢它而不是 VSS。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-24T01:14:26.330

我对 TFS 和 VSS 都有第一手经验。TFS 和 VSS 之间唯一的共同点是解决方案资源管理器中用于显示文件状态的图标。

TFS 是一个优秀的源代码控制和项目管理解决方案。它可以支持敏捷实践并附带对 CI 和测试的支持。它以 SQL 为后盾，既健壮又快速。如果你想使用 SVNBridge，你可以有 SVN 风格的访问。它的扩展性非常好，可以处理大型项目。TFS 团队实际上对这个进行了测试，并取得了巨大的成功。它的主要缺点是成本和学习曲线。

VSS 可能是我在源代码控制方面见过的最糟糕的尝试，我认为使用在旧磁带驱动器上备份的夜间 zip 文件比使用 VSS 更好。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-25T11:52:24.003

Sourcesafe 推荐用于五人或更少的团队。

TFS 受到 MS 的大力支持，因为他们将它用于越来越多的项目和成千上万的用户。为什么它更健壮有很多细节，但这应该说明两者之间的范式步骤。

自 2006 年初以来，我一直在使用 TFS，我发现的所有故障都是 PEBCAK。它非常可靠。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-24T00:59:03.833

对于初学者，您可以让多个人签出相同的文件（但是仍然可以选择专门签出）。

存储是数据库驱动的，而不是文件驱动的。对我来说，这使得搜索代码库变得更加困难，但它允许更容易的合并和注释（谁编写了这行代码？）。

TFS 不仅仅是源代码控制。任务管理、签到政策，[不胜枚举](http://msdn.microsoft.com/en-us/library/ms242904(VS.80).aspx)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-24T00:58:56.283

我没有 TFS 的第一手经验，但我使用过源安全和 svn。从我所读到的，你的答案是肯定的，是的。您绝对可以感受到源代码安全历史，但同时它是一个现代系统，具有您期望的功能，然后是一些功能（它也做了很多项目管理工作）。

# php - PHP 中添加了额外的反斜杠

> ID：232140
> 
> 赞同：5
> 
> 时间：2008-10-24T00:59:48.700
> 
> 标签：php, apache, escaping, mediawiki

前几天我[糟糕]的网络主机做了一些升级，一些设置出错了，因为查看我们公司的 wiki (MediaWiki)，每个引用都用反斜杠转义。受影响的不仅仅是发布的数据（即文章），还有标准的 MediaWiki 文本。例如，

> 您已经点击了一个链接，该链接指向一个尚不存在的页面。要创建页面，请开始在下面的框中输入（有关更多信息，请参阅帮助页面）。如果您不小心在这里，只需单击浏览器的\'\'\'返回\'\'\' 按钮。

我做的第一件事是禁用`magic_quotes_gpc`并`magic_quotes_runtime`使用`.htaccess`文件，但这仍在发生。我的`php_info()`报告如下：

```
Setting             Local Value   Master Value
magic_quotes_gpc        Off            On
magic_quotes_runtime    Off            On
magic_quotes_sybase     Off            Off 
```

有任何想法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-24T04:04:05.503

您可能需要确认数据库中的数据没有损坏。如果您在打开了magic_quotes 时对您的数据进行了addslash()，那么您将对进入数据库的数据进行双斜线处理。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-24T01:57:40.377

您需要让他们更改主值，或自己处理。我不相信您可以`magic_quotes_gpc()`在运行时设置超级全局变量。（在运行时设置它会剥离数据库/文件之类的东西，但不会剥离全局变量。）

```
if (ini_get('magic_quotes_gpc') ) {
  foreach($_GET as $key=>$value) {
    $_GET[$key] = stripslashes($value);
  }
} // etc... 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-24T07:58:37.637

如果 PHP 标志使用`php_admin_flag`/设置`php_admin_value`，则不能从`.htaccess`文件中更改它。这让我之前有些头疼。在运行时禁用它`php.ini`或撤消魔术引号：http: [//talks.php.net/show/php-best-practices/26](http://talks.php.net/show/php-best-practices/26)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-24T01:03:29.330

也许还有别的东西在调用 set_magic_quotes_runtime()。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-11-04T07:51:17.573

我在显示时使用 stripslases() 删除斜杠。

[http://www.php.net/manual/en/function.stripslashes.php](http://www.php.net/manual/en/function.stripslashes.php)

# sql-server - 存储过程 - 天数结束

> ID：232141
> 
> 赞同：31
> 
> 时间：2008-10-24T01:00:23.317
> 
> 标签：sql-server, stored-procedures

我正在收听 Hanselminutes 播客；“StackOverflow 使用 ASP.NET MVC - Jeff Atwood 和他的技术团队”。在 Podcast 的过程中，他们谈到了 SQL 服务器，并说了一些类似“存储过程的日子已经结束”的内容。

现在我不是 DBA，但这让我有点意外。我一直认为 SP 是追求速度（因为它们被遵守）和安全性的方式，更不用说可扩展性和可维护性了。如果情况并非如此，并且 SP 已处于最后阶段，那么将用什么替代它们或者我们将来应该做什么？

* * *

## 回答 #1

> 赞同：42
> 
> 时间：2008-10-24T01:29:13.397

也许我太老派了，或者太懒了，或者两者兼而有之，但我不得不不同意。存储过程一次又一次地“挽救了局面”，因为当后端出现较小的更改或错误时，*我们只需修复存储过程*，而不是更新几十个桌面和 Web 服务器上的桌面应用程序。此外，用户不会被打断。这节省了大量的精力和用户的麻烦。

此外，一些数据库操作只会在服务器上更有效，而不是在网络上来回进行，尤其是。当一个存储过程调用另一个调用另一个等时（有或没有游标）

编辑：在 SOA 架构中，更新客户端应用程序问题得到了缓解（感谢 maud-dib），但相互调用的存储过程仍然比到 SOA 层的多个网络往返更有效。并且更新 SOA 层也并非总是微不足道的。

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2008-10-24T01:03:56.053

在现代系统上，参数化查询在服务器上进行编译和缓存，因此它们与存储过程一样快。它们也具有大多数相同的安全功能。

对于服务于单个应用程序的数据库，将查询逻辑放在代码中的相关位置更有意义。如果不出意外，它可以更轻松地进行源代码控制。如果您在服务器上保留存储过程，跟踪它们很快就会变得一团糟。此外，如果您使用的是 ORM 工具，那么无论如何您可能没有太多真正的 SQL 方式。

如果您的数据库服务于多个不同的应用程序，那么您可能仍希望使用存储过程来执行应用程序之间的业务规则。

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2008-10-24T01:06:16.283

我会说 SP 不可维护且不可扩展。询问任何必须向 SP 繁重的系统添加功能的开发人员。为什么将一半的逻辑放在不同的层中？没有什么可以替代的，只是不要使用它们。

[谷歌搜索了这篇很棒的帖子。](http://www.tonymarston.net/php-mysql/stored-procedures-are-evil.html)

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2008-10-24T03:31:03.590

我经常听到这样的论点，即如果您有多个应用程序连接到数据库，SP 就很好，或者它使错误修复更容易。

这就是服务层的用途！

业务逻辑进入服务层，应用程序逻辑进入应用程序/网站。

调试和维护数百个 SP（尤其是如果生成了）比维护编写良好的代码（通过 ORM 工具与 DB 对话）要困难得多。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2008-10-24T01:03:59.657

如果您只关心速度，SP 可能是要走的路。但如果您关心可扩展性或可维护性，SP 可能不是最好的。我们的架构是建立在 SP 之上的，经过 10 年的代码，它很难维护，而且有很多 bug。一个好的 ORM 映射器可能是一个更好的选择。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2008-10-24T04:14:00.443

**可维护性** 可能 SP 更好。如果维护数百个 SP 很困难，那么在业务层组件中维护它们就更难了。

**查询的性能** 缓存可能会产生接近 SP 的性能。但它们无法在各种平台的各种数据库中匹配 SP 的性能。网络延迟是另一个值得关注的领域，尽管如今差距正在缩小。

**使用 SP 进行调试** 可能比调试业务层 + 数据库层放在一起要容易得多。

使用 SP 可以有更多的 +ve 点。

但看看现代编程趋势，出于大量业务原因，使用“N”层架构比坚持“旧”基于 SP 的方法更“明智”。

好的系统应该两者兼而有之。大概遵循80-20原则，20是SP。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-01-13T05:37:51.183

*存储过程对于非*CRUD的东西很有用——例如最好在数据库中执行的专门的跨表逻辑。CRUD 操作不应使用 SP，除非它们是 ORM 工具（如 TableAdapters）的自动生成的输出。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-10-24T15:38:29.007

双方都提出了一些好的观点（事实上），但没有人对安全性产生太大影响。在 SP 中封装所有数据库交互意味着您可以锁定数据库，以便可以严格控制与数据的任何交互。

如果您想到封装，您可以将 DB 视为一个对象，将 SP 视为将对象功能暴露给外界的方法和属性。

在一些较大的开发环境中，不允许 UI 和业务层开发人员靠近 DB。他们指定他们的要求，而单独的团队通过 SP 提供和接口。

有一些不使用 SP 的充分理由和一些只使用它们的充分理由 - 取决于您的应用程序和您的环境。但请放心，SP 不会很快消失。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-10-24T03:16:40.687

当您将 SP 与逻辑与数据库本身结合起来时，您可以有效地将数据库转换为类似于应用程序服务器的东西。

回到当这是最方便的锤子时，它很有意义。但是现在随着应用程序服务器的普遍可用性，将它们用于集中逻辑和业务规则等事情并仅依赖数据库进行持久性更有意义。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2008-10-24T01:21:38.263

ORM 和 LINQ to SQL 似乎是当前替代 StoredProcs 的趋势。

我个人使用过 ORM，发现它更容易维护和支持。

使用存储过程的一些原因从没有正当理由开始。

当您为多个应用程序提供服务时，您确实对存储过程提出了很好的看法；它们本质上变成了 DAL，通常在其中包含一些业务逻辑。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-10-24T03:22:27.600

从这个网站的低迷性能来看，我敢打赌主要的瓶颈是数据库。

我不相信他们使用的 LINQ 2 SQL ORM 比 sproc 快一点。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-10-24T08:13:22.800

是不是 Jeff Atwood*知道*存储过程将永远存在，而只是试图激发思考和辩论？我喜欢认为他真正想做的是写一篇有说服力的文章，题为“被认为有害的存储过程”:)

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-10-29T04:04:54.447

这部分是由非关系数据存储的可用性驱动的。SPs 通常意味着关系数据库；ORM 和 Linq 提供了创建比 SQL 提供的更丰富的抽象层的能力，并且有时可以更好地匹配我们在设计的其他部分中使用的抽象（“阻抗不匹配”问题。）

它也可以被认为是架构的功能。恕我直言，SP 与经典的表驱动应用程序非常匹配，并且可以提供一种在业务对象级别构建抽象层的便捷方法。

如果您的数据存储是 xml 或分析数据库，它们就不那么方便了。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-10-24T03:26:59.760

SP 通常在开发过程中使用得太早。当你有一个瓶颈 sql 语句时，应该使用它们。例如，您可能不需要 SP 来删除或创建应用程序的用户。对于大多数公司来说，这应该是相当静态的。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2008-10-24T01:33:03.513

它还取决于您的存储过程在做什么。

例如，如果它只是

```
select a from b where x = y 
```

那么存储过程可能是矫枉过正。但我个人倾向于使用存储过程在数据库中返回多个结果集和页面结果。

在我的情况下，我可以看到使用它们的好处。这是一个额外的处理层，但如果您的代码组织良好且符合逻辑，我个人认为不会有太多麻烦。

一个有存储过程的好项目总是比一个没有存储过程的劣质项目好，反之亦然。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2008-10-24T01:37:40.277

只是在这里提出我的小建议。在 SQL 2005 之前（可能比这更远），SP 更快。但是，SQL Server 2005 及更高版本经过了真正的优化，可以随时缓存您的查询。事实上，我们已经将一个 Web 应用程序转移到了一个新的 SQL 服务器上。该应用程序开始时每个人都运行缓慢。一切都需要“3/4 秒”或 1 秒才能运行。然后 SQL 开始编译最常用的查询，一切都从慢到快。

当然，当有很多人在上面运行时，我们交换了服务器（这可以解释为什么一开始它很慢）。但是相信我。SP还没有结束。除了绑定到应用程序之外，它们还有其他用途。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2008-10-24T02:02:56.277

这个问题也渗入[了今天早些时候发布的一个](https://stackoverflow.com/questions/230668/stored-procedures-vs-parameterized-queries#230683)问题。

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2008-10-29T03:34:07.723

我可能会补充一点，在数据库级别可以更好地完成一些工作。
例如，SQL 2005 中的交叉表结果，递归查询。

我同意一些简单的东西，如 SELECT、INSERT、UPDATE、DELETE 可以由 ORM、Linq 处理。

因此，说存储过程的时代已经结束是愚蠢的。
有多少人真正需要担心数据库平台的变化（SQL 到 Mysql、Oracle）？

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2009-01-13T05:05:55.320

如果您正在运行共享同一个数据库的多个企业应用程序，存储过程/视图/函数仍然是数据库的一个很好的“接口”。

App#1 - 您需要添加新的关系/字段，或将可为空的列更改为非空。

App#2-10 - 可以使用也可以不使用这个数据库对象

我要做的第一件事是检查我的数据库对象依赖关系以确定它的使用方式以及是否会破坏任何东西。好吧，你猜怎么着，如果你有一堆通过 ORM / SQL 的外部查询，你将不知道依赖关系。

这是我发现可以直接访问表的唯一缺点。

对于使用单个数据库的单个应用程序，这确实不是问题。尽管除了数据库之外，您仍然需要查看依赖项的应用程序代码。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2009-01-13T04:16:37.820

呸!

ORM、SP、View、Magic Wands 或其他任何东西。

每个“工具”在你的腰带上都有它的位置，明智地使用你拥有的工具。

唯一“改变”（真正改进）的是一些 ORM 已经内置了很好的缓存工具，并且 MySql 和 Sql 2005+ 可以处理动态或临时查询/执行计划缓存。

在您的数据库服务器上抛出各种动态 sql 的潜在性能损失已经有所缓解。现在没有存储过程更容易。存储过程不会去任何地方。

# php - 如何从另一个表中获取每个值的计数？

> ID：232144
> 
> 赞同：1
> 
> 时间：2008-10-24T01:01:43.657
> 
> 标签：php, mysql

我有一个列出所有志愿者的志愿者_2009 表和一个列出志愿者可以分配到的场所的场所表，它们只分配给一个。

我想做的是打印出分配到每个场地的志愿者人数。

我希望它像这样打印出来：

地点名称：志愿者人数

表：志愿者_2009 列：id、name、`venue_id`

表：场地列：id，场地名称

他们通过`volunteers_2009.venue_id = venues.id`

这就是我所拥有的，但它无法正常工作。

```
$sql = "SELECT venues.venue_name as 'Venue', COUNT(volunteers_2009.id) as 'Number Of 
Volunteers' FROM venues ven JOIN volunteers_2009 vol ON 
(venues.id=volunteers_2009.venue_id) GROUP BY venues.venue_name ORDER BY
venues.venue_name ASC";

$result = mysql_query($sql);

while(list($name,$vols) = mysql_fetch_array($result)) {
    print '<p>'.$name.': '.$vols.'</p>';
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-24T01:07:56.827

不是 MySQL 的人，所以这可能真的是错误的，但是当你给你的表一个别名时，你不需要用那个名字来引用它。

```
$sql = "SELECT ven.venue_name as 'Venue', COUNT(vol.id) as 'Number Of 
Volunteers' FROM venues ven JOIN volunteers_2009 vol ON 
(ven.id=vol.venue_id) GROUP BY ven.venue_name ORDER BY ven.venue_name ASC"; 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-24T01:13:09.577

```
$query = "SELECT ven.venue_name AS 'Venue', count(*) AS 'Number of venues'
         FROM volunteers_2009 AS vol, venues AS ven WHERE vol.venue_id = ven.id 
         GROUP BY ven.venue_name"; 
```

# c++ - 在 Visual Studio 2005 中调试多项目 (C++) 解决方案

> ID：232161
> 
> 赞同：1
> 
> 时间：2008-10-24T01:09:22.097
> 
> 标签：c++, visual-studio-2005, visual-c++-2005

我目前正在开发一个应用程序，该应用程序由五个通过 ActiveMQ 通信的独立可执行文件组成。我有一个包含五个可执行项目的 Visual Studio 解决方案。其中一个项目（launcher.exe）从它们的本地文件夹作为单独的进程启动其他四个项目。因此，启动器项目被设置为“启动项目”，因此，由于我对 VS2005 的了解有限，它是我唯一可以设置断点和调试的项目。

如果启动器项目是从 VS 执行的唯一项目，有没有办法在我的单个 VS 解决方案中跨我的五个 c++ 项目设置多个断点并同时调试它们？

***注意：*** *不能通过 Visual Studio 手动启动每个项目的新实例，因为它们的执行需要由 launcher.exe 同步。*

如果这很复杂，我很抱歉，这是我能解释的最好的。在此先感谢您的帮助！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-24T01:14:09.637

您需要的是工具菜单中的：附加到进程。这为您提供了一个正在运行的进程列表，并允许您将调试器附加到这些进程。

对于本地调试，Transport 和 Qualifier 应保持其默认值。列表上方的 Attach To 值决定了您将执行哪种类型的调试（本机或托管是最常见的类型），通常调试器也可以在这里找到一个好的默认值。

主要有趣的部分是进程列表 - 在此列表中查找要调试的子进程。找到并选择进程后，单击右下角的附加（或直接双击进程），调试器将附加到该进程并开始调试它。

您可能还希望启用“调试位置”工具栏，它提供了一种将调试器的焦点更改为您附加到的各种进程和线程的方法。在一个 Visual Studio 实例中进行多进程调试可能会很棘手，因此您始终可以考虑启动单独的实例来调试每个不同的进程。

另一个棘手的方面可能是调试子流程的初始启动。通常，您要调试的事情发生在您可以附加调试器之前，因此您需要一些方法来使进程等待您准备好。在 C++ 中执行此操作的一种简单方法是使用 IsDebuggerPresent 函数。尝试将此代码添加到 main() 函数（或等效函数）的开头：

```
while( !IsDebuggerPresent() )
    Sleep( 500 ); 
```

或者试试这个 C# 代码：

```
while( !System.Diagnostics.Debugger.IsAttached )
    System.Threading.Thread.Sleep( 500 ); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-24T01:15:00.760

您可以通过手动运行启动器（在 Visual Studio 之外，或使用 <ctrl-f5>）来一次选择一个，然后在启动后附加到要调试的进程。如果它是您解决方案中的项目之一，您可以设置断点，当您附加调试器时它们会被拾取。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-24T02:11:56.307

[您知道吗……您可以开始调试多个项目？- #268](http://blogs.msdn.com/saraford/archive/2008/07/28/did-you-know-you-can-start-debugging-multiple-projects-268.aspx)

# python - 如何为python代码做Makefile依赖

> ID：232162
> 
> 赞同：8
> 
> 时间：2008-10-24T01:09:24.593
> 
> 标签：python, makefile, dependencies

我有一堆 C 文件，它们是由一组具有许多共享 python 模块的 python 程序生成的，我需要在我的 make 系统中考虑到这一点。

枚举需要运行哪个 python 程序来生成每个 C 文件很容易。我找不到一个好的解决方案是确定这些程序依赖于哪些其他 python 文件。我需要这个，所以如果共享的 python 文件之一发生更改，make 将知道需要重新生成什么。

是否有一个很好的系统可以从 python 源的集合中生成样式依赖规则？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-24T03:24:37.393

[modulefinder](http://docs.python.org/library/modulefinder.html)可用于[获取依赖图](http://www.tarind.com/depgraph.html)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-24T01:50:50.920

这些`import`语句几乎是所有依赖项。导入语句有两种相关形式：

```
import x, y, z
from x import a, b, c 
```

您还需要用于构建的`PYTHONPATH`和信息。这显示了模块和包的物理位置。`sites``sys.path`

处理起来有点痛苦，因为您必须对您导入的所有模块中的所有导入进行传递闭包。

作为替代方法，您可以使用该`-v`选项来获取导入和物理文件的完整列表。这会生成一个日志，您可以将其编辑到一个平面依赖列表中。

例如，当我这样做时

```
>>> import math 
```

我在日志中看到了这个

```
dlopen("/Library/Frameworks/Python.framework/Versions/2.5/lib/python2.5/lib-dynload/math.so", 2);
import math # dynamically loaded from /Library/Frameworks/Python.framework/Versions/2.5/lib/python2.5/lib-dynload/math.so 
```

# apache - 为什么 Apache 对 ant 的 get 任务返回 503 错误，但对我的浏览器却没有？

> ID：232168
> 
> 赞同：1
> 
> 时间：2008-10-24T01:11:50.563
> 
> 标签：apache, http, ant

我正在尝试使用 get 属性获取带有 ant 的文件。我正在运行 apache 2，我可以使用 wget 和 firefox 从指定的 URL 获取文件，但是 ant 给了我以下错误：

```
[get] Error opening connection java.io.IOException:
 Server returned HTTP response code: 503 for URL: http://localhost/jars/jai_core.jar 
```

这就是我在 build.xml 中所做的：

```
<get src="http://localhost/jars/jai_core.jar"
     dest="${build.dir}/lib/jai_core.jar"
     usetimestamp="true"/> 
```

知道可能出了什么问题吗？

**编辑：**关于某事。当我提供我的盒子的完整主机名而不是 localhost 时，它可以工作。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-24T01:39:42.330

503 是*Service Unavailable*，这可能意味着`src`URL 没有被正确解释并由 ANT 任务或 JRE 发送。

以下是一些可以尝试的事情：

*   **与往常一样，使用 ANT，使用-verbose**执行尽可能小的 build.xml以查看是否提供更多信息，使用**-debug**获取更多信息。

*   尝试`verbose="true"`任务的属性。

*   使用“ [http://127.0.0.1/jars/jai_core.jar](http://127.0.0.1/jars/jai_core.jar) ” - 根据正在执行的 Java 运行时 ANT 的版本，“localhost”可能无法正确解析。

*   删除该`usetimestamp`属性只是为了查看它是否会改变行为。

*   使用另一个基于 Java 的应用程序尝试执行 GET 并比较结果。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-24T02:26:01.223

HTTP 请求可能正在通过拒绝请求的代理。或者`ant`，可能没有在应该使用的地方使用代理。

# asp.net - 查看服务器上的客户端控件

> ID：232170
> 
> 赞同：0
> 
> 时间：2008-10-24T01:12:13.540
> 
> 标签：asp.net, asp.net-ajax

我刚刚开始使用整个 ajax，我需要一些帮助。我有一个表单，用户可以在其中将多个电子邮件地址添加到记录中。当用户单击添加新电子邮件地址时，我将执行一个 ajax 调用，该调用将插入电子邮件地址，然后显示当前电子邮件以供编辑。听起来不错，但我唯一的问题是当表单提交时，我希望能够访问这些值服务器端，以及存储数据库中的序列号，以便可以在最终提交时更新电子邮件。在转发器中，我会将序列号存储在隐藏字段中，然后遍历项目，但是当我不使用转发器时，我不能这样做。由于网络流量大，我想避免使用更新面板。我想我可以使用请求。表单集合，但是如何以用户看不到它们的方式存储序列号？我完全不在基地吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-10-24T01:24:02.673

为什么你不能使用隐藏字段呢？只要它们在`form`元素内部，它们在哪里都没有关系，不是吗？

例如，假设您的电子邮件字段具有`name`“email_1”、“email_2”等属性集。您可以`name`为隐藏字段设置“seq_email_1”、“seq_email_2”...

然后您可以遍历 Request.Form 并阅读电子邮件和序列号：

```
foreach (string key in Request.Form.AllKeys) {
    if (key.StartsWith("email_")) {
        string email = Request.Form[key];
        int seq = int.Parse(Request.Form["seq_" + key]);

        // process email with seq number
    }
} 
```

# c# - 如何构建与通用对象进行比较的 Linq 表达式树？

> ID：232171
> 
> 赞同：4
> 
> 时间：2008-10-24T01:12:16.037
> 
> 标签：c#, linq, entity-framework, generics, expression-trees

我有一个 IQueryable 和一个 T 类型的对象。

我想做 IQueryable().Where(o => o.GetProperty(fieldName) == objectOfTypeT.GetProperty(fieldName))

所以 ...

```
public IQueryable<T> DoWork<T>(string fieldName)
        where T : EntityObject
{
   ...
   T objectOfTypeT = ...;
   ....
   return SomeIQueryable<T>().Where(o => o.GetProperty(fieldName) == objectOfTypeT.GetProperty(fieldName));
} 
```

仅供参考，GetProperty 不是有效函数。我需要执行此功能的东西。

我是周五下午的大脑融化了还是这是一件复杂的事情？

* * *

objectOfTypeT 我可以执行以下操作...

```
var matchToValue = Expression.Lambda(ParameterExpression
.Property(ParameterExpression.Constant(item), "CustomerKey"))
.Compile().DynamicInvoke(); 
```

效果很好，现在我只需要第二部分：

return SomeIQueryable().Where(o => **o.GetProperty(fieldName)** == matchValue);

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-24T03:57:18.670

像这样：

```
 var param = Expression.Parameter(typeof(T), "o");
    var fixedItem = Expression.Constant(objectOfTypeT, typeof(T));
    var body = Expression.Equal(
        Expression.PropertyOrField(param, fieldName),
        Expression.PropertyOrField(fixedItem, fieldName));
    var lambda = Expression.Lambda<Func<T,bool>>(body,param);
    return source.Where(lambda); 
```

我已经开始了一个博客，它将涵盖许多表达主题，[here](http://marcgravell.blogspot.com/)。

如果您遇到任何问题，另一种选择是从`objectOfTypeT`第一个（使用反射）中提取值，然后在 中使用该值`Expression.Constant`，但我怀疑“原样”会很好。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-24T02:29:03.247

从我目前所看到的情况来看，它必须是......

```
IQueryable<T>().Where(t => 
MemberExpression.Property(MemberExpression.Constant(t), fieldName) == 
ParameterExpression.Property(ParameterExpression.Constant(item), fieldName)); 
```

虽然我可以编译它，但它并没有完全按照所需的方式执行。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-04-04T19:14:43.420

关于什么：

```
 public class Person
    {
        public string Name { get; set; }
        public int Age { get; set; }

    }

    public Func<T, TRes> GetPropertyFunc<T, TRes>(string propertyName)
    {
        // get the propertyinfo of that property.
        PropertyInfo propInfo = typeof(T).GetProperty(propertyName);

        // reference the propertyinfo to get the value directly.
        return (obj) => { return (TRes)propInfo.GetValue(obj, null); };
    }

    public void Run()
    {
        List<Person> personList = new List<Person>();

        // fill with some data
        personList.Add(new Person { Name = "John", Age = 45 });
        personList.Add(new Person { Name = "Michael", Age = 31 });
        personList.Add(new Person { Name = "Rose", Age = 63 });

        // create a lookup functions  (should be executed ones)
        Func<Person, string> GetNameValue = GetPropertyFunc<Person, string>("Name");
        Func<Person, int> GetAgeValue = GetPropertyFunc<Person, int>("Age");

        // filter the list on name
        IEnumerable<Person> filteredOnName = personList.Where(item => GetNameValue(item) == "Michael");
        // filter the list on age > 35
        IEnumerable<Person> filteredOnAge = personList.Where(item => GetAgeValue(item) > 35);
    } 
```

这是一种在不使用动态查询的情况下通过字符串获取属性值的方法。缺点是所有值都将被装箱/拆箱。

# version-control - 在初始无根据的合并后，我可以使用 Team Explorer 来合并两个分支之间的更改吗？

> ID：232172
> 
> 赞同：4
> 
> 时间：2008-10-24T01:12:23.837
> 
> 标签：version-control, tfs, merge, branch

我对 TFS 中毫无根据的合并的理解是，这是一次性交易，之后可以进行合并而不必毫无根据：

从[http://msdn.microsoft.com/en-us/library/bd6dxhfy(VS.80).aspx](http://msdn.microsoft.com/en-us/library/bd6dxhfy(VS.80).aspx)

> /baseless - 执行没有基础版本的合并。即，允许用户合并不具有合并关系的文件和文件夹。在无根据的合并之后，存在合并关系并且未来的合并不必是无根据的。

但是，我今晚使用以下设置进行了尝试：

```
/树干
  |
  - 开发
  |
  - 质量保证
     |
     - 阶段

```

```
tf 合并 C:\src\Project\Branch\Dev\ C:\src\Project\Branch\QA /baseless /recursive

```

该命令运行良好，文件已合并。但是，如果我返回源代码管理资源管理器并右键单击并在 Dev 分支上选择合并，则 QA 不是一个选项 - 只有主干是。

那么我是否误解了文档，他们真正说的是你总是必须在命令行中执行它，但不必包含 /baseless 开关？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-24T10:03:53.123

你是对的，虽然最初的 baseless 合并建立了两个以前不相关的分支之间的关系，但所有未来的合并都需要使用命令行执行，但不需要 /baseless 选项：

[http://blogs.vertigosoftware.com/teamsystem/archive/2006/07/13/3069.aspx](http://blogs.vertigosoftware.com/teamsystem/archive/2006/07/13/3069.aspx)

# .net - 适用于 Windows 的 Amazon EC2 值得吗？

> ID：232188
> 
> 赞同：4
> 
> 时间：2008-10-24T01:23:44.830
> 
> 标签：.net, amazon-ec2, amazon

亚马逊今天宣布面向 Windows 的云托管进行公开测试。

[EC2 Windows 定价](http://aws.amazon.com/windows/)

与您自己的服务器托管相比，定价似乎并不便宜。这是朝着托管的明显未来迈出的革命性一步吗？

有没有人有在亚马逊虚拟盒子上使用 .net 的第一手经验？

顺便说一句，最便宜的价格是每小时 12.5 美分。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-24T01:54:34.097

这似乎非常昂贵。老实说，我很失望有几个原因。首先，它们只支持 Windows 2003 Server。Windows 2008 已经推出了很长时间，以至于他们现在肯定可以支持它。其次，他们没有提到他们支持的 SQL Server 版本，但我猜它也是 2005 年的。

对于安装了 SQL Server Standard 的 Windows 2003 机器，每小时将花费 1.10 美元或每月约 750 美元！

我想知道是否可以安装您自己的 SQL 2008 版本。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-30T23:26:42.247

如果您有许可证，则可以安装您自己的 SQL 版本。亚马逊当然不能阻止你安装任何你想要的软件——内置的 SQL 服务器产品只允许你对 SQL 服务器使用按小时许可的模式，否则你不能直接从微软那里做。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-15T07:37:38.477

请记住，您实际上不需要运行经过身份验证的 AMI，除非您正在运行需要通过网络传输身份验证信息的系统 - 例如 kerberos (AD) 设置。本地帐户可以与“匿名”版本（最多 5 个 IIRC）一起正常工作。因此，简而言之，如果您在 EC2 上运行 Windows 企业内部网，则经过身份验证的版本会更有用，但匿名版本几乎适用于 EC2 或任何计算云的任何典型用途。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-24T01:28:26.020

仅一个小型 SQL Express + IIS 盒 + 身份验证，每月 180 美元似乎很昂贵。我认为问题是您在部分时间获得全额费用。如果他们取消了这一点，并让您按消耗的每 cpu 小时或类似的时间计费，那么它可能会更好。

有更便宜的解决方案，例如 Mosso 或 GoGrid，它们更便宜并提供类似的产品。

但是，如果您已经与 AWS 进行了紧密集成，那么它可能会很受欢迎。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-24T01:54:26.997

我们公司在 Mosso 和 GoGrid 方面的 [Linux] 生产经验都很差。

我们计划在未来几个月的某个时间试用带有 Windows 的 EC2。

我认为要记住的一件事是，网格解决方案的目的是允许您随着需求和流量的增长启动额外的实例。虽然您可以使用网格解决方案进行常规托管并获得可靠性的好处（尽管到目前为止，我对网格的经验不过如此）但最好从按需的角度来看待它。

如果 EC2/Windows 能够实现亚马逊的承诺，它将每月为我的公司节省数千美元的托管成本。

# css - IE边框打破导航

> ID：232191
> 
> 赞同：2
> 
> 时间：2008-10-24T01:25:27.383
> 
> 标签：css, internet-explorer

IE 6 中的另一个问题...[链接](http://plwd.co.uk/rangers)

导航栏链接列表在每个元素的左侧都有一个边框。

在 fireforx/safari 中，这与导航栏背景相匹配，但在 IE 中，边框/元素溢出到导航栏下方（边框伸出底部）。

编辑：另外，导航栏是 IE 中蓝色标题的整个长度，而它应该只与其中的导航链接一样大！啊！

有任何想法吗？谢谢。

图片：

它在 ie6 中的外观：

[ie6 吮吸 http://plwd.co.uk/rangers/images/ie6.jpg](http://plwd.co.uk/rangers/images/ie6.jpg)

它应该看起来如何：

[替代文字 http://plwd.co.uk/rangers/images/firefox.jpg](http://plwd.co.uk/rangers/images/firefox.jpg)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-24T02:30:28.937

尝试摆脱锚标签上的高度规则，并使用顶部/底部边距/填充来确保它们填满空间。当您不尝试对元素强制高度时，我发现使用浮点数的 CSS 会容易得多。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-24T03:17:28.717

这不是边界做的 - 这是行高。您的导航锚从#header 继承“line-height: 2em”。尝试将锚点（或它们的父 LI 或 UL）上的线高设置为更小一些 - 可能是 1.5em 左右 - 然后用锚点上的一些顶部填充来弥补差异

# mfc - 我调用 CListCtrl::InsertItem() 方法会引发什么消息或事件？

> ID：232202
> 
> 赞同：2
> 
> 时间：2008-10-24T01:29:18.717
> 
> 标签：mfc, listview, ownerdrawn

我打算实现 CListCtrl 的所有者绘制。我认为绘制一个项目是在将项目插入控件之后。所以我的方法是声明一个从 CListCtrl 派生的类并覆盖它的 DrawItem() 方法。问题是在插入项目后永远不会调用 DrawItem。我的方法有什么问题吗？

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-24T10:40:23.393

要在 CListCtrl 派生类中调用 DrawItem() 覆盖，您需要设置样式**LVS_OWNERDRAWFIXED**并将控件设置为“报表视图”模式。据我所知，ownerdraw 只在报告模式下工作。

还要检查头文件中的变量类型是否正确（例如 CMyListCtrl 而不是 CListCtrl），并按照 Mark Ransom 的建议检查 DDX 分配是否正确。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-24T03:44:13.860

可能您还需要覆盖 MeasureItem() 和 CompareItem()。有关详细信息，请参阅 Microsoft 文章[TN014](http://msdn.microsoft.com/en-us/library/bk2h3c6w(VS.71).aspx)。

这是我从自己的一个项目中剪切并粘贴的一些代码，因此我知道它可以工作：

```
int CGraphicDroplist::CompareItem(LPCOMPAREITEMSTRUCT lpCompareItemStruct)
{
    return 0;
}

void CGraphicDroplist::DrawItem(LPDRAWITEMSTRUCT lpDrawItemStruct)
{
    RECT r = lpDrawItemStruct->rcItem;
    CDC  pDC;
    pDC.Attach(lpDrawItemStruct->hDC);

// Put your code to draw the item here.

    pDC.Detach();
}

void CGraphicDroplist::MeasureItem(LPMEASUREITEMSTRUCT lpMeasureItemStruct)
{
    lpMeasureItemStruct->itemHeight = 100;
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-24T01:32:27.527

您需要在控件上设置 LBS_OWNERDRAWFIXED 样式。您可以在资源模板中执行此操作，也可以使用 ModifyStyle() 函数以编程方式执行此操作。

例子：

```
m_myListbox.ModifyStyle(0, LBS_OWNERDRAWFIXED, 0); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-24T01:37:01.727

问题可能是您没有将窗口与您的类的实例相关联。这是通过对话框的 DoDataExchange 方法中的 DDX_Control 完成的。DDX_Control 调用 CWnd::SubclassWindow，如果你愿意，你可以自己做。

# c - 二进制“尾部”文件

> ID：232212
> 
> 赞同：15
> 
> 时间：2008-10-24T01:35:10.110
> 
> 标签：c, tail, gnu-coreutils, gnu-fileutils

我猜这个网站上的大多数人都熟悉 tail，如果不熟悉的话 - 它提供了一种“跟随”模式，当文本附加到文件 tail 时，会将这些字符转储到终端。

我正在寻找的（如果有必要也可能自己写）是一个适用于二进制文件的 tail 版本。基本上，我有一个无线链接，当文件从另一个网络链接下来时，我想将它涓涓细流。查看尾部源代码，重写它不会太难，但我宁愿不重新发明轮子！这并不是严格意义上的“尾部”，因为我希望复制整个文件，但它会观察添加新字节并流式传输这些字节。

想法？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-10-24T01:39:05.187

将其通过管道传输到 hexdump：

```
tail -f somefile | hexdump -C 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2011-05-30T07:29:30.410

还有一个[bintail](http://kk5jy.net/bintail/)应用程序，它似乎比上述脚本更强大。

> bintail包包含一个应用**程序****bintail**。该程序从磁盘读取一个普通文件，并将输出逐字节传输到标准输出，不进行任何转换，类似于**tail** (1) 对文本文件所做的事情。这对于实时写入时“拖尾”二进制文件（例如 WAV 文件）很有用。这个应用程序正在进行中，但它已经完成了它为我设计的工作。

 ***** * *

## 回答 #3

> 赞同：3
> 
> 时间：2017-07-25T04:29:39.707

Linux coreutils tail(1) 在二进制文件上工作得很好。对于大多数应用程序，您只需要避免它的行方向，这样输出就不会从数据结构中间的某个随机点开始。您可以通过简单地从文件的开头开始来做到这一点，这也正是您所要求的：

`tail -c +1 -f somefile`

工作得很好。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-05-30T01:12:36.030

这个用于 Windows 的仓促编码的 Python 脚本可能会有所帮助：

```
# bintail.py -- reads a binary file, writes initial contents to stdout,
# and writes new data to stdout as it is appended to the file.

import time
import sys
import os
import msvcrt
msvcrt.setmode(sys.stdout.fileno(), os.O_BINARY)

# Time to sleep between file polling (seconds)
sleep_int = 1

def main():
    # File is the first argument given to the script (bintail.py file)
    binfile = sys.argv[1]

    # Get the initial size of file
    fsize = os.stat(binfile).st_size

    # Read entire binary file
    h_file = open(binfile, 'rb')
    h_bytes = h_file.read(128)
    while h_bytes:
        sys.stdout.write(h_bytes)
        h_bytes = h_file.read(128)
    h_file.close()

    # Loop forever, checking for new content and writing new content to stdout
    while 1:
        current_fsize = os.stat(binfile).st_size
        if current_fsize > fsize:
            h_file = open(binfile, 'rb')
            h_file.seek(fsize)
            h_bytes = h_file.read(128)
            while h_bytes:
                sys.stdout.write(h_bytes)
                h_bytes = h_file.read(128)
            h_file.close()
            fsize = current_fsize
        time.sleep(sleep_int)

if __name__ == '__main__':
    if len(sys.argv) == 2:
        main()
    else:
        sys.stdout.write("No file specified.") 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-24T01:44:10.887

`less somefile`

然后按`shift F`

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-10-04T17:17:00.543

严格来说，您需要编写一个程序来执行此操作，因为`tail`未指定用于处理二进制文件。如果您想尽快接收新的“涓涓”数据，您可能还想避免缓冲问题。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-24T02:15:56.907

这不是尾巴——这是逐步复制文件。看看rsync。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2018-03-20T16:15:18.893

我使用它，因为它也适用于实时流：

```
cat ./some_file_or_dev | hexdump -C 
```

倾销我的按键（和释放）的示例：

```
[user@localhost input]$ sudo cat /dev/input/event2 | hexdump -C
00000000  81 32 b1 5a 00 00 00 00  e2 13 02 00 00 00 00 00  |.2.Z............|
00000010  04 00 04 00 36 00 00 00  81 32 b1 5a 00 00 00 00  |....6....2.Z....|
00000020  e2 13 02 00 00 00 00 00  01 00 36 00 01 00 00 00  |..........6.....|
00000030  81 32 b1 5a 00 00 00 00  e2 13 02 00 00 00 00 00  |.2.Z............|
00000040  00 00 00 00 00 00 00 00  81 32 b1 5a 00 00 00 00  |.........2.Z....|
00000050  a3 af 02 00 00 00 00 00  04 00 04 00 36 00 00 00  |............6...|
00000060  81 32 b1 5a 00 00 00 00  a3 af 02 00 00 00 00 00  |.2.Z............|
^C 
```

*   [http://man7.org/linux/man-pages/man1/cat.1.html](http://man7.org/linux/man-pages/man1/cat.1.html)

*   [http://man7.org/linux/man-pages/man1/hexdump.1.html](http://man7.org/linux/man-pages/man1/hexdump.1.html)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2021-09-16T08:24:08.483

我使用这个命令（1 表示要解释的字节数）：tail -f | od -x1

# c++ - 有 C++ 的 LINQ 库吗？

> ID：232222
> 
> 赞同：84
> 
> 时间：2008-10-24T01:40:27.960
> 
> 标签：c++, linq, unix

是否有任何平台不可知论（不是 CLI）运动以某种方式让 LINQ 用于 C++？

我的意思是，世界各地的大部分服务器框架都运行在 UNIX 的风格上，并且在 UNIX 上访问 LINQ for C++ 可能会让很多人感到高兴！

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2010-04-19T12:44:50.450

[Hong Jiang 的Linq++](https://github.com/hjiang/linqxx/wiki)看起来是一个好的开始。它的语法比 Clinq 更接近 Linq。[pfultz2 的Linq](http://pfultz2.github.com/Linq/)看起来也很有趣，但它需要一个 C++11 编译器。

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2011-12-07T13:34:18.407

这是我的模板 C++ LINQ 库的解决方案。
源代码在这里：[Boolinq](http://code.google.com/p/boolinq/)
对每个功能都有很多测试。
我现在正在努力。

任何意见？
可能是建议？

更新：项目移至[https://github.com/k06a/boolinq](https://github.com/k06a/boolinq)，现在只有 700 行源代码的 2.0 版 :)

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2012-06-07T23:00:51.267

微软[刚刚宣布](http://channel9.msdn.com/Shows/C9-GoingNative/GoingNative-9-LINQ-for-C-Native-Rx-RxC-Meet-Aaron-Lahman)他们已经为 C 和 C++ 构建了 LINQ。不过还没有。

**2012 年 11 月 6 日更新：**

Microsoft Open Technologies, Inc. 现已[发布](http://blogs.msdn.com/b/interoperability/archive/2012/11/06/ms-open-tech-open-sources-rx-reactive-extensions-a-cure-for-asynchronous-data-streams-in-cloud-programming.aspx)并[开源](https://rx.codeplex.com/)（Apache 许可证 2.0）许多相关库，包括 LINQ 实现 (Ix++) 和新的 Reactive Extensions (Rx++) 库。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2013-04-26T09:20:18.613

[http://cpplinq.codeplex.com/](http://cpplinq.codeplex.com/)是一个非常好的实现。
来自作者：
CppLinq 的动机是 boolinq 和 Native-RX 似乎都是基于操作符的”。组成列表函数。问题在于“。” 运算符是它不能在 C++ 中重载，这使得很难用我自己设计的功能扩展这些库。对我来说，这很重要。CppLinq 是基于 operator>> 的，它是可重载的，因此 CppLinq 可以是可扩展的。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2012-02-06T13:14:45.857

我编写了一个小型库[cppLinq](http://code.google.com/p/cpplinq)，它重新实现了 IEnumerable<> 及其 LINQ 运算符。这只是一个实验；目前它只能在 Windows 上工作（协程是用 Win32 光纤实现的），并且只能用 VS11 的 Dev Preview 构建（它大量使用 lambda 表达式:-)）。

它允许编写如下代码：

```
auto source = IEnumerable<int>::Range(0, 10);

auto it = source->Where([](int val) { return ((val % 2) == 0); })
                ->Select<double>([](int val) -> double { return (val * val); }));

foreach<double>(it, [](double& val){
    printf("%.2f\n", val);
}); 
```

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2010-04-15T14:52:42.247

您可以查看[PSade.Oven](http://p-stade.sourceforge.net/oven/doc/html/index.html)，这是一个在 STL 范围内工作并提供许多类似 LINQ 的函数的强大增强库。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2012-06-07T12:04:46.137

实际上，如果您只想使用 Linq 进行列表理解，您可以使用这个[Linq](http://pfultz2.github.com/Linq/)库。它需要 C++11（尽管它可以在 MSVC 2010 中工作）和 Boost。使用该库，您可以编写如下 linq 查询：

```
struct student_t
{
    std::string last_name;
    std::vector<int> scores;
};

std::vector<student_t> students = 
{
    {"Omelchenko", {97, 72, 81, 60}},
    {"O'Donnell", {75, 84, 91, 39}},
    {"Mortensen", {88, 94, 65, 85}},
    {"Garcia", {97, 89, 85, 82}},
    {"Beebe", {35, 72, 91, 70}} 
};

auto scores = LINQ(from(student, students) 
                   from(score, student.scores) 
                   where(score > 90) 
                   select(std::make_pair(student.last_name, score)));

for (auto x : scores)
{
    printf("%s score: %i\n", x.first.c_str(), x.second);
} 
```

这将输出：

```
Omelchenko score: 97
O'Donnell score: 91
Mortensen score: 94
Garcia score: 97
Beebe score: 91 
```

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2010-02-22T00:01:07.453

C++ 0x，或者任何它最终被调用的东西，确实有一个名为的新关键字`auto`，它允许类型推断。是的，C++ 将会出现 lambda。此外，一个快速的[谷歌](http://www.google.ca/search?hl=en&q=linq+C%2B%2B&btnG=Search&meta=)搜索揭示了这一点，[CLinq](http://tomasp.net/blog/clinq-project.aspx)。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2012-10-21T13:01:58.613

这是我用 c++11 实现的 c++-linq（中文）：

[http://www.cnblogs.com/cbscan/archive/2012/10/20/2732773.html](http://www.cnblogs.com/cbscan/archive/2012/10/20/2732773.html)

它支持“延迟查询”、“基于堆栈”（尽可能少地使用 operator new）、“复制语义”（因此您可以在备份后多次迭代查询）等功能。

它还支持数十种功能，包括“从，选择，哪里，投射，范围，所有，任何，投射，平均，包含，计数，第一，最后，头，尾，groupBy，takeUntil，skipUntil，max，min，reduce，唯一，排序，随机，相交，_union”。

我认为我的代码很简单，任何人都可以自己理解和扩展。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2012-10-05T11:59:53.550

这是另一种[替代方案](https://bitbucket.org/ronag/cppextras/src/master/linq/linq.hpp)，它只是对 boost 和 stl 算法的包装，因此您可以获得这些实现的大部分性能优势。

它是这样工作的：

```
std::vector<int> xs;
auto count = from(xs)
   .select([](int x){return x*x;})
   .where([](int x){return x > 16;})
   .count();
auto xs2 = from(xs)
   .select([](int x){return x*x;})
   .to<std::vector<int>>(); 
```

请注意，某些方法会返回空范围的代理，例如

```
std::vector<int> xs;
auto max = from(xs)
   .select([](int x){return x*x;})
   .where([](int x){return x > 16;})
   .max()
   .value_or(default_max_value); 
```

欢迎反馈。

* * *

## 回答 #11

> 赞同：-5
> 
> 时间：2008-10-26T04:12:57.460

我认为 C++ 没有编译器糖来处理诸如 lambda 表达式之类的事情，所以不，这不会发生。

# php - 在 MySQL 中使用/存储加密密钥的最佳方法是什么

> ID：232228
> 
> 赞同：11
> 
> 时间：2008-10-24T01:43:14.633
> 
> 标签：php, mysql, security, encryption, key

我计划使用 MySQL，它的内置加密功能可以加密/解密某些表中的某些列。我担心的是我需要将密钥存储在某个地方。我当然可以将密钥存储在一个文件中并控制该文件的权限以及访问它的应用程序的权限，但这是否足够？我还可以创建一个 Web 服务来获取密钥或其他东西。

我在一家小商店里，我将是唯一一个（可能是另一个人）可以访问应用程序所在机器的人。 **编辑：我应该补充一点，除非我添加了一个层，否则该应用程序有一个面向 Web 的部分需要解密数据。**

我看起来很恶心，但似乎没有人有一个万无一失的答案。

这是您必须解决的问题之一吗？鉴于我正在使用 MySQL 和 PHP（可能是 Python），有没有更好的方法来解决这个问题？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-05-02T10:35:31.760

我不确定使用 MySQL 内置加密是否是解决您问题的最佳方法。

PHP 的[M_CRYPT](http://www.php.net/manual/en/intro.mcrypt.php)包被认为非常好，它使您可以灵活地选择最适合您需要的算法。

将您的密钥存储在其他服务器上有一个很大的优势：密钥与加密数据不在同一台机器上^(*))。因此，只要攻击者对受感染的机器没有足够的控制权，他们就无法获得密钥。
如果攻击者完全控制了存储数据的机器，他们很可能能够向 Web 服务查询密钥。

但是，将密钥从一台机器传输到另一台机器会打开一个需要保护的全新区域。可能涉及更多的密钥和更多的加密层，从而增加了出错的机会。

^(*))另一种选择是在网络服务器启动时输入密码并仅将其保存在内存中。

**可能**
的解决方案如果看到使用以下方法为具有 Web 访问权限的用户加密文件的解决方案（我不确定您的环境，但它可能会有所帮助）：

*   在创建用户时，会为新用户分配一个长随机密钥。
*   此随机密钥存储在用户记录的加密列中。
    （*仅此列被加密，不影响其余记录的性能！*）
*   随机密钥列的加密是使用 1 个主密码完成的，存储在文件或内存中。
    （*更好的选择是在启动您的网络服务器时输入密码并将其仅存储在内存中。*）
    （*另一种方法是让用户输入密码并使用它来加密/解密随机密钥列，但我不确定这是否会增加或降低安全性*）
*   每个需要加密的文档都使用该用户的随机密钥加密，然后存储在磁盘上。
*   文档以最小权限存储在文件系统中。

**The advantages of this approach are:**
1\. The random-key is encrypted in the database. So you still have the added security of the database-server, in combination with the encrypted column. 2\. Documents are stored with different keys, if the attacker gets hold of a key, only part of the documents is compromised.

*However:*
If the attacker gets hold of the master password and has read access to the user-table, the entire system is, once more, broken.

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-24T08:56:25.913

我可能会将它存储在一个不可通过网络访问的目录中的文件中，并尽可能地使用文件系统权限锁定。

您的面向 Web 的脚本不应使用变量打开任何文件系统文件，尤其是用户提供的文件。甚至不要让他们选择通过输入过滤器传递某些内容（您正在过滤用户提供的数据，对吗？）并可能放弃密钥文件的内容。只保留硬编码字符串的文件路径和define()。由于您的大部分数据都存储在 MySQL 中，因此这应该不是问题。

在进行解密时，将密钥读入一个干净初始化的变量，进行解密，然后覆盖密钥变量（比如用 x 的字符串）并取消设置变量。这可能听起来有点偏执，但是如果您将密钥在内存中的清除时间减至最少，并将其与 PHP 脚本周围的所有其他变量隔离开来，它就不会降低您***的***安全性。

如果您和另一个人是唯一可以物理访问机器的人，那么这可能很好。如果有人闯入并偷走了盒子，那么无论如何，他们已经掌握了您的所有数据，所以游戏结束了。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-24T03:02:21.183

您似乎正在考虑使用“列特定”密钥与“AES_ENCRYPT”和“AES_DECRYPT”一起使用。正如评论者所说，这是一个坏主意，因为任何入侵都可以访问所有数据。

如果您使用“用户提供的”密码，无论是否加盐，您都会更加安全。

也就是说，如果加密密钥只能由使用它的应用程序读取，那么您可能“足够好”。如果机器被闯入，他们将用一个键更快地获取您的数据。

# email - 公钥电子邮件加密

> ID：232231
> 
> 赞同：5
> 
> 时间：2008-10-24T01:48:22.377
> 
> 标签：email, encryption

谁的电子邮件已完全加密？

我想加密我的电子邮件，但我不知道如何开始。如果我使用加密的电子邮件，并且我向未加密电子邮件的人发送电子邮件，收件人如何阅读电子邮件？

您建议在 Windows 系统上运行什么电子邮件客户端来加密电子邮件？我目前正在使用 Thunderbird。

据我了解，您必须生成 2 个密钥（一个公共密钥和一个私有密钥），但是您如何生成此密钥？我还认为您必须将密钥放在某个地方才能下载，但我不明白您如何信任下载的密钥。

非常感谢任何指向有关电子邮件加密实施工作的良好（不太复杂）指南的链接。

亲切的问候 wim hendrix anatak

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-24T02:03:08.463

带有 Enigmail 的 Thunderbird 是一个很好的免费解决方案，可以满足您的需求。我使用 Outlook 和 PGP，但我认为它们大致相同。

有关[公钥/私钥加密](http://en.wikipedia.org/wiki/Public-key_cryptography)的详细说明，请查看 wiki 页面，但我会尝试在这里进行总结。

要加密消息，以便除了接收者 (bob) 之外没有其他人可以查看它，您可以使用 Bob 的公钥加密消息。公钥允许您加密但不能解密。如果没有公钥，您将无法加密消息，因此无需担心加密任何人都无法解密的消息。

当 Bob 收到您的消息时，他将使用他的私钥来解密消息。他将这个私钥保密，这样其他人就无法解密他的邮件。为了发回加密的消息，Bob 将使用_您的公钥（您之前发送给他）来加密消息。然后他会将其发送给您，您可以使用您的私钥对其进行解密。

也就是说，我用于邮件的解决方案是使用机会加密，因此，如果我拥有邮件消息的任何收件人的公钥，它会自动加密，如果我没有，它不会。但是，这并不能保护我免于意外向我没有公钥的人发送秘密消息。为此，我必须非常小心，始终验证我是否拥有秘密消息所需的所有密钥。

为了做到这一点，我有一个电子邮件规则设置，它说如果我在主题行中有 [PGP] 一词，它将不允许发送未加密的邮件。如果我尝试它会抛出一个错误并警告我我的错误。

[enigmail](http://enigmail.mozdev.org/documentation/quickstart-ch1.php#id2532985)站点对如何设置 Thunderbird 来加密您的消息有很好的描述。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-24T02:18:53.470

我实际使用的是[FireGPG](http://getfiregpg.org)，它是一个 Firefox 扩展程序，可以让您直接在 Firefox 上进行加密、签名、解密、验证等操作，我主要在 GMail 中使用它...

我也使用**[GPG4Win](http://www.gpg4win.org/)**，它是一个适用于 Windows 的包，其中包含：

*   GnuPG，真正的加密软件
*   两个关键管理器（WinPT、GPA）
*   GPGee（用于 Explorer shell 集成）
*   GPGol（MS Outlook 插件）
*   Claws Mail（实际上是一个完整的邮件程序）。

这个包非常适合让 GnuPG 快速启动和运行......

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-24T03:10:35.627

我使用 Outlook 和 PGP 并且已经做了 10 多年没有问题。PGP Outlook 插件可以正常工作。设置没有复杂性。当我升级到 Office 2007 时，最近才需要升级 PGP。（PGP 8.1 正在删除整个电子邮件内容并使用附件做奇怪的事情。）

有几个公钥服务器，您可以在其中上传您的公钥并找到其他人。

PGP 与 GPG 兼容，因此我可以与使用 GPG 和 Thunderbird 的同事交换加密电子邮件。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-24T02:03:28.790

Thunderbird 有一个名为 Enigmail 的简洁插件，可以做你想做的事。

有两个系统用于加密电子邮件（以及确保密钥的真实性），S/MIME 和 PGP/MIME。前者使用传统的 PKI（公钥基础设施），这意味着您的密钥必须由证书颁发机构签名才能使用。

Thawte 有一项免费邮件服务，可以免费签署电子邮件证书，如果您能在您所在地区找到可以亲自证明您的身份的人（您需要至少携带一种政府签发的带照片的身份证件，最好是两份，当您是被证明，例如护照和驾驶执照）。

PGP 系统使用更基层的身份验证方式。您只需找到在 PGP“信任网络”中众所周知的其他人，并让他们验证您（同样具有类似的文件要求，尽管不同的签名者有不同的要求）。

要找到这样的其他人，您应该寻找“PGP[密钥签名方](http://en.wikipedia.org/wiki/Key_signing_party)”。在这种情况下，每个人都带上自己的身份证，每个人都在其他人的钥匙上签名。

因此，要回答有关如何信任您下载的密钥的问题：在 S/MIME 模型中，受信任的 CA（例如 Thawte）必须对其进行签名。在 PGP 模型中，“众所周知”的人（至少对您而言，最好对大多数 PGP 用户而言）必须对其进行签名。

我碰巧是 Thawte Web of Trust 公证人，所以如果你想走 S/MIME 路线，住在奥克兰附近，并且碰巧想要得到验证，请在此处写评论或其他内容。:-P

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-24T02:05:16.103

[PGP](http://en.wikipedia.org/wiki/Pretty_Good_Privacy)就是我用于电子邮件的这样一种系统。

[这里](http://www.pitt.edu/~poole/PGP.htm)或[这里](http://www.haltabuse.org/pgp/win/index.shtml)有一个教程。

* * *

## 回答 #6

> 赞同：-3
> 
> 时间：2010-03-14T01:22:41.193

使用 WinRAR，并亲自给他密码。

WinRAR 非常安全。有一个案例是政府无法查看一个人从加拿大携带的笔记本电脑上的文件。他使用WinRAR。他们试图让他给他们密码，他拿了第五个。上诉了s年，法院终于说他不必说话（在这个过程中每个法院都这么说）。我不敢相信有人会认为他不能拿下第五名。他们上诉失败后，政府撤销了此案，因为他们还没有破解文件。

# c - 使用 C 在文本文件中返回随机行的最佳方法是什么？

> ID：232237
> 
> 赞同：15
> 
> 时间：2008-10-24T01:56:00.083
> 
> 标签：c, file, random, stdio

使用 C 在文本文件中返回随机行的最佳方法是什么？它必须使用标准 I/O 库 ( `<stdio.h>`)，因为它适用于 Nintendo DS 自制软件。

**说明：**

*   使用文件中的标题来存储行数不适用于我想做的事情。
*   我希望它尽可能随机（最好是如果每一行都有与其他行一样被选择的概率。）
*   程序运行时文件永远不会改变。（这是 DS，所以没有多任务处理。）

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2008-10-24T02:01:54.080

阅读每一行，并使用一个随机数来选择是保留该行还是忽略它。对于第一行，您希望保持 1:1 的赔率；对于第二个，你想要 1:2 的赔率，等等。

```
count = 0;
while (fgets(line, length, stream) != NULL)
{
    count++;
    if ((rand() * count) / RAND_MAX == 0)
        strcpy(keptline, line);
} 
```

我还没有验证这是否具有适当的随机特性，但乍一看似乎是正确的。

* * *

有人指出，整数溢出很快就会成为比较编码方式的问题，我自己也独立得出了相同的结论。可能有很多方法可以解决它，但这是首先想到的：

```
if ((rand() / (float)RAND_MAX) <= (1.0 / count)) 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2010-05-28T23:44:29.183

马克的回答几乎是正确的，除了两个问题：

1.  如果一行比`length - 1`字符长（包括换行符），那么`while`循环将`count`至少为同一行增加两次：第一个`length - 1`字符一次，下一个`length - 1`字符一次，等等。
2.  的计算`rand() * count`会导致整数溢出。

要解决第一个问题，您可以调用`fgets`垃圾缓冲区，直到它返回`NULL`（指示 I/O 错误或没有数据读取的 EOF）或垃圾缓冲区包含换行符：

```
count = 0;
while (fgets(line, length, stream) != NULL)
{
    char *p = strchr(line, '\n');
    if (p != NULL) {
        assert(*p == '\n');
        *p = '\0'; // trim the newline
    }
    else { // haven't reached EOL yet. Read & discard the rest of the line.
#define TRASH_LENGTH 1024
        char trash[TRASH_LENGTH];
        while((p = fgets(trash, TRASH_LENGTH, stream)) != NULL) {
            if ((p = strchr(trash, '\n')) != NULL) // reached EOL
                break;
        }
    }
    assert(strchr(line, '\n') == NULL); // `line` does not contain a newline
    count++;
    // ... 
```

如果浮点运算不可用，则可以通过@tvanfosson 的建议解决第二个问题：

```
int one_chance_in(size_t n)
{
    if (rand() % n == 0) // `rand` returns an integer in [0, `RAND_MAX`]
        return 1;
    else
        return 0;
} 
```

但请注意，即使假设为一个，这`rand() % n`也不是一个[统一的离散随机变量](http://en.wikipedia.org/wiki/Uniform_distribution_(discrete))`rand()`，因为概率`rand() % n == 0`可能`RAND_MAX`比期望的概率 1/ 高 1/ `n`。在我的机器上，`RAND_MAX`是 2147483647，所以差异是 4.66 × 10 ^(-10)，但 C 标准只要求`RAND_MAX`至少是 32767（3.05 × 10 ^(-5)差异）。

`keptline`此外，对于任何想知道为什么这个方案有效的人（就像我一样），如果有*m*行并概括，计算第一行保留的概率可能会有所帮助：在循环的第一次迭代中，第一行被复制到的概率`keptline`是 1/1。在循环的第二次迭代中，第二行不覆盖第一行的概率*为*1/2。*在第三次迭代中，第三行不*覆盖第一行的概率为 2/3。继续，最后一行不覆盖第一行的概率是 ( *m* - 1)/ *m*。因此，第一行保留在`keptline`遍历所有行之后是：

> 1/1 × 1/2 × 2/3 × 3/4 × ... × ( *m* - 2)/( *m* - 1) × ( *m* - 1)/ *m* = 1/ *m*

*第二*行保留的概率`keptline`是：

> 1/2 × 2/3 × 3/4 × ... × ( *m* - 2)/( *m* - 1) × ( *m* - 1)/ *m* = 1/ *m*

*第三*行保留的概率`keptline`是：

> 1/3 × 3/4 × ... × ( *m* - 2)/( *m* - 1) × ( *m* - 1)/ *m* = 1/ *m*

等等。它们都是 1/ *m*。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-10-24T02:01:11.680

**这种方法很好，因为：**

i) 你可以继续生成随机线而无需付出高昂的代价

ii）您只需每次随机读取文件 1 次 + 1 行。多余的读取数据只等于文件的大小。

iii）它给每一行一个公平的机会，不管它在文件中的位置是什么。

iv) 它给每一行一个公平的机会，不管它在文件中的长度是多少。

**建议：**

我建议使用 2 遍算法。嗯，真的是1 pass + N 行。其中 N 是您想要的随机行数。

第一遍用于计算行数和每行的起始位置。

然后，您从 0 到行数减 1 取一个随机数。使用该随机数，即您的行索引，获取该行索引的起始位置。寻求那个位置。

然后，您只需要再读取 1 次，并且您知道确切的大小。（直到下一行的开始索引）

**如何存储行数和每行的索引：**

要存储行数，您显然可以只使用 int。

如果可以使用向量，则可以将每个行索引添加到向量中。如果不是，您可以创建一个整数数组，其中包含您认为会有的最大行数。然后索引到该数组。

**其他答案：**

另一个答案提到您可以从 1 到文件大小选择一个随机数，然后使用最接近的换行符。但这行不通。例如，您可能有 1 行非常长，而其他行则不那么长。在这种情况下，您的分布将不均匀。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-24T02:02:13.300

1.  获取文件的长度。
2.  在文件中选择一个随机位置。
3.  寻求那个位置。
4.  向前迭代，直到找到换行符。
5.  如果您没有找到换行符，请回到开头。
6.  使用gets() 读取该行。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-24T02:21:43.883

我有一个替代解决方案。由于平台是 DS，您可能不想尝试将文件保存在内存中。这会读取文件两次。一次计算行数，第二次找到它想要的行。这将比目前建议的其他解决方案运行得慢，但它几乎不使用任何内存。我什至为你用 C 语言编写了它（我省略了错误处理）：

```
main(int argc, char **argv)
{
    FILE *f;
    int nLines = 0;
    char line[1024];
    int randLine;
    int i;

    srand(time(0));
    f = fopen(argv[1], "r");

/* 1st pass - count the lines. */
    while(!feof(f))
    {
        fgets(line, 1024, f);
        nLines++;
    }

    randLine = rand() % nLines;
    printf("Chose %d of %d lines\n", randLine, nLines);

/* 2nd pass - find the line we want. */
    fseek(f, 0, SEEK_SET);
    for(i = 0; !feof(f) && i <= randLine; i++)
        fgets(line, 1024, f);

    printf("%s", line);
} 
```

**更新：**哎呀，我应该在发布之前阅读 Brian R. Bondy 的回答，但我有点痴迷于编写代码并且没有注意到。这几乎相同，只是它不将行位置存储在数组中。您可以根据文件的大小以及速度是否比节省内存更重要来执行此操作。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-01T02:29:38.270

您需要做的就是每行生成一个未缩放的随机数，同时保持您生成的所有随机数的最大值。每当您更新最大值时，都会用当前行覆盖所选行。

最后，您会得到与 rand() 吐出的最高数字相关联的行，这在您的所有行中应该是同样可能的。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-06T02:42:24.090

简单介绍一下[Mark Ransom](https://stackoverflow.com/questions/232237/whats-the-best-way-to-return-a-random-line-in-a-text-file-using-c#232248)避免整数溢出的方法：DS 没有 FPU，因此浮点除法将在软件中模拟，并且非常慢。如果速度是一个问题，您将不惜一切代价避免类型转换/提升浮动或加倍。

这是避免任何浮点数学运算的避免整数溢出的另一种方法：

```
if(rand() <= RAND_MAX / count) 
```

由于整数除法，概率可能会略微偏斜，但这在 DS 上肯定会运行得更快。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2008-10-24T02:29:15.040

使用 Adam 的随机偏移到文件方法和 Mark 的概率方法的组合。亚当的方法可以让你随机进入文件的一部分。然后，您使用 Mark 的方法来避免偏爱较大的字符串。Mark 的算法会从它开始的地方优先选择前几个字符串，

# image - 是否有任何编解码器可以直接从图像文件中获取缩略图？

> ID：232255
> 
> 赞同：2
> 
> 时间：2008-10-24T02:04:32.733
> 
> 标签：image, thumbnails, codec, performance

我使用 gdi+ 的 Image 类来解码图像文件。但是我发现如果我打开一个图像，然后使用 GetThumbnail() 方法，它真的很慢，尤其是对于高分辨率图像。

有什么方法可以更快地获取缩略图吗？

或者是否有任何专门为快速检索大多数图像格式的缩略图而设计的库。

非常感谢！

感谢经理和 PhiLho 的建议！！

我确实使用 thumbs.db 来获得更好的用户体验，并且在打开一次图像后，我将其缩略图流存储到我自己的数据库系统中以供进一步使用。

让我感到困惑的是如何更快地解码 Jpg、bmp、格式图像，解码器无法获得完整图像而只能获得缩略图。它与图像格式有关。

我只想知道：是否有任何现有的用 C++ 或 C 编写的编解码器库来完成这项任务。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-24T02:20:41.563

您可以将缩略图缓存为主文件旁边的小图像文件吗？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-24T10:45:35.350

正如 mgb 所建议的，缓存可能是解决方案：在 Windows 资源管理器中，当您切换到带有图像预览的移动时，它会在其显示的目录中创建一个名为 thumbs.db 的系统隐藏文件。我认为你可以做类似的事情。

或者更好的是，强制创建和使用这样的数据库，因为它是一个标准。根据 TriD，它是一个“通用 OLE2 / 多流复合文件”。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-02T07:17:15.587

关于将拇指存储在数据库中，您可以查看[在数据库中存储图像 - 是吗？](https://stackoverflow.com/questions/3748/storing-images-in-db-yea-or-nay)

# qt - 你如何调试 Qt 布局问题

> ID：232267
> 
> 赞同：14
> 
> 时间：2008-10-24T02:11:48.757
> 
> 标签：qt, layout

我有一个复杂的对话框，它充满了空格，我无法缩小它。在 Designer 中，它有很多组件会被动态隐藏，还有一些是动态添加的。我添加了尺寸策略、尺寸提示和最小尺寸的倾倒，但仍然无法弄清楚为什么 Qt 不允许我将其拖得更小。

必须有一些工具或技术来解决这个问题。

请分享。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-24T15:20:47.653

我不知道有什么工具可以做到这一点，但我之前通过更改对话框中不同元素的调色板来管理它，然后查看占用比我预期更多（或更少）的空间，并专注于我的对这些要素进行调查。

在更一般的意义上，确保您已将对话框设置为不固定大小。那也咬了我一次。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2011-03-18T20:45:48.107

您可以捕获 QApplication::focusChanged(QWidget*,QWidget*) 信号并更改当前聚焦小部件的背景。我认为这将有助于确定每个小部件占用多少空间。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-03T21:10:11.097

听起来我们可以使用相当于 Firebug 的元素和 CSS 指标检查器模式。这种工具最难的部分将是有效地弄清楚和沟通为什么单个布局策略在小部件中使用或不使用给定的大小值。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-11T01:28:41.367

It's hard to tell without seeing your layout, but I see a lot of resize problems like you describe due to using QGridLayout. The largest thing in a column or row, is going to determine the minimum width of that column. The same for a row.

If you are using QGridLayout, you might try making things [span columns/rows](http://doc.trolltech.com/4.4/qgridlayout.html#addWidget-2).

I'd also recommend trying all your various layout configurations in Designer and test it by resizing. We don't actually use Designer where I work, but I use it all the time to test, and debug layout ideas.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-03-18T20:52:20.767

大量的试验和错误。我发现在关键位置插入拉伸通常可以帮助我产生我想要的效果。例如，如果我在布局中有一个 QPushButton，我想成为最小尺寸，我将执行以下操作：

```
 QHBoxLayout* layout = new QHBoxLayout;
QPushButton* myBtn = new QPushButton("Test");

layout->insertStretch(1);
layout->addWidget(myBtn, 0);
layout->insertStretch(1); 

```

另外，不要忘记您可以使用 setContentsMargins() 设置布局的内容边距。

我不使用 Designer，因为我发现当我在代码中使用它时，我对布局系统的理解要好得多。

# linux - 如何将 Linux 目录从不同的 PC 挂载到本地 Linux PC？

> ID：232269
> 
> 赞同：22
> 
> 时间：2008-10-24T02:12:36.477
> 
> 标签：linux, mount, nfs

有没有办法将 Linux 目录从不同的 PC 挂载到本地 Linux PC？如何？

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2008-10-24T02:55:41.710

sshfs 非常好用，而且易于使用

```
sshfs user@remotesystem:/remote/dir /some/local/dir 
```

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-10-24T02:21:46.927

是的，它被称为[NFS](http://en.wikipedia.org/wiki/Network_file_system)。您可能还想查看非常不错的[sshfs 。](http://fuse.sourceforge.net/sshfs.html)

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-10-24T02:21:05.603

你需要更具体一点。您可以使用 NFS。

根据您使用的发行版，您只需`/etc/exports`在远程机器上编辑文件以导出您想要的目录，然后启动您的 NFS 守护程序。

然后在本地 PC 上，使用以下命令挂载它：

```
mount -t nfs {remote_pc_address}:/remote/dir /some/local/dir 
```

使用该`man`实用程序获取更多信息：

**man 导出** *（配置导出目录的示例在本手册页的底部。）*

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-10-26T06:51:33.677

NFS 很方便，因为它是内置的且易于配置，但两种常见的实现（NFSv2 和 NFSv3）不会在系统之间转换用户名；而是使用用户 ID。这需要您使用 LDAP 等中央身份验证系统，以便维护公共用户 ID。

sshfs 要求您以单个用户身份进行连接，因此始终以该用户身份进行访问（因此只能进行）。

*nix 到 *nix 连接（通过 Samba）中的 cifs 都转换用户名*并*遵循标准的 *nix 权限。同样，它更灵活，因为它允许您在创建新文件或目录时执行所有权/权限转换。但是，配置起来要复杂得多。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2017-06-01T09:36:59.650

sshfs 对我来说效果很好。

```
sudo sshfs -o allow_other root@1.2.3.4:/directory local_directory 
```

远程机器ip：1.2.3.4

# opengl - 具有多个显示上下文的 OpenGL 纹理

> ID：232271
> 
> 赞同：5
> 
> 时间：2008-10-24T02:12:52.250
> 
> 标签：opengl, textures

我有一个未定义数量的显示上下文，每个都会显示一个纹理。当我调用 glGenTextures 时，我会在所有显示上下文中返回相同的名称。这行得通吗？即使它们具有相同的名称，它们仍然会存储和显示不同的纹理吗？如果不是，应该怎么做才能解决这个问题？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-24T02:49:52.207

纹理不是（默认情况下）跨上下文共享的 - 您必须明确启用此功能，但如何执行此操作是特定于平台的。

在 win32 上，它是`wglShareLists`，而在大多数其他平台上，它是在您创建上下文时指定的（例如，在 OS-X 上使用`share`参数 to ）。`aglCreateContext`

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-02-10T10:07:07.427

从 glGenTexture 获得相同的名称并显示相同的纹理不是一回事。

纹理名称只是由上下文决定的整数，通常从 1 开始，并随着每个 glGenTexture 递增，但不一定如此。实现不需要像那样工作（尽管大多数都这样做）。然而，理论上你也可以得到任何或多或少的“随机”数字，例如一个为任何类型的对象（即不仅是纹理，还包括缓冲区和着色器）递增的整数，甚至是一个 32 位指针地址驱动程序的地址空间，或其他一些深奥的东西。不要求名称必须是特定的东西。

在旧版 OpenGL 中，您甚至可以自己命名而不使用 glGenTexture，但现在这不再合法。我不确定他们在允许时会怎么想，但无论如何...... :)

不同上下文中的相同数字（名称）通常是不同的纹理，或者可能根本没有纹理。因此，如果您确实在不同的上下文中看到具有相同纹理名称的相同纹理，那么您要么有共享的上下文，要么驱动程序有问题。

请注意，如果您使用 wglCreateContextAttribsARB，则第二个参数是已经存在的上下文的句柄（或 null）。如果您在此处提供上下文句柄，即使*没有*显式调用 glShareLists，您也将拥有共享上下文。也许这就是偶然发生的事情。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-24T23:05:39.837

据我所知，我没有启用任何纹理共享。但是，在所有显示上下文中都显示相同的纹理。

# vim - 如何让 Vim 突出显示匹配的括号？

> ID：232274
> 
> 赞同：37
> 
> 时间：2008-10-24T02:14:46.880
> 
> 标签：vim

当我在 Vim 中浏览代码时，我需要看到左括号/括号，并且按下`%`似乎没有效率。

我试过`:set showmatch`了，但是当你输入括号时它会使光标来回跳动。但是如果我正在浏览已经编写好的代码怎么办？

* * *

## 回答 #1

> 赞同：43
> 
> 时间：2008-10-24T02:22:01.480

```
DoMatchParen 
```

在你的`.vimrc`文件中

或者

```
:DoMatchParen 
```

在 vim 本身内。

编辑：这来自[pi_paren](http://vimdoc.sourceforge.net/htmldoc/pi_paren.html)插件（这是一个标准插件）。

* * *

## 回答 #2

> 赞同：40
> 
> 时间：2008-10-24T02:17:59.197

`set showmatch`是你最好的选择。您还可以使用该`%`命令在匹配的括号、大括号、方括号、引号等之间跳转。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2018-10-10T07:56:24.580

vim 从 6.3 版升级到 8.0 版可能会交换/升级管理此 MatchParen 功能的代码文件`/usr/share/vim/vim80/plugin/matchparen.vim`

开始调查 vim 失败以突出显示匹配括号的函数称为：`Highlight_Matching_Pair()`. 执行回显和睡眠并单步执行代码直到`matchaddpos(...)`运行。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2010-07-31T11:57:18.193

也许你想要的是这个插件：

[http://www.vim.org/scripts/script.php?script_id=350](http://www.vim.org/scripts/script.php?script_id=350)

# assembly - 关于位比较的 x86 问题

> ID：232280
> 
> 赞同：2
> 
> 时间：2008-10-24T02:19:40.427
> 
> 标签：assembly, x86, tasm

我的作业的最后一部分有问题。我们得到一个比特流等，在流中是一个整数，文本部分中有 1 的个数。我得到那个整数和它的 24 是正确的，现在我遍历我得到的文本数据，并尝试计算其中的所有 1。但我的过程总是返回零。

我能够确保它正确循环并且确实如此。

文本 = Hello，它是 16 个 1，这是我的 proc，用于循环遍历该文本以计算其中的个数。

```
sub     AX,AX
sub     SI,SI
mov     bx,[bp+6]       ;get message offset    

@@mainLoop:
    mov     cx,8
    mov     dh,80h
    cmp     byte ptr [bx + si],0
    je      @@endChecker
@@innerLoop:
    test    byte ptr [bx + si],dh
    jz      @@zeroFound
    inc     AX
    @@zeroFound:
        shr     bh,1
        loop    @@innerLoop     
    @@continue:
        inc     si
        jmp     @@mainLoop 
```

proc 的其余部分只是推送/弹出。我真正想要做的是使用 TEST 将 100000000 与一个字节进行比较，如果它是 1 inc AX，则将掩码右移 1 并循环整个字节，而不是 inc 到下一个字节并再次执行。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-24T02:22:13.353

'shr bh,1' 应该是 'shr dh,1'，不是吗？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-24T08:49:20.217

只是为了给你一个替代和更短的内部循环实现：

```
 mov    cx, 8
        mov    dh, byte ptr [bx+si] 
@@innerLoop:
        add    dh, dh    
        adc    ax, 0
        loop   @@innerLoop 
```

在这里，我们根本不测试这些位。相反，add dh, dh 将最高位移入进位，并且在一条指令中也与 shl dh,1 相同。

addc ax,0 只是将进位添加到 AX。

# sql-server - 使用 nvarchar(max) 时文本溢出？

> ID：232294
> 
> 赞同：0
> 
> 时间：2008-10-24T02:22:59.390
> 
> 标签：sql-server, regex, sql-server-2005

我遇到了一个奇怪的情况，似乎涉及长文本溢出。我在列上使用`fn_pcre_replace`（来自[xp_pcre 扩展存储过程](http://www.codeproject.com/KB/database/xp_pcre.aspx)）`nvarchar(max)`，当我用比原来更多的字符替换时，如果原始字符串长度超过 8000 个字符，它将返回 NULL。

例如，这个

```
Select master.dbo.fn_pcre_replace(Overview,'a', 'X')
from ProjectContent 
```

按预期工作，但这

```
Select master.dbo.fn_pcre_replace(Overview,'a', 'XXX')
from ProjectContent 
```

在大多数情况下（显然，无论在哪里`Len(Overview)>8000`）都返回 NULL。

这是 的限制`xp_pcre`，还是我可以在我的 SQL 中做些什么来完成这项工作？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-24T03:05:47.603

这是一个限制`xp_pcre`。看源码：

```
 switch (bType)
    {
    case SRVBIGCHAR:
    case SRVBIGVARCHAR:
        break;
    default:
        throw XpException(
            StringBuilder()
            << "Invalid data type on parameter "
            << paramNum
            << " (should be CHAR or VARCHAR)."
            );
    } 
```

我可以得出结论，这两个值（来自`<srv.h>`）最多允许 8000 个字符。 [SRVBIGVARCHAR 是](http://msdn.microsoft.com/en-us/library/aa216035(SQL.80).aspx)

> 变长字符数据类型，长度 0 到 8000 字节。

您需要更新源代码并重新编译以支持 SRVTEXT 或 SRVVARCHAR，因此在使用外部过程时它不是限制因素。

# silverlight - Silverlight 图像：动态加载 URL？

> ID：232316
> 
> 赞同：13
> 
> 时间：2008-10-24T02:37:59.797
> 
> 标签：silverlight, silverlight-2.0

我正在修补 Silverlight 2.0。

我有一些图像，我目前有一个用于图像源的静态 URL。有没有办法从托管控件的站点的 URL 路径动态加载图像？

或者，存储在一个地方的配置设置，它包含 URL 的基本路径，以便每个图像只包含文件名？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-10-25T12:57:40.493

从我收集的信息来看，您并没有尝试动态更改图像本身，而是在运行时正确确定图像的位置。

我相信简单地在图像相对 URL 前加上“../”应该可以让您到达应用程序的根目录，而不一定是站点，因为应用程序可能未托管在站点的根目录中。

如果您的 XAP 文件位于以下位置：

> [http://somesite.foo/app1/somethingelse/clientbin/MyFoo.xap](http://somesite.foo/app1/somethingelse/clientbin/MyFoo.xap)

而你试图链接以下图像：

> [http://somesite.foo/app1/somethingelse/images/a/boo.png](http://somesite.foo/app1/somethingelse/images/a/boo.png)

显然，所有相对 URI 都相对于 XAP 文件所在的位置（通常是 ClientBin 文件夹），并且 Silverlight 会附加当前的 Silverlight 客户端命名空间。因此，如果您的 Silverlight 控件位于命名空间 Whoppa 中，则需要将所有图像放在 clientbin/Whoppa/ 目录中。不太方便。

解决方法是使用绝对 URI，如下所示：

> 新的 Uri(App.Current.Host.Source, "../images/a/boo.png");

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-10-24T03:38:15.977

在后面的代码或值转换器中，您可以执行

```
 Uri uri = new Uri("http://testsvr.com/hello.jpg");
  YourImage.Source = new BitmapImage(uri); 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2010-10-04T08:07:37.800

```
// create a new image
Image image = new Image();

// better to keep this in a global config singleton
string hostName = Application.Current.Host.Source.Host;                   
if (Application.Current.Host.Source.Port != 80)
    hostName += ":" + Application.Current.Host.Source.Port;

// set the image source
image.Source = new BitmapImage(new Uri("http://" + hostName + "/cute_kitten112.jpg", UriKind.Absolute)); 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2010-05-13T16:04:12.440

[http://www.silverlightexamples.net/post/How-to-Get-Files-From-Resources-in-Silverlight-20.aspx](http://www.silverlightexamples.net/post/How-to-Get-Files-From-Resources-in-Silverlight-20.aspx)

```
using System.Windows.Resources;      // StreamResourceInfo
using System.Windows.Media.Imaging;  // BitmapImage
....

StreamResourceInfo sr = Application.GetResourceStream(new Uri("SilverlightApplication1;component/MyImage.png", UriKind.Relative));
BitmapImage bmp = new BitmapImage();
bmp.SetSource(sr.Stream); 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-24T03:44:55.620

[SilverlightHost.Source](http://msdn.microsoft.com/en-us/library/system.windows.interop.silverlighthost.source(VS.95).aspx)将为您提供用于加载 XAP 文件的 URL。您可以使用它为您的图像构建一个相对 URL。

因此，例如，如果您的 XAP 托管在[http://foo.bar/ClientBin/bas.xap](http://foo.bar/ClientBin/bas.xap)并且您的图像存储在[http://foo.bar/Images/](http://foo.bar/Images/)中，您可以简单地使用 Source 获取主机名并协议来构造新的 URI。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-03-18T08:45:28.740

img.Source = new BitmapImage(image uri) 必须有效。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-04-09T19:49:09.657

`img.Source = new BitmapImage(new Uri("/images/my-image.jpg", UriKind.Relative));`将正确解析为 Silverlight 应用程序的根目录，而“../images/my-image.jpg”则不会。

这仅在动态设置图像源时的代码隐藏中是正确的。您不能在 XAML 中使用此表示法（“/”来指定根）（go fiquire，希望他们能解决这个问题）

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-07-15T06:25:56.453

仅当图像作为资源文件包含在项目中时，以下代码才对我有用：

```
img.Source = new BitmapImage(new Uri("/images/my-image.jpg", UriKind.Relative)); 
```

我无法从绝对 URL 访问 URL。甚至没有 Flickr 的图像农场 URL。

# c# - C# 中的已检查异常捕获

> ID：232318
> 
> 赞同：14
> 
> 时间：2008-10-24T02:39:54.847
> 
> 标签：c#, exception-handling

Java 要求您捕获所有可能的异常或将它们声明为在方法签名中抛出。C# 不是这种情况，但我仍然觉得捕获所有异常是一个好习惯。有谁知道可以处理 C# 项目并指出抛出异常但未捕获的位置的工具？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-24T03:03:46.140

查看 Jason Bock 为 .NET Reflector 编写的 ExceptionFinder 插件。它可以满足您的需求。这是一个屏幕：

[在CodePlex](http://www.codeplex.com/ExFinderReflector)上查看

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-05T19:54:44.997

有一个 R# 插件可以分析抛出的异常。 [http://exceptionalplugin.codeplex.com/](http://exceptionalplugin.codeplex.com/)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-24T02:54:34.020

Red-Gate 软件有一个名为 Exception Hunter 的产品应该可以做到这一点。

**编辑：**该产品已被 Red-Gate 软件停产。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-24T03:03:10.540

如果您将 C# 用于 Web 应用程序，那么您可以使用 ELMAH，它显示所有已处理和未处理异常的列表。

只需下载 ELMAH 并将其插入即可。它是免费的！

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-24T03:03:36.250

不要在单个方法中捕获它们，除非您需要设置全局处理程序。

```
Application.ThreadException += new ThreadExceptionEventHandler( Application_ThreadException );

private static void Application_ThreadException( object sender, ThreadExceptionEventArgs e)
{ 
       dispatchException( e.Exception );
} 
```

# c# - .NET 中的进程间通信

> ID：232332
> 
> 赞同：5
> 
> 时间：2008-10-24T02:51:34.260
> 
> 标签：c#, .net, ipc

我有一个核心 .NET 应用程序需要生成任意数量的子进程。这些进程需要能够访问核心应用程序中某种形式的状态对象。

最好的技术是什么？我将在进程（位图）之间移动大量数据，因此它需要快速。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-24T03:26:57.387

WCF 可能符合要求。

这是[一篇关于 .NET 远程处理的非常好的文章，](http://msdn.microsoft.com/en-us/magazine/cc163792.aspx)用于执行分布式密集分析。虽然远程处理已被 WCF 取代，但这篇文章是相关的，并展示了如何异步进行调用等。

本文[将 WCF 与 .NET 远程处理进行了对比](http://msdn.microsoft.com/en-us/library/bb310550.aspx)——**编辑**：这里的关键点表明 WCF 吞吐量优于远程处理小数据，但随着数据大小的增加接近远程处理性能。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-24T02:55:02.587

我有类似的要求，现在正在使用[Windows Communication Foundation](http://msdn.microsoft.com/en-us/netframework/aa663324.aspx)来执行此操作。不过，我的数据大小可能要小一些。

作为参考，我在四核机器上执行大约 30-60 个每秒约 5K-30K 的请求。到目前为止，WCF 一直保持得很好。

使用 WCF，您可以获得选择适合您的应用程序的传输协议和安全模式的额外优势。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-24T03:07:31.997

我会犹豫*移动*大数据，我倾向于移动指向大数据的指针，而不是内存映射文件。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-24T03:16:05.913

[您可以使用 .NET 远程处理与IpcChannel](http://msdn.microsoft.com/en-us/library/system.runtime.remoting.channels.ipc.ipcchannel.aspx)进行进程间通信 (IPC) 。否则，您可以搜索共享内存包装器和其他 IPC 形式。

编辑：有一篇[MSDN 文章](http://msdn.microsoft.com/en-us/library/bb310550.aspx)将 WCF 与包括 Remoting 在内的各种方法进行了比较。但是，除非我读错了条形图，否则它显示远程处理相同或稍好（与其他评论不同）。还有[一篇](http://geekswithblogs.net/marcel/archive/2007/09/26/115651.aspx)关于 WCF 与 Remoting 的博文。博客文章清楚地表明远程处理二进制对象的速度更快，如果您传递位图（二进制对象），那么远程处理或共享内存或其他 IPC 选项似乎可能更快，尽管 WCF 可能不是一个坏选择。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-24T02:55:48.077

如果您确实需要单独的进程，那么总是有[命名管道](http://blog.paranoidferret.com/index.php/2007/07/25/interprocess-communication-using-named-pipes-in-csharp/)可以很好地执行。

但是，AppDomain 边界是否足够？然后你可以进行对象编组，事情会容易得多。您的应用程序可以通过使用[MarshalByRefObject](http://msdn.microsoft.com/en-us/library/system.marshalbyrefobject.aspx)属性来处理同一对象的共享实例。

# sql-server - SET READ_COMMITTED_SNAPSHOT ON 需要多长时间？

> ID：232333
> 
> 赞同：84
> 
> 时间：2008-10-24T02:51:46.367
> 
> 标签：sql-server, isolation-level, read-committed-snapshot

运行需要多长时间

```
ALTER DATABASE [MySite] SET READ_COMMITTED_SNAPSHOT ON 
```

我刚刚运行它，它需要 10 分钟。

如何检查它是否已应用？

* * *

## 回答 #1

> 赞同：72
> 
> 时间：2008-10-24T03:04:58.213

**`sys.databases`**您可以使用视图检查 READ_COMMITTED_SNAPSHOT 设置的状态。检查**`is_read_committed_snapshot_on`**列的值。已经[问和回答](https://stackoverflow.com/questions/51969/how-to-detect-readcommittedsnapshot-is-enabled)了。

至于持续时间，Books Online 声明在发生这种情况时不能有任何其他连接到数据库，但它不需要单用户模式。因此，您可能会被其他活动连接阻止。运行**`sp_who`**（或**`sp_who2`**）以查看还有什么连接到该数据库。

* * *

## 回答 #2

> 赞同：56
> 
> 时间：2009-08-10T06:50:53.503

试试这个：

```
ALTER DATABASE generic SET READ_COMMITTED_SNAPSHOT ON WITH ROLLBACK IMMEDIATE 
```

* * *

## 回答 #3

> 赞同：33
> 
> 时间：2012-12-05T20:36:41.907

好的（我是最初的提问者）所以事实证明我什至没有启用该死的东西。

这是运行以启用快照模式并确保它已启用的[最终代码。](http://support.purecm.com/index.php?pg=kb.page&id=348)

```
SELECT is_read_committed_snapshot_on, snapshot_isolation_state_desc,snapshot_isolation_state FROM sys.databases WHERE name='shipperdb'

ALTER DATABASE shipperdb SET allow_snapshot_isolation ON
ALTER DATABASE shipperdb SET SINGLE_USER WITH ROLLBACK IMMEDIATE
ALTER DATABASE shipperdb SET read_committed_snapshot ON
ALTER DATABASE shipperdb SET MULTI_USER

SELECT is_read_committed_snapshot_on, snapshot_isolation_state_desc,snapshot_isolation_state FROM sys.databases WHERE name='shipperdb' 
```

即使连接处于活动状态，这也适用（大概你对他们被踢出没问题）。

您可以看到之前和之后的状态，这应该几乎立即运行。

* * *

重要的：

上面的选项 READ_COMMITTED_SNAPSHOT 对应于 .NET 中的 IsolationLevel.ReadCommitted
上面的选项 ALLOW_SNAPSHOT_ISOLATION 对应于 .NET 中的 IsolationLevel.Snapshot

[关于不同版本的好文章](https://stackoverflow.com/questions/2741016/read-committed-snapshot-vs-snapshot-isolation-level)

* * *

**.NET 提示：**

`Isolationlevel.ReadCommitted`即使数据库未启用，看起来也允许在代码中使用。不会引发任何警告。所以帮自己一个忙，并确保它在你认为它像我一样持续 3 年之前打开！！！！

如果您使用的是 C#，您可能需要`ReadCommitted`IsolationLevel 而不是`Snapshot`- 除非您在此事务中进行写入。

`READ COMMITTED SNAPSHOT`做乐观读和悲观写。相反，`SNAPSHOT`乐观读取和乐观写入。[（从这里）](https://stackoverflow.com/questions/2741016/read-committed-snapshot-vs-snapshot-isolation-level)

```
bool snapshotEnabled = true;

using (var t = new TransactionScope(TransactionScopeOption.Required,
               new TransactionOptions
{
     IsolationLevel = IsolationLevel.ReadCommitted
}))
{
     using (var shipDB = new ShipperDBDataContext())
     {

     }
} 
```

此外，您可能会收到有关“无法促进”交易的错误。[在 .NET Framework 2.0 中的 System.Transactions 简介中](http://msdn.microsoft.com/en-us/library/ms973865.aspx)搜索“promotion” 。

除非您正在做一些特殊的事情，例如连接到外部数据库（或第二个数据库），否则像创建新 DataContext 这样简单的事情可能会导致这种情况。我有一个缓存，它在初始化时“启动”它自己的数据上下文，这试图将事务升级到一个完整的分布式事务。

解决方案很简单：

```
 using (var tran = new TransactionScope(TransactionScopeOption.Suppress))
        {
            using (var shipDB = new ShipperDBDataContext())
            { 
                 // initialize cache
            }
        } 
```

另见[`Deadlocked`@CodingHorror 的文章](http://www.codinghorror.com/blog/2008/08/deadlocked.html)

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2010-01-13T16:26:13.387

试试这个代码：

```
if(charindex('Microsoft SQL Server 2005',@@version) > 0)
begin
    declare @sql varchar(8000)
    select @sql = '
    ALTER DATABASE ' + DB_NAME() + ' SET SINGLE_USER WITH ROLLBACK IMMEDIATE ;
    ALTER DATABASE ' + DB_NAME() + ' SET READ_COMMITTED_SNAPSHOT ON;
    ALTER DATABASE ' + DB_NAME() + ' SET MULTI_USER;'

    Exec(@sql)
end 
```

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2017-08-09T19:45:04.807

我尝试了命令：

```
ALTER DATABASE MyDB SET READ_COMMITTED_SNAPSHOT ON
GO 
```

针对一个开发盒，但它花了 10 多分钟，所以我杀了它。

然后我发现了这个：

[https://willwarren.com/2015/10/12/sql-server-read-committed-snapshot/](https://willwarren.com/2015/10/12/sql-server-read-committed-snapshot/)

并使用他的代码块（运行大约需要 1:26）：

```
USE master
GO

/** 
 * Cut off live connections
 * This will roll back any open transactions after 30 seconds and
 * restricts access to the DB to logins with sysadmin, dbcreator or
 * db_owner roles
 */
ALTER DATABASE MyDB SET RESTRICTED_USER WITH ROLLBACK AFTER 30 SECONDS
GO

-- Enable RCSI for MyDB
ALTER DATABASE MyDB SET READ_COMMITTED_SNAPSHOT ON
GO

-- Allow connections to be established once again
ALTER DATABASE MyDB SET MULTI_USER
GO

-- Check the status afterwards to make sure it worked
SELECT is_read_committed_snapshot_on
FROM sys.databases
WHERE [name] = 'MyDB ' 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2012-05-10T12:43:23.390

在更改当前数据库之前尝试使用 master 数据库。

```
USE Master
GO

ALTER DATABASE [YourDatabase] SET READ_COMMITTED_SNAPSHOT ON
GO 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2012-11-12T11:41:21.797

当我将数据库更改为单用户时，我没有花一秒钟时间

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2021-09-08T13:44:12.117

您需要做的就是：ALTER DATABASE xyz SET READ_COMMITTED_SNAPSHOT ON WITH ROLLBACK IMMEDIATE；

无需将数据库置于单用户模式。不过，您将回滚未提交的事务。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2017-03-28T18:59:00.433

尝试关闭其他 SQL 服务，以便只有 SQL 服务器服务正在运行。

我的运行了 5 分钟，然后我取消了它，因为很明显没有发生任何事情。它是一个全新的服务器，因此没有其他用户连接。我关闭了 SQL Reporting Services，然后再次运行它。不到一秒钟就完成了。

# c# - 忽略异常

> ID：232344
> 
> 赞同：6
> 
> 时间：2008-10-24T02:58:02.500
> 
> 标签：c#, exception-handling

我有一些忽略特定异常的代码。

```
try
{
    foreach (FileInfo fi in di.GetFiles())
    {
        collection.Add(fi.Name);
    }
    foreach (DirectoryInfo d in di.GetDirectories())
    {
        populateItems(collection, d);
    }
}
catch (UnauthorizedAccessException ex)
{
   //ignore and move onto next directory
} 
```

当然，这会导致编译时警告，因为 ex 未使用。是否有一些标准的接受 noop 应该用来删除这个警告？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-10-24T02:59:47.460

只需将其重写为

```
catch (UnauthorizedAccessException) {} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-24T03:11:06.187

正如 Dave M. 和 tvanfosson 所说，您想将其重写为

```
catch (UnauthorizedAccessException) {} 
```

然而，应该问的更大的问题是，为什么你会在忽略它时捕获异常（通常称为吞下异常）？这通常是一个坏主意，因为它可以（并且通常确实）在运行时隐藏应用程序中的问题，这可能导致非常奇怪的结果和调试它们的困难时间。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-24T03:06:26.617

我通常会

```
Debug.WriteLine(ex.message) 
```

（这样我也可以在异常中设置断点，如果需要的话）

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-24T07:29:36.027

假设原始代码中的注释是对您要执行的操作的准确描述，我认为您想这样写：

```
foreach (FileInfo fi in di.GetFiles())
{
    //TODO:  what exceptions should be handled here?
    collection.Add(fi.Name);
}

// populate collection for each directory we have authorized access to
foreach (DirectoryInfo d in di.GetDirectories())
{
    try
    {
        populateItems(collection, d);
    }
    catch (UnauthorizedAccessException)
    {
        //ignore and move onto next directory
    }
} 
```

然后你需要处理那个 TODO 项目。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-06-02T01:16:12.860

我同意那些说简单地忽略异常可能是个坏主意的人的观点。如果您不打算重新扔它，那么至少将它记录在某个地方。我编写了一些小工具来处理文件列表，我不希望单个文件上的错误导致整个程序崩溃，在这种情况下，我会打印一条警告消息，以便查看哪些文件被跳过。

我个人唯一一次在不命名的情况下捕获异常，例如在 catch(xxxException) 中，是我是否要以某种方式对其做出反应然后重新抛出它，以便我可以在一些外部例程中捕获它。例如：

```
try
{
    // do something
    // ...
}
catch(UnauthorizedAccessException)
{
    // react to this exception in some way
    // ...

    // let _someone_ know the exception happened
    throw;
} 
```

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-10-24T03:56:09.467

即使我是一名 Java 开发人员（不是 C#），@Scott Dorman 也是绝对正确的。你为什么要“吞下例外”？更好的是，什么*会*引发 UnauthorizedAccessException？以下是常识性的可能性：

1.  文件不存在
2.  目录不存在
3.  当前控制线程没有正确的安全权限。在 *nix 世界中，当前线程可能在错误的组或错误的用户中。
4.  磁盘崩溃了
5.  文件的 ACL 设置为只写不读。同样，对于目录。

以上当然是一个不完整的列表。

# .net - 什么插件/工作台框架是 Eclipse RCP 的最佳 .NET 替代品？

> ID：232345
> 
> 赞同：7
> 
> 时间：2008-10-24T02:58:11.877
> 
> 标签：.net, eclipse, plugins, add-in, extensibility

我正在寻找一个可与 Eclipse 插件框架相媲美的基于插件的应用程序框架，在我看来，它包括：

1.  一个核心**插件管理框架**（Equinox / OSGI），它提供了声明扩展端点的能力，然后发现和加载为这些端点提供服务的插件。（这与依赖注入不同，但不可否认，差异是微妙的 - 配置高度分散，存在版本控制问题，可能涉及在线插件存储库，对我来说最重要的是，**用户**应该很容易添加插件，无需了解底层架构/配置文件）
2.  多层插件，提供**基本的工作台外壳**，支持并发、命令、首选项表、菜单、工具栏、键绑定等。

这只是触及了 RCP 的表面，它本身旨在作为您的应用程序的基础，您可以通过编写/组装**更多**插件来构建它。

* * *

以下是我这两天从网上搜集到的……

据我所知，.NET 世界中没有任何东西可以远程接近 Eclipse RCP for Java 的健壮性和成熟度，但是有几个竞争者在 #1 或 #2 方面做得很好。

（我还要提一下，我还没有对 WinForms 和 WPF 做出最终决定，所以我也在尝试了解任何候选框架中的 UI 耦合程度。我也想知道平台耦合和源代码许可）

我必须说，开源的东西通常文档较少但更容易理解，而 MS 的东西通常有更多的文档但更难访问，所以对于许多 MS 技术，我想知道它们实际上做了什么，在实际意义上。

这些是我找到的库：

## 夏普发展

我看到的第一件事是 SharpDevelop，它以基本的方式同时执行 #1 和 #2（没有侮辱 SharpDevelop，这是令人钦佩的 - 我的意思是比 Eclipse RCP*更基本）。*然而，SharpDevelop 是一个应用程序而不是一个框架，并且存在基本的假设和限制（即在某种程度上与 WinForms 耦合）。尽管如此，还是有一些关于 CodeProject 的文章解释了如何将其用作应用程序的基础。

## 系统插件

System.Addins 似乎旨在提供一个强大的加载项加载框架，具有一些复杂的选项，用于加载具有不同信任级别的程序集，甚至运行进程外。它似乎主要是基于代码的，而且代码量很大，有许多程序集用于隔离版本控制问题。使用 Guidance Automation 生成大量代码。

到目前为止，我还没有找到很多 System.AddIns 文章来说明如何使用它来构建类似 Eclipse RCP 的东西，而且许多人似乎对它的复杂性感到不安。

## 单声道插件

Mono.Addins 似乎受到 System.Addins、SharpDevelop 和 MonoDevelop 的影响。它似乎提供了 System.Addins 的基础知识，插件加载选项不太复杂，但更简单，具有基于属性的注册、XML 清单和在线插件存储库的基础设施。

它有一个很好的常见问题解答和文档，以及一组相当健壮的示例，这些示例真正有助于描绘如何开发像 SharpDevelop 或 Eclipse 这样的架构。这些示例将 GTK 用于 UI，但框架本身并未与 GTK 耦合。所以它似乎很好地完成了#1（加载项加载），并为#2（工作台框架）指明了方向。看起来 Mono.Addins 是从 MonoDevelop 派生的，但我还没有真正研究过 MonoDevelop 是否提供了一个好的核心工作台框架。

## 托管可扩展性框架

这是目前每个人都在谈论的内容，并且它的作用正在慢慢变得清晰，但我仍然很模糊，即使在阅读了几篇关于 SO 的帖子之后。官方的说法是它“可以与 System.Addins 并存”。但是，它没有引用它，并且似乎重现了它的一些功能。因此，在我看来，它是 System.Addins 的更简单、更易于访问的替代方案。

它似乎更像 Mono.Addins，因为它提供了基于属性的连接。它提供了可以基于属性或基于目录的“目录”。它似乎没有提供任何 XML 或基于清单的连接。到目前为止，我还没有找到太多的文档，而且这些示例似乎有点“神奇”，更让人联想到基于属性的 DI，尽管澄清说 MEF 不是 DI 容器。

它的许可证刚刚开放，但它确实引用了 WindowsBase——不确定这是否意味着它与 Windows 耦合。

## 卫城

我不确定这是什么。是 MEF，还是即将到来的？

## 复合应用程序块

WPF 和 Winforms 复合应用程序块似乎提供了更多的工作台框架。我对这些几乎没有经验，但它们似乎在很大程度上依赖于 Guidance Automation，显然与 UI 层相结合。有几个将 MEF 与这些应用程序块相结合的示例。

* * *

我已经尽我所能在这里回答我自己的问题，但我真的只是在摸索表面，而且我对这些框架中的任何一个都没有经验。希望你们中的一些人可以添加有关您所使用的框架的更多细节。如果我们最终能得到某种比较矩阵，那就太好了。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-24T04:12:30.400

可以考虑...

[WPF 和 Silverlight 的复合应用程序指南](http://www.codeplex.com/CompositeWPF)

[视觉工作室 2008 外壳](http://msdn.microsoft.com/en-us/vstudio/bb510103.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-12T18:16:33.410

你真的应该看看 Visual Studio Shell。它可以在集成模式下使用，您的应用程序作为插件驻留在 Visual Studio 旁边，或者您可以在隔离模式下使用 shell，其中 shell 仅用作应用程序的基本框架，类似于 Eclipse shell。看看这个[网页](http://msdn.microsoft.com/en-us/vsx2008/products/bb933751.aspx)。

Visual Studio shell 功能强大、功能丰富且免费。我还没有对它进行任何开发，但我一直在为即将到来的项目寻找它。它看起来就像 Eclipse 一样强大的插件框架。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-04-22T21:39:23.503

+1 为 SharpDevelop。这些库编写良好且易于扩展。我实际上是在使用 SharpDevelop Core 和他们的 Addin 基础设施编写自己的代码重构应用程序。

非常好。

-道格

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-11-11T18:14:16.140

我刚刚将[SoapBox Core](http://soapboxcore.com/)作为开源发布并写了[一篇关于 CodeProject](http://www.codeproject.com/KB/WPF/SoapBoxCorePinBallDemo.aspx)的介绍性文章。这基本上就是你要找的东西。它使用 MEF 来实现可扩展性，我从 SharpDevelop 那里得到了很多想法。请注意，它是全新的并且仍在快速发展。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-24T04:34:50.090

虽然我不熟悉 RCP 的细节，但我认为[DxCore](http://www.devexpress.com/Products/Visual_Studio_Add-in/DXCore/)可能会成为使用托管代码扩展 Visual Studio 的最完整框架。它使用基于插件的架构，使您能够创建从工具窗口（托管您想要的任何代码）到“操作”（可以绑定到键盘快捷键和上下文菜单的项目）和重构的任何内容，具有极其丰富的功能上下文系统和与语言无关的代码生成引擎。它在 Visual Studio 相当可怕的底层之上提供了一个非常好的抽象层。它也被编写为与版本无关，因此针对 DxCore 编写的插件将适用于 VS 2005 和 VS 2008。

虽然它是免费的，但它不是开源的，遗憾的是，文档很少。您提供了示例，这是一个好的开始，但这里有一些其他资源可能有用：

*   [Mark Miller](http://community.devexpress.com/blogs/markmiller/)是 DxCore/CodeRush/Refactor Pro! 的架构师，他的博客（和[DNR 电视剧](http://dnrtv.com/default.aspx?showID=5)集）上有一些关于编写 DxCore 插件的帖子。
*   有一个[社区论坛](http://community.devexpress.com/forums/)，您可以在其中发布问题。紧随其后的是 Mark 和其他一些 DxCore 开发人员，以及来自社区的一些人
*   [Google 代码上的DxCore 插件](http://code.google.com/p/dxcorecommunityplugins/)。尝试将社区创建的插件收集到一个地方。这是工具和重构的完美结合，尽管有些已经过时。

希望这对您有用。我唯一要说的很糟糕，它可能没有被更广泛地使用的原因是它是一个如此大的库，几乎没有文档，你必须愿意挖掘以了解如何使用一些更酷的功能。

祝你好运！

# auto-update - 我应该如何实现自动更新程序？

> ID：232347
> 
> 赞同：76
> 
> 时间：2008-10-24T02:59:17.770
> 
> 标签：auto-update

许多程序包括一个自动更新程序，程序偶尔会在线查找更新，然后下载并应用找到的任何更新。程序错误被修复，支持文件被修改，事情（通常）变得更好。

不幸的是，无论我怎么看，我都无法在任何地方找到有关此过程的信息。似乎已经实施的自动更新程序要么是专有的，要么被认为不重要。

实现在网络上查找更新并在可用时下载更新的系统似乎相当容易。自动更新程序的那部分将在不同的实现之间发生显着变化。问题是**应用**补丁的不同方法是什么。只是下载文件并用新文件替换旧文件、运行已下载的迁移脚本、猴子修补系统的某些部分等等？概念是首选，但 Java、C、Python、Ruby、Lisp 等中的示例将不胜感激。

* * *

## 回答 #1

> 赞同：54
> 
> 时间：2008-10-24T03:12:38.493

我认为“语言不可知论”将成为这里的一个限制因素。应用程序有如此多的形状和大小，以至于没有一刀切的答案。我已经用几种语言实现了几个自动更新程序，没有两个是相似的。

最普遍的理念是应用程序检查某个家庭位置（网址、Web 查询、公司网络位置等）以询问它的版本是否是最新的，或者询问最新的版本是什么。如果答案要求更新，则该过程将因每种情况而异。

一种流行的替代方法是在启动应用程序时邀请主位置运行脚本。例如，该脚本可以检查版本、下载更新（如有必要）以及询问使用反馈。

如果您缩小参数范围，我们可能会提供更好的帮助。

更新：“修补”的方法也取决于应用程序的性质，这里有非常广泛的多样性。例如，如果您有一个可执行文件，那么替换该可执行文件可能是最实用的。如果你的应用程序有很多文件，你应该寻找方法来最小化被替换的文件数量。如果您的应用程序是高度定制化或参数化的，您应该尽量减少重新定制的工作量。如果您的应用程序使用解释代码（例如 Excel VBA 应用程序或 MS Access MDB 应用程序），那么您可以替换部分代码。在 Java 应用程序中，您可能只需要替换 JAR 文件，甚至是 JAR 内容的子集。您还需要有一种方法来识别当前的客户端版本，并适当地更新它。我可以继续说下去，但我希望你能明白我关于多样性的观点。这是最佳答案通常以“嗯，这取决于......！”开头的许多次之一。这就是为什么这么多答案包括“请缩小参数”。

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2009-01-28T06:45:53.607

请务必考虑提取有关更新的信息以及更新二进制文件本身的安全隐患。

你相信下载的来源吗？您可能会打电话回家获取更新，但如果中间有人重定向到恶意服务器怎么办。HTTPS 或类似的安全连接会有所帮助，但建议使用数字签名检查仔细检查您最终下载的位。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-12-04T06:41:53.390

首先，您需要在您的应用程序主页网站上找到一个最新版本的文件。我认为最好的方法是为此任务提供特殊的 SQL 表，并在发布新版本/每晚构建完成后自动填充它。您的应用程序创建新线程，该线程请求带有版本的内置 http 链接并与当前进行比较。在 .NET 中使用可以使用如下代码：

```
Version GetLatestVersion() {
HttpWebRequestrequest = (HttpWebRequest)WebRequest.Create(new Uri(new Uri(http://example.net), "version.txt));
HttpWebResponse response = (HttpWebResponse)request.GetResponse();
if (request.HaveResponse)
{
  StreamReader stream = new StreamReader(response.GetResponseStream(), Encoding.Default);
  return new Version(stream.ReadLine());
}
else
{
  return null;
}
}

Version latest = GetLatestVersion();
Version current = new Version(Application.ProductVersion);
if (current < latest)
{
  // you need an update
}
else
{
  // you are up-to-date
} 
```

在此示例中，version.php 仅在一个纯字符串中，例如 1.0.1.0。

我可以给出的另一个提示 - 如何下载更新。我非常喜欢下一个想法：在您的应用程序的资源中有一个 CLR 代码字符串，您可以将其即时编译（使用 CodeDom）到一个临时文件夹，主应用程序调用它并关闭。更新程序读取参数、设置或注册表并下载新模块。并调用删除所有临时文件的主应用程序。完毕！

（但这里的一切都是关于 .NET）

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-01-28T07:51:31.353

最简单的解决方案（被许多程序使用）是运行旧版本的卸载程序和运行新版本的安装程序（可以选择跳过用户已经回答的问题，如 EULA）。唯一的问题是新版本必须能够从旧版本中读取配置选项。

此外，在 Windows 上，您无法删除正在使用的可执行文件，因此您可能需要在 Temp 文件夹中放置一个小型可执行文件，该文件夹会运行整个过程，然后在最后从新版本的实例中删除它已启动（或仅[将其注册以在下次重新启动时将其删除](http://msdn.microsoft.com/en-us/library/aa365240(VS.85).aspx)）。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-24T03:14:03.747

最简单的方法是让您的程序查询服务器（网站）以查看是否有更新。如果有更新，您可以向用户显示一条消息，提示他们下载较新版本并提供链接。

另一种更复杂的解决方案是创建一个小型 Windows 服务（或 unix 守护程序），定期检查是否有更新，该服务可以下载更新并启动安装程序。

一般架构是您拥有一个您控制的中央服务器，该服务器知道最新版本以及从何处获取它。然后程序查询服务器。我不会包含示例代码，因为它在服务器和您选择的格式上是高度被告。不过这并不难。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-01-28T07:46:15.920

这不是一个完整的答案，而是我最近实现的自动更新机制的一个例子。这种情况与传统的 Firefox 类型的用户应用程序略有不同，因为它是工作中使用的内部工具。

基本上，它是一个小脚本，用于管理要在安装程序中构建和打包的 Subversion 分支队列。它读取一个小文件，其中写入了分支的名称，获取第一个文件，在文件末尾重新写入，然后启动构建过程，其中涉及调用一堆脚本。每个要构建的分支的配置都写在一个 .INI 文件中，与工具本身一起存储在 Subversion 存储库中。

因为这个工具可以在多台计算机上运行，​​所以我想要一种方法来在我对工具本身或配置脚本进行更改后立即在所有机器上自动更新它。

我实现它的方式很简单：当我启动该工具时，它就变成了一个“外壳”。这个外壳做了两件非常简单的事情：

*   `svn update`在自身和配置文件上
*   再次启动自身，这次作为“内壳”，实际处理一种配置（然后再次退出）。

这个非常简单的 update-myself-in-a-loop 系统已经为我们服务了几个月了。它非常优雅，因为它是独立的：自动更新程序就是程序本身。因为“外壳”（自动更新程序部分）非常简单，所以它不会像“内壳”一样从更新中受益（每次都从更新的源文件执行）。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-01-28T08:28:41.950

因为自动更新是一种常见的场景，所以大多数语言至少有一个包可以支持这一点。（下面我列出了一些可用的包）

一个非常好的想法是用于 .NET 的[ClickOnce](http://msdn.microsoft.com/en-us/library/wh45kb66.aspx)发行版，它是一个安装程序，可将您的应用程序沙箱化并安装在用户上下文中，因此不需要管理员权限。您可以在发布中配置 ClickOnce 以检查每个应用程序启动时的更新。

Java 有[Java Web Start](http://java.sun.com/javase/technologies/desktop/javawebstart/index.jsp)，它为 Java 小程序提供了相同的功能。

Delphi 有很多关于自动更新的文章，Torry 有一个[WebUpdate 组件](http://www.torry.net/pages.php?id=56)列表，例如[GoUpdater](http://www.ionworx.com/goupdater.html)似乎有非常广泛的功能。

他们都使用网站/网络共享来检查新版本，然后检索补丁或完整的安装文件并运行它。因此，您应该尝试为您的应用程序找到一个不错的包，以节省您开发和维护自己的解决方案的麻烦。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-01-29T23:53:30.250

没有真正提到的一件事是，您应该认真考虑运行您的程序的用户实际上可能没有足够的权限来升级它。至少对于商业用户来说，这应该很常见，对于家庭用户来说可能不太常见。

出于安全原因，我总是使用（自我强加的）受限帐户，并且总是让我生气的是，大多数自动更新程序只是假设我以管理员身份运行，然后在下载后失败并且没有提供其他执行方式除了实际关闭程序并在管理上下文中再次运行它之外的更新。大多数人甚至不缓存下载的更新，而必须从头再来。

如果自动更新程序在需要时只提示输入管理员凭据并继续使用它会更好。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-01-30T00:09:15.743

我将假设 Windows 的答案。

这种方式似乎运作良好。

在安装程序中执行以下操作：
1\. 创建作为 LocalSystem 运行的手动启动服务，启动时更新会停止。
2\. 更改服务权限，以便所有用户都可以启动服务（如果所有用户都应该能够在没有管理员权限的情况下进行更新）。
3\. 使用简单的机制更改主程序以在启动时检查更新。如果它检测到更新，则提示用户是否要应用它。
4\. 如果用户接受更新，启动服务。

如果架构允许，请创建一种在更新运行时监控更新的方法。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-01-28T07:33:47.100

在 Java-Webstart 设置中，您启动一​​个 JNLP 文件，然后触发下载运行应用程序所需的 Jar 文件。每次 webstart 都会检查是否有更新版本的罐子，并下载它们以替换本地缓存的罐子。使用名为 jardiff 的工具，您将只创建对较新 jar 的差异，并通过服务器分发这些差异（例如，仅获取更新）。

优点：

*   始终保持最新

缺点：

*   您需要一个应用程序服务器（tomcat、JBoss）来分发文件
*   您需要互联网连接才能获得应用程序

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-01-28T07:56:46.100

阅读 Carl Seleborgs 的回答给了我一些想法，通用代码存储库如何有用。

svn 带有一个名为 svnsync 的工具，它的行为类似于 svn 导出，但会跟踪导出的实际版本。

有人可以利用该系统仅从用户的实际修订中获取更改的文件。

实际上，您将拥有一个已编译二进制文件的存储库，并且运行 svnsync 只会获取已修改的二进制文件。它还可以将本地更改与新的配置选项合并到基于文本的配置文件中。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-01-28T08:05:32.153

为程序安装补丁的功能基本上是安装程序的基本功能之一。安装程序软件记录在许多地方，但通常以每个安装程序为基础：[Microsoft Installer](http://en.wikipedia.org/wiki/Windows_Installer)（带有 Install Shield Extensions）、[Ruby gems](http://www.rubygems.org/)、[Java .jar](http://www.denova.com/JExpress/features.html)文件、各种 Linux 包管理器系统（[RPM](http://en.wikipedia.org/wiki/RPM_Package_Manager)、[Apt-get](http://en.wikipedia.org/wiki/Dpkg)）等.

这些都是复杂的系统，通常可以解决修补程序的问题，但系统略有不同。要决定什么最适合您，请考虑您的应用程序最类似于这些系统中的哪一个。自己动手很好，但看看这些系统是一个开始。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-01-28T08:56:50.707

您可以编写应用程序的内部模块来进行更新。您可以编写一个外部迷你应用程序来进行更新。

还要看看 .NET on-the-fly 编译技术，它使得按需动态创建这样的迷你应用程序成为可能。例如， http: [//fly.sf.net/](http://fly.sf.net/)

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2015-04-28T20:53:48.180

您可以使用我的解决方案（[Target Eye](http://www.targeteye.biz)项目的一部分）。 [http://www.codeproject.com/Articles/310530/Target-Eye-Revealed-part-Target-Eyes-Unique-Auto](http://www.codeproject.com/Articles/310530/Target-Eye-Revealed-part-Target-Eyes-Unique-Auto)

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2018-11-27T09:43:52.583

如果您的软件是开源的，并且针对 Linux 或开发人员。将您的软件安装为 git repo 很有趣。并让它偶尔或每次启动时都会拉动稳定的分支。

当您的应用程序通过 npm、sbt、mavan、stack、elm-package 等进行管理时，这尤其容易。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2021-08-30T07:47:23.387

经过数小时为这个问题寻找一些可行的解决方案后，我终于实现了适用于 Linux 和 Windows 的 python 脚本的自动更新机制。

简而言之 - 运行实际工作之前的脚本会检查 S3 上的更新，如果可用，则下载它、解压缩、创建或更新符号链接（或 Windows 上的连接），并使用带有原始参数的新版本重新运行脚本。

完整的源代码和解释可以在[这里](https://codeflex.co/python-script-autoupgrade/)找到。

* * *

## 回答 #17

> 赞同：-1
> 
> 时间：2014-03-25T13:06:00.540

如果您正在寻找跨平台软件更新解决方案，请访问[www.updatenode.com](http://www.updatenode.com)

一些亮点：

*   开源项目免费
*   跨平台开源更新客户端工具
*   已经针对最重要的语言进行了本地化
*   易于集成且易于处理
*   基于云的管理平台，用于定义和管理更新
*   提供对显示消息的额外支持（关于新事件、产品等的通知）
*   Web 界面已打开（您可以使用该服务创建自己的客户端）
*   许多使用统计，如使用的操作系统、地理位置、版本使用等。
*   用于移动应用更新的 Android API

就试一试吧。

顺便说一句，我是开源客户端开发团队的一员。:)

# c# - 如何在 .NET 中进行应用程序内通信

> ID：232357
> 
> 赞同：3
> 
> 时间：2008-10-24T03:04:34.530
> 
> 标签：c#, .net, windows

在 C# 中将数据从一个 Windows 窗体应用程序（Office 插件）传递到另一个（用 C# 编写的 exe）的最佳方法是什么？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-24T04:02:52.853

我会对此进行猛烈抨击，并说您可能希望办公应用程序给您的 exe*打电话回家？*在这种情况下，“exe”是服务器，office 应用程序是客户端。

如果您使用的是 .NET 3.0，WCF 可能是您的最佳选择。我将解决方案分为三个部分：

1.  “共享合同”。这些是描述您的服务的接口。如果您有将在应用程序之间传递的自定义数据对象，则它们也应该在此程序集中定义。该程序集在客户端和服务器之间共享。有关详细信息，请参阅“[设计服务合同](https://docs.microsoft.com/en-us/dotnet/framework/wcf/designing-service-contracts)”。
2.  “服务”。该程序集是您的“exe”，它将引用合同并根据您的服务合同定义类。您的应用还将为您的服务托管一个 ServiceClient。此应用程序的配置文件将定义您的 ServiceClient 将如何暴露给客户端（可作为 Web 服务、tcp 等使用）。有关详细信息，请参阅“[实施服务合同](https://docs.microsoft.com/en-us/dotnet/framework/wcf/implementing-service-contracts)”。
3.  “客户”。您的插件将引用“共享合同”程序集，并将包含基于合同的服务客户端。客户端可以使用 svcutil.exe 工具自动生成。

“exe”和“plugin”都需要定义绑定的配置文件。

当您想在客户端和服务器之间传递数据时，您的客户端将从“共享合同”程序集中创建一个对象并将其传递给服务客户端。客户端的配置文件将确定将数据发送到哪里。

有关如何创建基本 WCF 服务的分步教程，[请查看本教程](https://docs.microsoft.com/en-us/dotnet/framework/wcf/getting-started-tutorial)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-24T05:36:17.470

是的。WCF 是要走的路。我建议查看 iDesign.net 以使用 InProcFactory 类。您可以将您的办公室类填充到服务中，并调用托管服务的其他应用程序。然后，其他服务可以回调到基于办公室的服务。

您可以使用 IPC 端点，这将使通信变得快速。

-斯科特

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-24T03:55:10.030

[WCF](http://msdn.microsoft.com/en-us/netframework/aa663324.aspx)是最简单的方法之一。您可以在每个应用程序中注册一个服务端点，或者如果一个是服务而另一个是客户端，您可以只使用一个服务主机。

[查看入门教程。](http://msdn.microsoft.com/en-us/library/ms734712.aspx)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-24T03:57:21.727

有很多方法可以实现这一目标。我过去使用过命名管道。对命名管道的支持现在也内置在 .NET 中（根据 3.0？），所以它相当简单。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-24T05:03:03.480

老派，但它有效 -[使用 WM_COPYDATA 在 Windows 应用程序之间发送消息](http://www.codeproject.com/KB/cs/wm_copydata_use.aspx)

# wpf - 如何使工具栏中的项目填充 WPF 中的所有可用空间

> ID：232386
> 
> 赞同：11
> 
> 时间：2008-10-24T03:26:01.900
> 
> 标签：wpf, layout, toolbar

我正在尝试在 ToolBar 上创建一个项目（特别是标签、文本块或文本框），它将填充所有可用的水平空间。我已经通过从 ToolBarTray 中取出 ToolBar 本身来拉伸它，但我不知道如何使项目拉伸。

我尝试将 Width 设置为 Percenatage 或 Star 值，但它不接受。在各个地方将 Horizo​​ntal(Content)Alignment 设置为 Stretch 似乎也没有效果。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-11-18T19:08:41.673

不幸的是，ToolBar 的默认 ControlTemplate 似乎不使用 ItemsPresenter，它使用 ToolBarPanel，因此设置 ToolBar.ItemsPanel 不会有任何效果。

ToolBarPanel 继承自 StackPanel。默认情况下，它的方向绑定到父 ToolBar.Orientation，但您可以覆盖它并使用样式将其方向设置为垂直，这将允许项目水平拉伸：

```
<DockPanel>
    <ToolBar DockPanel.Dock="Top">
        <ToolBar.Resources>
            <Style TargetType="{x:Type ToolBarPanel}">
                <Setter Property="Orientation" Value="Vertical"/>
            </Style>
        </ToolBar.Resources>
        <ComboBox HorizontalAlignment="Stretch" SelectedIndex="0">
            <ComboBoxItem>A B C</ComboBoxItem>
            <ComboBoxItem>1 2 3</ComboBoxItem>
            <ComboBoxItem>Do Re Mi</ComboBoxItem>
        </ComboBox>
    </ToolBar>
    <Border Margin="10" BorderBrush="Yellow" BorderThickness="3"/>
</DockPanel> 
```

然后，如果您希望一行中有多个项目，则可以使用 Grid 或其他东西代替上面的 ComboBox。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-24T04:47:26.650

您需要一个特殊的自定义面板，例如**自动拉伸堆栈面板**，并替换工具栏面板。看看这个，你可以在那里找到一个面板 [http://blendables.com/products/productsLayoutmix.aspx](http://blendables.com/products/productsLayoutmix.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-29T20:35:53.597

我遇到同样的问题已经有一段时间了，网上的帮助很少。

既然听起来您不需要工具栏的所有额外功能（可折叠/可移动托盘），为什么不直接使用顶部停靠网格，并稍微调整背景以使其看起来像标准工具栏？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-08T08:32:54.443

您是否尝试过将项目包装在 Grid 中，而不是 StackPanel 中？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-24T03:33:18.500

尝试在 ToolBar 中放置一个水平 StackPanel，然后在该 StackPanel 中放置您想要的元素。

# sql - 在 SQL 中，如何在范围内“分组”？

> ID：232387
> 
> 赞同：208
> 
> 时间：2008-10-24T03:26:27.310
> 
> 标签：sql, sql-server, tsql

假设我有一个带有数字列的表（我们称之为“分数”）。

我想生成一个计数表，显示每个范围内出现了多少次分数。

例如：

```
分数范围 | 出现次数
-------------------------------------
   0-9 | 11
  10-19 | 14
  20-29 | 3
   ... | ...

```

在此示例中，有 11 行得分在 0 到 9 之间，14 行得分在 10 到 19 之间，3 行得分在 20 到 29 之间。

有没有简单的方法来设置它？你有什么建议吗？

* * *

## 回答 #1

> 赞同：161
> 
> 时间：2008-10-24T12:01:46.510

在 SQL Server 2000 上，投票最高的答案都不是正确的。也许他们使用的是不同的版本。

以下是它们在 SQL Server 2000 上的正确版本。

```
select t.range as [score range], count(*) as [number of occurences]
from (
  select case  
    when score between 0 and 9 then ' 0- 9'
    when score between 10 and 19 then '10-19'
    else '20-99' end as range
  from scores) t
group by t.range 
```

或者

```
select t.range as [score range], count(*) as [number of occurrences]
from (
      select user_id,
         case when score >= 0 and score< 10 then '0-9'
         when score >= 10 and score< 20 then '10-19'
         else '20-99' end as range
     from scores) t
group by t.range 
```

* * *

## 回答 #2

> 赞同：38
> 
> 时间：2008-10-25T12:20:44.640

另一种方法是将范围存储在表中，而不是将它们嵌入到查询中。您最终会得到一个表格，称为 Ranges，如下所示：

```
LowerLimit   UpperLimit   Range 
0              9          '0-9'
10            19          '10-19'
20            29          '20-29'
30            39          '30-39' 
```

一个看起来像这样的查询：

```
Select
   Range as [Score Range],
   Count(*) as [Number of Occurences]
from
   Ranges r inner join Scores s on s.Score between r.LowerLimit and r.UpperLimit
group by Range 
```

这确实意味着设置一个表格，但是当所需范围发生变化时，它很容易维护。无需更改代码！

* * *

## 回答 #3

> 赞同：32
> 
> 时间：2008-10-24T04:05:56.983

我在这里看到的答案不适用于 SQL Server 的语法。我会使用：

```
select t.range as [score range], count(*) as [number of occurences]
from (
  select case 
    when score between  0 and  9 then ' 0-9 '
    when score between 10 and 19 then '10-19'
    when score between 20 and 29 then '20-29'
    ...
    else '90-99' end as range
  from scores) t
group by t.range 
```

编辑：见评论

* * *

## 回答 #4

> 赞同：27
> 
> 时间：2008-10-24T03:41:32.727

在 postgres 中（`||`字符串连接运算符在哪里）：

```
select (score/10)*10 || '-' || (score/10)*10+9 as scorerange, count(*)
from scores
group by score/10
order by 1 
```

给出：

```
 scorerange | count 
------------+-------
 0-9        |    11
 10-19      |    14
 20-29      |     3
 30-39      |     2 
```

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2008-10-24T05:54:45.437

James Curran 的回答在我看来是最简洁的，但输出不正确。对于 SQL Server，最简单的语句如下：

```
SELECT 
    [score range] = CAST((Score/10)*10 AS VARCHAR) + ' - ' + CAST((Score/10)*10+9 AS VARCHAR), 
    [number of occurrences] = COUNT(*)
FROM #Scores
GROUP BY Score/10
ORDER BY Score/10 
```

这假设我用来测试它的#Scores 临时表，我只是填充了 100 行，随机数在 0 到 99 之间。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-10-24T03:32:37.160

```
create table scores (
   user_id int,
   score int
)

select t.range as [score range], count(*) as [number of occurences]
from (
      select user_id,
         case when score >= 0 and score < 10 then '0-9'
         case when score >= 10 and score < 20 then '10-19'
         ...
         else '90-99' as range
     from scores) t
group by t.range 
```

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2008-10-24T03:32:48.390

```
select cast(score/10 as varchar) + '-' + cast(score/10+9 as varchar), 
       count(*)
from scores
group by score/10 
```

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2015-10-07T19:18:48.300

这将允许您不必指定范围，并且应该与 SQL 服务器无关。数学FTW！

```
SELECT CONCAT(range,'-',range+9), COUNT(range)
FROM (
  SELECT 
    score - (score % 10) as range
  FROM scores
) 
```

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2014-11-25T16:28:33.820

我会做一些不同的事情，以便它可以扩展而不必定义每个案例：

```
select t.range as [score range], count(*) as [number of occurences]
from (
  select FLOOR(score/10) as range
  from scores) t
group by t.range 
```

未经测试，但你明白了......

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-10-24T03:58:11.570

```
declare @RangeWidth int

set @RangeWidth = 10

select
   Floor(Score/@RangeWidth) as LowerBound,
   Floor(Score/@RangeWidth)+@RangeWidth as UpperBound,
   Count(*)
From
   ScoreTable
group by
   Floor(Score/@RangeWidth) 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2013-03-30T05:41:17.710

```
select t.blah as [score range], count(*) as [number of occurences]
from (
  select case 
    when score between  0 and  9 then ' 0-9 '
    when score between 10 and 19 then '10-19'
    when score between 20 and 29 then '20-29'
    ...
    else '90-99' end as blah
  from scores) t
group by t.blah 
```

如果您在 MySQL 中，请确保使用“范围”以外的其他词，否则在运行上述示例时会出错。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2014-07-15T12:18:56.297

因为在 ( `Range`) 上排序的列是一个字符串，所以使用字符串/单词排序而不是数字排序。

只要字符串有零来填充数字长度，排序在语义上仍然应该是正确的：

```
SELECT t.range AS ScoreRange,
       COUNT(*) AS NumberOfOccurrences
  FROM (SELECT CASE
                    WHEN score BETWEEN 0 AND 9 THEN '00-09'
                    WHEN score BETWEEN 10 AND 19 THEN '10-19'
                    ELSE '20-99'
               END AS Range
          FROM Scores) t
 GROUP BY t.Range 
```

如果范围是混合的，只需填充一个额外的零：

```
SELECT t.range AS ScoreRange,
       COUNT(*) AS NumberOfOccurrences
  FROM (SELECT CASE
                    WHEN score BETWEEN 0 AND 9 THEN '000-009'
                    WHEN score BETWEEN 10 AND 19 THEN '010-019'
                    WHEN score BETWEEN 20 AND 99 THEN '020-099'
                    ELSE '100-999'
               END AS Range
          FROM Scores) t
 GROUP BY t.Range 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2015-11-20T15:59:34.567

尝试

```
SELECT (str(range) + "-" + str(range + 9) ) AS [Score range], COUNT(score) AS [number of occurances]
FROM (SELECT  score,  int(score / 10 ) * 10  AS range  FROM scoredata )  
GROUP BY range; 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2020-08-13T09:08:15.673

```
select t.range as score, count(*) as Count 
from (
      select UserId,
         case when isnull(score ,0) >= 0 and isnull(score ,0)< 5 then '0-5'
                when isnull(score ,0) >= 5 and isnull(score ,0)< 10 then '5-10'
                when isnull(score ,0) >= 10 and isnull(score ,0)< 15 then '10-15'
                when isnull(score ,0) >= 15 and isnull(score ,0)< 20 then '15-20'               
         else ' 20+' end as range
         ,case when isnull(score ,0) >= 0 and isnull(score ,0)< 5 then 1
                when isnull(score ,0) >= 5 and isnull(score ,0)< 10 then 2
                when isnull(score ,0) >= 10 and isnull(score ,0)< 15 then 3
                when isnull(score ,0) >= 15 and isnull(score ,0)< 20 then 4             
         else 5  end as pd
     from score table
     ) t

group by t.range,pd order by pd 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2020-12-23T18:07:40.743

我来这里是因为我有类似的问题，但我发现简短的答案是错误的，而连续“案例”的答案需要大量工作，并且在我的代码中看到任何重复的内容都会伤害我的眼睛。所以这是解决方案

```
SELECT --MIN(score), MAX(score),
    [score range] = CAST(ROUND(score-5,-1)AS VARCHAR) + ' - ' + CAST((ROUND(score-5,-1)+10)AS VARCHAR),
    [number of occurrences] = COUNT(*)
FROM order
GROUP BY  CAST(ROUND(score-5,-1)AS VARCHAR) + ' - ' + CAST((ROUND(score-5,-1)+10)AS VARCHAR)
ORDER BY MIN(score) 
```

* * *

## 回答 #16

> 赞同：-2
> 
> 时间：2008-10-24T03:49:49.073

也许你问的是让这些事情继续下去......

当然，您将为查询调用全表扫描，如果包含需要计算的分数（聚合）的表很大，您可能需要一个性能更好的解决方案，您可以创建一个辅助表并使用规则，例如`on insert`- 你可以调查一下。

不过，并非所有 RDBMS 引擎都有规则！

# c# - 如何在 C# 中对二维（矩形）数组进行排序？

> ID：232395
> 
> 赞同：38
> 
> 时间：2008-10-24T03:29:39.940
> 
> 标签：c#, arrays, sorting

我有一个二维数组（字符串），它构成了我的数据表（行和列）。我想按任何列对该数组进行排序。我试图找到一种在 C# 中执行此操作的算法，但没有成功。

任何帮助表示赞赏。

* * *

## 回答 #1

> 赞同：45
> 
> 时间：2008-10-24T04:10:53.353

我可以检查一下 - 您是指矩形阵列 ( `[,]`) 还是锯齿状阵列 ( `[][]`)？

对锯齿状数组进行排序非常容易；[我在这里](http://groups.google.co.uk/group/microsoft.public.dotnet.languages.csharp/browse_thread/thread/1e1a4bd58144bf73/364f22121b566a3c#23b3e4487e91cd02)对此进行了讨论。显然，在这种情况下，这`Comparison<T>`将涉及一列而不是按序数排序 - 但非常相似。

对矩形数组进行排序比较棘手......我可能很想将数据复制到矩形数组或 a中，然后*在那里*`List<T[]>`排序，然后再复制回来。

 *这是一个使用锯齿状数组的示例：

```
static void Main()
{  // could just as easily be string...
    int[][] data = new int[][] { 
        new int[] {1,2,3}, 
        new int[] {2,3,4}, 
        new int[] {2,4,1} 
    }; 
    Sort<int>(data, 2); 
} 
private static void Sort<T>(T[][] data, int col) 
{ 
    Comparer<T> comparer = Comparer<T>.Default;
    Array.Sort<T[]>(data, (x,y) => comparer.Compare(x[col],y[col])); 
} 
```

对于使用矩形阵列......好吧，这里有一些代码可以在两者之间即时交换......

```
static T[][] ToJagged<T>(this T[,] array) {
    int height = array.GetLength(0), width = array.GetLength(1);
    T[][] jagged = new T[height][];

    for (int i = 0; i < height; i++)
    {
        T[] row = new T[width];
        for (int j = 0; j < width; j++)
        {
            row[j] = array[i, j];
        }
        jagged[i] = row;
    }
    return jagged;
}
static T[,] ToRectangular<T>(this T[][] array)
{
    int height = array.Length, width = array[0].Length;
    T[,] rect = new T[height, width];
    for (int i = 0; i < height; i++)
    {
        T[] row = array[i];
        for (int j = 0; j < width; j++)
        {
            rect[i, j] = row[j];
        }
    }
    return rect;
}
// fill an existing rectangular array from a jagged array
static void WriteRows<T>(this T[,] array, params T[][] rows)
{
    for (int i = 0; i < rows.Length; i++)
    {
        T[] row = rows[i];
        for (int j = 0; j < row.Length; j++)
        {
            array[i, j] = row[j];
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2008-10-24T03:56:10.730

将二维字符串数组加载到实际的 DataTable (System.Data.DataTable) 中，然后使用 DataTable 对象的 Select() 方法生成 DataRow 对象的排序数组（或使用 DataView 获得类似效果）。

```
// assumes stringdata[row, col] is your 2D string array
DataTable dt = new DataTable();
// assumes first row contains column names:
for (int col = 0; col < stringdata.GetLength(1); col++)
{
    dt.Columns.Add(stringdata[0, col]);
}
// load data from string array to data table:
for (rowindex = 1; rowindex < stringdata.GetLength(0); rowindex++)
{
    DataRow row = dt.NewRow();
    for (int col = 0; col < stringdata.GetLength(1); col++)
    {
        row[col] = stringdata[rowindex, col];
    }
    dt.Rows.Add(row);
}
// sort by third column:
DataRow[] sortedrows = dt.Select("", "3");
// sort by column name, descending:
sortedrows = dt.Select("", "COLUMN3 DESC"); 
```

您还可以编写自己的方法来对二维数组进行排序。这两种方法都是有用的学习经验，但 DataTable 方法可以让您开始学习在 C# 应用程序中处理数据表的更好方法。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2019-11-22T23:17:14.843

```
Array.Sort(array, (a, b) => { return a[0] - b[0]; }); 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-10-24T03:37:54.247

[这](https://web.archive.org/web/20160819174858/http://www.informit.com/guides/content.aspx?g=dotnet&seqNum=151)是 InformIt 的 Jim Mischel 的存档文章，它处理矩形和锯齿状多维数组的排序。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-24T04:07:53.640

这段代码应该做你所追求的，我没有将它概括为 n 乘 n，但这是直截了当的。也就是说-我同意MusiGenesis，使用另一个更适合此的对象（特别是如果您打算进行任何类型的绑定）

[（我在这里](http://channel9.msdn.com/forums/Coffeehouse/189171-Sorting-Two-Dimensional-Arrays-in-C/)找到了代码）

```
string[][] array = new string[3][];

array[0] = new string[3] { "apple", "apple", "apple" };
array[1] = new string[3] { "banana", "banana", "dog" };
array[2] = new string[3] { "cat", "hippo", "cat" };         

for (int i = 0; i < 3; i++)
{
   Console.WriteLine(String.Format("{0} {1} {2}", array[i][0], array[i][1], array[i][2]));
}

int j = 2;

Array.Sort(array, delegate(object[] x, object[] y)
  {
    return (x[j] as IComparable).CompareTo(y[ j ]);
  }
);

for (int i = 0; i < 3; i++)
{
  Console.WriteLine(String.Format("{0} {1} {2}", array[i][0], array[i][1], array[i][2]));
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-06-26T10:58:00.173

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;

namespace ConsoleApplication1
{
    class Program
    {
        static void Main(string[] args)
        {
            int[,] arr = { { 20, 9, 11 }, { 30, 5, 6 } };
            Console.WriteLine("before");
            for (int i = 0; i < arr.GetLength(0); i++)
            {
                for (int j = 0; j < arr.GetLength(1); j++)
                {
                    Console.Write("{0,3}", arr[i, j]);
                }
                Console.WriteLine();
            }
            Console.WriteLine("After");

            for (int i = 0; i < arr.GetLength(0); i++) // Array Sorting
            {
                for (int j = arr.GetLength(1) - 1; j > 0; j--)
                {

                    for (int k = 0; k < j; k++)
                    {
                        if (arr[i, k] > arr[i, k + 1])
                        {
                            int temp = arr[i, k];
                            arr[i, k] = arr[i, k + 1];
                            arr[i, k + 1] = temp;
                        }
                    }
                }
                Console.WriteLine();
            }

            for (int i = 0; i < arr.GetLength(0); i++)
            {
                for (int j = 0; j < arr.GetLength(1); j++)
                {
                    Console.Write("{0,3}", arr[i, j]);
                }
                Console.WriteLine();
            }
        }
    }
} 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2013-01-21T11:58:24.443

也可以看看Array.Sort Method [http://msdn.microsoft.com/en-us/library/aa311213(v=vs.71).aspx](http://msdn.microsoft.com/en-us/library/aa311213(v=vs.71).aspx)

例如 Array.Sort(array, delegate(object[] x, object[] y){ return (x[ i ] as IComparable).CompareTo(y[ i ]);});

来自[http://channel9.msdn.com/forums/Coffeehouse/189171-Sorting-Two-Dimensional-Arrays-in-C/](http://channel9.msdn.com/forums/Coffeehouse/189171-Sorting-Two-Dimensional-Arrays-in-C/)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-24T04:00:40.613

所以你的数组的结构是这样的（我要用伪代码说话，因为我的 C#-fu 很弱，但我希望你能明白我在说什么）

```
string values[rows][columns] 
```

`value[1][3]`第 1 行第 3 列的值也是如此。

您想按列排序，所以问题是您的数组偏离了 90 度。

作为第一次切割，你可以旋转它吗？

```
std::string values_by_column[columns][rows];

for (int i = 0; i < rows; i++)
  for (int j = 0; j < columns; j++)
    values_by_column[column][row] = values[row][column]

sort_array(values_by_column[column])

for (int i = 0; i < rows; i++)
  for (int j = 0; j < columns; j++)
    values[row][column] = values_by_column[column][row] 
```

如果您知道一次只想对一列进行排序，则可以通过提取要排序的数据来优化这一点：

```
 string values_to_sort[rows]
  for (int i = 0; i < rows; i++)
    values_to_sort[i] = values[i][column_to_sort]

  sort_array(values_to_sort)

  for (int i = 0; i < rows; i++)
    values[i][column_to_sort] = values_to_sort[i] 
```

在 C++ 中，您可以玩一些技巧来计算数组的偏移量（因为您可以将二维数组视为一维数组），但我不确定如何在 c# 中做到这一点。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-24T05:13:53.367

试试这个。基本策略是对特定列独立排序并记住条目的原始行。其余代码将循环遍历已排序的列数据并换出数组中的行。棘手的部分是记住更新原始列，因为交换部分将有效地改变原始列。

```
 public class Pair<T> {
            public int Index;
            public T Value;
            public Pair(int i, T v) {
                Index = i;
                Value = v;
            }
        }
        static IEnumerable<Pair<T>> Iterate<T>(this IEnumerable<T> source) {
            int index = 0;
            foreach ( var cur in source) {
                yield return new Pair<T>(index,cur);
                index++;
            }
        }
        static void Sort2d(string[][] source, IComparer comp, int col) {
            var colValues = source.Iterate()
                .Select(x => new Pair<string>(x.Index,source[x.Index][col])).ToList();
            colValues.Sort((l,r) => comp.Compare(l.Value, r.Value));
            var temp = new string[source[0].Length];
            var rest = colValues.Iterate();
            while ( rest.Any() ) {
                var pair = rest.First();
                var cur = pair.Value;
                var i = pair.Index;
                if (i == cur.Index ) {
                    rest = rest.Skip(1);
                    continue;
                }

                Array.Copy(source[i], temp, temp.Length);
                Array.Copy(source[cur.Index], source[i], temp.Length);
                Array.Copy(temp, source[cur.Index], temp.Length);
                rest = rest.Skip(1);
                rest.Where(x => x.Value.Index == i).First().Value.Index = cur.Index;
            }
        }

        public static void Test1() {
            var source = new string[][] 
            {
                new string[]{ "foo", "bar", "4" },
                new string[] { "jack", "dog", "1" },
                new string[]{ "boy", "ball", "2" },
                new string[]{ "yellow", "green", "3" }
            };
            Sort2d(source, StringComparer.Ordinal, 2);
        } 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-10-26T07:48:29.630

如果在读入或检索数据时可以将数据作为通用元组获取，那会容易得多；那么您只需要编写一个比较所需的元组列的排序函数，并且您有一个单维元组数组。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2010-07-01T19:35:45.997

我喜欢上面MusiGenesis 提出的DataTable 方法。它的好处是您可以按任何使用列名的有效 SQL 'order by' 字符串进行排序，例如，“x, y desc, z”表示“order by x, y desc, z”。（FWIW，我无法使用列序号使其工作，例如“3,2,1”表示“按 3,2,1 排序”）我只使用整数，但显然您可以将混合类型数据添加到 DataTable 和以任何方式对其进行排序。

在下面的示例中，我首先将一些未排序的整数数据加载到 Sandbox 中的 tblToBeSorted 中（未显示）。由于表及其数据已经存在，我将它（未排序）加载到二维整数数组中，然后加载到 DataTable 中。DataRows 数组是 DataTable 的排序版本。这个例子有点奇怪，因为我从数据库中加载了我的数组，然后可以对其进行排序，但我只是想将一个未排序的数组放入 C# 以与 DataTable 对象一起使用。

```
static void Main(string[] args)
{
    SqlConnection cnnX = new SqlConnection("Data Source=r90jroughgarden\\;Initial Catalog=Sandbox;Integrated Security=True");
    SqlCommand cmdX = new SqlCommand("select * from tblToBeSorted", cnnX);
    cmdX.CommandType = CommandType.Text;
    SqlDataReader rdrX = null;
    if (cnnX.State == ConnectionState.Closed) cnnX.Open();

    int[,] aintSortingArray = new int[100, 4];     //i, elementid, planid, timeid

    try
    {
        //Load unsorted table data from DB to array
        rdrX = cmdX.ExecuteReader();
        if (!rdrX.HasRows) return;

        int i = -1;
        while (rdrX.Read() && i < 100)
        {
            i++;
            aintSortingArray[i, 0] = rdrX.GetInt32(0);
            aintSortingArray[i, 1] = rdrX.GetInt32(1);
            aintSortingArray[i, 2] = rdrX.GetInt32(2);
            aintSortingArray[i, 3] = rdrX.GetInt32(3);
        }
        rdrX.Close();

        DataTable dtblX = new DataTable();
        dtblX.Columns.Add("ChangeID");
        dtblX.Columns.Add("ElementID");
        dtblX.Columns.Add("PlanID");
        dtblX.Columns.Add("TimeID");
        for (int j = 0; j < i; j++)
        {
            DataRow drowX = dtblX.NewRow();
            for (int k = 0; k < 4; k++)
            {
                drowX[k] = aintSortingArray[j, k];
            }
            dtblX.Rows.Add(drowX);
        }

        DataRow[] adrowX = dtblX.Select("", "ElementID, PlanID, TimeID");
        adrowX = dtblX.Select("", "ElementID desc, PlanID asc, TimeID desc");

    }
    catch (Exception ex)
    {
        string strErrMsg = ex.Message;
    }
    finally
    {
        if (cnnX.State == ConnectionState.Open) cnnX.Close();
    }
} 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2013-08-15T19:54:21.530

[这是一个老问题，但这是我刚刚根据来自 InformIt 的 Jim Mischel 的文章](http://www.informit.com/guides/content.aspx?g=dotnet&seqNum=151)构建的一个类，由[Doug L链接。](https://stackoverflow.com/users/19179/doug-l)

```
class Array2DSort : IComparer<int>
{
    // maintain a reference to the 2-dimensional array being sorted
    string[,] _sortArray;
    int[] _tagArray;
    int _sortIndex;

    protected string[,] SortArray { get { return _sortArray; } }

    // constructor initializes the sortArray reference
    public Array2DSort(string[,] theArray, int sortIndex)
    {
        _sortArray = theArray;
        _tagArray = new int[_sortArray.GetLength(0)];
        for (int i = 0; i < _sortArray.GetLength(0); ++i) _tagArray[i] = i;
        _sortIndex = sortIndex;
    }

    public string[,] ToSortedArray()
    {
        Array.Sort(_tagArray, this);
        string[,] result = new string[
            _sortArray.GetLength(0), _sortArray.GetLength(1)];
        for (int i = 0; i < _sortArray.GetLength(0); i++)
        {
            for (int j = 0; j < _sortArray.GetLength(1); j++)
            {
                result[i, j] = _sortArray[_tagArray[i], j];
            }
        }
        return result;
    }

    // x and y are integer row numbers into the sortArray
    public virtual int Compare(int x, int y)
    {
        if (_sortIndex < 0) return 0;
        return CompareStrings(x, y, _sortIndex);
    }

    protected int CompareStrings(int x, int y, int col)
    {
        return _sortArray[x, col].CompareTo(_sortArray[y, col]);
    }
} 
```

`data`给定一个您想要在第 5 列上排序的任意大小的未排序二维数组，您只需执行以下操作：

```
 Array2DSort comparer = new Array2DSort(data, 5);
        string[,] sortedData = comparer.ToSortedArray(); 
```

注意虚拟`Compare`方法和受保护的`SortArray`，这样您就可以创建专门的子类，这些子类总是对特定的列进行排序，或者对多列进行专门的排序，或者您想做的任何事情。这也是为什么`CompareStrings`被分解和保护的原因——任何子类都可以使用它进行简单的比较，而不是输入完整的`SortArray[x, col].CompareTo(SortArray[y, col])`语法。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2016-07-02T01:26:39.467

我知道为时已晚，但这是我的想法，您可能想考虑一下。

例如这是数组

```
{
m,m,m
a,a,a
b,b,b
j,j,j
k,l,m
} 
```

并且您想按第 2 列进行转换，然后

```
string[] newArr = new string[arr.length]
for(int a=0;a<arr.length;a++)
    newArr[a] = arr[a][1] + a;

// create new array that contains index number at the end and also the column values
Array.Sort(newArr);
for(int a=0;a<newArr.length;a++)
{
    int index = Convert.ToInt32(newArr[a][newArr[a].Length -1]);
    //swap whole row with tow at current index
    if(index != a)
    {
        string[] arr2 = arr[a];
        arr[a] = arr[index];
        arr[index] = arr2;
    }
} 
```

恭喜您已按所需列对数组进行了排序。您可以对其进行编辑以使其与其他数据类型一起使用

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2022-01-08T08:44:58.013

假设它是一个锯齿状数组，您可以使用 LINQ 或 Array.Sort() 方法对其进行排序。

**方法一：使用 LINQ**

```
var myOrderedRows = myArray.OrderBy(row => row[columnIndex]).ToArray(); 
```

在这里，LINQ 创建了一个新的 IEnumerable，需要将其转换为数组（使用`ToArray()`）myOrderedRows。您的原始数组仍未排序。可以在[此处](https://docs.microsoft.com/en-us/dotnet/api/system.linq.enumerable.orderby?view=net-6.0)的文档中找到更多详细信息。

**方法 2：使用 Array.Sort()**

```
Array.Sort(myArray, (p, q) => p[columnIndex].CompareTo(q[columnIndex])); 
```

在这种情况下，您的原始数组已就地排序。您还可以提供自定义比较器以获得更多比较规则。可以在[此处](https://docs.microsoft.com/en-us/dotnet/api/system.array.sort?view=net-6.0)的文档中找到更多详细信息。

# python - 如何仅在 django 中将外键选择限制为相关对象

> ID：232435
> 
> 赞同：71
> 
> 时间：2008-10-24T03:52:50.317
> 
> 标签：python, django, django-models

我有类似于以下的双向对外关系

```
class Parent(models.Model):
  name = models.CharField(max_length=255)
  favoritechild = models.ForeignKey("Child", blank=True, null=True)

class Child(models.Model):
  name = models.CharField(max_length=255)
  myparent = models.ForeignKey(Parent) 
```

如何将 Parent.favoritechild 的选择限制为只有其父母是其自身的孩子？我试过

```
class Parent(models.Model):
  name = models.CharField(max_length=255)
  favoritechild = models.ForeignKey("Child", blank=True, null=True, limit_choices_to = {"myparent": "self"}) 
```

但这会导致管理界面不列出任何孩子。

* * *

## 回答 #1

> 赞同：45
> 
> 时间：2008-10-30T23:07:01.880

我刚刚在 Django 文档中遇到[ForeignKey.limit_choices_to 。](http://docs.djangoproject.com/en/dev/ref/models/fields/#django.db.models.ForeignKey.limit_choices_to)尚不确定这是如何工作的，但这可能是正确的做法。

**更新：** ForeignKey.limit_choices_to 允许指定常量、可调用对象或 Q 对象以限制键的允许选择。一个常量显然在这里没有用，因为它对所涉及的对象一无所知。

使用可调用（函数或类方法或任何可调用对象）似乎更有希望。但是，如何从 HttpRequest 对象访问必要信息的问题仍然存在。使用[线程本地存储](https://stackoverflow.com/questions/160009/django-model-limitchoicestouser-user)可能是一种解决方案。

**2.更新：**这对我有用：

我创建了一个中间件，如上面链接中所述。它从请求的 GET 部分中提取一个或多个参数，例如“product=1”，并将此信息存储在线程局部变量中。

接下来模型中有一个类方法，它读取线程局部变量并返回一个id列表来限制外键字段的选择。

```
@classmethod
def _product_list(cls):
    """
    return a list containing the one product_id contained in the request URL,
    or a query containing all valid product_ids if not id present in URL

    used to limit the choice of foreign key object to those related to the current product
    """
    id = threadlocals.get_current_product()
    if id is not None:
        return [id]
    else:
        return Product.objects.all().values('pk').query 
```

如果未选择任何 ID，则返回包含所有可能 ID 的查询非常重要，这样正常的管理页面可以正常工作。

然后将外键字段声明为：

```
product = models.ForeignKey(
    Product,
    limit_choices_to={
        id__in=BaseModel._product_list,
    },
) 
```

问题是您必须提供信息以通过请求限制选择。我在这里看不到访问“自我”的方法。

* * *

## 回答 #2

> 赞同：39
> 
> 时间：2013-10-24T03:25:58.113

这样做的“正确”方法是使用自定义表单。从那里，您可以访问 self.instance，它是当前对象。例子 -

```
from django import forms
from django.contrib import admin 
from models import *

class SupplierAdminForm(forms.ModelForm):
    class Meta:
        model = Supplier
        fields = "__all__" # for Django 1.8+

    def __init__(self, *args, **kwargs):
        super(SupplierAdminForm, self).__init__(*args, **kwargs)
        if self.instance:
            self.fields['cat'].queryset = Cat.objects.filter(supplier=self.instance)

class SupplierAdmin(admin.ModelAdmin):
    form = SupplierAdminForm 
```

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2011-01-11T01:44:54.443

至少从 Django 1.1 开始，新的“正确”方法是重写 AdminModel.formfield_for_foreignkey(self, db_field, request, **kwargs)。

请参阅[http://docs.djangoproject.com/en/1.2/ref/contrib/admin/#django.contrib.admin.ModelAdmin.formfield_for_foreignkey](http://docs.djangoproject.com/en/1.2/ref/contrib/admin/#django.contrib.admin.ModelAdmin.formfield_for_foreignkey)

对于那些不想遵循以下链接的人来说，这是一个与上述问题模型相近的示例函数。

```
class MyModelAdmin(admin.ModelAdmin):
    def formfield_for_foreignkey(self, db_field, request, **kwargs):
        if db_field.name == "favoritechild":
            kwargs["queryset"] = Child.objects.filter(myparent=request.object_id)
        return super(MyModelAdmin, self).formfield_for_manytomany(db_field, request, **kwargs) 
```

我只是不确定如何获取正在编辑的当前对象。我希望它实际上是在某个地方，但我不确定。

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2008-10-24T06:28:47.740

这不是 django 的工作方式。您只会以一种方式创建关系。

```
class Parent(models.Model):
  name = models.CharField(max_length=255)

class Child(models.Model):
  name = models.CharField(max_length=255)
  myparent = models.ForeignKey(Parent) 
```

如果你试图从父母那里访问孩子，你会这样做 `parent_object.child_set.all()`。如果您在 myparent 字段中设置了一个 related_name，那么这就是您将其称为的名称。例如：`related_name='children'`，那么你会做`parent_object.children.all()`

阅读[文档](http://docs.djangoproject.com/en/dev/topics/db/models/#many-to-one-relationships) [http://docs.djangoproject.com/en/dev/topics/db/models/#many-to-one-relationships](http://docs.djangoproject.com/en/dev/topics/db/models/#many-to-one-relationships)了解更多信息。

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2015-04-05T08:24:42.950

如果您只需要 Django 管理界面中的限制，这可能会起作用。我基于另一个论坛的[这个答案](http://w3facility.org/question/django-limit-manytomany-queryset-based-on-selected-fk/#answer-13147522)- 虽然它是针对多对多关系的，但您应该能够替换`formfield_for_foreignkey`它以使其正常工作。在`admin.py`：

```
class ParentAdmin(admin.ModelAdmin):
    def get_form(self, request, obj=None, **kwargs):
        self.instance = obj
        return super(ParentAdmin, self).get_form(request, obj=obj, **kwargs)

    def formfield_for_foreignkey(self, db_field, request=None, **kwargs):
        if db_field.name == 'favoritechild' and self.instance:       
            kwargs['queryset'] = Child.objects.filter(myparent=self.instance.pk)
        return super(ChildAdmin, self).formfield_for_foreignkey(db_field, request=request, **kwargs) 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-10-24T16:44:40.307

@Ber：我已经向与此类似的模型添加了验证

```
class Parent(models.Model):
  name = models.CharField(max_length=255)
  favoritechild = models.ForeignKey("Child", blank=True, null=True)
  def save(self, force_insert=False, force_update=False):
    if self.favoritechild is not None and self.favoritechild.myparent.id != self.id:
      raise Exception("You must select one of your own children as your favorite")
    super(Parent, self).save(force_insert, force_update) 
```

这完全符合我的要求，但如果此验证可以限制管理界面下拉列表中的选择，而不是在选择后进行验证，那就太好了。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-11-17T14:40:04.950

我正在尝试做类似的事情。似乎每个人都说“你应该只用一种方式使用外键”可能误解了你正在尝试做的事情。

很遗憾，您想做的 limit_choices_to={"myparent": "self"} 不起作用......那本来是干净而简单的。不幸的是，“自我”没有被评估，而是作为一个普通的字符串通过。

我想也许我可以这样做：

```
class MyModel(models.Model):
    def _get_self_pk(self):
        return self.pk
    favourite = models.ForeignKey(limit_choices_to={'myparent__pk':_get_self_pk}) 
```

但是由于该函数没有通过 self arg 导致错误 :(

似乎唯一的方法是将逻辑放入使用此模型的所有表单中（即将查询集传递给表单字段的选项）。这很容易完成，但在模型级别拥有它会更加干燥。您覆盖模型的保存方法似乎是防止无效选择通过的好方法。

**更新**
以另一种方式查看我稍后的答案[https://stackoverflow.com/a/3753916/202168](https://stackoverflow.com/a/3753916/202168)

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-10-24T10:01:15.360

您想在创建/编辑模型实例时限制管理界面中可用的选项吗？

一种方法是验证模型。如果外部字段不是正确的选择，这可以让您在管理界面中引发错误。

当然，Eric 的回答是正确的：你真的只需要一个外键，从孩子到父母。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2010-09-20T17:36:57.720

另一种方法是不将“favouritechild”fk 作为父模型上的字段。

相反，您可以在 Child 上有一个 is_favourite 布尔字段。

这可能会有所帮助： [https ://github.com/anentropic/django-exclusivebooleanfield](https://github.com/anentropic/django-exclusivebooleanfield)

这样你就可以回避确保孩子只能成为他们所属父母的最爱的整个问题。

视图代码会略有不同，但过滤逻辑很简单。

在管理员中，您甚至可以有一个内联子模型，该模型暴露了 is_favourite 复选框（如果您每个父级只有几个子级），否则管理员必须从子级一侧完成。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2020-10-28T21:42:50.427

@s29 答案的一个更简单的变体：

**您可以简单地从视图中限制表单字段中可用的选项**，而不是自定义表单 ：

 **对我有用的是：在forms.py中：

```
class AddIncomingPaymentForm(forms.ModelForm):
    class Meta: 
        model = IncomingPayment
        fields = ('description', 'amount', 'income_source', 'income_category', 'bank_account') 
```

在views.py中：

```
def addIncomingPayment(request):
    form = AddIncomingPaymentForm()
    form.fields['bank_account'].queryset = BankAccount.objects.filter(profile=request.user.profile) 
```

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2016-02-14T18:04:35.537

```
from django.contrib import admin
from sopin.menus.models import Restaurant, DishType

class ObjInline(admin.TabularInline):
    def __init__(self, parent_model, admin_site, obj=None):
        self.obj = obj
        super(ObjInline, self).__init__(parent_model, admin_site)

class ObjAdmin(admin.ModelAdmin):

    def get_inline_instances(self, request, obj=None):
        inline_instances = []
        for inline_class in self.inlines:
            inline = inline_class(self.model, self.admin_site, obj)
            if request:
                if not (inline.has_add_permission(request) or
                        inline.has_change_permission(request, obj) or
                        inline.has_delete_permission(request, obj)):
                    continue
                if not inline.has_add_permission(request):
                    inline.max_num = 0
            inline_instances.append(inline)

        return inline_instances

class DishTypeInline(ObjInline):
    model = DishType

    def formfield_for_foreignkey(self, db_field, request=None, **kwargs):
        field = super(DishTypeInline, self).formfield_for_foreignkey(db_field, request, **kwargs)
        if db_field.name == 'dishtype':
            if self.obj is not None:
                field.queryset = field.queryset.filter(restaurant__exact = self.obj)  
            else:
                field.queryset = field.queryset.none()

        return field

class RestaurantAdmin(ObjAdmin):
    inlines = [
        DishTypeInline
    ] 
```

# c++ - 动态数组

> ID：232445
> 
> 赞同：5
> 
> 时间：2008-10-24T03:56:50.777
> 
> 标签：c++, arrays

我刚开始学习 C++，所以请原谅我这个简单的问题。我正在做的是从文件中读取数字，然后尝试将它们添加到数组中。我的问题是如何增加数组的大小？例如，我认为也许可以这样做：

```
#include <iostream>
using namespace std;

int main() {
    double *x;
    x = new double[1];
    x[0]=5;
    x = new double[1];
    x[1]=6;
    cout << x[0] << "," << x[1] << endl;
    return 0;
} 
```

但这显然只是覆盖了我最初设置为 x[0] 的值 5，因此输出 0,6。我将如何使它输出 5,6？

请注意，对于我所包含的示例，我不想将它与从文件中读取的代码或从用户那里获取数字的代码混为一谈。在实际应用程序中，我不知道编译时需要多大的数组，所以请不要告诉我只创建一个包含两个元素的数组并将它们分别设置为 5 和 6。

谢谢你的帮助。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-10-24T04:01:32.637

您不想直接使用数组。考虑使用`vector`, 代替。然后，您可以调用该`push_back`函数将内容添加到末尾，它会自动为您调整向量的大小。

```
#include <iostream>
#include <vector>

int
main() {
    double value;
    std::vector<double> values;

    // Read in values
    while (std::cin >> value) {
        values.push_back(value);
    }

    // Print them back out
    for (std::size_t i(0), len(values.size()); i != len; ++i) {
        std::cout << values[i];
    }
} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-24T04:02:19.440

您应该使用集合类来为您执行此操作，而不是自己管理它。看看“矢量”类。它本质上是一个动态数组，可以根据需要自动调整大小。

在您的情况下，您可以将“vector”与“double”类型一起使用。您可能还需要阅读 C++ 中的模板。

[http://www.cplusplus.com/reference/stl/vector/](http://www.cplusplus.com/reference/stl/vector/)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-24T04:05:51.477

或者，如果您不想使用 STL 或其他动态事物，则可以从头开始创建具有正确大小的数组： x = new double[2];

当然，问题在于它有多大。如果你不知道，那么你只需要创建它“足够大”（比如一百或一千）......在某些时候，它不够大，它会在某些时候失败随意的样子。所以你需要调整它的大小。一旦你达到了这一点，你会希望你从一开始就使用 STL，就像其他答案告诉你的那样。

```
#include <iostream>
using namespace std;
int main() {
    double *x = new double[2];
    x[0]=5;
    x[1]=6;
    cout << x[0] << "," << x[1] << endl;
    return 0;
} 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-24T04:44:08.123

这是一个很好的例子，所以你可以看到模式：

```
#include <iostream>
using namespace std;

int main() {
    // Allocate some memory for a double array of size 1 and store
    // an address to the beginning of the memory in mem_address.
    double* mem_address = new double[1];

    // Assign 5 to the first element in the array.
    mem_address[0] = 5;

    // Save the address of the memory mem_address is currently
    // referencing.
    double* saved_address = mem_address;

    // Allocate some memory for a double array of size 2 and store
    // an address to the beginning of the memory in mem_address.
    mem_address = new double[2];

    // Copy over the 1 element from the first memory block
    // to the new one.
    mem_address[0] = saved_address[0];

    // Done with the old memory, so clean it up.
    delete [] saved_address;

    // Assign 6 to the second element in the new array.
    mem_address[1] = 6;

    // Print out the 2 elements in the new array.
    cout << mem_address[0] << "\n";
    cout << mem_address[1] << "\n";

    // Done with the new array memory now, so clean it up.
    delete [] mem_address;
} 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-24T04:13:44.440

如果由于某种原因你无法访问 STL——或者想自己学习如何做——你可以使用这样的算法：

将数组分配为任意大小，并记住其中有多少元素以及它有多大：

```
int *a = malloc(int * ARBITRARY_SIZE);
int size = 0;
int allocated = ARBITRARY_SIZE; 
```

每次添加新元素时，增加“大小”。如果 size 等于 ARBITRARY_SIZE，则将 'allocated' 乘以 2，然后重新分配数组。无论哪种方式，将新值分配给 a[size]。

```
void addElement(int value) {
  ++size;

  if (size == allocated) {
    allocated *= 2;
    a = realloc(sizeof(int) * allocated);
    a = new_a;
  }

  a[size] = value;
} 
```

请注意，您上面的代码至少有一个错误——在任何一种情况下，您都没有为 x[1] 分配足够的空间。

显然，在实际代码中，您会检查 malloc 和 realloc 的返回是否不为空。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-24T05:17:44.043

数组总是需要一个连续的内存块。在您稍后可能需要调整数组大小的情况下，重新分配可能是唯一的解决方案。这就是上面 Moish 和 Shadow2531 所做的。

重新分配的问题在于它可能是一项昂贵的操作。因此，如果您需要向 5000 个元素的数组添加 5 个以上的元素，您最终可能会将所有 5000 个元素复制到内存中。

对于这种情况，可以考虑使用链表。

# language-agnostic - 使用 Decimal 与 double 的应用程序。.

> ID：232450
> 
> 赞同：7
> 
> 时间：2008-10-24T03:58:13.270
> 
> 标签：language-agnostic, double, decimal, finance

我想看看人们是否在金融应用程序中使用十进制而不是双精度。我见过很多人到处使用 double 并产生意想不到的后果。.

您是否看到其他人犯了这个错误。. .

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-24T04:01:27.210

不幸的是，我们做到了，我们为此感到遗憾。我们必须将所有双精度数更改为小数。小数适用于金融应用。您可以查看这篇文章 [A Money type for the CLR](http://www.codeproject.com/KB/recipes/MoneyTypeForCLR.aspx)：

> 一种方便、高性能的 CLR 货币结构，它可以处理算术运算、货币类型、格式以及仔细分配和舍入而不会丢失。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-24T04:03:41.447

是的，将`float`or`double`用于财务是一个常见的错误，会导致非常非常痛苦。`decimal`在这种情况下是最明显的选择。

[对于一般知识，这里](http://www.yoda.arachsys.com/csharp/floatingpoint.html)（浮点数/双精度）和[这里](http://www.yoda.arachsys.com/csharp/decimal.html)（十进制）对每个都有很好的讨论。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-24T04:27:59.170

这并不像你想象的那么明显。我最近让一家大公司的财务主管告诉我，他希望他的财务报告与 Excel 生成的结果相匹配，即在内部以最大精度保持计算结果，并且仅在最后一分钟四舍五入以进行显示。这意味着您不能总是通过仅使用显示值的手动计算来匹配 Excel 答案。他的解释是，有多种算法可以生成结果，每种算法都使用十进制值在不同的位置进行四舍五入，因此可能会生成相互冲突的答案，但 Excel 方法总是生成相同的答案。

我个人认为他是错的，但是有这么多财务人员使用 Excel 却不了解如何正确使用它进行财务计算，我敢打赌有很多人同意这个控制器。

我不想引发一场宗教战争，但我很想听听对此的其他意见。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-24T04:50:55.207

如果是“科学”测量（我的意思是重量、长度、面积等），请使用双倍。

如果它是财务的，或者与法律有关（例如财产的面积），那么使用小数。

困难的部分是四舍五入。

如果税率为 2.4%，您是在细节中四舍五入还是在总和之后四舍五入？

大多数时候你必须两者都做（并修复差异）

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-17T22:43:07.127

我遇到过几次。许多语言都没有内置任何类型，对于不理解问题的人来说，这似乎只是另一个麻烦，特别是如果它看起来没有它就可以按预期工作。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-24T04:02:29.657

我一直使用十进制。至少当我有一种支持它的语言时。否则，舍入错误会杀死你。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2011-05-16T20:53:54.720

我完全同意上面提到的浮点与小数的正确性问题，但许多金融应用程序对性能至关重要。

在这种情况下，您将考虑使用浮点数/双精度数，因为在硬件不支持小数类型的系统中，十进制对性能有很大影响。仍然可以将浮点类型包装在表示域模型的更高级别的类（例如，Tax、Commission、Balance、Dividend、Quote、Tick 等）中，并封装所有舍入逻辑以及这些类型上的有效运算符以及他们的互动。是的 - 在一些项目中，我已经实现了自定义舍入函数，与 .NET 或 win32 方法相比，可以将计算量提高 20%。

要考虑的另一件事是您是否将对象传递到进程之外，因为序列化通常是 4 个整数的小数并通过网络传递它们会占用更多 CPU（尤其是如果不支持），并且会导致显着增加带宽和更大的内存占用。

# c++ - C中的这些声明有什么区别？

> ID：232472
> 
> 赞同：5
> 
> 时间：2008-10-24T04:19:40.713
> 
> 标签：c++, c, pointers, declaration

在 C 和 C++ 中，以下声明的作用是什么？

```
const int * i;
int * const i;
const volatile int ip;
const int *i; 
```

上述任何声明是否有误？

如果不是，它们之间的含义和区别是什么？

上述声明的有用用途是什么（我的意思是在什么情况下我们必须在 C/C++/嵌入式 C 中使用它们）？

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2008-10-24T04:25:02.873

`const int * i;`

`i`是一个指向常量整数的指针。 `i`可以更改为指向不同的值，但`i`不能更改所指向的值。

`int * const i;`

`i`是一个指向非常量整数的常量指针。指向的值`i`可以更改，但`i`不能更改为指向不同的值。

`const volatile int ip;`

这个有点棘手。这意味着编译器不会让您`ip`更改. 然而，理论上它仍然可以被修改，例如通过获取它的地址并使用操作符。这是非常危险的，不是一个好主意，但这是允许的。限定符表示任何时间被访问，它应该总是从内存中重新加载，即它不应该被缓存在寄存器中。这可以防止编译器进行某些优化。当您有一个可能被另一个线程修改的变量时，或者如果您正在使用内存映射 I/O 或其他可能导致编译器可能不期望的行为的类似情况，您希望使用限定符。使用和`const``ip``const_cast``volatile``ip``volatile``const``volatile`在同一个变量上是相当不寻常的（但合法）——你通常会看到一个但看不到另一个。

`const int *i;`

这与第一个声明相同。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-24T04:26:49.140

可以这么说，您从右到左阅读 C/C++ 中的变量声明。

```
const int *i;  // pointer to a constant int (the integer value doesn't change)

int *const i;  // constant pointer to an int (what i points to doesn't change)

const volatile int ip;  // a constant integer whose value will never be cached by the system 
```

他们每个人都有自己的目的。任何 C++ 教科书或半体面的资源都会有各自的解释。

# perl - 是否可以使用或需要 Perl 脚本而不执行其语句？

> ID：232475
> 
> 赞同：18
> 
> 时间：2008-10-24T04:21:19.383
> 
> 标签：perl, testing, refactoring

我需要在一些旧脚本中添加单元测试，这些脚本基本上都是以下形式：

```
#!/usr/bin/perl

# Main code
foo();
bar();

# subs
sub foo {

}
sub bar {

} 
```

如果我尝试在单元测试中“要求”此代码，则代码的主要部分将运行，因为我希望能够单独测试“foo”。

有没有办法做到这一点而不将 foo,bar 移动到单独的 .pm 文件中？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-10-24T05:24:10.303

假设您没有安全问题，请将其包装在 sub { ... } 中并对其进行评估：

```
use File::Slurp "read_file";
eval "package Script; sub {" . read_file("script") . "}";

is(Script::foo(), "foo"); 
```

（注意 eval 不在脚本关闭的任何词汇的范围内）。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2008-10-24T07:18:41.413

单元测试脚本的另一个常见技巧是将代码主体包装到“调用者”块中：

```
#!/usr/bin/perl

use strict;
use warnings;

unless (caller) {
    # startup code
}

sub foo { ... } 
```

从命令行、cron、bash 脚本等运行时，它可以正常运行。但是，如果您从另一个 Perl 程序加载它，“除非（调用者）{...}”代码不会运行。然后在您的测试程序中，声明一个命名空间（因为脚本可能正在运行包 main:: 中的代码）并“执行”该脚本。

```
#!/usr/bin/perl

package Tests::Script;   # avoid the Test:: namespace to avoid conflicts
                         # with testing modules
use strict;
use warnings;

do 'some_script' or die "Cannot (do 'some_script'): $!";

# write your tests 
```

'do' 比 eval 更有效，并且为此相当干净。

测试脚本的另一个技巧是使用[Expect](http://search.cpan.org/dist/Expect/)。这更干净，但也更难使用，如果您需要模拟任何内容，它不会让您覆盖脚本中的任何内容。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-10-24T07:56:12.727

啊，旧的“我如何对程序进行单元测试”问题。最简单的技巧是在它开始做事之前把它放在你的程序中：

```
return 1 unless $0 eq __FILE__; 
```

`__FILE__`是当前的源文件。 `$0`是正在运行的程序的名称。如果它们相同，则您的代码将作为程序执行。如果它们不同，则将其作为库加载。

这足以让您开始对程序中的子例程进行单元测试。

```
require "some/program";
...and test... 
```

下一步是将子程序外的所有代码移到 中`main`，然后您可以这样做：

```
main() if $0 eq __FILE__; 
```

现在您可以像测试任何其他子程序一样测试 main()。

一旦完成，您就可以开始考虑将程序的子例程移到它们自己的真实库中。

# email - 如何设置双向加密的电子邮件服务器？

> ID：232484
> 
> 赞同：0
> 
> 时间：2008-10-24T04:28:51.897
> 
> 标签：email, encryption, smtp, imap

**加密电子邮件 - 听起来很棒，对吧？**问题已经解决了吧？嗯......我不这么认为，我希望我错了！

要理解我在问什么，**请理解我不是在问什么**：我不是在问我如何加密和签署通过公共网络发送的消息。这有点不同。

我想设置一个邮件服务器，电子邮件客户端可以在其中阅读和发布邮件，并将它们的消息双向加密到邮件服务器，最好使用网吧等提供的标准客户端，而不需要专门的软件或加密的端口转发-la SSH。

这里的关键是有一个受信任的邮件服务器，它可以使用本地传递代理将电子邮件传递到社区。然后，人们可以向同样使用同一系统的任何人和每个人发送和接收电子邮件，而不用担心他们的通信安全。没有必要使用每个收件人的公钥来加密每条消息——那将是多么痛苦！- 相反，我们在这里讨论的只是从客户端到该系统的双向通信。

当然，公共消息通过通常的端口 25 进程以未加密的方式发送给电子邮件服务器的所有参与者。它们可能会或可能不会像以前那样加密 - 我们并不担心它们。电子邮件客户端从任何地方连接，服务器系统上的响应代码对这些消息进行加密以供阅读，即使它们已经通过公共网络以纯文本形式发送……**通过加密像 Dovecot 这样的 IMAP 服务器，我已经可以相当容易地获得这些。**

**我想补充的是，连接的电子邮件客户端可以*将*加密的电子邮件发送回它们作为客户端的系统，在该系统中**，无论它需要去哪里，该系统都会在外部未加密地转发。如果是本地邮箱，则邮件通过本地投递代理投递。那里不涉及密钥。这种设计的优点是不会将电子邮件暴露给外部的、不受信任的系统或网络，并且如果在本地交付，它会得到有效的端到端保护，而不会产生加密单个消息的点对点麻烦。更典型的用途。

这将是“天赐良机”，因为就像现在一样，不可能通过公共互联网上的客户端向内部网络中的人群发送安全邮件。

**我想另一种表达我所要求的方式是：是否有人创建了一个包，它为我们提供了 IMAP（和 POP？）服务器已经完成的另一半加密——不受信任网络上的远程客户端可以移交- 通过与另一端服务器的加密链接绑定未加密的电子邮件？**

我想到了另一种选择：加密 SMTP / ESMTP 服务器，它们以加密形式将邮件服务器与邮件服务器通信。（类似地，客户应该能够通过加密链接传递未加密的电子邮件，就像 https 一样。）有人知道这样的包吗？这不是那么好，但电子邮件架构的重要组成部分......

***如果今天不存在，它应该存在！***

感谢您的想法，指针等。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-24T04:49:55.847

大多数现有的电子邮件客户端都支持通过 TLS/SSL 提交消息（使用 SMTP 或 MSA）。我刚刚签入了 Outlook 和 Opera 并且都支持它。

而且我知道 Courier 的电子邮件套件支持 SMTP 和 MSA（以及 IMAP）的 TLS/SSL，所以它不是一个晦涩的设置；只是有点不寻常。它支持任何或所有协议都需要 TLS/SSL。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-24T13:35:58.753

这是一个示例客户端 SSL 配置屏幕。

展望快递：

![Outlook Express SSL 配置](https://lh6.ggpht.com/chase.seibert/SQHOAsoCaHI/AAAAAAAAHV8/M28OhvDtsuA/s800/outlookExpress.gif)

# emacs - 最佳 Common Lisp IDE

> ID：232486
> 
> 赞同：53
> 
> 时间：2008-10-24T04:31:01.580
> 
> 标签：emacs, ide, lisp, common-lisp

我在 Emacs 中使用 Slime 作为 Common Lisp（或 OS X 上的 Aquamacs）的主要开发环境，但还有其他令人信服的选择吗？我听说过 Lispworks，但那 [或其他] 值得一看吗？或者有没有人有充分利用 Emacs 的技巧（例如，将它连接到 hyperspec 以便于参考）？

更新：Pascal Costanza 的[高度评价 Lisp 指南](http://p-cos.net/lisp/guide.html)的第 7 节给出了一个观点。但对我来说，[SLIME](http://common-lisp.net/project/slime/)似乎真的是[它所在的地方](http://www.cliki.net/Editing%20Lisp%20Code%20with%20Emacs)。

更多资源：

*   [Marco Baringer 展示 SLIME 的视频](http://common-lisp.net/project/movies/movies/slime.mov)
*   [Sven Van Caekenberghe 展示 LispWorks IDE 的视频](http://homepage.mac.com/svc/LispMovies/index.html)
*   [Rainer Joswig 使用 LispWorks IDE 创建 DSL 的视频](http://www.cl-http.org:8002/mov/dsl-in-lisp.mov)
*   [Bill Clementson 讨论 IDE 选择的博客文章](http://bc.tech.coop/blog/041130.html)

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-10-24T18:51:10.833

那里有一些更炫的选项，但我认为没有什么比[Emacs](http://www.gnu.org/software/emacs/)和[SLIME](http://common-lisp.net/project/slime/)更好的了。我会坚持使用你正在使用的东西，只是在你的 Emacs 安装上进行拉皮条。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-11-09T03:30:13.760

用于 Windows 的一个非常简约但有用的 Lisp IDE 是“LispIDE”，可从以下位置获得：

[http://www.daansystems.com](http://www.daansystems.com)

*   支持 CLISP 和 SBCL。
*   使用 REPL 非常快速地启动。
*   语法高亮。
*   下载包括 CLHS 和 CLtL2 作为 CHM 帮助文件。
*   按 F1 调出 CLHS 帮助。帮助菜单下的 CLtL2。
*   “Send to Lisp”和“Macro Expand”的键盘快捷键。

简单、有效且免费。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2010-01-11T14:47:48.090

我在这方面已经很晚了，但奇怪的是这里没有人提到 LispWorks IDE，它甚至还有一些 GUI-Builder，可以跨平台移植（减去 Mac OS X）。

此外，如果您想要为您的 Lisp 编程事业提供一个完整的操作系统，仍然存在 Open Genera（它仅在 Dec Alphas 上运行（目前是 DEC 的所有者；-()），它是一个用 Lisp 编写的完整操作系统，甚至有一个 C 编译器，在 Lisp AFAIK 中实现，针对操作系统。这很奇怪。你会发现一些我们现在认为理所当然的东西。例如超引用文档（但这是在 Web 之前）。它有一些“Lisp ” 方言，基础是 ZetaLisp，但是 Common Lisp 可以工作。所有的工具和东西都可以在运行时自省。这是一种很奇怪的感觉。

不过，我刚才提到了。我想这里没有人会碰过 OpenGenera....

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2008-10-24T09:14:28.840

我发现访问 Common Lisp 标准的最愉快的方式是通过 Info。[按照http://www.phys.au.dk/~harder/dpans.html](http://www.phys.au.dk/~harder/dpans.html)中的描述构建和安装 Info 文件。然后将以下内容添加到您的`~/.emacs.el`：

```
(require 'info-look)

(info-lookup-add-help
 :mode 'lisp-mode
 :regexp "[^][()'\" \t\n]+"
 :ignore-case t
 :doc-spec '(("(ansicl)Symbol Index" nil nil nil))) 
```

您可以使用 查找符号`C-h S`。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-12-13T02:58:32.920

Clozure Common Lisp (née OpenMCL) 提供了一个 Lisp IDE。它看起来不错，虽然我更喜欢 SLIME。然而，Clozure 是蜜蜂的膝盖：在 64 位 Intel Mac 上编译和执行速度提高了一个数量级，并且总体上更好的“用户体验”。在 common-lisp.net 上查看 Rittweiler 关于使用 SLIME 的新幻灯片，它们非常有帮助。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-02-16T10:03:22.697

我将支持 MacOS/X 上的 clozure common lisp IDE。如果您曾经使用过 Macintosh Common Lisp，您会深深地记住它。他们正在努力改进它，而且，奖金，你得到竞争来源。

此外，如果你只是想要 lispish，dr-scheme 也有相当不错的 IDE。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-06-26T16:02:34.717

在 FRANZ.COM 上寻找 Allegro CL

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2011-03-26T18:48:30.257

Eclipse 还有一个名为 Cusp 的 Lisp 开发环境。

[IBM DeveloperWorks 开源技术库：Cusp](http://www.ibm.com/developerworks/opensource/library/os-eclipse-lispcusp/)

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-10-24T04:41:07.893

我相信[这个问题](https://stackoverflow.com/questions/59428/learning-lispscheme-interpreter)可以帮助你找到答案。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-02-16T08:27:17.997

我使用 Vim、Ion3 窗口管理器和终端窗口，并且非常喜欢它。

# wcf - 从 .Net 2.0 客户端调用 WCF 服务时如何配置安全性

> ID：232500
> 
> 赞同：15
> 
> 时间：2008-10-24T04:48:05.663
> 
> 标签：wcf, security, .net-2.0

我有一个 WCF 服务启动并运行，并且能够使用 basicHttpBinding 在服务和 .Net 2.0 客户端之间进行通信。

我现在需要锁定 WCF 服务，以便它只能由经过身份验证的客户端调用。

我可以控制将调用我的服务的客户。客户端是产品的一部分，将在野外安装并“打电话回家”以推送和拉取数据。客户端应用程序是为 .Net 2.0 框架编写的，目前无法升级到 3.0 或 3.5。我无法将 Windows 用户帐户添加到客户端计算机。

对于保护 WCF 服务并能够从我的 .Net 2.0 客户端进行身份验证，我有哪些选择？此外，数据需要通过 https 传递。

我一直在网上搜索，感觉就像在追逐野鹅。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-24T08:31:54.340

您可以将 WCF 端点配置为使用**2-way SSL 身份验证**。这意味着您可以要求客户端在向服务提出请求时出示 X.509 证书以确认其身份。

在服务器端，您可以使用 WCF 中的内置验证方案之一或提供您自己的验证逻辑来​​检查 X.509 证书。
如果您在 IIS 中托管您的服务，那么将 SSL 配置为需要**传输级别**的客户端证书是很简单的。但是，您可以在此处找到有关如何在自托管 WCF 服务中实现此行为的良好指南：

[http://leastprivilege.com/2007/08/25/certificate-based-authentication-and-wcf-message-security/](http://leastprivilege.com/2007/08/25/certificate-based-authentication-and-wcf-message-security/)

我自己没有尝试过，但是，由于这会在**消息级别**创建安全要求，我认为您将不得不使用**wsHttpBinding**在您的 WSDL 合同中强制执行它，因为施加安全要求来访问 Web 服务是WS-* 标准。

如果您必须使用**basicHttpBinding**，您可以尝试这个解决方案，而不是在传输级别上移动：

[http://leastprivilege.com/2007/08/26/certificate-based-authentication-and-wcf-mode-independent/](http://leastprivilege.com/2007/08/26/certificate-based-authentication-and-wcf-mode-independent/)

希望这可以帮助

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-24T10:56:24.173

好的，有了 SSL，您就拥有了传输级别的安全性；这很好，可以保护消息不被嗅探和更改。

所以现在你有选择；您是否需要使验证保持沉默，或者您可以在程序启动时提示用户输入用户名/密码？如果它必须保持沉默，那么您可以按照上述方式使用客户端证书（虽然这很痛苦，但您需要自己生成证书并验证它们，因此您需要考虑运行自己的证书颁发机构）。或者，您可以在包含客户端 ID 的消息中嵌入自定义标头，并以笨拙的方式进行操作。

[但是，如果您可以提示输入用户名和密码，那么您可以通过这种方式进行身份验证，并使用自定义身份验证](http://blogs.msdn.com/pedram/archive/2007/10/05/wcf-authentication-custom-username-and-password-validator.aspx)器或什至使用[ASP.NET 成员数据库](http://msdn.microsoft.com/en-us/library/ms731049.aspx)很容易地将其插入到数据库查找中。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-01T20:48:20.890

这是我最终做的事情，这似乎是我们情况下最简单的解决方案，它的规模非常小，只暴露了少数 Web 服务：

1.  使用 SSL 保护传输
2.  客户端首先通过调用 Web 服务上的 Login 方法登录到 Web 服务。如果登录成功，它会向客户端返回一个加密的 FormsAuthenticationTicket。
3.  然后，客户端必须为每个 Web 服务调用提供表单身份验证票证。每种方法都会检查票证是否有效，如果有效，它就会工作。如果票证已过期或无效，则客户端必须重新进行身份验证。

希望对某人有所帮助...

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-24T05:09:38.273

使用 SSL 证书是 .NET 2.0 客户端访问 WCF 服务的唯一选择，因为 basicHttpBinding 不提供安全性。通过使用 SSL，您可以保护整个传输通道。

检查链接[http://www.codeplex.com/WCFSecurityGuide/Release/ProjectReleases.aspx?ReleaseId=15892](http://www.codeplex.com/WCFSecurityGuide/Release/ProjectReleases.aspx?ReleaseId=15892)。它涵盖了涵盖所有场景的 WCF 安全性。

要获得免费的 SSL 证书，请访问[http://www.comodo.com/](http://www.comodo.com/) 或[http://www.instantssl.com/](http://www.instantssl.com/)并在您的应用程序中试用。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-24T05:21:42.837

ssl 将涵盖您的安全性。

对于身份验证，您有两个选项 - 基本（用户名和密码）或证书。

[这](http://www.codeplex.com/WCFSecurity/Wiki/View.aspx?title=How%20to%3A%20Use%20basicHttpBinding%20with%20Certificate%20Authentication%20from%20Windows%20Forms&referringTitle=Video%20Index)是一个演示配置证书身份验证的视频。

您正在配置 basicHttpBinding 的安全元素，如下所示：

<basicHttpBinding>
  <binding name="basicHttp">
    <security mode="TransportWithMessageCredential">
      <message clientCredentialType="Certificate"/>
    </security>
  </binding>
</basicHttpBinding>

这里也有一个很好的[页面](http://www.devx.com/codemag/Article/33342/1763/page/2)。在 clientCredentialType 上谷歌，你应该很快就会发现自己在正确的轨道上。

要设置客户端证书，您需要使用 wse* 策略文件。

您将需要确定如何将客户端证书提供给各个站点。这取决于项目的安全问题。有多种方法（我都不记得对不起，我上次为 wse* 到 wse* 做这个大约是在两年前所以细节忘记了，但肯定有可能，花了几天的时间研究找到一个好的方法）。

# project-management - Redmine 最佳实践

> ID：232506
> 
> 赞同：86
> 
> 时间：2008-10-24T04:56:11.687
> 
> 标签：project-management, redmine

您在 Redmine 项目管理过程中使用了哪些技巧和“标准”？

您是否有可以共享的标准 wiki 插入模板或使用错误功能任务和支持问题处理项目的标准方式？

您是否让问题和更新通过电子邮件发送到 Redmine？你用论坛吗？您使用 SVN 存储库吗？您是否在 Eclipse 中使用 Mylyn 来处理任务列表？

我正试图拖累我们的部门。进入一些基于网络的 PM，而不是通过电子邮件发送模糊要求的 Word 文档，然后是 Word 文档，解释如何进行质量检查和部署，所有这些都迷失在一堆竞争的更新和项目中，所以当我必须修复某些东西时，没有人可以找到任何有关其工作原理的文档。

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2010-08-26T17:06:12.220

我为一家制造公司开发和维护内部应用程序。截至发表此评论时，我是 IT 团队中唯一的开发人员/分析师。在经济衰退最严重的时候，我的项目需求激增。因此，我的项目和问题积压非常笨重。我们目前正在重组以扩大团队。

以下是我如何使用 Redmine 来保持头脑清醒（在可能的范围内），让我的用户远离我，并希望在未来防止过多地牵手新员工。

*   我使用 Subversion 进行源代码控制，使用 TortoiseSVN 和恰当命名的[Tortoise-Redmine 插件](http://code.google.com/p/tortoise-redmine/)。在提交链接问题后刷新 Redmine 项目的存储库，显示问题的修订，并通过电子邮件通知更新我的利益相关者。
*   我将项目描述视为向未参与的人传达项目目的、范围和生命周期阶段的一种方式。这样一来，我的用户就知道我的盘子里有什么，以及自助餐上还有什么我正在远处目视。
*   我为我的权限集使用了特定的角色名称，这些角色名称表示的不仅仅是一组权限——同样，作为一种记录方式。我的角色包括：项目经理、项目团队成员、所有者、主要用户、次要用户、观察员、霸主（对我的老板来说......既有趣又无可否认是正确的）。
*   我使用 Wiki 和 Documents 来记录文档，这取决于我觉得合适的。
*   版本对我来说几乎毫无用处，因此我没有将其用于计划发布，而是使用它将相关问题分组到 sprint 中。
*   在针对我的问题大规模编辑目标版本之前，我使用 Eric Davis 出色的 Stuff-To-Do 插件来组织/重新组织上述冲刺。这也让我的利益相关者知道我正在做什么以及我如何优先考虑他们的利益（无论好坏）。
*   为了鼓励用户交互，我在我的应用程序的帮助菜单中添加了指向 Redmine 项目的链接。“关于”框还包含指向 Redmine 项目的链接。

未来的计划

*   我希望在某个时候完成我用于 Redmine 集成的 Visual Studio 扩展。
*   构建一个代码库以将我的应用程序与其 Redmine 项目松散耦合：自动提交错误、警告从系统托盘订阅利益相关者、由 Redmine 的 REST API 驱动的可重用交互式帮助菜单等（也许使用 Wiki 自动化部分文档？）

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2009-01-08T06:13:32.167

I'm a freelance Ruby and Redmine web developer who runs a development business of one (me). So my Redmine is setup to be pretty lightweight and customer focused. My Redmine also serves double duty for hosting my Open Source projects.

I do allow new issues and updates to be emailed and it works great for email connected users (or those who are always on their iPhones).

I've been using the repository view with git repositories and it's working great. With every checkin I reference the issue with #nnn so the actual issue page will show all the commits to implement the feature.

I found the forums are underused. I think if there was some email integration, they would be more useful.

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-04-09T08:45:03.790

我们发现以下做法很有用：

1）隐藏“问题”和“支持”跟踪器，并将*所有内容归档为错误*：

*   为开发人员、测试人员和管理人员节省时间；
*   如果某些活动被称为“额外”或“新功能”或其他任何活动，则会安排快速会议来评估它们。

2) 里程碑和版本 我喜欢这个，您可以轻松跟踪每个版本的状态，并且您可以随时下载较旧的包，即测试客户端提交的错误。

3）“问题”选项卡上的“保存”功能：另一个节省大量时间的功能，我为许多日常报告任务保存了不同的查询，这就是我所需要的。

4) 版本控制集成，即在评论中使用“#123”创建指向相应问题的链接：简直太聪明了！

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2011-05-25T08:05:49.867

我们在我们的系统上广泛使用 Redmine。我们甚至为我们的销售团队建立了一个“销售”项目，将其用作 CRM。我们在这个项目中有一堆自定义字段，它取代了我们之前使用的 SugarCRM。

在我们的系统中，我们有服务器和客户端软件的项目。根据我如何构建系统和子存储库，服务器项目被分解为子模块，因为 Redmine 喜欢每个项目单独的存储库。

正如其他人所指出的，我们在提交消息中使用#nnn 代码来引用票证。很酷的是它不必是同一个项目中的一张票。因此，销售票可能会因错误问题或支持请求而被阻止。

我们刚刚开始将文档用于会议议程/会议记录。我们在客户端和服务器上使用版本来分组发布。

尝试使用 Redmine Time Tracker 插件来跟踪时间，但我总是忘记点击开始或结束。我们每天都会收到关于一段时间未触及的问题的电子邮件（我认为是 Redmine Whining），并且这些问题的截止日期在过去或不久的将来（高级提醒）。

支持电子邮件直接进入我们的支持项目，如果电子邮件导入更强大（如果项目：行包含在电子邮件中，有时它不会正确创建新工单），我们会让网站查询自动生成销售工单. 事实上，我们只需要监控支持票，并在适用的情况下将它们移至销售。

我希望能够做的事情：

*   在我们的系统和 redmine 之间建立关系，以便票证可以与我们系统中的用户或公司相关联。此外，这样我们就可以在相关点从销售票生成新公司。这只需要我做一些工作。
*   在我们的错误跟踪软件（sentry）和redmine之间有关系，以便服务器错误生成redmine票据。同样，可以用当前技术解决。
*   有一个桌面客户端来redmine。服务器在我们的局域网内，但如果能够以更灵活的方式访问网页以外的数据，那就太好了。并不是说在 redmine 网络界面中我真的不能做任何事情，而是像 Things.app*这样*的东西更好用。
*   将我们的支持文档全部包含在 redmine 中，然后生成到面向公众的服务器上。这样，我们的支持人员可以维护文档，以一种很好的方式进行编辑，并将更改部署到 doc-server。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2012-04-25T13:22:17.730

到目前为止，Redmine 对我们来说非常棒。我们将其用作多租户票务/敏捷优先队列，并将其绑定到 SVN。尤其是：

*   通过 SVN 安装/维护是一件轻而易举的事（我已经将我们从 1.1 迁移到 1.2 再到 1.3 到 1.4，方法是使用`svn switch https//.../branches/1.3-stable .`命令后跟`rake migrate`命令，中间只需要偶尔安装 gem）。
*   数据库和存储文件的备份是单行脚本执行
*   我们喜欢[Time Tracker](http://www.redmine.org/plugins/redmine_time_tracker)和[Spent Time](https://github.com/planio/redmine_spent_time_column)插件。我会为我们的一些办公室用户杀死一个 Mac OS X 时间跟踪胖客户端，但这不是重点:)
*   我们很少使用论坛，但大量使用活动和路线图。将问题绑定到特定版本是天赐之物。
*   我们也有客户端/服务器的区别，但是使用目标版本来绑定票证以指定哪个去哪里（并且有开放式的 NEXT CLIENT RELEASE/NEXT SERVER RELEASE），以便在工作时进行区分。
*   我们混合了状态的隐喻——我们使用我们的列表首先按这些分组（“立即”、“拒绝”、“阻止”、“工作”、“在甲板上”、“列表”、“等待构建”、“发布测试”、“已验证”、“已发布生产”、“已关闭”、“已取消”。
*   然后，在上面的每个组中，我们有这个排序的优先级列表：（“立即”、“优先考虑我”、“设计和调整大小”、“P1”……“P5”、“P-Watch List”）。这加上上述允许所有来自问题区域的简单工作流程。
*   对于基本问题列表，我们按“优先级”、“父任务”、“更新日期”排序——需要中间的一个，以便在同一分组中有子任务时，Redmine 可以很好地缩进。
*   我们使用签入提交将提交与问题（即`svn ci -m "This fixes #1733 @2.5, holy smoke what a weird foo bug. It is now bacon and unicorns."`）联系起来 - 并将该问题移至“等待构建”（这曾经是“已解决”，但我厌倦了解释“已解决”并不意味着有人可以希望看到它发布呢）。

我想我将不得不去调查 Redmine-stuff-to-do 插件。+1 问题。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2012-06-05T17:39:17.990

我的公司与来自国际的软件和硬件开发商合作。在我加入公司之前，电子邮件与 MS Word 文档一起使用，通过软件或硬件传递我们的问题和错误，以请求修复。这个过程不可能跟踪和维护任何类型的过程。我实施 RedMine 作为跟踪软件和硬件错误的一种手段，并且从那以后它一直运行良好。我的情况存在很大的语言障碍。值得庆幸的是，RedMine 可以以简体中文显示，并且反馈表明，到目前为止，我的开发人员还可以。

状态 - 当我发现软件或硬件问题时，状态为“新” - 当我的软件/硬件开发人员看到此问题并正在解决此问题时，他们会将状态更改为“进行中”。如果他们愿意，他们可以使用从 0 到 50 的完成百分比。当他们认为已经解决了问题时，我让他们将完成百分比设置为 50。- 我确定问题是否已解决，并将状态更改为“已解决”并将完成百分比更改为 100%。这使我可以过滤掉小于或等于 50% 的问题，以找到仍然未解决的问题。

优先级 - 低、正常、高、紧急、立即都可以很好地翻译成中文。

截止日期 - 我用它来告诉我修复程序最初由我的软件开发人员上传的时间。我可能需要 4-6 天来测试某些内容并关闭问题。我喜欢我的甘特图来反映我的软件团队的响应能力，而不是我批准修复需要多长时间。

类别 - 这始终反映我发现问题的软件或硬件版本。我用它来查看哪个版本的软件有最多的错误，并确保新版本的软件不会出现退化。

我将每个人都包含在所有错误的 RedMine 观察者列表中。电子邮件显示为（新）、（已解决）或（进行中），因此我的主管以及相关团队的主管和首席工程师都可以看到该电子邮件并快速阅读当前正在取得的进展。所涉及的大多数其他人从未登录过 RedMine，我通常是唯一的一个。这些电子邮件非常适合为每个人提供即时更新，他们唯一关心的是是否正在取得进展。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2013-09-18T10:59:10.733

正如您提到的那样，通过您的 QA 来回发送 Word 文档——我知道这种感觉，我去过那里，做到了。对我来说主要问题是：QA 人员不喜欢在任何错误跟踪器中添加问题，他们在测试期间将它们记录在旁边的编辑器中。

我们现在使用 Redmine 和一个不错的插件 - [Usersnap](https://usersnap.com/redmine)（免责声明：我们构建了这个工具来为自己解决这个问题。

Usersnap 非常适合 Web 开发人员 - 将其添加到您的 Web 项目中，您将获得直接附加到 Redmine 票证的屏幕截图 - 包括有关使用的浏览器、操作系统等的元信息。

我们的 QA/客户现在可以直接在 Web 应用程序中输入错误，并且开发人员可以更轻松地将错误报告复制到 Redmine。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2009-04-29T14:41:31.617

除了其他评论之外，我建议使用“待办事项”-插件（我认为是由 Eric Davis 编写的 :) 使用该插件允许您在多个项目中拖放排序问题的顺序。

[https://projects.littlestreamsoftware.com/projects/show/redmine-stuff-to-do](https://projects.littlestreamsoftware.com/projects/show/redmine-stuff-to-do)

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2008-10-24T05:59:26.190

We are using the Roadmap section as a clear way to display:

*   bugs
*   features (that would be references to your word document, or link to html requirement pages)
*   reconciliations (differences between production values and test values)
*   and so on...

That is the main point of consolidation for us. The rest is used in relation with that (for instance, the 'announce' section is used to define the main milestone/release dates used in the roadmap)

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2014-02-18T15:11:57.390

我们使用版本作为定义冲刺的一种方式，因此每个版本都是一个冲刺，路线图视图可以清楚地说明进度。冲刺中的问题在完成时标记为“准备审查”，然后在 QA 验证后关闭。

对于超出范围或失去优先级等的任何问题，我们使用版本作为积压工作。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2012-04-26T19:07:47.643

我们已经使用 Redmine 大约一年了，它在很多方面都在自行发展。我们使用版本将问题组合在一起以发布，并使用类别按学科对问题进行分组。

每个问题都经过新 > 进行中 > 已解决的工作流程。然后测试人员会在满意时关闭问题。

我们很乐意更新我们使用 Redmine 的方式，似乎有很多很棒的插件，但我们发现其中有很多已损坏或无法安装。

我们将 wiki 全面用于开发人员文档。

# javascript - 展开和折叠问题

> ID：232507
> 
> 赞同：0
> 
> 时间：2008-10-24T04:58:55.673
> 
> 标签：javascript

我是一个新手设计师，在这个页面上遇到了一些麻烦：[http ://www.resolvegroup.co.nz/javasurvey.php](http://www.resolvegroup.co.nz/javasurvey.php)

扩展题的javascript操作有问题。对于 Internet Explorer（版本 7），第一个问题在展开时会部分隐藏在问题 2 下。所有问题都会在不同程度上发生这种情况，有时会完全隐藏下一个问题和其他问题。

Firefox（版本 3.03）没有上述问题，但您无法访问解释或选择下一个问题，如在 IE7 中。

有谁知道这是怎么回事，以及如何解决它？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-24T05:05:11.230

我建议使用预先构建的 Accordion 脚本，就像 jQuery UI 库中内置的那样：http: [//docs.jquery.com/UI/Accordion](http://docs.jquery.com/UI/Accordion)

* * *

另外，我可以建议一些事情。你的这段代码：

```
$(".score-list").slideUp(speed);
$(".score-list").removeClass("open");
$("a.open-answer").removeClass("hidden");
$(this).parent().children(".score-list").slideDown(speed);
$(this).parent().children(".score-list").toggleClass("open");
$(this).toggleClass("hidden"); 
```

通过存储 jQuery 查询的结果以及利用 jQuery 的链接功能可以提高效率：相当多的 jQuery 函数返回 jQuery 对象本身，这意味着您可以连续调用多个函数无需一次又一次地引用对象。这就是我的意思：

```
$(".score-list")        // my own preference is to split the calls onto
    .slideUp(speed)     // multiple lines to make it easier to read.
    .removeClass("open")
;
$("a.open-answer").removeClass("hidden");

var $this = $(this);    // store the result from a query in an object so you
                        // don't have to go through that again.
$this
    .parent()
    .children(".score-list")
    .slideDown(speed);
    .toggleClass("open")
;
$this.toggleClass("hidden"); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-24T05:07:34.753

如果我没记错的话，你的 CSS 有点奇怪。“.question-container h3”和“.question-container h3 span”分别具有相对定位和绝对定位。Internet Explorer 不能很好地处理外流定位。结果，它变得混乱并试图将这些元素放在奇怪的地方。

构建没有相对或绝对定位的手风琴，它应该可以正常工作。

# user-interface - 实线边框还是虚线边框？什么时候用哪个？

> ID：232508
> 
> 赞同：0
> 
> 时间：2008-10-24T04:59:38.217
> 
> 标签：user-interface

我目前正在为某些 UI 内容（例如说明、注释、错误框等）使用虚线边框。

但是最近我因为需要改成了实心边框，但我觉得有点奇怪。

似乎通过使其稳固，它过于强调页面元素，这些元素只是提供信息。

你有什么看法？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-24T05:10:26.463

我认为，这里争论的焦点是对比。您使用虚线边框的目的是减少与包含它的背景视觉元素的对比度。

您可以使用柔和的颜色（例如，浅色背景上的浅灰色阴影）实现相同的效果，这样它的重点就不会与使用虚线边框不同。

如果可能的话，您可能还想通过使用更细的边框宽度来规避该要求。

BTW：我们在谈论什么接口？Windows 还是网络？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-24T05:09:42.313

这是一个困难的问题，因为它非常主观。如今，许多较新的网站（包括 Stack Overflow）完全放弃了边界，并在主体颜色之间使用了更微妙的背景颜色差异，用于您提到的重点内容部分（说明、注释等）。当我看到虚线时，我本质上会将它们与缩写或首字母缩略词联系起来，如下所示：

```
<abbr style="border-bottom:1px dotted #000;cursor:help;">
    <span style="cursor:help;" title="Cascading Style Sheets">CSS</span>
</abbr> 
```

因此，我建议远离虚线边界。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-24T22:22:13.590

我用虚线边框来表示“你可以在这个区域的顶部拖放一些东西”。也称为放置目标。

为了强调，我使用颜色、粗体或背景颜色。边框有时会与“可点击”混淆，因此请小心使用它们。

# user-interface - 表单元素的不同背景颜色

> ID：232511
> 
> 赞同：0
> 
> 时间：2008-10-24T05:02:21.627
> 
> 标签：user-interface

我应该为表单输入设置背景颜色吗？或者这真的是一个主观问题？

就我个人而言，我认为为表单设置背景颜色会使其更有条理和干净。

您对此有何看法？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-24T05:35:54.773

Two techniques that I don't see often enough are highlighting input fields with a background color [when they are focused while filling out a form](http://www.dhtmlgoodies.com/index.html?whichScript=highlight-active-input) and [when a validation error occurs](http://blog.jc21.com/staging/jsvalidate_yui.php) after a form submission. You can use these two techniques in conjunction with a subtle style for normal inputs to match the rest of your website design.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-24T05:33:11.517

To complete the other answers, you should also take into account [accessibility issue](http://www.accessibilityblog.com/2005/07/19/how-to-design-for-color-blindness/), especially if the color you choose for the form input somehow risks to blend in with other colors you might use, such as:

*   color from the input fields
*   characters colors (if the value is incorrect and you put the character in red, for instance)
*   colors of icons or warnings you might display when the data is incorrect...
*   and so on

A border (meaning 'a *graphical* way of delimiting your input form) might also be a good way to isolate that form, without having relying solely on color.

In short, you might consider always using a *combination* of both: color and graphical ways to emphasize a GUI element.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-24T05:15:36.530

这实际上取决于网站其余部分的布局。在我看来，以某种方式偏移表单是件好事，即使只是带有顶部/底部边框 - 通常你可以将整个东西变成页面内的一个小盒子。但是，对于注册系统之类的东西，您不妨将整个页面制作成表单——额外内容越少干扰越好。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-24T05:17:55.353

这是相当主观的。

颜色的重要性在于 a）它们不应该是破坏性的和分散注意力的，并且 b）你应该非常非常地与它们的使用保持一致。

相同的规则适用于所有其他视觉元素，例如图形、字体等等。

# user-experience - 如何鼓励用户填写长申请表？

> ID：232519
> 
> 赞同：4
> 
> 时间：2008-10-24T05:08:04.937
> 
> 标签：user-experience

我能想到的是根据用户的地理信息预先填充某些表单输入元素。

您还能想到哪些其他方法来加快用户在长申请表上的输入速度？

或者至少让他们专注于填写申请表？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-24T05:18:20.643

如果您的表格很长，请尝试将其修剪下来。不要让他们填写您并不真正需要的字段。

如果表单跨越多个页面，请向用户提供有关还有多少页面的反馈。我们的用户讨厌点击继续按钮，想知道这是否会是最后一页。

无论他们做什么，都不要丢失他们填写的字段。如果涉及密码，这可能会产生安全隐患。

使用下拉菜单为用户提供选项，除非用户必须滚动浏览很多选项，或者如果下拉菜单中的术语未被广泛接受（例如，下拉菜单中包含系统工程师、解决方案开发人员、IT 应用程序...... .我只想要程序员。）。

为可能难以填写的字段提供帮助（或提供示例）。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-24T05:24:08.930

如果在您的情况下可能，只需预先收集最低限度的信息，然后允许用户使用您服务的基本功能。

为了让用户升级到更好的服务水平，他们需要更详细地填写第二张表格。

预先收集所有这些信息对您来说有多重要？对客户要求过高是否值得失去客户？为什么不在以后对用户更方便的时候要求它。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-24T05:13:22.430

创建一个多步骤向导，每个步骤仅提供少量输入字段。确保他们知道他们在序列中的进步程度。

心理学是，一旦用户“投入”于一项任务，他们就更有可能继续下去。如果您一次显示整个输入字段列表，您会吓跑它们。

在每一步（卡通、幽默、谚语等）提供沉思，使他们出于好奇而进入下一步。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-24T05:14:14.427

当且仅当用户认为您提出的问题很重要时，他们才不会介意填写冗长的表格：否则他们会气馁，变得不耐烦。

请记住，在 Web 应用程序中，人们的注意力持续时间非常非常短。当用户开始觉得你要求太多时，*他们通常是对的*。

尽可能少地保留所需的信息：其他信息应该只是可选的，并且您必须向用户提供一些东西以迫使他们完成该信息。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-30T03:12:22.400

清单：

1.  清楚地解释表格的用途。（对他们有什么好处？）
2.  修剪，修剪，修剪，并保持问题明确相关！
3.  向用户反馈他/她的进度（如果表单被拆分为多个页面）
4.  尽可能少地预先要求，其余的留到以后。
5.  清楚地标记必填字段
6.  对字段进行逻辑分组。
7.  保持标签/标题简短易懂。
8.  尽可能多地预填充 - 但不要太多。
9.  将超长表单分布在多个页面上并允许回溯。
10.  巧妙放置的“返回”、“保存”和“取消”按钮让人们放心——即使是多余的。
11.  及时提供友好（但清晰！）的验证错误消息。
12.  允许用户收回填了一半的表格——不要丢失他们的数据！
13.  无论您做什么，**都不要**包含`reset`按钮。:-)

最后：

1.  明确告诉用户该过程何时完成。*（“谢谢！您的申请已发送。”）*
2.  告诉用户接下来会发生什么。*（“确认邮件已发送至您的邮箱，我们将在两个工作日内处理您的申请。”）*

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-24T05:26:46.523

无论您如何实现它，请使用某种 Ajax heartbeat 来存储他们的进度服务器端并在丢失时重新填充它。对于用户而言，没有什么比通过长表单工作并让浏览器或网络打嗝失去他们的整个提交更令人恼火的了。

每当它发生在我身上时，我通常都不会再给它第二次尝试，因为在那时重新创建我的提交对于我注册的任何东西都不值得。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-24T05:59:32.400

I agree with [tim](https://stackoverflow.com/users/26002/timjstewartblogspotcom); just let them fill in the bare minimum information and then leave the rest to profile updates. If any data is necessary for the service offered on your site, ask for it when they try to avail of the service (and no earlier).

That said, I wouldn't advocate the kind of forcing function that [adam](https://stackoverflow.com/users/5324/adam-pierce) suggests. It pays to give your users the warm, fuzzy feeling that they are privileged and can use ALL of the services on your site. Although, if you look at it hard enough, [adam](https://stackoverflow.com/users/5324/adam-pierce)'s and my suggestions are pretty much the same.

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-24T05:12:25.537

使用 Ajax 异步填充和更新控件。这将加快长申请表的填写。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-24T05:15:26.093

*   把它分成多页——没有什么比看到你还有 100 个问题要回答更令人沮丧的了。
*   对每个输入进行验证并检查它 onblur()。如果他们到达页面的末尾，然后它说“问题 #2 不正确”，那么他们很可能已经忘记了那个问题是什么，并且返回它会更加困难。另外，如果他们以特定的、不正确的方式回答了一系列类似的输入，您应该立即让他们知道（例如：当您想要 dd/mm/yyy 时输入日期为 mm/dd/yyyy）

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-10-24T05:15:38.730

将表格分成几个步骤。这就像某人阅读五个 3 句的段落比阅读一个相同长度的 15 句的大段落更有可能。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-24T12:29:24.550

如果应用程序需要包含大量信息，请确保用户可以随时保存、注销，然后再登录以完成表单。如果某些信息不一定容易获得，这将更有意义。纳税申报表是一个明显的例子，其中一些数据可能需要计算，或者用户必须找到相关文件。

在某些情况下，用户可能会在多个应用程序中使用相同的信息。在这种情况下，用户注册他们的详细信息（姓名、地址、电话号码等）可能是有意义的，这些信息会自动填写在每个应用程序中。例如，如果您有一个招聘机构的网站，他们可能允许用户注册他们的详细信息，然后申请特定的工作，他们可以只包含特别适用于该工作的个人陈述。

作为另一个考虑，如果某些信息可能不正确（特别是如果这并不总是很清楚，例如验证码或必须唯一的用户名），请将其与其余数据分开，或者以其他方式使其成为错误并不意味着必须重新输入其余信息。

这些基本上是避免用户必须两次输入相同信息的方法。

# cocoa - 如何在 Mac OS X 上创建虚拟 CD 驱动器

> ID：232524
> 
> 赞同：6
> 
> 时间：2008-10-24T05:10:14.667
> 
> 标签：cocoa, macos

如何以编程方式在 Mac OS X 上创建虚拟 CD 驱动程序？

我找不到任何相关的 Cocoa API 或任何纯 C BSD 解决方案。

任何帮助或信息表示赞赏。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-24T13:59:31.920

您需要使用 I/O Kit 框架来开发您自己的设备驱动程序来模拟虚拟 CD 驱动器。以下是相关 API 的一些链接，可帮助您入门。

[I/O 套件基础知识](http://developer.apple.com/documentation/DeviceDrivers/Conceptual/IOKitFundamentals/Introduction/chapter_1_section_1.html)

[I/O 套件设备驱动程序指南](http://developer.apple.com/documentation/DeviceDrivers/Conceptual/WritingDeviceDriver/Introduction/chapter_1_section_1.html)

[内核扩展编程主题](http://developer.apple.com/documentation/Darwin/Conceptual/KEXTConcept/KEXTConceptIOKit/hello_iokit.html)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-27T21:03:42.223

人们在这里提出了几个不同的答案。手头的问题是你想要完成什么。如果您真的想模拟 CD ROM（直至命令集），您将需要编写设备驱动程序。如果您的目标只是模拟内容类似于 CD 的块设备，您可以使用磁盘实用程序创建磁盘映像，并让内置磁盘映像驱动程序为您处理。

如果您想呈现某种自定义文件系统功能，MacFUSE 很有用，但如果您正在寻找与光盘具有相同语义的东西（无论是块级别还是命令集级别），那么它就是错误的工具。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-24T05:26:52.763

如果您只是想挂载 ISO 或其他东西，那么它可以通过磁盘工具完成，只需将其拖到侧边栏中，然后选择它并选择挂载。

如果您想从代码中执行此操作，您可以发出 hdiutil 命令，如此处[所示](http://osxdaily.com/2008/04/22/easily-mount-an-iso-in-mac-os-x/)。我不确定是否有 API 调用来做这件事，但是让那个命令来做这项工作是很轻松的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-24T22:17:01.090

挂载自定义卷的最简单方法是[MacFUSE](http://macfuse.googlecode.com/)。它为您处理 IOKit 细节并让您在用户空间中编写实现。但是，我不认为你可以让 MacFUSE “看起来像”一张 CD。您必须修改 FUSE 才能实现这一点。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2021-03-31T10:10:08.967

我对[DAEMON Tools for Mac](https://www.daemon-tools.cc/home)的驱动程序很感兴趣：

`/Library/Extensions/DAEMONToolsVirtualSCSIBus.kext/Contents/MacOS/DAEMONToolsVirtualSCSIBus`

[我使用Hopper](https://www.hopperapp.com)反汇编了二进制文件，发现它们正在使用 [IOSCSIProtocolServices](https://developer.apple.com/documentation/kernel/ioscsiprotocolservices?changes=latest_major)。

[![在此处输入图像描述](https://i.stack.imgur.com/Q2rZM.jpg)](https://i.stack.imgur.com/Q2rZM.jpg)

# c# - 如何使用反射调用泛型方法？

> ID：232535
> 
> 赞同：1203
> 
> 时间：2008-10-24T05:17:35.217
> 
> 标签：c#, .net, generics, reflection

当类型参数在编译时未知，而是在运行时动态获取时，调用泛型方法的最佳方法是什么？

考虑以下示例代码 - 在方法内部，使用存储在变量中`Example()`的最简洁的调用方式是什么？`GenericMethod<T>()``Type``myType`

```
public class Sample
{
    public void Example(string typeName)
    {
        Type myType = FindType(typeName);

        // What goes here to call GenericMethod<T>()?
        GenericMethod<myType>(); // This doesn't work

        // What changes to call StaticMethod<T>()?
        Sample.StaticMethod<myType>(); // This also doesn't work
    }

    public void GenericMethod<T>()
    {
        // ...
    }

    public static void StaticMethod<T>()
    {
        //...
    }
} 
```

* * *

## 回答 #1

> 赞同：1259
> 
> 时间：2008-10-24T06:13:34.167

您需要使用反射来获取方法，然后通过使用[MakeGenericMethod](http://msdn.microsoft.com/en-us/library/system.reflection.methodinfo.makegenericmethod.aspx)提供类型参数来“构造”它：

```
MethodInfo method = typeof(Sample).GetMethod(nameof(Sample.GenericMethod));
MethodInfo generic = method.MakeGenericMethod(myType);
generic.Invoke(this, null); 
```

对于静态方法，`null`作为第一个参数传递给`Invoke`. 这与泛型方法无关——它只是正常的反射。

如前所述，从 C# 4 开始，其中很多都更简单`dynamic`——当然，如果您可以使用类型推断。在类型推断不可用的情况下（例如问题中的确切示例），它没有帮助。

* * *

## 回答 #2

> 赞同：186
> 
> 时间：2011-02-27T16:11:31.333

只是对原始答案的补充。虽然这会起作用：

```
MethodInfo method = typeof(Sample).GetMethod("GenericMethod");
MethodInfo generic = method.MakeGenericMethod(myType);
generic.Invoke(this, null); 
```

这也有点危险，因为您会丢失对`GenericMethod`. 如果您稍后进行重构和重命名`GenericMethod`，此代码将不会注意到并且会在运行时失败。此外，如果对程序集进行任何后处理（例如混淆或删除未使用的方法/类），此代码也可能会中断。

因此，如果您知道在编译时链接到的方法，并且这不会被调用数百万次，因此开销无关紧要，我会将此代码更改为：

```
Action<> GenMethod = GenericMethod<int>;  //change int by any base type 
                                          //accepted by GenericMethod
MethodInfo method = this.GetType().GetMethod(GenMethod.Method.Name);
MethodInfo generic = method.MakeGenericMethod(myType);
generic.Invoke(this, null); 
```

虽然不是很漂亮，但您在此处有一个编译时参考`GenericMethod`，如果您重构、删除或对 执行任何操作`GenericMethod`，此代码将继续工作，或者至少在编译时中断（例如，如果您删除`GenericMethod`）。

其他方法是创建一个新的包装类，并通过`Activator`. 不知道有没有更好的办法。

* * *

## 回答 #3

> 赞同：161
> 
> 时间：2014-03-16T19:21:20.967

[`dynamic`](http://msdn.microsoft.com/en-us/library/dd264741.aspx)通过使用类型而不是反射 API，可以大大简化使用仅在运行时已知的类型参数调用泛型方法。

要使用这种技术，必须从实际对象（不仅仅是`Type`类的实例）中知道类型。否则，您必须创建该类型的对象或使用标准反射 API[解决方案](https://stackoverflow.com/a/232621/350384)。[您可以使用Activator.CreateInstance](http://msdn.microsoft.com/en-us/library/wccyzw83%28v=vs.110%29.aspx)方法创建对象。

如果你想调用一个泛型方法，在“正常”使用中会推断出它的类型，那么它只是将未知类型的对象转换为`dynamic`. 这是一个例子：

```
class Alpha { }
class Beta { }
class Service
{
    public void Process<T>(T item)
    {
        Console.WriteLine("item.GetType(): " + item.GetType()
                          + "\ttypeof(T): " + typeof(T));
    }
}

class Program
{
    static void Main(string[] args)
    {
        var a = new Alpha();
        var b = new Beta();

        var service = new Service();
        service.Process(a); // Same as "service.Process<Alpha>(a)"
        service.Process(b); // Same as "service.Process<Beta>(b)"

        var objects = new object[] { a, b };
        foreach (var o in objects)
        {
            service.Process(o); // Same as "service.Process<object>(o)"
        }
        foreach (var o in objects)
        {
            dynamic dynObj = o;
            service.Process(dynObj); // Or write "service.Process((dynamic)o)"
        }
    }
} 
```

这是这个程序的输出：

```
item.GetType(): Alpha    typeof(T): Alpha
item.GetType(): Beta     typeof(T): Beta
item.GetType(): Alpha    typeof(T): System.Object
item.GetType(): Beta     typeof(T): System.Object
item.GetType(): Alpha    typeof(T): Alpha
item.GetType(): Beta     typeof(T): Beta 
```

`Process`是一个泛型实例方法，它写入传递参数的真实类型（通过使用`GetType()`方法）和泛型参数的类型（通过使用`typeof`运算符）。

通过将对象参数转换为`dynamic`类型，我们将提供类型参数推迟到运行时。当`Process`使用参数调用方法时`dynamic`，编译器不关心此参数的类型。编译器生成代码，在运行时检查传递参数的真实类型（通过使用反射）并选择最佳调用方法。这里只有一个泛型方法，因此使用适当的类型参数调用它。

在此示例中，输出与您编写的相同：

```
foreach (var o in objects)
{
    MethodInfo method = typeof(Service).GetMethod("Process");
    MethodInfo generic = method.MakeGenericMethod(o.GetType());
    generic.Invoke(service, new object[] { o });
} 
```

动态类型的版本肯定更短更容易编写。您也不应该担心多次调用此函数的性能。由于DLR中的[缓存机制，下一次使用相同类型参数的调用应该会更快。](https://web.archive.org/web/20140422080408/http://blogs.msdn.com/b/samng/archive/2008/10/29/dynamic-in-c.aspx)当然，您可以编写缓存调用的委托的代码，但是通过使用`dynamic`类型，您可以免费获得这种行为。

如果您要调用的泛型方法没有参数化类型的参数（因此无法推断其类型参数），那么您可以将泛型方法的调用包装在辅助方法中，如下例所示：

```
class Program
{
    static void Main(string[] args)
    {
        object obj = new Alpha();

        Helper((dynamic)obj);
    }

    public static void Helper<T>(T obj)
    {
        GenericMethod<T>();
    }

    public static void GenericMethod<T>()
    {
        Console.WriteLine("GenericMethod<" + typeof(T) + ">");
    }
} 
```

# 提高类型安全性

使用对象来替代使用反射 API 的真正`dynamic`好处在于，您只会丢失对这种特定类型的编译时检查，而您直到运行时才知道。编译器照常静态分析其他参数和方法名称。如果您删除或添加更多参数、更改它们的类型或重命名方法名称，那么您将收到编译时错误。如果您提供方法名称作为字符串 in`Type.GetMethod`和参数作为对象数组 in ，则不会发生这种情况`MethodInfo.Invoke`。

下面是一个简单的示例，说明了如何在编译时（注释代码）和运行时捕获其他错误。它还显示了 DLR 如何尝试解析要调用的方法。

```
interface IItem { }
class FooItem : IItem { }
class BarItem : IItem { }
class Alpha { }

class Program
{
    static void Main(string[] args)
    {
        var objects = new object[] { new FooItem(), new BarItem(), new Alpha() };
        for (int i = 0; i < objects.Length; i++)
        {
            ProcessItem((dynamic)objects[i], "test" + i, i);

            //ProcesItm((dynamic)objects[i], "test" + i, i);
            //compiler error: The name 'ProcesItm' does not
            //exist in the current context

            //ProcessItem((dynamic)objects[i], "test" + i);
            //error: No overload for method 'ProcessItem' takes 2 arguments
        }
    }

    static string ProcessItem<T>(T item, string text, int number)
        where T : IItem
    {
        Console.WriteLine("Generic ProcessItem<{0}>, text {1}, number:{2}",
                          typeof(T), text, number);
        return "OK";
    }
    static void ProcessItem(BarItem item, string text, int number)
    {
        Console.WriteLine("ProcessItem with Bar, " + text + ", " + number);
    }
} 
```

`dynamic`在这里，我们再次通过将参数转换为类型来执行一些方法。只有第一个参数类型的验证被推迟到运行时。如果您正在调用的方法的名称不存在或其他参数无效（参数数量错误或类型错误），您将收到编译器错误。

当您将`dynamic`参数传递给方法时，此调用是[最近绑定的](https://ericlippert.com/2012/02/06/what-is-late-binding/)。方法重载解析发生在运行时并尝试选择最佳重载。因此，如果您`ProcessItem`使用类型对象调用该方法，`BarItem`那么您实际上将调用非泛型方法，因为它更适合这种类型。但是，当您传递该`Alpha`类型的参数时会出现运行时错误，因为没有可以处理此对象的方法（泛型方法具有约束`where T : IItem`并且`Alpha`类不实现此接口）。但这就是重点。编译器没有此调用有效的信息。作为程序员的你知道这一点，你应该确保这段代码运行没有错误。

## 返回类型陷阱

当您使用动态类型的参数调用非 void 方法时，它的返回类型[可能`dynamic`也是](https://ericlippert.com/2012/10/22/a-method-group-of-one/). 因此，如果您将前面的示例更改为此代码：

```
var result = ProcessItem((dynamic)testObjects[i], "test" + i, i); 
```

那么结果对象的类型将是`dynamic`. 这是因为编译器并不总是知道将调用哪个方法。如果您知道函数调用的返回类型，那么您应该将其[隐式转换](http://msdn.microsoft.com/en-us/library/dd264736.aspx)为所需的类型，以便其余代码是静态类型的：

```
string result = ProcessItem((dynamic)testObjects[i], "test" + i, i); 
```

如果类型不匹配，您将收到运行时错误。

实际上，如果您尝试在前面的示例中获取结果值，那么您将在第二次循环迭代中遇到运行时错误。这是因为您试图保存 void 函数的返回值。

* * *

## 回答 #4

> 赞同：17
> 
> 时间：2011-07-05T13:40:51.637

在 C# 4.0 中，不需要反射，因为 DLR 可以使用运行时类型调用它。由于动态使用 DLR 库是一种痛苦（而不是 C# 编译器为您生成代码），开源框架[Dynamitey](https://github.com/ekonbenefits/dynamitey)（.net 标准 1.5）让您可以轻松缓存运行时访问编译器将生成的相同调用为你。

```
var name = InvokeMemberName.Create;
Dynamic.InvokeMemberAction(this, name("GenericMethod", new[]{myType}));

var staticContext = InvokeContext.CreateStatic;
Dynamic.InvokeMemberAction(staticContext(typeof(Sample)), name("StaticMethod", new[]{myType})); 
```

* * *

## 回答 #5

> 赞同：17
> 
> 时间：2015-01-09T22:20:50.463

添加到[Adrian Gallero 的答案](https://stackoverflow.com/questions/232535/how-do-i-use-reflection-to-call-a-generic-method/5134251#5134251)：

从类型信息调用泛型方法涉及三个步骤。

##TLDR：使用类型对象调用已知的泛型方法可以通过以下方式完成：##

```
((Action)GenericMethod<object>)
    .Method
    .GetGenericMethodDefinition()
    .MakeGenericMethod(typeof(string))
    .Invoke(this, null); 
```

哪里`GenericMethod<object>`是要调用的方法名称以及满足通用约束的任何类型。

(Action) 匹配要调用的方法的签名，即 (`Func<string,string,int>`或`Action<bool>`)

##Step 1 正在获取泛型方法定义的 MethodInfo##

###Method 1：使用带有适当类型或绑定标志的 GetMethod() 或 GetMethods()。###

```
MethodInfo method = typeof(Sample).GetMethod("GenericMethod"); 
```

###Method 2：创建委托，获取MethodInfo对象，然后调用GetGenericMethodDefinition

从包含方法的类内部：

```
MethodInfo method = ((Action)GenericMethod<object>)
    .Method
    .GetGenericMethodDefinition();

MethodInfo method = ((Action)StaticMethod<object>)
    .Method
    .GetGenericMethodDefinition(); 
```

从包含方法的类外部：

```
MethodInfo method = ((Action)(new Sample())
    .GenericMethod<object>)
    .Method
    .GetGenericMethodDefinition();

MethodInfo method = ((Action)Sample.StaticMethod<object>)
    .Method
    .GetGenericMethodDefinition(); 
```

在C#中，方法的名称，即“ToString”或“GenericMethod”实际上是指一组方法，其中可能包含一个或多个方法。在您提供方法参数的类型之前，不知道您指的是哪种方法。

`((Action)GenericMethod<object>)`指代特定方法的委托。 `((Func<string, int>)GenericMethod<object>)` 指的是不同的 GenericMethod 重载

###Method 3：创建一个包含方法调用表达式的lambda表达式，获取MethodInfo对象然后GetGenericMethodDefinition

```
MethodInfo method = ((MethodCallExpression)((Expression<Action<Sample>>)(
    (Sample v) => v.GenericMethod<object>()
    )).Body).Method.GetGenericMethodDefinition(); 
```

这分解为

创建一个 lambda 表达式，其中主体是对所需方法的调用。

```
Expression<Action<Sample>> expr = (Sample v) => v.GenericMethod<object>(); 
```

提取主体并转换为 MethodCallExpression

```
MethodCallExpression methodCallExpr = (MethodCallExpression)expr.Body; 
```

从方法中获取泛型方法定义

```
MethodInfo methodA = methodCallExpr.Method.GetGenericMethodDefinition(); 
```

##Step 2 正在调用 MakeGenericMethod 以创建具有适当类型的泛型方法。##

```
MethodInfo generic = method.MakeGenericMethod(myType); 
```

##Step 3 使用适当的参数调用方法。##

```
generic.Invoke(this, null); 
```

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2016-08-24T01:24:01.113

**没有人提供“*经典反射*”的解决方案，所以这里是一个完整的代码示例：**

```
using System;
using System.Collections;
using System.Collections.Generic;

namespace DictionaryRuntime
{
    public class DynamicDictionaryFactory
    {
        /// <summary>
        /// Factory to create dynamically a generic Dictionary.
        /// </summary>
        public IDictionary CreateDynamicGenericInstance(Type keyType, Type valueType)
        {
            //Creating the Dictionary.
            Type typeDict = typeof(Dictionary<,>);

            //Creating KeyValue Type for Dictionary.
            Type[] typeArgs = { keyType, valueType };

            //Passing the Type and create Dictionary Type.
            Type genericType = typeDict.MakeGenericType(typeArgs);

            //Creating Instance for Dictionary<K,T>.
            IDictionary d = Activator.CreateInstance(genericType) as IDictionary;

            return d;

        }
    }
} 
```

上面的`DynamicDictionaryFactory`类有一个方法

`CreateDynamicGenericInstance(Type keyType, Type valueType)`

它创建并返回一个 IDictionary 实例，其键和值的类型与调用`keyType`和`valueType`.

**这是一个完整的示例**，如何调用此方法来实例化和使用 a `Dictionary<String, int>`：

```
using System;
using System.Collections.Generic;

namespace DynamicDictionary
{
    class Test
    {
        static void Main(string[] args)
        {
            var factory = new DictionaryRuntime.DynamicDictionaryFactory();
            var dict = factory.CreateDynamicGenericInstance(typeof(String), typeof(int));

            var typedDict = dict as Dictionary<String, int>;

            if (typedDict != null)
            {
                Console.WriteLine("Dictionary<String, int>");

                typedDict.Add("One", 1);
                typedDict.Add("Two", 2);
                typedDict.Add("Three", 3);

                foreach(var kvp in typedDict)
                {
                    Console.WriteLine("\"" + kvp.Key + "\": " + kvp.Value);
                }
            }
            else
                Console.WriteLine("null");
        }
    }
} 
```

当执行上述控制台应用程序时，我们得到了正确的预期结果：

```
Dictionary<String, int>
"One": 1
"Two": 2
"Three": 3 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2015-10-22T23:28:17.607

这是基于[Grax 的答案](https://stackoverflow.com/questions/232535/how-do-i-use-reflection-to-call-a-generic-method/27870198#27870198)的我的 2 美分，但通用方法需要两个参数。

假设您的方法在 Helpers 类中定义如下：

```
public class Helpers
{
    public static U ConvertCsvDataToCollection<U, T>(string csvData)
    where U : ObservableCollection<T>
    {
      //transform code here
    }
} 
```

在我的例子中，U 类型始终是存储 T 类型对象的可观察集合。

由于我已经预定义了类型，我首先创建了代表可观察集合 (U) 和存储在其中的对象 (T) 的“虚拟”对象，这些对象将在下面调用 Make 时用于获取它们的类型

```
object myCollection = Activator.CreateInstance(collectionType);
object myoObject = Activator.CreateInstance(objectType); 
```

然后调用 GetMethod 来查找您的通用函数：

```
MethodInfo method = typeof(Helpers).
GetMethod("ConvertCsvDataToCollection"); 
```

到目前为止，上面的调用与上面解释的几乎相同，但是当你需要向它传递多个参数时会有一点不同。

您需要将 Type[] 数组传递给包含上面创建的“虚拟”对象类型的 MakeGenericMethod 函数：

```
MethodInfo generic = method.MakeGenericMethod(
new Type[] {
   myCollection.GetType(),
   myObject.GetType()
}); 
```

完成后，您需要调用上面提到的 Invoke 方法。

```
generic.Invoke(null, new object[] { csvData }); 
```

你完成了。很有魅力！

**更新：**

正如@Bevan 强调的那样，在调用 MakeGenericMethod 函数时我不需要创建数组，因为它需要参数，我不需要创建对象来获取类型，因为我可以直接将类型传递给这个函数。就我而言，由于我在另一个类中预定义了类型，我只是将代码更改为：

```
object myCollection = null;

MethodInfo method = typeof(Helpers).
GetMethod("ConvertCsvDataToCollection");

MethodInfo generic = method.MakeGenericMethod(
   myClassInfo.CollectionType,
   myClassInfo.ObjectType
);

myCollection = generic.Invoke(null, new object[] { csvData }); 
```

myClassInfo 包含`Type`我在运行时根据传递给构造函数的枚举值设置的 2 个类型属性，并将为我提供相关类型，然后我将在 MakeGenericMethod 中使用这些类型。

再次感谢您强调此@Bevan。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2020-03-03T10:08:28.367

受[Enigmativity 回答](https://stackoverflow.com/a/3958029/1016343)的启发 - 假设您有两个（或更多）课程，例如

```
public class Bar { }
public class Square { } 
```

并且您想`Foo<T>`使用`Bar`and调用该方法`Square`，该方法声明为

```
public class myClass
{
    public void Foo<T>(T item)
    {
        Console.WriteLine(typeof(T).Name);
    }
} 
```

然后你可以实现一个**扩展方法**，如：

```
public static class Extension
{
    public static void InvokeFoo<T>(this T t)
    {
        var fooMethod = typeof(myClass).GetMethod("Foo");
        var tType = typeof(T);
        var fooTMethod = fooMethod.MakeGenericMethod(new[] { tType });
        fooTMethod.Invoke(new myClass(), new object[] { t });
    }
} 
```

有了这个，你可以简单地调用`Foo`：

```
var objSquare = new Square();
objSquare.InvokeFoo();

var objBar = new Bar();
objBar.InvokeFoo(); 
```

适用于每个班级。在这种情况下，它将输出：

> 方形
> 酒吧

# c# - 从 C# 中的矩形数组中提取一维数组的最佳方法是什么？

> ID：232545
> 
> 赞同：14
> 
> 时间：2008-10-24T05:21:00.247
> 
> 标签：c#, .net, arrays, casting

假设我有一个矩形字符串数组 - 不是锯齿状数组

```
string[,] strings = new string[8, 3]; 
```

从中提取一维数组（单行或单列）的最佳方法是什么？当然，我可以使用 for 循环来做到这一点，但我希望 .NET 有一种更优雅的内置方式。

将提取的字符串数组转换为对象数组的奖励积分。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-10-24T05:30:32.803

您可以轻松地将字符串数组转换为对象数组 - 反之亦然。但是，据我所知，实际提取*必须*[`Array.Copy`](http://msdn.microsoft.com/en-us/library/system.array.copy.aspx)使用 for 循环：要求源和目标等级相同，并且[`Buffer.BlockCopy`](http://msdn.microsoft.com/en-us/library/system.buffer.blockcopy.aspx)仅适用于值类型数组。虽然看起来很奇怪...

您可以使用 LINQ 在单个语句中添加一行或一列，尽管它效率低下（因为它会在内部构建一个列表，然后必须将其转换为一个数组 - 如果您自己这样做，您可以预先分配数组到正确的大小并直接复制）。

复制一行（`rowNum`是要复制的行）：

```
object[] row = Enumerable.Range(0, rowLength)
                         .Select(colNum => (object) stringArray[rowNum, colNum])
                         .ToArray(); 
```

复制列（`colNum`是要复制的列）：

```
object[] column = Enumerable.Range(0, columnLength)
                            .Select(rowNum => (object) stringArray[rowNum, colNum])
                            .ToArray(); 
```

我不确定这是否真的比 foreach 循环更好/更简单 - 特别是如果您编写一个`ExtractRow`方法和一个`ExtractColumn`方法并重用它们。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-10-24T13:15:41.557

对于矩形阵列：

```
string[,] rectArray = new string[3,3] { 
    {"a", "b", "c"}, 
    {"d", "e", "f"}, 
    {"g", "h", "i"} };

var rectResult = rectArray.Cast<object>().ToArray(); 
```

对于锯齿状数组：

```
string[][] jaggedArray =  { 
    new string[] {"a", "b", "c", "d"}, 
    new string[] {"e", "f"}, 
    new string[] {"g", "h", "i"} };

var jaggedResult = jaggedArray.SelectMany(s => s).Cast<object>().ToArray(); 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-24T06:42:51.267

我只是想澄清一下（给出例子和被问到的内容）。

**锯齿状数组**是数组的数组，声明如下：

```
string[][] data = new string[3][];
data[0] = new string[] { "0,[0]", "0,[1]", "0,[2]" };
data[1] = new string[] { "1,[0]", "1,[1]", "1,[2]" ];
data[2] = new string[] { "2,[0]", "1,[1]", "1,[2]" }; 
```

与将**矩形数组**定义为包含多个维度的单个数组相比：

```
string[,] data = new string[3,3];
data[0,0] = "0,0";
data[0,1] = "0,1";
data[0,2] = "0,2";
...etc 
```

因此，***锯齿状数组***是 IQueryable/IEnumerable 的，因为您可以对其进行迭代以在每次迭代时接收一个数组。而***矩形数组***不是IQueryable/IEnumerable，因为元素是在全维度（0,0 0,1..etc）中寻址的，**因此**在这种情况下您将无法使用 Linq 或为 Array 创建的任何预定义函数。

尽管您可以像这样遍历数组一次（并实现您想要的）：

```
/// INPUT: rowIndex, OUTPUT: An object[] of data for that row
int colLength = stringArray.GetLength(1);
object[] rowData = new object[colLength];
for (int col = 0; col < colLength; col++) {
    rowData[col] = stringArray[rowIndex, col] as object;
}
return rowData;

/// INPUT: colIndex, OUTPUT: An object[] of data for that column
int rowLength = stringArray.GetLength(0);
object[] colData = new object[rowLength];
for (int row = 0; r < rowLength; row++) {
    colData[row] = stringArray[row, colIndex] as object;
}
return colData; 
```

希望这可以帮助 ：）

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-24T05:24:53.483

LINQ 就是答案

```
static object[] GetColumn(string[][] source, int col) {
    return source.Iterate().Select(x => source[x.Index][col]).Cast<object>().ToArray();
}
static object[] GetRow(string[][] source, int row) {
    return source.Skip(row).First().Cast<object>().ToArray();
}
public class Pair<T> {
    public int Index;
    public T Value;
    public Pair(int i, T v) {
        Index = i;
        Value = v;
    }
}
static IEnumerable<Pair<T>> Iterate<T>(this IEnumerable<T> source) {
    int index = 0;
    foreach (var cur in source) {
        yield return new Pair<T>(index, cur);
        index++;
    }
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-24T09:04:25.133

可以使用 Array.Copy 轻松复制行：

```
 int[][] arDouble = new int[2][];
        arDouble[0] = new int[2];
        arDouble[1] = new int[2];
        arDouble[0][0] = 1;
        arDouble[0][1] = 2;
        arDouble[1][0] = 3;
        arDouble[1][1] = 4;

        int[] arSingle = new int[arDouble[0].Length];

        Array.Copy(arDouble[0], arSingle, arDouble[0].Length); 
```

这会将第一行复制到单个维度数组中。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2015-12-30T08:27:02.730

我做了扩展方法。我不知道性能。

```
public static class ExtensionMethods 
{
     public static string[] get1Dim(this string[,] RectArr, int _1DimIndex , int _2DimIndex   )
     {
        string[] temp = new string[RectArr.GetLength(1)];

        if (_2DimIndex == -1)
        {
          for (int i = 0; i < RectArr.GetLength(1); i++)
          {   temp[i] = RectArr[_1DimIndex, i];    }
        }
        else
        {
          for (int i = 0; i < RectArr.GetLength(0); i++)
          {   temp[i] = RectArr[  i , _2DimIndex];    }
        }

         return temp;
      }
} 
```

用法

```
// we now have this funtionaliy RectArray[1, * ]  
//                                       -1 means ALL    
string[] _1stRow = RectArray.get1Dim( 0, -1) ;    
string[] _2ndRow = RectArray.get1Dim( 1, -1) ; 

string[] _1stCol = RectArray.get1Dim( -1, 0) ;    
string[] _2ndCol = RectArray.get1Dim( -1, 1) ; 
```

# parsing - 关于如何制作可配置解析器的建议

> ID：232556
> 
> 赞同：1
> 
> 时间：2008-10-24T05:27:07.893
> 
> 标签：parsing, bit-manipulation, configurability

我想为类似 C 的语言构建解析器。关于它的有趣方面是我想以这样一种方式构建它，即有权访问源代码的人可以轻松修改它以扩展语言（一种新的表达式类型的实例），扩展是运行时可配置的（它们可以是打开和关闭）。

我目前的意图是构建一个像样的递归解析器作为对象。每个产生式都将是一个对象的一个​​方法。扩展的方法是根据需要从这个基础替换方法（和生产定义）派生类。我仍在尝试弄清楚如何混合和匹配扩展。一个想法是用 v-tbl 玩游戏。对象将使用 v-tbl 构造，该 v-tbl 是基类的副本，但使用派生类替换的方法。

除了解决方案的有点混乱之外，我唯一遇到的问题是

*   进行 v-tbl 混合的合理方法
*   当 2 个扩展改变相同的产品时该怎么办（因为大多数替换最终会调用原来的替换调用另一个会起作用，但设置它的机制是问题）
*   如何允许扩展扩展（这可能最终看起来像一个标准的 MI 系统，但我从来不知道它们是如何工作的）

另一种解决方案（相同方法的稍微普通的版本）是使用静态成员变量来存储函数指针并调用它们以获得相同的效果。

*编辑：*我已经构建了一个系统，可以让我从 BNF 定义构建产品。我可以改变它来支持我决定的任何事情。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-24T05:58:38.580

These are some of the challenges the Perl 6 design effort has faced. You may find it worthwhile looking into some of the solutions they came up with. Or you may find that to be gross overkill.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-02-01T09:08:42.257

我做了一个可配置的解析器，前段时间在 [http://code.google.com/p/compparser/](http://code.google.com/p/compparser/)上传了它 。那里的项目不是最新的，但运行良好。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-24T06:05:31.390

如果我正确地记得我的大学课程，递归下降解析器有一些限制可能会咬你，特别是因为你允许扩展 - 其他人的语言扩展可能会导致问题。

一个合适的编译器工具包——比如开源的[ANTLR——](http://www.antlr.org/)可能会使事情变得更容易，并且还可能为您提供一些不同的方法。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-24T06:51:49.487

另一种选择是用 XML 或其他东西而不是代码来表达解析规则；效率较低，但可动态配置得多；每种语言或变体都可以只使用自己的（XML）文件，甚至包括/引用其他文件作为“基础”文件......

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-24T09:56:14.483

坦率地说，我什至不确定我是否理解你所写的一切...... :-)

但是当我看到*解析器*和*灵活性*时，我想到了[LPeg-Parsing Expression Grammars For Lua](http://www.inf.puc-rio.br/~roberto/lpeg/lpeg.html "LPeg - 为 Lua 解析表达式语法")。它可能不符合您的需求，但值得一看... ;-)

# c# - 为什么 IEnumerator 从 IDisposable 继承而非泛型 IEnumerator 不继承？

> ID：232558
> 
> 赞同：79
> 
> 时间：2008-10-24T05:27:34.710
> 
> 标签：c#, generics, ienumerator

我注意到泛型`IEnumerator<T>`继承自 IDisposable，但非泛型接口 IEnumerator 没有。为什么要这样设计？

通常，我们使用 foreach 语句来遍历一个`IEnumerator<T>`实例。foreach 生成的代码实际上有 try-finally 块，它在 finally 中调用 Dispose()。

* * *

## 回答 #1

> 赞同：87
> 
> 时间：2008-10-24T06:06:29.190

基本上这是一个疏忽。在 C# 1.0 中，`foreach` *从未*调用`Dispose` ¹。随着 C# 1.2（在 VS2003 中引入 - 奇怪的是没有 1.1）`foreach`开始检查`finally`块是否实现了迭代器`IDisposable`- 他们必须这样做，因为回顾性地进行`IEnumerator`扩展`IDisposable`会破坏每个人的`IEnumerator`. 如果他们发现首先`foreach`处理迭代器很有用，我肯定`IEnumerator`会扩展`IDisposable`.

然而，当 C# 2.0 和 .NET 2.0 出现时，它们有了新的机会——新的接口，新的继承。扩展接口更有意义，`IDisposable`这样您就不需要在 finally 块中进行执行时检查，现在编译器知道如果迭代器是 an`IEnumerator<T>`它可以发出对`Dispose`.

`Dispose`编辑：在迭代结束时调用它非常有用（但是它结束了）。这意味着迭代器可以保留资源——这使得它可以逐行读取文件。迭代器块生成`Dispose`实现，确保`finally`与迭代器的“当前执行点”相关的任何块在它被释放时被执行 - 因此您可以在迭代器中编写正常代码并且应该适当地进行清理。

* * *

¹回顾 1.0 规范，它已经被指定了。我还无法验证 1.0 实现没有调用`Dispose`.

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-24T05:56:13.657

IEnumerable<T> 不继承 IDisposable。然而 IEnumerator<T> 确实继承了 IDisposable，而非泛型 IEnumerator 则没有。即使您将*foreach*用于非泛型 IEnumerable（返回 IEnumerator），编译器仍会生成 IDisposable 检查并在枚举器实现接口时调用 Dispose()。

我猜通用 Enumerator<T> 继承自 IDisposable 所以不需要进行运行时类型检查——它可以继续调用 Dispose() ，它应该具有更好的性能，因为如果枚举器有一个空的 Dispose() 方法。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2011-12-28T06:42:41.240

我理性地编写了一个库，我在其中使用`IEnumerable of T`/`IEnumerator of T`该库的用户可以实现他们应该实现的自定义迭代器`IEnumerator of T`。

我发现 T 的 IEnumerator 会从 IDisposable 继承，这很奇怪。如果我们想释放非托管资源，我们实现 IDisposable 对吗？所以它只与实际持有非托管资源的枚举器相关——比如 IO 流等。如果有意义的话，为什么不让用户在他们的枚举器上同时实现 T 的 IEnumerator 和 IDisposable 呢？在我的书中，这违反了单一责任原则——为什么要混合枚举器逻辑和处置对象。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-24T05:45:45.813

IEnumerable` 是否继承 IDisposing？根据 .NET 反射器或[MSDN](http://msdn.microsoft.com/en-us/library/9eekhta0.aspx)。您确定不会将其与[IEnumerator](http://msdn.microsoft.com/en-us/library/78dfe2yb.aspx)混淆吗？这使用 IDisposing 因为它仅用于枚举集合而不是为了长寿。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-24T05:57:36.367

对此有点难以确定，除非您设法从 AndersH 本人或与他关系密切的人那里得到回应。

但是，我的猜测是它与同时在 C# 中引入的“yield”关键字有关。如果您查看使用“yield return x”时编译器生成的代码，您会看到该方法封装在一个实现 IEnumerator 的辅助类中；让 IEnumerator 从 IDisposable 下降确保它可以在枚举完成时进行清理。

* * *

## 回答 #6

> 赞同：-2
> 
> 时间：2008-10-24T05:29:38.747

IIRC 关于拥有`IEnumerable<T>`并且`IEnumerable`是`IEnumerable`早于 .Net 模板内容的结果。我怀疑你的问题是一样的。

# winforms - Winforms user control getting clipped when in another user control (sometimes)

> ID：232563
> 
> 赞同：1
> 
> 时间：2008-10-24T05:30:49.790
> 
> 标签：winforms, visual-studio-2005

The problem is fairly simple, but is best illustrated visually. Note that all screen shots are from the Visual Studio 2005 design surface. I've noticed no difference when I actually run the application.

Here is my user control (let's call this UC-1):

![alt text](https://i.stack.imgur.com/0HwH2.png)

The buttons on the control are set to anchor to Bottom + Right.

Here is what it looks like when placed onto a particular parent user control (UC-A):

![alt text](https://i.stack.imgur.com/3uajb.png)

Please disregard the difference in colors and such. Some styling is done in the user control's constructor.

Notice the bottom of the control is getting clipped. The instance of the consumed control on the parent is set with a "FixedSingle" border. Notice also that the consumed control is taller than the original, indicating that the buttons bottom anchor settings are being respected, but are essentially overshooting where it should be.

To confirm this is definitely a problem on the parent control, notice another user control (UC-2) containing a data grid view when placed on the same parent:

![alt text](https://i.stack.imgur.com/QgraT.png)

Again, the instance of the consumed control is set with a "FixedSingle" border which helps illustrate the clipping. The datagrid is properly anchored to the Bottom Right. To reinforce the perplexity of this problem, here's the first user control (UC-1) when placed on a different parent user control (UC-B):

[alt text http://i38.tinypic.com/2rnyjd0.png](http://i38.tinypic.com/2rnyjd0.png)

Here's the second "consumed" control (UC-2) when consumed by a form:

![alt text](https://i.stack.imgur.com/KT1em.png)

Notice, no clipping this time.

I have spent many hours searching and experimenting to resolve this. I have exhausted the various settings of margins, padding, sizes (min/max), locations, anchors... etc. I can not for the life of me figure out why this one user control is causing child user controls to clip like this.

Another strange thing I noticed was that when I do an UNDO on the parent user control design surface (where the controls are misbehaving), the clipped user control instances actually shift location even though the undo action is unrelated to those controls. For example, if I make the main containing control larger, then undo, a couple of the child user controls jump up. They appear to move about as far as they are being clipped. Very suspicious.

Does anyone have any idea what is going on??

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-24T05:53:06.890

A very interesting problem!

Does your problem parent (UC-A) override any of the methods around sizing or client areas?

Or has UC-A got a negative value for the bottom value of Padding or Margin ?

Is there anything else docked at the bottom edge of UC-A? Perhaps, something that has a negative size?

Or, does UC-A set the constraints of its child controls? If the minimum height of the panel is forced too large, you would get this result.

Hope this is helpful! If not, is there any chance you post the source to UC-A ?

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-18T01:13:10.830

我遇到了完全相同的问题，并在寻找可能的解决方案时找到了您的帖子。虽然我很确定这是 winforms 中的一个错误，但我找到了一些解决方法。只需将用户控件中的所有内容放在面板内，将面板停靠到完整位置，然后在面板内进行锚定。这似乎缓解了这个问题，尽管我的按钮确实倾向于以与父控件中的大小略有不同的大小显示。很奇怪。我通过在设计器中使按钮变小来进行补偿，并且由于某些未知原因，它在父控件中扩展了几个像素。希望这可以帮助。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-24T15:01:00.487

假设有问题的父控件不是标准的 .NET 框架类型，而是自定义的，我猜想它在其逻辑的某处混淆了客户端和屏幕坐标。但这只是一个猜测。

# java - Sun App Server Deployment Error

> ID：232568
> 
> 赞同：1
> 
> 时间：2008-10-24T05:34:38.287
> 
> 标签：java, jsp, web-deployment, application-server

`Sun App Server Deployment` : When choose to precompile JSP : Throw this error

```
 com.sun.enterprise.admin.common.exception.MBeanConfigException:
 Component not registered then have to do asadmin undeploy 
```

Anyone know what is the reason for this error?

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-07-24T13:34:07.893

这是 j2ee 应用程序有时会发生的事情。您只需要正确遵循部署过程即可。

# .net - .NET library for working with mobile devices eg PDA

> ID：232572
> 
> 赞同：2
> 
> 时间：2008-10-24T05:36:32.323
> 
> 标签：.net, windows-mobile

Does anyone know any good .net libraries for working with PDAs and such?

I mainly looking for something that will allow me to copy files to/from devices and do some registry work on the device. The PDAs are running windows mobile 5 & 6

I have been using the OpenNETCF.Desktop.Communication.RAPI library in a couple of my apps but I was just interested to see what other people are using.

Thanks

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-24T05:53:22.537

.NET CF 2.0 has a built-in Registry namespace for dealing with the registry.

The CF applications that I write usually talk to a web service running under IIS on a server. If the application needs a file from the server, the web service returns it as a byte array. RAPI can be a royal pain, and I've managed to avoid it successfully so far.

# sql-server - How do I check if a column exists in SQL Server?

> ID：232575
> 
> 赞同：27
> 
> 时间：2008-10-24T05:40:08.307
> 
> 标签：sql-server, metadata, table-structure

How do I check if a column exists in SQL Server 2000?

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2008-10-24T05:46:40.023

```
IF EXISTS ( SELECT * FROM INFORMATION_SCHEMA.COLUMNS
WHERE  TABLE_NAME='tablename' AND COLUMN_NAME='columname' ) 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2010-08-31T21:02:55.870

```
If col_length('table_name','column_name') is null
    select 0 as Present
ELSE
    select 1 as Present 
```

Present 将为 0，如果 table_name 中没有 column_name，否则为 1

@CMS：我认为“INFORMATION_SCHEMA.COLUMNS”没有关于数据库中每个表的信息。因为这对我不起作用。但我的回答确实奏效了。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-24T06:03:31.457

In query analyzer, select the Database that contains the table in which you need to check if the field exists or not and run the query below.

```
SELECT count(*) AS [Column Exists] 
FROM SYSOBJECTS  
INNER JOIN SYSCOLUMNS ON SYSOBJECTS.ID = SYSCOLUMNS.ID 
WHERE 
 SYSOBJECTS.NAME = 'myTable' 
 AND SYSCOLUMNS.NAME = 'Myfield' 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-04-29T15:02:40.137

这应该做得很好：

```
if COLUMNPROPERTY(object_id('table_name'), 'column_name', 'ColumnId') is null
  print 'doesn\'t exist'
else
  print 'exists' 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-09-30T13:04:20.393

我不知道这个脚本是否可以在 sqlserver 2000 中工作，但在 2008 年可以工作：

```
SELECT COLUMNS.*
FROM INFORMATION_SCHEMA.COLUMNS COLUMNS, INFORMATION_SCHEMA.TABLES TABLES
WHERE COLUMNS.TABLE_NAME=TABLES.TABLE_NAME AND UPPER(COLUMNS.COLUMN_NAME)=UPPER('column_name') 
```

# file - How to backup project folders to local desktop if path more than 255 characters?

> ID：232580
> 
> 赞同：1
> 
> 时间：2008-10-24T05:45:26.970
> 
> 标签：file

For e.g. if i am storing some files on a network server which is under many hierarchical folders.

Then i want to do backup. But i always encounter issue because the file path is more than 255?

How can i resolve this issue or work around it?

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-24T07:03:31.850

前言：我假设您要将文件复制到的机器的操作系统是某种类型的 Windows。

Mark Bessey 的第一部分有些正确，但是即使在具有现代文件系统（例如 NTFS）的现代版本的 Windows 上，您仍然会遇到问题。

我怀疑您遇到的限制是由于 MAX_PATH，这是对 Windows 上许多 API 将接受的路径长度的预定义限制。

您可以尝试使用[Robocopy](http://en.wikipedia.org/wiki/Robocopy "机械复制")进行备份，因为它能够创建比 MAX_PATH 限制更长的路径。但是，大多数应用程序将无法访问这些文件。

去皮或压缩文件可能是一个不错的计划，但您似乎不太可能将它们解压缩或解压缩到 Windows 机器上。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-24T07:15:03.963

什么操作系统，什么协议？

我只能看到：CoreFSIF 限制为 256 个字符。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-24T06:25:42.253

也许升级到在过去十年左右更新的操作系统？不过，说真的 - 您使用的是什么操作系统和文件系统？甚至 FAT32 也支持长路径和文件名，尽管路径的任何单个组件都限制为 255 个字符。

如果您的目录名称中包含超过 255 个字符，那么这是有问题的（而且有点奇怪）。要解决该问题，您可以考虑使用在服务器上运行的存档实用程序（tar 或 zip），然后将存档发送到您的桌面计算机。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-24T10:54:44.457

您看到的是 Win32 的 MAX_PATH 限制（MAX_PATH 为 260）。

API 上有“转义”，以便能够使用 NT 的 32767 个字符的更大限制（在路径前添加 \\?\），但仅适用于某些 API。以这种方式创建的文件往往会混淆其他程序，这些程序期望所有路径都适合 MAX_PATH 大小的缓冲区。

解决这个问题（用于备份/恢复）的方法是找到一个可以备份（和恢复！）具有更长路径的文件的程序（通过始终使用 API“转义”或底层 NT API）。另一种选择是使用不同的操作系统进行备份/恢复。

# java - User Login in Java - JAAS/JNDI/GSSAPI

> ID：232584
> 
> 赞同：3
> 
> 时间：2008-10-24T05:48:21.253
> 
> 标签：java, security

What is the best way to design a user login mechanism using Java? What are the best practices to be followed to architect a secure and robust login mechanism?

What is the difference between JAAS, JNDI and GSSAPI? How do you decide which one to choose?

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-24T06:36:31.187

单点登录 (SSO) 是最佳实践之一。为一组应用程序使用一组凭据进行身份验证（不一定是授权）。Sun 的基于 java 的开源 -- OpenSSO 解决方案可在[https://opensso.dev.java.net/](https://opensso.dev.java.net/)获得。这包括 OpenDS，一个开源 LDAP 服务器。

您需要考虑的几件事是
1) 是否可以让用户从多台计算机同时登录
2) 如何在同一 LDAP 服务器中混合身份验证和授权信息

这方面的一些模式可以从书中获得：http: [//www.coresecuritypatterns.com/patterns.htm](http://www.coresecuritypatterns.com/patterns.htm)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-24T13:18:28.367

我真的很喜欢[Spring Security](http://en.wikipedia.org/wiki/Spring_Security)。当然，如果您有一个 Spring 项目，那么设置起来非常容易，但我已经看到它的一部分集成到其他实现中。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-24T06:19:32.470

这取决于您的用户参考。

您需要能够将您的登录 java 模块与该基础连接。它是 LDAP，您可以考虑[OpenLDAP](http://www.openldap.org/jldap/)之类的框架。

另外，您必须考虑“登录”边界中包含的内容：这是一个“适应”登录过程，您需要的不仅仅是用户名，还需要其他参数来帮助您的 java 模块授予他访问权限（它组，可能在 LDAP 中，但也是他想要执行的操作，以检查他是否具有所需的认证级别）

# jira - JIRA - Revision Fix, Work Start and Resolve Issue

> ID：232585
> 
> 赞同：1
> 
> 时间：2008-10-24T05:48:51.517
> 
> 标签：jira

Do you all add revision fixed to your custom fields?

And what is the point of have `Work Start`? I thought `resolve issue` is good enough?

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-13T23:36:17.127

We add the revision planned to fix and the revision fixed. Using the estimated times allows us to plan a certain chunk of work for the next release.

Indicating Work Started shows what each person in the team is working on currently. We're not as rigorous with the time tracking but this gives an indication of progress through each task for long tasks and lets you estimate the remaining time.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-24T05:52:25.410

We use revision fixed. Makes producing change logs etc much easier.

Never used the work tracking at all. Always just seems like too much hassle, and the teams we've been on we haven't needed to track it that closely. It's different than resolving an issue - that just marks that something is complete. Work start tracks how much time was spent, and if someone is still looking at it.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-24T08:05:59.463

当您想要跟踪即将发布的版本的进度并查看以前版本中已修复的问题时，修订版非常有用。路线图视图显示所有版本及其相关问题。

# certificate - Where does makecert store the private key if -sv is not specified?

> ID：232596
> 
> 赞同：11
> 
> 时间：2008-10-24T05:54:27.793
> 
> 标签：certificate

Let say I run this command:

```
makecert testcert.cer 
```

Is a private key created? If so, where is it automatically stored in the system even though I did not tell makecert to install this certificate in any certificate store?

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-07-21T10:38:44.733

您运行命令的方式不会创建任何私钥。要使用私钥生成证书，您必须使用选项 -pe。但这还不够。仅当您的证书目的地是商店时才会创建私钥。所以你必须使用这样的命令：

makecert -pe -ss 我的 testcert.cer

“我的”对应于“个人”商店。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-04T17:11:41.997

看起来私钥存储在文件本身中。从[http://msdn.microsoft.com/en-us/library/bfsktky3(VS.80).aspx](http://msdn.microsoft.com/en-us/library/bfsktky3(VS.80).aspx)的文档中它指出......

注意
您应该使用证书存储来安全地存储您的证书。此工具使用的 .snk 文件以不受保护的方式存储私钥。当您创建或导入 .snk 文件时，您应该在使用过程中小心保护它，并在完成后将其移除。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-31T23:45:59.173

未创建私钥，因为当我在 .NET 中加载证书时，我将 X509Certificate2 的 HasPrivateKey 设置为 false。

# php - What is acceptable memory usage for a PHP page?

> ID：232611
> 
> 赞同：15
> 
> 时间：2008-10-24T06:00:10.730
> 
> 标签：php

I'm building a webpage that queries a MySQL database and (currently) produces a text-only list of the findings. The queries to complete a single record are similar to:

*   movie (title, description, etc)
    *   actors in the movie (name, gender)
    *   related movies

Out of curiosity I've used `memory_get_peak_usage()` and `memory_get_usage()`:

```
start   110,440 bytes
peak    656,056 bytes
end 637,976 bytes
time    0.008 seconds

```

The above is with no records found!

With 40 records I'm reaching approximately 2MB, though the time remains the same.

I know that premature optimization is evil and all, but I have to ask:

Do I need to do some reworking? Is this memory usage normal? What is considered excessive?

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-10-24T06:29:46.363

当然，最终最好在方便的时候进行优化，但是 2MB 的内存使用听起来不错。PHP4 的默认配置为 8mb，PHP5 为 16mb。当然，许多预打包的 PHP 版本会有不同的配置，但一般来说，如果您可以将应用程序保持在 8mb 以下，那么您可以确定它在这方面具有高度可移植性。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-10-24T08:09:20.267

显然，这一切都取决于您正在构建的应用程序的复杂性。平均而言，我们应用程序的页面最多占用 20 MB（分钟）的内存。那是因为会话中有很多对象，并且在脚本甚至可以说 hello world 之前发生了很多初始化过程（身份验证、权限管理、通知......）

内存空间中有很多东西，包括类定义、全局变量、函数定义等。减少加载类的数量（通过使用自动包含）是保持脚本只包含必要数量的好方法类定义。

我不知道加载扩展是否会改变内存使用 - 这应该是要测试的，因为默认情况下我们可能不需要所有默认加载的扩展？

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-11T14:34:28.923

我个人将限制设置为 8 MB。如果我超过了，我会尝试改进我的应用程序。原因是因为某些共享主机和 PHP 4 配置的默认限制为每个进程 8 MB。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-11T14:53:53.313

PHP 在脚本执行期间不会释放内存，因此您的内存限制需要与一个脚本将消耗的最大内存一样高。如果脚本消耗的最大容量是 2MB，则将其设置为 2MB，但如果您需要 780MB，则将其设置为该值。

我们有内存限制超过 2GB 的大型生产系统。但这显然对我们和我们的场景进行了高度调整，我绝不会提倡将它用于共享托管环境。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-24T08:25:02.340

只要你计划了一个好的缓存机制（操作码缓存、对象缓存等），内存使用就变得不那么重要了。您仍然低于常见的 php 框架内存使用量。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-02-22T20:32:40.997

根据您使用的版本，PHP 具有已知的资源限制。当前版本可以处理 128MB，PHP 5.2.0=16MB，所有以前的版本都可以处理 8MB。

# windows-vista - 乌龟 SVN 图标覆盖显示无处不在...为什么？

> ID：232622
> 
> 赞同：4
> 
> 时间：2008-10-24T06:13:47.550
> 
> 标签：windows-vista, tortoisesvn, mozy, file-icons

**更新：**所以，这与 Tortoise SVN 无关。我使用 Mozy.com 进行异地备份，他们的新版本包括这些图标覆盖。它们可以通过配置选项禁用...或查看这里[http://forum.pcmech.com/showthread.php?p=1385433](http://forum.pcmech.com/showthread.php?p=1385433)。感谢@OS 的回答。

在我的 Vista 盒子上使用 Tortoise SVN 有一段时间了。在过去几天（以及最近升级到 1.5.4 之后），图标覆盖显示在所有文件上。

我的排除路径是：

*

我的包含路径是：

C:\Users\jw\Documents\Visual Studio 2008\Projects\SVNProjects*

C:\Users\jw\Documents\VB Projects\SVNProjects*

我已经好几个月没有碰过这些设置了。有任何想法吗？帮助。谢谢。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-24T06:29:41.263

几天前我发生了类似的事情，结果发现它与 Tortoise 无关......我正在使用 Mozy 自动备份文件，他们的最新更新包含与 Tortoise 非常相似的图标来标记备份的文件。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-24T06:18:15.653

图标通常出现在具有隐藏*.svn*子文件夹的文件夹中的文件的文件夹中。听起来您的图标缓存已损坏。您可能还想检查“*设置”*对话框中的“*图标叠加*”部分。如果它使用默认图标缓存，请尝试终止 TSVNCache.exe 进程。如果它正在使用 chell 缓存，请杀死 explore.exe，在 cmd 窗口中转到，键入“ ”，然后“ ”并重新启动 explorer.exe。*`%USERPROFILE%\AppData\Local``attrib –h IconCache.db``del IconCache.db`*

 ** * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-04-26T16:45:40.590

图标可能会消失，因为 Windows 支持的叠加层数量有限。见[http://tortoisesvn.net/faq.html#ovlnotshowing](http://tortoisesvn.net/faq.html#ovlnotshowing)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-24T07:00:15.303

同意马西达，

你也可以尝试使用重建tortoisesvn图标缓存

> TortoiseProc.exe /command:rebuildiconcache

从命令行。

# c# - 从 C# 调用默认浏览器？

> ID：232625
> 
> 赞同：10
> 
> 时间：2008-10-24T06:16:19.840
> 
> 标签：c#, .net

如何使用 C# 中的 URL 调用默认浏览器？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-10-24T06:22:22.900

```
System.Diagnostics.Process.Start("http://www.google.com"); 
```

更多详细信息 - [http://msdn.microsoft.com/en-us/library/aa326951.aspx](http://msdn.microsoft.com/en-us/library/aa326951.aspx)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-24T06:21:49.330

```
System.Diagnostics.Process.Start("http://mysite.com"); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-25T05:03:18.523

I used System.Diagnostics.Process.Start in the past, but if Firefox or another browser is set as the default this method always throws a terrible exception to users. At last, I come across System.Windows.Forms.Help.ShowHelp

`Help.ShowHelp(null, "[http://www.google.com](http://www.google.com)");`

Please notice that Help is a class only available for WinForms, while Process can be used for other cases (WebForms, WPF and so on).

# c# - 增强配置文件提供程序

> ID：232635
> 
> 赞同：0
> 
> 时间：2008-10-24T06:22:47.953
> 
> 标签：c#, arrays, serialization, profile

我想为我正在编写的自定义向导序列化和数组对象，但我在执行此操作时遇到了困难。有人可以帮助这是我正在使用的错误和代码片段。

我认为错误与无法转换数组有关。

```
namespace Helios.Web.Framework
{
    /// <summary>
    /// Summary description for GlobalWizardMethods
    /// </summary>
    public class GlobalWizardsLibrary : Wizards
    {
        public GlobalWizardsLibrary() { }
        public WizardBase CreateWizardArray(Wizards wizards)
        {
            WizardBase[] b = new WizardBase[wizards.IListWizardBase.Count];
            for (int i = 0; i < b.Length; i++)
            {
                b[i] = (WizardBase)wizards.IListWizardBase[i];
            }
            return b;
        }
    }
} 
```

--

```
 wizards = new Wizards();
        wizards.IListWizardBase = new List<WizardBase>();

        //if (wizards.WizardBase[0] == null)
        //{
            clientTakeOnWizardInfo = new ClientTakeOnWizardInfo();

            //Create any preset data to identify the client and wizard.
            CreatePresetWizardInfo();

            //Instantiate a new instance of the clientTakeOnWizard.organisationDetails.
            clientTakeOnWizardInfo.organisationDetails = new OrganisationDetails();

            //We update the Organisation Details with the new values from the form.
            clientTakeOnWizardInfo.organisationDetails.Guid = Profile.Wizards.WizardId.ToString();
            clientTakeOnWizardInfo.organisationDetails.OrganisationName = this.OrganisationName.Text;
            clientTakeOnWizardInfo.organisationDetails.PayrollSystem = this.PayrollSystem.SelectedValue;
            clientTakeOnWizardInfo.organisationDetails.Region = this.Region.SelectedValue;
            clientTakeOnWizardInfo.organisationDetails.RegistrationNumber = this.RegistrationNumber.Text;

            //Profile.Wizards.WizardData = clientTakeOnWizardInfo;

            Profile.Wizards.WizardStep = wizardClientTakeOnWizard.ActiveStepIndex;

            wizards.IListWizardBase.Add(clientTakeOnWizardInfo);
            GlobalWizardsLibrary s = new GlobalWizardsLibrary();
            s.CreateWizardArray(wizards); 
```

* * *

```
Error 16 Cannot implicitly convert type 
    'Helios.Web.Framework.WizardBase[]' to 
    'Helios.Web.Framework.WizardBase'
    C:\...\GlobalWizardsLibrary.cs  34  20  
C:\...\HeliosWeb\ 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-24T07:31:01.403

功能：

```
public WizardBase CreateWizardArray(Wizards wizards) 
```

...正在返回局部变量 b，它被声明为`WizardBase[]`，而不是`WizardBase`。

据我所知，这里根本没有进行序列化。该功能应该是：

```
public WizardBase [] CreateWizardArray(Wizards wizards) 
```

我还要指出，该函数并没有真正做任何非常有用的事情，它只是将 List 的元素复制到 Array （通过引用）......

# c# - Visual Studio 2005 中的 Crystal Reports（C# .NET Windows 应用程序）

> ID：232639
> 
> 赞同：2
> 
> 时间：2008-10-24T06:25:13.877
> 
> 标签：c#, crystal-reports

我需要在 C# .NET Windows 应用程序中创建报告。我有一个 SQL Server 2005。我想再显示两个要报告的字段（在数据库表中不可用。我想通过从数据库表的现有字段中添加一些数据来创建这些字段）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-24T06:29:22.857

如果您查看 Crystal Reports 公开的 .NET API，您会发现您可以将 DataSet 注入到报表中 - 这使您的应用程序可以完全控制报表使用的数据，将 Crystal Reports 用作演示引擎。

我已经使用这种技术来针对 Crystal Reports 本身不支持的数据源生成报告 - 它还有助于确保所有数据都来自相同的源（因为用于更改普通 Crystal 报告中使用的连接的 API 有点不稳定）。

因此，在您的情况下，我要做的是将所有必需的数据加载到数据集中，添加额外的列，然后将数据集传递到报表中。唯一复杂的一点是您需要保存数据集的 XML 模式并将其导入 Crystal Reports，以便它了解数据的形状。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-25T00:18:10.830

使用 CR 公式字段。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-24T09:43:21.857

您也可以为此使用水晶功能。取决于从 A 列到 B 列的计算有多复杂。越复杂，就越容易按照 Bevan 所说的去做并更改数据集。

如果您更具体，我可能会给您一些示例代码。

# windows - 为什么即使标签存在也会抛出“系统找不到指定的批次标签”？

> ID：232651
> 
> 赞同：77
> 
> 时间：2008-10-24T06:34:01.490
> 
> 标签：windows, batch-file, label

在 Windows XP 中运行批处理文件时，我发现随机出现的错误消息：

> 系统找不到指定name_of_label的批次标签

当然标签是存在的。是什么导致了这个错误？

* * *

## 回答 #1

> 赞同：89
> 
> 时间：2008-10-24T06:49:52.940

实际上，您需要两个条件才能发生这种情况：

*   批处理文件不得使用 CRLF 行结尾
*   您跳转到的标签必须跨越块边界（与 :end 标签相反，它只是脚本结尾的快捷方式）

看。[系统找不到指定的批次标签](https://web.archive.org/web/20160305063042/help.wugnet.com/windows/system-find-batch-label-ftopict615555.html)（by and [Batch-as-batch-can!](http://www.clausbrod.de/cgi-bin/view.pl/Blog/BlogOnSoftware20060127)

[David A. Gray](https://stackoverflow.com/users/3079037/david-a-gray)[在评论](https://stackoverflow.com/questions/232651/why-the-system-cannot-find-the-batch-label-specified-is-thrown-even-if-label-e/232674?noredirect=1#comment101293044_232674)中提到（在 Windows 10 上）[Marshal](https://stackoverflow.com/users/548098/marshal)的[回答](https://stackoverflow.com/a/6419068/6309)在 2014 年（大概在 Windows 7 或 8 上）显示的内容：脚本/批处理程序（`.bat`或`.cmd`）在没有执行的情况下[`CALL`](https://ss64.com/nt/call.html)会触发 eol 转换。

> 在过去的 35 年中，我编写了数百个批处理脚本，而我唯一一次遇到找不到标签的问题是文件的换行符从有效的 Windows (CR/LF) 转换为Unix（LF），它没有。

* * *

2020 年 2 月，[kinar](https://stackoverflow.com/users/1207818/kinar)[在评论中](https://stackoverflow.com/questions/232651/why-the-system-cannot-find-the-batch-label-specified-is-thrown-even-if-label-e/232674?noredirect=1#comment106597844_232674)补充道：

> 刚在win7机器上遇到这个问题。事实证明，如果系统上不存在该文件，则
> 在尝试调用另一个文件时也会产生此错误。 就我而言，我试图在未安装 VS 的系统上调用 Visual Studio 文件。`.bat`
> `vcvarsall.bat`

有关更多信息，请参见[jeb](https://stackoverflow.com/users/463115/jeb)的[答案](https://stackoverflow.com/a/60265222/6309)：这是未定义标签的情况。

* * *

注意：在 Git 存储库中，我会推荐一个`.gitattributes`带有指令的文件：

```
*.bat   text eol=crlf 
```

* * *

## 回答 #2

> 赞同：49
> 
> 时间：2011-06-21T00:26:10.703

我以前也遇到过同样的问题。然而，根本原因根本不是 CRLF。这是因为在脚本中我执行了一个外部程序，比如Ant，但是没有`CALL`在Ant前面放一个。因此，请确保您`CALL`在批处理脚本中使用了每个外部程序。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-10-24T06:37:22.497

如果批处理文件具有 unix 行结尾（行分隔符），则有时会发生这种情况。

只需[unix2dos 即可](http://dos2unix.sourceforge.net/)解决问题。

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2010-08-19T19:53:47.260

这是问题以及如何解决它。问题是 DOS 批处理 cmd 程序中的错误或功能。首先是明确的问题陈述。如果您有一个带有目标标签的 DOS 批处理文件，例如“:dothis”，并且在标签的末尾没有空间，那么如果行结尾是 UNIX 行结尾，则批处理文件将无法工作。这意味着您必须在文件上运行 unix2dos 才能使用它。

根本原因是 DOS 命令行处理器（shell 程序）将 UNIX 行尾字符作为标签的一部分。由于 go to 部分从不使用 this 作为标签，因此永远找不到它，因为这样的标签确实不存在。解决方案是在每个目标标签的末尾放置一个额外的空格，或者更好的是每一行。现在 UNIX 行尾不再起作用，因为空格充当分隔符并且一切正常。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-12-05T21:30:04.783

您还应该确保在调用其他脚本时使用 CALL，而不是在调用者的环境中调用它们。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2013-12-13T02:32:53.880

我刚才在 .cmd 文件和 Windows 8 中遇到了类似的问题。解决方案是将所有行尾更改为 CR+LF DOS 样式。这个问题令人困惑，因为批处理文件主要工作并且重新排列行改变了效果。

.cmd 文件如下所示：

```
call:function_A "..\..\folderA\"
call:function_B "..\..\folderB\"
call:function_C "..\..\folderC\"
call:function_D "..\..\folderD\"
goto:eof

:function_A
rem do stuff
goto:eof

...etc... 
```

函数 C 会导致错误“系统找不到指定的批次标签”。奇怪的是，它可以通过重新安排呼叫而消失。将行尾从 0x0A 更改为 0x0D0A 似乎已经修复了它。

也许 VonC 的意思是“批处理文件必须使用 CRLF 行结尾”。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2020-02-17T15:03:42.610

有多种可能的方法来获取错误。

1.  [由 VonC 描述](https://stackoverflow.com/a/232674/463115)- 错误的行尾，LF 而不是 CR/LF

2.  [晦涩的长行](https://www.dostips.com/forum/viewtopic.php?f=3&t=8988#p58890)（如果这是偶然发生的，你的代码会更糟）

3.  调用函数后直接启动另一个批处理。
    样本：

    ```
    @echo off
    call :func
    echo back from second
    exit /b

    :func
    second.bat
    echo NEVER COME BACK HERE
    ```

    这出乎意料地尝试到second.bat`goto`中的标签`:func`。
    但这可以*（错误）*用于直接调用另一个批处理文件中的标签

[这是元帅回答](https://stackoverflow.com/a/6419068/463115) 的描述行为

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2013-01-14T10:36:01.480

从word复制启动命令并将其粘贴到命令窗口后，我遇到了这个问题。前面有一个带有“-”的选项，并认为看起来与DOS“-”相同：）我自己输入“-”后，问题得到解决，批处理工作......很难发现问题....

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2019-08-16T15:16:07.737

小不同的用例...

**在 Windows Server 2012 Server 的打包**程序构建期间，我使用*shell*配置程序 (OpenSSH)调用了一个 bat 脚本。现在，脚本在配置的虚拟机中通过 cmd 运行良好（在打包程序构建中放置断点以停止并确认这一点）......但是，由于这些调用标签未找到问题，它失败了。

行尾很好，CRLF（在 Notepadd++ 中确认）。该脚本也可以通过命令行正常工作。更重要的是，有时它只是用来运行良好，有时会失败，但是一旦某个标签失败，失败是一致的。

最初，我只是开始通过扩展调用本身并将子例程代码内联来完全删除子例程。我对所有只有一个调用（没有代码重复）的实例都这样做了。

但是，是的，我确实偶然发现了一个从 3,4 个地方调用的子。在尝试了一切之后，这对我有用

> 在子例程上方添加 8-10 条 REM 语句。是的，我不是在开玩笑！

PS：脚本非常古老，但管理层需要我通过打包程序完成这项工作（我们有一个第二天的计划，用 Ansible/Chef 替换它）。

# javascript - 如何从使用 window.open(...) 重构为不显眼的模态 dhtml 窗口？

> ID：232662
> 
> 赞同：2
> 
> 时间：2008-10-24T06:40:25.220
> 
> 标签：javascript, modal-dialog

我有一个启动 javascript 窗口的函数，像这样

```
 function genericPop(strLink, strName, iWidth, iHeight) {
            var parameterList = "location=0,directories=0,status=0,menubar=0,resizable=no, scrollbars=no,toolbar=0,maximize=0,width=" + iWidth + ", height=" + iHeight;
            var new_window="";

            new_window = open(strLink, strName, parameterList);
            window.self.name = "main";
            new_window.moveTo(((screen.availWidth/2)-(iWidth/2)),((screen.availHeight/2)-(iHeight/2)));
            new_window.focus();
} 
```

在我的 Web 应用程序的不同位置，这个函数被调用了大约 52 次。

我想重构此代码以使用 DHTML 模式弹出窗口。更改应尽可能不显眼。

为了使该解决方案与旧解决方案保持一致，我认为还需要执行以下操作

1.  提供一个句柄来“关闭”窗口。
2.  确保窗口不能移动，并且位于屏幕的中心。
3.  模糊背景作为一个选项。

我认为[这个解决方案](http://particletree.com/features/lightbox-gone-wild/)最接近我想要的，但我不明白如何合并它。

编辑：你们中的几个人给了我一个很好的领导。谢谢你。但是让我在这里重新陈述我的问题。我正在重构现有代码。我应该避免对当前的 HTML 或 CSS 进行任何更改。理想情况下，我想通过保持 genericPop(...) 的函数签名相同来实现这种效果。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-24T12:49:02.467

这是我使用 jQuery 和 jQuery UI 库的解决方案。您的 API 未更改~~, 但参数 'name' 被忽略~~. 我使用`iframe`从给定加载内容`strLink`，然后将其显示`iframe`为生成的子`div`项，然后使用 jQuery 将其转换为模态弹出窗口：

```
function genericPop(strLink, strName, iWidth, iHeight) {
  var dialog = $('#dialog');
  if (dialog.length > 0) {
    dialog.parents('div.ui-dialog').eq(0).remove();
  }

  dialog = $(document.createElement('div'))
    .attr('id', 'dialog')
    .css('display', 'none')
    .appendTo('body');

  $(document.createElement('iframe'))
    .attr('src', strLink)
    .css('width', '100%')
    .css('height', '100%')
    .appendTo(dialog);

  dialog.dialog({ 
      draggable: false,
      modal: true, 
      width: iWidth,
      height: iHeight,
      title: strName,
      overlay: { 
          opacity: 0.5, 
          background: "black" 
      } 
  });
  dialog.css('display', 'block');
}

// example of use
$(document).ready(function() {
  $('#google').click(function() {
    genericPop('http://www.google.com/', 'Google', 640, 480);
    return false;
  });
  $('#yahoo').click(function() {
    genericPop('http://www.yahoo.com/', 'Yahoo', 640, 480);
    return false;
  });
}); 
```

[jQuery UI/Dialog 的文档](http://docs.jquery.com/UI/Dialog)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-24T06:59:37.037

我使用这个[对话框代码](http://www.leigeber.com/2008/04/custom-javascript-dialog-boxes/)来做几乎相同的事情。

如果我没记错的话，默认实现不支持调整对话框大小。如果您不能只使用一种尺寸，您可以修改代码或 css 以显示多个宽度。

使用很简单：

```
showDialog('title','content (can be html if encoded)','dialog_style/*4 predefined styles to choose from*/'); 
```

修改js支持多种宽度：

添加宽度和高度作为属性以显示对话框功能，并将它们设置为第 68 行的对话框和对话框内容元素

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-24T07:20:15.840

试试[Control.Window](http://livepipe.net/control/window)，它需要 Prototype

这是我如何使用它：

```
<a href="/messages/new" class="popup_window">New Message</a> 
```

在我的 Javascript 文件中：

```
$(document).observe("dom:loaded", function() {
  $$("a.popup_window").each(function(element) {
    new Control.Modal(element, { overlayOpacity: 0.75, 
                                 className: 'modal',
                                 method: 'get',
                                 position: 'center' });
  });
}); 
```

现在，如果您想关闭当前打开的弹出窗口，请执行以下操作：

```
Control.Modal.current.close() 
```

# directx - 我可以在没有整个 DirectX SDK 的情况下获得 DirectInput / XInput 吗？

> ID：232669
> 
> 赞同：2
> 
> 时间：2008-10-24T06:46:12.570
> 
> 标签：directx, directinput

我正在开发一个内部应用程序，它将使用 XInput 或 DirectInput 从 Xbox 360 控制器中读取。（我认为这将是让操作员掌握多个控件的最便宜/最简单的方法。）

我需要对所有源代码和工具进行源代码控制，这也意味着 SDK 的。我宁愿不使用所有 DirectX —— DirectInput 和 XInput 是否可以与整个 DirectX SDK 分离？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-24T09:05:35.893

最简洁的答案是不。从技术上讲，可以提取运行时所需的部分，但如果您查看 SDK EULA 和再分发协议，您会发现您只被允许安装完整的 DirectX 运行时。

# sql-server - 预览（回顾）SQL Server Management Studio Express 的 SQL 查询的方法

> ID：232677
> 
> 赞同：0
> 
> 时间：2008-10-24T06:52:34.273
> 
> 标签：sql-server, logging, ssms

请告诉我，是否可以预览（或至少回顾，例如，在一种日志文件中）SQL Server Management Studio Express 即将执行（或刚刚执行）的 SQL 命令？

过去我使用 Embarcadero DBArtisan，它显示了在服务器上实际运行 SQL 查询之前要执行的查询，所以我渴望在 Management Studio 中使用这个功能。

我找到了一个选项“自动生成更改脚本”，但它只显示 DDL SQL 查询（结构更改），而不是数据更改。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-28T23:44:13.960

要回答查看使用 Management Studio 时执行的基础查询的问题，有两种方法可以做到这一点。

Management Studio 中的大多数对话框允许您生成文件或剪贴板的更改脚本，这对于在后台达到峰值以及在开发、登台和生产服务器之间应用更改非常有用。

另一种解决方案是运行 SQL Server Profiler，并按

*   Management Studio 的应用程序名称
*   您帐户的登录名

一些标准的 T-SQL 跟踪模板是可以的，或者如果您制作自定义跟踪模板，包括 T-SQL SQL:BatchCompleted 和 SQL:BatchStarting Events 的 TextData 字段

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-24T07:06:56.320

您可以使用查询探查器（来自 SQL）来查看查询，并在您的 SQL 查询中嵌入事务并在最后执行回滚。

```
BEGIN TRAN

 INSERT INTO Clients 
 SELECT 'Bruno', 'Alexandre';

END

ROLLBACK TRAN 
```

当您回滚事务时，该过程将返回到 BEGIN TRAN 的开头，并且您可以确定没有进行任何操作，这是提交查询并在 SQL 遇到错误时安全回滚的方法......

像：

```
IF @@ERROR > 0 GOTO Error

:Error
ROLLBACK TRANSACTION 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-27T23:41:38.207

您可以使用

```
SET SHOWPLAN_TEXT ON 
```

在批处理开始时，将查询的计划和文本回显给您。开启时查询不会影响任何行`SHOWPLAN_TEXT`。

然后，您可以设置`SHOWPLAN_TEXT`为`OFF`运行您的查询。

# c - Malloc 错误：释放对象的校验和不正确

> ID：232678
> 
> 赞同：9
> 
> 时间：2008-10-24T06:53:08.220
> 
> 标签：c, debugging, pointers, malloc

我正在为一项任务实施tail。我让它正常工作，但我似乎在随机时间免费收到错误。

我看不到，要追踪到一种模式或除此之外的任何东西是一致的。

例如，如果我将我的程序称为“tail -24 test.in”，我会在多次运行的同一行中得到不正确的校验和错误。但是，使用不同的文件，甚至不同的行数要打印回来，我会毫无错误地回来。

关于如何追踪问题的任何想法，我一直在尝试调试它几个小时，但无济于事。

这是有问题的代码：

lines 定义为 char** 并且 malloc 为：

```
lines = (char**) malloc(nlines * sizeof(char *));

void insert_line(char *s, int len){

  printf("\t\tLine Number: %d Putting a %d line into slot: %d\n",processed,len,slot);
  if(processed > numlines -1){//clean up
    free(*(lines+slot));
    *(lines + slot) = NULL;
  }
  *(lines + slot) = (char *) malloc(len * sizeof(char));
  if(*(lines + slot) == NULL) exit(EXIT_FAILURE);
  strcpy(*(lines+slot),s);
  slot = ++processed % numlines;
} 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-24T13:30:43.460

您的例程正在写入超出分配的行缓冲区。

作为参数传递的行的大小（即“len”）可能不包括 NUL 终止符。当您调用 malloc 复制行（即“s”）时，您需要为字符串终止符分配一个额外的字节：

```
 *(lines + slot) = (char *) malloc((len + 1) * sizeof(char)); 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-24T07:32:39.793

如果您可以使用特定的输入参数始终如一地重现问题，您应该像这样调试：

*   首先调试到导致问题的精确释放。
*   然后找出即将被释放的内存何时被malloc'ed。
*   接下来，调试到内存被malloc'ed的地方。
*   在内存查看器中找到分配的内存块。注意块的开始和结束。在块之前和之后可能有一个称为*保护块的特殊值。*
*   现在单步执行代码，直到内存被释放。在某些时候，您的代码应该错误地覆盖保护块。*那是冒犯性的陈述。*

请注意，问题很可能出在程序的完全不同的部分。即使报告错误的是这个免费的，覆盖保护块的代码也可以在任何地方。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-24T12:58:45.007

我的第一个问题是你如何计算 len？它只是 strlen 还是包含 \0 终止符的空间？我认为您可能超出了您在 strcpy 中的分配。不良行为往往会发生在单词边界上并且显得随机。此外，请检查以确保您的源字符串以空值结尾。如果您在读取端犯了错误并且没有终止它们。那么 strcpy 可能会随机覆盖事物。

```
 *(lines + slot) = (char *) malloc(len * sizeof(char));
  if(*(lines + slot) == NULL) exit(EXIT_FAILURE);
  strcpy(*(lines+slot),s); 
```

也许尝试：

```
 lines[slot] = (char *) malloc((len + 1) * sizeof(char));
  if(lines[slot] == NULL) exit(EXIT_FAILURE);
  if(strlen(s) <= len){
    strcpy(lines[slot],s);
  }
  else{
    /* do something else... */
  } 
```

就一般形式而言，我还鼓励您进行一些风格上的更改，以使整个内容更具可读性、更易于理解和抗错。

指针算术是有效且有趣的，但我认为如果您使用如下数组形式，您的意图会更加清晰：

```
free(lines[slot]);
lines[slot] = NULL; 
```

代替

```
free(*(lines+slot));
*(lines + slot) = NULL; 
```

我还鼓励您使用更少的静力学。在数据结构中通过它们并将它们传递给您的访问器和修改器很容易。动作发生的位置会更清楚地阻止您执行以下操作：

```
static int numlines = 0;
void insert_line(char *s, int len){
    int numlines = 5; 
```

您可以在其中引入难以调试的范围界定问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-24T07:11:10.417

nlines 和 numlines 是否具有相同的值？

在第二个参数中传递长度时，insert_line 的调用者是否为尾随的 NUL 留出了空间？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-24T07:18:08.980

我不确定它是否相关，但这两行对我来说似乎很可疑：

```
 *(lines + slot) = (char *) malloc(len * sizeof(char));
  if((lines + slot) == NULL) exit(EXIT_FAILURE); 
```

您首先将 malloc 的返回分配给`lines[slot]`然后检查`(lines+slot)`，如果后者为 NULL，则您已取消引用 NULL 指针！

此外，如果 lines[slot] (你的 *(lines+slot)) 不为空，当你将 malloc() 的结果分配给它时，你会泄漏内存。

我假设`lines`是`char`*lines[]` 并且插槽在允许的边界内！

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-24T07:23:48.627

我同意 remo 对这两行的怀疑，但不同意 remo 的切线。我们应该分享发现这个错误的功劳。

```
*(lines + slot) = some value
if((lines + slot) == NULL) then die
should be
if(*(lines + slot) == NULL) then die 
```

# .net - 成为一个更好的 OO 程序员需要什么？

> ID：232681
> 
> 赞同：11
> 
> 时间：2008-10-24T06:57:53.763
> 
> 标签：.net, oop

我在使用 .net 技术的应用程序开发方面拥有近 6 年的经验。多年来，我作为一个更好的 OO 程序员已经有所进步，但是当我看到其他人（尤其是 Jeffrey Richter、Peter Golde、Ayende Rahien、Jeremy Miller 等人）编写的代码时，我觉得我和他们之间存在代沟设计。我通常在 ReSharper 等用于重构和代码组织的工具的帮助下动态设计我的类。

所以，我的问题是“怎样才能成为一个更好的 OO 程序员”。是吗

a) 经验

b) 书籍（请参考）

c) 进程（tdd 或 uml）

d) 模式

e) 还有什么？

以及如何验证设计是否良好、易于理解和可维护。由于行业中有如此多的流行语，如依赖注入、IoC、MVC、MVP 等，我们应该更多地关注设计。我觉得抽象是关键。还有什么？

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2008-10-24T07:00:06.180

您可能会发现，您所欣赏的优雅 OO 设计*并不是第一次迭代*，而是经过多次调整、重构和微调的结果

尝试确定您认为他们的设计比您的设计“更好”的原因，并相应地进行调整

业余作家和专业作家的区别在于专业的*重写*；编程也是如此

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-10-24T07:29:45.917

[幽默]

面向对象的技能可以从书籍和其他资源中学习。但如果你幸运的话，你会继承父母的技能。大多数时候，提供和使用正确的方法很重要。注意参数的数量。越少越好。

为任何事情使用正确的名称。使用动词作为活动的方法。用名词表示任何需要记住的东西。不要太有创意，让你的解决方案尽可能简单，否则你的用户会很困惑。

封装令人讨厌的细节也很重要。并确保为公众隐藏您的私人成员，否则会发生意外行为。还要注意在正确的水平上捕捉您的特殊情况。

让我敦促您始终测试您的单元并使用正确的界面为快乐的用户提供足够的句柄。

[/幽默]

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-10-24T07:45:31.860

每样东西都来一点。至于任何语言（语言编程），你接触它的次数越多，你学到的就越多。

所以阅读书籍，阅读你的同事代码。至少同样重要的是，学习新的编程语言：它们会拓宽你的视野，让你对自己的代码更加挑剔，并让你重新思考自己的编程习惯。

关于设计模式，它们是解决通用语言中常见问题的事实上的标准方法。您必须了解他们以避免重新发明轮子并更好地与您的同事沟通，但您也应该将他们视为解决您正在使用的语言中缺少的功能。状态机模式仅存在于不提供它们作为内置的语言中（不是我知道提供它们的语言，但你明白了）。

我还要补充：

*   如果需要并且时间允许，总是重构（当然，因为您有单元测试以避免回归，所以无害）。
*   了解何时避免继承（这比您想象的更常见）。
*   了解何时避免 OO（当它没有增加任何价值时）。
*   不要将 OO 与封装混淆（这是 OO 的主要优点，但其他范例也提供）。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-10-24T09:02:55.323

好的OO设计：

*   读起来像诗
*   不需要任何评论
*   相信你的对象（放开控制权）
*   偏好组合胜于继承

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-10-24T07:04:13.253

通过暂时忘记面向对象并在改进现有程序的同时编写更清洁、更好的程序，您将成为一个更好的面向对象程序员。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-10-24T07:09:58.920

第一本书，您需要了解一些 GoF 模式，但更重要的是您需要了解这些模式背后的原理。了解旧样式（使用继承进行代码重用）与新样式（更喜欢封装而不是继承）oo 设计之间的区别。两本值得阅读的好书是 Shalloway 和 Trott 的《设计模式解释》和 Bob Martin 的《敏捷软件开发、原则、模式和实践》。

那你需要经验。书中的理论很好，但你需要微调你对何时使用什么的感觉。如何使用过程来微调您的设计（Steven A. Lowe 已经命名了迭代）许多老式的 oo-guru 在相同的论文和书籍中描述了迭代编程和 oo 编程。

最后，但我认为最重要的是您需要反馈和沟通。最好与您所在组织之外的其他程序员交谈。尝试与尽可能多的人一起工作（OSS 很好）最终您会从人而不是书本中学习。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-10-24T07:30:45.133

使用专用的函数式编程语言和面向对象的语言练习函数式编程。这将增加您对可重用算法如何帮助鼓励定义良好的接口的理解，从而使程序元素更易于使用。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-10-24T09:37:26.953

除了从书籍和论文等学术资料中学习之外，我**强烈**建议：学习不止一种语言，特别是如果你来自 Java/C# 主流。学习 ruby​​，学习 groovy，学习 smalltalk，学习 lisp，学习理论和实践之间的差异。

一个学术但很好的例子是单调度与多调度：您可以查看[维基百科条目](http://en.wikipedia.org/wiki/Multiple_dispatch)并亲眼看看您将如何根据语言能力编写不同的代码。更根本的是，这可以帮助您了解如何在语言 X 中实现相同的效果，同时保持可靠的设计。

这里的关键是试验、理解和发展。您还可以从阅读或帮助一些开源项目中学到很多东西，它们通常具有良好的架构和实现（至少是大型项目）。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-10-24T08:50:31.290

大家好，祝大家有美好的一天

就像 Cheery 所说：“暂时忘记面向对象，在改进现有程序的同时编写更干净、更好的程序，您将成为一个更好的面向对象程序员”。

这就是关键：思考并获得尽可能简单的解决方案并编写类似的代码

仅此而已 没有了.... 再见

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-10-24T09:38:19.090

对我有用的是**Reading**。我刚刚对这本书有一个灯泡时刻......大卫韦斯特的对象思考详细阐述了[艾伦凯](https://rads.stackoverflow.com/amzn/click/com/0735619654)[关于“对象革命尚未发生”的评论](http://video.google.com/videoplay?docid=-2950949730059754521)。OO 对不同的人来说是不同的东西。再加上您的工具会影响您解决问题的方式这一事实。所以学习多种语言。

[对象思维 David West http://ecx.images-amazon.com/images/I/51hnvVxjQtL._SL500_BO2,204,203,200_AA219_PIsitb-sticker-dp-arrow,TopRight,-24,-23_SH20_OU01_.jpg](http://ecx.images-amazon.com/images/I/51hnvVxjQtL._SL500_BO2,204,203,200_AA219_PIsitb-sticker-dp-arrow,TopRight,-24,-23_SH20_OU01_.jpg)

就我个人而言，我认为理解实践背后的哲学、原则和价值观比模仿实践有很大帮助。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-10-24T09:56:46.913

什么对我有用：

*   了解您的应用程序的域，并尽可能长时间地靠近该域，同时仍然避免代码重复。

*   不要拘泥于一种语言，学习几种OO语言。Smalltalk、Comon Lisp、Python、Javascript 都有非常有趣的 OOP 实现方式。浏览它们的源代码（Smalltalk 对象浏览器是一个很好的工具）。

*   用一种没有 OOP 标准的语言（如 Lua）实现一个 OOP 库：这将向您展示这`self/this`只不过是一个指向状态的隐式第一个参数，并将其行为委托给它`class/vtable/metatable`（这反过来又可以将调用委托给它的父母`class`）。

干杯!

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-05-17T07:35:26.927

让某人审查您的设计非常重要。审查和维护遗留代码可以帮助您了解是什么导致了软件腐烂。思维也很重要；一方面不要急于实施第一个想法。另一方面，不要一下子考虑所有事情。反复进行。

定期阅读书籍/文章，例如 Eric Evan 的[模型驱动设计](https://rads.stackoverflow.com/amzn/click/com/0321125215)，或者学习采用不同方法实现 OO 的新语言（Smalltalk、Self、Scala），可以帮助您真正理解。

软件和 OO 都是关于抽象、责任、依赖和重复（或缺乏）。在您的旅程中牢记它们，您的学习将是稳定的。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2010-09-01T15:11:14.193

我认为，对于一个好的 OO 设计，需要获得正确的心态。

我不确定这个人降级提到 Smalltalk 的答案的原因是什么，但 Smalltalk 肯定与此有关。关键词是隐喻。对于大多数程序员来说，这实际上是在大多数计算机科学教育中强制执行的，中心隐喻是机械的：发条或蒸汽机。

最难的是你需要用另一个来代替这个比喻。不是机械的隐喻，而是生命系统、生态学的隐喻。如果你在第一个比喻中努力获得某种卓越，这可能真的很困难，甚至很痛苦。

Smalltalk 中所有这些对象协同工作的方式与该隐喻密切相关。我还发现凯文凯利的书：失控在这种情况下很有趣，因为这本书包含许多基于这个隐喻的实际解决方案的例子。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-10-24T13:42:23.360

TDD 为我工作。在没有好的 oo 的情况下先编写测试是一个真正的 PIA，所以我必须变得更好。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-10-24T07:01:43.897

了解和理解 GoF（Gamma 等人）设计模式永远不会错。它们可以应用于很多情况。我想它们是每个开发人员必不可少的东西！

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-11-05T12:31:38.567

得到很好的指导，当你遇到问题时让这些人坐下来和你一起解决问题。您可以深入了解他们如何以 OO 方式思考事物。

定期的代码审查。认为我从通过 PowerPoint 进行的团队代码审查中学到的最多，其中一些对我的代码的蔑视。专心致志，果然如此。

当然，帮助我通过 Smalltalk 学习了 OO（恕我直言，每个人都应该**被迫**这样做）。语言总是鼓励“消息发送”的概念。也就是不要把这里的东西内联，写一个新方法调用（即发送消息并得到答案**）结果？简单、低耦合、高内聚。

** 当我为访问器方法编写 JavaDoc 时，我仍然会写“回答代表 [事物] 的 [blah]” 人们可能会认为我很奇怪，但到目前为止还没有人报警......

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2009-05-17T08:11:37.917

当我尝试减少类、（java）包和模块之间的依赖关系，指定清晰的模块边界并删除依赖关系中的循环时，它突然开始对我有意义。尤其是这个周期的删除给我带来了很多见解。您的类/包/模块依赖项理想情况下应该形成一棵树。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2009-05-17T08:33:34.307

成为更好的 OO 程序员需要成为更好的程序员。

OO 多年来一直在发展，它与不断变化的范式和技术（如 n 层架构、垃圾收集、Web 服务等）有很大关系。您已经看到了这些东西。有可维护性、可重用性、低耦合、KISS、DRY、阿姆达尔定律等基本原则，你必须自己学习、阅读、体验和应用。

OO 本身并不是目的，而是实现编程解决方案的一种手段。就像游戏、运动和艺术一样，没有原则就无法理解实践。没有实践就无法理解原则。

更具体地说，这里有一些技能可以使一个人成为更好的程序员。听取领域专家的意见。知道如何编写测试。知道如何设计一个 GUI 桌面软件。知道如何将数据持久化到数据库中。分离 UI 层和逻辑层。知道如何编写一个类似于内置类的类。知道如何编写像内置组件一样的图形组件。知道如何设计客户端/服务器软件。了解网络、安全性、并发性和可靠性。

[设计模式](https://rads.stackoverflow.com/amzn/click/com/0201633612)、MVC、[UML](https://rads.stackoverflow.com/amzn/click/com/0321193687)、[重构](https://rads.stackoverflow.com/amzn/click/com/0201485672)、[TDD](https://rads.stackoverflow.com/amzn/click/com/0321146530)等解决了许多问题，通常以创造性的方式扩展 OO。例如，为了将 UI 层依赖与逻辑层解耦，可以引入一个接口来包装 UI 类。从纯面向对象的角度来看，可能没有多大意义，但从 UI 层和逻辑层分离的角度来看，它是有意义的。

最后，认识到 OO 的局限性也很重要。在现代应用程序架构中，OO 的纯粹数据 + 逻辑视图并不总是很好地融合在一起。例如，数据传输对象（[Java](http://java.sun.com/blueprints/corej2eepatterns/Patterns/TransferObject.html)、[MS](http://msdn.microsoft.com/en-us/library/ms978717.aspx)、[Fowler](http://martinfowler.com/eaaCatalog/dataTransferObject.html)）有意剥离对象的逻辑部分，使其仅承载数据。通过这种方式，对象可以将自己变成二进制数据流或 XML/JSON。逻辑部分可以在客户端和服务器端以某种方式处理。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2012-05-17T14:06:33.063

3是幻数；不多不少，它无处不在。

通过最小化子类来减少继承的可能性。
通过拥有独立的对象，很可能是松散耦合。
坚持下去。

以样本解释。

**第一步接口是对系统的访问定义。**

`interface i { getObject($o); }`

*   就网页而言，这是唯一的 URL 或参数。
*   就 MVC 而言，这就是 Model。
*   就 Tree 而言，这是从父级到子级的连接（分支）。

**第二步抽象是对系统的控制。**

```
abstract class Controller { 
     function getObject(){} 
     function validateObject(){

// o must be a digit
// o must be between 0 and 120
// ... etc
}
} 
```

*   就网页而言，这是对用户登录、数据库连接等要求的验证。
*   就 MVC 而言，这就是 Controller。
*   就 Tree 而言，这是父级。

**第三步也是最后一步是应该编织和培养可用数据的真实对象。**

```
class View extends Controller (InputObject $in, OutputObject $out) {

} 
```

这个具体类中的可用数据也来自 3 个方向。

*   扩展控制器
*   输入对象 $in
*   输出对象 $out

该演示对象将是 - 就网页而言，结果的输出，即页面内容。- 在 MVC 方面的观点。- 就树叶而言。

我建议你多考虑一下这个三角形集。例如尝试

*   行星的设置及其在我们太阳系中的轨道行为。
*   汽车的结构及其行驶时的行为。
*   不同状态下的原因和结果。

# programming-languages - 您将如何实施越位规则？

> ID：232682
> 
> 赞同：11
> 
> 时间：2008-10-24T06:59:02.857
> 
> 标签：programming-languages, language-features, language-design, lexical-analysis

我已经编写了一个可以解决问题的生成器，但我想知道实现越位规则的最佳方法。

很快：[越位规则](http://en.wikipedia.org/wiki/Off-side_rule)在这种情况下意味着缩进被识别为句法元素。

这是伪代码中的越位规则，用于制作以可用形式捕获缩进的标记器，我不想通过语言限制答案：

```
token NEWLINE
    matches r"\n\ *"
    increase line count
    pick up and store the indentation level
    remember to also record the current level of parenthesis

procedure layout tokens
    level = stack of indentation levels
    push 0 to level
    last_newline = none
    per each token
        if it is NEWLINE put it to last_newline and get next token
        if last_newline contains something
            extract new_level and parenthesis_count from last_newline
            - if newline was inside parentheses, do nothing
            - if new_level > level.top
                push new_level to level
                emit last_newline as INDENT token and clear last_newline
            - if new_level == level.top
                emit last_newline and clear last_newline
            - otherwise
                while new_level < level.top
                    pop from level
                    if new_level > level.top
                        freak out, indentation is broken.
                    emit last_newline as DEDENT token
                clear last_newline
        emit token
    while level.top != 0
        emit token as DEDENT token
        pop from level

comments are ignored before they are getting into the layouter
layouter lies between a lexer and a parser 
```

此布局器一次不会生成多个 NEWLINE，并且在出现缩进时不会生成 NEWLINE。因此解析规则仍然非常简单。我认为这很好，但请告知是否有更好的方法来完成它。

虽然使用了一段时间，但我注意到在 DEDENT 之后发出换行符可能会很好，这样你可以用 NEWLINE 分隔表达式，同时保持 INDENT DEDENT 作为表达式的预告片。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-03T08:59:09.043

在过去的几年里，我为一些以缩进为中心的领域特定语言编写了分词器和解析器，不管它值多少钱，你所拥有的对我来说看起来都很合理。如果我没记错的话，您的方法与 Python 所做的非常相似，例如，它似乎应该有一定的分量。

在 NEWLINE NEWLINE INDENT 到达解析器之前将其转换为 INDENT 绝对看起来是正确的做事方式 - 总是在解析器中窥视它是一种痛苦（IME）！实际上，我已经将该步骤作为一个单独的层完成，最终形成了一个三步过程：第一个结合了您的词法分析器和布局器所做的减去所有 NEWLINE 前瞻的东西（这使得它非常简单），第二个（也非常简单) 层折叠连续的 NEWLINE 并将 NEWLINE INDENT 转换为仅 INDENT（或者，实际上，将 COLON NEWLINE INDENT 转换为 INDENT，因为在这种情况下，所有缩进的块总是以冒号开头），然后解析器是第三阶段。但是按照您描述的方式做事对我来说也很有意义，特别是如果您想将词法分析器与布局器分开，

我确实有一个应用程序需要对缩进规则更加灵活，本质上是让解析器在需要时强制执行它们——以下内容需要在某些上下文中有效，例如：

```
this line introduces an indented block of literal text:
    this line of the block is indented four spaces
  but this line is only indented two spaces 
```

这对于 INDENT/DEDENT 令牌效果不太好，因为您最终需要为每一列缩进生成一个 INDENT，并且在返回的路上生成相同数量的 DEDENT，除非您向前看以找出缩进级别的位置最终会成为，这看起来不像你想要一个标记器来做。在那种情况下，我尝试了一些不同的方法，最后只在每个 NEWLINE 标记中存储了一个计数器，该计数器为以下逻辑行提供了缩进（正或负）的变化。（每个标记还存储了所有尾随空格，以防需要保留；对于 NEWLINE，存储的空格包括 EOL 本身、任何插入的空白行以及以下逻辑行上的缩进。）根本没有单独的 INDENT 或 DEDENT 标记。让解析器处理这个问题比仅仅嵌套 INDENT 和 DEDENT 需要更多的工作，而且很可能会遇到需要花哨的解析器生成器的复杂语法，但它并没有我担心的那么糟糕，任何一个。同样，解析器不需要从 NEWLINE 向前看，看看这个方案中是否有一个 INDENT 出现。

尽管如此，我认为您会同意在标记器/布局器中允许和保留各种看起来很疯狂的空白，并让解析器决定什么是文字和什么是代码，这是一个不寻常的要求！例如，如果您只想能够解析 Python 代码，您当然不希望您的解析器背负缩进计数器。您做事的方式几乎肯定是您的应用程序和许多其他应用程序的正确方法。虽然如果其他人对如何最好地做这种事情有想法，我显然很想听听他们......

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-06-03T18:34:32.433

我最近一直在尝试这个，我得出的结论是，至少为了我的需要，我希望 NEWLINES 标记每个“语句”的结尾，无论它是否是缩进块中的最后一个语句，即我甚至在 DEDENT 之前也需要换行符。

我的解决方案是把它转过来，而不是 NEWLINES 标记行的结尾，我使用 LINE 标记来标记行的开头。

我有一个词法分析器，它可以折叠空行（包括仅注释行）并发出单个 LINE 标记，其中包含有关最后一行缩进的信息。然后我的预处理函数采用这个令牌流并在缩进发生变化的任何行之间添加 INDENT 或 DEDENT。所以

```
line1
    line2
    line3
line4 
```

会给令牌流

```
LINE "line1" INDENT LINE "line2" LINE "line3" DEDENT LINE "line4" EOF 
```

这使我可以为语句编写清晰的语法产生式，而不必担心检测语句的结尾，即使它们以嵌套、缩进、子块结尾，如果您匹配 NEWLINES（和 DEDENTS），这可能会很困难。

这是预处理器的核心，用 O'Caml 编写：

```
 match next_token () with
      LINE indentation ->
        if indentation > !current_indentation then
          (
            Stack.push !current_indentation indentation_stack;
            current_indentation := indentation;
            INDENT
          )
        else if indentation < !current_indentation then
          (
            let prev = Stack.pop indentation_stack in
              if indentation > prev then
                (
                  current_indentation := indentation;
                  BAD_DEDENT
                )
              else
                (
                  current_indentation := prev;
                  DEDENT
                )
          )
        else (* indentation = !current_indentation *)
          let  token = remove_next_token () in
            if next_token () = EOF then
              remove_next_token ()
            else
              token
    | _ ->
        remove_next_token () 
```

我还没有添加对括号的支持，但这应该是一个简单的扩展。但是，它确实避免在文件末尾发出杂散的 LINE。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-05-14T15:18:47.747

ruby 中的 Tokenizer 很有趣：

```
def tokenize(input)
  result, prev_indent, curr_indent, line = [""], 0, 0, ""
  line_started = false

  input.each_char do |char|

    case char
    when ' '
      if line_started
        # Content already started, add it.
        line << char
      else
        # No content yet, just count.
        curr_indent += 1
      end
    when "\n"
      result.last << line + "\n"
      curr_indent, line = 0, ""
      line_started = false
    else
      # Check if we are at the first non-space character.
      unless line_started
        # Insert indent and dedent tokens if indentation changed.
        if prev_indent > curr_indent
          # 2 spaces dedentation
          ((prev_indent - curr_indent) / 2).times do
            result << :DEDENT
          end
          result << ""
        elsif prev_indent < curr_indent
          result << :INDENT
          result << ""
        end

        prev_indent = curr_indent
      end

      # Mark line as started and add char to line.
      line_started = true; line << char
    end

  end

  result
end 
```

仅适用于两个空格缩进。结果类似于`["Hello there from level 0\n", :INDENT, "This\nis level\ntwo\n", :DEDENT, "This is level0 again\n"]`.

# c - C和嵌入式C有什么区别？

> ID：232683
> 
> 赞同：49
> 
> 时间：2008-10-24T06:59:30.970
> 
> 标签：c, embedded

任何人都可以告诉我它们之间的区别吗？

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2008-10-24T07:19:14.657

在 C 标准中，独立实现不必提供托管实现必须提供的所有库函数。C 标准并不关心嵌入式，但嵌入式系统的供应商通常会提供独立的实现以及他们愿意提供的任何数量的库。

C 是一种广泛使用的通用高级编程语言，主要用于系统编程。

嵌入式 C 是 C 编程语言的扩展，为开发嵌入式设备的高效程序提供支持。它不是 C 语言的一部分

您也可以参考以下文章：

*   [C 和嵌入式 C 的区别](http://www.differencebetween.info/difference-between-c-and-embedded-c)
*   [嵌入式 C](http://en.wikipedia.org/wiki/Embedded_C)
*   [ISO/IEC J TC1 SC22 WG14 N1169](http://www.open-std.org/jtc1/sc22/wg14/www/docs/n1169.pdf)

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2016-12-13T06:00:34.127

**嵌入式 C 一般是 C 语言的扩展**，它们或多或少相似。但是，*确实存在一些差异*，例如：

*   C 通常用于台式计算机，而嵌入式 C 用于基于微控制器的应用程序。

*   C 可以使用台式机的资源，例如内存、操作系统等。而嵌入式 C 必须使用有限的资源，例如嵌入式处理器上的 RAM、ROM、I/O。

*   嵌入式 C 包含 C 的额外功能，例如定点类型、多个内存区域和 I/O 寄存器映射。

*   C (ANSI C) 的编译器通常会生成依赖于操作系统的可执行文件。嵌入式 C 需要编译器创建文件以下载到需要运行的微控制器/微处理器。

参考[C 和嵌入式 C 的区别](http://www.differencebetween.info/difference-between-c-and-embedded-c)

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-10-24T07:14:19.427

基本上，一个都没有。嵌入式是指主机/微控制器，而不是语言。嵌入式系统可能有更少的资源和接口供程序员使用，因此 C 的使用方式会有所不同，但它仍然是相同的 ISO 定义语言。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2019-04-14T15:11:37.603

1：C是一种计算机编程语言。而嵌入式 C 是 C 编程语言的一组语言扩展。

2：C有一个自由格式的程序源代码，在台式电脑上。而嵌入式 C 具有基于嵌入式处理器（微控制器/微处理器）的不同格式。

3：C有正常的优化，在编程中。而嵌入式 C 高级编程优化。

4：C编程必须有要求的操作系统。而嵌入式 C 可能需要也可能不需要操作系统。

5：C 可以使用来自操作系统、内存等的资源，即所有来自桌面计算机的资源都可以被C 使用。而嵌入式C 可以使用有限的资源，如嵌入式处理器上的RAM、ROM 和I/O。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-25T11:53:57.993

嵌入式环境，有时候，没有MMU，内存少，存储空间少。在 C 编程级别，几乎相同，交叉编译器完成他们的工作。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2020-09-29T06:18:06.710

c 无法访问物理地址，嵌入式 c 可以访问物理地址 嵌入式 c 变量地址存储在堆栈中，在嵌入式 c 变量中应在块的开头声明嵌入式 c 输入输出端口，但在 c 中使用 printf 和 scanf

* * *

## 回答 #7

> 赞同：-6
> 
> 时间：2016-01-31T12:28:40.427

C是其用于系统编程的唯一编程语言。但嵌入式 C 用于实现实时应用程序等项目

# html - CSS 菜单（无法使标签达到全高）

> ID：232688
> 
> 赞同：2
> 
> 时间：2008-10-24T07:00:38.703
> 
> 标签：html, css, xhtml

```
<style type="text/css">
html, body {
    background: #fff;
    margin: 0;
    padding: 0;
}

#nav {
    font-family: Verdana, sans-serif;
    height: 29px;
    font-size: 12px;
    padding: 0 0 0 10px; /* this is used for something else */
    background-color: #456;
}

#nav ul, #nav ul li {
    list-style: none;
    margin: 0;
    padding: 9px 0 0 0px;
}

#nav ul {
    text-align: center;
}

#nav ul li {
    display: inline;
}

#nav ul li.last {
    margin-right: 0;
}

#nav ul li a {
    color: #FFF;
    text-decoration: none;
    padding: 0px 0 0 20px;
    height: 29px;
}
#nav ul li a span {
    padding: 8px 20px 0 0;
    height: 21px;
}

#nav ul li a:hover {
    background: #789;
}
</style>

<div id="nav">
    <ul>
    <li><a href="/1/"><span>One</span></a></li>
    <li><a href="/2/"><span>Two</span></a></li>
    <li><a href="/3/"><span>Three</span></a></li>
    <li><a href="/4/"><span>Four</span></a></li>
    </ul>
</div> 
```

我对此有一个小问题，因为它不会使“悬停背景”成为导航栏高度的 100%。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-24T07:22:38.707

这适用于我的机器：

```
<style type="text/css">
html, body {
    background: #fff;
    margin: 0;
    padding: 0;
}

#nav {
    font-family: Verdana, sans-serif;
    height: 29px;
    font-size: 12px;
    padding: 0 0 0 10px; /* this is used for something else */
    background-color: #456;
}

#nav ul, #nav ul li {
    list-style: none;
    margin: 0;
    padding: 0 0 0 0px;
}

#nav ul {
    text-align: center;
    position:relative;
    width:300px;
    margin:0 auto 0 auto;
}

#nav ul li {
    float:left;
}

#nav ul li.last {
    margin-right: 0;
}

#nav ul li a {
    float:left;
    color: #FFF;
    text-decoration: none;
    padding: 9px 0 0 20px;
    height: 20px;

}
#nav ul li a span {
    padding: 8px 20px 0 0;
    height: 20px;
}

#nav ul li a:hover {
    background: #789;
}
</style> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-24T07:06:51.343

你有没有尝试过：

```
#nav ul li a {
    color: #FFF;
    text-decoration: none;
    padding: 0px 0 0 20px;
    height: 29px;
    line-height: 29px;
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-24T07:19:27.670

不要在最外面的元素上设置高度。将它设置在最里面的元素上（除了高度之外，还需要一个 display:block 在你的规则上）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-28T18:31:10.910

您应该将填充和行高放在**a**标签上。不需要跨度，也不需要在 li 中进行任何填充。如果用户更改文本大小，则悬停背景会出现在 tabe 区域之外。

```
<style type="text/css">
html, body {
    background: #fff;
    margin: 0;
    padding: 0;
}

#nav {
    font-family: Verdana, sans-serif;
    height: 29px;
    font-size: 12px;
    padding: 0 0 0 10px; /* this is used for something else */
    background-color: #456;
}

#nav ul, #nav ul li {
    list-style: none;
    margin: 0;
    padding: 0px;
}

#nav ul {
    text-align: center;
}

#nav ul li {
    display: inline;
}

#nav ul li.last {
    margin-right: 0;
}

#nav ul li a {
    color: #FFF;
    text-decoration: none;
    padding: 8px 20px 7px 20px;
    line-height:29px;
}

#nav ul li a:hover {
    background-color: #789;
}
</style>

<div id="nav">
    <ul>
    <li><a href="/1/">One</a></li>
    <li><a href="/2/">Two</a></li>
    <li><a href="/3/">Three</a></li>
    <li><a href="/4/">Four</a></li>
    </ul>
</div> 
```

# html - 编辑转义代码（用于显示）

> ID：232689
> 
> 赞同：0
> 
> 时间：2008-10-24T07:01:19.703
> 
> 标签：html, escaping

如果我转义一些代码，因为我希望它显示为 html 中的实际代码（例如，对于示例代码片段），将其保存到数据库，然后将其拉回编辑器（html 页面），它会显示为 html ，而不是转义文本。

当我在文本中包含一个 textarea 标签时会出现我的问题，因为它会过早地关闭编辑区域并在保存时切断我所写的其余内容（或者如果我不关闭标签则更多）。

所以我的问题是：这是浏览器的预期行为吗？-> 所以我需要转义文本（可能是代码和前置标签）？每次我想对其进行更改？还是我做错了什么？

*注意我是唯一使用它的人，它主要是为了学习，所以我并不担心安全方面，而是检查我在浏览器中使用它时需要处理我的 html 并让它运行的方式一种预期的方式。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-24T07:09:03.697

根据我的经验，您确实需要进行某种特殊字符转义。在 PHP 中，函数是 htmlspecialchars()。我不知道其他功能。但是浏览器会正确显示文本区域中的编码字符。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-24T07:23:43.790

@Bob：[htmlentities()](http://php.net/htmlentities)与[htmlspecialchars()不同](http://php.net/htmlspecialchars)

htmlentities() 会将具有 ASCII 代码的每个字符转换为该代码。htmlspecialchars() 只会处理 HTML 中的特殊字符，例如 &、引号和 < 或 >

这是一个相当大的区别，它可能会破坏一些东西，并且在使用 htmlentities() 时也可能导致结果非常大。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-24T07:10:56.593

大多数基于 Web 的语言都有一些用于转义 HTML 解释字符的库函数，因此请查看您正在使用的语言的文档。

就像 Darryl 说的，html_entities()（它是 htmlspecialchars() 的别名）将在 PHP 中发挥作用。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-24T09:19:34.603

*这是浏览器的预期行为吗？* 是的，浏览器将您的（未转义的）HTML 代码解释为属于该页面的 HTML 标记并对其进行操作。

*所以我需要转义文本（可能是代码和前置标签）？* 是的，正如 Darryl Hein 所说，使用 htmlspecialchars()。它们将由浏览器正确显示，并且您无需在数据从编辑中返回时“取消转义”数据。

*...难道我做错了什么？* 您应该检查进入或离开应用程序的任何输入，并查看其中是否存在对浏览器、数据库服务器和解决方案的其他部分具有特殊意义的任何字符。您应该为每次交互正确转义特殊字符（即 MySQL 数据库的 mysql_escape_string()，HTML 的 htmlspecialchars() 等）

# c - 如何从 C 中的指针获取数组的大小？

> ID：232691
> 
> 赞同：69
> 
> 时间：2008-10-24T07:01:43.477
> 
> 标签：c, memory-management, pointers, malloc

我分配了一个`mystruct`大小`n`如下的“数组”：

```
if (NULL == (p = calloc(sizeof(struct mystruct) * n,1))) {
 /* handle error */
} 
```

后来，我只能访问`p`，而不再拥有`n`。有没有办法确定仅给定指针的数组的长度`p`？

我认为这*一定*是可能的，因为`free(p)`它就是这样做的。我知道`malloc()`跟踪它分配了多少内存，这就是它知道长度的原因；也许有办法查询这些信息？就像是...

```
int length = askMallocLibraryHowMuchMemoryWasAlloced(p) / sizeof(mystruct) 
```

我知道我应该重新编写代码以便我知道`n`，但如果可能的话我宁愿不这样做。有任何想法吗？

* * *

## 回答 #1

> 赞同：54
> 
> 时间：2008-10-24T07:16:19.330

不，如果不强烈依赖`malloc`. 特别是，`malloc`可能会分配比您请求更多的字节（例如，为了在特定内存架构中提高效率）。重新设计代码以便明确地跟踪会更好`n`。另一种选择*至少*是重新设计和更危险的方法（鉴于它是非标准的，滥用指针的语义，并且对于那些追随你的人来说将是维护的噩梦）：将长度存储`n`在 malloc'd地址，后跟数组。那么分配将是：

```
void *p = calloc(sizeof(struct mystruct) * n + sizeof(unsigned long int),1));
*((unsigned long int*)p) = n; 
```

`n`现在存储在`*((unsigned long int*)p)`并且您的数组的开始是现在

```
void *arr = p+sizeof(unsigned long int); 
```

**编辑：**只是为了扮演魔鬼的拥护者......我知道这些“解决方案”都需要重新设计，但让我们发挥一下。当然，上面提出的解决方案只是一个（包装良好的）结构的 hacky 实现。您不妨定义：

```
typedef struct { 
  unsigned int n;
  void *arr;
} arrInfo; 
```

并传递`arrInfo`s 而不是原始指针。

现在我们在做饭。但只要你在重新设计，为什么要停在这里？您真正想要的是抽象数据类型 (ADT)。算法和数据结构类的任何介绍性文本都可以做到。ADT 定义了数据类型的公共接口，但隐藏了该数据类型的实现。因此，公开的数组的 ADT 可能看起来像

```
typedef void* arrayInfo;
(arrayInfo)newArrayInfo(unsignd int n, unsigned int itemSize);
(void)deleteArrayInfo(arrayInfo);
(unsigned int)arrayLength(arrayInfo);
(void*)arrayPtr(arrayInfo);
... 
```

换句话说，ADT 是数据和行为封装的一种形式……换句话说，它与使用直接 C 语言的面向对象编程非常接近。除非你被困在一个不支持的平台上。有一个 C++ 编译器，你还不如全力以赴，只使用一个 STL `std::vector`。

在那里，我们提出了一个关于 C 的简单问题，并最终选择了 C++。上帝帮助我们所有人。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2008-10-24T07:03:41.523

自己跟踪数组大小；free 使用 malloc 链来释放已分配的*块*，该块不一定与您请求的数组大小相同

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-10-24T07:23:02.683

只是为了确认以前的答案：没有办法知道，仅仅通过研究一个指针，返回这个指针的 malloc 分配了多少内存。

## 如果它起作用了呢？

为什么这是不可能的一个例子。让我们想象一下带有一个名为 get_size(void *) 的假设函数的代码，它返回为指针分配的内存：

```
typedef struct MyStructTag
{ /* etc. */ } MyStruct ;

void doSomething(MyStruct * p)
{
   /* well... extract the memory allocated? */
   size_t i = get_size(p) ;
   initializeMyStructArray(p, i) ;
}

void doSomethingElse()
{
   MyStruct * s = malloc(sizeof(MyStruct) * 10) ; /* Allocate 10 items */
   doSomething(s) ;
} 
```

## 为什么即使它起作用了，它无论如何也不起作用？

但是这种方法的问题在于，在 C 中，您可以使用指针算术。让我们重写 doSomethingElse()：

```
void doSomethingElse()
{
   MyStruct * s = malloc(sizeof(MyStruct) * 10) ; /* Allocate 10 items */
   MyStruct * s2 = s + 5 ; /* s2 points to the 5th item */
   doSomething(s2) ; /* Oops */
} 
```

get_size 应该如何工作，因为您向函数发送了一个有效指针，但不是 malloc 返回的指针。即使 get_size 费尽心思找到大小（即以一种低效的方式），在这种情况下，它也会返回一个在您的上下文中是错误的值。

## 结论

总有办法避免这个问题，在 C 语言中，你总是可以编写自己的分配器，但同样，当你只需要记住分配了多少内存时，这可能太麻烦了。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2008-10-24T09:16:48.150

一些编译器提供 msize() 或类似的函数（_msize() 等），可以让你做到这一点

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-10-24T07:28:50.973

我可以推荐一种糟糕的方法吗？

按如下方式分配所有数组：

```
void *blockOfMem = malloc(sizeof(mystruct)*n + sizeof(int));

((int *)blockofMem)[0] = n;
mystruct *structs = (mystruct *)(((int *)blockOfMem) + 1); 
```

然后，您始终可以将数组转换为`int *`并访问 -1st 元素。

确保指向`free`该指针，而不是数组指针本身！

此外，这可能会导致可怕的错误，让你把头发扯掉。也许您可以将 alloc 函数包装在 API 调用或其他东西中。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-24T07:10:29.823

malloc 将返回至少与您请求一样大的内存块，但可能更大。因此，即使您可以查询块大小，这也不能可靠地为您提供数组大小。所以你只需要修改你的代码来自己跟踪它。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-10-24T08:59:48.370

对于指针数组，您可以使用以 NULL 结尾的数组。然后可以像使用字符串一样确定长度。在您的示例中，您可以使用结构属性来标记然后结束。当然，这取决于是否有不能为 NULL 的成员。因此，假设您有一个属性名称，需要为数组中的每个结构设置它，然后您可以通过以下方式查询大小：

```
 int size;
struct mystruct *cur;

for (cur = myarray; cur->name != NULL; cur++)
    ;

size = cur - myarray; 
```

顺便说一句，在您的示例中应该是 calloc(n, sizeof(struct mystruct)) 。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-10-24T17:29:43.430

其他人已经讨论了普通 c 指针的限制`stdlib.h`和`malloc()`. 一些实现提供了扩展，这些扩展返回可能大于请求大小的*分配块大小。*

如果你*必须*有这种行为，你可以使用或编写一个专门的内存分配器。最简单的做法是在函数周围实现一个包装器`stdlib.h`。就像是：

```
void* my_malloc(size_t s);     /* Calls malloc(s), and if successful stores 
                                  (p,s) in a list of handled blocks */
void my_free(void* p);         /* Removes list entry and calls free(p) */
size_t my_block_size(void* p); /* Looks up p, and returns the stored size */
... 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2010-09-03T16:18:58.550

真的你的问题是 - “我可以找出 malloc'd（或 calloc'd）数据块的大小”。正如其他人所说：不，不是以标准方式。

但是有自定义 malloc 实现可以做到这一点 - 例如[http://dmalloc.com/](http://dmalloc.com/)

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-10-24T07:04:07.373

我不知道有什么方法，但我想它会处理 malloc 内部的混乱，这通常是一个非常非常糟糕的主意。

为什么不能存储分配的内存大小？

编辑：如果你知道你应该重新编写代码，这样你就知道了，那就去做吧。是的，尝试轮询 malloc 可能既快速又容易，但知道 n 肯定会最大程度地减少混乱并加强设计。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-10-24T07:11:51.227

您不能询问 malloc 库一个块有多大的原因之一是分配器通常会四舍五入您的请求的大小以满足一些最小粒度要求（例如，16 字节）。因此，如果您要求 5 个字节，您将得到一个大小为 16 的块。如果你取 16 除以 5，当你真的只分配一个元素时，你会得到三个元素。malloc 库首先需要额外的空间来跟踪您请求的字节数，因此最好自己跟踪。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2010-09-03T15:58:54.660

这是对我的排序程序的测试。它设置了 7 个变量来保存浮点值，然后将它们分配给一个数组，该数组用于查找最大值。

神奇之处在于对 myMax 的调用：

float mmax = myMax((float *)&arr,(int) sizeof(arr)/sizeof(arr[0]));

这很神奇，不是吗？

myMax 需要一个浮点数组指针 (float *)，所以我使用 &arr 来获取数组的地址，并将其转换为浮点指针。

myMax 还期望数组中的元素数为 int。我通过使用 sizeof() 给我数组的字节大小和数组的第一个元素来获得该值，然后将总字节数除以每个元素中的字节数。（我们不应该猜测或硬编码 int 的大小，因为它在某些系统上是 2 个字节，而在我的 OS X Mac 上是 4 个字节，在其他系统上可能是其他东西）。

注意：当您的数据可能包含不同数量的样本时，所有这些都很重要。

这是测试代码：

```
#include <stdio.h>

float a, b, c, d, e, f, g;

float myMax(float *apa,int soa){
 int i;
 float max = apa[0];
 for(i=0; i< soa; i++){
  if (apa[i]>max){max=apa[i];}
  printf("on i=%d val is %0.2f max is %0.2f, soa=%d\n",i,apa[i],max,soa);
 }
 return max;
}

int main(void)
{
 a = 2.0;
 b = 1.0;
 c = 4.0;
 d = 3.0;
 e = 7.0;
 f = 9.0;
 g = 5.0;
 float arr[] = {a,b,c,d,e,f,g};

 float mmax = myMax((float *)&arr,(int) sizeof(arr)/sizeof(arr[0]));
 printf("mmax = %0.2f\n",mmax);

 return 0;
} 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2015-09-18T23:37:45.913

在[uClibc](http://www.uclibc.org/)中，有一个`MALLOC_SIZE`宏[`malloc.h`](http://git.uclibc.org/uClibc/tree/libc/stdlib/malloc/malloc.h#n103)：

```
/* The size of a malloc allocation is stored in a size_t word
   MALLOC_HEADER_SIZE bytes prior to the start address of the allocation:

     +--------+---------+-------------------+
     | SIZE   |(unused) | allocation  ...   |
     +--------+---------+-------------------+
     ^ BASE             ^ ADDR
     ^ ADDR - MALLOC_HEADER_SIZE
*/

/* The amount of extra space used by the malloc header.  */
#define MALLOC_HEADER_SIZE          \
  (MALLOC_ALIGNMENT < sizeof (size_t)       \
   ? sizeof (size_t)                \
   : MALLOC_ALIGNMENT)

/* Set up the malloc header, and return the user address of a malloc block. */
#define MALLOC_SETUP(base, size)  \
  (MALLOC_SET_SIZE (base, size), (void *)((char *)base + MALLOC_HEADER_SIZE))
/* Set the size of a malloc allocation, given the base address.  */
#define MALLOC_SET_SIZE(base, size) (*(size_t *)(base) = (size))

/* Return base-address of a malloc allocation, given the user address.  */
#define MALLOC_BASE(addr)   ((void *)((char *)addr - MALLOC_HEADER_SIZE))
/* Return the size of a malloc allocation, given the user address. */
#define MALLOC_SIZE(addr)   (*(size_t *)MALLOC_BASE(addr)) 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2021-07-20T10:35:55.537

`malloc()`在实际分配的空间的 8 个字节之前存储有关空间分配的元数据。这可以用来确定缓冲区的空间。在我的 x86-64 上，这总是返回 16 的倍数。因此，如果分配的空间是 16 的倍数（在大多数情况下），那么可以使用：

## 代码

```
#include <stdio.h>
#include <malloc.h>

int size_of_buff(void *buff) {
        return ( *( ( int * ) buff - 2 ) - 17 ); // 32 bit system: ( *( ( int * ) buff - 1 ) - 17 )
}

void main() {
        char *buff = malloc(1024);
        printf("Size of Buffer: %d\n", size_of_buff(buff));
} 
```

## 输出

```
Size of Buffer: 1024 
```

# c - 在另一个中包含一个 C 源文件？

> ID：232693
> 
> 赞同：137
> 
> 时间：2008-10-24T07:03:00.603
> 
> 标签：c, include, c-preprocessor, code-organization, project-organization

另一个文件中`#include`的文件可以（甚至推荐/良好做法）吗？`.c``.c`

* * *

## 回答 #1

> 赞同：133
> 
> 时间：2009-07-10T12:31:32.933

如果使用得当，这可能是一种有用的技术。

假设您有一个复杂的、性能关键的子系统，它具有相当小的公共接口和大量不可重用的实现代码。代码运行到几千行，大约有一百个私有函数和相当多的私有数据。如果您使用非平凡的嵌入式系统，您可能会经常处理这种情况。

您的解决方案可能是分层的、模块化的和解耦的，并且可以通过在不同文件中编码子系统的不同部分来有效地表示和加强这些方面。

使用C，这样做可能会损失很多。几乎所有工具链都为单个编译单元提供了不错的优化，但对任何声明为 extern 的东西都非常悲观。

如果你把所有东西都放在一个 C 源代码模块中，你会得到 -

*   性能和代码大小改进 - 在许多情况下，函数调用将被内联。即使没有内联，编译器也有机会生成更高效的代码。

*   链接级数据和功能隐藏。

*   避免命名空间污染及其必然结果 - 您可以使用不那么笨拙的名称。

*   更快的编译和链接。

但是，在编辑此文件时，您也会遇到一团糟，并且您会失去隐含的模块化。这可以通过将源代码拆分为多个文件并包含这些文件以生成单个编译单元来克服。

不过，您需要强加一些约定来正确管理它。这些将在某种程度上取决于您的工具链，但一些通用指针是 -

*   将公共接口放在一个单独的头文件中——无论如何你都应该这样做。

*   拥有一个包含所有子 .c 文件的主 .c 文件。这也可能包括公共接口的代码。

*   使用编译器保护确保私有头文件和源模块不包含在外部编译单元中。

*   所有私有数据和函数都应该声明为静态的。

*   保持 .c 和 .h 文件之间的概念区别。这利用了现有的约定。不同之处在于您的标题中会有很多静态声明。

*   如果您的工具链没有任何理由不这样做，请将私有实现文件命名为 .c 和 .h。如果您使用包含保护，这些将不会产生代码并且不会引入新名称（在链接期间您可能会得到一些空段）。巨大的优势是其他工具（例如 IDE）将适当地处理这些文件。

* * *

## 回答 #2

> 赞同：74
> 
> 时间：2008-10-24T07:12:11.863

可以吗？是的，它会编译

推荐吗？no - .c 文件编译为 .obj 文件，这些文件在编译（通过链接器）到可​​执行文件（或库）后链接在一起，因此无需在另一个中包含一个 .c 文件。您可能想要做的是制作一个 .h 文件，其中列出了另一个 .c 文件中可用的函数/变量，并包含 .h 文件

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2008-10-24T07:10:10.683

不。

根据您的构建环境（您未指定），您可能会发现它完全按照您想要的方式工作。

但是，有许多环境（IDE 和许多手工制作的 Makefile）期望编译 *.c - 如果发生这种情况，您可能会因重复符号而导致链接器错误。

通常应避免这种做法。

如果您绝对必须#include source（通常应该避免），请为文件使用不同的文件后缀。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2010-10-05T18:45:59.577

我想我会分享一个我的团队决定包含 .c 文件的情况。我们的架构主要由通过消息系统解耦的模块组成。这些消息处理程序是公共的，并调用许多本地静态工作函数来完成它们的工作。当试图覆盖我们的单元测试用例时，问题就出现了，因为执行此私有实现代码的唯一方法是间接通过公共消息接口。由于堆栈中的一些工作函数深入到膝盖深处，结果证明这是实现适当覆盖的一场噩梦。

包含 .c 文件为我们提供了一种访问我们感兴趣的测试机器中的 cog 的方法。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2016-08-21T11:36:33.730

您可以使用 linux 中的 gcc 编译器将两个 c 文件链接到一个输出中。假设您有两个 c 文件，一个是“main.c”，另一个是“support.c”。所以链接这两者的命令是

```
gcc main.c support.c -o main.out 
```

通过这两个文件将链接到单个输出 main.out 运行输出命令将是

```
./main.out 
```

如果您在 main.c 中使用在 support.c 文件中声明的函数，那么您应该在 main 中也使用 extern 存储类声明它。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-10-24T07:28:17.510

文件的扩展名对大多数 C 编译器来说并不重要，所以它会起作用。

但是，根据您的 makefile 或项目设置，包含的 c 文件可能会生成一个单独的目标文件。链接时可能会导致双重定义的符号。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2014-07-10T01:02:28.647

您可以将 .C 或 .CPP 文件正确包含到其他源文件中。根据您的 IDE，您通常可以通过查看要包含的源文件属性来防止双重链接，通常通过右键单击它并单击属性，然后取消选中/选中编译/链接/排除构建或任何选项或许。或者您不能在项目本身中包含该文件，因此 IDE 甚至不会知道它存在并且不会尝试编译它。使用makefile，您根本不会将文件放入其中进行编译和链接。

编辑：对不起，我把它作为答案而不是对其他答案的回复:(

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-24T07:28:21.207

将 C 文件包含到另一个文件中是合法的，但不建议这样做，除非您确切知道为什么要这样做以及您要达到什么目的。
我几乎可以肯定，如果您在这里发布您的问题背后的原因，社区会为您找到另一种更合适的方式来实现您的目标（请注意“几乎”，因为这可能是给定上下文的解决方案）。

顺便说一句，我错过了问题的第二部分。如果 C 文件被包含到另一个文件并同时包含到项目中，您可能最终会遇到重复符号问题，为什么要链接对象，即相同的函数将被定义两次（除非它们都是静态的）。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-24T07:15:14.230

C 语言不禁止这种#include，但生成的翻译单元仍然必须是有效的 C。

我不知道您在使用什么程序来处理 .prj 文件。如果您使用诸如“make”或 Visual Studio 之类的东西，只需确保将其文件列表设置为要编译的文件，而没有无法独立编译的文件。

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2020-09-03T14:49:49.640

许多其他答案不仅仅涵盖了您如何做到这一点，但为什么在正常情况下您可能不应该这样做。就是说，我会补充一下我过去这样做的原因。

在嵌入式开发中，通常会将芯片供应商源代码作为编译文件的一部分。问题是这些供应商可能没有与您的组织相同的样式指南或标准警告/错误标志设置。

因此，您可以创建一个包含供应商源代码的本地源文件，然后编译此包装 C 文件，以抑制包含的源代码以及该源代码包含的任何标头中的任何问题。举个例子：

```
/**
 * @file   vendor_wrap.c
 * @brief  vendor source code wrapper to prevent warnings
 */
#pragma GCC diagnostic push
#pragma GCC diagnostic ignored "-Wnested-externs"
#include "vendor_source_code.c"
#pragma GCC diagnostic pop 
```

这允许您使用不太复杂的 Make 脚本，其中包含一组标准的编译器标志和代码中具有特定异常的设置，而不是在脚本中为某些文件使用自定义标志。

```
gcc main.c vendor_wrap.c -o $(CFLAGS) main.out 
```

* * *

## 回答 #11

> 赞同：-9
> 
> 时间：2016-08-15T10:32:03.323

你应该像这样添加标题

```
#include <another.c> 
```

注意：两个文件都应该放在同一个地方

我在用于 ATMEGA 微控制器的 codevison AVR 中使用它并真正工作，但它不能在普通 C 语言文件中工作

# unix - NTPD：使用不受限制的端口进行通信

> ID：232722
> 
> 赞同：17
> 
> 时间：2008-10-24T07:18:20.213
> 
> 标签：unix, time, ntpd

使用命令**ntpdate**查询 ntp 服务器时，我可以使用**-u**参数使源端口成为不受限制的端口（端口 1024 及以上）。

使用旨在在后台运行的 ntpd，我似乎找不到打开此选项的方法。所以源端口总是123。我的防火墙配置非常糟糕。

**ntp.conf**中是否有配置选项使其使用随机源端口？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-10-27T15:14:36.063

听起来这不可能……请参阅[ntp 故障排除页面](http://support.ntp.org/bin/view/Support/TroubleshootingNTP#Section_9.8.)：

> 如果要运行 ntpd，则需要修复网络/防火墙/NAT，以便 ntpd 可以在两个方向上完全不受限制地访问 UDP 端口 123。
> 
> 如果这不可能，您可能需要在防火墙本身上运行 ntpd，以便它可以在两个方向上完全不受限制地访问 UDP 端口 123，然后让它为您的内部客户端提供时间。
> 
> 如果这不可能，您唯一的其他选择可能是购买必要的硬件以连接到您自己的一台或多台计算机并运行您自己的 Stratum 1 时间服务器或购买预包装的 Stratum 1 时间服务器。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2010-10-10T23:57:25.387

我设法通过用 OpenNTPD 替换官方 NTPD 来解决这个问题。虽然官方NTPD 固定为UDP 端口123，但OpenNTPD 使用非特权端口。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-27T15:37:32.243

我以前遇到过这个问题，找不到解决方案。我最终只是在 crontab 中添加了一个每小时运行一次 ntpdate 的条目。这为我所做的任何事情提供了足够好的分辨率，因为我的时钟每小时漂移不超过 1 秒。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2015-08-18T23:40:44.070

您可以在运行 ntpd 的主机上使用源 NAT 将 123 源端口替换为 1024 以上的端口号。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2014-04-10T20:05:50.183

您不能更改 NTP 端口，但可以添加 iptables cmd 以通过 VPN 端口重定向它。

详情： http: [//openvpn.net/archive/openvpn-users/2007-11/msg00223.html](http://openvpn.net/archive/openvpn-users/2007-11/msg00223.html)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2015-04-30T14:34:24.890

正如@Andy_Whitfield 所写， ntpd 不能这样做。但也有[OpenNTPD](http://www.openntpd.org/)和[Chrony](http://chrony.tuxfamily.org/)等替代方案。AFAIK，Android 也使用 Chrony。

在我的设置中，我使用 chrony。它使用非特权端口来询问远程服务器。这种技术有更多的机会通过 NAT。顺便说一下，它也是`ntpdate -q`用于查询服务器的相同机制，但仅在作为非特权用户调用时。

我认为，它有时不起作用的主要问题是许多路由器自己实现了 NTP 来设置其内部时钟。在这些设备上，端口正在使用中，因此无法进行 NAT。如果设备不响应​​ NTP 查询，甚至可能会出现这种情况。

# .net - 字符串中的日期时间格式？

> ID：232732
> 
> 赞同：5
> 
> 时间：2008-10-24T07:23:50.750
> 
> 标签：.net, datetime

如何将字符串转换为 DateTime 格式？例如，如果我有一个像这样的字符串：

`"24/10/2008"`

如何将其转换为 DateTime 格式？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-10-24T07:28:09.337

使用[DateTime.ParseExact](http://msdn.microsoft.com/en-us/library/system.datetime.parseexact.aspx)：

```
string str = "24/10/2008";
DateTime dt = DateTime.ParseExact(str, "dd/MM/yyyy", 
                                  Thread.CurrentThread.CurrentCulture); 
```

（诚​​然，你应该考虑你真正想要解析它的文化。）

编辑：其他答案已将“null”指定为第三个参数 - 这相当于使用`Thread.CurrentThread.CurrentCulture`.

有关其他格式，请参阅MSDN 中的[“自定义日期和时间格式字符串”](http://msdn.microsoft.com/en-us/library/8kb3ddd4.aspx)。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-24T08:36:23.100

如果您不知道格式，请使用：

```
DateTime d = DateTime.Parse(dateString); 
```

这会尝试使用当前文化的格式规则（例如英语（美国）“en-US”、德语“de-DE”……）来解析日期和时间的字符串表示。它尝试忽略无法识别的数据，并用当前日期填充年、月和日的缺失值（例如，如果只解析包含时间的字符串）。

如果您知道字符串使用的区域性与当前区域性不同，则可以指定要使用的区域性：

```
CultureInfo culture = CultureInfo.CreateSpecificCulture("en-US");
DateTime d = DateTime.Parse(dateString, culture); 
```

您应该始终用 try-catch 块包围转换，因为字符串必须符合可识别的模式。或者，您也可以使用`DateTime.TryParse(dateString, out dateTime)`在成功时返回 true 并在`dateTime`;中返回结果的方法来测试字符串的有效性。否则为假。

如果您知道确切的格式，则可以使用

```
DateTime d = DateTime.ParseExact(dateString, "dd/MM/yyyy", null); 
```

（有关其他格式字符串，请参阅 MSDN 站点中的[自定义日期和时间格式字符串）。](http://msdn.microsoft.com/en-us/library/8kb3ddd4.aspx)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-24T10:00:27.733

[`DateTime.TryParse`](http://msdn.microsoft.com/en-us/library/system.datetime.tryparse.aspx)如果您不确定日期字符串的格式，我还建议您查看一下。这样您可以避免在 Parse 例程中处理非常昂贵的异常。

[`DateTime.ParseExact`](http://msdn.microsoft.com/en-us/library/system.datetime.parseexact.aspx)如果您每次都确切知道日期的格式，**我***也会*支持Jon Skeet 的建议。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-24T07:30:42.903

尝试类似的东西

```
DateTime date = System.DateTime.ParseExact(str, "dd/MM/yyyy", null); 
```

对于时间，这可能会奏效

```
DateTime date = System.DateTime.ParseExact(str, "HH:mm:ss", null); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-24T07:31:16.613

```
string str = "24/10/2008";
DateTime dt = Convert.ToDateTime(str); 
```

# php - PHP有代码混淆器吗？

> ID：232736
> 
> 赞同：226
> 
> 时间：2008-10-24T07:25:11.370
> 
> 标签：php, obfuscation

有没有人为 PHP 使用过好的混淆器？我尝试了一些，但它们不适用于非常大的项目。例如，它们无法处理包含在一个文件中并在另一个文件中使用的变量。

或者你还有什么其他的技巧可以阻止你的代码传播吗？

* * *

## 回答 #1

> 赞同：252
> 
> 时间：2011-02-26T16:40:18.490

~~你可以试试[PHP Protect](http://www.phpprotect.info/)，它是一个免费的 PHP 混淆器来混淆你的 PHP 代码。
它非常好，易于使用且免费。~~ *编辑：这项服务不再存在。*

至于其他人在这里写的关于不使用混淆的内容，因为它可能会被破坏等：
我只有一件事要回答他们 - 不要锁你的房门，因为任何人都可以打开你的锁。
情况正是如此，混淆并不是为了防止 100% 的代码被盗。它只需要使它成为一项耗时的任务，因此支付原始编码器的费用会更便宜。希望这可以帮助。

* * *

## 回答 #2

> 赞同：114
> 
> 时间：2008-10-24T07:36:50.067

人们会为您提供混淆器，但再多的混淆也无法阻止他人获取您的代码。没有任何。如果您的计算机可以运行它，或者如果它可以播放电影和音乐，则用户可以使用它。即使将其编译为机器代码也只会使工作变得更加困难。如果你使用混淆器，你只是在自欺欺人。更糟糕的是，您还禁止您的用户修复错误或进行修改。

音乐和电影公司还没有完全接受这一点，他们仍然在 DRM 上花费数百万美元。

在 PHP 和 Perl 等解释型语言中，这是微不足道的。Perl 曾经有很多代码混淆器，然后我们意识到您可以轻松地反编译它们。

```
perl -MO=Deparse some_program 
```

PHP 有[DeZender](http://dezender.net/)和[Show My Code](http://www.showmycode.com/)之类的东西。

我的建议？写许可证并请律师。唯一的其他选择是不提供代码，而是运行托管服务。

另请参阅[有关该主题的 perlfaq 条目](http://perldoc.perl.org/perlfaq3.html#How-can-I-hide-the-source-for-my-Perl-program%3f)。

* * *

## 回答 #3

> 赞同：32
> 
> 时间：2010-09-23T18:20:54.153

没有什么是完美的。如果您只是想阻止非程序员，那么这是我编写的一个小脚本，您可以使用：

```
<?php
$infile=$_SERVER['argv'][1];
$outfile=$_SERVER['argv'][2];
if (!$infile || !$outfile) {
    die("Usage: php {$_SERVER['argv'][0]} <input file> <output file>\n");
}
echo "Processing $infile to $outfile\n";
$data="ob_end_clean();?>";
$data.=php_strip_whitespace($infile);
// compress data
$data=gzcompress($data,9);
// encode in base64
$data=base64_encode($data);
// generate output text
$out='<?ob_start();$a=\''.$data.'\';eval(gzuncompress(base64_decode($a)));$v=ob_get_contents();ob_end_clean();?>';
// write output text
file_put_contents($outfile,$out); 
```

* * *

## 回答 #4

> 赞同：21
> 
> 时间：2011-03-05T00:48:33.573

我不确定您是否可以将解释语言的混淆标记为毫无意义（我无法在 Schwern 的帖子中添加评论，所以这里有一个新条目）。

我认为假设您知道有人想要混淆代码的所有可能场景，并且您假设任何人实际上都愿意竭尽全力查看被混淆的代码，这有点短视。考虑我目前的情况：

我在一家咨询公司工作，该公司正在开发一个大型且相当复杂的基于 PHP 的网站。该项目将托管在托管其他咨询公司开发的其他站点的客户服务器上。从技术上讲，我们编写的任何代码都归客户所有，因此我们无法获得许可。但是，任何其他有权访问服务器的咨询公司（竞争对手）都可以复制我们的代码，而无需先获得客户的许可。因此，我们有一个真正的混淆理由——为了让竞争对手理解我们的代码，而不是从头开始创建我们工作的副本。

* * *

## 回答 #5

> 赞同：16
> 
> 时间：2010-05-07T02:38:40.427

请参阅我们的[SD Thicket PHP Obfuscator](http://www.semanticdesigns.com/Products/Obfuscators/PHPObfuscator.jsp)，了解可以很好地处理任意大型页面集的混淆器。它主要通过加扰标识符名称来操作。对于中型到大型应用程序，这会使代码极难理解，而这正是整个目的。

它不会在“eval(decode( *codedprogramcode* ))”方案上浪费任何精力，很多 PHP“混淆器”都会这样做[这些是“编码器”，而不是“混淆器”]，因为任何 clod 都可以找到该调用并自己执行 eval-decode 并获取解码的代码。

它使用语言精确的解析器来处理 PHP；它会告诉您您的程序是否在语法上无效。更重要的是，它准确地了解整个语言；它不会丢失或混淆，也不会破坏您的代码（如果您“不正确地”混淆会发生什么，例如，无法正确识别代码的公共 API）。

是的，它在页面之间以相同的方式混淆标识符；如果它不这样做，结果将不起作用。

* * *

## 回答 #6

> 赞同：14
> 
> 时间：2008-10-24T07:30:55.587

我见过的最好的是[Zend Guard](http://www.zend.com/en/products/guard/)。

* * *

## 回答 #7

> 赞同：11
> 
> 时间：2010-03-26T21:42:01.477

试试这个：[http ://www.pipsomania.com/best_php_obfuscator.do](http://www.pipsomania.com/best_php_obfuscator.do)

最近我用Java写了一个混淆我的PHP项目，因为我在网上没有找到任何好的和兼容的现成的，我决定把它作为saas放在网上，让大家免费使用它。它不会更改不同脚本之间的变量名称以获得最大的兼容性，但可以很好地混淆它们，使用随机逻辑，每条指令也是如此。字符串...一切。我相信它比这个错误的codeeclipse要好得多，这是用PHP编写的并且非常慢:)

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2012-12-06T05:27:39.363

[用于 PHP 的Thicket™ 混淆器](http://www.semdesigns.com/products/obfuscators/PHPObfuscator.html)

> **PHP Obfuscator**工具对PHP 源代码进行打乱，使其非常难以理解或进行逆向工程（示例）。这为必须托管在网站上或运送给客户的源代码知识产权提供了重要的保护。它是 SD 源代码混淆器系列的成员。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2012-11-28T19:41:23.343

使用 SourceGuardian 很好，因为它带有一个很酷且易于使用的 GUI。

**但请注意：**

注意它的——相当有趣的——许可条款。

*   您只能在每台机器上运行 1 个 - 到目前为止这是可以接受的
*   如果你想在另一台机器上运行命令行界面，比如说你的网络服务器，**你将需要另一个许可证**（是的，这很有趣，我也能听到你在笑）。

* * *

## 回答 #10

> 赞同：-19
> 
> 时间：2010-05-07T02:59:38.250

混淆只会为您的程序添加另一层潜在的错误和安全漏洞。请不要这样做。

无论如何，编写混淆软件的那种人通常看起来非常粗略和不熟练。

如果您的代码“很棒”，那么破解者将竭尽全力传播它，无论它是否被混淆。如果没有人知道/关心您的代码，他们可能也不会。

# gdb - 如何打印 gdb 中的变量

> ID：232744
> 
> 赞同：49
> 
> 时间：2008-10-24T07:29:27.057
> 
> 标签：gdb

有时 gdb 会为某些类型的变量打印“不完整类型”。这是什么意思，我们如何才能看到这个价值？

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2008-10-27T17:59:05.513

这意味着该变量的类型尚未完全指定。例如：

```
struct hatstand;
struct hatstand *foo; 
```

GDB 知道这`foo`是一个指向`hatstand`结构的指针，但该结构的成员尚未定义。因此，“不完整类型”。

要打印该值，您可以将其转换为兼容的类型。

例如，如果您知道这`foo`实际上是一个指向`lampshade`结构的指针：

```
print (struct lampshade *)foo 
```

或者，您可以将其打印为通用指针，或者将其视为整数：

```
print (void *)foo
print (int)foo 
```

另请参阅 GDB 手册中的这些页面：

*   [http://sourceware.org/gdb/current/onlinedocs/gdb/Data.html#Data](http://sourceware.org/gdb/current/onlinedocs/gdb/Data.html#Data)
*   [http://sourceware.org/gdb/current/onlinedocs/gdb/Symbols.html#Symbols](http://sourceware.org/gdb/current/onlinedocs/gdb/Symbols.html#Symbols)

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2012-10-14T17:41:03.957

我发现，如果您反汇编一个使用不完整结构类型 gdb 的函数，则会“发现”结构成员并随后显示它们。例如，假设您有一个字符串结构：

```
struct my_string {
    char * _string,
    int _size
} ; 
```

一些通过指针创建和获取字符串的函数：

```
my_string * create_string(const char *) {...}
const char * get_string(my_string *){...} 
```

和一个创建字符串的测试：

```
int main(int argc, char *argv[]) {
    my_string *str = create_string("Hello World!") ;
    printf("String value: %s\n", get_string(str)) ;
    ...
} 
```

在 gdb 中运行它并尝试“打印 *str”，你会得到一个“不完整类型”的响应。但是，尝试 'disassemble get_string' 然后 'print *str' 它将正确显示结构和值。我不知道为什么会这样，但确实如此。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2019-05-26T12:36:37.743

免责声明：我是一名 Python 开发人员，对 C++ 和 Linux OS 的运行方式只有一点了解，所以我在下面描述的只是我对我个人遇到的问题的解决方案。

# 如果您尝试使用来自 3rd 方库的类型，请确保这些库没有丢失调试信息。

### 例子

```
(gdb) info share Qt
From                To                  Syms Read   Shared Object Library
0x00007ffff5336080  0x00007ffff56ba585  Yes (*)     /usr/lib/x86_64-linux-gnu/libQt5Widgets.so.5
0x00007ffff4ad3510  0x00007ffff4ef0cbe  Yes (*)     /usr/lib/x86_64-linux-gnu/libQt5Gui.so.5
0x00007ffff47829c0  0x00007ffff47e1ba1  Yes (*)     /usr/lib/x86_64-linux-gnu/libQt5DBus.so.5
0x00007ffff40bb5e0  0x00007ffff439dd92  Yes (*)     /usr/lib/x86_64-linux-gnu/libQt5Core.so.5
0x00007ffff2e581e0  0x00007ffff2e78e4f  Yes (*)     /usr/lib/x86_64-linux-gnu/libQt5Xml.so.5
0x00007ffff28c8a00  0x00007ffff29d9999  Yes (*)     /usr/lib/x86_64-linux-gnu/libQt5Network.so.5
0x00007ffff2251750  0x00007ffff2252a46  Yes (*)     /usr/lib/x86_64-linux-gnu/libQt5X11Extras.so.5
0x00007ffff1cc9f80  0x00007ffff1cfc861  Yes (*)     /usr/lib/x86_64-linux-gnu/libQt5PrintSupport.so.5
0x00007fffee269c10  0x00007fffee297b57  Yes (*)     /usr/lib/x86_64-linux-gnu/libQt5Svg.so.5
0x00007fffed987560  0x00007fffed98b6a8  Yes (*)     /usr/lib/x86_64-linux-gnu/libQt5TextToSpeech.so.5
0x00007fffe980e130  0x00007fffe9900c0c  Yes (*)     /usr/lib/x86_64-linux-gnu/libQt5XcbQpa.so.5
0x00007fffe69ef650  0x00007fffe69ffe0d  Yes (*)     /usr/lib/x86_64-linux-gnu/libQt5QuickControls2.so.5
0x00007fffe5c0f890  0x00007fffe5eae1c1  Yes (*)     /usr/lib/x86_64-linux-gnu/libQt5Quick.so.5
0x00007fffe5522690  0x00007fffe581f636  Yes (*)     /usr/lib/x86_64-linux-gnu/libQt5Qml.so.5
0x00007fffe51996b0  0x00007fffe5221363  Yes (*)     /usr/lib/x86_64-linux-gnu/libQt5QuickTemplates2.so.5
(*): Shared library is missing debugging information. 
```

^ 当前示例中的所有 Qt 库都缺少调试信息。这是因为 qt 库的调试信息来自单独的包，这些包没有被安装。

每当我做`whatis`一切都很好：

```
(gdb) whatis e
type = QEvent * 
```

但是当我试图访问它的成员时

```
(gdb) p e->type()
Couldn't find method QEvent::type 
```

并试图获得详细的类型描述

```
(gdb) ptype e
type = class QEvent {
  <incomplete type>
} * 
```

### 解决方案（适用于 Ubuntu 上的 Qt）

1.  查找文件属于您的操作系统发行版中的哪个包

```
$ dpkg -S /usr/lib/x86_64-linux-gnu/libQt5Core.so.5
libqt5core5a:amd64: /usr/lib/x86_64-linux-gnu/libQt5Core.so.5 
```

2.  搜索相关包

    使用 keywork 搜索`libqt5core5a`返回 2 个包，一个是`libqt5core5a`自身，另一个是`libqt5core5a-dbgsym`. 后者的描述说：“libqt5core5a 的调试符号”

3.  安装带有调试符号的软件包（我还为其他一些基本的 Qt 库安装了调试符号）

```
$ sudo apt install libqt5core5a-dbgsym libqt5widgets5-dbgsym libqt5gui5-dbgsym 
```

4.  确保`gdb`该库中现在有调试信息

```
(gdb) info share Qt
From                To                  Syms Read   Shared Object Library
0x00007ffff5336080  0x00007ffff56ba585  Yes         /usr/lib/x86_64-linux-gnu/libQt5Widgets.so.5
0x00007ffff4ad3510  0x00007ffff4ef0cbe  Yes         /usr/lib/x86_64-linux-gnu/libQt5Gui.so.5
0x00007ffff47829c0  0x00007ffff47e1ba1  Yes (*)     /usr/lib/x86_64-linux-gnu/libQt5DBus.so.5
0x00007ffff40bb5e0  0x00007ffff439dd92  Yes         /usr/lib/x86_64-linux-gnu/libQt5Core.so.5
0x00007ffff2e571e0  0x00007ffff2e77e4f  Yes (*)     /usr/lib/x86_64-linux-gnu/libQt5Xml.so.5
0x00007ffff28c7a00  0x00007ffff29d8999  Yes (*)     /usr/lib/x86_64-linux-gnu/libQt5Network.so.5
0x00007ffff2250750  0x00007ffff2251a46  Yes (*)     /usr/lib/x86_64-linux-gnu/libQt5X11Extras.so.5
0x00007ffff1cc8f80  0x00007ffff1cfb861  Yes (*)     /usr/lib/x86_64-linux-gnu/libQt5PrintSupport.so.5
0x00007fffee268c10  0x00007fffee296b57  Yes (*)     /usr/lib/x86_64-linux-gnu/libQt5Svg.so.5
0x00007fffed985560  0x00007fffed9896a8  Yes (*)     /usr/lib/x86_64-linux-gnu/libQt5TextToSpeech.so.5
0x00007fffe95fc130  0x00007fffe96eec0c  Yes (*)     /usr/lib/x86_64-linux-gnu/libQt5XcbQpa.so.5
0x00007fffe701f650  0x00007fffe702fe0d  Yes (*)     /usr/lib/x86_64-linux-gnu/libQt5QuickControls2.so.5
0x00007fffe623c890  0x00007fffe64db1c1  Yes (*)     /usr/lib/x86_64-linux-gnu/libQt5Quick.so.5
0x00007fffe5b4f690  0x00007fffe5e4c636  Yes (*)     /usr/lib/x86_64-linux-gnu/libQt5Qml.so.5
0x00007fffe57c66b0  0x00007fffe584e363  Yes (*)     /usr/lib/x86_64-linux-gnu/libQt5QuickTemplates2.so.5
(*): Shared library is missing debugging information. 
```

5.  现在使用 Qt 类型可以按预期工作

```
(gdb) p e->type()
$4 = QEvent::Paint
(gdb) ptype e
type = class QEvent {
  public:
...
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2016-04-14T10:53:46.670

我有同样的问题。如果您手动从库中加载符号：

```
set auto-solib-add off
attach thread_id
shared any_lib
shared another_lib 
```

您还需要使用相同的命令从声明此对象的库中加载符号。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2016-12-13T22:01:45.270

我不知道该错误的全部含义，但正如 Peter 指出的那样，反汇编相关方法可以使这些类型定义中的一些可用。

我的例子：

在一个类的 .h 中，该类包含一个内部辅助类的前向声明，以便外部类可以包含指向它的指针。相应的 .cpp 具有完整的内部助手类定义。

在中断外部类的方法时，gdb 报告了通过外部类的实例取消引用指向内部类实例的指针的不完整类型。

对外部类中的方法之一发出 disasemble 命令允许 gdb 使用先前失败的相同指针来理解内部类的结构。

# java - 从 Windows Batch (cmd.exe) 中的文件读取环境变量

> ID：232747
> 
> 赞同：12
> 
> 时间：2008-10-24T07:29:47.350
> 
> 标签：java, windows, command-line, cmd, environment-variables

我正在尝试从批处理文件中读取变量以供以后在批处理脚本中使用，该脚本是一个 Java 启动器。理想情况下，我希望所有平台（Unix、Windows）上的设置文件具有相同的格式，并且也是有效的 Java 属性文件。也就是说，它应该如下所示：

```
setting1=Value1
setting2=Value2
... 
```

是否可以像在 Unix shell 脚本中那样读取这些值？可能看起来像这样：

```
READ settingsfile.xy
java -Dsetting1=%setting1% ... 
```

我知道这可能是可能的`SET setting1=Value1`，但我真的希望所有平台上的设置都具有相同的文件格式。

澄清一下：我需要在命令行/批处理环境中执行此操作，因为我还需要设置无法从 JVM 中更改的参数，例如 -Xmx 或 -classpath。

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2008-10-24T08:17:30.453

您可以在批处理文件中执行此操作，如下所示：

```
setlocal
FOR /F "tokens=*" %%i in ('type Settings.txt') do SET %%i
java -Dsetting1=%setting1% ...
endlocal 
```

这会读取一个包含诸如“SETTING1=VALUE1”之类的字符串的文本文件，并调用 SET 将它们设置为环境变量。

setlocal/endlocal 用于将环境变量的范围限制为批处理文件的执行。

CMD 命令处理器实际上非常强大，尽管语法相当拜占庭式。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-24T07:56:35.223

您可以将属性文件作为参数传递给 Java 程序（稍后可能会启动主程序）。然后从多平台范式中受益。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-06-01T16:23:13.430

仅从属性文件（您提前知道的）导入特定变量可能是明智的，在这种情况下，我建议使用如下函数：

```
:parsePropertiesFile
    set PROPS_FILE=%1
    shift
    :propLoop
    if "%1"=="" goto:eof
    FOR /F "tokens=*" %%i in ('type %PROPS_FILE% ^| findStr.exe "%1="') do SET %%i
    shift
    GOTO propLoop
goto:eof 
```

将调用它`call:parsePropertiesFile props.properties setting1 setting2`来设置变量 setting1 和 setting2

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-24T22:55:52.507

您还可以从 Java 程序中访问操作系统的环境变量：

```
import java.util.Map;

public class EnvMap {
    public static void main (String[] args) {
        Map<String, String> env = System.getenv();
        for (String envName : env.keySet()) {
            System.out.format("%s=%s%n", envName, env.get(envName));
        }
    }
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2021-12-23T20:20:55.890

### 这将执行以下操作：

*   跳过所有以开头的行`#`（可用于注释）
*   读取`.env`位于批处理脚本同一目录中的文件并将行传递给`SET`

### 剧本

```
FOR /F "eol=# tokens=*" %%i IN (%~dp0.env) DO SET %%i 
```

> 如果您想将变量读取为数字，请在 .env 文件中的变量行前面加上`/A`标志，
> 即：`/A PORT=1215`

**为了更有帮助这是我正在解析的 .env 文件**

```
# The name of the mariadb service to be installed
MariaDb_serviceName=Swoole_MariaDB
# which port the mariadb server will run at
# notice i added /A flag so that the SET command stores the variable as a number
/A MariaDb_port=1214
# password of mariadb root user
MariaDb_rootPassword=
# Database to be created after installing mariadb
MariaDb_createDataBase=data
# the server service name to be installed
Server_serviceName=Swoole_Server 
```

# asp.net - 并发 ASP.NET 会话最佳实践

> ID：232748
> 
> 赞同：3
> 
> 时间：2008-10-24T07:29:50.643
> 
> 标签：asp.net, session, concurrency

用户 A 登录工单管理系统以编辑“SomePage.aspx”上的内容

用户 B 在 30 秒后登录以在“SomePage.aspx”上编辑同一张票

通知每个用户其他人正在修改相同内容的一些最佳实践（在 3 层架构中）是什么？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-24T07:33:41.337

在像 HTTP 这样的请求/响应系统中，没有太多关于用户当前正在做什么的概念。您可以通知他们其他人“在最后两分钟内”打开了要编辑的票证（甚至在这种情况下阻止他们打开票证），但用户 A 可以编辑半小时 - 除非您也禁止这样做。您可以记录下您认为用户 A 有效地“获取”了要编辑的项目的事实，但是对于 Web 应用程序，没有什么可以阻止用户离开计算机并且从不保存/取消。

在考虑技术解决方案之前，我建议考虑技术*限制*（基本上是网络的异步和请求/响应性质）并制定所需的行为。一些常见的行为是：

*   第一个编辑获胜（告诉第二个编辑他们的更改已被拒绝，基本上）
*   第二次编辑获胜（覆盖第一次编辑 - 告诉第一个编辑为时已晚）
*   合并（可能非常困难和/或不可能，具体取决于内容）。这可以是自动的或手动的（在第二个编辑器方面）。
*   在您认为第一人可能正在编辑时阻止第二人进行编辑（由于第一段中提到的问题，很少适用于网络应用程序）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-24T15:04:42.973

Roundup 使用（例如）乐观并发方法：当您提交更改时，您可能会看到有人在您之前进行了更改的警告，并带有指向显示其更改的页面的链接。您可以单击提交以继续进行更改或编辑表单中的值，然后提交。

这适用于票务系统，因为票证上几乎没有共享状态——主要是您附加到消息日志（或等效项），因此 2 条消息一个接一个地添加。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-24T07:40:53.677

我在这方面不是很有经验，但如果我需要做类似的事情，我会在 Ticket Table 上的数据库上创建一个名为**EditingBy**的新字段，并添加一个默认值“0”。

当用户调用 TicketID = 897 时，查询应如下所示：

```
SELECT * FROM Tickets WHERE TicketID = 897; 
UPDATE Tickets SET EditingBy = @UserID WHERE TicketID = 897; 
```

然后在代码中，您会看到 EditingBy 是否大于 0，您可以警告 UserB UserA（您知道 UserID）正在编辑票证，就像有人发布答案并且您正在写您的答案时那样，或者当您得到一个以新徽章为例。

当提交更新票证时，您可以将该字段更新回 0。

并建议用户可以输入 SomePage.aspx 并离开而不做任何事情，因为 body 标记中的**javascript onUnload**会触发异步调用以将 EdittingBy 更新回 0 将是一个想法。

希望这能让你对这样做有一个想法。

**已编辑：** 如果无法编辑数据库本身，您可以随时将 EditingBy 记录在 XML 文件中，只需保留 TicketID 和 UserID，而不是查找它是否大于 0，只需检查 TicketID 是否在 XML 中。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-07-15T12:38:37.670

我发现防止乐观并发的最好方法是在数据库中添加一个名为时间戳的字段，例如：SQLTimeStamp。该字段为表中的每条记录维护一个唯一值。当用户 A 查询表进行编辑时，将 sqltimestamp 值存储在会话中。如果用户 B 在用户 A 之前查询和更新同一条记录，则 sql 时间戳值会更改。如果用户 A 现在尝试存储编辑的值，首先检查会话时间戳是否与数据库上的当前时间戳相同，如果时间戳不同，则提示用户有人修改了记录。

这是我用于 Web 应用程序的解决方案。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-24T07:37:02.547

我假设您正在谈论帮助台票或类似的东西，一次只有一个用户应该处理它。在这种情况下，当第一个用户*签出票证时，票证的状态应该会改变*

# visual-studio - 无法在 Visual Studio 2008 SP1 中导入设置

> ID：232763
> 
> 赞同：0
> 
> 时间：2008-10-24T07:35:12.630
> 
> 标签：visual-studio, visual-studio-2008, vssettings

我最近对我的机器进行了基线化并安装了 VS2008，我正在尝试导入我的设置文件： http://naspinski.net/file.axd?file= [naspinski.vssettings](http://naspinski.net/file.axd?file=naspinski.vssettings)

我单击**工具->导入**设置，**选择导入选定的环境设置**，然后单击**下一步**

下一个屏幕我选择**否，只需导入新设置，覆盖我当前的设置**，然后单击**下一步**

我浏览到我的文件并单击**Open** - 或 - 双击该文件，然后它就转储了...我没有单击**Finished**的选项，它只是转储了？

有什么想法有什么问题吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-05T06:32:32.800

原来我必须将自己添加到计算机管理中的管理员组。在工作中，我们默认没有这些权限。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-24T07:36:26.527

尝试仅按部分导入 - 然后您应该看到哪些位似乎是错误的......

在我的机器上导入正常。= VS2008 sp1 - 有警告

1.  命令窗口别名
2.  外部工具

可能想检查一下。

还建议更改为 Monaco 字体-更易于阅读...

看看[http://www.hanselman.com/blog/VisualStudioProgrammerThemesGallery.aspx](http://www.hanselman.com/blog/VisualStudioProgrammerThemesGallery.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-26T12:44:13.353

您在 Vista 或 Server 2008 上运行，对吗？以管理员身份运行 Visual Studio（右键单击快捷方式并选择“以管理员身份运行”）。

VS2005 也会发生这种情况，只是它甚至不会费心指示失败。只要您关闭 Visual Studio，Vista 中的安全机制就会恢复您的设置。

# git - 樱桃选择合并

> ID：232771
> 
> 赞同：10
> 
> 时间：2008-10-24T07:41:36.453
> 
> 标签：git, version-control

假设分支 B 是分支 A 的主题分支，并且您希望在分支 C 中进行这些更改。当您将分支 A 和分支 B 的合并提交挑选到分支 C 时，这意味着什么？

例如，如果您使用 -m 标志来指定分支 A 的旧 HEAD 以樱桃选择合并到分支 C，这是否只是意味着“获取樱桃选择的提交树和分支 A 的旧 HEAD 之间的差异和将其应用于分支 C？”

使用这种方法有什么陷阱吗？（例如，分支 C 是否看起来像是合并到分支 A 和 B？会应用更多的更改而不是仅来自分支 B 的提交吗？）

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-24T07:49:08.497

我通常这样做的方式是使用[`git rebase`](http://git-scm.com/docs/git-rebase)：

```
git rebase --onto C A B 
```

这需要 A 和 B 之间的差异，并将这些差异应用于分支 C。作为奖励，rebase 将跳过 A 和 B 之间执行与分支 C 中已经存在的相同文本更改的任何提交。

更新：对于您在评论中提到的情况，请记住 Git 永远不会覆盖过去的历史记录。因此，即使在进行了上述变基之后，您也可以在 B 曾经在变基之前的提交处重新创建一个新的分支头。不幸的是，在早上的这个时候，我想不出一个简单的方法来做到这一点。抱歉，我无法提供更多帮助，也许其他人会想出一个简单的方法！

# javascript - 我可以使用 javascript 字符串中的内容触发完整的网页重新加载吗？

> ID：232775
> 
> 赞同：0
> 
> 时间：2008-10-24T07:46:38.283
> 
> 标签：javascript, ajax

这是 ajax “备用流程”问题之一。通常我希望我的 ajax 请求返回页面的一部分。但有时它可能会返回带有 html、head 和 body 标记的完整页面。

当我从我的 ajax 请求返回时，我可以检测这是否是一个完整的页面，但是是否可以根据我拥有的字符串内容触发一个完整的页面重新加载（具有完整的事件周期）？

（是的，我已经尝试替换 body 元素，但这并没有给我事件，也不允许我更改 head 块中的内容）

任何框架参考都可以

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-24T07:55:01.933

我认为直接做是不可能的。

您最好将 HTML 保存在某处并发送回一个可以检索它的 URL，然后使用`location.href = ...`;

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-24T08:47:50.347

[您可以根据AJAX 请求](http://www.prototypejs.org/api/ajax/request)的[HTTP 状态代码](http://en.wikipedia.org/wiki/List_of_HTTP_status_codes)来决定如何处理它。

如果您收到 301（“永久移动”），您可以使用以下命令进行重定向`window.location`：

```
new Ajax.Request(url, {
  method: 'get',
  // status 200: yadaa
  onSuccess: function(transport) {
    // doSomething
  },
  // status 301: moved permanently
  on301: function(transport){ 
    window.location = transport.responseText;
  }
}); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-24T08:13:55.467

至少在*Firefox*中，您可以使用[window.location](https://developer.mozilla.org/en/DOM/window.location)属性。*location*对象包含有关文档 URL 的信息，并提供更改该 URL 的方法。您还可以分配给此属性以加载另一个 URL。

文档中的一个例子：

```
Replace the current document with the one at the given URL:

function goMoz() { 
   window.location = "http://www.mozilla.org";
} 

// in html: <button onclick="goMoz();">Mozilla</button> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-20T09:13:34.413

window.location = "same-url-as-im-at.aspx";

...？

要直接使用 HTML 文档进行操作，如果我是您，我会*拼命*避免，因为您在原始问题中略过...

# c# - 使用复选框构建字符串

> ID：232781
> 
> 赞同：-1
> 
> 时间：2008-10-24T07:51:52.283
> 
> 标签：c#, visual-studio, checkbox

谁能告诉我如何使用复选框构建字符串。最好的方法是什么。

例如，我有 4 个复选框，每个复选框都有自己的值（valueA、valueB、valueC、valueD），我想在不同的行中显示每个结果。

选择 B & C 的结果：

值
B 值C

如果我将它保存到数据库中，我将如何再次显示它？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-24T08:07:10.130

使用 StringBuilder 构建字符串，并在每次追加时追加 Environment.NewLine：

```
StringBuilder builder = new StringBuilder();
foreach (CheckBox cb in checkboxes)
{
    if (cb.Checked)
    {
        builder.AppendLine(cb.Text); // Or whatever

        // Alternatively:
        // builder.Append(cb.Text);
        // builder.Append(Environment.NewLine); // Or a different line ending
    }
}
// Call Trim if you want to remove the trailing newline
string result = builder.ToString(); 
```

要再次显示它，您必须将字符串拆分为行，并检查每个复选框以查看其值是否在集合中。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-24T08:09:01.267

伪代码：

```
For each checkbox in the target list of controls
    append value and a newline character to a temporary string variable
output temporary string 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-24T08:06:26.887

```
"if I saved this into a database" ? 
```

如果您真的要在这里获得任何帮助，您需要更具体地处理您的家庭作业......

**编辑：**好的，它*可能*不是家庭作业，但它确实读起来像它——毕竟，操纵 GUI 来生成用户选择的视图是 Interfaces 101——即使它不是一个没有足够细节的可怕问题任何机会得到一个体面的答案。

# c - 在 C 中使用#pragma

> ID：232785
> 
> 赞同：125
> 
> 时间：2008-10-24T07:56:01.527
> 
> 标签：c, pragma

C中有什么用处`#pragma`，有例子吗？

* * *

## 回答 #1

> 赞同：74
> 
> 时间：2008-10-24T08:03:12.230

`#pragma`适用于特定于机器或特定于操作系统的编译器指令，即它告诉编译器做某事，设置一些选项，采取一些行动，覆盖一些默认值等，这些指令可能适用于也可能不适用于所有机器和操作系统。

有关详细信息，请参阅[msdn](http://msdn.microsoft.com/en-us/library/d9x1s805.aspx)。

* * *

## 回答 #2

> 赞同：58
> 
> 时间：2008-10-24T08:00:34.247

`#pragma`用于在 C 中做一些特定于实现的事情，即在当前上下文中务实而不是意识形态上的教条。

我经常使用的一个是`#pragma pack(1)`我试图在嵌入式解决方案上从我的内存空间中挤出更多的地方，其中的结构数组最终会以 8 字节对齐结束。

可惜我们还`#dogma`没有。这应该很有趣 ;）

* * *

## 回答 #3

> 赞同：38
> 
> 时间：2008-10-25T04:57:37.927

I would generally try to avoid the use of #pragmas if possible, since they're extremely compiler-dependent and non-portable. If you want to use them in a portable fashion, you'll have to surround every pragma with a `#if`/`#endif` pair. GCC discourages the use of pragmas, and really only supports some of them for compatibility with other compilers; GCC has other ways of doing the same things that other compilers use pragmas for.

For example, here's how you'd ensure that a structure is packed tightly (i.e. no padding between members) in MSVC:

```
#pragma pack(push, 1)
struct PackedStructure
{
  char a;
  int b;
  short c;
};
#pragma pack(pop)
// sizeof(PackedStructure) == 7 
```

Here's how you'd do the same thing in GCC:

```
struct PackedStructure __attribute__((__packed__))
{
  char a;
  int b;
  short c;
};
// sizeof(PackedStructure == 7) 
```

The GCC code is more portable, because if you want to compile that with a non-GCC compiler, all you have to do is

`#define __attribute__(x)`

Whereas if you want to port the MSVC code, you have to surround each pragma with a `#if`/`#endif` pair. Not pretty.

* * *

## 回答 #4

> 赞同：17
> 
> 时间：2008-10-24T07:58:38.387

放在`#pragma once`头文件的顶部将确保它只包含一次。请注意，这`#pragma once`不是标准 C99，但大多数现代编译器都支持。

另一种方法是使用包括警卫（例如`#ifndef MY_FILE #define MY_FILE ... #endif /* MY_FILE */`）

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2012-11-30T05:56:13.420

我觉得是`#pragma`一个指令，如果您希望代码特定于位置。比如说，您希望程序计数器从写入 ISR 的特定地址读取的情况，那么您可以在该位置指定 ISR，然后`#pragma vector=ADC12_VECTOR`使用中断轮播名称及其描述

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2008-10-25T04:47:56.323

我最好的建议是查看编译器的文档，因为根据定义，编译指示是特定于实现的。例如，在嵌入式项目中，我使用它们来定位不同部分的代码和数据，或声明中断处理程序。IE：

```
#pragma code BANK1
#pragma data BANK2

#pragma INT3 TimerHandler 
```

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2016-05-02T14:45:48.990

上面的所有答案都很好地解释了，`#pragma`但我想添加一个小例子

我只是想解释一个`simple OpenMP example`展示`#pragma`其工作的一些用途

> OpenMp`briefly`是一种多平台共享内存并行编程的实现（那么我们可以说它是`machine-specific`or `operating-system-specific`）

让我们来看例子

```
#include <stdio.h>
#include <omp.h>// compile with: /openmp

int main() {
   #pragma omp parallel num_threads(4)
   {
      int i = omp_get_thread_num();
      printf_s("Hello from thread %d\n", i);
   }
} 
```

输出是

```
Hello from thread 0
Hello from thread 1
Hello from thread 2
Hello from thread 3

Note that the order of output can vary on different machines. 
```

现在让我告诉你做了什么`#pragma`...

它告诉操作系统在 4 个线程上运行某些代码块

这只是你们中的一个`many many applications`可以用小东西做的事情`#pragma`

对不起外面的样品`OpenMP`

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2014-06-05T09:27:30.313

这是一个预处理器指令，可用于打开或关闭某些功能。

它有两种类型`#pragma startup`，`#pragma exit`和`#pragma warn`。

`#pragma startup`允许我们指定程序启动时调用的函数。

`#pragma exit`允许我们指定程序退出时调用的函数。

`#pragma warn`告诉计算机是否禁止任何警告。

许多其他`#pragma`样式可用于控制编译器。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2016-02-03T20:53:45.747

`#pragma startup`是一个指令，用于在主函数之前调用一个函数并在主函数之后调用另一个函数，例如

```
#pragma startup func1
#pragma exit func2 
```

在这里，先`func1`运行后运行。`main``func2`

注意：此代码仅适用于 Turbo-C 编译器。要在 GCC 中实现此功能，您可以`func1`这样声明`func2`：

```
void __attribute__((constructor)) func1();
void __attribute__((destructor)) func2(); 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2017-03-08T17:01:43.030

总而言之，`#pragma`告诉编译器做一些事情。以下是我使用它的几种方法：

*   `#pragma`可用于忽略编译器警告。例如，要让 GCC 对隐式函数声明闭嘴，你可以这样写：

    ```
    #pragma GCC diagnostic ignored "-Wimplicit-function-declaration" 
    ```

    较旧的版本[可移植](https://github.com/aaronryank/libportable/commit/6823a4f6cec2c36efa8d6004775dbd9e444f7570#diff-7952dc5980168aa9b8e5064c38af989eR107)[`libportable`](//github.com/aaronryank/libportable)地执行此操作。

*   `#pragma once`，当写在头文件的顶部时，将导致该头文件被包含一次。`libportable` [检查](https://github.com/aaronryank/libportable/blob/master/portable.h#L156)编译指示一旦支持。

# java - 评论框的边界

> ID：232811
> 
> 赞同：0
> 
> 时间：2008-10-24T08:14:34.640
> 
> 标签：java, graphics, comments

在我的 java 应用程序中，我需要创建一个评论框供用户添加评论。此外，我需要为用户提供调整大小和拖动评论框的功能。为此，我需要在注释框周围显示一个边界，就像下面显示的 Microsoft Excel 中的注释框一样：

![替代文字](https://lh3.ggpht.com/subinvarghesein/SQGDAcBgHjI/AAAAAAAAAJc/YVGvsQltkyk/boundary.jpg)

我不需要边界上显示的圆圈来调整大小，因为我将在框的右下角使用三角形的东西。但我需要虚线区域。

如何在 java 中为我的应用程序创建它？有什么好的想法吗？

* * *

目前我处于分析阶段，只是为了找到好的选择。到目前为止，我们一直在想的是在盒子周围画几条虚线来给人印象。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-10-02T17:33:38.687

我可能会考虑为此使用[JXLayer](https://jxlayer.dev.java.net/)。看起来您在这里尝试做的是在组件边界之外绘制一些上下文。这是 JXLayer 擅长的事情。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-24T10:56:50.757

这可能有点棘手。当你需要半透明边框时会很痛苦。如果没有，那很容易。只需使用带有适当组件和鼠标侦听器的弹出窗口来侦听活动边框上发生的鼠标事件。

# templates - StringTemplate 是否适用于 Struts？

> ID：232822
> 
> 赞同：1
> 
> 时间：2008-10-24T08:24:05.073
> 
> 标签：templates, struts, stringtemplate

我想在我的 struts Web 应用程序中使用模板引擎。因此我想使用 StringTemplate，但不知道如何在 Struts 中实现。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-10T14:57:19.320

我正在研究这将如何自己工作。看起来 Harry Karadimas[在这里](http://www.stringtemplate.org/share/1229347891527/st_struts_adapter_with_demo.0.2.zip)为 Struts 1.3 编写了一些代码。

请参阅 /doc 目录中的 usage.html。

# java - 如何从 SSL 证书中提取附加信息以允许访问 WAS 上的 WebService 客户端

> ID：232839
> 
> 赞同：2
> 
> 时间：2008-10-24T08:34:33.587
> 
> 标签：java, web-services, ssl, websphere

为了解释我的情况，我将从一个例子开始。

假设有两个具有受信任证书的 WS(WebService) 客户端 A 和 B。现在在正常执行中，当 A 和 B 都通过我的 Web 服务所在的 SSL 调用 WAS（Websphere 应用程序服务器）时，WAS 信任它们，因为它们的受信任证书并允许访问所需的 WS。

我们想要的是只允许 A 而不是 B 访问 WAS 上的 WS，因此在证书验证之后可以提取用户信息（从 WAS 管理员或 Java 方式），这些信息将映射到 WAS 中定义的用于访问 WS 的角色

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-24T08:45:03.440

听起来与其将其编程到应用程序中，不如使用撤销模型。SSL 的设计目的是让证书颁发机构（在这种情况下可能是您）可以撤销证书，那么为什么不使用它呢？

如果不知道您在哪个平台上或您如何进行所有 SSL 连接等，很难给您任何具体建议，但是设置一个中央 CA 来签署所有发出的证书并维护撤销列表听起来像它会工作得很好。您也不需要向应用程序添加任何内容（除了删除无效的 SSL 连接）。

# wcf-security - 实现基于声明的安全性 (WCF/ASP.NET)

> ID：232842
> 
> 赞同：6
> 
> 时间：2008-10-24T08:35:26.127
> 
> 标签：wcf-security, saml, federated-identity, geneva-framework, sts-securitytokenservice

在研究了基于声明的安全（或联合安全模型）的主题之后。我遇到过许多使用[CardSpace](http://en.wikipedia.org/wiki/Windows_CardSpace)作为示例的示例。我读到的主要文章对这个主题给出了很好的解释，它是Microsoft 在一个名为[Zermatt的框架上编写的](https://connect.microsoft.com/Downloads/Downloads.aspx?SiteID=642)[PDF](https://connect.microsoft.com/Downloads/DownloadDetails.aspx?SiteID=642&DownloadID=12901)。

我正在研究的基于声明的安全架构相当于实现[STS](http://msdn.microsoft.com/en-us/library/ff650503.aspx)身份验证代理和 STS 授权代理。这样，当我创建一个新服务时，我需要做的就是确保该服务只接受授权代理发出的声明。正如文章中所指出的，授权代理将只接受身份验证代理发出的声明。

设置完成后，任何时候客户端尝试使用新服务，它都必须通过***Authentication Broker*** **进行身份验证（发出经过身份验证的声明）**，然后通过 ***Authorization Broker*** **获得授权（发出经过授权的声明）**。

这一切都很好，而且架构很清晰，但我不知道如何实现 STS。正如我所提到的，网络上的大多数（如果不是全部）示例都展示了如何使用 CardSpace，但是当您有一个数据库备份您的身份验证方案时，这并不完全有效。

**示例场景**

[替代文字 http://img512.imageshack.us/img512/8329/claimsbasedsecurityza6.jpg](http://img512.imageshack.us/img512/8329/claimsbasedsecurityza6.jpg)

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-24T16:44:05.253

我想我找到了答案：D

[http://www.theserverside.net/tt/articles/showarticle.tss?id=ClaimsBasedSecurityModel](http://www.theserverside.net/tt/articles/showarticle.tss?id=ClaimsBasedSecurityModel) [http://www.theserverside.net/tt/articles/showarticle.tss?id=ClaimsBasedSecurityModel2](http://www.theserverside.net/tt/articles/showarticle.tss?id=ClaimsBasedSecurityModel2)

然后是在 PDC 上宣布的最新 Microsoft 日内瓦框架。非常适合我需要的东西。（现在如果只有我自己的答案被标记为答案：P）

[http://www.microsoft.com/geneva](http://www.microsoft.com/geneva)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-24T08:45:46.120

在 Windows 平台上实现 STS 的最佳方法是使用[AD FS](http://en.wikipedia.org/wiki/Active_Directory_Federation_Services)。

有关详细信息，请参阅此博客，[http://blogs.msdn.com/vbertocci/archive/2007/11/19/developing-a-minimal-sts-with-adfs-2-identity-framework-part-i-the- sts-itself.aspx](http://blogs.msdn.com/vbertocci/archive/2007/11/19/developing-a-minimal-sts-with-adfs-2-identity-framework-part-i-the-sts-itself.aspx)。

# asp.net - aspnet_regIIS.exe -i 不将 aspx 添加到脚本映射

> ID：232846
> 
> 赞同：0
> 
> 时间：2008-10-24T08:36:46.623
> 
> 标签：asp.net, asp.net-mvc, iis-6

安装 asp.net（和 aspnet_regIIS.exe -i）后，该站点不接受我的 default.aspx 页面。当尝试访问它时，我得到一个 404。当直接点击我的 mvc 页面（例如 /search.mvc）时，它就像一个魅力。

我们检查了网站配置并注意到 scriptmaps 节点中没有 .aspx 引用。

我错过了什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-24T09:52:01.510

我们手动添加了一个会话（对于 aspx.net），使用了错误的旧版本的 asp.net 引擎，然后运行了 aspnet_regiis.exe，现在它也添加了所有旧行。

不知道为什么，何时以及如何。神秘...

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-24T08:54:30.113

可能您缺少脚本映射中的 .aspx 引用。信噪比。;-)

更严重的是，它们是否存在于 IIS 管理器的“网站”属性级别？运行时得到的输出是什么`aspnet_regIIS.exe -i`？

我的说：

```
C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727>aspnet_regiis.exe -i
开始安装 ASP.NET (2.0.50727)。
.........................................
完成安装 ASP.NET (2.0.50727)。

C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727>

```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-24T09:16:17.980

不，aspx 的条目（以及链接到 asp.net 的许多其他扩展）不存在。既不是继承的（在“网站”级别），也不是网站本身的级别。

运行 aspnet_regIIS.exe -i 后，它返回到常规提示。

# c# - 用委托或 lambda 包装秒表计时？

> ID：232848
> 
> 赞同：98
> 
> 时间：2008-10-24T08:39:46.913
> 
> 标签：c#, .net, delegates, lambda

我正在编写这样的代码，做一些快速而肮脏的时间：

```
var sw = new Stopwatch();
sw.Start();
for (int i = 0; i < 1000; i++)
{
    b = DoStuff(s);
}
sw.Stop();
Console.WriteLine(sw.ElapsedMilliseconds); 
```

当然有一种方法可以将这段时间代码称为花哨的 .NET 3.0 lambda，而不是（上帝禁止）剪切和粘贴几次并替换**`DoStuff(s)`**为**`DoSomethingElse(s)`**?

我知道它可以做到，`Delegate`但我想知道 lambda 方式。

* * *

## 回答 #1

> 赞同：134
> 
> 时间：2008-10-24T08:55:21.813

扩展秒表类怎么样？

```
public static class StopwatchExtensions
{
    public static long Time(this Stopwatch sw, Action action, int iterations)
    {
        sw.Reset();
        sw.Start(); 
        for (int i = 0; i < iterations; i++)
        {
            action();
        }
        sw.Stop();

        return sw.ElapsedMilliseconds;
    }
} 
```

然后像这样调用它：

```
var s = new Stopwatch();
Console.WriteLine(s.Time(() => DoStuff(), 1000)); 
```

您可以添加另一个忽略“迭代”参数的重载，并使用一些默认值（如 1000）调用此版本。

* * *

## 回答 #2

> 赞同：37
> 
> 时间：2009-05-13T01:14:09.947

这是我一直在使用的：

```
public class DisposableStopwatch: IDisposable {
    private readonly Stopwatch sw;
    private readonly Action<TimeSpan> f;

    public DisposableStopwatch(Action<TimeSpan> f) {
        this.f = f;
        sw = Stopwatch.StartNew();
    }

    public void Dispose() {
        sw.Stop();
        f(sw.Elapsed);
    }
} 
```

用法：

```
using (new DisposableStopwatch(t => Console.WriteLine("{0} elapsed", t))) {
  // do stuff that I want to measure
} 
```

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-10-24T08:44:00.993

您可以尝试为您正在使用的任何类（或任何基类）编写扩展方法。

我会让电话看起来像：

```
Stopwatch sw = MyObject.TimedFor(1000, () => DoStuff(s)); 
```

然后是扩展方法：

```
public static Stopwatch TimedFor(this DependencyObject source, Int32 loops, Action action)
{
var sw = new Stopwatch();
sw.Start();
for (int i = 0; i < loops; ++i)
{
    action.Invoke();
}
sw.Stop();

return sw;
} 
```

任何从 DependencyObject 派生的对象现在都可以调用 TimedFor(..)。该函数可以很容易地调整以通过 ref 参数提供返回值。

--

如果您不希望将功能绑定到任何类/对象，您可以执行以下操作：

```
public class Timing
{
  public static Stopwatch TimedFor(Action action, Int32 loops)
  {
    var sw = new Stopwatch();
    sw.Start();
    for (int i = 0; i < loops; ++i)
    {
      action.Invoke();
    }
    sw.Stop();

    return sw;
  }
} 
```

然后你可以像这样使用它：

```
Stopwatch sw = Timing.TimedFor(() => DoStuff(s), 1000); 
```

如果做不到这一点，这个答案看起来有一些不错的“通用”能力：

[用委托或 lambda 包装秒表计时？](https://stackoverflow.com/questions/232848/wrapping-stopwatch-timing-with-a-delegate-or-lambda#232878)

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-10-24T08:58:42.600

前段时间我写了一个简单的 CodeProfiler 类，它包装了 Stopwatch 以使用 Action 轻松分析方法： [http ://www.improve.dk/blog/2008/04/16/profiling-code-the-easy-way](http://www.improve.dk/blog/2008/04/16/profiling-code-the-easy-way)

它还可以让您轻松地分析多线程代码。以下示例将使用 1-16 个线程分析操作 lambda：

```
static void Main(string[] args)
{
    Action action = () =>
    {
        for (int i = 0; i < 10000000; i++)
            Math.Sqrt(i);
    };

    for(int i=1; i<=16; i++)
        Console.WriteLine(i + " thread(s):\t" + 
            CodeProfiler.ProfileAction(action, 100, i));

    Console.Read();
} 
```

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2009-11-30T16:44:20.573

该类`StopWatch`不需要是`Disposed`或`Stopped`错误的。因此，*计时*某些*操作*的最简单代码是

```
public partial class With
{
    public static long Benchmark(Action action)
    {
        var stopwatch = Stopwatch.StartNew();
        action();
        stopwatch.Stop();
        return stopwatch.ElapsedMilliseconds;
    }
} 
```

示例调用代码

```
public void Execute(Action action)
{
    var time = With.Benchmark(action);
    log.DebugFormat(“Did action in {0} ms.”, time);
} 
```

我不喜欢将迭代包含在`StopWatch`代码中的想法。您始终可以创建另一个方法或扩展来处理执行`N`迭代。

```
public partial class With
{
    public static void Iterations(int n, Action action)
    {
        for(int count = 0; count < n; count++)
            action();
    }
} 
```

示例调用代码

```
public void Execute(Action action, int n)
{
    var time = With.Benchmark(With.Iterations(n, action));
    log.DebugFormat(“Did action {0} times in {1} ms.”, n, time);
} 
```

这是扩展方法版本

```
public static class Extensions
{
    public static long Benchmark(this Action action)
    {
        return With.Benchmark(action);
    }

    public static Action Iterations(this Action action, int n)
    {
        return () => With.Iterations(n, action);
    }
} 
```

和示例调用代码

```
public void Execute(Action action, int n)
{
    var time = action.Iterations(n).Benchmark()
    log.DebugFormat(“Did action {0} times in {1} ms.”, n, time);
} 
```

我测试了静态方法和扩展方法（结合迭代和基准测试），预期执行时间和实际执行时间的增量<= 1 ms。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-10-24T13:27:47.570

假设您只需要快速掌握一件事，这很容易使用。

```
 public static class Test {
    public static void Invoke() {
        using( SingleTimer.Start )
            Thread.Sleep( 200 );
        Console.WriteLine( SingleTimer.Elapsed );

        using( SingleTimer.Start ) {
            Thread.Sleep( 300 );
        }
        Console.WriteLine( SingleTimer.Elapsed );
    }
}

public class SingleTimer :IDisposable {
    private Stopwatch stopwatch = new Stopwatch();

    public static readonly SingleTimer timer = new SingleTimer();
    public static SingleTimer Start {
        get {
            timer.stopwatch.Reset();
            timer.stopwatch.Start();
            return timer;
        }
    }

    public void Stop() {
        stopwatch.Stop();
    }
    public void Dispose() {
        stopwatch.Stop();
    }

    public static TimeSpan Elapsed {
        get { return timer.stopwatch.Elapsed; }
    }
} 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-10-24T08:55:56.117

您可以重载许多方法来涵盖您可能想要传递给 lambda 的各种参数情况：

```
public static Stopwatch MeasureTime<T>(int iterations, Action<T> action, T param)
{
    var sw = new Stopwatch();
    sw.Start();
    for (int i = 0; i < iterations; i++)
    {
        action.Invoke(param);
    }
    sw.Stop();

    return sw;
}

public static Stopwatch MeasureTime<T, K>(int iterations, Action<T, K> action, T param1, K param2)
{
    var sw = new Stopwatch();
    sw.Start();
    for (int i = 0; i < iterations; i++)
    {
        action.Invoke(param1, param2);
    }
    sw.Stop();

    return sw;
} 
```

或者，如果必须返回值，您可以使用 Func 委托。如果每次迭代都必须使用唯一值，您还可以传入一个（或更多）参数数组。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-04-12T11:28:15.373

对我来说，扩展在 int 上感觉更直观一点，您不再需要实例化秒表或担心重置它。

所以你有了：

```
static class BenchmarkExtension {

    public static void Times(this int times, string description, Action action) {
        Stopwatch watch = new Stopwatch();
        watch.Start();
        for (int i = 0; i < times; i++) {
            action();
        }
        watch.Stop();
        Console.WriteLine("{0} ... Total time: {1}ms ({2} iterations)", 
            description,  
            watch.ElapsedMilliseconds,
            times);
    }
} 
```

使用以下示例：

```
var randomStrings = Enumerable.Range(0, 10000)
    .Select(_ => Guid.NewGuid().ToString())
    .ToArray();

50.Times("Add 10,000 random strings to a Dictionary", 
    () => {
        var dict = new Dictionary<string, object>();
        foreach (var str in randomStrings) {
            dict.Add(str, null);
        }
    });

50.Times("Add 10,000 random strings to a SortedList",
    () => {
        var list = new SortedList<string, object>();
        foreach (var str in randomStrings) {
            list.Add(str, null);
        }
    }); 
```

样本输出：

```
Add 10,000 random strings to a Dictionary ... Total time: 144ms (50 iterations)
Add 10,000 random strings to a SortedList ... Total time: 4088ms (50 iterations) 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-10-24T09:48:09.117

我喜欢使用 Vance Morrison 的 CodeTimer 类（来自 .NET 的性能专家之一）。

他在他的博客上发表了一篇题为“[快速轻松地测量托管代码：CodeTimers](http://blogs.msdn.com/vancem/archive/2006/09/21/765648.aspx) ”的帖子。

它包括很酷的东西，例如 MultiSampleCodeTimer。它会自动计算平均值和标准偏差，并且也很容易打印出你的结果。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2019-08-08T19:51:58.490

```
public static class StopWatchExtensions
{
    public static async Task<TimeSpan> LogElapsedMillisecondsAsync(
        this Stopwatch stopwatch,
        ILogger logger,
        string actionName,
        Func<Task> action)
    {
        stopwatch.Reset();
        stopwatch.Start();

        await action();

        stopwatch.Stop();

        logger.LogDebug(string.Format(actionName + " completed in {0}.", stopwatch.Elapsed.ToString("hh\\:mm\\:ss")));

        return stopwatch.Elapsed;
    }
} 
```

# sql-server - 导出报告 - Quest 在 SQL Server 上的聚焦

> ID：232849
> 
> 赞同：1
> 
> 时间：2008-10-24T08:41:09.877
> 
> 标签：sql-server, monitoring, spotlight

我正在一些 SQL Server 上设置一些监控。目前我们的环境使用 Hobbit 监控系统，但我们可能很快就会迁移到 Nagios。

一位 DBA 向我推荐了 Spotlight，它似乎是一款很棒的软件，但我想知道的是……

**是否可以将 Spotlight 配置为将其某些发现报告给另一个监控应用程序？**

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-24T10:06:47.080

Spotlight Product Architect here - 您的问题的答案取决于您想要多脏……

如果您不介意编写一些自己的代码，在一些指导下，您可以从历史存储库中以相对接近实时的速率提取受监控的数据。

或者您可以等到明年，届时我们可能会加入通过网络服务实时获取收集数据的功能。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-24T08:43:14.660

5 年多来我一直无法使用 Quest 套件

# language-agnostic - 斐波那契代码高尔夫

> ID：232861
> 
> 赞同：27
> 
> 时间：2008-10-24T08:49:38.843
> 
> 标签：language-agnostic, code-golf, fibonacci, rosetta-stone

以尽可能少的字符生成斐波那契数列。任何语言都可以，除了您使用一个运算符 定义的语言`f`，它会打印斐波那契数。

起点：**Haskell**中的**~~25~~ 14 个字符**：

 **~~`f=0:1:zipWith(+)f(tail f)`~~

```
f=0:scanl(+)1f 
```

* * *

## 回答 #1

> 赞同：43
> 
> 时间：2008-10-24T12:03:52.107

18个英文字符..

“斐波那契数列”

好吧，我失败了。:)

* * *

## 回答 #2

> 赞同：33
> 
> 时间：2008-10-24T11:30:12.030

[Golfscript](http://www.golfscript.com/)的 13 个字符：

```
2,~{..p@+.}do 
```

* * *

更新说明脚本的操作：

1.  `2,`制作一个数组`[0 1]`
2.  `~`将该数组放入堆栈
3.  因此，在我们运行 时`do`，我们以`0 1`(1 在堆栈顶部)开始堆栈

`do`循环：

1.  每个都`.`复制堆栈的顶部项目；在这里，我们这样做了两次（`0 1 1 1`在初始运行时留给我们）
2.  `p`打印最高值（留给我们`0 1 1`）
3.  `@`旋转堆栈中的顶部 3 个项目，以便第三个顶部位于顶部 ( `1 1 0`)
4.  `+`添加堆栈中的顶部 2 项（离开`1 1`）
5.  `.`复制顶部值，以便`do`循环可以检查其真实性（以确定是否继续）

在心理上跟踪这几个循环就足以告诉您这是生成斐波那契序列值所需的加法。

由于 GolfScript 有 bignums，所以永远不会出现整数溢出，因此循环结束时的栈顶值`do`永远不会为 0。因此，脚本将永远运行。

* * *

## 回答 #3

> 赞同：29
> 
> 时间：2010-06-12T15:38:32.887

# RePeNt, ~~9~~ , 8 个字符

```
1↓[2?+1] 
```

或 10 个打印字符：

```
1↓[2?+↓£1] 
```

运行使用：

```
RePeNt "1↓[2?+1]" 
```

RePeNt 是我编写的一种基于堆栈的玩具语言（并且仍在改进），其中所有运算符/函数/块/循环都使用逆波兰表示法 (RPN)。

```
Command      Explanation                                              Stack
-------      -----------                                              -----

1            Push a 1 onto the stack                                  1
↓            Push last stack value                                    1 1
[            Start a do-while loop                                    1 1
2?           Push a two, then pop the 2 and copy the last 2 stack     1 1 1 1
             items onto the stack
+            Add on the stack                                         1 1 2
↓£           Push last stack value then print it                      1 1 2
1            Push a 1 onto the stack                                  1 1 2 1
]            Pop value (1 in this case), if it is a 0 exit the loop   1 1 2
             otherwise go back to the loop start. 
```

答案在堆栈上，它自己构建起来像：

```
1 1
1 1 2
1 1 2 3
1 1 2 3 5 
```

它永远不会终止（它具有 C#/JAVA`do { } while(true)`循环的等价物），因为序列永远不会终止，但可以这样编写终止解决方案：

```
N_1↓nI{2?+} 
```

这是12个字符。

我想知道是否有人会读到这个:(

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2008-10-24T13:40:23.083

Perl 6 - 22 个字符：

```
sub f{1,1...{$^a+$^b}} 
```

* * *

## 回答 #5

> 赞同：14
> 
> 时间：2009-01-05T02:39:39.043

语言：C++ 编译器错误
字符：205

```
#define t template <int n> struct 
#define u template <> struct f
t g { int v[0]; };
t f { enum { v = f<n-1>::v + f<n-2>::v }; g<v> x;};
u<1> { enum { v = 1 }; };
u<0> { enum { v = 0 }; };
int main() { f<10> x; } 
```

* * *

## 回答 #6

> 赞同：11
> 
> 时间：2009-09-08T22:54:05.427

x86（C 可调用）实模式，14 字节。  输入是堆栈上的 n ，在 AX 中
返回 F [n 。]

```
59 31 C0 E3 08 89 C3 40 93 01 D8 E2 FB C3 
```

* * *

## 回答 #7

> 赞同：11
> 
> 时间：2010-05-25T01:07:00.940

[脑残](http://en.wikipedia.org/wiki/Brainfuck "脑残")，33个字符：

```
+.>+.[<[>+>+<<-]>.[<+>-]>[<+>-]<] 
```

* * *

## 回答 #8

> 赞同：10
> 
> 时间：2008-10-24T09:46:44.673

带 dc 的 22 个字符：

```
1[pdd5**v1++2/lxx]dsxx 
```

调用任一：

```
dc -e'1[pdd5**v1++2/lxx]dsxx'

```

或者：

```
echo '1[pdd5**v1++2/lxx]dsxx' | 直流

```

注意：不是我的作品，来自[perlmonks](http://www.perlmonks.com/?node_id=626425)。

* * *

## 回答 #9

> 赞同：9
> 
> 时间：2008-10-24T18:10:25.500

[J](http://www.jsoftware.com/)，非递归函数的 27 个字符：

```
f=:3 :'{:}.@(,+/)^:y(0 1x)' 
```

`+/`总结一个列表。
`(,+/)`将列表的总和附加到其尾部。
`}.@(,+/)`对一个列表求和，将一个元素附加到它的尾部，然后删除第一个元素。
`}.@(,+/)^:y`迭代上述函数`y`时间。
`}.@(,+/)^:y(0 1x)`将上述函数应用于列表`(0,1)`（`x`使其成为整数）。
`{:}.@(,+/)^:y(0 1x)`取上述输出列表的最后一个元素。
`f=:3 :'{:}.@(,+/)^:y(0 1x)'`定义`f`为一个变量上的函数`y`。

* * *

## 回答 #10

> 赞同：7
> 
> 时间：2008-10-24T12:38:09.260

作为记录：

*   Lua（66 个字符）：`function f(n)if n<2 then return n else return f(n-1)+f(n-2)end end`
*   JavaScript（41 个字符）：`function f(n){return n<2?n:f(n-1)+f(n-2)}`
*   Java（41 个字符）：`int f(int n){return n<2?n:f(n-1)+f(n-2);}`

我不太擅长超级简洁的语言... :-P

克里斯是对的，我只是采用了简单的递归算法。实际上，Lua 中的线性更短（多亏了多次赋值）！JavaScript 就没那么幸运了，Java 更糟糕，不得不声明 vars...

*   Lua（60 个字符）：`function f(n)a=1;b=0;for i=1,n do a,b=b,a+b end return b end`
*   JavaScript（60 个字符）：`function f(n){a=1;b=i=0;for(;i++<n;){x=a+b;a=b;b=x}return b}`
*   Java（71 个字符）：`int f(int n){int a=1,b=0,i=0;for(;i++<n;){int x=a+b;a=b;b=x;}return b;}`

我会用它来写 Lua 的代码，`local a,b=1,0`但它更长，所以让我们污染 _G！;-) JS 同上。

为了完整起见，这里是终端递归版本。Lua 的一个，使用尾调用，和线性的一样快（但是 69 个字符，它是最长的！） - 需要用三个参数调用它们，n,1,0。

*   Lua（69 个字符，更长！）：`function f(n,a,b)if n<1 then return b else return f(n-1,b,a+b)end end`
*   JavaScript（44 个字符）：`function f(n,a,b){return n<1?b:f(n-1,b,a+b)}`
*   Java（52 个字符）：`int f(int n,int a,int b){return n<1?b:f(n-1,b,a+b);}`

* * *

## 回答 #11

> 赞同：7
> 
> 时间：2008-10-24T13:09:27.340

评论后更正（感谢塞巴斯蒂安），这不是一个序列解决方案，所以我们在这里使用 42 个字符（包括 \n）：

```
def f(a=0,b=1):
 while 1:yield a;a,b=b,a+b 
```

* * *

## 下面的旧帖子

Python，38 个字符。

```
f=lambda n:n if n<2 else f(n-1)+f(n-2) 
```

不是那么短，但在我看来是最易读的：P

编辑：这是分析方法（如果有人需要在 python 中查看它:-)

```
f=lambda n:int(.5+(.5+5**.5/2)**n/5**.5) 
```

* * *

## 回答 #12

> 赞同：6
> 
> 时间：2008-10-30T13:38:54.320

Windows XP（和更高版本）批处理脚本。此批处理函数在给定单个参数 - 数量时，生成数量+1 斐波那契数并将它们作为字符串返回（BATCH 没有真正的集合）在变量 %r% （369 个字符或 347 个字符 - 如果我们删除缩进） ：

```
:f
    set i=0
    set r=1
    set n=1
    set f=0
    :l
        if %n% GTR %~1 goto e
        set f=%f% %r%
        set /A s=%i%+%r%
        set i=%r%
        set r=%s%
        set /A n+=1
        goto l
    :e
    set r=%f%
    exit /B 0 
```

这是完整的脚本，可以查看它的运行情况（只需将其复制粘贴到 CMD 或 BAT 文件中并运行它）：

```
@echo off
call :ff 0
call :ff 1
call :ff 2
call :ff 3
call :ff 5
call :ff 10
call :ff 15
call :ff 20
exit /B 0

:ff
    call :f "%~1"
    echo %~1: %r%
    exit /B 0

:f
    set i=0
    set r=1
    set n=1
    set f=0
    :l
        if %n% GTR %~1 goto e
        set f=%f% %r%
        set /A s=%i%+%r%
        set i=%r%
        set r=%s%
        set /A n+=1
        goto l
    :e
    set r=%f%
    exit /B 0 
```

* * *

## 回答 #13

> 赞同：6
> 
> 时间：2012-06-20T12:14:57.397

Microsoft Batch - 15 个字符

古老的挑战，但世界必须知道这是可能的：

```
%1
%0 %1%2 %1 # 
```

一元输出到 stderr，仅计算 # 个字符。根据主机系统的空间限制，它可能只产生前 14 个数字左右。

* * *

## 回答 #14

> 赞同：5
> 
> 时间：2008-12-29T02:13:56.317

### 语言：dc，字符数：20

更短的直流解决方案。

```
dc -e'1df[dsa+plarlbx]dsbx' 
```

* * *

## 回答 #15

> 赞同：5
> 
> 时间：2009-01-05T01:11:37.410

这是我最好的使用方案，45 个字符：

```
(let f((a 0)(b 1))(printf"~a,"b)(f b(+ a b))) 
```

* * *

## 回答 #16

> 赞同：5
> 
> 时间：2009-02-11T14:39:25.617

F＃：

```
(0,1)|>Seq.unfold(fun(a,b)->Some(a,(b,a+b))) 
```

44 个字符

* * *

## 回答 #17

> 赞同：4
> 
> 时间：2011-02-08T16:48:30.080

MS Excel：11 个字符：

```
=SUM(A1:A2) 
```

输入`1`前 2 个单元格，然后将上述公式放入单元格 A3。将公式复制到电子表格中。

由于第 74 行的浮点舍入而开始失去准确性。
超过 10^307 并`#NUM!`在第 1477 行溢出导致错误。

* * *

## 回答 #18

> 赞同：3
> 
> 时间：2008-10-24T18:32:41.773

生成斐波那契数列。序列 序列！

* * *

## 回答 #19

> 赞同：3
> 
> 时间：2008-10-30T12:15:34.847

红宝石（30 个字符）：

```
def f(n)n<2?n:f(n-1)+f(n-2)end 
```

* * *

## 回答 #20

> 赞同：3
> 
> 时间：2008-10-30T12:43:01.407

@Andrea Ambu

迭代 pythonic`fibonacci()`的版本应该是这样的：

```
def fibonacci(a=0, b=1):
    while True:
        yield b
        a, b = b, a+b 
```

* * *

## 回答 #21

> 赞同：3
> 
> 时间：2009-01-04T23:22:42.373

**C＃**

我看到很多答案实际上并没有生成序列，而是使用递归只给你位置 *n 的斐波那契数，当循环生成序列时，在*n*的较高值下会变得越来越慢。

```
using System;
static void Main()
{
  var x = Math.Sqrt(5);
  for (int n = 0; n < 10; n++)
    Console.WriteLine((Math.Pow((1 + x) / 2, n) - Math.Pow((1 - x) / 2, n)) / p) ;
} 
```

* * *

## 回答 #22

> 赞同：3
> 
> 时间：2009-06-29T07:40:00.770

```
let rec f l a b =function 0->a::l|1->b::l|n->f (a::l) b (a+b) (n-1) in f [] 1 1;; 
```

80 个字符，但在线性时间内真正生成了序列。

* * *

## 回答 #23

> 赞同：2
> 
> 时间：2009-09-08T22:04:33.700

Lua - 49 个字符

```
function f(n)return n<2 and n or f(n-1)+f(n-2)end 
```

* * *

## 回答 #24

> 赞同：2
> 
> 时间：2009-10-10T19:49:26.933

# [Befunge-93](http://en.wikipedia.org/wiki/Befunge)

## 31 个字符

将输出斐波那契数的无限列表，从 0 向上，用制表符分隔（可以通过`9,`在第一行中删除来减少到 29 个字符，代价是数字之间没有空格）。

不幸的是，我尝试过的所有 Befunge-93 解释器似乎在 65k 之后溢出，因此输出仅在 46368 （即**F** [24]）之前是正确的。

```
#v::1p1>01g:.\:01p+9,#
 > ^

```

[确认可以与Javascript 中的 Befunge-93 解释器](http://www.quirkster.com/js/befunge.html)和[Visual Befunge Applet Full](http://www.ashleymills.com/?q=befunge_applet_full)一起工作（上面有警告）。

我很自豪地说这是一部完全原创的作品（即我没有从任何人那里复制这段代码），而且它比[目前在 Rosetta Code 上的 Befunge 解决方案](http://rosettacode.org/wiki/Fibonacci_sequence#Befunge)要短得多。

* * *

## 回答 #25

> 赞同：2
> 
> 时间：2010-06-14T20:24:25.317

大脑F**k：

```
>+++++>+>+<[[>]<<[>>+>+<<<-]>>>[<<<+>>>-]<<[>+>+<<-]>>[<<+>>-]<[<]>-] 
```

这将生成前 5。要生成更多，请将开头的 5 + 替换为更多：例如：

```
>++++++++++++++++++++++>+>+<[[>]<<[>>+>+<<<-]>>>[<<<+>>>-]<<[>+>+<<-]>>[<<+>>-]<[<]>-] 
```

* * *

## 回答 #26

> 赞同：1
> 
> 时间：2008-10-24T14:55:38.453

不是最短的，而是发帖时最快的。:-)

```
float f(float n) {
    return (pow(1+sqrt(5.0))/2.0),n) - pow(1+sqrt(5.0))/2.0),n)/sqrt(n));
} 
```

* * *

## 回答 #27

> 赞同：1
> 
> 时间：2008-10-24T18:27:17.310

C中的33个字符：

```
F(n){return n<2?n:F(n-1)+F(n-2);}
```

* * *

## 回答 #28

> 赞同：1
> 
> 时间：2008-11-06T21:57:19.877

Delphi Prism（Delphi for .net）

```
f:func<int32,int32>:=n->iif(n>1,f(n-1)+f(n-2),n) 
```

49 个字符

* * *

## 回答 #29

> 赞同：1
> 
> 时间：2008-12-01T21:27:22.670

前面的 Ruby 示例在没有分号或换行符的情况下都不起作用，因此它实际上是 32 个字符。这是实际输出序列的第一个示例，而不仅仅是返回指定索引的值。

Ruby：
53 个字符，包括换行符：

```
def f(n);n<2?1:f(n-1)+f(n-2);end
0.upto 20 {|n|p f n} 
```

或者，如果您想要输出可用数据结构的函数，71 个字符：

```
def f(n);n<2?1:f(n-1)+f(n-2);end
def s(n);(0..n).to_a.map {|n| f(n)};end 
```

或接受命令行参数，70 个字符：

```
def f(n);n<2?1:f(n-1)+f(n-2);end
p (0..$*[0].to_i).to_a.map {|n| f(n)} 
```

* * *

## 回答 #30

> 赞同：1
> 
> 时间：2010-06-12T15:55:45.793

PDP-11 汇编器（[来源](http://cubbi.com/fibonacci/asm.html)）

```
 .globl  start
    .text
start:
    mov $0,(sp)
    mov $27,-(sp)
    jsr pc, lambda
print_r1:
    mov $outbyte,r3
div_loop:
    sxt r0
    div $12,r0
    add $60,r1
    movb    r1,-(r3)
    mov r0,r1
    tst r1
    jne div_loop
    mov $1,r0
    sys 4; outtext; 37
    mov $1,r0
    sys 1
lambda:
    mov 2(sp),r1
    cmp $2,r1
    beq gottwo
    bgt gotone
    sxt r0
    div $2,r0
    tst r1
    beq even
odd:
    mov 2(sp),r1
    dec r1
    sxt r0
    div $2,r0
    mov r0,-(sp)
    jsr pc,lambda
    add $2,sp
    mov r0,r3
    mov r1,r2
    mov r3,r4
    mul r2,r4
    mov r5,r1
    mov r3,r4
    add r2,r4
    mul r2,r4
    add r5,r1
    mul r3,r3
    mov r3,r0
    mul r2,r2
    add r3,r0
    rts pc
even:
    mov 2(sp),r1
    sxt r0
    div $2,r0
    dec r0
    mov r0,-(sp)
    jsr pc,lambda
    add $2,sp
    mov r0,r3
    mov r1,r2
    mov r2,r4
    mul r2,r4
    mov r5,r1
    mov r2,r4
    add r3,r4
    mul r4,r4
    add r5,r1
    mov r2,r4
    add r3,r4
    mul r2,r4
    mov r5,r0
    mul r2,r3
    add r3,r0
    rts pc
gotone:
    mov $1,r0
    mov $1,r1
    rts pc
gottwo:
    mov $1,r0
    mov $2,r1
    rts pc

    .data
outtext:
    .byte 62,63,162,144,40,106,151,142,157,156
    .byte 141,143,143,151,40,156,165,155
    .byte 142,145,162,40,151,163,40
    .byte 60,60,60,60,60
outbyte:
    .byte 12 
```

* * *

## 回答 #31

> 赞同：1
> 
> 时间：2011-01-30T09:35:46.200

### J - 20 个字符

前*n*项：

```
(+/@(2&{.),])^:n i.2 
```

* * *

## 回答 #32

> 赞同：1
> 
> 时间：2011-07-10T05:27:26.970

很老的帖子但是

`f(){int cn=2,*n=calloc(9,9);n[1]=1;while(cn<32)printf("%d ",n[cn]=n[cn-1]+n[cn++-2]);}` C 中的 85 个字符。

* * *

## 回答 #33

> 赞同：0
> 
> 时间：2009-09-08T21:56:21.213

**欣快感：44 个字符**

```
object f=1&1 loop do f&=f[$]+f[$-1]until 0 
```

继续生成直到 RAM 或双倍用完。

* * *

## 回答 #34

> 赞同：0
> 
> 时间：2009-09-08T23:15:14.757

清醒的

```
f = 1 fby 1 fby f + prev f; 
```

27 个字符，包括空格。

* * *

## 回答 #35

> 赞同：0
> 
> 时间：2009-09-09T14:52:10.913

雷克斯：

arg n;a=1;b=1;do i=1 to n;say ab;a=a+b;b=a+b;end

* * *

## 回答 #36

> 赞同：0
> 
> 时间：2010-06-30T04:52:53.097

Java 迭代 (73)

```
void f(int n){for(int a=1,b=1;n-->0;b=a+(a=b)){System.out.print(a+",");}} 
```

红宝石 (46)

```
def f(n);a,b=1,1;1.upto(n){p a;b=a+(a=b);};end 
```

**更新**：红宝石（42）

```
def f(n);a=b=1;n.times{p a;b=a+(a=b);};end 
```

# c# - C# 事件处理程序

> ID：232863
> 
> 赞同：9
> 
> 时间：2008-10-24T08:50:35.300
> 
> 标签：c#, windows, events

如果 button.Click 事件有任何关联的处理程序，我如何检查 C#？If (button.Click != null) 抛出编译错误。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-10-24T08:52:41.707

你不能。事件只是公开“添加处理程序”和“删除处理程序”——仅此而已。（事实上​​，在 CLR 中，您还可以使用元数据将方法与“触发事件”相关联，但 C# 编译器从不生成它。）一些事件发布者可能会提供额外的方法来检查是否有任何订阅者（或者确实让您会看到那些订阅者），但它不是事件模式本身的一部分。

有关更多信息，请参阅[我关于事件的文章](http://pobox.com/~skeet/csharp/events.html)，或查看[事件](https://stackoverflow.com/questions/tagged/events)标签（我将添加到此问题中）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-24T09:20:10.297

你为什么需要这个？上下文是什么？也许有更好的方法来实现结果
按钮是一个外部对象，您要做的是检查它的内部订阅者列表而不询问它。它违反了封装。
您应该始终让对象管理其公开的事件的订阅者。如果它想让客户知道，它会公开一个 HasClientsRegistered 方法。不要闯入。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-06-29T08:21:50.210

EventDescriptor e = TypeDescriptor.GetEvents(yourObject).Find("yourEventName", true);

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-24T09:29:12.430

如果你在引发事件的班级，我想你可以。

您可以定义处理程序并枚举每个处理程序。

例如，如果您的事件被定义为

```
event System.EventHandler NewEvent; 
```

然后在你可能创建的 raise 事件方法上，你可以做......

```
 EventHandler handler = NewEvent;
    if(handler != null)
    {
      handler(this, e);
    } 
```

这将为您提供处理程序，并且您可以从中获取调用列表。

# vb6 - 真正有用的VB6源代码

> ID：232864
> 
> 赞同：8
> 
> 时间：2008-10-24T08:51:37.157
> 
> 标签：vb6

这不是一个问题，但我想我会开始一个线程，其中可以放置指向非常有用（且广泛适用）的 vb6 代码的链接。

我的选择是由一个叫 John Korejwa 的人选择的，它位于 Planet 源代码上

[http://www.planet-source-code.com/vb/scripts/ShowCode.asp?txtCodeId=50065&lngWId=1](http://www.planet-source-code.com/vb/scripts/ShowCode.asp?txtCodeId=50065&lngWId=1)

基本上它所做的是克服 vb6 中的一个严重缺陷，而不求助于 3rd 方组件

在vb6中图片只能存储为位图。如果您的应用程序涉及捕获和存储图像（例如文档扫描），则与将图像存储为 jpg 相比，这可能需要更大的硬盘空间。

这就是此源代码通过包含 jpeg 压缩代码的单个类提供的内容。

这个限制是 vb 论坛上无数问题的原因，但这是我发现的唯一一个仅使用 vb6 程序中的代码就可以解决问题的代码。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-24T11:07:20.390

[http://www.vbaccelerator.com/home/index.asp](http://www.vbaccelerator.com/home/index.asp)

更有用的 VB6 代码，然后你可以在 :) 上摇一摇

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-28T18:25:58.797

[卡尔·彼得森的网站](http://vb.mvps.org/samples/)

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-01-22T05:49:15.917

[Edanmo 的有用免费 vb 控件列表](http://www.mvps.org/emorcillo/en/code/vb6/index.shtml)。

我特别喜欢 Unicode 兼容的 Richedit 控件。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2010-07-27T16:50:05.493

当我在[另一个线程](https://stackoverflow.com/questions/3343380/is-there-any-book-like-c-in-depth-for-vb-net-devs/3343483#3343483)中提到时，Mark J 建议我把它移到这里。如果您想进行高速 Visual Basic 编程，这仍然是一个极好的资源。最初的意思是某种竞争（有或没有“兴奋剂”），它从核心显示了 VB6 的真正优势和劣势。

[XBeat.net 上的 VBSpeed](http://www.xbeat.net/vbspeed/)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-10T16:08:58.637

[在重新发明轮子之前， FreeVBCode.com](http://www.freevbcode.com/)一直是我最喜欢看的地方。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-12T19:55:14.160

[VBNet](http://vbnet.mvps.org/)有很多有用的东西。绝对支持 VBAccelerator 和 Karl Paterson 网站上的议案。

# linux - 如何建立计算云以及它是如何工作的？

> ID：232866
> 
> 赞同：1
> 
> 时间：2008-10-24T08:53:53.000
> 
> 标签：linux, amazon-ec2, cloud, xen

是否可以将所有硬件节点的所有计算能力分配给一个实例（例如，一个基本的 linux 安装）？

如何管理云？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-24T09:30:28.467

我认为您在这里混淆了云计算和网格计算。虽然它们确实有相似之处。

云计算通常用于指数据存储在 Internet 上某处并在任何在线工作站上可用的解决方案。

网格计算用于指代许多不同代理并行解决同一计算问题的一部分的应用程序。（想想 Seti-at-home 或 fold-at-home）

但是您不能使用云或网格计算来无缝地运行现有平台。两者都指架构。有几个平台是这些架构的通用实现，但它们是如此不同，以至于您无法在它们上轻松运行不是为分布式运行而设计的软件。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-24T19:22:17.353

如果它是您想要设置的集群（或网格），我强烈推荐[Rocks](http://www.rocksclusters.org/)。您将它安装在您用作主机的一台计算机上。所有其他节点都已启动，但您不需要知道这一点，因为 Rocks 会为您配置所有这些。

Rocks 附带了运行完整集群或网格所需的所有库和管理应用程序，例如[Fermilab](http://www.fnal.gov/)就使用它。我最近一直在使用它来安装一个 1200 多个节点（10.000 个内核！）集群！而且我仍然会在 4 节点集群上使用它，因为安装 master 不需要额外的工作量，并且您可以免费在所有其他机器上安装！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-24T09:51:19.080

对于云计算的辩护，我喜欢[吹飞镖在这里的回复](https://stackoverflow.com/questions/108037/what-is-cloud-computing#108042)，它基本上是使用在线资源，所以你不是在局域网上自己分配资源，而是使用第三方服务（比如亚马逊/谷歌，也许微软很快？）访问处理和存储，您可以在需要时进行扩展。为云开发与普通开发完全不同。

你基本上可以从一个节点开始（比如一个亚马逊 EC2 实例和一个 S3 帐户），如果你需要更多的处理能力，你可以设置一个进程来启动更多实例，但它们仍然是运行不同的虚拟服务器要么相同，要么许多不同的图像。您不能将云（或网格）视为一种基本的 linux 安装。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-09-15T18:55:12.180

有趣的回应。我正在运行所谓的云设置。基本上，我有一台主服务器 15GB RAM 和 1TB HDD，因为 MYSQl 的社区版本无法使用远程文件进行存储，所以我的 mysql 服务器运行在这台服务器上。在 Web 服务器和处理方面，还有 5 台其他服务器以相同的规格运行，它们的唯一目的是为单个域提供网页服务。它上面的软件使用apache服务器，我不确定软件管理器叫什么，我会回来的...但是每个服务器处理相同的页面，这很像并行处理，获取解码和执行. 除了有不止一台服务器在做同样的事情。如前所述，网格和云计算都是架构概念。这个概念让微软等公司，google 和 yahoo 以及 facebook 和 weem.me 等等，运行网站如此之快。一个很好的例子是谷歌，他们可以如此快速地提供页面，但流量却如此之大。它的基础是多个服务器并行工作以实现相同的目标，并且这样做允许可扩展性和强大的计算能力。

# html - 尝试将单选输入（+标签）添加到示例表单

> ID：232869
> 
> 赞同：0
> 
> 时间：2008-10-24T08:55:20.797
> 
> 标签：html, css, xhtml

```
<style type="text/css">
body {
    font-family:Helvetica, sans-serif; 
    font-size:12px;
}
p,
h1,
form,
button {
  border: 0;
  margin: 0;
  padding: 0;
}
.spacer {
  clear: both;
  height: 1px;
}
/* ----------- My Form ----------- */
.myform {
    margin: 0 auto;
    width: 400px;
    padding: 14px;
}
    /* ----------- basic ----------- */
    #basic {
        border: solid 2px #DEDEDE;
    }
    #basic h1 {
        font-size: 14px;
        font-weight: bold;
        margin-bottom: 8px;
    }
    #basic p {
        font-size: 11px;
        color: #666666;
        margin-bottom: 20px;
        border-bottom: solid 1px #dedede;
        padding-bottom: 10px;
    }
    #basic label {
        display: block;
        font-weight: bold;
        text-align: right;
        width: 140px;
        float: left;
    }
    #basic .small{
        color:#666666;
        display:block;
        font-size:11px;
        font-weight:normal;
        text-align:right;
        width:140px;
    }
    #basic input{
        float:left;
        width:200px;
        margin:2px 0 30px 10px;
    }
    #basic button{ 
        clear:both;
        margin-left:150px;
        background:#888888;
        color:#FFFFFF;
        border:solid 1px #666666;
        font-size:11px;
        font-weight:bold;
        padding:4px 6px;
    }
</style>

<div id="basic" class="myform">
  <form id="form1" name="form1" method="post" action="">
    <h1>Sign-up form</h1>
    <p>This is the basic look of my form without table</p>
    <label>Name
        <span class="small">Add your name</span>
    </label>
    <input type="text" name="textfield" id="textfield" />

    <label>Email
    <span class="small">Add a valid address</span>
    </label>
    <input type="text" name="textfield" id="textfield" />

    <label>Email
    <span class="small">Add a valid address</span>
    </label>
    <!-- Problem --->
    <input type="radio" name="something" id="r1" class="radio" value="1" /><label for="r1">One</label>
    <input type="radio" name="something" id="r2" class="radio" value="2" /><label for="r2">Two</label>
    <!-- Problem --->
    <button  type="submit">Sign-up</button>
    <div class="spacer"></div>

  </form>
</div> 
```

我收到了这个示例表单，但是我无法添加单选按钮，否则它们会被弄乱。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-24T09:18:40.267

您已经将表单输入全部设置为相同宽度（200 像素）并且向左浮动，这也适用于单选按钮。

这样的事情应该让你朝着正确的方向前进

```
<style type="text/css">
body{
    font-family:Helvetica, sans-serif; 
    font-size:12px;
}
p, h1, form, button{border:0; margin:0; padding:0;}
.spacer{clear:both; height:1px;}
/* ----------- My Form ----------- */
.myform{
    margin:0 auto;
    width:400px;
    padding:14px;
}
    /* ----------- basic ----------- */
    #basic{
        border:solid 2px #DEDEDE;
    }
    #basic h1 {
        font-size:14px;
        font-weight:bold;
        margin-bottom:8px;
    }
    #basic p{
        font-size:11px;
        color:#666666;
        margin-bottom:20px;
        border-bottom:solid 1px #dedede;
        padding-bottom:10px;
    }
    #basic label{
        font-weight:bold;
        text-align:right;
        width:140px;
        float:left;
    }
    #basic .small{
        color:#666666;
        display:block;
        font-size:11px;
        font-weight:normal;
        text-align:right;
        width:140px;
    }
    #basic input{
        float:left;
        width:200px;
        margin:2px 0 30px 10px;
    }
    #basic button{ 
        clear:both;
        margin-left:150px;
        background:#888888;
        color:#FFFFFF;
        border:solid 1px #666666;
        font-size:11px;
        font-weight:bold;
        padding:4px 6px;
    }
    #basic input.radio{
        width:50px;
        margin:2px 0 30px 10px;
    }
    #basic label.radio {
    width:40px;
    text-align:left;
    }
</style>

<div id="basic" class="myform">
  <form id="form1" name="form1" method="post" action="">
    <h1>Sign-up form</h1>
    <p>This is the basic look of my form without table</p>
    <label>Name
        <span class="small">Add your name</span>
    </label>
    <input type="text" name="textfield" id="textfield" />

    <label>Email
    <span class="small">Add a valid address</span>
    </label>
    <input type="text" name="textfield" id="textfield" />

    <label>Email
    <span class="small">Add a valid address</span>
    </label>
    <!-- Problem --->
    <input type="radio" name="r1" id="r1" class="radio" value="1" /><label class="radio" for="r1">One</label>
    <input type="radio" name="r2" id="r2" class="radio" value="2" /><label class="radio" for="r2">Two</label>
    <!-- Problem --->
    <button  type="submit">Sign-up</button>
    <div class="spacer"></div>

  </form>
</div> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-24T09:22:55.203

（在样式标签内）添加这些新的样式规则：

```
#basic input.radio
{
    width:20px;

}
#basic label.radiolabel
{
    width:40px;
    text-align:left;
    line-height:24px;
} 
```

在您的 html 中：

为每个标签添加一个新类，如下所示：

```
<!-- Problem --->    
<input type="radio" name="textfield" id="r1" class="radio" value="1" />
<label for="r1" class="radiolabel">One</label>    
<input type="radio" name="textfield" id="r2" class="radio" value="2" />
<label for="r2" class="radiolabel">Two</label>    
<!-- Problem ---> 
```

编辑：为标签的样式添加行高:)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-24T09:17:57.633

根据规范，允许将表单输入元素放在引用它们的标签内，例如，

```
<label for="input">Label: <input type="radio" id="input" name="input" /></label> 
```

看看这是否让造型变得更容易。（它应该。）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-24T08:58:51.947

您将它们命名为与文本输入相同的名称 - 更改`name="textfield"`为`name="my_radio"`

您也没有输入电子邮件地址，因此您的标签与输入不同步

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-24T09:11:54.463

您的样式#basic input 为表单内的所有输入字段提供200px 的宽度，包括您的单选按钮，创建一个新样式，如#basic input.radio，并为单选按钮提供一个单独的宽度，如20px（确保你把这个在#basic 输入样式之后），您还必须为与单选按钮链接的标签指定更小的宽度，向它们添加一个类并将它们的宽度减小到 40 像素。

然后单选按钮及其相关标签应彼此对齐。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-24T10:00:18.920

要解决您的布局问题，请添加以下 CSS：

```
#basic input.radio { width:20px; } 
```

这将修复单选按钮的巨大宽度——它们的宽度来自

```
#basic input { width:200px;} 
```

正在使所有输入宽 200 像素。

总的来说，ID 和类的应用并没有真正促进重用，但这是另一个问题。

# .net - 如何在 Visual Studio 解决方案文件中设置默认配置？

> ID：232881
> 
> 赞同：18
> 
> 时间：2008-10-24T08:59:18.717
> 
> 标签：.net, visual-studio, visual-studio-2010, visual-studio-2008, target-platform

在 VS2005 及更高版本中，是否可以指定默认选择哪个配置？

我的解决方案中有几种配置，但在大多数情况下应该使用其中一种。因此，我想确保将其从源代码控制中提取出来的开发人员使用正确的配置（当然，除非他们专门选择了另一个配置）。

理想情况下，此设置应位于 .sln 文件中，因为该文件位于源代码管理之下。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-12-03T22:52:43.387

据我了解，如果没有 .suo 文件，则按字母顺序排列的第一个平台成为默认配置。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2015-07-20T18:59:55.010

这已经很老了，但这对我很有帮助：

默认情况下，它选择其平台作为混合平台。如果不存在，它会选择 .sln 文件中列出的第一个。

默认配置是以 . 开头的`Debug`。所以如果你有一个叫做 的东西`Debug Test`，它会选择那个。如果不存在，它会在您的 .sln 文件中按顺序排列。它不会`Test Debug`接过来`Debug`。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-23T22:57:41.973

我不知道我是否了解您问题背后的完整情况，但是有一种方法可以将 VS.Net 的一些项目配置值（例如 FxCop 设置）“外部化”到单独的文件中。然后，您可以让解决方案中的所有项目都指向该文件。但是，我认为它不允许您的开发人员在进行“外部化”之后选择他们自己的配置

如果这对您来说似乎是正确的道路，请查看我的这些关于如何对配置进行类似更改的编码标准的帖子。

*   [我的西雅图代码营关于编码标准和代码审查的演示文稿](http://jb-brown.blogspot.com/2008/11/seattle-code-camp-presentation.html)
*   [自动化标准和最佳实践](http://jb-brown.blogspot.com/2008/07/automating-checking-of-standards-and.html)

# oop - 面向方面编程与面向对象编程

> ID：232884
> 
> 赞同：218
> 
> 时间：2008-10-24T09:00:46.373
> 
> 标签：oop, aop, paradigms

像这里和全世界的大多数开发人员一样，多年来我一直在使用面向对象编程 (OOP) 技术开发软件系统。因此，当我读到面向方面编程 (AOP) 解决了许多传统 OOP 无法完全或直接解决的问题时，我停下来想，这是真的吗？

我已经阅读了很多信息，试图学习这种 AOP 范式的关键，并且我在同一个地方，所以，我想更好地了解它在现实世界应用程序开发中的好处。

有人有答案吗？

* * *

## 回答 #1

> 赞同：351
> 
> 时间：2008-10-24T09:21:17.003

为什么是“对”？这不是“对”。您可以将面向方面的编程与函数式编程结合使用，也可以与面向对象的编程结合使用。这不是“vs”，而是“面向方面的编程**与**面向对象的编程”。

对我来说，AOP 是某种“元编程”。AOP 所做的一切也可以通过添加更多代码来完成。AOP 只是节省了您编写此代码的时间。

维基百科有这种元编程的最佳示例之一。假设您有一个带有许多“set...()”方法的图形类。每次设置方法后，图形的数据都发生了变化，因此图形发生了变化，因此需要在屏幕上更新图形。假设要重新绘制图形，您必须调用“Display.update()”。*经典的方法是通过添加更多代码*来解决这个问题。在您编写的每个 set 方法的末尾

```
void set...(...) {
    :
    :
    Display.update();
} 
```

如果你有 3 个设置方法，那不是问题。如果你有 200 个（假设的），那么到处添加它会变得非常痛苦。此外，每当您添加新的 set-method 时，您必须确保不要忘记将其添加到末尾，否则您只是创建了一个错误。

AOP 在不添加大量代码的情况下解决了这个问题，而是添加了一个方面：

```
after() : set() {
   Display.update();
} 
```

就是这样！无需自己编写更新代码，您只需告诉系统在到达 set() 切入点后，它必须运行此代码，它将运行此代码。无需更新 200 个方法，无需确保您不会忘记在新的 set-method 上添加此代码。此外，您只需要一个切入点：

```
pointcut set() : execution(* set*(*) ) && this(MyGraphicsClass) && within(com.company.*); 
```

这意味着什么？这意味着如果一个方法被命名为“set*”（* 表示任何名称可能在 set 之后跟随），无论该方法返回什么（第一个星号）或它采用什么参数（第三个星号）*，并且*它是 MyGraphicsClass 的一个方法，*并且*这个class 是包“com.company.*”的一部分，那么这是一个 set() 切入点。我们的第一个代码说“*在*运行任何设置切入点的方法后，运行以下代码”。

看看 AOP 如何优雅地解决这里的问题？实际上这里描述的一切都可以在编译时完成。AOP 预处理器甚至可以在编译类本身之前修改您的源代码（例如，将 Display.update() 添加到每个设置切入点方法的末尾）。

然而，这个例子也显示了 AOP 的一大缺点。AOP 实际上正在做一些许多程序员认为是“**[反模式](http://en.wikipedia.org/wiki/Anti-pattern)**”的事情。确切的模式称为“[远距离行动](http://en.wikipedia.org/wiki/Action_at_a_distance_(computer_science))”。

> 远距离动作是一种反模式（一种公认的常见错误），其中程序的一个部分中的行为会根据程序另一部分中难以或不可能识别的操作而发生巨大变化。

作为一个项目的新手，我可能只是阅读任何设置方法的代码并认为它​​已损坏，因为它似乎没有更新显示。我看**不到**set-method 的代码，在它执行之后，其他一些代码将“神奇地”执行以更新显示。我认为这是一个严重的缺点！通过对方法进行更改，可能会引入奇怪的错误。进一步理解某些事情似乎可以正常工作但并不明显的代码流（正如我所说，它们只是神奇地工作......不知何故），真的很难。

## 更新

澄清一下：有些人可能会觉得我说 AOP 是不好的东西，不应该使用。这不是我要说的！AOP 实际上是一个很棒的功能。我只是说“小心使用”。*如果您将普通代码和 AOP 混为一谈， AOP*只会导致问题。在上面的示例中，我们具有更新图形对象的值并绘制更新后的对象的方面。这实际上是一个方面。将其中的一半编码为普通代码，将另一半编码为方面是增加问题的原因。

如果您将 AOP 用于完全不同的方面，例如用于日志记录，您将不会遇到反模式问题。在这种情况下，该项目的新手可能想知道“所有这些日志消息来自哪里？我在代码中没有看到任何日志输出”，但这不是一个大问题。他对程序逻辑所做的更改几乎不会破坏日志设施，对日志设施所做的更改也几乎不会破坏他的程序逻辑——这些方面是完全分开的。使用 AOP 进行日志记录的优势在于，您的程序代码可以完全专注于做它应该做的任何事情，并且您仍然可以拥有复杂的日志记录，而不会让您的代码到处被数百条日志消息弄得一团糟。此外，当引入新代码时，神奇的日志消息将在正确的时间以正确的内容出现。

因此，在我的示例中，AOP 的一个很好的用法是始终记录是否通过 set 方法更新了任何值。这不会产生反模式，也几乎不会成为任何问题的原因。

有人可能会说，如果你可以轻易地滥用 AOP 来制造这么多问题，那么将它全部使用是个坏主意。然而，哪些技术不能被滥用？你可以滥用数据封装，也可以滥用继承。几乎所有有用的编程技术都可能被滥用。考虑一种编程语言非常有限，它只包含不能被滥用的功能；一种语言，其中功能只能按照最初打算使用的方式使用。这种语言将非常有限，以至于它是否可以用于现实世界的编程也是有争议的。

* * *

## 回答 #2

> 赞同：35
> 
> 时间：2008-10-24T09:11:28.143

面向方面的编程提供了一种很好的方式来实现横切关注点，如日志记录、安全性。这些横切关注点是必须在许多地方应用但实际上与业务逻辑没有任何关系的逻辑片段。

您不应该将 AOP 视为 OOP 的替代品，而应将其视为一个不错的附加组件，它使您的代码更加干净、松散耦合并专注于业务逻辑。

因此，通过应用 AOP，您将获得 2 个主要好处：

1.  每个关注点的逻辑现在都在一个地方，而不是分散在整个代码库中。

2.  类更简洁，因为它们只包含主要关注点（或核心功能）的代码，而次要关注点已移至方面。

* * *

## 回答 #3

> 赞同：29
> 
> 时间：2008-10-24T09:09:24.170

OOP 和 AOP 不是相互排斥的。AOP 可以很好地补充 OOP。AOP 对于向方法添加标准代码（如日志记录、性能跟踪等）特别方便，而不会用此标准代码阻塞方法代码。

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2008-10-24T09:16:29.197

我认为这个问题没有一般性的答案，但需要注意的一点是，AOP 并没有*取代*OOP，而是添加了某些分解功能，以解决所谓*的主导组合*( [1](http://portal.acm.org/citation.cfm?id=302457) ) 的暴政（或横切关注点）。

只要您能够控制用于特定项目的工具和语言，它在某些情况下肯定会有所帮助，但也会增加有关方面交互的复杂性以及对[AJDT](http://www.eclipse.org/ajdt)等其他工具的需求仍然可以理解你的程序。

Gregor Kiczales 曾经在 Google Tech Talks 上发表过关于 AOP 的有趣介绍性演讲，我推荐观看：[Aspect Oriented Programming: Radical Research in Modularity](https://www.youtube.com/watch?v=cq7wpLI0hco)。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2008-10-24T09:16:57.540

首先AOP不会取代OOP。AOP 扩展了 OOP。OOP 的思想和实践保持相关性。拥有一个好的对象设计可能会更容易用方面来扩展它。

我认为AOP带来的想法很重要。我们需要想办法在程序中的不同类上实现横切关注点，而不必更改类本身。但我认为 AOP 最终将成为我们使用的其他工具的一部分，而不是单独的工具或技术。我们已经看到这种情况正在发生。

像 Ruby 和 Python 这样的一些动态语言具有像 mixins 这样的语言结构来解决相同的问题。这看起来很像 AOP，但更好地集成在语言中。

Spring 和 Castle 以及其他一些依赖注入框架具有向它们注入的类添加行为的选项。这是一种运行时编织的方式，我认为这有很大的潜力。

我认为您不必学习一个全新的范例来使用 AOP。这些想法很有趣，但正在慢慢被现有工具和语言所吸收。随时了解并尝试这些工具。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2019-06-28T14:57:11.827

**OOP**主要用于组织您的**业务逻辑**，而**AOP** 有助于组织您的**非功能性事物**，如审计、日志记录、事务管理、安全性等。

通过这种方式，您可以将业务逻辑与非功能性逻辑解耦，从而使代码更简洁。

另一个优点是您可以非常一致地应用建议（例如审计），而无需实现任何接口，这为修改提供了极大的灵活性，而无需触及业务逻辑。

这种方式很容易实现**关注点分离**和**单一职责**。

此外，当它只解决一个业务问题时，它很容易将业务逻辑从一个框架（比如 Spring）移植到其他地方（将来）

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2010-10-13T11:30:34.370

AOP 是处理这个概念的一种新的编程范式。一个方面是实现应用程序的特定非功能部分的软件实体。

我认为这篇文章是开始面向方面编程的好地方： [http ://www.jaftalks.com/wp/index.php/introduction-to-aspect-oriented-programming/](http://www.jaftalks.com/wp/index.php/introduction-to-aspect-oriented-programming/)

# winapi - 如何拦截来自网络摄像头的视频或图像流并对其进行修改？

> ID：232893
> 
> 赞同：5
> 
> 时间：2008-10-24T09:04:57.393
> 
> 标签：winapi, video-capture

是否可以进行通用 API 调用来获取来自网络摄像头的图像或视频源的句柄，并将其替换为我自己的图像或视频，以便应用程序连接到摄像头（例如 MSN/Skype/Yahoo IM）会看到我的图像而不是相机正在捕捉的图像吗？

理想情况下，我试图以一种独立于设备供应商或接口的通用方式解决这个问题（通过所有这些应用程序使用的标准网络摄像头堆栈，如果存在这样的事情）。

它适用于需要能够禁用客户端上的网络摄像头而不是出于特定目的的安全应用程序。我可以通过代码停止和启动图像捕获设备，但理想情况下，我更愿意让设备保持启用状态，并用一个图形替换捕获的图像，告诉用户他们当前无法使用他们的摄像头的原因。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-24T09:23:27.823

大多数设计用于通用工作的现代网络摄像头通常会作为 WDM 设备实现，然后作为 DirectShow 内核过滤器公开。然后应用程序可以使用 DirectShow 处理实时视频流。可以编写一个具有高品质的自定义过滤器，它可以尝试将自己插入任何相关图表，然后动态修改视频流。但是，这种技术当然不是万无一失的，并且可以轻松解决。还有其他视频捕获技术不受此方法的影响。简而言之，没有可靠的方法可以为所有设备或安全地执行您想要的操作。如果您只想能够使用标准网络摄像头并以不安全的方式以编程方式更改视频源，那么上述技术将起作用。

[在此处](http://msdn.microsoft.com/en-us/library/ms783323(VS.85).aspx)查看一般 DirectShow 信息，[在此处](http://msdn.microsoft.com/en-us/library/ms787899(VS.85).aspx)查看有关视频捕获的信息。AmCap和[EZRGB24样本](http://msdn.microsoft.com/en-us/library/ms778964(VS.85).aspx)[也是](http://msdn.microsoft.com/en-us/library/ms783655(VS.85).aspx)一个很好的起点。

# database - 应用服务器数据源中的 JDBC 薄层加密

> ID：232895
> 
> 赞同：0
> 
> 时间：2008-10-24T09:07:12.770
> 
> 标签：database, encryption, jdbc, datasource, oc4j

我遇到了一篇有趣的文章，它展示了我们如何使用 java 瘦客户端透明地加密 jdbc 连接。

[http://javasight.wordpress.com/2008/08/29/network-data-encryption-and-integrity-for-thin-jdbc-clients/](http://javasight.wordpress.com/2008/08/29/network-data-encryption-and-integrity-for-thin-jdbc-clients/)

但是我想知道如何为应用程序服务器（如 oc4j）数据源实现这一点。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-22T06:40:00.810

可以类似地进行。我相信在 Oracle AS 上，当您创建显示添加属性的数据源时，页面底部有一个选项。我相信您可以在那里添加以下内容并尝试一下。

```
// Set the Client encryption level  
"oracle.net.encryption_client" = Service.getLevelString(level)  

// Set the Client encryption selected list  
"oracle.net.encryption_types_client"= "(RC4_40)"

// Set the Client integrity level  
"oracle.net.crypto_checksum_client"= Service.getLevelString(level)  

// Set the client integrity selected list  
"oracle.net.crypto_checksum_types_client"="( MD5 )" 
```

如果成功了。请告诉我们。

谢谢，富兰克林。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2015-10-15T16:52:35.167

不知何故回复迟了，但对于任何再次遇到这个问题的人

***对于加密/完整性：***

您将需要在 $J2EE_HOME/config/data-sources.xml 中手动插入此属性，如下所示： - 未经过彻底测试，但应该可以工作，至少需要很少的 twicking，但应该使用 OracleDataSource 工厂类 -

```
<connection-factory factory-class="oracle.jdbc.pool.OracleDataSource" user=... >
     <connection-properties>
        <property name="oracle.net.encryption_client" value="REQUIRED123"/>
        <property name="oracle.net.crypto_checksum_types_client" value="(SHA1123)"/>
        <property name="oracle.net.crypto_checksum_client" value="REQUIRED"/>
        <property name="oracle.net.encryption_types_client" value="(AES256)"/>
     </connection-properties>
  </connection-factory> 
```

***对于 SSL：***

检查此[链接中的“配置 TCPS 数据源”部分](https://docs.oracle.com/cd/E16439_01/doc.1013/e13977/configssl.htm)

富兰克林的解决方案不起作用，因为允许在 OC4J 中添加的属性仅限于某些枚举值，因此无法添加诸如“oracle.net.encryption_client”之类的属性......相反，您将收到此[oc4j 错误](http://i.stack.imgur.com/j8aNp.jpg)

# asp.net - 从 asp:Image 或 asp:ImageButton 转换？

> ID：232905
> 
> 赞同：0
> 
> 时间：2008-10-24T09:15:00.760
> 
> 标签：asp.net, inheritance, user-controls

我在控件中得到了这个逻辑来为图像创建正确的 url。我的控件基本上需要显示图像，但 src 实际上是基于指向图像服务器的不同参数的复杂字符串。

所以我们决定创建一个从 asp:Image 派生的控件 MyImage - 它就像一个魅力。现在我需要相同的逻辑，但我的图像现在需要响应点击。我的意思是 - 'MyImage' 用于在网站上显示图像，但在极少数情况下，我希望它是可点击的。

我想我有三个选择。

1.  将 MyImage 更改为从 asp:ImageButton 而不是 asp:Image 派生。
2.  将 MyImage 中的所有代码复制到新的 MyClickImage 中并从 asp:ImageButton 派生。
3.  在 MyImage 上包装逻辑以添加超链接，为该超链接实现 IPostbackHandler 并添加处理事件的逻辑。

显然，我非常想避免使用选项 2），因为我必须维护两个几乎相同的控件。*我看到*的选项 1) 的问题（也许我错了？）是网站上所有不应点击的图像将自动变为可点击。选项 3) 似乎过于复杂，因为我必须手动维护状态、事件和构建链接。

我正在寻找一个快速的答案，比如'你很愚蠢，当你不希望它可点击时，只需将属性'x'设置为 false' - 但如果我没记错的话，它并不是那么明显，当然是更详细的答案会很好:)

编辑：添加了第三个选项 - 我忘了把它放在首位:)

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-10-24T09:20:27.783

我会完全避免整个派生业务，只需`onclick`在需要时向我的图像添加一个 JavaScript 参数。

我不知道点击会在您的页面中执行什么操作，但我想可以使用客户端 JavaScript 来完成。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-24T09:27:32.200

好吧，我很愚蠢，`enabled = "false"`如果我不想让它可点击，我只需要设置。我认为他们应该使用另一个名称但“启用”，因为它在其他控件上具有其他含义。

# .net - How to make consistent dll binaries across VS versions?

> ID：232926
> 
> 赞同：8
> 
> 时间：2008-10-24T09:28:09.297
> 
> 标签：.net, c++, dll

For instance, winsock libs works great across all versions of the visual studio. But I am having real trouble to provide a consistent binary across all the versions. The dll compiled with VS 2005 won't work when linked to an application written in 2008\. I upgraded both 2k5 and 2k8 to SP1, but the results haven't changed much. It works some what ok. But when they include this with a C# app, the C# app gets access violation errors, but with classic C++ application it works fine.

Is there a strategy that I should know when I provide dlls ?

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-10-24T09:56:30.270

First, dont pass anything other than plain old data accross DLL boundries. i.e. structs are fine. classes are not. Second, make sure that ownership is not transferred - i.e. any structs passed accross the dll boundry are never deallocated outside the dll. So, if you dll exports a X* GetX() function, there is a corresponding FreeX(X*) type function ensuring that the same runtime that allocated is responsible for de-allocation.

Next: Get your DLLs to link to the static runtime. Putting together a project comprimising dls from several 3rd parties, each linked to and expecting different runtimes, potentially different to the runtime expected by the app, is a pain, potentially forcing the installer software to install runtimes for 7.0, 7.1, 8.0 and 9.0 - several of which exist in different service packs which may or may not cause issues. Be kind - statically link your dll projects.

-- Edit: You cannot export a c++ class directly with this approach. Sharing class definitions between modules means you MUST have a homogeneous runtime environment as different compilers or versions of compilers will generate decorated names differently.

You *can* bypass this restriction by exporting your class instead as a COM style interface... which is to say, while you cannot export a class in a runtime independent way, you CAN export an "interface", which you can easilly make by declaring a class containing only pure virtual functions...

```
 struct IExportedMethods {
    virtual long __stdcall AMethod(void)=0;
  };
  // with the win32 macros:
  interface IExportedMethods {
    STDMETHOD_(long,AMethod)(THIS)PURE;
  }; 
```

In your class definition, you inherit from this interface:

```
 class CMyObject: public IExportedMethods { ... 
```

You can export interfaces like this by making C factory methods:

```
 extern "C" __declspec(dllexport) IExportedClass* WINAPI CreateMyExportedObject(){
    return new CMyObject; 
  } 
```

This is a very lightweight way of exporting compiler version and runtime independent class versions. Note that you still cannot delete one of these. You Must include a release function as a member of the dll or the interface. As a member of the interface it could look like this:

```
 interface IExportedMethods {
    STDMETHOD_(void) Release(THIS) PURE; };
  class CMyObject : public IExportedMethods {
    STDMETHODIMP_(void) Release(){
      delete this;
    }
  }; 
```

You can take this idea and run further with it - inherit your interface from IUnknown, implement ref counted AddRef and Release methods as well as the ability to QueryInterface for v2 interfaces or other features. And finally, use DllCreateClassObject as the means to create your object and get the necessary COM registration going. All this is optional however, you can easilly get away with a simple interface definition accessed through a C function.

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-24T10:40:31.443

I disagree with Chris Becke's viewpoint, while seeing the advantages of his approach.

The disadvantage is that you are unable to create libraries of utility objects, because you are forbidden to share them across libraries.

## Expanding Chris' solution

[How to make consistent dll binaries across VS versions?](https://stackoverflow.com/questions/232926/how-to-make-consistent-dll-binaries-across-vs-versions#232959)

Your choices depend on how much the compilers are different. In one side, different versions of the same compiler could handle data alignement the same way, and thus, you could expose structs and classes across your DLLs. In the other side, you could mistrust the other libraries compilers or compile options.

In Windows Win32 API, they handled the problem through "handlers". You do the same by:

1 - Never expose a struct. **Expose only pointers** (i.e. a void * pointer)
2 - This struct data's **access is through functions** taking the pointer as first parameter
3 - this struct's pointer **allocation/deallocation data is through functions**

This way, you can avoid recompiling everything when your struct change.

The C++ way of doing this is the PImpl. See [http://en.wikipedia.org/wiki/Opaque_pointer](http://en.wikipedia.org/wiki/Opaque_pointer)

It has the same behaviour as the void * concept above, but with the PImpl, you can use both RAII, encapsulation, and profit from strong type safety. This would need compatible decoration (same compiler), but not the same runtime or version (if decorations are the same between versions).

## Another solution?

Hoping to mix together DLLs from different compilers/compiler versions is either a recipe for disaster (as you explained in your question) or tedious as you have let go most (if not all) C++ solutions to your code to fall back to basic C coding, or both.

My solution would be:

1 - Be sure all your modules are compiled with the **same compiler/version**. Period.
2 - Be sure all your modules are compiled to **link dynamically with the same runtime**
3 - Be sure to have an **"encapsulation" of all third-party modules** over which you have no control (unable to compile with your compiler), as explained quite rightly by Chris Becke at [How to make consistent dll binaries across VS versions?](https://stackoverflow.com/questions/232926/how-to-make-consistent-dll-binaries-across-vs-versions#232959).

**Note that it is not surprising nor outrageous to mandate that all modules of your application compiled against the same compiler and the same version of the compiler.**

Don't let anyone tell you mixing compilers is a good thing. It is not. The freedom of mixing compiler is, for most people, the same kind of freedom one can enjoy by jumping from the top of a building: You are free to do so, but usually, you just don't want that.

My solution enables you to:

1 - export classes and thus, make real, non-castrated, **C++ libraries** (as you are supposed to do with the __declspec(dllexport) of Visual C++ for example)
2 - **transfert allocation ownership** (which happens without your consent when using allocating and/or deallocating inlined code, or STL)
3 - **not be annoyed with problems** tied to the fact each module has its own version of the runtime (i.e. memory allocation, and some global data used by the C or C++ API)

Note that it means you're not supposed to mix debug version of your modules with release versions of other modules. Your app is either fully in debug or fully in release.

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-24T11:48:31.327

regarding the problem of passing a structure, this thing is safe as long as you align your structure such as:

```
 #pragma pack(push,4)
typedef myStruct {
  int a;
  char b;
  float c;
}myStruct;
#pragma pack(pop) 

```

You can put this declaration in a header file and include it in both projects. This way you will not have any problem while passing structures.

Also, make sure you link statically with the runtime libraries and do not try thing such as allocating memory (ptr=malloc(1024)) in a module and then releasing that memory in another module (free(ptr)).

# php - 如何总结 PHP 中的加权数组？

> ID：232933
> 
> 赞同：1
> 
> 时间：2008-10-24T09:40:53.687
> 
> 标签：php, arrays, interpolation

如何将多维数组的值与权重相乘，并将结果汇​​总到 PHP 或一般的新数组中？

无聊的方式是这样的：

```
$weights = array(0.25, 0.4, 0.2, 0.15);
$values  = array
           ( 
             array(5,10,15), 
             array(20,25,30), 
             array(35,40,45), 
             array(50,55,60)
           );
$result  = array();

for($i = 0; $i < count($values[0]); ++$i) {
  $result[$i] = 0;
  foreach($weights as $index => $thisWeight)
    $result[$i] += $thisWeight * $values[$index][$i];
} 
```

有没有更优雅的解决方案？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-24T10:33:44.250

当然，这取决于您所说的优雅。

```
function weigh(&$vals, $key, $weights) {
    $sum = 0;
    foreach($vals as $v)
        $sum += $v*$weights[$key];
    $vals = $sum;
}

$result = $values;
array_walk($result, "weigh", $weights); 
```

编辑：很抱歉没有更好地阅读您的示例。我将结果作为值的副本，因为 array_walk 通过引用工作。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-24T09:59:03.883

嗯……

```
foreach($values as $index => $ary )
  $result[$index] = array_sum($ary) * $weights[$index]; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-24T10:32:07.997

我一开始也误解了这个问题。

我猜想使用该数据表示，任何其他选择都不会像您所拥有的那样清晰。

如果我们可以将其更改为其他内容，例如，如果我们要转置矩阵并以相反的方式相乘，那么很容易获得更简洁且可能更优雅的方式。

```
<?php

$weights = array(0.2,0.3,0.4,0.5);
$values = array(array(1,2,0.5), array(1,1,1), array(1,1,1), array(1,1,1));
$result = array();

for($i = 0; $i < count($values[0]); ++$i) {
        $result[$i] = 0;
        foreach($weights as $index => $thisWeight) {
           $result[$i] += $thisWeight * $values[$index][$i];
        }
}
print_r($result);

$result = call_user_func_array("array_map",array_merge(array("weightedSum"),$values));

function weightedSum() {
    global $weights;
    $args = func_get_args();
    return array_sum(array_map("weight",$weights,$args));
}

function weight($w,$a) {
    return $w*$a;
}

print_r($result);

?> 
```

# c# - 在 ASP.NET 中子类化 DropDownList

> ID：232934
> 
> 赞同：5
> 
> 时间：2008-10-24T09:40:59.210
> 
> 标签：c#, asp.net, user-controls, drop-down-menu, subclass

我想子类化 ASP.NET 中的内置 DropDownList，以便我可以向它添加功能并在我的页面中使用它。我尝试使用 UserControl 执行此操作，但发现它没有公开内部 DropDownList（我猜从逻辑上讲）。我已经用谷歌搜索了答案，但找不到任何东西。

我已经编写了实际的类，并且可以从 DropDownList 子类化，但我无法在我的 ASP.NET 页面中注册该文件并在源视图中使用它。也许我在课堂上缺少一些属性？

有任何想法吗？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-10-24T10:02:22.003

您想在自定义控件中扩展 DropDownList ......而不是在用户控件中。

创建一个名为 MyLibrary 的新类库项目。

添加一个名为 MyDropDownList.cs 的类

```
namespace My.Namespace.Controls
{
[ToolboxData("<{0}:MyDropDownList runat=\"server\"></{0}:MyDropDownList>")]
public class MyDropDownList: DropDownList
{
    // your custom code goes here
    // e.g.
    protected override void  RenderContents(HtmlTextWriter writer)
    {
        //Your own render code
    }
}
} 
```

编译库后，您可以在 Web 应用程序中添加对它的引用。

以及您的 web.config 中的 tagprefix

```
 <add tagPrefix="my" namespace="My.Namespace.Controls" assembly="MyLibrary" /> 
```

这应该允许您将其添加到您的 aspx/ascx

```
<my:MyDropDownList ID="myDDl" runat="server">
    ...
</my:MyDropDownList> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-24T13:02:17.807

在评论中，您阐明了您的目标：“我唯一想做的就是添加一个 InitialValue 属性，该属性定义 DDL 中始终存在的第一个值。”

我认为您不需要创建特殊的用户控件或自定义控件来完成此操作。

我经常在我的 Web 应用程序中使用此代码来填充列表控件。您传入一个布尔值，指示是否要在列表顶部添加一个额外的 ListItem，以及该项目的文本。

```
 public static void BindListControl (ListControl ctl, SqlDataReader dr,
        String textColumn, String valueColumn, bool addBlankRow, string blankRowText)
    {
        ctl.Items.Clear();
        ctl.DataSource = dr;
        ctl.DataTextField = textColumn;
        ctl.DataValueField = valueColumn;
        ctl.DataBind();

        if (addBlankRow == true) ctl.Items.Insert(0, blankRowText);
    } 
```

这很有用，例如，如果您希望每个 DropDownList 的初始值都为空白，或者诸如“选择城市”之类的文本。

# sql - 字段不包含 $x 的 SQL 查询

> ID：232935
> 
> 赞同：174
> 
> 时间：2008-10-24T09:42:11.000
> 
> 标签：sql, mysql

我想找到一个 SQL 查询来查找 field1 不包含 $x 的行。我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：357
> 
> 时间：2008-10-24T09:52:29.577

这是一个什么样的领域？IN 运算符不能与单个字段一起使用，但旨在用于子查询或预定义列表：

```
-- subquery
SELECT a FROM x WHERE x.b NOT IN (SELECT b FROM y);
-- predefined list
SELECT a FROM x WHERE x.b NOT IN (1, 2, 3, 6); 
```

如果您正在搜索字符串，请使用 LIKE 运算符（但这会很慢）：

```
-- Finds all rows where a does not contain "text"
SELECT * FROM x WHERE x.a NOT LIKE '%text%'; 
```

如果您限制它以使您要搜索的字符串必须以给定字符串开头，它可以使用索引（如果该字段上有索引）并且相当快：

```
-- Finds all rows where a does not start with "text"
SELECT * FROM x WHERE x.a NOT LIKE 'text%'; 
```

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2008-10-24T09:45:40.993

`SELECT * FROM table WHERE field1 NOT LIKE '%$x%';` （确保事先正确转义 $x 以避免 SQL 注入）

编辑：`NOT IN`做一些不同的事情 - 你的问题并不完全清楚，所以选择使用哪一个。 `LIKE 'xxx%'`可以使用索引。 `LIKE '%xxx'`或`LIKE '%xxx%'`不能。

# windows - RCDATA 终结器

> ID：232938
> 
> 赞同：0
> 
> 时间：2008-10-24T09:44:40.357
> 
> 标签：windows, resources

我有一个 .rc 文件，用于在我的可执行文件中包含一些文本数据，如下所示：

```
1234 RCDATA myfile.txt 
```

这很好用：“myfile.txt”的内容包含在我的可执行文件中。问题是字符串中没有添加 0 终止符，我无法将其添加到文件中。有没有办法从 .rc 文件中添加一个 0 终止符？像这样的东西：

```
1234 RCDATA { myfile.txt, "\0" }         // error RC2104 
```

请注意，我已经找到了这个解决方案，但我正在寻找更优雅的东西。

```
1234 RCDATA myfile.txt
1235 RCDATA { "\0" } 
```

非常感谢，伊莱

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-24T10:15:05.130

我不这么认为，除非您编写自己的资源编译器。
我还没有遇到一个允许从多个来源构建一种资源的方法。
您可以编写一个小实用程序来将尾随 '\0' 添加到文件中，例如 makeZ.exe，
并设置一个额外的构建步骤：

```
makeZ myfile.txt myfileZ.txt 
```

在你的 .rc 中会有

```
 1234 RCDATA myfileZ.txt 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-27T07:41:00.673

或者，您可以查看将数据嵌入 RC 本身，根据[GORC 手册](http://www.jorgon.freeserve.co.uk/Resource.htm#raw)中的此部分：

```
0x3333 RCDATA
BEGIN
  "Hello world"
  "Hello world (zero terminated)\0"
  L"A Unicode version of the above\0"
  0x9999  ;hex number stored as a word
END

MyRes RCDATA
BEGIN
  1034  ;decimal number stored as a word
END

MyRes MyResType
BEGIN
  10456L  ;decimal number stored as a dword
  1234L,56666L,99999L  ;decimal numbers stored as dwords
END

34h 100h
BEGIN
  33hL,34hL,35hL,36hL  ;hex numbers stored as dwords
  0x37L,0x38L,0x39L,0x40L  ;C-style hex numbers stored as dwords
END 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-27T08:01:37.717

您最好将尾随字符放在文件本身中。如果 myfile.txt 存储在 ANSI 中，则需要一个尾随字节，如果 myfile.txt 存储在 Unicode 中，则需要两个尾随字节，并且您的 RCDATA 语句无法打开它。

# asp.net - 将 xml 文档绑定到 gridview 不起作用

> ID：232945
> 
> 赞同：1
> 
> 时间：2008-10-24T09:48:08.883
> 
> 标签：asp.net, xml

我有一个如下所示的 XML 文档：

```
<xconnect>
<type>OK</type>
<response/>
<report>
    <id>suppressionlist_get</id>
    <name>Suppression List Get</name>
    <timestamp>24 Oct 08 @ 10:16AM</timestamp>
    <records type=\"user\"/>
    <records type=\"client\"/>
    <records type=\"group\">
        <record>
            <email>investorrelations@hfh.com</email>
            <type>RECIPSELF</type>
            <long_type>Recipient self suppressed</long_type>
            <created>23 Oct 08 @ 8:53PM</created>
            <user>facm</user>
        </record> 
```

为了清楚起见并保持这篇文章简短，我省略了文件的关闭。

无论如何，我有一个 GridView，我想将此 XML 绑定到 GridView，以便获得表，例如：

```
email | type | long | created | user
------------------------------------
data    data   data    data     data 
```

等等。

我正在使用 DataSets 和 XMLDataDocuments，并且在单步执行时，每个属性似乎都表示为数据收集表中自己的表。

关于如何实现上述目标的任何想法？我认为这就像添加一个 GridView 和带有指定数据文件的 XML 数据源一样简单。

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2011-09-08T22:05:46.307

尝试：

```
DataSet dataSet = new DataSet();
dataSet.ReadXML("Path to XML");
this.GridView1.DataMember = "record";
this.GridView1.DataSource = dataSet;
this.GridView1.DataBind(); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-24T09:54:34.547

创建一个测试数据集并将其写入 Xml 以了解数据集使用的 Xml 格式，然后转换 Xml 格式以匹配此格式，然后使用`DataSet.LoadXml()`.

或者，您可以从现有的 Xml 格式即时构建数据集。

# oracle - 如何为 Oracle 的 Pro*COBOL 预编译器指定默认文件扩展名

> ID：232961
> 
> 赞同：0
> 
> 时间：2008-10-24T09:58:01.983
> 
> 标签：oracle, cobol, procobol

是否可以配置 Oracle 的 Pro*COBOL 预编译器假定的默认文件扩展名

```
EXEC SQL INCLUDE filename END-EXEC 
```

没有为包含文件指定文件名的语句？

文档似乎指定在这种情况下 - INCLUDE 没有文件扩展名的语句 - 预编译器将使用系统默认文件扩展名。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-04T16:43:29.713

Oracle 支持说：不，这是不可配置的。在 Windows 和 Linux 上，默认扩展名为 .cob。

# formatting - 如何了解公认的编码风格

> ID：232975
> 
> 赞同：3
> 
> 时间：2008-10-24T10:04:43.217
> 
> 标签：formatting, coding-style

在哪里阅读（最佳实践）源代码格式，对于个别语言，即命名变量等的约定是什么，缩进和放置大括号的位置，如何以及在哪里包含注释等。

例如对于 C Kernighan 和 Ritchie 的书[The C Programming Language](https://rads.stackoverflow.com/amzn/click/com/0131103628)和 Linus Torvalds 的[Linux kernel coding style guide](http://pantransit.reptiles.org/prog/CodingStyle.html)或[Google 的 C++ Style Guide](http://google-styleguide.googlecode.com/svn/trunk/cppguide.xml)和 Perl 至少[perlstyle - Perl style guide](http://www.perl.com/doc/manual/html/pod/perlstyle.html)。

编辑：也许我应该问“如何从编码风格开始”。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-24T10:09:40.680

我不会在这样的风格指南上给出太多。它们是一个好的开始，但最终您或您的团队将开发自己的编码风格。

编辑：Rob Kam 发表评论说，他想了解更多关于这些“启动约定”的信息。

那是个很好的观点。但大多数情况下，你会加入现有项目、开源项目或商业项目，而从事它的人已经有了代码约定。在一家公司中可能已经存在一个代码约定。如果您开始一个新项目，请从您之前所做的另一个项目的约定开始。

如果你真的用一种你以前没有使用过的新语言开始一个新项目......那么你可能会从另一种语言的约定开始，这种约定在某种程度上相似（即，对于一种新的 oo 语言，你可以使用 Java 或 Smalltalk 的约定）并在您获得新语言经验时调整您的约定。当我开始用 Java 编程时，我使用了我的 Pascal-coding-conventions。一些 pascal 约定对 Java 来说不是很好，但随着时间的推移，我放弃了一些旧的约定并开发了新的约定。

S.Lott 的想法是研究一个用您选择的语言编写的开源项目。获得有关良好约定的一些建议是个好主意。Srikanth 有一个好主意，可以在 Stackoverflow 上提出好的约定。一个非常好的主意，因为随着时间的推移，Stackoverflow 将成为这种编码约定的良好参考。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-24T10:12:47.677

比一本书更好的是找到你喜欢的语言的开源代码。

而不是一本书——少数作者和编辑的作品——工作源代码是一个符合高度发展的社区标准的社区项目。

当客户要求帮助制定编码标准时，我更愿意找到一个好的开源项目并提供一个简短的标准文档，上面写着“让它看起来像 xxx”。我用于 Java 风格的一个很好的例子是 Apache [Ant](http://svn.apache.org/viewvc/ant/core/trunk/)项目。

每个人都有自己喜欢的开源示例项目。阅读一些真实世界的工作代码，然后选择一个最喜欢的。模仿那个项目。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-24T10:15:26.410

我会使用谷歌。例如，要搜索 Java Coding Guidelines，我将使用[此查询](http://www.google.com/search?hl=en&q=Java+Coding+Standards&btnG=Google+Search&aq=f&oq=)或在 Stack Overflow 上发帖，询问推荐的 Java 编码标准指南是什么。很难指出所有语言的单一来源。

我建议您为您的公司/项目选择一个并坚持下去，并确保它是一个好的标准。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-24T10:22:53.320

如果您担心代码样式问题，我真的建议您阅读鲍勃叔叔的[清洁代码。](https://rads.stackoverflow.com/amzn/click/com/0132350882)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-24T12:53:01.290

有三个好地方可以看。

1.  关于您使用的语言的热门书籍。
2.  用您的语言编写的开源项目。
3.  适用于您的语言的 Checkstyle 类型的实用程序。

如果您使用 Checkstyle 或 PMD 之类的工具，请注意它们执行的许多“规则”可能会引起争议。[检查文档](http://pmd.sourceforge.net/rules/controversial.html)以找出需要警惕的规则可能会有所帮助。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2017-10-30T16:11:11.527

[Microsoft 有一个参考文档](https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/inside-a-program/coding-conventions)，其中包含他们的编码约定，即使您不使用 C#，也可能很有用。除了风格和基本约定之外，这里其他人推荐的最佳实践书籍，如[Clean Code](https://rads.stackoverflow.com/amzn/click/com/0132350882)，对于创建可维护、可读的代码，这对代码库的未来维护者来说是有意义的，是必不可少的读物。

如果您使用的是 Visual Studio（和其他一些现代 IDE），则与推荐约定的基本不一致会自动加下划线（在最新版本的 VS 中建议悬停）。在 VS 中，如果您的团队想要使用不同的标准，只需打开项目属性并更改“代码分析”的设置（最后一个左侧菜单项）。更多内容：[使用规则集对代码分析规则进行分组](https://docs.microsoft.com/en-us/visualstudio/code-quality/using-rule-sets-to-group-code-analysis-rules?f1url=https%3A%2F%2Fmsdn.microsoft.com%2Fquery%2Fdev15.query%3FappId%3DDev15IDEF1%26l%3DEN-US%26k%3Dk(vs.codeanalysis.rulesets.learnmore)%3Bk(TargetFrameworkMoniker-.NETFramework%2CVersion%3Dv4.5)%26rd%3Dtrue)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-24T10:12:09.910

大家好，美好的一天

好吧，我必须说这取决于您是为公司工作还是为您工作；）

如果你为一家公司工作，你必须接受命名风格和其他规则

而对你来说，你只需要建立一种风格，让包括你自己在内的每个人都能立即理解什么和如何

括号和其他是你的方式

但正如你所说，有不同的语言，所以它们有自己的规则

就像 Mnementh 说的，每个团队都有自己的编码方式，可能是严格的，也可能是自由的

仅此而已....再见

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-19T18:18:07.610

有[C 和 C++ 风格指南](http://www.chris-lott.org/resources/cstyle/)，一个简短的页面链接到风格指南、编码规则和来自 USENET 的讨论，由 Christopher Lott 维护。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2011-06-17T12:01:54.767

如果您是**PHP**开发人员，请不要错过这两个指南：

*   [http://pear.php.net/manual/en/standards.php](http://pear.php.net/manual/en/standards.php)
*   [http://framework.zend.com/manual/en/coding-standard.html](http://framework.zend.com/manual/en/coding-standard.html)

# c# - 使用 c# 如何提取有关本地计算机上存在的硬盘驱动器的信息

> ID：232979
> 
> 赞同：5
> 
> 时间：2008-10-24T10:08:48.513
> 
> 标签：c#, hard-drive

我正在寻找数据，例如尺寸/容量、序列号、型号、头部部门、制造商以及可能的 SMART 数据。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-24T10:17:48.447

您可以使用 WMI 调用来访问有关硬盘的信息。

//需要使用 System.Management; & System.Management.dll 参考

```
ManagementObject disk = new ManagementObject("win32_logicaldisk.deviceid=\"c:\""); 
disk.Get(); 
Console.WriteLine("Logical Disk Size = " + disk["Size"] + " bytes"); 
Console.WriteLine("Logical Disk FreeSpace = " + disk["FreeSpace"] + "bytes"); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-24T10:21:49.237

您应该使用[System.Management](http://msdn.microsoft.com/en-us/library/system.management.aspx)命名空间：

```
System.Management.ManagementObjectSearcher ms =
    new System.Management.ManagementObjectSearcher("SELECT * FROM Win32_DiskDrive");
foreach (ManagementObject mo in ms.Get())
{
    System.Console.Write(mo["Model");
} 
```

有关 Win32_DiskDrive 类成员的详细信息，请查看：

[http://msdn.microsoft.com/en-us/library/aa394132(VS.85).aspx](http://msdn.microsoft.com/en-us/library/aa394132(VS.85).aspx)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-24T10:35:57.007

最简单的方法是使用 WMI 来获取所需的信息。[查看 MSDN 中Win32___DiskDrive](http://msdn.microsoft.com/en-us/library/aa394132(VS.85).aspx)的文档，其中包含各种标准驱动器属性。您也可以尝试使用 MSStorageDriver_ATAPISmartData WMI 类，我目前找不到任何文档，但应该包含您正在寻找的所有 SMART 数据。下面是一些基本示例代码，用于枚举所有驱动器并获取它们的属性：

```
ManagementClass driveClass = new ManagementClass("Win32_DiskDrive");
ManagementObjectCollection drives = driveClass.GetInstances();
foreach (ManagementObject drive in drives) 
{ 
    foreach (PropertyData property in drive.Properties)
    {
        Console.WriteLine("Property: {0}, Value: {1}", property.Name, property.Value);        
    }
    Console.WriteLine();
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-24T10:14:07.783

您可以使用[WMI](http://www.csharphelp.com/archives2/archive334.html)来获取您想要的大部分信息，这里有对 WMI 的[介绍](http://www.geekpedia.com/tutorial73_An-introduction-in-retrieving-WMI-in-Csharp.html)。

# erlang - Erlang syntax - 为 Erlang 构建 Intellij IDEA 语言支持插件

> ID：232982
> 
> 赞同：8
> 
> 时间：2008-10-24T10:10:04.283
> 
> 标签：erlang, bnf, ebnf

我正在寻找为 Erlang 创建一个 Intellij IDEA 语言支持插件。

我遇到的第一个也是最大的问题是制定 JFlex Erlang 语法定义。

有谁知道我在哪里可以得到 Erlang 的 EBNF 或 BNF？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-24T10:35:01.550

为什么不[直接去源头](http://www.erlang.org/doc.html)呢？[Erlang 4.7 规范](http://www.erlang.org/download/erl_spec47.ps.gz)列出了语法中的产生式。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-27T17:08:43.087

`lib/compiler/src/core_parse.yrl`在 otp 源代码分发中查看。

# sharepoint - sharepoint 中区域的用途是什么？（Web 应用程序区域或身份验证区域或它们如何称呼它）

> ID：232983
> 
> 赞同：25
> 
> 时间：2008-10-24T10:10:04.517
> 
> 标签：sharepoint, authentication, zones

我无法理解这个概念，首先，它属于哪里。它只是一个 Shrepoint 概念还是更一般的 ASP.NET 或 IIS 级别？它是否只影响身份验证，如果是，它如何影响它？或者它对应用程序有什么影响？我知道这是一个广泛的问题，但我已经用谷歌搜索了大约 15 分钟，但还是找不到答案。现在这对我来说不是那么重要，但我很好奇。

您能否提供一个资源链接并对此进行解释？谢谢！

@Edit：我的意思是像 Authentication Provider 中的区域：Forms Zone：Intranet（Internet，默认）

@Edit：据我所知，这些区域与 IIS Web 应用程序与共享点 Web 应用程序的关联以及与此相关的网站集有关。例如，您可以扩展一个 Web 应用程序，创建一个新的 IIS Web 应用程序，但从 sharepoint 的角度来看，它只是另一个指向具有相同网站集集的同一个 Web 应用程序的 URL。并且扩展 IIS Web 应用程序可以具有与之关联的不同共享点区域（或者可以是相同的区域），从而为同一共享点应用程序的不同访问点使用不同的身份验证方法。

我在这里吗？

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2008-10-24T14:46:36.707

每个“区域”本质上是一个新的 IIS 网站，其中每个网站都指向一个应用程序池。论文也称为扩展。IIS 中的应用程序池通过运行单独的工作进程来创建完整的线程隔离。

任何 Web 应用程序都可以扩展到多个区域。将 Web 应用程序扩展到其他区域允许用户通过单独和独立的 URL 访问同一个网站，每个 URL 都有自己的 Web.Config 文件和 IIS 应用程序范围。每个区域都配置有自己的负载平衡 URL（协议、主机标头和端口）。例如，这允许一个 Web 应用程序使用许多配置，包括多个身份验证存储、缓存方案或自定义 HTTP 模块。

基本上，它允许您根据用于访问站点的 URL 来区别对待单个站点。重要的是要记住负载平衡，缓存方面。

如果您有一个本地 Intranet，例如 500 个内部用户，并且想要扩展该站点以允许外部用户（例如数千个），那么这些功能将允许您分离内容和负载平衡以限制物理访问特定服务器，使用针对特定区域的自定义 HTTP 模块来创建基于这些用户组的唯一登录规则。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2012-07-22T01:58:28.233

区域代表访问同一 Web 应用程序的不同逻辑路径 (URL)。您可以使用区域为用户组实施不同的访问和策略条件。

区域提供了一种通过以下方式对用户进行分区的方法：

*   身份验证类型（例如：基于声明的身份验证、Windows 身份验证）
*   网络区域（例如：外联网、互联网）
*   策略权限（例如：允许或拒绝读取或写入访问）

每个 Web 应用程序最多可以有 5 个区域。这 5 个可能的区域是：

*   默认
*   内联网
*   互联网
*   风俗
*   外联网

创建 Web 应用程序时，会创建默认区域。然后，您可以扩展 Web 应用程序以创建其他区域。

每个 Web 应用程序只能选择每个区域一次。例如，您在 Web 应用程序中只能有一个默认区域。

每个区域由 IIS 中的不同网站表示。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-24T11:49:56.800

它允许您从具有不同安全性的不同 URL 进行不同的访问。

这允许您为 Intranet 设置“Windows 身份验证”，为 Extranet 设置“表单身份验证”，为 Internet 设置“允许匿名的表单身份验证”。

缓存设置也因区域而异。您可以根据您所在的区域将缓存配置为不同的行为。

到目前为止，这些是不同区域的主要区别（包括 3 个不同的公共 URL 可用）。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2013-06-13T04:35:29.473

为了更好地理解，

区域是一种将多个 Web 应用程序配置设置映射到一组内容数据库的方法。

例如，您可以创建 Web 应用程序、创建内容数据库，然后将数据库配置为使用 Windows 身份验证。

所有这些设置都是为 Web 应用程序的默认区域配置的。然后，您可以扩展 Web 应用程序并将其映射到新区域。执行此操作时，您选择要映射到的区域，例如 Intranet、Internet、Custom 或 Extranet。

配置第二个区域时，选择现有或新的 Internet 信息服务 (IIS) 虚拟服务器和新的负载平衡 URL，并确定是使用 NTLM 还是 Kerberos 身份验证。您可以在创建新区域后更改身份验证提供程序，例如，将身份验证更改为表单身份验证。

# xaml - XAML：将文本框 maxlength 绑定到类常量

> ID：232986
> 
> 赞同：19
> 
> 时间：2008-10-24T10:11:40.847
> 
> 标签：xaml, binding, textbox, constants, maxlength

我正在尝试将 WPF 文本框的 Maxlength 属性绑定到类深处的已知常量。我正在使用 c#。

该类的结构与以下内容不太相似：

```
namespace Blah
{
    public partial class One
    {
        public partial class Two
        {
             public string MyBindingValue { get; set; }

             public static class MetaData
             {
                 public static class Sizes
                 {
                     public const int Length1 = 10;
                     public const int Length2 = 20;
                 }
             }
        }
    }
} 
```

是的，它嵌套得很深，但不幸的是，在这种情况下，如果不需要大量的重写，我就无法移动很多东西。

我希望我能够将文本框 MaxLength 绑定到 Length1 或 Length2 值，但我无法让它工作。

我期望绑定类似于以下内容：

```
<Textbox Text="{Binding Path=MyBindingValue}" MaxLength="{Binding Path=Blah.One.Two.MetaData.Sizes.Length1}" /> 
```

任何帮助表示赞赏。

非常感谢

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2008-10-24T10:48:29.400

```
MaxLength="{x:Static local:One+Two+MetaData+Sizes.Length1}" 
```

期间参考属性。加号指的是内部类。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-24T12:42:22.467

固定的！

最初我尝试这样做：

```
{Binding Path=MetaData+Sizes.Length1} 
```

编译好的，但是绑定在运行时失败，尽管类'Two'是路径无法解析为内部静态类的数据上下文（我可以做类似的事情：{Binding Path={x:Static MetaData+Size .Length1}} ？）

我不得不稍微摆弄一下我的课程的布局，但现在绑定正在工作。

新的类结构：

```
namespace Blah
{
    public static class One
    {
        // This metadata class is moved outside of class 'Two', but in this instance
        // this doesn't matter as it relates to class 'One' more specifically than class 'Two'
        public static class MetaData
        {
            public static class Sizes
            {
                public static int Length1 { get { return 10; } }
                public static int Length2 { get { return 20; } }
            }
        }

        public partial class Two
        {
            public string MyBindingValue { get; set; }
        }
    }
} 
```

那么我的绑定语句如下：

```
xmlns:local="clr-namespace:Blah" 
```

和

```
MaxLength="{x:Static local:MetaData+Sizes.Length1}" 
```

这似乎工作正常。我不确定是否需要将常量转换为属性，但这样做似乎没有任何害处。

谢谢你们每一个人的帮助！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-24T10:17:50.633

尝试与 x:Static 绑定。将具有 Sizes 命名空间的 xmlns:local 命名空间添加到您的 xaml 标头，然后使用以下内容绑定：

```
{x:Static local:Sizes.Length1} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-24T10:31:47.733

不幸的是，我得到了以下错误`Type 'One.Two.MetaData.Sizes' not found`。我无法创建比“Blah”更深的本地命名空间（无论如何根据 VS2008）

```
xmlns:local="clr-namespace:Blah" 
```

和

```
MaxLength="{x:Static local:One.Two.MetaData.Sizes.Length1}" 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-24T10:39:55.330

如果 One 不是静态类，则不能使用 x:Static 绑定到它。为什么使用内部类？如果元数据不在两个范围内，并且 Sizes 是一个属性，您可以使用 x:Static 轻松访问它。在这种情况下，您不能绑定到类型，只能绑定到现有对象。但是 One 和 Two 是类型，而不是对象。

# pdf - 删除多个 PDF 文件的密码

> ID：232990
> 
> 赞同：0
> 
> 时间：2008-10-24T10:14:00.500
> 
> 标签：pdf, text, encryption

所以我有大量的 PDF 文件需要从中提取文本。这些文件是加密的，但我知道它们的密码。我正在寻找一种方法来自动化提取文本的过程。

我可以在 Acrobat Professional 中手动打开文件，通过输入密码删除安全性，然后另存为 .txt 文件。但是没有办法通过批处理 600 个文件来自动化它。

我正在寻找一些工具来帮助解决这个问题。我很擅长 Perl，所以我尝试了 CPAN 的各种 PDF 处理模块，但它们无法读取加密的文档。有人对此有任何解决方案吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-24T14:24:15.067

看看pdftk。它基于控制台并处理受密码保护的 PDF 文件。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-24T10:26:53.780

pdftotext 应该能够做到这一点。它带有 poppler 库，也可以在 xpdf 中找到（poppler 来自 xpdf）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-27T14:21:40.803

尝试[pdftk](http://www.accesspdf.com/pdftk/)：

pdftk secure.pdf input_pw foopass 输出 unsecured.pdf

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-08-13T07:31:04.827

您可以尝试使用[PDF Password Cracking](http://www.crack-pdf-password.com/)实用程序的特殊功能

它被称为“解密”选项 - 您可以填写密码，然后制作一份不受保护的 PDF 文件副本

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-25T03:17:58.500

[CAM::PDF](http://search.cpan.org/dist/CAM-PDF)是一个开源 Perl 库，可以加密和解密 PDF。目前它只能在所有者和用户密码相同的情况下进行 40 位加密，但就在今天（巧合）一个用户提交了一个补丁，允许 128 位加密和解密。我希望在下周发布一个具有该增强功能的新版本。

不过，CAM::PDF 不太擅长提取文本。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-24T11:59:56.997

我同意 Desstan，AutoIt 或 AutoHotkey 可用于使用 GUI 自动化任何无法通过其他方式自动化的任务。虽然它可能很慢并且可能会在意外情况下停止（加上学习曲线，但至少 AutoHotkey 论坛非常有帮助，尽管需要 Acrobat Professional 为其编写脚本......）。

事实上，[Xpdf](http://www.foolabs.com/xpdf/about.html "Xpdf")似乎是一个有趣的工具，包括文本提取器和支持[解密](http://www.foolabs.com/xpdf/decryption.html "解密")。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-10-24T10:22:29.500

如果您找不到任何体面的纯程序化方式来做这件事，另一种选择是[AutoIt](http://www.autoitscript.com/autoit3/)。

它是“一种为自动化 Windows GUI 而设计的类似 BASIC 的免费软件脚本语言”，它可以在您去喝咖啡时为您完成所有的指向和点击操作。

# c# - 在.net 2中生成唯一集的最快方法是什么

> ID：232997
> 
> 赞同：6
> 
> 时间：2008-10-24T10:19:35.027
> 
> 标签：c#, .net, performance, collections

我有一个本质上是名称值对的锯齿状数组 - 我需要从中生成一组唯一的名称值。锯齿状数组大约有 86,000 x 11 个值。我必须以何种方式存储名称值对（单个字符串“name=value”或专用类，例如 KeyValuePair）对我来说并不重要。
**附加信息：**有 40 个不同的名称和更多的不同值 - 可能在区域 10,000 个值中。

我正在使用 C# 和 .NET 2.0（性能太差了，我认为将整个锯齿状数组推入 sql 数据库并从那里进行选择可能会更好）。

以下是我正在使用的当前代码：

```
List<List<KeyValuePair<string,string>>> vehicleList = retriever.GetVehicles();
this.statsLabel.Text = "Unique Vehicles: " + vehicleList.Count;

Dictionary<KeyValuePair<string, string>, int> uniqueProperties = new Dictionary<KeyValuePair<string, string>, int>();
foreach (List<KeyValuePair<string, string>> vehicle in vehicleList)
{
    foreach (KeyValuePair<string, string> property in vehicle)
    {
        if (!uniqueProperties.ContainsKey(property))
        {
            uniqueProperties.Add(property, 0);
        }
    }
}
this.statsLabel.Text += "\rUnique Properties: " + uniqueProperties.Count; 
```

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-10-30T20:21:29.797

**我让它在 0.34 秒内运行，**从 9 分钟以上

问题在于比较 KeyValuePair 结构时。我通过编写一个比较器对象并将它的一个实例传递给字典来解决它。

据我所知， KeyValuePair.GetHashCode() 返回它的`Key`对象的哈希码（在这个例子中是最不唯一的对象）。

当字典添加（并检查是否存在）每个项目时，它同时使用 Equals 和 GetHashCode 函数，但当哈希码不那么唯一时必须依赖 Equals 函数。

通过提供更独特的 GetHashCode 函数，它使用 Equals 函数的频率要低得多。我还优化了 Equals 函数，以在不那么唯一的键之前比较更独特的值。

86,000 * 11 个具有 10,000 个独特属性的项目使用下面的比较器对象在 0.34 秒内运行（没有比较器对象需要 9 分 22 秒）

希望这可以帮助 ：）

```
 class StringPairComparer
        : IEqualityComparer<KeyValuePair<string, string>>
    {
        public bool Equals(KeyValuePair<string, string> x, KeyValuePair<string, string> y)
        {
            return x.Value == y.Value && x.Key == y.Key;
        }
        public int GetHashCode(KeyValuePair<string, string> obj)
        {
            return (obj.Key + obj.Value).GetHashCode();
        }
    } 
```

**编辑**：如果它只是一个字符串（而不是 KeyValuePair，其中字符串 = 名称 + 值），它将快两倍。这是一个很好的有趣的问题，我花*了太多时间在上面*（不过我学会了安静一点）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-24T10:25:44.080

如果您不需要每个键/值对与您生成的唯一值之间的任何特定关联，您可以只使用 GUID？我假设问题是您当前的“密钥”在这个锯齿状数组中不是唯一的。

```
Dictionary<System.Guid, KeyValuePair<string, string>> myDict 
   = new Dictionary<Guid, KeyValuePair<string, string>>();

foreach of your key values in their current format
   myDict.Add(System.Guid.NewGuid(), new KeyValuePair<string, string>(yourKey, yourvalue)) 
```

听起来它会存储你需要的东西，但我不知道你将如何从中提取数据，因为生成的 Guid 和你最初拥有的东西之间没有语义关系......

你能在你的问题中提供更多信息吗？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-24T10:35:29.787

使用 KeyValuePair 作为包装类，然后创建一个字典来创建一个集合？或者实现您自己的覆盖 Equals 和 GetHashCode 的包装器。

```
Dictionary<KeyValuePair, bool> mySet;

for(int i = 0; i < keys.length; ++i)
{
    KeyValuePair kvp = new KeyValuePair(keys[i], values[i]);
    mySet[kvp] = true;
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-24T11:11:43.330

而不是使用`Dictionary`为什么不扩展[`KeyedCollection<TKey, TItem>`](http://msdn.microsoft.com/en-us/library/ms132438.aspx)？根据文档：

为其键嵌入值中的集合提供抽象基类。

然后，您需要覆盖该[`protected TKey GetKeyForItem(TItem item)`](http://msdn.microsoft.com/en-us/library/ms132454.aspx)功能。因为它是 和 之间的混合体[`IList<T>`](http://msdn.microsoft.com/en-us/library/5y536ey6.aspx)，[`IDictionary<TKey, TValue>`](http://msdn.microsoft.com/en-us/library/s4ys34ea.aspx)我认为它可能会很快。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-24T11:22:20.237

怎么样：

```
Dictionary<NameValuePair,int> hs = new Dictionary<NameValuePair,int>();
foreach (i in jaggedArray)
{
    foreach (j in i)
    {
        if (!hs.ContainsKey(j))
        {
            hs.Add(j, 0);
        }
    }
}
IEnumerable<NameValuePair> unique = hs.Keys; 
```

当然，如果您使用的是 C# 3.0、.NET 3.5：

```
var hs = new HashSet<NameValuePair>();
hs.UnionWith(jaggedArray.SelectMany(item => item)); 
```

会成功的。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-25T21:26:53.940

你分析过你的代码吗？您确定 foreach 循环是瓶颈，而不是retriever.GetVehicles()？

我确实创建了一个小型测试项目，在其中伪造了检索器并让它返回 86.000 X 11 值。我的第一次尝试运行了 5 秒，创建了包含的数据。

我对键和值都使用了相同的值，其中第一个键是“0#0”，最后一个键是“85999#10”。

然后我切换到向导。结果相同。

然后我把钥匙变长了，像这样：

```
 var s = Guid.NewGuid().ToString();
        return s + s + s + s + s + s + s+ s + s + s; 
```

现在花了将近10秒。

然后我把钥匙弄得非常长，并且出现了内存不足的异常。我的计算机上没有交换文件，所以我立即得到了这个异常。

你的钥匙有多长？您的虚拟内存消耗是性能不佳的原因吗？**********