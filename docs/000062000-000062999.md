# StackOverflow 问答 000062000-000062999

# php - PHP 失败时 Apache 回退

> ID：62012
> 
> 赞同：4
> 
> 时间：2008-09-15T09:16:30.643
> 
> 标签：php, apache, configuration

我想知道是否有人知道配置 apache 以返回静态 HTML 页面的方法，它（Apache）是否能够确定 PHP 已经死了？这将为开发人员提供一个优雅的解决方案来显示错误页面，而不是（最坏的情况）应该执行的 PHP 页面的源代码。

谢谢。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-15T09:30:30.330

仅当未正确配置 apache 以处理 php 文件时，才会显示 PHP 源代码。也就是说，当尚未定义适当的处理程序时。

出现错误时，可以在 php.ini 上配置显示的内容，主要是 display_errors 变量。这应该在生产环境中设置为 off 和 log_errors 为 on。

如果 php 真的死了，apache 将返回适当的 HTTP 状态代码（通常是 500）以及 ErrorDocument 指令定义的页面。如果它没有死，而是陷入了一个循环，据我所知，你无能为力。

您可以为不同的错误代码指定不同的页面。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-15T09:27:33.957

我假设这通常会导致 500 错误，您可以配置 apaches 500 处理程序以显示静态页面：

错误文档 500 /500error.html

您还可以在[apaches 文档站点上阅读有关错误处理程序的信息](http://httpd.apache.org/docs/2.0/custom-error.html)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-15T13:14:48.917

真正的问题是 PHP 致命错误不会导致 Apache 返回 500 代码。`E_FATAL`除了和之外的错误`E_PARSE`可以按照您喜欢的方式处理[`set_error_handler()`](http://www.php.net/set_error_handler)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-15T19:31:30.417

有两种使用 PHP 和 Apache 的方法。

```
1\. Install PHP as an Apache module: this way the PHP execution is a thread inside the apache process. So if PHP execution fails, then Apache process fails too. there is no fallback strategy.

2\. Install PHP as a CGI script handler: this way Apache will start a new PHP process for each request. If the PHP execution fails, then Apache will know that, and there might be a way to handle the error. 
```

无论您安装 PHP 的方式如何，当 PHP 执行失败时，您都可以处理`php.ini`文件中的错误。

# asp.net - ASP.NET的登录控制问题

> ID：62013
> 
> 赞同：6
> 
> 时间：2008-09-15T09:19:11.993
> 
> 标签：asp.net

我建立了一个网站来使用[此页面](http://msdn.microsoft.com/en-us/library/ms998347.aspx)上所写的 SqlMembershipProvider 。

我跟着每一步。我有数据库，我修改了 Web.config 以使用此提供程序，使用正确的连接字符串，并且身份验证模式设置为 Forms。创建了一些用户进行测试。

我创建了一个 Login.aspx 并将 Login 控件放在上面。一切正常，直到用户可以登录为止。

我调用 Default.aspx，它被重定向到 Login.aspx，我输入用户和正确的密码。没有错误信息，似乎没有任何问题，但我再次看到登录表单，输入用户的登录信息。但是，如果我在浏览器中检查 cookie，我可以看到具有指定名称的 cookie 存在。

我已经尝试自己处理这些事件并检查其中发生了什么，但没有成功。

我正在使用 VS2008，文件系统中的网站，SQL Express 2005 来存储 aspnetdb，没有角色管理，用 K-Meleon、IE7.0 和 Chrome 进行了测试。

有任何想法吗？

**解决方案：**在与 Rob 联系后，我们得到了理想的解决方案，现在是公认的答案。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-15T10:15:03.827

## RE：接受的答案

我**不**喜欢给出的黑客攻击。

我有一个使用名为“ *login.aspx* ”的登录表单的站点，并且一切**正常**。我认为我们实际上应该找到答案而不是破解。由于所有 [大概] 测试站点都可以工作。**您认为我们不应该实际使用 StackOverflow 来查找 ACTUAL 问题吗？**（使它比其他任何地方都更有用？）

在**LoginCtl_Authenticate**事件中，您是否将**EventArgs.Authenticated**属性设置为**true**？

例如

```
protected void LoginCtl_Authenticate(object sender, AuthenticateEventArgs e)
{
   // Check the Credentials against DB
   bool authed = DAL.Authenticate(user, pass);
   e.Authenticated = authed;
} 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-15T18:56:04.853

我已经检查了您发送给我的文件中的代码（再次感谢您发送它们）。

**注意：我没有测试过这个，因为我没有安装数据库等。**

但是，我很确定这是问题所在。

您需要为 ASP.NET 控件设置*MembershipProvider*属性。为它们定义：

```
<asp:Login ID="Login1" runat="server" 
    MembershipProvider="MySqlMembershipProvider">
    <LayoutTemplate>
        <!-- template code snipped for brevity -->
    </LayoutTemplate>
</asp:Login> 
```

和..

```
<asp:CreateUserWizard ID="CreateUserWizard1" runat="server" 
    MembershipProvider="MySqlMembershipProvider">
        <WizardSteps>
            <asp:CreateUserWizardStep runat="server" />
            <asp:CompleteWizardStep runat="server" />
        </WizardSteps>
    </asp:CreateUserWizard> 
```

然后，这会将控件绑定到具有给定名称（您已在 Web.Config.xml 中指定的名称）的成员资格提供程序。

在您的解决方案中试一试，让我知道您的进展情况。我希望这对你有用:)

### 编辑

我还应该补充一点，我知道您不需要这样做，因为设置了默认提供程序，但是我*过去*遇到过问题。我最终将它们全部设置为手动并且一切正常。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-15T09:51:36.940

您通常有一个包含通常可访问的表单的初始文件夹和一个包含所有登录保护项目的单独文件夹。在初始文件夹中，您有一个 webconfig：

```
 <!--Deny all users -->
   <authorization>
     <deny users="*" />
   </authorization> 
```

在另一个文件夹中，您可以放置​​一个单独的 webconfig，其设置如下：

```
 <!--Deny all users unless autherticated -->
   <authorization>
     <deny users="?" />
   </authorization> 
```

如果您想进一步完善它，您可以只允许访问特定角色。

```
<configuration>
   <system.web>
      <authorization>
         <allow roles="Admins"/>
         <deny users="*"/>
      </authorization>
   </system.web>
</configuration> 
```

这将拒绝任何没有管理员角色的人的访问权限，他们只有在成功登录后才能访问。

如果你想要一些好的背景，我推荐 [ASP.NET Membership上与 Miguel Castro 合作的 DNR 电视剧集](http://www.dnrtv.com/default.aspx?showNum=20)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-15T09:41:27.620

您登录时使用的用户名的作用是什么？您是否允许此角色访问 Default.aspx？

我曾经（很久以前）经历过一次，然后去了“doh！” 当我意识到甚至管理员角色都无法访问主文件夹时！

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-15T09:53:54.330

不久前我遇到了类似的问题，我记得是通过*不将登录页面命名为“login.aspx”*来解决的。只需将其命名为其他名称（例如 userLogin.aspx）就可以为我解决了。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-11-17T09:24:37.993

我刚刚解决了发生这种情况的问题。查看您的会员提供商的应用程序名称。 [http://weblogs.asp.net/scottgu/archive/2006/04/22/Always-set-the-_2200_applicationName_2200_-property-when-configuring-ASP.NET-2.0-Membership-and-other-Providers.aspx](http://weblogs.asp.net/scottgu/archive/2006/04/22/Always-set-the-_2200_applicationName_2200_-property-when-configuring-ASP.NET-2.0-Membership-and-other-Providers.aspx)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-15T09:42:31.907

您是否检查过重定向路径是否正在发送到登录表单？我想它是**ReturnURL**吗？

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-15T09:48:02.423

@Jon：我还没有使用角色。如果我检查 Web Admin Tool，它会显示： Roles are not enabled 。

@Rob：是的，它就在那里。

我还按顺序检查了事件：LoggingIn、Authenticate、LoggedIn，因此它遵循正确的路径，但没有重定向，也没有看到它已通过身份验证。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-15T10:10:33.947

您`requireSSL="true"`的 web.config 中有吗？我和你有类似的症状。如果将 requireSSL 设置为 true，则还有一些[其他注意事项](http://msdn.microsoft.com/en-us/library/ms998347.aspx#paght000022_additionalconsiderations)。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-15T10:27:45.263

@Rob：从您的角度来看，您是对的。

从我的角度来看，检查一些事情是我的测试项目。如果它以任何方式工作，那适合我。我在网上没有发现任何类似的问题，所以它可能是别的东西，绝对与 ASP.NET 无关。

不过我是开放的，所以下次我也可以说：啊哈，我知道了！

我重新开始了这个项目：

Default.aspx：添加了 LoginStatus 和 LoginName 控件

Login.aspx：添加了 Login 控件和 CreateUserWizard 控件

web.config：添加

```
<authentication mode="Forms">
    <forms name="SqlAuthCookie" timeout="10" loginUrl="Login.aspx"/>
</authentication>
<authorization>
    <deny users="?"/>
    <allow users="*"/>
</authorization>
<membership defaultProvider="MySqlMembershipProvider">
    <providers>
        <clear/>
        <add name="MySqlMembershipProvider" connectionStringName="MyLocalSQLServer" applicationName="MyAppName" type="System.Web.Security.SqlMembershipProvider, System.Web, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a"/>
    </providers>
</membership> 
```

和

```
<connectionStrings>
    <add name="MyLocalSQLServer" connectionString="Initial Catalog=aspnetdb;data source=iballanb\sqlexpress;uid=full;pwd=full;"/>
</connectionStrings> 
```

创建数据库，创建一个名为*full*`aspnet_regsql -E -S iballanb\sqlexpress -A all`的 SQL 用户，密码为*full*。

 **启动项目，我被重定向到 Login.aspx，创建一个用户，它是在数据库中创建的。将用户数据输入登录表单，捕获事件：LoggingIn、Authenticate、LoggedIn，所以我已登录（我在这些事件中不做任何事情，我不验证自己，我只对被触发的内容感兴趣并且按什么顺序）。RedirectURL 正确指向 Default.aspx，但没有效果。

到目前为止就是这样。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-15T10:39:14.907

如果您要覆盖事件，您是在**调用默认实现吗？**如果您覆盖它们以确认它们的执行，那么实际代码也不会被执行，这可能是管道中断..

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2013-07-16T14:41:13.770

尝试添加路径元素。它必须与您的虚拟站点路径相同，例如，如果您测试到 /localhost/Authentication

路径必须是 = "/Authentication"

```
<forms loginUrl="Login.aspx" protection="All" timeout="30" name="AuthTestCookie"
path="/Authentication" requireSSL="false" slidingExpiration="true"
defaultUrl="default.aspx" cookieless="UseCookies" enableCrossAppRedirects="false"/> 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2015-11-20T16:24:46.657

我知道这是一篇旧帖子，但我找到了一个额外的答案......对于将来遇到这个问题的其他人，我发现我的 web.config 文件以某种方式在底部添加了以下内容（不确定如何）。一旦我评论了*出来，它工作得很好:)即使我在文件中正确设置了上述所有内容，但这一行让我头痛了一个多小时......*

 *```
<system.webServer>
  <modules>
    <remove name="FormsAuthentication" />
  </modules>
</system.webServer> 
```

# wse2.0 - WSE 2.0 引发 wse910 错误

> ID：62027
> 
> 赞同：0
> 
> 时间：2008-09-15T09:34:11.303
> 
> 标签：wse2.0

我必须使用[Microsoft Web Services Enhancements](http://msdn.microsoft.com/en-us/library/ms977323.aspx) 2.0 服务，当服务器和客户端之间的时间差超过 5 分钟时，它会引发 wse910 错误。

我在很多地方读到设置`timeToleranceInSeconds`,`ttlInSeconds`和`defaultTtlInSeconds`值应该会有所帮助，但只有设置客户端机器的时钟才能解决问题。

有什么经验吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-09-16T00:12:42.767

[这](http://geeknotes.wordpress.com/2007/03/21/more-wse-issues-timestamp-validation-and-clock-skew/)有帮助吗？它还提到在客户端和服务器上设置 timeToleranceInSeconds 和 defaultTtlInSeconds。

# command-line - VS2008 命令提示符 + Cygwin

> ID：62029
> 
> 赞同：13
> 
> 时间：2008-09-15T09:38:26.940
> 
> 标签：command-line, cygwin

我对构建、TFS 访问等使用 VS2008 命令提示符，对 grep、vi 和类 unix 工具使用 cygwin 提示符。有什么方法可以将 vcvars32.bat 功能“导入”到 cygwin 环境中，以便我可以从 cygwin 本身调用“tfs checkout”？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-09-15T09:41:42.893

根据[此页面](http://www.cs.ucl.ac.uk/research/vr/Dive/Local/compile.html)，您需要：

“根据您的喜好，您可以将编译所需的变量直接添加到您的环境中，或者使用 vcvars32.bat 脚本为您设置它们。请注意，您必须从 cygwin bash shell 编译，使用 vcvars32，首先运行一个 DOS shell，然后运行 ​​vcvars32.bat，然后从安装 cygwin 的目录运行 cygwin.bat。您可以通过添加包含 vcvars32 的目录（位于 \Microsoft Visual Studio\VC98\bin 下）和包含cygwin.bat 到你的路径。”

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-10-03T19:18:00.190

这是我配置 Visual Studio 并启动 mintty 的示例 Cygwin.bat 文件

```
@echo off
@REM Select the latest VS Tools
IF  EXIST %VS100COMNTOOLS% (
    CALL "%VS100COMNTOOLS%\vsvars32.bat"
    GOTO :start_term
)

IF  EXIST %VS90COMNTOOLS% (
    CALL "%VS90COMNTOOLS%\vsvars32.bat"
    GOTO :start_term
)

IF  EXIST %VS80COMNTOOLS% (
    CALL "%VS80COMNTOOLS%\vsvars32.bat"
    GOTO :start_term
)

:start_term

C:
chdir C:\cygwin\bin
START mintty.exe -i /Cygwin-Terminal.ico - 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-07-15T21:35:27.920

witkamp 的答案适用于 vs2005——对于 vs2008，使用

调用“C:\Program Files (x86)\Microsoft Visual Studio 9.0\VC\vcvarsall.bat”

# c# - 单元测试 Monorail 的 RedirectToReferrer()

> ID：62034
> 
> 赞同：1
> 
> 时间：2008-09-15T09:40:40.197
> 
> 标签：c#, unit-testing, castle-monorail

我正在尝试为调用该`Controller.RedirectToReferrer()`方法的操作方法编写单元测试，但收到“没有可用的推荐人”消息。

如何隔离和模拟这种方法？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-15T10:18:15.957

你有没有想过创建一个[测试替身](http://xunitpatterns.com/Test%20Double.html)？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-26T02:47:39.277

在*我*正在使用的主干版本 r5299 中，我必须这样做来模拟 RedirectToReferrer。我认为它在最近的提交中发生了变化，我不确定。

```
[TestFixture]
public class LoginControllerTests : GenericBaseControllerTest<LoginController>
{
    private string referrer = "http://www.example.org";
    protected override IMockRequest BuildRequest()
    {
        var request = new StubRequest(Cookies);
        request.UrlReferrer = referrer;

        return request;
    }

    protected override IMockResponse BuildResponse(UrlInfo info)
    {
        var response = new StubResponse(info,
                                        new DefaultUrlBuilder(),
                                        new StubServerUtility(),
                                        new RouteMatch(),
                                        referrer);
        return response;
    } 
```

等等等等

奇怪的是，您需要调动*响应*`RedirectToReferrer`才能使其正常工作。我不得不在单轨资源中爬行才能弄清楚。

# ruby-on-rails - Rails 模型验证器破坏了早期的迁移

> ID：62038
> 
> 赞同：5
> 
> 时间：2008-09-15T09:42:18.570
> 
> 标签：ruby-on-rails, migration, validation

我在 Rails 应用程序中有一系列迁移，其中包括以下步骤：

1.  创建“用户”模型的基本版本
2.  创建此模型的实例 - 我的系统中至少需要一个初始用户，以便您可以登录并开始使用它
3.  更新“用户”模型以添加新字段/列。

现在我在这个新字段/列上使用“validates_inclusion_of”。这在我最初的开发机器上运行良好，它已经有一个应用了这些迁移的数据库。但是，如果我转到一台新机器并运行所有迁移，则第 2 步将失败，因为 validates_inclusion_of 失败，因为尚未将迁移 3 中的字段添加到模型类中。

作为一种解决方法，我可以注释掉“validates_...”行，运行迁移，然后取消注释，但这并不好。

最好重新排序我的迁移，以便在添加所有列之后最后创建用户（步骤 2）。

不过，我是一个 Rails 新手，所以我想我会问处理这种情况的首选方法是什么:)

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-15T10:55:59.140

避免此问题的最简单方法是`rake db:schema:load`在第二台机器上使用，而不是 db:migrate。`rake db:schema:load`使用 schema.rb 加载最新版本的架构，而不是从头开始迁移它。

如果在部署到生产机器（保留数据很重要）时遇到此问题，您可能必须将迁移合并到一个文件中而不会发生冲突。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-15T13:52:45.723

您可以在迁移中声明一个具有相同名称的类，它将覆盖您的应用程序/模型之一：

```
class YourMigration < ActiveRecord::Migration

  class User < ActiveRecord::Base; end

  def self.up
    # User.create(:name => 'admin')
  end

end 
```

不幸的是，您的 IDE 可能会尝试基于此类（Netbeans 会）自动完成，并且您不能在其中使用您的模型逻辑（除非您复制它）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-09-23T04:29:16.397

我现在必须这样做。根据 BiHi 的建议，我手动加载模型，然后在需要的地方重新定义方法。

```
load(File.join(RAILS_ROOT,"app/models/user.rb"))
class User < ActiveRecord::Base
  def before_validation; nil; end # clear out the breaking before_validation
  def column1; "hello"; end       # satisfy validates_inclusion_of :column1
end 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2020-07-15T20:52:13.007

在您的迁移中，您可以保存您的用户跳过 ActiveRecord 验证：

```
class YourMigration < ActiveRecord::Migration

  def up
    user = User.new(name: 'admin')
    user.save(validate: false)
  end

end 
```

# bash - 如何将 exec 参数中的管道用于查找命令？

> ID：62044
> 
> 赞同：78
> 
> 时间：2008-09-15T09:45:00.153
> 
> 标签：bash, shell, find

我正在尝试构建一个 find 命令来使用两个不同的可执行文件处理目录中的一堆文件。不幸的是，`-exec`在 find 上不允许使用管道，甚至`\|`因为 shell 首先解释该字符。

这就是我正在尝试做的事情（这不起作用，因为管道结束了 find 命令）：

```
find /path/to/jpgs -type f -exec jhead -v {} | grep 123 \; -print 
```

* * *

## 回答 #1

> 赞同：88
> 
> 时间：2008-09-15T09:54:10.147

试试这个

```
find /path/to/jpgs -type f -exec sh -c 'jhead -v {} | grep 123' \; -print 
```

或者，您可以尝试将 exec 语句嵌入到 sh 脚本中，然后执行以下操作：

```
find -exec some_script {} \; 
```

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-09-15T10:52:50.723

稍微不同的方法是使用 xargs：

```
find /path/to/jpgs -type f -print0 | xargs -0 jhead -v | grep 123 
```

我总是发现它更容易理解和适应（ -print0 和 -0 参数对于处理包含空格的文件名是必要的）

这*可能*（未经测试）比使用 -exec 更有效，因为它将文件列表通过管道传输到 xargs 并且 xargs 确保 jhead 命令行不会变得太长。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-15T09:56:30.953

`-exec`您只能运行带有一些参数的单个可执行文件，而不是任意的 shell 命令。为了避免这种情况，您可以使用`sh -c '<shell command>'`.

请注意，使用的`-exec`效率非常低。对于找到的每个文件，必须再次执行该命令。如果你能避免这种情况会更有效率。（例如，按照 Palmin 的建议，通过移动外部[或](https://stackoverflow.com/questions/62044/how-do-i-use-a-pipe-in-the-exec-parameter-for-a-find-command#62142)管道`grep`的`-exec`结果。）`find``xargs`

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2011-02-27T03:29:00.953

对这种类型的任务使用`find`命令可能不是最好的选择。我经常使用以下命令来查找包含请求信息的文件：

```
for i in dist/*.jar; do echo ">> $i"; jar -tf "$i" | grep BeanException; done 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-15T09:52:47.797

由于这会输出一个列表，您不会：

```
find /path/to/jpgs -type f -exec jhead -v {} \; | grep 123 
```

或者

```
find /path/to/jpgs -type f -print -exec jhead -v {} \; | grep 123 
```

将您的 grep 放在 find -exec 的结果上。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2018-02-01T15:16:08.003

还有另一种方法可以做到，但它也很贫民窟。

使用 shell 选项 extquote 您可以执行类似的操作，以便查找 exec 内容，然后将其通过管道传输到 sh。

```
root@ifrit findtest # find -type f -exec echo ls $"|" cat \;|sh
filename 
```

```
root@ifrit findtest # find -type f -exec echo ls $"|" cat $"|" xargs cat\;|sh
h 
```

我只是想我会补充一点，因为至少在我想象它的方式上，它更接近于 OP 在 exec 中使用管道的原始问题。

# flash - 如何做 Flash 伪流？

> ID：62062
> 
> 赞同：7
> 
> 时间：2008-09-15T09:55:40.770
> 
> 标签：flash, video, streaming, flv

我需要构建一些东西，开始在文件中途向 Flash 播放器提供 H.264 编码的视频（以支持跳到视频中尚未缓冲的点）。

目前，视频采用 FLV 容器格式，但可以选择转码。我设法为给定的字节偏移量重写了文件头和元数据信息。这适用于较旧的视频，但不适用于 H.264 编码文件。我怀疑这是因为文件中的视频标签也必须更改，这是不可行的（它会占用太多的处理能力）。

什么是“正确”的方法？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-15T11:10:31.430

@yoavf - 我认为 OP 对 FLV 文件内按需流式传输 h.264 的服务器端方面感兴趣。我认为重用现有球员对他来说会很好。或者也许那是我自己的需求出来了？<:S

从 yoavf 的第二个链接，还有另一个链接到 Tinic Uro 的[网络上的视频发生了什么？](http://www.kaourantin.net/2007/08/what-just-happened-to-video-on-web_20.html). 相关报价：

> 是否可以将 H.264 流放入传统的 FLV 文件结构中？会的，但我们强烈鼓励每个人都接受新的标准文件格式。在流式传输 H.264 时，FLV 结构存在功能限制，如果不重新设计文件格式，我们就无法克服这些限制。这是我们摆脱传统 FLV 文件结构的原因之一。对于 FLV 流，专门处理序列头和尾端是很棘手的。

因此，似乎可以修改 ffmpeg 编码（如果这是您获取 FLV 的方式，就像我一样），或者可以进入新格式。嗯……

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-19T12:30:18.670

Flash 播放器只有在下载 MOOV atom 后才能开始播放 H.264 视频。现有的伪流提供程序只给您一个 FLV 标头 - 文件的前 13 个字节或硬编码的一个 - 然后从给定的偏移量提供文件。如果你想制作一个 H.264 伪流媒体，你需要让它输出 FLV 头，然后是 MOOV 原子，然后从给定的偏移量提供文件的其余部分。如果不使用 FLV 容器，则不需要 FLV 标头，但仍需要 MOOV 原子。

不幸的是，我认为您无法使用磁盘上文件中的 MOOV 原子；它包含的信息不适合您提供的文件片段。因此，您必须解析现有原子并生成适合文件服务部分的您自己的原子。

如果 H.264 文件中有复杂的结构，则伪流可能会更加复杂。如果解析文件不可行，恐怕您可能无法伪流媒体。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-15T16:51:32.267

你可以做两件事：

1) 使用 lighttpd，它是 mp4 流媒体插件，可以即时生成所需的流媒体容器

2) 创建一个关键帧 FLV 并使用伪流脚本（如 XMOOV）流式传输您的文件。

如果您需要 mp4/aac，您可以将它们放在 FLV 容器中，这让 adobe 很懊恼，但它确实有效。

# mysql - MySQL 面试问题

> ID：62069
> 
> 赞同：9
> 
> 时间：2008-09-15T09:58:36.127
> 
> 标签：mysql

我被要求筛选一些 MySQL DBA / 开发人员职位的候选人，以担任需要企业级技能集的角色。

我自己是一个 SQL Server 人，所以我知道从这个角度来看我会在可扩展性/设计等方面寻找什么，但是关于 MySQL，我应该问什么具体的问题吗？

理想情况下，我想向他们询问有关 MySQL 的企业级功能，他们通常只在处理大型数据库时使用这些功能。需要将企业开发人员与家庭/小型网站类型的人分开。

谢谢。

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2008-09-15T17:18:10.720

尽管 SQL Server 和 MySQL 都是 RDBM，但 MySQL 有许多独特的功能可以说明新手和专家之间的区别。

你的第一步应该是确保候选人能够舒适地使用命令行，而不仅仅是 phpMyAdmin 等 GUI 工具。在面试期间，尝试让应聘者编写 MySQL 代码来创建数据库表或添加新索引。这些是非常基本的查询，但正是 GUI 工具阻止新手掌握的类型。您可以与更熟悉 MySQL 的人仔细检查答案。

候选人能否展示 JOIN 如何工作的知识？例如，尝试要求候选人构造一个查询，该查询返回表一中没有匹配条目存在于表二中的所有行。答案应该涉及 LEFT JOIN。

要求候选人讨论备份策略，以及每种策略的优缺点。考生应该知道直接备份数据库文件不是一个有效的策略，除非所有的表都是 MyISAM。候选人绝对应该提到 mysqldump 作为备份的基石。更复杂的备份解决方案包括 ibbackup/innobackup 和 LVM 快照。理想情况下，候选人还应该讨论备份如何影响性能（一种常见的解决方案是使用从服务器进行备份）。

候选人是否有复制经验？有哪些常见的复制配置以及每种配置的各种优势？最常见的设置是主从设置，允许应用程序将 SELECT 查询卸载到从服务器，同时使用从服务器进行备份以防止主服务器出现性能问题。另一个常见的设置是 master-master，主要好处是能够在不影响性能的情况下进行架构更改。确保候选人讨论常见问题，例如克隆从属服务器（[mysqldump + binlog 位置的表示法](http://dev.mysql.com/doc/refman/5.0/en/mysqldump.html#option_mysqldump_master-data)），使用负载均衡器或 MySQL 代理进行负载分配，通过将较大的查询分成块来[解决从属滞后](http://www.mysqlperformanceblog.com/2007/10/12/managing-slave-lag-with-mysql-replication/)，以及如何将从属服务器提升为成为新的主人。

候选人将如何解决绩效问题？他们是否对底层操作系统和硬件有足够的了解来诊断瓶颈是 CPU 限制、IO 限制还是网络限制？他们能否演示如何使用[EXPLAIN](http://www.devshed.com/c/a/MySQL/Analyzing-Queries-for-Speed-with-EXPLAIN/)来发现索引问题？他们是否提到了慢查询日志或配置选项，例如键缓冲区、tmp 表大小、innodb 缓冲池大小等？

候选人是否欣赏每个存储引擎的微妙之处？（MyISAM、InnoDB 和 MEMORY 是主要的）。他们是否了解每个存储引擎如何优化查询，以及如何处理锁定？至少，候选人应该提到 MyISAM 发出一个表级锁定，而 InnODB 使用行级锁定。

对实时数据库进行模式更改的最安全方法是什么？候选人应提及主-主复制，以及通过创建具有所需配置的新表并使用 mysqldump 或 INSERT INTO ... SELECT 后跟 RENAME TABLE 来避免 ALTER TABLE 的锁定和性能问题。

最后，对专业人士的唯一真正衡量标准是经验。如果候选人不能指出在高可用性环境中管理大型数据集的特定经验，他们可能无法在纯粹的智力水平上支持他们所拥有的任何知识。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-15T10:13:35.873

我会询问各种存储引擎之间的差异，它们的感知优缺点。

坚决涵盖复制，并深入研究复制的缺点，尤其是在使用具有自动增量键的表时。

如果他们仍在您身边，请询问复制延迟，它的影响和监控它的标准模式。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-15T10:05:34.613

我认为这取决于数据库类型：事务性还是数据仓库？

无论如何，对于所有类型，我都会询问特定于 MySQL 复制和集群、性能调整和监控概念的问题。

# c# - 是否有使用 .NET 的转换引擎或库？

> ID：62077
> 
> 赞同：3
> 
> 时间：2008-09-15T10:05:11.493
> 
> 标签：c#, transformation, altova

我们正在寻找一个转换库或引擎，它可以读取任何输入（EDIfact 文件、CSV、XML 之类的东西。因此，包含必须转换为已知业务对象结构的数据的文件（或 Web 服务结果）。）这个应使用自定义规则将数据转换为现有业务对象。XSLT 既复杂（学习）又简单（功能不足）

有人可以推荐一个 C# 库或引擎吗？我已经看过 Altova MapForce，但我希望我可以向数十人发送一些东西，他们将构建/设计自己的转换，而无需支付数十个 Altova 许可证。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-15T12:54:48.373

如果您认为 XSLT 对您来说太难了，我认为您可以尝试使用 LINQ to XML 来解析 XML 文件。它集成在 .NET 框架中，您可以使用 C#（或者，如果您使用 VB.NET 9.0，则更好，因为 XML 文字）而不是学习另一种语言。您可以毫不费力地将它与现有应用程序集成，并且不会出现 XSLT 出现的语言和文件管理之间的范式不匹配。

[Microsoft LINQ to XML](http://www.google.it/url?sa=t&source=web&ct=res&cd=3&url=http%3A%2F%2Fmsdn.microsoft.com%2Fen-us%2Flibrary%2Fbb387098.aspx&ei=6VrOSLmTN4qO8wThtpDsBQ&usg=AFQjCNEk8C3xS7mIRT5zr-2zfmDe9tYDqQ&sig2=uY2Nb-rBbWq9lstqUXyARQ)

当然，它不是用于解析文件的框架或库，但 XSLT 都不是，所以...

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-15T15:15:45.710

XSLT 不适用于 EDI 和 CSV。如果您想要一个完全通用的转换引擎，您可能需要花一些钱。我曾使用[Symphonia](http://www.symphonia3.com/)处理 EDI，它有效，但它不是免费的。

问题是您所描述的问题听起来“企业”（我相信没有人会为了好玩而使用 EDI），所以没有开源/免费工具来处理这些东西。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-15T11:56:50.867

我不会这么快就认为 XSLT 太复杂或不包含您需要的功能而将其驳回。

有很多书籍/网站描述了您需要了解的有关 XSLT 的所有信息。是的，有一点学习曲线，但不需要太多学习，如果你需要帮助，总有一个很棒的社区，比如 stackoverflow ；-)

至于缺少功能，您始终可以使用 XsltArgumentList.AddExtensionObject() 方法扩展 xslt 并从 xslt 调用 .NET 程序集，这将为您提供所需的功能。

[MSDN在这里](http://msdn.microsoft.com/en-us/library/system.xml.xsl.xsltargumentlist.addextensionobject.aspx)有一个很好的例子

的确，MapForce 和 Biztalk 应用程序使创建 xslt 变得非常容易，但它们也需要一些成本。此外，根据您的用户群（假设非开发人员），我认为您会发现这些应用程序有自己的学习曲线，并且通常功能过于丰富，无法满足您的需求。

我建议您考虑针对您的用户需求构建和分发您自己的自定义映射工具。

此外，如果您需要一个库来协助文件转换，我会推荐SourceForge 的[FileHelpers](http://filehelpers.sourceforge.net/)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-29T03:18:06.140

DataDirect Technologies 有一款产品可以做到这一点。在[http://www.xmlconverters.com/](http://www.xmlconverters.com/)有一个名为 XmlConverters 的库，可以将 EDI 转换为 XML，反之亦然。还有 CSV、JSON 和其他格式的转换器。这些库以 100% .net 托管代码和 100% Java 并行端口的形式提供。.net 端支持 XmlReader 和 XmlWriter，而 Java 端支持 SAX、StAX 和 DOM。两者都支持流和读取器/写入器 I/O。DataDirect 也有一个为将关系数据与 EDI 和 XML 合并而优化的 XQuery 引擎，但它仅适用于 Java。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-15T10:35:00.253

[Microsoft BizTalk Server](http://www.microsoft.com/biztalk/en/us/default.aspx)在这方面做得很好。

# php - 比较运行时

> ID：62079
> 
> 赞同：2
> 
> 时间：2008-09-15T10:06:19.103
> 
> 标签：php, python, benchmarking

我正在尝试对 PHP 与 Python（以及可能我必须包括的任何其他语言）进行一些准确的运行时比较。脚本中的时间不是我的问题，但脚本中的时间并不能说明从请求运行脚本到输出的所有内容。

> 1）真的值得考虑这些事情吗？
> 
> 2）假设值得考虑，我该怎么做？

我使用的是 Mac，所以我可以访问 Linux 命令，而且我不怕编译/创建命令来帮助我，我只是不知道如何编写这样的命令。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-15T10:18:05.207

如果您的想法是比较语言，我会说它们之外的任何内容都与比较目的无关。

尽管如此，您可以使用 time 命令来测量所有内容，并将其与脚本中的时间进行比较。

像这样：

```
$ time script.php
HI!

real    0m3.218s
user    0m0.080s
sys     0m0.064s 
```

它会给你时钟时间、用户时间（php解释器）和系统时间（操作系统时间）

如果您正在考虑 Web，那么它会变得更加困难，因为您将混合 Web 服务器开销，并且如果您使用的是 WSGI v/s mod_php，这并不总是很容易比较。然后，您还必须将探针连接到链的网络服务部分

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-15T10:20:04.017

1.  如果您正在优化代码，则值得考虑速度。您通常应该知道为什么要优化代码（例如：现有代码库中的特定任务花费的时间太长，而不是“我听说 PHP 比 Python 慢”）。如果您实际上不打算切换语言，*则不*值得考虑速度。仅仅因为一个小模块做的事情稍微快一点并不意味着用另一种语言重写你的应用程序是一个好主意。除了速度之外，选择语言还有许多其他因素。

2.  当然，您进行基准测试。多次运行这两个代码库并比较时间。如果两个脚本都可以从 shell 执行，您可以使用[time](http://unixhelp.ed.ac.uk/CGI/man-cgi?time)命令，或者使用每种语言的相应基准测试功能；后一种情况自然在很大程度上取决于实际语言。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-15T10:23:55.223

好吧，您可以使用“时间”命令来帮助：

```
you@yourmachine:~$ time echo "hello world"
hello world

real    0m0.000s
user    0m0.000s
sys 0m0.000s
you@yourmachine:~$ 
```

这将绕过环境之外的时间。

至于您是否需要实际安排额外工作的时间……这完全取决于您在做什么。我认为这是针对某种 Web 应用程序的，所以它取决于您使用的框架的实际工作方式……它是否缓存了某种已编译（或解析）的脚本版本？如果是这样，那么启动时间将完全无关紧要（因为第一次命中将是唯一存在启动时间的命中）。

此外，请确保在循环中运行您的测试，以便您可以折扣第一次运行（如果需要，可以在报告中包含第一次运行的成本）。我已经在 J​​ava 中进行了一些测试，但由于 JIT 的工作，第一次运行总是最慢（在 PHP、Python 和您尝试的任何其他语言中可能存在同样的命中）。

# javascript - E4X：分配给根节点

> ID：62086
> 
> 赞同：1
> 
> 时间：2008-09-15T10:12:05.283
> 
> 标签：javascript, apache-flex, air, e4x

我在这里使用 Adob​​e Flex/Air，但据我所知，这适用于所有 JavaScript。我遇到过几次这个问题，并且必须有一个简单的解决方案！

假设我有以下 XML（使用 e4x）：

```
var xml:XML = <root><example>foo</example></root> 
```

我可以使用以下代码更改示例节点的内容：

```
xml.example = "bar"; 
```

但是，如果我有这个：

```
var xml:XML = <root>foo</root> 
```

如何更改根节点的内容？

```
xml = "bar"; 
```

显然不起作用，因为我试图将字符串分配给 XML 对象。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-15T13:36:18.273

您似乎混淆了变量所包含的值。那作业

```
node = textInput.text; 
```

更改*变量* `node`指向的值，它不会更改`node`当前指向的对象的任何内容。要做你想做的事，你可以使用类的`setChildren`方法`XML`：

```
node.setChildren(textInput.text) 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-15T13:45:53.883

啊，谢谢你 Theo - 确实我在那里很困惑。我认为混乱的根源来自我能够分配的事实

```
textInput.text = node; 
```

我现在猜测只是隐式调用 XML.toString() 来转换 XML->String。setChildren() 是我正在寻找的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-15T11:04:39.603

如果您尝试更改文档的根元素，您实际上并不需要 - 只需丢弃现有文档并替换它即可。或者，只需将您的元素包装在更合适的根元素中（无论如何您都不应该编辑根节点），您就可以设置了。

当然，这并不能回答你的问题。有一个丑陋的 JS hack 可以做你想做的事，但请记住，它可能比上面做的要慢得多。无论如何，这里是：

```
var xml = <root>foo</root>; // </fix_syntax_highlighter>
var parser = new DOMParser();
var serializer = new XMLSerializer();

// Parse xml as DOM document
// Must inject "<root></root>" wrapper because  
// E4X's toString() method doesn't give it to us
// Not sure if this is expected behaviour.. doesn't seem so to me.
var xmlDoc = parser.parseFromString("<root>" + 
  xml.toString() + "</root>", "text/xml");

// Make the change
xmlDoc.documentElement.firstChild.nodeValue = "CHANGED";

// Serialize back to string and then to E4X XML()
xml = new XML(serializer.serializeToString(xmlDoc)); 
```

您可以忽略 fix_syntax_highlighter 注释。

# perl - Class::MethodMaker 究竟做了什么？

> ID：62102
> 
> 赞同：2
> 
> 时间：2008-09-15T10:26:10.227
> 
> 标签：perl

我想知道调用通过 Class::MethodMaker 创建的 getter/setter 时发生的调用顺序到底是什么？

MethodMaker 定义的 getter/setter 比本地的（在模块中覆盖）要贵多少？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-16T09:07:47.770

对于您关于 Class::MethodMaker 性能的问题，我没有简单的答案。正如前面提到的答案，您可以使用调试器来找出幕后发生的事情。但是，我知道 Class::MethodMaker在安装时会生成大量代码*。*这将向我表明三件不同的事情：

1.  关于运行时，它*可能*是整个方法生成器中速度更快的一面。为什么要在安装时生成大量代码？
2.  它会在您的磁盘上安装 O（兆字节）的代码！
3.  它在编译时可能会很慢，这取决于为简单的用例加载了生成代码的哪些部分。

你真的需要花几分钟来思考你真正需要什么。如果您想要自动生成简单的访问器方法，但要手动编写更复杂的东西，可以查看 Class::Accessor::Fast。或者，如果您想要最快的访问器方法，请研究 Class::XSAccessor，它的超简单方法作为 C/XS 代码运行，并且速度大约是最快的 Perl 访问器的两倍。（注意：我写了后一个模块，所以对此持保留态度。）

进一步的评论：如果您打算使用 PAR/PAR::Packer 工具包来打包您的应用程序，请注意 Class::MethodMaker 的大量代码会导致可执行文件大得多并且初始启动速度较慢时间。此外，C::MethodMaker 和 PAR 之间存在已知的不兼容性。但这可能被认为是一个 PAR 错误。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-15T12:23:55.060

这正是调试工具的用途:)

查看[perldebug](http://perldoc.perl.org/perldebug.html)文档，尤其是关于分析的部分。

特别是，使用 perl -dDProf filename.pl 运行脚本将生成一个 tt.out 文件，dprofpp 工具（随 Perl 分发）可以从中生成报告。

我使用了以下简单的测试脚本：

```
#!/usr/bin/perl

包Foo；
使用严格；
使用 Class::MethodMaker [ scalar => ['bar'], new => ['new'] ];

主包；
使用严格；

我的 $foo = 新的 Foo;
$foo->bar('baz');
打印 $foo->bar 。"\n";

```

使用 perl -d:DProf methodmakertest.pl 运行它，然后在输出上使用 dprofpp 给出：

```
[davidp@supernova:~/tmp]$ dprofpp tmon.out
Class::MethodMaker::scalar::scal0000 在外部有 1 个未堆叠调用
Class::MethodMaker::Engine::new 在外部有 1 个未堆叠调用
AutoLoader::AUTOLOAD 在外部有 -2 个未堆叠调用
总经过时间 = 0.08894 秒
  用户+系统时间 = 0.07894 秒
独家时间
%Time ExclSec CumulS #Calls sec/call Csec/c Name
 25.3 0.020 0.020 4 0.0050 0.0050 类::MethodMaker::Constants::BEG
                                             在
 25.3 0.020 0.029 12 0.0017 0.0025 类::MethodMaker::Engine::BEGIN
 12.6 0.010 0.010 1 0.0100 0.0100 DynaLoader::dl_load_file
 12.6 0.010 0.010 2 0.0050 0.0050 自动加载器::AUTOLOAD
 12.6 0.010 0.010 14 0.0007 0.0007 类::MethodMaker::V1Compat::reph
                                             rase_prefix_option
 0.00 0.000 0.000 1 0.0000 0.0000 类::MethodMaker::标量::scal00
                                             00
 0.00 0.000 0.000 1 0.0000 0.0000 类::MethodMaker::Engine::new
 0.00 - -0.000 1 - - DynaLoader::dl_undef_symbols
 0.00 - -0.000 1 - - 类::MethodMaker::bootstrap
 0.00 - -0.000 1 - - 警告::BEGIN
 0.00 - -0.000 1 - - 警告::unimport
 0.00 - -0.000 1 - - DynaLoader::dl_find_symbol
 0.00 - -0.000 1 - - DynaLoader::dl_install_xsub
 0.00 - -0.000 1 - - 通用::版本
 0.00 - -0.000 1 - - Foo::new

```

两个最昂贵的调用是 Class::MethodMaker::Constants::BEGIN 和 Class::MethodMaker::Engine::BEGIN 块，它们显然只在编译时调用，因此它们可能会稍微减慢脚本的编译速度，但随后的对象创建/访问器使用不受它的影响。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-15T12:07:39.780

真正的问题是：重要吗？

它是另一个访问器生成模块。这些模块都具有速度/功能权衡。只需选择一个可以提供您需要的一切的产品。访问器不会成为应用程序的瓶颈。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-15T12:19:20.143

@Leon Timmermans

我知道存在一些速度/功能折衷的事实，但想了解它的好坏程度？更好的是，如果我能获得具体的实现，以便更容易决定。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-15T15:18:43.533

继我之前的回答之后，如果您想详细了解幕后发生的事情，请在调试器中运行脚本并启用跟踪模式（perl -d filename.pl，然后说“t”进行跟踪，然后说“r " 来运行脚本；虽然期待很多输出！）。

# compiler-construction - 灵活的编译器管道定义

> ID：62106
> 
> 赞同：3
> 
> 时间：2008-09-15T10:27:51.003
> 
> 标签：compiler-construction, workflow, pipeline

我正在为 .NET 开发一个编译器框架，并且想要一种灵活的方式来定义管道。我考虑了以下选项：

*   世界自然基金会
*   自定义 XML 管道描述
*   代码中的自定义管道描述（使用 Nemerle 的宏为其定义语法）
*   其他基于代码的描述

要求：

*   不得仅依赖 .NET (3+) 的更高版本中的功能，因为它旨在跨平台并在托管内核之上使用，这意味着半受限的 .NET 功能。
*   必须允许有条件的管道构建，因此您可以指定某些命令行选项将对应于某些元素和顺序。

WWF 会很好，但不符合第一个要求。其他人会工作，但由于所涉及的工作而不是最佳的。

有谁知道几乎不需要修改就能满足这些目标的解决方案？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-15T13:47:20.290

如果您了解 Ruby，那么一个解决方案是编写一个简单的内部 DSL，它可以生成您需要的任何管道数据类型和读取器/写入器代码。生成 XML 是一种快速入门的方法。如果需要，您可以随时更改 DSL 以在以后生成另一种格式。

您可能还想查看[Microsoft Phoenix 编译器](http://en.wikipedia.org/wiki/Phoenix_(compiler_framework))项目以获取灵感。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-08T14:14:31.470

I know [Boo](http://boo.codehaus.org/) let you have fun with the compiler, not sure if it does in the manner you want.

# entity-framework - ADO.NET 实体框架教程

> ID：62110
> 
> 赞同：28
> 
> 时间：2008-09-15T10:30:51.307
> 
> 标签：entity-framework, ado.net

有谁知道关于 ADO.NET Entity Framework 的任何好的教程？

[在Stack OverFlow](https://stackoverflow.com/questions/42826/where-to-start-with-entity-framework)有一些有用的链接，我在[Jason 的 DotNet 架构博客](http://dotnet-architecture-jdo.blogspot.com/2008/08/adonet-entity-framework-part.html)上找到了一个教程，但是任何人都可以推荐任何其他好的教程吗？Microsoft 提供的任何在线教程或作为任何会议/课程材料的一部分？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-09-15T10:37:13.383

Microsoft 提供[.NET 3.5 增强培训套件](http://www.microsoft.com/downloads/details.aspx?FamilyID=355c80e9-fde0-4812-98b5-8a03f5874e96&displaylang=en)，其中包含 ADO.NET EF 的文档和示例代码

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-15T10:33:12.817

以下是 Julie Lerman 写的一些内容： [http ://www.thedatafarm.com/blog/2008/04/04/EightEntityFrameworkTutorialsOnDataDeveloperNET.aspx](http://www.thedatafarm.com/blog/2008/04/04/EightEntityFrameworkTutorialsOnDataDeveloperNET.aspx)

当然还有一些来自微软的信息：http: [//msdn.microsoft.com/en-us/library/bb386876.aspx](http://msdn.microsoft.com/en-us/library/bb386876.aspx)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-15T10:32:32.723

[来自MSDN](http://msdn.microsoft.com/en-us/library/bb399296.aspx)的示例应用程序

[以及来自ADO.NET 团队博客](http://blogs.msdn.com/adonet/)的一些内幕消息

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-15T10:41:21.097

试试这个链接，你可能会得到一些最好的想法......

[http://msdn.microsoft.com/en-us/library/aa697427(VS.80).aspx](http://msdn.microsoft.com/en-us/library/aa697427(VS.80).aspx)

[http://en.wikipedia.org/wiki/ADO.NET_Entity_Framework](http://en.wikipedia.org/wiki/ADO.NET_Entity_Framework)

这个不错试试这个......

[http://davidhayden.com/blog/dave/archive/2007/03/19/ADONETEntityFrameworkObjectServicesTutorial.aspx](http://davidhayden.com/blog/dave/archive/2007/03/19/ADONETEntityFrameworkObjectServicesTutorial.aspx)

[http://www.codeguru.com/csharp/.net/net_general/netframeworkclasses/article.php/c15489/](http://www.codeguru.com/csharp/.net/net_general/netframeworkclasses/article.php/c15489/) ..

# windows - 如何找到当前的 DNS 服务器？

> ID：62127
> 
> 赞同：5
> 
> 时间：2008-09-15T10:40:10.257
> 
> 标签：windows, delphi, networking, dns

我正在使用 Delphi，需要获取当前的 Windows DNS 服务器 IP 地址，以便进行查找。我应该调用什么函数来找到它？我现在唯一的解决方案是使用 ipconfig/all 来获取它，这太可怕了。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-15T10:56:10.687

使用函数 GetNetworkParams() 找到了一个不错的。似乎工作得很好。你可以在这里找到它： [http ://www.swissdelphicenter.ch/torry/showcode.php?id=2452](http://www.swissdelphicenter.ch/torry/showcode.php?id=2452)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-15T10:53:33.593

您真的需要知道什么是 DNS 服务器才能进行查找吗？

[这](http://delphi.about.com/od/networking/l/aa103100a.htm)是一个如何使用 2 个函数获取 IP 地址的解决方案：GetHostName 和 GetHostByName。我假设 GetHostByName 函数会执行您需要的查找，还是我错了？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-15T10:51:24.690

请参阅*[GetNetowrkParams](http://msdn.microsoft.com/en-us/library/aa365968(VS.85).aspx)*方法（Platform SDK：IP Helper）

# sql - 什么是涵盖索引？

> ID：62137
> 
> 赞同：67
> 
> 时间：2008-09-15T10:45:57.607
> 
> 标签：sql, database, indexing

我刚刚在一些数据库讨论中听说过涵盖索引这个术语——它是什么意思？

* * *

## 回答 #1

> 赞同：59
> 
> 时间：2008-09-15T10:51:35.253

*覆盖索引*是包含查询所需的所有（可能更多）列的索引。

例如，这个：

```
SELECT *
FROM tablename
WHERE criteria 
```

通常会使用索引来加快解析使用*条件*检索哪些行，但随后它将转到完整表来检索行。

但是，如果索引包含列*column1、column2*和*column3*，则此 sql：

```
SELECT column1, column2
FROM tablename
WHERE criteria 
```

并且，如果可以使用特定索引来加快解析要检索的行，则该索引已经包含您感兴趣的列的值，因此它不必去表中检索行，但可以直接从索引中产生结果。

如果您看到典型查询使用 1-2 列来解析哪些行，然后通常添加另外 1-2 列，则也可以使用此方法，附加这些额外的列可能是有益的（如果它们全部相同） ) 到索引，以便查询处理器可以从索引本身获取所有内容。

这是[一篇文章：Index Covering Boosts SQL Server Query Performance](http://www.devx.com/dbzone/Article/29530)关于该主题。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-09-15T10:52:54.563

覆盖索引只是一个普通的索引。如果它可以满足查询而不需要分析数据，则称为“覆盖”。

例子：

```
CREATE TABLE MyTable
(
  ID INT IDENTITY PRIMARY KEY, 
  Foo INT
) 

CREATE NONCLUSTERED INDEX index1 ON MyTable(ID, Foo)

SELECT ID, Foo FROM MyTable -- All requested data are covered by index 
```

这是从 SQL Server 检索数据的最快方法之一。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2016-06-13T22:58:53.200

覆盖索引是“覆盖”特定表所需的所有列的索引，完全不需要为给定的查询/操作访问物理表。

由于索引包含所需的列（或它们的超集），表访问可以替换为索引查找或扫描——这通常要快得多。

要涵盖的列：

*   参数化或静态条件；受参数化或恒定条件限制的列。
*   加入列；动态用于连接的列
*   选定的列；回答选定的值。

虽然覆盖索引通常可以为检索提供很好的好处，但它们确实会增加插入/更新开销；由于需要在每次更新时写入额外或更大的索引行。

## 连接查询的覆盖索引

覆盖索引作为连接查询的性能技术可能是最有价值的。这是因为联合查询比单表检索更昂贵且更有可能遭受高性价比问题。

*   在连接查询中，覆盖索引应该被视为每个表。
*   每个“覆盖索引”都会从计划中删除一个物理表访问，并将其替换为仅索引访问。
*   调查计划成本并试验哪些表最值得用覆盖索引替换。
*   通过这种方式，可以显着降低大型连接计划的乘法成本。

例如：

```
select oi.title, c.name, c.address
from porderitem poi
join porder po on po.id = poi.fk_order
join customer c on c.id = po.fk_customer
where po.orderdate > ? and po.status = 'SHIPPING';

create index porder_custitem on porder (orderdate, id, status, fk_customer); 
```

看：

*   [http://literatejava.com/sql/covering-indexes-query-optimization/](http://literatejava.com/sql/covering-indexes-query-optimization/)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2016-11-08T19:18:15.000

假设您有一个包含以下列的简单表，您在这里只索引了 Id：

```
Id (Int), Telephone_Number (Int), Name (VARCHAR), Address (VARCHAR) 
```

想象一下，您必须运行以下查询并检查它是否使用索引，以及是否在没有 I/O 调用的情况下高效执行。请记住，您只在`Id`.

```
SELECT Id FROM mytable WHERE Telephone_Number = '55442233'; 
```

当您检查此查询的性能时，您会感到失望，因为`Telephone_Number`没有索引这需要使用 I/O 调用从表中获取行。所以，这不是一个覆盖索引，因为查询中有一些列没有被索引，这会导致频繁的 I/O 调用。

要使其成为涵盖索引，您需要在`(Id, Telephone_Number)`.

更多详情请参考这篇博客： [https ://www.percona.com/blog/2006/11/23/covering-index-and-prefix-indexes/](https://www.percona.com/blog/2006/11/23/covering-index-and-prefix-indexes/)

# visualization - 有没有人有一个方便的可视化小部件可以用于网络项目？

> ID：62146
> 
> 赞同：1
> 
> 时间：2008-09-15T10:54:54.497
> 
> 标签：visualization

我想要的是很多可以扩展制作思维导图的节点。

理想情况下，我希望展开和折叠节点。我希望能够通过在页面上拖动或跟随展开的节点来导航。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-06T07:42:14.937

我有一位同事需要这种功能来绘制项目之间的 Maven 依赖关系。他最终使用[FreeMind](http://freemind.sourceforge.net/)进行可视化。他只需要编写一个符合 FreeMind 格式的 XML 文件。我什至认为您可以只使用[OPML](http://www.opml.org/)作为文件格式并找到一个现成的 XSLT 将其转换为 FreeMind 格式。可能FreeMind其实是直接支持OPML的（我好久没用了）。

在 FreeMind 中获得数据后，您可以导出它们，或使用[FreeMind 小程序](http://freemind.sourceforge.net/docs/Serving%20Freemind%20maps%20in%20a%20browser/freemind%20applet.html)在您的网站上显示交互式思维导图。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-02-17T21:57:51.813

建议[mxGraph](http://www.jgraph.com/mxgraph.html)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-02-17T22:05:31.907

推荐protovis，可爱的javascript跨平台可视化库。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-06T07:25:21.680

我认为您要求的组件可以执行 Visio 可以执行的操作，但它可以显示在网页上。很可能您必须从头开始创建一个，因为思维导图工具始终作为产品本身发布，而不是可定制的组件。我建议寻找一个基本的绘图/插图组件，然后将你的思维导图逻辑放入其中。

# .net - DateTime.Now 与 DateTime.UtcNow

> ID：62151
> 
> 赞同：281
> 
> 时间：2008-09-15T10:57:42.413
> 
> 标签：.net, language-features, date

我一直想知道这两个属性如何工作的原理到底是什么。我知道第二个是通用的，基本上不涉及时区，但是有人可以详细解释它们是如何工作的，在什么情况下应该使用哪个？

* * *

## 回答 #1

> 赞同：416
> 
> 时间：2008-09-15T11:02:43.383

[DateTime.UtcNow](http://msdn.microsoft.com/en-us/library/system.datetime.utcnow.aspx)告诉您日期和时间，就像协调世界时一样，也称为格林威治标准时区 - 基本上就像您在英国伦敦时一样，但不是在夏季。[DateTime.Now](http://msdn.microsoft.com/en-us/library/system.datetime.now.aspx)给出日期和时间，就像您当前区域设置中的某个人看到的那样。

我建议`DateTime.Now`您在向人类显示日期时使用 - 这样他们就会对他们看到的价值感到满意 - 他们可以轻松地将其与他们在手表或时钟上看到的内容进行比较。当您想存储日期或将它们用于以后的计算时使用`DateTime.UtcNow`（在客户端-服务器模型中），您的计算不会被来自服务器或彼此不同时区的客户端混淆。

* * *

## 回答 #2

> 赞同：96
> 
> 时间：2008-09-15T11:03:36.220

这真的很简单，所以我认为这取决于你的观众是什么以及他们住在哪里。

如果您不使用 Utc，则*必须*知道要向其显示日期和时间的人的时区 - 否则您会告诉他们某些事情发生在系统或服务器时间下午 3 点，而实际上发生在下午 5 点他们碰巧活着。

我们使用`DateTime.UtcNow`是因为我们拥有全球网络受众，并且因为我不想唠叨每个用户填写一份表明他们居住在哪个时区的表格。

我们还显示相对时间（2 小时前、1 天前等），直到帖子的时间足够长，以至于无论您住在地球上的哪个地方，时间都是“相同的”。

* * *

## 回答 #3

> 赞同：50
> 
> 时间：2009-02-21T13:16:17.793

还要注意性能差异；`DateTime.UtcNow`then大约快**30**倍`DateTime.Now`，因为内部`DateTime.Now`正在进行大量的时区调整（您可以使用 Reflector 轻松验证这一点）。

所以不要`DateTime.Now`用于相对时间测量。

* * *

## 回答 #4

> 赞同：33
> 
> 时间：2008-09-16T20:22:36.947

在 .NET 中要理解的一个主要概念是，无论您在哪个时区，**现在****都**遍布全球。因此，如果您使用or加载变量- 分配是相同的。*您的对象知道您所在的时区并考虑到这一点，无论分配如何。**`DateTime.Now``DateTime.UtcNow``DateTime`**

 **`DateTime.UtcNow`在计算夏令时边界的日期时，的用处会派上用场。即在参与夏令时的地方，有时从中午到次日中午有25小时，有时从中午到次日中午有23小时。如果要正确确定从时间 A 到时间 B 的小时数，则需要先将每个时间转换为它们的 UTC 等效值，然后再计算`TimeSpan`.

[我写的一篇博](http://carl.camera/default.aspx?id=76)文对此进行了进一步解释`TimeSpan`，并包含一个链接，指向关于该主题的更广泛的 MS 文章。

*澄清：任一项分配都将存储当前时间。如果您要加载两个变量，一个通过`DateTime.Now()`，另一个通过`DateTime.UtcNow()`，`TimeSpan`两者之间的差异将是毫秒，而不是几个小时，假设您在距离 GMT 几个小时的时区。如下所述，打印出它们的`String`值将显示不同的字符串。

* * *

## 回答 #5

> 赞同：22
> 
> 时间：2015-05-08T21:09:42.473

这是一个很好的问题。我正在恢复它，以更详细地说明 .Net 在不同`Kind`值下的行为方式。正如@Jan Zich 指出的那样，它实际上是一个非常重要的属性，并且根据您使用`Now`或`UtcNow`.

在内部，日期存储为`Ticks`哪个（与@Carl Camera 的答案相反）取决于您是否使用`Now`或`UtcNow`。

`DateTime.UtcNow`表现得像其他语言。它设置`Ticks`为基于 GMT 的值。它也设置`Kind`为`Utc`。

`DateTime.Now``Ticks`将值更改**为如果它是您在 GMT 时区中的一天中的时间**。它也设置`Kind`为`Local`。

如果您落后 6 小时 (GMT-6)，您将获得 6 小时前的 GMT 时间。.Net 实际上忽略`Kind`并将这个时间视为 6 小时前，即使它应该是“现在”。如果您创建一个`DateTime`实例然后更改您的时区并尝试使用它，那么这会更糟。

**具有不同“种类”值的 DateTime 实例不兼容。**

让我们看一些代码...

```
 DateTime utc = DateTime.UtcNow;
    DateTime now = DateTime.Now;
    Debug.Log (utc + " " + utc.Kind);  // 05/20/2015 17:19:27 Utc
    Debug.Log (now + " " + now.Kind);  // 05/20/2015 10:19:27 Local

    Debug.Log (utc.Ticks);  // 635677391678617830
    Debug.Log (now.Ticks);  // 635677139678617840

    now = now.AddHours(1);
    TimeSpan diff = utc - now;
    Debug.Log (diff);  // 05:59:59.9999990

    Debug.Log (utc <  now);  // false
    Debug.Log (utc == now);  // false
    Debug.Log (utc >  now);  // true

    Debug.Log (utc.ToUniversalTime() <  now.ToUniversalTime());  // true
    Debug.Log (utc.ToUniversalTime() == now.ToUniversalTime());  // false
    Debug.Log (utc.ToUniversalTime() >  now.ToUniversalTime());  // false
    Debug.Log (utc.ToUniversalTime() -  now.ToUniversalTime());  // -01:00:00.0000010 
```

正如您在此处看到的，比较和数学函数不会自动转换为兼容时间。`Timespan`应该差不多一个小时，但实际上差不多是 6 个。“utc < now”应该是真的（我什至增加了一个小时来确定），但仍然是假的。

您还可以看到“解决方法”，即在任何不同`Kind`的地方简单地转换为通用时间。

我对这个问题的直接回答与接受的答案关于何时使用每个问题的建议一致。您应该始终**尝试**使用具有 的`DateTime`对象`Kind=Utc`，除了在 i/o（显示和解析）期间。这意味着您应该几乎总是使用`DateTime.UtcNow`，除了您创建对象只是为了显示它并立即丢弃它的情况。

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2008-09-15T11:05:41.660

DateTime 不知道时区是什么。它始终假定您在当地时间。*UtcNow*仅表示“从时间中减去我的时区”。

如果要使用时区感知日期，请使用**DateTimeOffset**，它表示带有时区的日期/时间。我不得不以艰难的方式学习这一点。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2012-09-14T15:43:17.093

这个问题的“简单”答案是：

**DateTime.Now**返回一个代表当前系统时间的**DateTime**值（在系统运行的任何时区）。DateTime.Kind属性**将为****DateTimeKind.Local**

 ****DateTime.UtcNow**返回一个代表当前通用协调时间（又名 UTC）的**DateTime值，无论系统的时区如何，该值都是相同的。**DateTime.Kind属性**将为****DateTimeKind.Utc**

 *** * *

## 回答 #8

> 赞同：4
> 
> 时间：2009-04-18T00:12:29.877

只是对上述几点的补充：DateTime 结构还包含一个鲜为人知的字段，称为[Kind](http://msdn.microsoft.com/en-us/library/system.datetime.kind.aspx)（至少，我很长一段时间都不知道它）。它基本上只是一个指示时间是本地时间还是 UTC 的标志；它没有指定当地时间与 UTC 的实际偏移量。除了表明构造结构的意图之外，它还影响[ToUniversalTime()](http://msdn.microsoft.com/en-us/library/system.datetime.touniversaltime.aspx)和[ToLocalTime()](http://msdn.microsoft.com/en-us/library/system.datetime.tolocaltime.aspx)方法的工作方式。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2011-09-15T13:11:06.687

聚会有点晚了，但我发现这两个链接（4guysfromrolla）非常有用：

[使用协调世界时 (UTC) 存储日期/时间值](http://www.4guysfromrolla.com/articles/081507-1.aspx)

[跨不同时区存储和显示日期和时间的建议](http://www.4guysfromrolla.com/articles/040710-1.aspx)

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2018-10-03T10:31:28.440

DateTime.UtcNow 是一个省略夏令时的通用时间刻度。因此，UTC 永远不会因为 DST 而改变。

但是， DateTime.Now 不是连续的或单值的，因为它会根据 DST 变化。这意味着 DateTime.Now，相同的时间值可能会出现两次，使客户处于困惑状态。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-09-15T11:04:40.557

当您需要运行应用程序的机器的本地时间时（例如欧洲的 CEST），请使用 Now。如果您想要一个通用时间 - UtcNow。这只是您的偏好问题 - 可能制作一个本地网站/独立应用程序，您想要使用用户拥有的时间 - 因此受他/她的时区设置 - DateTime.Now 的影响。

请记住，对于网站，它是服务器的时区设置。因此，如果您要为用户显示时间，请获取他的首选时区并更改时间（只需将 Utc 时间保存到数据库中，然后对其进行修改）或指定其为 UTC。如果您忘记这样做，用户可能会看到类似的内容：*在 3 个减号前发布*，然后在未来某个时间附近发布 :)

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2014-09-08T13:49:53.907

DateTime.UtcNow 是一个连续的单值时间刻度，而 DateTime.Now 不是连续的或单值的。主要原因是夏令时，它不适用于 UTC。所以 UTC 永远不会向前或向后跳一个小时，而本地时间 (DateTime.Now) 会。而当它向后跳时，相同的时间值会出现两次。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2019-09-25T14:17:25.183

最大的区别 :) 是 SharePoint 工作流不支持 DateTime.Now，您必须使用 DateTime.UtcNow

# bug-tracking - 不建立自己的错误跟踪系统的原因

> ID：62153
> 
> 赞同：53
> 
> 时间：2008-09-15T10:59:42.003
> 
> 标签：bug-tracking

现在有好几次，我遇到了一个团队想要构建自己的错误跟踪系统的计划——不是作为产品，而是作为内部工具。

我听到的赞成的论点通常是这样的：

*   想在一些内部构建的网络框架方面“吃我们自己的狗粮”
*   需要一些高度专业化的报告，或者以某种据称独特的方式调整某些功能的能力
*   相信构建一个bug跟踪系统并不难

您可以使用哪些论据来支持购买现有的错误跟踪系统？特别是，哪些功能听起来很简单，但实施起来却很困难，或者哪些功能既困难又重要，但经常被忽视？

* * *

## 回答 #1

> 赞同：80
> 
> 时间：2008-10-07T19:39:28.133

首先，看看这些[Ohloh](http://ohloh.net)指标：

```
 Trac:  44 KLoC, 10 Person Years,   $577,003
Bugzilla:  54 KLoC, 13 Person Years,   $714,437
 Redmine: 171 KLoC, 44 Person Years, $2,400,723
  Mantis: 182 KLoC, 47 Person Years, $2,562,978 
```

我们从这些数字中学到了什么？我们了解到构建 Yet Another Bug Tracker 是浪费资源的好方法！

所以这是我建立自己的内部错误跟踪系统的原因：

1.  您需要在十年或两年内消除所有的 bozocoders。
2.  你需要冲一些钱来避免明年的预算减少。

否则不要。

* * *

## 回答 #2

> 赞同：39
> 
> 时间：2008-09-15T11:05:56.730

我想把这个问题转过来。你到底为什么要建立自己的？
如果您需要一些额外的字段，请使用可以修改的现有包。
特别报道？进入数据库并制作它。

相信不难吗？那就试试吧。对其进行规范，并查看功能列表和时间增长。然后在列表完成后，尝试找到一个可以修改的现有包，然后再实现自己的。

简而言之，当另一个只需要一些调整以适应时，不要重新发明轮子。

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2008-09-15T11:12:32.597

程序员喜欢构建自己的票务系统，因为看过并使用过数十个系统，他们对它了如指掌。这样他们就可以留在舒适区。

这就像检查一家新餐厅：它可能会有所回报，但也有风险。最好再次订购披萨。

还有一个关于决策的重要事实：做某事总是有两个理由：一个好的理由和正确的理由。我们做出决定（“建立我们自己的”），然后证明它的合理性（“我们需要完全控制”）。大多数人甚至没有意识到他们真正的动机。

要改变他们的想法，你必须攻击**真正的**原因，而不是理由。

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2008-09-15T11:16:09.607

# 不是在这里发明的综合症！

建立自己的错误跟踪器？为什么不构建自己的邮件客户端、项目管理工具等。

正如[Omer van Kloeten](https://stackoverflow.com/questions/62153/reasons-not-to-build-your-own-bug-tracking-system/62163#62163)在其他地方所说，现在付款或以后付款。

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2008-09-15T12:14:55.537

还有第三种选择，既不购买也不建造。那里有很多免费的好东西。例如：

*   [布吉拉](http://en.wikipedia.org/wiki/Bugzilla)
*   [追踪](http://en.wikipedia.org/wiki/Trac)

将自己的错误跟踪器用于学习以外的任何用途都不是很好地利用时间。

其他链接：

*   *[三个免费的错误跟踪工具](https://web.archive.org/web/1/http://articles.techrepublic%2ecom%2ecom/5100-10878_11-1049951.html)*
*   *[问题跟踪系统的比较](http://en.wikipedia.org/wiki/Comparison_of_issue_tracking_systems)*

* * *

## 回答 #6

> 赞同：10
> 
> 时间：2008-09-15T11:03:35.783

我只想说这是钱的问题 - 购买你知道对你有好处的成品（有时甚至不购买，如果它是免费的）比必须自己开发一个更好。这是一个简单的**现在**付款与**以后**付款的游戏。

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2008-09-27T04:35:31.743

首先，反对支持建立自己的论点：

> 想在一些内部构建的网络框架方面“吃我们自己的狗粮”

这当然提出了为什么要构建自己的 Web 框架的问题。就像那里有许多有价值的免费错误跟踪器一样，也有许多有价值的框架。我想知道您的开发人员是否有明确的优先事项？谁在做让你的公司真正赚钱的工作？

好的，如果他们必须构建一个框架，让它从构建您的企业用来赚钱的实际软件的过程中有机地发展。

> 需要一些高度专业化的报告，或者以某种据称独特的方式调整某些功能的能力

正如其他人所说，抓住众多优秀的开源跟踪器之一并对其进行调整。

> 相信构建一个bug跟踪系统并不难

好吧，我在短短几周内就编写了我的[BugTracker.NET的第一个版本，从没有 C# 知识开始。](http://ifdefined.com/bugtrackernet.html)但是现在，6 年又几千小时后，仍然有一大堆未完成的功能请求，所以这完全取决于您希望错误跟踪系统做什么。多少电子邮件集成、源代码控制集成、权限、工作流、时间跟踪、进度估计等。错误跟踪器可以是一个主要的、主要的应用程序。

> 您可以使用哪些论据来支持购买现有的错误跟踪系统？

不需要购买。太多好的开源软件：[Trac](http://en.wikipedia.org/wiki/Trac)、[Mantis_Bug_Tracker](http://en.wikipedia.org/wiki/Mantis_Bug_Tracker)、我自己的 BugTracker.NET 等等。

> 特别是，哪些功能听起来很简单，但实施起来却很困难，或者哪些功能既困难又重要，但经常被忽视？

如果您只是为自己创建它，那么您可以走很多捷径，因为您可以硬连线。如果您要在许多不同的场景中为许多不同的用户构建它，那么很难支持可配置性。可配置的工作流程、自定义字段和权限。

我认为一个*好的*bug 跟踪器必须具备的两个功能，即[FogBugz](http://en.wikipedia.org/wiki/FogBugz)和 BugTracker.NET 都具有，是 1) 集成传入和传出电子邮件，以便关于 bug 的整个对话与 bug 一起存在，而不是在单独的电子邮件中线程，以及 2) 只需单击几下即可将屏幕截图转换为错误帖子的实用程序。

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2008-09-15T11:03:25.537

对我来说最基本的论点是时间损失。我怀疑它可以在不到一两个月的时间内完成。为什么要花时间在有这么多好的错误跟踪系统可用的时候？给我一个你必须调整并且不容易获得的功能的例子。

我认为一个好的错误跟踪系统必须反映您的开发过程。一个非常定制的开发过程本质上对公司/团队不利。大多数敏捷实践偏爱[Scrum](http://en.wikipedia.org/wiki/Scrum_%28development%29)或这类东西，大多数错误跟踪系统都符合这样的建议和方法。不要太官僚主义。

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2008-09-15T11:13:12.843

最重要的是，在您的错误跟踪器完成之前，您将在哪里提交错误？

不过实话说。工具已经存在，无需重新发明轮子。修改跟踪工具以添加某些特定功能是一回事（我之前修改过[Trac](http://en.wikipedia.org/wiki/Trac)）......重写一个只是愚蠢的。

您可以指出的最重要的事情是，如果他们只想添加几个专门的报告，则不需要从头开始的解决方案。此外，“你的自制解决方案”最重要的地方是内部工具。如果它可以按您的需要完成工作，谁会在乎您在内部使用什么？

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2008-09-15T11:35:34.210

错误跟踪系统可能是初级开发人员开始的一个很好的项目。这是一个相当简单的系统，您可以使用它来训练他们的编码约定等。让初级开发人员构建这样一个系统相对便宜，而且他们可以在客户看不到的东西上犯错误。

如果它是垃圾，你可以把它扔掉，但你可以给他们一种感觉，如果使用它，那里的工作已经对公司很重要。你不能让初级开发人员能够体验这样一个项目将带来的整个生命周期和所有知识转移的机会。

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2008-09-15T12:14:39.327

我们在这里做到了这一点。我们在 10 多年前写了第一个。然后我们将其升级为使用网络服务，更多地作为学习技术的一种方式。我们最初这样做的主要原因是我们想要一个错误跟踪系统，该系统还可以生成版本历史报告和一些我们在商业产品中找不到的其他功能。

我们现在再次关注错误跟踪系统，并且正在认真考虑迁移到 Mantis 并使用 Mantis Connect 添加我们自己的其他自定义功能。滚动我们自己的系统所付出的努力太大了。

我想我们也应该看看 FogBugz :-)

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2008-09-15T11:28:56.207

作为一名从事已经很重要（或最不重要）任务的程序员，不应该让自己偏离尝试开发市场上已经可用的东西（开源或商业）。

您现在将尝试创建一个错误跟踪系统来跟踪您用来跟踪核心开发中的错误的错误跟踪系统。

首先： 1\. 选择你的 bug 系统将运行的平台（Java、PHP、Windows、Linux 等） 2\. 尝试在平台上找到可用的开源工具（通过开源，我指的是商业和免费工具）您选择了 3\. 花最少的时间尝试根据您的需要进行定制。如果可能的话，不要浪费时间在定制上

对于企业开发团队，我们开始使用[JIRA](http://en.wikipedia.org/wiki/JIRA)。我们想要一些额外的报告、SSO 登录等。JIRA 能够做到这一点，我们可以使用已经可用的插件对其进行扩展。由于代码是付费支持的一部分，我们只花了最少的时间编写用于登录的自定义插件。

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2008-09-15T12:17:46.887

建立在其他人所说的基础上，而不仅仅是下载免费/开源的。如何下载它，然后完全根据自己的需要进行修改？我知道我过去曾被要求这样做。我安装了 Bugzilla，然后对其进行了修改以支持回归测试和测试报告（这是很多年前的事了）。

不要重新发明轮子，除非你确信你可以制造一个更圆的轮子。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2008-09-15T11:07:46.307

我想说最大的绊脚石之一是对数据模型/工作流程的苦恼。我预计这将需要**很长时间**，并且涉及许多关于在某些情况下应该如何处理错误、真正构成错误等的争论。如果你只是推出一个预建系统，大多数人将学习如何使用它并充分利用它，无论哪些决定已经确定。选择一些开源的东西，如果需要的话，你可以随时调整它——这比从头开始自己动手要快得多**。**

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2008-09-15T11:14:24.527

在这一点上，如果在错误跟踪/票务方面没有一个大的新方向，它只会重新发明轮子。一般来说，这似乎是其他人的想法。

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2008-09-15T11:20:49.800

您的讨论将从构成错误的内容开始，然后演变为要应用的工作流程，并以关于如何管理软件工程项目的大规模争论结束。你真的想要那个吗？:-) 不，没想到 - 去买一个！

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2008-09-15T13:26:34.897

大多数开发人员认为他们拥有一些其他人没有的独特能力，因此他们可以创建一个以某种方式独特的系统。

其中 99% 是错误的。

贵公司拥有 1% 的员工的可能性有多大？

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2008-10-08T11:54:16.027

我一直在这场辩论的双方，所以让我在这里面对一点点。

当我年轻的时候，我推动建立我们自己的错误跟踪系统。我只是强调了所有现成的东西不能做的事情，我让管理层去做。他们选择了谁来领导团队？我！这将是我第一次有机会成为团队领导，并在从设计到工具再到人员的方方面面都有发言权。我很激动。所以我的建议是检查推动这个项目的人的动机。

现在我年纪大了，又面临同样的问题，我决定选择 FogBugz。它完成了我们所需的 99%，成本基本上为 0。此外，Joel 会向您发送个人电子邮件，让您感觉特别。最后，这不是问题吗，您的开发人员认为这会让他们变得特别？

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2008-09-15T11:46:23.607

每个软件开发人员都希望构建自己的错误跟踪系统。这是因为我们*显然*可以改进已有的东西，因为我们是领域专家。

这几乎肯定不值得（就开发人员的时间而言）。只需购买[JIRA](http://www.atlassian.com/software/jira/)。

如果您的错误跟踪系统需要额外的报告，您可以添加这些报告，即使您必须通过直接访问底层数据库来完成。

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2008-09-15T11:59:47.833

问题是你的公司付钱给你做什么？是编写只有你会使用的软件吗？显然不是。因此，您可以证明构建错误跟踪系统的时间和费用合理的唯一方法是，它的成本是否低于使用免费错误跟踪系统的相关成本。

很可能在某些情况下这是有道理的。您是否需要与现有系统集成？（时间跟踪、估计、需求、QA、自动化测试）？您的组织是否有一些与 SOX 合规性相关的独特要求，这些要求需要难以捕获的特定数据元素？

您是否处于一个极度官僚主义的环境中，导致项目之间出现大量“停机时间”？

如果这些类型的问题的答案是肯定的——那么无论如何“购买”与构建的争论都会说构建。

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2008-09-15T12:19:45.650

因为[Trac](http://en.wikipedia.org/wiki/Trac)存在。

而且因为您必须培训新员工使用您的定制软件，因为他们可能有其他系统的经验，您可以在这些系统上构建而不是丢弃。

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2008-09-15T12:33:46.550

因为除非您打算出售它，否则它不是计费时间甚至非常有用。

有非常好的错误跟踪系统可用，例如[FogBugz](http://en.wikipedia.org/wiki/FogBugz)。

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2008-09-15T12:46:44.197

如果“需要一些高度专业化的报告，或者以某种据称独特的方式调整某些功能的能力”，那么最好和最便宜的方法是与现有错误跟踪系统的开发人员交谈。付钱让他们将该功能放入他们的应用程序中，让全世界都可以使用它。与其重新发明轮子，不如付钱给轮子制造商，让他们安装形状像弹簧的辐条。

否则，如果试图展示一个框架，一切都很好。只需确保放入相关的免责声明即可。

对于那些认为错误跟踪系统构建不难的人，请严格遵循瀑布 SDLC。预先了解所有要求。这肯定会帮助他们理解复杂性。这些人通常说搜索引擎并不难构建。只是一个文本框、一个“搜索”按钮和一个“我感觉很幸运”按钮，而“我感觉很幸运”按钮可以在第 2 阶段完成。

* * *

## 回答 #24

> 赞同：1
> 
> 时间：2008-09-15T13:32:44.053

我在一家初创公司工作了几年，我们从开源工具[GNATS开始，并在此基础上构建了我们自己精心设计的错误跟踪系统。](http://en.wikipedia.org/wiki/GNATS)争论是我们将避免在商业系统上花费大量资金，并且我们将获得一个完全适合我们需求的错误跟踪系统。

当然，结果比预期的要困难得多，并且对开发人员来说是一个很大的分心 - 除了我们的代码之外，他们还必须维护错误跟踪系统。这是导致我们公司倒闭的因素之一。

* * *

## 回答 #25

> 赞同：1
> 
> 时间：2008-09-15T13:33:29.230

**按原样使用一些开源软件**。肯定有错误，您将需要尚不存在或正在等待错误修复的内容。它一直在发生。:)

如果您扩展/自定义一个开源版本，那么您必须维护它。现在，应该帮助您测试**赚钱应用程序**的应用程序将成为支持的负担。

* * *

## 回答 #26

> 赞同：1
> 
> 时间：2008-10-30T10:58:32.803

我认为人们编写自己的错误跟踪系统的原因（根据我的经验）是，

1.  他们不想为他们认为相对容易构建的系统付费。
2.  程序员自我
3.  对现有系统提供的体验和解决方案普遍不满意。
4.  他们将其作为产品出售:)

对我来说，大多数错误跟踪器失败的最大原因是它们没有提供最佳的用户体验，并且在没有针对可用性进行优化的情况下，使用你使用很多的系统可能会非常痛苦。

我认为另一个原因与几乎我们每个人（程序员）在某个时候构建自己的自定义 CMS 或 CMS 框架的原因相同（有罪）。只因为你可以！

* * *

## 回答 #27

> 赞同：1
> 
> 时间：2008-11-21T16:26:47.927

我同意所有不这样做的理由。我们尝试了一段时间来使用那里的东西，最终还是自己写了。为什么？主要是因为他们中的大多数都太麻烦了，除了技术人员之外，其他人都无法参与。我们甚至尝试过大本营（当然，它不是为此而设计的，并且在这方面失败了）。

我们还提出了一些对我们的客户非常有效的独特功能：一个“报告错误”按钮，我们用一行 javascript 将其编写成代码。它允许我们的客户打开一个小窗口，快速记录信息并提交到数据库。

但是，编码肯定要花很多时间。变成了一个BIG宠物项目；很多周末时间。

如果你想看看：[http ://www.archerfishonline.com](http://www.archerfishonline.com)

希望得到一些反馈。

* * *

## 回答 #28

> 赞同：1
> 
> 时间：2009-01-02T23:07:12.217

我们已经这样做了......几次。我们建造自己的唯一原因是因为它是五年前的事，而且没有很多好的替代品。但现在有很多替代品。我们在构建自己的工具时学到的主要内容是，您将花费大量时间来处理它。那是你可以为你的时间计费的时候了。作为一家小企业，每月支付一两个计费小时即可轻松收回的月费比花费所有时间自己滚动更有意义。当然，你必须做出一些让步，但从长远来看，你会过得更好。

至于我们，我们决定将我们的应用程序提供给其他开发人员。在[http://www.myintervals.com上查看](http://www.myintervals.com)

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2008-09-15T12:35:46.640

我同意这里的大多数人。当有许多工具（甚至是免费的）可用时，重建某些东西是没有用的。如果您想自定义任何东西，大多数免费工具都会为您提供代码，并使用它。

如果你做新的开发，你不应该只为自己做。

* * *

## 回答 #30

> 赞同：0
> 
> 时间：2008-10-07T19:49:51.280

假设明天（明年），如果他们决定为公司的所有错误跟踪系统引入一个流行的开源/商业工具，该工具如何能够将其所有错误票导出到另一个工具？

只要确实需要自定义错误跟踪系统，并且回答了此类问题，我就不会打扰太多。

* * *

## 回答 #31

> 赞同：0
> 
> 时间：2008-10-07T19:56:47.410

已经有这么多伟大的了，为什么要浪费时间重新发明轮子呢？

只需使用[FogBugz](http://en.wikipedia.org/wiki/FogBugz)。

* * *

## 回答 #32

> 赞同：0
> 
> 时间：2008-10-23T02:57:15.000

不要为了“吃自己的狗粮”而编写自己的软件。你只是在创造更多的工作，而你可能会以更少的时间和金钱购买做同样事情（并且更好）的软件。

* * *

## 回答 #33

> 赞同：0
> 
> 时间：2008-10-30T11:26:58.360

我不认为构建内部跟踪系统相对容易构建，而且肯定不会匹配付费或开源解决方案。大多数时候，我会追求“程序员的自我”，或者只是拥有一个确实不能使用第三方软件并且必须构建几乎所有使用的软件的 IT 部门。

有一次我在一家拥有**自己内部版本控制系统**的电信公司工作，这很糟糕，但它让整个团队都忙得不可开交……

* * *

## 回答 #34

> 赞同：0
> 
> 时间：2009-03-20T02:25:12.827

告诉他们，*那太好了，公司可以暂时节省一些钱，并且很乐意在您从事这个无薪休假期间贡献开发工具。任何希望休年假来从事该项目的人都可以这样做。*

* * *

## 回答 #35

> 赞同：0
> 
> 时间：2010-06-05T04:34:46.460

我已经建立了自己的错误跟踪系统。我也想：“这有多难，它只是一个错误跟踪系统” **ERR - 错误*** - 花了六个月的时间编写它。

我自己烤的主要原因是为了得到我想要的。另一个原因是作为一个爱好项目。

我想说这是唯一有理由建立自己的项目是作为一个爱好项目。任何公司都不应该花时间去做这件事。

顺便说一下，我的软件叫做[Bugweb](http://www.bugweb.com.au)。

# asp.net - ASP.NET 3.5 中的 Response.Clear

> ID：62154
> 
> 赞同：6
> 
> 时间：2008-09-15T11:00:17.603
> 
> 标签：asp.net

我最近通过在服务器上安装框架并设置我的 Web 应用程序，将我的一些 Web 应用程序升级到 ASP.NET 3.5，但是一切都很好。

在某些页面上，我想使用如下代码清除响应缓冲区的当前内容：

```
Response.Clear();
// Output some stuff
Response.End(); 
```

但这现在在 3.5 中不起作用，而在 2.0 中起作用。我也尝试将响应缓冲区设置为 false，但这也不起作用。

谁能让我知道为什么它不起作用或者是否有解决方法？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-09-15T11:24:29.573

尝试在页面的页面指令中设置 Buffer="True" 而不是在代码隐藏中。

我刚刚在一个网站项目的 VS2008 中尝试过这个：

1.  创建新项目
2.  选择“网页”
3.  把所有的 html-tags 留在那里，只是为了好玩
4.  `page_load`像这样填写

    ```
    protected void Page_Load(object sender, EventArgs e)  
    {  
      Response.Write("test1");  
      Response.Clear();  
      Response.Write("test2");  
      Response.End();  
    } 
    ```

然后它将输出“test2”而没有任何 html-tags。

# .net - 你会费心去模拟 StreamReader 对象吗？

> ID：62159
> 
> 赞同：3
> 
> 时间：2008-09-15T11:02:43.353
> 
> 标签：.net, mocking

我使用流阅读器导入一些数据，目前我在测试中硬编码一个小样本文件来完成这项工作。

将 Mock Objects 用于此以及如何使用是否明智？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-15T11:10:45.283

除非您正在制作 StreamReader 派生类，否则我看不到任何模拟 StreamReader 的要点。如果您需要通过 StreamReader 提供测试输入，只需从任何合适的来源读取一些预定义的数据。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-15T11:13:25.450

[StreamReader](http://msdn.microsoft.com/en-us/library/system.io.streamreader.aspx#Mtps_DropDownFilterText)是一个具体的类，所以许多模拟系统不允许你模拟它。 [然而， TypeMock Isolator](http://www.typemock.com/)会。

如果您需要强制错误来自阅读器，您可能会发现您想要模拟它，而不仅仅是让它为您的测试类提供数据。如果您不需要此功能，您可能会远远领先于从其他一些流（例如[MemoryStream ）](http://msdn.microsoft.com/en-us/library/system.io.memorystream.aspx)[构建](http://msdn.microsoft.com/en-us/library/yhfzs7at.aspx)StreamReader - 这样您就不需要去磁盘获取数据。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-15T11:10:42.290

在测试依赖于流、流读取器和流写入器的代码时，我通常使用 memorystream 对象进行测试。这里不需要模拟框架。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-15T11:14:52.560

您可以使用工厂方法返回可以是模拟对象或实际 StreamReader 的 TextReader。

# windows-mobile - 在哪里可以找到适用于 Windows Mobile 的 QR（快速响应）代码组件/API？

> ID：62173
> 
> 赞同：1
> 
> 时间：2008-09-15T11:08:45.163
> 
> 标签：windows-mobile, compact-framework, components, qr-code

我正在寻找**第 3 方解决方案以将[QR 码](http://en.wikipedia.org/wiki/QR_Code)阅读器**集成到 Windows Mobile 应用程序（.NET Compact Framework）中。该组件应**集成 Reader（相机）和 Decoder（算法）**。

我试用了[QuickMark](http://www.quickmark.com.tw/En/basic/index.asp)阅读器，它可以在应用程序外部调用并使用 Windows 消息进行通信。它运行良好，但并没有给我需要的所有选项（例如，它必须安装等）。

还有其他我可能错过的好的解决方案吗？有什么开源的吗？在不同的设备上测试？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-19T02:24:59.837

[这是 Java QR 代码](http://www.codeproject.com/KB/cs/qrcode.aspx)[库](http://qrcode.sourceforge.jp/)的开源 C# 端口。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-15T11:20:23.687

你试过这个：[QRCode .NET Compact Framework Package](http://webscripts.softpedia.com/script/E-Commerce/QRCode-NET-Compact-Framework-Package--30802.html) 吗？

# language-agnostic - 导致堆栈溢出的最短代码是什么？

> ID：62188
> 
> 赞同：160
> 
> 时间：2008-09-15T11:17:38.467
> 
> 标签：language-agnostic, code-golf

为了纪念 Stack Overflow 的公开发布，最短的导致栈溢出的代码是什么？欢迎任何语言。

ETA：只是为了明确这个问题，因为我是一个偶尔的 Scheme 用户：尾调用“递归”实际上是迭代，任何可以通过体面的编译器相对简单地转换为迭代解决方案的解决方案都不会被计算在内。:-P

ETA2：我现在选择了一个“最佳答案”；看到[这个帖子](https://stackoverflow.com/questions/62188/stack-overflow-code-golf/71833#71833)的理由。感谢所有贡献的人！:-)

* * *

## 回答 #1

> 赞同：291
> 
> 时间：2008-09-15T16:05:34.793

阅读这一行，并按照它所说的做**两次**。

* * *

## 回答 #2

> 赞同：211
> 
> 时间：2008-09-15T20:43:25.687

所有这些答案，没有Befunge？我敢打赌，这是所有解决方案中最短的：

```
1 
```

不开玩笑。自己试试吧：[http ://www.quirkster.com/iano/js/befunge.html](http://www.quirkster.com/iano/js/befunge.html)

编辑：我想我需要解释一下。操作数 1 将 1 推入 Befunge 的内部堆栈，并且没有其他任何内容将其置于语言规则下的循环中。

使用提供的解释器，您最终会——我的意思是*最终*——会遇到表示 Befunge 堆栈的 Javascript 数组变得太大而浏览器无法重新分配的点。如果你有一个简单的 Befunge 解释器，它的堆栈更小且有界——就像下面大多数语言的情况一样——这个程序会更快地导致更明显的溢出。

* * *

## 回答 #3

> 赞同：173
> 
> 时间：2008-09-15T11:53:38.830

你也可以在 C#.net 中试试这个

```
throw new StackOverflowException(); 
```

* * *

## 回答 #4

> 赞同：159
> 
> 时间：2008-09-15T12:25:47.490

**内默尔**：

这**会使编译器崩溃**并出现 StackOverflowException：

```
def o(){[o()]} 
```

* * *

## 回答 #5

> 赞同：119
> 
> 时间：2008-09-15T11:17:47.793

我目前最好的（在 x86 汇编中）是：

```
push eax
jmp short $-1 
```

这会产生 3 个字节的目标代码 ( `50 EB FD`)。对于 16 位代码，这也是可能的：

```
call $ 
```

这也导致 3 个字节 ( `E8 FD FF`)。

* * *

## 回答 #6

> 赞同：113
> 
> 时间：2009-02-28T02:17:01.440

## PIC18

[TK 给出](https://stackoverflow.com/questions/62188/stack-overflow-code-golf/62209#62209)的PIC18 答案导致以下指令（二进制）：

```
overflow
   PUSH
   0000 0000 0000 0101
   CALL overflow
   1110 1100 0000 0000
   0000 0000 0000 0000 
```

但是，单独的 CALL 将执行堆栈溢出：

```
CALL $
1110 1100 0000 0000
0000 0000 0000 0000 
```

## 更小、更快的 PIC18

但是 RCALL（相对调用）仍然更小（不是全局内存，所以不需要额外的 2 个字节）：

```
RCALL $
1101 1000 0000 0000 
```

所以 PIC18 上最小的是一条指令，16 位（两个字节）。每个循环需要 2 个指令周期。每个指令周期有 4 个时钟周期，你有 8 个时钟周期。PIC18 有一个 31 级堆栈，因此在第 32 次循环之后它将在 256 个时钟周期内溢出堆栈。在 64MHz 时，您将**在 4 微秒和 2 个字节内溢出堆栈**。

## PIC16F5x（更小更快）

但是，PIC16F5x 系列使用 12 位指令：

```
CALL $
1001 0000 0000 
```

同样，每个循环两个指令周期，每个指令 4 个时钟，因此每个循环 8 个时钟周期。

但是，PIC16F5x 有一个两级堆栈，因此在第三个循环中它会在 24 条指令中溢出。在 20MHz 时，它将**在 1.2 微秒和 1.5 字节内溢出**。

## 英特尔 4004

[Intel 4004](http://download.intel.com/museum/archives/pdf/4004_datasheet.pdf)有一个 8 位调用子程序指令：

```
CALL $
0101 0000 
```

对于对应于 ascii 'P' 的好奇。使用 3 级堆栈，需要 24 个时钟周期，总共**32.4 微秒和一个字节**。（除非你超频你的 4004 - 来吧，你知道你想要。）

这与 befunge 答案一样小，但比当前解释器中运行的 befunge 代码快得多。

* * *

## 回答 #7

> 赞同：77
> 
> 时间：2008-09-15T11:21:28.457

C＃：

```
public int Foo { get { return Foo; } } 
```

* * *

## 回答 #8

> 赞同：57
> 
> 时间：2010-04-21T01:25:26.543

热溢出！

```
//              v___v
let rec f o = f(o);(o)
//             ['---']
//             -"---"- 
```

* * *

## 回答 #9

> 赞同：55
> 
> 时间：2008-09-16T08:36:39.890

每项任务都需要正确的工具。满足[SO 溢出](http://page.mi.fu-berlin.de/krudolph/stuff/so/)语言，优化以产生堆栈溢出：

```
so 
```

* * *

## 回答 #10

> 赞同：42
> 
> 时间：2008-09-16T01:10:21.257

特克斯：

```
\def~{~.}~ 
```

结果是：

```
！TeX 容量超出，抱歉 [输入堆栈大小=5000]。
~->~
    .
~->~
    .
~->~
    .
~->~
    .
~->~
    .
~->~
    .
...
<*> \def~{~.}~
```

乳胶：

```
\end\end 
```

结果是：

```
！TeX 容量超出，抱歉 [输入堆栈大小=5000]。
\end #1->\csname end#1
                      \endcsname \@checkend {#1}\expandafter \endgroup \if@e...
<*> \结束\结束
```

* * *

## 回答 #11

> 赞同：35
> 
> 时间：2008-09-15T17:00:09.187

Z-80 汇编器——在内存位置 0x0000：

```
rst 00 
```

一个字节 - 0xC7 - 将当前 PC 推入堆栈并跳转到地址 0x0000 的无限循环。

* * *

## 回答 #12

> 赞同：29
> 
> 时间：2008-09-15T11:39:32.390

用英语：

```
recursion = n. See recursion. 
```

* * *

## 回答 #13

> 赞同：29
> 
> 时间：2008-09-15T20:03:01.883

另一个 PHP 示例：

```
<?
require(__FILE__); 
```

* * *

## 回答 #14

> 赞同：26
> 
> 时间：2008-09-15T12:24:45.933

BASIC中的以下内容如何：

```
10 GOSUB 10 
```

（恐怕我没有 BASIC 解释器，所以这是一个猜测）。

* * *

## 回答 #15

> 赞同：26
> 
> 时间：2008-09-15T12:33:25.600

我喜欢 Cody 的大量回答，所以这是我在 C++ 中的类似贡献：

```
template <int i>
class Overflow {
    typedef typename Overflow<i + 1>::type type;
};

typedef Overflow<0>::type Kaboom; 
```

无论如何都不是代码高尔夫条目，但仍然是元堆栈溢出的任何东西！:-P

* * *

## 回答 #16

> 赞同：21
> 
> 时间：2008-09-15T11:46:48.350

这是我的 C 贡献，共有 18 个字符：

```
void o(){o();o();} 
```

这很难进行尾调用优化*！*:-P

* * *

## 回答 #17

> 赞同：19
> 
> 时间：2008-09-16T02:48:14.047

使用名为“s.bat”的 Window 批处理文件：

```
call s 
```

* * *

## 回答 #18

> 赞同：17
> 
> 时间：2008-09-15T17:15:43.487

**Javascript**

为了修剪更多的字符，并让我们自己被踢出更多的软件商店，让我们开始吧：

```
eval(i='eval(i)'); 
```

* * *

## 回答 #19

> 赞同：15
> 
> 时间：2008-09-15T16:24:08.917

时髦的：

```
main() 
```

$ groovy stack.groovy:

```
Caught: java.lang.StackOverflowError
    at stack.main(stack.groovy)
    at stack.run(stack.groovy:1)
 ... 
```

* * *

## 回答 #20

> 赞同：15
> 
> 时间：2009-06-22T19:09:50.473

请告诉我首字母缩略词“ [GNU](http://en.wikipedia.org/wiki/GNU) ”代表什么。

* * *

## 回答 #21

> 赞同：14
> 
> 时间：2008-09-16T02:38:59.857

```
Person JeffAtwood;
Person JoelSpolsky;
JeffAtwood.TalkTo(JoelSpolsky); 
```

这里希望没有尾递归！

* * *

## 回答 #22

> 赞同：12
> 
> 时间：2008-09-15T15:14:11.393

**C** - 它不是最短的，但它是无递归的。它也不是可移植的：它在 Solaris 上崩溃，但某些 alloca() 实现可能会在此处返回错误（或调用 malloc()）。调用 printf() 是必要的。

```
#include <stdio.h>
#include <alloca.h>
#include <sys/resource.h>
int main(int argc, char *argv[]) {
    struct rlimit rl = {0};
    getrlimit(RLIMIT_STACK, &rl);
    (void) alloca(rl.rlim_cur);
    printf("Goodbye, world\n");
    return 0;
} 
```

* * *

## 回答 #23

> 赞同：11
> 
> 时间：2008-09-15T11:30:43.380

**蟒蛇**：

```
so=lambda:so();so() 
```

或者：

```
def so():so()
so() 
```

如果 Python 优化了尾调用...：

```
o=lambda:map(o,o());o() 
```

* * *

## 回答 #24

> 赞同：11
> 
> 时间：2008-09-15T12:39:09.003

perl 12 个字符：

```
$_=sub{&$_};&$_ 
```

bash in 10 个字符（函数中的空格很重要）：

```
i(){ i;};i 
```

* * *

## 回答 #25

> 赞同：11
> 
> 时间：2008-09-15T16:18:11.537

尝试在一个汉堡上放 4 个以上的肉饼。堆栈溢出。

* * *

## 回答 #26

> 赞同：10
> 
> 时间：2008-09-16T12:48:03.683

我在这篇文章之后选择“最佳答案”。但首先，我要感谢一些非常原创的贡献：

1.  阿库的。每个人都探索了一种导致堆栈溢出的新的和原始的方法。执行 f(x) ⇒ f(f(x)) 的想法是我将在下面的下一篇文章中探讨的想法。:-)
2.  Cody 的那个给 Nemerle*编译器*一个堆栈溢出。
3.  并且（有点不情愿地）GateKiller 关于抛出堆栈溢出异常的文章。:-P

尽管我很喜欢上述内容，但挑战在于打代码高尔夫，为了公平起见，我必须将“最佳答案”授予最短代码，即 Befunge 条目；我不相信任何人能够击败它（尽管康拉德肯定已经尝试过），所以恭喜帕特里克！

看到大量递归堆栈溢出解决方案，我很惊讶没有人（截至目前）提出 Y 组合器（参见 Dick Gabriel 的文章，[Y 的原因](http://www.dreamsongs.com/Files/WhyOfY.pdf)，作为入门）。我有一个使用 Y 组合器以及 aku 的 f(f(x)) 方法的递归解决方案。:-)

```
((Y (lambda (f) (lambda (x) (f (f x))))) #f) 
```

* * *

## 回答 #27

> 赞同：8
> 
> 时间：2008-09-16T19:26:26.550

这是 Scheme 中另一个有趣的例子：

```
((λ (x) (xx)) (λ (x) (xx)))
```

* * *

## 回答 #28

> 赞同：7
> 
> 时间：2008-09-15T14:41:42.233

爪哇

Java 解决方案的略短版本。

```
class X{public static void main(String[]a){main(a);}} 
```

* * *

## 回答 #29

> 赞同：6
> 
> 时间：2008-09-15T15:20:22.720

```
xor esp, esp
ret 
```

* * *

## 回答 #30

> 赞同：5
> 
> 时间：2008-09-15T13:22:44.047

3 个字节：

```
`label:
  pusha
  jmp label` 
```

`**更新**`

 `根据[（旧？）英特尔（？）文档](http://www.penguin.cz/~literakl/intel/c.html#CALL)，这也是 3 个字节：

```
`label:
  call label` 
```

* * *

 `## 回答 #31

> 赞同：4
> 
> 时间：2008-09-15T12:43:04.580

**Java**（尴尬）：

```
public class SO 
{ 
  private void killme()
  {
    killme();
  }

  public static void main(String[] args) 
  { 
    new SO().killme(); 
  } 
} 
```

**编辑** 当然可以大大缩短：

```
class SO
{
  public static void main(String[] a)
  {
    main(null);
  }
} 
```

* * *

## 回答 #32

> 赞同：4
> 
> 时间：2008-09-15T14:15:07.027

在 Lua 中：

```
function f()return 1+f()end f() 
```

你必须对递归调用的结果做一些事情，否则尾调用优化将允许它永远循环。代码高尔夫的弱点，但很高兴拥有！

我想这和冗长的关键字意味着 Lua 不会很快赢得代码高尔夫。

* * *

## 回答 #33

> 赞同：4
> 
> 时间：2008-09-15T19:41:23.403

向前：

```
: a 1 recurse ; a 
```

解释器内部`gforth`：

```
: a 1 recurse ; a 
*the terminal*:1: Return stack overflow
: a 1 recurse ; a
                ^
Backtrace: 
```

在打开固件提示的 Power Mac G4 上，这只会挂起机器。:)

* * *

## 回答 #34

> 赞同：4
> 
> 时间：2008-09-15T20:14:02.840

作为 C 函数中的局部变量：

```
int x[100000000000]; 
```

* * *

## 回答 #35

> 赞同：4
> 
> 时间：2008-09-16T20:51:19.373

[http://www.google.com/search?q=google.com](http://www.google.com/search?q=google.com)

* * *

## 回答 #36

> 赞同：3
> 
> 时间：2008-09-15T12:26:09.923

红宝石：

```
def s() s() end; s() 
```

* * *

## 回答 #37

> 赞同：3
> 
> 时间：2008-09-15T13:47:40.820

GWBASIC 输出...

```
OK
10 i=0
20 print i;
30 i=i+1
40 gosub 20
run
 0  1  2  3  4  5  6  7  8  9  10  11  12  13  14  15  16  17  18  19  20  21
 22  23  24  25  26  27  28  29  30  31  32  33
Out of memory in 30
Ok 
```

那里没有太多的堆栈深度:-)

* * *

## 回答 #38

> 赞同：3
> 
> 时间：2008-09-15T14:16:38.253

名为 call.cmd 的批处理程序；

调用 call.cmd

```
******  B A T C H   R E C U R S I O N  exceeds STACK limits ******
Recursion Count=1240, Stack Usage=90 percent
******       B A T C H   PROCESSING IS   A B O R T E D      ****** 
```

* * *

## 回答 #39

> 赞同：3
> 
> 时间：2008-09-15T14:43:06.583

在 Scheme 中，这将导致解释器内存不足：

```
(define (x)
  ((x)))

(x) 
```

* * *

## 回答 #40

> 赞同：3
> 
> 时间：2008-09-15T16:15:50.480

Ruby，到目前为止比其他的短：

```
def a;a;end;a 
```

（13 个字符）

* * *

## 回答 #41

> 赞同：3
> 
> 时间：2008-09-15T20:34:01.937

**C＃**

```
class _{static void Main(){Main();}} 
```

请注意，我的是一个可编译的程序，而不仅仅是一个函数。我还删除了多余的空格。

出于天赋，我使班级名称尽可能小。

* * *

## 回答 #42

> 赞同：3
> 
> 时间：2008-09-15T23:54:33.030

如果你认为调用帧是一个进程，堆栈是你的 Unix 机器，你可以认为一个 fork 炸弹是一个*并行*程序来创建堆栈溢出条件。试试这个 13 个字符的 bash 编号。无需保存到文件。

```
:(){ :|:& };: 
```

* * *

## 回答 #43

> 赞同：3
> 
> 时间：2008-09-16T07:49:44.197

在 Irssi（基于终端的 IRC 客户端，不是“真正的”编程语言）中，$L 表示当前命令行。因此，您可以通过以下方式导致堆栈溢出（“达到最大递归限制”）：

```
/eval $L 
```

* * *

## 回答 #44

> 赞同：2
> 
> 时间：2008-09-15T11:34:39.190

图 18：

> 溢出
> 
> > ```
> >  PUSH   
> >     CALL   overflow 
> > ```

* * *

## 回答 #45

> 赞同：2
> 
> 时间：2008-09-15T11:53:11.237

**CIL/MSIL** :

```
loop: ldc.i4.0
br loop 
```

对象代码：

```
16 2B FD 
```

* * *

## 回答 #46

> 赞同：2
> 
> 时间：2008-09-15T12:35:03.180

**语言**

```
(defun x() (x)) (x) 
```

* * *

## 回答 #47

> 赞同：2
> 
> 时间：2008-09-15T12:37:25.857

```
a{return a*a;}; 
```

编译：

```
gcc -D"a=main()" so.c 
```

扩展为：

```
main() {
    return main()*main();
} 
```

* * *

## 回答 #48

> 赞同：2
> 
> 时间：2008-09-15T13:51:49.373

F＃

人们一直在问“F# 有什么用？”

```
let rec f n =
    f (n) 
```

性能优化版本（失败更快:)）

```
let rec f n =
    f (f(n)) 
```

* * *

## 回答 #49

> 赞同：2
> 
> 时间：2008-09-15T14:53:39.633

在空白处，我认为：

它可能不会出现。：/

* * *

## 回答 #50

> 赞同：2
> 
> 时间：2008-09-15T17:45:33.337

哈斯克尔：

```
let x = x
print x 
```

* * *

## 回答 #51

> 赞同：2
> 
> 时间：2008-09-15T18:04:05.260

好吧，还没有人提到Coldfusion，所以...

```
<cfinclude template="#ListLast(CGI.SCRIPT_NAME, "/\")#"> 
```

那应该做。

* * *

## 回答 #52

> 赞同：2
> 
> 时间：2008-09-15T22:31:08.440

除非存在空程序导致堆栈溢出的语言，否则以下内容应该是最短的。

Befunge：

```
: 
```

一遍又一遍地复制顶部堆栈值。

编辑：帕特里克的更好。用 1 填充堆栈比用 0 填充堆栈更好，因为解释器可以优化将 0 推入空堆栈作为空操作。

* * *

## 回答 #53

> 赞同：2
> 
> 时间：2008-09-17T05:45:16.780

时髦的（5B）：

```
run() 
```

* * *

## 回答 #54

> 赞同：2
> 
> 时间：2010-01-20T14:07:15.003

C＃

```
class Program
{
    class StackOverflowExceptionOverflow : System.Exception
    {
        public StackOverflowExceptionOverflow()
        {
            throw new StackOverflowExceptionOverflow();
        }
    }

    static void Main(string[] args)
    {
        throw new StackOverflowExceptionOverflow();
    }
} 
```

我意识到这不是最短的（甚至打高尔夫球的代码也不会接近短），但我根本无法抗拒抛出一个异常，在被抛出时会抛出一个 stackoverflowexception，然后才能终止运行时本身^^

* * *

## 回答 #55

> 赞同：2
> 
> 时间：2010-02-07T06:21:10.600

# PostScript，7 个字符

```
{/}loop 
```

在 GhostScript 中运行时，抛出此异常：

```
GS>{/}loop
Error: /stackoverflow in --execute--
Operand stack:
   --nostringval--
Execution stack:
   %interp_exit   .runexec2   --nostringval--   --nostringval--   --nostringval--   2   %stopped_push   --nostringval--   --nostringval--   %loop_continue   1753   2   3   %oparray_pop   --nostringval--   --nostringval--   false   1   %stopped_push   .runexec2   --nostringval--   --nostringval--   --nostringval--   2   %stopped_push   --nostringval--   --nostringval--   %loop_continue
Dictionary stack:
   --dict:1150/1684(ro)(G)--   --dict:0/20(G)--   --dict:70/200(L)--
Current allocation mode is local
Last OS error: 11
Current file position is 8 
```

这是不使用变量（51 个字符）的递归版本：

```
[{/[aload 8 1 roll]cvx exec}aload 8 1 roll]cvx exec 
```

* * *

## 回答 #56

> 赞同：2
> 
> 时间：2010-02-27T18:48:56.477

爪哇：

```
class X{static{new X();}{new X();}} 
```

实际上会导致初始化 X 类的堆栈溢出。在调用 main() 之前，JVM 必须加载该类，并且当它这样做时会触发任何匿名静态代码块：

```
static {
  new X();
} 
```

如您所见，它使用默认构造函数实例化 X 。JVM 甚至会在构造函数之前调用匿名代码块：

```
{
  new X();
} 
```

这是递归部分。

* * *

## 回答 #57

> 赞同：2
> 
> 时间：2010-07-17T19:03:00.830

**Java：35 个字符**

我认为为时已晚，但我仍然会发布我的想法：

```
class A{{new A();}static{new A();}} 
```

使用静态初始化器和实例初始化器功能。

这是我电脑上的输出（注意它显示了两条错误消息）：

```
Exception in thread "main" java.lang.StackOverflowError
    at A.<init>(A.java:1)
        ......
    at A.<init>(A.java:1)
Could not find the main class: A. Program will exit. 
```

另见：http: [//download.oracle.com/docs/cd/E17409_01/javase/tutorial/java/javaOO/initial.html](http://download.oracle.com/docs/cd/E17409_01/javase/tutorial/java/javaOO/initial.html)

* * *

## 回答 #58

> 赞同：2
> 
> 时间：2010-08-31T01:02:57.543

# C++ 编译器错误消息

```
template<int n>struct f{f<n+1>a;};f<0>::a; 
```

输出：

```
$ g++ test.cpp;
test.cpp:1: error: template instantiation depth exceeds maximum of 500 (use -ftemplate-depth-NN to increase the maximum) instantiating ‘struct f<500>’
test.cpp:1:   instantiated from ‘f<499>’
test.cpp:1:   instantiated from ‘f<498>’
...... 
```

即使编译器通过了模板，也会出现下一个错误：missing `main`。

* * *

## 回答 #59

> 赞同：1
> 
> 时间：2008-09-15T11:42:44.537

```
/* In C/C++ (second attempt) */

int main(){
    int a = main() + 1;
    return a;
} 
```

* * *

## 回答 #60

> 赞同：1
> 
> 时间：2008-09-15T12:37:42.110

c# 再次：

```
class Foo { public Foo() {new Foo(); } } 
```

* * *

## 回答 #61

> 赞同：1
> 
> 时间：2008-09-15T12:40:39.233

完成德尔福程序。

```
program Project1;
{$APPTYPE CONSOLE}
uses SysUtils;

begin
  raise EStackOverflow.Create('Stack Overflow');
end. 
```

* * *

## 回答 #62

> 赞同：1
> 
> 时间：2008-09-15T12:46:40.640

so.c **15 个字符**：

```
main(){main();} 
```

结果：

```
antti@blah:~$ gcc so.c -o so
antti@blah:~$ ./so
Segmentation fault (core dumped) 
```

**编辑**：好的，它会使用-Wall 发出警告，并且不会使用-O2 导致堆栈溢出。但它有效！

* * *

## 回答 #63

> 赞同：1
> 
> 时间：2008-09-15T13:00:13.057

**Java脚本：**

Huppies 回答一行：

```
(function i(){ i(); })() 
```

相同数量的字符，但没有换行:)

* * *

## 回答 #64

> 赞同：1
> 
> 时间：2008-09-15T13:13:58.747

Java（X.java的完整内容）：

```
class X {
public static void main(String[] args) {
    main(null);
}} 
```

考虑到所有的语法糖，我想知道是否可以在 Java 中完成更短的操作。任何人？

**编辑：**哎呀，我错过了已经发布了几乎相同的解决方案。

**编辑 2：**我会说，这个是（字符明智的）最短的可能

```
class X{public static void main(String[]a){main(null);}} 
```

**编辑 3：**感谢安德斯指出 null 不是最佳论点，所以它更短：

```
class X{public static void main(String[]a){main(a);}} 
```

* * *

## 回答 #65

> 赞同：1
> 
> 时间：2008-09-15T13:42:36.060

已经有一个 perl 了，但这是几个字符短（9 对 12） - 它不会递归 :)

> s//*_=0/e

* * *

## 回答 #66

> 赞同：1
> 
> 时间：2008-09-15T13:59:33.910

[我在 E2 上的Infinite Loop](http://www.everything2.com/index.pl?node_id=1904026)上有一个列表- 仅查看标题中指示为“堆栈溢出”的列表。

我认为最短的是

```
[dx]dx 
```

在[直流](http://c2.com/cgi/wiki?DeeCee)。[False](http://c2.com/cgi/wiki?FalseLanguage)中可能有更短的解决方案。

编辑：显然这不起作用......至少在 GNU dc 上。也许是在 BSD 版本上。

* * *

## 回答 #67

> 赞同：1
> 
> 时间：2008-09-15T14:44:00.170

包含换行符在内的**10 个字符**的 Shell 脚本解决方案：

好吧，从技术上讲不是堆栈溢出，但从逻辑上讲，如果您考虑生成一个新进程作为构造一个新的堆栈帧。

```
#!sh
./so 
```

结果：

```
antti@blah:~$ ./so
[disconnected] 
```

哎呀。注意：**不要在家里尝试这个**

* * *

## 回答 #68

> 赞同：1
> 
> 时间：2008-09-15T15:36:46.847

**电源外壳**

> $f={&$f};&$f

“由于调用深度溢出，脚本失败。调用深度达到1001，最大值为1000。”

* * *

## 回答 #69

> 赞同：1
> 
> 时间：2008-09-15T16:45:15.387

在汇编语言中（x86 处理器，16 或 32 位模式）：

```
 call $ 
```

这将产生：

*   在 32 位模式下：0xe8;0xfb;0xff;0xff;0xff

*   在 16 位模式下：0xe8;0xfd;0xff

在 C/C++ 中：

```
 int main( ) {
  return main( );
} 
```

* * *

## 回答 #70

> 赞同：1
> 
> 时间：2008-09-15T18:50:10.063

TCL：

```
proc a {} a 
```

我没有可以进行尾递归的 tclsh 解释器，但这可能会欺骗这样的事情：

```
proc a {} "a;a" 
```

* * *

## 回答 #71

> 赞同：1
> 
> 时间：2008-09-16T01:35:33.910

不会是最短的，但我必须尝试一些东西...... C#

字符串[] f = 新字符串[0]；主要（f）；

短一点

```
static void Main(){Main();} 
```

* * *

## 回答 #72

> 赞同：1
> 
> 时间：2008-09-16T10:14:39.810

这是另一个 Ruby 答案，这个答案使用 lambdas：

```
(a=lambda{a.call}).call 
```

* * *

## 回答 #73

> 赞同：1
> 
> 时间：2008-09-16T13:04:43.787

**JavaScript**中的另一个：

```
(function() { arguments.callee() })() 
```

* * *

## 回答 #74

> 赞同：1
> 
> 时间：2008-09-16T14:35:11.807

VB6

```
 Public Property Let x(ByVal y As Long)
  x = y
End Property

Private Sub Class_Initialize()
  x = 0
End Sub 
```

* * *

## 回答 #75

> 赞同：1
> 
> 时间：2008-09-16T19:21:20.370

K＆R C中的简短解决方案，可以编译：

```
main(){main()} 
```

14 字节

* * *

## 回答 #76

> 赞同：1
> 
> 时间：2008-09-17T01:24:24.537

作为对 Y 组合器评论的回应，我不妨通过 SKI 演算中的 Y 组合器：

```
S (K (S I I)) (S (S (K S) K) (K (S I I))) 
```

我知道没有任何 SKI 解释器，但我曾经在 actionscript 中大约一个小时内写了一个图形解释器。如果有兴趣，我愿意发布（尽管我从来没有让布局非常有效地工作）

在这里阅读所有相关信息： [http ://en.wikipedia.org/wiki/SKI_combinator_calculus](http://en.wikipedia.org/wiki/SKI_combinator_calculus)

* * *

## 回答 #77

> 赞同：1
> 
> 时间：2008-09-18T06:31:11.857

在 perl 中：

```
`$0` 
```

事实上，这适用于任何支持反引号命令语法并将自己的名称存储在`$0`

* * *

## 回答 #78

> 赞同：1
> 
> 时间：2008-09-18T08:41:28.707

错误的：

[1][1]#

（False 是一种堆栈语言：# 是一个 while 循环，它需要 2 个闭包，一个条件闭包和一个主体。主体是导致溢出的那个）。

* * *

## 回答 #79

> 赞同：1
> 
> 时间：2009-02-20T18:49:01.450

一行CMD溢出

```
echo @call b.cmd > b.cmd & b 
```

* * *

## 回答 #80

> 赞同：1
> 
> 时间：2009-03-03T10:55:26.800

在哈斯克尔

```
fix (1+) 
```

这试图找到 (1+) 函数 ( `λ n → n + 1`) 的固定点。修复的实现是

```
fix f = (let x = f(x) in x) 
```

所以

```
fix (1+) 
```

变成

```
(1+) ((1+) ((1+) ...)) 
```

注意

```
fix (+1) 
```

只是循环。

* * *

## 回答 #81

> 赞同：1
> 
> 时间：2009-06-10T06:16:37.207

**一个更好的lua解决方案：**

```
function c()c()end; 
```

将其粘贴到 SciTE 或交互式命令提示符中，然后调用它。繁荣！

* * *

## 回答 #82

> 赞同：1
> 
> 时间：2010-02-27T18:08:04.410

GNU 使：

创建一个名为“Makefile”的文件，其内容如下：

```
a:
    make 
```

然后运行make：

```
$ make 
```

请注意，必须使用制表符来偏移单词“make”。该文件有 9 个字符，包括 2 个换行符和 1 个制表符。

我想你可以用 bash 做类似的事情，但它可能太容易有趣了：

创建一个文件名“b”并将其标记为可执行文件（chmod +xb）：

```
b ## ties the winning entry with only one character (does not require end-of-line) 
```

现在执行文件

```
$ ( PATH=$PATH:. ; b ) 
```

很难说这种方法在技术上是否会导致堆栈溢出，但它确实会构建一个堆栈，该堆栈会不断增长，直到机器耗尽资源。使用 GNU make 执行此操作的一个很酷的事情是，您可以看到它在构建和销毁堆栈时输出状态信息（假设您在崩溃发生之前的某个时间点按了 ^C）。

* * *

## 回答 #83

> 赞同：1
> 
> 时间：2010-07-03T13:18:22.687

[PHP](http://en.wikipedia.org/wiki/Php)是递归的缩写

* * *

## 回答 #84

> 赞同：1
> 
> 时间：2010-07-21T22:29:27.850

[.](http://www.google.com/#hl=en&&sa=X&ei=n3RHTJ79HcGgnQfKkdm_BA&ved=0CB4QBSgA&q=recursion&spell=1&fp=a412f261c74ac05d)

* * *

## 回答 #85

> 赞同：0
> 
> 时间：2008-09-15T11:20:22.483

**C++**：

```
int overflow(int n)
{
    return overflow(1);
} 
```

* * *

## 回答 #86

> 赞同：0
> 
> 时间：2008-09-15T11:36:13.007

```
int main(){
    int a = 20;
    return main();
} 
```

* * *

## 回答 #87

> 赞同：0
> 
> 时间：2008-09-15T11:37:05.347

**JavaScript：**

```
function i(){ i(); }
i(); 
```

* * *

**C++** 使用函数指针：

```
int main(){
   int (*f)() = &main;
   f();
} 
```

* * *

## 回答 #88

> 赞同：0
> 
> 时间：2008-09-15T11:47:37.067

C#，用 20 个字符完成（不包括空格）：

```
int s(){
    return s();
} 
```

* * *

## 回答 #89

> 赞同：0
> 
> 时间：2008-09-15T12:41:28.373

号角：

```
Poke(0) 
```

* * *

## 回答 #90

> 赞同：0
> 
> 时间：2008-09-15T12:57:10.927

我试图在 Erlang 中做到这一点：

```
c(N)->c(N+1)+c(N-1).
c(0). 
```

自身的双重调用使内存使用率上升`O(n^2)`而不是`O(n)`.

然而，Erlang 解释器似乎并没有崩溃。

* * *

## 回答 #91

> 赞同：0
> 
> 时间：2008-09-15T13:01:30.680

递归是老帽子。这里是相互递归。通过调用任一函数开始。

```
a()
{
    b();
}
b()
{
    a();
} 
```

PS：但是您要求的是最短的方式..不是最有创意的方式！

* * *

## 回答 #92

> 赞同：0
> 
> 时间：2008-09-15T13:19:41.777

在 cell spus 上，没有堆栈溢出，因此不需要递归，我们只需擦除堆栈指针即可。

asm("andi $1, $1, 0" );

* * *

## 回答 #93

> 赞同：0
> 
> 时间：2008-09-15T13:35:37.837

**PHP** - 递归只是为了好玩。我想需要一个 PHP 解释器才能让它停止运行，但是嘿 - 它会导致崩溃。

```
function a() { a(); } a(); 
```

* * *

## 回答 #94

> 赞同：0
> 
> 时间：2008-09-15T13:48:02.177

```
//lang = C++... it's joke, of course
//Pay attention how 
void StackOverflow(){printf("StackOverflow!");}
int main()
{
    StackOverflow(); //called StackOverflow, right?
} 
```

* * *

## 回答 #95

> 赞同：0
> 
> 时间：2008-09-15T14:21:41.767

**Perl** 10 个字符

```
sub x{&x}x 
```

最终耗尽所有可用内存。

* * *

## 回答 #96

> 赞同：0
> 
> 时间：2008-09-15T14:27:41.550

**MS-DOS 批处理：**

```
copy CON so.bat
so.bat
^Z
so.bat 
```

* * *

## 回答 #97

> 赞同：0
> 
> 时间：2008-09-15T15:17:07.407

具有 27 个非空白字符的 C# - 包括调用。

```
Action a = null;
a = () => a();
a(); 
```

* * *

## 回答 #98

> 赞同：0
> 
> 时间：2008-09-15T16:09:44.910

**bash：**只有一个进程

```
\#!/bin/bash
of() { of; }
of 
```

* * *

## 回答 #99

> 赞同：0
> 
> 时间：2008-09-15T16:17:34.830

几乎任何外壳：

```
sh $0 
```

（5 个字符，仅在从文件运行时有效）

* * *

## 回答 #100

> 赞同：0
> 
> 时间：2008-09-15T16:27:46.910

16 位汇编中的五个字节将导致堆栈溢出。

```
push cs
push $-1
ret 
```

* * *

## 回答 #101

> 赞同：0
> 
> 时间：2008-09-15T18:14:29.650

VB.Net

```
Function StackOverflow() As Integer
    Return StackOverflow()
End Function 
```

* * *

## 回答 #102

> 赞同：0
> 
> 时间：2008-09-15T20:05:30.070

为了好玩，我不得不查找摩托罗拉 HC11 组件：

```
 org           $100
Loop    nop
          jsr            Loop 
```

* * *

## 回答 #103

> 赞同：0
> 
> 时间：2008-09-15T20:29:03.320

不是很短，但很有效！(JavaScript)

```
setTimeout(1, function() {while(1) a=1;}); 
```

* * *

## 回答 #104

> 赞同：0
> 
> 时间：2008-09-15T22:53:01.960

我认为这是我以前从未玩过的作弊 ;) 但这里有

8086汇编器：

org Int3VectorAdrress ;这是作弊吗？

诠释 3

1 个字节 - 或 5 个生成代码的字符，你说什么？

* * *

## 回答 #105

> 赞同：0
> 
> 时间：2008-09-16T00:25:46.107

Ruby，虽然不是那么短：

```
class Overflow
    def initialize
        Overflow.new
    end
end

Overflow.new 
```

* * *

## 回答 #106

> 赞同：0
> 
> 时间：2008-09-16T04:23:22.603

在**C#**中，这将创建一个 stackoverflow ...

```
static void Main()
{
    Main();
} 
```

* * *

## 回答 #107

> 赞同：0
> 
> 时间：2008-09-16T05:22:41.820

为什么不

```
mov sp,0 
```

（堆栈向下增长）

* * *

## 回答 #108

> 赞同：0
> 
> 时间：2008-09-16T05:37:25.140

在名为 so.ps的**PostScript文件中会导致 execstackoverflow**

```
%!PS
/increase {1 add} def
1 increase
(so.ps) run 
```

* * *

## 回答 #109

> 赞同：0
> 
> 时间：2008-09-16T22:46:41.267

Actionscript 3: 全部用数组完成...

```
var i=[];
i[i.push(i)]=i;
trace(i); 
```

也许不是最小的，但我认为它很可爱。特别是返回新数组长度的 push 方法！

* * *

## 回答 #110

> 赞同：0
> 
> 时间：2008-09-17T01:42:04.340

在 x86 汇编中，将除以 0 指令放在中断处理程序的内存位置以除以 0！

* * *

## 回答 #111

> 赞同：0
> 
> 时间：2009-02-24T21:21:54.810

**序言**

该程序在咨询时会导致 SWI-Prolog 和 Sicstus Prolog 崩溃。

```
p :- p, q.
:- p. 
```

* * *

## 回答 #112

> 赞同：0
> 
> 时间：2009-02-28T03:49:54.057

不尾调用可以破坏尾调用优化。在 Common Lisp 中：

```
(defun f () (1+ (f)))
```

* * *

## 回答 #113

> 赞同：0
> 
> 时间：2009-04-22T20:36:09.433

D中的元问题：

```
class C(int i) { C!(i+1) c; }
C!(1) c; 
```

编译时栈溢出

* * *

## 回答 #114

> 赞同：0
> 
> 时间：2009-05-11T14:55:15.993

```
_asm t: call t; 
```

* * *

## 回答 #115

> 赞同：0
> 
> 时间：2009-11-14T21:34:39.690

OCaml

```
let rec f l = f l@l;; 
```

这个有点不同。堆栈上只有一个堆栈帧（因为它是尾递归的），但它的输入一直在增长，直到溢出堆栈。只需像这样调用`f`一个非空列表（在解释器提示下）：

```
# f [0];;
Stack overflow during evaluation (looping recursion?). 
```

* * *

## 回答 #116

> 赞同：0
> 
> 时间：2009-11-15T21:26:32.823

虽然它没有真正的堆栈...

**Brainf * ck 5个字符**

```
+[>+] 
```

* * *

## 回答 #117

> 赞同：0
> 
> 时间：2009-12-31T15:04:32.277

Z80汇编语言...

```
.org 1000
loop: call loop 
```

这会在位置 1000 处生成 3 个字节的代码......

1000 光盘 00 10

* * *

## 回答 #118

> 赞同：0
> 
> 时间：2010-01-31T19:39:32.800

红宝石（再次）：

```
def a(x);x.gsub(/./){a$0};end;a"x" 
```

已经有很多红宝石解决方案，但我想我会投入一个正则表达式来衡量。

* * *

## 回答 #119

> 赞同：0
> 
> 时间：2010-02-26T18:10:14.193

另一个 Windows 批处理文件：

```
:a
@call :a 
```

* * *

## 回答 #120

> 赞同：0
> 
> 时间：2010-02-26T21:36:40.953

```
main(){
   main();
}
```

简单而漂亮的C。对我来说感觉很直观。

* * *

## 回答 #121

> 赞同：0
> 
> 时间：2010-03-07T14:46:11.467

## Fortran，13 和 20 个字符

```
real n(0)
n(1)=0
end 
```

或者

```
call main
end 
```

第二种情况是依赖于编译器的；对于 GNU Fortran，它需要使用`-fno-underscoring`.

（这两个计数都包括必需的换行符）

* * *

## 回答 #122

> 赞同：0
> 
> 时间：2010-05-25T11:40:07.883

哈斯克尔：

```
main = print $ x 1 where x y = x y + 1 
```

* * *

## 回答 #123

> 赞同：0
> 
> 时间：2010-06-12T15:55:39.957

对话 APL

```
fib←{
    ⍵∊0 1:⍵
    +/∇¨⍵-1 2
} 
```

* * *

## 回答 #124

> 赞同：0
> 
> 时间：2010-06-12T16:07:33.303

```
int main(void) { return main(); } 
```

* * *

## 回答 #125

> 赞同：0
> 
> 时间：2010-07-12T17:19:51.397

Python：

```
import sys  
sys.setrecursionlimit(sys.maxint)  
def so():  
    so()  
so() 
```

* * *

## 回答 #126

> 赞同：0
> 
> 时间：2010-07-27T13:12:47.363

## JavaScript（17 字节）

```
eval(t="eval(t)") 
```

## VB 脚本（25 字节）

```
t="Execute(t)":Execute(t) 
```

* * *

## 回答 #127

> 赞同：-1
> 
> 时间：2008-09-15T14:01:40.647

红宝石：

```
def i()i()end;i() 
```

（17 个字符）

* * *

## 回答 #128

> 赞同：-1
> 
> 时间：2008-09-15T20:12:25.013

**序言**

p:-p。

= 5 个字符

然后启动它并查询 p

我认为这很小，并且在序言中用完了堆栈。

在 swi prolog 中仅查询一个变量会产生：

?- X. % ... 1,000,000 .... 10,000,000 年后 % % >> 42 << （最新版本给出了问题）

这是另一个 bash fork 炸弹：:(){ :|:& };:

* * *

## 回答 #129

> 赞同：-1
> 
> 时间：2008-09-16T01:24:17.853

我认为这将在 Java 中工作（未尝试）：

```
enum A{B.values()}
enum B{A.values()} 
```

由于缺少 main(String[])，它甚至有机会失败之前，应该在静态初始化中溢出。

* * *

## 回答 #130

> 赞同：-4
> 
> 时间：2009-02-28T01:52:41.437

```
Redmond.Microsoft.Core.Windows.Start() 
```

* * *

## 回答 #131

> 赞同：-6
> 
> 时间：2008-09-15T19:49:20.950

哎呀，我不知道，我从来没有写过导致堆栈溢出的代码；）

# ruby-on-rails - 如何（以及是否）使用初始数据填充 Rails 应用程序

> ID：62201
> 
> 赞同：65
> 
> 时间：2008-09-15T11:25:19.260
> 
> 标签：ruby-on-rails, data-migration

我有一个 Rails 应用程序，用户必须在其中登录。因此，为了使应用程序可用，系统中必须有一个初始用户供第一个人登录（然后他们可以创建后续用户）。到目前为止，我已经使用迁移将特殊用户添加到数据库中。

在问[了这个问题](https://stackoverflow.com/questions/62038/rails-model-validators-break-earlier-migrations)之后，似乎我应该使用 db:schema:load，而不是运行迁移，在新的开发机器上设置新的数据库。不幸的是，这似乎不包括插入数据的迁移，只包括那些设置表、键等的迁移。

我的问题是，处理这种情况的最佳方法是什么：

1.  有没有办法让 d:s:l 包含数据插入迁移？
2.  我不应该使用迁移以这种方式插入数据吗？
3.  我不应该用数据预先填充数据库吗？我是否应该更新应用程序代码，以便它能够优雅地处理没有用户的情况，并允许从应用程序内实时创建初始用户帐户？
4.  还有其他选择吗？:)

* * *

## 回答 #1

> 赞同：45
> 
> 时间：2008-09-15T12:52:12.730

尝试 rake 任务。例如：

1.  创建文件**/lib/tasks/bootstrap.rake**
2.  在文件中，添加一个任务来创建您的默认用户：

```
 namespace :bootstrap do
      desc "Add the default user"
      task :default_user => :environment do
        User.create( :name => 'default', :password => 'password' )
      end

      desc "Create the default comment"
      task :default_comment => :environment do
        Comment.create( :title => 'Title', :body => 'First post!' )
      end

      desc "Run all bootstrapping tasks"
      task :all => [:default_user, :default_comment]
    end 
```

3.  然后，当您第一次设置应用程序时，您可以执行 rake db:migrate OR rake db:schema:load，然后执行 rake bootstrap:all。

* * *

## 回答 #2

> 赞同：37
> 
> 时间：2013-02-13T22:01:48.670

**`db/seed.rb`**在每个 Rails 应用程序中都可以使用。

**虽然上面从2008 年**给出的一些答案可以很好地工作，但它们已经过时了，它们不再是真正的 Rails 约定了。

应使用`db/seed.rb`文件将初始数据填充到数据库中。

它就像一个 Ruby 文件一样工作。

为了创建和保存对象，您可以执行以下操作：

`User.create(:username => "moot", :description => "king of /b/")`

准备好此文件后，您可以执行以下操作

`rake db:migrate`

`rake db:seed`

或者一步到位

`rake db:setup`

您的数据库应该填充您想要在 seed.rb 中创建的任何对象

* * *

## 回答 #3

> 赞同：32
> 
> 时间：2008-09-15T17:14:16.737

我建议您不要在迁移中插入任何*新数据。*相反，只修改迁移中的现有数据。

对于插入初始数据，我建议您使用 YML。在我设置的每个 Rails 项目中，我都会在 DB 目录下创建一个 fixtures 目录。然后我为初始数据创建 YML 文件，就像 YML 文件用于测试数据一样。然后我添加了一个新任务来从 YML 文件中加载数据。

**lib/tasks/db.rake：**

```
namespace :db do
  desc "This loads the development data."
  task :seed => :environment do
    require 'active_record/fixtures'
    Dir.glob(RAILS_ROOT + '/db/fixtures/*.yml').each do |file|
      base_name = File.basename(file, '.*')
      say "Loading #{base_name}..."
      Fixtures.create_fixtures('db/fixtures', base_name)
    end
  end

  desc "This drops the db, builds the db, and seeds the data."
  task :reseed => [:environment, 'db:reset', 'db:seed']
end 
```

**db/fixtures/users.yml：**

```
test:
  customer_id: 1
  name: "Test Guy"
  email: "test@example.com"
  hashed_password: "656fc0b1c1d1681840816c68e1640f640c6ded12"
  salt: "188227600.754087929365988" 
```

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2008-09-16T12:37:43.413

这是我最喜欢的新解决方案，使用 populator 和 faker gems：

[http://railscasts.com/episodes/126-populating-a-database](http://railscasts.com/episodes/126-populating-a-database)

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-09-16T09:17:04.143

试试[seed-fu](http://www.intridea.com/2008/4/20/seed-fu-simple-seed-data-for-rails)插件，这是一个非常简单的插件，可以让您播种数据（并在将来更改该种子数据），还可以让您播种环境特定数据和所有环境的数据。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-09-15T11:36:20.120

我想最好的选择是 3 号，主要是因为这样不会有默认用户，这是一种很好的方式来使原本好的安全性变得无用。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-09-16T19:42:43.517

我想我会总结一下我对这个问题的一些很好的答案，连同我自己的想法，现在我已经全部阅读了:)

这里有两个不同的问题：

1.  我应该用我的特殊“管理员”用户预填充数据库吗？或者应用程序是否应该在首次使用时提供一种设置方式？
2.  如何用数据预先填充数据库？请注意，无论第 1 部分的答案如何，这都是一个有效的问题：预填充还有其他使用场景，而不是管理员用户。

对于 (1)，似乎从应用程序本身设置第一个用户是相当多的额外工作，因为根据定义，这些功能几乎从未使用过。但是，它可能会稍微安全一些，因为它会强制用户设置他们选择的密码。最好的解决方案介于这两个极端之间：有一个脚本（或 rake 任务，或其他）来设置初始用户。然后可以将脚本设置为在开发期间使用默认密码自动填充，并在生产安装/部署期间要求输入密码（如果您不希望管理员使用默认密码）。

对于 (2)，似乎有许多好的、有效的解决方案。rake 任务似乎是一个好方法，并且有一些插件可以使这变得更加容易。只需查看其他一些答案即可查看这些答案的详细信息:)

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-09-15T12:04:04.877

考虑使用 rails 控制台。适合一次性的管理任务，不值得努力设置脚本或迁移。

在您的生产机器上：

```
script/console production 
```

... 然后 ...

```
User.create(:name => "Whoever", :password => "whichever") 
```

如果您不止一次地生成此初始用户，那么您还可以在 RAILS_ROOT/script/ 中添加一个脚本，并从生产机器上的命令行或通过 capistrano 任务运行它。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-09-15T21:04:17.930

该 Rake 任务可以由 db-populate 插件提供：

[http://github.com/joshknowles/db-populate/tree/master](http://github.com/joshknowles/db-populate/tree/master)

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2010-09-10T03:48:40.327

很棒的博客文章： [http ://railspikes.com/2008/2/1/loading-seed-data](http://railspikes.com/2008/2/1/loading-seed-data)

我正在使用 Jay 对一组特殊装置的建议，但很快发现自己创建了无法直接使用模型的数据（我使用acts_as_versioned 时的未版本化条目）

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-09-15T11:33:31.813

我会把它保留在迁移中。虽然建议使用架构进行初始设置，但这样做的原因是它更快，从而避免了问题。对数据进行一次额外的迁移应该没问题。

您还可以将数据添加到架构文件中，因为它的格式与迁移相同。您只会失去自动生成功能。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2008-09-15T17:00:58.797

对于用户和组，应根据应用程序的需求而不是编程的偶然性来定义预先存在的用户的问题。也许您的应用需要管理员；然后预填充。或者可能不是 - 然后添加代码以在应用程序启动时优雅地请求用户设置。

关于更一般的问题，很明显许多 Rails 应用程序可以从预填充日期中受益。例如，美国地址持有申请也可能包含所有州及其缩写。对于这些情况，我相信迁移是你的朋友。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2014-01-21T11:08:32.643

有些答案已经过时了。从 Rails 2.3.4 开始，有一个名为 Seed 的简单功能可用于`db/seed.rb`：

```
#db/seed.rb
User.create( :name => 'default', :password => 'password' )
Comment.create( :title => 'Title', :body => 'First post!' ) 
```

它提供了一个新的 rake 任务，您可以在迁移后使用它来加载数据：

```
rake db:seed 
```

Seed.rb 是一个经典的 Ruby 文件，您可以随意使用任何经典的数据结构（数组、哈希等）和迭代器来添加您的数据：

```
["bryan", "bill", "tom"].each do |name|
  User.create(:name => name, :password => "password")
end 
```

如果要添加 UTF-8 字符的数据（在法语、西班牙语、德语等中很常见），不要忘记在文件开头添加：

```
# ruby encoding: utf-8 
```

这个 Railscast 是一个很好的介绍：[http ://railscasts.com/episodes/179-seed-data](http://railscasts.com/episodes/179-seed-data)

# c# - 有什么办法可以摆脱 .cs 文件顶部的长长的使用列表？

> ID：62219
> 
> 赞同：0
> 
> 时间：2008-09-15T11:41:43.230
> 
> 标签：c#, .net, visual-studio, namespaces

随着我的解决方案中的命名空间越来越多，文件顶部的 using 语句列表越来越长。在我的单元测试中尤其如此，对于每个可能被调用的组件，我需要包括接口的使用、IoC 容器和具体类型。

在我的集成测试文件中有超过 17 行的使用，它变得非常混乱。有谁知道是否有一种方法可以使用语句为我的基础定义宏？还有其他解决方案吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-15T12:08:49.170

我知道我不应该大声说出来，但是，也许重新考虑你的设计。

1 个文件中的 17 个使用 = 很多耦合（在命名空间级别）。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-15T11:44:04.033

有些人喜欢将用途隐藏在`#region`. 否则，我认为你不走运。除非您想将名称空间放在所有引用对象上。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-15T12:19:39.830

我自己受不了Resharper。但我也不能忍受凌乱的使用语句。我使用 VS 的[Power Commands](http://code.msdn.microsoft.com/PowerCommands)插件，它有一个方便的“删除和排序”使用语句命令（以及其他好东西）。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-15T12:45:20.737

这里有四个可能的问题；

**您代码中的命名空间将您的类划分得太细了。**例如，如果您有；

```
using MyCompany.Drawing.Vector.Points;
using MyCompany.Drawing.Vector.Shapes;
using MyCompany.Drawing.Vector.Transformations; 
```

考虑将它们折叠到单个`MyCompany.Drawing.Vector`命名空间。您可能不会通过划分太多来获得收益。Visual Studio Code Analysis/FxCop 对此有一个规则，检查命名空间中的类数量。太少了，它会警告你。

**您将太多测试放入同一个班级。**如果您在同一个类中引用`System.Data`、`System.Drawing`和`System.IO`，请考虑编写更多原子测试——一些访问数据库，一些绘制图像，还有一些访问文件系统。然后将每种类型划分为三个测试类。

**你正在编写做太多的测试。**如果你引用了很多命名空间，你的测试可能将太多的特性耦合在一起。这种耦合通常是有问题的，所以试着把大的、范围广泛的功能分解成更小的部分，并在单独的文件中测试它们。

**许多是多余的。**它们都是用过的，还是只是从其他文件中复制粘贴的。右键单击代码编辑器并从“组织使用”选项中选择以删除未使用的语句。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-15T11:59:23.733

> 有谁知道是否有一种方法可以使用语句为我的基础定义宏？

您的意思是您经常使用的命名空间会自动添加到每个新类中吗？如果是，Resharper 也可以这样做。此外，它具有将使用放在代码清理区域的功能。Resharper 可能是要走的路（根据我自己的经验，你不会后悔的）。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-15T12:24:18.087

VS2008 添加了一个“组织使用”上下文菜单，它有一个排序、删除和“删除和排序”选项，可以为每个文件执行您想要的操作。Visual Studio Power Commands 加载项在解决方案资源管理器中为项目和解决方案添加了一个上下文菜单，分别是项目中所有文件和解决方案中所有项目的“删除和排序”。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-15T12:31:28.477

如果要更改创建新文件时完成的默认 using 语句，请查看 C:\Program Files\Microsoft Visual Studio 9.0\Common7\IDE\ItemTemplates\CSharp\Code\1033 目录。它包含一堆 zip 文件，您可以修改它们以更改代码文件的模板（显然向上移动目录结构以更改其他语言或其他类型的文件）。

请参阅[此处](http://mark.michaelis.net/Blog/ChangingTheDefaultItemTemplatesInVisualStudio2005.aspx)了解更多信息。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-15T13:12:48.173

使用别名可能会有所帮助。不确定它是否值得，但不是：

```
using System.Web.UI;
using System.Web.Mail;
using System.Web.Security;
... Control ...
... MailMessage ...
... Roles ... 
```

您可以使用：

```
using W = System.Web;
... W.UI.Control ...
... W.Mail.MailMessage ...
... W.Security.Rolse ... 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-15T11:43:26.517

Resharper - Visual Studio 的插件 - 具有从文件中删除未使用的 Using 的功能，但我不知道任何与您描述的完全一样的功能。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-15T12:26:21.373

在 VS2008 中，您可以右键单击 CS 文件并选择“组织使用”。它也会为您去除未使用的使用并对其进行分类。除此之外，我只会使用#region。此外，`CTRL`++`M`将`O`在设计时折叠所有区域功能等。我经常使用这个快捷方式！

# visual-studio - Classis ASP在VS2005中调试global.asa

> ID：62225
> 
> 赞同：2
> 
> 时间：2008-09-15T11:44:26.763
> 
> 标签：visual-studio, debugging, visual-studio-2005, asp-classic, global.asa

我试图在 Visual Studio 2005 中使用 IIS 6 的旧经典 ASP 项目中的 global.asa 中设置断点。

不知何故，用于在 global.asa 中某处实际设置断点的上下文菜单被禁用（灰色）。那我该如何设置断点呢？

.asp 页面中的断点虽然没有问题，而且工作正常。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-15T12:27:39.297

试试这个：[如何：调试 Global.asa 文件](http://msdn.microsoft.com/en-us/library/ms241868(VS.80).aspx)。简短的版本是将 VBScript Stop 语句或 JScript 调试器放在过程的开头，在您想要单步执行的任何语句之前。

# php - 如何在 PHP 中访问父对象的类变量？

> ID：62226
> 
> 赞同：2
> 
> 时间：2008-09-15T11:45:06.700
> 
> 标签：php, oop

A 类的一个实例实例化了几个其他对象，例如来自 B 类：

```
$foo = new B(); 
```

我想从 B 中的方法访问 A 的公共类变量。

除非我遗漏了什么，否则这样做的唯一方法是将当前对象传递给 B 的实例：

```
$foo = new B($this); 
```

这是最佳做法还是有其他方法可以做到这一点？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-15T11:56:50.853

这对我来说看起来不错，我倾向于使用“维护这个的人会理解它吗？”的经验法则。这是一个易于理解的解决方案。

如果只有一个“A”，您可以考虑使用注册表模式，例如参见[http://www.phppatterns.com/docs/design/the_registry](http://www.phppatterns.com/docs/design/the_registry)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-15T11:52:35.073

我会首先检查您是否使用了错误的模式：从您的应用程序逻辑来看，B 真的应该知道 A 吗？如果 B 需要了解 A，那么亲子关系似乎还不够。例如，A 可以是孩子，或者 A 的部分逻辑可以进入层次结构中“低于”B 的第三个对象（即不知道 B）。

也就是说，我建议你在 B 中有一个方法来将 A 注册为数据源，或者在 A 中创建一个方法来将 B 注册为[观察者](http://en.wikipedia.org/wiki/Observer_pattern "维基百科：观察者模式")，并在 B 中创建一个匹配方法，A 用来通知 B 值更改。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-16T19:49:29.803

与 Paul 所说的类似，如果只有一个 A，您可以将其实现为单例。然后，您可以将 A 的实例作为参数传递给构造函数（聚合），使用 setter 方法（本质上再次聚合），或者您可以直接在构造函数中设置此关系（组合）。

然而，虽然单例很强大，但要小心使用组合来实现它们。很高兴认为您可以这样做并摆脱构造函数参数，但这也使得在不重写代码的情况下无法用其他东西替换 A。就个人而言，我会坚持聚合，即使使用单例

```
$foo = new B( A::getInstance() ); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-19T16:51:35.183

```
$foo = new B($this); 
```

不幸的是，这样的代码不符合我的需求。还有其他方法可以访问父对象属性吗？

我将尝试解释原因。我们编写了一个游戏软件，一些类具有非常“不寻常”的依赖关系，并以不同的方式相互影响。这就是为什么代码有时在每个实例中如果没有与父级的链接就几乎无法支持（有时甚至来自不同上下文的多个父级，即一个小队可能属于 Battle 和 User 等......）。

现在链接不满足我的原因。当我为客户端生成输出时，我使用 XML 中的一种序列化对象。它工作得非常好，直到它遇到递归引用，比如那些指向父母的链接。我可以使它们受到保护，但随后它们就失去了使用，即（虚拟示例）

```
$this->squad->battle->getTeam($tid)->getSquad($sqid)->damageCreature(...); 
```

另一种方法 - 在每个可序列化类中实现序列化方法并在序列化器中调用它，如下所示：

```
$obj->toXML($node);
$this->appendChild($node); 
```

但有很多东西要写和支持！有时我会动态地为序列化程序生成对象（更少的流量）。

我什至想到了一个技巧：“教”序列化程序忽略某些类中的某些属性））。呃……坏主意……

这是一个漫长的讨论，但相信我，Registry 和 Observer 不适合。还有其他想法吗？

# delphi - 如何将 jpg 图像保存到数据库，然后使用 FIBplus 和 TImage 将其加载到 Delphi 中？

> ID：62230
> 
> 赞同：0
> 
> 时间：2008-09-15T11:46:36.837
> 
> 标签：delphi, timage, fibplus

如何将 jpg 图像保存到数据库，然后使用 FIBplus 和 TImage 在 Delphi 中加载它？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-16T03:49:15.900

```
var
  S : TMemoryStream;
begin
  S := TMemoryStream.Create;
  try
    TBlobField(AdoQuery1.FieldByName('ImageField')).SaveToStream(S);
    S.Position := 0;
    Image1.Picture.Graphic.LoadFromStream(S);
  finally
    S.Free;
  end;
end; 
```

如果您使用的是 JPEG 图像，请将 JPG 单位添加到单位文件的**uses**子句中。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-15T19:15:12.560

[这个页面](http://www.devrace.com/en/fibplus/articles/2161.php)解释了它。如果您不想要临时文件，请使用 SaveToStream 和 TMemoryStream 而不是 SaveToFile。TImage.Picture 有一个 LoadFromStream ，它将图像从流中加载到 TImage 中进行显示。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-09-15T12:08:55.817

[看看这里。](http://delphi.about.com/od/database/l/aa030601a.htm) 我认为您必须将其转换为流，存储它，反之亦然。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2014-12-29T16:14:04.613

Delphi 7 悖论表

将 dbimage 插入 jpeg

```
var
  FileStream: TFileStream;
  BlobStream: TStream;
begin
  if openpicturedialog1.Execute then
  begin
    Sicil_frm.DBNavigator1.BtnClick(nbEdit);
    image1.Picture.LoadFromFile(openpicturedialog1.FileName);
    try
       BlobStream := dm.sicil.CreateBlobStream(dm.sicil.FieldByName('Resim'),bmWrite);
       FileStream := TFileStream.Create(openpicturedialog1.FileName,fmOpenRead or fmShareDenyNone);
       BlobStream.CopyFrom(FileStream,FileStream.Size);
       FileStream.Free;
       BlobStream.Free;
       Sicil_frm.DBNavigator1.BtnClick(nbPost);
       DM.SicilAfterScroll(dm.sicil);
     except
       dm.sicil.Cancel;
     end;
  end;
end; 
```

错误“位图图像 nat 有效”

# internet-explorer - 如何以不同的分辨率查看网页

> ID：62232
> 
> 赞同：1
> 
> 时间：2008-09-15T11:47:13.463
> 
> 标签：internet-explorer, resolution

我正在开发一个网站，需要看看它在不同分辨率下的外观。问题是它必须在我们的 Intranet 上运行。

有免费的解决方案吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-15T11:48:32.870

对于 Firefox，Web 开发人员工具栏 ( [https://addons.mozilla.org/en-US/firefox/addon/60](https://addons.mozilla.org/en-US/firefox/addon/60) )

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-15T12:14:36.083

在您喜欢的浏览器的地址栏中输入：javascript:resizeTo(1024,768)

然后调整到您想要的分辨率。您甚至可以将这些作为书签保存在您的收藏夹/书签中。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-15T11:50:38.700

对于 Internet Explorer，有[Internet Explorer Developer Toolbar](http://www.microsoft.com/en-us/download/details.aspx?id=18359)。它使您可以很容易地选择分辨率。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-15T12:16:11.587

如果您仅限于内部测试，这可能不起作用，但是当您想要检查您的网站在各种操作系统/浏览器组合上的性能时，[Browsercam是一项很棒的服务。](http://www.browsercam.com/)它消除了浏览器测试中的猜测。

如果您必须留在内部网络中，那么为什么不使用您需要的软件设置虚拟 PC？维护几组虚拟 PC 并简单地启动您需要测试的那些非常容易。当然，您可以使用此方法测试各种附加组件等。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-15T12:26:59.673

我使用一个名为[UltraMon](http://www.realtimesoft.com/ultramon/)的产品。从技术上讲，它是一种可以让您更轻松地管理多台显示器的产品。很酷的事情（对这个问题很重要）是您可以设置多个“显示配置文件”。我有两个设置：

1.  我在两台显示器上的默认 1280*1024
2.  一台显示器为 1280*1024，另一台为 1024*768

它允许您设置任意数量的配置文件，我只需在它们之间切换以检查不同的分辨率。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-09-15T15:45:45.497

Internet Explorer 7 上还有[IE7Pro](http://www.ie7pro.com/)。它还提供了一些不在开发者工具栏中的小工具。我都安装了，并且经常使用。

# java - 如何将 Reader 转换为 InputStream 并将 Writer 转换为 OutputStream？

> ID：62241
> 
> 赞同：97
> 
> 时间：2008-09-15T11:51:48.197
> 
> 标签：java, stream

有没有一种简单的方法可以避免处理文本编码问题？

* * *

## 回答 #1

> 赞同：96
> 
> 时间：2010-07-13T09:35:40.783

如果您从 String 开始，您还可以执行以下操作：

```
new ByteArrayInputStream(inputString.getBytes("UTF-8")) 
```

* * *

## 回答 #2

> 赞同：50
> 
> 时间：2008-09-15T12:01:47.050

您无法真正避免处理文本编码问题，但 Apache Commons 中有现有的解决方案：

*   `Reader`至`InputStream`：[`ReaderInputStream`](https://commons.apache.org/proper/commons-io/javadocs/api-release/org/apache/commons/io/input/ReaderInputStream.html)
*   `Writer`至`OutputStream`：[`WriterOutputStream`](https://commons.apache.org/proper/commons-io/javadocs/api-release/org/apache/commons/io/output/WriterOutputStream.html)

您只需要选择您选择的编码。

* * *

## 回答 #3

> 赞同：47
> 
> 时间：2012-10-17T18:20:00.967

好吧，Reader 处理字符，InputStream 处理字节。编码指定您希望如何将字符表示为字节，因此您不能真正忽略这个问题。至于避免问题，我的意见是：选择一个字符集（例如“UTF-8”）并坚持下去。

关于如何实际做到这一点，正如已经指出的那样，“*这些类的明显名称是**ReaderInputStream**和**WriterOutputStream**。* ”令人惊讶的是，“*这些不包含在 Java 库中*”，即使“相反”类[InputStreamReader](http://docs.oracle.com/javase/6/docs/api/java/io/InputStreamReader.html)和[OutputStreamWriter](http://docs.oracle.com/javase/6/docs/api/java/io/OutputStreamWriter.html) **是**包括。

因此，很多人提出了自己的实现，包括**Apache** [Commons IO](http://commons.apache.org/io/)。根据许可问题，您可能能够在项目中包含 commons-io 库，甚至可以复制部分源代码（可[在此处](http://commons.apache.org/io/download_io.cgi)下载）。

*   Apache ReaderInputStream：[API](https://commons.apache.org/proper/commons-io/javadocs/api-release/org/apache/commons/io/input/ReaderInputStream.html) /[源代码直接链接](https://svn.apache.org/repos/asf/commons/_moved_to_git/io/tags/2.5/src/main/java/org/apache/commons/io/input/ReaderInputStream.java)
*   Apache WriterOutputStream：[API](https://commons.apache.org/proper/commons-io/javadocs/api-release/org/apache/commons/io/output/WriterOutputStream.html) /[源代码直接链接](https://svn.apache.org/repos/asf/commons/_moved_to_git/io/tags/2.5/src/main/java/org/apache/commons/io/output/WriterOutputStream.java)

如您所见，两个类的文档都指出“JRE 支持的所有字符集编码都得到了正确处理”。

注意这里对其他答案之一的评论提到[了这个错误](https://issues.apache.org/bugzilla/show_bug.cgi?id=40455)。但这会影响 Apache **Ant** ReaderInputStream 类（[此处](https://git-wip-us.apache.org/repos/asf?p=ant.git;a=blob_plain;f=src/main/org/apache/tools/ant/util/ReaderInputStream.java;hb=c11dcf20fa01d13c96a4017a734488ba763cc075)），*而不是*Apache **Commons IO** ReaderInputStream 类。

* * *

## 回答 #4

> 赞同：19
> 
> 时间：2010-03-03T18:21:08.313

[另请注意，如果您从 String 开始，您可以跳过创建 StringReader 并使用Commons IO](http://commons.apache.org/io/)中的 org.apache.commons.io.IOUtils 一步创建 InputStream，如下所示：

```
InputStream myInputStream = IOUtils.toInputStream(reportContents, "UTF-8"); 
```

当然，您仍然需要考虑文本编码，但至少转换是一步完成的。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2014-12-19T11:56:45.967

采用：

```
new CharSequenceInputStream(html, StandardCharsets.UTF_8); 
```

这种方式不需要预先转换到`String`再到`byte[]`，这会分配更多的堆内存，以防报告很大。当流被读取时，它会立即从 StringBuffer 中转换为字节。

它使用来自 Apache Commons IO 项目的[CharSequenceInputStream 。](https://commons.apache.org/proper/commons-io/javadocs/api-2.4/org/apache/commons/io/input/CharSequenceInputStream.html "字符序列输入流")

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2010-11-24T15:41:38.883

[commons-io 2.0](http://commons.apache.org/io/)有[`WriterOutputStream`](https://commons.apache.org/proper/commons-io/javadocs/api-release/org/apache/commons/io/output/WriterOutputStream.html)

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2008-09-15T12:00:00.720

这些类的明显名称是 ReaderInputStream 和 WriterOutputStream。不幸的是，这些不包含在 Java 库中。但是，谷歌是你的朋友。

我不确定它是否能解决所有文本编码问题，这简直就是噩梦。

[有一个 RFE，](http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=4103785)但它已关闭，无法修复。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2012-05-18T15:14:50.840

你无法避免文本编码问题，但[Apache commons-io](http://commons.apache.org/io/)有

*   [阅读器输入流](https://commons.apache.org/proper/commons-io/javadocs/api-release/org/apache/commons/io/input/ReaderInputStream.html)
*   [WriterOutputStream](https://commons.apache.org/proper/commons-io/javadocs/api-release/org/apache/commons/io/output/WriterOutputStream.html)

请注意，这些是彼得对 koders.com 的回答中提到的库，只是指向库的链接而不是源代码。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2009-09-01T04:03:53.017

您是否正在尝试将 a 的内容写入`Reader`a `OutputStream`？如果是这样，您将更容易将 an 包装起来`OutputStream`并将s 从 the写入`OutputStreamWriter`s ，而不是尝试将 reader 转换为 an ：`char``Reader``Writer``InputStream`

```
final Writer writer = new BufferedWriter(new OutputStreamWriter( urlConnection.getOutputStream(), "UTF-8" ) );
int charsRead;
char[] cbuf = new char[1024];
while ((charsRead = data.read(cbuf)) != -1) {
    writer.write(cbuf, 0, charsRead);
}
writer.flush();
// don't forget to close the writer in a finally {} block 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2017-08-06T18:07:04.220

您可以使用[Cactoos](http://www.cactoos.org)（没有静态方法，只有对象）：

*   [`new InputStreamOf(reader)`](http://static.javadoc.io/org.cactoos/cactoos/0.13.1/org/cactoos/io/InputStreamOf.html)
*   [`new OutputStreamTo(writer)`](http://static.javadoc.io/org.cactoos/cactoos/0.13.1/org/cactoos/io/OutputStreamTo.html)

您也可以反过来转换：

*   [`new ReaderOf(inputStream)`](http://static.javadoc.io/org.cactoos/cactoos/0.13.1/org/cactoos/io/ReaderOf.html)
*   [`new WriterTo(outputStream)`](http://static.javadoc.io/org.cactoos/cactoos/0.13.1/org/cactoos/io/WriterTo.html)

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2013-07-05T16:14:43.933

使用 WriterOutputStream 时的警告 - 它并不总是正确地处理将二进制数据写入文件/与常规输出流相同。我有一个问题，我花了一段时间才找到。

如果可以，我建议使用输出流作为基础，如果需要编写字符串，请使用流周围的 OUTputStreamWriter 包装器来完成。将文本转换为字节比其他方式更可靠，这可能是 WriterOutputStream 不是标准 Java 库的一部分的原因

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2021-02-15T11:01:37.113

这是基于 UTF-8 的简单编码 WriterOutputStream 和 ReaderInputStream 的源代码。最后经过测试。

```
 // https://www.woolha.com/tutorials/deno-utf-8-encoding-decoding-examples
    public class WriterOutputStream extends OutputStream {
        final Writer    writer;

        int             count       = 0;
        int             codepoint   = 0;

        public WriterOutputStream(Writer writer) {
            this.writer = writer;
        }

        @Override
        public void write(int b) throws IOException {
            b &= 0xFF;
            switch (b >> 4) {
            case 0b0000:
            case 0b0001:
            case 0b0010:
            case 0b0011:
            case 0b0100:
            case 0b0101:
            case 0b0110:
            case 0b0111:
                count = 1;
                codepoint = b;
                break;

            case 0b1000:
            case 0b1001:
            case 0b1010:
            case 0b1011:
                codepoint <<= 6;
                codepoint |= b & 0b0011_1111;
                break;

            case 0b1100:
            case 0b1101:
                count = 2;
                codepoint = b & 0b0001_1111;
                break;

            case 0b1110:
                count = 3;
                codepoint = b & 0b0000_1111;
                break;

            case 0b1111:
                count = 4;
                codepoint = b & 0b0000_0111;
                break;
            }
            if (--count == 0) {
                writer.write(codepoint);
            }
        }
    }

    public class ReaderInputStream extends InputStream {
        final Reader    reader;
        int             count   = 0;
        int             codepoint;

        public ReaderInputStream(Reader reader) {
            this.reader = reader;
        }

        @Override
        public int read() throws IOException {
            if (count-- > 0) {
                int r = codepoint >> (count * 6);
                r &= 0b0011_1111;
                r |= 0b1000_0000;
                return r;
            }

            codepoint = reader.read();
            if (codepoint < 0)
                return -1;
            if (codepoint > 0xFFFF)
                return 0;

            if (codepoint < 0x80)
                return codepoint;

            if (codepoint < 0x800) {
                count = 1;
                int v = (codepoint >> 6) | 0b1100_0000;
                return v;
            }
            count = 2;
            int v = (codepoint >> 12) | 0b1110_0000;
            return v;
        }
    } 
```

以及验证 65536 个字符中的每一个是否正确编码和解码的测试用例，以及验证它是否与 Java 编码匹配。代理验证（2 个字符编码）被忽略，因为这是在 Java 中处理的。

```
 @Test
    public void testAll() throws IOException {
        for (char i = 0; i < 0xFFFF; i++) {
            CharArrayReader car = new CharArrayReader(new char[] { i });
            ReaderInputStream rtoi = new ReaderInputStream(car);
            byte[] data = IO.read(rtoi);

            CharArrayWriter caw = new CharArrayWriter();
            try (WriterOutputStream wtoo = new WriterOutputStream(caw)) {
                wtoo.write(data);
                char[] translated = caw.toCharArray();
                assertThat(translated.length).isEqualTo(1);
                assertThat((int) translated[0]).isEqualTo(i);

                if (!Character.isSurrogate((char) i)) {
                    try (InputStream stream = new ByteArrayInputStream(data)) {
                        caw = new CharArrayWriter();
                        IO.copy(data, caw);
                        translated = caw.toCharArray();
                        assertThat(translated.length).isEqualTo(1);
                        assertThat((int) translated[0]).isEqualTo(i);
                    }
                }
            }
        }
    } 
```

* * *

## 回答 #13

> 赞同：-1
> 
> 时间：2015-01-07T14:21:19.983

用于使用 java 提供的内容读取流中的字符串。

```
InputStream s = new BufferedInputStream( new ReaderInputStream( new StringReader("a string"))); 
```

# erlang - 合并 Mnesia 的记录

> ID：62245
> 
> 赞同：3
> 
> 时间：2008-09-15T11:54:16.990
> 
> 标签：erlang, mnesia

我正在尝试重构一些用于收集呼叫队列中代理当前状态的软件的代码。目前，对于我收听的大约 6 个事件中的每一个，如果代理存在，我会检查 Mnesia 表，并根据事件更改行中的一些值，或者如果代理不存在，则将其添加为新值。目前我在每个事件中都有这个 Mnesia 事务，当然这是一堆重复的代码，用于检查代理的存在等等。

我正在尝试更改它，以便有一个像*change_agent/2*这样的函数，我从为我处理这个的事件中调用它。

我的问题当然是记录......我找不到动态创建它们或将它们中的两个合并或任何东西的方法。最好有一个我可以调用的函数：

```
change_agent("001", #agent(id = "001", name = "Steve")).
change_agent("001", #agent(id = "001", paused = 0, talking_to = "None")). 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-15T12:55:56.700

很难为记录编写通用访问函数。一种解决方法是[“exprecs”](http://forum.trapexit.org/viewtopic.php?p=21790#21790)库，它将为低级记录访问函数生成代码。

您需要做的就是将以下行添加到模块中：

```
-compile({parse_transform, exprecs}).
-export_records([...]).  % name the records that you want to 'export' 
```

访问函数的命名约定可能看起来很奇怪，但它的灵感来自 Richard O'Keefe 的提议。它至少是一致的，并且不太可能与现有功能发生冲突。（：

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-15T13:32:15.083

前段时间我写了一些代码来合并两条记录。不是完全动态的，但是通过宏，您可以轻松地将其用于多条记录。

它的工作原理是这样的：merge/2 函数获取两条记录并将它们与空记录一起转换为列表以供参考（记录类型是在编译时定义的，并且必须是。这是“非动态”部分）。然后通过通用函数 merge/4 运行，该函数与列表一起使用，如果定义了元素，则从 A 获取元素，如果定义了则从 B 获取元素，或者最后从 Default（始终定义）获取元素。

这是代码（请原谅 StackOverflow 糟糕的 Erlang 语法突出显示）：

```
%%%----------------------------------------------------------------------------
%%% @spec merge(RecordA, RecordB) -> #my_record{}
%%%     RecordA = #my_record{}
%%%     RecordB = #my_record{}
%%%
%%% @doc Merges two #my_record{} instances. The first takes precedence.
%%% @end
%%%----------------------------------------------------------------------------
merge(RecordA, RecordB) when is_record(RecordA, my_record),
                             is_record(RecordB, my_record) ->
    list_to_tuple(
        lists:append([my_record],
                     merge(tl(tuple_to_list(RecordA)),
                           tl(tuple_to_list(RecordB)),
                           tl(tuple_to_list(#my_record{})),
                           []))).

%%%----------------------------------------------------------------------------
%%% @spec merge(A, B, Default, []) -> [term()]
%%%     A = [term()]
%%%     B = [term()]
%%%     Default = [term()]
%%%
%%% @doc Merges the lists `A' and `B' into to a new list taking
%%% default values from `Default'.
%%%
%%% Each element of `A' and `B' are compared against the elements in
%%% `Default'. If they match the default, the default is used. If one
%%% of them differs from the other and the default value, that element is
%%% chosen. If both differs, the element from `A' is chosen.
%%% @end
%%%----------------------------------------------------------------------------
merge([D|ATail], [D|BTail], [D|DTail], To) ->
    merge(ATail, BTail, DTail, [D|To]); % If default, take from D
merge([D|ATail], [B|BTail], [D|DTail], To) ->
    merge(ATail, BTail, DTail, [B|To]); % If only A default, take from B
merge([A|ATail], [_|BTail], [_|DTail], To) ->
    merge(ATail, BTail, DTail, [A|To]); % Otherwise take from A
merge([],        [],        [],        To) ->
    lists:reverse(To). 
```

随意以任何你想要的方式使用它。

# svn - 用 git-svn 处理 SVN 关键字扩展

> ID：62264
> 
> 赞同：43
> 
> 时间：2008-09-15T12:04:31.833
> 
> 标签：svn, git, version-control

我最近询问了[Git 中的关键字扩展，](https://stackoverflow.com/questions/39742/does-git-have-anything-like-svn-propset-svnkeywords-or-pre-post-commit-hooks)我愿意接受在 Git 中不真正支持这个想法的设计。

无论好坏，我目前正在从事的项目需要像这样的 SVN 关键字扩展：

```
svn propset svn:keywords "Id" expl3.dtx 
```

保持这个字符串是最新的：

```
$Id: expl3.dtx 803 2008-09-11 14:01:58Z will $ 
```

但是我很想用 Git 来做我的版本控制。不幸的是，根据文档， git-svn 不支持这一点：

> “我们忽略除 svn:executable 之外的所有 SVN 属性”

但是通过几个 pre/post 提交钩子来模拟这个关键字似乎并不太棘手。我是第一个想要这个的人吗？有没有人有一些代码来做到这一点？

* * *

## 回答 #1

> 赞同：42
> 
> 时间：2008-09-16T14:25:23.437

这里发生了什么：Git 经过优化，可以尽快在分支之间切换。特别是，`git checkout`旨在不触及两个分支中相同的任何文件。

不幸的是，RCS 关键字替换打破了这一点。例如，使用`$Date$`将需要`git checkout`在切换分支时触摸树中的每个文件。对于 Linux 内核大小的存储库来说，这将使一切戛然而止。

一般来说，最好的办法是标记至少一个版本：

```
$ git tag v0.5.whatever 
```

...然后从您的 Makefile 中调用以下命令：

```
$ git describe --tags
v0.5.15.1-6-g61cde1d 
```

在这里，git 告诉我，我正在处理 v0.5.15.1 之后的匿名版本 6 提交，SHA1 哈希以`g61cde1d`. 如果您将此命令的输出粘贴到某个`*.h`文件中，那么您就是在做生意，并且将已发布的软件链接回源代码不会有任何问题。这是做事的首选方式。

如果您无法避免使用 RCS 关键字，您可能需要从[Lars Hjemli 的解释](http://kerneltrap.org/mailarchive/git/2007/10/12/335953)开始。基本上，`$Id$`很简单，如果你使用`git archive`，你也可以使用`$Format$`.

但是，如果您绝对无法避免使用 RCS 关键字，那么以下内容应该可以帮助您入门：

```
git config filter.rcs-keyword.clean 'perl -pe "s/\\\$Date[^\\\$]*\\\$/\\\$Date\\\$/"'
git config filter.rcs-keyword.smudge 'perl -pe "s/\\\$Date[^\\\$]*\\\$/\\\$Date: `date`\\\$/"'

echo '$Date$' > test.html
echo 'test.html filter=rcs-keyword' >> .gitattributes
git add test.html .gitattributes
git commit -m "Experimental RCS keyword support for git"

rm test.html
git checkout test.html
cat test.html 
```

在我的系统上，我得到：

```
$Date: Tue Sep 16 10:15:02 EDT 2008$ 
```

`smudge`如果您无法在and命令中使用 shell 转义符`clean`，只需编写您自己的 Perl 脚本来分别扩展和删除 RCS 关键字，并将这些脚本用作您的过滤器。

请注意，您*真的*不想对超过绝对必要的文件执行此操作，否则 git 将失去大部分速度。

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2009-07-28T14:04:11.107

> 不幸的是，RCS 关键字替换打破了这一点。例如，使用 $Date$ 将需要 git checkout 在切换分支时触摸树中的每个文件。

那不是真的。$Date$ 等扩展为在签入时持有的值。无论如何，这更有用。所以它不会在其他修订版或分支上更改，除非该文件实际上被重新签入。从 RCS 手册：

```
 $Date$ The  date  and  time the revision was checked in.  With -zzone a
          numeric time zone offset is appended;  otherwise,  the  date  is
          UTC. 
```

这也意味着上面使用 rcs-keyword.smudge 过滤器的建议答案是不正确的。它插入结帐的时间/日期，或任何导致它运行的内容。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2011-04-12T09:36:14.330

这是一个示例项目，其中包含向 git 项目添加 RCS 关键字支持所需的配置和过滤器代码：

[https://github.com/turon/git-rcs-keywords](https://github.com/turon/git-rcs-keywords)

It's not as simple to setup as one would like, but it seems to work. It uses a smudge/clean filter pair written in perl (similar to what emk's answer described), and yes, it will touch all files with the extensions set in .gitattributes, generally slowing things down a bit.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-15T12:16:30.790

您可以在文件上设置 ident 属性，但这会产生类似的字符串

```
$Id: deadbeefdeadbeefdeadbeefdeadbeefdeadbeef$ 
```

`deadbeef...`与该文件对应的 blob 的 sha1 在哪里。如果您确实需要该关键字扩展，并且在 git 存储库中需要它（而不是导出的存档），我认为您将不得不`ident`使用带有自定义脚本的 gitattribute 来为您进行扩展。仅使用钩子的问题是工作树中的文件与索引不匹配，git 会认为它已被修改。

# .net - 从 Winform 应用程序使用 Web 服务时出错 - “无法执行程序...”

> ID：62268
> 
> 赞同：1
> 
> 时间：2008-09-15T12:07:18.173
> 
> 标签：.net, winforms, web-services

我有一个调用 Web 服务来检查更新的 winform 应用程序。这适用于开发，它也适用于我尝试过的其他任何地方，只是不适用于我机器上已安装的副本（这在开发中恰好是相同的）。

错误是：

无法执行程序。正在执行的命令是 "C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\csc.exe" /noconfig /fullpaths @"C:\Documents and Settings\Giovanni.DOUBLE-AFSSZ043\Local Settings\Temp\squ8oock .cmdline”。

防火墙已禁用，我查找了“C:\Documents and Settings\Giovanni.DOUBLE-AFSSZ043\Local Settings\Temp\squ8oock.cmdline”，但它不存在。请注意，每次我尝试使用 Web 服务时，“.cmdline”文件都是不同的，例如，我第二次运行它是“dae8rgen.cmdline”。不管它有什么名字，我永远找不到这个文件。

有什么建议么？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-08-14T05:36:50.217

我遇到了同样的问题，发现我的内存已经用完了。

检查 Redhats “ANTS Memory Profiler”后，我发现我在 GC 根目录的 COM+ 中有大量内存。一个快速的谷歌，我发现自己在这里：[msdn XmlSerializers](http://msdn.microsoft.com/en-us/library/system.xml.serialization.xmlserializer.aspx)

然后我阅读了以下内容：

> 如果您使用任何其他构造函数，则会生成同一程序集的多个版本并且永远不会卸载，这会导致内存泄漏和性能下降。最简单的解决方案是使用前面提到的两个构造函数之一。否则，您必须将程序集缓存在哈希表中...

在为序列化程序创建哈希表之后，我的内存泄漏（和性能不佳）问题以及像您这样的错误消息都消失了。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-15T12:36:07.810

“.cmdline”文件是由 .NET 框架生成的自动生成文件。该应用程序正在尝试实时编译用于解析来自 Web 服务的数据的 XML 序列化器。

您是否确认可以从命令行窗口执行“csc.exe”？即使只是输入“C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\csc.exe /?” 应该给你一个编译器选项列表（或者如果你没有执行它的权限，应该给你一个错误）。

您在哪个用户帐户下运行它，它是否有权执行 windows 目录中的 .exe 文件？同样，我知道你说这发生在你机器上安装的副本上，但它是否有可能在网络共享上执行并接收有限的代码访问安全权限，这会阻止它运行本地可执行文件？

作为参考，这里有一篇 KB 文章，显示了当用户帐户没有足够权限时在 ASP.NET 中可能发生的类似错误。 [http://support.microsoft.com/kb/315904](http://support.microsoft.com/kb/315904)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-10-19T09:21:58.757

我用 ISSReset 解决了同样的问题

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2017-11-29T07:41:29.707

如果强制执行 AppLocker，请在下方允许（添加为路径异常）

`c:\windows\MICROSOFT.NET\FRAMEWORK\V2.0.50727\CSC.EXE` `c:\windows\MICROSOFT.NET\FRAMEWORK\V2.0.50727\CVTRES.EXE`

# java - Java包循环检测：如何找到涉及的具体类？

> ID：62276
> 
> 赞同：40
> 
> 时间：2008-09-15T12:11:08.913
> 
> 标签：java, class, dependencies, packages

你会推荐什么工具来检测**Java 包循环依赖**，知道目标是*明确列出检测到的“跨包循环”中涉及的特定类*？

我知道[classycle](http://classycle.sourceforge.net/)和[JDepend](http://clarkware.com/software/JDepend.html)，但它们都没有列出循环包依赖项中涉及的类。[Metrics](http://metrics.sourceforge.net/)有一个有趣的循环图形表示，但它再次仅限于包，有时很难阅读。

我厌倦了得到一个：

> *“你在这 3 个包之间有一个包循环依赖关系*
> *，每个包都有 xxx 类，*
> *祝你好运找到正确的类并打破这个循环”*

您是否知道任何工具会采取额外步骤来实际向您解释为什么检测到循环（即“列出所涉及的类”）？

* * *

Riiight...是时候宣布结果了：

@l7010.de：感谢您的努力。我会投票给你（当我有足够的代表时），特别是对于'CAP'的答案......但是CAP已经死在水中并且不再与我的Eclipse 3.4兼容。其余的都是商业的，我只寻找免费软件。

@daniel6651：谢谢，但如前所述，仅限免费软件（很抱歉一开始没有提到它）。

@izb 作为 findbugs 的频繁用户（现在使用最新的 1.3.5），我只需单击一下就可以接受您的答案...如果您能向我解释有什么选项可以激活 findbug 以检测任何周期。该功能仅在[0.8.7 版本中](http://findbugs.sourceforge.net/Changes.html)提及（查找“*新样式检测器以查找类之间的循环依赖关系*”），我无法对其进行测试。更新：它现在可以工作了，我有一个旧的 findbugs 配置文件，其中没有激活该选项。不过我还是喜欢[CAD](https://stackoverflow.com/questions/62276/java-package-cycle-detection-how-to-find-the-specific-classes-involved#71610) ;)

答案是......[在下面看到我自己的（第二个）答案](https://stackoverflow.com/questions/62276/java-package-cycle-detection-how-to-find-the-specific-classes-involved#71610)

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-09-16T12:12:59.777

好吧...在测试[了上面介绍的 DepFinder](https://stackoverflow.com/questions/62276/java-package-cycle-detection-how-to-find-the-specific-classes-involved#66059)之后，事实证明它非常适合快速检测简单的依赖关系，但它不能很好地随着类的数量而扩展...

所以真正的实际答案是： **[CDA - 类依赖分析器](http://www.dependency-analyzer.org/)**

它快速、最新、易于使用，并提供类及其循环依赖关系的图形表示。梦想成真 ;）

您必须创建一个工作集，您只需在其中输入类的目录（.class）（不需要有完整的类路径）
“检测循环依赖项 - `ALT`- `C`”选项作为广告工作，不会占用 100% 的 CPU几个小时来分析我的 468 节课。
注意：要刷新工作区，您需要再次打开它（！），以触发对您的类的新扫描。

![截屏](https://i.stack.imgur.com/mS8rC.jpg)

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-09-15T12:27:35.410

Findbugs 可以检测循环类依赖关系并且也有一个 Eclipse 插件。

[http://findbugs.sourceforge.net/](http://findbugs.sourceforge.net/)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-15T12:26:58.113

还有[Structure101](http://www.headwaysoftware.com/)应该这样做。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2010-08-05T14:13:20.873

我们使用[Sonar](http://www.sonarsource.org/)来检测包周期。它绘制了一个很好的依赖关系图，并显示了哪些是错误的方向。您甚至可以导航到使用依赖项的源。

见[http://www.sonarsource.org/fight-back-design-erosion-by-break-cycles-with-sonar/](http://www.sonarsource.org/fight-back-design-erosion-by-breaking-cycles-with-sonar/)

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2013-08-13T18:58:47.777

[Highwheel](https://github.com/hcoles/highwheel)检测类和包循环，并将依赖关系的来源报告到类/方法/字段级别，指示关系的类型（继承、组合、方法签名的一部分等）。

它还将大循环分解为可以单独理解/处理的子元素。

输出是带有嵌入式 SVG 内容的 HTML，需要现代浏览器。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-15T12:27:17.877

您可以使用开源工具[CAP](http://cap.xore.de/)，它是一个 Eclipse 插件。

CAP 有一个图形包视图，它将向您显示类的线条，因此在单击几下（取决于圆圈的大小）后，您会找到罪魁祸首。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-15T19:38:48.683

第一个可能的答案是……不漂亮。但它确实开始做我所追求的（[下面给出](https://stackoverflow.com/questions/62276/java-package-cycle-detection-how-to-find-the-specific-classes-involved#71610)了一个更好的解决方案）。

[依赖查找器](http://depfind.sourceforge.net/)！[下载它](http://sourceforge.net/project/showfiles.php?group_id=43305&package_id=35581)，解压缩它。

它不是有史以来最现代或最活跃的项目，但如果您编辑 [Dependency Finder]/bin/DependencyFinder.bat，将其路径添加为 DEFAULT_DEPENDENCYFINDER_HOME，设置 JAVA_HOME，即可启动它。

然后单击“提取”按钮（CTRL-E - 第一个按钮），输入您的类路径，然后让它扫描。

棘手的部分是准确地单击正确的“编程元素”和“闭包”项目集，以免被结果中的详细程度所淹没。

*   仅选择左侧的“类”（“编程元素”）。
*   仅选择右侧的“类”（“闭包”）。
*   添加“/javax?./,/org./,/sun./”作为排除模式（对于编程元素和闭包）。
*   单击轮子（最后一个按钮 - 全部计算 - `Ctrl`+ `A`）。

给你。

每当你看到 '<->' 时，你就得到了一个很好的*循环依赖*。（如果您在“关闭”一侧选择“功能”，您甚至可以知道触发循环的功能 - 太棒了。）

我准备测试任何其他建议。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-15T12:26:19.923

执行此操作的一种工具是软件[断层扫描仪](http://www.software-tomography.com/)。它是商业的，用户界面很烂：o

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-15T12:29:30.307

有一些商业工具：Structure101 和 Lattix 可用于此目的。

# java - 使用 Java 读取/写入 Windows 注册表

> ID：62289
> 
> 赞同：338
> 
> 时间：2008-09-15T12:16:55.093
> 
> 标签：java, registry

如何使用 Java 读取/写入 Windows 注册表？

* * *

## 回答 #1

> 赞同：342
> 
> 时间：2011-05-28T18:42:28.037

我知道这个问题很老，但它是谷歌上“java读/写注册表”的第一个搜索结果。最近我发现了这段惊人的代码：

*   可以读/写注册表的任何部分。
*   不使用 JNI。
*   不使用任何第 3 方/外部应用程序工作。
*   不使用 WINDOWS API（直接）

这是纯粹的 Java 代码。

通过实际访问`java.util.prefs.Preferences`类中的私有方法，它使用反射来工作。这个类的内部结构很复杂，但是这个类本身很容易使用。

例如，以下代码**从注册表中**获取准确的 windows 分布：

```
String value = WinRegistry.readString (
    WinRegistry.HKEY_LOCAL_MACHINE,                             //HKEY
   "SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion",           //Key
   "ProductName");                                              //ValueName
    System.out.println("Windows Distribution = " + value); 
```

这是原始类。只需复制粘贴它，它应该可以工作：

```
import java.lang.reflect.InvocationTargetException;
import java.lang.reflect.Method;
import java.util.HashMap;
import java.util.Map;
import java.util.ArrayList;
import java.util.List;
import java.util.prefs.Preferences;

public class WinRegistry {
  public static final int HKEY_CURRENT_USER = 0x80000001;
  public static final int HKEY_LOCAL_MACHINE = 0x80000002;
  public static final int REG_SUCCESS = 0;
  public static final int REG_NOTFOUND = 2;
  public static final int REG_ACCESSDENIED = 5;

  private static final int KEY_ALL_ACCESS = 0xf003f;
  private static final int KEY_READ = 0x20019;
  private static final Preferences userRoot = Preferences.userRoot();
  private static final Preferences systemRoot = Preferences.systemRoot();
  private static final Class<? extends Preferences> userClass = userRoot.getClass();
  private static final Method regOpenKey;
  private static final Method regCloseKey;
  private static final Method regQueryValueEx;
  private static final Method regEnumValue;
  private static final Method regQueryInfoKey;
  private static final Method regEnumKeyEx;
  private static final Method regCreateKeyEx;
  private static final Method regSetValueEx;
  private static final Method regDeleteKey;
  private static final Method regDeleteValue;

  static {
    try {
      regOpenKey = userClass.getDeclaredMethod("WindowsRegOpenKey",
          new Class[] { int.class, byte[].class, int.class });
      regOpenKey.setAccessible(true);
      regCloseKey = userClass.getDeclaredMethod("WindowsRegCloseKey",
          new Class[] { int.class });
      regCloseKey.setAccessible(true);
      regQueryValueEx = userClass.getDeclaredMethod("WindowsRegQueryValueEx",
          new Class[] { int.class, byte[].class });
      regQueryValueEx.setAccessible(true);
      regEnumValue = userClass.getDeclaredMethod("WindowsRegEnumValue",
          new Class[] { int.class, int.class, int.class });
      regEnumValue.setAccessible(true);
      regQueryInfoKey = userClass.getDeclaredMethod("WindowsRegQueryInfoKey1",
          new Class[] { int.class });
      regQueryInfoKey.setAccessible(true);
      regEnumKeyEx = userClass.getDeclaredMethod(  
          "WindowsRegEnumKeyEx", new Class[] { int.class, int.class,  
              int.class });  
      regEnumKeyEx.setAccessible(true);
      regCreateKeyEx = userClass.getDeclaredMethod(  
          "WindowsRegCreateKeyEx", new Class[] { int.class,  
              byte[].class });  
      regCreateKeyEx.setAccessible(true);  
      regSetValueEx = userClass.getDeclaredMethod(  
          "WindowsRegSetValueEx", new Class[] { int.class,  
              byte[].class, byte[].class });  
      regSetValueEx.setAccessible(true); 
      regDeleteValue = userClass.getDeclaredMethod(  
          "WindowsRegDeleteValue", new Class[] { int.class,  
              byte[].class });  
      regDeleteValue.setAccessible(true); 
      regDeleteKey = userClass.getDeclaredMethod(  
          "WindowsRegDeleteKey", new Class[] { int.class,  
              byte[].class });  
      regDeleteKey.setAccessible(true); 
    }
    catch (Exception e) {
      throw new RuntimeException(e);
    }
  }

  private WinRegistry() {  }

  /**
   * Read a value from key and value name
   * @param hkey   HKEY_CURRENT_USER/HKEY_LOCAL_MACHINE
   * @param key
   * @param valueName
   * @return the value
   * @throws IllegalArgumentException
   * @throws IllegalAccessException
   * @throws InvocationTargetException
   */
  public static String readString(int hkey, String key, String valueName) 
    throws IllegalArgumentException, IllegalAccessException,
    InvocationTargetException 
  {
    if (hkey == HKEY_LOCAL_MACHINE) {
      return readString(systemRoot, hkey, key, valueName);
    }
    else if (hkey == HKEY_CURRENT_USER) {
      return readString(userRoot, hkey, key, valueName);
    }
    else {
      throw new IllegalArgumentException("hkey=" + hkey);
    }
  }

  /**
   * Read value(s) and value name(s) form given key 
   * @param hkey  HKEY_CURRENT_USER/HKEY_LOCAL_MACHINE
   * @param key
   * @return the value name(s) plus the value(s)
   * @throws IllegalArgumentException
   * @throws IllegalAccessException
   * @throws InvocationTargetException
   */
  public static Map<String, String> readStringValues(int hkey, String key) 
    throws IllegalArgumentException, IllegalAccessException,
    InvocationTargetException 
  {
    if (hkey == HKEY_LOCAL_MACHINE) {
      return readStringValues(systemRoot, hkey, key);
    }
    else if (hkey == HKEY_CURRENT_USER) {
      return readStringValues(userRoot, hkey, key);
    }
    else {
      throw new IllegalArgumentException("hkey=" + hkey);
    }
  }

  /**
   * Read the value name(s) from a given key
   * @param hkey  HKEY_CURRENT_USER/HKEY_LOCAL_MACHINE
   * @param key
   * @return the value name(s)
   * @throws IllegalArgumentException
   * @throws IllegalAccessException
   * @throws InvocationTargetException
   */
  public static List<String> readStringSubKeys(int hkey, String key) 
    throws IllegalArgumentException, IllegalAccessException,
    InvocationTargetException 
  {
    if (hkey == HKEY_LOCAL_MACHINE) {
      return readStringSubKeys(systemRoot, hkey, key);
    }
    else if (hkey == HKEY_CURRENT_USER) {
      return readStringSubKeys(userRoot, hkey, key);
    }
    else {
      throw new IllegalArgumentException("hkey=" + hkey);
    }
  }

  /**
   * Create a key
   * @param hkey  HKEY_CURRENT_USER/HKEY_LOCAL_MACHINE
   * @param key
   * @throws IllegalArgumentException
   * @throws IllegalAccessException
   * @throws InvocationTargetException
   */
  public static void createKey(int hkey, String key) 
    throws IllegalArgumentException, IllegalAccessException,
    InvocationTargetException 
  {
    int [] ret;
    if (hkey == HKEY_LOCAL_MACHINE) {
      ret = createKey(systemRoot, hkey, key);
      regCloseKey.invoke(systemRoot, new Object[] { new Integer(ret[0]) });
    }
    else if (hkey == HKEY_CURRENT_USER) {
      ret = createKey(userRoot, hkey, key);
      regCloseKey.invoke(userRoot, new Object[] { new Integer(ret[0]) });
    }
    else {
      throw new IllegalArgumentException("hkey=" + hkey);
    }
    if (ret[1] != REG_SUCCESS) {
      throw new IllegalArgumentException("rc=" + ret[1] + "  key=" + key);
    }
  }

  /**
   * Write a value in a given key/value name
   * @param hkey
   * @param key
   * @param valueName
   * @param value
   * @throws IllegalArgumentException
   * @throws IllegalAccessException
   * @throws InvocationTargetException
   */
  public static void writeStringValue
    (int hkey, String key, String valueName, String value) 
    throws IllegalArgumentException, IllegalAccessException,
    InvocationTargetException 
  {
    if (hkey == HKEY_LOCAL_MACHINE) {
      writeStringValue(systemRoot, hkey, key, valueName, value);
    }
    else if (hkey == HKEY_CURRENT_USER) {
      writeStringValue(userRoot, hkey, key, valueName, value);
    }
    else {
      throw new IllegalArgumentException("hkey=" + hkey);
    }
  }

  /**
   * Delete a given key
   * @param hkey
   * @param key
   * @throws IllegalArgumentException
   * @throws IllegalAccessException
   * @throws InvocationTargetException
   */
  public static void deleteKey(int hkey, String key) 
    throws IllegalArgumentException, IllegalAccessException,
    InvocationTargetException 
  {
    int rc = -1;
    if (hkey == HKEY_LOCAL_MACHINE) {
      rc = deleteKey(systemRoot, hkey, key);
    }
    else if (hkey == HKEY_CURRENT_USER) {
      rc = deleteKey(userRoot, hkey, key);
    }
    if (rc != REG_SUCCESS) {
      throw new IllegalArgumentException("rc=" + rc + "  key=" + key);
    }
  }

  /**
   * delete a value from a given key/value name
   * @param hkey
   * @param key
   * @param value
   * @throws IllegalArgumentException
   * @throws IllegalAccessException
   * @throws InvocationTargetException
   */
  public static void deleteValue(int hkey, String key, String value) 
    throws IllegalArgumentException, IllegalAccessException,
    InvocationTargetException 
  {
    int rc = -1;
    if (hkey == HKEY_LOCAL_MACHINE) {
      rc = deleteValue(systemRoot, hkey, key, value);
    }
    else if (hkey == HKEY_CURRENT_USER) {
      rc = deleteValue(userRoot, hkey, key, value);
    }
    if (rc != REG_SUCCESS) {
      throw new IllegalArgumentException("rc=" + rc + "  key=" + key + "  value=" + value);
    }
  }

  // =====================

  private static int deleteValue
    (Preferences root, int hkey, String key, String value)
    throws IllegalArgumentException, IllegalAccessException,
    InvocationTargetException 
  {
    int[] handles = (int[]) regOpenKey.invoke(root, new Object[] {
        new Integer(hkey), toCstr(key), new Integer(KEY_ALL_ACCESS) });
    if (handles[1] != REG_SUCCESS) {
      return handles[1];  // can be REG_NOTFOUND, REG_ACCESSDENIED
    }
    int rc =((Integer) regDeleteValue.invoke(root,  
        new Object[] { 
          new Integer(handles[0]), toCstr(value) 
          })).intValue();
    regCloseKey.invoke(root, new Object[] { new Integer(handles[0]) });
    return rc;
  }

  private static int deleteKey(Preferences root, int hkey, String key) 
    throws IllegalArgumentException, IllegalAccessException,
    InvocationTargetException 
  {
    int rc =((Integer) regDeleteKey.invoke(root,  
        new Object[] { new Integer(hkey), toCstr(key) })).intValue();
    return rc;  // can REG_NOTFOUND, REG_ACCESSDENIED, REG_SUCCESS
  }

  private static String readString(Preferences root, int hkey, String key, String value)
    throws IllegalArgumentException, IllegalAccessException,
    InvocationTargetException 
  {
    int[] handles = (int[]) regOpenKey.invoke(root, new Object[] {
        new Integer(hkey), toCstr(key), new Integer(KEY_READ) });
    if (handles[1] != REG_SUCCESS) {
      return null; 
    }
    byte[] valb = (byte[]) regQueryValueEx.invoke(root, new Object[] {
        new Integer(handles[0]), toCstr(value) });
    regCloseKey.invoke(root, new Object[] { new Integer(handles[0]) });
    return (valb != null ? new String(valb).trim() : null);
  }

  private static Map<String,String> readStringValues
    (Preferences root, int hkey, String key)
    throws IllegalArgumentException, IllegalAccessException,
    InvocationTargetException 
  {
    HashMap<String, String> results = new HashMap<String,String>();
    int[] handles = (int[]) regOpenKey.invoke(root, new Object[] {
        new Integer(hkey), toCstr(key), new Integer(KEY_READ) });
    if (handles[1] != REG_SUCCESS) {
      return null;
    }
    int[] info = (int[]) regQueryInfoKey.invoke(root,
        new Object[] { new Integer(handles[0]) });

    int count = info[0]; // count  
    int maxlen = info[3]; // value length max
    for(int index=0; index<count; index++)  {
      byte[] name = (byte[]) regEnumValue.invoke(root, new Object[] {
          new Integer
            (handles[0]), new Integer(index), new Integer(maxlen + 1)});
      String value = readString(hkey, key, new String(name));
      results.put(new String(name).trim(), value);
    }
    regCloseKey.invoke(root, new Object[] { new Integer(handles[0]) });
    return results;
  }

  private static List<String> readStringSubKeys
    (Preferences root, int hkey, String key)
    throws IllegalArgumentException, IllegalAccessException,
    InvocationTargetException 
  {
    List<String> results = new ArrayList<String>();
    int[] handles = (int[]) regOpenKey.invoke(root, new Object[] {
        new Integer(hkey), toCstr(key), new Integer(KEY_READ) 
        });
    if (handles[1] != REG_SUCCESS) {
      return null;
    }
    int[] info = (int[]) regQueryInfoKey.invoke(root,
        new Object[] { new Integer(handles[0]) });

    int count  = info[0]; // Fix: info[2] was being used here with wrong results. Suggested by davenpcj, confirmed by Petrucio
    int maxlen = info[3]; // value length max
    for(int index=0; index<count; index++)  {
      byte[] name = (byte[]) regEnumKeyEx.invoke(root, new Object[] {
          new Integer
            (handles[0]), new Integer(index), new Integer(maxlen + 1)
          });
      results.add(new String(name).trim());
    }
    regCloseKey.invoke(root, new Object[] { new Integer(handles[0]) });
    return results;
  }

  private static int [] createKey(Preferences root, int hkey, String key)
    throws IllegalArgumentException, IllegalAccessException,
    InvocationTargetException 
  {
    return  (int[]) regCreateKeyEx.invoke(root,
        new Object[] { new Integer(hkey), toCstr(key) });
  }

  private static void writeStringValue 
    (Preferences root, int hkey, String key, String valueName, String value) 
    throws IllegalArgumentException, IllegalAccessException,
    InvocationTargetException 
  {
    int[] handles = (int[]) regOpenKey.invoke(root, new Object[] {
        new Integer(hkey), toCstr(key), new Integer(KEY_ALL_ACCESS) });

    regSetValueEx.invoke(root,  
        new Object[] { 
          new Integer(handles[0]), toCstr(valueName), toCstr(value) 
          }); 
    regCloseKey.invoke(root, new Object[] { new Integer(handles[0]) });
  }

  // utility
  private static byte[] toCstr(String str) {
    byte[] result = new byte[str.length() + 1];

    for (int i = 0; i < str.length(); i++) {
      result[i] = (byte) str.charAt(i);
    }
    result[str.length()] = 0;
    return result;
  }
} 
```

原作者：阿帕奇。

库来源：[https ://github.com/apache/npanday/tree/trunk/components/dotnet-registry/src/main/java/npanday/registry](https://github.com/apache/npanday/tree/trunk/components/dotnet-registry/src/main/java/npanday/registry)

* * *

## 回答 #2

> 赞同：133
> 
> 时间：2009-12-30T19:40:51.023

您实际上并不需要 3rd 方包。Windows 有一个用于所有注册表操作的 reg 实用程序。要获取命令格式，请转到 DOS 属性并键入：

```
reg /? 
```

您可以通过 Runtime 类调用*reg ：*

```
Runtime.getRuntime().exec("reg <your parameters here>"); 
```

使用上面的命令可以直接编辑键和添加新键。要读取注册表，需要获取*reg*的输出，这有点棘手。这是代码：

```
import java.io.IOException;
import java.io.InputStream;
import java.io.StringWriter;

/**
 * @author Oleg Ryaboy, based on work by Miguel Enriquez 
 */
public class WindowsReqistry {

    /**
     * 
     * @param location path in the registry
     * @param key registry key
     * @return registry value or null if not found
     */
    public static final String readRegistry(String location, String key){
        try {
            // Run reg query, then read output with StreamReader (internal class)
            Process process = Runtime.getRuntime().exec("reg query " + 
                    '"'+ location + "\" /v " + key);

            StreamReader reader = new StreamReader(process.getInputStream());
            reader.start();
            process.waitFor();
            reader.join();
            String output = reader.getResult();

            // Output has the following format:
            // \n<Version information>\n\n<key>\t<registry type>\t<value>
            if( ! output.contains("\t")){
                    return null;
            }

            // Parse out the value
            String[] parsed = output.split("\t");
            return parsed[parsed.length-1];
        }
        catch (Exception e) {
            return null;
        }

    }

    static class StreamReader extends Thread {
        private InputStream is;
        private StringWriter sw= new StringWriter();

        public StreamReader(InputStream is) {
            this.is = is;
        }

        public void run() {
            try {
                int c;
                while ((c = is.read()) != -1)
                    sw.write(c);
            }
            catch (IOException e) { 
        }
        }

        public String getResult() {
            return sw.toString();
        }
    }
    public static void main(String[] args) {

        // Sample usage
        String value = WindowsReqistry.readRegistry("HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\" 
                 + "Explorer\\Shell Folders", "Personal");
        System.out.println(value);
    }
} 
```

* * *

* * *

## 回答 #3

> 赞同：78
> 
> 时间：2011-06-09T03:19:59.500

[Java Native Access (JNA)](https://github.com/java-native-access/jna "JNA 主页")是一个使用原生库的优秀项目，并且通过[Advapi32Util](https://java-native-access.github.io/jna/5.4.0/javadoc/com/sun/jna/platform/win32/Advapi32Util.html "JNA Advapi32Util javadoc")和[Advapi32](https://java-native-access.github.io/jna/5.4.0/javadoc/com/sun/jna/platform/win32/Advapi32.html "JNA Advapi32 javadoc")支持平台库 (platform.jar) 中的 Windows 注册表。

**更新：**这是一个片段，其中包含一些示例，说明使用 JNA 使用 JNA 3.4.1 处理 Windows 注册表是多么容易，

```
import com.sun.jna.platform.win32.Advapi32Util;
import com.sun.jna.platform.win32.WinReg;

public class WindowsRegistrySnippet {
    public static void main(String[] args) {
        // Read a string
        String productName = Advapi32Util.registryGetStringValue(
            WinReg.HKEY_LOCAL_MACHINE, "SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion", "ProductName");
        System.out.printf("Product Name: %s\n", productName);

        // Read an int (& 0xFFFFFFFFL for large unsigned int)
        int timeout = Advapi32Util.registryGetIntValue(
            WinReg.HKEY_LOCAL_MACHINE, "SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Windows", "ShutdownWarningDialogTimeout");
        System.out.printf("Shutdown Warning Dialog Timeout: %d (%d as unsigned long)\n", timeout, timeout & 0xFFFFFFFFL);

        // Create a key and write a string
        Advapi32Util.registryCreateKey(WinReg.HKEY_CURRENT_USER, "SOFTWARE\\StackOverflow");
        Advapi32Util.registrySetStringValue(WinReg.HKEY_CURRENT_USER, "SOFTWARE\\StackOverflow", "url", "http://stackoverflow.com/a/6287763/277307");

        // Delete a key
        Advapi32Util.registryDeleteKey(WinReg.HKEY_CURRENT_USER, "SOFTWARE\\StackOverflow");
    }
} 
```

* * *

## 回答 #4

> 赞同：27
> 
> 时间：2012-08-07T22:15:55.000

我增加了最初由 David 发布的 Pure java 代码，以允许从 64 位 JVM 访问注册表的 32 位部分，反之亦然。我认为其他任何答案都没有解决这个问题。

这里是：

```
/**
 * Pure Java Windows Registry access.
 * Modified by petrucio@stackoverflow(828681) to add support for
 * reading (and writing but not creating/deleting keys) the 32-bits
 * registry view from a 64-bits JVM (KEY_WOW64_32KEY)
 * and 64-bits view from a 32-bits JVM (KEY_WOW64_64KEY).
 *****************************************************************************/

import java.lang.reflect.InvocationTargetException;
import java.lang.reflect.Method;
import java.util.HashMap;
import java.util.Map;
import java.util.ArrayList;
import java.util.List;
import java.util.prefs.Preferences;

public class WinRegistry {
  public static final int HKEY_CURRENT_USER = 0x80000001;
  public static final int HKEY_LOCAL_MACHINE = 0x80000002;
  public static final int REG_SUCCESS = 0;
  public static final int REG_NOTFOUND = 2;
  public static final int REG_ACCESSDENIED = 5;

  public static final int KEY_WOW64_32KEY = 0x0200;
  public static final int KEY_WOW64_64KEY = 0x0100;

  private static final int KEY_ALL_ACCESS = 0xf003f;
  private static final int KEY_READ = 0x20019;
  private static Preferences userRoot = Preferences.userRoot();
  private static Preferences systemRoot = Preferences.systemRoot();
  private static Class<? extends Preferences> userClass = userRoot.getClass();
  private static Method regOpenKey = null;
  private static Method regCloseKey = null;
  private static Method regQueryValueEx = null;
  private static Method regEnumValue = null;
  private static Method regQueryInfoKey = null;
  private static Method regEnumKeyEx = null;
  private static Method regCreateKeyEx = null;
  private static Method regSetValueEx = null;
  private static Method regDeleteKey = null;
  private static Method regDeleteValue = null;

  static {
    try {
      regOpenKey     = userClass.getDeclaredMethod("WindowsRegOpenKey",     new Class[] { int.class, byte[].class, int.class });
      regOpenKey.setAccessible(true);
      regCloseKey    = userClass.getDeclaredMethod("WindowsRegCloseKey",    new Class[] { int.class });
      regCloseKey.setAccessible(true);
      regQueryValueEx= userClass.getDeclaredMethod("WindowsRegQueryValueEx",new Class[] { int.class, byte[].class });
      regQueryValueEx.setAccessible(true);
      regEnumValue   = userClass.getDeclaredMethod("WindowsRegEnumValue",   new Class[] { int.class, int.class, int.class });
      regEnumValue.setAccessible(true);
      regQueryInfoKey=userClass.getDeclaredMethod("WindowsRegQueryInfoKey1",new Class[] { int.class });
      regQueryInfoKey.setAccessible(true);
      regEnumKeyEx   = userClass.getDeclaredMethod("WindowsRegEnumKeyEx",   new Class[] { int.class, int.class, int.class });  
      regEnumKeyEx.setAccessible(true);
      regCreateKeyEx = userClass.getDeclaredMethod("WindowsRegCreateKeyEx", new Class[] { int.class, byte[].class });
      regCreateKeyEx.setAccessible(true);  
      regSetValueEx  = userClass.getDeclaredMethod("WindowsRegSetValueEx",  new Class[] { int.class, byte[].class, byte[].class });  
      regSetValueEx.setAccessible(true); 
      regDeleteValue = userClass.getDeclaredMethod("WindowsRegDeleteValue", new Class[] { int.class, byte[].class });  
      regDeleteValue.setAccessible(true); 
      regDeleteKey   = userClass.getDeclaredMethod("WindowsRegDeleteKey",   new Class[] { int.class, byte[].class });  
      regDeleteKey.setAccessible(true); 
    }
    catch (Exception e) {
      e.printStackTrace();
    }
  }

  private WinRegistry() {  }

  /**
   * Read a value from key and value name
   * @param hkey   HKEY_CURRENT_USER/HKEY_LOCAL_MACHINE
   * @param key
   * @param valueName
   * @param wow64  0 for standard registry access (32-bits for 32-bit app, 64-bits for 64-bits app)
   *               or KEY_WOW64_32KEY to force access to 32-bit registry view,
   *               or KEY_WOW64_64KEY to force access to 64-bit registry view
   * @return the value
   * @throws IllegalArgumentException
   * @throws IllegalAccessException
   * @throws InvocationTargetException
   */
  public static String readString(int hkey, String key, String valueName, int wow64) 
    throws IllegalArgumentException, IllegalAccessException,
    InvocationTargetException 
  {
    if (hkey == HKEY_LOCAL_MACHINE) {
      return readString(systemRoot, hkey, key, valueName, wow64);
    }
    else if (hkey == HKEY_CURRENT_USER) {
      return readString(userRoot, hkey, key, valueName, wow64);
    }
    else {
      throw new IllegalArgumentException("hkey=" + hkey);
    }
  }

  /**
   * Read value(s) and value name(s) form given key 
   * @param hkey  HKEY_CURRENT_USER/HKEY_LOCAL_MACHINE
   * @param key
   * @param wow64  0 for standard registry access (32-bits for 32-bit app, 64-bits for 64-bits app)
   *               or KEY_WOW64_32KEY to force access to 32-bit registry view,
   *               or KEY_WOW64_64KEY to force access to 64-bit registry view
   * @return the value name(s) plus the value(s)
   * @throws IllegalArgumentException
   * @throws IllegalAccessException
   * @throws InvocationTargetException
   */
  public static Map<String, String> readStringValues(int hkey, String key, int wow64) 
    throws IllegalArgumentException, IllegalAccessException, InvocationTargetException 
  {
    if (hkey == HKEY_LOCAL_MACHINE) {
      return readStringValues(systemRoot, hkey, key, wow64);
    }
    else if (hkey == HKEY_CURRENT_USER) {
      return readStringValues(userRoot, hkey, key, wow64);
    }
    else {
      throw new IllegalArgumentException("hkey=" + hkey);
    }
  }

  /**
   * Read the value name(s) from a given key
   * @param hkey  HKEY_CURRENT_USER/HKEY_LOCAL_MACHINE
   * @param key
   * @param wow64  0 for standard registry access (32-bits for 32-bit app, 64-bits for 64-bits app)
   *               or KEY_WOW64_32KEY to force access to 32-bit registry view,
   *               or KEY_WOW64_64KEY to force access to 64-bit registry view
   * @return the value name(s)
   * @throws IllegalArgumentException
   * @throws IllegalAccessException
   * @throws InvocationTargetException
   */
  public static List<String> readStringSubKeys(int hkey, String key, int wow64) 
    throws IllegalArgumentException, IllegalAccessException, InvocationTargetException 
  {
    if (hkey == HKEY_LOCAL_MACHINE) {
      return readStringSubKeys(systemRoot, hkey, key, wow64);
    }
    else if (hkey == HKEY_CURRENT_USER) {
      return readStringSubKeys(userRoot, hkey, key, wow64);
    }
    else {
      throw new IllegalArgumentException("hkey=" + hkey);
    }
  }

  /**
   * Create a key
   * @param hkey  HKEY_CURRENT_USER/HKEY_LOCAL_MACHINE
   * @param key
   * @throws IllegalArgumentException
   * @throws IllegalAccessException
   * @throws InvocationTargetException
   */
  public static void createKey(int hkey, String key) 
    throws IllegalArgumentException, IllegalAccessException, InvocationTargetException 
  {
    int [] ret;
    if (hkey == HKEY_LOCAL_MACHINE) {
      ret = createKey(systemRoot, hkey, key);
      regCloseKey.invoke(systemRoot, new Object[] { new Integer(ret[0]) });
    }
    else if (hkey == HKEY_CURRENT_USER) {
      ret = createKey(userRoot, hkey, key);
      regCloseKey.invoke(userRoot, new Object[] { new Integer(ret[0]) });
    }
    else {
      throw new IllegalArgumentException("hkey=" + hkey);
    }
    if (ret[1] != REG_SUCCESS) {
      throw new IllegalArgumentException("rc=" + ret[1] + "  key=" + key);
    }
  }

  /**
   * Write a value in a given key/value name
   * @param hkey
   * @param key
   * @param valueName
   * @param value
   * @param wow64  0 for standard registry access (32-bits for 32-bit app, 64-bits for 64-bits app)
   *               or KEY_WOW64_32KEY to force access to 32-bit registry view,
   *               or KEY_WOW64_64KEY to force access to 64-bit registry view
   * @throws IllegalArgumentException
   * @throws IllegalAccessException
   * @throws InvocationTargetException
   */
  public static void writeStringValue
    (int hkey, String key, String valueName, String value, int wow64) 
    throws IllegalArgumentException, IllegalAccessException, InvocationTargetException 
  {
    if (hkey == HKEY_LOCAL_MACHINE) {
      writeStringValue(systemRoot, hkey, key, valueName, value, wow64);
    }
    else if (hkey == HKEY_CURRENT_USER) {
      writeStringValue(userRoot, hkey, key, valueName, value, wow64);
    }
    else {
      throw new IllegalArgumentException("hkey=" + hkey);
    }
  }

  /**
   * Delete a given key
   * @param hkey
   * @param key
   * @throws IllegalArgumentException
   * @throws IllegalAccessException
   * @throws InvocationTargetException
   */
  public static void deleteKey(int hkey, String key) 
    throws IllegalArgumentException, IllegalAccessException, InvocationTargetException 
  {
    int rc = -1;
    if (hkey == HKEY_LOCAL_MACHINE) {
      rc = deleteKey(systemRoot, hkey, key);
    }
    else if (hkey == HKEY_CURRENT_USER) {
      rc = deleteKey(userRoot, hkey, key);
    }
    if (rc != REG_SUCCESS) {
      throw new IllegalArgumentException("rc=" + rc + "  key=" + key);
    }
  }

  /**
   * delete a value from a given key/value name
   * @param hkey
   * @param key
   * @param value
   * @param wow64  0 for standard registry access (32-bits for 32-bit app, 64-bits for 64-bits app)
   *               or KEY_WOW64_32KEY to force access to 32-bit registry view,
   *               or KEY_WOW64_64KEY to force access to 64-bit registry view
   * @throws IllegalArgumentException
   * @throws IllegalAccessException
   * @throws InvocationTargetException
   */
  public static void deleteValue(int hkey, String key, String value, int wow64) 
    throws IllegalArgumentException, IllegalAccessException, InvocationTargetException 
  {
    int rc = -1;
    if (hkey == HKEY_LOCAL_MACHINE) {
      rc = deleteValue(systemRoot, hkey, key, value, wow64);
    }
    else if (hkey == HKEY_CURRENT_USER) {
      rc = deleteValue(userRoot, hkey, key, value, wow64);
    }
    if (rc != REG_SUCCESS) {
      throw new IllegalArgumentException("rc=" + rc + "  key=" + key + "  value=" + value);
    }
  }

  //========================================================================
  private static int deleteValue(Preferences root, int hkey, String key, String value, int wow64)
    throws IllegalArgumentException, IllegalAccessException, InvocationTargetException 
  {
    int[] handles = (int[]) regOpenKey.invoke(root, new Object[] {
        new Integer(hkey), toCstr(key), new Integer(KEY_ALL_ACCESS | wow64)
    });
    if (handles[1] != REG_SUCCESS) {
      return handles[1];  // can be REG_NOTFOUND, REG_ACCESSDENIED
    }
    int rc =((Integer) regDeleteValue.invoke(root, new Object[] { 
          new Integer(handles[0]), toCstr(value) 
          })).intValue();
    regCloseKey.invoke(root, new Object[] { new Integer(handles[0]) });
    return rc;
  }

  //========================================================================
  private static int deleteKey(Preferences root, int hkey, String key) 
    throws IllegalArgumentException, IllegalAccessException, InvocationTargetException 
  {
    int rc =((Integer) regDeleteKey.invoke(root, new Object[] {
        new Integer(hkey), toCstr(key)
    })).intValue();
    return rc;  // can REG_NOTFOUND, REG_ACCESSDENIED, REG_SUCCESS
  }

  //========================================================================
  private static String readString(Preferences root, int hkey, String key, String value, int wow64)
    throws IllegalArgumentException, IllegalAccessException, InvocationTargetException 
  {
    int[] handles = (int[]) regOpenKey.invoke(root, new Object[] {
        new Integer(hkey), toCstr(key), new Integer(KEY_READ | wow64)
    });
    if (handles[1] != REG_SUCCESS) {
      return null; 
    }
    byte[] valb = (byte[]) regQueryValueEx.invoke(root, new Object[] {
        new Integer(handles[0]), toCstr(value)
    });
    regCloseKey.invoke(root, new Object[] { new Integer(handles[0]) });
    return (valb != null ? new String(valb).trim() : null);
  }

  //========================================================================
  private static Map<String,String> readStringValues(Preferences root, int hkey, String key, int wow64)
    throws IllegalArgumentException, IllegalAccessException, InvocationTargetException 
  {
    HashMap<String, String> results = new HashMap<String,String>();
    int[] handles = (int[]) regOpenKey.invoke(root, new Object[] {
        new Integer(hkey), toCstr(key), new Integer(KEY_READ | wow64)
    });
    if (handles[1] != REG_SUCCESS) {
      return null;
    }
    int[] info = (int[]) regQueryInfoKey.invoke(root, new Object[] {
        new Integer(handles[0])
    });

    int count  = info[2]; // count  
    int maxlen = info[3]; // value length max
    for(int index=0; index<count; index++)  {
      byte[] name = (byte[]) regEnumValue.invoke(root, new Object[] {
          new Integer(handles[0]), new Integer(index), new Integer(maxlen + 1)
      });
      String value = readString(hkey, key, new String(name), wow64);
      results.put(new String(name).trim(), value);
    }
    regCloseKey.invoke(root, new Object[] { new Integer(handles[0]) });
    return results;
  }

  //========================================================================
  private static List<String> readStringSubKeys(Preferences root, int hkey, String key, int wow64)
    throws IllegalArgumentException, IllegalAccessException, InvocationTargetException 
  {
    List<String> results = new ArrayList<String>();
    int[] handles = (int[]) regOpenKey.invoke(root, new Object[] {
        new Integer(hkey), toCstr(key), new Integer(KEY_READ | wow64) 
        });
    if (handles[1] != REG_SUCCESS) {
      return null;
    }
    int[] info = (int[]) regQueryInfoKey.invoke(root, new Object[] {
        new Integer(handles[0])
    });

    int count  = info[0]; // Fix: info[2] was being used here with wrong results. Suggested by davenpcj, confirmed by Petrucio
    int maxlen = info[3]; // value length max
    for(int index=0; index<count; index++)  {
      byte[] name = (byte[]) regEnumKeyEx.invoke(root, new Object[] {
          new Integer(handles[0]), new Integer(index), new Integer(maxlen + 1)
          });
      results.add(new String(name).trim());
    }
    regCloseKey.invoke(root, new Object[] { new Integer(handles[0]) });
    return results;
  }

  //========================================================================
  private static int [] createKey(Preferences root, int hkey, String key)
    throws IllegalArgumentException, IllegalAccessException, InvocationTargetException 
  {
    return (int[]) regCreateKeyEx.invoke(root, new Object[] {
      new Integer(hkey), toCstr(key)
    });
  }

  //========================================================================
  private static void writeStringValue(Preferences root, int hkey, String key, String valueName, String value, int wow64)
    throws IllegalArgumentException, IllegalAccessException, InvocationTargetException 
  {
    int[] handles = (int[]) regOpenKey.invoke(root, new Object[] {
        new Integer(hkey), toCstr(key), new Integer(KEY_ALL_ACCESS | wow64)
    });
    regSetValueEx.invoke(root, new Object[] { 
          new Integer(handles[0]), toCstr(valueName), toCstr(value) 
          }); 
    regCloseKey.invoke(root, new Object[] { new Integer(handles[0]) });
  }

  //========================================================================
  // utility
  private static byte[] toCstr(String str) {
    byte[] result = new byte[str.length() + 1];

    for (int i = 0; i < str.length(); i++) {
      result[i] = (byte) str.charAt(i);
    }
    result[str.length()] = 0;
    return result;
  }
} 
```

* * *

## 回答 #5

> 赞同：23
> 
> 时间：2008-09-15T14:10:46.083

我在使用[jRegistryKey](http://sourceforge.net/projects/jregistrykey/ "jRegistryKey")之前已经这样做了。它是一个 LGPL Java/JNI 库，可以满足您的需求。这是一个示例，说明我如何使用它通过 regedit 启用注册表编辑，以及通过注册表在 Windows 中为我自己启用“显示文件夹选项”选项。

```
import java.io.File;
import ca.beq.util.win32.registry.RegistryKey;
import ca.beq.util.win32.registry.RegistryValue;
import ca.beq.util.win32.registry.RootKey;
import ca.beq.util.win32.registry.ValueType;

public class FixStuff {

private static final String REGEDIT_KEY = "Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\System";
private static final String REGEDIT_VALUE = "DisableRegistryTools";
private static final String REGISTRY_LIBRARY_PATH = "\\lib\\jRegistryKey.dll";
private static final String FOLDER_OPTIONS_KEY = "Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer";
private static final String FOLDER_OPTIONS_VALUE = "NoFolderOptions";

public static void main(String[] args) {
    //Load JNI library
    RegistryKey.initialize( new File(".").getAbsolutePath()+REGISTRY_LIBRARY_PATH );

    enableRegistryEditing(true);        
    enableShowFolderOptions(true);
}

private static void enableShowFolderOptions(boolean enable) {
    RegistryKey key = new RegistryKey(RootKey.HKEY_CURRENT_USER,FOLDER_OPTIONS_KEY);
    RegistryKey key2 = new RegistryKey(RootKey.HKEY_LOCAL_MACHINE,FOLDER_OPTIONS_KEY);
    RegistryValue value = new RegistryValue();
    value.setName(FOLDER_OPTIONS_VALUE);
    value.setType(ValueType.REG_DWORD_LITTLE_ENDIAN);
    value.setData(enable?0:1);

    if(key.hasValue(FOLDER_OPTIONS_VALUE)) {
        key.setValue(value);
    }
    if(key2.hasValue(FOLDER_OPTIONS_VALUE)) {
        key2.setValue(value);
    }           
}

private static void enableRegistryEditing(boolean enable) {
    RegistryKey key = new RegistryKey(RootKey.HKEY_CURRENT_USER,REGEDIT_KEY);
    RegistryValue value = new RegistryValue();
    value.setName(REGEDIT_VALUE);
    value.setType(ValueType.REG_DWORD_LITTLE_ENDIAN);
    value.setData(enable?0:1);

    if(key.hasValue(REGEDIT_VALUE)) {
        key.setValue(value);
    }
}

} 
```

* * *

## 回答 #6

> 赞同：21
> 
> 时间：2008-09-15T12:18:30.393

是的，使用 java.util.Preferences API，因为它的 Windows 实现使用注册表作为后端。

最后，这取决于您想要做什么：为您的应用程序存储首选项是首选项所做的非常棒的事情。如果您想实际更改与您的应用程序无关的注册表项，则需要一些 JNI 应用程序，如 Mark 所述（此处无耻窃取）：

> 来自快速谷歌：检查 JNIWrapper 的 WinPack。它具有完整的 Windows 注册表访问支持，包括阅读和写作。
> 
> WinPack Demo 以注册表查看器为例。
> 
> 检查[http://www.teamdev.com/jniwrapper/winpack/#registry_access](http://www.teamdev.com/jniwrapper/winpack/#registry_access)
> 
> 和...
> 
> 还有尝试 JNIRegistry @ [http://www.trustice.com/java/jnireg/](http://www.trustice.com/java/jnireg/)
> 
> 还有调用外部应用程序的选项，该应用程序负责读取/写入注册表。

* * *

## 回答 #7

> 赞同：11
> 
> 时间：2008-09-15T12:20:09.203

从快速谷歌：

> 检查 JNIWrapper 的 WinPack。它具有完整的 Windows 注册表访问支持，包括阅读和写作。
> 
> WinPack Demo 以注册表查看器为例。
> 
> 检查 [http://www.teamdev.com/jniwrapper/winpack/#registry_access](http://www.teamdev.com/jniwrapper/winpack/#registry_access)

和...

> 还有尝试 JNIRegistry @ [http://www.trustice.com/java/jnireg/](http://www.trustice.com/java/jnireg/)

还有调用外部应用程序的选项，该应用程序负责读取/写入注册表。

* * *

## 回答 #8

> 赞同：10
> 
> 时间：2011-05-05T17:57:35.050

这是 Oleg 解决方案的修改版本。我注意到在我的系统（Windows server 2003）上，“reg query”的输出不是由制表符（'\t'）分隔，而是由 4 个空格分隔。

我还简化了解决方案，因为不需要线程。

```
public static final String readRegistry(String location, String key)
{
  try
  {
      // Run reg query, then read output with StreamReader (internal class)
      Process process = Runtime.getRuntime().exec("reg query " + 
              '"'+ location + "\" /v " + key);

      InputStream is = process.getInputStream();
      StringBuilder sw = new StringBuilder();

      try
      {
         int c;
         while ((c = is.read()) != -1)
             sw.append((char)c);
      }
      catch (IOException e)
      { 
      }

      String output = sw.toString();

      // Output has the following format:
      // \n<Version information>\n\n<key>    <registry type>    <value>\r\n\r\n
      int i = output.indexOf("REG_SZ");
      if (i == -1)
      {
          return null;
      }

      sw = new StringBuilder();
      i += 6; // skip REG_SZ

      // skip spaces or tabs
      for (;;)
      {
         if (i > output.length())
             break;
         char c = output.charAt(i);
         if (c != ' ' && c != '\t')
             break;
         ++i;
      }

      // take everything until end of line
      for (;;)
      {
         if (i > output.length())
             break;
         char c = output.charAt(i);
         if (c == '\r' || c == '\n')
             break;
         sw.append(c);
         ++i;
      }

      return sw.toString();
  }
  catch (Exception e)
  {
      return null;
  } 
```

}

* * *

## 回答 #9

> 赞同：8
> 
> 时间：2016-02-21T03:43:34.690

感谢原帖。我重新设计了这个实用程序类，并提出了它之前的缺陷，认为它可能会帮助其他人，所以在这里发布。我还添加了一些额外的实用方法。现在它可以读取 Windows 注册表中的任何文件（包括 REG_DWORD、REG_BINARY、REG_EXPAND_SZ 等）。所有方法都像魅力一样起作用。只需复制并粘贴它，它应该可以工作。这是重新设计和修改的类：

```
import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStreamReader;
import java.lang.reflect.InvocationTargetException;
import java.lang.reflect.Method;
import java.util.HashMap;
import java.util.Map;
import java.util.ArrayList;
import java.util.List;
import java.util.StringTokenizer;
import java.util.prefs.Preferences;

public class WinRegistry {

    private static final int REG_SUCCESS = 0;
    private static final int REG_NOTFOUND = 2;
    private static final int KEY_READ = 0x20019;
    private static final int REG_ACCESSDENIED = 5;
    private static final int KEY_ALL_ACCESS = 0xf003f;
    public static final int HKEY_CLASSES_ROOT = 0x80000000;
    public static final int HKEY_CURRENT_USER = 0x80000001;
    public static final int HKEY_LOCAL_MACHINE = 0x80000002;
    private static final String CLASSES_ROOT = "HKEY_CLASSES_ROOT";
    private static final String CURRENT_USER = "HKEY_CURRENT_USER";
    private static final String LOCAL_MACHINE = "HKEY_LOCAL_MACHINE";
    private static Preferences userRoot = Preferences.userRoot();
    private static Preferences systemRoot = Preferences.systemRoot();
    private static Class<? extends Preferences> userClass = userRoot.getClass();
    private static Method regOpenKey = null;
    private static Method regCloseKey = null;
    private static Method regQueryValueEx = null;
    private static Method regEnumValue = null;
    private static Method regQueryInfoKey = null;
    private static Method regEnumKeyEx = null;
    private static Method regCreateKeyEx = null;
    private static Method regSetValueEx = null;
    private static Method regDeleteKey = null;
    private static Method regDeleteValue = null;

    static {
        try {
            regOpenKey = userClass.getDeclaredMethod("WindowsRegOpenKey", new Class[] {int.class, byte[].class, int.class});
            regOpenKey.setAccessible(true);
            regCloseKey = userClass.getDeclaredMethod("WindowsRegCloseKey", new Class[] {int.class});
            regCloseKey.setAccessible(true);
            regQueryValueEx = userClass.getDeclaredMethod("WindowsRegQueryValueEx", new Class[] {int.class, byte[].class});
            regQueryValueEx.setAccessible(true);
            regEnumValue = userClass.getDeclaredMethod("WindowsRegEnumValue", new Class[] {int.class, int.class, int.class});
            regEnumValue.setAccessible(true);
            regQueryInfoKey = userClass.getDeclaredMethod("WindowsRegQueryInfoKey1", new Class[] {int.class});
            regQueryInfoKey.setAccessible(true);
            regEnumKeyEx = userClass.getDeclaredMethod("WindowsRegEnumKeyEx", new Class[] {int.class, int.class, int.class});  
            regEnumKeyEx.setAccessible(true);
            regCreateKeyEx = userClass.getDeclaredMethod("WindowsRegCreateKeyEx", new Class[] {int.class, byte[].class});  
            regCreateKeyEx.setAccessible(true);
            regSetValueEx = userClass.getDeclaredMethod("WindowsRegSetValueEx", new Class[] {int.class, byte[].class, byte[].class});  
            regSetValueEx.setAccessible(true);
            regDeleteValue = userClass.getDeclaredMethod("WindowsRegDeleteValue", new Class[] {int.class, byte[].class});  
            regDeleteValue.setAccessible(true);
            regDeleteKey = userClass.getDeclaredMethod("WindowsRegDeleteKey", new Class[] {int.class, byte[].class});  
            regDeleteKey.setAccessible(true);
        }
        catch (Exception e) {
            e.printStackTrace();
        }
    }

    /**
     * Reads value for the key from given path
     * @param hkey   HKEY_CURRENT_USER/HKEY_LOCAL_MACHINE
     * @param path
     * @param key
     * @return the value
     * @throws IllegalArgumentException
     * @throws IllegalAccessException
     * @throws InvocationTargetException
     * @throws IOException 
     */
    public static String valueForKey(int hkey, String path, String key) 
            throws IllegalArgumentException, IllegalAccessException, InvocationTargetException, IOException {
        if (hkey == HKEY_LOCAL_MACHINE)
            return valueForKey(systemRoot, hkey, path, key);
        else if (hkey == HKEY_CURRENT_USER)
            return valueForKey(userRoot, hkey, path, key);
        else
            return valueForKey(null, hkey, path, key);
    }

    /**
     * Reads all key(s) and value(s) from given path
     * @param hkey  HKEY_CURRENT_USER/HKEY_LOCAL_MACHINE
     * @param path
     * @return the map of key(s) and corresponding value(s)
     * @throws IllegalArgumentException
     * @throws IllegalAccessException
     * @throws InvocationTargetException
     * @throws IOException 
     */
    public static Map<String, String> valuesForPath(int hkey, String path) 
            throws IllegalArgumentException, IllegalAccessException, InvocationTargetException, IOException {
        if (hkey == HKEY_LOCAL_MACHINE)
            return valuesForPath(systemRoot, hkey, path);
        else if (hkey == HKEY_CURRENT_USER)
            return valuesForPath(userRoot, hkey, path);
        else
            return valuesForPath(null, hkey, path);
    }

    /**
     * Read all the subkey(s) from a given path
     * @param hkey  HKEY_CURRENT_USER/HKEY_LOCAL_MACHINE
     * @param path
     * @return the subkey(s) list
     * @throws IllegalArgumentException
     * @throws IllegalAccessException
     * @throws InvocationTargetException
     */
    public static List<String> subKeysForPath(int hkey, String path)
            throws IllegalArgumentException, IllegalAccessException, InvocationTargetException {
        if (hkey == HKEY_LOCAL_MACHINE)
            return subKeysForPath(systemRoot, hkey, path);
        else if (hkey == HKEY_CURRENT_USER)
            return subKeysForPath(userRoot, hkey, path);
        else
            return subKeysForPath(null, hkey, path);
    }

    /**
     * Create a key
     * @param hkey  HKEY_CURRENT_USER/HKEY_LOCAL_MACHINE
     * @param key
     * @throws IllegalArgumentException
     * @throws IllegalAccessException
     * @throws InvocationTargetException
     */
    public static void createKey(int hkey, String key) 
            throws IllegalArgumentException, IllegalAccessException, InvocationTargetException {
        int [] ret;
        if (hkey == HKEY_LOCAL_MACHINE) {
            ret = createKey(systemRoot, hkey, key);
            regCloseKey.invoke(systemRoot, new Object[] { new Integer(ret[0]) });
        } else if (hkey == HKEY_CURRENT_USER) {
            ret = createKey(userRoot, hkey, key);
            regCloseKey.invoke(userRoot, new Object[] { new Integer(ret[0]) });
        } else
            throw new IllegalArgumentException("hkey=" + hkey);
        if (ret[1] != REG_SUCCESS)
            throw new IllegalArgumentException("rc=" + ret[1] + "  key=" + key);
    }

    /**
     * Write a value in a given key/value name
     * @param hkey
     * @param key
     * @param valueName
     * @param value
     * @throws IllegalArgumentException
     * @throws IllegalAccessException
     * @throws InvocationTargetException
     */
    public static void writeStringValue(int hkey, String key, String valueName, String value) 
            throws IllegalArgumentException, IllegalAccessException, InvocationTargetException {
        if (hkey == HKEY_LOCAL_MACHINE)
            writeStringValue(systemRoot, hkey, key, valueName, value);
        else if (hkey == HKEY_CURRENT_USER)
            writeStringValue(userRoot, hkey, key, valueName, value);
        else
            throw new IllegalArgumentException("hkey=" + hkey);
    }

    /**
     * Delete a given key
     * @param hkey
     * @param key
     * @throws IllegalArgumentException
     * @throws IllegalAccessException
     * @throws InvocationTargetException
     */
    public static void deleteKey(int hkey, String key) 
            throws IllegalArgumentException, IllegalAccessException, InvocationTargetException {
        int rc = -1;
        if (hkey == HKEY_LOCAL_MACHINE)
            rc = deleteKey(systemRoot, hkey, key);
        else if (hkey == HKEY_CURRENT_USER)
            rc = deleteKey(userRoot, hkey, key);
        if (rc != REG_SUCCESS)
            throw new IllegalArgumentException("rc=" + rc + "  key=" + key);
    }

    /**
     * delete a value from a given key/value name
     * @param hkey
     * @param key
     * @param value
     * @throws IllegalArgumentException
     * @throws IllegalAccessException
     * @throws InvocationTargetException
     */
    public static void deleteValue(int hkey, String key, String value) 
            throws IllegalArgumentException, IllegalAccessException, InvocationTargetException {
        int rc = -1;
        if (hkey == HKEY_LOCAL_MACHINE)
            rc = deleteValue(systemRoot, hkey, key, value);
        else if (hkey == HKEY_CURRENT_USER)
            rc = deleteValue(userRoot, hkey, key, value);
        if (rc != REG_SUCCESS)
            throw new IllegalArgumentException("rc=" + rc + "  key=" + key + "  value=" + value);
    }

    // =====================

    private static int deleteValue(Preferences root, int hkey, String key, String value)
            throws IllegalArgumentException, IllegalAccessException, InvocationTargetException {
        int[] handles = (int[]) regOpenKey.invoke(root, new Object[] {new Integer(hkey), toCstr(key), new Integer(KEY_ALL_ACCESS)});
        if (handles[1] != REG_SUCCESS)
            return handles[1];                                  // can be REG_NOTFOUND, REG_ACCESSDENIED
        int rc =((Integer) regDeleteValue.invoke(root, new Object[] {new Integer(handles[0]), toCstr(value)})).intValue();
        regCloseKey.invoke(root, new Object[] { new Integer(handles[0])});
        return rc;
    }

    private static int deleteKey(Preferences root, int hkey, String key) 
            throws IllegalArgumentException, IllegalAccessException, InvocationTargetException {
        int rc =((Integer) regDeleteKey.invoke(root, new Object[] {new Integer(hkey), toCstr(key)})).intValue();
        return rc;                                                  // can REG_NOTFOUND, REG_ACCESSDENIED, REG_SUCCESS
    }

    private static String valueForKey(Preferences root, int hkey, String path, String key)
            throws IllegalArgumentException, IllegalAccessException, InvocationTargetException, IOException {
        int[] handles = (int[]) regOpenKey.invoke(root, new Object[] {new Integer(hkey), toCstr(path), new Integer(KEY_READ)});
        if (handles[1] != REG_SUCCESS)
            throw new IllegalArgumentException("The system can not find the specified path: '"+getParentKey(hkey)+"\\"+path+"'");
        byte[] valb = (byte[]) regQueryValueEx.invoke(root, new Object[] {new Integer(handles[0]), toCstr(key)});
        regCloseKey.invoke(root, new Object[] {new Integer(handles[0])});
        return (valb != null ? parseValue(valb) : queryValueForKey(hkey, path, key));
    }

    private static String queryValueForKey(int hkey, String path, String key) throws IOException {
        return queryValuesForPath(hkey, path).get(key);
    }

    private static Map<String,String> valuesForPath(Preferences root, int hkey, String path)
            throws IllegalArgumentException, IllegalAccessException, InvocationTargetException, IOException {
        HashMap<String, String> results = new HashMap<String,String>();
        int[] handles = (int[]) regOpenKey.invoke(root, new Object[] {new Integer(hkey), toCstr(path), new Integer(KEY_READ)});
        if (handles[1] != REG_SUCCESS)
            throw new IllegalArgumentException("The system can not find the specified path: '"+getParentKey(hkey)+"\\"+path+"'");
        int[] info = (int[]) regQueryInfoKey.invoke(root, new Object[] {new Integer(handles[0])});
        int count = info[2];                            // Fixed: info[0] was being used here
        int maxlen = info[4];                           // while info[3] was being used here, causing wrong results
        for(int index=0; index<count; index++) {
            byte[] valb = (byte[]) regEnumValue.invoke(root, new Object[] {new Integer(handles[0]), new Integer(index), new Integer(maxlen + 1)});
            String vald = parseValue(valb);
            if(valb == null || vald.isEmpty())
                return queryValuesForPath(hkey, path);
            results.put(vald, valueForKey(root, hkey, path, vald));
        }
        regCloseKey.invoke(root, new Object[] {new Integer(handles[0])});
        return results;
    }

    /**
     * Searches recursively into the path to find the value for key. This method gives 
     * only first occurrence value of the key. If required to get all values in the path 
     * recursively for this key, then {@link #valuesForKeyPath(int hkey, String path, String key)} 
     * should be used.
     * @param hkey
     * @param path
     * @param key
     * @param list
     * @return the value of given key obtained recursively
     * @throws IllegalArgumentException
     * @throws IllegalAccessException
     * @throws InvocationTargetException
     * @throws IOException
     */
    public static String valueForKeyPath(int hkey, String path, String key)
            throws IllegalArgumentException, IllegalAccessException, InvocationTargetException, IOException {
        String val;
        try {
            val = valuesForKeyPath(hkey, path, key).get(0);
        } catch(IndexOutOfBoundsException e) {
            throw new IllegalArgumentException("The system can not find the key: '"+key+"' after "
                    + "searching the specified path: '"+getParentKey(hkey)+"\\"+path+"'");
        }
        return val;
    }

    /**
     * Searches recursively into given path for particular key and stores obtained value in list
     * @param hkey
     * @param path
     * @param key
     * @param list
     * @return list containing values for given key obtained recursively
     * @throws IllegalArgumentException
     * @throws IllegalAccessException
     * @throws InvocationTargetException
     * @throws IOException
     */
    public static List<String> valuesForKeyPath(int hkey, String path, String key)
            throws IllegalArgumentException, IllegalAccessException, InvocationTargetException, IOException {
        List<String> list = new ArrayList<String>();
        if (hkey == HKEY_LOCAL_MACHINE)
            return valuesForKeyPath(systemRoot, hkey, path, key, list);
        else if (hkey == HKEY_CURRENT_USER)
            return valuesForKeyPath(userRoot, hkey, path, key, list);
        else
            return valuesForKeyPath(null, hkey, path, key, list);
    }

    private static List<String> valuesForKeyPath(Preferences root, int hkey, String path, String key, List<String> list)
            throws IllegalArgumentException, IllegalAccessException, InvocationTargetException, IOException {
        if(!isDirectory(root, hkey, path)) {
            takeValueInListForKey(hkey, path, key, list);
        } else {
            List<String> subKeys = subKeysForPath(root, hkey, path);
            for(String subkey: subKeys) {
                String newPath = path+"\\"+subkey;
                if(isDirectory(root, hkey, newPath))
                    valuesForKeyPath(root, hkey, newPath, key, list);
                takeValueInListForKey(hkey, newPath, key, list);
            }
        }
        return list;
    }

    /**
     * Takes value for key in list
     * @param hkey
     * @param path
     * @param key
     * @param list
     * @throws IllegalArgumentException
     * @throws IllegalAccessException
     * @throws InvocationTargetException
     * @throws IOException
     */
    private static void takeValueInListForKey(int hkey, String path, String key, List<String> list)
            throws IllegalArgumentException, IllegalAccessException, InvocationTargetException, IOException {
        String value = valueForKey(hkey, path, key);
        if(value != null)
            list.add(value);
    }

    /**
     * Checks if the path has more subkeys or not
     * @param root
     * @param hkey
     * @param path
     * @return true if path has subkeys otherwise false
     * @throws IllegalArgumentException
     * @throws IllegalAccessException
     * @throws InvocationTargetException
     */
    private static boolean isDirectory(Preferences root, int hkey, String path)
            throws IllegalArgumentException, IllegalAccessException, InvocationTargetException {
        return !subKeysForPath(root, hkey, path).isEmpty();
    }

    private static List<String> subKeysForPath(Preferences root, int hkey, String path)
            throws IllegalArgumentException, IllegalAccessException, InvocationTargetException {
        List<String> results = new ArrayList<String>();
        int[] handles = (int[]) regOpenKey.invoke(root, new Object[] {new Integer(hkey), toCstr(path), new Integer(KEY_READ)});
        if (handles[1] != REG_SUCCESS)
            throw new IllegalArgumentException("The system can not find the specified path: '"+getParentKey(hkey)+"\\"+path+"'");
        int[] info = (int[]) regQueryInfoKey.invoke(root, new Object[] {new Integer(handles[0])});
        int count  = info[0]; // Fix: info[2] was being used here with wrong results. Suggested by davenpcj, confirmed by Petrucio
        int maxlen = info[3]; // value length max
        for(int index=0; index<count; index++) {
            byte[] valb = (byte[]) regEnumKeyEx.invoke(root, new Object[] {new Integer(handles[0]), new Integer(index), new Integer(maxlen + 1)});
            results.add(parseValue(valb));
        }
        regCloseKey.invoke(root, new Object[] {new Integer(handles[0])});
        return results;
    }

    private static int [] createKey(Preferences root, int hkey, String key)
            throws IllegalArgumentException, IllegalAccessException, InvocationTargetException {
        return (int[]) regCreateKeyEx.invoke(root, new Object[] {new Integer(hkey), toCstr(key)});
    }

    private static void writeStringValue(Preferences root, int hkey, String key, String valueName, String value) 
            throws IllegalArgumentException, IllegalAccessException, InvocationTargetException {
        int[] handles = (int[]) regOpenKey.invoke(root, new Object[] {new Integer(hkey), toCstr(key), new Integer(KEY_ALL_ACCESS)});
        regSetValueEx.invoke(root, new Object[] {new Integer(handles[0]), toCstr(valueName), toCstr(value)}); 
        regCloseKey.invoke(root, new Object[] {new Integer(handles[0])});
    }

    /**
     * Makes cmd query for the given hkey and path then executes the query
     * @param hkey
     * @param path
     * @return the map containing all results in form of key(s) and value(s) obtained by executing query
     * @throws IOException
     */
    private static Map<String, String> queryValuesForPath(int hkey, String path) throws IOException {
        String line;
        StringBuilder builder = new StringBuilder();
        Map<String, String> map = new HashMap<String, String>();
        Process process = Runtime.getRuntime().exec("reg query \""+getParentKey(hkey)+"\\" + path + "\"");
        BufferedReader reader = new BufferedReader(new InputStreamReader(process.getInputStream()));
        while((line = reader.readLine()) != null) {
            if(!line.contains("REG_"))
                continue;
            StringTokenizer tokenizer = new StringTokenizer(line, " \t");
            while(tokenizer.hasMoreTokens()) {
                String token = tokenizer.nextToken();
                if(token.startsWith("REG_"))
                    builder.append("\t ");
                else
                    builder.append(token).append(" ");
            }
            String[] arr = builder.toString().split("\t");
            map.put(arr[0].trim(), arr[1].trim());
            builder.setLength(0);
        }
        return map;
    }

    /**
     * Determines the string equivalent of hkey
     * @param hkey
     * @return string equivalent of hkey
     */
    private static String getParentKey(int hkey) {
        if(hkey == HKEY_CLASSES_ROOT)
            return CLASSES_ROOT;
        else if(hkey == HKEY_CURRENT_USER)
            return CURRENT_USER;
        else if(hkey == HKEY_LOCAL_MACHINE)
            return LOCAL_MACHINE;
        return null;
    }

    /**
     *Intern method which adds the trailing \0 for the handle with java.dll
     * @param str String
     * @return byte[] 
     */
    private static byte[] toCstr(String str) {
        if(str == null)
            str = "";
        return (str += "\0").getBytes();
    }

    /**
     * Method removes the trailing \0 which is returned from the java.dll (just if the last sign is a \0)
     * @param buf the byte[] buffer which every read method returns
     * @return String a parsed string without the trailing \0
     */
    private static String parseValue(byte buf[]) {
        if(buf == null)
            return null;
        String ret = new String(buf);
        if(ret.charAt(ret.length()-1) == '\0')
            return ret.substring(0, ret.length()-1);
        return ret;
    }
} 
```

**使用方法示例如下：**

下面的方法从给定的路径中检索键的值：

```
String hex = WinRegistry.valueForKey(WinRegistry.HKEY_LOCAL_MACHINE, "SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\WindowsUpdate\\Auto Update", "AUOptions"); 
```

此方法检索指定路径的所有数据（以键和值的形式）：

```
Map<String, String> map = WinRegistry.valuesForPath(WinRegistry.HKEY_LOCAL_MACHINE, "SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\WSMAN"); 
```

此方法从给定路径中递归检索键的值：

```
String val = WinRegistry.valueForKeyPath(WinRegistry.HKEY_LOCAL_MACHINE, "System", "TypeID"); 
```

这个从给定路径中递归检索键的所有值：

```
List<String> list = WinRegistry.valuesForKeyPath(
                   WinRegistry.HKEY_LOCAL_MACHINE,                  //HKEY                               "SOFTWARE\\Wow6432Node\\Microsoft\\Windows\\CurrentVersion\\Uninstall",   //path                 "DisplayName"         //Key
            ); 
```

在上面的代码中，我检索了 Windows 系统中所有已安装的软件名称。
**注意：请参阅这些方法的文档**

这个检索给定路径的所有子键：

```
List<String> list3 = WinRegistry.subKeysForPath(WinRegistry.HKEY_CURRENT_USER, "Software"); 
```

**重要提示：我在这个过程中只修改了读取目的方法，而不是像createKey，deleteKey等写入目的方法。它们仍然和我收到的一样。**

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2015-05-03T21:02:01.757

写入寄存器的最佳方法可能是使用本`reg import`机 Windows 命令，并为其提供`.reg`通过从注册表导出某些内容而生成的文件的文件路径。

`reg query`使用命令完成读取。另请参阅文档： [https ://technet.microsoft.com/en-us/library/cc742028.aspx](https://technet.microsoft.com/en-us/library/cc742028.aspx)

因此，以下代码应该是不言自明的：

```
import java.io.BufferedReader;
import java.io.File;
import java.io.FileNotFoundException;
import java.io.IOException;
import java.io.InputStreamReader;

public class WindowsRegistry
{
    public static void importSilently(String regFilePath) throws IOException,
            InterruptedException
    {
        if (!new File(regFilePath).exists())
        {
            throw new FileNotFoundException();
        }

        Process importer = Runtime.getRuntime().exec("reg import " + regFilePath);

        importer.waitFor();
    }

    public static void overwriteValue(String keyPath, String keyName,
            String keyValue) throws IOException, InterruptedException
    {
        Process overwriter = Runtime.getRuntime().exec(
                "reg add " + keyPath + " /t REG_SZ /v \"" + keyName + "\" /d "
                        + keyValue + " /f");

        overwriter.waitFor();
    }

    public static String getValue(String keyPath, String keyName)
            throws IOException, InterruptedException
    {
        Process keyReader = Runtime.getRuntime().exec(
                "reg query \"" + keyPath + "\" /v \"" + keyName + "\"");

        BufferedReader outputReader;
        String readLine;
        StringBuffer outputBuffer = new StringBuffer();

        outputReader = new BufferedReader(new InputStreamReader(
                keyReader.getInputStream()));

        while ((readLine = outputReader.readLine()) != null)
        {
            outputBuffer.append(readLine);
        }

        String[] outputComponents = outputBuffer.toString().split("    ");

        keyReader.waitFor();

        return outputComponents[outputComponents.length - 1];
    }
} 
```

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2008-09-15T13:09:33.313

很少有 JNDI 服务提供者可以使用 Windows 注册表。

可以观察[http://java.sun.com/products/jndi/serviceproviders.html](https://web.archive.org/web/20120801053337/http://java.sun.com/products/jndi/serviceproviders.html)。

* * *

## 回答 #12

> 赞同：5
> 
> 时间：2011-04-30T13:04:14.670

如前所述，Preferences API 使用注册表来存储首选项，但不能用于访问整个注册表。

然而，一个名为 David Croft 的盗版者发现，可以使用 Sun 的 Preferences API 实现中的方法[从 Java 中读取 Windows 注册表，而无需 JNI](http://www.davidc.net/programming/java/reading-windows-registry-java-without-jni)。这有一些危险，但值得一看。

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2008-09-15T12:24:07.353

Preferences API 方法不会让您访问注册表的所有分支。事实上，它只允许您访问 Preferences API 存储其偏好的位置。它不是像 .NET 那样的通用注册表处理 API

正如 Mark 所示，我猜想 JNI 或外部工具可以读取/写入每个键。

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2009-05-18T15:34:36.210

你可以试试[WinRun4J](http://winrun4j.sourceforge.net/ "WinRun4J")。这是一个 windows java 启动器和服务主机，但它还提供了一个用于访问注册表的库。

（顺便说一句，我在这个项目上工作，所以如果您有任何问题，请告诉我）

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2013-06-26T01:48:32.210

我之前对@David 的回答的编辑被拒绝了。这里有一些关于它的有用信息。

这个“魔法”之所以奏效，是因为 Sun`Preferences`为 Windows 实现了该类作为 JDK 的一部分，但它是[包私有](http://docs.oracle.com/javase/tutorial/java/javaOO/accesscontrol.html)的。部分实现使用 JNI。

*   从 JDK 打包私有类：http `java.util.prefs.WindowsPreferences`: [//grepcode.com/file/repository.grepcode.com/java/root/jdk/openjdk/7-b147/java/util/prefs/WindowsPreferences.java](http://grepcode.com/file/repository.grepcode.com/java/root/jdk/openjdk/7-b147/java/util/prefs/WindowsPreferences.java)
*   JNI：[http ://hg.openjdk.java.net/jdk7/jdk7/jdk/file/9b8c96f96a0f/src/windows/native/java/util/WindowsPreferences.c](http://hg.openjdk.java.net/jdk7/jdk7/jdk/file/9b8c96f96a0f/src/windows/native/java/util/WindowsPreferences.c)

在运行时使用工厂方法选择实现：http: [//grepcode.com/file/repository.grepcode.com/java/root/jdk/openjdk/7-b147/java/util/prefs/Preferences.java#首选项.0工厂](http://grepcode.com/file/repository.grepcode.com/java/root/jdk/openjdk/7-b147/java/util/prefs/Preferences.java#Preferences.0factory)

真正的问题：为什么 OpenJDK 不向公众公开这个 API？

* * *

## 回答 #16

> 赞同：3
> 
> 时间：2014-09-29T10:24:22.847

该`java.util.prefs`包为应用程序提供了一种存储和检索用户和系统首选项以及数据配置的方法。这些偏好数据将永久存储在依赖于实现的支持存储中。例如在 Windows 操作系统中将存储在 Windows 注册表中。

要写入和读取这些数据，我们使用`java.util.prefs.Preferences`类。下面的代码显示了如何在注册表中读取和写入`HKCU`和。`HKLM`

```
import java.util.prefs.Preferences;

public class RegistryDemo {
    public static final String PREF_KEY = "org.username";
    public static void main(String[] args) {
        //
        // Write Preferences information to HKCU (HKEY_CURRENT_USER),
        // HKCU\Software\JavaSoft\Prefs\org.username
        //
        Preferences userPref = Preferences.userRoot();
        userPref.put(PREF_KEY, "xyz");

        //
        // Below we read back the value we've written in the code above.
        //
        System.out.println("Preferences = "
                + userPref.get(PREF_KEY, PREF_KEY + " was not found."));

        //
        // Write Preferences information to HKLM (HKEY_LOCAL_MACHINE),
        // HKLM\Software\JavaSoft\Prefs\org.username
        //
        Preferences systemPref = Preferences.systemRoot();
        systemPref.put(PREF_KEY, "xyz");

        //
        // Read back the value we've written in the code above.
        //
        System.out.println("Preferences = "
                + systemPref.get(PREF_KEY, PREF_KEY + " was not found."));
    }
} 
```

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2013-03-28T18:05:23.393

又一个图书馆……

[https://code.google.com/p/java-registry/](https://code.google.com/p/java-registry/)

这个在幕后启动 reg.exe，读取/写入临时文件。我最终没有使用它，但它看起来是一个非常全面的实现。如果我确实使用了它，我可能会深入研究并添加对子进程的更好管理。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2012-01-21T19:03:31.193

虽然这已经很老了，但我想在 Windows 平台上使用的更好的实用程序是`regini`：

单次调用处理：

```
Runtime.getRuntime().exec("regini <your script file abs path here>"); 
```

会做所有的魔法。我已经尝试过了，同时使用 servany.exe 将 jar 制作为 Windows 服务，这需要在注册表中进行更改以添加 javaw.exe 参数，并且效果很好。您可能想阅读以下内容：http: [//support.microsoft.com/kb/264584](http://support.microsoft.com/kb/264584)

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2009-05-18T09:26:28.370

> WinPack Demo 以注册表查看器为例。
> 
> 检查 [http://www.jniwrapper.com/winpack_features.jsp#registry](http://www.jniwrapper.com/winpack_features.jsp#registry)

顺便说一句，WinPack 已移至以下地址：

[http://www.teamdev.com/jniwrapper/winpack/](http://www.teamdev.com/jniwrapper/winpack/)

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2013-08-07T12:46:10.613

这太疯狂了......我从这里的一篇帖子中获取了代码，没有看到还有 18 条评论，其中一条评论说它没有读取 dword 值......

无论如何，我已经将该代码的地狱重构为使用更少的 if 和方法的东西......

枚举可以稍微改进一下，但是一旦我努力读取数值或字节数组并且失败了，我就放弃了......

所以这里是：

```
package com.nu.art.software.utils;

import java.lang.reflect.Method;
import java.util.HashMap;
import java.util.Map;
import java.util.ArrayList;
import java.util.List;
import java.util.prefs.Preferences;

/**
 *
 * @author TacB0sS
 */
public class WinRegistry_TacB0sS {

    public static final class RegistryException
            extends Exception {

        private static final long serialVersionUID = -8799947496460994651L;

        public RegistryException(String message, Throwable e) {
            super(message, e);
        }

        public RegistryException(String message) {
            super(message);
        }

    }

    public static final int KEY_WOW64_32KEY = 0x0200;

    public static final int KEY_WOW64_64KEY = 0x0100;

    public static final int REG_SUCCESS = 0;

    public static final int REG_NOTFOUND = 2;

    public static final int REG_ACCESSDENIED = 5;

    private static final int KEY_ALL_ACCESS = 0xf003f;

    private static final int KEY_READ = 0x20019;

    public enum WinRegistryKey {
        User(Preferences.userRoot(), 0x80000001), ;

        // System(Preferences.systemRoot(), 0x80000002);

        private final Preferences preferencesRoot;

        private final Integer key;

        private WinRegistryKey(Preferences preferencesRoot, int key) {
            this.preferencesRoot = preferencesRoot;
            this.key = key;
        }
    }

    private enum WinRegistryMethod {
        OpenKey("WindowsRegOpenKey", int.class, byte[].class, int.class) {

            @Override
            protected void verifyReturnValue(Object retValue)
                    throws RegistryException {
                int[] retVal = (int[]) retValue;
                if (retVal[1] != REG_SUCCESS)
                    throw new RegistryException("Action Failed, Return Code: " + retVal[1]);
            }
        },
        CreateKeyEx("WindowsRegCreateKeyEx", int.class, byte[].class) {

            @Override
            protected void verifyReturnValue(Object retValue)
                    throws RegistryException {
                int[] retVal = (int[]) retValue;
                if (retVal[1] != REG_SUCCESS)
                    throw new RegistryException("Action Failed, Return Code: " + retVal[1]);
            }
        },
        DeleteKey("WindowsRegDeleteKey", int.class, byte[].class) {

            @Override
            protected void verifyReturnValue(Object retValue)
                    throws RegistryException {
                int retVal = ((Integer) retValue).intValue();
                if (retVal != REG_SUCCESS)
                    throw new RegistryException("Action Failed, Return Code: " + retVal);
            }
        },
        DeleteValue("WindowsRegDeleteValue", int.class, byte[].class) {

            @Override
            protected void verifyReturnValue(Object retValue)
                    throws RegistryException {
                int retVal = ((Integer) retValue).intValue();
                if (retVal != REG_SUCCESS)
                    throw new RegistryException("Action Failed, Return Code: " + retVal);
            }
        },
        CloseKey("WindowsRegCloseKey", int.class),
        QueryValueEx("WindowsRegQueryValueEx", int.class, byte[].class),
        EnumKeyEx("WindowsRegEnumKeyEx", int.class, int.class, int.class),
        EnumValue("WindowsRegEnumValue", int.class, int.class, int.class),
        QueryInfoKey("WindowsRegQueryInfoKey", int.class),
        SetValueEx("WindowsRegSetValueEx", int.class, byte[].class, byte[].class);

        private Method method;

        private WinRegistryMethod(String methodName, Class<?>... classes) {
            // WinRegistryKey.User.preferencesRoot.getClass().getMDeclaredMethods()
            try {
                method = WinRegistryKey.User.preferencesRoot.getClass().getDeclaredMethod(methodName, classes);
            } catch (Exception e) {
                System.err.println("Error");
                System.err.println(e);
            }
            method.setAccessible(true);
        }

        public Object invoke(Preferences root, Object... objects)
                throws RegistryException {
            Object retValue;
            try {
                retValue = method.invoke(root, objects);
                verifyReturnValue(retValue);
            } catch (Throwable e) {
                String params = "";
                if (objects.length > 0) {
                    params = objects[0].toString();
                    for (int i = 1; i < objects.length; i++) {
                        params += ", " + objects[i];
                    }
                }
                throw new RegistryException("Error invoking method: " + method + ", with params: (" + params + ")", e);
            }
            return retValue;
        }

        protected void verifyReturnValue(Object retValue)
                throws RegistryException {}
    }

    private WinRegistry_TacB0sS() {}

    public static String readString(WinRegistryKey regKey, String key, String valueName)
            throws RegistryException {
        int retVal = ((int[]) WinRegistryMethod.OpenKey.invoke(regKey.preferencesRoot, regKey.key, toCstr(key),
                new Integer(KEY_READ)))[0];

        byte[] retValue = (byte[]) WinRegistryMethod.QueryValueEx.invoke(regKey.preferencesRoot, retVal,
                toCstr(valueName));
        WinRegistryMethod.CloseKey.invoke(regKey.preferencesRoot, retVal);

        /*
         * Should this return an Empty String.
         */
        return (retValue != null ? new String(retValue).trim() : null);
    }

    public static Map<String, String> readStringValues(WinRegistryKey regKey, String key)
            throws RegistryException {
        HashMap<String, String> results = new HashMap<String, String>();
        int retVal = ((int[]) WinRegistryMethod.OpenKey.invoke(regKey.preferencesRoot, regKey.key, toCstr(key),
                new Integer(KEY_READ)))[0];

        int[] info = (int[]) WinRegistryMethod.QueryInfoKey.invoke(regKey.preferencesRoot, retVal);

        int count = info[2]; // count
        int maxlen = info[3]; // value length max
        for (int index = 0; index < count; index++) {
            byte[] name = (byte[]) WinRegistryMethod.EnumValue.invoke(regKey.preferencesRoot, retVal,
                    new Integer(index), new Integer(maxlen + 1));
            String value = readString(regKey, key, new String(name));
            results.put(new String(name).trim(), value);
        }

        WinRegistryMethod.CloseKey.invoke(regKey.preferencesRoot, retVal);
        return results;
    }

    public static List<String> readStringSubKeys(WinRegistryKey regKey, String key)
            throws RegistryException {
        List<String> results = new ArrayList<String>();
        int retVal = ((int[]) WinRegistryMethod.OpenKey.invoke(regKey.preferencesRoot, regKey.key, toCstr(key),
                new Integer(KEY_READ)))[0];

        int[] info = (int[]) WinRegistryMethod.QueryInfoKey.invoke(regKey.preferencesRoot, retVal);

        int count = info[0]; // Fix: info[2] was being used here with wrong results. Suggested by davenpcj, confirmed by
                                // Petrucio
        int maxlen = info[3]; // value length max
        for (int index = 0; index < count; index++) {
            byte[] name = (byte[]) WinRegistryMethod.EnumValue.invoke(regKey.preferencesRoot, retVal,
                    new Integer(index), new Integer(maxlen + 1));
            results.add(new String(name).trim());
        }

        WinRegistryMethod.CloseKey.invoke(regKey.preferencesRoot, retVal);
        return results;
    }

    public static void createKey(WinRegistryKey regKey, String key)
            throws RegistryException {
        int[] retVal = (int[]) WinRegistryMethod.CreateKeyEx.invoke(regKey.preferencesRoot, regKey.key, toCstr(key));
        WinRegistryMethod.CloseKey.invoke(regKey.preferencesRoot, retVal[0]);
    }

    public static void writeStringValue(WinRegistryKey regKey, String key, String valueName, String value)
            throws RegistryException {
        int retVal = ((int[]) WinRegistryMethod.OpenKey.invoke(regKey.preferencesRoot, regKey.key, toCstr(key),
                new Integer(KEY_ALL_ACCESS)))[0];

        WinRegistryMethod.SetValueEx.invoke(regKey.preferencesRoot, retVal, toCstr(valueName), toCstr(value));
        WinRegistryMethod.CloseKey.invoke(regKey.preferencesRoot, retVal);
    }

    public static void deleteKey(WinRegistryKey regKey, String key)
            throws RegistryException {
        WinRegistryMethod.DeleteKey.invoke(regKey.preferencesRoot, regKey.key, toCstr(key));
    }

    public static void deleteValue(WinRegistryKey regKey, String key, String value)
            throws RegistryException {
        int retVal = ((int[]) WinRegistryMethod.OpenKey.invoke(regKey.preferencesRoot, regKey.key, toCstr(key),
                new Integer(KEY_ALL_ACCESS)))[0];
        WinRegistryMethod.DeleteValue.invoke(regKey.preferencesRoot, retVal, toCstr(value));
        WinRegistryMethod.CloseKey.invoke(regKey.preferencesRoot, retVal);
    }

    // utility
    private static byte[] toCstr(String str) {
        byte[] result = new byte[str.length() + 1];

        for (int i = 0; i < str.length(); i++) {
            result[i] = (byte) str.charAt(i);
        }
        result[str.length()] = '\0';
        return result;
    }
} 
```

**注意：除了字符串之外，这不会读取任何其他内容！！！！！！！**

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2014-07-22T01:34:47.090

[这使用了与David 的回答](https://stackoverflow.com/a/6163701)中相同的 Java 内部 API ，但我已经完全重写了它。它现在更短，更好用。我还添加了对 HKEY_CLASSES_ROOT 和其他配置单元的支持。不过，它仍然有一些其他限制（例如不支持 DWORD 和不支持 Unicode），这是由于底层 API 造成的，遗憾的是，这种方法是不可避免的。不过，如果您只需要基本的字符串读/写并且不想加载本机 DLL，那么它很方便。

我相信你可以弄清楚如何使用它。

公共区域。玩得开心。

```
import java.util.*;
import java.lang.reflect.Method;

/**
 * Simple registry access class implemented using some private APIs
 * in java.util.prefs. It has no other prerequisites.
 */
public final class WindowsRegistry {
    /**
     * Tells if the Windows registry functions are available.
     * (They will not be available when not running on Windows, for example.)
     */
    public static boolean isAvailable() {
        return initError == null;
    }

    /** Reads a string value from the given key and value name. */
    public static String readValue(String keyName, String valueName) {
        try (Key key = Key.open(keyName, KEY_READ)) {
            return fromByteArray(invoke(regQueryValueEx, key.handle, toByteArray(valueName)));
        }
    }

    /** Returns a map of all the name-value pairs in the given key. */
    public static Map<String,String> readValues(String keyName) {
        try (Key key = Key.open(keyName, KEY_READ)) {
            int[] info = invoke(regQueryInfoKey, key.handle);
            checkError(info[INFO_ERROR_CODE]);
            int count = info[INFO_COUNT_VALUES];
            int maxlen = info[INFO_MAX_VALUE_LENGTH] + 1;
            Map<String,String> values = new HashMap<>();
            for (int i = 0; i < count; i++) {
                String valueName = fromByteArray(invoke(regEnumValue, key.handle, i, maxlen));
                values.put(valueName, readValue(keyName, valueName));
            }
            return values;
        }
    }

    /** Returns a list of the names of all the subkeys of a key. */
    public static List<String> readSubkeys(String keyName) {
        try (Key key = Key.open(keyName, KEY_READ)) {
            int[] info = invoke(regQueryInfoKey, key.handle);
            checkError(info[INFO_ERROR_CODE]);
            int count = info[INFO_COUNT_KEYS];
            int maxlen = info[INFO_MAX_KEY_LENGTH] + 1;
            List<String> subkeys = new ArrayList<>(count);
            for (int i = 0; i < count; i++) {
                subkeys.add(fromByteArray(invoke(regEnumKeyEx, key.handle, i, maxlen)));
            }
            return subkeys;
        }
    }

    /** Writes a string value with a given key and value name. */
    public static void writeValue(String keyName, String valueName, String value) {
        try (Key key = Key.open(keyName, KEY_WRITE)) {
            checkError(invoke(regSetValueEx, key.handle, toByteArray(valueName), toByteArray(value)));
        }
    }

    /** Deletes a value within a key. */
    public static void deleteValue(String keyName, String valueName) {
        try (Key key = Key.open(keyName, KEY_WRITE)) {
            checkError(invoke(regDeleteValue, key.handle, toByteArray(valueName)));
        }
    }

    /**
     * Deletes a key and all values within it. If the key has subkeys, an
     * "Access denied" error will be thrown. Subkeys must be deleted separately.
     */
    public static void deleteKey(String keyName) {
        checkError(invoke(regDeleteKey, keyParts(keyName)));
    }

    /**
     * Creates a key. Parent keys in the path will also be created if necessary.
     * This method returns without error if the key already exists.
     */
    public static void createKey(String keyName) {
        int[] info = invoke(regCreateKeyEx, keyParts(keyName));
        checkError(info[INFO_ERROR_CODE]);
        invoke(regCloseKey, info[INFO_HANDLE]);
    }

    /**
     * The exception type that will be thrown if a registry operation fails.
     */
    public static class RegError extends RuntimeException {
        public RegError(String message, Throwable cause) {
            super(message, cause);
        }
    }

    // *************
    // PRIVATE STUFF
    // *************

    private WindowsRegistry() {}

    // Map of registry hive names to constants from winreg.h
    private static final Map<String,Integer> hives = new HashMap<>();
    static {
        hives.put("HKEY_CLASSES_ROOT",   0x80000000); hives.put("HKCR", 0x80000000);
        hives.put("HKEY_CURRENT_USER",   0x80000001); hives.put("HKCU", 0x80000001);
        hives.put("HKEY_LOCAL_MACHINE",  0x80000002); hives.put("HKLM", 0x80000002);
        hives.put("HKEY_USERS",          0x80000003); hives.put("HKU",  0x80000003);
        hives.put("HKEY_CURRENT_CONFIG", 0x80000005); hives.put("HKCC", 0x80000005);
    }

    // Splits a path such as HKEY_LOCAL_MACHINE\Software\Microsoft into a pair of
    // values used by the underlying API: An integer hive constant and a byte array
    // of the key path within that hive.
    private static Object[] keyParts(String fullKeyName) {
        int x = fullKeyName.indexOf('\\');
        String hiveName = x >= 0 ? fullKeyName.substring(0, x)  : fullKeyName;
        String keyName  = x >= 0 ? fullKeyName.substring(x + 1) : "";
        Integer hkey = hives.get(hiveName);
        if (hkey == null) throw new RegError("Unknown registry hive: " + hiveName, null);
        return new Object[] { hkey, toByteArray(keyName) };
    }

    // Type encapsulating a native handle to a registry key
    private static class Key implements AutoCloseable {
        final int handle;

        private Key(int handle) {
            this.handle = handle;
        }

        static Key open(String keyName, int accessMode) {
            Object[] keyParts = keyParts(keyName);
            int[] ret = invoke(regOpenKey, keyParts[0], keyParts[1], accessMode);
            checkError(ret[INFO_ERROR_CODE]);
            return new Key(ret[INFO_HANDLE]);
        }

        @Override
        public void close() {
            invoke(regCloseKey, handle);
        }
    }

    // Array index constants for results of regOpenKey, regCreateKeyEx, and regQueryInfoKey
    private static final int
        INFO_HANDLE = 0,
        INFO_COUNT_KEYS = 0,
        INFO_ERROR_CODE = 1,
        INFO_COUNT_VALUES = 2,
        INFO_MAX_KEY_LENGTH = 3,
        INFO_MAX_VALUE_LENGTH = 4;

    // Registry access mode constants from winnt.h
    private static final int
        KEY_READ = 0x20019,
        KEY_WRITE = 0x20006;

    // Error constants from winerror.h
    private static final int
        ERROR_SUCCESS = 0,
        ERROR_FILE_NOT_FOUND = 2,
        ERROR_ACCESS_DENIED = 5;

    private static void checkError(int e) {
        if (e == ERROR_SUCCESS) return;
        throw new RegError(
            e == ERROR_FILE_NOT_FOUND ? "Key not found" :
            e == ERROR_ACCESS_DENIED ? "Access denied" :
            ("Error number " + e), null);
    }

    // Registry access methods in java.util.prefs.WindowsPreferences
    private static final Method
        regOpenKey = getMethod("WindowsRegOpenKey", int.class, byte[].class, int.class),
        regCloseKey = getMethod("WindowsRegCloseKey", int.class),
        regQueryValueEx = getMethod("WindowsRegQueryValueEx", int.class, byte[].class),
        regQueryInfoKey = getMethod("WindowsRegQueryInfoKey", int.class),
        regEnumValue = getMethod("WindowsRegEnumValue", int.class, int.class, int.class),
        regEnumKeyEx = getMethod("WindowsRegEnumKeyEx", int.class, int.class, int.class),
        regSetValueEx = getMethod("WindowsRegSetValueEx", int.class, byte[].class, byte[].class),
        regDeleteValue = getMethod("WindowsRegDeleteValue", int.class, byte[].class),
        regDeleteKey = getMethod("WindowsRegDeleteKey", int.class, byte[].class),
        regCreateKeyEx = getMethod("WindowsRegCreateKeyEx", int.class, byte[].class);

    private static Throwable initError;

    private static Method getMethod(String methodName, Class<?>... parameterTypes) {
        try {
            Method m = java.util.prefs.Preferences.systemRoot().getClass()
                .getDeclaredMethod(methodName, parameterTypes);
            m.setAccessible(true);
            return m;
        } catch (Throwable t) {
            initError = t;
            return null;
        }
    }

    @SuppressWarnings("unchecked")
    private static <T> T invoke(Method method, Object... args) {
        if (initError != null)
            throw new RegError("Registry methods are not available", initError);
        try {
            return (T)method.invoke(null, args);
        } catch (Exception e) {
            throw new RegError(null, e);
        }
    }

    // Conversion of strings to/from null-terminated byte arrays.
    // There is no support for Unicode; sorry, this is a limitation
    // of the underlying methods that Java makes available.
    private static byte[] toByteArray(String str) {
        byte[] bytes = new byte[str.length() + 1];
        for (int i = 0; i < str.length(); i++)
            bytes[i] = (byte)str.charAt(i);
        return bytes;
    }

    private static String fromByteArray(byte[] bytes) {
        if (bytes == null) return null;
        char[] chars = new char[bytes.length - 1];
        for (int i = 0; i < chars.length; i++)
            chars[i] = (char)((int)bytes[i] & 0xFF);
        return new String(chars);
    }
} 
```

有朝一日，Java 将有一个内置的[外部函数接口](http://openjdk.java.net/jeps/191)，以便于访问本地 API，而这种 hack 将是不必要的。

* * *

## 回答 #22

> 赞同：-2
> 
> 时间：2014-09-29T18:24:42.790

**您可以使用java**代码执行这些“REG QUERY”命令。

尝试从命令提示符执行此操作并从 java 代码执行命令。

> HKEY_LOCAL_MACHINE "SOFTWARE\Microsoft\Windows NT\CurrentVersion"

要搜索产品名称版本等详细信息，请使用 /v amd "name"。

> HKEY_LOCAL_MACHINE "SOFTWARE\Microsoft\Windows NT\CurrentVersion" /v "ProductName"

* * *

## 回答 #23

> 赞同：-2
> 
> 时间：2014-03-23T10:36:25.207

为了回应大卫的[回答](https://stackoverflow.com/a/6163701/2111085)- 我会做一些改进：

```
import java.lang.reflect.InvocationTargetException;
import java.lang.reflect.Method;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.logging.Level;
import java.util.logging.Logger;
import java.util.prefs.Preferences;

public class WinRegistry {

    public static final int HKEY_CURRENT_USER = 0x80000001,
            HKEY_LOCAL_MACHINE = 0x80000002,
            REG_SUCCESS = 0,
            REG_NOTFOUND = 2,
            REG_ACCESSDENIED = 5,
            KEY_ALL_ACCESS = 0xf003f,
            KEY_READ = 0x20019;
    private static final Preferences userRoot = Preferences.userRoot(),
            systemRoot = Preferences.systemRoot();
    private static final Class<? extends Preferences> userClass = userRoot.getClass();
    private static Method regOpenKey,
            regCloseKey,
            regQueryValueEx,
            regEnumValue,
            regQueryInfoKey,
            regEnumKeyEx,
            regCreateKeyEx,
            regSetValueEx,
            regDeleteKey,
            regDeleteValue;

    static {
        try {
            (regOpenKey = userClass.getDeclaredMethod("WindowsRegOpenKey", new Class[]{int.class, byte[].class, int.class})).setAccessible(true);
            (regCloseKey = userClass.getDeclaredMethod("WindowsRegCloseKey", new Class[]{int.class})).setAccessible(true);
            (regQueryValueEx = userClass.getDeclaredMethod("WindowsRegQueryValueEx", new Class[]{int.class, byte[].class})).setAccessible(true);
            (regEnumValue = userClass.getDeclaredMethod("WindowsRegEnumValue", new Class[]{int.class, int.class, int.class})).setAccessible(true);
            (regQueryInfoKey = userClass.getDeclaredMethod("WindowsRegQueryInfoKey1", new Class[]{int.class})).setAccessible(true);
            (regEnumKeyEx = userClass.getDeclaredMethod("WindowsRegEnumKeyEx", new Class[]{int.class, int.class, int.class})).setAccessible(true);
            (regCreateKeyEx = userClass.getDeclaredMethod("WindowsRegCreateKeyEx", new Class[]{int.class, byte[].class})).setAccessible(true);
            (regSetValueEx = userClass.getDeclaredMethod("WindowsRegSetValueEx", new Class[]{int.class, byte[].class, byte[].class})).setAccessible(true);
            (regDeleteValue = userClass.getDeclaredMethod("WindowsRegDeleteValue", new Class[]{int.class, byte[].class})).setAccessible(true);
            (regDeleteKey = userClass.getDeclaredMethod("WindowsRegDeleteKey", new Class[]{int.class, byte[].class})).setAccessible(true);
        } catch (NoSuchMethodException | SecurityException ex) {
            Logger.getLogger(WinRegistry.class.getName()).log(Level.SEVERE, null, ex);
        }
    }

    /**
     * Read a value from key and value name
     *
     * @param hkey HKEY_CURRENT_USER/HKEY_LOCAL_MACHINE
     * @param key
     * @param valueName
     * @return the value
     * @throws IllegalArgumentException
     * @throws IllegalAccessException
     * @throws InvocationTargetException
     */
    public static String readString(int hkey, String key, String valueName) throws IllegalArgumentException, IllegalAccessException, InvocationTargetException {

        switch (hkey) {
            case HKEY_LOCAL_MACHINE:
                return readString(systemRoot, hkey, key, valueName);
            case HKEY_CURRENT_USER:
                return readString(userRoot, hkey, key, valueName);
            default:
                throw new IllegalArgumentException("hkey=" + hkey);
        }
    }

    /**
     * Read value(s) and value name(s) form given key
     *
     * @param hkey HKEY_CURRENT_USER/HKEY_LOCAL_MACHINE
     * @param key
     * @return the value name(s) plus the value(s)
     * @throws IllegalArgumentException
     * @throws IllegalAccessException
     * @throws InvocationTargetException
     */
    public static Map<String, String> readStringValues(int hkey, String key) throws IllegalArgumentException, IllegalAccessException, InvocationTargetException {

        switch (hkey) {
            case HKEY_LOCAL_MACHINE:
                return readStringValues(systemRoot, hkey, key);
            case HKEY_CURRENT_USER:
                return readStringValues(userRoot, hkey, key);
            default:
                throw new IllegalArgumentException("hkey=" + hkey);
        }
    }

    /**
     * Read the value name(s) from a given key
     *
     * @param hkey HKEY_CURRENT_USER/HKEY_LOCAL_MACHINE
     * @param key
     * @return the value name(s)
     * @throws IllegalArgumentException
     * @throws IllegalAccessException
     * @throws InvocationTargetException
     */
    public static List<String> readStringSubKeys(int hkey, String key) throws IllegalArgumentException, IllegalAccessException, InvocationTargetException {

        switch (hkey) {
            case HKEY_LOCAL_MACHINE:
                return readStringSubKeys(systemRoot, hkey, key);
            case HKEY_CURRENT_USER:
                return readStringSubKeys(userRoot, hkey, key);
            default:
                throw new IllegalArgumentException("hkey=" + hkey);
        }
    }

    /**
     * Create a key
     *
     * @param hkey HKEY_CURRENT_USER/HKEY_LOCAL_MACHINE
     * @param key
     * @throws IllegalArgumentException
     * @throws IllegalAccessException
     * @throws InvocationTargetException
     */
    public static void createKey(int hkey, String key) throws IllegalArgumentException, IllegalAccessException, InvocationTargetException {

        int[] ret;
        switch (hkey) {
            case HKEY_LOCAL_MACHINE:
                ret = createKey(systemRoot, hkey, key);
                regCloseKey.invoke(systemRoot, new Object[]{ret[0]});
                break;
            case HKEY_CURRENT_USER:
                ret = createKey(userRoot, hkey, key);
                regCloseKey.invoke(userRoot, new Object[]{ret[0]});
                break;
            default:
                throw new IllegalArgumentException("hkey=" + hkey);
        }

        if (ret[1] != REG_SUCCESS) {
            throw new IllegalArgumentException("rc=" + ret[1] + " key=" + key);
        }
    }

    /**
     * Write a value in a given key/value name
     *
     * @param hkey
     * @param key
     * @param valueName
     * @param value
     * @throws IllegalArgumentException
     * @throws IllegalAccessException
     * @throws InvocationTargetException
     */
    public static void writeStringValue(int hkey, String key, String valueName, String value) throws IllegalArgumentException, IllegalAccessException, InvocationTargetException {

        switch (hkey) {
            case HKEY_LOCAL_MACHINE:
                writeStringValue(systemRoot, hkey, key, valueName, value);
                break;
            case HKEY_CURRENT_USER:
                writeStringValue(userRoot, hkey, key, valueName, value);
                break;
            default:
                throw new IllegalArgumentException("hkey=" + hkey);
        }
    }

    /**
     * Delete a given key
     *
     * @param hkey
     * @param key
     * @throws IllegalArgumentException
     * @throws IllegalAccessException
     * @throws InvocationTargetException
     */
    public static void deleteKey(int hkey, String key) throws IllegalArgumentException, IllegalAccessException, InvocationTargetException {

        int rc = -1;
        switch (hkey) {
            case HKEY_LOCAL_MACHINE:
                rc = deleteKey(systemRoot, hkey, key);
                break;
            case HKEY_CURRENT_USER:
                rc = deleteKey(userRoot, hkey, key);
        }

        if (rc != REG_SUCCESS) {
            throw new IllegalArgumentException("rc=" + rc + " key=" + key);
        }
    }

    /**
     * delete a value from a given key/value name
     *
     * @param hkey
     * @param key
     * @param value
     * @throws IllegalArgumentException
     * @throws IllegalAccessException
     * @throws InvocationTargetException
     */
    public static void deleteValue(int hkey, String key, String value) throws IllegalArgumentException, IllegalAccessException, InvocationTargetException {

        int rc = -1;
        switch (hkey) {
            case HKEY_LOCAL_MACHINE:
                rc = deleteValue(systemRoot, hkey, key, value);
                break;
            case HKEY_CURRENT_USER:
                rc = deleteValue(userRoot, hkey, key, value);
        }

        if (rc != REG_SUCCESS) {
            throw new IllegalArgumentException("rc=" + rc + " key=" + key + " value=" + value);
        }
    }

    private static int deleteValue(Preferences root, int hkey, String key, String value) throws IllegalArgumentException, IllegalAccessException, InvocationTargetException {

        int[] handles = (int[]) regOpenKey.invoke(root, new Object[]{hkey, toCstr(key), KEY_ALL_ACCESS});
        if (handles[1] != REG_SUCCESS) {
            return handles[1];//Can be REG_NOTFOUND, REG_ACCESSDENIED
        }
        int rc = ((Integer) regDeleteValue.invoke(root, new Object[]{handles[0], toCstr(value)}));
        regCloseKey.invoke(root, new Object[]{handles[0]});
        return rc;
    }

    private static int deleteKey(Preferences root, int hkey, String key) throws IllegalArgumentException, IllegalAccessException, InvocationTargetException {

        int rc = ((Integer) regDeleteKey.invoke(root, new Object[]{hkey, toCstr(key)}));
        return rc;  //Can be REG_NOTFOUND, REG_ACCESSDENIED, REG_SUCCESS
    }

    private static String readString(Preferences root, int hkey, String key, String value) throws IllegalArgumentException, IllegalAccessException, InvocationTargetException {

        int[] handles = (int[]) regOpenKey.invoke(root, new Object[]{hkey, toCstr(key), KEY_READ});
        if (handles[1] != REG_SUCCESS) {
            return null;
        }
        byte[] valb = (byte[]) regQueryValueEx.invoke(root, new Object[]{handles[0], toCstr(value)});
        regCloseKey.invoke(root, new Object[]{handles[0]});
        return (valb != null ? new String(valb).trim() : null);
    }

    private static Map<String, String> readStringValues(Preferences root, int hkey, String key) throws IllegalArgumentException, IllegalAccessException, InvocationTargetException {

        HashMap<String, String> results = new HashMap<>();
        int[] handles = (int[]) regOpenKey.invoke(root, new Object[]{hkey, toCstr(key), KEY_READ});
        if (handles[1] != REG_SUCCESS) {
            return null;
        }
        int[] info = (int[]) regQueryInfoKey.invoke(root, new Object[]{handles[0]});

        int count = info[0]; //Count  
        int maxlen = info[3]; //Max value length
        for (int index = 0; index < count; index++) {
            byte[] name = (byte[]) regEnumValue.invoke(root, new Object[]{handles[0], index, maxlen + 1});
            String value = readString(hkey, key, new String(name));
            results.put(new String(name).trim(), value);
        }
        regCloseKey.invoke(root, new Object[]{handles[0]});
        return results;
    }

    private static List<String> readStringSubKeys(Preferences root, int hkey, String key) throws IllegalArgumentException, IllegalAccessException, InvocationTargetException {

        List<String> results = new ArrayList<>();
        int[] handles = (int[]) regOpenKey.invoke(root, new Object[]{hkey, toCstr(key), KEY_READ});
        if (handles[1] != REG_SUCCESS) {
            return null;
        }
        int[] info = (int[]) regQueryInfoKey.invoke(root, new Object[]{handles[0]});

        int count = info[0];//Count
        int maxlen = info[3]; //Max value length
        for (int index = 0; index < count; index++) {
            byte[] name = (byte[]) regEnumKeyEx.invoke(root, new Object[]{handles[0], index, maxlen + 1});
            results.add(new String(name).trim());
        }
        regCloseKey.invoke(root, new Object[]{handles[0]});
        return results;
    }

    private static int[] createKey(Preferences root, int hkey, String key) throws IllegalArgumentException, IllegalAccessException, InvocationTargetException {

        return (int[]) regCreateKeyEx.invoke(root, new Object[]{hkey, toCstr(key)});
    }

    private static void writeStringValue(Preferences root, int hkey, String key, String valueName, String value) throws IllegalArgumentException, IllegalAccessException, InvocationTargetException {

        int[] handles = (int[]) regOpenKey.invoke(root, new Object[]{hkey, toCstr(key), KEY_ALL_ACCESS});
        regSetValueEx.invoke(root, new Object[]{handles[0], toCstr(valueName), toCstr(value)});
        regCloseKey.invoke(root, new Object[]{handles[0]});
    }

    private static byte[] toCstr(String str) {

        byte[] result = new byte[str.length() + 1];
        for (int i = 0; i < str.length(); i++) {
            result[i] = (byte) str.charAt(i);
        }
        result[str.length()] = 0;
        return result;
    }
} 
```

* * *

## 回答 #24

> 赞同：-6
> 
> 时间：2011-05-17T09:03:03.003

我更喜欢使用[java.util.prefs.Preferences](https://docs.oracle.com/javase/8/docs/technotes/guides/preferences/overview.html)类。

一个简单的例子是

```
// Write Operation
Preferences p = Preferences.userRoot();
p.put("key","value"); 
// also there are various other methods such as putByteArray(), putDouble() etc.
p.flush();
//Read Operation
Preferences p = Preferences.userRoot();
String value = p.get("key"); 
```

# html - 液体布局仍然相关吗？

> ID：62292
> 
> 赞同：12
> 
> 时间：2008-09-15T12:18:42.220
> 
> 标签：html, css, layout

现在大多数主流浏览器都支持整页缩放（目前，唯一值得注意的例外是谷歌浏览器），是否不再需要流动或弹性布局？构建液体/弹性布局的相对痛苦值得付出努力吗？是否存在液体布局仍然有益的情况？整页缩放是最初看起来的真正解决方案吗？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-09-15T12:22:19.607

是的，因为那里有各种各样的屏幕，通常从 15 英寸到 32 英寸不等。人们认为“舒适”的字体大小也有一些变化。所有这些加起来构成了您的内容需要适应的相当大范围的尺寸。

如果有的话，随着我们扩展到大型显示器并缩小到手机设备，流动布局变得更加必要。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-15T12:23:48.917

在 CSS 中进行整页缩放并不值得，尤其是现在大多数浏览器都在本机进行这种缩放（并且做得更好 - ref [img] 标签）。

至于使用固定宽度，还有一个次要的特性……如果你增加字体大小，每行显示的单词会更少，这可以帮助一些人阅读。

例如，您是否曾经阅读过一段非常宽的文本，并且发现您已经阅读了同一行两次？如果增加了行高（尽管字体大小相同），每行的字数减少，这就不成问题了。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-09-15T12:37:41.283

对对对！因为一些设计师认为用户总是最大化他们的浏览器而不得不在网站上水平滚动对我来说是一个巨大的烦恼，我相信我并不孤单。最重要的是，作为一个视力很差的人，让我说当布局是流动的时，整页缩放效果最好。否则，您最终会将导航栏从（可见）屏幕上移开。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-15T12:40:43.023

我对此有一个现实世界的问题。该设计要求在一个漂亮的边框内有一个固定宽度的页面。适合浏览器窗口的 800 像素宽减去几个像素。左侧菜单减去 200 像素，内容区域大约为 600 像素宽。

问题是，部分网站内容是动态的，导致用户在其漂亮的 1280x1024 屏幕上编辑和浏览表格中的数据，表格宽度限制为 600 像素。

您应该在动态内容中允许浏览器窗口的宽度，除非该动态内容主要是文本。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-15T12:47:43.897

有弹性的布局与其说是缩放，不如说是换行——如果屏幕分辨率较高，用户可以在屏幕上放置更多信息，同时仍然让分辨率较低的屏幕可以访问内容。页面缩放无法实现这一点。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-15T12:20:14.900

我认为仍然需要流式布局，即使浏览器具有此整页缩放功能，我敢打赌很多人不知道或不知道如何使用它。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-15T12:50:38.710

从可访问性的角度来看，页面缩放是*可怕*的。这相当于说“我们无法正确设计我们的页面[设计师]，所以使用更大的字体并水平滚动页面[浏览器开发人员]”。我不敢相信 Firefox 在微软之后跳下悬崖并将其设为默认值。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-15T12:27:08.563

是的——你不知道阅读器使用什么分辨率，或者什么尺寸的屏幕——或者即使需要/使用可访问性。如上所述，并不是每个人都知道整页缩放 - 我知道，但几乎不使用它......

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-15T13:34:37.840

只有您自己网站的访问者才能告诉您流动布局是否仍然与您的网站相关。

使用诸如 YUI-CSS 和 Google 网站优化器之类的框架，很容易看到您的访问者喜欢什么并搁置意见，而是依赖冷硬的结果。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-17T01:54:33.950

不过，流动布局可能会导致可用性问题。

变得太宽的内容容器变得异常难以阅读。

出于这个原因，许多博客都有固定宽度的内容容器。

或者，您可以创建多列内容容器，以便获得像报纸一样的效果，其中包含多列细小的文本容器。不过，这可能很难做到。

# version-control - 如何修改 TFS 中的默认签入操作？

> ID：62294
> 
> 赞同：10
> 
> 时间：2008-09-15T12:19:21.140
> 
> 标签：version-control, tfs, tfs-workitem

工作项的默认签入操作是“解决”。我想将它设置为“关联”，这样如果我签入的东西太快，这个工作项就不会自动关闭。我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-15T15:00:52.017

是的，签入操作只能与状态转换相关联（即 Active 到 Resolved）。[在Fredrick](https://stackoverflow.com/questions/62294/how-to-modify-the-defaul-check-in-action-in-tfs#62376)链接到 ( [http://www.woodwardweb.com/vsts/top_tfs_tip_3_r.html](http://www.woodwardweb.com/vsts/top_tfs_tip_3_r.html) )的我的博客文章中，我谈到了如何删除它。您需要为团队项目中的每个人自定义工作项以实现此目的。如需帮助，请参阅

[http://msdn.microsoft.com/en-us/library/ms243849(VS.80).aspx](http://msdn.microsoft.com/en-us/library/ms243849(VS.80).aspx)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-15T12:34:29.483

Martin Woodward 在博客中介绍了如何从签入对话框中*删除*“解决”操作作为解决此问题的方法：

[http://www.woodwardweb.com/vsts/top_tfs_tip_3_r.html](http://www.woodwardweb.com/vsts/top_tfs_tip_3_r.html)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2020-01-14T21:51:28.370

对于较新版本的 Visual Studio，您现在可以在 UI 中设置此默认值：

工具 -> 选项 -> 源代码管理 -> Visual Studio Team Foundation Server -> （取消选中）在签入时解析关联的工作项

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2017-05-19T11:02:53.887

与以前的版本不同，在 VS2015 中，注册表项解决方案似乎可以在我们需要的情况下工作！

我刚去

```
HKEY_CURRENT_USER\Software\Microsoft\VisualStudio\14.0\TeamFoundation\SourceControl\Behavior 
```

并`ResolveAsDefaultCheckinAction`从`True`变为`False`。

# php - PHP：如何扩展/收缩 Tinyurls

> ID：62317
> 
> 赞同：2
> 
> 时间：2008-09-15T12:24:45.060
> 
> 标签：php

在 PHP 中，我如何在 search.twitter.com 上复制 Tinyurls 的扩展/收缩功能？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-15T12:33:16.957

如果您想找出 tinyurl 的去向，请使用 fsockopen 在端口 80 上获取到 tinyurl.com 的连接，并向其发送如下 HTTP 请求

```
GET /dmsfm HTTP/1.0
Host: tinyurl.com 
```

你得到的回应看起来像

```
HTTP/1.0 301 Moved Permanently
Connection: close
X-Powered-By: PHP/5.2.6
Location: http://en.wikipedia.org/wiki/TinyURL
Content-type: text/html
Content-Length: 0
Date: Mon, 15 Sep 2008 12:29:04 GMT
Server: TinyURL/1.6 
```

示例代码...

```
<?php
$tinyurl="dmsfm";

$fp = fsockopen("tinyurl.com", 80, $errno, $errstr, 30);
if (!$fp) {
    echo "$errstr ($errno)<br />\n";
} else {
    $out = "GET /$tinyurl HTTP/1.0\r\n";
    $out .= "Host: tinyurl.com\r\n";
    $out .= "Connection: Close\r\n\r\n";

    $response="";

    fwrite($fp, $out);
    while (!feof($fp)) {
        $response.=fgets($fp, 128);
    }
    fclose($fp);

    //now parse the Location: header out of the response

}
?> 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-15T13:00:16.317

这里是如何使用 TinyURL API*收缩*任意 URL。一般调用模式是这样的，它是一个带有参数的简单 HTTP 请求：

[http://tinyurl.com/api-create.php?url=http://insertyourstuffhere.com](http://tinyurl.com/api-create.php?url=http://insertyourstuffhere.com)

这将返回[http://insertyourstuffhere.com](http://insertyourstuffhere.com)对应的 TinyURL 。在 PHP 中，您可以将其包装在 fsockopen() 调用中，或者为了方便起见，只需使用 file() 函数来检索它：

```
function make_tinyurl($longurl)
{
  return(implode('', file(
    'http://tinyurl.com/api-create.php?url='.urlencode($longurl))));
}

// make an example call
print(make_tinyurl('http://www.joelonsoftware.com/items/2008/09/15.html')); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-15T13:55:59.957

当人们以编程方式回答如何创建和解决 tinyurl.com 重定向时，我想（强烈）提出一些建议：缓存。

在 twitter 示例中，如果每次单击“展开”按钮时，它都会执行 XmlHTTPRequest，例如`/api/resolve_tinyurl/http://tinyurl.com/abcd`，然后服务器创建到 tinyurl.com 的 HTTP 连接，并检查标头 - 它会破坏 twitter 和 tinyurl 的服务器..

一个更明智的方法是做类似 Python'y 伪代码的事情。

```
def resolve_tinyurl(url):
    key = md5( url.lower_case() )
    if cache.has_key(key)
        return cache[md5]
    else:
        resolved = query_tinyurl(url)
        cache[key] = resolved
        return resolved 
```

Where`cache`的项目神奇地备份到内存和/或文件中，并且 query_tinyurl() 就像 Paul Dixon 的回答一样工作。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-12-29T16:54:50.730

这是通过 CURL 库解码短 url 的另一种方法：

```
function doShortURLDecode($url) {
    $ch = @curl_init($url);
    @curl_setopt($ch, CURLOPT_HEADER, TRUE);
    @curl_setopt($ch, CURLOPT_NOBODY, TRUE);
    @curl_setopt($ch, CURLOPT_FOLLOWLOCATION, FALSE);
    @curl_setopt($ch, CURLOPT_RETURNTRANSFER, TRUE);
    $response = @curl_exec($ch);
    preg_match('/Location: (.*)\n/', $response, $a);
    if (!isset($a[1])) return $url;
    return $a[1];
} 
```

它在[这里](http://www.barattalo.it/2009/12/29/tiny-url-encode-and-decode-with-php/)描述。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-15T13:52:43.570

另一种简单易行的方法：

```
<?php
function getTinyUrl($url) {
return file_get_contents('http://tinyurl.com/api-create.php?url='.$url);
}
?> 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-11-14T23:01:44.517

如果您只想要该位置，请执行 HEAD 请求而不是 GET。

```
$tinyurl  = 'http://tinyurl.com/3fvbx8';
$context  = stream_context_create(array('http' => array('method' => 'HEAD')));
$response = file_get_contents($tinyurl, null, $context);

$location = '';
foreach ($http_response_header as $header) {
    if (strpos($header, 'Location:') === 0) {
        $location = trim(strrchr($header, ' '));
        break;
    }
}
echo $location;
// http://www.pingdom.com/reports/vb1395a6sww3/check_overview/?name=twitter.com%2Fhome 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-01-07T16:17:12.367

在 PHP 中还有一个[get_headers](http://php.net/manual/en/function.get-headers.php)函数可以用来解码微小的 url。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2019-07-15T09:21:54.580

[@Pons](https://www.barattalo.it/coding/tiny-url-encode-and-decode-with-php/)解决方案的解决方案在我的 php7.3 服务器上无法单独使用`https://stackoverflow.com/q/62317`

这解决了它：

```
public function doShortURLDecode($url) {
    $ch = @curl_init($url);
    @curl_setopt($ch, CURLOPT_HEADER, TRUE);
    @curl_setopt($ch, CURLOPT_NOBODY, TRUE);
    @curl_setopt($ch, CURLOPT_FOLLOWLOCATION, FALSE);
    @curl_setopt($ch, CURLOPT_RETURNTRANSFER, TRUE);
    $response = @curl_exec($ch);
    $cleanresponse= preg_replace('/[^A-Za-z0-9\- _,.:\n\/]/', '', $response);
    preg_match('/Location: (.*)[\n\r]/', $cleanresponse, $a);
    if (!isset($a[1])) return $url;
    return parse_url($url, PHP_URL_SCHEME).'://'.parse_url($url, PHP_URL_HOST).$a[1];
} 
```

# c - 异步 API

> ID：62322
> 
> 赞同：2
> 
> 时间：2008-09-15T12:26:00.347
> 
> 标签：c, asynchronous, api

在尝试实现异步 API 调用/非阻塞调用时，我在我拥有的 All Plain-C 应用程序中了解一点，我读了一篇关于“代表”的 APM（异步编程模型）的文章。基本上我想做的是调用一个 API`f1()`来做一个功能（这需要很长时间 8-10 秒），所以我调用那个 API `f1()`，忘记它，并继续做一些其他的工作，例如 I/O 来获取数据对于`f1()`不依赖于结果的 或某些功能的下一次调用`f1()`。

如果有人使用过 APM 编程模型，我正在寻找一些关于实现非阻塞调用的简明解释。

是否有任何其他方式来实现异步 API，任何其他可能对此有所帮助的库/框架？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-15T13:25:28.953

您基本上需要创建一个多线程（或多进程）应用程序。f1() API 需要产生一个线程（或进程）以在单独的执行空间中处理数据。当它完成时，f1() 例程需要向主进程发出执行完成的信号（signal()、消息队列等）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-15T14:08:33.687

在纯 C 程序中进行异步编程的一种流行方法是使用“事件循环”。您可以使用许多库。我建议看看 [glib](http://library.gnome.org/devel/glib/2.18/glib-The-Main-Event-Loop.html "glib 参考手册")。

另一种选择是使用多个抢先线程（每个并发操作一个）并将它们与互斥锁和条件变量同步。但是，我会避免使用纯 C 语言中的抢占式线程，尤其是在您想编写可移植程序时。很难知道哪些库函数是可重入的，线程程序中的信号处理很麻烦，而且通常 C 库和系统函数都是为单线程使用而设计的。

如果您计划仅在一个平台（如 Windows）上运行您的应用程序，并且使用 f1() 完成的工作相对简单，那么线程就可以了。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-30T11:47:56.843

如果您所指的函数 f1() 本身没有以异步方式实现，则您需要自己将其包装在自己的线程中。执行此操作时，您需要注意可能由调用的特定函数引起的副作用。许多库不是以线程安全的方式设计的，从这些库中多次并发调用函数会导致数据损坏。在这种情况下，您可能需要将功能封装在外部工作进程中。对于您提到的繁重工作（8-10 秒），开销可能是可以接受的。如果您一次只在一个线程中使用外部非线程安全函数，那么您可能是安全的。

使用任何形式的事件循环的问题在于，不知道您的循环的外部函数永远不会将控制权交还给您的循环。因此，您将不会做任何其他事情。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-15T12:33:36.100

用指向 C 中函数的指针替换委托，其他一切都与您阅读的内容基本相同。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-19T09:24:51.037

出色地。基本上我见过 2 种类型的异步 API：

1.  打断。您给呼叫一个回调，该回调应在呼叫之后执行。GIO（前面提到的 GLib 的一部分）以这种方式工作。它相对容易编程，但您通常会更改运行回调的线程（除非它与 GIO 的情况下的主循环集成）。
2.  轮询。您检查数据是否可用。众所周知的 BSD 套接字以这种方式运行。它的优点是不必与主循环集成并在特定线程中运行回调。

如果您为 Gnome 或基于 Gtk+ 的程序编程，我想补充一点，[GTask](http://docs.dronelabs.com/gtask/)似乎非常好（可能很好？我没用过）。[Vala](http://live.gnome.org/Vala)将对类似 GIO 的异步调用提供更好的支持。

# algorithm - 有没有一种算法可以告诉两个短语的语义相似性

> ID：62328
> 
> 赞同：64
> 
> 时间：2008-09-15T12:26:42.200
> 
> 标签：algorithm, nlp, semantics

输入：词组 1，词组 2

输出：语义相似度值（介于 0 和 1 之间），或者这两个短语谈论同一事物的概率

* * *

## 回答 #1

> 赞同：43
> 
> 时间：2008-09-15T13:53:33.753

* * *

你可能想看看这篇论文：

[基于语义网络和语料库统计的句子相似度 (PDF)](http://ants.iis.sinica.edu.tw/3BkMJ9lTeWXTSrrvNoKNFDxRm3zFwRR/55/Sentence%20Similarity%20Based%20on%20Semantic%20Nets%20and%20corpus%20statistics.pdf)

我已经实现了描述的算法。我们的上下文非常笼统（实际上是任何两个英语句子），我们发现所采用的方法太慢了，结果虽然很有希望，但还不够好（或者在没有大量额外努力的情况下可能会如此）。

您没有提供很多背景信息，因此我不一定会推荐这一点，但阅读本文可能有助于您了解如何解决问题。

问候，

马特。

* * *

## 回答 #2

> 赞同：34
> 
> 时间：2008-10-07T15:32:59.830

对此有一个简短的答案。

简短的回答：

使用[WordNet::Similarity Perl 包](http://search.cpan.org/dist/WordNet-Similarity/)。如果 Perl 不是您选择的语言，请查看普林斯顿的[WordNet 项目页面，或在 google 上查找包装库。](http://wordnet.princeton.edu/)

长答案：

确定单词相似度是一个复杂的问题，该领域的研究仍然非常热门。要计算相似度，您需要适当地表示单词的*含义*。但是，“椅子”的含义是什么？事实上，“椅子”的确切含义是什么*？*如果您对此深思熟虑，它会扭曲您的思想，您会有点发疯，最终从事哲学或计算语言学的研究工作以找到真相™。几千年来，哲学家和语言学家都试图找到答案，而且看不到尽头。

因此，如果您有兴趣更深入地探索这个问题，我强烈建议您阅读 Jurafsky 和 ​​Martin 在[语音和语言处理](https://rads.stackoverflow.com/amzn/click/com/0131873210)中的第 20.7 章，其中一些可以通过[Google 图书](http://books.google.co.uk/books?id=fZmj5UNK8AQC&pg=PA379&lpg=PA379b&ots=LqQbZ7EJPG&sig=7VIRoXss0BNLv-B28FCPQgnqjVs&hl=en&sa=X&oi=book_result&resnum=1&ct=result#PPA658,M1)获得。它很好地概述了分布方法的最新技术，这些方法使用单词共现统计来定义单词相似度的度量。但是，您不太可能找到实现这些的库。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-09-15T22:36:57.723

您可能想查看普林斯顿大学的[WordNet项目。](http://wordnet.princeton.edu/)一种可能的方法是首先通过停用词列表运行每个短语（删除“常见”词，例如“a”、“to”、“the”等）每个短语，您可以使用基于 WordNet 的距离度量来计算另一个短语中每个单词之间的语义“相似性”。距离度量可能类似于：在 WordNet 中从 word1 到 word2 必须经过的弧数。

对不起，这是相当高级的。我显然从未尝试过这个。只是一个快速的想法。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2016-01-14T18:46:39.540

对于刚来这里的人，我建议看看 SEMILAR - [http://www.semanticsimilarity.org/](http://www.semanticsimilarity.org/)。他们实施了许多现代研究方法来计算单词和句子的相似度。它是用 Java 编写的。

> SEMILAR API 带有基于 Wordnet、潜在语义分析 (LSA)、潜在狄利克雷分配 (LDA)、BLEU、Meteor、逐点互信息 (PMI)、基于依赖的方法、基于二次分配的优化方法等的各种相似性方法。相似性方法适用于不同的粒度——单词到单词、句子到句子或更大的文本。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-09-15T13:20:07.733

我会为此研究潜在语义索引。我相信您可以创建类似于向量空间搜索索引的东西，但语义相关的术语更接近，即它们之间的角度更小。如果我了解更多，我会在这里发帖。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2014-10-01T13:12:33.367

很抱歉挖掘了一个 6 年前的问题，但是当我今天刚刚看到这篇文章时，我会给出一个答案，以防其他人正在寻找类似的东西。

cortical.io 开发了一个计算两个表达式语义相似度的过程，他们[在他们的网站上有一个演示](http://www.cortical.io/demos/similarity-explorer/)。他们提供了一个[免费的 API 来提供对功能的访问](http://www.cortical.io/developers.html)，因此您可以在自己的应用程序中使用它，而无需自己实现算法。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-09-15T14:01:41.753

一种简单的解决方案是使用字符 n-gram 向量的点积。这对排序更改（许多编辑距离度量不是）是稳健的，并且捕获了围绕词干提取的许多问题。它还可以防止完全语义理解的 AI 完全问题。

要计算 n-gram 向量，只需选择一个 n 值（例如 3），然后将短语中的每个 3 词序列散列到一个向量中。将向量归一化为单位长度，然后取不同向量的点积来检测相似度。

这种方法已在 [J. Mitchell 和 M. Lapata，“语义分布模型中的组成”，认知科学，第一卷中进行了描述。34，没有。8，第 1388-1429 页，2010 年 11 月，DOI 10.1111/j.1551-6709.2010.01106.x](http://onlinelibrary.wiley.com/doi/10.1111/j.1551-6709.2010.01106.x/abstract)

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2010-07-04T17:55:31.533

我会看看统计技术，考虑到每个单词出现在句子中的概率。这将使您对流行词（例如“and”、“or”、“the”）给予较低的重要性，而对出现较少的单词给予更多的重视，因此这是一个更好的区分因素。例如，如果您有两个句子：

1) smith-waterman 算法为您提供了两个字符串之间的相似性度量。2）我们已经审查了 smith-waterman 算法，我们发现它对于我们的项目来说已经足够好了。

这两个句子共享单词“smith-waterman”和单词“algorithms”（不像“and”、“or”等常见）这一事实将使您可以说这两个句子确实可能正在谈论同一个话题。

总而言之，我建议您看一下：1）字符串相似性度量；2）统计方法；

希望这可以帮助。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2013-01-17T16:51:33.473

试试[SimService](http://swoogle.umbc.edu/SimService/)，它提供计算前 n 个相似词和短语相似度的服务。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-15T12:31:32.843

这要求您的算法实际上知道您在说什么。它可以通过比较单词和寻找同义词等以某种基本形式完成，但任何类型的准确结果都需要某种形式的智能。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2017-04-04T17:07:21.160

看看[http://mkusner.github.io/publications/WMD.pdf](http://mkusner.github.io/publications/WMD.pdf)这篇论文描述了一种名为 Word Mover distance 的算法，它试图揭示语义相似性。它依赖于 word2vec 规定的相似度分数。将此与 GoogleNews-vectors-negative300 集成会产生理想的结果。

# asp.net - 什么是液体布局？

> ID：62334
> 
> 赞同：6
> 
> 时间：2008-09-15T12:27:34.553
> 
> 标签：asp.net, html, css, layout

我的设计师一直在抛弃术语“液体”布局。这是什么意思？

**感谢您的澄清，我一直只是将其称为百分比布局，并认为他是在说这些碎片可以移动，那是流动的**

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-09-15T12:29:44.253

“液体”布局是一种站点布局，随着浏览器窗口大小的调整，它会扩展以填充整个可用区域。通常这是使用 CSS 完成的。流动布局对于某些类型的网站非常有帮助，但它们也往往比固定宽度布局要付出更多的努力，而且它们的有用性取决于网站内容和它们的实施情况。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-15T12:30:02.537

来自[http://www.maxdesign.com.au/presentation/liquid/](http://www.maxdesign.com.au/presentation/liquid/)：

> 页面上的所有容器的宽度都以百分比定义——这意味着它们完全基于视口而不是初始包含块。当您调整浏览器窗口的大小时，流动布局将移入和移出。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-15T12:31:04.640

基本上，它是一种网页布局，不依赖于页面中元素的特定宽度规范。

[请参阅Wikipedia](http://en.wikipedia.org/wiki/Web_design#Liquid_versus_fixed_layouts)上的讨论。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-15T12:31:55.743

这意味着一种布局可以动态调整到浏览器（或任何客户端）的宽度和高度，以有效利用所有可用的屏幕空间，而不是（大部分）固定宽度的布局，以适应特定的公分母分辨率时间（例如 800x600 多年来一直是网站的标准）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-15T12:42:18.420

看到这个： [http ://www.time-tripper.com/uipatterns/Liquid_Layout](http://www.time-tripper.com/uipatterns/Liquid_Layout)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-15T12:29:51.083

Liquid Layouts 指的是网站的设计理念。当您调整浏览器窗口的大小时，液体布局将移入和移出，因为 CSS 中有百分比和相对宽度。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-15T12:31:03.813

它只是意味着它会收缩/扩展以填充浏览器的窗口大小（通常是宽度），如果事情做得好，直到某个点。否则，在大型 (24"+) 显示器上，文本可能很难阅读。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-15T12:32:05.963

两种之一：

*   设计将缩放到浏览器的宽度（例如，如果浏览器是 1024 像素宽，那么设计也会如此）......尽管在为 100 像素宽的浏览器设计时这确实很有趣（有时设计师实际上会设置一个最小宽度）。

*   该设计具有固定宽度，但使用相对大小进行测量设置......例如“em”......因此，随着字体大小的增加，页面的宽度也会增加。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-15T12:39:47.863

液体布局是 CSS 布局的一种方法，它以百分比定义所有宽度，因此当调整视口（浏览器窗口）的大小时，页面的区域将扩大/缩小。

如果尝试创建一个既适合大屏幕又适合小屏幕的网站，它们非常有用。它们比固定布局更难处理，因为您放弃了对页面中所有内容如何适应的一些级别控制，并且您必须非常关注您的内容，以确保它不会掉落在调整大小时在美学上分开。

我想说流动布局对于具有相当基本的列布局的文本繁重的网站最有用。您可能还会发现一种具有“弹性”布局的快乐媒介——一种同时具有流动区域和固定区域的媒介。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-15T12:42:04.393

在真正的 Liquid 布局中，您的内容会以一种有意义、经过计算和智能的方式扩展和收缩以适应用户的浏览器窗口。因此，它不仅仅是将列和容器宽度设置为百分比。

做得好，这可以提高感知质量。做得不好，这是一个可用性的噩梦。

变液体是臀部的巨大痛苦。如果您正在构建网站的主题/客户/产品对他们有很强的视觉质量（想想夏季大片电影网站），需要一定的配合和完成，或者如果它需要显示，那么痛苦是值得的大块数据。

注意：稍后我将通过链接到我的主张的好例子和引用来更新它

# c++ - pop_back() 真的会使 std::vector 上的 *all* 迭代器无效吗？

> ID：62340
> 
> 赞同：7
> 
> 时间：2008-09-15T12:28:49.370
> 
> 标签：c++, stl

```
std::vector<int> ints;

// ... fill ints with random values

for(std::vector<int>::iterator it = ints.begin(); it != ints.end(); )
{
    if(*it < 10)
    {
        *it = ints.back();
        ints.pop_back();
        continue;
    }
    it++;
} 
```

此代码不起作用，因为`pop_back()`调用时`it`无效。但我没有找到任何关于`std::vector::pop_back()`.

你有一些关于那个的链接吗？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-09-15T12:51:20.410

调用[`pop_back()`](http://en.cppreference.com/w/cpp/container/vector/pop_back)删除向量中的最后一个元素，因此该元素的迭代器无效。该`pop_back()`调用不会*使*最后一个元素之前的项目的迭代器无效，只有重新分配才会这样做。来自 Josuttis 的“C++ 标准库参考”：

> 插入或删除元素会使引用以下元素的引用、指针和迭代器无效。如果插入导致重新分配，它会使所有引用、迭代器和指针无效。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-09-15T13:25:29.547

这是您的答案，直接来自《神圣标准》：

> 23.2.4.2 载体满足容器和可逆容器（在 23.1 中的两个表格中给出）和序列的所有要求，包括大多数可选的序列要求 (23.1.1)。

> 23.1.1.12 表 68 表达式 a.pop_back() 返回 typevoid 操作语义**a.erase(--a.end())** 容器向量、列表、双端队列

注意 a.pop_back 等价于 a.erase(--a.end())。查看vector关于擦除的细节：

> 23.2.4.3.3 - 迭代器擦除（迭代器位置） - 效果 -**使擦除点之后的所有迭代器和引用无效**

因此，一旦您调用 pop_back，任何指向先前最终元素（现在不再存在）的迭代器都将失效。

查看您的代码，问题是当您删除最后一个元素并且列表变为空时，您仍然递增它并离开列表的末尾。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-15T13:29:12.410

（我使用 C++0x 工作草案中使用的编号方案，[可在此处获得](http://www.justsoftwaresolutions.co.uk/cplusplus/new-cplusplus-draft-and-concurrency-papers.html)

第 732 页的表 94 说 pop_back（如果它存在于序列容器中）具有以下效果：

```
{ iterator tmp = a.end(); 
--tmp; 
a.erase(tmp); } 
```

23.1.1 第 12 点指出：

> 除非另有规定（显式或通过根据其他函数定义函数），调用容器成员函数或将容器作为参数传递给库函数不应使该容器内对象的迭代器无效或更改其值.

访问 end() 作为应用前缀 - 都没有这样的效果，但擦除（）：

23.2.6.4（关于 vector.erase() 第 4 点）：

> 效果：在擦除点或擦除点之后使迭代器和引用无效。

所以总而言之：根据标准，pop_back() 只会使最后一个元素的迭代器无效。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-15T13:13:53.100

[这是来自 SGI 的 STL 文档 ( http://www.sgi.com/tech/stl/Vector.html](http://www.sgi.com/tech/stl/Vector.html) )的引用：

[5] 向量的迭代器在其内存被重新分配时失效。此外，在向量中间插入或删除元素会使指向插入或删除点之后元素的所有迭代器无效。因此，如果您使用 reserve() 预分配与向量将使用的内存一样多的内存，并且所有插入和删除都在向量的末尾，则可以防止向量的迭代器失效。

我认为 pop_back 只会使指向最后一个元素的迭代器和 end() 迭代器无效。我们确实需要查看代码失败的数据，以及它无法确定发生了什么的方式。据我所知，代码应该可以工作 - 此类代码中的常见问题是迭代器上的元素和 ++ 的删除发生在同一迭代中，@mikhaild 指出的方式。但是，在这段代码中，情况并非如此：调用 pop_back 时不会发生 it++。

当它指向最后一个元素并且最后一个元素小于 10 时，仍然可能会发生一些不好的事情。我们现在正在比较一个*无效*的it 和 end()。它可能仍然有效，但不能保证。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-15T12:33:20.313

迭代器仅在重新分配存储时失效。谷歌是你的朋友：[见脚注 5](http://www.sgi.com/tech/stl/Vector.html)。

您的代码由于其他原因无法正常工作。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-15T14:01:24.983

`pop_back()`仅使指向最后一个元素的迭代器无效。来自 C++ 标准库参考：

> 插入或删除元素会使引用以下元素的引用、指针和迭代器无效。如果插入导致重新分配，它会使所有引用、迭代器和指针无效。

因此，要回答您的问题，不，它不会使*所有*迭代器无效。

但是，在您的代码示例中，**`it`**当它指向最后一个元素并且值低于 10 时，它可能会失效。在这种情况下，Visual Studio 调试 STL 会将迭代器标记为无效，并进一步检查它是否不等于 end()将显示一个断言。

如果迭代器被实现为纯指针（就像在所有非调试 STL 向量情况下一样），您的代码应该可以正常工作。如果迭代器不仅仅是指针，那么您的代码将无法正确处理这种删除最后一个元素的情况。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-15T12:47:52.710

错误是当“it”指向vector的最后一个元素并且如果这个元素小于10，这个最后一个元素被删除。现在“it”指向 ints.end()，下一个“it++”将指针移动到 ints.end()+1，所以现在“it”从 ints.end() 中逃跑，你得到了无限循环扫描你所有的记忆 ：）。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-15T13:21:23.130

“官方规范”是 C++ 标准。如果您无法访问 C++03 的副本，您可以从委员会的网站获取最新的 C++0x 草案：[http ://www.open-std.org/jtc1/sc22/wg21/文档/论文/2008/n2723.pdf](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2008/n2723.pdf)

容器要求的“操作语义”部分指定 pop_back() 等价于 { iterator i = end(); - 一世; 擦除（一）；}。擦除的 [vector.modifiers] 部分显示“效果：在擦除点或之后使迭代器和引用无效。”

如果你想要直觉参数，pop_back 是没有失败的（因为在标准容器中破坏 value_types 是不允许抛出异常的），所以它不能做任何复制或分配（因为它们可以抛出），这意味着你可以猜到擦除元素的迭代器和结束迭代器无效，但其余部分无效。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-15T13:44:20.733

pop_back() 只有在指向向量中的最后一项时**才会**使其无效**。**因此，只要向量中的最后一个 int 小于 10，您的代码就会失败，如下所示：

*it = ints.back(); // 将 *it 设置为它已有的值
ints.pop_back(); // 使迭代器失效
continue; // 循环并访问无效的迭代器

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-01-06T08:45:21.050

您可能需要考虑使用擦除的返回值，而不是将后退元素交换到删除的位置并弹出。对于序列，擦除返回一个迭代器，该迭代器指向被删除元素之外的元素。请注意，此方法可能会导致比您的原始算法更多的复制。

```
for(std::vector<int>::iterator it = ints.begin(); it != ints.end(); )
{
    if(*it < 10)
        it = ints.erase( it );
    else
        ++it;
} 
```

`std::remove_if`也可能是替代解决方案。

```
struct LessThanTen { bool operator()( int n ) { return n < 10; } };

ints.erase( std::remove_if( ints.begin(), ints.end(), LessThanTen() ), ints.end() ); 
```

`std::remove_if`（就像我的第一个算法一样）稳定，所以它可能不是最有效的方法，但它很简洁。

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2008-09-15T12:40:48.407

在此处查看信息[(cplusplus.com)](http://www.cplusplus.com/reference/stl/vector/pop_back.html)：

> **删除最后一个元素**
> 
> 删除向量中的最后一个元素，有效地将向量大小减一并使所有迭代器和对它的引用无效。

# .net - 使用程序集属性的最佳实践是什么？

> ID：62353
> 
> 赞同：166
> 
> 时间：2008-09-15T12:31:11.113
> 
> 标签：.net, assemblies, attributes, assemblyinfo

我有一个包含多个项目的解决方案。我正在尝试通过链接一个解决方案范围的程序集信息文件来优化 AssemblyInfo.cs 文件。这样做的最佳做法是什么？哪些属性应该在解决方案范围的文件中，哪些是项目/程序集特定的？

* * *

*编辑：如果您有兴趣，有一个后续问题[AssemblyVersion、AssemblyFileVersion 和 AssemblyInformationalVersion 之间有什么区别？](https://stackoverflow.com/questions/64602/what-are-differences-between-assemblyversion-assemblyfileversion-and-assemblyin)*

* * *

## 回答 #1

> 赞同：212
> 
> 时间：2008-09-15T13:04:38.270

我们正在使用一个名为 GlobalAssemblyInfo.cs 的全局文件和一个名为 AssemblyInfo.cs 的本地文件。全局文件包含以下属性：

```
 [assembly: AssemblyProduct("Your Product Name")]

 [assembly: AssemblyCompany("Your Company")]
 [assembly: AssemblyCopyright("Copyright © 2008 ...")]
 [assembly: AssemblyTrademark("Your Trademark - if applicable")]

 #if DEBUG
 [assembly: AssemblyConfiguration("Debug")]
 #else
 [assembly: AssemblyConfiguration("Release")]
 #endif

 [assembly: AssemblyVersion("This is set by build process")]
 [assembly: AssemblyFileVersion("This is set by build process")] 
```

本地 AssemblyInfo.cs 包含以下属性：

```
 [assembly: AssemblyTitle("Your assembly title")]
 [assembly: AssemblyDescription("Your assembly description")]
 [assembly: AssemblyCulture("The culture - if not neutral")]

 [assembly: ComVisible(true/false)]

 // unique id per assembly
 [assembly: Guid("xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx")] 
```

您可以使用以下过程添加 GlobalAssemblyInfo.cs：

*   在项目的上下文菜单中选择**Add/Existing Item...**
*   选择 GlobalAssemblyInfo.cs
*   通过单击右侧的那个小向下箭头来展开添加按钮
*   在按钮下拉列表中选择“添加为链接”

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2008-09-15T13:14:27.077

在我的例子中，我们正在构建一个产品，我们有一个 Visual Studio 解决方案，在他们自己的项目中包含各种组件。共同的属性去。在解决方案中，大约有35个项目，以及一个通用的程序集信息（CommonAssemblyInfo.cs），它具有以下属性：

```
[assembly: AssemblyCompany("Company")]
[assembly: AssemblyProduct("Product Name")]
[assembly: AssemblyCopyright("Copyright © 2007 Company")]
[assembly: AssemblyTrademark("Company")]

//This shows up as Product Version in Windows Explorer
//We make this the same for all files in a particular product version. And increment it globally for all projects.
//We then use this as the Product Version in installers as well (for example built using Wix).
[assembly: AssemblyInformationalVersion("0.9.2.0")] 
```

其他属性，例如 AssemblyTitle、AssemblyVersion 等，我们基于每个程序集提供。构建程序集时，AssemblyInfo.cs 和 CommonAssemblyInfo.cs 都内置到每个程序集中。这为我们提供了两全其美的优势，您可能希望为所有项目提供一些共同属性，并为其他一些项目提供特定值。

希望有帮助。

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2008-09-15T14:01:20.477

@JRoppert 提出的解决方案与我所做的几乎相同。唯一的区别是我将以下几行放在本地 AssemblyInfo.cs 文件中，因为它们可能因每个程序集而异：

```
#if DEBUG
[assembly: AssemblyConfiguration("Debug")]
#else
[assembly: AssemblyConfiguration("Release")]
#endif
[assembly: AssemblyVersion("This is set by build process")]
[assembly: AssemblyFileVersion("This is set by build process")]
[assembly: CLSCompliant(true)] 
```

我还（通常）为每个解决方案使用一个通用的装配信息，并假设一种解决方案是单个产品线/可发布产品。通用程序集信息文件还具有：

```
[assembly: AssemblyInformationalVersion("0.9.2.0")] 
```

这将设置 Windows 资源管理器显示的“ProductVersion”值。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2008-09-15T13:45:44.040

[MSBuild 社区任务](https://github.com/loresoft/msbuildtasks)包含一个名为 AssemblyInfo 的自定义任务，您可以使用它来生成您的 assemblyinfo.cs。它需要对您的 csproj 文件进行一点手工编辑才能使用，但这是值得的。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2014-08-04T11:18:09.233

在我看来，使用 GlobalAssemblyInfo.cs 比它的价值更麻烦，因为您需要修改每个项目文件并记住修改每个新项目，而默认情况下您会得到一个 AssemblyInfo.cs。

对于全局值（即公司、产品等）的更改，这些更改通常很少且易于管理，我认为[DRY](http://en.wikipedia.org/wiki/Don't_repeat_yourself)不应该是一个考虑因素。当您想要一次性手动更改所有项目中的值时，只需运行以下 MSBuild 脚本（依赖于[MSBuild Extension Pack ）：](http://mikefourie.github.io/MSBuildExtensionPack/)

```
<?xml version="1.0" encoding="utf-8"?>
<Project ToolsVersion="4.0" DefaultTargets="UpdateAssemblyInfo" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">

    <ItemGroup>
        <AllAssemblyInfoFiles Include="..\**\AssemblyInfo.cs" />
    </ItemGroup>

    <Import Project="MSBuild.ExtensionPack.tasks" />

  <Target Name="UpdateAssemblyInfo">
    <Message Text="%(AllAssemblyInfoFiles.FullPath)" />
    <MSBuild.ExtensionPack.Framework.AssemblyInfo 
        AssemblyInfoFiles="@(AllAssemblyInfoFiles)"
        AssemblyCompany="Company"
        AssemblyProduct="Product"
        AssemblyCopyright="Copyright"
        ... etc ...
        />
  </Target>

</Project> 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-09-15T13:10:38.677

要在多个项目之间共享文件，您可以将现有文件添加为链接。

为此，请添加一个现有文件，然后单击文件选择器中的“添加为链接”。[（来源：][[free.fr](http://laurent.etiemble.free.fr/dotclear/images/AddLinkedFile03_tn.png)][）][![添加为链接](https://i.stack.imgur.com/w4Ka4.png)](http://laurent.etiemble.free.fr/dotclear/images/AddLinkedFile03.png)

至于在共享文件中放置什么，我建议放置将跨程序集共享的东西。诸如版权，公司，也许是版本之类的东西。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2016-09-06T15:06:06.463

我发现有用的一件事是通过在预构建阶段应用令牌替换来生成 AssemblyVersion 元素（等）。

我使用 TortoiseSvn，它很容易将`SubWCRev.exe`模板`AssemblyInfo.wcrev`转换为`AssemblyInfo.cs`. 模板中的相关行可能如下所示：

```
[assembly: AssemblyVersion("2.3.$WCREV$.$WCMODS?1:0$$WCUNVER?1:0$")] 
```

第三个元素是修订号。我使用第四个元素来检查我没有忘记提交任何新的或更改的文件（如果一切正常，第四个元素是 00）。

顺便说一句，添加`AssemblyInfo.wcrev`到您的版本控制中，如果您使用它，请**忽略。** `AssemblyInfo.cs`

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-15T13:04:04.577

不建议对多个项目使用单个 AseemblyInfo.cs 文件。AssemblyInfo 文件包含可能仅与该特定程序集相关的信息。最明显的两条信息是`AssemblyTitle`和`AssemblyVersion`。

更好的解决方案可能是使用`targets`由 MSBuild 处理的文件，以便将程序集属性“注入”到多个项目。

# c# - 使用反射调用 ASP.NET Web 服务

> ID：62365
> 
> 赞同：7
> 
> 时间：2008-09-15T12:32:39.970
> 
> 标签：c#, asp.net, web-services, reflection

假设我有一个 ASMX Web 服务 MyService。该服务有一个方法，MyMethod。我可以在服务器端执行 MyMethod 如下：

```
MyService service = new MyService();
service.MyMethod(); 
```

我需要做类似的事情，直到运行时才知道服务和方法。

我假设反思是解决这个问题的方法。不幸的是，我很难让它发挥作用。当我执行此代码时：

```
Type.GetType("MyService", true); 
```

它抛出这个错误：

> 无法从程序集“App_Web__ktsp_r0，版本=0.0.0.0，文化=中性，PublicKeyToken=null”加载类型“MyService”。

任何指导将不胜感激。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-15T12:35:20.230

我不确定这是否是最好的方法。对我来说最明显的方法是发出 HTTP 请求，并使用实际的 HTTP GET 或 POST 调用 Web 服务。使用您的方法，我不完全确定您将如何设置发送到 Web 服务的数据。我在 VB.Net 中添加了一些示例代码

```
Dim HTTPRequest As HttpWebRequest
Dim HTTPResponse As HttpWebResponse
Dim ResponseReader As StreamReader
Dim URL AS String
Dim ResponseText As String

URL = "http://www.example.com/MyWebSerivce/MyMethod?arg1=A&arg2=B"

HTTPRequest = HttpWebRequest.Create(URL)
HTTPRequest.Method = "GET"

HTTPResponse = HTTPRequest.GetResponse()

ResponseReader = New StreamReader(HTTPResponse.GetResponseStream())
ResponseText = ResponseReader.ReadToEnd() 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-08T14:02:13.550

// 试试这个 ->

```
 Type t = System.Web.Compilation.BuildManager.GetType("MyServiceClass", true);
    object act = Activator.CreateInstance(t);                
    object o = t.GetMethod("hello").Invoke(act, null); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-15T12:46:12.870

虽然我不知道为什么 Reflection 在那里不起作用（我假设编译器可能正在从您的`[WebService]`注释创建一个新类），但这里有一些建议可以解决您的问题：

**简而言之，保持您的 WebService 简单、浅薄：外观模式的实现**。

让您的服务将计算委托给一个实现类，该类应该可以通过反射轻松调用。这样，您的 WebService 类只是您系统的前端 - 您甚至可以添加电子邮件处理程序、XML-RPC 前端等，因为您的逻辑不与 WebService 耦合，而是与实际的业务层对象耦合。

将 WebService 类视为架构中的 UI 层对象。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-15T13:20:27.703

这是一个可能有人可以扩展的快速答案。

当您使用 WSDL 模板应用程序 (WSDL.exe) 生成服务包装器时，它会构建一个 SoapHttpClientProtocol 类型的类。您也可以手动完成：

```
public class MyService : SoapHttpClientProtocol
{
    public MyService(string url)
    {
        this.Url = url;
        // plus set credentials, etc.
    }

    [SoapDocumentMethod("{service url}", RequestNamespace="{namespace}", ResponseNamespace="{namespace}", Use = System.Web.Services.Description.SoapBindingUse.Literal, ParameterStyle = System.Web.Services.Protocols.SoapParameterStyle.Wrapped)]
    public int MyMethod(string arg1)
    {
        object[] results = this.Invoke("MyMethod", new object[] { arg1 });
        return ((int)(results[0]));
    }
} 
```

我没有测试过这段代码，但我想它应该可以独立运行，而无需运行 WSDL 工具。

我提供的代码是调用者代码，它通过远程调用连接到 Web 服务（即使出于某种原因，您实际上并不希望它是远程的。） Invoke 方法负责将其打包为肥皂电话。如果您想通过 HTTP 绕过 Web 服务调用，@Dave Ward 的代码是正确的——只要您实际上能够引用该类。也许内部类型不是“MyService”——您必须检查控件的代码才能确定。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-15T12:59:24.413

@Kibbee：我需要避免 HTTP 性能下降。它不会是远程调用，因此所有这些增加的开销*都应该*是不必要的。

@Daren：我绝对同意这种设计理念。这里的问题是我不会控制服务或其底层业务逻辑。

这是针对需要针对任意服务/方法执行[的服务器控件，与 Web 服务本身的实现方式正交。](http://codeplex.com/UsernameAvailability)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-15T13:09:29.460

虽然我不能从你的帖子中看出：

要记住的一件事是，如果您使用反射，您需要创建一个自动生成的 Web 服务类的实例（从您的 Web 服务的 WSDL 创建的那个）。不要创建负责服务服务器端的类。

所以如果你有一个网络服务

```
 [WebService(Namespace = "http://tempuri.org/")]
    [WebServiceBinding(ConformsTo = WsiProfiles.BasicProfile1_1)]
    [ToolboxItem(false)]
    public class WebService1 : System.Web.Services.WebService
    {
     ...
    } 
```

您不能在客户端中引用该程序集并执行以下操作：

```
WebService1  ws = new WebService1 ();
ws.SomeMethod(); 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-15T13:18:00.877

@Radu：我能够创建一个实例并完全像那样调用该方法。例如，如果我有这个 ASMX：

```
[WebService(Namespace = "http://tempuri.org/")]
[WebServiceBinding(ConformsTo = WsiProfiles.BasicProfile1_1)]
[脚本服务]
公共类 MyService : System.Web.Services.WebService
{
  [网络方法]
  公共字符串 HelloWorld()
  {
    返回“你好世界”；
  }
}
```

我可以像这样从 ASPX 页面的代码隐藏中调用它：

```
我的服务服务 = 新的我的服务（）；
Response.Write(service.HelloWorld());
```

你说那不应该？

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-17T21:02:26.123

我回顾了这个问题，我认为您面临的是 ASMX 代码将被构建到一个具有随机名称的 DLL 中，作为您站点动态编译的一部分。默认情况下，您查找类型的代码将仅搜索其自己的程序集（另一个 App_Code DLL，根据您收到的错误的外观）和核心库。您可以向 GetType() 提供特定的程序集引用“TypeName，AssemblyName”，但对于自动生成的程序集（每次重新编译后都有新名称），这是不可能的。

解决方案....我以前没有自己做过，但我相信你应该能够使用这样的东西：

```
System.Web.Compilation.BuildManager.GetType("MyService", true) 
```

因为 BuildManager 知道它创建的 DLL 并且知道在哪里查找。

我想这确实与 Web 服务无关，但如果是您自己的代码，Daren 对 Facade 模式的看法是正确的。

# silverlight - 您可以在 Silverlight 中为自定义依赖属性设置动画吗？

> ID：62382
> 
> 赞同：0
> 
> 时间：2008-09-15T12:35:33.847
> 
> 标签：silverlight

我可能会遗漏一些非常明显的东西。我正在尝试编写一个自定义面板，其中内容根据几个依赖属性进行布局（我假设它们*必须*是 DP，因为我希望能够为它们设置动画。）

但是，当我尝试运行故事板来为这两个属性设置动画时，Silverlight 会引发灾难性错误。但是，如果我尝试仅对其中一个进行动画处理，则效果很好。如果我尝试为我的一个属性和一个“内置”属性（如不透明度）设置动画，它也可以工作。但是，如果我尝试为我的两个自定义属性设置动画，我会收到灾难性错误。

还有人遇到这个吗？

编辑：

两个 DP 是 ScaleX 和 ScaleY - 都是双打。它们缩放面板中子项的 X 和 Y 位置。以下是其中之一的定义方式：

```
 public double ScaleX
    {
        get { return (double)GetValue(ScaleXProperty); }
        set { SetValue(ScaleXProperty, value); }
    }

    /// <summary> 
    /// Identifies the ScaleX dependency property.
    /// </summary> 
    public static readonly DependencyProperty ScaleXProperty =
                DependencyProperty.Register(
                      "ScaleX",
                      typeof(double),
                      typeof(MyPanel),
                      new PropertyMetadata(OnScaleXPropertyChanged));

    /// <summary>
    /// ScaleXProperty property changed handler. 
    /// </summary>
    /// <param name="d">MyPanel that changed its ScaleX.</param>
    /// <param name="e">DependencyPropertyChangedEventArgs.</param> 
    private static void OnScaleXPropertyChanged(DependencyObject d, DependencyPropertyChangedEventArgs e)
    {
        MyPanel _MyPanel = d as MyPanel;
        if (_MyPanel != null)
        {
            _MyPanel.InvalidateArrange(); 
        }
    }

    public static void SetScaleX(DependencyObject obj, double val)
    {
        obj.SetValue(ScaleXProperty, val);
    }

    public static double GetScaleX(DependencyObject obj)
    {
        return (double)obj.GetValue(ScaleXProperty);
    } 
```

编辑：我已经尝试过调用和不调用 InvalidateArrange （在任何情况下都是绝对必要的），结果是一样的。在灾难性错误开始之前，事件处理程序甚至不会被调用。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-17T19:49:23.057

这是 Silverlight 2 Beta 2 的一个记录错误。您不能为同一对象上的两个自定义依赖属性设置动画。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-16T13:16:56.207

我会尝试在 OnPropertyChanged 中注释掉 InvalidateArrange 并看看会发生什么。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-26T17:31:19.437

我希望回答我自己的问题还不错。

Silverlight 2 Release Candidate 0 今天发布了，我已经在上面测试过这个问题，它似乎已经修复了。现在，我的测试面板中的两个自定义 DP 都可以正确设置动画，因此应用程序的行为符合预期。这很好。

请注意，此 RC 只是基于开发人员的 RC，因此 Silverlight 的标准版本尚未更新。不过，我预计它将在下个月完全发布。

# apache - 如何将 Apache .htaccess 文件转换为 Lighttpd 规则？

> ID：62384
> 
> 赞同：5
> 
> 时间：2008-09-15T12:35:40.820
> 
> 标签：apache, .htaccess, lighttpd

将mod_rewrite规则转换为lighttpd格式是个大问题

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-15T16:42:49.947

通常是一个一个地经历并转换它们的情况。我不知道任何自动化手段，

文档 - [http://redmine.lighttpd.net/projects/1/wiki/Docs:ModRewrite](http://redmine.lighttpd.net/projects/1/wiki/Docs:ModRewrite) - 提供了可用的正则表达式和一些示例。

如果有任何特别有问题的项目，我会编辑问题以显示它们，并在此处询问答案。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-01T03:53:00.537

url 重写在 $HTTP["url"] 条件下不起作用。[ [http://forum.lighttpd.net/topic/1092#3028]](http://forum.lighttpd.net/topic/1092#3028])

# c++ - Visual C++ 6.0 和 Visual C++ 2008 有什么区别？

> ID：62389
> 
> 赞同：10
> 
> 时间：2008-09-15T12:36:05.953
> 
> 标签：c++, visual-studio, visual-c++-6

MS VS C++ 6.0 和 MSVS C++ 2008 之间的优缺点是什么？

问这样一个问题的主要原因是仍然有很多体面的程序员更喜欢使用旧版本而不是最新版本。

有什么理由可能更喜欢旧的而不是新的？

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2008-09-15T12:48:48.777

Visual Studio 2008 相对于 Visual C++ 6.0 的优势：

*   更多符合标准的 C++ 编译器，具有更好的模板处理能力
*   支持 x64 / 移动 / XBOX 目标
*   改进的 STL 实施
*   支持 C++0x TR1（智能指针、正则表达式等）
*   安全 C 运行时库
*   改进的代码导航
*   改进的调试器；运行远程调试会话的可能性
*   更好的编译器优化
*   许多错误修复
*   在多核/多 CPU 系统上更快地构建
*   改进的 IDE 用户界面，具有许多不错的功能
*   改进了 IDE 中的宏支持；DTE 允许访问更多 IDE 方法和变量
*   更新了 MFC 库（在 VS2008 Service Pack 1 中）
*   支持 OPENMP（简单多线程）（仅在 VS2008 pro 中。）

迁移到 Visual Studio 2008 的缺点：

*   IDE 比 VS6 慢很多
*   Intellisense 仍然存在性能问题（用 VisualAssistX 替换它会有所帮助）
*   并行程序集使应用程序部署更加成问题
*   本地（离线）MSD​​N 库速度极慢
*   如前所述[，](https://stackoverflow.com/questions/61669/profiling-in-visual-studio-2008-pro)专业版中没有分析器

* * *

本着 Joel 最近[博客文章](http://www.joelonsoftware.com/items/2008/09/15.html)的精神，我将发布的其他一些答案合并为一个答案（并将其设为社区拥有的帖子，因此我不会从中获得代表）。我希望你不要介意。非常感谢 Laur、NeARAZ、17 of 26、me.yahoo.com 以及其他所有回答的人。——克里斯N

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-15T12:40:47.440

嗯，一方面可能是因为使用 MSVS 6 构建的可执行文件只需要现在随 Windows 一起提供的 msvcrt.dll（C 运行时）。

MSVS 2008 可执行文件需要附带（或已安装）的 msvcrt9。

另外，你已经为 Windows 32 位使用 6.0 C 运行时编译了很多 OSS 库，而对于 2008 C 运行时，你必须获取源代码并自己编译它们。

（这些库中的大多数实际上是用 MinGW 编译的，它也使用 6.0 C 运行时——也许这是另一个原因）。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-15T13:30:29.817

我想补充一点，使用 Visual C++ 2008 开发的应用程序不一定需要比使用 Visual C++ 6.0 开发的应用程序更多的 DLL。这只是默认的项目配置。

如果您进入项目属性、C/C++、代码生成，然后将**运行时库**从 Multi-threaded DLL 和 Multi-threaded Debug DLL（发布和调试配置）更改为**Multi-threaded**和**Multi-threaded Debug**，您的应用程序应该然后有更少的依赖关系。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-15T13:33:00.653

在我的脑海中，新的 Visual Studio 的优点是：

*   更严格地遵守标准
*   支持 x64 / 移动 / XBOX 目标
*   更好的编译器优化
*   （方式）更好的模板处理
*   改进的调试器；运行远程调试会话的可能性
*   改进的 IDE
*   改进的宏支持；DTE 允许访问更多 IDE 方法和变量

缺点：

*   IDE似乎更慢
*   Intellisense 仍然存在性能问题（用 VisualAssistX 替换它会有所帮助）
*   运行时并非普遍可用
*   源代码控制集成达不到标准（尽管平心而论 VC6 完全缺乏此功能）

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-15T17:29:22.457

您知道 MS VC6 的 STL 实现不是线程安全的吗？特别是，即使在使用多线程库编译时，basic_string 中的引用计数优化也会崩溃。 [http://support.microsoft.com/kb/813810](http://support.microsoft.com/kb/813810)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-15T12:49:57.933

除了上面提到的部署，MSVC 6.0 的主要优势是速度。因为它是一个有 10 年历史的 IDE，所以在现代计算机上感觉相当快。较新版本的 Visual Studio 提供了更多高级功能，但它们是有代价的（复杂性和较慢的速度）。

但 MSVC 6.0 的最大缺点是其不兼容的 C++ 编译器和库。如果你打算做严肃的 C++ 编程，这是一个阻碍。如果您只构建 MFC 应用程序，这可能不是什么大问题。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-15T13:25:58.063

Visual C++ 6.0 与内存跟踪工具（如 Purify、HeapAgent、BoundsChecker 和 MemCheck）集成得非常好，因为这些内存跟踪工具在 Visual C++ 6.0 推出后得到积极维护和积极销售。

然而，由于 C++ 已经过时了一段时间，销售内存跟踪工具的公司仍在销售它们，但从未更新或将它们与新的 Visual C++ 版本（包括 Visual Studio 2008）集成。因此，在 Visual Studio 2008 中使用内存跟踪工具令人沮丧，容易出错，在某些情况下是不可能的。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-15T17:06:43.213

自从 VC6 以来，Visual Studio 的大部分重点都放在了 C# 和 .NET 以及其他特性上，所以一些 C++ 老前辈将 VC6 视为过去的美好时光。从那时起，C++ 开发人员在 Visual Studio 中的情况有所改进，但不如 .NET 用户那么显着。

VS2008 明显优于 VC6 的一种方式是它可以并行构建 C++ 项目。即使在单个 CPU 系统上，这也可以显着加快构建速度，尤其是在您有多个内核的情况下。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-08-11T03:29:49.747

如果您为 VS6 安装所有服务包，您仍然拥有可靠的 IDE/编译器组合。作为必须在野外（通过 Internet）发布产品的软件开发人员，我不想每次都发布 VC++ 运行时和 .NET 框架（我不能将它们直接捆绑在我的安装程序/可执行文件中，微软禁止）。你知道，几兆字节的运行时间来运行千字节的代码有点愚蠢。VC++ 6.0 最多只需要你的可执行文件和 2 个 .DLL。

此外，调试运行时不能与 VC++ .NET 一起分发，当我有一个需要对我的产品进行一些调试的客户端时，这并不是很好:)

在我看来，我仍然使用 VC++ 6.0 的主要原因是，但 IDE 本身很丑（即：不支持选项卡）。我通常通过使用代码块来绕过 IDE 限制（代码块支持所有 VC++ 版本的 CL.EXE/LINK.EXE）

科博富

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-15T12:42:27.980

Visual C++ 2008 更符合标准（Visual Studio 6 不支持 1998 年制定的 C++ 标准）。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-15T12:44:29.443

VS2008 有更好的编译器（更多的标准兼容，更好的优化，...）。

VS6 有更快的 IDE。VS2008 IDE 有很多不错的特性，但它比 VS6 慢一点。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-15T12:45:32.887

从 6.0 到 2008 的改进快速列表：

*   许多错误修复
*   更好地符合 C++ 标准
*   更好的编译器优化
*   改进的用户界面（更好的智能感知等）

人们有时会忘记的一件事是 VS 6.0 现在已经超过 10 年了！在这一点上，我看不出有人愿意坚持下去。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-09-15T13:06:56.300

我们遇到的一件棘手的事情是“价值”变成了一个关键词。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-12-18T21:54:22.670

与 2008 年相比，Visual C++ 6 有时会出现很多错误。特别是一些事情：

*   较差的模板支持/怪异（例如`sometemplate<othertemplate<t>>`不工作，但`sometemplate< othertemplate<t>`> 工作）
*   不符合标准
*   资源编辑器是垃圾（“蓝线”似乎随机移动，除其他外）
*   仅支持编辑某些类型的8位位图（我必须使用imagemagick转换保存在paint.net中的位图才能在图片资源中看到）
*   对使用只读文件/古怪的 sourcesafe 集成的糟糕支持。

有时在 VS6 中开发感觉就像试图让网站在 Internet Explorer 5.5 中看起来不错

# java - 中间件 API 的最佳实践是什么？

> ID：62398
> 
> 赞同：3
> 
> 时间：2008-09-15T12:37:03.017
> 
> 标签：java, c++, api, middleware

我们正在开发 C++ 和 Java 的中间件 SDK，供游戏开发人员、动画软件开发人员、Avatar 开发人员等用作库/DLL 以增强他们的产品。

我想知道的是：开发这些类型的 API 是否有标准的“最佳实践”？

我在考虑可用性、可读性、效率等方面。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-15T13:23:05.653

我最喜欢的两个关于这个主题的资源：http: [//mollyrocket.com/873](http://mollyrocket.com/873)和~~[http://video.google.com/videoplay?docid=-3733345136856180693](http://video.google.com/videoplay?docid=-3733345136856180693)~~

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-16T11:48:56.837

通过在 Windows 上使用第三方库，我学到了以下两件事：

尝试将您的库作为 DLL 而不是静态库分发。这为不同的 c 编译器和链接器提供了更好的兼容性。Visual c++ 中静态库的另一个问题是运行时库的选择会使库与使用不同运行时库的代码不兼容，您可能最终需要为每个运行时库分发一个版本的库。

尽可能避免使用 c++。不同编译器之间的 c++ 名称修饰差异很大，并且为 Visual c++ 构建的库不太可能从 windows 中的另一个构建环境链接。当涉及到 C 时，情况要好得多，特别是如果您使用 dll。

如果您真的想获得 c++ 的优点（例如通过构造函数和析构函数进行资源管理），请在 c++ 中构建一个便利层，将其作为隐藏 c 函数的源代码分发。由于用户拥有源代码并在本地编译它，因此本地环境不会出现任何名称修改或 abi 问题。

在不太了解从 Java 调用 c/c++ 代码的情况下，由于名称修饰问题，我希望使用 c 代码比使用 c++ 代码更容易。

“Imperfect C++”一书有一些关于库兼容性的讨论，我觉得很有帮助。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-15T14:31:51.727

yrp 提到的 Josh Bloch 的视频是经典之作 - 我支持该建议。

一些一般准则：

1.  请务必主要根据接口、工厂和构建器来定义您的 API。
2.  明确指定哪些包和类是 API 的一部分。
3.  请提供专门用于针对 API 进行编译的 jar。
4.  不要严重依赖继承或模板方法模式——随着时间的推移，它会变得脆弱和破碎。
5.  不要使用单例模式，或者至少要非常小心地使用它。
6.  请创建包和类级别的 javadoc 来解释用法和概念。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-15T12:43:11.787

有很多方法可以设计 api，具体取决于您要解决的问题。我认为这个问题的完整答案值得一整本书，例如[四模式书的帮派](https://rads.stackoverflow.com/amzn/click/com/0201633612)。特别是对于 Java，也只是一般的 OO 编程，我会推荐[Effective Java 2nd Edition](https://rads.stackoverflow.com/amzn/click/com/0321356683)。第一个是通用的和许多流行的编程模式，当它们适用时和它们的好处。有效的 Java 以 Java 为中心，但它的某些部分足够通用，可以应用于任何编程语言。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-15T13:13:49.013

看看[框架设计指南](https://rads.stackoverflow.com/amzn/click/com/0321246756)。我知道它是特定于 .NET 的，但您也可以从中学到很多一般信息。

# system-administration - 当站点进入社交书签/共享站点时，系统/网络管理员必须考虑哪些技术问题？

> ID：62403
> 
> 赞同：1
> 
> 时间：2008-09-15T12:37:48.243
> 
> 标签：system-administration

我问的原因是 Stack Overflow 已经被[Slashdotted](http://slashdot.org/firehose.pl?op=view&id=1170403)和[Redditted](http://www.reddit.com/r/programming/comments/71i4v/stack_overflow_launched_into_public/)。

首先，这对支持网站的服务器有什么影响？其次，系统管理员可以做些什么来确保他们的站点尽可能保持正常运行？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-15T12:47:58.920

不幸的是，如果您在它发生之前没有计划好，那么可能为时已晚，您的用户体验会很差。

可扩展性是您最关心的问题。您可能开始每秒获得的点击次数超过每月获得的点击次数。您的第一道防线是良好的编程和设计。确保您没有做任何愚蠢的事情，例如每个请求多次从数据库重新加载数据而不是缓存它。在峰值发生之前，您需要进行一些相当现实的负载测试以查看瓶颈在哪里。

对于高得离谱的流量，请考虑将一些动态页面切换到静态页面的能力。

拥有可扩展的服务器架构也有帮助。共享主机通常不会扩展。单个专用机器通常无法扩展。使用类似 Amazon 的 EC2 之类的东西来托管会有所帮助，特别是如果您从一开始就计划一个服务器集群（即使您的集群是单台计算机）。

您的下一个主要问题是安全性。你突然成为坏人更大的目标。确保您有一个良好的安全计划。这是您应该始终拥有的东西，但随着使用率的提高，它变得更加重要。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-15T12:48:21.837

**首先，询问您是否真的想花数周和数千美元来计划甚至可能不会发生的事情，如果确实发生了，则持续大约 5 个小时。**

最简单的解决方案是有一个很好的方法来切换到一个页面，只需允许注册。人们会注册，当风暴过去时，您可以通过电子邮件向他们发送电子邮件。

更精细的解决方案依赖于能够快速扩展。这首先是一个软件问题（你可以连接到另一台服务器上的数据库，你可以做负载平衡吗）。其次，您的托管解决方案需要支持快速扩展。想到了 Amazon EC2，或者可能是 slicehost。使用这两种服务，您可以轻松启动新实例（“让我们将数据库移动到不同的服务器”）并扩展您的实例（“让我们将数据库服务器升级到 4GB RAM”）。

如果您将所有数据（包括会话）保存在数据库中，您可以轻松拥有多个前端服务器。对于数据库，我通常会尝试使用可用资源最多的单个服务器，但这只是因为我没有使用过数据库复制，而且过去很难做到，至少使用 mysql。情况可能有所改善。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-15T12:51:07.180

应用程序设计人员需要考虑扩展（具有更多内核和更高性能的大型机器）和/或扩展（跨多个系统分配工作负载）。IT 人员需要弄清楚如何最好地支持这一点。网络是您首先看到的，因为显然一切都在它之上。从边界开始，这通常意味着网络负载平衡器和冗余路由器由多个提供商提供服务。您还可以查看地理缓存服务和应用程序，例如 cachefly。

你想尽可能地减少你的瓶颈。您还希望设计环境，使其可以根据需要进行横向扩展，而无需做太多工作。提前做好设计工作，当你得到挖掘时，这将意味着更少的头痛。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-15T13:15:17.467

一些想法（我在过去和当前项目中使用的）：为了提高性能（如果需要），您可以在服务器前面放置一个反向代理、缓存 squid。当然，只有当您没有会话密钥并且页面有些静态（意味着：它们每小时只更改一次左右）并且没有个性化时，这才有效。使用 squid，您可以提升像typo3 这样臃肿而缓慢的 CMS，从而拥有静态网站的性能和 CMS 的舒适度。

您可以将大型文件外包给 Amazon S3 等外部服务，从而节省服务器的带宽。

如果你能花一些（每月三位数）的钱，你也可以使用内容交付网络。有了这些，您就可以自动为您的用户提供可扩展性、高可用性和低延迟。当然，您的页面必须是可缓存的，因此会话密钥和个性化页面是禁止的。如果精心设计并考虑到 CDN，您至少可以缓存一些内容，例如图片和视频以及静态内容。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-15T14:52:50.303

正如其他答案所提到的，负载上升。

您还会从只对破坏行为真正感兴趣的无聊人那里获得大量新用户/博客评论/投票。对于允许完全匿名评论的博客来说，这主要是一个问题，其中将输入一些可怕的东西。博客平台可能有足以阻止它的垃圾邮件过滤器，但经常需要手动干预来清理剩余的乱码。

即使是一点点进入障碍，例如即使没有进行验证也需要用户名或电子邮件地址，也会大大减少破坏行为的数量。

# css - SAP Portal 中的替代样式（CSS）方法？

> ID：62406
> 
> 赞同：1
> 
> 时间：2008-09-15T12:39:06.337
> 
> 标签：css, sap-enterprise-portal

我在当前项目中覆盖了很多 SAP 的门户功能。我必须创建一个自定义的固定宽度框架、自定义 iView 托盘、自定义 KM API 功能等等。

对于所有这些自定义部件，我不会使用 SAP 的主题编辑器实现的大量样式功能。我想做的是创建一个外部 CSS，将它存储在 Portal 之外并引用它。与将 CSS 存储在门户应用程序中相比，在外部存储将使更新更容易。它还允许所有定制件在一个地方都有自己的样式。

不幸的是，我还没有找到一种方法来访问允许我插入外部样式表的页面的 HEAD 部分。门户应用程序可以使用 IResource 对象来访问内部引用，但不能访问其他服务器上的项目。

我正在寻找任何可以让我获得此功能的想法。我[在 SAP 的 SDN 上发布了 x-post](https://www.sdn.sap.com/irj/sdn/thread?threadID=1046064&tstart=0)，但我怀疑我会在这里得到更好的答案。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-15T14:24:52.867

我认为它很脏，但作为非 Portal 开发人员，我会考虑使用 JavaScript 在头部插入一个新的链接元素，指向您的新 CSS 文件。当然，您会看到一些未设置样式的内容，因为脚本可能要等到页面的一部分下载并呈现后才会运行，但它可能是一个足够的解决方案。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-15T19:37:03.960

我讨厌我回答自己的问题，但我确实找到了一个没有很好记录的潜在解决方案，并且在典型的 SAP 时尚中使用了已弃用的方法。所以这可能是一个比 Eric 建议的稍微不那么肮脏的黑客攻击。我是通过一个不相关的 SDN 论坛帖子找到的。

基本上，您深入到请求对象并收集 PortalNode。一旦你有了它，你就要求它提供一个 IPortalResponse 的值。此对象可以转换为 PortalHtmlResponse。该对象有一个不推荐使用的名为 getHtmlDocument 的方法。使用该方法，您可以使用一些 Html 镜像对象来获取头部并插入新链接。

样本：

```
IPortalNode node = request.getNode().getPortalNode();
IPortalResponse resp = (IPortalResponse) node.getValue(IPortalResponse.class.getName());
if (resp instanceof PortalHtmlResponse) {
    PortalHtmlResponse htmlResp = (PortalHtmlResponse) resp;
    HtmlDocument doc = htmlResp.getHtmlDocument();
    HtmlHead myHead = doc.getHead();
    HtmlLink cssLink = new HtmlLink("http://myserver.com/css/mycss.css");
    cssLink.setType("text/css");
    cssLink.setRel("stylesheet");
    myHead.addElement(cssLink);
} 
```

# java - 知道在 Windows 机器上要杀死哪个 java.exe 进程

> ID：62418
> 
> 赞同：48
> 
> 时间：2008-09-15T12:41:13.913
> 
> 标签：java, windows

当基于 java 的应用程序在 windows 机器上开始出现异常时，如果您无法正常退出应用程序，您希望能够在任务管理器中终止该进程。大多数时候，我的机器上运行着不止一个基于 java 的应用程序。有没有比随机杀死 java.exe 进程以希望您最终能找到正确的应用程序更好的方法？

**编辑：**感谢所有将我指向 Sysinternal 的 Process Explorer 的人——正是我正在寻找的东西！

* * *

## 回答 #1

> 赞同：56
> 
> 时间：2008-09-15T14:57:51.697

运行`jps -lv`显示所有正在运行的 Java 进程的 PID 和命令行。

确定要终止的任务的 PID。然后使用命令：

```
taskkill /PID <pid> 
```

杀死行为不端的进程。

* * *

## 回答 #2

> 赞同：33
> 
> 时间：2008-09-15T12:45:38.083

下载[Sysinternal 的 Process Explorer](http://technet.microsoft.com/en-us/sysinternals/bb896653.aspx)。它是一个比 Windows 自己的管理器更强大的任务管理器。

它的功能之一是您可以查看每个进程正在使用的所有资源（如注册表项、硬盘目录、命名管道等）。因此，浏览每个 java.exe 进程拥有的资源可能会帮助您确定要杀死的资源。我通常通过查找使用某个日志文件目录的那个来找出答案。

* * *

## 回答 #3

> 赞同：32
> 
> 时间：2010-08-17T16:11:37.720

如果您无法运行像 ProcessExplorer 这样的 GUI 应用程序并且您正在寻找进程的“命令行”参数，那么您可以通过命令行使用“wmic”。例如：

```
wmic PROCESS get Processid,Caption,Commandline 
```

如果你想寻找一个特定的过程，你可以这样做：

```
wmic PROCESS where "name like '%java%'" get Processid,Caption,Commandline 
```

其输出将向您显示“java”等进程的所有命令行参数。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-09-15T12:57:17.913

在 JDK 中使用 jps 将为您提供更多信息。使用 -m、-l 和 -v 选项显示更多信息。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-09-15T12:42:59.477

您是否尝试过使用 SysInternals 的 Process Explorer？它可以更好地了解流程中正在运行的内容。可在此处免费在线获取：[http ://technet.microsoft.com/en-us/sysinternals/bb896653.aspx](http://technet.microsoft.com/en-us/sysinternals/bb896653.aspx)

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2008-09-15T14:58:07.890

如果您使用的是 Java 6，请尝试`jvisualvm`从 JDK bin 目录。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-09-15T12:49:49.820

您可以尝试打开 Windows 任务管理器，转到“应用程序”选项卡，右键单击该应用程序，然后选择“转到进程”。这将自动突出显示“进程”选项卡中的相应进程。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-09-15T12:50:45.823

如果您正在开发软件：使用 java-launcher。我用于我的一些应用程序 [Exe4j][ [http://www.ej-technologies.com/products/exe4j/overview.html]](http://www.ej-technologies.com/products/exe4j/overview.html])并且效果很好。当应用程序启动时，它在 Windows 任务管理器中被列为例如“myserverapp.exe”或“myapp”。还有其他的 lauchers （不知道他们），其中很少有可能也是免费的。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-15T12:44:15.997

我建议从 Sysinternals 下载 Process Explorer 并更仔细地查看不同的 java.exe 进程，这样您就可以更好地了解要杀死哪个进程。

[http://technet.microsoft.com/en-us/sysinternals/bb896653.aspx](http://technet.microsoft.com/en-us/sysinternals/bb896653.aspx)

它非常直观，您可以找到 java.exe 进程并右键单击并转到它们的属性，从那里您可以看到它们的命令行、创建时间等，这可以帮助您找到要杀死的进程。

希望能帮助到你。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-15T12:44:45.247

使用[ProcessExplorer](http://technet.microsoft.com/en-us/sysinternals/bb896653.aspx)并将鼠标悬停在 Java 进程上将显示命令行。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-09-15T12:50:45.713

如果应用程序根本没有响应，那么 Process Explorer 是一个不错的选择。

如果它有点响应，但没有死，有时会调出任务管理器，然后在 java 进程上移动另一个对话框会给你一个线索。占用 cpu 周期来重绘的 java 进程是您正在寻找的进程。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-09-15T14:12:17.000

如果您大致知道系统上的各种 Java 进程是什么，那么您也可以通过查看任务管理器中的所有列来做出很好的猜测，而不是使用第三方工具。在 Processes 选项卡中，使用 View-> Select Columns 并添加 PID、CPU Time、VM Size 和 Thread count。大致了解流程在做什么应该有助于缩小范围。

例如，在客户端-服务器应用程序中，服务器可能会使用更多内存、拥有更多线程并使用更多 CPU 时间，因为它运行的时间更长。如果您因为一个进程被卡住而杀死它，那么它现在*可能*只是在使用更多的 CPU。

MAX java heap memory 通常直接反映在 VM Size 中。因此，如果您使用 -Xmx 标志，则具有较大设置的进程将具有较大的 VM 大小。

# java - 如何更新大型 XML 文件

> ID：62423
> 
> 赞同：6
> 
> 时间：2008-09-15T12:41:59.573
> 
> 标签：java, xml

不是在更新单个元素时重写 xml 文件的全部内容，有没有更好的替代方法来更新文件？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-15T12:46:12.467

我建议使用 VTD-XML [http://vtd-xml.sourceforge.net/](http://vtd-xml.sourceforge.net/)

从他们的常见问题解答（[http://vtd-xml.sourceforge.net/faq.html](http://vtd-xml.sourceforge.net/faq.html)）：

> 为什么要对大型 XML 文件使用 VTD-XML？
> 
> 出于多种原因，总结如下：
> 
> *   性能：VTD-XML 的性能远优于 SAX
> *   易于使用：随机访问结合 XPath 使应用程序易于编写
> *   更好的可维护性：应用程序代码更短且更易于理解。
> *   增量更新：偶尔的小改动变得非常有效。
> *   索引：XML 的预解析形式将进一步提高处理性能。
> *   其他功能：只有使用 VTD-XML 才能剪切、粘贴、拆分和组装 XML 文档。
> 
> 为了利用 VTD-XML，我们建议开发人员将他们的超大型 XML 文档拆分成更小、更易于管理的文件 (<2GB)。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-15T16:53:25.960

如果您的 XML 文件太大以至于更新它是性能瓶颈，您应该考虑从 XML 转移到更高效的磁盘格式（或真正的数据库）。

但是，如果您只是*觉得*这可能是个问题，请记住优化规则：

1.  不要这样做
2.  （仅限专家）暂时不要这样做。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-15T12:47:41.307

您在这里有几个选择，但没有一个是好的。

由于 XML 对象没有分成不同的部分，因此您要么必须使用一些文件系统级别的修改和正则表达式模式匹配（sed 是一个好的开始），要么您应该将 xml 分成更小的部分以便于管理。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-15T12:53:39.547

如果可能，序列化 XML 并使用 diff/patch/apply Linux 工具（或您平台中的等效工具）。这样，您就不必处理解析、写入。

* * *

## 回答 #5

> 赞同：-4
> 
> 时间：2008-09-22T13:19:40.147

**使用 XQuery 处理大型 XML 文件 适用于千兆字节大小的 XML 文件** [http://www.xquery.com](http://www.xquery.com)

XQuery 是一种被设计为原生 XML 查询语言的查询语言。因为大多数类型的数据都可以表示为 XML，所以 XQuery 也可以用于查询其他类型的数据。例如，XQuery 可用于使用关系数据库的 XML 视图查询关系数据。这很重要，因为许多 Internet 应用程序需要集成来自多个源的信息，包括 Web 消息中的数据、关系数据和各种 XML 源。XQuery 是专门为这种数据集成而设计的。

例如，假设您的公司是一家金融机构，需要为每个客户生成股票持有报告。客户端请求带有简单对象访问协议 (SOAP) 消息的报告，该消息以 XML 表示。在大多数企业中，持股数据存储在多个关系数据库中，例如 Oracle、Microsoft SQL Server 或 DB2。XQuery 可以查询 SOAP 消息和关系数据库，以 XML 格式创建报告。

XQuery 基于 XML 的结构，并利用该结构可以对可以表示为 XML 的任何类型的数据（包括关系数据）执行查询。此外，XQuery API for Java (XQJ) 允许您的查询在任何支持 J2EE 平台的环境中运行。

# regex - 拒绝所有输入的正则表达式？

> ID：62430
> 
> 赞同：11
> 
> 时间：2008-09-15T12:42:53.067
> 
> 标签：regex

是否可以构造一个拒绝所有输入字符串的正则表达式？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-15T12:47:14.117

大概是这样的：

```
[^\w\W] 
```

\w - 单词字符（字母、数字等）
\W - 与 \w 相反

[^\w\W] - 应该总是失败，因为任何字符都应该属于字符类之一 - \w 或 \W

另一个片段：

```
$.^ 
```

$ - 断言在字符串末尾的
位置 ^ - 断言在行首的位置
。- 任何字符

```
(?#it's just a comment inside of empty regex) 
```

空的前瞻/后视应该可以工作：

```
(?<!) 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-17T02:28:27.253

拒绝所有输入的*最佳*标准正则表达式（即无前瞻或后向引用）是（在上面的@aku 之后）

```
.^ 
```

和

```
$. 
```

这些是明显的矛盾：“一个字符串在其开头之前有一个字符”和“一个字符串在其结尾之后有一个字符”。

注意：某些正则表达式实现可能会将这些模式拒绝为格式错误（很容易检查`^`模式的开头和`$`结尾......使用正则表达式），但我检查过的少数接受他们。`^`这些在允许和`$`匹配换行符的实现中也不起作用。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-15T12:56:42.470

```
(?=not)possible 
```

?= 是一个积极的前瞻。并非所有 regexp 风格都支持它们，但在许多风格中都支持它们。

该表达式将查找“not”，然后从同一位置开始查找“possible”（因为前瞻不会在字符串中向前移动）。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-15T15:24:05.487

为什么可能需要这种事情的一个例子是，当您想使用正则表达式过滤某些输入并将正则表达式作为参数传递给函数时。

本着函数式编程的精神，为了代数完整性，您可能需要一些琐碎的主要正则表达式，例如“允许一切”和“不允许一切”。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-15T12:47:05.990

为什么你甚至想要那个？一个简单的 if 语句就不能解决问题吗？类似于以下内容：

```
if ( inputString != "" )
  doSomething () 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-15T13:16:04.110

对我来说，这听起来像是您以错误的方式解决问题，您到底想解决什么？

您可以做一个正则表达式来捕获所有内容并否定结果。

例如在javascript中：

```
if (! str.match( /./ )) 
```

但是你可以这样做

```
if (!foo) 
```

相反，正如@[jan-hani] 所说。

如果您希望在另一个正则表达式中嵌入这样的正则表达式，您可能正在寻找*$*或*^*，或者使用提到的@[henrik-n] 之类的前瞻。

但正如我所说，这看起来像是一个“我认为我需要 x，但我真正需要的是 y”的问题。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-15T12:49:10.413

[^\x00-\xFF]

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-15T13:32:01.450

这取决于您所说的“正则表达式”是什么意思。您是指特定编程语言或库中的正则表达式吗？在这种情况下，答案可能是肯定的，您可以参考上述任何回复。

如果您指的是计算机科学课程中教授的正则表达式，那么答案是否定的。每个正则表达式都匹配某个字符串。它可能是空字符串，但它总是匹配*something*。

无论如何，我建议您编辑问题的标题以缩小您所指的正则表达式的范围。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-16T07:16:29.503

`[^]+`应该这样做。

为了回答 aku 对此的评论，我使用在线正则表达式测试器 ( [http://www.regextester.com/](http://www.regextester.com/) ) 对其进行了测试，因此假设它适用于 JavaScript。我不得不承认没有在“真实”代码中对其进行测试。;)

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2008-09-15T12:43:48.010

编辑：[^\n\r\w\s]

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2008-09-15T12:49:59.913

好，

我不确定我是否理解，因为我一直想用正则表达式来匹配字符串。我想说你最好的方法是不使用正则表达式。

但是，您也可以使用匹配空行`^$`的正则表达式或不匹配单词/空格的正则表达式`[^\w\s]`...

希望能帮助到你！

# java - 如何用 Java 编写 Facebook 应用程序？

> ID：62433
> 
> 赞同：7
> 
> 时间：2008-09-15T12:43:08.197
> 
> 标签：java, facebook, api

我徒劳地寻找了一个很好的例子或起点来编写一个基于 java 的 facebook 应用程序......我希望这里有人会知道一个。同样，我听说 facebook 将不再支持他们的 java API，这是真的吗？如果是，这是否意味着我们不应该再使用 java 来编写 facebook 应用程序？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-15T12:50:04.843

根据他们的[开发者维基](http://developers.facebook.com/blog/post/106)，Facebook 于 2008 年 5 月 5 日停止支持官方 Java API 。

这绝不意味着您不应该再使用 Java 来编写 FB 应用程序。wiki 上列出了几种可供选择的 Java 方法。

您可能还想检查[这个项目](http://code.google.com/p/facebook-java-webapp/)；然而，它只是在几天前才出来，所以 YMMV。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-15T12:55:39.900

有一个社区项目旨在使 Facebook Java API 保持最新，使用旧的官方 Facebook 代码作为起点。

[您可以在此处找到它](http://code.google.com/p/facebook-java-api/)以及入门指南和一些示例代码。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-13T12:11:11.037

[我使用 facebook java api](http://programmaremobile.blogspot.com/2009/01/facebook-java-apieng.html)编写了一个示例 它使用 FacebookXmlRestClient 来发出客户端请求并打印所有用户信息 [http://programmaremobile.blogspot.com/2009/01/facebook-java-apieng.html](http://programmaremobile.blogspot.com/2009/01/facebook-java-apieng.html)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-09-14T04:39:49.190

BatchFB 提供了一个现代 Java API，让您可以轻松地将 Facebook 调用优化到最低限度：

[http://code.google.com/p/batchfb/](http://code.google.com/p/batchfb/)

以下是您可以在单个 FB 请求中有效执行的操作的主页示例：

```
/** You write your own Jackson user mapping for the pieces you care about */
public class User {
    long uid;
    @JsonProperty("first_name") String firstName;
    String pic_square;
    String timezone;
}

Batcher batcher = new FacebookBatcher(accessToken);

Later<User> me = batcher.graph("me", User.class);
Later<User> mark = batcher.graph("markzuckerberg", User.class);
Later<List<User>> myFriends = batcher.query(
    "SELECT uid, first_name, pic_square FROM user WHERE uid IN" +
    "(SELECT uid2 FROM friend WHERE uid1 = " + myId + ")", User.class);
Later<User> bob = batcher.queryFirst("SELECT timezone FROM user WHERE uid = " + bobsId, User.class);
PagedLater<Post> feed = batcher.paged("me/feed", Post.class);

// No calls to Facebook have been made yet.  The following get() will execute the
// whole batch as a single Facebook call.
String timezone = bob.get().timezone;

// You can just get simple values forcing immediate execution of the batch at any time.
User ivan = batcher.graph("ivan", User.class).get(); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-08-24T21:59:11.663

You might want to try [Spring Social](http://www.springsource.org/spring-social). It might be limited in terms of Facebook features, but lets you also connect to Twitter, LinkedIn, TripIt, GitHub, and Gowalla.

The other side of things is that as Facebook adds features some of the old API's might break, so using a simpler pure FB api (that you can update when things don't work) might be a good idea.

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-04-05T00:02:39.560

This tutorial will literally step you through everything you need to do: [http://ocpsoft.org/opensource/creating-a-facebook-app-setup-and-tool-installation/](http://ocpsoft.org/opensource/creating-a-facebook-app-setup-and-tool-installation/)

It comes in 3 parts. The other 2 are linked from there.

# devexpress - DevExpress eXpressApp Framework (XAF) 和 eXpress Persistent Objects (XPO)：如何加快关联的加载时间？

> ID：62436
> 
> 赞同：3
> 
> 时间：2008-09-15T12:43:28.667
> 
> 标签：devexpress, xpo, xaf

我在访问具有大量记录的关联属性时遇到了问题。

我有一个 XAF 应用程序，其父类名为`MyParent`.

中有 230 条记录`MyParent`。

`MyParent`有一个名为`MyChild`.

中有 49,000 条记录`MyChild`。

我在标准方式`MyParent`之间定义了一个关联：`MyChild`

在`MyChild`：

```
// MyChild (many) and MyParent (one)
[Association("MyChild-MyParent")]
public MyParent MyParent; 
```

并在`MyParent`：

```
[Association("MyChild-MyParent", typeof(MyChild))]
public XPCollection<MyCHild> MyCHildren
{
     get { return GetCollection<MyCHild>("MyCHildren"); }
} 
```

有一个特定的`MyParent`记录叫做`MyParent1`.

对于`MyParent1`，有 630`MyChild`条记录。

我有一个名为`MyUI`.

用户在 DetailView 的一个下拉列表中选择一个项目`MyUI`，而我的代码必须用对象填充另一个下拉列表`MyChild`。

用户`MyParent1`在第一个下拉菜单中进行选择。

我创建了一个属性`MyUI`来返回`MyChild`第一个下拉列表中所选值的对象集合。

这是该属性的代码：

```
[NonPersistent]
public XPCollection<MyChild> DisplayedValues
{
    get
    {
        Session theSession;
        MyParent theParentValue;
        XPCollection<MyCHild> theChildren;

        theParentValue = this.DropDownOne;
        // get the parent value

        if theValue == null)
        {
            // if none

            return null;
            // return null
        }

        theChildren = theParentValue.MyChildren;
        // get the child values for the parent

        return theChildren;
        // return it
    } 
```

`DisplayedValues`我将该属性标记为，`NonPersistent`因为它只需要 DetailVIew 的 UI。我不认为第一次持久化它会加快集合的创建，在它用于填充下拉列表之后，我不需要它，所以我不想花时间存储它。

问题是调用需要 45 秒`theParentValue = this.DropDownOne`。

眼镜：

*   远景商务
*   8 GB 内存
*   2.33 GHz E6550 处理器
*   SQL Server 速成版 2005

这对于用户来说等待 DetailView 中的许多下拉菜单之一太长了。

我花时间草拟商业案例，因为我有两个问题：

1.  如何使关联的值加载更快？

2.  是否有另一种（简单）方法可以对运行速度更快的下拉菜单和 DetailView 进行编程？

是的，您可以说 630 项太多，无法在下拉列表中显示，但是这段代码需要很长时间，我怀疑速度与 49,000 成正比，而不是与 630 成正比。下拉列表中的 100 项将我的应用程序不会太多。

我的应用程序中需要很多这样的下拉菜单，因此不适合强制用户为每个下拉菜单输入更复杂的过滤条件。用户需要选择一个值并查看相关值。

如果查找大量记录很慢，我会理解，但查找几百条记录不应该花那么长时间。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-16T22:50:20.837

首先，您对这个操作应该花费这么长时间持怀疑态度是正确的，读取操作上的 XPO 应该只增加 30 - 70% 的开销，而且在这么少量的数据上，我们应该说毫秒而不是秒。

DevExpress 论坛中提供了一些通用性能提示，并以对象缓存、延迟加载与深度加载等为中心，但我认为在您的情况下，问题是其他问题，不幸的是，很难从您的问题中猜测发生了什么，只有也就是说，它不太可能是 XPO 的问题，更可能是其他问题，我倾向于查看您的会话创建（这也会创建您的对象缓存）和 SQL 连接代码（IDataStore 的东西），连接是如果主机不能被干净地解决，并且如果您没有汇集/重用连接，则通常会很慢，这个问题可能会加剧。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-07-23T04:43:57.877

我不确定你为什么会这样。如果您创建了这样的关联：

```
public class A : XPObject
{
    [Association("a<b", typeof(b))]
    public XPCollection<b> bs { get { GetCollection("bs"); } }
}

public class B : XPObject
{
    [Association("a<b") Persistent("Aid")]
    public A a { get; set; }
} 
```

然后当您想要填充下拉列表时（如 lookupEdit 控件）

```
A myA = GetSomeParticularA();
lupAsBs.Properties.DataSource = myA.Bs;
lupAsBs.Properties.DisplayMember = "WhateverPropertyName"; 
```

您不必加载 A 的孩子，XPO 会在需要时加载它们，并且根本不需要会话管理。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-18T10:52:21.060

感谢你的回答。正如您所建议的，我创建了一个单独的解决方案并且能够获得良好的性能。

我的 SQL 连接正常，可与应用程序中的其他功能配合使用。

鉴于我正在使用 XAF 而没有做任何额外/花哨的事情，我的会话不是由 XAF 管理的吗？

我使用的会话是从 DetailView 中读取的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-08-13T07:13:21.300

我不确定你的情况，只是想分享一些我对 XAF 的经验。

第一次单击下拉（查找列表）控件（在详细视图中）时，将有两个查询发送到数据库以填充列表。在我的测试中，有时整个对象都被加载到源集合中，而不仅仅是我们认为的 ID 和 Name 属性，这取决于您的对象，您可能希望将较轻的对象用于列表。您也可以打开列表的服务器模式，然后每次只加载 128 个对象。

# apache-flex - 如何防止 Flash 的 URLRequest 转义 url？

> ID：62437
> 
> 赞同：4
> 
> 时间：2008-09-15T12:43:39.040
> 
> 标签：apache-flex, flash, urlrequest

我从我的 Flex 应用程序的 servlet 加载一些 XML，如下所示：

```
_loader = new URLLoader();
_loader.load(new URLRequest(_servletURL+"?do=load&id="+_id)); 
```

正如你可以想象`_servletURL`的那样是[http://foo.bar/path/to/servlet](http://foo.bar/path/to/servlet)

在某些情况下，此 URL 包含重音字符（长篇大论）。我将`unescaped`字符串传递给`URLRequest`，但似乎 flash 对其进行了转义并调用了转义的 URL，这是无效的。想法？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-17T20:49:48.947

我的朋友路易斯想通了：

您应该使用 encodeURI 进行 UTF8URL 编码 [http://livedocs.adobe.com/flex/3/langref/package.html#encodeURI()](http://livedocs.adobe.com/flex/3/langref/package.html#encodeURI())

但不是 unescape，因为它不会转义为 ASCII，请参见 [http://livedocs.adobe.com/flex/3/langref/package.html#unescape()](http://livedocs.adobe.com/flex/3/langref/package.html#unescape())

我认为这就是我们在 URL 中得到 %E9 而不是预期的 %C3%A9 的地方。

[http://www.w3schools.com/TAGS/ref_urlencode.asp](http://www.w3schools.com/TAGS/ref_urlencode.asp)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-15T12:50:52.983

我不确定这是否会有所不同，但这是实现相同 URLRequest 的一种更简洁的方法：

```
var request:URLRequest = new URLRequest(_servletURL)
request.method = URLRequestMethod.GET;
var reqData:Object = new Object();

reqData.do = "load";
reqData.id = _id;
request.data = reqData;

_loader = new URLLoader(request); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-15T13:44:47.193

来自 livedocs： http: [//livedocs.adobe.com/flex/3/langref/flash/net/URLRequest.html](http://livedocs.adobe.com/flex/3/langref/flash/net/URLRequest.html)

> 创建一个 URLRequest 对象。如果 System.useCodePage 为 true，则使用系统代码页而不是 Unicode 对请求进行编码。如果 System.useCodePage 为 false，则使用 Unicode 而不是系统代码页对请求进行编码。

此页面有更多信息： http://livedocs.adobe.com/flex/3/html/help.html?content= [18_Client_System_Environment_3.html](http://livedocs.adobe.com/flex/3/html/help.html?content=18_Client_System_Environment_3.html)

但基本上你只需要将它添加到将在 URLRequest 之前运行的函数中（我可能会将它放在 creationComplete 事件中）

`System.useCodePage = false`;

# java - tomcat5 无法在 CentOS 5 上启动，出现 NoClassDefFoundError 异常

> ID：62447
> 
> 赞同：0
> 
> 时间：2008-09-15T12:44:44.060
> 
> 标签：java, tomcat, centos

即使我从 WEBAPPS 目录中删除所有应用程序，Tomcat 也无法启动，而一切都像安装操作系统后一样。

日志（catalina.out）说：

```
Using CATALINA_BASE:   /usr/share/tomcat5
Using CATALINA_HOME:   /usr/share/tomcat5
Using CATALINA_TMPDIR: /usr/share/tomcat5/temp
Using JRE_HOME:       
Created MBeanServer with ID: -dpv07y:fl4s82vl.0:hydrogenium.timberlinecolorado.com:1
java.lang.NoClassDefFoundError: org.apache.catalina.core.StandardService
   at java.lang.Class.initializeClass(libgcj.so.7rh)
   at java.lang.Class.initializeClass(libgcj.so.7rh)
   at java.lang.Class.initializeClass(libgcj.so.7rh)
   at java.lang.Class.newInstance(libgcj.so.7rh)
   at org.apache.catalina.startup.Bootstrap.init(bootstrap.jar.so)
   at org.apache.catalina.startup.Bootstrap.main(bootstrap.jar.so)
Caused by: java.lang.ClassNotFoundException: org.apache.commons.modeler.Registry not found in org.apache.catalina.loader.StandardClassLoader{urls=[file:/var/lib/tomcat5/server/classes/,file:/usr/share/java/tomcat5/catalina-cluster-5.5.23.jar,file:/usr/share/java/tomcat5/catalina-storeconfig-5.5.23.jar,file:/usr/share/java/tomcat5/catalina-optional-5.5.23.jar,file:/usr/share/java/tomcat5/tomcat-coyote-5.5.23.jar,file:/usr/share/java/tomcat5/tomcat-jkstatus-ant-5.5.23.jar,file:/usr/share/java/tomcat5/tomcat-ajp-5.5.23.jar,file:/usr/share/java/tomcat5/servlets-default-5.5.23.jar,file:/usr/share/java/tomcat5/servlets-invoker-5.5.23.jar,file:/usr/share/java/tomcat5/catalina-ant-jmx-5.5.23.jar,file:/usr/share/java/tomcat5/tomcat-http-5.5.23.jar,file:/usr/share/java/tomcat5/tomcat-util-5.5.23.jar,file:/usr/share/java/tomcat5/tomcat-apr-5.5.23.jar,file:/usr/share/eclipse/plugins/org.eclipse.jdt.core_3.2.1.v_677_R32x.jar,file:/usr/share/java/tomcat5/servlets-webdav-5.5.23.jar,file:/usr/share/java/tomcat5/catalina-5.5.23.jar], parent=org.apache.catalina.loader.StandardClassLoader{urls=[file:/var/lib/tomcat5/common/classes/,file:/var/lib/tomcat5/common/i18n/tomcat-i18n-ja.jar,file:/var/lib/tomcat5/common/i18n/tomcat-i18n-fr.jar,file:/var/lib/tomcat5/common/i18n/tomcat-i18n-en.jar,file:/var/lib/tomcat5/common/i18n/tomcat-i18n-es.jar,file:/usr/share/java/tomcat5/naming-resources-5.5.23.jar,file:/usr/share/eclipse/plugins/org.eclipse.jdt.core_3.2.1.v_677_R32x.jar,file:/usr/share/java/tomcat5/naming-factory-5.5.23.jar], parent=gnu.gcj.runtime.SystemClassLoader{urls=[file:/usr/lib/jvm/java/lib/tools.jar,file:/usr/share/tomcat5/bin/bootstrap.jar,file:/usr/share/tomcat5/bin/commons-logging-api.jar,file:/usr/share/java/mx4j/mx4j-impl.jar,file:/usr/share/java/mx4j/mx4j-jmx.jar], parent=gnu.gcj.runtime.ExtensionClassLoader{urls=[], parent=null}}}}
   at java.net.URLClassLoader.findClass(libgcj.so.7rh)
   at java.lang.ClassLoader.loadClass(libgcj.so.7rh)
   at java.lang.ClassLoader.loadClass(libgcj.so.7rh)
   at java.lang.Class.initializeClass(libgcj.so.7rh)
   ...5 more 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-15T17:21:52.037

似乎您已经实现了 JMX 服务并尝试将其安装在 server.xml 文件中，但忘记将 apache commons modeler jar 添加到 server/lib 目录（因此为`ClassNotFoundException`for `org.apache.commons.modeler.Registry`）。检查您的 server.xml 文件是否有您可能添加的任何内容，并尝试将正确的 jar 文件添加到您的服务器类路径中。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-11T09:20:32.677

似乎您需要将 commons-modeler 的 jar 放入`$CATALINA_HOME/common/lib`. 如果您没有将驱动程序的 jar 文件放入 tomcat 的服务器类路径，则在尝试设置 JDBC 数据源时会出现相同类型的错误。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-15T12:48:05.410

对我来说，这尖叫着班级路径问题。你的tomcat到底安装在哪里？（给我们主目录在哪里的命令行打印输出。）另外，你是如何启动它的？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-15T12:56:33.423

检查您的`JAVA_HOME/JRE_HOME`设置。您可能希望使用不同的 JVM，而不是随操作系统安装的 JVM

# .net - 如何在 .NET 中的线程上传播 tcplistener 传入连接？

> ID：62449
> 
> 赞同：15
> 
> 时间：2008-09-15T12:44:48.240
> 
> 标签：.net, multithreading, tcplistener

使用 Net.Sockets.TcpListener 时，在单独的线程中处理传入连接 (.AcceptSocket) 的最佳方法是什么？

这个想法是在接受新的传入连接时启动一个新线程，而 tcplistener 然后保持可用于进一步的传入连接（并且为每个新传入连接创建一个新线程）。与发起连接的客户端的所有通信和终止都将在线程中处理。

VB.NET 代码的示例 C# 表示赞赏。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-10-29T14:54:22.593

我一直在使用的代码如下所示：

```
class Server
{
  private AutoResetEvent connectionWaitHandle = new AutoResetEvent(false);

  public void Start()
  {
    TcpListener listener = new TcpListener(IPAddress.Any, 5555);
    listener.Start();

    while(true)
    {
      IAsyncResult result =  listener.BeginAcceptTcpClient(HandleAsyncConnection, listener);
      connectionWaitHandle.WaitOne(); // Wait until a client has begun handling an event
      connectionWaitHandle.Reset(); // Reset wait handle or the loop goes as fast as it can (after first request)
    }
  }

  private void HandleAsyncConnection(IAsyncResult result)
  {
    TcpListener listener = (TcpListener)result.AsyncState;
    TcpClient client = listener.EndAcceptTcpClient(result);
    connectionWaitHandle.Set(); //Inform the main thread this connection is now handled

    //... Use your TcpClient here

    client.Close();
  }
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-15T13:22:00.680

我相信您的操作方式与 .NET 中的任何其他异步操作相同：您调用该方法的 BeginXxx 版本，在本例中为 BeginAcceptSocket。您的回调将在线程池上执行。

池化线程的扩展性通常比每个连接的线程好得多：一旦超过几十个连接，系统在线程之间切换的工作比完成实际工作要困难得多。此外，每个线程都有自己的堆栈，通常大小为 1MB（尽管它取决于链接标志），必须在 2GB 虚拟地址空间（在 32 位系统上）中找到；实际上，这将您限制为少于 1000 个线程。

我不确定 .NET 的线程池当前是否使用它，但 Windows 有一个称为 I/O 完成端口的内核对象，它有助于可扩展的 I/O。您可以将线程与此对象关联，并且 I/O 请求（包括接受传入连接）可以与它关联。当 I/O 完成（例如连接到达）时，Windows 将释放等待线程，但前提是当前可运行线程的数量（由于其他原因未阻塞）小于为完成端口配置的可伸缩性限制。通常，您会将其设置为内核数量的一小部分。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-20T17:10:51.450

我想提出一种不同的方法：我的建议只使用两个线程。* 一个线程检查传入的连接。* 当一个新连接打开时，此信息将写入一个共享数据结构，该结构包含所有当前打开的连接。* 第二个线程枚举该数据结构，并为每个打开的连接接收发送的数据并发送回复。

该解决方案在线程方面更具可扩展性，如果正确实施应该具有更好的性能，然后为每个打开的连接打开一个新线程。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-15T12:54:50.167

O'Reilly C# 3.0 Cookbook 中有一个很好的例子。您可以从以下位置下载随附的源代码[`http://examples.oreilly.com/9780596516109/CSharp3_0CookbookCodeRTM.zip`](http://examples.oreilly.com/9780596516109/CSharp3_0CookbookCodeRTM.zip)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-15T12:47:43.490

我会使用线程池，这样你就不必每次都启动一个新线程（因为这有点贵）。我也不会无限期地等待更多的连接，因为客户端可能不会关闭他们的连接。您打算如何每次将客户端路由到同一个线程？

对不起，没有样品。

# php - 任何支持 5.3 语法的 PHP 编辑器？

> ID：62472
> 
> 赞同：4
> 
> 时间：2008-09-15T12:46:59.453
> 
> 标签：php, ide

我在项目中使用命名空间，而我选择的 IDE Eclipse PDT 将它们识别为语法错误。它不仅使方便的错误检查无法使用，而且还破坏了 Eclipse 的 PHP 资源管理器。

5.3 功能即将在计划于 12 月发布的 PDT 2.0 中推出。目前有没有其他选择？我至少在寻找 5.3 语法高亮和错误检查。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-15T14:25:37.547

各种 PHP IDE 开发人员已针对 5.3 语法支持的状态解决了一些线程：

*   **PHPEclipse**：[http](http://www.phpeclipse.net/ticket/636) ://www.phpeclipse.net/ticket/636或[谷歌](http://www.google.com.au/search?q=php+5.3+phpeclipse)
*   **Aptana**：[http](http://forums.aptana.com/viewtopic.php?t=6538) ://forums.aptana.com/viewtopic.php?t=6538或[谷歌](http://www.google.com.au/search?q=php+5.3+aptana)
*   **PDT**：[http](http://bugs.eclipse.org/bugs/show_bug.cgi?id=234938) ://bugs.eclipse.org/bugs/show_bug.cgi?id=234938或[谷歌](http://www.google.com.au/search?q=php+pdt+5.3)
*   **TextMate**： http: [//www.nabble.com/PHP-Namespace-Support-td19784898.html](http://www.nabble.com/PHP-Namespace-Support-td19784898.html)（命名空间支持）或[谷歌](http://www.google.com.au/search?q=php+pdt+5.3)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-14T08:25:54.887

该[博客](http://spektom.blogspot.com/2009/03/php-53-support-in-pdt-2nd-stage-is-over.html)指出，PHP 5.3 支持已经出现在PDT 2.1.0的[最新集成中。](http://www.eclipse.org/pdt/downloads/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-09-25T20:33:26.047

NuSphere ( [http://www.nusphere.com/](http://www.nusphere.com/) ) 刚刚发布了完全支持所有 php-5.3 功能的 PhpED。对我很有用。

-j

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-09-25T20:43:39.717

最新版本的 netbeans 6.8(beta) 确实支持大部分新功能...

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-01-11T12:46:39.760

我发现 JetBrains phpstorm 相当不错。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-15T12:55:08.840

您是否尝试过 Aptana Studio 或 Eclipse 的 Aptana 插件？我不确定 Aptana 插件是否支持 PHP，但 Aptana Studio 支持。那可能有你正在寻找的东西。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-16T13:59:30.860

它可能不会真正帮助您，但我当前的解决方案是 Zend Studio 5.5，禁用了实时错误。我无法在 5.3 项目上使用内部调试器，但 IDE 中的其他所有内容仍然有效，并且命名空间代码未突出显示为错误。我可以保持代码浏览器和语法突出显示，并在 IDE 外部测试我的代码。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-09-25T20:35:00.563

jEdit [http://jedit.org](http://jedit.org)

# java - 如何让 Axis 1.4 不为同一个 XML 命名空间生成多个前缀？

> ID：62490
> 
> 赞同：6
> 
> 时间：2008-09-15T12:48:18.590
> 
> 标签：java, xml, soap, namespaces, axis

我从使用 Axis 1.4 库的客户端接收 SOAP 请求。请求具有以下形式：

```
<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" 
                  xmlns:xsd="http://www.w3.org/2001/XMLSchema" 
                  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <soapenv:Body>
    <PlaceOrderRequest xmlns="http://example.com/schema/order/request">
      <order>
        <ns1:requestParameter xmlns:ns1="http://example.com/schema/common/request">
          <ns1:orderingSystemWithDomain>
            <ns1:orderingSystem>Internet</ns1:orderingSystem>
            <ns1:domainSign>2</ns1:domainSign>
          </ns1:orderingSystemWithDomain>
        </ns1:requestParameter>
        <ns2:directDeliveryAddress ns2:addressType="0" ns2:index="1" 
                                   xmlns:ns2="http://example.com/schema/order/request">
          <ns3:address xmlns:ns3="http://example.com/schema/common/request">
            <ns4:zipcode xmlns:ns4="http://example.com/schema/common">12345</ns4:zipcode>
            <ns5:city xmlns:ns5="http://example.com/schema/common">City</ns5:city>
            <ns6:street xmlns:ns6="http://example.com/schema/common">Street</ns6:street>
            <ns7:houseNum xmlns:ns7="http://example.com/schema/common">1</ns7:houseNum>
            <ns8:country xmlns:ns8="http://example.com/schema/common">XX</ns8:country>
          </ns3:address>
[...] 
```

如您所见，为同一个命名空间定义了多个前缀，例如命名空间[http://example.com/schema/common](http://example.com/schema/common)具有前缀 ns4、ns5、ns6、ns7 和 ns8。一些长请求为同一个命名空间定义了数百个前缀。

这会导致我用来转换请求的[Saxon XSLT 处理器出现问题。](http://saxon.sourceforge.net/)Saxon 将同一命名空间的不同前缀的数量限制为 255，并在您定义更多前缀时引发异常。

Axis 1.4 是否可以配置为定义更智能的前缀，以便每个命名空间只有一个前缀？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-07T17:22:14.010

我有同样的问题。目前，我通过编写 BasicHandler 扩展来解决它，然后自己遍历 SOAPPart 并将名称空间引用向上移动到父节点。我不*喜欢*这个解决方案，但它似乎确实有效。

我真的希望有人过来告诉我们我们必须做什么。

***编辑***

这太复杂了，就像我说的，我一点也不喜欢它，但我们开始吧。我实际上将功能分解为几个类（这不是我们在那个项目中需要做的唯一操作，所以还有其他实现）我真的希望有人能尽快解决这个问题。这使用 dom4j 处理通过 SOAP 进程的 XML，因此您需要 dom4j 才能使其工作。

```
public class XMLManipulationHandler extends BasicHandler {
    private static Log log = LogFactory.getLog(XMLManipulationHandler.class);
    private static List processingHandlers;

    public static void setProcessingHandlers(List handlers) {
        processingHandlers = handlers;
    }

    protected Document process(Document doc) {
        if (processingHandlers == null) {
            processingHandlers = new ArrayList();
            processingHandlers.add(new EmptyProcessingHandler());
        }
        log.trace(processingHandlers);
        treeWalk(doc.getRootElement());
        return doc;
    }

    protected void treeWalk(Element element) {
        for (int i = 0, size = element.nodeCount(); i < size; i++) {
            Node node = element.node(i);
            for (int handlerIndex = 0; handlerIndex < processingHandlers.size(); handlerIndex++) {
                ProcessingHandler handler = (ProcessingHandler) processingHandlers.get(handlerIndex);
                handler.process(node);
            }
            if (node instanceof Element) {
                treeWalk((Element) node);
            }
        }
    }

    public void invoke(MessageContext context) throws AxisFault {
        if (!context.getPastPivot()) {
            SOAPMessage message = context.getMessage();
            SOAPPart soapPart = message.getSOAPPart();
            ByteArrayOutputStream baos = new ByteArrayOutputStream();

            try {
                message.writeTo(baos);
                baos.flush();
                baos.close();

                ByteArrayInputStream bais = new ByteArrayInputStream(baos.toByteArray());
                SAXReader saxReader = new SAXReader();
                Document doc = saxReader.read(bais);
                doc = process(doc);
                DocumentSource ds = new DocumentSource(doc);
                soapPart.setContent(ds);
                message.saveChanges();
            } catch (Exception e) {
                throw new AxisFault("Error Caught processing document in XMLManipulationHandler", e);
            }
        }
    }
} 
```

```
public interface ProcessingHandler {
    public Node process(Node node);
} 
```

```
public class NamespaceRemovalHandler implements ProcessingHandler {
    private static Log log = LogFactory.getLog(NamespaceRemovalHandler.class);
    private Namespace namespace;
    private String targetElement;
    private Set ignoreElements;

    public NamespaceRemovalHandler() {
        ignoreElements = new HashSet();
    }

    public Node process(Node node) {
        if (node instanceof Element) {
            Element element = (Element) node;
            if (element.isRootElement()) {
                // Evidently, we never actually see the root node when we're called from
                // SOAP...
            } else {
                if (element.getName().equals(targetElement)) {
                    log.trace("Found the target Element.  Adding requested namespace");
                    Namespace already = element.getNamespaceForURI(namespace.getURI());
                    if (already == null) {
                        element.add(namespace);
                    }
                } else if (!ignoreElements.contains(element.getName())) {
                    Namespace target = element.getNamespaceForURI(namespace.getURI());
                    if (target != null) {
                        element.remove(target);
                        element.setQName(new QName(element.getName(), namespace));
                    }
                }

                Attribute type = element.attribute("type");
                if (type != null) {
                    log.trace("Replacing type information: " + type.getText());
                    String typeText = type.getText();
                    typeText = typeText.replaceAll("ns[0-9]+", namespace.getPrefix());
                    type.setText(typeText);
                }
            }
        }

        return node;
    }

    public Namespace getNamespace() {
        return namespace;
    }

    public void setNamespace(Namespace namespace) {
        this.namespace = namespace;
    }

    /**
     * @return the targetElement
     */
    public String getTargetElement() {
        return targetElement;
    }

    /**
     * @param targetElement the targetElement to set
     */
    public void setTargetElement(String targetElement) {
        this.targetElement = targetElement;
    }

    /**
     * @return the ignoreElements
     */
    public Set getIgnoreElements() {
        return ignoreElements;
    }

    /**
     * @param ignoreElements the ignoreElements to set
     */
    public void setIgnoreElements(Set ignoreElements) {
        this.ignoreElements = ignoreElements;
    }

    public void addIgnoreElement(String element) {
        this.ignoreElements.add(element);
    }
} 
```

没有保修等等等等。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-04-13T12:31:55.257

对于请求，我使用它来删除命名空间类型：

```
String endpoint = "http://localhost:5555/yourService";

// Parameter to be send
Integer secuencial = new Integer(11);  // 0011

// Make the call
Service  service = new Service();

Call call = (Call) service.createCall();

// Disable sending Multirefs
call.setOption( org.apache.axis.AxisEngine.PROP_DOMULTIREFS, new java.lang.Boolean( false) ); 

// Disable sending xsi:type
call.setOption(org.apache.axis.AxisEngine.PROP_SEND_XSI, new java.lang.Boolean( false));  

// XML with new line
call.setOption(org.apache.axis.AxisEngine.PROP_DISABLE_PRETTY_XML, new java.lang.Boolean( false)); 

// Other Options. You will not need them
call.setOption(org.apache.axis.AxisEngine.PROP_ENABLE_NAMESPACE_PREFIX_OPTIMIZATION, new java.lang.Boolean( true)); 
call.setOption(org.apache.axis.AxisEngine.PROP_DOTNET_SOAPENC_FIX, new java.lang.Boolean( true));

call.setTargetEndpointAddress(new java.net.URL(endpoint));
call.setSOAPActionURI("http://YourActionUrl");//Optional

// Opertion Name
//call.setOperationName( "YourMethod" );
call.setOperationName(new javax.xml.namespace.QName("http://yourUrl", "YourMethod"));      

// Do not send encoding style
call.setEncodingStyle(null);

// Do not send xmlns in the xml nodes
call.setProperty(org.apache.axis.client.Call.SEND_TYPE_ATTR, Boolean.FALSE);

/////// Configuration of namespaces
org.apache.axis.description.OperationDesc oper;
org.apache.axis.description.ParameterDesc param;
oper = new org.apache.axis.description.OperationDesc();
oper.setName("InsertaTran");
param = new org.apache.axis.description.ParameterDesc(new javax.xml.namespace.QName("http://yourUrl", "secuencial"), org.apache.axis.description.ParameterDesc.IN, new javax.xml.namespace.QName("http://www.w3.org/2001/XMLSchema", "int"), int.class, false, false);
oper.addParameter(param);

oper.setReturnType(new javax.xml.namespace.QName("http://www.w3.org/2001/XMLSchema", "int"));
oper.setReturnClass(int.class);
oper.setReturnQName(new javax.xml.namespace.QName("http://yourUrl", "yourReturnMethod"));
oper.setStyle(org.apache.axis.constants.Style.WRAPPED);
oper.setUse(org.apache.axis.constants.Use.LITERAL);

call.setOperation(oper);

Integer ret = (Integer) call.invoke( new java.lang.Object [] 
            { secuencial }); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-09T00:03:23.340

将客户的 wsdd 更改为设置`enableNamespacePrefixOptimization`为`true`

```
<globalConfiguration >
  <parameter name="enableNamespacePrefixOptimization" value="true"/> 
```

# java - 如何使用 Eclipse 为诺基亚创建 J2ME midlets

> ID：62491
> 
> 赞同：9
> 
> 时间：2008-09-15T12:48:20.760
> 
> 标签：java, eclipse, java-me, nokia, java-wireless-toolkit

诺基亚已经停止提供其开发者套件，依赖于其他 IDE，包括 Eclipse。与此同时，诺基亚再次改变了自己的开发工具，EclipseMe 也发生了变化。这使大多数文档变得无关紧要。

我想知道制作一个简单的 Hello-World 需要什么？

（我自己已经发现了，所以这是一个问答供其他人使用）

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-15T13:02:21.490

这是制作一个简单的 hello world 所需要的 -

1.  获取适用于 Java 的[Eclipse](http://www.eclipse.org/downloads/) IDE。我用的是Ganymede。设置它。
2.  获取 Sun 的[无线工具包](http://java.sun.com/products/sjwtoolkit/download.html)。我用的是 2.5.2。安装它。
3.  获取诺基亚的 SDK（[在此处找到](http://developers.nokia.com/info/sw.nokia.com/id/cc48f9a1-f5cf-447b-bdba-c4d41b3d05ce/Series_40_Platform_SDKs.html)），在我的 S40 6230i 版本中，并安装它，选择**与 Sun 的 WTK 集成的选项**
4.  按照[http://www.eclipseme.org/](http://www.eclipseme.org/)上的说明下载并安装 Mobile Tools Java (MTJ)。我使用的是 1.7.9 版本。
5.  在 MTJ（在 Eclipse 中）配置设备配置文件时，请使用 WTK 文件夹中的诺基亚设备，而不是诺基亚文件夹中的诺基亚设备。
6.  将 WTK 根目录设置为主安装文件夹 - 例如 c:\WTK2.5.2；请注意，WTK 安装程序创建其他文件夹显然是为了向后兼容。
7.  获取[Antenna](http://antenna.sourceforge.net/)并在 MTJ 的属性页（在 Eclipse 中）中设置它的位置。

[这是一个用于测试配置的 HelloWorld 示例。](http://wiki.forum.nokia.com/index.php/Hello_World_in_Java_ME)

注意：它在 WindowsXP 上对我有用。另请注意：这也适用于 S60。只需将第 3 阶段的 S40 SDK 替换为 S60 即可。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-15T14:49:35.837

除非您需要做一些特定于诺基亚的事情，否则我建议完全避免使用诺基亚设备定义。为通用设备开发，然后将您的应用程序下载到真实的物理设备以进行最终测试。我建议的步骤：

1.  下载并安装 Sun 的无线工具包。

2.  安装 EclipseME，使用方法[“通过下载的存档安装”](http://eclipseme.org/docs/installEclipseME.html#step2c)。

3.  [配置 EclipseME](http://eclipseme.org/docs/configuring.html)。选择通用设备，例如“DefaultColorPhone”进行开发。

4.  创建一个新项目“J2ME Midlet Suite”

5.  右键单击该项目，并创建一个新的 Midlet “HelloWorld”

6.  输入代码，例如：

```
public HelloWorld() {
    super();
    myForm = new Form("Hello World!");
    myForm.append( new StringItem(null, "Hello, world!"));
    myForm.addCommand(new Command("Exit", Command.EXIT, 0));
    myForm.setCommandListener(this);
}

protected void startApp() throws MIDletStateChangeException {
    Display.getDisplay(this).setCurrent(myForm);
}

protected void pauseApp() {}

protected void destroyApp(boolean arg0) throws MIDletStateChangeException {}

public void commandAction(Command arg0, Displayable arg1) {
    notifyDestroyed();
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-15T15:05:46.123

对我来说，EclipseME 最烦人的问题是“损坏的”调试器，它无法启动。这在 docs 中有介绍，但是当我第一次安装 EclipseME 时，我花了大约一个小时才找到这个技巧，一年后我回到 JavaME 开发又花了一个小时，所以我决定在这里也分享这个知识。

如果调试器无法启动，

1.  在 Eclipse“首选项”菜单中打开“Java > Debug”部分，并取消选中“Suspend execution on uncaught exceptions”和“Suspend execution on compiler errors”和
2.  将对话框底部附近的“调试器超时”增加到至少 15000 毫秒。

之后，Eclipse 应该能够连接到 KVM 并运行带有调试器的 midlet。

# sql-server - 线串之间的相似性

> ID：62496
> 
> 赞同：13
> 
> 时间：2008-09-15T12:49:01.710
> 
> 标签：sql-server, algorithm, gis

我有许多由 GPS 记录的轨迹，更正式地可以描述为许多线串。

现在，一些记录的轨迹可能是同一条路线的记录，但由于 GPS 系统的不准确，记录是在不同的场合进行的，而且它们可能是以不同的速度记录的，所以它们不会完美匹配，但当人类在地图上查看时仍然看起来足够近，以确定它实际上是已记录的同一条路线。

我想找到一种算法来计算两个线串之间的相似度。我想出了一些自制的方法来做到这一点，但想知道这是否是一个已经有很好的算法来解决的问题。

考虑到相似的平均值代表地图上的相同路径，您将如何计算相似度？

**编辑：**对于那些不确定我在说什么的人，请查看此链接以了解行字符串的定义：http: [//msdn.microsoft.com/en-us/library/bb895372.aspx](http://msdn.microsoft.com/en-us/library/bb895372.aspx) - I' m*不*询问字符串。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-09-17T15:08:58.533

计算每对轨道上的[Fréchet 距离。](http://cgm.cs.mcgill.ca/~athens/cs507/Projects/2002/StephanePelletier/#what)距离可用于衡量轨道的相似性。

*数学警报：* Fréchet 是与您的问题相关的[度量空间](http://en.wikipedia.org/wiki/Metric_space)领域的先驱。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-15T12:53:13.697

我会根据估计的可能错误在第一行周围添加一个缓冲区，然后确定第二行是否完全适合缓冲区。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-15T13:13:43.803

为了确定“相同的路线”，创建最小的归一化路径向量集，计算总功率差并将总功率差与质量测量值进行比较。

1.  在总路径长度上标准化 GPS 航路点，
2.  将路径的向量一起行走，根据每个路径点的最短向量为每条路径创建一组新的路径向量，
3.  计算向量长度的归一化路径加权中每个向量端点之间的总功率差，以及
4.  与质量度量进行比较。

直观地调整差异的力量（例如，平方差异）和质量度量（例如总功率差异的百分比）。该算法产生路径匹配的连续质量测量以及二进制结果（路径相同吗？）

> Paul Tomblin 说：我会根据估计的可能错误在第一行周围添加一个缓冲区，然后确定第二行是否完全适合缓冲区。

您可以在比较归一化矢量端点时修改算法。您可以确定是否有任何端点差异超过了某个大小（实现 Paul 的缓冲区思想），或者如果端点在“缓冲区”之外，则可以使用该事实来忽略该端点差异，从而允许比较*忽略边程*。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-15T23:03:18.457

您可以沿着 LineString A 的每个点 (Pa) 走，并测量从 Pa 到 LineString B 的最近线段的距离，平均每个距离。

这不是一个快速或完美的方法，但应该能够给出一个有用的数字并且可以很快实现。

线串是否在相似的点开始和结束，或者它们的范围非常不同？

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-18T04:01:46.163

If you consider a single line string to be a sequence of [x,y] points (or [x,y,z] points), then you could compute the similarity between each pair of line strings using the [Needleman-Wunsch](http://en.wikipedia.org/wiki/Needleman-Wunsch_algorithm) algorithm. As described in the referenced Wikipedia article, the Needleman-Wunsch algorithm requires a "similarity matrix" which defines the distance between a pair of points. However, it would be easy to use a function instead of a matrix. In your case you could simply use the 2D [Euclidean distance](http://en.wikipedia.org/wiki/Euclidean_distance) function (or a 3D Euclidean function if your points have elevation) to provide the distance between each pair of points.

* * *

## 回答 #6

> 赞同：-2
> 
> 时间：2008-09-15T18:02:35.310

我实际上支持那个人 (Aaron F)，他说你可能对 Levenshtein 距离问题感兴趣（并引用了[这个](http://en.wikipedia.org/wiki/Fasta)）。他的回答在我看来是迄今为止最好的。

更具体地说，Levenshtein 距离（也称为编辑距离）并不严格衡量逐个字符的距离，但也允许您执行插入和删除。这种距离测量的最佳算法可以在二次时间内计算（如果你的字符串很长，会很慢），但是计算生物学家对此有很好的启发式方法，你自己可能会感兴趣。查看[BLAST](http://en.wikipedia.org/wiki/BLAST)和[FASTA](http://en.wikipedia.org/wiki/Fasta)。

在您的问题中，您似乎正在处理数字字符串之间的差异，并且您关心数字。如果您提供更多信息，我可能会根据您的目的将您定向到正确的 BLAST/FASTA/etc 变体。在任何情况下，您都可以考虑调整 BLAST 和 FASTA 以满足您的需求。它们很简单。

[1](http://en.wikipedia.org/wiki/Fasta)：[http](http://en.wikipedia.org/wiki/Levenshtein_distance) ://en.wikipedia.org/wiki/Levenshtein_distance，http : [//www.nist.gov/dads/HTML/Levenshtein.html](http://www.nist.gov/dads/HTML/Levenshtein.html)

# c++ - 远程安装windows服务

> ID：62501
> 
> 赞同：0
> 
> 时间：2008-09-15T12:49:41.270
> 
> 标签：c++, windows, windows-services

我需要在多台计算机上远程安装 windows 服务，所以我使用了 Winapi 中的 CreateService() 和其他服务功能。我知道我需要访问的机器的管理员密码和用户名。为了访问远程机器，我在 LogonUser 的帮助下模拟调用进程，如下所示：

```
//all variables are initialized correctly  
int status = 0;        
status = LogonUser(lpwUsername,        
               lpwDomain,         
                   lpwPassword,          
                   LOGON32_LOGON_NEW_CREDENTIALS,       
                   LOGON32_PROVIDER_DEFAULT,   
                   &hToken);            

if (status == 0)    
{   
         //here comes a error  
}  

status = ImpersonateLoggedOnUser(hToken);     
if (status == 0)                
{     
    //once again a error     
}      

//ok, now we are impersonated, do all service work there 
```

因此，我可以访问域中的机器，但有些计算机不在域中。在域外的机器上，此代码不起作用。有没有办法在域外的机器上访问服务管理器？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-15T12:56:33.983

您可以这样做，该帐户需要存在于远程机器上，并且您需要在 LogonUser 调用中使用机器名称作为域名。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-19T11:49:31.903

与其自己动手，不如直接使用 SC 内置命令？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-22T13:46:16.277

好的，问题解决了（不是很好，但还不错）。我在远程机器上使用 WNetAddConnection() 到 ipc$。

# c# - 我应该使用 int 还是 Int32

> ID：62503
> 
> 赞同：365
> 
> 时间：2008-09-15T12:49:50.647
> 
> 标签：c#, variable-types

在 C# 中，`int`并且`Int32`是相同的东西，但我已经阅读了很多次，但`int`没有`Int32`给出任何理由。有什么原因吗，我应该关心吗？

* * *

## 回答 #1

> 赞同：282
> 
> 时间：2008-09-15T12:55:54.907

两者确实是同义词；`int`看起来会更熟悉一些，`Int32`使 32 位对阅读您的代码的人来说更加明确。我倾向于`int`在只需要“整数”的地方使用，`Int32`其中大小很重要（加密代码、结构），因此未来的维护者会知道如果合适的话放大 s 是安全的`int`，但应该注意`Int32`以同样的方式更改 s 。

结果代码将是相同的：差异纯粹是可读性或代码外观之一。

* * *

## 回答 #2

> 赞同：144
> 
> 时间：2008-09-15T13:14:26.750

[ECMA-334](https://www.ecma-international.org/publications/standards/Ecma-334.htm) :2006 *C# 语言规范*(p18):

> 每个预定义类型都是系统提供类型的简写。例如，关键字`int`指的是 struct `System.Int32`。作为风格问题，使用关键字优于使用完整的系统类型名称。

* * *

## 回答 #3

> 赞同：89
> 
> 时间：2008-09-15T13:21:39.260

它们都声明了 32 位整数，并且正如其他海报所述，您使用哪一个主要是句法风格问题。但是，它们的行为方式并不总是相同。例如，C# 编译器不允许这样做：

```
public enum MyEnum : Int32
{
    member1 = 0
} 
```

但它会允许这样做：

```
public enum MyEnum : int
{
    member1 = 0
} 
```

去搞清楚。

* * *

## 回答 #4

> 赞同：51
> 
> 时间：2008-09-15T15:18:28.950

我总是使用系统类型 - 例如，`Int32`而不是`int`. *[在阅读了Applied .NET Framework Programming](https://rads.stackoverflow.com/amzn/click/com/0735614229)*之后，我采用了这种做法——作者 Jeffrey Richter 为使用完整类型名称提供了一个很好的案例。以下是困扰我的两点：

1.  类型名称可能因 .NET 语言而异。例如，在 C# 中，`long`映射到 System.Int64，而在具有托管扩展的 C++ 中，`long`映射到 Int32。由于在使用 .NET 时可以混合和匹配语言，因此您可以确保使用显式类名总是更清晰，无论读者喜欢哪种语言。

2.  许多框架方法将类型名称作为其方法名称的一部分：

    ```
    BinaryReader br = new BinaryReader( /* ... */ );
    float val = br.ReadSingle();     // OK, but it looks a little odd...
    Single val = br.ReadSingle();    // OK, and is easier to read 
    ```

* * *

## 回答 #5

> 赞同：21
> 
> 时间：2008-09-15T13:03:49.757

int 是一个 C# 关键字并且是明确的。

大多数时候它并不重要，但有两件事与 Int32 背道而驰：

*   你需要有一个“使用系统”；陈述。使用“int”不需要 using 语句。
*   可以定义您自己的名为 Int32 的类（这将是愚蠢和混乱的）。int 总是意味着 int。

* * *

## 回答 #6

> 赞同：12
> 
> 时间：2008-09-15T12:59:03.073

如前所述，`int`= `Int32`。为了安全起见，在实现任何关心数据类型边界的事情时，请务必始终使用`int.MinValue`/ 。`int.MaxValue`假设 .NET 决定`int`现在是`Int64`，您的代码将较少依赖边界。

* * *

## 回答 #7

> 赞同：11
> 
> 时间：2008-09-15T14:00:32.303

当您只需要处理一种语言时（并且对于您不必提醒自己有关数学溢出的代码），类型的字节大小并不太有趣。变得有趣的部分是当您在一种语言与另一种语言、C# 与 COM 对象等之间建立桥梁时，或者您正在做一些位移或掩码并且您需要提醒自己（以及您的代码审查同事）的数据大小。

在实践中，我通常使用 Int32 来提醒自己它们的大小，因为我确实编写了托管 C++（例如桥接到 C#）以及非托管/本机 C++。

您可能知道，在 C# 中是 64 位，但在本机 C++ 中，它最终是 32 位，或者 char 是 unicode/16 位，而在 C++ 中它是 8 位。但是我们怎么知道呢？答案是，因为我们在手册中查过它，它是这么说的。

随着时间和经验，当您编写代码以在 C# 和其他语言之间架起桥梁时，您将开始更加注重类型（这里的一些读者在想“你为什么要这样做？”），但恕我直言，我相信这是一种更好的做法，因为我不记得我上周编码了什么（或者我不必在我的 API 文档中指定“此参数是 32 位整数”）。

在[F#](http://en.wikipedia.org/wiki/F_Sharp_%28programming_language%29)中（尽管我从未使用过），它们定义了*int*、*int32*和*nativeint*。应该提出同样的问题，“我使用哪一个？”。正如其他人所提到的，在大多数情况下，它应该无关紧要（应该是透明的）。但我会选择 int32 和 uint32 只是为了消除歧义。

我想这将取决于您正在编写什么应用程序、谁在使用它、您和您的团队遵循什么编码实践等来证明何时使用 Int32 是合理的。

附录：顺便说一句，自从我几年前回答过这个问题以来，我已经开始同时使用 F# 和 Rust。F#，都是关于类型推断，以及 C# 和 F# 之间的桥接/InterOp'ing，本机类型匹配，所以不用担心；我很少需要在 F# 中显式定义类型（如果不使用类型推断，这几乎是一种罪过）。在 Rust 中，他们完全消除了这种歧义，你必须使用`i32`vs `u32`; 总而言之，减少歧义有助于减少错误。

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2008-09-15T12:56:19.850

`int`和之间没有区别`Int32`，但是作为`int`一个语言关键字，许多人在风格上更喜欢它（就像`string`vs一样`String`）。

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2008-09-15T12:57:37.507

以我的经验，这是一个约定俗成的事情。我不知道在 Int32 上使用 int 的任何技术原因，但它是：

1.  打字更快。
2.  对典型的 C# 开发人员来说更熟悉。
3.  默认 Visual Studio 语法突出显示中的不同颜色。

我特别喜欢最后一个。:)

* * *

## 回答 #10

> 赞同：7
> 
> 时间：2008-09-28T20:32:06.337

我在定义变量时总是使用别名类型（int、string 等），在访问静态方法时使用真实名称：

```
int x, y;
...
String.Format ("{0}x{1}", x, y); 
```

看到像 int.TryParse() 这样的东西似乎很难看。除了风格，我这样做没有其他原因。

* * *

## 回答 #11

> 赞同：6
> 
> 时间：2008-09-15T20:32:18.320

尽管它们（大部分）是相同的（见下文中的一个 [bug] 差异），但您绝对应该关心并且应该使用 Int32。

*   16 位整数的名称是 Int16。对于 64 位整数，它是 Int64，对于 32 位整数，直观的选择是：int 还是 Int32？

*   Int16、Int32 或 Int64 类型变量的大小问题是自引用的，但 int 类型变量的大小问题是一个完全有效的问题，无论问题多么微不足道，都会分散注意力，导致混乱，浪费时间，阻碍讨论等（这个问题的存在证明了这一点）。

*   使用 Int32 可以让开发人员意识到他们选择的类型。int 又有多大？哦，是的，32。当名称中包含大小时，实际考虑类型大小的可能性更大。使用 Int32 还可以促进对其他选择的了解。当人们不被迫至少认识到有替代方案时，int 变得太容易成为“整数类型”。

*   框架内旨在与 32 位整数交互的类名为 Int32。再一次，即：更直观，更少混淆，缺少（不必要的）翻译（不是系统中的翻译，而是开发人员的头脑中的翻译），等等。 `int lMax = Int32.MaxValue`还是`Int32 lMax = Int32.MaxValue`？

*   int 不是所有 .NET 语言中的关键字。

*   尽管有争论为什么它不可能永远改变，但 int 可能并不总是 Int32。

缺点是要输入两个额外的字符和 [bug]。

这不会编译

```
public enum MyEnum : Int32
{
    AEnum = 0
} 
```

但这将：

```
public enum MyEnum : int
{
    AEnum = 0
} 
```

* * *

## 回答 #12

> 赞同：5
> 
> 时间：2008-09-15T12:55:27.903

我知道最好的做法是使用 int，所有 MSDN 代码都使用 int。但是，据我所知，除了标准化和一致性之外，没有其他原因。

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2008-09-15T15:38:43.533

你不应该在乎。您应该`int`大部分时间使用。它将有助于将来将您的程序移植到更广泛的体系结构（目前`int`是一个别名，`System.Int32`但可能会改变）。只有当变量的位宽很重要时（例如：控制 a 内存中的布局`struct`），您才应该使用`int32`和其他（带有关联的“ `using System;`”）。

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2008-09-15T13:00:26.003

[int 与 System.Int32 相同，编译后它将在CIL](http://en.wikipedia.org/wiki/Common_Intermediate_Language)中变成相同的东西。

我们在 C# 中按照惯例使用 int，因为 C# 希望看起来像 C 和 C++（以及 Java），而这正是我们在那里使用的......

顺便说一句，在声明各种 Windows API 函数的导入时，我确实最终使用了 System.Int32。我不确定这是否是一个已定义的约定，但它提醒我我要去一个外部 DLL ......

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2008-09-15T13:05:31.187

曾几何时，int 数据类型与编译器所针对的机器的寄存器大小挂钩。因此，例如，16 位系统的编译器将使用 16 位整数。

然而，幸运的是，我们再也看不到 16 位了，当 64 位开始流行时，人们更关心使其与旧软件兼容，而 32 位已经存在了很长时间，以至于对于大多数编译器来说，*int*只是假设为 32 位。

* * *

## 回答 #16

> 赞同：3
> 
> 时间：2008-09-15T13:09:49.897

int 是 System.Int32 的 C# 语言的快捷方式

虽然这确实意味着微软可以改变这种映射，但在 FogCreek 的讨论中发表的一篇文章指出[[来源]](http://discuss.fogcreek.com/dotnetquestions/default.asp?cmd=show&ixPost=1988)

*“关于 64 位问题——微软确实在开发 .NET Framework 的 64 位版本，但我很确定 int 不会映射到该系统上的 64 位。*

*原因：*

*1\. C# ECMA 标准明确规定 int 为 32 位，long 为 64 位。*

*2\. Microsoft 在 Framework 1.1 版本中引入了额外的属性和方法，这些属性和方法返回 long 值而不是 int 值，例如除了 Array.GetLength 之外的 Array.GetLongLength。*

*所以我认为可以肯定地说所有内置的 C# 类型都将保留它们当前的映射。”*

* * *

## 回答 #17

> 赞同：3
> 
> 时间：2008-12-15T03:41:49.927

我建议使用微软的[StyleCop](http://code.msdn.microsoft.com/sourceanalysis)。

它类似于[FxCop](http://en.wikipedia.org/wiki/FxCop)，但用于与样式相关的问题。默认配置与 Microsoft 的内部样式指南相匹配，但可以针对您的项目进行自定义。

可能需要一点时间来适应，但它肯定会让你的代码更好。

您可以将其包含在构建过​​程中以自动检查违规行为。

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2008-09-15T12:53:15.630

你不应该在意。如果大小是一个问题，我会使用字节，短，整数，然后长。使用大于 int32 的 int 的唯一原因是您需要大于 2147483647 或小于 -2147483648 的数字。

除此之外，我不在乎，还有很多其他的项目需要关注。

* * *

## 回答 #19

> 赞同：2
> 
> 时间：2008-09-15T12:56:24.687

`int`和`Int32`是一样的。`int`是 的别名`Int32`。

* * *

## 回答 #20

> 赞同：2
> 
> 时间：2008-09-15T13:01:52.443

这在实践中没有任何区别，并且随着时间的推移，您将采用自己的约定。我倾向于在分配类型时使用关键字，在使用静态方法时使用类版本等：

```
int total = Int32.Parse("1009"); 
```

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2008-09-15T13:37:57.600

如果 Microsoft 将整数的默认实现更改为某个新的版本（我们称之为 Int32b），我会使用 int。

然后，Microsoft 可以将 int 别名更改为 Int32b，我不必更改我的任何代码即可利用他们新的（希望改进的）整数实现。

任何类型关键字也是如此。

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2008-09-15T14:02:03.343

`int`是 的别名`System.Int32`，如下表中所定义： [内置类型表（C# 参考）](http://msdn.microsoft.com/en-us/library/ya5y69ds.aspx)

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2008-09-15T13:02:24.720

你不应该关心大多数编程语言，除非你需要编写非常具体的数学函数，或者为一种特定架构优化的代码......只要确保类型的大小对你来说足够（如果你使用比 Int 更大的东西例如，**知道**您需要超过 32 位）

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2008-09-15T13:04:58.410

没关系。int 是语言关键字，而 Int32 是它的实际系统类型。

另请参阅我对相关问题的回答[。](https://stackoverflow.com/questions/9734/cnet-case-insensitive-string#9747)

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2008-09-15T14:26:43.503

使用该`Int32`类型需要对 的命名空间引用`System`或完全限定 ( `System.Int32`)。我倾向于`int`，因为它不需要命名空间导入，因此在某些情况下减少了命名空间冲突的机会。当编译成 IL 时，两者没有区别。

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2008-09-15T14:36:52.510

还要考虑 Int16。如果您需要在应用程序的内存中存储一​​个整数并且您担心使用的内存量，那么您可以使用 Int16，因为它使用更少的内存并且具有比 Int32 更小的最小/最大范围（这就是 int 是.)

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2008-09-15T16:17:12.490

不久前，当我们受到 Microsoft .NET CLR 产品团队的某个人的访问时，我正在与 Microsoft 合作一个项目。这个人编写了示例，当他定义他的变量时，他使用了“Int32”与“int”和“String”与“string”。

我记得在 Microsoft 的其他示例代码中看到过这种风格。所以，我做了一些研究，发现每个人都说“Int32”和“int”除了语法着色之外没有区别。事实上，我发现很多材料建议您使用“Int32”来使您的代码更具可读性。所以，我采用了这种风格。

前几天我确实发现了不同之处！编译器不允许您使用“Int32”键入枚举，但是当您使用“int”时它可以。不要问我为什么，因为我还不知道。

例子：

```
public  enum MyEnum : Int32
{
    AEnum = 0
} 
```

这行得通。

```
public enum MyEnum : int
{
    AEnum = 0
} 
```

取自：[Int32 表示法与 int](http://geekswithblogs.net/caustin/archive/2005/08/05/49267.aspx)

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2008-09-16T05:48:51.820

Int 或 Int32 的使用是相同的 Int 只是为读者简化代码的糖。

使用 Nullable 变体 Int? 还是 Int32？当您在包含 null 的字段上使用数据库时。这将使您免于许多运行时问题。

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2008-09-16T06:12:52.433

一些编译器在不同平台上对 int 有不同的大小（不是 C# 特定的）

一些编码标准 (MISRA C) 要求使用的所有类型都指定大小（即 Int32 而不是 int）。

为不同类型的变量指定前缀也是很好的（例如，b 代表 8 位字节，w 代表 16 位字，l 代表 32 位长字 => Int32 lMyVariable）

您应该关心，因为它使您的代码更便携和更易于维护。

如果您总是要使用 C#，那么 Portable 可能不适用于 C#，并且 C# 规范在这方面永远不会改变。

可维护的 ihmo 将始终适用，因为维护您的代码的人可能不知道这个特定的 C# 规范，并且在 int 偶尔超过 2147483647 时会错过一个错误。

在一个简单的 for 循环中，例如计算一年中的几个月，您不会关心，但是当您在可能溢出的上下文中使用变量时，您应该关心。

您还应该关心是否要对其进行按位操作。

* * *

## 回答 #30

> 赞同：0
> 
> 时间：2013-07-03T12:44:53.683

根据 Visual Studio 2012 中的即时窗口 Int32 是 int，Int64 是 long。这是输出：

```
sizeof(int)
4
sizeof(Int32)
4
sizeof(Int64)
8
Int32
int
    base {System.ValueType}: System.ValueType
    MaxValue: 2147483647
    MinValue: -2147483648
Int64
long
    base {System.ValueType}: System.ValueType
    MaxValue: 9223372036854775807
    MinValue: -9223372036854775808
int
int
    base {System.ValueType}: System.ValueType
    MaxValue: 2147483647
    MinValue: -2147483648 
```

* * *

## 回答 #31

> 赞同：0
> 
> 时间：2021-09-14T09:37:02.337

现在是 2021 年，我已经阅读了所有答案。大多数人说它基本上是一样的（它是一个别名），或者，它取决于“你喜欢什么”，或者“按照惯例使用 int ...”没有答案让你清楚**何时**、**何**地以及**为什么**使用`Int32`over `int`。这就是我在这里的原因。

98% 的情况下，您都可以侥幸逃脱`int`，这完全没问题。**剩下的 2% 是**什么？

**带有记录的 IO**（结构、本机类型、组织和压缩）。有人说*无用的应用程序可以读取和操作数据，但实际上不能将新数据写入*定义的存储。但是为了不重新发明轮子，在某些时候，那些处理**旧数据**的人必须检索有关如何阅读它们的文档。很可能它们是从**a`long`始终是 32 位整数**的时代编译的。

以前发生过，有些人记不住 a`db`是一个字节，a`dw`是一个字，a`dd`是一个双字，但那是多少位呢？这**很可能会在一个平台上再次发生**...... `C# 43.0`（`256-bits`未来的）男孩从未听说过“*按照惯例，使用 int 而不是 Int32* ”。这就是`Int32`重要的 2% `int`。MSDN 说今天推荐使用`int`无关紧要，它通常适用于当前的 C# 版本，但在未来的 MSDN 页面中，可能会在 2028 年或 2034 年被丢弃？`WORD`今天拥有和遇到的人越来越少`DWORD`，然而，在二十年前，它们很常见。同样的事情也会发生`int`，在处理精确固定长度数据的情况下。

**在内存中**，a `ushort`( `UInt16`) 可以是a `Decimal`，只要它的小数部分为null，可以是正数或null，并且不超过65535。**但是在文件**中，它必须是a `short`，16 位长。当您阅读有关另一个时代的文件结构的文档（在源代码中）时，您会意识到**有 3545 条记录定义**，其中一些嵌套在其他记录中，每条记录都有几个到**数百个**不同类型的字段。

在 2028 年的某个地方，一个男孩认为**他可以通过 Ctrl-H-ing** `int` to `Int32`、仅全字并匹配大小写来逃脱……整个解决方案中的约 67000 处变化。点击运行，仍然获得 CTD。拍拍拍拍。想想`int`你应该改成`Int32`哪些，你应该改成哪些`var`。还值得指出的`Pointers`是，当您处理 TB 级数据时（在某个云上拥有整个星球的虚拟表示，按需下载并渲染到用户屏幕）时，它很有用。在大约 1% 的情况下，指针非常快，因为需要实时计算大量数据，您必须使用不安全的代码进行交易。同样，它要提出一个实际有用的应用程序，而不是花哨并浪费时间移植到托管。所以，要小心，`IntPtr`已经是 32 位还是 64 位了？您可以在不关心您读取/跳过多少字节的情况下摆脱您的代码吗？或者只是去`(Int32*) int32Ptr = (Int32*) int64Ptr;`...

**一个更实际的例子**是一个包含数据处理及其各自命令（源代码中的方法）的文件，例如内部分支（如果测试失败，则有条件继续或跳转到）：

`IfTest`文件中的记录说：如果 value 等于 someConstant，则跳转到`address`. where`address`是一个`16-bits`整数，表示文件内的相对指针（您可以返回文件开头最多 32768 个字节，或向下最多 32767 个字节）。但是 10 年后，平台可以处理更大的文件和更大的数据，现在你有了`32-bits`相对地址。您在源代码中的方法已命名`IfTestMethod(...)`，现在您将如何命名新方法？`IfTestMethodInt()`还是`IfTestMethod32()`？您还会重命名旧方法吗`IfTestMethodShort()`？`IfTestMethod16()`然后十年后，您会得到一个具有长（Int64）相对地址的新命令......大约 10 年后的 128 位命令呢？**保持一致**！原则很好，但有时逻辑更好。

**问题不在于我或您****今天**编写代码，而且对我们来说似乎没问题。它代替了一个人试图理解我们在**10 或 20 年后**写的东西，想出一个有效的更新代码**需要多少时间（= 金钱）？**明确或写多余的评论实际上会节省时间。你更喜欢哪一个？`Int32 val;`或`var val; // 32-bits`。

此外，使用**来自其他平台的外部数据或编译指令**是一个概念（今天涉及 Interop、COM、PInvoke ......）这是一个**我们无法摆脱的**概念，无论哪个时代，因为更新（重新格式化）需要时间数据（例如通过序列化）将 DLL 升级到托管代码也需要时间。我们花了一些时间把汇编程序抛在脑后，转而使用全 C。我们正在花时间从 32 位数据转移到 64 位，但是，我们仍然需要关心 8 位和 16 位。未来的下一步是什么？从 128 位移动到 256 或直接移动到 1024？不要假设一个明确的关键字对于 20 年后阅读您文档的人来说仍然是明确的（并且文档通常包含错误，主要是因为复制/粘贴）。

*所以这里是：**今天**在哪里使用 Int32 而不是 int ？*

当您正在生成对**数据大小敏感的**代码（IO、网络、跨平台数据......）时，并且**在未来的某个时候**- 可能是几十年后 - 必须有人理解和移植您的代码。关键原因在于时代。1000行代码，可以用`int`，100000行，**不行了**。这是一项**只有少数**人必须做的罕见任务，而且地狱是的，他们有斗争，如果只有一些更明确一点，而不是依赖“*按照惯例*”或“*它在 IDE 中看起来很漂亮，Int32 太丑了*”或者“*它们是一样的，别费心了，写那两个数字并按住shift键是浪费时间*”，*int 是明确的*”，或者“*那些不喜欢 int 的人只是 VB 的粉丝 - 去学习 C# 你是菜鸟*”（是的，这就是这里一些评论的潜在含义）

**不要将我所写的内容视为笼统的看法，也不要试图在所有情况下推广 Int32**。我清楚地说明了具体情况（在我看来，这在其他答案中并不清楚），以提倡少数人因写作花哨而被主管指责，`Int32`同时同一位主管不理解需要什么这么长时间将 C DLL 重写为 C#。这是一个边缘案例，但至少对于那些阅读，**“Int32”在其生命中至少有一个目的**。

可以通过将问题反过来来进一步讨论这一点：*为什么不干脆去掉`Int32`，`Int64`以及未来 C# 规范中的所有其他变体？那意味着什么？*

* * *

## 回答 #32

> 赞同：-1
> 
> 时间：2008-09-15T13:01:19.013

字节 int 可以容纳取决于您编译它的目的，因此当您为 32 位处理器编译程序时，它可以容纳从 2^32/2 到 -2^32/2+1 的数字，而编译为 64 位它可以保持从 2^64/2 到 -2^64/2+1。int32 将始终保存 2^32 个值。

**编辑**：忽略我的回答，我没有看到 C#。我的答案是针对 C 和 C++ 的。我从来没有用过C#

# ms-access - 有没有办法在 ms-access 查询中创建多个插入语句？

> ID：62504
> 
> 赞同：16
> 
> 时间：2008-09-15T12:49:56.137
> 
> 标签：ms-access

我正在使用 MS Access 2003。我想在 MS Access 中的“查询”中运行大量插入 SQL 语句。有什么简单的（或确实有任何方法）可以做到吗？

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2008-09-15T17:43:12.003

是和不是。

你不能这样做：

```
insert into foo (c1, c2, c3)
values ("v1a", "v2a", "v3a"),
       ("v1b", "v2b", "v3b"),
       ("v1c", "v2c", "v3c") 
```

但你可以

```
insert into foo (c1, c2, c3)
    select (v1, v2, v3) from bar 
```

如果您还没有表格中的数据，这会给您带来什么？好吧，您可以制作一个由许多带有硬编码结果的 Select 联合组成的 Select 语句。

```
INSERT INTO foo (f1, f2, f3)
    SELECT *
    FROM (select top 1 "b1a" AS f1, "b2a" AS f2, "b3a" AS f3 from onerow
    union all
    select top 1 "b1b" AS f1, "b2b" AS f2, "b3b" AS f3 from onerow
    union all 
    select top 1 "b1c" AS f1, "b2c" AS f2, "b3c" AS f3 from onerow) 
```

注意：我还必须包含某种形式的虚拟表（例如，onerow）以欺骗访问以允许联合（其中必须至少有一行），并且您需要“前 1”以确保您不'对于多于一行的表不会重复

但是话又说回来，只执行三个单独的插入语句可能会更容易，特别是如果您已经在循环中构建东西（当然，执行插入的成本大于编写代码的时间成本） .

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-15T12:58:45.587

就个人而言，我会创建一个 VBA 子例程来执行此操作，并使用某种形式的 sql 连接连接到数据库。

在我的脑海中，执行此操作的代码应该类似于：

```
Sub InsertLots ()
    Dim SqlConn as Connection
    SqlConn.Connect("your connection string")
    SqlConn.Execute("INSERT <tablename> (column1, column2) VALUES (1, 2)")
    SqlConn.Execute("INSERT <tablename> (column1, column2) VALUES (2, 3)")
    SqlConn.Close()
End Sub 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-15T20:50:27.590

我认为，当您还没有明确代码将在其中运行的上下文时，像 Jonathan 那样提出特定的数据接口是不可取的。

如果数据存储是 Jet 数据库，那么使用任何形式的 ADO 都毫无意义，除非您从首选的脚本平台运行代码。如果你在 Access 中，肯定不是这种情况，DAO 是首选接口。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2013-03-03T16:22:24.970

MS Access 不允许从同一个 sql 窗口进行多次插入。如果要***插入***，例如**表中的 10 行**，例如**电影 (mid, mname, mdirector,....)**，则需要打开 sql 窗口，

1.  键入第一个 stmt，执行第一个 stmt，删除第一个 stmt
2.  键入第 2 个 stmt，执行第 2 个 stmt，删除第 2 个 stmt
3.  键入第 3 个 stmt，执行第 3 个 stmt，删除第 3 个 stmt ......

很无聊。相反，您可以通过执行以下操作从 excel 导入行：

1.  右键单击您已经创建的表名
2.  从 Excel 导入（打开导入对话框）
3.  浏览到包含要在表中导入的记录的 excel 文件
4.  单击“将记录的副本附加到表中：”
5.  选择所需的表（在此示例电影中）
6.  点击“确定”
7.  选择包含电子表格中数据的工作表
8.  点击完成

excel中的整个数据集已加载到“MOVIE”表中

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-15T12:57:21.690

否 - Access 中的查询是单个 SQL 语句。无法在一个查询对象中创建一批多条语句。您可以创建多个查询对象并从宏/模块运行它们。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-29T13:11:28.523

@Rik Garner：不确定您所说的“批处理”是什么意思，但是

```
INSERT INTO foo (f1, f2, f3)
    SELECT *
    FROM (select top 1 "b1a" AS f1, "b2a" AS f2, "b3a" AS f3 from onerow
    union all
    select top 1 "b1b" AS f1, "b2b" AS f2, "b3b" AS f3 from onerow
    union all 
    select top 1 "b1c" AS f1, "b2c" AS f2, "b3c" AS f3 from onerow) 
```

构造，虽然是一个单独的 SQL*语句*，但实际上会一次插入每一行（而不是一次插入所有行），但在同一个事务中：您可以通过添加相关约束来测试这一点，例如

```
ALTER TABLE foo ADD
   CONSTRAINT max_two_foo_rows
      CHECK (2 >= (SELECT COUNT(*) FROM foo AS T2)); 
```

假设表是空的，上面`INSERT INTO..SELECT..`应该工作：事实上它不是因为在插入第一行之后检查约束，而不是在插入所有三个之后（违反 ANSI SQL-92，但这是 MS Access你 ）; 表保持为空的事实表明内部事务已回滚。

@David W. Fenton：您可能对 DAO 有强烈的个人偏好，但请不要对某人选择替代数据访问技术（在本例中为 ADO）过于苛刻，特别是对于香草`INSERT`，当他们用以下方式限定他们的评论时， “在我的脑海中，执行它的代码应该看起来像......”毕竟，你不能使用 DAO 来创建`CHECK`约束 :)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2013-05-07T21:33:53.310

MS Access 还可以将数据从简单的文本文件附加到表中。CSV 值（我只是使用 Replace All 框删除除逗号以外的所有内容）并在 External Data 下选择 Text File。

```
From this:
INSERT INTO CLASS VALUES('10012','ACCT-211','1','MWF 8:00-8:50 a.m.','BUS311','105');
INSERT INTO CLASS VALUES('10013','ACCT-211','2','MWF 9:00-9:50 a.m.','BUS200','105');
INSERT INTO CLASS VALUES('10014','ACCT-211','3','TTh 2:30-3:45 p.m.','BUS252','342');
To this:
10012,ACCT-211,1,MWF 8:00-8:50 a.m.,BUS311,105
10013,ACCT-211,2,MWF 9:00-9:50 a.m.,BUS200,105
10014,ACCT-211,3,TTh 2:30-3:45 p.m.,BUS252,342 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2021-01-14T20:56:07.993

基于来自@Jonathan 的 VBA 解决方法，并在当前 Access 数据库中执行：

```
Public Sub InsertMinimalData()
  CurrentDb.Execute "INSERT INTO FinancialYear (FinancialYearID) VALUES ('FY2019/2020');"
  CurrentDb.Execute "INSERT INTO FinancialYear (FinancialYearID) VALUES ('FY2020/2021');"
End Sub 
```

# svn - 如何在 Subversion 中移动标签

> ID：62505
> 
> 赞同：2
> 
> 时间：2008-09-15T12:49:56.810
> 
> 标签：svn

我希望 Subversion 有更好的移动标签的方法。我知道移动标签的唯一方法是从标签中删除文件，然后再次复制。修订树浏览器似乎不能很好地处理这个问题。这也需要保持主干和标签下的目录结构同步。

用例：我们有数千个“地图”，我们想要标记每个地图的哪个版本是“生产”版本。我们需要能够轻松获得所有地图的生产版本。

任何人都可以提出更好的方法来解决我们的用例吗？我也考虑了属性，但是我们无法轻松获得所有文件的 prod 版本。合并到标签似乎也不是很容易。（最初发布到[http://jamesjava.blogspot.com/2007/12/subversion-moving-tags.html](http://jamesjava.blogspot.com/2007/12/subversion-moving-tags.html)）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-15T12:55:15.517

我认为不需要从生产标签中“删除”文件。您应该将新文件复制到现有文件上并将其签入。这样您将保留历史记录。

当然，您需要签出生产标签才能执行此操作。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-15T12:58:39.987

我认为你永远无法用颠覆的运作方式做到这一点。我相信最好的解决方案是查看像[git](http://git.or.cz/)这样的工具，它似乎适合您的用例。您的生产系统可以“拉入”被接受的“地图”。虽然我意识到这不是颠覆，但使用 git 可能比 svn 更符合您的使用模式。

关于为什么 git 的基于 pull 的开发模型更适合您的场景的一篇非常好的文章在[这里](http://utsl.gen.nz/talks/git-svn/intro.html)。

还有关于如何像[这样](http://git.or.cz/course/svn.html)开始迁移的教程。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-15T13:06:28.610

这不是颠覆的好用处。

Subversion 标签用于为树的实例命名，就像其历史中的特定快照一样，并且应该保持静态。

也许您可以使用当前日期或递增数字作为标签的一部分？您可以在包含任何特定日期的生产版本的标签下有一个目录。以最新日期作为当前生产版本。

今天的版本可以在

```
/svn/tags/production/2008/09/15/mapproject 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-19T04:13:07.843

我认为您正在尝试解决错误的问题。

听起来您有一个包含尚未发布的地图版本的主干，当您发布时，您想从主干上的所有可能更新中挑选要更新的地图。

假设是这种情况，请创建一个名为“Release”的分支。（考虑创建一个新的空目录，并复制所需的每个地图版本（使用单独的 svn cp 命令），如果这样会更快）。

现在您在分支中有当前版本。用“Release XXX”标记它（svn cp 整个目录），其中 XXX 是您最新版本的有意义的 ID。

然后，当地图被批准用于下一个版本时，将它们 svn cp 到您的发布分支。我假设您不想使用合并，因为映射离散元素而不是源代码。

在下一次发布时，您可以再次标记。

现在您知道最新批准的地图是什么以及每个版本中的内容。如果你*真的*不记得最新的版本号，并且你可以想出一个你需要知道的时间而不只是查看标签目录，你可以创建一个标签 svn cp 最新版本，然后把它吹走并在下一次发布时重新复制。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-15T13:03:29.040

为什么不为当前的生产版本制作一个新标签？请记住，Subversion 不是 CVS。因此，制作完整目录树的副本不会花费您任何费用。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-15T13:51:22.887

一种方法是转向“稳定的主干”模型。

*   从主干做一个分支作为你的工作区域。
*   停止直接向主干提交 - 让每个人都切换到开发分支。
*   由管理稳定版本的人员检查主干，确保他们具有提交权限。
*   当您希望“发布”地图时，请使用“重新整合合并”将更改拉入该文件/目录并提交更改。

这可能看起来有点颠倒，但相当可行。您可以让生产机器直接从主干中提取，或者为每个版本从主干制作一个新标签。对于后者，您将需要某种方式将新标签传达给生产机器。某种消息传递、共享配置或命名约定可能会起作用。

但请注意，在此模型中，您必须进入树干有点“神圣”的心态。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-15T14:12:22.040

如果我很了解您的需求，我认为最好的方法是将所有地图作为主干的外部，然后制作一个脚本，将每个地图（外部）递归标记到工作副本中的当前修订版（或者服务器，如果你想要那样的话）。

# c++ - C ++中的整数的三维数组

> ID：62512
> 
> 赞同：7
> 
> 时间：2008-09-15T12:50:19.367
> 
> 标签：c++, arrays, multidimensional-array

我想找到在 C++ 中实现整数的三维数组的安全方法，使用指针算术/动态内存分配，或者使用`STL`向量等技术。

本质上，我希望我的整数数组维度看起来像：

```
[ x ][ y ][ z ] 
```

x 和 y 在 20-6000 范围内 z 是已知的并且等于 4。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-09-15T12:52:34.667

看看 Boost[多维数组](http://www.boost.org/doc/libs/release/libs/multi_array)库。这是一个示例（改编自 Boost 文档）：

```
#include "boost/multi_array.hpp"

int main() {
  // Create a 3D array that is 20 x 30 x 4
  int x = 20;
  int y = 30;
  int z = 4;

  typedef boost::multi_array<int, 3> array_type;
  typedef array_type::index index;
  array_type my_array(boost::extents[x][y][z]);

  // Assign values to the elements
  int values = 0;
  for (index i = 0; i != x; ++i) {
    for (index j = 0; j != y; ++j) {
      for (index k = 0; k != z; ++k) {
        my_array[i][j][k] = values++;
      }
    }
  }
} 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-15T13:00:30.777

每对方括号都是一个解引用操作（当应用于指针时）。例如，以下代码对是等效的：

```
x = myArray[4];
x = *(myArray+4); 
```

```
x = myArray[2][7];
x = *((*(myArray+2))+7); 
```

要使用您建议的语法，您只需取消引用从第一次取消引用返回的值。

```
int*** myArray = (some allocation method, keep reading);
//
// All in one line:
int   value = myArray[x][y][z];
//
// Separated to multiple steps:
int** deref1 = myArray[x];
int*  deref2 = deref1[y];
int   value = deref2[z]; 
```

要分配这个数组，你只需要认识到你实际上没有一个整数的三维数组。你有一个由整数数组组成的数组。

```
// Start by allocating an array for array of arrays
int*** myArray = new int**[X_MAXIMUM];

// Allocate an array for each element of the first array
for(int x = 0; x < X_MAXIMUM; ++x)
{
    myArray[x] = new int*[Y_MAXIMUM];

    // Allocate an array of integers for each element of this array
    for(int y = 0; y < Y_MAXIMUM; ++y)
    {
        myArray[x][y] = new int[Z_MAXIMUM];

        // Specify an initial value (if desired)
        for(int z = 0; z < Z_MAXIMUM; ++z)
        {
            myArray[x][y][z] = -1;
        }
    }
} 
```

取消分配此数组遵循与分配类似的过程：

```
for(int x = 0; x < X_MAXIMUM; ++x)
{
    for(int y = 0; y < Y_MAXIMUM; ++y)
    {
        delete[] myArray[x][y];
    }

    delete[] myArray[x];
}

delete[] myArray; 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2010-12-16T22:50:08.793

下面是一种使用 C 或 C++ 在每个数组的一块内存中创建 3D 数组的简单方法。不需要使用 BOOST（即使它很好），也不需要在具有多个间接的行之间分配分配（这非常糟糕，因为它在访问数据时通常会造成很大的性能损失并且它会碎片化内存）。

唯一要了解的是，没有多维数组之类的东西，只有数组的数组（数组）。最里面的索引是内存中最远的。

```
#include <stdio.h>
#include <stdlib.h>

int main(){

    {
        // C Style Static 3D Arrays
        int a[10][20][30];
        a[9][19][29] = 10;
        printf("a[9][19][29]=%d\n", a[9][19][29]);
    }

    {
        // C Style dynamic 3D Arrays
        int (*a)[20][30];
        a = (int (*)[20][30])malloc(10*20*30*sizeof(int));
        a[9][19][29] = 10;
        printf("a[9][19][29]=%d\n", a[9][19][29]);
        free(a);
    }

    {
        // C++ Style dynamic 3D Arrays
        int (*a)[20][30];
        a = new int[10][20][30];
        a[9][19][29] = 10;
        printf("a[9][19][29]=%d\n", a[9][19][29]);
        delete [] a;
    }

} 
```

对于您的实际问题，由于可能存在两个未知维度，因此我的建议存在问题，它只允许一个未知维度。有几种方法可以管理它。

好消息是使用变量现在可以在 C 中使用，它被称为变长数组。你看[这里](http://www.drdobbs.com/184401444;jsessionid=LAEWOLZQCC2AJQE1GHPSKH4ATMY32JVN)了解详情。

```
 int x = 100;
    int y = 200;
    int z = 30;

    {
        // C Style Static 3D Arrays 
        int a[x][y][z];
        a[99][199][29] = 10;
        printf("a[99][199][29]=%d\n", a[99][199][29]);
    }

    {
        // C Style dynamic 3D Arrays
        int (*a)[y][z];
        a = (int (*)[y][z])malloc(x*y*z*sizeof(int));
        a[99][199][29] = 10;
        printf("a[99][199][29]=%d\n", a[99][199][29]);
        free(a);
    } 
```

如果使用 C++，最简单的方法可能是使用运算符重载来坚持数组语法：

```
 {
        class ThreeDArray {
            class InnerTwoDArray {
                int * data;
                size_t y;
                size_t z;
                public:
                InnerTwoDArray(int * data, size_t y, size_t z)
                    : data(data), y(y), z(z) {}

                public:
                int * operator [](size_t y){ return data + y*z; }
            };

            int * data;
            size_t x;
            size_t y;
            size_t z;
            public:
            ThreeDArray(size_t x, size_t y, size_t z) : x(x), y(y), z(z) {
                data = (int*)malloc(x*y*z*sizeof data);
            }

            ~ThreeDArray(){ free(data); }

            InnerTwoDArray operator [](size_t x){
                return InnerTwoDArray(data + x*y*z, y, z);
            }
        };

        ThreeDArray a(x, y, z);
        a[99][199][29] = 10;
        printf("a[99][199][29]=%d\n", a[99][199][29]);
    } 
```

上面的代码访问 InnerTwoDArray 有一些间接成本（但一个好的编译器可能会优化它）但只使用一个内存块来分配在堆上的数组。这通常是最有效的选择。

显然，即使上面的代码仍然简单明了，STL 或 BOOST 也做得很好，因此无需重新发明轮子。我仍然相信知道它可以很容易地完成是很有趣的。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-15T13:08:26.407

使用向量：

```
std::vector< std::vector< std::vector< int > > > array3d; 
```

如果元素已经添加，则每个元素都可以通过 array3d[x][y][z] 访问。（例如通过 push_back）

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-15T13:06:41.310

应该注意的是，出于所有意图和目的，您只处理一个二维数组，因为第三个（也是最不重要的）维度是已知的。

如果您事先不知道数组的每个维度中有多少条目，则使用 STL 或 Boost 是非常好的方法，因为它们会给您动态内存分配，如果您的数据集是，我推荐这些方法中的任何一种保持基本不变，或者如果它主要只接收新条目而不是很多删除。

但是，如果您事先了解您的数据集，例如大约总共将存储多少项目，或者如果要稀疏填充数组，则最好使用某种散列/桶函数，并使用XYZ 索引作为您的关键。在这种情况下，假设每个维度不超过 8192（13 位）条目，您可以使用 40 位（5 字节）密钥。或者，假设总是有 4 x Z 条目，您只需使用 26 位 XY 密钥。这是速度、内存使用和动态分配之间更有效的权衡之一。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-15T13:35:20.973

与使用 new/delete 相比，使用 STL 管理内存有很多优点。如何表示数据的选择取决于您计划如何使用它。一个建议是隐藏实现决策并为一维 STL 向量提供三维 get/set 方法的类。

如果您确实认为需要创建自定义 3d 矢量类型，请先研究 Boost。

```
// a class that does something in 3 dimensions

class MySimpleClass
{
public:

  MySimpleClass(const size_t inWidth, const size_t inHeight, const size_t inDepth) :
   mWidth(inWidth), mHeight(inHeight), mDepth(inDepth)
   {
       mArray.resize(mWidth * mHeight * mDepth);
   }

  // inline for speed
  int Get(const size_t inX, const size_t inY, const size_t inZ) {
     return mArray[(inZ * mWidth * mHeight) + (mY * mWidth) + mX];
  }

  void Set(const size_t inX, const size_t inY, const size_t inZ, const int inVal) {
     return mArray[(inZ * mWidth * mHeight) + (mY * mWidth) + mX];
  }

  // doing something uniform with the data is easier if it's not a vector of vectors
  void DoSomething()
  {
     std::transform(mArray.begin(), mArray.end(), mArray.begin(), MyUnaryFunc);
  }

private:

  // dimensions of data
  size_t mWidth;
  size_t mHeight;
  size_t mDepth;

  // data buffer
  std::vector< int > mArray;
}; 
```

* * *

## 回答 #7

> 赞同：-2
> 
> 时间：2008-09-15T14:44:52.400

Pieter 的建议当然很好，但是您必须记住的一件事是，在构建大型阵列的情况下，它可能会很慢。每次向量容量发生变化时，都必须复制所有数据（“n”个向量向量）。

# api - 用于非基于 Web 的应用程序的 REST 类型 API，这是个好主意吗？

> ID：62513
> 
> 赞同：3
> 
> 时间：2008-09-15T12:50:19.583
> 
> 标签：api, rest, middleware

我们正在开发 C++ 和 Java 的中间件 SDK，供游戏开发人员、动画软件开发人员、Avatar 开发人员等用作库/DLL 以增强他们的产品。

在使用对特定函数的特定调用创建典型 API 之后，我正在考虑通过使用 REST 类型 API（GET、PUT、POST、DELETE）或 CRUD 类型（CREATE、READ、UPDATE、DELETE）接口来简化 API。

这与客户端-服务器类型 REST API 的工作方式类似，其中只有 4 个可能的 API 调用，但这些调用可以采用灵活的参数。

这似乎具有使 API 稳定的好处，因为不会添加新调用并且不会删除旧调用。因此，此 API 的使用者不必担心必须重新编译和更改他们的代码以适应我们中间件的任何更新。

开销是中间件控制器中有一个额外的重定向层来路由 API 调用，开发人员需要知道每个 REST 调用可用的参数（当然提供）。

到目前为止，我还没有看到这个系统在 Web 类型的客户端服务器应用程序之外使用，所以我的问题是：这是一个可行的想法吗？

我正在考虑它的效率以及例如游戏开发人员是否会发现它易于使用。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-15T13:09:09.773

是的，这是一个可行的想法。但我不确定这些好处是否能证明成本是合理的。REST 最适合应用于网络应用场景，以请求和响应为导向。虽然统一接口具有一定的学习曲线优势，但这些优势几乎可以存在于任何精心设计的提供合理抽象过程的 API 中。

您还表达了对游戏开发人员是否会发现 RESTful API 易于使用的担忧。我会半信半疑。我已经实现了许多 RESTful Web 服务，并帮助许多开发人员加快了构建和使用它们的速度，掌握 REST 所需的概念飞跃对于多年来一直沉浸在过程 API 中的人来说可能是巨大的。我认为游戏开发人员尤其会与程序 API 紧密相连，以至于尝试采用不同的范式，无论它有什么好处，都可能证明是极其困难的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-07-23T14:27:19.480

请记住，REST 并非特定于 HTTP，并且不仅仅依赖于 4 个 HTTP 动词。您拥有和可以使用的动词取决于您使用的协议。

# ruby-on-rails - Ruby on Rails 中模型设计的最佳实践

> ID：62529
> 
> 赞同：8
> 
> 时间：2008-09-15T12:52:15.867
> 
> 标签：ruby-on-rails, ruby, activerecord

RoR 教程为每个表假设一个模型以供 ORM 工作。我的数据库模式有大约 70 个表，在概念上分为 5 组功能（例如，任何给定的表都存在于一个且只有一个功能组中，并且不同组的表之间的关系被最小化。）所以：我应该为每个概念组设计一个模型吗？ ，或者我应该简单地拥有 70 个 Rails 模型并保留分组“概念”？谢谢！

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-15T13:08:37.233

最有可能的是，您应该有 70 个模型。您可以将模型命名为具有 5 个命名空间，每个组一个，但这可能比它的价值更麻烦。更有可能的是，您在每个组中都有一些共同的功能。在这种情况下，我会为每个包含其行为的组创建一个模块，并将其包含在每个相关模型中。即使没有共享功能，这样做也可以让您快速查询模型的概念组。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-19T04:38:04.023

我通过确保表/模型在概念上按名称分组（具有几乎 1:1 的表模型关系），在我的一个大型应用程序中涵盖了这一点。例子：

```
events
event_types
event_groups
event_attendees
etc... 
```

这样，当我使用 TextMate 或其他任何东西时，模型文件就会按 alpha 排序很好地组合在一起。我在这个应用程序中有 80 个模型，它运行良好，足以让事情井井有条。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-09-15T13:14:42.070

为了充分利用 ActiveRecord 的所有魔力，您绝对应该为每个表使用一个模型。

但是您也可以使用模块和子目录将模型组合到命名空间中，以避免必须管理模型目录中的 70 个文件。

例如，您可以：

```
app/models/admin/user.rb
app/models/admin/group.rb 
```

对于模型 Admin::User 和 Admin::Group，以及

```
app/models/publishing/article.rb
app/models/publishing/comment.rb 
```

出版::文章和出版::评论

等等……

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-15T18:16:59.317

如果不了解有关 70 个表的性质及其概念关系的更多详细信息，实际上不可能给出一个好的答案。这些是旧表还是您从头开始设计的？

这些表是通过某种继承模式相关的还是可能是？Rails 可以进行有限形式的继承。查找单表继承 (STI)。

就个人而言，我会付出很多努力来避免使用 70 个表，因为那是一项非常大量的工作——70 个模型和控制器以及它们的 4 多个视图、助手、布局和测试，更不用说保持的内存负载问题了工业设计 当然，除非我按小时获得报酬，并且足以弥补重复。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-09-16T01:32:59.517

在开始制作 70 个模型之前，请考虑以下问题以帮助您做出决定：

您的每个表是否都被视为“对象”，例如“汽车”表，或者某些表仅包含关系信息，例如所有外键列？

在 Rails 中，只有“对象”表成为模型！（特定类型的关联有一些例外）因此，如果您只有 5 组功能，您很可能没有 70 个模型。此外，如果您提到的功能组大不相同，它们甚至可能最适合自己的应用程序。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-15T15:01:39.940

在少数情况下，您可以使用 Rails 标准的单表继承模型。也许一个特定功能组中的所有类都具有相同的字段（或几乎都相同）。在这种情况下，请利用 DRYness STI 提供的优势。但是，如果没有意义，请使用每表类。

在 class-per-table 版本中，您不能轻易地将常用功能拉入基类。相反，将其拉入一个模块。像下面这样的层次结构可能很有用：

```
app/models/admin/base.rb - module Admin::Base, included by all other Admin::xxx
app/models/admin/user.rb - class Admin::User, includes Admin::Base
app/models/admin/group.rb - class Admin::Group, includes Admin::Base 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-16T01:26:39.203

已经提到过，如果不知道您的数据库架构等，很难给出体面的建议，但是，我倾向于创建 70 多个模型，（每个表一个。）

您也许可以放弃某些模型而侥幸逃脱，但对于成本（可以忽略不计），您不妨将它们放在那里。

您不需要为每个模型创建一个控制器 + 视图（由 srboisvert 回答）。每个资源只需要一个控制器（我希望它远少于 70 - 根据您的描述可能只有 10 或 15 个左右）。

# ajax - 如何防止 IE6 重新获取通过 DOM 操作添加的已获取图像

> ID：62530
> 
> 赞同：1
> 
> 时间：2008-09-15T12:52:17.100
> 
> 标签：ajax, image, caching, internet-explorer-6

如果您将图像添加到浏览器的 DOM，IE6 将不会检查其缓存以查看它是否已经下载了图像，而是会从服务器重新检索它。我还没有找到任何 HTTP 响应标头（随后的图像请求）的组合来说服 IE6 它可以缓存图像：缓存控制、过期、上次修改。

有人建议您可以返回 304 的后续图像请求以告诉 IE6“您已经得到它”，但我想首先避免整个往返服务器。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-16T18:10:47.593

也许[这](http://www.mister-pixel.com/index.php?Content__state=is_that_simple)会起作用？（与悬停在带有 CSS 背景图像的链接上的行为相同）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-15T13:24:55.680

一个快速的谷歌提到了你已经尝试过的“过期”标题。深入挖掘，它提到了 ETag 标头：

[http://mir.aculo.us/2005/08/28/internet-explorer-and-ajax-image-caching-woes](http://mir.aculo.us/2005/08/28/internet-explorer-and-ajax-image-caching-woes)

希望这可以帮助。

# xml - 使用 ksh 解析 XML 的成本最低的跨平台方法是什么？

> ID：62534
> 
> 赞同：1
> 
> 时间：2008-09-15T12:52:50.797
> 
> 标签：xml, ksh

需要从 ksh 脚本中解析一些基本的 XML（一个根元素，3-4 个子元素，每个 1-3 个属性）（理想情况下坚持使用 ksh，因为脚本已经存在并且它只是试图读取一些在 XML 中创建的额外配置）另一个程序）。

我知道我可以使用 sed 并进行模式匹配，但考虑到输入 XML 可能会更改并且属性可能会在各种子元素（或新子元素）上重复，这并不是万无一失的。

到目前为止，我正在考虑使用针对 XML 的 XSLT 来提取 ksh 脚本作为单个字段关心的少数属性（针对特定元素）。鉴于我们是数据库驱动的产品，我可以为此使用 Oracle，并且 Oracle 将始终安装在我们的系统上，但这似乎有点笨拙。

以跨平台方式从输入 XML 中提取特定属性的任何其他安全方法不需要访问第 3 方解析器/转换器？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-11T16:29:32.713

如果将其全部保存在 shell 脚本中很重要，您可能想看看这个[纯 bash 实现。](http://www.linuxfromscratch.org/pipermail/alfs-discuss/2006-January/007537.html)

也就是说，其他脚本语言（如 Python 和 Perl）也具有高度可移植性，会让您的生活更轻松。例如， Perl 的[XML::Twig](http://xmltwig.com/xmltwig/)模块带有一个名为“xml_grep”的最终用户脚本，它已经可以通过`--text_only`选项来提取从复杂搜索中找到的节点的文本。修改它以返回指定的属性应该不会那么难。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-14T18:01:16.223

根据您对“解析”的含义，[XMLStarlet](http://xmlstar.sourceforge.net/)可能是一个不错的选择。它完全由命令行驱动，支持选择和编辑 XML 文件以及 XSLT。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-15T13:16:38.867

不能完全在 ksh 中完成，但尝试 python xml？

如果你想要轻量级，你可以试试 libxml2 和一个小的 C 程序。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-12-07T11:43:41.230

而是使用CSV进行解析，不仅可以简化逻辑，而且可以轻松实现从xls到csv的转换。

# oop - 什么是依赖倒置原则，为什么它很重要？

> ID：62539
> 
> 赞同：203
> 
> 时间：2008-09-15T12:53:20.030
> 
> 标签：oop, solid-principles, glossary, principles, dependency-inversion

什么是依赖倒置原则，为什么它很重要？

* * *

## 回答 #1

> 赞同：147
> 
> 时间：2009-07-11T15:20:24.303

敏捷软件开发、原则、模式和实践以及 C# 中的敏捷原则、模式和实践这本书是充分理解依赖倒置原则背后的原始目标和动机的最佳资源。文章“依赖倒置原则”也是一个很好的资源，但由于它是最终进入前面提到的书籍的草稿的浓缩版本，它遗漏了一些关于“依赖倒置”概念的重要讨论。包和接口所有权是区分这一原则与更一般的建议的关键，即在设计模式（Gamma 等人）一书中找到的“编程到接口，而不是实现”。

总结一下，依赖倒置原则主要是关于将传统的依赖方向从“高级”组件**反**转到“低级”组件，这样“低级”组件依赖于“高级”组件**拥有**的接口. （注意：这里的“更高级别”组件是指需要外部依赖/服务的组件，不一定是它在分层架构中的概念位置。）这样做，耦合并没有**减少**太多，而是从理论上的组件**转移**对理论上更有价值的组件价值较低。

这是通过设计组件来实现的，这些组件的外部依赖关系用接口表示，组件的使用者必须为其提供实现。换句话说，定义的接口表达了组件需要什么，而不是你如何使用组件（例如“INeedSomething”，而不是“IDoSomething”）。

依赖倒置原则没有提到的是通过使用接口来抽象依赖的简单实践（例如MyService → [ILogger ⇐ Logger]）。虽然这将组件与依赖项的特定实现细节解耦，但它并没有颠倒消费者和依赖项之间的关系（例如 [MyService → IMyServiceLogger] ⇐ Logger.

依赖倒置原则的重要性可以归结为一个单一的目标，即能够重用依赖外部依赖来实现部分功能（日志记录、验证等）的软件组件。

在这个重用的总体目标中，我们可以描述两种重用的子类型：

1.  在具有子依赖实现的多个应用程序中使用软件组件（例如，您已经开发了一个 DI 容器并希望提供日志记录，但不想将您的容器耦合到特定的记录器，这样使用您容器的每个人都必须也使用您选择的日志库）。

2.  在不断发展的环境中使用软件组件（例如，您开发的业务逻辑组件在实现细节不断发展的应用程序的多个版本中保持不变）。

对于跨多个应用程序重用组件的第一种情况，例如使用基础架构库，目标是为您的消费者提供核心基础架构需求，而不会将您的消费者耦合到您自己库的子依赖项，因为对此类依赖项进行依赖需要您的消费者也需要相同的依赖项。当您的库的使用者选择使用不同的库来满足相同的基础架构需求（例如 NLog 与 log4net），或者如果他们选择使用与该版本不向后兼容的所需库的更高版本时，这可能会出现问题您的图书馆需要。

对于重用业务逻辑组件（即“更高级别的组件”）的第二种情况，目标是将应用程序的核心域实现与实现细节的不断变化的需求（即更改/升级持久性库、消息传递库）隔离开来、加密策略等）。理想情况下，更改应用程序的实现细节不应破坏封装应用程序业务逻辑的组件。

注意：有些人可能反对将第二种情况描述为实际重用，理由是在单个不断发展的应用程序中使用的诸如业务逻辑组件之类的组件仅代表一次使用。然而，这里的想法是，对应用程序实现细节的每次更改都会呈现一个新的上下文，因此会呈现一个不同的用例，尽管最终目标可以区分为隔离与可移植性。

虽然在第二种情况下遵循依赖倒置原则可以提供一些好处，但应该注意的是，它应用于现代语言（如 Java 和 C#）的价值大大降低，可能到了无关紧要的地步。如前所述，DIP 涉及将实现细节完全分离到单独的包中。然而，在不断发展的应用程序的情况下，简单地使用根据业务域定义的接口将防止由于实现细节组件的需求变化而需要修改更高级别的组件，即使实现细节最终位于同一个包中. 原则的这一部分反映了与新语言无关的原则被编纂时所考虑的语言相关的方面（即 C++）。也就是说，

可以在[此处](http://aspiringcraftsman.com/2008/12/28/examining-dependency-inversion/)找到对该原则的更长讨论，因为它涉及接口的简单使用、依赖注入和分离接口模式。此外，可以在[此处](http://aspiringcraftsman.com/2012/01/22/solid-javascript-the-dependency-inversion-principle/)找到有关该原理如何与 JavaScript 等动态类型语言相关的讨论。

* * *

## 回答 #2

> 赞同：116
> 
> 时间：2008-09-15T12:57:45.667

查看此文档：[依赖倒置原则](https://drive.google.com/file/d/0BwhCYaYDn8EgMjdlMWIzNGUtZTQ0NC00ZjQ5LTkwYzQtZjRhMDRlNTQ3ZGMz/view)。

它基本上说：

*   高级模块不应依赖于低级模块。两者都应该依赖于抽象。
*   抽象永远不应该依赖于细节。细节应该取决于抽象。

至于为什么它很重要，简而言之：更改是有风险的，并且通过依赖于概念而不是实现，您可以减少呼叫站点的更改需求。

有效地，DIP 减少了不同代码段之间的耦合。这个想法是，虽然有很多方法可以实现，比如一个日志工具，但你使用它的方式应该在时间上是相对稳定的。如果您可以提取一个表示日志记录概念的接口，则该接口在时间上应该比其实现更稳定，并且调用站点应该受到您在维护或扩展该日志记录机制时所做的更改的影响要小得多。

通过使实现也依赖于接口，您可以在运行时选择更适合您的特定环境的实现。根据具体情况，这也可能很有趣。

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2016-09-10T18:50:58.390

当我们设计软件应用程序时，我们可以考虑实现基本和主要操作（磁盘访问、网络协议……）的低级类和封装复杂逻辑（业务流程……）的类。

最后一个依赖于低级类。实现这种结构的一种自然方式是编写低级类，一旦我们让它们编写复杂的高级类。由于高级类是根据其他类定义的，这似乎是合乎逻辑的方法。但这不是一个灵活的设计。如果我们需要替换一个低级类会发生什么？

依赖倒置原则指出：

*   高级模块不应依赖于低级模块。两者都应该依赖于抽象。
*   抽象不应依赖于细节。细节应该取决于抽象。

该原则旨在“颠倒”软件中高级模块应依赖于低级模块的传统观念。这里高层模块拥有由低层模块实现的抽象（例如，决定接口的方法）。从而使较低级别的模块依赖于较高级别的模块。

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2016-02-12T06:12:11.217

良好应用的依赖倒置在应用程序的整个架构级别提供了灵活性和稳定性。它将允许您的应用程序更安全和稳定地发展。

## 传统分层架构

传统上，分层架构 UI 依赖于业务层，而这又依赖于数据访问层。

[![](https://i.stack.imgur.com/6e2K9.png)](https://i.stack.imgur.com/6e2K9.png)

您必须了解层、包或库。让我们看看代码是怎样的。

我们将有一个用于数据访问层的库或包。

```
// DataAccessLayer.dll
public class ProductDAO {

} 
```

还有另一个依赖于数据访问层的库或包层业务逻辑。

```
// BusinessLogicLayer.dll
using DataAccessLayer;
public class ProductBO { 
    private ProductDAO productDAO;
} 
```

## 依赖倒置的分层架构

依赖倒置表示以下内容：

> 高级模块不应该依赖于低级模块。两者都应该依赖于抽象。

> 抽象不应该依赖于细节。细节应该取决于抽象。

什么是高级模块和低级模块？考虑诸如库或包之类的模块，高级模块将是那些传统上具有依赖关系和它们所依赖的低级模块。

换句话说，模块高层是调用动作的地方，而低层是执行动作的地方。

从这个原则得出的一个合理的结论是，混凝土之间不应该有依赖关系，但必须依赖抽象。但是根据我们采用的方法，我们可能会误用投资依赖依赖，而是一种抽象。

想象一下，我们调整我们的代码如下：

我们将有一个用于定义抽象的数据访问层的库或包。

```
// DataAccessLayer.dll
public interface IProductDAO
public class ProductDAO : IProductDAO{

} 
```

还有另一个依赖于数据访问层的库或包层业务逻辑。

```
// BusinessLogicLayer.dll
using DataAccessLayer;
public class ProductBO { 
    private IProductDAO productDAO;
} 
```

尽管我们依赖于业务和数据访问之间的抽象依赖关系保持不变。

[![](https://i.stack.imgur.com/6e2K9.png)](https://i.stack.imgur.com/6e2K9.png)

要获得依赖倒置，必须在此高级逻辑或域所在的模块或包中定义持久性接口，而不是在低级模块中。

首先定义领域层是什么，其通信的抽象定义为持久性。

```
// Domain.dll
public interface IProductRepository;

using DataAccessLayer;
public class ProductBO { 
    private IProductRepository productRepository;
} 
```

在持久层依赖于域之后，如果定义了依赖关系，现在就开始反转。

```
// Persistence.dll
public class ProductDAO : IProductRepository{

} 
```

[![](https://i.stack.imgur.com/c7Xln.png)](https://i.stack.imgur.com/c7Xln.png)
[（来源：[xurxodev.com](https://xurxodev.com/content/images/2016/02/Dependency-Inversion-Layers.png)）]

## 深化原则

重要的是要很好地吸收这个概念，深化目的和好处。如果我们停留在机械地学习典型案例库，我们将无法确定在哪里可以应用依赖原则。

但是为什么我们要反转依赖呢？除了具体例子之外，主要目标是什么？

这样通常**允许最稳定的事物，不依赖于不太稳定的事物，更频繁地改变。**

更改持久性类型（数据库或访问同一数据库的技术）比更改域逻辑或旨在与持久性通信的操作更容易。因此，依赖关系被反转，因为如果发生这种变化，更容易改变持久性。这样，我们就不必更改域。领域层是最稳定的，这就是为什么它不应该依赖任何东西。

但不仅仅是这个存储库示例。这个原则适用的场景很多，也有基于这个原则的架构。

## 架构

在某些架构中，依赖倒置是其定义的关键。在所有领域中，它是最重要的，它是指示领域与定义的其余包或库之间的通信协议的抽象。

### 清洁架构

在[Clean 架构](https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html)中，域位于中心，如果您沿着指示依赖关系的箭头方向看，很明显哪些是最重要和最稳定的层。外层被认为是不稳定的工具，因此请避免依赖它们。

[![](https://i.stack.imgur.com/uNQZQ.jpg)](https://i.stack.imgur.com/uNQZQ.jpg)
[（来源：[8thlight.com](https://8thlight.com/blog/)）]

### 六边形结构

六边形架构也是如此，其中域也位于中心部分，端口是从多米诺骨牌向外通信的抽象。在这里，很明显域是最稳定的，并且传统的依赖是倒置的。

[![](https://i.stack.imgur.com/cDymr.jpg)](https://i.stack.imgur.com/cDymr.jpg)
[（来源：[pragprog.com](https://a.pragprog.com/magazines/2009-12/images/HexagonalArchitecture__bbe7fy__.jpg)）]

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2009-08-30T22:30:49.157

[对我来说，官方文章](http://www.objectmentor.com/resources/articles/dip.pdf)中描述的依赖倒置原则实际上是一种误导性的尝试，旨在提高本质上可重用性较低的模块的可重用性，也是一种解决 C++ 语言问题的方法。

C++ 中的问题是头文件通常包含私有字段和方法的声明。因此，如果高级 C++ 模块包含低级模块的头文件，它将取决于该模块的实际**实现**细节。显然，这不是一件好事。但这在当今常用的更现代的语言中不是问题。

高级模块本质上不如低级模块可重用，因为前者通常比后者更特定于应用程序/上下文。例如，实现 UI 屏幕的组件是最高级别的，并且非常（完全？）特定于应用程序。试图在不同的应用程序中重用这样的组件会适得其反，并且只会导致过度设计。

因此，只有在组件 A 对在不同的应用程序或上下文中重用真正有用的情况下，才能在组件 A 的同一级别创建依赖于组件 B（不依赖于 A）的单独抽象。如果不是这样，那么应用 DIP 将是糟糕的设计。

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2015-07-09T16:49:17.307

基本上它说：

类应该依赖于抽象（例如接口、抽象类），而不是具体的细节（实现）。

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2016-05-17T17:48:12.480

说明依赖倒置原则的更清晰的方法是：

封装复杂业务逻辑的模块不应直接依赖于封装业务逻辑的其他模块。相反，它们应该只依赖于简单数据的接口。

即，而不是`Logic`像人们通常那样实现你的类：

```
class Dependency { ... }
class Logic {
    private Dependency dep;
    int doSomething() {
        // Business logic using dep here
    }
} 
```

您应该执行以下操作：

```
class Dependency { ... }
interface Data { ... }
class DataFromDependency implements Data {
    private Dependency dep;
    ...
}
class Logic {
    int doSomething(Data data) {
        // compute something with data
    }
} 
```

`Data`并且`DataFromDependency`应该与 位于同一模块中`Logic`，而不是与`Dependency`.

为什么要这样做？

1.  这两个业务逻辑模块现在解耦了。更改时`Dependency`，您无需更改`Logic`.
2.  了解什么`Logic`是一个更简单的任务：它只在看起来像 ADT 的东西上运行。
3.  `Logic`现在可以更容易地进行测试。您现在可以直接`Data`使用假数据进行实例化并将其传入。无需模拟或复杂的测试脚手架。

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2009-01-20T20:06:37.357

其他人已经在这里给出了很好的答案和很好的例子。

[DIP](http://en.wikipedia.org/wiki/Dependency_inversion_principle)之所以重要，是因为它确保了 OO 原则“松散耦合设计”。

软件中的对象不应进入层次结构，其中某些对象是顶级对象，依赖于低级对象。然后，低级对象的更改会波及到您的顶级对象，这使得软件对更改非常脆弱。

您希望您的“顶级”对象非常稳定且不易更改，因此您需要反转依赖关系。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-09-15T13:01:55.890

[控制反转](http://en.wikipedia.org/wiki/Inversion_of_Control)(IoC) 是一种设计模式，其中对象由外部框架传递其依赖关系，而不是向框架询问其依赖关系。

使用传统查找的伪代码示例：

```
class Service {
    Database database;
    init() {
        database = FrameworkSingleton.getService("database");
    }
} 
```

使用 IoC 的类似代码：

```
class Service {
    Database database;
    init(database) {
        this.database = database;
    }
} 
```

IoC 的好处是：

*   您不依赖于中央框架，因此可以根据需要进行更改。
*   由于对象是通过注入创建的，最好使用接口，因此很容易创建单元测试，用模拟版本替换依赖项。
*   解耦代码。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2021-03-25T22:51:31.987

**依赖倒置原则（DIP）**

它是 SOLID [^([About])](https://stackoverflow.com/a/66087638/4770877)的一部分，它是 OOD 的一部分，由 Bob 大叔介绍。它是关于类（层......）之间的**松散耦合。**类不应该依赖于**具体**实现，类应该依赖于**抽象/接口**

问题：

```
//A -> B
class A {
  B b

  func foo() {
     b = B();
  }
} 
```

解决方案：

```
//A -> IB <|- B
//client[A -> IB] <|- B is the Inversion 
class A {
  IB ib // An abstraction between High level module A and low level module B

  func foo() {
     ib = B()
  }
} 
```

现在`A`不依赖`B`（一对一），现在`A`依赖于`IB`由实现的接口`B`，这意味着A依赖于`IB`（一对多）的多个实现

[[DIP vs DI vs IoC]](https://stackoverflow.com/a/67401178/4770877)

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-09-15T12:59:57.317

依赖倒置的重点是制作可重用的软件。

这个想法是，它们不是依赖于彼此的两段代码，而是依赖于一些抽象的接口。然后，您可以重复使用其中的任何一个而无需另一个。

最常见的实现方式是通过控制反转 (IoC) 容器，如 Java 中的 Spring。在这个模型中，对象的属性是通过 XML 配置来设置的，而不是对象走出去寻找它们的依赖关系。

想象一下这个伪代码......

```
public class MyClass
{
  public Service myService = ServiceLocator.service;
} 
```

MyClass 直接依赖于 Service 类和 ServiceLocator 类。如果您想在另一个应用程序中使用它，它需要这两个。现在想象这个...

```
public class MyClass
{
  public IService myService;
} 
```

现在，MyClass 依赖于一个接口，即 IService 接口。我们会让 IoC 容器实际设置该变量的值。

所以现在，MyClass 可以很容易地在其他项目中重用，而不会带来其他两个类的依赖关系。

更好的是，您不必拖动 MyService 的依赖项，以及这些依赖项的依赖项，而且……嗯，你明白了。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2020-01-15T17:38:29.990

如果我们可以认为公司的“高级”员工因执行他们的计划而获得报酬，并且这些计划是由许多“低级”员工计划的总执行来交付的，那么我们可以说如果高层员工的计划描述以任何方式与任何低层员工的具体计划相结合，这通常是一个糟糕的计划。

如果一个高层管理人员有一个“改善交货时间”的计划，并指出航运公司的员工必须每天早上喝咖啡并做伸展运动，那么该计划是高度耦合的，凝聚力低。但是，如果计划没有提及任何特定的员工，而实际上只是要求“一个可以执行工作的实体准备工作”，那么该计划就是松散耦合且更具凝聚力：计划不会重叠并且可以很容易地被替代. 承包商或机器人可以轻松取代员工，高层的计划保持不变。

依赖倒置原则中的“高级”意味着“更重要”。

* * *

## 回答 #13

> 赞同：-1
> 
> 时间：2019-04-13T14:46:29.583

依赖倒置：依赖于抽象，而不是具体。

控制反转：主要与抽象，以及主要如何成为系统的粘合剂。

![DIP 和 IoC](https://i.stack.imgur.com/qU57n.png)

这些是一些谈论这个的好帖子：

[https://coderstower.com/2019/03/26/dependency-inversion-why-you-shouldnt-avoid-it/](https://coderstower.com/2019/03/26/dependency-inversion-why-you-shouldnt-avoid-it/)

[https://coderstower.com/2019/04/02/main-and-abstraction-the-decoupled-peers/](https://coderstower.com/2019/04/02/main-and-abstraction-the-decoupled-peers/)

[https://coderstower.com/2019/04/09/inversion-of-control-putting-all-together/](https://coderstower.com/2019/04/09/inversion-of-control-putting-all-together/)

* * *

## 回答 #14

> 赞同：-1
> 
> 时间：2020-04-17T08:24:15.513

我可以看到上面的答案已经给出了很好的解释。但是我想用简单的例子提供一些简单的解释。

***依赖倒置原则允许程序员去除硬编码的依赖，使应用程序变得松散耦合和可扩展。***

**如何实现：**通过抽象

**没有依赖倒置：**

```
 class Student {
    private Address address;

    public Student() {
        this.address = new Address();
    }
}
class Address{
    private String perminentAddress;
    private String currentAdrress;

    public Address() {
    }
} 
```

***在上面的代码片段中，地址对象是硬编码的。相反，如果我们可以使用依赖倒置并通过构造函数或 setter 方法注入地址对象。让我们来看看。***

**依赖倒置：**

```
class Student{
    private Address address;

    public Student(Address address) {
        this.address = address;
    }
    //or
    public void setAddress(Address address) {
        this.address = address;
    }
} 
```

* * *

## 回答 #15

> 赞同：-2
> 
> 时间：2019-03-01T12:32:40.343

依赖倒置原则（DIP）说

i) 高级模块不应依赖于低级模块。两者都应该依赖于抽象。

ii) 抽象不应该依赖于细节。细节应该取决于抽象。

例子：

```
 public interface ICustomer
    {
        string GetCustomerNameById(int id);
    }

    public class Customer : ICustomer
    {
        //ctor
        public Customer(){}

        public string GetCustomerNameById(int id)
        {
            return "Dummy Customer Name";
        }
    }

    public class CustomerFactory
    {
        public static ICustomer GetCustomerData()
        {
            return new Customer();
        }
    }

    public class CustomerBLL
    {
        ICustomer _customer;
        public CustomerBLL()
        {
            _customer = CustomerFactory.GetCustomerData();
        }

        public string GetCustomerNameById(int id)
        {
            return _customer.GetCustomerNameById(id);
        }
    }

    public class Program
    {
        static void Main()
        {
            CustomerBLL customerBLL = new CustomerBLL();
            int customerId = 25;
            string customerName = customerBLL.GetCustomerNameById(customerId);

            Console.WriteLine(customerName);
            Console.ReadKey();
        }
    } 
```

注意：类应该依赖于接口或抽象类之类的抽象，而不是具体的细节（接口的实现）。

* * *

## 回答 #16

> 赞同：-2
> 
> 时间：2019-06-17T11:17:48.863

除了一连串通常很好的答案之外，我想添加一个我自己的小样本来展示好与坏的做法。是的，我不是扔石头的人！

假设您想要一个小程序通过控制台 I/O**将字符串转换为 base64 格式。**这是天真的方法：

```
class Program
{
    static void Main(string[] args)
    {
        /*
         * BadEncoder: High-level class *contains* low-level I/O functionality.
         * Hence, you'll have to fiddle with BadEncoder whenever you want to change
         * the I/O mode or details. Not good. A good encoder should be I/O-agnostic --
         * problems with I/O shouldn't break the encoder!
         */
        BadEncoder.Run();            
    }
}

public static class BadEncoder
{
    public static void Run()
    {
        Console.WriteLine(Convert.ToBase64String(Encoding.UTF8.GetBytes(Console.ReadLine())));
    }
} 
```

DIP 基本上说高级组件不应该依赖于低级实现，其中“级别”是根据 Robert C. Martin（“清洁架构”）与 I/O 的距离。但是你如何摆脱这种困境呢？只需使中央编码器仅依赖于接口，而无需打扰这些接口是如何实现的：

```
class Program
{
    static void Main(string[] args)
    {           
        /* Demo of the Dependency Inversion Principle (= "High-level functionality
         * should not depend upon low-level implementations"): 
         * You can easily implement new I/O methods like
         * ConsoleReader, ConsoleWriter without ever touching the high-level
         * Encoder class!!!
         */            
        GoodEncoder.Run(new ConsoleReader(), new ConsoleWriter());        }
}

public static class GoodEncoder
{
    public static void Run(IReadable input, IWriteable output)
    {
        output.WriteOutput(Convert.ToBase64String(Encoding.ASCII.GetBytes(input.ReadInput())));
    }
}

public interface IReadable
{
    string ReadInput();
}

public interface IWriteable
{
    void WriteOutput(string txt);
}

public class ConsoleReader : IReadable
{
    public string ReadInput()
    {
        return Console.ReadLine();
    }
}

public class ConsoleWriter : IWriteable
{
    public void WriteOutput(string txt)
    {
        Console.WriteLine(txt);
    }
} 
```

请注意，您无需触摸`GoodEncoder`即可更改 I/O 模式——该类对它知道的 I/O 接口感到满意；任何低级实现，`IReadable`并且`IWriteable`永远不会打扰它。

# testing - 什么是最好的免费测试跟踪软件？

> ID：62542
> 
> 赞同：22
> 
> 时间：2008-09-15T12:54:08.123
> 
> 标签：testing

我不是在谈论错误跟踪软件（如 Bugzilla 或 Jira）。我正在寻找的东西：

1.  以文本格式存储测试规范
2.  将测试规范组合到测试覆盖场景中
3.  通过测试场景跟踪进度
4.  将测试规范与存储在 Bugzilla 中的错误报告链接起来
5.  生成进度报告
6.  自行集中管理（即不是其他东西之上的黑客/扩展）

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-09-16T01:19:17.227

TestLink 是一个非常不错的开源测试跟踪工具，具有您需要的功能，并且仍在积极开发中。看看[http://testlink.org/](http://testlink.org/)

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-09-15T12:57:02.190

我还没有使用过这个（还），但[Testopia](http://www.mozilla.org/projects/testopia/)似乎可以满足您的所有要求，尤其是关于 Bugzilla 的要求。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2011-07-02T18:58:52.673

由于我是主要作者，所以我有偏见，但我认为[Cuanto](http://trackyourtests.com)还不错。它允许您跟踪多个测试项目的历史结果，并且您可以将分析与测试结果一起存储。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-10-22T20:29:53.503

[RTH](http://sourceforge.net/projects/rth/)是另一个开源测试管理工具

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-09-15T12:57:12.080

我个人使用过 Trac ( [http://trac.edgewall.org/](http://trac.edgewall.org/) )，它结合了一个简单的问题跟踪器和 Wiki 功能。解决了我对项目的需求。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-09-15T13:04:07.210

不久前，我简要查看了[QaTraq](http://www.softwaretesting.net/download/download.html)的免费版本。虽然我离开了我正在考虑的团队，但在我们每个人都对这个项目走得很远之前，它是我当时看到的选项的领跑者。

它有一个相当不错的界面，在我看来这是一个非常明智的测试计划结构。我认为最大的缺点之一是开源版本在所见即所得的测试用例编辑器中没有表格支持 - 不是一个炫耀的，可以通过一些开发工作或在专业版本上花费一些钱来修复。

# python - 忽略 Python 字符串中的大小写

> ID：62567
> 
> 赞同：52
> 
> 时间：2008-09-15T12:57:10.677
> 
> 标签：python, string, case-insensitive

在Python中比较字符串的最简单方法是什么，忽略大小写？

当然可以做 (str1.lower() <= str2.lower()) 等，但这会创建两个额外的临时字符串（具有明显的 alloc/gc 开销）。

我想我正在寻找与 C 的 stricmp() 等效的东西。

[需要更多上下文，所以我将用一个简单的例子来演示：]

假设您要对一个冗长的字符串列表进行排序。您只需执行 List.sort()。这是 O(n * log(n)) 字符串比较并且没有内存管理（因为所有字符串和列表元素都是某种智能指针）。你很快乐。

现在，您想做同样的事情，但忽略大小写（让我们简化并假设所有字符串都是 ascii，因此可以忽略语言环境问题）。您可以执行 theList.sort(key=lambda s: s.lower())，但是每次比较都会导致两个新的分配，加上重复（降低）字符串的垃圾收集器负担。每个这样的内存管理噪音都比简单的字符串比较慢几个数量级。

现在，使用就地类似 stricmp() 的函数，您可以执行以下操作：theList.sort(cmp=stricmp)，它与 ​​theList.sort() 一样快速且内存友好。你又快乐了。

问题是任何基于 Python 的不区分大小写的比较都涉及隐式字符串重复，所以我期待找到基于 C 的比较（可能在模块字符串中）。

找不到类似的东西，因此这里的问题。（希望这可以澄清问题）。

* * *

## 回答 #1

> 赞同：74
> 
> 时间：2008-09-23T14:32:08.267

这是一个基准，表明 using[`str.lower`](http://docs.python.org/2/library/string.html?highlight=lower#string.lower)比接受的答案的建议方法 ( `libc.strcasecmp`) 更快：

```
#!/usr/bin/env python2.7
import random
import timeit

from ctypes import *
libc = CDLL('libc.dylib') # change to 'libc.so.6' on linux

with open('/usr/share/dict/words', 'r') as wordlist:
    words = wordlist.read().splitlines()
random.shuffle(words)
print '%i words in list' % len(words)

setup = 'from __main__ import words, libc; gc.enable()'
stmts = [
    ('simple sort', 'sorted(words)'),
    ('sort with key=str.lower', 'sorted(words, key=str.lower)'),
    ('sort with cmp=libc.strcasecmp', 'sorted(words, cmp=libc.strcasecmp)'),
]

for (comment, stmt) in stmts:
    t = timeit.Timer(stmt=stmt, setup=setup)
    print '%s: %.2f msec/pass' % (comment, (1000*t.timeit(10)/10)) 
```

我机器上的典型时间：

```
235886 words in list
simple sort: 483.59 msec/pass
sort with key=str.lower: 1064.70 msec/pass
sort with cmp=libc.strcasecmp: 5487.86 msec/pass 
```

因此，具有 的版本`str.lower`不仅是迄今为止最快的，而且是此处提出的所有解决方案中最便携和最 Python 的。我没有分析内存使用情况，但原始海报仍然没有给出令人信服的理由来担心它。另外，谁说对 libc 模块的调用不会复制任何字符串？

注意：`lower()`字符串方法还具有依赖于语言环境的优点。在编写自己的“优化”解决方案时，您可能不会做对。即便如此，由于 Python 中的错误和缺失功能，这种比较可能会在 unicode 上下文中给出错误的结果。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-15T13:52:43.053

您是否在高性能敏感应用程序的非常频繁执行的路径中使用此比较？或者，您是否在兆字节大小的字符串上运行它？如果没有，那么你不应该担心性能，只需使用 .lower() 方法。

下面的代码演示了在我的 1.8GHz 台式计算机上，通过调用 .lower() 对两个大小几乎为兆字节的字符串进行不区分大小写的比较大约需要 0.009 秒：

```
from timeit import Timer

s1 = "1234567890" * 100000 + "a"
s2 = "1234567890" * 100000 + "B"

code = "s1.lower() < s2.lower()"
time = Timer(code, "from __main__ import s1, s2").timeit(1000)
print time / 1000   # 0.00920499992371 on my machine 
```

如果这确实是非常重要的、对性能至关重要的代码部分，那么我建议用 C 编写一个函数并从您的 Python 代码中调用它，因为这将允许您进行真正有效的不区分大小写的搜索。可以在此处找到有关编写 C 扩展模块的详细信息：[https ://docs.python.org/extending/extending.html](https://docs.python.org/extending/extending.html)

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-09-15T22:20:06.347

您的问题意味着您不需要 Unicode。试试下面的代码片段；如果它适合你，你就完成了：

```
Python 2.5.2 (r252:60911, Aug 22 2008, 02:34:17)
[GCC 4.3.1] on linux2
Type "help", "copyright", "credits" or "license" for more information.
>>> import locale
>>> locale.setlocale(locale.LC_COLLATE, "en_US")
'en_US'
>>> sorted("ABCabc", key=locale.strxfrm)
['a', 'A', 'b', 'B', 'c', 'C']
>>> sorted("ABCabc", cmp=locale.strcoll)
['a', 'A', 'b', 'B', 'c', 'C'] 
```

澄清：如果乍一看并不明显， locale.strcoll 似乎是您需要的功能，避免使用 str.lower 或 locale.strxfrm “重复”字符串。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-09-15T15:15:10.017

我找不到任何其他内置方式来进行不区分大小写的比较：[python 食谱](http://code.activestate.com/recipes/170242/)使用 lower()。

[但是，由于土耳其语 I 的问题](http://en.wikipedia.org/wiki/Turkish_dotted_and_dotless_I)，在使用 lower 进行比较时必须小心。不幸的是，Python 对土耳其语的处理并不好。ı 转换为 I，但 I 未转换为 ı。İ 转换为 i，但 i 未转换为 İ。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-15T13:46:39.420

没有与您想要的功能等效的内置功能。

您可以编写自己的函数，一次将每个字符转换为 .lower() 以避免重复两个字符串，但我确信它会占用大量 CPU 资源并且效率极低。

除非您使用的是极长的字符串（如果重复会导致内存问题），那么我会保持简单并使用

```
str1.lower() == str2.lower() 
```

你会没事的

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2010-04-26T03:41:19.423

当标准库不能很好地支持某些东西时，我总是寻找 PyPI 包。随着虚拟化和现代 Linux 发行版的普及，我不再避免使用 Python 扩展。PyICU 似乎符合要求：[https ://stackoverflow.com/a/1098160/3461](https://stackoverflow.com/a/1098160/3461)

现在还有一个选项是纯 python。它经过了很好的测试：[https ://github.com/jtauber/pyuca](https://github.com/jtauber/pyuca)

* * *

**老答案：**

我喜欢正则表达式解决方案。由于 python 的块结构支持，这是一个可以复制并粘贴到任何函数中的函数。

```
def equals_ignore_case(str1, str2):
    import re
    return re.match(re.escape(str1) + r'\Z', str2, re.I) is not None 
```

由于我使用匹配而不是搜索，因此不需要在正则表达式中添加插入符号 (^)。

**注意：**这仅检查相等性，这有时是需要的。我也不会说我喜欢它。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2011-08-30T05:45:39.957

这个问题问的是两个非常不同的事情：

1.  在Python中比较字符串的最简单方法是什么，忽略大小写？
2.  我想我正在寻找与 C 的 stricmp() 等效的东西。

由于#1 已经得到很好的回答（即：str1.lower() < str2.lower()）我将回答#2。

```
def strincmp(str1, str2, numchars=None):
    result = 0
    len1 = len(str1)
    len2 = len(str2)
    if numchars is not None:
        minlen = min(len1,len2,numchars)
    else:
        minlen = min(len1,len2)
    #end if
    orda = ord('a')
    ordz = ord('z')

    i = 0
    while i < minlen and 0 == result:
        ord1 = ord(str1[i])
        ord2 = ord(str2[i])
        if ord1 >= orda and ord1 <= ordz:
            ord1 = ord1-32
        #end if
        if ord2 >= orda and ord2 <= ordz:
            ord2 = ord2-32
        #end if
        result = cmp(ord1, ord2)
        i += 1
    #end while

    if 0 == result and minlen != numchars:
        if len1 < len2:
            result = -1
        elif len2 < len1:
            result = 1
        #end if
    #end if

    return result
#end def 
```

仅在有意义时才使用此函数，因为在许多情况下小写技术会更好。

我只使用 ascii 字符串，我不确定这将如何处理 unicode。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-15T13:05:22.403

这就是您使用 re 的方式：

```
import re
p = re.compile('^hello$', re.I)
p.match('Hello')
p.match('hello')
p.match('HELLO') 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-15T21:54:03.723

使用计算成本高的键对值列表进行排序的推荐习惯用法是所谓的“装饰模式”。它只是从原始列表中构建一个（键，值）元组列表，然后对该列表进行排序。然后消除键并获得排序值列表是微不足道的：

```
>>> original_list = ['a', 'b', 'A', 'B']
>>> decorated = [(s.lower(), s) for s in original_list]
>>> decorated.sort()
>>> sorted_list = [s[1] for s in decorated]
>>> sorted_list
['A', 'a', 'B', 'b'] 
```

或者，如果您喜欢单线：

```
>>> sorted_list = [s[1] for s in sorted((s.lower(), s) for s in original_list)]
>>> sorted_list
['A', 'a', 'B', 'b'] 
```

如果您真的担心调用 lower() 的成本，您可以在任何地方存储 (lowered string, original string) 的元组。元组是 Python 中最便宜的容器，它们也是可散列的，因此可以用作字典键、集合成员等。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-15T12:59:43.477

我很确定您要么必须使用 .lower() 要么使用正则表达式。我不知道内置的不区分大小写的字符串比较函数。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-15T13:43:59.720

对于偶尔甚至重复的比较，一些额外的字符串对象应该无关紧要，只要这不会发生在核心代码的最内层循环中，或者您没有足够的数据来实际注意到性能影响。看看你是否这样做：以“愚蠢”的方式做事，如果你也少做的话，就不会那么愚蠢了。

如果您真的想在不区分大小写的情况下继续比较大量文本，您可以以某种方式保留字符串的小写版本以避免最终确定和重新创建，或者将整个数据集规范化为小写。这当然取决于数据集的大小。如果针数相对较少且干草堆较大，则用编译的正则表达式对象替换针是一种解决方案。如果没有看到一个具体的例子就很难说。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-15T19:13:20.430

您可以将每个字符串转换为小写一次 --- 仅在需要时懒惰地转换，或者如果您知道要对整个字符串集合进行排序，则作为排序的预通行证。有几种方法可以将此比较键附加到正在排序的实际数据，但这些技术应在单独的问题中解决。

请注意，此技术不仅可用于处理大写/小写问题，还可用于其他类型的排序，例如特定于区域设置的排序，或忽略主要文章的“图书馆风格”标题排序，并在排序之前对数据进行规范化。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-10-11T08:44:14.977

只需使用该`str().lower()`方法，除非高性能很重要 - 在这种情况下，将该排序方法编写为 C 扩展。

[“如何编写 Python 扩展”](http://starship.python.net/crew/arcege/extwriting/pyext.html)似乎是一个不错的介绍。

更有趣的是，[本指南](http://www.dalkescientific.com/writings/NBN/c_extensions.html)比较了使用 ctypes 库与编写外部 C 模块（ctype 比 C 扩展慢得多）。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2014-03-07T11:37:53.967

```
import re
if re.match('tEXT', 'text', re.IGNORECASE):
    # is True 
```

* * *

## 回答 #15

> 赞同：-1
> 
> 时间：2008-09-15T13:06:08.657

您可以子类`str`化并创建自己的不区分大小写的字符串类，但恕我直言，这将是非常不明智的，并且造成的麻烦远远超过其价值。

* * *

## 回答 #16

> 赞同：-11
> 
> 时间：2008-09-15T20:20:53.387

回应您的澄清...

您可以使用[ctypes](http://docs.python.org/lib/ctypes-ctypes-tutorial.html)来执行 c 函数“strcasecmp”。Ctypes 包含在 Python 2.5 中。它提供了调用 dll 和共享库（如 libc）的能力。这是一个简单的示例（Linux 上的 Python；请参阅 Win32 帮助链接）：

```
from ctypes import *
libc = CDLL("libc.so.6")  // see link above for Win32 help
libc.strcasecmp("THIS", "this") // returns 0
libc.strcasecmp("THIS", "THAT") // returns 8 
```

可能还想参考[strcasecmp 文档](http://linux.die.net/man/3/strcasecmp)

不确定这是更快或更慢（尚未测试），但它是一种使用 C 函数进行不区分大小写的字符串比较的方法。

~~~~~~~~~~~~~~

[ActiveState 代码 - 配方 194371：不](http://code.activestate.com/recipes/194371/ "活动状态代码") 区分大小写的字符串是用于创建不区分大小写的字符串类的配方。对于一些快速的东西来说可能有点过头了，但如果你打算经常使用它们，它可以为你提供一种处理不区分大小写字符串的常用方法。

# svn - 如何在 TortoiseSVN 中将文件（或文件夹）从一个文件夹移动到另一个文件夹？

> ID：62570
> 
> 赞同：250
> 
> 时间：2008-09-15T12:57:16.307
> 
> 标签：svn, tortoisesvn

我想在同一个存储库中将文件或文件夹从一个位置移动到另一个位置，而无需使用 Repo Browser 来执行此操作，也无需创建两个独立的添加/删除操作。使用 Repo 浏览器可以正常工作，只是您的代码将处于损坏状态，直到您之后签入任何支持更改（例如 .csproj 文件）。

更新：人们建议从命令行“移动”。是否有 TortoiseSVN 等价物？

* * *

## 回答 #1

> 赞同：449
> 
> 时间：2008-09-15T13:05:04.557

要使用 移动一个文件或一组文件`Tortoise SVN`，请右键单击目标文件并将其拖动到其目标位置，然后释放鼠标右键。弹出菜单将有一个`SVN move versioned files here`选项。

**请注意，必须已将目标文件夹添加到存储库中`SVN move versioned files here`才能显示该选项。**

* * *

## 回答 #2

> 赞同：60
> 
> 时间：2008-09-15T13:00:21.167

`svn move`— 移动文件或目录。

[http://svnbook.red-bean.com/en/1.0/re18.html](http://svnbook.red-bean.com/en/1.0/re18.html)

* * *

## 回答 #3

> 赞同：22
> 
> 时间：2008-09-15T13:06:23.260

在 Windows 资源管理器中，使用鼠标右键单击文件并将其从其所在位置拖动到您想要的位置。释放鼠标右键后，您将看到一个上下文菜单，其中包含“SVN 将版本化文件移至此处”等选项。

[http://tortoisesvn.net/most-forgotten-feature](http://tortoisesvn.net/most-forgotten-feature)

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-09-15T13:07:21.837

在 TortoiseSVN 下，请参阅以下页面：[http ://tortoisesvn.net/docs/release/TortoiseSVN_en/tsvn-dug-copy.html](http://tortoisesvn.net/docs/release/TortoiseSVN_en/tsvn-dug-copy.html)

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-09-15T13:03:10.630

如果你想移动文件**并**保持 csproj 文件是最新的，最简单的方法是使用像[AnkhSVN](http://ankhsvn.net)这样的 Visual Studio 插件。这将自动提交移动操作（作为带有历史记录的删除+添加，因为这就是 Subversion 的工作方式）和 .csproj 中的更改

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-09-15T12:59:39.983

在命令行中，您可以键入`svn mv path1 path2`. 这将创建一个添加和删除操作，但据我所知，在 Subversion 中并没有真正的解决方法。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-09-15T13:03:42.440

Subversion 还没有一流的重命名操作。

这个问题有一个 6 年前的错误：[http ://subversion.tigris.org/issues/show_bug.cgi?id=898](http://subversion.tigris.org/issues/show_bug.cgi?id=898)

它正在考虑用于 1.6，现在已添加合并跟踪（更高优先级）（在 1.5 中）。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2010-05-30T04:53:14.920

使用 Tortoise 的 RENAME 命令，并输入一个相对路径（“folder/file.ext”）。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2019-07-09T12:37:14.527

您必须使用鼠标右键拖动文件。将文件发布到新目的地的那一刻，您将看到以下选项：

> SVN 将版本化文件移至此处。

只需选择此选项即可完成！

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-15T13:00:12.540

使用`svn move`命令移动文件/文件夹。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-15T13:05:18.817

如前所述，您将创建添加和删除命令。您可以在工作副本或存储库 url 上使用 svn move。如果您使用工作副本，则不会提交更改 - 您需要在单独的操作中提交。

如果你 svn 移动一个 URL，你需要提供一个 --message，并且更改将立即反映在存储库中。

# asp.net - Global.asax 中的共享/静态变量按请求隔离？

> ID：62588
> 
> 赞同：3
> 
> 时间：2008-09-15T12:59:24.430
> 
> 标签：asp.net, vb.net, web-services

我有一些 ASP.NET Web 服务，它们都共享一个公共帮助器类，它们只需要实例化*每个服务器*的一个实例。它用于简单的数据转换，但在启动期间会花费一些时间从 web.config 文件等加载内容。*帮助类是 100% 线程安全的。将其视为一个简单的实用程序调用库。我会在类上共享所有方法，但我想从 web.config 加载初始配置。*我们已将 Web 服务部署到 IIS 6.0 并使用应用程序池，其中包含 15 个工作人员的 Web Garden。

我在 Global.asax 中将帮助类声明为 Private Shared 变量，并添加了一个惰性加载 Shared ReadOnly 属性，如下所示：

```
Private Shared _helper As MyHelperClass

Public Shared ReadOnly Property Helper() As MyHelperClass
    Get
        If _helper Is Nothing Then
            _helper = New MyHelperClass()
        End If
        Return _helper
    End Get
End Property 
```

我在构造函数中记录了代码`MyHelperClass()`，它显示了为每个请求运行的构造函数，即使在同一个线程上也是如此。我确定我只是缺少 ASP.NET 的一些关键细节，但 MSDN 并没有太大帮助。

我已经尝试使用两者来做类似的事情`Application("Helper")`，`Cache("Helper")`并且我仍然看到构造函数随每个请求一起运行。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-15T13:36:12.003

您可以将 Helper 置于应用程序状态。在 global.asax 中执行此操作：

```
 void Application_Start(object sender, EventArgs e)
  {
    Application.Add("MyHelper", new MyHelperClass());
  } 
```

您可以这样使用 Helper：

```
 MyHelperClass helper = (MyHelperClass)HttpContext.Current.Application["MyHelper"];
  helper.Foo(); 
```

这导致 MyHelperClass 类的单个实例在应用程序启动时创建并处于应用程序状态。由于实例是在 Application_Start 中创建的，因此每个 HttpApplication 实例只发生一次，而不是每个请求。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-15T13:34:57.293

我过去在自己的应用程序中做过类似的事情，它导致了各种奇怪的错误。每个用户都可以访问该属性中其他所有人的数据。另外，您最终可能会导致一个用户正在使用它，而不是因为另一个用户的请求而被切断。

没有没有隔离。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-15T13:46:13.303

除非您绝对需要，否则使用应用程序状态是不明智的，如果您坚持使用按请求对象，事情会简单得多。任何向辅助类添加状态都可能导致各种细微的错误。使用 HttpContext.Current 项目集合并根据请求对其进行初始化。VB 模块会做你想做的事，但你必须确保不要让它有状态。

# sql - 重新加载 .sql 架构而不重新启动 mysqld

> ID：62593
> 
> 赞同：0
> 
> 时间：2008-09-15T12:59:48.783
> 
> 标签：sql, mysql, schema

是否可以重新加载模式文件而无需重新启动 mysqld？我在很多人的海洋中只在一个数据库中工作，并且希望在不进行冷重启的情况下刷新我的更改。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-15T13:27:57.903

当您说“重新加载架构文件”时，我假设您指的是一个包含`SQL`定义数据库架构的所有语句的文件？即创建`tables`, `views`,`stored procecures`等？

解决方案相当简单——在一个文件中保留一个包含所有`SQL`创建`tables`等的文件，并在所有`CREATE`语句之前添加一个`DELETE/DROP`语句以删除已经存在的内容。然后，当您想要重新加载时，只需执行以下操作：

```
cat myschemafile.sql | mysql -u userid -p databasename 
```

# vb.net - 在 VB.NET 中设置 WinForms UserControl 的命名空间

> ID：62599
> 
> 赞同：1
> 
> 时间：2008-09-15T13:00:22.087
> 
> 标签：vb.net, winforms, namespaces

您如何将您的 UserControls 定义为位于项目名称空间下方的名称空间中，即。[RootNameSpace].[SubSectionOfProgram].Controls？

**由于 camainc 的回答而进行编辑：**我还有一个约束，即我必须将所有代码都放在一个项目中。

**编辑以完成问题：**因为我怀疑不可能做我需要的事情，所以 camainc 的答案是最接近的解决方案。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-15T13:23:16.947

我不确定这是否是您所要求的，但我们就是这样做的。

我们以一致的方式命名所有项目，用户控件也不例外。我们还使用项目设置窗口命名空间，尽管您可以通过项目窗口和代码的组合来实现。

每个解决方案都有一个这样的命名空间：

```
[CompanyName].[SolutionName].[ProjectName] 
```

因此，我们的用户控件通常位于名为“Controls”的项目中，该项目的命名空间为：

```
OurCompany.ThisSolution.Controls 
```

如果我们有可能跨越多个不同解决方案的控件，我们只需像这样命名它：

```
OurCompany.Common.Controls 
```

然后，在我们的代码中，我们将导入库，或将项目添加到解决方案中。

```
Imports OurCompany
Imports OurCompany.Common
Imports OurCompany.Common.Controls 
```

我们还将项目所在的文件夹命名为与命名空间相同，直到但不包括公司名称（所有解决方案都假定在公司命名空间中）：

\Projects
\Projects\MySolution
\Projects\MySolution\Controls

- 或者 -

\Projects\\
Projects\Common
\Projects\Common\Assemblies
\Projects\Common\Controls

等等

希望有帮助...

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-10-11T07:51:50.917

如果您不希望控件位于单独的项目中，只需将 Namespace 关键字添加到代码文件的顶部即可。例如，我在几个项目中做过这样的事情：

```
Imports System.ComponentModel

Namespace Controls
   Friend Class FloatingSearchForm

      'Your code goes here...

   End Class
End Namespace 
```

您将无法指定控件位于不同于为它们所属的项目指定的根命名空间中。VB 将简单地将您为命名空间指定的任何内容附加到项目属性窗口中指定的命名空间。因此，如果您的整个项目是“AcmeCorporation.WidgetProgram”并且您将“Namespace Controls”添加到控件文件的顶部，则该控件将位于命名空间“AcmeCorporation.WidgetProgram.Controls”中。无法使控件出现在“AcmeCorporation.SomeOtherProgram.Controls”命名空间中。

另请注意，如果您使用设计器编辑控件，则需要将 Namespace 关键字添加到设计器创建的隐藏分部类中。单击解决方案资源管理器中的“显示所有文件”按钮，然后单击控件旁边的展开箭头。您应该会看到列出的“*.Designer.vb”文件。将命名空间也添加到该文件中。设计者将尊重此修改，您的项目现在应该可以无错误地编译。显然，设计器分部类中指定的命名空间必须与您的类文件中指定的命名空间相同！对于上面的例子：

```
Namespace Controls
   <Global.Microsoft.VisualBasic.CompilerServices.DesignerGenerated()> _
   Partial Class FloatingSearchForm

      'Designer generated code

   End Class
End Namespace 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-15T13:40:55.593

您的意思是您希望能够在运行时（在代码中）通过以下方式访问用户控件

> `[ProjectNamespace].[YourSpecialNamespace].Controls`

而不是默认的

> `[ProjectNamespace].Controls`

? 因为我不相信这是可能的。如果我没记错的话，`Controls`你的项目/应用程序的集合是由框架内置的——你不能改变它。正如camainc所指出的，您可以使用项目设置窗口（或代码）将控件本身放置在特定的命名空间中：

> `Namespace [YourSpecialNamespace]`
> 
> `Public Class Form1`
> 
> `[...]`
> 
> `End Class`
> 
> `End Namespace`

当然，再想一想，我想您可以`Controls`在命名空间中设计和构建自己的集合 - 也许作为内置集合的包装器......

# c# - .Net 2+：为什么 if( 1 == null ) 不再抛出编译器异常？

> ID：62606
> 
> 赞同：5
> 
> 时间：2008-09-15T13:01:24.143
> 
> 标签：c#, .net-3.5, compiler-construction, .net-2.0

我`int`以示例为例，但这适用于 .Net 中的任何值类型

在 .Net 1 中，以下内容会引发编译器异常：

```
int i = SomeFunctionThatReturnsInt();

if( i == null ) //compiler exception here 
```

现在（在 .Net 2 或 3.5 中）该异常已经消失。

我知道这是为什么：

```
int? j = null; //nullable int

if( i == j )   //this shouldn't throw an exception 
```

问题是因为`int?`是可以为空的，`int`现在有一个隐式转换为`int?`. 上面的语法是编译器的魔法。我们真的在做：

```
Nullable<int> j = null; //nullable int

//compiler is smart enough to do this
if( (Nullable<int>) i == j)   

//and not this
if( i == (int) j) 
```

所以现在，当我们这样做时，`i == null`我们得到：

```
if( (Nullable<int>) i == null ) 
```

鉴于 C# 正在执行编译器逻辑来计算这个，为什么在处理绝对值时不能足够聪明地不这样做`null`？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-15T13:14:45.830

奇怪...用 VS2008 编译它，目标是 .NET 3.5：

```
static int F()
{
    return 42;
}

static void Main(string[] args)
{
    int i = F();

    if (i == null)
    {
    }
} 
```

我收到编译器警告

```
warning CS0472: The result of the expression is always 'false' since a value of type 'int' is never equal to 'null' of type 'int?' 
```

它会生成以下 IL ...大概 JIT 会优化掉

```
L_0001: call int32 ConsoleApplication1.Program::F()
L_0006: stloc.0 
L_0007: ldc.i4.0 
L_0008: ldc.i4.0 
L_0009: ceq 
L_000b: stloc.1 
L_000c: br.s L_000e 
```

你可以发布一个代码片段吗？

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-15T13:18:08.973

我认为这*本身*不是编译器问题；整数值永远不会为空，但将它们等同的想法并非无效；这是一个始终返回 false 的有效函数。编译器知道；编码

```
bool oneIsNull = 1 == null; 
```

编译，但给出编译器警告：`The result of the expression is always 'false' since a value of type 'int' is never equal to 'null' of type '<null>'`.

因此，如果您希望恢复编译器错误，请转到项目属性并为此错误打开“将警告视为错误”，您将再次开始将它们视为破坏构建的问题。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-15T13:13:40.793

当您将不可为空的类型与 null 进行比较时，编译器仍然会生成警告，这正是它应该的方式。可能是您的警告级别太低，或者这在最近的版本中已更改（我只在 .net 3.5 中这样做）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-15T14:19:26.563

2.0 框架引入了可空值类型。即使字面常量“1”永远不能为 null，它的基础类型 (int) 现在可以转换为 Nullable int 类型。我的猜测是编译器不能再假设 int 类型不可为空，即使它是一个字面常量。编译 2.0 时确实收到警告：

警告 1 表达式的结果始终为“假”，因为“int”类型的值永远不会等于“int？”类型的“null”。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-15T13:48:07.777

警告是新的（我认为是 3.5） - 错误与我已经完成的错误相同`1 == 2`，它足够聪明，可以发现它永远不会正确。

我怀疑通过完整的 3.5 优化，整个语句将被删除，因为它非常聪明，从来没有真正的评估。

虽然我可能想要`1==2`编译（例如在我测试其他东西时关闭功能块）但我不想编译`1==null`。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-15T13:57:21.687

这应该是编译时错误，因为类型不兼容（值类型永远不能为空）。很遗憾，事实并非如此。

# audio - 合并 mp3 文件的最佳方法是什么？

> ID：62618
> 
> 赞同：66
> 
> 时间：2008-09-15T13:02:39.353
> 
> 标签：audio, mp3

我有很多很多 mp3 文件，我想合并到一个文件中。我已经使用了命令行方法

```
copy /b 1.mp3+2.mp3 3.mp3 
```

但是当它们很多并且它们的命名不一致时，这是一种痛苦。时间似乎也永远不会正确。

* * *

## 回答 #1

> 赞同：61
> 
> 时间：2011-03-19T21:21:10.110

[大卫的回答](https://stackoverflow.com/a/62762/3195477)是正确的，只是连接文件会使 ID3 标签分散在里面（尽管这通常不会影响播放，所以你可以做“复制/b”或在 UNIX 上“cat a.mp3 b.mp3 > combined.mp3”在紧要关头）。

但是，mp3wrap 并不是将多个 MP3 组合成一个“干净”文件的正确工具。它实际上不是使用 ID3，而是在 MP3 帧（“包装”部分）中插入自己的[自定义数据格式](http://mp3wrap.sourceforge.net/mp3wrap-format.html)，这会导致播放问题，尤其是在 iTunes 和 iPod 上。虽然如果您让文件从头到尾运行（因为播放器将跳过这些任意非 MPEG 字节）文件将正常播放，但文件持续时间和比特率将被错误地报告，从而中断搜索*。*此外，mp3wrap 将清除所有 ID3 元数据，包括封面，并且无法使用正确的文件长度更新 VBR 标头。

[mp3cat](http://tomclegg.net/mp3cat)本身会生成一个很好的连接数据文件（因此，比 mp3wrap 更好），但它也会去除 ID3 标记，并且无法使用连接文件的正确长度更新 VBR 标头。

这是对这些问题和方法（实际上是两个）的一个[很好的解释](http://lyncd.com/2011/03/lossless-combine-mp3s/)，用于组合 MP3 文件并产生原始元数据完整的“干净”最终结果——它是命令行，因此适用于 Mac/Linux/BSD 等。它使用：

*   [mp3cat](http://tomclegg.net/mp3cat)仅将 MPEG 数据帧组合成一个连续文件，然后
*   [id3cp](http://id3lib.sourceforge.net/)将所有元数据复制到组合文件中，最后
*   [VBRFix](http://home.gna.org/vbrfix/)更新 VBR 标头。

对于 Windows GUI 工具，请查看[Merge MP3——](http://www.shchuka.com/software/mergemp3/)它可以处理所有事情。（VBRFix 也以 GUI 形式出现，但它不进行连接。）

* * *

## 回答 #2

> 赞同：52
> 
> 时间：2008-09-15T13:16:27.447

正如 Thomas Owens 指出的那样，简单地连接文件会留下多个 ID3 标头分散在生成的连接文件中 - 因此时间/比特率信息将非常错误。

您将需要使用可以为您组合音频数据的工具。

[mp3wrap](http://mp3wrap.sourceforge.net/)将是理想的选择 - 它旨在将 MP3 文件连接在一起，无需对数据进行解码+重新编码（这会导致音频质量损失），并且还将智能地处理 ID3 标签。

也可以使用 mp3splt 工具将生成的文件拆分回其组成部分 - mp3wrap 将信息添加到 IDv3 注释以允许这样做。

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2009-09-25T21:33:54.960

使用 ffmpeg 或类似工具将所有 MP3 转换为一致的格式，例如

```
ffmpeg -i originalA.mp3 -f mp3 -ab 128kb -ar 44100 -ac 2 intermediateA.mp3  
ffmpeg -i originalB.mp3 -f mp3 -ab 128kb -ar 44100 -ac 2 intermediateB.mp3 
```

然后，在运行时，将您的文件连接在一起：

```
cat intermediateA.mp3 intermediateB.mp3 > output.mp3 
```

最后，通过工具**[MP3Val](http://mp3val.sourceforge.net/)**运行它们以修复任何流错误，而无需强制完全重新编码：

```
mp3val output.mp3 -f -nb 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-09-15T13:04:28.037

时间问题与 MP3 文件的 ID3 标头有关，这是您的方法在复制整个文件时没有考虑到的问题。

您是否有选择的语言想要使用或没关系？这将影响支持您想要的操作的可用库。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-09-15T13:19:40.450

MP3 文件具有您需要尊重的标题。

您可以使用诸如[开源音频库项目](http://osalp.sourceforge.net/)之类的库并围绕它编写工具。或者，您可以使用能够理解 mp3 文件的工具，例如[Audacity](http://audacity.sourceforge.net/)。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2010-12-03T21:40:10.123

*我真正想要的是一个 GUI 来重新排序它们并将它们作为一个文件输出*

[Playlist Producer](http://www.playlistproducer.com/)正是这样做的，将它们解码并重新编码成一个组合的 MP3。它专为创建混合磁带或简单的播客而设计，但您可能会发现它很有用。

（披露：我编写了软件，如果你购买专业版，我会获利。精简版是免费版，有一些限制）。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-02-22T06:02:58.653

正如大卫所说，[mp3wrap](http://mp3wrap.sourceforge.net/)是要走的路。但是，我发现它没有修复音频长度标题，因此即使所有数据都在那里，iTunes 也拒绝播放整个文件。（我合并了三个 7 分钟的文件，但它只看到了前 7 分钟。）

我挖出了[这篇博](http://lyncd.com/2009/02/how-to-merge-mp3-files/)文，它解释了如何解决这个问题以及如何从原始文件中复制 ID3 标签（mp3wrap 会自行删除你的 ID3 标签）。或者只是复制标签（使用 id3lib 中的[id3cp](http://id3lib.sourceforge.net/)），请执行以下操作：

```
id3cp original.mp3 new.mp3 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-15T13:20:26.890

我会使用 Winamp 来做到这一点。创建要合并为一个的文件的播放列表，选择磁盘写入器输出插件，选择文件名，您就完成了。您将获得的文件将是正确的 MP3 文件，您可以设置比特率等。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-08-07T15:40:57.017

我以前没有听说过 mp3wrap。看起来很棒。我猜有人也在某个地方把它变成了一个gui。但是，为了回应原始帖子，我编写了一个执行 COPY /b 方法的 gui。所以，在幕后，没有什么新鲜事，但是如果你有很多文件要合并，这个程序就是为了让这个过程不那么痛苦……而且你不想重新编码和每组文件合并是相同的比特率。如果您有（并且您在 Windows 上），请查看 Mp3Merge，网址为：http: [//www.leighweb.com/david/mp3merge](http://www.leighweb.com/david/mp3merge)，看看这是否是您正在寻找的。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2013-05-25T17:22:12.307

如果您想通过简单的用户界面制作**完全干净的 mp3 的*****免费***内容，我推荐[MP3 Joiner](http://mp3joiner.net/)。

 ****特征：**

*   剥离 ID3 数据（ID3v1 和 ID3v2.x）并且不添加它自己的（与 mp3wrap 不同）
*   无损加入（不解码和重新编码 .mp3）。无需编解码器。
*   简单的用户界面（见下文）
*   低内存使用（使用流）
*   非常快（与 mp3wrap 相比）
*   我写了:) - 所以你可以请求功能，我会添加它们。

![MP3 细木工应用程序](https://i.stack.imgur.com/TGvYH.png)

链接：

*   MP3 Joiner 网站：[这里](http://mp3joiner.net/)
*   最新安装程序：[这里](http://bytesoftly.com/Download/Apps/1/1.0/MP3JoinerSetup.exe)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-15T13:14:18.780

就我个人而言，我会使用类似 mplayer 的音频通过选项，例如 -oac copy

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-11-18T22:05:49.017

而不是使用命令行来做

> 复制 /b 1.mp3+2.mp3 3.mp3

您可以改为使用[“重命名”](http://www.softempire.com/the-rename-downloads.html)将所有 MP3 片段重命名为一系列名称，这些名称根据某种计数器按顺序排列。然后你可以使用相同的命令行格式，但稍微改变一下：

> 复制 /b *.mp3 output_name.mp3

这是假设您同时翻录所有这些片段 MP3 并且它们具有相同的音频设置。当我将 .aa 中的有声读物转换为单个 .mp3 时，这对我来说非常有用。我不得不将所有的 .aa 文件刻录到 9 张 CD 上，然后翻录所有 9 张 CD，然后剩下大约 90 张 mp3。在a55上真的很痛苦。

# c++ - 现在每个 Linux 发行版都附带 gcc/g++ 4.* 吗？

> ID：62623
> 
> 赞同：3
> 
> 时间：2008-09-15T13:03:19.240
> 
> 标签：c++, linux, gcc, distro

我正在考虑将 boost 作为依赖项... atm 我唯一真正需要的是`shared_ptr<>`，我可以从`std::tr1`gcc 套件 4 中获得它。*

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-15T13:09:37.620

它在 Fedora 上可用，如果您没有选择“开发系统”作为默认安装集，则可以通过“yum”安装。"yum search gcc" 获取要安装的软件包。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-15T13:26:21.697

这些天来，我相信大多数 Linux 发行版默认不附带开发系统。但如果您安装 C++ 开发环境，我很确定 g++ v4 是“标准”开发 C++ 编译器。g++ v3 通常仅作为特殊安装提供。对于 openSUSE 11，gcc 4.3 是您选择基本开发模式时安装的当前软件包。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-15T13:30:21.500

这取决于您所说的*船*是什么意思？如果您下载并刻录 CD 或 DVD，它几乎肯定可用，但不一定默认安装。一些发行版（例如 Fedora）允许在安装过程中选择安装开发工具，但默认安装通常不包括它们。它们可以使用发行版支持的任何包管理系统轻松安装。Ubuntu 包含一个名为**build-essential**的软件包，它安装 gcc、g++、make 等。因此**apt-get install build-essential**是在 Ubuntu 上进行开发的第一步。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-15T13:05:16.147

不，在我的 debian 系统上我必须安装它。但是任何半体面的系统管理员都应该能够弄清楚如何安装它。

编辑：具体来说，默认情况下并不总是安装它，但它应该适用于大多数发行版。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-15T14:58:53.927

AFAIK，现在所有的发行版包 V 4.+。

# c# - 在编写单元测试时如何知道要测试什么？

> ID：62625
> 
> 赞同：129
> 
> 时间：2008-09-15T13:03:22.050
> 
> 标签：c#, unit-testing, tdd

使用 C#，我需要一个名为的类`User`，它具有用户名、密码、活动标志、名字、姓氏、全名等。

应该有方法来*验证*和*保存*用户。我只是为这些方法编写一个测试吗？我什至需要担心测试这些属性，因为它们是.Net 的 getter 和 setter？

* * *

## 回答 #1

> 赞同：133
> 
> 时间：2008-09-15T13:18:40.780

我的问题也有很多对此的好回答：“[开始 TDD - 挑战？解决方案？建议？](https://stackoverflow.com/questions/24965/beginning-tdd-challenges-solutions-recommendations) ”

我还可以推荐看看我的[博客文章](http://cantgrokwontgrok.blogspot.com/2008/09/tdd-getting-started-with-test-driven.html)（部分是受我的问题启发的），我对此有一些很好的反馈。即：

> **我不知道从哪里开始？**
> 
> *   重新开始。仅在编写新代码时才考虑编写测试。这可以是旧代码的重新工作，也可以是全新的功能。
> *   从简单开始。不要跑掉并试图让你的头脑围绕一个测试框架以及 TDD 风格。Debug.Assert 工作正常。以它为起点。它不会弄乱您的项目或创建依赖项。
> *   开始积极。你正在努力提高你的手艺，对此感觉良好。我见过很多开发人员乐于停滞不前，而不是尝试新事物来改善自己。你在做正确的事，记住这一点，这将有助于阻止你放弃。
> *   开始准备迎接挑战。开始测试是相当困难的。期待挑战，但请记住——挑战是可以克服的。
> 
> **只测试你所期望的**
> 
> 当我刚开始时，我遇到了真正的问题，因为我经常坐在那里试图找出可能发生的每一个可能的问题，然后尝试测试并修复它。这是一种快速解决头痛的方法。测试应该是一个真正的 YAGNI 过程。如果你知道有问题，那就为它写一个测试。否则，不要打扰。
> 
> **只测试一件事**
> 
> 每个测试用例应该只测试一件事。如果您发现自己在测试用例名称中添加了“and”，那么您就做错了。

我希望这意味着我们可以从“getter and setter”继续前进:)

* * *

## 回答 #2

> 赞同：63
> 
> 时间：2008-09-15T13:09:07.760

测试你的代码，而不是语言。

像这样的单元测试：

```
Integer i = new Integer(7);
assert (i.instanceOf(integer)); 
```

`instanceof`仅当您正在编写编译器并且您的方法不工作的可能性非零时才有用。

不要测试可以依靠语言来强制执行的东西。在您的情况下，我将专注于您的身份验证和保存方法 - 我会编写测试以确保它们可以优雅地处理任何或所有这些字段中的空值。

* * *

## 回答 #3

> 赞同：38
> 
> 时间：2008-09-16T03:52:41.787

**这让我进入了单元测试，这让我很开心**

我们刚刚开始进行单元测试。很长一段时间以来，我都知道开始这样做会很好，但我不知道如何开始，更重要的是要测试什么。

然后我们不得不在我们的会计程序中重写一段重要的代码。这部分非常复杂，因为它涉及许多不同的场景。我正在谈论的部分是一种支付已输入会计系统的销售和/或采购发票的方法。

我只是不知道如何开始编码，因为有很多不同的付款方式。一张发票可能是 100 美元，但客户只转了 99 美元。也许您已经向客户发送了销售发票，但您也从该客户那里购买了产品。所以你以 300 美元的价格卖掉了他，但你以 100 美元的价格买下了他。您可以期望您的客户向您支付 200 美元来结清余额。如果你卖了 500 美元，但客户只付给你 250 美元怎么办？

所以我有一个非常复杂的问题要解决，有很多可能性，一种情况可以完美地工作，但在另一种类型的发票/付款组合上会出错。

**这就是单元测试发挥作用的地方。**

我开始（在测试代码中）编写一种方法来创建发票列表，包括销售和采购。然后我编写了第二种方法来创建实际付款。通常，用户将通过用户界面输入该信息。

然后我创建了第一个 TestMethod，测试了一个非常简单的单张发票付款，没有任何付款折扣。当银行付款被保存到数据库时，系统中的所有操作都会发生。如您所见，我创建了一张发票，创建了一笔付款（银行交易）并将交易保存到磁盘。在我的断言中，我在银行交易和链接的发票中输入了正确的数字。我在交易后检查付款次数、付款金额、折扣金额和发票余额。

测试运行后，我会去数据库并仔细检查我所期望的是否存在。

**编写测试后**，我开始编写付款方式（BankHeader 类的一部分）。在编码中，我只关心代码以使第一次测试通过。我还没有考虑其他更复杂的场景。

我运行了第一个测试，修复了一个小错误，直到我的测试通过。

然后我开始编写第二个测试，这次是使用付款折扣。写完测试后，我修改了付款方式以支持折扣。

在使用付款折扣测试正确性的同时，我还测试了简单付款。当然，这两个测试都应该通过。

**然后我努力解决更复杂的场景。**

1）想一个新的场景

2）为该场景编写测试

3）运行那个单一的测试，看看它是否会通过

4）如果没有，我会调试和修改代码，直到它通过。

5）在修改代码时，我继续运行所有测试

这就是我设法创建非常复杂的付款方式的方法。如果没有单元测试，我不知道如何开始编码，这个问题似乎很严重。通过测试，我可以从一个简单的方法开始，然后逐步扩展它，确保更简单的场景仍然有效。

我确信使用单元测试为我节省了几天（或几周）的编码时间，并且或多或少地保证了我的方法的正确性。

如果我以后想到一个新场景，我可以将它添加到测试中，看看它是否有效。如果不是，我可以修改代码，但仍然可以确保其他方案仍然正常工作。这将在维护和错误修复阶段节省数天时间。

**是的，如果用户做了您没有想到或阻止他做的事情，即使经过测试的代码仍然可能存在错误**

以下只是我为测试付款方式而创建的一些测试。

```
public class TestPayments
{
    InvoiceDiaryHeader invoiceHeader = null;
    InvoiceDiaryDetail invoiceDetail = null;
    BankCashDiaryHeader bankHeader = null;
    BankCashDiaryDetail bankDetail = null;

    public InvoiceDiaryHeader CreateSales(string amountIncVat, bool sales, int invoiceNumber, string date)
    {
        ......
        ......
    }

    public BankCashDiaryHeader CreateMultiplePayments(IList<InvoiceDiaryHeader> invoices, int headerNumber, decimal amount, decimal discount)
    {
       ......
       ......
       ......
    }

    [TestMethod]
    public void TestSingleSalesPaymentNoDiscount()
    {
        IList<InvoiceDiaryHeader> list = new List<InvoiceDiaryHeader>();
        list.Add(CreateSales("119", true, 1, "01-09-2008"));
        bankHeader = CreateMultiplePayments(list, 1, 119.00M, 0);
        bankHeader.Save();

        Assert.AreEqual(1, bankHeader.BankCashDetails.Count);
        Assert.AreEqual(1, bankHeader.BankCashDetails[0].Payments.Count);
        Assert.AreEqual(119M, bankHeader.BankCashDetails[0].Payments[0].PaymentAmount);
        Assert.AreEqual(0M, bankHeader.BankCashDetails[0].Payments[0].PaymentDiscount);
        Assert.AreEqual(0, bankHeader.BankCashDetails[0].Payments[0].InvoiceHeader.Balance);
    }

    [TestMethod]
    public void TestSingleSalesPaymentDiscount()
    {
        IList<InvoiceDiaryHeader> list = new List<InvoiceDiaryHeader>();
        list.Add(CreateSales("119", true, 2, "01-09-2008"));
        bankHeader = CreateMultiplePayments(list, 2, 118.00M, 1M);
        bankHeader.Save();

        Assert.AreEqual(1, bankHeader.BankCashDetails.Count);
        Assert.AreEqual(1, bankHeader.BankCashDetails[0].Payments.Count);
        Assert.AreEqual(118M, bankHeader.BankCashDetails[0].Payments[0].PaymentAmount);
        Assert.AreEqual(1M, bankHeader.BankCashDetails[0].Payments[0].PaymentDiscount);
        Assert.AreEqual(0, bankHeader.BankCashDetails[0].Payments[0].InvoiceHeader.Balance);
    }

    [TestMethod]
    [ExpectedException(typeof(ApplicationException))]
    public void TestDuplicateInvoiceNumber()
    {
        IList<InvoiceDiaryHeader> list = new List<InvoiceDiaryHeader>();
        list.Add(CreateSales("100", true, 2, "01-09-2008"));
        list.Add(CreateSales("200", true, 2, "01-09-2008"));

        bankHeader = CreateMultiplePayments(list, 3, 300, 0);
        bankHeader.Save();
        Assert.Fail("expected an ApplicationException");
    }

    [TestMethod]
    public void TestMultipleSalesPaymentWithPaymentDiscount()
    {
        IList<InvoiceDiaryHeader> list = new List<InvoiceDiaryHeader>();
        list.Add(CreateSales("119", true, 11, "01-09-2008"));
        list.Add(CreateSales("400", true, 12, "02-09-2008"));
        list.Add(CreateSales("600", true, 13, "03-09-2008"));
        list.Add(CreateSales("25,40", true, 14, "04-09-2008"));

        bankHeader = CreateMultiplePayments(list, 5, 1144.00M, 0.40M);
        bankHeader.Save();

        Assert.AreEqual(1, bankHeader.BankCashDetails.Count);
        Assert.AreEqual(4, bankHeader.BankCashDetails[0].Payments.Count);
        Assert.AreEqual(118.60M, bankHeader.BankCashDetails[0].Payments[0].PaymentAmount);
        Assert.AreEqual(400, bankHeader.BankCashDetails[0].Payments[1].PaymentAmount);
        Assert.AreEqual(600, bankHeader.BankCashDetails[0].Payments[2].PaymentAmount);
        Assert.AreEqual(25.40M, bankHeader.BankCashDetails[0].Payments[3].PaymentAmount);

        Assert.AreEqual(0.40M, bankHeader.BankCashDetails[0].Payments[0].PaymentDiscount);
        Assert.AreEqual(0, bankHeader.BankCashDetails[0].Payments[1].PaymentDiscount);
        Assert.AreEqual(0, bankHeader.BankCashDetails[0].Payments[2].PaymentDiscount);
        Assert.AreEqual(0, bankHeader.BankCashDetails[0].Payments[3].PaymentDiscount);

        Assert.AreEqual(0, bankHeader.BankCashDetails[0].Payments[0].InvoiceHeader.Balance);
        Assert.AreEqual(0, bankHeader.BankCashDetails[0].Payments[1].InvoiceHeader.Balance);
        Assert.AreEqual(0, bankHeader.BankCashDetails[0].Payments[2].InvoiceHeader.Balance);
        Assert.AreEqual(0, bankHeader.BankCashDetails[0].Payments[3].InvoiceHeader.Balance);
    }

    [TestMethod]
    public void TestSettlement()
    {
        IList<InvoiceDiaryHeader> list = new List<InvoiceDiaryHeader>();
        list.Add(CreateSales("300", true, 43, "01-09-2008")); //Sales
        list.Add(CreateSales("100", false, 6453, "02-09-2008")); //Purchase

        bankHeader = CreateMultiplePayments(list, 22, 200, 0);
        bankHeader.Save();

        Assert.AreEqual(1, bankHeader.BankCashDetails.Count);
        Assert.AreEqual(2, bankHeader.BankCashDetails[0].Payments.Count);
        Assert.AreEqual(300, bankHeader.BankCashDetails[0].Payments[0].PaymentAmount);
        Assert.AreEqual(-100, bankHeader.BankCashDetails[0].Payments[1].PaymentAmount);
        Assert.AreEqual(0, bankHeader.BankCashDetails[0].Payments[0].InvoiceHeader.Balance);
        Assert.AreEqual(0, bankHeader.BankCashDetails[0].Payments[1].InvoiceHeader.Balance);
    } 
```

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2008-09-15T13:10:12.360

如果它们真的是微不足道的，那么不要打扰测试。例如，如果它们是这样实现的；

```
public class User
{
    public string Username { get; set; }
    public string Password { get; set; }
} 
```

另一方面，如果您正在做一些聪明的事情（例如在 getter/setter 中加密和解密密码），那么请对其进行测试。

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2008-09-15T13:07:50.790

规则是你必须测试你写的每一段逻辑。如果您在 getter 和 setter 中实现了一些特定功能，我认为它们值得测试。如果他们只为某些私有字段分配值，请不要打扰。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2015-03-21T12:55:23.480

这个问题似乎是一个问题，即在哪里对哪些方法进行测试而哪些不进行测试。

在创建用于赋值的 setter 和 getter 时，考虑到了一致性和未来的增长，并且预见到在未来一段时间内，setter/getter 可能会演变成更复杂的操作。为了一致性和未来的增长，对这些方法进行单元测试是有意义的。

代码可靠性，尤其是在进行更改以添加额外功能时，是主要目标。我不知道有人因为在测试方法中包含 setter/getter 而被解雇，但我确信有些人希望他们测试过的方法最后他们知道或可以回忆起来是简单的 set/get 包装器，但那不是更长的情况。

也许团队的另一位成员扩展了 set/get 方法以包含现在需要测试但没有创建测试的逻辑。但是现在您的代码正在调用这些方法，您不知道它们已更改并需要深入测试，并且您在开发和 QA 中进行的测试不会触发缺陷，但发布第一天的真实业务数据会触发触发它。

这两个队友现在将争论谁丢球并且没有进行单元测试，当集合/得到变形以包含可能失败但未被单元测试覆盖的逻辑时。如果从第一天就在简单的 set/gets 上实施测试，最初编写 set/gets 的队友将更容易摆脱这种干净。

我的观点是，用单元测试覆盖所有方法的几分钟“浪费”时间，甚至是微不足道的方法，可能会节省几天的头痛，以及金钱/业务声誉的损失和某人的工作损失。

并且当初级团队成员将琐碎方法更改为非琐碎方法并提示他们更新测试时，您确实将琐碎方法与单元测试包装在一起这一事实，现在没有人遇到麻烦，因为缺陷被包含在内从达到生产。

我们编码的方式，以及从我们的代码中可以看出的纪律，可以帮助他人。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-09-15T19:04:27.953

另一个规范的答案。这一点，我相信，来自 Ron Jeffries：

> 只测试你想要工作的代码。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-09-15T13:12:21.590

测试样板代码是浪费时间，但正如 Slavo 所说，如果你给你的 getter/setter 添加了副作用，那么你应该编写一个测试来伴随该功能。

如果你在做测试驱动的开发，你应该首先编写契约（例如接口），然后编写测试来执行记录预期结果/行为的接口。**然后**自己编写您的方法，而不涉及单元测试中的代码。最后，获取一个代码覆盖工具并确保您的测试运行代码中的所有逻辑路径。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-09-15T13:14:54.190

像 getter 和 setter 这样非常琐碎的代码，除了设置私有字段之外没有额外的行为，测试起来有点过头了。在 3.0 C# 中甚至有一些语法糖，编译器负责处理私有字段，因此您不必对其进行编程。

我通常会编写许多非常简单的测试来验证我期望从我的课程中获得的行为。即使它是简单的东西，比如添加两个数字。我在写一个简单的测试和写几行代码之间切换了很多。这样做的原因是我可以改变代码而不用担心我破坏了我没有想到的东西。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2008-09-15T14:01:08.587

你应该测试一切。现在你有 getter 和 setter，但有一天你可能会稍微改变它们，也许是为了做验证或其他事情。您今天编写的测试将在明天使用，以确保一切正常工作。当您编写测试时，您应该忘记诸如“现在它是微不足道的”之类的考虑。在敏捷或测试驱动的上下文中，您应该假设未来的重构进行测试。另外，您是否尝试过输入非常奇怪的值，例如极长的字符串或其他“坏”内容？那么你应该......永远不要假设你的代码将来会被滥用到多么严重。

一般来说，我发现编写大量的用户测试是一方面，令人筋疲力尽。另一方面，尽管它总是让您了解应用程序应该如何工作，并帮助您摒弃简单（和错误）的假设（例如：用户名的长度始终小于 1000 个字符）。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2008-09-15T14:10:00.767

对于可能最终出现在工具包或开源类型项目中的简单模块，您应该尽可能多地进行测试，包括琐碎的 getter 和 setter。您要记住的是，在编写特定模块时生成单元测试非常简单直接。添加 getter 和 setter 是最少的代码，可以不加思索地处理。但是，一旦您的代码被放置在一个更大的系统中，这种额外的努力可以保护您免受底层系统的更改，例如基类中的类型更改。测试一切是完成回归的最佳方法。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2008-09-15T13:08:10.073

为您的 getter 和 setter 编写单元测试并没有什么坏处。现在，他们可能只是在后台进行字段获取/设置，但将来您可能会有验证逻辑或需要测试的属性间依赖关系。现在在考虑它的同时编写它会更容易，然后记得在那个时候来改造它。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2008-09-15T13:14:59.633

通常，当仅为某些值定义方法时，请在*可接受*范围内测试值。换句话说，确保你的方法做它应该做的，*但仅此而已*。这很重要，因为当你要失败时，你想早点失败。

在继承层次结构中，确保测试[LSP](http://en.wikipedia.org/wiki/Liskov_substitution_principle)合规性。

测试默认的 getter 和 setter 对我来说似乎不是很有用，除非您打算稍后进行一些验证。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2008-09-15T13:49:52.937

好吧，如果您认为它会损坏，请为它编写一个测试。我通常不测试 setter/getter，但假设你为 User.Name 做一个，它连接名字和姓氏，我会写一个测试，所以如果有人改变姓氏和名字的顺序，至少他会知道他改变了一些经过测试的东西。

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2008-09-15T13:51:14.227

规范的答案是“测试任何可能破坏的东西”。如果您确定属性不会损坏，请不要测试它们。

一旦发现有问题（你发现了一个错误），显然这意味着你需要对其进行测试。编写一个测试来重现错误，观察它失败，然后修复错误，然后观察测试通过。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2008-09-15T13:08:05.330

据我了解敏捷开发环境中的单元测试，Mike，是的，您需要测试 getter 和 setter（假设它们是公开可见的）。单元测试的整个概念是测试软件单元，在这种情况下是一个类，作为一个[黑盒](http://en.wikipedia.org/wiki/Black_box_testing)。由于 getter 和 setter 是外部可见的，因此您需要与 Authenticate 和 Save 一起测试它们。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2008-09-15T13:08:14.283

如果 Authenticate 和 Save 方法使用这些属性，那么您的测试将间接接触这些属性。只要属性只是提供对数据的访问，那么就不需要显式测试（除非您要实现 100% 的覆盖率）。

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2008-09-15T13:09:16.170

我会测试你的吸气剂和二传手。根据编写代码的人员，有些人会更改 getter/setter 方法的含义。我已经将变量初始化和其他验证视为 getter 方法的一部分。为了测试这类事情，您需要明确覆盖该代码的单元测试。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2008-09-15T13:09:25.560

就我个人而言，我会“测试任何可以破坏的东西”并且简单的 getter（甚至更好的自动属性）不会破坏。我从来没有一个简单的返回语句失败，因此从来没有测试过它们。如果 getter 在其中有计算或其他形式的语句，我当然会为它们添加测试。

我个人使用[Moq](http://code.google.com/p/moq)作为模拟对象框架，然后验证我的对象是否以应有的方式调用周围的对象。

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2008-09-15T13:10:03.873

您必须使用 UT 覆盖类的每个方法的执行并检查方法返回值。这包括 getter 和 setter，尤其是在成员（属性）是复杂类的情况下，它们在初始化期间需要大量内存分配。例如，用一些非常大的字符串（或带有希腊符号的东西）调用 setter 并检查结果是否正确（未截断，编码良好等）

在同样适用的简单整数的情况下 - 如果您传递 long 而不是整数会发生什么？这就是你写 UT 的原因:)

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2008-09-15T13:10:22.970

一个类的测试应该验证：

1.  方法和属性返回预期值
2.  提供无效参数时会引发适当的异常
3.  调用给定方法时，类和其他对象之间的交互按预期发生

当然，如果 getter 和 setter 没有特殊逻辑，那么 Authenticate 和 Save 方法的测试应该涵盖它们，否则应该编写显式测试

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2008-09-15T13:11:04.760

我不会测试属性的实际设置。我会更关心消费者如何填充这些属性，以及它们用什么填充。对于任何测试，您都必须权衡风险与测试的时间/成本。

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2008-09-15T13:11:22.687

您应该尽可能使用单元测试来测试“每个重要的代码块”。

如果您的属性是微不足道的，并且不太可能有人会在其中引入错误，那么不对它们进行单元测试应该是安全的。

您的 Authenticate() 和 Save() 方法看起来很适合测试。

* * *

## 回答 #24

> 赞同：1
> 
> 时间：2008-09-15T13:13:19.827

理想情况下，您会在编写课程时完成单元测试。这就是您在使用测试驱动开发时应该这样做的方式。在实现每个功能点时添加测试，确保也用测试覆盖边缘情况。

之后编写测试要痛苦得多，但可行。

这是我在你的位置上会做的事情：

1.  编写一组基本的测试来测试核心功能。
2.  获取 NCover 并在您的测试中运行它。此时您的测试覆盖率可能在 50% 左右。
3.  继续添加覆盖边缘情况的测试，直到获得大约 80%-90% 的覆盖率

这应该为您提供一组很好的工作单元测试，它们将作为对回归的良好缓冲。

这种方法的唯一问题是代码必须*设计*成可以以这种方式进行测试。如果您在早期犯了任何耦合错误，您将无法很容易地获得高覆盖率。

这就是为什么在编写代码之前编写测试非常重要的原因。它迫使您编写松散耦合的代码。

* * *

## 回答 #25

> 赞同：1
> 
> 时间：2008-09-15T13:13:45.643

不要测试明显有效的（样板）代码。因此，如果您的 setter 和 getter 只是“propertyvalue = value”和“return propertyvalue”，那么测试它是没有意义的。

* * *

## 回答 #26

> 赞同：1
> 
> 时间：2008-09-15T13:14:07.063

甚至 get / set 也会产生奇怪的后果，这取决于它们是如何实现的，因此它们应该被视为方法。

这些测试的每个测试都需要为属性指定一组参数，定义可接受和不可接受的属性，以确保调用以预期的方式返回/失败。

您还需要了解安全问题，例如 SQL 注入，并针对这些问题进行测试。

所以是的，您确实需要担心测试属性。

* * *

## 回答 #27

> 赞同：1
> 
> 时间：2008-09-15T13:16:17.277

我认为当 getter 和 setter 只进行简单操作时测试它们是愚蠢的。就我个人而言，我不会编写复杂的单元测试来涵盖任何使用模式。我尝试编写足够的测试来确保我已经处理了正常的执行行为以及我能想到的尽可能多的错误情况。我将编写更多单元测试作为对错误报告的回应。我使用单元测试来确保代码满足要求并使将来的修改更容易。当我知道如果我破坏某些东西，测试将失败时，我会更愿意更改代码。

* * *

## 回答 #28

> 赞同：1
> 
> 时间：2008-09-15T13:23:50.050

我会为您正在编写的任何可在 GUI 界面之外测试的代码编写测试。

通常，我编写的任何具有任何业务逻辑的逻辑都放在另一个层或业务逻辑层中。

然后为任何做某事的事情编写测试很容易做到。

首先，为您的“业务逻辑层”中的每个公共方法编写一个单元测试。

如果我有这样的课：

```
 public class AccountService
    {
        public void DebitAccount(int accountNumber, double amount)
        {

        }

        public void CreditAccount(int accountNumber, double amount)
        {

        }

        public void CloseAccount(int accountNumber)
        {

        }
    } 
```

在我写任何代码之前，我知道我有这些动作要执行，我会做的第一件事就是开始编写单元测试。

```
 [TestFixture]
    public class AccountServiceTests
    {
        [Test]
        public void DebitAccountTest()
        {

        }

        [Test]
        public void CreditAccountTest()
        {

        }

        [Test]
        public void CloseAccountTest()
        {

        }
    } 
```

编写你的测试来验证你为做某事而编写的代码。如果您遍历一组事物，并更改它们中的每一个，请编写一个执行相同操作的测试并断言实际发生的事情。

您可以采用许多其他方法，即行为驱动开发 (BDD)，这种方法涉及更多，并且不是开始学习单元测试技能的好地方。

所以，这个故事的寓意是，测试任何你可能担心的事情，保持单元测试测试规模较小的特定事物，很多测试都是好的。

将您的业务逻辑保留在用户界面层之外，以便您可以轻松地为它们编写测试，并且您会做得很好。

我推荐[TestDriven.Net](http://testdriven.net/)或[ReSharper](http://www.jetbrains.com/resharper/)，因为它们都可以轻松集成到 Visual Studio 中。

* * *

## 回答 #29

> 赞同：1
> 
> 时间：2008-09-15T14:09:04.997

我建议为您的 Authenticate 和 Save 方法编写多个测试。除了成功案例（提供了所有参数，所有内容都拼写正确等）之外，最好对各种失败案例（不正确或缺少参数，如果适用的数据库连接不可用等）进行测试。我推荐[使用 NUnit](http://www.pragprog.com/titles/utc2/pragmatic-unit-testing-in-c-with-nunit)作为参考的 C# 中的实用单元测试。

正如其他人所说，getter 和 setter 的单元测试是多余的，除非你的 getter 和 setter 中有条件逻辑。

* * *

## 回答 #30

> 赞同：1
> 
> 时间：2008-09-15T14:51:09.747

虽然可以正确猜测您的代码需要测试的位置，但我通常认为您需要指标来支持这种猜测。在我看来，单元测试与代码覆盖率指标密切相关。

包含大量测试但覆盖率很小的代码尚未经过很好的测试。也就是说，具有 100% 覆盖率但不测试边界和错误情况的代码也不是很好。

您希望在高覆盖率（最低 90%）和可变输入数据之间取得平衡。

记得测试“垃圾输入”！

此外，除非检查失败，否则单元测试不是单元测试。没有断言或标记有已知异常的单元测试将简单地测试代码在运行时不会死！

您需要设计您的测试，以便它们始终报告失败或意外/不需要的数据！

* * *

## 回答 #31

> 赞同：1
> 
> 时间：2008-09-15T15:08:31.797

# 它使我们的代码更好……期间！

我们软件开发人员在进行测试驱动开发时忘记的一件事是我们行为背后的目的。如果在生产代码已经到位之后编写单元测试，则测试的价值会下降（但不会完全丢失）。

在单元测试的真正精神中，这些测试主要**不是**为了“测试”我们更多的代码；或获得 90%-100% 更好的代码覆盖率。这些都是先编写测试的**附带好处**。最大的回报是，由于 TDD 的自然过程，我们的生产代码最终写得更好。

为了帮助更好地传达这个想法，以下内容可能有助于阅读：

[有缺陷的单元测试理论](http://michaelfeathers.typepad.com/michael_feathers_blog/2008/06/the-flawed-theo.html)
[有目的的软件开发](http://blog.saadware.com/2008/07/02/purposeful-software-development/)

如果我们认为编写**更多单元测试**的行为有助于我们获得更高质量的产品，那么我们可能正在遭受测试驱动开发的[货物崇拜](http://en.wikipedia.org/wiki/Cargo_cult_programming)。

* * *

## 回答 #32

> 赞同：0
> 
> 时间：2008-09-15T15:16:57.767

我第二次**测试任何可能破坏的东西，**不要**编写愚蠢的测试**。但最重要的原则是**测试任何你发现有**问题的东西：如果某些方法表现得很奇怪，编写一个测试来概述导致它失败的数据集，然后纠正错误并观察栏变绿。还要测试“边界”数据值（null、0、MAX_INT、空列表等）。

* * *

## 回答 #33

> 赞同：0
> 
> 时间：2008-09-15T15:20:28.583

在编写单元测试或任何测试时，您可以通过查看所测试内容的边界条件来确定要测试的内容。例如，您有一个名为 is_prime 的函数。幸运的是，它按照其名称的含义告诉您整数对象是否为素数。为此，我假设您正在使用对象。现在，我们需要检查已知范围的素数和非素数对象是否发生了有效结果。那是你的出发点。

基本上，看看函数、方法、程序或脚本应该发生什么，然后看看同样的代码绝对*不应该发生什么。*这是你测试的基础。***随着您对代码应该***发生的事情的了解越来越多，请准备好修改您的测试。

* * *

## 回答 #34

> 赞同：0
> 
> 时间：2008-09-15T20:04:54.283

编写没有价值的代码总是一个坏主意。由于建议的测试不会为您的项目增加任何价值（或非常接近它）。那么你就是在浪费宝贵的时间来编写真正带来价值的代码。

* * *

## 回答 #35

> 赞同：0
> 
> 时间：2010-04-26T21:44:23.780

我见过的最好的经验法则是测试你无法一眼看出的所有东西，肯定会正常工作。还有更多，您最终会测试语言/环境。

* * *

## 回答 #36

> 赞同：-3
> 
> 时间：2008-09-15T13:07:01.667

我不能专门针对 C# 说话，但是当我编写单元测试时，我会测试每个输入，即使是用户不做的输入，这样我就知道如何防止自己的错误。

# c++ - 如何在 Qt 4.4.1 中检测应用程序 Level Focus-In？

> ID：62629
> 
> 赞同：3
> 
> 时间：2008-09-15T13:03:48.303
> 
> 标签：c++, qt

我需要确定我的 Qt 4.4.1 应用程序何时获得焦点。

我想出了两种可能的解决方案，但它们都不能完全按照我的意愿工作。

在第一个可能的解决方案中，我将来自 qApp 的 focusChanged() 信号连接到一个 SLOT。在插槽中，我检查了“旧”指针。如果它是“0”，那么我知道我们已经切换到这个应用程序，我会做我想做的事。在此处介绍的两种解决方案中，这似乎是让应用程序检测焦点的最可靠方法，但会遇到下面描述的问题。

在第二种可能的解决方案中，我覆盖了“focusInEvent()”例程，如果原因是“ActiveWindowFocusReason”，则执行我想要的操作。

在这两种解决方案中，代码在我不希望它执行的时候执行。

例如，我有这个覆盖 focusInEvent() 例程的代码：

```
void
ApplicationWindow::focusInEvent( QFocusEvent* p_event )
{

  Qt::FocusReason reason = p_event->reason();

  if( reason == Qt::ActiveWindowFocusReason && 
      hasNewUpstreamData() )
  {
    switch( QMessageBox::warning( this, "New Upstream Data Found!",
                                  "New upstream data exists!\n"
                                  "Do you want to refresh this simulation?",
                                  "&Yes", "&No", 0, 0, 1 ) )
    { 
    case 0: // Yes
      refreshSimulation();
      break;
    case 1: // No
      break;
    }
  }
} 
```

当它被执行时，会出现 QMessageBox 对话框。但是，当通过按“是”或“否”关闭对话框时，此函数会立即再次被调用，因为我认为此时焦点已通过 ActiveWindowFocusReason 更改回应用程序窗口。显然我不希望这种情况发生。

同样，如果用户正在使用应用程序打开和关闭对话框和窗口等，我不希望激活此例程。注意：我不确定激活此例程的情况，因为我已经尝试了一点，并且并非所有窗口和对话框都发生这种情况，但至少在示例代码中显示的情况下会发生这种情况.

我只希望它在应用程序从该应用程序外部聚焦时激活，而不是在主窗口从其他对话框窗口聚焦时激活。

这可能吗？如何才能做到这一点？

感谢您提供任何信息，因为这对我们的应用程序非常重要。

雷蒙德。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-11T02:04:43.493

我认为您需要跟踪[QEvent::ApplicationActivate](http://doc.qt.io/qt-4.8/qevent.html#Type-enum)事件。

您可以在 QApplication 实例上放置一个[事件过滤器](http://doc.qt.io/qt-4.8/qobject.html#eventFilter)，然后查找它。

```
bool
ApplicationWindow::eventFilter( QObject * watched, QEvent * event )
{
    if ( watched != qApp )
        goto finished;

    if ( event->type() != QEvent::ApplicationActivate )
        goto finished;

    // Invariant: we are now looking at an application activate event for
    //            the application object
    if ( !hasNewUpstreamData() )
        goto finished;

    QMessageBox::StandardButton response =
            QMessageBox::warning( this, "New Upstream Data Found!",
                                  "New upstream data exists!\n"
                                  "Do you want to refresh this simulation?",
                                  QMessageBox::Yes | QMessageBox::No) );

    if ( response == QMessageBox::Yes )
      refreshSimulation();

finished:
    return <The-Superclass-here>::eventFilter( watched, event );
}

ApplicationWindow::ApplicationWindow(...)
{
    if (qApp)
        qApp->installEventFilter( this );
    ...
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-06T09:33:51.677

当您的对话框打开时，键盘事件不会转到您的主窗口。对话框关闭后，他们会这样做。这是一个焦点变化。如果您想忽略焦点从应用程序中的另一个窗口切换的情况，那么您需要知道应用程序中的任何窗口何时具有焦点。创建一个变量并为您的函数添加更多逻辑。这将需要一些小心，因为对话框将在主窗口获得焦点之前失去焦点。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-15T13:23:21.627

查看 Qt 文档，似乎每次小部件获得焦点时都会创建焦点事件，因此由于您所述的原因，您发布的示例代码将不起作用。

我猜 QApplication::focusedChanged 不能按照您想要的方式工作，因为某些小部件不接受键盘事件，因此即使在同一个应用程序中更改焦点，也会返回 null 作为“旧”小部件。

我想知道你是否可以用 QApplication::activeWindow() 做任何事情

> 返回具有键盘输入焦点的应用程序顶级窗口，如果没有应用程序窗口具有焦点，则返回 0。请注意，即使没有 focusWidget()，也可能存在 activeWindow()，例如，如果该窗口中没有小部件接受键事件。

# java - 将 Java 对象图保存为 XML 文件

> ID：62650
> 
> 赞同：14
> 
> 时间：2008-09-15T13:05:43.883
> 
> 标签：java, xml

可用于将任意 Java 对象图保存为 XML 文件（并能够在以后重新水化对象）的最简单易用的技术是什么？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-15T13:14:45.487

这里最简单的方法是序列化对象图。Java 1.4 内置了对作为 XML 的序列化的支持。

我成功使用的一个解决方案是 XStream（[http://x-stream.github.io/](http://x-stream.github.io/)-) ）——它是一个小型库，可让您轻松地对 XML 进行序列化和反序列化。

缺点是您只能非常有限地定义生成的 XML；在您的情况下，这可能不是必需的。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-15T13:08:30.307

Apache 消化器相当简单：[http](http://commons.apache.org/digester/)
://commons.apache.org/digester/ JAXB 较新并且带有注释功能：[https ://jaxb.dev.java.net](https://jaxb.dev.java.net)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-15T13:16:47.227

Thoughtworks 开发的 XStream 有一个简单的 API，甚至可以处理重复和循环引用之类的事情。它似乎正在积极开发并且有据可查。

[http://x-stream.github.io/](http://x-stream.github.io/)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-15T14:13:27.637

使用`java.beans.XMLEncoder`. 它的 API 非常简单（实际上有点太简单了；最好将它连接到 SAX ContentHandler），但它可以在许多开箱即用的图形上工作，并且很容易为任何奇怪的创建自己的持久性委托 -您可能会遇到的球类。

*   XMLDecoder 使用的语法允许您调用任何方法、实例或静态方法，包括构造函数，因此它非常灵活。
*   其他编码器在类和字段名称之后命名元素和属性，因此结果没有固定的模式。XMLEncoder 的 XML 遵循一个简单的 DTD，并且可以轻松地验证或转换，即使您从未见过它使用的类型。
*   您可以为对象分配一个标识符，并在整个图形中引用它们。
*   您可以引用类或接口中定义的常量。

而且，它内置在 Java SE 中，因此您无需提供额外的库。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-24T21:18:02.197

# *简单的*

尽管 XStream 和 JAXB 可以成功地序列化一些对象图，但它们不能处理非常复杂的图。大型复杂图最强大的解决方案是[*简单*XML 序列化](http://simple.sourceforge.net/)。它可以处理任何图形。此外，它使用起来既快速又简单，没有任何依赖关系。

引用*简单*项目页面：

> Simple 是一个用于 Java 的高性能 XML 序列化和配置框架。它的目标是提供一个能够快速开发 XML 配置和通信系统的 XML 框架。该框架有助于以最少的工作量和减少错误的方式开发 XML 系统。它提供完整的对象序列化和反序列化，维护遇到的每个引用。本质上，它类似于 Java 平台的 C# XML 序列化，但提供了额外的拦截和操作功能。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-15T13:15:06.920

Simple API 非常简单！真的很棒。[http://simple.sourceforge.net/](http://simple.sourceforge.net/)

您还可以使用 XStream：[http ://www.ibm.com/developerworks/library/x-xstream/index.html](http://www.ibm.com/developerworks/library/x-xstream/index.html)

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-15T19:11:49.760

[JAX-B](http://jaxb.java.net/)是标准 API 的一部分，非常易于使用。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-09-16T04:03:49.687

如果您需要控制生成的 XML，我建议您查看 Betwixt ( [http://commons.apache.org/betwixt/](http://commons.apache.org/betwixt/) ) - 它为 Apache 的消化器添加了很多功能（消化器非常适合构建对象图来自 XML，但不适合生成它们）。

如果您真的不关心生成的 XML（只是它可以在将来反序列化），那么 XMLEncoder/Decoder 类内置在 Java 中还是不错的 - 只要您要序列化的对象遵循 JavaBean 规范。我在使用 XMLEncoder/Decoder 解决方案时遇到的最大问题是，如果您有一个 bean 为它的一个属性返回一个不可变列表 - 编码器不能很好地处理这种情况。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-15T13:13:21.980

XStream 非常简单[http://x-stream.github.io/](http://x-stream.github.io/)

XStream 是一个简单的库，用于将对象序列化为 XML 并再次返回。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-15T14:06:04.940

如果需要控制 XML 的结构，XStream 是一个不错的选择。您可以使用注释来精确定义 XML 和对象的结构/映射。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-09-15T20:00:39.503

我会选择第二个（或第三个）XStream。它无需任何特殊的绑定配置或在 XML 中放置大量无关语法即可读取和写入 XML。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2010-02-25T20:44:59.313

我[整理了一个](http://karussell.wordpress.com/2009/09/03/xml-serializers-for-java/)包含许多 xml 序列化库及其许可证的列表

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-09-15T13:11:41.030

[java.beans.XMLEncoder](http://java.sun.com/j2se/1.4.2/docs/api/java/beans/XMLEncoder.html)也许？

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2018-07-19T06:07:11.657

# 杰克逊

[*Jackson Project*](https://github.com/FasterXML/jackson)是一个用于 XML、JSON 和其他一些格式的处理和绑定库。

> …Jackson 是一套用于 Java（和 JVM 平台）的数据处理工具，包括旗舰流式 JSON 解析器/生成器库、匹配数据绑定库（与 JSON 之间的 POJO）以及用于处理编码数据的附加数据格式模块在 Avro、BSON、CBOR、CSV、Smile、(Java) 属性、Protobuf、XML 或 YAML 中；甚至还有大量数据格式模块来支持广泛使用的数据类型的数据类型，例如 Guava、Joda、PCollections 等等……

* * *

## 回答 #15

> 赞同：-1
> 
> 时间：2008-09-15T13:28:16.560

如果您真的只对将对象序列化为文件然后再反序列化它们感兴趣，那么您可能会检查 YAML 而不是 XML。YAML 比 XML 更容易使用，并且输出文件非常易于阅读（这可能是也可能不是要求）。查看[yaml.org](http://yaml.org/)了解更多信息。我在最近的一个项目中成功使用了[JYAML 。](http://jyaml.sourceforge.net/ "JYAML")

# f# - 如何在 F# 类中定义和使用静态变量

> ID：62654
> 
> 赞同：8
> 
> 时间：2008-09-15T13:06:18.703
> 
> 标签：f#, functional-programming

有没有办法让 F# 类中的可变静态变量与 C# 类中的静态变量相同？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-09-15T17:56:56.290

您使用`static let`绑定（注意：虽然有时是必要的，但它并不太实用）：

```
type StaticMemberTest () =

    static let mutable test : string = ""

    member this.Test 

        with get() = 
            test <- "asdf"
            test 
```

# php - 让 PEAR 在 XAMPP 上工作（Windows 上的 Apache/MySQL 堆栈）

> ID：62658
> 
> 赞同：14
> 
> 时间：2008-09-15T13:06:38.983
> 
> 标签：php, pear, laconica

我正在尝试[按照提供的说明](http://laconi.ca/trac/wiki/InstallationWindows)使用 XAMPP 在我的 Windows 开发服务器上安装开源微博应用程序[Laconica](http://laconi.ca/)。

该网站找不到 PEAR，并抛出以下错误：

> 警告：require_once(PEAR.php) [function.require-once]：无法打开流：第 31 行的 C:\xampplite\htdocs\laconica\lib\common.php 中没有这样的文件或目录
> 
> 致命错误：require_once() [function.require]：在 C:\xampplite\htdocs\laconica\lib\common 中打开所需的 'PEAR.php' (include_path='.;\xampplite\php\pear\PEAR') 失败。第 31 行的 php

1.  梨位于`C:\xampplite\php\pear`
2.  `phpinfo()`告诉我包含路径是`.;\xampplite\php\pear`

我究竟做错了什么？为什么不包含 PEAR 文件夹？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-09-15T13:23:59.753

您需要修复`include_path`系统变量以指向正确的位置。

要修复它，请编辑`php.ini`文件。在该文件中，您会发现一行写着“ `include_path = ...`”。（您可以通过在页面上运行来找出 php.ini 的位置`phpinfo()`。）将“ ” 行的部分修复为`\xampplite\php\pear\PEAR`“ `C:\xampplite\php\pear`”。确保在行之前和/或之后保留分号。

重新启动 PHP，你应该一切顺利。要在 IIS 中重新启动 PHP，您可以重新启动分配给您的站点的应用程序池，或者更好的是，一起重新启动 IIS。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2012-08-21T17:54:44.740

如果您使用的是便携式 XAMPP 安装和 Windows 7，并且像我一样拥有从控制面板中删除 XAMPP shell 后的版本，这里建议的答案都不会对您有好处，因为这些软件包不会安装。

问题出在配置文件上。经过大量的试验和错误，我找到了正确的设置。

只需在 \xampp\php 目录中拉出一个命令窗口并运行

```
pear config-set doc_dir :\xampp\php\docs\PEAR
pear config-set cfg_dir :\xampp\php\cfg
pear config-set data_dir :\xampp\php\data\PEAR
pear config-set test_dir :\xampp\php\tests
pear config-set www_dir :\xampp\php\www 
```

您将希望将“：”替换为您的便携式驱动器目前正在运行的实际驱动器号。不幸的是，只要驱动器号发生变化，就需要这样做，但它确实安装了我需要的模块。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2015-07-03T10:00:30.157

我首先尝试了所有其他答案，但它们似乎都不起作用，所以我在 pear 配置文件中静态设置 pear 路径

C:\xampp\php\pear\Config.php

找到这段代码：

```
if (!defined('PEAR_INSTALL_DIR') || !PEAR_INSTALL_DIR) {
    $PEAR_INSTALL_DIR = PHP_LIBDIR . DIRECTORY_SEPARATOR . 'pear';
} 
else {
    $PEAR_INSTALL_DIR = PEAR_INSTALL_DIR;
} 
```

并将其替换为：

```
$PEAR_INSTALL_DIR = "C:\\xampp\\php\\pear"; 
```

我重新启动了apache并使用了命令：

```
pear config-all 
```

确保所有路径不再以 C:\php\pear 开头

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-15T13:16:33.500

根据第 1 点，您的 PEAR 路径是 c:\xampplite\php\pear\

但是，您的路径指向 \xampplite\php\pear\PEAR

把两个放在一个上面你可以清楚地看到一个太长了：

c:\xampplite\php\梨\

\xampplite\php\pear\PEAR

您的包含路径设置为在梨树中太深一个 PEAR。pear 文件夹的 PEAR 子文件夹包括 PEAR 组件。您需要将包含路径向上调整一级。

（你不需要 c: 顺便说一句，你的路径很好，只是太深了）

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2017-02-01T08:35:06.207

在 Windows 上使用**Xampp shell**（XAMPP 控制面板中有一个“Shell”按钮）

然后

```
cd php\pear 
```

去 'C:\xampp\php\pear'

然后输入

```
pear 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2019-03-18T06:04:00.513

我解决了

avast 会删除您目录中的 server.php，因此禁用防病毒软件

检查 laravel 文件夹中的 (server.php) 文件

> 服务器.php

```
<?php

/**
 * Laravel - A PHP Framework For Web Artisans
 *
 * @package  Laravel
 * @author   Taylor Otwell <taylor@laravel.com>
 */

$uri = urldecode(
    parse_url($_SERVER['REQUEST_URI'], PHP_URL_PATH)
);

// This file allows us to emulate Apache's "mod_rewrite" functionality from the
// built-in PHP web server. This provides a convenient way to test a Laravel
// application without having installed a "real" web server software here.
if ($uri !== '/' && file_exists(__DIR__.'/public'.$uri)) {
    return false;
}

require_once __DIR__.'/public/index.php';
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-15T13:15:18.277

尝试添加驱动器号：

```
include_path='.;c:\xampplite\php\pear\PEAR' 
```

还要验证 PEAR.php 是否确实存在，它可能在 \php\ 中：

```
include_path='.;c:\xampplite\php' 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2013-09-13T14:18:48.453

此类问题的另一个问题是：避免在 Windows 机器上的 Unix shell（例如，Git Bash 或 Cygwin）中运行 pear。我遇到了同样的问题，上面建议的路径修复没有帮助。切换到 Windows shell，pear 命令按预期工作。

# direct3d - 在 Direct3D 中实现 Porter-Duff 规则

> ID：62661
> 
> 赞同：1
> 
> 时间：2008-09-15T13:07:01.010
> 
> 标签：direct3d, alphablending, compositing

应该使用哪些 Direct3D 渲染状态来实现 Java 的 Porter-Duff 合成规则（CLEAR、SRC、SRCOVER 等）？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-15T23:14:41.597

我没有过多地使用 Java，但根据[1984 年的白皮书](http://keithp.com/~keithp/porterduff/p253-porter.pdf)，它应该是渲染状态混合模式的相当简单的映射。

当然，除了这些之外，您还可以做更多的事情，比如普通的 alpha 混合（SourceAlpha、InvSourceAlpha）或加法（One、One）等等。*（我假设您之所以特别询问这些是因为您要移植一些现有功能？因此您可能不关心其他组合......）*

无论如何，这些假设 Add 的 BlendOperation 并且 AlphaBlendEnable 为真。

清除

```
SourceBlend = Zero
DestinationBlend = Zero 
```

一个

```
SourceBlend = One
DestinationBlend = Zero 
```

乙

```
SourceBlend = Zero
DestinationBlend = One 
```

A 超过 B

```
SourceBlend = One
DestinationBlend = InvSourceAlpha 
```

B 超过 A

```
SourceBlend = InvDestinationAlpha
DestinationBlend = One 
```

B中的A

```
SourceBlend = DestinationAlpha
DestinationBlend = One 
```

A中的B

```
SourceBlend = Zero
DestinationBlend = SourceAlpha 
```

A出B

```
SourceBlend = InvDestinationAlpha
DestinationBlend = Zero 
```

B出A

```
SourceBlend = Zero
DestinationBlend = InvSourceAlpha 
```

A 顶 B

```
SourceBlend = DestinationAlpha
DestinationBlend = InvSourceAlpha 
```

B在A之上

```
SourceBlend = InvDestinationAlpha
DestinationBlend = SourceAlpha 
```

异或 B

```
SourceBlend = InvDestinationAlpha
DestinationBlend = InvSourceAlpha 
```

将这些链接起来稍微复杂一些，并且需要多个通道或多个纹理输入到着色器。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-12-23T21:48:53.183

对于“B 中的 A”情况，DestinationBlend 不应该为零吗？

B中的A

```
SourceBlend = DestinationAlpha
DestinationBlend = Zero 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-16T01:31:40.487

当我实现“A”的渲染状态（即绘制源像素颜色/alpha 并忽略目标像素颜色/alpha）时，如果源的 alpha 值为零，Direct3D 似乎无法正确执行操作。我没有用透明度填充目标区域，而是看到目标区域保持不变。但是，如果我将源 alpha 值更改为 1，则目标区域将“几乎”透明。即使我禁用 alphablending 渲染状态也会发生这种情况，所以我认为这是一种优化尝试，实际上是 Direct3D 中的一个错误。

除了这种情况，Corey 的渲染状态似乎是正确的。谢谢，科里！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-16T05:49:31.193

要检查的一件事，确保 alpha 测试已关闭

```
AlphaTestEnable = false 
```

如果启用（以及 AlphaFunction = Greater 和 ReferenceAlpha = 0 之类的东西），则无论 AlphaBlendEnable 设置如何，都可能丢弃清晰的像素。

# windows - 带有透明位图的 GDI+ DrawImage() 到打印机

> ID：62663
> 
> 赞同：5
> 
> 时间：2008-09-15T13:07:15.160
> 
> 标签：windows, gdi+

当基于打印机 HDC 创建图形上下文时，是否有人对如何使用 Graphics::DrawImage() 成功绘制具有 alpha 通道的位图有任何指示？打印机驱动程序通常不支持 alpha 混合 - 因此是否可以将所有内容渲染到屏幕外位图并将其发送到打印机。这通常是不可行的，尤其是对于大幅面打印机的高分辨率打印。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-25T19:30:01.603

那是什么打印机？普通打印机不打印白色。创建内存图像并将其“展平”（删除 Alpha 通道），然后打印结果。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-15T13:55:01.910

在调用 DrawImage 方法之前，您是否尝试过绘制一个白色矩形来初始化图像？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-15T14:24:06.037

重点是我需要图像后面的线条绘制图形可见。我确实尝试先用 (255, 255, 255, 0) 的 RGBA 颜色填充矩形，但这无济于事。alpha 值为零的像素会打印为完全透明，但部分透明的像素会被绘制为完全不透明。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-02-06T17:37:23.420

感谢您提出这个问题，因为我只是在想也许尝试使用 GDIplus 来看看它是否可以让我解决我仍然面临的问题，让图案菱形形状正确打印。尽管现在 alpha 混合似乎确实适用于大多数打印机，但仍有一些会在钻石上画出黑角。

除了 alpha 混合，我还尝试使用菱形剪辑区域围绕形状，但通常不支持 alpha 混合的打印机似乎也不支持多边形剪辑区域。我已经尝试从打印机-dc 复制到位图中以在顶部绘制菱形之前对其进行填充，希望这将允许我放回（在角落里）以前的东西。这也不起作用，因为问题似乎归结为打印机驱动程序实际上并不知道在页面的哪个部分打印了什么。

就我而言，我的下一个计划是尝试使用大型位图笔刷将菱形填充直接绘制到打印机 hdc。我怀疑某些打印机也有可能失败。听起来它可能不是您正在做的事情的选择。

# .net - 在属性更新后对数据绑定对象执行验证

> ID：62686
> 
> 赞同：2
> 
> 时间：2008-09-15T13:09:28.277
> 
> 标签：.net, vb.net, validation, data-binding

我有一个基本表单，其中包含数据绑定到实现*INotifyPropertyChanged*接口的对象的控件。我想为几个属性添加一些验证，但不想通过实现*IDataErrorInfo*来验证几个属性。

我已经创建了执行验证并在对象中返回错误消息（如果适用）的函数。我想做的是在对象上的相关属性发生更改时从我的表单中调用这些函数，并在我的表单中设置*ErrorProvider*控件，其中包含从验证函数返回的任何错误消息。

我尝试将事件处理程序连接到 Validating 和 LostFocus 事件，但这些似乎在我的对象更新之前触发，因此它们没有验证正确的数据。只有当我离开文本框，返回然后再次离开时，验证才会针对正确的数据运行。

是否有另一个事件可以挂钩，以便在我的对象的属性更新后调用这些验证函数？还是我最好只实现*IDataErrorInfo*接口？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-15T13:23:02.440

我不确定到底是什么问题，您是说在控件失去焦点之前无法设置属性？

如果是这样，您需要将绑定设置为 update`OnPropertyChanged`而不是`OnValidation`.

绑定到`OnPropertyChanged`意味着绑定立即更新，而`OnValidation`仅在触发验证时更新底层对象（对于大多数控件来说，当它们失去焦点时）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-15T13:32:31.450

我想我在 Cameron 的帖子的帮助下找到了解决问题的方法。我已将绑定更改为更新 OnPropertyChanged，现在当我将事件处理程序连接到 LostFocus 事件时，正在对文本框中的“新”值执行验证，而不是之前保存在对象中的值

# c - C中的按位索引？

> ID：62689
> 
> 赞同：8
> 
> 时间：2008-09-15T13:09:32.253
> 
> 标签：c, coding-style, bit-manipulation

我正在尝试实现我曾经拥有的数据压缩想法，并且由于我正在想象针对大量测试数据运行它，因此我曾考虑用 C 对其进行编码（我主要有 Ruby 和Tcl。）

浏览 O'Reilly 关于 C 的“奶牛”书籍，我意识到我不能简单地索引一个简单的“char”或“int”类型变量的位，因为我想做按位比较和运算符。

我的这种看法是正确的吗？对我来说使用枚举类型来表示位是否合理（并制作一个数组，并编写函数来转换为字符和从字符转换）？如果是这样，那么标准库中是否已经在某个地方定义了这种类型和函数？还有其他（更好的？）方法吗？有人可以指出我的某个地方是否有一些示例代码？

谢谢 -

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-15T13:49:49.550

继凯尔所说的之后，您可以使用宏来为您完成艰苦的工作。

> 有可能的。
> 
> 要设置第 n 位，请使用 OR：
> 
> x |= (1 << 5); // 设置从右数第 6 个
> 
> 要清除一点，请使用 AND：
> 
> x &= ~(1 << 5); // 清除右数第 6 个
> 
> 要稍微翻转一下，请使用 XOR：
> 
> x ^= (1 << 5); // 从右数第 6 个翻转

**或者...**

```
#define GetBit(var, bit) ((var & (1 << bit)) != 0) // Returns true / false if bit is set
#define SetBit(var, bit) (var |= (1 << bit))
#define FlipBit(var, bit) (var ^= (1 << bit)) 
```

然后你可以在如下代码中使用它：

```
int myVar = 0;
SetBit(myVar, 5);
if (GetBit(myVar, 5))
{
  // Do something
} 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-15T13:13:24.007

有可能的。

要设置第 n 位，请使用 OR：

```
x |= (1 << 5); // sets the 5th-from right 
```

要清除一点，请使用 AND：

```
x &= ~(1 << 5); // clears 5th-from-right 
```

要稍微翻转一下，请使用 XOR：

```
x ^= (1 << 5); // flips 5th-from-right 
```

要获取位的值，请使用 shift 和 AND：

```
(x & (1 << 5)) >> 5 // gets the value (0 or 1) of the 5th-from-right 
```

注意：右移 5 是为了确保该值为 0 或 1。如果您只对 0/非 0 感兴趣，则无需移位即可。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-15T13:19:22.963

看看[这个问题](https://stackoverflow.com/questions/47981/how-do-you-set-clear-and-toggle-a-single-bit-in-c)的答案。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-15T13:48:54.373

**理论**

没有用于访问或设置内置数据类型（例如“char”）的第 n 位的 C 语法。但是，您可以使用逻辑 AND 操作访问位，并使用逻辑 OR 操作设置位。

例如，假设您有一个包含 1101 的变量，并且您想检查左侧的第二位。只需对 0100 执行逻辑与：

```
1101
0100
---- AND
0100 
```

如果结果非零，则第 2 位必须已设置；否则未设置。

如果要设置左起第 3 位，则与 0010 执行逻辑或：

```
1101
0010
---- OR
1111 
```

您可以使用 C 运算符 &&（用于 AND）和 || （对于 OR）来执行这些任务。您将需要自己构建位访问模式（上述示例中的 0100 和 0010）。诀窍是记住最低有效位 (LSB) 计为 1，下一个 LSB 计为 2，然后是 4，依此类推。因此，第 n 个 LSB（从 0 开始）的位访问模式就是 2^ 的值n. 在 C 中计算它的最简单方法是将二进制值 0001（在这个四位示例中）向左移动所需的位数。由于此值在无符号整数类数量中始终等于 1，因此这只是 '1 << n'

**例子**

```
unsigned char myVal = 0x65; /* in hex; this is 01100101 in binary. */

/* Q: is the 3-rd least significant bit set (again, the LSB is the 0th bit)? */
unsigned char pattern = 1;
pattern <<= 3; /* Shift pattern left by three places.*/

if(myVal && (char)(1<<3)) {printf("Yes!\n");} /* Perform the test. */

/* Set the most significant bit. */
myVal |= (char)(1<<7); 
```

此示例尚未经过测试，但应用于说明总体思路。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-15T13:19:28.673

查询具有特定索引的位状态：

```
int index_state = variable & ( 1 << bit_index ); 
```

设置位：

```
varabile |= 1 << bit_index; 
```

要重新启动位：

```
variable &= ~( 1 << bit_index ); 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-15T13:15:57.743

如果你想索引一点，你可以：

```
bit = (char & 0xF0) >> 7; 
```

获取一个字符的 msb。您甚至可以省略右移并在 0 上进行测试。

```
bit = char & 0xF0; 
```

如果设置了该位，则结果将 > 0；

显然，您需要更改掩码以获得不同的位（注意：如果不清楚，0xF 是位掩码）。可以定义许多掩码，例如

```
#define BIT_0 0x1 // or 1 << 0
#define BIT_1 0x2 // or 1 << 1
#define BIT_2 0x4 // or 1 << 2
#define BIT_3 0x8 // or 1 << 3 
```

ETC...

这给了你：

```
bit = char & BIT_1; 
```

您可以在上述代码中使用这些定义成功地在宏或函数中索引位。

设置一点：

```
char |= BIT_2; 
```

要清除一点：

```
char &= ~BIT_3 
```

稍微切换一下

```
char ^= BIT_4 
```

这个帮助？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-15T13:25:45.770

有一个用于位的标准库容器：std::vector。它专门用于图书馆以节省空间。还有一个 boost dynamic_bitset 类。

这些将允许您对一组布尔值执行操作，每个底层存储值使用一个位。

[Boost 动态位集文档](http://www.boost.org/doc/libs/1_36_0/libs/dynamic_bitset/dynamic_bitset.html)

有关 STL 文档，请参阅您的编译器文档。

当然，您也可以手动寻址其他整数类型中的各个位。如果你这样做，你应该使用无符号类型，这样如果决定对设置了高位的值进行右移，你就不会得到未定义的行为。但是，听起来您想要容器。

对于声称这需要比所需空间多 32 倍的评论者： boost::dynamic_bitset 和 vector 专门用于每个条目使用一位，因此没有空间损失，假设您实际上想要的位数超过 a 中的位数原始类型。这些类允许您使用高效的底层存储来处理大型容器中的各个位。如果您只想（比如说）32 位，请务必使用 int。如果您想要一些大量的位，您可以使用库容器。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-15T13:27:22.180

尝试使用位域。请注意，实现可能因编译器而异。

[http://publications.gbdirect.co.uk/c_book/chapter6/bitfields.html](http://publications.gbdirect.co.uk/c_book/chapter6/bitfields.html)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-15T13:55:21.533

可以如下索引各个位。

定义一个像这样的结构：

```
struct
{
  unsigned bit0     : 1;
  unsigned bit1     : 1;
  unsigned bit2     : 1;
  unsigned bit3     : 1;
  unsigned reserved : 28;
} bitPattern; 
```

现在，如果我想知道名为“value”的 var 的各个位值，请执行以下操作：

```
CopyMemory( &input, &value, sizeof(value) ); 
```

要查看位 2 是高还是低：

```
int state = bitPattern.bit2; 
```

希望这可以帮助。

# computer-science - 关于订单分析的好文章

> ID：62702
> 
> 赞同：4
> 
> 时间：2008-09-15T13:10:34.777
> 
> 标签：computer-science

作为一名自学成才的计算机程序员，我经常无法估计特定操作的 O() 值。是的，我知道大多数重要的，比如主要的分类和搜索，但是当新的东西出现时，我不知道如何计算一个，除非它非常明显。是否有一个很好的网站或文字来解释如何做到这一点？哎呀，我什至不知道计算机科学家怎么称呼它，所以我无法谷歌它。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-15T13:14:06.250

它被称为[Big O Notation](http://en.wikipedia.org/wiki/Big_O_notation)，用于[计算复杂性理论](http://en.wikipedia.org/wiki/Computational_complexity_theory)。

维基百科文章是一个很好的起点，页面底部的参考书目也是如此。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-15T13:14:45.657

[算法简介](http://mitpress.mit.edu/algorithms/)是大多数大学使用的标准文本。我已经使用它并且可以推荐那些关于订单分析的章节。不过，我将从 Tim Howland 的回答中的文章开始。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-15T13:31:19.160

如果你真的想学习这个主题，那么你可能需要一本标准的理论/算法教科书。我不知道有哪个网站可以真正教你复杂性分析（“复杂性”或“时间复杂性”是你如何称呼这些 O() 值；你可能还想在谷歌上搜索“算法分析”或“介绍算法”等）。

但在那之前——一个免费的选择。麻省理工学院的 Erik Demaine 和 Charles Leiserson 提供的课程中的幻灯片是免费的，而且看起来很棒。我肯定会尝试阅读它们，看看是否适合你。他们在[这里](http://ocw.mit.edu/OcwWeb/Electrical-Engineering-and-Computer-Science/6-046JFall-2005/LectureNotes/)。

现在，教科书：

教科书的经典选择是 Cormen 等人的著作[Introduction to Algorithms （](https://rads.stackoverflow.com/amzn/click/com/0262032937)[这里](http://www.fetchbook.info/fwd_description/search_9780262032933.html)可能有便宜的版本可以买到，我记得在网上看到过免费（可能是非法的）版本，但我不记得在哪里）。

[Kleinberg and Tardos' Algorithm Design](https://rads.stackoverflow.com/amzn/click/com/0321295358)是 IMO 读起来更有趣和更好的选择，更近现代风格的书。

以下是一些提供信息的网站（我通过谷歌搜索“算法分析讲义”而不带引号得到这些信息）：

*   [算法讲义](http://www.personal.kent.edu/~rmuhamma/Algorithms/algorithm.html)
*   [Steve Skiena 讲义](http://www.cs.sunysb.edu/~algorith/lectures-good/index.html)

以上是由计算机科学理论家撰写的。所以程序员或其他实际的人可能会有一些不同的看法。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-15T13:16:12.830

它被称为算法分析，本身就是一门科学。看看[这里的一些书](http://4storing.biz/f/3wv:24763a50)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-16T09:24:09.260

> *您的链接将我带到一个* *似乎需要用户名* *和密码的俄语网站。合法的错误，还是* *巨魔？保罗·汤布林*

该网站是保加利亚语的，您不需要密码即可访问我链接到的文件列表并下载其中一些文件。当然，除非对保加利亚以外的 IP 有访问限制，我真的不知道。

对不起，我不知道如何发表评论。

# java - 访问 ID 中带有点 (.) 的 bean

> ID：62713
> 
> 赞同：9
> 
> 时间：2008-09-15T13:12:04.370
> 
> 标签：java, spring, spring-webflow, spring-el

在流定义中，我试图访问一个在其 ID 中有一个点的 bean

（例子：`<evaluate expression="bus.MyServiceFacade.someAction()" />`

但是，它不起作用。SWF 试图找到一个 bean“总线”。

最初，我通过使用辅助 bean 加载所需的 bean 来克服它，但解决方案不优雅且不舒服。使用别名也是不可能的，因为 bean 是大型系统的一部分，我无法篡改它们。

简而言之，没有一个解决方案允许我使用原始名称直接引用 bean。这在当前的 SWF 版本中是否可能？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2013-01-18T22:17:41.247

我可以通过使用 bean 访问器 ( `@`) 符号和 bean 名称周围的单引号来做到这一点。

使用您的示例：`#{@'bus.MyServiceFacade'.someAction()}`

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-15T19:16:49.407

这是 EL 解析器的限制（通常是 OGNL 或 Spring Web Flow 的 jboss-el）。EL 使用点符号来解析导航链，导致您描述的初始行为（试图找到“总线”b​​ean）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-15T21:29:17.310

尝试：

['bus.MyServiceFacade'].someAction()

或者

'bus.MyServiceFacade'.someAction()

这可能有效，也可能无效……但在 JSP 的表达式语言中使用了类似的东西。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-09-15T19:22:21.140

根据我的经验，任何带有 getter 方法的东西都可以通过点表示法访问。在您的示例中，bean 表示的任何对象都`bus`需要有一个`getServiceFacade`方法，并且返回的对象`getServiceFacade`需要有一个`getSomeAction`方法。

# svn - SVN 外部子文件夹更改未显示在视图日志中（乌龟 svn）

> ID：62716
> 
> 赞同：11
> 
> 时间：2008-09-15T13:12:39.657
> 
> 标签：svn, tortoisesvn

SVN 外部允许您使 SVN 文件夹看起来好像它在另一个位置。一个很好的用途是在 SVN 中的所有项目之间共享一个公共文件夹。

我在 SVN 中有一个 /trunk/common 文件夹，我通过几个不同的项目共享它。

例子：

*   项目1：/trunk/project1/depends
*   项目2：/trunk/project2/depends
*   项目3：/trunk/project3/depends
*   项目4：/trunk/project4/depends

这些依赖文件夹中的每一个都是空的，但定义了一个 svn:external 以指向我的 /trunk/common 文件夹。

问题是当我在任何项目中查看日志时：/trunk/projectX/ 它没有显示来自 svn:externals 的更改。我使用乌龟 SVN 作为我的 SVN 客户端。

有谁知道如何改变这种行为？我希望 /trunk/projectX 的显示日志也包括对任何定义的 svn:externals 的任何更改。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-15T13:25:55.803

这在当前版本的 Subversion 中是不可能的，除了在外部目录的目标上显式调用 svn log

您可以尝试在[Apache Subversion 网站上发出功能请求](http://subversion.apache.org/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2013-01-24T09:58:33.123

根据我的个人经验，只有在您更改了外部文件的同一提交中，您也只修改了“内部”文件夹中的一个文件，才会报告外部链接的日志。这样 SVN 可以使用正确的日志检索，也可以从外部文件夹中检索日志。

我认为使用钩子应该可以实现一种机制，用于在每次提交的工作目录中自动提交一个点文件，如果提交从外部链接开始也是如此。

再见

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-15T13:58:09.750

当您显示本地版本化文件夹的日志时，它将显示与此特定文件夹相关的更改。外部只是指向存储库中不同文件夹**的链接。**您可以从依赖于该外部项目的文件夹中跟踪外部引用的唯一内容是**引用定义本身**。那是因为引用是依赖文件夹的颠覆属性。

想象一下，您有以下 repo 层次结构：

```
repo
   myfirstproject
      trunk
   mysecondproject
      trunk
   mycommonlib
      trunk 
```

并且该`mysecondproject\trunk`文件夹具有以下*svn:external*属性：

```
svn://mysrv/repo/mysharedlib@2451 sharedlib 
```

在新文件夹*secondproject*中检出*mysecondproject\trunk*将在您的文件系统上创建类似这样的内容：

 *```
secondproject Folder (refers mysecondproject/trunk)
   sharedlib Folder (refers mycommonlib/trunk @ revision #2451) 
```

*从secondproject*文件夹调用 Tortoise 的“显示日志”命令只会显示*secondproject*文件的更改，并最终显示文件夹的*svn:external*属性上发生的更改。

要获取外部项目的更改日志，您需要从内部文件夹*sharedlib*中调用“显示日志” ，这是有道理的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-01-24T11:20:19.167

我认为，在 Subversion 1.7 之后（在 WC 的根目录中引入了单个 .svn 文件夹）它更加干净：对于目录类型 externals 内部工作副本的外部目录是 a) 独立 b) 单独存储库的嵌套工作副本

```
>dir /B /S /AD
z:\subversion-troubleshoot-b\.svn
...
z:\subversion-troubleshoot-b\trunk
z:\subversion-troubleshoot-b\tags
z:\subversion-troubleshoot-b\trunk\lib
z:\subversion-troubleshoot-b\trunk\lib\.svn
...
z:\subversion-troubleshoot-b\tags\1.0.0
z:\subversion-troubleshoot-b\tags\1.0.1
z:\subversion-troubleshoot-b\tags\1.0.1\lib
z:\subversion-troubleshoot-b\tags\1.0.1\lib\.svn
... 
```

并且父 WC**不包含**有关嵌套 WC 的任何信息（WC 的目录，从存储库的 / 创建，请注意 .svn 目录存在两次仅用于主线）

```
>svn ls -R
readme.textile
tags/
tags/1.0.0/
tags/1.0.0/core_mod.txt
tags/1.0.1/
tags/1.0.1/core_mod.txt
trunk/
trunk/core_mod.txt 
```

当主干（和标签分别）具有子目录 lib 作为外部

![带有外部的回购浏览器](https://i.stack.imgur.com/xaImM.png)

支持处理添加到更新和提交的外部，因为这种支持会产生*独立且不相关的*连续命令 - 并且因为没有这种支持，外部就没有意义，聚合的 svn 日志必须以某种方式*组合*（通过未知的原则，顺便说一句）

# debugging - 在重负载下为 ASP.NET 应用程序提供服务时，IIS 崩溃。如何解决它？

> ID：62720
> 
> 赞同：3
> 
> 时间：2008-09-15T13:12:55.083
> 
> 标签：debugging, iis, crash

我正在开发一个 ASP.NET Web 应用程序，当我尝试在 Visual Studio 中调试它时，它似乎工作正常。但是，当我模拟重负载时，IIS 崩溃而没有任何痕迹——系统日志中的日志条目非常通用，“万维网发布服务意外终止。它已经完成了 4 次。” 如何从 IIS 获取更多信息来解决此问题？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-15T18:43:23.683

下载适用于 Windows 的调试工具：http: [//www.microsoft.com/whdc/DevTools/Debugging/default.mspx](http://www.microsoft.com/whdc/DevTools/Debugging/default.mspx)

Windows 调试工具有一个脚本 (ADPLUS)，允许您在进程崩溃时创建转储：http: [//support.microsoft.com/kb/286350](http://support.microsoft.com/kb/286350)

该命令应该类似于（如果您使用的是 IIS6）：

```
cscript adplus.vbs -crash -pn w3wp.exe 
```

此命令会将调试器附加到工作进程。当崩溃发生时，它将生成一个转储（一个 *.DMP 文件）。

您可以在 WinDBG 中打开它（也包含在 Windows 调试工具中）。文件 > 打开故障转储...

默认情况下，WinDBG 将显示（在命令行旁边）进程崩溃的线程。

在 WinDBG 中需要做的第一件事是加载 .NET Framework 扩展：

```
.loadby sos mscorwks 
```

然后，您将显示托管调用堆栈：

```
!clrstack 
```

如果线程没有运行托管代码，那么您需要检查本机堆栈：

```
kpn 200 
```

这应该会给你一些想法。要继续进行故障排除，我建议您阅读以下文章：

[http://msdn.microsoft.com/en-us/library/ms954594.aspx](http://msdn.microsoft.com/en-us/library/ms954594.aspx)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-15T13:14:38.247

[asp.net 进程](http://blogs.msdn.com/tess/archive/tags/ASP.NET/default.aspx)的崩溃转储应该为您提供[大量信息](http://blogs.msdn.com/tess/pages/net-debugging-demos-information-and-setup-instructions.aspx)..如果您想快速获取有关进程为何被回收的一些信息，请[尝试 Scott Gu 的此提示](http://weblogs.asp.net/scottgu/archive/2005/12/14/433194.aspx).. asp.net 2.0 的[健康监控](http://odetocode.com/Blogs/scott/archive/2005/11/01/2402.aspx)功能也值得一看在..

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-15T13:15:28.277

ASP.NET 跟踪... [http://www.beansoftware.com/ASP.NET-Tutorials/Tracing-ASP.NET.aspx](http://www.beansoftware.com/ASP.NET-Tutorials/Tracing-ASP.NET.aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-15T13:13:57.657

关键是*“不留痕迹”*。您需要输入自己的跟踪登录来创建一些聊天。然后，您将能够发现聊天停止的位置。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-09-19T05:45:25.493

试试这个[https://www.leansentry.com/](https://www.leansentry.com/) - 自动诊断服务器问题的轻量级应用程序监控！

# windows - 带渐变的折线

> ID：62742
> 
> 赞同：0
> 
> 时间：2008-09-15T13:14:41.243
> 
> 标签：windows, graphics, gdi+

有没有办法沿着弯曲路径绘制一条线，其梯度在垂直于线方向的方向上变化？我正在为我的图形使用 GDI+ 框架。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-15T14:15:14.403

简单回答是不。您可以创建一个 GraphicsPath 来描述您想要绘制的内容，根据需要使用 AddPoint/AddLine/AddBezier 等来描述您想要绘制的复杂路径。绘制路径时，您可以提供一个 Brush，它可以是 LinearGradientBrush 或 RadialGradientBrush。这些渐变画笔都不会对绘制的实际路径做出反应，因为绘制发生时会改变方向。您必须将角度等指定为整个渐变区域的常数。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-23T07:15:45.667

您可以使用的一种可能方法是将 Graphics 对象的剪辑区域设置为仅线的剪辑区域。然后在直线的两端画一个线性渐变，例如

```
GraphicsPath gp = new GraphicsPath();

gp.AddArc(); // etc...

graphics.SetClip( gp );

graphics.FillRectangle( myLinearGradientBrush, gp.GetBounds()); 
```

上面的代码可能会给你你正在寻找的东西。

# c# - 如何检查给定的字符串是否是 Windows 下的合法/有效文件名？

> ID：62771
> 
> 赞同：178
> 
> 时间：2008-09-15T13:17:29.927
> 
> 标签：c#, windows, file, filesystems

我想在我的应用程序中包含批处理文件重命名功能。用户可以键入目标文件名模式，并且（在替换模式中的一些通配符之后）我需要检查它是否会成为 Windows 下的合法文件名。我尝试使用正则表达式，`[a-zA-Z0-9_]+`但它不包括来自各种语言的许多特定于国家/地区的字符（例如变音符号等）。进行此类检查的最佳方法是什么？

* * *

## 回答 #1

> 赞同：136
> 
> 时间：2008-09-15T13:30:30.127

来自[MSDN 的“命名文件或目录”](http://msdn.microsoft.com/en-us/library/aa365247.aspx "命名文件或目录")，以下是 Windows 下合法文件名的一般约定：

您可以使用当前代码页中的任何字符（Unicode/ANSI 高于 127），除了：

*   `<` `>` `:` `"` `/` `\` `|` `?` `*`
*   整数表示为 0-31（小于 ASCII 空格）的字符
*   目标文件系统不允许的任何其他字符（例如，尾随句点或空格）
*   任何 DOS 名称：CON、PRN、AUX、NUL、COM0、COM1、COM2、COM3、COM4、COM5、COM6、COM7、COM8、COM9、LPT0、LPT1、LPT2、LPT3、LPT4、LPT5、LPT6、LPT7、 LPT8、LPT9（避免 AUX.txt 等）
*   文件名是所有句点

一些可选的检查：

*   文件路径（包括文件名）不得超过 260 个字符（不使用`\?\`前缀）
*   使用时超过 32,000 个字符的 Unicode 文件路径（包括文件名）`\?\`（注意前缀可能会扩展目录组件并导致其超出 32,000 限制）

* * *

## 回答 #2

> 赞同：102
> 
> 时间：2008-09-15T13:22:16.357

您可以从[`Path.GetInvalidPathChars`](http://msdn.microsoft.com/en-us/library/system.io.path.getinvalidpathchars.aspx)和获取无效字符列表[`GetInvalidFileNameChars`](http://msdn.microsoft.com/en-us/library/system.io.path.getinvalidfilenamechars.aspx)。

**UPD：**请参阅[Steve Cooper](https://stackoverflow.com/questions/62771/how-check-if-given-string-is-legal-allowed-file-name-under-windows#62855)关于如何在正则表达式中使用这些的建议。

**UPD2：**请注意，根据 MSDN 中的备注部分“不保证从此方法返回的数组包含在文件和目录名称中无效的完整字符集。” [Sixlettervalables 提供的答案](https://stackoverflow.com/questions/62771/how-check-if-given-string-is-legal-allowed-file-name-under-windows/62888#62888)更详细。

* * *

## 回答 #3

> 赞同：67
> 
> 时间：2008-09-15T13:26:54.270

对于**3.5 之前的 .Net 框架，**这应该可以工作：

正则表达式匹配应该可以帮助您。`System.IO.Path.InvalidPathChars`这是一个使用常量的片段；

```
bool IsValidFilename(string testName)
{
    Regex containsABadCharacter = new Regex("[" 
          + Regex.Escape(System.IO.Path.InvalidPathChars) + "]");
    if (containsABadCharacter.IsMatch(testName)) { return false; };

    // other checks for UNC, drive-path format, etc

    return true;
} 
```

对于**3.0 之后的 .Net 框架，**这应该可以工作：

[http://msdn.microsoft.com/en-us/library/system.io.path.getinvalidpathchars(v=vs.90).aspx](http://msdn.microsoft.com/en-us/library/system.io.path.getinvalidpathchars(v=vs.90).aspx)

正则表达式匹配应该可以帮助您。`System.IO.Path.GetInvalidPathChars()`这是一个使用常量的片段；

```
bool IsValidFilename(string testName)
{
    Regex containsABadCharacter = new Regex("["
          + Regex.Escape(new string(System.IO.Path.GetInvalidPathChars())) + "]");
    if (containsABadCharacter.IsMatch(testName)) { return false; };

    // other checks for UNC, drive-path format, etc

    return true;
} 
```

一旦你知道了，你还应该检查不同的格式，例如`c:\my\drive`和`\\server\share\dir\file.ext`

* * *

## 回答 #4

> 赞同：27
> 
> 时间：2008-09-15T14:00:49.150

尝试使用它，并捕获错误。允许的集合可能会在文件系统或不同版本的 Windows 之间发生变化。换句话说，如果你想知道 Windows 是否喜欢这个名字，就把名字交给它，让它告诉你。

* * *

## 回答 #5

> 赞同：23
> 
> 时间：2008-09-15T14:11:12.790

这就是我使用的：

```
 public static bool IsValidFileName(this string expression, bool platformIndependent)
    {
        string sPattern = @"^(?!^(PRN|AUX|CLOCK\$|NUL|CON|COM\d|LPT\d|\..*)(\..+)?$)[^\x00-\x1f\\?*:\"";|/]+$";
        if (platformIndependent)
        {
           sPattern = @"^(([a-zA-Z]:|\\)\\)?(((\.)|(\.\.)|([^\\/:\*\?""\|<>\. ](([^\\/:\*\?""\|<>\. ])|([^\\/:\*\?""\|<>]*[^\\/:\*\?""\|<>\. ]))?))\\)*[^\\/:\*\?""\|<>\. ](([^\\/:\*\?""\|<>\. ])|([^\\/:\*\?""\|<>]*[^\\/:\*\?""\|<>\. ]))?$";
        }
        return (Regex.IsMatch(expression, sPattern, RegexOptions.CultureInvariant));
    } 
```

第一个模式创建一个正则表达式，其中包含仅适用于 Windows 平台的无效/非法文件名和字符。第二个做同样的事情，但确保该名称对于任何平台都是合法的。

* * *

## 回答 #6

> 赞同：23
> 
> 时间：2010-08-06T16:16:57.097

此类清理文件名和路径；像使用它一样

```
var myCleanPath = PathSanitizer.SanitizeFilename(myBadPath, ' '); 
```

这是代码；

```
/// <summary>
/// Cleans paths of invalid characters.
/// </summary>
public static class PathSanitizer
{
    /// <summary>
    /// The set of invalid filename characters, kept sorted for fast binary search
    /// </summary>
    private readonly static char[] invalidFilenameChars;
    /// <summary>
    /// The set of invalid path characters, kept sorted for fast binary search
    /// </summary>
    private readonly static char[] invalidPathChars;

    static PathSanitizer()
    {
        // set up the two arrays -- sorted once for speed.
        invalidFilenameChars = System.IO.Path.GetInvalidFileNameChars();
        invalidPathChars = System.IO.Path.GetInvalidPathChars();
        Array.Sort(invalidFilenameChars);
        Array.Sort(invalidPathChars);

    }

    /// <summary>
    /// Cleans a filename of invalid characters
    /// </summary>
    /// <param name="input">the string to clean</param>
    /// <param name="errorChar">the character which replaces bad characters</param>
    /// <returns></returns>
    public static string SanitizeFilename(string input, char errorChar)
    {
        return Sanitize(input, invalidFilenameChars, errorChar);
    }

    /// <summary>
    /// Cleans a path of invalid characters
    /// </summary>
    /// <param name="input">the string to clean</param>
    /// <param name="errorChar">the character which replaces bad characters</param>
    /// <returns></returns>
    public static string SanitizePath(string input, char errorChar)
    {
        return Sanitize(input, invalidPathChars, errorChar);
    }

    /// <summary>
    /// Cleans a string of invalid characters.
    /// </summary>
    /// <param name="input"></param>
    /// <param name="invalidChars"></param>
    /// <param name="errorChar"></param>
    /// <returns></returns>
    private static string Sanitize(string input, char[] invalidChars, char errorChar)
    {
        // null always sanitizes to null
        if (input == null) { return null; }
        StringBuilder result = new StringBuilder();
        foreach (var characterToTest in input)
        {
            // we binary search for the character in the invalid set. This should be lightning fast.
            if (Array.BinarySearch(invalidChars, characterToTest) >= 0)
            {
                // we found the character in the array of 
                result.Append(errorChar);
            }
            else
            {
                // the character was not found in invalid, so it is valid.
                result.Append(characterToTest);
            }
        }

        // we're done.
        return result.ToString();
    }

} 
```

* * *

## 回答 #7

> 赞同：19
> 
> 时间：2008-09-19T13:11:27.837

要记住一个极端情况，当我第一次发现它时让我感到惊讶：Windows 允许在文件名中使用前导空格字符！例如，以下都是 Windows 上合法且不同的文件名（减去引号）：

```
"file.txt"
" file.txt"
"  file.txt" 
```

从中得出一个结论：在编写从文件名字符串中修剪前导/尾随空格的代码时要小心。

* * *

## 回答 #8

> 赞同：11
> 
> 时间：2017-03-03T22:24:47.043

简化 Eugene Katz 的答案：

```
bool IsFileNameCorrect(string fileName){
    return !fileName.Any(f=>Path.GetInvalidFileNameChars().Contains(f))
} 
```

或者

```
bool IsFileNameCorrect(string fileName){
    return fileName.All(f=>!Path.GetInvalidFileNameChars().Contains(f))
} 
```

* * *

## 回答 #9

> 赞同：8
> 
> 时间：2008-09-15T13:25:43.760

Microsoft Windows：Windows 内核禁止使用 1-31 范围内的字符（即 0x01-0x1F）和字符“ * : < > ? \ |。虽然 NTFS 允许每个路径组件（目录或文件名）长度为 255 个字符，并且路径最长约 32767 个字符，Windows 内核仅支持最长 259 个字符的路径。此外，Windows 禁止使用 MS-DOS 设备名称 AUX、CLOCK$、COM1、COM2、COM3、COM4、COM5、COM6、 COM7、COM8、COM9、CON、LPT1、LPT2、LPT3、LPT4、LPT5、LPT6、LPT7、LPT8、LPT9、NUL 和 PRN，以及这些带有任何扩展名的名称（例如，AUX.txt），使用时除外长 UNC 路径（例如 \.\C:\nul.txt 或 \?\D:\aux\con）。（事实上，如果提供了扩展名，则可以使用 CLOCK$。）这些限制仅适用于 Windows -例如，Linux 允许使用 " * : < > ? \ | 即使在 NTFS 中。

来源：[http ://en.wikipedia.org/wiki/Filename](http://en.wikipedia.org/wiki/Filename)

* * *

## 回答 #10

> 赞同：7
> 
> 时间：2008-09-15T13:19:44.867

您可以使用正则表达式检查是否存在非法字符，然后报告错误，而不是显式包含所有可能的字符。理想情况下，您的应用程序应该完全按照用户的意愿命名文件，并且只有在偶然发现错误时才会发出错误的声音。

* * *

## 回答 #11

> 赞同：6
> 
> 时间：2008-09-15T13:27:16.157

问题是您是否试图确定路径名是否是合法的 Windows 路径，或者在**运行代码的系统上是否合法。**? 我认为后者更重要，所以就个人而言，我可能会分解完整路径并尝试使用 _mkdir 创建文件所属的目录，然后尝试创建文件。

这样，您不仅知道路径是否仅包含有效的 windows 字符，而且它是否实际上表示可由该进程写入的路径。

* * *

## 回答 #12

> 赞同：6
> 
> 时间：2013-02-25T17:24:28.853

我用它来摆脱文件名中的无效字符而不抛出异常：

```
private static readonly Regex InvalidFileRegex = new Regex(
    string.Format("[{0}]", Regex.Escape(@"<>:""/\|?*")));

public static string SanitizeFileName(string fileName)
{
    return InvalidFileRegex.Replace(fileName, string.Empty);
} 
```

* * *

## 回答 #13

> 赞同：5
> 
> 时间：2008-09-15T13:24:18.503

此外，CON、PRN、AUX、NUL、COM# 和其他一些在任何具有任何扩展名的目录中都不是合法的文件名。

* * *

## 回答 #14

> 赞同：4
> 
> 时间：2008-09-15T13:20:54.630

从[MSDN](http://msdn.microsoft.com/en-us/library/aa365247.aspx)，这里有一个不允许的字符列表：

> 几乎可以使用当前代码页中的任何字符作为名称，包括 Unicode 字符和扩展字符集 (128–255) 中的字符，但以下字符除外：
> 
> *   不允许使用以下保留字符：< > : " / \ | ? *
> *   不允许使用整数表示在 0 到 31 范围内的字符。
> *   目标文件系统不允许的任何其他字符。

* * *

## 回答 #15

> 赞同：4
> 
> 时间：2012-01-19T18:52:57.013

为了补充其他答案，您可能需要考虑以下几个额外的边缘情况。

*   如果将工作簿保存在名称包含“[”或“]”字符的文件中，Excel 可能会出现问题。有关详细信息，请参阅[http://support.microsoft.com/kb/215205](http://support.microsoft.com/kb/215205)。

*   Sharepoint 有一系列额外的限制。有关详细信息，请参阅[http://support.microsoft.com/kb/905231](http://support.microsoft.com/kb/905231)。

* * *

## 回答 #16

> 赞同：3
> 
> 时间：2012-12-31T19:37:44.170

这是一个已经回答的问题，但只是为了“其他选项”，这是一个不理想的问题：

（不理想，因为使用异常作为流量控制通常是“坏事”）

```
public static bool IsLegalFilename(string name)
{
    try 
    {
        var fileInfo = new FileInfo(name);
        return true;
    }
    catch
    {
        return false;
    }
} 
```

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2008-09-15T17:12:40.530

对于这种情况，正则表达式是多余的。您可以将该`String.IndexOfAny()`方法与`Path.GetInvalidPathChars()`和结合使用`Path.GetInvalidFileNameChars()`。

另请注意，这两种`Path.GetInvalidXXX()`方法都克隆内部数组并返回克隆。因此，如果您要经常这样做（成千上万次），您可以缓存无效字符数组的副本以供重用。

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2010-08-23T20:19:23.540

目标文件系统也很重要。

在 NTFS 下，某些文件无法在特定目录中创建。EG $在根目录下启动

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2017-08-25T18:45:41.937

如果您只是想检查包含文件名/路径的字符串是否有任何无效字符，我发现的最快方法是`Split()`将文件名分解为一个包含无效字符的部分数组。如果结果只是一个 1 的数组，则没有无效字符。:-)

```
var nameToTest = "Best file name \"ever\".txt";
bool isInvalidName = nameToTest.Split(System.IO.Path.GetInvalidFileNameChars()).Length > 1;

var pathToTest = "C:\\My Folder <secrets>\\";
bool isInvalidPath = pathToTest.Split(System.IO.Path.GetInvalidPathChars()).Length > 1; 
```

我尝试在 LinqPad 中对文件/路径名运行此方法和上述其他方法 1,000,000 次。

使用`Split()`时间仅为~850ms。

使用`Regex("[" + Regex.Escape(new string(System.IO.Path.GetInvalidPathChars())) + "]")`时间约为 6 秒。

更复杂的正则表达式更糟糕，其他一些选项也是如此，比如使用`Path`类上的各种方法来获取文件名并让它们的内部验证完成工作（很可能是由于异常处理的开销）。

当然，您并不经常需要验证 100 万个文件名，因此对于大多数这些方法来说，一次迭代就可以了。但是，如果您只查找无效字符，它仍然非常高效和有效。

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2017-10-01T23:23:10.813

我从某人那里得到了这个想法。- 不知道是谁。让操作系统完成繁重的工作。

```
public bool IsPathFileNameGood(string fname)
{
    bool rc = Constants.Fail;
    try
    {
        this._stream = new StreamWriter(fname, true);
        rc = Constants.Pass;
    }
    catch (Exception ex)
    {
        MessageBox.Show(ex.Message, "Problem opening file");
        rc = Constants.Fail;
    }
    return rc;
} 
```

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2017-01-10T07:57:58.157

我建议只使用 Path.GetFullPath()

```
string tagetFileFullNameToBeChecked;
try
{
  Path.GetFullPath(tagetFileFullNameToBeChecked)
}
catch(AugumentException ex)
{
  // invalid chars found
} 
```

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2017-03-14T04:44:06.090

如果文件名太长并且在 Windows 10 之前的环境中运行，许多这些答案将不起作用。同样，考虑一下您想对句点做什么 - 允许前导或尾随在技术上是有效的，但如果您不希望文件分别难以查看或删除，则会产生问题。

这是我为检查有效文件名而创建的验证属性。

```
public class ValidFileNameAttribute : ValidationAttribute
{
    public ValidFileNameAttribute()
    {
        RequireExtension = true;
        ErrorMessage = "{0} is an Invalid Filename";
        MaxLength = 255; //superseeded in modern windows environments
    }
    public override bool IsValid(object value)
    {
        //http://stackoverflow.com/questions/422090/in-c-sharp-check-that-filename-is-possibly-valid-not-that-it-exists
        var fileName = (string)value;
        if (string.IsNullOrEmpty(fileName)) { return true;  }
        if (fileName.IndexOfAny(Path.GetInvalidFileNameChars()) > -1 ||
            (!AllowHidden && fileName[0] == '.') ||
            fileName[fileName.Length - 1]== '.' ||
            fileName.Length > MaxLength)
        {
            return false;
        }
        string extension = Path.GetExtension(fileName);
        return (!RequireExtension || extension != string.Empty)
            && (ExtensionList==null || ExtensionList.Contains(extension));
    }
    private const string _sepChar = ",";
    private IEnumerable<string> ExtensionList { get; set; }
    public bool AllowHidden { get; set; }
    public bool RequireExtension { get; set; }
    public int MaxLength { get; set; }
    public string AllowedExtensions {
        get { return string.Join(_sepChar, ExtensionList); } 
        set {
            if (string.IsNullOrEmpty(value))
            { ExtensionList = null; }
            else {
                ExtensionList = value.Split(new char[] { _sepChar[0] })
                    .Select(s => s[0] == '.' ? s : ('.' + s))
                    .ToList();
            }
    } }

    public override bool RequiresValidationContext => false;
} 
```

和测试

```
[TestMethod]
public void TestFilenameAttribute()
{
    var rxa = new ValidFileNameAttribute();
    Assert.IsFalse(rxa.IsValid("pptx."));
    Assert.IsFalse(rxa.IsValid("pp.tx."));
    Assert.IsFalse(rxa.IsValid("."));
    Assert.IsFalse(rxa.IsValid(".pp.tx"));
    Assert.IsFalse(rxa.IsValid(".pptx"));
    Assert.IsFalse(rxa.IsValid("pptx"));
    Assert.IsFalse(rxa.IsValid("a/abc.pptx"));
    Assert.IsFalse(rxa.IsValid("a\\abc.pptx"));
    Assert.IsFalse(rxa.IsValid("c:abc.pptx"));
    Assert.IsFalse(rxa.IsValid("c<abc.pptx"));
    Assert.IsTrue(rxa.IsValid("abc.pptx"));
    rxa = new ValidFileNameAttribute { AllowedExtensions = ".pptx" };
    Assert.IsFalse(rxa.IsValid("abc.docx"));
    Assert.IsTrue(rxa.IsValid("abc.pptx"));
} 
```

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2017-09-30T13:16:33.120

我的尝试：

```
using System.IO;

static class PathUtils
{
  public static string IsValidFullPath([NotNull] string fullPath)
  {
    if (string.IsNullOrWhiteSpace(fullPath))
      return "Path is null, empty or white space.";

    bool pathContainsInvalidChars = fullPath.IndexOfAny(Path.GetInvalidPathChars()) != -1;
    if (pathContainsInvalidChars)
      return "Path contains invalid characters.";

    string fileName = Path.GetFileName(fullPath);
    if (fileName == "")
      return "Path must contain a file name.";

    bool fileNameContainsInvalidChars = fileName.IndexOfAny(Path.GetInvalidFileNameChars()) != -1;
    if (fileNameContainsInvalidChars)
      return "File name contains invalid characters.";

    if (!Path.IsPathRooted(fullPath))
      return "The path must be absolute.";

    return "";
  }
} 
```

这并不完美，因为`Path.GetInvalidPathChars`不会返回在文件和目录名称中无效的完整字符集，当然还有很多微妙之处。

所以我用这个方法作为补充：

```
public static bool TestIfFileCanBeCreated([NotNull] string fullPath)
{
  if (string.IsNullOrWhiteSpace(fullPath))
    throw new ArgumentException("Value cannot be null or whitespace.", "fullPath");

  string directoryName = Path.GetDirectoryName(fullPath);
  if (directoryName != null) Directory.CreateDirectory(directoryName);
  try
  {
    using (new FileStream(fullPath, FileMode.CreateNew)) { }
    File.Delete(fullPath);
    return true;
  }
  catch (IOException)
  {
    return false;
  }
} 
```

如果出现异常，它会尝试创建文件并返回 false。当然，我需要创建文件，但我认为这是最安全的方法。另请注意，我不会删除已创建的目录。

也可以使用第一种方法进行基本验证，然后在使用路径时小心处理异常。

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2019-08-22T15:18:58.290

在我看来，这个问题的唯一正确答案是尝试使用路径并让操作系统和文件系统验证它。否则，您只是重新实现（并且可能很糟糕）操作系统和文件系统已经使用的所有验证规则，如果将来更改这些规则，您将不得不更改代码以匹配它们。

* * *

## 回答 #25

> 赞同：-1
> 
> 时间：2008-09-15T13:23:55.057

Windows 文件名非常不受限制，因此实际上它甚至可能不是*那么*大的问题。Windows 不允许的字符是：

```
\ / : * ? " < > | 
```

您可以轻松地编写一个表达式来检查这些字符是否存在。更好的解决方案是尝试根据用户的需要命名文件，并在文件名不正确时提醒他们。

* * *

## 回答 #26

> 赞同：-1
> 
> 时间：2018-03-15T13:41:46.707

这个检查

```
static bool IsValidFileName(string name)
{
    return
        !string.IsNullOrWhiteSpace(name) &&
        name.IndexOfAny(Path.GetInvalidFileNameChars()) < 0 &&
        !Path.GetFullPath(name).StartsWith(@"\\.\");
} 
```

过滤掉带有无效字符（`<>:"/\|?*`和 ASCII 0-31）的名称，以及保留的 DOS 设备（`CON`, `NUL`, `COMx`）。它允许前导空格和全点名称，与`Path.GetFullPath`. （在我的系统上成功创建带有前导空格的文件）。

* * *

使用 .NET Framework 4.7.1，在 Windows 7 上测试。

* * *

## 回答 #27

> 赞同：-1
> 
> 时间：2018-12-02T01:45:53.340

一种用于验证字符串中非法字符的衬垫：

```
public static bool IsValidFilename(string testName) => !Regex.IsMatch(testName, "[" + Regex.Escape(new string(System.IO.Path.InvalidPathChars)) + "]"); 
```

# c# - 如何在 c#/.net 中实现 Edit -> Copy 菜单

> ID：62776
> 
> 赞同：3
> 
> 时间：2008-09-15T13:18:22.077
> 
> 标签：c#, .net, winforms, user-interface

如何在用 C#/.NET 2.0 编写的 Windows 应用程序中实现复制菜单项？

我想让用户在控件中标记一些文本，然后从应用程序菜单栏中的编辑菜单中选择复制菜单项，然后在例如 Excel 中进行粘贴。

让我头晕目眩的是如何首先确定哪个子窗体处于活动状态，然后如何找到包含应复制到剪贴板的标记文本的控件。

请帮忙。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-15T14:36:59.983

在我和我的一位同事的一些重磅编程的帮助下，我想出了这个，请随意重构。

代码放在主窗体中。copyToolStripMenuItem_Click 方法处理编辑菜单中复制菜单项上的 Click 事件。

```
 /// <summary>
    /// Recursively traverse a tree of controls to find the control that has focus, if any
    /// </summary>
    /// <param name="c">The control to search, might be a control container</param>
    /// <returns>The control that either has focus or contains the control that has focus</returns>
    private Control FindFocus(Control c) 
    {
        foreach (Control k in c.Controls)
        {
            if (k.Focused)
            {
                return k;
            }
            else if (k.ContainsFocus)
            {
                return FindFocus(k);
            }
        }

        return null;
    }

    private void copyToolStripMenuItem_Click(object sender, EventArgs e)
    {
        Form f = this.ActiveMdiChild;

        // Find the control that has focus
        Control focusedControl = FindFocus(f.ActiveControl);

        // See if focusedControl is of a type that can select text/data
        if (focusedControl is TextBox)
        {
            TextBox tb = focusedControl as TextBox;
            Clipboard.SetDataObject(tb.SelectedText);
        }
        else if (focusedControl is DataGridView)
        {
            DataGridView dgv = focusedControl  as DataGridView;
            Clipboard.SetDataObject(dgv.GetClipboardContent());
        }
        else if (...more?...)
        {
        }
    } 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-15T13:45:59.123

要确定打开的窗口，您可以查询 Form.ActiveMDIChild 属性以获取对当前活动窗口的引用。从那里，您可以执行以下两项操作之一：

1）如果您创建自己的自定义表单类（例如 FormFoo），它具有新的公共成员函数 GetCopiedData()，然后从该类继承应用程序的所有子表单，您可以执行以下操作：

```
((FormFoo)this.ActiveMDIChild).GetCopiedData(); 
```

假设 GetCopiedData 函数将具有特定于表单的实现来检测应将哪些文本复制到剪贴板。

或者

2）您可以使用继承来检测处于活动状态的表单的类型，然后根据表单的类型做一些事情来获取复制的数据：

```
Form f = this.ActiveMDIChild;
if(f is FormGrid)
{
    ((FormGrid)f).GetGridCopiedData();
} else if(f is FormText) {
    ((FormText)f).GetTextCopiedData();
} 
```

等等

这应该让您开始查找活动窗口以及如何实现复制功能。如果您在复制 GridView 时需要更多帮助，最好发布另一个问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-15T13:33:41.150

为什么不扩展控件，所以控件本身提供了应该复制到剪贴板的数据。

查看[ApplicationCommands](http://msdn.microsoft.com/en-us/library/system.windows.input.applicationcommands.aspx)文档。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-07-30T15:38:30.303

如果窗体是选项卡式的并且目标控件是 DataGridView，则当右键单击 DataGridView 时，有时可以使用上述方法将窗体的 TabControl 作为活动控件返回。

我通过为我的 DataGridView 实现以下处理程序来解决这个问题：-

私人无效dataGridView_CellMouseDown（对象发送者，DataGridViewCellMouseEventArgs e）

{

```
 if (e.Button == MouseButtons.Right)
 {
      dataGridView.Focus();

      dataGridView.CurrentCell = dataGridView[e.ColumnIndex, e.RowIndex];
 } 
```

}

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-09-15T13:24:37.660

在我看来，您最好将其分解为较小的任务/问题。从听起来的方式来看，您遇到了一些问题。

您打开了多个“子”窗口。这是一个 MDI 应用程序吗？当在这些子窗口之一上执行操作时，它应该在该窗口的事件处理程序中触发一个事件。这是您要设置的第一件事。如果这是一个 datagridview，我建议开始一个简单的测试。尝试捕获[DataGridView.SelectionChanged](http://msdn.microsoft.com/en-us/library/system.windows.forms.datagridview.selectionchanged.aspx)事件。现在就扔一些东西`MessageBox.Show("I copied your datas!");`。

这应该让您开始，您至少会了解如何向您提出此事件。

从这里开始，我们将需要更多地了解您的数据网格，以及这些行中的行和子控件。然后我们可能会在渲染事件中创建事件，这些事件将在适当的时间以适当的范围引发。

# javascript - Should you design websites that require JavaScript in this day & age?

> ID：62784
> 
> 赞同：15
> 
> 时间：2008-09-15T13:19:32.870
> 
> 标签：javascript

It's fall of 2008, and I still hear developers say that you should not design a site that requires JavaScript.

I understand that you should develop sites that degrade gracefully when JS is not present/on. But at what point do you not include funcitonality that can only be powered by JS?

I guess the question comes down to demographics. Are there numbers out there of how many folks are browsing without JS?

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2008-09-15T13:24:04.980

Just as long as you're aware of the accessibility limitations you might be introducing, ie for users of screen-reading software, etc.

It's one thing to exclude people because they choose to turn off JS or use a browser which doesn't support it, it's entirely another to exclude them because of a disability.

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-15T13:23:19.413

Two simple questions to help you decide...

1.  Does using javascript provide some core functionality of your site?
2.  Are you prepared to limit your potential users to those who have JS? (ie. Most people)

If you answer yes to both of those, go for it!

Websites are moving (have moved?) from static pages of information to interactive web applications. Without something like Javascript or Flash, making compelling user interactions is sometimes not possible.

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-15T13:24:54.510

Designing to degrade gracefully is the most that should be done. We are moving/have moved past the point of simple web "sites" to web "applications". The only option besides client side scripting to add round trips to the server.

I think (personal opinion) that the "don't use JavaScript" comes more from a lack of understanding of what JavaScript is/does than any actual market data that shows a significant number of people are browsing without it.

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-15T13:27:14.520

It's reasonable to design sites that use JavaScript but it is not safe to assume that all clients have support for Javascript and therefore it is important that you provide a satisfactory experience even when JavaScript is not available

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-15T14:21:40.863

Search Engines don't support JavaScript. They're also blind and don't support CSS. So my suggestion to you is to make sure that the part of your product that needs to be indexable by search engines works without JavaScript and CSS. After that, it really depends on the needs of your users.

If you have a very limited subset of users, then you can actually query them. But to remember that 10% of the population has some form of impairment ranging from vision issues (low vision, color-blindness, etc.) or motor functions (low hand dexterity). These problems tend to be more prominent in the elderly and the knowingly disabled

If your site will target the general audience of Internet users then please make it degrade gracefully, but if you can't do that, then make a no-JavaScript version (like G-mail has).

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-15T13:24:43.543

I think the days of "content sites only" are gone. What we see now is WWW emerging as the platform of web applications, and the latest developments in the browser front (speeding up JS in particular) ar indication of this. There can be no yes/no answer to your question - you should decide, where on content site<---->web application continuum your site is and how essential is the experience provided by JavaScript. In my opinion - yes it is acceptable to have web applications which require Javascript to function.

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-15T13:31:16.383

Degrading gracefully is a must. At a minimum, you sure make use of the NOSCRIPT tag in order to inform potential *customers* first that your site requires javascript, and secondly why you require it.

If it's for flashy menus and presentations that I could honestly care less about then I probably won't bother coming back. If there's a real reason that you're requiring javascript (client-side validation on forms, or a real situation that requires AJAX for performance reasons) then say so and your visitors will respond accordingly.

I install extensions that limit both Javascript and Cookies. Websites that don't prominently state their requirements of both usually don't get a second visit unless there's a real need for it.

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-09-15T13:40:09.060

You should never design a public site to rely on ANY technology/platform. The user agent may not display colour (think screen readers), display graphics (again, think screen readers or text only browsers such as links), etc.

Design your site for the lowest common denominator and then progressively enhance it to add support for specific technologies.

To answer the question directly: No, you cannot assume your users have Javascript, so your site should work without it. Once it does, enhance it with Javascript.

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-09-15T13:46:58.373

it's not about browser capability, it's about user control. People who install the noscript plugin for firefox so they don't have to put up with punch-the-monkey garbage ( the same problem that inspired stack overflow) will not allow your web site to do anything non-static until they trust you.

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-09-15T13:50:10.940

In terms of client software consider users/customers who are using a browser that supports some but not all Javascript. For example, most mobile phone browsers support a bit of Javascript but nothing very complicated. The browsers on devices such as the Playstation 3 are similar.

Then there are browsers such as [Opera Mini](http://dev.opera.com/articles/view/javascript-support-in-opera-mini-4/ "Javascript support in Opera Mini 4"), which support a lot of Javascript but are operating in an environment where the scripts are running on a server that then sends the results to a mobile device.

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-09-15T14:00:28.043

You should design websites with Javascript in mind--but not implemented. Consider, build it where every click, every action, performs a round trip to the server. That's the default functionality for older browsers, and those without JS turned on.

Then, after it's all built, and everything is working properly, add in JavaScript which hijacks the link, button and other events, and overlay their standard functionality with the Javascript functionality you're wanting.

Building the application like this means that it will ALWAYS work, which ultimately is what you're wanting.

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2008-09-15T14:05:25.987

The received wisdom answer is that you can use JavaScript (or any other technology) providing that it 'degrades gracefully'...

I have experience with disability organisations, so accessibility is important to me. But equally, I'm in the business of building attractive, usable websites, so javascript can be a powerful ally. It's a difficult call, but if you can build a rich, javascript-aided site, without completely alienating non-js vistors, then do so. If not, you will have to look at the context of the site and decide which way to jump.

Regardless, there are no rights and wrongs with this question. However, in some countries, there is a requirement to build 'public' sites to be accessible, so this may be yet another factor in your decision. [In the UK, it is the Disability Discrimination Act.. though to my knowledge, no company has been prosecuted for failure to comply]

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2008-09-15T15:30:28.763

JavaScript is great for extending the browser to do things like google maps. But it's a pointy instrument, so use it with care.

My bank web site uses JavaScript for basic navigation between pages. **Sigh**. As a result, it's not usable from my mobile device.

Make sure you're familiar with the [Rule of Least Power](http://www.w3.org/2001/tag/doc/leastPower.html) when considering JavaScript:

> When designing computer systems, one is often faced with a choice between using a more or less powerful language for publishing information, for expressing constraints, or for solving some problem. This finding explores tradeoffs relating the choice of language to reusability of information. The "Rule of Least Power" suggests choosing the least powerful language suitable for a given purpose.

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-09-15T13:22:33.127

As you said, demographics. The web is expanding onto devices that doesn't have very much power, for instance cellphones. If your site is usable without javascript, Opera Mini will likely show your site without any problems.

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2008-09-15T13:23:38.240

I think Javascript implementations in most modern browsers have now reached a reasonable level of maturity and there are a bunch of Javascript UI frameworks which let you build very attractive Javascript based web applications using web-services and such (regardless of the back-end server platform).

An example is [ExtJS](http://www.extjs.com) - they have got a very extensive AJAX + UI widget framework which I recently used to build a full fledged internal web-app for a client with an ASP.NET backend (for webservices).

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2008-09-15T13:23:44.950

5% according to these statistics: [http://www.w3schools.com/browsers/browsers_stats.asp](http://www.w3schools.com/browsers/browsers_stats.asp)

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2008-09-15T13:26:58.607

I think it comes down to what you're about to do. Are you writing a web APPLICATION? Then I think you're bound to use javascript and/or something like [GWT](http://code.google.com/webtoolkit/). Just have a look at all the social sites, and google aplications like gmail. If you're writing a webpage with product descriptions and hardly any interactivity, then you can make the javascript optional.

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2008-09-15T13:57:33.667

I agree with the majority of the stackoverflow respondents. JavaScript has matured and offers an "extra" level of functionality to a webpage, especially for forms. Those who turn off cookies and JS have likely been bitten while surfing in dangerous waters. For the corporate power users that pay my way either in B2B or retail sites, JS is a proven and trusty tool. Until something better comes along (and it will) I'm sticking with JS.

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2008-09-15T14:11:29.857

There's addon for Firefox called [NoScript](https://addons.mozilla.org/en-US/firefox/addon/722) which have 27,501,701 downloads. If you site won't work without JavaScript most of those guys wouldn't want to use it.

Why you would install that addon? Ever wanted to get rid of the popup on the site that cover the most of the useful text you want to rid? Or disable flash animation? Or be sure that evil site won't steal your cookies?

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2008-09-15T14:50:30.293

Some corporate environments won't allow Javascript, by policy or by firewall. It closes the door to one avenue of virus infection.

Whether you think this is a good idea or not, realize that not everyone has full control over their browser and it might not be their choice.

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2008-09-15T15:10:10.730

There is a gradient between web sites and web applications. However, you should alway be able to say "we are building a web site" or "we are building a web application".

Web sites should be readable down to plain HTML (no CSS, no images, no JavaScript).

Web applications, of course, could just say "Sorry, JavaScript is needed" (which also assumes CSS for layout). Application should still be able to work without images.

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2008-09-15T15:23:27.250

The accessibility issue is the only important technical issue, all other issues can be socially engineered. When one says that javascript reduced accessibility and another says that Web Applications can use javascript, can we take these two together to imply that all blind people are unemployed? There has to be some kind of momentum in making javascript accessible. Maybe a Screenreader object on the javascript side which can detect the presence of a screenreader and then maybe send hints to the screenreader, Screenreaders which can hook onto the browser, and maybe it gets glued together with a screenreader toolbar.

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2008-09-15T18:52:27.920

if you want your site viewable by the top 100 companies in the US. I would write without javascript.

* * *

## 回答 #24

> 赞同：1
> 
> 时间：2008-09-15T18:53:18.323

Independence from Javascript and graceful degradation are important to an application despite the actual demographics -- because such an application probably has better software design.

The "human user without Javascript" may be purely hypothetical (for example, if you're trying to make money with your product). But designing for that hypothetical user encourages modular software design which will pay off as you continue to develop your app.

Javascript provides functionality. HTML provides data (on the page itself, and via links that point to more data). As a general rule that reaches well beyond browser apps: A well-designed software product will separate data from functionality. All data should be available, and the functionality should be a separate layer that consumes the data.

If your Javascript is creating data at runtime, then it's time to get specific and figure out whether your webpage really is a piece of software (e.g. a mortgage calculator) or whether it's a document containing data (e.g. a list of mortgage interest rates). This should tell you whether it makes sense to rely on Javascript.

As a final note/example, demographics can be misleading. Relatively few humans browse your site without Javascript, but lots of **machines** (search bots, data miners, screen readers for the disabled, etc.) are browsing your site without Javascript. Again, the distinction between data and functionality are important -- the bots are just making requests and looking for data in the responses. They don't need functionality. But if your user needs to invoke functions just to make your data accessible, the bots are getting no value from your site.

* * *

One side point about the screen readers and other accessibility considerations for the disabled. This is an important niche demographic: a mind that navigates data in a human way, but who can only get data from your site in the same way machines get it. By providing data cleanly and semantically on your page, you make it available to the largest possible set of accessibility tools.

*Note this doesn't exclude Javascript from consideration.* Our mortgage calculator example can still work: accept input from the user, invoke Javascript, and write the output back into the clean semantic data layer of the page. Screen readers can then read it! And if they can't, you're encouraging the development of better screen readers that can.

* * *

## 回答 #25

> 赞同：1
> 
> 时间：2008-09-16T00:14:09.130

Well, it depends on your userbase. If you know that people will be using your site from mobile devices, it's good to have unobtrusive JavaScript. However, if you're trying to appeal to a tech-savvy crowd, don't bother with it.

However, if you're appealing to a crowd that may be using screen readers (blind people), I'd highly suggest using [WAI-ARIA](http://en.wikipedia.org/wiki/WAI-ARIA) standards. Dojo's widget system has full support for this, and would be a great and easy way to do it.

Anyway, in most cases, you don't need unobtrusive JavaScript. Most people who have JavaScript disabled are either using a smartphone, using Lynx, or have NoScript installed. It's enabled by default in all the major browsers, so you shouldn't have to worry.

Lastly, it's good to at least have some unobtrusive JavaScript. `<noscript>` tags are your best friend. For example, one may want to replace a widget that draws rating stars with text. Example using dojo:

```
<div dojoType="dojox.Rating" stars="5" value="4"></div>
<noscript>4/5</noscript> 
```

* * *

## 回答 #26

> 赞同：1
> 
> 时间：2008-09-16T01:05:20.020

If you expect your app to work for everyone, you'll need a backup for all your javascript functionality. If it's form validation, you should also check the data on the server before saving it. So the answer is Yes, it's okay, but have a backup. Do not rely on it.

* * *

## 回答 #27

> 赞同：1
> 
> 时间：2009-02-22T13:51:22.303

As many people are saying, it's important to consider your user base, but whoever your users are there's a strong possibility that some (stats say 10%) of them will have some sort of disabilities, and screen readers don't like javascript. If you're only adding simple things, a javascript menu or something, then just make it degrade (or don't do it). If the site depends on javascript to work properly, make two versions, one for javascript and one without.

I generally find that anything too javascript heavy is very difficult to make degrade well without just having javascript re-writing the page to a javascript version if the user can take it. Given this, it's well worth writing two pages from square one for complicated stuff.

I would say that there are very very very few web sites that should be running without some support for users without javascript. You'd need to have a very dynamic application that completely didn't make sense as static pages,or you'd need to have a audience you could guarantee were ok with it (like on an office Intranet say).

* * *

## 回答 #28

> 赞同：-1
> 
> 时间：2008-09-15T13:23:51.517

It's the 21st century. People not permitting JavaScript need to exit the last millennium, posthaste. It's a mature, widely used, and very useful technology that is one of the foundations of the recent expansion in useful web services.

* * *

## 回答 #29

> 赞同：-1
> 
> 时间：2008-09-15T13:27:04.817

You should be tying the functionality of your website to your audience. That being said, every modern browser (save for the mobile platform) includes javascript, and so unless your audience includes luddites with decade old computers, you can assume they *have* javascript.

The people you need to worry about, then, are those that specifically turn it off. This includes:

*   Corporate networks with tough security (not common, but some financial and defense institutions)
*   Paranoid web-heads

So, first, who is your audience? Are there other websites that are comparable to your target? Look at their site and success - do they degrade gracefully, and would yo be satisfied with their level of success?

If you are targeting mobile applications, though, you can't guarantee javascript.

-Adam

* * *

## 回答 #30

> 赞同：-1
> 
> 时间：2008-09-15T13:27:54.097

I would say that you should look at your target audience. If you can reasonably expect that they will have js enabled, and making everything work without any js is too much of a pain, then by all means - go ahead and ignore the non-js crowd, if, on the other hand you have to create a site that will be used by a very large audience/or you are perhaps building a government web site, then you must make sure that everything works, and it is easier in those cases to first build the site so that it works without any js, and add all the nice time-saving ajaxy bits later.

In general though, almost everyone has js enabled by default.

Though you should be aware that server-side validation of user posted data is a must in either case.

# c# - 应用面向方面的编程

> ID：62798
> 
> 赞同：13
> 
> 时间：2008-09-15T13:21:13.630
> 
> 标签：c#, castle-windsor, aop, castle-dynamicproxy

我一直在使用一些基本的 AOP 风格的解决方案来解决安全、日志记录、验证等横切问题。我的解决方案围绕着[Castle Windsor](http://www.castleproject.org/container/index.html)和 DynamicProxy，因为我可以使用基于 Boo 的 DSL 应用所有内容并保持我的代码没有属性. 周末有人告诉我看一下[PostSharp](http://www.postsharp.org/)，因为它应该是一个“更好”的解决方案。我已经快速浏览了 PostSharp，但我被 Attribute 的使用吓到了。

有没有人尝试过这两种解决方案并愿意分享他们的经验？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-09-18T16:18:29.357

PostSharp的几个小问题......

我在使用 PostSharp 时遇到的一个问题是，在使用 asp.net 时，异常消息的行号被 PostSharp 注入程序集的 IL 指令的数量“输出”了，因为 PDB 也没有注入 :-)。

此外，如果没有运行时可用的 PostSharp 程序集，则会发生运行时错误。使用 Windsor，可以在以后关闭横切，而无需重新编译代码。

（希望这是有道理的）

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-09-15T13:34:31.337

我只看了一小段时间（还）温莎城堡，所以我不能对此发表评论，但我确实使用了 postsharp。

Postsharp 通过在编译时编织来工作。它会在您的构建中添加一个后编译步骤，用于修改您的代码。代码的编译就像您刚刚将横切关注点编程到您的代码中一样。这比运行时编织性能要好一些，并且由于使用属性 Postsharp 非常易于使用。我认为将属性用于 AOP 并不像将其用于 DI 那样有问题。但这只是我个人的口味。

但...

如果您已经将城堡用于依赖注入，我看不出您不应该将其用于 AOP 的充分理由。我认为虽然 AOP 在运行时比在编译时慢一点，但它也更强大。在我看来，AOP 和 DI 是相关的概念，所以我认为对两者使用一个框架是个好主意。所以我可能会在下一个我需要 AOP 的项目中再次查看城堡的东西。

# .net - 如何在 VB.Net 中将 ISO 8601 持续时间转换为时间跨度？

> ID：62804
> 
> 赞同：16
> 
> 时间：2008-09-15T13:22:13.300
> 
> 标签：.net, xml, timespan

是否有标准库方法将具有标准 ISO 8601 Duration （也用于其`duration`类型的 XSD）格式的持续时间的字符串转换为 .NET TimeSpan 对象？

例如，代表一小时持续时间的 P0DT1H0M0S 转换为 New TimeSpan(0,1,0,0,0)。

确实存在一个反向转换器，其工​​作方式如下： Xml.XmlConvert.ToString(New TimeSpan(0,1,0,0,0)) 上面的表达式将返回 P0DT1H0M0S。

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2008-09-15T14:09:38.677

这将从 xs:duration 转换为 TimeSpan：

```
System.Xml.XmlConvert.ToTimeSpan("P0DT1H0M0S") 
```

请参阅[http://msdn.microsoft.com/en-us/library/system.xml.xmlconvert.totimespan.aspx](http://msdn.microsoft.com/en-us/library/system.xml.xmlconvert.totimespan.aspx)

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2011-04-22T22:57:53.937

一个小小的警告 - XmlConvert.ToTimeSpan() 在处理数月和数年时有点有趣。TimeSpan 类没有月份或年份成员，可能是因为它们的长度不同。但是，ToTimeSpan() 将愉快地接受一个包含月份或年份值的持续时间字符串并***猜测***持续时间，而不是抛出异常。观察：

```
PS C:\Users\troll> [Reflection.Assembly]::LoadWithPartialName("System.Xml")

GAC    Version        Location
---    -------        --------
True   v2.0.50727     C:\Windows\assembly\GAC_MSIL\System.Xml\2.0.0.0__b77a5c561934e089\System.Xml.dll

PS C:\Users\troll> [System.Xml.XmlConvert]::ToTimeSpan("P1M")

Days              : 30
Hours             : 0
Minutes           : 0
Seconds           : 0
Milliseconds      : 0
Ticks             : 25920000000000
TotalDays         : 30
TotalHours        : 720
TotalMinutes      : 43200
TotalSeconds      : 2592000
TotalMilliseconds : 2592000000

PS C:\Users\troll> [System.Xml.XmlConvert]::ToTimeSpan("P1Y")

Days              : 365
Hours             : 0
Minutes           : 0
Seconds           : 0
Milliseconds      : 0
Ticks             : 315360000000000
TotalDays         : 365
TotalHours        : 8760
TotalMinutes      : 525600
TotalSeconds      : 31536000
TotalMilliseconds : 31536000000

PS C:\Users\troll> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-08-12T15:52:53.813

正如@imadirty troll 所说，TimeSpan 总是将年翻译为 365 天，将月翻译为 30 天。

```
TimeSpan ts = System.Xml.XmlConvert.ToTimeSpan("P5Y");
DateTime now = new DateTime(2008,2,29);
Console.WriteLine(now + ts); // 27/02/2013 0:00:00 
```

要解决这个问题，您应该单独添加每个字段，而不是使用 TimeSpan。

```
DateTime now = new DateTime (2008, 2, 29);
string duration = "P1Y";
Regex expr = 
    new Regex (@"(-?)P((\d{1,4})Y)?((\d{1,4})M)?((\d{1,4})D)?(T((\d{1,4})H)?((\d{1,4})M)?((\d{1,4}(\.\d{1,3})?)S)?)?", RegexOptions.Compiled | RegexOptions.CultureInvariant);
bool positiveDuration = false == (input [0] == '-');

MatchCollection matches = expr.Matches (duration);
var g = matches [0];
Func<int,int> getNumber = x => {
    if (g.Groups.Count < x || string.IsNullOrEmpty (g.Groups [x].ToString ())) {
        return 0;
    }

    int a = int.Parse (g.Groups [x].ToString ());

    return PositiveDuration ? a : a * -1;

};
now.AddYears (getNumber (3));
now.AddMonths (getNumber (5));
now.AddDays (getNumber (7));
now.AddHours (getNumber (10));
now.AddMinutes (getNumber (12));
now.AddSeconds (getNumber (14));
Console.WriteLine (now); // 28/02/2012 0:00:00 
```

# c++ - 异常未通过 RCF 正确传递（使用 Boost.Serialization）

> ID：62810
> 
> 赞同：2
> 
> 时间：2008-09-15T13:22:54.827
> 
> 标签：c++, boost-serialization, rcf

我使用带有 boost.serialization 的 RCF（当我们已经使用原始版本时，为什么还要使用 RCF 的副本？）它工作正常，但是当服务器中抛出异常时，它没有正确传递给客户端。相反，我得到一个 RCF::SerializationException 引用`archive_exception`“类名太长”的说法。当我将协议更改为 BsText 时，例外是“未注册的类”。当我将协议更改为 SfBinary 时，它可以工作。我已经在服务器和客户端上注册了 RemoteException，如下所示：

```
BOOST_CLASS_VERSION(RCF::RemoteException, 0)
BOOST_CLASS_EXPORT(RCF::RemoteException) 
```

我什至尝试`boost::shared_ptr<RCF::RemoteException>`在同一个测试中对 a 进行序列化和反序列化，并且它有效。

那么如何在不求助于 SF 的情况下正确地使 RCF 传递异常呢？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-25T10:41:52.233

这是 Jarl 在[CodeProject](http://www.codeproject.com/KB/threads/Rcf_Ipc_For_Cpp.aspx?msg=2739150#xx2730536xx)提供的补丁：

在 RcfServer.cpp 中，在定义 RcfServer::handleSession() 的行之前（大约 792 行），插入以下代码：

```
void serialize(SerializationProtocolOut & out, const RemoteException & e)
{
      serialize(out, std::auto_ptr<RemoteException>(new RemoteException(e)));
} 
```

在 Marshal.cpp 的第 37 行附近，替换这一行：

```
ar & boost::serialization::make_nvp("Dummy", apt.get()); 
```

， 和

```
T *pt = apt.get();
ar & boost::serialization::make_nvp("Dummy", pt); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-17T17:29:55.310

根据 Jarl 它的工作原理，检查[codeproject](http://www.codeproject.com/KB/threads/Rcf_Ipc_For_Cpp.aspx?fid=248794&df=90&mpp=25&noise=3&sort=Position&view=Quick&fr=101&select=2365783)的问题并使用示例代码回答：

# operating-system - 二进制信号量和互斥量之间的区别

> ID：62814
> 
> 赞同：927
> 
> 时间：2008-09-15T13:23:05.887
> 
> 标签：operating-system, mutex, semaphore, binary-semaphore

二进制信号量和互斥量之间有什么区别还是它们本质上是一样的？

* * *

## 回答 #1

> 赞同：761
> 
> 时间：2008-09-17T18:13:03.037

它们**不是**一回事。它们用于不同的目的！
虽然两种类型的信号量都具有完整/空状态并使用相同的 API，但它们的用法却大不相同。

**互斥信号量**
互斥信号量用于保护共享资源（数据结构、文件等）。

Mutex 信号量由接受它的任务“拥有”。如果任务 B 尝试 semGive 任​​务 A 当前持有的互斥锁，任务 B 的调用将返回错误并失败。

互斥锁总是使用以下顺序：

```
  - SemTake
  - 关键部分
  -SemGive
```

这是一个简单的例子：

```
  线程 A 线程 B
   采取互斥体
     访问数据
     ... 取 Mutex <== 会阻塞
     ...
   授予 Mutex 访问数据 <== 解除阻塞
                                  ...
                                给互斥体

```

**二进制信号量**
二进制信号量解决了一个完全不同的问题：

*   任务 B 等待某事发生（例如，传感器被触发）。
*   传感器跳闸和中断服务程序运行。它需要通知任务的行程。
*   任务 B 应运行并为传感器跳闸采取适当的措施。然后回去等待。

```
 Task A                      Task B
   ...                         Take BinSemaphore   <== wait for something
   Do Something Noteworthy
   Give BinSemaphore           do something    <== unblocks 
```

请注意，对于二进制信号量，B 获取信号量并 A 提供它是可以的。
同样，二进制信号量并不能保护资源不被访问。给予和接受信号量的行为从根本上是分离的。
对于相同的任务来说，对相同的二进制信号量进行给予和接受通常没有什么意义。

* * *

## 回答 #2

> 赞同：497
> 
> 时间：2008-09-15T13:29:48.367

*   **互斥锁**只能由**获得它的线程**释放。

*   **二进制信号量**可以由任何**线程**（或进程）发出信号。

所以信号量更适合一些同步问题，比如生产者-消费者。

在 Windows 上，二进制信号量更像是事件对象而不是互斥体。

* * *

## 回答 #3

> 赞同：470
> 
> 时间：2008-12-06T19:53:46.067

[厕所的例子](http://koti.mbnet.fi/niclasw/MutexSemaphore.html)是一个有趣的类比：

> 互斥体：
> 
> 是厕所的钥匙。一个人可以拥有钥匙——占用厕所——当时。完成后，该人将钥匙交给（释放）队列中的下一个人。
> 
> 官方：“互斥锁通常用于序列化对不能由多个线程同时执行的可重入代码部分的访问。互斥锁对象只允许一个线程进入受控部分，从而迫使其他线程尝试访问该部分等待直到第一个线程从该部分退出。” 参考：Symbian 开发者库
> 
> （互斥锁实际上是一个值为 1 的信号量。）
> 
> 信号：
> 
> 是免费相同的厕所钥匙的数量。例如，假设我们有四个带有相同锁和钥匙的厕所。信号量计数 - 键的计数 - 一开始设置为 4（所有四个厕所都是免费的），然后随着人们进来，计数值递减。如果所有厕所都满了，即。没有剩余的空闲键，信号量计数为 0。现在，当 eq. 一个人离开厕所，信号量增加到 1（一个空闲键），并提供给队列中的下一个人。
> 
> 正式地：“信号量将共享资源的同时用户数限制为最大数量。线程可以请求访问资源（减少信号量），并且可以发出信号表明它们已经完成了对资源的使用（增加信号量）。 " 参考：Symbian 开发者库

* * *

## 回答 #4

> 赞同：168
> 
> 时间：2009-10-09T05:22:20.777

关于这个主题的好文章：

*   [互斥量VS。信号量 - 第 1 部分：信号量](https://blog.feabhas.com/2009/09/mutex-vs-semaphores-%E2%80%93-part-1-semaphores/)
*   [互斥量VS。信号量 – 第 2 部分：互斥体](https://blog.feabhas.com/2009/09/mutex-vs-semaphores-%E2%80%93-part-2-the-mutex/)
*   [互斥量VS。信号量 – 第 3 部分（最后部分）：互斥问题](https://blog.feabhas.com/2009/10/mutex-vs-semaphores-%E2%80%93-part-3-final-part-mutual-exclusion-problems/)

**从第 2 部分开始：**

> 互斥锁类似于二进制信号量的原理，但有一个显着区别：所有权原理。所有权是一个简单的概念，当任务锁定（获取）互斥体时，只有它可以解锁（释放）它。如果一个任务试图解锁一个尚未锁定（因此不拥有）的互斥锁，则会遇到错误情况，最重要的是，该互斥锁未解锁。如果互斥对象没有所有权，那么与它的名称无关，它不是互斥体。

* * *

## 回答 #5

> 赞同：112
> 
> 时间：2013-11-21T05:33:17.240

由于上述答案都没有消除混乱，因此这里有一个消除了我的困惑。

> 严格来说，互斥锁是一种用于同步对资源的访问**的锁定机制。**只有一个任务（可以是基于操作系统抽象的线程或进程）可以获得互斥锁。这意味着将有与互斥锁关联的所有权，并且只有所有者才能释放锁（互斥锁）。
> 
> **信号量是信号机制**（“我完成了，你可以继续”的信号）。例如，如果您正在手机上听歌（假设它是一项任务），同时您的朋友打电话给您，则会触发中断，中断服务例程 (ISR) 将向呼叫处理任务发出唤醒信号.

资料来源：[http ://www.geeksforgeeks.org/mutex-vs-semaphore/](http://www.geeksforgeeks.org/mutex-vs-semaphore/)

* * *

## 回答 #6

> 赞同：49
> 
> 时间：2008-09-24T18:23:04.007

它们的同步语义非常不同：

*   互斥体允许对给定资源的访问序列化，即多个线程一次等待一个锁，如前所述，线程*拥有*锁直到它完成：**只有**这个特定的线程可以解锁它。
*   二进制信号量是一个值为 0 和 1 的计数器：一个任务在其上阻塞，直到**任何**任务执行 sem_post。信号量通告资源可用，并且它提供了等待直到它被通知为可用的机制。

因此，可以将互斥锁视为从任务传递到任务的令牌，将信号量视为交通红灯（它向某人**发出信号，表明它可以继续进行）。**

* * *

## 回答 #7

> 赞同：29
> 
> 时间：2008-11-22T18:58:39.897

在理论上，它们在语义上没有什么不同。您可以使用信号量实现互斥锁，反之亦然（参见[此处](http://www.picturel.com/ucr/node32.html)的示例）。在实践中，实现是不同的，它们提供的服务略有不同。

实际的区别（就围绕它们的系统服务而言）是互斥锁的实现旨在成为一种更轻量级的同步机制。在 oracle-speak 中，互斥锁称为[锁存器](http://dbataj.blogspot.com/2007/10/oracle-latch.html)，信号量称为[等待](http://www.dba-oracle.com/art_dbazine_waits.htm)。

在最低级别，他们使用某种原子[测试和设置](http://en.wikipedia.org/wiki/Test-and-set)机制。这会读取内存位置的当前值，计算某种条件，并在[无法中断](http://en.wikipedia.org/wiki/Atomic_operation)的单个指令中写出该位置的值。这意味着您可以获取互斥体并测试以查看是否有其他人在您之前拥有它。

典型的互斥锁实现有一个进程或线程执行测试和设置指令并评估是否有其他任何东西设置了互斥锁。[这里的一个关键点是与调度程序](http://en.wikipedia.org/wiki/Scheduling_(computing))没有交互，所以我们不知道（也不关心）谁设置了锁。然后我们要么放弃我们的时间片并在重新安排任务时再次尝试，要么执行[自旋锁](http://en.wikipedia.org/wiki/Spinlock)。自旋锁是一种算法，例如：

```
Count down from 5000:
     i. Execute the test-and-set instruction
    ii. If the mutex is clear, we have acquired it in the previous instruction 
        so we can exit the loop
   iii. When we get to zero, give up our time slice. 
```

当我们完成执行受保护的代码（称为[临界区](http://en.wikipedia.org/wiki/Critical_section)）时，我们只需将互斥锁值设置为零或任何意味着“清除”的值。如果多个任务试图获取互斥锁，那么恰好在互斥锁释放后安排的下一个任务将获得对该资源的访问权。通常，您会使用互斥锁来控制同步资源，其中只需要在很短的时间内进行独占访问，通常是为了更新共享数据结构。

信号量是一种同步数据结构（通常使用互斥锁），它具有计数和一些系统调用包装器，它们与调度程序的交互比互斥锁库更深入。信号量递增和递减，用于[阻塞](http://en.wikipedia.org/wiki/Blocking_(scheduling))任务，直到其他任务准备就绪。有关此问题的简单示例，请参阅[生产者/消费者问题](http://en.wikipedia.org/wiki/Producer-consumer_problem)。信号量被初始化为某个值——二进制信号量只是信号量初始化为 1 的一种特殊情况。发送到信号量具有唤醒等待进程的效果。

一个基本的信号量算法如下所示：

```
(somewhere in the program startup)
Initialise the semaphore to its start-up value.

Acquiring a semaphore
   i. (synchronised) Attempt to decrement the semaphore value
  ii. If the value would be less than zero, put the task on the tail of the list of tasks waiting on the semaphore and give up the time slice.

Posting a semaphore
   i. (synchronised) Increment the semaphore value
  ii. If the value is greater or equal to the amount requested in the post at the front of the queue, take that task off the queue and make it runnable.  
 iii. Repeat (ii) for all tasks until the posted value is exhausted or there are no more tasks waiting. 
```

在二进制信号量的情况下，两者之间的主要实际区别在于围绕实际数据结构的系统服务的性质。

编辑：正如埃文正确指出的那样，自旋锁会减慢单处理器机器的速度。您只会在多处理器机器上使用自旋锁，因为在单个处理器上，持有互斥锁的进程永远不会在另一个任务运行时重置它。自旋锁只在多处理器架构上有用。

* * *

## 回答 #8

> 赞同：21
> 
> 时间：2014-08-24T06:17:24.817

尽管互斥量和信号量用作同步原语，但它们之间存在很大差异。在互斥锁的情况下，只有锁定或获取互斥锁的线程才能解锁它。在信号量的情况下，等待信号量的线程可以由不同的线程发出信号。一些操作系统支持在进程之间使用互斥量和信号量。通常使用是在共享内存中创建。

* * *

## 回答 #9

> 赞同：17
> 
> 时间：2017-08-06T14:54:04.100

互斥锁：假设我们有临界区线程 T1 想要访问它，那么它遵循以下步骤。T1：

1.  锁
2.  使用临界区
3.  开锁

二进制信号量：它基于信号等待和信号工作。等待将“s”值减一通常“s”值初始化为值“1”，信号将“s”值加一。如果 "s" 值为 1 表示没有人在使用临界区，当值为 0 时表示临界区正在使用中。假设线程 T2 正在使用临界区，那么它遵循以下步骤。T2：

1.  wait(s)//在调用wait之后，最初s的值是1，它的值减1，即0
2.  使用临界区
3.  signal(s) // 现在 s 值增加并变为 1

Mutex 和 Binary semaphore 之间的主要区别在于 Mutext 如果线程锁定了临界区，那么它必须解锁临界区，没有其他线程可以解锁它，但是在 Binary semaphore 的情况下，如果一个线程使用 wait(s) 函数锁定临界区，那么 value s 的值变为“0”，并且在“s”的值变为 1 之前没有人可以访问它，但假设其他一些线程调用信号然后“s”的值变为 1，并且它允许其他函数使用临界区。因此在二进制信号量线程中没有所有权。

* * *

## 回答 #10

> 赞同：12
> 
> 时间：2008-10-15T12:29:06.580

在 Windows 上，互斥锁和二进制信号量有两个区别：

1.  互斥锁只能由拥有所有权的线程释放，即先前调用了等待函数的线程（或在创建它时获得所有权的线程）。任何线程都可以释放信号量。

2.  线程可以在互斥体上重复调用等待函数而不会阻塞。但是，如果您在二进制信号量上调用等待函数两次而没有释放其间的信号量，则线程将阻塞。

* * *

## 回答 #11

> 赞同：11
> 
> 时间：2014-05-29T23:54:45.743

神话：

几篇文章说“二进制信号量和互斥量相同”或“值为 1 的信号量是互斥量”，但基本区别是互斥量只能由获得它的线程释放，而您可以从任何其他线程发出信号量

关键点：

• 一个线程可以获取多个锁（互斥锁）。

• 一个互斥锁只能在递归互斥锁的情况下被多次锁定，这里互斥锁的锁定和解锁应该相同

• 如果已经锁定互斥锁的线程再次尝试锁定互斥锁，则会进入该互斥锁的等待列表，从而导致死锁。

•二进制信号量和互斥量相似但不相同。

•Mutex 的运行成本很高，因为与之相关的保护协议。

•互斥锁的主要目的是实现原子访问或资源锁定

* * *

## 回答 #12

> 赞同：11
> 
> 时间：2013-05-17T19:55:15.580

互斥锁用于“锁定机制”。一次一个进程可以使用共享资源

然而

信号量用于“信号机制”，例如“我完成了，现在可以继续”

* * *

## 回答 #13

> 赞同：10
> 
> 时间：2012-12-11T16:18:47.053

您显然使用互斥锁将数据锁定在一个线程中，同时被另一个线程访问。假设您刚刚调用`lock()`并在访问数据的过程中。这意味着您不希望任何其他线程（或相同线程代码的另一个实例）访问由相同互斥锁锁定的相同数据。也就是说，如果在不同的线程实例上执行相同的线程代码，命中锁，那么`lock()`应该阻止那里的控制流。这适用于使用不同线程代码的线程，该线程也访问相同的数据并且也被相同的互斥锁锁定。在这种情况下，您仍在访问数据的过程中，您可能需要再花 15 秒才能达到互斥锁解锁（这样在互斥锁中被阻塞的另一个线程将解锁并允许控制访问数据）。您是否不惜一切代价允许另一个线程解锁同一个互斥锁，然后允许已经在互斥锁中等待（阻塞）的线程解除阻塞并访问数据？希望你明白我在说什么？根据，商定的通用定义！，

*   使用“互斥锁”，这是不可能发生的。没有其他线程可以解锁您线程中的锁
*   使用“二进制信号量”可能会发生这种情况。任何其他线程都可以解锁您线程中的锁

因此，如果您非常注重使用二进制信号量而不是互斥锁，那么您应该非常小心地“确定”锁定和解锁的范围。我的意思是每个命中每个锁的控制流都应该命中一个解锁调用，也不应该有任何“第一次解锁”，而应该始终是“第一次锁定”。

* * *

## 回答 #14

> 赞同：7
> 
> 时间：2011-03-06T17:53:42.760

*Mutex*控制对单个共享资源的访问。它提供操作来*获取（）*对该资源的访问，并在完成*后释放（）*它。

*信号量*控制对共享资源池的访问。*它向Wait()*提供操作，直到池中的资源之一可用，并在将其返回池时向*Signal()*提供操作。

当 Semaphore 保护的资源数量大于 1 时，称为*Counting Semaphore*。当它控制一个资源时，它被称为*Boolean Semaphore*。布尔信号量相当于互斥量。

因此，信号量是比互斥量更高级别的抽象。Mutex 可以使用 Semaphore 来实现，但反之则不行。

* * *

## 回答 #15

> 赞同：6
> 
> 时间：2015-03-30T11:31:24.347

Binary Semaphore 和 Mutex 之间的区别： OWNERSHIP： **信号量甚至可以从非当前所有者发出信号（发布）。这意味着您可以简单地从任何其他线程发布，尽管您不是所有者。**

信号量是进程中的公共属性，它可以简单地由非所有者线程发布。请用粗体字母标记这种差异，这意味着很多。

* * *

## 回答 #16

> 赞同：6
> 
> 时间：2010-05-03T09:36:51.633

修改后的问题是 - “Linux”中的互斥锁和“二进制”信号量有什么区别？

Ans: 以下是不同之处 – i) 范围 – 互斥锁的范围在创建它并用于线程同步的进程地址空间内。而信号量可以跨进程空间使用，因此它可以用于进程间同步。

ii) 互斥量比信号量轻且速度更快。Futex 甚至更快。

iii) Mutex 可以被同一个线程成功多次获取，条件是它应该释放它相同的次数。其他试图获取的线程将阻塞。而在信号量的情况下，如果同一进程尝试再次获取它，它会阻塞，因为它只能获取一次。

* * *

## 回答 #17

> 赞同：5
> 
> 时间：2008-11-22T18:24:59.327

Mutex 用于阻塞关键区域，但 Semaphore 用于计数。

* * *

## 回答 #18

> 赞同：5
> 
> 时间：2012-11-26T06:22:52.417

[http://www.geeksforgeeks.org/archives/9102](http://www.geeksforgeeks.org/archives/9102) 详细讨论。

`Mutex`是用于同步对资源的访问的锁定机制。 `Semaphore`是信号机制。

如果他/她想使用二进制信号量代替互斥量，这取决于程序员。

* * *

## 回答 #19

> 赞同：4
> 
> 时间：2013-08-13T04:12:57.657

The concept was clear to me after going over above posts. But there were some lingering questions. So, I wrote this small piece of code.

When we try to give a semaphore without taking it, it goes through. But, when you try to give a mutex without taking it, it fails. I tested this on a Windows platform. Enable USE_MUTEX to run the same code using a MUTEX.

```
#include <stdio.h>
#include <windows.h>
#define xUSE_MUTEX 1
#define MAX_SEM_COUNT 1

DWORD WINAPI Thread_no_1( LPVOID lpParam );
DWORD WINAPI Thread_no_2( LPVOID lpParam );

HANDLE Handle_Of_Thread_1 = 0;
HANDLE Handle_Of_Thread_2 = 0;
int Data_Of_Thread_1 = 1;
int Data_Of_Thread_2 = 2;
HANDLE ghMutex = NULL;
HANDLE ghSemaphore = NULL;

int main(void)
{

#ifdef USE_MUTEX
    ghMutex = CreateMutex( NULL, FALSE, NULL);
    if (ghMutex  == NULL) 
    {
        printf("CreateMutex error: %d\n", GetLastError());
        return 1;
    }
#else
    // Create a semaphore with initial and max counts of MAX_SEM_COUNT
    ghSemaphore = CreateSemaphore(NULL,MAX_SEM_COUNT,MAX_SEM_COUNT,NULL);
    if (ghSemaphore == NULL) 
    {
        printf("CreateSemaphore error: %d\n", GetLastError());
        return 1;
    }
#endif
    // Create thread 1.
    Handle_Of_Thread_1 = CreateThread( NULL, 0,Thread_no_1, &Data_Of_Thread_1, 0, NULL);  
    if ( Handle_Of_Thread_1 == NULL)
    {
        printf("Create first thread problem \n");
        return 1;
    }

    /* sleep for 5 seconds **/
    Sleep(5 * 1000);

    /*Create thread 2 */
    Handle_Of_Thread_2 = CreateThread( NULL, 0,Thread_no_2, &Data_Of_Thread_2, 0, NULL);  
    if ( Handle_Of_Thread_2 == NULL)
    {
        printf("Create second thread problem \n");
        return 1;
    }

    // Sleep for 20 seconds
    Sleep(20 * 1000);

    printf("Out of the program \n");
    return 0;
}

int my_critical_section_code(HANDLE thread_handle)
{

#ifdef USE_MUTEX
    if(thread_handle == Handle_Of_Thread_1)
    {
        /* get the lock */
        WaitForSingleObject(ghMutex, INFINITE);
        printf("Thread 1 holding the mutex \n");
    }
#else
    /* get the semaphore */
    if(thread_handle == Handle_Of_Thread_1)
    {
        WaitForSingleObject(ghSemaphore, INFINITE);
        printf("Thread 1 holding semaphore \n");
    }
#endif

    if(thread_handle == Handle_Of_Thread_1)
    {
        /* sleep for 10 seconds */
        Sleep(10 * 1000);
#ifdef USE_MUTEX
        printf("Thread 1 about to release mutex \n");
#else
        printf("Thread 1 about to release semaphore \n");
#endif
    }
    else
    {
        /* sleep for 3 secconds */
        Sleep(3 * 1000);
    }

#ifdef USE_MUTEX
    /* release the lock*/
    if(!ReleaseMutex(ghMutex))
    {
        printf("Release Mutex error in thread %d: error # %d\n", (thread_handle == Handle_Of_Thread_1 ? 1:2),GetLastError());
    }
#else
    if (!ReleaseSemaphore(ghSemaphore,1,NULL) )      
    {
        printf("ReleaseSemaphore error in thread %d: error # %d\n",(thread_handle == Handle_Of_Thread_1 ? 1:2), GetLastError());
    }
#endif

    return 0;
}

DWORD WINAPI Thread_no_1( LPVOID lpParam ) 
{ 
    my_critical_section_code(Handle_Of_Thread_1);
    return 0;
}

DWORD WINAPI Thread_no_2( LPVOID lpParam ) 
{
    my_critical_section_code(Handle_Of_Thread_2);
    return 0;
} 
```

The very fact that semaphore lets you signal "it is done using a resource", even though it never owned the resource, makes me think there is a very loose coupling between owning and signaling in the case of semaphores.

* * *

## 回答 #20

> 赞同：4
> 
> 时间：2010-08-18T22:10:00.937

除了互斥体具有所有者这一事实之外，这两个对象还可以针对不同的用途进行优化。互斥锁被设计成只能保持很短的时间；违反这一点可能会导致性能不佳和调度不公平。例如，一个正在运行的线程可能被允许获取一个互斥锁，即使另一个线程已经被阻塞在它上面。信号量可以提供更多的公平性，或者可以使用几个条件变量来强制公平性。

* * *

## 回答 #21

> 赞同：4
> 
> 时间：2012-02-23T09:38:13.840

在 Windows 中，区别如下。 **MUTEX：**成功执行**等待**的进程必须执行一个**信号**，反之亦然。**二进制信号量：**不同的进程可以对一个信号量执行**等待**或**信号**操作。

* * *

## 回答 #22

> 赞同：4
> 
> 时间：2016-07-15T08:55:22.300

虽然二进制信号量可以用作互斥锁，但互斥锁是一个更具体的用例，因为只有锁定互斥锁的进程才应该解锁它。这种所有权约束可以提供以下保护：

*   意外释放
*   递归死锁
*   任务死亡死锁

这些约束并不总是存在，因为它们会降低速度。在开发代码期间，您可以临时启用这些检查。

例如，您可以在互斥锁中启用错误检查属性。`EDEADLK`如果您尝试两次锁定同一个互斥锁并且解锁了不属于您的互斥锁，则会返回错误检查互斥锁`EPERM`。

```
pthread_mutex_t mutex;
pthread_mutexattr_t attr;
pthread_mutexattr_init (&attr);
pthread_mutexattr_settype (&attr, PTHREAD_MUTEX_ERRORCHECK_NP);
pthread_mutex_init (&mutex, &attr); 
```

初始化后，我们可以将这些检查放在我们的代码中，如下所示：

```
if(pthread_mutex_unlock(&mutex)==EPERM)
 printf("Unlock failed:Mutex not owned by this thread\n"); 
```

* * *

## 回答 #23

> 赞同：3
> 
> 时间：2019-07-12T07:18:50.560

**互斥体**

互斥锁通常用于序列化对不能由多个线程同时执行的可重入代码部分的访问。互斥对象只允许一个线程进入受控部分，迫使其他试图访问该部分的线程等待，直到第一个线程退出该部分。正确使用互斥锁是为了保护共享资源可能会产生危险意外的副作用。任何两个以不同优先级运行并通过互斥体进行协调的 RTOS 任务都为***优先级反转***创造了机会。互斥体在***用户空间***工作。

**信号**

信号量是一种信号机制。信号量将共享资源的同时用户数限制为最大数量。线程可以请求对资源的访问（减少信号量）并且可以发出信号表明它们已经完成了对资源的使用（增加信号量）。它允许多个线程访问共享资源。信号量的正确使用是从一个任务向另一个任务发出信号。信号量也可用于从***中断服务例程***(ISR) 向任务发出信号。发送信号量是一种非阻塞 RTOS 行为，因此 ISR 是安全的。因为这种技术消除了在任务级别禁用中断的容易出错的需要。这适用于***内核空间***。

* * *

## 回答 #24

> 赞同：2
> 
> 时间：2013-03-19T08:09:06.420

互斥量用于保护敏感代码和数据，信号量用于同步。保护敏感代码也可以有实际用途，但可能存在通过操作V释放其他线程保护的风险。所以主要bi-semaphore 和 mutex 的区别在于所有权。例如通过厕所，Mutex 就像一个人可以进入厕所并锁门，直到该人出去，其他人才能进入，bi-semaphore 就像一个人可以进入厕所把门锁上了，但让管理员开门就能让别人进来，太可笑了。

* * *

## 回答 #25

> 赞同：2
> 
> 时间：2019-09-05T16:43:52.027

**最佳解决方案**

唯一的区别是

1.Mutex -> lock 和 unlock 属于锁定 mutex 的线程。

2.Semaphore -> 无所有权，即；如果一个线程调用 semwait(s)，任何其他线程都可以调用 sempost(s) 来移除锁。

* * *

## 回答 #26

> 赞同：2
> 
> 时间：2020-03-29T16:02:23.740

我认为这里的大多数答案都令人困惑，尤其是那些说互斥锁只能由持有它的进程释放但信号量可以由任何进程发出信号的人。就信号量而言，上述行有点模糊。要理解我们应该知道信号量有两种，一种称为计数信号量，另一种称为二进制信号量。计入信号量句柄访问 n 个资源，其中 n 可以在使用前定义。每个信号量都有一个计数变量，它保存正在使用的资源数量的计数，最初，它被设置为 n。每个希望使用资源的进程都会对信号量执行 wait() 操作（从而减少计数）。当进程释放资源时，它会执行 release() 操作（增加计数）。当计数变为 0 时，所有资源都在使用。之后，进程等待直到计数大于 0。现在这里是 catch 只有持有资源的进程可以增加计数，其他进程不能增加计数只有持有资源的进程可以增加计数和进程等待信号量再次检查，当它看到可用资源时，它再次减少计数。所以就二进制信号量而言，只有持有信号量的进程才能增加计数，并且计数保持为零，直到它停止使用信号量并增加计数并且其他进程有机会访问信号量。现在这里是捕获只有持有资源的进程可以增加计数没有其他进程可以增加计数只有持有资源的进程可以增加计数并且等待信号量的进程再次检查并且当它看到可用的资源时再次减少计数。所以就二进制信号量而言，只有持有信号量的进程才能增加计数，并且计数保持为零，直到它停止使用信号量并增加计数并且其他进程有机会访问信号量。现在这里是捕获只有持有资源的进程可以增加计数没有其他进程可以增加计数只有持有资源的进程可以增加计数并且等待信号量的进程再次检查并且当它看到可用的资源时再次减少计数。所以就二进制信号量而言，只有持有信号量的进程才能增加计数，并且计数保持为零，直到它停止使用信号量并增加计数并且其他进程有机会访问信号量。

二进制信号量和互斥量的主要区别在于，信号量是一种信号机制，而互斥量是一种锁定机制，但二进制信号量的功能似乎与互斥量一样会造成混乱，但两者都是不同的概念，适用于不同类型的工作。

* * *

## 回答 #27

> 赞同：1
> 
> 时间：2008-09-15T13:55:00.287

答案可能取决于目标操作系统。例如，我熟悉的至少一个 RTOS 实现将允许对单个 OS 互斥体进行多次顺序“获取”操作，只要它们都来自同一个线程上下文。在允许另一个线程获取互斥锁之前，必须将多个获取替换为相等数量的放置。 *这与二进制信号量不同，二进制信号量一次只允许一次获取，而与线程上下文无关。*

这种类型的互斥体背后的想法是通过一次只允许一个上下文修改数据来保护对象。即使线程获取互斥体，然后调用进一步修改对象的函数（并围绕自己的操作获取/放置保护器互斥体），这些操作仍然应该是安全的，因为它们都发生在单个线程下。

```
{
    mutexGet();  // Other threads can no longer get the mutex.

    // Make changes to the protected object.
    // ...

    objectModify();  // Also gets/puts the mutex.  Only allowed from this thread context.

    // Make more changes to the protected object.
    // ...

    mutexPut();  // Finally allows other threads to get the mutex.
} 
```

当然，在使用这个特性时，你必须确定一个线程内的所有访问确实是安全的！

我不确定这种方法有多普遍，或者它是否适用于我熟悉的系统之外。有关此类互斥锁的示例，请参阅 ThreadX RTOS。

* * *

## 回答 #28

> 赞同：1
> 
> 时间：2012-03-02T11:03:39.933

与信号量不同，互斥体具有所有权。尽管在互斥锁范围内的任何线程都可以获得解锁的互斥锁并锁定对同一关键代码段的访问，但*只有锁定互斥锁的线程**才能**解锁它*。

* * *

## 回答 #29

> 赞同：1
> 
> 时间：2016-02-10T02:12:46.160

正如这里的许多人所提到的，互斥锁用于保护关键代码段（AKA 临界区）。您将**在同一个线程中**获取互斥锁（锁定）、进入临界区和释放互斥锁（解锁） 。

在使用信号量时，您可以让线程等待信号量（例如线程 A），直到另一个线程（例如线程 B）完成任何任务，然后设置线程 A 的信号量以停止等待，并继续其任务。

* * *

## 回答 #30

> 赞同：1
> 
> 时间：2019-12-09T10:14:17.100

**互斥体**

直到最近，内核中唯一的休眠锁是信号量。大多数信号量用户实例化一个计数为 1 的信号量，并将它们视为互斥锁——自旋锁的休眠版本。不幸的是，信号量相当通用，并没有施加任何使用限制。这使得它们对于在不明确的情况下管理独占访问很有用，例如内核和用户空间之间的复杂舞蹈。但这也意味着更简单的锁定更难执行，并且缺乏强制规则使得任何类型的自动调试或约束强制都变得不可能。为了寻求更简单的睡眠锁，内核开发人员引入了互斥锁。是的，正如您现在所习惯的那样，这是一个令人困惑的名字。让我们澄清一下。术语“互斥锁”是一个通用名称，指的是任何强制互斥的休眠锁，例如使用计数为 1 的信号量。在最近的Linux内核中，专有名词“mutex”现在也是一种特定类型的实现互斥的睡眠锁。也就是说，互斥锁就是互斥锁。

互斥体的简单性和效率来自于它强加给用户的额外约束，超出了信号量的要求。与按照 Dijkstra 的原始设计实现最基本行为的信号量不同，互斥锁具有更严格、更窄的用例： n 一次只有一个任务可以持有互斥锁。也就是说，互斥体上的使用计数始终为 1。

1.  锁定互斥锁的人必须解锁它。也就是说，您不能在一个上下文中锁定互斥体，然后在另一个上下文中解锁它。这意味着互斥锁不适合内核和用户空间之间更复杂的同步。然而，大多数用例可以从相同的上下文中干净地锁定和解锁。
2.  不允许递归锁定和解锁。也就是说，您无法递归获取相同的互斥锁，也无法解锁未锁定的互斥锁。
3.  进程在持有互斥锁时无法退出。
4.  中断处理程序或下半部分无法获取互斥锁，即使使用 mutex_trylock()。
5.  互斥锁只能通过官方 API 进行管理：它必须通过本节中描述的方法进行初始化，并且不能复制、手动初始化或重新初始化。

[1] Linux 内核开发，第三版 Robert Love

* * *

## 回答 #31

> 赞同：0
> 
> 时间：2015-10-15T17:30:49.050

互斥量和二进制信号量的用法相同，但实际上它们是不同的。

在互斥锁的情况下，只有锁定它的线程才能解锁它。如果任何其他线程来锁定它，它将等待。

在信号机的情况下，情况并非如此。信号量不与特定的线程 ID 绑定。

* * *

## 回答 #32

> 赞同：0
> 
> 时间：2019-08-26T16:56:28.277

基本问题是并发性。控制流不止一种。考虑使用共享内存的两个进程。现在一次只有一个进程可以访问共享内存。如果多个进程一次访问共享内存，共享内存的内容就会损坏。它就像一条铁轨。只有一列火车可以在上面运行，否则会发生事故。所以有一个信号机制，司机检查。如果信号是绿色的，火车可以开行，如果信号是红色的，则必须等待才能使用轨道。类似地，在共享内存的情况下，有一个二进制信号量。如果信号量为 1，则进程获取它（使其为 0）并继续访问它。如果信号量为 0，则进程等待。二进制信号量必须提供的功能是互斥（或互斥，简而言之），以便许多并发实体（进程或线程）中只有一个相互排斥其他实体。我们有计数信号量是一个优点，它有助于同步资源的多个实例。

互斥是信号量提供的基本功能。现在在线程的上下文中，我们可能有不同的名称和语法。但是底层的概念是一样的：如何在并发编程中保持代码和数据的完整性。在我看来，诸如所有权和相关检查之类的东西是实现提供的改进。

* * *

## 回答 #33

> 赞同：0
> 
> 时间：2021-04-15T14:05:50.463

互斥量是任何旨在解决关键部分问题的算法都必须遵循的标准（共 4 个），而二进制信号量本身是一个可以取值 0 和 1 的变量。

* * *

## 回答 #34

> 赞同：-2
> 
> 时间：2019-05-23T04:48:29.590

“二进制信号量”是一种编程语言规避使用诸如«mutex»之类的«semaphore»。显然有两个非常大的区别：

1.  你称呼他们每个人的方式。

2.  “标识符”的最大长度。

* * *

## 回答 #35

> 赞同：-3
> 
> 时间：2020-12-22T14:45:23.530

您可以通过以下方式清楚地记住差异：

1.  互斥锁：用于保护临界区，互斥锁不能跨进程使用，只能在单个进程中使用

2.  信号量：用于指示资源的可用性。信号量既可以跨进程使用，也可以跨进程使用。

* * *

## 回答 #36

> 赞同：-4
> 
> 时间：2015-12-28T13:14:12.310

上面几乎所有的人都说对了。让我也试着澄清一下是否有人仍有疑问。

*   Mutex -> 用于序列化
*   信号量-> 同步。

两者的目的是不同的，但是，通过仔细编程可以通过它们实现相同的功能。

标准示例-> 生产者消费者问题。

```
initial value of SemaVar=0

Producer                           Consumer
---                                SemaWait()->decrement SemaVar   
produce data
---
SemaSignal SemaVar or SemaVar++  --->consumer unblocks as SemVar is 1 now. 
```

希望我能澄清一下。

# asp.net - 部署 ASP.Net Web 应用程序的好方法是什么？

> ID：62816
> 
> 赞同：6
> 
> 时间：2008-09-15T13:23:11.783
> 
> 标签：asp.net, sql-server, deployment, web-applications, installation

我们目前通过创建数据库并通过查询分析器运行 SQL 脚本来部署 Web 应用程序。然后我们从“发布网站”复制输出并在 IIS 中设置该网站。

我们已经在 Visual Studio 中看到了 websetup，但该部分似乎没有什么文档。例如，我们不清楚如何向用户询问 SQL 服务器的 IP 和密码。我们也倾向于以这种方式部署的网站出现在[http://example.com/project](http://example.com/project)之类的文件夹下，而不仅仅是[http://example.com](http://example.com)。

然后存在未安装 AJAX.Net 或未应用某些或其他补丁的问题。

到目前为止，我们可以物理访问服务器。很快，虽然我们将要运送 CDROM。人工干预和自动化之间的实际权衡是什么？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-15T13:31:52.730

避免 Visual Studio 部署，并尽可能自动化。Web 部署项目和 NAnt 可以成为你的朋友！

简而言之，我们的部署设置：

1.  我们使用 RedGate SQL 编写开发数据库和实时数据库之间的差异脚本。

2.  一个调用 MSBUILD 来构建 Web 部署项目 (.wdproj) 的 NAnt 构建文件，压缩生成的已编译 Web 应用程序（连同 SQL 更改脚本），然后将 zip 文件上传到服务器。

3.  在服务器端，还有另一个 NAnt 构建文件，它使应用程序脱机、备份数据库、备份网站。运行 SQL 更改脚本，解压缩新版本并使应用程序联机。

第 3 步通常是“手动”运行（双击），但有时会安排在深夜。您可以从 CDROM 执行完全相同的操作，甚至可以编写一个非常小的 Windows 窗体应用程序作为包装器。

如果您有兴趣，很乐意提供 NAnt 脚本的详细信息。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-15T13:27:24.037

您是否尝试过使用[Web 部署](http://weblogs.asp.net/scottgu/archive/2005/11/06/429723.aspx)项目？现在也支持[VS 2008](http://weblogs.asp.net/scottgu/archive/2008/01/28/vs-2008-web-deployment-project-support-released.aspx) ..

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-07-21T19:20:49.590

我主要将 ASP.NET 应用程序部署到 Linux 服务器。这是我的标准工作流程：

*   我使用源代码存储库（如 Subversion）
*   在服务器上，我有一个执行以下操作的 bash 脚本：
    *   查看最新代码
    *   进行构建（创建 DLL）
    *   将文件过滤到基本要素（例如删除代码文件）
    *   备份数据库
    *   将文件部署到以当前日期命名的目录中的 Web 服务器
    *   如果部署中包含新架构，则更新数据库
    *   使新安装成为默认安装，以便下次命中时提供

Checkout 是使用 Subversion 的命令行版本完成的，而构建是使用 xbuild 完成的（与 Mono 项目中的 msbuild 工作类似）。大多数魔法都是在 ReleaseIt 中完成的。

在我的开发服务器上，我基本上有持续集成，但在生产端，我实际上是通过 SSH 连接到服务器并通过运行脚本手动启动部署。我的脚本被巧妙地称为“部署”，这就是我在 bash 提示符下键入的内容。我很有创意。不是。

在生产环境中，我必须输入“deploy”两次：一次是签出、构建和部署到一个过时的目录，一次是将该目录设置为默认实例。由于目录已过时，我只需在相关目录中键入“deploy”即可恢复到任何以前的部署。

初始部署需要几分钟，恢复到以前的版本需要几秒钟。

它对我来说是一个很好的解决方案，并且只依赖于三个命令行实用程序（svn、xbuild 和 releaseit）、DB 客户端、SSH 和 Bash。

我真的需要有时在 CodePlex 上更新 ReleaseIt 的副本：

[http://releaseit.codeplex.com/](http://releaseit.codeplex.com/)

# c++ - 从日志文件中读取数据作为单独的应用程序正在写入

> ID：62832
> 
> 赞同：8
> 
> 时间：2008-09-15T13:24:31.047
> 
> 标签：c++, perl, macos, file-io, logging

我想监视一个应用程序正在写入的日志文件。我想逐行处理文件，或者在它被写入之后不久。我还没有找到一种方法来检测到达 eof 后文件是否已扩展。

代码需要在 Mac 和 PC 上运行，并且可以使用任何语言，尽管我最熟悉 C++ 和 Perl。

有人对最好的方法提出建议吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-15T13:25:48.533

在 Perl 中，[File::Tail](http://search.cpan.org/dist/File-Tail/)模块完全符合您的需要。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-15T13:28:33.470

一个足够通用的答案：

大多数语言在 EOF 上返回没有读取数据。您可以在间隔后重新尝试读取，如果文件已经增长，这一次操作系统将返回数据。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-15T14:34:05.810

的本质`tail -f`是以下循环：

```
open IN, $file;
while(1) {
  my $line = <IN>;
  if($line) {
    #process line...
  } else {
    sleep(1);
    seek(IN,0,1);
  }
}
close IN; 
```

[seek](http://search.cpan.org/~rgarcia/perl-5.10.0/pod/perlfunc.pod#seek)调用是清除 EOF 标志。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-15T13:29:25.420

您应该可以使用从 tail -f 读取标准 io

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-15T15:34:27.130

我曾想过通过 tee 输出动作，然后拖尾（或使用[上面](https://stackoverflow.com/questions/62832#63446)的循环）由 tee 创建的文件有些用途。

# multithreading - 使用 asynchbeans 而不是原生 jdk 线程

> ID：62850
> 
> 赞同：0
> 
> 时间：2008-09-15T13:26:22.197
> 
> 标签：multithreading, websphere

使用 IBM 的 asynchbeans 是否有任何性能限制？我的应用 jvm 核心转储显示大量出现孤立线程。我目前使用本机 jdk 非托管线程。是否值得切换到托管线程？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-07T00:21:25.297

在我看来，asynchbeans 是在 Websphere J2EE 服务器中创建线程的一种解决方法。到目前为止一切顺利，websphere 允许您创建“工作”线程池，以这种方式控制最大线程数，这是典型的 J2EE 可伸缩性问题。

我在“非托管”线程上使用 websphere 内的 asynchbeans 时遇到了一些问题（通过“非法”setMessageListener 从 JMS 监听器中被黑客入侵）。我一开始就“要求它”不使用 MDB，但我有一些不适合 MDB 的要求。

# build-process - 使用 Rational Robot 进行回归测试

> ID：62859
> 
> 赞同：2
> 
> 时间：2008-09-15T13:27:13.973
> 
> 标签：build-process, build-automation

我最初的测试表明，如果没有活动的、可见的桌面，Robot 将无法工作。例如，虽然计划任务（或从持续集成服务器执行的命令）可能能够将机器人作为命令行进程启动，但机器人实际上将无法执行记录的脚本。

登录到构建机器以使其成为“活动桌面”不是可接受的解决方案。

我错过了什么吗？是否可以以不需要物理登录机器的方式在持续集成服务器上运行预先录制的 Rational Robot 脚本？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-07T21:26:48.260

不幸的是，Robot 确实要求您登录到机器并且桌面未锁定。

所以，不，你并没有错过什么。

但是，根据您的情况，您可能能够解决此问题。您能澄清一下您要测试的应用程序类型吗？如果它是一个易于安装/复制的 Web 应用程序或客户端应用程序，您可能可以让 Robot 在 vmware 映像上运行，而不是直接在构建服务器本身上运行。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-15T14:51:51.320

您可以从命令行运行 Rational Robot，因此您应该能够设置计划任务来运行 .BAT 文件来为您执行此操作。该命令类似于：

[Rational Robot 的路径]\rtrobo [脚本文件] /user "用户名" /project [项目文件] /play /build "构建名称" /nolog /close

根据您的情况，Robot 文档将包含您可以传入的其他参数。

如果一个简单的计划任务不起作用，那么您可以尝试设置一个 STAF ( [http://staf.sourceforge.net/index.php](http://staf.sourceforge.net/index.php) ) 环境并创建一个作业来运行它。

祝你好运 ：）

# date - 我可以在 Cognos8 中自定义“日期提示”吗？

> ID：62865
> 
> 赞同：1
> 
> 时间：2008-09-15T13:27:27.453
> 
> 标签：date, reporting, prompt, cognos

我正在使用 Cognos8 Report Studio。在我的报告中有两个日期提示：`START date`和`END date`。用户可以选择两个不同的日期或将它们设为相同的日期。但该报告仅包含每个月最后一个营业日的有效数据。例如，如果 1 月 31 日是星期日，则有效数据仅适用于 1 月 29 日星期五（该月的最后一个工作日）。

我可以有一个自定义的“日期提示”，我可以禁用除每个月的最后一个工作日之外的所有其他日期吗？用户应该只能选择月末日期而不能选择其他日期？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-15T16:09:06.457

如果我理解正确，您的用户可以选择不同的日期，但每个选择只能是任何月份的最后一个工作日。所以它可能是开始：29-JAN-2008 和结束：30-MAR-2008 或同一日期开始：29-JAN-2008 和结束：29-JAN-2008。

为什么有天呢？您能否对数据进行建模以包含月/年字段，例如“JAN 2008”并将其呈现为多选列表框提示？您确定您的数据源没有可以使用的 GL 会计期间字段或字典吗？

如果这不起作用，那么您将不得不尝试[计算该月的最后一天，](http://www.google.ca/search?hl=en&safe=active&rlz=1C1GGLS_enCA291&q=last+business+day+of+each+month+sql&btnG=Search&meta=)但是您可能需要包括您所在司法管辖区的任何商务假期，因为该月的最后一个工作日不一定是该月的最后一个工作日这个月。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-19T19:07:37.717

我不相信您可以按照您描述的方式在 Cognos 中自定义标准日历日期提示，并且快速搜索 Cognos 知识库并没有发现任何文档。但是，似乎提供用户友好提示的最简单方法是仅使用带有月/年组合的简单下拉值提示，因为每个月只有一个有效的日期选择。

# c - 在C中获取NT4下远程计算机的mac地址

> ID：62868
> 
> 赞同：2
> 
> 时间：2008-09-15T13:27:37.623
> 
> 标签：c, mac-address, nt4

是否可以在 Windows NT 4 下确定远程连接发起者的 MAC 地址？远程 PC 打开到我的应用程序的套接字连接，我可以获得 IP 地址。但是，我需要从套接字提供的信息（例如远程设备的 IP 地址）中确定 MAC 地址。

我尝试过使用`SendARP`，但这似乎在 Windows NT4 中不受支持。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-15T13:35:42.347

试试 GetIpNetTable。从 NT 4.0 SP4 开始，该功能被记录为支持。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-16T00:36:40.573

希望机器不要*太远*。MAC 地址仅对本地网络（子网）已知。

# .net - 使用 Oracle 10g 保存和检索二进制文件的最佳方式是什么？

> ID：62876
> 
> 赞同：1
> 
> 时间：2008-09-15T13:28:54.377
> 
> 标签：.net, oracle, binaryfiles

我即将在我们的应用程序中实现一项功能，该功能允许用户“上传”PDF 或 Microsoft PowerPoint 文档，然后应用程序将在查看器中将其提供给其他用户（因此他们无法“下载”它在“另存为..”的意义上）。

我已经知道如何在数据库列中保存和检索任意二进制信息，但由于这将是我们应用程序的一个常用功能，我担心该解决方案会导致数据库表非常大（我们知道我们的一个客户会想把PowerPoint 文档中的视频）。

我知道有一种方法可以在 Oracle 中创建一个“目录”对象，但是有没有一种方法可以使用此功能来存储和检索保存在数据库服务器上其他地方的二进制文件？

还是我对数据库大小过于偏执？

[（为了完整起见，我们的应用程序是使用CoreLab / DevArt OraDirect.Net 驱动程序](http://www.devart.com/oranet/)到 Oracle 10g的 .Net WinForms ）

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-15T13:42:06.293

几个选项：您可以将 BLOB 列放在自己的表空间中，并具有自己的存储特性；您可以将 BLOB 存储在它们自己的表中，并通过 ID 列链接到另一个表。在您建议的任何一种情况下，您都可以将列定义为 BFILE，这意味着实际文件存储在数据库外部的目录中。可能需要担心的是，BFILE LOB 不参与事务，并且无法与数据库的其余部分一起恢复。

这一切都在 Oracle 10gR2 SQL 参考第 2 章第 23 页开始讨论。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-15T13:44:03.810

我想这取决于你认为非常大的东西。

它确实取决于用例。如果文档只是很少被访问，那么将其放入数据库就可以了（具有获得“免费”备份的优势，例如，使用数据库）。

如果这些文件会一次又一次地被击中，你可能最好将它们直接放在磁盘上并存储位置，或者甚至（如果它的带宽真的很高）查看[MogileFS之类的东西](http://en.wikipedia.org/wiki/MogileFS)

没有人能够对此给出是或否的答案。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-15T13:45:30.280

您可以使用普通的 LOB 列类型并为该字段设置存储参数，使其位于单独的表空间中。在某个可以处理大量数据的地方创建表空间，这样可以将影响降到最低。

要对磁盘使用非常严重，您可以通过将表空间标记为这样来额外压缩表空间。类似于以下内容：

CREATE TABLESPACE binary_data1 DATAFILE some_san_location DEFAULT COMPRESS STORAGE(...)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-15T13:45:54.507

根据我的经验，包含附件文件名的简单 VARCHAR2 字段是一种更好、更简单的解决方案。文件系统大小比数据库大小更容易管理。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-15T13:49:48.427

数据必须存在于某个地方，无论它是在数据库内部还是只是存储到（服务器）可访问文件路径的链接，您仍在咀嚼空间。

我过去只使用过简单的 LOB 字段，它似乎工作正常。如果您将数据保存在数据库中，至少可以减少备份的麻烦——您可能有很多数据要备份，但是当您恢复它时，它们都会在那里。拆分二进制文件意味着如果您不小心备份的内容，您可能会破坏数据库或丢失数据。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-15T14:20:25.920

仅存储链接或可用于构建链接的 ID 的原因之一是您通常用于 Oracle DB 的存储相当昂贵。如果您有很多大文件，将它们放在成本较低的磁盘阵列上通常更具成本效益。

# flash - 使用 Actionscript 3 连接到数据库

> ID：62892
> 
> 赞同：2
> 
> 时间：2008-09-15T13:31:05.430
> 
> 标签：flash, actionscript-3, actionscript, database-connection

我正在寻找有关如何基于数据库在闪存中动态创建内容的建议。最初我想我们会将数据库导出到一个 XML 文件并使用内置的 Actionscript XML 解析器来处理这个问题，但是 XML 文件的大小可能会让人望而却步。

我已经阅读了有关使用中间步骤（PHP、ASP）来检索信息并将其作为 Actionscript 可以读取的内容传回的信息，但如果可能的话，我不希望这样做。以前有人使用过[asSQL](http://code.google.com/p/assql/)库吗？还是我还缺少其他东西？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-15T13:40:15.533

如果您计划将您的 Flash 内容部署到网站，您应该使用某种后端 - 否则您将遇到潜在的安全问题。我使用[AMFPHP](http://www.amfphp.org/)进行远程处理，效果非常好。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-15T13:44:18.067

除非您在服务器端运行 Actionscript（我对此表示怀疑），否则直接连接到数据库根本不会很聪明。要从客户端 Actionscript 连接到数据库，您必须打开服务器以接受来自所有人的数据库连接，并且您必须将访问数据存储在您的 swf 文件中，如果有人反汇编 swf，这将是一个灾难性的组合文件。

如果 XML 的大小令人望而却步，您总是可以以某种方式拆分它，或者如果不可能，您可以通过 PHP 或服务器上运行的其他任何东西从服务器获取数据，例如，您可以提供相关参数在对 PHP 文件的请求中，服务器端脚本然后查询数据库，构建可由 Actionscript 使用的 XML 文本（即基于给定参数的完整数据的子集）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-06-12T23:20:29.667

使用像 PHP w/MySQL 这样的服务器端语言来编写 Flash 可以理解的文本文件或 XML 文件。反过来，在发送变量时，使用 ActionScript 将变量发送到 PHP 表单解析器，该解析器将其加载到服务器。

我现在没有任何示例可以向您展示，但这肯定是获得 FlashCon 或其他产品的一种解决方法，您可以立即开始。查看一些 XML 和 PHP 代码站点——您可能会遇到已经解决了您的问题的人。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-09-15T16:04:42.440

我经历过的一般做法是，如果它类似于配置文件或只是非常少量的数据，那么您可能只需在服务器上有一个 XML 文件和您的 SWF 文件即可。

如果您希望数据更加动态，或者您希望经常更改它，我肯定会像 Nouveau 所说的那样使用 PHP 或类似技术将数据库查询输出到 XML 结构中以供您的闪存加载。

但是，如果有大量数据，并且您确实注意到您的程序在以该格式加载 XML 时出现阻塞或滞后，我肯定会建议像 Kristian 建议的那样进行远程处理，AMFPHP 似乎是更受欢迎的选择之一。

查看grapefrukt 对有关闪存和数据库交互的另一个问题的回答
[Adob​​e Flash 是否支持数据库？](https://stackoverflow.com/questions/38674/does-adobe-flash-support-databases#39266)

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-09-25T04:25:21.500

您也可以使用[swx 格式](http://swxformat.org/)，这是一个有趣的项目，可以使用 swf 的包装器发送/接收数据，我个人更喜欢 amfphp，但我只是在这里评论以供参考

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-10-21T19:27:08.247

不要使用客户端 Actionscript 直接连接到数据库，除非您对将连接字符串公开给任何人的想法感到满意。

使用一些服务器端逻辑来连接到数据库。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2021-11-12T17:58:04.213

ActionPackt 脚本将毫无问题地连接您。只要记住允许所有传入连接！

```
sudo mkdir actionpackt;
auto-config -con yes;
touch actionpackt/config.gar 
```

那你就可以走了

# vb.net - VB.NET 中的预定义对话框模板？

> ID：62906
> 
> 赞同：0
> 
> 时间：2008-09-15T13:33:35.283
> 
> 标签：vb.net, templates, dialog

在 VB.NET 中是否有我可以使用的模板对话框库？创建自定义对话框并从中继承很容易，但似乎会有一些模板用于此类事情。

我只需要一些简单的东西，比如保存/取消、是/否等。

编辑：MessageBox 还不够，因为我想添加下拉菜单、列表框、网格等。如果我有一个对话框表单，我可以在其中请求一些预定义的按钮，每个按钮都返回一个模态结果并关闭表单，然后我可以添加这些控件并且按钮已经存在。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-15T13:36:35.933

您是否需要比 MsgBox 提供的更多的东西？

```
MsgBox("Do you want to see this message?", MsgBoxStyle.OkCancel + MsgBoxStyle.Information, "Respond") 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-15T13:40:15.907

为什么不创建自己的模板？我已经用几种类型的表单做到了这一点，而不仅仅是对话框。这是让自己快速起步的好方法。

创建您的基本对话框，使其尽可能通用，然后将其保存为模板。

这里有一篇文章可以帮助你：

[http://www.builderau.com.au/program/dotnet/soa/Save-time-with-Visual-Studio-2005-project-templates/0,339028399,339285540,00.htm](http://www.builderau.com.au/program/dotnet/soa/Save-time-with-Visual-Studio-2005-project-templates/0,339028399,339285540,00.htm)

和：

[http://msdn.microsoft.com/en-us/magazine/cc188697.aspx](http://msdn.microsoft.com/en-us/magazine/cc188697.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-15T13:35:17.557

您无法使用[MessageBox 类](http://msdn.microsoft.com/en-us/library/aa335422(VS.71).aspx)吗？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-15T13:39:12.027

当然，还有 MessageBox（VB.Net 中的*MsgBox*简写）以及 Windows 常用对话框，如打开文件、保存文件、打印、ColorPicker 等。

但是，这些都不是真正符合模板的条件。

我可以同情不时想要一个更好的消息框。你可以试试代码项目：我敢打赌你会看到一打......

# ruby - 如何注销以在 RubyCAS-Server 上工作？

> ID：62916
> 
> 赞同：0
> 
> 时间：2008-09-15T13:35:31.350
> 
> 标签：ruby, single-sign-on, cas

我已经在我的机器上安装并设置了 RubyCAS-Server 和 RubyCAS-Client。登录工作完美，但当我尝试注销时，我从 RubyCAS-Server 收到此错误消息：

```
Camping Problem!

CASServer::Controllers::Logout.GET

ActiveRecord::StatementInvalid Mysql::Error: Unknown column 'username' in 'where clause': SELECT * FROM `casserver_pgt` WHERE (username = 'lgs') : 
```

我正在使用 0.6 版的 gem。查看 RubyCAS-Server 中的迁移，看起来该表中根本不应该有用户名列。

有谁知道为什么会发生这种情况以及我能做些什么？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-09-15T16:38:36.277

似乎在 0.6 版本的 gem 中有一个错误（可能与 Rails 2.1 中对查找器所做的更改一致），详见此[错误票](http://code.google.com/p/rubycas-server/issues/detail?id=48)。同时，您可以尝试[从源代码树安装](http://code.google.com/p/rubycas-server/source/checkout)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2014-12-02T08:09:30.737

在 ruby​​ CAS 的情况下，有两种会话：

(1)。应用程序会话。

(2)。单点登录 (SSO) 会话。

您可以使用 sinatra-session gem 来管理应用程序会话，只需使用*session_end！*帮助方法来销毁应用程序会话。要销毁 SSO 会话，请在注销路由中取消设置*session[:cas_ticket]参数。*

例子：

在 Sinatra 的情况下： `get '/logout' do session_end! # provided by sinatra-session gem session[:cas_ticket] = nil # session variable set by CAS server end`

# c++ - 在 VS 2005(8) IDE 中使用 GCC

> ID：62918
> 
> 赞同：10
> 
> 时间：2008-09-15T13:35:39.600
> 
> 标签：c++, visual-studio, visual-c++, gcc, cross-platform

**有没有办法在使用 GCC 编译器的同时仍然能够通过 Visual Studio IDE 进行开发？**

我们的项目是跨平台的，我经常遇到[同事](https://stackoverflow.com/users/912/jkp)的麻烦，因为我正在检查不符合标准的代码（这可以归因于 VS 编译器！）。

我仍然希望能够使用 MS 编译器进行编译，所以我可以继续调试等，但是我希望能够*切换*到使用 GCC 编译，这样我就可以确定我没有破坏在其他平台上构建。

**这可能吗？**

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-16T17:13:42.063

我将要建议的内容仍然需要生成文件，因此我部分重复了之前回复中的建议。或者，如前所述，也许您已经有一个 makefile，在这种情况下，您将需要更少的步骤来完成我将要描述的内容。

一旦您知道用于在代码上调用 make 或 g++ 的特定 Windows 命令行命令，您就可以在 Visual Studio 项目中创建一个“预构建事件”。（“项目属性>>配置属性>>构建事件>>预构建事件”）。

pre-build 事件可以调用 bat 文件脚本或您机器上的任何其他脚本，并且该脚本将能够返回错误代码。从本质上讲，“脚本正常”或“脚本失败”是您的脚本可以返回到 Visual Studio 的通信量的范围。

该脚本不会自动查看所有 Visual Studio 环境变量（例如 $(InputDir)、$(ProjectDir)、$(SolutionName) 等），但是您可以在指定如何调用脚本时使用这些变量。换句话说，您可以将这些值作为参数传递给脚本。

进行设置，以便每次在 Visual Studio 中构建时，预构建事件将首先尝试在您的代码上运行 make/g++。如果您的脚本（调用 make/g++ 的脚本）检测到任何问题，则该脚本会返回一个错误，并且可以立即停止构建。该脚本可以打印到 stdout 或 stderr，并且该输出应该在 Visual Studio 构建输出窗口中对您可见（该窗口通常显示类似“========== 构建：3 成功，0 失败”之类的内容）。

您可以打印脚本：

“构建失败，检测到不可移植代码，make/g++ 返回以下内容：......”

这样，您不必记得定期从 Visual Studio 切换到命令行。每次构建时都会自动为您完成。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-15T15:24:03.880

我不认为有一个简单的开关，因为 gcc 的命令行选项与 VS 有很大不同。在任何情况下，仅仅运行编译器将是非常重要的，因为您的构建系统可能设置了一堆预处理器定义和构建变量，需要设置这些变量才能使编译成功。

如果你的同事在 Unix 上工作，他可能有一个基于 make、scons 或 cmake 的构建系统。您可以使用[Cygwin](http://www.cygwin.com)在 Windows 上安装标准 Unix 工具链，包括 gcc、make、flex、bison 和所有其他 Unix 好东西。有 scons 和 cmake 的本机版本，但它们会尝试使用 VS，所以这对你没有帮助。我没有尝试通过 Cygwin 安装它们以查看是否会强制它们使用 gcc，但这可能与您无关。

创建一个使用 VS 编译器的 make 系统是可能的，但很痛苦（去过那里，做过那个）。还有一个不同的问题。;)

然后，您可以使用特殊的构建步骤从 VS 内部运行 gcc 编译。最好有一个单独的构建目标（如调试和发布），您可以在项目文件中创建它们（它们只是 ASCII 文件，检查它们），但我还不够 VS 人知道这将是多么容易。保持最新会有点痛苦，您可能需要编写一个脚本来自动创建它。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-16T06:54:41.710

当然有办法做到这一点——这就是我们使用索尼的工具链（基于 gcc）为 PS3 开发的方式。我不知道它是如何工作的，但它可以无缝地集成到 VS 中。

我认为您需要做的是将其设置为使用 makefile 构建（可能是最简单的），或者编写一个将 VC 参数转换为 gcc 参数的包装程序。此外，如果您想要 VS 格式的错误/警告输出（因此您可以单击它并在编辑器中获取该文件/行），您需要一些东西来转换输出。

这些东西可以帮助您在有关将 VS 与 WRS/VxWorks 版本的 gcc 工具一起使用[的相关讨论中：](http://www.xs4all.nl/~borkhuis/vxworks/vxw_pt1.html#1.13)

特别注意[那里链接的程序，](http://www.xs4all.nl/~borkhuis/vxworks/gnu2msdev.cpp)它转换错误输出。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-15T13:39:09.810

我必须维护单独的 makefile 以使用 gcc 进行编译。学习 make 会产生前期成本，但您将受益于对代码的深入了解以及 VS C++ 和 gcc 之间的差异。当我这样做时，我使用的是 VC 6，所以现在使用 VS 2005 可能有更好的方法。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-15T13:43:48.893

试试 Cygwin，只要你正确设置了所有的 Makefile，你总是可以尝试在 VS 和 GCC 上编译

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-15T16:07:34.913

这取决于您的项目文件的复杂程度：

你肯定需要像 cygwin 这样的 gcc 环境。

*   对于小型项目或单个文件编译，您可以使用自定义构建工具（规则文件）

*   对于大型项目/解决方案，我从 vcproj/sln 文件自动生成一个 autotools 配置/makefile 并在 IDE 中编译它。gcc 的源文件/警告和错误行被转换为它们的 IDE 等效项（可在输出窗口中单击）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-16T16:44:16.580

大概您已经在使用 makefile 来构建您的项目，因为它是跨平台的。只需将您的 VS 项目设置为具有不同项目配置的 makefile 项目，这些项目配置会使用不同的参数来启动 makefile，以指示构建是用于 MSVC 还是 GCC。

如果您的 MSVC makefile 构建能够构建调试文件 (PDB) - 它应该能够做到，那么 VS 调试器也将无缝工作。

然后在 Visual Studio 中使用 GCC 构建就像选择工具栏上的“GCC”配置下拉菜单一样简单。

# optimization - 进程与线程

> ID：62921
> 
> 赞同：24
> 
> 时间：2008-09-15T13:35:54.920
> 
> 标签：optimization, operating-system

如何决定是使用线程还是在应用程序中完全创建单独的进程来实现并行性。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-09-15T13:43:41.173

线程的重量更轻，为了让几个“工人”只是为了利用所有可用的 CPU 或内核，你最好使用线程。

当您需要工作人员更好地隔离和更健壮时，就像大多数服务器一样，请使用套接字。当一个线程严重崩溃时，它通常会关闭整个进程，包括在该进程中工作的其他线程。如果一个进程变坏并死掉，它不会触及任何其他进程，所以他们可以愉快地继续他们的业务，就像什么都没发生一样。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-15T14:40:56.603

进程有更多的独立内存。这很重要，原因有很多：

*   单个任务更难使其他任务崩溃。
*   每个进程将有更多内存可用。这对于像 Apache 这样的大型高性能应用程序或像 Postgres 这样的数据库服务器很重要。这对于分配的内存和内存映射文件都很重要。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-15T13:40:35.890

并行度主要取决于您机器上可用的物理处理器/内核。如果您有一台单处理器/核心机器，那么拥有单独的进程可能会导致过多的开销。在这种情况下，通常首选线程。

如果您有多个内核/CPU，则取决于每个进程/线程的功能，如果开销合理，您可以选择进程。进程显然比线程具有更好的内存隔离级别 - 但同时在 Windows 中，与线程相比，进程相当繁重。

线程当然可以在同一个进程中共享数据——但同样你需要同步对共享数据的访问——以防止损坏状态。在进程之间共享数据涉及更多，开销（比简单的线程同步更大）取决于使用的机制，例如命名管道、基于自定义套接字的通信、使用远程框架、共享文件/数据库等。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-15T13:38:59.780

通常，当各个执行流不需要共享全局数据并且您希望每个执行流相互保护时，您应该使用进程。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-15T13:41:58.853

我希望有几个链接可以帮助您做出决定：

~~[http://blog.labnotes.org/2006/08/29/why-processes-scale-better-than-threads/](http://blog.labnotes.org/2006/08/29/why-processes-scale-better-than-threads/)~~ [http://www.jroller.com/cpurdy/entry/fastcgi_not_so_fast](http://www.jroller.com/cpurdy/entry/fastcgi_not_so_fast)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-15T13:41:31.677

在 Windows 中，创建进程比创建线程要重。因此，如果您有几个较小的任务，线程或线程池会更好。或者使用进程池来回收进程。在进程之间共享状态也比在线程之间共享状态更多的工作。但话又说回来：线程可能会破坏整个进程的稳定性，从而导致其他线程停止运行。如果您想尽量减少发生这种情况的机会，您可以选择单独的流程。.Net 的 AppDomains 可能是两者之间的中间地带。

# database - 使用 Firebird 识别线程中的死锁

> ID：62923
> 
> 赞同：1
> 
> 时间：2008-09-15T13:36:02.783
> 
> 标签：database, multithreading, deadlock, firebird, pool

开发人员正在寻找最佳方法来识别特定线程内特定事务的死锁。我们遇到了死锁错误，但这些在 FB 2.0 中非常普遍

发生死锁，它们导致客户端和数据库之间的数据库连接中断。

*   我们将实时（每秒一次）数据发送到数据库。
*   我们打开一个由大约 30 个线程组成的线程池，并使用它们来摄取数据（大约每秒 1-2 kB）。
*   有时数据库只能占用这么多，以至于我们使用池中的下一个线程来尽可能保持流最新。

除了达到最大线程数和中断连接之外，有时这会产生死锁。

因此，我们真的需要就这是否是每秒摄取这么多数据的最佳方法提出意见。我们有多达 100 个这些客户端同时访问数据库。
平均每天的交易量约为 1.5 到 180 万笔。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-15T14:41:41.953

在 Firebird 2.1 中，有针对表、连接和事务的新监控功能，也许可以帮助您（如果您可以升级）。请参阅 README.monitoring_tables.txt。

例如，获取活动语句：

```
SELECT ATT.MON$USER, ATT.MON$REMOTE_ADDRESS, STMT.MON$SQL_TEXT, STMT.MON$TIMESTAMP
FROM MON$ATTACHMENTS ATT 
JOIN MON$STATEMENTS STMT ON ATT.MON$ATTACHMENT_ID = STMT.MON$ATTACHMENT_ID
WHERE ATT.MON$ATTACHMENT_ID <> CURRENT_CONNECTION AND STMT.MON$STATE = 1 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-15T13:48:26.903

我不知道识别特定线程或语句的特定方法。我不得不多次处理 FB 死锁。您可能有两个头试图更新某个表中的同一行，但它们是在单独的事务中进行的。

我发现最好的解决方案是设计一些东西，这样线程就不必更新任何其他线程可能更新的行。有时这意味着拥有一个只存在用于更新公共表/行的线程。工作线程向该线程发送消息。（该消息可以通过另一个表完成。）

我们在该领域的许多系统中运行 FB，这些系统会生成交易（不是每天数百万），我们发现一旦设计正确，FB 就会坚如磐石。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-09-29T17:13:17.180

我的建议是编写一个 3 层应用程序，将对数据库的所有访问（插入）序列化到单个线程（其他线程只会在队列上堆叠数据）并使用 Firebird 嵌入式（这要快得多，因为它消除了 TCP/ IP 开销）。

除了避免死锁之外，这种方法还可以让您监控队列并查看系统如何应对负载。

# java - java.net.SocketException：连接重置

> ID：62929
> 
> 赞同：156
> 
> 时间：2008-09-15T13:36:42.890
> 
> 标签：java, sockets, networking, connection, socketexception

我在尝试从套接字读取时收到以下错误。我正在做一个`readInt()`，`InputStream`我收到了这个错误。仔细阅读文档，这表明连接的客户端部分关闭了连接。在这种情况下，我是服务器。

我可以访问客户端日志文件并且它没有关闭连接，实际上它的日志文件表明我正在关闭连接。那么有人知道为什么会这样吗？还有什么要检查的？当当地资源可能达到阈值时，是否会出现这种情况？

* * *

我确实注意到我有以下行：

```
socket.setSoTimeout(10000); 
```

就在`readInt()`. 这是有原因的（长篇故事），但只是好奇，是否存在可能导致指示错误的情况？我在我的 IDE 中运行服务器，我碰巧让我的 IDE 卡在断点上，然后我注意到完全相同的错误开始出现在我自己的 IDE 日志中。

无论如何，只是提一下，希望不是红鲱鱼。:-(

* * *

## 回答 #1

> 赞同：130
> 
> 时间：2010-11-29T04:11:56.193

有几个可能的原因。

1.  另一端故意重置连接，我不会在这里记录。应用软件很少这样做，而且通常是不正确的，但对于商业软件来说并不陌生。

2.  更常见的情况是，写入连接的另一端已经正常关闭。换句话说，应用程序协议错误。

3.  当套接字接收缓冲区中有未读数据时关闭套接字也可能导致此问题。

4.  在 Windows 中，“软件导致连接中止”与“连接重置”不同，是由您端发送的网络问题引起的。有一篇关于此的 Microsoft 知识库文章。

* * *

## 回答 #2

> 赞同：59
> 
> 时间：2008-09-15T14:03:55.430

连接重置仅仅意味着收到了 TCP RST。当您的对等方接收到它无法处理的数据时，就会发生这种情况，这可能有多种原因。

最简单的方法是关闭套接字，然后在输出流上写入更多数据。通过关闭套接字，您告诉您的对等方您已完成通话，它可以忘记您的连接。无论如何，当您在该流上发送更多数据时，对等方会使用 RST 拒绝它，让您知道它没有在监听。

在其他情况下，干预防火墙甚至远程主机本身可能会“忘记”您的 TCP 连接。如果您长时间不发送任何数据（2 小时是常见的超时），或者因为对等方重新启动并丢失了有关活动连接的信息，则可能会发生这种情况。在这些失效连接之一上发送数据也会导致 RST。

* * *

*更新以响应其他信息：*

仔细看看你对`SocketTimeoutException`. 如果在套接字操作上阻塞时超过了配置的超时，则会引发此异常。抛出此异常时，套接字本身的状态不会改变，但如果您的异常处理程序关闭套接字，然后尝试写入它，您将处于连接重置状态。`setSoTimeout()`旨在为您提供一种干净的方法来摆脱`read()`可能会永远阻塞的操作，而无需执行诸如从另一个线程关闭套接字之类的肮脏事情。

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2008-09-15T13:45:06.427

每当我遇到类似这样的奇怪问题时，我通常会使用[WireShark](http://www.wireshark.org/)之类的工具坐下来查看来回传递的原始数据。您可能会对断开连接的地方感到惊讶，并且只有在您尝试阅读时才会*收到通知。*

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2015-07-31T08:20:59.590

你应该非常仔细地检查完整的痕迹，

我有一个服务器套接字应用程序并修复了一个`java.net.SocketException: Connection reset`案例。

`Socket`在我的情况下，它发生在从由于某种原因关闭其连接的 clientSocket 对象中读取。（网络丢失、防火墙或应用程序崩溃或有意关闭）

实际上，当我从这个 Socket 对象读取时出错时，我正在重新建立连接。

```
Socket clientSocket = ServerSocket.accept();
is = new BufferedReader(new InputStreamReader(clientSocket.getInputStream()));
int readed = is.read(); // WHERE ERROR STARTS !!! 
```

有趣的是`for my JAVA Socket`，如果客户端连接到我`ServerSocket`的连接并关闭其连接而不发送任何内容`is.read()`，则会被重复调用。似乎是因为在无限循环中从该套接字读取，您尝试从关闭的连接中读取。如果您使用类似下面的内容进行读取操作；

```
while(true)
{
  Receive();
} 
```

然后你会得到一个类似下面的stackTrace

```
java.net.SocketException: Socket is closed
    at java.net.ServerSocket.accept(ServerSocket.java:494) 
```

我所做的只是关闭 ServerSocket 并更新我的连接并等待进一步的传入客户端连接

```
String Receive() throws Exception
{
try {                   
            int readed = is.read();
           ....
}catch(Exception e)
{
        tryReConnect();
        logit(); //etc
}

//...
} 
```

这为未知的客户端套接字丢失重新建立了我的连接

```
private void tryReConnect()
        {
            try
            {
                ServerSocket.close();
                //empty my old lost connection and let it get by garbage col. immediately 
                clientSocket=null;
                System.gc();
                //Wait a new client Socket connection and address this to my local variable
                clientSocket= ServerSocket.accept(); // Waiting for another Connection
                System.out.println("Connection established...");
            }catch (Exception e) {
                String message="ReConnect not successful "+e.getMessage();
                logit();//etc...
            }
        } 
```

我找不到另一种方法，因为正如您从下图中看到的那样，如果没有 a，您将无法理解连接是否丢失`try and catch`，因为一切似乎都是正确的。`Connection reset`我在连续拍摄时得到了这张快照。

[![在此处输入图像描述](https://i.stack.imgur.com/T75Ul.png)](https://i.stack.imgur.com/T75Ul.png)

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2013-07-23T17:10:23.417

说起来很尴尬，但是当我遇到这个问题时，我在读取所有数据之前关闭连接简直是一个错误。在返回小字符串的情况下，它可以工作，但这可能是因为在我关闭它之前整个响应都被缓冲了。

在返回大量文本的情况下，将引发异常，因为返回的缓冲区更多。

你可能会检查这个疏忽。记住打开一个 URL 就像一个文件，一旦它被完全读取，一定要关闭它（释放连接）。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2011-03-27T20:30:13.277

我有同样的错误。我现在找到了问题的解决方案。问题是客户端程序在服务器读取流之前完成。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2015-05-08T12:24:18.987

我在使用 Java 编写的 SOA 系统时遇到了这个问题。我在不同的物理机器上同时运行客户端和服务器，它们工作了很长时间，然后那些讨厌的连接重置出现在客户端日志中，服务器日志中没有任何奇怪的东西。重新启动客户端和服务器并没有解决问题。最后我们发现服务器端的堆已经满了，所以我们增加了 JVM 可用的内存：问题解决了！请注意，日志中没有 OutOfMemoryError：内存只是稀缺，没有耗尽。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2019-08-15T20:13:13.483

检查服务器的 Java 版本。发生在我身上是因为我的 Weblogic 10.3.6 在 TLSv1 上的 JDK 1.7.0_75 上。我尝试使用的其余端点正在关闭 TLSv1.2 以下的任何内容。

默认情况下，Weblogic 试图协商最强的共享协议。在此处查看详细信息：[为 HTTPS 连接设置 https.protocols 系统属性的问题](https://stackoverflow.com/questions/34283829/issues-with-setting-https-protocols-system-property-for-https-connections)。

我添加了详细的 SSL 日志记录来识别支持的 TLS。这表明 TLSv1 正在用于握手。
`-Djavax.net.debug=ssl:handshake:verbose:keymanager:trustmanager -Djava.security.debug=access:stack`

我通过将该功能推送到与 JDK8 兼容的产品中解决了这个问题，JDK8 默认为 TLSv1.2。对于那些仅限于 JDK7 的用户，我还通过升级到 TLSv1.2 成功测试了 Java 7 的解决方法。我使用了这个答案：[How to enable TLS 1.2 in Java 7](https://stackoverflow.com/questions/39157422/how-to-enable-tls-1-2-in-java-7)

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2014-07-10T16:07:53.260

我也遇到了一个 Java 程序试图通过 SSH 在服务器上发送命令的问题。问题在于执行 Java 代码的机器。它没有连接到远程服务器的权限。write() 方法运行良好，但 read() 方法抛出 java.net.SocketException: Connection reset。我通过将客户端 SSH 密钥添加到远程服务器已知密钥来解决此问题。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2021-07-22T07:18:07.703

在我的情况下是`DNS problem`.
我输入`host file`了解析的IP，一切正常。当然，这不是一个永久的解决方案，这让我有时间解决 DNS 问题。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2020-06-05T14:00:44.827

根据我的经验，我经常会遇到以下情况；

1.  如果您在公司公司工作，请联系网络和安全团队。因为在向外部服务发出的请求中，可能需要**授予相关端点的权限。**

2.  另一个问题是运行应用程序的服务器上的**SSL 证书可能已过期。**

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2022-02-22T19:39:35.233

就我而言，这是 TSL 版本的问题。我正在使用带有 OkHttp 客户端的 Retrofit，在服务器端更新 ALB 后，我应该使用**connectionSpecs**删除我的配置：

```
OkHttpClient.Builder clientBuilder = new OkHttpClient.Builder();
        List<ConnectionSpec> connectionSpecs = new ArrayList<>();
        connectionSpecs.add(ConnectionSpec.COMPATIBLE_TLS);
  //      clientBuilder.connectionSpecs(connectionSpecs); 
```

因此，请尝试删除或添加此配置以使用不同的 TSL 配置。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2021-07-22T16:18:14.460

我已经看到了这个问题。就我而言，在特定 Java 类中重用相同的 ClientRequest 对象会导致错误。该项目正在使用[Jboss Resteasy](https://docs.jboss.org/resteasy/docs/3.0.13.Final/javadocs/org/jboss/resteasy/client/ClientRequest.html)。

1.  最初只有一种方法是使用/调用对象 ClientRequest（作为类中的全局变量放置）在特定 URL 中执行请求。
2.  之后，创建了另一种方法来使用另一个 URL 获取数据，但重用了相同的 ClientRequest 对象。

**解决方案：在同一个类中创建了另一个 ClientRequest 对象，并且专门不被重用。**

# c# - 有没有人使用 Hessian 二进制远程协议来桥接使用 Java 和 .NET 的应用程序？

> ID：62932
> 
> 赞同：3
> 
> 时间：2008-09-15T13:37:19.410
> 
> 标签：c#, java, .net, serialization, remoting

[Hessian](http://hessian.caucho.com)是一种自定义二进制序列化协议（我认为它是开源的），它构成了二进制跨平台远程处理框架的基础。我想知道这里是否有人使用过它，如果是这样，我们可以从一种将 Java 应用程序与 C# 应用程序连接起来的解决方案获得什么样的性能。（假设我们正在序列化简单类，可能是简单类的数组、列表、字典。）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-15T21:49:39.693

你看过 HessianC# 项目（[http://www.hessiancsharp.org/](http://www.hessiancsharp.org/)）吗？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-10-31T20:17:23.407

我是[jni4net](http://jni4net.sf.net/)的作者，它是 JVM 和 CLR 之间的开源进程内桥梁。它建立在 JNI 和 PInvoke 之上。不需要 C/C++ 代码，它应该相对较快。我不确定跨边界通过引用编组是否可以解决您的问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-15T19:16:47.033

这就是 Web 服务旨在解决的问题。虽然不再简单，但 SOAP 格式允许您在 Java/C# 应用程序上将对象序列化为 XML 表示，通过网络传输它们并在相应的 Java/C# 应用程序中反序列化它们（Java/C# 几乎可以替换为任何语言可以翻译 XML 文档）。虽然这里使用了“serialize”，但这个过程也被称为“marshalling”也很常见。

然而，许多人目前正在考虑从 SOAP 转向 Web 服务。从 Wikipedia 了解有关 Web 服务的更多信息：[http ://en.wikipedia.org/wiki/Web_services](http://en.wikipedia.org/wiki/Web_services)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-10-14T00:54:55.930

承认“Soap 被过度设计”，然后赞扬一个未设计/抽象它的实现，就像我用法语写这篇文章，然后要求你使用谷歌翻译来阅读它，然后用英语赞美谷歌翻译。

二进制协议是未来的方式。如果您准备编写“智能”代码，当它完全按照编程和开发的方式执行时，您会感谢自己。

只需要一个潜在的 Soap 服务即可将您的 SOA 架构带入“异常”模式……我将其称为“异常”模式，因为在 SOA 中实现 SOA 的公司（阅读：XML）在遇到 SOA 时会围绕 SOA 实施异常一种事务类型的数据交换，其中可以连续读取非常大的记录。

*（我可以想象正在进行的 SOAP 实施后对话）

那么你有 SOA 吗？: 是的，我们什么都做？: 好吧，除了我们的关键业务运输之外的一切......

在您使用 WSO2 网络服务和他们的 ESB 时检查一下 - 如果您这样做了，您会再次感谢自己。Mule 是有原因的，然后 WSO2 提供了对 HESSIAN 的支持。您可能还想阅读：http: [//java.sun.com/developer/technicalArticles/WebServices/fastWS/](http://java.sun.com/developer/technicalArticles/WebServices/fastWS/)

# linux - 手册页中 Unix 命令名称后括号中的数字是什么意思？

> ID：62936
> 
> 赞同：595
> 
> 时间：2008-09-15T13:37:47.130
> 
> 标签：linux, unix, command-line, manpage

例如：`man(1)`, `find(3)`, `updatedb(2)`?

括号中的数字（英国“方括号”）是什么意思？

* * *

## 回答 #1

> 赞同：578
> 
> 时间：2008-09-15T13:42:31.707

这是命令的手册页分配到的部分。

这些被拆分为

1.  一般命令
2.  系统调用
3.  C 库函数
4.  特殊文件（通常是设备，位于 /dev 中的那些）和驱动程序
5.  文件格式和约定
6.  游戏和屏保
7.  杂项
8.  系统管理命令和守护进程

每个部分的原始描述可以在[Unix 程序员手册](https://web.archive.org/web/20170601064537/http://plan9.bell-labs.com/7thEdMan/v7vol1.pdf)（第 ii 页）中看到。

为了访问以“foo(5)”给出的手册页，运行：

```
man 5 foo 
```

* * *

## 回答 #2

> 赞同：92
> 
> 时间：2008-09-15T13:39:03.367

该命令的部分记录在手册中。章节列表记录在手册中。例如：

```
man 1 man
man 3 find 
```

当不同部分存在相似或完全相同的命令时，这很有用

* * *

## 回答 #3

> 赞同：57
> 
> 时间：2008-09-15T14:11:22.150

部分数量之所以重要，是因为很多年前，当磁盘空间比现在更重要时，这些部分可以单独安装。

例如，许多系统只安装了 1 和 8。这些天来，人们倾向于在谷歌上查找命令。

* * *

## 回答 #4

> 赞同：25
> 
> 时间：2019-10-22T02:14:00.463

正如[@Ian G 所说](https://stackoverflow.com/a/62972/4561887)，它们是手册页部分。让我们更进一步：

## 1\. 查看带有 的`man`命令的手册页`man man`，它显示了 9 个部分，如下所示：

```
DESCRIPTION
       man  is  the system's manual pager. Each page argument given
       to man is normally the name of a program, utility  or  func‐
       tion.   The  manual page associated with each of these argu‐
       ments is then found and displayed. A section,  if  provided,
       will  direct man to look only in that section of the manual.
       The default action is to search in all of the available sec‐
       tions following a pre-defined order ("1 n l 8 3 2 3posix 3pm
       3perl 5 4 9 6 7" by default, unless overridden by  the  SEC‐
       TION directive in /etc/manpath.config), and to show only the
       first page found, even if page exists in several sections.

       The table below shows the section numbers of the manual fol‐
       lowed by the types of pages they contain.

       1   Executable programs or shell commands
       2   System calls (functions provided by the kernel)
       3   Library calls (functions within program libraries)
       4   Special files (usually found in /dev)
       5   File formats and conventions eg /etc/passwd
       6   Games
       7   Miscellaneous  (including  macro  packages  and  conven‐
           tions), e.g. man(7), groff(7)
       8   System administration commands (usually only for root)
       9   Kernel routines [Non standard]

       A manual page consists of several sections. 
```

## 2.`man <section_num> <cmd>`

假设您正在谷歌搜索 Linux 命令。您可以在网上找到`OPEN(2)`pg：[open(2) — Linux 手册页](http://man7.org/linux/man-pages/man2/open.2.html)。

要在 PC 的手册页中查看此内容，只需输入`man 2 open`.

供[`FOPEN(3)`](http://man7.org/linux/man-pages/man3/fopen.3.html)使用`man 3 fopen`等。

## 3.`man <section_num> intro`

要阅读某个部分的介绍页面，请输入`man <section_num> intro`，例如`man 1 intro`、`man 2 intro`、`man 7 intro`等。

要一个接一个地查看所有手册页介绍，请执行`man -a intro`. 第 1 部分的介绍页面将打开。按`q`退出，然后按`Enter`查看第 8 节的介绍。按`q`退出，然后按`Enter`查看第 3 节的介绍。继续此过程，直到完成。每次点击 后`q`，它都会带您回到主终端屏幕，但您仍将处于交互式提示中，您将看到以下行：

```
--Man-- next: intro(8) [ view (return) | skip (Ctrl-D) | quit (Ctrl-C) ] 
```

请注意，`man -a intro`将带您完成的部分顺序是：

1.  第 1 节
2.  第 8 节
3.  第 3 节
4.  第 2 节
5.  第 5 节
6.  第 4 节
7.  第 6 节
8.  第 7 节

此搜索顺序是有意的，如`man man`页面所述：

```
The default action is to search in all of the available sections follow‐
ing a pre-defined order ("1 n l 8 3 2 3posix 3pm 3perl 5 4 9 6 7" by default, unless overrid‐
den  by the SECTION directive in /etc/manpath.config) 
```

他们为什么选择这个订单？我不知道（如果你知道，请在评论中回答），但只要意识到这个顺序是正确和有意的。

## 有关的：

1.  [Google 搜索“linux 函数后括号中的数字是什么意思？”](https://www.google.com/search?q=linux+what+does+the+number+mean+in+parenthesis+after+a+function%3F&oq=linux+what+does+the+number+mean+in+parenthesis+after+a+function%3F&aqs=chrome..69i57j69i64.9867j0j7&sourceid=chrome&ie=UTF-8)
2.  [超级用户：Unix 命令或 C 函数后面的括号和数字是什么意思？](https://superuser.com/questions/297702/what-do-the-parentheses-and-number-after-a-unix-command-or-c-function-mean)
3.  [Unix & Linux：手册页中的数字是什么意思？](https://unix.stackexchange.com/questions/3586/what-do-the-numbers-in-a-man-page-mean)

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2008-09-15T13:57:19.033

另请注意，在其他 unix 上，指定节的方法不同。例如，在 solaris 上，它是：

```
man -s 1 man 
```

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2008-09-15T13:44:25.743

它指示找到该命令的手册页部分。man 命令上的 -s 开关可用于将搜索限制在某些部分。

当您查看手册页时，左上角会给出该部分的名称，例如：

用户命令 printf(1)
标准 C 库函数 printf(3C)

因此，如果您尝试查找 C 函数并且不想意外看到共享相同名称的用户命令的页面，您可以执行 'man -s 3C ...'

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-03-04T01:09:43.207

有关手册部分的[维基百科详细信息：](http://en.wikipedia.org/wiki/Man_page#Manual_sections)

1.  一般命令
2.  系统调用
3.  库函数，尤其是 C 标准库
4.  特殊文件（通常是设备，位于 /dev 中的那些）和驱动程序
5.  文件格式和约定
6.  游戏和屏保
7.  杂项
8.  系统管理命令和守护进程

# .net - 如何在 .NET 表单上获得自动滚动文本显示 - 例如用于学分

> ID：62940
> 
> 赞同：1
> 
> 时间：2008-09-15T13:38:13.683
> 
> 标签：.net, winforms, scroll, textbox

需要显示一个信用屏幕，我想在其中感谢我的应用程序的许多贡献者。

希望它是一个自动滚动的框，就像电影结尾的演职员表滚动一样。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-15T13:45:42.260

一个易于使用的片段是制作一个多行文本框。使用计时器，您可以逐行插入，然后滚动到末尾：

```
textbox1.SelectionStart = textbox1.Text.Length;
textbox1.ScrollToCaret();
textbox1.Refresh(); 
```

不是最好的方法，但它简单且有效。还有一些免费控件可用于这种自动滚动。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-15T13:43:17.303

一个快速而肮脏的方法是使用一个面板，上面有一个长长的标签控件列表，列出了各种人和贡献。然后您需要将面板设置为 AutoScroll，以便它具有垂直滚动条，因为标签列表超出了显示面板的底部。然后添加一个时间，在每个计时器滴答声中将 AutoScrollOffset 更新 1 个垂直像素。当你到达底部时，将偏移量重置为 0 并继续。唯一的缺点是显示的垂直滚动条。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-15T13:51:13.103

嵌入一​​个 WebBrowser 控件，并使用这样的[技术](https://web.archive.org/web/1/http://articles.techrepublic%2ecom%2ecom/5100-22_11-5076826.html)对您选择的 HTML 内容进行一些 javascript 滚动。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-15T13:52:06.317

如果您使用的是 .NET 表单，则只需轻弹 HTML 视图并使用 marquee html 元素：

[http://www.htmlcodetutorial.com/_MARQUEE.html](http://www.htmlcodetutorial.com/_MARQUEE.html)

老实说，它不是很好，我不会将它用于商业工作，因为它可能会让人觉得有点俗气——主要是因为过去它在很多糟糕的网站上被过度使用。但是，它可能只是快速解决您的问题。

另一种选择是使用 Scriptaculous JavaScript 库的一些功能：

[http://script.aculo.us/](http://script.aculo.us/)

它具有许多用于移动文本的功能，并且功能更强大。

# c - 嵌入式软件的 Misra 标准

> ID：62946
> 
> 赞同：12
> 
> 时间：2008-09-15T13:39:28.373
> 
> 标签：c, code-analysis, embedded, misra

我需要使大量代码符合 MISRA。
第一个问题：有人可以根据经验对通过嵌入式系统编写良好的代码进行**估计。**我知道“写得好”的定义不明确且含糊不清，因此我要求进行原始估计。
第二个问题：对可定制（即允许抑制特定警告）并用于自动构建环境（即命令行界面）的工具的
任何建议 任何其他有助于完成此任务的有用建议。
谢谢伊利亚。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-09-15T15:11:25.610

我也强烈推荐 PC-Lint。如果您碰巧使用 Visual Studio 编译代码，我推荐 Riverblade 的插件“Visual Lint”。如果您无法在 Visual Studio 中编译代码，您仍然可以在命令行中运行 PC-Lint 以获得良好效果。

一些嵌入式系统编译器提供 MISRA 合规性测试作为编译器警告。我使用 IAR 编译器进行 Arm7/Arm9 开发。它在编译器设置中提供了一个易于配置的 MISRA 合规性检查表。

很难想出一个经验法则来估计使一些编写良好的代码符合 MISRA 所需的时间。很大程度上取决于程序员现有的编码习惯以及他们首先遵循 MISRA 规则的程度。

粗略估计：
熟练使用 PC-Lint 需要 2 - 3 天。
使现有代码符合 MISRA 的初步阶段：首先花费 10% 到 25% 的时间编写代码。
保持代码符合 MISRA：代码开发增加了 5% 到 10%。其中一半的成本是改变编码人员的习惯以遵循“MISRA 方式”做事。另一半是代码测试和检查的额外成本，以确保符合 MISRA。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-15T13:55:23.250

如果您遵循相当好的编程实践，则使代码符合 Misra 并不是一件苦差事。你可能会发现一些指针规则有点棘手，如果你试图使遵守的代码有一些奇怪而美妙的指针算法。

我对 Greg 对 PC Lint 的推荐第二，但开源 Splint 也值得一看，尽管在它们（和编译器的警告系统）之间，我估计你仍然只能涵盖 80% 的 Misra 规则- 其余的可能需要手动审查代码。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-15T13:47:16.080

我使用 PC Lint 对 C 和 C++ 代码进行静态分析。它可以配置为显示违反了哪些 MISRA 规则，并且它具有命令行界面。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-15T23:19:53.330

我使用了一个名为[QAC](http://www.programmingresearch.com/QAC_MAIN.html)的商业工具。该工具能够执行[MISRA](http://www.programmingresearch.com/QAMISRA.html)

它有一个命令行界面，因此您可以将其设置为从自动构建环境运行。要应用的规则是可配置的，但希望有人花一些时间来设置它。MISRA 的执行非常简单，并且运行良好。有人告诉我（这只是第三手），这是一些机构（例如 FDA）用来评估代码的工具之一。像大多数静态分析工具一样，需要处理噪声（误报）。我上次使用它时，它没有很好的方法来标记/阻止误报再次发生（不更改它抱怨的代码）。

我怀疑初级工程师最多需要一周（4-5 天）来设置它（假设他们决心让它按你的意愿工作）。

另一方面，其他商业静态分析工具也可能执行 MISRA。据报道（根据他们的销售代表），[Klocwork](http://www.klocwork.com/company/releases/KlocworkDebutsSourceCodeCheckerCommunity.asp)确实如此。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-11-10T11:19:12.487

我们在改造 Misra 规则时遇到了类似的问题。我们在一个大型项目中遇到了一些代码质量问题，并决定使用 MISRA 来提高代码质量。

我们使用支持 MISRA C 规则的 Green Hills 编译器。也有独立的检查器可用。根据您想要执行的操作，打开所有规则可能有点过头了。我们一次打开一个规则，让人们有时间解决有限数量的类似问题，否则你会完全被错误的数量所淹没。

由于我们的警告是由编译器而不是由独立工具生成的，因此您在开发时会看到错误，而不仅仅是在运行检查器时。随着我们继续开发，我们的代码符合要求，而不是一蹴而就。这也可以防止旧习惯破坏新代码，导致您以后不得不再次修改代码。

有时很难使旧代码兼容，因为没有人确切知道代码是如何工作的。我希望你有单元测试。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-08-28T13:19:10.787

我很欣赏这是一个老问题，但为了任何其他考古学家（或搜索者）的利益，重要的是要记住 MISRA 提供的**指导方针**不应总是盲目遵循。

我建议在编写新代码时考虑 MISRA；因此，保持合规性会容易得多。

但是，这并不总是可行的——尤其是在尝试对代码进行逆向工程以符合准则时。在这种情况下，我建议您专注于必需的规则，并将咨询视为奖励......成本v收益也适用于此！

另外，请记住存在偏差过程 - 最好保持干净和可维护的代码有偏差，而不是设计一些合规但难以辨认的意大利面条。

# c# - 跨 NUnit 版本实现 CollectionConstraints

> ID：62951
> 
> 赞同：0
> 
> 时间：2008-09-15T13:40:21.727
> 
> 标签：c#, nunit

我们`CollectionConstraint`在 C# 版本 2.4.3 中实现了一个 for Nunit。虽然我们的一些开发人员已经升级到 2.4.7 版本，但他们在编译时遇到项目创建错误。错误是

> doMatch：找不到合适的方法来覆盖

关于如何获得此约束以使其与版本无关的编译的任何建议？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-15T16:40:14.557

不幸的是，约束 API 在 2.4.6 中以不兼容的方式更改为自定义约束。NUnit 2.4.5 和更早的版本使用 IConstraint 接口，在 2.4.6 中它被更改为 Constraint 抽象基类。在 2.4.5 及更早版本中有一个可选的 Constraint 基类，但该类在版本之间并不一致。

因此，无法使编译后的 dll 与 NUnit 的两个版本一起工作。每个人都应该升级到相同版本的 NUnit。

抱歉，我确定这不是您要找的答案。

山姆

# linq - 如何将 Linq 扩展到 SQL？

> ID：62963
> 
> 赞同：13
> 
> 时间：2008-09-15T13:41:40.257
> 
> 标签：linq, linq-to-sql

去年，Scott Guthrie[表示](http://weblogs.asp.net/scottgu/archive/2007/07/31/linq-to-sql-debug-visualizer.aspx)“如果您想要对执行的 SQL 进行绝对控制，您实际上可以覆盖 LINQ to SQL 使用的原始 SQL”，但我找不到描述可扩展性方法的文档。

我想修改以下 LINQ to SQL 查询：

```
使用 (NorthwindContext 北风 = 新 NorthwindContext ()) {
    var q = from row in northwind.Customers
            让 orderCount = row.Orders.Count()
            选择新的{
                row.ContactName,
                订单数
            };
}
```

这导致以下 TSQL：

```
选择 [t0].[联系人姓名], (
    选择计数（*）
    FROM [dbo].[订单] AS [t1]
    WHERE [t1].[CustomerID] = [t0].[CustomerID]
    ) AS [orderCount]
FROM [dbo].[客户] AS [t0]
```

到：

```
使用 (NorthwindContext 北风 = 新 NorthwindContext ()) {
    var q = from row in northwind.Customers.With (
                        TableHint.NoLock, TableHint.Index (0))
            让 orderCount = row.Orders.With (
                        TableHint.HoldLock).Count()
            选择新的{
                row.ContactName,
                订单数
            };
}
```

这*将*导致以下 TSQL：

```
选择 [t0].[联系人姓名], (
    选择计数（*）
    FROM [dbo].[Orders] AS [t1] WITH (HOLDLOCK)
    WHERE [t1].[CustomerID] = [t0].[CustomerID]
    ) AS [orderCount]
FROM [dbo].[Customers] AS [t0] WITH (NOLOCK, INDEX(0))
```

使用：

```
公共静态表<TEntity> With<TEntity> (
    这个 Table<TEntity> 表，
    参数 TableHint[] args) 其中 TEntity : 类 {

    //TODO：实现
    返回表；
}
公共静态 EntitySet<TEntity> With<TEntity> (
    这个 EntitySet<TEntity> 实体集，
    参数 TableHint[] args) 其中 TEntity : 类 {

    //TODO：实现
    返回实体集；
}
```

和

```
公共类 TableHint {
    //TODO：实现
    公共静态 TableHint 无锁；
    公共静态 TableHint HoldLock；
    公共静态 TableHint 索引（int id）{
        返回空值；
    }
    公共静态 TableHint 索引（字符串名称）{
        返回空值；
    }
}
```

使用某种类型的 LINQ to SQL 可扩展性，除了[这个](http://blogs.msdn.com/mattwar/archive/2008/05/04/mocks-nix-an-extensible-linq-to-sql-datacontext.aspx)。有任何想法吗？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-15T23:42:05.320

更改底层提供程序并因此修改 SQL 的能力并未最终影响 LINQ to SQL。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2008-09-15T16:48:59.450

`DataContext x = new DataContext`

大概是这样的？

`var a = x.Where().with()`...ETC

它使您可以更好地控制 SQL。

# asp.net - ASP.NET WebService 在抛出异常时返回乱码

> ID：62965
> 
> 赞同：1
> 
> 时间：2008-09-15T13:41:56.870
> 
> 标签：asp.net, ajax, web-services, exception, encoding

我有一个 Web 服务 (ASMX)，其中有一个 Web 方法，它可以完成一些工作并在输入无效时抛出异常。

```
[ScriptMethod]
[WebMethod]
public string MyWebMethod(string input)
{
    string l_returnVal;

    if (!ValidInput(input))
    {
        string l_errMsg = System.Web.HttpUtility.HtmlEncode(GetErrorMessage());
        throw new Exception(l_errMsg);
    }

    // some work gets done...

    return System.Web.HttpUtility.HtmlEncode(l_returnVal);
} 
```

回到网页上的客户端 JavaScript，在错误回调函数上，我显示我的错误：

```
function GetInputErrorCallback(error)
{
    $get('input_error_msg_div').innerHTML = error.get_message();
} 
```

这很好用，当我的 Web 方法返回（一个字符串）时，它总是看起来很完美。但是，如果我抛出的异常中的一条错误消息包含特殊字符，则它在浏览器中显示不正确。例如，如果错误消息包含以下内容：

**该输入无效！** （那里有一个 ASCII #146）

它显示这个：

**该输入无效！**

或者：

**你喜欢 Hüsker Dü 吗？**（ASCII #252）

变成：

**你喜欢 Hüsker Dü 吗？**

错误消息的内容来自采用 UTF-8 编码的 XML 文件：

```
<?xml version="1.0" encoding="UTF-8"?>
<ErrorMessages>
   <Message id="invalid_input">Your input isn’t valid!</Message>
   .
   .
   .
</ErrorMessages> 
```

就页面编码而言，在我的 Web.config 中，我有：

```
<globalization enableClientBasedCulture="true" fileEncoding="utf-8" /> 
```

我还有一个 HTTP 模块来设置 L10n 参数：

```
Thread.CurrentThread.CurrentUICulture = m_selectedCulture;
Encoding l_Enc = Encoding.GetEncoding(m_selectedCulture.TextInfo.ANSICodePage);
HttpContext.Current.Response.ContentEncoding = l_Enc;
HttpContext.Current.Request.ContentEncoding = l_Enc; 
```

我试过禁用这个 HTTP 模块，但结果是一样的。

Web 服务返回的值（在 l_errMsg 变量中）在 VS 调试器中看起来很好。只是一旦客户端脚本持有，它就会显示不正确。我已经使用 Firebug 来查看响应，并且其中也有特殊字符被破坏。所以我觉得很奇怪，我的 web 方法返回的字符串看起来很好，即使其中有特殊字符。然而，当我从 web 方法中抛出异常时，其消息中的特殊字符是不正确的。我怎样才能解决这个问题？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-15T14:41:42.860

您确定设置“fileEncoding”是您想要的，而不是“responseEncoding”吗？设置 fileEncoding 决定了 Web 服务器在无法自动确定编码时如何尝试从磁盘读取物理 .asmx/.aspx 文件。因此，将此设置为“utf-8”意味着您必须将所有 .asmx/.aspx 文件保存为 utf-8。我不认为是相关的。

您看到的修改是当使用 8 位编码解析编码为 utf-8 的文本时（即使用 8 位解码器解码 utf-8 字节流，例如在您的情况下为 iso-8859-1 /Windows-1252)。因此，您在 throw() 处理异常之前所做的 HtmlEncode() 可能与预期的输出编码有关。那么如果你不 HtmlEncode() 错误信息会发生什么？

（从技术上讲，“ASCII # 252”不太正确；ASCII 有 128 个字符；您使用的撇号来自 8 位编码，例如在您的情况下为 iso-8859-1/Windows-1252。）

您确定您已正确禁用该 HTTP 模块吗？这条线看起来可能会导致问题：

```
HttpContext.Current.Response.ContentEncoding = l_Enc;
```

...因为它很可能将输出编码设置为 8 位编码（相当于 ANSI 代码页）。

**为了支持尽可能多的文化，您应该将响应编码设置为 utf-8。**这是浏览器中最受支持的 Unicode 格式（我敢说所有现代浏览器都支持它），而 Unicode 是本地编码的唯一替代方案。也就是说，我不完全了解您使用的是什么 HTTP 模块以及为什么需要它，因此情况可能比我想象的要复杂。

# c++ - 如何在 Windows 上编写 C++ FireFox 3 插件（不是扩展）？

> ID：62977
> 
> 赞同：9
> 
> 时间：2008-09-15T13:43:15.590
> 
> 标签：c++, windows, firefox, plugins

有人可以写出一步一步的指南来为 Windows 上的 FireFox 开发基于 C++ 的插件吗？

[http://www.mozilla.org/projects/plugins/](http://www.mozilla.org/projects/plugins/)上的链接和示例都是旧的且不准确的——“新”链接是在 2004 年添加到页面的。

这个例子可以是任何东西，但我在想一个让 JavaScript 设置名称然后显示“Hello {Name}”的插件。为了显示双向通信，它可以具有返回完整称呼的属性。

虽然不那么重要，但如果该插件也可以在 Chrome 中运行，那就太好了。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-12-20T07:38:18.147

如果您需要跨浏览器（firefox 和 ie）工作的东西，您可以查看 firebreath：[http ://www.firebreath.org](http://www.firebreath.org)

对于一般的“如何在 Windows 上构建 npapi 插件”信息，我有一些关于该主题的博客文章（也链接到上述一些来源）

[http://colonelpanic.net/2009/03/building-a-firefox-plugin-part-one/](http://colonelpanic.net/2009/03/building-a-firefox-plugin-part-one/)

然而，我真的推荐 firebreath，因为我们正是为那些没有时间进行数月（字面意思）研究的人创建的，我们花了几个月的时间才弄清楚它是如何工作的。但是，如果您不想将它用作插件的基础，您仍然可以在那里找到很多很好的示例代码。

也应该在 Windows 上的 chrome、firefox 和 safari 上工作！=]

祝你好运！

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-16T09:36:00.543

另请参阅[http://developer.mozilla.org/en/Plugins](http://developer.mozilla.org/en/Plugins)。是的，NPAPI 插件也应该在 Google Chrome 中工作。

[编辑 2015：Chrome 很快就会取消对 NPAPI 的支持[http://blog.chromium.org/2014/11/the-final-countdown-for-npapi.html](http://blog.chromium.org/2014/11/the-final-countdown-for-npapi.html) ]

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-16T03:48:35.387

使用 NPAPI 制作插件相当简单。Gecko 发行版中需要的关键头文件是 npapi.h 和 npupp.h。您将使用名称 NP_Initialize、NP_Shutdown、NP_GetMIMEDescription 和 NP_GetValue 从插件 DLL 或共享库中导出函数，并且您还需要使用所有 NPP 的处理程序填写 NP_Initialize 调用中提供给您的符号表职能。

从该集合中实现的关键函数是 NPP_New 和 NPP_Destroy。这些定义了插件实例的生命周期。如果您要处理从 <object> 或 <embed> 链接的媒体文件，您还需要处理 NPP_NewStream、NPP_WriteReady、NPP_Write 和 NPP_DestroyStream 作为插件从浏览器。[Gecko 插件开发者指南](http://developer.mozilla.org/en/Gecko_Plugin_API_Reference)中还有更多内容。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-06-30T19:31:20.233

查看 Nixysa [http://code.google.com/p/nixysa/](http://code.google.com/p/nixysa/)。我尝试在 Mozilla SDK 中构建示例，但构建起来很困难。Nixysa 示例很容易构建。加上代码比直接使用 NPAPI 更简洁。唯一的缺点是截至今天 Nixysa 没有很好的文档记录。我有一个 Nixysa 示例，可以根据需要实现回调（我确实计划在处理它时向 Nixysa 提交补丁）。

# c# - 在 C#/.NET3.5 中构造动态 sql 查询的最佳方式？

> ID：62987
> 
> 赞同：8
> 
> 时间：2008-09-15T13:44:19.173
> 
> 标签：c#, sql, sql-server, linq, .net-3.5

我目前正在进行的一个项目涉及重构一个 C# Com 对象，该对象用作某些 Sql 2005 数据库的数据库访问层。

现有代码的作者使用字符串和许多 if 语句手动构建了所有 sql 查询，以构建相当复杂的 sql 语句（~10 个连接，>10 个子选择，~15-25 个条件和 GroupBy）。基表始终是同一个，但连接、条件和分组的结构取决于传递给我的类/方法的一组参数。

像这样构建 sql 查询确实有效，但它显然不是一个非常优雅的解决方案（而且也很难阅读/理解和维护）......我可以自己编写一个简单的“querybuilder”，但我很确定我不是第一个遇到这种问题的人，因此我的问题是：

*   *您*如何构建数据库查询？
*   C# 是否提供了一种简单的方法来动态构建查询？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-15T15:05:20.477

我使用 C# 和 Linq 执行类似的操作，以根据用户输入过滤日志条目（请参阅[Conditional Linq Queries](https://stackoverflow.com/questions/11194/conditional-linq-queries)）：

```
IQueryable<Log> matches = m_Locator.Logs;

// Users filter
if (usersFilter)
    matches = matches.Where(l => l.UserName == comboBoxUsers.Text);

 // Severity filter
 if (severityFilter)
     matches = matches.Where(l => l.Severity == comboBoxSeverity.Text);

 Logs = (from log in matches
         orderby log.EventTime descending
         select log).ToList(); 
```

编辑：直到最后一条语句中的 .ToList() 才执行查询。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-15T20:18:27.790

除非执行时间真的很重要，否则我会考虑重构（经常）倾向于找到通往数据层并进入数以万计的存储过程的业务逻辑。在可维护性、可编辑性和可附加性方面，我总是尝试（作为 C# 程序员）将代码提升到业务层。

试图整理别人的 8000 行 SQL 脚本不是我最喜欢的任务。

:)

//W

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-15T13:46:43.647

[LINQ](http://www.google.com/search?q=dynamic+LINQ+tutorial)是要走的路。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-15T15:13:27.510

这就是我这样做的方式：

```
public IQueryable<ClientEntity> GetClients(Expression<Func<ClientModel, bool>> criteria)
    {
        return (
            from model in Context.Client.AsExpandable()
            where criteria.Invoke(model)
            select new Ibfx.AppServer.Imsdb.Entities.Client.ClientEntity()
            {
                Id = model.Id,
                ClientNumber = model.ClientNumber,
                NameFirst = model.NameFirst,
                //more propertie here

            }
        );
    } 
```

您传入的*Expression*参数将是您将使用不同的 WHERE 子句、JOINS 等构建的动态查询。此表达式将在运行时被*调用*并为您提供所需的内容。

这是如何调用它的示例：

```
public IQueryable<ClientEntity> GetClientsWithWebAccountId(int webAccountId)
    {
        var criteria = PredicateBuilder.True<ClientModel>();
        criteria = criteria.And(c => c.ClientWebAccount.WebAccountId.Equals(webAccountId));
        return GetClients(criteria);
    } 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-15T15:24:31.273

如果您可以将其实现为参数化存储过程并在数据库中对其进行优化，而不是在运行时通过 LINQ 或 ORM 动态生成 SQL，那么值得考虑。通常这会表现得更好。我知道它有点过时，但有时它是最有效的方法。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-15T23:06:17.903

我了解 Linq 的潜力，但我还没有看到有人尝试对 Ben 建议的复杂性进行 Linq 查询

> 相当复杂的 sql 语句（~10 个连接，>10 个子选择，~15-25 where 条件和 GroupBy's）

有没有人有大型 Linq 查询的示例，以及对其可管理性的任何评论？

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-16T06:32:03.230

Linq to SQL 与 System.Linq.Dynamic 一起带来了一些不错的可能性。

我在这里发布了几个示例代码片段：http: [//blog.huagati.com/res/index.php/2008/06/23/application-architecture-part-2-data-access-layer-dynamic-linq](http://blog.huagati.com/res/index.php/2008/06/23/application-architecture-part-2-data-access-layer-dynamic-linq)

...在这里： [http ://episteme.arstechnica.com/eve/forums/a/tpc/f/6330927813/m/717004553931?r=777003863931#777003863931](http://episteme.arstechnica.com/eve/forums/a/tpc/f/6330927813/m/717004553931?r=777003863931#777003863931)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-12-23T19:12:12.177

我来晚了，没有机会投票，但是有一个我没有考虑过的很好的解决方案：过程/函数与 linq-to-object 的组合。或者我想是 to-xml 或 to-datatable。

在这种情况下，我一直处于这种状态，使用大量动态构建的查询，这是一项令人印象深刻的成就，但其复杂性却成为维护的噩梦。我有这么多绿色评论来帮助后来不得不出现并理解它的可怜的树液。我使用的是经典的 asp，所以我几乎没有其他选择。

从那以后我所做的是结合了**function/procedure 和 linq**。通常*总*的复杂性小于尝试在一个地方做的复杂性。将您的一些标准传递给 UDF，这变得更易于管理。这为您提供了可管理且易于理解的结果集。使用 linq 应用您剩余的区别。

您可以利用两者的优点：

*   尽可能减少服务器上的总记录；在服务器上处理尽可能多的疯狂连接。数据库*擅长*这些东西。
*   Linq（对象等）没有那么强大，但擅长表达复杂的标准；因此，将它用于各种可能的区别，这些区别会增加代码的复杂性，但数据库在处理方面并不会更好。在简化的标准化结果集上运行，linq 可以表达复杂性而不会造成太多性能损失。

如何决定在数据库中处理哪些标准以及使用 linq 处理哪些标准？用你的判断。如果您可以有效地处理复杂的数据库查询，则可以处理。部分艺术，部分科学。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-15T13:47:02.367

您可能需要考虑 LINQ 或像这样的 O/R 映射器：[http ://www.llblgen.com/](http://www.llblgen.com/)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-15T15:38:48.947

如果使用 C# 和 .NET 3.5，再加上 MS SQL Server，那么 LINQ to SQL 绝对是要走的路。如果您使用的不是该组合，我建议您使用 ORM 路线，例如[nHibernate](http://sourceforge.net/projects/nhibernate)或[Subsonic](http://subsonicproject.com/)。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2011-01-28T01:45:34.677

[在http://www.blackbeltcoder.com/Articles/strings/a-sql-querybuilder-class](http://www.blackbeltcoder.com/Articles/strings/a-sql-querybuilder-class)的 QueryBuilder 类中有一种实验性尝试。也许值得一瞧。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2011-03-09T11:55:03.107

查看[http://sqlom.sourceforge.net](http://sqlom.sourceforge.net)。我认为它完全符合您的要求。

# asp.net - 在 ASP.Net 视图页面中访问全局 .resx 文件

> ID：62995
> 
> 赞同：2
> 
> 时间：2008-09-15T13:45:03.120
> 
> 标签：asp.net, localization, resources

我目前正在构建 .Net 框架的 3.5 版，并且我有一个资源 (.resx) 文件，我试图在 Web 应用程序中访问该文件。我已将 .resx 属性公开为公共访问修饰符，并且能够在控制器文件或 Web 应用程序中的其他 .cs 文件中访问这些属性。我的问题是：是否可以访问我的视图页面中的名称/值对？我想做这样的事情...

```
text="<%$ Resources: Namespace.ResourceFileName, NAME %>" 
```

或查看页面中的其他类似方法。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-15T13:54:35.437

```
<%= Resources.<ResourceName>.<Property> %> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-15T13:51:56.550

将要在页面中使用的资源属性公开为受保护的页面属性。然后你可以使用“this.ResourceName”

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-15T14:19:38.997

如果您使用的是 ASP.NET 2.0 或更高版本，则在使用资源文件进行编译后，您可以通过 Resources 命名空间来引用它：

```
text = Resources.YourResourceFilename.YourProperty; 
```

您甚至可以在文件名和属性上获得 Intellisense。

# sql-server - Microsoft SQL Server 2005 服务无法启动

> ID：62999
> 
> 赞同：8
> 
> 时间：2008-09-15T13:45:43.507
> 
> 标签：sql-server, sql-server-2005, installation, service

我已经尝试安装 Ms SQL Server 2005 两个多星期了，我终于达到了所有先决条件似乎都已到位的地步。不幸的是，每次我尝试安装 SQL Server 本身时，都会收到以下消息：

“SQL Server 服务无法启动。有关详细信息，请参阅 SQL Server 联机丛书主题“如何：查看 SQL Server 2005 安装日志文件”和“手动启动 SQL Server”。</p>

然后安装程序“回滚”安装，在安装列表中留下三个已卸载的产品：“SQL Server 数据库服务”、“报告服务”和“工作站组件、联机丛书……”。

有人有想法吗？我无法查看 SQL Server 联机丛书主题，因为它们也没有安装；没有它们我就无法理解日志文件。

谢谢！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2013-04-11T23:53:53.363

I had similar problem while installing SQL Server 2005 on Windows 7 Professional and got error `SQL server failed to start`. I logged in as a Administrator (my user id is administrator) in windows.

SOLUTION

1.  Go to services, from control panel -> Administrative Tools

2.  Click on properties of "SQL Server (MSSQLSERVER)"

3.  Go to Log On Tab, Select "This Account"

4.  Enter your windows login detail (administrator and password)

5.  Start the service manually, it should work fine..

Hope this too helps..

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-15T14:41:36.557

看起来并非您的所有先决条件都真正发挥了应有的作用。此外，您需要确保从控制台本身进行安装，而不是通过任何类型的远程会话进行安装。（我知道，这对 a@@ 来说很痛苦，但有时它会有所作为。）

您可以访问 Web 上的 SQL Server 2005 联机丛书，网址为：[http://msdn.microsoft.com/en-us/library/ms130214(SQL.90).aspx](http://msdn.microsoft.com/en-us/library/ms130214(SQL.90).aspx)。该文档应该可以帮助您破译日志。

额外花絮：一旦你走到这一步，如果你打算安装 SP2 而不会安装失败并回滚，这里描述了另一个小智慧： [http://blog.andreloker.de/post/2008/07/17/SQL-Server-hotfix-KB948109-fails-with-error-1920.aspx](http://blog.andreloker.de/post/2008/07/17/SQL-Server-hotfix-KB948109-fails-with-error-1920.aspx)。（我的问题是甚至没有安装“SQL Server VSS Writer”（服务）。）祝你好运！

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2014-11-08T17:34:10.190

要解决此问题，您可能需要修复 SQL Server 2005

简单的步骤即可

1.  更新/安装 .Net 2.0 框架。推荐在线提供 Windows Installer 3.1
2.  从 Microsoft 网站下载安装文件：http: [//www.microsoft.com/en-in/download/details.aspx?id=184](http://www.microsoft.com/en-in/download/details.aspx?id=184)
3.  从 Symantec 网站执行以下步骤： [http ://www.symantec.com/connect/articles/install-and-configure-sql-server-2005-express](http://www.symantec.com/connect/articles/install-and-configure-sql-server-2005-express)

希望这可以帮助！

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2014-01-29T15:59:10.657

**microsoft sql server 2005 启动失败的解决方法**

1.  打开时仔细阅读所有选项卡和图标名称
2.  不要着急，冷静点，做这个程序
3.  当您收到此错误时，启动您的 sql 并继续进行，而不是从此解决方案开始。不要退出安装
    开始->控制面板-->管理工具-->服务-->在服务中搜索sql server(sql express)-->点击登录(tab)-->查看本地系统账号&还要检查
    服务以与桌面交互->单击恢复选项卡->第一次失败选择重新启动服务；第二次失败->运行程序->应用确定

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-28T13:05:01.083

当 SQL Server 设置为在其下运行的帐户没有所需的权限时，我之前看到过类似的情况。

切线，一旦安装，一个常见的错误是从 Windows 服务更改登录凭据，而不是从 SQL Server 配置管理器。尽管它们看起来相同，但 SQL Server 工具授予对某些注册表项的访问权限，而 Windows 工具不授予这些权限，这可能会导致服务启动时出现问题。

您可以在安装运行时运行[Sysinternals RegMon](http://technet.microsoft.com/en-us/sysinternals/bb896652.aspx) / [Sysinternals ProcessMon](http://technet.microsoft.com/en-us/sysinternals/bb896645.aspx)，通过 sqlsevr.exe 和失败消息进行过滤，以查看帐户凭据是否有问题。

希望这可以帮助

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-28T04:13:03.167

我会尝试从安装工具和数据库服务开始。留下分析，卢比等，看看你是否走得更远。我确实记得安装失败的问题，所以一定要进入添加/删除程序并删除卸载程序留下的所有部分

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-15T13:51:05.460

当该错误消息出现在屏幕上时（在回滚开始之前），转到控制面板 -> 管理工具 -> 服务并查看是否实际安装了该服务。还要检查它使用什么帐户运行。如果它不使用本地系统，则双重和三重检查它使用的帐户是否有权访问安装 MS SQL 的程序目录。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-03T19:41:20.637

我同意 Greg 的观点，即日志是最好的起点。我们遇到过类似的情况，解决方法是确保管理员在开始安装之前对注册表位置 HKLM\System\CurrentControlSet\Control\WMI\Security 拥有完全权限。HTH。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-01T10:12:14.507

我们最近在运行 SQL 2005 服务器（更具体地说：报告服务）时遇到了类似的问题。Windows 服务不再启动，没有任何真正的错误消息。

我发现这个问题与最近部署的一些 KB 修补程序有关。由于某种原因，这些修补程序导致服务的启动时间比通常要长。

由于默认情况下，当服务无法超出启动方法时，会在 30 秒后终止服务，这就是它简单终止的原因。

也许这就是你正在经历的。

Microsoft Connect（[链接](http://connect.microsoft.com/SQLServer/feedback/ViewFeedback.aspx?FeedbackID=357144)）上描述了一种解决方法。尽管本文中列出的修补程序与已部署到我们系统的修补程序不匹配，但解决方法对我们有用。***``*********