# StackOverflow 问答 000546000-000546999

# .net - 如何将基于套接字的客户端与 WCF (net.tcp) 服务一起使用？

> ID：546004
> 
> 赞同：39
> 
> 时间：2009-02-13T13:53:34.210
> 
> 标签：.net, wcf, sockets, tcp

我开发了一个使用 net.tcp 适配器并侦听特定端口的 WCF 服务。我想使用普通的 .net 客户端连接到该服务，该客户端使用套接字将数据发送到端口并侦听响应。
当我尝试向该服务发送数据时，出现错误：“现有连接被远程主机强制关闭”。
但是，我可以通过另一个使用 WCF 服务的地址/绑定/合同的客户端连接该服务。
有没有一种方法可以让我通过使用普通的基于套接字的客户端与 WCF 服务进行通信？

* * *

## 回答 #1

> 赞同：52
> 
> 时间：2009-02-14T08:33:13.753

关键的决定是是否使 WCF 服务符合套接字客户端或是否使套接字客户端符合 WCF 服务。

尝试符合 WCF 服务将是最简单的，而不是尝试在 WCF 中实现一些自定义的东西，这绝非易事。在下面的“其他资源”部分的底部，您将看到一个链接，该链接描述了尝试符合 WCF 服务所必需的消息检查。

话虽如此，.NET 套接字本身并不与 WCF 通信。

任何这样做的尝试都需要在 WCF 方面进行自定义编程。

无论您是使用 TcpClient 还是 .NET 中的原始套接字连接到 WCF 并与之通信都无关紧要。任何此类互操作性都必须使用 WCF 中的自定义逻辑进行处理。请注意，Net.Tcp 是一种自定义传输协议。从技术上讲，它不像 TcpClient 那样使用 TCP。

例如，UDP 是 Linux 世界中的套接字服务器非常常用的。WCF 不提供内置的 UDP 传输。但是，有一个为 WCF 实现 UDP 的 WCF UDP 示例。不幸的是，该示例没有说明与非 WCF UPD 套接字服务器之间的通信。

我有一个非常详细的悬而未决的问题，我在其中解释了我为使示例代码普遍可测试以使用 UDP 所做的努力...

[是否可以使 WcfTestClient 为自定义传输通道工作？](https://stackoverflow.com/questions/484717/error-externally-testing-wcf-udp-custom-transport-channel-sample-from-the-windows)

还没有人回答我的问题。所以，如果你成功地完成了这项工作，我很感兴趣。我的案例是因为希望 WCF 服务能够调用在 Linux 上运行的 UDP 套接字服务器，而不必使用非 WCF 编码使我的服务混乱。我不想混合方法。

**其他资源...**

*   选择传输
    *本文指出“WCF TCP 传输针对通信两端都使用 WCF 的场景进行了优化”。*

    [http://msdn.microsoft.com/en-us/library/ms733769.aspx](http://msdn.microsoft.com/en-us/library/ms733769.aspx)

*   尝试将非 WCF 客户端连接到使用 BasicHttpBinding 的 WCF 服务。
    *开发人员最终通过 WebClient（而不是 TcpClient）编写自定义代码。*

    [http://social.msdn.microsoft.com/Forums/en-US/wcf/thread/c2d72c2d-c095-4ae1-b8ae-d15f32a4e0be/](http://social.msdn.microsoft.com/Forums/en-US/wcf/thread/c2d72c2d-c095-4ae1-b8ae-d15f32a4e0be/)

*   WCF 与原始 .NET 套接字
    *答案指出可能需要 TCP + 二进制序列化或 UDP + 二进制序列化。如上所述，有一个 UDP 绑定示例。*

    [http://social.msdn.microsoft.com/Forums/en-US/wcf/thread/c0520111-c1ca-4ffd-a4e0-ac68e86130ee/](http://social.msdn.microsoft.com/Forums/en-US/wcf/thread/c0520111-c1ca-4ffd-a4e0-ac68e86130ee/)

*   向简单的 WCF 服务编写自定义请求
    *作者解释了如何弄清楚需要发送到服务的消息的格式，以便 TcpClient 或其他非 WCF 套接字客户端可以将写入信息发送到 WCF 服务。这里的含义是您不是在尝试遵循 WCF 服务，而是在强制套接字客户端完成繁重的工作。即便如此，如果您期望的话，您也不会获得 WCF 绑定的内置优势。*

    [http://blogs.msdn.com/carlosfigueira/archive/2008/01/13/writing-custom-requests-to-simple-wcf-services.aspx](http://blogs.msdn.com/carlosfigueira/archive/2008/01/13/writing-custom-requests-to-simple-wcf-services.aspx)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-14T17:53:40.987

Net.TCP 绑定使用了一种自定义的线级框架格式，虽然 Nicholas Allen 最近开始了一系列关于该主题的博客文章，但该格式并没有真正记录在案。该系列从这里开始：http: [//blogs.msdn.com/drnick/archive/2009/01/19/message-framing-part-1.aspx](http://blogs.msdn.com/drnick/archive/2009/01/19/message-framing-part-1.aspx)

老实说，Net.TCP 目前确实对 WCF 到 WCF 的通信更有用。如果您想与需要处理的自定义 TCP 格式进行互操作，最好使用原始套接字或创建自己的自定义 WCF 传输通道（顺便说一句，这可能不是微不足道的）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-13T14:48:06.247

嗨，

您是否启用了 WCF 跟踪？因为如果您这样做并且您收到以下消息：**“该服务不允许您匿名登录。”** 那么它（通常）是一个安全设置问题。

在这种情况下，禁用绑定的安全模式：

```
<netTcpBinding>
   <binding name="MyCustomBinding"> 
      <security mode="None" /> 
   </binding> 
</netTcpBinding> 
```

但更好的是使用证书。

# css - Firefox 无法正确对齐图像

> ID：546010
> 
> 赞同：1
> 
> 时间：2009-02-13T13:54:27.250
> 
> 标签：css, firefox, html

我正在尝试为我在动画课上完成的一些学校作品制作一个小画廊。我想在每行上放 3 张图像，它们都在 div 中，因为我做了洋葱皮包裹，以便在它们上放置阴影。不幸的是，这使得它们都在页面上的两行中粘在一起。但我希望它们专门格式化，所以我尝试在每组 3 个周围包装一个 480px 宽的 div。在 IE 中这很好用，看起来很完美。但是在 Firefox 中它会这样做

![](https://i.stack.imgur.com/TQgQR.jpg)

我不明白为什么将左对齐放在第二行，因此搞砸了其余部分的顺序。这是我的代码：

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Ryan Merl's Portfolio</title>
<style type='text/css'>
    * {
        padding: 0px;
        margin: 0px;
        font-family:Verdana, Arial, Helvetica, sans-serif;
        font-size: 11px;
    }
    body {
        background-color:#333333;
        background-image: url('images/head.png');
        background-repeat: repeat-x;
    }
    a {
        color:#333333;
        text-decoration: none;
    }
    a:hover {
        color:#000000;
        text-decoration:underline;
    }
    div.main {
        width: 800px;
        background-color:#FFFFFF;
        margin-top: 10px;
        color: #000000;
        height: 1000px;
        margin-bottom: 10px;
    }
    img.thumb {

    }
    .wrap1, .wrap2, .wrap3 {
        display:inline-table;
        /* \*/display:block;/**/
    }
    .wrap1 {
        float:left;
        background:url('images/shadow.gif') right bottom no-repeat;
    }
    .wrap2 {
        background:url('images/corner_bl.gif') left bottom no-repeat;
    }
    .wrap3 {
        padding:0 4px 4px 0;
        background:url('images/corner_tr.gif'   ) right top no-repeat;
    }
</style>
<link rel="stylesheet" type="text/css" href="doc/css/style.css" />
<script type="text/javascript" src="src/adapter/shadowbox-base.js"></script>
<script type="text/javascript" src="src/shadowbox.js"></script>
<script type="text/javascript" src="glossy.js"></script>
<script type="text/javascript">

Shadowbox.loadSkin('classic', 'src/skin');
Shadowbox.loadLanguage('en', 'src/lang');
Shadowbox.loadPlayer(['flv', 'html','img', 'swf'], 'src/player');

window.onload = function(){
    Shadowbox.init();
};

</script>
</head>
<body>
    <center><div class='main'>
        <img src='images/theantistudio.png' /><br /><br />

        <img src='images/gallery.png' /><br />
        <div style='text-align:center;width:480px;'>
            <div class="wrap1">
                <div class="wrap2">
                    <div class="wrap3">
                        <a href='video/rmerl_particle_fire.flv' rel='shadowbox'><img class='thumb' src='thumbs/thumb_fire.png' /></a>
                    </div>
                </div>
            </div>
            <div class="wrap1">
                <div class="wrap2">
                    <div class="wrap3">
                        <a href='video/rmerl_firework.flv' rel='shadowbox'><img class='thumb' src='thumbs/thumb_firework.png' /></a>
                    </div>
                </div>
            </div>
            <div class="wrap1">
                <div class="wrap2">
                    <div class="wrap3">
                        <a href='video/rmerl_fountain.flv' rel='shadowbox'><img class='thumb' src='thumbs/thumb_fountain.png' /></a>
                    </div>
                </div>
            </div>
        </div>
        <br />
        <div style='text-align:center;width:480px;'>
            <div class="wrap1">
                <div class="wrap2">
                    <div class="wrap3">
                        <a href='video/rmerl_logo.flv' rel='shadowbox'><img class='thumb' src= 'thumbs/thumb_logo.png' /></a>
                    </div>
                </div>
            </div>
            <div class="wrap1">
                <div class="wrap2">
                    <div class="wrap3">  
                        <a href='video/rmerl_rocket_ship.flv' rel='shadowbox'><img class='thumb' src='thumbs/thumb_rocket.png' /></a>
                    </div>
                </div>
            </div>
            <div class="wrap1">
                <div class="wrap2">
                    <div class="wrap3">
                        <a href='video/rmerl_solar_system.flv' rel='shadowbox'><img class='thumb' src='thumbs/thumb_solar_system.png' /></a>
                    </div>
                </div>
            </div>
        </div>
        <br />
        <div style='text-align:center;width:480px;'>
            <div class="wrap1">
                <div class="wrap2">
                    <div class="wrap3">
                        <a href='video/rmerl_space_ship.flv' rel='shadowbox'><img class='thumb' src='thumbs/thumb_space_ship.png' /></a>
                    </div>
                </div>
            </div>
            <div class="wrap1">
                <div class="wrap2">
                    <div class="wrap3">
                        <a href='video/rmerl_still_life.flv' rel='shadowbox'><img class='thumb' src='thumbs/thumb_still_life.png' /></a>
                    </div>
                </div>
            </div>
            <div class="wrap1">
                <div class="wrap2">
                    <div class="wrap3">
                        <a href='video/rmerl_walkthrough.flv' rel='shadowbox'><img class='thumb' src='thumbs/thumb_walkthrough.png' /></a>
                    </div>
                </div>
            </div>
        </div>
    </div></center>
</body>
</html> 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-13T14:32:42.850

看起来您的第二张图片可能比您的第三张略高。因此，您浮动的第二行只会向后浮动，直到碰到第二张图像。设置您的图像或 wrap1 高度，或将 style="clear:both" 添加到行之间的中断标记。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-13T14:06:54.490

我看不到你的照片，但根据你的描述，听起来你没有清理花车。您在 div 中的每三个图像块之后都有一个 br，因此添加以下 CSS 将清除浮动并连续显示三个。

```
br { clear: both; } 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-13T14:29:30.033

此外，如果指定的“行”上没有足够的宽度，它将下降到下一行。尝试使窗口尽可能宽（单击 n 拖动），看看这是否是问题所在。

# c# - PerformanceCounter 的 C# 替换

> ID：546014
> 
> 赞同：2
> 
> 时间：2009-02-13T13:56:02.800
> 
> 标签：c#, .net, performancecounter

我想知道是否有用于精确时间测量的“.net 集成”解决方案（如函数的执行时间）？目前我正在使用来自 Kernel32 的 PerformanceCounters。

```
 [DllImport("Kernel32.dll")]
    private static extern bool QueryPerformanceCounter(
        out long lpPerformanceCount);

    [DllImport("Kernel32.dll")]
    private static extern bool QueryPerformanceFrequency(
        out long lpFrequency); 
```

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-02-13T13:58:57.113

[秒表](http://msdn.microsoft.com/en-us/library/system.diagnostics.stopwatch.aspx)是一个高分辨率框架计时器类（可能包装了该 API）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-13T14:01:03.160

尝试

*   [System.Environment.TickCount](http://msdn.microsoft.com/en-us/library/system.environment.tickcount.aspx)
*   [系统.诊断.秒表](http://msdn.microsoft.com/en-us/library/system.diagnostics.stopwatch.aspx)

这两种方法都适用于更精细的分辨率和简单的使用。

你还可以看到

[测量函数执行时间的最佳方法是什么？](https://stackoverflow.com/questions/380919/what-is-the-best-way-to-measure-execution-time-of-a-function)

或者

[在 Windows 中对程序进行基准测试的最佳方法是什么？](https://stackoverflow.com/questions/145103/whats-the-best-way-to-benchmark-programs-in-windows)

# python - 如何在 Python 中运行另一个脚本而不等待它完成？

> ID：546017
> 
> 赞同：41
> 
> 时间：2009-02-13T13:56:28.663
> 
> 标签：python, django, process, background, subprocess

我正在为允许他运行特定作业的用户创建一个小仪表板。我正在使用 Django，所以我希望他能够单击链接以启动作业，然后将页面返回给他，并显示作业正在运行的消息。工作的结果将稍后通过电子邮件发送给他。

我相信我应该使用`subprocess.Popen`，但我不确定。所以在伪代码中，这就是我想要做的：

```
if job == 1:
    run script in background: /path/to/script.py
    return 'Job is running' 
```

* * *

## 回答 #1

> 赞同：63
> 
> 时间：2009-02-13T14:00:09.357

```
p = subprocess.Popen([sys.executable, '/path/to/script.py'], 
                                    stdout=subprocess.PIPE, 
                                    stderr=subprocess.STDOUT) 
```

这将在后台启动子进程。您的脚本将继续正常运行。

[在此处](http://docs.python.org/library/subprocess.html)阅读文档。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-09T17:29:24.190

如果您正在考虑长期扩展，则通过消息队列运行它绝对是要走的路。向在后台持续运行的队列发送消息，并编写作业处理程序来处理不同类型的消息。

由于您使用的是 Django，我认为[Beanstalkd](http://xph.us/software/beanstalkd/ "豆茎")非常适合。[这是](http://parand.com/say/index.php/2008/10/12/beanstalkd-python-basic-tutorial/)一个关于这个主题的非常好的教程。那篇文章中的第一条评论也有一些很好的提示。

就我个人而言，我已经使用了一个用 Erlang 编写的自定义内存队列服务器，以及用 C 编写的 Python 绑定。但是[redis](http://code.google.com/p/redis/)看起来可能会成为未来队列/消息传递需求的有力竞争者。希望这可以帮助！

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-13T14:00:25.517

subprocess.Popen 确实是您正在寻找的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-13T14:12:29.047

虽然如果你发现你想开始在子进程和父进程之间传递一堆信息，你可能需要考虑一个线程，或者像 Twisted 这样的 RPC 框架。

但很可能这些对于您的应用程序来说太重了。

# html - 为 Explorer 8 设计网站

> ID：546036
> 
> 赞同：2
> 
> 时间：2009-02-13T14:03:12.110
> 
> 标签：html, internet-explorer-8

在为 Internet Explorer 8 设计网站时，我们应该注意哪些主题？有没有新的标准，我们应该遵守以获得最佳外观？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-13T14:12:36.020

您永远不应该为浏览器设计站点，您应该使用每个人都支持的 css/javascript 子集来设计站点。

当然，如果 ie8 的设计意味着您将不支持 7 或 6，那么该子集会变得更大。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-13T14:09:15.450

Microsoft 计划通过 IE8 实现对 W3.org Web 标准的合规性。[http://www.w3.org/](http://www.w3.org/)

[http://channel9.msdn.com/posts/Charles/IE-8-On-the-Path-to-Web-Standards-Compliance-ACID-2-Test-Pass-Complete/](http://channel9.msdn.com/posts/Charles/IE-8-On-the-Path-to-Web-Standards-Compliance-ACID-2-Test-Pass-Complete/)

因此，请确保您的网站根据网络标准有效。您可以通过访问[http://jigsaw.w3.org/来验证您的网站](http://jigsaw.w3.org/)

# c# - 从多列列表视图中删除选定的行

> ID：546045
> 
> 赞同：4
> 
> 时间：2009-02-13T14:05:54.180
> 
> 标签：c#, winforms, listview

我有一个包含两列的列表视图，并且我正在使用上下文菜单来允许用户删除选定的行。要删除选定的行，我尝试使用以下代码，但它不起作用：

```
private void toolStripMenuItem1_Click(object sender, EventArgs e)
{
    listView1.SelectedItems.Clear();
} 
```

我怀疑这是因为列表视图有两列，但我无法找到删除选定行的解决方案。删除所有行适用于：`listView1.Items.Clear();`。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-13T14:27:47.497

BeefTurkey 的最新示例看起来是正确的，但他应该`i`在删除所选项目后减少变量：

```
for (int i = 0; i < listView1.Items.Count; i++ )
{
    if (listView1.Items[i].Selected)
    {
        listView1.Items[i].Remove();
        i--;
    }
} 
```

删除后，较大的项目的索引`i`减 1。所以你应该重新定位`i`以匹配下一个未测试的项目。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-04-16T17:38:32.813

```
while (listBox1.SelectedItems.Count > 0)
{
    listBox1.Items.Remove(listBox1.SelectedItem);
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-01-18T18:01:55.127

```
 foreach(ListViewItem lvItem in lvDocument.SelectedItems)
 {
      lvDocument.Items.Remove(lvItem);
 } 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-13T14:10:28.270

这似乎有效：

```
 for (int i = 0; i < listView1.Items.Count; i++ )
    {

        if (listView1.Items[i].Selected)
        {
            listView1.Items[i].SubItems.Clear();
        }

    } 
```

有什么方法可以删除项目并重新排序 listView 以使其他行中间没有空行？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-13T14:17:14.493

这似乎是一个更好的解决方案：

```
for (int i = 0; i < listView1.Items.Count; i++ )
{
    if (listView1.Items[i].Selected)
    {
        listView1.Items[i].Remove();
    }
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-13T14:17:37.693

你可以做什么：

```
foreach (ListViewItem Item in LstvClients.Items)
{    
     if (item.Selected)
     {
         LstvClients.Items.Remove(Item);
     }
} 
```

（你的更好，item.Remove()）

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2011-05-10T18:35:34.850

我一直在使用与其他稍有不同的东西从 ListView 控件中删除所有选定的项目：

```
foreach (ListViewItem listViewItem in listView1.SelectedItems)
{
    listView1.Items.Remove(listViewItem);
} 
```

我不确定这将如何在性能方面与大型列表中的其他发布方法相匹配，但我认为在这不是问题的情况下看起来会更干净一些。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2011-06-30T20:16:09.447

这是删除所有选定项目的正确方法。方法是始终访问索引为 0 的第一个选定项并循环直到没有更多选定项。您不能使用绝对索引安全地引用集合中的其他项目，因为一旦您删除其中一个项目，索引就会更改。

```
while( listView1.SelectedItems.Count > 0)
{
    listView1.Items.Remove(lvFiles.SelectedItems[0]);
} 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2016-01-07T07:11:55.650

```
do
{ 
  this.listView1.CheckedItems[0].Remove(); 
} while (this.listView1.CheckedItems.Count > 0);
```

这效果更好

# c# - 关闭文件时删除

> ID：546049
> 
> 赞同：15
> 
> 时间：2009-02-13T14:08:20.880
> 
> 标签：c#, file, filesystems, temporary-files

使用语言：C#

理论：我想`FileOptions.DeleteOnClose`在临时文件夹中创建一个带有标志的文件。文件已成功创建，我将 dato 写入其上，下一步是启动与文件关联的应用程序`Process.Start(...)`并允许用户检查文档，最后我关闭我的句柄，一旦其他进程关闭句柄到临时文件，文件被操作系统删除。

我的问题是，即使我添加`FileShare.ReadWrite | FileShare.Delete`到共享模式，其他进程也无法打开文件，即使是阅读也无法打开。

有什么建议么？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-02-13T15:37:43.333

其他进程需要指定`FileShare.Delete`何时打开`DeleteOnClose`文件

从[MSDN CreateFile](http://msdn.microsoft.com/en-us/library/aa363858.aspx)文档：

> “ `FILE_FLAG_DELETE_ON_CLOSE`... 文件的后续打开请求失败，除非`FILE_SHARE_DELETE`指定了共享模式。”

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-13T14:34:01.083

检查这个：

您需要确保**所有**进程都使用 FileShare.ReadWrite 和 FileShare.Delete 打开文件。

即使创建者使用 share-readwrite 打开，如果第二个程序尝试使用 share-read 打开，第二个程序基本上是说没有其他人可以写。但是第一个程序已经具有该功能，因此第二个打开失败。

* * *

## 回答 #3

> 赞同：-7
> 
> 时间：2009-02-13T14:25:28.173

切换到 Linux *scnr*

好的，现在说真的：这是 Windows 操作系统中的一个缺陷，无法真正解决。每个打开文件的程序必须同意其他程序同时打开该文件。这是我多年前还在使用 Windows 时遇到的问题。打开一个文件并说：让其他人也打开它是不够的。其他人也必须说打开这个文件，即使它已经打开了。

相反，在 Linux 上，操作系统根本不允许像 Windows 那样锁定任何文件。在这里，如果多个程序同时使用任何文件，则程序本身必须确保并发访问被锁定。此外，在 Linux 上，我们可以只创建文件，确保其他进程已启动并打开文件，然后删除文件（当它打开时）。然后文件名立即从文件系统中删除，但文件仍由文件系统驱动程序维护，直到最后一个链接（包括打开的文件句柄）被删除。

回到您的问题：由于所有这些都不适用于 Windows，您可以执行其他两种方法：

1.  注册要在下次启动时删除的文件（在 Win3x 时代，在 win.ini 中有一个部分。较新的 Windows 版本仍然支持，我只是想不起现在是如何完成的）。
2.  启动另一个进程，等待它打开文件，关闭文件，然后每分钟尝试删除文件，直到删除成功...

问候， 博多

# exception - 什么会导致 Outlook 将 COM 插件的 LoadBehavior 更改为 2 - 除了未处理的异常？

> ID：546051
> 
> 赞同：18
> 
> 时间：2009-02-13T14:08:41.020
> 
> 标签：exception, exception-handling, outlook, add-in

几个星期以来，我们一直在与一个问题作斗争，即在少数客户中，我们的 Outlook 插件由于尚未确定的原因而被卸载和禁用。“禁用”是指 Outlook 将以下注册表值从 3 更改为 2，这实际上意味着下次启动时不会加载插件：

`HKEY_LOCAL_MACHINE\Software\Microsoft\Office\Outlook\Addins\[OurAddin.sProgID]\LoadBehavior`

没有错误消息，也没有任何异常出现在我们的插件自己生成的日志文件中。

我已经找到了专门处理 LoadBehavior 更改问题的以下页面：http: [//blogs.msdn.com/vsod/archive/2008/04/22/Troubleshooting-com-add-in-load-failures.aspx](http://blogs.msdn.com/vsod/archive/2008/04/22/Troubleshooting-com-add-in-load-failures.aspx)

但是，那里提出的所有可能原因似乎都不适用：

*   插件不仅仅列在禁用项目列表中。
*   `IDTExtensibility2`方法中或代码中的其他任何地方都没有未处理的异常。所有代码都包装在 try/catch 等效项中，并且所有异常输出仅通过`OutputDebugString`或发送到日志文件中。
*   该错误似乎与防病毒软件无关，即它也会在禁用它的情况下发生。
*   禁用所有其他插件也对错误没有影响。

**那么，还有什么可能导致 Outlook 禁用插件呢？**

更多细节/观察：

*   到目前为止，我们还无法在我们的测试环境中重现该问题，因此我们还无法在问题发生时附加调试器。
*   当我们尝试通过远程支持 (TeamViewer) 观察发生的情况时，该问题永远不会发生。我怀疑这是因为 TeamViewer 使用了一个钩子 DLL，它将自身注入到所有正在运行的进程（包括 Outlook）中，从而影响内存布局、时间、线程顺序等。
*   每当我们编译一个新版本的插件来尝试新的东西时，插件通常会正常工作几个小时甚至几天，但最终会再次被禁用。一旦发生这种情况，所有后续尝试让插件加载到该机器上（通过手动更改 LoadBehavior 值）都将失败（即 LoadBehaviour 将简单地更改回 2），直到我们编译和部署另一个构建（或尝试使用TeamViewer - 见上文）。
*   通常，插件会在 Outlook 启动时立即卸载，但偶尔也会在 Outlook 已经运行一段时间后发生。在这些情况下，日志文件看起来完全不显眼 - 插件只需执行常规关闭步骤，就好像 Outlook 已正常关闭一样。
*   据我所知，从我们的日志文件并通过 SysInternals ProcessMonitor 观察问题，当插件在 Outlook 启动时（而不是在会话期间）被禁用时，DLL 甚至在 COM 对象（即插件）被实例化之前就被卸载（构造函数中的日志消息永远不会出现）。
*   我们将`OutputDebugString`消息放在`initialization`部分中（这是一个 Delphi DLL）。当插件无法加载时，它们都不会出现。
*   只有极少数客户受到此问题的影响。我们有数以万计的安装，我们还没有收到任何关于此的报告。

*   **更新：**似乎经常（但并非总是）在插件卸载之前记录的最后一件事是带有文本“OLE 错误 800A01A8”的异常。该异常被我正在使用的框架（[Add-in-Express](http://add-in-express.com)）中内置的全局异常处理程序捕获，并且不会出现在我自己的代码的任何地方，其中每个方法现在都完全包含在`try..catch`. 这通常发生在我从 Inspector 的 Activate 事件处理程序设置 CommandBarButtons 的可见性之后。

所有受影响机器的共同属性：

*   Windows XP Professional，最新补丁级别
*   Outlook 2003 Professional，最新补丁级别
*   不同版本的 McAfee Virus Scan（尽管禁用它没有效果 - 见上文）
*   用户是本地管理员组的成员

还有一点需要注意，这很可能也很重要（尽管可能没有我最初想的那么重要）：
我们正在使用来自第三方供应商的许可/复制保护模块，该模块将已编译的 DLL 包装在“外壳”中，并且仅在运行时解包。自从我发现插件在我们自己的任何代码被执行之前就被卸载了，这一直是我的主要嫌疑人。然而，尽管供应商确认其代码中可能存在未处理的异常，但由保护外壳的特殊调试版本生成的日志文件显示解包过程已成功完成，并且在 Outlook 卸载插件之前控制权已交回受保护的 DLL . 因此，无论是什么导致 Outlook 卸载我们的插件，似乎都发生在保护外壳的初始化完成和我们自己的代码之间。

还有什么想法吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-20T15:34:10.853

多年来，我的公司一直在忍受听起来与您所看到的相同的问题。我们拥有的插件是 Outlook 2003 的 VB6 COM 插件，它部署在数百台机器上，每天循环数百（如果不是数千）次。我们经历了很多加载和卸载循环。

在插件已加载但未连接的情况下，我们会遇到相当多的一般错误，我们会在代码中进行处理。（显然不是生产质量）

```
Dim outlook As outlook.Application
Set outlook = CreateObject("Outlook.Application")
outlook.COMAddIns("MyFancyDancyPlugin").Connect = True 
```

很少，但不是那么罕见以至于它不是烦人，我们看到插件达到加载状态，我们可以在“工具>选项>其他>高级选项> Com加载项”中看到它，但是我们只是无法连接到这个东西。如果您尝试连接，则不会出现错误，它只是切换回断开连接。[相当于在注册表项中切换回 2] 据我所知，COM 对象从未创建过。该项目未列在已禁用项目中。

我们实际上不必重新部署来纠正这个错误。通过 Com Add-Ins 对话框删除对象，然后在此处重新添加它似乎可以解决问题。这仍然不是一个可接受的解决方案，但它确实可以在不重新安装的情况下恢复并运行。

> *   Windows XP Professional，最新补丁级别
> *   Outlook 2003 Professional，最新补丁级别
> *   不同版本的 McAfee Virus Scan（尽管禁用它没有效果 - 见上文）
> *   用户是本地管理员组的成员

这似乎很合适，我们不使用 McAfee，但病毒扫描程序也不与 Outlook 或 com 加载项交互。我们也不使用复制保护应用程序。

很抱歉，我无法提供更多帮助，但我很想从根本上解决这个问题。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-27T13:56:00.473

我也在开发 Outlook 加载项，我知道加载项被禁用的一个原因。有时，当 Outlook 突然关闭或用户强行关闭 Outlook 时，加载项会被禁用。我不确定这是否是您的原因，但它也可以给您一些思考的方向。我有一段时间使用这种方法（在它仍在加载时使用任务管理器关闭 Outlook）来模拟这种行为，实际上我已经开发了一个工具来扫描提供给它的所有机器并检查加载项是否在机器上被禁用如果是，它会更改注册表值以启用它。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-05-31T02:35:13.340

也许您是锁定政策的受害者。在注册表中添加一个旁路密钥，然后它就可以工作了。现代办公版本或 vsto 在安装时创建密钥。效果是：也安装一个现代办公室，现在插件也加载到旧办公室。请看一下

代码片段取自 NetOffice [http://netoffice.codeplex.com](http://netoffice.codeplex.com)

```
public static void RegisterFunction(Type type)
{
            try
            {
                // add codebase value
                Assembly thisAssembly = Assembly.GetAssembly(typeof(ExampleClassicAddin));
                RegistryKey key = Registry.ClassesRoot.CreateSubKey("CLSID\\{" + type.GUID.ToString().ToUpper() + "}\\InprocServer32\\1.0.0.0");
                key.SetValue("CodeBase", thisAssembly.CodeBase);
                key.Close();

                key = Registry.ClassesRoot.CreateSubKey("CLSID\\{" + type.GUID.ToString().ToUpper() + "}\\InprocServer32");
                key.SetValue("CodeBase", thisAssembly.CodeBase);
                key.Close();

                // add bypass key
                // http://support.microsoft.com/kb/948461
                key = Registry.ClassesRoot.CreateSubKey("Interface\\{000C0601-0000-0000-C000-000000000046}");
                string defaultValue = key.GetValue("") as string;
                if (null == defaultValue)
                    key.SetValue("", "Office .NET Framework Lockback Bypass Key");
                key.Close();

                // add addin key
                Registry.ClassesRoot.CreateSubKey(@"CLSID\{" + type.GUID.ToString().ToUpper() + @"}\Programmable");
                Registry.CurrentUser.CreateSubKey(_addinRegistryKey + _prodId);
                RegistryKey rk = Registry.CurrentUser.OpenSubKey(_addinRegistryKey + _prodId, true);
                rk.SetValue("LoadBehavior", Convert.ToInt32(3));
                rk.SetValue("FriendlyName", _addinName);
                rk.SetValue("Description", "NetOffice COMAddinExample with classic UI");
                rk.Close();
            }
            catch (Exception ex)
            {
                string details = string.Format("{1}{1}Details:{1}{1}{0}", ex.Message, Environment.NewLine);
                MessageBox.Show("An error occured." + details, "Register " + _addinName, MessageBoxButtons.OK, MessageBoxIcon.Error);
            }
} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-08-16T18:35:34.297

如果您有能力让您的用户在问题发生时运行调试程序以获取有关问题的更多信息，请尝试使用 Microsoft 的 Add-in Spy。

[http://msdn.microsoft.com/en-us/library/cc984533(v=office.12).aspx](http://msdn.microsoft.com/en-us/library/cc984533(v=office.12).aspx)

我有一个加载项无法加载并发现它正在发生，因为没有预加载依赖项。当 Outlook 加载项无法加载时，此工具应该能够告诉您发生了什么特定错误。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2012-02-03T10:24:58.013

只是为了结束这一点：这个问题最终证明是由我们使用的第三方许可包装器中的错误引起的。它已得到供应商的确认，并在最近的版本中得到修复。

# asp.net - 自动标记具有RequiredFieldValidator 的ASP.Net 控件

> ID：546062
> 
> 赞同：0
> 
> 时间：2009-02-13T14:12:01.713
> 
> 标签：asp.net, css, automation, requiredfieldvalidator

是否有一种干净且集中的方式来自动为启用了RequiredFieldValidator 的ASP.Net 控件（即文本框）指定背景颜色或其他CSS 属性？

目前我已经手动将所需控件的背景颜色设置为黄色。我想用一个中心方法替换它，所以如果客户请求不同的颜色或标记，或者如果字段的状态从需要变为不需要，反之亦然，我不会错过任何控件。

谢谢

**更新**

这个网站是预编译的。可以在编译时将 Css 类或其他符合标准的标志附加到 ControlToValidtate 属性中的项目吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-13T14:16:21.377

为什么不添加一个必需的css类。您可以通过空格分隔它们在单个控件上具有多个类，因此想象一个带有数字的输入字段：

现在我可以有两个类，一个右对齐文本，一个处理所需的字段要求。

# 编辑

页面渲染前的一个选项是遍历页面中的每个控件，如果是必填字段验证器，则找到对应的控件并设置css属性；但是，这对于您可以在设计时解决的问题来说是很多工作。

# sms - 如何为 SyncML 配置生成 OTA SMS

> ID：546074
> 
> 赞同：3
> 
> 时间：2009-02-13T14:14:42.113
> 
> 标签：sms, over-the-air

我需要生成和发送 SyncML OTA SMS。我有可以发送二进制短信的短信提供商。但我有点卡在 OTA 规范中，如果您指出其中任何一个，我会非常高兴：

1.  一个开源工具，可以从提供的某些属性中生成 OTA 短信。
2.  关于如何制作 OTA SMS 的一个很好的概述或教程（OTA 规范似乎根本不可读）

提前致谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-13T14:30:28.083

看看[这里](http://www.kannel.org/addons.shtml)。它已经很老了，但我认为[源代码](https://redmine.kannel.org/projects/kannel/repository/show/trunk/gw)应该显示一些如何创建和发送 OTA 短信。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-13T15:42:55.003

您需要生成以下 OMA-DP XML 文档并将其提交给您的服务提供商网关。您必须严格遵循消息的格式才能被话机识别为配置消息。还请联系您的服务提供商并询问他们是否可以即时将 XML 提交转换为 SMS。他们需要将 XML 编码为 WBXML，然后以 PDU 模式转发消息。

```
<?xml version="1.0" encoding="utf-8"?>
<wap-provisioningdoc>
  <characteristic type="BOOTSTRAP">
    <parm name="NAME" value="SYNCSETTINGS" />
  </characteristic>
  <characteristic type="APPLICATION">
    <parm name="APPID" value="w5" />
    <parm name="TO-NAPID" value="INTERNET" />
    <parm name="NAME" value="SYNCSETTINGS" />
    <parm name="ADDR" value="http://syncserver/sync" />
    <characteristic type="RESOURCE">
      <parm name="URI" value="pb" />
      <parm name="NAME" value="Contacts DB" />
      <parm name="AACCEPT" value="text/x-vcard" />
    </characteristic>
    <characteristic type="RESOURCE">
      <parm name="URI" value="cal" />
      <parm name="NAME" value="Calendar DB" />
      <parm name="AACCEPT" value="text/x-vcalendar" />
    </characteristic>
    <characteristic type="RESOURCE">
      <parm name="URI" value="notes" />
      <parm name="NAME" value="Notes DB" />
      <parm name="AACCEPT" value="text/plain" />
    </characteristic>
    <characteristic type="APPAUTH">
      <parm name="AAUTHNAME" value="username" />
      <parm name="AAUTHSECRET" value="password" />
    </characteristic>
  </characteristic>
</wap-provisioningdoc> 
```

这是生成上述 XML 文档的 C# 中的函数。

```
public string CreateOTAXmlFile(string Username, string Password)
    {
        var ota = new XDocument(
                    new XElement("wap-provisioningdoc",
                        new XElement("characteristic", new XAttribute("type", "BOOTSTRAP"),
                            new XElement("parm", new XAttribute("name", "NAME"), new XAttribute("value", "SYNCSETTINGS"))
                                    ),
                        new XElement("characteristic", new XAttribute("type", "APPLICATION"),
                            new XElement("parm", new XAttribute("name", "APPID"), new XAttribute("value", "w5")),
                            new XElement("parm", new XAttribute("name", "TO-NAPID"), new XAttribute("value", "INTERNET")),
                            new XElement("parm", new XAttribute("name", "NAME"), new XAttribute("value", "SYNCSETTINGS")),
                            new XElement("parm", new XAttribute("name", "ADDR"), new XAttribute("value", "http://syncserver/sync")),
                            new XElement("characteristic", new XAttribute("type", "RESOURCE"),
                                new XElement("parm", new XAttribute("name", "URI"), new XAttribute("value", "pb")),
                                new XElement("parm", new XAttribute("name", "NAME"), new XAttribute("value", "Contacts DB")),
                                new XElement("parm", new XAttribute("name", "AACCEPT"), new XAttribute("value", "text/x-vcard"))
                                        ),
                            new XElement("characteristic", new XAttribute("type", "RESOURCE"),
                                new XElement("parm", new XAttribute("name", "URI"), new XAttribute("value", "cal")),
                                new XElement("parm", new XAttribute("name", "NAME"), new XAttribute("value", "Calendar DB")),
                                new XElement("parm", new XAttribute("name", "AACCEPT"), new XAttribute("value", "text/x-vcalendar"))
                                        ),
                            new XElement("characteristic", new XAttribute("type", "RESOURCE"),
                                new XElement("parm", new XAttribute("name", "URI"), new XAttribute("value", "notes")),
                                new XElement("parm", new XAttribute("name", "NAME"), new XAttribute("value", "Notes DB")),
                                new XElement("parm", new XAttribute("name", "AACCEPT"), new XAttribute("value", "text/plain"))
                                        ),
                            new XElement("characteristic", new XAttribute("type", "APPAUTH"),
                                new XElement("parm", new XAttribute("name", "AAUTHNAME"), new XAttribute("value", Username)),
                                new XElement("parm", new XAttribute("name", "AAUTHSECRET"), new XAttribute("value", Password))
                                        )
                                    )
                                )
                            );

        ota.Save(Server.MapPath("~/OTA/") + Username + ".xml");
        return (ota.ToString());

    } 
```

> [PS：相信我，这甚至可以通过 GSM 调制解调器完成！]

# .net - 使用 Ruby 调用 MS .Net Web 服务

> ID：546080
> 
> 赞同：2
> 
> 时间：2009-02-13T14:16:54.730
> 
> 标签：.net, ruby, web-services

有没有人这样做/有一些示例代码？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-13T14:54:23.110

```
#use .wsdl file to initialize an RPC driver
driver = SOAP::WSDLDriverFactory.new('dotnetwebservice.wsdl').create_rpc_driver

#useful debugging call
driver.wiredump_dev = STDERR

#Set the enconding style to ASP.NET
driver.default_encodingstyle = SOAP::EncodingStyle::ASPDotNetHandler::Namespace

#call method defined in .wsdl
result = driver.serviceMethod() 
```

欲了解更多信息：[http ://dev.ctor.org/soap4r](http://dev.ctor.org/soap4r)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-13T14:21:27.323

显然 Ruby 有一个内置的[wsdl 驱动程序](http://harborsparrow.blogspot.com/2007/07/using-rubys-wsdl-driver-to-call.html)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-13T14:24:40.017

此线程的良好起点**Ruby SOAP client communication with Microsoft .NET webservice**

[这里](http://groups.google.com/group/comp.lang.ruby/browse_thread/thread/ef4653f192455323)

# iphone - 反弹后不再有 scrollViewDidEndScrollingAnimation 委托

> ID：546095
> 
> 赞同：0
> 
> 时间：2009-02-13T14:22:33.577
> 
> 标签：iphone, uiscrollview

我的 UIScrollView 有一个奇怪的行为。视图控制器是我的 UIScroll 的代表，在滚动期间我收到 scrollViewDidScroll 和 scrollViewDidEndScrollingAnimation。一切正常。但是当滚动视图反弹时，我不再收到 scrollViewDidEndScrollingAnimation 但仍然收到 scrollViewDidScroll ...

你有想法吗 ？

非常感谢。

蒂埃里

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-10T05:33:53.123

缩放时它的行为方式类似。我通过设置计时器在我的[ZoomScrollView组件中修复了它。](http://github.com/andreyvit/ScrollingMadness/tree/master)以下内容应该适合您：

```
- (void)scrollViewDidScroll:(UIScrollView *)scrollView {
    [NSObject cancelPreviousPerformRequestsWithTarget:self selector:@selector(_zoomDidEndBouncing) object:nil];
    [self performSelector:@selector(_zoomDidEndBouncing) withObject:nil afterDelay:0.1];
}

- (void)scrollViewDidEndScrollingAnimation:(UIScrollView *)scrollView {
    [NSObject cancelPreviousPerformRequestsWithTarget:self selector:@selector(_zoomDidEndBouncing) object:nil];
    [self performSelector:@selector(_zoomDidEndBouncing) withObject:nil afterDelay:0.1];
} 
```

# excel - 将一列中的单元格与另一张表中的另一列匹配

> ID：546096
> 
> 赞同：0
> 
> 时间：2009-02-13T14:23:12.233
> 
> 标签：excel

我有两张纸——一张是日期栏，另一栏是金额，另一张是日期和金额栏，另一栏是每个金额的描述。*****如何匹配这两列金额**？我想要一个公式告诉我第一张纸上的哪个单元格我可以找到另一张纸上也存在的一定数量。

如果有人可以帮助我，非常感谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-13T17:34:34.927

我不确定我是否理解您的问题，但听起来您想查看 MATCH 和/或 VLOOKUP 工作表函数。（MATCH 可以告诉您特定值在值列表中的位置，而 VLOOKUP 可以在列中找到一个值，然后在不同列中为您提供同一行中的值。）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-13T17:13:33.230

ADO怎么样？

```
Sub ListMatches()
Dim cn As Object
Dim rs As Object

    'http://support.microsoft.com/kb/246335 '

    strFile = Workbooks(1).FullName
    strCon = "Provider=Microsoft.Jet.OLEDB.4.0;Data Source=" & strFile _
        & ";Extended Properties=""Excel 8.0;HDR=Yes;IMEX=1"";"

    Set cn = CreateObject("ADODB.Connection")
    Set rs = CreateObject("ADODB.Recordset")

    cn.Open strCon

    strSQL = "SELECT s2.AcDate, s2.Amount, s1.Description " _
    & "FROM [Sheet2$] s2 INNER JOIN [Sheet1$] s1 " _
    & "ON s2.AcDate=s1.AcDate AND s2.Amount=s1.Amount"

    rs.Open strSQL, cn, 3, 3

    Worksheets(3).Cells(2, 1).CopyFromRecordset rs

End Sub 
```

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-02-13T14:28:16.793

如果您尝试引用另一个工作表中的单元格，请使用以下内容：

```
='SheetName'!F2 
```

其中 F2 是您要检索其值的单元格。

# java - 在 Servlet 的 destroy() 方法中调用 System.exit()

> ID：546097
> 
> 赞同：5
> 
> 时间：2009-02-13T14:23:15.777
> 
> 标签：java, tomcat, servlets, windows-services

[这是对我之前的问题](https://stackoverflow.com/questions/490792/error-1053-while-trying-to-restart-stop-tomcat-5-0-30-installed-as-a-windows-ser)的跟进。

Tomcat 5.0.28 有一个错误，即容器在关闭时没有调用 Servlet 的 destroy() 方法。这在 Tomcat 5.0.30 中已修复，但如果 Servlet 的 destroy() 方法具有 System.exit()，则会导致 Tomcat Windows 服务抛出错误 1053 并拒绝正常关闭（有关更多详细信息，请参见上面的链接这个错误）

任何人都知道是否：

*   在 Servlet 的 destroy() 方法中调用 System.exit() 以强制终止任何非守护线程是个好主意吗？

*   如果 Servlet 的 destroy() 方法中有 System.exit() ，为什么 Tomcat 5.0.30 和（包括 Tomcat 6.xx 在内的更高版本）无法正常关闭。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-02-13T14:44:40.747

> 在 Servlet 的 destroy() 方法中调用 System.exit() 以强制终止任何非守护线程是个好主意吗？

这绝对不是一个好主意——这是一个可怕的主意。当 servlet 停止服务时调用该`destroy()`方法，这可能由于多种原因而发生：servlet/webapp 已停止，webapp 正在取消部署，webapp 正在重新启动等。

`System.exit()`关闭**整个JVM**！为什么要仅仅因为一个 servlet 正在卸载就强制关闭整个服务器？

> 如果 Servlet 的 destroy() 方法中有 System.exit() ，为什么 Tomcat 5.0.30 和（包括 Tomcat 6.xx 在内的更高版本）无法正常关闭。

大概是为了防止这样的危险行为。

您不应该编写假定您的代码/应用程序是服务器上唯一运行的代码的代码。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-02-13T17:48:46.093

你问两个问题：

**问题 1：在 Servlet 的 destroy() 方法中调用 System.exit() 来强制杀死任何非守护线程是个好主意吗？**

在任何与 servlet 相关的方法中调用 System.exit() 总是 100% 不正确。您的代码不是在 JVM 中运行的唯一代码 -**即使您是唯一正在运行**的 servlet（servlet 容器具有在 JVM 真正退出时需要清理的资源。）

处理这种情况的正确方法是在 destroy() 方法中清理线程。这意味着以一种可以让您以正确的方式轻轻停止它们的方式启动它们。这是一个示例（其中 MyThread 是您的线程之一，并扩展了 ServletManagedThread）：

```
 public class MyServlet extends HttpServlet {
    private List<ServletManagedThread> threads = new ArrayList<ServletManagedThread>();     

     // lots of irrelevant stuff left out for brevity

    public void init() {
        ServletManagedThread t = new MyThread();
        threads.add(t);
        t.start();
    }

    public void destroy() {
        for(ServletManagedThread thread : threads) {
           thread.stopExecuting();
        }
    }
 }

 public abstract class ServletManagedThread extends Thread {

    private boolean keepGoing = true;

    protected abstract void doSomeStuff();
    protected abstract void probablySleepForABit();
    protected abstract void cleanup();

    public void stopExecuting() {
       keepRunning = false;
    }

    public void run() {
       while(keepGoing) {
            doSomeStuff();
            probablySleepForABit();
       }
       this.cleanup();
    }
} 
```

还值得注意的是，有一些线程/并发库可以帮助解决这个问题 - 但如果你确实有一些线程在 servlet 初始化时启动并且应该一直运行到 servlet 被销毁，这可能就是你所需要的.

**问题2：如果Servlet的destroy()方法中有System.exit()，为什么Tomcat 5.0.30及（包括Tomcat 6.xx的更高版本）无法正常关闭？**

没有更多的分析，很难确定。 [微软表示](http://support.microsoft.com/kb/839174)，当 Windows 要求关闭服务但请求超时时会出现错误 1053。这会让人觉得 Tomcat 内部发生了一些事情，使它进入了一个非常糟糕的状态。我当然怀疑您对`System.exit(`) 的调用可能是罪魁祸首。Tomcat（特别是 Catalina）确实向 VM 注册了一个关闭挂钩（`see org.apache.catalina.startup.Catalina.start()`至少在 5.0.30 中）。当您调用`System.exit()`. 关闭钩子委托给正在运行的服务，因此每个服务都可能需要做很多工作。

如果关闭挂钩 ( `triggered by your System.exit()`) 无法执行（它们死锁或类似情况），那么很容易理解为什么会发生错误 1053，给定`Runtime.exit(int)`方法的文档（从 调用`System.exit()`）：

> 如果在虚拟机开始其关闭序列之后调用此方法，则如果正在运行关闭挂钩，则此方法将无限期阻塞。如果已经运行了关闭挂钩并且已启用退出终止，则此方法会在状态非零时使用给定的状态代码暂停虚拟机；否则，它会无限期地阻塞。

这种“无限期阻塞”行为肯定会导致错误 1053。

如果您想要比这更完整的答案，您可以[下载源代码](http://archive.apache.org/dist/tomcat/tomcat-5/v5.0.30/src/jakarta-tomcat-5.0.30-src.zip)并自行调试。

但是，我敢打赌，如果您正确处理线程管理问题（如上所述），您的问题就会消失。

简而言之，将 System.exit() 调用留给 Tomcat - 这不是你的工作。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-13T15:07:57.680

> 在 Servlet 的 destroy() 方法中调用 System.exit() 以强制终止任何非守护线程是个好主意吗？

不是一个好主意。您将强制终止*所有*线程，其中可能包括当前正在关闭系统的 Tomcat 的一部分。这将导致 Tomcat 不正常地关闭。这也可以防止关闭处理程序运行，这可能导致各种问题。

> 如果 Servlet 的 destroy() 方法中有 System.exit() ，为什么 Tomcat 5.0.30 和（包括 Tomcat 6.xx 在内的更高版本）无法正常关闭。

*许多*代码在Servlet 销毁后执行。Context 销毁一个...其他 servlet 的所有其他侦听器。其他应用。雄猫本身。通过调用 System.exit，您可以阻止所有这些运行。

一个更好的问题是这些非守护线程是什么，它们为什么运行，以及谁启动它们？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-13T18:05:09.860

在编写像 Jared 那样的线程关闭代码时，我通常将“keepGoing”成员和“stopExecuting()”方法设为静态，以便所有线程都可以通过一次关闭调用获得关闭信号。好主意还是没有？

# sql - 在 SQL 更新触发器中添加约束以防止重复

> ID：546101
> 
> 赞同：1
> 
> 时间：2009-02-13T14:24:07.457
> 
> 标签：sql, triggers, sql-update, sql-insert

我们有一个用户表，每个用户都有一个唯一的电子邮件和用户名。我们尝试在我们的代码中执行此操作，但我们希望确保用户永远不会使用相同的电子邮件用户名插入（或更新）到数据库中。我添加了一个`BEFORE INSERT`触发器来防止重复用户的插入。

```
CREATE TRIGGER [dbo].[BeforeUpdateUser]
   ON  [dbo].[Users]
   INSTEAD OF INSERT
AS 
BEGIN
    -- SET NOCOUNT ON added to prevent extra result sets from
    -- interfering with SELECT statements.
    SET NOCOUNT ON;

    DECLARE @Email nvarchar(MAX)
    DECLARE @UserName nvarchar(MAX)
    DECLARE @UserId int
    DECLARE @DoInsert bit

    SET @DoInsert = 1

    SELECT @Email = Email, @UserName = UserName FROM INSERTED

    SELECT @UserId = UserId FROM Users WHERE Email = @Email

    IF (@UserId IS NOT NULL)
        BEGIN
            SET @DoInsert = 0
        END

    SELECT @UserId = UserId FROM Users WHERE UserName = @UserName

    IF (@UserId IS NOT NULL)
        BEGIN
            SET @DoInsert = 0
        END

    IF (@DoInsert = 1)
        BEGIN
            INSERT INTO Users
            SELECT 
                           FirstName, 
                           LastName, 
                           Email, 
                           Password, 
                           UserName, 
                           LanguageId,
                           Data, 
                           IsDeleted 
                       FROM INSERTED
        END
    ELSE
        BEGIN
            DECLARE @ErrorMessage nvarchar(MAX)
            SET @ErrorMessage = 
                         'The username and emailadress of a user must be unique!'
            RAISERROR 50001 @ErrorMessage
        END 
END 
```

但是对于更新触发器，我不知道该怎么做。我用谷歌找到了这个例子：http: [//www.devarticles.com/c/a/SQL-Server/Using-Triggers-In-MS-SQL-Server/2/](http://www.devarticles.com/c/a/SQL-Server/Using-Triggers-In-MS-SQL-Server/2/) 但我不知道它是否适用当您一次更新多个列时。

**编辑：**

我尝试在这些列上添加唯一约束，但它不起作用：

```
Msg 1919, Level 16, State 1, Line 1
Column 'Email' in table 'Users' is of a type 
that is invalid for use as a key column in an index. 
```

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-02-13T14:31:21.763

您可以在表上添加唯一约束，如果您尝试插入或更新并创建重复项，这将引发错误

```
ALTER TABLE [Users] ADD  CONSTRAINT [IX_UniqueUserEmail] UNIQUE NONCLUSTERED 
(
    [Email] ASC
)

ALTER TABLE [Users] ADD  CONSTRAINT [IX_UniqueUserName] UNIQUE NONCLUSTERED 
(
    [UserName] ASC
) 
```

编辑：好的，我刚刚阅读了您对另一篇文章的评论，并看到您使用 NVARCHAR(MAX) 作为您的数据类型。为什么您可能需要超过 4000 个字符的电子邮件地址或用户名？这就是你的问题所在。如果您将其减少到 NVARCHAR(250) 或附近，那么您可以使用唯一索引。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-13T14:25:50.997

听起来需要做很多工作，而不是仅仅使用一个或多个唯一索引。你没有走索引路线是有原因的吗？

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-13T14:27:21.973

为什么不在数据库中的列上使用 UNIQUE 属性？如果您尝试插入欺骗，设置将使 SQL 服务器强制执行并引发错误。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-13T14:28:17.400

为此，您应该对这些列中的每一列使用 SQL`UNIQUE`约束。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-13T14:39:37.280

只要它是一个或更少，您就可以在一个`UNIQUE INDEX`上创建一个。`NVARCHAR``NVARCHAR(450)`

你真的需要`UNIQUE`这么大的柱子吗？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-13T14:53:15.767

一般来说，我会尽可能避免使用触发器，因为除非您知道触发器存在，否则它们会使行为非常难以理解。正如其他评论员所说，唯一的约束是要走的路（一旦您修改了列定义以允许它）。

如果您发现自己需要使用触发器，这可能表明您的设计存在缺陷。仔细想想你为什么需要它，以及它是否正在执行属于其他地方的逻辑。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-07-04T01:11:01.520

请注意，如果您在 SQL Server 中使用 UNIQUE 约束/索引解决方案，则该列中只允许一个空值。因此，例如，如果您希望电子邮件地址是可选的，它就行不通，因为只有一个用户可以有一个空电子邮件地址。在这种情况下，您将不得不求助于另一种方法，例如触发器或过滤索引。

# ruby-on-rails - 从一开始就使用 ajax 创建 Web 应用程序还是稍后添加 ajax？

> ID：546109
> 
> 赞同：7
> 
> 时间：2009-02-13T14:25:31.527
> 
> 标签：ruby-on-rails, ruby, ajax

我正在开发我的第一个 Ruby on Rails 应用程序，它非常大（至少对我来说）——数据库大约有 25 个表）。我还在学习 Ruby 和 Rails，我从来没有用 Javascript 或 Ajax 写过任何东西。

我应该从一开始就将 Ajax 添加到我的应用程序中吗？或者也许稍后添加它会更好？

或者换句话说：将 ajax 添加到现有的 Web 应用程序是否（相对）容易？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-02-13T14:34:34.907

Jeremy Keith 就这个主题写了一篇很棒的文章，他称之为[Hijax](http://domscripting.com/blog/display/41)

简而言之：

*   从一开始就计划 Ajax。
*   最后实现 Ajax。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-13T14:43:43.917

取决于 Ajax 对应用程序的重要性。由于您可能只会将 Ajax 用于渐进式可用性增强，因此我认为最好从传统的非 Ajax 软件开始，并且仅在您拥有第一个功能时才添加 Ajax 功能。您可以逐个功能地执行此功能，或者先编写整个软件，然后再开始 ajaxing。

如果您熟悉不显眼的 JavaScript 技术，添加 Ajax 可能会更容易。使用[jQuery](http://jquery.com/)代替[Prototype.js](http://www.prototypejs.org/)，或者使用[LowPro](http://www.danwebb.net/2007/4/16/low-pro-0-4-released)代替Prototype.js。对于后者，请参阅 Jarkko Laine 的 PDF 书籍[Unobtrusive Prototype.js](http://peepcode.com/products/unobtrusive-prototype-js)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-13T14:33:51.507

如果你打算做 AJAX，我会从一开始就做。它将帮助您从一开始就正确地构建控制器操作和视图，尤其是在部分视图中生成一些数据方面。知道某些动作需要能够只呈现页面的一部分将改变您的设计。这并不是说你不能回去改造设计，但我认为如果你提前考虑到这一点，设计正确会更容易。您还应该考虑如何在没有 AJAX（或根本没有 javascript）的情况下使其工作，以便您的设计尽可能安全。这并不意味着所有功能都必须可用，但重要的功能在没有 javascript 的情况下工作。例如，使用 AJAX 的操作链接应该有一个默认 url，如果未启用 javascript，它将通过 GET 请求调用正确的操作。如果正常发布，通过 AJAX 发布的表单也应该可以工作。动态行为（如图片库）应该有一个可用的、可行的替代视图等。

# .net - Visual Studio - 更改类时自动刷新类视图

> ID：546113
> 
> 赞同：45
> 
> 时间：2009-02-13T14:26:52.023
> 
> 标签：.net, visual-studio, visual-studio-2008, eclipse, ide

我来自 Java 背景，并且已经使用 Eclipse 多年。我在使用 Visual Studio (2008) 时错过的一项功能是，当我更改类时，类视图不会自动刷新。在 Eclipse 中，它有一个（类）“大纲”窗口，它代表当前类并显示方法/属性等，这总是更新到正在使用的类。

VS 中等效的“类视图”不会根据我正在访问的当前类自动刷新。我想知道是否有人知道实现这一点的方法？

理想情况下，我希望 VS 视图尽可能与 Eclipse 相似，但这一特性会很棒。

提前致谢， 威尔

* * *

## 回答 #1

> 赞同：49
> 
> 时间：2009-12-10T18:41:57.123

看了kingmaxxx的回复，我去Tools->Options->Environment->Keyboard，在Text Editor视图中绑定Ctrl+Shift+C到View.SynchronizeClassView。这似乎取代和补充了原始行为 (View.ClassView)，因为如果 ClassView 不可见并专注于当前类，它将显示它。

（视觉工作室 2008）

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2009-04-09T13:22:48.317

**For Visual Studio 2005**

I found a solution that does not update the view automatically, but at least you get a context entry that helps:

[http://blogs.msdn.com/ansonh/archive/2005/12/09/502020.aspx](http://blogs.msdn.com/ansonh/archive/2005/12/09/502020.aspx)

You can also define a shortcut key:

Tools->Options->Environment->Keyboard and see if you can find "View.SynchronizeClassView".

* * *

Oh, just for laughs - here is the answer of Microsoft: [http://msdn.microsoft.com/en-us/library/2dae8h2s.aspx](http://msdn.microsoft.com/en-us/library/2dae8h2s.aspx)

> ...you can select any symbol in the Code Editor and locate it **instantly**...

After **7 Steps**...

> "Class View **automatically** scrolls to the location of the selected symbol in its hierarchy. "

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2012-11-02T02:28:06.267

最好的方法是在代码编辑器中右键单击类型时创建上下文菜单。工具->自定义 单击“命令”选项卡。选择上下文菜单单选按钮，然后选择“编辑器上下文菜单|代码窗口”。然后“添加命令”并选择 View->Synchronize Class View。

现在，每当您右键单击一个类型时，您都可以选择“同步类视图”。它是最顶部的上下文菜单项。看起来像这样： ![上下文菜单](https://i.stack.imgur.com/6YFmB.jpg)

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2009-02-13T14:40:47.480

I can't help you with the class view, but maybe you want to give the solution explorer a try? You can synchronize this one via:

```
tools -> options -> projects and solutions -> general
enable "track active item in solution explorer" 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2010-09-20T18:58:51.277

View.SynchronizeClassView 的问题是当从虚拟文件夹中查看类时不起作用。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-10-01T15:04:36.887

根据 kingmaxxx 的回复，我发现您可以在工具栏中添加一个按钮来执行相同操作：

工具|自定义 -> 命令[选项卡] -> 视图[类别]

抓住 Synchronize Class View 按钮并将其拖到您的工具栏之一。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-06-16T18:10:04.407

我还没有时间让它工作，但是这里有一个用于自动同步的 VS2003/2005 插件的代码[（](http://www.microsoft.com/communities/newsgroups/en-us/default.aspx?dg=microsoft.public.vstudio.extensibility&tid=2a8a5328-d12c-434e-a58d-0bfb400772cf&cat=&lang=&cr=&sloc=en-us&p=1)参见标有“答案”的帖子）。

顺便说一句，这个问题似乎与这个问题[重复](https://stackoverflow.com/questions/449302)。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2018-08-03T15:11:45.060

对于 Visual Studio 2017，CodeMaid Spade 非常完美地提供了救援。

[Codemaid VS 扩展](https://marketplace.visualstudio.com/items?itemName=SteveCadwallader.CodeMaid)

起初，我找不到“类视图”的等价物。它被称为铲子。

它会自动同步到当前打开的课程。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-13T14:40:18.777

I don't know of any ways to do this but I agree that it would be a nice feature.

You can track items in Solution Explorer though (Options->Project and Solutions->General->Track Active Item in Solution Explorer).

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2017-04-20T16:00:56.440

同样来自java（Eclipse），我错过了大纲（类查看器）。我尝试了很多解决方案，我发现最好的方法是使用[CODEMAID 扩展](https://marketplace.visualstudio.com/items?itemName=SteveCadwallader.CodeMaid)。

它还提供了许多其他工具，但您可以不使用它！

* * *

## 回答 #11

> 赞同：-2
> 
> 时间：2009-02-13T17:23:02.520

来自 Eclipse，您会错过很多这样的特性。我最想念的导航是一个简单的*去类型*，*去继承者*等等。其他功能，例如 nUnit 支持也不是 vanilla Visual Studio 的一部分。以下是弥补差距的加载项列表：

*   [代码拉什](http://www.devexpress.com/Products/Visual_Studio_Add-in/Coding_Assistance/)
*   [锐器](http://www.jetbrains.com/resharper/)
*   [TestDriven.net](http://www.testdriven.net/)，只是 nUnit 集成

但是缺点来了：它们都向你收费（TestDriven.net 仅用于商业用途）。但是，它们都提供免费试用。

* * *

## 回答 #12

> 赞同：-3
> 
> 时间：2009-02-13T14:40:10.947

Tools Menu -> Options

Then, in the "Project And Solutions" area, you can select to track the active item.

* * *

## 回答 #13

> 赞同：-5
> 
> 时间：2009-02-13T14:38:59.480

With Resharper, ALT+SHIFT+L goes to the current file in Solution Explorer.

# wpf - 使用 ComboBox 控制 TabControl 活动选项卡

> ID：546119
> 
> 赞同：4
> 
> 时间：2009-02-13T14:27:39.727
> 
> 标签：wpf, combobox, tabcontrol

我真正想要实现的是通过使用组合框作为导航控件来完全控制活动的 TabItem。

这是我到目前为止得到的：

```
 <TabControl Canvas.Left="26" Canvas.Top="27" Height="100" Name="TabControl1" Width="220">
        <TabItem Header="TabItem1" x:Name="TabItem1">
            <Grid />
        </TabItem>
        <TabItem Header="TabItem2" x:Name="TabItem2">
            <Grid />
        </TabItem>
    </TabControl>

    <ComboBox Canvas.Left="126" Canvas.Top="134" Height="23" Name="CmbTabs" Width="120" 
              ItemsSource="{Binding ElementName=TabControl1, Path=Items}" 
              SelectedValue="{Binding ElementName=TabControl1, Path=SelectedIndex}" 
              SelectedValuePath="TabIndex"
              DisplayMemberPath="Header"/> 
```

仍然唯一实际起作用的是当我按下组合框的切换按钮时显示的列表。即使通过列表选择一个 tabitem 名称也不会做任何事情，它甚至不会更新组合框的选定值文本框。

有什么帮助吗？

编辑：好的，史蒂夫罗宾斯的答案对于“控制”问题很有效。

在组合框下拉列表中选择一个项目不会更新组合框的值这一事实又如何呢？（组合框文本框仍然是空白的！！）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-13T14:40:07.483

如果您试图从 Combo 控制 TabControl，那么它看起来有点倒退。如果您更改选项卡控件上的 SelectedIndex 以将其绑定到组合，它应该可以工作：

```
<TabControl Canvas.Left="26" Canvas.Top="27" Height="100" Name="TabControl1" Width="220" SelectedIndex="{Binding ElementName=CmbTabs, Path=SelectedIndex}">
        <TabItem Header="TabItem1" x:Name="TabItem1">
            <Grid />
        </TabItem>
        <TabItem Header="TabItem2" x:Name="TabItem2">
            <Grid />
        </TabItem>
    </TabControl> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-09-19T01:40:33.407

我开始研究这个是因为我在组合框上遇到了一些问题。不幸的是，我还没有解决我的问题，但我可以提供一些额外的见解和解决这个问题的方法。首先，让我们从我对原始 xaml 的更改开始。

```
 <TabControl Height="100" Name="TabControl1" Width="220">
        <TabItem Header="TabItem1" x:Name="TabItem1">
            <TextBlock Text="TabItem1 Content" />
        </TabItem>
        <TabItem Header="TabItem2" x:Name="TabItem2">
            <TextBlock Text="TabItem2 Content" />
        </TabItem>
    </TabControl>

    <ComboBox Height="23" Name="CmbTabs" Width="120" 
        ItemsSource="{Binding ElementName=TabControl1, Path=Items}"
        SelectedIndex="{Binding ElementName=TabControl1, Path=SelectedIndex}"
        DisplayMemberPath="Name"
        >
    </ComboBox> 
```

请注意，我们可以在选项卡的 SelectedIndex 和组合控件之间创建一个双向绑定（本例中的默认值），而不是创建从选项卡控件到 ComboBox 的绑定，反之亦然。接下来，让我们向 TabItems 添加一些内容。在这一点上，类似于史蒂夫的建议，我们已经解决了“控制”问题。也就是说，更改选定的 TabItem 会更改选定的 ComboBox 项（您必须相信我，否则请继续阅读！）并且更改 ComboBox 会更改选定的 TabItem。伟大的！

上述 xaml 还将 DiplayMemberPath 属性更改为“名称”。我想你会发现这消除了hughdbrown的“奇怪结果”。回想一下，Header 属性（一个对象）是由 ContentPresenter 包装的。我相信如果没有提供模板，默认行为是将 Header 对象显示为 TextBlock 中的字符串。因此，“奇怪的结果”正确报告 TextBlock 控件不包含 Header 属性。

现在让我们对之前的 ComboBox xaml 进行一些更改。

```
 <ComboBox Height="23" Name="CmbTabs" Width="120" 
        ItemsSource="{Binding ElementName=TabControl1, Path=Items}"
        SelectedIndex="{Binding ElementName=TabControl1, Path=SelectedIndex}"
        >
        <ComboBox.ItemTemplate>
            <DataTemplate>
                <TextBlock Text="{Binding}"/>
            </DataTemplate>
        </ComboBox.ItemTemplate>
    </ComboBox> 
```

这实际上产生了一个有趣的结果，并利用了我们添加到每个 TabItem 的内容。当此代码运行时，您会注意到 ComboBox 现在显示所选 TabItem 的内容。此外，该列表现在为每个 TabItem 显示“System.Windows.Controls.TabItem...”。我们可以将 TextBlock 绑定更改为 {Binding Header} 并显示 Header 对象，但 ComboBox 仍然显示所选 TabItem 的内容。由于星期五晚上很晚，世界上没有足够的啤酒，我没有调查可能的原因。但是，我确实有一个解决方法！

首先，让我们创建一个 ValueConverter 来将 TabControl 的 Items 集合转换为我们可以使用的东西。这是代码。

```
public class TabItemCollectionConverter : IValueConverter
{
    #region IValueConverter Members

    public object Convert(object value, Type targetType, object parameter, System.Globalization.CultureInfo culture)
    {
        ItemCollection collection = value as ItemCollection;
        IList<string> names = new List<string>();
        foreach (TabItem ti in collection.SourceCollection)
        {
            names.Add(ti.Header.ToString());
        }
        return names;
    }

    public object ConvertBack(object value, Type targetType, object parameter, System.Globalization.CultureInfo culture)
    {
        throw new NotSupportedException();
    }

    #endregion
} 
```

转换器只是从 TabControl 的 Items 集合中创建一个新集合，该集合包含来自每个 TabItem 的字符串化 Header 对象。这适用于简单的 Header 对象，但显然有局限性。现在让我们考虑如何在 xaml 中使用它。

```
 <ComboBox Height="23" Name="CmbTabs" Width="120" 
        ItemsSource="{Binding ElementName=TabControl1, Path=Items, Converter={StaticResource ItemConverter}}"
        SelectedIndex="{Binding ElementName=TabControl1, Path=SelectedIndex}"
        >
        <ComboBox.ItemTemplate>
            <DataTemplate>
                <TextBlock Text="{Binding}"/>
            </DataTemplate>
        </ComboBox.ItemTemplate>
    </ComboBox> 
```

请记住，在 ItemsSource 绑定中使用的 ValueConverter 返回一个新集合。在本例中，我们将 TabControl 的 Items 集合转换为字符串集合。不要忘记创建转换器 StaticResource！它看起来像这样。

```
 <local:TabItemCollectionConverter x:Key="ItemConverter"/> 
```

现在，使用转换器，整个蜡球按预期工作。

仍然让我感到困惑的是，为什么 ComboBox 会在列表中显示 TabItem 标题，而将 TabItem 内容显示为选择。毫无疑问，有一些明显的解释，但正如我所说，现在是星期五......

希望这可以帮助！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-16T03:32:17.737

我一直在玩这个。在进行选择之后，ComboBox 的数据绑定的来源发生了一些变化。或者其他的东西。

我添加了诊断命名空间：

```
xmlns:debug="clr-namespace:System.Diagnostics;assembly=WindowsBase" 
```

我将您的 <Grid /> 更改为带有大喇叭数字的文本框，以便我可以看到事情确实在发生变化：

```
 <TabItem Header="TabItem1" x:Name="TabItem1">
        <TextBlock Name="tb1" FontSize="24" Text="1" Width="100" Height="26" />
    </TabItem> 
```

当我运行应用程序时，我发现诊断报告了一个奇怪的结果：

> System.Windows.Data 错误：39：BindingExpression 路径错误：在“对象”“TextBlock”（名称=“tb1”）上找不到“标头”属性。绑定表达式：路径=标题；DataItem='TextBlock' (名称='tb2'); 目标元素是'TextBlock'（名称=''）；目标属性是“文本”（类型“字符串”）

我尝试在启动时在代码中设置一次数据绑定：

```
 public Window1()
    {
        InitializeComponent();

        Binding positionBinding = new Binding("Items");
        positionBinding.ElementName = "TabControl1";
        positionBinding.Path = new PropertyPath("Items");
        positionBinding.Mode = BindingMode.OneTime;

        CmbTabs.SetBinding(ComboBox.ItemsSourceProperty, positionBinding);
        CmbTabs.DisplayMemberPath = "Header";
    } 
```

并且在选择和更改 TabItem 后，它仍然会切换 CombobBox 以显示未选择的项目。就好像在 TabControl 更改选择后 DataContext 切换到了 TabControl.TabItem.TextBlock 一样。

所以我没有确切的答案给你，但我有一些结果让你努力。

Bea Stollnitz 有一篇关于使用这种诊断技术的好文章。[“如何调试 WPF 绑定？”](http://bea.stollnitz.com/blog/?p=52)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-16T22:46:51.927

基于 Hughdbrown 的回答，我[在 MSDN 上找到了这篇文章](http://social.msdn.microsoft.com/Forums/en-US/wpf/thread/d4a123c4-f6b3-4604-bdca-94d5649fc9b7/)，将您的问题描述为一个错误。您可以使用此 XAML 重现它（与您的 XAML 存在相反的问题）：

```
<Canvas xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
    <TabControl Name="TabControl1" Width="220" Height="100" Canvas.Left="26" Canvas.Top="27">
        <TabItem x:Name="TabItem1" Header="TabItem1">
            foobar
        </TabItem>
        <TabItem x:Name="TabItem2" Header="TabItem2">
            fizzbuzz
        </TabItem>
    </TabControl>
    <ComboBox Name="CmbTabs" Width="120" Height="23" Canvas.Left="126" Canvas.Top="134"
              ItemsSource="{Binding ElementName=TabControl1, Path=Items}"
              DisplayMemberPath="Length"
              SelectedIndex="{Binding ElementName=TabControl1, Path=SelectedIndex}"/>
</Canvas> 
```

正如您所看到的，长度绑定工作正常，除了在下拉列表中，它离开 TabItem 而不是里面的字符串。

我不确定它是否适合您的目的，但您可以通过稍微不那么优雅并在 ComboBoxItems 中复制标题来解决它：

```
<Canvas xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
    <TabControl Name="TabControl1" Width="220" Height="100" Canvas.Left="26" Canvas.Top="27">
        <TabItem x:Name="TabItem1" Header="TabItem1">
            <Grid/>
        </TabItem>
        <TabItem x:Name="TabItem2" Header="TabItem2">
            <Grid/>
        </TabItem>
    </TabControl>
    <ComboBox Name="CmbTabs" Width="120" Height="23" Canvas.Left="126" Canvas.Top="134"
              SelectedIndex="{Binding ElementName=TabControl1, Path=SelectedIndex}">
        <ComboBoxItem>TabItem1</ComboBoxItem>
        <ComboBoxItem>TabItem2</ComboBoxItem>
    </ComboBox>
</Canvas> 
```

# asp.net - 使用 jquery 将数据表转换为 Json

> ID：546121
> 
> 赞同：6
> 
> 时间：2009-02-13T14:28:08.213
> 
> 标签：asp.net, jquery, json, .net-3.5, datatable

我正在尝试执行一个 Web 服务，该服务返回一个带有以下代码的 DataTable：

```
$.ajax({  
    type: "POST",  
    url: url,  
    data: data,   
    contentType: "application/json; charset=utf-8",  
    dataType: "json",  
    success: function(msg) {  
        //do things  
        }  
    }); 
```

如果 web 服务返回一个类，那么它就可以工作，所以它与输入参数等无关。它只会在 web 方法返回数据表时失败（数据表只有 2 列和 2 行用于我正在做的测试）。

WebService 类用 [ScriptService] 属性修饰，所以我认为 ASP.NET 会自动将返回值序列化为 JSON。它似乎不适用于数据表。

我发现的唯一解决方案是返回一个字符串（手动 JSON 序列化对象），但这样做对我来说似乎不合适。
我正在使用带有 .Net 3.5 的 Visual Studio 2008

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-20T10:55:15.707

最后，我决定使用 JavaScriptSerializer 类将 DataTable 转换为 JSON 字符串。不幸的是，此类不适用于 DataTable，因此我将 DataTable 转换为字典列表并将该列表传递给 JavaScriptSerializer 类。它只需要几行代码就可以正常工作。
VB.net 中的示例：

```
 Public Function GetJson(ByVal dt As DataTable) As String

        Dim serializer As System.Web.Script.Serialization.JavaScriptSerializer = New System.Web.Script.Serialization.JavaScriptSerializer()
        Dim rows As New List(Of Dictionary(Of String, Object))
        Dim row As Dictionary(Of String, Object)

        For Each dr As DataRow In dt.Rows
            row = New Dictionary(Of String, Object)
            For Each col As DataColumn In dt.Columns
                row.Add(col.ColumnName, dr(col))
            Next
            rows.Add(row)
        Next
        Return serializer.Serialize(rows)
    End Function 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2010-08-05T17:07:21.467

最简单的方法是使用 LINQ to DataSet 扩展。首先需要使用 LINQ to DataSet 从 DataTable 创建一个通用列表（SearchSerialResults 在这种情况下只是一个 DTO）。

```
var resultItems = (from DataRow dr in _returnedData.AsEnumerable() select new SearchSerialResults {
  ContractLineItem = (int) dr["fldContractLineItemID"],
    SearchItem = (string) dr["Search Item"],
    Customer = (string) dr["Customer"],
    DeviceFound = (string) dr["Device Found"],
    Country = (string) dr["Country"],
    City = (string) dr["City"],
    ContractNumber = (string) dr["Contract Number"],
    QuoteNumber = (string) dr["Quote Number"],
    BeginDate = (string) dr["Begin Date"],
    EndDate = (string) dr["End Date"]
}).ToList(); 
```

_returnedData 在这种情况下是 DataTable。第 2 步是进行转换。在这种情况下，我为 jqGrid 返回一个 Json 对象。

```
var jsonObject = new {
  total = totalPages,
    pageSize,
    records = totalRecords,
    rows = (from SearchSerialResults item in resultItems select new {
      id = item.ContractLineItem,
        cell = new [] {
          item.ContractLineItem.ToString(),
            item.SearchItem,
            item.DeviceFound,
            item.Customer,
            item.ContractNumber,
            item.QuoteNumber,
            item.Country,
            item.City,
            item.BeginDate,
            item.EndDate,
            ""
        }
    }).ToArray()
};
return Json(jsonObject) // for MVC 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-13T23:43:50.327

Json.NET 能够将 DataSets/DataTables 写入 JSON。

[http://james.newtonking.com/archive/2008/09/06/dataset-datatable-serialization-with-json-net.aspx](http://james.newtonking.com/archive/2008/09/06/dataset-datatable-serialization-with-json-net.aspx)

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2010-05-12T16:24:56.210

[http://schotime.net/blog/index.php/2008/07/27/dataset-datatable-to-json/](http://schotime.net/blog/index.php/2008/07/27/dataset-datatable-to-json/)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2012-09-07T18:48:44.817

它对我来说非常适合使用 WebService

```
 Imports System.Web.Script.Serialization

    Dim wsServicio As New ["YourWsInstance"]
    Dim dsInstEstado As New DataSet
    Dim sSql As String

    sSql = " Your SQL Statement"
    dsInstEstado = wsServicio.getData("YourWebServiceParameters")
    Dim jsonString = DataTableToJSON(dsInstEstado.Tables("CA_INSTITUCION"))
    Return Json(jsonString, JsonRequestBehavior.AllowGet)

    Function DataTableToJSon(dt As DataTable) As Object
    Dim arr(dt.Rows.Count - 1) As Object
    Dim column As DataColumn
    For i = 0 To dt.Rows.Count - 1
        Dim dict As New Dictionary(Of String, Object)
        For Each column In dt.Columns
            dict.Add(column.ColumnName, dt.Rows(i)(column))
        Next
        arr(i) = dict
    Next
   Return arr
 End Function 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-13T14:38:10.217

我必须承认我并不感到惊讶——`DataTable`基本上打破了结构化数据的大部分规则。为什么不简单地将数据表投影到类型化对象中呢？之前出现了一个[相关问题](https://stackoverflow.com/questions/545328/asp-net-potential-memory-leaks-converting-datatable-to-lists)......或者如果您知道`DataTable`在 C# 中进行转换的架构......

手动构建 JSON 可能有效，但有很多边缘情况需要避免；老实说，我宁愿让现有的框架来处理它。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-13T14:43:42.763

.Net 3.5 有一个 JSONSerializer 应该能够处理数据表。您可能想再次查看您的服务代码并尝试让它使用它。[另外，我在这个问题](https://stackoverflow.com/questions/451460/datatable-to-json)中将一些代码放在一起手动完成。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-20T07:07:41.073

像 Marc 一样，DataTable 破坏了您的 webservice/json 交换，我也并不感到惊讶。我也想支持 Json.NET。

但是如果您决定不使用它，您仍然不必手动构建 json。只需使用您需要的所有属性创建您自己的精益自定义类，然后返回该类的数组。当然，您必须编写代码将数据表“转换”为新类。我知道，这可能需要编写大量代码，但与尝试手动创建 json 字符串相比，它更不容易出错。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2012-07-15T03:02:15.103

我发现这个 C# 类非常有用：

```
[Serializable]
public class TableMethod
{
    private int m_total; public int total { get { return this.m_total; } set { this.m_total = value; } }
    private int m_page; public int page { get { return this.m_page; } set { this.m_page = value; } }
    private int m_records; public int records { get { return this.m_records; } set { this.m_records = value; } }
    private IList<RowElement> m_rows; public IList<RowElement> rows { get { return this.m_rows; } set { this.m_rows = value; } }
    public TableMethod()
    {
        this.m_records = 20;
        this.m_total = 20;
        this.m_page = 1;
    }
}
[Serializable]
public class RowElement
{
    public string id;
    public string[] cell;
} 
```

# java - Colt Java 矩阵库中的浮点错误

> ID：546129
> 
> 赞同：0
> 
> 时间：2009-02-13T14:30:21.560
> 
> 标签：java, matrix, floating-point, colt

如何避免使用 Colt 矩阵库执行的财务计算中的浮点错误？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-13T14:31:57.813

Some essential reading about the nastiness of floating point types: [What Every Computer Scientist Should Know About Floating Point Arithmetic](http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.22.6768)

And something more Java flavoured: [How Java’s Floating-Point Hurts Everyone Everywhere](http://www.cs.berkeley.edu/~wkahan/JAVAhurt.pdf)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-13T15:37:32.867

一种常见的技术是使用整数并自己跟踪小数。例如，您可以决定您所有的货币金额都将以小数点后 3 位的精度表示。所以不要写：

```
double dollars = 10.05d; 
```

你写

```
int dollars = 10050; 
```

当您要打印金额时：

```
System.out.println( dollars/100d ); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-13T17:49:56.793

对于财务来说，使用 BigDecimal 和相关类更为常见。float 和 doubles 在任何情况下都非常容易出现舍入错误。

如果您决定尝试 BigDecimal，您可能需要查看[Apache Commons Math 。](http://commons.apache.org/math/api-1.0/org/apache/commons/math/linear/BigMatrixImpl.html "阿帕奇公共数学")

# formula - Lens correction projection

> ID：546138
> 
> 赞同：4
> 
> 时间：2009-02-13T14:32:26.563
> 
> 标签：formula, projection, photography, photogrammetry

What is the simplest way to un-warp a photo made using fisheye or wide-angle lens? I'm looking a pixel projection formula that has few parameters. Camera and lens parameters will not be known, so user has to change the parameters visually. Thanks

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-13T16:25:38.040

[这里](http://www.vassg.hu/pdf/vass_gg_2003_lo.pdf)有一篇很好的论文，它为镜头失真提供了一些看起来不错的数学模型。至少是这样。我认为 SDX2000 的网格在正确的轨道上。我认为解决问题的最常见方法是将图像映射到网格，然后允许应用扭曲参数来产生枕形和桶形失真。以 Lightroom 或 Photoshop 中的镜头失真滤镜为例。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2014-07-29T15:39:59.323

[ImageMagick](http://www.imagemagick.org/Usage/lens/)进行了精彩的讨论。他们给出了他们使用的方程式。

请注意，这并不能以与 Photoshop CS6 相同的方式校正失真（即，您不能从 Adob​​e 镜头配置文件中获取系数并简单地将它们放入）。

[卡米尔指出的那篇论文](http://www.vassg.hu/pdf/vass_gg_2003_lo.pdf)似乎是一篇极好的深入研究。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-02-13T14:57:15.117

I would assume you could use the lens equation to do it.

> 1/f = 1/object_distance + 1/image_distance

Where f is the focal length (the user input). The ratio of image distance and object distance could be used to resize the image appropriately, using the magnification equation. To get what you really want, then, you need to restructure the equation:

> 1/object_distance = 1/f - 1/image_distance

And then use the magnification equation to use the object height to resize:

> -image_distance/object_distance = image_height/object_height

The catch, as you may have noticed, is that you need to know the distance each pixel is away from the camera. Otherwise, it simply doesn't work. You could ask the user for that information, but that seems unlikely, and painful. I don't know of any other way to do it-- lens distortion is a 3D effect, and you're given 2D information. At best you can attempt to correct it two-dimensionally, but this will be difficult, and won't work properly.

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-02-13T16:08:42.357

如果可能，您应该要求用户使用同一台相机拍摄参考图像（例如棋盘）的照片，然后使用此信息来分析镜头特性。然后，此信息可用于对同一相机拍摄的其他照片进行反变形。

对于实现，您可以使用神经网络/遗传算法。

# asp.net - 加载数据时更改处理页面是asp.net

> ID：546139
> 
> 赞同：0
> 
> 时间：2009-02-13T14:32:39.823
> 
> 标签：asp.net, onload

如何在asp.net中加载某个数据显示页面时显示处理页面？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-13T14:53:11.583

我仍然喜欢经典的 2 页解决方案。第一页有一个执行“window.location = 'Page2.asp';”的 BODY ONLOAD 调用。这将导致显示第一页并调用第二页。当第二页正在工作时，第一页仍然显示。

这个解决方案有几个“问题”：

*   用户点击刷新不会将他们带到第一页（他们在第二页，点击刷新将再次开始第二页加载）。
*   这依赖于第二页一次发送所有结果（基本上是“缓冲的”，这是默认设置）。

您也可以使用 AJAX 执行此操作（全部在一个页面上）：

1.  显示等待消息
2.  使用 AJAX 加载请求启动工作
3.  加载完成后，将页面或标题重新构建到“已完成”页面。

AJAX 很好，除了它可能隐藏发生的任何服务器端错误（即，如果页面严重崩溃）。这也取决于你喜欢如何做 ajax（jQuery vs ASP.NET Ajax vs XYZ）。

# java - 将 JTextField 添加到 JPanel 并显示它们

> ID：546144
> 
> 赞同：7
> 
> 时间：2009-02-13T14:34:17.137
> 
> 标签：java, swing, jpanel, jtextfield

我正在 NetBeans 中使用 Java 和 Swing 构建一个小应用程序。使用 NetBeans 设计窗口，我创建了一个带有 JPanel 的 JFrame。

现在我想动态添加一些 jTextFields 到 JPanel。我写了这样的东西：

```
Vector textFieldsVector = new Vector();
JTextField tf;
int i = 0;
while (i < 3) {
    tf = new JTextField();
    textFieldVector.add(tf);
    myPanel.add(tf); //myPanel is the JPanel where I want to put the JTextFields
    i++;
}
myPanel.validate();
myPanel.repaint(); 
```

但是什么也没有发生：当我运行应用程序时，JFrame 会显示其中的 JPanel，但 JTextFields 不会。

我是编写图形 Java 应用程序的新手，所以我肯定遗漏了一些非常简单的东西，但我看不出是什么。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-13T15:01:31.487

在 Netbeans GUI 中，将布局管理器设置为类似 GridLayout 或 FlowLayout（仅用于测试）。您可以通过转到 GUI 编辑器，单击面板，然后右键单击并选择布局来完成此操作。

更改为不同的布局后，转到属性并更改布局属性。对于 GridLayout，您要确保有 3 个网格单元。

尝试使用 myPanel.revalidate()，而不是 myPanel.validate()。

更规范的方法是创建一个自定义 JPanel（不使用 GUI 编辑器），它设置自己的布局管理器、使用组件填充自身等。然后，在 Netbeans GUI 编辑器中，拖放该自定义 JPanel进入 gui 编辑器。Matisse 当然能够处理 Swing 组件的运行时修改，但这不是使用它的正常方式。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-13T14:52:38.717

自从我做了一些 Swing 已经有一段时间了，但我认为你需要调用 pack() 来告诉框架重新布局它的组件

编辑：是的，我知道我做 Swing 已经太久了。我敲开了以下代码，它按预期工作，并添加了文本字段......

```
 JFrame frame = new JFrame("My Frame");
    frame.setSize(640, 480);
    JPanel panel = new JPanel();
    panel.add(new JLabel("Hello"));
    frame.add(panel);
    frame.setLayout(new GridLayout());
    frame.pack();
    frame.setVisible(true);
    Vector textFieldVector = new Vector();
    JTextField tf;
    int i = 0;
    while (i < 3) {
        tf = new JTextField();
        textFieldVector.add(tf);
        panel.add(tf); //myPanel is the JPanel where I want to put the JTextFields
        i++;
    }
    panel.validate();
    panel.repaint(); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-13T14:47:20.477

你的 while 循环是错误的。`i`永远不会增加，因此您的窗口创建处于无限循环中，并且您的 CPU 消耗应该是 100%，直到您中止程序。此外，当您运行程序时，GUI 应该完全没有响应。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-13T14:53:25.827

通常的使用方法`GroupLayout`是将组件添加到`Group`. `GroupLayout`保留`Container`对它负责的引用（这是有道理的）。您不应该在没有约束的情况下将组件添加到面板中。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-01-27T20:05:57.773

不要将 GroupLayout 与新的（动态添加的）组件一起使用。它不会出现。

* * *

## 回答 #6

> 赞同：-3
> 
> 时间：2010-06-12T04:09:19.597

只需使用`.setVisible()`JTextField 的方法：

```
JTextField tf = new JTextField() ;
tf.setVisible(true) ;
panel.add(tf) ; 
```

# php - PHP反序列化问题

> ID：546149
> 
> 赞同：6
> 
> 时间：2009-02-13T14:35:20.847
> 
> 标签：php, serialization

为什么反序列化不恢复我的数组？见下面的代码..

```
// prints a:1:{s:8:"txn_type";s:32:"recurring_payment_profile_cancel";}
echo $item['response']; 

// prints nothing
print_r(unserialize($item['response'])); 
```

我明白为什么 print_r($response) 什么也没给我

** 编辑 - 我注意到了这一点

注意：unserialize() [function.unserialize]：第 13 行 /home/reitinve/public_html/action/doc.php 中 2797 个字节的偏移量 6 处出错

这意味着什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-13T14:45:14.910

是否可能`$item['response']`在它之前或之后包含一些空格？

支票`strlen($item['response'])`给你 61。

编辑：它似乎在结尾处使用空格，但开头的空格会使其无法反序列化。

编辑：该错误消息意味着您有很多空白（几乎 2kb），或者`$item['response']`在`echo``unserialize`

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-13T14:41:03.440

对我有用。你确定那`$item['response']`是一个字符串吗？是的，似乎是领先的空格。

并且在您的开发服务器上，php 永远不应该给您任何东西。它应该配置为产生所有错误、警告和通知。您也可以使用[http://php.net/var_dump](http://php.net/var_dump)而不是 print_r，因为它可以为您提供更多信息。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-03-12T08:51:13.263

这就是我遇到这个问题的原因以及我是如何解决的：

我在输入中存储了一个数组，类似于：

```
value="<?php echo htmlspecialchars(serialize(array($a, $b))); ?>" 
```

`htmlspecialchars()`在这里，由于可能的解析错误 ，我不得不使用。

然后当我尝试反序列化时，它给了我这个`Error at offset X of Y bytes in ...`错误。我将未序列化的字符串打印到屏幕上，意识到某些字符的 html 等效项导致了错误。

更清楚地说，双引号 html 代码`%22`导致了这个错误。所以我用引号字符替换了它们，它起作用了。

```
unserialize(str_replace('%22', '"', $_POST['serialized'])); 
```

所以最好检查序列化的字符串中是否有任何html代码，并用原始字符替换它们。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2016-06-29T15:46:52.107

如果您尝试将序列化数组放入 textarea 中，并最终通过 Ajax 将其传递到其他地方，您可能会遇到特殊字符（例如将转换为“&”）的问题足以让您的“序列化”数组无法恢复。

我发现 rawurlencode 和 rawurldecode 的使用对我的序列化非常有帮助，无论它是如何在我的脚本中进行的；

```
$myArray = array("Bugs Bunny", "Tom & Jerry");

$serialized = rawurlencode(serialize($myArray));

$myUnserializedArray = rawurldecode(unserialize($serialized)); 
```

# .net - 在数据库中浮动到 ? 在 .NET 中

> ID：546150
> 
> 赞同：36
> 
> 时间：2009-02-13T14:35:32.907
> 
> 标签：.net, sql-server, types, floating-point, double

如果您在 MSSQLServer 中有一个浮点数，那么您在 .NET 中将其映射到什么？

您可以将其转换为 Double 还是会丢失数字？

* * *

## 回答 #1

> 赞同：76
> 
> 时间：2009-02-13T14:39:58.013

SQLServer`float`和 C#/VB`double`具有相同的表示形式。这是正确的映射。您不想做的是将 SQL Server 映射`float`到 C#/VB `float`，因为这可能会导致精度损失。SQL Server`real`映射到 C#/VB `float`。

T-SQL float 和 real 类型定义可以在[MSDN](http://msdn.microsoft.com/en-us/library/ms173773.aspx)中找到。C# 双重定义也可以在[MSDN](http://msdn.microsoft.com/en-us/library/678hzkk9.aspx)上找到，浮点[定义](http://msdn.microsoft.com/en-us/library/b1e65aza.aspx)也可以。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-02-27T16:36:41.663

查看：

*   [SQL Server 数据类型及其 .NET Framework 等效项 (msdn)](http://msdn.microsoft.com/en-us/library/ms131092(SQL.90).aspx)，以提供有关 SQL Server 和 .Net 之间数据类型映射的完整参考

在您的情况下，SQL Server 本机类型**浮点**映射到 SQL Server CLR **SqlDouble**，然后在 .Net 中映射到**Double**

**更新（2016 年 5 月）**：

msdn 文档的更新版本：[映射 CRL 参数数据](https://msdn.microsoft.com/en-us/library/ms131092%28v=sql.130%29.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-13T14:38:05.553

C# 有一个 float 类型，但它也可以转换为 double 类型。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-13T14:39:39.667

据我回忆，大部分 ORM 工具都会将其映射为 Decimal 类型，不会像 double 或 float 那样丢失精度。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-13T14:43:32.077

这取决于 SQL 浮点数的大小。对于等同于 float(53) 的普通“float”，您需要使用 C# double。对于 float(24) 或更低，C# float 就足够了，或者 double 也可以。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-13T14:46:01.447

Microsoft XSD 生成的自动代码将 SQL 浮点数（默认浮点数）转换为 C# 双精度。
所以你可以建议这不是大错误。
直到您使用具有默认大小的浮点数。

# xslt - 如何获取 XSLT 文件中的当前文件夹路径？

> ID：546152
> 
> 赞同：18
> 
> 时间：2009-02-13T14:36:14.853
> 
> 标签：xslt

有没有办法从 XSLT 文件中获取当前文件夹路径？

我需要它来定位其他 XML 和 XSLT 文件。我们有不同的客户文件夹，需要成功找到正确的文件。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-13T14:46:46.607

[您可以使用xsl:param](http://www.w3schools.com/XSL/el_param.asp)从外部将其发送到样式表中。然后你需要确定从外部调用时当前路径是什么;）

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-13T14:53:46.293

在 Windows 上的 MSXSL 中，您可以使用如下脚本扩展：

```
<xsl:stylesheet version="1.0"
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
  xmlns:msxsl="urn:schemas-microsoft-com:xslt"
  xmlns:user="http://tempuri.org/msxsl"
>

  <msxsl:script language="JScript" implements-prefix="user">
<![CDATA[
var fso = new ActiveXObject("Scripting.FileSystemObject");

function getCurrentPath(){
  return fso.GetFolder(".").Path
}
]]>
  </msxsl:script>

  <xsl:template match="/">
    <xsl:value-of select="user:getCurrentPath()"/>
  </xsl:template>

</xsl:stylesheet> 
```

其他 XSL 处理器支持类似的方法来使用外部资源（脚本语言、函数库等），因此这只是一个示例。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-02-13T17:35:09.357

> 有没有办法从 xslt 文件中获取当前文件夹路径？
> 
> 需要它来定位其他 xml 和 xslt 文件

**不需要任何扩展函数甚至参数来做到这一点！**

or指令的属性中使用的任何***相对***URL 都是基于当前 XSLT 样式表的 URL 解析的——它只需要一个 URL，在上面的问题中明确表示为 true。这在导入/包含 XSLT 样式表时非常方便。`href`[**`<xsl:import>`**](http://www.w3.org/TR/xslt#import)[**`<xsl:include>`**](http://www.w3.org/TR/xslt#include)

**该** **函数还将以类似的方式解析相对 URL**，从而使任何其他 XML 文档都可以使用相对 URL 进行访问。[**`document()`**](http://www.w3.org/TR/xslt#document)

 ****最后，这里有** [**一个示例**](http://fxsl.cvs.sourceforge.net/viewvc/fxsl/fxsl-xslt2/f/func-standardXpathFunctions.xsl?revision=1.9&view=markup&sortby=date) 如何在大型XSLT 函数和模板库 ( [**FXSL 2.x**](http://fxsl.sf.net) **)中大量使用这些工具**：[](http://fxsl.sf.net)

 **```
<xsl:stylesheet version="2.0"
 xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
 xmlns:xs="http://www.w3.org/2001/XMLSchema"
 xmlns:f="http://fxsl.sf.net/"
 exclude-result-prefixes="xs xdt f"
>
<!--
       This module contains the FXSL versions of the "standard" XPath functions

       These are intended as convenience functions, so that they can be passed 
       as parameters to other functions (e.g. to f:zipWith())                  
       or curried and passed as parameters (e.g. to f:map())                   
-->

 <xsl:import href="func-curry.xsl"/>
 <xsl:import href="func-compose-flist.xsl"/>

 <xsl:import href="func-standardArithmeticXpathFunctions.xsl"/>
 <xsl:import href="func-standardBooleanXpathFunctions.xsl"/>
 <xsl:import href="func-standardStringXpathFunctions.xsl"/>
 <xsl:import href="func-standardNodesXpathFunctions.xsl"/>
 <xsl:import href="func-standardSequencesXpathFunctions.xsl"/>
 <xsl:import href="func-standardAggregateXpathFunctions.xsl"/>
 <xsl:import href="func-standardDateTimeXpathFunctions.xsl"/>
 <xsl:import href="func-standardXSLTXpathFunctions.xsl"/>
 <xsl:import href="func-standardAxisXpathFunctions.xsl"/>

</xsl:stylesheet> 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2011-12-22T17:57:48.470

这可能适用于您的设置：

```
<xsl:value-of select="system-property('user.dir')"/> 
```

例如，

```
<xsl:value-of select="document(concat(system-property('user.dir'),'/',filename,'.xml'))//title[1]"/> 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-02-13T14:46:09.120

不...
但是您可以通过使用相对 URL 和/或将参数传递到样式表来解决该问题。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-02-13T14:58:22.727

在大多数 XSLT 处理器中，您可以添加自定义函数作为扩展。例如，这里是[Saxon 的文档](http://www.saxonica.com/documentation/extensibility/intro.html)如何做到这一点。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-02-13T14:50:05.383

不是 AFAIK（尽管你总是可以将它作为参数传递给转换），但我不清楚为什么相对路径在这里对你不起作用。

# erlang - Erlang是用什么写的？

> ID：546160
> 
> 赞同：113
> 
> 时间：2009-02-13T14:39:32.773
> 
> 标签：erlang, bootstrapping

爱立信的 Erlang 和 Erlang/OTP 实现是用什么编写和编译的？是汇编、C 还是 Erlang 本身？

更新 1：感谢 DrJokepu。如果我理解正确，Erlang source-to-VM 编译器是用 Erlang 本身编写的。但是 VM 是用 C 编写的。

更新 2：Hynek-Pichi-Vychodil 指出了很多细节。

*   VM 和 HW 交互驱动程序：在 C 中。
*   编译器（到 VM）和库：在 Erlang 中。
*   扩展：可以通过用该语言编写端口或 Erlang 节点来使用任何语言。

* * *

## 回答 #1

> 赞同：146
> 
> 时间：2009-02-13T15:05:45.610

Erlang 本身是用 Erlang 编写的。听起来很奇怪？是的，因为它只是部分正确。好的，更详细地看一下：

1.  Erlang 预处理器是用 Erlang 编写的。
2.  Erlang 解析器是用 Erlang 编写的。
3.  Erlang 编译器到 BEAM（字节码 VM）是用 Erlang 编写的。
4.  到 HiPE（本地 VM 扩展）的 Erlang 编译器是用 Erlang 编写的。
5.  Erlang VM BEAM 和 HiPE 主要是用 C 编写的。
6.  链接驱动程序主要是用 C 语言编写的。（它们被插入到 VM 并服务于与外部世界的通信。）
7.  OTP 是用 Erlang 编写的。
8.  另一个端口或节点可以用任何语言编写。

* * *

## 回答 #2

> 赞同：93
> 
> 时间：2009-02-13T14:50:20.873

来自[Erlang 常见问题解答](http://erlang.org/faq/academic.html#idp33045264)：

> ## 10.6 第一个 Erlang 编译器是如何编写的？
> 
> （或者：**Erlang 是如何引导的？**）用乔的话来说：
> 
> 首先，我设计了一个抽象机器来执行 Erlang。这被称为 JAM 机器；JAM = 乔的抽象机器。
> 
> 然后我写了一个从 Erlang 到 JAM 的编译器和一个模拟器，看看机器是否工作。这两个都是用prolog写的。
> 
> 与此同时，Mike Williams 为 JAM 编写了一个 C 仿真器。
> 
> 然后我用 Erlang 重写了 erlang-to-jam 编译器，并使用 prolog 编译器进行编译。生成的目标代码在 C 模拟器中运行。然后我们扔掉了序言。

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2013-06-11T10:24:58.907

*   65.9% 的 Erlang 代码是用 Erlang 编写的。
*   13.4% 的 erlang 是用 XML 编写的。
*   13.6% 的 erlang 是用 C 编写的。
*   1.4% 的 erlang 是用 C++ 编写的
*   ...

[您可以在ohloh](https://www.ohloh.net/p/erlang/analyses/latest/languages_summary)站点中看到实时和更新统计信息，该报告从主 erlang git 存储库生成。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2019-11-22T12:18:57.477

我可以说 Erlang 最初是用 C/C++ 编写的，因为我不能说 Java 是用 java 编写的......但它是框架和一些库。关于 Erlang，因为它是首选的编程语言，适用于电信系统......为了保持敏捷性（例如：在聊天机器人中）我知道它的编译器或 PreProcessor 是用 Erlang 编写的。但是语言的其他功能是用低级语言编写的。

# php - 猜数字游戏的问题

> ID：546173
> 
> 赞同：1
> 
> 时间：2009-02-13T14:41:12.893
> 
> 标签：php

嘿，我非常接近完成我的猜数字游戏，在 PHP 中非常简单，但由于某种原因我被卡住了。我以隐藏形式存储变量，但显然每次发送页面时都会重置数字，因此您永远无法获得正确的数字。

有任何想法吗？我的代码如下。

```
<?php
// generate a random number for user to guess
$number = rand(1,100);

if($_POST["guess"]){

    // grab the user input guess
    $guess  = $_POST['guess'];
    $numbe  = $_POST['number'];
    if ($guess < $number){ 
        echo "Guess Higher";
    }elseif($guess > $number){       
        echo "Guess Lower";
    }elseif($guess == $number){      
        echo "You got it!";
    }
    echo "<br />Random Number:".$number."<br />";
    echo $guess;
}
?>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Guess A Number</title>
</head>

<body>
<form action="<?=$_SERVER['PHP_SELF'] ?>" method="post" name="guess-a-number">
    <label for="guess">Guess A Number:</label><br/ >
    <input type="text" name="guess" />
    <input name="number" type="hidden" value="<?= $number ?>" />
    <input name="submit" type="submit" />
</form>
</body>
</html> 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-13T14:43:07.117

是因为这个错别字吗？

```
$numbe  = $_POST['number'];
//numbe -> number 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-13T14:45:10.153

改变：

```
// generate a random number for user to guess
$number = rand(1,100); 
```

到：

```
if(isset($_POST['number'])) {
   $number = $_POST['number'];
} else {
   $number = rand(1,100);
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-13T14:55:44.463

我意识到你可能刚刚开始，但你越早学习这些东西越好：

```
echo "<br />Random Number:".$number."<br />"; 
```

这让您容易受到 XSS 攻击 - 我可以发送`$_POST['number']`为`<script> doSomethingBad(); </script>`

您应该将其转换为整数 ( `$number = (int)$_POST['number']`) 或转义输出 ( `echo htmlspecialchars($_POST['number']);`)

当然也一样`$guess`。

有趣的是，如果你使用 mod_rewrite，`$_SERVER['PHP_SELF']`也可以被操纵来做同样的事情。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-13T14:47:43.017

执行以下操作：

```
$number  = $_POST['number'];
if ($number == null) {
    $number = rand(1,100);
} 
```

# perl - 从 Perl 子例程返回整个数组是否效率低下？

> ID：546175
> 
> 赞同：16
> 
> 时间：2009-02-13T14:43:23.900
> 
> 标签：perl, function, reference, pass-by-reference

我经常在 Perl 中有一个用一些信息填充数组的子例程。由于我也习惯于使用 C++ 进行黑客攻击，因此我发现自己经常在 Perl 中这样做，使用引用：

```
my @array;
getInfo(\@array);

sub getInfo {
   my ($arrayRef) = @_;
   push @$arrayRef, "obama";
   # ...
} 
```

而不是更直接的版本：

```
my @array = getInfo();

sub getInfo {
   my @array;
   push @array, "obama";
   # ...
   return @array;
} 
```

当然，原因是我不希望在子例程中本地创建数组，然后在返回时复制。

是对的吗？或者 Perl 会优化它吗？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-02-13T14:55:32.220

首先返回一个数组引用怎么样？

```
sub getInfo {
  my $array_ref = [];
  push @$array_ref, 'foo';
  # ...
  return $array_ref;
}

my $a_ref = getInfo();
# or if you want the array expanded
my @array = @{getInfo()}; 
```

根据德曼的评论编辑：

也可以在函数中使用普通数组并返回对它的引用。

```
sub getInfo {
  my @array;
  push @array, 'foo';
  # ...
  return \@array;
} 
```

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-02-13T15:11:27.470

传递引用效率更高，但差异没有 C++ 中那么大。参数值本身（这意味着：数组中的值）总是通过引用传递（尽管返回的值被复制）。

问题是：重要吗？大多数时候，它没有。如果您要返回 5 个元素，请不要担心。如果您要返回/传递 100'000 个元素，请使用引用。只有当它是一个瓶颈时才优化它。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-02-13T15:45:37.653

如果我查看您的示例并考虑您想要做什么，我习惯于以这种方式编写它：

```
sub getInfo {
  my @array;
  push @array, 'obama';
  # ...
  return \@array;
} 
```

当我需要返回大量数据时，这对我来说似乎是一个*简单的版本。*不需要像您在第一个代码片段中编写的那样在外部*分配*数组，因为它是为您完成的。无论如何，您不应该像[Leon Timmermans](https://stackoverflow.com/users/4727/leon-timmermans)[建议](https://stackoverflow.com/questions/546175/returning-a-whole-array-from-a-function-is-it-inefficient/546305#546305)的那样进行过早的优化。`sub``my`

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-02-13T15:38:35.390

为了回答最后的思考，不，Perl 并没有优化这一点。它不能，真的，因为返回一个数组和返回一个标量是根本不同的。

如果您正在处理大量数据，或者如果性能是一个主要问题，那么您的 C 习惯将很好地为您服务 - 传递和返回对数据结构的引用而不是结构本身，这样它们就不需要被复制。但是，正如 Leon Timmermans 所指出的，在绝大多数情况下，您处理的数据量较小，性能并不是什么大问题，因此请以任何看起来最易读的方式进行。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-13T17:38:20.720

这是我通常返回数组的方式。

```
sub getInfo {
  my @array;
  push @array, 'foo';
  # ...
  return @array if wantarray;
  return \@array;
} 
```

这样，它将以您想要的方式在标量或列表上下文中工作。

```
my $array = getInfo;
my @array = getInfo;

$array->[0] == $array[0];

# same length
@$array == @array; 
```

我不会尝试优化它，除非你知道它是你代码的一个缓慢部分。即使这样，我也会使用基准测试来查看哪个子程序实际上更快。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-14T00:18:55.640

有两个考虑。显而易见的是，您的阵列会有多大？如果它少于几十个元素，那么大小就不是一个因素（除非你正在为一些快速调用的函数进行微优化，但你必须先做一些内存分析来证明这一点）。

那是容易的部分。经常被忽视的第二个考虑因素是界面。返回的数组将如何使用？这很重要，因为在 Perl 中整个数组解引用有点糟糕。例如：

```
for my $info (@{ getInfo($some, $args) }) {
    ...
} 
```

太丑了 这要好得多。

```
for my $info ( getInfo($some, $args) ) {
    ...
} 
```

它还适用于映射和 grepping。

```
my @info = grep { ... } getInfo($some, $args); 
```

但是，如果您要挑选单个元素，则返回数组 ref 可能会很方便：

```
my $address = getInfo($some, $args)->[2]; 
```

这比：

```
my $address = (getInfo($some, $args))[2]; 
```

或者：

```
my @info = getInfo($some, $args);
my $address = $info[2]; 
```

但到那时，您应该质疑@info 是否真的是一个列表或哈希。

```
my $address = getInfo($some, $args)->{address}; 
```

您不应该做的是`getInfo()`在标量上下文中返回一个数组 ref 并在列表上下文中返回一个数组。这混淆了标量上下文作为数组长度的传统使用，这会让用户感到惊讶。

最后，我将插入我自己的模块[Method::Signatures](http://search.cpan.org/perldoc?Method::Signatures)，因为它为传入数组引用提供了一种折衷方案，而无需使用数组引用语法。

```
use Method::Signatures;

method foo(\@args) {
    print "@args";      # @args is not a copy
    push @args, 42;   # this alters the caller array
}

my @nums = (1,2,3);
Class->foo(\@nums);   # prints 1 2 3
print "@nums";        # prints 1 2 3 42 
```

这是通过[Data::Alias](http://search.cpan.org/perldoc?Data::Alias)的魔力完成的。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2016-03-25T05:57:42.343

如果您正在读取整个较大的文件并将其切成数组，则还有 3 项潜在的大型性能改进：

1.  使用 sysread() 而不是 read() 关闭 BUFFERING（手动警告混合）

2.  通过评估最后一个元素来预扩展数组 - 节省内存分配
3.  使用 Unpack() 快速拆分 uint16_t 图形通道数据等数据

将数组 ref 传递给函数允许主程序处理一个简单的数组，而一次写入后忘记的工作函数使用更复杂的“$@”和箭头 ->[$II] 访问形式。非常C'ish，它可能很快！

* * *

## 回答 #8

> 赞同：-4
> 
> 时间：2009-02-13T15:00:16.000

我对 Perl 一无所知，所以这是一个语言中立的答案。

从某种意义上说，将数组从子程序复制到调用程序中是低效的。效率低下的原因在于使用的额外内存以及将数据从一个地方复制到另一个地方所花费的时间。另一方面，对于除了最大的数组之外的所有数组，您可能都不在乎，并且可能出于优雅、诅咒或任何其他原因而更喜欢将数组复制出来。

有效的解决方案是子程序将数组的地址传递给调用程序。正如我所说，我对 Perl 在这方面的默认行为一无所知。但是有些语言为程序员提供了选择哪种方法的选项。

# c# - Read XMl File to String Array

> ID：546187
> 
> 赞同：0
> 
> 时间：2009-02-13T14:45:10.747
> 
> 标签：c#, .net, xml

I have a XML File and I want to read the data and assign it to a string array, so Operative would be assign to 1 array and JobLocation to another

```
<Demo>
    <JOBOperatives>
    <Operative>
        <Clock>aaaa</Clock>
        <Name>aaaaa</Name>
        <MobileNumber>00000000010</MobileNumber>
        <OperativeTrade>3</OperativeTrade>
        <OperativeTicket>1</OperativeTicket>
    </Operative>
    </JOBOperatives>
    <JobLocation>
        <UPRN>aaa</UPRN>
        <Address1>aaaa</Address1>
        <Address2>aaaa</Address2>
        <Address3>aaaa</Address3>
        <Address4>aaa</Address4>
        <Address5>aa</Address5>
        <PostCode>JR4 4ED</PostCode>
    </JobLocation> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-13T14:48:55.010

I take it you mean where each property from the xml is it's own element in the array?

That doesn't seem like a very good data structure, especially as xml schema definitions allow for the items to arrive in any order; your expected indexes could get all screwed up. A strongly-typed object seems more appropriate and is well supported in .Net. At very least you should use a dictionary, so the keys are preserved.

In this case the number of items in each tree is very small and you could end up with many of them, so a dictionary is probably not the best choice. You could do objects, but that would be a lot of extra code just to set it up and I get the impression the xml may come from different sources and be different based on the source (or *something* where the structure could change regularly, hence the initial desire for loosely-typed validation).

Ultimately your destination is a database, so I think in this case I'll show you an example using a dataset:

```
string xml = GetXmlString(); // <Demo><JobOperatives><Operative><Clock>aaaa</Clock>...
StringReader sr = new StringReader(xml);
DataSet ds = new DataSet();
ds.ReadXml(sr); 
```

Play around with that: look in the dataset's `.Tables` collection, at each table's `.TableName` property, `.Columns` collection, and `.Rows` collection, and at each columns `.ColumnName` and `.DataType` properties.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-13T14:49:37.757

The [OuterXml](http://www.google.co.uk/url?sa=t&source=web&ct=res&cd=1&url=http%3A%2F%2Fmsdn.microsoft.com%2Fen-us%2Flibrary%2Fsystem.xml.xmlnode.outerxml.aspx&ei=ooiVSY6WI4aR-gbGhIj_CA&usg=AFQjCNFxTmBHu_b0lHPQrfdn4eCbih3Y5A&sig2=bXH_RNVrjQACTeYc7zLBig) property of the XmlNode class might help you here.

# c# - 如何使用 c# 3.5 运行 SQL 代码？

> ID：546199
> 
> 赞同：0
> 
> 时间：2009-02-13T14:47:21.693
> 
> 标签：c#

我有一个 HTML 文本框，其中包含一些我需要执行的 SQL 代码。我能够从文本框中检索实际代码，但我不确定如何执行代码。使用 c# 3.5 的任何简单而优雅的方法？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-02-13T14:50:04.760

**不要从文本框中执行代码**

除非您真的相信输入的内容。

如果你这样做，使用这个：

```
SqlConnection con = new SqlConnection("Your connection string");
con.Open();
SqlCommand cmd = new SqlCommand(TexdtBox1.Text, con);
cmd.ExecuteNonQuery();
con.Close() 
```

请注意，这不会返回任何内容，只需运行查询即可。如果要返回数据，则需要 SqlDataAdaptor 或 SqlDataReader。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-02-13T14:53:13.940

![替代文字](https://imgs.xkcd.com/comics/exploits_of_a_mom.png)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-13T14:50:10.610

这取决于您要对其执行的数据库类型。如果我可以假设您想与 SQL Server 数据库通信，请查看以下类：

*   [SqlConnection](http://msdn.microsoft.com/en-us/library/system.data.sqlclient.sqlconnection.aspx)类
*   [SqlCommand](http://msdn.microsoft.com/en-us/library/system.data.sqlclient.sqlcommand.aspx)类

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-13T14:51:08.687

使用文本框中的 CommandText创建一个[SqlCommand](http://msdn.microsoft.com/en-us/library/system.data.sqlclient.sqlcommand.aspx)。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-13T15:00:01.100

这是一点（未经测试未经测试，因为在 SO 文本框中键入正确）示例代码：

```
using System.Data;

namespace MyGreatNamespace
{
    class MyGreatClass
    {
        static public DataTable executeTable( string query )
        {
            return executeTable( query, null, null );
        }

        static public DataTable executeTable( string query, string[] params, object[] values )
        {
                    DataTable myTable = new DataTable();
            using ( SqlConnection connection = new SqlConnection( myConnectionString ) )
            using( SqlCommand command = new SqlCommand( connection ) )
            {
                command.CommandType = CommandType.Text;
                command.CommandText = myQuery;

                if ( parameters.Count == values.Count && parameters.Count > 0 )
                {
                    for( int i = 0; i < parameters.Count; i ++ )
                    {
                        command.addParameterWithValue( parameters[i], values[i] );
                    }
                }

                using( SqlDataAdapter adapter = new SqlDataAdapter( command ) )
                {
                    adapter.Fill( out myTable );
                }
            }
            return myTable;
        }
    }
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-13T15:30:10.920

我不会推荐它，但如果你这样做，至少要验证输入的 SQL 是否以 SELECT 开头并且不包含任何分号 (;) 或注释字符（- 和 /*）。

# silverlight - 对于显示大量数据并专注于用户生产力的 Web 应用程序，silverlight 是一个不错的选择吗？

> ID：546200
> 
> 赞同：2
> 
> 时间：2009-02-13T14:47:22.550
> 
> 标签：silverlight, silverlight-2.0

我玩过一些 silverlight 组件包的在线演示，例如 Telerik、NetAdvantage 和 ComponentOne，虽然我对所见所闻印象深刻，但我也觉得演示应用程序负载很重，即使在使用一些组件。

我计划在一个需要加载大量数据的项目中尝试使用silverlight，使用网格和图表。

使用 Silverlight 的人对此有何看法？

对于显示大量数据并专注于用户生产力的 Web 应用程序，silverlight 是一个不错的选择吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-13T14:55:31.407

Silverlight 在显示丰富数据的大型列表方面并不是非常快速，但是设计良好的系统不会尝试仅显示用户一次可以理解的足够数据的大型丰富数据列表。

因此，silverlight 为以引人入胜的方式显示和输入数据提供了一个出色的平台，但您需要良好的设计和后端代码才能真正实现这一点。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-13T14:58:32.010

作为 Silverlight 开发人员和 Internet 用户，我必须说，在处理必须滚动的信息时，我更喜欢 HTML。

这并不是说它不能在 Silverlight 中正确完成，但我认为 Silverlight 并没有立即具备处理“大量数据和用户生产力”的能力

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-13T14:48:42.297

简短的回答是：“是的，绝对是。”

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-13T15:34:38.053

当然，这取决于你的听众。即使您有一个壮观的 Silverlight 包（可以完美地向您显示数据），如果您的受众将包括 (a) 没有 Silverlight 的用户或 (b) 不是为使用这些数据而设计的工具，例如，取决于关于你的实施，谷歌。在 Silverlight 或 Flash 中封装数据是减少数据访问的好方法。

# windows - Windows 上的 Apache Nutch

> ID：546215
> 
> 赞同：2
> 
> 时间：2009-02-13T14:50:23.790
> 
> 标签：windows, cygwin, nutch

有没有人尝试在 Windows 上安装 Nutch？我正在遵循此安装指南：http: [//zillionics.com/resources/articles/NutchGuideForDummies.htm](http://zillionics.com/resources/articles/NutchGuideForDummies.htm)

经过几次颠簸后，我被困在试图运行爬虫。它给了我这个错误：

bin/nutch：第 15 行：意外标记 '$'in\r'''in/nutch 附近的语法错误：第 15 行：'case "'uname'" in

显然我需要在 cygwin 中安装 uname 实用程序，但我无法在任何地方找到它。有谁知道它在哪个包中，或者是否有其他方法可以解决这个问题？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-13T18:22:51.160

好吧，我找到了解决方案：安装了 uname ，这不是问题。奇怪的是，shell 脚本是 DOS 文本格式而不是 Unix 文本格式。使用“d2u”命令转换此文件解决了该问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-05T03:16:15.407

问题不在于缺少 uname。问题是 nutch 脚本的行终止不正确。我执行以下操作：

1) 在 vi​​ 中打开 nutch

2) :set ff=unix

3) :wq

# regex - 如何用正则表达式匹配表达式后的第一个单词？

> ID：546220
> 
> 赞同：32
> 
> 时间：2009-02-13T14:52:17.420
> 
> 标签：regex, lookbehind, word-boundary

例如，在此文本中：

> Lorem ipsum dolor sit amet, consectetur adipiscing elit。Nunc eu Tellus vel nunc pretium lacinia。Proin sed lorem。疯狂的 ipsum。Nunc a libero quis risus sollicitudin imperdiet。

我想匹配“ipsum”之后的单词。

* * *

## 回答 #1

> 赞同：47
> 
> 时间：2009-02-13T15:01:49.067

这听起来像是一项寻找后向的工作，尽管您应该知道并非所有的正则表达式都支持它们。在您的示例中：

```
(?<=\bipsum\s)(\w+) 
```

这将匹配“ipsum”后面的任何字母字符序列作为一个完整的单词，然后是一个空格。它与“ipsum”本身**不**匹配，您无需担心在替换的情况下重新插入它。

不过，正如我所说，某些风格（例如 JavaScript）根本不支持后向查看。许多其他人（实际上大多数人）只支持“固定宽度”的lookbehinds——所以你可以使用这个例子，但不能使用任何重复运算符。（换句话说，`(?<=\b\w+\s+)(\w+)` *行不通*。）

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-13T20:49:29.373

其他一些响应者建议使用不依赖于lookbehinds 的正则表达式，但我认为需要一个完整的工作示例来理解这一点。这个想法是您以正常方式匹配整个序列（“ipsum”加上下一个单词），然后使用捕获组来隔离您感兴趣的部分。例如：

```
String s = "Lorem ipsum dolor sit amet, consectetur " +
    "adipiscing elit. Nunc eu tellus vel nunc pretium " +
    "lacinia. Proin sed lorem. Cras sed ipsum. Nunc " +
    "a libero quis risus sollicitudin imperdiet.";

Pattern p = Pattern.compile("ipsum\\W+(\\w+)");
Matcher m = p.matcher(s);
while (m.find())
{
  System.out.println(m.group(1));
} 
```

请注意，这会同时打印“dolor”和“Nunc”。要使用lookbehind 版本做到这一点，您必须做一些骇人听闻的事情，例如：

```
Pattern p = Pattern.compile("(?<=ipsum\\W{1,2})(\\w+)"); 
```

那是在 Java 中，它要求后视有一个明显的最大长度。有些风格甚至没有那么大的灵活性，当然，有些风格根本不支持lookbehinds。

然而，人们在他们的例子中似乎遇到的最大问题不是后视，而是单词边界。David Kemp 和 ck 似乎都希望`\b`匹配 'm' 后面的空格字符，但事实并非如此；它匹配“m”和空格 *之间*的位置（或边界） 。

这是一个常见的错误，我什至在几本书和教程中都看到过这个错误，但是单词边界结构`\b`, 永远不会匹配任何字符。它是一个零宽度断言，如环视和锚点（`^`、`$`、`\z`等），它匹配的是一个位置，该位置要么前面有一个单词字符，后面没有一个，或者后面有一个单词字符，前面没有一。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-13T14:54:19.740

ipsum\b(\w*)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2017-07-12T02:41:01.030

`javascript`你可以使用`(?=ipsum.*?(\w+))`

这也将出现第二次（Nunc）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2020-11-11T06:18:02.023

```
(?<=\bipsum\s|\bipsum\.\s)(\w+) 
```

`/(?<=\bipsum\s|\bipsum\.\s)(\w+)/gm` **Positive Lookbehind** `(?<=\bipsum\s|\bipsum\.\s)` 断言下面的 Regex 匹配

1.  *第一个替代* `\bipsum\s` \b 在单词边界处断言位置：`(^\w|\w$|\W\w|\w\W)` ipsum 匹配字符 ipsum 字面意思（区分大小写） \s 匹配任何空白字符（等于`[\r\n\t\f\v ]`）
2.  *2nd Alternative* `\bipsum\.\s` \b assert position at a word boundary: `(^\w|\w$|\W\w|\w\W)` ipsum 匹配字符 ipsum 从字面上（区分大小写）。匹配字符。字面上（区分大小写） \s 匹配任何空白字符（等于`[\r\n\t\f\v ]`） 第一个捕获组（\w+） \w+ 匹配任何单词字符（等于`[a-zA-Z0-9_]`）

*   量词 - 匹配一次到无限次，尽可能多次，根据需要（贪婪）回馈全局模式标志 g 修饰符：全局。所有匹配（第一次匹配后不返回） m 修饰符：多行。导致 ^ 和 $ 匹配每行的开始/结束（不仅是字符串的开始/结束）

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2021-11-16T19:05:44.713

示例语句：“availebleLimit: Double?”。如果您想在“：”字符后查找单词，可以使用以下正则表达式

正则表达式 => :.+$

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2009-02-13T14:53:15.437

ipsum\b(.*)\b

编辑：尽管取决于您的正则表达式实施，这可能很饿并在 ipsum 之后找到所有单词

# c# - 如何更改运行时应用程序设置

> ID：546229
> 
> 赞同：6
> 
> 时间：2009-02-13T14:53:47.870
> 
> 标签：c#, .net, settings.settings

我试图在运行时更改我的应用程序设置文件的一个键，但它不起作用。

我这样做：

```
ConfigurationSettings.AppSettings["XPTO"] = "HELLO"; 
```

似乎它只在内存中发生变化，而不是在文件上。

有谁知道该怎么做？

谢谢。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-02-13T15:32:52.863

看看我[对 .NET 设置文件的概述](https://stackoverflow.com/questions/481025/where-property-setting-value-stored-in-c-windows-application/481064#481064)...简而言之，我认为您需要一个用户范围的设置。它将表现得更像您的预期。

> **编辑：**如果您[在 Visual Studio 中使用设置设计](http://msdn.microsoft.com/en-us/library/aa730869(VS.80).aspx)器，则只需将“范围”更改为“用户”。如果没有，您应该能够以编程方式执行等效操作。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-13T15:10:29.000

假设您的应用程序对文件具有写入权限...

```
 Configuration config = ConfigurationManager.OpenExeConfiguration(ConfigurationUserLevel.None);  // the config that applies to all users
    AppSettingsSection appSettings = config.AppSettings;

    if (appSettings.IsReadOnly() == false)
    {
        appSettings("Key").Value = "new value";

        config.Save();
    } 
```

我忽略了所有可能引发的异常......

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-13T15:06:47.200

AppSettings 文件并非设计为可写的。它旨在存储在运行时不会更改但可能随时间更改的配置，即：数据库连接字符串、Web 服务 URL 等。

因此，虽然实际上可以更新文件，但您应该重新评估该值是否应该存储在那里。

# orm - Best ORM tool for Oracle with 4000 tables

> ID：546241
> 
> 赞同：0
> 
> 时间：2009-02-13T14:56:01.907
> 
> 标签：orm

I am looking for the best .Net ORM tool that would work with Oracle and SQL Server 2005\. We have an Oracle database with around 4000 tables. I tried TierDeveloper and Codesmith and they are not responding when I try to map objects with my Oracle DB. Which will be the best ORM tool to work with a big Oracle db?

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-13T15:04:50.027

我会认真研究[ibatis](http://www.mybatis.org/)（适用于 Java 和 .Net）。我这么说有几个原因：

首先，像 NHibernate 这样的 ORM 真正尝试抽象出我认为的数据库可能会适得其反，尤其是在处理“遗留”数据库时。这里的遗产并不意味着你认为它意味着什么。像 Hibernate 和 JPA (Java) 这样的工具几乎将任何不能以“正确”方式做事的东西都定义为遗留，这可能包括使用复合键（说真的，我读过一本名为复合键“遗留”的 JPA 书籍）。

另一方面，Ibatis 为您提供了 ORM 的大部分功能（以及一些 Hibernate 不能做的事情，例如 groupBy 功能），但仍然让您能够编写简单的 SQL。我想，对于这么大的数据库，您将有一些有问题的建模决策，即使不是不可能映射到许多 ORM 中也是很困难的。通过编写直接 SQL，您可以根据定义在 ibatis 中满足这些情况。

在查询语言方面，非供应商特定的 ORM 也是最低公分母。如果所有数据库都做不到，那么你就不能在任何地方做。Oracle 拥有最复杂的 SQL 方言之一。你应该使用它。诸如 CONNECT PRIOR 之类的东西在许多其他 SQL 方言中不存在（因此在抽象的 ORM 中没有以高性能方式建模）。

我在[Using an ORM or plain SQL?](https://stackoverflow.com/questions/494816/using-an-orm-or-plain-sql/494853#494853)

现有设计束缚了您的双手，这一事实为尽可能接近 SQL 提供了强有力的理由。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-13T15:19:20.743

如果您没有对象模型，我会三思而后行 ORM。我认为在表和列、对象和属性之间进行 1:1 映射是错误的。如果对象只是结构，没有行为或规则封装，那有什么意义呢？

在这种情况下，我更喜欢另一种方法：iBatis、直接 JDBC、存储过程或其他允许您调整 SQL 而不是依赖于 ORM 生成的东西的方法。

更新：甲骨文拥有 TopLink。这会让我假设他们已经“优化”了它以与他们的数据库一起工作：

[http://www.oracle.com/technetwork/middleware/toplink/overview/index.html](http://www.oracle.com/technetwork/middleware/toplink/overview/index.html)

但事实是，如果您的架构做得不好（例如索引不佳、过多的 JOIN、缓存等），ORM 工具将无能为力。底层数据库将对您的感知性能产生很大影响。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-05-23T16:56:16.603

使用 DevExpress 的 XAF 产品了解更多详情请查看[http://www.devexpress.com](http://www.devexpress.com)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-15T15:05:41.163

试试 EntityORM：[http ://entityorm.uuuq.com](http://entityorm.uuuq.com)

EntityORM 是用于 .NET 2.0 的完全类型化的对象关系映射库。

EntityORM 的主要优势在于易用性。大多数 ORM 库仍然需要编写大量类型转换和其他管道，EntityORM 旨在将程序员从这些繁琐且容易出错的任务中解脱出来，使其使用起来非常直观。

主要特点是：

```
* DataBase independent
* Ease for build new drivers that are independent from the EntityORM core framework (for now there is Sql Server, Sql CE, MySql, Oracle, PostgreSQL and Access drivers)
* Automatic mark changed for changes entities (optional)
* Automatic lazy loading (optional)
* Automatic transactions (optional manual transaction for instance for two-phase commit)
* Ease to map for an existing database with minimal effort
* All relational types are supported (One-To-One, One-To-Many, Many-To-One, Many-To-Many)
* Flexible event framework
* Conditions para load filter data into entities
* Capability to map to different table names or field names
* Default values
* Rules validation
* Autonumber
* Guid
* Generic list to managed multiple entities hidden deleted entities
* Typed entities are lazy loading with caching reducing significantly the needed for reflection
* Entity views to faster load read-only data from one ore more tables into a single flat entity
* Join conditions to join several tables in to a sigle entity view
* Generic list to managed multiple entity views
* Distinct, automatic group and aggregate functions (count, sum, largest, average, smallest) supported in entity views 
```

# php - Simple PHP Login - num_rows

> ID：546242
> 
> 赞同：0
> 
> 时间：2009-02-13T14:56:34.447
> 
> 标签：php

I am using mysql_num_rows to check if one row is returned for my user login and if count == 1 then log user in, I get an error though below my code is after that. Any suggestions?

> Warning: mysql_num_rows(): supplied argument is not a valid MySQL result resource in /home/web42001spring09/rcoughlin/public_html/process-login.php on line 13

```
<?php
// include database info
include("config.php");

if(isset($_POST["submit"])){
    // get data from form
    $username = $_POST["user"];
    $password = $_POST["pass"];

    $query  = "SELECT username,password,id FROM login WHERE username=".$username." AND password=".$password." LIMIT 1";
    $result = mysql_query($query);

    $count  = mysql_num_rows($result);

    // if 1 then login them in set cookie and redirect
    if($count==1){
        setcookie("password", "".$password."", time()+3600);
        setcookie("username", "".$username."", time()+3600);
        header("Location:admin.php");
    }else{
        echo "Wrong Username or password combination";
    }
}else{
    echo "Must be submitted via form.";
} 
```

Not sure why the code is drawing that issue? I have used this method before.

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-13T14:59:50.430

您没有在查询中引用您的字符串，因此您的 SQL 语句无效。

```
$query  = "SELECT username,password,id FROM login WHERE username='" . mysql_escape_string($username) . "' AND password = '" . mysql_escape_string($password) . "' LIMIT 1";
$result = mysql_query($query) or die(mysql_error()); 
```

您需要添加引号并使用`mysql_escape_string`or`mysql_real_escape_string`来防止 SQL 注入攻击。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-13T15:01:26.370

## 首先，检查错误...

“提供的参数不是有效的 MySQL 结果资源”，因为您的 SQL 中存在错误，但是您忽略了失败的查询并没有让自己的生活变得轻松。使用[mysql_error](http://php.net/mysql_error)获取错误消息。

## 其次，在 SQL 中正确转义字符串......

一旦你看到错误，你会发现你在查询中遗漏了一些引号，但你还必须转义你在查询中输入的字符串，否则你很容易受到 SQL 注入攻击......

```
$query  = "SELECT username,password,id FROM login ".
    "WHERE username='".mysql_real_escape_string($username)."' ".
    "AND password='".mysql_real_escape_string($password)."' LIMIT 1";

$result = mysql_query($query);
if ($result)
{

    $count  = mysql_num_rows($result);

    // if 1 then login them in set cookie and redirect
    if($count==1){
        setcookie("password", "".$password."", time()+3600);
        setcookie("username", "".$username."", time()+3600);
        header("Location:admin.php");
    }else{
        echo "Wrong Username or password combination";
    }
}
else
{
    echo "Error:".mysql_error()."<br>;
} 
```

在构建查询时始终使用[mysql_real_escape_string](http://uk3.php.net/mysql_real_escape_string)，或使用包装类库，它会为您提供参数化查询，如[PDO](http://uk3.php.net/manual/en/pdo.prepare.php)或[ADODb](http://phplens.com/lens/adodb/docs-adodb.htm)

## 最后，谈谈那些饼干......

此外，通过向某人​​提供一个带有用户名和密码的 cookie 来登录并不是实现登录的非常好的方法。除了在每个请求中明文传输密码外，它还极易受到 cookie 盗窃企图的攻击。鉴于您对 SQL 安全性的幼稚方法，您很可能还会让自己容易受到[XSS](http://en.wikipedia.org/wiki/Cross-site_scripting)攻击，从而使某人很容易收集这些 cookie :)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-13T14:59:03.037

Looks like you might want to do 2 things:

1.  Sanitise your input - passing user-submitted data straight into a database query is a recipe for disaster (see [`mysql_real_escape_string(string $unescaped_string)`](http://php.net/mysql_real_escape_string)).
2.  Put quotes around literals in database queries (i.e. `username ='".$username."'`)

The error message you're getting is due to the fact that the MySQL result object (`$result`) is not valid. Try calling [`mysql_error()`](http://php.net/mysql_error) to see what error message MySQL returns.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-13T14:59:44.003

尝试：

```
 $row = mysql_fetch_row($result);
  if ($row) { // success 
```

假设您可能想要获取一些列以及身份验证检查（例如真实姓名、上次登录等）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-13T14:59:52.457

因为`password`和`login`都是字符串，所以需要改一下SQL：

```
$query="SELECT username,password,id FROM login WHERE username='".$username."' AND password='".$password."' LIMIT 1" 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-13T15:56:53.257

**切勿将用户身份验证数据存储在 cookie 中！**

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2009-02-13T14:59:07.017

查询无效（$result == false）

线：

```
$query  = "SELECT username,password,id FROM login WHERE username=".$username." AND password=".$password." LIMIT 1"; 
```

应替换为：

```
$query  = "SELECT username,password,id FROM login WHERE username='".mysql_escape_string($username)."' AND password='".mysql_escape_string$password)."' LIMIT 1"; 
```

PHP mysql_query() 函数默认不给出错误。使用显示 sql 错误的函数可以让您轻松发现这些错误。

```
function my_query($sql) {
  $result = mysql_query($sql);
  if ($result === false) {
    trigger_error('['.mysql_errno().'] '.mysql_error(), E_USER_WARNING);
  }
  return $result;
} 
```

现在用户名和密码直接注入到 sql 字符串中。
你想要的是`password = "secret"`，现在查询包含`password = secret`
Mysql 错误“未知列 sercet”

PS：这里使用“LIMIT 1”表示有多个用户（ID）使用相同的用户名密码组合。（不建议）

# coldfusion - CFCHART：反向 Y 轴排序

> ID：546255
> 
> 赞同：4
> 
> 时间：2009-02-13T14:59:41.787
> 
> 标签：coldfusion, charts

我的意思是 MIN 应该在顶部， MAX 在 X 轴上。

当第一名比第三名“更好”时，这需要使图表更易于阅读并与对象排名相关。这就是为什么最好这样看：

[![替代文字](https://i.stack.imgur.com/yfluo.png)](https://i.stack.imgur.com/yfluo.png)
[（来源：[xantea.net](http://xantea.net/stuff/img/0902/y-current.png)）] **=>** [（来源：][[xantea.net](http://xantea.net/stuff/img/0902/y-reverse.png)][）][![替代文字](https://i.stack.imgur.com/jrexl.png)](https://i.stack.imgur.com/jrexl.png)

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-15T15:20:03.020

这可以使用自定义 XML 来完成。我运行了图表设计器（cfinstall/charting/webcharts.bar（或 .sh）并简单地使用 YAxis 设置。有一个 isReversed 设置可以满足您的需求。考虑以下代码：

```
<cfset q2 = queryNew("year,employees","integer,integer")>
<!--- generate random sales data --->
<cfloop index="y" from="1994" to="1998">
    <cfscript>
    queryAddRow(q2);
    querySetCell(q2, "year", y);
    querySetCell(q2, "employees", randRange(2,8));
    </cfscript>
</cfloop>

<cfsavecontent variable="chartxml">
<?xml version="1.0" encoding="UTF-8"?>
<frameChart is3D="false">
<yAxis isReversed="true">    
</yAxis>
</frameChart>
</cfsavecontent>

<cfchart chartWidth="400" chartHeight="400" title="Sales" font="arial" style="#chartxml#">
    <cfchartseries type="line" query="q2" itemColumn="year" valueColumn="employees" seriesLabel="Employees" />
</cfchart> 
```

顶部的查询仅用于测试。XML 来自图表设计器。我删除了除使用 isReverse 的 yAxis 之外的所有内容。最后，请注意我如何在图表标签中指定样式。

# javascript - Windows 脚本：VBScript、DOS、JS、Python、

> ID：546275
> 
> 赞同：4
> 
> 时间：2009-02-13T15:04:08.860
> 
> 标签：javascript, windows, vbscript, scripting

假设您主要是像程序员和 Linux 系统管理员这样的 C 语法，您的任务是在 Windows 上创建一些简单的自动化任务（监控备份文件、进程监控......）。您更喜欢用哪种语言编写脚本？那里有大量的 VBS 脚本（使用 VB 语法），但我更喜欢与 C 相关的任何东西。

使用 Windows 脚本的最佳体验是什么？某种语言有什么明显的缺点或优点吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-13T15:11:38.170

我会使用[Powershell](http://www.microsoft.com/windowsserver2003/technologies/management/powershell/default.mspx)。

*   它有一个模糊的类似 C 的语法。
*   它有一个集成的外壳。
*   最新版本（目前在 CTP 中）包括一个内置 IDE（尽管与其他 3rd 方相比它是有限的）。
*   它可以轻松访问 .Net 框架中 90% 的功能。
*   展望未来，MS 产品将明确提供 Powershell 集成。
*   它支持管道。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-13T15:13:59.303

VBS 中的几乎每个脚本都可以转换为 JScript 中的等效脚本。

有一些需要注意的问题。阅读枚举器并记住在 VBS 中不区分大小写，因此在翻译脚本时，某些方法可能有错误的大小写。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-13T15:14:22.283

尝试在 CMD 文件中执行您想要执行的操作，如果它没有剪切它，请使用 Windows Scripting Host 调用其中包含 JScript 和/或 VBScript 的 wsh 文件。如果您更喜欢 JScript 外观，请将其用作您的主要语言，并将 VBScript 用于您从网上复制或找不到 JScript 解决方案的内容。您可以从 JScript 调用 VBScript，反之亦然。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-13T19:13:06.267

也可以查看[Microsoft Scriptomatic](http://www.microsoft.com/downloads/details.aspx?DisplayLang=en&FamilyID=09dfc342-648b-4119-b7eb-783b0f7d1178)工具。

它可以在 VBScript、Perl、JavaScript (JScript) 和 Python 中生成大量管理脚本。也使导航 WMI**变得**更加容易。

# unit-testing - 这个单元测试是否过度？

> ID：546276
> 
> 赞同：1
> 
> 时间：2009-02-13T15:04:32.323
> 
> 标签：unit-testing

鉴于以下 SUT，您是否认为此单元测试是不必要的？

**编辑：我们不能假设名称会匹配，因此反射不起作用。

**编辑 2：实际上，此类将实现一个 IMapper 接口，并且将在应用程序的业务逻辑层进行全面的行为（模拟）测试。这个测试恰好是必须基于状态的最低级别的测试。我质疑这个测试是否真的有必要，因为测试代码几乎与源代码本身相同，并且根据实际经验，我看不出这个单元测试如何使应用程序的维护变得更容易。

```
//SUT
public class Mapper
{
  public void Map(DataContract from, DataObject to)
  {
    to.Value1 = from.Value1;
    to.Value2 = from.Value2;
    ....
    to.Value100 = from.Value100;
  }
}

//Unit Test
public class MapperTest()
{
   DataContract contract = new DataContract(){... } ;
   DataObject do = new DataObject(){...};
   Mapper mapper = new Mapper();
   mapper.Map(contract, do);
   Assert.AreEqual(do.Value1, contract.Value1);
   ...
   Assert.AreEqual(do.Value100, contract.Value100);

} 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-13T15:07:20.693

我会质疑结构本身，而不是测试它的必要性

[反射将少得多的代码]

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-13T15:12:46.857

我认为这是必要的。但是，最好是 100 个单独的单元测试，每个测试一个值。这样，当您出现问题时`value65`，您可以运行测试，并立即发现`value65`并被`value66`转置。真的，正是这种简单的代码让你关掉大脑并忘记发生的错误。进行测试意味着您接他们，而不是您的客户。

但是，如果您有一个包含 100 个属性的类，所有属性都命名为 ValueXXX，那么使用数组或列表可能会更好。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-13T15:08:51.297

如果您可以在更高级别进行测试会更好，即需要您创建 Mapper.Map() 函数的业务逻辑。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-14T10:05:43.920

这并不过分。我不确定它是否完全专注于您想要测试的内容。

[“在严格的定义下，出于 QA 的目的，UnitTest 的失败只涉及一个单元。您确切地知道在哪里搜索可以找到错误。”](http://c2.com/cgi/wiki?UnitTest)

单元测试的强大之处在于具有已知的正确结果状态，重点应该是分配给 DataContract 的值。这些是我们想要突破的界限。确保可以将 DataContract 的所有可能值成功复制到 DataObject 中。DataContract 必须填充边缘情况值。

PS。David Kemp 是对的，100 个精心设计的测试将是最真实的单元测试概念。

**注意：**对于这个测试，我们必须假设 DataContract 在构建时完美填充（这需要单独的测试）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-13T15:08:34.497

如果这是整个应用程序中唯一的此类单元测试，则不会。然而，当另一个类似的出现时，你会看到我皱起眉头开始思考反思。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-13T15:30:09.233

不过度。

我同意代码看起来很奇怪，但是说：

单元测试的美妙之处在于一旦完成就永远存在，所以如果有人出于任何原因决定更改该实现以获得更“聪明”的东西，测试仍然应该通过，所以没什么大不了的。

我个人可能会有一个 perl 脚本来生成代码，因为我会厌倦替换每个断言的数字，而且我可能会在途中犯一些错误，而 perl 脚本（或任何脚本）会更快我。

# frontend - 用于 Spotify 前端的语言

> ID：546278
> 
> 赞同：3
> 
> 时间：2009-02-13T15:04:44.740
> 
> 标签：frontend, spotify

> **可能重复：**
> [使用什么语言或技术开发 Spotify 桌面应用程序？](https://stackoverflow.com/questions/662121/what-language-or-technology-was-used-to-develop-the-spotify-desktop-application)

我读过“大部分[Spotify](http://www.spotify.com)后端都是用 Python 编写的，而较小的部分是用 C 和 Java 编写的”。有谁知道他们在前端使用什么？

# .net - F#中关键字“in”的含义

> ID：546287
> 
> 赞同：40
> 
> 时间：2009-02-13T15:07:10.320
> 
> 标签：.net, f#

我刚开始学习F#。在几个 F# 编码示例中，我看到关键字“in”以下列方式使用：

```
let doStuff x =
    let first, second = x in
    first + " " + second 
```

该函数在第二行末尾带有和不带有“in”的情况下都有效。“在”有什么作用？

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2009-02-13T15:19:33.783

`in`是 F# 的 OCaml 根的遗留问题，它指定了*绑定*变量，这些变量与变量*范围*略有不同。

如下考虑变量绑定；你有一个表达式：

```
first + " " + second 
```

就目前而言`first`并且`second`未绑定-它们没有任何固定值-因此该表达式目前没有具体值。通过使用

```
let (...) in 
```

您正在指定这些变量如何**在该表达式**中绑定的语法，因此您的示例将使用变量替换将该函数缩减为

```
let doStuff x =
  x + " " + x 
```

* * *

在这个例子中，两种形式是相同的，但想象一下：

```
let (x = 2 and y = x + 2) in
     y + x 
```

这将与

```
let (x = 2 and y = x + 2)
     y + x 
```

因为在前一种情况下只`x`绑定**在**`in`关键字之后。

在后一种情况下，普通变量*作用域*规则生效，因此变量一被声明就被绑定。

希望这能说明问题。通常，您应该始终使用*不带* 的版本，并在 F# 源文件的开头`in`指定`#light`

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-13T16:18:07.653

这是关于 SO 的另一个相关线程，它也可能很有用：

*   [F# - 我应该在有还是没有#light 的情况下学习？](https://stackoverflow.com/questions/461739/f-should-i-learn-with-or-without-light/461929#461929)

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-13T15:21:23.047

从[这里](http://stuff.mit.edu/afs/athena/software/fsharp_v1.1.12/FSharp-1.1.12.3/manual/lexyacc.html)引用。

> 当启用 light 语法选项时，'in' 是可选的。'let' 定义的 '=' 之后的标记开始一个新块，其中预解析器在与该标记相同的列开始的每个 'let' 绑定之间插入一个隐式分隔的 'in' 标记。
> 
> 如果没有轻量级语法选项，则通常需要使用“in”。当使用 light syntac 选项时，'in' 是可选的。

所以我猜你正在使用轻量级语法。

# asp.net - GridView 列宽改变

> ID：546299
> 
> 赞同：0
> 
> 时间：2009-02-13T15:09:10.640
> 
> 标签：asp.net, data-binding, gridview

有人可以帮我解决我的问题吗？

我在网页中有一个 gridview，其数据源是一个 oracle 数据库。我想知道您在网页上时是否可以更改列宽？

```
string select = "SELECT * FROM TABLE"

OracleCommand cmd = new OracleCommand(select, connectionstring);
cmd.Connection.Open();

GridView.DataSource = cmd.ExecuteReader();
GridView.DataBind(); 
```

这会在 gridview 中输出表格。有没有办法在浏览器中更改 gridview 属性？也许一些javascript？

先感谢您，

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-13T17:32:26.880

您可以通过 gridview 本身的列中的样式来指定这些属性。您可以将 AutoGenerateColumns 属性设置为 false，并指定所需的列，并指定每列内的大小。此外，遵循良好的网页设计实践，您可以使用 css 来设置每一列的样式。如果您想即时更改它，我建议您使用 ItemTemplates，并添加您可以在现场修改的组件。

前任：

```
<asp:GridView runat="server" AutoGenerateColumns="false" ID="Grid" DataSourceID='MyObjectDataSource' CssClass="grid_table">
                <AlternatingRowStyle CssClass="even" />
                <Columns>
                    <asp:TemplateField>
                        <HeaderTemplate>
                            <div id="NameColumn" runat="server">Name Center</div>
                        </HeaderTemplate>
                        <ItemTemplate>
                            <%# Eval("LastName") %>, <%# Eval("FirstName") %>
                        </ItemTemplate>
                    </asp:TemplateField>
                    <asp:TemplateField>
                        <HeaderTemplate>
                            <div id="AgeColumn" runat="server">Age</div>
                        </HeaderTemplate>
                        <ItemTemplate>
                            <%# Eval("Age") %>
                        </ItemTemplate>
                    </asp:TemplateField>
                <EmptyDataTemplate>There are no Users</EmptyDataTemplate>
            </asp:GridView> 
```

使用此代码，您可以访问列宽：

```
NameColumn.Width = 100;
AgeColumn.Width = 2; 
```

但是，有很多方法可以实现这一点，包括直接获取列：

```
Grid.Columns[0].HeaderStyle.Width = 100;
Grid.Columns[0].ItemStyle.Width = 100;
Grid.Columns[1].HeaderStyle.Width = 2;
Grid.Columns[1].ItemStyle.Width = 2; 
```

或者再次使用 css：

```
Grid.Columns[0].HeaderStyle.CssClass = "name_column_header";
Grid.Columns[0].ItemStyle.CssClass = "name_column_data";
Grid.Columns[1].HeaderStyle.CssClass = "age_column_header";
Grid.Columns[1].ItemStyle.Width = "age_column_data"; 
```

无论如何，世界是你的牡蛎，这些只是一些起点。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-08-09T06:11:50.113

在gridview的行数据绑定事件中使用此代码

e.Row.Cells[8].Width = new Unit("800px");

请确保您的 gridview 大小必须大于列大小。

# multithreading - boost:thread - 编译器错误

> ID：546319
> 
> 赞同：2
> 
> 时间：2009-02-13T15:15:22.780
> 
> 标签：multithreading, boost

我想在我的程序中使用 boost::thread，但得到以下编译器错误（Visual Studio 2005）：

```
Error   1   **error C2064**: term does not evaluate to a function taking 0
arguments   d:\...\boost_1_37_0\boost\thread\detail\thread.hpp  56 
```

因此，我尝试在一个小程序中重新创建问题，并从[这个站点](http://www.ddj.com/cpp/184401518?pgno=2)修改了工作中的 Hello World 示例。

我的测试代码现在看起来像这样。为什么它不能在课堂上工作？：

```
#include <boost/thread.hpp>
#include <iostream>

class HelloWorld
{
public:
    void hello();
    void entry();
};

void HelloWorld::entry()
{
    boost::thread thrd(&HelloWorld::hello);
    thrd.join();
}

void HelloWorld::hello() 
{ 
    std::cout << "Hello world, I'm a thread!" << std::endl;
}

int main(int argc, char* argv[]) 
{ 
    HelloWorld *bla = new HelloWorld;
    bla->entry();
    return 0;
} 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-13T15:21:17.697

像这样尝试 - boost::thread 构造函数需要一个 boost::function0 （这是一个函数指针，但由于 this 指针而不是成员函数指针）。

```
void HelloWorld::entry()
{
    boost::thread thrd(boost::bind(&HelloWorld::hello,this));
    thrd.join();
} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-17T09:25:40.273

成员函数有一个*this*指针作为第一个参数。因为有一个接受函数参数的 boost::thread 构造函数，所以你不需要使用 boost::bind。这也将起作用：

```
void HelloWorld::entry()
{
    boost::thread thrd(&HelloWorld::hello,this);
    thrd.join();
} 
```

如果您的函数需要参数，您可以将它们放在*this*指针参数之后。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-13T15:20:25.437

您正在将成员函数作为线程启动时要调用的函数传递给线程对象。由于线程本身没有对象，所以不能调用成员函数。您可以将 hello 函数设为静态，或者查看 boost::bind 库以发送对象。

# python - 如何使用 datetime Python 模块计算距当前日期六个月的日期？

> ID：546321
> 
> 赞同：513
> 
> 时间：2009-02-13T15:16:25.070
> 
> 标签：python, datetime

我正在使用 datetime Python 模块。我正在寻找从当前日期算起 6 个月的日期。有人可以帮我做这件事吗？

我想从当前日期生成 6 个月的日期的原因是生成一个*review date*。如果用户将数据输入系统，则自输入数据之日起 6 个月的审核日期。

* * *

## 回答 #1

> 赞同：1249
> 
> 时间：2010-12-10T06:22:36.827

我发现这个解决方案很好。（这使用了[python-dateutil 扩展](https://dateutil.readthedocs.org/en/latest/)）

```
from datetime import date
from dateutil.relativedelta import relativedelta

six_months = date.today() + relativedelta(months=+6) 
```

这种方法的优点是它可以处理 28、30、31 天等问题。这在处理业务规则和场景（例如发票生成等）时非常有用

```
$ date(2010,12,31)+relativedelta(months=+1)
  datetime.date(2011, 1, 31)

$ date(2010,12,31)+relativedelta(months=+2)
  datetime.date(2011, 2, 28) 
```

* * *

## 回答 #2

> 赞同：68
> 
> 时间：2009-02-13T15:29:24.587

好吧，这取决于您所说的从当前日期算起的 6 个月是什么意思。

1.  使用自然月：

    ```
    inc = 6
    month = (month + inc - 1) % 12 + 1
    year = year + (month + inc - 1) // 12 
    ```

2.  使用银行家的定义，6*30：

    ```
    date += datetime.timedelta(6 * 30) 
    ```

* * *

## 回答 #3

> 赞同：51
> 
> 时间：2018-09-24T11:25:59.130

使用 Python 3.x，您可以这样做：

```
from datetime import datetime, timedelta
from dateutil.relativedelta import *

date = datetime.now()
print(date)
# 2018-09-24 13:24:04.007620

date = date + relativedelta(months=+6)
print(date)
# 2019-03-24 13:24:04.007620 
```

但您需要安装**python-dateutil**模块：

```
pip install python-dateutil 
```

* * *

## 回答 #4

> 赞同：20
> 
> 时间：2017-02-02T10:49:51.510

对于月初计算：

```
from datetime import timedelta
from dateutil.relativedelta import relativedelta

end_date = start_date + relativedelta(months=delta_period) + timedelta(days=-delta_period) 
```

* * *

## 回答 #5

> 赞同：18
> 
> 时间：2010-07-07T17:59:32.777

所以，这里有一个例子，`dateutil.relativedelta`我发现它对过去一年的迭代很有用，每次跳过一个月到现在的日期：

```
>>> import datetime
>>> from dateutil.relativedelta import relativedelta
>>> today = datetime.datetime.today()
>>> month_count = 0
>>> while month_count < 12:
...  day = today - relativedelta(months=month_count)
...  print day
...  month_count += 1
... 
2010-07-07 10:51:45.187968
2010-06-07 10:51:45.187968
2010-05-07 10:51:45.187968
2010-04-07 10:51:45.187968
2010-03-07 10:51:45.187968
2010-02-07 10:51:45.187968
2010-01-07 10:51:45.187968
2009-12-07 10:51:45.187968
2009-11-07 10:51:45.187968
2009-10-07 10:51:45.187968
2009-09-07 10:51:45.187968
2009-08-07 10:51:45.187968 
```

与其他答案一样，您必须弄清楚“从现在起 6 个月”的实际含义。如果您的意思是“未来六年后一个月中的今天”，那么可以这样做：

```
datetime.datetime.now() + relativedelta(months=6) 
```

* * *

## 回答 #6

> 赞同：17
> 
> 时间：2009-02-13T15:21:07.167

“6个月”是什么意思？

是 2009-02-13 + 6 个月 == 2009-08-13？还是 2009-02-13 + 6*30 天？

```
import mx.DateTime as dt

#6 Months
dt.now()+dt.RelativeDateTime(months=6)
#result is '2009-08-13 16:28:00.84'

#6*30 days
dt.now()+dt.RelativeDateTime(days=30*6)
#result is '2009-08-12 16:30:03.35' 
```

[有关mx.DateTime 的](http://www.egenix.com/products/python/mxBase/mxDateTime/)更多信息

* * *

## 回答 #7

> 赞同：17
> 
> 时间：2010-08-11T22:18:29.337

此解决方案适用于 12 月，而此页面上的大多数答案都没有。在使用模数 ( % ) 或整数除法 ( // ) 之前，您需要先将月份从基数 1（即 Jan = 1）转移到基数 0（即 Jan = 0），否则 11 月（11）加上 1 个月会给你 12 ，当找到余数（ 12 % 12 ）时给出 0。

（并且不要建议“（月 % 12）+ 1”或 10 月 + 1 = 12 月！）

```
def AddMonths(d,x):
    newmonth = ((( d.month - 1) + x ) % 12 ) + 1
    newyear  = int(d.year + ((( d.month - 1) + x ) / 12 ))
    return datetime.date( newyear, newmonth, d.day) 
```

但是......这并没有解决像 Jan 31 + 一个月这样的问题。所以我们回到 OP - 增加一个月是什么意思？一种解决方案是回溯，直到到达有效日期，因为大多数人会假设 1 月的最后一天加上一个月，等于 2 月的最后一天。这也适用于负数月份。证明：

```
>>> import datetime
>>> AddMonths(datetime.datetime(2010,8,25),1)
datetime.date(2010, 9, 25)
>>> AddMonths(datetime.datetime(2010,8,25),4)
datetime.date(2010, 12, 25)
>>> AddMonths(datetime.datetime(2010,8,25),5)
datetime.date(2011, 1, 25)
>>> AddMonths(datetime.datetime(2010,8,25),13)
datetime.date(2011, 9, 25)
>>> AddMonths(datetime.datetime(2010,8,25),24)
datetime.date(2012, 8, 25)
>>> AddMonths(datetime.datetime(2010,8,25),-1)
datetime.date(2010, 7, 25)
>>> AddMonths(datetime.datetime(2010,8,25),0)
datetime.date(2010, 8, 25)
>>> AddMonths(datetime.datetime(2010,8,25),-12)
datetime.date(2009, 8, 25)
>>> AddMonths(datetime.datetime(2010,8,25),-8)
datetime.date(2009, 12, 25)
>>> AddMonths(datetime.datetime(2010,8,25),-7)
datetime.date(2010, 1, 25)>>> 
```

* * *

## 回答 #8

> 赞同：14
> 
> 时间：2009-02-13T15:29:05.493

使用 Python 的日期时间没有直接的方法。

[在python-dateutil](http://labix.org/python-dateutil#head-ba5ffd4df8111d1b83fc194b97ebecf837add454)查看 relativedelta 类型。它允许您以月为单位指定时间增量。

* * *

## 回答 #9

> 赞同：13
> 
> 时间：2009-02-13T15:23:42.183

只需使用*timetuple*方法来提取月份，添加您的月份并构建一个新的日期对象。如果有一个已经存在的方法，我不知道。

```
import datetime

def in_the_future(months=1):
    year, month, day = datetime.date.today().timetuple()[:3]
    new_month = month + months
    return datetime.date(year + (new_month / 12), (new_month % 12) or 12, day) 
```

API 有点笨拙，但可以作为示例。显然也不适用于像 2008-01-31 + 1 个月这样的极端情况。:)

* * *

## 回答 #10

> 赞同：13
> 
> 时间：2011-04-13T00:54:07.293

我知道这是 6 个月，但是如果您要添加一个月，则答案会在 google 中显示为“在 python 中添加几个月”：

```
import calendar

date = datetime.date.today()    //Or your date

datetime.timedelta(days=calendar.monthrange(date.year,date.month)[1]) 
```

这将计算当月的天数并将它们添加到当前日期，如果您在该日期上进行迭代，使用 365/12 一年的 1/12 可能会导致短/长月份出现问题。

* * *

## 回答 #11

> 赞同：13
> 
> 时间：2019-11-04T18:10:48.277

这没有回答具体问题（`datetime`仅使用），但是鉴于其他人建议使用不同的模块，这里有一个使用`pandas`.

```
import datetime as dt
import pandas as pd

date = dt.date.today() - \
       pd.offsets.DateOffset(months=6)

print(date)

2019-05-04 00:00:00 
```

在闰年按预期工作

```
date = dt.datetime(2019,8,29) - \
       pd.offsets.DateOffset(months=6)
print(date)

2019-02-28 00:00:00 
```

* * *

## 回答 #12

> 赞同：12
> 
> 时间：2018-05-12T00:51:16.377

使用 Python 标准库，即没有`dateutil`或其他，并解决“2 月 31 日”问题：

```
import datetime
import calendar

def add_months(date, months):
    months_count = date.month + months

    # Calculate the year
    year = date.year + int(months_count / 12)

    # Calculate the month
    month = (months_count % 12)
    if month == 0:
        month = 12

    # Calculate the day
    day = date.day
    last_day_of_month = calendar.monthrange(year, month)[1]
    if day > last_day_of_month:
        day = last_day_of_month

    new_date = datetime.date(year, month, day)
    return new_date 
```

测试：

```
>>>date = datetime.date(2018, 11, 30)

>>>print(date, add_months(date, 3))
(datetime.date(2018, 11, 30), datetime.date(2019, 2, 28))

>>>print(date, add_months(date, 14))
(datetime.date(2018, 12, 31), datetime.date(2020, 2, 29)) 
```

* * *

## 回答 #13

> 赞同：11
> 
> 时间：2021-07-16T14:46:55.620

**Python 可以为此使用 datautil 包，请参见下面的示例**

不仅限于此，您还可以同时传递天、月和年的组合。

```
import datetime
from dateutil.relativedelta import relativedelta

# subtract months
proc_dt = datetime.date(2021,8,31)
proc_dt_minus_3_months = proc_dt + relativedelta(months=-3)
print(proc_dt_minus_3_months)

# add months
proc_dt = datetime.date(2021,8,31)
proc_dt_plus_3_months = proc_dt + relativedelta(months=+3)
print(proc_dt_plus_3_months)

# subtract days:
proc_dt = datetime.date(2021,8,31)
proc_dt_minus_3_days = proc_dt + relativedelta(days=-3)
print(proc_dt_minus_3_days)

# add days days:
proc_dt = datetime.date(2021,8,31)
proc_dt_plus_3_days = proc_dt + relativedelta(days=+3)
print(proc_dt_plus_3_days)

# subtract years:
proc_dt = datetime.date(2021,8,31)
proc_dt_minus_3_years = proc_dt + relativedelta(years=-3)
print(proc_dt_minus_3_years)

# add years:
proc_dt = datetime.date(2021,8,31)
proc_dt_plus_3_years = proc_dt + relativedelta(years=+3)
print(proc_dt_plus_3_years) 
```

结果：

2021-05-31

2021-11-30

2021-08-28

2021-09-03

2018-08-31

2024-08-31

* * *

## 回答 #14

> 赞同：9
> 
> 时间：2009-02-13T15:26:05.483

[Dateutil 包](http://labix.org/python-dateutil)具有此类功能的实现。但是请注意，正如其他人已经指出的那样，这将是*幼稚*的。

* * *

## 回答 #15

> 赞同：5
> 
> 时间：2011-05-25T11:00:03.617

我有更好的方法来解决“2 月 31 日”问题：

```
def add_months(start_date, months):
    import calendar

    year = start_date.year + (months / 12)
    month = start_date.month + (months % 12)
    day = start_date.day

    if month > 12:
        month = month % 12
        year = year + 1

    days_next = calendar.monthrange(year, month)[1]
    if day > days_next:
        day = days_next

    return start_date.replace(year, month, day) 
```

我认为它也适用于负数（减去几个月），但我没有对此进行太多测试。

* * *

## 回答 #16

> 赞同：4
> 
> 时间：2019-06-28T12:57:16.910

一个快速的建议是[箭头](https://github.com/crsmithdev/arrow)

点安装箭头

```
>>> import arrow

>>> arrow.now().date()
datetime.date(2019, 6, 28)
>>> arrow.now().shift(months=6).date()
datetime.date(2019, 12, 28) 
```

* * *

## 回答 #17

> 赞同：3
> 
> 时间：2009-11-17T16:37:16.217

PyQt4 的 QDate 类有一个 addmonths 函数。

```
>>>from PyQt4.QtCore import QDate  
>>>dt = QDate(2009,12,31)  
>>>required = dt.addMonths(6) 

>>>required
PyQt4.QtCore.QDate(2010, 6, 30)

>>>required.toPyDate()
datetime.date(2010, 6, 30) 
```

* * *

## 回答 #18

> 赞同：3
> 
> 时间：2015-09-10T04:44:56.640

这个怎么样？不使用另一个库 ( `dateutil`) 或`timedelta`? 基于[vartec](https://stackoverflow.com/users/60711/vartec)的回答，我这样做了，我相信它有效：

```
import datetime

today = datetime.date.today()
six_months_from_today = datetime.date(today.year + (today.month + 6)/12, (today.month + 6) % 12, today.day) 
```

我尝试使用`timedelta`，但因为它在计算天数，`365/2`或者`6*356/12`并不总是转换为 6 个月，而是 182 天。例如

```
day = datetime.date(2015, 3, 10)
print day
>>> 2015-03-10

print (day + datetime.timedelta(6*365/12))
>>> 2015-09-08 
```

我相信我们通常假设从某一天开始的 6 个月将在该月的同一天降落但 6 个月后（即`2015-03-10`--> `2015-09-10`，不是`2015-09-08`）

我希望你觉得这有帮助。

* * *

## 回答 #19

> 赞同：2
> 
> 时间：2011-06-06T12:25:22.280

修改了 AddMonths() 以在 Zope 中使用并处理无效的天数：

```
def AddMonths(d,x):
    days_of_month = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31]
    newmonth = ((( d.month() - 1) + x ) % 12 ) + 1
    newyear  = d.year() + ((( d.month() - 1) + x ) // 12 ) 
    if d.day() > days_of_month[newmonth-1]:
      newday = days_of_month[newmonth-1]
    else:
      newday = d.day() 
    return DateTime( newyear, newmonth, newday) 
```

* * *

## 回答 #20

> 赞同：2
> 
> 时间：2011-08-11T02:28:22.290

```
import time

def add_month(start_time, months):  

        ret = time.strptime(start_time, '%Y-%m-%d')
        t = list(ret)

        t[1] += months

        if t[1] > 12:
            t[0] += 1 + int(months / 12)

            t[1] %= 12

        return int(time.mktime(tuple(t))) 
```

* * *

## 回答 #21

> 赞同：2
> 
> 时间：2010-01-16T02:02:04.637

在案例 1new_month = 121 中修改了 Johannes Wei 的答案。这对我来说非常有效。月份可能是正数或负数。

```
def addMonth(d,months=1):
    year, month, day = d.timetuple()[:3]
    new_month = month + months
    return datetime.date(year + ((new_month-1) / 12), (new_month-1) % 12 +1, day) 
```

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2013-10-30T08:51:09.390

另一个解决方案 - 希望有人会喜欢它：

```
def add_months(d, months):
    return d.replace(year=d.year+months//12).replace(month=(d.month+months)%12) 
```

此解决方案不适用于所有情况下的第 29、30、31 天，因此需要更强大的解决方案（这不再那么好:)）：

```
def add_months(d, months):
    for i in range(4):
        day = d.day - i
        try:
            return d.replace(day=day).replace(year=d.year+int(months)//12).replace(month=(d.month+int(months))%12)
        except:
            pass
    raise Exception("should not happen") 
```

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2011-03-10T00:29:32.743

```
import datetime

'''
Created on 2011-03-09

@author: tonydiep
'''

def add_business_months(start_date, months_to_add):
    """
    Add months in the way business people think of months. 
    Jan 31, 2011 + 1 month = Feb 28, 2011 to business people
    Method: Add the number of months, roll back the date until it becomes a valid date
    """
    # determine year
    years_change = months_to_add / 12

    # determine if there is carryover from adding months
    if (start_date.month + (months_to_add % 12) > 12 ):
        years_change = years_change + 1

    new_year = start_date.year + years_change

    # determine month
    work = months_to_add % 12
    if 0 == work:
        new_month = start_date.month
    else:
        new_month = (start_date.month + (work % 12)) % 12

    if 0 == new_month:
        new_month = 12 

    # determine day of the month
    new_day = start_date.day
    if(new_day in [31, 30, 29, 28]):
        #user means end of the month
        new_day = 31

    new_date = None
    while (None == new_date and 27 < new_day):
        try:
            new_date = start_date.replace(year=new_year, month=new_month, day=new_day)
        except:
            new_day = new_day - 1   #wind down until we get to a valid date

    return new_date

if __name__ == '__main__':
    #tests
    dates = [datetime.date(2011, 1, 31),
             datetime.date(2011, 2, 28),
             datetime.date(2011, 3, 28),
             datetime.date(2011, 4, 28),
             datetime.date(2011, 5, 28),
             datetime.date(2011, 6, 28),
             datetime.date(2011, 7, 28),
             datetime.date(2011, 8, 28),
             datetime.date(2011, 9, 28),
             datetime.date(2011, 10, 28),
             datetime.date(2011, 11, 28),
             datetime.date(2011, 12, 28),
             ]
    months = range(1, 24)
    for start_date in dates:
        for m in months:
            end_date = add_business_months(start_date, m)
            print("%s\t%s\t%s" %(start_date, end_date, m)) 
```

* * *

## 回答 #24

> 赞同：1
> 
> 时间：2015-05-13T20:40:56.927

从[这个答案](https://stackoverflow.com/a/1495548/605356)，请参阅[parsedatetime](https://github.com/bear/parsedatetime)。代码示例如下。更多细节：[使用许多自然语言进行单元测试 -> YYYY-MM-DD 转换示例](https://gist.github.com/johnnyutahh/24f9a48a331fd36a4e97#file-parsedatetime_unittest-py)，以及明显[的 parsedatetime 转换挑战/错误](https://github.com/bear/parsedatetime/issues/88)。

```
#!/usr/bin/env python
# -*- coding: utf-8 -*-
import time, calendar
from datetime import date

# from https://github.com/bear/parsedatetime
import parsedatetime as pdt

def print_todays_date():
    todays_day_of_week = calendar.day_name[date.today().weekday()]
    print "today's date = " + todays_day_of_week + ', ' + \
                              time.strftime('%Y-%m-%d')

def convert_date(natural_language_date):
    cal = pdt.Calendar()
    (struct_time_date, success) = cal.parse(natural_language_date)
    if success:
        formal_date = time.strftime('%Y-%m-%d', struct_time_date)
    else:
        formal_date = '(conversion failed)'
    print '{0:12s} -> {1:10s}'.format(natural_language_date, formal_date)

print_todays_date()
convert_date('6 months') 
```

上面的代码从 MacOSX 机器生成以下内容：

```
$ ./parsedatetime_simple.py 
today's date = Wednesday, 2015-05-13
6 months     -> 2015-11-13
$ 
```

* * *

## 回答 #25

> 赞同：1
> 
> 时间：2020-06-08T08:37:51.153

“python-dateutil”（外部扩展）是一个很好的解决方案，但您可以使用内置 Python 模块（datetime 和 datetime）

我做了一个简短的代码来解决它（处理年、月和日）

（运行：Python 3.8.2）

```
from datetime import datetime
from calendar import monthrange

# Time to increase (in months)
inc = 12

# Returns mod of the division for 12 (months)
month = ((datetime.now().month + inc) % 12) or 1

# Increase the division by 12 (months), if necessary (+ 12 months increase)
year = datetime.now().year + int((month + inc) / 12)

# (IF YOU DON'T NEED DAYS,CAN REMOVE THE BELOW CODE)
# Returns the same day in new month, or the maximum day of new month
day = min(datetime.now().day,monthrange(year, month)[1])

print("Year: {}, Month: {}, Day: {}".format(year, month, day)) 
```

* * *

## 回答 #26

> 赞同：1
> 
> 时间：2018-10-19T15:17:47.367

我迟到了，但是

查看 Ken Reitz Maya 模块，

[https://github.com/kennethreitz/maya](https://github.com/kennethreitz/maya)

像这样的东西可能会对你有所帮助，只需将 hours=1 更改为 days=1 或 years=1

```
>>> from maya import MayaInterval

# Create an event that is one hour long, starting now.
>>> event_start = maya.now()
>>> event_end = event_start.add(hours=1)

>>> event = MayaInterval(start=event_start, end=event_end) 
```

* * *

## 回答 #27

> 赞同：1
> 
> 时间：2020-11-15T16:02:38.457

我经常需要一个月的最后一天来保持一个月的最后一天。为了解决这个问题，我在计算前加了一天，然后在返回前再次减去它。

```
from datetime import date, timedelta

# it's a lot faster with a constant day
DAY = timedelta(1)

def add_month(a_date, months):
    "Add months to date and retain last day in month."
    next_day = a_date + DAY
    # calculate new year and month
    m_sum = next_day.month + months - 1
    y = next_day.year + m_sum // 12
    m = m_sum % 12 + 1
    try:
        return date(y, m, next_day.day) - DAY
    except ValueError:
        # on fail return last day in month
        # can't fail on december so I don't bother changing the year
        return date(y, m + 1, 1) - DAY 
```

* * *

## 回答 #28

> 赞同：1
> 
> 时间：2017-03-30T05:57:49.400

鉴于您的日期时间变量称为日期：

```
date=datetime.datetime(year=date.year+int((date.month+6)/12),
                       month=(date.month+6)%13 + (1 if (date.month + 
                       months>12) else 0), day=date.day) 
```

* * *

## 回答 #29

> 赞同：1
> 
> 时间：2017-12-06T23:59:50.600

在 x 个月之后/之前获取下一个日期的一般功能。

```
从日期时间导入日期

def after_month（给定日期，月份）：
    yyyy = int(((given_date.year * 12 + given_date.month) + month)/12)
    mm = int(((given_date.year * 12 + given_date.month) + month)%12)

    如果毫米 == 0：
        年年 -= 1
        毫米 = 12
    return given_date.replace(year=yyyy, month=mm)

如果 __name__ == "__main__":
    今天 = date.today()
    打印（今天）

    对于 [-12, -1, 0, 1, 2, 12, 20 ] 中的 mm：
        next_date = after_month（今天，毫米）
        打印（下一个日期）

```

* * *

## 回答 #30

> 赞同：1
> 
> 时间：2016-02-18T06:32:43.380

这是一个示例，它允许用户决定如何返回一个日期大于该月的天数的日期。

```
def add_months(date, months, endOfMonthBehaviour='RoundUp'):
    assert endOfMonthBehaviour in ['RoundDown', 'RoundIn', 'RoundOut', 'RoundUp'], \
        'Unknown end of month behaviour'
    year = date.year + (date.month + months - 1) / 12
    month = (date.month + months - 1) % 12 + 1
    day = date.day
    last = monthrange(year, month)[1]
    if day > last:
        if endOfMonthBehaviour == 'RoundDown' or \
            endOfMonthBehaviour == 'RoundOut' and months < 0 or \
            endOfMonthBehaviour == 'RoundIn' and months > 0:
            day = last
        elif endOfMonthBehaviour == 'RoundUp' or \
            endOfMonthBehaviour == 'RoundOut' and months > 0 or \
            endOfMonthBehaviour == 'RoundIn' and months < 0:
            # we don't need to worry about incrementing the year
            # because there will never be a day in December > 31
            month += 1
            day = 1
    return datetime.date(year, month, day)

>>> from calendar import monthrange
>>> import datetime
>>> add_months(datetime.datetime(2016, 1, 31), 1)
datetime.date(2016, 3, 1)
>>> add_months(datetime.datetime(2016, 1, 31), -2)
datetime.date(2015, 12, 1)
>>> add_months(datetime.datetime(2016, 1, 31), -2, 'RoundDown')
datetime.date(2015, 11, 30) 
```

* * *

## 回答 #31

> 赞同：0
> 
> 时间：2011-02-02T10:45:33.370

我认为做这样的事情而不是手动添加天数会更安全：

```
import datetime
today = datetime.date.today()

def addMonths(dt, months = 0):
    new_month = months + dt.month
    year_inc = 0
    if new_month>12:
        year_inc +=1
        new_month -=12
    return dt.replace(month = new_month, year = dt.year+year_inc)

newdate = addMonths(today, 6) 
```

* * *

## 回答 #32

> 赞同：0
> 
> 时间：2010-04-01T13:55:51.200

我使用此功能更改年份和月份，但保留日期：

```
def replace_month_year(date1, year2, month2):
    try:
        date2 = date1.replace(month = month2, year = year2)
    except:
        date2 = datetime.date(year2, month2 + 1, 1) - datetime.timedelta(days=1)
    return date2 
```

你应该写：

```
new_year = my_date.year + (my_date.month + 6) / 12
new_month = (my_date.month + 6) % 12
new_date = replace_month_year(my_date, new_year, new_month) 
```

* * *

## 回答 #33

> 赞同：0
> 
> 时间：2010-03-02T21:06:05.780

这就是我想出的。它移动了正确的月数和年数，但忽略了天数（这是我在我的情况下需要的）。

```
import datetime

month_dt = 4
today = datetime.date.today()
y,m = today.year, today.month
m += month_dt-1
year_dt = m//12
new_month = m%12
new_date = datetime.date(y+year_dt, new_month+1, 1) 
```

* * *

## 回答 #34

> 赞同：0
> 
> 时间：2011-12-31T18:10:56.757

user417751 对早期答案的返工。也许不是那么蟒蛇的方式，但它会照顾不同的月份长度和闰年。在这种情况下，2012 年 1 月 31 日 + 1 个月 = 2012 年 2 月 29 日。

```
import datetime
import calendar

def add_mths(d, x):
    newday = d.day
    newmonth = (((d.month - 1) + x) % 12) + 1
    newyear  = d.year + (((d.month - 1) + x) // 12)
    if newday > calendar.mdays[newmonth]:
        newday = calendar.mdays[newmonth]
        if newyear % 4 == 0 and newmonth == 2:
            newday += 1
    return datetime.date(newyear, newmonth, newday) 
```

* * *

## 回答 #35

> 赞同：0
> 
> 时间：2011-02-02T14:44:44.327

我这样解决了这个问题：

```
import calendar
from datetime import datetime
moths2add = 6
now = datetime.now()
current_year = now.year
current_month = now.month
#count days in months you want to add using calendar module
days = sum(
  [calendar.monthrange(current_year, elem)[1] for elem in range(current_month, current_month + moths)]
    )
print now + days 
```

* * *

## 回答 #36

> 赞同：0
> 
> 时间：2018-07-24T14:02:17.407

我使用了该`replace()`方法并编写了这个递归函数。是`dt`一个`datetime.datetime`对象：

```
def month_timedelta(dt, m):
    y = m // 12
    dm = m % 12
    if y == 0:
        if dt.month + m <= 12:
            return dt.replace(month = dt.month + m)
        else:
            dy = (dt.month + m) // 12
            ndt = dt.replace(year=dt.year + dy)
            return ndt.replace(month=(ndt.month + m) % 12)
    else:
        return month_timedelta(dt.replace(year=dt.year + y),dm) 
```

* * *

## 回答 #37

> 赞同：0
> 
> 时间：2017-01-01T15:38:38.517

另一种解决方案：计算下 n 个月的月天数总和，并将结果添加到当前日期。

```
import calendar
import datetime

def date_from_now(months):
    today = datetime.datetime.today()

    month = today.month
    year = today.year
    sum_days = 0

    for i in range(int(months)):
        month += 1

        if month == 13:
            month = 1
            year += 1

        sum_days += calendar.monthrange(year, month)[1]

    return datetime.date.today() + datetime.timedelta(sum_days)

print(date_from_now(12)) # if to day is 2017-01-01, output: 2019-01-01 
```

* * *

## 回答 #38

> 赞同：0
> 
> 时间：2021-03-03T22:01:05.677

我的实现基于 taleinat 的回答：

```
import datetime
import calendar

def add_months(orig_date, month_count = 1):
    while month_count > 12:
        month_count -= 12
        orig_date = add_months(orig_date, 12)
    new_year = orig_date.year
    new_month = orig_date.month + month_count
    # note: in datetime.date, months go from 1 to 12
    if new_month > 12:
        new_year += 1
        new_month -= 12

    last_day_of_month = calendar.monthrange(new_year, new_month)[1]
    new_day = min(orig_date.day, last_day_of_month)

    return orig_date.replace(year=new_year, month=new_month, day=new_day) 
```

使用此功能，您可以添加任意数量的月份。

```
from datetime import date
dt = date(2021, 1, 31)

print(add_months(dt, 49)) 
```

返回 `2025-02-28`

* * *

## 回答 #39

> 赞同：-1
> 
> 时间：2012-05-25T08:15:20.373

在这个函数中，n 可以是正数或负数。

```
def addmonth(d, n):
    n += 1
    dd = datetime.date(d.year + n/12, d.month + n%12, 1)-datetime.timedelta(1)
    return datetime.date(dd.year, dd.month, min(d.day, dd.day)) 
```

* * *

## 回答 #40

> 赞同：-1
> 
> 时间：2011-05-10T18:33:26.617

我对 Tony Diep 答案的修改，可能稍微优雅一些​​（Python 2 当然，匹配问题的日期和原始答案，对于 Python 3 进行必要的修改，包括`/`至少`//`）：

```
def add_months(date, months):
    month = date.month + months - 1
    year = date.year + (month / 12)
    month = (month % 12) + 1
    day = date.day
    while (day > 0):
        try:
            new_date = date.replace(year=year, month=month, day=day)
            break
        except:
            day = day - 1    
    return new_date 
```

根据“业务需求”解释添加月份，即映射到月底之后的日期应该映射到月底而不是下个月。

* * *

## 回答 #41

> 赞同：-1
> 
> 时间：2013-05-28T12:53:59.157

我们可能应该使用 dateutil.relativedelta

但是出于学术兴趣，我将补充一点，在我发现它之前，我打算使用它：

尝试：
   vexpDt = K.today.replace(K.today.year + (K.today.month+6)//12, (K.today.month+5)%12+1, K.today.day)
除外:
   vexpDt = K.today.replace(K.today.year + (K.today.month+6)//12, (K.today.month+6)%12+1, 1) - timedelta(days = 1 )

它看起来很简单，但仍然可以解决所有问题，例如 29,30,31

它也适用于 - 6个月通过做 -timedelta

nb - 不要被 K.today 弄糊涂了，它只是我程序中的一个变量

* * *

## 回答 #42

> 赞同：-1
> 
> 时间：2013-10-09T10:17:35.873

```
 def addDay(date, number):
        for i in range(number)
            #try to add a day
            try:
                date = date.replace(day = date.day + 1)
            #in case it's impossible ex:january 32nd add a month and restart at day 1
            except:
                #add month part
                try:
                    date = date.replace(month = date.month +1, day = 1)
                except:
                    date = date.replace(year = date.year +1, month = 1, day = 1) 
```

对于仍在阅读这篇文章的每个人。我认为这段代码更清晰，特别是与使用模（％）的代码相比。

抱歉有任何语法错误，英语不是我的主要语言

* * *

## 回答 #43

> 赞同：-1
> 
> 时间：2018-03-23T13:15:29.003

我找不到这个问题的确切解决方案，所以我会发布我的解决方案，以防它对使用标准日历和日期时间库有任何帮助。这适用于加减月份，并考虑月末滚动和最后一个月的天数少于初始天数的情况。如果您正在寻找更复杂的操作，我还有一个更通用的解决方案，它会添加定期间隔（天、月、年、季度、学期等），例如：'1m'、'-9m'、'-1.5y'、 “-3q”、“1s”等

```
from datetime import datetime
from calendar import monthrange
def date_bump_months(start_date, months):
    """
    bumps months back and forth. 
    --> if initial date is end-of-month, i will move to corresponding month-end
    --> ir inital date.day is greater than end of month of final date, it casts it to momth-end
    """
    signbit = -1 if months < 0 else 1
    d_year, d_month = divmod(abs(months),12)    
    end_year = start_date.year + d_year*signbit 
    end_month = 0
    if signbit ==-1:            
        if d_month < start_date.month:
            end_month = start_date.month - d_month
        else:
            end_year -=1
            end_month = 12 - (d_month - start_date.month)
    else:
        end_month +=start_date.month
        if end_month  > 12:
            end_year +=1
            end_month -=12
    # check if we are running end-of-month dates
    eom_run = monthrange(start_date.year, start_date.month)[1]==start_date.day
    eom_month = monthrange((end_year), (end_month))[1]
    if eom_run:
        end_day = eom_month 
    else:
        end_day = min(start_date.day, eom_month )    
    return date(end_year, end_month, end_day) 
```

* * *

## 回答 #44

> 赞同：-1
> 
> 时间：2017-12-07T00:08:05.397

使用下面给定的函数，您可以获得 x 个月之后/之前的日期。

```
从日期时间导入日期

def next_month（给定日期，月份）：
    yyyy = int(((given_date.year * 12 + given_date.month) + month)/12)
    mm = int(((given_date.year * 12 + given_date.month) + month)%12)

    如果毫米 == 0：
        年年 -= 1
        毫米 = 12
    return given_date.replace(year=yyyy, month=mm)

如果 __name__ == "__main__":
    今天 = date.today()
    打印（今天）

    对于 [-12, -1, 0, 1, 2, 12, 20 ] 中的 mm：
        next_date = next_month（今天，毫米）
        打印（下一个日期）

```

* * *

## 回答 #45

> 赞同：-1
> 
> 时间：2016-01-16T19:30:27.960

当我需要添加几个月或几年并且不想导入更多库时，这就是我所做的。

```
import datetime
__author__ = 'Daniel Margarido'

# Check if the int given year is a leap year
# return true if leap year or false otherwise
def is_leap_year(year):
    if (year % 4) == 0:
        if (year % 100) == 0:
            if (year % 400) == 0:
                return True
            else:
                return False
        else:
            return True
    else:
        return False

THIRTY_DAYS_MONTHS = [4, 6, 9, 11]
THIRTYONE_DAYS_MONTHS = [1, 3, 5, 7, 8, 10, 12]

# Inputs -> month, year Booth integers
# Return the number of days of the given month
def get_month_days(month, year):
    if month in THIRTY_DAYS_MONTHS:   # April, June, September, November
        return 30
    elif month in THIRTYONE_DAYS_MONTHS:   # January, March, May, July, August, October, December
        return 31
    else:   # February
        if is_leap_year(year):
            return 29
        else:
            return 28

# Checks the month of the given date
# Selects the number of days it needs to add one month
# return the date with one month added
def add_month(date):
    current_month_days = get_month_days(date.month, date.year)
    next_month_days = get_month_days(date.month + 1, date.year)

    delta = datetime.timedelta(days=current_month_days)
    if date.day > next_month_days:
        delta = delta - datetime.timedelta(days=(date.day - next_month_days) - 1)

    return date + delta

def add_year(date):
    if is_leap_year(date.year):
        delta = datetime.timedelta(days=366)
    else:
        delta = datetime.timedelta(days=365)

    return date + delta

# Validates if the expected_value is equal to the given value
def test_equal(expected_value, value):
    if expected_value == value:
        print "Test Passed"
        return True

    print "Test Failed : " + str(expected_value) + " is not equal to " str(value)
    return False

# Test leap year
print "---------- Test leap year ----------"
test_equal(True, is_leap_year(2012))
test_equal(True, is_leap_year(2000))
test_equal(False, is_leap_year(1900))
test_equal(False, is_leap_year(2002))
test_equal(False, is_leap_year(2100))
test_equal(True, is_leap_year(2400))
test_equal(True, is_leap_year(2016))

# Test add month
print "---------- Test add month ----------"
test_equal(datetime.date(2016, 2, 1), add_month(datetime.date(2016, 1, 1)))
test_equal(datetime.date(2016, 6, 16), add_month(datetime.date(2016, 5, 16)))
test_equal(datetime.date(2016, 3, 15), add_month(datetime.date(2016, 2, 15)))
test_equal(datetime.date(2017, 1, 12), add_month(datetime.date(2016, 12, 12)))
test_equal(datetime.date(2016, 3, 1), add_month(datetime.date(2016, 1, 31)))
test_equal(datetime.date(2015, 3, 1), add_month(datetime.date(2015, 1, 31)))
test_equal(datetime.date(2016, 3, 1), add_month(datetime.date(2016, 1, 30)))
test_equal(datetime.date(2016, 4, 30), add_month(datetime.date(2016, 3, 30)))
test_equal(datetime.date(2016, 5, 1), add_month(datetime.date(2016, 3, 31)))

# Test add year
print "---------- Test add year ----------"
test_equal(datetime.date(2016, 2, 2), add_year(datetime.date(2015, 2, 2)))
test_equal(datetime.date(2001, 2, 2), add_year(datetime.date(2000, 2, 2)))
test_equal(datetime.date(2100, 2, 2), add_year(datetime.date(2099, 2, 2)))
test_equal(datetime.date(2101, 2, 2), add_year(datetime.date(2100, 2, 2)))
test_equal(datetime.date(2401, 2, 2), add_year(datetime.date(2400, 2, 2))) 
```

只需创建一个 datetime.date() 对象，调用 add_month(date) 添加一个月，调用 add_year(date) 添加一年。

* * *

## 回答 #46

> 赞同：-4
> 
> 时间：2009-02-13T15:20:59.177

使用 python datetime 模块将六个月的时间增量添加到 datetime.today() 。

[http://docs.python.org/library/datetime.html](http://docs.python.org/library/datetime.html)

您当然必须解决 Johannes Weiß 提出的问题——您所说的 6 个月是什么*意思*？

# python - 如何在 Python 2.x 中对对象执行自省？

> ID：546337
> 
> 赞同：24
> 
> 时间：2009-02-13T15:22:50.220
> 
> 标签：python, introspection, python-datamodel

我正在使用 Python 2.x，并且我有一个从以太中召唤的物体；关于它的文档不是特别清楚。我希望能够获得该对象的属性列表以及每个属性的类型。

同样，我还想获取该对象的方法列表，以及我可以找到的有关该方法的任何其他信息，例如参数的数量及其各自的类型。

我有一种感觉，我只是在我的谷歌搜索中错过了正确的行话。并不是说我想破坏细节，但它是 Active Directory，所以这总是很有趣。

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-02-13T15:27:23.360

好吧...您的第一站将是一个简单的目录（对象）。这将显示所有对象的成员，包括字段和方法。在交互式 Python shell 中试一试，并试一试。

例如：

```
> class Foo:
   def __init__(self):
    self.a = "bar"
    self.b = 4711

> a=Foo()
> dir(a)
['__doc__', '__init__', '__module__', 'a', 'b'] 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-02-13T15:31:19.793

怎么样：

```
>>> o=object()
>>> [(a,type(o.__getattribute__(a))) for a in dir(o)]
[('__class__', <type 'type'>), ('__delattr__', <type 'method-wrapper'>), 
('__doc__', <type 'str'>), ('__format__', <type 'builtin_function_or_method'>),
('__getattribute__', <type 'method-wrapper'>), ('__hash__', <type 'method-wrapper'>),
('__init__', <type 'method-wrapper'>), 
('__new__', <type 'builtin_function_or_method'>),
('__reduce__', <type 'builtin_function_or_method'>),
('__reduce_ex__', <type 'builtin_function_or_method'>),
('__repr__', <type 'method-wrapper'>), ('__setattr__', <type 'method-wrapper'>),
('__sizeof__', <type 'builtin_function_or_method'>),
('__str__', <type 'method-wrapper'>),
('__subclasshook__', <type 'builtin_function_or_method'>)]
>>> 
```

更结构化的方法是使用[检查模块](http://docs.python.org/library/inspect.html#module-inspect)：

> inspect 模块提供了几个有用的函数来帮助获取有关活动对象的信息，例如模块、类、方法、函数、回溯、框架对象和代码对象。例如，它可以帮助您检查类的内容、检索方法的源代码、提取和格式化函数的参数列表，或者获取显示详细回溯所需的所有信息。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-13T15:33:17.340

“ [Python 自省指南](https://www.ibm.com/developerworks/library/l-pyint/)”是一篇很好的文章，可以帮助您入门。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-02-13T15:40:04.390

你可以看看[检查模块](http://docs.python.org/library/inspect.html)。它提供了多种工具来检查活动对象以及源代码。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-13T16:04:23.630

如果您使用的是 win32com.client.Dispatch，检查 Python 对象可能没有多大帮助，因为它是 IDispatch 的通用包装器。

您可以使用[makepy （Activestate](http://starship.python.net/crew/mhammond/win32/) [Python](http://www.activestate.com)附带）从类型库生成 Python 包装器。然后您可以查看包装器的代码。

# javascript - 使用 jQuery，我如何存储对 $.ajax 函数的调用结果以供重复使用？

> ID：546344
> 
> 赞同：0
> 
> 时间：2009-02-13T15:25:00.963
> 
> 标签：javascript, jquery, ajax

感谢您阅读本文。

我想这确实是一个 javascript 问题，我的标题可能不是我想要做的事情的核心，但我想将我的 ajax 请求的结果存储在一个全局变量中。这将允许我在进行 ajax 调用之前测试 var ......并避免重复 ajax 调用相同的数据。我需要能够通过 populateSelect 函数将 click 事件中的变量名向下传递到 ajaxCall 函数中。

似乎我可以将函数作为参数传递，但我无法做到这一点。

我喜欢在我的问题中包含工作示例，但在这种情况下，调用服务器的延迟是问题的一部分。

谢谢

```
$('#getSelectOptions').bind("click", function() {
 populateSelect(this);
});

function populateSelect(whatWasClicked) {
 var thisSelect = $(whatWasClicked).parents("div").find("select") ;

 var before = function() { $(loading).show() ;  } ;
 var complete = function() { $(loading).hide() ;  } ;
 var data = {'_service' : 'myService', '_program' : 'myProgram' } ;
 var error = function(){alert("Error"); } ;
 var success = function(request) { $(thisSelect).html(request) ; };
 var waitTime = 20000 ;

 ajaxCall(thisSelect, waitTime, before, complete, data, success, error ) ;
}

function ajaxCall(elementToPopulate, waitTime, whatToDoBeforeAjaxSend,
                  whatToDoAfterAjaxSend, dataToSendToTheServer, 
                  whatToDoAfterSuccess, whatToDoAfterError) {
 $.ajax({   
  type: "post", 
  url: "http://myURL/cgi-bin/broker",   
  dataType: "text", 
  data: dataToSendToTheServer, 
  timeout: waitTime, 
  beforeSend: whatToDoBeforeAjaxSend, 
  error: whatToDoAfterError(request),
  success: whatToDoAfterSuccess(request)
 });
} 
```

**编辑**关于如何写一个好问题的进一步教育......我应该提到我调用populateSelect来填充多个选择......所以我需要方法来引用每个选择的结果

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-13T15:45:29.230

看起来在您提供的示例中，您只有一种类型的 AJAX 请求，`POST`每次都使用相同的数据编辑到相同的 URL。如果是这样的话，你应该只需要这样的东西：

```
var brokerResponse = null;  // <-- Global variable

function populateSelect(whatWasClicked) {
 var thisSelect = $(whatWasClicked).parents("div").find("select") ;

 if (!brokerResponse) {  // <-- Does an old response exist? If not, get one...
   var before = function() { $(loading).show() ;  } ;
   var complete = function() { $(loading).hide() ;  } ;
   var data = {'_service' : 'myService', '_program' : 'myProgram' } ;
   var error = function(){alert("Error"); } ;

   var success = function(request) {  // <-- Store the response before use
      brokerResponse = request; 
      $(thisSelect).html(brokerResponse);
   };
   var waitTime = 20000 ;

   ajaxCall(thisSelect, waitTime, before, complete, data, success, error ) ;
 }
 else {   // <-- If it already existed, we get here.
   $(thisSelect).html(brokerResponse);  // <-- Use the old response
 }
} 
```

如果您有多个可能的项目`whatWasClicked`，每个项目都需要缓存不同的 AJAX 响应，那么您需要有一些用于标识的字符串`whatWasClicked`，并使用它在全局变量中存储多个值。例如，如果你有一个独特的`id`on `whatWasClicked`，这将工作：

```
var brokerResponse = {}; // Global variable is a simple object

function populateSelect(whatWasClicked) {

 var whatWasClickedId = $(whatWasClicked).attr('id'); // Get the unique ID
 var thisSelect = $(whatWasClicked).parents("div").find("select") ;

 if (!brokerResponse[whatWasClickedId]) {  // Check that ID for a response
   var before = function() { $(loading).show() ;  } ;
   var complete = function() { $(loading).hide() ;  } ;
   var data = {'_service' : 'myService', '_program' : 'myProgram' } ;
   var error = function(){alert("Error"); } ;
   var success = function(request) {

      brokerResponse[whatWasClickedId] = request; // Using ID
      $(thisSelect).html(brokerResponse);
   };
   var waitTime = 20000 ;

   ajaxCall(thisSelect, waitTime, before, complete, data, success, error ) ;
 }
 else {
   $(thisSelect).html(brokerResponse[whatWasClickedId]); // Etc...
 }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-13T16:37:59.883

jQuery 有一个 $.data 方法，您可以使用它来存储/检索与页面上任何元素相关的项目。

```
//e.g. create some object
var inst = {};
inst.name = 'My Name'

var target = $('#textbox1');

//save the data
$.data(target, 'PROP_NAME', inst);

//retrieve the instance
var inst =  $.data(target, 'PROP_NAME'); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-13T15:36:48.423

JavaScript 的作用域是这样的，如果您刚刚声明了一个全局变量，您应该能够从 ajax 成功函数和 click 函数中访问它。

```
var _global_holder = null;
$('#getSelectOptions').bind("click", function() {
 if(_global_holder==null) { whatever }
 populateSelect(this);
});

function populateSelect(whatWasClicked) {
 if(_global_holder !== null) {
    whatever
  } else { whatever else }

 ajaxCall(thisSelect, waitTime, before, complete, data, success, error ) ;
}

function ajaxCall(elementToPopulate, waitTime, whatToDoBeforeAjaxSend,
                  whatToDoAfterAjaxSend, dataToSendToTheServer, 
                  whatToDoAfterSuccess, whatToDoAfterError) {
...
} 
```

# asp.net - vb.net，选项严格，枚举和覆盖 ToString

> ID：546345
> 
> 赞同：1
> 
> 时间：2009-02-13T15:25:13.613
> 
> 标签：asp.net, vb.net, enums

我有以下代码：

```
Public Enum Country
   Canada = 1
   USA = 2
End Enum 
```

当我想查看用户是否选择了一个值时，我会：

```
ddl.SelectedValue = Country.Canada 
```

哪个工作正常。但是，如果我打开隐式转换的警告，则会发出警告。将其更改为

```
ddl.SelectedValue = Country.Canada.ToString() 
```

失败，因为 ToString() 方法返回“Canada”而不是“1”。

摆脱警告的最佳方法是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-13T15:28:27.240

您可以将 SelectedValue 显式转换为 int，或将 Country 转换为字符串。

```
If CInt(ddl.SelectedValue) = Country.Canada 
```

或者

```
If ddl.SelectedValue = CStr(Country.Canada) 
```

如果您采用第一个选项，您可能需要将您的枚举显式声明为 Integer

```
Public Enum Country As Integer 
```

出现警告是因为 SelectedValue 是一个字符串，而 Country 是一个整数，所以会发生隐式转换 - 就像它说的那样！！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-13T15:35:00.533

如果您想要值 '1' 而不是 'Canada'，则可以先将其*显式*转换为整数，然后对其结果调用 .ToString() 。

```
ddl.SelectedValue = DirectCast(Country.Canada, Integer).ToString() 
```

# vb.net - VB.NET 2005 - “全局”事件处理程序？

> ID：546348
> 
> 赞同：5
> 
> 时间：2009-02-13T15:26:47.340
> 
> 标签：vb.net, winforms

假设对于 WinForms 应用程序中的每个 Form，您希望将光标更改为 WaitCursor。执行此操作的明显方法是将代码添加到实例化/显示表单的每个位置：

```
Try
    Me.Cursor = Cursors.WaitCursor

    Dim f As New frmMyForm
    f.Show()

Catch ex As Exception
    Throw
Finally
    Me.Cursor = Cursors.Default
End Try 
```

但是，我想知道是否有办法告诉您的应用程序，“每当任何表单加载事件触发时，显示一个 WaitCursor。当表单事件显示完成时，将光标设置回默认值。” 这样，Me.Cursor 代码可以只在一个地方，而不是分散在整个应用程序中——并且不会忘记将其放入每个表单实例化中。

我想您可以将常规 Form 类子类化并在覆盖的事件中添加光标设置，但我相信当您对 Form 对象进行子类化时，您将失去可视化设计器功能。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-13T19:43:26.643

子类化是一种选择，只要不将超类设置为 mustinherit，就不会失去设计器，它并不真正喜欢那样。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-13T15:53:45.200

回答您的问题 - 没有全球 .Net 事件可以实现您想要的。对此没有任何纯 .net 解决方案。您可以查看 Aspect Orientated Programming and Cross Cut Concerns - 可能有一个 AOP 解决方案（一些谷歌搜索会让您开始，然后返回此处了解详细信息）。

但是，接下来的内容更多的是一个想法，而不是关于如何使用 win32 消息传递实现此目的的完整解决方案。

1.  您需要确定哪些 win32 消息对应于 Load 事件，以及是否存在始终在 load 事件之后发生的 win32 消息。加载事件的一个候选者可能是[WM_SHOWWINDOW](http://msdn.microsoft.com/en-us/library/ms632645(VS.85).aspx)但我不确定。
2.  编写一个消息过滤器类（即实现[IMessageFilter](http://msdn.microsoft.com/en-us/library/system.windows.forms.imessagefilter.aspx)）。
3.  在消息过滤器类的 PreMessageFilter 方法中检查消息类型，如果它是具有正确参数的 WM_SHOWWINDOW（或其他）消息，那么您可以设置/重置光标（使用 Cursor.Current = Cursors.WaitCursor - 您需要再次测试这个)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-13T19:56:32.463

另一个不涉及子类化的选项是向 Form 类型添加扩展方法。然后你可以只调用你的扩展方法（类似于 ShowAndWait()）而不是 show。如果你用不同的签名重载它，你甚至可能会调用 is Show 。

# openid - 非技术人员使用的网站的 OpenID 与自定义用户登录

> ID：546350
> 
> 赞同：7
> 
> 时间：2009-02-13T15:28:16.650
> 
> 标签：openid, user-experience

有没有人有在非技术网站上实施 OpenID 的经验？如果您这样做了，您的非技术用户对 OpenID 的概念和在不同网站上创建帐户有何反应？

我真的很喜欢单点登录的想法，但我担心习惯在每个网站上创建帐户的非技术人员会觉得它很复杂甚至可疑。

我知道我可以实现两者（这可能是我必须走的路线），但我试图避免实现自定义用户登录。

此外，如果您有一些仅使用 OpenID 的成功的非技术网站的链接，我们将不胜感激。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-13T15:34:30.813

雅虎不久前发布了他们的[OpenID 可用性研究](http://developer.yahoo.net/blog/archives/2008/10/open_id_research.html)结果。这将使您了解非技术人员如何看待 OpenID。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-13T15:36:16.397

[http://openiddirectory.com/](http://openiddirectory.com/)是使用 OpenID 的站点的目录。你可能会在那里发现一些有趣的东西。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-14T00:25:15.703

JanRain 在[http://www.janrain.com/openid/casestudies上有一些关于 OpenID 使用的案例研究](http://www.janrain.com/openid/casestudies)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-10-14T05:43:32.247

我其实也有同样的问题。

我将添加我自己的输入 - 我对 OpenID 的唯一真实体验是在 stackoverflow 上。我会说这很令人困惑。也许这与 stackoverflow 允许匿名帐户连接在一起的方式有关，无论如何，整体体验并不那么简单。

特别是不清楚我是否使用 stackoverflow*创建*了一个帐户。我想知道我是否真的注册了。这是我担心的一件事。表单登录清楚地表明创建了一个帐户。

我真的很想听听有人告诉我使用 OpenID 有什么好处。为什么它比表单登录更好？显然，它增加了一些复杂性，因此必须通过一些我不理解的好处来抵消。

# .net - 您如何调试 WCF 问题？

> ID：546358
> 
> 赞同：2
> 
> 时间：2009-02-13T15:30:03.103
> 
> 标签：.net, wcf, configuration, wcf-binding

我在使用 WS 绑定的 WCF 服务中遇到了一个奇怪的问题。当我配置它没有会话（安全/可靠）时，它工作得很好，但会话不是这样。例如，当我配置安全性（消息安全性、Windows 凭据）时，我在第 10 次或第 11 次调用后超时。我的服务调用了另一个 WCF 服务，但是这两个服务都配置了相同的绑定参数。

你将如何调试这样的问题？除了打开跟踪和使用 SvcTraceViewer 之外，您还会使用哪些工具？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-14T08:18:33.617

在开发 WCF 服务时最容易浪费大量时间的领域之一是绑定配置。对于初学者来说，在源代码存储库中虔诚地备份您的工作配置。您可能还想为在服务创建之前运行的配置文件本身添加一个验证例程。

就调试此类 WCF 问题而言，确实无法替代旧的 Trace.WriteLine()，它写入映射到文件、服务和客户端的 TraceListener。但实际上，考虑到您的问题相当普遍并且很可能 100% 与配置相关，我建议您了解更多有关绑定设置的信息，尤其是超时。将值设置为任意高的数字，甚至设置为 Timeout.Infinite 数值（作为字符串），这将告诉 WCF 允许无限超时。然后，问问自己，为什么有些东西会超时，而只是稍微改变一下绑定。

关于您的具体问题，会话可能没有正确终止，因为客户端代理没有通过显式调用 Close() 方法正确关闭。当您处理无会话绑定时，您可能能够摆脱这种情况，但除非您关闭代理，否则会话不会被释放。这样做的副作用是会达到通常 10 个并发会话的默认服务限制值。一旦您了解了会话的生命周期，您可能想要查看可以在服务契约的方法上为 OperationContract 属性指定的 IsInitiating、IsTerminating 和 IsOneWay 属性。

以下是一些有用的资源：

OperationContract：（不会链接的奇怪网址）
[http://en.csharp-online.net/WCF_Services](http://en.csharp-online.net/WCF_Services) —OperationContract_Attribute

使用会话：http:
[//msdn.microsoft.com/en-us/library/ms733040.aspx](http://msdn.microsoft.com/en-us/library/ms733040.aspx)

WCF 会话、实例化和可靠消息传递的便捷摘要
[http://www.pluralsight.com/community/blogs/aaron/archive/2006/02/27/19253.aspx](http://www.pluralsight.com/community/blogs/aaron/archive/2006/02/27/19253.aspx)

而且，正如布赖恩所提到的，我对一个节流问题的回答：
[WCF 服务节流](https://stackoverflow.com/questions/480020/wcf-service-throttling)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-13T16:56:07.453

调试这种情况的最佳方法是在 WCF 服务/客户端中激活跟踪。跟踪器会创建日志文件，您可以使用内置跟踪查看器来阅读这些文件。 [http://msdn.microsoft.com/en-us/library/ms733025.aspx](http://msdn.microsoft.com/en-us/library/ms733025.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-13T18:48:25.233

听起来你可能会踩油门...

[WCF 服务限制](https://stackoverflow.com/questions/480020/wcf-service-throttling)

[http://kennyw.com/indigo/150](http://kennyw.com/indigo/150)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-04-03T08:45:23.223

不要忘记从客户端调用代理上的 .Close() 方法。

# java - 当表单作为 multipart/form-data 发布时，UTF-8 文本会出现乱码

> ID：546365
> 
> 赞同：56
> 
> 时间：2009-02-13T15:31:14.800
> 
> 标签：java, jakarta-ee

我正在将文件上传到服务器。文件上传 HTML 表单有 2 个字段：

1.  文件名 - 一个 HTML 文本框，用户可以在其中以任何语言命名。
2.  文件上传 - 一个 HTMl “文件”，用户可以在其中指定要从磁盘上传的文件。

提交表单时，正确接收文件内容。但是，当读取文件名（上面的第1点）时，它是乱码。ASCII 字符显示正确。当名称以其他语言（德语、法语等）给出时，就会出现问题。

在 servlet 方法中，请求的字符编码设置为 UTF-8。我什至尝试过如上所述的过滤器 -[如何使此代码使用 jQuery/Ajax 提交 UTF-8 表单文本区域？](https://stackoverflow.com/questions/29751/problems-while-submitting-a-utf-8-form-textarea-with-jquery-ajax)- 但它似乎不起作用。只有文件名似乎是乱码。

文件名所在的 MySQL 表支持 UTF-8。我给出了随机的非英文字符，它们被正确存储/显示。

使用 Fiddler，我监控了请求并正确传递了所有 POST 数据。我正在尝试确定数据如何/在何处出现乱码。任何帮助将不胜感激。

* * *

## 回答 #1

> 赞同：57
> 
> 时间：2009-02-14T19:26:00.767

我在使用 Apache commons-fileupload 时遇到了同样的问题。我没有找出导致问题的原因，尤其是因为我在以下位置使用了 UTF-8 编码：1\. HTML 元标记 2\. 表单接受字符集属性 3\. Tomcat 过滤每个设置“UTF-8”的请求编码

-> 我的解决方案是专门将字符串从 ISO-8859-1（或任何您的平台的默认编码）转换为 UTF-8：

```
new String (s.getBytes ("iso-8859-1"), "UTF-8"); 
```

希望有帮助

编辑：从 Java 7 开始，您还可以使用以下内容：

```
new String (s.getBytes (StandardCharsets.ISO_8859_1), StandardCharsets.UTF_8); 
```

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2011-09-12T03:31:06.463

只需使用 Apache commons 上传库。添加`URIEncoding="UTF-8"`到 Tomcat 的连接器，并使用 FileItem.getString("UTF-8") 而不是 FileItem.getString() 而不指定字符集。

希望这有帮助。

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2012-04-02T05:30:17.783

我遇到了这个问题，发现这是调用的顺序

```
request.setCharacterEncoding("UTF-8"); 
```

那是造成问题的原因。它必须在对 request.getParameter() 的所有调用之前调用，因此我制作了一个特殊的过滤器以在过滤器链的顶部使用。

[https://rogerkeays.com/servletrequest-setcharactercoding-ignored](https://rogerkeays.com/servletrequest-setcharactercoding-ignored)

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2009-10-11T09:19:55.677

我遇到了同样的问题，结果发现除了在过滤器中指定编码

```
request.setCharacterEncoding("UTF-8");
response.setCharacterEncoding("UTF-8"); 
```

有必要在表单中添加“acceptcharset”

```
<form method="post" enctype="multipart/form-data" acceptcharset="UTF-8" > 
```

并运行**JVM**

```
-Dfile.encoding=UTF-8 
```

如果您使用 response.setCharacterEncoding() 在 HTTP 标头中发送 HTML 元标记，则它不是必需的。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2015-08-12T14:56:37.470

如果有人在使用 Grails（或纯 Spring）Web 应用程序时偶然发现了这个问题，这里是帮助我的帖子：

[http://forum.spring.io/forum/spring-projects/web/2491-solved-character-encoding-and-multipart-forms](http://forum.spring.io/forum/spring-projects/web/2491-solved-character-encoding-and-multipart-forms)

为了将多部分请求的默认编码设置为 UTF-8（而不是 ISO-8859-1），我在 resources.groovy（Spring DSL）中添加了以下代码：

```
multipartResolver(ContentLengthAwareCommonsMultipartResolver) {
    defaultEncoding = 'UTF-8'
} 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2016-08-26T13:23:36.637

我`org.apache.commons.fileupload.servlet.ServletFileUpload.ServletFileUpload(FileItemFactory)` 在读出参数值时使用和定义编码：

```
List<FileItem> items = new ServletFileUpload(new DiskFileItemFactory()).parseRequest(request);

for (FileItem item : items) {
    String fieldName = item.getFieldName();

    if (item.isFormField()) {
        String fieldValue = item.getString("UTF-8"); // <-- HERE 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-02-13T16:09:50.043

过滤器是 IE 的关键。其他一些需要检查的事情；

什么是页面编码和字符集？两者都应该是 UTF-8

```
<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%> 
```

元标记中的字符集是什么？

```
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /> 
```

您的 MySQL 连接字符串是否指定 UTF-8？例如

```
jdbc:mysql://127.0.0.1/dbname?requireSSL=false&useUnicode=true&characterEncoding=UTF-8 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2014-11-05T16:34:28.210

我将 Primefaces 与 glassfish 和 SQL Server 一起使用。

就我而言，我在后端创建了 Webfilter，以获取每个请求并转换为 UTF-8，如下所示：

```
package br.com.teste.filter;

import java.io.IOException;

import javax.servlet.FilterChain;
import javax.servlet.FilterConfig;
import javax.servlet.ServletException;
import javax.servlet.ServletRequest;
import javax.servlet.ServletResponse;
import javax.servlet.annotation.WebFilter;

@WebFilter(servletNames={"Faces Servlet"})
public class Filter implements javax.servlet.Filter {

    @Override
    public void destroy() {
        // TODO Auto-generated method stub

    }

    @Override
    public void doFilter(ServletRequest request, ServletResponse response,
            FilterChain chain) throws IOException, ServletException {
        request.setCharacterEncoding("UTF-8");
        chain.doFilter(request, response);      
    }

    @Override
    public void init(FilterConfig filterConfig) throws ServletException {
        // TODO Auto-generated method stub      
    }

} 
```

在视图（.xhtml）中，我需要将 enctype 参数的形式设置为 UTF-8，如@Kevin Rahe：

```
 <h:form id="frmt" enctype="multipart/form-data;charset=UTF-8" >
         <!-- your code here -->
    </h:form> 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-15T00:38:42.730

过滤器和设置 Tomcat 以支持 UTF-8 URI 仅在您通过 URL 的查询字符串传递时才重要，就像使用 HTTP GET 一样。如果您使用 POST，在 HTTP 消息的正文中带有查询字符串，那么重要的是请求的内容类型，这将取决于浏览器将内容类型设置为 UTF-8 和使用该编码发送内容。

真正做到这一点的唯一方法是告诉浏览器您只能接受 UTF-8，方法是在对 "UTF-8;q=1,ISO-8859-1;q=0.6" 的每个响应上设置 Accept-Charset 标头. 这将使 UTF-8 成为最佳质量，默认字符集 ISO-8859-1 可以接受，但质量较低。

你说的文件名是乱码，是不是HttpServletRequest.getParameter的返回值是乱码？

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2018-01-31T16:06:55.203

我有同样的问题。唯一对我有用的解决方案是将 <property = "defaultEncoding" value = "UTF-8"> 添加到 spring 配置文件中的 multipartResoler 中。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2018-08-09T09:37:47.207

您还必须确保 web.xml 中的编码过滤器 (org.springframework.web.filter.CharacterEncodingFilter) 在多部分过滤器 (org.springframework.web.multipart.support.MultipartFilter) 之前映射。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2019-03-28T09:47:06.937

我想我迟到了，但是当你使用 wildfly 时，你可以在standalone.xml 中添加一个默认编码。只需在standalone.xml 中搜索

```
<servlet-container name="default"> 
```

并像这样添加编码：

```
<servlet-container name="default" default-encoding="UTF-8"> 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2019-06-13T00:27:53.673

为避免手动将所有请求参数转换为 UTF-8，您可以`@InitBinder`在控制器中定义一个带有注释的方法：

```
@InitBinder
protected void initBinder(WebDataBinder binder) {
    binder.registerCustomEditor(String.class, new CharacterEditor(true) {
        @Override
        public void setAsText(String text) throws IllegalArgumentException {
            String properText = new String(text.getBytes(StandardCharsets.ISO_8859_1), StandardCharsets.UTF_8);
            setValue(properText);
        }
    });
} 
```

以上将在定义它的控制器中自动将所有请求参数转换为 UTF-8。

* * *

## 回答 #14

> 赞同：-1
> 
> 时间：2009-02-15T01:35:04.843

您不使用 UTF-8 对 HTML 表单的文本数据进行编码。html 标准定义了两种编码，[该标准的相关部分在这里](http://www.w3.org/TR/html401/interact/forms.html#h-17.13.4.2)。处理 ascii 的“旧”编码是 application/x-www-form-urlencoded。新的，可以正常工作的，是多部分/表单数据。

具体来说，表单声明如下所示：

```
 <FORM action="http://server.com/cgi/handle"
       enctype="multipart/form-data"
       method="post">
   <P>
   What is your name? <INPUT type="text" name="submit-name"><BR>
   What files are you sending? <INPUT type="file" name="files"><BR>
   <INPUT type="submit" value="Send"> <INPUT type="reset">
 </FORM> 
```

我认为这就是你所需要担心的——网络服务器应该处理它。如果您正在编写直接从 Web 客户端读取 InputStream 的内容，那么您将需要阅读[RFC 2045](http://www.ietf.org/rfc/rfc2045.txt)和[RFC 2046](http://www.ietf.org/rfc/rfc2046.txt)。

# c# - 如何将 CookieCollection 插入 CookieContainer？

> ID：546369
> 
> 赞同：18
> 
> 时间：2009-02-13T15:32:34.907
> 
> 标签：c#, cookies, httpwebrequest

在我得到 httpwebrequest 的响应后，我希望保存获得的 cookie，以便在另一个 httbwebrequest 中使用它们。但是，我需要将 CookieCollection 插入 CookieContainer。我怎么做？试图做：

```
request.Cookiecontainer.add(response.Cookies); 
```

但这不断出现错误：对象引用未设置为对象的实例。

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2009-02-13T16:06:47.570

```
request.CookieContainer = new CookieContainer();
request.CookieContainer.Add(response.Cookies); 
```

据微软称：

> 默认情况下，CookieContainer 是一个空引用（在 Visual Basic 中为 Nothing）。您必须将 CookieContainer 对象分配给该属性，以便在 GetResponse 方法返回的 HttpWebResponse 的 Cookies 属性中返回 cookie。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-13T15:46:04.220

```
request.CookieContainer.Add(response.Cookies); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-09-11T01:09:40.117

```
dim cookie as new cookiecontainer

//request codes here
//response here

cookie.add(response.cookies) 
```

# canopen - EDS 和对象字典

> ID：546371
> 
> 赞同：3
> 
> 时间：2009-02-13T15:32:59.040
> 
> 标签：canopen

[EDS](http://en.wikipedia.org/wiki/CANopen#Object_dictionary)和[OD](http://en.wikipedia.org/wiki/CANopen#Object_dictionary)是什么？它们是如何创建和使用的？

OD 是如何出现在应用程序和[CAN](http://en.wikipedia.org/wiki/Controller_area_network)接口之间的？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-08T11:36:25.893

首先，您应该阅读一些有关[CANopen](http://en.wikipedia.org/wiki/CANopen)的内容以熟悉这些概念。查看[www.canopen.de](http://www.canopen.de/)，您可以在其中免费下载一些规范。

EDS 是电子数据表的缩写。这是一个指定格式的文本文件，其中包含有关 CANopen 设备的所有信息（所有支持的对象的列表）。您可以使用纯文本编辑器或一些商业工具对其进行编辑。

读取 CANopen 设备 EDS 的 CANopen-Master 能够访问设备的对象字典。OD 是 CANopen 设备在 CAN 总线上提供的所有数据和功能的内部表示。

obect 字典的创建和使用取决于您使用的 CANopen 堆栈。它位于 CANopen 堆栈和您的应用程序之间。

# list - 用于重新排序列表项的用户界面

> ID：546375
> 
> 赞同：41
> 
> 时间：2009-02-13T15:34:37.680
> 
> 标签：list, user-interface, web-applications

我有一个项目列表作为 Web 应用程序的一部分。问题是用户如何操纵列表中项目的顺序（而不是列表排序顺序）。典型的方法是使用箭头按钮向上或向下移动项目。另一种方式是拖放。

但是对于列表重新排序的用户界面还有其他方法吗？

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2009-02-17T16:46:28.880

还有其他两种排序方法（除了你提到的那些）我已经看到效果很好。

**点击移动**

[用于在Gallery](http://gallery.menalto.com/)网络相册中排序项目的方法非常适用于排序照片，并且它应该同样适用于可以表示为可点击元素的排序组的任何集合：

*   将您的项目列表显示为可点击元素。
*   单击一个元素“选择”它，它突出显示以表明它已被选中。
*   单击另一个项目会将所选项目移动到所单击项目之前的位置。
*   重复直到所有项目都按所需顺序。
*   一个虚拟项目显示在列表的末尾，用于将项目移动到末尾。

这比拖放更容易使用，因为它需要较少的灵巧性，并且在确定要“放置”项目的位置时不必按住鼠标按钮。

该方法可以很容易地扩展为允许选择多个项目（通过 shift-click 或类似方式），然后可以以相同的方式将其放置在新位置。

**提供订单号**

由 Netflix 和我使用过的一些内部应用程序使用。如果您的用户对数字顺序应该是什么有一个具体的想法（在我们的内部应用程序中处理指令步骤列表时使用），这将最有效。

*   展示您的项目列表，每行一个。
*   在显示订单号的每个项目旁边提供一个文本输入框，从 1 开始。
*   用户根据需要更改文本字段中的订单号。
*   如果多件商品具有相同的订单号，则将它们彼此相邻放置。
*   提供一个按钮以在 JavaScript 中“应用”排序，这样用户就不必提交整个页面来查看重新排列的列表。这使得增量工作变得容易。

**编辑：**关于**拖放的**一些额外想法。您可能以前使用过或没有使用过这些，但有一些事情可以使拖放更加宽容和更易于使用：

*   突出显示项目在掉落时将出现的区域。例如，在两个现有项目之间显示一条突出的水平线，如果项目被丢弃，它将被插入到该位置。
*   在拖动时将可拖动项目隐藏，以便很明显正在移动的内容，而不是使用通用的“拖动”光标。如果被拖动的项目以透明的方式彼此叠加显示时仍然清晰可辨，则此方法效果最佳。
*   确保可拖放对象的目标区域足够大。较大的区域可能对在所需协调方面有困难的人有所帮助。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-02-13T15:40:29.910

我们发现拖放对于非技术人员来说可能是反直觉的。我们已经探索了向上向下箭头，它有效，但也可能很麻烦，因为您需要不断地向上和向下点击，这会导致大量流量。

我们探索的另一个范例是“移动”按钮，因此当您单击列表中的每个项目时，它都有一个“移动项目”按钮，在列表中的每个项目之前和之后添加了新按钮，以便您将项目移动到任何位置。

当列表中的每个项目占用大量空间时，这很有效，如果每个列表项目只有一行，则可能导致界面混乱。在我们的例子中，每个项目都是六行或更多的文本。我们还在每个项目之前/之后在此处添加项目按钮以允许插入。

Survey Monkey 也使用了这种范例，并启发了我们所做的一些事情。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-02-17T10:25:31.043

一些想法 - 非常多的想法而不是实施结束虽然......

1 - 提供上下箭头和拖放，并监控哪个更受欢迎，哪种类型的用户使用哪个等，然后在你有一些数据后从那里进行定制

2 - 添加一个随机生成订单的“随机”按钮 - 可能没用，可能会很有趣，具体取决于您的应用

3 - 在每个项目的旁边添加一个“显示顺序”字段并允许用户操作它（但请确保您有一些代码可以在更改时自动更新其余数字）我个人认为这可能非常令人困惑，但对于某些用户来说它可能有效

4 - 让用户拖动到新列表，而不是拖放到位

5 - 对于一个非常简单的版本，有一个“收藏夹”复选框，然后让列表首先显示收藏夹，（按字母顺序或其他顺序）

6 - 有组 - 你为一个项目分配一个组号，所有的组首先出现，然后是第 2 组等

希望这个随机的漫谈有用，如果我想到更多，我会回来......

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-02-18T22:07:46.947

1) **Click to Move**的一种变体将涉及拥有一个单独的目标列表，用户在其中选择他们的项目将移动到的插槽，然后单击原始项目以移动它。

例如，在下图中，用户已经将“E”放在重新排序列表的开头，并选择了第三个插槽作为他们的下一个选择。他们的下一步将是从旧列表中选择哪个项目进入新列表的插槽 3。（星号行是一种微弱的尝试，表明插槽 3 已突出显示或选中。）

```
 old       new
 -----     -----
|  A  |   |  E  |
|  D  |   |     |
|  C  |   |*****|
|     |   |     |
|  B  |   |     |
 -----     ----- 
```

单击*新*列表中的项目将选中它并突出显示*旧*列表中的原始位置，现在是目标。再次单击该项目会将其返回到该原始插槽。

新列表还应该显示某种指示符，以表明它具有可选区域，可能是其插槽中不显眼（低不透明度）的编号按钮或其他一些信息提示*。*

2) 另一种方法是允许用户在原始位置和所需位置之间画线。

无论选择哪种方法，该过程都不需要繁琐：没有理由不能全部在客户端完成（可以选择保存和提交更改到服务器）。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-02-22T21:37:02.200

[您可以使用jQuery UI Sortables](http://jqueryui.com/demos/sortable/#default)的示例来试验拖放。为了让非技术用户或新用户明白这一点，您可以使用诸如手柄或箭头之类的视觉提示，也可以在悬停时使用工具提示来建议拖动元素。

您甚至可以提供一个动画 gif 来演示该手势。

一旦用户学会了如何做到这一点，我认为这是订购列表的最简单方法。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2009-02-13T15:40:23.717

另一种方法是在每个项目旁边提供一个小文本输入，以便用户可以自己输入数字排序；然后他们点击一个按钮一次重新排序。（我只在存储项目顺序的网站上看到过这种情况，例如 Netflix 队列或 Livejournal 链接。）

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-02-13T15:36:28.487

通过单击标题进行排序非常流行。不过，也许只被视为对实际列表*视图的重新排序。*

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2009-02-17T10:24:48.550

实现复制/粘贴样式功能？这意味着您可以从列表中取出一个项目，然后选择另一个项目，然后单击“粘贴”或 CTRL+V。这非常直观，可以轻松操作大型列表。

您可以轻松实现多选以移动一大块相邻的项目。

网络流量会很低（只有一两个请求）。

您需要确保“粘贴”是一致的。即粘贴*始终*插入所选项目的上方。

查看[Checkvist](http://checkvist.com/)以获得更多灵感。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2009-02-13T15:37:25.597

您也可以使用箭头键上下移动。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2009-02-23T21:09:14.490

我实际上认为 iphone / itouch 在移动应用程序图标时做得很好。

如果您还没有看到它，请看这里：[http ://www.youtube.com/watch?v=qnXoGnUU6uI](http://www.youtube.com/watch?v=qnXoGnUU6uI)

“摇晃”图标是一个非常好的视觉提示，表明某物是可移动/可拖动的。

所以我会建议这种方法拖放。单击并按住一个项目可以将其置于“可移动模式”，这将通过它的抖动（或一些更容易编码的视觉提示）来表示。然后拖放将以正常方式工作。

在 javascript 中实现这一点当然是一个挑战......

还有一件事要考虑 - 大多数人都犯了将可用性与可学习性混为一谈的错误。想想这个应用程序的用户是谁（他们会经常使用它并被教导如何使用它，还是他们可能不经常使用它并且没有被教导如何使用它的公共网络用户） - 它可能会给你一个不同的答案解决方案应该是什么。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2009-02-20T11:21:26.690

对我来说，在适当的位置（即在列表本身内）执行列表元素的拖放是最好的方法。

您不仅可以让您的用户立即了解他们的列表将是什么样子（列表正在他们眼前重新组织），而且他们也很容易理解移动机制。这是让您的用户以最短的移动次数对列表进行排序的最简单方法。

顺便说一句，预见到一个列表可能比几个元素长，除了 DnD 方法，您可以提供一种异步方式来对列表进行排序：让用户能够为每个条目分配一个排序号，然后单击“订购”按钮。以智能和正确的方式处理用户的输入，这可能会加快更长的列表编辑速度。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2009-02-22T21:29:12.610

我在想“移动选择到这里”：

1.  让所有项目都可以通过复选框选择
2.  让所有项目都有一个按钮或图标，意思是“移动选择到这里”
3.  单击“将所选内容移至此处”时，所有选定的项目都按现有顺序移动到该项目

这里的边缘情况是项目应该移动到列表的任一端。解决此问题的一种方法是将所有选定项目移动到目标之前，并在末尾保留一个特殊按钮/图标以将选择移动到那里。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2019-02-12T00:40:09.190

我发现以下是允许指定项目顺序的最快方法，无论列表大小如何：

1）如果用户想要设置列表/网格项目的顺序，他们点击“重新排序”按钮。

2) 这将打开可用于任何列表或网格的重新排序对话框。

3) 在对话框中，所有项目都按当前顺序显示在左侧的列表中。右侧有一个空列表。

4) 用户按所需顺序单击左侧列表中的项目。当一个项目被点击时，它会从左边的列表中移除，并放在右边的列表中的下一个位置。在最坏的重新排序情况下，每个项目都需要一个新订单，这允许通过 N 次点击来订购 N 个项目的列表。

5) 然后用户可以申请新订单或取消订单。应用顺序导致数据中的“显示顺序”字段被设置为右侧列表中项目的最终顺序。您可以决定是否仅在左侧列表为空时启用“应用”按钮。

6) 订购对话框中还提供以下控件：

a）一个按钮，用于将所有项目从左侧列表移动到右侧列表，保持它们的顺序

b) 通过按原始顺序重新加载左侧列表并清除右侧列表来重新开始的按钮。

c）按字母顺序对右侧列表进行排序的按钮（或按日期或数字，具体取决于关键字段）

d）在右侧列表中拖放功能以手动将项目拖入顺序。

e) 右侧列表中的索引号列，如果对其进行编辑，则将项目移动到该位置。

This provides the best of all worlds. If you have a huge list where only a few items need to be moved, move all items over, then drag the few items where desired or enter the desired index. If you have a small-ish list that needs to be completely reordered, just click the items in the desired order. And so on.

I've used this approach for many years and it has been very effective.

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-02-17T10:07:33.457

您可以像 Google 为 SearchWiki 所做的那样显示“向上”和“删除”按钮。大多数人现在至少有一些经验。大多数人只关心“提高”他们的选择。如果他们不喜欢某件事，并且想对其投反对票，那么在上述“删除”按钮的帮助下从列表中删除对他们来说会更容易

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-02-19T01:37:10.047

将鼠标悬停在元素上时可以显示叠加层。此叠加显示 4 个箭头（n/e/s/w），您可以相应地单击并移动元素。

如果您尝试在 facebook 和 picasaweb 的照片分组功能等网格中对项目进行排序，那么这是处理该问题的唯一方法

如果您有 3 列，每列都有一个项目列表，则单击任何项​​目都会将项目向左或向右移动，中间列可以显示向左或向右的选项。您仍然可以允许使用典型功能进行拖放或排序。

# asp.net - 混合 WebForms/ASP.NET MVC

> ID：546377
> 
> 赞同：5
> 
> 时间：2009-02-13T15:34:41.127
> 
> 标签：asp.net, asp.net-mvc

> **可能重复：**
> [ASP.NET MVC 与同一个 Web 应用程序中的 Web 窗体？](https://stackoverflow.com/questions/7288840/asp-net-mvc-alongside-web-forms-in-the-same-web-app)

我对 .NET 应用程序有点陌生，我正在开发一个 Web 表单应用程序，我即将开始开发新页面，我正在尝试使用 ASP.NET MVC 制作新页面，但我是无法使页面访问控制器。首先，我添加了库引用，在 global.asax 上添加了路由，但不确定还缺少什么，有人可以帮我吗？

谢谢。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-13T21:31:15.670

在我收集到的字里行间阅读您是否正在尝试**将**MVC 页面添加到您现有的 ASP.NET Webforms Web 应用程序？

如果是这种情况，那么您可能需要一些 MVC 特定的配置。设置。最简单的方法是创建一个新的 MVC Web 应用程序，然后合并配置设置。

此外，如果您正在做一个混合项目，我建议您阅读[Scott Hanselmann](http://www.hanselman.com/blog/PlugInHybridsASPNETWebFormsAndASPMVCAndASPNETDynamicDataSideBySide.aspx)关于该主题的帖子。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-15T00:56:12.197

在这些链接中有更多关于将 MVC 添加到 WebForms 应用程序的分步说明：

*   [将 ASP.Net MVC 集成到现有的 ASP.Net Web 应用程序中](http://blogs.imeta.co.uk/MGodfrey/archive/2009/03/31/663.aspx)
*   [混合 ASP.NET Webforms 和 ASP.NET MVC](http://www.packtpub.com/article/mixing-asp.net-webforms-and-asp.net-mvc)

您可能还想使用文本编辑器将 ProjectTypeGuid 添加到项目文件中（{603c0e0b-db56-11dc-be95-000d561079b0} 用于指定 Visual Studio 使用 MVC 扩展。）

```
 <ProjectTypeGuids>{603c0e0b-db56-11dc-be95-000d561079b0};{349c5851-65df-11da-9384-00065b846f21};{fae04ec0-301f-11d3-bf4b-00c04f79efbc}</ProjectTypeGuids> 
```

上面的链接也没有完全覆盖需要配置的 web.config 的 system.webserver 区域。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-12-09T15:24:43.243

在过去的几个月里，我在这方面花了很多时间。以下是我的观察。

好/容易 -`Webforms`调用`MVC`控制器 - 建立一个新`MVC3`项目并将`Webforms`页面放入其中非常容易。- 我能够将我的`<pages><controls></controls></pages>`部分移动到`/pages`新目录`web.config`中

肮脏/困难

*   [关于`GUID`](https://stackoverflow.com/a/994159/57883)

    *   请注意，`GUID`出于某种原因，必须在行的前面添加...每次我尝试它都失败了。直到我偶然发现一个帖子坚持它是在其他人之前。
    *   我也不知道有什么区别，但我有不同的 GUID 工作......`{E53F8FEA-EAE0-44A6-8774-FFD645390401}`
*   让登陆页面`Webforms`引起各种障碍。

*   让 jQuery 智能感知很好地发挥作用`T4MVC`

这就是我为解决这个问题所做的

```
@if (System.Diagnostics.Debugger.IsAttached)
    { 
    <script src="../../Scripts/Mvc3/jquery-1.7-vsdoc.js" type="text/javascript"></script> @* intellisense! *@
     @Html.RelativeJavascript(Links.Scripts.Mvc3.jquery_1_7_js)
     @Html.RelativeJavascript(Links.Scripts.Mvc3.jquery_unobtrusive_ajax_js)
    }
    else
    {
        @Html.RelativeJavascript(Links.Scripts.Mvc3.jquery_1_7_min_js) 
        @Html.RelativeJavascript(Links.Scripts.Mvc3.jquery_unobtrusive_ajax_min_js)  
    } 
```

建议：

*   [`T4MVC`](http://mvccontrib.codeplex.com/wikipage?title=T4MVC)即使您是纯网络表单，也可以在所有情况下使用。消除静态内容（、、图像、指定模板）的魔术字符串`.js`非常`.css`出色。
    *   如果您的[构建过程中有任何部分编译视图](https://stackoverflow.com/a/8391459/57883)，那么您可以在任何这些链接上获得编译时安全性。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-11-16T19:18:17.517

Scott Hanselman 发布了一个“完全不受支持”的 Nuget 包，它将 MVC 3 功能添加到现有的 Web 窗体项目中。它也适用于我的电脑（哈哈），我已经在几个项目中使用过它。

[http://nuget.org/List/Packages/AddMvc3ToWebForms](http://nuget.org/List/Packages/AddMvc3ToWebForms)

他在这里写了一篇博客：

[http://www.hanselman.com/blog/CreatingANuGetPackageIn7EasyStepsPlusUsingNuGetToIntegrateASPNETMVC3IntoExistingWebFormsApplications.aspx](http://www.hanselman.com/blog/CreatingANuGetPackageIn7EasyStepsPlusUsingNuGetToIntegrateASPNETMVC3IntoExistingWebFormsApplications.aspx)

一个新手提示：此包将在 /App_Start/RegisterMvc3Routes.cs 中配置您的 MVC 路由

# python - 在 Django 中使用内联摘要生成列表/报告

> ID：546385
> 
> 赞同：7
> 
> 时间：2009-02-13T15:37:31.150
> 
> 标签：python, django, list, report

我正在尝试编写一个视图，该视图将生成一个报告，该报告显示我的库存系统中的所有项目，并在某个点提供摘要。顺便说一下，这份报告纯粹只是一个 HTML 模板。

就我而言，每个项目都是订单的一部分。一个订单可以有多个项目，我希望能够在每个订单结束后显示基于 SUM 的摘要。

所以报告看起来像这样：

```
Order #25        <Qty> <Qty Sold> <Cost> <Cost Value>
Some Item          2       1       29.99    29.99
Another Item       4       0       10.00    40.00
<Subtotal Line>    6       1       39.99    69.99
Order #26        <Qty> <Qty Sold> <Cost> <Cost Value>
... Etc, you get the point 
```

现在，我完全有能力显示所有值，并且已经有一个显示所有项目的报告，但我不知道如何在不进行**大量**查询的情况下将小计放在报告中。Quantity、Qty Sold 和 Cost 字段只是 Item 模型的一部分，Cost Value 只是一个简单的模型函数。

任何帮助，将不胜感激。提前致谢 ：-）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-13T15:49:36.393

小计是`SELECT SUM(qty) GROUP BY order_number`事物。

它们与获取详细信息的查询完全分开。

两个查询的结果需要交错。一个很好的方法是将每个订单创建为一个元组`( list_of_details, appropriate summary )`。

然后显示很简单

```
{% for order in orderList %}
    {% for line in order.0 %}
        {{ line }}
    {% endfor %}
    {{ order.1 }}
{% endfor %} 
```

困难的部分是交错两个查询。

```
details = Line.objects.all()
ddict = defaultdict( list )
for d in details:
    ddict[d.order_number].append(d)

interleaved= []
subtotals = ... Django query to get subtotals ... 
for s in subtotals:
    interleaved.append( ( ddict[s.order], s.totals ) ) 
```

可以将此`interleaved`对象提供给您的模板进行渲染。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-13T15:48:08.707

您可以在 Django 视图中计算 Python 中的小计。

小计可以存储在 Model 对象的实例中，其属性表明它是小计。为了保持报表模板简单，您可以在结果列表中的正确位置插入小计对象，并使用小计属性以不同方式呈现小计行。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-13T16:39:06.713

假设您不打算使用任何特定于订单的字段，您可以执行单个 DB 查询，然后执行一些 python 计算：

```
from itertools import groupby
items = OrderItem.objects.select_related('order').order_by('order').all() # order_by is essential
items_by_order = dict(groupby(items, lambda x: x.order))
for order, items in items_by_order:
    items_by_order[order]['subtotals'] = ... # calculate subtotals for all needed fields 
```

与使用单独的 SQL 查询来计算小计相比，这是一种更通用的方法，小计会在两个查询上强加同步 WHERE 子句的责任。您还可以使用任何 agregate 函数，而不仅仅是那些在 DB 端可用的函数。

# .net - WPF：MessageBox 是否会破坏 PreviewMouseDown？

> ID：546388
> 
> 赞同：8
> 
> 时间：2009-02-13T15:38:12.210
> 
> 标签：.net, wpf, events, messagebox

我一直在尝试让我的 WPF 应用程序提示用户放弃未保存的更改或在他们使用 TreeView 导航时取消。

*   [如何取消用户的 WPF TreeView 点击？](https://stackoverflow.com/questions/542392/how-can-i-cancel-a-users-wpf-treeview-click)
*   [如何正确处理带有 MessageBox 确认的 PreviewMouseDown 事件？](https://stackoverflow.com/questions/543312/how-do-i-properly-handle-a-previewmousedown-event-with-a-messagebox-confirmation/545534#545534)

我想我发现了一个错误。MessageBox 不能很好地与 PreviewMouseDown 配合使用。如果显示了 MessageBox，则无论其 e.Handled 是如何设置的，它似乎都会“处理”一次点击。

对于这个 XAML...

```
<TreeView Name="TreeViewThings"
    ...
    PreviewMouseDown="TreeViewThings_PreviewMouseDown"
    TreeViewItem.Expanded="TreeViewThings_Expanded"
    TreeViewItem.Selected="TreeViewThings_Selected" > 
```

...比较这些替代方法...

```
子 TreeViewNodes_PreviewMouseDown(...)
    e.Handled = False
结束子

子 TreeViewNodes_PreviewMouseDown(...)
    MessageBox.Show("Test", "Test", MessageBoxButton.OK)
    e.Handled = False
结束子

```

这两种方法的行为不同。没有MessageBox，`TreeViewNodes_Selected()`否则`TreeViewThings_Expanded()`会执行。使用 MessageBox，他们不会。

这是一个错误还是这里发生了什么我应该理解的事情？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-30T19:41:32.723

I'm having precisely the same problem and you're right in thinking that MessageBox is screwing things up. To be honest, I've had other issues with MessageBox while working with Windows Forms before switching to WPF. Maybe it's just some century-old bug that became a feature (as often it is with Microsoft)?

In any case, the only solution I can offer you is the one that has worked for me. I was having problems with getting a similar situation to work with a ListBox - if there were changes to data in the form, when selection of the ListBox changed (either by clicking on new item or using keys "Up" or "Down"), I offered user a choice in the MessageBox whether to save, discard or cancel.

Naturally using the direct approach of handling ListBox's MouseDown or PreviewMouseDown events didn't work well with a MessageBox. Here's what worked.

I have a data template to display items in my ListBox (I'm almost expecting you to have the same):

```
<ListBox.ItemTemplate>
    <DataTemplate>
        <TextBlock Text="{Binding Path=NAME}" KeyDown="checkForChanges" MouseDown="checkForChanges"/>
    </DataTemplate>
</ListBox.ItemTemplate> 
```

Note how I've **moved the KeyDown and MouseDown event handlers to the TextBlock control** instead. I kept the same code-behind:

```
// The KeyDown handler
private void checkForChanges(object sender, KeyEventArgs e) {
    e.Handled = checkForChanges();
}

// Method that checks if there are changes to be saved or discard or cancel
private bool checkForChanges() {
    if (Data.HasChanges()) {
        MessageBoxResult answer = MessageBox.Show("There are unsaved changes. Would you like to save changes now?", "WARNING", MessageBoxButton.YesNoCancel, MessageBoxImage.Question);
        if (answer == MessageBoxResult.Yes) {
            Data.AcceptDataChanges();
        } else if (answer == MessageBoxResult.Cancel) {
            return true;
        }
        return false;
    }
    return false;
}

// The MouseDown handler
private void checkForChanges(object sender, MouseButtonEventArgs e) {
    e.Handled = checkForChanges();
} 
```

As a side note, it's odd how Binding always marks my DataRows as Modified when the selected item in the ListBox, which has ItemsSource bound to a DataTable, changes (I don't know if you're using DataTables/Sets). To battle that, I discard any unhandled changes once the selection has already been changed (because I handle anything that's necessary in the event MouseDown that occurs prior to that):

```
<ListBox IsSynchronizedWithCurrentItem="True" [...] SelectionChanged="clearChanges"> ... </ListBox> 
```

And the code-behind for the handler:

```
private void clearChanges(object sender, SelectionChangedEventArgs e) {
    Data.cancelChanges();
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-30T22:44:37.103

这就是我所拥有的。它有效，但不太理想......

```
Sub TreeViewNodes_PreviewMouseDown(ByVal sender As Object, ByVal e As System.Windows.Input.MouseButtonEventArgs)
    If UnsavedChangesExist() Then
        MessageBox.Show("You have unsaved changes.", "Unsaved Changes", MessageBoxButton.OK, MessageBoxImage.Information, MessageBoxResult.OK)
        e.Handled = True
    End If
End Sub 
```

这需要用户点击“OK”，手动点击一个“Discard Changes”按钮（靠近“Save”按钮），点击另一个“Are you sure?” 消息框，然后才再次使用树导航。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2019-03-21T14:57:39.807

消息框/模态对话框将从所选项目中移除焦点并取消路由事件。对话框完成后，您可以在原始源上引发鼠标按下事件以完成原始预览鼠标按下事件。

```
 private void PreviewMouseDown(MouseButtonEventArgs obj)
    {
        var dialogResult = MessageBox.Show("Do you want to save your changes?", "Pending Changes", MessageBoxButton.YesNoCancel, MessageBoxImage.Question);

        if (dialogResult == MessageBoxResult.Cancel) return;

        // Yes / No was selected.
        var source = (UIElement) obj.OriginalSource;

        var args = new MouseButtonEventArgs(obj.MouseDevice, obj.Timestamp, obj.ChangedButton) {RoutedEvent = UIElement.MouseDownEvent};

        source.RaiseEvent(args);
    } 
```

# asp.net - 在 ASP.NET 中强制客户端 ID

> ID：546392
> 
> 赞同：0
> 
> 时间：2009-02-13T15:39:36.373
> 
> 标签：asp.net, clientid

我知道在 ASP.NET 的下一个版本中，我们最终能够在 System.Web 控件上设置 clientid，而无需框架以准智能的方式为我们执行此操作，例如：

```
id="ctl00__loginStatus__profileButton" 
```

有谁知道在此期间强制将上述 id 设置为类似的好方法

```
id="profileButton" 
```

主要原因是在向页面动态添加控件时在 jQuery 中对 clientid 的操作。我可以看到的问题是更改 ID 会破坏 Viewstate？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2012-11-03T07:15:46.000

您必须使用以下`ClientIDMode`属性：

```
<asp:xxxx ID="fileselect" runat="server" ClientIDMode="Static"/> 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-13T15:46:04.873

我倾向于做的是动态生成处理这个的javascript方法。您可以在标记或代码中执行此操作，例如：

```
<script language="javascript" type="text/javascript">
function doXYZ()
{
   $("#" + getListBoxId()).css(...)
}

function getListBoxId()
{
 return "<%=this.myListBox.ClientId>";
}

</script> 
```

您还可以在后面的代码中构建函数并注册它们。

**编辑**

几个月前，我需要修复一些服务器控件的 id，我设法破解了它，并在[这里](http://jberke.blogspot.com/2009/07/turning-off-aspnets-unique-id.html)描述了我的方法。

基本上，您需要将控件放在像用户控件一样的命名容器中，然后覆盖几个防止子控件获取其唯一标识的属性。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-13T15:46:47.650

性能不是很好，但您可以使用此选择器语法来匹配混乱的 ClientID：

```
$("[id$='_profileButton']") 
```

这匹配任何以**_profileButton***结尾*的元素。添加前导下划线可确保您匹配所需的元素，而不是另一个以子字符串“profileButton”结尾的元素（例如“myprofileButton”）。

 **由于它必须遍历整个 DOM，如果您在循环中使用它或一次多次使用它，性能可能会很差。如果你不过度使用它，性能影响不是很显着。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-10-19T07:39:43.000

另一种方法是用 div 或 span 与静态 id 包装您的控件，然后通过它访问控件。

例如

```
<span id="mySpan">
<asp:TextBox id="txtTest" runat="server" />
</span> 
```

然后，您可以在 MySpan 中定位输入标签。（虽然我同意能够指定一个好听的名称会很好，前提是您可以处理命名冲突......）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-13T15:54:50.297

我在 asp.net webforms 中开发时经常遇到这个“问题”。在大多数情况下，我倾向于使用元素的 css 类。

```
jQuery(".My .Container12") 
```

在开始操作 id:s 之前，也许这也是您可以处理它的一种方式？这是一个简单的解决方案。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-10-19T08:40:11.457

还有一个未提及的解决方案是子类化 ASP.NET 控件并强制使用 ID：

```
public class MyCheckBox : CheckBox
{
    public string ForcedId { get;set; }

    public override string ID
    {
        get
        {
            if (!string.IsNullOrEmpty(ForcedId))
                return ForcedId;
            else
                return base.ID;
        }
        set
        {
            base.ID = value;
        }
    }

    public override string ClientID
    {
        get
        {
            return ID;
        }
    }
} 
```

然后**在你知道 ID 永远不会冲突的地方**使用它：

```
<mytag:MyCheckBox ForcedId="_myCheckbox" runat="server" /> 
```

如果您正在使用列表，您将需要编写一个 ListControlAdapter，并且还需要为您使用的每种类型的列表（下拉列表、复选框、单选按钮、列表框）编写适配器。或者交叉双腿等待 .NET 4.0。

# delphi - 在 Delphi 2009 和 Finalbuilder 6 中使用项目配置

> ID：546393
> 
> 赞同：1
> 
> 时间：2009-02-13T15:40:01.957
> 
> 标签：delphi, build-process, delphi-2009, finalbuilder, buildconfig

有没有人有在 Finalbuilder 6 中使用项目配置选项和 Delphi 编译操作的经验。

目前，构建服务器设置为手动在编译操作上直接设置所有正确的搜索路径、编译器选项等。这避免了对配置文件的更改破坏了构建，并且搜索路径等可能与开发机器不同。但是，更改可能会很痛苦，因为它需要在 FB 中而不是在项目中完成。

使用 Delphi2009 中的新 BuildConfig 选项（以及 Finalbuilder 6 中对它们的支持），应该可以将此配置保留在 SCC 中并使其更易于维护和更新。

有没有人试过这个？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-13T16:05:49.507

我使用虚拟机制作稳定的构建环境，并将所有选项保留在 FinalBuilder 中。通过这种方式，我知道我可以进行单行更改，这将是一个很好的构建，我无法通过我的开发 PC 上的更改来破坏事情。当然，我确实必须偶尔更新组件等，但可以更仔细地进行快照和测试。

所以我想我还没有尝试过构建配置，但我不想！

# php - 断点未使用 PHP/XAMPP/NetBeans/Moodle 触发

> ID：546401
> 
> 赞同：0
> 
> 时间：2009-02-13T15:41:58.847
> 
> 标签：php, xampp, breakpoints, xdebug, moodle

这个有点晦涩难懂。我的设置都在我的本地 Windows 机器上运行；我已经安装了 NetBeans IDE、运行 XDebug 的本地 XAMPP 服务器，以及在 mod 目录中安装了带有一些自定义插件的 Moodle。

我可以愉快地在 PHP 页面（包括主要的 Moodle 页面）中创建断点，但是我在 mod 目录中的 php 文件上放置的任何断点都不会触发（在我的 mod 或任何内置的 mod 上）。我认为 Moodle 可能正在做一些“魔术”来显示 mod 目录中的文件，但我的浏览器将 url 显示为[http://localhost/moodle/mod/view.php](http://localhost/moodle/mod/view.php) - 这就是我设置断点的文件.

有没有人有调试 Moodle 插件的经验，或者可以指出如何解决断点未触发的问题？我已经尝试过 Moodle 网站，但找不到任何相关信息。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-13T15:56:43.413

其实，我想我已经想通了。如果我告诉它调试该特定文件，它将 404（它没有放入目录，猜这是一个错误），但如果我随后手动转到[http://localhost/moodle/mod/view.php?XDEBUG_SESSION_START =netbeans-xdebug](http://localhost/moodle/mod/view.php?XDEBUG_SESSION_START=netbeans-xdebug)（哪些错误，没有传入参数），然后手动导航到 Moodle，然后我的 mod 断点正确触发。

一切都非常奇怪，但这似乎是一个可用的解决方法。我猜这些模组是在某种不同的 PHP 会话下运行的。

我会在这里保留这个答案，以防其他人遇到这个奇怪的问题。

# javascript - 自动上传图片并以表格形式展示

> ID：546402
> 
> 赞同：3
> 
> 时间：2009-02-13T15:42:19.330
> 
> 标签：javascript, jquery, image, upload

用户将图片放入文件上传小部件后，如何让浏览器上传并显示图片？我有一个表单，用户应该在其中上传和编辑图像（在他们点击提交之前）。我可以用 Jquery 做吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-13T15:53:00.117

看看 JQuery [MultiFileUpload 插件](http://plugins.jquery.com/project/MultiFile/)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-13T15:57:41.133

MultiFileUpload 插件应该为您提供所需的内容。重要的是要记住 ajax 不支持传输二进制文件 - 您需要一个嵌入式 IFrame 来为您完成这项工作。

# php - 在 PHP 中存储类变量的最佳方式是什么？

> ID：546403
> 
> 赞同：9
> 
> 时间：2009-02-13T15:42:33.137
> 
> 标签：php, variables

我目前的 PHP 类变量设置如下：

```
class someThing {

    private $cat;
    private $dog;
    private $mouse;
    private $hamster;
    private $zebra;
    private $lion;

    //getters, setters and other methods
} 
```

但我也看到人们使用单个数组来存储所有变量：

```
class someThing {

    private $data = array();

    //getters, setters and other methods
} 
```

你用哪个，为什么？各自的优点和缺点是什么？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-02-13T15:49:37.160

通常，由于其他人已经在此处说明的原因，第一个更好。

但是，如果您需要在一个类上私下存储数据，但数据成员的足迹未知，您经常会看到您的第二个示例与 __get() __set() 挂钩以隐藏它们是私下存储的。

```
class someThing {

    private $data = array();

    public function __get( $property )
    {
        if ( isset( $this->data[$property] ) )
        {
            return $this->data[$property];
        }
        return null;
    }

    public function __set( $property, $value )
    {
        $this->data[$property] = $value;
    }
} 
```

然后，这个类的对象可以像 stdClass 的实例一样使用，只有你设置的成员实际上都不是公共的

```
$o = new someThing()
$o->cow = 'moo';
$o->dog = 'woof';
// etc 
```

这种技术有其用途，但请注意 __get() 和 __set() 比直接设置公共属性要慢 10-12 倍。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-13T15:46:17.900

如果您正在使用`private $data;`，那么您那里只是有一个难以理解的数据块......如果您正在弄清楚一个类是如何工作的，那么明确地说明它们将使您的生活变得更加轻松。

另一个考虑因素是，如果您使用带有自动完成功能的 IDE - 这不适用于第二种方法。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-13T15:46:33.720

如果代码是重复的，那么数组和（foreach）循环可以让事情变得更整洁。您需要确定代码中的“动物”概念是否重复，或者代码是否需要深入挖掘每个成员的唯一性。

如果我必须重复自己不止一次，我会循环。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-13T20:30:36.173

*   当您知道需要该变量时，请使用第一种方法。
*   当您需要动态变量时，请使用第二种方法（变量的数组集合）。

您可以组合这两种方法，因此一些变量是硬编码到您的类中的，而另一些是动态的。与魔术方法相比，硬编码变量将具有优先权。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-13T18:41:13.470

我更喜欢第一种方法，原因如下：

在一个好的 IDE 中，类属性会显示出来，即使是私有/受保护的也更容易看到已经定义的内容，从而减少了两次存储相同信息的机会。如果众所周知的公共汽车在回家的路上撞到你，另一个开发人员进来阅读你的代码会容易得多。虽然它不适用于私有 var，但它适用于受保护的 var，在扩展此类的类中，您确实应该尽量避免使用第二种方法，以获得纯粹的可读性。

另外，作为旁注，我几乎总是选择受保护而不是私有，除非我有非常具体的理由将其设为私有。

我可能会使用第二种方法的唯一一次是，如果我要存储许多同一种事物的集合。

# fluent-nhibernate - Fluent NHibernate 多对多类型约定

> ID：546404
> 
> 赞同：7
> 
> 时间：2009-02-13T15:42:35.820
> 
> 标签：fluent-nhibernate

我在 Fluent NHIbernate 中使用 AutoPersistenceModel 来映射我的所有实体，并且一切正常：D

但是，我的几个对象有

```
public virtual IList<Comment> Comments { get; set; } 
```

在数据库中只有一个评论表，每个带有上述代码的实体都有自己的评论链接表。

目前我正在做的是：

```
public class ContractMappingOverride : IAutoMappingOverride<Contract>
{
    public void Override(AutoMap<Contract> mapping)
    {
        mapping.HasManyToMany(x => x.Comments)
            .WithTableName("Comment_Contract"); 
```

对于每个实体。

有什么方法可以设置一个约定，其中所有到 IList<Comment> 的映射都自动连接到上面的表名称约定中的 manytomany？

谢谢

安德鲁

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-13T20:46:46.133

我知道这不是你想听到的，但答案是否定的。

在 Fluent NHibernate 的当前设计中，没有办法在了解它们所使用的类型的同时将约定应用于集合，您可以将某些东西应用于所有集合，而不取决于它们包含的类型。这是我们设计中的一个缺陷，我的目标是纠正这个问题，但这是一个相当大的变化，所以它不会在一夜之间发生。

我建议您查看我们的[邮件列表](http://groups.google.com/group/fluent-nhibernate)，我们通常会在那里发布更新。

抱歉，我不能提供更多帮助。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-12-16T21:05:57.030

自从我使用 Fluent NHibernate 已经有一段时间了，现在我才刚刚回到它的摇摆状态（哇，自 09 年初以来发生了很多变化！）我认为你现在问题的答案是肯定的，你可以做到这与 OverideAll 功能。

查看FNH wiki 上的[Overrides 。](http://wiki.fluentnhibernate.org/Auto_mapping#Overrides)

# sql - 如何 UNPIVOT 将列拆分为行？

> ID：546410
> 
> 赞同：0
> 
> 时间：2009-02-13T15:44:29.497
> 
> 标签：sql, sql-server

我有一个使用这些列生成数据的 sql 查询（使用 MS-SQL 2005）：

```
TimeStamp | SpeedMax | SpeedMin | HeightMax | HeightMin
-------------------------------------------------------
10        | 50       | 10       | 300       | 70 
```

我需要它的形式是这样的：

```
TimeStamp | Speed | Height
---------------------------
10        | 50    | 300          <-- one row for the max values 
10        | 10    | 70           <-- a second row for the min values 
```

给定第一个结果集...我需要什么查询才能将数据转换为第二种格式？我认为这可能涉及到一个非枢轴，但我对此并不陌生，并且无法确定要写什么。

非常感谢你。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-13T15:57:36.657

```
SELECT TimeStamp,
       minmax,
       CASE WHEN minmax = 0 THEN SpeedMax ELSE SpeedMin END AS Speed
       CASE WHEN minmax = 0 THEN HeightMax ELSE HeightMin END AS Height
FROM Table,
(
    SELECT 0 AS minmax
    UNION ALL
    SELECT 1
) mm 
```

您可以添加

```
OPTION (FORCE ORDER) 
```

避免双重扫描`Table`

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-13T15:58:20.743

尝试

```
SELECT TimeStamp, SpeedMax AS Speed, HeightMax AS Height
FROM Table
UNION ALL
SELECT TimeStamp, SpeedMin AS Speed, HeightMin AS Height
FROM Table 
```

# sql-server - 在记录组中分配唯一 ID

> ID：546411
> 
> 赞同：4
> 
> 时间：2009-02-13T15:44:30.447
> 
> 标签：sql-server, stored-procedures

我有一种情况，我需要为每组记录添加一个任意唯一的 id。下面更容易想象这一点。

东部时间 11:26 编辑：目前 lineNum 字段有垃圾。这是在 sql server 2000 上运行的。下面的示例是结果应该是什么样子，但实际值并不重要，只要两个组合字段可用于唯一键，数字就可以。

```
OrderID      lineNum
AAA          1
AAA          2
AAA          3
BBB          1
CCC          1
CCC          2 
```

line num 的值并不重要，但字段只有 4 个字符。这需要在 sql server 存储过程中完成。我以编程方式执行它没有问题。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-13T15:57:39.340

假设您使用 SQL Server 2005 或更高版本，您可以使用 Row_Number()

```
select orderId,
       row_number() over(PARTITION BY orderId ORDER BY orderId) as lineNum
from Order 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-13T15:55:41.747

在向表中添加记录时，您可以动态创建“linenum”字段：

在 Transact-SQL 中，如下所示：

```
Declare @lineNum AS INT

-- Get next linenum
SELECT @lineNum = MAX(COALESCE(linenum, 0)) FROM Orders WHERE OrderID = @OrderID
SET @lineNum = @lineNum + 1

INSERT INTO ORDERS (OrderID, linenum, .....)
VALUES (@OrderID, @lineNum, ....) 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-13T15:49:19.330

您可以创建一个游标来读取所有排序的值，然后在每次更改值时重置 1，然后每次递增。

例如：

```
AAA reset 1
AAA set 1 + 1 = 2
AAA set 2 + 1 = 3
BBB reset 1
CCC reset 1
CCC set 1 + 1 = 1 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-13T15:55:37.207

嗯，您能否创建一个按顺序返回行号信息并根据您的订单 ID 对其进行分组的视图？确保行号始终以相同的顺序返回。

或者您可以使用触发器并在插入时计算订单的最大 ID？

或者也许您可以在插入时使用 select from max 语句？

也许这些都不令人满意？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-13T16:08:09.033

如果您不使用 SQL 2005，这是一种基于集合的方法（我不太喜欢临时表，但我不太喜欢游标）：

```
declare @out table (id tinyint identity(1,1), orderid char(4))

insert @out select orderid from THESOURCETABLE

select 
    o.orderid, o.id - omin.minid + 1 as linenum
from @out o
    inner join
        (select orderid, min(id) minid  from @out group by orderid) as omin on
            o.orderid = omin.orderid 
```

# c - 从驱动程序启动应用程序

> ID：546416
> 
> 赞同：1
> 
> 时间：2009-02-13T15:45:15.547
> 
> 标签：c, windows, driver, wdk

我可以从驱动程序代码启动另一个应用程序吗？代码用 C 语言编写并用 DDK 编译。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-13T16:15:35.787

我不这么认为。反而：

*   您可以拥有一个将 DeviceIoControl 发送到设备的服务。
*   然后设备保留（不完成）关联的 IOCTL
*   当设备想要启动应用程序时，它会完成 IOCTL
*   当服务注意到它的 DeviceIoControl 已经完成时，它会启动另一个应用程序

服务可以启动应用程序，但我不知道它是否可以在用户桌面上启动它。如果您希望启动的应用程序与登录的最终用户用户交互，那么最好将 DeviceIoControl 功能放在自动启动的（可见或不可见的）应用程序中，而不是如上所述的服务用户登录时在用户的工作站中。

如果您这样做，请注意假设只有一个登录用户（在 Citrix/终端服务器上可能有很多）。

# sharepoint - In Sharepoint, what is the actual name of the page layout used for the "Article page with with body only" layout option?

> ID：546424
> 
> 赞同：5
> 
> 时间：2009-02-13T15:46:20.850
> 
> 标签：sharepoint, wss-3.0, page-layout

I need to swap out the out-of-the-box rich text editor with the Telerik editor for all article page layouts. Unfortunately, I only see three article layouts in Sharepoint Designer. When creating a new article page from within Sharepoint, however, it shows 4 article layouts. The one I see missing in Designer is the one with no option for article images.

Does anyone know where I can find the layout labeled as "Article page with body only"?

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-13T15:51:56.093

The file you are talking about is PageFromDocLayout.aspx.

# .net - 如何加载使用 SAPI 5.3 标签的语法 xml 文件？

> ID：546428
> 
> 赞同：0
> 
> 时间：2009-02-13T15:46:59.007
> 
> 标签：.net, xml, sapi

我的问题是如何加载使用他们在 MSDN 文档中列出的标签的语法文件？我想使用 MSDN 中标题语法格式标签 (SAPI 5.3) 下记录的格式标签。

[http://msdn.microsoft.com/en-us/library/ms723634(VS.85).aspx](http://msdn.microsoft.com/en-us/library/ms723634(VS.85).aspx)

它在那里列出了 DEFINE、LIST、OPT 等标签。但是，每当我尝试在 Grammar.xml 文件中使用这些标签时，我都会收到一条错误消息，指出不支持该标签。

如果使用仅使用标签 one-of、item 等的语法文件，则在 MSDN 中列出；语法文件加载。

[http://msdn.microsoft.com/en-us/library/ms870140.aspx](http://msdn.microsoft.com/en-us/library/ms870140.aspx)

我知道这可能很简单，但我似乎无法弄清楚......

语法文件...有效

```
 <grammar xmlns="http://www.w3.org/2001/06/grammar"
            xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
            xsi:schemaLocation="http://www.w3.org/2001/06/grammar
                                http://www.w3.org/TR/speech-grammar/grammar.xsd"
            xml:lang="en-US" version="1.0" root="command">

  <rule id="command" scope="public">

    <one-of>
      <item>nail</item>
      <item>hammer</item>
      <item>saw</item>
    </one-of>
  </rule>

   </grammar> 
```

代码清单-------------------

```
 public Form1()
    {

        InitializeComponent();

        // set up the recognizer
        _speechRecognizer = new SpeechRecognizer();
        _speechRecognizer.Enabled = false;
        _speechRecognizer.SpeechRecognized += new EventHandler<SpeechRecognizedEventArgs>(_speechRecognizer_SpeechRecognized);

        // set up the command and control grammar
        Grammar commandGrammar = new Grammar(@"grammar.xml");
        commandGrammar.Name = "main command grammar";
        commandGrammar.Enabled = true;

        // activate the command grammer
        _speechRecognizer.LoadGrammar(commandGrammar);

        _speechRecognizer.Enabled = true;
    } 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-16T16:32:03.823

您似乎使用的是 c#，因此是语音系统的 .NET 接口。据我所知，.NET 接口仅明确支持 W3C SRGS XML 语法格式， [http://www.w3.org/TR/speech-grammar/](http://www.w3.org/TR/speech-grammar/)。虽然您链接到的语法格式是 MS 特定格式，但他们似乎将其称为 CFG。只有较低级别的 COM API 提供了 CFG 格式的详细信息。

您应该能够在 SRGS 中执行与在 CFG 中相同的操作。

您可以在使用 SDK 工具编译后加载 CFG 的二进制版本。

# regex - 匹配平衡括号的正则表达式

> ID：546433
> 
> 赞同：360
> 
> 时间：2009-02-13T15:49:20.747
> 
> 标签：regex

我需要一个正则表达式来选择两个外括号之间的所有文本。

例子：`some text(text here(possible text)text(possible text(more text)))end text`

结果：`(text here(possible text)text(possible text(more text)))`

* * *

## 回答 #1

> 赞同：212
> 
> 时间：2016-02-08T13:37:00.783

我想添加此答案以供快速参考。随时更新。

* * *

**.NET Regex**使用[平衡组](http://www.regular-expressions.info/balancing.html)。

```
\((?>\((?<c>)|[^()]+|\)(?<-c>))*(?(c)(?!))\) 
```

Where`c`用作深度计数器。

[Regexstorm.com 上的演示](http://regexstorm.net/tester?p=%5C((%3F%3E%5C((%3F%3Cc%3E)%7C%5B%5E()%5D%2B%7C%5C)(%3F%3C-c%3E))*(%3F(c)(%3F!))%5C)&i=some%20text(text%20here(possible%20text)text(possible%20text(more%20text)))end%20text)

*   [**Stack Overflow**：使用 RegEx 平衡匹配括号](https://stackoverflow.com/questions/7898310/using-regex-to-balance-match-parenthesis)
*   [**Wes 令人费解的博客**：使用 .NET 正则表达式匹配平衡结构](http://weblogs.asp.net/whaggard/377025)
*   [**Greg Reinacker 的博客**：正则表达式中的嵌套结构](http://www.rassoc.com/gregr/weblog/2003/05/15/nested-constructs-in-regular-expressions/)

* * *

**PCRE**使用[递归模式](http://php.net/manual/en/regexp.reference.recursive.php)。

```
\((?:[^)(]+|(?R))*+\) 
```

[在 regex101 演示](https://regex101.com/r/eBtSTM/1)；或没有交替：

```
\((?:[^)(]*(?R)?)*+\) 
```

[在 regex101 演示](https://regex101.com/r/eBtSTM/2)；或[展开](http://www.softec.lu/site/RegularExpressions/UnrollingTheLoop)性能：

```
\([^)(]*+(?:(?R)[^)(]*)*+\) 
```

[在 regex101 演示](https://regex101.com/r/eBtSTM/3)；图案粘贴在`(?R)`代表的位置`(?0)`。

*Perl、PHP、Notepad++、* *R*：[perl=TRUE](http://www.regular-expressions.info/rlanguage.html)、*Python*：用于 Perl 行为的正[则表达式包。](https://pypi.python.org/pypi/regex)`(?V1)`

* * *

**Ruby**使用[子表达式调用](http://ruby-doc.org/core-2.0.0/Regexp.html#class-Regexp-label-Subexpression+Calls)。

用 Ruby 2.0`\g<0>`可以用来调用全模式。

```
\((?>[^)(]+|\g<0>)*\) 
```

[在 Rubular 演示](http://rubular.com/r/RUDsEv7SBZ)；Ruby 1.9 仅支持[捕获组递归](http://www.regular-expressions.info/subroutine.html)：

```
(\((?>[^)(]+|\g<1>)*\)) 
```

[Rubular 演示](http://rubular.com/r/vuyejEfjih)  （自 Ruby 1.9.3 以来的[原子分组）](http://ruby-doc.org/core-1.9.3/Regexp.html#class-Regexp-label-Atomic+Grouping)

* * *

**JavaScript**  [API :: XRegExp.matchRecursive](http://xregexp.com/api/#matchRecursive)

```
XRegExp.matchRecursive(str, '\\(', '\\)', 'g'); 
```

JS、Java 和其他没有递归的正则表达式风格，最多 2 级嵌套：

```
\((?:[^)(]+|\((?:[^)(]+|\([^)(]*\))*\))*\) 
```

[在 regex101 演示](https://regex101.com/r/eE6mX3/1)。[需要将](https://stackoverflow.com/a/17759264)更深的嵌套添加到模式中。
要在不平衡括号上更快地失败，[请删除`+`量词。](https://regex101.com/r/cU7uG9/1)

* * *

**Java ：** [@jaytea 使用前向引用的](https://stackoverflow.com/a/47162099/5527985)一个有趣想法。

* * *

[[参考 - 这个正则表达式是什么意思？](https://stackoverflow.com/a/22944075/5527985)]

*   [**rexegg.com** - 递归正则表达式](http://www.rexegg.com/regex-recursion.html)
*   [**Regular-Expressions.info** - 正则表达式递归](http://www.regular-expressions.info/recurse.html)

* * *

## 回答 #2

> 赞同：159
> 
> 时间：2009-02-13T15:55:10.377

正则表达式对于这项工作来说是错误的工具，因为您正在处理嵌套结构，即递归。

但是有一个简单的算法可以做到这一点，我在对[上一个问题的](https://stackoverflow.com/questions/524548/regular-expression-to-detect-semi-colon-terminated-c-for-while-loops)[回答中对此](https://stackoverflow.com/questions/524548/regular-expression-to-detect-semi-colon-terminated-c-for-while-loops/524624#524624)进行了更详细的描述。要点是编写代码来扫描字符串，保持一个开括号的计数器，这些开括号还没有被右括号匹配。当该计数器归零时，您就知道您已到达最后的右括号。

* * *

## 回答 #3

> 赞同：137
> 
> 时间：2013-11-08T16:22:24.427

您可以使用[正则表达式递归](http://www.regular-expressions.info/recurse.html#balanced)：

```
\(([^()]|(?R))*\) 
```

* * *

## 回答 #4

> 赞同：32
> 
> 时间：2009-02-13T15:51:55.813

```
[^\(]*(\(.*\))[^\)]* 
```

`[^\(]*`匹配字符串开头不是左括号的所有内容，`(\(.*\))`捕获括在括号中的所需子字符串，并`[^\)]*`匹配字符串末尾不是右括号的所有内容。请注意，此表达式不会尝试匹配括号；一个简单的解析器（见[德曼的回答](https://stackoverflow.com/questions/546433/regular-expression-to-match-outer-brackets/546457#546457)）会更适合。

* * *

## 回答 #5

> 赞同：21
> 
> 时间：2009-02-13T15:54:51.077

```
(?<=\().*(?=\)) 
```

如果您想在两个*匹配*的括号之间选择文本，那么您对正则表达式不走运。这是不可能的^((*))。

此正则表达式仅返回字符串中第一个左括号和最后一个右括号之间的文本。

* * *

^((*))除非您的正则表达式引擎具有[*平衡组*或*递归*](http://www.regular-expressions.info/recurse.html)等功能。支持此类功能的引擎数量正在缓慢增长，但它们仍然不是普遍可用的。

* * *

## 回答 #6

> 赞同：18
> 
> 时间：2017-09-21T02:16:45.110

这个答案解释了为什么正则表达式不是这个任务的正确工具的理论限制。

* * *

**正则表达式不能做到这一点。**

正则表达式基于称为`Finite State Automata (FSA)`. 顾名思义，a`FSA`只能记住当前状态，它没有关于先前状态的信息。

[![金融服务管理局](https://i.stack.imgur.com/XqtHd.png)](https://i.stack.imgur.com/XqtHd.png)

在上图中，S1 和 S2 是两个状态，其中 S1 是开始和最后一步。因此，如果我们尝试使用 string `0110`，则转换如下：

```
 0     1     1     0
-> S1 -> S2 -> S2 -> S2 ->S1 
```

在上述步骤中，当我们在第二个`S2`ie 解析`01`之后`0110`，FSA 没有关于前一个`0`in的信息，`01`因为它只能记住当前状态和下一个输入符号。

在上面的问题中，我们需要知道左括号的编号；这意味着它必须*存储*在某个地方。但是既然`FSAs`做不到，就不能写正则表达式。

但是，可以编写一个算法来完成这项任务。算法一般属于`Pushdown Automata (PDA)`. `PDA`比 高一级`FSA`。PDA 有一个额外的堆栈来存储一些额外的信息。PDA 可以用来解决上述问题，因为我们可以' `push`' 堆栈中的左括号，并在`pop`遇到右括号时使用 ' '。如果最后堆栈为空，则左括号和右括号匹配。否则不行。

* * *

## 回答 #7

> 赞同：14
> 
> 时间：2011-09-23T18:22:38.087

使用 .NET 正则表达式实际上可以做到这一点，但这并不简单，因此请仔细阅读。

[你可以在这里](http://blogs.msdn.com/b/bclteam/archive/2005/03/15/396452.aspx)阅读一篇不错的文章。您可能还需要阅读 .NET 正则表达式。你可以从[这里](http://msdn.microsoft.com/en-us/library/bs2twtah%28VS.71%29.aspx)开始阅读。

使用尖括号`<>`是因为它们不需要转义。

正则表达式如下所示：

```
<
[^<>]*
(
    (
        (?<Open><)
        [^<>]*
    )+
    (
        (?<Close-Open>>)
        [^<>]*
    )+
)*
(?(Open)(?!))
> 
```

* * *

## 回答 #8

> 赞同：9
> 
> 时间：2020-06-13T18:22:38.817

我也陷入了嵌套模式出现的这种情况。

正则表达式是解决上述问题的正确方法。使用下面的模式

```
'/(\((?>[^()]+|(?1))*\))/' 
```

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2012-05-15T07:53:26.590

这是最终的正则表达式：

```
\(
(?<arguments> 
(  
  ([^\(\)']*) |  
  (\([^\(\)']*\)) |
  '(.*?)'

)*
)
\) 
```

例子：

```
input: ( arg1, arg2, arg3, (arg4), '(pip' )

output: arg1, arg2, arg3, (arg4), '(pip' 
```

请注意，`'(pip'`正确地管理为字符串。（在监管机构尝试：http: [//sourceforge.net/projects/regulator/](http://sourceforge.net/projects/regulator/)）

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2014-08-02T08:15:44.330

我编写了一个名为[balance](https://github.com/icodeforlove/node-balanced)的小 JavaScript 库来帮助完成这项任务。您可以通过执行此操作

```
balanced.matches({
    source: source,
    open: '(',
    close: ')'
}); 
```

您甚至可以进行替换：

```
balanced.replacements({
    source: source,
    open: '(',
    close: ')',
    replace: function (source, head, tail) {
        return head + source + tail;
    }
}); 
```

这是一个更复杂和交互式的示例[JSFiddle](http://jsfiddle.net/icodeforlove/Ldb2x/)。

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2016-05-13T10:40:20.230

除了[bobble bubble's answer](https://stackoverflow.com/a/35271017/3832970)之外，还有其他支持递归构造的正则表达式风格。

**卢阿**

使用`%b()`( `%b{}`/`%b[]`用于大括号/方括号)：

*   `for s in string.gmatch("Extract (a(b)c) and ((d)f(g))", "%b()") do print(s) end`（见[演示](https://ideone.com/fKRmhz)）

**Raku（前 Perl6）**：

不重叠的多个平衡括号匹配：

```
my regex paren_any { '(' ~ ')' [ <-[()]>+ || <&paren_any> ]* }
say "Extract (a(b)c) and ((d)f(g))" ~~ m:g/<&paren_any>/;
# => (｢(a(b)c)｣ ｢((d)f(g))｣) 
```

重叠多个平衡括号匹配：

```
say "Extract (a(b)c) and ((d)f(g))" ~~ m:ov:g/<&paren_any>/;
# => (｢(a(b)c)｣ ｢(b)｣ ｢((d)f(g))｣ ｢(d)｣ ｢(g)｣) 
```

见[演示](https://ideone.com/GboAJR)。

**Python`re`非正则表达式解决方案**

有关[如何在平衡括号之间获得表达式，](https://stackoverflow.com/questions/38211773)请参阅[poke 的答案](https://stackoverflow.com/a/38212061/3832970)。

**Java 可定制的非正则表达式解决方案**

这是一个可定制的解决方案，允许在 Java 中使用单字符文字分隔符：

```
public static List<String> getBalancedSubstrings(String s, Character markStart, 
                                 Character markEnd, Boolean includeMarkers) 

{
        List<String> subTreeList = new ArrayList<String>();
        int level = 0;
        int lastOpenDelimiter = -1;
        for (int i = 0; i < s.length(); i++) {
            char c = s.charAt(i);
            if (c == markStart) {
                level++;
                if (level == 1) {
                    lastOpenDelimiter = (includeMarkers ? i : i + 1);
                }
            }
            else if (c == markEnd) {
                if (level == 1) {
                    subTreeList.add(s.substring(lastOpenDelimiter, (includeMarkers ? i + 1 : i)));
                }
                if (level > 0) level--;
            }
        }
        return subTreeList;
    }
} 
```

示例用法：

```
String s = "some text(text here(possible text)text(possible text(more text)))end text";
List<String> balanced = getBalancedSubstrings(s, '(', ')', true);
System.out.println("Balanced substrings:\n" + balanced);
// => [(text here(possible text)text(possible text(more text)))] 
```

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2013-08-21T08:38:47.857

使用 Ruby 的正则表达式（1.9.3 或更高版本）：

```
/(?<match>\((?:\g<match>|[^()]++)*\))/ 
```

[**rubular 演示**](http://rubular.com/r/763B0n8l6l)

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-02-13T15:58:10.650

答案取决于您是否需要匹配匹配的括号组，或者仅匹配输入文本中的第一个打开到最后一个关闭。

如果您需要匹配匹配的嵌套括号，那么您需要的不仅仅是正则表达式。- 见[@dehmann](https://stackoverflow.com/questions/546433/regular-expression-to-match-outer-brackets/546457#546457)

如果它只是第一次打开到最后一次关闭，请参阅[@Zach](https://stackoverflow.com/questions/546433/regular-expression-to-match-outer-brackets/546443#546443)

决定你想要发生的事情：

```
abc ( 123 ( foobar ) def ) xyz ) ghij 
```

在这种情况下，您需要确定您的代码需要匹配的内容。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2016-07-08T14:08:56.860

您需要第一个和最后一个括号。使用这样的东西：

str.indexOf('('); - 它会给你第一次出现

str.lastIndexOf(')'); - 最后一个

所以你需要一个字符串，

```
String searchedString = str.substring(str1.indexOf('('),str1.lastIndexOf(')'); 
```

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2016-09-01T05:40:18.947

```
"""
Here is a simple python program showing how to use regular
expressions to write a paren-matching recursive parser.

This parser recognises items enclosed by parens, brackets,
braces and <> symbols, but is adaptable to any set of
open/close patterns.  This is where the re package greatly
assists in parsing. 
"""

import re

# The pattern below recognises a sequence consisting of:
#    1\. Any characters not in the set of open/close strings.
#    2\. One of the open/close strings.
#    3\. The remainder of the string.
# 
# There is no reason the opening pattern can't be the
# same as the closing pattern, so quoted strings can
# be included.  However quotes are not ignored inside
# quotes.  More logic is needed for that....

pat = re.compile("""
    ( .*? )
    ( \( | \) | \[ | \] | \{ | \} | \< | \> |
                           \' | \" | BEGIN | END | $ )
    ( .* )
    """, re.X)

# The keys to the dictionary below are the opening strings,
# and the values are the corresponding closing strings.
# For example "(" is an opening string and ")" is its
# closing string.

matching = { "(" : ")",
             "[" : "]",
             "{" : "}",
             "<" : ">",
             '"' : '"',
             "'" : "'",
             "BEGIN" : "END" }

# The procedure below matches string s and returns a
# recursive list matching the nesting of the open/close
# patterns in s.

def matchnested(s, term=""):
    lst = []
    while True:
        m = pat.match(s)

        if m.group(1) != "":
            lst.append(m.group(1))

        if m.group(2) == term:
            return lst, m.group(3)

        if m.group(2) in matching:
            item, s = matchnested(m.group(3), matching[m.group(2)])
            lst.append(m.group(2))
            lst.append(item)
            lst.append(matching[m.group(2)])
        else:
            raise ValueError("After <<%s %s>> expected %s not %s" %
                             (lst, s, term, m.group(2)))

# Unit test.

if __name__ == "__main__":
    for s in ("simple string",
              """ "double quote" """,
              """ 'single quote' """,
              "one'two'three'four'five'six'seven",
              "one(two(three(four)five)six)seven",
              "one(two(three)four)five(six(seven)eight)nine",
              "one(two)three[four]five{six}seven<eight>nine",
              "one(two[three{four<five>six}seven]eight)nine",
              "oneBEGINtwo(threeBEGINfourENDfive)sixENDseven",
              "ERROR testing ((( mismatched ))] parens"):
        print "\ninput", s
        try:
            lst, s = matchnested(s)
            print "output", lst
        except ValueError as e:
            print str(e)
    print "done" 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2019-06-02T13:58:06.240

这并没有完全解决 OP 问题，但我认为它可能对一些来这里搜索嵌套结构正则表达式的人有用：

# 从javascript中的函数字符串（具有嵌套结构）解析参数

匹配结构如：
[![从函数字符串中解析参数](https://i.stack.imgur.com/fiUlC.png)](https://i.stack.imgur.com/fiUlC.png)

*   匹配括号、方括号、圆括号、单引号和双引号

[在这里你可以看到生成的正则表达式](https://regex101.com/r/Luu1bI/7/)

```
/**
 * get param content of function string.
 * only params string should be provided without parentheses
 * WORK even if some/all params are not set
 * @return [param1, param2, param3]
 */
exports.getParamsSAFE = (str, nbParams = 3) => {
    const nextParamReg = /^\s*((?:(?:['"([{](?:[^'"()[\]{}]*?|['"([{](?:[^'"()[\]{}]*?|['"([{][^'"()[\]{}]*?['")}\]])*?['")}\]])*?['")}\]])|[^,])*?)\s*(?:,|$)/;
    const params = [];
    while (str.length) { // this is to avoid a BIG performance issue in javascript regexp engine
        str = str.replace(nextParamReg, (full, p1) => {
            params.push(p1);
            return '';
        });
    }
    return params;
}; 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2019-10-20T11:29:54.593

因为 js 正则表达式不支持递归匹配，所以我无法使平衡括号匹配工作。

所以这是一个简单的 javascript for 循环版本，它将“method(arg)”字符串转换为数组

```
push(number) map(test(a(a()))) bass(wow, abc)
$$(groups) filter({ type: 'ORGANIZATION', isDisabled: { $ne: true } }) pickBy(_id, type) map(test()) as(groups) 
```

```
const parser = str => {
  let ops = []
  let method, arg
  let isMethod = true
  let open = []

  for (const char of str) {
    // skip whitespace
    if (char === ' ') continue

    // append method or arg string
    if (char !== '(' && char !== ')') {
      if (isMethod) {
        (method ? (method += char) : (method = char))
      } else {
        (arg ? (arg += char) : (arg = char))
      }
    }

    if (char === '(') {
      // nested parenthesis should be a part of arg
      if (!isMethod) arg += char
      isMethod = false
      open.push(char)
    } else if (char === ')') {
      open.pop()
      // check end of arg
      if (open.length < 1) {
        isMethod = true
        ops.push({ method, arg })
        method = arg = undefined
      } else {
        arg += char
      }
    }
  }

  return ops
}

// const test = parser(`$$(groups) filter({ type: 'ORGANIZATION', isDisabled: { $ne: true } }) pickBy(_id, type) map(test()) as(groups)`)
const test = parser(`push(number) map(test(a(a()))) bass(wow, abc)`)

console.log(test) 
```

结果就像

```
[ { method: 'push', arg: 'number' },
  { method: 'map', arg: 'test(a(a()))' },
  { method: 'bass', arg: 'wow,abc' } ] 
```

```
[ { method: '$$', arg: 'groups' },
  { method: 'filter',
    arg: '{type:\'ORGANIZATION\',isDisabled:{$ne:true}}' },
  { method: 'pickBy', arg: '_id,type' },
  { method: 'map', arg: 'test()' },
  { method: 'as', arg: 'groups' } ] 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2020-03-16T07:17:02.070

虽然很多答案都以某种形式提到了这一点，说正则表达式不支持递归匹配等，但其主要原因在于计算理论的根源。

表格的语言`{a^nb^n | n>=0} is not regular`。正则表达式只能匹配构成常规语言集的一部分的内容。

阅读更多@[这里](https://stackoverflow.com/questions/2309752/why-is-anbn-n-0-not-regular)

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2020-05-29T13:43:22.707

我没有使用正则表达式，因为它很难处理嵌套代码。所以这个片段应该能够让你抓住带有平衡括号的代码部分：

```
def extract_code(data):
    """ returns an array of code snippets from a string (data)"""
    start_pos = None
    end_pos = None
    count_open = 0
    count_close = 0
    code_snippets = []
    for i,v in enumerate(data):
        if v =='{':
            count_open+=1
            if not start_pos:
                start_pos= i
        if v=='}':
            count_close +=1
            if count_open == count_close and not end_pos:
                end_pos = i+1
        if start_pos and end_pos:
            code_snippets.append((start_pos,end_pos))
            start_pos = None
            end_pos = None

    return code_snippets 
```

我用它从文本文件中提取代码片段。

* * *

## 回答 #20

> 赞同：-1
> 
> 时间：2020-08-30T15:35:41.410

这可能有助于匹配平衡括号。

```
\s*\w+[(][^+]*[)]\s* 
```

* * *

## 回答 #21

> 赞同：-3
> 
> 时间：2018-07-05T03:30:42.343

这个也有效

```
re.findall(r'\(.+\)', s) 
```

# c - 包含 C 中每个可能的构造的参考代码

> ID：546434
> 
> 赞同：3
> 
> 时间：2009-02-13T15:49:29.047
> 
> 标签：c, compiler-construction, programming-languages

第 6 章 C 标准语言定义了[C 标准](http://www.open-std.org/jtc1/sc22/wg14/www/docs/n1124.pdf)中定义的所有不同概念、转换、词法元素、表达式、声明、语句、块、外部定义等。

我想知道是否在任何地方都存在包含所有这些 C 语言元素并且可用于测试工具（例如编译器）处理 C 代码的代码参考体。还是我太天真了？

期待您的回音！

火腿

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-13T16:11:57.777

你想要的谷歌短语是["c compiler test suite"](http://www.google.com/search?q=c+compiler+test+suite&ie=utf-8&oe=utf-8&aq=t&rls=org.mozilla:en-US:official&client=firefox-a)。

# php - 从 PHP 使用 LDAP 对用户进行身份验证

> ID：546438
> 
> 赞同：36
> 
> 时间：2009-02-13T15:50:14.490
> 
> 标签：php, authentication, ldap

我的项目是为我们大学做一个模块招生系统。因此，我联系了我大学的 IT 人员以获取详细信息，以将学生身份验证到系统中。我们正在使用现有的大学登录开发系统。他们给了我一些 LDAP 信息，我不知道它的用途。我在 Apacha 服务器上使用 PHP、Mysql。给定用户 ID 和密码以及 LDAP 信息，我如何验证登录系统的用户。

下面给出的是 LDAP 信息（我已经更改了域名等）

blueroom.ac.uk 域的 LDAP 信息

* * *

```
LDAP Host : ad.blueroom.ac.uk

LDAP port no: 389

BASE DN : ou=bluebird, dc=bluebird, dc=ac, dc=my

LDAP account to bind : cn = kikdap, ou=servacc, dc=bluebird,dc=ac,dc=uk

LDAP account password : ********

Attribute : sAMAccountName 
```

* * *

## 回答 #1

> 赞同：52
> 
> 时间：2009-02-13T18:05:49.873

一般程序是（括号中的相关 ext/ldap php 命令）：

1.  使用“LDAP 主机”和“LDAP 端口号”（[ldap_connect()](http://de2.php.net/manual/en/function.ldap-connect.php)）连接到 LDAP 服务器并设置正确的连接选项（[ldap_set_option()](http://de2.php.net/manual/en/function.ldap-set-option.php)），尤其是`LDAP_OPT_PROTOCOL_VERSION`和`LDAP_OPT_REFERRALS`

2.  使用“要绑定的 LDAP 帐户”和“LDAP 帐户密码”（[ldap_bind()](http://de2.php.net/manual/en/function.ldap-bind.php)）绑定到 LDAP 服务器 - 如果您要针对 Active Directory 服务器进行身份验证，则可以直接使用登录页面中的用户名和密码并跳过所有以下步骤。

3.  通过指定“BASE DN”和适当的 LDAP 过滤器在树中搜索匹配的用户条目/对象 - 很可能类似于`(&(objectClass=user)(sAMAccountName=%s))`where`%s`应替换为要验证的用户名（[ldap_search()](http://de2.php.net/manual/en/function.ldap-search.php)）

4.  检查返回的条目数是否为 1（如果 <> 1 则表示出现问题，例如未找到用户或找到多个用户）

5.  检索此单个条目的可分辨名称 (DN) ( [ldap_get_dn()](http://de2.php.net/manual/en/function.ldap-get-dn.php) )

6.  使用在上一步中找到的 DN 尝试使用身份验证页面 ( [ldap_bind()](http://de2.php.net/manual/en/function.ldap-bind.php) )中提供的密码绑定到 LDAP 服务器

7.  如果绑定成功，那么一切正常，如果没有，很可能是密码错误

这真的不像一开始听起来那么难。一般来说，我建议使用某种标准库来针对 LDAP 服务器（例如[`Net_LDAP2`](http://pear.php.net/package/Net_LDAP2)PEAR 包或[Zend Framework](http://framework.zend.com/)[`Zend_Ldap`](http://framework.zend.com/manual/en/zend.ldap.html)之外的服务器）进行身份验证。我没有实际使用的经验（尽管我非常了解代码），但对 Active Directory 服务器或 ADAMS 服务器（这显然是您正在使用的服务器）非常有效。`Net_LDAP2``Zend_Ldap`

这将使用`Zend_Ldap`：

```
$options = array(
    'host'                 => 'ad.blueroom.ac.uk',
    'useStartTls'          => true,
    'accountDomainName'    => 'blueroom.ac.uk',
    'accountCanonicalForm' => 4,
    'baseDn'               => 'ou=bluebird,dc=bluebird,dc=ac,dc=my',
);
$ldap = new Zend_Ldap($options);
try {
    $ldap->bind('user', 'password');
} catch (Zend_Ldap_Exception $e) {
    // something failed - inspect $e
}
// bind successful
$acctname = $ldap->getCanonicalAccountName('user', Zend_Ldap::ACCTNAME_FORM_DN); 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-13T15:54:13.827

您可以尝试[http://code.activestate.com/recipes/101525/](http://code.activestate.com/recipes/101525/)，同时参考[http://us3.php.net/ldap](http://us3.php.net/ldap)和 Google 搜索[[php ldap authentication]](http://www.google.com/search?q=php+ldap+authentication)的其他结果。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2015-06-04T05:59:23.543

@Stephen 提供了很好的观点。这是我使用 AD 进行身份验证的普通 PHP 代码：

1.  首先你需要知道这个参数：服务器主机，用户域（如果你想查询AD，你还需要base dn）。
2.  使用以下代码：

    ```
    $ldap = ldap_connect($host); // e.g. 165.5.54.6 or an URL
    ldap_set_option($ldap, LDAP_OPT_PROTOCOL_VERSION, 3); // Recommended for AD
    ldap_set_option($ldap, LDAP_OPT_REFERRALS, 0);
    $bind = ldap_bind($ldap, $username.'@'.$userDomain, $passwrod);

    if($bind){
    // successful authentication. 
    } 
    ```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-07-23T19:25:38.600

你可以使用[http://pear.php.net/package/Net_LDAP2/docs](http://pear.php.net/package/Net_LDAP2/docs) 它很好并且有效。

文档采用的连接示例：

```
// Inclusion of the Net_LDAP2 package:
require_once 'Net/LDAP.php';

// The configuration array:
$config = array (
    'binddn'    => 'cn=admin,ou=users,dc=example,dc=org',
    'bindpw'    => 'password',
    'basedn'    => 'dc=example,dc=org',
    'host'      => 'ldap.example.org'
);

// Connecting using the configuration:
$ldap = Net_LDAP2::connect($config);

// Testing for connection error
if (PEAR::isError($ldap)) {
    die('Could not connect to LDAP-server: '.$ldap->getMessage());
} 
```

# java - ACEGI 身份验证在 tomcat 404 错误处理程序中可用

> ID：546447
> 
> 赞同：0
> 
> 时间：2009-02-13T15:52:54.937
> 
> 标签：java, spring, http-status-code-404, spring-security

我在部署在 tomcat 5.5.26 中的 web 应用程序中使用 spring 和 acegi。

我想查看用户是否在 404 页面上登录，这样我们可以在他们登录时显示他们的姓名，否则显示登录链接。

我在请求调度程序的过滤器中有 HttpSessionContextIntegrationFilter。我在 ERROR 调度程序中也有它。

代码路径显示请求进入我的应用程序，通过 REQUEST 调度程序到 HttpSessionContextIntegrationFilter 记录它已被应用，设置用户上下文，然后继续过滤器链，然后清除用户上下文。然后它沿着 ERROR 调度程序前进，但是 HttpSessionContextIntegrationFilter 没有做任何事情，因为它已经为这个请求运行了，所以当它到达 404 页面时，上下文中没有身份验证（因为它被清除了出路）而不是放回去。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-13T16:28:31.793

这似乎是因为我们使用的是 acegi 1.0.3。

升级到 acegi 1.0.7 就是答案。

# .net - ASP.Net MVC 重定向到不同的视图

> ID：546461
> 
> 赞同：93
> 
> 时间：2009-02-13T15:56:41.760
> 
> 标签：.net, asp.net, asp.net-mvc

是否可以从控制器重定向到不同的视图？

例如，我的所有控制器都继承自一个自定义控制器，该控制器具有一个构造函数，如果不满足某些条件，我想将其重定向到不同的视图。希望这是有道理的。

* * *

## 回答 #1

> 赞同：151
> 
> 时间：2009-02-13T15:59:23.330

您可以使用该`RedirectToAction()`方法，然后您重定向到的操作可以返回一个视图。最简单的方法是：

```
return RedirectToAction("Index", model); 
```

然后在您的 Index 方法中，返回您想要的视图。

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2012-03-26T05:30:48.753

```
 if (true)
 {
   return View();
 }
 else
 {
   return View("another view name");
 } 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2016-11-27T17:01:10.057

最简单的方法是使用返回视图。

```
return View("ViewName"); 
```

请记住，如果您使用的是 MVC C#/.NET，则“ViewName”的物理名称应该类似于项目中的 ViewName.cshtml。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2011-04-22T16:13:57.227

我不是 100% 确定这样做的条件是什么，但对我来说，以上并没有直接起作用，以为它已经接近了。我认为这是因为我的视图需要“id”，在模型中它被称为“ObjectID”。

我有一个包含各种信息的模型。我只需要身份证。

在上述之前，我创建了一个新的 System.Web.Routing.RouteValueDictionary 对象并添加了所需的 id。

```
(System.Web.Routing.)RouteValueDictionary RouteInfo = new RouteValueDictionary();
RouteInfo.Add("id", ObjectID);
return RedirectToAction("details", RouteInfo); 
```

（注意：有问题的 MVC 项目不是我创建的，所以我不知道所有正确的“繁琐”位在哪里。）

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2013-11-27T06:23:17.003

以下是您可以执行的操作：

```
return View("another view name", anotherviewmodel); 
```

# debugging - 将 gdb 与内联函数一起使用

> ID：546475
> 
> 赞同：5
> 
> 时间：2009-02-13T15:59:38.460
> 
> 标签：debugging, gdb

我正在尝试`gdb`在死后模式下使用崩溃进程的核心转储。我可以获得堆栈跟踪，但不是向我显示违规函数中的实际位置，而是向我`gdb`显示违规函数调用的两行内联函数的行号。

内联函数被称为很多很多地方；我如何找到哪个调用触发了崩溃？如何立即找到内联函数周围的代码？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-12-18T04:42:02.393

转到有问题的堆栈帧，打印指令点（例如 p $rip），然后使用它手动查找它，例如“addr2line -e -i 0x84564756”。

这不能扩展，但至少它有效。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-23T05:16:48.727

我假设“对内联函数的许多调用”都发生在一个“违规函数”中（否则你的问题对我来说没有意义）。

最好的办法是记下崩溃点的 IP 地址`GDB`，然后在输出中使用`"objdump -dS ./a.out"`并找到该 IP。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-02-18T19:09:09.170

您可以尝试将 OPTIMIZE 设置为 NO（例如 setenv OPTIMIZE NO）并重建项目：这告诉编译器不要优化代码，因此它可能不会内联函数调用。

# css - 带有输入元素的 td 的 css 选择器

> ID：546478
> 
> 赞同：3
> 
> 时间：2009-02-13T15:59:53.390
> 
> 标签：css, css-selectors

> **可能重复：**
> [活动孩子的父母的复杂 CSS 选择器](https://stackoverflow.com/questions/45004/complex-css-selector-for-parent-of-active-child)

我将如何制作一个将样式应用于具有输入子元素的表格单元格的 CSS 选择器？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-13T16:02:56.270

不幸的是，你还不能在 CSS 中定位父元素~~（我相信它会出现在 CSS3 中）~~（见山姆的回答）。如果你想这样做，你要么必须 a) 使用 javascript，要么 b) 将类名添加到`td`包含输入的内容中。

[这是一个很好的参考](http://css.maxdesign.com.au/selectutorial/)，您可以使用当前的选择器来定位子代、兄弟姐妹、类型等。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-13T16:01:55.990

[根据维基百科](http://en.wikipedia.org/wiki/Cascading_Style_Sheets#Limitations)：

> **选择器无法上升**
> 
> > CSS 无法选择满足特定条件的元素的父级或祖先。更高级的选择器方案（例如 XPath）将支持更复杂的样式表。然而，CSS 工作组拒绝父选择器提案的主要原因与浏览器性能和增量渲染问题有关。

对于将来搜索 SO 的任何人，这也可能被称为祖先选择器。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-13T16:07:46.430

如果您使用 jQuery：

```
$("td input").each(function() { $(this).parent("td").css("style", "value"); }); 
```

# python - OO 设计原则是否适用于 Python？

> ID：546479
> 
> 赞同：26
> 
> 时间：2009-02-13T16:00:06.243
> 
> 标签：python, oop

似乎许多 OO 讨论都使用 Java 或 C# 作为示例（例如 Head First Design Patterns）。

这些模式是否同样适用于 Python？或者如果我遵循设计模式，我最终会用 Python 编写 Java（这显然是一件非常糟糕的事情）吗？

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2009-02-13T16:04:41.537

最大的区别是 Python 是鸭子类型的，这意味着您不需要像在 Java 中那样详细地规划类层次结构，并且具有一流的函数。例如，当您可以只传入一个函数而不是为了模拟高阶函数而必须制作接口等时，策略模式变得更加简单和明显。更一般地说，Python 具有许多常见设计模式的语法糖，例如迭代器和上述策略。理解这些模式可能很有用（我读过 Head First 并发现它非常有用），但要考虑 Python 的方法来实现它们，而不是像在 Java 中那样做事。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-02-13T16:07:07.227

Python 有它自己的设计习惯。有些标准模式适用，有些则不适用。诸如策略或工厂之类的东西具有使它们透明的语言支持。

例如，对于一流的类型，任何东西都可以是工厂。不需要工厂类型，您可以直接使用该类来构造您想要的任何对象。

基本上，Python 有自己的设计习惯，它们在很大程度上有所不同，因为它是如此动态并且具有令人难以置信的内省能力。

例子：

```
x = list
my_list = x(range(0,5)) #creates a new list by invoking list's constructor 
```

通过将类类型分配给可调用对象，您基本上可以删除代码中的任何“工厂”类型。您只剩下可调用对象，这些可调用对象生成应符合某些给定约定的对象。

此外，Python 中有一些设计模式无法用其他静态类型语言有效地表示。元类和函数装饰器就是很好的例子。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-13T16:05:49.617

这取决于模式。在 Python 中有些事情很难做到：Singleton 就是一个例子。您可以将这种模式替换为另一种模式，例如在 Singleton 的情况下，Borg。
在 Python 中使用设计模式并不疯狂——例如，迭代器模式已集成到语法中。然而，许多事情根本不是作为面向对象或模式繁重的东西来完成的。当 Python 最适合该任务时，它被设计为程序性或功能性的，OO 也是如此。
总的来说，我只想说用你最好的判断。如果看起来使用设计模式 Alpha-Gamma 是过度杀伤和过度复杂，那么它可能是。如果看起来该模式非常适合您想要的东西，那么它可能是。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-02-13T16:30:20.900

设计模式只不过是修复语言缺陷的胶带。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-02-14T16:26:51.790

**简短的回答：**是的；Python 是一种面向对象的语言。

**稍微长一点的回答：**是的；您可以使用 OO 原则进行*设计*，然后以任何语言（甚至是汇编程序）*实现。*

> 使用 OO 语言的好处是它包含了对许多常见 OO 概念的支持，因此您不必冒不必要的错误风险，不得不按照惯例模拟它们。当然，总会有特定语言的细节或多或少的适用性；您询问了“设计原则”，应该在该详细程度之上表达。

**冗长、冗长、无聊的回答：（**编程语言的发展**不是**简单的线性发展，但让我过分简化并忽略这一事实，以跨越大约 40 年的编程经验进行观察。）

> 语言特性与设计原则和模式之间总是有一定的关系。在每个阶段，细心的从业者都注意到：
> 
> *   “这是我们一直用当前语言手动解决的问题。”
>     
>     
> *   “这是我们一直用当前语言编写的一个错误。”
>     
>     
> *   “以下是我们在最佳项目中不断观察到的一些良好做法。”
>     
>     
> 
> 因此，下一代语言倾向于为观察到的良好行为提供支持，倾向于合并概念，因此它们不必按照约定/协议来完成（或意外地被相同的破坏），并强制执行容易防止的实践可避免的错误。
> 
> 无论我们的工具多么复杂、专业或通用，总有一些程序员“只是转动曲柄”，而其他人则一直在寻找“最好和最聪明的人”（*在旁观者的心目中*）如何使用这些工具。然后他们描述和推广这些做法。正确定义（以及是否称为“风格”、“指南”、“模式”、“原则”等），这些实践最终形成了我们一直试图达到的“下一个层次”，无论我们身在何处目前站立。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-02-13T16:40:54.307

进一步考虑，一些模式，例如 Borg，可能更特定于 Python（尽管对于其他模式和语言也可以说类似的话）。

Python 中也使用了迭代器模式，尽管形式略有不同。

Duncan Booth 写[了一篇关于 python 模式的文章](http://www.suttoncourtenay.org.uk/duncan/accu/pythonpatterns.html)。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-13T16:07:07.943

一旦您已经使用 Python 进行面向对象的编程，我会说它们适用于 Python。请记住，Python 可以做的远不止 OOP，您应该使用常识来选择适合该工作的范式。如果您决定将您的程序最好地表示为对象集合，那么请继续使用设计模式，但如果需要，不要害怕做一些完全不同的事情。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-13T16:19:05.187

是的，它们当然适用。但是如上所述，许多模式都内置在语言中，或者与语言的高级特性无关。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-13T16:07:58.300

使用 Java 或 C# 可能是由于该语言的主流流行。

但是无论您使用哪种语言，设计原则和/或设计模式都适用。在 Python 中实现相同的设计模式显然与在 Java 或 C# 中不同。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2010-01-21T00:51:02.310

是的，您可以在 Python 中使用大量的设计模式。设计模式只是更高级别任务的可重复实现。Python 和设计模式与其他语言的工作方式不同的原因是 Python 包含了大多数内置的基本模式。这意味着 Python 中出现的模式可能是更高级别的设计模式，而不是用于通常需要哪些模式。

# winapi - 如何在等待另一个程序完成时更新 win32 应用程序 gui？

> ID：546483
> 
> 赞同：3
> 
> 时间：2009-02-13T16:01:45.447
> 
> 标签：winapi, clipboard, subprocess

我目前正在使用 Win32 GUI 应用程序中的 CreateProcess/WaitForSingleObject 来启动一个处理软件许可问题的小型 GUI 应用程序。这一切都很好，但它基本上挂起“父”应用程序，同时等待许可应用程序完成其工作。在此期间，不会发生对父应用程序的更新，并且如果实用程序应用程序窗口移动，它会以难看的白色方块结束。

此外，由于某些奇怪的原因，在实用程序应用程序运行时，如果我将该应用程序中的某些内容*复制*到剪贴板，它就会挂起。我还没有弄清楚为什么，但只有在我等待应用程序从父应用程序中完成时才会发生这种情况。

所以我在想，如果我可以让父应用程序在等待我的另一个应用程序完成时处理它的事件，它可能会解决这两个问题。

那么，是否有替代 CreateProcess/WaitForSingleObject 来处理 UI 更新？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-17T14:55:08.400

您的父进程似乎挂起，因为 WaitForSingleObject() 调用阻塞了您的线程，直到您传递给调用的句柄发出信号。

您的子进程可能在复制到剪贴板操作期间挂起，因为作为该操作的一部分，它专门向父进程的窗口或所有顶级窗口发送消息。父进程线程中的消息循环没有运行，因为它被阻塞等待直到子进程退出，所以消息永远不会被处理并且子进程仍然被阻塞。

[您可以调用MsgWaitForMultipleObjects(](http://msdn.microsoft.com/en-us/library/ms684242(VS.85).aspx) )，而不是调用 WaitForSingleObject( ) 。如果您为 dwWaitMask 参数指定 QS_ALLINPUT，则 MsgWaitForMultipleObjects 将在您的事件发出信号或线程的消息队列中有输入时返回。如果因为消息可用而返回 MsgWaitForMultipleObjects()，您可以处理它并继续等待：

```
MSG msg;
DWORD reason = WAIT_TIMEOUT;
while (WAIT_OBJECT_0 != reason) {
    reason = MsgWaitForMultipleObjects(1, &hChildProcess, FALSE, INFINITE, QS_ALLINPUT);
    switch (reason) {
    case WAIT_OBJECT_0:
        // Your child process is finished.
        break;
    case (WAIT_OBJECT_0 + 1):
        // A message is available in the message queue.
        if (PeekMessage(&msg, NULL, 0, 0, PM_REMOVE)) {
            TranslateMessage(&msg);
            DispatchMessage(&msg);
            // Note that if your main message loop does additional processing
            // (such as calling IsDialogMessage() for modeless dialogs)
            // you will want to do those things here, too.
        }
        break;
    }
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-13T17:07:53.413

您可以将 WaitForSingleObject 调用放在一个循环中，并为 dwMilliseconds 参数使用一个相对较小的值。

退出循环的条件是 WaitForSingleObject 调用返回 WAIT_OBJECT_0。

在循环中，您必须检查消息队列以查看是否有任何必须处理的内容。你如何处理这真的取决于你，这取决于你的典型需求。

```

```
``// Assuming hYourWaitHandle is the handle that you're waiting on
//   and hwnd is your window's handle, msg is a MSG variable and
//   result is a DWORD variable
//

// Give the process 33 ms (you can use a different value here depending on 
//  how responsive you wish your app to be)
while((result = WaitForSingleObject(hYourWaitHAndle, 33)) == WAIT_TIMEOUT)
{ 
   // if after 33 ms the object's handle is not signaled..       

   // we examine the message queue and if ther eare any waiting..
   //  Note:  see PeekMessage documentation for details on how to limit
   //         the types of messages to look for
   while(PeekMessage(&msg, hwnd,  0, 0, PM_NOREMOVE))
   {
     // we process them..
     if(GetMessage(&msg, NULL, 0, 0) > 0)
     {
       TranslateMessage(&msg);
       DispatchMessage(&msg);
     }
   }
} 
// if you're here it means WaitForSingleObject returned WAIT_OBJECT_0, so you're done
//  (but you should always check and make sure it really is WAIT_OBJECT_0)
if(result != WAIT_OBJECT_0)
{
    // This should not be.. so react!
}`` 
```

 * * *

## 回答 #3

> 赞同：1
> 
>             
> 
> 时间：2009-02-13T16:10:36.640

我建议你可以这样处理：

*   父应用程序执行 CreateProcess，然后立即返回，而不是等待响应或实用程序应用程序完成

*   因为父应用程序已经返回，它可以处理其他的Window消息（例如WM_PAINT）

*   当实用程序应用程序完成时，它会通知父应用程序（例如使用 PostMessage 和 RegisterWindowMessage API）

*   父应用程序处理通过 PostMessage 收到的肯定通知

*   父应用程序也可能有一个 Windows 计时器 (WM_TIMER) 正在运行，以便它知道实用程序应用程序是否在发送通知之前被终止

* * *

## 回答 #4

> 赞同：0
> 
>             
> 
> 时间：2009-02-13T16:14:13.090

如果您生成的应用程序导致发送消息广播，无论是显式的还是隐式的，您都可能会遇到挂起问题。这是从我的网站上截取的：

出现问题是因为您的应用程序有一个窗口但没有发送消息。如果生成的应用程序使用广播目标之一（HWND_BROADCAST 或 HWND_TOPMOST）调用 SendMessage，则在所有应用程序都处理完该消息之前，SendMessage 不会返回到新应用程序 - 但您的应用程序无法处理该消息，因为它不是t 抽消息....所以新应用程序锁定，所以你的等待永远不会成功....死锁。

我不做剪贴板代码，但如果这导致上述情况（可信），那么你会死锁。你可以：

*   将辅助应用程序的启动放入一个小线程中

*   使用超时并围绕 PeekMessage 循环旋转（恶心）

*   使用 MsgWaitForMultipleObjects API。

该排序不暗示偏好...我假设您不自己创建衍生的应用程序，在这种情况下，您可以使用 IPC 来解决此问题，正如 ChrisW 建议的那样。

* * *

## 回答 #5

> 赞同：0
> 
>             
> 
> 时间：2009-02-13T16:48:44.413

您应该创建一个只执行以下操作的线程：

*   调用 CreateProcess() 来运行另一个应用程序

*   调用 WaitForSingleObject() 以等待进程完成 - 因为这是一个后台线程，您的应用程序不会阻塞

*   在进程句柄上调用 CloseHandle()

*   使用主线程的通知消息调用 PostMessage()

现在您只需要确保您的主应用程序禁用了其 GUI 以防止重入问题，可以通过显示一个模态对话框来通知用户另一个应用程序正在运行并且需要首先处理。确保对话框不能手动关闭，并且当它从后台线程接收到发布的通知消息时它会自行关闭。您也可以将整个线程创建放入此对话框中，并将所有内容包装在一个函数中，该函数创建、显示和销毁对话框并返回外部应用程序生成的结果。

# svn - 使用 Subversion 实现代码冻结

> ID：546484
> 
>         
> 
> 赞同：1
> 
>         
> 
> 时间：2009-02-13T16:01:52.293
> 
>         
> 
> 标签：svn

假设我正在做一个项目，并且我知道我已经完成了一个特定的课程，并且不应该再次对其进行编辑。我怎样才能锁定这个类，这样就不会发生更多的提交了？我试过锁定它，但这只持续一次提交，仍然允许我编辑它。

* * *

**推理：**

我有一门课只做一件事，而且只做一件事。它管理数据库的*X*部分。*X*不会改变，因此类不必改变。任何更改都可能是危险的并引入不必要的错误。例如，这是项目中的一个类，其中包含一个 googol (1.0 x 10^100) 类。为一个小类分支会过于复杂，特别是如果有一半的类是这样的，至少你会得到半个 googol 分支。

* * *

## 回答 #1

> 赞同：7
> 
>             
> 
> 时间：2009-02-13T16:05:37.260

[创建整个项目的一个分支](http://svnbook.red-bean.com/en/1.5/svn.branchmerge.html)- 然后您可以在您想要部署它们时合并您的主干中的未来更改。

* * *

## 回答 #2

> 赞同：5
> 
>             
> 
> 时间：2009-02-13T16:06:13.047

编辑：

根据您的编辑，如果您知道它不会改变，那为什么还要担心呢？如果您不信任您的开发人员，那么还有其他一些问题，但据我所知，您正在尝试使用版本控制来“解决”一些实际上并不存在的问题。

我和我假设许多其他人对“不变”的断言非常怀疑。  

就让它保持原样吧。

另外两个选项是预提交挂钩或通过权限文件进行访问控制。

编辑前发布：

如果您将 apache 用于存储库，则可以将权限设置为只读该文件。但在我看来，这是一个很大的错误。  

对于您的构建，您可以强制在“获取”中进行特定修订？

创建一个分支并将其强制为始终使用的分支。

如果您添加提交挂钩通知，您可以知道您不想要的文件更改。  

或者，您可以拥有一个开发分支和“已批准”分支，并且永远不要促进对该文件的任何更改

* * *

## 回答 #3

> 赞同：4
> 
>             
> 
> 时间：2009-02-13T16:11:06.063

您也许可以使用预提交挂钩，在特定条件下拒绝对特定文件的更改。

[http://svnbook.red-bean.com/en/1.2/svn.reposadmin.create.html#svn.reposadmin.create.hooks](http://svnbook.red-bean.com/en/1.2/svn.reposadmin.create.html#svn.reposadmin.create.hooks)

* * *

## 回答 #4

> 赞同：2
> 
>             
> 
> 时间：2009-02-13T16:06:15.903

好吧，首先，基本的答案是你*不*知道一个特定的类永远不应该被再次编辑。相信我，会的。

也就是说，代码冻结——你说“没有更多的改变”——很容易在 svn 中通过在代码上拉一个标签或一个分支（差异是相当任意的）来实现。  

如果要冻结一个文件，请考虑使用 svn 属性对其进行标记。

* * *

## 回答 #5

> 赞同：2
> 
>             
> 
> 时间：2009-02-15T10:17:20.783

我不会为此使用源代码控制，相反，如果您可以提取一大块功能（包括此类），那么您可以从中创建一个单独的项目。然后可以将该项目的输出作为库包含在您的主项目中，即在Java 中，我将从新项目创建一个jar 并将其包含在我的主项目中。如果/当此类及其相关类发生更改时，您可以重新创建库，但可以完全控制何时决定将这些更改包含到您的主项目中。

* * *

## 回答 #6

> 赞同：1
> 
>             
> 
> 时间：2009-02-13T16:07:53.700

通常源代码控制系统不允许您永久锁定类。这是有道理的，因为如果你有一个错误，你必须“解冻”这个类，等等。  

但是，Subversion 允许您标记或分支代码。标记允许您返回到代码的特定版本，分支允许您同时处理程序的多个版本。两者都允许您以某种方式“冻结”代码。

在大型项目中，在冻结发布之前，您通常会从 HEAD 分支，并继续将错误修复放入分支（例如 v1）——这提供了与任何进入 HEAD for V2 的新开发的隔离。

* * *

## 回答 #7

> 赞同：0
> 
>             
> 
> 时间：2009-02-16T09:28:03.280

您可以使用 SVN 锁定功能，但不要使用您自己的用户名锁定它，而是使用特定的用户帐户（例如“ice-code”（双关语））来获得锁定。这样，当您提交时，它不会尝试释放锁。当您想释放所有锁时，请使用单独的用户帐户将其解锁。

# c - 在 Windows Vista 的网络共享上测试文件是否存在的最佳方法是什么？

> ID：546486
> 
>         
> 
> 赞同：3
> 
>         
> 
> 时间：2009-02-13T16:02:19.657
> 
>         
> 
> 标签：c, windows-vista

我的问题是关于[测试文件是否存在于 Windows 上的最佳方法是什么？](https://stackoverflow.com/questions/322003/what-is-the-best-way-to-test-whether-a-file-exists-on-windows)，有一些具体的警告。具体来说，数据位于映射驱动器上，并使用 SMB 2.0 协议。（根据定义，这要求驱动器从 Vista 机器映射到 Vista 或 Server 2008 机器。）  

回复上述问题的答案的问题是 SMB 2.0 缓存了一堆元数据，包括给定目录中的文件名。因此，如果您正在测试是否存在*刚刚*创建的文件，那么函数 _access、access、GetFileAttributes 和 CreateFile（可能还有其他）都将使用缓存信息来回答“此文件是否存在？”的问题。 . 如果该文件是由另一个用户最近创建的，则缓存指示该文件不存在，尽管它确实存在。我已经设置了测试环境来测试这个，我可以确认客户端在几秒钟内  *没有生成 SMB2 流量[大概缓存每 5 秒左右过期一次]。*

有没有其他人看过这个？（如果是这样，除了添加延迟/重试之外，您是否找到了解决方法？）有没有人知道任何类似于上述的 API 可以在不使用 SMB 缓存的情况下检查文件是否存在？或者，更好的是，有人知道 Windows API 会简单地转储缓存的 SMB 元数据吗？

* * *

## 回答 #1

> 赞同：1
> 
>             
> 
> 时间：2009-05-24T16:38:35.900

打电话`open(path, O_CREAT | O_EXCL, mode)`检查结果。如果文件已经存在，这会导致错误。当然，这将写入 SMB 缓存并给出正确的结果，否则它将非常不可靠。因此，如果调用成功，则文件文件*不*存在，但现在存在，因此您可能需要删除它（取决于应用程序逻辑）。如果调用失败，则文件*已经*存在。

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2009-11-03T15:40:45.923

虽然不是编程解决方案，但我找到了一种有效的解决方法（在 Microsoft 支持的帮助下）。我想在这里发布解决方法，以防其他人像我一样对此感到沮丧。由于此行为是 SMB2 的“功能”，Microsoft 提供了以下注册表项来覆盖默认的元数据缓存生命周期：

```
HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\LanmanWorkstation\Parameters\FileInfoCacheLifetime 
HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\LanmanWorkstation\Parameters\FileNotFoundCacheLifetime 
HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\LanmanWorkstation\Parameters\DirectoryCacheLifetime 
```

其中每一个都是 DWORD 值，可以根据需要进行设置。（在 SMB2 客户端上将这些设置为 0 可以有效地解决我的问题。）

* * *

## 回答 #3

> 赞同：-1
> 
>             
> 
> 时间：2009-03-03T14:43:46.410

打开它。

# java - 仅部分考虑了 Java 日志记录配置

> ID：546492
> 
>         
> 
> 赞同：0
> 
>         
> 
> 时间：2009-02-13T16:04:07.093
> 
>         
> 
> 标签：java, logging, classpath, classloader

我在尝试使用[one-jar](http://one-jar.sourceforge.net/)打包程序来简化部署过程来交付一个项目时遇到了问题。

没有打包，一切正常，日志配置也被完美加载，但在打包中，只有部分配置被应用。

所以，这是我使用的 logging.properties：

```
handlers= java.util.logging.ConsoleHandler, java.util.logging.FileHandler
.level= INFO
java.util.logging.FileHandler.pattern = C:\\MyPath\\logging.csv
java.util.logging.FileHandler.limit = 50000
java.util.logging.FileHandler.count = 1
java.util.logging.FileHandler.formatter = my.package.logging.Formatter
java.util.logging.ConsoleHandler.level = INFO
java.util.logging.ConsoleHandler.formatter = my.package.logging.Formatter 
```

在我的主课中，这是我加载它的方式：

```
public class MainClass {
  public static void main(final String[] args) {
    try {
      LogManager.getLogManager().readConfiguration(
        new MainClass().getClass().getResourceAsStream("logging.properties"));
      // main process goes here.
    } catch(Exception e) {
      // Exception handling
    }
  }
} 
```

日志级别以及 FileHandler 模式很好理解，因为日志记录最终在正确的文件中，但作为行 XML 输出，这让我认为格式化程序没有加载，因为它通常输出 CSV 格式。

它可能与类路径问题有关吗？有谁知道如何处理这个？

* * *

## 回答 #1

> 赞同：1
> 
>             
> 
> 时间：2009-02-13T16:22:06.083

它可能在您的 jar 中，您有多个 logging.properties 文件，具有相似但略有不同的设置。当您将它们与一个罐子组合在一起时，顺序会发生变化，其中一个会被隐藏。执行“jar -tf *.jar |grep logging.properties”，看看你看到了什么。

如果这不起作用，您可以尝试将 onejar 结果解压缩到目录结构中，然后使用类路径上的目录而不是 jar 运行？这将让您查看它是否与 jar 有关，并实际检查您在 onejar 中的 logging.properties，并查看它是否符合您的预期。

* * *

## 回答 #2

> 赞同：0
> 
>             
> 
> 时间：2010-07-13T01:12:23.963

采用    `LogManager.getLogManager().readConfiguration(LogManager.class.getResourceAsStream("/logging.debug.properties"));`

（注意额外的斜线）。

# c# - 为静态 GenerateMock<> 设置 Spring.Net 和 Rhino Mocks 的配置

> ID：546497
> 
>         
> 
> 赞同：2
> 
>         
> 
> 时间：2009-02-13T16:05:22.723
> 
>         
> 
> 标签：c#, rhino-mocks, spring.net

我无法设置 Spring.Net 的配置，以便可以使用 Rhino Mocks 生成模拟对象。我意识到 GenerateMock 是一个静态方法，所以我需要在配置中使用工厂方法，但我无法让它工作。这是我正在使用的配置：

```
<object id="exampleObject"
        type="Rhino.Mocks.MockRepository, Rhino.Mocks"
factory-method="GenerateMock&amp;lt;MyAssembly.MyInterface>" /> 
```

然后在我的代码（这是一个单元测试）中我使用：

```
using (IApplicationContext ctx = ContextRegistry.GetContext()) {....} 
```

但我收到以下错误消息：

```
System.Configuration.ConfigurationErrorsException: Error creating context 'spring.root': Could not load type from string value 'MyAssembly.MyInterface'. --->  System.TypeLoadException: Could not load type from string value 'MyAssembly.MyInterface'.. 
```

任何想法为什么我可能会收到错误？

* * *

## 回答 #1

> 赞同：2
> 
>             
> 
> 时间：2009-02-14T19:17:33.733

实际上，您只在泛型参数中指定类型名而不是程序集名称。它应该更好地阅读

```
 factory-method="GenerateMock<[MyNamespace.MyInterface, MyAssembly]>" 
```

注意方括号引用完整的限定类型名，您需要获取最近的夜间构建。

完整的限定名称允许 CLR 找到包含您的类型的程序集。否则 Spring 会为该类型名扫描已加载的程序集。如果您的程序集尚未加载，您会遇到您面临的错误消息。

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2011-01-05T13:04:21.183

不确定您使用的是哪个版本的 rhino 模拟，但这似乎不再起作用，因为 Spring.NET 没有正确解释 GenerateMock( **params** ...) 中的参数变量 nr。

我花了半天时间才弄清楚这一点并使用以下解决方法：

```
<object id="Logger" type="Rhino.Mocks.MockRepository, Rhino.Mocks"
            factory-method="GenerateMock&lt;Core.Common.Logging.ILog>" >
      <constructor-arg name="argumentsForConstructor">
            <list element-type="System.Object">             
            </list>
        </constructor-arg>
</object> 
```

我基本上必须显式传递一个空的对象数组，以便 Spring 能够识别方法签名......

# windows - 如何使 Windows 文件锁定更像 UNIX 文件锁定？

> ID：546504
> 
>         
> 
> 赞同：23
> 
>         
> 
> 时间：2009-02-13T16:06:02.953
> 
>         
> 
> 标签：windows, unix

UNIX 文件锁定非常简单：操作系统假定您知道自己在做什么，并让您做自己想做的事情：

例如，如果您尝试删除另一个进程已打开的文件，操作系统通常会让您这样做。原始进程仍然保留它的文件句柄，直到它终止——此时文件系统将悄悄地重新循环磁盘资源。不客气，这就是我喜欢的方式。

Windows 上有多么不同：如果我尝试删除另一个进程正在使用的文件，我会收到操作系统错误。在原始进程释放它对文件的锁定之前，该文件是不可触及的。这在 MS-DOS 的单用户时代很棒，当时任何锁定过程都可能在包含文件的同一台计算机上，但是在网络上它是一场噩梦：

考虑当进程在写入 Windows 文件服务器上的共享文件时挂起时会发生什么。在删除文件之前，我们必须找到最初打开文件的计算机并识别该计算机上的进程。只有这样我们才能终止该进程并删除我们不需要的文件。

真讨厌！

有没有办法让它变得更好？我想要的是 Windows 上的文件锁定行为类似于 UNIX 中的文件锁定。我希望操作系统让我做我想做的，因为我负责，我知道我在做什么......

……那能做到吗？

* * *

## 回答 #1

> 赞同：12
> 
>             
> 
> 时间：2009-02-13T16:27:01.000

不，Windows 是为“普通用户”设计的，即对计算机一无所知的人。因此，操作系统会尽量避免[使用 PEBKAC](http://en.wikipedia.org/wiki/PEBKAC)。引用比尔·盖茨的话：“Windows 不存在任何人想要解决的问题。” 当然，他知道 99.9999% 的 Windows 用户无法判断该程序是否因为他们或编写它的人而做了一些奇怪的事情。

Unix 是在世界更简单的时候设计的，任何离计算机足够近的人都可以触摸它，可能知道如何用脏沙子组装它。因此，操作系统通常会让你做你想做的事，因为它假设你知道得更好（如果你不知道，下次你会的）。

技术答案：如果您创建一个文件，Unix 会分配一个“索引节点”。I节点可以在进程之间共享。如果两个进程创建同一个文件（即两个进程使用相同的路径调用 create()），那么您最终会得到两个 i 节点。这是设计使然。它提供了一种奇特的安全功能：您可以创建只有您自己才能打开的文件：

1.  打开一个文件

2.  删除它（但保留文件句柄）

3.  以您喜欢的方式使用文件

4.  关闭文件

在第 2 步之后，Universe 中唯一可以访问该文件的进程就是创建它的那个进程（除非您想逐块读取硬盘）。操作系统将保持数据处于活动状态，直到您关闭文件或进程终止（此时 Unix 将在您之后清理）。

这种设计是所有 Unix 文件系统的基础。Windows 文件系统 NTFS 的工作方式大致相同，但高级 API 不同。许多应用程序以独占模式打开文件（这会阻止任何人，甚至是备份程序）来读取文件。对于仅显示信息的应用程序（如 PDF 查看器）来说也是如此。

这意味着您必须修复所有 Windows*应用程序*才能达到预期的效果。如果您有权访问源，则可以在共享模式下创建文件。这将允许其他进程同时访问它，但是，您必须在每次读/写之前检查文件是否仍然存在，是否有人进行了更改等。

* * *

## 回答 #2

> 赞同：9
> 
>             
> 
> 时间：2009-02-13T16:26:17.010

根据 MSDN，您可以指定 CreateFile() 第三个参数 (dwSharedMode) 共享模式标志`FILE_SHARE_DELETE`：

> 启用对文件或设备的后续打开操作以请求删除访问权限。
> 
> 否则，如果其他进程请求删除访问权限，它们将无法打开文件或设备。
> 
> 如果未指定此标志，但已打开文件或设备以进行删除访问，则函数失败。
> 
> 注意 删除访问允许删除和重命名操作。

[http://msdn.microsoft.com/en-us/library/aa363858(VS.85).aspx](http://msdn.microsoft.com/en-us/library/aa363858(VS.85).aspx)

因此，如果您可以控制您的应用程序，则可以使用此标志。

* * *

## 回答 #3

> 赞同：3
> 
>             
> 
> 时间：2009-02-13T16:28:38.813

请注意，Process Explorer 允许通过 Handle -> Close Handle 强制关闭文件句柄（对于您正在运行它的框的本地进程）。

[Unlocker](http://www.emptyloop.com/unlocker/)声称可以做更多事情，并提供有用的其他工具列表。

重启时删除也是一个选项（尽管这听起来不是你想要的）

* * *

## 回答 #4

> 赞同：1
> 
>             
> 
> 时间：2009-02-13T16:28:20.763

如果挂起的进程仍然打开句柄，那并没有真正的帮助。在挂起的进程释放句柄之前，它不会释放资源。但无论如何，在 Windows 中，可以强制关闭正在使用它的进程下的文件。来自 sysinternals.com 的 Process Explorer 将让您查看和关闭进程已打开的句柄。

# algorithm - 计算 13 日星期五的未来事件

> ID：546505
> 
>         
> 
> 赞同：7
> 
>         
> 
> 时间：2009-02-13T16:06:06.293
> 
>         
> 
> 标签：algorithm, language-agnostic, datetime

我希望能够从一年开始，并计算 13 日星期五的出现次数。蛮力解决方案简单明了。我有一些更好的东西，但我毫不怀疑其他人可以为此提出一个优雅的算法。

也许有点棘手，我有兴趣给这个程序一个月，让它找到那个月有 13 号星期五的下一年。

随意使用伪代码，但我希望人们会更多地投票支持使用您最喜欢的语言的工作代码示例。

* * *

## 回答 #1

> 赞同：11
> 
>             
> 
> 时间：2009-02-13T16:12:20.147

任何以星期日开始的月份都有一个星期五在十三号。只有 14 种组合可能知道一年中的第一天是哪一天（有或没有闰年，以及太阳-星期六）。您应该只计算一次并完成它。您只需检查 14*12 可能的月份开始，并且有理由。

结果表元素（从 2009 年、2010 年开始）：

```
[Thursday,false] => Feb, March, Nov
[Friday,false] => Aug 
```

要填写表格，您有一个通用月份 Jan(31),Feb(28).. 然后使用一周中每一天的种子进行迭代，注意从星期日开始的月份，以及闰年和没有闰年。非常简单，一旦完成，您可以与我们分享:)

* * *

## 回答 #2

> 赞同：10
> 
>             
> 
> 时间：2009-02-13T16:11:40.070

由于您的蛮力算法显然是直观的逐日迭代选项，因此您可能没有考虑过[Doomsday Algorithm](http://en.wikipedia.org/wiki/March_0)。它可以让您简单地检查 13 日是否是星期五。据我所知，这是解决问题的最有效方法。

* * *

## 回答 #3

> 赞同：3
> 
>             
> 
> 时间：2009-02-13T16:19:25.573

[这是一些示例 PHP 代码](http://www.phpro.org/examples/Calculate-Friday-The-13th-With-Datetime-Class.html)，它通过一个范围内的日期的非常直接的循环。我会修改它以检查每个月的 13 日是否有星期五，而不是像他们在示例中那样检查每个星期五的 13 日。

* * *

## 回答 #4

> 赞同：2
> 
>             
> 
> 时间：2009-02-13T16:12:47.477

我注意到的一件事是，每月的第一天是星期天，而星期五是 13 号。您可能可以利用它来简化计算。

* * *

## 回答 #5

> 赞同：1
> 
>             
> 
> 时间：2009-02-13T16:10:50.400

```
initialize startDate to 13th of the month given in the current year
while (true) {
    if (startDate.dayOfWeek == Date.FRIDAY)
         break;
    else
         startDate.year ++;
}
return startDate.year; 
```

* * *

## 回答 #6

> 赞同：1
> 
>             
> 
> 时间：2009-02-13T16:15:03.760

我会这样做：

*   假设年份是已知的并且是整数。

*   从 1 循环到 12

    *   使用循环索引、年份和 13 创建日期

        *   [根据已建立的算法](http://en.wikipedia.org/wiki/Calculating_the_day_of_the_week)确定星期几

        *   如果上面计算的星期几是星期五，做你的工作

如果你想从月份和年份开始（你必须假设某种年份），你的算法变成

*   假设年份已知且为整数

*   假设月份是已知的并且是一个整数

*   环形

    *   创建日期，循环索引为年份，已知月份变量，当天为 13

    *   [根据已建立的算法](http://en.wikipedia.org/wiki/Calculating_the_day_of_the_week)确定星期几

    *   如果上面计算的星期几是星期五，则返回日期，否则

    *   否则每年增加 1

* * *

## 回答 #7

> 赞同：0
> 
>             
> 
> 时间：2020-12-07T08:52:08.310

我在 Windows 10 上使用 PowerShell 7.1 x64，我对此也很感兴趣，虽然我的编程技能还不够先进，无法开发独立且复杂的算法（没有内置）来解决这个问题，目前我可以这样做：

```
$start=Read-Host "Input start year"
$end=Read-Host "Input end year"
$years=$start..$end
$blackfriday=@()
foreach ($year in $years) {
    $blackfriday+=1..12 | foreach { [datetime]"$year-$_-13" } | where { $_.DayOfWeek -eq 'Friday'} | foreach {$_.tostring("yyyy, MMMM dd, dddd")}
}
$blackfriday 
```

更新：现在我有了这个，通过暴力强制 year-month-13 将日期转换为天，并得到天 mod 7 等于 5 的结果，我使用了维基百科上的所有高级算法：[https://en。 wikipedia.org/wiki/Determination_of_the_day_of_the_week](https://en.wikipedia.org/wiki/Determination_of_the_day_of_the_week)
我发现它们不能很好地与 PowerShell 配合使用，不知道是我还是 Wikipedia 弄错了，无论如何这是我的脚本，我已经将脚本的结果与内置和这个脚本，它显示“FC：没有遇到差异”：

```
$months=@(
[PSCustomObject]@{Month='January';Days=31}
[PSCustomObject]@{Month='February';Days=28}
[PSCustomObject]@{Month='March';Days=31}
[PSCustomObject]@{Month='April';Days=30}
[PSCustomObject]@{Month='May';Days=31}
[PSCustomObject]@{Month='June';Days=30}
[PSCustomObject]@{Month='July';Days=31}
[PSCustomObject]@{Month='August';Days=31}
[PSCustomObject]@{Month='September';Days=30}
[PSCustomObject]@{Month='October';Days=31}
[PSCustomObject]@{Month='November';Days=30}
[PSCustomObject]@{Month='December';Days=31}
)
function BlackFriday {
    param(
    [Parameter(ValueFromPipeline=$true, Mandatory=$true, Position=0)] [int64] $start,
    [Parameter(ValueFromPipeline=$true, Mandatory=$true, Position=1)] [int64] $end
    )
    $years=$start..$end
    $blackfriday=@()
    foreach ($year in $years) {
        $array=1..12
        foreach ($arra in $array) {
            $month=0
            for ($i=0;$i -lt $arra-1;$i++) {
                $month+=$months[$i].Days
            }
            [int]$ye=$year
            if ($arra -le 2) { $ye-=1}
            if ($ye % 4 -eq 0) {$leap=$ye/4}
            else {while ($ye % 4 -ne 0) {$ye-=1}
            $leap=$ye/4}
            if ($ye % 100 -eq 0) {$century=$ye/100}
            else {while ($ye % 100 -ne 0) {$ye-=4}
            $century=$ye/100}
            if ($ye % 400 -eq 0) {$cycle=$ye/400}
            else {while ($ye % 400 -ne 0) {$ye-=100}
            $cycle=$ye/400}
            $leap=$leap-$century+$cycle
            $date=[int64](($year-1)*365+$month+13+$leap)
            if ($date % 7 -eq 5) {
                $name=$months[$arra-1].Month
                $blackfriday+=[string]"$year, $name 13, Friday"
            }
        }
    }
    $blackfriday
}
$start=Read-Host "Input start year"
$end=Read-Host "Input end year"
BlackFriday $start $end 
```

# python - 如何在python中拆分文件？

> ID：546508
> 
>         
> 
> 赞同：21
> 
>         
> 
> 时间：2009-02-13T16:06:29.897
> 
>         
> 
> 标签：python

可以拆分文件吗？例如，您有巨大的单词表，我想将其拆分为多个文件。这怎么可能？

* * *

## 回答 #1

> 赞同：21
> 
>             
> 
> 时间：2009-02-13T16:17:41.383

这个用换行符拆分文件并将其写回。您可以轻松更改分隔符。如果您的输入文件中没有多个 splitLen 行（在此示例中为 20 行），这也可以处理不均匀的数量。

```
splitLen = 20         # 20 lines per file
outputBase = 'output' # output.1.txt, output.2.txt, etc.

# This is shorthand and not friendly with memory
# on very large files (Sean Cavanagh), but it works.
input = open('input.txt', 'r').read().split('\n')

at = 1
for lines in range(0, len(input), splitLen):
    # First, get the list slice
    outputData = input[lines:lines+splitLen]

    # Now open the output file, join the new slice with newlines
    # and write it out. Then close the file.
    output = open(outputBase + str(at) + '.txt', 'w')
    output.write('\n'.join(outputData))
    output.close()

    # Increment the counter
    at += 1 
```

* * *

## 回答 #2

> 赞同：15
> 
>             
> 
> 时间：2012-11-12T14:15:35.230

sli 示例的更好循环，而不是占用内存：

```
splitLen = 20         # 20 lines per file
outputBase = 'output' # output.1.txt, output.2.txt, etc.

input = open('input.txt', 'r')

count = 0
at = 0
dest = None
for line in input:
    if count % splitLen == 0:
        if dest: dest.close()
        dest = open(outputBase + str(at) + '.txt', 'w')
        at += 1
    dest.write(line)
    count += 1 
```

* * *

## 回答 #3

> 赞同：8
> 
>             
> 
> 时间：2011-06-17T17:58:58.313

将二进制文件拆分为 .000、.001 等章节的解决方案：

```
FILE = 'scons-conversion.7z'

MAX  = 500*1024*1024  # 500Mb  - max chapter size
BUF  = 50*1024*1024*1024  # 50GB   - memory buffer size

chapters = 0
uglybuf  = ''
with open(FILE, 'rb') as src:
  while True:
    tgt = open(FILE + '.%03d' % chapters, 'wb')
    written = 0
    while written < MAX:
      if len(uglybuf) > 0:
        tgt.write(uglybuf)
      tgt.write(src.read(min(BUF, MAX - written)))
      written += min(BUF, MAX - written)
      uglybuf = src.read(1)
      if len(uglybuf) == 0:
        break
    tgt.close()
    if len(uglybuf) == 0:
      break
    chapters += 1 
```

* * *

## 回答 #4

> 赞同：3
> 
>             
> 
> 时间：2013-03-13T01:38:40.063

```
def split_file(file, prefix, max_size, buffer=1024):
    """
    file: the input file
    prefix: prefix of the output files that will be created
    max_size: maximum size of each created file in bytes
    buffer: buffer size in bytes

    Returns the number of parts created.
    """
    with open(file, 'r+b') as src:
        suffix = 0
        while True:
            with open(prefix + '.%s' % suffix, 'w+b') as tgt:
                written = 0
                while written < max_size:
                    data = src.read(buffer)
                    if data:
                        tgt.write(data)
                        written += buffer
                    else:
                        return suffix
                suffix += 1

def cat_files(infiles, outfile, buffer=1024):
    """
    infiles: a list of files
    outfile: the file that will be created
    buffer: buffer size in bytes
    """
    with open(outfile, 'w+b') as tgt:
        for infile in sorted(infiles):
            with open(infile, 'r+b') as src:
                while True:
                    data = src.read(buffer)
                    if data:
                        tgt.write(data)
                    else:
                        break 
```

* * *

## 回答 #5

> 赞同：2
> 
>             
> 
> 时间：2009-02-13T16:10:36.250

当然有可能：

```
open input file
open output file 1
count = 0
for each line in file:
    write to output file
    count = count + 1
    if count > maxlines:
         close output file
         open next output file
         count = 0 
```

* * *

## 回答 #6

> 赞同：2
> 
>             
> 
> 时间：2018-01-24T21:31:46.490

您可以使用这个 pypi[文件拆分](https://pypi.org/project/filesplit/)模块。

* * *

## 回答 #7

> 赞同：2
> 
>             
> 
> 时间：2017-09-22T09:52:36.867

```
import re
PATENTS = 'patent.data'

def split_file(filename):
    # Open file to read
    with open(filename, "r") as r:

        # Counter
        n=0

        # Start reading file line by line
        for i, line in enumerate(r):

            # If line match with teplate -- <?xml --increase counter n
            if re.match(r'\<\?xml', line):
                n+=1

                # This "if" can be deleted, without it will start naming from 1
                # or you can keep it. It depends where is "re" will find at
                # first time the template. In my case it was first line
                if i == 0:
                    n = 0               

            # Write lines to file    
            with open("{}-{}".format(PATENTS, n), "a") as f:
                f.write(line)

split_file(PATENTS) 
```

结果你会得到：

专利.data-0

专利.data-1

专利数据-N

* * *

## 回答 #8

> 赞同：1
> 
>             
> 
> 时间：2019-06-24T07:37:42.873

这是一个迟到的答案，但是这里链接了一个新问题，并且没有提到任何答案`itertools.groupby`。

假设你有一个（巨大的）文件`file.txt`，你想分成几`MAXLINES`行`file_part1.txt`，... `file_partn.txt`，你可以这样做：

```
with open(file.txt) as fdin:
    for i, sub in itertools.groupby(enumerate(fdin), lambda x: 1 + x[0]//3):
        fdout = open("file_part{}.txt".format(i))
        for _, line in sub:
            fdout.write(line) 
```

* * *

## 回答 #9

> 赞同：-1
> 
>             
> 
> 时间：2019-10-22T05:53:11.473

提供的所有答案都很好并且（可能）有效但是，他们需要将文件加载到内存中（全部或部分）。我们知道 Python 在这类任务中效率不高（或者至少不如操作系统级别的命令高效）。

我发现以下是最有效的方法：

```
import os

MAX_NUM_LINES = 1000
FILE_NAME = "input_file.txt"
SPLIT_PARAM = "-d"
PREFIX = "__"

if os.system(f"split -l {MAX_NUM_LINES} {SPLIT_PARAM} {FILE_NAME} {PREFIX}") == 0:
    print("Done:")
    print(os.system(f"ls {PREFIX}??"))
else:
    print("Failed!") 
```

在此处阅读更多信息`split`：[https ://linoxide.com/linux-how-to/split-large-text-file-smaller-files-linux/](https://linoxide.com/linux-how-to/split-large-text-file-smaller-files-linux/)

# .net - 服务外观调用 - 安全检查

> ID：546513
> 
>         
> 
> 赞同：1
> 
>         
> 
> 时间：2009-02-13T16:06:59.583
> 
>         
> 
> 标签：.net, security

对于在 .NET 中实现的服务外观，是否有可用于执行某些安全检查的选项（例如 3rd 方库）？我的意思是某种基于访问控制列表的检查，基于它们的角色。

* * *

## 回答 #1

> 赞同：0
> 
>             
> 
> 时间：2009-02-13T16:16:18.873

立面是如何呈现的？单独组装？网络服务？一些奇怪的时髦定制的东西？另外身份验证是如何发生的？广告？还有什么？

如果服务层在调用用户的上下文中运行（即线程具有适合用户的填充 IPrinciple/IUser 上下文），您可以通过放置

```
[PrincipalPermission(SecurityAction.Demand,Role="*role*")] 
```

关于你的方法。如果经过身份验证的用户在您指定的角色/组中，这将引发安全异常。

# ruby-on-rails - 评估 nil.dependencies 时发生的错误是什么意思？

> ID：546514
> 
>         
> 
> 赞同：3
> 
>         
> 
> 时间：2009-02-13T16:07:03.780
> 
>         
> 
> 标签：ruby-on-rails, rubygems

我在 rails v2.2.2 上运行 ruby​​，当我运行 rake gems 时出现此错误。

> $ rake gems --trace 
> 
>   - [I] settingslogic 
> 
>   rake 中止！
> 
>   当你没想到时，你有一个 nil 对象！
> 
>   评估 nil.dependencies 
> 
>   /vendor/rails/railities/lib/rails/gem_dependency.rb:77:in `dependencies'时发生错误

* * *

## 回答 #1

> 赞同：3
> 
>             
> 
> 时间：2009-02-20T18:00:39.880

我弄清楚发生了什么事。核心 rake gems 函数中有一个错误，它假定该 gem 有规范，并且当该 gem 不存在时会出错。

这是带有工作补丁的此问题的票
[http://rails.lighthouseapp.com/projects/8994-ruby-on-rails/tickets/1464](http://rails.lighthouseapp.com/projects/8994-ruby-on-rails/tickets/1464)

* * *

## 回答 #2

> 赞同：0
> 
>             
> 
> 时间：2009-02-15T02:03:50.873

可能是它尝试加载的 gem 或您设置所需的 gem 的问题。检查 config/environment.rb 是否有任何奇怪的`config.gem`行，并更新所有 gem（sudo gem update）。

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2009-05-13T16:06:58.837

[这里](http://www.nabble.com/config.gem-dependencies-broken--td20770884.html)有更多详细信息，有两种替代解决方法 - 在 rails 中的依赖项代码中添加一行或 - 在 gem 之前指定 gem 依赖项

# jquery - Json JQuery 冲突

> ID：546517
> 
>         
> 
> 赞同：2
> 
>         
> 
> 时间：2009-02-13T16:07:07.943
> 
>         
> 
> 标签：jquery, json

我们的企业应用程序当前使用 Json.js 我下载了 JQuery js 文件，将其包含在使用 json 的页面中，并且我开始在 json.js 文件中收到 Javascript 错误。错误是：

```
Microsoft JScript runtime error: Object doesnt suppor this propety or method 
```

这是一个已知的问题？

编辑：我不确定这个 json.js 文件是从哪里下载的（一位同事已经这样做了）。但是，json.js 看起来像这样：

```
 json.js
2007-04-13

Public Domain

This file adds these methods to JavaScript:

    array.toJSONString()
    boolean.toJSONString()
    date.toJSONString()
    number.toJSONString()
    object.toJSONString()
    string.toJSONString() 
```

我用 json2.js 替换了这个文件，新文件似乎没有 parseJSON() 函数。我们在几个页面中使用了这个功能。

* * *

## 回答 #1

> 赞同：1
> 
>             
> 
> 时间：2009-02-13T16:18:50.880

看起来 Json.js 确实使用 $ 作为变量名。在这些情况下，您需要使用[JQuery 的 noconflict 函数](http://docs.jquery.com/Core/jQuery.noConflict)。基本上，您必须将 JQuery 脚本标记放在 Json 脚本标记之上，并在加载 Json 库之前在 jquery 上调用 noconflict 。一个不错的功能是，虽然 noconflict 使 JQuery 不使用 $，但您可以将 noconflict 的结果（将是 JQuery 对象）分配给另一个别名，就像这样

```
var $j = jQuery.noConflict(); 
```

现在你只需在任何你会使用 $ 的地方使用 $j。

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2009-02-13T16:19:14.373

您可能想要指定是什么`json.js`。这是[http://www.json.org/js.html](http://www.json.org/js.html)吗？

您可能正在使用与 jQuery 冲突的旧版本

这可能会有所帮助： http: [//www.mail-archive.com/discuss@jquery.com/msg06247.html](http://www.mail-archive.com/discuss@jquery.com/msg06247.html)

* * *

## 回答 #3

> 赞同：1
> 
>             
> 
> 时间：2009-02-14T12:44:21.637

要解决任何变量/方法命名问题，请使用 100% 对我有用的方法：

```
(function(){
  // Your javascript function goes here
})(); 
```

* * *

## 回答 #4

> 赞同：1
> 
>             
> 
> 时间：2010-11-19T10:21:48.187

将 json.js 替换为 json2.js 后，只需将结构替换为

```
foo.toJSONString()
foo.parseJSON() 
```

和

```
JSON.stringify(foo)
JSON.parse(foo) 
```

* * *

## 回答 #5

> 赞同：0
> 
>             
> 
> 时间：2009-02-13T16:17:22.023

我使用来自[http://json.org](http://json.org)的 json2.js 文件和 jQuery_1.3.1.js 文件没有问题。

# vb.net - 推荐的 VB.NET 代码生成器

> ID：546529
> 
>         
> 
> 赞同：1
> 
>         
> 
> 时间：2009-02-13T16:09:20.793
> 
>         
> 
> 标签：vb.net, code-generation

有人可以推荐一些好的 VB.net 代码生成工具吗？

我只需要一个开发桌面应用程序的工具。所以网络方面的事情并不太关心我。

* * *

## 回答 #1

> 赞同：5
> 
>             
> 
> 时间：2009-02-13T16:15:00.703

[CodeSmith 生成器](http://www.codesmithtools.com/product/generator)有一堆[Visual Basic 模板](http://www.codesmithtools.com/product/generator#templates)。

* * *

## 回答 #2

> 赞同：4
> 
>             
> 
> 时间：2009-02-13T16:18:32.627

代码生成（尤其是 .NET 语言）的事实标准似乎是[CodeSmith](http://www.codesmithtools.com/)。最新版本要花钱，但是，他们制作了旧版本的[免费软件](http://www.codesmithtools.com/freeware.aspx)。

如果您想使用免费和开源的东西，[MyGeneration](http://www.mygenerationsoftware.com/portal/default.aspx)也非常好，并且可以实际使用（经过一些转换）CodeSmith 模板。

* * *

## 回答 #3

> 赞同：2
> 
>             
> 
> 时间：2009-02-13T16:27:23.137

CodeSmith 的 Microsoft 副本是[T4](http://en.wikipedia.org/wiki/Text_Template_Transformation_Toolkit)，内置于 VS 2005 和 2008 中。

* * *

## 回答 #4

> 赞同：0
> 
>             
> 
> 时间：2009-02-13T19:56:02.793

I only know of a couple of products that are not free:

There is CodeRush from DevExpress:

[http://devexpress.com/Products/Visual_Studio_Add-in/Coding_Assistance/](http://devexpress.com/Products/Visual_Studio_Add-in/Coding_Assistance/)

Miguel Castro has one called CodeBreeze:
[http://www.steelbluesolutions.com/Summary/CodeBreeze/Default.aspx](http://www.steelbluesolutions.com/Summary/CodeBreeze/Default.aspx)

* * *

## 回答 #5

> 赞同：0
> 
>             
> 
> 时间：2009-10-30T17:17:39.033

CodeSmith 拥有大量模板并支持最新技术。它确实要花钱，但在您节省的时间以及随之而来的支持方面，这是非常值得的。如果您使用的是 Linq to SQL，请查看我们的 PLINQO 模板。目前 plinqo.com 上有一个甜蜜的 CodeSmith 优惠

谢谢

——布莱克·涅米斯基

# css - Liferay：如何避免重新构建/重新部署 CSS 文件

> ID：546534
> 
>         
> 
> 赞同：4
> 
>         
> 
> 时间：2009-02-13T16:10:17.420
> 
>         
> 
> 标签：css, liferay

如果您熟悉 Liferay，您就会知道，当您对 css 文件进行微小的更改时，您将重建主题并重新部署它。

至于重新部署，我做了一个符号链接（请注意，我在 Windows 上：出于好奇，在 Vista 上创建符号链接只是发出 mklink /d dir1 dir2 的问题）。

但是用 maven 重建东西呢？我宁愿跳过这一步。基本上它所做的是将所有 CSS 合并并打包到一个everything_packed.css 中。是否有一种配置变量可以告诉 liferay 只包含原始文件并一起跳过重新部署？

谢谢

* * *

## 回答 #1

> 赞同：4
> 
>             
> 
> 时间：2009-02-13T16:56:37.233

伙计们，我自己找到了解决方案。

您应该有一个名为 portal-ext.properties 的文件

$TOMCAT_DIR/webapps/ROOT/WEB-INFO/classes

或者更具体地说，对于我在 C:\liferay\webapps\ROOT\WEB-INF\classes 中的胜利设置

该文件将保存该值

主题.css.fast.load=false

这将阻止 liferay 寻找 Everything_packed.css，因此您可以自由修改您的东西而无需重建和 CTRL-R 刷新页面并查看更改。

* * *

## 回答 #2

> 赞同：3
> 
>             
> 
> 时间：2009-04-15T21:37:17.523

只是为了完整起见，因为这个问题有点老了，而且问题已经解决了：沿着这些路线还有很多东西，例如 javascript、布局等，可以在未缓存的情况下使用。这记录在[Liferay Wiki（作为开发者模式）](http://www.liferay.com/web/guest/community/wiki/-/wiki/Main/Liferay+Developer+Mode)或开发指南中，可从[文档站点](http://www.liferay.com/web/guest/community/documentation/5_2)获得（尽管目前它不存在于最后一个版本 - 如果在您阅读它时它仍然不存在，请查找它（ PDF）在旧版本中。

建议仅在开发中使用这些设置，而不是在生产中，因为将所有 css 和 javascript 放在尽可能少的文件中会导致巨大的性能影响。

* * *

## 回答 #3

> 赞同：3
> 
>             
> 
> 时间：2010-11-18T17:55:03.363

要包含所有这些设置，也只需将以下行添加到您的 portal-ext.properties 文件中：

包含并覆盖=portal-developer.properties

这将包括所有开发人员特定的设置，当你想删除它们时，你可以注释掉这一行。

* * *

## 回答 #4

> 赞同：0
> 
>             
> 
> 时间：2013-05-16T06:30:08.987

您可以从 Webapps{your theme}\css 编辑您的主题的 css 文件

并且可以直接看到变化。

您可以编辑几乎所有不需要编译的文件。**像 .jsp 文件但不是 .java 文件**

# iphone - iPhone 或 Cocoa：处理多个 HTTP 请求的顺序

> ID：546537
> 
>         
> 
> 赞同：1
> 
>         
> 
> 时间：2009-02-13T16:10:48.217
> 
>         
> 
> 标签：iphone, cocoa, cocoa-touch, multithreading

当使用 Cocoa/Cocoa-Touch 和 iPhone SDK 时，一个典型的约定是构建一个与服务器端 Web 服务器对话的客户端。我在编程时遇到的一个常见问题是按顺序发出多个 HTTP 请求，有时最多 5-6 个请求。发出请求的顺序不是它们返回的线性顺序。当视图被带到触发这些请求的窗口上时，我会使用 NSNotification 通知我何时有特定数据可用。我正在考虑一种只有在所有数据集都准备好时才会触发我的 UI 的方法。寻找好的实践和洞察你的方法。你在使用互斥锁或类似的东西吗？简单的计数器？

* * *

## 回答 #1

> 赞同：1
> 
>             
> 
> 时间：2009-02-13T16:38:45.060

假设您知道需要发出的所有请求，您可以将各种请求对象存储在一个数组 ( [NSMutableArray](http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/nsmutablearray_Class/Reference/Reference.html) ) 中。当您收到每个请求的通知时，将其从阵列中弹出。当您的数组长度为零时，您就知道您的所有请求都已完成。您需要确保对数组的访问受到互斥锁的保护。您还需要确保仅在填充数组后触发请求（以免在将第二个请求插入数组之前收到通知）。

另一种技术是在另一个线程（[performSelectorInBackground:](http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSObject_Class/Reference/Reference.html#//apple_ref/occ/instm/NSObject/performSelectorInBackground:withObject:)或[performSelector:onThread:](http://performSelector:onThread:withObject:waitUntilDone:)）中发出 HTTP 请求，但同步进行。这样，您就可以准确地知道所有请求何时完成，并可以向 UI[发出信号以自行更新。](http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSObject_Class/Reference/Reference.html#//apple_ref/occ/instm/NSObject/performSelectorOnMainThread:withObject:waitUntilDone:)

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2009-02-13T17:26:49.280

您需要在 旁边存储一些状态`NSHTTPRequest`，以便将您的请求链接到您的 UI（或模型）对象，或者，您必须能够从请求返回的内容中推断出这一点。

codelogic 的建议都是这种模式的例子。`NSOperation`将是另一个。

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2010-01-19T08:38:59.077

就像 codelogic 已经说过的那样，维护一个单独的数组或字典相当容易。

例如，确保正确初始化字典：

```
notifications = [[NSMutableDictionary alloc] initWithObjectsAndKeys:
   @"foo", @"bar",
   @"baz", @"bla",
   nil]; 
```

然后您可以注册通知（也在初始化程序中）：

```
for (NSString *key in notifications)
{
  [[NSNotificationCenter defaultCenter] addObserver:self selector:@selector(entityDidFetch:) name:key object:self];
} 
```

该`entityDidFetch:`方法可能如下所示：

```
- (void)entityDidFetch:(NSNotification *)notification
{
 @synchronized(notifications)
 {
  NSString *name = [notification name];
  [notifications removeObjectForKey:name];

  if ([notifications count] == 0)
  {
   // Final connection…
  }
 }
} 
```

`notifications`如果您在 iPhone 上工作或不使用 GC ，请不要忘记发布字典。

# stored-procedures - 在存储过程视图数据方面需要帮助

> ID：546546
> 
>         
> 
> 赞同：0
> 
>         
> 
> 时间：2009-02-13T16:12:37.183
> 
>         
> 
> 标签：stored-procedures

有人请通过修改此代码来帮助我。当我通过存储过程调用检索登录值时，我收到此错误消息“过程或函数'GetUserLogin'需要参数'@UserName'，未提供。” 这是我的代码：

```
public int GetLogin(string UserName, string Password)
    {
        SqlConnection con = new SqlConnection(str);      
        SqlDataAdapter da = new SqlDataAdapter("GetUserLogin", con);
        SqlCommand com = new SqlCommand("GetUserLogin",con);     
        com.CommandType = CommandType.StoredProcedure;
        DataSet ds = new DataSet();
        da.Fill(ds);
        if (ds.Tables[0].Rows.Count > 0)
        {
            if ((ds.Tables[0].Rows[0].ItemArray[1].ToString() == UserName) && (ds.Tables[0].Rows[0].ItemArray[2].ToString() == Password))
            {
                return 1;
            }
            else
            {
                return 0;
            }
        }
        else
        {
            return -1;
        }
StoredProcedure:
CREATE PROCEDURE GetUserLogin @UserName varchar(50)   
AS
select UserName,
       Password
From Login where UserName=@UserName
    RETURN 
```

谢谢， 马苏姆

* * *

## 回答 #1

> 赞同：1
> 
>             
> 
> 时间：2009-02-13T16:21:39.283

您需要在命令中添加一个 UserName 参数。在你创建你的命令之后，但在你执行它之前做这样的事情：

```
com.Parameters.Add("@UserName", SqlDbType.VarChar, 50);
com.Parameters["@UserName"].Value = UserName; 
```

* * *

## 回答 #2

> 赞同：0
> 
>             
> 
> 时间：2009-02-13T16:21:21.310

在填充数据集之前添加它

`cmd.Parameters.AddWithValue("UserName",UserName);`

# asp.net-ajax - jQuery 停止在 ASP.NET MVC 中通过 Ajax 处理更新的页面

> ID：546556
> 
>         
> 
> 赞同：2
> 
>         
> 
> 时间：2009-02-13T16:16:15.177
> 
>         
> 
> 标签：asp.net-ajax, jquery

我有一个特定日期事件的 ASP.NET MVC 页面。我也在使用 jQuery datepicker，当我选择一天时，我创建了一个函数，通过**Ajax**将这个选定的日期发送到 MVC ActionResult 方法，这个方法将处理这一天，将处理所有数据库内容并将返回给我所有此选定日期的事件。到现在为止还挺好...

之后，我尝试使用 jQuery 线索提示通过**Ajax**向我展示一些事件细节，这也有效......**部分**！

为什么是部分？？当我第一次（也是第一次）加载页面时，提示效果很好，所有的 Ajax 东西！在所有第一次加载中，页面将显示今天的事件，这不是通过 Ajax，它只是一个 ViewData["events"] 为页面发送信息。但是，如果我选择一天，页面会通过 Ajax 更新，但提示不再起作用了！！他们没有显示任何东西......我将链接悬停，没有任何反应......什么也没有。

我认为这是一个线索提示问题，但令我惊讶的是，它不是......

仅出于测试目的，我在 jQuery 中创建了这个：

```
$(".myLink").click(function(){ alert($(this).attr("id")); } 
```

第一次加载页面时，此代码有效，但如果我选择另一天并更新页面，则此 jQuery 代码不再有效！点击功能根本不起作用！

所以，结束这个疑问......有人知道会发生什么吗？为什么我的 jQuery 代码在通过 Ajax 的 ASP.NET MVC 更新页面中不起作用？

谢谢大家！！

* * *

## 回答 #1

> 赞同：3
> 
>             
> 
> 时间：2009-12-21T21:01:12.990

`live`绑定事件时使用该函数-

```
$(".myLink").live("click", function(){
    alert($(this).attr("id"));
}); 
```

This will ensure all elements with .myLink will be effected by the event, even if they are dynamically loaded later.

This doesnt work for every event though, so check the doc:
[http://docs.jquery.com/Events/live](http://docs.jquery.com/Events/live)

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2009-02-13T17:01:20.233

在 ajaxComplete 上再次添加鼠标悬停/单击事件处理程序。jQuery 选择器并不总是适用于动态添加到页面的文档元素，例如从 AJAX 调用返回的元素。

此代码在内容填充后立即重新绑定您的事件：

```
$.get("/getMyContent/" + eventID, "{}", function(content) {
  $(".contentArea").html(content);
  $(".eventLink").click(function(){
    doMyPopupEtc();
  });
}); 
```

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2009-02-13T16:21:27.440

它与路径有关。当你引用你的脚本时，一定要使用 <% Url.Content("~/path/to/script") %>

* * *

## 回答 #4

> 赞同：0
> 
>             
> 
> 时间：2009-02-13T16:43:59.913

不太可能，但是当 MVC 由于 AJAX 调用而更新容器时，您可能会清除负责显示线索提示的 JS。也就是说，当然，如果该 JS 被声明为内联，则在文档中。

* * *

## 回答 #5

> 赞同：0
> 
>             
> 
> 时间：2010-09-23T13:42:11.570

First I thought I had a similar problem. It turned out though that I was assigning the cluetip twice which stopped it from working.

# sql-server - SQL Server 排序规则冲突

> ID：546566
> 
>         
> 
> 赞同：4
> 
>         
> 
> 时间：2009-02-13T16:18:44.483
> 
>         
> 
> 标签：sql-server, redgate, sqlcompare

将数据从一个 SQL 服务器传输到另一个，但在比较和同步架构时收到以下错误。我们正在使用redgate SQL compare 来完成。

无法解决等于操作的排序规则冲突

基础 SQL 服务器是 SQL_Latin1_General_CP1_CI_AS，目标服务器是 Latin1_General_CI_AS

* * *

## 回答 #1

> 赞同：6
> 
>             
> 
> 时间：2009-02-13T16:26:47.803

SQL 比较有一个忽略排序规则的选项。在比较项目配置中的“选项”选项卡下查看。

* * *

## 回答 #2

> 赞同：0
> 
>             
> 
> 时间：2014-09-25T08:30:07.647

由于上述原因，“忽略排序规则”绝对行不通。当迁移对象（如在具有不同排序规则的文本字段上使用 JOIN 子句的视图和存储过程）时会出现此问题。

如果有人更改了服务器上的默认排序规则，并且 JOIN 另一侧的列使用特定排序规则，那么您就导致了这个问题。它会发生在 SQL 比较中，以及如果您只是在 SSMS 中手动编写对象并自己移动它。

有两种方法可以修复它 - 您可以在连接上指定 COLLATE 子句并明确声明要使用的排序规则，或者您可以更改目标数据库默认排序规则以匹配源。

恐怕没有 SQL 比较“灵丹妙药”来解决这个问题。

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2009-02-13T16:28:34.397

听起来服务器的排序规则设置不同。

您如何传输数据，您是否在新平台上执行数据库恢复？

无论哪种方式，您都需要确保在新环境中使用与源环境中当前使用的相同排序规则。

希望这是有道理的，如果您需要进一步的帮助，请告诉我。

* * *

## 回答 #4

> 赞同：0
> 
>             
> 
> 时间：2009-02-13T16:29:40.463

您是否对 SQL 比较实用程序有问题，或者担心不同的服务器排序规则会导致问题？

您可以更改目标服务器的排序规则以匹配基本服务器

如果这是不可能的，那么让每台服务器上的数据库的排序规则匹配，然后你唯一真正的问题可能是你创建的任何临时表（它们将有一个与服务器/TEMPDB 匹配的默认排序规则），所以只要您显式创建临时表（即不使用 SELECT * INTO #TEMP FROM MyTable 创建它）并显式为任何 varchar/text 列分配排序规则，您应该可以

* * *

## 回答 #5

> 赞同：0
> 
>             
> 
> 时间：2011-02-21T18:35:56.780

我克服这个问题的方法是通过 SQL Compare 生成脚本，然后删除（或替换）Collat​​ion 特定代码。这是相对快速和容易做到的，最后我手动将脚本应用到目标服务器/数据库。

# vsto - Outlook 加载项功能区上的工具提示

> ID：546573
> 
>         
> 
> 赞同：3
> 
>         
> 
> 时间：2009-02-13T16:19:54.403
> 
>         
> 
> 标签：vsto, add-in, ribbon

我使用 VSTO 2008 创建了一个 Outlook 加载项。我没有为此加载项创建单独的功能区/组。相反，当 Outlook 启动时，VSTO 会在内置功能区中自动创建加载项按钮。现在如何自定义该加载项图标的工具提示？

这是为我的加载项添加标签和图标的片段

```
[Microsoft.Office.Tools.Outlook.FormRegionMessageClass("IPM.Note.DougForm")]
    [Microsoft.Office.Tools.Outlook.FormRegionName("Doug.Note.FormTest")]
    public class QMemoRegionFactory : QRegionFactory, Microsoft.Office.Tools.Outlook.IFormRegionFactory
    {
        public DougFormTest()
        {
            this._Manifest.FormRegionName = "DougForm";
            this._Manifest.Icons.Page = global::DougForm.OutlookAddin.Properties.Resources.DougIcon_big;
        }
... 
```

谢谢

* * *

## 回答 #1

> 赞同：4
> 
>             
> 
> 时间：2009-03-19T02:34:20.153

您的应用程序是否生成任何您知道的功能区 XML？可以为功能区上的按钮设置工具提示文本的属性名称是 ScreenTip 和 SuperTip。

或者，创建您自己的自定义功能区 XML 并将标签、图标和屏幕提示设置为您想要的任何内容。

[http://msdn.microsoft.com/en-us/library/aa942866(VS.80).aspx](http://msdn.microsoft.com/en-us/library/aa942866(VS.80).aspx)

# powershell - 为什么 Powershell 环境 PATH 与系统环境 PATH 不同？

> ID：546583
> 
>         
> 
> 赞同：38
> 
>         
> 
> 时间：2009-02-13T16:23:28.637
> 
>         
> 
> 标签：powershell, path, environment-variables

我遇到了这种奇怪的情况：

我的用户和系统的 PATH 变量与 powershell 中的 PATH 不同。

当我做 ：

```
PS C:\$env:path
C:\Windows\System32\WindowsPowerShell\v1.0\;c:\oldpath 
```

然而这是不正确的，它看起来像是卡在我系统的一些旧 PATH 变量上，所以我在它上面完成的所有 udpates 都没有改变这个变量（每次更改后我都会重新启动以进行测试）。

为什么会这样？我是否必须为 powershell 设置一个 PATH 变量？

* * *

## 回答 #1

> 赞同：62
> 
>             
> 
> 时间：2009-02-13T18:16:31.783

更改可能会“延迟”，因此请尝试以下一种或多种解决方案：

*   **注销并**重新登录；

*   任务管理器 >**重新启动“Windows 资源管理器”** (explorer.exe)

*   **重新启动您的启动器应用程序**（launchy、SlickRun 等）

*   **重启**

**说明：**

Powershell 将继承启动它的进程的环境（这取决于您如何启动它）。这通常是交互式 shell (explorer.exe)。当您从计算机属性修改环境时，您会修改 explorer.exe 的环境，因此如果您从 explorer.exe 启动 powershell（例如从开始菜单），您应该会看到新环境。

但是，如果您从其他东西启动它（比如您已经打开的 cmd.exe shell），那么您不会因为该进程是在旧环境下启动的。

换句话说：小心你如何启动事物。

* * *

## 回答 #2

> 赞同：3
> 
>             
> 
> 时间：2020-04-23T18:08:56.007

就我而言，我安装了一个应用程序，该应用程序通过创建一个 powershell 配置文件错误地将自身添加到 PATH 中，该配置文件将`$env:PATH`在我每次启动 powershell 时覆盖并破坏现有配置。

检查您是否有个人资料，`USER\Documents\WindowsPowerShell\Microsoft.PowerShell_profile.ps1`以及它是否在做任何可疑的设置`$env:PATH`。

# java - java swing：自定义一切-子类jcomponent或jpanel或...？

> ID：546585
> 
>         
> 
> 赞同：3
> 
>         
> 
> 时间：2009-02-13T16:23:50.197
> 
>         
> 
> 标签：java, swing, subclass

嗨 - 快一点 - 与 JPanel 相比，子类化 JComponent 有什么危害/价值吗？

对我来说，如果我正在做自己的绘图并且对象不会有任何子对象，它们看起来几乎是一样的，但是似乎有一个将 JPanel 子类化为 JComponent 的首选项 - 只是寻找关于为什么这可能的意见是 ...

谢谢 ：-）

* * *

## 回答 #1

> 赞同：7
> 
>             
> 
> 时间：2009-02-13T16:57:04.360

如果您自己绘制整个组件，请使用 JComponent。JPanel 只是 JComponent 的一个简单的具体实例（它是抽象的），并不是真的要覆盖它的方法。

JPanel 有时是子类化的，因此子类构造函数可以添加各种控件/布局，而不必通过某些方法调用来完成。

# c# - 如何根据依赖关系重新排列数组中的项目？并且还检测任何循环依赖

> ID：546586
> 
>         
> 
> 赞同：1
> 
>         
> 
> 时间：2009-02-13T16:23:50.400
> 
>         
> 
> 标签：c#, arrays, sorting, cyclic-dependency

给定类型：

```
class Field{
    public string Name{get;set;}
    public string[] DependsOn{get;set;}
} 
```

假设我有一系列`Field`项目：

```
List<Field> fields = new List<Field>();
fields.Add(new Field() { Name = "FirstName" });
fields.Add(new Field() { Name = "FullName", 
                         DependsOn = new[] {"FirstName","LastName"}});
fields.Add(new Field() { Name = "Age", 
                         DependsOn = new[] { "DateOfBirth" } });
fields.Add(new Field() { Name = "LastName" });
fields.Add(new Field() { Name = "DateOfBirth" }); 
```

很明显，我们按以下顺序获取我们的项目：

1.  名

2.  全名

3.  年龄

4.  姓

5.  出生日期

**我的第一个问题：**
重新排列列表/数组中的项目的最佳方法是什么，以便将依赖列（全名和年龄）放在它们依赖的列之后，例如：

1.  名

2.  姓

3.  全名

4.  出生日期

5.  年龄

*所以像Age* 这样的字段**总是**在它所依赖的*DateOfBirth*之后。

**我的第二个问题**：有没有办法检测**循环依赖**？即何时

`Field1` *取决于* `Field2`和

`Field2` *取决于* `Field3`和

`Field3` *取决于* `Field1`

所以我们不会陷入一个圈子。例如，当你大学毕业后，你需要有 2 年的工作经验才能找到工作。但是要获得工作经验，您首先需要有工作。

* * *

## 回答 #1

> 赞同：3
> 
>             
> 
> 时间：2009-02-13T16:32:21.283

听起来您需要按拓扑顺序对这些项目进行排序。网络上有很多页面，维基百科可能是一个很好的起点：
 [http ://en.wikipedia.org/wiki/Topological_sort](http://en.wikipedia.org/wiki/Topological_sort)

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2009-02-13T20:53:09.067

感谢 Grzenio 的提示，我实际上在[http://www.java2s.com/Code/Java/Collections-Data-Structure/Topologicalsorting.htm的 java 中找到了类似的东西](http://www.java2s.com/Code/Java/Collections-Data-Structure/Topologicalsorting.htm)

以下是 C# 改编：

```
class Class1
{
    public static void Run()
    {
        doTopologicalTest();
    }

    private static void doTopologicalTest()
    {
        List<Field> fields = new List<Field>();
        fields.Add(new Field() { Name = "FirstName" });
        fields.Add(new Field()
        {
            Name = "FullName",
            DependsOn = new[] { "FirstName", "LastName" }
        });
        fields.Add(new Field()
        {
            Name = "Age",
            DependsOn = new[] { "DateOfBirth" }
        });
        fields.Add(new Field() { Name = "LastName" });
        fields.Add(new Field() { Name = "DateOfBirth" });

        foreach (var field in fields)
        {
            Console.WriteLine(field.Name);
            if(field.DependsOn != null)
                foreach (var item in field.DependsOn)
                {
                    Console.WriteLine(" -{0}",item);
                }
        }

        Console.WriteLine("\n...Sorting...\n");

        int[] sortOrder = getTopologicalSortOrder(fields);

        for (int i = 0; i < sortOrder.Length; i++)
        {
            var field = fields[sortOrder[i]];
            Console.WriteLine(field.Name);
            if (field.DependsOn != null)
                foreach (var item in field.DependsOn)
                {
                    Console.WriteLine(" -{0}", item);
                }
        }

    }

    private static int[] getTopologicalSortOrder(List<Field> fields)
    {
        TopologicalSorter g = new TopologicalSorter(fields.Count);
        Dictionary<string, int> _indexes = new Dictionary<string, int>();

        //add vertices
        for (int i = 0; i < fields.Count; i++)
        {
            _indexes[fields[i].Name.ToLower()] = g.AddVertex(i);
        }

        //add edges
        for (int i = 0; i < fields.Count; i++)
        {
            if (fields[i].DependsOn != null)
            {
                for (int j = 0; j < fields[i].DependsOn.Length; j++)
                {
                    g.AddEdge(i,
                        _indexes[fields[i].DependsOn[j].ToLower()]);
                }
            }
        }

        int[] result = g.Sort();
        return result;

    }

    class Field
    {
        public string Name { get; set; }
        public string[] DependsOn { get; set; }
    }
} 
```

以及 TopologicalSort.cs 的代码

```
class TopologicalSorter
{
    #region - Private Members -

    private readonly int[] _vertices; // list of vertices
    private readonly int[,] _matrix; // adjacency matrix
    private int _numVerts; // current number of vertices
    private readonly int[] _sortedArray;

    #endregion

    #region - CTors -

    public TopologicalSorter(int size)
    {
        _vertices = new int[size];
        _matrix = new int[size, size];
        _numVerts = 0;
        for (int i = 0; i < size; i++)
            for (int j = 0; j < size; j++)
                _matrix[i, j] = 0;
        _sortedArray = new int[size]; // sorted vert labels
    }

    #endregion

    #region - Public Methods -

    public int AddVertex(int vertex)
    {
        _vertices[_numVerts++] = vertex;
        return _numVerts - 1;
    }

    public void AddEdge(int start, int end)
    {
        _matrix[start, end] = 1;
    }

    public int[] Sort() // toplogical sort
    {
        while (_numVerts > 0) // while vertices remain,
        {
            // get a vertex with no successors, or -1
            int currentVertex = noSuccessors();
            if (currentVertex == -1) // must be a cycle                
                throw new Exception("ERROR: Graph has cycles");

            // insert vertex label in sorted array (start at end)
            _sortedArray[_numVerts - 1] = _vertices[currentVertex];

            deleteVertex(currentVertex); // delete vertex
        }

        // vertices all gone; return sortedArray
        return _sortedArray;
    }

    #endregion

    #region - Private Helper Methods -

    // returns vert with no successors (or -1 if no such verts)
    private int noSuccessors()
    {
        for (int row = 0; row < _numVerts; row++)
        {
            bool isEdge = false; // edge from row to column in adjMat
            for (int col = 0; col < _numVerts; col++)
            {
                if (_matrix[row, col] > 0) // if edge to another,
                {
                    isEdge = true;
                    break; // this vertex has a successor try another
                }
            }
            if (!isEdge) // if no edges, has no successors
                return row;
        }
        return -1; // no
    }

    private void deleteVertex(int delVert)
    {
        // if not last vertex, delete from vertexList
        if (delVert != _numVerts - 1)
        {
            for (int j = delVert; j < _numVerts - 1; j++)
                _vertices[j] = _vertices[j + 1];

            for (int row = delVert; row < _numVerts - 1; row++)
                moveRowUp(row, _numVerts);

            for (int col = delVert; col < _numVerts - 1; col++)
                moveColLeft(col, _numVerts - 1);
        }
        _numVerts--; // one less vertex
    }

    private void moveRowUp(int row, int length)
    {
        for (int col = 0; col < length; col++)
            _matrix[row, col] = _matrix[row + 1, col];
    }

    private void moveColLeft(int col, int length)
    {
        for (int row = 0; row < length; row++)
            _matrix[row, col] = _matrix[row, col + 1];
    }

    #endregion
} 
```

……

# iphone - Objective-C 内存管理、xml 解析器和其他重要示例

> ID：546588
> 
>         
> 
> 赞同：7
> 
>         
> 
> 时间：2009-02-13T16:24:14.190
> 
>         
> 
> 标签：iphone, objective-c, memory

我知道 Cocoa 中有关内存管理（保留计数、自动释放池等）的基本原则，但是一旦你超越了简单的保留/释放，它就会变得更加混乱。我找不到合适的答案，因为大多数教程都涵盖了简单的场景。我想询问有关如何编写代码和避免泄漏的最佳实践。

* * *

第一个问题 - 迭代和临时分配：

```
for (id object in objectArray) {    
     Model *currentItem = object;
    /* do something with currentItem */
    [currentItem release];
} 
```

如果我删除最后一行中的版本，代码将正常工作，但有泄漏。这里有什么规则？对象已经存在于 objectArray 中。我直接分配它，以获取类型。我应该以其他方式做到这一点吗？这个分配是否增加了 currentItem 的retainCount？（是不是类似于 [[alloc] initWithObject] ？）如何知道这个分配（对象）是否被自动释放？

* * *

第二个问题 - 即时保留：

```
Model *model = [unarchiver decodeObjectForKey:@"ARCHIVED_MODEL_OBJECT"];
// it has to be here, because (I was told) unarchiver will return autorelease object    
[model retain]; 
label.text = model.data; 
```

有人怎么知道这个特定的方法工作得如此奇怪，以至于我需要立即在返回值上调用 retain，否则我会在下一次赋值时遇到 null？我在文档中找不到类似的东西。根据保留/释放规则，我希望 decodeObjectForKey 返回 autorelased 对象，但是控件返回到应用程序并且池声明要释放模型对象需要一些时间。有什么规则吗？我应该如何搜索这些？

* * *

第三个问题 - 自动释放和传递变量：

```
- (IBAction) loadXMLButtonClicked:(id) sender {
    objectArray = [self loadData]; // 1 - objectArray is instance var
    NSArray *objectArray = [self loadData]; // 2 - objectArray is local var

    // loadXMLButtonClicked is called on button click, here the method finishes
    // and control goes back to application, autorelease pool is cleaned?

    // case 1 - objectArray stays retained in instance variable? (because setter was used)
    // case 2 - objectArray is soon to be released, there were no retains? 
    // (ignore the fact that it's local var, just hypothetically)

}

- (NSArray *) loadData {
    NSArray *objectArray = [[NSArray alloc] init];
    // populate array here
    return [objectArray autorelease];
} 
```

* * *

第4个问题——（忍耐一下，最后一个）parser xml best practice：（我不想用其他解决方案，使用标准解析器就是练习objective-c内存管理和流程）

基本上这里的代码可以工作，工作良好并且没有泄漏，但我真的不知道这是否是正确的方法。我有单独的对象充当解析器，解析 XML 以收集模型类型的对象数组。现在，解析完成后，我想从外部获取该数组，尽管我不知道如何（复制数组并释放整个解析器是个好主意吗？）。请运行代码并查看评论。

我已经多次调试这段代码，`gdb`用于打印retainCounts、zombies等，虽然我可以设法让它运行并且没有泄漏，但我不知道100％为什么并且想听听一个很好的推理应该如何完成解释。那将不胜感激。

**控制器.m**

```
- (NSArray *) loadData {
(...)
NSXMLParser *parser = [[NSXMLParser alloc] initWithData:data];
ModelXMLParser *parserDelegate = [[ModelXMLParser alloc] init];
[parser setDelegate:parserDelegate];
[parser parse];

objectArray = [[parserDelegate objectArray] copy]; 
// is this ok? *i* don't need the parser object so I think I should get rid of it
// and copy the data. How this copy works, is it shallow (only new reference to array)
// or deep copy (objects allocated again as well)?
// how to do deep copy of NSArray?

[parserDelegate release];
[parser release];
} 
```

**ModelXMLParser.m（简化）**

```
@implementation ModelXMLParser

@synthesize objectArray; // array of objects
@synthesize currentObject; // temporary object
@synthesize currentChars; // temporary chars
@synthesize parseChars; // parse chars only when there's need, leave those /t/n etc

- parser didStartElement (...) {
    if ([elementName isEqualToString:@"objects"]) {
        objectArray = [[NSMutableArray alloc] init];
    }
    else if ([elementName isEqualToString:@"object"]) {
        currentObject = [[Model alloc] init];
    }
    else if ([elementName isEqualToString:@"name"]) {
        // do I have to init currentObject.name (NSString) here? I guess not
        [self setParseChars:YES]; // just set the flag to make parse control easier
    }
    else if ([elementName isEqualToString:@"number"]) {
        // int isn't object anyway, no init
        [self setParseChars:YES]; // just set the flag to make parse control easier
    }   
}

- parser foundCharacters (...) {
    if (parseChars) {
        currentChars = [[NSString alloc] initWithString:string];
        // why is currentChars retainCount = 2 here?
        // is it like currentChars = [NSString new] and then currentChars = string? (so retain once more)
        // is it good way to control parser? (please ignore the NSMutableString and appending example, try this one)
        // should I just do currentChars = string here?

        [currentChars autorelease]; // this is currently my solution, because there's no leak, but I feel it's incorrect
    }
}

-  parser didEndElement (...) {
    if ([elementName isEqualToString:@"object"]) {
        [objectArray addObject:[currentObject copy]]; // should I copy here or just addObject, it retains anyway?
        [currentObject release]; // I've initialized currentObject before, now I don't need it, so I guess retainCount goes to 0 here?
    }
    else if ([elementName isEqualToString:@"name"]) {
        currentObject.name = currentChars; // is this correct, or shoud I do [currentChars copy] as well?
        [self setParseChars:NO];
        [currentChars release]; // as before, initialized, now releasing, but is this really correct?
    }
    else if ([elementName isEqualToString:@"number"]) {
        currentObject.number = [currentChars intValue]; // is this correct, or shoud I do [currentChars copy] as well?
        [self setParseChars:NO];
        [currentChars release]; // as before, initialized, now releasing, but is this really correct?
    }   
}

- (void) dealloc {
    // I shouldn't release currentChars or currentObject, those (I suppose) should be freed after parsing done,
    // as a result of earlier releases?

    [objectArray release];
    [super dealloc];
} 
```

**模型.m**

```
@implementation Model

@synthesize name; // this is NSString
@synthesize number; // this is int

- (id) copyWithZone:(NSZone *) zone {
    Model *copy = [[[self class] allocWithZone:zone] init];
    copy.name = [self.name copy];
    copy.number = self.number;
    return copy;
}

- (void) dealloc {
    [name release];
    // I don't have to release int, right? it's not an object
    [super dealloc];
} 
```

我对问题 4 感到特别困惑。抱歉，问题可能太长了，但这确实是关于一个主题和对它的更深入理解。

* * *

## 回答 #1

> 赞同：7
> 
>             
> 
> 时间：2009-02-13T17:13:41.090

# 第一个问题 - 迭代和临时分配

你不应该在这里释放对象，因为你不是所有者。只有当你是它的所有者时，你才应该释放它。请参阅[Cocoa 的内存管理指南](http://developer.apple.com/documentation/Cocoa/Conceptual/MemoryMgmt/MemoryMgmt.html)。如果您调用名称以 、 或包含在其名称中的方法，则您只是对象`init`的`new`所有者`copy`。

由于 for 循环不使用具有任何这些名称的方法，因此您不是所有者，因此您不得释放对象。这将导致在对象完成之前释放它们，这几乎肯定会导致内存损坏和崩溃。

# 第二个问题 - 即时保留：

你不需要*立即*调用retain，你只需要在自动释放池下一次清空之前调用它。这可能会在您的方法返回到主事件循环之后不久。由于您不确切知道何时会发生这种情况，因此您必须确保如果您希望能够在函数（`loadXMLButtonClicked:`在这种情况下）返回后访问该对象，那么您必须`retain`在返回之前访问该对象。

由于它的名称不以名称`decodeObjectForKey`开头`init`或`new`包含`copy`，因此您不会成为所有者。打电话`retain`使您成为所有者。

# 第三个问题 - 自动释放和传递变量：

首先，用同名的局部变量隐藏类成员是不好的做法。其次，除非`loadData`被用作多用途实用程序函数（我猜它不是，因为它不带任何参数），它应该直接将结果分配给成员变量`objectArray`。返回结果然后将调用函数分配给成员变量是没有意义且容易出错的。

第三，您没有使用`objectArray`属性设置器——您只是直接分配给成员变量。如果你想使用setter，你必须明确地说`self.objectArray = ...`（`self.`在它前面）。因此，`objectArray`永远不会保留，因此它将在下次自动释放池清除自身时被释放，这不是您想要的。您必须在某个时候保留它，或者相反，只是不要在 结束时自动释放它`loadData`，并将其分配给类成员变量`objectArray`。

如果属性是用`retain`属性声明的，那么使用 setter 将在您分配时自动调用`retain`（它也将`release`是旧值）。如果改为使用属性声明`copy`属性，则每次分配给它时都会复制该值，并且您将成为新对象的所有者。

# 第 4 个问题 - 解析器 xml 最佳实践：

您正在制作对象数组的浅表副本。如果要进行深层复制，可以使用该[`initWithArray:copyItems:`](http://developer.apple.com/DOCUMENTATION/Cocoa/Reference/Foundation/Classes/NSArray_Class/Reference/Reference.html#//apple_ref/occ/instm/NSArray/initWithArray:copyItems:)消息。

> 我必须在这里初始化 currentObject.name (NSString) 吗？我猜不会？

我不明白这个问题，`currentObject.name`在该代码附近的任何地方都没有提到。

> 为什么 currentChars retainCount = 2 在这里？

可能是因为在它的内部初始化过程中，它在`retain`某个地方被加了一个额外的时间，但几乎可以肯定它也是`autoreleased`一个额外的时间。如果您遵循 Cocoa 内存管理指南中的所有规则，您将不会遇到任何问题。你永远不应该依赖保留计数，因为你不知道一个对象被自动释放了多少次。它们是调试辅助工具，而不是应该用于程序控制流的东西。

> 这是目前我的解决方案，因为没有泄漏，但我觉得它不正确？

`currentChars`如果下次返回事件循环时不需要使用，那就没问题了。如果你需要使用它，你不应该在这里释放或自动释放它，然后当你确定你完成它时释放它。

> 我应该在这里复制还是只添加对象，它仍然保留？

Just `addObject`：当您将项目添加到`NSArray`,`NSSet`或`NSDictionary`时，它们会自动`retain`由数据结构编辑。当您删除它们时，它们是`release`d。

其余的大部分问题都可以通过遵循规则来回答，或者对我已经回答过的一些以前的问题有相同的答案。

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2009-02-13T16:34:39.330

@第一个问题

您只能获得对 objectArray 中对象的引用。它仍然在 objectArray 中，它也保留了对象，并且在这里释放它并不好，因为您没有做任何保留它的事情。

请参阅此处了解一些[规则](http://www.stepwise.com/Articles/Technical/2001-03-11.01.html)

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2009-02-13T16:45:18.400

@第二个问题

看起来您正在设置 UILabel 文本属性，在这种情况下使用*copy*。在文档中它说：

```
@property(nonatomic, copy) NSString *text; 
```

这意味着标签将复制并保留该副本，而不更改或保留用于分配属性的对象。

* * *

## 回答 #4

> 赞同：0
> 
>             
> 
> 时间：2009-02-13T16:50:44.313

@第三个问题

" `objectArray = [self loadData]; // 1 - objectArray is instance var`" 行并不是真正的 setter，因为它直接访问实例变量。要使用 setter，需要通过*self访问它*

```
self.objectArray = [self loadData]; 
```

...并且如果您的属性被声明为`(nonatomic, copy)`旧的 objectArray 将被释放，并且将使用副本创建一个新的，从而被保留。

* * *

## 回答 #5

> 赞同：0
> 
>             
> 
> 时间：2009-02-16T12:55:26.060

感谢大家的回答。这些答案有所帮助，尽管仅在少数地方，其余的我必须自己弄清楚。我更关注这个想法，而不是逐行实现，但是如果不粘贴大量代码，很难在这里描述。只是用于 xml 对象解析的委托是一个非常具体的示例，因为它本身不返回值，必须在外部获取和分配该值。

我将亚当的答案标记为最好的，最详细的，即使没有回答我所有的问题。

对于其他人 - [http://developer.apple.com/documentation/Cocoa/Conceptual/MemoryMgmt/MemoryMgmt.html](http://developer.apple.com/documentation/Cocoa/Conceptual/MemoryMgmt/MemoryMgmt.html)是一本极好的读物。另请阅读我自己对问题的回答：

1 - 当然我不应该释放那个对象。内存泄漏不是由此引起的。

2 - 这个方法没什么特别的，它只是返回普通的自动释放对象，正如其他人试图在这里向我解释的那样。我最初的麻烦的根源是我以前没有那个保留，但很快就调用了[模型释放]，导致自动释放池将释放发送到不存在的对象。我不应该做[模型发布]，因为我不是那个对象的所有者。事实上，这里甚至不需要这个retain，因为我只需要对象从中获取值，然后我可以对其进行thrash，因此它可以安全地传递给autorelease pool，而不需要retain。

3 - 我希望这个方法（loadData）是独立的，因此不设置任何实例变量，而是为其他人返回数组。这是一个平行的例子，并不是我在方法中有两个同名的变量。

如果我在此方法中声明对象（情况＃2），那么恰好它在此方法结束时自动释放，因为在它完成后，控件将返回到应用程序并启动释放池。我没问题在这个例子中，因为我以后不需要这个数组。在现实世界中，我可能应该有实例变量（情况 #1），然后使用 self.objectArray = [self loadData]，因为这将启动 setter，并且自动释放的对象将在这里为我保留。

4 - 我在这里混淆了几件事。基本上我试图用手动内存管理在 objecive-c 中编码，但仍然有“垃圾收集器”的态度。非常重要的是要记住，如果您执行 [[object alloc] init]，然后在稍后执行 [object release] - 对象不会自动被销毁！释放不是无效的！这当然是一个基本规则（保留/释放），但即使知道它，也很容易忘记。在这两行之间跟踪您对对象所做的事情 - 该对象实际上可能会在很长一段时间之后存在，因为“其他人”将成为它的所有者。此类生命周期结束时的释放方法并不意味着 - 对象现在被销毁，而是意味着：“我不再关心，我的手很干净”

所以，逐行：

```
objectArray = [[parserDelegate objectArray] copy]; 
```

这很好，我不深拷贝。我正在复制一个数组，这意味着它为数组对象分配新内存，但不为内容分配。但是，发送到 objectArray 的副本也会将保留发送到每个对象。在我的示例中，我发布了我的 parserDelegate，它也发布了自己的 objectArray，减少了每个对象的 retainCount。如果我不在这里进行复制，对象将达到 retainCount = 0 并被销毁。这样我就有了新数组，带有指向旧对象的指针，但它们本质上成为了我的对象，因为以前的数组被破坏了，并且由于我的保留，我成为了所有者。抱歉，如果这话有点过分，但我真的必须集中精力才能理解这一点。

```
else if ([elementName isEqualToString:@"name"]) {
    // do i have to init currentObject.name (NSString) here? i guess not?
    [self setParseChars:YES]; // just set the flag to make parse control easier
} 
```

这里的问题是，我是否应该初始化 currentObject.name NSString 属性，因为它会在 foundCharacters 启动后很快被填充。现在这很有趣。当你初始化整个对象时，它的 NSString 属性是 nil。现在，以后，我做

```
currentObject.name = currentChars; 
```

哪个启动二传手。这个setter定义为(nonatomic,retain)，表示保留新值，释放旧值，分配指针。有趣的是，之前的值是初始化还是 nil 都没有关系 - 如果它被初始化，无论如何都会被释放，如果它是 nil，那么 nil 仍然可以接受释放（尽管我不是 100% 确定它?) - 什么都不会发生。但为了正确起见，我猜最初的行应该是这样的：

```
else if ([elementName isEqualToString:@"name"]) {
    currentObject.name = [NSString new]; // just alloc/init routine
    [self setParseChars:YES]; // just set the flag to make parse control easier
} 
```

现在 ：

```
[currentChars autorelease]; 
```

不应该在那里。这是一个令人困惑的设计，而且是一个糟糕的修复。它应该在那里，只是字符串初始化。

```
[objectArray addObject:[currentObject copy]]; 
```

这里不需要复制。addObject 无论如何都会保留。创建另一个分配没有意义。这是我泄漏的原因之一。

其他一切都很好。因为我在为我的对象设置值后立即释放 currentChars，所以他现在保留它并成为所有者，我只是在解析器中“这里”释放它，因为我不再需要它（它将是在下一个循环中分配）。

这可能会令人困惑，但我可以想象，会有其他人遇到非标准的内存分配问题，即使对于有经验的人来说，把东西放在正确的地方也可能是一个挑战。也许我的故事会有所帮助。

* * *

## 回答 #6

> 赞同：0
> 
>             
> 
> 时间：2009-10-02T18:08:02.187

**静态分析器**

除了：[《Cocoa 内存管理编程指南》](http://developer.apple.com/documentation/Cocoa/Conceptual/MemoryMgmt/Tasks/MemoryManagementRules.html)之外，Static Analyzer 也是不可或缺的工具。

项目->项目设置->构建->构建选项->运行静态分析器

确保它已打勾。

它会告诉你你正在做的所有内存分配错误。因此，您将更好地理解如何创建对象、双重自动释放错误、双重释放错误、引用释放对象等。

我读了很多遍内存管理原理，直到我使用了静态分析器才明白。

现在我在这方面做得更好，并且大部分时间都做对了。然而，静态分析器仍然是必不可少的，因为它会指出错误和遗漏的错误。

阳一

# c# - 搜索、过滤和删除列表
>

> ID：546590
> 
>         
> 
> 赞同：1
> 
>         
> 
> 时间：2009-02-13T16:25:09.647
> 
>         
> 
> 标签：c#, linq, generics, list

我有问题！

我有一个

```
List <List<Class>> L = new List<List<Class>>(); 
```

其中类包含

```
IDLinea
Posizione 
```

等等...

我想要一个 Distinct `List<List<Class>>`where 没有具有相同线条的对象。

例如：

```
List <List<Class>> L = new List<List<Class>>();

var A = new List<Class>();

Class C = new Class();
C.IDLinea = 1;
C.Posizione = 5;

A.Add(C);

C = new Class();
C.IDLinea = 2;
C.Posizione = 1;

A.Add(C);

L.Add(A);

var B = new List <Class>();

C = new Class();
C.IDLinea = 1;
C.Posizione = 3;

B.Add(C);

C = new Class();
C.IDLinea = 2;
C.Posizione = 1;

B.Add(C);

L.Add(B);

var D = new List <Class>();

C = new Class();
C.IDLinea = 4;
C.Posizione = 1;

D.Add(C);

C = new Class();
C.IDLinea = 2;
C.Posizione = 4;

D.Add(C);

L.Add(D); 
```

所以我想要**A和D**

我希望我需要的是清楚的。

谢谢。

* * *

## 回答 #1

> 赞同：3
> 
>             
> 
> 时间：2009-02-13T17:28:06.767

根据您的进一步解释进行编辑    

```
enum LineComparisonMode
{
   ///<summary>the order of the line numbers matters, default</summary>
   Ordered = 0, 
   ///<summary>the order of the line numbers doesn't matter
   /// Has a higher cost to the default.
   ///</summary>
   Unordered = 1,
} 

class ListLineComparer : IEqualityComparer<List<Class>>
{
    class LineComparer : IEqualityComparer<Class>
    {
        public bool Equals(Class x, Class y)
        {
            return x.IDLinea == y.IDLinea;
        }

        public int GetHashCode(Class x)
        {
            return x.IDLinea;
        }
    }

    private readonly LineComparer lines;
    private readonly LineComparisonMode mode;

    public ListLineComparer() {}

    public ListLineComparer(LineComparisonMode mode)
    { 
        this.mode = mode;
    }

    public bool Equals(List<Class> x, List<Class> y)
    {
        if (mode == LineComparisonMode.Ordered)
            return x.SequenceEqual(y, lines);
        else
            return x.OrderBy<Class, int>(Line).SequenceEqual(y.OrderBy<Class, int>(Line), lines);
    }

    private static int Line(Class c)
    {
        return c.IDLinea;
    }

    public int GetHashCode(List<Class> x)
    {
        //this is not a good hash (though correct) 
        // but not relevant to current question
        return x.Sum(c => c.IDLinea);
    }
}

// assume List <List<Class>> L = new List<List<Class>>(); from question
var result = L.Distinct(new ListLineComparer()); 
```

结果以 IList of IList of Class 的形式而不是 Lists 希望这是可以接受的。如果不是，您将自己构建列表，而不是让 Linq 处理它。如果您想让行 {1,2,3} 被视为等于 {3,2,1}，那么您需要设置模式。

```
var result = L.Distinct(new ListLineComparer(LineComparisonMode.Unordered)); 
```

This is all a little more verbose that I would have done it myself but makes it clear what is going on/what assumptions are being made so it is simple to change (if say the column position becomes involved later).

* * *

## 回答 #2

> 赞同：0
> 
>             
> 
> 时间：2009-02-13T16:35:39.717

1.  使用列表

2.  让你的班级超越平等。

3.  使用列表的 Contains 方法。

# smalltalk - Smalltalk Web 应用程序开发环境从头开始？

> ID：546592
> 
>         
> 
> 赞同：6
> 
>         
> 
> 时间：2009-02-13T16:25:29.303
> 
>         
> 
> 标签：smalltalk

我正在努力在 Windows 上从头开始设置 Smalltalk Web 应用程序环境。这些是我正在寻找的功能：

*   更喜欢 Squeak 或免费的 ST 环境。必须在windows上稳定工作

*   Seaside 是首选框架

*   MySQL 或 SQLite 作为数据库

*   不错的 HTML 模板或前端技术 ala CL-WHO

我真的很喜欢这种语言，但我很难找到一个详细的教程，让新手开始在 Smalltalk 上使用 Web 应用程序开发。Django 和 Rails 在这方面都做了很多很好的工作……即使是 Lispers 也有一些不错的新手教程。  

* * *

## 回答 #1

> 赞同：8
> 
>             
> 
> 时间：2009-02-14T15:28:06.390

如果不需要现有环境或外部系统集成，我也不会使用 RDBMS。一个非常好的和强大的环境是 GLASS，它对非商业应用程序是免费的。GLASS 代表 Gemstone/S、Linux、Apache、Squeak 和 Seaside。目前，该团队还在使用 Pharo，这是 Squeak 的一个非常有前途的衍生产品。

Gemstone 的强大之处在于，它不仅是一个 ODBMS - 没有范式中断，没有对象和表之间的映射。它也是运行应用程序的 VM，因此在运行 Seaside 以生成和处理前端的系统与运行应用程序逻辑的后端之间没有不必要的分配。这是非常强大的。此外，宝石不仅限于一个核心。但是你必须付钱。最大数据库大小为 8192 TB。*G*

为了快速入门，有一个 VMware 虚拟设备。

缪

* * *

## 回答 #2

> 赞同：4
> 
>             
> 
> 时间：2009-02-13T17:53:37.500

尝试按照[Aida/Web 框架的](http://www.aidaweb.si)[教程](http://www.aidaweb.si/tutorial.html)进行第一步。关于持久性，我会暂时跳过关系数据库，因为单独使用 Squeak 图像可以用作数据库。

关于模板，Smalltalk Web 框架跳过了模板，更喜欢 Web 编程而不是可重用的组件。这样你就一直只在 Smalltalk 中编程，根本看不到 HTML。另一方面，样式是使用 CSS 完成的，它与 Web 代码很好地分离。

# c++ - 在 3D 空间中表示节点的最佳数据结构是什么？

> ID：546596
> 
>         
> 
> 赞同：1
> 
>         
> 
> 时间：2009-02-13T16:26:05.120
> 
>         
> 
> 标签：c++, data-structures, stl, map

...感谢阅读...

我仍在学习绳索，所以请原谅... ;-)

我正在编写一个在空间中网格化实体的函数。网格是通过使用“节点”类的对象完成的，每个节点由以下形式表示：

```
int id
double p
double r 
```

最初我认为映射是要走的路：使用映射我可以在“id”键和第二个键（指向节点对象的指针）之间建立关联。

像这样的东西：

```
int nodeId;
Node *node;
std::map<int, Node *> NodeMap; 
```

然后，当我创建节点时，我只需调用“新”运算符。例如，在 for 循环中，我执行以下操作：

```
node = new Node(i); // the node constructor sets the id to the value of i. 
```

我将新节点添加到地图中：

```
NodeMap[i] = node; 
```

但是....我意识到我需要在地图中进行查找，而不是通过第一个键（id）而是通过 p 和 r 参数（节点的坐标）。

换句话说，我需要在给定 p 和 r 值的情况下返回节点 id 的东西。如果使用整数第一个键 (id) 完成查找，则映射是一个完美的容器。有人对如何解决这个特定问题有建议吗？

非常感谢！副总裁。

* * *

## 回答 #1

> 赞同：6
> 
>             
> 
> 时间：2009-02-13T16:32:44.450

与任何“我应该用什么来表示这个结构”问题一样，它确实取决于**你想如何与之交互**

场景图在 3D 库中很常见，它们提供基于树的节点遍历，通常允许变换、交互和其他属性沿树级联。

对于保存要渲染的对象的东西，一个通用结构是[二进制空间分区树](http://en.wikipedia.org/wiki/Binary_space_partitioning)，它允许有效剔除绝对不可见或被其他对象遮挡的对象。

编辑; 我错过了您正在按浮点进行索引。这通常是一个坏主意（因为大多数标准地图所要求的准确性会导致与浮点行为的不稳定性有关的问题）。除非你**真的**想要这种行为

在这种情况下，您需要有某种处理方式，例如：

*   对您的域进行分块，以便您可以准确地指向其中的一小部分，并防止多个节点占用同一块空间。

*   有一些方法来划分你的空间（可能需要对节点集中度较高的区域进行自适应细分），以便在请求点 p,r 时，你会得到该区域中存在的一组（可能是空的）节点。

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2009-02-13T16:37:45.763

你看过可用的几何库吗，我不是这个领域的专家，最近在 boost 邮件列表的预览中听说了[GTL 。](http://www.icg.tugraz.at/Members/breiting/gtl/)

* * *

## 回答 #3

> 赞同：1
> 
>             
> 
> 时间：2009-02-13T16:44:29.507

与查找问题无关，而是与您`Nodes`使用`new`. 如果地图拥有节点，就像您的情况一样，您可以简单地说：

```
map <int, Node> mymap;     // map of Nodes, not pointers to Nodes
...
myMap[i] = Node( whatever ); 
```

这将大大简化您的内存管理。在 C++ 中，您应该尽可能避免显式动态内存分配`new`。

* * *

## 回答 #4

> 赞同：0
> 
>             
> 
> 时间：2009-02-13T16:40:53.760

你到底想做什么？

如果您有 2 个坐标代表 3d 位置，那么我假设它们是某些参数化函数的输入，该函数会产生 3 个顶点分量……如果是这种情况，那么节点实际上是做什么用的？在大多数情况下，这种参数化可用于直接生成网格。

作为一个例子，考虑一个单位球体，它接受参数 u,v (0...2PI) 和 (0...PI) 并通过执行以下操作将它们转换为坐标：

```
x = sin(u)*cos(v);
y = sin(u)*sin(v);
z = cos(u); 
```

这可用于通过在适当范围内改变 u 和 v 并合并任何重复的顶点来创建网格。例如，取 u = 0、u = 0.1、v = 0 和 v = 0.1，您可以创建四个顶点 V(u,v)，从而可以创建两个三角形。由于我假装这是一般情况而不是特殊情况，因此您必须执行诸如检查顶点是否重复并合并它们以及检查退化三角形并删除它们之类的操作。

* * *

## 回答 #5

> 赞同：0
> 
>             
> 
> 时间：2009-02-13T16:46:29.643

地图<> 不起作用。C++ 关联容器在键相等的基础上工作，比较浮点数的相等性根本不起作用。

听起来你需要找到一个节点，给定 x 和 y。最好的方法将取决于您要完成的工作。您是要在给定坐标的情况下找到最近的节点，还是要计算非常接近节点的坐标，然后您需要找到该节点？

对于第二个，您可能会很好地在 x 或 y 坐标（我假设 x）上对节点进行排序，并进行二进制搜索以查找哪些节点的 x 坐标非常接近给定的 x。这通常会选择少量节点，这些节点可以搜索到近似正确的 y。

（当然，如果节点位于某种可预测的网格中，您应该能够提供一些直接计算的方法，例如如果您有整数格点，则将 x 和 y 舍入到最接近的整数。）

如果您需要找到最近的节点，那会有点复杂。我对此知之甚少，无法提供太大帮助，但有几何算法的资源。

* * *

## 回答 #6

> 赞同：0
> 
>             
> 
> 时间：2009-02-13T16:51:15.670

杰里科一针见血。我正在使用两个参数来生成 3D 网格。这两个参数是柱坐标。一个是角度，第二个是沿轴的 z。半径是一个常数，就像他的球体示例一样。我可以创建一个网格，但我需要更新它，并且执行更新的函数不会将 id 作为输入参数。它通过使用这些参数 p 和 r 来获取“原始位置”。

# iphone - 发布时您为什么 iPhone OS 构建？

> ID：546606
> 
>         
> 
> 赞同：4
> 
>         
> 
> 时间：2009-02-13T16:28:35.803
> 
>         
> 
> 标签：iphone

目前有3个选项。2.0、2.1、2.2。我的应用程序只需要 2.0\. 我是为 2.0 还是 2.2 构建？什么是最好的选择？

* * *

## 回答 #1

> 赞同：2
> 
>             
> 
> 时间：2009-02-13T17:30:08.120

始终最好为您的测试允许的最低公分母构建。

如果您可以在 2.0、2.1 和 2.2 上进行测试，那么您将通过这种方式接触到最多的人。如果您只能在一个版本上进行测试，您应该使用覆盖最多人的版本——考虑到 Apple 的激进升级机制，可能是最新版本。

What you should not do (as Hunter implies) is build for one release and assume it will work on others.

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2009-02-13T17:01:56.580

我会为 2.0 构建，假设你会以这种方式获得更多的观众，因为你也会抓住那些由于各种原因无法更新操作系统的人......

* * *

## 回答 #3

> 赞同：1
> 
>             
> 
> 时间：2009-02-13T17:10:11.567

构建应用程序需要运行的最低操作系统版本。如果您没有使用 2.1 或 2.2 中引入的任何内容，请为 2.0 构建。

请记住，虽然大多数 iPhone 用户会在同步时自动更新他们的操作系统，而 iTunes 会告诉他们这样做，但 iPod Touch 用户必须支付费用并且可能不愿意升级。

限制您的潜在客户群没有任何意义，因此请尽可能选择最旧的操作系统版本。

* * *

## 回答 #4

> 赞同：0
> 
>             
> 
> 时间：2009-02-13T17:24:02.237

我同意您应该仔细考虑为最可能的人构建，但是如果您构建 2.1 然后在 2.2 或 2.2.1 上运行，则有些事情不会完全正确。

我能想到的最大的例子：

如果您使用带有居中文本的分组表并为 2.1 构建，它将在 2.2 和 2.2.1 上左对齐。我就这个问题提交了雷达。

基本上，请确保您测试尽可能多的组合 - 存在类似的微妙问题。

# c# - 将逻辑放在生成的 LinqToSql 字段后面

> ID：546608
> 
>         
> 
> 赞同：1
> 
>         
> 
> 时间：2009-02-13T16:28:46.003
> 
>         
> 
> 标签：c#, linq-to-sql

在我在多个项目中使用的数据库中，有一个字段实际上应该是布尔值，但出于某种原因，没有人可以向我解释在两个表中重复的字段，其中一次是字符（'Y'/'N'）一次是 int (1/0)。当我使用 LinqToSql 生成数据上下文时，这些字段当然会获取这些数据类型。

如果我不必在我的应用程序的其余部分中拖动这种愚蠢的数据类型选择，那就太好了。有没有办法给生成的类一点点逻辑，只返回我

```
return this.equals('Y');
and
return this==1; 
```

最好不必在我的部分课程中创建一个额外的字段。

给生成的字段一个完全不同的名称，只能通过部分类访问，然后使用我在部分类中的自定义逻辑生成具有原始名称的额外字段，这将是一种解决方案。我不知道如何在我生成的类中更改可访问性级别..

有什么建议么？

* * *

## 回答 #1

> 赞同：3
> 
>             
> 
> 时间：2009-02-13T16:35:14.443

在 LINQ-To-Sql 设计器中右键单击并选择属性的“属性”将允许您更改可见性。接下来，您可以在部分类中提供具有所需逻辑的实现。

* * *

## 回答 #2

> 赞同：0
> 
>             
> 
> 时间：2009-02-13T16:34:58.890

只需创建一个属性来将 char 值转换为布尔值，您可以使用它来根据您的布尔输入获取和设置 char 值。

这可以在部分类中完成。

# sql-server - 在 SQL Server 中，按短子字符串排序是否比按整个长字段排序更有效？

> ID：546616
> 
>         
> 
> 赞同：2
> 
>         
> 
> 时间：2009-02-13T16:31:23.313
> 
>         
> 
> 标签：sql-server

考虑以下 SQL Server 2005/2008 查询：

```
Select [UID], [DESC] From SomeTable Order By [Desc]; 
```

如果 Desc 是一个相当长的字段（Varchar(125) 有许多条目 > 70 个字符）并且您不需要严格排序，那么这样做会更有效吗：

```
Select [UID], [DESC] From SomeTable Order By Substring([Desc], 0, 20); 
```

优点是所有比较都很短（最多 20 个字符）。缺点是它会引发 Substring 调用。出于目前的目的，假设您不想在此字段上放置索引，因为这不是主键，并且上述操作相当罕见。你会选择哪个选项？

注2：我在这里问主要是出于好奇。在我的应用程序中，Desc*是*一个索引字段，我没有使用 Substring。但是，我曾短暂考虑过使用 Substring，但突然想到我并不真正知道上述哪种方法更有效。

最后，一个额外的问题：在索引字段上使用 Substring 是否真的会使优化器跳过索引并*真正*减慢速度？如果使用 Substring（即使是零基数），我认为优化器不够聪明，无法使用索引，但我现在有点太忙了，无法测试它。但是，如果您知道不同，请纠正我！

**更新/澄清：**您应该假设 Desc 字段*未*出于原始问题的目的编制索引。如果它被索引，答案很简单。

* * *

## 回答 #1

> 赞同：1
> 
>             
> 
> 时间：2009-02-13T16:36:02.803

你的最后一部分是完全正确的。

至于排序问题，对前 20 个字符的子字符串进行排序是否更快。如果字符串是 30 个字符，答案是否定的，如果是 300 个字符，那么可能是。我不知道边界在哪里。但它会逐个字符地进行排序。如果是 21 个字符，那么没有子字符串的额外开销并让它检查额外的 1 个字符会更快。

你可以做的是有一个进一步的列，它是一个截断的描述，并对此进行排序。

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2009-02-13T16:45:07.103

使用 a`non-clustered index`意味着隐含的`JOIN`。

索引本身不包含非索引值，它只包含对`TABLE`'s 块的引用。

要获取非索引值，您需要扫描索引并在嵌套循环中从这些块中读取。

根据经验，它的成本`INDEX SCAN WITH TABLE LOOKUP`大约是.`10``TABLE SCAN`

如果您需要有序查询的所有结果，尤其是作为暗示 的一部分或更复杂的查询，执行 a并对结果进行排序`nested loops`有时会更有效。`TABLE SCAN`

表只需要排序一次，排序结果将被保留并重复使用。在这种情况下，`SUBSTRING`可能会更有效率。

如果您需要`5%`或更少的有序结果，那么`INDEX SCAN`效率会更高，在这种情况下，您需要对整列进行排序。

此外，索引查找总是响应更快，因为您可以更快地获得第一行。

* * *

## 回答 #3

> 赞同：1
> 
>             
> 
> 时间：2009-02-13T17:19:45.010

您可能需要考虑的是这个。在对字符串进行排序时，假设有良好的优化算法，您不必分析整个字符串来找出哪个字符串先出现。考虑两个字符串

```
F3294r02343232423
B3920490234324234 
```

您只需要分析每个字符的第一个字符，就知道第二个字符串应该排在前面。我不确定这对您的特定数据集有多大影响，但这是您应该考虑的事情。  

作为测试，您可能希望使用完全相同的数据和索引创建表的副本，但将要排序的字段截断为 20 个字符，并查看由于较少的数量而导致速度有任何明显的提高数据。如果性能显着提高，您可能希望使用 Robert 所写的内容，并使用已截断的数据创建第二列，这样您就不必使用 substring 函数。

* * *

## 回答 #4

> 赞同：0
> 
>             
> 
> 时间：2009-02-13T16:36:02.523

我不这么认为。在这种情况下调用该函数会对性能造成最大的损害。是的，函数很可能使优化器避免使用索引。

* * *

## 回答 #5

> 赞同：0
> 
>             
> 
> 时间：2009-02-13T16:36:32.553

您已经说过忽略 [Desc] 已编入索引的事实，但是鉴于您说它已编入索引并假设 [UID] 是 PK 并使用聚集索引，您的查询被 [Desc] 上的索引“覆盖” ]，因此 SQL 将按索引顺序读取记录......所以放置一个 SUBSTRING 将导致它必须采取额外的步骤来按前 20 个字符排序，而它们已经按排序顺序读取

> > 在索引字段上使用 Substring 是否真的会使优化器跳过索引并真正减慢速度

通常是的，如果该字段在 WHERE 子句中。任何应用于 where 子句中的字段的函数都可能导致优化器跳过索引。一般来说。

# debugging - 针对 Grails 运行时环境以交互方式运行代码

> ID：546618
> 
>         
> 
> 赞同：2
> 
>         
> 
> 时间：2009-02-13T16:32:29.413
> 
>         
> 
> 标签：debugging, grails, groovy

我正在编写一些代码来将一些引导数据加载到我的 Grails 应用程序中。我正在尝试创建的类之一无法使用某些东西，因此能够在 grails 运行时环境中交互式地运行该代码将非常方便，我想知道是否有办法做到这一点。  

我知道 Grails 控制台，但这似乎并没有加载我想要与之交互的引导数据。我还在调试时看到了[这个线程](https://stackoverflow.com/questions/536601/what-are-you-favorite-grails-debugging-tricks)- 是否有任何 IDE 允许交互式 shell 进入运行时？似乎[Debug Plugin](http://grails.org/Debug+Plugin)计划提供此功能，但还没有。

我发现[这个脚本](http://naleid.com/blog/2008/03/31/using-gant-to-execute-a-groovy-script-within-the-grails-context-updated/#more-11)允许您从 Grails 上下文执行脚本，但我想要一些更具交互性的东西。  

我在 Grails 1.1 上。  

* * *

## 回答 #1

> 赞同：6
> 
>             
> 
> 时间：2009-02-13T19:18:56.813

使用 Grails 控制台手动运行引导类，然后运行相关代码。  

```
new BootStrap().init() 
```

* * *

## 回答 #2

> 赞同：5
> 
>             
> 
> 时间：2009-07-26T01:43:26.437

终于找到了我需要做的事情！

如果您将以下代码添加到引导程序中：

```
 def init = {servletContext ->
    if (GrailsUtil.environment == GrailsApplication.ENV_DEVELOPMENT) {
      def appCtx = WebApplicationContextUtils.getRequiredWebApplicationContext(servletContext)
      def grailsApp = appCtx.getBean(GrailsApplication.APPLICATION_ID);
      Binding b = new Binding();
      b.setVariable("ctx", appCtx);
      def console = new Console(grailsApp.classLoader, b);
      console.run()
    }   } 
```

当应用程序启动时，它还将打开一个 Groovy 控制台，它允许您以交互方式与域类进行交互。因此，例如，您可以添加一个新对象，然后在 Web 应用程序中查看它。   

* * *

## 回答 #3

> 赞同：4
> 
>             
> 
> 时间：2009-03-05T11:38:22.580

对于 Grails 1.1，有一个基于 Web 的控制台插件，它允许通过 Web 界面对正在运行的 grails 实例执行代码：

[http://grails.org/Console+Plugin](http://grails.org/Console+Plugin)

* * *

## 回答 #4

> 赞同：1
> 
>             
> 
> 时间：2009-10-27T19:16:23.590

我使用想法。我为这种类型的“实验”创建了一个名为 testController 的控制器。这对我来说可以。您可以更新控制器上的代码并使用 IDEA 中的 degub 重新测试并通过 URL 调用控制器，而无需重新部署您的应用程序。

* * *

## 回答 #5

> 赞同：0
> 
>             
> 
> 时间：2010-06-16T19:05:10.527

您可以从 IDE 打开到 Grails 应用程序的调试会话。当您遇到断点时，您可以直接从 IDE 运行任意代码。在 IntelliJ IDEA 中，您可以通过调用 Run -> Evaluate Expression 打开此代码片段评估面板。Eclipse 和 NetBeans 可能具有相同的功能。

* * *

## 回答 #6

> 赞同：0
> 
>             
> 
> 时间：2015-09-14T09:29:54.040

有没有办法针对当前正在运行的应用程序上下文运行一些“命令”文件（可能是测试）？例如 grails run-my-file.groovy 并立即获得结果，而不是等待 grails run-app 所做的所有事情。像 grails 控制台，但在 IDE 中。我的意思是制作文件，右键单击它的运行，它会在当前运行的应用程序上执行。

# php - 我应该如何在 Web 应用程序中实现我的 ACL？

> ID：546621
> 
>         
> 
> 赞同：8
> 
>         
> 
> 时间：2009-02-13T16:34:07.600
> 
>         
> 
> 标签：php, acl, access-control, rights-management

我一直在考虑我即将开始开发的网络应用程序，并想知道我的常用方法是否可以改进。

在我最近的几个应用程序中，我创建了一个角色表（见下文）（例如`CREATE POST`，`EDIT POST`等），每个角色都有一个应用于它们的位域，因此我可以简单地在注册时为用户分配某些权限并稍后检查它们（例如`$user->hasRight(CREATE_POST)`）。

我想知道是否有更好的方法来解决这个问题。当权限没有具体链接到用户时肯定会令人困惑（我可以有一个表，其中每个权限都是一个布尔列，但这听起来只是一个小的改进） - 如果我改变一些会发生什么？

我不打算使用标准库（应用程序本身对我来说是一种学习体验：使用 postgresql、git 等）虽然我很高兴从它们那里获得灵感来构建我自己的——所以如果你觉得有什么特别之处我应该看看请这么说:)

* * *

## 回答 #1

> 赞同：5
> 
>             
> 
> 时间：2009-02-13T17:22:50.587

您可以查看 Spring Security（以前称为 Acegi）的文档，它是一个广泛使用的 Java ACL 框架。

该文档详尽无遗，还描述了机器人身份验证和授权设计中的各种注意事项。即使不使用 Java，它也值得一读。

您可以查看[索引页面](http://static.springframework.org/spring-security/site/reference/html/springsecurity.html)以了解 Acegi 做什么（和不做什么）的概述和印象。您也可以直接跳到[授权概念](http://static.springframework.org/spring-security/site/reference/html/authorization-common.html "授权概念")，甚至是[数据库模式](http://static.springframework.org/spring-security/site/reference/html/appendix-schema.html "数据库模式")。

* * *

## 回答 #2

> 赞同：4
> 
>             
> 
> 时间：2009-02-13T16:44:46.527

这与我在自己的 Web 应用程序中采用的方法基本相同（对我来说已经进行了一些试验和错误）。唯一的区别是，我可能会使用具有不同权限的表作为列，因此如果您以后想添加更多权限，您可以。在整数中使用位将您限制为固定数量的权限，即与整数中的位数一样多。通常这将是 32，我认为这可能就足够了，但我不希望这样限制自己。

对于它的价值，这也是 phpBB 使用的模型（权限作为表格列），如果它对于可以说是最流行的 PHP Web 应用程序来说已经足够好了，那么它可能对你来说已经足够好了 ;-)

* * *

## 回答 #3

> 赞同：1
> 
>             
> 
> 时间：2009-02-13T16:47:18.410

我确定您已经找到了 phpgacl，但如果您还没有的话，这里有一个链接。一开始可能有点粗略，当然这个库在项目中实现起来很棘手（耗时），但文档和演示是优秀的参考点。

[PHP 通用访问控制列表](http://phpgacl.sourceforge.net/)

* * *

## 回答 #4

> 赞同：1
> 
>             
> 
> 时间：2009-06-19T19:29:00.903

一般来说，Web 应用程序中的 ACL 方法已经讨论过，例如[这里](http://www.codeproject.com/KB/web-security/objectlevelsecurity.aspx)。

# windows - 如何将程序添加到“执行”列表

> ID：546623
> 
>         
> 
> 赞同：0
> 
>         
> 
> 时间：2009-02-13T16:34:48.970
> 
>         
> 
> 标签：windows, cmd

我真的不知道怎么说，可能这就是我在谷歌上没有找到解决方案的原因。我的问题很简单。我想通过输入他们的名字而不是路径来从执行命令运行程序。例如键入“myprog”打开“c:/program/myprog.exe”就是这样！谢谢你的帮助 ：）

* * *

## 回答 #1

> 赞同：2
> 
>             
> 
> 时间：2009-02-13T16:38:59.677

1.  右键单击**我的电脑**

2.  选择**属性**

3.  单击**高级**选项卡

4.  单击**环境变量**

5.  从*系统变量*窗格中选择**路径，然后单击****编辑**
 ****   附加文本**“;C:\path\to\folder\contains\your\program”**（带分号）*** 

 **** * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2009-02-13T16:37:36.653

你必须设置 PATH = c:\program

在 XP 中，您可以从 SYSTEM > ADVANCED > Environment Variables

添加路径到 Path 变量（用分号分隔。）

* * *

## 回答 #3

> 赞同：1
> 
>             
> 
> 时间：2009-02-13T16:38:59.757

与编程无关。. . 但[请看这里](http://www.computerhope.com/issues/ch000549.htm)

> 在桌面上，右键单击我的电脑，然后单击属性。在“系统属性”窗口中，单击“高级”选项卡。在高级部分中，单击环境变量按钮。最后，在环境变量窗口中，突出显示系统变量部分中的路径变量，然后单击编辑。使用您希望计算机访问的路径添加或修改路径行。每个不同的目录用分号分隔，如下所示。

* * *

## 回答 #4

> 赞同：1
> 
>             
> 
> 时间：2009-02-13T16:40:13.030

右键单击“我的电脑”并选择属性。

转到高级选项卡 => 环境变量。

您会注意到只有您的用户帐户和整个系统都有变量。假设您只想在您的帐户中使用此功能....

编辑 PATH 变量......那里应该已经有诸如 Java 之类的条目。

在条目的末尾，添加分号和您希望从命令行运行的可执行文件的目录路径，在本例中为 c:/program/

下次打开 cmd 时，该命令将运行。

* * *

## 回答 #5

> 赞同：0
> 
>             
> 
> 时间：2009-02-13T16:37:31.600

您必须将 c:\program 放在您的路径中。你没有说你在什么操作系统上，但这就是你在 XP 中必须做的事情

* * *

## 回答 #6

> 赞同：0
> 
>             
> 
> 时间：2009-02-13T16:37:44.733

您所要求的应该可以工作，因为此功能是由您的操作系统提供的。

确保存储程序的路径位于 PATH 环境变量中，并且 windows 的名称中不需要 .exe。因此，如果您的 $PATH 变量中包含 C:/Program，则键入 myprog 应该使其运行。

打开 cmd.exe 并键入路径以检查在哪些目录中搜索程序。所有目录都是操作系统尝试查找您的程序的地方。

* * *

## 回答 #7

> 赞同：0
> 
>             
> 
> 时间：2009-02-13T16:37:59.570

将您的路径变量设置为它存在的目录，您将全部设置好

设置 windows 路径变量：
 [http ://www.cs.usask.ca/~wew036/latex/env.html](http://www.cs.usask.ca/~wew036/latex/env.html)

* * *

## 回答 #8

> 赞同：0
> 
>             
> 
> 时间：2009-02-13T16:41:38.733

如果您不想搞砸您的路径语句，您还可以将程序的快捷方式放入路径中已经存在的文件夹之一中。

快捷键也很方便...我使用 Ctrl-Alt-C 用于计算器，Ctrl-Alt-Q 用于 SQL Management Studio 等。它们可以设置为任何快捷方式（如开始菜单中的快捷方式）

# javascript - Javascript 域模型对象的约定

> ID：546624
> 
>         
> 
> 赞同：4
> 
>         
> 
> 时间：2009-02-13T16:34:50.840
> 
>         
> 
> 标签：javascript, design-patterns, domain-driven-design

如果我必须在 C# 中创建域模型对象，我可能会执行以下操作：

```
public class Person
{
    Public string Name { get; set; }
    Public string Gender { get; set; }
    Public int Age { get; set; }
} 
```

在 Javascript 中，定义此类对象的约定是什么？我在想这样的事情：

```
NAMESPACE.Person = function() {
    this.name = "";
    this.gender = "";
    this.age = 0;
} 
```

* * *

## 回答 #1

> 赞同：3
> 
>             
> 
> 时间：2009-02-13T16:52:14.357

是的，基本到位。唯一要添加的是您应该**使用原型方法**。您的原型如何与设计有关，我通常更喜欢在课堂内部执行此操作，但已标记为仅在需要时运行，并且仅运行一次。

```
NAMESPACE.Person = function() {
    this.name = "";
    this.gender = "";
    this.age = 0;

    if(!NAMESPACE.Person._prototyped)
    {
        NAMESPACE.Person.prototype.MethodA = function () {};
        NAMESPACE.Person.prototype.MethodB = function () {};
        NAMESPACE.Person.prototype.MethodC = function () {};

        NAMESPACE.Person._prototyped = true; 
    }
} 
```

解释原因：原因是性能和继承。原型属性直接与类（函数）对象而不是实例相关联，因此它们可以单独从函数引用中遍历。而且因为它们在类上，所以只需要存在一个对象，而不是每个实例一个。

* * *

## 回答 #2

> 赞同：0
> 
>             
> 
> 时间：2009-02-13T16:51:50.473

我认为没有太多的“约定”，但您可以声明“私有”变量，Crockford 向您展示如何在[这里](http://www.crockford.com/javascript/private.html)

> ```
>  function Constructor(...) { var that =
> this; var membername = value; function
> membername(...) {...}
> 
> } 
> ```
> 
>   
>   
> 
> 注意：函数语句
> 
> ```
>  function membername(...) {...} 
> ```
> 
>   
>   
> 
> 是简写
> 
> ```
>  var membername = function
> membername(...) {...}; 
> ```

为了完善答案，你会这样做，你会注意到我做的有点不同

```
 // class
function Person()
{
    // private variable
    var name = "Default Value";

    // getter
    this.getName = function()
    {
        return name;
    }

    // setter
    this.setName = function(s)
    {
        name = s;
    }
}

// instanciate an object
var p = new Person();

// alerts: Default Value
alert(p.getName());

p.setName("def");

// alerts: def
alert(p.getName());

// alerts: undefined
alert(p.name); 
```

# php - 计算出当月第四个星期六的日期

> ID：546634
> 
>         
> 
> 赞同：5
> 
>         
> 
> 时间：2009-02-13T16:36:43.350
> 
>         
> 
> 标签：php, datetime, date

有点坚持如何去做这个。鉴于当前月份，我需要返回每个月第四个星期六的日期。

例如，这个月是 2 月 20 日，下一个月是 3 月 27 日。

谢谢

* * *

## 回答 #1

> 赞同：7
> 
>             
> 
> 时间：2009-02-13T16:47:15.303

我不是 PHP 编码员，但是，似乎 strtotime 是您所追求的。

您可以使用 strtotime("fourth Saturday") 它将返回第 4 个星期六。

查看[`strtotime`](http://php.net/strtotime)文档。

编辑：

只是为了让答案完整，感谢汤姆和保罗迪克森

```
date('dS F',strtotime('Fourth Saturday '.date('F o'))); 
```

* * *

## 回答 #2

> 赞同：7
> 
>             
> 
> 时间：2009-02-13T16:56:41.927

您可以使用[strtotime](http://php.net/strtotime)根据开始日期查找“下一个星期六”。如果该开始日期是最早可能的前一天（21 日）的前一天，我们会得到答案......

```
//required year/month
$yyyymm="2009-01";

//find next saturday after earliest possible date
$t=strtotime("next saturday", strtotime("{$yyyymm}-21"));

//here you go!
echo "4th saturday of $yyyymm is ".strftime("%Y-%m-%d",$t)."\n"; 
```

任何一个月中一天中最早可能的第 4 次重复是第 22 天 (1,8,15,22)，最后可能的第 4 次重复是第 28 天 (7,14,21,28)。

**编辑**：虽然文档中不清楚，但您也可以请求“第四个星期六” - 使用每月的第零天作为基础：

```
$t=strtotime("fourth saturday", strtotime("{$yyyymm}-00")); 
```

或省略基准时间，直接指定月份和年份：

```
$t=strtotime("fourth saturday feb 2009"); 
```

*向 Robin “我不是 PHP 编码员” 致敬，以发现这一点 :)*

* * *

## 回答 #3

> 赞同：3
> 
>             
> 
> 时间：2009-02-13T16:41:19.953

第四个星期六的最早日期是每月的 22 日。所以看看 22 号，看看它是星期几，如果不是星期六，在日期上加一天，然后再次检查，直到找到匹配项（最多检查 6 天）。

* * *

## 回答 #4

> 赞同：2
> 
>             
> 
> 时间：2009-02-13T16:40:17.443

找出每个月的第一个星期六，然后再加上三个星期。

如果您不知道第一个星期六是什么时候（或者更确切地说，不知道与日期名称相对应的具体日期），您可能想查看[Doomsday algorithm](http://en.wikipedia.org/wiki/March_0)，我方便地查看了另一篇带有有点类似的问题。

* * *

## 回答 #5

> 赞同：0
> 
>             
> 
> 时间：2009-02-13T17:16:15.860

```
function fourth_saturday($year, $month)
{
    $info = localtime(mktime(0, 0, 0, $month , 1, $year));
    return 28 - $info[6];
} 
```

* * *

## 回答 #6

> 赞同：-1
> 
>             
> 
> 时间：2009-02-13T16:42:11.760

在 PHP 而不是伪代码中（认为需要 5.2）

```
$date = getdate();
$date-> setDate($date->format('Y'), $date->format('Y'), '1');   // 1st of month.  
while ($date->format('w' != 6)
    $date->modify("+1 day");
$date->modify("+21 day"); // date is now on the fourth saturday 
```

# sql-server-2005 - 安装 Team Foundation Server 2008 SP1 后报表服务器不可用

> ID：546644
> 
>         
> 
> 赞同：0
> 
>         
> 
> 时间：2009-02-13T16:38:36.463
> 
>         
> 
> 标签：sql-server-2005, reporting-services, tfs

我们在 Team Foundation Server 2008 服务器上安装了 SP1。安装后一切似乎都很好，除了 Visual Studio 的团队资源管理器中的报告文件夹上有一个红色的 X。如果我们尝试访问 Reporting Services 网站，我们会收到一条消息，指出“报告服务器不可用”。安装过程中没有错误。

Reporting Services 服务启动良好，并且在事件日志中没有留下任何错误。我们查看了 Reporting Services 配置工具，一切正常。我们尝试重新启动 RS 服务并重新启动机器。同样，没有错误，但仍然没有报告可用性。

我们的数据所在的 SQL Server 实例启动并运行良好，我们可以毫无问题地查询 OLAP 多维数据集和关系端。我们所有的开发人员机器都已经在 VSTS 2008 SP1 上。服务器上未安装 Visual Studio。

我们查看了 RS 文件夹中的日志文件，唯一显示的错误是我们尝试从 IE 访问网站时得到的错误，但似乎没有包含有关根本原因的更多信息。

任何帮助将不胜感激。我会发布我们在这里尝试的其他事情的任何更新。

更新：显示 ReportServer(timestamp).log 文件时出现登录错误。报告服务服务上的登录名不是此错误中显示的登录名，所以我还不确定哪个进程实际上正在尝试建立与数据库的连接。

* * *

## 回答 #1

> 赞同：1
> 
>             
> 
> 时间：2009-02-16T22:28:41.143

我们解决了这个问题。TFS 2008 SP1 安装过程似乎决定更改 Reporting Services 网站的应用程序池的身份设置。为了解决这个问题，我们需要：

*   打开 Internet 信息服务器管理器

*   进入应用程序池

*   右键单击 Reporting Services 应用程序池

*   单击身份选项卡

*   将帐户从 NetworkService 更改为我们的 TFS 域帐户

*   编辑位于“\Program Files\Microsoft SQL Server\MSSQL.1\Reporting”中的 rsreportserver.config

*   将“NT Authority\NetworkService”更改为“OurDomain\TFSDomainAccount”

*   重新启动 IIS

希望这可以节省其他人一些时间。

* * *

## 回答 #2

> 赞同：0
> 
>             
> 
> 时间：2009-02-13T16:48:49.530

检查 IIS 应用程序池。我的感觉是报告服务不能很好地与其他 Web 应用程序配合使用（通常我过去通过为其他应用程序设置一个单独的池来解决这个问题）。

# vbscript - vbscript 中的网页下载自动化

> ID：546645
> 
>         
> 
> 赞同：2
> 
>         
> 
> 时间：2009-02-13T16:38:38.523
> 
>         
> 
> 标签：vbscript

您将如何使用 vbscript 自动登录网站并下载页面？

* * *

## 回答 #1

> 赞同：1
> 
>             
> 
> 时间：2009-02-13T16:46:10.953

使用 MSXML.XMLHTTP 对象首先执行 POST 以登录，然后将 cookie 标头添加到 GET 请求。

* * *

## 回答 #2

> 赞同：0
> 
>             
> 
> 时间：2009-02-13T16:45:01.923

作为一个快速而肮脏的解决方案，您可以使用带有 SendKeys 和 Run 的 Shell 对象，如此[处所示](http://computerperformance.co.uk/ezine/ezine26.htm)。对于那些您无法使用正确的对象或库的情况，这些功能非常强大......

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2011-04-28T10:56:00.540

如果您打开记事本并且不将焦点更改到其他窗口，那么脚本（在链接上给出）可以正常工作。如果你改变上面脚本的焦点是行不通的。

# algorithm - 在有向图中查找所有循环

> ID：546655
> 
>         
> 
> 赞同：217
> 
>         
> 
> 时间：2009-02-13T16:40:27.753
> 
>         
> 
> 标签：algorithm, graph-theory, graph-algorithm

如何从/到给定节点的有向图中找到（迭代）所有循环？

例如，我想要这样的东西：

```
A->B->A
A->B->C->A 
```

但不是：B->C->B

* * *

## 回答 #1

> 赞同：123
> 
>             
> 
> 时间：2010-05-08T15:51:29.547

我在搜索中找到了这个页面，由于循环与强连接组件不同，我继续搜索，最后，我找到了一个有效的算法，它列出了有向图的所有（基本）循环。它来自 Donald B. Johnson，该论文可在以下链接中找到：

[http://www.cs.tufts.edu/comp/150GA/homeworks/hw1/Johnson%2075.PDF](http://www.cs.tufts.edu/comp/150GA/homeworks/hw1/Johnson%2075.PDF)

可以在以下位置找到 java 实现：

[http://normalisiert.de/code/java/elementaryCycles.zip](http://normalisiert.de/code/java/elementaryCycles.zip)

可以在[这里](http://demonstrations.wolfram.com/EnumeratingCyclesOfADirectedGraph/)找到约翰逊算法的*Mathematica*演示，可以从右侧下载实现（[“下载作者代码”](http://demonstrations.wolfram.com/downloadauthornb.cgi?name=EnumeratingCyclesOfADirectedGraph)）。

注意：实际上，有很多算法可以解决这个问题。其中一些列在本文中：

[http://dx.doi.org/10.1137/0205007](http://dx.doi.org/10.1137/0205007)

根据文章，约翰逊的算法是最快的。

* * *

## 回答 #2

> 赞同：40
> 
>             
> 
> 时间：2009-02-14T16:20:16.827

带有回溯的深度优先搜索应该在这里工作。保留一个布尔值数组以跟踪您之前是否访问过某个节点。如果你用完了新的节点（没有碰到你已经去过的节点），那么只需回溯并尝试不同的分支。

如果你有一个邻接表来表示图形，那么 DFS 很容易实现。例如 adj[A] = {B,C} 表示 B 和 C 是 A 的孩子。

例如下面的伪代码。“开始”是您开始的节点。

```
dfs(adj,node,visited):  
  if (visited[node]):  
    if (node == start):  
      "found a path"  
    return;  
  visited[node]=YES;  
  for child in adj[node]:  
    dfs(adj,child,visited)
  visited[node]=NO; 
```

使用起始节点调用上述函数：

```
visited = {}
dfs(adj,start,visited) 
```

* * *

## 回答 #3

> 赞同：26
> 
>             
> 
> 时间：2013-08-15T17:33:50.300

首先 - 你真的不想尝试从字面上找到所有的周期，因为如果有 1，那么这些周期的数量是无限的。例如 ABA、ABABA 等。或者可以将 2 个循环组合成一个类似 8 的循环等，等等……有意义的方法是寻找所有所谓的简单循环——那些不交叉的循环，除了在起点/终点。然后，如果您愿意，您可以生成简单循环的组合。

在有向图中查找所有简单循环的基线算法之一是：对图中的所有简单路径（不与自身交叉的路径）进行深度优先遍历。每次当前节点在堆栈上有后继节点时，都会发现一个简单的循环。它由堆栈上的元素组成，从确定的后继元素开始，到堆栈的顶部结束。所有简单路径的深度优先遍历类似于深度优先搜索，但除了当前在堆栈中的节点之外，您不会将访问的节点标记/记录为停止点。

上面的蛮力算法非常低效，此外还会生成多个循环副本。然而，它是多种实用算法的起点，这些算法应用各种增强功能以​​提高性能并避免循环重复。前段时间我惊讶地发现，这些算法在教科书和网络上并不容易获得。所以我做了一些研究，并在这里的开源 Java 库中实现了 4 个这样的算法和 1 个循环算法：[http](http://code.google.com/p/niographs/) ://code.google.com/p/niographs/ 。

顺便说一句，因为我提到了无向图：这些算法是不同的。构建一棵生成树，然后不属于树的每条边与树中的一些边一起形成一个简单的循环。以这种方式找到的循环形成所谓的循环基础。然后可以通过组合 2 个或更多不同的基本循环来找到所有简单循环。有关更多详细信息，请参见例如：[http](http://dspace.mit.edu/bitstream/handle/1721.1/68106/FTL_R_1982_07.pdf) ://dspace.mit.edu/bitstream/handle/1721.1/68106/FTL_R_1982_07.pdf 。

* * *

## 回答 #4

> 赞同：25
> 
>             
> 
> 时间：2015-11-27T11:59:34.743

我发现解决这个问题的最简单的选择是使用名为`networkx`.

它实现了这个问题的最佳答案中提到的约翰逊算法，但执行起来非常简单。

简而言之，您需要以下内容：

```
import networkx as nx
import matplotlib.pyplot as plt

# Create Directed Graph
G=nx.DiGraph()

# Add a list of nodes:
G.add_nodes_from(["a","b","c","d","e"])

# Add a list of edges:
G.add_edges_from([("a","b"),("b","c"), ("c","a"), ("b","d"), ("d","e"), ("e","a")])

#Return a list of cycles described as a list o nodes
list(nx.simple_cycles(G)) 
```

**答案：** [['a', 'b', 'd', 'e'], ['a', 'b', 'c']]

[![在此处输入图像描述](https://i.stack.imgur.com/tXkt2.png)](https://i.stack.imgur.com/tXkt2.png)

* * *

## 回答 #5

> 赞同：6
> 
>             
> 
> 时间：2016-09-15T21:36:21.553

基于 DFS 的带有后边缘的变体确实会找到循环，但在许多情况下它不会是*最小*循环。一般来说，DFS 会给你一个标志，表明存在一个循环，但它还不足以真正找到循环。例如，想象 5 个不同的循环共享两条边。仅使用 DFS（包括回溯变体）没有简单的方法来识别循环。

Johnson 算法确实给出了所有唯一的简单循环，并且具有良好的时间和空间复杂度。

但是，如果您只想找到 MINIMAL 循环（意味着可能有不止一个循环通过任何顶点，我们有兴趣找到最小循环）并且您的图形不是很大，您可以尝试使用下面的简单方法。与约翰逊的相比，它非常简单但相当慢。

因此，找到**MINIMAL**循环的最简单方法之一是使用 Floyd 算法使用邻接矩阵找到所有顶点之间的最小路径。这个算法远没有 Johnson 算法那么最优，但它非常简单，而且它的内部循环非常紧凑，以至于对于较小的图（<=50-100 个节点），使用它绝对是有意义的。如果使用父跟踪，时间复杂度为 O(n^3)，空间复杂度为 O(n^2)，如果不使用，则为 O(1)。首先让我们找到问题的答案是否存在循环。该算法非常简单。下面是 Scala 中的代码片段。

```
 val NO_EDGE = Integer.MAX_VALUE / 2

  def shortestPath(weights: Array[Array[Int]]) = {
    for (k <- weights.indices;
         i <- weights.indices;
         j <- weights.indices) {
      val throughK = weights(i)(k) + weights(k)(j)
      if (throughK < weights(i)(j)) {
        weights(i)(j) = throughK
      }
    }
  } 
```

最初，该算法在加权边图上运行以查找所有节点对之间的所有最短路径（因此使用权重参数）。要使其正常工作，如果节点之间存在有向边，则需要提供 1，否则需要提供 NO_EDGE。算法执行后，可以检查主对角线，如果有小于 NO_EDGE 的值，则该节点参与长度等于该值的循环。同一循环的每个其他节点都将具有相同的值（在主对角线上）。

为了重建循环本身，我们需要使用稍微修改过的带有父跟踪的算法版本。

```
 def shortestPath(weights: Array[Array[Int]], parents: Array[Array[Int]]) = {
    for (k <- weights.indices;
         i <- weights.indices;
         j <- weights.indices) {
      val throughK = weights(i)(k) + weights(k)(j)
      if (throughK < weights(i)(j)) {
        parents(i)(j) = k
        weights(i)(j) = throughK
      }
    }
  } 
```

如果顶点之间存在边，则父矩阵最初应在边单元中包含源顶点索引，否则应包含-1。函数返回后，对于每条边，您都将引用最短路径树中的父节点。然后很容易恢复实际周期。

总而言之，我们有以下程序来查找所有最小周期

```
 val NO_EDGE = Integer.MAX_VALUE / 2;

  def shortestPathWithParentTracking(
         weights: Array[Array[Int]],
         parents: Array[Array[Int]]) = {
    for (k <- weights.indices;
         i <- weights.indices;
         j <- weights.indices) {
      val throughK = weights(i)(k) + weights(k)(j)
      if (throughK < weights(i)(j)) {
        parents(i)(j) = parents(i)(k)
        weights(i)(j) = throughK
      }
    }
  }

  def recoverCycles(
         cycleNodes: Seq[Int], 
         parents: Array[Array[Int]]): Set[Seq[Int]] = {
    val res = new mutable.HashSet[Seq[Int]]()
    for (node <- cycleNodes) {
      var cycle = new mutable.ArrayBuffer[Int]()
      cycle += node
      var other = parents(node)(node)
      do {
        cycle += other
        other = parents(other)(node)
      } while(other != node)
      res += cycle.sorted
    }
    res.toSet
  } 
```

和一个小的主要方法只是为了测试结果

```
 def main(args: Array[String]): Unit = {
    val n = 3
    val weights = Array(Array(NO_EDGE, 1, NO_EDGE), Array(NO_EDGE, NO_EDGE, 1), Array(1, NO_EDGE, NO_EDGE))
    val parents = Array(Array(-1, 1, -1), Array(-1, -1, 2), Array(0, -1, -1))
    shortestPathWithParentTracking(weights, parents)
    val cycleNodes = parents.indices.filter(i => parents(i)(i) < NO_EDGE)
    val cycles: Set[Seq[Int]] = recoverCycles(cycleNodes, parents)
    println("The following minimal cycle found:")
    cycles.foreach(c => println(c.mkString))
    println(s"Total: ${cycles.size} cycle found")
  } 
```

输出是

```
The following minimal cycle found:
012
Total: 1 cycle found 
```

* * *

## 回答 #6

> 赞同：5
> 
>             
> 
> 时间：2015-05-31T03:40:35.817

澄清：

1.  强连通组件将找到其中至少有一个循环的所有子图，而不是图中所有可能的循环。例如，如果您采用所有强连接组件并将它们中的每一个折叠/分组/合并到一个节点（即每个组件一个节点），您将得到一棵没有循环的树（实际上是一个 DAG）。每个组件（基本上是一个包含至少一个循环的子图）内部可以包含更多可能的循环，因此 SCC 不会找到所有可能的循环，它会找到所有可能的组，至少有一个循环，如果你分组他们，那么图形将没有循环。

2.  正如其他人所提到的，要在图中找到*所有*简单的循环，约翰逊的算法是一个候选者。

* * *

## 回答 #7

> 赞同：4
> 
>             
> 
> 时间：2009-02-13T19:18:51.477

我曾经收到过这个作为面试问题的问题，我怀疑这发生在你身上，你来这里寻求帮助。将问题分解为三个问题，它会变得更容易。

1.  你如何确定下一条有效路线

2.  你如何确定一个点是否已被使用

3.  你如何避免再次跨越同一点

问题 1) 使用迭代器模式提供一种迭代路由结果的方法。放置逻辑以获取下一条路线的好地方可能是迭代器的“moveNext”。要找到有效的路线，这取决于您的数据结构。对我来说，这是一个充满有效路线可能性的 sql 表，所以我必须构建一个查询来获取给定源的有效目的地。

问题2）当你找到它们时将每个节点推入一个集合中，这意味着你可以通过询问你正在构建的集合很容易地查看你是否在一个点上“加倍”。  

问题 3）如果在任何时候你看到你正在加倍回来，你可以从集合中弹出东西并“备份”。然后从那时起再次尝试“前进”。

技巧：如果您使用的是 Sql Server 2008，则可以使用一些新的“层次结构”来快速解决这个问题，如果您将数据构建在树中。

* * *

## 回答 #8

> 赞同：3
> 
>             
> 
> 时间：2014-12-02T15:35:41.923

在**无向**图的情况下，最近发表的一篇论文（无向图*中循环和 st 路径的优化列表*）提供了一个渐近最优解。你可以在这里阅读它[http://arxiv.org/abs/1205.2766](http://arxiv.org/abs/1205.2766)或在这里[http://dl.acm.org/citation.cfm?id=2627951](http://dl.acm.org/citation.cfm?id=2627951)
我知道它不能回答你的问题，但因为标题你的问题没有提到方向，它可能对谷歌搜索仍然有用

* * *

## 回答 #9

> 赞同：1
> 
>             
> 
> 时间：2009-02-13T16:47:42.310

从节点 X 开始并检查所有子节点（如果无向，父节点和子节点是等效的）。将这些子节点标记为 X 的子节点。从任何这样的子节点 A 中，将其标记为 A 的子节点 X'，其中 X' 被标记为距离 2 步。）。如果您稍后点击 X 并将其标记为 X'' 的子级，则表示 X 处于 3 节点循环中。回溯到它的父级很容易（因为算法不支持这一点，所以你会找到任何一个有 X' 的父级）。

注意：如果图是无向的或具有任何双向边，则此算法会变得更加复杂，假设您不想在一个循环中遍历同一条边两次。

* * *

## 回答 #10

> 赞同：1
> 
>             
> 
> 时间：2013-03-21T12:47:29.470

如果您想要在图中找到所有基本电路，您可以使用 JAMES C. TIERNAN 的 EC 算法，该算法自 1970 年以来在一篇论文中发现。

我设法在 php 中实现的**非常原始**的EC 算法（希望没有错误如下所示）。如果有的话，它也可以找到循环。此实现中的电路（试图克隆原始电路）是非零元素。这里的零代表不存在（我们知道它是空的）。

除了下面的其他实现，它使算法更加独立，这意味着节点可以从任何地方开始，甚至可以从负数开始，例如 -4、-3、-2、.. 等。

在这两种情况下，都要求节点是连续的。

您可能需要研究原始论文[James C. Tiernan Elementary Circuit Algorithm](http://www.google.com/url?sa=t&rct=j&q=&esrc=s&source=web&cd=2&cad=rja&ved=0CDsQFjAB&url=http://dutta.csc.ncsu.edu/csc791_spring07/wrap/circuits_tiernan.pdf&ei=SP9KUfCAJoexPKqGgfAJ&usg=AFQjCNFF2BsUPy8YMMDR8LmgTnzabkhkCg&sig2=547_AOc63lQws-zmxr3QWQ&bvm=bv.44158598,d.ZWU)

```
<?php
echo  "<pre><br><br>";

$G = array(
        1=>array(1,2,3),
        2=>array(1,2,3),
        3=>array(1,2,3)
);

define('N',key(array_slice($G, -1, 1, true)));
$P = array(1=>0,2=>0,3=>0,4=>0,5=>0);
$H = array(1=>$P, 2=>$P, 3=>$P, 4=>$P, 5=>$P );
$k = 1;
$P[$k] = key($G);
$Circ = array();

#[Path Extension]
EC2_Path_Extension:
foreach($G[$P[$k]] as $j => $child ){
    if( $child>$P[1] and in_array($child, $P)===false and in_array($child, $H[$P[$k]])===false ){
    $k++;
    $P[$k] = $child;
    goto EC2_Path_Extension;
}   }

#[EC3 Circuit Confirmation]
if( in_array($P[1], $G[$P[$k]])===true ){//if PATH[1] is not child of PATH[current] then don't have a cycle
    $Circ[] = $P;
}

#[EC4 Vertex Closure]
if($k===1){
    goto EC5_Advance_Initial_Vertex;
}
//afou den ksana theoreitai einai asfales na svisoume
for( $m=1; $m<=N; $m++){//H[P[k], m] <- O, m = 1, 2, . . . , N
    if( $H[$P[$k-1]][$m]===0 ){
        $H[$P[$k-1]][$m]=$P[$k];
        break(1);
    }
}
for( $m=1; $m<=N; $m++ ){//H[P[k], m] <- O, m = 1, 2, . . . , N
    $H[$P[$k]][$m]=0;
}
$P[$k]=0;
$k--;
goto EC2_Path_Extension;

#[EC5 Advance Initial Vertex]
EC5_Advance_Initial_Vertex:
if($P[1] === N){
    goto EC6_Terminate;
}
$P[1]++;
$k=1;
$H=array(
        1=>array(1=>0,2=>0,3=>0,4=>0,5=>0),
        2=>array(1=>0,2=>0,3=>0,4=>0,5=>0),
        3=>array(1=>0,2=>0,3=>0,4=>0,5=>0),
        4=>array(1=>0,2=>0,3=>0,4=>0,5=>0),
        5=>array(1=>0,2=>0,3=>0,4=>0,5=>0)
);
goto EC2_Path_Extension;

#[EC5 Advance Initial Vertex]
EC6_Terminate:
print_r($Circ);
?> 
```

那么这是另一个实现，更独立于图形，没有 goto 和没有数组值，而是使用数组键，路径，图形和电路存储为数组键（如果你喜欢使用数组值，只需更改所需的行）。示例图从 -4 开始以显示其独立性。

```
<?php

$G = array(
        -4=>array(-4=>true,-3=>true,-2=>true),
        -3=>array(-4=>true,-3=>true,-2=>true),
        -2=>array(-4=>true,-3=>true,-2=>true)
);

$C = array();

EC($G,$C);
echo "<pre>";
print_r($C);
function EC($G, &$C){

    $CNST_not_closed =  false;                          // this flag indicates no closure
    $CNST_closed        = true;                         // this flag indicates closure
    // define the state where there is no closures for some node
    $tmp_first_node  =  key($G);                        // first node = first key
    $tmp_last_node  =   $tmp_first_node-1+count($G);    // last node  = last  key
    $CNST_closure_reset = array();
    for($k=$tmp_first_node; $k<=$tmp_last_node; $k++){
        $CNST_closure_reset[$k] = $CNST_not_closed;
    }
    // define the state where there is no closure for all nodes
    for($k=$tmp_first_node; $k<=$tmp_last_node; $k++){
        $H[$k] = $CNST_closure_reset;   // Key in the closure arrays represent nodes
    }
    unset($tmp_first_node);
    unset($tmp_last_node);

    # Start algorithm
    foreach($G as $init_node => $children){#[Jump to initial node set]
        #[Initial Node Set]
        $P = array();                   // declare at starup, remove the old $init_node from path on loop
        $P[$init_node]=true;            // the first key in P is always the new initial node
        $k=$init_node;                  // update the current node
                                        // On loop H[old_init_node] is not cleared cause is never checked again
        do{#Path 1,3,7,4 jump here to extend father 7
            do{#Path from 1,3,8,5 became 2,4,8,5,6 jump here to extend child 6
                $new_expansion = false;
                foreach( $G[$k] as $child => $foo ){#Consider each child of 7 or 6
                    if( $child>$init_node and isset($P[$child])===false and $H[$k][$child]===$CNST_not_closed ){
                        $P[$child]=true;    // add this child to the path
                        $k = $child;        // update the current node
                        $new_expansion=true;// set the flag for expanding the child of k
                        break(1);           // we are done, one child at a time
            }   }   }while(($new_expansion===true));// Do while a new child has been added to the path

            # If the first node is child of the last we have a circuit
            if( isset($G[$k][$init_node])===true ){
                $C[] = $P;  // Leaving this out of closure will catch loops to
            }

            # Closure
            if($k>$init_node){                  //if k>init_node then alwaya count(P)>1, so proceed to closure
                $new_expansion=true;            // $new_expansion is never true, set true to expand father of k
                unset($P[$k]);                  // remove k from path
                end($P); $k_father = key($P);   // get father of k
                $H[$k_father][$k]=$CNST_closed; // mark k as closed
                $H[$k] = $CNST_closure_reset;   // reset k closure
                $k = $k_father;                 // update k
        }   } while($new_expansion===true);//if we don't wnter the if block m has the old k$k_father_old = $k;
        // Advance Initial Vertex Context
    }//foreach initial

}//function

?> 
```

我已经分析并记录了 EC，但不幸的是，文档是希腊文的。

* * *

## 回答 #11

> 赞同：1
> 
>             
> 
> 时间：2013-12-02T05:37:03.460

查找 DAG 中的所有循环涉及两个步骤（算法）。

第一步是使用 Tarjan 算法找到强连通分量的集合。

1.  从任意顶点开始。

2.  来自该顶点的 DFS。对于每个节点 x，保留两个数字，dfs_index[x] 和 dfs_lowval[x]。dfs_index[x] 存储访问该节点的时间，而 dfs_lowval[x] = min(dfs_low[k]) 其中 k 是 x 的所有子节点，它们不是 dfs 生成树中 x 的直接父节点。

3.  具有相同 dfs_lowval[x] 的所有节点都在同一个强连通分量中。

第二步是在连接的组件中找到循环（路径）。我的建议是使用 Hierholzer 算法的修改版本。

这个想法是：

1.  选择任何起始顶点 v，然后沿着从该顶点开始的边轨迹，直到返回 v。不可能卡在 v 以外的任何顶点，因为所有顶点的度数相等，确保当轨迹进入另一个顶点时顶点 w 必须有一条未使用的边离开 w。这样形成的游览是一个封闭的游览，但可能不会覆盖初始图的所有顶点和边。

2.  只要存在属于当前游览但相邻边不属于游览的顶点 v，则从 v 开始另一条路径，沿着未使用的边直到您返回 v，并将以这种方式形成的游览加入到以前的巡回演出。

以下是带有测试用例的 Java 实现的链接：

[http://stones333.blogspot.com/2013/12/find-cycles-in-directed-graph-dag.html](http://stones333.blogspot.com/2013/12/find-cycles-in-directed-graph-dag.html)

* * *

## 回答 #12

> 赞同：0
> 
>             
> 
> 时间：2010-05-17T13:57:11.547

我偶然发现了以下算法，它似乎比约翰逊的算法更有效（至少对于较大的图表）。但是，与 Tarjan 的算法相比，我不确定它的性能。

此外，到目前为止，我只检查了三角形。如果有兴趣，请参阅 Norishige Chiba 和 Takao Nishizeki 的“Arboricity and Subgraph Listing Algorithms”（[http://dx.doi.org/10.1137/0214017](http://dx.doi.org/10.1137/0214017)）

* * *

## 回答 #13

> 赞同：0
> 
>             
> 
> 时间：2015-05-29T06:00:40.833

从起始节点 s 开始 DFS，在遍历过程中跟踪 DFS 路径，如果在到 s 的路径中找到节点 v 的边，则记录该路径。(v,s) 是 DFS 树中的后沿，因此表示包含 s 的循环。

* * *

## 回答 #14

> 赞同：0
> 
>             
> 
> 时间：2020-04-04T13:11:40.290

二楼答案中伪代码的 DFS c++ 版本：

```
void findCircleUnit(int start, int v, bool* visited, vector<int>& path) {
    if(visited[v]) {
        if(v == start) {
            for(auto c : path)
                cout << c << " ";
            cout << endl;
            return;
        }
        else 
            return;
    }
    visited[v] = true;
    path.push_back(v);
    for(auto i : G[v])
        findCircleUnit(start, i, visited, path);
    visited[v] = false;
    path.pop_back();
} 
```

* * *

## 回答 #15

> 赞同：0
> 
>             
> 
> 时间：2015-08-02T23:33:51.017

关于您关于*Permutation Cycle*的问题，请在此处阅读更多信息：
 [https ://www.codechef.com/problems/PCYCLE](https://www.codechef.com/problems/PCYCLE)

你可以试试这个代码（输入大小和位数）：

```
# include<cstdio>
using namespace std;

int main()
{
    int n;
    scanf("%d",&n);

    int num[1000];
    int visited[1000]={0};
    int vindex[2000];
    for(int i=1;i<=n;i++)
        scanf("%d",&num[i]);

    int t_visited=0;
    int cycles=0;
    int start=0, index;

    while(t_visited < n)
    {
        for(int i=1;i<=n;i++)
        {
            if(visited[i]==0)
            {
                vindex[start]=i;
                visited[i]=1;
                t_visited++;
                index=start;
                break;
            }
        }
        while(true)
        {
            index++;
            vindex[index]=num[vindex[index-1]];

            if(vindex[index]==vindex[start])
                break;
            visited[vindex[index]]=1;
            t_visited++;
        }
        vindex[++index]=0;
        start=index+1;
        cycles++;
    }

    printf("%d\n",cycles,vindex[0]);

    for(int i=0;i<(n+2*cycles);i++)
    {
        if(vindex[i]==0)
            printf("\n");
        else
            printf("%d ",vindex[i]);
    }
} 
```

* * *

## 回答 #16

> 赞同：-1
> 
>             
> 
> 时间：2009-02-15T17:33:18.583

[http://www.me.utexas.edu/~bard/IP/Handouts/cycles.pdf](http://www.me.utexas.edu/~bard/IP/Handouts/cycles.pdf)

* * *

## 回答 #17

> 赞同：-1
> 
>             
> 
> 时间：2021-07-05T15:00:22.343

**CXXGraph库提供了[一](https://github.com/ZigRazor/CXXGraph)**组算法和函数来检测循环。

有关完整的算法解释，请访问[wiki](https://github.com/ZigRazor/CXXGraph/wiki/Algorithm-Explanation)。

# c# - 在 DataTextFormatString 中添加 html

> ID：546660
> 
>         
> 
> 赞同：1
> 
>         
> 
> 时间：2009-02-13T16:41:05.927
> 
>         
> 
> 标签：c#, html, data-binding, string-formatting

我有一个从 LINQ 查询填充的 DropDownList。根据本项目的设计要求，我需要在 DDL 的 ListItem.Text 中附加 4 个“”。

当我像这样手动添加 ListItems 时，它可以工作：

```
<asp:ListItem Value="NULL">&nsbp;&nsbp;&nsbp;&nsbp;Select One</asp:ListItem> 
```

但不是当我 DataBind() 并使用：

```
DataTextFormatString = "&nsbp;&nsbp;&nsbp;&nsbp;{0}"; 
```

任何帮助表示赞赏。

并且：在有人谈论 HTML 代码之前，我不得不称它为“&nsbp;” 因为它不允许我使用非中断空间字符代码。

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
>             
> 
> 时间：2009-02-13T17:48:35.237

```
DropDownList ddl = new DropDownList();
ddl.Items.Add(new ListItem(Server.HtmlDecode("& n b s p;&n b s p ;& n b s p ;&n bs p;abc"), "abc")); 
```

希望这可以帮助 ！

**注意：**删除字符之间的空格..

* * *

## 回答 #2

> 赞同：0
> 
>             
> 
> 时间：2009-02-13T17:23:28.417

我唯一能想到的就是将下拉列表控件子类化并覆盖渲染方法，看看您是否不能规避基本下拉列表控件对其项目集合进行的修剪。

如果子类化工作量太大，则使用一些客户端 Javascript 代码在页面加载时更新这些项目。这对于 JQuery 来说是一件轻而易举的事。我希望这会有所帮助。

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2009-02-13T17:42:41.833

我看过这个，我认为不可能让“开箱即用”下拉列表控件来做你想做的事情。

问题是您绑定到控件的任何文本值都将自动进行 html 编码。这意味着' ' 将始终转换为“&nbsp;”。无论您添加“ ”，都会发生这种情况 在将数据源中的文本值绑定到控件之前或通过 DataTextFormatString 属性。

我希望这样做是为了避免流氓 html 在呈现到页面后破坏控件。

我认为[James](https://stackoverflow.com/questions/546660/adding-html-in-datatextformatstring/546842#546842)对某种自定义控件的建议可能是您获得所需功能的最佳方式。

# c++ - C++代码分析工具

> ID：546669
> 
>         
> 
> 赞同：7
> 
>         
> 
> 时间：2009-02-13T16:41:40.093
> 
>         
> 
> 标签：c++, code-analysis

我目前正在学习 C++，因为我还在学习，所以我一直在犯错误。

对于像 C++ 这样宽松的语言，通常需要很长时间才能准确找出问题所在——因为编译器让我摆脱了很多。我意识到这种灵活性是 C++ 的主要优势之一，但它使学习基本语言变得困难。

是否有一些工具可以用来分析我的代码并根据最佳实践或只是明智的编码提出建议？最好作为 Eclipse 插件或 linux 应用程序。

* * *

## 回答 #1

> 赞同：17
> 
>             
> 
> 时间：2009-02-13T16:44:40.740

启用最大编译器警告（`-Wall`如果您使用的是 Gnu 编译器，这是该选项）。

“Lint”是典型的静态分析工具。

`valgrind`是一个很好的运行时分析器。

* * *

## 回答 #2

> 赞同：6
> 
>             
> 
> 时间：2009-02-13T16:52:16.573

我认为你最好有一些关于良好实践以及它们为什么好的讲座。这应该比代码分析工具（至少在开始时）对您有所帮助。

我建议你阅读[**Effective C++系列**](https://rads.stackoverflow.com/amzn/click/com/0201924889)***和 ****至少**[有效的 STL书籍。](https://rads.stackoverflow.com/amzn/click/com/0201749629)**另请参阅[权威 C++ 书籍指南和列表](https://stackoverflow.com/questions/388242/the-definitive-c-book-guide-and-list)*

 ** * *

## 回答 #3

> 赞同：5
> 
>             
> 
> 时间：2009-02-13T16:49:31.697

对于 g++，除了打开 -Wall 之外，还要打开 -pedantic，并准备好对它发现的问题数量感到惊讶！

* * *

## 回答 #4

> 赞同：3
> 
>             
> 
> 时间：2009-02-13T16:46:14.807

与 Java、C# 等相比，对 C++ 的工具支持相当糟糕，因为它没有上下文无关的语法。事实上，C++ 语法的某些部分是不可判定的。基本上，这意味着在句法级别理解 C++ 代码需要实现一个带有语义分析的编译器前端。C++ 不能独立于语义分析来解析为 AST，IDE 等中的大多数代码分析工具都在 AST 级别工作。这是为了换取 C++ 的灵活性和向后兼容性而做出的权衡的一部分。

* * *

## 回答 #5

> 赞同：3
> 
>             
> 
> 时间：2009-02-13T16:56:29.930

打开所有编译器警告（至少在最初），然后了解它们的含义、如何解决突出显示的问题以及哪些警告代表编译器编写者可能认为模棱两可的真正构造，这是很好的第一步。

如果你需要更重的任务，如果你在[Windows](http://www.gimpel.com/)上，你可以试试 PC-Lint ，它仍然是 C++ 最好的 lint 工具之一。请记住，您需要配置这些工具以反映您的编码风格，否则您将被警告淹没，并且无法看到树木的树木。是的，它要花钱，而且如果你没有在“获得报酬”的水平上使用 C++，这可能有点矫枉过正，但我​​发现它非常宝贵。

* * *

## 回答 #6

> 赞同：3
> 
>             
> 
> 时间：2009-02-15T21:58:06.823

[维基百科](http://en.wikipedia.org/wiki/List_of_tools_for_static_code_analysis)上有静态代码分析工具列表。

但是警告通常是好的，但是使用 pedantic 和 Wall 启用所有警告的一个问题是您可能会从包含您无法控制的标题中获得的警告数量，这会产生很多噪音。我更喜欢编译我自己的软件并启用所有警告。当我在 linux 中编程时，我通常会这样做：

将我需要包含的外部头文件放在一个单独的文件中，并在该文件的开头包含放置：

```
#pragma GCC system_header 
```

然后从您的代码中包含此文件。这使您可以查看自己代码中的所有警告，而不会被外部代码的警告淹没。缺点是它是一个 gcc 特定的解决方案，我不知道有任何平台独立的解决方案。

* * *

## 回答 #7

> 赞同：2
> 
>             
> 
> 时间：2009-02-13T16:45:06.450

lint - 有很多版本，但如果你用谷歌搜索 lint，你应该会找到一个可以工作的。另一件事是打开编译器警告——如果你使用 gcc/g++，选项是 -Wall。

您可能会发现[CppChecker](http://www.jaylib.org/pmwiki/pmwiki.php?n=EclipsePlugins.CppChecker)作为一个支持 gcc/PC lint 的 Eclipse 插件很有帮助。

* * *

## 回答 #8

> 赞同：2
> 
>             
> 
> 时间：2009-02-13T16:50:50.227

我认为您真正需要在这里学习的是如何在 IDE 之外进行调试。在我看来，这是一项很有价值的技能，因为您将不再需要如此繁重的工具集来开发软件，并且它将适用于您已经知道并将学习的绝大多数语言。

但是，它很难适应。您将不得不仅出于调试目的编写代码，例如在尚未调试的每一行之后编写检查，以确保结果符合预期，或者将值打印到控制台或消息框中，以便您自己检查它们。它很乏味，但可以让您在 IDE 内部或外部更轻松地发现错误。

下载并尝试一些免费的调试工具，例如[GDB](http://www.gnu.org/software/gdb/)，它们可以帮助您探测内存等，而无需编写自己的代码。

# sql - 选择查询中的错误 3075

> ID：546693
> 
>         
> 
> 赞同：0
> 
>         
> 
> 时间：2009-02-13T16:47:24.633
> 
>         
> 
> 标签：sql, select

查询在查询 '[Relationship Manager]=John DOE' 中给出语法错误缺少运算符

```
BCA_Source = " SELECT distinct [Account Data Table less DTA CHD].BCA_ICA, " _
            & "[Account Data Table less DTA CHD].[Relationship Manager]" _
            & " FROM [Account Data Table less DTA CHD] " _
            & " WHERE [Relationship Manager]= " _
            & Me.cmb_Mngr.Value, 
```

谢谢，苏里

* * *

## 回答 #1

> 赞同：3
> 
>             
> 
> 时间：2009-02-13T16:57:06.170

最初的猜测是**Me.cmb_Mngr.Value**必须用转义引号括起来。

# c - 使用 printf 时的段错误

> ID：546701
> 
>         
> 
> 赞同：2
> 
>         
> 
> 时间：2009-02-13T16:49:16.407
> 
>         
> 
> 标签：c, segmentation-fault, printf

我正在调试浮点异常的信号处理程序中的一些 Linux C 代码。目标是检查浮点寄存器，打印一些信息，然后中止。尝试 printf 的结果时出现分段错误`(char)('0' + phyreg)`。

```
struct ucontext *   uc = (struct ucontext *) data;
fpregset_t      fp = uc -> uc_mcontext.fpregs;

int top = (fp -> sw >> 11) & 0x07;
int i,j,k;
for (i = 0; i < 8; i++) {
    static const char * tags [] = {
        "valid", "zero", "invalid/infin", "empty"
    };
    int phyreg = (top + i) & 0x07;
    struct _libc_fpreg* r = &(fp -> _st [phyreg]);
    const char* regExp = (((r->exponent & 0x8000) != 0) ? "-" : "+");
    printf ("  FP %s: Mantissa= %s",
            (char) ('0' + phyreg), // reg stack (SIGSEGV here)
            regExp); // register exponent sign
    j = (r->significand[3] >> 15) & 0x01;
    printf ("%s.",(char) ('0' + j)); // mantissa (Also SIGSEGV here when
                                     // previous SIGSEGV is commented out)
    ...
} 
```

这不是`(char)('0' + phyreg)`问题的计算，因为当我将它移到单独的行并将结果存储在临时变量中时，直到 printf 尝试显示临时变量时我才得到段错误。那么，导致段错误的错误在哪里？

* * *

## 回答 #1

> 赞同：7
> 
>             
> 
> 时间：2009-02-13T16:51:21.957

您正在使用 %s 打印。应该是“FP %c: 尾数 = %s”。

* * *

## 回答 #2

> 赞同：3
> 
>             
> 
> 时间：2009-02-13T16:52:23.047

%s 表示一个字符串，你给它一个字符。这个字符值被 printf 解释为指向要打印的字符串的第一个字符的指针，这当然会严重失败。

将字符放入具有 2 个元素的字符数组中，第二个元素是 '\0'，或者查看 printf 是否有可以计算为字符的内容。

* * *

## 回答 #3

> 赞同：3
> 
>             
> 
> 时间：2009-02-13T16:52:40.690

对单个字符使用`%c` [格式说明](http://en.wikipedia.org/wiki/Printf#printf_format_placeholders)`%s`符，而不是（应该用于 -`null`终止的字符串）。

# sql-server - IIS 7 无法连接到 SQLServer 2008

> ID：546702
> 
>         
> 
> 赞同：3
> 
>         
> 
> 时间：2009-02-13T16:49:28.390
> 
>         
> 
> 标签：sql-server, asp.net-mvc, iis, connection-string

抱歉，如果这是网络上最常见的问题，但现在轮到我了。我正在尝试在 MS Sql Server 2008 下的 IIS 7 上发布我的 asp.net mvc 应用程序。我在 Windows Server 2008 虚拟机上。我收到以下经典错误：

> 建立与 SQL Server 的连接时发生与网络相关或特定于实例的错误。服务器未找到或无法访问。验证实例名称是否正确以及 SQL Server 是否配置为允许远程连接。（提供者：SQL 网络接口，错误：26 - 错误定位服务器/指定的实例）

在 SQLServer 下，选中允许远程连接。我的连接字符串是：

数据源=.\MSSQLSERVER；初始目录=mydbname；用户ID=sa；密码=mypassword

我也试过没有用户名/密码和“集成安全=真”。仅安装了一个 SQLServer 实例。我试图在本地和远程访问我的网页。虚拟机上没有活动防火墙。

* * *

## 回答 #1

> 赞同：3
> 
>             
> 
> 时间：2009-02-13T16:51:51.753

确保在 SQL Server 配置工具中将 TCP/IP 设置为传输。

* * *

## 回答 #2

> 赞同：3
> 
>             
> 
> 时间：2009-02-13T17:24:07.480

谢谢大家的尝试。我找到了解决方案，它与我忘记提供的信息有关。我希望它能在这些事情上帮助像我一样的新人。

我使用NHibernate，连接字符串实际上在nhibernate.cfg.xml 文件中。web.config 文件中的那个实际上由我的各种提供者（用户/角色）使用。我通过从 NH 配置文件中删除连接字符串来解决这个问题。我现在用以下方法检索它：

```
string connectionString = ConfigurationManager.
ConnectionStrings["myConnectString"].ConnectionString; 
```

我将它设置在 NH 中：

```
Configuration cfg = new Configuration();
cfg.Configure(cfgFile);
cfg.SetProperty(NHibernate.Cfg.Environment.ConnectionString, connectionString); 
```

现在我得到：

> 无法打开登录请求的数据库“mydb”。登录失败。用户“NT AUTHORITY\NETWORK SERVICE”登录失败。

但这是另一个故事，如果我找不到答案，是另一个问题。

PS：我必须使用“。” 作为服务器名称，否则 .\MSSQLSERVER 会产生一个新错误“无效的连接字符串”。感谢 Ian 和 Jared 提供小费。

* * *

## 回答 #3

> 赞同：1
> 
>             
> 
> 时间：2009-02-13T16:53:49.173

这是来自网络配置的实际数据源行吗？

如果是这样，那么它当然应该用引号引起来，为了安全起见添加 ; 最后并检查这是您的实例的实际名称，您可以检查 Windows 服务以获取您的实例名称。

尝试替换`localhost`而不是`.`使用连接字符串中的凭据从 sql server management studio 连接吗？

* * *

## 回答 #4

> 赞同：1
> 
>             
> 
> 时间：2009-02-13T17:01:55.613

正如罗伯特所说，尝试：

```
ConnectionString="Data Source=(LOCAL)\MSSQLSERVER;Initial Catalog=mydbname;User ID=sa;Password=mypassword" 
```

我不确定连接字符串是否区分大小写，但我注意到您使用的是“Id”而不是“ID”。

编辑：不确定是否需要 \MSSQLSERVER？

* * *

## 回答 #5

> 赞同：1
> 
>             
> 
> 时间：2009-02-13T17:03:12.223

你确定它是 SQL 的命名实例吗？

尝试

数据源=.；初始目录=mydbname；用户ID=sa；密码=mypassword

更新：

从[这个网站](http://blogs.msdn.com/sql_protocols/archive/2007/05/13/sql-network-interfaces-error-26-error-locating-server-instance-specified.aspx)

您是否尝试过以下操作：

*   确保服务器机器可访问，例如，DNS 可以正确解析，您可以 ping 服务器（并非总是如此）。

*   确保 SQL Browser 服务正在服务器上运行。

*   如果服务器上启用了防火墙，则需要将 sqlbrowser.exe 和/或 UDP 端口 1434 置于异常中。

* * *

## 回答 #6

> 赞同：0
> 
>             
> 
> 时间：2013-12-13T07:55:08.990

好吧，自从早上（过去 8 小时）以来，我面临着同样的上述问题，做了很多事情，比如创建一个域名，设置一个新的应用程序池身份，但没有任何效果:(

我刚刚`web.config`对连接字符串的文件进行了一些小的更改，即：

Integrated Security=False 而不是 True... 现在它运行良好

# windows - Windows 应用程序的默认图标？

> ID：546704
> 
>         
> 
> 赞同：31
> 
>         
> 
> 时间：2009-02-13T16:49:34.003
> 
>         
> 
> 标签：windows, icons

Visual Studio 或 MSDN 是否为桌面应用程序提供一组默认图标，即常用操作、GUI 元素、数据类型等的图标？

例如，我有一个用户单击以选择文件的按钮，如果我可以使用 Windows 的标准文件夹图标，那就太好了。

* * *

## 回答 #1

> 赞同：30
> 
>             
> 
> 时间：2013-12-16T13:37:35.737

对于 Visual Studio 2012 和 2013：

图标不再位于程序文件夹中。

[您可以在http://www.microsoft.com/en-us/download/details.aspx?id=35825](http://www.microsoft.com/en-us/download/details.aspx?id=35825)下载包含大部分图标的 Visual Studio 图像库

它包含许多来自 Visual Studio、Office、...

* * *

## 回答 #2

> 赞同：23
> 
>             
> 
> 时间：2009-02-13T16:53:57.567

您应该能够在名为“VS2008ImageLibrary.zip”的 zip 文件中找到图标，该文件位于此处：

%Program Files%\Microsoft Visual Studio 9.0\Common7\VS2008ImageLibrary\1033

* * *

## 回答 #3

> 赞同：5
> 
>             
> 
> 时间：2009-02-13T16:54:51.573

查看[http://www.famfamfam.com/lab/icons/](http://www.famfamfam.com/lab/icons/)非常漂亮和详尽的图标集。据我所知，他们是免费的。

* * *

## 回答 #4

> 赞同：2
> 
>             
> 
> 时间：2009-02-13T16:54:29.763

有一个与 Visual Studio 一起打包的图像库。在 Visual Studio 安装目录中搜索图标文件以显示其位置。它可能存在也可能不存在，或者将位于不同的位置，具体取决于您安装的 VS 版本。

如果内存服务于 Express 版本，则没有此功能，但至少从 Visual Studio .NET 开始的所有其他版本都有。

# wcf - 使用 JScript.NET 创建 WCF 服务？

> ID：546727
> 
>         
> 
> 赞同：0
> 
>         
> 
> 时间：2009-02-13T16:54:42.977
> 
>         
> 
> 标签：wcf, jscript.net

我正在尝试在 JScript.NET 中创建 WCF 服务。（我知道，我应该用 C# 或 VB.NET 来做，但请幽默。）以前有人做过吗？

我可以创建 .asmx Web 服务，但我不确定如何修改 web.config 以使 .svc 文件正常工作——我需要预编译吗？

另外，我（现在）正在尝试使用内联代码来做到这一点——这是否可行，或者如果我手动操作，我真的需要一个代码隐藏......

谢谢！

* * *

## 回答 #1

> 赞同：0
> 
>             
> 
> 时间：2009-02-13T17:07:58.250

您将需要一个代码。在 WCF 中创建服务的模型与用于 Web 服务的 .asmx 模型截然不同（WCF 服务实际上不止于此）。

虽然您可以使用 WCF 服务进行契约优先开发（这将避免您必须定义接口和属性，*在某种程度上*），但 WCF 的一些功能来自使用代码构造来定义您的契约。我认为这在 JScript 这样的语言中并不容易。您*可能*能够摆脱实际的实现，但我认为如果您使用 JScript，合同定义对您来说将是一个问题。

# sql-server - SQL Server 2008 Windows 身份验证登录错误：登录来自不受信任的域

> ID：546746
> 
>         
> 
> 赞同：112
> 
>         
> 
> 时间：2009-02-13T17:00:10.827
> 
>         
> 
> 标签：sql-server

尝试使用 Management Studio 连接到 SQL Server 2008 实例时，我收到以下错误：

> 登录失败。登录来自不受信任的域，不能用于 Windows 身份验证。（Microsoft SQL Server，错误：18452）

我可以毫无问题地使用 SQL 身份验证登录。我突然收到这个错误。我打开了混合模式身份验证。  

有人对这个有经验么？

附加信息：Windows 2003 Server 上的 64 位版本的 SQL Enterprise Edition

* * *

## 回答 #1

> 赞同：50
> 
>             
> 
> 时间：2009-09-12T15:34:59.070

这可能发生的另一个原因（只是发生在我身上）......是用户的密码过期。直到我尝试远程访问实际服务器并被提示更改密码时，我才意识到这一点。

* * *

## 回答 #2

> 赞同：39
> 
>             
> 
> 时间：2011-07-01T21:23:09.587

对我来说，这发生在我编辑了一个空白`drivers/etc/hosts`文件，并为本地网站添加了一个条目，但忽略了添加`127.0.0.1 localhost`

* * *

## 回答 #3

> 赞同：29
> 
>             
> 
> 时间：2009-02-17T16:21:23.373

该问题是由关闭的 Active Directory 服务器引起的，它当然无法验证 Windows 帐户。谢谢您的帮助。

* * *

## 回答 #4

> 赞同：19
> 
>             
> 
> 时间：2016-02-02T20:44:03.333

对于遇到此问题的其他任何人，我的主机文件中有此内容：

```
127.0.0.1   localhost
127.0.0.1   customname 
```

我需要它是这样的：

```
127.0.0.1   localhost
127.0.0.1   localhost   customname 
```

* * *

## 回答 #5

> 赞同：16
> 
>             
> 
> 时间：2010-10-10T12:35:00.437

> “问题是由关闭的 Active Directory 服务器引起的，它当然无法验证 Windows 帐户”

它不是“当然 - 因为如果 AD 不可用，那么 Kerberos 身份验证会退回到 NTLM（域帐户凭据在本地缓存，即使 AD/Kerberos 不可用也可以使用它登录）。我猜你可能有 2这种失败发生的同时条件：

*   SQL Server 不是本地的（在另一台机器上）  

*   信任配置为“仅 Kerberos”  

或其他特定的安全网络/服务器/AD/机器配置

* * *

## 回答 #6

> 赞同：11
> 
>             
> 
> 时间：2014-04-22T18:27:43.130

**确保您没有连接到另一个 domain\user 上的 VPN**。或者，相反，如果需要，请确保您*已*连接。

* * *

## 回答 #7

> 赞同：10
> 
>             
> 
> 时间：2012-02-27T19:50:14.840

我的本地计算机上的服务器实例遇到此问题，发现这是因为我在主机文件中指向 127.0.0.1 时使用的不是“localhost”。就我而言，有两种方法可以解决此问题：

1.  清除 hosts 文件中指向 127.0.0.1 的违规条目

2.  使用“localhost”而不是主机文件中指向 127.0.0.1 的其他名称

*这仅适用于我在本地机器上运行 sql server 实例并尝试从同一台机器访问它时。

* * *

## 回答 #8

> 赞同：5
> 
>             
> 
> 时间：2015-12-18T14:05:40.763

jTDS 驱动程序上有一个名为 USENTLMV2 的设置，默认设置为 false。在我的数据库软件（DBVisualizer）中将此设置为“真”解决了它。

* * *

## 回答 #9

> 赞同：4
> 
>             
> 
> 时间：2017-07-26T17:15:13.170

我在禁用环回检查设置的机器上修复了这个问题：

1.  编辑 Windows 注册表：开始 -> 运行 > Regedit

2.  导航到：HKLM\System\CurrentControlSet\Control\LSA

3.  添加一个名为“DisableLoopbackCheck”的 DWORD 值</li>

4.  将此值设置为 1

* * *

## 回答 #10

> 赞同：3
> 
>             
> 
> 时间：2009-02-13T17:04:23.470

[尝试使用 RUNAS 命令](http://weblogs.asp.net/jgalloway/archive/2007/09/07/tip-use-runas-to-set-your-windows-auth-domain-for-database-connections.aspx)使用不同的有效登录名

```
runas /user:domain\user “C:\Program Files\Microsoft SQL Server\90\Tools\Binn\VSShell\Common7\IDE\ssmsee.exe” 

runas /user:domain\user “C:\WINDOWS\system32\mmc.exe /s \”C:\Program Files\Microsoft SQL Server\80\Tools\BINN\SQL Server Enterprise Manager.MSC\”" 

runas /user:domain\user isqlw 
```

* * *

## 回答 #11

> 赞同：3
> 
>             
> 
> 时间：2010-08-20T20:05:03.303

对我来说，这是因为我没有将帐户添加到 SQL 数据库本身以具有我想使用的角色。并且还由于通过复制粘贴问题锁定帐户的错误密码尝试。

* * *

## 回答 #12

> 赞同：3
> 
>             
> 
> 时间：2013-06-03T12:18:12.050

好的，完全有我的答案。我从托管在 VM VirtualBox 上的开发环境中收到此错误。三台服务器；SharePoint、SQL DB 和域控制器。SharePoint 服务器无法连接到配置数据库。我仍然可以通过 ODBC 连接使用 SA 帐户进行 Sql 身份验证，但不能使用 Windows 身份验证。但是该用户会很高兴地在 sql server 本身上登录 SSMS。我也从 ODBC 获得了更好的错误消息，并且还通过检查 sql server 上的失败登录消息：

```
select text from sys.messages where message_id = '18452' and language_id = 1033 
```

这不能归功于我，因为我向我们的一位企业系统管理员寻求帮助，他在大约 5 分钟内查看了我发送给他的一些屏幕截图后诊断出它。  **问题是域控制器的时钟设置不正确！**  简直不敢相信。服务器设置为仅主机网络，因此没有互联网来同步时钟。这也解释了为什么当我知道系统正在工作时回滚到较早的快照并没有解决问题。

编辑：在服务器上安装访客添加可将访客时钟与主机同步。

* * *

## 回答 #13

> 赞同：3
> 
>             
> 
> 时间：2016-08-04T16:38:28.857

您可能会看到这种情况的另一种情况是，当您尝试从更改密码时已经登录的 SSMS 会话连接到另一个 SQL 服务器时。事件的顺序可能类似于：

1.  RDP 到 Server-A（你的 SQL Server），打开 SSMS 并登录

2.  RDP 到同一域中的 Server-B 并更改您的密码

3.  返回到服务器 A 上的 RDP 会话并通过 SSMS 尝试将另一个数据库添加到现有的 AlwaysOn 可用性组中。连接到副本时，您会收到“不受信任的域”-login-error

要解决，只需注销并重新登录

* * *

## 回答 #14

> 赞同：3
> 
>             
> 
> 时间：2017-08-28T08:51:26.720

您可能会被您在本地使用**的用户名误导。**这就是我在 Windows 10 Home 中的情况。当我在控制面板中查看用户时，我看到了名称*usrpc01*。但是，当我键入时`net config workstation`，用户的名称似乎是*spc01*。似乎有人重命名了用户，但内部名称保持不变。

不知道如何修复 windows 用户名（以及 下的文件夹名称`C:\Users`，也指原始内部名称），我在我的数据库服务器上添加了一个新用户帐户。

* * *

## 回答 #15

> 赞同：1
> 
>             
> 
> 时间：2011-06-14T23:16:24.567

我一直在尝试从域帐户登录到 SQL Server 2008。SQL Server 2008 托管在不属于域的不同工作组计算机上。听起来很奇怪，在运行 SQL Server 2008 的工作组服务器上，我不得不转到系统属性 | 计算机名称（选项卡）| 更改（按钮） | 计算机名称更改 | 更多...（按钮）并输入“此计算机的主 DNS 后缀”（它是空白的，因此请输入您的网络所需的后缀）并选中“域成员更改时更改主 DNS 后缀”框。这允许在登录 SQL Server 2008 时完成 Windows 身份验证过程。

* * *

## 回答 #16

> 赞同：1
> 
>             
> 
> 时间：2014-07-22T04:04:48.417

我不得不使用 netonly 让它在现代 Windows 上工作：

`runas /netonly /user:domain\user "C:\Program Files (x86)\Microsoft SQL Server\110\Tools\Binn\ManagementStudio\ssms.exe"`

* * *

## 回答 #17

> 赞同：1
> 
>             
> 
> 时间：2015-08-19T13:14:51.227

另一个原因> 有人更改了默认 SQL 用户的密码

几分钟前切换到新的域控制器时，这发生在我身上...

* * *

## 回答 #18

> 赞同：1
> 
>             
> 
> 时间：2017-06-12T06:54:59.483

我在下面的主机文件中输入错误`C:\Windows\System32\drivers\etc` 

```
[Microsoft][SQL Server Native Client 11.0][SQL Server]Login failed. The login is from an untrusted domain and cannot be used with Windows authentication. 
```

确保有如下条目

```
127.0.0.1   localhost
127.0.0.1   localhost   servername 
```

* * *

## 回答 #19

> 赞同：1
> 
>             
> 
> 时间：2017-07-27T07:33:09.910

我为指向“127.0.0.1”的 SQL Server 实例使用了别名。将其更改为“localhost”就可以了。

* * *

## 回答 #20

> 赞同：1
> 
>             
> 
> 时间：2018-08-08T11:52:15.093

如果您的 Sql Server 在不属于域的服务器上运行，并且在连接字符串中您使用了 Integrated Security=True 的完全限定域名（例如 xyz.mypc.com），您可能必须切换到使用IP 地址、MachineName (SERVER01) 或点 (.)（如果它是本地托管的）。

这对我有用，使用 fqdn 会导致上述错误。

* * *

## 回答 #21

> 赞同：0
> 
>             
> 
> 时间：2009-02-13T17:41:33.427

为了启用 Windows 身份验证，两台计算机需要在同一个域中。为了允许管理工作室传递当前凭据并在 sql 框中进行身份验证

* * *

## 回答 #22

> 赞同：0
> 
>             
> 
> 时间：2010-10-09T17:09:00.107

对我来说，我必须从域断开（更改工作组/域）并重新连接。

* * *

## 回答 #23

> 赞同：0
> 
>             
> 
> 时间：2012-07-13T11:07:16.317

另一个可能的原因：数据库服务器上新创建的本地帐户具有：“用户必须在下次登录时更改密码”标志集。

* * *

## 回答 #24

> 赞同：0
> 
>             
> 
> 时间：2013-12-23T06:56:26.813

这是为我解决的问题：网络连接的属性单击：“Internet 协议版本 4 (TCT/IPv4)”。单击“属性”按钮。单击“高级”按钮。选择“DNS”选项卡。删除“此连接的 DNS 后缀”中的文本。

* * *

## 回答 #25

> 赞同：0
> 
>             
> 
> 时间：2014-05-14T08:51:00.590

我也无法远程连接到 SQL 服务器。SQL 服务器和远程服务器都在同一个域中。几天前我被要求更改密码。重新启动 SQL 服务器和我试图从中访问 SQL 服务器的远程服务器对我来说是诀窍。

* * *

## 回答 #26

> 赞同：0
> 
>             
> 
> 时间：2014-11-07T09:00:25.227

在我们的案例中，开发人员在他自己的帐户下运行应用程序池，并且已经重置了他的密码但忘记在应用程序池上更改它。呃...

* * *

## 回答 #27

> 赞同：0
> 
>             
> 
> 时间：2014-11-12T21:42:14.887

就我而言，服务器已在域控制器中被禁用。我进入 Active Directory 中的 COMPUTERS OU，右键单击服务器，启用它，然后从 SQL 服务器执行 gpupdate /force。花了一点时间，但它终于奏效了。

* * *

## 回答 #28

> 赞同：0
> 
>             
> 
> 时间：2014-12-03T10:10:00.543

就我而言，在主机文件中，机器名称是用旧 IP 硬编码的。我用新IP替换旧IP，问题解决了。

主机文件位置

WindowsDrive:\Windows\System32\drivers\etc\hosts

修改完成
**159.xx.xx.xxx MachineName**

* * *

## 回答 #29

> 赞同：0
> 
>             
> 
> 时间：2015-12-21T08:53:05.253

以上都不适合我。我必须做的是：在登录屏幕上的 SQL Server Management Studio 中，选择选项>>在网络部分将网络协议更改为命名管道。

此外，我必须做的`<default>`是禁用无线网络（机器也连接到有线局域网）。

* * *

## 回答 #30

> 赞同：0
> 
>             
> 
> 时间：2016-01-14T19:37:39.383

我的解决方法是更改​​ web.config 文件以与我的 SQL 连接的新服务器名称相关联（IT 安全部门刚刚在我的开发框上完成了网络重命名。

* * *

## 回答 #31

> 赞同：-1
> 
>             
> 
> 时间：2011-08-03T12:45:04.367

我更换了连接字符串，它开始工作

从

```
main_sqlconnection = New SqlConnection("Data Source=Server1\SQLEXPRESS;Initial Catalog=Master;Trusted_Connection=True") 
```

到

```
main_sqlconnection = New SqlConnection("Data Source=Server1\SQLEXPRESS;Initial Catalog=Master;User ID=ARM;Password=1;") 
```

我在 Microsoft SQL Server Management Studio 中创建了帐户`User ID=User;Password=1;`：单击安全并添加一个新用户。

* * *

## 回答 #32

> 赞同：-1
> 
>             
> 
> 时间：2012-11-07T18:24:43.093

您需要先启用`sa`账号并使用该账号登录您的SQL管理工作室`sa`（请选择SQl Server认证）。

使用sa账号登录后，进入`security`，右键`logins`，选择`new login`，选择`SQL Server authentication`，创建用户名（无`/`或任何其他特殊字符，只是名称），然后给它一个密码，确认密码，然后在该页面的底部选择您的默认数据库。

转到`logins`，右键单击您创建的用户，然后单击`properties`。

转到`Server Roles`并选择要授予您创建的用户的角色。

单击`OK`并返回`login properties`，单击`User Mapping`，双击要将此用户映射到的数据库，然后在底部窗口中选择该数据库的数据库角色成员资格。

* * *

## 回答 #33

> 赞同：-1
> 
>             
> 
> 时间：2016-01-07T19:34:59.673

确保您没有在某处使用“Trusty_Connection=yes”。我遇到了同样的问题，我只需将其设置为“否”即可解决。

* * *

## 回答 #34

> 赞同：-1
> 
>             
> 
> 时间：2016-02-28T08:59:20.807

当我想在另一台 PC 上运行我的项目时，我遇到了同样的问题。更改连接字符串

```
Data Source=JOHN-PC\JJ;Initial Catalog=MyDatabase;Integrated Security=True;Pooling=False 
```

到

```
Data Source=JOHN-PC\JJ;Initial Catalog=MyDatabase;Persist Security Info=True;User ID=MyUserName;Password=MyUserPassword 
```

帮助过我。

这是原始答案的链接：[登录失败。登录来自不受信任的域...](http://www.codeproject.com/Questions/1081462/Login-failed-the-login-is-from-an-untrusted-domain)

希望这会有所帮助。

* * *

## 回答 #35

> 赞同：-2
> 
>             
> 
> 时间：2012-01-07T06:18:13.607

只需`Trusted_Connection=True`从连接字符串中删除属性。

# python - 多实例 Django 论坛软件

> ID：546753
> 
>         
> 
> 赞同：2
> 
>         
> 
> 时间：2009-02-13T17:01:22.510
> 
>         
> 
> 标签：python, django, forum

有谁知道允许每个成员拥有自己的论坛的 django 论坛插件？如果什么都没有，那么使用 Django 的“常规”论坛插件来完成此任务的最佳方法是什么？

* * *

## 回答 #1

> 赞同：4
> 
>             
> 
> 时间：2009-02-14T11:45:31.793

我曾经为我能找到的所有 Django 论坛应用程序创建了一个[特征矩阵](http://code.djangoproject.com/wiki/ForumAppsComparison)。不过，它现在可能有点过时了（欢迎贡献）。

至少 django-threadedcomments 使用通用外键，因此您可以将消息线程附加到任何数据库对象，包括用户。

* * *

## 回答 #2

> 赞同：2
> 
>             
> 
> 时间：2010-10-13T07:38:35.333

看看[DjangoBB](http://djangobb.org/)。

* * *

## 回答 #3

> 赞同：1
> 
>             
> 
> 时间：2009-05-19T07:52:41.353

[是的，SCT](http://sct.sphene.net/)的论坛应用程序可以用于此 - 只需设置并创建多个“社区组”（这些类似于虚拟主机）并将它们映射到子域 - 每个社区组都有单独的论坛类别，可以有单独的模板，单独的用户权限等（但他们显然会共享相同的 django 用户和他们的个人资料） - 例如.. 以下网站都托管在同一个实例上：

*   [SCT网站](http://sct.sphene.net/)

*   [我的个人网站/博客](http://herbert.poul.at/)（博客也是基于 SCTs 论坛）

*   [ShelfShare 社区](http://shelfshare-community.sphene.net/)

* * *

## 回答 #4

> 赞同：0
> 
>             
> 
> 时间：2009-02-16T04:59:15.453

我相信[Spene 社区工具](http://sct.sphene.net/wiki/show/Board/)可以做到这一点。

* * *

## 回答 #5

> 赞同：0
> 
>             
> 
> 时间：2009-02-13T17:16:50.757

看看[钻石](http://djangoplugables.com/projects/diamanda/)。我不确定它是否能满足每个用户拥有其论坛的需求，但这可能并不难破解。可能就像在 auth.User 中添加一些 ForeignKeys 到 diamanda 模型一样简单。一般来说， [django 插件](http://djangoplugables.com/)和[djangoapps](http://djangoapps.org/)是寻找已经编写好的 django 内容的好地方。另外，请查看[pinax](http://cloud27.com/)。

# css - 通过 css 修复布局

> ID：546754
> 
>         
> 
> 赞同：2
> 
>         
> 
> 时间：2009-02-13T17:01:26.237
> 
>         
> 
> 标签：css, internet-explorer, layout

我有一个显示在 IE6 中的布局错误，**我正试图想出一种方法来为我们的内容区域中的该内容提供一些线索，以便它不会下拉到导航菜单下方。**可悲的是，虽然如果我可以重新设计整个页面，这可能会相对容易解决，但我不能这样做......这是一个包含许多内容页面的实时网站......而且它只会中断几个地方，在 IE6 中，在一些不寻常的情况下......所以为内容持有者承担重大布局更改的风险并不合理。

布局应该看起来像这样：

```
+-------+ +-------------------+
| Menu  | | Content chunk 1   |
|       | +-------------------+
|       | +-------------------+
+-------+ | Content chunk 2   |
          +-------------------+
            Footer 
```

但在 IE 6 中，它看起来像：

```
+-------+ 
| Menu  | 
|       | 
|       | 
+-------+ 
+-------------------+ 
| Content chunk 1   |
+-------------------+
+-------------------+ 
| Content chunk 2   |
+-------------------+
            Footer 
```

我一直在试图解决这个问题，并且正在浏览[这里](https://stackoverflow.com/questions/83696/strategy-for-fixing-layout-bugs-in-ie6)建议的一些参考资料，但我希望 css 大师能够轻松地看到一些我没有看到的光。

代码如下所示：

```
<!DOCTYPE html PUBLIC "-//W3C//Dtd Xhtml 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/Dtd/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<body>
<div style="margin: 11px auto; width: 775px">

    <!-- Menu -->
    <div style="width:160px; float:left; clear:left; border:#999 1px dashed;">
        Menu Item 1<br />
        Menu Item 2<br />
    </div>

    <!-- Main content area -->
    <div style="position: relative; width: 565px; float: left; margin-right: -222px">

        <!-- I'm able to start modifying here. -->
        <!-- Content chunk 1 -->
        <table border="1">
            <tr>
                <td>This is data chunk 1 withALongChunkThatDoesn'tDivideWell</td>
                <td>This is data chunk 2 withALongChunkThatDoesn'tDivideWell</td>
                <td>This is data chunk 3 withALongChunkThatDoesn'tDivideWell</td>
                <td>This is data chunk 4 withALongChunkThatDoesn'tDivideWell</td>
                <td>This is data chunk 5 withALongChunkThatDoesn'tDivideWell</td>
            </tr>
        </table>

        <!-- I'd like to be able to stop modifying here. -->

        <!-- Content chunk 2 -->
        <table border="1">
            <tr>
                <td>This is data chunk 1</td>
                <td>This is data chunk 2</td>
                <td>This is data chunk 3</td>
                <td>This is data chunk 4</td>
                <td>This is data chunk 5</td>
            </tr>
        </table>

        <!-- I have to stop modifying here. -->

    <!-- Footer -->
    <div style="float: clear; text-align: center;">
        Here's a footer of some kind.  I don't want to be overlapped.
    </div>

</div>

</body>
</html> 
```

顺便说一句，我知道内容区域周围区域的 css 样式声明并不理想。我没有编码它们，我只需要处理它们。

我还没有多少运气......但我也知道 css*不是*我的专长所在。

建议？还是没有希望？

**编辑：**我对这个问题进行了一些修改，以试图提高清晰度......希望摆脱一两次反对票。非常感谢那些已经回复的人……我现在将开始查看这些回复以评估它们。

* * *

## 回答 #1

> 赞同：3
> 
>             
> 
> 时间：2009-02-13T17:44:51.627

如果您可以将违规表格包装在另一个块级元素（例如 div 标签）中，您可以按如下方式设置该 div 的样式：

```
<div style="width: 100%; overflow: scroll;">
  <table border="1">
      <tr>
          <td>This is data chunk 1 withALongChunkThatDoesn'tDivideWell</td>
          <td>This is data chunk 2 withALongChunkThatDoesn'tDivideWell</td>
          <td>This is data chunk 3 withALongChunkThatDoesn'tDivideWell</td>
          <td>This is data chunk 4 withALongChunkThatDoesn'tDivideWell</td>
          <td>This is data chunk 5 withALongChunkThatDoesn'tDivideWell</td>
       </tr>
  </table>
</div> 
```

这会将表格放入一个可滚动的窗口中，因此它不会将 div 拉伸到 565 像素以上。当然，这仅适用于您的客户可以选择使表格可滚动的情况。不幸的是，您没有很多其他选择。

* * *

## 回答 #2

> 赞同：2
> 
>             
> 
> 时间：2009-02-13T18:27:25.097

我看不到任何仅使用 CSS 来纠正此问题的方法。IE6 的换行计算将以这样一种方式进行，除非主要内容区域被扩展，否则内容将被移动到菜单下。我不知道这是否会在您的约束范围内起作用，但是像这样的一些代码会在视觉上更正它。

```
function resize_content ( )
{
     var main = document.getElementById ( "main" );
     var content = document.getElementById ( "content" );
     if ( main && content )
          main.style["width"] = ( content.clientWidth + 160 ) + "px";
} 
```

为了清楚起见，我使用了 ID，但如果您无法修改标记，则可以使用亲属获取元素。

* * *

## 回答 #3

> 赞同：1
> 
>             
> 
> 时间：2009-02-13T17:15:05.987

我会说如果你不能到达 565px div，那是没有希望的，因为这不是将自己定位在菜单内的东西......

这是你可以用 JS 做的事情：

```
 <!-- I'm able to start modifying here. -->
    <script type="text/javascript">
    $(document).ready(function() {
        $('table#firstTable').parent().parent('div').removeAttr('style').attr('style', 'margin: 11px auto;');
        });
    </script> 
```

首先，您摆脱了 DIV 上的硬编码样式，然后添加回您想要保留的任何内容。很笨拙，但我希望你能明白。

* * *

## 回答 #4

> 赞同：1
> 
>             
> 
> 时间：2009-02-13T17:18:14.013

我知道这不是您正在寻找的解决方案，但可能的替代方法是更改​​文本本身并添加悬停以显示整个内容......例如：

<td><span title="这是带有ALongChunkThatDoesn'tDivideWell的数据块1">这是带有...的数据块1</span></td>

* * *

## 回答 #5

> 赞同：1
> 
>             
> 
> 时间：2009-02-13T17:39:14.773

根本没有一个您既喜欢又被允许实施的解决方案。大小写错误`DOCTYPE`（“Dtd Xhtml”）将 IE6 抛出到怪癖模式，从那里没有返回。具体来说，在怪癖模式下，**绝对没有办法**强制 IE6 不“拉伸”元素，这会破坏你的浮动。如果您可以访问“主要内容”，则可以使其出现（仍然拉伸）在与浮动相同的“行”上`div`，但除此之外，您只需通过添加空格或`<wbr>`年代：

```
<!-- this works, but would be hard to implement programmatically -->
<td>This is data chunk 1 with<wbr>A<wbr>Long<wbr>Chunk<wbr>That<wbr>Doesn't<wbr>Divide<wbr>Well</td>
<td>This is data chunk 2 with<wbr>A<wbr>Long<wbr>Chunk<wbr>That<wbr>Doesn't<wbr>Divide<wbr>Well</td>
<td>This is data chunk 3 with<wbr>A<wbr>Long<wbr>Chunk<wbr>That<wbr>Doesn't<wbr>Divide<wbr>Well</td>
<td>This is data chunk 4 with<wbr>A<wbr>Long<wbr>Chunk<wbr>That<wbr>Doesn't<wbr>Divide<wbr>Well</td>
<td>This is data chunk 5 with<wbr>A<wbr>Long<wbr>Chunk<wbr>That<wbr>Doesn't<wbr>Divide<wbr>Well</td> 
```

* * *

## 回答 #6

> 赞同：0
> 
>             
> 
> 时间：2009-02-13T19:11:42.150

如果我理解正确，我认为您正在寻找类似于以下内容的内容：

```
<!DOCTYPE html PUBLIC "-//W3C//Dtd Xhtml 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/Dtd/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<body>
<div style="margin: 11px auto; width: 775px; position: relative">

    <!-- Menu -->
    <div style="position: absolute; width:160px; left: 0; top: 0; border:#999 1px dashed;">
            Menu Item 1<br />
            Menu Item 2<br />
    </div>

    <!-- Main content area -->
    <div style="margin-left: 165px">

            <!-- I'm able to start modifying here. -->
            <!-- Content chunk 1 -->
            <table border="1">
                    <tr>
                            <td>This is data chunk 1 withALongChunkThatDoesn'tDivideWell</td>
                            <td>This is data chunk 2 withALongChunkThatDoesn'tDivideWell</td>
                            <td>This is data chunk 3 withALongChunkThatDoesn'tDivideWell</td>
                            <td>This is data chunk 4 withALongChunkThatDoesn'tDivideWell</td>
                            <td>This is data chunk 5 withALongChunkThatDoesn'tDivideWell</td>
                    </tr>
            </table>

            <!-- I'd like to be able to stop modifying here. -->

            <!-- Content chunk 2 -->
            <table border="1">
                    <tr>
                            <td>This is data chunk 1</td>
                            <td>This is data chunk 2</td>
                            <td>This is data chunk 3</td>
                            <td>This is data chunk 4</td>
                            <td>This is data chunk 5</td>
                    </tr>
            </table>

            <!-- I have to stop modifying here. -->

    <!-- Footer -->
    <div style="float: clear; text-align: center;">
            Here's a footer of some kind.  I don't want to be overlapped.
    </div>

</div>

</body>
</html> 
```

上面的 CSS 做了以下事情： 使外部 div 相对定位，这允许您然后获取菜单 div 并将其绝对定位到其左上角。然后，在内容的左侧放置了 165px 的左边距。任何不适合内容空间的内容都应该向右溢出。我没有任何方法可以在 IE 6 中进行测试，这适用于 Safari，应该适用于 Firefox。

# sql - 搜索过多数据的网络用户

> ID：546771
> 
>         
> 
> 赞同：1
> 
>         
> 
> 时间：2009-02-13T17:07:19.860
> 
>         
> 
> 标签：sql, sql-server, database, tsql, stored-procedures

我们目前在我们的网站上进行了搜索，允许用户输入日期范围。该页面调用一个存储过程来查询日期范围并返回适当的数据。但是，我们的很多表都包含 30m 到 60m 行。如果用户输入了一年（或某个较大范围）的日期范围，数据库将停止运行。

有没有不涉及对搜索施加时间限制的解决方案？已经实现分页以仅显示前 500 行，但数据库仍然受到重创。我们不能对返回的结果数量施加硬性限制，因为用户“可能”需要所有这些结果。

* * *

## 回答 #1

> 赞同：4
> 
>             
> 
> 时间：2009-02-13T17:25:25.807

如果用户输入的日期范围过大，请让您的应用程序以较小的日期范围步骤进行搜索。可能使用慢启动方法：第一次搜索仅限于一个月范围，如果返回少于 500 行，则搜索前两个月，直到有 500 行。

您需要从最近的日期开始降序排列，从最旧的日期开始升序排列。

* * *

## 回答 #2

> 赞同：3
> 
>             
> 
> 时间：2009-02-13T17:22:05.377

在我看来，这是一个设计问题，而不是技术问题。没有人需要动态的数百万条数据记录。

您将不得不问自己一些棘手的问题：除了网络之外，还有其他获取人们数据的方法吗？有没有更好的方法可以要求过滤？用户需要这些信息究竟是为了什么？有没有一种方法可以提供这种级别的报告，而不是把所有东西都吐出来？

重新评估用户想要和需要的是什么。

* * *

## 回答 #3

> 赞同：2
> 
>             
> 
> 时间：2009-02-13T17:12:43.480

> 我们不能对返回的结果数量施加硬性限制，因为用户“可能”需要所有这些结果。

您似乎在说您不能阻止用户出于业务原因请求大型数据集。我看不到任何技术性的方法。

* * *

## 回答 #4

> 赞同：2
> 
>             
> 
> 时间：2009-02-13T17:14:26.660

索引您的日期字段并强制查询使用该索引：

```
CREATE INDEX ix_mytable_mydate ON mytable (mydate)
SELECT TOP 100 *
FROM mytable WITH (INDEX ix_mytable_mydate) 
WHERE mydate BETWEEN @start and @end 
```

似乎优化器`FULL TABLE SCAN`在看到大范围时会选择。

您能否发布您使用的查询和该查询的执行计划？

* * *

## 回答 #5

> 赞同：1
> 
>             
> 
> 时间：2009-02-13T17:12:25.573

不知道哪些是可能的

1.  使用搜索引擎而不是数据库？

2.  不允许非常笼统的搜索

3.  缓存热门搜索的结果

4.  将数据库分成不同服务器上的分片，在您的应用程序上组合结果。

5.  在内部使用较小的日期范围进行多次查询

* * *

## 回答 #6

> 赞同：1
> 
>             
> 
> 时间：2009-02-13T17:13:03.043

听起来你真的没有分页。我会让存储过程为页面获取一个范围（您计算出的），然后只获取当前页面的那些行。假设数据不经常更改，这将减少数据库服务器的负载。

* * *

## 回答 #7

> 赞同：0
> 
>             
> 
> 时间：2009-02-13T17:21:39.747

您的表数据是如何物理构造的，即分区、跨文件组和磁盘存储等拆分？

你在使用表分区吗？如果不是，您应该考虑使用对齐分区。您可以按日期对数据进行分区，例如每年的分区。

如果我请求跨三年的查询，在多处理器系统上，我可以同时同时访问所有三个分区，从而提高查询性能。

* * *

## 回答 #8

> 赞同：0
> 
>             
> 
> 时间：2009-02-13T17:39:35.477

你是如何实现分页的？

我记得几年前我遇到过这样的问题，问题与我如何实现分页有关。然而，我处理的数据没有你的那么大。

* * *

## 回答 #9

> 赞同：0
> 
>             
> 
> 时间：2009-02-13T21:25:59.317

并行化，并将其放入 ram（或云）中。你会发现，一旦你想同时访问大量数据，rdbms 就变成了问题而不是解决方案。没有人做可视化使用 rdbms。

# .net - CruiseControl.NET 使用 VSS 构建项目

> ID：546774
> 
>         
> 
> 赞同：0
> 
>         
> 
> 时间：2009-02-13T17:07:55.257
> 
>         
> 
> 标签：.net, cruisecontrol.net, visual-sourcesafe

我正在尝试为从 VSS 2005 中提取的客户端进行构建（是的，我别无选择）。我很确定我的所有配置都是正确的，但我不断收到此错误：

> 源代码控制操作失败：$/Utilities/Orbital Gateway/Solution Architecture/Release Construction/Payment Subsystem/Services/PaymentService 不是现有文件名或项目

我直接从 SourceSafe 复制了项目路径，所以我知道它是正确的。

这是我的配置：

```
<sourcecontrol type="vss" autoGetSource="true">
  <executable>"C:\Program Files\Microsoft Visual SourceSafe\ss.exe"</executable>
  <project>"$/Utilities/Solution Architecture/Release Construction/Payment Subsystem/Services/PaymentService"</project>
  <username>XXXXXX</username>
  <password>XXXXXXX</password>
  <ssdir>\\server\VSS_Data\<ssdir>
  <workingDirectory>C:\Builds\PaymentService\Dev</workingDirectory>
  <cleanCopy>true</cleanCopy>
</sourcecontrol> 
```

可执行文件是指构建服务器上的 ss.exe，还是实际存放代码的服务器。我让它指向构建服务器。

任何帮助，将不胜感激！

* * *

## 回答 #1

> 赞同：1
> 
>             
> 
> 时间：2009-02-13T19:44:09.577

ss.exe 是构建服务器上的 SourceSafe 可执行文件，因为它将在构建源之前进行检查。文档指出，如果 VSS 与构建服务器在同一台计算机上运行，​​则可以省略此设置。

> SS.EXE 的位置。如果 VSS 安装在集成服务器上，则将从注册表中读取 VSS 的位置，并且可以省略此元素。

不过，您的配置似乎是正确的。

文档：[http ://confluence.public.thoughtworks.org/display/CCNET/Visual+Source+Safe+Source+Control+Block](http://confluence.public.thoughtworks.org/display/CCNET/Visual+Source+Safe+Source+Control+Block)

* * *

## 回答 #2

> 赞同：0
> 
>             
> 
> 时间：2009-02-19T21:27:47.173

我的问题是为什么在 \server\vss_data 找不到项目？

还有一点需要注意的是，在错误消息中，它在“实用程序”和“解决方案架构”之间有“轨道网关”，但在您的示例脚本中，路径的那部分丢失了。

# wsdl - 轴wsdl生成

> ID：546779
> 
>         
> 
> 赞同：3
> 
>         
> 
> 时间：2009-02-13T17:08:47.623
> 
>         
> 
> 标签：wsdl, xsd, axis2

我正在使用 Axis 对示例 WebService 进行建模。我现在正在做的是试图了解自动化 wsdl 和代码生成的局限性。

现在对于一些服务器端代码：

这是示例 Web 服务的框架：

```
public class TestWebService {
  public AbstractAttribute[] testCall( AbstractAttribute someAttribute ) {
    .... 
```

和我的数据类： public abstract class AbstractAttribute { String name;

```
 /*get/set for name*/
  public abstract T getValue();
  public abstract void setValue(T value);
}

public class IntAttribute extends AbstractAttribute<Integer> {
  Integer value;
  public Integer getValue(){ return value; }
  public void setValue(Integer value){ this.value = value; }
}

public class StringAttribute extends AbstractAttribute<String> {
  String value;
  /* ok, you got the point, get/set for value field */
} 
```

Axis2 的 eclipse 工具非常乐意从这些源生成 wsdl，包括属性类的模式，即：

```
<xs:complexType name="AbstractAttribute">
    <xs:sequence>
        <xs:element minOccurs="0" name="name" nillable="true" type="xs:string"/>
        <xs:element minOccurs="0" name="value" nillable="true" type="xs:anyType"/>
    </xs:sequence>
</xs:complexType>
<xs:complexType name="IntAttribute">
    <xs:complexContent>
        <xs:extension base="xsd:AbstractAttribute">
            <xs:sequence>
                <xs:element minOccurs="0" name="value" nillable="true" type="xs:int"/>
            </xs:sequence>
        </xs:extension>
    </xs:complexContent>
</xs:complexType>
<xs:complexType name="StringAttribute">
    <xs:complexContent>
        <xs:extension base="xsd:AbstractAttribute">
            <xs:sequence>
                <xs:element minOccurs="0" name="value" nillable="true" type="xs:string"/>
            </xs:sequence>
        </xs:extension>
    </xs:complexContent>
</xs:complexType> 
```

现在，如果在这里看到一些奇怪的东西，AbstractAttribute 没有 ** abstract="true" ** 属性，并定义了一个 anyType 值元素，它在 IntAttribute 和 StirngAttribute 中被重写。我什至不知道这是否是一个合法的模式（顺便说一句，我认为它不合法）。

此外，如果我尝试从此 wsdl 生成客户端（始终使用 eclipse 工具）生成的源将无法编译，因为 AbstractAttribute 定义了一个

```
Object localValue; 
```

字段和 Int/String 属性定义

```
int localValue; 
```

和

```
String localValue; 
```

..我试图“容纳”源（显然没有太多希望），结果是服务器尝试实例化一个 AbstractAttribute 实例（抛出一个 InstantiationException）。

所以我的问题是：有一种方法可以对上面的数据模型进行建模，或者 Web 服务和 XML 模式通常不是用于这种特殊情况的最佳工具？

* * *

## 回答 #1

> 赞同：4
> 
>             
> 
> 时间：2009-02-16T20:21:38.780

要解释您遇到的问题，请考虑在调用您的服务时 Axis 需要做什么。

Axis 只是一个 Java Web 应用程序……当它收到对服务的请求时，它会查找您为它定义的映射。如果它找到一个映射，它会尝试创建您定义的必要类的实例来为请求提供服务。

如果您已将类定义为抽象类或接口，那么您将收到 InstantiationExceptions，因为无法创建这些类型。当 Axis 尝试创建 wsdl 时，它无法确定要放置的类型，因此它将使用“anyType”。

回答您的问题：您可以在代码中使用上面的模型，但不能将这些类与 Axis 一起使用。我们在项目中通常做的是：

1.  定义我们需要的类，就像在典型的面向对象应用程序中一样

2.  定义用于 Web 服务的“仅传输”类。这些类由简单的类型组成，可以很容易地创建。它们仅用于交换 Web 服务消息。我们将这些类与 Axis 一起使用。

3.  为这两种类型的课程找到一些方法来轻松共享/交换信息。您可以拥有两者共享的接口（但 Axis 不知道），甚至可以使用 BeanUtils.copyProperites 使两个不同的对象保持同步。

希望这能回答你的问题。

# sql-server - 检查分布式事务中绕过 CATCH 块的约束

> ID：546781
> 
>         
> 
> 赞同：0
> 
>         
> 
> 时间：2009-02-13T17:09:09.793
> 
>         
> 
> 标签：sql-server, tsql, error-handling, transactions, distributed-transactions

我有一个 MSSSQL 存储过程，它执行如下所示的分布式事务：

```
SET XACT_ABORT ON;
SET NOCOUNT ON;

BEGIN TRY
  BEGIN DISTRIBUTED TRANSACTION

  insert into LNKSRV.INST.dbo.zz (id, val) values (1, 'a');
  insert into LNKSRV.INST.dbo.zz (id, val) values (2, 'b');

  COMMIT TRANSACTION
END TRY
BEGIN CATCH
  if (XACT_STATE() <> 0) 
  BEGIN
    ROLLBACK TRANSACTION;
  END
  print ERROR_MESSAGE();
  print ERROR_LINE();
  print ERROR_SEVERITY();

END CATCH 
```

这工作正常。

如果我添加这第三条插入语句：

```
 insert into LNKSRV.INST.dbo.zz (id, val) values ('error', 'b'); 
```

...它正确失败了——事务在远程服务器上回滚，控制权传递给 CATCH 块，我得到了有关错误的信息（无法将“错误”转换为 int）。

但是如果我添加这个插入语句：

```
 insert into LNKSRV.INST.dbo.zz (id, val) values (-1, 'b'); 
```

..并且我在远程表上有一个检查约束，要求 id 列中的值> 0，然后事情就不像我预期的那样工作。事务*确实*回滚，但控制*不会*转移到 catch 块。相反，执行会终止，并打印到输出窗口：

```
The Microsoft Distributed Transaction Coordinator (MS DTC) has cancelled the distributed transaction 
```

为什么？我需要在 catch 博客中记录这些错误。

* * *

## 回答 #1

> 赞同：2
> 
>             
> 
> 时间：2009-02-13T17:23:44.530

由于分布式事务协调器正在处理这个问题，当事务的分布式部分的事务失败时，DTC 会以注意的形式发送一条消息，这会阻止您的代码执行，并且 TRY/CATCH 无法处理。

当您尝试将不正确的数据类型插入表（即使在远程实例上）但在链接服务器上处理约束时，SQL Server 可以检测到您的端，这会导致将注意力发送到 DTC 和您的 TRY/ CATCH 被忽略。

有关详细信息，请参阅 SQL Server 2008 联机丛书的“在 Transact-SQL 中使用 TRY...CATCH”部分中的第一个“注释”部分，该部分位于：

[http://msdn.microsoft.com/en-us/library/ms179296.aspx](http://msdn.microsoft.com/en-us/library/ms179296.aspx)

# asp.net-mvc - Where should my models live? Web tier or Data tier? (MVC + NHibernate)

> ID：546782
> 
>         
> 
> 赞同：12
> 
>         
> 
> 时间：2009-02-13T17:09:40.557
> 
>         
> 
> 标签：asp.net-mvc, nhibernate, design-patterns, n-tier-architecture

I am setting up an n-tier application with MVC, Ninject, and NHibernate (my first using these technologies). For clarity's sake, the tiers are a "Data" tier, a "Services" tier, and a "Web" tier (all are separate projects). 

With MVC, you have your models that are in the "Models" folder. It seems necessary to put my models here to create strongly-typed Views and to generally keep with the philosophy of MVC. 

However, with NHibernate, I also need my models in the "Data" tier so that the mapping can take place and that NHibernate can instantiate actual objects to return to the services layer. 

Duplicating the classes across projects is not very DRY and abstracting them into their own library doesn't seem to play well with MVC (neither in practice nor philosophy).

Any thoughts? How do you structure your O/RM objects vs MVC models? 

* * *

## 回答 #1

> 赞同：6
> 
>             
> 
> 时间：2009-02-13T17:56:00.287

I keep Entity Framework models/classes in the data tier and use the Models folder of the MVC project for presentation models and model binders.

* * *

## 回答 #2

> 赞同：6
> 
>             
> 
> 时间：2009-02-13T18:27:51.770

The Data Model is it's own thing.  The Model in MVC is something different.  It's the model of what you're going to display, which may or may not be your Data Model.  You're Data Model may transcend layers, or not.

Take for instance the standard sign-up form.  The Data Model may include the username, password and an array of login history classes, a flag indicating it's active and much other stuff.  The model in MVC, may only really care about username and password, and that the user type the password twice.  Does your Data Model really need two password fields?  No.  However the model in the MVC does.  Hence, two different critters.

* * *

## 回答 #3

> 赞同：4
> 
>             
> 
> 时间：2009-02-13T18:14:03.677

I keep all of my models in the data tier because of NHibernate. Take a look at [S#arp Architecture](http://code.google.com/p/sharp-architecture/) for a great way of keeping your presentation clean. Models do not have to be physically located in your web project for your views to be strongly typed.

* * *

## 回答 #4

> 赞同：1
> 
>             
> 
> 时间：2009-02-21T12:59:14.357

You are right about the DRY principle here. I keep my LINQ-to-SQL objects separated from my business objects and I have some duplication and it doesn't make me feel good but it seems there isn't a simple workaround this..

I had a tough time making this decision but I watched Rob Conery's blog while building the MVC Storefront and in the end I decided to go this way (ORM objects AND business objects)

* * *

## 回答 #5

> 赞同：0
> 
>             
> 
> 时间：2009-02-13T18:57:40.310

> With MVC, you have your models that
>   are in the "Models" folder. It seems
>   necessary to put my models here to
>   create strongly-typed Views and to
>   generally keep with the philosophy of
>   MVC.

No model can be anything you want. I would still use a presentation model if it were necessary but I have no objection to using your nhibernate entities in your views.

With NHibernate you don't really need a Data Tier since the Session itself is the data tier.

The service tier seems like a valid idea but only if you plan on having multiple client for this layer.

Otherwise, I would only have 1 project and use namespaces to separate my layers. It builds faster and is easier to deploy.

# encryption - 隐藏文件夹或 truecrypt 等软件如何工作？

> ID：546788
> 
>         
> 
> 赞同：0
> 
>         
> 
> 时间：2009-02-13T17:11:01.783
> 
>         
> 
> 标签：encryption, directory

我对[隐藏文件夹](http://www.cleanersoft.com/hidefolder/free_hide_folder.htm)的工作方式或如何以编程方式（.net）实现特别感兴趣。我怎样才能创建一个文件夹这样的方式

1.  它隐藏

2.  不会出现在搜索中（即使选择了隐藏文件夹）

3.  无需修改文件系统结构

文件夹是如何加密的。任何链接或建议都会很棒。提前致谢。

* * *

## 回答 #1

> 赞同：0
> 
>             
> 
> 时间：2009-02-13T17:27:06.927

我知道您可以使用注册表设置隐藏驱动器：

[http://www.pctools.com/guides/registry/detail/148/](http://www.pctools.com/guides/registry/detail/148/)

但这不会在您想要的搜索中创建隐形。我知道这并不能真正回答你的问题。但是，如果不出意外，希望它能阻止其他人走这条路……=p

另一方面，Truecrypt 是开源的。我自己对这个主题没有兴趣，所以我不知道它是如何工作的（除了它在 Windows 中使用特殊的存储驱动程序之外），但你可以在这里自己查看：

[http://www.truecrypt.org/downloads2.php](http://www.truecrypt.org/downloads2.php)

* * *

## 回答 #2

> 赞同：0
> 
>             
> 
> 时间：2009-02-13T17:33:06.850

我希望它是一个设备驱动程序（可能是文件系统的过滤器驱动程序）。

在不编写设备驱动程序的情况下，最简单的方法是使用实​​现此功能的（显然很多）第 3 方附加组件之一。

# html - 使用 doxygen 记录枚举

> ID：546791
> 
>         
> 
> 赞同：4
> 
>         
> 
> 时间：2009-02-13T17:12:03.653
> 
>         
> 
> 标签：html, enums, format, doxygen

doxygen 为枚举生成的 html 文档在左侧列出了枚举，在右侧列出了文档。但是，我需要为每个值提供非常详细的文档，并且其中一些名称很长，因此使带有文档的右列出现在右侧很远并且看起来很糟糕。是否不可能使每个值的文档出现在值的下方或上方而不是右侧？

* * *

## 回答 #1

> 赞同：7
> 
>             
> 
> 时间：2012-02-03T14:34:01.713

我正在使用 Doxygen 1.7.5.1。我也遇到过类似的情况……我列举了大约 1000 个左右的成员，这些成员是从电子表格生成的。我希望整数值偏右，成员上方的 Doxygen 位。

我所做的只是在成员名称上方使用三斜杠。对于多行注释，我在需要的地方插入了 HTML 换行符。我只做了第一节，但我认为这是相当明显的。注意：第一行因句号而换行。随后的行没有。

```
///
/// \file test.h
/// \brief Test of Doxygen enum commenting.
///

//! A test of Doxygen commenting.
typedef enum _DOXYGEN_TEST
{

    /// This is a single line comment.
    Member_001,                            //  1

    /// This is a mutli-line comment.
    /// 'Twas brillig, and the slithy toves       <br>
    /// Did gyre and gimble in the wabe;          <br>
    /// All mimsy were the borogoves,             <br>
    /// And the mome raths outgrabe.              <br>
    /// "Beware the Jabberwock, my son!           <br>
    /// The jaws that bite, the claws that catch! <br>
    /// Beware the Jubjub bird, and shun          <br>
    /// The frumious Bandersnatch!"
    /// 
    /// He took his vorpal sword in hand:
    /// Long time the manxome foe he sought--
    /// So rested he by the Tumtum tree,
    /// And stood awhile in thought.
    /// 
    /// And as in uffish thought he stood,
    /// The Jabberwock, with eyes of flame,
    /// Came whiffling through the tulgey wood,
    /// And burbled as it came!
    /// 
    /// One, two! One, two! and through and through
    /// The vorpal blade went snicker-snack!
    /// He left it dead, and with its head
    /// He went galumphing back.
    /// 
    /// "And hast thou slain the Jabberwock?
    /// Come to my arms, my beamish boy!
    /// O frabjous day! Callooh! Callay!"
    /// He chortled in his joy.
    /// 
    /// 'Twas brillig, and the slithy toves
    /// Did gyre and gimble in the wabe;
    /// All mimsy were the borogoves,
    /// And the mome raths outgrabe.
    Member_002,                            //  2

}
Doxygen_test; 
```

生成的 Doxygen 生成文件：
![Doxygen 为 test.h 生成的文档](https://i.stack.imgur.com/LlY9E.png)

* * *

## 回答 #2

> 赞同：0
> 
>             
> 
> 时间：2009-02-24T11:08:07.920

使用 doxygen 1.5.5，我没有成功重现您描述的行为。我得到一个类似于参数列表文档的枚举文档。

我观察到的与[\enum 命令](http://www.doxygen.nl/manual/commands.html#cmdenum)及其[渲染](http://www.doxygen.nl/manual/examples/enum/html/class_enum___test.html)的 Doxygen 文档一致。

# php - 强制转换或函数调用？

> ID：546792
> 
>         
> 
> 赞同：2
> 
>         
> 
> 时间：2009-02-13T17:12:16.367
> 
>         
> 
> 标签：php, types

在 PHP 中使用语法将值转换为整数是否更好

```
(int)$value 
```

或者

```
intval($value) 
```

这个问题也与字符串、布尔值、浮点数有关

* * *

## 回答 #1

> 赞同：3
> 
>             
> 
> 时间：2009-02-13T17:14:45.737

两者之间的差异可以忽略不计。即使是完全不切实际的场景（100k 的循环），您也最多可以节省几毫秒。

毫秒重要吗？是的。这是否会成为您应用程序优化的最大候选者？不。

选择具有您喜欢的语法的那个。

* * *

## 回答 #2

> 赞同：3
> 
>             
> 
> 时间：2009-02-13T17:26:42.993

Using`intval()`具有函数调用的开销，但允许您使用 10 以外的基数。

`(int)`是比较快的。

在任何人说速度无关紧要之前 - 如果您经常这样做（1000 次或 10,000 次）并运行分析器，额外的函数调用会有所作为。

# wininet - WinINet：如何防止 HttpSendRequest 跟随重定向（30x 状态代码）？

> ID：546798
> 
>         
> 
> 赞同：2
> 
>         
> 
> 时间：2009-02-13T17:12:50.267
> 
>         
> 
> 标签：wininet

当我使用[WinINet API 的](http://msdn.microsoft.com/en-us/library/aa383630(VS.85).aspx)[HttpSendRequest](http://msdn.microsoft.com/en-us/library/aa384247(VS.85).aspx)方法发出 HTTP 请求时，响应发送“ ”，WinINet API 自动遵循重定向指令并发出新请求。`302: Moved Temporarily`

**那么，如何防止 HttpSendRequest 跟随重定向（30x 状态码）？**

我不想发出两个请求……我不想得到它在标题中带有状态码 302 的第一个响应。

* * *

## 回答 #1

> 赞同：2
> 
>             
> 
> 时间：2009-02-13T17:20:02.200

我找到了`INTERNET_FLAG_NO_AUTO_REDIRECT`必须传递给的标志`HttpOpenRequest`。

但是，它不起作用......

* * *

## 回答 #2

> 赞同：0
> 
>             
> 
> 时间：2009-05-15T15:37:02.837

如果您能够改用 WinHTTP（[链接](https://stackoverflow.com/questions/161343/how-do-i-prevent-serverxmlhttp-from-automatically-following-redirects-http-303-s/161970#161970)），则可以防止重定向。

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2009-05-15T15:59:12.657

尝试`INTERNET_FLAG_NO_AUTO_REDIRECT`在调用中使用`HttpSendRequest`. 听起来你正试图从`HttpOpenRequest`.

我将此标志与 一起使用`InternetOpenUrl`，并且它在该调用中正常工作。

* * *

## 回答 #4

> 赞同：0
> 
>             
> 
> 时间：2013-12-29T15:10:07.913

似乎 WinInet 的行为很大程度上取决于函数调用中的`lpszAgent`指定。`InternetOpen`当您通过时，`"Mozilla/5.0 (compatible)"`所有重定向都将被忽略，并且您将在读取响应时获得 RAW HTML 结果`InternetReadFile`。

另一方面，如果您需要“重定向”输出，则必须在 Agent 参数中指定您的应用程序名称，例如`"ConEmu Update"`.

# xsd - 使用 trang 将 RELAX NG 转换为 XSD，同时保留外部命名空间元素（用于 JAXB）

> ID：546800
> 
>         
> 
> 赞同：2
> 
>         
> 
> 时间：2009-02-13T17:13:06.320
> 
>         
> 
> 标签：xsd, namespaces, jaxb, relaxng

我正在使用[`trang`](http://www.thaiopensource.com/relaxng/trang.html)将 RELAX NG .rng 文件转换为 XML Schema .xsd 文件以用于 JAXB。有没有办法将属性/元素放在 .rng 文件中并让它们显示在 .xsd 文件中？我有一个用于 JAXB 设置的外部 .xjb 文件，但是有一些 JAXB 设置与架构本身非常紧密地耦合，似乎（以某种方式）将它们放在 .rng 文件中而不是更有意义.xjb 文件。

有什么建议吗？

* * *

## 回答 #1

> 赞同：2
> 
>             
> 
> 时间：2009-02-15T02:11:06.533

我的观点是，您现在正在做的事情是最好的方式，您应该将您的 JAXB 定制与您的 RELAX NG 模式分开。XML Schema 中的 JAXB 自定义充其量是丑陋的，更糟的是分散注意力和混乱。使用 RELAX NG，映射要少得多，我猜您仍然需要将一些定制放在单独的 JAXB 定制文件中，这意味着您的定制将位于两个不同的文件中。  

# sql - 使用sql从多个字段中选择不同的

> ID：546804
> 
>         
> 
> 赞同：12
> 
>         
> 
> 时间：2009-02-13T17:13:51.620
> 
>         
> 
> 标签：sql, select, distinct

我有 5 列对应于问答游戏数据库中的答案 - 对、错 1、错 2、错 3、错 4

我想返回所有可能的答案而不重复。我希望在不使用临时表的情况下完成此操作。是否可以使用类似的东西？：

```
select c1, c2, count(*)
from t
group by c1, c2 
```

但这会返回 3 列。我想要一列不同的答案。

谢谢你的时间

* * *

## 回答 #1

> 赞同：15
> 
>             
> 
> 时间：2009-02-13T17:29:42.783

这应该为您提供表中所有不同的值。我假设您想添加 where 子句以仅针对特定问题进行选择。但是，此解决方案需要 5 个子查询，如果您的表很大，可能会很慢。

```
SELECT DISTINCT(ans) FROM (
    SELECT right AS ans FROM answers
    UNION
    SELECT wrong1 AS ans FROM answers
    UNION
    SELECT wrong2 AS ans FROM answers
    UNION
    SELECT wrong3 AS ans FROM answers
    UNION
    SELECT wrong4 AS ans FROM answers
) AS Temp 
```

* * *

## 回答 #2

> 赞同：8
> 
>             
> 
> 时间：2009-02-13T17:59:20.967

```
SELECT DISTINCT(ans) FROM (
    SELECT right AS ans FROM answers
    UNION
    SELECT wrong1 AS ans FROM answers
    UNION
    SELECT wrong2 AS ans FROM answers
    UNION
    SELECT wrong3 AS ans FROM answers
    UNION
    SELECT wrong4 AS ans FROM answers
) AS Temp 
```

DISTINCT 是多余的，因为 UNION 不会返回所有列都相同的行。（如果您想要重复，或者如果您知道不存在重复，请使用 UNION ALL 以获得更快的性能）

> > 这将为您提供一个包含所有答案的列表。如果您在单个列中有多个相同答案的副本，您仍然会有重复。

如果您使用 UNION，则不应该是这种情况，仅当您使用 UNION ALL

```
SELECT [value] INTO #TEMP
FROM
(
SELECT  [value] = 1
UNION ALL SELECT 2
UNION ALL SELECT 3
UNION ALL SELECT 1
) AS X

(4 row(s) affected)

SELECT [value] 
FROM    #TEMP

value       
----------- 
1
2
3
1

(4 row(s) affected)

SELECT [value] 
FROM    #TEMP
UNION 
SELECT [value]
FROM    #TEMP

value       
----------- 
1
2
3

(3 row(s) affected) 
```

* * *

## 回答 #3

> 赞同：5
> 
>             
> 
> 时间：2009-02-13T17:47:49.107

[我在上面](https://stackoverflow.com/questions/546804/select-distinct-from-multiple-fields-using-sql/546866#546866)提供了一个答案。

但是，我想出了一个更好的方法来使用 UNPIVOT。

```
SELECT DISTINCT(ans)
FROM (
    SELECT [Name], ANS 
    FROM (
        SELECT right, wrong1, wrong2, wrong3, wrong4 
        FROM answers
    ) AS PVT
    UNPIVOT 
    (ans FOR [Name] IN (right, wrong1, wrong2, wrong3, wrong4)) AS UNPVT
) AS OUTPUT; 
```

您可以在内部子查询中提供任何 WHERE 子句：

```
SELECT DISTINCT(ans)
FROM (
    SELECT [Name], ANS 
    FROM (
        SELECT right, wrong1, wrong2, wrong3, wrong4 
        FROM answers
        WHERE (...)
    ) AS PVT
    UNPIVOT 
    (ans FOR [Name] IN (right, wrong1, wrong2, wrong3, wrong4)) AS UNPVT
) AS OUTPUT; 
```

* * *

## 回答 #4

> 赞同：2
> 
>             
> 
> 时间：2009-02-13T17:19:14.340

好吧，您可以使用 UNION 并运行 5 个选择语句，表中的每一列一个。它看起来像这样：

```
SELECT right FROM answers
UNION
SELECT wrong1 FROM answers
UNION
SELECT wrong2 FROM answers
UNION
SELECT wrong3 FROM answers
UNION
SELECT wrong4 FROM answers 
```

这将为您提供一个包含所有答案的列表。如果您在单个列中有多个相同答案的副本，您仍然会有重复。

* * *

## 回答 #5

> 赞同：2
> 
>             
> 
> 时间：2009-11-30T03:14:29.270

“正确，错误1，错误2，错误3，错误4”的列表示您的数据库设计错误。一般来说，列名上的数字或字母后缀应该是重新考虑问题的危险信号。

正如您所观察到的，您的设计要求您设法解决典型的数据缩减问题。

* * *

## 回答 #6

> 赞同：1
> 
>             
> 
> 时间：2009-02-13T17:18:23.717

这是你想要的吗？

`select distinct c1 from t`

* * *

## 回答 #7

> 赞同：0
> 
>             
> 
> 时间：2009-02-13T17:21:22.803

在`MySQL`AND中`MS SQL`：

```
SELECT
      CASE
        WHEN which = 1 THEN c1
        WHEN which = 2 THEN c2
        WHEN which = 3 THEN c3
        WHEN which = 4 THEN c4
        WHEN which = 5 THEN c5
      END AS answer,
      which
FROM mytable, (
     SELECT 1 AS which
     UNION ALL 
     SELECT 2
     UNION ALL 
     SELECT 3
     UNION ALL 
     SELECT 4
     UNION ALL 
     SELECT 5
) w 
```

对于`Oracle`，添加`FROM DUAL`到每个数字选择。

* * *

## 回答 #8

> 赞同：0
> 
>             
> 
> 时间：2009-02-18T20:47:26.250

这是准确的答案。

```
SELECT (ans) FROM (
    SELECT correct AS ans FROM tGeoQuiz 
    UNION
    SELECT wrong1 AS ans FROM tGeoQuiz 
    UNION
    SELECT wrong2 AS ans FROM tGeoQuiz
    UNION
    SELECT wrong3 AS ans FROM tGeoQuiz
    UNION
    SELECT wrong4 AS ans FROM tGeoQuiz 
) AS Temp 
```

# load - 如何在 Visual Studio 负载测试中关闭缓存请求

> ID：546813
> 
>         
> 
> 赞同：3
> 
>         
> 
> 时间：2009-02-13T17:16:09.463
> 
>         
> 
> 标签：load, mstest, testing

运行负载测试时，我想关闭缓存的请求。  

我的网络测试关闭了缓存控制设置，这应该意味着不缓存。但是，看起来它正在缓存图像等；我不想要。

我怎样才能做到这一点？

谢谢

* * *

## 回答 #1

> 赞同：3
> 
>             
> 
> 时间：2009-02-13T19:37:01.060

这是由方案属性中的“新用户百分比”设置设置的。为确保没有缓存，请将属性设置为 100。这表示 100% 的模拟用户似乎是第一次访问该站点。

# php - 用 PHP 生成动态图的最佳软件包是什么？

> ID：546815
> 
>         
> 
> 赞同：1
> 
>         
> 
> 时间：2009-02-13T17:16:41.320
> 
>         
> 
> 标签：php, graph, gd, imagemagick, pear

我非常需要开始在几个项目上实现数据库驱动的图形，而我真正使用过的唯一库是 PEAR 的 Image_Graph。从表面上看，这似乎相当有限，并且可能不是最好的解决方案。我将需要生成两个条形图/饼图，对于第一次切割没有什么过于花哨的。  

是否有人对 PHP 的任何图像/图形库有任何强烈的感觉？无论你喜欢 GD/Imagick/Image_Graph，请给出几个理由来解释你为什么会有这种感觉。

谢谢！

*   尼古拉斯

* * *

## 回答 #1

> 赞同：3
> 
>             
> 
> 时间：2009-02-13T17:19:33.823

pChart：[http ://pchart.sourceforge.net/](http://pchart.sourceforge.net/)

我个人用过这个，效果很好。

* * *

## 回答 #2

> 赞同：0
> 
>             
> 
> 时间：2010-09-17T16:54:33.377

我用过 jpGraph - 如果有点“老派”的话，看起来还不错。

# shell - 在 /bin/sh 中并行迭代两个列表

> ID：546817
> 
>         
> 
> 赞同：11
> 
>         
> 
> 时间：2009-02-13T17:17:07.887
> 
>         
> 
> 标签：shell, sh

我有两个长度相等的列表，各个项目中没有空格：

```
list1="a b c"
list2="1 2 3" 
```

我想并行迭代这两个列表，将 a 与 1 配对，将 b 与 2 配对，等等：

```
a 1
b 2
c 3 
```

我正在尝试支持现代便携式 Bourne shell，因此 Bash/ksh 数组不可用。在紧要关头对 awk 进行炮击是可以接受的，但如果可能的话，我宁愿将其保留在纯 sh 中。

感谢您提供的任何指示！

* * *

## 回答 #1

> 赞同：15
> 
>             
> 
> 时间：2009-02-13T18:19:04.490

Probably not portable (look at all those bash-isms!), but it is easy to read and someone else might find it useful...

```
list1="a b c"
list2="1 2 3"
array1=($list1)
array2=($list2)

count=${#array1[@]}
for i in `seq 1 $count`
do
    echo ${array1[$i-1]} ${array2[$i-1]}
done 
```

* * *

## 回答 #2

> 赞同：5
> 
>             
> 
> 时间：2009-02-13T18:24:41.653

This should be a fairly clean solution, but unless you use `bash`'s process substition, it requires the use of temporary files.  I don't know if that's better or worse than invoking `cut` and `sed` over every iteration.

```
#!/bin/sh

list1="1 2 3"
list2="a b c"
echo $list1 | sed 's/ /\n/g' > /tmp/a.$$
echo $list2 | sed 's/ /\n/g' > /tmp/b.$$

paste /tmp/a.$$ /tmp/b.$$ | while read item1 item2; do
    echo $item1 - $item2
done

rm /tmp/a.$$
rm /tmp/b.$$ 
```

* * *

## 回答 #3

> 赞同：4
> 
>             
> 
> 时间：2009-02-13T18:00:22.633

This is a bit hacky but does the job:

```
#!/bin/sh
list1="1 2 3"
list2="a b c"
while [ -n "$list1" ]
do
    head1=`echo "$list1" | cut -d ' ' -f 1`
    list1=`echo "$list1" | sed 's/[^ ]* *\(.*\)$/\1/'`
    head2=`echo "$list2" | cut -d ' ' -f 1`
    list2=`echo "$list2" | sed 's/[^ ]* *\(.*\)$/\1/'`
    echo $head1 $head2
done 
```

* * *

## 回答 #4

> 赞同：3
> 
>             
> 
> 时间：2015-01-25T13:11:34.730

This should be portable and also works with more than two lists:

```
#!/bin/sh
x="1 2 3 4 5"
y="a b c d e"
z="A B C D E"

while
    read current_x x <<EOF
$x
EOF

    read current_y y <<EOF
$y
EOF

    read current_z z <<EOF
$z
EOF

    [ -n "$current_x" ]
do
    echo "x=$current_x y=$current_y z=$current_z"
done 
```

Using positional paramers works, too. Please note, the list elements may not start with "-". Otherwise "set" will fail.

```
#!/bin/sh

x="1 2 3 4 5"
y="a b c d e"
z="A B C D E" 

while
    [ -n "$x" ]
do
    set $x
    current_x=$1
    shift
    x="$*"

    set $y
    current_y=$1
    shift
    y="$*"

    set $z
    current_z=$1
    shift
    z="$*"

    echo "x=$current_x y=$current_y z=$current_z"
done 
```

* * *

## 回答 #5

> 赞同：1
> 
>             
> 
> 时间：2009-02-13T17:55:01.243

没关系，看到“BOURNE”并想到“BOURNE AGAIN”。把它留在这里是因为它可能对某人有用，但显然不是问题的答案，对不起！

--

这有一些缺点（它不能优雅地处理不同大小的列表），但它适用于您给出的示例：

```
#!/bin/bash

list1="a b c"
list2="1 2 3"

c=0
for i in $list1
do
  l1[$c]=$i
  c=$(($c+1))
done

c=0
for i in $list2
do
  echo ${l1[$c]} $i
  c=$(($c+1))
done 
```

There are more graceful ways using common unix tools like awk and cut, but the above is a pure-bash implementation as requested

Commenting on the accepted answer, it didn't work for me in either linux or Solaris, the problem was the \S character class shortcut in the regexp for sed.  I replaced it with [^ ] and it worked:

```
#!/bin/sh
list1="1 2 3"
list2="a b c"
while [ -n "$list1" ]
do
    head1=`echo "$list1" | cut -d ' ' -f 1`
    list1=`echo "$list1" | sed 's/[^ ]* *\(.*\)$/\1/'`
    head2=`echo "$list2" | cut -d ' ' -f 1`
    list2=`echo "$list2" | sed 's/[^ ]* *\(.*\)$/\1/'`
    echo $head1 $head2
done 
```

* * *

## 回答 #6

> 赞同：1
> 
>             
> 
> 时间：2009-02-13T18:18:10.390

As a one liner:

```
list2="1 2 3"; 
list1="a b c"; 
for i in $list1; do 
    x=`expr index "$list2" " "`; 
    [ $x -eq 0 ] && j=$list2 || j=${list2:0:$x}; 
    list2=${list2:$x}; 
    echo "$i $j"; 
done 
```

* * *

## 回答 #7

> 赞同：1
> 
>             
> 
> 时间：2009-02-13T18:28:37.947

Solution not using arrays:

```
list1="aaa1 aaa2 aaa3"
list2="bbb1 bbb2 bbb3"

tmpfile1=$( mktemp /tmp/list.XXXXXXXXXX ) || exit 1
tmpfile2=$( mktemp /tmp/list.XXXXXXXXXX ) || exit 1

echo $list1 | tr ' ' '\n'  > $tmpfile1
echo $list2 | tr ' ' '\n'  > $tmpfile2

paste  $tmpfile1  $tmpfile2

rm --force $tmpfile1  $tmpfile2 
```

* * *

## 回答 #8

> 赞同：1
> 
>             
> 
> 时间：2009-02-14T00:57:13.833

I had been working on a sed-based answer when the first solutions started showing up here. But upon further investigation, it turned out that the items in the list were separated by newlines, not spaces, which allowed me to go with a solution based on head and tail:

```
original_revs="$(cd original && git rev-parse --all)" &&
working_revs="$(cd working && git rev-parse --all)" &&
while test -n "$original_revs"; do
    original_commit="$(echo "$original_revs" | head -n 1)" &&
    working_commit="$(echo "$working_revs" | head -n 1)" &&
    original_revs="$(echo "$original_revs" | tail -n +2)" &&
    working_revs="$(echo "$working_revs" | tail -n +2)" &&
    ...
done 
```

I'm posting this just in case somebody encounters this variant of the problem, but I'm awarding the accepted answer based on the problem as posted.

* * *

## 回答 #9

> 赞同：1
> 
>             
> 
> 时间：2012-10-26T01:17:45.800

```
$ list1="1 2 3"
$ list2="a b c"
$ echo "$list1 $list2" | awk '{n=NF/2; for (i=1;i<=n;i++) print $i,$(n+i) }'
1 a
2 b
3 c 
```

# windows - 如何以编程方式更改当前的 Windows 主题？

> ID：546818
> 
>         
> 
> 赞同：34
> 
>         
> 
> 时间：2009-02-13T17:17:13.267
> 
>         
> 
> 标签：windows, themes

我想让我的用户在[Aero](https://en.wikipedia.org/wiki/Windows_Aero)和 Windows Classic(1) 之间切换当前用户主题。有没有办法可以以编程方式做到这一点？

我不想弹出“显示属性”，我怀疑只是更改注册表。（这需要注销并重新登录才能使更改生效）。

应用程序皮肤（使用[Codejock](https://en.wikipedia.org/wiki/Codejock_Software)库）也不起作用。

有没有办法做到这一点？

该应用程序通过[RDP在](https://en.wikipedia.org/wiki/Remote_Desktop_Protocol)[Windows Server 2008](https://en.wikipedia.org/wiki/Windows_Server_2008)上托管/运行。

(1) 有问题的应用程序是托管的“远程应用程序”，我希望用户能够更改显示的应用程序的外观以匹配他们的桌面。

* * *

## 回答 #1

> 赞同：68
> 
>             
> 
> 时间：2011-02-03T03:11:07.983

您可以使用以下命令进行设置：

```
rundll32.exe %SystemRoot%\system32\shell32.dll,Control_RunDLL %SystemRoot%\system32\desk.cpl desk,@Themes /Action:OpenTheme /file:"C:\Windows\Resources\Themes\aero.theme" 
```

需要注意的是，这将显示主题选择器对话框。您可以立即终止该对话框。

* * *

## 回答 #2

> 赞同：20
> 
>             
> 
> 时间：2011-03-20T08:45:15.920

想要以编程方式更改当前主题当然有充分的理由。例如，自动化测试工具可能需要在各种主题之间切换，以确保应用程序与所有主题都能正常工作。

作为用户，您可以通过在 Windwos Explorer 中双击`.theme`文件，然后关闭弹出的控制面板小程序来更改主题。您可以轻松地从代码中执行相同的操作。下面的步骤对我来说很好。我只在 Windows 7 上测试过。

1.  用于`SHGetKnownFolderPath()`获取用户的“Local AppData”文件夹。主题文件存储在`Microsoft\Windows\Themes`子文件夹中。存储在那里的主题文件被直接应用，而存储在别处的主题文件在您执行它们时会被复制。所以最好只使用该文件夹中的文件。

2.  用于`ShellExecute()`执行`.theme`您在步骤 1 中找到的文件。

3.  等待应用主题。我只是让我的应用程序休眠 2 秒钟。

4.  调用`FindWindow('CabinetWClass', 'Personalization')`以获取应用主题时弹出的控制面板窗口的句柄。在非美国英语版本的 Windows 上，“个性化”标题可能会有所不同。

5.  调用`PostMessage(HWND, WM_CLOSE, 0, 0)`以关闭控制面板窗口。

这不是一个非常优雅的解决方案，但它可以完成工作。

* * *

## 回答 #3

> 赞同：12
> 
>             
> 
> 时间：2014-04-21T20:16:03.243

我知道这是一张旧票，但今天有人问我该怎么做。因此，从上面 Mike 的帖子开始，我清理了一切，添加了评论，并将发布完整的 C# 控制台应用程序代码：

 `````
using System;
using System.Collections.Generic;
using System.Diagnostics;
using System.Globalization;
using System.IO;
using System.Linq;
using System.Runtime.InteropServices;
using System.Text;
using System.Threading.Tasks;

using Microsoft.Win32;

namespace Windows7Basic
{
    class Theming
    {
        /// Handles to Win 32 API
        [DllImport("user32.dll", EntryPoint = "FindWindow")]
        private static extern IntPtr FindWindow(string sClassName, string sAppName);
        [DllImport("user32.dll")]
        private static extern IntPtr SendMessage(IntPtr hWnd, uint Msg, IntPtr wParam, IntPtr lParam);

        /// Windows Constants
        private const uint WM_CLOSE = 0x10;

        private String StartProcessAndWait(string filename, string arguments, int seconds, ref Boolean bExited)
        {
            String msg = String.Empty;
            Process p = new Process();
            p.StartInfo.WindowStyle = ProcessWindowStyle.Minimized;
            p.StartInfo.FileName = filename;
            p.StartInfo.Arguments = arguments;
            p.Start();

            bExited = false;
            int counter = 0;
            /// give it "seconds" seconds to run
            while (!bExited && counter < seconds)
            {
                bExited = p.HasExited;
                counter++;
                System.Threading.Thread.Sleep(1000);
            }//while
            if (counter == seconds)
            {
                msg = "Program did not close in expected time.";
            }//if

            return msg;
        }

        public Boolean SwitchTheme(string themePath)
        {
            try
            {    
                //String themePath = System.Environment.GetFolderPath(Environment.SpecialFolder.Windows) + @"\Resources\Ease of Access Themes\basic.theme";
                /// Set the theme
                Boolean bExited = false;
                /// essentially runs the command line:  rundll32.exe %SystemRoot%\system32\shell32.dll,Control_RunDLL %SystemRoot%\system32\desk.cpl desk,@Themes /Action:OpenTheme /file:"%WINDIR%\Resources\Ease of Access Themes\classic.theme"
                String ThemeOutput = this.StartProcessAndWait("rundll32.exe", System.Environment.GetFolderPath(Environment.SpecialFolder.System) + @"\shell32.dll,Control_RunDLL " + System.Environment.GetFolderPath(Environment.SpecialFolder.System) + "\\desk.cpl desk,@Themes /Action:OpenTheme /file:\"" + themePath + "\"", 30, ref bExited);

                Console.WriteLine(ThemeOutput);

                /// Wait for the theme to be set
                System.Threading.Thread.Sleep(1000);

                /// Close the Theme UI Window
                IntPtr hWndTheming = FindWindow("CabinetWClass", null);
                SendMessage(hWndTheming, WM_CLOSE, IntPtr.Zero, IntPtr.Zero);
            }//try
            catch (Exception ex)
            {
                Console.WriteLine("An exception occured while setting the theme: " + ex.Message);

                return false;
            }//catch
            return true;
        }

        public Boolean SwitchToClassicTheme()
        {
            return SwitchTheme(System.Environment.GetFolderPath(Environment.SpecialFolder.Windows) + @"\Resources\Ease of Access Themes\basic.theme");
        }

        public Boolean SwitchToAeroTheme()
        {
            return SwitchTheme(System.Environment.GetFolderPath(Environment.SpecialFolder.Windows) + @"\Resources\Themes\aero.theme");
        }

        public string GetTheme()
        {
            string RegistryKey = @"HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Themes";
            string theme;
            theme = (string)Registry.GetValue(RegistryKey, "CurrentTheme", string.Empty);
            theme = theme.Split('\\').Last().Split('.').First().ToString();
            return theme;
        }

        // end of object Theming
    }

    //---------------------------------------------------------------------------------------------------------------

    class Program
    {
        [DllImport("dwmapi.dll")]
        public static extern IntPtr DwmIsCompositionEnabled(out bool pfEnabled);

        /// ;RunProgram("%USERPROFILE%\AppData\Local\Microsoft\Windows\Themes\themeName.theme")      ;For User Themes
        /// RunProgram("%WINDIR%\Resources\Ease of Access Themes\classic.theme")                     ;For Basic Themes
        /// ;RunProgram("%WINDIR%\Resources\Themes\aero.theme")                                      ;For Aero Themes

        static void Main(string[] args)
        {
            bool aeroEnabled = false;
            Theming thm = new Theming();
            Console.WriteLine("The current theme is " + thm.GetTheme());

            /// The only real difference between Aero and Basic theme is Composition=0 in the [VisualStyles] in Basic (line omitted in Aero)
            /// So test if Composition is enabled
            DwmIsCompositionEnabled(out aeroEnabled);

            if (args.Length == 0 || (args.Length > 0 && args[0].ToLower(CultureInfo.InvariantCulture).Equals("basic")))
            {
                if (aeroEnabled)
                {
                    Console.WriteLine("Setting to basic...");
                    thm.SwitchToClassicTheme();
                }//if
            }//if
            else if (args.Length > 0 || args[0].ToLower(CultureInfo.InvariantCulture).Equals("aero"))
            {
                if (!aeroEnabled)
                {
                    Console.WriteLine("Setting to aero...");
                    thm.SwitchToAeroTheme();
                }//if
            }//else if
        }

        // end of object Program
    }
} 
````  `* * *

## 回答 #4

> 赞同：3
> 
>             
> 
> 时间：2019-09-04T16:11:54.710

我不确定这是否是新事物，但您只需双击 .theme 文件，Windows 10 就会应用该主题。因此，您可以使用 PowerShell 轻松完成此操作：

```
$Windows10Theme = "C:\Windows\Resources\Themes\aero.theme"
Invoke-Expression $Windows10Theme 
```

* * *

## 回答 #5

> 赞同：2
> 
>             
> 
> 时间：2009-02-13T17:31:29.363

我相信您能做的最好的事情就是打开您的目标 .msstyles 文件（在 中`c:\windows\resources\themes`），这将弹出显示属性框。此时，您可以使用窗口子类化以编程方式单击右侧按钮。

* * *

## 回答 #6

> 赞同：2
> 
>             
> 
> 时间：2012-09-17T10:43:13.280

除了“Jan Goyvaerts”的帖子：我使用 SendMessage 而不是 PostMessage。不同之处在于 SendMessage 等待命令被窗口接收。这意味着在 SendMessages 返回时，您知道主题对话框已关闭。

因此，如果您使用“Campbell”建议的怪异（但天才）rundll32.exe 方法启动它。在发送 WM_CLOSE 之前，您应该等待一秒钟。否则将不会设置主题并且应用程序会立即关闭。

下面的代码片段从资源（主题包）中提取文件。然后用rundll32.exe执行desk.cpl，等待3秒，然后发送WM_CLOSE（0x0010），等待命令被处理（设置主题所需的时间）。

```
 private Boolean SwitchToClassicTheme()
    {
        //First unpack the theme
        try
        {
            //Extract the theme from the resource
            String ThemePath = System.Environment.GetFolderPath(Environment.SpecialFolder.Windows) + @"\Resources\Themes\ClassicTheme.themepack";
            //WriteFileToCurrentDirectory("ClassicTheme.theme", TabletConfigurator.Resources.ClassicTheme);
            if(File.Exists(ThemePath))
            {
                File.Delete(ThemePath);
            }
            if(File.Exists(ThemePath))
            {
                throw new Exception("The file '" + ThemePath + "' exists and can not be deleted. You can try to delete it manually.");
            }
            using (BinaryWriter sw = new BinaryWriter(new FileStream(ThemePath, FileMode.OpenOrCreate)))
            {
                sw.Write(TabletConfigurator.Resources.ClassicTheme);
                sw.Flush();
                sw.Close();
            }

            if(!File.Exists(ThemePath))
            {
                throw new Exception("The resource theme file could not be extracted");
            }

            //Set the theme file as like a user would have clicked it
            Boolean bTimedOut = false;
            String ThemeOutput = StartProcessAndWait("rundll32.exe", System.Environment.GetFolderPath(Environment.SpecialFolder.System) + @"\shell32.dll,Control_RunDLL " + System.Environment.GetFolderPath(Environment.SpecialFolder.System) + "\\desk.cpl desk,@Themes /Action:OpenTheme /file:\"" + ThemePath + "\"", ref bTimedOut);

            System.Threading.Thread.Sleep(3000);
            //Wait for the theme to be set
            IntPtr hWndTheming = FindWindow("CabinetWClass", null);
            SendMessage(hWndTheming, (uint)WM_CLOSE, 0, 0);

            //using (Bitmap bm = CaptureScreenShot())
            //{
            //    Boolean PixelIsGray = true;
            //    while (PixelIsGray)
            //    {
            //        System.Drawing.Color pixel = bm.GetPixel(0, 0)
            //    }
            //}

        }
        catch(Exception ex)
        {
            ShowError("An exception occured while setting the theme: " + ex.Message);
            return false;
        }
        return true;
    } 
```

* * *

## 回答 #7

> 赞同：2
> 
>             
> 
> 时间：2018-03-05T20:55:06.650

较新的 Windows 版本（Windows 8 和 8.1，尚未在 W10 上尝试过）的命令是：

```
rundll32.exe themecpl.dll,OpenThemeAction %1 
```

或使用完整路径：

```
C:\WINDOWS\system32\rundll32.exe C:\WINDOWS\system32\themecpl.dll,OpenThemeAction %LocalAppData%\Microsoft\Windows\Themes\yourtheme.theme 
```

基本上它是从注册表中获取的 .theme 和 .themepack 扩展的*个性化 CPL “打开”命令......*

使用此命令后，您仍然会打开个性化窗口，因此要以编程方式关闭它，您必须使用上面提到的建议方法之一......（我个人更喜欢 Powershell 脚本）

* * *

## 回答 #8

> 赞同：1
> 
>             
> 
> 时间：2018-11-11T19:48:23.567

我刚刚意识到您可以双击主题并自动切换它 - 更简单，因此只需执行主题即可，例如批处理文件：

```
:: Reactivate my theme after an remote desktop session
:: We must select another theme first before we can select ours again and hence re-activate Aero, please wait..."
@echo Off
"C:\Windows\Resources\Themes\aero.theme"
::echo "Simulating a pause while"
ping 127.0.0.1 -n 10 > null && "D:\Users\danielsokolowski\Windows 7 Aero Themes\`danielsokolowski` Theme (without Glass).theme"
::or ping 127.0.0.1 -n 3 > null && "%userprofile%\AppData\Local\Microsoft\Windows\Themes\`danielsokolowski` Theme (without Glass).theme" 
```

* * *

## 回答 #9

> 赞同：1
> 
>             
> 
> 时间：2020-03-03T09:57:53.807

我一直在尝试通过命令行更改 Windows 主题，我了解到通过执行主题文件，它也被 Windows 10 应用。因此，在您的批处理文件中，您可以使用以下行之一：

```
C:\Users\%USERNAME%\AppData\Local\Microsoft\Windows\Themes\Dark_Mode.theme 
```

或者

```
C:\Users\%USERNAME%\AppData\Local\Microsoft\Windows\Themes\Light_Mode.theme 
```

请注意，主题文件的路径可能需要根据您的系统用户配置进行调整。我强烈建议您使用不包括空格的名称保存您的主题，因为这样可以更容易地向前推进。执行这样的行会打开设置窗口。为了处理我考虑改用 VBS 脚本。感谢 Patrick Haugh user1390106，有一种更简单的方法可以关闭“设置”窗口。

```
taskkill /F /IM systemsettings.exe 
```

因此批处理文件的更新版本可能如下所示：

```
@echo off
if %1 == dark (
REM ================== Go Dark ==================
color 09
echo.
echo   Applying DARK MODE
echo   Windows Theme ...
C:\Users\%USERNAME%\AppData\Local\Microsoft\Windows\Themes\Dark_Mode.theme
timeout /T 1 /nobreak > nul
taskkill /F /IM systemsettings.exe > nul
echo   DONE
) else (
REM ============== Return to Light ==============
color 30
echo.
echo   Applying LIGHT MODE
echo   Windows Theme ...
C:\Users\%USERNAME%\AppData\Local\Microsoft\Windows\Themes\Light_Mode.theme
timeout /T 1 /nobreak > nul
taskkill /F /IM systemsettings.exe > nul
echo   DONE
)
REM ================== Goodbye ==================
echo.
echo   Goodbye
cls
exit 
```

请注意，主题文件的路径可能需要根据您的系统用户配置进行调整。将上述脚本命名为 theme.bat 保存在驱动器中的某个位置。此批处理文件采用一个参数，该参数需要是`dark`或者任何其他`string`. 然后，您可以为此批处理文件准备两个快捷方式，每个快捷方式在其属性的“快捷方式”选项卡上名为“目标”的框中有以下内容之一：

```
C:\full-path-to-your-batch-file\theme.bat dark 
```

或者

```
C:\full-path-to-your-batch-file\theme.bat light 
```

请将“full-path-to-your-batch-file”替换为该文件的实际路径。以下是展示其工作原理的视频链接：

a) 走向黑暗 - [https://youtu.be/cBcDNhAmfyM](https://youtu.be/cBcDNhAmfyM)

b) 回归光明 – [https://youtu.be/2kYJaJHubi4](https://youtu.be/2kYJaJHubi4)

请注意，我在这些视频中的脚本也会激活/停用 chrome 的 Stylish 插件。我省略了解释我是如何完成这部分的，因为它不是本文的主题。

* * *

## 回答 #10

> 赞同：1
> 
>             
> 
> 时间：2020-07-29T15:03:00.800

对于 Windows 10，我在 PowerShell 中编写了这个简单的解决方案（也可以在 DSC 中使用）

```
# Apply your theme
& "C:\Windows\Resources\Themes\Brand.theme"
# We need to wait for the theme to be applied
Start-Sleep -s 5
# Close the settings window that is opened by the action above
$window = Get-Process | Where-Object {$_.Name -eq "SystemSettings"}
Stop-Process -Id $window.Id 
```

* * *

## 回答 #11

> 赞同：0
> 
>             
> 
> 时间：2018-07-16T20:21:24.873

好的，这就是我对此的看法 - 一个[VB 脚本](https://en.wikipedia.org/wiki/VBScript)。这有点讨厌，但我能想到的最好的（可悲的）。

对于登录的用户，我们只需`ChangeTheme.vbs`在用户登录时运行（例如自动运行）。脚本启动`desk.cpl`并将所需的参数以及所选主题的名称传递给它。

可以使用或不使用参数运行脚本：

```
> ChangeTheme.vbs
> ChangeTheme.vbs AnyThemeName 
```

剧本：

```
' ////////////////////////////////////////////////////////////////////
'
' Changes the theme.
'
' Name:
'     ChangeTheme.vbs
' Parameter 1: 
'     Theme name e.g. aero or anything 
'     located in in C:\Windows\Resources\Themes. 
'     If not present, a default theme will be used.
'
' Example: 
'     Inside a command line run
'     > ChangeTheme.vbs TheThemeName
'
' ////////////////////////////////////////////////////////////////////

If(Wscript.Arguments.Count <= 0) Then
  ' If no parameter was given we set the following theme as default
  selectedTheme = "aero"
Else
  ' Get theme via the first argument  
  selectedTheme = Wscript.Arguments(0)
End If

' Create WScript shell object
Set WshShell = WScript.CreateObject("WScript.Shell")

' Run the command to open the "theme application" (or whatever)
Set process = WshShell.Exec("rundll32.exe %SystemRoot%\system32\shell32.dll,Control_RunDLL %SystemRoot%\system32\desk.cpl desk,@Themes /Action:OpenTheme /file:""C:\Windows\Resources\Themes\" & selectedTheme & ".theme""")

' Wait for the application to start

Wscript.Sleep 250

Success = False
maxTries = 20
tryCount = 0

Do Until Success = True

  Wscript.Sleep 1000

  ' Set focus to our application    
  ' If this fails, or the application loses focus, it won't work!    
  Success = WshShell.AppActivate(process.ProcessId)

  tryCount = tryCount + 1

  If (tryCount >= maxTries) Then
    ' If it does not work after maxTries we give up ..
    MsgBox("Cannot change theme - max tries exceeded ..")
    Exit Do
  End If

Loop

' The crucial part: Send keys ALT + B for applying the theme    
WshShell.Sendkeys "%(B)"

' Send key "escape" to close the window
WshShell.Sendkeys "{ESCAPE}" 
```

希望有帮助。

* * *

## 回答 #12

> 赞同：0
> 
>             
> 
> 时间：2018-10-11T18:17:40.647

它适用于 Windows 10。

这是我的脚本。它更改主题并关闭窗口。我将它保存到一个批处理文件并从 TaskScheduler 运行这个补丁文件：

```
C:\WINDOWS\system32\rundll32.exe C:\WINDOWS\system32\themecpl.dll,OpenThemeAction C:\Users\xxx\Misc_computer_stuff\themes\my_fav_gr.theme

TIMEOUT 1 & REM Waits 1 seconds before executing the next command

TASKKILL /F /IM systemsettings.exe & close window

exit 
```

# c# - 关于 ExtensionAttribute 的奇怪警告

> ID：546819
> 
>         
> 
> 赞同：33
> 
>         
> 
> 时间：2009-02-13T17:17:44.093
> 
>         
> 
> 标签：c#, compiler-warnings

我收到一个奇怪的警告：

> 预定义类型 'System.Runtime.CompilerServices.ExtensionAttribute' 在全局别名中的多个程序集中定义；使用来自 'c:\Program Files\Reference Assemblies\Microsoft\Framework\v3.5\System.Core.dll' 的定义

没有给出行号，所以很难弄清楚它是关于什么的。

编译器错误代码是[CS1685](http://msdn.microsoft.com/en-us/library/8xys0hxk.aspx)

* * *

## 回答 #1

> 赞同：21
> 
>             
> 
> 时间：2009-02-13T17:20:19.140

您是否正在使用某人的 dll（或您自己的）本身已经实现了此属性（具有完全相同的名称）作为在 .Net 3.5 运行时之前使用某些 c# 3.0 功能的一种方式？（一个常见的技巧）

这是可能的原因。因为它使用的是正确的（GAC 中的 MS），所以这不是问题，尽管您应该找到另一个并将其删除。

* * *

## 回答 #2

> 赞同：12
> 
>             
> 
> 时间：2009-02-13T17:22:31.960

扩展 ShuggyCoUk 的（正确）答案

说实话，使用哪个版本的属性并不重要（GAC、第 3 部分等）。重要的是 C#/VB 编译器可以找到一些具有正确名称的属性。该属性在代码中没有任何功能用途。它的存在纯粹是为了告诉编译器“嘿，这是一种扩展方法”。  

您可以放心地忽略此警告。  

* * *

## 回答 #3

> 赞同：11
> 
>             
> 
> 时间：2011-04-28T21:45:05.937

我同意 ShuggyCoUk 的观点，即最好的做法是尝试删除有问题的 dll。不过，这可能是不可能的。

解决编译器抱怨的歧义的另一种方法是更改​​引用的 dll 的别名。在您的项目中，在 References 文件夹中，如果单击引用的 dll，您将看到 Aliases 属性。默认情况下，这是“global”，它允许您执行“global::SomeNamespace.SomeType”之类的操作。您可能只需将别名更改为其他名称。

这解决了我需要引用 Microsoft.Scripting.Core.dll 的问题，但它包含一些与 mscorlib.dll 冲突的类型。我将 Aliases 属性更改为“第三方”而不是“全局”，从而修复了警告。

* * *

## 回答 #4

> 赞同：1
> 
>             
> 
> 时间：2014-03-05T06:02:16.987

我也有同样的问题。

在我的情况下，问题是程序集 Mono.Cecil。

从本地引用迁移到 nuget，当我添加 NHibernate 引用时，包会自动添加此引用。

此引用已被删除，并再次编译了我的项目。

删除它并快乐！

这张图片取自 ILSpy ( [http://i.stack.imgur.com/Qyd5o.png](http://i.stack.imgur.com/Qyd5o.png) )

* * *

## 回答 #5

> 赞同：0
> 
>             
> 
> 时间：2009-02-13T17:22:08.623

编译器不知道哪个 System.Runtime.CompilerServices.ExtensionAttribute

所以它使用来自 c:\Program Files\Reference Assemblies\Microsoft\Framework\v3.5\System.Core.dll' 的定义

您正在使用的 .dll 可能具有相同的扩展名。

* * *

## 回答 #6

> 赞同：0
> 
>             
> 
> 时间：2015-06-02T14:13:45.693

我通过使用 .NET 3.5 而不是 4.5 安装 IIS 意外触发了此错误。

修复是在控制面板的“添加功能...”中重新添加 4.5。

# sql - 为子字符串查询优化 Mysql 表索引

> ID：546829
> 
>         
> 
> 赞同：3
> 
>         
> 
> 时间：2009-02-13T17:21:06.893
> 
>         
> 
> 标签：sql, mysql, database, indexing

我有一个 MySQL 索引问题要问你们。

我在 MySQL 中有一个非常大的表（约 1 亿条记录），其中包含有关文件的信息。我对其进行的大多数查询都涉及对文件路径列的子字符串操作。

这是表ddl：

```
CREATE TABLE `filesystem_data`.`$tablename` (
                `file_id` INT( 14 ) NOT NULL AUTO_INCREMENT PRIMARY KEY ,
                `file_name` VARCHAR( 256 ) NOT NULL ,
                `file_share_name` VARCHAR ( 100 ) NOT NULL,
                `file_path` VARCHAR( 900 ) NOT NULL ,
                `file_size` BIGINT( 14 ) NOT NULL ,
                `file_tier` TINYINT(1) UNSIGNED NULL, 
                `file_last_access` DATETIME NOT NULL ,
                `file_last_change` DATETIME NOT NULL ,
                `file_creation` DATETIME NOT NULL ,
                `file_extension` VARCHAR( 50 ) NULL ,
                INDEX ( `file_path`, `file_share_name` ) 
                ) ENGINE = MYISAM 
             }; 
```

因此，例如，我有一行带有 file_path 的行，例如：

```
'\\Server100\share2\Home\Zenshai\My Documents\' 
```

我将提取用户名（本例中为 Zenshai）

```
SELECT substring_index(substring_index(fp.file_path,'\\',6),'\\',-1) as Username
FROM (SELECT '\\\\Server100\\share2\\Home\\Zenshai\\My Documents\\' as file_path) fp 
```

它有点难看，但这不是我现在真正关心的问题。

我想要一些建议是什么类型的索引（如果有的话）可以帮助加速这个表上的这些类型的查询。也欢迎任何其他建议。

谢谢。

PS。尽管表变得非常大，但仍有足够的空间用于索引。

* * *

## 回答 #1

> 赞同：3
> 
>             
> 
> 时间：2009-02-13T17:27:00.543

您不能在当前表设计中使用索引。

您可以添加一个名为 的列，使用您在 中使用的表达式将`USERNAME`其填充到触发器中，然后在此列上进行搜索。`INSERT/UPDATE``SELECT`

**PS**只是好奇，你的服务器上真的有`100 mln+`文件吗？

* * *

## 回答 #2

> 赞同：2
> 
>             
> 
> 时间：2009-02-13T17:27:35.893

我会创建一个很小的（列，而不是记录计数）子表，它将文件路径分解并存储如下：

```
FK_TO_PARENT    PATH_PART
1               Server100
1               share2
1               Home
1               Zenshai
1               My Documents 
```

然后只需索引 PATH_PART。当然，如果父表超过 1 亿，那么这将进入数十亿条记录。

# iphone - 初始化一个类。你能看出这有什么问题吗？

> ID：546847
> 
>         
> 
> 赞同：0
> 
>         
> 
> 时间：2009-02-13T17:24:46.370
> 
>         
> 
> 标签：iphone, objective-c, cocoa-touch, xcode

```
-(id)init {

    if (self = [super init]) {

        self.name = [[NSString alloc] init];
        self.type = [[NSString alloc] init];
        self.phoneNumber = [[NSString alloc]init];
        self.webAddress = [[NSString alloc] init];

        NSMutableArray *pricesArray = [[NSMutableArray alloc] init];
        NSMutableArray *poolsArray = [[NSMutableArray alloc] init];
        self.prices = pricesArray;
        self.pools = poolsArray;

        [pricesArray release];
        [poolsArray release];

        //Create the address dictionaries
        NSMutableDictionary *addressItems = [[NSMutableDictionary alloc] initWithObjectsAndKeys:@"", KAddressStreet1Key, @"", KAddressStreet2Key, @"", KAddressBoroughKey, @"", KAddressCityKey, @"", KAddressCountyKey, @"", KAddressPostCodeKey, @"" ,KAddressCountryKey, nil];

        //Add dictionary to the array to contain address values
        self.address = addressItems;
        [addressItems release];

    }

    return self;
} 
```

由于错误，我目前正在进行大量调试`EXC_BAD_ACCESS`.. grr。

对于类 init 方法，上面的代码是否看起来很好且合乎逻辑？基本上，`EXC_BAD_ACCESS`当我释放两个池（可变数组和字典）时，我得到了错误。

* * *

## 回答 #1

> 赞同：1
> 
>             
> 
> 时间：2009-02-13T17:34:09.170

你的属性是如何声明的？如果它们没有被声明，`retain`那么你的大部分对象将在这个方法结束时被释放。

* * *

## 回答 #2

> 赞同：0
> 
>             
> 
> 时间：2009-02-13T18:17:40.720

您正在为字符串属性的每个分配泄漏对象。除此之外，我没有发现任何问题。AddressXKeys 是如何定义的？

# javascript - 有人可以解释这个 OOP javascript 结构吗

> ID：546854
> 
>         
> 
> 赞同：2
> 
>         
> 
> 时间：2009-02-13T17:27:27.970
> 
>         
> 
> 标签：javascript, oop

有人可以解释这个 OOP javascript 结构吗？

我意识到这是您在 javascript 中创建“对象”的方式，只需要对符号及其含义进行一些解释：

```
 var vote = function(){
     return {
            P1: function() {
                alert('P1');
            },

            P2: function() {
                alert('P2');
            }          

        };

    }();

    vote.P1();
    vote.P2(); 
```

1.  为什么返回调用中有公共方法？这怎么可能？被逗号隔开？

2.  为什么'object'的结尾必须是（）；?

3.  内部方法和公共方法的命名约定？

4.  公共属性和方法是相同的结构吗？有什么不同？

* * *

## 回答 #1

> 赞同：12
> 
>             
> 
> 时间：2009-02-13T17:35:23.550

```
var vote = function(){
    var privateMember = 3; // lets define a private member, this will only be available inside the function scope, so we can't do "vote.privateMember" because we're not returning it below

    // It's returning an object, {}
    // these are considered public because they are returned by the function, making them available outside the function scope using the "dot" operator, "vote.P1()"
    return {
        // first value of the object is a function
        // so we can call this like "vote.P1()"
        // we're calling a privateMember in here
        P1: function() {
            alert('P1');
            alert(privateMember);
        },
        // second value of the object is a function
        // so we can call this like "vote.P2()"
        P2: function() {
            alert('P2');
        }          
    };
}(); // () means it will execute the function, so "vote" will store the return value of this function, it's a shorthand for `var vote = function(){}; vote = vote(); 
```

私有方法的命名约定通常是在方法/属性名称之前放置一个下划线`_privateMethod: function(){}`。

* * *

## 回答 #2

> 赞同：2
> 
>             
> 
> 时间：2009-02-13T17:40:33.117

1.  它正在返回对象/哈希。请注意，在返回之后是一个 {，它是对象/散列的开头。

2.  运行返回对象的匿名函数。

3.  我不知道你的意思。

4.  是的，它们是一样的。属性可以是函数，因为 javascript 具有一流的函数。

这段代码是人为设计的，所以很难说任何有用的东西。我不确定作者的意图是什么。看起来他可能一直致力于创建一个类似类的东西，而不是 javascript 做基于原型的 OO 的方式。这段代码也可以很容易地编写出来。

```
var vote = {

        P1: function() {
            alert('P1');

        },

        P2: function() {
            alert('P2');
        }          

    }; 
```

* * *

## 回答 #3

> 赞同：2
> 
>             
> 
> 时间：2009-02-14T05:21:11.763

三个重要概念：匿名函数、对象字面量、闭包。

## 匿名函数

您可以声明和执行一个函数，而无需将其分配给变量。在你的例子中， foo 不是一个函数，它是调用的结果：

`var item = function(){ /*function code here*/ }**()**;`<- 因为函数正在执行，所以 item 是函数返回的对象，而不是函数。

## 对象文字

假设您这样做了：`var a = new Object(); a.foo = 'bar';`

对象文字符号如下所示：`var a = {foo: 'bar'};`

在您的示例中，您的匿名函数返回一个具有两个函数 P1 和 P2 的新对象。这只是指定对象的不同表示法。

## 关闭

当函数返回一个对象时，该对象保留对函数作用域的访问权——这称为闭包。所以，如果你这样做：

```
var a = function(){
  var _pvt = 'foo';
  return {
    aFunc: function(){alert(_pvt);}
  };
}();
a.aFunc(); 
```

`_pvt`的作用域是匿名函数。此函数使用一种方法 ( ) 返回一个新对象`aFunc`。匿名函数的作用域通过闭包对该对象可用，所以当`a.aFunc()`被调用时，`_pvt`将可用。

了解这一点的最佳地点是 YUI 剧院上的 Douglas Crockford 视频：http: [//video.yahoo.com/watch/111585/1027823](http://video.yahoo.com/watch/111585/1027823)

* * *

## 回答 #4

> 赞同：1
> 
>             
> 
> 时间：2009-02-13T17:36:23.953

这是 JSON（javascript 对象表示法）。它类似于python中的字典格式。  

数组可以使用内联定义

```
[1,2,3,4,5] 
```

并且可以使用内联定义对象

```
{ field1: value1, field2: value2, field3: value3 } 
```

也可以内联定义函数，

```
var a = function() { .... } //a is a function 
```

函数后面的 () 用于在函数定义后立即调用函数！因为函数是内联定义的，所以就像说：

```
x = function() { ... }
y = x(); 
```

但浓缩为：

```
y = function(){...} (); 
```

据我所知，没有公有私，都是公有的，函数和变量没什么区别，只是它们的类型是函数。

# c - 将数组和矩阵作为指针和指向 C 中的指针的指针传递给函数

> ID：546860
> 
>         
> 
> 赞同：16
> 
>         
> 
> 时间：2009-02-13T17:28:23.270
> 
>         
> 
> 标签：c, pointers, parameters

给定以下代码：

```
void
foo( int* array ) 
{
    // ...
}

void
bar( int** matrix ) 
{
    // ...
}

int
main( void ) {
    int array[ 10 ];
    int matrix[ 10 ][ 10 ];

    foo( array );
    bar( matrix );

    return 0;
} 
```

我不明白为什么会收到此警告：

> 警告：从不兼容的指针类型传递“bar”的参数 1

虽然'foo'调用似乎没问题。

谢谢 ：）

* * *

## 回答 #1

> 赞同：49
> 
>             
> 
> 时间：2009-02-13T17:58:13.277

嗯，C 社区当然不太了解它，这可以通过浏览 SO 看出。神奇的是，**以下所有内容完全是 100% 等价的**：

```
void foo(int (*array)[10]);
void foo(int array[][10]);
void foo(int array[10][10]);
void foo(int array[42][10]); 
```

区分指针和数组*非常重要。**数组不是指针*。数组可以转换为指向其第一个元素的指针。如果你有一个指针，你有这个：

```
--------
| ptr  |  -------> data
-------- 
```

但是，如果你有一个数组，你有这个：

```
---------------------------
| c1 | c2 | c3 | ... | cn |
--------------------------- 
```

使用指针，数据位于另一个星球，但通过指针链接。数组本身就有数据。现在，**多维数组只是数组的数组。**数组嵌套在父数组中。所以，你的数组的 sizeof 是：

```
(sizeof(int) * 10) * 10 
```

那是因为你有 10 个数组，它们都是 10 个整数的数组。现在，如果你想传递那个数组，它就会被转换。但是为了什么？指向其第一个元素的指针。元素类型*不是*指针，而是数组。因此，您将指针传递给 10 个 int 的数组：

```
int (*)[10] // a pointer to an int[10] 
```

它既不是 的数组`int*`，也不是`int**`。您可能会问为什么数组不作为`int**`. 这是因为编译器必须知道行长。如果您执行`array[1][0]`，编译器将`sizeof(int) * 10`在二维数组的开头以外的地方寻址一个字节。它以指向数组的类型解码该信息。

因此，您必须在上述完全等效的函数原型之一中进行选择。当然，最后一个只是令人困惑。如果参数被声明为数组，编译器会默默地忽略写在最外层维度中的任何数字。所以我也不会使用倒数第二个版本。最好是使用第一个或第二个版本。重要的是要记住**C 没有（真正的）数组参数**！该参数最终将是一个指针（在这种情况下是指向数组的指针）。

注意上面的多维情况与下面的退化的一维情况是如何相似的。以下 4 个版本都是完全等效的：

```
void foo(int *array);
void foo(int array[]);
void foo(int array[10]);
void foo(int array[42]); 
```

* * *

## 回答 #2

> 赞同：15
> 
>             
> 
> 时间：2009-02-13T17:36:09.837

在 C 中传递多维数组是一个棘手的问题。请参阅[此常见问题解答](http://c-faq.com/aryptr/ary2dfunc2.html)。

要问的问题是您将如何使用`bar`. 如果您总是知道它将传递一个 10x10 数组，那么将其重写为

```
bar(int matrix[10][10]); 
```

如果要处理不同维度的数组，则可能必须传入长度：

```
bar(int *matrix, int width, int height); 
```

* * *

## 回答 #3

> 赞同：6
> 
>             
> 
> 时间：2009-02-13T17:36:04.393

问题是数据结构matrix[10][10] 实际上不是一个包含十个指向array[10] 的指针的表，而是一个包含100 个整数的顺序数组。bar 的正确签名是

```
bar (int matrix[10][10]) 
```

如果您确实想使用间接表示矩阵并将 int **matrix 作为 bar 的参数类型，那么您需要以不同的方式分配它：

```
int *matrix[10];
int my_data[100];
int i;
for (i = 0; i < 10; i++) { matrix[i] = &(my_data[i * 10]); }
bar(matrix); 
```

现在 'matrix' 匹配 int ** 类型。'matrix' 是一个由十个指针组成的数组，你可以通过指针传递它，从而得到第二个 *.

* * *

## 回答 #4

> 赞同：3
> 
>             
> 
> 时间：2012-06-30T13:00:53.827

这是一些要练习的代码 - 它包含所有可能的传递二维数组类型和访问元素值的代码

```
#include <stdio.h>

#define NUMROWS 2
#define NUMCOLUMNS 5

#define FILL_ARRAY() \
    *array[0] = '1'; \
    (*array)[7] = '2'; \
    *(array[1]) = '3'; \
    *(*(array+1)+1) = '4'; \
    *(array[0]+3) = '5'; \
    *(*array+2) = '7'; \
    array[0][1] = '6'; 

void multi_01( char (*array)[NUMCOLUMNS] )       { FILL_ARRAY(); }
void multi_02( char array[][NUMCOLUMNS] )        { FILL_ARRAY(); }
void multi_03( char array[NUMROWS][NUMCOLUMNS] ) { FILL_ARRAY(); }
void multi_04( char **array )                    { FILL_ARRAY(); }
void multi_05( char *array[] )                   { FILL_ARRAY(); }
void multi_06( char *array[NUMCOLUMNS] )         { FILL_ARRAY(); }

int main(int argc, char **argv)
{
    int i;
    char mystr[NUMROWS][NUMCOLUMNS] = { { 'X', 'X', 'X', 'X'}, {'X','X','X'} };
    char *pmystr[sizeof(mystr)/sizeof(*mystr)];
    int numcolumns = sizeof(*mystr);
    int numrows = sizeof(mystr)/sizeof(*mystr);
    for( i=0; i<numrows; i++ ) pmystr[i] = *(mystr+i);

    multi_01( mystr );  multi_02( mystr );  multi_03( mystr );
    multi_04( pmystr ); multi_05( pmystr ); multi_06( pmystr );

    printf("array '%s', '%s'\n", mystr[0], mystr[1]);

    getc(stdin);
    return 0;
} 
```

* * *

## 回答 #5

> 赞同：2
> 
>             
> 
> 时间：2009-02-13T17:31:26.650

您应该将 bar 定义为：

```
bar( int* matrix ) 
```

在 C 中，所有数组都应该作为`int*`（或`type_of_element*`其他类型）传递。

`int **`如果你的数据真的是一个指针数组，那就没问题了。  `int[*data[]`例如。这就是你得到的`main(int argc, char *argv[])`。

* * *

## 回答 #6

> 赞同：-1
> 
>             
> 
> 时间：2009-02-13T17:42:32.410

```
int **matrix 
```

将表明您有一个指向 int 的指针。这通常用于指示指向指针数组（也称为向量）的指针。绝对不是这种情况

```
int matrix[10][10] 
```

这更像是一个指向大小为 10x10 整数的单个内存部分的指针。尝试更改为：

```
void bar(int *matrix[]) 
```

# asp.net-membership - 自动生成的密钥不支持散列或加密密码

> ID：546861
> 
>         
> 
> 赞同：11
> 
>         
> 
> 时间：2009-02-13T17:28:36.063
> 
>         
> 
> 标签：asp.net-membership

我创建了一个会员提供程序并将我的 web.config 更改为

```
<membership defaultProvider="MyMembershipProvider">
   <providers>
     <clear/>
     <add name="MyMembershipProvider"
          type="Khafan.Providers.SqlMembershipProvider"
          connectionStringName="KhafanConnectionString"  
          maxInvalidPasswordAttempts="5"             
          passwordAttemptWindow="10"
          minRequiredNonalphanumericCharacters="0"
          minRequiredPasswordLength="4"
          passwordStrengthRegularExpression=""
          passwordFormat="Hashed"
          enablePasswordReset="true"
          enablePasswordRetrieval="false"             
          requiresQuestionAndAnswer="false"
          requiresUniqueEmail="true" />
   </providers>
 </membership> 
```

但是现在，每当我尝试浏览到 ASP.Net 配置的安全页面时，都会出现以下错误：

**自动生成的密钥不支持散列或加密密码**

在我的数据库中，我为我的 PK 使用了 Identity。我不知道这是不是问题。但如果是，我该如何解决？我不想更改身份值。

谢谢。

* * *

## 回答 #1

> 赞同：21
> 
>             
> 
> 时间：2009-02-13T17:36:34.407

这是因为您正在对密码进行哈希处理，但尚未在 web.config 中设置特定密钥。[这篇MSDN 文章](http://msdn.microsoft.com/en-us/library/ms998288.aspx)中有一个“密钥生成器”片段，运行它两次并将它们推到你的 web.config 中：

```
<system.web>
    <machineKey  
    validationKey="<blah>"           
    decryptionKey="<blah>"
    validation="SHA1"
    decryption="AES"
    /> 
```

那应该可以解决您的问题。之所以这样，是因为否则您可以将您的会员数据库/应用程序带到另一台机器上，并且您的密码都不起作用，因为自动生成的机器密钥会有所不同:-)

* * *

## 回答 #2

> 赞同：4
> 
>             
> 
> 时间：2010-07-12T11:01:45.937

[在MSDN 链接](http://msdn.microsoft.com/en-us/library/ms998288.aspx)Steven Robbins 在他的回答中提到的“密钥生成器”片段中寻找“密钥生成器”片段有点笨拙 
，所以我在这里添加它以供快速参考。所以这不是一个独立的答案。它是对已接受答案的补充。

**来自 MSDN**

> 以下代码显示了如何生成随机键值。编译代码以创建控制台应用程序，然后将所需的密钥大小作为命令行参数传递，以所需的十六进制字符数表示。每个字节由两个十六进制字符表示；因此，要请求 32 字节的密钥，请将 64 作为命令行参数传递。如果不指定参数，代码将返回 128 个十六进制字符（64 字节）的密钥。

```
using System;
using System.Text;
using System.Security;
using System.Security.Cryptography;

class App {
  static void Main(string[] argv) {
    int len = 128;
    if (argv.Length > 0)
      len = int.Parse(argv[0]);
    byte[] buff = new byte[len/2];
    RNGCryptoServiceProvider rng = new 
                            RNGCryptoServiceProvider();
    rng.GetBytes(buff);
    StringBuilder sb = new StringBuilder(len);
    for (int i=0; i<buff.Length; i++)
      sb.Append(string.Format("{0:X2}", buff[i]));
    Console.WriteLine(sb);
  }
} 
```

此外，`<machineKey>`进入 内部`<system.web>`，如下所示：

```
<system.web>
    <machineKey
        validationKey=""
        decryptionKey=""
        validation="SHA1"
        decryption="AES"
/> 
```

# javascript - 注入子元素时触发jQuery mouseout

> ID：546863
> 
>         
> 
> 赞同：1
> 
>         
> 
> 时间：2009-02-13T17:28:58.683
> 
>         
> 
> 标签：javascript, jquery, events, javascript-events

我正在尝试创建一个函数，当您将鼠标悬停在缩略图上时，该函数将在缩略图上添加叠加层，并在您离开时移除叠加层。这是我的HTML...

```
<div class="thumb"><img src="i/testThumb.gif" /></div> 
```

这是我的 jQuery ......

```
$('.thumb').live('mouseover', function(event){
    if($(this).find('.overlay').length == 0){
        $(this).prepend('<div class="overlay"></div>');
    }
    return false;
});
$('#galleryPanel .thumb').live('mouseout', function(event){
    $(this).find('.overlay').remove();
    return false;
}); 
```

问题在于，当创建叠加层时，鼠标已经在它上面，这会触发容器的“mouseout”，这会移除叠加层，并且它会不断循环闪烁。

有一个简单的解决方案吗？

* * *

## 回答 #1

> 赞同：1
> 
>             
> 
> 时间：2009-02-13T22:42:28.867

如果你再添加一个 div，我想你可能会找到你想要的东西。

```
<style>
.hover { display:none;}
</style>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.2.6/jquery.min.js"></script>
<script>
$(document).ready(function(){

   $(".image").hover(
   function(over) {
     $(this).find(".hover").animate({opacity: "show", top: "55"}, "slow");
   },
   function(out) {
     $(this).find(".hover").animate({opacity: "hide", top: "55"}, "slow");
   });

}); 
</script>

<div class='image'>
    <div class='imageClass'>
        <img src='img1.jpg' />

        <div class='hover'>
            <img src='img1.jpg' />
        </div>

    </div>
</div> 
```

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2009-02-13T22:59:31.853

而不是将mouseout绑定到“.thumb”尝试将其绑定到“.overlay”。

```
$('#galleryPanel .overlay').live('mouseout', function(event){
    $(this).remove();
    return false;
}); 
```

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2009-02-13T17:35:50.897

这可能听起来有点 hacky，但您可以使用变量（在 dom 元素的情况下，我会使用 css 类）来了解这是否是事件第一次在此元素上触发。

基本上，您的函数会在 dom 元素上查找此 css 类的存在，但在创建它时默认情况下它不存在。如果它不存在，请添加该类并退出该函数。如果它在那里，命中是有效的，你应该执行你的覆盖功能。由于您可以在 dom 元素上拥有多个类，因此这不应与用于样式的任何其他类产生任何冲突。我会说使用类而不是自定义属性，因为自定义属性会使您的 html 对搜索爬虫“无效”。

# java - Java将图像添加到BLOB数据字段

> ID：546867
> 
>         
> 
> 赞同：1
> 
>         
> 
> 时间：2009-02-13T17:29:45.233
> 
>         
> 
> 标签：java, derby, embedded-database

对于我被分配的这项大学作业。

我必须开发一个应用程序，以便在以嵌入式模式运行 J2ME 和 Apache Derby 的 PDA 上使用。

我想将图像导入/导出到数据库。我该怎么做？将图像存储为 blob 是否合适？

* * *

## 回答 #1

> 赞同：1
> 
>             
> 
> 时间：2009-02-13T20:01:22.717

To retrieve and upload your images from the database you will need the Derby JDBC driver.  Read the [Derby wiki](http://wiki.apache.org/db-derby/) for more info. 

[Blob](http://en.wikipedia.org/wiki/Binary_large_object) stands for binary large object, and would be good to store an image in. 

[JDBC tutoiral](http://java.sun.com/docs/books/tutorial/jdbc/basics/index.html)

Using Derby on Java ME platforms [wiki page](http://wiki.apache.org/db-derby/JavaMESupport).

Good Luck.

# c# - 在 c# 中将一组成员标记为私有/公共

> ID：546869
> 
>         
> 
> 赞同：3
> 
>         
> 
> 时间：2009-02-13T17:30:51.520
> 
>         
> 
> 标签：c#, class, declaration, private, members

在 c++ 类声明中，您可以将一组成员标记为私有或公有，例如

```
private:
  int x;
  double y; 
```

似乎在 c# 中没有办法做到这一点。我错了吗？

* * *

## 回答 #1

> 赞同：7
> 
>             
> 
> 时间：2009-02-13T17:33:37.003

不，您不能在 C# 中执行此操作。

充其量，您可以使用成员的默认可见性，这是​​私有的，并且不使用私有，但对于公共，您必须为所有成员指明它。

* * *

## 回答 #2

> 赞同：2
> 
>             
> 
> 时间：2009-02-13T17:34:02.353

你是对的。但是，如果您完全关闭可见性关键字，则成员默认为私有。

* * *

## 回答 #3

> 赞同：1
> 
>             
> 
> 时间：2009-02-13T17:33:29.797

不，你没有错。如果您不编写任何修饰符，它将被假定为私有。

# .net - 为什么 .NET 中大小为 8 的字体显示为 8.25？

> ID：546870
> 
>         
> 
> 赞同：20
> 
>         
> 
> 时间：2009-02-13T17:30:54.373
> 
>         
> 
> 标签：.net, fonts, font-size

例如，当您在 Microsoft Sans Serif 的字体对话框中选择大小为 8 时，它会返回 .NET 显示为大小为 8.25 的字体？

为什么会这样？

* * *

## 回答 #1

> 赞同：36
> 
>             
> 
> 时间：2009-02-13T17:46:28.347

一个点是 1/72 英寸，所以字体应该是 8/72 (0.111111) 英寸高。Windows 假定标准显示为 96 DPI，除非您煞费苦心地对其进行配置。这意味着它会尝试创建一个 10.66667 像素高的字体；它四舍五入到 11 个像素。当您将其转换回点 ((11 / 96) * 72) 时，它变为 8.25。

* * *

## 回答 #2

> 赞同：2
> 
>             
> 
> 时间：2009-02-13T17:36:15.903

这很可能是由于 Windows 字体映射器计算字体大小的方式。字体单元的像素高度与正常“点”@ 1/72 英寸之间存在细微差别。

更多信息在这里：http: [//msdn.microsoft.com/en-us/library/ms969909.aspx](http://msdn.microsoft.com/en-us/library/ms969909.aspx)

# wpf - 跨平台 2D 矢量 + 光栅 API + 硬件加速 - 这存在吗？

> ID：546871
> 
>         
> 
> 赞同：3
> 
>         
> 
> 时间：2009-02-13T17:31:07.523
> 
>         
> 
> 标签：wpf, user-interface, qt, opengl

要求：

*   保留图形模式 API

*   仅适用于 2D 对象（尽管这些 2D 对象的 3D 变换很有趣）

*   跨平台

*   矢量图形绘图

*   光栅合成 + 支持不透明蒙版 - 当然是硬件加速......

*   动画 API

*   封装尺寸——它可以在嵌入式环境中运行吗？

这不是针对游戏的，但我不反对使用游戏类型 API。

一些想法：

Qt 可能太重了，但我对 API 不够熟悉，不知道它是否符合要求。我对 Qts 窗口管理（没有窗口）或小部件/控件集不感兴趣，因为它不适用于桌面类型的应用程序。另外，我不确定Qt是否有动画框架？想法在这里？

这很可能是一个建立在 OpenGL 之上的框架。我只是不知道这样的事情是否存在。另外，我不清楚 OpenGL 中的 2D 图形。2D 图形是真正的 2D 还是只是在面向 2D 的平面上绘制的 3D 对象？

WPF 对于 DirectX 就像 _____________ 对于 OpenGL

如果可以填补空白，那就是我正在寻找的。

**更新#2**

这个周末我花了一些时间在 Qt 上，发现了 QGraphicsScene 类——这似乎是 Qt 的 2D 保留类型图形模式的基础类——以及 QGraphicsWidget，它允许 QWidget 类的一些自动布局功能。

Qt 即将通过我的试金石。最后要弄清楚的一件事是在处理矢量图像时，一个优秀的设计师到开发人员的工作流程，即，我如何将在 Illustrator 中创建的图标转换为 QGraphicsItem - 这可能是新的（更专注）的一个很好的候选者问题。

* * *

## 回答 #1

> 赞同：5
> 
>             
> 
> 时间：2009-02-13T17:37:26.823

你可能想看看[Cairo](http://cairographics.org/)，它有一个 OpenGL 后端。我认为它没有动画 API。

* * *

## 回答 #2

> 赞同：2
> 
>             
> 
> 时间：2009-02-13T19:18:24.053

至于使用 Qt。

在任何有意义的意义上，它都不是重量级的。动态库只有几兆，我相信图形操作非常优化。

它没有使用 OpenGL 加速的稳定版本——这是在 Qt4.5 中出现的。

它确实使用 XRender 或其他东西，用于 2D 加速

它还有一个很棒的绘图 API 和一个动画 API（用于简单事物的 QTimeLine 和最近更强大的 QtAnimation）

* * *

## 回答 #3

> 赞同：1
> 
>             
> 
> 时间：2009-02-13T19:02:46.697

虽然 OpenGL 是一个很好的 3D 渲染工具，但重要的是要了解输出媒体本质上是 2D 的。第三维度的感知是通过视觉线索来实现的，例如照明、远处物体看起来比近处物体小、近处物体遮挡远处物体。

这些视觉线索被实现为图形管道各个阶段的计算。照明和着色、视口变换和深度查询是用于创建 3D 幻觉的一些操作。

将 OpenGL 用于 2D 时，可以忽略许多通常用于 3D 渲染的管道操作。由于减少了计算，这可以提高性能，并具有简化源代码的额外好处。还有一些专门用于 2d 栅格的操作，例如绘制精灵。

与其将 2D 渲染视为一组简化的 3D 渲染，我建议您将 3D 渲染视为精心构建的 2D 元素的结果。

* * *

## 回答 #4

> 赞同：0
> 
>             
> 
> 时间：2009-02-13T19:10:29.470

WPF 也是 3D 的。该库经过调整和设计，使 2D 变得容易，但它也包含所有 3D 转换。

# java - 您对构建 Web 应用程序的开发框架和工具有何经验？

> ID：546874
> 
>         
> 
> 赞同：1
> 
>         
> 
> 时间：2009-02-13T17:31:57.973
> 
>         
> 
> 标签：java, asp.net, ruby-on-rails

我已经建立网站大约 10 年了。2 年前我开始使用 ASP.Net。我现在正在处理 2 个项目，一个使用 ASP.Net MVC，另一个使用 Java / JSF / Spring / Hibernate。我还使用过其他框架（cgi/perl、php、ASP、jsp、jsf）。

您认为构建 Web 应用程序最高效的编程环境是什么？

我没有使用过其他框架，例如 Ruby on Rails、Glass Fish 等。是否有任何我可能会遗漏并应该查看的框架？

我真的很想听听有 Ruby on Rails 经验的人的意见。

* * *

## 回答 #1

> 赞同：4
> 
>             
> 
> 时间：2009-02-13T17:40:38.780

我发现这与特定的语言或环境无关，而是你作为一名程序员自己对它的适应程度——你花在一种语言上的时间越多，你的效率就越高。

你可以给我一把锤子，我可能无法用它建造房子。但是把锤子放在知道自己在做什么的人手中，他们会用它做出美丽的东西。

* * *

## 回答 #2

> 赞同：3
> 
>             
> 
> 时间：2009-02-13T17:40:11.887

坦率地说，这取决于您对环境的熟悉程度。RoR/Django 当然*可以*缩短开发时间，但是如果您非常了解 ASP，那么可能不值得付出努力（另外，如果您使用它，您将放弃可视化设计器）。Django/Rails 中的样板文件更少，更“神奇”。

还值得注意的是，假设您对此感到满意，您最终将把对数据库的更直接控制权交给 ORM 以按照“Rails 方式”做事。

* * *

## 回答 #3

> 赞同：2
> 
>             
> 
> 时间：2009-02-13T17:36:46.123

作为一个长期的铁路开发者，它得到了我的投票。但我认为重要的因素是 MVC 基础。它确实可以真正设置骨架，而您只需清除逻辑即可。我的客户总是对我添加或更改内容的速度印象深刻。

* * *

## 回答 #4

> 赞同：1
> 
>             
> 
> 时间：2009-02-13T19:17:49.093

我也使用了多种语言和框架，来自 .Net（MVC 和 Webforms）、Classic ASP、RoR、Merb 和 Django。正如上面其他人所说，您最有效率的将是您最熟悉的那个。但是，我相信不断探索其他框架（和语言）将使您作为开发人员受益。它让您更清楚地了解您当时可能正在使用的框架的优缺点，还可以提供一些关于如何在任何给定框架中更好地工作的见解。

* * *

## 回答 #5

> 赞同：1
> 
>             
> 
> 时间：2009-02-13T17:54:50.807

最高效的环境永远是你最了解的环境。在过去的 10 年里，我几乎一直在做 java 开发，所以几乎所有我想写的东西我都默认使用 java（除非使用其他东西有明显的优势），而且我对此非常有效率。

但是还有另一个问题：最好的网络编程语言是什么？无需进入语言 1 与语言 2 的技术辩论，它是生产力和开发效率的重要组成部分。我是一个非常高效的 Java 开发人员，但如果这些工具不适合这项工作，那也没关系。我最高效的语言可能不是最有效的。如果我在 2 小时内编写 500 行 Java 代码来解决一个问题，那该死的效率很高。但如果我在 10 分钟内用 5 行 Wonder-Language++ 达到相同的结果，那是有效率的。

看看你想要什么：目标。

看看你有什么：你的工具

考虑如何从 AB 获得

如果您的经验与我自己的相似，您会意识到虽然有些工具非常通用，但没有一个开发的银弹，甚至在 Web 上也是如此。

-梅尔

# mysql - 用于更新的 MySql UNION

> ID：546879
> 
>         
> 
> 赞同：4
> 
>         
> 
> 时间：2009-02-13T17:33:26.037
> 
>         
> 
> 标签：mysql, union

有没有办法使用单个 SQL 查询为每行更新具有不同值的多行？我必须用不同的数据更新多行中的一列。对每一行使用单独的更新查询似乎太过分了，所以如果可能的话，我想将此过程合并到一个 SQL 语句中，或者至少减少所需的查询数量。

我将 PHP 与 Zend 框架和 MySql 一起使用。

* * *

## 回答 #1

> 赞同：7
> 
>             
> 
> 时间：2009-02-13T17:40:48.360

创建一个临时表并填写：

```
CREATE TEMPORARY TABLE temptable (id INTEGER, VALUE VARCHAR(200))

INSERT
INTO temptable
VALUES
  ('1', 'val1'),
  ('2', 'val2'),
  ('3', 'val3'),
  ('4', 'val4') 
```

然后发出：

```
UPDATE
  mytable m, temptable t
SET m.value = t.value
WHERE m.id = t.id 
```

* * *

## 回答 #2

> 赞同：2
> 
>             
> 
> 时间：2009-02-13T17:50:25.153

不具体了解 MySQL，但是要根据 SELECT 或多个 SELECT 的 UNION 更新多行，我会这样做

```
UPDATE U
SET MyColumn = T.OtherColumn
FROM MyUpdateTable AS U
     JOIN
     (
         SELECT [OtherColumn] = OtherColumn1
         FROM MyOtherTable1
         WHERE ...
         UNION
         SELECT OtherColumn2
         FROM MyOtherTable2
         WHERE ...
     ) AS T
         ON T.ID = U.ID 
```

2014 年 10 月 28 日更新，转换为适用于 MySQL：

```
UPDATE MyUpdateTable AS U
    JOIN
    (
        SELECT [OtherColumn] = OtherColumn1
        FROM MyOtherTable1
        WHERE ...
        UNION
        SELECT OtherColumn2
        FROM MyOtherTable2
        WHERE ...
    ) AS T
        ON T.ID = U.ID
        SET MyColumn = T.OtherColumn 
```

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2009-02-13T17:46:39.077

我知道这适用于 SQL Server，所以在 MySQL 中值得一试。

```
update xtable
set a = 
   Case
     when a = "a"
     then z
     when a = "b"
     then y
   End
where ... 
```

您可以根据不同的行构造 case 语句。

# c# - 哪个 Windows 消息触发了表单的加载事件？

> ID：546885
> 
>         
> 
> 赞同：0
> 
>         
> 
> 时间：2009-02-13T17:34:39.403
> 
>         
> 
> 标签：c#, .net, winforms, winapi

我发布了这个[答案](https://stackoverflow.com/questions/546348/vb-net-2005-global-event-handler/546450#546450)（更多的是一个想法），但无法确定哪条消息触发了 WinForms [Form.Load](http://msdn.microsoft.com/en-us/library/system.windows.forms.form.load.aspx)事件。从 Spy++ 和一些阅读中我建议它可能是 WM_SHOWWINDOW，但我想确定一下。

此外，除了 Spy++ 之外，还有更好的方法来准确查看哪个 Windows 消息触发了 .Net 事件？即使在 Spy++ 中关闭某些事件类型后，日志窗口也会很快填满。

谢谢。

* * *

## 回答 #1

> 赞同：3
> 
>             
> 
> 时间：2009-02-13T17:38:41.250

没有与 Form 类上的 Load 事件相对应的特定 Windows 消息。该事件只是在创建窗体的窗口句柄后第一次使窗口可见之前触发。

它用于初始化，需要创建窗体的窗口句柄，但在窗体第一次显示之前。

* * *

## 回答 #2

> 赞同：0
> 
>             
> 
> 时间：2009-02-13T17:51:00.643

我在这里猜测，但配置您的开发环境以使用 Microsoft 的源服务器，然后查看 System.Windows.Forms 代码可能是有益的。请参阅 Shawn Burke 的博客文章[配置 Visual Studio 以调试 .NET Framework 源代码](http://blogs.msdn.com/sburke/archive/2008/01/16/configuring-visual-studio-to-debug-net-framework-source-code.aspx)。

# iframe - 获取 iFrame 的最新内容

> ID：546896
> 
>         
> 
> 赞同：0
> 
>         
> 
> 时间：2009-02-13T17:36:49.990
> 
>         
> 
> 标签：iframe

是否可以从 iframe 获取最新内容？让我解释一下我遇到的问题：

```
function modify_iframe(url){
  my_iframe.src  = url;
  iframe_content = my_iframe.contentDocument;
  //....code to modify the content goes here,,,,
} 
```

我第一次调用`modify_iframe(url_a)`它时设置了我所期望的源，但 iframe_content 是一个空白文档。  

我第二次运行`modify_iframe(url_b)`它时设置了我所期望的源，但`iframe_content`实际上是`url_a`.

所以看起来 contentDocument 不是返回新源的内容，而是在它被改变之前的源。任何人都知道为什么会这样以及是否有解决方法？

附加背景信息：我们一直在添加一个事件侦听器来触发 iframe 加载事件，该事件在 src 更改时发生。这在调用 contentDocument 时给了我们内容；但是，即使我们对包括 src 在内的所有内容都使用 https，用户仍会被提示我们的网站包含未经身份验证的内容。移除事件监听器后，我们不再收到未经身份验证的内容警告，但我们的 iframe 的 contentDocument 总是落后一步，如上所述。

* * *

## 回答 #1

> 赞同：0
> 
>             
> 
> 时间：2009-02-13T18:39:51.807

嗯，首先尝试使用 setTimeout 来等待页面内容加载。但这不是一个好的解决方案。你在什么浏览器上测试？如果是我，我会尝试深入了解“未经身份验证的内容”错误提示。

# iphone - 有什么方法可以判断我的 iPhone 应用程序是否在运行时在调试器下运行？

> ID：546899
> 
>         
> 
> 赞同：4
> 
>         
> 
> 时间：2009-02-13T17:38:13.653
> 
>         
> 
> 标签：iphone, xcode, debugging, macos, gdb

如果我的错误处理代码在调试器下运行，我希望它的行为有所不同。具体来说，如果我在手机上运行，​​没有连接到调试器并且断言失败，我想将错误发送到我的服务器。当我在gdb下时，我想闯入调试器。

尽管我可以想象 Apple 将如何编写代码，但我找不到任何关于运行时方式的文档来测试调试器的存在。

* * *

## 回答 #1

> 赞同：5
> 
>             
> 
> 时间：2009-02-13T21:04:32.143

[这里](http://lists.apple.com/archives/Xcode-users/2004/Feb/msg00241.html)描述的方法对我来说很好

我把它放在`-(void)viewDidLoad`

```
- (void)viewDidLoad {
    [super viewDidLoad];

    int mib[4];
    size_t bufSize = 0;
    int local_error = 0;
    struct kinfo_proc kp;

    mib[0] = CTL_KERN;
    mib[1] = KERN_PROC;
    mib[2] = KERN_PROC_PID;
    mib[3] = getpid();

    bufSize = sizeof (kp);
    if ((local_error = sysctl(mib, 4, &kp, &bufSize, NULL, 0)) < 0) {
        label.text = @"Failure calling sysctl";
        return;
    }
    if (kp.kp_proc.p_flag & P_TRACED)
        label.text = @"I am traced";
    else
        label.text = @"I am not traced";
} 
```

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2009-02-13T17:40:51.090

为什么不重新定义断言来做你想做的事，而不是为调试而编译？

另一种选择是创建自己的断言函数，然后可以在加载到 GDB 时添加断点。

断言原型是

无效断言（int表达式）；

```
void assert(int expression)
{
    if( !expression )
    {
       // enable break point here
       // log to server
    }
} 
```

或将断点添加到服务器代码的日志中。

# javascript - IE onPaste 事件使用 javascript 而不是 HTML

> ID：546905
> 
>         
> 
> 赞同：3
> 
>         
> 
> 时间：2009-02-13T17:38:57.927
> 
>         
> 
> 标签：javascript, internet-explorer, javascript-events

似乎将 onPaste 事件添加到输入元素的唯一方法是使用 HTML：

```
<textarea id="text_area" onpaste="on_paste" /> 
```

而不是能够使用javascript附加事件处理程序：

```
document.getElementById('text_area').onPaste = function() { alert('I iz in ur textbox, pasting some text') }; 
```

MSDN 网站说您只能使用 jscript 或 HTML 为 onPaste 添加事件处理程序，但我想用 javascript 来完成。有没有办法做到这一点？

* * *

## 回答 #1

> 赞同：3
> 
>             
> 
> 时间：2009-02-13T17:46:43.680

试试小写：

```
document.getElementById('text_area').onpaste = ... 
```

* * *

## 回答 #2

> 赞同：3
> 
>             
> 
> 时间：2009-02-13T17:46:53.990

这取决于大写，你想要：

```
document.getElementById('text_area').onpaste = function() { alert('I iz in ur textbox, pasting some text') }; 
```

# javascript - Javascript 函数：在 for(x in y) 循环之后什么都不执行？

> ID：546907
> 
>         
> 
> 赞同：0
> 
>         
> 
> 时间：2009-02-13T17:39:05.447
> 
>         
> 
> 标签：javascript

我似乎无法在任何地方找到答案......我有一个需要设置两个表格的背景颜色的功能。只有函数中的第一个表受到影响。一个函数中是否只允许一个 for 循环？...或者第一个 for 循环可能永远不会退出？

我几乎可以通过创建多个函数来解决这个问题，但我真的很想了解为什么它的行为方式如此！

谢谢！

这是我的简化代码：

 ````
function setColor()
{
  //This works
  var t1rows=document.getElementById("table1").getElementsByTagName("tr");
  var x;
  for (x in t1rows)
  {
    t1rows[x].style.backgroundColor='yellow';
  }

  //this one does not work
  var t2rows=document.getElementById("table2").getElementsByTagName("tr");
  var y;
  for (y in t2rows)
  {
    t2rows[y].style.backgroundColor='yellow';
  } 
} 
```

* * *

## 回答 #1

> 赞同：3
> 
>             
> 
> 时间：2009-02-13T17:41:33.473

[`getElementsByTagName()`返回一个`NodeList`object](http://www.w3.org/TR/DOM-Level-2-Core/core.html#ID-1938918D)，`for-in`并将迭代它你不想要的属性。您想使用直接`for`循环：

```
for(var i=0; i < t2rows.length; i++) {
    t2rows[i].style.backgroundColor='yellow';
} 
```

您没有进入第二个循环，因为第一个循环在尝试访问`style`其中一个成员上不存在的属性时失败`NodeList`。

# asp.net - 为什么不能在发布模式下建立网站？

> ID：546920
> 
>         
> 
> 赞同：7
> 
>         
> 
> 时间：2009-02-13T17:41:44.457
> 
>         
> 
> 标签：asp.net, configuration, build

在 ASP.Net 中，如果我设置了一个**Web 应用程序**，我可以将其配置为**发布模式**，但对于**网站**，我只能将配置设置为**调试模式**。为什么是这样？

* * *

## 回答 #1

> 赞同：11
> 
>             
> 
> 时间：2009-02-13T17:44:55.713

在网站项目中，每个页面都是在第一次请求时动态编译的。除非您在配置文件中另外指定，否则它将在没有调试符号的情况下编译。

* * *

## 回答 #2

> 赞同：5
> 
>             
> 
> 时间：2009-02-13T18:15:52.300

网站的调试/发布由 Web.Config 文件控制：

```
<system.web>
  ...
  <compilation debug="true">
  ...
  </compilation>
</system.web> 
```

设置 debug="true" 用于调试，设置 debug="false" 用于发布。

* * *

## 回答 #3

> 赞同：2
> 
>             
> 
> 时间：2009-02-13T17:46:59.607

可能是因为 Web 应用程序将整个网站编译成一个 DLL。运行和调试页面需要重新编译整个应用程序。而网站项目在页面级别动态编译。

* * *

## 回答 #4

> 赞同：0
> 
>             
> 
> 时间：2009-02-13T17:48:09.747

对于将源代码发布到站点的网站，无需进行构建。

代码是在现场构建的。

# sql - SQL 语句“SELECT DATEADD(s,1234567890, '19700101')”的结果是什么？

> ID：546921
> 
>         
> 
> 赞同：1
> 
>         
> 
> 时间：2009-02-13T17:41:56.873
> 
>         
> 
> 标签：sql, date, time, epoch

出于某种原因，我的 SQL 安装不起作用:)

```
SELECT DATEADD(s,1234567890, '19700101') 
```

也许[这个网站](http://coolepochcountdown.com/)会有所帮助（来自[Moose](https://stackoverflow.com/users/19032/moose)的链接）。

* * *

## 回答 #1

> 赞同：3
> 
>             
> 
> 时间：2009-02-13T17:43:13.860

我明白了：

```
2009-02-13 23:31:30.000 
```

* * *

## 回答 #2

> 赞同：2
> 
>             
> 
> 时间：2009-02-13T17:47:35.300

[`DATE_ADD`](http://dev.mysql.com/doc/refman/5.1/en/date-and-time-functions.html#function_date-add)(not `DATEADD`) 只有两个参数。

* * *

## 回答 #3

> 赞同：-1
> 
>             
> 
> 时间：2009-02-13T17:50:55.947

太棒了！

# delphi - Datasnap：有没有办法在全球范围内检测连接丢失？

> ID：546930
> 
>         
> 
> 赞同：7
> 
>         
> 
> 时间：2009-02-13T17:43:31.987
> 
>         
> 
> 标签：delphi, delphi-2009, n-tier-architecture, datasnap, midas-server

我正在寻找检测本地连接丢失。有没有办法做到这一点，就像 Corelabs 组件上的事件一样？

谢谢

编辑：抱歉，我将尝试更具体一点：我目前正在使用 datasnap 2009 设计原型。所以我有一个瘦客户端、一个无状态服务器应用程序和一个数据库服务器。

我能做的是检测和处理客户端和服务器应用程序之间的连接丢失（互联网连接）以适当地处理它，即：向用户显示一条信息性错误消息或检测服务器关闭以静默重定向另一个应用服务器。

在我使用 ODAC 组件管理的 2 层中，TOraSession 有一些事件来处理这个问题。

* * *

## 回答 #1

> 赞同：4
> 
>             
> 
> 时间：2009-02-17T09:35:59.447

通常，连接断开时不会触发任何事件，除非针对数据库触发语句。这是因为没有办法知道连接丢失，除非有某种活动 ping 正在进行。

许多框架通过对服务器进行非常小的查询来检查连接是否仍然有效。可能是从服务器获取时间。特别是在连接池环境中。

您可以在某些数据库事件（执行前？）中在您的应用程序中实现连接检查功能。或者制作一个每 10 秒检查一次的计时器。

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2011-07-15T12:01:10.590

在客户端上生成一个线程，该线程定期向服务器发送一些 RPC 'Ping' 或 'Heartbeat' 命令。

*   如果失败，则客户端知道连接发生了问题

*   如果服务器在一段时间内不再听到客户端（例如，两次心跳间隔），他可以断定客户端已断开连接，但这需要有状态服务器（并且您的设计是无状态的，因此需要事件处理在辅助系统中，可以通过消息队列馈送）

# xml - 从 XSD 文件生成树形图

> ID：546932
> 
>         
> 
> 赞同：2
> 
>         
> 
> 时间：2009-02-13T17:44:45.947
> 
>         
> 
> 标签：xml, xsd, diagram

我想从 XML 模式定义中生成一个树形图。Liquid XML Studio 有一个可视化的 XSD 树编辑器，可以让我将树保存为 .png 文件，这满足了我的一些需求。但是我想知道是否有一个工具可以让用户将 XSD 文件转换为网页，其中可以单击、展开和折叠图表，甚至可能支持 URL 片段，以便我可以链接到特定的 complexType，并单击链接将跳转到图表的该部分。

有没有可以做这些事情的工具？

* * *

## 回答 #1

> 赞同：5
> 
>             
> 
> 时间：2012-03-08T21:48:48.040

开源命令行 java 应用程序**xsdvi**从 XML 模式定义创建 SVG 格式的交互式图表。生成的 SVG 文件可以通过现代 Web 浏览器显示，用户可以通过鼠标单击展开和折叠树。

这是生成图的示例

[http://xsdvi.sourceforge.net/ipo.svg](http://xsdvi.sourceforge.net/ipo.svg)

该软件可以从

[http://sourceforge.net/projects/xsdvi/](http://sourceforge.net/projects/xsdvi/)

另请参阅[此 stackoverflow 答案](https://stackoverflow.com/a/9339653/757777)

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2009-05-01T16:11:27.140

[Liquid XML Studio](http://www.liquid-technologies.com/XmlStudio/Xsd-Documentation-Generator.aspx)也可以生成 HTML Docs。查看[模式库](http://schemas.liquid-technologies.com/)以获取一些示例输出

![替代文字](https://www.liquid-technologies.com/Images/ScreenShots/XsdDocumentation.png)

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2009-02-19T08:40:28.017

Oxygen XML 可以满足您的大部分需求。从[网站简介](http://www.oxygenxml.com/xml_schema_editor.html)：

> 可以从 XML Schema 文件生成 HTML 文档页面。该文档包括表示元素、属性、类型的模型的图像，即使对于包含或导入其他模式的模式，也只需单击几下即可获得文档。对于大型模式，可以使用生成块选项，该选项将在单独的页面上输出每个全局模式组件描述（元素、属性、类型等）。

给出了一个示例 HTML 文档页面，其链接已损坏。试试谷歌的缓存副本：

[http://209.85.229.132/search?q=cache:g_RCqsDpZ2YJ:www.oxygenxml.com/personal.html+http://www.oxygenxml.com/personal.html](http://209.85.229.132/search?q=cache:g_RCqsDpZ2YJ:www.oxygenxml.com/personal.html+http://www.oxygenxml.com/personal.html)

* * *

## 回答 #4

> 赞同：0
> 
>             
> 
> 时间：2015-02-10T07:46:35.813

Liquid XML 有一个 XSD 依赖关系查看器。我发现它对于查找未解决的包含非常有用，因为它们被标记为红色。
![在此处输入图像描述](https://i.stack.imgur.com/1EShA.png)

# c# - 如何在 AssemblyVersion 中设置前导零，例如 .net 中的“2.03.406.2”

> ID：546936
> 
>         
> 
> 赞同：3
> 
>         
> 
> 时间：2009-02-13T17:46:01.637
> 
>         
> 
> 标签：c#, .net, versioning

只需添加一个零，如下所示

```
[assembly: AssemblyVersion("2.03.406.2")] 
```

结果为 2.3.406.2

这不是我想要的。

所以这可能是不可能的？

* * *

## 回答 #1

> 赞同：7
> 
>             
> 
> 时间：2009-02-13T17:50:23.563

程序集版本的每个部分都存储为一个 16 位整数，所以不，这是不可能的。

* * *

## 回答 #2

> 赞同：2
> 
>             
> 
> 时间：2009-02-13T17:52:59.953

可能您可以阅读 AssemblyFileVersionAttribute

```
AssemblyFileVersionAttribute[] attributes = (AssemblyFileVersionAttribute[])typeof(Program)
    .Assembly.GetCustomAttributes(typeof(AssemblyFileVersionAttribute), false);
Console.WriteLine(attributes[0].Version); 
```

* * *

## 回答 #3

> 赞同：1
> 
>             
> 
> 时间：2009-02-13T17:50:21.580

每个数字代表一个特定的**数值**，Major、Minor、Build 和 Revision。

它不仅仅是一个任意字符串。

# c# - 在 C# 应用程序运行时将信息从 C# 应用程序传递到 C++ 应用程序的最佳方式是什么？

> ID：546944
> 
>         
> 
> 赞同：2
> 
>         
> 
> 时间：2009-02-13T17:47:09.920
> 
>         
> 
> 标签：c#, c++, ipc

在运行时将信息从 Windows 窗体 C# 应用程序传递到 MFC C++ 应用程序的最佳方法是什么？我不需要发送太多，只需发送一个小字符串。

谢谢，杰夫

* * *

## 回答 #1

> 赞同：4
> 
>             
> 
> 时间：2009-02-13T23:14:46.963

向下查看 IPC 选项列表：

*   内存映射文件。在 C++ 中很容易，在没有指针的 C# 中很难，握手很尴尬

*   WM_COPYDATA。两者都很容易，很难找到您需要的窗把手

*   剪贴板。两者都很容易，握手很尴尬

*   通讯。程序外是野兽，忘了它

*   邮槽。不适合一对一交流

*   管道。在 .NET 3.5 中很容易，在 C++ 中可以使用，但要正确使用有点棘手

*   插座。两者都容易，很难放弃。

* * *

## 回答 #2

> 赞同：3
> 
>             
> 
> 时间：2009-02-13T17:53:59.373

使用命名管道，请参阅[此贴文](https://stackoverflow.com/questions/46693/-net-3-5-most-secure-way-to-pass-string-between-processes)。

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2009-02-13T17:57:32.220

MailSlot api 小而简单，但需要从 c# 使用 P/Invoke，并且可以在本地机器之外使用，因此需要小心。在这里查看我的[答案](https://stackoverflow.com/questions/517376/c-queue-or-servicebus-with-no-dependencies/546328#546328)

命名管道可能更健壮，但这是一种替代方法。

* * *

## 回答 #4

> 赞同：0
> 
>             
> 
> 时间：2009-02-13T17:48:51.287

如果 C++ 应用程序有一个主窗口，请查看在 C# 应用程序中使用 SendMessage 函数（通过 P/Invoke）向 C++ 应用程序发送 WM_COPYDATA 消息。

[http://msdn.microsoft.com/en-us/library/ms649011%28VS.85%29.aspx](http://msdn.microsoft.com/en-us/library/ms649011%28VS.85%29.aspx)

# html - CSS：使块元素填充父元素的整个空间？

> ID：546946
> 
>         
> 
> 赞同：24
> 
>         
> 
> 时间：2009-02-13T17:47:42.727
> 
>         
> 
> 标签：html, css

我正在尝试在`<th>`元素中放置一个链接，并让该`<a>`元素填充`<th>`. 虽然我可以让它以宽度：100% 水平填充，但让它垂直填充被证明是很麻烦的。height:100% 似乎没有效果。

我想这样做，以便用户可以单击单元格中的任意位置来激活链接。我知道我可以在自身上放置一个 onClick 属性`<th>`并通过 javascript 处理它，但我想以“正确”的 css 方式来处理它。

**澄清：**表格的每一行都可以有不同的高度，因为内容是动态的，所以为`<a>`or`<th>`元素使用固定高度的解决方案将不起作用。

这是一些示例代码：

```
<style type="text/css">
th {
  font-size: 50%;
  width: 20em;
  line-height: 100%;
}
th a {
  display:block;
  width:100%;
  height:100%;
  background-color: #aaa;
}
th a:hover {
  background-color: #333
}
</style>
<table border=1>
  <tr>
    <th><a href="foo">Link 1</a></th>
    <td>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nam dapibus tortor.</td>
  </tr>
  <tr>
    <th><a href="foo">Link 2</a></th>
    <td>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nam dapibus tortor. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nam dapibus tortor. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nam dapibus tortor. </td>
  </tr>
</table> 
```

[这是一个具有完全相同代码的页面](http://dl.getdropbox.com/u/26620/stackoverflow1.html)

如您所见，如果您将鼠标悬停在链接上，该`<a>`元素不会垂直填充，这会产生尴尬的外观。我可以通过将悬停背景设置为“ **th:hover a**`a` ”样式来修复悬停背景，但是如果您单击实际标签所在的位置，该链接仍然会真正起作用。

* * *

## 回答 #1

> 赞同：11
> 
>             
> 
> 时间：2009-02-13T18:05:52.183

只需将样式更改为此

```
th {
  font-size: 50%;
  width: 20em;
  height: 100%;
  line-height: 100%; 
} 
```

干杯

* * *

## 回答 #2

> 赞同：3
> 
>             
> 
> 时间：2009-02-13T18:02:12.100

正如[@Hober](https://stackoverflow.com/questions/546946/css-make-a-block-element-fill-the-entire-space-of-a-parent-element/546986#546986)所说，您需要给出`<th>`高度。你也可以`height: 100%`在那里使用。

如果您知道 的尺寸，`<th>`在这种情况下您可能不会（因为它们在侧面），我很幸运地添加了一个填充以将其推`<a>`到边缘（过去任何填充从`<th>`本身），然后以相应的负边距将其带回。像这样：

```
th a{
  padding: 10px 0;
  margin: -10px 0;
} 
```

* * *

## 回答 #3

> 赞同：1
> 
>             
> 
> 时间：2009-02-13T18:17:22.857

我得到的最接近的是这个......

```
th {
  float: left;
  overflow: hidden;
  font-size: 50%;
  width: 20em;
  margin: auto;
}
th a {
  display: table; /* or block, up to you */
  margin: none;
  width:100%;
  height: 1px;
  background-color: #aaa;
  padding: 20%;
} 
```

但这会使您的所有行都具有相同的高度。如果这是一个问题，也许其他人可以解决这个问题。

* * *

## 回答 #4

> 赞同：0
> 
>             
> 
> 时间：2009-02-13T17:59:04.743

你需要给`<th>`一个高度，这样你的样式块就会像这样

```
th {
  font-size: 50%;
  width: 20em;
  height: 8ex;
  line-height: 100%;
} 
```

编辑：实际上，对于高度，您可能应该使用像“ex”这样的垂直度量，而不是“em”的水平度量。示例更改以反映这一点。

* * *

## 回答 #5

> 赞同：0
> 
>             
> 
> 时间：2009-02-13T18:01:18.387

为此，您可以将“a”元素的高度设置为像素而不是百分比。

如果您指定百分比，则 100% 最终将成为 TEXT 本身的高度。

像素高度将为您提供静态高度，并且适用于这种情况。

```
td a {height: 100px;} 
```

* * *

## 回答 #6

> 赞同：0
> 
>             
> 
> 时间：2009-02-13T18:09:42.190

您可以使用 javascript 执行此操作（见下文）。

```
<style type="text/css">
th {
font-size: 50%;
width: 20em;
background-color: #aaa;

}
.off {
background-color: #aaa;
}
.on {
background-color: #333
}

<th onmouseover="this.className='on'" onmouseout="this.className='off'">><a href="foo">Link 1</a></th> 
```

* * *

## 回答 #7

> 赞同：0
> 
>             
> 
> 时间：2009-02-13T18:10:41.190

th 元素需要分配一个高度。给它一个 100% 的高度应该会导致元素扩展到其容器的高度（即行的高度）。这在 IE 6 中可能无法正常工作，您可以尝试添加`_height: 1%`到地址 IE6 - 我没有 IE6 来测试它，但我在 Firefox 中进行了测试，它似乎正在做你想要的。

```
th {
  height: 100%;
} 
```

# c# - 通过功能区代码隐藏在 Word 中打开文件

> ID：546961
> 
>         
> 
> 赞同：6
> 
>         
> 
> 时间：2009-02-13T17:52:07.067
> 
>         
> 
> 标签：c#, sharepoint, ms-word, vsto, ribbon

使用 VSTO，我在功能区设计器中创建了一个自定义选项卡，并在那里添加了一些组和按钮控件。当用户单击其中一个按钮时，我想连接到 SharePoint 网站并在 Word 中打开一个 Word 文档（实例已打开）。我已经能够连接到 SharePoint 网站并拥有我想要打开的文档的 URL。  

但是我怎样才能真正将这些文档加载到 Word 中呢？我已经在 Word 中的代码隐藏中，那么如何定位我所在的 Word 实例并在那里打开文件？

提前致谢。

* * *

## 回答 #1

> 赞同：7
> 
>             
> 
> 时间：2009-02-13T20:22:31.857

您必须使用 Word API 打开文档。请参阅此[链接](http://www.c-sharpcorner.com/UploadFile/mgold/CreatingandOpeningMicrosoftDocumentfrom.NETUsingCSharp11262005050939AM/CreatingandOpeningMicrosoftDocumentfrom.NETUsingCSharp.aspx)以获取参考。您可能需要根据您使用的 API 版本对其进行更新。

```
private void button1_Click(object sender, System.EventArgs e)
{
    // Use the open file dialog to choose a word document
    if (this.openFileDialog1.ShowDialog() == DialogResult.OK)
    {
        // set the file name from the open file dialog
        object fileName = openFileDialog1.FileName;
        object readOnly = false;
        object isVisible = true;
        // Here is the way to handle parameters you don't care about in .NET
        object missing = System.Reflection.Missing.Value;
        // Make word visible, so you can see what's happening
        WordApp.Visible = true;
        // Open the document that was chosen by the dialog
        Word.Document aDoc = WordApp.Documents.Open(ref fileName, ref missing, ref readOnly, ref missing, ref missing, ref missing, ref missing, ref missing, ref missing, ref missing, ref missing, ref isVisible);
        // Activate the document so it shows up in front
        aDoc.Activate();
        // Add the copyright text and a line break
        WordApp.Selection.TypeText("Copyright C# Corner");
        WordApp.Selection.TypeParagraph();
    }
} 
```

# msbuild - 使用 MSBuild 定位不同的框架会产生依赖问题

> ID：546962
> 
>         
> 
> 赞同：2
> 
>         
> 
> 时间：2009-02-13T17:52:53.697
> 
>         
> 
> 标签：msbuild, cruisecontrol.net, msbuild-task

我有一个小项目，我想要该项目的 2 个编译版本：

*   一种针对 .NET 2.0 框架的

*   一个针对 .NET 3.5 框架的

一切顺利；我已经将我的项目置于持续集成之下（使用 CC.NET），并且我创建了 2 个 CC.NET “项目”。每个目标框架一个项目。

我不会过多介绍（不相关的）细节，但我的解决方案设置为针对 VS.NET 中的 .NET 3.5 框架。

我有 2 个 msbuild 任务：

*   为 .NET 3.5 构建解决方案的一项任务（简单易行）

*   为 .NET 2.0 构建解决方案的一项任务

    在此任务中，我调用 MSBuild，并指定 TargetFrameworkVersion 应为 v2.0。我还定义了一些额外的构建条件（因此 .NET3.5 特定代码不会内置在针对 .NET2.0 的程序集中）。

到现在为止还挺好。一切正常。然而，现在的问题是：

我的解决方案有一些依赖项（对第 3 方程序集的引用）。在 VS.NET 中，我将这些依赖项的“本地复制”设置为 true。当 CC.NET 构建我的 .NET3.5 版本的程序集时，第 3 方依赖项确实被复制到了我的输出目录中。

但是，当 CC.NET 构建我的 .NET2.0 版本的程序集时，依赖项不会复制到我的输出目录中。（然后，这会导致我的单元测试失败）。

我现在的问题是：我如何对 msbuild 说，在构建我的项目的 .NET2.0 版本时必须将某些第 3 方引用复制到本地？或者，有没有其他方法可以实现这一点，因为我不想在我的构建脚本中再次指定每个依赖项。我猜这很快就会成为维护的噩梦。

* * *

## 回答 #1

> 赞同：2
> 
>             
> 
> 时间：2009-06-29T09:51:12.380

我一直在重新审视这个问题，因为我不喜欢手动更改 csproj 文件。（当我更改引用时，我一定不要忘记再次调整 csproj 文件，将 Private 节点再次设置为 true）。

所以，我一直在研究 MSDN，我偶然发现了这个：

> **ResolveAssemblyReference.TargetFrameworkDirectories 属性**
> 
>   
>   
> 
> **备注**此属性是确定结果项的 CopyLocal 状态所必需的。
> 
>   
>   
> 
> 如果未指定此属性，则没有结果项目的 CopyLocal 值为 true，除非它们在其源项目上显式地具有私有元数据值 true。

因此，这意味着还有另一种可能性，那就是设置 ResolveAssemblyReference 任务的 TargetFrameworkDirectories。但是，有没有人知道如何做到这一点？

我一直在尝试不同的东西，但似乎没有任何效果......

我试过这个：

```
<ItemGroup>
    <TargetFrameworkDir Include="$(SystemRoot)\Microsoft.NET\Framework\v2.0.50727" />
</ItemGroup>

<PropertyGroup>
   <TargetDirsToUse>@(TargetFrameworkDir)</TargetDirsToUse>
</PropertyGroup>

<ResolveAssemblyReference TargetFrameworkDirectories="$(TargetDirsToUse)" /> 
```

但无济于事......也许其他人知道如何做到这一点，或者有一个黄金提示。（我在这个该死的问题上花了很多时间）。

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2009-02-16T10:28:09.267

通过确保不从 GAC 引用程序集，我已经能够解决这个问题。相反，我在我的项目中创建了一个包含第 3 方程序集的“lib”目录。在我的解决方案中，我从那里引用第 3 方程序集，并设置 copy local==True。

除此之外，您还必须确保在您的 csproj 文件中，引用的程序集具有一个 Private 标记，其值设置为 true。像这样：

```
<Reference Include="...">
   <SpecificVersion>False</SpecificVersion>
   <HintPath>...</HintPath>
   <Private>True</Private>
</Reference> 
```

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2009-07-01T18:39:30.833

一个问题：如果您尝试在 VisualStudio 中编译您的 2.0 解决方案/项目会发生什么？第三方引用是否自动复制？

奇怪的是，这适用于 3.5 而不是 2.0。我自己没有进行任何并行构建，但是当我将我的项目从 2.0 转换为 3.5 时，无论 .NET 版本如何，都会复制所有第 3 方引用。

BTW: I **never** reference 3rd party libraries from GAC (only those from Microsoft, and even not all of them). I always copy them to my lib directory structure, add them to the source control and reference them from there. Using assemblies from GAC is bad practice as far as I am concerned, since it represents an unnecessary dependency on a development machine setup.

Example of such a directory: [http://code.google.com/p/projectpilot/source/browse/#svn/trunk/lib](http://code.google.com/p/projectpilot/source/browse/#svn/trunk/lib)

# build-process - 如何使用以前版本的源文件构建warfile？

> ID：546966
> 
>         
> 
> 赞同：1
> 
>         
> 
> 时间：2009-02-13T17:53:39.653
> 
>         
> 
> 标签：build-process

我需要 CVS 存储库查看器吗？

* * *

## 回答 #1

> 赞同：0
> 
>             
> 
> 时间：2010-03-19T14:46:34.947

我认为您已成功设置 Java 的类路径。

```
c:>jar -cf MyWebTest.war * 
```

我将`.war`在您本地计算机的 C 驱动器中创建文件。

# jquery - 表单重置按钮是否会触发选择元素 onChange 事件？

> ID：546967
> 
>         
> 
> 赞同：9
> 
>         
> 
> 时间：2009-02-13T17:53:42.447
> 
>         
> 
> 标签：jquery, onchange, reset, jquery-events

我有一个带有一些选择元素的表单，这些元素`onChange`附加了事件。即使有人单击表单重置按钮，我也希望该事件能够触发。

我的问题是：重置表单会触发选择元素`onChange`事件吗？

这是jQuery中的一个简单示例

```
<script type="text/javascript">
    $('.myselect').change(function() {
        // do something on change
    });
</script>

<form action="/" method="post">
    <select class="myselect" name="select1">
        <option value="1">First</option>
        <option value="2">Second</option>
    </select>
    <select class="myselect" name="select2">
        <option value="1">First</option>
        <option value="2">Second</option>
    </select>
    <!-- When this is clicked I would like it fire the change event -->
    <input type="reset" value="Reset" /> 
    <input type="submit" value="Save" />
</form> 
```

谢谢！

* * *

## 回答 #1

> 赞同：4
> 
>             
> 
> 时间：2012-08-29T13:07:57.027

杰克 M. 的回答效果很好。这是执行相同操作的另一种方法。希望它会帮助某人。

在此函数中间编写您想要调用的代码/事件。我已经对此进行了测试。工作很好。

```
$(document).ready(function() {
    $("input:reset").click(function() {       // apply to reset button's click event
        this.form.reset();                    // reset the form

        // call your functions to be executed after the reset      

         return false;                         // prevent reset button from resetting again
    });
}); 
```

* * *

## 回答 #2

> 赞同：3
> 
>             
> 
> 时间：2009-02-26T20:35:20.007

表单有一个 onReset 标记，因此您可以执行以下操作：

```
<script type="text/javascript">
    var changeFunc = function() {
        // do something on change.
    };
    $('.myselect').change(changeFunc);
</script>

<form onReset="changeFunc()" action="/" method="post">
    <select class="myselect" name="select1">
        <option value="1">First</option>
        <option value="2">Second</option>
    </select>
    <select class="myselect" name="select2">
        <option value="1">First</option>
        <option value="2">Second</option>
    </select>
    <!-- When this is clicked I would like it fire the change event -->
    <input type="reset" value="Reset" /> 
    <input type="submit" value="Save" />
</form> 
```

这个方法在重置发生之前被调用，虽然它可能很棘手。我想这样你就可以做一个“你确定吗？” 盒子。在重置功能中折腾 a`setTimeout`似乎可以解决问题。

# ruby-on-rails - 当您说 Ruby 具有反射性时，这主要是指“鸭子打字”吗？

> ID：546968
> 
>         
> 
> 赞同：5
> 
>         
> 
> 时间：2009-02-13T17:53:45.020
> 
>         
> 
> 标签：ruby-on-rails, ruby, reflection, duck-typing

我正在阅读描述 Ruby 的文本，它说以下内容：

> Ruby 被认为是一种“反射性”语言，因为 Ruby 程序可以分析自身（根据其构成），调整其工作方式，甚至用其他代码覆盖自己的代码。

我对“反射”这个术语感到困惑 - 这主要是在谈论 Ruby 可以查看变量并确定它是整数还是字符串（鸭子类型）的方式，例如：

```
x = 3
x = "three" # Ruby reassigns x to a String type 
```

* * *

## 回答 #1

> 赞同：10
> 
>             
> 
> 时间：2009-02-13T18:11:27.817

说 Ruby 是“反射性的”意味着你可以，例如，在运行时找出一个类有哪些方法：

```
>> Array.methods
=> ["inspect", "private_class_method", "const_missing",
[ ... and many more ... ] 
```

（你可以对类的对象做同样的事情。）

或者您可以找出给定对象的类...

```
>> arr = Array.new
=> []
>> arr.class
=> Array 
```

并找出它在类层次结构中是什么......

```
>> arr.kind_of?
>> arr.kind_of? Array
=> true
>> arr.kind_of? String
=> false 
```

在他们所说的“Ruby 程序可以分析自身”的引文中，这就是他们所说的。

其他语言（如 Java）也这样做，但使用 Ruby 更容易、更方便，并且更多地是使用该语言的日常部分。因此，Ruby 是“反射性的”。

* * *

## 回答 #2

> 赞同：3
> 
>             
> 
> 时间：2009-02-13T18:03:33.267

不，这意味着你可以发出一个 ruby​​ 命令来获取关于任何东西的信息。例如，您可以键入命令 File.methods() 来获取属于 File 模块的所有方法的列表。你可以对类和对象做类似的事情——列出方法、变量等。

* * *

## 回答 #3

> 赞同：1
> 
>             
> 
> 时间：2009-02-13T18:23:41.343

重新开课就是一个很好的例子。这是一个简单的例子：

```
class Integer
    def moxy
        if self.zero?
            self - 2
        elsif self.nonzero?
            self + 2          
        end      
    end  
end

puts 10.moxy 
```

通过重新打开一个标准的 Ruby 类 - Integer - 并在其中定义一个名为“moxy”的新方法，我们可以直接对数字执行新定义的操作。在这种情况下，我定义了这个由“moxy”组成的方法，如果它为零，则从整数中减去 2，如果它不为零，则添加 2。这使得 moxy 方法可用于 Ruby 中 Integer 类的所有对象。（这里我们使用'self'关键字来获取整数对象的内容）。

如您所见，它是 Ruby 的一个非常强大的特性。

编辑：一些评论者质疑这是否真的是[反射](http://en.wikipedia.org/wiki/Reflection_(computer_science))。在英语中，反思一词是指审视自己的想法。这当然也是编程中反射的一个重要方面——使用诸如 is_a、kind_of、instance_of 之类的 Ruby 方法来执行运行时自检。但反射也指程序在运行时修改自身行为的能力。重开课程就是其中的关键例子之一。它也被称为[猴子补丁](http://en.wikipedia.org/wiki/Monkey_patch)。这并非没有风险，但我所做的只是在反思的背景下在这里描述它，这是一个例子。

* * *

## 回答 #4

> 赞同：0
> 
>             
> 
> 时间：2009-02-13T18:37:19.533

它主要是指在 Ruby 程序运行时检查和修改内部表示的难易程度，例如类、常量、方法等。

Most modern languages offer some kind of reflective capabilities (even statically typed ones such as Java), but in Ruby, it is so easy and natural to use these capabilities, that it really make a real difference when you need them. 

It just makes meta-programming, for example, an almost trivial task, which is not true at all in other languages, even dynamic ones.

# c# - 如何快速组织源代码（c#）中的函数按字母顺序排列？

> ID：546970
> 
>         
> 
> 赞同：5
> 
>         
> 
> 时间：2009-02-13T17:54:24.240
> 
>         
> 
> 标签：c#, visual-studio, visual-studio-2008

我正在做一些类清理以按字母顺序组织 cs 文件中的函数。我正在使用 Visual Studio 2008。

写的时候，我只是随意放了，现在看起来还挺乱的。

有没有一些简单的方法可以自动组织它们？

最好有一个工具，因为有很多文件要清理。

* * *

## 回答 #1

> 赞同：15
> 
>             
> 
> 时间：2009-02-13T18:08:04.470

为什么要按阿尔法顺序组织？如果您希望以这种方式访问​​它们，IDE 提供了一个下拉列表供您使用。

相反，源文件应该以有意义的顺序包含它们（有意义的是相当主观的），或者通过它们的任务的细节，或者通过一些合理的约定，如果没有其他东西存在（例如通过可见性，或者将属性放在一起）。

自动布局规则对于源存储库来说是一场噩梦，因为它们会进行不必要的大规模移动，从而阻碍您识别真正更改的能力，因此除非规则符合以下条件之一，否则应避免使用它们：

*   它们**永远不会**改变，您可以从项目开始就应用它

*   它们很少更改，并且更改最多会影响一条线的移动（例如包围结构）

*   它们很少改变，效果只是在一行内的空白处

如果答案完全超出“很少”，您不想使用句号，那么高效浏览历史更改会更有用。

* * *

## 回答 #2

> 赞同：4
> 
>             
> 
> 时间：2009-02-13T17:57:28.117

你试过[区域化](http://www.rauchy.net/regionerate/)吗？

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2009-03-03T01:53:47.633

在区域化：

1.  从以下位置打开模式：C:\Program Files\Regionerate

2.  按名称选择集群

3.  选择移除区域

您的方法、字段等代码将按字母顺序排列。

* * *

## 回答 #4

> 赞同：0
> 
>             
> 
> 时间：2015-08-06T03:50:01.453

虽然我的回答已经很晚了，但是你有没有想过一个叫做[ReSharper](http://www.jetbrains.com/resharper/index.html)的很棒的工具。我敢打赌，一旦你习惯了它，你就会爱上它。使编码更加容易和清洁。

# asp.net - 如何将 Web 应用程序项目转换为类库项目

> ID：546979
> 
>         
> 
> 赞同：34
> 
>         
> 
> 时间：2009-02-13T17:57:13.407
> 
>         
> 
> 标签：asp.net, visual-studio

我需要将作为 Web 应用程序启动的项目转换为类库，这可能吗？

谢谢

* * *

## 回答 #1

> 赞同：42
> 
>             
> 
> 时间：2010-10-19T19:31:49.540

正确答案是肯定的。只需编辑 csproj (msbuild) 文件并更改 ProjectGuid 并删除 ProjectTypeGuids：

```
<ProjectGuid>{9845066A-3C9E-4F51-8F5F-8F513E8D03C1}</ProjectGuid> 
```

真的就是这么简单。

* * *

## 回答 #2

> 赞同：39
> 
>             
> 
> 时间：2013-08-26T00:16:53.777

如果您想让它与类库项目完全相同，以下是 Visual Studio 2010 项目的操作方法：

1.  编辑 csproj 文件

    *   在下面`PropertyGroup`

        *   消除`ProjectTypeGuids`

        *   消除`UseIISExpress`

        *   添加`<FileAlignment>512</FileAlignment>`

    *   更改`<Import Project="$(MSBuildBinPath)\Microsoft.CSharp.targets" />`为`<Import Project="$(MSBuildToolsPath)\Microsoft.CSharp.targets" />`

    *   消除`<Import Project="$(MSBuildExtensionsPath32)\Microsoft\VisualStudio\v10.0\WebApplications\Microsoft.WebApplication.targets" />`

    *   消除`<ProjectExtensions>`

    *   在下面`<PropertyGroup Condition=" '$(Configuration)|$(Platform)' == 'Debug|AnyCPU' ">`

        *   更改`OutputPath`为`bin\Debug\`

    *   在下面`<PropertyGroup Condition=" '$(Configuration)|$(Platform)' == 'Release|AnyCPU' ">`

        *   更改`OutputPath`为`bin\Release\`

2.  在 Visual Studio 中打开项目

    *   如果未使用以下任何参考，请删除它们

        *   *系统配置*

        *   *系统绘图*

        *   *System.EnterpriseServices*

        *   *系统.Web*

        *   *System.Web.ApplicationServices*

        *   *System.Web.DynamicData*

        *   *System.Web.Entity*

        *   *System.Web.Extensions*

        *   *系统.Web.服务*

    *   如果不需要/未使用以下任何文件/文件夹，请删除它们

        *   *应用程序数据*

        *   **.aspx*

        *   *网页配置*

        *   *脚本*

        *   *风格*

        *   *全球.asax*

        *   *Site.Master*

* * *

## 回答 #3

> 赞同：1
> 
>             
> 
> 时间：2009-02-13T18:40:58.153

不，最好的办法是创建一个 Class.Library 并将 .cs 文件复制到您的新项目中。

类库不会对 .aspx 页面做任何事情，它会将这些页面视为解决方案中的文件。

* * *

## 回答 #4

> 赞同：1
> 
>             
> 
> 时间：2011-07-12T01:09:19.523

我来这里是为了拥有一个带有 mvc 菜单项的类库。也就是说，右键单击视图文件夹以添加视图或控制器以在类库中添加控制器。

我可以通过编辑我的 mvc.web.app.csproj 来实现这一点，将其复制`<ProjectTypeGuids />`到我的 class.lib.csproj 项目中。

有关我在做什么的更多上下文，请参阅：[如何在多个应用程序或网站中重用区域、控制器、视图、模型、路由](https://stackoverflow.com/questions/6656843/area-as-a-virtual-on-other-websites)。

# user-interface - 可视化软件系统监控

> ID：546988
> 
>         
> 
> 赞同：1
> 
>         
> 
> 时间：2009-02-13T17:59:47.953
> 
>         
> 
> 标签：user-interface, system, monitor

有人见过工厂和工厂的可视化监控工具吗？它们以让人联想到流程图或可视图的方式显示制造系统的组件，但不是静态图像，而是每个组件都有一些交互元素（例如显示系统统计信息或消息）

我想为全软件系统构建类似的东西。我可以使用任何工具或组件来构建 gui 吗？这种工具有名称吗？我无法找出正确的查询来在谷歌上找到示例图片。

* * *

## 回答 #1

> 赞同：1
> 
>             
> 
> 时间：2009-02-13T18:03:28.257

我见过的最接近这样的东西是[Microsoft Visual Studio Analyzer](http://msdn.microsoft.com/en-us/library/aa728806(VS.71).aspx)；它可以监控硬件和软件组件并以图形方式显示它们之间的通信。

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2009-02-13T18:17:39.957

我相信您正在寻找仪器仪表和图形。  

有一些免费的控件和一些昂贵的控件，介于两者之间。

这里有一些例子;

[http://www.cstsoft.com/english/index.html](http://www.cstsoft.com/english/index.html)

[http://www.freedownloadscenter.com/Programming/Components_and_Libraries/Nextwave_Software_WPF_Suite_with_Chart_and_Gauge_Screenshot.html](http://www.freedownloadscenter.com/Programming/Components_and_Libraries/Nextwave_Software_WPF_Suite_with_Chart_and_Gauge_Screenshot.html)

[http://www.dundas.com/index.aspx?Campaign=GoogleGauge&gclid=CNXn7rmL2pgCFR2dnAodyl2HdA](http://www.dundas.com/index.aspx?Campaign=GoogleGauge&gclid=CNXn7rmL2pgCFR2dnAodyl2HdA)

[http://www.freedownloadscenter.com/Best/free-gauge-_net.html](http://www.freedownloadscenter.com/Best/free-gauge-_net.html)

这当然不是一个包罗万象的列表——谷歌提供了更多和你选择的开发环境——

希望能帮助到你。

# javascript - JavaScript 错误自动反馈

> ID：546990
> 
>         
> 
> 赞同：16
> 
>         
> 
> 时间：2009-02-13T17:59:58.797
> 
>         
> 
> 标签：javascript, debugging, feedback

如果在客户端运行 JavaScript 时发生错误（甚至是语法错误），有没有办法获得自动反馈？

我在想这样的事情：

```
<script src="debugger.js"></script>
<script>
    // some script with an error in it
</script> 
```

每次调试器发现错误时，它都会向服务器发送反馈。

* * *

## 回答 #1

> 赞同：18
> 
>             
> 
> 时间：2009-02-13T18:07:09.637

编辑：我最初误解了你的问题，这应该有效：

另请注意，这需要在任何可能导致错误的 javascript 之前进行。

```
window.onerror = function(msg,u,l)
{
    txt ="Error: " + msg + "\n";
    txt+="URL: " + u + "\n";
    txt+="Line: " + l + "\n\n";
    //Insert AJAX call that passes data (txt) to server-side script
    return true;
}; 
```

至于语法错误，你不走运。当出现语法错误时，Javascript 就会死掉。根本没有办法处理。

* * *

## 回答 #2

> 赞同：9
> 
>             
> 
> 时间：2009-02-13T18:11:35.790

一种技术是使用 Ajax 进行[Javascript 错误记录](http://blog.inspired.no/javascript-error-logging-with-ajax-154) 

*每个 javascript 错误都可以被困在 window.onerror 事件中。我们可以返回 true 或 false，以便我们可以选择用户是否应该看到正常的 javascript 错误对话框。万一发生 javascript 错误，该脚本将收集有关错误的信息并将 httprequest 发送到将 javascript 错误记录到数据库的页面。*

* * *

## 回答 #3

> 赞同：4
> 
>             
> 
> 时间：2009-02-13T18:08:33.567

我不确定语法错误，但可以使用 window.onerror 事件捕获 js 错误。在谷歌中搜索“在 javascript 中记录错误”会给你很多结果......

将 JavaScript 错误记录到
[ASP.NET：http://james.newtonking.com/archive/2006/05/02/Logging-JavaScript-Errors-To-ASP.NET.aspx](http://james.newtonking.com/archive/2006/05/02/Logging-JavaScript-Errors-To-ASP.NET.aspx) 
（不幸的是，帖子中的下载链接已损坏）。

将客户端 JavaScript 错误记录到服务器： 
 http: [//www.codeproject.com/KB/ajax/logclientsidejserrors2srv.aspx](http://www.codeproject.com/KB/ajax/logclientsidejserrors2srv.aspx)

JavaScript 错误通知： 
 [http ://www.thecodepage.com/post/JavaScript-Error-Notifications.aspx](http://www.thecodepage.com/post/JavaScript-Error-Notifications.aspx)

* * *

## 回答 #4

> 赞同：1
> 
>             
> 
> 时间：2009-02-13T18:10:11.813

window.onerror = MyFunction(msg,url,line);

我们会弹出一个窗口，其中包含错误详细信息、浏览器类型（即 navigator.userAgent）等，所有这些都在标记为 READONLY 的字段中，并邀请用户提交它们。

我们有一个复选框“不再显示”，它存储在会话 cookie 中 - 因此，如果他们不断收到错误，则可以禁用弹出窗口。

尽管我们认为这“很酷”，但我们收到的报告很少——我不相信这是因为我们接近于零运行时错误！

* * *

## 回答 #5

> 赞同：0
> 
>             
> 
> 时间：2009-02-13T19:04:33.120

最好每页只发送一份错误报告。如果您在重复计时器上遇到错误，或者 AJAX 本身递归调用错误，您最终可能会用无用的垃圾填充您的日志。

此外，请准备好接收由以下原因引起的无法解决的错误：

*   使用您的代码的安全代理

*   来自被阻止站点的脚本

*   来自扩展的不重要的浏览器 chrome 错误

*   IE Mobile，世界上最差的浏览器

* * *

## 回答 #6

> 赞同：0
> 
>             
> 
> 时间：2013-04-15T21:02:45.597

对我来说最简单的方法是从 SiteApps Marketplace 安装这个应用程序：

[http://siteapps.com/app/log_javascript_errors_with_ga-181](http://siteapps.com/app/log_javascript_errors_with_ga-181)

一旦你安装了平台标签，你就可以安装很多应用程序，上面的一个对我来说非常有用。我在自己开发的 14 个网站中使用它，并且可以在 Google Analytics 中跟踪 javascript 错误。

希望这能有所帮助。

莱安德罗

# c++ - const set& 的问题。编译器/STL 错误或不可移植使用？

> ID：546993
> 
>         
> 
> 赞同：0
> 
>         
> 
> 时间：2009-02-13T18:00:38.170
> 
>         
> 
> 标签：c++, stl, constants, set, standards

家里有语言律师吗？

下面的代码应该编译吗？

```
include <set>

bool fn( const std::set<int>& rSet )
{
  if ( rSet.find( 42 ) != rSet.end() ) return true;
  return false;
} 
```

在其中一个平台（Sun Workshop）上，这不会编译。它报告 find 函数返回了一个迭代器，而 end 函数返回了一个 const_iterator 并且它在这些类型之间没有有效的比较运算符。

以下确实编译：

```
include <set>

bool fn( std::set<int>& rSet )
{
  if ( rSet.find( 42 ) != rSet.end() ) return true;
  return false;
} 
```

* * *

## 回答 #1

> 赞同：9
> 
>             
> 
> 时间：2009-02-13T18:14:10.917

它应该编译。Set 包括 2 个 find() 函数和 2 个 end() 函数（const 和 non-const 版本）。这听起来像是 Sun 的 STL 以某种方式被破坏了。由于您传递的是 const 引用，因此编译器应该能够选择正确的 find() 和 end() 函数。

* * *

## 回答 #2

> 赞同：3
> 
>             
> 
> 时间：2009-02-13T18:19:03.697

我使用 Sun C++ 编译器已经有几年了，但当时它有两个 STL 版本。一个是遗留版本，它远不完整或不正确，但他们一直在编译旧程序，一个是 stlport。检查以确保您使用的是正确的 STL 版本。

* * *

## 回答 #3

> 赞同：2
> 
>             
> 
> 时间：2009-02-13T18:09:20.130

我无法在我的平台上复制这种确切的行为，但我过去在使用 STL 映射时遇到过类似的问题。我发现我需要将 的结果显式分配给`find()`声明的变量，然后将该变量与`end()`. 这可能值得一试。

# asp.net - ASP.NET：将 XmlDocument 保存到 Response.OutputStream 是否尊重编码？

> ID：546994
> 
>         
> 
> 赞同：4
> 
>         
> 
> 时间：2009-02-13T18:00:43.303
> 
>         
> 
> 标签：asp.net, xml, unicode, xmldocument

我想将`XmlDocument`对象的 xml 发送到 HTTP 客户端，但我担心[建议的解决方案](https://stackoverflow.com/questions/543319/how-to-return-xml-in-asp-net/543431#543431)可能不遵守`Response`已设置为使用的编码：

```
public void ProcessRequest(HttpContext context)
{
   XmlDocument doc = GetXmlToShow(context);

   context.Response.ContentType = "text/xml";
   context.Response.ContentEncoding = System.Text.Encoding.UTF8;
   context.Response.Cache.SetCacheability(HttpCacheability.NoCache);
   context.Response.Cache.SetAllowResponseInBrowserHistory(true);

   doc.Save(context.Response.OutputStream); 
```

}

如果我将编码更改为其他内容，例如**Unicode** ，该怎么办：

```
public void ProcessRequest(HttpContext context)
{
   XmlDocument doc = GetXmlToShow(context);

   context.Response.ContentType = "text/xml";
   context.Response.ContentEncoding = System.Text.Encoding.Unicode;
   context.Response.Cache.SetCacheability(HttpCacheability.NoCache);
   context.Response.Cache.SetAllowResponseInBrowserHistory(true);

   doc.Save(context.Response.OutputStream);
} 
```

是否会`Response.OutputStream`即时翻译正在写入的二进制数据，并使其成为 Unicode？

还是`Response.ContentEncoding`只是*提供信息*？

如果 ContentEncoding 只是提供信息，那么后面的文本字符串将以什么内容编码返回？

```
context.Response.ContentEncoding = System.Text.Encoding.Unicode;
context.Response.Write("Hello World");

context.Response.ContentEncoding = System.Text.Encoding.UTF8;
context.Response.Write("Hello World");

context.Response.ContentEncoding = System.Text.Encoding.UTF16;
context.Response.Write("Hello World");

context.Response.ContentEncoding = System.Text.Encoding.ASCII;
context.Response.Write("Hello World");

context.Response.ContentEncoding = System.Text.Encoding.BigEndianUnicode;
context.Response.Write("Hello World"); 
```

* * *

## 回答 #1

> 赞同：14
> 
>             
> 
> 时间：2009-02-13T18:38:43.197

我找到了。

答案是否定的：XmlDocument 将不遵守它正在写入的响应流的 ContentEncoding。

* * *

**更新：正确的方法**

1.  使用`Response.Output`，而**不是** `Response.OutputStream`。

    两者都是流，但`Output`都是`TextWriter`.

    当 a`XmlDocument`将自己保存到 a`TextWriter`时，它将使用`TextWriter`. 将`XmlDocument`自动更改任何 xml 声明节点，即：

    <?xml 版本="1.0" 编码="ISO-8859-1"?>

    匹配 的编码`Response.Output`设置使用的编码。

2.  的`Response.Output` `TextWriter`编码设置来自 
    `Response.ContentEncoding`值。

3.  使用`doc.Save`, **not** `Response.Write(doc.ToString())`或`Response.Write(doc.InnerXml)`

    您不想将**xml**保存到字符串中，或​​者将 xml 填充到字符串`response.Write`中，因为：

    *   不遵循指定的编码

    *   浪费内存

总结一下：通过保存到 a `TextWriter`：XML 声明节点、XML 内容和 HTML 响应内容编码都将匹配。

示例代码：

```
public class Handler : IHttpHandler, System.Web.SessionState.IRequiresSessionState 
{
    //Note: We add IRequiesSessionState so that we'll have access to context.Session object
    //Otherwise it will be null

    public void ProcessRequest(HttpContext context)
    {
        XmlDocument doc = GetXmlToShow(context); //GetXmlToShow will look for parameters from the context

        if (doc != null)
        {
            context.Response.ContentType = "text/xml"; //must be 'text/xml'
            context.Response.ContentEncoding = System.Text.Encoding.UTF8; //we'd like utf-8
            doc.Save(context.Response.Output); //doc save itself to the textwriter, using the encoding of the text-writer (which comes from response.contentEncoding)
        }

        #region Notes
        /*
         * 1\. Use Response.Output, and NOT Response.OutputStream.
         *    Both are streams, but Output is a TextWriter.
         *    When an XmlDocument saves itself to a TextWriter, it will use the encoding
         *    specified by the TextWriter. The XmlDocument will automatically change any
         *    xml declaration node, i.e.:
         *       <?xml version="1.0" encoding="ISO-8859-1"?>
         *    to match the encoding used by the Response.Output's encoding setting
         * 2\. The Response.Output TextWriter's encoding settings comes from the 
         *    Response.ContentEncoding value.
         * 3\. Use doc.Save, not Response.Write(doc.ToString()) or Response.Write(doc.InnerXml)
         * 3\. You DON'T want to Save the xml to a string, or stuff the xml into a string
         *    and response.Write that, because that
         *     - doesn't follow the encoding specified
         *     - wastes memory
         * 
         * To sum up: by Saving to a TextWriter: the XML Declaration node, the XML contents,
         * and the HTML Response content-encoding will all match.
         */
        #endregion Notes
    }

    public bool IsReusable { get { return false; } }
} 
```

* * *

保存到流时 XmlDocument 将使用的编码取决于**xml 声明节点**中指定的编码。例如：

```
 <?xml version="1.0" encoding="UTF-8"?> 
```

如果在 xml 声明中指定了“UTF-8”编码，那么 Save(stream) 将使用**UTF-8**编码。

如果*没有*指定编码，例如：

```
<?xml version="1.0"?> 
```

或者完全省略 xml 声明节点，则 XmlDocument 将默认为**UTF-8** unicode 编码。（[参考](http://msdn.microsoft.com/en-us/library/system.xml.xmldeclaration.encoding.aspx)）

> 如果不包含编码属性，则在写入或保存文档时采用 UTF-8 编码。

也可以在 xml 声明中使用的[一些常见编码字符串是：](http://msdn.microsoft.com/en-us/library/system.xml.xmldeclaration.encoding.aspx)

*   UTF-8

*   UTF-16

*   ISO-10646-UCS-2

*   ISO-10646-UCS-4

*   ISO-8859-1

*   ISO-8859-2

*   ISO-8859-3

*   ISO-8859-4

*   ISO-8859-5

*   ISO-8859-6

*   ISO-8859-7

*   ISO-8859-8

*   ISO-8859-9

*   ISO-2022-JP

*   Shift_JIS

*   EUC-JP

**注意**：编码属性不区分大小写：

> 与大多数 XML 属性不同，编码属性值不区分大小写。这是因为编码字符名称遵循 ISO 和 Internet 号码分配机构 (IANA) 标准。

如果您从字符串或文件加载 XML，并且它不包含 xml 声明节点，则可以使用以下方法[手动将一个添加到 XmlDocument](http://msdn.microsoft.com/en-us/library/system.xml.xmldeclaration.encoding.aspx)：

```
// Create an XML declaration. 
XmlDeclaration xmldecl;
xmldecl = doc.CreateXmlDeclaration("1.0", null, null);
xmldecl.Encoding="UTF-8";

// Add the new node to the document.
XmlElement root = doc.DocumentElement;
doc.InsertBefore(xmldecl, root); 
```

如果 XmlDocument 没有 xml 声明，或者 xml 声明没有编码属性，则保存的文档也没有。

注意：如果 XmlDocument 保存到 TextWriter，则将使用的编码取自 TextWriter 对象。此外，当内容写入 TextWriter 时，xml 声明节点编码属性（如果存在）将替换为 TextWriter 的编码。（[参考](http://msdn.microsoft.com/en-us/library/sa5wd18z.aspx)）

> TextWriter 上的编码决定了写出的编码（XmlDeclaration 节点的编码替换为 TextWriter 的编码）。如果 TextWriter 上没有指定编码，则保存 XmlDocument 时没有编码属性。

如果保存为字符串，则使用的编码由 xml 声明节点的编码属性（如果存在）确定。

* * *

在我的具体示例中，我正在通过 ASP.NET 写回 Http 客户端。我想将 Response.Encoding 类型设置为适当的值 - 我需要匹配 XML 本身将包含的内容。

执行此操作的适当方法是将 xml 保存到 Response.Output，而不是 Response.OutputStream。Response.Output 是一个 TextWriter，其编码值遵循您为 Response.Encoding 设置的值。

换句话说：

```
context.Response.ContentEncoding = System.Text.Encoding.ASCII;
doc.Save(context.Response.Output); 
```

结果在xml中：

```
<?xml version="1.0" encoding="us-ascii" ?> 
<foo>Hello, world!</foo> 
```

尽管：

```
context.Response.ContentEncoding = System.Text.Encoding.UTF8;
doc.Save(context.Response.Output); 
```

结果在xml中：

```
<?xml version="1.0" encoding="utf-8" ?> 
<foo>Hello, world!</foo> 
```

和

```
context.Response.ContentEncoding = System.Text.Encoding.Unicode;
doc.Save(context.Response.Output); 
```

结果在xml中：

```
<?xml version="1.0" encoding="utf-16" ?> 
<foo>Hello, world!</foo> 
```

* * *

## 回答 #2

> 赞同：-1
> 
>             
> 
> 时间：2009-02-13T18:05:17.787

来自谷歌的前 2 个链接

如何：为 ASP.NET 网页全球化选择编码：http:
 [//msdn.microsoft.com/en-us/library/hy4kkhe0.aspx](http://msdn.microsoft.com/en-us/library/hy4kkhe0.aspx)

全球化元素（ASP.NET 设置架构）：http:
 [//msdn.microsoft.com/en-us/library/hy4kkhe0.aspx](http://msdn.microsoft.com/en-us/library/hy4kkhe0.aspx)

# c++ - 使用 #ifdefs 和 #define 可选择将函数调用转换为注释

> ID：546997
> 
>         
> 
> 赞同：16
> 
>         
> 
> 时间：2009-02-13T18:01:24.470
> 
>         
> 
> 标签：c++, c, c-preprocessor, conditional-compilation

有没有可能做这样的事情

```
#ifdef SOMETHING
#define foo //
#else
#define foo MyFunction
#endif 
```

这个想法是，如果 SOMETHING 被定义，那么对 foo(...) 的调用将成为注释（或不会被评估或编译的东西），否则它会成为对 MyFunction 的调用。

我见过 __noop 使用过，但我不相信我可以使用它。

编辑：

我不认为我可以在这里真正使用宏，因为 MyFunction 接受可变数量的参数。

另外，我想让它不评估参数！（因此，像注释掉 MyFunction 的主体之类的事情并不能真正给我我需要的东西，因为仍然会评估参数）

* * *

## 回答 #1

> 赞同：25
> 
>             
> 
> 时间：2009-02-13T18:04:29.300

试试这个：

```
#ifdef SOMETHING
#define foo(x)
#else
#define foo(x) MyFunction(x)
#endif 
```

如果您的函数有多个参数，则：

```
#ifdef SOMETHING
#define foo(x,y,z)
#else
#define foo(x,y,z) MyFunction(x,y,z)
#endif 
```

如果您的函数具有可变数量的参数，那么您的编译器可能支持所谓的“可变参数宏”，如下所示：

```
#ifdef SOMETHING
#define foo(...)
#else
#define foo(...) MyFunction(__VA_ARGS__)
#endif 
```

我在实践中看到这种事情的原因是为了摆脱发布版本中的日志记录功能。但是，另请参阅[单独的“调试”和“发布”版本？](https://stackoverflow.com/questions/420343/separate-debug-and-release-builds)人们质疑你是否*应该有**不同*的构建。

 ** * *

或者，乔纳森对此答案的评论建议不要将函数调用重新定义为空，而是建议执行以下操作：

```
#ifdef SOMETHING
#define foo(...) do { if (false) MyFunction(__VA_ARGS__) } while (0)
#else
#define foo(...) do { if (true) MyFunction(__VA_ARGS__) } while (0)
#endif 
```

这样做的原因是函数调用总是被编译（所以它不会留下像引用已删除变量这样的无端错误），但只在需要时调用：参见 Kernighan & Pike [The Practice of Programming](https://rads.stackoverflow.com/amzn/click/com/020161586X)和[Goddard航天飞行中心编程标准](http://software.gsfc.nasa.gov/assetsbytype.cfm?TypeAsset=Standard)。

从 debug.h 文件（起源于 1990 年，因此不使用`__VA_ARGS__`）：

```
/*
** Usage:  TRACE((level, fmt, ...))
** "level" is the debugging level which must be operational for the output
** to appear. "fmt" is a printf format string. "..." is whatever extra
** arguments fmt requires (possibly nothing).
** The non-debug macro means that the code is validated but never called.
** -- See chapter 8 of 'The Practice of Programming', by Kernighan and Pike.
*/
#ifdef DEBUG
#define TRACE(x)    db_print x
#else
#define TRACE(x)    do { if (0) db_print x; } while (0)
#endif /* DEBUG */ 
```

使用 C99，不再需要双括号技巧。除非 C89 兼容性有问题，否则新代码不应使用它。

* * *

## 回答 #2

> 赞同：5
> 
>             
> 
> 时间：2009-02-13T18:04:57.287

也许更简单的方法是有条件地省略函数体？

```
void MyFunction() {
#ifndef SOMETHING
    <body of function>
#endif
} 
```

除非您完全不希望进行函数调用，否则这似乎是实现目标的一种干净方法。

* * *

## 回答 #3

> 赞同：3
> 
>             
> 
> 时间：2009-02-13T19:08:34.483

不幸的是，当前的 C++ 版本不支持可变参数宏。

但是，您可以这样做：

```
#ifdef SOMETHING
#define foo
#else
#define foo(args) MyFunction args
#endif

// you call it with double parens:
foo((a, b, c)); 
```

* * *

## 回答 #4

> 赞同：2
> 
>             
> 
> 时间：2009-02-13T19:01:47.120

如果在您不想调用 foo 的情况下，您将其定义为：

```
void foo() {} 
```

对 foo() 的任何调用都应该以优化方式进行。

* * *

## 回答 #5

> 赞同：2
> 
>             
> 
> 时间：2009-02-13T19:08:18.150

沿着这些路线怎么样：

```
#ifdef NDEBUG
#define DEBUG(STATEMENT) ((void)0)
#else
#define DEBUG(STATEMENT) (STATEMENT)
#endif 
```

您可以像这样使用它来记录调试消息：

```
DEBUG(puts("compile with -DNDEBUG and I'm gone")); 
```

* * *

使用 C99 可变参数宏和`__func__`标识符的带有附加调试信息的格式化输出的非通用版本可能如下所示：

```
#ifdef NDEBUG
#define Dprintf(FORMAT, ...) ((void)0)
#define Dputs(MSG) ((void)0)
#else
#define Dprintf(FORMAT, ...) \
    fprintf(stderr, "%s() in %s, line %i: " FORMAT "\n", \
        __func__, __FILE__, __LINE__, __VA_ARGS__)
#define Dputs(MSG) Dprintf("%s", MSG)
#endif 
```

以下是如何使用这些宏：

```
Dprintf("count = %i", count);
Dputs("checkpoint passed"); 
```

* * *

## 回答 #6

> 赞同：2
> 
>             
> 
> 时间：2009-02-13T22:41:17.730

很可能，您不想按照建议进行简单的“代码删除”，因为您的调用者会期待参数的副作用发生。以下是一些令人头疼的调用者片段，应该让您思考：

```
// pre/post increment inside method call:
MyFunction(i++); 

// Function call (with side effects) used as method argument: 
MyFunction( StoreNewUsernameIntoDatabase(username) ); 
```

如果您要通过简单地说来禁用 MyFunction：

```
#define MyFunction(x) 
```

那么调用者所期望的副作用就会消失，他们的代码就会中断，并且很难调试。我喜欢上面的“sizeof”建议，我也喜欢通过#ifdef 禁用MyFunction() 主体的建议，尽管这意味着所有调用者都获得相同版本的MyFunction()。根据您的问题陈述，我认为这实际上不是您想要的。

如果您确实需要通过基于每个源文件的预处理器定义来禁用 MyFunction()，那么我会这样做：

```
#ifdef SOMETHING 
#define MyFunction(x) NoOp_MyFunction(x) 

int NoOp_MyFunction(x) { } 
#endif 
```

您甚至可以在 MyFunction() 的源代码和标头中包含 NoOp_MyFunction() 的实现。您还可以灵活地在 NoOp_MyFunction() 中添加额外的日志记录或调试信息。

* * *

## 回答 #7

> 赞同：1
> 
>             
> 
> 时间：2009-02-13T19:09:14.950

不，C 和 C++ 标准说你不能 #define 某事作为评论，所以

```
#define foo // 
```

不会工作。

* * *

## 回答 #8

> 赞同：1
> 
>             
> 
> 时间：2009-02-13T19:12:08.717

```
#ifdef SOMETHING
#define foo sizeof
#else
#define foo MyFunction
#endif 
```

我假设 foo 是一个`printf`样式函数？无论如何，这不适用于零参数函数，但如果是这种情况，您已经知道该怎么做。如果你真的想成为肛门，你可以使用`(void)sizeof`，但这可能是不必要的。

* * *

## 回答 #9

> 赞同：1
> 
>             
> 
> 时间：2009-02-14T08:29:33.900

我有点不愿意发布这个答案，因为它使用宏黑客可能成为问题的根源。但是 -**如果**对您想要消失的函数的调用始终在语句中单独使用（即，它们永远不是更大表达式的一部分），那么类似以下的东西可以工作（并且它处理可变参数）：

```
#ifdef SOMETHING
#define foo (1) ? ((void) 0) : (void)
#else
#define foo MyFunction
#endif 
```

所以如果你有这行代码：

```
foo( "this is a %s - a++ is %d\n", "test", a++); 
```

它将在预处理步骤之后结束：

```
MyFunction( "this is a %s - a++ is %d\n", "test", a++); 
```

或者

```
(1) ? ((void) 0) : (void)( "this is a %s - a++ is %d\n", "test", a++); 
```

这会将伪函数的参数列表变成一堆由逗号运算符分隔的表达式，这些表达式永远不会被计算，因为条件总是返回`((void) 0)`结果。

这种变体与 ChriSW 和 Jonathan Leffler 的建议相近：

```
#ifdef SOMETHING
#define foo if (0) MyFunction
#else
#define foo if (1) MyFunction
#endif 
```

这略有不同，因为它不需要编译器支持可变参数宏 ( `__VA_ARGS__`)。

我认为这对于消除通常不会组合成更大表达式的调试跟踪函数调用很有用，但除此之外，我认为这是一种危险的技术。

请注意潜在的问题 - 特别是如果调用中的参数产生副作用（这是宏的一般问题 - 不仅仅是这个 hack）。在示例中，`a++`只有在构建中定义时才会评估`SOMETHING`，否则不会。因此，如果调用后的代码依赖于`a`要递增的值，则其中一个构建存在错误。

* * *

## 回答 #10

> 赞同：0
> 
>             
> 
> 时间：2009-02-13T18:04:55.900

如果我没记错的话，您应该能够将您的宏#define 为“无”，这将导致编译器忽略该调用

```
#define foo()

foo();    // this will be ignored 
```

* * *

## 回答 #11

> 赞同：0
> 
>             
> 
> 时间：2009-02-13T20:42:30.217

如何围绕每个调用 myFunction

```
#ifdef SOMETHING
myFunction(...);
#endif 
```

?

# .net - 使用代理时避免中间人攻击

> ID：546998
> 
>         
> 
> 赞同：2
> 
>         
> 
> 时间：2009-02-13T18:01:50.663
> 
>         
> 
> 标签：.net, authentication, proxy

我有一个 Web 应用程序，它将身份验证密钥传递给 Web 服务以确保安全。为了避免中间人攻击，每个请求的 IP 地址都会与初始身份验证请求中的 IP 地址进行检查。但是，当从使用代理服务器的机器访问时，IP 地址不一定相同。我能做些什么来避免这个问题？

* * *

## 回答 #1

> 赞同：2
> 
>             
> 
> 时间：2009-02-13T18:15:10.880

IP 地址很容易被欺骗，因此这不是一个非常有用的保护措施。

在尝试实现协议级别的安全性时，请始终使用其他人的经过充分测试和推理的设计（最好是实现）而不是您自己的，除非不这样做的理由令人信服。

[http://en.wikipedia.org/wiki/WS-Security](http://en.wikipedia.org/wiki/WS-Security)存在并且简单地使整个链使用 https 应该足以满足您的需求（只要安全性开销不是问题）。

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2009-02-13T18:19:56.953

我想最简单的方法是使用 SSL。

如果您不能使用 SSL，您可以使用 XMLSigniture，它至少可以让您检测消息是否已被更改。这是一篇关于在 Java 中使用它的好文章：

[http://java.sun.com/developer/technicalArticles/xml/dig_signature_api/](http://java.sun.com/developer/technicalArticles/xml/dig_signature_api/)*```**** 
```******