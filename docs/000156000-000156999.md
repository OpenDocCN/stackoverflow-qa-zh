# StackOverflow 问答 000156000-000156999

# java - 保护 servlet 应用程序中的内部视图层模板页面

> ID：156002
> 
> 赞同：1
> 
> 时间：2008-10-01T02:31:34.147
> 
> 标签：java, architecture, servlets

我有一个关于 Java 中的 MVC Web 应用程序的非常基本的问题。

从原始 JSP 的早期直到像 Seam 这样的当前技术，一个非常基本的模式一直是从最初接受请求的控制器到视图层的内部调度，该视图层创建要发送到客户端的输出。

这种内部调度通常是通过使用 URL 向 servlet 容器请求新资源来完成的（尽管该机制可能通过额外的配置层隐藏）。这些 URL 的映射由相同的 web.xml 完成，该 web.xml 还定义了到外部的“真实”URL。

除非采取特殊措施，否则通常可以直接访问视图层。见证Seam“注册”演示，您可以在其中绕过“register.seam”并直接转到“registered.xhtml”。这是一个潜在的安全问题。至少，它泄露了视图模板源代码。

我知道这只是一个基本的示例应用程序，但也很奇怪，需要采取任何额外的措施来声明这些内部资源对外部不可见。

限制 URL 入口点的最简单方法是什么？

是否可能有类似“WEB-INF”目录的东西，一个只能由内部请求访问的神奇 URL 路径组件？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-17T14:37:06.003

[`security-constraint`](http://wiki.metawerx.net/wiki/Web.xml.SecurityConstraint)您可以通过在`web.xml`部署描述符中使用 a 来阻止对内部资源的访问。

例如，我使用以下配置来防止直接访问 JSP：

```
<!-- Prevent direct access to JSPs. -->
<security-constraint>
    <web-resource-collection>
        <web-resource-name>JSP templates</web-resource-name>
        <url-pattern>*.jsp</url-pattern>
    </web-resource-collection>
    <auth-constraint/> <!-- i.e. nobody -->
</security-constraint> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-01T02:38:01.133

我不建议允许 Internet 请求直接访问您的应用服务器。我会在前面放置一个网络服务器，然后在其中允许某些类型的 URL 的请求。不想让人们访问 foo.com/jsps？一劳永逸地限制它。

这里有一些关于该主题的对话：[将页面隐藏在 WEB-INF 后面？](http://saloon.javaranch.com/cgi-bin/ubb/ultimatebb.cgi?ubb=get_topic&f=82&t=002101)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-01T03:55:01.823

处理这个问题的一种方法是构造一个 Servlet 过滤器，它检查每个请求的请求路径并相应地处理每个请求。这是一个可以帮助您入门的链接，[JavaServer Pages (JSP) and JSTL - Access control with JSP](http://forums.sun.com/thread.jspa?threadID=694692&messageID=4230759)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-01-12T01:06:58.110

我现在已经看到了几个将其内部 JSP 放入`WEB-INF/jsp`. 这似乎可以解决问题，至少对于 JSP 和 Velocity 来说也是如此。不过，它[似乎不适用于 JSF](http://www.coderanch.com/t/212515/JSF/java/hiding-pages-behind-WEB-INF)。

# sql-server - 是否可以重命名 SQL Server 2005 实例

> ID：156004
> 
> 赞同：6
> 
> 时间：2008-10-01T02:32:41.413
> 
> 标签：sql-server, sql-server-2005

我想更改我的 SQL Server 实例的名称。有没有一种简单的方法可以做到这一点，还是需要付出很大的努力？请注意，这是一个命名实例 - 不是默认实例。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-01T02:39:35.420

唯一的方法是重新安装。有关详细信息，请参阅此类似线程：[SQL Server，将命名实例转换为默认实例？](https://stackoverflow.com/questions/35026/sql-server-convert-a-named-instance-to-default-instance#35641)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-01T05:45:02.730

或者你可以试试这个方法： [http ://groups.google.com/group/microsoft.public.sqlserver.server/browse_thread/thread/544c4eaf43ddfaf3/f1bdcd1ec9cab158#f1bdcd1ec9cab158](http://groups.google.com/group/microsoft.public.sqlserver.server/browse_thread/thread/544c4eaf43ddfaf3/f1bdcd1ec9cab158#f1bdcd1ec9cab158)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-01T06:06:02.133

我已经看到了一些临时的方法来做到这一点，但我对其中任何一个都没有信心。我想我会简单地安装一个新实例并将我的信息传输过来。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-01T06:22:41.627

重命名在注册表上效果不佳。安装一个新的实例。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-12-09T22:15:52.090

尽管没有一种简单的方法可以重命名 SQL Server 实例，但可以[创建 SQL 别名](http://geekswithblogs.net/twickers/archive/2009/12/08/136830.aspx)。

# regex - Perl：从文件中的每一行中获取第 n 个和第 m 个分隔的单词

> ID：156009
> 
> 赞同：8
> 
> 时间：2008-10-01T02:34:20.020
> 
> 标签：regex, perl, file-io

由于在 Nagios 中添加要监控的主机的方式更为繁琐（它需要定义一个主机对象，而不是之前只需要 IP 和主机名的程序），我认为最好自动化它，它会是学习 Perl 的好时机，因为我现在只知道 C/C++ 和 Java。

我从中读取的文件如下所示：

```
xxx.xxx.xxx.xxx hostname #comments. i.dont. care. about 
```

我想要的只是前两串字符。这些显然是用空格分隔的，但为了通用性，它也可以是任何东西。为了更笼统地说，为什么不是第一和第三，或第四和第十？当然，肯定会涉及到一些正则表达式操作，但我暂时不考虑这个标签，以防万一。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-01T03:01:16.930

如果您不编写更多 Perl 来处理结果，那么单行代码很棒。

更一般地说，在较大的 Perl 程序的上下文中，您可以编写自定义正则表达式，例如：

```
if($line =~ m/(\S+)\s+(\S+)/) {
     $ip = $1;
     $hostname = $2;
} 
```

...或者您将使用*拆分*运算符。

```
my @arr = split(/ /, $line);
$ip = $arr[0];
$hostname = $arr[1]; 
```

无论哪种方式，添加逻辑以检查无效输入。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-01T02:43:27.657

让我们把它变成代码高尔夫！根据大卫的出色回答，这是我的：

```
perl -ane 'print "@F[0,1]\n";' 
```

编辑：一个真正的高尔夫提交看起来更像这样（剃掉五杆）：

```
perl -ape '$_="@F[0,1]
"' 
```

但这对于这个问题的目的来说不太可读。:-P

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-10-01T02:47:26.620

这是一个通用的解决方案（如果我们稍微远离代码高尔夫）。

```
#!/usr/bin/perl -n
chop;                     # strip newline (in case next line doesn't strip it)
s/#.*//;                  # strip comments
next unless /\S/;         # don't process line if it has nothing (left)
@fields = (split)[0,1];   # split line, and get wanted fields
print join(' ', @fields), "\n"; 
```

通常`split`按空格分割。如果这不是您想要的（例如 parsing `/etc/passwd`），您可以将分隔符作为正则表达式传递：

```
@fields = (split /:/)[0,2,4..6]; 
```

当然，如果您正在解析以冒号分隔的文件，那么这些文件也很有可能没有注释并且您不必删除它们。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-10-01T02:38:33.613

一个简单的单线是

```
perl -nae 'print "$F[0] $F[1]\n";' 
```

您可以更改分隔符`-F`

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-10-01T02:46:15.280

大卫尼姆说：

```
perl -nae 'print "$F[0] $F[1}\n"; 
```

它使用`-a`开关。我不得不查一下：

```
-a   turns on autosplit mode when used with a -n or -p.  An implicit split
     command to the @F array is done as the first thing inside the implicit
     while loop produced by the -n or -p. 
```

你每天都学到一些东西。-n 使每一行都传递给

```
LINE:
    while (<>) {
        ...             # your program goes here
    } 
```

最后`-e`是一种直接输入单行程序的方法。您可以拥有超过`-e`. 其中大部分是手册`perlrun(1)`页的翻版。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-01T23:32:29.653

既然 ray 问了，我想我会重写我的整个程序而不使用 Perl 的隐含性（除了使用`<ARGV>`; 这很难用手写出来）。这可能会让 Python 人更快乐（尽管有大括号:-P）：

```
while (my $line = <ARGV>) {
    chop $line;
    $line =~ s/#.*//;
    next unless $line =~ /\S/;
    @fields = (split ' ', $line)[0,1];
    print join(' ', @fields), "\n";
} 
```

有什么我错过的吗？希望不会。`ARGV`文件句柄是特殊的。它会读取命令行上的每个命名文件，除非没有指定，在这种情况下它会读取标准输入。

编辑：哦，我忘了。`split ' '`也很神奇，不像`split / /`。后者只是匹配一个空格。前者匹配任意数量的任意空格。如果没有为`split`. （有些人会说，*但是`/\s+/`*?`' '`和`/\s+/`相似呢，除了如何处理行首的空格。所以`' '`真的很神奇。）

这个故事的寓意是，如果你喜欢很多神奇的行为，Perl 就很棒。如果您没有它，请使用 Python。:-P

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-12-31T04:55:55.233

# 在第 L 行中查找第 N 到第 M 个字符 --- 查找标签示例

* * *

```
@echo off

REM Next line = Set command value to a file  OR  Just Choose Your File By Skipping The Line
vol E: > %temp%\justtmp.txt
REM  Vol E:  = Find Volume Lable Of Drive E

REM  Next Line to choose line line no. +0 = line no. 1 
for /f "usebackq delims=" %%a in (`more +0 %temp%\justtmp.txt`) DO (set findstringline=%%a& goto :nextstep)

:nextstep

REM  Next line to read nth to mth Character  here 22th Character to 40th Character
set result=%findstringline:~22,40%

echo %result%
pause
exit /b 
```

另存为查找标签.cmd

结果将是您的 Drive E 标签

享受

# haskell - do 块中 case 表达式的 Haskell 语法

> ID：156013
> 
> 赞同：26
> 
> 时间：2008-10-01T02:36:51.230
> 
> 标签：haskell, syntax, monads

`case`我无法用块中的表达式完全弄清楚这个语法问题`do`。

什么是正确的语法？

如果你能纠正我的例子并解释它，那将是最好的。

```
module Main where 

main = do   
     putStrLn "This is a test"
     s <- foo
     putStrLn s  

foo = do
    args <- getArgs 
    return case args of
                [] -> "No Args"
                [s]-> "Some Args" 
```

一点更新。我的源文件是空格和制表符的混合体，它导致了各种问题。只是给从 Haskell 开始的任何其他人的小费。如果您遇到问题，请检查源代码中的制表符和空格。

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2008-10-01T02:51:27.407

return 是一个（重载的）函数，它不期望它的第一个参数是关键字。您可以用括号括起来：

```
module Main where 
import System(getArgs)

main = do   
     putStrLn "This is a test"
     s <- foo
     putStrLn s  

foo = do
    args <- getArgs 
    return (case args of
                [] -> "No Args"
                [s]-> "Some Args") 
```

或使用方便的应用程序运算符 ($)：

```
foo = do
    args <- getArgs 
    return $ case args of
                [] -> "No Args"
                [s]-> "Some Args" 
```

Stylewise，我会把它分解成另一个函数：

```
foo = do
    args <- getArgs 
    return (has_args args)

has_args [] = "No Args"
has_args _  = "Some Args" 
```

但是你仍然需要括号或使用（$），因为return接受一个参数，并且函数应用程序是最高优先级。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-10-01T06:31:34.070

等效地：

```
foo = do
  args <- getArgs 
  case args of
        [] -> return "No Args"
        [s]-> return "Some Args" 
```

按照 wnoise 的建议，这样做可能更可取，但这可能有助于某人更好地理解。

# java - 你如何存储日期范围，实际上是时间戳

> ID：156032
> 
> 赞同：7
> 
> 时间：2008-10-01T02:45:06.047
> 
> 标签：java, oracle, architecture, types, date-range

Java 和 Oracle 都有一个称为 Date的*时间戳类型。*开发人员倾向于将它们当作*日历*日期来操作，我已经看到这会导致令人讨厌的一次性错误。

1.  对于基本日期数量，您可以在输入时简单地切断时间部分，即降低精度。但是，如果您使用日期范围（例如：**9/29-9/30**）执行此操作，则这两个值之间的差异是 1 天，而不是 2。此外，范围比较需要 1）截断操作：`start < trunc(now) <= end`，或2）算术：`start < now < (end + 24hrs)`。不可怕，但不[干燥](http://www.artima.com/intv/dry.html)。

2.  另一种方法是使用真正的时间戳：**9/29** 00:00:00 - **10/1** 00:00:00。（午夜到午夜，因此不包括 10 月的任何部分）。现在持续时间本质上是正确的，并且范围比较更简单：`start <= now < end`. 对于内部处理来说当然更干净，但是结束日期确实需要在初始输入 (+1) 和输出 (-1) 时进行转换，假设在用户级别使用日历日期隐喻。

您如何处理项目的日期范围？还有其他选择吗？我对您如何在等式的 Java 和 Oracle 方面处理这个问题特别感兴趣。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-01T08:00:36.490

这是我们如何做到的。

1.  使用时间戳。

2.  使用半开区间进行比较： `start <= now < end`。

忽略那些坚持认为 BETWEEN 对成功的 SQL 至关重要的抱怨。

有了这一系列的日期范围真的很容易审核。`9/30 to 10/1`包含一天 (9/30)的数据库值。下一个区间的开始必须等于前一个区间的结束。该`interval[n-1].end == interval[n].start`规则便于审计。

显示时，如果需要，可以显示格式化的`start`和`end`-1。事实证明，您*可以*教育人们了解“结束”实际上是规则不再适用的第一天。所以“9/30 到 10/1”的意思是“从 9/30 开始有效，从 10/1 开始不再有效”。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-01T02:50:14.897

Oracle 具有[TIMESTAMP 数据类型](http://download.oracle.com/docs/cd/B28359_01/server.111/b28286/sql_elements001.htm#SQLRF00203)。它存储 DATE 数据类型的年、月和日，以及小时、分钟、秒和小数秒值。

这是[asktom.oracle.com 上](http://asktom.oracle.com/pls/asktom/f?p=100:11:0::::P11_QUESTION_ID:96012348060)关于日期算术的主题。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-15T23:40:45.010

我赞同 S.Lott 的解释。我们有一个产品套件，它广泛使用日期时间范围，使用这样的范围是我们的经验教训之一。顺便说一句，如果结束日期不再是范围的一部分（IOW，半开区间） ，我们将结束日期称为*排他结束日期。*相反，如果它算作范围的一部分，则它是一个*包含性*的结束日期，只有在没有时间部分时才有意义。

用户通常期望包含日期范围的输入/输出。无论如何，尽快将用户输入转换为专有结束日期范围，并在必须向用户显示时尽可能晚地转换任何日期范围。

在数据库上，始终存储独占结束日期范围。如果存在包含结束日期范围的旧数据，请尽可能将它们迁移到数据库上，或者在读取数据时尽快转换为独占结束日期范围。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-01T02:48:38.863

我使用 Oracle 的日期数据类型，并就影响边界条件的时间组件问题向开发人员提供教育。

数据库约束还将防止意外指定应该没有的列中的时间分量，并且还告诉优化器没有任何值具有时间分量。

例如，约束 CHECK (MY_DATE=TRUNC(MY_DATE)) 可防止将时间不是 00:00:00 的值放入 my_date 列，还允许 Oracle 推断诸如 MY_DATE = TO_DATE(' 2008-09-12 15:00:00') 永远不会是真的，因此不会从表中返回任何行，因为它可以扩展为：

```
MY_DATE = TO_DATE('2008-09-12 15:00:00') AND
TO_DATE('2008-09-12 15:00:00') = TRUNC(TO_DATE('2008-09-12 15:00:00')) 
```

这当然是自动错误的。

尽管有时将日期存储为数字（例如 20080915）很诱人，但这可能会导致查询优化问题。例如，在 20,071,231 和 20,070,101 之间有多少个合法值？在 2007 年 12 月 31 日和 2008 年 1 月 1 日这两个日期之间怎么样？它还允许输入非法值，例如 20070100。

因此，如果您有没有时间组件的日期，那么定义一个范围就变得很容易：

```
select ...
from   ...
where  my_date Between date '2008-01-01' and date '2008-01-05' 
```

当有时间组件时，您可以执行以下操作之一：

```
select ...
from   ...
where  my_date >= date '2008-01-01' and
       my_date  < date '2008-01-06' 
```

或者

```
select ...
from   ...
where  my_date Between date '2008-01-01'
                   and date '2008-01-05'-(1/24/60/60) 
```

注意使用 (1/24/60/60) 代替幻数。在 Oracle 中，通过添加一天中定义的小数来执行日期算术是很常见的…… 3/24 表示三个小时，27/24/60 表示 27 分钟。这种类型的 Oracle 数学是精确的，不会出现舍入错误，因此：

```
select 27/24/60 from dual; 
```

...给出 0.01875，而不是 0.01874999999999 或其他任何值。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-01T15:26:29.120

我还没有看到发布的间隔数据类型。

Oracle 还具有适合您的确切场景的数据类型。Oracle 中也有 INTERVAL YEAR TO MONTH 和 INTERVAL DAY TO SECOND 数据类型。

来自 10gR2 文档。

> INTERVAL YEAR TO MONTH 使用 YEAR 和 MONTH 日期时间字段存储一段时间。当只有年份和月份值很重要时，此数据类型可用于表示两个日期时间值之间的差异。
> 
> INTERVAL YEAR [(year_precision)] TO MONTH
> 
> 其中 year_precision 是 YEAR 日期时间字段中的位数。year_precision 的默认值为 2。
> 
> INTERVAL DAY TO SECOND 数据类型
> 
> INTERVAL DAY TO SECOND 以天、小时、分钟和秒的形式存储一段时间。此数据类型可用于表示两个日期时间值之间的精确差异。
> 
> 按如下方式指定此数据类型：
> 
> INTERVAL DAY [(day_precision)] 到 SECOND [(fractional_seconds_precision)]
> 
> 在哪里
> 
> day_precision 是 DAY 日期时间字段中的位数。可接受的值为 0 到 9。默认值为 2。
> 
> fractional_seconds_precision 是 SECOND 日期时间字段的小数部分的位数。可接受的值为 0 到 9。默认值为 6。
> 
> 将区间值指定为文字时，您有很大的灵活性。有关将区间值指定为文字的详细信息，请参阅“区间文字”。另请参阅“日期时间和间隔示例”以获取使用间隔的示例。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-01T02:47:27.603

根据您的第一句话，您偶然发现了 Java 的一个隐藏“功能”（即错误）：`java.util.Date`应该是不可变的，但它不是。（Java 7 承诺使用新的日期/时间 API 来解决这个问题。）几乎每个企业应用程序都依赖于各种[时间模式](http://martinfowler.com/articles.html#id21974)，并且在某些时候您需要对日期和时间进行算术运算。

理想情况下，您可以使用Google 日历使用的[Joda time 。](http://joda-time.sourceforge.net/)如果你不能这样做，我猜一个 API 由一个包装器组成，其`java.util.Date`计算方法类似于 Grails/Rails，并且你的包装器范围（即指示时间段开始和结束的有序对）将就足够了。

在我当前的项目（一个 HR 计时应用程序）中，我们尝试将所有日期标准化为 Oracle 和 Java 的同一时区。幸运的是，我们的本地化要求是轻量级的（= 1 个时区就足够了）。当持久对象不需要比一天更精细的精度时，我们使用从午夜开始的时间戳。我会更进一步，坚持将额外的毫秒丢弃到持久对象可以容忍的最粗粒度（这将使您的处理更简单）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-01T02:48:49.610

根据我的经验，有四种主要方法可以做到这一点：

1) 将日期转换为纪元整数（自 1970 年 1 月 1 日以来的秒数）并将其作为整数存储在数据库中。

2) 将日期转换为 YYYYMMDDHHMMSS 整数，并将其作为整数存储在数据库中。

3）将其存储为日期

4）将其存储为字符串

我一直坚持使用 1 和 2，因为它使您能够对日期执行快速简单的算术运算，而不依赖于底层数据库功能。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-01T03:48:34.350

*通过将getTime()*的结果存储为长整数，所有日期都可以明确存储为 GMT 时间戳（即没有时区或夏令时问题） 。

在数据库查询中需要日、周、月等操作的情况下，并且当查询性能至关重要时，可以将时间戳（标准化为比毫秒更高的粒度）链接到具有当天列的日期分解表、周、月等值，以便不必在查询中使用昂贵的日期/时间函数。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-01T04:19:30.423

艾伦是对的——乔达时间很棒。java.util.Date 和 Calendar 只是一个耻辱。

如果您需要时间戳，请使用带有时间的 oracle 日期类型，请使用某种后缀（如 _tmst）命名列。当您将数据读入 java 时，将其放入 joda time DateTime 对象中。为确保时区正确，请考虑 oracle 中的特定数据类型，它们会将时间戳与时区一起存储。或者，您可以在表中创建另一列来存储时区 ID。时区 ID 的值应该是时区的标准全名 ID，请参阅[http://java.sun.com/j2se/1.4.2/docs/api/java/util/TimeZone.html#getTimeZone%28java.lang.String% 29](http://java.sun.com/j2se/1.4.2/docs/api/java/util/TimeZone.html#getTimeZone%28java.lang.String%29) . 如果您为 TZ dta 使用另一列，那么当您将数据读入 java 时使用 DateTime 对象，但使用 .withZoneRetainFields 在 DateTime 对象上设置时区来设置时区。

如果您只需要日期数据（无时间戳），则使用数据库中的日期类型而不需要时间。再次命名它。在这种情况下，使用来自 jodatime 的 DateMidnight 对象。

底线：利用数据库的类型系统和您使用的语言。学习它们并获得使用富有表现力的 api 和语言语法来处理您的问题的好处。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2014-03-23T19:24:58.993

更新：Joda-Time 项目现在处于维护模式。它的团队建议迁移到 Java 中内置的*java.time*类。

# 乔达时间

Joda-Time 提供 3 个类来表示时间跨度：Interval、Duration 和 Period。

ISO 8601 标准指定了如何格式化表示[Duration](https://en.wikipedia.org/wiki/ISO_8601#Durations)和[Interval](https://en.wikipedia.org/wiki/ISO_8601#Time_intervals)的字符串。Joda-Time 解析和生成这样的字符串。

时区是一个重要的考虑因素。您的数据库应该以 UTC 格式存储其日期时间值。但是您的业务逻辑可能需要考虑时区。“一天”的开始取决于时区。顺便说一句，使用[正确的时区名称](https://en.wikipedia.org/wiki/List_of_tz_database_time_zones)而不是 3 或 4 个字母代码。

S.Lott的[正确答案](https://stackoverflow.com/a/156639/642706)明智地建议使用半开逻辑，因为这通常最适合日期时间工作。时间跨度的开始是*包容性*的，而结束是*排斥*性的。Joda-Time 在其方法中使用半开逻辑。

![将一周定义为大于或等于第 1 天且小于第 8 天的图表](https://i.stack.imgur.com/kE3r8.png)

```
DateTimeZone timeZone_NewYork = DateTimeZone.forID( "America/New_York" );
DateTime start = new DateTime( 2014, 9, 29, 15, 16, 17, timeZone_NewYork );
DateTime stop = new DateTime( 2014, 9, 30, 1, 2, 3, timeZone_NewYork );

int daysBetween = Days.daysBetween( start, stop ).getDays();

Period period = new Period( start, stop );

Interval interval = new Interval( start, stop );
Interval intervalWholeDays = new Interval( start.withTimeAtStartOfDay(), stop.plusDays( 1 ).withTimeAtStartOfDay() );

DateTime lateNight29th = new DateTime( 2014, 9, 29, 23, 0, 0, timeZone_NewYork );
boolean containsLateNight29th = interval.contains( lateNight29th ); 
```

转储到控制台...</p>

```
System.out.println( "start: " + start );
System.out.println( "stop: " + stop );
System.out.println( "daysBetween: " + daysBetween );
System.out.println( "period: " + period ); // Uses format: PnYnMnDTnHnMnS
System.out.println( "interval: " + interval );
System.out.println( "intervalWholeDays: " + intervalWholeDays );
System.out.println( "lateNight29th: " + lateNight29th );
System.out.println( "containsLateNight29th: " + containsLateNight29th ); 
```

运行时……</p>

```
start: 2014-09-29T15:16:17.000-04:00
stop: 2014-09-30T01:02:03.000-04:00
daysBetween: 0
period: PT9H45M46S
interval: 2014-09-29T15:16:17.000-04:00/2014-09-30T01:02:03.000-04:00
intervalWholeDays: 2014-09-29T00:00:00.000-04:00/2014-10-01T00:00:00.000-04:00
lateNight29th: 2014-09-29T23:00:00.000-04:00
containsLateNight29th: true 
```

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2008-10-01T02:53:04.717

我以毫秒为单位存储所有日期。我根本不使用时间戳/日期时间字段。

所以，我必须尽可能长时间地操纵它。这意味着我不在我的 sql 查询中使用“之前”、“之后”、“现在”关键字。

# php - 在 Facebook 应用程序中，有没有办法直接链接到“加入群组”

> ID：156033
> 
> 赞同：1
> 
> 时间：2008-10-01T02:45:40.897
> 
> 标签：php, facebook

我想要一个链接，让用户从我的 Facebook 应用程序中加入 Facebook 群组。

这是 Facebook 的“显示群组”页面上的链接（减去较长的引用部分），但群组 ID 是加密的：

[http://www.new.facebook.com/group.php?sid=c431b3cfc02765def331081f8b71ffbd](http://www.new.facebook.com/group.php?sid=c431b3cfc02765def331081f8b71ffbd)

任何人都知道如何以 Facebook 方式加密群组 ID 或以其他方式构建将用户添加到群组的链接？

谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-01T08:12:08.617

你不能只使用组ID吗？

这对我有用： http: [//www.new.facebook.com/group.php?gid={ID}](http://www.new.facebook.com/group.php?gid=%7BID%7D)

# tfs - 如何将 TFS 签入注释限制为自定义路径？

> ID：156035
> 
> 赞同：3
> 
> 时间：2008-10-01T02:46:44.140
> 
> 标签：tfs

您可以通过“自定义路径”策略限制“签入策略”规则。但是“签入说明”选项卡似乎不适合同一个系统。为什么“入住记录”不只是另一个“入住政策”？

我正在使用 Team Foundation Server 2008 SP1

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-04T09:30:23.667

前段时间我们也遇到过类似的问题。对于某些子树，我们希望要求输入代码审查员。我最终实施了自定义策略并使用自定义路径策略将其限制为某些文件夹。[这很好用，只是您必须部署策略程序集，而 TFS 还没有](http://blogs.msdn.com/bharry/archive/2008/10/01/preview-of-the-next-tfs-power-tools-release.aspx)内置机制。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-01T05:33:35.800

这是一个有趣的问题——简短的回答是你不能。

我自己也经常遇到这样的问题，人们对签入说明和签入政策感到困惑，因为虽然在服务器上的实现非常不同，但它们通常用于相似的目的。

签到笔记是您希望在每次签到团队项目时收集的结构化元数据。它们可以被认为是代码审查者或对外部 CRM 系统中的票证的引用或其他东西。您可以将它们设为必需，或者只定义它们以供人们选择填写。

签入策略是在签入时在客户端上运行的代码位，用于决定是否应允许签入。这些对于检查诸如您已将签入与工作项相关联的事情很有用，给它一个注释或您签入的代码通过某些关键的静态代码分析规则（例如 SQL 注入攻击的基本检查等） . 如果签入策略在签入评估中失败，则用户会收到警报，并且他们可以通过签入策略覆盖解决问题或签入，而不是轻松报告或提醒由 TFS 管理员。

签入说明和签入策略均在团队项目级别定义和范围。然而，微软得到反馈，有些人希望签入策略希望应用于版本控制中的特定路径，而不仅仅是团队项目，因此发明了自定义路径策略。

自定义路径策略有点像 hack，它允许您将签入策略包装在自定义路径策略中。每次签入时都会评估自定义路径，如果它在定义的路径中包含文件，则会针对这些文件评估包装的签入策略。自定义路径策略包含在[TFS 电动工具](http://msdn.microsoft.com/en-us/tfs2008/bb980963.aspx)中，不是“开箱即用”TFS 体验的一部分。

所以，以不同的方式回答你的问题——我怀疑答案是“因为它是这样设计的，而且没有足够的人要求改变它”。

如果您想在[http://connect.microsoft.com/VisualStudio](http://connect.microsoft.com/VisualStudio)上留下反馈，我知道他们非常重视客户反馈。

# version-control - 您如何管理具有分支的中型项目的数据库修订？

> ID：156044
> 
> 赞同：11
> 
> 时间：2008-10-01T02:49:05.757
> 
> 标签：version-control, deployment, project-management, database-versioning

在工作中，我们有 4 个人一起在几个不同的项目上工作。对于每个项目，我们每个人都有一个我们正在处理的本地副本，然后有一个开发、登台和实时部署，以及我们拥有的任何分支（我们使用颠覆）。我们的数据库是 MySQL。

所以我的问题是，什么是管理对每个部署（以及开发人员的本地副本）进行了哪些数据库修订的好方法。现在，每个更改都会进入一个文本文件，该文件的名称带有时间戳，并放入项目下的文件夹中。老实说，这不是很好。我需要一个解决方案来帮助跟踪在哪里应用了什么。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-01T02:54:58.770

[http://odetocode.com/Blogs/scott/archive/2008/01/30/11702.aspx](http://odetocode.com/Blogs/scott/archive/2008/01/30/11702.aspx)

上面的博客将我们带到了我们当前的数据库版本控制系统。简而言之，没有更新脚本就不会更改数据库，并且所有更新脚本都在我们的源代码控制存储库中。

我们只管理架构更改，但您也可以/愿意考虑在版本控制中保留您的数据转储；使用 mysqldump 创建此类文件是一项非常简单的练习。

我们的解决方案与博客中介绍的解决方案有一个关键之处：它不是自动化的。我们必须手动应用数据库更新等。虽然这可能会稍微耗时，但它推迟了全自动系统所需的一些工作。然而，我们自动化的一件事是软件中的数据库版本跟踪：这非常简单，它确保我们的软件知道它正在运行的数据库，并且只有在它知道它正在使用的模式时才会运行。

我们解决方案中最困难的部分是如何将来自分支的更新合并到我们的主干中。我们花了一些时间来开发一个工作流来解决两个开发人员同时尝试将分支与数据库更新合并的可能性以及如何处理它。我们最终决定在版本控制中锁定一个文件（对我们来说，有问题的文件实际上是一个表映射软件版本到数据库版本，这有助于我们的手动管理策略），就像你锁定一个线程的关键部分，以及获得锁是关于他们更新后备箱的。完成后，其他开发人员将能够锁定，他们有责任对其脚本进行任何必要的更改，以确保避免预期的版本冲突和其他不良 juju。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-01T03:08:29.097

我们将所有数据库脚本（数据和模式/ddl）保存在版本控制中。我们还保留了更改的中央目录。当开发人员对模式/DDL 文件进行更改或添加以某种方式更改数据的脚本时，这些文件将与 SVN 提交号一起添加到目录中。

我们在内部组装了一个小型实用程序，它读取目录更改并通过从目录中的每个修订版中获取内容并应用它们来基于目录的内容构建一个大型更新脚本。这个概念非常类似于[DBDeploy](http://dbdeploy.com/)工具，我相信它最初来自[Thoughtworks](http://www.thoughtworks.com/)，所以你可以使用它。它至少会给你一个很好的起点，从那时起你可以定制一个更直接适合你需求的解决方案。

祝你好运！

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-01T03:53:53.277

如果您的数据库很好地映射到一组数据访问对象，请考虑使用“迁移”。这个想法是将您的数据模型存储为应用程序代码，其中包含在每个数据库版本中前进和后退的步骤。

我相信[Rails 首先做到了](http://wiki.rubyonrails.org/rails/pages/UnderstandingMigrations)。

Java[至少有一个项目](http://code.google.com/p/dbmigrate/)。

这是一个[.NET 迁移库](http://code.google.com/p/migratordotnet/)。

要更改版本，您可以运行一个简单的脚本，逐步检查所有向上或向下的版本，以获取您想要的版本。它的美妙之处在于，您可以将迁移检查到与您的应用程序代码相同的源存储库中 - 这一切都在一个地方。

也许其他人可以建议其他迁移库。

干杯。

编辑：另请参阅[https://stackoverflow.com/questions/313/net-migrations-engine](https://stackoverflow.com/questions/313/net-migrations-engine)和[.NET 数据库迁移工具综述](http://flux88.com/NETDatabaseMigrationToolRoundup.aspx)（来自上面的帖子）。

# c# - 显示表单而不窃取焦点？

> ID：156046
> 
> 赞同：153
> 
> 时间：2008-10-01T02:49:25.833
> 
> 标签：c#, .net, winforms

我正在使用表单来显示通知（它显示在屏幕的右下角），但是当我显示此表单时，它会从主表单中窃取焦点。有没有办法在不窃取焦点的情况下显示这种“通知”表单？

* * *

## 回答 #1

> 赞同：176
> 
> 时间：2008-10-01T14:21:18.713

嗯，简单地覆盖 Form.ShowWithoutActivation 还不够吗？

```
protected override bool ShowWithoutActivation
{
  get { return true; }
} 
```

如果您也不希望用户单击此通知窗口，您可以覆盖 CreateParams：

```
protected override CreateParams CreateParams
{
  get
  {
    CreateParams baseParams = base.CreateParams;

    const int WS_EX_NOACTIVATE = 0x08000000;
    const int WS_EX_TOOLWINDOW = 0x00000080;
    baseParams.ExStyle |= ( int )( WS_EX_NOACTIVATE | WS_EX_TOOLWINDOW );

    return baseParams;
  }
} 
```

* * *

## 回答 #2

> 赞同：73
> 
> 时间：2008-10-01T03:39:40.440

从[PInvoke.net](http://www.pinvoke.net/)的[ShowWindow](http://www.pinvoke.net/default.aspx/user32/ShowWindow.html)方法中窃取：

```
private const int SW_SHOWNOACTIVATE = 4;
private const int HWND_TOPMOST = -1;
private const uint SWP_NOACTIVATE = 0x0010;

[DllImport("user32.dll", EntryPoint = "SetWindowPos")]
static extern bool SetWindowPos(
     int hWnd,             // Window handle
     int hWndInsertAfter,  // Placement-order handle
     int X,                // Horizontal position
     int Y,                // Vertical position
     int cx,               // Width
     int cy,               // Height
     uint uFlags);         // Window positioning flags

[DllImport("user32.dll")]
static extern bool ShowWindow(IntPtr hWnd, int nCmdShow);

static void ShowInactiveTopmost(Form frm)
{
     ShowWindow(frm.Handle, SW_SHOWNOACTIVATE);
     SetWindowPos(frm.Handle.ToInt32(), HWND_TOPMOST,
     frm.Left, frm.Top, frm.Width, frm.Height,
     SWP_NOACTIVATE);
} 
```

（亚历克斯莱曼回答了这个问题，我只是通过直接粘贴代码来扩展它。有编辑权限的人可以将它复制到那里并删除它，我只关心它；））

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2014-08-09T14:09:12.230

这对我有用。它提供 TopMost 但没有窃取焦点。

```
 protected override bool ShowWithoutActivation
    {
       get { return true; }
    }

    private const int WS_EX_TOPMOST = 0x00000008;
    protected override CreateParams CreateParams
    {
       get
       {
          CreateParams createParams = base.CreateParams;
          createParams.ExStyle |= WS_EX_TOPMOST;
          return createParams;
       }
    } 
```

请记住在 Visual Studio 设计器或其他地方忽略设置 TopMost。

这是从这里被盗的、错误的、借来的（点击解决方法）：

[https://connect.microsoft.com/VisualStudio/feedback/details/401311/showwithoutactivation-is-not-supported-with-topmost](https://connect.microsoft.com/VisualStudio/feedback/details/401311/showwithoutactivation-is-not-supported-with-topmost)

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2008-10-01T03:08:53.963

如果您愿意使用[Win32](http://en.wikipedia.org/wiki/Windows_API) [P/Invoke](http://en.wikipedia.org/wiki/Platform_Invocation_Services)，那么您可以使用[ShowWindow](http://www.pinvoke.net/default.aspx/user32/ShowWindow.html)方法（第一个代码示例完全符合您的要求）。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2008-10-01T03:04:07.703

这样做似乎是一种 hack，但它似乎有效：

```
this.TopMost = true;  // as a result the form gets thrown to the front
this.TopMost = false; // but we don't actually want our form to always be on top 
```

编辑：注意，这只会引发一个已经创建的表单而不会窃取焦点。

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2008-10-01T04:44:40.037

Alex Lyman/TheSoftwareJedi 的答案中来自 pinvoke.net 的示例代码将使窗口成为“最顶层”窗口，这意味着在弹出窗口后您不能将其放在普通窗口后面。鉴于马蒂亚斯对他想用这个做什么的描述，这可能就是他想要的。但是，如果您希望用户能够在弹出窗口后将其放在其他窗口后面，只需在示例中使用 HWND_TOP (0) 而不是 HWND_TOPMOST (-1)。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2012-02-20T23:36:21.747

在 WPF 中，您可以像这样解决它：

在窗口中放置这些属性：

```
<Window
    x:Class="myApplication.winNotification"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  Title="Notification Popup" Width="300" SizeToContent="Height"
  WindowStyle="None" AllowsTransparency="True" Background="Transparent" ShowInTaskbar="False" Topmost="True" Focusable="False" ShowActivated="False" >
</Window> 
```

最后一个属性是您需要 ShowActivated="False" 的属性。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2011-11-15T22:25:29.050

我有类似的东西，我只是显示通知表然后做

```
this.Focus(); 
```

将焦点重新放在主窗体上。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-10-01T03:14:15.353

您可能需要考虑要显示什么样的通知。

如果让用户知道某个事件是绝对关键的，那么推荐使用 Messagebox.Show 的方式，因为它的性质是阻止任何其他事件进入主窗口，直到用户确认为止。不过，请注意弹出式盲区。

如果它不太重要，您可能希望使用另一种方式来显示通知，例如窗口底部的工具栏。您写道，您在屏幕的右下角显示通知 - 执行此操作的标准方法是使用带有[系统托盘](http://blogs.msdn.com/b/oldnewthing/archive/2003/09/10/54831.aspx)图标组合的[气球提示。](http://www.geekzilla.co.uk/viewBF3C2DB6-7924-4DD1-B4DE-D024AE31C6C2.htm)

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2008-10-01T03:24:46.967

在单独的线程中创建并启动通知表单，并在表单打开后将焦点重置回主表单。让通知表单提供从事件触发的 OnFormOpened`Form.Shown`事件。像这样的东西：

```
private void StartNotfication()
{
  Thread th = new Thread(new ThreadStart(delegate
  {
    NotificationForm frm = new NotificationForm();
    frm.OnFormOpen += NotificationOpened;
    frm.ShowDialog();
  }));
  th.Name = "NotificationForm";
  th.Start();
} 

private void NotificationOpened()
{
   this.Focus(); // Put focus back on the original calling Form
} 
```

您还可以保留 NotifcationForm 对象的句柄，以便它可以由主 Form ( `frm.Close()`) 以编程方式关闭。

缺少一些细节，但希望这会让你朝着正确的方向前进。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2009-05-19T19:52:46.717

这很好用。

请参阅：[OpenIcon - MSDN](https://docs.microsoft.com/en-us/windows/desktop/api/winuser/nf-winuser-openicon) 和[SetForegroundWindow - MSDN](https://docs.microsoft.com/en-us/windows/desktop/api/winuser/nf-winuser-setforegroundwindow)

```
using System.Runtime.InteropServices;

[DllImport("user32.dll")]
static extern bool OpenIcon(IntPtr hWnd);

[DllImport("user32.dll")]
static extern bool SetForegroundWindow(IntPtr hWnd);

public static void ActivateInstance()
{
    IntPtr hWnd = IntPtr hWnd = Process.GetCurrentProcess().MainWindowHandle;

    // Restore the program.
    bool result = OpenIcon(hWnd); 
    // Activate the application.
    result = SetForegroundWindow(hWnd);

    // End the current instance of the application.
    //System.Environment.Exit(0);    
} 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2013-03-07T12:36:06.667

您*也可以*仅通过逻辑来处理它，尽管我不得不承认，上面的建议是最优雅的建议，即您最终使用 BringToFront 方法而不实际窃取焦点。

无论如何，我遇到了这个问题并通过使用 DateTime 属性来解决它，如果最近已经进行了调用，则不允许进一步的 BringToFront 调用。

假设有一个核心类“Core”，它处理例如三个表单，“Form1、2 和 3”。每个窗体都需要一个 DateTime 属性和一个调用 Core 的 Activate 事件来将窗口置于最前面：

```
internal static DateTime LastBringToFrontTime { get; set; }

private void Form1_Activated(object sender, EventArgs e)
{
    var eventTime = DateTime.Now;
    if ((eventTime - LastBringToFrontTime).TotalMilliseconds > 500)
        Core.BringAllToFront(this);
    LastBringToFrontTime = eventTime;
} 
```

然后在Core Class中创建工作：

```
internal static void BringAllToFront(Form inForm)
{
    Form1.BringToFront();
    Form2.BringToFront();
    Form3.BringToFront();
    inForm.Focus();
} 
```

附带说明一下，如果要将最小化的窗口恢复到其原始状态（未最大化），请使用：

```
inForm.WindowState = FormWindowState.Normal; 
```

同样，我知道这只是缺少 BringToFrontWithoutFocus 的补丁解决方案。如果您想避免使用 DLL 文件，这只是一个建议。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2015-06-03T06:54:36.687

我不知道这是否被视为 necro-posting，但这是我所做的，因为我无法使用 user32 的“ShowWindow”和“SetWindowPos”方法。不，覆盖“ShowWithoutActivation”在这种情况下不起作用，因为新窗口应该始终位于顶部。无论如何，我创建了一个以表单为参数的辅助方法；调用时，它会显示表单，将其带到最前面并使其成为 TopMost，而不会窃取当前窗口的焦点（显然它确实如此，但用户不会注意到）。

```
 [DllImport("user32.dll")]
    static extern IntPtr GetForegroundWindow();

    [DllImport("user32.dll")]
    static extern IntPtr SetForegroundWindow(IntPtr hWnd);

    public static void ShowTopmostNoFocus(Form f)
    {
        IntPtr activeWin = GetForegroundWindow();

        f.Show();
        f.BringToFront();
        f.TopMost = true;

        if (activeWin.ToInt32() > 0)
        {
            SetForegroundWindow(activeWin);
        }
    } 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-09-24T14:27:02.797

我知道这听起来可能很愚蠢，但这有效：

```
this.TopMost = true;
this.TopMost = false;
this.TopMost = true;
this.SendToBack(); 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2016-03-10T23:38:08.860

我需要用我的窗口 TopMost 来做到这一点。我实现了上面的 PInvoke 方法，但发现我的 Load 事件没有像上面的 Talha 那样被调用。我终于成功了。也许这会对某人有所帮助。这是我的解决方案：

```
 form.Visible = false;
        form.TopMost = false;
        ShowWindow(form.Handle, ShowNoActivate);
        SetWindowPos(form.Handle, HWND_TOPMOST,
            form.Left, form.Top, form.Width, form.Height,
            NoActivate);
        form.Visible = true;    //So that Load event happens 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2021-10-26T16:06:42.823

你不需要让它变得如此复杂。

```
a = new Assign_Stock(); 
a.MdiParent = this.ParentForm;
a.Visible = false;   //hide for a bit.                 
a.Show(); //show the form. Invisible form now at the top.
this.Focus(); //focus on this form. make old form come to the top.
a.Visible = true; //make other form visible now. Behind the main form. 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2022-01-05T17:05:51.513

[![在此处输入图像描述](https://i.stack.imgur.com/1Qful.gif)](https://i.stack.imgur.com/1Qful.gif)

[Github 示例](https://github.com/lavahasif/steaaling_focuse.git)

[Form.ShowWithoutActivation 属性](https://docs.microsoft.com/en-us/dotnet/api/system.windows.forms.form.showwithoutactivation?view=windowsdesktop-6.0)

**将此添加到您的子表单类中**

```
 protected override bool ShowWithoutActivation
        {
            get { return true; }
        } 
```

**工作代码**

**表格2**

```
 public partial class Form2 : Form
    {
        Form3 c;
        public Form2()
        {
            InitializeComponent();
             c = new Form3();
        }

        private void textchanged(object sender, EventArgs e)
        {

            c.ResetText(textBox1.Text.ToString());
            c.Location = new Point(this.Location.X+150, this.Location.Y);
            c .Show();

//removethis
//if mdiparent 2 add this.focus() after show form

            c.MdiParent = this.MdiParent;
            c.ResetText(textBox1.Text.ToString());
            c.Location = new Point(this.Location.X+150, this.Location.Y);
            c .Show();
           this.Focus();
////-----------------

        }

    } 
```

**表格3**

```
 public partial class Form3 : Form
    {
        public Form3()
        {
            InitializeComponent();
            //ShowWithoutActivation = false;
        }
        protected override bool ShowWithoutActivation
        {
            get { return true; }
        }

        internal void ResetText(string toString)
        {
            label2.Text = toString;
        }

    } 
```

* * *

## 回答 #18

> 赞同：-4
> 
> 时间：2008-10-01T03:10:53.583

当您使用创建新表单时

```
Form f = new Form();
f.ShowDialog(); 
```

它窃取了焦点，因为在关闭此表单之前，您的代码无法继续在主表单上执行。

例外是使用线程创建一个新表单，然后使用 Form.Show()。确保线程是全局可见的，因为如果你在一个函数中声明它，一旦你的函数退出，你的线程将结束并且表单将消失。

* * *

## 回答 #19

> 赞同：-5
> 
> 时间：2012-12-09T18:06:58.840

想通了：`window.WindowState = WindowState.Minimized;`。

# .net - 使用 ASP.NET AJAX 填充列表后更新视图状态

> ID：156051
> 
> 赞同：1
> 
> 时间：2008-10-01T02:51:47.670
> 
> 标签：.net, asp.net, javascript, asp.net-ajax

我有一个使用 ASP>NET AJAX 通过网络服务填充的下拉列表。在 javascript 中方法的成功回调中，我通过循环填充下拉列表：

```
function populateDropDown(dropdownId, list, enable, showCount) {
    var dropdown = $get(dropdownId);
    dropdown.options.length = 1;    
    for (var i = 0; i < list.length; i++) {
        var opt = document.createElement("option");
        if (showCount) {
            opt.text = list[i].Name + ' (' + list[i].ChildCount + ')';
        } else {
            opt.text = list[i].Name;
        }
        opt.value = list[i].Name;
        dropdown.options.add(opt);
    }
    dropdown.disabled = !enable;    
} 
```

但是，当我提交该控件所在的表单时，该控件的列表在回发时始终为空。如何让填充的列表数据在回发中持续存在？

**编辑：**也许我正在倒退。一个更好的问题可能是，我如何从 web 服务中填充下拉列表，而不必使用更新面板，因为它必须运行整个页面生命周期？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-01T02:57:35.893

您需要为此使用 Request.Form - 您不能从客户端即时加密 ViewState - 它会破坏它的全部意义:)。

编辑：响应您的编辑 :) 页面生命周期是允许您首先使用 ViewState 持久性的东西。控制树是在那里处理的，而且，没有办法绕过它。

Request.Form 是一种非常可行的方法——它会告诉你选择的价值。如果你想知道所有的值，你可以对隐藏控件进行某种类型的序列化。

丑陋，是的，但这就是上帝（有人称他为 ScottGu）发明 ASP.NET MVC 的原因 :)。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-01T03:01:22.000

虽然我不确定它是如何做到的，但 AJAX 控件工具包中的 CascadingDropDown 确实支持这一点。

这是似乎做到这一点的行：

```
AjaxControlToolkit.CascadingDropDownBehavior.callBaseMethod(this, 'set_ClientState', [ this._selectedValue+':::'+text ]); 
```

但最简单的想法是将所选值放入回发事件的隐藏输入字段中。

# screen-scraping - 屏幕刮板如何工作？

> ID：156083
> 
> 赞同：20
> 
> 时间：2008-10-01T03:10:54.737
> 
> 标签：screen-scraping, web-scraping, html-content-extraction, pdf-scraping, console-scraping

我一直听到人们在编写这些程序，我知道他们在做什么，但他们实际上是如何做到的呢？我正在寻找一般概念。

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-10-01T03:14:21.313

从技术上讲，屏幕抓取是抓取另一个程序的显示数据并将其摄取以供自己使用的任何程序。

很多时候，屏幕截图是指解析目标网站的 HTML 页面以提取格式化数据的 Web 客户端。当网站不提供用于以编程方式访问数据的 RSS 提要或 REST API 时，就会执行此操作。

用于此目的的库的一个示例是[Hpricot](https://github.com/hpricot/hpricot) for Ruby，它是用于屏幕抓取的架构更好的 HTML 解析器之一。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-10-01T03:44:33.020

这里有很多准确的答案。

没有人*说不要做！*

当没有人为您提供合理的机器可读界面时，您会执行屏幕抓取。很难写，也很脆弱。

例如，考虑一个 RSS 聚合器，然后考虑通过正常的面向人的博客界面获取相同信息的代码。当博主决定更改其布局时，哪一个会中断？

当然，有时你别无选择:(

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-10-01T03:18:25.733

一般来说，屏幕抓取工具是一个程序，它通过使用浏览器或终端访问程序模仿坐在工作站前面的人的动作来捕获服务器程序的输出。在某些关键点，程序会解释输出，然后采取行动或从输出中提取一定数量的信息。

最初，这是通过大型机的字符/终端输出来完成的，用于提取数据或更新最终用户无法直接访问的过时或无法直接访问的系统。用现代术语来说，它通常意味着解析 HTTP 请求的输出以提取数据或采取其他操作。随着网络服务的出现，这种事情应该已经消失了，但并不是所有的应用程序都提供了一个很好的 api 来与之交互。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-01T03:13:55.760

屏幕抓取器下载 html 页面，并通过搜索已知标记或将其解析为 XML 或类似的方式提取感兴趣的数据。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-01T03:16:25.270

您有一个 HTML 页面，其中包含一些您想要的数据。您所做的是编写一个程序来获取该网页并尝试提取该数据。这可以通过 XML 解析器完成，但对于简单的应用程序，我更喜欢使用正则表达式来匹配 HTML 中的特定位置并提取必要的数据。但是，有时创建一个好的正则表达式可能会很棘手，因为周围的 HTML 在文档中出现了多次。您总是希望将一个独特的项目尽可能地与您需要的数据相匹配。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-01T03:21:07.660

在 PC 的早期，屏幕抓取工具会模拟终端（例如 IBM 3270）并假装是用户，以便交互式地提取、更新大型机上的信息。最近，该概念适用于通过网页提供界面的任何应用程序。

随着 SOA 的出现，屏幕抓取是一种方便的方式，通过它可以让服务支持不支持的应用程序。在这些情况下，网页抓取是更常用的方法。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-10-01T05:11:18.817

**这是在Javascript**中使用 jQuery实现的一小部分屏幕抓取（请注意，这不是常见的选择，因为抓取通常是客户端-服务器活动）：

```
//Show My SO Reputation Score
var repval = $('span.reputation-score:first'); alert('StackOverflow User "' + repval.prev().attr('href').split('/').pop() + '" has (' + repval.html() + ') Reputation Points.'); 
```

如果您运行***Firebug***，请复制上面的代码并将[其粘贴到控制台](https://stackoverflow.com/questions/140680/firebug-how-can-i-run-multiline-scripts-or-create-a-new-javascript-file)中，并在此问题页面上查看它的实际效果。

如果 SO 更改了 DOM 结构/元素类名称/URI 路径约定，那么所有的赌注都将被取消，它可能不再起作用 - 这是屏幕抓取工作中的常见风险，各方之间没有合同/理解（抓取工具和抓取工具） [*是的，我刚刚发明了一个词*]）。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-10-01T10:22:18.007

从技术上讲，屏幕抓取是抓取另一个程序的显示数据并将其摄取以供自己使用的任何程序。在 PC 的早期，屏幕抓取器将模拟终端（例如 IBM 3270）并假装是用户以交互提取、更新主机信息。最近，该概念适用于通过网页提供界面的任何应用程序。

随着 SOA 的出现，屏幕抓取是一种方便的方式，通过它可以让服务支持不支持的应用程序。在这些情况下，网页抓取是更常用的方法。

很多时候，屏幕截图是指解析目标网站的 HTML 页面以提取格式化数据的 Web 客户端。当网站不提供用于以编程方式访问数据的 RSS 提要或 REST API 时，就会执行此操作。

通常，您有一个 HTML 页面，其中包含一些您想要的数据。您所做的是编写一个程序来获取该网页并尝试提取该数据。这可以通过 XML 解析器完成，但对于简单的应用程序，我更喜欢使用正则表达式来匹配 HTML 中的特定位置并提取必要的数据。但是，有时创建一个好的正则表达式可能会很棘手，因为周围的 HTML 在文档中出现了多次。您总是希望将一个独特的项目尽可能地与您需要的数据相匹配。

当没有人为您提供合理的机器可读界面时，您会执行屏幕抓取。很难写，也很脆弱。

例如，考虑一个 RSS 聚合器，然后考虑通过正常的面向人的博客界面获取相同信息的代码。当博主决定更改其布局时，哪一个会中断。

用于此目的的库的一个示例是 Hpricot for Ruby，它是用于屏幕抓取的架构更好的 HTML 解析器之一。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-07-23T08:36:29.250

> 当没有人为您提供合理的机器可读界面时，您会执行屏幕抓取。很难写，也很脆弱。

不完全正确。当我说大多数开发人员没有足够的经验来编写像样的 API 时，我认为我并没有夸大其词。我曾与屏幕抓取公司合作过，API 经常出现问题（从隐秘的错误到糟糕的结果），并且通常没有提供网站提供的全部功能，因此屏幕抓取可能会更好（如果你将要）。与 API 客户端相比，我使用外联网/网站门户的客户/经纪人更多，因此得到了更好的支持。在大公司中，很少更改外联网门户等。通常是因为它最初是外包的，现在只是维护。我更多地指的是屏幕抓取，其中输出是定制的，例如特定路线和时间的航班、保险报价、运输报价等。

就做而言，它可以像 web 客户端一样简单，将页面内容拉成一个字符串，并使用一系列正则表达式来提取你想要的信息。

```
string pageContents = new WebClient("www.stackoverflow.com").DownloadString();
int numberOfPosts = // regex match 
```

显然，在大规模环境中，您将编写比上述更健壮的代码。

> 屏幕抓取器下载 html 页面，并通过搜索已知标记或将其解析为 XML 或类似的方式提取感兴趣的数据。

这比正则表达式更简洁……理论上……，但实际上它并不那么容易，因为大多数文档都需要规范化为 XHTML，然后才能通过 XPath，最后我们发现经过微调的正则表达式是更实用。

# vba - 将 ADO 记录集文本字段排序为数字

> ID：156084
> 
> 赞同：3
> 
> 时间：2008-10-01T03:11:41.460
> 
> 标签：vba, ado, adodb

使用 VBA，我有一组函数返回`ADODB.Recordset`所有列作为`adVarChar`. 不幸的是，这意味着数字被排序为文本。所以 1,7,16,22 变成 1,16,22,7

是否有任何方法可以将数字作为文本列进行排序，而无需更改列的类型？

```
Sub TestSortVarChar()

  Dim strBefore, strAfter As String

  Dim r As ADODB.RecordSet

  Set r = New ADODB.RecordSet
  r.Fields.Append "ID", adVarChar, 100
  r.Fields.Append "Field1", adVarChar, 100
  r.Open

  r.AddNew
  r.Fields("ID") = "1"
  r.Fields("Field1") = "A"

  r.AddNew
  r.Fields("ID") = "7"
  r.Fields("Field1") = "B"

  r.AddNew
  r.Fields("ID") = "16"
  r.Fields("Field1") = "C"

  r.AddNew
  r.Fields("ID") = "22"
  r.Fields("Field1") = "D"

  r.MoveFirst
  Do Until r.EOF
    strBefore = strBefore & r.Fields("ID") & " " & r.Fields("Field1") & vbCrLf
    r.MoveNext
  Loop

  r.Sort = "[ID] ASC"

  r.MoveFirst
  Do Until r.EOF
    strAfter = strAfter & r.Fields("ID") & " " & r.Fields("Field1") & vbCrLf
    r.MoveNext
  Loop

  MsgBox strBefore & vbCrLf & vbCrLf & strAfter

End Sub 
```

注意：我正在使用 Project 2003 和 Excel 2003 并引用**Microsoft ActiveX DataObject 2.8 库**

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-01T03:19:27.040

左填充零，至少与最大位数一样多。例如

0001 0010 0022 1000

您可以使用 Right$() 来完成此操作。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-01T14:03:39.833

使用 Val() 函数对文本列进行数字排序。例子：

```
SELECT ID, Field1
FROM tablename
ORDER BY Val(Field1); 
```

# silverlight-2.0 - Silverlight 2.0 DataGrid 如何移除鼠标悬停效果

> ID：156089
> 
> 赞同：3
> 
> 时间：2008-10-01T03:14:24.603
> 
> 标签：silverlight-2.0

我只是从 SL 和 WPF 开始。我正在使用 DataGrid 控件，我需要删除鼠标悬停效果（实际上我需要做更多的自定义）。我该怎么做呢。我想我需要用一个控制模板来做，但不知道怎么做。我现在正在研究和阅读。任何帮助，将不胜感激。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-11-05T15:54:31.807

简短的回答是使用样式。长答案如下：

Silverlight 2.0 数据网格中有两个样式属性可以解决您的问题。第一个是 CellStyle，第二个是 RowStyle。CellStyle 属性将删除当前选定单元格周围的浅蓝色突出显示。RowStyle 属性是您可以移除指示所选行的浅蓝色阴影的属性。我使用的 CellStyle 如下：

```
 <Style x:Key="CellStyle" TargetType="local:DataGridCell">
        <Setter Property="Background" Value="Transparent" />
        <Setter Property="HorizontalContentAlignment" Value="Stretch" />
        <Setter Property="VerticalContentAlignment" Value="Stretch" />
        <Setter Property="Cursor" Value="Arrow" />
        <Setter Property="IsTabStop" Value="False" />
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="local:DataGridCell">
                    <Grid Name="Root" Background="Transparent">
                        <vsm:VisualStateManager.VisualStateGroups>
                            <vsm:VisualStateGroup x:Name="CurrentStates" >
                                <vsm:VisualStateGroup.Transitions>
                                    <vsm:VisualTransition GeneratedDuration="0" />
                                </vsm:VisualStateGroup.Transitions>

                                <vsm:VisualState x:Name="Regular" />
                                <vsm:VisualState x:Name="Current" />
                                    <!--<Storyboard>
                                        <DoubleAnimation Storyboard.TargetName="FocusVisual" Storyboard.TargetProperty="Opacity" To="1" Duration="0" />
                                    </Storyboard>
                                </vsm:VisualState>-->
                            </vsm:VisualStateGroup>
                        </vsm:VisualStateManager.VisualStateGroups>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        <Rectangle Name="FocusVisual" Stroke="#FF6DBDD1" StrokeThickness="1" Fill="#66FFFFFF" HorizontalAlignment="Stretch" VerticalAlignment="Stretch" IsHitTestVisible="false" Opacity="0" />
                        <ContentPresenter Content="{TemplateBinding Content}" ContentTemplate="{TemplateBinding ContentTemplate}" Cursor="{TemplateBinding Cursor}" HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}" VerticalAlignment="{TemplateBinding VerticalContentAlignment}" Margin="{TemplateBinding Padding}" />
                        <Rectangle Name="RightGridLine" Grid.Column="1" VerticalAlignment="Stretch" Width="1" />
                    </Grid>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style> 
```

如果你注意到，我注释掉了改变 FocusVisual 矩形不透明度值的情节提要。这样做是将 FocusVisual 矩形设置为在单元格选择中显示。（请注意：您不能删除 FocusVisual 元素，因为 CellPresenter 需要此元素，找不到该元素会导致错误。）

我使用的 RowStyle 如下：

```
 <Style TargetType="local:DataGridRow" x:Key="MyCustomRow">
        <Setter Property="IsTabStop" Value="False" />
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="local:DataGridRow">
                    <localprimitives:DataGridFrozenGrid x:Name="Root">
                        <localprimitives:DataGridFrozenGrid.Resources>
                            <Storyboard x:Key="DetailsVisibleTransition" >
                                <DoubleAnimation Storyboard.TargetName="DetailsPresenter" Storyboard.TargetProperty="ContentHeight" Duration="00:00:0.1" />
                            </Storyboard>
                        </localprimitives:DataGridFrozenGrid.Resources>
                        <vsm:VisualStateManager.VisualStateGroups>
                            <vsm:VisualStateGroup x:Name="CommonStates" >
                                <vsm:VisualState x:Name="Normal" />
                                <vsm:VisualState x:Name="Normal AlternatingRow">
                                    <Storyboard>
                                        <DoubleAnimation Storyboard.TargetName="BackgroundRectangle" Storyboard.TargetProperty="Opacity" Duration="0" To="0" />
                                    </Storyboard>
                                </vsm:VisualState>
                                <vsm:VisualState x:Name="MouseOver" />
                                <!--<Storyboard>
                                        <DoubleAnimation Storyboard.TargetName="BackgroundRectangle" Storyboard.TargetProperty="Opacity" Duration="0" To=".5" />
                                    </Storyboard>
                                </vsm:VisualState>-->
                                <vsm:VisualState x:Name="Normal Selected"/>
                                <!--<Storyboard>
                                        <DoubleAnimation Storyboard.TargetName="BackgroundRectangle" Storyboard.TargetProperty="Opacity" Duration="0" To="1" />
                                    </Storyboard>
                                </vsm:VisualState>-->
                                <vsm:VisualState x:Name="MouseOver Selected"/>
                                <!--<Storyboard>
                                        <DoubleAnimation Storyboard.TargetName="BackgroundRectangle" Storyboard.TargetProperty="Opacity" Duration="0" To="1" />
                                    </Storyboard>
                                </vsm:VisualState>-->
                                <vsm:VisualState x:Name="Unfocused Selected"/>
                                <!--<Storyboard>
                                        <DoubleAnimation Storyboard.TargetName="BackgroundRectangle" Storyboard.TargetProperty="Opacity" Duration="0" To="1" />
                                        <ColorAnimationUsingKeyFrames BeginTime="0" Duration="0" Storyboard.TargetName="BackgroundRectangle" Storyboard.TargetProperty="(Shape.Fill).(SolidColorBrush.Color)">
                                            <SplineColorKeyFrame KeyTime="0" Value="#FFE1E7EC" />
                                        </ColorAnimationUsingKeyFrames>
                                    </Storyboard>
                                </vsm:VisualState>-->
                            </vsm:VisualStateGroup>
                        </vsm:VisualStateManager.VisualStateGroups>
                        <localprimitives:DataGridFrozenGrid.RowDefinitions>
                            <RowDefinition Height="*" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                        </localprimitives:DataGridFrozenGrid.RowDefinitions>
                        <localprimitives:DataGridFrozenGrid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="*" />
                        </localprimitives:DataGridFrozenGrid.ColumnDefinitions>
                        <Rectangle x:Name="BackgroundRectangle" Grid.RowSpan="2" Grid.ColumnSpan="2" Opacity="0" Fill="#FFBADDE9"  />
                        <localprimitives:DataGridRowHeader Grid.RowSpan="3" x:Name="RowHeader" localprimitives:DataGridFrozenGrid.IsFrozen="True" />

                        <localprimitives:DataGridCellsPresenter x:Name="CellsPresenter" localprimitives:DataGridFrozenGrid.IsFrozen="True"/>

                        <localprimitives:DataGridDetailsPresenter Grid.Row="1" Grid.Column="1" x:Name="DetailsPresenter" />
                        <Rectangle Grid.Row="2" Grid.Column="1" x:Name="BottomGridLine" HorizontalAlignment="Stretch" Height="1" />
                    </localprimitives:DataGridFrozenGrid>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style> 
```

如您所见，我注释掉了更多的视觉状态。您需要注释掉 MouseOver VisualState 故事板、Normal Selected 故事板、MouseOver Selected 故事板和 Unfocused Selected 故事板。

（请注意：我并没有删除这些视觉状态，我只是注释掉了它们曾经做过的事情。）

这是我的完整代码供参考：（首先是 XAML，然后是 VB）

XAML：

```
<UserControl x:Class="DataGrid_Mouseover.Page"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation" 
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" 
    xmlns:data="clr-namespace:System.Windows.Controls;assembly=System.Windows.Controls.Data"  
    xmlns:local="clr-namespace:System.Windows.Controls;assembly=System.Windows.Controls.Data"
    xmlns:controls="clr-namespace:System.Windows.Controls;assembly=System.Windows.Controls.Data"
    xmlns:primitives="clr-namespace:System.Windows.Controls.Primitives;assembly=System.Windows"
    xmlns:localprimitives="clr-namespace:System.Windows.Controls.Primitives;assembly=System.Windows.Controls.Data"
    xmlns:vsm="clr-namespace:System.Windows;assembly=System.Windows">
<UserControl.Resources>

    <Style x:Key="CellStyle" TargetType="local:DataGridCell">

        <!-- TODO: Remove this workaround to force MouseLeftButtonDown event to be raised when root element is clicked. -->
        <Setter Property="Background" Value="Transparent" />
        <Setter Property="HorizontalContentAlignment" Value="Stretch" />
        <Setter Property="VerticalContentAlignment" Value="Stretch" />
        <Setter Property="Cursor" Value="Arrow" />
        <Setter Property="IsTabStop" Value="False" />
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="local:DataGridCell">
                    <Grid Name="Root" Background="Transparent">
                        <vsm:VisualStateManager.VisualStateGroups>
                            <vsm:VisualStateGroup x:Name="CurrentStates" >
                                <vsm:VisualStateGroup.Transitions>
                                    <vsm:VisualTransition GeneratedDuration="0" />
                                </vsm:VisualStateGroup.Transitions>

                                <vsm:VisualState x:Name="Regular" />
                                <vsm:VisualState x:Name="Current" />
                                    <!--<Storyboard>
                                        <DoubleAnimation Storyboard.TargetName="FocusVisual" Storyboard.TargetProperty="Opacity" To="1" Duration="0" />
                                    </Storyboard>
                                </vsm:VisualState>-->
                            </vsm:VisualStateGroup>
                        </vsm:VisualStateManager.VisualStateGroups>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        <!-- TODO Refactor this if SL ever gets a FocusVisualStyle on FrameworkElement -->
                        <Rectangle Name="FocusVisual" Stroke="#FF6DBDD1" StrokeThickness="1" Fill="#66FFFFFF" HorizontalAlignment="Stretch" VerticalAlignment="Stretch" IsHitTestVisible="false" Opacity="0" />
                        <ContentPresenter Content="{TemplateBinding Content}" ContentTemplate="{TemplateBinding ContentTemplate}" Cursor="{TemplateBinding Cursor}" HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}" VerticalAlignment="{TemplateBinding VerticalContentAlignment}" Margin="{TemplateBinding Padding}" />
                        <Rectangle Name="RightGridLine" Grid.Column="1" VerticalAlignment="Stretch" Width="1" />
                    </Grid>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <Style TargetType="local:DataGridRow" x:Key="MyCustomRow">
        <Setter Property="IsTabStop" Value="False" />
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="local:DataGridRow">
                    <localprimitives:DataGridFrozenGrid x:Name="Root">
                        <localprimitives:DataGridFrozenGrid.Resources>
                            <Storyboard x:Key="DetailsVisibleTransition" >
                                <DoubleAnimation Storyboard.TargetName="DetailsPresenter" Storyboard.TargetProperty="ContentHeight" Duration="00:00:0.1" />
                            </Storyboard>
                        </localprimitives:DataGridFrozenGrid.Resources>
                        <vsm:VisualStateManager.VisualStateGroups>
                            <vsm:VisualStateGroup x:Name="CommonStates" >
                                <vsm:VisualState x:Name="Normal" />
                                <vsm:VisualState x:Name="Normal AlternatingRow">
                                    <Storyboard>
                                        <DoubleAnimation Storyboard.TargetName="BackgroundRectangle" Storyboard.TargetProperty="Opacity" Duration="0" To="0" />
                                    </Storyboard>
                                </vsm:VisualState>
                                <vsm:VisualState x:Name="MouseOver" />
                                <!--<Storyboard>
                                        <DoubleAnimation Storyboard.TargetName="BackgroundRectangle" Storyboard.TargetProperty="Opacity" Duration="0" To=".5" />
                                    </Storyboard>
                                </vsm:VisualState>-->
                                <vsm:VisualState x:Name="Normal Selected"/>
                                <!--<Storyboard>
                                        <DoubleAnimation Storyboard.TargetName="BackgroundRectangle" Storyboard.TargetProperty="Opacity" Duration="0" To="1" />
                                    </Storyboard>
                                </vsm:VisualState>-->
                                <vsm:VisualState x:Name="MouseOver Selected"/>
                                <!--<Storyboard>
                                        <DoubleAnimation Storyboard.TargetName="BackgroundRectangle" Storyboard.TargetProperty="Opacity" Duration="0" To="1" />
                                    </Storyboard>
                                </vsm:VisualState>-->
                                <vsm:VisualState x:Name="Unfocused Selected"/>
                                <!--<Storyboard>
                                        <DoubleAnimation Storyboard.TargetName="BackgroundRectangle" Storyboard.TargetProperty="Opacity" Duration="0" To="1" />
                                        <ColorAnimationUsingKeyFrames BeginTime="0" Duration="0" Storyboard.TargetName="BackgroundRectangle" Storyboard.TargetProperty="(Shape.Fill).(SolidColorBrush.Color)">
                                            <SplineColorKeyFrame KeyTime="0" Value="#FFE1E7EC" />
                                        </ColorAnimationUsingKeyFrames>
                                    </Storyboard>
                                </vsm:VisualState>-->
                            </vsm:VisualStateGroup>
                        </vsm:VisualStateManager.VisualStateGroups>
                        <localprimitives:DataGridFrozenGrid.RowDefinitions>
                            <RowDefinition Height="*" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                        </localprimitives:DataGridFrozenGrid.RowDefinitions>
                        <localprimitives:DataGridFrozenGrid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="*" />
                        </localprimitives:DataGridFrozenGrid.ColumnDefinitions>
                        <Rectangle x:Name="BackgroundRectangle" Grid.RowSpan="2" Grid.ColumnSpan="2" Opacity="0" Fill="#FFBADDE9"  />
                        <localprimitives:DataGridRowHeader Grid.RowSpan="3" x:Name="RowHeader" localprimitives:DataGridFrozenGrid.IsFrozen="True" />

                        <localprimitives:DataGridCellsPresenter x:Name="CellsPresenter" localprimitives:DataGridFrozenGrid.IsFrozen="True"/>

                        <localprimitives:DataGridDetailsPresenter Grid.Row="1" Grid.Column="1" x:Name="DetailsPresenter" />
                        <Rectangle Grid.Row="2" Grid.Column="1" x:Name="BottomGridLine" HorizontalAlignment="Stretch" Height="1" />
                    </localprimitives:DataGridFrozenGrid>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>
</UserControl.Resources>

<Grid x:Name="LayoutRoot" Background="White">
    <local:DataGrid x:Name="TestGrid"
           HorizontalAlignment="Left" 
           VerticalAlignment="Bottom" 
           AutoGenerateColumns="False"
           HeadersVisibility="None"
           RowHeight="55"
           Background="Transparent"
           AlternatingRowBackground="Transparent"
           RowBackground="Transparent"
           BorderBrush="Transparent"
           Foreground="Transparent" 
           GridLinesVisibility="None" 
           SelectionMode="Single"
           CellStyle="{StaticResource CellStyle}" 
           RowStyle="{StaticResource MyCustomRow}">

        <local:DataGrid.Columns>
            <local:DataGridTemplateColumn Header="Clinic">
                <local:DataGridTemplateColumn.CellTemplate>
                    <DataTemplate>
                        <Button x:Name="btnClinic" 
                        Height="46" 
                        Width="580" 
                        Content="{Binding Path=Description}" 
                        Click="btnClinic_Click"
                        FontSize="24"
                        FontFamily="Tahoma"
                        FontWeight="Bold">
                            <Button.Background>
                                <LinearGradientBrush EndPoint="0.528,1.144" StartPoint="1.066,1.221">
                                    <GradientStop Color="#FF000000"/>
                                    <GradientStop Color="#FFEDC88F" Offset="1"/>
                                </LinearGradientBrush>
                            </Button.Background>
                        </Button>
                    </DataTemplate>
                </local:DataGridTemplateColumn.CellTemplate>
            </local:DataGridTemplateColumn>
        </local:DataGrid.Columns>
    </local:DataGrid>
</Grid>
</UserControl> 
```

VB：

```
Partial Public Class Page
Inherits UserControl

Public Sub New()
    InitializeComponent()
    Dim test As IList(Of String) = New List(Of String)
    test.Add("test1")
    test.Add("test1")
    test.Add("test1")
    test.Add("test1")
    test.Add("test1")
    test.Add("test1")
    test.Add("test1")
    test.Add("test1")
    test.Add("test1")
    test.Add("test1")

    TestGrid.ItemsSource = test

End Sub

Private Sub btnClinic_Click(ByVal sender As System.Object, ByVal e As System.Windows.RoutedEventArgs)

End Sub
End Class 
```

希望这可以帮助。

谢谢，斯科特

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-08T17:39:07.097

是的，您必须更改 Style 和 ControlTemplate ，但是您是否使用 experssion blend 来编辑 XAML？Blend 是最简单的工具。

尝试将 ControlTemplate 更改为标准按钮或列表框，一旦您感到舒适，然后转到 DatGrid。为什么我建议这是 DataGrid 是不同 UIElements 的复杂组合，因此控件模板对于初学者来说将难以理解。

特定于 MouseOver 效果删除 - 控件模板中将有一个**VSM**标签，其中包含一些情节提要，只需删除带有的那个 `<vsm:VisualState x:Name="MouseOver">`就可以了。

# c# - LinqToSql 和抽象基类

> ID：156113
> 
> 赞同：6
> 
> 时间：2008-10-01T03:23:07.877
> 
> 标签：c#, linq-to-sql

我有一些 linq 实体继承了这样的东西：

```
public abstract class EntityBase { public int Identifier { get; } }

public interface IDeviceEntity { int DeviceId { get; set; } }

public abstract class DeviceEntityBase : EntityBase, IDeviceEntity
{
  public abstract int DeviceId { get; set; }
}

public partial class ActualLinqGeneratedEntity : DeviceEntityBase
{
} 
```

在通用方法中，我使用以下方法查询 DeviceEnityBase 派生实体：

```
return unitOfWork.GetRepository<TEntity>().FindOne(x => x.DeviceId == evt.DeviceId); 
```

其中 TEntity 有一个约束，即它是一个 DeviceEntityBase。此查询总是失败并出现 InvalidOperationException 并显示消息“类成员 DeviceEntityBase.DeviceId 未映射”。即使我在抽象基类中添加了一些映射信息

```
[Column(Storage = "_DeviceId", DbType = "Int", Name = "DeviceId", IsDbGenerated = false, UpdateCheck = UpdateCheck.Never)] 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2011-02-21T20:37:25.083

哇，看起来有一次我可以单挑@MarcGravell！

我有同样的问题，然后我发现了[这个答案](https://stackoverflow.com/questions/1021274/linq-to-sql-mapping-exception-when-using-abstract-base-classes/1068499#1068499)，它为我解决了这个问题！

在你的情况下，你会说：

```
return unitOfWork.GetRepository<TEntity>().Select(x => x).FindOne(x => x.DeviceId == evt.DeviceId); 
```

鲍勃是你的叔叔！

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-01T05:43:47.553

LINQ-to-SQL对通过鉴别器（ [here](http://www.davidhayden.com/blog/dave/archive/2007/10/28/LINQToSQLEnumSupportExampleDiscriminatorColumnInheritanceMapping.aspx)，[here ）的继承有](http://weblogs.asp.net/zeeshanhirani/archive/2008/06/25/inheritance-in-linq-to-sql.aspx)*一些*支持，但是您只能查询在 LINQ 模型中定义的类 - 即数据类本身，以及（对于本示例来说更重要的是）查询本身必须用数据类来表述：虽然 TEntity 是一个数据类，但它知道这里的属性是在实体基础上声明的。

一种选择可能是动态表达式；它是类本身声明的属性（即丢失基类，但保留接口） - 但这并非微不足道。

表达式工作将如下所示，注意您可能希望将字符串作为参数传递，或者通过反射获取主键（如果它是属性的）：

```
static Expression<Func<T, bool>> BuildWhere<T>(int deviceId) {
    var id = Expression.Constant(deviceId, typeof(int));
    var arg = Expression.Parameter(typeof(T), "x");
    var prop = Expression.Property(arg, "DeviceId");
    return Expression.Lambda<Func<T, bool>>(
        Expression.Equal(prop, id), arg);
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-01T03:26:57.350

LinqToSql 无法实现这种层次结构映射。映射已设置，它无法映射到基类中的属性。当它第一次出现时，我花了几个月的时间。最好的解决方案是使用实体框架。它为您创建对象模型提供了更大的灵活性。它将允许您完全按照您在此处尝试执行的操作。

以下是有关实体框架的一些信息：[MSDN 文章](http://msdn.microsoft.com/en-us/library/aa697427(VS.80).aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2017-01-26T10:00:12.733

尝试`.OfType<>()`这里发布的[https://stackoverflow.com/a/17734469/3936440](https://stackoverflow.com/a/17734469/3936440)，它适用于我有完全相同的问题。

# php - 在应用 LIMIT 之前获取结果计数的最佳方法

> ID：156114
> 
> 赞同：75
> 
> 时间：2008-10-01T03:23:33.663
> 
> 标签：php, sql, postgresql, window-functions, sql-limit

在对来自 DB 的数据进行分页时，您需要知道将有多少页面来呈现页面跳转控件。

目前，我通过运行两次查询来做到这一点，一次包裹在 a`count()`中以确定总结果，第二次使用限制来获取当前页面所需的结果。

这似乎效率低下。有没有更好的方法来确定在应用之前会返回多少结果`LIMIT`？

我正在使用 PHP 和 Postgres。

* * *

## 回答 #1

> 赞同：147
> 
> 时间：2011-11-23T13:12:41.943

### 纯 SQL

自 2008 年以来情况发生了变化。您可以使用[窗口函数](https://www.postgresql.org/docs/current/functions-window.html)在一个查询中获取完整计数*和*有限结果。[2009 年与 PostgreSQL 8.4 一起](https://www.postgresql.org/docs/8.4/release-8-4.html)引入。

```
SELECT foo
     , **count(*) OVER() AS full_count**
FROM   bar
WHERE  <some condition>
ORDER  BY <some col>
LIMIT  <pagesize>
OFFSET <offset>;
```

请注意，这**可能比没有总计数要昂贵得多**。必须计算所有行，并且从匹配索引中仅获取顶行的可能捷径可能不再有用。与小桌子或<= +
无关紧要。事变大了很多。`full_count``OFFSET``LIMIT``full_count`

***极端情况***：当`OFFSET`至少与基本查询的行数一样多时，***不返回任何行***。所以你也得到 no`full_count`。可能的替代方案：

*   [使用 LIMIT/OFFSET 运行查询并获取总行数](https://stackoverflow.com/questions/28888375/run-a-query-with-a-limit-offset-and-also-get-the-total-number-of-rows/28888696#28888696)

## `SELECT`查询中的事件序列

（0\. CTE 是单独评估和实现的。在 Postgres 12 或更高版本中，规划器可能会在开始工作之前内联那些类似子查询的内容。）不在这里。

1.  `WHERE`子句（和`JOIN`条件，尽管在您的示例中没有）从基表中过滤符合条件的行。**其余的基于过滤的子集。**

（ 2.`GROUP BY`和聚合函数会放在这里。）不在这里。

（ 3\. 其他`SELECT`列表表达式根据分组/聚合列进行评估。）不在这里。

4.  窗口函数的应用取决于`OVER`子句和函数的框架规范。简单`count(*) OVER()`是基于所有符合条件的行。

5.  `ORDER BY`

( 6\. `DISTINCT`or `DISTINCT ON`would go here.) 不在这里。

7.  `LIMIT`/`OFFSET`根据已建立的顺序应用以选择要返回的行。

`LIMIT`/`OFFSET`随着表中行数的增加而变得越来越低效。如果您需要更好的性能，请考虑替代方法：

*   [在大表上使用 OFFSET 优化查询](https://stackoverflow.com/questions/34110504/optimize-query-with-offset-on-large-table/34291099#34291099)

### 获得最终计数的替代方案

有完全不同的方法来获取受影响行的计数（***不是***`OFFSET`应用&之前的完整计数`LIMIT`）。Postgres 有内部记账多少行受最后一个 SQL 命令影响。一些客户端可以访问该信息或自己计算行数（如 psql）。

例如，您可以在执行 SQL 命令后立即检索**plpgsql中受影响的行数：**

```
GET DIAGNOSTICS integer_var = ROW_COUNT; 
```

[手册中的详细信息。](https://www.postgresql.org/docs/current/plpgsql-statements.html#PLPGSQL-STATEMENTS-DIAGNOSTICS)

或者你可以[`pg_num_rows`在**PHP**](https://secure.php.net/manual/en/function.pg-num-rows.php)中使用。或其他客户端中的类似功能。

有关的：

*   [计算PostgreSQL中批处理查询影响的行数](https://stackoverflow.com/questions/10175073/calculate-number-of-rows-affected-by-batch-query-in-postgresql/10175149)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-01T04:43:48.727

正如我[在博客中所描述的](http://hype-free.blogspot.com/2008/05/advanced-mysql-features.html)，MySQL 有一个名为[SQL_CALC_FOUND_ROWS](http://dev.mysql.com/doc/refman/5.0/en/information-functions.html#function_found-rows)的特性。这消除了执行两次查询的需要，但它仍然需要完整地执行查询，即使限制子句允许它提前停止。

据我所知，PostgreSQL 没有类似的功能。进行分页时要注意的一件事（恕我直言，最常见的是使用 LIMIT）：执行“OFFSET 1000 LIMIT 10”意味着数据库必须获取*至少*1010 行，即使它只给你 10 行。一种更高效的方法是记住您为前一行（在本例中为第 1000 行）排序的行的值，并像这样重写查询：“... WHERE order_row > value_of_1000_th LIMIT 10”。优点是“order_row”最有可能被索引（如果没有，你就有问题了）。缺点是如果在页面视图之间添加新元素，这可能会有点不同步（但话又说回来，访问者可能无法观察到它，并且可能会大大提高性能）。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-01T05:08:59.883

您可以通过不每次都运行 COUNT() 查询来减轻性能损失。在再次运行查询之前缓存页面数，例如 5 分钟。除非您看到大量的 INSERT，否则应该可以正常工作。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-09-25T20:17:07.840

由于 Postgres 已经做了一定数量的缓存，这种方法并不像看起来那么低效。绝对不会将执行时间加倍。我们在数据库层中内置了计时器，所以我已经看到了证据。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-10-01T04:20:53.743

鉴于您需要了解分页的目的，我建议您运行一次完整的查询，将数据作为服务器端缓存写入磁盘，然后通过您的分页机制提供数据。

如果您运行 COUNT 查询是为了决定是否向用户提供数据（即如果有 > X 条记录，则返回错误），您需要坚持使用 COUNT 方法。

# css - Firefox 的 CSS 过滤器替代品是什么？

> ID：156116
> 
> 赞同：10
> 
> 时间：2008-10-01T03:23:56.437
> 
> 标签：css, internet-explorer, firefox, cross-browser, filter

我正在使用 CSS 过滤器在浏览器中动态修改图像。这些在 Internet Explorer 中完美运行，但在 Firefox 中不受支持。

有谁知道 Firefox 对应的 CSS 过滤器是什么？一个可以跨浏览器（Safari、WebKit、Firefox 等）工作的答案将是首选。

```
<style type="text/css">
    .CSSClassName {filter:Invert;}
    .CSSClassName {filter:Xray;}
    .CSSClassName {filter:Gray;}
    .CSSClassName {filter:FlipV;}
</style> 
```

更新：我知道过滤器是 IE 特有的功能。Firefox 支持的这些是否有任何等价物？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-01T06:41:26.540

请检查[Nihilogic Javascript 图像效果库](http://www.nihilogic.dk/labs/imagefx/)：

*   很好地支持 IE 和 Fx
*   有很多作用

[您可以在CVI 项目](http://www.netzgesta.de/cvi/)中找到许多其他效果：

*   它们也是基于 JS 的
*   有一个[实验室可以做实验](http://www.netzgesta.de/lab/)

祝你好运

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-01T06:32:32.960

你能给我们一个具体的例子来说明你到底想要做什么吗？你可能会得到更少的*“你的浏览器”*回复和更多的*“尝试这种不同的方法怎么样？”* 那些。

通常 CSS 用于控制 HTML 内容的外观和感觉，而不是添加效果或以巧妙的方式编辑图像。您尝试做的事情可能使用 javascript，但面向行为的脚本可能仍然不太适合您想要做的那种调整（尽管这样[的](http://www.kurs.horsesport.pl/inne/rv2.html)事情在 CSS 中是一个有趣且非常低效的冒险/JS 愚蠢）。

我无法想象您**需要**客户端实时执行图像调整的场景。您可以在服务器端修改图像，并使用您的 CSS 或可能的 Javascript 简单地引用这些修改后的版本，具体取决于您正在做什么。[ImageMagick](http://www.imagemagick.org/)是一个很棒的小命令行工具，可用于您需要的所有图像效果，并且非常易于单独使用或在您选择的服务器端语言中使用。或者，如果您使用的是 PHP，我相信[PHP 的 GD 库](http://us2.php.net/gd)非常受欢迎。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-01T03:32:37.370

在其他浏览器中没有等价物。最接近的方法是使用像 Canvas 这样的图形库并处理其中的图像，但您必须自己编写操作，而且它们需要 JavaScript。

* * *

`filter`是一个仅限 IE 的功能——它在任何其他浏览器中都不可用。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-04T00:23:49.250

[应用于 HTML 内容的 SVG 过滤器](https://developer.mozilla.org/en-US/docs/Applying_SVG_effects_to_HTML_content)。

仅适用于 Firefox 3.1 及更高版本，但我认为 Safari 正朝着相同的方向发展。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-01T04:25:35.337

据我所知没有。过滤器是 IE 唯一的东西，我认为没有任何其他浏览器具有类似的功能。

您需要什么特定的用例？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-01T04:27:57.360

恐怕您对大多数跨浏览器`filter`类型的功能都很不走运。单靠 CSS 不会让你做大部分这些事情。例如，没有办法仅使用 CSS 来反转图像跨浏览器。您将必须拥有图像的两个不同副本（一个倒置），或者您可以尝试使用 Javascript 或者以完全不同的方式进行处理，但没有简单的解决方案仅在 CSS 中。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-01T07:47:58.660

有过滤器，例如 SVG 中的 Gaussian Blur 等，除 IE 外，大多数浏览器都原生支持该过滤器。

在这里进行纯粹的思想实验，您可以使用 javascript 动态地将图像包装在 SVG 对象中，并尝试对它们应用过滤器。

我怀疑这是否适用于背景图像，尽管可能有很多巧妙的定位它可以工作。

这不太可能是一个现实的解决方案。如果您不想永久修改源图像，**Rudi**有最好的答案，使用服务器端工具即时应用转换（或缓存性能）将是最好的跨浏览器解决方案。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2014-09-28T18:38:47.673

这是一个非常古老的问题，但 css 已更新为现在支持过滤器。阅读更多关于它的信息

[https://developer.mozilla.org/en-US/docs/Web/CSS/filter](https://developer.mozilla.org/en-US/docs/Web/CSS/filter)

**句法**

使用函数，使用以下内容：

```
filter: <filter-function> [<filter-function>]* | none 
```

要引用 SVG 元素，请使用以下内容：

```
filter: url(svg-url#element-id) 
```

* * *

## 回答 #9

> 赞同：-2
> 
> 时间：2008-10-01T04:32:47.053

不是真的，希望永远不会有。它不是 Web 标准 CSS 功能，因为您使用 CSS 来格式化网页，而不是浏览器本身。其他网页设计师和开发人员认为他们应该按照自己的意愿设计我的浏览器并这样做的那一天就是我停止访问他们的页面的那一天（我是作为前端网络人说的）。

# svn - Web 应用程序的源代码管理策略 - 分支、标记、分叉等

> ID：156120
> 
> 赞同：2
> 
> 时间：2008-10-01T03:25:16.653
> 
> 标签：svn, git, version-control, web-applications, branch

这篇文章（[How do you manage database revisions on a medium-sized project with branches?](https://stackoverflow.com/questions/156044/how-do-you-manage-database-revisions-on-a-medium-sized-project-with-branches)）让我想知道如何最好地使用分支和部署到开发、登台和生产（以及本地副本）来处理 Web 项目。

我们本身没有“发布”：如果一个功能大到足以引起注意，我们将其推送（在必要的测试/等之后），否则我们批量处理一些，当感觉“舒适”时，推送那些活着。目标是每月部署一次或两次以上，因为不断变化的站点往往会让用户有点不安。

以下是我们的做法，感觉有点脆弱（目前使用 svn，但考虑切换到 git）：

1.  两个“分支”——DEV 和 STAGE，给定的 STAGE 版本标记为 TRUNK
    *   开发人员检查每个更改的 TRUNK 副本并为其创建一个分支
    *   开发人员在本地工作，经常签入代码（就像投票一样：尽早且经常）
    *   当开发人员感到满意时，它并没有完全损坏，将分支与 DEV 合并并部署到开发站点。
    *   根据需要重复 3-4，直到更改“完成”
    *   将变更分支与 STAGING 合并，部署到暂存站点。进行预期的最终测试。
    *   一段时间后，将给定的 STAGE 版本标记为 TRUNK，并实时推送主干
    *   合并 TRUNK 更改回 DEV 以保持同步

现在，其中一些步骤非常复杂，而且在实践中很难做到（TRUNK -> DEV 总是中断），所以我不得不想象有更好的方法。

想法？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-01T19:21:08.743

如果您希望工作无法按时完成，并且您没有足够的测试体来进行持续集成工作，那么分支会很方便。我倾向于在编程任务太大而无法按预期完成的商店中看到分支疯狂的开发，因此管理层希望等到发布之前确定应该发布哪些功能。如果您正在做这种工作，那么您可能会考虑使用分布式版本控制，其中每个工作目录自然是一个分支，您可以获得所有本地签入和本地历史记录，您可以在不伤害任何人的情况下食用。您甚至可以与主干之外的其他开发人员交叉合并。

我的偏好是当我们在一个不稳定的主干中工作时，其中包含用于发布候选的分支，然后标记为发布，然后成为紧急补丁的流。在这样的系统中，很少有超过三个分支（最新版本、当前候选版本、不稳定主干）。如果您正在执行 TDD 并且在不稳定的主干上具有 CI，则此方法有效。如果您需要分解所有任务，以便您可以根据需要随时交付代码（通常一个任务应该只有一到两天，并且可以在没有构成其功能的所有其他任务的情况下发布）。因此，程序员开始工作，检查主干，完成工作，同步并在所有测试通过时随时检查。不稳定的主干始终可以作为候选发布（如果所有测试都通过）分支，因此发布成为非事件。

总体而言，更好意味着：更少的分支、更短的任务、更短的发布时间、更多的测试。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-01T04:20:23.540

一个明显的想法是更多的“rebase”（更频繁地从“父”环境 STAGE 合并到“子”环境“DEV”到开发人员分支），以尽量减少不需要的 TRUNK->DEV 的最终影响了。

也就是说，在 STAGE 中完成的任何事情，必然会一次投入生产（TRUNK），应该尽早在 DEV 和私有 devs 分支中合并回来，否则那些后期的改造合并总是很痛苦。

但是，上面的合并工作流程太不方便了，我建议一个 REBASE 分支，基于发布后的最新 DEV（新 TRUNK）。rebase TRUNK->DEV 将变为 TRUNK->REBASE，所有问题都解决了，然后最终合并 DEV->REBASE 以检查任何当前开发人员是否与新更新的系统兼容。从 REBASE 到 DEV（以及私有开发分支）的最后一个简单的合并将完成该过程。
分支的重点是隔离不能与其他当前开发工作一起进行的开发工作。如果 TRUNK->DEV 过于复杂，无法与当前的 DEV 配合使用，则需要进行隔离。因此，'REBASE' 分支命题。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-15T23:51:14.487

阅读：http: [//oreilly.com/catalog/practicalperforce/chapter/ch07.pdf](http://oreilly.com/catalog/practicalperforce/chapter/ch07.pdf)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-01T04:26:47.427

我们在我工作的商店中使用 SVN。在我们进行 C++ 开发时，版本管理非常普遍。以下是我们的方法，您可以决定哪种方法（如果有的话）对您的方法是合理的。

对我们来说，所有的开发都发生在一个分支中。我们为每个错误和每个功能分支。理想情况下，该分支仅用于 1 个功能，但有时并非如此。

当工作完成、测试并“准备好”时，我们将更改合并到主干中。我们的规则是，在任何时候，主干都不应该有损坏的代码。如果损坏的代码应该进入主干，修复它成为优先级 1。

当功能全部完成并合并时发布：发布的分支被创建为标签。该标签允许我们在需要时检索快照。该分支允许我们支持以前的版本。修复已发布版本中的错误是通过转到该版本的分支并从它分支来完成的。当一切顺利时，更改会合并回发布的分支，如果需要，可以一直合并到主干。

# jquery - 使用 jQuery 通过 AJAX 加载 XHTML 片段

> ID：156133
> 
> 赞同：9
> 
> 时间：2008-10-01T03:29:52.773
> 
> 标签：jquery, ajax, xhtml

我正在尝试使用 jQuery 的`$.fn.load`函数加载 XHTML 标记的片段，但尝试将新标记添加到 DOM 时会引发错误。我已将其缩小到 XML 声明 ( `<?xml...?>`) —— 如果我返回没有声明的静态文本，该视图将起作用。我不明白为什么这会导致失败，或者责任是否在于 jQuery、Firefox 或我的代码。

我应该如何使用 jQuery 将 XHTML 片段插入 DOM？

* * *

使用 $.get 不起作用——回调接收到一个`Document`对象，当我尝试将它插入 DOM 时，我收到以下错误：

```
uncaught exception: Node cannot be inserted at the specified point in the hierarchy (NS_ERROR_DOM_HIERARCHY_REQUEST_ERR)
http://localhost:8000/static/1222832186/pixra/script/jquery-1.2.6.js
Line 257 
```

这是我的代码：

```
$body = $("#div-to-fill");
$.get ("/testfile.xhtml", undefined, function (data)
{
    console.debug ("data = %o", data); // data = Document
    $body.children ().replaceWith (data); // error
}, 'xml'); 
```

* * *

示例响应：

```
<?xml version="1.0" encoding="UTF-8"?>
<div xmlns="http://www.w3.org/1999/xhtml">
  <form action="/gallery/image/edit-description/11529/" method="post">
    <div>content here</div>
  </form>
</div> 
```

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-10-01T03:59:50.237

试试这个（我刚刚做了一个快速测试，它似乎有效）：

```
$body = $("#div-to-fill");
$.get ("/testfile.xhtml", function (data)
{
    $body.html($(data).children());
}, 'xml'); 
```

基本上， .children() 将为您获取根节点并用它替换 div 的内容。我猜您不能将带有 <?xml 声明的 xml 文档准确地插入 DOM ...

# opengl - Win32 的 CoreImage

> ID：156136
> 
> 赞同：5
> 
> 时间：2008-10-01T03:30:10.400
> 
> 标签：opengl, image-processing, direct3d, core-image

对于那些不熟悉 Core Image 的人，这里有一个很好的描述：http: [//developer.apple.com/macosx/coreimage.html](http://developer.apple.com/macosx/coreimage.html)

有没有相当于 Apple 的 CoreImage/CoreVideo for Windows 的东西？我环顾四周，发现了 DirectX/Direct3D 的东西，它包含所有底层部分，但似乎没有任何高级 API 可以使用，除非你愿意使用 .NET*并*使用 WPF，这两者都不是我真的很感兴趣。

基本思想是创建/加载图像，附加任意数量的可以链接在一起的过滤器，形成图形，然后将图像渲染到 HDC，使用 GPU 完成大部分艰苦的工作。DirectX/Direct3D 有这些部分，但是您必须跳过很多圈（或者看起来如此）才能使用它。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-01T04:26:39.063

有多种工具可用于处理着色器（例如 RenderMonkey 和 FX-Composer），但没有直接等效于 CoreImage。

但是将片段着色器堆叠在一起并不是很困难，因此如果您不介意学习 OpenGL，那么构建一个将着色器应用于输入图像并将结果绘制到 HDC 的框架是完全可行的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-17T01:12:52.857

Adobe's new [Pixel Blender](http://labs.adobe.com/wiki/index.php/Pixel_Bender_Toolkit) is the closest technology out there. It is cross-platform -- it's part of the Flash 10 runtime, as well as the key pixel-oriented CS4 apps, namely After Effects and (soon) Photoshop. It's unclear, however, how much is currently exposed for embedding in other applications at this point. In the most extreme case it should be possible to embed by embedding a Flash view, but that is more overhead than would obviously be idea.

There is also at least one smaller-scale 3rd party offering: [Conduit Pixel Engine](http://lacquer.fi/conduit/pixelengine.php). It is commercial, with no licensing price clearly listed, however.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-06T17:19:52.677

我现在有一个解决方案。我已经实现了一个 ImageContext 类、一个特殊的 Image 类和一个允许与 Apple 的 CoreImage 类似功能的 Filter 类。所有这三个都使用 OpenGL（由于图像质量问题，我放弃了尝试让它在 DirectX 上工作，如果有人知道 DirectX，请联系我，因为我很想拥有 Dx 版本）将图像渲染到上下文并使用过滤器来应用它们的效果（作为 HLGL 片段着色器）。这里有一个简短的描述： [ImageKit](http://vcf-online.org/node/167) ，带有示例过滤器的屏幕截图和一些示例源代码。

# opengl - 渲染手绘人物的最佳方式

> ID：156165
> 
> 赞同：1
> 
> 时间：2008-10-01T03:44:18.807
> 
> 标签：opengl, graphics, rendering

我想我会用一个例子来说明：在[这个游戏中](http://www.kloonigames.com/blog/games/crayon)，您可以使用鼠标绘制 2D 形状，并且您所绘制的内容会实时呈现到屏幕上。我想知道使用硬件加速 (OpenGL) 渲染此类绘图的最佳方法是什么。我有两个想法：

*   开始绘制时创建屏幕大小的纹理，绘制时更新此纹理，并将其粘贴到屏幕上
*   创建一系列线段来表示图形，并使用线或细多边形来渲染它们

还有其他想法吗？这些方法中的哪一种可能是最好/最有效/最简单的？欢迎任何建议。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-01T04:08:02.057

我喜欢蜡笔物理学（音乐每次都能吸引我）。精彩的比赛！

但回到正题……他创建了跟随鼠标位置的画笔精灵。他创建了一些画笔，这些画笔略有变化。一旦鼠标落下，我想他正在将这些精灵添加到数据结构中，并通过他的绘图和碰撞函数发送该结构以循环。从而弹出实时效果。他正在使用简单的 DirectMedia 层库，我给了两个大拇指。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-01T03:48:27.690

我很确定第二个想法是要走的路。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-01T03:53:47.177

第一个选项，如果玩家纯手绘（而不是线条），并且他们绘制的内容不需要动画。

第二个选项，如果它是动画或主要是线条。如果您确实选择了这个，似乎您需要绘制细多边形而不是常规线条才能获得任何有趣的外观（如蜡笔示例中所示）。

# statistics - 您如何衡量界面更改是提高还是降低了可用性？

> ID：156176
> 
> 赞同：2
> 
> 时间：2008-10-01T03:47:08.613
> 
> 标签：statistics, e-commerce, usability, testing-strategies

对于电子商务网站，您如何衡量对网站的更改是否确实提高了可用性？你应该收集什么样的测量结果，你将如何建立一个框架来使这个测试成为开发的一部分？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-01T03:53:44.697

[多变量测试](http://en.wikipedia.org/wiki/Multivariate_testing)和报告是实际衡量这类事情的好方法。

它允许您测试哪些页面元素组合具有最高的转化率，从而持续改进您的网站设计和可用性。

[Google Web Optimizer](http://www.google.com/websiteoptimizer)对此提供了支持。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-01T03:56:48.200

你用来识别可用性问题的类似方法——可用性测试。通常，您确定您的用例，然后进行实验室研究评估用户如何实现某些目标。实验室测试通常适合 8-10 人。

我们为了解用户而采用的更多信息方法是进行匿名数据收集（您可能需要用户许可，明确您的隐私政策等）。这只是评估用户点击了哪些按钮/导航菜单，用户如何删除某些内容（即更改数量 - 更多用户输入 0 并更新数量或点击 X）？这设置起来有点复杂；您必须开发一个基础设施来保存这些数据（实际上只是计数器，即“点击次数 x：138838383，输入次数 0：390393”）并允许根据需要创建数据点以插入设计。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-01T04:34:36.940

为了将 UI 改进的测量推向从最终用户（数据收集可能需要一段时间）到设计或实施的流程，可以使用一些简单的启发式方法：

*   执行场景所需的操作数量是否更少？（如果是，那么它已经改进了）。测量：减少/增加的步骤数。

*   更改是否减少了要使用的输入设备种类的数量（即使步数相同）？我的意思是，如果你把依赖鼠标和键盘的东西改成*只*依赖鼠标或*只*依赖键盘，那么你的可用性就会提高。测量：使用的设备数量的变化。

*   更改是否使网站的不同部分保持一致？例如，如果电子商务站点的一部分在您未登录时丢失了所做的更改，而另一部分则没有，这是不一致的。更改它以使它们具有相同的行为可以提高可用性（最好是更具容错性！）。测量：制作一个图表（实际上是流程图）来映射特定操作的执行方式。改进是减少了图上的边数。

*   依此类推……找到一些通用的 UI 提示，找出像上面这样的一些指标，你就可以近似地提高可用性。

一旦你掌握了用户改进的这些设计近似值，然后收集了长期数据，你就可以看到设计级可用性改进是否对最终用户反应有任何预测能力（例如：在过去的 10 个项目中，我们'我们已经看到每个被移除的动作的场景平均快 1%，范围为 0.25%，标准开发为 0.32%）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-01T04:00:39.407

第一种方式可以是完全主观的或部分量化的：用户投诉和积极反馈。这样做的问题是，在过滤这些反馈时，您可能会有一些强烈的偏见，因此您最好尽可能量化。拥有一些票务系统来归档来自用户的每个报告并收集有关每个版本的界面的统计信息可能会很有用。只是让你的统计数据正确。

第二种方法是测量最终用户对界面进行的问卷调查中的差异。每个问题的答案应该是一组离散值，然后您可以再次为每个版本的界面收集统计数据。

后一种方式可能更难设置（设计问卷和可能的受控环境以及解释结果的指南本身就是一门手艺），但前一种方式很容易弄乱测量结果。例如，您必须考虑这样一个事实，即您为每个版本获得的票证数量取决于它使用的时间，并且所有时间范围都不相等（例如，在使用的第三或第四周，或者用户可能倾向于在使用的第一天不提交票证，即使他们发现问题等）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-01T05:09:00.007

托里尔偷了我的答案。虽然如果有一个衡量完成某项任务需要多长时间。如果时间减少了，任务还是完成了，那是好事。

此外，如果有办法记录取消次数，那也可以。

# c# - 如何在没有行版本或时间戳的情况下使用 Linq 2 SQL 更新对象？

> ID：156177
> 
> 赞同：0
> 
> 时间：2008-10-01T03:48:05.600
> 
> 标签：c#, linq-to-sql, .net-3.5

我正在尝试获取一个 POCO 对象并使用 XML 映射文件使用 Linq2SQL 对其进行更新......这就是我所拥有的：

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;

namespace Business.Objects
{
    public class AchievementType
    {
        public int Id { get; set; }
        public string Name { get; set; }
    }
}

<?xml version="1.0" encoding="utf-8" ?>
<Database Name="Name" xmlns="http://schemas.microsoft.com/linqtosql/mapping/2007">
  <Table Name="dbo.AchievementTypes" Member="Business.Objects.AchievementType">
    <Type Name="Business.Objects.AchievementType">
      <Column Name="Id" Member="Id" IsDbGenerated="true" IsPrimaryKey="true" />
      <Column Name="Name" Member="Name" />
    </Type>
  </Table>
</Database>

CREATE TABLE AchievementTypes
(
    Id          INTEGER         IDENTITY NOT NULL,
    Name        NVARCHAR(255)   NOT NULL,

    CONSTRAINT PK_AchievevementTypes 
        PRIMARY KEY (Id),

    CONSTRAINT UQ_AchievementTypes
        UNIQUE (Name)
) 
```

我正在执行以下操作来更新它：

```
var type_repo = new BaseRepository<AchievementType>();
var t1 = new AchievementType { Name = "Foo" };
type_repo.Insert(t1);
t1.Name = "Baz";
type_repo.Save(t1, "Id"); 
```

我的存储库 Save 正在做：

```
public void Update(TData entity)
{
    using (var ctx = MyDataContext())
    {
        ctx.GetTable<TData>().Attach(entity);
        ctx.SubmitChanges();
    }
} 
```

更新没有失败或任何事情，但数据库中的数据没有改变。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-01T03:53:02.407

呸，在我询问之后，我找到了一些关于它的文档。

由于 Context 不跟踪更改，因此您需要执行以下操作：

```
ctx.Refresh(RefreshMode.KeepCurrentValues, entities); 
```

# javascript - 在 Javascript 中使用正则表达式仅检索匹配字符串的一部分

> ID：156181
> 
> 赞同：4
> 
> 时间：2008-10-01T03:49:09.840
> 
> 标签：javascript, regex

我有一个字符串

```
foo (123) bar 
```

我想检索用分隔符`(`和. 包围的所有数字`)`。

如果我使用`varname.match(/\([0-9]+\)/)`，我的分隔符将包含在响应中，当我真正想要的是“123”时，我会得到“（123）”。

如何只检索匹配字符串的一部分而不跟进它`varname.replace()`？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-01T03:53:11.953

是的，使用捕获（非转义）括号：

```
varname.match(/\(([0-9]+)\)/)[1] 
```

# c# - 重新排序 PDF 页面顺序

> ID：156212
> 
> 赞同：2
> 
> 时间：2008-10-01T04:09:47.950
> 
> 标签：c#, .net, pdf

是否可以以编程方式重新排序已经生成的 PDF 文件，并使用尽可能少的资源，因为这需要每月在大约 8000 个 PDF 上运行？

我们目前正在使用 iTextSharp 将 PDF 合并到更大的 PDF 中，但 iTextsharp 的文档并没有真正解释太多。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-01T04:13:53.790

DynamicPDF 的 Merger 产品将执行此操作 ( [http://www.dynamicpdf.com/](http://www.dynamicpdf.com/) )。我不能说你会在 8k 文档中看到什么样的性能，但我可以说它是我发现的最快的 PDF 处理工具之一。

Merger 工具和 Generator 工具都有一个 .Net 版本。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-01T04:23:54.937

我使用过 iTextSharp——查看[这个代码示例](http://itextsharp.sourceforge.net/examples/Split.cs)，这是我用来编写（更简单）拆分实用程序的内容。

我一次在超过 10,000 个 PDF 上使用了它，我不记得确切的性能，但它对于批处理作业肯定是可以接受的。

# algorithm - 什么是体面的初学者图形拼图？

> ID：156213
> 
> 赞同：2
> 
> 时间：2008-10-01T04:11:14.157
> 
> 标签：algorithm, graph-theory

我正在尝试更熟悉需要解决图形的问题（最好通过图形解决）。

如果有人有一个使用图表的旧 ACM 编程竞赛问题，或者在他们解决问题时发现另一个特别有启发性的问题，我将不胜感激。我想熟悉图形，轻松识别图形类型问题并能够利用基本的图形遍历算法。

任何人有一个甜蜜的问题，他们可以发送我的方式？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-01T04:29:59.273

为了更好地掌握图上的操作，您可能只想实现一些已知的[图算法](http://en.wikipedia.org/wiki/Graph_theory#Algorithms)。

尝试实现[Nurikabe](http://en.wikipedia.org/wiki/Nurikabe)求解器或生成器。它需要相当多的经典图操作。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-01T12:06:22.423

您应该熟悉[柯尼斯堡桥问题](http://en.wikipedia.org/wiki/Seven_Bridges_of_K%C3%B6nigsberg)。您还应该真正熟悉图论问题中经常出现的[数据结构类型。](http://en.wikipedia.org/wiki/Graph_theory#Graph-theoretic_data_structures)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-01T17:04:49.677

图实际上可以用来模拟*几乎*任何问题。[Topcoder.com](http://topcoder.com)马拉松比赛通常适用于基于图形的解决方案。

*   [ProcessorScheduling](http://www.topcoder.com/longcontest/?module=ViewProblemStatement&rd=12166&pm=8708)问题可以用图表来解决。
*   GraphBuilder[问题](http://www.topcoder.com/longcontest/?module=ViewProblemStatement&rd=10128&pm=6858)。
*   距离[问题](http://www.topcoder.com/longcontest/?module=ViewProblemStatement&rd=10681&pm=7297)。
*   [MapMaker](http://www.topcoder.com/longcontest/?module=ViewProblemStatement&rd=10123&pm=6733)问题（加权 k 着色问题，这是一个经典的计算机科学问题）。

您可能会检查其中的一些问题——它们的来源还有更多。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-02T17:22:17.833

我发现这本书*非常*有用（亚马逊链接）： [编程挑战](https://rads.stackoverflow.com/amzn/click/com/0387001638)

它不仅对图、树、基本数据结构进行了非常深入的解释，而且还对涉及每种类型的编程提出了一些挑战！这份文件对我来说比我的教科书更有用！

以下是其中的一些图形问题：

涉及**图遍历**的问题：

*   双色：第 203 页
*   玩轮子：第 204 页
*   旅游指南：第 206 页
*   斜线迷宫：第 208 页
*   编辑阶梯：第 210 页
*   魔方塔：第 211 页
*   从黄昏到黎明：第 213 页
*   河内塔麻烦（再次！）：第 215 页

涉及**图算法**（Dijkstra's、Min Spanning Tree 等）的问题：

*   雀斑：第 231 页
*   项链：第 231 页
*   消防局：第 234 页
*   铁路：第 235 页
*   战争：第 237 页
*   盛大晚宴：第 241 页

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-01T04:47:02.137

你没有说你正在使用什么语言（考虑使用）。如果可以，我建议使用 Lisp 或 Python。它们都适用于简单的图形操作。如果你想要真正花哨，你可能想使用 PyGame 创建一个漂亮的输出。

至于问题，看一个简单的程序并将其转换为图形。提示，每个令牌都是一个节点。假设您有一些循环和方程式，那么您可以遍历图形并确定可以移出循环的内容。可以重新排列方程以更“有效”。

我对这个问题的基本原理是，它将通过查看编译器优化阶段中可能发生的过程来帮助您作为程序员。

顺便说一句，如果您尝试上述方法，请查看[Plex](http://www.cosc.canterbury.ac.nz/greg.ewing/python/Plex/)，它将为您节省大量使用解析器的时间。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-01T04:47:51.243

[http://codekata.pragprog.com/2007/01/kata_nineteen_w.html](http://codekata.pragprog.com/2007/01/kata_nineteen_w.html)

提示：DAWG 是一种非常好的方法。

# python - Python 依赖注入框架

> ID：156230
> 
> 赞同：50
> 
> 时间：2008-10-01T04:25:33.263
> 
> 标签：python, dependency-injection

是否有与Python的 Guice ( [http://code.google.com/p/google-guice ) 等效的框架？](http://code.google.com/p/google-guice)

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-10-15T12:16:03.363

[Spring Python](http://springpython.webfactional.com)是基于 Java 的 Spring Framework 和 Spring Security 的一个分支，面向 ​​Python。该项目目前包含以下功能：

*   [控制反转（依赖注入）](http://martinfowler.com/articles/injection.html) - 使用经典 XML 或 python @Object 装饰器（类似于 Spring JavaConfig 子项目）将事物连接在一起。虽然@Object 格式与 Guice 样式不同（集中连接与每个类中的连接信息），但它是连接 Python 应用程序的一种有价值的方式。
*   [面向方面的编程](http://en.wikipedia.org/wiki/Aspect-oriented_programming)- 在水平编程范式（而不是垂直 OOP 继承）中应用拦截器，用于事务、安全和缓存等事务。
*   DatabaseTemplate - 从数据库读取需要打开游标、读取行和关闭游标的单调循环，以及异常处理程序。使用这个模板类，您只需要 SQL 查询和行处理功能。Spring Python 完成了剩下的工作。
*   数据库事务 - 使用事务包装多个数据库调用会使您的代码难以阅读。该模块提供了多种方法来定义事务，而不会使事情变得复杂。
*   安全性 - 使用身份验证和域授权来锁定对您的方法的访问的插件安全拦截器。
*   远程处理 - 将本地应用程序转换为分布式应用程序很容易。如果您已经使用 IoC 容器构建了客户端和服务器部分，那么从本地到分布式只是一个配置更改。
*   示例 - 为了帮助演示 Spring Python 的各种功能，创建了一些示例应用程序：
    *   PetClinic - Spring Framework 的示例 Web 应用程序已使用 python Web 容器从头开始重建，包括：[CherryPy](http://cherrypy.org/) . 去看看如何使用这个框架的例子。（注意：其他 python web 框架将来会被添加到这个列表中）。
    *   Spring Wiki - Wiki 是存储和管理内容的强大方式，因此我们创建了一个简单的演示版！
    *   Spring Bot - 使用 Spring Python 构建一个小型机器人来管理开源项目的 IRC 通道。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2012-10-19T09:59:39.980

我喜欢这个简单而整洁的框架。

[http://pypi.python.org/pypi/injector/](http://pypi.python.org/pypi/injector/)

> 依赖注入作为一种正式模式在 Python 中不如在其他语言中有用，这主要是因为它支持关键字参数、可以轻松地模拟对象以及它的动态特性。
> 
> 也就是说，用于协助此过程的框架可以从大型应用程序中删除大量样板。这就是 Injector 可以提供帮助的地方。它自动和传递地提供关键字参数及其值。作为一个额外的好处，Injector 鼓励通过使用 Module 来很好地划分代码。
> 
> 虽然受到 Guice 的启发，但它并没有盲目地复制其 API。提供 Pythonic API 胜过忠诚度。

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2008-10-01T07:20:48.537

我没用过，但是[Spring Python](http://springpython.webfactional.com/)框架是基于 Spring 实现[的 Inversion of Control](http://static.springsource.org/spring-python/1.2.x/sphinx/html/objects.html)。

Python 项目中似乎也有一个 Guice：[snake-guice](http://code.google.com/p/snake-guice/)

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2008-11-08T20:50:17.313

作为猴子补丁的替代方案，我喜欢 DI。诸如[http://code.google.com/p/snake-guice/](http://code.google.com/p/snake-guice/)之类的新生项目可能符合要求。

或者参见Dennis Kempin的博文[Dependency Injection in Python （2008 年 8 月）。](http://web.archive.org/web/20090628142546/http://planet.open4free.org/tag/dependency%20injection/)

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2013-09-09T16:36:12.177

pinject ( [https://github.com/google/pinject](https://github.com/google/pinject) ) 是一种较新的选择。它似乎由 Google 维护，并遵循与 Guice ( [https://code.google.com/p/google-guice/](https://code.google.com/p/google-guice/) ) 类似的模式，它是 Java 对应物。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2008-10-01T07:58:08.387

除此之外：

1.  [Zope 组件架构](http://wiki.zope.org/zope3/ComponentArchitectureApproach)
2.  [pyContainer](http://pypi.python.org/pypi/PyContainer)

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2010-04-03T17:11:26.270

如果您只想在 Python 中进行依赖注入，则不需要框架。看看[Python 方式的依赖注入](http://code.activestate.com/recipes/413268-dependency-injection-the-python-way/)。它真的又快又容易，而且只有 c. 50行代码。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2010-04-20T14:59:39.950

有一个有点 Guicey [python-inject](https://github.com/ivankorobkov/python-inject)项目。它非常活跃，而且代码比 Spring-python 少很多，但话说回来，我还没有找到使用它的理由。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2016-03-06T20:05:20.250

将把我的 5 美分留在这里 :)

[https://pypi.python.org/pypi/dependency_injector](https://pypi.python.org/pypi/dependency_injector)

```
"""Pythonic way for Dependency Injection."""

from dependency_injector import providers
from dependency_injector import injections

@providers.DelegatedCallable
def get_user_info(user_id):
    """Return user info."""
    raise NotImplementedError()

@providers.Factory
@injections.inject(get_user_info=get_user_info)
class AuthComponent(object):
    """Some authentication component."""

    def __init__(self, get_user_info):
        """Initializer."""
        self.get_user_info = get_user_info

    def authenticate_user(self, token):
        """Authenticate user by token."""
        user_info = self.get_user_info(user_id=token + '1')
        return user_info

print AuthComponent
print get_user_info

@providers.override(get_user_info)
@providers.DelegatedCallable
def get_user_info(user_id):
    """Return user info."""
    return {'user_id': user_id}

print AuthComponent().authenticate_user(token='abc')
# {'user_id': 'abc1'} 
```

**更新**

一段时间过去了，Dependency Injector 现在有点不同了。最好从 Dependency Injector GitHub 页面开始获取实际示例 - [https://github.com/ets-labs/python-dependency-injector](https://github.com/ets-labs/python-dependency-injector)

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2018-02-24T17:34:16.677

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2011-05-04T14:18:03.447

下面是一个依赖注入容器的小例子，它根据构造函数参数名称进行构造函数注入：

[http://code.activestate.com/recipes/576609-non-invasive-dependency-injection/](http://code.activestate.com/recipes/576609-non-invasive-dependency-injection/)

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2017-11-06T11:37:46.700

我做了一个库来做到这一点 [https://github.com/ettoreleandrotognoli/python-cdi](https://github.com/ettoreleandrotognoli/python-cdi) 我希望这会有所帮助

它在 pypi 上可用：[https ://pypi.python.org/pypi/pycdi](https://pypi.python.org/pypi/pycdi)

有了它，您可以使用 python2 进行注射

```
import logging
from logging import Logger

from pycdi import Inject, Singleton, Producer
from pycdi.shortcuts import call

@Producer(str, _context='app_name')
def get_app_name():
    return 'PyCDI'

@Singleton(produce_type=Logger)
@Inject(app_name=str, _context='app_name')
def get_logger(app_name):
    return logging.getLogger(app_name)

@Inject(name=(str, 'app_name'), logger=Logger)
def main(name, logger):
    logger.info('I\'m starting...')
    print('Hello World!!!\nI\'m a example of %s' % name)
    logger.debug('I\'m finishing...')

call(main) 
```

并使用来自 python3 的类型提示

```
import logging
from logging import Logger

from pycdi import Inject, Singleton, Producer
from pycdi.shortcuts import call

@Producer(_context='app_name')
def get_app_name() -> str:
    return 'PyCDI'

@Singleton()
@Inject(logger_name='app_name')
def get_logger(logger_name: str) -> Logger:
    return logging.getLogger(logger_name)

@Inject(name='app_name')
def main(name: str, logger: Logger):
    logger.info('I\'m starting...')
    print('Hello World!!!\nI\'m a example of %s' % name)
    logger.debug('I\'m finishing...')

call(main) 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2019-03-11T15:23:30.620

[Enterprython](https://github.com/Dobiasd/enterprython)是一个提供依赖注入的小型框架，根据[类型提示](https://docs.python.org/3/library/typing.html)自动构建对象图。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2011-04-09T17:38:27.587

如果您更喜欢一个非常小的解决方案，那么它有一个小功能，它只是一个依赖设置器。

[https://github.com/liuggio/Ultra-Lightweight-Dependency-Injector-Python](https://github.com/liuggio/Ultra-Lightweight-Dependency-Injector-Python)

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2013-04-29T05:59:02.557

有 dyject ( [http://dyject.com](http://dyject.com) )，一个适用于 Python 2 和 Python 3 的轻量级框架，它使用内置的 ConfigParser

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2015-12-17T23:35:03.200

如果你想要一个 guice （他们说的新的），我最近在 Python 3 中做了一些最适合我对副项目的简单需求的东西。

您所需要的只是一个方法上的**@inject**（当然包括__init__）。其余的通过注释完成。

```
from py3njection import inject
from some_package import ClassToInject

class Demo:
    @inject
    def __init__(self, object_to_use: ClassToInject):
        self.dependency = object_to_use

demo = Demo() 
```

[https://pypi.python.org/pypi/py3njection](https://pypi.python.org/pypi/py3njection)

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2018-02-01T21:01:14.717

我最近在 python 中为 DI 发布了一个简洁的（恕我直言）微库：

[https://github.com/suned/serum](https://github.com/suned/serum)

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2020-05-15T19:04:16.840

我正在积极为 Python >=开发[pinject](https://github.com/davidcim/wirinj)`3.6`。它很容易使用：

```
class MyObject:
    my_service: MyService = INJECTED
    my_config: str = INJECTED 
```

# asp.net-mvc - Asp.net MVC 查看测试？

> ID：156232
> 
> 赞同：14
> 
> 时间：2008-10-01T04:25:56.447
> 
> 标签：asp.net-mvc, unit-testing

随着越来越多的代码被推送到 Asp.Net MVC 中的视图（即 AJAX、JQuery 等），您如何维护“可测试性”？

*   你如何测试你的观点？
*   您如何使用客户端 jscript 代码测试您的视图？
*   您如何使用异步行为测试您的视图？

似乎大多数关于 MVC 可测试性的示例都与控制器有关。视图呢？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-01T04:34:26.347

[Selenium](http://selenium.openqa.org/)是测试任何 Web 应用程序前端的绝佳工具。它是用浏览器的本地语言 JavaScript 编写的。让浏览器运行测试框架代码使您的测试能够暴露浏览器不兼容问题。它是免费和开源的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-01T08:48:11.230

另请参阅其他免费的浏览器自动化工具，例如 ArtOfTest 和 WatiN。Selenium 堆栈的设置可能有点复杂。

# objective-c - Objective C 中的对象分配和初始化

> ID：156243
> 
> 赞同：56
> 
> 时间：2008-10-01T04:31:43.607
> 
> 标签：objective-c, cocoa, cocoa-touch, memory-management

以下两种分配和初始化对象的方法有什么区别？

```
AController *tempAController = [[AController alloc] init];
self.aController = tempAController;
[tempAController release]; 
```

和

```
self.aController= [[AController alloc] init]; 
```

大多数苹果示例使用第一种方法。为什么要分配、初始化和对象然后立即释放？

* * *

## 回答 #1

> 赞同：71
> 
> 时间：2008-10-01T04:54:29.090

每个对象都有一个引用计数。当它变为 0 时，对象被释放。

假设该属性被声明为`@property (retain)`：

您的第一个示例，逐行：

1.  该对象由 创建`alloc`，它的引用计数为 1。
2.  对象被移交给`self`'s`setAController:`方法，该方法向它发送一条`retain`消息（因为该方法不知道对象来自哪里），将其引用计数增加到 2。
3.  调用代码不再需要对象本身，因此它调用`release`，将引用计数减为 1。

您的第二个示例基本上执行第 1 步和第 2 步，但没有执行第 3 步，因此最后对象的引用计数为 2。

规则是，如果您创建了一个对象，您有责任在完成后释放它。在您的示例中，代码在设置属性后使用 tempAController 完成。`retain`如果需要该对象保持不变，则调用它是 setter 方法的责任。

重要的是要记住，`self.property = foo;`在 Objective-C 中实际上只是简写，`[self setProperty:foo];`并且该`setProperty:`方法将根据需要保留或复制对象。

如果声明了属性`@property (copy)`，则该对象将被复制而不是保留。在第一个示例中，原始对象将立即被释放；在第二个示例中，原始对象的引用计数将是 1，即使它应该是 0。所以您仍然希望以相同的方式编写代码。

如果该属性已声明`@property (assign)`，`self`则不声明该对象的所有权，并且其他人需要保留它。在这种情况下，第一个示例将不正确。这类属性很少见，通常仅用于对象委托。

* * *

## 回答 #2

> 赞同：31
> 
> 时间：2008-10-03T16:37:03.277

正如其他人所指出的，您显示的两个代码片段并不等效（出于内存管理原因）。至于为什么选择前者而不是后者：

后者的正确表述是

```
self.aController= [[[AController alloc] init] autorelease]; 
```

与前者相比，这通过使用自动释放池增加了额外的开销，并且在某些情况下会导致对象的生命周期被不必要地延长（直到自动释放池被释放），这将增加您的应用程序的内存占用。

另一个“可能的”实现（取决于示例的来源）很简单：

```
aController = [[AController alloc] init]; 
```

但是，强烈建议不要在 init 或 dealloc 方法之外的任何地方直接设置实例变量。在其他地方，您应该始终使用访问器方法。

这将我们带到示例代码中显示的实现：

```
AController *tempAController = [[AController alloc] init];
self.aController = tempAController;
[tempAController release]; 
```

这遵循最佳实践，因为：

*   它避免了自动释放；
*   它使内存管理语义立即清晰；
*   它使用访问器方法来设置实例变量。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-01T07:03:56.550

另请注意，您希望将代码减少到一行是许多人使用 Autorelease 的原因：

```
self.aController = [[[AController alloc] init] autorelease]; 
```

尽管理论上 iPhone 的自动释放在某种程度上更昂贵（从未听到过明确的解释），因此您可能希望在将对象分配到其他位置后立即显式释放。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2011-01-14T18:07:04.467

如果您使用的是 Xcode，它可以帮助您使用静态分析器检测此类代码。只需点击构建>>构建和分析

![替代文字](https://i.stack.imgur.com/13KNx.png)

这将在这些代码片段中向您显示非常有用的消息。

![替代文字](https://i.stack.imgur.com/3oYsb.png)

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-10-01T18:38:04.743

需要注意的另一件事是，您的示例还取决于 aController 的 @property 定义。

如果将其定义为，`@property (readwrite, retain) id aController;`则您的示例有效，而如果将其定义为，`@property (readwrite, assign) id aController;`则对 release 的额外调用将​​导致您的对象被释放。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-08-04T00:24:53.543

你也可以做

```
@property (nonatomic, retain)AController *aController;
...
self.aController= [[AController alloc] init];
[aController release]; 
```

具有保留属性，它会以相同的方式运行，但最好使用其他方式（用于保留属性），因为它不那么令人困惑，该代码使它看起来像你分配了一个控制器，然后它从内存中删除，实际上不是因为 setAController 保留了它。

# ruby-on-rails - Ruby 中的对象销毁通知

> ID：156248
> 
> 赞同：16
> 
> 时间：2008-10-01T04:34:34.817
> 
> 标签：ruby-on-rails, ruby, garbage-collection

我编写了一个自定义 Rails 模型。该模型由实际服务器而不是数据库表支持（因此它不继承自`ActiveRecord::Base`）。为了从服务器获取请求的信息，我打开了一个到它的 SSH 连接。因为 rails 不重用对象，所以会为收到的请求创建一个新对象以及与服务器的新 SSH 连接。为了减少服务器压力，我想在模型对象被垃圾收集之前关闭 SSH 连接。我想知道 ruby​​ 是否提供通知机制来通知对象它将被销毁？如果是这样，我可以使用此通知来了解何时关闭 SSH 连接。如果不是，当我知道我完成了该对象时，我将需要手动进行。

如果我需要手动处理这个问题，我可以显式销毁该对象吗？还是我能做的最好的是`object = nil`？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-10-01T04:45:23.043

如果你需要控制一个对象被销毁时会发生什么，你真的应该自己明确地销毁它——这是设计使然。您也不应该明确地销毁对象-这也是设计使然。

换句话说，从您的程序的角度来看，一个对象永远不会被销毁或可销毁。由于这些原因，您应该重新考虑问题（这并不罕见 - 当不再需要对象时释放资源），以便它适合 Ruby 范式。

将对象设置为 nil 会给垃圾收集器一个提示，但不一定会立即销毁它。

但是，如果您必须让垃圾收集器处理它，请继续阅读。

没有直接支持析构函数，但您可以让它在销毁时调用[终结器函数](http://www.ruby-doc.org/core-1.8.7/classes/ObjectSpace.html#M000934)。

根据[http://pleac.sourceforge.net/pleac_ruby/classesetc.html](http://pleac.sourceforge.net/pleac_ruby/classesetc.html)如果它包含对原始对象的引用，它可能不会被垃圾收集，因此必须是类方法而不是实例方法。

```
class MyClass
    def initialize
        ObjectSpace.define_finalizer(self,
                                     self.class.method(:finalize).to_proc)
    end
    def MyClass.finalize(id)
        puts "Object #{id} dying at #{Time.new}"
    end
end 
```

# wpf - WPF：当窗口关闭时，从 LostFocus 处理程序调用 TextBox.Clear() 会导致 NullReferenceException

> ID：156256
> 
> 赞同：1
> 
> 时间：2008-10-01T04:41:31.713
> 
> 标签：wpf

下面的示例有两个文本框。第二个 TextBox 有一个处理 LostFocus 事件的处理程序，该处理程序对自身调用 Clear()。在两个文本框之间更改焦点效果很好；但是，如果在关闭窗口时焦点位于第二个文本框上，TextBox.Clear() 会生成 NullReferenceException。这是 WPF 中的错误吗？如何轻松检测到这种情况，以便在窗口关闭时避免调用 Clear()？

编辑：可能相关 - 该窗口是应用程序的主窗口。在调用 Clear() 时测试不为空。异常是从调用中的某个地方抛出的。

```
using System.Windows;

namespace TextBoxClear
{
    public partial class Window1 : Window
    {
        public Window1()
        {
            InitializeComponent();
        }

        private void Test_LostFocus(object sender, RoutedEventArgs e)
        {
            Test.Clear();
        }
    }
}

<Window x:Class="TextBoxClear.Window1"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
    <StackPanel>
        <TextBox />
        <TextBox LostFocus="Test_LostFocus" Name="Test" />
    </StackPanel>
</Window> 
```

装配参考：

*   mscorlib，版本=2.0.0.0，文化=中性，PublicKeyToken=b77a5c561934e089
*   PresentationCore，版本=3.0.0.0，文化=中性，PublicKeyToken=31bf3856ad364e35
*   PresentationFramework，版本=3.0.0.0，文化=中性，PublicKeyToken=31bf3856ad364e35
*   系统，版本=2.0.0.0，文化=中性，PublicKeyToken=b77a5c561934e089
*   WindowsBase，版本=3.0.0.0，文化=中性，PublicKeyToken=31bf3856ad364e35

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-01T04:49:24.003

触发 LostFocus 事件时，Test 属性是否可以为空？

尝试：

```
 private void Test_LostFocus(object sender, RoutedEventArgs e)
    {
        if (Test != null)
            Test.Clear();
    } 
```

**编辑：**我无法使用您发布的代码重现 NullReferenceException。您使用的是哪个版本的 .NET？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-01T06:07:06.280

挂钩 LostKeyboardFocus 而不是 LostFocus 适用于我的情况并停止事件处理程序引发异常。

# c++ - C++ 中的 AI 应用程序：虚函数的成本有多高？有哪些可能的优化？

> ID：156257
> 
> 赞同：16
> 
> 时间：2008-10-01T04:41:49.963
> 
> 标签：c++, optimization

在我用 C++ 编写的 AI 应用程序中，

1.  没有太多的数值计算
2.  有很多结构需要运行时多态性
3.  很多时候，几个多态结构在计算过程中相互作用

在这种情况下，有什么优化技术吗？虽然我现在不关心优化应用程序，但为项目选择 C++ 而不是 Java 的一个方面是能够更多地利用优化和能够使用非面向对象的方法（模板、过程、重载）。

尤其是与虚函数相关的优化技术有哪些？虚函数是通过内存中的虚表实现的。有没有办法将这些虚拟表预取到二级缓存（从内存/二级缓存中获取的成本正在增加）？

除此之外，C++ 中的数据局部性技术是否有很好的参考？这些技术将减少计算所需的数据提取到 L2 缓存的等待时间。

*更新*：另见以下相关论坛：[接口性能惩罚](https://stackoverflow.com/questions/113830/performance-penalty-for-working-with-interfaces-in-c#171549)，[基类的几个级别](https://stackoverflow.com/questions/99510/does-several-levels-of-base-classes-slow-down-a-classstruct-in-c)

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2008-10-01T06:17:25.163

虚函数非常有效。假设 32 位指针，内存布局大约是：

```
classptr -> [vtable:4][classdata:x]
vtable -> [first:4][second:4][third:4][fourth:4][...]
first -> [code:x]
second -> [code:x]
... 
```

classptr 指向的内存通常位于堆上，偶尔位于堆栈上，并以指向该类的 vtable 的四字节指针开始。但要记住的重要一点是 vtable 本身没有分配内存。它是一个静态资源，所有相同类类型的对象都将指向它们的 vtable 数组完全相同的内存位置。调用不同的实例不会将不同的内存位置拉入 L2 缓存。

这个[来自 msdn 的示例](http://msdn.microsoft.com/en-us/magazine/cc301398.aspx)显示了具有虚拟 func1、func2 和 func3 的类 A 的 vtable。不超过 12 个字节。在编译的库中，不同类的 vtable 也很有可能在物理上相邻（您需要验证这是您特别关心的），这可以从微观上提高缓存效率。

```
CONST SEGMENT
??_7A@@6B@
   DD  FLAT:?func1@A@@UAEXXZ
   DD  FLAT:?func2@A@@UAEXXZ
   DD  FLAT:?func3@A@@UAEXXZ
CONST ENDS 
```

另一个性能问题是通过 vtable 函数调用的指令开销。这也是非常有效的。几乎与调用非虚函数相同。再次[来自 msdn 的示例](http://msdn.microsoft.com/en-us/magazine/cc301398.aspx)：

```
; A* pa;
; pa->func3();
mov eax, DWORD PTR _pa$[ebp]
mov edx, DWORD PTR [eax]
mov ecx, DWORD PTR _pa$[ebp]
call  DWORD PTR [edx+8] 
```

在此示例中，堆栈帧基指针 ebp 的变量`A* pa`位于零偏移处。寄存器 eax 加载了位置 [ebp] 的值，因此它具有 A*，而 edx 加载了位置 [eax] 的值，因此它具有 A 类 vtable。然后用 [ebp] 加载 ecx，因为 ecx 表示“this”，它现在保存 A*，最后调用位置 [edx+8] 处的值，这是 vtable 中的第三个函数地址。

如果此函数调用不是虚拟的，则不需要 mov eax 和 mov edx，但性能差异将非常小。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-10-01T17:00:25.803

[C++ 性能技术报告草案](http://www.open-std.org/jtc1/sc22/wg21/docs/TR18015.pdf)的第 5.3.3 节完全致力于虚函数的开销。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-01T06:09:27.787

您是否真正分析并找到了需要优化的地方以及需要优化的内容？

当您发现虚函数调用实际上是瓶颈时，请着手实际优化它们。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-01T14:06:10.577

我能想到的唯一优化是 Java 的 JIT 编译器。如果我理解正确，它会在代码运行时监视调用，并且如果大多数调用仅转到特定实现，它会在类正确时插入条件跳转到实现。这样，大多数时候，没有 vtable 查找。当然，对于我们传递不同类的极少数情况，仍然使用 vtable。

我不知道任何使用这种技术的 C++ 编译器/运行时。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-03-16T19:07:47.410

虚函数往往是查找和间接函数调用。在某些平台上，这很快。在其他方面，例如，在控制台中使用的一种流行的 PPC 架构，这并不是那么快。

优化通常围绕着在调用堆栈中表达更高的可变性，这样您就不需要在热点内多次调用虚函数。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-01T06:20:41.083

您可以在运行时使用虚函数和在编译时使用模板来实现多态。您可以用模板替换虚函数。查看这篇文章以获取更多信息 - [http://www.codeproject.com/KB/cpp/SimulationofVirtualFunc.aspx](http://www.codeproject.com/KB/cpp/SimulationofVirtualFunc.aspx)

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-10-01T08:08:24.273

动态多态性的解决方案可能是静态多态性，如果您的类型在编译类型时已知，则可以使用：CRTP（Curiously recurring template pattern）。

[http://en.wikipedia.org/wiki/Curiously_recurring_template_pattern](http://en.wikipedia.org/wiki/Curiously_recurring_template_pattern)

Wikipedia 上的解释很清楚，*如果您真的确定*虚拟方法调用是性能瓶颈的根源，它*可能会对*您有所帮助。

 ** * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-10-01T10:32:01.603

与普通函数相比，虚拟调用不会产生更大的开销。虽然，最大的损失是多态调用的虚函数不能被内联。在很多情况下，内联将代表性能上的一些真正收益。

在某些情况下，为了防止浪费该设施，您可以做的事情是声明函数 inline virtual。

```
Class A {
   inline virtual int foo() {...}
}; 
```

当您在代码点确定被调用对象的类型时，您可以进行内联调用，以避免多态系统并启用编译器内联。

```
class B : public A {
     inline virtual int foo() 
     {
         //...do something different
     }

     void bar()
     {
      //logic...
      B::foo();
      // more  logic
     }
}; 
```

在此示例中，对 的调用`foo()`将是非多态的并绑定`B`到`foo()`. 但是只有在你确定实例类型是什么的情况下才这样做，因为自动多态特性会消失，这对于以后的代码读者来说并不是很明显。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-03-16T18:58:41.537

我正在加强所有有效的答案：

*   如果您实际上并不知道这是一个问题，那么任何关于修复它的担忧都可能是错误的。

你想知道的是：

*   在调用方法的过程中花费了多少执行时间（当它实际运行时），特别是哪些方法是最昂贵的（以此衡量）。

一些分析器可以间接地为您提供这些信息。他们需要在语句级别进行总结，但不包括方法本身所花费的时间。

我最喜欢的技术是在调试器下多次暂停它。

如果花在虚函数调用过程中的时间很长，比如 20%，那么平均 5 个样本中的 1 个将在调用堆栈底部的反汇编窗口中显示遵循虚函数的说明函数指针。

如果您实际上没有看到这一点，那不是问题。

在此过程中，您可能会看到调用堆栈更高的其他内容，这些内容实际上是不需要的，可以为您节省大量时间。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-03-16T19:19:27.540

正如其他答案已经说明的那样，虚函数调用的实际开销相当小。它可能会在每秒调用数百万次的紧密循环中产生影响，但这很少有什么大不了的。

但是，它可能仍然会产生更大的影响，因为编译器更难以优化。它不能内联函数调用，因为它在编译时不知道将调用哪个函数。这也使得一些全局优化变得更加困难。这会花费您多少性能？这取决于。通常没什么好担心的，但在某些情况下，这可能意味着对性能的重大影响。

当然，这也取决于 CPU 架构。在某些情况下，它可能会变得非常昂贵。

但值得牢记的是，任何类型的运行时多态性都或多或少具有相同的开销。通过 switch 语句或类似语句实现相同的功能，在许多可能的功能之间进行选择可能并不便宜。

优化这一点的唯一可靠方法是，如果您可以将一些工作转移到编译时。如果可以将其中的一部分实现为静态多态性，则可能会有所加速。

但首先，请确保您有问题。代码实际上是否太慢而无法接受？其次，通过探查器找出导致它变慢的原因。第三，修复它。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2009-11-21T07:44:14.117

正如一些用户在这里回答的那样，静态多态性。例如，WTL 使用这种方法。可以在[http://www.codeproject.com/KB/wtl/wtl4mfc1.aspx#atltemplates找到对 WTL 实现的清晰解释](http://www.codeproject.com/KB/wtl/wtl4mfc1.aspx#atltemplates)

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-10-01T04:45:10.627

对于此类常用项目，您几乎不必担心缓存，因为它们被提取一次并保存在那里。

缓存通常只是在处理大型数据结构时才会出现的问题：

1.  足够大并且由单个函数使用很长时间，以便该函数可以将您需要的所有其他内容从缓存中推出，或者
2.  被随机访问到足以使数据结构本身在您从它们加载时不一定在缓存中。

Vtables 之类的东西通常不会是性能/缓存/内存问题；通常每个对象类型只有一个 Vtable，并且该对象包含指向 Vtable 而不是 Vtable 本身的指针。因此，除非您有几千种类型的对象，否则我认为 Vtables 不会破坏您的缓存。

1) 顺便说一句，这就是为什么像 memcpy 这样的函数使用像 movnt(dq|q) 这样的缓存绕过流指令来处理非常大的（多兆字节）数据输入。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-10-17T07:36:16.843

对于最近的 CPU，成本与现在的普通功能差不多，但它们不能内联。如果您调用该函数数百万次，则影响可能很大（尝试调用数百万次相同的函数，例如，一次使用 inline 一次没有，如果函数本身执行一些简单的操作，您会发现它可能会慢两倍；这个不是理论上的情况：对于大量数值计算来说，这很常见）。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2009-03-16T20:24:04.123

使用现代、前瞻性、多调度 CPU，虚拟功能的开销很可能为零。纳达。压缩。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-10-01T05:02:22.613

如果**AI**应用程序不需要大量的数字运算，我不会担心虚函数的性能劣势。只有当它们出现在重复评估的复杂计算中时，才会对性能产生边际影响。我认为您也不能强制虚拟表保留在 L2 缓存中。

有一些可用于虚函数的优化，

1.  人们已经编写了对程序进行代码分析和转换的编译器。但是，这些不是生产级编译器。
2.  您可以用等效的“switch...case”块替换所有虚拟函数，以根据层次结构中的类型调用适当的函数。这样，您将摆脱编译器管理的虚拟表，并且您将拥有自己的 switch...case 块形式的虚拟表。现在，您自己的虚拟表在 L2 缓存中的可能性与在代码路径中一样高。请记住，您需要 RTTI 或您自己的“typeof”函数来实现这一点。

# java - What is the equivalent of the C++ Pair in Java?

> ID：156275
> 
> 赞同：704
> 
> 时间：2008-10-01T04:48:41.553
> 
> 标签：java, tuples, std-pair

Is there a good reason why there is no `Pair<L,R>` in Java? What would be the equivalent of this C++ construct? I would rather avoid reimplementing my own.

It seems that **1.6** is providing something similar (`AbstractMap.SimpleEntry<K,V>`), but this looks quite convoluted.

* * *

## 回答 #1

> 赞同：418
> 
> 时间：2008-10-01T08:18:24.500

In [a thread on `comp.lang.java.help`](http://groups.google.com/group/comp.lang.java.help/browse_thread/thread/f8b63fc645c1b487/1d94be050cfc249b), Hunter Gratzner gives some arguments against the presence of a `Pair` construct in Java. The main argument is that a class `Pair` doesn't convey any semantics about the relationship between the two values (how do you know what "first" and "second" mean ?).

A better practice is to write a very simple class, like the one Mike proposed, for each application you would have made of the `Pair` class. `Map.Entry` is an example of a pair that carry its meaning in its name.

To sum up, in my opinion it is better to have a class `Position(x,y)`, a class `Range(begin,end)` and a class `Entry(key,value)` rather than a generic `Pair(first,second)` that doesn't tell me anything about what it's supposed to do.

* * *

## 回答 #2

> 赞同：162
> 
> 时间：2010-02-27T10:41:54.187

This is Java. You have to make your own tailored Pair class with descriptive class and field names, and not to mind that you will reinvent the wheel by writing hashCode()/equals() or implementing Comparable again and again.

* * *

## 回答 #3

> 赞同：108
> 
> 时间：2009-03-24T12:55:19.613

HashMap compatible Pair class:

```
public class Pair<A, B> {
    private A first;
    private B second;

    public Pair(A first, B second) {
        super();
        this.first = first;
        this.second = second;
    }

    public int hashCode() {
        int hashFirst = first != null ? first.hashCode() : 0;
        int hashSecond = second != null ? second.hashCode() : 0;

        return (hashFirst + hashSecond) * hashSecond + hashFirst;
    }

    public boolean equals(Object other) {
        if (other instanceof Pair) {
            Pair otherPair = (Pair) other;
            return 
            ((  this.first == otherPair.first ||
                ( this.first != null && otherPair.first != null &&
                  this.first.equals(otherPair.first))) &&
             (  this.second == otherPair.second ||
                ( this.second != null && otherPair.second != null &&
                  this.second.equals(otherPair.second))) );
        }

        return false;
    }

    public String toString()
    { 
           return "(" + first + ", " + second + ")"; 
    }

    public A getFirst() {
        return first;
    }

    public void setFirst(A first) {
        this.first = first;
    }

    public B getSecond() {
        return second;
    }

    public void setSecond(B second) {
        this.second = second;
    }
} 
```

* * *

## 回答 #4

> 赞同：58
> 
> 时间：2010-12-17T14:39:54.383

The shortest pair that I could come up with is the following, using [Lombok](http://projectlombok.org/):

```
@Data
@AllArgsConstructor(staticName = "of")
public class Pair<F, S> {
    private F first;
    private S second;
} 
```

It has all the benefits of [the answer from @arturh](https://stackoverflow.com/a/677248/383414) (except the comparability), it has `hashCode`, `equals`, `toString` and a static “constructor”.

* * *

## 回答 #5

> 赞同：40
> 
> 时间：2012-03-13T00:21:35.360

Apache Commons Lang 3.0+ has a few Pair classes: [http://commons.apache.org/proper/commons-lang/apidocs/org/apache/commons/lang3/tuple/package-summary.html](http://commons.apache.org/proper/commons-lang/apidocs/org/apache/commons/lang3/tuple/package-summary.html)

* * *

## 回答 #6

> 赞同：32
> 
> 时间：2010-09-05T14:27:25.763

Another way to implement Pair with.

*   Public immutable fields, i.e. simple data structure.
*   Comparable.
*   Simple hash and equals.
*   Simple factory so you don't have to provide the types. e.g. Pair.of("hello", 1);

    ```
    public class Pair<FIRST, SECOND> implements Comparable<Pair<FIRST, SECOND>> {

        public final FIRST first;
        public final SECOND second;

        private Pair(FIRST first, SECOND second) {
            this.first = first;
            this.second = second;
        }

        public static <FIRST, SECOND> Pair<FIRST, SECOND> of(FIRST first,
                SECOND second) {
            return new Pair<FIRST, SECOND>(first, second);
        }

        @Override
        public int compareTo(Pair<FIRST, SECOND> o) {
            int cmp = compare(first, o.first);
            return cmp == 0 ? compare(second, o.second) : cmp;
        }

        // todo move this to a helper class.
        private static int compare(Object o1, Object o2) {
            return o1 == null ? o2 == null ? 0 : -1 : o2 == null ? +1
                    : ((Comparable) o1).compareTo(o2);
        }

        @Override
        public int hashCode() {
            return 31 * hashcode(first) + hashcode(second);
        }

        // todo move this to a helper class.
        private static int hashcode(Object o) {
            return o == null ? 0 : o.hashCode();
        }

        @Override
        public boolean equals(Object obj) {
            if (!(obj instanceof Pair))
                return false;
            if (this == obj)
                return true;
            return equal(first, ((Pair) obj).first)
                    && equal(second, ((Pair) obj).second);
        }

        // todo move this to a helper class.
        private boolean equal(Object o1, Object o2) {
            return o1 == null ? o2 == null : (o1 == o2 || o1.equals(o2));
        }

        @Override
        public String toString() {
            return "(" + first + ", " + second + ')';
        }
    } 
    ```

* * *

## 回答 #7

> 赞同：28
> 
> 时间：2012-03-01T19:02:17.057

How about [http://www.javatuples.org/index.html](http://www.javatuples.org/index.html) I have found it very useful.

The javatuples offers you tuple classes from one to ten elements:

```
Unit<A> (1 element)
Pair<A,B> (2 elements)
Triplet<A,B,C> (3 elements)
Quartet<A,B,C,D> (4 elements)
Quintet<A,B,C,D,E> (5 elements)
Sextet<A,B,C,D,E,F> (6 elements)
Septet<A,B,C,D,E,F,G> (7 elements)
Octet<A,B,C,D,E,F,G,H> (8 elements)
Ennead<A,B,C,D,E,F,G,H,I> (9 elements)
Decade<A,B,C,D,E,F,G,H,I,J> (10 elements) 
```

* * *

## 回答 #8

> 赞同：13
> 
> 时间：2014-05-05T08:45:32.807

android provides `Pair`class ([http://developer.android.com/reference/android/util/Pair.html](http://developer.android.com/reference/android/util/Pair.html)) , here the implementation:

```
public class Pair<F, S> {
    public final F first;
    public final S second;

    public Pair(F first, S second) {
        this.first = first;
        this.second = second;
    }

    @Override
    public boolean equals(Object o) {
        if (!(o instanceof Pair)) {
            return false;
        }
        Pair<?, ?> p = (Pair<?, ?>) o;
        return Objects.equal(p.first, first) && Objects.equal(p.second, second);
    }

    @Override
    public int hashCode() {
        return (first == null ? 0 : first.hashCode()) ^ (second == null ? 0 : second.hashCode());
    }

    public static <A, B> Pair <A, B> create(A a, B b) {
        return new Pair<A, B>(a, b);
    }
} 
```

* * *

## 回答 #9

> 赞同：12
> 
> 时间：2008-10-01T04:53:59.560

It depends on what you want to use it for. The typical reason to do so is to iterate over maps, for which you simply do this (Java 5+):

```
Map<String, Object> map = ... ; // just an example
for (Map.Entry<String, Object> entry : map.entrySet()) {
  System.out.printf("%s -> %s\n", entry.getKey(), entry.getValue());
} 
```

* * *

## 回答 #10

> 赞同：9
> 
> 时间：2012-12-01T15:37:50.217

The biggest problem is probably that one can't ensure immutability on A and B (see [How to ensure that type parameters are immutable](https://stackoverflow.com/questions/13666444/java-ensure-that-type-parameters-are-immutable/13667623#13667623)) so `hashCode()` may give inconsistent results for the same Pair *after* is inserted in a collection for instance (this would give undefined behavior, see [Defining equals in terms of mutable fields](http://www.artima.com/lejava/articles/equality.html)). For a particular (non generic) Pair class the programmer may ensure immutability by carefully choosing A and B to be immutable.

Anyway, clearing generic's warnings from @PeterLawrey's answer (java 1.7) :

```
public class Pair<A extends Comparable<? super A>,
                    B extends Comparable<? super B>>
        implements Comparable<Pair<A, B>> {

    public final A first;
    public final B second;

    private Pair(A first, B second) {
        this.first = first;
        this.second = second;
    }

    public static <A extends Comparable<? super A>,
                    B extends Comparable<? super B>>
            Pair<A, B> of(A first, B second) {
        return new Pair<A, B>(first, second);
    }

    @Override
    public int compareTo(Pair<A, B> o) {
        int cmp = o == null ? 1 : (this.first).compareTo(o.first);
        return cmp == 0 ? (this.second).compareTo(o.second) : cmp;
    }

    @Override
    public int hashCode() {
        return 31 * hashcode(first) + hashcode(second);
    }

    // TODO : move this to a helper class.
    private static int hashcode(Object o) {
        return o == null ? 0 : o.hashCode();
    }

    @Override
    public boolean equals(Object obj) {
        if (!(obj instanceof Pair))
            return false;
        if (this == obj)
            return true;
        return equal(first, ((Pair<?, ?>) obj).first)
                && equal(second, ((Pair<?, ?>) obj).second);
    }

    // TODO : move this to a helper class.
    private boolean equal(Object o1, Object o2) {
        return o1 == o2 || (o1 != null && o1.equals(o2));
    }

    @Override
    public String toString() {
        return "(" + first + ", " + second + ')';
    }
} 
```

Additions/corrections much welcome :) In particular I am not quite sure about my use of `Pair<?, ?>`.

For more info on why this syntax see [Ensure that objects implement Comparable](https://stackoverflow.com/a/3166935/281545) and for a detailed explanation [How to implement a generic `max(Comparable a, Comparable b)` function in Java?](https://stackoverflow.com/a/6466779/281545)

* * *

## 回答 #11

> 赞同：9
> 
> 时间：2016-01-24T14:10:35.490

Good News JavaFX has a key value Pair.

Just add JavaFX as a dependency and import `javafx.util.Pair`, and use simply as in C++.

```
Pair <Key, Value> 
```

e.g.

```
Pair <Integer, Integer> pr = new Pair<Integer, Integer>()

pr.get(key);// will return corresponding value 
```

* * *

## 回答 #12

> 赞同：6
> 
> 时间：2010-12-15T18:40:08.620

In my opinion, there is no Pair in Java because, if you want to add extra functionality directly on the pair (e.g. Comparable), you must bound the types. In C++, we just don't care, and if types composing a pair do not have `operator <`, the `pair::operator <` will not compile as well.

An example of Comparable with no bounding:

```
public class Pair<F, S> implements Comparable<Pair<? extends F, ? extends S>> {
    public final F first;
    public final S second;
    /* ... */
    public int compareTo(Pair<? extends F, ? extends S> that) {
        int cf = compare(first, that.first);
        return cf == 0 ? compare(second, that.second) : cf;
    }
    //Why null is decided to be less than everything?
    private static int compare(Object l, Object r) {
        if (l == null) {
            return r == null ? 0 : -1;
        } else {
            return r == null ? 1 : ((Comparable) (l)).compareTo(r);
        }
    }
}

/* ... */

Pair<Thread, HashMap<String, Integer>> a = /* ... */;
Pair<Thread, HashMap<String, Integer>> b = /* ... */;
//Runtime error here instead of compile error!
System.out.println(a.compareTo(b)); 
```

An example of Comparable with compile-time check for whether type arguments are comparable:

```
public class Pair<
        F extends Comparable<? super F>, 
        S extends Comparable<? super S>
> implements Comparable<Pair<? extends F, ? extends S>> {
    public final F first;
    public final S second;
    /* ... */
    public int compareTo(Pair<? extends F, ? extends S> that) {
        int cf = compare(first, that.first);
        return cf == 0 ? compare(second, that.second) : cf;
    }
    //Why null is decided to be less than everything?
    private static <
            T extends Comparable<? super T>
    > int compare(T l, T r) {
        if (l == null) {
            return r == null ? 0 : -1;
        } else {
            return r == null ? 1 : l.compareTo(r);
        }
    }
}

/* ... */

//Will not compile because Thread is not Comparable<? super Thread>
Pair<Thread, HashMap<String, Integer>> a = /* ... */;
Pair<Thread, HashMap<String, Integer>> b = /* ... */;
System.out.println(a.compareTo(b)); 
```

This is good, but this time you may not use non-comparable types as type arguments in Pair. One may use lots of Comparators for Pair in some utility class, but C++ people may not get it. Another way is to write lots of classes in a type hierarchy with different bounds on type arguments, but there are too many possible bounds and their combinations...

* * *

## 回答 #13

> 赞同：6
> 
> 时间：2015-05-15T17:36:23.113

[Map.Entry](http://docs.oracle.com/javase/7/docs/api/java/util/Map.Entry.html) interface come pretty close to c++ pair. Look at the concrete implementation, like [AbstractMap.SimpleEntry](http://docs.oracle.com/javase/7/docs/api/java/util/AbstractMap.SimpleEntry.html) and AbstractMap.SimpleImmutableEntry First item is getKey() and second is getValue().

* * *

## 回答 #14

> 赞同：5
> 
> 时间：2011-03-30T16:53:34.827

As many others have already stated, it really depends on the use case if a Pair class is useful or not.

I think for a private helper function it is totally legitimate to use a Pair class if that makes your code more readable and is not worth the effort of creating yet another value class with all its boiler plate code.

On the other hand, if your abstraction level requires you to clearly document the semantics of the class that contains two objects or values, then you should write a class for it. Usually that's the case if the data is a business object.

As always, it requires skilled judgement.

For your second question I recommend the Pair class from the Apache Commons libraries. Those might be considered as extended standard libraries for Java:

[https://commons.apache.org/proper/commons-lang/apidocs/org/apache/commons/lang3/tuple/Pair.html](https://commons.apache.org/proper/commons-lang/apidocs/org/apache/commons/lang3/tuple/Pair.html)

You might also want to have a look at Apache Commons' [EqualsBuilder](https://commons.apache.org/proper/commons-lang/apidocs/org/apache/commons/lang3/builder/EqualsBuilder.html), [HashCodeBuilder](https://commons.apache.org/proper/commons-lang/apidocs/org/apache/commons/lang3/builder/HashCodeBuilder.html) and [ToStringBuilder](https://commons.apache.org/proper/commons-lang/apidocs/org/apache/commons/lang3/builder/ToStringBuilder.html) which simplify writing value classes for your business objects.

* * *

## 回答 #15

> 赞同：5
> 
> 时间：2012-11-08T23:28:08.737

According to the nature of Java language, I suppose people do not actually require a `Pair`, an interface is usually what they need. Here is an example:

```
interface Pair<L, R> {
    public L getL();
    public R getR();
} 
```

So, when people want to return two values they can do the following:

```
... //Calcuate the return value
final Integer v1 = result1;
final String v2 = result2;
return new Pair<Integer, String>(){
    Integer getL(){ return v1; }
    String getR(){ return v2; }
} 
```

This is a pretty lightweight solution, and it answers the question "What is the semantic of a `Pair<L,R>`?". The answer is, this is an interface build with two (may be different) types, and it has methods to return each of them. It is up to you to add further semantic to it. For example, if you are using Position and REALLY want to indicate it in you code, you can define `PositionX` and `PositionY` that contains `Integer`, to make up a `Pair<PositionX,PositionY>`. If JSR 308 is available, you may also use `Pair<@PositionX Integer, @PositionY Ingeger>` to simplify that.

EDIT: One thing I should indicate here is that the above definition explicitly relates the type parameter name and the method name. This is an answer to those argues that a `Pair` is lack of semantic information. Actually, the method `getL` means "give me the element that correspond to the type of type parameter L", which do means something.

EDIT: Here is a simple utility class that can make life easier:

```
class Pairs {
    static <L,R> Pair<L,R> makePair(final L l, final R r){
        return new Pair<L,R>(){
            public L getL() { return l; }
            public R getR() { return r; }   
        };
    }
} 
```

usage:

```
return Pairs.makePair(new Integer(100), "123"); 
```

* * *

## 回答 #16

> 赞同：5
> 
> 时间：2015-04-20T23:04:09.280

JavaFX (which comes bundled with Java 8) has the Pair< A,B > class

* * *

## 回答 #17

> 赞同：5
> 
> 时间：2016-04-08T07:13:31.583

You can use javafx utility class, `Pair` which serves the same purpose as pair <> in c++. [https://docs.oracle.com/javafx/2/api/javafx/util/Pair.html](https://docs.oracle.com/javafx/2/api/javafx/util/Pair.html)

* * *

## 回答 #18

> 赞同：4
> 
> 时间：2016-02-12T09:16:57.280

```
Collections.singletonMap(left, rigth); 
```

* * *

## 回答 #19

> 赞同：4
> 
> 时间：2018-11-19T18:28:27.823

another terse lombok implementation

```
import lombok.Value;

@Value(staticConstructor = "of")
public class Pair<F, S> {
    private final F first;
    private final S second;
} 
```

* * *

## 回答 #20

> 赞同：3
> 
> 时间：2010-09-29T06:44:19.270

Simple way Object [] - can be use as anу dimention tuple

* * *

## 回答 #21

> 赞同：3
> 
> 时间：2014-02-17T21:19:06.843

Despite being syntactically similar, Java and C++ have very different paradigms. Writing C++ like Java is bad C++, and writing Java like C++ is bad Java.

With a reflection based IDE like Eclipse, writing the necessarily functionality of a "pair" class is quick and simple. Create class, define two fields, use the various "Generate XX" menu options to fill out the class in a matter of seconds. Maybe you'd have to type a "compareTo" real quick if you wanted the Comparable interface.

With separate declaration / definition options in the language C++ code generators aren't so good, so hand writing little utility classes is more time consuming tedium. Because the pair is a template, you don't have to pay for functions you don't use, and the typedef facility allows assigning meaningful typenames to the code, so the objections about "no semantics" don't really hold up.

* * *

## 回答 #22

> 赞同：2
> 
> 时间：2010-02-03T14:44:10.510

Pair would be a good stuff, to be a basic construction unit for a complex generics, for instance, this is from my code:

```
WeakHashMap<Pair<String, String>, String> map = ... 
```

It is just the same as Haskell's Tuple

* * *

## 回答 #23

> 赞同：2
> 
> 时间：2013-03-18T02:40:25.577

For programming languages like Java, the alternate data structure used by most programmers to represent pair like data-structures are two array, and data is accessed via the same index

example: [http://www-igm.univ-mlv.fr/~lecroq/string/node8.html#SECTION0080](http://www-igm.univ-mlv.fr/~lecroq/string/node8.html#SECTION0080)

This isn't ideal as the data should be bound together, but also turn out to be pretty cheap. Also, if your use case demands storing co-ordinates then its better to build your own data structure.

I've something like this in my library

```
public class Pair<First,Second>{.. } 
```

* * *

## 回答 #24

> 赞同：2
> 
> 时间：2014-10-06T16:42:04.047

You can use Google's AutoValue library - [https://github.com/google/auto/tree/master/value](https://github.com/google/auto/tree/master/value).

You create a very small abstract class and annotate it with @AutoValue and the annotation processor generates a concrete class for you that has a value semantic.

* * *

## 回答 #25

> 赞同：2
> 
> 时间：2015-10-22T13:48:20.667

Here are some libraries that have multiple degrees of tuples for your convenience:

*   [JavaTuples](http://www.javatuples.org). Tuples from degree 1-10 is all it has.
*   [JavaSlang](http://javaslang.com). Tuples from degree 0-8 and lots of other functional goodies.
*   [jOOλ](https://github.com/jOOQ/jOOL). Tuples from degree 0-16 and some other functional goodies. (Disclaimer, I work for the maintainer company)
*   [Functional Java](http://www.functionaljava.org). Tuples from degree 0-8 and lots of other functional goodies.

Other libraries have been mentioned to contain at least the `Pair` tuple.

Specifically, in the context of functional programming which makes use of a lot of structural typing, rather than nominal typing ([as advocated in the accepted answer](https://stackoverflow.com/a/156685/521799)), those libraries and their tuples come in very handy.

* * *

## 回答 #26

> 赞同：2
> 
> 时间：2016-03-02T22:19:01.467

Brian Goetz, Paul Sandoz and Stuart Marks [explain why](https://youtu.be/ischZmi5oi4?t=33m22s) during QA session at Devoxx'14.

Having generic pair class in standard library will turn into technical debt once [value types](http://openjdk.java.net/projects/valhalla/) introduced.

*See also:* [Does Java SE 8 have Pairs or Tuples?](https://stackoverflow.com/questions/24328679/does-java-se-8-have-pairs-or-tuples/24336841#24336841)

* * *

## 回答 #27

> 赞同：1
> 
> 时间：2011-04-20T17:53:55.943

I noticed all the Pair implementations being strewn around here attribute meaning to the order of the two values. When I think of a pair, I think of a combination of two items in which the order of the two is of no importance. Here's my implementation of an unordered pair, with `hashCode` and `equals` overrides to ensure the desired behaviour in collections. Also cloneable.

```
/**
 * The class <code>Pair</code> models a container for two objects wherein the
 * object order is of no consequence for equality and hashing. An example of
 * using Pair would be as the return type for a method that needs to return two
 * related objects. Another good use is as entries in a Set or keys in a Map
 * when only the unordered combination of two objects is of interest.<p>
 * The term "object" as being a one of a Pair can be loosely interpreted. A
 * Pair may have one or two <code>null</code> entries as values. Both values
 * may also be the same object.<p>
 * Mind that the order of the type parameters T and U is of no importance. A
 * Pair&lt;T, U> can still return <code>true</code> for method <code>equals</code>
 * called with a Pair&lt;U, T> argument.<p>
 * Instances of this class are immutable, but the provided values might not be.
 * This means the consistency of equality checks and the hash code is only as
 * strong as that of the value types.<p>
 */
public class Pair<T, U> implements Cloneable {

    /**
     * One of the two values, for the declared type T.
     */
    private final T object1;
    /**
     * One of the two values, for the declared type U.
     */
    private final U object2;
    private final boolean object1Null;
    private final boolean object2Null;
    private final boolean dualNull;

    /**
     * Constructs a new <code>Pair&lt;T, U&gt;</code> with T object1 and U object2 as
     * its values. The order of the arguments is of no consequence. One or both of
     * the values may be <code>null</code> and both values may be the same object.
     *
     * @param object1 T to serve as one value.
     * @param object2 U to serve as the other value.
     */
    public Pair(T object1, U object2) {

        this.object1 = object1;
        this.object2 = object2;
        object1Null = object1 == null;
        object2Null = object2 == null;
        dualNull = object1Null && object2Null;

    }

    /**
     * Gets the value of this Pair provided as the first argument in the constructor.
     *
     * @return a value of this Pair.
     */
    public T getObject1() {

        return object1;

    }

    /**
     * Gets the value of this Pair provided as the second argument in the constructor.
     *
     * @return a value of this Pair.
     */
    public U getObject2() {

        return object2;

    }

    /**
     * Returns a shallow copy of this Pair. The returned Pair is a new instance
     * created with the same values as this Pair. The values themselves are not
     * cloned.
     *
     * @return a clone of this Pair.
     */
    @Override
    public Pair<T, U> clone() {

        return new Pair<T, U>(object1, object2);

    }

    /**
     * Indicates whether some other object is "equal" to this one.
     * This Pair is considered equal to the object if and only if
     * <ul>
     * <li>the Object argument is not null,
     * <li>the Object argument has a runtime type Pair or a subclass,
     * </ul>
     * AND
     * <ul>
     * <li>the Object argument refers to this pair
     * <li>OR this pair's values are both null and the other pair's values are both null
     * <li>OR this pair has one null value and the other pair has one null value and
     * the remaining non-null values of both pairs are equal
     * <li>OR both pairs have no null values and have value tuples &lt;v1, v2> of
     * this pair and &lt;o1, o2> of the other pair so that at least one of the
     * following statements is true:
     * <ul>
     * <li>v1 equals o1 and v2 equals o2
     * <li>v1 equals o2 and v2 equals o1
     * </ul>
     * </ul>
     * In any other case (such as when this pair has two null parts but the other
     * only one) this method returns false.<p>
     * The type parameters that were used for the other pair are of no importance.
     * A Pair&lt;T, U> can return <code>true</code> for equality testing with
     * a Pair&lt;T, V> even if V is neither a super- nor subtype of U, should
     * the the value equality checks be positive or the U and V type values
     * are both <code>null</code>. Type erasure for parameter types at compile
     * time means that type checks are delegated to calls of the <code>equals</code>
     * methods on the values themselves.
     *
     * @param obj the reference object with which to compare.
     * @return true if the object is a Pair equal to this one.
     */
    @Override
    public boolean equals(Object obj) {

        if(obj == null)
            return false;

        if(this == obj)
            return true;

        if(!(obj instanceof Pair<?, ?>))
            return false;

        final Pair<?, ?> otherPair = (Pair<?, ?>)obj;

        if(dualNull)
            return otherPair.dualNull;

        //After this we're sure at least one part in this is not null

        if(otherPair.dualNull)
            return false;

        //After this we're sure at least one part in obj is not null

        if(object1Null) {
            if(otherPair.object1Null) //Yes: this and other both have non-null part2
                return object2.equals(otherPair.object2);
            else if(otherPair.object2Null) //Yes: this has non-null part2, other has non-null part1
                return object2.equals(otherPair.object1);
            else //Remaining case: other has no non-null parts
                return false;
        } else if(object2Null) {
            if(otherPair.object2Null) //Yes: this and other both have non-null part1
                return object1.equals(otherPair.object1);
            else if(otherPair.object1Null) //Yes: this has non-null part1, other has non-null part2
                return object1.equals(otherPair.object2);
            else //Remaining case: other has no non-null parts
                return false;
        } else {
            //Transitive and symmetric requirements of equals will make sure
            //checking the following cases are sufficient
            if(object1.equals(otherPair.object1))
                return object2.equals(otherPair.object2);
            else if(object1.equals(otherPair.object2))
                return object2.equals(otherPair.object1);
            else
                return false;
        }

    }

    /**
     * Returns a hash code value for the pair. This is calculated as the sum
     * of the hash codes for the two values, wherein a value that is <code>null</code>
     * contributes 0 to the sum. This implementation adheres to the contract for
     * <code>hashCode()</code> as specified for <code>Object()</code>. The returned
     * value hash code consistently remain the same for multiple invocations
     * during an execution of a Java application, unless at least one of the pair
     * values has its hash code changed. That would imply information used for 
     * equals in the changed value(s) has also changed, which would carry that
     * change onto this class' <code>equals</code> implementation.
     *
     * @return a hash code for this Pair.
     */
    @Override
    public int hashCode() {

        int hashCode = object1Null ? 0 : object1.hashCode();
        hashCode += (object2Null ? 0 : object2.hashCode());
        return hashCode;

    }

} 
```

This implementation has been properly unit tested and the use in a Set and Map has been tried out.

Notice I'm not claiming to release this in the public domain. This is code I've just written for use in an application, so if you're going to use it, please refrain from making a direct copy and mess about with the comments and names a bit. Catch my drift?

* * *

## 回答 #28

> 赞同：1
> 
> 时间：2012-01-05T22:22:57.483

If anyone wants a dead-simple and easy to use version I made my available at [https://github.com/lfac-pt/Java-Pair](https://github.com/lfac-pt/Java-Pair). Also, improvements are very much welcome!

* * *

## 回答 #29

> 赞同：1
> 
> 时间：2014-05-05T08:46:49.263

com.sun.tools.javac.util.Pair is an simple implementation of a pair. It can be found in jdk1.7.0_51\lib\tools.jar.

Other than the org.apache.commons.lang3.tuple.Pair, it's not just an interface.

* * *

## 回答 #30

> 赞同：0
> 
> 时间：2011-12-09T10:55:59.450

```
public class Pair<K, V> {

    private final K element0;
    private final V element1;

    public static <K, V> Pair<K, V> createPair(K key, V value) {
        return new Pair<K, V>(key, value);
    }

    public Pair(K element0, V element1) {
        this.element0 = element0;
        this.element1 = element1;
    }

    public K getElement0() {
        return element0;
    }

    public V getElement1() {
        return element1;
    }

} 
```

usage :

```
Pair<Integer, String> pair = Pair.createPair(1, "test");
pair.getElement0();
pair.getElement1(); 
```

Immutable, only a pair !

* * *

## 回答 #31

> 赞同：0
> 
> 时间：2012-12-28T04:40:01.233

Many people are posting `Pair` code that is usable as a key in a Map...If you're trying to use a pair as a hashing key (a common idiom), be sure to check out Guava's `Table<R,C,V>`: [http://code.google.com/p/guava-libraries/wiki/NewCollectionTypesExplained#Table](http://code.google.com/p/guava-libraries/wiki/NewCollectionTypesExplained#Table). They give the following example usage, for graph edges:

```
Table<Vertex, Vertex, Double> weightedGraph = HashBasedTable.create();
weightedGraph.put(v1, v2, 4);
weightedGraph.put(v1, v3, 20);
weightedGraph.put(v2, v3, 5);

weightedGraph.row(v1); // returns a Map mapping v2 to 4, v3 to 20
weightedGraph.column(v3); // returns a Map mapping v1 to 20, v2 to 5 
```

A `Table` maps two keys to a single value, and provides efficient lookups for both types of keys alone as well. I've started using this data structure instead of a `Map<Pair<K1,K2>, V>` in many parts of my code. There are array, tree, and other implementations for both dense and sparse uses, with the option of specifying your own intermediate map classes.

* * *

## 回答 #32

> 赞同：0
> 
> 时间：2016-01-27T11:28:55.147

With new version of [Lombok](https://projectlombok.org/) you can compile that cute class:

```
@Value(staticConstructor = "of") public class Pair <E> {
  E first, second;
} 
```

and use it like: `Pair<Value> pairOfValues = Pair.of(value1, value2);`

* * *

## 回答 #33

> 赞同：0
> 
> 时间：2017-07-17T21:37:18.073

The answer by @Andreas Krey is actually good. Anything Java makes difficult, you probably shouldn't be doing.

The most common uses of Pair's in my experience have been multiple return values from a method and as VALUES in a hashmap (often indexed by strings).

In the latter case, I recently used a data structure, something like this:

```
class SumHolder{MyObject trackedObject, double sum}; 
```

There is your entire "Pair" class, pretty much the same amount of code as a generic "Pair" but with the advantage of descriptive names. It can be defined in-line right in the method it's used which will eliminate typical problems with public variables and the like. In other words, it's absolutely better than a pair for this usage (due to the named members) and no worse.

If you actually want a "Pair" for the key of a hashmap you are essentially creating a double-key index. I think this may be the one case where a "Pair" is significantly less code. It's not really easier because you could have eclipse generate equals/hash on your little data class, but it would be a good deal more code. Here a Pair would be a quick fix, but if you need a double-indexed hash who's to say you don't need an n-indexed hash? The data class solution will scale up, the Pair will not unless you nest them!

So the second case, returning from a method, is a bit harder. Your class needs more visibility (the caller needs to see it too). You can define it outside the method but inside the class exactly as above. At that point your method should be able to return a MyClass.SumHolder object. The caller gets to see the names of the returned objects, not just a "Pair". Note again that the "Default" security of package level is pretty good--it's restrictive enough that you shouldn't get yourself into too much trouble. Better than a "Pair" object anyway.

The other case I can see a use for Pairs is a public api with return values for callers outside your current package. For this I'd just create a true object--preferably immutable. Eventually a caller will share this return value and having it mutable could be problematic. This is another case of the Pair object being worse--most pairs cannot be made immutable.

Another advantage to all these cases--the java class expands, my sum class needed a second sum and a "Created" flag by the time I was done, I would have had to throw away the Pair and gone with something else, but if the pair made sense, my class with 4 values still makes at least as much sense.

* * *

## 回答 #34

> 赞同：0
> 
> 时间：2020-07-08T01:00:13.483

Try [VAVR Tuples](https://www.vavr.io/vavr-docs/#_tuples).

Not only does vavr have a good set of tuple types, it has great support for functional programming, too.

* * *

## 回答 #35

> 赞同：0
> 
> 时间：2021-02-27T05:59:44.610

Spring data has a Pair and can be used like below,

```
Pair<S, T> pair = Pair.of(S type data, T type data) 
```

* * *

## 回答 #36

> 赞同：0
> 
> 时间：2021-09-16T18:11:28.793

Although this question is over a decade old, I do feel the need to mention that, as of Java 14, [**Records**](https://docs.oracle.com/en/java/javase/14/language/records.html) can provide a very simple and light-weight solution to this problem without the need for any form of external library or dependencies.

For example, the following record class declaration would be all that's required in order to achieve the desired functionality:

```
record Pair<K, V>(K key, V value) { } 
```

Such a record class could be used as so:

```
// Declare a pair object containing two integers
var integerIntegerPair = new Pair<>(1, 2);

// Declare a pair object containing a String and an integer
var stringIntegerPair = new Pair<>("String", 20);

// Declare a pair object containing two other pairs!
var pairPairPair = new Pair<>(new Pair<>(1, 2), new Pair<>("String", 20)); 
```

# c++ - setbuf() 会影响 cout 吗？

> ID：156278
> 
> 赞同：2
> 
> 时间：2008-10-01T04:49:53.750
> 
> 标签：c++, class-library

再次，我的老师无法回答我的问题。我知道谁能...

所以，我从来没有真正学过 C。在 C++ 中，我显然会一直使用 cout 语句。在最近的一项作业中，我的老师告诉我们要确保

```
setbuf( stdout , NULL ); 
```

在 main() 的顶部，以获得无缓冲的输出，从而使我们能够正确查看输出。

我的问题是：这个语句会影响 cout 语句，还是我调用的 printf() 语句？

提前致谢！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-01T05:20:48.403

默认情况下，iostreams 和 stdio 是同步的。[参考。](http://en.cppreference.com/w/cpp/io/ios_base/sync_with_stdio)

但这并不意味着手动调整 stdio 缓冲是一个好主意！您可能希望使用`std::endl`or `std::flush`(from `<ostream>`)，这可能会对您有所帮助。例如，

```
std::cout << "Hello, world!" << std::endl; 
```

或者

```
std::cout << "Hello, world!\n" << std::flush; 
```

两者都做同样的事情。（[`std::endl`](http://en.cppreference.com/w/cpp/io/manip/endl)= 打印结束行，然后刷新。）

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-01T06:09:48.630

默认情况下，如果 stdout 或 cout 正在打印到控制台，则输出是行缓冲的。这意味着打印的每个换行符都会刷新输出。每当您想覆盖行为时，您都可以显式调用 flush() 以防万一，输出将被重定向到文件并且您想使用 tail -f 并需要实时某些输出。

正如 Chris 所说，[sync_with_stdio](http://www.cplusplus.com/reference/iostream/ios_base/sync_with_stdio.html)应该将未缓冲的标准输出与未缓冲的 cout 绑定（默认情况下），但如果您所做的只是使用 cout，而不是在标准输出上使用 setbuf，更好的选择是在[rdbuf](http://www.cplusplus.com/reference/iostream/ios/rdbuf.html)返回的指针上使用[pubsetbuf](http://www.cplusplus.com/reference/iostream/streambuf/pubsetbuf.html)。IE：

```
// make cout unbuffered
std::cout.rdbuf()->pubsetbuf(0, 0); 
```

另一个可能有趣的函数是[tie](http://www.cplusplus.com/reference/iostream/ios/tie.html)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-01T13:57:29.067

通常，当重要的是立即查看输出时，我们谈论的是复杂的高度可靠的财务例程，它必须在实际将交易发送给交易对手之前将交易一直记录到硬盘驱动器。或者，（更常见的情况）我们希望在程序崩溃时也能看到调试消息。

由于您正在学习，我假设您正在处理第二种情况。在这种情况下，我的建议是使用 stderr 而不是 stdout。默认情况下它是无缓冲的，您可以将其与标准输出分开重定向，将您的输出放在一个地方，将您的日志放在另一个地方。

# mysql - 如何将 SQL Server .bak 文件导入 MySQL？

> ID：156279
> 
> 赞同：72
> 
> 时间：2008-10-01T04:49:53.797
> 
> 标签：mysql, sql-server, migration, backup

标题是不言自明的。有没有办法直接进行这种导入？

* * *

## 回答 #1

> 赞同：71
> 
> 时间：2008-10-01T06:39:07.780

SQL 服务器中的 .BAK 文件采用 Microsoft 磁带格式 (MTF) 参考：[http ://www.fpns.net/willy/msbackup.htm](http://www.fpns.net/willy/msbackup.htm)

bak 文件可能包含 SQL Server 用于存储数据库的 LDF 和 MDF 文件。

您将需要使用 SQL 服务器来提取这些。SQL Server Express 是免费的，可以完成这项工作。

因此，安装 SQL Server Express 版本，然后打开 SQL Server Powershell。那里执行`sqlcmd -S <COMPUTERNAME>\SQLExpress`（以管理员身份登录时）

然后发出以下命令。

```
restore filelistonly from disk='c:\temp\mydbName-2009-09-29-v10.bak';
GO 
```

这将列出备份的内容——你需要的是第一个告诉你逻辑名称的字段——一个是实际的数据库，另一个是日志文件。

```
RESTORE DATABASE mydbName FROM disk='c:\temp\mydbName-2009-09-29-v10.bak'
WITH 
   MOVE 'mydbName' TO 'c:\temp\mydbName_data.mdf', 
   MOVE 'mydbName_log' TO 'c:\temp\mydbName_data.ldf';
GO 
```

此时您已经提取了数据库 - 然后安装[Microsoft 的“Sql Web Data Administrator”。](http://www.microsoft.com/downloads/details.aspx?FamilyID=c039a798-c57a-419e-acbc-2a332cb7f959&displaylang=en)与[此导出工具](http://www.eggheadcafe.com/articles/20040913.asp)一起，您将拥有一个包含数据库的 SQL 脚本。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2012-12-09T02:03:42.700

MySql 有一个从 microsoft sql 导入 db 的应用程序。脚步：

1.  打开 MySql 工作台
2.  单击“数据库迁移”（如果没有出现，您必须从 MySql 更新安装它）
3.  使用简单的向导遵循迁移任务列表。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-10-03T01:19:06.143

我没有设法直接找到一种方法。

相反，我将 bak 文件导入 SQL Server 2008 Express，然后使用[MySQL Migration Toolkit](http://dev.mysql.com/doc/migration-toolkit/en/index.html)。

像魅力一样工作！

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2020-01-02T05:36:45.823

在这个问题中，答案没有及时更新。因此，很高兴地说，**在 2020 年**迁移到`MsSQL`这里`MySQL`非常容易。[像RebaseData](https://www.rebasedata.com/convert-bak-to-mysql-online)这样的在线转换器将一键完成您的工作。您只需上传`.bak`来自的文件`MsSQL`并将其转换`.sql`为可读的格式即可`MySQL`。

附加说明：[这](https://www.rebasedata.com/)不仅可以转换您的`.bak`文件，而且该站点适用于您想要的所有类型的数据库迁移。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-01T04:52:34.680

尽管我的 MySQL 背景有限，但我认为您在这方面运气不佳。但是，您应该能够通过将 db 恢复到 MSSQL 服务器，然后创建 SSIS 或 DTS 包将表和数据发送到 MySQL 服务器来迁移所有数据。

希望这可以帮助

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-01T05:03:28.647

我对此表示高度怀疑。正如 Levi 所说，您可能希望使用 DTS/SSIS 来执行此操作。有人认为您可能想要做的是在不实际导入数据的情况下启动该过程。只需将基本表结构放在一起就足够了。然后，您将要围绕生成的表结构进行更改，因为可能创建的任何结构 tat 充其量都是不稳定的。

您可能还需要更进一步，并创建一个暂存区域，该区域首先以字符串 (varchar) 形式接收所有数据。然后，您可以创建一个执行验证和转换的脚本，以将其放入“真实”数据库，因为这两个数据库并不总是能很好地协同工作，尤其是在处理日期时。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-01T05:10:13.000

SQL Server 数据库是 Microsoft 专有的。我能想到的两个选择是：

1.  以 CSV、XML 或类似格式转储数据库，然后将其加载到 MySQL。

2.  设置与 MySQL 的 ODBC 连接，然后使用 DTS 传输数据。正如查尔斯格雷厄姆所建议的那样，您可能需要在执行此操作之前构建表格。但这就像从 SQL 企业管理器窗口剪切和粘贴到相应的 MySQL 窗口一样简单。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-09-19T07:31:32.807

我使用的方法包括 Richard Harrison 方法的一部分：

> 所以，安装 SQL Server 2008 Express 版本，

这需要下载 Web 平台安装程序“wpilauncher_n.exe” 安装后单击数据库选择（您还需要下载框架和运行时）

安装后转到 windows 命令提示符并：

> 使用 sqlcmd -S \SQLExpress （以管理员身份登录）
> 
> 然后发出以下命令。
> 
> 仅从磁盘恢复 filelist='c:\temp\mydbName-2009-09-29-v10.bak'; GO 这将列出备份的内容——你需要的是第一个告诉你逻辑名称的字段——一个是实际的数据库，另一个是日志文件。
> 
> RESTORE DATABASE mydbName FROM disk='c:\temp\mydbName-2009-09-29-v10.bak' WITH MOVE 'mydbName' TO 'c:\temp\mydbName_data.mdf', MOVE 'mydbName_log' TO 'c:\临时\mydbName_data.ldf'；去

我启动了 Web 平台安装程序，并从新选项卡中安装了 SQL Server Management Studio 并浏览了数据库以确保数据在那里......

那时我尝试了 MSSQL“SQL 导入和导出向导”中包含的工具，但 csv 转储的结果只包括列名......

因此，我只是从 SQL Server Management Studio 导出了诸如“从用户中选择 *”之类的查询结果

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2011-08-24T17:19:13.017

对于那些尝试上述 Richard 解决方案的人，以下是一些可能有助于解决常见错误的附加信息：

1) 运行 restore filelistonly 时，您可能会收到操作系统错误 5（拒绝访问）。如果是这种情况，请打开 SQL Server 配置管理器并将 SQLEXPRESS 的登录名更改为具有本地写入权限的用户。

2）@“这将列出备份的内容-您需要的是第一个告诉您逻辑名称的字段”-如果您的文件列出了两个以上的标题，您还需要说明如何处理这些文件RESTORE DATABASE 命令。如果您不指明如何处理数据库和日志之外的文件，系统显然会尝试使用 .bak 文件中列出的属性。从其他人的环境中恢复文件将产生“路径具有无效属性。它必须是一个目录'（因为您的机器上不存在相关路径）。只需提供 MOVE 语句即可解决此问题。

就我而言，有第三个 FTData 类型文件。我添加的 MOVE 命令：

```
MOVE 'mydbName_log' TO 'c:\temp\mydbName_data.ldf',
MOVE 'sysft_...' TO 'c:\temp\other'; 
```

就我而言，我实际上必须为第三个文件创建一个新目录。最初，我尝试将其发送到与 .mdf 文件相同的文件夹，但是当我执行还原时，在第三个 FTData 文件上产生了“无法正确初始化”错误。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2016-10-14T15:38:14.650

SQL Server 中的 .bak 文件特定于该数据库方言，并且与 MySQL 不兼容。

尝试使用[etlalchemy](https://github.com/seanharr11/etlalchemy)将您的 SQL Server 数据库迁移到 MySQL。它是我创建的一个开源工具，用于促进不同 RDBMS 之间的轻松迁移。

[github页面](https://github.com/seanharr11/etlalchemy)上提供了快速安装和示例，更详细的项目起源说明可以在[这里](http://thelaziestprogrammer.com/sharrington/databases/migrating-between-databases-with-etlalchemy)找到。

# svn - 使用 Mercurial，是否有一种简单的方法可以将我的工作副本与默认远程存储库中的提示文件进行比较

> ID：156280
> 
> 赞同：13
> 
> 时间：2008-10-01T04:50:20.817
> 
> 标签：svn, http, mercurial, diff, scp

使用 mercurial 时，我希望能够将文件的工作副本与默认远程存储库中的提示文件进行比较。是否有捷径可寻？

我知道我可以做一个“hg incoming -p”来查看即将到来的补丁集，但是如果我拉一下我会直接看到一个特定文件的实际更改会很好最新的东西（或者我可能会推出的东西）。

我现在能想到的最简单的事情是创建一个小脚本，查看 .hg/hgrc 中的默认位置并使用 curl 下载文件（如果它通过 http，否则通过 ssh scp，或者只是做一个如果它在本地文件系统上，则直接 diff），然后将工作副本或提示与该临时副本进行比较。

我正在尝试向我的团队推销 mercurial，我的一位团队成员今天提出了这一点，因为他们可以使用他们的 GUI 工具在 SVN 中轻松完成。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-02T20:57:34.837

经过一番挖掘，我发现了[Rdiff 扩展](https://www.mercurial-scm.org/wiki/RdiffExtension)，它可以满足我的大部分需求。

它不附带 mercurial，但可以通过克隆存储库来安装：

```
hg clone http://hg.kublai.com/mercurial/extensions/rdiff 
```

然后修改您的 ~/.hgrc 文件以加载扩展名：

```
[extensions] 
rdiff=~/path/to/rdiff/repo/rdiff.py 
```

这有点古怪，因为它实际上通过检测第一个参数是否是远程 URL 来修改现有的“hg diff”命令。如果是，那么它将将该文件与本地存储库中的提示文件（而不是工作副本）进行比较。这是因为远程仓库首先出现在参数中，这与我期望的相反，但您可以将“--reverse”传递给 hg diff 命令来切换它。

我可以看到这些是对扩展的潜在增强，但现在，我可以在我的启动文件中使用 bash/zsh shell 函数来解决它们。它对我的工作副本进行临时签入（由 mercurial 事务保存，因此可以回滚），执行反向差异，然后回滚事务以将事物恢复到原来的状态：

```
hgrdiff() {
    hg commit -m "temp commit for remote diff" && 
    hg diff --reverse http://my_hardcoded_repo $* &&
    hg rollback      # revert the temporary commit
} 
```

然后调用它：

```
hgrdiff <filename to diff against remote repo tip> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-01T05:30:08.600

您可以尝试在本地拥有两个存储库 - 一个用于传入的内容，一个用于传出。然后你应该能够使用任何工具进行差异化。看这里：

[http://weblogs.java.net/blog/kohsuke/archive/2007/11/using_mercurial.html](http://weblogs.java.net/blog/kohsuke/archive/2007/11/using_mercurial.html)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-01T13:38:52.933

要扩展 Lars 方法（由于某种原因注释不起作用），您可以使用命令`-R`上的选项`diff`来引用本地存储库。这样您就可以使用您在其中指定的相同差异应用程序`hg`

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-07-29T21:19:14.947

使用模板，您可以获得所有已更改文件的列表：

```
hg incoming --template {files} 
```

# dependency-injection - 我应该如何为 DI/IOC 订购我的 ctor 参数？

> ID：156292
> 
> 赞同：5
> 
> 时间：2008-10-01T04:57:13.593
> 
> 标签：dependency-injection, inversion-of-control

我是一个 DI 新手，如果这是错误的方法或愚蠢的问题，请原谅我。

假设我有一个创建/更新订单的表单，并且我知道它需要检索要显示的产品和客户列表。我想传入它正在编辑的 Order 对象，但我也想将 ProductsService 和 CustomersService 作为依赖项注入。

因此，我希望我的 IoC 容器（无论我使用哪个容器）来提供服务，但这取决于调用代码来提供要编辑的 Order 对象。

我是否应该将构造函数声明为将 Order 对象作为第一个参数，然后将 ProductsService 和 CustomersService 声明为，例如：

```
public OrderForm(Order order, ProductsService prodsSvc, CustomersService custsSvc) 
```

...或者依赖项应该先出现，Order 对象最后，例如：

```
public OrderForm(ProductsService prodsSvc, CustomersService custsSvc, Order order) 
```

有关系吗？这是否取决于我使用的 IoC 容器？或者，还有更好的方法？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-01T05:08:14.423

马特，您不应该将普通参数与依赖项混合在一起。由于您的对象将在 IoC 容器的内部创建，您将如何指定必要的参数？

混合依赖和普通参数会使你的程序逻辑更加复杂。

在这种情况下，最好声明依赖属性（即从构造函数中删除依赖项）或在 IoC 构造**OrderForm**并解析它的依赖项后初始化**order字段（即从构造函数中删除普通参数）。**

 **您还可以将所有参数声明为依赖项，包括**顺序。**

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-01T06:05:17.393

我不同意@aku 的回答。

我认为您正在做的事情很好，还有其他方法或多或少是正确的。例如，人们可能会质疑这个对象是否应该首先依赖于服务。

不管 DI 是什么，我觉得至少在你的脑海中澄清每个对象所拥有的状态类型是有帮助的，例如真实状态（Order）、派生状态（如果有的话）和依赖关系（服务）：

[http://tech.puredanger.com/2007/09/18/spelunking/](http://tech.puredanger.com/2007/09/18/spelunking/)

在任何构造函数或方法上，我更喜欢首先传递真实数据，最后传递依赖项或外部内容。所以在你的例子中，我更喜欢第一个。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-01T05:53:38.683

我对允许在没有对 Order 实例的必需引用的情况下实例化 OrderForm 实例感到有点不安。一个原因可能是这会阻止我预先检查空订单。还有什么想法吗？

我想我知道 OrderForm 对象只会由确保在调用 IoC 框架后设置 Order 属性的 Factory 方法来实例化，我会感到欣慰。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2020-09-13T09:25:46.530

我只是有点晚了，但我建议在这种情况下使用工厂：工厂构造函数将获取`*Service`DI 系统将解析和注入的所需依赖项，而它的`Build()`方法将接受任何额外的状态参数 - 例如`Order`. 当然，工厂会在 DI 系统中注册自己，并且可以很好地使用它。

```
public class OrderFormFactory
{
  private readonly ProductsService _prodsSvc;
  private readonly CustomersService _custsSvc;

  public OrderFormFactory(ProductsService prodsSvc, CustomersService custsSvc)
  {
    _prodsService = prodsService ?? throw new ArgumentNullException(nameof(prodsService));
    _custsSvc = custsSvc ?? throw new ArgumentNullException(nameof(custsSvc));
  }

  public OrderForm Build(Order order)
  {
    // TODO: Any additional logic

    return new OrderForm(_prodsService, _custsSvc, order);
  }
} 
```

# .net - 字段上的 C# 属性

> ID：156304
> 
> 赞同：13
> 
> 时间：2008-10-01T05:07:43.100
> 
> 标签：.net, custom-attributes

如何在程序集中的任何位置设置字段属性，然后在整个程序集中反映这些字段属性并获取/设置附加属性的字段值？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-10-01T05:18:31.390

1）创建针对[字段的](http://msdn.microsoft.com/en-us/library/system.attributetargets.aspx)[自定义属性](http://msdn.microsoft.com/en-us/library/system.attribute.aspx) 2）[将其添加到所需字段](http://msdn.microsoft.com/en-us/magazine/cc163802.aspx) 3）遍历[程序集中定义的类型](http://msdn.microsoft.com/en-us/library/system.reflection.assembly.gettypes.aspx) 4）对于每种[类型](http://msdn.microsoft.com/en-us/library/system.type.aspx)： 4a）[遍历其字段](http://msdn.microsoft.com/en-us/library/6ztex2dc.aspx) 4b）如果字段[具有您的自定义属性](http://msdn.microsoft.com/en-us/library/system.reflection.fieldinfo.getcustomattributes.aspx)，请转到步骤 4c 4c）[获取](http://msdn.microsoft.com/en-us/library/system.reflection.fieldinfo.getvalue.aspx)或[设置](http://msdn.microsoft.com/en-us/library/6z33zd7h.aspx)字段值

# apache - 使用 mod_rewrite 屏蔽重定向到临时域

> ID：156315
> 
> 赞同：2
> 
> 时间：2008-10-01T05:14:32.240
> 
> 标签：apache, url, mod-rewrite, url-rewriting

我们在 companyname.com/blog 上建立了一个公司博客，但目前该博客是一个安装在不同服务器 (blog.companyname.com) 上的 Wordpress。

目的是在一两个月内将博客和网站都放在同一台服务器上，但这会在此期间留下一个问题。

目前我正在使用 mod_rewrite 执行以下操作：

[http://companyname.com/blog/article-name](http://companyname.com/blog/article-name)重定向到[http://blog.companyname.com/article-name](http://blog.companyname.com/article-name)

即使内容来自后者 blog.companyname.com，我能否以某种方式保持地址栏显示 companyname.com/blog？

如果它在同一台服务器和虚拟主机上，但不在不同的服务器上，我可以看到如何做到这一点？

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-01T05:22:45.997

[您可以使用mod_proxy](http://httpd.apache.org/docs/1.3/mod/mod_proxy.html#forwardreverse)在 companyname.com 上设置反向代理，而不是使用 mod_rewrite，以便将对[http://companyname.com/blog/article-name](http://companyname.com/blog/article-name)的请求代理（而不是重定向）到[http://blog .companyname.com/article-name](http://blog.companyname.com/article-name)。

这里有[更多说明和示例](http://www.apachetutor.org/admin/reverseproxies)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-01T05:22:57.510

[ZoneEdit](http://www.zoneedit.com)有一个名为 webforwards 的功能，它可能会执行此操作并隐藏您实际在做的事情（除非有人调查过）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-01T05:25:40.203

mod_rewrite 唯一能做的就是发送 HTTP 标头重定向，这些重定向（跨服务器）总是导致浏览器地址栏反映现实。

相反，您应该考虑编写一个“反映”博客的 404 脚本。这本质上是一个透明的代理，很多已经写好了。

该脚本将查找请求的页面（即 404'd）是否以[http://mycompany.com/blog/](http://mycompany.com/blog/)开头。如果是这样，它将下载然后将博客页面和相关文件发送到客户端（可能也会缓存它们）。

因此，请求[http://mycompany.com/blog/article_xyz](http://mycompany.com/blog/article_xyz)会导致 404 脚本下载并发送[http://blog.companyname.com/article_xyz](http://blog.companyname.com/article_xyz)。

它可能比它的价值更多的工作，但你可能能够设计一个足够简单的 404 脚本，它是值得的。

-亚当

# dvcs - 人们如何看待化石 DVCS？

> ID：156322
> 
> 赞同：124
> 
> 时间：2008-10-01T05:21:17.357
> 
> 标签：dvcs, fossil

化石[http://www.fossil-scm.org](http://www.fossil-scm.org)
我最近发现了这个，并开始在我的家庭项目中使用它。我想听听其他人对这个 VCS 的看法。

我认为缺少的是 IDE 支持。希望它会来，但我使用命令行就好了。

关于化石我最喜欢的东西：带有内置 Web 服务器 wiki 和错误跟踪的单个可执行文件。存储库只是一个 SQLite ( [http://www.sqlite.org](http://www.sqlite.org) ) 数据库文件，很容易在上面进行备份。我也喜欢我可以从中运行化石并将存储库保存在我的拇指驱动器上。这意味着我的软件开发已经变得完全可移植。

告诉我你的想法....

* * *

## 回答 #1

> 赞同：186
> 
> 时间：2008-10-03T13:48:23.180

Millikin 先生，如果您能花点时间回顾一下关于化石的一些文件，我想[您的反对意见](https://stackoverflow.com/a/165786/3195477)已经解决了。在 SQLite 数据库中存储存储库可以说比任何其他方法都更安全。有关使用事务数据库存储存储库的一些优点，请参阅[链接文本。](http://www.fossil-scm.org/index.html/doc/tip/www/selfcheck.wiki)至于臃肿：整个事情都在一个独立的可执行文件中，这似乎反驳了这种担忧。

完全披露：我是化石的作者。

请注意，我写了化石，因为没有其他 DVCS 满足我的需求。另一方面，我的需要不是你的需要，所以只有你才能判断化石是否适合你。但我确实鼓励你至少看一下文档，并在你驳回它之前尝试理解化石试图解决的问题。

* * *

## 回答 #2

> 赞同：51
> 
> 时间：2012-08-19T17:13:40.203

在使用 Fossil 一年多来进行重要的开发项目之后，我有足够的信心参与这个话题。

以下是我到目前为止的经验。我有时会与 git 和 svn 进行比较，仅仅是因为我非常了解这些 SCM，并且比较使我更容易理解这个想法。

我完全爱上了这个 SCM，所以它主要是优点。

我喜欢 Fossil 的地方：

1.  我们有一堆机器（win/mac/一些 Linux 发行版），单可执行安装就像听起来一样漂亮。没有依赖关系；它只是工作。Git 是一堆乱七八糟的文件，Subversion 中的依赖地狱使得它在某些 Linux 发行版上非常讨厌，特别是如果你必须自己构建它。

2.  默认的 Fossil 工作流程非常适合我们的项目，并且在需要时可以使用更多 git'ish 工作流程。

3.  我们发现它非常强大，即使在大型项目中也是如此。我对编写 SQLite 的人不抱任何期望。没有崩溃，没有腐败，没有有趣的事情。

4.  实际上，我对表现非常非常满意。在大树上不如 git 快，但也不会慢很多。我不必像 git 一样每隔一个命令就查阅文档，从而弥补任何损失的时间。

5.  每个操作背后都有一个久经考验的事务数据库，这一事实让我晚上睡得更好。是的，我们经历过不止一个关于 Subversion 存储库陈旧和损坏的可怕事件（谢天谢地，一个乐于助人的社区帮助我们修复了它们。）我无法想象在 Fossil 中会发生这种情况。甚至 Subversion 1.7.x 现在也使用 SQLite 来存储元数据。（尝试在 git 提交期间关闭电源 - 它会留下损坏的存储库！）

6.  显然，集成的问题跟踪器和 wiki 是可选的，但非常方便，因为它始终存在 - 无需安装。我希望问题跟踪器有更多的功能，但是嘿 - 它是一个 SCM。

7.  内置的服务器和 web gui 非常出色，并且可以通过 css 进行配置。

8.  我们有时需要从 git 和 subversion 存储库导入和导出。这在 Fossil 中是显而易见的。

9.  单个文件存储库。到处都没有“.svn”目录。

我想念/不喜欢 Fossil 的地方：

1.  有人请为我们的非技术 Windows 用户写 TortoiseFossil :)

2.  社区还没有那么大，所以很多人可能很难在他们的公司中介绍它。希望这会改变，获得大型社区的所有好处（文档，对新版本的更多测试等）

3.  我希望本地 web ui 具有搜索功能（包括搜索文件内容）。

4.  与 git 相比，合并选项更少（尽管 Fossil 工作流程一开始就不太可能发生合并。）

我希望每个人都试一试 Fossil——世界是一个更美好的地方，有一些有用的东西，*你*不需要成为火箭科学家就可以使用这些东西。

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2010-10-10T14:37:35.367

Fossil 小巧、简单，但功能强大且健壮，让我想起了 C 文化的一些原则。受到那些独立开发但仍然合作的人的喜爱。任何伟大的项目都应该从原则开始，并在收集更多层（GUI、额外功能）时将其作为核心继续。

我对 Fossil 印象深刻，并开始使用……看看[化石](http://www.fossil-scm.org/index.html/doc/tip/www/index.wiki)

干杯

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2010-01-20T10:06:50.313

在上一篇文章发布一年后，我登陆了这个页面，这里提到的递归添加现在已经处理好了。

Fossil 让我着迷，特别是在我努力让一个错误跟踪系统与 mercurial 一起工作之后。我需要了解如何管理多个项目、发布存储库以供多用户访问以及如何进行合并、管理补丁等。我觉得这不会令人失望。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2009-01-20T15:40:17.287

我对将它用于源代码版本控制不感兴趣，但我对可以在我使用的所有机器之间同步的分布式版本控制的个人 wiki 感兴趣。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-11-05T16:51:08.137

达米安，

1/ 是的，fossil 不支持递归添加。但是有一些相当简单的解决方法，例如

```
for /r %i in (*.*) do fossil add "%i" 
```

在 Windows 上，以及

```
find . -type f -print0 | xargs -0 fossil add -- 
```

在 Unix 上。

2/ 当您在文件名中添加包含非 ASCII 字符的文件时，我看到了有关格式错误的清单的消息。该问题已在上次构建中得到纠正。

问候，彼得

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2010-02-05T01:09:29.480

我觉得化石真的很酷。对我来说最重要的功能是易于安装和对开发人员友好的默认设置。我目前使用它来跟踪我的文件的本地更改。（我们的项目托管在 sourceforge 中并在 CVS 中进行跟踪。）这样我可以在本地“提交”，即使它会破坏项目，因此也可以跟踪较小的更改。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2010-09-18T01:48:07.167

化石不错。它简单易用。如果fossil可以提供GUI界面签入和签出，那就更好了（首选java gui归档跨平台GUI）。

Fossil 的主要优点是“开源”和“使用 SQLite 数据库”，因此有人可以编译化石源代码，使化石在 google android 平台（移动和平板设备）上工作。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-26T22:40:48.410

我现在正在尝试你的 vcs。我喜欢将所有内容整合在一起的想法。毕竟，当我寻找这样的系统时，这就是我想要的。我是 Mercurial 的活跃用户。而且我找不到与问题跟踪器的集成（我过去尝试使用 mercurial 设置 p Trac 失败）。经过一些测试，我意识到：1）“添加”命令不是递归的，或者我在文档中找不到执行此操作的方法 2）我编写了一个 bat（我使用 Windows）来添加 750 个文件并运行它（花了一段时间）。当运行提交时，它会以“manifest malformed”跳转

[我认为您可以解决这个问题，其他人可以在https://www.mercurial-scm.org/wiki/UserSurvey](https://www.mercurial-scm.org/wiki/UserSurvey)中进行类似 Mercurial 的调查。你可以在 dnoseda 的 gmail 给我写信

我对你的工作很感兴趣。不断改进它。

问候

ps.：作为市长改进，您可以添加类似 gitstat 的内容

* * *

## 回答 #10

> 赞同：-10
> 
> 时间：2008-10-03T05:30:02.467

也许是没有受过教育的下意识反应，但是将存储库存储在像 SQLite 数据库这样的二进制 blob 中的想法让我感到恐惧。我也怀疑直接在 VCS 中包含 wiki 和 bug 跟踪器的好处——与 Trac 等完整软件相比，它们的功能不足，或者与 Subversion 或 Bazaar 相比，VCS 非常臃肿。

# encoding - ELF 中的 NEEDED 条目是否有标准编码？

> ID：156327
> 
> 赞同：3
> 
> 时间：2008-10-01T05:24:10.970
> 
> 标签：encoding, binary, elf

我正在尝试使我的一些代码对非纯 ascii 系统更加友好，并且想知道是否有特定的字符编码用于 ELF 二进制文件中的 NEEDED 条目，或者它是否相当不标准并且基于创建系统的文件系统编码（甚至直接传递给创建二进制文件的字节）（如果是这样，二进制文件中是否有任何地方指定编码？假设我认为当前的系统编码对我的使用效果不佳） ，非ascii名称几乎被禁止还是其他什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-01T05:45:09.033

ELF 格式将 NEEDED 字段指定为“以空字符结尾的字符串”，并且没有说明更多关于编码的信息，这几乎暗示了 8 位 ASCII 字符串。

我个人认为复杂的可执行文件格式规范没有任何意义，因为它不会为最终产品或开发过程提供任何附加价值：用户不会看到库名称，因此他们不会关心其本地化。您*可以*尝试使用 UTF-8，但不保证实际的文件系统编码是 UTF-8。为确保您需要知道目标链接器如何处理这些字符串。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-01T05:34:03.333

据我所知，处理非 ASCII 字符的标准 Unix 方法是将它们编码为 UTF-8。

# sql - oracle数字格式上不需要的前导空格

> ID：156329
> 
> 赞同：18
> 
> 时间：2008-10-01T05:24:23.543
> 
> 标签：sql, oracle

我需要用前导零（共 8 位）填充数字以进行显示。我正在使用甲骨文。

```
select to_char(1011,'00000000') OPE_NO from dual;
select length(to_char(1011,'00000000')) OPE_NO from dual; 
```

我得到的不是“00001011”，而是“00001011”。为什么我会得到一个额外的前导空格？完成此操作的正确数字格式字符串是什么？

PS我意识到我可以使用`trim()`，但我想更好地理解数字格式。

@Eddie：我已经阅读了文档。但是我仍然不明白如何摆脱领先的空白。

@David：这是否意味着除了使用之外别无他法`trim()`？

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2008-10-01T08:11:33.347

使用 FM（填充模式），例如

`select to_char(1011,'FM00000000') OPE_NO from dual;`

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-01T05:40:48.170

[从EddieAwad](https://stackoverflow.com/questions/156329/unwanted-leading-blank-space-on-oracle-number-format#156351)提到的同一[文档](http://download.oracle.com/docs/cd/B28359_01/server.111/b28286/sql_elements004.htm#SQLRF00211)中：

> 负返回值自动包含前导负号，正值自动包含前导空格，除非格式模型包含 MI、S 或 PR 格式元素。

* * *

**编辑**：正确的方法是使用 FM 修饰符，正如史蒂夫博斯曼所回答的那样。阅读有关[格式模型修饰符](http://download.oracle.com/docs/cd/B28359_01/server.111/b28286/sql_elements004.htm#i170559)的部分以获取更多信息。

# python - 在 Python 中获取计时器刻度

> ID：156330
> 
> 赞同：41
> 
> 时间：2008-10-01T05:24:38.333
> 
> 标签：python, timer

我只是想计时一段代码。伪代码如下所示：

```
start = get_ticks()
do_long_code()
print "It took " + (get_ticks() - start) + " seconds." 
```

这在 Python 中看起来如何？

更具体地说，我如何获得自午夜以来的滴答数（或者 Python 组织该时间）？

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2008-10-01T12:49:11.290

在该`time`模块中，有两个计时功能：`time`和`clock`。`time`给你“墙”时间，如果这是你关心的。

但是，python[文档](http://docs.python.org/lib/module-time.html)说`clock`应该用于基准测试。请注意，`clock`在不同的系统中表现不同：

*   在 MS Windows 上，它使用 Win32 函数 QueryPerformanceCounter()，“分辨率通常优于微秒”。它没有特殊含义，它只是一个数字（它在您第一次调用`clock`进程时开始计数）。

```
    # 毫秒窗口
    t0=time.clock()
    做点什么（）
    t= time.clock() - t0 # t 是经过的墙壁秒数（浮点数）

```

*   在 *nix 上，`clock`报告 CPU 时间。现在，这是不同的，并且很可能是您想要的值，因为您的程序几乎不是唯一请求 CPU 时间的进程（即使您没有其他进程，内核也会不时使用 CPU 时间）。因此，这个数字通常小于墙上时间（即 time.time() - t0），在对代码进行基准测试时更有意义：

```
    # linux
    t0=time.clock()
    做点什么（）
    t= time.clock() - t0 # t 是经过的 CPU 秒数（浮点数）

```

除此之外，[timeit](http://docs.python.org/lib/module-timeit.html)模块有一个`Timer`类，该类应该使用最适合从可用功能进行基准测试的方法。

¹ 除非线程碍事……</p>

² Python≥3.3：有[`time.perf_counter()`和`time.process_time()`](http://www.python.org/dev/peps/pep-0418/#id18). `perf_counter`正在被`timeit`模块使用。

* * *

## 回答 #2

> 赞同：31
> 
> 时间：2008-10-01T05:27:03.413

您需要的是模块中的`time()`功能`time`：

```
import time
start = time.time()
do_long_code()
print "it took", time.time() - start, "seconds." 
```

不过，您可以使用[timeit](http://docs.python.org/lib/module-timeit.html)模块获得更多选项。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2012-11-09T01:05:48.867

这是我最近开始使用的解决方案：

```
class Timer:
    def __enter__(self):
        self.begin = now()

    def __exit__(self, type, value, traceback):
        print(format_delta(self.begin, now())) 
```

你像这样使用它（你至少需要 Python 2.5）：

```
with Timer():
    do_long_code() 
```

当您的代码完成时，Timer 会自动打印出运行时间。甜的！如果我想在 Python 解释器中快速调整某些东西，这是最简单的方法。

这是“now”和“format_delta”的示例实现，尽管您可以随意使用您喜欢的时间和格式化方法。

```
import datetime

def now():
    return datetime.datetime.now()

# Prints one of the following formats*:
# 1.58 days
# 2.98 hours
# 9.28 minutes # Not actually added yet, oops.
# 5.60 seconds
# 790 milliseconds
# *Except I prefer abbreviated formats, so I print d,h,m,s, or ms. 
def format_delta(start,end):

    # Time in microseconds
    one_day = 86400000000
    one_hour = 3600000000
    one_second = 1000000
    one_millisecond = 1000

    delta = end - start

    build_time_us = delta.microseconds + delta.seconds * one_second + delta.days * one_day

    days = 0
    while build_time_us > one_day:
        build_time_us -= one_day
        days += 1

    if days > 0:
        time_str = "%.2fd" % ( days + build_time_us / float(one_day) )
    else:
        hours = 0
        while build_time_us > one_hour:
            build_time_us -= one_hour
            hours += 1
        if hours > 0:
            time_str = "%.2fh" % ( hours + build_time_us / float(one_hour) )
        else:
            seconds = 0
            while build_time_us > one_second:
                build_time_us -= one_second
                seconds += 1
            if seconds > 0:
                time_str = "%.2fs" % ( seconds + build_time_us / float(one_second) )
            else:
                ms = 0
                while build_time_us > one_millisecond:
                    build_time_us -= one_millisecond
                    ms += 1
                time_str = "%.2fms" % ( ms + build_time_us / float(one_millisecond) )
    return time_str 
```

如果您有首选的格式化方法，或者是否有更简单的方法来完成所有这些，请告诉我！

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-01T05:28:59.007

```
import datetime

start = datetime.datetime.now()
do_long_code()
finish = datetime.datetime.now()
delta = finish - start
print delta.seconds 
```

从午夜开始：

```
import datetime

midnight = datetime.datetime.now().replace(hour=0, minute=0, second=0, microsecond=0)
now = datetime.datetime.now()
delta = now - midnight
print delta.seconds 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-01T05:31:01.857

python 中的[time 模块](http://docs.python.org/lib/module-time.html)使您可以访问 clock() 函数，该函数以秒为单位返回时间作为浮点数。

不同的系统将根据其内部时钟设置（每秒滴答声）具有不同的精度，但通常至少低于 20 毫秒，在某些情况下优于几微秒。

-亚当

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2016-02-27T20:51:06.233

如果您有许多要计时的语句，则可以使用以下内容：

```
class Ticker:
    def __init__(self):
        self.t = clock()

    def __call__(self):
        dt = clock() - self.t
        self.t = clock()
        return 1000 * dt 
```

然后您的代码可能如下所示：

```
tick = Ticker()
# first command
print('first took {}ms'.format(tick())
# second group of commands
print('second took {}ms'.format(tick())
# third group of commands
print('third took {}ms'.format(tick()) 
```

这样你就不需要`t = time()`在每个块之前和`1000 * (time() - t)`之后输入，同时仍然可以控制格式（尽管你也可以很容易地把它放进去`Ticket`）。

这是一个最小的收益，但我认为这很方便。

# ms-access - 删除数据库内容后 MS Access(.mdb) 文件大小不会减小吗？

> ID：156331
> 
> 赞同：29
> 
> 时间：2008-10-01T05:25:02.387
> 
> 标签：ms-access

我正在使用 JDBC-ODBC 驱动程序将数据插入 MS Access 数据库。空白 mdb 文件为 2KB。填充此数据库后，大小增加到 155MB。然后我正在删除数据。但是我发现 mdb 的大小仍然是 155MB。我没有收到任何错误。但是这样正常吗？我希望文件大小会减小。如果是这样设计的，它背后的想法是什么？谢谢

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2008-10-01T05:32:10.263

在您压缩数据库之前，MS Access 不会回收记录空间。

作为定期维护的一部分，您应该对访问数据库执行此操作，否则您最终会遇到一些非常痛苦的问题。

您可以通过 MS Access UI（工具 -> 数据库实用程序 ->
压缩和修复数据库）压缩数据库，您可以使用以下命令提示符：

```
msaccess.exe "target database.accdb" /compact 
```

注意 /Compact 开关必须在目标数据库之后

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2008-10-01T05:30:42.140

即使在删除记录后，MS Access 也不会释放记录使用的空间。您可以在需要时手动释放空间，也可以在每次关闭应用程序时自动释放空间。

要手动执行此操作，请使用压缩和修复实用程序：

1.  备份您的数据库，因为[Access 2007](http://blogs.msdn.com/access/archive/2008/05/29/kb-article-950812-compact-and-repair-might-delete-your-database-access-2007.aspx)中的一个错误可能会在压缩过程中删除您的数据库。

2.  如果您正在压缩位于服务器或共享文件夹上的多用户（共享）数据库，请确保没有其他人打开它。

3.  在工具菜单上，指向数据库实用程序，然后单击压缩和修复数据库。

要在您关闭应用程序时自动执行此操作：

1.  打开您希望 MS Access 自动压缩的数据库。

2.  在工具菜单上，单击选项，然后选择常规选项卡。

3.  选中关闭时压缩复选框。

删除数据并压缩数据库后，如果仍然大于 100 KB，请不要感到惊讶。第一次添加数据后，有一定的开销无法消除。

此外，请注意 AutoNumber 字段值的行为与压缩过程后公布的不同：根据 MS Access 2000 文档，如果您从具有 AutoNumber 字段的表的末尾删除记录，则压缩数据库会重置 AutoNumber 值。因此，您添加的下一条记录的自动编号值将比表中最后一条未删除记录的自动编号值大一。

我*没有*发现这种情况：如果您有 100 条自动编号记录并删除最后 50 条，则下一条自动编号记录（根据文档）应编号为“51”。但根据我的经验，它的编号是“101”。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-05-22T11:14:07.910

如前所述，第一站应该是尝试压缩/修复数据库。但是，您还可以通过创建新数据库并从旧数据库导入所有对象来节省一些大小。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-02-17T10:32:52.427

您可以使用 JRO 从代码中压缩数据库。请参阅：http: [//support.microsoft.com/kb/230501](http://support.microsoft.com/kb/230501)

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-05-17T09:47:26.780

如前所述，第一站应该是尝试压缩/修复数据库。但是，您还可以通过创建新数据库并从旧数据库导入所有对象来节省一些大小。除此之外，将其转换为 MDE 应该会让您多发一些。与往常一样，不要玩弄你的生产副本。此外，如果您使用 MDE，请确保首先正确拆分数据库。（当然，如果您将来需要进行修改，请保留源 MDB 的副本。）

# .net - 是否需要在 GAC 中安装 (.net) COM+ 程序集？

> ID：156338
> 
> 赞同：13
> 
> 时间：2008-10-01T05:27:54.377
> 
> 标签：.net, gac, com+

我有一个 .net 程序集，其中有一个 COM+ ServicedCopmonent，目前我将它安装到 GAC 中以使一切正常。这意味着我还需要在 GAC 中拥有它引用的每个程序集。

在开发过程中，对这些程序集进行更改、将它们重新安装到 GAC 并进行测试是非常痛苦的。

是否可以维护 COM+ 组件但在 GAC 中没有所有内容？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-01T05:31:15.383

不，您不必在 GAC 中安装它。您可以使用带有 /appdir 参数的 regsvcs ( [http://msdn.microsoft.com/en-us/library/04za0hca.aspx](http://msdn.microsoft.com/en-us/library/04za0hca.aspx) ) 来明确指定应用程序所在的位置。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-01T05:35:25.827

不，他们需要使用 regsvcs 工具在注册表中注册。它需要是一个强命名的程序集。

# flash - flash: for 循环运行缓慢

> ID：156356
> 
> 赞同：5
> 
> 时间：2008-10-01T05:37:33.370
> 
> 标签：flash, optimization, loops

我有一个关于闪存循环的问题......

在一个瓷砖游戏中，我正在制作一个包含整个关卡的迷你地图。它呈现地图的方式是一个在另一个 for 循环中带有一个 for 循环的函数。它循环遍历每个图块位置并附加一个地图块（基本上是一个 3x3 像素正方形），该图块根据图块的颜色进行着色。无论如何，我的问题是当关卡变得像 50x50 瓷砖一样大时，地图重新绘制需要永远（最多 3 秒）。有没有什么办法解决这一问题？或者有没有其他方法可以做小地图？？如果关卡越来越大，可能需要 10 秒！

任何帮助表示赞赏！

谢谢，马特

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-01T06:01:48.273

Flash 渲染图块的速度不是很快。它非常适合将不改变的图形存储在缓冲区中并快速显示此缓冲区。每个作为子对象添加到舞台的图形对象（或精灵）都必须独立渲染。

您的问题是 flash 必须每帧绘制 50x50 = 2500 个图块！即使它们是 3x3 像素，flash 仍将它们视为单独的对象。

如果您可以将所有内容存储在缓冲区或一个对象中并显示出来，那就太好了。所以尝试在同一个对象而不是多个对象中绘制这些 3x3 瓷砖。但是，这可能会妨碍您的功能，因为整个对象必须在每一帧重新渲染。

其他一些建议可能是将对象呈现在网格上较大的单元格中。不是 50x50，而是从 10x10 开始，然后在每个单元格中绘制 5x5 个单元格。这可能会加快速度。

希望这可以帮助。如果您找到好的解决方案，请发布！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-01T14:32:20.950

是的。循环本身并不需要很长时间。但在每次迭代中，我都会从库中附加一个movieClip。顺便说一句，它不会在 enterFrame 上执行此操作，就在用户按下暂停（空格）时。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-01T18:54:03.567

很可能是（如此处所述）您的循环很慢。计数 0-2500 确实很快，但如果您在每次迭代中进行大量计算，它会加起来。当然，如果没有看到代码，我们将无法帮助您。虽然你可以做一些技巧来让同一个循环运行得更流畅（比如在多个帧上运行它），但是如果它是一个 3 秒的循环，你可能可以做很多事情来优化它——甚至可能达到它运行得足够流畅的程度，这样就不会造成太长的打嗝。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-01T05:46:24.613

循环本身运行应该不会花费很长时间，但是您在每个循环中到底在做什么呢？附加和着色地图块的操作是什么？

-亚当

# python - 从线程队列中获取所有项目

> ID：156360
> 
> 赞同：16
> 
> 时间：2008-10-01T05:40:06.080
> 
> 标签：python, multithreading, queue

我有一个线程将结果写入队列。

在另一个线程（GUI）中，我定期（在 IDLE 事件中）检查队列中是否有结果，如下所示：

```
def queue_get_all(q):
    items = []
    while 1:
        try:
            items.append(q.get_nowait())
        except Empty, e:
            break
    return items 
```

这是一个好方法吗？

**编辑：**

> 我问是因为有时等待线程会卡住几秒钟而没有取出新结果。

“卡住”的问题原来是因为我在空闲事件处理程序中进行处理，而没有确保这些事件实际上是通过调用生成的`wx.WakeUpIdle`，如建议的那样。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-10-01T07:25:30.087

如果您总是将所有可用的项目从队列中拉出，那么使用队列而不只是一个带锁的列表有什么真正意义吗？IE：

```
from __future__ import with_statement
import threading

class ItemStore(object):
    def __init__(self):
        self.lock = threading.Lock()
        self.items = []

    def add(self, item):
        with self.lock:
            self.items.append(item)

    def getAll(self):
        with self.lock:
            items, self.items = self.items, []
        return items 
```

如果您还单独拉取它们，并利用空队列的阻塞行为，那么您应该使用 Queue，但您的用例看起来要简单得多，上述方法可能会更好地服务。

**[Edit2]** 我错过了您从空闲循环轮询队列的事实，并且从您的更新中，我发现问题与争用无关，因此以下方法与您的问题并不真正相关. 我把它留了下来，以防有人发现这个有用的阻塞变体：

对于您确实希望在获得至少一个结果之前阻塞的情况，您可以修改上述代码以通过生产者线程发出信号来等待数据可用。例如。

```
class ItemStore(object):
    def __init__(self):
        self.cond = threading.Condition()
        self.items = []

    def add(self, item):
        with self.cond:
            self.items.append(item)
            self.cond.notify() # Wake 1 thread waiting on cond (if any)

    def getAll(self, blocking=False):
        with self.cond:
            # If blocking is true, always return at least 1 item
            while blocking and len(self.items) == 0:
                self.cond.wait()
            items, self.items = self.items, []
        return items 
```

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2014-09-10T14:36:49.580

我认为将所有项目从队列中取出的最简单方法如下：

```
def get_all_queue_result(queue):

    result_list = []
    while not queue.empty():
        result_list.append(queue.get())

    return result_list 
```

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-10-01T08:45:02.640

`get_nowait()`如果列表为空时调用不返回而导致暂停，我会感到非常惊讶。

可能是您在检查之间发布了大量（可能很大？）项目，这意味着接收线程有大量数据要从中提取`Queue`？您可以尝试限制一批检索的数量：

```
def queue_get_all(q):
    items = []
    maxItemsToRetrieve = 10
    for numOfItemsRetrieved in range(0, maxItemsToRetrieve):
        try:
            if numOfItemsRetrieved == maxItemsToRetrieve:
                break
            items.append(q.get_nowait())
        except Empty, e:
            break
    return items 
```

这将限制接收线程一次最多拉出 10 个项目。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2019-04-04T15:05:01.380

最简单的方法是使用列表推导：

```
items = [q.get() for _ in range(q.qsize())] 
```

该`range`功能的使用通常不受欢迎，但我还没有找到更简单的方法。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2015-02-17T21:05:44.517

如果您已完成对队列的写入，则 qsize 应该可以解决问题，而无需检查每次迭代的队列。

```
responseList = []
for items in range(0, q.qsize()):
    responseList.append(q.get_nowait()) 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-01T06:12:36.267

我看到您正在使用 get_nowait() 根据文档，“如果一个项目立即可用，则返回 [s] 一个项目，否则引发空异常”

现在，当抛出 Empty 异常时，您碰巧跳出循环。因此，如果队列中没有立即可用的结果，您的函数将返回一个空项目列表。

您是否有理由不使用 get() 方法？可能会出现 get_nowait() 失败的情况，因为队列在同一时刻正在为 put() 请求提供服务。

# ruby - Ruby中的include和extend有什么区别？

> ID：156362
> 
> 赞同：457
> 
> 时间：2008-10-01T05:40:58.463
> 
> 标签：ruby, module, include, extend

只是让我了解 Ruby 元编程。mixin/modules 总是让我感到困惑。

*   **include** : 混合指定的模块方法作为目标类中的**实例方法**
*   **extend** : 混合指定的模块方法作为目标类中的**类方法**

*那么主要的区别仅仅是这个还是潜伏着更大的龙？* 例如

```
module ReusableModule
  def module_method
    puts "Module Method: Hi there!"
  end
end

class ClassThatIncludes
  include ReusableModule
end
class ClassThatExtends
  extend ReusableModule
end

puts "Include"
ClassThatIncludes.new.module_method       # "Module Method: Hi there!"
puts "Extend"
ClassThatExtends.module_method            # "Module Method: Hi there!" 
```

* * *

## 回答 #1

> 赞同：368
> 
> 时间：2011-02-15T19:10:25.460

**扩展**- 将指定模块的方法和常量添加到目标的元类（即单例类），例如

*   如果你打电话`Klazz.extend(Mod)`，现在 Klazz 有 Mod 的方法（作为类方法）
*   如果您调用`obj.extend(Mod)`，现在 obj 具有 Mod 的方法（作为实例方法），但没有其他实例`obj.class`添加这些方法。
*   `extend`是公共方法

**include** - 默认情况下，它混​​合指定模块的方法作为目标模块/类中的实例方法。例如

*   如果你调用`class Klazz; include Mod; end;`，现在 Klazz 的所有实例都可以访问 Mod 的方法（作为实例方法）
*   `include`是一个私有方法，因为它打算从容器类/模块中调用。

**但是**，模块经常通过猴子修补方法来*覆盖的行为。* 这在遗留 Rails 代码中非常突出。[来自 Yehuda Katz 的更多详细信息](http://yehudakatz.com/2009/11/12/better-ruby-idioms/)。`include``included`

假设您已运行以下代码，则有关 的更多详细信息`include`及其默认行为

```
class Klazz
  include Mod
end 
```

*   如果 Mod 已经包含在 Klazz 或其祖先之一中，则 include 语句无效
*   它还包括 Mod 在 Klazz 中的常量，只要它们不冲突
*   它使 Klazz 可以访问 Mod 的模块变量，例如`@@foo`或`@@bar`
*   如果存在循环包含，则引发 ArgumentError
*   将模块附加为调用者的直接祖先（即，它将 Mod 添加到 Klazz.ancestors，但 Mod 未添加到 Klazz.superclass.superclass.superclass 的链中。因此，调用`super`Klazz#foo 将在检查之前检查 Mod#foo到 Klazz 的真正超类的 foo 方法。有关详细信息，请参阅 RubySpec。）。

当然，[ruby 核心文档](http://www.ruby-doc.org/core-1.9.3/)始终是这些东西的最佳去处。[RubySpec 项目](https://en.wikipedia.org/wiki/RubySpec)也是一个很棒的资源，因为他们准确地记录了功能。

*   `#include` [RubySpec](https://github.com/ruby/rubyspec/blob/master/core/module/include_spec.rb) [ruby​​doc](http://www.ruby-doc.org/core-1.9.3/Module.html#method-i-include)
*   `#included` [RubySpec](https://github.com/ruby/rubyspec/blob/master/core/module/included_spec.rb) [ruby​​doc](http://www.ruby-doc.org/core-1.9.3/Module.html#method-i-included)
*   `#extend` [RubySpec](https://github.com/ruby/rubyspec/blob/master/core/kernel/extend_spec.rb) [ruby​​doc](http://www.ruby-doc.org/core-1.9.3/Object.html#method-i-extend)
*   `#extended` [RubySpec](https://github.com/ruby/rubyspec/blob/master/core/module/extended_spec.rb) [ruby​​doc](http://www.ruby-doc.org/core-1.9.3/Module.html#method-i-extended)
*   `#extend_object` [RubySpec](https://github.com/ruby/rubyspec/blob/master/core/module/extend_object_spec.rb) [ruby​​doc](http://www.ruby-doc.org/core-1.9.3/Module.html#method-i-extend_object)
*   `#append_features` [RubySpec](https://github.com/ruby/rubyspec/blob/master/core/module/append_features_spec.rb) [ruby​​doc](http://www.ruby-doc.org/core-1.9.3/Module.html#method-i-append_features)

* * *

## 回答 #2

> 赞同：273
> 
> 时间：2008-10-01T09:59:38.203

你说的是对的。然而，它的意义远不止于此。

如果你有一个 class`Klazz`和 module `Mod`，包括`Mod`in`Klazz`提供`Klazz`访问`Mod`'s 方法的实例。或者您可以`Klazz`通过`Mod`授予*类* `Klazz`访问`Mod`'s 方法的权限进行扩展。但您也可以使用 . 扩展任意对象`o.extend Mod`。在这种情况下，`Mod`即使具有相同类的所有其他对象`o`都没有，单个对象也会获得 's 方法。

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2008-10-01T08:08:30.777

这是正确的。

在幕后， include 实际上是**append_features**的别名，它（来自文档）：

> 如果此模块尚未添加到 aModule 或其祖先之一，则 Ruby 的默认实现是将此模块的常量、方法和模块变量添加到 aModule。

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2019-09-20T05:40:33.623

当您**`include`**将模块导入类时，模块方法将作为**实例方法**导入。

但是，当您**`extend`**将模块导入类时，模块方法将作为**类方法**导入。

例如，如果我们有一个模块`Module_test`定义如下：

```
module Module_test
  def func
    puts "M - in module"
  end
end 
```

现在，对于**`include`**模块。如果我们定义类`A`如下：

```
class A
  include Module_test
end

a = A.new
a.func 
```

输出将是：`M - in module`。

如果我们将该行替换为`include Module_test`并`extend Module_test`再次运行代码，我们会收到以下错误：`undefined method 'func' for #<A:instance_num> (NoMethodError)`.

将方法调用更改`a.func`为`A.func`，输出更改为：`M - in module`。

从上面的代码执行中可以清楚地看出，当我们**`include`**是一个模块时，它的方法变成了**实例方法**，当我们**`extend`**是一个模块时，它的方法变成了**类方法**。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2011-09-22T21:02:06.940

所有其他答案都很好，包括挖掘 RubySpecs 的提示：

[https://github.com/rubyspec/rubyspec/blob/master/core/module/include_spec.rb](https://github.com/rubyspec/rubyspec/blob/master/core/module/include_spec.rb)

[https://github.com/rubyspec/rubyspec/blob/master/core/module/extend_object_spec.rb](https://github.com/rubyspec/rubyspec/blob/master/core/module/extend_object_spec.rb)

至于用例：

如果在 ClassThatIncludes 类中*包含模块 ReusableModule，则会引用方法、常量、类、子模块和其他声明。*

如果您使用模块 ReusableModule*扩展*类 ClassThatExtends，则方法和常量将被*复制*。显然，如果不小心，动态复制定义会浪费大量内存。

如果您使用 ActiveSupport::Concern，.included() 功能可以让您直接重写包含类。Concern 中的模块 ClassMethods 被*扩展*（复制）到包含类中。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2016-03-27T12:11:02.673

我还想解释一下它的工作机制。如果我说的不对请指正。

当我们使用时，`include`我们正在添加从我们的类到包含一些方法的模块的链接。

```
class A
include MyMOd
end

a = A.new
a.some_method 
```

对象没有方法，只有类和模块有。因此，当`a`接收到消息时，它会在的 eigen 类中`some_method`开始搜索方法，然后在类中，然后在链接到类模块（如果有的话）中（以相反的顺序，最后包含的获胜）。`some_method``a``A``A`

当我们使用时，`extend`我们正在向对象的特征类中的模块添加链接。因此，如果我们使用 A.new.extend(MyMod)，我们正在将模块的链接添加到 A 的实例特征类或`a'`类。如果我们使用 A.extend(MyMod) 我们正在添加到 A(object's, classes are also objects) eigenclass 的链接`A'`。

所以方法查找路径`a`如下：a => a' => 将模块链接到 a' 类 => A.

还有一个 prepend 方法可以改变查找路径：

a => a' => 将模块添加到 A => A => 包含模块到 A

对不起，我的英语不好。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2021-11-26T12:25:58.633

我遇到了一篇非常有用的[文章](https://dev.to/abbiecoghlan/ruby-modules-include-vs-extend-vs-prepend-4gmc)，它比较**了类**`include`中使用`extend`的`prepend`方法：

 **`include`将模块方法作为实例方法添加到类中，而`extend`将模块方法添加为类方法。必须相应地定义被包含或扩展的模块

# recursion - 哪些语言支持*递归*函数文字/匿名函数？

> ID：156369
> 
> 赞同：16
> 
> 时间：2008-10-01T05:46:48.420
> 
> 标签：recursion, language-features, anonymous-function, function-literal, letrec

如今，似乎有不少主流语言支持[函数文字](http://en.wikipedia.org/wiki/First-class_function)。它们也被称为[匿名函数](http://en.wikipedia.org/wiki/Anonymous_function)，但我不在乎它们是否有名字。重要的是，函数文字是一个表达式，它产生一个尚未在其他地方定义的函数，例如在 C 中，`&printf`不计算在内。

编辑添加：如果你有一个真正的函数文字表达式`<exp>`，你应该能够将它传递给一个函数`f(<exp>)`或立即将它应用于一个参数，即。`<exp>(5)`.

我很好奇哪些语言可以让你编写*递归*的函数文字。维基百科的“[匿名递归](http://en.wikipedia.org/wiki/Anonymous_recursion)”文章没有给出任何编程示例。

让我们以递归阶乘函数为例。

以下是我知道的：

*   JavaScript / ECMAScript 可以做到这一点`callee`：

    ```
    function(n){if (n<2) {return 1;} else {return n * arguments.callee(n-1);}} 
    ```

*   在语言中很容易使用`letrec`，例如 Haskell（它叫它`let`）：

    > `let fac x = if x<2 then 1 else fac (x-1) * x in fac`

    在 Lisp 和 Scheme 中有等价物。请注意， 的绑定`fac`是表达式的局部变量，因此整个表达式实际上是一个匿名函数。

还有其他人吗？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-10-01T05:59:12.540

大多数语言通过使用[Y 组合器](http://en.wikipedia.org/wiki/Fixed_point_combinator#Y_combinator)来支持它。这是 Python 中的一个示例（来自[食谱](http://code.activestate.com/recipes/576366/)）：

```
# Define Y combinator...come on Gudio, put it in functools!
Y = lambda g: (lambda f: g(lambda arg: f(f)(arg))) (lambda f: g(lambda arg: f(f)(arg)))

# Define anonymous recursive factorial function
fac = Y(lambda f: lambda n: (1 if n<2 else n*f(n-1)))
assert fac(7) == 5040 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-01T06:34:31.940

**C＃**

阅读[**Wes Dyer 的**](http://blogs.msdn.com/wesdyer/archive/2007/02/02/anonymous-recursion-in-c.aspx)博客，您会发现 @Jon Skeet 的回答并不完全正确。*我不是语言天才，但递归匿名函数和“ fib 函数实际上只是调用局部变量 fib 引用的委托*”以从博客中引用是有区别的。

实际的 C# 答案如下所示：

```
delegate Func<A, R> Recursive<A, R>(Recursive<A, R> r);

static Func<A, R> Y<A, R>(Func<Func<A, R>, Func<A, R>> f)
{
    Recursive<A, R> rec = r => a => f(r(r))(a);
    return rec(rec);
}

static void Main(string[] args)
{
    Func<int,int> fib = Y<int,int>(f => n => n > 1 ? f(n - 1) + f(n - 2) : n);
    Func<int, int> fact = Y<int, int>(f => n => n > 1 ? n * f(n - 1) : 1);
    Console.WriteLine(fib(6));                          // displays 8
    Console.WriteLine(fact(6));
    Console.ReadLine();
} 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-01T06:08:48.553

你可以在 Perl 中做到这一点：

```
my $factorial = do {
  my $fac;
  $fac = sub {
    my $n = shift;
    if ($n < 2) { 1 } else { $n * $fac->($n-1) }
  };
};

print $factorial->(4); 
```

该`do`块不是绝对必要的；我包含它是为了强调结果是一个真正的匿名函数。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-01T05:50:09.940

好吧，除了您已经提到的 Common Lisp ( `labels`) 和 Scheme ( ) 之外，JavaScript 还允许您命名一个匿名函数：`letrec`

```
var foo = {"bar": function baz() {return baz() + 1;}}; 
```

这比[使用`callee`](https://stackoverflow.com/questions/62188#71964)更方便。`function`（这与顶层不同；后者会导致名称也出现在全局范围内，而在前一种情况下，名称仅出现在函数本身的范围内。）

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-10-04T21:29:26.540

在 Perl 6 中：

```
my $f = -> $n { if ($n <= 1) {1} else {$n * &?BLOCK($n - 1)} }
$f(42);  # ==> 1405006117752879898543142606244511569936384000000000 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-01T08:06:08.833

您在这里混淆了一些术语，函数文字不必是匿名的。

在 javascript 中，区别取决于函数是写成语句还是表达式。[关于这个问题](https://stackoverflow.com/questions/114525/the-difference-between-the-two-functions)的答案中的区别有一些讨论。

假设您将示例传递给函数：

```
foo(function(n){if (n<2) {return 1;} else {return n * arguments.callee(n-1);}}); 
```

这也可以写成：

```
foo(function fac(n){if (n<2) {return 1;} else {return n * fac(n-1);}}); 
```

在这两种情况下，它都是函数文字。但请注意，在第二个示例中，名称并未添加到周围的范围内——这可能会造成混淆。但这并没有被广泛使用，因为一些 javascript 实现不支持这个或者有一个错误的实现。我也读过它更慢。

匿名递归又是不同的东西，当一个函数在没有引用自身的情况下递归时，已经提到了 Y Combinator。在大多数语言中，没有必要这样做，因为有更好的方法可用。这是[一个 javascript 实现](http://w3future.com/weblog/stories/2002/02/22/javascriptYCombinator.xml)的链接。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-10-01T05:48:40.957

[F#](http://research.microsoft.com/fsharp/)有“let rec”

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-01T06:21:00.070

在 C# 中，您需要声明一个变量来保存委托，并将 null 分配给它以确保它已明确分配，*然后*您可以从分配给它的 lambda 表达式中调用它：

```
Func<int, int> fac = null;
fac = n => n < 2 ? 1 : n * fac(n-1);
Console.WriteLine(fac(7)); 
```

我*想*我听说 C# 团队正在考虑更改明确分配的规则以使单独的声明/初始化变得不必要，但我不会发誓。

每种语言/运行时环境的一个重要问题是它们是否支持尾调用。在 C# 中，据我所知，MS 编译器不使用`tail.`IL 操作码，但在​​某些情况下，JIT[*可能会*对其进行优化](http://blogs.msdn.com/davbr/pages/tail-call-jit-conditions.aspx)。显然，这很容易区分工作程序和堆栈溢出。（最好对此有更多的控制权和/或保证它何时会发生。否则，在一台机器上运行的程序可能会以难以理解的方式在另一台机器上失败。）

编辑：正如[FryHard](https://stackoverflow.com/questions/156369/which-languages-support-recursive-function-literals-anonymous-functions#156468)指出的，这只是伪递归。简单到足以完成工作，但 Y-combinator 是一种更纯粹的方法。我在上面发布的代码还有另一个警告：如果更改 的值`fac`，任何尝试使用旧值的东西都会开始失败，因为 lambda 表达式已经捕获了`fac`变量本身。（当然，为了正常工作，它必须这样做......）

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2011-08-04T22:09:57.400

似乎 Mathematica 还允许您定义递归函数`#0`来表示函数本身，如：

```
(expression[#0]) & 
```

例如阶乘：

```
fac = Piecewise[{{1, #1 == 0}, {#1 * #0[#1 - 1], True}}] &; 
```

这与`#i`引用第 i 个参数的表示法以及脚本是它自己的第 0 个参数的 shell 脚本约定一致。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-11-04T19:14:55.750

您可以在 Matlab 中使用匿名函数执行此操作，该函数使用 dbstack() 自省来获取自身的函数文字，然后对其进行评估。（我承认这是作弊，因为 dbstack 可能应该被认为是语言外的，但它在所有 Matlabs 中都可用。）

```
f = @(x) ~x || feval(str2func(getfield(dbstack, 'name')), x-1) 
```

这是一个从 x 开始倒数然后返回 1 的匿名函数。它不是很有用，因为 Matlab 缺少 ?: 运算符并且不允许匿名函数内部的 if 块，因此很难构造基本案例/递归步骤形式。

您可以通过调用 f(-1); 来证明它是递归的；它将倒数到无穷大并最终引发最大递归错误。

```
>> f(-1)
??? Maximum recursion limit of 500 reached. Use set(0,'RecursionLimit',N)
to change the limit.  Be aware that exceeding your available stack space can
crash MATLAB and/or your computer. 
```

您可以直接调用匿名函数，无需将其绑定到任何变量，只需将其直接传递给 feval。

```
>> feval(@(x) ~x || feval(str2func(getfield(dbstack, 'name')), x-1), -1)
??? Maximum recursion limit of 500 reached. Use set(0,'RecursionLimit',N)
to change the limit.  Be aware that exceeding your available stack space can
crash MATLAB and/or your computer.

Error in ==> create@(x)~x||feval(str2func(getfield(dbstack,'name')),x-1) 
```

为了使它有用，您可以创建一个单独的函数来实现递归步骤逻辑，使用“if”来保护递归案例不被评估。

```
function out = basecase_or_feval(cond, baseval, fcn, args, accumfcn)
%BASECASE_OR_FEVAL Return base case value, or evaluate next step
if cond
    out = baseval;
else
    out = feval(accumfcn, feval(fcn, args{:}));
end 
```

鉴于此，这里是阶乘。

```
recursive_factorial = @(x) basecase_or_feval(x < 2,...
    1,...
    str2func(getfield(dbstack, 'name')),...
    {x-1},...
    @(z)x*z); 
```

你可以在没有绑定的情况下调用它。

```
>> feval( @(x) basecase_or_feval(x < 2, 1, str2func(getfield(dbstack, 'name')), {x-1}, @(z)x*z), 5)
ans =
   120 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2010-05-18T15:41:07.363

匿名函数存在于带有 lambda 的 C++0x 中，它们可能是递归的，尽管我不确定匿名。

```
auto kek = [](){kek();} 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-10-01T07:21:43.073

Delphi 在 2009 版中包含匿名函数。

[来自http://blogs.codegear.com/davidi/2008/07/23/38915/](http://blogs.codegear.com/davidi/2008/07/23/38915/)的示例

```
type
  // method reference
  TProc = reference to procedure(x: Integer);               

procedure Call(const proc: TProc);
begin
  proc(42);
end; 
```

利用：

```
var
  proc: TProc;
begin
  // anonymous method
  proc := procedure(a: Integer)
  begin
    Writeln(a);
  end;               

  Call(proc);
  readln
end. 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-10-01T06:27:18.620

我认为这可能不是您想要的，但在 Lisp 中，“标签”可用于动态声明可递归调用的函数。

```
(labels ((factorial (x) ;define name and params
    ; body of function addrec
    (if (= x 1)
      (return 1)
      (+ (factorial (- x 1))))) ;should not close out labels
  ;call factorial inside labels function
  (factorial 5)) ;this would return 15 from labels 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-03-13T14:09:36.427

因为我很好奇，我实际上试图想出一种在**MATLAB**中做到这一点的方法。可以做到，但看起来有点像 Rube-Goldberg 式的：

```
>> fact = @(val,branchFcns) val*branchFcns{(val <= 1)+1}(val-1,branchFcns);
>> returnOne = @(val,branchFcns) 1;
>> branchFcns = {fact returnOne};
>> fact(4,branchFcns)

ans =

    24

>> fact(5,branchFcns)

ans =

   120 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2010-05-20T01:11:57.337

'看来你对匿名函数的理解是错误的，这不仅仅是关于运行时的创建，它也是关于范围的。考虑这个 Scheme 宏：

```
(define-syntax lambdarec
  (syntax-rules ()
    ((lambdarec (tag . params) . body)
     ((lambda ()
       (define (tag . params) . body)
        tag))))) 
```

这样：

```
(lambdarec (f n) (if (<= n 0) 1 (* n (f (- n 1))))) 
```

评估为真正的匿名递归阶乘函数，例如可以像这样使用：

```
(let ;no letrec used
    ((factorial (lambdarec (f n) (if (<= n 0) 1 (* n (f (- n 1)))))))
  (factorial 4)) ; ===> 24 
```

但是，使其匿名的真正原因是，如果我这样做：

```
((lambdarec (f n) (if (<= n 0) 1 (* n (f (- n 1))))) 4) 
```

该函数随后从内存中清除并且没有范围，因此在此之后：

```
(f 4) 
```

要么发出错误信号，要么将绑定到 f 之前绑定的任何内容。

在 Haskell 中，实现相同目的的一种特别方法是：

```
\n -> let fac x = if x<2 then 1 else fac (x-1) * x
    in fac n 
```

再次不同的是，这个函数没有作用域，如果我不使用它，Haskell 是 Lazy 的效果与空代码行相同，它是真正的字面意思，因为它与 C 代码具有相同的效果：

```
3; 
```

一个字面数字。即使我之后立即使用它，它也会消失。这就是文字函数的意义所在，而不是在运行时创建本身。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2017-01-17T16:40:05.660

Clojure 可以做到这一点，因为它`fn`需要一个专门用于此目的的可选名称（该名称不会超出定义范围）：

```
> (def fac (fn self [n] (if (< n 2) 1 (* n (self (dec n))))))
#'sandbox17083/fac
> (fac 5)
120
> self
java.lang.RuntimeException: Unable to resolve symbol: self in this context 
```

如果它恰好是尾递归，那么`recur`是一种更有效的方法：

```
> (def fac (fn [n] (loop [count n result 1]
                     (if (zero? count)
                       result
                       (recur (dec count) (* result count)))))) 
```

# svn - 内部项目：稳定发布与否？

> ID：156372
> 
> 赞同：4
> 
> 时间：2008-10-01T05:48:58.850
> 
> 标签：svn

假设您在一家中型到大型软件公司工作，该公司拥有许多独立开发的项目（独立编码器），但它们相互依赖（依赖代码）。

如果由您决定，您会确保每个项目都生成稳定的分支，以便其他项目可以更可靠地使用这些分支，还是鼓励项目直接使用其他项目的最新可用代码？

我很清楚稳定版本的优势 - 您的依赖项更有可能像广告一样工作。然而，我也看到了避免稳定发布的一些好处——每个项目要做的工作少一点，而且你可以对影响每个人的错误做出快速反应，因为你的代码一直在自动更新。例如，假设在一个内部库中的时间戳 X 处存在一个微妙的安全漏洞——在该代码被广泛使用之前，它可能不会被注意到。如果您使用的是稳定版本分支，则必须让所有其他项目修改它们的依赖关系以实现安全修复。如果没有发布分支，则在所有其他项目的下一个构建中会立即获取修复。

如果有人对这两种选择都有行业经验，我特别感兴趣。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-01T06:10:11.657

与往常一样，每个选项都有利有弊。

使用分支可能更稳定，但当您需要更新到较新的分支时，它需要更多的维护。当分支与主干合并时，还需要他们的开发团队花费额外的时间。

另一方面，使用主干可能会迫使您处理其他人的错误并编写混乱的解决方法代码来解决它。如果您遇到无法固定到特定库（或您自己的代码）的奇怪 OutOfMemory/Performance 问题，它可能会变得特别混乱。请记住，这不是您的代码，您可能没有人力来帮助他们进行 QA 工作......

所以我想最后一句话是这取决于。我建议考虑以下因素：

1.  你使用的 API 会改变吗？
2.  编写“干净的代码”重要吗？还是你可以让自己弄乱其他人的错误？
3.  应用程序使用“尖端”版本的库是否至关重要？

附带说明一下，根据经验，我可以告诉您，我们的一位程序员因为使用分支工作而错过了几个晚上的睡眠，并且升级到更新的分支改变了整个 API 和逻辑。:)

高温高压

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-01T06:01:08.540

认为它真的分解为软件的关键任务。如果您可以忍受轻微的崩溃和一些数据损坏，并且很容易推送新版本，那么运行不稳定的代码可能是首选。现在，如果生命或声誉取决于一切正常运行，或者如果推动新构建是一个主要过程，那么稳定的测试版本是唯一的出路。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-01T05:55:35.997

查看其他项目，在我看来，您提出的问题是通过拥有安全分支来解决的。例如 Debian 软件包。这样，您将继续跨项目使用稳定分支。由于您提到的原因，测试/进行中的分支带来了太大的风险。

# c++ - 使用 .reset() 释放具有唯一所有权的 boost::shared_ptr

> ID：156373
> 
> 赞同：7
> 
> 时间：2008-10-01T05:49:11.160
> 
> 标签：c++, memory-management, boost, sdl-image

我将一个对象 ( `TTF_Font`) 存储在`shared_ptr`从第三方 API 提供给我的 a 中。我不能在对象上使用 new 或 delete，因此`shared_ptr`还提供了一个“释放”函子。

```
// Functor
struct CloseFont
{
    void operator()(TTF_Font* font) const
    {
        if(font != NULL) {
            TTF_CloseFont(font);
        }
    }
};

boost::shared_ptr<TTF_Font> screenFont;

screenFont = boost::shared_ptr<TTF_Font>( TTF_OpenFont("slkscr.ttf", 8), CloseFont() ); 
```

如果稍后我需要显式释放此对象，这样做是否正确：

```
screenFont.reset(); 
```

然后让`screenFont`（实际`shared_ptr`对象）自然销毁？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-10-01T05:53:37.687

shared_ptr<>::reset() 会将引用计数减一。如果这导致计数降至零，则 shared_ptr<> 指向的资源将被释放。

所以我认为你的答案是，是的，这会奏效。或者您可以简单地让 screenFont 变量由于超出范围或其他原因而被破坏，如果这是即将发生的事情。

需要说明的是，shared_ptr<>的正常用法是让它自然销毁，当它自然降为零时它会处理refcount并释放资源。仅当您需要在 shared_ptr<> 被自然破坏之前释放该共享资源的特定实例时才需要 reset() 。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-01T05:57:00.547

Mike B 回答了你的问题，所以我将评论你的代码。如果`TTF_OpenFont`不返回空值，或者如果`TTF_CloseFont`可以无害地处理空值，则根本不需要`CloseFont`类，只需使用`&TTF_CloseFont`.

# crystal-reports - 如何防止 Crystal webserver 在每个页面上重新获取数据

> ID：156391
> 
> 赞同：2
> 
> 时间：2008-10-01T05:58:37.893
> 
> 标签：crystal-reports

我们通过他们的网络服务器使用 Crystal 11。当我们运行报表时，它会执行 Sql 查询并在 Crystal Web 报表查看器中显示报表的第一页。

当您点击下一页按钮时，它会重新运行 Sql 查询并显示下一页。

我们如何让数据的重新查询停止？

我们也有多个人同时运行相同的报表（毕竟它是一个 Web 服务器），我们不想在同一个报表的不同实例之间缓存数据，我们只想缓存每个单独的数据报告的实例。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-01-24T13:05:26.997

有分页的原因不仅仅是一个演示问题。使用分页，一个最重要的优势是延迟加载数据 - 因此理论上，根据给定的过滤器，您只加载您需要的内容。

想象一下，如果您的数据库中有数百万条记录并且您加载了所有记录。首先会慢很多，其次你要获取很多你并不真正需要的东西。现在所有的网络模型都是基于延迟加载而不是批量加载。想想 Google App Engine：您不能从 Google 数据存储中检索给定事务中的 1000 条以上的记录 - 而且您知道，如果您只尝试显示它们，您的浏览器就会死掉。

我将用一个问题结束 -**你有任何类型的性能问题**吗？

如果是这样，您可能认为您会使其变得更好，但可能并非如此，因为您将减少服务器上的负载，但每个查询都会消耗更多资源。如果不是，我的建议是不要管它！:)

# ruby - Ruby 中的方法访问

> ID：156394
> 
> 赞同：9
> 
> 时间：2008-10-01T05:59:54.770
> 
> 标签：ruby, methods

Ruby 是如何隐式地允许类外部的类访问方法的？

例子：

```
class Candy
    def land
        homer
    end
end

def homer
    puts "Hello"
end

Candy.new.land #Outputs Hello 
```

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-10-01T06:08:02.923

“homer”方法的定义是将方法添加到 Object 类中。它没有定义自由功能。

Candy 类隐式继承自 Object，因此可以访问 Object 中的方法。当你在“land”方法中调用“homer”时，方法解析在当前类中找不到定义，去超类，找到你添加到Object的方法，并调用它。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-02T22:16:49.513

一个简单的方法来找出发生了什么

1.  搜索哪些类/模块来解析 Candy 对象中使用的方法？

    p Candy.ancestors #=> [糖果、对象、内核]

2.  Candy 有叫做 homer 的方法吗？

    p Candy.instance_methods(false).grep("homer") #=> []

    p Candy.private_instance_methods(false).grep("homer") #=> []

3.  OK Candy 没有任何名为“homer”的方法。

4.  查找链中的下一步是什么（参见 1）=>“对象”

5.  Object 是否有一个名为“homer”的方法？p Object.instance_methods(false).grep("homer") #=> []

    p Object.private_instance_methods(false).grep("homer") #=> ["homer"]

*Candy 在其查找链中有对象，而对象又具有私有实例方法“homer”，因此方法解析成功*

**def 语句**总是在定义点定义 self 的类中的**方法**

1.  定义 homer 之前的*self*是什么？

    p self #=> main def homer 将“Hello”结束

2.  那么它的类型是什么？

    p self.class #=> 对象

这就是为什么*本垒打*最终出现在*Object上的原因*

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-02T06:38:59.877

~~从技术上讲，`homer`方法的定义实际上是在`Kernel`混入的模块上`Object`，而不是`Object`直接在模块上。所以当`homer`不是定义在 上的局部变量或实例方法时`Candy`，Ruby 方法继承链会跟进`Object`，然后到混入`Kernel`模块，然后运行这段代码。~~

**编辑：**对不起，我不知道我为什么这么想。看来该方法确实存在`Object`。不确定它在实践中是否有太大的不同，但我应该在发布之前确认一下。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-11-27T15:45:16.773

Ruby 没有自由浮动函数。每个方法都属于某个对象。您`def`在顶层的方法实际上正在成为 class 的实例方法`Object`。因为一切都`Object`在某种程度上，所有对象都可以访问`Object`的实例方法。

# objective-c - 在 Objective-C 中向 nil 发送消息

> ID：156395
> 
> 赞同：107
> 
> 时间：2008-10-01T06:00:47.357
> 
> 标签：objective-c

作为正在阅读 Apple 的 Objective-C 2.0 文档的 Java 开发人员：我想知道“*向 nil 发送消息*”是什么意思——更不用说它实际上有什么用处了。从文档中摘录：

> Cocoa 中有几种模式利用了这一事实。从消息返回到 nil 的值也可能是有效的：
> 
> *   如果该方法返回一个对象、任何指针类型、任何大小小于或等于 sizeof(void*) 的整数标量、float、double、long double 或 long long，则发送到 nil 的消息返回 0 .
> *   如果该方法返回一个结构，如 Mac OS X ABI 函数调用指南中定义的那样，将在寄存器中返回，则发送到 nil 的消息将为数据结构中的每个字段返回 0.0。其他结构数据类型不会用零填充。
> *   如果该方法返回上述值类型以外的任何值，则发送到 nil 的消息的返回值是未定义的。

Java 是否让我的大脑无法理解上面的解释？还是有什么我遗漏的东西可以使它像玻璃一样清晰？

我确实了解 Objective-C 中的消息/接收器，我只是对碰巧是`nil`.

* * *

## 回答 #1

> 赞同：92
> 
> 时间：2008-10-01T06:32:29.183

好吧，我认为可以用一个非常人为的例子来描述它。假设您在 Java 中有一个方法可以打印出 ArrayList 中的所有元素：

```
void foo(ArrayList list)
{
    for(int i = 0; i < list.size(); ++i){
        System.out.println(list.get(i).toString());
    }
} 
```

现在，如果您像这样调用该方法： someObject.foo(NULL); 当它试图访问列表时，你可能会得到一个 NullPointerException，在这种情况下是调用 list.size(); 现在，您可能永远不会使用这样的 NULL 值调用 someObject.foo(NULL) 。但是，您可能已经从一个返回 NULL 的方法中获取了 ArrayList，如果它在生成 ArrayList 时遇到一些错误，例如 someObject.foo(otherObject.getArrayList());

当然，如果你这样做，你也会遇到问题：

```
ArrayList list = NULL;
list.size(); 
```

现在，在 Objective-C 中，我们有等效的方法：

```
- (void)foo:(NSArray*)anArray
{
    int i;
    for(i = 0; i < [anArray count]; ++i){
        NSLog(@"%@", [[anArray objectAtIndex:i] stringValue];
    }
} 
```

现在，如果我们有以下代码：

```
[someObject foo:nil]; 
```

我们有同样的情况，Java 会产生 NullPointerException。nil 对象将首先在 [anArray count] 处被访问。但是，Objective-C 不会抛出 NullPointerException，而是按照上面的规则简单地返回 0，因此循环不会运行。但是，如果我们将循环设置为运行一定次数，那么我们首先在 [anArray objectAtIndex:i] 处向 anArray 发送消息；这也将返回 0，但是由于 objectAtIndex: 返回一个指针，并且指向 0 的指针是 nil/NULL，因此 NSLog 每次循环都会传递 nil。（虽然 NSLog 是一个函数而不是一个方法，但如果传递一个 nil NSString，它会打印出 (null)。

在某些情况下，最好有一个 NullPointerException，因为您可以立即判断程序有问题，但除非您捕获该异常，否则程序将崩溃。（在 C 中，尝试以这种方式取消引用 NULL 会导致程序崩溃。）在 Objective-C 中，它只会导致可能不正确的运行时行为。但是，如果您有一个在返回 0/nil/NULL/零结构时不会中断的方法，那么这将使您不必检查以确保对象或参数为零。

* * *

## 回答 #2

> 赞同：51
> 
> 时间：2008-11-10T02:44:22.340

消息 to`nil`什么都不做并返回`nil`, `Nil`, `NULL`, `0`, 或`0.0`.

* * *

## 回答 #3

> 赞同：41
> 
> 时间：2008-11-21T21:15:08.703

所有其他帖子都是正确的，但也许这里重要的是概念。

在 Objective-C 方法调用中，任何可以接受选择器的对象引用都是该选择器的有效目标。

这节省了很多“目标对象是 X 类型吗？” 代码 - 只要接收对象实现选择器，它是什么类*绝对没有区别！*`nil`是一个接受任何选择器的 NSObject - 它只是*不做*任何事情。这也消除了许多“检查零，如果为真则不发送消息”代码。（“如果它接受它，它就实现它”的概念也允许您创建*协议*，这有点像 Java 接口：一个声明，如果一个类实现了规定的方法，那么它就符合协议。）

这样做的原因是为了消除除了让编译器满意之外什么都不做的猴子代码。是的，您获得了多一次方法调用的开销，但您节省了*程序员的时间*，这是比 CPU 时间昂贵得多的资源。此外，您正在从应用程序中消除更多代码和更多条件复杂性。

向反对者澄清：您可能认为这不是一个好方法，但这是语言的实现方式，它是*Objective-C*中推荐的编程习惯（参见斯坦福 iPhone 编程讲座）。

* * *

## 回答 #4

> 赞同：18
> 
> 时间：2008-10-01T06:12:11.353

这意味着当在 nil 指针上调用 objc_msgSend 时，运行时不会产生错误；相反，它返回一些（通常有用的）值。可能有副作用的消息什么都不做。

它很有用，因为大多数默认值比错误更合适。例如：

```
[someNullNSArrayReference count] => 0 
```

即， nil 似乎是空数组。隐藏一个 nil NSView 引用什么都不做。好用，嗯？

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2008-10-12T20:02:55.137

在文档的引文中，有两个独立的概念——如果文档更清楚地说明这一点可能会更好：

> Cocoa 中有几种模式利用了这一事实。
> 
> 从消息返回到 nil 的值也可能是有效的：

前者在这里可能更相关：通常能够发送消息以`nil`使代码更简单——您不必到处检查空值。典型的例子可能是访问器方法：

```
- (void)setValue:(MyClass *)newValue {
    if (value != newValue) { 
        [value release];
        value = [newValue retain];
    }
} 
```

如果发送消息`nil`无效，则此方法会更复杂——您必须进行两项额外检查以确保在发送消息之前`value`不`newValue`进行检查。`nil`

但是，后一点（从消息返回的值`nil`通常也是有效的）为前者增加了乘数效应。例如：

```
if ([myArray count] > 0) {
    // do something...
} 
```

此代码再次不需要检查`nil`值，并且自然流动......

综上所述，能够向其发送消息的额外灵活性`nil`确实需要付出一些代价。您可能会在某个阶段编写以特殊方式失败的代码，因为您没有考虑到值可能是`nil`.

* * *

## 回答 #6

> 赞同：12
> 
> 时间：2012-02-29T22:42:18.087

从[格雷格帕克](https://twitter.com/gparker)的[网站](http://www.sealiesoftware.com/blog/archive/2012/2/29/objc_explain_return_value_of_message_to_nil.html)：

如果运行 LLVM 编译器 3.0 (Xcode 4.2) 或更高版本

```
返回类型为 nil 的消息 | 返回
高达 64 位的整数 | 0
浮点数高达 long double | 0.0
指针 | 零
结构 | {0}
任何_复杂类型 | {0, 0}

```

* * *

## 回答 #7

> 赞同：9
> 
> 时间：2008-10-01T06:53:01.460

这意味着通常不必为了安全而在各处检查 nil 对象 - 特别是：

```
[someVariable release]; 
```

或者，如前所述，当您获得 nil 值时，各种 count 和 length 方法都返回 0，因此您不必为 nil 添加额外的检查：

```
if ( [myString length] > 0 ) 
```

或这个：

```
return [myArray count]; // say for number of rows in a table 
```

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2008-10-02T00:56:57.483

不要想着“接收者为零”；我同意，这*很*奇怪。如果您向 nil 发送消息，则没有接收者。你只是向任何人发送消息。

如何处理这是 Java 和 Objective-C 之间的哲学差异：在 Java 中，这是一个错误；在 Objective-C 中，它是无操作的。

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2009-03-14T21:41:19.617

发送到 nil 并且其返回值的大小大于 sizeof(void*) 的 ObjC 消息在 PowerPC 处理器上产生未定义的值。除此之外，这些消息还会导致在 Intel 处理器上大小大于 8 字节的结构的字段中返回未定义的值。Vincent Gable 在他的[博客文章中很好地描述了这一点](http://vgable.com/blog/2008/05/31/messages-to-nowhere/)

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2011-04-03T15:41:10.557

我认为其他任何答案都没有明确提到这一点：如果您习惯于 Java，您应该记住，虽然 Mac OS X 上的 Objective-C 具有异常处理支持，但它是一个可选的语言功能，可以使用编译器标志打开/关闭。我的猜测是，这种“发送消息`nil`是安全的”的设计早于在语言中包含异常处理支持，并且考虑到类似的目标：方法可以返回`nil`以指示错误，并且由于发送消息`nil`通常返回`nil`反过来，这允许错误指示通过您的代码传播，因此您不必在每条消息中检查它。您只需要在重要的地方检查它。我个人认为异常传播和处理是实现这一目标的更好方法，但并不是每个人都同意这一点。（另一方面，例如，我不喜欢 Java 要求您必须声明一个方法可能抛出的异常，这通常会迫使您在整个代码中在*语法上传播异常声明；但这是另一个讨论。）*

我已经发布了一个类似但更长的回答相关问题[“在Objective C中断言每个对象创建都成功了吗？”](https://stackoverflow.com/questions/5450775/is-asserting-that-every-object-creation-succeeded-necessary-in-objective-c/5451243#5451243) 如果您想了解更多详细信息。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2014-11-24T12:52:47.080

对于原始值，C 不表示 0，而对于指针则表示 NULL（在指针上下文中相当于 0）。

Objective-C 通过添加 nil 来构建 C 的无表示。nil 是一个无指向的对象指针。尽管在语义上与 NULL 不同，但它们在技术上是等价的。

新分配的 NSObject 开始生命时其内容设置为 0。这意味着该对象指向其他对象的所有指针都以 nil 开头，因此无需在 init 方法中设置 self.(association) = nil。

**然而，nil 最显着的行为是它可以向它发送消息。**

在其他语言中，例如 C++（或 Java），这会使您的程序崩溃，但在 Objective-C 中，在 nil 上调用方法会返回零值。这大大简化了表达式，因为它消除了在做任何事情之前检查 nil 的需要：

```
// For example, this expression...
if (name != nil && [name isEqualToString:@"Steve"]) { ... }

// ...can be simplified to:
if ([name isEqualToString:@"Steve"]) { ... } 
```

了解 nil 在 Objective-C 中是如何工作的，可以让这种便利成为一个特性，而不是应用程序中潜伏的错误。确保防止出现不需要的 nil 值的情况，方法是检查并提前返回以静默失败，或者添加 NSParameterAssert 以引发异常。

来源： http: [//nshipster.com/nil/](http://nshipster.com/nil/) [https://developer.apple.com/library/ios/#documentation/cocoa/conceptual/objectivec/Chapters/ocObjectsClasses.html](https://developer.apple.com/library/ios/#documentation/cocoa/conceptual/objectivec/Chapters/ocObjectsClasses.html)（向 nil 发送消息）。

# browser - 为什么 GWT 会忽略浏览器区域设置？

> ID：156412
> 
> 赞同：6
> 
> 时间：2008-10-01T06:09:32.187
> 
> 标签：browser, gwt

`GWT`从语言环境属性或语言环境查询字符串获取语言环境。如果两者都没有指定，它使用“默认”（即`en_US`）语言环境。

为什么它不能从浏览器设置中获取？

似乎唯一的解决方案是将静态 html 启动页面替换为 JSP 之类的东西，该 JSP 读取浏览器区域设置并使用查询字符串设置区域设置或重定向。肯定有比这更好的解决方案，或者只是对语言环境进行硬编码，当然？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2011-11-03T09:19:44.500

You can also put this switch in your *.gwt.xml

```
<set-configuration-property name="locale.useragent" value="Y"/> 
```

this will add language selecting based on language selected in browser. You can also control search order for locale by setting

```
 <set-configuration-property name="locale.searchorder" value="queryparam,cookie,meta,useragent"/> 
```

But beware that in IE this doesn't work - you should develop server-side language pick based on 'Accept-Language' header send by the IE.

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-02T08:14:32.707

如果您将可用语言列表放入 *.gwt.xml 文件，默认情况下它将切换到列出的第一种语言。

```
<!-- Slovenian in Slovenia -->
<extend-property name="locale" values="sl"/>

<!-- English language, independent of country -->
<extend-property name="locale" values="en"/> 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2013-05-18T18:30:55.050

您可以使用 cookie 来保存和发送此值，但为此您必须先添加* **.gwt.xml**

```
<set-configuration-property name="locale.cookie" value="yourCookieName"/>
<set-configuration-property name="locale.searchorder" value="queryparam,cookie,meta,useragent"/> 
```

请注意，“ `queryparam`”在这里具有最大的优先级，它允许使用`http`查询设置新的语言环境并忽略 cookie 上的值。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-06-25T11:48:45.343

**在您的*.gwt.xml**文件中添加此条目以查看效果！

请检查以下行以获取更多信息！

`<set-configuration-property name="locale.useragent" value="Y"/>`

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-11-24T16:00:42.637

如果您的入口页面是 JSP，您可以检查请求的`Accept-Language`标头以动态设置语言环境。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2015-02-10T15:21:11.187

This worked for me, I hope it also works for you.

My problem was that I have not declared any locale value in .gwt.xml module descriptor. In that case only the default locale is used. GWT does that way because any different supported locale means a new compilation iteration/permutation. Therefore only declared locales are used.

Here you are an example:

```
<!-- Locales -->
<extend-property name="locale" values="en_US"/>
<extend-property name="locale" values="es"/>    
<set-property-fallback name="locale" value="en_US"/>
<set-configuration-property name="locale.useragent" value="Y" />
<set-configuration-property name="locale.searchorder" value="queryparam,cookie,meta,useragent" /> 
```

The first and second lines set the available/supported locales (English from US and Spanish without specific country in my example). The third line sets the default locale in case no one is detected (this default declaration must be set after the default value is declared in a `extend-property` line). The fourth line enables the locale detection by means of the HTTP-Headers Accept-Language sent by browser (probably is enabled by default and not needed to set at all). The final line sets the order in which the different detection mechanisms try to detect the locale:

1.  As a parameter in the URL query
2.  From cookies
3.  As a meta value in the HTML page
4.  From the HTTP header sent by browser

# regex - 电子邮件地址的正则表达式识别很难吗？

> ID：156430
> 
> 赞同：62
> 
> 时间：2008-10-01T06:22:22.233
> 
> 标签：regex, email, validation, textmatching

我最近在某处读到，写一个正则表达式来匹配一个电子邮件地址，考虑到标准的所有变化和可能性是非常困难的，而且比最初假设的要复杂得多。

这是为什么？

是否有任何已知且经过验证的正则表达式实际上可以完全做到这一点？

使用正则表达式匹配电子邮件地址有哪些好的替代方法？

* * *

## 回答 #1

> 赞同：65
> 
> 时间：2008-10-01T06:26:38.853

对于*正式*的电子邮件规范，是的，由于诸如评论之类的递归（特别是如果您不先删除对空白的评论）以及各种不同的格式（电子邮件地址是'不总是有人@somewhere.tld）。您可以接近（使用一些庞大且难以理解的正则表达式模式），但检查电子邮件的更好方法是进行非常熟悉的握手：

*   他们告诉你他们的电子邮件
*   您通过电子邮件向他们发送带有 Guid 的确认链接
*   当他们点击链接时，您知道：

    1.  电子邮件是正确的
    2.  它存在
    3.  他们拥有它

比盲目接受电子邮件地址要好得多。

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2008-10-01T06:34:49.803

有许多 Perl 模块（例如）可以做到这一点。不要尝试编写自己的正则表达式来做到这一点。看着

`Mail::VRFY`将进行语法和网络检查（某处的 SMTP 服务器是否接受此地址）

[https://metacpan.org/pod/Mail::VRFY](https://metacpan.org/pod/Mail::VRFY)

`RFC::RFC822::Address`- 递归下降电子邮件地址解析器。

[https://metacpan.org/pod/RFC::RFC822::地址](https://metacpan.org/pod/RFC::RFC822::Address)

`Mail::RFC822::Address`- 基于正则表达式的地址验证，值得一看只是为了疯狂的正则表达式

[http://ex-parrot.com/~pdw/Mail-RFC822-Address.html](http://ex-parrot.com/~pdw/Mail-RFC822-Address.html)

其他语言也有类似的工具。下面疯狂的正则表达式...

```
(?:(?:\r\n)?[ \t])*(?:(?:(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t]
)+|\Z|(?=[\["()<>@,;:\\".\[\]]))|"(?:[^\"\r\\]|\\.|(?:(?:\r\n)?[ \t]))*"(?:(?:
\r\n)?[ \t])*)(?:\.(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(
?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|"(?:[^\"\r\\]|\\.|(?:(?:\r\n)?[ 
\t]))*"(?:(?:\r\n)?[ \t])*))*@(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\0
31]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\
](?:(?:\r\n)?[ \t])*)(?:\.(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+
(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:
(?:\r\n)?[ \t])*))*|(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z
|(?=[\["()<>@,;:\\".\[\]]))|"(?:[^\"\r\\]|\\.|(?:(?:\r\n)?[ \t]))*"(?:(?:\r\n)
?[ \t])*)*\<(?:(?:\r\n)?[ \t])*(?:@(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\
r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[
 \t])*)(?:\.(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)
?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t]
)*))*(?:,@(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[
 \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*
)(?:\.(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t]
)+|\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*))*)
*:(?:(?:\r\n)?[ \t])*)?(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+
|\Z|(?=[\["()<>@,;:\\".\[\]]))|"(?:[^\"\r\\]|\\.|(?:(?:\r\n)?[ \t]))*"(?:(?:\r
\n)?[ \t])*)(?:\.(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:
\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|"(?:[^\"\r\\]|\\.|(?:(?:\r\n)?[ \t
]))*"(?:(?:\r\n)?[ \t])*))*@(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031
]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\](
?:(?:\r\n)?[ \t])*)(?:\.(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?
:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?
:\r\n)?[ \t])*))*\>(?:(?:\r\n)?[ \t])*)|(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?
:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|"(?:[^\"\r\\]|\\.|(?:(?:\r\n)?
[ \t]))*"(?:(?:\r\n)?[ \t])*)*:(?:(?:\r\n)?[ \t])*(?:(?:(?:[^()<>@,;:\\".\[\] 
\000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|"(?:[^\"\r\\]|
\\.|(?:(?:\r\n)?[ \t]))*"(?:(?:\r\n)?[ \t])*)(?:\.(?:(?:\r\n)?[ \t])*(?:[^()<>
@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|"
(?:[^\"\r\\]|\\.|(?:(?:\r\n)?[ \t]))*"(?:(?:\r\n)?[ \t])*))*@(?:(?:\r\n)?[ \t]
)*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\
".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*)(?:\.(?:(?:\r\n)?[ \t])*(?
:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[
\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*))*|(?:[^()<>@,;:\\".\[\] \000-
\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|"(?:[^\"\r\\]|\\.|(
?:(?:\r\n)?[ \t]))*"(?:(?:\r\n)?[ \t])*)*\<(?:(?:\r\n)?[ \t])*(?:@(?:[^()<>@,;
:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([
^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*)(?:\.(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\"
.\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\
]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*))*(?:,@(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\
[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\
r\\]|\\.)*\](?:(?:\r\n)?[ \t])*)(?:\.(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] 
\000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\r\\]
|\\.)*\](?:(?:\r\n)?[ \t])*))*)*:(?:(?:\r\n)?[ \t])*)?(?:[^()<>@,;:\\".\[\] \0
00-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|"(?:[^\"\r\\]|\\
.|(?:(?:\r\n)?[ \t]))*"(?:(?:\r\n)?[ \t])*)(?:\.(?:(?:\r\n)?[ \t])*(?:[^()<>@,
;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|"(?
:[^\"\r\\]|\\.|(?:(?:\r\n)?[ \t]))*"(?:(?:\r\n)?[ \t])*))*@(?:(?:\r\n)?[ \t])*
(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".
\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*)(?:\.(?:(?:\r\n)?[ \t])*(?:[
^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]
]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*))*\>(?:(?:\r\n)?[ \t])*)(?:,\s*(
?:(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\
".\[\]]))|"(?:[^\"\r\\]|\\.|(?:(?:\r\n)?[ \t]))*"(?:(?:\r\n)?[ \t])*)(?:\.(?:(
?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[
\["()<>@,;:\\".\[\]]))|"(?:[^\"\r\\]|\\.|(?:(?:\r\n)?[ \t]))*"(?:(?:\r\n)?[ \t
])*))*@(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t
])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*)(?
:\.(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|
\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*))*|(?:
[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\
]]))|"(?:[^\"\r\\]|\\.|(?:(?:\r\n)?[ \t]))*"(?:(?:\r\n)?[ \t])*)*\<(?:(?:\r\n)
?[ \t])*(?:@(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["
()<>@,;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*)(?:\.(?:(?:\r\n)
?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>
@,;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*))*(?:,@(?:(?:\r\n)?[
 \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,
;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*)(?:\.(?:(?:\r\n)?[ \t]
)*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\
".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*))*)*:(?:(?:\r\n)?[ \t])*)?
(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".
\[\]]))|"(?:[^\"\r\\]|\\.|(?:(?:\r\n)?[ \t]))*"(?:(?:\r\n)?[ \t])*)(?:\.(?:(?:
\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\[
"()<>@,;:\\".\[\]]))|"(?:[^\"\r\\]|\\.|(?:(?:\r\n)?[ \t]))*"(?:(?:\r\n)?[ \t])
*))*@(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])
+|\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*)(?:\
.(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z
|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*))*\>(?:(
?:\r\n)?[ \t])*))*)?;\s*) 
```

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-10-01T08:38:02.347

无论如何，验证电子邮件地址并不是很有帮助。它不会捕捉到常见的拼写错误或虚构的电子邮件地址，因为这些在语法上往往看起来像有效地址。

如果您想确定地址是否有效，您别无选择，只能发送确认邮件。

如果您只是想确保用户输入的内容看起来像电子邮件，而不仅仅是“asdf”，请检查@。更复杂的验证并没有真正提供任何好处。

（我知道这不能回答你的问题，但我认为无论如何都值得一提）

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2008-10-01T06:28:42.127

BNF 中有一个上下文无关语法，用于描述[RFC-2822](ftp://ftp.rfc-editor.org/in-notes/rfc2822.txt "RFC-2822")中的有效电子邮件地址。它很复杂。例如：

```
" @ "@example.com 
```

是一个有效的电子邮件地址。我不知道有任何正则表达式可以完全做到这一点；通常给出的示例要求首先删除注释。我写了一个递归下降解析器来完全完成一次。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2009-02-10T16:16:08.230

我现在整理了来自 Cal Henderson、Dave Child、Phil Haack、Doug Lovell 和 RFC 3696 的测试用例。总共有 158 个测试地址。

我针对我能找到的所有验证器运行了所有这些测试。比较在这里： http: [//www.dominicsayers.com/isemail](http://www.dominicsayers.com/isemail)

随着人们增强他们的验证器，我将尝试使此页面保持最新。感谢 Cal、Dave 和 Phil 在编译这些测试时提供的帮助和合作，以及对[我自己的验证器](http://code.google.com/p/isemail/source/browse/trunk/is_email.php)的建设性批评。

人们应该特别注意[针对 RFC 3696 的勘误表](http://www.rfc-editor.org/errata_search.php?rfc=3696)。其中三个规范示例实际上是无效地址。地址的最大长度是 254 或 256 个字符，**而不是**320。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2008-10-01T07:27:57.070

这并不是胡说八道，因为允许使用诸如“+”之类的字符对于打击垃圾邮件的用户非常有用，例如*myemail+sketchysite@gmail.com*（[即时一次性 Gmail 地址](http://lifehacker.com/software/gmail/instant-disposable-gmail-addresses-144397.php "Gmail：即时一次性 Gmail 地址")）。

只有当网站接受它时。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2008-10-03T16:13:18.550

在我看来，是否接受奇怪、不常见的电子邮件地址格式取决于人们想用它们做什么。

如果您正在编写一个邮件服务器，那么您必须非常准确且极其正确地接受您所接受的内容。因此，上面引用的“疯狂”正则表达式是合适的。

然而，对于我们其他人来说，我们主要只是对确保用户在 Web 表单中键入的内容看起来合理并且没有某种 sql 注入或缓冲区溢出感兴趣。

坦率地说，在注册邮件列表、时事通讯或网站时，是否有人真正关心让某人输入包含评论、换行符、引号、空格、括号或其他乱码的 200 个字符的电子邮件地址？对此类小丑的正确回应是“当您的地址看起来像 username@domain.tld 时再回来”。

我所做的验证包括确保只有一个“@”；没有空格、空值或换行符；“@”右侧的部分至少有一个点（但不是连续两个点）；并且没有引号、括号、逗号、冒号、感叹号、分号或反斜杠，所有这些都比实际电子邮件地址的某些部分更有可能是黑客攻击的尝试。

是的，这意味着我拒绝有人可能试图在我的网站上注册的有效地址——也许我“错误地”拒绝了多达 0.001% 的真实地址！我可以忍受这一点。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2008-10-01T06:35:08.257

引用和其他各种很少使用但有效的 RFC 部分使其变得困难。除了“这很难”之外，我对这个话题的了解还不够多，无法做出明确的评论——但幸运的是，[其他](http://haacked.com/archive/2007/08/21/i-knew-how-to-validate-an-email-address-until-i.aspx)人已经详细地[写](http://www.hm2k.com/posts/what-is-a-valid-email-address)了这篇文章。

至于它的有效正则表达式，Perl Mail::Rfc822::Address 模块包含[一个显然可以工作的正则表达式](http://www.ex-parrot.com/~pdw/Mail-RFC822-Address.html)- 但前提是任何注释已经被空格替换。（电子邮件地址中的评论？你明白为什么它比人们想象的要难......）

当然，其他地方大量的简化正则表达式将验证几乎每个真正被使用的电子邮件地址......

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-10-01T06:28:55.043

一些正则表达式的风格实际上可以匹配嵌套的括号（例如，Perl 兼容的括号）。也就是说，我看到了一个声称正确匹配 RFC 822 的正则表达式，它是两页没有任何空格的文本。因此，检测有效电子邮件地址的最佳方法是向其发送电子邮件并查看它是否有效。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2008-10-03T15:46:26.577

只是添加一个比@mmaibaum 列出的更不疯狂的正则表达式：

```
^[a-zA-Z]([.]?([a-zA-Z0-9_-]+)*)?@([a-zA-Z0-9\-_]+\.)+[a-zA-Z]{2,4}$ 
```

它不是万无一失的，当然也没有涵盖整个电子邮件规范，但它确实在满足最基本的要求方面做得不错。更好的是，它有点易于理解，并且可以编辑。

[抄自HouseOfFusion.com](http://houseoffusion.com)的讨论，这是一个世界级的 ColdFusion 资源。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2009-01-06T20:22:48.973

[在 Java 中检查电子邮件地址的一种简单而好的方法是使用 Apache Commons Validator](http://commons.apache.org/validator/)库的 EmailValidator 。

在发送电子邮件之前，我总是会检查输入表单中的电子邮件地址与此类内容 - 即使您只发现一些拼写错误。您可能不想为“交付失败”通知邮件编写自动扫描程序。:-)

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2008-10-01T06:29:51.123

[这真的很难，因为根据电子邮件规范RFC 2822](http://www.faqs.org/rfcs/rfc2822.html)，电子邮件地址中有很多有效的东西。您通常看不到的东西，例如 + 是电子邮件地址的完全有效字符.. 根据规范。

有一整节专门讨论电子邮件地址[http://regexlib.com](http://regexlib.com)，这是一个很好的资源。我建议您确定对您而言重要的标准并找到一个匹配的标准。大多数人真的不需要完全支持规范允许的所有可能性。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2009-12-31T15:08:07.953

如果您在 .NET Framework 上运行，只需尝试实例化一个`MailAddress`对象并捕获`FormatException`它是否爆炸，或者提取`Address`它是否成功。无需对捕获异常的性能进行任何废话（实际上，如果这只是在单个 Web 表单上，它不会产生太大的影响）`MailAddress`，.NET 框架中的类会经历一个非常完整的解析过程（它不使用正则表达式）。打开 Reflector 并搜索`MailAddress`并`MailBnfHelper.ReadMailAddress()`查看它所做的所有花哨的东西。比我聪明的人花了很多时间在 Microsoft 构建该解析器，当我实际向该地址发送电子邮件时，我将使用它，所以我也可以使用它来验证传入地址。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-10-01T06:29:41.890

试试这个：

```
"(?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])" 
```

[在这里](http://www.regular-expressions.info/email.html)查看详细信息。

然而，与其执行 RFC822 标准，或许从另一个角度来看它会更好。如果邮件服务器不反映标准，标准所说的并不重要。因此，我认为在验证电子邮件地址时，最好模仿最流行的邮件服务器所做的事情。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2008-10-01T06:37:28.827

许多人尝试过，许多人都接近了。您可能想阅读[wikipedia 文章](http://en.wikipedia.org/wiki/E-mail_address)和[其他](http://www.hm2k.com/posts/what-is-a-valid-email-address)[一些](http://www.ex-parrot.com/~pdw/Mail-RFC822-Address.html) 文章。

具体来说，您需要记住，许多网站和电子邮件服务器对电子邮件地址的验证很宽松，因此它们基本上没有完全实施该标准。不过，电子邮件一直在工作就足够了。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2010-03-11T08:00:03.490

Java的这个类中有一个验证器： [http ://www.leshazlewood.com/?p=23](http://www.leshazlewood.com/?p=23)

这是由 Shiro 的创建者（正式为 Ki，正式为 JSecurity）编写的

**测试电子邮件地址有效性的优缺点：**

有两种类型的正则表达式可以验证电子邮件：

1.  那些太松的。
2.  ~~那些过于严格的。~~

正则表达式不可能匹配所有有效的电子邮件地址和无效的电子邮件地址，因为某些字符串可能看起来像有效的电子邮件地址，但实际上并没有发送到任何人的收件箱。测试一封电子邮件是否真的有效的唯一方法是向该地址发送一封电子邮件，看看您是否得到某种回应。考虑到这一点，在匹配电子邮件方面过于严格的正则表达式似乎并没有太大的用途。

我认为大多数要求电子邮件正则表达式的人都在寻找第一个选项，即过于松散的正则表达式。他们想测试一个字符串，看看它是否看起来像一封电子邮件，如果它肯定不是一封电子邮件，那么他们可以对用户说：“嘿，你应该在这里放一封电子邮件，这肯定是不是有效的电子邮件。也许您没有意识到此字段是用于电子邮件的，或者可能有错字”。

如果用户输入的字符串看起来很像有效的电子邮件，但实际上不是，那么这是一个应该由应用程序的不同部分处理的问题。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2008-10-01T06:28:17.120

*谁能提供一些关于为什么会这样的见解？*

是的，这是一个极其复杂的标准，它允许许多今天没有人真正使用的东西。:)

*是否有任何已知且经过验证的正则表达式实际上可以完全做到这一点？*

这是完全解析整个标准的一种尝试...

[http://ex-parrot.com/~pdw/Mail-RFC822-Address.html](http://ex-parrot.com/~pdw/Mail-RFC822-Address.html)

*使用正则表达式匹配电子邮件地址有哪些好的替代方法？*

我猜想以您使用的任何语言为它使用现有框架？尽管那些可能会在内部使用正则表达式。这是一个复杂的字符串。正则表达式旨在解析复杂的字符串，因此这确实是您的最佳选择。

**编辑**：我应该补充一点，我链接到的正则表达式只是为了好玩。我不赞成使用这样复杂的正则表达式——有人说“如果你的正则表达式不止一行，那么它肯定会在某处出现错误”。我链接到它以说明标准的复杂性。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2008-10-01T09:10:08.773

为了这篇文章的完整性，PHP 也有一个语言内置函数来验证电子邮件。

对于 PHP 使用带有特定 EMAIL 验证类型的 nice filter_var :)

php 中不再有疯狂的电子邮件正则表达式：D

```
var_dump(filter_var('bob@example.com', FILTER_VALIDATE_EMAIL)); 
```

[http://www.php.net/filter_var](http://www.php.net/filter_var)

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2020-01-24T21:24:36.650

在尝试创建正则表达式来验证电子邮件时，似乎总是有一种无法解释的格式。尽管电子邮件中有些字符无效，但基本格式是 local-part@domain，本地部分最多大约 64 个字符，域大约 253 个字符。除此之外，它有点像狂野的西部。

我认为答案取决于您对经过验证的电子邮件地址的定义以及您的业务流程可以容忍的内容。正则表达式非常适合确保电子邮件格式正确，并且您知道它们有很多变体可以使用。这里有几个变化：

变体 1：

```
(?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\]) 
```

变体2：

```
\A(?:[a-z0-9!#$%&'*+/=?^_‘{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_‘{|}~-]+)*| "(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:25[0-5]|2[0-][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])\z 
```

仅仅因为电子邮件在语法上是正确的并不意味着它是有效的。

一封电子邮件可以遵守 RFC 5322 并通过正则表达式，但不会真正了解电子邮件的实际可传递性。如果您想知道这封电子邮件是否是伪造的电子邮件，或者它是一次性的、不可交付的还是已知的机器人，该怎么办？如果您想排除粗俗或以某种方式存在争议或有问题的电子邮件怎么办？顺便说一句，大家都知道，我在一家数据验证公司工作，我只是想充分披露我为 Service Objects 工作，但作为电子邮件验证领域的专业人士，我觉得我们提供的解决方案提供了更好的解决方案验证比正则表达式。随意给它看一下，我认为它可以帮助很多。[您可以在我们的开发指南](https://docs.serviceobjects.com/display/devguide/EV3+-+ValidateEmailAddress+-+Recommended?zut=156430)中查看更多信息。它实际上做了很多很酷的电子邮件检查和验证。

这是一个例子：

电子邮件：mickeyMouse@gmail.com

```
{
  "ValidateEmailInfo":{
      "Score":4,
      "IsDeliverable":"false",
      "EmailAddressIn":"mickeyMouse@gmail.com",
      "EmailAddressOut":"mickeyMouse@gmail.com",
      "EmailCorrected":false,
      "Box":"mickeyMouse",
      "Domain":"gmail.com",
      "TopLevelDomain":".com",
      "TopLevelDomainDescription":"commercial",
      "IsSMTPServerGood":"true",
      "IsCatchAllDomain":"false",
      "IsSMTPMailBoxGood":"false",
      "WarningCodes":"22",
      "WarningDescriptions":"Email is Bad - Subsequent checks halted.",
      "NotesCodes":"16",
      "NotesDescriptions":"TLS"
  }
} 
```

# sorting - 在经典 ASP 中对集合进行排序

> ID：156436
> 
> 赞同：8
> 
> 时间：2008-10-01T06:24:39.700
> 
> 标签：sorting, asp-classic

这是一个非常简单的问题——如何对集合进行排序？

我有一个随机顺序行的 CSV 文件。我想根据一列中的日期对行进行排序。我是否将行添加到记录集中？我可以使用 Scripting.Dictionary 进行排序吗？

我显然已经被 .NET 和 Linq 宠坏了，现在我发现自己又回到了经典的 asp 领域，意识到我必须在 7 年前就知道这一点，并且非常缺少泛型。我觉得自己像一个完整的n00b。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-10-01T07:50:42.957

在这种情况下，我会从大哥.net 那里得到帮助。可以在 ASP 应用程序中使用**System.Collections.Sortedlist**并对键值对进行排序。

```
set list = server.createObject("System.Collections.Sortedlist")
with list
  .add "something", "YY"
  .add "something else", "XX"
end with

for i = 0 to list.count - 1
    response.write(list.getKey(i) & " = " & list.getByIndex(i))
next 
```

顺便说一句，如果以下 .net 类也可用：

*   System.Collections.Queue
*   System.Collections.Stack
*   System.Collections.ArrayList
*   System.Collections.SortedList
*   System.Collections.Hashtable
*   System.IO.StringWriter
*   System.IO.MemoryStream；

另请参阅：[COM .NET 互操作的奇迹](http://blog.opennetcf.com/afeinman/PermaLink,guid,aa53e23d-b8e5-4015-b00a-0c8ea9bc6dfe.aspx)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-01T06:51:17.313

我会使用 RecordSet 方法。使用文本驱动程序。您需要更改连接字符串中的目录和 select 语句中的文件名。扩展属性“HDR = Yes”指定CSV中有一个标题行，我建议这样做，因为它会使编写伪SQL更容易。

```
<%

Dim strConnection, conn, rs, strSQL

strConnection = "Provider=Microsoft.Jet.OLEDB.4.0;Data Source=c:\inetpub\wwwroot\;Extended Properties='text;HDR=Yes;FMT=Delimited';"

Set conn = Server.CreateObject("ADODB.Connection")
conn.Open strConnection

Set rs = Server.CreateObject("ADODB.recordset")
strSQL = "SELECT * FROM test.csv order by date desc"
rs.open strSQL, conn, 3,3

WHILE NOT rs.EOF
    Response.Write(rs("date") & "<br/>") 
    rs.MoveNext
WEND

rs.Close
Set rs = Nothing

conn.Close
Set conn = Nothing

%> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-01T06:41:49.707

对我来说也已经很久了。IIRC您没有开箱即用的选项。

如果我是你，我会将所有数据放入一个数组中，然后对数组进行排序。我在这里找到了一个快速排序实现：[http ://www.4guysfromrolla.com/webtech/012799-3.shtml](http://www.4guysfromrolla.com/webtech/012799-3.shtml)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-01T06:47:52.487

还请查看“冒泡排序”，它与那些经典的 asp 标签云效果很好。

[http://www.4guysfromrolla.com/webtech/011001-1.shtml](http://www.4guysfromrolla.com/webtech/011001-1.shtml)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-05-31T14:20:21.630

一个迟到的答案，但仍然有价值。

我正在处理小型收藏品，因此可以负担得起每次将项目插入正确位置的方法，从而在每次添加时有效地重建收藏品。

VBScript 类如下：

```
'Simple collection manager class.
'Performs the opration of adding/setting a collection item.
'Encapulated off here in order to delegate responsibility away from the collection class.
Class clsCollectionManager
    Public Sub PopulateCollectionItem(collection, strKey, Value)
        If collection.Exists(strKey) Then
            If (VarType(Value) = vbObject) Then
                Set collection.Item(strKey) = Value
            Else
                collection.Item(strKey) = Value
            End If
        Else
            Call collection.Add(strKey, Value)
        End If
    End Sub

    'take a collection and a new element as input parameters, an spit out a brand new collection 
    'with the new item iserted into the correct location by order
    'This works on the assumption that the collection it is receiving is already ordered 
    '(which it should be if we always use this method to populate the item)

    'This mutates the passed collection, so we highlight this by marking it as byref 
    '(this is not strictly necessary as objects are passed by reference anyway)
    Public Sub AddCollectionItemInOrder(byref existingCollection, strNewKey, Value)
        Dim orderedCollection: Set orderedCollection = Server.CreateObject("Scripting.Dictionary")
        Dim strExistingKey

        'If there is something already in our recordset then we need to add it in order.

        'There is no sorting available for a collection (or an array) in VBScript. Therefore we have to do it ourself.
        'First, iterate over eveything in our current collection. We have to assume that it is itself sorted.
        For Each strExistingKey In existingCollection

            'if the new item doesn't exist AND it occurs after the current item, then add the new item in now 
            '(before adding in the current item.)
            If (Not orderedCollection.Exists(strNewKey)) And (strExistingKey > strNewKey) Then
                Call PopulateCollectionItem(orderedCollection, strNewKey, Value)
            End If
            Call PopulateCollectionItem(orderedCollection, strExistingKey, existingCollection.item(strExistingKey))
        Next

        'Finally check to see if it still doesn't exist. 
        'It won't if the last place for it is at the very end, or the original collection was empty
        If (Not orderedCollection.Exists(strNewKey)) Then
            Call PopulateCollectionItem(orderedCollection, strNewKey, Value)
        End If

        Set existingCollection = orderedCollection
    End Sub
End Class 
```

# c++ - C++ 函数内联意味着什么？

> ID：156438
> 
> 赞同：31
> 
> 时间：2008-10-01T06:25:18.093
> 
> 标签：c++, inline-functions

见标题：C++ 函数内联意味着什么？

* * *

## 回答 #1

> 赞同：42
> 
> 时间：2008-10-01T14:35:54.263

它只意味着一件事和一件事：编译器将省略函数的多个定义。

一个函数通常不能定义多次（例如，如果您将非内联函数定义放入头文件中，然后将其#include 到多个编译单元中，您将收到链接器错误）。将函数定义标记为“内联”会抑制此错误（链接器确保发生正确的事情）。

它并不意味着更多！

最重要的是，这并不意味着编译器会将编译后的函数嵌入到每个调用站点中。是否发生这种情况完全取决于编译器的突发奇想，通常 inline 修饰符几乎不会改变编译器的想法。编译器可以——并且确实——内联*未标记为内联的函数，并且它可以**对*标记为内联的函数进行函数调用。

删除多个定义是要记住的。

* * *

## 回答 #2

> 赞同：39
> 
> 时间：2008-10-01T06:30:10.157

该函数被放置在代码中，而不是被调用，类似于使用宏（概念上）。

这可以提高速度（没有函数调用），但会导致代码膨胀（如果函数使用 100 次，您现在有 100 个副本）。

您应该注意，这不会强制编译器使函数内联，如果它认为这是一个坏主意，它将忽略您。同样，编译器可能会决定为您内联普通函数。

这也允许您将整个函数放在头文件中，而不是在 cpp 文件中实现它（无论如何您都不能这样做，因为如果它被声明为内联，那么您会得到一个未解析的外部，除非当然只有那个 cpp 文件用过）。

* * *

## 回答 #3

> 赞同：22
> 
> 时间：2008-10-01T07:01:26.167

除了关于 的性能影响的其他（完全正确的）答案之外`inline`，在 C++ 中，您还应该注意，这允许您安全地将函数放在标头中：

```
// my_thing.h
inline int do_my_thing(int a, int b) { return a + b; }

// use_my_thing.cpp
#include "my_thing.h"
...
    set_do_thing(&do_my_thing);

// use_my_thing_again.cpp
...
    set_other_do_thing(&do_my_thing); 
```

这是因为编译器只在第一个需要编译常规可调用函数的目标文件中包含函数的实际主体（通常是因为它的地址已被占用，如上所示）。

如果没有`inline`关键字，大多数编译器会给出关于多重定义的错误，例如对于 MSVC：

```
use_my_thing_again.obj : error LNK2005: "int __cdecl do_my_thing(int,int)" (?do_my_thing@@YAHHH@Z) already defined in use_my_thing.obj
<...>\Scratch.exe : fatal error LNK1169: one or more multiply defined symbols found 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-01T22:10:58.833

@OldMan

> 编译器仅在您要求时才内联非标记为内联函数。

仅当“请求”是指“打开优化”时。

> 它仅对事件的影响是正确的。

两者都是正确的。

> 内联不会生成链接器可能使用的任何额外信息。编译 2 目标文件并检查。它允许多个定义，因为符号没有导出！不是因为那是它的目标！

您是什么意思，“符号未导出”？内联函数不是静态的。他们的名字是可见的；他们有外部联系。引用 C++ 标准：

> 无效 h(); 内联无效 h(); // 外部链接
> 
> 内联无效 l(); 无效 l(); // 外部链接

多重定义是非常重要的目标。这是强制性的：

> 内联函数应在使用它的每个翻译单元中定义，并且在每种情况下都应具有完全相同的定义（3.2）。[注意：在其定义出现在翻译单元之前，可能会遇到对内联函数的调用。] 如果具有外部链接的函数在一个翻译单元中声明为内联，则应在其出现的所有翻译单元中声明为内联；不需要诊断。具有外部链接的内联函数在所有翻译单元中应具有相同的地址。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-01T06:28:14.357

函数体实际上插入到调用者函数中。因此，如果您多次调用此函数，您将获得代码的多个副本。好处是您可以更快地执行。

通常非常短的函数是内联的，当函数体的副本不会比为正常函数调用生成的通常的序言/结尾代码大很多时。

您可以在 MSDN 文章中阅读有关内联的更多信息 - [http://msdn.microsoft.com/en-us/library/z8y1yy88.aspx](http://msdn.microsoft.com/en-us/library/z8y1yy88.aspx)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-01T06:33:55.093

内联函数通过可能生成放置在应用程序代码段中的指令来改变应用程序的性能配置文件。函数是否内联由编译器决定。根据我的经验，大多数现代编译器都擅长确定何时遵守用户的内联请求。

在许多情况下，内联函数会提高其性能。函数调用存在固有的开销。然而，为什么内联函数可能是负数是有原因的：

*   通过复制代码来增加二进制可执行文件的大小可能会导致磁盘抖动，从而降低应用程序的速度。
*   内联代码可能会导致缓存未命中，或者可能会导致缓存命中，具体取决于您的架构。

C++ FAQ 很好地解释了关键字的复杂性：http: [//www.parashift.com/c++-faq-lite/inline-functions.html#faq-9.3](http://www.parashift.com/c++-faq-lite/inline-functions.html#faq-9.3)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-01T06:29:20.300

通俗地说，就是允许编译器把函数的内容嫁接到调用点上，这样就没有函数调用了。如果你的函数有很大的控制语句（例如 ,`if`等`switch`），并且可以在编译时在调用站点评估条件（例如，在调用站点使用的常量值），那么你的代码最终会小得多（未使用的树枝被丢弃）。

更正式地说，内联函数也有不同的链接。我会让 C++ 专家谈谈这方面的问题。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-01T06:42:02.453

与仅具有线性指令流相比，调用函数会给 CPU 带来一定的性能损失。CPU 的寄存器必须写入另一个位置，等等。显然，拥有函数的好处通常超过性能损失。但是，如果性能会成为问题，例如传说中的“内循环”函数或其他瓶颈，编译器可以将该函数的机器代码插入到主要执行流中，而不是通过 CPU 调用函数的税.

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-01T14:23:43.810

编译器允许将标记为内联的函数内联。无法保证编译器会这样做。编译器本身使用复杂的语义来决定何时执行或不执行。

当编译器决定一个函数应该被内联时，调用者代码中对该函数的调用被被调用者的代码替换。这意味着您可以节省堆栈操作、调用本身并提高代码缓存的局部性。有时这可能会带来巨大的性能提升。特别是在 1 行数据访问函数中，例如面向对象代码中使用的访问器。

代价是通常会导致更大的代码，这可能会损害性能。这就是为什么将函数设置为内联只是编译器的“绿旗”，它不需要遵循。编译器将尝试做最好的事情。

作为不想处理链接特性的初学者的经验法则。内联函数将被同一编译单元中的其他函数调用。如果要实现一个可在多个编译单元上使用的内联函数，请将其作为一个头文件声明并实现内联函数。

为什么？

示例：在头文件 inlinetest.h

```
int foo();
inline int bar(); 
```

在编译单元 inlinetest.cpp

```
 int foo(){ int r = bar(); return r; }

 inline int bar(){ return 5;}; 
```

然后在 main.cpp

```
 #include "inlinetest.h"
 int main()
 {
  foo();
 //bar();
  } 
```

一次编译一个目标文件。如果您取消注释该“bar”调用，您将遇到错误。因为内联函数只在 inlinetest.o 目标文件上实现，并没有导出。同时 foo 函数，很可能已经嵌入了 bar 函数的代码（因为 bar 是单行无 I/O 操作，所以它很可能是内联的）

但是，如果您在头文件中声明了内联函数并内联实现了它，那么您将能够在包含该头文件的任何编译单元中使用它。（“代码示例”）；

删除 inline 关键字，即使在 main 调用 bar ，编译器也不会导致错误 除非您要求编译器内联所有函数，否则不会发生内联。这不是大多数编译器的标准行为。

# c# - 在完全托管的 asp.net c# web 应用程序中是否可能出现缓冲区溢出/溢出

> ID：156445
> 
> 赞同：12
> 
> 时间：2008-10-01T06:27:34.467
> 
> 标签：c#, asp.net, buffer-overflow, buffer-overrun

完全托管的 asp.net 门户网站中是否存在缓冲区溢出/溢出漏洞。如果是，如何对其进行测试。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-01T07:01:31.547

在一般情况下，您无需担心缓冲区溢出。这是托管代码的主要优势之一，垃圾收集可能是另一个主要优势。

您应该注意一些边缘情况 - 任何时候您的托管代码与非托管代码（Win32 API 调用、COM 互操作、P/Invoke 等）交互时，非托管代码中都有可能发生缓冲区溢出，基于从托管代码传入的参数。

标记为“不安全”的代码也可以直接操作内存地址，从而导致缓冲区溢出。不过，大多数 C# 代码都是在不使用“不安全”关键字的情况下编写的。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-01T06:29:28.240

除非您利用网络服务器或 .NET/ASP.NET 堆栈本身。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-29T04:12:21.210

我有一个工具（HP Dev Inspect）在我的 ASP.NET 应用程序中检测到可能的“可能的参数缓冲区溢出”，这是因为我们的一个 TextBoxes 中没有 MaxLength="20"...

# .net - Enumerate errors in an error provider

> ID：156457
> 
> 赞同：3
> 
> 时间：2008-10-01T06:30:07.707
> 
> 标签：.net, error-handling, errorprovider

Is it possible to enumerate all the current errors being displayed through an "Error Provider" without having to access the controls?

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2010-02-19T15:07:50.840

You can get all of the errors from an ErrorProvider by enumerating the Controls collection of its parent and calling GetError on each. Not efficient but it works.

```
foreach (Control ctrl in errProv.ContainerControl.Controls)
{
    Console.WriteLine(errProv.GetError(ctrl));
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-28T18:03:34.897

For any .net WinForms people who find this in google etc...

In WinForms at least enumerating all the current errors being displayed through an "Error Provider" class without accessing all the controls is not possible, there isn't even a summary validator in WinForms.

However if your errors are bubbling up from a lower layer then you should have access to a collection of them somewhere anyway, as the poster Charles Graham points out.

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-10-02T18:55:07.053

In WinForms, if your application is simple enough not to have any well-defined "layers" then you could wrap the ErrorProvider in a class that records and exposes all current errors. Or, if the app is really really simple, create a helper method that records/deletes an error and updates the ErrorProvider.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-01T06:35:44.933

There is a summary validator that will give you all of the errors, but it's pretty ugly, and I'm not sure if you can use it without displaying it on the page. Technically, if you are doing things the "right way", all of you error handling should be handled in your midddle teir and then bubbled to the screen that way, so you already have access to all the errors in a collection or dictionary.

# c# - 这种开关/模式匹配的想法有什么好处吗？

> ID：156467
> 
> 赞同：158
> 
> 时间：2008-10-01T06:34:13.173
> 
> 标签：c#, switch-statement

我最近一直在研究 F#，虽然我不太可能很快跳过栅栏，但它肯定突出了 C#（或库支持）可以使生活更轻松的一些领域。

特别是，我正在考虑 F# 的模式匹配功能，它允许非常丰富的语法 - 比当前的 switch/conditional C# 等价物更具表现力。我不会试图给出一个直接的例子（我的 F# 不适合它），但简而言之，它允许：

*   按类型匹配（对有区别的联合进行全面覆盖检查）[注意这也推断出绑定变量的类型，给予成员访问权限等]
*   按谓词匹配
*   以上的组合（可能还有一些我不知道的其他情况）

虽然 C# 最终借用 [ahem] 一些丰富性会很可爱，但在此期间，我一直在研究在运行时可以做什么 - 例如，很容易将一些对象组合在一起以允许：

```
var getRentPrice = new Switch<Vehicle, int>()
        .Case<Motorcycle>(bike => 100 + bike.Cylinders * 10) // "bike" here is typed as Motorcycle
        .Case<Bicycle>(30) // returns a constant
        .Case<Car>(car => car.EngineType == EngineType.Diesel, car => 220 + car.Doors * 20)
        .Case<Car>(car => car.EngineType == EngineType.Gasoline, car => 200 + car.Doors * 20)
        .ElseThrow(); // or could use a Default(...) terminator 
```

其中 getRentPrice 是 Func<Vehicle,int>。

[注意 - 也许这里的 Switch/Case 是错误的术语......但它表明了这个想法]

对我来说，这比使用重复 if/else 或复合三元条件（对于非平凡的表达式变得非常混乱 - 大量的括号）的等价物要清楚得多。它还避免了*很多*转换，并允许简单的扩展（直接或通过扩展方法）到更具体的匹配，例如与 VB Select...Case "x To y 相当的 InRange(...) 匹配“ 用法。

**我只是想判断人们是否认为上述结构有很多好处（在没有语言支持的情况下）？**

另外请注意，我一直在玩上述的 3 种变体：

*   用于评估的 Func<TSource,TValue> 版本 - 与复合三元条件语句相当
*   一个 Action<TSource> 版本 - 相当于 if/else if/else if/else if/else
*   Expression<Func<TSource,TValue>> 版本 - 作为第一个版本，但可由任意 LINQ 提供程序使用

此外，使用基于表达式的版本可以重写表达式树，本质上是将所有分支内联到单个复合条件表达式中，而不是使用重复调用。我最近没有检查过，但在一些早期的实体框架构建中，我似乎记得这是必要的，因为它不太喜欢 InvocationExpression。它还允许更有效地使用 LINQ-to-Objects，因为它避免了重复的委托调用 - 与等效的 C# 相比，测试显示类似上述的匹配（使用表达式表单）以相同的速度 [实际上快一点]复合条件语句。为了完整起见，基于 Func<...> 的版本花费的时间是 C# 条件语句的 4 倍，但仍然非常快，在大多数用例中不太可能成为主要瓶颈。

我欢迎任何关于上述内容的想法/输入/批评/等（或者更丰富的 C# 语言支持的可能性……希望 ;-p）。

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2008-10-12T11:38:24.843

在尝试在 C# 中做这样的“功能性”事情（甚至尝试写一本关于它的书）之后，我得出的结论是，不，除了少数例外，这样的事情并没有太大帮助。

主要原因是诸如 F# 之类的语言从真正支持这些功能中获得了很大的力量。不是“你能做到”，而是“很简单，很清楚，在意料之中”。

例如，在模式匹配中，编译器会告诉您是否存在不完整的匹配，或者何时永远不会命中另一个匹配。这对于开放式类型不太有用，但是在匹配有区别的联合或元组时，它非常漂亮。在 F# 中，您希望人们进行模式匹配，这立即变得有意义。

“问题”是一旦你开始使用一些函数概念，很自然地想要继续。然而，在 C# 中利用元组、函数、部分方法应用和柯里化、模式匹配、嵌套函数、泛型、monad 支持等变得*非常*难看，非常快。很好玩，一些很聪明的人用C#做了一些很酷的事情，但实际*使用*起来感觉很重。

我最终在 C# 中经常（跨项目）使用的内容：

*   序列函数，通过 IEnumerable 的扩展方法。诸如 ForEach 或 Process（“应用”？- 在枚举序列项时对其执行操作）之类的东西适合，因为 C# 语法很好地支持它。
*   抽象常见的语句模式。复杂的 try/catch/finally 块或其他涉及（通常非常通用）的代码块。扩展 LINQ-to-SQL 也适用于此。
*   元组，在某种程度上。

** 但请注意：缺乏自动泛化和类型推断确实阻碍了这些功能的使用。**

正如其他人所提到的，所有这一切都表明，在一个小团队中，出于特定目的，是的，如果你被 C# 卡住了，也许他们可以提供帮助。但根据我的经验，他们通常觉得麻烦多于他们的价值——YMMV。

其他一些链接：

*   [Mono.Rocks 游乐场](http://anonsvn.mono-project.com/viewvc/branches/rocks-playground/)有许多类似的东西（以及非功能性编程但有用的附加物）。
*   [Luca Bolognese 的函数式 C# 库](http://blogs.msdn.com/lucabol/archive/2008/04/01/a-c-library-to-write-functional-code-part-i-background.aspx)
*   [MSDN 上 Matthew Podwysocki 的函数式 C#](http://code.msdn.microsoft.com/FunctionalCSharp)

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2008-10-01T07:59:57.430

可以说 C# 不能简单地打开类型的原因是因为它主要是一种面向对象的语言，而在面向对象的术语中这样做的“正确”方法是在 Vehicle 上定义一个 GetRentPrice 方法和在派生类中覆盖它。

就是说，我花了一些时间使用具有这种功能的多范式和函数式语言，例如 F# 和 Haskell，并且我遇到过许多以前有用的地方（例如，当您没有编写您需要打开的类型，因此您无法在它们上实现虚拟方法），这是我欢迎与有区别的联合一起使用该语言的东西。

*[编辑：删除了关于性能的部分，因为 Marc 表示它可能会短路]*

另一个潜在的问题是可用性问题——从最终调用中可以清楚地看出，如果匹配不满足任何条件会发生什么，但如果匹配两个或多个条件会发生什么行为？它应该抛出异常吗？它应该返回第一场比赛还是最后一场比赛？

我倾向于用来解决此类问题的一种方法是使用字典字段，其中类型作为键，lambda 作为值，使用对象初始化器语法构造非常简洁；但是，这仅考虑具体类型并且不允许附加谓词，因此可能不适合更复杂的情况。[旁注 - 如果您查看 C# 编译器的输出，它经常将 switch 语句转换为基于字典的跳转表，因此似乎没有充分的理由不支持切换类型]

* * *

## 回答 #3

> 赞同：23
> 
> 时间：2008-10-01T07:26:01.347

我不认为这类库（类似于语言扩展）可能会获得广泛接受，但它们玩起来很有趣，并且对于在有用的特定领域工作的小型团队非常有用。例如，如果您正在编写大量的“业务规则/逻辑”来执行诸如此类的任意类型测试，我可以看到它会很方便。

我不知道这是否可能成为 C# 语言功能（似乎值得怀疑，但谁能看到未来？）。

作为参考，对应的 F# 大约为：

```
let getRentPrice (v : Vehicle) = 
    match v with
    | :? Motorcycle as bike -> 100 + bike.Cylinders * 10
    | :? Bicycle -> 30
    | :? Car as car when car.EngineType = Diesel -> 220 + car.Doors * 20
    | :? Car as car when car.EngineType = Gasoline -> 200 + car.Doors * 20
    | _ -> failwith "blah" 
```

假设您已经定义了一个类层次结构

```
type Vehicle() = class end

type Motorcycle(cyl : int) = 
    inherit Vehicle()
    member this.Cylinders = cyl

type Bicycle() = inherit Vehicle()

type EngineType = Diesel | Gasoline

type Car(engType : EngineType, doors : int) = 
    inherit Vehicle()
    member this.EngineType = engType
    member this.Doors = doors 
```

* * *

## 回答 #4

> 赞同：23
> 
> 时间：2017-12-13T14:18:13.207

在 C# 7 中，您可以执行以下操作：

```
switch(shape)
{
    case Circle c:
        WriteLine($"circle with radius {c.Radius}");
        break;
    case Rectangle s when (s.Length == s.Height):
        WriteLine($"{s.Length} x {s.Height} square");
        break;
    case Rectangle r:
        WriteLine($"{r.Length} x {r.Height} rectangle");
        break;
    default:
        WriteLine("<unknown shape>");
        break;
    case null:
        throw new ArgumentNullException(nameof(shape));
} 
```

* * *

## 回答 #5

> 赞同：13
> 
> 时间：2011-09-04T20:22:40.137

是的，我认为模式匹配语法结构很有用。我希望看到 C# 中的语法支持。

这是我对提供（几乎）与您描述的语法相同的类的实现

```
public class PatternMatcher<Output>
{
    List<Tuple<Predicate<Object>, Func<Object, Output>>> cases = new List<Tuple<Predicate<object>,Func<object,Output>>>();

    public PatternMatcher() { }        

    public PatternMatcher<Output> Case(Predicate<Object> condition, Func<Object, Output> function)
    {
        cases.Add(new Tuple<Predicate<Object>, Func<Object, Output>>(condition, function));
        return this;
    }

    public PatternMatcher<Output> Case<T>(Predicate<T> condition, Func<T, Output> function)
    {
        return Case(
            o => o is T && condition((T)o), 
            o => function((T)o));
    }

    public PatternMatcher<Output> Case<T>(Func<T, Output> function)
    {
        return Case(
            o => o is T, 
            o => function((T)o));
    }

    public PatternMatcher<Output> Case<T>(Predicate<T> condition, Output o)
    {
        return Case(condition, x => o);
    }

    public PatternMatcher<Output> Case<T>(Output o)
    {
        return Case<T>(x => o);
    }

    public PatternMatcher<Output> Default(Func<Object, Output> function)
    {
        return Case(o => true, function);
    }

    public PatternMatcher<Output> Default(Output o)
    {
        return Default(x => o);
    }

    public Output Match(Object o)
    {
        foreach (var tuple in cases)
            if (tuple.Item1(o))
                return tuple.Item2(o);
        throw new Exception("Failed to match");
    }
} 
```

这是一些测试代码：

```
 public enum EngineType
    {
        Diesel,
        Gasoline
    }

    public class Bicycle
    {
        public int Cylinders;
    }

    public class Car
    {
        public EngineType EngineType;
        public int Doors;
    }

    public class MotorCycle
    {
        public int Cylinders;
    }

    public void Run()
    {
        var getRentPrice = new PatternMatcher<int>()
            .Case<MotorCycle>(bike => 100 + bike.Cylinders * 10) 
            .Case<Bicycle>(30) 
            .Case<Car>(car => car.EngineType == EngineType.Diesel, car => 220 + car.Doors * 20)
            .Case<Car>(car => car.EngineType == EngineType.Gasoline, car => 200 + car.Doors * 20)
            .Default(0);

        var vehicles = new object[] {
            new Car { EngineType = EngineType.Diesel, Doors = 2 },
            new Car { EngineType = EngineType.Diesel, Doors = 4 },
            new Car { EngineType = EngineType.Gasoline, Doors = 3 },
            new Car { EngineType = EngineType.Gasoline, Doors = 5 },
            new Bicycle(),
            new MotorCycle { Cylinders = 2 },
            new MotorCycle { Cylinders = 3 },
        };

        foreach (var v in vehicles)
        {
            Console.WriteLine("Vehicle of type {0} costs {1} to rent", v.GetType(), getRentPrice.Match(v));
        }
    } 
```

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2009-08-13T07:29:01.857

模式匹配的目的（如此[处](http://en.wikibooks.org/wiki/Haskell/Pattern_matching)所述）是根据其类型规范解构值。但是，C# 中的类（或类型）的概念与您不同。

多范式语言设计没有错，相反，在 C# 中有 lambdas 非常好，而且 Haskell 可以对例如 IO 做命令式的东西。但这不是一个非常优雅的解决方案，不是 Haskell 时尚。

但是，由于可以根据 lambda 演算来理解顺序过程编程语言，并且 C# 恰好适合顺序过程语言的参数，因此它非常适合。但是，从 Haskell 的纯函数上下文中获取一些东西，然后将该功能放入一种不纯的语言中，好吧，这样做并不能保证更好的结果。

我的观点是，是什么让模式匹配与语言设计和数据模型相关联。话虽如此，我不认为模式匹配是 C# 的有用特性，因为它不能解决典型的 C# 问题，也不适合命令式编程范式。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2009-06-16T07:05:34.040

在我看来，做这些事情的面向对象的方式是访问者模式。您的访问者成员方法只是充当案例构造，您让语言本身处理适当的调度，而不必“窥视”类型。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2008-10-01T07:13:46.400

虽然打开类型不是很“C-sharpey”，但我知道这种构造在一般用途中会非常有用——我至少有一个可以使用它的个人项目（尽管它是可管理的 ATM）。重写表达式树是否存在很多编译性能问题？

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-10-01T09:16:07.557

需要注意的一件事：C# 编译器非常擅长优化 switch 语句。不仅仅是为了短路——你会得到完全不同的 IL，这取决于你有多少案例等等。

您的具体示例确实做了一些我认为非常有用的事情 - 没有与按类型区分的语法等效，因为（例如）`typeof(Motorcycle)`不是常量。

这在动态应用程序中变得更加有趣——您的逻辑可以很容易地由数据驱动，提供“规则引擎”风格的执行。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2017-09-13T15:30:29.357

[您可以使用我编写的名为OneOf](https://github.com/mcintyre321/OneOf)的库来实现您的目标

`switch`(and `if`and )的主要优点`exceptions as control flow`是它是编译时安全的 - 没有默认处理程序或失败

```
 OneOf<Motorcycle, Bicycle, Car> vehicle = ... //assign from one of those types
   var getRentPrice = vehicle
        .Match(
            bike => 100 + bike.Cylinders * 10, // "bike" here is typed as Motorcycle
            bike => 30, // returns a constant
            car => car.EngineType.Match(
                diesel => 220 + car.Doors * 20
                petrol => 200 + car.Doors * 20
            )
        ); 
```

它在 Nuget 上，针对 net451 和 netstandard1.6

# java - Java的JEditorPane有一个很好的替代品吗？

> ID：156472
> 
> 赞同：1
> 
> 时间：2008-10-01T06:35:26.727
> 
> 标签：java, swing, jeditorpane

我对 Swing 的 JEditorPane 呈现的 HTML 不满意。特别是无序列表的项目符号是可怕的。自定义渲染似乎非常困难。因此，我正在寻找具有更好 HTML 渲染的替代品。

这存在吗？（我问了谷歌，除了一个有希望的死链接之外什么也没找到）。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-01T06:41:44.123

[http://today.java.net/pub/a/today/2004/05/24/html-pt1.html](http://today.java.net/pub/a/today/2004/05/24/html-pt1.html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-01T06:48:00.097

不久前我广泛研究的东西 - 有很多选择 - 但是我几乎最终使用了[http://lobobrowser.org/cobra.jsp](http://lobobrowser.org/cobra.jsp)，但后来项目被取消了，所以我无法告诉你这一切结果是...

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-02T14:45:54.747

眼镜蛇成功了。几乎是 JEditorPane 的直接替代品，具有非常好的 HTML 渲染。一个抱怨：​​添加到我的小应用程序中是一个大罐子。

感谢您的回复。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-03-15T15:25:26.320

看看[SwingBox](http://cssbox.sourceforge.net/swingbox/)。

SwingBox 是一个 Java Swing 组件，它允许显示 (X)HTML 文档，包括 CSS 支持。它被设计为具有更好渲染结果的 JEditorPane 替代品。SwingBox 是纯 Java 的，它使用 CSSBox 渲染引擎来渲染文档。

# c# - 在类库中正确实现缓存以在 asp.net 应用程序中使用

> ID：156478
> 
> 赞同：9
> 
> 时间：2008-10-01T06:38:25.923
> 
> 标签：c#, asp.net, caching, garbage-collection, singleton

我正在我在 asp.net 应用程序中使用的类库中实现缓存。

我使用静态方法将缓存对象创建为单例模式来更新缓存，该方法实际上只是用我需要缓存的数据集合加载成员变量/属性（当然有一些锁定逻辑）。我认为这是一个不错的方法，因为我可以通过调用来访问我的数据

```
MyCacheObject.Instance.MyDataCollection 
```

我正在创建一个新的缓存对象来存储由某个键分区的大量数据。我要说的是我正在创建一个新的缓存，但是这个缓存不会一次加载所有数据，而是为每个访问的键存储一个集合。

```
MyOtherCacheObject.Instance.MyOtherDataCollection(indexkey) 
```

这次提出了关于垃圾收集的问题。由于我正在存储大量数据，如果它突然被 gc'ed 会不会是一种浪费？由于它只是一个单例模式，因此无法确保数据保留在缓存中。

所以我的问题是 - 实现缓存来处理这种情况的最佳做法是什么？我真的不喜欢一个非常复杂的解决方案，而且我知道 System.Web 中有缓存，但这似乎有点“离题”，因为这只是一个类库，或者你怎么看？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-01T06:59:10.850

在我看来，最好的解决方案应具有以下特点：

*   使用平台提供的可用缓存服务，尽量避免自己编写。

*   不将您的类库耦合到 System.Web，以使层保持一致。

*   但是，如果类库在 ASP.NET 应用程序中运行，则解决方案不应该需要引入另一个缓存实现（例如，企业库缓存应用程序块），这需要额外的配置和设置。

因此，我将使用 IoC 策略，以允许类库根据其运行环境使用不同的缓存实现。

假设您将抽象缓存合约定义为：

```
public interface ICacheService 
{
    AddItem(...);
} 
```

您可以提供基于 System.Web 的实现：

```
public AspNetBasedCacheService : ICacheService
{
    AddItem(...)
    {
        // Implementation that uses the HttpContext.Cache object
    }
 } 
```

然后将该实现“发布”为单例。请注意，与原始方法的不同之处在于，单例只是对基于 ASP.NET 缓存服务的实现的引用，而不是完整的“缓存对象”。

```
public class CacheServiceProvider 
{
    public static ICacheService Instance {get; set;}

} 
```

您必须通过执行延迟初始化或在应用程序启动时（在 中`Global.asax.cs`）来初始化缓存实现

并且每个域组件都可以在不知道它是基于 System.Web 实现的情况下使用已发布的缓存服务。

```
// inside your class library:
ICacheService cache = CacheServiceProvider.Instance;
cache.AddItem(...); 
```

我同意这可能不是最简单的解决方案，但我的目标是在不牺牲代码解耦和灵活性的情况下利用 ASP.NET 缓存实现。

我希望我理解你的问题是正确的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-01T06:40:51.363

只要缓存仍然保留对数据的引用，数据就不会被垃圾收集。

另外，永远不要使用单例。

# caching - 如何在 ColdFusion 中正确实现共享缓存？

> ID：156492
> 
> 赞同：1
> 
> 时间：2008-10-01T06:49:56.287
> 
> 标签：caching, coldfusion, scope, locking

我已经构建了一个 CFC，旨在用作一个动态的、老化的缓存，用于几乎所有值得缓存的东西。LDAP 查询、函数结果、数组、对象，应有尽有。任何需要时间或资源来计算并且需要不止一次的东西。我希望能够做一些事情：

*   **在应用程序之间共享 CFC**
*   **定义缓存的范围（仅限服务器/应用程序/会话/当前请求）**
*   在同一个请求中同时使用不同的缓存实例
*   使用缓存组件独立于 CFC
*   一般遵守常识（解耦、封装、正交性、锁定）

我当然会为每个不同的任务使用不同的缓存实例，但我希望能够跨应用程序使用相同的 CFC。缓存本身（还有什么）是缓存实例私有的结构。当范围本身可能发生变化时，我将如何正确实现缓存和锁定？

对于锁定，我目前使用命名锁（`'CacheRead'`, `'CacheWrite'`），这是安全的，但让我觉得很奇怪。为什么我想要一个服务器范围的锁，比如说，一个仅限会话的操作？（是的，也许这*是*学术性的，但无论如何。）

当我想要应用程序级缓存时，将 APPLICATION 范围作为参考传递似乎也是错误的做法。有没有更好的办法？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-02T11:14:20.433

好的 - 因为我最初误解了你的问题，所以我删除了我之前的答案，以免造成任何进一步的混乱。

要回答有关锁定的问题：

命名锁应该没问题，因为它们不必总是具有相同的名称。您可以根据正在访问的缓存动态命名它们。当您需要访问私有结构的元素时，您可以执行一些操作，例如让命名锁使用密钥作为其名称。

这样，锁唯一会产生影响的情况是，如果某物试图按名称访问相同的缓存。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-27T17:19:09.650

我理解您希望避免传入要缓存到的实际范围结构，但您的选择是有限的。首先想到的是传递您希望存储缓存的范围的名称（字符串）并进行评估。就其性质而言，评估效率低下，应该避免。也就是说，我很好奇它是如何实现的。我没有你的代码，所以我在这里做了一个非常简单的“存储”抽象 CFC（跳过缓存，因为它与我想要测试的内容无关）：

**缓存.cfc：**

```
<cfcomponent>
    <cfset variables.cacheScope = "session" /><!--- default to session --->
    <cfset variables.cache = ""/>

    <cfscript>
    function init(scope){
        variables.cacheScope = arguments.scope;
        return this;
    }

    function cacheWrite(key, value){
        structInsert(evaluate(variables.cacheScope),arguments.key,arguments.value,true);
        return this;
    }

    function cacheRead(key){
        if (not structKeyExists(evaluate(variables.cacheScope), arguments.key)){
            return "";
        }else{
            variables.cache = evaluate(variables.cacheScope);
            return variables.cache[arguments.key];
        }
    }   
    </cfscript>
</cfcomponent> 
```

并对其进行测试：

```
<!--- clear out any existing session vars --->
<cfset structClear(session)/>
<!--- show empty session struct --->
<cfdump var="#session#" label="session vars">
<!--- create storage object --->
<cfset cacher = createObject("component", "cache").init("session")/>
<!--- store a value --->
<cfset cacher.cacheWrite("foo", "bar")/>
<!--- read stored value --->
<cfset rtn = cacher.cacheRead("foo")/>
<!--- show values --->
<cfdump var="#rtn#">
<cfdump var="#session#" label="session vars"> 
```

*题外话：我喜欢编写我的 setter 函数来返回“this”[如上所示]，这样我就可以像 jQuery 一样链接方法调用。部分视图可以很容易地写成：*

```
<cfset rtn = createObject("component", "cache")
    .init("session")
    .cacheWrite("foo", "bar")
    .cacheRead("foo")/> 
```

有趣的是，这是可能的，但由于 Evaluate 的间接成本，我可能不会在生产中使用它。我想说这是传递您要缓存到的范围的足够充分的理由。

如果您仍然对此感到困扰（也许是对的？），您可以创建另一个 CFC，从所需范围抽象读取和写入，并将其传递到您的缓存 CFC 作为存储位置（非常适合[ColdSpring](http://coldspringframework.org/)的任务） ，这样，如果您决定将缓存移动到另一个范围，则不必编辑 300 个页面，全部使用将“会话”传递给 init 的缓存 CFC，而是可以编辑 1 个 CFC 或您的 ColdSpring 配置。

但是，当您具有请求范围时，我不完全确定为什么要进行单请求缓存。如果您正在寻找一种为当前请求缓存某些内容并在不久之后将其终止的方法，那么请求范围可能就是您想要的。当跨越多个请求时，缓存通常更有价值。

# vsto - 开发后恢复办公环境默认

> ID：156493
> 
> 赞同：2
> 
> 时间：2008-10-01T06:50:44.477
> 
> 标签：vsto

在我使用 Visual Studio For Office 为 Microsoft Office 开发我的加载项（并且在此过程中弄乱了我所有的菜单栏和工具栏）之后，有没有办法将 MS Office 恢复为默认值？

郑重声明，仅靠清洁解决方案是***不够***的！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-01T06:52:55.017

你试过修理吗？始终拥有驱动器的更新映像，它会派上用场。

# .net - 如何将 Excel 工作簿写入 .NET 中的 MemoryStream？

> ID：156500
> 
> 赞同：14
> 
> 时间：2008-10-01T06:54:19.177
> 
> 标签：.net, excel

如何在`MemoryStream`不先将 Excel 工作簿保存到文件系统的情况下将其写入 a？

保存选项中的所有选项都`Microsoft.Office.Interop.Excel.WorkBook`采用文件名。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-01T07:07:54.107

我已经使用 PIA 完成了大量工作，并将 Excel 文件存储在文档存储库中并将其流式传输到浏览器，如果不先将内容写入文件系统，我无法找到使用 PIA 的解决方案。

我认为您将不得不忍气吞声，将文件系统作为中介来处理。好消息是您可以只给文件一个唯一的名称，如 guid 或使用其他一些 tempfilename 方法（不确定 .net 中是否存在），然后在完成后删除内容。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2010-05-17T05:14:25.750

这可以通过 Open XML SDK 2.0 完成。[Eric White 在Working with In-Memory Open XML Documents](http://blogs.msdn.com/ericwhite/archive/2008/12/10/working-with-in-memory-open-xml-documents.aspx)中有一篇关于如何在流中使用 OOXML 文件的精彩文章

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-04T14:16:54.917

另一种选择是使用[这个](http://www.carlosag.net/Tools/ExcelXmlWriter/)免费库来导出工作簿。工作簿类的保存方法可以采用文件名或流。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-01T07:14:31.297

如果您只需要 Excel 的基本功能，您可能希望将工作簿创建为 Html 流。[SO上有另一个问题可以处理这个问题](https://stackoverflow.com/questions/27288/how-do-i-save-a-datagrid-to-excel-in-vbnet)。

这也解决了与解决方案的可伸缩性有关的一些问题（您可能还没有）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-05-17T04:54:42.737

您可以这样做的唯一方法是，如果您准备创建一个自定义对象，该对象允许您存储您想要保留的所有各种数据/公式/vba/links/ole 对象，从您的工作簿复制到对象，然后将该对象持久化到内存流中。影响使用您的代理对象作为中间人。

没有办法（正如其他人所说）将 Excel 文件直接写入内存。

使用 Excel 2007 OpenXML 格式，您可以使用工作簿的 BeforeSave 事件来拥有一个自定义方法，该方法首先将 BeforeSave 事件的 Cancel 参数设置为 True，然后将生成的 xml 包（表示文件）序列化为一个对象在记忆中。

# java - 您如何断言在 JUnit 4 测试中引发了某个异常？

> ID：156503
> 
> 赞同：2171
> 
> 时间：2008-10-01T06:56:08.127
> 
> 标签：java, exception, junit, junit4, assert

如何以惯用方式使用 JUnit4 来测试某些代码是否引发异常？

虽然我当然可以做这样的事情：

```
@Test
public void testFooThrowsIndexOutOfBoundsException() {
  boolean thrown = false;

  try {
    foo.doStuff();
  } catch (IndexOutOfBoundsException e) {
    thrown = true;
  }

  assertTrue(thrown);
} 
```

我记得有一个注释或一个 Assert.xyz 或*其他东西*，在这种情况下，JUnit 的精神远不那么笨拙，而且更符合 JUnit 的精神。

* * *

## 回答 #1

> 赞同：2492
> 
> 时间：2008-10-01T07:12:13.440

这取决于 JUnit 版本和您使用的断言库。

*   对于 JUnit5 和 4.13，请参阅答案[https://stackoverflow.com/a/2935935/2986984](https://stackoverflow.com/a/2935935/2986984)
*   如果您使用 assertJ 或 google-truth，请参阅答案 [https://stackoverflow.com/a/41019785/2986984](https://stackoverflow.com/a/41019785/2986984)

的原始答案`JUnit <= 4.12`是：

```
@Test(expected = IndexOutOfBoundsException.class)
public void testIndexOutOfBoundsException() {

    ArrayList emptyList = new ArrayList();
    Object o = emptyList.get(0);

} 
```

虽然答案[https://stackoverflow.com/a/31826781/2986984](https://stackoverflow.com/a/31826781/2986984)有更多 JUnit <= 4.12 的选项。

参考 ：

*   [JUnit 测试-FAQ](https://junit.org/junit4/faq.html#atests_7)

* * *

## 回答 #2

> 赞同：1386
> 
> 时间：2010-05-29T17:16:23.680

**编辑：**现在 JUnit 5 和 JUnit 4.13 已经发布，最好的选择是使用[`Assertions.assertThrows()`](https://junit.org/junit5/docs/current/user-guide/#extensions-exception-handling) （对于 JUnit 5）和[`Assert.assertThrows()`](https://junit.org/junit4/javadoc/latest/org/junit/Assert.html#assertThrows(java.lang.Class,%20org.junit.function.ThrowingRunnable))（对于 JUnit 4.13+）。有关详细信息，请参阅[我的其他答案](https://stackoverflow.com/a/46514550/95725)。

如果您还没有迁移到 JUnit 5，但可以使用 JUnit 4.7，则可以使用[`ExpectedException`](http://junit.org/javadoc/latest/org/junit/rules/ExpectedException.html)Rule：

```
public class FooTest {
  @Rule
  public final ExpectedException exception = ExpectedException.none();

  @Test
  public void doStuffThrowsIndexOutOfBoundsException() {
    Foo foo = new Foo();

    exception.expect(IndexOutOfBoundsException.class);
    foo.doStuff();
  }
} 
```

这比因为如果之前抛出`@Test(expected=IndexOutOfBoundsException.class)`测试将失败要好得多`IndexOutOfBoundsException``foo.doStuff()`

有关详细信息，请参阅[本文](http://www.infoq.com/news/2009/07/junit-4.7-rules)。

* * *

## 回答 #3

> 赞同：494
> 
> 时间：2008-10-01T09:31:46.943

小心使用预期异常，因为它只断言该**方法**抛出了该异常，而不是测试中的**特定代码行**。

我倾向于使用它来测试参数验证，因为这些方法通常非常简单，但更复杂的测试可能会更好地使用：

```
try {
    methodThatShouldThrow();
    fail( "My method didn't throw when I expected it to" );
} catch (MyException expectedException) {
} 
```

应用判断。

* * *

## 回答 #4

> 赞同：219
> 
> 时间：2014-07-07T22:35:19.753

如前所述，在 JUnit 中有多种处理异常的方法。但是在 Java 8 中还有另一个：使用 Lambda 表达式。使用 Lambda 表达式，我们可以实现如下语法：

```
@Test
public void verifiesTypeAndMessage() {
    assertThrown(new DummyService()::someMethod)
            .isInstanceOf(RuntimeException.class)
            .hasMessage("Runtime exception occurred")
            .hasMessageStartingWith("Runtime")
            .hasMessageEndingWith("occurred")
            .hasMessageContaining("exception")
            .hasNoCause();
} 
```

assertThrown 接受一个函数式接口，其实例可以使用 lambda 表达式、方法引用或构造函数引用创建。接受该接口的 assertThrown 将期望并准备好处理异常。

这是一种相对简单但功能强大的技术。

看看这篇描述这种技术的博客文章：http: [//blog.codeleak.pl/2014/07/junit-testing-exception-with-java-8-and-lambda-expressions.html](http://blog.codeleak.pl/2014/07/junit-testing-exception-with-java-8-and-lambda-expressions.html)

源代码可以在这里找到：[https ://github.com/kolorobot/unit-testing-demo/tree/master/src/test/java/com/github/kolorobot/exceptions/java8](https://github.com/kolorobot/unit-testing-demo/tree/master/src/test/java/com/github/kolorobot/exceptions/java8)

*披露：我是博客和项目的作者。*

* * *

## 回答 #5

> 赞同：197
> 
> 时间：2015-08-05T08:05:50.707

在junit中，有四种方法可以测试异常。

## junit5.x

*   对于junit5.x，您可以使用`assertThrows`如下

    ```
    @Test
    public void testFooThrowsIndexOutOfBoundsException() {
        Throwable exception = assertThrows(IndexOutOfBoundsException.class, () -> foo.doStuff());
        assertEquals("expected messages", exception.getMessage());
    } 
    ```

## junit4.x

*   对于 junit4.x，使用 Test annonation 的可选 'expected' 属性

    ```
    @Test(expected = IndexOutOfBoundsException.class)
    public void testFooThrowsIndexOutOfBoundsException() {
        foo.doStuff();
    } 
    ```

*   对于 junit4.x，使用 ExpectedException 规则

    ```
    public class XxxTest {
        @Rule
        public ExpectedException thrown = ExpectedException.none();

        @Test
        public void testFooThrowsIndexOutOfBoundsException() {
            thrown.expect(IndexOutOfBoundsException.class)
            //you can test the exception message like
            thrown.expectMessage("expected messages");
            foo.doStuff();
        }
    } 
    ```

*   您还可以使用在 junit 3 框架下广泛使用的经典 try/catch 方式

    ```
    @Test
    public void testFooThrowsIndexOutOfBoundsException() {
        try {
            foo.doStuff();
            fail("expected exception was not occured.");
        } catch(IndexOutOfBoundsException e) {
            //if execution reaches here, 
            //it indicates this exception was occured.
            //so we need not handle it.
        }
    } 
    ```

*   所以

    *   如果你喜欢junit 5，那么你应该喜欢第一个
    *   当您只想测试异常类型时使用第二种方法
    *   当您想要进一步测试异常消息时使用第一个和最后两个
    *   如果您使用 junit 3，则首选第 4 个
*   有关详细信息，您可以阅读[此文档](https://github.com/junit-team/junit/wiki/Exception-testing)和[junit5 用户指南](https://junit.org/junit5/docs/current/user-guide/)了解详细信息。

* * *

## 回答 #6

> 赞同：131
> 
> 时间：2016-12-07T14:19:24.347

**tl;博士**

*   post-JDK8 ：使用**AssertJ**或自定义 lambda 断言*异常*行为。

*   pre-JDK8 ：我会推荐旧的好`try`-`catch`块。（*不要忘记在块`fail()`之前添加一个断言`catch`*）

*不管是 Junit 4 还是 JUnit 5。*

**长篇大论**

可以自己编写一个*自己动手* `try`-`catch`阻止或使用 JUnit 工具（`@Test(expected = ...)`或`@Rule ExpectedException`JUnit 规则功能）。

但是这些方法并不那么优雅，并且不能很好地将*可读性*与其他工具混合。此外，JUnit 工具确实存在一些缺陷。

1.  -块您必须围绕测试`try`的`catch`行为编写块并在 catch 块中写入断言，这可能很好，但许多人发现这种样式会中断测试的读取流程。此外，您需要`Assert.fail`在块的末尾写一个`try`。否则，测试可能会错过断言的一侧；*PMD*、*findbugs*或*Sonar*会发现此类问题。

2.  该`@Test(expected = ...)`功能很有趣，因为您可以编写更少的代码，然后编写此测试据说不太容易出现编码错误。**但**这种方法在某些领域是缺乏的。

    *   如果测试需要检查异常的其他内容，例如原因或消息（好的异常消息非常重要，拥有精确的异常类型可能还不够）。
    *   此外，由于期望被放置在方法中，根据测试代码的编写方式，测试代码的错误部分可能会引发异常，导致误报测试，我不确定*PMD*、*findbugs*或*Sonar*将提供有关此类代码的提示。

        ```
        @Test(expected = WantedException.class)
        public void call2_should_throw_a_WantedException__not_call1() {
            // init tested
            tested.call1(); // may throw a WantedException

            // call to be actually tested
            tested.call2(); // the call that is supposed to raise an exception
        } 
        ```

3.  该`ExpectedException`规则也是尝试修复之前的警告，但是使用起来感觉有点尴尬，因为它使用了期望样式，*EasyMock*用户非常了解这种样式。这对某些人来说可能很方便，但是如果您遵循*行为驱动开发*(BDD) 或*安排行为断言*(AAA) 原则，则该`ExpectedException`规则将不适合这些写作风格。除此之外，它可能会遇到与方式相同的问题`@Test`，具体取决于您将期望放在哪里。

    ```
    @Rule ExpectedException thrown = ExpectedException.none()

    @Test
    public void call2_should_throw_a_WantedException__not_call1() {
        // expectations
        thrown.expect(WantedException.class);
        thrown.expectMessage("boom");

        // init tested
        tested.call1(); // may throw a WantedException

        // call to be actually tested
        tested.call2(); // the call that is supposed to raise an exception
    } 
    ```

    即使预期的异常放在测试语句之前，如果测试遵循 BDD 或 AAA，它也会破坏您的阅读流程。

    另外，请[参阅](https://github.com/junit-team/junit4/issues/706#issuecomment-21385116)`ExpectedException`. [JUnit 4.13-beta-2](https://github.com/junit-team/junit4/wiki/4.13-Release-Notes)甚至弃用了这种机制：

    > [拉取请求 #1519](https://github.com/junit-team/junit4/pull/1519)：弃用 ExpectedException
    > 
    > Assert.assertThrows 方法提供了一种更好的方法来验证异常。此外，ExpectedException 的使用在与 TestWatcher 等其他规则一起使用时容易出错，因为在这种情况下规则的顺序很重要。

因此，上述这些选项有很多警告，显然不能避免编码错误。

4.  在创建这个看起来很有希望的答案后，我意识到了一个项目，它是[**catch-exception**](https://github.com/Codearte/catch-exception)。

    正如该项目的描述所说，它让编码人员用流畅的代码行编写捕获异常并为后一个断言提供此异常。您可以使用任何断言库，例如[Hamcrest](https://github.com/hamcrest/JavaHamcrest)或[AssertJ](https://github.com/joel-costigliola/assertj-core)。

    取自主页的快速示例：

    ```
    // given: an empty list
    List myList = new ArrayList();

    // when: we try to get the first element of the list
    when(myList).get(1);

    // then: we expect an IndexOutOfBoundsException
    then(caughtException())
            .isInstanceOf(IndexOutOfBoundsException.class)
            .hasMessage("Index: 1, Size: 0") 
            .hasNoCause(); 
    ```

    如您所见，代码非常简单，您在特定行捕获异常，`then`API 是一个别名，将使用 AssertJ API（类似于 using `assertThat(ex).hasNoCause()...`）。*在某些时候，该项目依赖于 AssertJ 的祖先 FEST-Assert*。**编辑：**似乎该项目正在酝酿对 Java 8 Lambdas 的支持。

    目前，这个库有两个缺点：

    *   在撰写本文时，值得注意的是该库基于 Mockito 1.x，因为它在幕后创建了测试对象的模拟。由于 Mockito 仍未更新**，因此此库无法与最终类或最终方法一起使用**。即使它基于当前版本的 Mockito 2，这也需要声明一个全局模拟生成器 ( `inline-mock-maker`)，这可能不是您想要的，因为这个模拟生成器与常规模拟生成器有不同的缺点。

    *   它需要另一个测试依赖项。

    一旦库支持 lambda，这些问题将不适用。但是，AssertJ 工具集将复制该功能。

    **综合考虑如果不想使用catch-exception工具的话，我会推荐`try`-`catch`块的老好办法，至少到JDK7。对于 JDK 8 用户，您可能更喜欢使用 AssertJ，因为它提供的可能不仅仅是断言异常。**

5.  在 JDK8 中，lambda 进入了测试场景，事实证明它们是一种断言异常行为的有趣方式。AssertJ 已经更新，提供了一个很好的流畅的 API 来断言异常行为。

    [以及使用AssertJ](http://joel-costigliola.github.io/assertj/)的示例测试：

    ```
    @Test
    public void test_exception_approach_1() {
        ...
        assertThatExceptionOfType(IOException.class)
                .isThrownBy(() -> someBadIOOperation())
                .withMessage("boom!"); 
    }

    @Test
    public void test_exception_approach_2() {
        ...
        assertThatThrownBy(() -> someBadIOOperation())
                .isInstanceOf(Exception.class)
                .hasMessageContaining("boom");
    }

    @Test
    public void test_exception_approach_3() {
        ...
        // when
        Throwable thrown = catchThrowable(() -> someBadIOOperation());

        // then
        assertThat(thrown).isInstanceOf(Exception.class)
                          .hasMessageContaining("boom");
    } 
    ```

6.  随着对 JUnit 5 的近乎完整的重写，断言得到了一些[改进](http://junit.org/junit5/docs/current/user-guide/#writing-tests-assertions)，它们可能被证明是一种有趣的开箱即用的方式来正确断言异常。但实际上断言 API 还是有点差，外面什么都没有[`assertThrows`](http://junit.org/junit5/docs/current/api/org/junit/jupiter/api/Assertions.html#assertThrows-java.lang.Class-org.junit.jupiter.api.function.Executable-)。

    ```
    @Test
    @DisplayName("throws EmptyStackException when peeked")
    void throwsExceptionWhenPeeked() {
        Throwable t = assertThrows(EmptyStackException.class, () -> stack.peek());

        Assertions.assertEquals("...", t.getMessage());
    } 
    ```

    正如您所注意到的，`assertEquals`它仍在返回`void`，因此不允许像 AssertJ 那样链接断言。

    此外，如果您记得名字与`Matcher`or发生冲突`Assert`，请准备好与 . 发生相同的冲突`Assertions`。

我想得出结论，今天 (2017-03-03) **AssertJ**的易用性、可发现的 API、快速的开发速度以及作为*事实上的*测试依赖项是 JDK8 的最佳解决方案，无论测试框架如何（JUnit与否），以前的 JDK 应该改为依赖**`try`-`catch`**块，即使它们感觉很笨重。

*[这个答案是从另一个](https://stackoverflow.com/a/17428439/48136)不具有相同可见性的问题中复制的，我是同一位作者。*

* * *

## 回答 #7

> 赞同：80
> 
> 时间：2017-10-01T16:42:29.670

现在 JUnit 5 和 JUnit 4.13 已经发布，最好的选择是使用`Assertions.assertThrows()` (for JUnit 5) 和`Assert.assertThrows()`(for JUnit 4.13)。请参阅[JUnit 5 用户指南](http://junit.org/junit5/docs/current/user-guide/#extensions-exception-handling)。

这是一个验证抛出异常的示例，并使用[Truth](http://google.github.io/truth/)对异常消息进行断言：

```
public class FooTest {
  @Test
  public void doStuffThrowsIndexOutOfBoundsException() {
    Foo foo = new Foo();

    IndexOutOfBoundsException e = assertThrows(
        IndexOutOfBoundsException.class, foo::doStuff);

    assertThat(e).hasMessageThat().contains("woops!");
  }
} 
```

与其他答案中的方法相比的优点是：

1.  内置于 JUnit
2.  如果 lambda 中的代码没有抛出异常，您会收到一条有用的异常消息，如果它抛出不同的异常，您会收到一个堆栈跟踪
3.  简洁的
4.  允许您的测试遵循 Arrange-Act-Assert
5.  您可以准确地指出您希望抛​​出异常的代码
6.  您不需要在`throws`子句中列出预期的异常
7.  您可以使用您选择的断言框架对捕获的异常进行断言

* * *

## 回答 #8

> 赞同：44
> 
> 时间：2008-10-01T07:03:01.870

怎么样：捕获一个非常普遍的异常，确保它脱离了 catch 块，然后断言异常的类是你所期望的。如果 a) 异常的类型错误（例如，如果您有一个空指针）并且 b) 从未抛出异常，则此断言将失败。

```
public void testFooThrowsIndexOutOfBoundsException() {
  Throwable e = null;

  try {
    foo.doStuff();
  } catch (Throwable ex) {
    e = ex;
  }

  assertTrue(e instanceof IndexOutOfBoundsException);
} 
```

* * *

## 回答 #9

> 赞同：42
> 
> 时间：2017-01-10T01:29:43.843

**更新：** JUnit5 对异常测试进行了改进：`assertThrows`.

以下示例来自：[Junit 5 用户指南](http://junit.org/junit5/docs/current/user-guide/#extensions-exception-handling)

```
@Test
void exceptionTesting() {
    IllegalArgumentException exception = assertThrows(IllegalArgumentException.class, () -> {
        throw new IllegalArgumentException("a message");
    });
    assertEquals("a message", exception.getMessage());
} 
```

**使用 JUnit 4 的原始答案。**

有几种方法可以测试是否引发了异常。我还在我的帖子[How to write great unit tests with JUnit中讨论了以下选项](https://javacodehouse.com/junit-tutorial)

设置`expected`参数`@Test(expected = FileNotFoundException.class)`。

```
@Test(expected = FileNotFoundException.class) 
public void testReadFile() { 
    myClass.readFile("test.txt");
} 
```

使用`try` `catch`

```
public void testReadFile() { 
    try {
        myClass.readFile("test.txt");
        fail("Expected a FileNotFoundException to be thrown");
    } catch (FileNotFoundException e) {
        assertThat(e.getMessage(), is("The file test.txt does not exist!"));
    }

} 
```

用`ExpectedException`规则测试。

```
@Rule
public ExpectedException thrown = ExpectedException.none();

@Test
public void testReadFile() throws FileNotFoundException {

    thrown.expect(FileNotFoundException.class);
    thrown.expectMessage(startsWith("The file test.txt"));
    myClass.readFile("test.txt");
} 
```

您可以在 JUnit4 wiki 中阅读有关异常测试的更多信息，以[获取 Exception testing](https://github.com/junit-team/junit4/wiki/Exception-testing)和[bad.robot - Expecting Exceptions JUnit Rule](http://baddotrobot.com/blog/2012/03/27/expecting-exception-with-junit-rule/index.html)。

* * *

## 回答 #10

> 赞同：41
> 
> 时间：2016-03-05T11:07:24.873

使用[AssertJ](http://joel-costigliola.github.io/assertj/)断言，它可以与 JUnit 一起使用：

```
import static org.assertj.core.api.Assertions.*;

@Test
public void testFooThrowsIndexOutOfBoundsException() {
  Foo foo = new Foo();

  assertThatThrownBy(() -> foo.doStuff())
        .isInstanceOf(IndexOutOfBoundsException.class);
} 
```

这比`@Test(expected=IndexOutOfBoundsException.class)`因为它保证测试中的预期行抛出异常并让您检查有关异常的更多详细信息（例如消息）更容易：

```
assertThatThrownBy(() ->
       {
         throw new Exception("boom!");
       })
    .isInstanceOf(Exception.class)
    .hasMessageContaining("boom"); 
```

[此处的 Maven/Gradle 说明。](http://joel-costigliola.github.io/assertj/assertj-core-quick-start.html)

* * *

## 回答 #11

> 赞同：39
> 
> 时间：2013-11-15T19:17:15.083

## [BDD](http://guide.agilealliance.org/guide/gwt.html)风格解决方案：[JUnit 4](http://junit.org/) + [Catch Exception](https://github.com/Codearte/catch-exception) + [AssertJ](http://joel-costigliola.github.io/assertj/)

```
import static com.googlecode.catchexception.apis.BDDCatchException.*;

@Test
public void testFooThrowsIndexOutOfBoundsException() {

    when(() -> foo.doStuff());

    then(caughtException()).isInstanceOf(IndexOutOfBoundsException.class);

} 
```

## 依赖项

```
eu.codearte.catch-exception:catch-exception:2.0 
```

* * *

## 回答 #12

> 赞同：33
> 
> 时间：2011-10-28T09:26:21.140

为了解决同样的问题，我建立了一个小项目： [http ://code.google.com/p/catch-exception/](http://code.google.com/p/catch-exception/)

使用这个小助手你会写

```
verifyException(foo, IndexOutOfBoundsException.class).doStuff(); 
```

这比 JUnit 4.7 的 ExpectedException 规则更简洁。与 skaffman 提供的解决方案相比，您可以指定您期望在哪一行代码中出现异常。我希望这有帮助。

* * *

## 回答 #13

> 赞同：22
> 
> 时间：2013-05-07T17:17:18.507

你也可以这样做：

```
@Test
public void testFooThrowsIndexOutOfBoundsException() {
    try {
        foo.doStuff();
        assert false;
    } catch (IndexOutOfBoundsException e) {
        assert true;
    }
} 
```

* * *

## 回答 #14

> 赞同：14
> 
> 时间：2015-03-10T21:49:47.260

恕我直言，在 JUnit 中检查异常的最佳方法是 try/catch/fail/assert 模式：

```
// this try block should be as small as possible,
// as you want to make sure you only catch exceptions from your code
try {
    sut.doThing();
    fail(); // fail if this does not throw any exception
} catch(MyException e) { // only catch the exception you expect,
                         // otherwise you may catch an exception for a dependency unexpectedly
    // a strong assertion on the message, 
    // in case the exception comes from anywhere an unexpected line of code,
    // especially important if your checking IllegalArgumentExceptions
    assertEquals("the message I get", e.getMessage()); 
} 
```

对`assertTrue`某些人来说可能有点强，所以`assertThat(e.getMessage(), containsString("the message");`可能更可取。

* * *

## 回答 #15

> 赞同：13
> 
> 时间：2016-07-24T15:00:31.500

## JUnit 5 解决方案

```
@Test
void testFooThrowsIndexOutOfBoundsException() {    
  IndexOutOfBoundsException exception = expectThrows(IndexOutOfBoundsException.class, foo::doStuff);

  assertEquals("some message", exception.getMessage());
} 
```

有关 JUnit 5 的更多信息，请访问[http://junit.org/junit5/docs/current/user-guide/#writing-tests-assertions](http://junit.org/junit5/docs/current/user-guide/#writing-tests-assertions)

* * *

## 回答 #16

> 赞同：13
> 
> 时间：2018-01-25T11:10:01.210

我在[Mkyong 博客](https://www.mkyong.com/unittest/junit-4-tutorial-2-expected-exception-test/)中找到的 Junit 4 最灵活和优雅的答案。它具有`try/catch`使用`@Rule`注释的灵活性。我喜欢这种方法，因为您可以读取自定义异常的特定属性。

```
package com.mkyong;

import com.mkyong.examples.CustomerService;
import com.mkyong.examples.exception.NameNotFoundException;
import org.junit.Rule;
import org.junit.Test;
import org.junit.rules.ExpectedException;

import static org.hamcrest.CoreMatchers.containsString;
import static org.hamcrest.CoreMatchers.is;
import static org.hamcrest.Matchers.hasProperty;

public class Exception3Test {

    @Rule
    public ExpectedException thrown = ExpectedException.none();

    @Test
    public void testNameNotFoundException() throws NameNotFoundException {

        //test specific type of exception
        thrown.expect(NameNotFoundException.class);

        //test message
        thrown.expectMessage(is("Name is empty!"));

        //test detail
        thrown.expect(hasProperty("errCode"));  //make sure getters n setters are defined.
        thrown.expect(hasProperty("errCode", is(666)));

        CustomerService cust = new CustomerService();
        cust.findByName("");

    }

} 
```

* * *

## 回答 #17

> 赞同：12
> 
> 时间：2012-10-10T15:02:44.930

我在这里尝试了很多方法，但它们要么很复杂，要么不太符合我的要求。事实上，可以很简单地编写一个辅助方法：

```
public class ExceptionAssertions {
    public static void assertException(BlastContainer blastContainer ) {
        boolean caughtException = false;
        try {
            blastContainer.test();
        } catch( Exception e ) {
            caughtException = true;
        }
        if( !caughtException ) {
            throw new AssertionFailedError("exception expected to be thrown, but was not");
        }
    }
    public static interface BlastContainer {
        public void test() throws Exception;
    }
} 
```

像这样使用它：

```
assertException(new BlastContainer() {
    @Override
    public void test() throws Exception {
        doSomethingThatShouldExceptHere();
    }
}); 
```

零依赖：不需要mockito，不需要powermock；并且适用于最终课程。

* * *

## 回答 #18

> 赞同：11
> 
> 时间：2008-10-01T07:05:49.260

JUnit 对此具有内置支持，具有[“预期”属性](http://junit.sourceforge.net/doc/faq/faq.htm#tests_7)。

* * *

## 回答 #19

> 赞同：10
> 
> 时间：2015-12-18T18:52:21.533

# Java 8 解决方案

如果您想要一个解决方案：

*   利用 Java 8 lambda
*   不*依赖*于任何 JUnit 魔法
*   允许您在单个测试方法中检查多个异常
*   检查测试方法中的一组特定行引发的异常，而不是整个测试方法中的任何未知行
*   产生实际抛出的异常对象，以便您可以进一步检查它

这是我写的一个实用函数：

```
public final <T extends Throwable> T expectException( Class<T> exceptionClass, Runnable runnable )
{
    try
    {
        runnable.run();
    }
    catch( Throwable throwable )
    {
        if( throwable instanceof AssertionError && throwable.getCause() != null )
            throwable = throwable.getCause(); //allows testing for "assert x != null : new IllegalArgumentException();"
        assert exceptionClass.isInstance( throwable ) : throwable; //exception of the wrong kind was thrown.
        assert throwable.getClass() == exceptionClass : throwable; //exception thrown was a subclass, but not the exact class, expected.
        @SuppressWarnings( "unchecked" )
        T result = (T)throwable;
        return result;
    }
    assert false; //expected exception was not thrown.
    return null; //to keep the compiler happy.
} 
```

（[取自我的博客](http://blog.michael.gr/2014/09/assertions-and-testing.html)）

按如下方式使用它：

```
@Test
public void testMyFunction()
{
    RuntimeException e = expectException( RuntimeException.class, () -> 
        {
            myFunction();
        } );
    assert e.getMessage().equals( "I haz fail!" );
}

public void myFunction()
{
    throw new RuntimeException( "I haz fail!" );
} 
```

* * *

## 回答 #20

> 赞同：9
> 
> 时间：2013-07-02T09:03:57.030

就我而言，我总是从 db 获得 RuntimeException，但消息不同。并且异常需要分别处理。这是我测试它的方法：

```
@Test
public void testThrowsExceptionWhenWrongSku() {

    // Given
    String articleSimpleSku = "999-999";
    int amountOfTransactions = 1;
    Exception exception = null;

    // When
    try {
        createNInboundTransactionsForSku(amountOfTransactions, articleSimpleSku);
    } catch (RuntimeException e) {
        exception = e;
    }

    // Then
    shouldValidateThrowsExceptionWithMessage(exception, MESSAGE_NON_EXISTENT_SKU);
}

private void shouldValidateThrowsExceptionWithMessage(final Exception e, final String message) {
    assertNotNull(e);
    assertTrue(e.getMessage().contains(message));
} 
```

* * *

## 回答 #21

> 赞同：6
> 
> 时间：2013-06-05T20:12:23.413

只需制作一个可以关闭和打开的 Matcher，如下所示：

```
public class ExceptionMatcher extends BaseMatcher<Throwable> {
    private boolean active = true;
    private Class<? extends Throwable> throwable;

    public ExceptionMatcher(Class<? extends Throwable> throwable) {
        this.throwable = throwable;
    }

    public void on() {
        this.active = true;
    }

    public void off() {
        this.active = false;
    }

    @Override
    public boolean matches(Object object) {
        return active && throwable.isAssignableFrom(object.getClass());
    }

    @Override
    public void describeTo(Description description) {
        description.appendText("not the covered exception type");
    }
} 
```

要使用它：

添加`public ExpectedException exception = ExpectedException.none();`，然后：

```
ExceptionMatcher exMatch = new ExceptionMatcher(MyException.class);
exception.expect(exMatch);
someObject.somethingThatThrowsMyException();
exMatch.off(); 
```

* * *

## 回答 #22

> 赞同：6
> 
> 时间：2015-03-09T11:21:37.587

我们可以在必须返回异常的方法之后使用断言失败：

```
try{
   methodThatThrowMyException();
   Assert.fail("MyException is not thrown !");
} catch (final Exception exception) {
   // Verify if the thrown exception is instance of MyException, otherwise throws an assert failure
   assertTrue(exception instanceof MyException, "An exception other than MyException is thrown !");
   // In case of verifying the error message
   MyException myException = (MyException) exception;
   assertEquals("EXPECTED ERROR MESSAGE", myException.getMessage());
} 
```

* * *

## 回答 #23

> 赞同：6
> 
> 时间：2016-12-08T05:48:19.703

在 JUnit 4 或更高版本中，您可以按如下方式测试异常

```
@Rule
public ExpectedException exceptions = ExpectedException.none(); 
```

这提供了许多可用于改进 JUnit 测试的功能。
如果您看到下面的示例，我正在对异常进行 3 项测试。

1.  抛出的异常类型
2.  异常消息
3.  异常的原因

```
public class MyTest {

    @Rule
    public ExpectedException exceptions = ExpectedException.none();

    ClassUnderTest classUnderTest;

    @Before
    public void setUp() throws Exception {
        classUnderTest = new ClassUnderTest();
    }

    @Test
    public void testAppleisSweetAndRed() throws Exception {

        exceptions.expect(Exception.class);
        exceptions.expectMessage("this is the exception message");
        exceptions.expectCause(Matchers.<Throwable>equalTo(exceptionCause));

        classUnderTest.methodUnderTest("param1", "param2");
    }

} 
```

* * *

## 回答 #24

> 赞同：5
> 
> 时间：2015-05-22T19:09:24.103

除了[NamShubWriter](https://stackoverflow.com/users/95725/namshubwriter)所说的，请确保：

*   ExpectedException 实例是**公开**的（[相关问题](https://stackoverflow.com/questions/14335558/why-rule-annotated-fields-in-junit-has-to-be-public)）
*   ExpectedException**没有**在 @Before 方法中实例化。这篇[文章](https://garygregory.wordpress.com/2011/09/25/understaning-junit-method-order-execution/)清楚地解释了 JUnit 执行顺序的所有复杂性。

不**要这样做**：

```
@Rule    
public ExpectedException expectedException;

@Before
public void setup()
{
    expectedException = ExpectedException.none();
} 
```

最后，[这篇](http://jakegoulding.com/blog/2012/09/26/be-careful-when-using-junit-expected-exceptions/)博文清楚地说明了如何断言某个异常被抛出。

* * *

## 回答 #25

> 赞同：4
> 
> 时间：2018-04-06T15:52:07.077

使用 Java8 的 Junit4 解决方案是使用此功能：

```
public Throwable assertThrows(Class<? extends Throwable> expectedException, java.util.concurrent.Callable<?> funky) {
    try {
        funky.call();
    } catch (Throwable e) {
        if (expectedException.isInstance(e)) {
            return e;
        }
        throw new AssertionError(
                String.format("Expected [%s] to be thrown, but was [%s]", expectedException, e));
    }
    throw new AssertionError(
            String.format("Expected [%s] to be thrown, but nothing was thrown.", expectedException));
} 
```

那么用法是：

```
 assertThrows(ValidationException.class,
            () -> finalObject.checkSomething(null)); 
```

请注意，唯一的限制是`final`在 lambda 表达式中使用对象引用。该解决方案允许继续测试断言，而不是期望使用`@Test(expected = IndexOutOfBoundsException.class)`解决方案在方法级别上进行测试。

* * *

## 回答 #26

> 赞同：4
> 
> 时间：2018-07-18T11:32:37.163

我推荐库`assertj-core`来处理junit测试中的异常

在 java 8 中，像这样：

```
//given

//when
Throwable throwable = catchThrowable(() -> anyService.anyMethod(object));

//then
AnyException anyException = (AnyException) throwable;
assertThat(anyException.getMessage()).isEqualTo("........");
assertThat(exception.getCode()).isEqualTo(".......); 
```

* * *

## 回答 #27

> 赞同：2
> 
> 时间：2020-05-12T21:48:39.460

JUnit框架有**`assertThrows()`**方法：

```
ArithmeticException exception = assertThrows(ArithmeticException.class, () ->
    calculator.divide(1, 0));
assertEquals("/ by zero", exception.getMessage()); 
```

*   对于 JUnit 5，它在[`org.junit.jupiter.api.Assertions`](https://junit.org/junit5/docs/current/api/org.junit.jupiter.api/org/junit/jupiter/api/Assertions.html#assertThrows(java.lang.Class,org.junit.jupiter.api.function.Executable))课堂上；
*   对于 JUnit 4.13，它在[`org.junit.Assert`](https://junit.org/junit4/javadoc/latest/org/junit/Assert.html#assertThrows(java.lang.Class,%20org.junit.function.ThrowingRunnable))课堂上；
*   对于 JUnit 4 的早期版本：只需在[`org.junit.jupiter:junit-jupiter-api`](https://search.maven.org/artifact/org.junit.jupiter/junit-jupiter-api)您的项目中添加引用，您就会从 JUnit 5 获得完美运行的版本。

* * *

## 回答 #28

> 赞同：1
> 
> 时间：2016-10-29T07:34:18.383

举个例子，你想为下面提到的代码片段编写 Junit

```
public int divideByZeroDemo(int a,int b){

    return a/b;
}

public void exceptionWithMessage(String [] arr){

    throw new ArrayIndexOutOfBoundsException("Array is out of bound");
} 
```

上面的代码是测试可能发生的一些未知异常，下面的代码是用自定义消息断言一些异常。

```
 @Rule
public ExpectedException exception=ExpectedException.none();

private Demo demo;
@Before
public void setup(){

    demo=new Demo();
}
@Test(expected=ArithmeticException.class)
public void testIfItThrowsAnyException() {

    demo.divideByZeroDemo(5, 0);

}

@Test
public void testExceptionWithMessage(){

    exception.expectMessage("Array is out of bound");
    exception.expect(ArrayIndexOutOfBoundsException.class);
    demo.exceptionWithMessage(new String[]{"This","is","a","demo"});
} 
```

* * *

## 回答 #29

> 赞同：1
> 
> 时间：2017-10-01T12:03:38.217

使用 Java 8，您可以创建一个方法，将代码检查和预期的异常作为参数：

```
private void expectException(Runnable r, Class<?> clazz) { 
    try {
      r.run();
      fail("Expected: " + clazz.getSimpleName() + " but not thrown");
    } catch (Exception e) {
      if (!clazz.isInstance(e)) fail("Expected: " + clazz.getSimpleName() + " but " + e.getClass().getSimpleName() + " found", e);
    }
  } 
```

然后在你的测试中：

```
expectException(() -> list.sublist(0, 2).get(2), IndexOutOfBoundsException.class); 
```

好处：

*   不依赖任何库
*   本地化检查 - 更精确，如果需要，允许在一个测试中拥有多个这样的断言
*   便于使用

* * *

## 回答 #30

> 赞同：1
> 
> 时间：2019-04-16T12:54:07.833

```
 @Test(expectedException=IndexOutOfBoundsException.class) 
    public void  testFooThrowsIndexOutOfBoundsException() throws Exception {
         doThrow(IndexOutOfBoundsException.class).when(foo).doStuff();  
         try {
             foo.doStuff(); 
            } catch (IndexOutOfBoundsException e) {
                       assertEquals(IndexOutOfBoundsException .class, ex.getCause().getClass());
                      throw e;

               }

    } 
```

这是另一种检查方法是否抛出正确异常的方法。

* * *

## 回答 #31

> 赞同：0
> 
> 时间：2017-10-04T11:06:42.287

我使用 Java 8 lambda 的解决方案：

```
public static <T extends Throwable> T assertThrows(Class<T> expected, ThrowingRunnable action) throws Throwable {
    try {
        action.run();
        Assert.fail("Did not throw expected " + expected.getSimpleName());
        return null; // never actually
    } catch (Throwable actual) {
        if (!expected.isAssignableFrom(actual.getClass())) { // runtime '!(actual instanceof expected)'
            System.err.println("Threw " + actual.getClass().getSimpleName() 
                               + ", which is not a subtype of expected " 
                               + expected.getSimpleName());
            throw actual; // throw the unexpected Throwable for maximum transparency
        } else {
            return (T) actual; // return the expected Throwable for further examination
        }
    }
} 
```

您必须定义一个 FunctionalInterface，因为`Runnable`没有声明 required `throws`。

```
@FunctionalInterface
public interface ThrowingRunnable {
    void run() throws Throwable;
} 
```

该方法可以使用如下：

```
class CustomException extends Exception {
    public final String message;
    public CustomException(final String message) { this.message = message;}
}
CustomException e = assertThrows(CustomException.class, () -> {
    throw new CustomException("Lorem Ipsum");
});
assertEquals("Lorem Ipsum", e.message); 
```

* * *

## 回答 #32

> 赞同：0
> 
> 时间：2017-11-09T06:23:17.373

编写测试用例有两种方式

1.  用方法抛出的异常注释测试。像这样的东西`@Test(expected = IndexOutOfBoundsException.class)`
2.  您可以使用 try catch 块简单地捕获测试类中的异常，并对从测试类中的方法抛出的消息进行断言。

    ```
    try{
    }
    catch(exception to be thrown from method e)
    {
         assertEquals("message", e.getmessage());
    } 
    ```

我希望这能回答您的问题 学习愉快...

* * *

## 回答 #33

> 赞同：-1
> 
> 时间：2016-03-10T05:10:05.113

我想评论我对这个问题的解决方案，它避免了需要任何与异常相关的 JUnit 代码。

我将 assertTrue(boolean) 与 try/catch 结合使用来查找要抛出的预期异常。这是一个例子：

```
public void testConstructor() {
    boolean expectedExceptionThrown;
    try {
        // Call constructor with bad arguments
        double a = 1;
        double b = 2;
        double c = a + b; // In my example, this is an invalid option for c
        new Triangle(a, b, c);
        expectedExceptionThrown = false; // because it successfully constructed the object
    }
    catch(IllegalArgumentException e) {
        expectedExceptionThrown = true; // because I'm in this catch block
    }
    catch(Exception e) {
        expectedExceptionThrown = false; // because it threw an exception but not the one expected
    }
    assertTrue(expectedExceptionThrown);
} 
```

* * *

## 回答 #34

> 赞同：-3
> 
> 时间：2018-08-08T10:43:49.763

```
try {
    my method();
    fail( "This method must thrwo" );
} catch (Exception ex) {
    assertThat(ex.getMessage()).isEqual(myErrormsg);
} 
```

# python - 如何使用正则表达式跳过文档字符串

> ID：156504
> 
> 赞同：2
> 
> 时间：2008-10-01T06:56:35.133
> 
> 标签：python

我正在尝试将一些导入行插入到 python 源文件中，但理想情况下我希望将它们放在初始文档字符串之后。假设我将文件加载到 lines 变量中，如下所示：

```
lines = open('filename.py').readlines() 
```

如何找到行号，文档字符串在哪里结束？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-01T10:16:38.973

您可以使用 python 的 tokenize 模块，而不是使用正则表达式或依赖特定格式。

```
import tokenize
f=open(filename)
insert_index = None
for tok, text, (srow, scol), (erow,ecol), l in tokenize.generate_tokens(f.readline):
    if tok == tokenize.COMMENT:
        continue
    elif tok == tokenize.STRING:
        insert_index = erow, ecol
        break
    else:
        break # No docstring found 
```

这样您甚至可以处理以下病理情况：

```
# Comment
# """Not the real docstring"""
' this is the module\'s \
docstring, containing:\
""" and having code on the same line following it:'; this_is_code=42 
```

就像 python 会处理它们一样。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-01T07:01:51.017

如果您使用的是标准文档字符串格式，则可以执行以下操作：

```
count = 0
for line in lines:
    if line.startswith ('"""'):
        count += 1
        if count < 3:
            # Before or during end of the docstring
            continue
    # Line is after docstring 
```

可能需要对没有文档字符串的文件进行一些调整，但如果您的文件格式一致，它应该很容易。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2016-11-02T09:20:00.673

这是一个基于 Brian 出色答案的函数，您可以使用它来将文件拆分为文档字符串和代码：

```
def split_docstring_and_code(infile):

    import tokenize
    insert_index = None
    f = open(infile)
    for tok, text, (srow, scol), (erow,ecol), l in tokenize.generate_tokens(f.readline):
        if tok == tokenize.COMMENT:
            continue
        elif tok == tokenize.STRING:
            insert_index = erow, ecol
            break
        else:
            break # No docstring found

    lines = open(infile).readlines()
    if insert_index is not None:
        erow = insert_index[0]
        return "".join(lines[:erow]), "".join(lines[erow:])
    else:
        return "", "".join(lines) 
```

It assumes that the line that ends the docstring does not contain additional code past the closing delimiter of the string.

# .net - Silverlight 内存分析器是否存在？

> ID：156507
> 
> 赞同：8
> 
> 时间：2008-10-01T06:59:15.767
> 
> 标签：.net, silverlight, memory-leaks, clr, profiler

CLR 探查器似乎不适用于 Silverlight CLR。是否存在另一个内存分析器？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2010-04-01T13:46:27.803

这是使用 Xperf 在 Silverlight 中进行的内存分析。

[获取 GC 信息](http://naveensrinivasan.com/2010/03/21/get-gc-information-in-silverlight-using-etw/)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-08-27T15:45:13.713

试试这个，非常有用：

[http://www.red-gate.com/products/ants_memory_profiler/index.htm](http://www.red-gate.com/products/ants_memory_profiler/index.htm)

布鲁诺。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-01T17:12:30.970

似乎还没有可用的。但是，按照[本论坛主题中的建议](http://silverlight.net/forums/p/12623/49752.aspx#49752)，您可以将 Silverlight 应用程序转换为 WPF 应用程序和配置文件：

> 目前还没有工具，但作为一种解决方法，您可以从相同的代码库和一些调整轻松地创建 Silverlight 客户端的桌面 (WPF) 版本（有关此示例，请参阅 Scot 的博客 - [http://weblogs.asp .net/scottgu/pages/silverlight-tutorial-part-8-creating-a-digg-desktop-application-using-wpf.aspx](http://weblogs.asp.net/scottgu/pages/silverlight-tutorial-part-8-creating-a-digg-desktop-application-using-wpf.aspx)）。完成此操作后，您可以运行任何适用于 WPF 的性能分析器。

不是最佳解决方案，但它听起来是目前最好的选择......

**更新：**刚刚看到一篇关于 XPerf 的[博客文章](http://blogs.msdn.com/seema/archive/2008/10/08/xperf-a-cpu-sampler-for-silverlight.aspx)，它是 Silverlight 的 CPU 采样器。不完全是内存分析器，而是测试 Silverlight 应用程序性能的好工具......

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-08-05T05:08:25.720

VS2010/SL4 有一个分析器现在结帐：

[http://www.nachmore.com/2010/profiling-silverlight-4-with-visual-studio-2010/](http://www.nachmore.com/2010/profiling-silverlight-4-with-visual-studio-2010/)

[http://blogs.msdn.com/b/seema/archive/2010/01/28/pdc-vs2010-profiling-silverlight-4.aspx](http://blogs.msdn.com/b/seema/archive/2010/01/28/pdc-vs2010-profiling-silverlight-4.aspx)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-07-27T08:12:45.323

虽然不是一个带有漂亮 GUI 的完整分析器，但您可以使用[Windbg + SOS](http://blogs.msdn.com/tess/archive/2008/08/21/debugging-silverlight-applications-with-windbg-and-sos-dll.aspx)来调试您的 silverlight 应用程序，这需要大量的手动工作，但您可以遍历托管堆。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-09-04T19:52:01.897

尝试使用 Atologic SilverProfiler。可在[www.atologic.com 获得](http://www.atologic.com)。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2010-08-25T23:26:55.830

使用 Silverlight Spy
它有一个内置的内存分析器
![替代文字](https://i.stack.imgur.com/IQa6D.png)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2011-06-02T08:30:13.360

我使用免费的[XTE Profiler](http://www.xteprofiler.com/)，它也适用于 Silverlight Standard 和 Out of Browser 应用程序。还显示实时内存使用情况。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2011-08-26T07:52:30.690

[**.NET Memory Profiler**](http://memprofiler.com/)从 4.0 版开始支持 Silverlight 分析。

极力推荐。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2011-10-04T19:29:19.167

独立的 CLR 分析器已更新为与 Silverlight 一起使用，因此您无需拥有 VS Premium/Ultimate。

[David Broman 的 CLR Profiling API 博客：CLRProfiler V4 发布](https://web.archive.org/web/20190114032249/https://blogs.msdn.microsoft.com/davbr/2011/02/01/clrprofiler-v4-released)

UI 不是很好，但它可以工作。

# java - 关闭 Java FileInputStream

> ID：156508
> 
> 赞同：36
> 
> 时间：2008-10-01T07:00:42.250
> 
> 标签：java, exception, stream

好吧，我一直在做以下事情（变量名已更改）：

```
 FileInputStream fis = null;
try
{
    fis = new FileInputStream(file);

    ... process ...

}
catch (IOException e)
{
    ... handle error ...
}
finally
{
    if (fis != null)
        fis.close();
} 

```

最近，我开始使用 FindBugs，这表明我没有正确关闭流。我决定看看 finally{} 块是否可以做任何事情，然后我看到，哦，是的，close() 可以抛出 IOException。人们应该在这里做什么？Java 库抛出了太多的检查异常。

* * *

## 回答 #1

> 赞同：47
> 
> 时间：2008-10-01T09:44:16.553

对于 Java 7 及更高版本，应使用[try-with-resources ：](http://docs.oracle.com/javase/tutorial/essential/exceptions/tryResourceClose.html)

```
try (InputStream in = new FileInputStream(file)) {
  // TODO: work
} catch (IOException e) {
  // TODO: handle error
} 
```

如果您卡在 Java 6 或更低版本...

这种模式避免了使用**null**：

```
 try {
        InputStream in = new FileInputStream(file);
        try {
            // TODO: work
        } finally {
            in.close();
        }
    } catch (IOException e) {
        // TODO: error handling
    } 
```

* * *

有关如何有效处理*close*的更多详细信息，请阅读此博客文章：[Java：如何不弄乱流处理](http://illegalargumentexception.blogspot.com/2008/10/java-how-not-to-make-mess-of-stream.html)。它有更多的示例代码、更多的深度，并涵盖了在*catch*块中包裹*关闭的陷阱。*

 ** * *

## 回答 #2

> 赞同：26
> 
> 时间：2008-10-01T07:05:57.123

像下面这样的事情应该做到这一点，取决于你是否在尝试关闭流时抛出或吞下 IOException。

```
FileInputStream fis = null;
try
{
    fis = new FileInputStream(file);

    ... process ...

}
catch (IOException e)
{
    ... blah blah blah ...
}
finally
{
    try
    {
        if (fis != null)
            fis.close();
    }
    catch (IOException e)
    {
    }
} 
```

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2012-05-17T22:35:30.993

您可以使用添加了 JDK7 的[try-with-resources](http://docs.oracle.com/javase/7/docs/technotes/guides/language/try-with-resources.html)功能。正是为了处理这种事情而创建的

```
static String readFirstLineFromFile(String path) throws IOException {
  try (BufferedReader br = new BufferedReader(new FileReader(path))) {
    return br.readLine();
  }
} 
```

文档说：

> try-with-resources 语句确保每个资源在语句结束时关闭。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-01T07:12:03.550

您还可以使用简单的静态辅助方法：

```
public static void closeQuietly(InputStream s) {
   if (null == s) {
      return;
   }
   try {
      s.close();
   } catch (IOException ioe) {
      //ignore exception
   }
} 
```

并从您的 finally 块中使用它。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-01T08:12:45.637

没什么可补充的，除了一个非常小的风格建议。 **自我记录代码的规范示例**`IOException`适用于这种情况 - 为您必须了解的被忽略的变量提供描述性变量名称`close()`。

所以 squidle 的回答变成了：

```
public static void closeQuietly(InputStream s) {
   try {
      s.close();
   } catch (IOException ignored) {
   }
} 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-01T10:52:02.243

在大多数情况下，我发现最好**不要**捕获 IO 异常，而只需使用 try-finally：

```
final InputStream is = ... // (assuming some construction that can't return null)
try {
    // process is
    ...
} finally {
    is.close();
} 
```

除了`FileNotFoundException`，您通常无法“解决” `IOException`. 剩下要做的唯一一件事就是报告一个错误，您通常会在调用堆栈中进一步处理它，所以我发现传播异常更好。

由于`IOException`是已检查异常，因此您必须声明此代码（及其任何客户端）`throws IOException`。这可能太吵了，或者您可能不想透露使用 IO 的实现细节。在这种情况下，您可以使用一个异常处理程序来包装整个块，该异常处理程序包含`IOException`一个`RuntimeException`或一个抽象异常类型。

**详细信息：**我知道`try`当块中的`close`操作`finally`产生`IOException`. 我不认为这是一个大问题：通常，块中的异常与导致失败的异常`try`相同（即 IO 正常工作然后在关闭时失败的情况非常罕见）。如果这是一个问题，那么“沉默”收盘可能是值得的。`IOException``close`

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-07-23T19:28:56.283

如果关闭失败，以下解决方案会正确抛出异常，而不会在关闭之前隐藏可能的异常。

```
try {
    InputStream in = new FileInputStream(file);
    try {
        // work
        in.close();
    } finally {
        Closeables.closeQuietly(in);
    }
} catch(IOException exc) {
    // kernel panic
} 
```

这是有效的，因为第二次调用 close[没有效果](http://download.oracle.com/javase/6/docs/api/java/io/Closeable.html#close())。

这依赖于 guava [Closeables](http://guava-libraries.googlecode.com/svn/trunk/javadoc/com/google/common/io/Closeables.html)，但如果愿意，可以编写自己的 closeQuietly 方法，如[squidle](https://stackoverflow.com/questions/156508/closing-a-java-fileinputstream/156526#156526)所示（另见[serg10](https://stackoverflow.com/questions/156508/closing-a-java-fileinputstream/156674#156674)）。

在一般情况下，报告关闭错误很重要，因为关闭可能会将一些最终字节写入流，例如由于缓冲。因此，您的用户想知道它是否失败，或者您可能想以某种方式采取行动。当然，在 FileInputStream 的特定情况下这可能不是真的，我不知道（但由于已经提到的原因，我认为如果它仍然发生，最好报告一个关闭错误）。

由于嵌入的 try 块的结构，上面的代码有点难以掌握。使用两种方法可能会更清晰，一种抛出 IOException，另一种捕获它。至少这是我会选择的。

```
private void work() throws IOException {
    InputStream in = new FileInputStream(file);
    try {
        // work
        in.close();
    } finally {
        Closeables.closeQuietly(in);
    }
}

public void workAndDealWithException() {
    try {
        work();
    } catch(IOException exc) {
        // kernel panic
    }
} 
```

基于[http://illegalargumentexception.blogspot.com/2008/10/java-how-not-to-make-mess-of-stream.html](http://illegalargumentexception.blogspot.com/2008/10/java-how-not-to-make-mess-of-stream.html)（由 McDowell 引用）。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-01T07:18:51.070

希望有一天我们会在 Java 中获得闭包，然后我们将减少很多冗长的内容。

因此，您可以导入 javaIO 中的某个辅助方法，它可能需要一个“可关闭”接口和一个块。在该辅助方法中，try {closable.close() } catch (IOException ex){ //blah} 被一劳永逸地定义，然后您就可以编写

```
 Inputstream s = ....;
 withClosable(s) {
    //your code here
 } 
```

* * *

## 回答 #9

> 赞同：-4
> 
> 时间：2008-10-01T08:37:48.117

您主要关心的是从 FindBugs 获得一份干净的报告还是让代码有效？这些不一定是同一件事。您的原始代码很好（尽管我会摆脱冗余`if (fis != null)`检查，`OutOfMemoryException`否则会抛出 an ）。FileInputStream 有一个终结器方法，它会在您在处理过程中实际收到 IOException 的不太可能的情况下为您关闭流。为了避免极不可能的情况而使您的代码更复杂，这根本不值得

1.  你得到一个 IOException 和
2.  这种情况经常发生，以至于您开始遇到终结器积压问题。

**编辑：**如果您收到如此多的 IOExceptions 以至于您遇到了终结器队列的问题，那么您有更大的鱼要炸！这是关于获得透视感。

# windows - 在 Windows (GCC) 上增加堆栈大小

> ID：156510
> 
> 赞同：10
> 
> 时间：2008-10-01T07:01:01.657
> 
> 标签：windows, gcc, compiler-construction, linker, stack

有没有办法在使用 GCC 的编译/链接时增加 Windows 应用程序的堆栈大小？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-10-01T08:41:04.490

IIRC，在 GCC 中，您可以向 ld 提供 --stack,[bytes] 参数。

例如

```
gcc -Wl,--stack,16777216 -o file.exe file.c 
```

要拥有 16MiB 的堆栈，我认为默认大小是 8MiB。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-01T07:05:50.413

您可以在链接后运行editbin。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-01T10:04:07.613

Windows 中有两种堆栈大小。最初提交的大小和总保留大小。您可以在 .def 文件中使用 STACKSIZE 语句设置两者。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-01T07:06:49.477

创建线程时，您使用 dwStackSize 参数，但我不确定如何更改主线程的大小，这表明它在 exe 的标头中，因此它可能是编译器/链接器的一个选项，否则您需要找到标题的相关部分并自己更改。

[http://msdn.microsoft.com/en-us/library/ms686774(VS.85).aspx](http://msdn.microsoft.com/en-us/library/ms686774(VS.85).aspx)

# java - Java HttpURLConnection：它可以处理重复的标题名称吗？

> ID：156514
> 
> 赞同：0
> 
> 时间：2008-10-01T07:02:49.143
> 
> 标签：java, http, sockets, connection

我正在调试 Selenium-rc 代理服务器中的一些代码。罪魁祸首似乎是`HttpURLConnection`对象，其获取 HTTP 标头的接口无法处理重复的标头名称，例如：

```
Set-Cookie: foo=foo; Path=/
Set-Cookie: bar=bar; Path=/ 
```

通过`HttpURLConnection`(using `getHeaderField(int n)`and `getHeaderFieldKey(int n)`) 获取标题的方式似乎导致我的第二个 cookie 丢失。我的问题是

1.  是不是`HttpURLConnection`自己应付不来，和
2.  如果是这样，是否有解决方法？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-01T07:35:10.327

我推荐的解决方法是根本不使用 HttpUtilConnection，这是粗略且不直观的，而是使用 commons-httpclient 代替。

[http://hc.apache.org/httpclient-3.x/](http://hc.apache.org/httpclient-3.x/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-01T07:29:49.983

没有实际尝试过（不记得自己处理过该主题），还有从[UrlConnection](http://java.sun.com/j2se/1.4.2/docs/api/java/net/URLConnection.html#getHeaderFields())继承的 getHeaderFields 。这能满足您的需要吗？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-01T08:14:09.487

好的，我找到了问题，以及原始问题的答案。基本上，我使用的 Cookie 实现（python 的默认 Cookie Lib）使用 \r\n 来分隔不同的 Set-Cookie 标头（应该是 \n），这混淆了 HttpUrlConnection 并导致它在第一次出现该分隔符时停止（我猜它会停在第一个空行）。所以第一个问题的答案是：是的，它可以处理重复的标题名称，但在另一种方面是错误的。目前修复 python 库是一个可行的解决方法，但它不会长期工作，因为我们不拥有那个库。我确信使用 httpclient 库是一种明智的选择，但我希望有一个需要较少工作的解决方案。所以我还不知道在那里做什么。

# java - 如何判断一个类是否是其他类的子类？

> ID：156527
> 
> 赞同：7
> 
> 时间：2008-10-01T07:12:06.483
> 
> 标签：java

例如，我想检查一个 Class 对象是否代表其他类的子类

```
Class class1 = Class.forName("Class1");
Class class2 = Class.forName("Class2");

 if(class1.isSubClassOf(class2)) // fake methos isSubClassOf
{
  // do sth
} 
```

我怎样才能实现这个`isSubClassOf`方法？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-10-01T07:13:01.910

Class.isAssignableFrom() 或多或少地提供了您所追求的东西，尽管它也处理接口，因此可能需要做更多的额外工作以确保它是直接或其他的子类。

# java - What is the best way to do Java development in Emacs?

> ID：156529
> 
> 赞同：19
> 
> 时间：2008-10-01T07:12:33.987
> 
> 标签：java, emacs

What modes are the best?

And any tips or tricks that make developing java in emacs a bit better.

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-10-01T07:20:00.067

For anything else than casual Java editing, many people recommend the [Java Development Environment for Emacs.](http://jdee.sourceforge.net/)

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2013-01-10T11:20:25.177

[Eclim](http://eclim.org/) is a project that uses eclipse running in headless mode to provide features to Emacs such as in-line error checking, auto import management, basic refactoring, etc. It's much easier than JDEE to set up and when paired with something like YASnippet I find myself more productive than I was in Eclipse. I currently have to go back for step through debugging and some project management, but I am pretty happy with it. If combined with something like JDIbug I think I would have even less reason to ever use eclipse directly.

Hope this helps

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-02-15T17:26:59.940

The best Java debugger for Emacs I've used is [jdibug](http://code.google.com/p/jdibug/).

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2011-04-26T12:54:56.427

I have used JDEE over two years.Unfortunately,it was too old and stopped.JDEE doesn't support new features since Java 5,e.g, we can't create enum type using JDEE. And the author didn't answer any questions.I am still using Emacs+JDEE,but I can't see the future of JDEE.

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-01T09:19:35.990

Java refactoring for emacs:

[http://www.xref-tech.com/xrefactory-java/main.html](http://www.xref-tech.com/xrefactory-java/main.html)

# mysql - 如何将空格分隔的文本文件导入 MySQL？

> ID：156532
> 
> 赞同：5
> 
> 时间：2008-10-01T07:13:13.377
> 
> 标签：mysql, load-data-infile, mysqlimport

我需要将较大的 (24MB) 文本文件导入 MySQL 表。每行如下所示：

```
1 1 0.008  0  0  0  0  0 
```

每个字段后面有一个或多个空格，最后一个字段在换行符之前尾随大约 36 个空格。

如何将这样的文件导入 MySQL？从文档看来， LOAD DATA 期望所有字段都以完全相同的字符串终止。我试过了

```
LOAD DATA INFILE 'filename' INTO TABLE mytable FIELDS TERMINATED BY ' '; 
```

但是 MySQL 会将多个空格的序列解释为分隔一个空字段。

有任何想法吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-01T07:19:51.923

如果您使用的是 unix/linux，那么您可以通过 sed 进行操作。

打开终端并输入：

```
sed 's/ \+/ /g' thefile > thefile.new 
```

这将用一个空格替换所有多个空格的序列。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-03-28T17:44:36.000

如果您在 Windows 上，只需使用 Excel。

Excel 将导入一个以空格分隔的文件（从导入菜单中选中“将后续分隔符视为一个”框）。

然后，您可以简单地将文件从 Excel 保存为 CSV 并使用以下命令导入 MySQL：

```
LOAD DATA INFILE 'filename' INTO TABLE mytable FIELDS TERMINATED BY ','; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-01T07:26:42.097

您还可以使用 Jauco 发布的相同命令将分隔符更改为 ';' 或\n。这也会有所帮助。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-01T07:31:18.950

你有没有办法务实地做到这一点？一个简单的 PHP 脚本将能够加载文件，按空格分隔，并立即进行插入：

```
<?php

$db = mysql_connect('host', 'user', 'password')
or die('Failed to connect');
mysql_select_db('database', $db);

$fileHandle= @fopen("import.file", "r");
if ($fileHandle) {
    while (!feof($fileHandle)) {
        $rawLine = fgets($fileHandle, 4096);

        $columns = preg_split("/\s+/", $rawLine);

        //Construct and run an INSERT statement here ...   

    }
    fclose($fileHandle);
}

?> 
```

**编辑** 话虽如此，[Jakal 的](https://stackoverflow.com/questions/156532/how-do-i-import-a-whitespace-delimited-text-file-into-mysql#156550)建议要简洁得多；）

# silverlight - 对 DependencyObject 和 DependencyProperty 的依赖

> ID：156538
> 
> 赞同：3
> 
> 时间：2008-10-01T07:15:04.540
> 
> 标签：silverlight, xaml

我正在构建一个 Silverlight 应用程序，我上次的警告之一是，如果您需要以 Silverlight/WPF 方式正确完成任何事情，您需要将您的对象建模为 DependecyObject 并使用 DependencyProperty(ies)

我发现这个模型相当麻烦，在我使用的一半类中需要静态字段和初始化程序，那么使用古老的事件驱动（观察者模式？）代替 DependencyObject 是个好主意吗？

我的目标是尽量减少代码膨胀和样板（我讨厌它们），并且真的很想知道是否有任何具有 Silverlight/WPF 经验的人有任何技巧/技术可以将 DependencyObject 和 DependencyProperty 的使用保持在最低限度？

这是一个好主意吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-01T13:13:27.863

实际上，在 Silverlight 中您不能继承 DependencyObjects，因此您应该（并且必须）实现 INotifyPropertyChanged。

实现 INotifyPropertyChanged 与 DependencyObjects（我将缩写此 DO 以使其更容易）和使用 DependencyProperties (DPs) 相比具有许多优点：

*   这个比较轻
*   让您在建模对象时更加自由
*   可以轻松序列化
*   您可以在需要时引发事件，这在某些情况下可能很有用，例如，当您希望仅在一个 UI 操作中捆绑多个更改时，或者当您需要在数据没有更改的情况下引发事件时（以强制重绘...）

另一方面，在 WPF 中继承 DO 有以下优点：

*   更容易实施，尤其是对于初学者。
*   您（几乎）免费获得回调机制，允许您在属性值更改时收到通知
*   您将获得一个强制机制，允许您为属性的最大值、最小值和现值定义规则。

还有其他考虑因素，但这些是主要的。

我认为普遍的共识是 DP 非常适合控件（即使在 Silverlight 中，您也可以使用自定义 DP 实现 CustomControl），但对于数据对象，您应该实现 INotifyPropertyChanged。

HTH，洛朗

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-01T08:58:36.790

这实际上取决于您所指的对象。如果对象打算放在 XAML 树中，最好使用 DependencyProperties（因此继承 DependencyObject - 所有 UIElements 都这样做）以允许 DependencyProperties 提供的所有好处（动画、绑定、可选的自动子继承等）。我强烈建议您阅读[有关 DependencyProperties 的 MSDN 概述（](http://msdn.microsoft.com/en-us/library/ms752914.aspx)如果您还没有的话）。

如果该对象是一个数据实体（即，您将其值绑定到 XAML 树中的某个内容），则无需从 DependencyObject 继承。如果对象上的属性是读写的，您可能需要实现[INotifyPropertyChanged](http://msdn.microsoft.com/en-us/library/system.componentmodel.inotifypropertychanged.aspx)，这将允许绑定在值更改时自动更新。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-24T21:50:51.420

我同意 Richard 的观点，这取决于您的课程的目的，但作为说明，您似乎可以在 Silverlight 2.0 Release 中直接从 DependencyObject 继承，而不必从 UIElement 或 UserControl 继承。至少，我在我的 (SilverLight 2.0 RTW) 应用程序中这样做了。

[MSDN 上的 System.Windows.DependencyObject](http://msdn.microsoft.com/en-us/library/system.windows.dependencyobject(VS.95).aspx)

> 在大多数情况下，直接从 DependencyObject 派生***并不典型。***相反，您可能从特定控件、控件基类之一（ContentControl；Control；ItemsControl）、FrameworkElement 或仍参与 UI 的非控件类（如 Panel 或 Grid）派生。如果您正在定义希望依赖属性处于活动状态的业务或数据存储对象，或者如果您正在创建将拥有附加属性的服务支持类，则从 DependencyObject 派生可能是合适的。

高温高压

# asp.net - Visual Studio：根据 ASP.NET 页面生命周期自动重新排序页面事件？

> ID：156539
> 
> 赞同：1
> 
> 时间：2008-10-01T07:15:04.683
> 
> 标签：asp.net, visual-studio, page-lifecycle

根据 ASP.NET 页面生命周期重新排序现有页面事件的最简单方法是什么？

我正在尝试使我的事件更具可读性，并且可能使滚动到顺序接近的事件变得容易。

如果没有简单的方法，是否有一种非鼠标方式可以快速切换到页面事件而无需在增量搜索中键入实际事件？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-01T07:23:24.850

我唯一能想到的就是使用代码窗口导航器。要不使用鼠标，您可以按`Ctrl`+ `F2`，然后按 tab 到 tab 到方法下拉，您可以使用箭头，包括按字母在列表中移动并按 enter 选择。

# sms - 使用 Microsoft SMS Sender 批量发送短信？

> ID：156543
> 
> 赞同：0
> 
> 时间：2008-10-01T07:17:32.350
> 
> 标签：sms, bulksms

我知道我们可以在命令行模式下使用 SMS Sender。但我得到的这个错误和这篇文章一样[http://www.oreillynet.com/pub/a/wireless/2003/10/10/sms.html](http://www.oreillynet.com/pub/a/wireless/2003/10/10/sms.html)

smssender.exe 将使用最后一个成功用于在 Windows 版本的 SMS Sender 中发送消息的设备。但是我试了很多次，smssender.exe总是抱怨没有使用最后一个设备。

有人对此有任何想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-19T12:19:53.013

您必须在 HKEY_Local_Machine-MMicrosoft-> SMSSender 下添加一个新注册表

复制注册表以从 HKey_Current_User 创建

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-06-03T11:09:15.947

从“选项”中，选中“启用日志记录”复选框。它对我有用。也可以使用windows 7 x64（在XP兼容模式下）

# php - 使用可变项创建两遍 PHP 缓存系统

> ID：156552
> 
> 赞同：5
> 
> 时间：2008-10-01T07:20:17.337
> 
> 标签：php, caching

我想实现一个两遍缓存系统：

*   第一遍生成一个 PHP 文件，其中包含硬编码的所有常见内容（例如新闻项目）。然后数据库有一个缓存表来链接这些页面（例如“index.php page=1 style=default”），数据库还存储一个uptodate字段，如果为false，则导致第一次通过在下一次页面重新运行被查看。

*   第二遍填写次要细节，例如某件事（？）是多久以前，以及诸如“您以...登录”之类的可变项目。

但是我不确定一个有效的实现，它支持缓存和非缓存（例如，搜索）页面，没有很多代码和几个查询。

现在每次加载页面时，PHP 脚本都会运行重新生成页面。对于像搜索这样的页面，这很好，因为大多数搜索是不同的，但对于其他页面，例如索引，每次点击几乎相同，但会生成大量查询并且是相当长的脚本。

问题是页面的某些部分确实会根据每个用户进行更改，例如“您以...登录”部分，因此仅保存生成的页面仍会导致 10,000 个几乎相同的页面。

主要关注的是减少服务器上的负载，因为我在共享主机上，此时无法升级，但该站点正在使用服务器的相当大一部分 CPU + 对 MySQL 施加了相当大的负载服务器。

因此，基本上最大限度地减少每个页面请求必须完成的工作量，而不是一直在索引上重新生成诸如新闻项目之类的东西似乎是一个好的开始，相比之下，搜索是一个静态页面少得多的页面。

我实际上考虑将新闻项目硬编码为纯 HTML，但这意味着在多个地方维护它们（因为它们可能用于搜索并且评论位于专用于该新闻项目的页面上（即 news.php）等） .

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-01T07:46:25.947

我支持 Ken 对 PEAR 的[Cache_Lite](http://pear.php.net/package/Cache_Lite)库的推荐，您可以使用它轻松地缓存部分页面或整个页面。

如果您正在运行自己的服务器，我强烈建议您使用[memcached](http://www.danga.com/memcached/)。它的速度要快得多，因为它完全在内存中运行，并且被许多大容量站点广泛使用。这是一个运行起来非常简单、稳定、无故障的守护进程。就您的 PHP 代码而言，您可以使用与 Cache_Lite 非常相似的方式来缓存各种页面部分或完整页面（或其他任意数据块），并且由于 PHP 具有[内置的 memcache 接口](http://www.php.net/manual/en/intro.memcache.php)，因此非常易于使用.

对于超高流量的整页缓存，看看做[Varnish](http://varnish.projects.linpro.no/)或[Squid](http://www.squid-cache.org/)作为缓存反向代理服务器。（由 Varnish 提供的页面将比 PHP 解释器的任何页面快 100 倍。）

请记住缓存，您实际上只需要缓存经常访问的内容。有时，当您并不真正需要它时，开发一个非常复杂的缓存策略可能是一个陷阱。对于像您的主页这样每秒被点击多次的页面，您肯定希望对其进行优化以提高速度；对于一个每小时可能获得几次点击的页面，比如一个月前的博客文章，缓存它是个坏主意，你只会浪费你的时间，让事情变得更加复杂和容易出错。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-01T07:30:55.283

我建议不要重新发明轮子……有一些模板引擎支持缓存，比如[Smarty](http://www.smarty.net/)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-01T07:28:14.743

对于服务器端缓存，请使用[Cache_Lite 之](http://pear.php.net/package/Cache_Lite)类的东西（让其他人担心文件锁定、到期日期、文件损坏）

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-01T07:25:05.920

您希望将结果保存到文件并使用如下逻辑将它们拉回：

```
if filename exists
    include filename
else
    generate results
    render to html (as string)
    write to file
    output string or include file
endif 
```

需要明确的是，您不需要两次通过，因为您可以保存页面的某些部分并让其余部分保持动态。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-01T07:48:57.003

与此类问题一样，我的回答是：

*   为什么需要缓存？
*   您的应用程序是否在数据库上消耗了过多的 IO？
*   您运行了哪些指标？

您正在谈论为您的应用程序增加额外的复杂性，因此您需要非常确定您确实需要它。

如果数据库是系统中的争用点，您实际上可能会从使用内置 MySQL 查询缓存中受益。另一个选项是也使用 Memcache。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-01T07:47:23.700

我建议使用现有的缓存机制。根据您的实际需要，您可能正在寻找 APC、memcached、各种模板缓存库......调整编写/测试的代码以满足您的需要比从头开始编写所有内容更容易/更快。（通常情况下，尽管您可能没有选择的情况）

# project-management - 如何充分利用依恋学生？

> ID：156559
> 
> 赞同：3
> 
> 时间：2008-10-01T07:24:41.367
> 
> 标签：project-management

时不时会有学生附在我们的项目上，我当然想分配他/她很多事情去做，这样可以学到更多。但是很多时候我们不得不分配文件，更新ui模型屏幕等。问题是很难相信学生提供的工作质量，另一件事是他们还年轻，他们的热情可能不在。我们如何更好地利用它们，以便它们真正减少我们的工作量，进而意味着学习更多有助于他们未来工作机会的东西？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-01T16:50:10.370

恐怕这听起来令人失望，但利用学生来减少组织单位的工作量并不是最好的主意。可能，如果您的目标是减少工作量，那么最好的办法就是不要招收学生。继续阅读以了解原因。

虽然你没有具体说明学生所拥有的工作相关专业知识水平，也没有提到他们的依恋时间，但我从你的问题的语气中假设他们的专业知识不足以开始运作。假设他们的停留时间不超过 2-3 个月也是合理的。

即使在有限的时间范围内，您的组织也可以提取的基本好处是：

1.  甚至在他们进入就业市场之前就注意到并抓住有才华的工人。在他们的工作生涯后期，他们可能不会那么容易获得。

2.  把每个学生都变成你的组织推销员。让他们告诉每个人你的产品有多好，在未来给你带来合同，或者让他们的同行羡慕他们的工作经验，为你的公司增加优秀的候选人。

3.  局外人可以帮助您重新审视您的流程、程序、产品、揭露低效率等。

4.  向他们学习大学教授的最新知识。

5.  提高你的时间士气：马斯洛理论，“尊重需求”。即使是团队中最初级的成员也会变得更高级，因为这些学生还没有达到那个位置。

减少工作量意味着您需要找到一组相当独立的任务，不需要学生不具备的知识或技能，并且需要您团队的大量时间来转移。万一他们搞砸了，这些任务就不可能具有战略重要性，也不能具有运营重要性。因此，您留下了一些关于管理报告或研发项目的尘土飞扬的要求。

很有可能，研发被认为是您组织内更理想的工作，如果您只为学生提供服务，那么有些人的感情会受到伤害。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-01T07:31:45.377

学生在附近呆了多久？当我们让学生在现场工作长达两周时，我们可以给他们提供的除了测试类型的工作不多。

如果学生有热情，你可以通过一个 bug 进行一些结对编程，并让他们编写单元测试来验证修复。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-01T07:34:43.823

即使您通常不进行结对编程，我发现对于初级开发人员来说，让他/她与更有经验的开发人员进行结对编程有时会很有成效，原因如下：

*   我不会将编码任务单独分配给初级开发人员，因为无论如何他的代码都必须由其他人仔细审查，并且很可能会重写或大幅更改。

*   另一方面，如果不是通过编程，初级开发人员如何学习？因此，您希望他以某种方式参与编程任务。

*   您会获得结对编程的一些优势：最有经验的开发人员不太容易犯愚蠢的错误（即使是非常初级的程序员也可以指出诸如“嘿，你在这里打错字”之类的事情），并且不太可能在检查 stackoverflow 时犯错。在结对编程会话期间每 10 分钟发送一次。

当然，我也会在白天与几位前辈轮换，这样他们就不会长时间感到“慢下来”或被这个年轻人惹恼了。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-01T07:31:48.107

为什么不指派一名或多名工程师作为学生的“牧羊人”，让他们监督他们的工作，甚至更好地与他们结对。学生将对您的项目和实际工作有很好的理解，并在遇到麻烦时有一个已知的后备方案，并且有人可以提供指导。牧羊人/导师获得了全新的视角和教学的乐趣。

# .net - 您如何管理生产中的 asp.net SQL 成员角色/用户？

> ID：156563
> 
> 赞同：9
> 
> 时间：2008-10-01T07:25:19.103
> 
> 标签：.net, asp.net, security, asp.net-membership, blogengine.net

如何在生产机器上设置 asp.net sql 成员角色/成员提供者？我正在尝试设置 BlogEngine.NET，所有文档都说要使用 Visual Studio 中的 ASP.NET 网站管理工具，但这在生产机器上不可用。我是第一个在非开发机器上使用它的 BlogEngine 用户吗？

SQL 服务器完全与生产框隔离，但我确实在那里安装了 SQL Management Studio。

编辑：我的意思是，您如何添加新用户/角色，而不是如何创建表。我已经运行 aspnet_regsql 来创建架构。

EDIT2：MyWSAT 不起作用，因为它还需要数据库中的初始用户。我需要一个应用程序，它允许我在成员数据库中创建新用户而无需任何身份验证，只需一个连接字符串。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-01T15:31:50.930

我通过在应用程序启动时设置默认超级用户解决了这个问题。

通过将此添加到 gobal.asax

```
 void Application_Start(object sender, EventArgs e) 
    {
        // Code that runs on application startup

        // check that the minimal security settings are created
        Security.SetupSecurity();
    } 

```

然后在安全类中：

```
使用系统；
使用 System.Data；
使用 System.Configuration；
使用 System.Web；
使用 System.Web.Security；
使用 System.Web.UI；
使用 System.Web.UI.HtmlControls；
使用 System.Web.UI.WebControls；
使用 System.Web.UI.WebControls.WebParts；

///
/// 为应用程序访问创建最小角色和用户。
///
公共类安全
{
    // 应用角色
    公共静态字符串 [] applicationRoles =
        {“角色 1”、“角色 2”、“角色 3”、“角色 4”、“角色 5”}；
    // 超级用户
    私有静态字符串 superUser = "super";
    // 默认密码，第一次连接时需要修改
    私有静态字符串 superUserPassword = "default";

    私人安全（）
    {
        //
        // TODO: 在此处添加构造函数逻辑
        //
    }

    ///
    /// 创建最小的成员环境。
    ///
    公共静态无效设置安全（）
    {
        设置角色（）；
        设置超级用户（）；
    }

    ///
    /// 检查角色，创建缺失。
    ///
    公共静态无效SetupRoles（）
    {
        // 创建角色
        对于 (int i = 0; 我
    /// 检查是否创建了超级用户帐户。
    /// 创建帐户并将其分配给所有角色。
    ///
    公共静态无效SetupSuperuser（）
    {
        // 创建超级用户
        MembershipUser 用户 = Membership.GetUser(superUser);
        如果（用户 == 空）
            Membership.CreateUser(superUser, superUserPassword, "maintenance@acorel.com");

        // 将超级用户分配给角色
        对于 (int i = 0; 我

```

一旦有了默认用户，就可以使用 AspNetWSAT 或其他。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-01T07:55:12.837

解决方案 1（标准，差）：Visual Studio -> 网站菜单 -> ASP.NET 配置。

解决方案 2（首选）：[AspNetWSAT](http://www.codeplex.com/AspNetWSAT)（易于部署，非常强大）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-26T15:41:28.950

解决方法很简单，WSAT工具在生产机器上，但是无法访问，可以配置站点，就可以使用了。

带有源代码的 WSAT 工具位于 C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\ASP.NETWebAdminFiles 文件夹中。要使其在网络上可访问，您所要做的就是转到 IIS->创建新的虚拟目录->指向上述文件夹并从目录设置页面中删除匿名访问。

然后您需要以与访问本地 ASP.Net 配置工具相同的方式访问它，即通过类似于以下内容的 URL：[http://SERVER/AdminTool/default.aspx?applicationPhysicalPath=C](http://SERVER/AdminTool/default.aspx?applicationPhysicalPath=C) :\Inetpub\wwwrooot\testsite\ &applicationUrl=/测试站点

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-01T07:33:41.937

您必须在机器上安装 .NET 2.0，所有 VS 工具都是作为框架一部分的命令行工具的 GUI 包装器。

检查 C:\Windows\Microsoft.NET\Framework\v2.0.50727 以获取应用程序 aspnet_regsql.exe

/？用于命令行开关，/W 用于向导模式

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-01T15:19:42.583

您是否查看过 IIS 管理成员资格的功能？转到生产服务器的 IIS 上的 ASP.NET 选项卡，看看这是否对您有帮助。

# .net - .NET 的最佳翻转日志文件跟踪侦听器是什么

> ID：156575
> 
> 赞同：32
> 
> 时间：2008-10-01T07:29:54.227
> 
> 标签：.net, logging

我正在为 .Net 寻找一个好的 TraceListener，它支持基于大小限制滚动日志文件。

**约束**

*   使用 .Net 内置的 Trace 日志记录
*   不属于某个庞大库的独立类或二进制文件
*   允许基于大小滚动日志文件

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2008-10-01T07:56:42.460

您可以使用[Microsoft.VisualBasic.Logging.FileLogTraceListener](http://msdn.microsoft.com/en-us/library/microsoft.visualbasic.logging.filelogtracelistener.aspx)，它内置于 .NET Framework 中。不要让命名空间中的 VisualBasic 吓到您，您只需引用 microsoft.visualbasic.dll 程序集，它应该可以在 C# 中正常工作。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2016-04-04T15:34:34.467

每当我需要进行网络跟踪时，我都会将这个配置片段放在手边。我不必通过在运行时在 App.config 中添加引用来添加对 VB DLL 的显式引用来构建项目。

```
<system.diagnostics>
  <sources>
    <source name="System.Net">
      <listeners>
        <add name="System.Net"/>
      </listeners>
    </source>
    <source name="System.Net.Http">
      <listeners>
        <add name="System.Net"/>
      </listeners>
    </source>
    <source name="System.Net.Sockets">
      <listeners>
        <add name="System.Net"/>
      </listeners>
    </source>
  </sources>
  <switches>
    <add name="System.Net" value="Verbose"/>
    <add name="System.Net.Http" value="Verbose"/>
    <add name="System.Net.Sockets" value="Verbose"/>
  </switches>
  <sharedListeners>
    <add name="System.Net"
          type="Microsoft.VisualBasic.Logging.FileLogTraceListener, Microsoft.VisualBasic, Version=10.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a"
          traceOutputOptions="DateTime,ProcessId,ThreadId"
          customLocation="c:\temp"
          location="Custom"
          logFileCreationSchedule="Daily"
          baseFileName="NetworkTrace"/>
  </sharedListeners>
  <trace autoflush="true"/>
</system.diagnostics> 
```

并在运行时添加引用

```
 <runtime>
    <assemblyBinding xmlns="urn:schemas-microsoft-com:asm.v1">
      <dependentAssembly>
        <assemblyIdentity name="Microsoft.VisualBasic"  culture="neutral" publicKeyToken="b03f5f7f11d50a3a"/>
        <codeBase version="10.0.0.0" href="file://C:/Program Files (x86)/Reference Assemblies/Microsoft/Framework/.NETFramework/v4.5/Microsoft.VisualBasic.dll"/>
      </dependentAssembly>
    </assemblyBinding>
  </runtime> 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-01T07:35:17.427

[我是 log4net ( http://logging.apache.org/log4net/index.html](http://logging.apache.org/log4net/index.html) )的忠实粉丝，它很容易配置并支持您想要的任何日志类型，但也可以编写自定义日志类型。

它还可以根据日志级别执行不同的操作。我们将所有消息记录到一个文本文件中，然后 Error -> Fatal 发送电子邮件

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-01T07:39:56.650

我正在使用[NLog](http://www.nlog-project.org/)，我很满意。源代码写得很好，很容易扩展和修改。文档很好，很容易配置。

一些链接：

*   [使用 NLog 跟踪事件](http://blogs.popart.com/andrew-hay/archive/2008/09/02/using-nlog-to-track-events.aspx)
*   [NLog 简介](http://www.codeproject.com/KB/trace/nlog.aspx)

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2017-01-20T21:48:26.607

FileLogTraceListener 是一个常见的建议，但是当文件超过给定的最大大小时，它会丢弃事件或抛出异常。

我们创建了一个扩展它的类，并覆盖了 Write/WriteLine 方法。

有一个`try/catch (InvalidOperationException)`，如果发生这种情况，我们调用`base.Close`并重命名文件 ( `FullLogFileName`)，如下所示（我们需要 ，`base.Close`否则我们会得到一个“文件正在使用”错误）：

在一个循环中，我们在末尾添加一个数字，并查看该文件是否存在；如果没有，请使用`File.Move(FullLogFileName, newFileWithNumber)`，否则我们会不断增加数字，直到找到有效的文件名。还有一个锁来确保给定的实例是线程安全的。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-10-01T07:51:52.877

我使用过 Log4Net 和 Nlog。我更喜欢 NLog，但实际上一旦设置好它们，你就会忘记它们在那里（直到有东西坏了，然后你很高兴它在那里！）。互联网上应该有大量的文档

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-12-03T02:30:33.767

考虑[企业图书馆日志记录应用程序块](http://msdn.microsoft.com/en-us/library/ff664700%28PandP.50%29.aspx)

确保只安装 Logging 块，因为 EntLib 安装程序默认检查所有块。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2013-03-28T20:06:45.580

如评论之一所述：

### [FileLogTraceListener 类](http://essentialdiagnostics.codeplex.com/wikipage?title=FileLogTraceListener&referringTitle=Home)

写入滚动文本文件。

> 评论
> 
> 达到 maxFileSize 时使用新文件，以及 logFileCreationSchedule 指定的每日或每周。
> 
> 每个文件都有一个格式为“\(-)(-).log”的名称，其中包括每日和每周轮换的本地日期，如果文件已经存在，则附加一个序列号。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2020-06-05T23:06:51.853

我遇到过同样的问题。安全环境，不允许开源。痛苦。这对我们有用。

派生自 TextWriterTraceListener，它添加成员以获得最大日志大小、要保留的最大滚动数，并使用共享和访问设置为 ReadWrite 并设置 OpenOrCreate 的 FileStream。它还应该创建并持有一个基于文件名的互斥锁。

覆盖 TraceEvent 方法，等待互斥体，寻找流结束，调用 Write，检查大小并在必要时滚动。释放互斥锁。

对于滚动，通过文件移动和删除旋转先前的滚动，将当前文件复制到第一级滚动名称，在流上调用 SetLength(0)。所有在互斥锁内完成，但希望不会经常。这将跨进程工作，并将避免那些糟糕的 {GUID}mylog.log 东西。

# .net - .Net 项目（Sandcastle）的命名空间文档？

> ID：156582
> 
> 赞同：67
> 
> 时间：2008-10-01T07:32:00.290
> 
> 标签：.net, documentation, sandcastle

前段时间我开始使用[Sandcastle为我们的一个项目生成一个文档网站。](http://www.codeplex.com/SHFB)它运行良好，但我们一直只为项目中的类、方法、属性（...）编写文档，并且为整个项目和项目部分/模块/命名空间提供完全独立的文档。如果我可以将该文档合并在一起并将相应的文档添加到生成的帮助文件中，那就太好了，但我不知道该怎么做。

只是在命名空间声明中添加注释似乎不起作用（C#）：

```
/// <summary>
/// My short namespace description
/// </summary>
namespace MyNamespace { ... } 
```

有谁知道如何做到这一点？我知道这是有可能的，如果能拥有... :)

* * *

## 回答 #1

> 赞同：80
> 
> 时间：2009-05-13T09:49:25.783

Sandcastle 还支持 ndoc 样式的命名空间文档，它允许您将文档粘贴到源文件中：

只需在要记录的命名空间中创建一个名为 NamespaceDoc 的非公共类，该类的 xml 文档注释将用于命名空间。

用 [CompilerGenerated] 属性装饰它，以防止类本身出现在文档中。

例子：

```
namespace Some.Test
{
    /// <summary>
    /// The <see cref="Some.Test"/> namespace contains classes for ....
    /// </summary>

    [System.Runtime.CompilerServices.CompilerGenerated]
    class NamespaceDoc
    {
    }
} 
```

SandCastle 中的工作项位于 [此处。](http://www.codeplex.com/SHFB/WorkItem/View.aspx?WorkItemId=15516)

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2008-10-01T08:17:20.493

如果您使用[Sandcastle 帮助文件生成器](http://www.codeplex.com/SHFB)，则会出现一个对话框来输入命名空间摘要。（显然也支持定义一个特定的类，但我不喜欢它..）

从功能列表中：

> 将出现在帮助文件中的项目摘要和命名空间摘要注释的定义。您还可以轻松地指示要从帮助文件中包含或排除哪些名称空间。还支持通过每个命名空间中的 NamespaceDoc 类指定命名空间注释。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-10-01T08:40:14.493

使用[Sandcastle 帮助文件生成器](http://www.codeplex.com/SHFB)。它允许在 XML 项目文件中指定命名空间描述

**例子：**

```
<namespaceSummaryItem name="System" isDocumented="True">
    Generic interfaces and helper classes.
</namespaceSummaryItem> 
```

**参考：**

*   [开源项目的示例，](http://lokad.svn.sourceforge.net/viewvc/lokad/Platform/Trunk/Shared/) 它在每次构建时生成文档（所有脚本都在主干中）。
*   这就是[SHFB 的文档在 Web 上的样子](http://build.lokad.com/doc/shared/)（它部署在每个强制构建中）

.

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2016-08-08T15:55:04.140

我知道这是一个旧帖子，但这可能对其他人有帮助。

[在此链接之后](http://www.blackwasp.co.uk/DocumentingNamespaces.aspx)，您可以为命名空间设置描述，而无需向您的项目添加非公共类。

> 要编辑命名空间摘要，请在 SHFB 的项目属性选项卡中展开摘要部分。您将看到一个名为“NamespaceSummaries”的设置，它最初显示的值是“(None)”。单击设置以将其选中，然后会出现一个显示省略号 (...) 的按钮。单击此按钮以显示命名空间摘要对话框，如下图所示：

[![在此处输入图像描述](https://i.stack.imgur.com/lZwWQ.png)](https://i.stack.imgur.com/lZwWQ.png)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2014-04-28T10:47:57.143

您不能以这种方式添加引用 - 通过 NamespaceDoc.cs 实例来添加

IE

`/// <summary> /// Concrete implementation of see cref="IInterface" using see cref="Concrete"
/// </summary> class NamespaceDoc { }`

[看这里](http://www.ewoodruff.us/shfbdocs/html/48f5a893-acde-4e50-8c17-72b83d9c3f9d.htm)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2018-02-01T22:00:23.930

我看到了“外部 XML 注释文件”的文档。显示如下架构：

```
<doc>
    <assembly/>
    <members>
        <member/>
    </members>
</doc> 
```

如果将其放在单独的文件中，扩展名是什么（xml/aml），可以在 Visual Studio 项目中使用吗？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2020-05-05T05:28:11.997

这是 Tuinstoelen 接受的答案中显示的 C# 代码片段的 VB.Net 版本。

我将这个答案留给那些在 Google 上找到这个问题并需要 VB 版本的人，因为如果你尝试直接从 C# 翻译，就会有一个问题等待。

```
Namespace Global.TestNamespace
    ''' <summary>
    ''' The <see cref="TestNamespace"/> namespace contains classes for ....
    ''' </summary>
    <System.Runtime.CompilerServices.CompilerGeneratedAttribute()>
    Class NamespaceDoc
    End Class
End Namespace 
```

注意“全球”。附加到要记录的命名空间。至少对于我的 VB 项目配置，这是必要的，因此命名空间的名称不会嵌套在根命名空间内，而是根命名空间的名称。在我添加“Global.”之前，编译器正在为“TestNamespace.TestNamespace”生成摘要，而不仅仅是“TestNamespace”。鉴于编译器生成的 XML 文件中的信息不正确，SandCastle 没有将摘要识别为属于正确的命名空间。

# .net - 使用 CruiseControl.net 构建部署

> ID：156584
> 
> 赞同：6
> 
> 时间：2008-10-01T07:34:38.567
> 
> 标签：.net, cruisecontrol.net, nant

我已经看到了一些关于如何进行构建部署的示例，但是我有一些独特的事情想做：

1.  将构建部署到具有构建号的文件夹（例如，Project\Builds\8423）
2.  更改 .NET AssmblyInfo.cs 中的版本号以匹配内部版本号

有没有人在使用 NAnt + CruiseControl.net 的 .NET 项目之前这样做过？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-04T12:15:52.757

将构建部署到具有内部版本号的文件夹非常简单。 [CruiseControl.NET 的 NAnt 任务](http://confluence.public.thoughtworks.org/display/CCNET/NAnt+Task)会自动将许多属性传递给您的 NAnt 脚本。*CCNetLabel*属性是您用来创建部署目录的属性。CruiseControl.NET 文档中实际上有一个稍微过时的示例 NAnt 脚本就是这样做的。这是它的一个更好的版本：

```
<target name="publish">
    <if test="${not property::exists('CCNetLabel')}">
        <fail message="CCNetLabel property not set, so can't create labelled distribution files" />
    </if>

    <property name="publishDirectory" value="D:\Public\Project\Builds\${CCNetLabel}" />

    <mkdir dir="${publishDirectory}" />
    <copy todir="${publishDirectory}">
        <fileset basedir="${buildDirectory}\bin">
            <include name="*.dll" />
        </fileset>
    </copy>         
</target> 
```

就您的二进制文件进行版本控制而言，我发现以下方法比尝试更改您的 AssemblyInfo.cs 文件更干净、更容易。基本上，我创建了一个 CommonAssemblyInfo.cs 文件，该文件位于任何项目之外，与您的解决方案文件位于同一目录中。此文件包含我正在构建的所有程序集共有的内容，例如公司名称、版权信息，当然还有版本。此文件在 Visual Studio 中的每个项目中都有[链接](http://dotnettipoftheday.org/tips/linking_file_in_visual_studio.aspx)，因此每个项目都包含此信息（以及一个小得多的 AssemblyInfo.cs 文件，其中包含程序集特定的信息，如程序集标题）。

当通过 Visual Studio 或 NAnt 在本地构建项目时，将使用该 CommonAssemblyInfo.cs 文件。但是，当项目由 CruiseControl.NET 构建时，我使用 NAnt 通过[`<asminfo>`](http://nant.sourceforge.net/release/latest/help/tasks/asminfo.html)任务替换该文件。NAnt 脚本如下所示：

```
<target name="version">
    <property name="commonAssemblyInfo" value="${buildDirectory}\CommonAssemblyInfo.cs" />

    <!-- If build is initiated manually, copy standard CommonAssemblyInfo.cs file. -->
    <if test="${not property::exists('CCNetLabel')}">
        <copy file=".\src\CommonAssemblyInfo.cs" tofile="${commonAssemblyInfo}" />
    </if>

    <!-- If build is initiated by CC.NET, create a custom CommonAssemblyInfo.cs file. -->
    <if test="${property::exists('CCNetLabel')}">
        <asminfo output="${commonAssemblyInfo}" language="CSharp">
            <imports>
                <import namespace="System" />
                <import namespace="System.Reflection" />
            </imports>
            <attributes>
                <attribute type="AssemblyCompanyAttribute" value="My Company" />
                <attribute type="AssemblyCopyrightAttribute" value="Copyright © 2008 My Company" />
                <attribute type="AssemblyProductAttribute" value="My Product" />
                <attribute type="AssemblyVersionAttribute" value="1.0.0.${CCNetLabel}" />
                <attribute type="AssemblyInformationalVersionAttribute" value="1.0.0.${CCNetLabel}" />
            </attributes>
            <references>
                <include name="System.dll" />
            </references>
        </asminfo>
    </if>
</target>

<target name="build-my-project" depends="version">
    <csc target="library" output="${buildDirectory}\bin\MyProject.dll">
        <sources>
            <include name=".\src\MyProject\*.cs"/>
            <include name=".\src\MyProject\**\*.cs"/>
            <include name="${commonAssemblyInfo}"/>
        </sources>
    </csc>
</target> 
```

请注意在*版本*目标中设置*AssemblyVersionAttribute*和*AssemblyInformationalVersionAttribute*值的位置。CCNetLabel*属性*被插入到版本号中。为了获得额外的好处，您可以使用像前面提到的[SvnRevisionLabeller](http://code.google.com/p/svnrevisionlabeller/)这样的 CruiseControl.NET 插件。使用它，我们得到带有“2.1.8239.0”标签的构建，其中“8239”对应于我们正在构建的Subversion修订号。我们将这个内部版本号直接转储到我们的*AssemblyVersionAttribute*和*AssemblyInformationalVersionAttributes*****，并且我们的内部版本号和程序集上的版本号都可以很容易地追溯到我们版本控制系统中的特定修订。****

 **** * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-01T09:29:42.020

查看这个[开源项目](http://code.google.com/p/photon-dot-net/)。虽然它使用 MSBuild，但差异很小。

CC.NET 将 distrib 目录和版本传递给[Photon.ccnet脚本，该脚本是](http://code.google.com/p/photon-dot-net/source/browse/trunk/Photon.ccnet)[Photon.build](http://code.google.com/p/photon-dot-net/source/browse/trunk/Photon.build)脚本的简单包装器。版本号用于文件夹和包命名以及程序集版本。

版本号来自[CC.NET](http://code.google.com/p/svnrevisionlabeller/)的 svnRevisionLabellerPlugin

这[就是一切](http://build.lokad.com/distrib/shared/)最终的样子。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-26T16:03:34.310

我对 Cruise Control 和 nAnt 也很陌生，但我发现[Scott Hanselman 的博客文章](http://www.hanselman.com/blog/BuildingMSIFilesFromNAntAndUpdatingTheVDProjsVersionInformationAndOtherSinsOnTuesday.aspx)很有帮助。

不完美也不漂亮，但它确实完成了工作。

还有一个[UpdateVersion Utility](http://code.mattgriffith.net/UpdateVersion/)（Scott 似乎也参与其中）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-01T07:50:52.240

我还没有用 nant 完成它，但是我们已经用 C# 编写了一个自定义应用程序，它读取程序集并增加版本号。

我们从 ccnet 配置中的 exec 块调用它。

创建一个文件夹并复制文件将是微不足道的添加到该应用程序

我们的想法是我们整天都在使用 C#，所以修复/更改用 C# 编写的构建程序会更快，然后如果我们必须在此基础上学习 nant 脚本的内部结构

显然，如果您一直使用 nant，就没有理由不构建自定义 nant 插件来完成这项工作

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-01T08:01:12.183

我同意 BumperBox 的观点，一个单独的组件来完成增加内部版本号的繁重（？）提升也是我几年前采取的路线。它还具有能够应对其他外部因素的优势。例如，如果配置文件中存在特定条件，您可能希望增加版本号或内部版本号。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-02T17:21:00.053

您可以使用传递给您的 NAnt 脚本的 CCNetLabel 属性来设置它的部署位置。

至于 AssemblyInfo，对于 MSBuild，[MSBuildCommunityTasks](http://msbuildtasks.tigris.org/)中有一个 Task 运行良好。虽然您可以在更改它的 NAnt 脚本之前运行 MSBuild 脚本，但不知道 NAnt 等价物是什么。

配置很简单：

```
<AssemblyInfo CodeLanguage="C#"
    OutputFile="%(YourProjects.RootDir)%(Directory)Properties\AssemblyInfo.cs"
    AssemblyVersion="$(CCNetLabel)"
/> 
```

您将需要添加所需的任何其他属性，这将覆盖 AssemblyInfo 文件。

# c# - Dns.GetHostEntry 能否返回带有空地址列表的 IPHostEntry？

> ID：156585
> 
> 赞同：3
> 
> 时间：2008-10-01T07:34:42.560
> 
> 标签：c#, dns

我只是想知道是否存在可以成功解析主机名但返回的 hostEntry.AddressList 为空的情况。

目前我正在做这样的事情：

```
IPHostEntry hostEntry = Dns.GetHostEntry("some.hostname.tld");
if (hostEntry.AddressList.Count() < 1)
{
  // can that ever happen?
  throw new ArgumentException("hostName has no assigned IP-Address");
}
TcpClient client = new TcpClient(hostEntry.AddressList[0], 1234); 
```

我的假设是 Dns.GetHostEntry 如果未找到主机名或 AddressList 不为空，则会引发异常，但我不确定。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-01T08:00:25.617

不，您不会看到一个空的地址列表：即使您查询一个确实存在但没有 A 或 AAAA (IPv6) 记录的 DNS 标签，也会抛出一个 SocketException（“No such Host is Known”）。

您可以通过查看`InternalGetHostByName(string hostName, bool includeIPv6)`.NET 参考源版本中的 DNS.cs 中的函数来验证这一点。除了一些特定于平台的预防措施外，DNS 查找是 Winsock [gethostbyname](http://msdn.microsoft.com/en-us/library/ms738524.aspx)函数的简单包装。

Gethostbyname 要么失败，要么返回地址列表。永远不会返回一个空的地址列表，因为在这种情况下，函数将失败并返回 WSANO_DATA（“有效名称，没有请求类型的数据记录”），这意味着我们已经在 .NET 中看到了套接字异常。

*编辑 2012 年 5 月，响应提示无论如何都会返回一个空列表：*请注意，此答案仅适用于 Win32，并且 WinCE 等平台的行为可能完全不同。如果您在 Win32 上看到“空列表”行为，并且您提出的请求针对的是公开可用的 DNS 服务器，请发布您的代码...

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-01T10:41:25.950

只是为了记录。

感谢 mdb[接受的答案](https://stackoverflow.com/questions/156585/can-dnsgethostentry-ever-return-an-iphostentry-with-an-empty-addresslist#156638)，我查看[了 WSANA_DATA 错误的描述](http://msdn.microsoft.com/en-us/library/ms740668(VS.85).aspx)：

> 请求的名称有效并且在数据库中找到，但它没有正确的关联数据正在解析。通常的示例是使用 DNS（域名服务器）的主机名到地址转换尝试（使用 gethostbyname 或 WSAAsyncGetHostByName）。返回一条 MX 记录，但没有 A 记录——表明主机本身存在，但不能直接访问。

所以这几乎回答了我的问题:)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-01T07:43:19.153

这里有三种可能的情况：

1.  主机名存在（DNS 有 A 记录）并解析为 IP 地址

    *   条件永远不会被击中
2.  主机名存在（DNS 知道域）但是不存在 A 记录。

    *   这是一个极不可能发生的情况，我认为这从一开始就永远不会发生。
3.  主机名不存在

    *   抛出异常，你永远不会到达那里。

所以不，我认为这永远不会发生。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2016-08-12T22:04:14.300

答案是**肯定**的。GetHostEntry 方法向 DNS 服务器查询与 IP 地址关联的 IP 地址和别名。

**如果本地计算机没有安装 IPv6，则从 GetHostEntry 方法的结果中过滤 IPv6 地址。因此，如果只有 IPv6 结果可用于地址参数，则有可能取回一个空的 IPHostEntry 实例。**

返回的 IPHostEntry 实例的 Aliases 属性不会由此方法填充，并且始终为空。

# java - 在 Java 中，如何在 Web 应用程序中动态重新加载资源包？

> ID：156586
> 
> 赞同：8
> 
> 时间：2008-10-01T07:34:43.777
> 
> 标签：java, resources, resourcebundle

我们使用 fmt:setBundle 从数据库加载资源包（我们扩展了 ResourceBundle 类来做到这一点）。当我们修改数据库中的值时，我们必须重新加载 Web 服务器以在 Web 应用程序上显示新值。

是否有任何简单的方法可以在不重新启动 Web 服务器的情况下使用新值？

（我们**不想**总是从数据库中查找值，但我们想使缓存无效，例如通过调用特殊的“管理员”URL）

编辑：我们使用的是 JDK 1.4，所以我更喜欢那个版本的解决方案。:)

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-01T08:13:13.137

如果您使用的是 JDK 1.6，您可以使用回调方法`getTimeToLive()`和[ResourceBundle.Control](http://java.sun.com/javase/6/docs/api/java/util/ResourceBundle.Control.html)`needsReload()`来控制是否需要使用数据库中的新值加载包缓存。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-01T08:50:40.850

正如其他人在评论中指出的那样，您可能想要研究 Spring - 特别是[ReloadableResourceBundleMessageSource](http://static.springframework.org/spring/docs/2.5.x/api/org/springframework/context/support/ReloadableResourceBundleMessageSource.html)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2019-04-30T05:45:12.187

首先，您可以创建一个扩展自的类，`ReloadableResourceBundleMessageSource`以公开其内部类受保护的方法，称为`getProperties`. `PropertiesHolder`此方法从对象返回一个并发映射。其次，您应该在 Web 配置类中配置该扩展类的 bean。现在您可以在您的服务或业务层中使用 messageSource。这是参考链接[配置可重新加载的消息源包](https://stackoverflow.com/a/55914458/5874302)

# project-management - 与不合作的供应商合作

> ID：156601
> 
> 赞同：-1
> 
> 时间：2008-10-01T07:45:27.293
> 
> 标签：project-management

我们有一个项目正在使用其他供应商的一些商业产品与我们的系统集成。问题是特定的供应商非常不合作，想要向我们收取电子邮件回复甚至电话的费用。

我们如何与这种供应商打交道？问题是我们必须为我们的系统使用该产品，所以我们必须得到他们的支持；否则我可能会转向开源产品。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-01T08:04:52.817

在与第 3 方供应商合作时，您应该真正考虑签订服务水平协议 (SLA)，尤其是当您是按照客户的要求这样做时。如果您预先要求 SLA，则第 3 方可以预先告诉您他们的费用，或者可能会要求您支付支持合同的费用。该支持合同的成本（或至少一部分）可以计入原始客户账单。

SLA 并不能保证提供良好的服务，但如果您遇到供应商问题，它会为您提供一些提示，并使您能够更轻松地更改它们。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-01T08:05:31.223

不幸的是，这是一个不愉快的情况。你通常有两种选择：

1.  玩粗点。他们向您收取电子邮件费用？为他们做同样的事情——跟踪他们所做的一切，记录所有对话，确保他们信守**所有**承诺。如果他们不合作，他们要么真的很糟糕——在这种情况下，你可以向你的管理层提供有关他们失败的事实，或者他们（不太可能但可能发生）非常好——在这种情况下，你实际上可以按照他们的规则来省钱——归根结底，即使他们向您收取太多费用但提供一流的服务，与友好但笨拙的供应商相比，他们提供的服务存在很多问题，您也可以省钱。

2.  设法找到“停止敌对行动”的方法。与他们的经理交谈并解释您对这种情况感到不舒服。如果您当前正在与之合作的经理不合作，请上报给他的经理。有时去找他们的客户经理或销售人员会有所帮助——他们从不想失去您作为客户的身份，他们会尝试从头到尾解决问题。您可以尝试与他们的开发人员/支持建立良好的工作关系 - 这些人可以非正式地帮助您，这将是很棒的。

如果两种方法都不起作用 - 运行:)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-20T21:17:51.717

作为我自己的产品供应商，我必须指出，支持并不便宜。如果您为产品支付 300 至 400 美元，如果您希望免费提供开放式支持，供应商最终可能会在销售中失去他的衬衫。我们雇用的平均技术支持人员的成本在 15 美元到 20 美元/小时左右，这就是开始。再加上福利和间接费用，您现在可以达到 30 美元/小时的面积。

期望 10 小时以上免费支持的客户生活在一个梦幻世界，当产品价格的一定比例必须用于支付应计的初始开发成本、持续开发成本时，不要忘记称为利润的邪恶词。

我们通过电子邮件提供 30 天的免费技术支持。之后，如果客户需要帮助定制产品，我们希望客户支付每小时的成本。哦，我们确实为我们的产品提供退款保证。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-01T07:48:04.400

为什么不直接在您的博客或什至在这里发布您的推荐信，并附上他们的公司名称和产品？这将唤醒他们进入现实世界。

# apache-flex - 在 Flex 应用程序中处理英文和中文的最佳方式是什么？

> ID：156610
> 
> 赞同：2
> 
> 时间：2008-10-01T07:49:56.860
> 
> 标签：apache-flex

我需要能够提供英语和几种亚洲语言的 flex 组件。我查看了 flex 文档，似乎我必须构建几个 swf，这感觉不对。

有谁知道以不同语言捆绑字符串资源并处理字体的简单实用的方法？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-01T08:36:07.733

我想您知道如何本地化 Flex 应用程序的基础知识，但如果您想了解更多信息，这里有一个很好且详尽的描述：[运行时本地化](http://labs.adobe.com/wiki/index.php/Flex_3:Feature_Introductions:_Runtime_Localization)。

在 Flex 3 中，您可以通过三个选项来解决您的问题：

1.  将所有语言编译成 SWF 并在运行时切换语言
2.  为每种语言编译一个单独的 SWF
3.  将无语言或默认语言编译到 SWF 中并在运行时加载其他语言

第一个选项可能是最常见的，最不复杂的并且没有很多缺点。如果您有特殊需要，可以使用另外两个，例如必须不惜一切代价降低 SWF 的大小，或者需要在运行时从数据库中加载所有字符串。

要实现第一个选项，您需要为每种语言创建一个资源包（基本上是`.properties`位于以区域设置命名的目录中的许多文件，例如 en_US 表示美国英语或 sv_SE 表示瑞典语）。在代码中，您通过调用资源管理器来引用字符串：

```
<Label text="{resourceManager.getString('mybundle', 'mystring")'}/> 
```

这将在从当前语言环境中的“mybundle.properties”编译的资源包中检索一个名为“mystring”的字符串。

为了确保每个语言环境都实际编译到您添加`-locale=en_US,sv_SE`到编译器标志的应用程序中（但将`en_US,sv_SE`部分更改为您拥有资源包的语言）。您还需要将目录的位置添加到源路径：（`-source-path+=locale/{locale}`“ `{locale}`”部分将自动替换为`-locale`标志的值）。

现在您已将所有语言编译到 SWF 中，并且可以在运行时更改语言。这样做的方法是修改`localeChain`资源管理器的属性：

```
resourceManager.localeChain = ["sv_SE", "en_US"]; 
```

使用上面显示的设置，资源管理器将首先查看瑞典语资源包，然后查看美国英语资源包。您可以随时设置另一个订单，这样做会立即更改应用程序中的所有文本。

我鼓励您阅读[我上面提到的描述](http://labs.adobe.com/wiki/index.php/Flex_3:Feature_Introductions:_Runtime_Localization)，它更详细地解释了这一点，而且很可能以更易于理解的方式。它还解释了如何在使用 en_US 以外的语言环境编译应用程序之前进行一些准备工作。

您遇到的另一个问题是字体。那个更棘手。最好的办法是拥有一种具有完整 Unicode 字符范围的字体，这样您只需要嵌入它就可以显示任何文本。但是，这意味着您的选择更加有限。我知道 Windows 中至少有一个版本的 Aria 具有大量字符，而在 Mac 上还有一个 Helvetica（我认为，或者可能是 Lucida Grande，或两者兼而有之）也有大部分字符您需要显示多种亚洲语言。

将所有语言嵌入到同一个 SWF 中通常不会增加文件大小，因为文本非常轻量级，但字体绝对不是。嵌入 Arial 的整个 Unicode 版本可以将 SWF 的文件大小增加几兆字节，这对于 Web 应用程序来说很糟糕。根据具体情况，您可能必须为每种语言编译一个 SWF，因为否则字体数据会使 SWF 变得笨拙。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-01T20:17:25.440

小心字体。系统字体不是最漂亮的，但亚洲字体太大而无法嵌入。我们求助于为英语嵌入拉丁字体并为中文切换到系统字体。

小心旋转系统字体 - 你的文字会消失。我认为 Flash 10 可能已经解决了这个问题。

另外，请注意您为中文指定的字体字符串。

大多数操作系统都有漂亮的后备逻辑——如果你指定 Trebuchet 并尝试渲染一个中文字符，你的操作系统可能会决定使用一些亚洲字体。Flash 似乎打乱了这种后备逻辑，并在两种或多种亚洲字体之间动态切换。我们遇到过将鼠标悬停在文本块上会切换字体的情况。

要解决此问题，请指定包含您需要的所有字符的字体（不要回退到其他字体）。您将需要跨操作系统等进行测试。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-01T07:58:18.540

我们将 Flex 用于我们应用程序的客户端部分，并通过[`ResourceBundle`](http://livedocs.adobe.com/flex/201/html/wwhelp/wwhimpl/common/html/wwhelp.htm?context=LiveDocs_Book_Parts&file=l10n_076_4.html)s 支持 I18N。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-01T08:10:55.937

在 Flex 2.01 中，语言必须内置到 SWF 中——您不能在运行时更改它。在 Flex 3 中，您可以在运行时切换语言。

[http://labs.adobe.com/wiki/index.php/Flex_3:Feature_Introductions:_Runtime_Localization](http://labs.adobe.com/wiki/index.php/Flex_3:Feature_Introductions:_Runtime_Localization)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-01T14:35:33.907

上面遗漏的一个重要步骤是运行命令：

```
copylocale.exe en_US sv_SE 
```

从 sdk 的 bin 文件夹中。这是在文章中。

# java - 如何为 Sun App Server 8.2 设置 JNDI

> ID：156634
> 
> 赞同：0
> 
> 时间：2008-10-01T07:59:48.397
> 
> 标签：java, datasource, jndi

[http://localhost:8080/rtsclient/loginform.faces](http://localhost:8080/rtsclient/loginform.faces) Url jnp://localhost:1099 应用服务器类型 jboss40 数据源 jdbc/ilogDataSource 用户 rtsAdmin 密码 rtsAdmin

以上是针对jboss的。现在我已将 RTS 部署到 Sun Application Server 上。我想这样配置jndi。我的 RTS 客户端实际上可以访问它。

我该怎么做？我在这里问了这个问题

[http://forums.ilog.com/brms/index.php?topic=803.0](http://forums.ilog.com/brms/index.php?topic=803.0)

我知道这很具体。但是在sun应用服务器中一般怎么做呢？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-16T23:10:37.090

我认为在您的项目根目录中创建一个***jndi.properties***文件应该足够了。

```
org.omg.CORBA.ORBInitialHost=localhost
org.omg.CORBA.ORBInitialPort=1099
java.naming.security.principal=rtsAdmin
java.naming.security.credentials=rtsAdmin 
```

如果您需要，还可以配置一些其他的东西

```
java.naming.provider.url=...
java.naming.factory.initial=...
java.naming.factory.initial=com.sun.enterprise.naming.SerialInitContextFactory
java.naming.factory.url.pkgs=com.sun.enterprise.naming
java.naming.factory.state=com.sun.corba.ee.impl.presentation.rmi.JNDIStateFactoryImpl 
```

还有一种不太灵活的方法。在启动时向 InitialContext()-constructor 提供所需的值作为 Hashmap

```
Properties prop = new Properties();
prop.put(Context. ...., "...");
e.g.
prop.put(Context.SECURITY_PRINCIPAL, "rtsAdmin");
prop.put(Context.SECURITY_CREDENTIALS, "rtsAdmin");
InitialContext context = new InitialContext(prop); 
```

[在这里](http://java.sun.com/j2se/1.3/docs/api/javax/naming/Context.html#field_summary)检查您可以通过构造函数设置的内容

# mysql - MySQL查询为每个条目添加字符

> ID：156641
> 
> 赞同：18
> 
> 时间：2008-10-01T08:01:03.573
> 
> 标签：mysql

我有一个用户表，其中的用户名列由六位数字组成，例如 675381，我需要在每个用户名前面加上一个零，例如 0675381 将是上一个示例的最终输出，是否有可以处理的查询这？

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2008-10-01T08:06:47.537

```
UPDATE Tablename SET Username = Concat('0', Username); 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-01T08:07:29.300

该列是什么类型的？

如果是字符串类型，请尝试以下操作：

```
UPDATE your_table SET column_name=concat('0',column_name); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-01T08:09:59.760

你的意思是“前置”？即在前面添加它？

列是数字吗？你总是想输出 7 个字符吗？

假设这样的事情适用于查询：

```
select LPAD(CONVERT(username, CHAR), 7, '0') 
```

如果列是字符，则不需要 CONVERT() 部分，只需 LPAD 用户名。

如果要永久修改表中的值，则需要确保该列是字符类型并使用上述方法进行 UPDATE。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-01T22:43:54.513

你可能想使用 CONCAT_WS('', '0', Username) 因为如果有一个空值，那么你最终会得到 NULL 而不是 '0'。这可能不是问题，但我已经通过艰难的方式学到了一些东西。

# language-agnostic - 循环中的最后一个元素是否值得单独处理？

> ID：156650
> 
> 赞同：20
> 
> 时间：2008-10-01T08:04:28.387
> 
> 标签：language-agnostic, loops, for-loop, while-loop, control-structure

在复习的时候，有时会遇到这样的循环：

```
i = begin
while ( i != end ) {    
   // ... do stuff
   if ( i == end-1 (the one-but-last element) ) {
      ... do other stuff
   }
   increment i
} 
```

然后我问一个问题：你会写这个吗？

```
i = begin
mid = ( end - begin ) / 2 // (the middle element)
while ( i != end ) {    
   // ... do stuff
   if ( i > mid ) {
      ... do other stuff
   }
   increment i
} 
```

在我看来，这超出了编写循环的意图：你循环是因为每个元素都有一些共同的事情要做。使用此构造，您可以对某些元素执行不同的操作。因此，我得出结论，您需要为这些元素创建一个单独的循环：

```
i = begin
mid = ( end - begin ) / 2 //(the middle element)
while ( i != mid ) {    
   // ... do stuff
   increment i
}

while ( i != end ) {
   // ... do stuff
   // ... do other stuff
   increment i
} 
```

现在我什至在 SO 上看到了一个[关于](https://stackoverflow.com/questions/151046/c-last-loop-iteration-stl-map-iterator)如何以`if`一种好的方式编写 - 子句的问题......我很伤心：这里有些不对劲。

我错了吗？如果是这样，那么在编码时将循环体与特殊情况混在一起有什么好处？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-10-01T08:58:37.553

我认为这个问题不应该由一个原则来回答（例如“在一个循环中，平等对待每个元素”）。相反，您可以查看两个因素来评估实现是好还是坏：

1.  运行时有效性 - 编译后的代码运行速度快，还是以不同的方式运行会更快？
2.  代码可维护性——（对于其他开发人员）是否容易理解这里发生的事情？

如果通过在一个循环中完成所有事情来更快并且代码更具可读性，那么就这样做。如果速度较慢且可读性较差，请以另一种方式进行。

如果它更快且可读性较差，或者速度较慢但可读性更高，请找出哪些因素在您的特定情况下更重要，然后决定如何循环（或不循环）。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-10-01T08:11:28.120

我知道当人们试图将数组的元素加入逗号分隔的字符串时，我已经看到了这一点：

```
for(i=0;i<elements.size;i++) {
   if (i>0) {
     string += ','
   }
   string += elements[i]
} 
```

你要么在那里有那个 if 子句，要么你必须在最后再次复制字符串 += 行。

在这种情况下，明显的解决方案是

```
string = elements.join(',') 
```

但是 join 方法在内部执行相同的循环。并不总是有一种方法可以做你想做的事。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-10-01T08:15:34.037

@xtofl，

我同意你的担心。

百万次我遇到了类似的问题。

开发人员都为第一个或最后一个元素添加了特殊处理。

在大多数情况下，值得从**startIdx + 1**或**endIdx - 1**元素循环，甚至将一个长循环分成多个较短的循环。

在极少数情况下，不可能拆分循环。

在我看来，*不常见*的事情应该尽可能在循环之外处理。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-10-01T08:12:32.063

我开始意识到，当我将特殊情况放入 for 循环中时，我通常太聪明了，对自己不利。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-10-01T09:03:53.797

在您发布的最后一个片段中，您正在重复 // .... do stuff 的代码。

当您对一组不同的索引进行完全不同的操作时，保持 2 个循环是有意义的。

```
i = begin
mid = ( end - begin ) / 2 //(the middle element)
while ( i != mid ) {    
   // ... do stuff
   increment i
}

while ( i != end ) {
   // ... do other stuff
   increment i
} 
```

情况并非如此，您仍然希望保留一个循环。然而事实仍然是你仍然保存 ( end - begin ) / 2 比较次数。因此，归结为您是希望代码看起来整洁还是希望节省一些 CPU 周期。电话是你的。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-10-01T10:01:08.277

我认为你已经完全确定了。大多数人都陷入了在循环中包含条件分支的陷阱，而他们可以在外部执行它们：这只是*更快*。

例如：

```
if(items == null)
    return null;

StringBuilder result = new StringBuilder();
if(items.Length != 0)
{
    result.Append(items[0]); // Special case outside loop.
    for(int i = 1; i < items.Length; i++) // Note: we start at element one.
    {
        result.Append(";");
        result.Append(items[i]);
    }
}
return result.ToString(); 
```

而你描述的中间情况简直**令人讨厌**。想象一下，如果该代码增长并且需要重构为不同的方法。

除非您正在解析 XML <grin> 循环，否则应尽可能保持简单和简洁。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-10-01T08:12:40.783

我认为你对循环意味着平等地处理所有元素是正确的。不幸的是，有时会有一些特殊情况，这些应该通过 if 语句在循环构造中处理。

如果有很多特殊情况，您可能应该考虑想出一些方法来处理不同结构中的两组不同元素。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2013-04-06T05:55:55.957

我更喜欢简单地从循环中排除元素并在循环外进行单独处理

**例如：让我们考虑 EOF 的情况**

```
i = begin
while ( i != end -1 ) {    
   // ... do stuff for element from begn to second last element
   increment i
}

if(given_array(end -1) != ''){
   // do stuff for the EOF element in the array
} 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-10-01T08:08:38.407

当然，可以拉出的循环中的特殊外壳是愚蠢的。我也不会复制 do_stuff ；我要么把它放在一个函数或一个宏中，所以我不会复制粘贴代码。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-10-01T08:10:40.523

哪一个表现更好？

如果项目的数量非常大，那么我总是会循环一次，特别是如果您要对每个项目执行*一些操作。*评估条件的成本可能低于循环两次。

哎呀，当然你不是循环两次......在这种情况下，两个循环是更可取的。但是，我认为首要考虑因素应该是性能。如果您可以通过对循环边界的简单操作（一次）来划分工作，则无需在循环中产生条件（N 次）。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-10-01T08:14:43.883

我讨厌看到的另一件事是[for-case 模式](http://thedailywtf.com/Articles/The_FOR-CASE_paradigm.aspx)：

```
for (i=0; i<5; i++)
{
  switch(i)
  {
    case 0:
      // something
      break;
    case 1:
      // something else
      break;
    // etc...
  }
} 
```

我已经在真实代码中看到了这一点。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-10-01T09:06:22.027

如果只执行一次，则应在循环外执行特殊情况。

但是，由于作用域，可能有一个索引或一些其他变量更容易保留在循环中。将数据结构上的所有操作放在循环控制结构中可能还有一个上下文原因，尽管我认为这本身就是一个弱论点。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-10-01T09:10:25.387

它只是根据需要和方便使用它。因此，没有提到平等对待元素，而且将语言提供的功能组合在一起当然没有害处。

# perl - Perl 最好的 XSLT 引擎是什么？

> ID：156683
> 
> 赞同：10
> 
> 时间：2008-10-01T08:18:03.547
> 
> 标签：perl, apache, pdf, xhtml, xslt

我想知道有哪些 XSLT 引擎可以很好地与 Perl 配合使用。

我将使用 Apache (2.0) 和 Perl，并且我想获得 PDF 和 XHTML。

我是这类项目的新手，因此欢迎提出任何意见或建议。

谢谢。

* * *

在谷歌上做一个简单的搜索，我发现了很多，我想还有更多。

*   [http://www.mod-xslt2.com/](http://www.mod-xslt2.com/)
*   [http://xml.apache.org/xalan-j/](http://xml.apache.org/xalan-j/)
*   [http://saxon.sourceforge.net/](http://saxon.sourceforge.net/)
*   [http://www.dopscripts.com/xslt_parser.html](http://www.dopscripts.com/xslt_parser.html)

欢迎对您的经历发表任何评论。

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2008-10-01T09:32:02.980

第一个错误 -[在 CPAN 上搜索](http://search.cpan.org/search?query=XSLT&mode=all)，而不是 Google :)

这引发了一堆结果，但确实突出了 CPAN 的问题，即有不止一个解决方案，而且并不总是很清楚哪些解决方案有效、已被放弃、已损坏、速度慢或其他。

令人不安的是，最好的答案（或者至少是最好的答案之一）出现在结果的**第四**页：（正如其他人所建议的那样，[XML::LibXSLT](http://search.cpan.org/dist/XML-LibXSLT/)很健壮并且可以胜任：

```
 use XML::LibXSLT;
  use XML::LibXML;

  my $parser = XML::LibXML->new();
  my $xslt = XML::LibXSLT->new();

  my $source = $parser->parse_file('foo.xml');
  my $style_doc = $parser->parse_file('bar.xsl');

  my $stylesheet = $xslt->parse_stylesheet($style_doc);

  my $results = $stylesheet->transform($source);

  print $stylesheet->output_string($results); 
```

如果要将结果输出到文件，请添加此

```
#create output file
open(my $output_xml_file_name, '>', 'test.xml');
print $output_xml_file_name "$results"; 
```

但是，如果您不想做任何花哨的事情，可以[使用 XML::LibXSLT::Easy ，它本质上只是将上述内容包装在一个方法调用中（并使用](http://search.cpan.org/dist/XML-LibXSLT-Easy/)[Moose](http://search.cpan.org/dist/Moose/)在幕后做了很多聪明的事情。检查源代码教育！）。

```
 use XML::LibXSLT::Easy;

  my $p = XML::LibXSLT::Easy->new;

  my $output = $p->process( xml => "foo.xml", xsl => "foo.xsl" ); 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-01T08:35:52.880

到目前为止，我对用于非 xslt 任务的[XML::LibXML非常满意，它的文档指向](http://search.cpan.org/perldoc?XML::LibXML)[XML::LibXSLT](http://search.cpan.org/perldoc?XML::LibXSLT)，看起来相当不错，但到目前为止我还没有经验

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-01T08:23:44.533

不能说哪个是最好的解决方案，因为我没有机会全部尝试。
但我可以推荐你尝试 Perl 模块[LibXSLT](http://search.cpan.org/~pajas/XML-LibXSLT-1.66/LibXSLT.pm)。
它是 gnome libxslt 库的接口。我在我最近的一个项目中使用它对它很满意。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-01T12:04:57.560

你没有说什么操作系统，但对于大多数 *nix 平台，[XML::LibXML](http://search.cpan.org/perldoc?XML::LibXSLT)将是最容易使用和安装的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2017-05-16T18:47:08.300

以下是一些旨在替换 XSLT 的 Perl 库：

*   [XPathScript](http://search.cpan.org/perldoc?XML%3A%3AXPathScript)
*   [XSLTish](http://search.cpan.org/~dakkar/Tree-Transform-XSLTish-0.3/lib/Tree/Transform/XSLTish.pm)
*   [XSH2](https://metacpan.org/pod/XML::XSH2)

# java - 创建具有安全性的 REST Web 服务器

> ID：156684
> 
> 赞同：5
> 
> 时间：2008-10-01T08:18:16.887
> 
> 标签：java, rest, webserver

我对创建网络服务器非常陌生 - 我曾多次尝试理解它们并编写一个快速的网络服务器，但它从来没有被“点击”过。目前我的印象是 REST 最适合我的目的（我稍后会解释）。

任何人都可以向我展示 Java 中的基本代码示例（使用 Tomcat Apache）或教程资源来展示网络服务器如何：

*   可用于安全性 - 即传递某种值以识别客户端 - 从它们的网络服务器将根据某些标准拒绝或授予对客户端的访问 - 可能是查找列表。
*   一旦客户端被成功接受，他们将被允许将更多的值传递给网络服务器，这些值将用于在数据库表中写入一行。

非常感谢。

PS - 我原以为 Eclipse Ganymede 可能会附带一些东西？如果有人可以确认？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-01T09:11:29.987

用 Java 编写 RESTful 资源的最佳方式是通过 JAX-RS 标准。因此，我建议您下载[JAX-RS 参考实现 Jersey](http://jersey.java.net/)并查看其示例；它有很多。举一个旋转的例子，然后尝试破解它来做你喜欢的事情。

BTW JAX-RS 可以在任何 Servlet 引擎中运行——你只需构建一个 WAR 并部署它（Jersery 示例中有示例）——尽管 Jersey 还带有一个小型轻量级 Web 服务器，你也可以使用它，这更容易一些使用 - 同样在这个发行版中有例子。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-01T12:23:02.727

我还建议你看看[Restlet](http://www.restlet.org/)

# javascript - 如何在 Internet Explorer 中开始自动下载文件？

> ID：156686
> 
> 赞同：75
> 
> 时间：2008-10-01T08:19:29.050
> 
> 标签：javascript, html, internet-explorer, meta-tags

如何在 Internet Explorer 中初始化文件的自动下载？

例如，在下载页面中，我希望出现下载链接和一条消息：“如果您的下载没有自动开始......等等”。下载应在页面加载后不久开始。

在 Firefox 中这很容易，您只需在标题中包含一个元标记，`<meta http-equiv="Refresh" content="n;url">`其中 n 是秒数，`url`是下载 URL。这在 Internet Explorer 中不起作用。如何在 Internet Explorer 浏览器中进行这项工作？

* * *

## 回答 #1

> 赞同：109
> 
> 时间：2008-10-01T08:34:41.370

[SourceForge](http://en.wikipedia.org/wiki/SourceForge)使用属性指向要下载的文件的`<iframe>`元素。`src=""`

```
<iframe width="1" height="1" frameborder="0" src="[File location]"></iframe> 
```

（副作用：没有重定向，没有 JavaScript，原始 URL 保持不变。）

* * *

## 回答 #2

> 赞同：52
> 
> 时间：2008-11-18T23:16:23.980

我*讨厌*网站使下载变得如此复杂并[使用黑客而不是好的旧链接](http://adactio.com/journal/6022/)。

### 死简单版本：

```
<a href="file.zip">Start automatic download!</a> 
```

有用！在每个浏览器中！

* * *

如果您要下载通常以内联方式显示的文件（例如图像），则 HTML5 具有`download`强制下载文件的属性。它还允许您覆盖文件名（[尽管有更好的方法](https://stackoverflow.com/a/216777/27009)）：

```
<a href="report-generator.php" download="result.xls">Download</a> 
```

### 带有“感谢”页面的版本：

如果您想在下载后显示“谢谢”，请使用：

```
<a href="file.zip" 
   onclick="if (event.button==0) 
     setTimeout(function(){document.body.innerHTML='thanks!'},500)">
 Start automatic download!
</a> 
```

其中的功能`setTimeout`可能更高级，例如通过 AJAX 下载整页（但不要离开页面——不要触摸`window.location`或激活其他链接）。

关键是下载链接是真实的，可以复制，拖动，下载加速器拦截，获取`:visited`颜色，如果在浏览器重新启动后页面保持打开状态，则不会重新下载等。

[这就是我用于 ImageOptim 的方法](https://imageoptim.com)

* * *

## 回答 #3

> 赞同：24
> 
> 时间：2008-10-01T08:29:23.130

我最近通过在页面上放置以下脚本来解决它。

```
setTimeout(function () { window.location = 'my download url'; }, 5000) 
```

我同意元刷新会更好，但如果它不起作用你会做什么......

* * *

## 回答 #4

> 赞同：22
> 
> 时间：2012-03-07T17:45:36.790

我有一个类似的问题，上述解决方案都不适合我。这是我的尝试（需要 jquery）：

```
$(function() {
  $('a[data-auto-download]').each(function(){
    var $this = $(this);
    setTimeout(function() {
      window.location = $this.attr('href');
    }, 2000);
  });
}); 
```

用法：只需添加一个属性调用`data-auto-download`指向相关下载的链接：

```
<p>The download should start shortly. If it doesn't, click
<a data-auto-download href="/your/file/url">here</a>.</p> 
```

它应该适用于所有情况。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2011-06-25T04:59:38.277

一个简单的 jQuery 为我解决了这个问题。

```
$(function() {
   $(window).bind('load', function() {
      $("div.downloadProject").delay(1500).append('<iframe width="0" height="0" frameborder="0" src="[YOUR FILE SRC]"></iframe>'); 
   });
}); 
```

在我的 HTML 中，我只是有

```
<div class="downloadProject"></div> 
```

所有这一切都是等待一秒钟半，然后将 div 与 iframe 一起附加到您要下载的文件。当 iframe 更新到页面上时，您的浏览器会下载该文件。就那么简单。:D

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2012-10-04T00:50:09.193

我用过这个，似乎工作，只是简单的 JS，没有框架：

```
Your file should start downloading in a few seconds. 
If downloading doesn't start automatically
<a id="downloadLink" href="[link to your file]">click here to get your file</a>.

<script> 
    var downloadTimeout = setTimeout(function () {
        window.location = document.getElementById('downloadLink').href;
    }, 2000);
</script> 
```

**注意：这会在页面加载的那一刻开始超时。**

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2016-04-28T13:48:55.463

适用于 Chrome、firefox 和 IE8 及更高版本：

```
var link = document.createElement('a');
document.body.appendChild(link);
link.href = url;
link.click(); 
```

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2013-01-28T15:40:38.533

这是我在某些网站中使用的（需要 jQuery）。：

```
$(document).ready(function() {
    var downloadUrl = "your_file_url";
    setTimeout("window.location.assign('" + downloadUrl + "');", 1000);
}); 
```

文件会在 1 秒后自动下载。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2012-06-16T05:44:36.273

我检查并发现，它可以通过将 onclick 事件写入 Anchor 标签或输入按钮来处理按钮单击

```
onclick='javascript:setTimeout(window.location=[File location], 1000);' 
```

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2016-01-14T14:42:59.293

回到根源，我使用这个：

```
<meta http-equiv="refresh" content="0; url=YOURFILEURL"/> 
```

也许不符合 WC3，但在所有浏览器上都能完美运行，没有 HTML5/JQUERY/Javascript。

问候汤姆 :)

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2017-08-01T06:43:20.593

我希望这适用于所有浏览器。您还可以设置自动下载时间。

```
<html>
<head>
<title>Start Auto Download file</title>
<script src="http://code.jquery.com/jquery-3.2.1.min.js"></script>
<script>
$(function() {
$('a[data-auto-download]').each(function(){
var $this = $(this);
setTimeout(function() {
window.location = $this.attr('href');
}, 2000);
});
});
</script>
</head>
<body>
<div class="wrapper">
<p>The download should start shortly. If it doesn't, click
<a data-auto-download href="auto-download.zip">here</a>.</p>
</div>
</body>
</html> 
```

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2019-04-15T09:18:02.123

多一个 ：

```
var a = document.createElement('a');
a.setAttribute('href', dataUri);
a.setAttribute('download', filename);

var aj = $(a);
aj.appendTo('body');
aj[0].click();
aj.remove(); 
```

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2008-10-03T18:11:38.750

确保提供**没有**无缓存标头的文件！如果用户在不先保存的情况下尝试“打开”下载，则 IE 会遇到此问题。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2010-07-02T11:30:04.247

这似乎对我有用 - 在所有浏览器中。

```
 <script type="text/javascript">
    window.onload = function(){
     document.location = 'somefile.zip';
    }
    </script> 
```

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2012-01-07T08:01:10.933

我认为这对你有用。但是，如果访问者在几秒钟内得到一些东西而不花费更多时间，他们就会很容易，因此他们也会再次访问您的网站。 `<a href="file.zip" onclick="if (event.button==0) setTimeout(function(){document.body.innerHTML='thanks!'},500)"> Start automatic download! </a>`

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2015-07-07T21:04:04.643

对于那些试图使用**动态链接**触发下载的人来说，让它在浏览器中一致地工作是很棘手的。

我在 IE10+ 下载 PDF 时遇到了问题，并使用[了 @dandavis 的](https://stackoverflow.com/questions/25121384/ie-download-file#comment39311404_25121384) `download`功能（[https://github.com/rndme/download](https://github.com/rndme/download)）。

IE10+需要`msSaveBlob`。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2019-02-19T06:11:07.587

不错的jQuery解决方案：

```
jQuery('a.auto-start').get(0).click(); 
```

您甚至可以在`<a>`标签内设置不同的下载文件名：

```
Your download should start shortly. If not - you can use
<a href="/attachments-31-3d4c8970.zip" download="attachments-31.zip" class="download auto-start">direct link</a>. 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2020-06-09T15:39:06.193

```
<meta http-equiv="Refresh" content="n;url"> 
```

就是这样。容易，对吧？

```
<meta http-equiv="Refresh" content="n;url">
```

# asp.net - 社区服务器用户名问题 - 会员商店中未找到的用户用户名不存在

> ID：156688
> 
> 赞同：1
> 
> 时间：2008-10-01T08:20:56.457
> 
> 标签：asp.net, sql, community-server

每当在特定 sectionID 上遍历 googlesitemap.ashx 时，我的社区服务器安装经常发生错误。我怀疑用户名已被修改，但帖子尚未重新缓存以反映这一点。

有没有办法可以通过在数据库上执行 select 语句来检查数据完整性，或者有没有办法强制数据库重新缓存？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-21T14:14:36.380

与其说是答案，但您可以通过运行以下查询找到受影响的数据条目...

```
Select * 
FROM cs_Posts
Where UserID Not In (Select UserID 
                     From cs_Users Where UserAccountStatus = 2) 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-05T01:50:29.907

如果社区服务器发现不在 MemberRoleProfileProvider 实例中的用户，则可能会引发此错误。

以CommunityServer.Users *AddMembershipDataToUser()*为例

**更新：**

* * *

我通过注意到用户名存储在两个表中 - cs_Users 和 aspnet_Users 解决了这个问题。结果不知何故，每个表中的用户名都不同。手动更新，使名称相同解决了这个问题。

此外，用户将在存储过程*cs_Membership_GetUsersByName*的以下行中失去成员资格：

```
INSERT INTO @tbUsers
  SELECT UserId
  FROM   dbo.aspnet_Users ar, @tbNames t
  WHERE  LOWER(t.Name) = ar.LoweredUserName AND ar.ApplicationId = @ApplicationId 
```

@tbNames 是一个名称表，在某些时候来自 cs_Users(?)，因此用户名不匹配，并且用户稍后没有插入到结果中。

* * *

另见：[http ://dev.communityserver.com/forums/t/490899.aspx?PageIndex=2](http://dev.communityserver.com/forums/t/490899.aspx?PageIndex=2)

# java - 你有 Hibernate 实体的通用基类吗？

> ID：156689
> 
> 赞同：20
> 
> 时间：2008-10-01T08:23:02.053
> 
> 标签：java, hibernate, entities, base-class

你有 Hibernate 实体的通用基类，即具有 id、版本和其他通用属性的 MappedSuperclass 吗？有什么缺点吗？

例子：

```
@MappedSuperclass()
public class BaseEntity {

    private Long id;
    private Long version;
    ...

    @Id @GeneratedValue(strategy = GenerationType.AUTO)
    public Long getId() {return id;}

    public void setId(Long id) {this.id = id;}

    @Version
    public Long getVersion() {return version;}
    ...

    // Common properties
    @Temporal(TemporalType.TIMESTAMP)
    public Date creationDate() {return creationDate;}
    ...
}

@Entity
public class Customer extends BaseEntity {
    private String customerName;
    ...
} 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-01T10:20:56.607

这对我们来说很好。除了 ID 和创建日期，我们还有一个修改日期。我们还有一个中间*TaggedBaseEntity*实现了一个*Taggable*接口，因为我们的一些 Web 应用程序的实体有标签，比如 Stack Overflow 上的问题。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-05T23:45:20.970

我使用的主要是实现 hashCode() 和 equals()。我还添加了一个漂亮地打印实体的方法。作为对上述 DR 的响应，其中大部分都可以被覆盖，但在我的实现中，您会遇到 Long 类型的 ID。

```
public abstract class BaseEntity implements Serializable {

    public abstract Long getId();
    public abstract void setId(Long id);

    /**
     * @see java.lang.Object#hashCode()
     */
    @Override
    public int hashCode() {
        final int prime = 31;
        int result = 1;
        result = prime * result + ((getId() == null) ? 0 : getId().hashCode());
        return result;
    }

    /**
     * @see java.lang.Object#equals(Object)
     */
    @Override
    public boolean equals(Object obj) {
        if (this == obj)
            return true;
        if (obj == null)
            return false;
        if (getClass() != obj.getClass())
            return false;
        BaseEntity other = (BaseEntity) obj;
        if (getId() == null) {
            if (other.getId() != null)
                return false;
        } else if (!getId().equals(other.getId()))
            return false;
        return true;
    }

    /**
     * @see java.lang.Object#toString()
     */
    @Override
    public String toString() {
        return new StringBuilder(getClass().getSimpleName()).append(":").append(getId()).toString();
    }

    /**
     * Prints complete information by calling all public getters on the entity.
     */
    public String print() {

        final String EQUALS = "=";
        final String DELIMITER = ", ";
        final String ENTITY_FORMAT = "(id={0})";

        StringBuffer sb = new StringBuffer("{");

        PropertyDescriptor[] properties = PropertyUtils.getPropertyDescriptors(this);
        PropertyDescriptor property = null;
        int i = 0;
        while ( i < properties.length) {

            property = properties[i];
            sb.append(property.getName());
            sb.append(EQUALS);

            try {
                Object value = PropertyUtils.getProperty(this, property.getName());
                if (value instanceof BaseEntity) {
                    BaseEntity entityValue = (BaseEntity) value;
                    String objectValueString = MessageFormat.format(ENTITY_FORMAT, entityValue.getId());
                    sb.append(objectValueString);
                } else {
                    sb.append(value);
                }
            } catch (IllegalAccessException e) {
                // do nothing
            } catch (InvocationTargetException e) {
                // do nothing
            } catch (NoSuchMethodException e) {
                // do nothing
            }

            i++;
            if (i < properties.length) {
                sb.append(DELIMITER);
            }
        }

        sb.append("}");

        return sb.toString();
    }
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-04T10:57:36.540

我会毫不犹豫地使用通用基类，毕竟这就是 O/R 映射的重点。

我也使用公共基类，但前提是实体至少共享一些公共属性。如果 ID 是唯一的公共属性，我不会使用它。到目前为止，我没有遇到任何问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-12-15T19:12:35.007

它对我也很有效。

请注意，您还可以根据需要在此实体中添加一些事件侦听器/拦截器，例如 Hibernate Envers 一个或任何自定义的，以便您可以： - 跟踪所有修改 - 知道哪个用户进行了最后修改 - 自动更新最后修改- 自动设置第一个插入日期和其他类似的东西......

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2010-01-14T16:34:02.760

你可以在这里找到一些样本

[http://blogsprajeesh.blogspot.com/2010/01/nhibernate-defining-mappings-part-4.html](http://blogsprajeesh.blogspot.com/2010/01/nhibernate-defining-mappings-part-4.html)

# ms-access - 同时运行 Access 2003 和 2007 是否安全？

> ID：156694
> 
> 赞同：1
> 
> 时间：2008-10-01T08:26:16.743
> 
> 标签：ms-access, ms-access-2007

我关于在 Access 2003 和 2007 之间切换时的重新配置延迟的问题发表了评论：

*顺便说一句，您无法避免在 Access 2007 和早期版本之间进行重新配置。Access 2007 使用一些与早期版本相同的注册表项，并且在打开 Access 2007 时必须重写它们。*

如果是这样，那么同时在两个版本中运行/开发数据库实际上是否安全？注册表更改是否会影响 Access 启动后的操作。例如重新编译/保存对对象的更改？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-01T13:49:04.547

它大部分时间都可以工作，但并不完全安全，这就是为什么 Microsft 拒绝支持在同一台电脑上安装多个 Microsoft Office。推荐的解决方案是安装虚拟机并在虚拟机上安装第二个 Microsoft Office 版本。然后，您可以从一个版本的 Access 切换到另一个版本，而不会相互干扰（并且没有切换时间等待！）

Microsoft 提供了 32 位和 64 位版本的免费下载 Virtual PC 2007：

[http://www.microsoft.com/downloads/details.aspx?FamilyID=04d26402-3199-48a3-afa2-2dc0b40a73b6&DisplayLang=en](http://www.microsoft.com/downloads/details.aspx?FamilyID=04d26402-3199-48a3-afa2-2dc0b40a73b6&DisplayLang=en)

这是服务包：

[http://www.microsoft.com/downloads/details.aspx?FamilyID=28c97d22-6eb8-4a09-a7f7-f6c7a1f000b5&DisplayLang=en](http://www.microsoft.com/downloads/details.aspx?FamilyID=28c97d22-6eb8-4a09-a7f7-f6c7a1f000b5&DisplayLang=en)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-01T13:16:38.823

它非常安全，我经常这样做（运行和开发）。在 Access 2007 中打开数据库后，一些额外的属性将被添加到数据库中。但是，这样做的方式是您以后仍然可以在 Access 2003 中安全地打开数据库。

我们还在多版本环境中安装了数据库，不同的人使用相同的后端，前端在 Access 2003 或 2007 中打开。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-03T19:39:04.720

在我看来，您打开的 Access 实例将在打开时继承注册表设置。因此，如果您打开 A2K7，您将获得它在“配置 Office”过程中写入的注册表设置。如果在 A2K7 仍处于打开状态时打开 A2K3，它将重新配置注册表设置并为其会话继承这些设置。这对已经运行的 A2K7 实例没有影响。

唯一可能的例外是，如果“配置...”进程更改了某些注册表项，Access 在打开时不会读取，但会在会话的后期读取。我强烈怀疑 MS 会不会那样设计东西。自从 MS 引入 MS Installer（大多数使用 Office 2000 的人第一次看到）以来，Professional Access 开发人员一直在处理这种事情，并且 A2K7 问题仅比以前的版本稍差（尽管在 Vista 上，它更复杂，因为Vista 处理注册表更改的方式）。MS 因在一台 PC 上考虑多个版本的 Access 而感到沮丧的事实并不意味着它实际上很危险——它仅表明他们不想投入资源来支持这种情况。

# javascript - 哪些 Web 浏览器原生支持 Array.forEach()

> ID：156696
> 
> 赞同：41
> 
> 时间：2008-10-01T08:26:55.790
> 
> 标签：javascript, cross-browser

除了 Firefox 之外，还有哪些浏览器支持 Array.forEach()？ [Mozilla 说这是标准的扩展](http://developer.mozilla.org/En/Core_JavaScript_1.5_Reference:Objects:Array:forEach#Compatibility)，我意识到添加到数组原型中很简单，我只是想知道其他浏览器支持它吗？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2011-09-13T11:38:03.633

我刚刚检查了另一个问题：[JavaScript for...in vs for](https://stackoverflow.com/questions/242841/javascript-foreach-vs-for/6442930#6442930)。

在 kangax 的[ECMAScript 5 兼容性表中](http://kangax.github.com/es5-compat-table/)，Array.forEach 对除 IE8 之外的所有浏览器都获得了“是”。

截至 2011 年 9 月，IE 浏览器在桌面设备上的份额[不到 40%](http://en.wikipedia.org/wiki/Usage_share_of_web_browsers#Summary_table)，[至少 8% 的浏览器是 IE 9](http://marketshare.hitslink.com/browser-market-share.aspx?qprid=2&qpcustomd=0)。

换句话说，现在大约 70% 的桌面浏览器都支持 Array.forEach。显然，这个数字因地域和其他因素而有很大差异——例如，某些地区或国家（例如巴西）的 Chrome 用户比例更高，而某些（例如中国）的 IE6 和 IE8 用户则要多得多.

我还没有检查，但移动支持（在 WebKit 和 Opera 浏览器上）可能更高。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-10-01T09:04:35.747

Wikipedia的[JavaScript](http://en.wikipedia.org/wiki/JavaScript "JavaScript - 维基百科，免费的百科全书")文章按浏览器列出了 JS 版本。forEach 是[JavaScript 1.6 的一部分](http://developer.mozilla.org/en/New_in_JavaScript_1.6 "JavaScript 1.6 中的新功能")。所以大多数浏览器确实支持它，除了 Opera 9.02（我刚刚测试过）。Opera 9.5（我刚刚安装！）支持它，以及用于 Array 的 indexOf。

令人惊讶的是，它不是官方的。我[在 Opera 9.5 的 ECMAScript 支持](http://www.opera.com/docs/specs/opera95/js/ecma/)页面中看不到它的支持。也许这是一种忽视，或者也许只是他们不想宣传的部分支持。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2009-11-30T23:42:30.713

由于 IE 不支持它（甚至不支持 v8），我使用 jQuery.each() -- [http://docs.jquery.com/Utilities/jQuery.each](http://docs.jquery.com/Utilities/jQuery.each)

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-01T08:34:29.123

所有现代浏览器，但 IE。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-01T09:26:02.713

Microsoft AJAX 客户端库将此添加到 Array 原型中，因此如果您的站点中有该客户端库，那么您肯定会拥有它。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-03-23T15:49:50.490

如果您需要所有浏览器都支持此功能以及其他 JavaScript 1.6 到 1.8 功能，我建议使用可定制的[jPaq](http://jpaq.org/ "帕克")库。这些功能是按照 Mozilla 建议的方式实现的。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2020-12-15T08:09:58.667

我在[caniuse.com](http://caniuse.com)上进行了检查，看起来所有浏览器都支持，`foreach`除了**Opera Mini**支持信息为`?Support unknow`. 如果您有兴趣，可以使用此链接检查浏览器对任何功能的支持。[https://caniuse.com/?search=foreach](https://caniuse.com/?search=foreach)

# java - 如何将字符从 Oracle 编码为 XML？

> ID：156697
> 
> 赞同：8
> 
> 时间：2008-10-01T08:27:24.413
> 
> 标签：java, xml, oracle, encoding

在我的环境中，我使用 Java 将结果集序列化为 XML。它基本上是这样发生的：

```
//foreach column of each row
xmlHandler.startElement(uri, lname, "column", attributes);
String chars = rs.getString(i);
xmlHandler.characters(chars.toCharArray(), 0, chars.length());
xmlHandler.endElement(uri, lname, "column"); 
```

XML 在 Firefox 中如下所示：

```
<row num="69004">
    <column num="1">10069</column>
    <column num="2">sd&#26;</column>
    <column num="3">FCVolume                      </column>
</row> 
```

但是当我解析 XML 时，我得到了

> org.xml.sax.SAXParseException：字符引用“ **”是无效的 XML 字符。**

 **我现在的问题是：我必须替换哪些字符或者我必须如何编码我的字符，它们将是有效的 XML？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-01T08:46:37.893

[我在Xml Spec](http://www.w3.org/TR/2006/REC-xml11-20060816/#charsets)中发现了一个有趣的列表：根据该列表，不鼓励使用 Character #26 (Hex: *#x1A* )。

> 也不鼓励使用以下范围内定义的字符。它们要么是控制字符，要么是永久未定义的 Unicode 字符

查看[完整的范围](http://www.w3.org/TR/2006/REC-xml11-20060816/#charsets)。

此代码替换字符串中的所有无效 Xml Utf8：

```
public String stripNonValidXMLCharacters(String in) {
    StringBuffer out = new StringBuffer(); // Used to hold the output.
    char current; // Used to reference the current character.

    if (in == null || ("".equals(in))) return ""; // vacancy test.
    for (int i = 0; i < in.length(); i++) {
        current = in.charAt(i);
        if ((current == 0x9) ||
            (current == 0xA) ||
            (current == 0xD) ||
            ((current >= 0x20) && (current <= 0xD7FF)) ||
            ((current >= 0xE000) && (current <= 0xFFFD)) ||
            ((current >= 0x10000) && (current <= 0x10FFFF)))
            out.append(current);
    }
    return out.toString();
} 
```

它取自[Invalid XML Characters：当有效的 UTF8 并不意味着有效的 XML](http://cse-mjmcl.cse.bris.ac.uk/blog/2007/02/14/1171465494443.html)

但是，我仍然遇到了 UTF-8 兼容性问题：

```
org.xml.sax.SAXParseException: Invalid byte 1 of 1-byte UTF-8 sequence 
```

在读取[XML - 从 servlet 返回 XML 为 UTF-8](http://www.velocityreviews.com/forums/t166758-returning-xml-as-utf8-from-a-servlet.html)之后，我只是尝试了如果我像这样设置 Contenttype 会发生什么：

```
response.setContentType("text/xml;charset=utf-8"); 
```

它奏效了....

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-01T08:46:10.813

[可扩展标记语言 (XML) 1.0](http://www.w3.org/TR/REC-xml/#syntax)说：

> & 符号 (&) 和左尖括号 (<) 不得以其文字形式出现，除非用作标记分隔符，或者在注释、处理指令或 CDATA 部分中。如果在其他地方需要它们，则必须分别使用数字字符引用或字符串“&”和“<”对它们进行转义。右尖括号 (>) 可以使用字符串“>”表示，并且为了兼容性，当它出现在内容中的字符串“]]>”中时，必须使用“>”或字符引用进行转义，当字符串未标记 CDATA 部分的结尾。

如果使用 CDATA，则可以跳过编码：

```
<column num="1"><![CDATA[10069]]></column>
<column num="2"><![CDATA[sd&]]></column> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-01T09:13:43.633

您正在运行哪个版本的 JRE？[萨克斯项目](http://www.saxproject.org/faq.html)说：

> J2SE 1.4 捆绑了旧版本的 SAX2。如何使 SAX2 r2 或更高版本可用？

# oop - 在面向对象的世界中处理“全局”数据结构

> ID：156701
> 
> 赞同：15
> 
> 时间：2008-10-01T08:29:08.420
> 
> 标签：oop

这是一个有很多答案的问题——我很想知道其他人认为什么是“最佳实践”。

考虑以下情况：您有一个面向对象的程序，其中包含许多不同类所需的一个或多个数据结构。您如何使这些数据结构可访问？

1.  例如，您可以在构造函数中显式传递引用。这是“正确”的解决方案，但这意味着在整个程序中复制参数和实例变量。这使得对全局数据的更改或添加变得困难。

2.  您可以将所有数据结构放在单个对象中，并传递对该对象的引用。这可以是为此目的而创建的对象，也可以是程序的“主要”对象。这简化了 (1) 的问题，但是数据结构之间可能有也可能没有任何关系，并且将它们集中在一个对象中是相当随意的。

3.  您可以使数据结构“静态”。这使您可以直接从其他类引用它们，而无需传递引用。这完全避免了（1）的缺点，但显然不是OO。这也意味着程序只能有一个实例。

当有很多数据结构，很多类都需要时，我倾向于使用（2）。这是 OO 纯度和实用性之间的折衷。其他人做什么？（不管怎样，我主要来自 Java 世界，但这个讨论适用于任何 OO 语言。）

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-01T11:01:27.400

全球数据并不像许多 OO 纯粹主义者所说的那么糟糕！

毕竟，在实现 OO 类时，您通常使用操作系统的 API。如果不是大量的全球数据和服务，这到底是什么东西！

如果你在你的程序中使用一些全局的东西，你只是在扩展这个巨大的环境，你的类实现已经可以看到操作系统，其中包含一些特定于你的应用程序的域数据。

在 OO 课程和书籍中经常教授到处传递指针/引用，在学术上听起来不错。从务实的角度来看，这通常是应该做的事情，但盲目而绝对地遵循这条规则是被误导的。对于一个体面的程序，您最终可能会在整个地方传递一堆参考，这可能会导致完全不必要的苦差事。

全球可访问的服务/数据提供者（显然是在一个漂亮的界面后面抽象出来的）在一个体面的应用程序中几乎是必须的。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-01T09:57:53.433

我真的真的不鼓励您使用选项 3 - 使数据静态。我参与过几个项目，早期的开发人员将一些核心数据设为静态，后来才意识到他们确实需要运行该程序的两个副本——并且花费了大量的工作使数据成为非静态数据并小心地放入引用进入一切。

所以根据我的经验，如果你做 3)，你最终会以两倍的成本做 1)。

选择 1，并细化您从每个对象引用的数据结构。不要使用“上下文对象”，只需准确传递所需的数据。`FwurzleDigestionListener`是的，它使代码更复杂，但从好的方面来说，它使它更清晰——a持有对 a`Fwurzle`和 a的引用的事实`DigestionTract`立即让读者了解它的目的。

根据定义，如果数据格式发生变化，对其进行操作的类也会发生变化，因此无论如何您都必须更改它们。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-01T10:11:37.550

您可能想考虑改变许多对象需要了解相同数据结构的要求。共享数据似乎没有一种干净的 OO 方式的一个原因是共享数据不是非常面向对象的。

您需要查看应用程序的细节，但总体思路是让一个对象负责共享数据，该对象根据封装在其中的数据为其他对象提供服务。然而，这些服务不应该*涉及*向其他对象提供数据结构 - 只是向其他对象提供满足*其*职责所需的信息片段并在内部对数据结构执行突变。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-01T08:50:06.670

我倾向于使用 3) 并且非常小心跨线程的同步和锁定。我同意它不那么 OO，但是你承认拥有全局数据，这首先是非常非 OO 的。

不要太拘泥于您是纯粹坚持一种编程方法还是另一种，找到适合您问题的解决方案。我认为单身人士有完全有效的上下文（例如记录）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-01T09:29:25.450

我使用了拥有一个全局对象和通过构造函数传入接口的组合。

从一个主要的全局对象（通常以您的程序被调用或执行的内容命名），您可以启动其他全局对象（可能有自己的线程）。这使您可以控制主对象构造函数中程序对象的设置，并在应用程序在此主对象析构函数中停止时以正确的顺序再次拆除它们。直接使用静态类使得初始化/取消初始化这些类以受控方式使用的任何资源变得很棘手。这个主要的全局对象还具有获取应用程序不同子系统的接口的属性，各种对象可能希望获得这些接口来完成它们的工作。

我还将对相关数据结构的引用传递到一些对象的构造函数中，我认为当这些对象只需要关注其中的一小部分时，将这些对象与程序中的其他部分隔离开来是很有用的。

一个对象是抓取全局对象并导航其属性以获得它想要的接口还是通过其构造函数传递它使用的接口是一个品味和直觉的问题。您认为可能在其他项目中重用的任何您正在实现的对象肯定应该通过它的构造函数传递它应该使用的数据结构。获取全局对象的对象应该更多地与应用程序的基础设施有关。

通过构造函数接收它们使用的接口的对象可能更容易进行单元测试，因为您可以为它们提供模拟接口，并检查它们的方法以确保它们返回正确的参数或与模拟接口正确交互。要测试访问主全局对象的对象，您必须模拟主全局对象，以便当它们从它请求接口（我经常称这些服务）时，它们会获得适当的模拟对象并可以针对它们进行测试。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-02T18:21:05.570

对于这些情况，我更喜欢使用 GoF 书中描述的单例模式。单例与问题中描述的三个选项中的任何一个都不相同。构造函数是私有的（或受保护的），因此它不能在任何地方使用。您使用 get() 函数（或您喜欢的任何名称）来获取实例。但是，单例类的体系结构保证每次调用 get() 返回相同的实例。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-18T14:59:49.693

我们应该注意不要混淆面向对象的***设计***和面向对象的***实现***。OO 设计这个术语经常被用来判断一个实现，就像，恕我直言，它就在这里。

## 设计

如果在您的设计中您看到很多对象都引用了完全相同的对象，这意味着很多箭头。设计师应该在这里感到痒。他应该验证这个对象是否只是常用的，或者它是否真的是一个实用程序（例如，COM 工厂、某种注册表……）。

从项目的需求中，他可以看到它是否真的需要是单例的（例如“互联网”），或者是否因为太通用或太昂贵或其他原因而共享对象。

## 执行

当你被要求用一种 OO 语言实现一个 OO 设计时，你会面临很多决定，比如你提到的那个：我应该如何实现设计中常用对象的*所有箭头？*

这就是解决“静态成员”、“全局变量”、“上帝类”和“大量函数参数”的问题的地方。

设计阶段应该已经澄清了对象是否需要是单例的。实施阶段将决定如何在程序中表示这种单一性。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-01T13:17:58.787

选项 3）虽然不是纯粹的 OO，但往往是最合理的解决方案。但我不会让你的班级成为单身人士；并使用其他一些对象作为静态“字典”来管理这些共享资源。

* * *

## 回答 #9

> 赞同：-2
> 
> 时间：2008-10-01T08:34:29.373

我不喜欢您提出的任何解决方案：

1.  您正在传递一堆“上下文”对象 - 使用它们的东西没有指定他们真正感兴趣的字段或数据片段
2.  [有关上帝对象](http://en.wikipedia.org/wiki/God_object)模式的描述，请参见此处。这是世界上最糟糕的
3.  永远不要将 Singleton 对象用于任何事情。您自己似乎已经发现了一些潜在的问题

# eclipse - 在 Eclipse 中，如何用新行替换字符？

> ID：156707
> 
> 赞同：87
> 
> 时间：2008-10-01T08:32:21.407
> 
> 标签：eclipse, editor, text-editor, eclipse-3.4

在 Eclipse 3.3.2 中，我想用文件中的新行替换一个字符（比如'，'）。为了这样做，我应该在“替换为”框中写什么？

编辑：许多答案似乎适用于 Eclipse 3.4。Eclipse 3.3.X 有解决方案吗？

* * *

## 回答 #1

> 赞同：146
> 
> 时间：2008-10-01T08:35:18.280

选中“正则表达式”复选框并在“替换为”框中使用“\R”

这是 Eclipse 3.4 中引入的一项新功能，请参阅 3.4 中的新增[功能](http://download.eclipse.org/eclipse/downloads/drops/R-3.4-200806172000/whatsnew3.4/eclipse-news-part1.html)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-01T08:41:35.503

选中“正则表达式”复选框并在“替换为”框中使用“\n”

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2017-06-01T12:25:28.437

就像其他人说的那样，只需使用正则表达式，但不要只使用 \r，而是放 \r\n

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-01T08:40:25.523

我刚刚找到[一篇关于这个问题的文章](http://www.andyjarrett.co.uk/2006/11/02/eclipse-regex-and-newline-bug/)。这似乎是一个错误。

有一种解决方法是在剪贴板中复制一个新行，然后将其粘贴到“替换”框中。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-04-12T18:50:06.623

我正在使用 Helios，它可以工作，但是我在替换时遇到了一些问题......我想在这些括号 "><" 之间放置一个换行符（以使每个新的 XML 标记转到一个新行）.. . 首先，我必须在两个括号之间放置一个字符，例如 /r，然后我检查了“正则表达式”框并将 /r 替换为 \R，这导致了正确的换行符。否则，替换似乎是灰色的。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2018-05-15T21:35:58.533

如果在选中正则表达式复选框的情况下执行文件搜索，则全部替换/选择替换也将允许正则表达式并将 \n 转换为文件中的换行符

# php - 会话的默认生命周期是多少？

> ID：156712
> 
> 赞同：68
> 
> 时间：2008-10-01T08:34:13.057
> 
> 标签：php, session

如果我点击了一个调用 的页面，`session_start()`当我刷新页面时，我需要等待多长时间才能获得新的会话 ID？

* * *

## 回答 #1

> 赞同：61
> 
> 时间：2008-10-01T08:39:06.930

查看 php.ini 为 session.gc_maxlifetime 设置的值是以秒为单位的 ID 生命周期。

我相信默认是 1440 秒（24 分钟）

[http://www.php.net/manual/en/session.configuration.php](http://www.php.net/manual/en/session.configuration.php)

**编辑：**正如一些评论指出的那样，上述内容并不完全准确。此处提供了有关为什么以及如何实现会话生命周期的精彩解释：

[如何在 30 分钟后使 PHP 会话过期？](https://stackoverflow.com/questions/520237/how-do-i-expire-a-php-session-after-30-minutes)

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2008-10-01T09:11:56.617

该`session.gc_maxlifetime`指令在 php.ini 中的默认值（“gc”用于垃圾收集）是 1440 秒或 24 分钟。请参阅手册中的会话运行时配置页面：

[http://www.php.net/manual/en/session.configuration.php](http://www.php.net/manual/en/session.configuration.php)

如果您有权访问它们，您可以在 php.ini 或 .httpd.conf 文件中更改此常量，或者在您网站上的本地 .htaccess 文件中更改此常量。要使用 .htaccess 方法将超时设置为一小时，请将此行添加到站点根目录中的 .htaccess 文件中：

```
php_value session.gc_maxlifetime "3600" 
```

如果您在共享主机上，或者您托管多个未更改默认设置的站点，请小心。默认会话位置是 /tmp 目录，垃圾收集例程将每 24 分钟为这些其他站点运行一次（并在此过程中清除您的会话，无论它们*应该*保留多长时间）。请参阅手册页或[本网站上的](https://web.archive.org/web/20130303043400/https://www.leftontheweb.com/message/php-session-expiry)[注释](http://www.php.net/manual/en/session.configuration.php#ini.session.gc-maxlifetime)以获得更好的解释。

答案是使用 session.save_path 将会话移动到另一个目录。这也有助于防止坏人从默认的 /tmp 目录劫持访问者的会话。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-01T08:42:05.020

这取决于您的 php 设置...
使用`phpinfo()`并查看会话章节。有一些值，比如`session.gc_maxlifetime`and `session.cache_expire`，`session.cookie_lifetime`它们会影响会话的生命周期

编辑：就像马丁之前写的

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2012-04-29T22:47:19.053

根据[PHP.net](http://php.net/manual/en/function.session-set-cookie-params.php)网站上的一位用户的说法，他保持会话活动的努力失败了，因此他不得不采取一种解决方法。

```
<?php

$Lifetime = 3600;
$separator = (strstr(strtoupper(substr(PHP_OS, 0, 3)), "WIN")) ? "\\" : "/";

$DirectoryPath = dirname(__FILE__) . "{$separator}SessionData";
//in Wamp for Windows the result for $DirectoryPath
//would be C:\wamp\www\your_site\SessionData

is_dir($DirectoryPath) or mkdir($DirectoryPath, 0777);

if (ini_get("session.use_trans_sid") == true) {
    ini_set("url_rewriter.tags", "");
    ini_set("session.use_trans_sid", false);

}

ini_set("session.gc_maxlifetime", $Lifetime);
ini_set("session.gc_divisor", "1");
ini_set("session.gc_probability", "1");
ini_set("session.cookie_lifetime", "0");
ini_set("session.save_path", $DirectoryPath);
session_start();

?> 
```

在 SessionData 文件夹中，它将存储用于保存会话信息的文本文件，每个文件的名称都类似于“sess_a_big_hash_here”。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2018-08-05T21:06:09.987

你也可以使用类似的东西`ini_set('session.gc_maxlifetime', 28800); // 8 * 60 * 60`。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-04-06T12:50:55.193

但请注意，在大多数 xampp/ampp/...-setups 和一些 linux 配置中，它是 0，这意味着文件永远不会被删除，直到您在脚本中执行它（或通过 shell 弄脏）

PHP.INI:

```
; Lifetime in seconds of cookie or, if 0, until browser is restarted.
; http://php.net/session.cookie-lifetime
session.cookie_lifetime = 0 
```

# php - 从灾难中拯救 Web 开发项目

> ID：156723
> 
> 赞同：0
> 
> 时间：2008-10-01T08:38:05.263
> 
> 标签：php, project-management, project-planning, timeline

我在[HashRocket](http://hashrocket.com)看到了他们的救援任务的想法，该任务旨在介入并从失败的 Rails 开发项目中恢复（无论是时间表、预算还是其他什么都不会得到满足）。

我想知道其他人是否为 PHP 项目或一般的 Web 开发项目提供此服务。

理想情况下，他们将参与规范规范、将项目推出的路线图，以及必要时的编码。

有人知道这样的地方吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-01T08:52:54.277

几乎所有优秀的软件咨询公司都可以做到这一点。但是，我会建议您，这将是价值低或昂贵或两者兼而有之的东西。

您可能收到的大多数建议都已在书籍或互联网上提供。诚然，您不仅可以（还）在线审查您的代码，但除非您有一个能够理解它的团队，否则代码审查的价值非常有限。

正式的规范很棒——但除非客户准备好，否则这是不可能的——一个好的外部团队会花费大量时间来教育人们他们想要什么以及如何表达它，而一个糟糕的团队只会失败。

如果您让创建路线图的人与您一起工作直到项目结束，路线图是很棒的，并且不断地重复和更新它。如果他们不这样做，路线图就是一张纸，您可以在完成后立即丢弃。

在我看来，一个进展顺利且状况不佳的项目很难（或不可能）保存。一群外人更难做到这一点。这群局外人几乎不可能在短时间内加入进来，把事情做好然后消失。

根据我的经验，如果一个项目失败了，你需要在团队中找到内部资源和力量来恢复它，或者找到另一个团队来做这件事。

# java - 接缝问题：无法通过反射设置字段值

> ID：156724
> 
> 赞同：6
> 
> 时间：2008-10-01T08:38:28.630
> 
> 标签：java, seam

我的 Seam 代码有问题，我似乎无法弄清楚我做错了什么。它让我很头疼:) 这是堆栈跟踪的摘录：

```
Caused by: java.lang.IllegalArgumentException: Can not set java.lang.Long field com.oobjects.sso.manager.home.PresenceHome.customerId to java.lang.String 
```

我正在尝试将我的 URL 上的参数集传递给我的一个 bean。为此，我在 pages.xml 中进行了以下设置：

```
<page view-id="/customer/presences.xhtml">
  <begin-conversation flush-mode="MANUAL" join="true" />
  <param name="customerId" value="#{presenceHome.customerId}" />
  <raise-event type="PresenceHome.init" />
  <navigation>
    <rule if-outcome="persisted">
      <end-conversation />
      <redirect view-id="/customer/presences.xhtml" />
    </rule>
  </navigation>
</page> 
```

我的 bean 是这样开始的：

```
@Name("presenceHome")
@Scope(ScopeType.CONVERSATION)
public class PresenceHome extends EntityHome<Presence> implements Serializable {
  @In
  private CustomerDao customerDao;

  @In(required = false)
  private Long presenceId;

  @In(required = false)
  private Long customerId;

  private Customer customer;

  // Getters, setters and other methods follow. They return the correct types defined above
} 
```

最后，我用来将一个页面链接到下一个页面的链接如下所示：

```
<s:link styleClass="#{selected == 'presences' ? 'selected' : ''}"
    view="/customer/presences.xhtml" title="Presences" propagation="none">
    <f:param name="customerId" value="#{customerId}" />
    Presences
</s:link> 
```

这一切似乎工作正常。当我将鼠标悬停在页面中的上述链接上时，我得到一个以“?customerId=123”结尾的 URL。所以参数被传递了，它可以很容易地转换为 Long 类型。但由于某种原因，它不是。我之前在其他项目中做过类似的事情，然后它就起作用了。我只是看不出它现在不起作用。

如果我从我的页面声明中删除该元素，我可以正常进入页面。

那么，有人有什么想法吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-01T16:51:50.100

您想将转换器添加到 pages.xml 文件。像这样：

```
<param name="customerId" 
      value="#{presenceHome.customerId}" 
converterId="javax.faces.Long" /> 
```

有关更多详细信息，请参阅 seam 提供的 seampay 示例。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-01T10:53:21.583

试试： `<f:param name="customerId" value="#{customerId.toString()}" />` ……

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-01T12:19:51.687

我们的代码执行了类似的操作，但Java 类中的*customerId属性为**String*：

```
private String customerId;

public String getCustomerId() {
    return customerId;
}

public void setCustomerId(final String customerId) {
    this.customerId = customerId;
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-01T12:41:00.997

您可以尝试使用属性编辑器。

将其放入与 bean 相同的包中：

```
import java.beans.PropertyEditorSupport;

public class PresenceHomeEditor extends PropertyEditorSupport {
    public void setAsText(final String text) throws IllegalArgumentException {
        try {
            final Long value = Long.decode(text);
            setValue(value);
        } catch (final NumberFormatException e) {
            super.setAsText(text);
        }
    }
} 
```

# sql-server - 将 Reporting Services 2005SP2 连接到 SQL Server 2008

> ID：156740
> 
> 赞同：1
> 
> 时间：2008-10-01T08:45:55.930
> 
> 标签：sql-server, sql-server-2005, sql-server-2008, system-administration

我正在尝试在另一台托管 ReportServer DB 的机器上使用 SQL 2008 配置 Reporting Services 2005SP2。

当我创建 ReportServerDB 时，数据库被创建为版本 C.0.9.45：

之后，当我尝试初始化 Reporting Services 时，我收到有关版本号不正确的错误消息。Reporting Services 创建了 ReportServer DB 版本 C.0.9.45，但现在需要版本 C.0.8.54。

更改数据库的兼容性设置没有效果。并且更改数据库中的版本号 sproc 以返回 Reporting Services 想要听到的内容，只会延迟崩溃，直到初始化开始。

有任何想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-30T20:18:56.333

我收到了微软支持的回复，说在同一个盒子上是不可能的。

[http://forums.microsoft.com/MSDN/ShowPost.aspx?PostID=4153333&SiteID=1](http://forums.microsoft.com/MSDN/ShowPost.aspx?PostID=4153333&SiteID=1)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-27T05:32:24.740

您必须已使用 SQL 2008 配置工具创建了 reportServerDB。如果要使用 2005 版本的服务器，则需要使用 SQL 2005 附带的配置工具创建配置数据库。2005 SP2 工具将创建版本为 C.0.8.54 的数据库

# eclipse - Eclipse 问题视图的最佳实践

> ID：156745
> 
> 赞同：64
> 
> 时间：2008-10-01T08:46:39.003
> 
> 标签：eclipse

我使用 Eclipse 已经有一段时间了，但我仍然没有找到如何配置问题视图以仅显示感兴趣的错误和警告。有没有一种简单的方法来过滤来自特定资源或特定路径的警告？例如，当我生成 javadoc 时，我会收到大量不相关的 html 警告。另外，有没有办法改变出现警告/错误的最大数量？

我知道过滤器的概念，但我正在寻找一些现实生活中的例子。其他人使用什么样的过滤器或做法？

**编辑：**我发现过滤“在选定元素及其子元素上”的建议是最好的。但是，我还有另一个问题。如果我有“很多”警告或错误，则只会出现前 100 个。在极少数情况下，我想看到所有这些，我该怎么做？

* * *

## 回答 #1

> 赞同：65
> 
> 时间：2008-10-02T09:25:14.890

我觉得过滤“在选定元素及其子元素上”是问题视图过滤器的最佳模式，因为它可以让您非常快速地缩小报告问题的范围：单击工作集（在包资源管理器中），它会显示所有集合中所有项目的问题；单击一个项目 - 只会出现所选项目中的问题。单击单个类（或包） - 仅显示所选类（或包）中的问题。因此，您不会因与手头任务无关的问题而分心。

* * *

## 回答 #2

> 赞同：32
> 
> 时间：2008-10-01T08:52:57.893

问题窗格的右上角是一个过滤器按钮（看起来像三个指向右侧的箭头），单击该按钮可以配置视图。您可以按元素过滤，例如您正在编辑的类或工作集、问题的类型（例如 java 问题、构建文件问题等）和严重性。它实际上是非常可配置的。

有关详细信息和屏幕截图，请参阅[http://help.eclipse.org/help32/index.jsp?topic=/org.eclipse.platform.doc.user/concepts/cprbview.htm](http://help.eclipse.org/help32/index.jsp?topic=/org.eclipse.platform.doc.user/concepts/cprbview.htm)。

* * *

## 回答 #3

> 赞同：21
> 
> 时间：2009-03-24T14:57:38.210

要查看超过 100 条警告，请转到问题视图的下拉菜单（使用视图上最小化按钮旁边的小箭头），选择首选项，您可以选择将此限制从 100 更改为另一个数字。

此信息适用于 Ganymede；自欧罗巴以来，情况发生了变化，我不确定所有的差异。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-11-17T15:51:07.110

Ganymede (Eclipse 3.4) 的更新链接：

[http://help.eclipse.org/ganymede/topic/org.eclipse.platform.doc.user/concepts/cprbview.htm](http://help.eclipse.org/ganymede/topic/org.eclipse.platform.doc.user/concepts/cprbview.htm)

但我同意基本问题：问题视图需要按资源过滤，而不仅仅是描述。

就我而言，我在源路径中包含生成的 jsp 代码，并且 *_jsp.java 文件中会出现各种警告（如未使用的应用程序、页面、输出、配置、页面上下文变量）。所以最好通过资源模式排除它们。（或者让 jspc 不编写未使用的代码……但这完全是一个不同的问题）。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-02-09T14:38:10.010

回复：您的编辑

在过滤器按钮旁边的下拉按钮中，有一个首选项选项。取消选中“使用标记限制”，您将看到所有错误+警告。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2012-02-14T19:30:45.967

要查看 100 多个警告，请转到问题视图的下拉菜单（使用视图上最小化按钮旁边的小箭头），选择`Configure Contents`。取消选中 窗口`Use item limits`左下角的或在 中设置限制。`Configure Contents``Number of items visible per group:`

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-09-21T14:07:26.953

打开问题视图。单击角三角形。选择偏好

Uncross: [ ] 使用标记限制

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2019-12-11T16:36:47.207

确保不要忘记取消选中过滤器窗口左上角的“显示所有项目”。我正在应用所有这些过滤器，例如“在选定元素及其子元素上”，但它似乎没有奏效。最后我取消了前面提到的复选框，选择了所需的“配置”，然后它开始工作了。

# asp.net - ASP.NET MVC 下的 SSL 页面

> ID：156748
> 
> 赞同：81
> 
> 时间：2008-10-01T08:47:53.057
> 
> 标签：asp.net, asp.net-mvc, ssl, https

如何对基于 ASP.NET MVC 的站点中的某些页面使用 HTTPS？

史蒂夫·桑德森（Steve Sanderson）有一个很好的教程，关于如何在 Preview 4 上以 DRY 的方式做到这一点：

[http://blog.codeville.net/2008/08/05/adding-httpsssl-support-to-aspnet-mvc-routing/](http://blog.codeville.net/2008/08/05/adding-httpsssl-support-to-aspnet-mvc-routing/)

Preview 5 有没有更好/更新的方法？

* * *

## 回答 #1

> 赞同：92
> 
> 时间：2010-03-01T21:03:31.480

如果您使用的是[ASP.NET MVC 2 Preview 2 或更高版本](http://blogs.teamb.com/craigstuntz/2009/10/05/38476/)，您现在可以简单地使用：

```
[RequireHttps]
public ActionResult Login()
{
   return View();
} 
```

不过， order 参数值得注意，如此[处所述](http://bartwullems.blogspot.com/2010/01/using-ssl-with-aspnet-mvc-2.html)。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-07-12T20:01:03.657

[MVCFutures](http://aspnet.codeplex.com/Release/ProjectReleases.aspx?ReleaseId=24471)有一个“RequireSSL”属性。

（感谢亚当在您更新的博文中[指出这一点）](http://blog.salvoz.com/2009/04/25/PartialSSLAndAuthorizationWithAspNetMVCRevisited.aspx)

只需将其应用于您的操作方法，如果您希望 http:// 请求自动变为 https:// ，请使用“Redirect=true”：

```
 [RequireSsl(Redirect = true)] 
```

另请参阅：[ASP.NET MVC RequireHttps 仅用于生产](https://stackoverflow.com/questions/1639707/asp-net-mvc-requirehttps-in-production-only/1639831#1639831)

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2010-03-25T05:38:38.923

正如[Amadiere 所写](https://stackoverflow.com/questions/156748/ssl-pages-under-asp-net-mvc/2359061#2359061)，[RequireHttps] 在 MVC 2 中非常适合用于*输入*HTTPS。但是，如果您只想对*某些*页面使用 HTTPS，如您所说，MVC 2 不会给您任何帮助 - 一旦将用户切换到 HTTPS，他们就会卡在那里，直到您手动重定向它们。

我使用的方法是使用另一个自定义属性 [ExitHttpsIfNotRequired]。当附加到控制器或操作时，如果出现以下情况，它将重定向到 HTTP：

1.  请求是 HTTPS
2.  [RequireHttps] 属性未应用于操作（或控制器）
3.  请求是 GET（重定向 POST 会导致各种麻烦）。

在这里发布有点太大了，但是您可以[在此处查看代码](http://lukesampson.com/post/471548689/entering-and-exiting-https-with-asp-net-mvc)以及一些其他详细信息。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-08-25T20:20:32.993

这是 Dan Wahlin 最近发表的一篇文章：

[http://weblogs.asp.net/dwahlin/archive/2009/08/25/requiring-ssl-for-asp-net-mvc-controllers.aspx](http://weblogs.asp.net/dwahlin/archive/2009/08/25/requiring-ssl-for-asp-net-mvc-controllers.aspx)

他使用 ActionFilter 属性。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-01T10:10:14.510

一些 ActionLink 扩展：[http ://www.squaredroot.com/post/2008/06/11/MVC-and-SSL.aspx 或重定向到 https://](http://www.squaredroot.com/post/2008/06/11/MVC-and-SSL.aspx) [http](http://forums.asp.net/p/1260198/2358380.aspx#2358380) ://forums.asp.net 的控制器操作属性[/p/1260198/2358380.aspx#2358380](http://forums.asp.net/p/1260198/2358380.aspx#2358380)

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2012-07-19T23:24:30.893

对于那些不喜欢面向属性的开发方法的人，这里有一段代码可能会有所帮助：

```
public static readonly string[] SecurePages = new[] { "login", "join" };
protected void Application_AuthorizeRequest(object sender, EventArgs e)
{
    var pageName = RequestHelper.GetPageNameOrDefault();
    if (!HttpContext.Current.Request.IsSecureConnection
        && (HttpContext.Current.Request.IsAuthenticated || SecurePages.Contains(pageName)))
    {
        Response.Redirect("https://" + Request.ServerVariables["HTTP_HOST"] + HttpContext.Current.Request.RawUrl);
    }
    if (HttpContext.Current.Request.IsSecureConnection
        && !HttpContext.Current.Request.IsAuthenticated
        && !SecurePages.Contains(pageName))
    {
        Response.Redirect("http://" + Request.ServerVariables["HTTP_HOST"] + HttpContext.Current.Request.RawUrl);
    }
} 
```

避免属性有几个原因，其中之一是如果您想查看所有安全页面的列表，您将不得不跳过解决方案中的所有控制器。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2013-04-25T22:10:00.797

我遇到了这个问题，希望我的解决方案可以帮助某人。

我们遇到了一些问题： - 我们需要保护特定操作，例如“帐户”中的“登录”。我们可以使用 RequireHttps 属性中的构建，这很棒 - 但它会使用 https:// 将我们重定向回来。- 我们应该让我们的链接、表格和此类“SSL 感知”。

通常，我的解决方案除了能够指定协议外，还允许指定将使用绝对 url 的路由。您可以使用此方法来指定“https”协议。

所以，首先我创建了一个 ConnectionProtocol 枚举：

```
/// <summary>
/// Enum representing the available secure connection requirements
/// </summary>
public enum ConnectionProtocol
{
    /// <summary>
    /// No secure connection requirement
    /// </summary>
    Ignore,

    /// <summary>
    /// No secure connection should be used, use standard http request.
    /// </summary>
    Http,

    /// <summary>
    /// The connection should be secured using SSL (https protocol).
    /// </summary>
    Https
} 
```

现在，我创建了 RequireSsl 的手卷版本。我修改了原始的 RequireSsl 源代码以允许重定向回 http:// url。此外，我还放置了一个字段，允许我们确定是否需要 SSL（我将它与 DEBUG 预处理器一起使用）。

```
/* Note:
 * This is hand-rolled version of the original System.Web.Mvc.RequireHttpsAttribute.
 * This version contains three improvements:
 * - Allows to redirect back into http:// addresses, based on the <see cref="SecureConnectionRequirement" /> Requirement property.
 * - Allows to turn the protocol scheme redirection off based on given condition.
 * - Using Request.IsCurrentConnectionSecured() extension method, which contains fix for load-balanced servers.
 */
[AttributeUsage(AttributeTargets.Class | AttributeTargets.Method, Inherited = true, AllowMultiple = false)]
public sealed class RequireHttpsAttribute : FilterAttribute, IAuthorizationFilter
{
    public RequireHttpsAttribute()
    {
        Protocol = ConnectionProtocol.Ignore;
    }

    /// <summary>
    /// Gets or sets the secure connection required protocol scheme level
    /// </summary>
    public ConnectionProtocol Protocol { get; set; }

    /// <summary>
    /// Gets the value that indicates if secure connections are been allowed
    /// </summary>
    public bool SecureConnectionsAllowed
    {
        get
        {
#if DEBUG
            return false;
#else
            return true;
#endif
        }
    }

    public void OnAuthorization(System.Web.Mvc.AuthorizationContext filterContext)
    {
        if (filterContext == null)
        {
            throw new ArgumentNullException("filterContext");
        }

        /* Are we allowed to use secure connections? */
        if (!SecureConnectionsAllowed)
            return;

        switch (Protocol)
        {
            case ConnectionProtocol.Https:
                if (!filterContext.HttpContext.Request.IsCurrentConnectionSecured())
                {
                    HandleNonHttpsRequest(filterContext);
                }
                break;
            case ConnectionProtocol.Http:
                if (filterContext.HttpContext.Request.IsCurrentConnectionSecured())
                {
                    HandleNonHttpRequest(filterContext);
                }
                break;
        }
    }

    private void HandleNonHttpsRequest(AuthorizationContext filterContext)
    {
        // only redirect for GET requests, otherwise the browser might not propagate the verb and request
        // body correctly.

        if (!String.Equals(filterContext.HttpContext.Request.HttpMethod, "GET", StringComparison.OrdinalIgnoreCase))
        {
            throw new InvalidOperationException("The requested resource can only be accessed via SSL.");
        }

        // redirect to HTTPS version of page
        string url = "https://" + filterContext.HttpContext.Request.Url.Host + filterContext.HttpContext.Request.RawUrl;
        filterContext.Result = new RedirectResult(url);
    }

    private void HandleNonHttpRequest(AuthorizationContext filterContext)
    {
        if (!String.Equals(filterContext.HttpContext.Request.HttpMethod, "GET", StringComparison.OrdinalIgnoreCase))
        {
            throw new InvalidOperationException("The requested resource can only be accessed without SSL.");
        }

        // redirect to HTTP version of page
        string url = "http://" + filterContext.HttpContext.Request.Url.Host + filterContext.HttpContext.Request.RawUrl;
        filterContext.Result = new RedirectResult(url);
    }
} 
```

现在，这个 RequireSsl 将根据您的需求属性值执行以下操作： - 忽略：什么都不做。- Http：将强制重定向到 http 协议。- Https：将强制重定向到 https 协议。

您应该创建自己的基本控制器并将此属性设置为 Http。

```
[RequireSsl(Requirement = ConnectionProtocol.Http)]
public class MyController : Controller
{
    public MyController() { }
} 
```

现在，在每个需要 SSL 的 cpntroller/action 中 - 只需使用 ConnectionProtocol.Https 设置此属性。

现在让我们转到 URL：我们在使用 url 路由引擎时遇到了一些问题。[您可以在http://blog.stevensanderson.com/2008/08/05/adding-httpsssl-support-to-aspnet-mvc-routing/](http://blog.stevensanderson.com/2008/08/05/adding-httpsssl-support-to-aspnet-mvc-routing/)阅读有关它们的更多信息。这篇文章中建议的解决方案在理论上很好，但是很旧，我不喜欢这种方法。

我的解决方案如下：创建基本“Route”类的子类：

公共类AbsoluteUrlRoute：路线{#region ctor

```
 /// <summary>
    /// Initializes a new instance of the System.Web.Routing.Route class, by using
    ///     the specified URL pattern and handler class.
    /// </summary>
    /// <param name="url">The URL pattern for the route.</param>
    /// <param name="routeHandler">The object that processes requests for the route.</param>
    public AbsoluteUrlRoute(string url, IRouteHandler routeHandler)
        : base(url, routeHandler)
    {

    }

    /// <summary>
    /// Initializes a new instance of the System.Web.Routing.Route class, by using
    ///     the specified URL pattern and handler class.
    /// </summary>
    /// <param name="url">The URL pattern for the route.</param>
    /// <param name="defaults">The values to use for any parameters that are missing in the URL.</param>
    /// <param name="routeHandler">The object that processes requests for the route.</param>
    public AbsoluteUrlRoute(string url, RouteValueDictionary defaults, IRouteHandler routeHandler)
        : base(url, defaults, routeHandler)
    {

    }

    /// <summary>
    /// Initializes a new instance of the System.Web.Routing.Route class, by using
    ///     the specified URL pattern and handler class.
    /// </summary>
    /// <param name="url">The URL pattern for the route.</param>
    /// <param name="defaults">The values to use for any parameters that are missing in the URL.</param>
    /// <param name="constraints">A regular expression that specifies valid values for a URL parameter.</param>
    /// <param name="routeHandler">The object that processes requests for the route.</param>
    public AbsoluteUrlRoute(string url, RouteValueDictionary defaults, RouteValueDictionary constraints,
                            IRouteHandler routeHandler)
        : base(url, defaults, constraints, routeHandler)
    {

    }

    /// <summary>
    /// Initializes a new instance of the System.Web.Routing.Route class, by using
    ///     the specified URL pattern and handler class.
    /// </summary>
    /// <param name="url">The URL pattern for the route.</param>
    /// <param name="defaults">The values to use for any parameters that are missing in the URL.</param>
    /// <param name="constraints">A regular expression that specifies valid values for a URL parameter.</param>
    /// <param name="dataTokens">Custom values that are passed to the route handler, but which are not used
    ///     to determine whether the route matches a specific URL pattern. These values
    ///     are passed to the route handler, where they can be used for processing the
    ///     request.</param>
    /// <param name="routeHandler">The object that processes requests for the route.</param>
    public AbsoluteUrlRoute(string url, RouteValueDictionary defaults, RouteValueDictionary constraints,
                            RouteValueDictionary dataTokens, IRouteHandler routeHandler)
        : base(url, defaults, constraints, dataTokens, routeHandler)
    {

    }

    #endregion

    public override VirtualPathData GetVirtualPath(RequestContext requestContext, RouteValueDictionary values)
    {
        var virtualPath = base.GetVirtualPath(requestContext, values);
        if (virtualPath != null)
        {
            var scheme = "http";
            if (this.DataTokens != null && (string)this.DataTokens["scheme"] != string.Empty)
            {
                scheme = (string) this.DataTokens["scheme"];
            }

            virtualPath.VirtualPath = MakeAbsoluteUrl(requestContext, virtualPath.VirtualPath, scheme);
            return virtualPath;
        }

        return null;
    }

    #region Helpers

    /// <summary>
    /// Creates an absolute url
    /// </summary>
    /// <param name="requestContext">The request context</param>
    /// <param name="virtualPath">The initial virtual relative path</param>
    /// <param name="scheme">The protocol scheme</param>
    /// <returns>The absolute URL</returns>
    private string MakeAbsoluteUrl(RequestContext requestContext, string virtualPath, string scheme)
    {
        return string.Format("{0}://{1}{2}{3}{4}",
                             scheme,
                             requestContext.HttpContext.Request.Url.Host,
                             requestContext.HttpContext.Request.ApplicationPath,
                             requestContext.HttpContext.Request.ApplicationPath.EndsWith("/") ? "" : "/",
                             virtualPath);
    }

    #endregion
} 
```

此版本的“Route”类将创建绝对 url。这里的技巧，以及博客文章作者的建议，是使用 DataToken 来指定方案（最后的例子:)）。

现在，如果我们要生成一个 url，例如对于路由“Account/LogOn”，我们将得到“ [/http://example.com/Account/LogOn”——](http://example.com/Account/LogOn)这是因为 UrlRoutingModule 将所有 url 视为相对的。我们可以使用自定义 HttpModule 来解决这个问题：

```
public class AbsoluteUrlRoutingModule : UrlRoutingModule
{
    protected override void Init(System.Web.HttpApplication application)
    {
        application.PostMapRequestHandler += application_PostMapRequestHandler;
        base.Init(application);
    }

    protected void application_PostMapRequestHandler(object sender, EventArgs e)
    {
        var wrapper = new AbsoluteUrlAwareHttpContextWrapper(((HttpApplication)sender).Context);
    }

    public override void PostResolveRequestCache(HttpContextBase context)
    {
        base.PostResolveRequestCache(new AbsoluteUrlAwareHttpContextWrapper(HttpContext.Current));
    }

    private class AbsoluteUrlAwareHttpContextWrapper : HttpContextWrapper
    {
        private readonly HttpContext _context;
        private HttpResponseBase _response = null;

        public AbsoluteUrlAwareHttpContextWrapper(HttpContext context)
            : base(context)
        {
            this._context = context;
        }

        public override HttpResponseBase Response
        {
            get
            {
                return _response ??
                       (_response =
                        new AbsoluteUrlAwareHttpResponseWrapper(_context.Response));
            }
        }

        private class AbsoluteUrlAwareHttpResponseWrapper : HttpResponseWrapper
        {
            public AbsoluteUrlAwareHttpResponseWrapper(HttpResponse response)
                : base(response)
            {

            }

            public override string ApplyAppPathModifier(string virtualPath)
            {
                int length = virtualPath.Length;
                if (length > 7 && virtualPath.Substring(0, 7) == "/http:/")
                    return virtualPath.Substring(1);
                else if (length > 8 && virtualPath.Substring(0, 8) == "/https:/")
                    return virtualPath.Substring(1);

                return base.ApplyAppPathModifier(virtualPath);
            }
        }
    }
} 
```

由于这个模块覆盖了 UrlRoutingModule 的基本实现，我们应该删除基本的 httpModule 并在 web.config 中注册我们的。因此，在“system.web”设置下：

```
<httpModules>
  <!-- Removing the default UrlRoutingModule and inserting our own absolute url routing module -->
  <remove name="UrlRoutingModule-4.0" />
  <add name="UrlRoutingModule-4.0" type="MyApp.Web.Mvc.Routing.AbsoluteUrlRoutingModule" />
</httpModules> 
```

就是这样 ：）。

为了注册一个绝对/协议遵循的路线，你应该这样做：

```
 routes.Add(new AbsoluteUrlRoute("Account/LogOn", new MvcRouteHandler())
            {
                Defaults = new RouteValueDictionary(new {controller = "Account", action = "LogOn", area = ""}),
                DataTokens = new RouteValueDictionary(new {scheme = "https"})
            }); 
```

很想听听您的反馈+改进。希望它可以帮助！:)

编辑：我忘记包含 IsCurrentConnectionSecured() 扩展方法（片段太多：P）。这是一种扩展方法，一般使用 Request.IsSecuredConnection。但是，在使用负载平衡时，此方法将不起作用-因此此方法可以绕过此方法（取自 nopCommerce）。

```
 /// <summary>
    /// Gets a value indicating whether current connection is secured
    /// </summary>
    /// <param name="request">The base request context</param>
    /// <returns>true - secured, false - not secured</returns>
    /// <remarks><![CDATA[ This method checks whether or not the connection is secured.
    /// There's a standard Request.IsSecureConnection attribute, but it won't be loaded correctly in case of load-balancer.
    /// See: <a href="http://nopcommerce.codeplex.com/SourceControl/changeset/view/16de4a113aa9#src/Libraries/Nop.Core/WebHelper.cs">nopCommerce WebHelper IsCurrentConnectionSecured()</a>]]></remarks>
    public static bool IsCurrentConnectionSecured(this HttpRequestBase request)
    {
        return request != null && request.IsSecureConnection;

        //  when your hosting uses a load balancer on their server then the Request.IsSecureConnection is never got set to true, use the statement below
        //  just uncomment it
        //return request != null && request.ServerVariables["HTTP_CLUSTER_HTTPS"] == "on";
    } 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-04-21T07:52:36.687

这是[Pablo M. Cibrano](http://weblogs.asp.net/cibrax/archive/2009/01/19/running-a-partial-ssl-website-in-asp-net-mvc.aspx)于 2009 年 1 月发表的一篇博文，其中收集了一些技术，包括 HttpModule 和扩展方法。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-04-21T07:58:56.640

这是[Adam Salvo 的一篇博客文章，](http://blog.salvoz.com/2009/03/14/PartialSSLAndAuthorizationWithAspNetMVC.aspx)它使用了 ActionFilter。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2010-06-08T13:41:10.253

这不一定是 MVC 特定的，但此解决方案确实适用于 ASP.NET WebForms 和 MVC：

[http://www.codeproject.com/KB/web-security/WebPageSecurity_v2.aspx](http://www.codeproject.com/KB/web-security/WebPageSecurity_v2.aspx)

我已经使用了几年，并且喜欢通过 web.config 文件分离关注点和管理。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2016-07-07T12:44:18.840

**MVC 6** (ASP.NET Core 1.0) 与 Startup.cs 的工作方式略有不同。

要在所有页面上使用 RequireHttpsAttribute （如 Amadiere 的[回答](https://stackoverflow.com/a/2359061/1095493)中所述），您可以在 Startup.cs 中添加它，而不是在每个控制器上使用属性样式（或者而不是为所有控制器创建一个 BaseController 来继承）。

**Startup.cs** - 注册过滤器：

```
public void ConfigureServices(IServiceCollection services)
{
    // TODO: Register other services

    services.AddMvc(options =>
    {
        options.Filters.Add(typeof(RequireHttpsAttribute));
    });
} 
```

有关上述方法的设计决策的更多信息，请参阅我对有关[如何排除 localhost 请求不被 RequireHttpsAttribute 处理的](https://stackoverflow.com/a/38244992/1095493)类似问题的回答。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2020-03-02T18:26:55.097

或者将过滤器添加到**Global.asax.cs**

> GlobalFilters.Filters.Add(new RequireHttpsAttribute());

[RequireHttpsAttribute 类](https://docs.microsoft.com/en-us/dotnet/api/system.web.mvc.requirehttpsattribute?view=aspnet-mvc-5.2)

```
using System.Web.Mvc;
using System.Web.Optimization;
using System.Web.Routing;

namespace xxxxxxxx
{
    public class MvcApplication : System.Web.HttpApplication
    {
        protected void Application_Start()
        {
            AreaRegistration.RegisterAllAreas();
            FilterConfig.RegisterGlobalFilters(GlobalFilters.Filters);
            GlobalFilters.Filters.Add(new RequireHttpsAttribute());
            RouteConfig.RegisterRoutes(RouteTable.Routes);
            BundleConfig.RegisterBundles(BundleTable.Bundles);
        }
    }
} 
```

# parameters - 参数和参数有什么区别？

> ID：156767
> 
> 赞同：890
> 
> 时间：2008-10-01T08:57:20.130
> 
> 标签：parameters, language-agnostic, arguments, terminology

当口头谈论方法时，我永远不确定是否使用*参数*或*参数*或其他词。无论哪种方式，其他人都知道我的意思，但什么是正确的，这些术语的历史是什么？

我是一名 C# 程序员，但我也想知道人们是否在不同的语言中使用不同的术语。

作为记录，我是自学的，没有计算机科学背景。（请不要告诉我阅读[Code Complete](http://www.amazon.co.uk/Code-Complete-Practical-Handbook-Construction/dp/0735619670/)，因为我问这个是为了其他还没有史蒂夫·麦康奈尔（[Steve McConnell](http://www.stevemcconnell.com/)）精彩书籍的人的利益。）

### 概括

普遍的共识似乎是在团队环境中可以互换使用这些术语。除非您定义精确的术语；那么你也可以使用“*形式*参数/参数”和“*实际*参数/参数”来消除歧义。

* * *

## 回答 #1

> 赞同：1155
> 
> 时间：2008-10-01T09:03:34.763

参数是方法定义中的变量。调用方法时，参数是您传递给方法参数的数据。

```
public void MyMethod(string myParam) { }

...

string myArg1 = "this is my argument";
myClass.MyMethod(myArg1); 
```

* * *

## 回答 #2

> 赞同：402
> 
> 时间：2008-10-01T09:00:25.473

**参数**是函数声明中的变量。

**参数**是传递给函数的这个变量的实际值。

* * *

## 回答 #3

> 赞同：132
> 
> 时间：2017-04-25T05:38:37.013

简单的：

*   **PARAMETER → **P LACEHOLDER（****表示**占位符属于函数命名，在函数体中使用）**
***   **A** RGUMENT → **A** CTUAL VALUE（这意味着函数调用传递的实际值）**

 *** * *

## 回答 #4

> 赞同：81
> 
> 时间：2008-10-01T09:27:35.410

已经有一个关于该主题的 Wikipedia 条目（参见[Parameter](http://en.wikipedia.org/wiki/Parameter_(computer_science))）定义和区分术语*parameter*和*argument*。简而言之，参数是函数/过程/方法签名的一部分，参数是在运行时和/或参数调用站点提供的实际值。

Wikipedia 文章还指出，这两个术语经常作为同义词使用（尤其是在非正式地推理代码时）：

> 尽管参数通常也被称为参数，但参数更恰当地认为是在运行时调用子例程时分配给参数变量的实际值或引用。

给定以下 C 中的示例函数，该函数将两个整数相加，`x`并将`y`被称为其参数：

```
int add(int x, int y) {
    return x + y;
} 
```

在使用 的调用站点`add`，例如下面显示的示例，*123*和*456*将被称为调用的*参数*。

```
int result = add(123, 456); 
```

此外，一些语言规范（或正式文档）选择专门使用*参数*或*参数*，并使用*正式*和*实际*等形容词来消除两种情况之间的歧义。例如，C/C++ 文档通常将函数*参数*称为*形式参数*，将函数调用*参数*称为*实际参数*。有关示例，请参阅[Visual C++ 语言参考](http://msdn.microsoft.com/en-us/library/3bstk3k5.aspx)中的“<a href="http://msdn.microsoft.com/en-us/library/f81cdka5.aspx" rel="noreferrer">正式和实际参数” 。

* * *

## 回答 #5

> 赞同：80
> 
> 时间：2018-07-08T11:52:17.013

**参数**是函数声明中的变量。

**参数**是传递给函数的这个变量的实际值。 [![在此处输入图像描述](https://i.stack.imgur.com/Jlbh2.jpg)](https://i.stack.imgur.com/Jlbh2.jpg)

* * *

## 回答 #6

> 赞同：35
> 
> 时间：2008-10-01T09:03:29.600

参数是调用函数时必须填写的内容。你放进去的是论据。

简单设置：参数进入参数，参数是参数的值。

更多信息： [http ://en.wikipedia.org/wiki/Parameter_(computer_science)#Parameters_and_arguments](http://en.wikipedia.org/wiki/Parameter_(computer_science)#Parameters_and_arguments)

* * *

## 回答 #7

> 赞同：22
> 
> 时间：2014-06-23T13:31:38.387

> 在程序员甚至作者中，术语参数和参数的使用在一定程度上被滥用了。在处理方法时，术语*参数*用于标识方法签名中的占位符，而术语*参数*是您传递给方法的实际值。

*MCSD 认证工具包（考试 70-483）C# 编程*，第 1 版，Wrox，2013 年

**真实案例场景**

```
// Define a method with two parameters
int Sum(int num1, int num2)
{
   return num1 + num2;
}

// Call the method using two arguments
var ret = Sum(2, 3); 
```

* * *

## 回答 #8

> 赞同：13
> 
> 时间：2014-01-11T20:16:59.310

假设您是一家航空公司。你造一架飞机。你在里面安装座位。然后，您将飞机装满乘客并将其发送到某个地方。乘客（或者更确切地说，一些时空改变的版本）下船。第二天，您再次使用同一架飞机和相同的座位，但这次是不同的乘客。

飞机是你的功能。

参数是座位。

争论的是坐在那些座位上的乘客。

```
function fly(seat1, seat2) {
    seat1.sayMyName();
    // Estraven
    seat2.sayMyName();

    etc.
}

var passenger1 = "Estraven";
var passenger2 = "Genly Ai";

fly(passenger1, passenger2); 
```

* * *

## 回答 #9

> 赞同：11
> 
> 时间：2014-06-02T10:25:38.287

在编辑中，我经常对人们忘记的方式感到厌烦：结构语言是基于自然语言的。

## 用英语

“参数”是占位符。他们用口语设置响应格式。根据定义，它是通话的一方，限制了响应。

“论据”是正在考虑的立场。你争论你的观点：你考虑一个论点。

## 主要区别

论点的主题角色是代理。参数的主题角色是接受者。

## 互动

将参数视为男性部分，使参数成为女性部分。参数进入参数。

## 用法

参数*通常*用于定义中。参数*通常*用于调用。

## 问题

**完成句子以减少不和谐。**

(A) 说到定义：

1.  [] 将使用什么参数？
2.  这个参数[]会是什么[]？

(B) 说到调用：

1.  你将使用什么参数，[]？
2.  什么[]会是[]这个参数？

## 答案

（一种）

1.  on/in/反对/使用这个参数
2.  论据...采取

(乙)

1.  什么是一些示例参数
2.  论据...用于/在/反对/与

## 重叠

可以想象，在回答：在口语中，这些词有时会产生相同的反应！

因此，作为一项规则：

*   通常如果有人想要参数信息，他们想知道更多关于类型、变量名等的信息。如果你只给出示例参数，他们可能会感到困惑。

    *   通常，如果有人想要参数信息，他们想知道您传递给函数或其参数的值。

* * *

## 回答 #10

> 赞同：10
> 
> 时间：2008-10-01T09:04:06.917

函数/方法的**参数**向您描述了它用于计算其结果的值。

函数的**参数**是在函数/方法的特定调用期间分配给这些参数的值。

* * *

## 回答 #11

> 赞同：10
> 
> 时间：2013-12-22T04:21:13.193

或者，在方法的可选参数的情况下，这样记住可能更简单：

```
public void Method(string parameter = "argument") 
{

} 
```

`parameter`是参数，它的值，`"argument"`是参数:)

* * *

## 回答 #12

> 赞同：10
> 
> 时间：2017-09-22T08:48:50.223

永远记住：
在接收参数时传递参数。

* * *

## 回答 #13

> 赞同：9
> 
> 时间：2013-08-26T15:06:13.887

这个例子可能会有所帮助。

```
int main () {
   int x = 5; 
   int y = 4;

   sum(x, y); // **x and y are arguments**
}

int sum(int one, int two) { // **one and two are parameters**
   return one + two;
} 
```

* * *

## 回答 #14

> 赞同：8
> 
> 时间：2020-01-27T09:49:40.353

一般来说，术语参数和参数可以互换使用，表示传递给函数的信息。

然而，从函数的角度来看：

*   **参数**是函数定义中括号内列出的变量。
*   **参数**是在调用函数时发送给函数的值。

* * *

## 回答 #15

> 赞同：7
> 
> 时间：2017-04-06T10:37:31.030

*参数和参数*

> 与参数和参数有关的所有不同术语都可能令人困惑。但是，如果您牢记几个简单的要点，您将能够轻松处理这些术语。
> 
> 1.  函数的*形式参数*在函数声明中列出，并在函数定义的主体中使用。形式参数（任何类型的）是一种空白或占位符，在调用函数时填充了某些内容。
> 2.  *参数*是用来填充形式参数的东西。当你写下一个函数调用时，参数列在函数名后面的括号中。当函数调用被执行时，参数被插入形式参数。
> 3.  术语*按值*调用和*按引用调用*是指在插入过程中使用的机制。在按值调用方法中，仅使用参数的值。在这种按值调用的机制中，形参是一个局部变量，它被初始化为相应参数的值。在引用调用机制中，参数是一个变量，并且使用了整个变量。在引用调用机制中，实参变量代替了形参，因此对形参所做的任何更改实际上都是对实参变量进行的。

资料来源：Absolute C++，Walter Savitch

那是，

[![在此处输入图像描述](https://i.stack.imgur.com/ZohYJ.jpg)](https://i.stack.imgur.com/ZohYJ.jpg)

* * *

## 回答 #16

> 赞同：6
> 
> 时间：2008-10-01T09:37:11.393

这些术语在某种程度上可以互换。其他答案中描述的区别更恰当地表达为函数体内使用的名称的*形式*参数和调用站点提供的值的参数（*形式**参数*和*参数*也很常见）。

另请注意，在数学中，术语*参数*更常见，*参数*通常意味着完全不同的东西（尽管*参数方程中的**参数*本质上是两个或多个函数的参数）。

* * *

## 回答 #17

> 赞同：5
> 
> 时间：2014-03-18T06:56:21.587

参数是参数的实例化。

* * *

## 回答 #18

> 赞同：5
> 
> 时间：2015-10-28T21:22:30.520

# 没有代码的简单解释

“参数”是一个非常笼统、宽泛的东西，但“参数：”是一个非常具体、具体的东西。通过日常示例可以最好地说明这一点：

### 示例 1：自动售货机 - Money 是参数，$2.00 是参数

大多数机器接受输入并返回输出。例如，自动售货机将货币作为输入，然后将汽水作为输出。在那种特殊情况下，它接受一个参数：money。

那么论据是什么呢？好吧，如果我将 $2.00 放入机器，那么参数是： $2.00 - 这是使用的非常具体的输入。

### 示例 2：汽车 - 汽油是参数

让我们考虑一辆汽车：他们接受汽油（无铅汽油）作为输入。可以说这些机器接受类型***参数***：汽油。论据将是我放入汽车的准确而具体的输入。例如，就我而言，论据是：40 升无铅汽油/汽油。

### 示例 3 - 论证的详细说明

参数是输入的特定和特定示例。假设我的机器将一个人作为输入并将他们变成不是骗子的人。

那么什么是论证呢？争论将是实际放入机器中的特定人。例如，如果将 Colin Powell 放入机器中，那么参数将是 Colin Powell。

因此，参数将是作为抽象概念的人，但参数始终是放入机器中的具有***特定名称的******特定人。***论点是具体而具体的。

 *这就是区别。简单的。

### 使困惑？

发表评论，我会修正解释。

* * *

## 回答 #19

> 赞同：5
> 
> 时间：2017-06-28T09:10:47.180

是的！参数和参数有不同的含义，可以简单解释如下：

函数**参数**是函数定义中列出的名称。

函数**参数**是传递给函数（并由函数接收）的实际值。

* * *

## 回答 #20

> 赞同：3
> 
> 时间：2013-10-27T14:25:35.720

它们在 C 中的用法没有太大区别，这两个术语都在实践中使用。大多数情况下，参数通常与函数一起使用。与函数调用语句一起传递的值称为实参，而形参将是复制函数定义中的值的变量（称为形参）。

```
int main ()
{
   /* local variable definition */
   int a = 100;
   int b = 200;
   int ret;

   /* calling a function to get max value */
   ret = max(a, b);

   printf( "Max value is : %d\n", ret );

   return 0;
}

/* function returning the max between two numbers */
int max(int num1, int num2) 
{
   /* local variable declaration */
   int result;

   if (num1 > num2)
      result = num1;
   else
      result = num2;

   return result; 
} 
```

在上面的代码中`num1`，and`num2`是形式参数，`a`and`b`是实际参数。

* * *

## 回答 #21

> 赞同：3
> 
> 时间：2016-03-10T17:36:00.043

Oracle 的 Java 教程这样定义了这种区别：“参数是指方法声明中的变量列表。参数是调用方法时传入的实际值。调用方法时，使用的参数必须与声明的参数匹配按类型和顺序。”

参数和参数的更详细讨论： [https ://docs.oracle.com/javase/tutorial/java/javaOO/arguments.html](https://docs.oracle.com/javase/tutorial/java/javaOO/arguments.html)

* * *

## 回答 #22

> 赞同：3
> 
> 时间：2017-04-29T12:15:18.300

从逻辑上讲，我们实际上在谈论同一件事。但我认为一个简单的比喻将有助于解决这个困境。

如果隐喻可以称为各种连接点，我们可以将它们等同于墙上的插头点。在这种情况下，我们可以考虑如下参数和参数；

***参数****是插头点的插座，可以采用各种不同的形状。但只有某些类型的插头适合它们。*
***参数****将是插入插头点/插座以激活某些设备的实际插头。*

* * *

## 回答 #23

> 赞同：3
> 
> 时间：2018-12-01T04:50:12.100

参数是函数定义中的**变量**
参数是参数的**值**

```
<?php

    /* define function */
    function myFunction($parameter1, $parameter2)
    {
        echo "This is value of paramater 1: {$parameter1} <br />";
        echo "This is value of paramater 2: {$parameter2} <br />";
    }

    /* call function with arguments*/
    myFunction(1, 2);

?> 
```

* * *

## 回答 #24

> 赞同：2
> 
> 时间：2013-06-15T06:09:30.543

或者更简单...

**中的论据！**

**参数出来！**

* * *

## 回答 #25

> 赞同：2
> 
> 时间：2016-03-23T07:59:35.307

当我们在Java中创建方法（函数）时，像这样的方法..

`data-type name of the method (data-type variable-name)`

在括号中，这些是参数，当我们调用方法（函数）时，我们传递这个参数的值，这些值称为参数。

* * *

## 回答 #26

> 赞同：2
> 
> 时间：2018-01-18T21:28:01.363

根据 Joseph 的 Alabahari 书“C# in a Nutshell”（C# 7.0，第 49 页）：

```
static void Foo (int x)
{
    x = x + 1; // When you're talking in context of this method x is parameter
    Console.WriteLine (x);
}
static void Main()
{
    Foo (8); // an argument of 8\. 
             // When you're talking from the outer scope point of view
} 
```

在某些人类语言（afaik 意大利语、俄语）中，同义词被广泛用于这些术语。

*   **参数**=**形式参数**
*   **参数**=**实际参数**

在我的大学里，教授使用这两种名字。

* * *

## 回答 #27

> 赞同：1
> 
> 时间：2017-12-10T12:23:27.417

我仔细考虑了一下，意识到我之前的答案是错误的。这是一个更好的定义

{*想象一盒鸡蛋：一包香肠链接：和一个女仆*} 这些代表了准备工作所需的函数的元素，称为：（使用任何名称：假设 Cooking 是我的函数的名称）。

女仆是一种方法。

（你必须__call_或要求这个*方法*做早餐）（做早餐的行为是一个叫做*Cooking的**函数*）_

 *鸡蛋和香肠是参数：

（因为你想吃的鸡蛋数量和香肠数量是__variable_。）_

您的决定是一个参数：

它代表您正在烹饪的所选鸡蛋和/或香肠数量的 __Value_ ._

{*助记符*}

_“当你打电话给女仆让她做早餐时，她会和你争论_你应该吃多少鸡蛋和香肠。她担心你的胆固醇”__

（然后，参数是您声明并决定传递给函数的参数组合的值）

* * *

## 回答 #28

> 赞同：1
> 
> 时间：2018-03-19T11:18:07.847

[它在参数（计算机编程）](https://en.wikipedia.org/wiki/Parameter_(computer_programming)#Parameters_and_arguments)中得到了完美的解释- 维基百科

松散地说，参数是一种类型，而参数是一个实例。

在函数定义`f(x) = x*x`中，变量`x`是参数；在函数调用`f(2)`中，值``2 是函数的参数。

和 [参数 - 维基百科](https://en.wikipedia.org/wiki/Parameter)

在[计算机编程中，](https://en.wikipedia.org/wiki/Computer_programming)[参数](https://en.wikipedia.org/wiki/Parameter_(computer_programming))的两个概念是常用的，称为形[参和](https://en.wikipedia.org/wiki/Parameter_(computer_programming)#Parameters_and_arguments)实参——或更正式地称为形**参**和**实参**。

例如，在一个函数的定义中，例如

`y = f(x) = x + 2,`

*x*是定义函数的形*参*（*参数*）。

当针对给定值评估函数时，如

`f(3): or, y = f(3) = 3 + 2 = 5,`

是定义函数评估的*实际参数*（*参数*）；它是一个给定值（实际值），用于替换定义函数的*形式参数*。（在不经意的使用中，术语*参数*和*参数*可能会无意中互换，从而导致使用不正确。）

* * *

## 回答 #29

> 赞同：1
> 
> 时间：2019-12-25T18:33:07.047

由于我的背景和主要环境是 C，我将提供一些来自实际 C 标准和重要参考书的对该主题的陈述/引用，来自 C 的开发人员之一，这经常被引用并被普遍视为第一个非官方C标准：

* * *

Brian W. Kernighan 和 Dennis M. Ritchie 的 C 编程语言（第 2 版）（1988 年 4 月）：

> 第 25 页，第 1.7 节 - 功能
> 
> 我们通常将*参数*用于函数定义中括号列表中命名的变量，并将*参数*用于函数调用中使用的值。术语*形式论证*和*实际论证*有时用于相同的区别。

ISO/IEC 9899:2018 (C18)：

> 3.3
> 
> **争论**
> 
> 实际论证
> 
> 已弃用：实际参数
> 
> 函数调用表达式中由括号包围的逗号分隔列表中的表达式，或类函数宏调用中由括号包围的逗号分隔列表中的一系列预处理标记。

* * *

> 3.16
> 
> **范围**
> 
> 形参
> 
> 不推荐使用：形式参数
> 
> 声明为函数声明或定义的一部分的对象，该对象在进入函数时获取值，或来自逗号分隔列表的标识符，该列表由紧跟在类似函数的宏定义中的宏名称之后的括号界定。

* * *

## 回答 #30

> 赞同：0
> 
> 时间：2016-11-27T18:26:53.687

参数是函数接收的变量。因此它们在函数声明中可见。它们包含变量名称及其数据类型。参数是传递给另一个函数的实际值。这就是为什么我们可以在函数调用中看到它们。它们只是没有数据类型的值

* * *

## 回答 #31

> 赞同：0
> 
> 时间：2017-06-13T08:32:21.817

函数的形式参数在函数声明中列出，并在函数定义的主体中使用。形式**参数**（任何类型的）是一种空白或占位符，在调用函数时填充了某些内容。

**参数**是用来填充形式参数的东西。当你写下一个函数调用时，参数列在函数名后面的括号中。当函数调用被执行时，参数被插入形式参数。

术语**按值**调用和**按引用调用**是指在插入过程中使用的机制。在按值调用方法中，仅使用参数的值。在这种按值调用的机制中，形参是一个局部变量，它被初始化为相应参数的值。在引用调用机制中，参数是一个变量，并且使用了整个变量。在引用调用机制中，实参变量代替了形参，因此对形参所做的任何更改实际上都是对实参变量进行的。

* * *

## 回答 #32

> 赞同：0
> 
> 时间：2017-07-26T11:37:57.913

**参数**是用于存储传递给函数以供函数使用的数据的变量。**参数**是调用函数时传递给函数的实际数据：

```
// x and y are parameters in this function declaration
function add(x, y) {
  // function body
  var sum = x + y;
  return sum; // return statement
}

// 1 and 2 are passed into the function as arguments
var sum = add(1, 2); 
```

* * *

## 回答 #33

> 赞同：0
> 
> 时间：2018-06-01T07:39:16.197

您需要回归基础。构造函数和方法都有参数和参数。许多人甚至称构造函数为特殊类型的方法。这就是声明方法的**参数的使用方式**：

```
 type name(parameters){
           //body of method
          } 
```

这就是声明构造**函数的方式，使用参数**：

```
classname(parameters){
//body
} 
```

现在让我们看一个示例代码，我们使用它来计算立方体的体积：

```
public class cuboid {
    double width;
    double height;
    double depth;

      cuboid(double w,double h,double d) { 
      //Here w,h and d are parameters of constructor
       this.width=w;
       this.height=h;
       this.depth=d;
       }

        public double volume() {
        double v;
        v=width*height*depth;
        return v;
        }
        public static void main(String args[]){
           cuboid c1=new cuboid(10,20,30);
           //Here 10,20 and 30 are arguments of a constructor
           double vol;
           vol=c1.volume();
           System.out.println("Volume is:"+vol);

           }
    } 
```

所以现在你明白了，当我们稍后在代码中的某个位置调用对象的构造函数/方法时，我们传递的是参数而不是参数。因此，参数仅限于定义逻辑对象的位置，但参数在物理对象时起作用对象被实际创建。

* * *

## 回答 #34

> 赞同：0
> 
> 时间：2021-03-19T09:56:29.263

这是一个**关键：价值**问题...

**参数**是关键

**参数**是值

/****************************************/

例子：

名称：“彼得”

/********/

让 printName = ( **name** ) => console.log( **name** )

打印名称（**“彼得”**）

/********/

在这种情况下，**参数**是“name”，**参数**是“Peter”

* * *

## 回答 #35

> 赞同：0
> 
> 时间：2022-03-01T11:22:02.597

考虑下面的java代码。

```
public class Test{
   public String hello(String name){
      return "Hello Mr."+name;
   }

  public static void main(String args[]){
     Test test = new Test();
     String myName = "James Bond";
     test.hello(myName);
  }
} 
```

hello(String name) 的方法定义声明了一个名为 name 的 String**参数**。在 main 方法中，我们通过传递**参数**myName 来调用 hello 方法。

所以参数是占位符，其中参数是方法的实际值。

* * *

## 回答 #36

> 赞同：-1
> 
> 时间：2020-05-13T00:55:18.017

*   **参数**：
    *   已经“内置”到函数中的值。
    *   可以更改参数，以便该功能可用于其他用途。
*   **论据**：
    *   函数的输入
    *   影响函数结果的变量。

[来源](https://www.mathsisfun.com/definitions/parameter.html)

# sql - 如何找到类似的地址记录？

> ID：156769
> 
> 赞同：2
> 
> 时间：2008-10-01T08:58:01.113
> 
> 标签：sql, database

工作流程是这样的：

1.  我收到一张带有数据（名字、姓氏、邮编、城市 + 其他信息）的优惠券扫描件。
2.  在创建新客户之前，如果客户可能已经存在，我必须搜索数据库。

现在我的问题是：当没有可用的唯一 ID 时，找到现有客户的最佳方式是什么？

PS：我在数据库中确实有一个唯一 ID，只是我们收到的优惠券上没有；）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-01T09:09:36.950

我们正在使用[Levenshtein 距离](http://en.wikipedia.org/wiki/Levenshtein_distance)算法来检查用户是否存在重复。然而，我们有相当严格的规则来输入数据本身，所以我们只需要检查输入错误、大小写差异等。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-01T09:03:37.073

请参阅上一个问题：[Parse usable Street Address, City, State, Zip from a string](https://stackoverflow.com/questions/16413/parse-usable-street-address-city-state-zip-from-a-string#16444)。

如果您需要类似的匹配，[Soundex会为您提供帮助。](http://en.wikipedia.org/wiki/Soundex)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-01T15:47:01.003

如果您真的想以正确的方式、简单的方式、完整的方式来购买 Netrics。

[http://www.netrics.com/](http://www.netrics.com/)

我们买了它，并在它周围包裹了一个应用程序，让我们的员工可以匹配他们想要的任何东西。可以为每列配置置信区间，构建叙词表，您可以在其中将 Robert 映射到 Bob，将 John 映射到 Jack。令人惊奇的是，该国一些较大的机构使用它来清理各种列表。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-01T13:36:25.107

如果您有 SQL Server 2005，则可以通过 SSIS 引入数据并使用模糊查找来检查相同性。

* * *

## 回答 #5

> 赞同：-3
> 
> 时间：2008-10-01T09:08:37.297

您查询与给定数据匹配的所有客户的数据库，例如

```
SELECT ID FROM tbl_customers WHERE 
   first_name LIKE 'JOHN' 
   AND last_name LIKE 'Doe' 
   AND zip_code=12345 
   AND city LIKE 'Ducktown' 
```

如果返回的行数为 0，则在数据库中创建一个新条目。如果为 1，则查询将为您提供 ID。如果 > 1 您可能有多个同名客户居住在同一区域，需要想办法处理这种情况。但这将证明这里有一个新问题;-)

* * *

ps：如果您根本没有唯一ID，请重新设计您的数据库。

# ant - 有没有展示漂亮/全面的 build.xml 的网站？

> ID：156770
> 
> 赞同：1
> 
> 时间：2008-10-01T08:58:13.640
> 
> 标签：ant

我的意思是 build.xml 实际上包含了 findbugs 等插件。或者做得很好的 build.xml

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-19T21:56:17.200

示例 Ant 构建文件的一个很好的资源是 Google 代码搜索。[在 Google 代码中搜索 build.xml](http://code.google.com/search/#q=build.xml)。搜索后，将其缩小到“项目托管”以获取真正的内容。您会发现许多真实、有效、可用的 build.xml 文件的示例。

例如，这里是[Firebug](http://code.google.com/p/fbug/source/browse/branches/firebug1.3/build.xml)的[构建文件、Clojure 语言](http://code.google.com/p/clojure-contrib/source/browse/branches/lazy/build.xml)的[构建文件、GWT](http://code.google.com/p/google-web-toolkit/source/browse/trunk/build.xml?spec=svn5418&r=5418)的[构建文件和 Google Guice](http://code.google.com/p/google-guice/source/browse/build.xml)的构建文件。

当然，还有其他很好的源代码存储库，这里是[GitHub 上的 build.xml 文件搜索](https://github.com/search?type=Code&language=XML&q=build.xml&repo=&langOverride=&x=12&y=13&start_value=1)，[Google 搜索 SourceForge.net 的 build.xml 文件](http://www.google.com/search?q=site%3Asourceforge.net+build.xml)和[Google 搜索的 RIAForge.org 的 build.xml 文件](http://www.google.com/search?q=site%3Asvn.riaforge.org+build.xml)

另一种查找高质量构建文件的好方法是[在 URL 中使用 Google 搜索 build.xml](http://www.google.com/search?q=allinurl%3Abuild.xml)，这将产生多种结果。将选择的方面或编程语言添加到该查询中，您将立即获得所需的内容。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-01T17:35:52.450

我创建了[Antiplate](http://antiplate.origo.ethz.ch/)项目来为典型的 Java 项目创建构建模板。您可以查看它的模板目录以获取一些典型问题的解决方案。Findbugs 不包括（还），但 PMD、Checkstyle、Emma 和其他一些东西。它被分成不同的文件，所以蚂蚁代码应该是可以理解的。

主要内容可以在[此目录](https://svn.origo.ethz.ch/antiplate/Antiplate/templates/conf/antiplate/)的 .xml 文件中找到。这是Antiplate SVN 中的直接链接，显示导入的.xml 文件的内容，其中包含所有任务。文件[doc.xml](https://svn.origo.ethz.ch/antiplate/Antiplate/templates/conf/antiplate/doc.xml)包含使用 emma、cpd、checkstyle 等生成报告。我希望直接在源代码中的链接有助于理解如何自己实现此类任务。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-11T19:49:03.590

我知道这不是你所要求的。但是如果你想使用 ant，你需要阅读这篇文章：[Ant in anger](http://ant.apache.org/ant_in_anger.html)。

是的：我知道您只是想要一些 hack'n'slash 示例；阅读这篇文章

是的：我知道你*只是*想解决你的问题；阅读这篇文章

一旦一个 ant 文件超过了某个阈值，它就不再友好了。好的例子将永远是小到让你感兴趣的地方。因此，请停止尝试复制粘贴任意 xml 的 11 行，然后；...是的，我想你现在明白了；）

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-10-24T15:34:11.073

您可以使用 maven 2，因为它具有内置的插件支持。并且所有的东西，如：PMD、Findbugs、Checkstyle 等，都可以自动集成。如果您有一些现有的代码，可以从 maven 调用它，您可以使用 maven-antrun-plugin。

# collaboration - 分布式企业协作工具

> ID：156774
> 
> 赞同：2
> 
> 时间：2008-10-01T08:59:28.720
> 
> 标签：collaboration, instant-messaging, corporate

我正在寻找一种企业协作工具来帮助我的团队聚集在一起，这些团队在地理上和组织上都分布着。一些团队成员在客户站点上操作，在公司防火墙和类似的后面。

我的限制是：

*   必须允许创建持久的“频道”（即不仅仅是一对一或一对多的聊天）。
*   必须是免费的（或非常接近它）。
*   必须通过公司防火墙普遍可用（即在端口 80 或类似端口上运行）。我知道没有任何解决方案可以保证可以通过每个防火墙，但是让我们避免常见限制的解决方案很重要。
*   必须有一个桌面/警报代理，以允许用户在新消息到达他们正在收听的频道时收到警报。
*   如果可能的话，应该具有允许应用程序在登录/启动时启动的功能，这样开发人员就不必记住激活它或手动登录。

有没有人有任何符合这些标准的建议？

到目前为止，我考虑过：

*   Google Talk：未通过“频道”测试 - 群聊也只能通过网络界面访问。
*   CampFire：桌面警报和自动启动功能失败。要求用户打开 Web 浏览器、导航、登录等。也未通过“免费”测试，但仅此而已。如果可以克服这些其他失败，价格就不会成为问题。
*   www.24im.com：未通过“通用公司防火墙”测试 - 它在端口 10880-10889 上进行通信，我们测试的所有公司防火墙都阻止了这些端口。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-01T09:03:30.770

[Skype](http://www.skype.com/) 满足您的所有要求。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-01T09:04:23.017

只需使用 Skype。它是免费的，具有出色的聊天功能，可以跨防火墙工作，支持许多开箱即用的协作功能以及更多插件。

PS 在 Windows Mobile 上也原生支持，在其他移动平台上也有很好的客户端（比如 S60 上的 Fring）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-01T23:49:34.807

[OpenFire](http://www.igniterealtime.org/projects/openfire/index.jsp) + [Spark](http://www.igniterealtime.org/projects/spark/index.jsp)都不错，非常好。有一个[beta 插件](http://www.igniterealtime.org/projects/openfire/plugins-beta.jsp)可以与 red5 集成并启用视频和音频流。AFAIK，Spark 已经支持 SIP。

亲切的问候

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-01T09:08:24.097

IIRC google talk 在内部使用 jabber 协议。您应该能够与任何客户端连接到它，其中一些应该提供通道功能。或者，如果您想让您的数据远离 google 的视线，您可以设置自己的 jabber 服务器。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-01T23:32:47.547

可悲的是，Skype 在我们自己的公司网络上被阻止，尽管我不确定是什么机制或逻辑。

我将追求 Jabber/XMPP 客户。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-02T02:57:36.883

国税局？如果你把它托管在你自己的服务器上，你可以在端口 80 上运行它，如果你该死的话。

只要确保它在收到杂散的 Web 请求时不会崩溃和烧毁。:P

# java - 如何从 Sax XmlHandler 输出 CDATA 部分

> ID：156777
> 
> 赞同：4
> 
> 时间：2008-10-01T09:00:23.633
> 
> 标签：java, xml, sax

这是[如何将字符从 Oracle 编码为 Xml 的后续问题？](https://stackoverflow.com/questions/156697/how-to-encode-characters-from-oracle-to-xml)

在我的环境中，我使用 Java 将结果集序列化为 xml。我无法访问输出流本身，只能访问 org.xml.sax.ContentHandler。

当我尝试在 CDATA 部分中输出字符时：

它基本上是这样发生的：

```
xmlHandler.startElement(uri, lname, "column", attributes);
String chars = "<![CDATA["+rs.getString(i)+"]]>";
xmlHandler.characters(chars.toCharArray(), 0, chars.length());
xmlHandler.endElement(uri, lname, "column"); 
```

我明白了：

```
<column>&lt;![CDATA[33665]]&gt;</column> 
```

但我想要这个：

```
<column><![CDATA[33665]]></column> 
```

那么如何输出带有 Sax ContentHandler 的 CDATA 部分？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-01T13:36:44.873

它正在被转义，因为 handler.characters 函数旨在转义，并且该`<![CDATA[`部分不被视为值的一部分。

您需要使用新公开`DefaultHandler2`的方法或使用`TransformerHandler`可以设置输出键的方法`CDATA_SECTION_ELEMENTS`，该方法采用空格分隔的标记名称列表，该列表应输出包含在 CDATA 中的子文本部分。

```
StreamResult streamResult = new StreamResult(out);
SAXTransformerFactory tf = (SAXTransformerFactory) SAXTransformerFactory.newInstance();
TransformerHandler hd = tf.newTransformerHandler();
Transformer serializer = hd.getTransformer();
serializer.setOutputProperty(OutputKeys.CDATA_SECTION_ELEMENTS, "column");
hd.setResult(streamResult);
hd.startDocument();
hd.startElement("","","column",atts);
hd.characters(asdf,0, asdf.length());
hd.endElement("","","column");
hd.endDocument(); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-08-29T08:26:31.100

您应该使用`startCDATA()`and`endCData()`作为分隔符，即

```
xmlHandler.startElement(uri, lname, "column", attributes);
xmlHandler.startCDATA();
String chars = rs.getString(i);
xmlHandler.characters(chars.toCharArray(), 0, chars.length());
xmlHandler.endCDATA();
xmlHandler.endElement(uri, lname, "column"); 
```

# c# - C# - 如何定义内联方法 Func 作为参数？

> ID：156779
> 
> 赞同：9
> 
> 时间：2008-10-01T09:00:33.447
> 
> 标签：c#, generics, func, inline-method

我编写了一个简单的 SessionItem 管理类来处理所有那些讨厌的空检查，如果不存在则插入一个默认值。这是我的 GetItem 方法：

```
public static T GetItem<T>(string key, Func<T> defaultValue)
{
    if (HttpContext.Current.Session[key] == null)
    {
        HttpContext.Current.Session[key] = defaultValue.Invoke();
    }
    return (T)HttpContext.Current.Session[key];
} 
```

现在，我如何实际使用它，将 Func<T> 作为内联方法参数传递？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-10-01T09:08:07.717

由于这是一个函数，因此 lambda 将是最简单的方法：

```
Foo foo = GetItem<Foo>("abc", () => new Foo("blah")); 
```

其中 [new Foo("blah")] 是默认调用的函数。

您还可以简化为：

```
return ((T)HttpContext.Current.Session[key]) ?? defaultValue(); 
```

在哪里 ？？是 null 合并运算符 - 如果第一个 arg 不为 null，则返回它；否则评估并返回右手（因此除非项目为空，否则不会调用 defaultValue() ）。

最后，如果您只想使用默认构造函数，那么您可以添加一个“new()”约束：

```
public static T GetItem<T>(string key)
    where T : new()
{
    return ((T)HttpContext.Current.Session[key]) ?? new T();
} 
```

这仍然是懒惰的 - new() 仅在项目为空时使用。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-01T09:03:43.297

为什么不直接传递默认值呢？函子有什么用？

顺便说一句，`defaultValue.Invoke()`相当冗长。也可以只写`defaultValue()`。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-01T09:08:27.093

```
var log = SessionItem.GetItem("logger", () => NullLog.Instance) 
```

**请注意，**通常您可以在 GetItem{T} 调用中跳过 {T} 规范（如果 Func{T} 返回相同类型的对象）

# reporting-services - .NET Reporting Services 是否支持矢量图形？

> ID：156782
> 
> 赞同：8
> 
> 时间：2008-10-01T09:02:19.277
> 
> 标签：reporting-services

在进入 www 之后，我对报告服务对矢量图形/图像的支持一无所知。这似乎是不可能的。我们使用带有 PDF 渲染的 Reporting Services，我们被迫在报告中使用原始位图。这会导致大量报告。我们知道处理矢量图形会有所帮助，但报告服务似乎不支持此类功能。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-12-03T19:25:25.777

不，没有已知的方法可以在 SQL Reporting Services 中插入矢量图形。现在，由于 RDL 2.0 支持一些 HTML 支持，但我不确定这是否包括 VML 或任何足以显示图形的东西。

我有同样的需求，并且一直在尽可能多地与那些参与 SQL Reporting Services 和其他基于 RDL 的替代方案（如[DataDynamic Reports](http://www.datadynamics.com/Products/DDRPT/Overview.aspx)和[FYI Reporting](http://fyireporting.com/) ）的人员沟通，看看我是否可以获得这种类型的支持。到目前为止，[DataDynamics Reports 支持人们声称](http://www.datadynamics.com/forums/126188/ShowPost.aspx)拥有“更好的 EMF 和 CRI 支持”，但其他人没有这样的能力，也没有任何公开的实施计划。

有关详细信息，请参阅[我](http://social.msdn.microsoft.com/Forums/en-US/sqlreportingservices/thread/e9a9fb4d-8c77-4a4b-88ef-c73e57a3f507)在 MSDN 论坛上的帖子，了解 OLE 对象或 EMF 图像支持是否会在 SQL Server Reporting Services 的任何未来版本中引入。

至于那些可能愿意自己实现解决方案的人，我认为[balaweblog 是正确](https://stackoverflow.com/questions/156782/does-net-reporting-services-support-vectorial-graphics/190846#190846)的，因为可以创建自定义报告项以您喜欢的格式呈现矢量图形，但这要求您基本上编写不是由如果系统或 .NET Framework 不直接支持您的格式（例如想到 SVG），Microsoft 并编写一个渲染引擎。

更新：似乎其他人也在寻求[在 FYI 报告中实现矢量图形，](http://fyireporting.com/forum/viewtopic.php?t=647&highlight=vector)但是他们似乎遇到了许多人在尝试导出为 PDF 时遇到的相同障碍。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-13T10:40:32.807

过去，SQL Reporting Services 和 PDF 压缩存在问题。如果您在 2005 年之前的版本中创建 serverreports 或在 2008 年之前的版本中创建 localreports，hugh pdf 文件可能是由压缩问题引起的。

[http://forums.asp.net/t/1066296.aspx](http://forums.asp.net/t/1066296.aspx)

# c# - 显示简单站点时 IE6 崩溃

> ID：156798
> 
> 赞同：1
> 
> 时间：2008-10-01T09:05:12.017
> 
> 标签：c#, asp.net, internet-explorer-6

对于一个非常简单的 ASP.NET (.NET 3.5) 站点和 IE6，我遇到了一个非常奇怪的问题。

有时，在某些机器上，IE6 在显示站点时似乎会崩溃。CSS 已经被排除为崩溃的原因。

经过一段时间的研究，我无法找到崩溃的原因，也无法正确重现它。

该站点适用于除 IE6 之外的所有浏览器，并且仅在某些机器上崩溃，而不是在任何地方崩溃。

知道这可能是什么吗？

[编辑] 当 IE 崩溃时，我得到 Windows 异常对话框并且必须关闭 IE6：不仅仅是警告或其他东西。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-02T00:11:56.330

您可以尝试几件事：

*   检查相关机器上是否安装了任何 IE 插件（工具栏等），并尝试禁用所有这些插件。
*   检查 Windows 事件日志以查看崩溃是否留下了任何线索。

如果您想获得真正的硬核，您可以按照[Mark Russinovich 的指南](http://blogs.technet.com/markrussinovich/archive/2008/06/02/3065065.aspx)分析进程崩溃数据以确定是否有任何问题可能导致问题。在他的案例中，结果证明是 Nvidia 组件导致 IE 随机崩溃。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-01T19:56:42.837

As you've already eliminated CSS as being the cause I would try checking that your HTML validates against your DOCTYPE, then try visiting the page with JavaScript disabled to see if either of these can be eliminated as well.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-01T10:16:19.800

IE 6究竟是如何崩溃的？如果您遇到臭名昭著的[Operation Aborted](http://www.google.co.uk/search?hl=en&rlz=1C1GGLS_en-GBGB291&q=operation+aborted&btnG=Search&meta=)错误，请尝试将任何 JavaScript 移动到页面底部的结束标记上方，看看是否有帮助。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-01T10:23:51.390

我得到了 Windows 异常对话框并且必须关闭 IE6

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-01T10:30:25.523

尝试查看事件日志（控制面板/管理工具/事件查看器），然后双击应用程序。

这可能会给你一些线索。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-01T10:37:29.517

IE 6 有多个版本——Service Pack 1、Service Pack 2、Service Pack 3，当然，没有 Service Pack。尝试查看崩溃的浏览器的版本信息，看看是否可以缩小那里的问题范围。

要尝试查看问题是什么，我建议尽可能地剥离页面，并向其中添加元素，直到您可以重现问题为止。

IE 6 很奇怪。看看这个链接：

[http://immike.net/blog/2007/08/06/single-line-of-html-crashes-ie-6/](http://immike.net/blog/2007/08/06/single-line-of-html-crashes-ie-6/)

作者指出，用一行有效的 HTML 可能会使 IE6 崩溃。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-03T23:41:30.457

我认为这已经解决了（至少我现在希望如此），但我刚刚问了一个非常相似的问题。

我的问题的答案是输入标签没有被关闭，并且页面的 DTD 是 XHTML，它具有 OMITTAG NO 作为默认值。

因此，您可能希望确保所有标签都是自封闭的（这将验证 XHTML 过渡，而不是 Strict）或

祝你好运，杰里米

# c++ - 什么是数据区？

> ID：156799
> 
> 赞同：3
> 
> 时间：2008-10-01T09:05:19.440
> 
> 标签：c++, memory, static, storage

在 C++ 中，存储类说明符 static 从数据区域分配内存。“数据区”是什么意思？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-01T09:08:49.883

我不熟悉术语“数据区”，但内存通常分为“代码段”和“数据段”。代码存在于前者，数据存在于后者。我想这就是这里的意思。

传统上，两者之间没有区别。但是，许多现代操作系统可以禁止在数据段中执行代码（只要 CPU 支持这种区别）。这有时与“NX标志”的流行语相吻合，如“不执行”，可以有效防止某些恶意代码注入情况。

/EDIT：请注意，C++ 标准没有提到“数据区”。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-01T09:37:40.313

这些区域的名称因平台、编译器和链接器而异。

一般来说，有：

*   程序文本：可执行代码空间。
*   常量：不可执行的常量。
*   栈：栈。
*   bss：在 C/C++ 术语中广义上的“静态”。“由符号开始的块”
*   数据：未初始化的全局变量
*   heap：运行时分配的存储空间。

在这种情况下，有问题的文档使用名称“数据区”来表示传统上称为 bss 段的内容。

在 C 语言中，存储类说明符“静态”表示在程序的生命周期内存在的内存，并被初始化为零或初始化器的值。在示例中：

```
static int s_value_one;
static int s_value_two = 123; 
```

s_value_one 的值保证为零，s_value_type 的值在 main() 中的第一条语句处为 123。这如何成为现实是一个实施问题。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-01T09:39:07.393

除了 Konrad 所说的，将变量声明为静态基本上意味着它的内存在程序加载时被分配，而不是在堆或堆栈上。从历史上看，在关键应用程序中仅使用静态变量意味着应用程序的内存占用量在运行时不会改变，因此由于资源限制而失败的可能性较小。不知道现代操作系统是否仍然如此。

如果您让编译器生成一个映射文件作为其输出的一部分，您可以查看所有各个部分中的内容，包括数据。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-01T09:13:04.600

康拉德说的。

我想补充一点，如果将数据放在代码部分中，仍然有 CPU 无法读取数据，反之亦然。这些在几十年前更为常见，但它们在嵌入式世界中仍然存在。

简而言之，链接器只是将相同种类的符号组合在一起。在 PC 上，您通常拥有的不仅仅是简单的代码和数据区域。您还将找到未初始化数据、只读数据和其他依赖于操作系统的数据的区域。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-01T09:13:11.717

几乎没有谷歌搜索，我在这里找到了关于这些主题的更多信息：

*   [http://www.informit.com/articles/article.aspx?p=31783&seqNum=4](http://www.informit.com/articles/article.aspx?p=31783&seqNum=4)
*   [http://www.codeguru.com/cpp/tic/tic0111.shtml](http://www.codeguru.com/cpp/tic/tic0111.shtml)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-01T09:21:25.393

数据可能会在很多地方结束。通常，局部变量是在堆栈上分配的，您可以使用 malloc（或默认版本的“new”）在堆上分配东西。然而，静态数据通常在您的程序启动时分配，并且可能在任何地方结束——具体取决于编译器、操作系统和可执行格式。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-01T09:51:12.263

**可执行文件中有很多信息。**

一个可执行文件，在其物理文件中存储了许多类型/类的数据。

例如是

1.  可执行代码指令
2.  资源
3.  依赖信息（这个二进制文件依赖的dll）
4.  从此二进制文件导出的符号

ETC

**需要有某种组织方式**

.exe 文件格式中的所有这些信息，以便操作系统可以轻松找到所有信息并加载可执行文件并使其正常工作。为此，在 Windows 世界中使用了一种称为 PE（便携式可执行文件）的常见二进制格式（当然是由 M$ 创建的）。我刚刚列出的所有信息（以及更多信息）都在二进制文件的不同部分进行了详细描述。

**.data 部分**

一个这样的部分是 .data 部分。.data 部分包含所有已初始化的全局和静态数据，而 .bss 部分包含未初始化的全局数据。

**为什么你需要一个单独的部分用于 globals ？**

好吧，全局的行为类似于全局，因为它是在程序生命周期内存在的内存区域中创建的，而不是像堆栈这样可能被覆盖/重用的临时数据结构。（就像普通的自动变量一样）。

**编译器**

因此，这些变量需要分配在堆中的某个永久地址中，不幸的是在编译时无法知道这些地址。所以编译器将所有的全局变量和静态变量都放在了这个.data/.bss段中，而引用这些变量的指令则引用了.data/.bss中这些相对永久的地址。

**链接器**

当链接器在现实世界中加载可执行文件时，它决定这些部分必须放在哪里，并为这些临时地址创建 FIX UP，以便引用全局变量的指令引用程序内存中现在的真实虚拟地址。

*现在您知道 .data 部分/区域是什么以及为什么需要在该区域中为全局变量分配一些空间以及这如何实时帮助程序。谷歌搜索 PE 格式和链接器和 .data 部分等将为您提供链接。*

* * *

## 回答 #8

> 赞同：-3
> 
> 时间：2008-10-01T09:15:28.310

我认为“数据区”是指堆，而局部变量通常位于堆栈上。

或者这意味着为该变量分配的内存位于可执行文件的 .data 部分，但这将特定于 Windows 和 PE 格式。

# css - Silverlight 显示问题

> ID：156800
> 
> 赞同：0
> 
> 时间：2008-10-01T09:05:20.797
> 
> 标签：css, silverlight

我创建了一个不错的 silverlight 控件，它完全按照我的意愿去做，它看起来很棒:) 当我在测试项目 ASPX 示例文件或 HTML 示例文件中托管它时，它会很好地显示出来。

我现在必须在我现有的 ASP.NET 2.0 项目中使用该控件，该项目具有精美的设计。我遇到的问题是控件没有完全显示它应该如何：

*   加载进度不显示
*   在我将鼠标移到包含它的 aria 上之前，该控件通常不会变得可见

显然这是我的 HTML/CSS 设计造成的，但是查找问题将非常耗时 - 那么有人知道这方面的知识吗？关于如何确保控件正确显示的规则是什么？应该使用哪些 CSS 属性？

PS：因为我有一个 2.0 的应用程序，我正在使用 Silverlight 的对象标记方法，它包含在一个 DIV 中，其高度和宽度设置为样式。

已请求代码段。它是这样的（基本上是来自 silverlight 测试项目的 HTML 测试页的副本（完美运行））：

```
<div id="silverlightControlHost" style="height: 300px; width: 750px;">
    <object data="data:application/x-silverlight," type="application/x-silverlight-2-b2"
    width="100%" height="100%">
    <param name="source" value="Contiki.SilverLight.FileUploader.xap" />
    <param name="onerror" value="onSilverlightError" />
    <param name="background" value="white" />                            
    <a href="http://go.microsoft.com/fwlink/?LinkID=115261" style="text-decoration: none;">
        <img src="http://go.microsoft.com/fwlink/?LinkId=108181" alt="Get Microsoft Silverlight"
        style="border-style: none" />
    </a>
    </object>
    <iframe style='visibility: hidden; height: 0; width: 0; border: 0px'></iframe>
</div> 
```

此 DIV 包含在表格的单元格中，这也是更大设计的一部分。如上所述，有很多 CSS。不知道这是否有帮助...

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-22T13:10:41.907

自己找到原因了...

事实证明，当控件放置在 html 表格中时，Silverlight 存在显示问题。[在 silverlight 论坛上找到了有关此的信息](http://silverlight.net/forums/p/20863/72280.aspx)。这是关于 beta 2 的，但我已经升级到了发布版本，它仍然是一个问题。

> 试试这个。向包含 Silverlight 控件的表添加高度和宽度。您可能还想在包含控件的 TD 内添加一个空白字符。
> 
> 基本上，当表格被渲染时，它无法“看到”内容的大小，因此它要么根本不渲染，要么只渲染为单个空白字符的大小。
> 
> ——约翰斯托克顿

我的设计对于嵌套表来说非常复杂，所以我实际上还不能让它工作。

**更新：**

我最终实现的实际修复是一个“刷新”包含 <DIV> 的小型 JavaScript。这里是：

```
<script type="text/javascript">
    function refreshSL()
    {
        var div = document.getElementById('silverlightControlHost');
        div.style.display = 'block';
    }
    refreshSL();
</script> 
```

我把它放在我的 HTML 中实际 SL 标记的下面，然后它就起作用了（我想在页面加载事件中调用它是正确的做法。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-01T16:08:16.443

CSS 问题有时很难调试。不同浏览器中的行为是否相同？您的 CSS 在任何地方都使用“float”吗？应用程序是否在表格外的同一页面上正常工作，然后在 div 外工作？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-02T16:37:48.580

正如亚当所说，CSS 问题是一个真正的 PITA。通常，当我遇到这样的事情时，我首先指向一个空白 CSS 而不是“花哨”的 CSS，然后开始重新添加样式，直到我能够重现该问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-12T02:54:29.010

哈哈

我有同样的问题，这让我发疯。该问题被隔离到 Internet Explorer。在所有其他浏览器（甚至 Opera）中都能正常工作。

你的解决方案肯定是一个黑客。由于这实际上是针对 IE 中的错误的一种解决方法，因此您可以正式摆脱它。

从技术上讲，我们不应该使用表格进行布局，但在现实世界中，这是让事情在跨浏览器中一致工作的唯一方法。

# networking - sshed 时将文件下载到本地驱动器

> ID：156810
> 
> 赞同：4
> 
> 时间：2008-10-01T09:09:38.090
> 
> 标签：networking, ssh, sftp

在 bash 中使用 ssh 登录到另一台计算机时，将文件下载到本地硬盘的最佳方法是什么。我知道 sftp，但它并不方便，例如它缺少目录名称的制表符补全。我正在使用 Ubuntu 8.04.1 。我没有公共 IP，也不想设置动态动态 DNS 解决方案。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-01T09:40:57.420

我也在运行 Ubuntu 8.04.1，如果我输入

```
$ scp me@myserver.mydomain.com:.bashr<TAB> 
```

我确实得到了选项卡完成（即 bash 正在连接到我的服务器并从那里的文件系统获取完成结果）。然后

```
$ scp me@myserver.mydomain.com:.bashrc . 
```

将我的 .bashrc 从我的服务器复制到我本地机器上的当前目录。

如果您没有得到这个，请尝试`sudo apt-get install bash-completion`，并检查您的 .bashrc 是否包含以下行（默认情况下我的行）：

```
# enable programmable completion features (you don't need to enable
# this, if it's already enabled in /etc/bash.bashrc and /etc/profile
# sources /etc/bash.bashrc).
if [ -f /etc/bash_completion ]; then
    . /etc/bash_completion
fi 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-19T21:20:36.477

鱼呢？***通过 ***Sh***ell 传输文件 - 您可以在控制台中使用 Midnight Commander：

```
$ sudo apt-get install mc
$ mc 
```

然后按***F9*** ; Right（对于 Right 面板）-> Shell link 键入远程主机的 ssh 链接。在提示符处***输入机器名称***，指定：

```
user@host 
```

系统将提示输入密码（或自动登录，如果您的 SSH 密钥已为此设置）

现在您可以浏览远程文件系统，根据需要选择并复制 (F5)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-01T09:12:24.493

我不知道。

我会 $ scp host:file locallocation

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-01T09:21:44.067

据我所知，没有简单的 scp-on-steroids 可以让您在远程文件夹结构上自动完成。如果您只想安装远程文件夹，请查看[sshfs](http://fuse.sourceforge.net/sshfs.html)。或者只是尝试在 Nautilus 中使用 ssh://... 挂载远程目录。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-01T09:38:59.720

我实际上喜欢使用命令行 SCP 客户端。:) 我不知道它是怎么做到的，但我在 Ubuntu 上的 SCP（来自 openssh-client 1:4.7p1-8ubuntu1.2）实际上在我通常通过公钥进行身份验证的主机上对远程目录和文件进行制表符补全。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-09T01:29:36.350

[ssh-xfer](http://matt.ucc.asn.au/ssh-xfer/)是您正在寻找的。设置完成后，您可以键入（从`ssh`远程计算机上的会话中）：

```
$ ssh-xfer foo.txt
```

并且 foo.txt 会神奇地出现在你的本地机器上。

# c# - Explain x => x.ToString() //简化这么多的调用

> ID：156815
> 
> 赞同：7
> 
> 时间：2008-10-01T09:11:00.037
> 
> 标签：c#, .net-3.5, lambda

在[问题答案](https://stackoverflow.com/questions/9033#9099)中，我找到了以下编码提示：-

2) 带有一个参数的简单 lambda：

```
x => x.ToString() //simplify so many calls 
```

作为一个还没有使用过 3.0 的人，我并不真正理解这个技巧，但它看起来很有趣，所以我希望通过几个例子来说明它如何简化调用。

我研究了 lambdas，所以我**想**我知道它们的作用，但是我**可能**不完全理解，所以也可能需要进行**一点**拆包。

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-10-01T09:16:35.310

当您需要创建具有单个参数的委托实例时，lambda 表达式允许您以非常简洁的方式“内联”创建该委托。例如，下面是通过姓名在列表中查找特定人员的代码：

```
List<Person> list = new List<Person>();
// [..] Populate list here
Person jon = list.Find(p => p.Name == "Jon"); 
```

在 C# 2.0 中，您可以使用一个有点冗长但还不错的匿名*方法*：

```
List<Person> list = new List<Person>();
// [..] Populate list here
Person jon = list.Find(delegate(Person p) { return p.Name == "Jon"; }); 
```

在 C# 1.0 中，您必须创建一个完整的额外方法。此外，如果你想参数化它，你必须创建一个不同的类型，而匿名方法和 lambda 表达式会捕获它们的执行环境（局部变量等），所以它们就像闭包一样：

```
public Person FindByName(List<Person> list, String name)
{
    return list.Find(p => p.Name == name); // The "name" variable is captured
} 
```

[在我关于闭包的文章](http://csharpindepth.com/Articles/Chapter5/Closures.aspx)中有更多关于此的内容。

虽然将委托传递给方法在 C# 2.0 和 .NET 2.0 中并不常见，但它是 LINQ 基础的很大一部分——因此您倾向于在 C# 3.0 和 .NET 3.5 中大量使用它。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-01T09:12:47.410

这基本上扩展为：

```
private string Lambda(object x) {
  return x.ToString();
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-01T09:18:12.700

您熟悉 C# 2.0 匿名方法吗？这两个调用是等价的（假设 SomeMethod 接受委托等）：

```
SomeMethod(x => x.ToString());

SomeMethod(delegate (SomeType x) { return x.ToString();}); 
```

我知道我宁愿输入哪个...

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-01T09:16:40.257

```
string delegate(TypeOfX x)
{
  return x.ToString();
} 
```

# logging - 在线查看服务器日志？这是鼓励吗？

> ID：156817
> 
> 赞同：2
> 
> 时间：2008-10-01T09:11:17.943
> 
> 标签：logging

我知道如果人们设法破解它并能够查看服务器日志，这可能是一个很大的安全问题。是否有任何应用程序可以实际获取日志并通过具有必要安全性的 Web 界面显示？我说的是java企业应用程序

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-02T02:52:57.080

看看 Splunk。[http://www.splunk.com/](http://www.splunk.com/) 这个工具对于你正在寻找的东西可能是矫枉过正的，但应该可以完成这项工作。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-01T17:03:06.517

我最近使用了一个基于 Web 的大型应用程序，该应用程序有一个单独的用于调试的菜单条目，可供选定的用户使用——前提是它首先被激活。尽管实施的解决方案在功能上有点不足——它只是在屏幕上显示 .log 文件*——*但它通常可以完成这项工作。由于我们作为开发人员可以完全访问服务器（通常在 VM 中），因此我们经常使用诸如[BareTail 之](http://www.baremetalsoft.com/baretail/)类的工具来实现行高亮和尾随等便利功能，但如果您不能始终访问服务器和您的时间允许，您应该考虑实现两全其美，这可能不是很复杂。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-01T09:49:26.853

我没有尝试过任何可用的产品，但经常考虑尝试。我什至自己实现了一些日志分析工具。

也许看看这个[“商业”](http://regumindtrail.wordpress.com/2007/02/06/the-spot-the-log-entry-contest/)

# eclipse - 重定向 ILog 消息

> ID：156821
> 
> 赞同：2
> 
> 时间：2008-10-01T09:12:13.450
> 
> 标签：eclipse, logging, eclipse-rcp, ilog

我目前正在开发一个 RCP Eclipse 应用程序。出于记录目的，我使用 SFL4J 而不是 log4j。对于我自己的代码，这很好用，因为我可以指定正确的记录器（ LoggerFactory.getLogger ... logger.debug ...）。但是如何将所有插件日志重定向到同一位置，以便在我的 log4j-LogFile 中也可以看到其他 rcp 插件的所有异常。如何在我的日志文件中记录未捕获的异常？

我听说过有关 ILog 的一些信息，但我不知道如何将其重定向到我的 log4j/slf4j 实现。

那么在一个日志文件中记录所有插件消息的最佳方法是什么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-15T18:50:54.250

要捕获整个平台的日志事件，请创建一个 ILogListener 实例并使用 Platform.addLogListener(ILogListener) 注册它。

至于记录未捕获的异常，一种方法是创建一个新的 ThreadGroup 并覆盖 uncaughtException(Thread t, Throwable e) 以记录异常。然后，您必须在该线程组中启动一个新线程并在其中执行所有其他操作。我在我的 IPlatformRunnable 实现的 run 方法中处理了这个问题。

# database - 数据库同步 - SFTP / RMAN / 通过代码？

> ID：156830
> 
> 赞同：0
> 
> 时间：2008-10-01T09:14:03.273
> 
> 标签：database

大家会推荐哪种方法，为什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-01T18:35:56.760

既然您提到了 RMAN，我可以假设您特别谈论的是 Oracle 数据库吗？还是您在谈论更一般的问题？

同步数据库的业务目的是什么？这将强烈影响技术的选择。在 Oracle 世界中，如果您想拥有一个热备份，您将拥有 DataGuard；如果您想拥有一个负载分布在集群的多个物理节点上的单个数据库，您将拥有 RAC；如果您想要拥有负载，则需要 Streams 和多主复制分布在多个地理分布的数据库中，如果您想定期从生产环境中克隆测试数据库，则使用 RMAN 等。

# wcf - 当我只知道它的 URL 时如何使用 wcf 服务

> ID：156833
> 
> 赞同：1
> 
> 时间：2008-10-01T09:15:08.793
> 
> 标签：wcf

当我只知道它的 URL 时，我需要动态地使用 wcf 服务。我没有创建服务引用或 Web 引用的选项，因为我的客户端代码从配置文件中获取 URL。我可以使用 System.ServiceModel 命名空间中的哪些类和方法来执行此操作。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-01T12:42:02.680

如果您没有服务接口，您至少必须了解服务器期望的消息是什么样的；否则很难做到:)

但肯定有办法做到这一点。您可以从创建服务器期望作为输入的原始消息开始，然后在 Message 对象（我的意思是 System.ServiceModel.Channels.Message）中创建它。确保为它设置了所有必要的标头，具体取决于您希望用于调用客户端的绑定（例如设置正确的凭据、正确的 MessageVersion 等）。

然后，您可以使用标准的通用通道形状之一（如 IRequestChannel 或 IInputChannel（用于单向服务））简单地创建通道工厂，并使用通道工厂创建新通道并调用服务。即类似的东西：

```
Message input = Message.CreateMessage( .... );

ChannelFactory<IRequestChannel> factory = new ChannelFactory<IRequestChannel>(binding, endpoint);
IRequestChannel channel - factory.CreateChannel();

Message output = channel.Send(input); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-01T09:21:14.707

如果您知道合同，那么您可以执行以下操作：

```
using (WebChannelFactory<IService> wcf = new WebChannelFactory<IService>(new Uri("http://localhost:8000/Web"))) 
```

更多[在这里](http://msdn.microsoft.com/en-us/library/bb412196.aspx)

# php - php中未定义的变量

> ID：156835
> 
> 赞同：0
> 
> 时间：2008-10-01T09:15:20.227
> 
> 标签：php, undefined

我继承了一些自定义 CMS 的代码，这有点超出我的范围，并且一直在遇到同样的错误，注意：未定义变量：/Applications/MAMP/htdocs/Chapman/Chapman_cms/admin/team-2.php 中的媒体在第 48 行。这应该是创建新用户和编辑旧用户。但是，当我尝试添加新用户时它不起作用。

以下是相关代码：

```
$db = new database("mysql",$dbHost,$dbName,$dbUser,$dbPass);
$target = 'add';
if ($_GET['task'] == 'edit') {
$media = $db->get_row(edit_media_item($db, $_GET['team_id']));
$target = 'update';

<p><label for="copy">Full Name:</label>
    <input type="text" name="title" value="<?=$media['title']?>" />
    <textarea name="media" id="media" cols="30" rows="5" style="width: 100%"><?=$media['copy']?></textarea></p>
    <input type="hidden" name="process" value="<?=$target.",copy,4,team-1,".$media['id'].""?>">
    <p><input type="submit" name="save" value="Submit" />
    <input type="reset" name="reset" value="Reset" /></p>
    </form> 
```

任何帮助将非常感激。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-01T09:53:53.630

以正确的方式删除通知是使用代码执行此操作

```
<?php if(isset($media['copy'])){ echo $media['copy']; } ?> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-01T09:19:33.743

可能很难像这样帮助你，但是，我会看到这个 $db->get_row() 调用去哪里以及它返回什么（使用 var_dump() 或其他东西......）

作为一般提示，我建议在您的系统中设置调试器，以便您可以跟踪调用。在 Windows 平台上，当我不确定调用层次结构时，我使用 xdebug 和 WinCacheGrind 来跟踪调用。在 Linux 上，设置类似（xdebug、kcachegrind...）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-01T09:16:43.407

该通知无关紧要，但此代码不会创建任何内容。这发生在它提交到的页面上。查看前几行的 if 语句。我猜你需要在 URL 中使用 task=edit 来调用它。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-01T19:53:11.910

you can also use the at symbol like this:

```
if($_GET['undefined_key']) {
    // blah...
}

if(@$_GET['undefined_key']) {
    // blah...
} 
```

it suppresses warnings, however some will argue that the best time to use the at symbol is to avoid warnings you couldn't do otherwise.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-01T09:41:38.167

您发布的代码没有进行任何创建，因此该问题并非源于这段代码。

未定义的通知来自`<?=$media['copy']?>`位。$media 从未被定义。如果这不是问题，忽略它并告诉 PHP 不要输出通知。这不是一个好的做法，但如果你没有得到报酬来解决每一件小事，我会说这是一个可行的选择。

要禁止通知，请在通知发生之前的任何位置添加此代码，或者更好地添加到全局包括：

```
error_reporting(E_ERROR | E_WARNING | E_PARSE); 
```

欲了解更多信息：[http ://www.php.net/error_reporting](http://www.php.net/error_reporting)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-02T08:09:04.933

该错误消息不是来自此代码。

`$media`在您提供的代码的第 6 行中分配 ( `$media = $db->get_row(..)`)。我猜你要么已经删除了相关代码（这是第 48 行，给予/接受），要么是错误的文件（这是来自`/Applications/MAMP/htdocs/Chapman/Chapman_cms/admin/team-2.php`？）。

# java - 根据在另一个组合框中选择的内容，使用 Map 中的值动态填充组合框

> ID：156852
> 
> 赞同：1
> 
> 时间：2008-10-01T09:23:09.693
> 
> 标签：java, javascript, combobox, maps

好的，这是 Java/JavaScript 专家的一个：

在我的应用程序中，其中一个控制器将 TreeMap 传递给它的 JSP。该映射将汽车制造商的名称作为键，将汽车对象列表作为值。这些 Car 对象是包含汽车名称、ID、生产年份等的简单 bean。因此，地图看起来像这样（这只是一个示例，为了澄清一点）：

键：保时捷
值：包含三个汽车对象的列表（例如 911、Carrera、Boxter 及其可敬的生产年限和 ID）
键：菲亚特
值：包含两个汽车对象的列表（例如，Punto 和 Uno）
等...

现在，在我的 JSP 中，我有两个组合框。一个应该收到汽车制造商的列表（地图上的键 - 这部分我知道该怎么做），另一个应该在用户从第一个组合框中选择某个制造商时**动态更改以显示汽车的名称。**因此，例如，用户在第一个组合框中选择“Porsche”，第二个组合框中立即显示“911，Carrera，Boxter”......

在花了几天试图找出如何做到这一点之后，我准备承认失败。我尝试了很多不同的东西，但每次我都会在路上的某个地方碰壁。有人可以建议我应该如何处理这个吗？是的，我是 JavaScript 新手，如果有人想知道...

编辑：我已将此重新标记为代码挑战。感谢任何在不使用任何 JavaScript 框架（如 JQuery）的情况下解决此问题的人。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-07T15:56:09.643

我只是喜欢挑战。

没有 jQuery，只是普通的 javascript，在 Safari 上测试过。

我想提前补充以下几点：

*   由于错误检查，它很长。
*   生成两个部分；带有 Map 的第一个脚本节点和制造商 SELECT 的内容
*   适用于我的机器 (TM) (Safari/OS X)
*   没有应用（css）样式。我的胃口不好，反正也没用。

.

```
<body>
  <script>
  // DYNAMIC
  // Generate in JSP
  // You can put the script tag in the body
  var modelsPerManufacturer = {
    'porsche' : [ 'boxter', '911', 'carrera' ],
    'fiat': [ 'punto', 'uno' ]  
  };
  </script>

  <script>
  // STATIC
  function setSelectOptionsForModels(modelArray) {
    var selectBox = document.myForm.models;

    for (i = selectBox.length - 1; i>= 0; i--) {
    // Bottom-up for less flicker
    selectBox.remove(i);  
    }

    for (i = 0; i< modelArray.length; i++) {
     var text = modelArray[i];
      var opt = new Option(text,text, false, false);
      selectBox.add(opt);
    }  
  }

  function setModels() {
    var index = document.myForm.manufacturer.selectedIndex;
    if (index == -1) {
    return;
    }

    var manufacturerOption = document.myForm.manufacturer.options[index];
    if (!manufacturerOption) {
      // Strange, the form does not have an option with given index.
      return;
    }
    manufacturer = manufacturerOption.value;

    var modelsForManufacturer = modelsPerManufacturer[manufacturer];
    if (!modelsForManufacturer) {
      // This modelsForManufacturer is not in the modelsPerManufacturer map
      return; // or alert
    }   
    setSelectOptionsForModels(modelsForManufacturer);
  }

  function modelSelected() {
    var index = document.myForm.models.selectedIndex;
    if (index == -1) {
      return;
    }
    alert("You selected " + document.myForm.models.options[index].value);
  }
  </script>
  <form name="myForm">
    <select onchange="setModels()" id="manufacturer" size="5">
      <!-- Options generated by the JSP -->
      <!-- value is index of the modelsPerManufacturer map -->
      <option value="porsche">Porsche</option>
      <option value="fiat">Fiat</option>
    </select>

    <select onChange="modelSelected()" id="models" size="5">
      <!-- Filled dynamically by setModels -->
    </select>
  </form>

</body> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-09T13:38:21.700

无论如何，正如我所说，我终于设法自己做到了，所以这是我的答案......

我像这样从我的控制器收到地图（我正在使用 Spring，不知道这如何与其他框架一起使用）：

```
<c:set var="manufacturersAndModels" scope="page" value="${MANUFACTURERS_AND_MODELS_MAP}"/> 
```

这些是我的组合：

```
<select id="manufacturersList" name="manufacturersList" onchange="populateModelsCombo(this.options[this.selectedIndex].index);" >
                  <c:forEach var="manufacturersItem" items="<%= manufacturers%>">
                    <option value='<c:out value="${manufacturersItem}" />'><c:out value="${manufacturersItem}" /></option>
                  </c:forEach>
                </select> 
```

```
select id="modelsList" name="modelsList"
                  <c:forEach var="model" items="<%= models %>" >
                    <option value='<c:out value="${model}" />'><c:out value="${model}" /></option>
                  </c:forEach>
                </select> 
```

我导入了以下类（当然，有些名称已更改）：

```
<%@ page import="org.mycompany.Car,java.util.Map,java.util.TreeMap,java.util.List,java.util.ArrayList,java.util.Set,java.util.Iterator;" %> 
```

这是完成所有艰苦工作的代码：

```
<script type="text/javascript">
<%  
     Map mansAndModels = new TreeMap();
     mansAndModels = (TreeMap) pageContext.getAttribute("manufacturersAndModels");
     Set manufacturers = mansAndModels.keySet(); //We'll use this one to populate the first combo
     Object[] manufacturersArray = manufacturers.toArray();

     List cars;
     List models = new ArrayList(); //We'll populate the second combo the first time the page is displayed with this list

 //initial second combo population
     cars = (List) mansAndModels.get(manufacturersArray[0]);

     for(Iterator iter = cars.iterator(); iter.hasNext();) {

       Car car = (Car) iter.next();
       models.add(car.getModel());
     }
%>

function populateModelsCombo(key) {
  var modelsArray = new Array();

  //Here goes the tricky part, we populate a two-dimensional javascript array with values from the map
<%                          
     for(int i = 0; i < manufacturersArray.length; i++) {

       cars = (List) mansAndModels.get(manufacturersArray[i]);
       Iterator carsIterator = cars.iterator();           
%>
    singleManufacturerModelsArray = new Array();
<%
    for(int j = 0; carsIterator.hasNext(); j++) {

      Car car = (Car) carsIterator.next();

 %>         
    singleManufacturerModelsArray[<%= j%>] = "<%= car.getModel()%>";
 <%
       }
 %>
  modelsArray[<%= i%>] = singleManufacturerModelsArray;
 <%
     }         
 %>   

  var modelsList = document.getElementById("modelsList");

  //Empty the second combo
  while(modelsList.hasChildNodes()) {
    modelsList.removeChild(modelsList.childNodes[0]);
  }

 //Populate the second combo with new values
  for (i = 0; i < modelsArray[key].length; i++) {

    modelsList.options[i] = new Option(modelsArray[key][i], modelsArray[key][i]);
  }      
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-01T09:30:07.477

你在使用 Struts 吗？

您将需要一些 JavaScript 技巧（或 AJAX）来完成此操作。

您需要做的是，在您的 JavaScript 代码中的某处（暂时不考虑如何生成它）：

```
var map = {
   'porsche': [ 'boxter', '911', 'carrera' ],
   'fiat': ['punto', 'uno']
}; 
```

这基本上是您的服务器端数据结构的副本，即由制造商键入的地图，每个值都有一个汽车类型数组。

然后，在制造商的 onchange 事件中，您需要从上面定义的映射中获取数组，然后从中创建一个选项列表。（查看 devguru.com - 它有很多关于标准 JavaScript 对象的有用信息）。

但是，根据您的汽车清单有多大，最好走 AJAX 路线。

您需要创建一个新控制器来查找给定制造商的汽车类型列表，然后转发到返回[JSON](http://www.json.org/)的 JSP （它不必是 JSON，但它对我来说效果很好）。

然后，使用[jQuery](http://jquery.com/)之类的库在您的 onchange 事件中检索汽车列表以获取制造商列表。（jQuery 是一个优秀的 JavaScript 框架——它确实使 JavaScript 开发变得更加容易。文档非常好）。

我希望其中一些有意义？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-08T17:34:11.333

这是一个在 jsp 中工作的、剪切和粘贴的答案，没有任何标记库或外部依赖项。带有模型的地图是硬编码的，但不会造成任何问题。

我将此答案与我之前的答案分开，因为添加的 JSP 不会提高可读性。而在“现实生活”中，我不会用所有嵌入式逻辑来负担我的 JSP，而是将它放在某个类中。或者使用标签。

所有这些“第一”的东西都是为了防止生成的代码中出现多余的“，”。使用 foreach 不会为您提供有关元素数量的任何知识，因此您检查最后一个。您还可以跳过第一个元素处理，然后通过将构建器长度减少 1 来去除最后一个“，”。

```
<%@ page language="java" contentType="text/html; charset=ISO-8859-1"
    pageEncoding="ISO-8859-1"%>
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">

<%@page import="java.util.Map"%>
<%@page import="java.util.TreeMap"%>
<%@page import="java.util.Arrays"%>
<%@page import="java.util.Collection"%>
<%@page import="java.util.List"%>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title>Challenge</title>
</head>
<body onload="setModels()">
<% // You would get your map some other way.
    Map<String,List<String>> map = new TreeMap<String,List<String>>();
    map.put("porsche", Arrays.asList(new String[]{"911", "Carrera"}));
    map.put("mercedes", Arrays.asList(new String[]{"foo", "bar"}));
%>

<%! // You may wish to put this in a class
  public String modelsToJavascriptList(Collection<String> items) {
    StringBuilder builder = new StringBuilder();
    builder.append('[');
    boolean first = true;
    for (String item : items) {
        if (!first) {
          builder.append(',');
        } else {
          first = false;
        }
        builder.append('\'').append(item).append('\'');
    }
    builder.append(']');
    return builder.toString();
  }

  public String mfMapToString(Map<String,List<String>> mfmap) {
    StringBuilder builder = new StringBuilder();
    builder.append('{');
    boolean first = true;
    for (String mf : mfmap.keySet()) {
      if (!first) {
          builder.append(',');
      } else {
          first = false;
      }
      builder.append('\'').append(mf).append('\'');
      builder.append(" : ");
      builder.append( modelsToJavascriptList(mfmap.get(mf)) );
    }
    builder.append("};");
    return builder.toString();
  }
%>

<script>
var modelsPerManufacturer =<%= mfMapToString(map) %>
  function setSelectOptionsForModels(modelArray) {
    var selectBox = document.myForm.models;

    for (i = selectBox.length - 1; i>= 0; i--) {
    // Bottom-up for less flicker
    selectBox.remove(i);
    }

    for (i = 0; i< modelArray.length; i++) {
     var text = modelArray[i];
      var opt = new Option(text,text, false, false);
      selectBox.add(opt);
    }
  }

  function setModels() {
    var index = document.myForm.manufacturer.selectedIndex;
    if (index == -1) {
    return;
    }

    var manufacturerOption = document.myForm.manufacturer.options[index];
    if (!manufacturerOption) {
      // Strange, the form does not have an option with given index.
      return;
    }
    manufacturer = manufacturerOption.value;

    var modelsForManufacturer = modelsPerManufacturer[manufacturer];
    if (!modelsForManufacturer) {
      // This modelsForManufacturer is not in the modelsPerManufacturer map
      return; // or alert
    }
    setSelectOptionsForModels(modelsForManufacturer);
  }

  function modelSelected() {
    var index = document.myForm.models.selectedIndex;
    if (index == -1) {
      return;
    }
    alert("You selected " + document.myForm.models.options[index].value);
  }
  </script>
  <form name="myForm">
    <select onchange="setModels()" id="manufacturer" size="5">
      <% boolean first = true;
         for (String mf : map.keySet()) { %>
          <option value="<%= mf %>" <%= first ? "SELECTED" : "" %>><%= mf %></option>
      <%   first = false;
         } %>
    </select>

    <select onChange="modelSelected()" id="models" size="5">
      <!-- Filled dynamically by setModels -->
    </select>
  </form>

</body>
</html> 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-02T02:19:14.947

像这样的东西怎么样，使用原型？首先，您选择的类别框：

```
<SELECT onchange="changeCategory(this.options[this.selectedIndex].value); return false;">
   <OPTION value="#categoryID#">#category#</OPTION>
   ... 
```

然后，您输出 N 个不同的选择框，每个子类别一个：

```
<SELECT name="myFormVar" class="categorySelect">
... 
```

您的 changeCategory javascript 函数禁用所有具有类 categorySelect 的选择，然后仅启用当前 categoryID 的选择。

```
// Hide all category select boxes except the new one
function changeCategory(categoryID) {

   $$("select.categorySelect").each(function (select) {
      select.hide();
      select.disable();
   });

   $(categoryID).show();
   $(categoryID).enable();
} 
```

当您在原型中像这样隐藏/禁用时，它不仅将其隐藏在页面上，而且还会阻止该 FORM 变量发布。因此，即使您有 N 个具有相同 FORM 变量名称 (myFormVar) 的选择，也只有活动的一个帖子。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-03T11:10:49.793

不久前，我想到了类似的事情。

使用 jQuery 和 TexoTela 插件并没有那么困难。

首先，你有一个像上面提到的地图这样的数据结构：

```
var map = {
   'porsche': [ 'boxter', '911', 'carrera' ],
   'fiat': ['punto', 'uno']
}; 
```

您的 HTML 应该类似于：

```
<select size="4" id="manufacturers">
</select>
<select size="4" id="models">
</select> 
```

然后，用 jQuery 代码填充第一个组合，例如：

```
$(document).ready(
  function() {
    $("#bronsysteem").change( manufacturerSelected() );
  } );
); 
```

其中manufacturerSelected 是在onChange 事件上注册的回调

```
function manufacturerSelected() {
  newSelection = $("#manufacturers").selectedValues();
  if (newSelection.length != 1) {
    alert("Expected a selection!");
    return; 
  }
  newSelection = newSelection[0];
  fillModels(newSelection);     
}

function fillModels(manufacterer) {
    var models = map[manufacturer];

    $("models").removeOption(/./); // Empty combo

    for(modelId in models) {
       model = models[modelId];
       $("models").addOption(model,model); // Value, Text
    }
} 
```

这应该可以解决问题。

请注意，其中可能存在语法错误；我已经编辑了我的代码以反映您的用例，并且不得不删除很多内容。

如果这有帮助，我将不胜感激。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-04T13:27:24.190

作为我之前帖子的附加内容；您可以在您的 JSP 中放置一个脚本标签，以便在您的地图上进行迭代。[可以在 Struts](http://www.onjava.com/pub/a/onjava/2003/07/30/jakartastruts.html?page=2)中的 Maps 中找到有关迭代地图的示例。

您想要实现的（如果您不关心表单提交）是我认为是这样的：

```
<script>
  var map = {
  <logic:iterate id="entry" name="myForm" property="myMap">
     '<bean:write name=" user" property="key"/>' : [
     <logic:iterate id="model" name="entry" property="value">
       '<bean:write name=" model" property="name"/>' ,
     </logic:iterate>
     ] ,
 </logic:iterate>
  };
</script> 
```

你仍然有一些多余的“”，你可能希望阻止它，但我认为这应该可以解决问题。

# c# - CE 6.0 设备（作为服务器）和 PC（作为客户端）之间如何通信

> ID：156860
> 
> 赞同：1
> 
> 时间：2008-10-01T09:28:11.727
> 
> 标签：c#, embedded, windows-ce, communication

我们正在开发一种测量设备，它将在 x86 嵌入式硬件上运行 CE 6.0 和 CF 3.5，PC 用于控制设备并使用以太网与其连接。

我们希望使用接口（使用 DCOM（我们知道 CE6 默认不支持它）、.NET Remoting 或 Web 服务）进行通信，而不是使用某种（自定义）协议。调用接口中定义的方法比解析原始数据更容易和优雅。

在这种情况下，最好的解决方案是什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-01T10:15:58.023

如果您使用的是 CE 6 和 .NET Compact Framework 3.5，您是否考虑过使用 Windows Communication Foundation (WCF)？您必须编写自己的传输，但完成后，您将能够相对轻松地使用您的服务接口。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-01T09:44:39.127

我有一些在 CE 设备和 PC 之间设置通信的经验，并且使用过使用 winsock 的自定义接口（来回处理一些字节）并尝试过 SOAP。在 Windows CE 5.0 中，微软提供的 SOAP 服务器每隔几个小时左右就会以某种方式关闭我们的设备。我花了好几个星期试图找出问题所在，认为这是我做错了。所以，我现在更喜欢坚持使用winsock，因为至少我有机会知道发生了什么并且可以修复它。

此外，根据您拥有的硬件，CE 设备并不总是表现最快的。Web 服务将数据转换为 XML 会占用一些开销和时间，这可能会影响您或无法承受的性能。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-15T14:30:26.540

与 Scott 一样，出于性能和稳定性的原因，我们走上了使用基于套接字的通信的道路。该代码适用于从 Windows CE 2.1 到 mobile 6.0 的所有设备。我发现 Windows CE 开发人员手册 ISBN 0-7821-2414-3 在开发此功能时非常有用，尽管使用的是 C++ 而不是 C#。

# database - 如何优化 PostgreSQL 配置？（有可用的工具吗？）

> ID：156866
> 
> 赞同：3
> 
> 时间：2008-10-01T09:30:16.853
> 
> 标签：database, optimization, postgresql

在 postgresql 中，您可以根据自己的性能需求对其进行大量优化。内存使用的设置仍然很容易，但是对于其他选项，例如用于查询优化器的 CPU 和 IO 的成本因素，对我来说是一个谜。我想知道是否有可用**的程序**可以对您的硬件（CPU 速度、内存性能、硬盘速度）进行基准测试，分析您的数据库并为这个特定环境提出最佳配置？

编辑：

让我澄清一下，我知道如何使用索引和基本内存设置调整我的数据库。我还可以找出要调整哪些设置以获得更好的性能，**但是**：我没有时间，所以我想要一个工具来为我找到这个。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-01T11:00:04.673

[从这里](http://wiki.postgresql.org/wiki/Performance_Optimization)开始。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-01T09:53:24.363

不是我所知道的，但下一个最好的事情是[GUCs: A Three Hour Tour](http://www.pgcon.org/2008/schedule/events/104.en.html) Presentation。您可以从那里下载[PDF](http://www.pgcon.org/2008/schedule/attachments/44_annotated_gucs_draft1.pdf)，其中根据您的系统资源给出了设置的推荐值。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-01T09:58:08.143

了解索引是大多数人在尝试提高任何数据库性能时应该开始的地方。

# development-environment - 适用于移动设备的良好模拟软件

> ID：156871
> 
> 赞同：1
> 
> 时间：2008-10-01T09:34:07.953
> 
> 标签：development-environment, mobile-phones

任何人都可以为移动设备推荐好的模拟软件吗？我对诺基亚智能手机最感兴趣。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-01T09:53:54.177

您在寻找诺基亚手机的模拟器吗？你可以在[这里](http://www.forum.nokia.com/main/resources/tools_and_sdks/listings/)找到那些..

否则请清楚说明您正在寻找什么样的模拟软件！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-02T12:48:17.977

诺基亚 S60 SDK 有一个可以在 pc 上运行的模拟器。

[http://www.forum.nokia.com/main/resources/tools_and_sdks/](http://www.forum.nokia.com/main/resources/tools_and_sdks/)

Symbian 手机可以用多种语言进行编程，而不仅仅是 Symbian C++。有 OpenC、Ruby、Py60 (Python)、Web 编程，当然还有各种 Java。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-01T11:03:16.413

好的，我正在展示我的移动开发新手。我说的是仿真而不是模拟。

我正在考虑将应用程序移植到手机平台，并且喜欢诺基亚智能手机的外观（并且在我的市场中无处不在），我认为它运行 Symbian。我想做的是通过在本地创建一个开发环境来进行实验，但我有点迷茫，需要一些指导才能开始。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-02T13:13:14.937

你说的对！诺基亚手机在 Symbian 平台上运行。

那里有很多变体，但[S60](http://www.s60.com/life)更好。UIQ 最近做得不太好。

阅读[**使用 S60 进行开发**](http://www.s60.com/life/thisiss60/S60forbusiness/developers)

[您可以从forum.nokia.com](http://www.forum.nokia.com/main/resources/tools_and_sdks/)下载 SDK 。所以模拟器附带了开发工具包。您可以尝试在模拟器上构建和运行示例以获得第一手感觉。

不幸的是，为 Symbian 开发并不是随随便便的。你可以在这里得到一些开发者的感受：

*   [塞班操作系统](https://stackoverflow.com/questions/36685/symbian-os)

或者，您可以查找 Windows Mobile。如果您有任何领域的先验知识[Win32、MFC 或 .NET C#]，那么它的学习曲线非常简单

[**Windows Mobile 入门**](http://msdn.microsoft.com/en-us/windowsmobile/bb264329.aspx)

或者如果您熟悉 Java，请查看[**J2ME**](http://java.sun.com/products/sjwtoolkit/)。它有一个带有不错模拟器的无线工具包。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-22T15:07:32.420

一个相关的无耻插件。

Symbian Press 最近出版的一本书针对的是刚接触移动开发的开发人员。

它会引导您逐步完成 2 周的学习曲线，并且可以极大地帮助移植工作。

[http://developer.symbian.com/quick](http://developer.symbian.com/quick)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-12T10:49:15.747

需要明确的是，并非所有诺基亚手机都运行 Symbian。只有 60 系列智能手机设备运行 Symbian，低端 40 系列设备运行专有操作系统。最好的办法是使用[WURFL](http://wurfl.sourceforge.net/index.php)来确定每个设备的功能。

诺基亚 S60 仿真器的好处在于它们与 Eclipse 和 Netbeans 的集成度非常好。我个人使用 Eclispe 和 S60 模拟器来开发 J2ME 应用程序，而且设置起来非常简单。

# python - Python中的自定义命令行解析

> ID：156873
> 
> 赞同：7
> 
> 时间：2008-10-01T09:35:36.013
> 
> 标签：python, parsing, shell, command-line, arguments

我正在为我的一个项目编写一个 shell，它通过设计解析如下所示的命令：

COMMAND_NAME ARG1="长值" ARG2=123 ARG3=me@me.com

我的问题是 Python 的命令行解析库（getopt 和 optparse）迫使我在参数前使用“-”或“--”。这种行为不符合我的要求。

任何想法如何解决？任何现有的图书馆？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-01T10:09:19.990

您可以使用 shlex.split() 将它们拆分，它可以处理您拥有的引用值，并使用非常简单的正则表达式很容易地解析它。或者，您可以只使用正则表达式进行拆分和解析。或者干脆使用 split()。

```
args = {}
for arg in shlex.split(cmdln_args):
    key, value = arg.split('=', 1)
    args[key] = value 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-10-01T10:57:17.283

1.  尝试遵循“[命令行界面标准](http://www.gnu.org/prep/standards/standards.html#Command_002dLine-Interfaces)”

2.  将您的参数（如 Thomas 建议的那样）转换为 OptionParser 格式。

    ```
    parser.parse_args(["--"+p if "=" in p else p for p in sys.argv[1:]]) 
    ```

如果命令行参数不在 sys.argv 或类似列表中，而是在字符串中，则（如 ironfroggy 建议的那样）使用`shlex.split()`.

```
parser.parse_args(["--"+p if "=" in p else p for p in shlex.split(argsline)]) 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-01T10:48:45.230

Ironforggy 的 shlex 答案的一个小的 Pythonic 变体：

```
args = dict( arg.split('=', 1) for arg in shlex.split(cmdln_args) ) 
```

哎呀... - 更正。

谢谢，JF Sebastian（记住那些单参数生成器表达式）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-11-19T00:30:04.627

optmatch（[http://www.coderazzi.net/python/optmatch/index.htm](http://www.coderazzi.net/python/optmatch/index.htm)）呢？不是标准的，但对选项解析采用不同的方法，它支持任何前缀：

OptionMatcher.setMode(optionPrefix='-')

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-01T09:50:33.717

如果没有对 optparse 或 getopt 进行相当密集的手术，我不相信您可以明智地让它们解析您的格式。不过，您可以轻松解析自己的格式，或将其转换为 optparse 可以处理的格式：

```
parser = optparse.OptionParser()
parser.add_option("--ARG1", dest="arg1", help="....")
parser.add_option(...)
...
newargs = sys.argv[:1]
for idx, arg in enumerate(sys.argv[1:])
    parts = arg.split('=', 1)
    if len(parts) < 2:
        # End of options, don't translate the rest. 
        newargs.extend(sys.argv[idx+1:])
        break
    argname, argvalue = parts
    newargs.extend(["--%s" % argname, argvalue])

parser.parse_args(newargs) 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-04-16T14:18:42.670

派对迟到了……但[PEP 389](http://www.python.org/dev/peps/pep-0389/)允许这样做以及更多。

如果您的 Python 版本需要，这里有一个不错的库 code.google.com/p/argparse

享受。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2011-02-06T14:17:52.713

您可能对我编写的一个小 Python 模块感兴趣，它可以使命令行参数的处理更加容易（开源且免费使用）- [http://freshmeat.net/projects/commando](http://freshmeat.net/projects/commando)

# wcf - 控制 WCF XmlSerializer

> ID：156880
> 
> 赞同：2
> 
> 时间：2008-10-01T09:40:39.713
> 
> 标签：wcf, xml-serialization

我在 WCF 中实现了一些 REST Web 服务。当 xml 包含无效元素时，我希望这些服务返回“错误请求”。

xml 序列化由 XmlSerializer 处理。默认情况下 XmlSerializer 忽略未知元素。我知道可以挂钩 XmlSerializer.UnknownElement 并从此处理程序抛出异常，但因为这是在 WCF 中，所以我无法控制序列化。任何想法我如何实现这种行为。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-07-01T11:30:34.640

*“我知道可以挂钩 XmlSerializer.UnknownElement 并从此处理程序抛出异常，但因为这是在 WCF 中，我无法控制序列化”*

它实际上可以做到这一点......

在我从事的一个 WCF 项目中，我们使用 IDispatchMessageFormatter 接口做了类似的事情。

更多信息可以在这里找到[http://nayyeri.net/blog/use-idispatchmessageformatter-and-iclientmessageformatter-to-customize-messages-in-wcf/](http://nayyeri.net/blog/use-idispatchmessageformatter-and-iclientmessageformatter-to-customize-messages-in-wcf/)

它允许您在消息头中达到峰值，控制序列化/反序列化，返回状态代码等。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-02T16:15:28.323

也许您可以返回您自己的实现 IXmlSerializable 的类型，并在 ReadXml 和 WriteXml 方法中抛出您想要的异常......

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-02T16:31:35.380

这是来自模糊的记忆，因为我手头没有所有代码，但是您可以创建自定义消息（继承“消息”类）类型以在 REST 服务中返回并覆盖某些方法以创建自定义响应。

```
 protected override void OnWriteMessage(XmlDictionaryWriter writer)
    {
        ...
    }

    protected override void OnWriteStartEnvelope(XmlDictionaryWriter writer)
    {
        ...
    }

    protected override void OnWriteStartBody(XmlDictionaryWriter writer)
    {
        ...
    }

    protected override void OnWriteBodyContents(XmlDictionaryWriter writer)
    {
        ...
    } 
```

不是一个完整的答案，但可能会将您推向正确的道路。

# sql - 我可以配置休眠属性以在不使用实例名称的情况下连接到 sql server 2005 吗？

> ID：156885
> 
> 赞同：1
> 
> 时间：2008-10-01T09:42:44.123
> 
> 标签：sql, sql-server, sql-server-2005, hibernate

我可以配置休眠属性以在不使用实例名称的情况下连接到 sql server 2005 吗？我需要强制它使用 localhost 作为主机名而不是指定实例（与使用 sql server 企业管理器相同）。

塔！

吨

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-01T09:49:45.217

是的你可以。您可以像往常一样在连接字符串中进行设置：

> 服务器=（本地）；初始目录=MyDataBase；集成安全=SSPI

# php - 您如何将现有的网络应用程序转换为多语言应用程序？

> ID：156911
> 
> 赞同：23
> 
> 时间：2008-10-01T09:54:16.407
> 
> 标签：php, symfony, internationalization

我将从事一个项目，其中需要调整一个相当大的网络应用程序以处理多种语言。这个东西使用手工制作的 PHP 代码运行，但它非常干净。

我想知道最好的方法是什么？

1.  我自己做一些东西，试图适应实际的架构。

2.  使用将为我管理 i18n 的框架（例如 Symfony）重写它的大部分内容？

对于选项 1，我应该在哪里存储 i18n 数据？*.po、xliff、纯数据库？

我想到了一个替代方案：仅使用 Symfony 进行翻译，但将控制器设置为按原样加载网站。很快，但很脏。另一方面，它允许我们进行下一次修改，慢慢地转向完整的 Symfony：这个网站确实是一个很好的候选者。

但也许有一些独立的翻译引擎会比整个 Web 框架做得更好。这有点像用火箭筒杀死苍蝇……

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-10-01T09:57:30.767

使用语言文件。

1.  用变量替换每个文本字符串
2.  为每种语言创建一个语言文件，并在其中定义每个变量及其对应的文本。（法语.inc，荷兰语.inc ...）
3.  在每个页面中包含正确的文件。

这适用于小型网站。

如果变大，请用数据库替换文件。:)

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-10-25T07:50:34.413

有很多方法可以解决这个问题。它们都不是“最好的方法”，而且它们都存在短期或长期的问题。首先要说的是，多语言网站并不容易，翻译人员和可爱的人但很难与之合作，大多数程序员仅将问题视为技术问题。在此答案的范围之外，还有另一个维度，即您是在翻译还是本地化。这涉及查看目标受众的文化习俗，然后根据该文化定制语言、风格、布局、颜色、字体等。最后不要使用 MT，机器翻译，

对。解决方案。在您不想重写站点的基础上，只需克隆您拥有的站点并将副本翻译成目标语言。假设代码库是稳定的，您可以使用 VCS 来管理任何代码更改。您可以调整站点的各个部分以适应目标语言，例如法语文本平均比等效的英语文本大 30%，因此使用一个站点来提供这意味着您可能（将）遇到格式问题并需要交换一个根据语言输入和输出不同的 css 文件。这似乎是一种笨拙的方法，但是这些网站将存在多长时间？这样做的管理开销可能比其他选项要少。

第二种方式，无需重建。用标签替换当前站点中的所有内容，然后将不同的语言放入文件或数据库表中，嗅探用户所需的语言（您是否有注册用户可以进行偏好设置或者您是否想要获取浏览器语言标签，或者是它将是 URL dot-com dot-fr，dot-de 做出选择），然后用目标语言替换标签。然后，您需要分别解决尺寸问题和图像问题。当 Symfony 和 Zend 等框架实现 l10n 时，此解决方案有效。

然后您可以使用框架或 gettext 进行重建，并且可能有一个更简洁的解决方案，但请记住框架旨在解决其他问题，而不是翻译，并且翻译组件已作为部分解决方案而不是完整解决方案进入框架。

所有解决方案的最大问题是持续维护。因为您不仅有一个代码库，还有多个语言库需要维护。除非你们所有的解决方案都非常聪明和有效，否则持续的任务将很困难。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-10-25T08:09:51.863

重要的是要注意在翻译之前涉及两个步骤：

1.  国际化：即使您的网站能够处理多种语言
2.  本地化：这包括将您的文本（在步骤 1 中获得）翻译成您计划支持的每种语言

[在 Wikipedia 中查看更多信息](http://en.wikipedia.org/wiki/Internationalization_and_localization)。

第 1 步将要求您考虑到某些语言是从右到左 (RTL) 和非欧洲字符（如日语或中文）书写的事实。如果您不打算处理这些语言和字符，它可能会更简单。

对于这种情况，我希望有一个语言文件（实际上与我计划支持的语言一样多的语言文件，将每个文件命名`langcode.php`为 in`en.php`或`fr.php`），其中包含一个包含站点中使用的所有文本的关联数组。程序如下：

1.  扫描您的网站以查找应本地化的每一个文本
2.  对于每个页面/部分，我将创建一个`$lang['sectionname'][]`数组
3.  对于每个文本，我都会创建一个`$lang['sectionname']['textname']`条目
4.  我将创建一个`Lang.php`类，该类将在实例化时接收`lang`参数，但如果没有收到则将具有默认值`lang`（此方法加载`langcode.php`取决于参数或默认值取决于您的首选语言）
5.  该类将有一个`setPage()`方法可以接收您将显示的页面/部分
6.  该类将有一个`show()`方法来接收要显示的文本（`show()`将被调用多次，因为文本在给定页面中显示......`show()`作为一种包装器`echo $lang['mypage']['mytext']`）

通过这种方式，您可以以非常简单的方式拥有尽可能多的语言。您甚至可以有一个语言管理员，您可以在其中打开基本语言页面（实际上您只是递归地读取数组并将它们显示在 textareas 中），然后可以“另存为...”其他语言。

[我在我的站点](http://www.pingpongestudio.com/)中使用了类似的方法。虽然它只有一页，但我用这个想法制作了[多页网站。](http://www.placecomplaints.com/)

如果您有用户提交的内容或一些相当复杂的 CMS，那就另当别论了。您可以寻找对 i18n 友好的框架（想到 Drupal）。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-01T11:00:09.850

你可以看一下[Zend_Translate](http://framework.zend.com/manual/en/zend.translate.html)，它是一个非常全面、有据可查的文档，并且整体代码质量非常好。它还允许您使用统一的 API 来获取 gettext、csv、db、ini 文件、数组或任何您最终保存已翻译字符串的内容。

另外，请查看/观看此线程：[php 代码库的 i18n 有哪些好的工具/框架？](https://stackoverflow.com/questions/155706/what-are-good-toolsframeworks-for-i18n-of-a-php-codebase). 这似乎与您的问题相似。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-01T11:07:09.990

如果它支持多字节字符，那么可能值得检查 PHP 中的多字节字符串函数：

[http://uk.php.net/manual/en/book.mbstring.php](http://uk.php.net/manual/en/book.mbstring.php)

这些将更好地处理多字节字符。

* * *

## 回答 #6

> 赞同：-2
> 
> 时间：2009-10-25T04:31:39.887

我使用 hl 参数和 gettext 将已经存在的引擎翻译与自己的 .po 结合起来，当引擎或我的 django/gae[示例](http://classifiedsmarket.appspot.com)添加时，会出现新的翻译和语言：

```
{% get_current_language as LANGUAGE_CODE %}{{ LANGUAGE_CODE }}{% get_available_languages as LANGUAGES %}{% for LANGUAGE in LANGUAGES %}{% ifnotequal LANGUAGE_CODE LANGUAGE.0 %}{{ LANGUAGE.0 }}{% endifnotequal %}{% endfor %} 
```

[因此，避免重复并充分使用已经存在的翻译，在这里，当引擎团队添加或应用程序](http://montao.googlecode.com)时，丢失的例如阿拉伯月份名称会直接出现

# java - 将键盘事件从 java 发送到任何应用程序（屏幕键盘）

> ID：156912
> 
> 赞同：4
> 
> 时间：2008-10-01T09:55:55.717
> 
> 标签：java, events, swing, keyboard, java-native-interface

我正在用java开发一个屏幕键盘。该键盘具有`JComponent`适用于所有可能的键。当在按钮上检测到鼠标按下时，我想将特定的键盘代码发送到当前处于焦点的应用程序。键盘本身`JFrame`没有任何装饰，并设置为始终在顶部。

我发现 Robot 类可以用来模拟原生队列上的这些键盘事件。但是，在这种情况下，选择`JComponent`将意味着在 上接收到按键`JFrame`，而我将无法在其他应用程序中接收到它

如何让我的屏幕键盘“始终没有焦点”？是否可以使用另一种方法来发送按键？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-01-12T16:41:39.177

当我尝试使用实际的键盘和鼠标命令（更“像人”）来控制游戏机器人时，我发现[了 jnativehook 。](http://code.google.com/p/jnativehook/)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-09T14:24:40.047

到目前为止，我能找到的唯一解决方案是将每个键都设为 JComponent（因此它不能有焦点），并在 JFrame 上设置以下属性：

```
 setUndecorated(true);
    setFocusableWindowState(false);
    setFocusable(false);
    enableInputMethods(false); 
```

现在，当使用机器人类时，我可以通过单击键将事件发送到任何焦点窗口。唯一的限制是，它似乎只适用于属于同一虚拟机的窗口，它根本不适用于任何其他系统窗口。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-20T15:25:17.160

显然，做到这一点的唯一方法是拥有一个 JNI 层，它将从 java 转换为 native。Java 没有简单的方法来提供这样的功能。

对于想要学习 JNI 的人来说，这对于小型第三方库来说可能是一个有趣的概念......

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-01T11:15:08.660

在使用机器人类之前，您是否尝试过调用本机 setfocus() 或 setactivewindow() 函数来移动焦点？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-11T15:14:18.637

我不知道以独立于操作系统的方式执行此操作的任何方式。我不了解 Windows，但可以通过 X 协议与 X 服务器通信。

# linux - 文件系统“覆盖”

> ID：156913
> 
> 赞同：1
> 
> 时间：2008-10-01T09:56:02.923
> 
> 标签：linux, file, filesystems

**具体用例：** 在 Eclipse IDE 中，可以通过将插件的文件复制到`$ECLIPSE_HOME/plugins`目录中来添加新的“插件”。但是，我想在没有额外插件的情况下保持我原来的 Eclipse 安装“干净”，因为我有时想自己运行这个基本安装。

有什么方法可以避免复制文件（因此无法运行干净的版本），而是在逻辑上“覆盖”另一个目录的内容，使其在运行时看起来在目录中？

例如：

```
gravelld@gravelld-laptop:~$ ls $ECLIPSE_HOME/plugins/
org.junit_3.8.2.v200706111738
org.junit4_4.3.1
org.junit.source_3.8.2.v200706111738
gravelld@gravelld-laptop:~$ ls myplugins/
org.dangravell.myplugin.jar
gravelld@gravelld-laptop:~$ overlay myplugins/ $ECLIPSE_HOME/plugins
gravelld@gravelld-laptop:~$ ls $ECLIPSE_HOME/plugins/
org.dangravell.myplugin.jar
org.junit_3.8.2.v200706111738
org.junit4_4.3.1
org.junit.source_3.8.2.v200706111738 
```

另一个用例可能是补丁等等......

可以用符号链接或 mnt 来做些什么吗？

谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-05T03:47:08.027

您可以为此使用覆盖文件系统。我所知道的 Linux 中的三个覆盖文件系统是[unionfs](http://en.wikipedia.org/wiki/UnionFS)、[aufs](http://aufs.sourceforge.net/)和[minifo](http://www.denx.de/wiki/Know.MiniFOHome)。

Unionfs 包含在最近的 Ubuntu 内核中。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-01T11:26:32.190

查看**[管理您的 Eclipse 环境](http://www.ibm.com/developerworks/library/os-ecl-manage/)**一文，尤其是方法 3

> 创建链接文件夹来管理产品扩展
> 
> 如果您的文件系统上有产品扩展，就像我们在方法 1 中所做的那样，您可以在 Eclipse 程序目录中创建一些简单的文件，以通知 Eclipse 它需要检查这些目录中的插件。
> 
> 首先，在 Eclipse 安装文件夹（例如 /opt/eclipse）中创建一个名为 links 的目录。在此文件夹中，您可以创建 *.link 文件（例如，emfPlugins.link）。每个链接文件都指向一个产品扩展位置。Eclipse 将在启动时扫描此链接文件夹，并在链接文件指向的每个产品扩展中查找插件。

尽管新的 p2 供应系统完全不同，但 eclipse3.4 仍然支持这一点。

* * *

既然“'links'目录机制”是已知的，这意味着vanilla eclipse和带有自定义通用插件的eclipse之间的区别只是'links'目录的存在。

那么，为什么不使用内部带有符号链接的“vanilla eclipse 发行版”，“links”，指向 ../links 呢？

任何获得 vanilla eclipse 的用户起初都没有“链接”目录，因此它将作为 vanilla 发行版运行。但是一旦用户创建了一个链接目录或另一个符号链接到一个通用的远程“链接”目录，同一个发行版就会选择通用插件远程目录......

```
/path/links -> /remote/links/commonPlugins
/eclipse/links -> ../links 
```

* * *

最后，如果您使用给定组“aGroup”创建“/remote/links/commonPlugins”，并使用“750”掩码保护它，您将拥有*一个*Eclipse 设置，它将是：

*   'id -a' 不包括 'aGroup' 的任何用户的香草日食
*   带有“aGroup”任何用户部分的插件的eclipse

# linux - zsh/bash 上不区分大小写的 Glob

> ID：156916
> 
> 赞同：44
> 
> 时间：2008-10-01T09:56:39.973
> 
> 标签：linux, bash, zsh, glob

我需要列出名称以“SomeLongString”开头的所有文件。但是“SomeLongString”的情况可能会有所不同。如何？

我正在使用 zsh，但也欢迎使用 bash 解决方案。

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2008-10-01T12:50:20.507

郑州：

```
$ unsetopt CASE_GLOB 
```

或者，如果您一般不想启用不区分大小写的通配符，则可以仅为不同部分激活它：

```
$ print -l (#i)(somelongstring)* 
```

这将匹配任何以“somelongstring”开头的文件（小写/大写的任意组合）。不区分大小写标志适用于括号之间的所有内容，并且可以多次使用。阅读手册`zshexpn(1)`以获取更多信息。

**更新** 差点忘了，您必须启用扩展通配才能使其工作：

```
setopt extendedglob 
```

* * *

## 回答 #2

> 赞同：35
> 
> 时间：2008-10-01T10:11:26.537

重击：

```
shopt -s nocaseglob 
```

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2008-10-01T10:10:38.207

根据您希望获得此列表的深度，`find`在这方面提供了很多：

```
find . -iname 'SomeLongString*' -maxdepth 1 
```

这只会为您提供当前目录中的文件。这里重要的是`-iname`参数而不是`-name`.

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2011-10-01T04:11:23.097

```
 $ function i () {
> shopt -s nocaseglob; $*; shopt -u nocaseglob
> }
$ ls *jtweet*
ls: cannot access *jtweet*: No such file or directory
$ i ls *jtweet*
JTweet.pm  JTweet.pm~  JTweet2.pm  JTweet2.pm~ 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2019-11-05T04:38:47.180

为了完整起见（坦率地说，它还没有被提及，尽管所有其他答案都更好和/或“更正确”），显然也可以使用（尤其是对于`grep`爱好者）：

```
$ ls | egrep -i '^SomeLongString' 
```

一个也可能坚持冗余`ls -1`（这是选项“one”，而不是“ell”），但是当传递到管道时，每个条目已经将是每行一个，无论如何。我通常会`set`在 shell 脚本中使用这样的东西（vs），例如在`for`/`while`循环中：`for i in $(ls | grep -i ...)`。但是，在这种情况下，使用其他答案`find`会更可取且更灵活，因为例如，您可以省略目录（或设置其他限制）：`for i in $(find . -type f -iname 'SomeString*' -print -maxdepth 1)...`甚至完全放弃循环并仅使用`find`all 的力量，例如：`find ... -exec do_stuff {} \; ...`，但我确实离题了（再次，为了完整性。）

# asp.net - 经典 ASP Intranet 和新的 ASP.NET 应用程序

> ID：156930
> 
> 赞同：6
> 
> 时间：2008-10-01T10:00:25.377
> 
> 标签：asp.net, visual-studio, asp-classic

我们有一个由数百个页面组成的现有经典 ASP 内部网。它的目录结构是这样的……

```
/root
    app_1
    app_2
    ...
    img
    js
    style 
```

显然 app_1 等在实际目录结构中有更好的名称。

尽管许多应用程序具有不同的行为，但它们都是同一个 Intranet 的一部分，因此通过 /style 包含样式表、通过 /img 包含图像和通过 /js 包含客户端脚本，它们具有共同的外观和感觉。

当我想在 ASP.NET 中添加 Intranet 应用程序时，麻烦（至少对我来说）就来了。

最终，我想要这样的结构：

```
/root
    app_1
    app_2
    dotnetapp_1
    dotnetapp_2
    ...
    img
    js
    style 
```

在我看来，ASP.NET“应用程序”喜欢将自己与周围的一切分开（这可能只是我对它们的理解）。您在 Visual Studio 中创建了一个新的“项目”，就好像您在我想要使用的实际根目录之下有一个新的“根目录”。就像这个新应用程序是一个独立的东西，有自己的图像和风格等等。但是，我希望它成为现有 Intranet 的子部分。

最终，我希望能够使我的整个经典 ASP 内部网成为“根”，并拥有仍然可以访问 /style 和 /img 的 ASP.NET “子应用程序”，我想对于 ASP.NET，我将拥有 /masterpages .

我以前尝试过这个，但是当我将现有的 Intranet 根目录设置为 ASP.NET 项目根目录（通过 File->Open->网站）。我很乐意使用 VS 2008 SP1（我目前使用出色的[Notepad++](http://notepad-plus.sourceforge.net/uk/site.htm)）编辑我现有的经典 ASP 内部网，因为我想更多地使用 VS，但我想这不是绝对必要的。

我还尝试将每个新的 ASP.NET 应用程序单独视为一个应用程序，有效地将 /dotnetapp_1 目录作为应用程序的“根”目录（同样，通过 VS2008 中的文件->打开->网站）。但是，当我尝试引用 /masterpages 时，VS 会抱怨，因为它“属于另一个应用程序”。我想我通过在每个“指向”根 /masterpages 的 ASP.NET 目录中添加一个虚拟目录来解决它，但我不确定 VS 在我这样做时是否能够愉快地提供所见即所得的编辑，而不是制作副本我添加到 Intranet 的每个 ASP.NET 应用程序中的母版页。

我也很可能会访问 .NET MVC 框架，因此请在考虑到该框架的情况下提供任何答案。我希望“项目”对 MVC 来说不是很重要，而只是一堆文件，它们创建了一个对整体有贡献的应用程序（即 Intranet）。

所以，问题是：**如何最好地将 ASP.NET 应用程序添加到现有的经典 ASP 内部网（我不关心经典 ASP 和 ASP.NET 之间会话共享的技术细节，只关心目录的结构布局和项目），并能够在 Visual Studio 2008 SP1 中编辑这些单独的应用程序，并且通过通用的 Intranet 外观让这些应用程序彼此“相关”*？**

*   请不要只发布“使用 MasterPages”的答案。*我很欣赏 MasterPages 是 .NET 在同一*应用程序中的相关页面之间共享样式（并且更有可能）的方法。我明白了。我正在寻找的是尽可能顺利地将 ASP.NET 应用程序添加到现有 Intranet 的最佳方法，这使得编辑每个应用程序变得简单，并且每个应用程序都可以共享（如果可能的话）一个 Intranet 通用样式。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-01T12:25:11.973

由于 ASP.NET 现在是 Microsoft 标准 Web 开发平台，**您最好从一个全新的 ASP.NET 网站开始，然后将现有的 ASP 页面和文件夹**导入其中。一旦设置并运行，在 ASP.NET 中添加新功能将是一件轻而易举的事。

Microsoft 了解某些客户将在一段时间内混合使用经典 ASP 和 ASP.NET，他们通过使经典 ASP 页面在 ASP.NET 站点中工作来满足这种需求。您正在尝试做的是与此相反的事情（让 ASP.NET 在 ASP 中工作，排序），您已经遇到了困难。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-01T11:52:07.167

一种解决方案是使用 IIS 管理器来配置网站（由 Visual Studio 为您的 ASP.NET 应用程序创建）并为每个公共文件夹添加一个虚拟目录，以便（通过虚拟目录的“虚拟”性质）它们将“显示”在与您的 ASP.NET 应用程序相同的根文件夹中。

```
/root
  app_1
  app_2
  dotnetapp_1
    <virtual>img
    <virtual>js
  ...
  img
  js
  style 
```

如果您需要批量执行此操作，您可能可以编写 IIS 脚本或编辑 XML 文件，而且我确信必须有一种更优雅的方式来执行类似的操作，并且不需要太多的鼠标工作！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-12T18:42:45.370

您不能将 asp.net 站点作为虚拟目录运行吗？

```
www.site.com/dotnetapp/ 
```

dotnetapp 在哪里是一个完全独立的虚拟目录？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-26T05:56:42.140

几种不同的方法来解决这个问题：

1.  如果您列出的文件夹结构是所需的 Web 文件夹结构，那么您的任何 ASP.NET 应用程序都可以简单地引用 /root/js/whatever.js 或 ../js/whatever.js 并且它会到达您已经存在的文件夹有根。这是已经提到的虚拟目录解决方案的替代方案。这是一个相当混乱的解决方案，我在当前工作中继承的一些项目就是这样做的。
2.  在之前的工作中，我管理一个混合的经典 ASP/ASP.NET 应用程序几年，我通过在根目录下创建一个 ASP.NET Web 应用程序并将我所有的 ASP 页面移动到其中来做到这一点。您想要制作的任何“子应用程序”都应该只是这个单个项目中的文件夹。[ASP 页面在 VS2008 中不再有颜色编码，这真的很烦人。]

# c++ - 如何在不暴露使用的容器的情况下暴露迭代器？

> ID：156936
> 
> 赞同：24
> 
> 时间：2008-10-01T10:02:35.870
> 
> 标签：c++, stl, iterator, encapsulation

我已经使用 C# 有一段时间了，回到 C++ 是一件很头疼的事情。我正在尝试将我的一些实践从 C# 带到 C++，但我发现了一些阻力，我很乐意接受你的帮助。

我想为这样的类公开一个迭代器：

```
template <class T>
class MyContainer
{
public:
    // Here is the problem:
    // typedef for MyIterator without exposing std::vector publicly?

    MyIterator Begin() { return mHiddenContainerImpl.begin(); }
    MyIterator End() { return mHiddenContainerImpl.end(); }

private:
    std::vector<T> mHiddenContainerImpl;
}; 
```

我在尝试一些不成问题的事情吗？我应该只是 typedef std::vector< T >::iterator 吗？我希望只依赖于迭代器，而不是实现容器......

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-10-01T10:56:45.710

您可能会发现以下文章很有趣，因为它完全解决了您发布的问题：[关于 C++ 中面向对象和泛型编程之间的张力以及类型擦除可以做什么](http://www.artima.com/cppsource/type_erasure.html)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-01T14:07:52.083

我之前做过以下事情，所以我得到了一个独立于容器的迭代器。这可能有点矫枉过正，因为我也可以使用一个 API，调用者传入一个`vector<T*>&`应该填充所有元素的 API，然后调用者可以直接从向量中迭代。

```
template <class T>
class IterImpl
{
public:
    virtual T* next() = 0;
};

template <class T>
class Iter
{
public:
    Iter( IterImpl<T>* pImpl ):mpImpl(pImpl) {};
    Iter( Iter<T>& rIter ):mpImpl(pImpl) 
    {
        rIter.mpImpl = 0; // take ownership
    }
    ~Iter() {
        delete mpImpl; // does nothing if it is 0
    }
    T* next() {
    return mpImpl->next(); 
    }
private:
    IterImpl<T>* mpImpl; 
};

template <class C, class T>
class IterImplStl : public IterImpl<T>
{
public:
    IterImplStl( C& rC )
    :mrC( rC ),
    curr( rC.begin() )
    {}
    virtual T* next()
    {
    if ( curr == mrC.end() ) return 0;
    typename T* pResult = &*curr;
    ++curr;
    return pResult;
    }
private:
    C& mrC;
    typename C::iterator curr;
};

class Widget;

// in the base clase we do not need to include widget
class TestBase
{
public:
    virtual Iter<Widget> getIter() = 0;
};

#include <vector>

class Widget
{
public:
    int px;
    int py;
};

class Test : public TestBase
{
public:
    typedef std::vector<Widget> WidgetVec;

    virtual Iter<Widget> getIter() {
        return Iter<Widget>( new IterImplStl<WidgetVec, Widget>( mVec ) ); 
        }

    void add( int px, int py )
    {
        mVec.push_back( Widget() );
        mVec.back().px = px;
        mVec.back().py = py;
    }
private:
    WidgetVec mVec;
};

void testFn()
{
    Test t;
    t.add( 3, 4 );
    t.add( 2, 5 );

    TestBase* tB = &t;
    Iter<Widget> iter = tB->getIter();
    Widget* pW;
    while ( pW = iter.next() )
    {
        std::cout << "px: " << pW->px << " py: " << pW->py << std::endl;
    }
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-01T10:23:07.990

这应该做你想要的：

```
typedef typename std::vector<T>::iterator MyIterator; 
```

从[加速 C++](http://www.acceleratedcpp.com/)：

> 每当你有一个`vector<T>`依赖于模板参数的类型，比如 ，并且你想使用该类型的成员，比如`size_type`，它本身就是一个类型，你必须在整个名称前加上`typename`一个，让实现知道要处理名称作为类型。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-01T10:26:19.480

我不确定您所说的“不公开 std::vector”是什么意思，但实际上，您可以像这样定义您的 typedef：

```
typedef typename std::vector<T>::iterator iterator;
typedef typename std::vector<T>::const_iterator const_iterator; // To work with constant references 
```

稍后您将能够更改这些 typedef，而用户不会注意到任何事情......

顺便说一句，如果您希望您的类充当容器，那么公开一些其他类型被认为是一种好习惯：

```
typedef typename std::vector<T>::size_type size_type;
typedef typename std::vector<T>::difference_type difference_type;
typedef typename std::vector<T>::pointer pointer;
typedef typename std::vector<T>::reference reference; 
```

如果您的班级需要：

```
 typedef typename std::vector<T>::const_pointer const_pointer;
 typedef typename std::vector<T>::const_reference const_reference; 
```

您可以在这里找到所有这些 typedef 的含义：[STL documentation on vectors](http://www.sgi.com/tech/stl/Vector.html)

编辑：`typename`按照评论中的建议添加

# hosting - 这些天网络托管位置重要吗？

> ID：156940
> 
> 赞同：8
> 
> 时间：2008-10-01T10:05:32.137
> 
> 标签：hosting

我最近正在研究一些网络托管解决方案，其中一些提供商提供了各种托管位置，例如基于美国或英国的服务器。

我的问题是：从性能的角度来看，它真的会有所不同吗？假设我预计大部分流量来自欧洲大陆？

如果流量来自英国，服务器位于英国的事实是否会产生更大的差异。

将网站托管在与大多数预期流量相同的县有什么优点和缺点？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-01T10:09:35.760

是的，距离 = 延迟 = 更慢。这就是为什么谷歌、亚马逊和其他大型网站在不同地区甚至大洲拥有多个数据中心的原因。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-01T10:09:17.447

是的，显然它在某种程度上确实很重要。

这个程度取决于您的网站优化水平（页面大小、AJAX、Flash 等的使用）

以我的经验为例。从俄罗斯到美国的往返时间为 200 毫秒。对性能优化过的小型网站没有任何影响，但是对于SmartClient访问本站Web API的可用性有很大的不同。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-01T10:47:23.207

性能是一个考虑因素，支持是另一个考虑因素。

经过几次不同的体验后，我们选择了我们所在时区的提供商。尽管大多数供应商都声称提供 24/7 全天候支持，但在他们的工作日中间与在他们的午夜是一个非常不同的交易。

如果可以的话，我说去本地。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-01T10:11:47.767

还要检查托管计划的详细信息以了解费用。

在匈牙利，大多数供应商为国家网络提供的带宽比提供给国外的带宽更大。假设您购买了一个计划，并且您与该国的连接速度为 100 Mb/s，但与国外的连接速度仅为 10 Mb/s。这是因为内部带宽对他们来说比国际带宽便宜。

因此，将服务器定位到使用最多的国家是有好处的。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-01T10:08:13.050

这对冰岛来说意义重大，因为与欧洲的光纤连接比与美国的连接要大得多。所以它取决于这样的变量。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-01T10:53:15.127

另一个例子：新西兰大学的学生访问“国际”网站要比访问国内网站（例如[坎特伯雷大学）支付更多费用。](http://www.it.canterbury.ac.nz/services/charges/)

可能与您无关，但说明位置可能是因素！

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-10-01T11:11:28.747

是的，正如其他人已经说过的那样，这绝对很重要。实际上，每增加 100 毫秒，您就会失去眼球。

我要补充的推论是，您的主机位于哪个数据中心以及它们与谁对等非常重要——主要交换点的主机与几家大型电信公司的主机与主机之间的区别第三层数据中心可以像美国和欧洲一样大。

谷歌不仅*出于*地理原因在各地都有盒子，它们有意在几乎每个主要的互联网交换点，而且它们还与每个人对等，以便他们的数据包可以在任何给定速度最快的网络上路由片刻。

您显然无法做到所有这些，但是一旦您将其范围缩小到几个提供商，您就可以跟踪路由并查看一天中不同时间的跃点和跃点时间，并找出对您的用户具有最少延迟的内容。（即，如果您的所有用户都在德国，请在法兰克福选择一个地点，然后从那里跟踪您候选名单中的所有提供商。）

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-01T10:53:38.527

提到的另一件事是延迟，但我认为要强调的是，如果它是一个连续的数据流，它可能不会很大，具体取决于数据类型，但如果它是一个多次被点击以完成某些事务的站点排序（例如，ajax 应用程序调用多个 Web 服务）这可能会开始增加高延迟（ping）

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-10-01T10:59:10.073

与性能无关的另一个考虑因素是搜索引擎优化，一些 SEO 人员认为，在其他地理位置的服务器上托管站点可能会对结果中的位置产生一些影响。我不确定这有多准确，但如果强大的 SEO 位置对您很重要，可能需要研究一下。

在性能方面，我同时使用了 Mosso 和 Media Temple，并且发现在英国的访问速度非常快，我不能说它对浏览我网站的用户有任何真正的影响。

尽管如此，我目前将所有网站都保存在英国的数据中心。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-10-01T11:07:41.830

物理距离虽然一个因素并不总是意味着延迟会自动上升。另一个因素是是否与其他国家的过境运营商直接建立对等协议。例如，您可能会发现从 UK -> US 的跳数/ping 时间甚至比 UK -> UK 连接更有利。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-10-01T11:49:16.973

当然，看看[http://www.speedtest.net/](http://www.speedtest.net/)看看亚洲托管与美国托管的区别

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-10-01T13:51:42.247

对于一个小网站来说，这是可以接受的。我在美国托管自己的网站和项目，而我自己和很多网站用户都在英国。

另一个需要注意的因素是您选择作为房东的管辖范围内的法律。一个典型的例子是在瑞典举办的海盗湾，因为他们对受版权保护的内容持积极态度。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2012-02-14T20:25:31.517

缺少的一点是，如果您有欧盟客户，您必须确保遵守欧洲隐私法。这可能意味着没有美国或美国拥有的供应商。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2011-11-16T03:41:26.200

是的。性能取决于数据中心与用户之间的距离。更近意味着更快，反之亦然。

# ruby-on-rails - Capistrano + Thin + nginx，用户不允许 sudo howto？

> ID：156941
> 
> 赞同：2
> 
> 时间：2008-10-01T10:06:12.040
> 
> 标签：ruby-on-rails, nginx, capistrano, thin

我有这样一个场景，我想使用 capistrano 来部署我的 ruby​​ on rails 应用程序：

1.  Web 应用程序位于一个瘦集群上，配置文件存储在 /etc/thin 下。在 /etc/init.d/thin 中还有一个 init 脚本，因此只要我的服务器需要重新启动，它就会自动启动
2.  nginx 也以同样的方式执行（作为一个 init 脚本守护进程）
3.  为了确保万一有人入侵了我的网络服务器，我不希望他们做一些太可怕的事情，所以不允许网络用户使用 sudo。
4.  Thin 和 nginx 都以网络用户身份运行以强制执行此类安全性

现在，当我需要进行部署时，我需要将文件安装在 /home/webuser/railsapps/helloworld 下，然后我需要 cap 脚本重新启动我的瘦身。我想保留网络用户拥有的所有文件，因此 cap 脚本主要用户以网络用户身份运行。现在当我想重新启动瘦守护程序时出现问题，因为 webuser 不能 sudo。

我正在考虑是否可以调用两个单独的会话- webuser 进行文件部署，然后调用一个特殊的 sudoer 来重新启动守护进程。谁能给我一个示例脚本？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-01T10:11:01.717

这可能不是您想要的，但您实际上可以在 sudoers 文件中执行以下操作：

```
someuser ALL=NOPASSWD: /etc/init.d/apache2 
```

这让 someuser 运行 /etc/init.d/apache2

如果您尝试做其他事情：

```
$ sudo ls
[sudo] password for someuser: 
Sorry, user someuser is not allowed to execute '/bin/ls' as root on ... 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-12T00:15:42.303

为什么不使用 sudo 进行部署例程，然后在 RAILS_ROOT 上使用 chown -R？您可以告诉 Capistrano 在将版本别名为当前版本之前更改所有权。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-07-19T03:06:27.963

如果您以网络用户身份运行 Thin，那么网络用户可以不结束进程吗？您可以在没有守护程序的情况下再次重新启动 Thin，只要您将 /etc/thin 中的所有内容传递给服务器就可以了。据我所知，守护进程只是一种绕过在启动时手动启动程序的便捷方式。

唯一会遇到困难的时候是您必须编辑 /etc/thin 的内容。假设您对网络用户的 thin.yml 位使用别名，这只会在您想要添加/删除程序时发生。发生这种情况时，可能值得手动添加/删除别名。

这一切都假设网络用户可以结束瘦进程开始。别的我不知道。上次对我来说是个问题是当我没有办法在本地机器上运行应用程序时，因为它的实现几乎与服务器的布局相关联。每次我编辑某些东西时，我都必须将其发送到 SVN，将终端中的选项卡切换到 ssh shell，将其从 SVN 拉出，将选项卡切换到另一个 ssh，然后重新启动守护程序，看看我是否破坏了它。这让我很沮丧，所以我在本地安装了 Thin，让应用程序读取配置文件，现在我只需每隔几天上传一次。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-06-17T12:49:14.263

**刚刚注意到您不允许用户 sudo :-) 那么这个答案将对其他人有所帮助：**

派对有点晚了，但我刚刚做到了：

```
namespace :deploy do
  desc "Start the Thin processes"
    task :start do
      run "cd #{current_path} && bundle exec sudo thin start -C /etc/thin/dankit.yml"
    end

    desc "Stop the Thin processes"
    task :stop do
      run "cd #{current_path} && bundle exec sudo thin stop -C /etc/thin/dankit.yml"
    end

    desc "Restart the Thin processes"
    task :restart do
      run "cd #{current_path} && bundle exec sudo thin restart -C /etc/thin/dankit.yml"
    end

end 
```

将 sudo 添加到`bundle exec sudo thin start`作品中。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-04T07:22:39.760

另一种方法是以普通用户身份运行 nginx，例如在端口 8080 上，然后使用 IPTables 从内存将请求从端口 80 重定向到端口 8080

```
iptables -A PREROUTING -t tcp -m tcp -p 80 -j DNAT --dport 8080
```

将所有发往80端口的数据包发送到8080端口，可以作为普通用户绑定。

# python - .order_by() 无法正常工作/我期望的工作方式

> ID：156951
> 
> 赞同：1
> 
> 时间：2008-10-01T10:09:42.140
> 
> 标签：python, django

在我的 Django 项目中，我`Product.objects.all().order_by('order')`在视图中使用，但它似乎无法正常工作。

这是它的输出：

产品名称 Sort Evolution 2 Polarity 1 Jumbulaya 3 Kalidascope 4

它应该如下所示：

产品名称 排序 极性 1 Evolution 2 Jumbulaya 3 Kalidascope 4

但事实并非如此。有任何想法吗？

我的观点（对于那个输出）：

```
def debug(request):
    order = Product.objects.all().order_by('order')
    return render_to_response('cms/debug.html', {'order' : order, 'name' : name}) 
```

以及负责保存订单字段的视图：

```
def manage_all(request):

if request.method == 'POST':
    PostEntries = len(request.POST)
    x = 1       
    while x < PostEntries:
        p = Product.objects.get(pk=x)
        p.order = int(request.POST.get(str(x),''))
        print "Itr: " + str(x)
        x = x + 1
    p.save()
    print "Product Order saved"     
    return HttpResponse("Saved") 
```

和模型（没有无聊的位）：

```
class Product(models.Model):
    name = models.CharField(max_length=100)
    order = models.IntegerField(blank = True, null = True 
```

这是页面[http://massiveatom.com:8080/debug/](http://massiveatom.com:8080/debug/)的“实时”示例请注意，它仅在开发服务器上运行，因此它可能并不总是启动。

我在#django 中问过，他们似乎不知道发生了什么。一种想法是数据库/Django 被它生成的 SQL 命令弄糊涂了（`select * from table where 1 order by 'order'`），但我不希望更改模型中的 order 字段。

而且我知道在上面的 SQL 命令中应该有围绕顺序的反引号，但是语法解析的东西有点讨厌它......

**编辑：**每个对象都有正确的值，所以我真的不知道为什么它没有正确排序。

**编辑2：**我不知道发生了什么，但事实证明将 p.save() 放在循环中修复了这一切......

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-01T10:30:44.820

您的保存循环是错误的。您将产品保存在循环之外。它应该是：

```
if request.method == 'POST':
    PostEntries = len(request.POST)
    x = 1           
    while x < PostEntries:
            p = Product.objects.get(pk=x)
            p.order = int(request.POST.get(str(x),''))
            print "Itr: " + str(x)
            x = x + 1
            p.save() # NOTE HERE <- saving in loop instead of outside
    print "Product Order saved"             
    return HttpResponse("Saved") 
```

# sql - 在 SQL Server 索引中搜索单词

> ID：156954
> 
> 赞同：6
> 
> 时间：2008-10-01T10:10:38.723
> 
> 标签：sql, sql-server, linq, full-text-search

我需要介于全文搜索和索引搜索之间的东西：
我想在表格的一列中搜索文本（如果重要的话，该列上也可能会有一个索引）。

问题是，我想在列中搜索单词，但我不想匹配部分。

例如，我的专栏可能包含公司名称：
*Mighty Muck Miller and Partners Inc.
Boy & Butter Breakfast company*

现在，如果我搜索“ *Miller* ”，我想找到第一行。但是如果我搜索“ *iller* ”我不想找到它，因为没有以“iller”开头的单词。但是，搜索“ *Break* ”应该会找到“ *Boy & Butter Breakfast company* ”，因为有一个词以“ *Break* ”开头。

所以如果我尝试使用

```
WHERE BusinessName LIKE %Break% 
```

它会发现太多的点击。

有没有办法搜索由空格**或其他分隔符分隔**的单词？

（LINQ 最好，纯 SQL 也可以）

**重要提示：**到目前为止，空格并不是唯一的分隔符！应该考虑使用斜线、冒号、点、所有非字母数字字符！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-01T10:36:49.067

您的单词分隔符会很多：空格、制表符、行首、括号、句点、逗号、感叹号/问号等。因此，一个非常简单的解决方案是在 WHERE 子句中使用正则表达式。（而且它会比对你能想到的所有可能的分隔符进行 ORing 更有效率。）

既然您提到了 LINQ，这里有一篇文章描述了如何[使用 SQL Server 进行高效的正则表达式查询](http://msdn.microsoft.com/en-us/magazine/cc163473.aspx)。

就性能而言，像这样复杂的 WHERE 子句总是向我提出一个危险信号，所以我绝对建议对你最终得到的任何东西进行基准测试，毕竟你可能决定为该列建立一个搜索索引。

**编辑：**看到你编辑了你的问题。在[编写正则表达式](http://regexlib.com/CheatSheet.aspx)时，很容易让它使用任何非字母字符作为分隔符，即 [^0-9a-zA-Z]，或 \W 用于任何非单词字符，\b 用于任何单词边界和\B 用于任何非单词边界。或者，不匹配分隔符，只匹配任何单词，即 \w+。这是[另一个](http://www.sqlteam.com/article/regular-expressions-in-t-sql)使用 SQL Server 进行正则表达式搜索的示例（比您需要的更复杂）。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-01T10:18:47.300

```
where BusinessName like 'Break%' -- to find if it is beginning with the word
or BusinessName like '% Break%' -- to find if it contains the word anywhere but the beginning 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-02T02:19:08.707

SQL Server 2000 或更高版本。

```
SELECT *
  FROM dbo.TblBusinessNames
 WHERE BusinessName like '%[^A-z^0-9]Break%' -- In the middle of a sentence
    OR BusinessName like 'Break%'            -- At the beginning of a sentence 
```

**LIKE**的关键字参考：http : [//msdn.microsoft.com/en-us/library/aa933232 (SQL.80).aspx](http://msdn.microsoft.com/en-us/library/aa933232(SQL.80).aspx)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-01T10:18:57.347

```
WHERE BusinessName LIKE '% Break%' 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-01T10:35:12.470

你提到了 LINQ - 你可以做类似的事情......

```
string myPattern = "% Break%";

var query =
      from b in Business
      where SqlMethods.Like(b.BusinessName, myPattern) 
      select b; 
```

请注意，这使用`System.Linq.Data.SqlClient`直接转换为`LIKE`运算符的命名空间，无需额外处理。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-03-09T15:51:47.427

试试这个：

```
declare @vSearch nvarchar(100)

set @vSearch = 'About'

select * from btTab where ' ' + vText + ' ' LIKE '%[^A-z^0-9]' + @vSearch + '[^A-z^0-9]%' 
```

# java - 如何使用 JLabel 添加水平间隙

> ID：156975
> 
> 赞同：6
> 
> 时间：2008-10-01T10:17:20.033
> 
> 标签：java, swing, jlabel, swingx

我有一个 JLabel（实际上，它是一个 JXLabel）。

我在上面放了一个图标和文字。

`<icon><text>`

现在我想在组件的左侧添加一些间距，如下所示：

`<space><icon><text>`

我不接受通过修改图像来移动 JLabel 或添加间距的建议。

我只想知道如何使用纯 java 代码来做到这一点。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-10-01T10:39:32.803

我找到了解决方案！

```
setBorder(new EmptyBorder(0,10,0,0)); 
```

谢谢大家！

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-01T10:22:47.117

像这样：不是很清楚，但是可以通过给标签加一定宽度的透明边框来增加间距

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-01T10:29:12.127

如果您试图将标签推到其容器的一侧，您可以添加胶水。像这样的东西：

```
JPanel panel = new JPanel();
panel.setLayoutManager(new BoxLayout(panel, BoxLayout.LINE_AXIS);

panel.add(new JLabel("this is your label with it's image and text"));

panel.add(Box.createHorizontalGlue()); 
```

虽然你的问题不是很清楚。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-01T10:35:18.243

您不需要修改 JLabel 的 preferredSize，您可以使用[GridBagLayout](http://java.sun.com/javase/6/docs/api/java/awt/GridBagLayout.html)管理器来指定组件之间的分隔，您只需使用容器中的 GridBagLayout 并使用[GridBagConstraints](http://java.sun.com/javase/6/docs/api/java/awt/GridBagConstraints.html)对象将 JXLabel 添加到其中指定左侧的插图：

```
JPanel panel=new JPanel(new GridBagLayout());
JLabel label=new JLabel("xxxxx");

GridBagConstraints constraints=new GridBagConstraints();

constraints.insest.left=X; // X= number of pixels of separation from the left component

panel.add(label,constraints); 
```

请注意，我在约束的设置中省略了很多配置属性，您最好阅读[GridBagLayout的文档](http://java.sun.com/javase/6/docs/api/java/awt/GridBagLayout.html)

# c# - C# StringTemplate - 如何设置 eol 字符

> ID：156988
> 
> 赞同：4
> 
> 时间：2008-10-01T10:21:23.220
> 
> 标签：c#, stringtemplate

我正在使用 C# 版本的 StringTemplate 库 ( [http://www.stringtemplate.org/](http://www.stringtemplate.org/) ) 来生成 C++ 代码。我的模板工作正常，直到我开始使用

```
<attribute:template(argument-list)> 
```

将模板应用于“列表”中的多个值的语法（如果我在 StringTemplate 术语中是正确的，则为“多值参数”）。从那一刻起，EOL 字符从 \n 切换到 \r\n，这导致 Visual Studio 和其他编辑器每次打开生成的文件时都会弹出“将行尾字符转换为 \n”警告。

所以，我的问题是：如何强制 StringTemplate 始终输出 \n 作为 EOL 标记？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-03T10:26:57.230

您可以尝试使用输出过滤器（[http://www.antlr.org/wiki/display/ST/Output+Filters](http://www.antlr.org/wiki/display/ST/Output+Filters)）将所有 \r\n 替换为 \n

# mysql - 将新表从 CSV 导入 MySQL v5 的最简单方法是什么？

> ID：156994
> 
> 赞同：1
> 
> 时间：2008-10-01T10:22:47.943
> 
> 标签：mysql, csv

我在本地网络上的 linux 服务器上运行 MySQL 5。为我的桌面运行 windows XP。看了一下[MySQL GUI Tools](http://dev.mysql.com/downloads/gui-tools/5.0.html)，但我认为它们没有帮助。我无法在远程服务器上安装 apache 并使用 PHPmyAdmin 之类的东西。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-01T10:49:19.177

看看@load data infile：[http ://dev.mysql.com/doc/refman/5.0/en/load-data.html](http://dev.mysql.com/doc/refman/5.0/en/load-data.html)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-02T02:11:38.350

从 MySQL shell 或查询浏览器...

如果 CSV 没有标题：

```
LOAD DATA INFILE 'mycsvfile.csv' INTO TABLE mytable; 
```

如果 CSV 有标题：

```
LOAD DATA INFILE 'mycsvfile.csv' INTO TABLE mytable IGNORE 1 LINES; 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-01T10:27:13.427

我在我的 Windows 系统上使用[SQLyog](http://www.webyog.com/)，它有一个免费的社区版，并且可以选择从 CSV 导入。

我自己从来没有使用过这个选项，所以我不能告诉你它有多好。然而，SQLyog 对于我用过的所有其他事情来说都很棒。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-01T10:46:29.743

我会使用电子表格编辑器来制作一组 SQL 语句。在开始处放置一个新列并添加`insert into tablename values('`. 添加其他列以使用类似的代码分隔数据`'','`。结束`'');`。使用自动填充功能将这些单元格向下拖动到所需的行数。将整个工作表复制到纯文本编辑器并删除多余的选项卡，留下一组简单的插入语句。

这是我可以用于任何数据库系统和任何电子表格文件格式的解决方案。此外，还可以轻松地从其他数据库等来源填充电子表格，或从网页复制和粘贴。它也非常快，可以在任何台式机上使用，使用 Excel、OpenOffice 或 Google Docs。

请参阅我在[Excel](http://spreadsheets.google.com/pub?key=p-q49zUHgBDO-GmZ1cXIjcA&output=xls)和[OpenOffice](http://spreadsheets.google.com/pub?key=p-q49zUHgBDO-GmZ1cXIjcA&output=ods)版本中的示例电子表格。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-07-06T19:47:00.470

我只是使用了这个，`LOAD DATA INFILE`但值得注意的是它并不像 Gareth 的示例那么简单（Kai 是非常正确的，你应该查看[文档](http://dev.mysql.com/doc/refman/5.0/en/load-data.html)）。为了正确导入逗号分隔值，我使用了这个：

```
LOAD DATA LOCAL INFILE 'mycsvfile.csv' INTO TABLE mytable 
FIELDS TERMINATED BY ','
ENCLOSED BY '"'
LINES TERMINATED BY '\n'
IGNORE 1 LINES; 
```

这假定一个 CSV 文件在每个字段周围都带有引号，并且在顶部有一个标题行。（您可能不需要，`LINES TERMINATED BY`因为它应该是默认值，但明确表示是一个好习惯。）

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-07-07T18:03:51.963

The Toad application does work wonders and is freeware. If you have a proper CSV file, it will create the table and import all data for you.

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-01T10:25:14.163

编写一个简单的 Python 脚本来解析 CSV 并将其插入到表中。

查看**csv**和**mysqldb**模块。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-01T10:52:59.353

如果您不介意使用一些商业软件，那么 Navicat ( [http://mysql.navicat.com/](http://mysql.navicat.com/) ) 是一款非常有用的软件，可用于 Mac、Windows、Linux。我经常使用它来将大型 CSV 文件导入数据库。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-12-04T17:57:07.473

[Toad for MySQL](http://www.toadsoft.com/toadmysql/)可以很好地做到这一点，对导入有相当大的控制（例如有选择地匹配列），而且最持久的是它是免费的。

我也使用过 SQLYog，但您必须拥有商业版本，因为社区版不提供从文件导入。

Toad 是一款出色的软件，它提供适用于所有主要数据库的版本，我过去也使用过 MSSQL 和 Oracle 版本。受到推崇的。***************