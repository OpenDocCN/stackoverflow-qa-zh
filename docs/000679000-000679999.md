# StackOverflow 问答 000679000-000679999

# sql-server - 如何检查 SQL Server 中是否存在数据库？

> ID：679000
> 
> 赞同：307
> 
> 时间：2009-03-24T19:56:11.410
> 
> 标签：sql-server, database, tsql

使用 TSQL 检查 SQL Server 上是否存在数据库的理想方法是什么？似乎有多种方法可以实现这一点。

* * *

## 回答 #1

> 赞同：572
> 
> 时间：2010-01-08T16:19:37.217

实际上最好使用：

```
IF DB_ID('dms') IS NOT NULL
   --code mine :)
   print 'db exists' 
```

请参阅[https://docs.microsoft.com/en-us/sql/t-sql/functions/db-id-transact-sql](https://docs.microsoft.com/en-us/sql/t-sql/functions/db-id-transact-sql)并注意这对 Azure SQL 数据库没有意义。

* * *

## 回答 #2

> 赞同：177
> 
> 时间：2009-03-24T20:05:22.980

来自微软的脚本：

```
DECLARE @dbname nvarchar(128)
SET @dbname = N'Senna'

IF (EXISTS (SELECT name 
FROM master.dbo.databases 
WHERE ('[' + name + ']' = @dbname 
OR name = @dbname))) 
```

* * *

## 回答 #3

> 赞同：40
> 
> 时间：2009-03-24T20:21:57.510

```
IF EXISTS (SELECT name FROM master.sys.databases WHERE name = N'YourDatabaseName')
  Do your thing... 
```

顺便说一句，这直接来自 SQL Server Studio，所以如果您可以使用此工具，我建议您开始使用各种可用的“Script xxxx AS”功能。会让你的生活更轻松！:)

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2016-12-14T20:36:15.177

我喜欢@Eduardo 的回答，也喜欢接受的回答。我喜欢从这样的事情中取回一个布尔值，所以我为你们写了它。

```
CREATE FUNCTION dbo.DatabaseExists(@dbname nvarchar(128))
RETURNS bit
AS
BEGIN
    declare @result bit = 0 
    SELECT @result = CAST(
        CASE WHEN db_id(@dbname) is not null THEN 1 
        ELSE 0 
        END 
    AS BIT)
    return @result
END
GO 
```

现在你可以像这样使用它：

```
select [dbo].[DatabaseExists]('master') --returns 1
select [dbo].[DatabaseExists]('slave') --returns 0 
```

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2018-05-09T11:53:40.180

**试试这个**

```
IF EXISTS 
   (
     SELECT name FROM master.dbo.sysdatabases 
    WHERE name = N'New_Database'
    )
BEGIN
    SELECT 'Database Name already Exist' AS Message
END
ELSE
BEGIN
    CREATE DATABASE [New_Database]
    SELECT 'New Database is Created'
END 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2021-06-05T18:24:44.653

```
 Public Function SQLDatabaseExist(ByVal DefaultConnectionString As String, ByVal DataBaseName As String) As Boolean
Try
    'CREATE DATABASE
    Dim SqlString As String = ""
    SqlString = "SELECT CASE WHEN EXISTS (SELECT name FROM master.dbo.sysdatabases WHERE name = N'" & DataBaseName & "') THEN CAST (1 AS BIT) ELSE CAST (0 AS BIT) END"
    Dim ExcRet As Integer = 0
    Using connection As New SqlConnection(DefaultConnectionString)
        Dim command As New SqlCommand(SqlString, connection)
        command.Connection.Open()
        ExcRet = command.ExecuteScalar()
        command.Connection.Close()
        command.Dispose()
    End Using
    Return ExcRet
Catch ex As Exception
    Return False
End Try 
```

结束功能

''注意连接字符串中的初始目录必须是master！'示例默认连接字符串

```
Dim DefaultConnectionString As String = "Data Source=localhost\SQLSERVER2008;Initial Catalog=Master; User ID=SA; Password='123123'; MultipleActiveResultSets=false; Connect Timeout=15;Encrypt=False;Packet Size=4096;" 
```

# domain-driven-design - 值对象如何存储在数据库中？

> ID：679005
> 
> 赞同：70
> 
> 时间：2009-03-24T19:57:11.923
> 
> 标签：domain-driven-design, value-objects

我还没有真正看到任何示例，但我假设它们保存在数据库的包含实体表中。

IE。如果我有一个 Person 实体/聚合根和一个相应的 Person 表，如果它有一个名为 Address 的值对象，那么 Address 值将保存在这个 Person 表中！

这对于我拥有其他实体（例如公司等）的域是否有意义？

（我目前正在编写一个项目管理应用程序并尝试进入 DDD）

* * *

## 回答 #1

> 赞同：141
> 
> 时间：2009-03-25T11:06:09.320

出于您所描述的原因，可以将值对象存储在单独的表中。但是，我认为您误解了实体与 VO - 这不是与持久性相关的问题。

这是一个例子：

假设**Company**和**Person**都具有相同的邮件**地址**。这些陈述中哪些认为有效？

1.  “如果我修改 Company.Address，我希望 Person.Address 自动获取这些更改”
2.  “如果我修改 Company.Address，它一定不会影响 Person.Address”

如果**1**为真，则**Address**应该是一个***Entity***，因此有它自己的表

如果**2**为真，则**Address**应该是一个***Value Object***。它可以作为组件存储在父实体的表中，也可以拥有自己的表（更好的数据库规范化）。

如您所见，Address 的持久化方式与 Entity/VO 语义无关。

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2012-10-04T00:35:09.037

大多数开发人员倾向于先考虑数据库，然后再考虑其他任何事情。DDD 不知道如何处理持久性。这取决于存储库来处理它。您可以将其保存为 xml、sql、文本文件等。实体/聚合/值对象是与域相关的概念。

Vijay Patel 的解释是完美的。

# c# - 有人有从 MSBuild 调用 Rake 以获得代码生成和其他好处的经验吗？进展如何？你有什么想法/建议？

> ID：679009
> 
> 赞同：5
> 
> 时间：2009-03-24T19:58:03.667
> 
> 标签：c#, ruby, msbuild, code-generation, rake

在使用 Visual Studio 2008 进行 C# 编程时，我经常希望“自动”生成代码。如果可能的话，我想通过调用 Rake 调用我的 MSBuild 解决方案文件来实现它，它会调用 Ruby 代码来生成代码，生成的文件会自动出现在我的解决方案中。

这是一个商业示例（我可以说出许多可能的示例），这种自动代码生成将很有帮助。在最近的一个项目中，我有一个接口，其中包含一些包含美元金额的属性。我想要第二个接口和第三个接口，它们具有与第一个接口相同的属性，除了它们被“限定”为业务单位名称。像这样的东西：

```
public interface IQuarterlyResults
{
     double TotalRevenue { get; set; }
     double NetProfit { get; set; }
}

public interface IConsumerQuarterlyResults
{
     double ConsumerTotalRevenue { get; set; }
     double ConsumerNetProfit { get; set; }
}

public interface ICorporateQuarterResults
{
     double CorporateTotalRevenue { get; set; }
     double CorporateNetProfit { get; set; }
} 
```

在此示例中，有一个“消费者业务单位”和一个“公司业务单位”。IQuarterlyResults 上的每个属性都成为 ICorporateQuarterlyResults 上名为“Corporate”+ [属性名称] 的属性，对于 IConsumerQuarterlyResults 也是如此。

为什么要为这些创建接口，而不仅仅是为 Consumer 提供一个 IQuarterlyResults 实例，为 Corporate 提供另一个实例？因为，在使用我正在构建的计算器对象时，用户必须处理 100 个属性，如果他可以处理“完全限定”的属性名称，例如“ConsumerNetProfit”，那么混淆就会少得多。

*但我们不要在这个例子中陷入困境。这只是一个例子，而不是主要问题。*

**主要问题是：**我喜欢使用 Ruby 和 ERB 进行代码生成，我喜欢使用 Rake 来管理任务之间的依赖关系。为了解决上述问题，我想做的是让 MSBuild 调用 Rake，并让 Rake / Ruby 读取“核心”接口上的属性列表，然后生成代码以生成所有依赖接口及其特性。这会在我每次构建时触发，因为我将它放入 VS.NET 解决方案的 MSBuild 文件中。

有没有人尝试过这样的事情？你的效果如何？您可以分享哪些关于利弊、成功秘诀等方面的见解？

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-04-03T13:32:51.133

我使用 rake 生成使用 ERB 模板化的配置文件。要做的是编辑您的项目文件以插入一个调用 rake 的 BeforeBuild 目标，类似于：

```
<Target Name="BeforeBuild">
     <Exec Command="rake name_of_my_template_processing_task" />
</Target> 
```

请参阅[msbuild exec 任务文档](http://msdn.microsoft.com/en-us/library/x8zx72cd.aspx)和[关于预构建事件的博](http://pjbelfield.wordpress.com/2007/09/25/pre-build-events-and-the-before-build-target/)文。您需要在 Command 属性中：

*   如果它不在路径环境变量中，则提供 rake 的路径
*   如果需要从特定目录运行，请设置工作目录属性
*   如果您没有从项目所在的目录执行 rake，请提供 -r 参数和 rakefile 的路径。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-24T20:47:05.063

我们使用 Nant/ruby+ERB 实现了它——它在我们的 DAL 和我们的 Web 应用程序的数据输入表单输入中生成了一种 CRUD 的音调。对我们来说它工作得非常好，但一开始有大量的设置时间让我的老板/客户感到紧张，因为他们认为我们应该展示更多的产品而不是原型。

还要确定生成在做什么 - 生成和修改和生成+集成之间存在差异。生成和修改更像是使用向导并且是一次性的。当您生成+集成时，您需要了解您将在何处/如何通过继承或通过从手写代码到生成代码的库调用来利用生成的代码。

Ruby/erb 执行速度不快。确定何时需要/不需要生成的方法很有帮助，因为编译周期开始变得漫长且无效率。我们还发现，在将其集成到工作流程之前，始终构建一个小型测试用例以生成甚至一组工件很有帮助 - 您对产品进行了测试，并且在您处理 cg 元素时它不会减慢任何人的速度（s ）。

我会阅读 Jack Herringtons [Code Generation in Action](https://rads.stackoverflow.com/amzn/click/com/1930110979)，因为它面向 Ruby。它让我进入了CG。

[我还将阅读Microsoft .NET 中的](https://rads.stackoverflow.com/amzn/click/com/1590591372)Kathleen Dollards代码生成。它是为使用 XSLT 而构建的，但开发元数据、转换和集成阶段的原则是相同的。她的文章也很有帮助，您可以在杂志和网络上找到。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-03T16:39:17.537

我想把它扔在那里（虽然我怀疑它会成为问题的答案，它应该是信息），但是有几个很好的 CodeGen 工具具有一些非常强大的 Visual Studio 集成，可以做很多事情你想要什么。显然，您正在寻找 Ruby 工具，但对于那些不熟悉 Ruby 的人，请考虑其他一些工具：

*   [代码史密斯](http://www.codesmithtools.com/)
*   [我这一代](http://www.mygenerationsoftware.com/portal/default.aspx)

# php - GET 与 POST 最佳实践

> ID：679013
> 
> 赞同：15
> 
> 时间：2009-03-24T19:59:33.493
> 
> 标签：php, html, http, forms, rest

对于我的 Web 应用程序 (PHP/MYSQL)，我在每行显示一个项目列表和一个链接以删除该项目。现在，链接是

```
<a href='item.php?id=3&action=delete'>Delete Item</a> 
```

如果我想改用 POST ......我会怎么做（这是一个动态生成的列表）？我可以在不使用表单的情况下发送 POST 数据吗？

或者，对于每个项目，我是否必须这样做：

```
<form action='item.php?id={$item_id}' method='POST'>
    <input type='hidden' name='action' value='delete'>
    <input type='submit' value='delete item'>
</form> 
```

并将提交按钮的样式设置为看起来像原始链接？

我不熟悉 php CURL 或 REST，他们会帮助解决这个问题吗？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-03-24T20:06:56.453

请使用 POST 来修改数据库中的持久状态。您不希望爬虫访问您的删除链接！
阅读[万维网架构，第一卷](http://www.w3.org/TR/webarch/)和URI，可寻址性，以及W3C[对 HTTP GET 和 POST 的使用。](http://www.w3.org/2001/tag/doc/whenToUseGet.html)

**编辑**：有时虽然您需要使用 GET。例如，通过电子邮件发送的会员激活 URL 是 GET，需要以某种方式修改数据库。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2009-03-24T20:03:50.113

一般来说，以某种方式修改系统状态的 GET 请求不是一个好主意，比如删除一个项目。

你可以让你的表格看起来像这样：

```
<form action='item.php' method='POST' id='form'>
    <input type='hidden' name='action' value='delete' />
    <input type='hidden' name='id' value='{item_id}' />
    <a href="" onclick="document.getElementById('form').submit(); return false;">Delete item</a>
</form> 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-03-24T20:06:50.947

您永远不应通过 GET 请求更改数据库中的任何内容（日志信息或其他临时数据除外）。问题是存在各种网络爬虫软件、网络加速器、防病毒程序等，它们会对他们找到的每个 URL 执行 GET 请求；您不希望他们在这样做时自动删除项目。GET 也容易受到跨站请求伪造；如果攻击者让您的用户单击执行错误操作的链接（例如，创建重定向到删除 URL 的 tinyurl），那么他们可以欺骗用户使用他们的权限删除某些内容而没有意识到。

是的，您需要提交一个表单来创建 POST 请求。另一种选择是使用 JavaScript 和 XMLHttpRequest，但这不适用于禁用 JavaScript 的用户。

您还应该确保一旦您接受了来自 POST 请求的数据，而不是返回一个新页面来响应该请求，您应该将用户重定向到由 GET 请求访问的页面。这样，如果他们点击重新加载或稍后在浏览会话中点击后退按钮，他们就不会意外地重新发送 POST 请求。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-24T20:07:56.203

由于不允许 Get 更改系统状态的 REST 原则，您不想使用 Get。除非你喜欢搜索引擎删除你所有的内容。

您不需要每个项目的表格；您可以在列表周围使用一种方法=发布表单，并使用 delete_{id} 输入类型=提交。或者，更巧妙的是，<input type=submit name="delete_item" value="{id}">。提交按钮上允许使用名称。

根据您在评论中提出的问题， <input type=submit name="action_{id}" value="Delete"> 可能会更好，尽管它会遇到一些对本地化网站效果不佳的问题。您始终可以恢复为 HTML 按钮，以便对演示文稿进行更多控制。默认情况下，它就像一个提交按钮。

当您只是查看列表时，使用您提出的按项目表单的解决方案发送回比所需大得多的页面的平均情况会减轻您在提交中可能会获得额外的、不需要的信息的事实。对于支持 javascript 的客户端，您始终可以使用 javascript 将plain-old-html 表单的行为替换为更智能的版本。

如果您要链接到“Get”以进行删除，您应该返回一个确认页面，该确认页面在确认后实际上会发布一个帖子。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-03-24T20:36:44.480

这是一个很好的例子，说明为什么不使用 GET 来更改服务器状态：

[http://www.infoworld.com/article/08/06/16/25FE-stupid-users-part-3-admins_5.html](http://www.infoworld.com/article/08/06/16/25FE-stupid-users-part-3-admins_5.html)

关键部分是：

> 管理员说：“它登录了管理区域，并点击了每个条目的‘删除’链接。”

如果删除被编码为 POST，这永远不会发生。（OTOH，我们会被剥夺一个有趣的系统管理员故事。）

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-03-25T01:15:56.913

正如某些人所暗示的那样，POST 并不是对所有恶意行为的保护。恶意用户仍然可以创建链接（包含执行 POST 的 javascript）并导致与 GET 相同的跨站点脚本问题。(<a href="javascript:function () {...}"/>)

也就是说，使用 POST 而不是 GET 的所有其他原因都适用（爬虫等）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-24T20:32:21.933

正如其他人所说，将 GET 用于删除等破坏性操作是一个非常糟糕的主意，尤其是在面向 Internet 的网站（或具有 Google Mini 设备的公司）上，网络爬虫可能会意外删除您的所有数据。

如果您不想使用表单，请使用 XMLHttpRequest 将 POST 发送到您的服务器。如果您的服务器支持，您甚至可以将方法设置为 DELETE。

如果您不能使用 JavaScript 和 XHR（您的用户生活在 1999 年），并且您不想在列表中使用表单，请使用指向单独页面的链接，您可以在其中显示表单和可能的“Are”你确定？' 信息。

最好的做法可能是结合上述两个选项：使用表单呈现指向单独页面的链接，但使用 JavaScript 将链接重写为 XHR 调用。这样，1999 年或 2009 年的用户都可以获得最佳体验。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-07-04T07:02:16.467

您不应该使用 href 来删除项目。

我建议以老式的方式执行此操作，并为每一行/项目实现一个表单发布。

例如：

```
<tr><td>Item 1</td><td><form action=/delete method=post><input type=hidden name=id value=1><input type=submit value=Delete></form></tr>
<tr><td>Item 2</td><td><form action=/delete method=post><input type=hidden name=id value=2><input type=submit value=Delete></form></tr>
<tr><td>Item 5</td><td><form action=/delete method=post><input type=hidden name=id value=5><input type=submit value=Delete></form></tr> 
```

另外两个选项：1）对每个项目使用一个 2）Ajax（但您需要精通 Ajax）

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2011-11-04T14:03:37.057

您也可以使用 get 但您需要检查会话值以确保它是试图删除的帖子的所有者。get 不是“普遍不安全的”。这完全取决于你如何使用它。

* * *

## 回答 #10

> 赞同：-12
> 
> 时间：2009-03-24T20:01:34.220

使用 GET 来做这件事会更好。

如果您的问题是您不喜欢链接的丑陋 URL，您应该可以使用 mod_rewrite 修复它（如果您使用 Apache Web 服务器）。

编辑：这里没有任何理由使用 POST。没理由。

周围的人都在写安全和不安全，好像选择方法会以任何方式影响安全。当然，无论您选择哪种方法，您都应该验证您的用户。如果你不这样做，那么你的软件*已经坏了*。如果您在*没有*表单的情况下使用javascript模拟发送表单，并且不需要它，根本不需要任何javascript，那么您的软件已经坏了。

实际上，大约 90% 的网络软件都被破坏了，因为人们不知道自己在做什么。

忽略这个评论被一些奇怪的人严重贬低。避免 javascript（不需要），避免 POST（没有理由），验证您的用户（安全），使用 mod_rewrite 或其他方式（很好）使 href 更漂亮。

# c++ - 如何在运行时找到当前函数的名称？

> ID：679021
> 
> 赞同：43
> 
> 时间：2009-03-24T20:01:29.137
> 
> 标签：c++, function, assert

经过多年使用丑陋的大 MFC ASSERT 宏，我终于决定放弃它并创建终极 ASSERT 宏。

我可以获取文件和行号，甚至是失败的表达式。我可以显示一个带有这些的消息框，以及中止/重试/取消按钮。

当我按下 Retry 时，VS 调试器会跳转到包含 ASSERT 调用的行（而不是像其他一些 ASSERT 函数那样的反汇编）。所以这一切都非常有效。

但真正酷的是*显示失败的函数的名称*。

然后我可以决定是否调试它，而无需尝试从文件名中猜测它所在的函数。

例如，如果我有以下功能：

```
int CMainFrame::OnCreate(LPCREATESTRUCT lpCreateStruct)
{
   ASSERT(lpCreateStruct->cx > 0);
   ...
} 
```

然后当 ASSERT 触发时，消息框会显示如下内容：

```
Function = CMainFrame::OnCreate 
```

**那么，在运行时找出当前函数名称的最简单方法是什么？**

*它不应该使用 MFC 或 .NET 框架，即使我确实使用了这两者。
它应该尽可能便携。*

* * *

## 回答 #1

> 赞同：59
> 
> 时间：2009-03-24T20:05:51.760

您的宏可以包含`__FUNCTION__`宏。毫无疑问，函数名将**在****编译时**插入到扩展代码中，但它是每次调用宏的正确函数名。所以它“似乎”发生在运行时；）

例如

```
#define THROW_IF(val) if (val) throw "error in " __FUNCTION__

int foo()
{
    int a = 0;
    THROW_IF(a > 0); // will throw "error in foo()"
} 
```

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2009-03-24T20:13:37.063

C++ 预处理器宏`__FUNCTION__`给出了函数的名称。

请注意，如果您使用它，它并不会在运行时*真正*获取文件名、行号或函数名。宏由预处理器扩展，并编译进去。

`__FUNCTION__`宏，like`__LINE__`和`__FILE__`，是语言标准的一部分，并且是可移植的。

示例程序：

```
#include <iostream>
#using namespace std;

void function1()
{
        cout << "my function name is: " << __FUNCTION__ << "\n";
}
int main()
{
        cout << "my function name is: " << __FUNCTION__ << "\n";
        function1();
        return 0;
} 
```

输出：

```
我的函数名称是：main
我的函数名称是：function1

```

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2009-03-24T21:32:08.467

没有标准的解决方案。但是，[`BOOST_CURRENT_FUNCTION`](http://www.boost.org/doc/libs/1_38_0/libs/utility/current_function.html)对于所有实际目的都是便携式的。该标头不依赖于任何其他 Boost 标头，因此如果整个库的开销不可接受，则可以独立使用。

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2009-03-24T20:07:38.840

`__FUNCTION__`或`__FUNC__`或`__PRETTY_FUNCTION__`

[http://msdn.microsoft.com/en-us/library/b0084kay(VS.80).aspx](http://msdn.microsoft.com/en-us/library/b0084kay(VS.80).aspx) [http://gcc.gnu.org/onlinedocs/gcc/Function-Names.html](http://gcc.gnu.org/onlinedocs/gcc/Function-Names.html)

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2009-07-23T22:05:51.553

在 GCC 中，您可以使用`__PRETTY_FUNCTION__`宏。
微软也有一个等效的`__func__`宏，虽然我没有可以尝试的。

例如，`__PRETTY_FUNCTION__`在函数的开头使用这样的东西，你会得到一个完整的跟踪

```
void foo(char* bar){
  cout << __PRETTY_FUNCTION__ << std::endl
} 
```

这将输出

```
void foo(char* bar) 
```

如果您想输出更多信息，您还可以在所有标准 c/c++ 编译器下使用`__FILE__`和宏。`__LINE__`

在实践中，我使用了一个特殊的调试类来代替 cout。通过定义适当的环境变量，我可以获得完整的程序跟踪。你可以做类似的事情。这些宏非常方便，能够在现场像这样打开选择性调试真的很棒。

编辑：显然`__func__`是标准的一部分？不知道。不幸的是，它只给出了函数名而不是参数。我确实喜欢 gcc `__PRETTY_FUNC__`，但它不能移植到其他编译器。

GCC 还支持`__FUNCTION__`.

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2009-03-24T20:14:54.297

您可以使用在编译时将扩展为函数名称的[`__FUNCTION__`宏。](http://msdn.microsoft.com/en-us/library/b0084kay(VS.80).aspx)

这是一个如何在断言宏中使用它的示例。

```
#define ASSERT(cond) \
    do { if (!(cond)) \
    MessageBoxFunction("Failed: %s in Function %s", #cond, __FUNCTION__);\
    } while(0)

void MessageBoxFunction(const char* const msg,  ...)
{
    char szAssertMsg[2048];

    // format args
    va_list vargs;
    va_start(vargs, msg);
    vsprintf(szAssertMsg, msg, vargs);
    va_end(vargs);

    ::MessageBoxA(NULL, szAssertMsg, "Failed Assertion", MB_ICONERROR | MB_OK);
} 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2019-03-24T22:16:46.063

您可以轻松使用**func**。它会在运行时取回你当前的函数名，这会引发异常。

用法：

```
cout << __func__ << ": " << e.what(); 
```

# delphi - TObject 包含哪些数据？

> ID：679022
> 
> 赞同：9
> 
> 时间：2009-03-24T20:01:34.173
> 
> 标签：delphi, object, delphi-2009, tobject

TObject.InstanceSize 返回 8，但 TObject 没有声明任何数据成员。根据 TObject.ClassType 的实现，前 4 个字节可以解释为指向对象的 TClass 元数据的指针。有人知道其他 4 个字节的开销是做什么用的吗？

编辑：显然这是特定于 D2009。在旧版本中，它只有 4 个字节。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-24T20:12:49.793

在 Delphi 2009 中，[可以引用同步监视器](https://community.embarcadero.com/blogs/entry/why-has-the-size-of-tobject-doubled-in-delphi-2009-38138)。看：

```
class function TMonitor.GetFieldAddress(AObject: TObject): PPMonitor;
class function TMonitor.GetMonitor(AObject: TObject): PMonitor; 
```

...在 System.pas

此外，还有一个指向 VMT 的指针。（虚拟方法表。）[来自*Delphi in a Nutshell*：](http://oreilly.com/catalog/delphi/chapter/ch02.html)

> TObject 类声明了几种方法和一个特殊的隐藏字段来存储对对象类的引用。此隐藏字段指向类的虚拟方法表 (VMT)。每个类都有一个唯一的 VMT，并且该类的所有对象共享该类的 VMT。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-24T21:00:30.507

一个对象包含其所有字段的条目，以及用于保存指向虚拟方法表的指针的额外空间。VMT 不仅仅包含虚拟方法指针。我在我的网站上解释[了更多关于 VMT的信息，包括一个图表。](http://pages.cs.wisc.edu/~rkennedy/vmt)

显然，Delphi 2009 除了 VMT 指针之外还引入了另一个隐藏字段来保存同步监视器。您可以通过一些简单的代码来确定它是添加在类的开头还是末尾：

```
type
  TTest = class
    FField: Integer;
  end;

var
  obj: TTest;
  ObjAddr, FieldAddr: Cardinal;
begin
  Assert(TTest.InstanceSize = 12);
  obj := TTest.Create;
  ObjAddr := Cardinal(obj);
  FieldAddr := Cardinal(@(obj.FField));
  writeln(FieldAddr - ObjAddr);
end. 
```

如果它打印值 4，则监视字段必须位于对象的末尾，因为 4 仅说明 VMT 指针的大小。如果它打印值 8，则监视器字段必须位于开头，与 VMT 指针相邻。

我希望你会在一开始就找到监视器。否则，这意味着后代对象的布局不仅仅是附加了所有新字段的基础对象的布局。这意味着监视器字段的偏移量取决于对象的运行时类型，这使得实现更加复杂。

当一个类实现一个接口时，对象布局包括更多的隐藏字段。这些字段包含指向对象的接口引用值的指针。当你有一个`IUnknown`对象的引用时，它持有的指针与指向对象的 VMT 字段的指针不同，这与普通的对象引用相同。指针值将`IUnknown`是隐藏字段的地址。我已经写[了更多关于实现接口的类的布局](http://pages.cs.wisc.edu/~rkennedy/interface-object)。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-03-25T06:40:48.037

万一有人想知道为什么 Craig Stuntz 的回答被接受了，请参阅他对该回答的最后评论：

看起来像是在 D2009 中添加的：http: [//blogs.embarcadero.com/abauer/2008/02/19/38856](http://blogs.embarcadero.com/abauer/2008/02/19/38856)有关详细信息，请参阅该帖子中的链接。

链接不再可用，但wayback-machine 有它：

[https://web.archive.org/web/20160409224957/blogs.embarcadero.com/abauer/2008/02/19/38856](https://web.archive.org/web/20160409224957/blogs.embarcadero.com/abauer/2008/02/19/38856)

# linq-to-sql - 如何使用 LinqToSQL/Entity Framework/NHibernate 实现管道和过滤器模式？

> ID：679027
> 
> 赞同：5
> 
> 时间：2009-03-24T20:02:38.027
> 
> 标签：linq-to-sql, design-patterns, linq-to-entities, pipes-filters

在由 DAL Repository 构建时，我偶然发现了一个名为 Pipes and Filters 的概念。[我在这里](http://ayende.com/Blog/archive/2008/01/05/Pipes-and-filters-The-IEnumerable-appraoch.aspx)，这里读到了它，并从[这里](http://blog.wekeroad.com/mvc-storefront/mvcstore-part-3/)看到了一个截屏视频。我仍然不确定如何实施这种模式。理论上听起来不错，但我们如何在企业场景中真正实现这一点？

如果您在问题中提到的数据映射器/ORM 的上下文中对此模式有任何资源、提示或示例，我将不胜感激。

提前致谢！！

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-03-29T07:44:55.573

最终，LINQ on`IEnumerable<T>` *是*一种管道和过滤器的实现。`IEnumerable<T>`是一个*流式*API - 这意味着数据会在您请求时延迟返回（通过迭代器块），而不是一次加载所有内容，并返回一个大的记录缓冲区。

这意味着您的查询：

```
var qry = from row in source // IEnumerable<T>
          where row.Foo == "abc"
          select new {row.ID, row.Name}; 
```

是：

```
var qry = source.Where(row => row.Foo == "abc")
            .Select(row = > new {row.ID, row.Name}); 
```

当您对此进行枚举时，它将懒惰地消耗数据。您可以使用 Jon Skeet 的[Visual LINQ](http://msmvps.com/blogs/jon_skeet/archive/2008/02/20/visual-linq-watch-query-expressions-as-they-happen.aspx)以图形方式查看这一点。唯一破坏管道的是强制缓冲的东西。`OrderBy`, `GroupBy`, 等等。对于大量工作，Jon 和我自己在[Push LINQ](http://msmvps.com/blogs/jon_skeet/archive/2008/01/04/quot-push-quot-linq-revisited-next-attempt-at-an-explanation.aspx)上进行了聚合，在这种情况下没有缓冲。

`IQueryable<T>`（由大多数 ORM 工具公开 - LINQ-to-SQL、实体框架、LINQ-to-NHibernate）是一个略有不同的野兽；因为数据库引擎将完成大部分繁重的工作，所以大部分步骤可能已经完成 - 剩下的就是消耗一个`IDataReader`并将其投影到对象/值 - 但这通常仍然是一个管道（`IQueryable<T>`实现`IEnumerable<T>`) 除非你打电话`.ToArray()`等`.ToList()`。

关于在企业中使用......[我的观点](http://marcgravell.blogspot.com/2009/02/pragmatic-linq.html)是`IQueryable<T>`在存储库中编写可组合查询很好，但它们不应该*离开*存储库 - 因为这会使存储库的内部操作受调用者的影响，所以你将无法正确地进行单元测试/配置文件/优化等。我已经开始在存储库中做一些聪明的事情，但返回列表/数组。这也意味着我的存储库不知道实现。

这是一种耻辱——因为从存储库方法“返回”的诱惑`IQueryable<T>`非常大；例如，这将允许调用者添加分页/过滤器/等 - 但请记住他们实际上还没有使用数据。这使得资源管理成为一种痛苦。此外，在 MVC 等中，您需要确保*控制器*调用`.ToList()`或类似调用，以便它不是控制数据访问的视图（否则，您不能再次对控制器进行正确的单元测试）。

DAL 中过滤器的*安全*（IMO​​）使用如下：

```
public Customer[] List(string name, string countryCode) {
     using(var ctx = new CustomerDataContext()) {
         IQueryable<Customer> qry = ctx.Customers.Where(x=>x.IsOpen);
         if(!string.IsNullOrEmpty(name)) {
             qry = qry.Where(cust => cust.Name.Contains(name));
         }
         if(!string.IsNullOrEmpty(countryCode)) {
             qry = qry.Where(cust => cust.CountryCode == countryCode);
         }
         return qry.ToArray();
     }
} 
```

在这里，我们即时添加了过滤器，但在我们调用`ToArray`. 此时，数据被获取并返回（在流程中处理数据上下文）。这可以进行完全单元测试。如果我们做了类似但刚刚返回`IQueryable<T>`的事情，调用者可能会做类似的事情：

```
 var custs = customerRepository.GetCustomers()
       .Where(x=>SomeUnmappedFunction(x)); 
```

突然之间，我们的 DAL 开始失败（无法转换`SomeUnmappedFunction`为 TSQL 等）。不过，您仍然可以在存储库中做*很多*有趣的事情。

这里唯一的痛点是它可能会让你有一些重载来支持不同的调用模式（有/没有分页等）。在[可选/命名参数](http://marcgravell.blogspot.com/2008/11/immutability-and-optional-parameters.html)到达之前，我发现这里最好的答案是在接口上使用扩展方法；这样，我只需要一个具体的存储库实现：

```
class CustomerRepository {
    public Customer[] List(
        string name, string countryCode,
        int? pageSize, int? pageNumber) {...}
}
interface ICustomerRepository {
    Customer[] List(
        string name, string countryCode,
        int? pageSize, int? pageNumber);
}
static class CustomerRepositoryExtensions {
    public static Customer[] List(
          this ICustomerRepository repo,
          string name, string countryCode) {
       return repo.List(name, countryCode, null, null); 
    }
} 
```

现在我们开启了虚拟重载（作为扩展方法）`ICustomerRepository`——因此我们的调用者可以使用`repo.List("abc","def")`而无需指定分页。

* * *

最后 - 如果没有 LINQ，使用管道和过滤器会变得更加痛苦。您将编写某种基于文本的查询（TSQL、ESQL、HQL）。您显然可以附加字符串，但它不是非常“管道/过滤器”-ish。“Criteria API”稍微好一点——但不如 LINQ 优雅。

# c# - RadioButtonList SelectedItem 总是返回 EmptyString

> ID：679028
> 
> 赞同：0
> 
> 时间：2009-03-24T20:02:40.677
> 
> 标签：c#, asp.net, radiobuttonlist

我在我的 .aspx 页面中使用了这个自定义单选按钮列表，以便能够让 GroupName 实际工作，因为我将在同一个 .aspx 页面上有 2 个 RadiobuttonList 控件：

```
public class CustRadioButtonList : RadioButtonList, IRepeatInfoUser
{
    void IRepeatInfoUser.RenderItem(ListItemType itemType, int repeatIndex, RepeatInfo repeatInfo, HtmlTextWriter writer)
    {
        RadioButton radioButton = new RadioButton();
        radioButton.Page = this.Page;
        radioButton.GroupName = "radioButtonGroup";
        radioButton.ID = this.ClientID + "_" + repeatIndex.ToString();
        radioButton.Text = this.Items[repeatIndex].Text;
        radioButton.Attributes["value"] = this.Items[repeatIndex].Value;
        radioButton.Checked = this.Items[repeatIndex].Selected;
        radioButton.TextAlign = this.TextAlign;
        radioButton.AutoPostBack = this.AutoPostBack;
        radioButton.TabIndex = this.TabIndex;
        radioButton.Enabled = this.Enabled;

        radioButton.RenderControl(writer);
    }
} 
```

所以这只是一个简单的扩展，我设置 GroupName 以确保由该 RadioButtonList 创建的所有单选按钮具有相同的 GroupName，因此现在，如果有人从 RadiobuttonList1 中选择一个值，它会取消选择他们在 Radiobutton2 中选择的任何值，反之亦然（所以它们是互斥的单选按钮集）。

**注意：**单选按钮列表肯定是通过一个方法调用绑定的，该方法调用包含在对 !Page.IsPostBack 的检查中，所以这不是这里的问题。

这是我在 .aspx 页面中使用它的示例：

```
 <aj:CustRadioButtonList checked="false"  ID="rblEmail" runat="server" />

 <aj:CustRadioButtonList checked="false"  ID="rblReason" runat="server" /> 
```

在我的代码隐藏中，我正在检查页面上按钮的 onclick 中的 rblEmail 中的 selectedValue ..但即使我在列表中选择了一个项目，它也**总是返回空字符串：**

```
 protected void btnContinue_Click(object sender, EventArgs e)
    {
        _actionID = rblEmail.SelectedValue; 
```

我花了一整天的时间试图弄清楚为什么当我在 rblEmail 中明确选择了一个值时，我总是得到一个空字符串。其他单选按钮列表 rblReason 也是如此。在任何一种情况下，当从代码隐藏中检查时，我都会得到 SelectedValue 的空字符串。

如果您查看标记，它的外观如下：

```
<table id="rblEmail" checked="false" border="0">
    <tr>
        <td><input id="rblEmail_0" type="radio" name="radioButtonGroup" value="0" /><label for="rblEmai_0">All Offers</label></td>

    </tr><tr>
        <td><input id="rblEmail_1" type="radio" name="radioButtonGroup" value="1" /><label for="rblEmail_1">week</label></td>
    </tr><tr>
        <td><input id="rblEmail_2" type="radio" name="radioButtonGroup" value="2" /><label for="rblEmail_2">month</label></td>
    </tr><tr>
        <td><input id="rblEmail_3" type="radio" name="radioButtonGroup" value="3" /><label for="rblEmail_3">Holiday</label></td>
    </tr>

</table>
            </div>
...

<table id="rblReason" checked="false" border="0">
    <tr>
        <td><input id="rblReason_0" type="radio" name="radioButtonGroup" value="1" /><label for="rblReason_0">I receive</label></td>
    </tr><tr>
        <td><input id="rblReason_1" type="radio" name="radioButtonGroup" value="2" /><label for="rblReason_1">I have no need</label></td>
    </tr><tr>
        <td><input id="rblReason_2" type="radio" name="radioButtonGroup" value="3" /><label for="rblReason_2">Other</label></td>

    </tr>
</table> 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2014-01-03T18:28:35.937

似乎您正在页面加载时填充 RadioButtonList - 如果是这样 - 请确保您使用 If/Then/Postback 块包围 RadioButtonList 的填充：如果不是 Page.IsPostBack then ' 填充您的 RadioButtonList end if

例如：

```
 if (!IsPostBack)
        {
            loadradiobuttonlist();
        } 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-25T07:47:17.520

不知道为什么这不起作用，但似乎一点 javascript 会提供一个简单的解决方法。而不是自定义控件，只需使用常规 RadioButton 对象...然后附加一些 javascript 以在选择 List2 上的某些内容时清除 List1 上的选择，反之亦然。

如果您已经知道会有多少单选按钮，不知道为什么要在这里使用任何类型的中继器？（根据您上面的评论）

# c# - 将对象数组复制到不同类型的数组

> ID：679031
> 
> 赞同：1
> 
> 时间：2009-03-24T20:03:43.997
> 
> 标签：c#, arrays, object, copying

以前，我在尝试在我的 ASMX webservice 和我的 .aspx 页面（webclient）之间共享类型定义时遇到了问题

[对 C# 对象数组和隐式类型转换感到困惑](https://stackoverflow.com/questions/667619/confused-on-c-array-of-objects-and-implicit-type-conversion)

据我了解，这产生的“问题”可以通过将客户端中创建的对象数组复制到 ASMX 代理类定义的新对象数组来解决。

作为 C# 的新手，我仍在为这个简单的任务而苦苦挣扎。以下是我的代码的更多部分（上一篇文章中的其他片段保持不变）：

...这里是我填充要传递给 Web 服务的“测试数据”的地方：

```
// create an array of MetaData objects
MetaData[] nvPairs = new MetaData[20];   // arbitrary length of 20 pairs

// create arbitrary MetaData objects in the array
nvPairs[0] = new MetaData("Grant Number", "2577-9912");
nvPairs[1] = new MetaData("OPEAnalyst", "Simpson"); 
```

...在这里，我尝试使用一个函数将我的 TRIMBrokerUtil 命名空间中定义的“真实”类型（由于代理我不能完全使用）“复制”到该类型的代理版本：

```
protected TRIMBrokerASMXProxy.ASMXProxy.MetaData[] CopyMetaData(
    MetaData utilArray)
{
    TRIMBrokerASMXProxy.ASMXProxy.MetaData[] outArray = 
        new TRIMBrokerASMXProxy.ASMXProxy.MetaData[utilArray.Name.Length];
    int i;
    for (i = 0; i < utilArray.Name.Length; i++)
    {
        outArray[i].Name = utilArray.Name;
        outArray[i].Value = utilArray.Value;
    }
    return outArray;
} 
```

...然后在这里我尝试调用该函数（编译器在这一行标记了 2 个错误：

```
TRIMBrokerASMXProxy.ASMXProxy.MetaData[] kvData = 
    CopyMetaData(metaDataArray); 
```

下面的两个编译错误都指向同一行：

错误 1 ​​'_Default.CopyMetaData(TRIMBrokerUtil.MetaData)' 的最佳重载方法匹配有一些无效参数

错误 2 参数“1”：无法从“TRIMBrokerUtil.MetaData[]”转换为“TRIMBrokerUtil.MetaData”

我接近了吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-24T20:08:09.557

您已将参数声明为`MetaData`而不是`MetaData[]`- 换句话说，它不是数组。然后你使用`utilArray.Name`了很多，但不清楚为什么。

我怀疑你实际上想要：

```
protected TRIMBrokerASMXProxy.ASMXProxy.MetaData[]
    CopyMetaData(MetaData[] utilArray)
{
    TRIMBrokerASMXProxy.ASMXProxy.MetaData[] outArray = 
        new TRIMBrokerASMXProxy.ASMXProxy.MetaData[utilArray.Length];
    for (int i = 0; i < utilArray.Length; i++)
    {
        outArray[i] = new TRIMBrokerASMXProxy.ASMXProxy.MetaData();
        outArray[i].Name = utilArray[i].Name;
        outArray[i].Value = utilArray[i].Value;
    }
    return outArray;
} 
```

顺便说一句，您可能需要考虑一个`using`指令以使其更易于阅读：

```
using ProxyMetaData = TRIMBrokerASMXProxy.ASMXProxy.MetaData;

...

protected ProxyMetaData[] CopyMetaData(MetaData[] utilArray)
{
    ProxyMetaData[] outArray = new ProxyMetaData[utilArray.Length];
    for (int i = 0; i < utilArray.Length; i++)
    {
        outArray[i] = new ProxyMetaData();
        outArray[i].Name = utilArray[i].Name;
        outArray[i].Value = utilArray[i].Value;
    }
    return outArray;
} 
```

另一种选择是`Array.ConvertAll`：

```
ProxyMetaData[] output = Array.ConvertAll(input,
    metaData => new ProxyMetaData(metaData.Name, metaData.Value)); 
```

如果您不使用 C# 3，则可以使用匿名方法。如果`ProxyMetaData`没有适当的构造函数并且您使用*的是*C# 3，则可以使用对象初始化程序：

```
ProxyMetaData[] output = Array.ConvertAll(input,
    metaData => new ProxyMetaData { metaData.Name, metaData.Value }); 
```

如果您坚持使用 C# 2 并且没有合适的构造函数，那么：

```
ProxyMetaData[] output = Array.ConvertAll(input, delegate(MetaData metaData)
{
    ProxyMetaData proxy = new ProxyMetaData();
    proxy.Name = metaData.Name;
    proxy.Value = metaData.Value;
}); 
```

我*认为*这涵盖了所有基础:)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-24T20:09:28.367

我只会使用 LINQ 来执行此操作：

```
TRIMBrokerASMXProxy.ASMXProxy.MetaData[] kvData =
    metaDataArray.Select(d => 
        new TRIMBrokerASMXProxy.ASMXProxy.MetaData(
            d.Name, d.Value)).ToArray(); 
```

此外，如果您使用的是 .NET 3.5，这意味着您也可以使用 WCF，这是您应该用来生成代理的。您将能够将您的 TRIMBrokerASMXProxy.ASMXProxy.MetaData 类型与 DataContract 属性和被序列化的成员属性与 DataMember 属性。然后，您将能够使用实际类型定义您的合同，而根本不必执行转换。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-24T20:36:14.433

您也可以使用 Array.ConvertAll。我知道你对此比较陌生，所以让我试着解释一下。它有 2 个通用参数。第一个是它想要转换的数组的类型（我们称之为 I）。第二个是您要转换的类型（我们称之为 O）。它接受一个类型为 I 的数组并返回一个类型为 O 的数组。第二个参数是一个 Converter 委托。应用命名我们有它的签名就像。

```
delegate O Converter(I input); 
```

委托主体必须包含进行转换所需的代码。在 ConvertAll 函数内部，代码遍历输入数组中的每个值，然后传递给委托。然后将委托返回的值存储到输出数组中。转换所有值后，输出数组将返回给用户。

```
using ProxyMetaData = TRIMBrokerASMXProxy.ASMXProxy.MetaData;

ProxyMetaData[] convertedArray = Array.ConvertAll<MetaData, ProxyMetaData>(utilArray, 
delegate(MetaData metaData)
{
    ProxyMetaData returnValue = new ProxyMetaData();
    returnValue.Name = metaData.Name;
    returnValue.Value = metaData.Value;
    return returnValue;
}); 
```

# domain-driven-design - DDD：所以标签。实体或值类型？

> ID：679046
> 
> 赞同：11
> 
> 时间：2009-03-24T20:07:41.820
> 
> 标签：domain-driven-design

在领域驱动设计的上下文中，StackOverflow 标记（即[ddd](https://stackoverflow.com/questions/tagged/ddd)）是值对象还是实体？

编辑：

想象一下，您必须建立 SO 网站。您如何看待“标签”？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-03-24T20:12:21.027

稍微扩展一下 awhite 的答案，标签是一种值类型，为什么？因为拥有没有意义

```
var tag1 = new Tag("DDD");
var tag2 = new Tag("DDD");
Assert.AreNotEqual(tag1, tag2); 
```

显然它们应该彼此相等，因为标签除了标签之外没有任何身份。另一方面，问题和答案绝对是实体

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2011-08-11T15:33:12.920

SO 标签很可能是一个实体。可以创建、合并、删除和重命名标签。有诸如“相似标签”、用户标签等功能。其中一些功能，尤其是生命周期，将需要身份。经典的 DDD 示例，其中更改他/她名字的人仍然是同一个人，相同的身份。与用户可以决定将“域驱动设计”重命名为“DDD”的标签相同，它仍然是同一件事。标签还需要额外的属性，如, , ,`tag.Id`等`tag.Name`。`tag.CreatedOn`可能会有一个相应的标签存储库可以强制执行名称唯一性规则。`tag.CreatedBy``tag.Locked`

总而言之，SO Tag 不是 DDD 值对象，因为它是可变的并且具有生命周期。更重要的是，标签不仅是问题的特征（我认为这是其他答案所忽略的）。它参与的关系远不止于此。换句话说，**Tag 不仅仅是其属性的总和**，它还具有“概念身份”。另一方面，TagName 是值对象的完美示例。它在生活中的唯一目的是描述另一个实体（标签）。TagName 只不过是一个字符串，它可能具有一些内置规则，例如最大长度和不区分大小写的比较。简单地使用 String 代替也可能有意义。

显示问题的代码可能使用如下内容：

```
IList<TagName> tags = question.GetTags(); 
```

标记问题的代码如下所示：

```
void TagQuestion(Question q, TagName tagName) {
    Tag tag = _tagsRepository.FindByName(tagName);
    if (tag == null) {
        tag = CreateNewTag( /* capture creator, date, other rules*/);
    }
    q.AddTag(tag);
} 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-24T20:19:45.847

只是一些额外的考虑：标签可以标准化，“DDD”应该等于“ddd”和“DdD”，并且在大多数标签系统中，空格被“_”下划线替换。此外，我猜创作者将被跟踪徽章系统。

# c# - 如何在 WebService 中返回通用字典

> ID：679050
> 
> 赞同：27
> 
> 时间：2009-03-24T20:08:08.557
> 
> 标签：c#, generics

根据搜索，我想要一个返回字典的 C# 中的 Web 服务：

```
Dictionary<int, string> GetValues(string search) {} 
```

Web 服务编译得很好，但是，当我尝试引用它时，我收到以下错误：“不支持，因为它实现了 IDictionary。”

¿ 我能做些什么才能使它正常工作？任何不涉及返回 DataTable 的想法？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-08-14T23:13:42.567

没有“默认”方式来获取字典并将其转换为 XML。您必须选择一种方式，并且您的 Web 服务的客户在使用您的服务时也必须注意同样的方式。如果客户端和服务器都是 .NET，那么您可以简单地使用相同的代码在两端将字典序列化和反序列化为 XML。

[此博客文章中](http://weblogs.asp.net/pwelter34/archive/2006/05/03/444961.aspx)有执行此操作的代码。此代码使用字典的键和值的默认序列化，这在您有非字符串类型时很有用。代码使用继承来做它的事情（你必须使用那个子类来存储你的值）。[您也可以使用本文](http://msdn.microsoft.com/en-us/magazine/cc164135.aspx)最后一项中所做的包装类型方法，但请注意，该文章中的代码仅使用 ToString，因此您应该将其与第一篇文章结合使用。

因为我同意 Joel 关于 StackOverflow 是所有内容的规范来源的观点，所以下面是第一个链接中的代码副本。如果您发现任何错误，请编辑此答案！

```
using System;
using System.Collections.Generic;
using System.Text;
using System.Xml.Serialization;

[XmlRoot("dictionary")]
public class SerializableDictionary<TKey, TValue> : Dictionary<TKey, TValue>, IXmlSerializable
{
    #region IXmlSerializable Members

    public System.Xml.Schema.XmlSchema GetSchema()
    {
        return null;
    }

    public void ReadXml(System.Xml.XmlReader reader)
    {
        XmlSerializer keySerializer = new XmlSerializer(typeof(TKey));
        XmlSerializer valueSerializer = new XmlSerializer(typeof(TValue));

        bool wasEmpty = reader.IsEmptyElement;
        reader.Read();

        if (wasEmpty)
            return;

        while (reader.NodeType != System.Xml.XmlNodeType.EndElement)
        {
            reader.ReadStartElement("item");

            reader.ReadStartElement("key");
            TKey key = (TKey)keySerializer.Deserialize(reader);
            reader.ReadEndElement();

            reader.ReadStartElement("value");
            TValue value = (TValue)valueSerializer.Deserialize(reader);
            reader.ReadEndElement();

            this.Add(key, value);

            reader.ReadEndElement();

            reader.MoveToContent();
        }

        reader.ReadEndElement();
    }

    public void WriteXml(System.Xml.XmlWriter writer)
    {
        XmlSerializer keySerializer = new XmlSerializer(typeof(TKey));
        XmlSerializer valueSerializer = new XmlSerializer(typeof(TValue));

        foreach (TKey key in this.Keys)
        {
            writer.WriteStartElement("item");

            writer.WriteStartElement("key");
            keySerializer.Serialize(writer, key);
            writer.WriteEndElement();

            writer.WriteStartElement("value");
            TValue value = this[key];
            valueSerializer.Serialize(writer, value);
            writer.WriteEndElement();

            writer.WriteEndElement();
        }
    }

    #endregion
} 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-03-24T20:10:55.853

创建一个 type `MyKeyValuePair<K,V>`，并返回一个`List<MyKeyValuePair<int,string>>`，从字典中复制。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-03-24T20:14:01.727

[本文](http://msdn.microsoft.com/en-us/magazine/cc164135.aspx)有一个序列化 IDictionaries 的方法。寻找“我注意到 XmlSerializer 默认不会序列化实现 IDictionary 的对象。有什么办法解决这个问题吗？” 大约在页面下方的 2/3 处。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-03-30T18:15:29.093

我使用这个 util 类来序列化字典，也许它对你有用

```
using System.Collections.Generic;
using System.Xml;
using System.Xml.Schema;
using System.Xml.Serialization;

namespace Utils {
    ///<summary>
    ///</summary>
    public class SerializableDictionary : IXmlSerializable {
        private readonly IDictionary<int, string> dic;
        public DiccionarioSerializable() {
            dic = new Dictionary<int, string>();
        }
        public SerializableDictionary(IDictionary<int, string> dic) {
            this.dic = dic;
        }
        public IDictionary<int, string> Dictionary {
            get { return dic; }
        }
        public XmlSchema GetSchema() {
            return null;
        }
        public void WriteXml(XmlWriter w) {
            w.WriteStartElement("dictionary");
            foreach (int key in dic.Keys) {
                string val = dic[key];
                w.WriteStartElement("item");
                w.WriteElementString("key", key.ToString());
                w.WriteElementString("value", val);
                w.WriteEndElement();
            }
            w.WriteEndElement();
        }
        public void ReadXml(XmlReader r) {
            if (r.Name != "dictionary") r.Read(); // move past container
            r.ReadStartElement("dictionary");
            while (r.NodeType != XmlNodeType.EndElement) {
                r.ReadStartElement("item");
                string key = r.ReadElementString("key");
                string value = r.ReadElementString("value");
                r.ReadEndElement();
                r.MoveToContent();
                dic.Add(Convert.ToInt32(key), value);
            }
        }
    }
} 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2012-02-23T14:36:37.670

这个带有 SerializableDictionary 的解决方案效果很好，但是在工作期间你可以得到

`cannot convert from 'SerializableDictionary<string,string>' to 'System.Data.DataSet'`

错误。在这种情况下，您应该转到 Project-> Show all files，然后在 Web 服务的 Reference.cs 文件中将参数类型编辑为 SerializableDictionary。这是一个官方的微软错误，在这里更详细：

[http://support.microsoft.com/kb/815131](http://support.microsoft.com/kb/815131)

# email - 在“电子邮件提交”用例中验证用户

> ID：679060
> 
> 赞同：2
> 
> 时间：2009-03-24T20:11:51.013
> 
> 标签：email, authentication

我正在构建一个系统，除了网站上的标准访问权限外，还允许人们通过电子邮件提交文本和照片。我正在尝试权衡两种策略的安全优势，特别是用于验证用户提交的内容。它们如下：

*   基于身份验证：为每个用户创建一个秘密电子邮件地址，并将其呈现给用户以供提交。这种策略的优点是人们可以从可能使用不同邮件帐户设置的多个设备发送
*   From based auth：仅接受来自在用户数据库中注册的地址的电子邮件。这个想法是根据发送地址冒充注册用户是不切实际/困难的。

你能想到其他可能的解决方案吗？所提出的策略中哪一个对您来说最有意义？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-24T20:15:48.710

我建议您不要使用基于 From 的身份验证，至少在没有一些额外凭据（密码等）的情况下不要使用

[**伪造太容易了**](http://www.google.com/search?q=send%20fake%20email)，如果您知道某人的电子邮件地址，当然也不难。

如果您将电子邮件回显给用户以进行确认，您可能会使事情变得更加困难，但要意识到您的服务最终可能会被用作一种垃圾邮件中继。（我可以使用伪造的 FROM 地址向您发送 100 个上传请求，然后您继续向真人发送 100 个确认请求的垃圾邮件）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-24T20:19:56.470

更好的选择是检查注册的电子邮件地址，但在用户已知的电子邮件主题中添加对代码的需求。这样，如果他们伪造来自地址的电子邮件，他们仍然需要密钥来验证传入的电子邮件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-24T20:20:04.973

我会选择“来自”+确认，以避免伪造。

即接收电子邮件，但在主题行（或正文）中将带有身份验证令牌的响应发送回“发件人”地址。用户要么需要回复，要么单击链接以确认提交。

并且您仅在确认后才发布内容。

# powershell - 使用 Powershell 在 Gac 中注册文件

> ID：679064
> 
> 赞同：13
> 
> 时间：2009-03-24T20:12:42.417
> 
> 标签：powershell, gac, gacutil

是否有一种简单的方法可以在 PowerShell（我想使用 gacutil.exe）中从文本文档中读取路径\程序集并将其注册到 GAC 中？例如，一个 .txt 文件看起来像：

```
c:\test\myfile.dll
c:\myfile2.dll
d:\gac\gacthisfile.dll 
```

PowerShell 脚本会将其读入流中，然后在找到的每个程序集上运行 gacutil？我想它会是这样的：

```
#read files into array?

foreach ($file in Get-ChildItem -Filter "*.dll" )
{ 
  Write-Host $file.Name
  C:\WINDOWS\Microsoft.NET\Framework\v1.1.4322\gacutil.exe /nologo /i $file.Name
} 
```

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2011-04-11T08:17:33.557

让.Net 担心gacutil 怎么样？

```
# load System.EnterpriseServices assembly
[Reflection.Assembly]::LoadWithPartialName("System.EnterpriseServices") > $null

# create an instance of publish class
[System.EnterpriseServices.Internal.Publish] $publish = new-object System.EnterpriseServices.Internal.Publish

# load and add to gac :)
get-content fileOfDlls.txt | ?{$_ -like "*.dll"} | Foreach-Object {$publish.GacInstall($_)} 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-24T20:33:19.357

如果您整理文本文件以使每个 dll 位于单独的行上，则可以使用 Get-Content 命令并将每个文件通过管道传递到执行您的命令的过滤器：

```
filter gac-item { C:\WINDOWS\Microsoft.NET\Framework\v1.1.4322\gacutil.exe /nologo /i $_}

get-content fileOfDlls.txt | ?{$_ -like "*.dll"} | gac-item 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-25T03:40:03.590

我建议调用该函数以将程序集添加到 GAC，遵循 PowerShell 指南（如 Add-GacItem）。gacutil.exe 的位置也因您的系统而异。如果您安装了 VS 2008，它应该位于如下所示的位置。

```
function Add-GacItem([string]$path) {
  Begin {
    $gacutil="$env:ProgramFiles\Microsoft SDKs\Windows\v6.0A\bin\gacutil.exe"

    function AddGacItemImpl([string]$path) {
      "& $gacutil /nologo /i $path"
    }
  }
  Process {
    if ($_) { AddGacItemImpl $_ }
  }
  End {
    if ($path) { AddGacItemImpl $path }
  }
}

Get-Content .\dlls.txt | Split-String | Add-GacItem 
```

请注意，Split-String cmdlet 来自[Pscx](http://pscx.codeplex.com)。该函数不是超级健壮（没有通配符支持不会检查像 DateTime 这样的奇怪类型），但至少它可以处理常规调用和管道调用。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-01-27T14:17:51.103

你想替换 gacutil.exe 吗？如果没有，为什么不使用 gacutil 包含的 /il 开关？

从 gacutil /h：

```
/il <assembly_path_list_file> [ /r <...> ] [ /f ]
  Installs one or more assemblies to the global assembly cache.
  <assembly_list_file> is the path to a text file that contains a list of
  assembly manifest file paths. Individual paths in the text file must be
  separated by CR/LF.
  Example: /il MyAssemblyList.txt /r FILEPATH c:\projects\myapp.exe "My App"
    myAssemblyList.txt content:
    myAsm1.dll
    myAsm2.dll 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-24T20:29:03.203

如果您在配置文件中创建别名（只需在 ps 提示符下键入 $profile 以确定此文件位置），`new-alias "gac" ($env:ProgramFiles+"\Microsoft Visual Studio 8\SDK\v2.0\Bin\gacutil.exe")`那么您可以像这样使用 gac：

```
get-childitem $basedirectory "*$filter.dll" | foreach-object -process{ WRITE-HOST -FOREGROUND GREEN "Processing $_"; gac /i $_.FullName /f} 
```

最后一部分是最重要的。它使用您想要的开关调用 gacutil。

希望这可以帮助。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2013-03-04T20:30:17.787

此 PowerShell 脚本将在不使用 GacUtil 的情况下将程序集添加到 GAC。[http://blog.goverco.com/2012/04/use-powershell-to-put-your-assemblies.html](http://blog.goverco.com/2012/04/use-powershell-to-put-your-assemblies.html)

[下载](http://bit.ly/QA3SmZ)Add-AssemblyToGlobalAssemblyCache.ps1后，您可以部署到 gac。

添加多个程序集的使用示例`Dir C:\MyWorkflowAssemblies | % {$_.Fullname} | .\Add-AssemblyToGlobalAssemblyCache.ps1`

通过运行查看完整文档`Get-Help .\Add-AssemblyToGlobalAssemblyCache.ps1 -Detailed`

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-05-13T20:24:27.570

不想在所有需要将程序集放入 GAC 以获取 gacutil 的机器上安装 Windows 8 SDK，我使用 GAC API 编写了一个 powershell 模块。它适用于任何 .Net 版本。使用[PowerShell GAC](https://powershellgac.codeplex.com/)，您可以这样做：

```
Get-Content ListOfAssemblies.txt | Add-GacAssembly 
```

# html - Firefox 3.0.7 在使用对象标签嵌入 PDF 时崩溃

> ID：679067
> 
> 赞同：1
> 
> 时间：2009-03-24T20:13:22.353
> 
> 标签：html, firefox, pdf, object-tag

我正在尝试使用 object 标签将 PDF 文件嵌入到 HTML 页面中。以下 HTML 使 Firefox 3.0.7 崩溃：

```
<object id="pdfObject40" type="application/pdf" data="/file.ashx?id=40" width="432" height="600">
  <param name="src" value="/file.ashx?id=40" />
</object> 
```

我在 Internet Explorer 中没有问题。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-24T20:22:05.967

检查“file.ashx”脚本返回的 MIME 类型。如果它不是 application/pdf，或者 Content-Disposition 正在发送，则可能会有皱纹。

否则，它只能是（a）文档中的一些奇怪的东西——其他文档加载正常吗？— 或 (b) 您的设置。

无论如何，我个人会避免在网页中嵌入 PDF。PDF 插件是查看文档的一种非常不方便的方式，尤其是 Adob​​e Reader 插件在 IE 中历来非常不可靠，同时也是一场持续的安全灾难。我建议我所有的客户尽快卸载它。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-26T18:35:59.403

我最终将该代码用于 IE 并故障转移到 Firefox 中带有 about:blank 的链接。如果有任何解决方案，请随时添加。我会在路上接受它。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-07-21T09:05:33.750

万一其他人有这个问题，我最终在 Firefox 中使用了对象元素标签，并在其他所有东西中嵌入了元素标签。

我想如果我没有通过 .ashx 提供 PDF，我可以使用 embed 标记来处理所有内容。

请参阅：http: [//blogs.adobe.com/pdfdevjunkie/2007/08/using_the_html_embed_tag_to_di.html](http://blogs.adobe.com/pdfdevjunkie/2007/08/using_the_html_embed_tag_to_di.html)

# c# - 如果 ImageButton 没有 Image，ImageButton 事件不会触发？

> ID：679070
> 
> 赞同：1
> 
> 时间：2009-03-24T20:14:27.903
> 
> 标签：c#, asp.net

如果 ImageButton 事件找不到它的图像，它不会触发它是正常行为吗？例如，假设我有以下代码：

```
imageLink = new ImageButton();
imageLink.ImageUrl = "~/images/arrow.png"; 
```

如果页面找到arrow.png，则图片点击有效，但如果找不到，则无效。

这些图像是动态创建的，并分配了 CommandName、CommandArgument 和 Click Handler。

```
void imageLink_Click(object sender, ImageClickEventArgs e)
{
    ImageButton button = (ImageButton)sender;
    Detail oDetail = new Detail();

    switch(button.CommandName)
    {
        case "Band":
             oDetail.Band  = button.CommandArgument;
                break;
            case "State":
                oDetail.State = button.CommandArgument;
                break;
        }                    

        Session["Page2"] = oDetail;

        Response.Redirect("~/Page2.aspx");
    } 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-24T20:30:20.330

不，这不正常。我刚刚测试过，即使您从未设置`ImageUrl`按钮仍会发回。您确定该问题与事件处理无关吗？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-27T06:02:02.453

在某些情况下，它会发生图像按钮事件在没有图像的情况下有时不会触发任何人都知道此问题背后的确切原因，请在此处发布

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-29T14:30:54.590

是的，这是正确的。如果 ImageButton 没有声明 ImageUrl，它不会触发 onclick 事件。它会导致回发，但不会触发该事件。

此代码不会触发事件

```
<asp:ImageButton ID="testImgBtn" ImageUrl="" runat="server" onclick="testImgBtn_Click" /> 
```

虽然这样做：

```
<asp:ImageButton ID="testImgBtn" ImageUrl="http://www.google.it/intl/en_en/images/logo.gif" runat="server" onclick="testImgBtn_Click" /> 
```

# jboss - 如何配置JBoss服务的启动顺序（JmsActivation）

> ID：679087
> 
> 赞同：0
> 
> 时间：2009-03-24T20:20:01.790
> 
> 标签：jboss, ejb-3.0, jbossmq

当我在 JBoss 5 上部署我的应用程序时，会在启动 QueueService 之前创建 EJB。由于队列尚不可用，消息驱动 bean 的创建现在惨遭失败：

```
17:11:29,151 INFO  [EJBContainer] STARTED EJB: .....
17:11:29,266 INFO  [JndiSessionRegistrarBase] Binding the following Entries in Global JNDI:
..
..
17:11:29,928 WARN  [JmsActivation] Failure in jms activation org.jboss.resource.adapter.jms.inflow.JmsActivationSpec@11694c ...
javax.naming.NameNotFoundException: ... not bound
    at org.jnp.server.NamingServer.getBinding(NamingServer.java:771)
    at org.jnp.server.NamingServer.getBinding(NamingServer.java:779)
    at org.jnp.server.NamingServer.getObject(NamingServer.java:785)
    at org.jnp.server.NamingServer.lookup(NamingServer.java:443)
    at org.jnp.server.NamingServer.lookup(NamingServer.java:399)
    at org.jnp.interfaces.NamingContext.lookup(NamingContext.java:722)
    at org.jnp.interfaces.NamingContext.lookup(NamingContext.java:682)
    at javax.naming.InitialContext.lookup(InitialContext.java:392)
    at org.jboss.util.naming.Util.lookup(Util.java:222)
    at org.jboss.resource.adapter.jms.inflow.JmsActivation.setupDestination(JmsActivation.java:464)
    at org.jboss.resource.adapter.jms.inflow.JmsActivation.setup(JmsActivation.java:352)
    at org.jboss.resource.adapter.jms.inflow.JmsActivation$SetupActivation.run(JmsActivation.java:729)
    at org.jboss.resource.work.WorkWrapper.execute(WorkWrapper.java:213)
    at org.jboss.util.threadpool.BasicTaskWrapper.run(BasicTaskWrapper.java:260)
    at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)
    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)
    at java.lang.Thread.run(Thread.java:619)
17:11:30,027 INFO  [QueueService] Queue[/queue/....] started, fullSize=200000, pageSize=2000, downCacheSize=2000 
```

如何配置部署顺序？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-26T12:25:46.360

自己找到了答案。我在消息驱动 bean 中添加了以下注释：

```
@Depends({"jboss.messaging.destination:service=Topic,name=XxxxTopic"}) 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-01-19T10:08:11.207

```
<?xml version="1.0" encoding="UTF-8"?>

<!--
     Null persistence config.

     Use this if you don't actually want to persist anything

     $Id$
 -->

<server>

   <!-- Persistence Manager MBean configuration
       ======================================== -->

   <mbean code="org.jboss.messaging.core.jmx.NullPersistenceManagerService"
      name="jboss.messaging:service=PersistenceManager"
      xmbean-dd="xmdesc/NullPersistenceManager-xmbean.xml"/>

   <!-- Messaging Post Office MBean configuration
        ========================================= -->

   <mbean code="org.jboss.messaging.core.jmx.MessagingPostOfficeService"
      name="jboss.messaging:service=PostOffice"
      xmbean-dd="xmdesc/MessagingPostOffice-xmbean.xml">

      <depends optional-attribute-name="ServerPeer">jboss.messaging:service=ServerPeer</depends>
      <depends optional-attribute-name="TransactionManager">jboss:service=TransactionManager</depends>

      <!-- The name of the post office -->

      <attribute name="PostOfficeName">JMS post office</attribute>

      <!-- This post office is clustered. If you don't want a clustered post office then set to false -->

      <attribute name="Clustered">false</attribute>

   </mbean>

   <!-- Messaging JMS User Manager MBean config
        ======================================= -->

   <mbean code="org.jboss.jms.server.plugin.JDBCJMSUserManagerService"
      name="jboss.messaging:service=JMSUserManager"
      xmbean-dd="xmdesc/JMSUserManager-xmbean.xml">
        <depends optional-attribute-name="TransactionManager">jboss:service=TransactionManager</depends> 
   </mbean>

</server> 
```

将此保存为“null-persistence-service.xml”并将此部署/消息传递/

现在它可以工作了

# wcf - 以编程方式访问 WCF 端点 URL

> ID：679089
> 
> 赞同：1
> 
> 时间：2009-03-24T20:20:22.350
> 
> 标签：wcf, iis

我有一个 IIS 托管的 WCF 服务（如[本博](http://blogs.msdn.com/amitlale/archive/2007/05/21/hosting-wcf-service-in-iis.aspx)文中所述配置...我需要知道配置的端点的 URL 是什么。例如，给定以下配置：

```
 <system.serviceModel>
    <services>
      <service behaviorConfiguration="mexBehavior" name="Sc.Neo.Bus.Server.MessageProxy">
        <endpoint address="http://localhost:9000/MessageProxy.svc" binding="basicHttpBinding"
          contract="Sc.Neo.Bus.IMessageProxy" />
      </service>
    </services>
    <behaviors>
      <serviceBehaviors>
        <behavior name="BusWeb.Service1Behavior">
          <serviceMetadata httpGetEnabled="true" />
          <serviceDebug includeExceptionDetailInFaults="false" />
        </behavior>
        <behavior name="mexBehavior">
          <serviceMetadata httpGetEnabled="true" />
        </behavior>
      </serviceBehaviors>
    </behaviors>
  </system.serviceModel> 
```

我希望能够将值 ' `http://localhost:9000/MessageProxy.svc`' 放入 Web 应用程序的 onstart 事件中的字符串变量中。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-03T05:54:26.793

好的，所以简短的回答是“你不能”。更长的答案是你可以，有点工作。

如果您在 IIS 之外托管它，则加载配置部分本身并对其进行解析实际上是合理的，因为您可以将其转换为 WCF 配置类：

```
ServiceModelSectionGroup serviceModelGroup =
      cfg.GetSectionGroup("system.serviceModel") 
            as ServiceModelSectionGroup; 
```

有点乱，但它确实有效。问题来自 IIS - IIS 托管服务从 IIS 继承其地址，并将忽略任何配置文件中的完全限定地址。

但是您可以作弊，您可以使用自定义服务主机工厂。这确实意味着在代码或 IIS 的 .svc 文件中更改您的服务启动代码。派生自[ServiceHostFactory](http://msdn.microsoft.com/en-us/library/system.servicemodel.activation.servicehostfactory.aspx)并覆盖的自定义服务主机工厂

```
protected override ServiceHost CreateServiceHost(Type serviceType, 
                                                 Uri[] baseAddresses) 
```

如您所见，您将获得一个或多个包含您服务的（潜在）地址的 URI 对象。此时，您可以根据服务类型将它们存储在某个地方（也许是单个查找表），然后在其他地方查询。

然后在你的 .svc 文件中，你需要稍微改变一下；例如

```
<%@ServiceHost Service="MyService.ServiceName" 
               Factory="MyService.ServiceHostFactory" %>
<%@Assembly Name="MyService" %> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-10-11T22:30:51.893

如果您已经创建了服务代理的实例，则可以使用以下内容：

```
 public static Uri GetServiceUri(this IMyService proxy)
    {
        var channel = proxy as IContextChannel;
        return 
              channel != null && channel.RemoteAddress != null ? 
                 channel.RemoteAddress.Uri : null;
    } 
```

# xcode - 我应该如何构建基于 Qt 的项目，以便拥有一个干净的 qmake 生成的 xcode 项目？

> ID：679094
> 
> 赞同：2
> 
> 时间：2009-03-24T20:22:00.210
> 
> 标签：xcode, qmake

如果我在我的 .pro 文件中添加不在同一目录中的源和标头，则生成的 xcode 项目按其默认源、标头等对文件进行分组，然后将文件放在这些文件夹的子目录中，指示子目录文件在哪里。这使得非平面项目在为 xcode 生成时看起来非常难看（注意所有 Qt 示例都是平面的）。

我如何防止它这样做？还是我坚持使用丑陋的 xcode 布局或平面项目？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-25T20:59:15.057

*您可以通过在.prf*文件中添加新的 CONFIG 参数变量来为 qmake创建自己的*配置功能。*

 *看看这个[Qt wiki](http://wiki.qtcentre.org/index.php?title=Undocumented_qmake)。

此外，您似乎可以使用不同的变量名在 xcode 中生成不同的组名。

我将找出这两种方法并生成一份不错的报告。

# c - 信号量队列

> ID：679096
> 
> 赞同：7
> 
> 时间：2009-03-24T20:22:11.270
> 
> 标签：c, multithreading, blocking, semaphore, system

我正在扩展信号量的功能。当我意识到我不知道实际信号量的实现并确保我的代码正确运行时，我遇到了障碍，我需要知道这一点。

我知道信号量的工作原理是在调用 sem_wait() 并且另一个线程当前将其锁定时阻塞正在等待它的线程。然后线程被阻塞，然后被放入该信号量的等待列表中。

我的问题与 sem_post() 上发生的情况有关。下一个线程是否从等待列表中拉出，设置为锁定线程，并允许解除阻塞？或者发布的计划完全不同？

谢谢！

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-03-24T21:39:42.660

下一个要解除阻塞的`sem_wait()`线程将是操作系统决定的下一个要上下文切换的线程。没有人对订购做出任何保证；这取决于您的操作系统的调度策略。它可能是离开 CPU 时间最长的线程，或者被分配了最高“优先级”的线程，或者历史上具有某些资源使用统计信息的线程，等等。

最有可能的是，您当前的线程（调用 的线程`sem_post()`）将继续运行一段时间，直到它开始等待用户输入、阻塞另一个信号量或用完其操作系统分配的时间片。然后，操作系统将切换到一些完全不相关的进程以运行几分之一秒（可能是 Firefox 或其他东西），然后开始处理一些网络流量，给自己喝杯茶，最后，当它运行时对它，选择你感觉的任何其他线程，基于它是否基于过去的历史感觉特定线程更多地受 CPU 或 I/O 限制。

在许多操作系统中，优先考虑 I/O 绑定的进程，这些进程并没有出现很长时间。理论是新进程可能是短暂的（如果它已经存在了五个小时，那么它很可能不会在接下来的 1 毫秒内完成）所以我们不妨让它们结束。I/O-bound 进程很可能继续是 I/O-bound，这意味着它们很可能会在等待其他资源的同时很快关闭 CPU。基本上，操作系统希望找到它能够尽快完成的进程，这样它就可以重新喝茶并运行你的恶意软件。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-03-24T20:27:43.643

[信号量](http://en.wikipedia.org/wiki/Semaphore_(programming))有两个操作：

1.  `P()`获取信号量（你似乎称之为`sem_wait`）
2.  `V()`释放信号量（你似乎称之为`sem_post`）

信号量也有一个与之相关的整数，即允许通过 P() 而不阻塞的并发线程数。对 P() 的其他调用将阻塞，直到调用 V() 以释放点。

这是信号量的经典定义。

**编辑：**信号量不保证任何顺序。他们不必实际使用队列或其他 FIFO 结构。当一次只允许一个线程时，当它调用 V() 时，另一个（可能是随机的）线程将从其 P() 调用返回并继续。

# asp.net - ASP.Net 中父/子 UI 设计的最佳实践？

> ID：679100
> 
> 赞同：4
> 
> 时间：2009-03-24T20:23:42.357
> 
> 标签：asp.net, asp.net-mvc, parent-child

来自桌面客户端背景，没有真正的数据驱动网页设计经验，我正在研究 ASP.NET UI 设计以确定父/子数据的最佳 UI 模式。

在学习新的 UI 平台时，我总是倾向于尝试父/子演示，所以这就是我从这里开始的地方。认为我应该使用 ASP.NET 2.0，我正在研究构建包含父记录主列表的 UI 表单的各种方法，然后在单击父项时在页面上的第二个网格中显示相关的子记录。最终，即使是孩子的记录也是其他孩子的父母，所以我也需要处理这个问题。

想一想：具有未结订单的客户/选定客户的未结订单/选定未结订单上的行项目...就像我在 WPF 中构建相同内容的屏幕：http: [//www.twitpic.com/26w26](http://www.twitpic.com/26w26)

我见过的一些技术只是为父母创建了一个简单的老式 href 链接表，并通过一些方法调用来根据所选的父母查询孩子，而我见过的一些技术使用 ASP.NET 2.0 数据控制来解决这一切。ASP.NET 2.0 数据控件是否作弊？真正的开发人员是使用这些开箱即用的控件，还是输出自己的 HTML 以便拥有更多控制权？

此外，似乎 ASP.NET MVC 现在风靡一时，所以我认为我应该考虑这一点。当我查看一些关于它的介绍时，它似乎在时间上倒退了一步，因为看起来您必须手动创建大量 HTML 来呈现列表和数据网格，而不是能够使用 ASP.NET 2.0 控件。

我有点迷失在哪里花费我的精力。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-24T20:32:14.460

我不会评论您所要求的父/子部分，而是评论您最后询问的 WebForms vs ASP.NET MVC。

我发现使用 WebForms 进行开发***非常***烦人。每次我想做一些超出“规范”的事情时，我都必须与框架进行斗争，以使其按照我想要的方式工作。

ASP.NET MVC 极大地减轻了您的这些负担。但是，这样做的代价是拥有开箱即用的各种酷组件。所以是的，HTML 有更多的手工编码，但最终这将使您的页面开发更加愉快。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-09-17T14:45:56.973

在我问这个问题 6 个月后回到这个问题，现在我已经获得了一些 ASP.Net 网络表单的经验，我将回答我自己的问题。使用像 ListView 和 GridView 这样的实际 Asp.net 控件并不是那么难，而且我可以看到在表单上使用它们确实是一种常见的做法，而不是觉得你在作弊。当然 MVC 会迫使您使用较低级别的 html 编码，但是在 WebForms 应用程序上使用 Asp.Net 控件很好，实际上并没有我担心的那么难。

# file - 将 NSData 写入文件的最简单方法

> ID：679104
> 
> 赞同：70
> 
> 时间：2009-03-24T20:26:08.967
> 
> 标签：file, cocoa, file-io, save

```
NSData *data;
data = [self fillInSomeStrangeBytes]; 
```

我现在的问题是如何`data`以最简单的方式将其写入文件。

（我已经有一个 NSURL `file://localhost/Users/Coding/Library/Application%20Support/App/file.strangebytes`）

* * *

## 回答 #1

> 赞同：101
> 
> 时间：2009-03-24T20:30:30.890

`NSData`有一个名为的方法`writeToURL:atomically:`，它完全可以满足您的需求。查看[文档`NSData`](https://developer.apple.com/library/mac/#documentation/Cocoa/Reference/Foundation/Classes/NSData_Class/Reference/Reference.html)以了解如何使用它。

* * *

## 回答 #2

> 赞同：38
> 
> 时间：2014-05-26T06:09:25.863

请注意，写入`NSData`文件是一个 IO 操作，可能会阻塞主线程。特别是如果数据对象很大。

因此建议在后台线程上执行此操作，最简单的方法是使用 GCD，如下所示：

```
// Use GCD's background queue
dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_BACKGROUND, 0), ^{
    // Generate the file path
    NSArray *paths = NSSearchPathForDirectoriesInDomains(NSCachesDirectory, NSUserDomainMask, YES);
    NSString *documentsDirectory = [paths objectAtIndex:0];
    NSString *dataPath = [documentsDirectory stringByAppendingPathComponent:@"yourfilename.dat"];

     // Save it into file system
    [data writeToFile:dataPath atomically:YES];
}); 
```

* * *

## 回答 #3

> 赞同：30
> 
> 时间：2009-03-24T20:31:32.230

[writeToURL:atomically:](http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSData_Class/Reference/Reference.html#//apple_ref/doc/uid/20000172-CIACAEJE)或[writeToFile:atomically:](http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSData_Class/Reference/Reference.html#//apple_ref/doc/uid/20000172-CIAEAHFJ)如果你有文件名而不是 URL。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2018-02-15T18:11:22.803

如果由于任何原因保存失败，您也有[`writeToFile:options:error:`](https://developer.apple.com/documentation/foundation/nsdata/1414800-writetofile?language=objc)或[`writeToURL:options:error:`](https://developer.apple.com/documentation/foundation/nsdata/1410595-writetourl?language=objc)可以报告错误代码。`NSData`例如：

```
NSError *error;

NSURL *folder = [[NSFileManager defaultManager] URLForDirectory:NSApplicationSupportDirectory inDomain:NSUserDomainMask appropriateForURL:nil create:true error:&error];
if (!folder) {
    NSLog(@"%s: %@", __FUNCTION__, error);        // handle error however you would like
    return;
}

NSURL *fileURL = [folder URLByAppendingPathComponent:filename];
BOOL success = [data writeToURL:fileURL options:NSDataWritingAtomic error:&error];
if (!success) {
    NSLog(@"%s: %@", __FUNCTION__, error);        // handle error however you would like
    return;
} 
```

# quotes - 程序员需要哪些引号？

> ID：679108
> 
> 赞同：3
> 
> 时间：2009-03-24T20:27:36.623
> 
> 标签：quotes

我的键盘只有普通引号，没有智能引号。

我发现我在[cgi 开发中需要正常的，在](https://stackoverflow.com/questions/621874/-cgi-problem-with-web-server/622085#622085)[AWK/SED](https://stackoverflow.com/questions/678652/unable-to-filter-rows-which-contain-is-a-directory-by-sed-awk/678813#678813)中需要落后的。

**当我应该使用智能引号、正常引号和后引号时，有什么规则吗？**

显然，我需要编辑我的键盘布局以获得智能引号。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-03-24T20:36:15.057

如果您的意思```是智能引号，那么实际上称为“反引号”。智能引号是当您键入 ' 和 " 时，但会根据上下文自动获取 ' 和 ' 或 " 和 "。我不确定您将如何在 awk 或 sed 中使用智能引号。

在 shell 中，反引号，例如``command``，用于计算命令并将其中的命令结果替换为正在计算的 shell 表达式；它可用于计算和参数到另一个命令，或设置变量。为了减少歧义，您可以改用`$(command)`，这使得许多引用规则更容易制定。

在shell中，`'`和`"`也不同。`"`用于需要变量替换和转义序列的字符串。`'`表示仅包含引号内的字符的字符串，没有变量插值或转义序列。

因此，例如：

```
$ name=world
$ echo "Hello, $name"
Hello, world
$ echo 'Hello, $name'
Hello, $name
$ echo "Testing \\ escapes"
Testing \ escapes
$ echo 'Testing \\ escapes'
Testing \\ escapes
$ echo `ls`
example-file another-example
$ echo 'ls'
ls
$ echo "ls"
ls 
```

其他脚本语言，例如 Perl 和 Ruby，也有类似的规则，尽管可能会有细微的差别。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-03-24T20:42:51.813

智能引号用于漂亮的排版。它们与编程无关。

**编辑：你**需要的报价。

*   双引号：“”它们用于许多语言中的文字字符串
*   单引号：' ' 用于某些语言（如 C）中的文字字符以及用于 javascript 和 php 等语言中的字符串。（例如，如果您需要打印字符串“foo”，您可以使用`'"foo"'`）
*   反引号：在 UNIX shell 中，表示将一个命令的标准输出替换为定义另一个命令的文本行。例如`echo```date`\`可能执行 echo Sat Mar 1 09:43:00 GMT 2008 并打印 Sat Mar 1 09:43:00 GMT 2008。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-03-24T20:35:19.943

反引号在 shell/awk/perl 编程中以及在 TeX 中处理文档时被大量使用。除此之外，您可能不会经常使用它们。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-24T20:35:35.857

聪明的报价是魔鬼。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-03-24T20:35:42.127

据我所知，任何语言都不需要（甚至必须支持）“智能引号”，除非您将反引号字符称为智能引号。如果是这种情况，许多语言都支持反引号。例如，bash 和 ruby​​ 都使用反引号来进行命令替换。

回答这个问题*我应该使用智能引号和普通引号时有什么规则吗？*，是的，有一个规则（同样，假设您说“智能引号”时是指反引号）。在大多数语言中，不同类型的引用会给你不同类型的行为。规则是，了解该特定语言的行为是什么，然后选择给出该行为的引用。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-24T20:46:45.830

智能引号是文字处理器功能。当您键入“quote”时，它会自动替换为“quote”或“quote”。我认为你的命名错误。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-24T21:49:36.397

仅供参考，“智能引用”的另一个术语（我以前从未听说过），是重音。

我认为在以前的答案中已经很清楚地列出了规则。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2010-03-17T15:30:49.393

$ /usr/游戏/财富

# asp.net - 输入时动态搜索结果

> ID：679110
> 
> 赞同：0
> 
> 时间：2009-03-24T20:28:05.657
> 
> 标签：asp.net, search

我正在使用 asp.net，并且希望每次用户在文本框中输入字母时过滤搜索结果。例如，这个网站正是我想要的：http: [//www.prisjakt.nu/](http://www.prisjakt.nu/)（尝试在右上角搜索）。我试过把我的文本框和带有搜索结果的gridview放在一个更新面板中，它可以工作，但它真的很慢，我可以让它更快吗？如何？有没有关于这个的文章或东西？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-24T20:32:33.537

如果您愿意使用 jQuery，请查看[jQuery Autocomplete](http://www.pengoworks.com/workshop/jquery/autocomplete.htm)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-24T20:36:05.213

这取决于您的搜索是如何实施的。

如果您的搜索词以 A 开头，并且您在数据库中找到所有“以 A 开头”，那么用户添加了“B”并且您在数据库中搜索所有“以 AB 开头”，那么您将一遍又一遍地进行昂贵的数据库调用.

如果您改为细化搜索词（获取所有“以 A 开头”，然后细化为“以 AB 开头”），它将占用本地空间，但速度更快，因为您没有搜索整个数据集，因为您变得更具体。

# mysql - MySQL 复制：防止主服务器复制表插入

> ID：679111
> 
> 赞同：1
> 
> 时间：2009-03-24T20:28:15.310
> 
> 标签：mysql, replication

我在主服务器上有一个经常插入的日志表。我不需要将此表复制到从属服务器，实际上我已经在从属服务器上设置了复制忽略表来忽略它。

但是，这只发生在从主服务器获取所有这些插入之后。我想阻止这些插入完全发送给奴隶有两个原因：

1.  减少服务器之间的网络流量
2.  我遇到过中继日志条目被损坏的情况（并且不得不跳过损坏的条目）。考虑到日志表中插入的数量，它总是在那些插入上（无论如何都不是必需的）。

是否有可能以某种方式阻止主服务器发回特定表的日志？或者，防止插入出现在主服务器的 bin-log 文件中？我只知道忽略 master 的 bin-log 文件中的数据库。

谢谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-24T20:33:30.073

在您的代码中，在插入日志记录行之前将“SET SESSION sql_log_bin=0”发送到 MySQL。然后将其设置回1。

这种方法使您可以对何时以及何时不进行二进制日志进行细粒度控制。唯一可能的缺点是数据库用户需要超级权限。

# javascript - 将函数对象从一个窗口复制到另一个窗口

> ID：679112
> 
> 赞同：1
> 
> 时间：2009-03-24T20:28:36.480
> 
> 标签：javascript

是否可以在 Javascript 中将函数（或任何对象）从一个窗口上下文复制到另一个窗口上下文？

假设我有一个带有*框架的**父*窗口。*框架*定义了一个函数，我想将它复制到外部窗口。（这样做的一个原因是当*框架*文档导航到不同的 URL 时可以使用它。）**`foo()``foo()`**

 ***我知道我可以通过做轻松地在*父级*中创建**引用**`foo()`

 *```
function foo() { ... }    
parent.foo = foo; 
```

但是这种方法`foo()`仍然存在于*框架*文档中，并且如果*框架*被卸载，*父*级将无法使用。

 *我知道我还可以使用 Function 构造函数在*父级中创建一个新函数：*

```
parent.foo = new parent.Function(" ... "); 
```

但是，这需要我将函数作为 JS 字符串。

DOM 支持通过 将节点从一个文档移动到另一个文档`importNode()`。Javascript有类似的功能吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-24T21:19:55.733

nitko 的解决方案似乎是正确的，但需要做更多的工作。此功能似乎适用于 FF2、FF3、IE7 和 Chrome：

```
 function importFunction(fn, win) {
    var code = fn.toString();
    var params = code.match(/\(([^)]*)\)/);
    if (typeof(params[1]) !== 'undefined') {
      params = params[1].split(/\s*,\s*/);
    } else {
      params = null;
    }
    code = code.replace(/^[^{]*{/, '');
    code = code.replace(/}$/, '');
    if (params) {
      return new win.Function(params, code);
    } 
    return new win.Function(code);
  } 
```

返回的函数可以在需要的窗口中使用。就像是：

```
parent.foo = importFunction(foo, parent); 
```

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-03-24T20:52:01.090

您始终可以获取调用它的`toString()`方法的给定函数的代码：

```
parent.foo = new parent.Function( originalFunction.toString() ); 
```

虽然我不确定它在每个浏览器中都可用，但我想我已经看到它在主流浏览器和现代版本中工作。

# c++ - 无法将 OpenGL 应用程序移植到 Windows

> ID：679113
> 
> 赞同：6
> 
> 时间：2009-03-24T20:28:53.920
> 
> 标签：c++, windows, visual-studio, opengl

我正在尝试将 OpenGL 应用程序移至 Windows。

据我了解，Windows 有一个不错的 OpenGL 实现。但我开始认为它不...

具体来说，我使用数组缓冲区和[glDrawArrays](http://msdn.microsoft.com/en-us/library/dd318837(VS.85).aspx)。

当我尝试在 Visual Studio 2008 Pro 中编译我的代码时，我收到以下错误：

```
vertexbuffers.cpp(31)：错误 C3861：'glGenBuffers'：找不到标识符
vertexbuffers.cpp(32)：错误 C2065：'GL_ARRAY_BUFFER'：未声明的标识符
vertexbuffers.cpp(32)：错误 C3861：'glBindBuffer'：找不到标识符
vertexbuffers.cpp(33)：错误 C2065：'GL_ARRAY_BUFFER'：未声明的标识符
vertexbuffers.cpp(33)：错误 C2065：'GL_STATIC_DRAW'：未声明的标识符
vertexbuffers.cpp(33)：错误 C3861：'glBufferData'：找不到标识符
```

当我检查`<GL\gl.h>`（包含在 中`C:\Program Files\Microsoft SDKs\Windows\v6.0A\Include\gl`）时，我看到：

```
/* ClientArrayType */ 
/*      GL_VERTEX_ARRAY */
/*      GL_NORMAL_ARRAY */
/*      GL_COLOR_ARRAY */ 
```

**更新**，但似乎这些内容在其他地方得到了定义。

如果我无法访问这些功能，我应该如何生成缓冲区？

文档没有说这些数组类型被禁用。如何在 Windows 上访问 OpenGL的**实际实现？**

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-25T05:25:41.213

你可以试试 GLEW：

[http://glew.sourceforge.net/](http://glew.sourceforge.net/)

我很确定我在过去的某个时候使用过它，并使这种事情变得更容易和更便携。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-24T21:23:15.337

#defines 会在头文件中被注释掉，否则它们会被重复。查看 gl.h 的第 1054 行：

```
/* vertex_array */
#define GL_VERTEX_ARRAY                   0x8074 
```

如果这个#define 确实丢失了，那么您可能应该用新副本替换该文件。

如果您查看[glGenBuffers 的文档，](http://www.opengl.org/sdk/docs/man/xhtml/glGenBuffers.xml)您会发现它仅在 OpenGL 1.5 及更高版本中可用。Windows 的头文件仅随 OpenGL 1.2 提供，您应该使用扩展机制来访问更新的功能。如果您使用函数名称调用[wglGetProcAddress](http://www.opengl.org/sdk/docs/man/xhtml/glGenBuffers.xml)，例如

```
void (__stdcall *glGenBuffers)(GLsizei,GLuint*) =
    wglGetProcAddress("glGenBuffers"); 
```

然后你有一个指向函数的指针。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-24T21:36:41.963

似乎缓冲区函数仅在 Windows 上作为扩展方法可用。

OpenGL 提供[glext.h](http://www.opengl.org/registry/api/glext.h)来声明所有这些函数的指针。然后由我的应用程序使用[wglGetProcAddress](http://msdn.microsoft.com/en-us/library/dd374386(VS.85).aspx)来获取指向函数的指针。

例如：

```
PFNGLGENBUFFERSPROC myglBindBuffers = 
    (PFNGLGENBUFFERSPROC)wglGetProcAddress("glGenBuffersARB"); 
```

值得庆幸的是，我只需要为大约 4 个功能执行此操作。不幸的是，我现在必须在我的应用程序中添加与平台相关的代码。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-11-10T17:35:58.980

Microsoft 对 OpenGL 的支持仅从 OpenGL-1.1 延伸到 Windows XP，而 OpenGL-1.4 从 Vista 开始。任何超出这些功能的 OpenGL 功能都必须由可安装客户端驱动程序 (ICD) 提供和支持，即 GPU 驱动程序的 OpenGL 实现。为了访问高级功能，OpenGL 提供了所谓的*扩展系统*，由*wglGetProcAddress 组成*，它有点像 DLL 的*GetProcAddress*，但可以访问 OpenGL 实现的功能（=驱动程序）。

为了让事情变得更简单，已经开发了像 GLEW 这样的优秀包装库，它们完成所有繁重的工作，初始化所有可用的 OpenGL 扩展，并将它们提供给最终用户。

# php - 防止浏览器重新发送表单信息

> ID：679114
> 
> 赞同：0
> 
> 时间：2009-03-24T20:29:00.723
> 
> 标签：php, browser

有谁知道阻止浏览器要求用户重新发送表单信息的方法。

我知道您可以使用以下命令重定向浏览器：

```
<php
    header("location http://example.com");
?> 
```

但这似乎效率很低，需要 2 个请求。

希望你能帮忙。

**重复**：[如何阻止“返回”和“刷新”按钮重新提交我的表单？](https://stackoverflow.com/questions/665399/how-do-i-stop-the-back-and-refresh-buttons-from-resubmitting-my-form)

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-24T20:32:44.473

要么像您的示例一样重定向，要么首先使用 AJAX 提交表单。浏览器无法在不请求相同页面的情况下请求相同页面。

不重新提交数据与请求不同的页面是一样的，所以你有点卡住了。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-24T20:33:22.570

据我所知，对于 POST 请求中的这种行为，您实际上无能为力。重定向，可能看似低效，实际上是最好的方法。你告诉浏览器你已经完成了发布请求所需的所有工作，现在你将把它发送到一个永远不会改变的页面，无论你调用它多少次，使它很容易成为书签和可重复使用的。

# c# - 在 C# 中将空项添加到自定义对象的下拉列表中

> ID：679128
> 
> 赞同：6
> 
> 时间：2009-03-24T20:31:37.910
> 
> 标签：c#, asp.net

我们将自定义对象列表绑定到 C# 中的 ASP.NET DropDownList，但我们希望允许 DropDownList 最初没有选择任何内容。这样做的一种方法可能是创建一个中间字符串列表，用空字符串填充第一个字符串，然后用自定义对象信息填充列表的其余部分。

但是，这似乎不太优雅，有人有更好的建议吗？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-03-24T20:33:50.167

是的，像这样创建您的列表：

```
<asp:DropDownList ID="Whatever" runat="server" AppendDataBoundItems="True">
    <asp:ListItem Value="" Text="Select one..." />
</asp:DropDownList> 
```

（注意使用**`AppendDataBoundItems="True"`**）

然后当你绑定时，绑定的项目被放在空项目之后而不是替换它。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-03-24T20:34:46.090

您可以添加到数据绑定事件：

```
protected void DropDownList1_DataBound(object sender, EventArgs e)
        {
            DropDownList1.Items.Insert(0,new ListItem("",""));
        } 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-24T20:45:39.887

实际上只是在研究这个，这就是我到目前为止所得到的（以及一些数据绑定的好东西）

```
public interface ICanBindToObjectsKeyValuePair {
    void BindToProperties<TYPE_TO_BIND_TO>(IEnumerable<TYPE_TO_BIND_TO> bindableEnumerable, Expression<Func<TYPE_TO_BIND_TO, object>> textProperty, Expression<Func<TYPE_TO_BIND_TO, object>> valueProperty);
}

public class EasyBinderDropDown : DropDownList, ICanBindToObjectsKeyValuePair {
    public EasyBinderDropDown() {
        base.AppendDataBoundItems = true;
    }
    public void BindToProperties<TYPE_TO_BIND_TO>(IEnumerable<TYPE_TO_BIND_TO> bindableEnumerable,
        Expression<Func<TYPE_TO_BIND_TO, object>> textProperty, Expression<Func<TYPE_TO_BIND_TO, object>> valueProperty) {
        if (ShowSelectionPrompt)
            Items.Add(new ListItem(SelectionPromptText, SelectionPromptValue));
        base.DataTextField = textProperty.MemberName();
        base.DataValueField = valueProperty.MemberName();
        base.DataSource = bindableEnumerable;
        base.DataBind();
    }
    public bool ShowSelectionPrompt { get; set; }
    public string SelectionPromptText { get; set; }
    public string SelectionPromptValue { get; set; }
    public virtual IEnumerable<ListItem> ListItems {
        get { return Items.Cast<ListItem>(); }
    }
} 
```

请注意，您可以做的一件事是

```
dropDown.BindToProperties(myCustomers, c=>c.CustomerName, c=>c.Id); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-30T21:18:48.167

第一的：

DropDownList1.Items.Clear();

然后将 listItems 添加到 dropDownList。

这可以防止 dropDownList 每次在回发或异步回发中呈现时获取不断增加的项目列表。

# sql-server - Microsoft SQL Server 2008 中 JOIN 与 APPLY 的相对效率

> ID：679137
> 
> 赞同：2
> 
> 时间：2009-03-24T20:32:47.563
> 
> 标签：sql-server, sql-server-2008, join, apply

我们刚刚开始考虑从 SQL 2000 迁移到 SQL 2008，并注意到新的 CROSS APPLY 和 INNER APPLY 语法允许针对表值参数化 UDF 或相关子查询的“连接”形式。

显然，能够将逻辑封装在 UDF 中并能够在不同的查询中重用它会很好，但我确信功能是有代价的。

我在网上看了很多次，但我找不到任何性能指标来表明在使用基于 APPLY 的查询时，如果你内联相同的查询，你可能会得到多少性能影响。

我知道确切的影响将在很大程度上取决于特定的模式和查询，但我很好奇是否有人有任何调整现实世界系统的经验来分享这一点。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-24T20:49:12.890

我在一些地方使用 APPLY。如果必须这样做，强制逐行处理而不是循环很有用。

奇怪的是，在一个地方它效率更高（当使用分析器查看读取时），因为优化器将 UDF 视为黑盒并根据需要应用过滤器。

udf 是一个内联表值函数，当它在 JOIN 中展开/取消嵌套时会更糟，因为优化器将查询视为一个整体并在不同的地方应用了过滤器。

否则，我会谨慎使用它或在不经常运行的代码上使用它......并验证它不会杀死真的很糟糕。我接受命中以获得可维护性。

题外话：封装仅在数据库中进行到此为止：在某些时候您会失去基于集合的优势。

# .net - 您使用什么工具来进行合同设计？

> ID：679138
> 
> 赞同：4
> 
> 时间：2009-03-24T20:32:57.610
> 
> 标签：.net, code-contracts, design-by-contract, microsoft-contracts

我曾经使用[Microsoft CodeContracts](http://research.microsoft.com/en-us/projects/contracts/)三周，现在我的一半代码只是合同。我有几十个未经证实的地方，我不能使用运行时检查，因为 IL 重写会阻止覆盖工具显示某些内容，并且编译时间少于可以接受的时间。

我不喜欢这个。现在似乎是寻求帮助的好时机。什么工具用于您的常规开发？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-01T02:32:12.867

[Spec#](http://research.microsoft.com/en-us/projects/specsharp/) - 我自己没有尝试过，但我听说它非常棒。上面有一个很好的 DotNetRocks 播客，可以很好地在上班途中收听。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-07-17T22:39:22.360

我使用带有代码合同的 Visual Studio 2010。我每天都在使用一个包含 20 个大型项目的解决方案。是的，运行时检查会减慢编译时间。但我接受惩罚以获得更可靠的代码。我注意到您的消息是在 2010 年 1 月发布的。一年多之后，您可能会发现最新版本的 Code Contracts 重写器更快一些。但不要指望那里会出现奇迹。

此外，他们还改进了代码覆盖率报告使用代码合同的代码的方式。因此，如果这是最困扰您的一点，请务必使用最新版本再试一次。

# delphi - Delphi、TWebBrowser 和 IE8 -> 应用程序在关闭时冻结

> ID：679139
> 
> 赞同：1
> 
> 时间：2009-03-24T20:33:05.860
> 
> 标签：delphi, internet-explorer-8, browser

在我们的应用程序中，我们在 TWebBrowser 组件中显示网页。

安装 IE8 后，我们的一些应用程序开始在关闭时停止响应。我们发现以下情况属实：

*   仅当网页已显示时才会冻结
*   冻结的应用程序取决于显示的 url。如果我们在两个应用程序之间切换 url，正在工作的应用程序会冻结，而另一个会正常关闭。

有没有人经历过类似的事情？

一个冻结应用程序的网址：[http](http://www.finale.no/arsoppgjor)
://www.finale.no/arsoppgjor 一个不冻结应用程序的网址：[http ://www.finale.no/avstemming_meldinger](http://www.finale.no/avstemming_meldinger)

** 更新 **

我们现在找到了一种模式，一种有点奇怪的模式，但它同样是一种模式......当我们显示的页面包含图像并且图像被缩放时，我们的应用程序会冻结。现在，我们将只删除或重新缩放图像。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-25T07:57:46.403

远射：您是否将 OleInitialze OleUinitialze 放入您的应用程序中？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-24T20:40:30.913

听起来可能有线程死锁。当应用程序死锁时，我会在您的应用程序上运行 SysInternals Process Explorer。添加对 Microsoft 符号的引用（选项 -> 配置符号）。现在双击该进程，然后选择“线程”选项卡。查看 IE 的线程，看看你是否能找出一个是否死锁以及为什么会死锁，尤其是从堆栈中。

我建议在 Process Explorer 而不是 Delphi 调试器中执行此操作，因为 Process Explorer 理解 Microsoft 符号。

# c++ - 如何设置 Winsock UDP 套接字？

> ID：679145
> 
> 赞同：18
> 
> 时间：2009-03-24T20:34:39.087
> 
> 标签：c++, winapi, sockets, udp, winsock

我想创建一个只向客户端发送数据的 Winsock UDP 套接字。我希望内核为我选择一个可用的端口。另一方面，我想指出要使用哪个本地 IP，因为我正在运行一些网卡。

我尝试过梳理套接字选项的迷宫，以及将套接字地址中的端口绑定设置为 0 均无济于事。

我的代码在 Win32 C++ 中。

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-03-24T22:37:27.233

请原谅缺乏错误检查：

```
char pkt[...];
size_t pkt_length = ...;
sockaddr_in dest;
sockaddr_in local;
WSAData data;
WSAStartup( MAKEWORD( 2, 2 ), &data );

local.sin_family = AF_INET;
local.sin_addr.s_addr = inet_addr( <source IP address> );
local.sin_port = 0; // choose any

dest.sin_family = AF_INET;
dest.sin_addr.s_addr = inet_addr( <destination IP address> );
dest.sin_port = htons( <destination port number> );

// create the socket
SOCKET s = socket( AF_INET, SOCK_DGRAM, IPPROTO_UDP );
// bind to the local address
bind( s, (sockaddr *)&local, sizeof(local) );
// send the pkt
int ret = sendto( s, pkt, pkt_length, 0, (sockaddr *)&dest, sizeof(dest) ); 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2017-03-07T22:09:21.987

Graeme Perrow 的答案不再起作用，因为 inet_addr 已被弃用。像这样使用inet_pton：

```
#include <string>
#include <WinSock2.h>
#include <Ws2tcpip.h>

#pragma comment(lib, "ws2_32.lib")
using namespace std;

int main() {
    const char* pkt = "Message to be sent";
    const char* srcIP = < source IP address >;
    const char* destIP = < destination IP address >;
    sockaddr_in dest;
    sockaddr_in local;
    WSAData data;
    WSAStartup(MAKEWORD(2, 2), &data);

    local.sin_family = AF_INET;
    inet_pton(AF_INET, srcIP, &local.sin_addr.s_addr);
    local.sin_port = htons(0);

    dest.sin_family = AF_INET;
    inet_pton(AF_INET, destIP, &dest.sin_addr.s_addr);
    dest.sin_port = htons(< destination port number >);

    SOCKET s = socket(AF_INET, SOCK_DGRAM, IPPROTO_UDP);
    bind(s, (sockaddr *)&local, sizeof(local));

    sendto(s, pkt, strlen(pkt), 0, (sockaddr *)&dest, sizeof(dest));

    closesocket(s);
    WSACleanup();

    return 0;
} 
```

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-03-24T22:04:17.483

不是直接的“HowTo”，但我一直在使用一个名为“ACE（自适应通信环境”）的开源库来进行所有 TCP 和 UDP 套接字编程，发现它非常有用且功能强大。它采用“软件模式”的方法来提供构建块来解决您的特定问题。我能够使用他们的 UDP 封装连接到给定端口，并将回复发送到系统选择的空闲端口。或者，如果您愿意，您可以指定返回端口。ACE 可在此处获得: [王牌主页](http://www.cs.wustl.edu/~schmidt/ACE.html)

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-03-24T23:31:01.673

当你说“我想指明使用哪个本地 IP，因为我正在运行几个 nic”时，你的意思是要指定 ip 地址，还是要指定 nic 并使用关联的 ip 地址?

如果您尝试指定 nic，[这个问题](https://stackoverflow.com/questions/335607/how-do-i-make-an-outgoing-socket-to-a-specific-network-interface/335662)应该是相关的。

# vb.net - vb.net中的定时器控制

> ID：679147
> 
> 赞同：0
> 
> 时间：2009-03-24T20:35:03.283
> 
> 标签：vb.net, timer

我在 vb.net 中有一个计时器，它的间隔是 1000ms ，。我在它的 timer_tick 事件中放置了一个代码，该代码将打印屏幕并将其保存到数据库中。

问题是当我在表单之外单击，或者将鼠标的焦点移到包含该计时器/打印屏幕的表单上时，计时器停止。结果，打印屏幕也停止了。

这是它的属性：

```
generate member = true
interval = 1000
modifiers = friend 
```

我将不胜感激有关此问题的任何回复或提示。谢谢你。，

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-24T20:44:30.827

`Timer`使用with创建表单的简单测试

`Interval = 1000, Enabled = True`

以及表格中的以下代码

```
Dim i As Integer = 0

Private Sub Timer1_Tick(ByVal sender As System.Object, _
                        ByVal e As System.EventArgs) Handles Timer1.Tick
    Debug.WriteLine(i)
    i += 1
End Sub 
```

`Tick`无论表单是否具有焦点，都继续（并产生输出）。

您确定您没有调用`Stop()`或设置代码`Enabled`中`False`的任何位置吗？

我建议在您调用`Stop()`或更改的任何地方放置一个断点`Enabled`；然后您可以查看当表单失去焦点时是否正在执行这些行。

# asp.net-mvc - 用于非标准路由的 Html.ActionLink

> ID：679158
> 
> 赞同：0
> 
> 时间：2009-03-24T20:36:46.430
> 
> 标签：asp.net-mvc, routing

我有一个这样的路线定义：

```
routes.MapRoute(
    "Pagesize",
    "{controller}/{action}/pagesize/{pagesize}",
    new { controller = "Home", action = "Index", pagesize = 10 }
); 
```

当我使用

```
<%= Html.ActionLink("MyText", "myaction", new { pagesize = 10 }) %> 
```

它呈现为

```
<a href="/myaction/?pagesize=10">MyText</a> 
```

我可以理解我在滥用 ActionLink，因为 /pagesize/ 介于两者之间。如何正确使用它来创建链接？

```
<a href="/myaction/pagesize/10">MyText</a> 
```

请注意，我使用的是 mvc RC2 而没有其他帮助库。RC2 中不再存在通用 ActionLink。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-24T21:13:12.910

尝试：

```
<%= Html.RouteLink("MyText", "Pagesize", new { controller = "Home", action = "Index", pagesize = 10 })%> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-24T20:44:41.963

您是否尝试过在 map route 命令中指定默认值

```
routes.MapRoute("Pagesize",
"{controller}/{action}/pagesize/{pagesize}",
new {pagesize = 10 },
new { controller = "Home", action = "Index" }); 
```

# documentation - DataContractSerializer 文档

> ID：679160
> 
> 赞同：0
> 
> 时间：2009-03-24T20:37:54.133
> 
> 标签：documentation, datacontractserializer

我正在为 DataContractSerializer 寻找一个很好的深度文档/操作方法。谷歌出现了许多相关的文章，但没有什么让我跳出来。（我不是在寻找[MSDN 链接](http://msdn.microsoft.com/en-us/library/system.runtime.serialization.datacontractserializer.aspx)）

一点说明：我从未在 .NET 中使用序列化，但有一个工作应用程序需要更新/修改。我有一个相当好的想法，如果*我设计了序列化系统，**我*将如何做我需要做的事情*但我宁愿不要在一堆 MSDN 类文档中寻找他们希望我如何做到这一点。MSDN 的东西可以很好地弄清楚某些东西是如何工作的（就像谷歌一样，因为那时你对谷歌有一个特定的术语）我想要的是一个做得好的“这是它是如何工作的，这是所有细节”文档在向我展示如何将这些部分组合在一起而不是弄清楚它们是如何工作的。恐怕我正在寻找的是“当我看到它时我会知道它”的东西，而我从来没有幸运地在谷歌上搜索过这种东西。*

 *我对人们使用过并且个人认为非常有用的特定页面特别感兴趣。*如果你现在（在去谷歌之前）正在考虑一些特别的事情，那就是我正在寻找的东西。如果不...*

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-11T04:17:28.953

试试这个 MSDN 链接， http: [//msdn.microsoft.com/en-us/library/ms733127.aspx](http://msdn.microsoft.com/en-us/library/ms733127.aspx)

> 但我宁愿不要在一堆 MSDN 类文档中寻找他们希望我如何做到这一点。

是微软，你期待什么？？？您应该按照他们想要的方式使用它。:)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-24T20:40:30.977

[这篇文章](http://www.danrigsby.com/blog/index.php/2008/03/07/xmlserializer-vs-datacontractserializer-serialization-in-wcf/)很有帮助，因为它展示了`DataContractSerializer`对比的好处`XmlSerializer`。这是我在学习 WCF 和`DataContractSerializer`.

不要贬低，但谷歌搜索不是获取此类信息的最佳方式吗？最有用和信息最丰富的链接将在第一页上，因为这些链接将是链接和访问最多的。

# asp.net - ASP.Net 向导控件、DataBinding、ViewState 和 PostBacks

> ID：679161
> 
> 赞同：0
> 
> 时间：2009-03-24T20:37:58.517
> 
> 标签：asp.net

我有一个向导控件，每个步骤都有一个用户控件。当然，第一步 IsPostBack 在页面首次加载时为 false。但是当进行下一步时，IsPostBack 总是正确的。由于您不能使用 IsPostBack，因此确定何时在一个步骤中对每个控件进行数据绑定并在逐步执行时维护视图状态的最佳模式是什么？我可能会补充说，向导中的用户控件在代码中绑定到 DataSource，而不是作为 ascx 标记的一部分。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-24T20:40:13.597

如果您对一个在第一页加载时具有视图状态的控件进行数据绑定，那么您将不需要在回发时再次进行数据绑定。

# python - 为什么 windows 会给出 sqlite3.OperationalError 而 linux 不会？

> ID：679162
> 
> 赞同：3
> 
> 时间：2009-03-24T20:38:04.460
> 
> 标签：python, windows, linux, sqlite

# 问题

我有一个使用[storm 0.14](http://storm.canonical.com)的程序，它在windows上给了我这个错误：

```
sqlite3.OperationError：数据库表被锁定

```

问题是，在 linux 下它可以正常工作。

我的印象是它只有在完成一定数量的更改后才会发生，就像在某些代码中发生的那样，它会复制很多对象。

打开调试模式在 Windows 上给了我这个：

```
83 执行：'更新常规订单产品设置折扣=？在哪里常规order_product.order_id =？AND regularorder_product.product_id = ?', (Decimal("25.00"), 788, 274)
84 完成
85 执行：'更新重复订单集 nextDate=？WHERE repeat_orders.id = ?', (datetime.date(2009, 3, 31), 189)
86 错误：数据库表被锁定

```

在 Linux 上：

```
83 执行：'更新常规订单产品设置折扣=？在哪里常规order_product.order_id =？AND regularorder_product.product_id = ?', (Decimal("25.00"), 789, 274)
84 完成
85 执行：'更新重复订单集 nextDate=？WHERE repeat_orders.id = ?', (datetime.date(2009, 3, 31), 189)
86 完成

```

# 系统信息

*视窗*

*   视窗 XP SP 3
*   Python 2.5.4
*   NTFS 分区

*Linux*

*   Ubuntu 8.10
*   Python 2.5.2
*   ext3 分区

# 一些代码

```
def createRegularOrderCopy(self):
    newOrder = RegularOrder()
    newOrder.date = self.nextDate
    # the exception is thrown on the next line,
    # while calling self.products.__iter__
    # this happens when this function is invoked the second time
    for product in self.products:
        newOrder.customer = self.customer
        newOrder.products.add(product)
        return newOrder

orders = getRepeatedOrders(date)
week = timedelta(days=7)

for order in orders:
    newOrder = order.createRegularOrderCopy()
    store.add(newOrder)
    order.nextDate = date + week 
```

# 问题

windows 和 linux 之间的 sqlite3/python 有什么不同吗？这个错误可能是什么原因，我该如何解决？

# 另一个观察

`COMMIT`在发生错误的地方添加 a时，会引发此错误：`sqlite3.OperationalError: cannot commit transaction - SQL statements in progress`

# 答案的答案

我没有使用多个线程/进程，因此并发应该不是问题，而且我只有一个 Store 对象。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-24T20:48:23.703

“数据库表被锁定”错误通常是 SQLite 中的一般/默认错误，因此缩小问题范围并不明显。

你能执行*任何*SQL 查询吗？我将从那里开始，并让一些基本的 SELECT 语句正常工作。这可能只是权限问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-24T20:51:23.540

很难说没有关于数据库访问结构的更多信息（使用 Storm 有点模糊）。

*我会先阅读这些文件；它们包含非常相关的信息：*

1.  [https://storm.canonical.com/Manual#SQLite%20and%20threads](https://storm.canonical.com/Manual#SQLite%20and%20threads)

2.  [http://sqlite.org/lockingv3.html](http://sqlite.org/lockingv3.html)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-24T21:19:51.193

您是否正在运行任何类型的防病毒扫描程序？防病毒扫描程序会在文件更新后经常锁定文件，以便他们可以在不更改文件的情况下对其进行检查。这可以解释为什么在进行大量更改后会出现此错误；防病毒扫描程序有更多新数据要扫描。

如果您正在运行防病毒扫描程序，请尝试将其关闭并查看是否可以重现此问题。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-24T22:03:16.520

在我看来，storm 已经被破坏了，尽管我的第一个猜测是按照 Brian 的建议进行病毒扫描。

您是否尝试过`sqlite3_busy_timeout()`将超时设置得非常高？这可能会导致`SQLite3`锁持有者（无论是谁）等待足够长的时间来释放锁。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-25T06:04:53.380

目前我已经通过用最新版本替换 sqlite3-dll 解决了这个问题。我仍然不确定这是否是 sqlite 的 windows 代码中的错误，或者 python 在 windows 上安装的版本是否比在 linux 上的旧版本。

谢谢你的帮助。

# linq - 加入linq

> ID：679168
> 
> 赞同：0
> 
> 时间：2009-03-24T20:40:41.413
> 
> 标签：linq, entity-framework

是否可以在 linq 中进行连接，并且仅从存在另一个键的一个数据集中返回数据，有点像：

```
 var q = from c in customers
            join o in orders on c.Key equals o.Key
            select new {c.Name, o.OrderNumber}; 
```

然后不是只返回两条记录，而是返回客户，例如：

```
 var q = from c in customers
                join o in orders on c.Key equals o.Key
                select c; 
```

当我尝试做（类似的事情）时，我收到此错误：指定的 LINQ 表达式包含对与不同上下文关联的查询的引用。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-10-28T17:35:42.270

是否会在 EF 4.0 中从多个上下文创建连接？

例如：

```
TestModelEntities e1 = new TestModelEntities();
        TestModelEntities e2 = new TestModelEntities();

        var d = from firme1 in e1.firme
                join g in e2.grad on firme1.grad.grad_id equals g.grad_id
                select firme1; 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-24T20:54:37.370

我假设您已经跳过了涉及订单表的 Where 子句（否则连接将毫无意义）

在这种情况下，您可以让 Linq 推断连接。

```
var q = from c in customers
       where c.Orders.Any(o=> o.ProductCode == productCode)
       select c; 
```

如果您定义了外键，Linq2Sql 将自动创建 Orders 属性；我相信使用实体框架，您必须手动指定它。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-25T17:09:02.053

该错误表明另一个问题：
如果您使用 Linq to SQL，则必须在查询中的每个对象上使用相同的 DataContext。

你的代码应该看起来像这样：

```
using (MyDataContext dc = new MyDataContext())
{
    var q = from c in dc.customers
            join o in dc.orders on c.Key equals o.Key
            select c;

    // process q within the DataContext
    // the easies would be to call q.ToList()
} 
```

# c# - 组合 URI 和路径

> ID：679171
> 
> 赞同：18
> 
> 时间：2009-03-24T20:42:19.287
> 
> 标签：c#, .net, web-services

我正在改造一个应用程序以使用 PHP HTTP 代理（用于缓存）而不是实际的 API 服务器，该应用程序当前将服务器 URI 和路径与代码结合起来：

```
methodUri = new Uri(apiUri, method.Path) 
```

在哪里：

*   **apiUri** = " [http://api.eve-online.com/](http://api.eve-online.com/) " (System.Uri 对象)
*   **method.Path** = "/char/SkillIntraining.xml.aspx" (字符串)

上述语句的结果是

```
"http://api.eve-online.com/char/SkillIntraining.xml.aspx" (System.Uri Object) 
```

要使用 PHP HTTP 代理，必须将请求更改如下

*   **apiUri** = " [http://www.rs.co.uk/eproxy.php](http://www.r-s.co.uk/eproxy.php) " (System.Uri 对象)
*   **method.Path** = "/char/SkillIntraining.xml.aspx" (字符串)

我期待的输出是：

```
"http://www.r-s.co.uk/eproxy.php/char/SkillIntraining.xml.aspx" (System.Uri Object) 
```

但是我得到的输出是：

```
"http://www.r-s.co.uk/char/SkillIntraining.xml.aspx" (System.Uri Object) 
```

我知道这是构造函数 Uri(Uri, string) 的正确功能，我的问题是什么是更好的函数或构造函数来代替它来获得我期望的输出？我尝试删除 method.Path 中的前导“/”，将其从绝对路径转移到相对路径，但这没有帮助。

***注意：****下面的两个解决方案都可以工作，但是 System.UriBuilder 提供了一种更强大的机制来组合 URI 和路径，在我的例子中，与使用 System.Uri 相比，对资源的更改更少。如果我可以选择，我会将两个答案都标记为正确。*

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2009-03-24T21:01:26.713

不要使用 Uri 对象，使用[UriBuilder](http://msdn.microsoft.com/en-us/library/system.uribuilder.aspx) - 它可以更好地处理丢失的斜线

所以

```
Uri apiUri = new Uri("http://www.r-s.co.uk/eproxy.php");
string methodPath = "/char/SkillIntraining.xml.aspx";

System.UriBuilder uriBuilder = new System.UriBuilder(apiUri);
uriBuilder.Path += methodPath;

Console.WriteLine(uriBuilder.Uri.ToString()); 
```

按预期工作并产生[http://www.rs.co.uk/eproxy.php/char/SkillIntraining.xml.aspx](http://www.r-s.co.uk/eproxy.php/char/SkillIntraining.xml.aspx)

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-03-24T20:50:40.203

将尾随“/”添加到 apiUri，并从 method.Path 中删除前导“/”：

```
Uri apiUri = new Uri("http://www.r-s.co.uk/eproxy.php/");
string path = "char/SkillIntraining.xml.aspx";
Uri uri = new Uri(apiUri, path);
Console.WriteLine(uri.ToString()); 
```

将打印：

```
http://www.r-s.co.uk/eproxy.php/char/SkillIntraining.xml.aspx 
```

# windows - Windows 工作流：EventHandlersActivity 未完成

> ID：679176
> 
> 赞同：0
> 
> 时间：2009-03-24T20:43:45.150
> 
> 标签：windows, workflow

我有一个带有 EventHandlingScopeActivity (UpdateListenerScope) 的自定义工作流活动。

EventHandlingScopeActivity 内部是一个主 SequenceActivity (UpdateListenerSequenceActivity) 和一个 EventHandlersActivity (UpdateHandlers)。

当主 SequenceActivity 完成时，有时 EventHandlersActivity 将无法完成并允许 EventHandlingScopeActivity 完成，以便工作流继续进行下一个活动。

奇怪的是，有时 UpdateHandlers 完成，而其他时候却没有。我无法预测或控制 UpdateHandlers 何时会保持挂起状态。

这是典型的工作流跟踪日志（一切正常完成，**关键步骤以粗体显示**）：

System.Workflow.Runtime 信息：1：工作流运行时：调度程序：InstanceId：78f436b4-9f97-4d2b-a3dc-add8acf15c79：运行计划条目：SubscriptionEvent((1)serviceQueueActivity1.UpdateListenerSequenceActivity, ActivityStatusChange('(1)serviceQueueActivity1.UpdateListenerSequenceActivity', Executing, Succeeded)) System.Workflow.Runtime 信息：0：Activity Status Change - Activity：serviceQueueActivity1.UpdateListenerSequenceActivity Old:Executing；新：已关闭 System.Workflow.Runtime 信息：1：工作流运行时：调度程序：InstanceId：78f436b4-9f97-4d2b-a3dc-add8acf15c79：调度条目：SubscriptionEvent((1)serviceQueueActivity1.UpdateListenerScope, ActivityStatusChange('(1)serviceQueueActivity1.UpdateListenerSequenceActivity ', Closed, Succeeded)) System.Workflow.Runtime Information: 1 : Workflow Runtime: **System.Workflow.Runtime 信息：1：工作流运行时：调度程序：InstanceId：78f436b4-9f97-4d2b-a3dc-add8acf15c79：调度条目：SubscriptionEvent((1)serviceQueueActivity1.UpdateHandlers, ActivityStatusChange('(1)serviceQueueActivity1.UpdateHandlers', Executing , 成功))** System.Workflow.Runtime 信息：1：工作流运行时：调度程序：InstanceId：78f436b4-9f97-4d2b-a3dc-add8acf15c79：完成运行计划条目：SubscriptionEvent((1)serviceQueueActivity1.UpdateHandlers, System.EventArgs) System.Workflow.Runtime信息：1：工作流运行时：调度程序：InstanceId：78f436b4-9f97-4d2b-a3dc-add8acf15c79：运行计划条目：SubscriptionEvent((1)serviceQueueActivity1.UpdateHandlers, ActivityStatusChange('(1)serviceQueueActivity1.UpdateHandlers', Executing, Succeeded)) System.Workflow.Runtime 信息：0：活动状态更改 - 活动：serviceQueueActivity1.UpdateHandlers Old:Executing；新：已关闭 System.Workflow.Runtime 信息：1：工作流运行时：调度程序：InstanceId：78f436b4-9f97-4d2b-a3dc-add8acf15c79：调度条目：SubscriptionEvent((1)serviceQueueActivity1\. 活动状态变化——活动：serviceQueueActivity1.UpdateListenerScope Old:Executing；新：关闭

这是工作流跟踪日志 UpdateHandlers 未完成：

System.Workflow.Runtime 信息：1：工作流运行时：调度程序：InstanceId：6602768f-f043-4382-9d29-0be944f0d390：运行计划条目：SubscriptionEvent((1)serviceQueueActivity1.UpdateListenerSequenceActivity, ActivityStatusChange('(1)serviceQueueActivity1.UpdateListenerSequenceActivity', Executing, Succeeded)) System.Workflow.Runtime 信息：0：Activity Status Change - Activity：serviceQueueActivity1.UpdateListenerSequenceActivity Old:Executing；新：关闭 System.Workflow.Runtime 信息：1：工作流运行时：调度程序：InstanceId：6602768f-f043-4382-9d29-0be944f0d390：调度条目：SubscriptionEvent((1)serviceQueueActivity1.UpdateListenerScope, ActivityStatusChange('(1)serviceQueueActivity1.UpdateListenerSequenceActivity ', Closed, Succeeded)) System.Workflow.Runtime Information: 1 : Workflow Runtime: **这里少了一步！​​！！** System.Workflow.Runtime 信息：1：工作流运行时：调度程序：InstanceId：6602768f-f043-4382-9d29-0be944f0d390：完成运行计划条目：SubscriptionEvent((1)serviceQueueActivity1.UpdateHandlers, System.EventArgs) System.Workflow.Runtime信息：0：工作流运行时：WorkflowExecutor：工作流实例“6602768f-f043-4382-9d29-0be944f0d390”没有工作。

为什么 EventHandlersActivity 无法完成的任何想法？此时工作流将永远挂起，因为事件处理程序正在侦听将不会发送的事件。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-03T21:05:19.520

根本原因最终是多个 HandleExternalEventActivity 活动并行侦听同一事件。基于[http://msmvps.com/blogs/theproblemsolver/archive/2008/09/16/versioning-long-running-workfows-part-3.aspx](http://msmvps.com/blogs/theproblemsolver/archive/2008/09/16/versioning-long-running-workfows-part-3.aspx)上的示例使用 queue.Peek 而不是 queue 创建了自定义 IEventActivity。出队。

# java - 包含其他注释的注释成员？

> ID：679177
> 
> 赞同：10
> 
> 时间：2009-03-24T20:44:07.083
> 
> 标签：java, annotations

我想创建一个自定义注释（使用 Java），它将接受其他注释作为参数，例如：

```
public @interface ExclusiveOr {
    Annotation[] value();
} 
```

但这会导致编译器错误“注解成员的类型无效”。

Object[] 也不起作用。

有没有办法做我想做的事？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-24T20:54:30.833

产生错误是因为您不能将接口用作注释值（将其更改为`Comparable`，您将得到相同的错误）。从[JLS](http://java.sun.com/docs/books/jls/third_edition/html/interfaces.html#9.6)：

> 如果在注解类型中声明的方法的返回类型是以下类型之一以外的任何类型，则这是编译时错误：基本类型之一`String`，`Class`以及`Class`对枚举类型、注解类型或上述类型之一的数组。如果在注解类型中声明的任何方法的签名与在 class或 interface 中声明的任何`public`or方法的签名等效，这也是编译时错误。`protected``Object``annotation.Annotation`

恐怕我不知道一个好的解决方法，但现在至少您知道为什么会出现错误。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2013-03-18T10:54:18.083

根据您要指定其他注释的原因，有多种解决方案：

## 单个注释类型的实例数组

可能不是您在问题中的意思，但是如果您想指定单个注释类型的多个实例，那当然是可能的：

```
public @interface Test {
    SomeAnnotation[] value();
} 
```

## 一组注释类型而不是实例

如果您不需要在各个注释上指定任何参数，则可以只使用它们的类对象而不是实例。

```
public @interface Test {
    Class<? extends Annotation>[] value();
} 
```

但是在大多数情况下，枚举当然也可以解决问题。

## 使用多个数组

如果您要使用的可能注释类型集有限，您可以为每个注释类型创建一个单独的参数。

```
public @interface Test {
    SomeAnnotation[] somes() default { };
    ThisAnnotation[] thiss() default { };
    ThatAnnotation[] thats() default { };
} 
```

为每个成员指定一个默认值可以只为您需要的类型指定数组。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-24T23:47:46.423

我本人特此针对给定问题提出一种解决方法：

好吧，我想要实现的是这样的：

```
@Contract({
    @ExclusiveOr({
        @IsType(IAtomicType.class),
        @Or({
            @IsType(IListType.class),
            @IsType(ISetType.class)
        })
    })
}) 
```

建议的解决方法：

通过以下方式定义一个具有无参数构造函数的类（稍后将由您自己的注释处理器调用）：

```
final class MyContract extends Contract{
    // parameter-less ctor will be handeled by annotation processor
    public MyContract(){
        super(
            new ExclusiveOr(
                new IsType(IAtomicType.class),
                new Or(
                    new IsType(IListType.class),
                    new IsType(ISetType.class)
                )
            )
        );
    }
} 
```

用法：

```
@Contract(MyContract.class)
class MyClass{
    // ...
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-24T20:49:50.157

你可以做：

```
Class<? extends Annotation>[] value(); 
```

不确定这是否有帮助，但是。. .

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2014-07-09T04:42:06.153

我刚刚遇到了这个确切的问题，但是（受@ivan_ivanovich_ivanoff 的启发）我发现了一种将注释的***任意***组合指定为注释成员的方法：使用原型/模板类。

在这个例子中，我定义了一个**WhereOr**（即我的模型注释的“where 子句”），我需要包含任意 Spring 元注释（如 @Qualifier 元注释）。

其中的次要 (?) 缺陷是强制取消引用，它将 where 子句的实现与其描述的具体类型分开。

```
@Target({})
@Retention(RetentionPolicy.RUNTIME)
public @interface WhereOr {
    Class<?>[] value() default {};
}

@Target({ElementType.TYPE, ElementType.ANNOTATION_TYPE})
@Retention(RetentionPolicy.RUNTIME)
public @interface JsonModel {
    Class<?> value();
    WhereOr where() default @WhereOr;
}

public class Prototypes {
    @Qualifier("myContext")
    @PreAuthorize("hasRole('ROLE_ADMINISTRATOR')")
    public static class ExampleAnd {
    }
}

@JsonModel(
        value = MusicLibrary.class,
        where = @WhereOr(Prototypes.ExampleAnd.class)
)
public interface JsonMusicLibrary {
    @JsonIgnore
    int getMajorVersion();
    // ...
} 
```

我将以编程方式从“where 子句”注释中提取可能的有效配置。在这种情况下，我还将原型类用作逻辑 AND 分组，并将类数组用作逻辑 OR。

# javascript - 扩展地图对象

> ID：679181
> 
> 赞同：3
> 
> 时间：2009-03-24T20:46:25.830
> 
> 标签：javascript, dictionary, prototype, extend

我不知道如何用原型扩展地图对象，希望您能提供帮助。我有这样的事情：

```
var map = {'one':1, 'two':2}; 
```

我想有一种方法来检查密钥是否存在：

```
if (map.containsKey('one')){...} 
```

我将如何扩展地图对象？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-24T21:14:44.810

**修改 Object.prototype 很危险**，因为[它会影响所有对象，并且通常会破坏您可能正在使用的其他库](http://erik.eae.net/archives/2005/06/06/22.13.54/)。一般来说，如果你想为类字典对象添加方法，你应该为你的哈希实例创建一个对象来继承，[比如 Prototype Hash object](http://www.prototypejs.org/api/hash)。

对于这个特定的实例，你真的应该只使用`if (key in map)`or `if (map.hasOwnProperty(key))`。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-24T21:18:12.507

已经有一个运算符来测试对象内部是否存在键。

（在 JavaScript 中，对象被实现为地图，所以实际上没有真正的地图。）

```
if( 'one' in map ) 
{
   alert(map['one']);
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-24T20:57:27.613

这些不是“地图”，它们是对象。基于莫里斯的回答，如果您希望这适用于所有对象：

```
Object.prototype.containsKey = function(key) {
    return this.hasOwnProperty(key);
}; 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-24T20:53:45.780

最简单的方法是直接在对象中添加一个函数：

```
map.containsKey = function(key) {
    return this[key] ? true : false;
}; 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-24T21:02:50.080

在 Javascript 中，你真的不需要这样的方法。

```
if ( map['one'] ) {
   // do something
} 
```

应该这样做

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-25T00:44:59.547

正如其他人所说，`Object.prototype`如果您的代码必须与不了解`hasOwnProperty()`.

无论如何，我知道有三种“正确”的方法来检查属性是否可用：

```
obj.hasOwnProperty(name) 
```

检查对象中是否存在具有给定名称的属性。

```
name in obj 
```

还包括通过对象的原型链继承的属性。

```
typeof obj[name] !== 'undefined' 
```

`false`如果该属性存在但已设置为 ，将另外评估`undefined`。

一些非 JS 对象（例如`window.external`在 IE 中）可能无法实现`hasOwnProperty()`，因此必须使用其他检查之一。

# formatting - 为 Blogger 上的博客格式化代码片段

> ID：679189
> 
> 赞同：293
> 
> 时间：2009-03-24T20:49:35.947
> 
> 标签：formatting, blogs, blogger

我的博客托管在 Blogger 上，我经常在`C`/ `C#`/ `Java`/`XML`等中发布代码片段，但我发现片段被“破坏”了。

是否有任何网站可以用来预先解析代码段并整理格式，将 XML“ `<`”转换为“ `&lt;`”等。

SO上有很多关于这个领域的问题，但我找不到任何直接解决这个问题的问题。

`Edit:`对于[@Rich 的](https://stackoverflow.com/users/53501/rich)回答，网站声明“要在您的网站上显示格式化代码，您需要获取此 CSS 样式表，并在*您的页面部分**添加对它的引用`<head>`*” 。这就是问题所在——你不能在 Blogger AFAIK 上做到这一点。

* * *

## 回答 #1

> 赞同：254
> 
> 时间：2010-01-01T22:42:56.950

我创建了一篇博文，解释了如何使用[syntaxhighlighter](http://alexgorbatchev.com/SyntaxHighlighter/) 2.0向博主添加代码语法高亮

这是我的博客文章：

[http://www.craftyfella.com/2010/01/syntax-highlighting-with-blogger-engine.html](http://www.craftyfella.com/2010/01/syntax-highlighting-with-blogger-engine.html)

我希望它对你们有帮助。我对它的功能印象深刻。

以上链接停止工作。尝试使用[http://hilite.me/](http://hilite.me/)

* * *

## 回答 #2

> 赞同：132
> 
> 时间：2011-04-10T23:30:48.863

共享代码的最简单方法是使用公共要点。只需编写一个并粘贴到嵌入代码中。十分简单。

[http://gist.github.com](http://gist.github.com)

要解决搜索引擎问题，可以使用隐藏`div`在页面上，如下所示：

```
<div style="display:none"> content </div> 
```

* * *

## 回答 #3

> 赞同：64
> 
> 时间：2012-01-25T19:45:18.633

对于我的博客，我使用[http://hilite.me/](http://hilite.me/)来格式化源代码。它支持许多格式和输出相当干净的 html。但是如果你有很多代码片段，那么你必须做很多复制粘贴。为了格式化 Python 代码，我还使用了[Pygments](http://pygments.org/)（[博客文章](http://gissolved.blogspot.com/2009/05/python-toolbox-2-pygments.html)）。

* * *

## 回答 #4

> 赞同：46
> 
> 时间：2012-01-02T04:33:13.810

这个 css 脚本可能对所有人都有用 - 它不适用于语法突出显示，但可以很好地以原始格式呈现源代码：

```
 <pre style="font-family: Andale Mono, Lucida Console, Monaco, fixed, monospace; 
                color: #000000; background-color: #eee;
                font-size: 12px; border: 1px dashed #999999;
                line-height: 14px; padding: 5px; 
                overflow: auto; width: 100%">
       <code style="color:#000000;word-wrap:normal;">

            <<<<<<<YOUR CODE HERE>>>>>>>

       </code>
 </pre> 
```

**如何使用 ：**

1.  将此片段粘贴到文本编辑器中，
2.  将您的代码粘贴到 <<<<<<>>>>>> 块中。
3.  全部复制并
4.  粘贴到博客（或任何其他）帖子编辑器中的 HTML 视图。

**优点：**简单易用，配置少，易于重新配置，无需额外软件

* * *

## 回答 #5

> 赞同：16
> 
> 时间：2010-03-30T22:52:45.377

这可以通过 SyntaxHighlighter 轻松完成。我的博客上有关于[在 Blogger 中设置 SyntaxHighlighter 的分步说明](http://blog.alainodea.com/tr/article/424/enabling-syntaxhighlighter-in-blogger-step-by-step)。SyntaxHighlighter 非常易于使用。它允许您以原始形式发布片段，然后将它们包装在`pre`块中，例如：

```
<pre name="code" class="brush: erlang"><![CDATA[
-module(trim).

-export([string_strip_right/1, reverse_tl_reverse/1, bench/0]).

bench() -> [nbench(N) || N <- [1,1000,1000000]].

nbench(N) -> {N, bench(["a" || _ <- lists:seq(1,N)])}.

bench(String) ->
    {{string_strip_right,
    lists:sum([
        element(1, timer:tc(trim, string_strip_right, [String]))
        || _ <- lists:seq(1,1000)])},
    {reverse_tl_reverse,
    lists:sum([
        element(1, timer:tc(trim, reverse_tl_reverse, [String]))
        || _ <- lists:seq(1,1000)])}}.

string_strip_right(String) -> string:strip(String, right, $\n).

reverse_tl_reverse(String) ->
    lists:reverse(tl(lists:reverse(String))).
]]></pre> 
```

只需将画笔名称更改为“python”或“java”或“javascript”并粘贴您选择的代码。CDATA 标记让您可以在其中放置几乎任何代码，而不必担心实体转义或其他典型的代码博客烦恼。

* * *

## 回答 #6

> 赞同：15
> 
> 时间：2012-06-01T11:36:06.200

**1.** 首先，备份您的博客模板
**2.** 之后打开您的博客模板（在编辑 HTML 模式下）并复制 [此链接中给出](http://syntaxhighlighter.googlecode.com/svn/trunk/Styles/SyntaxHighlighter.css)`</b:skin>`的所有 css 在标签之前
**3.**在标签之前 粘贴以下`</head>`代码

```
<script src='http://syntaxhighlighter.googlecode.com/svn/trunk/Scripts/shCore.js' type='text/javascript'></script>
<script src='http://syntaxhighlighter.googlecode.com/svn/trunk/Scripts/shBrushCpp.js' type='text/javascript'></script>
<script src='http://syntaxhighlighter.googlecode.com/svn/trunk/Scripts/shBrushCSharp.js' type='text/javascript'></script>
<script src='http://syntaxhighlighter.googlecode.com/svn/trunk/Scripts/shBrushCss.js' type='text/javascript'></script>
<script src='http://syntaxhighlighter.googlecode.com/svn/trunk/Scripts/shBrushDelphi.js' type='text/javascript'></script>
<script src='http://syntaxhighlighter.googlecode.com/svn/trunk/Scripts/shBrushJava.js' type='text/javascript'></script>
<script src='http://syntaxhighlighter.googlecode.com/svn/trunk/Scripts/shBrushJScript.js' type='text/javascript'></script>
<script src='http://syntaxhighlighter.googlecode.com/svn/trunk/Scripts/shBrushPhp.js' type='text/javascript'></script>
<script src='http://syntaxhighlighter.googlecode.com/svn/trunk/Scripts/shBrushPython.js' type='text/javascript'></script>
<script src='http://syntaxhighlighter.googlecode.com/svn/trunk/Scripts/shBrushRuby.js' type='text/javascript'></script>
<script src='http://syntaxhighlighter.googlecode.com/svn/trunk/Scripts/shBrushSql.js' type='text/javascript'></script>
<script src='http://syntaxhighlighter.googlecode.com/svn/trunk/Scripts/shBrushVb.js' type='text/javascript'></script>
<script src='http://syntaxhighlighter.googlecode.com/svn/trunk/Scripts/shBrushXml.js' type='text/javascript'></script> 
```

**4.**在标签 前粘贴以下代码`</body>`。

```
<script language='javascript'>
dp.SyntaxHighlighter.BloggerMode();
dp.SyntaxHighlighter.HighlightAll('code');
</script> 
```

**5.** 保存博客模板。
**6.** 现在语法高亮已经可以使用了，你可以将它与`<pre></pre>`标签一起使用。

```
<pre name="code">
...Your html-escaped code goes here...
</pre>

<pre name="code" class="php">
    echo "I like PHP";
</pre> 
```

**7.你可以**[在这里](http://accessify.com/tools-and-wizards/developer-tools/quick-escape/default.php) 转义你的代码。
**8.** [这里](http://code.google.com/p/syntaxhighlighter/wiki/Languages)是**`<class>`**属性支持的语言列表。

* * *

## 回答 #7

> 赞同：9
> 
> 时间：2012-05-09T17:58:24.683

[http://formatmysourcecode.blogspot.co.uk/](http://formatmysourcecode.blogspot.co.uk/) 工作正常，您只需复制、格式化、粘贴回来。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2009-03-24T20:53:54.610

这是[一个](http://www.manoli.net/csharpformat/)可以格式化您的代码并输出 html 的站点，它甚至包括用于语法着色的内联样式。可能无法满足您的*所有*需求，但这是一个好的开始。如果您想扩展它，我相信他已经提供了源代码：

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2011-07-02T21:16:13.927

我使用了相当低技术的解决方案。[我使用此在线语法高亮](http://tohtml.com/auto/)工具格式化代码，然后将其粘贴到博客中

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2013-03-15T11:07:45.637

我创建了一个可以完成工作的工具。你可以在我的博客上找到它：

[**免费在线 C# 代码着色器**](http://www.pvladov.com/p/code-colorizer.html)

除了为您的 C# 代码着色之外，该工具还负责将所有“<”和“>”符号转换为“<” 和'>'。制表符被转换为空格，以便在不同的浏览器中看起来相同。您甚至可以使着色器内联 CSS 样式，以防您不能或不想在您的博客或网站中插入 CSS 样式表。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2009-03-24T21:11:07.097

我将[SyntaxHighlighter](http://code.google.com/p/syntaxhighlighter/)与我的 Blogger 驱动的博客一起使用。实际站点托管在我自己的服务器上而不是 Blogger 的服务器上（Blogger 可以选择 ftping 帖子到您自己的站点），但拥有自己的域和网络托管每月只需花费几美元。

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2009-11-10T23:08:46.830

看起来[SyntaxHighlighter 2.0](http://alexgorbatchev.com/wiki/SyntaxHighlighter)发生了一些变化，使其更易于与 Blogger 一起使用。

在以下位置有样式和 Javascript 的[托管版本：http:](http://alexgorbatchev.com/wiki/SyntaxHighlighter:Hosting) [//alexgorbatchev.com/pub/sh/](http://alexgorbatchev.com/pub/sh/)

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2009-03-24T21:00:46.683

实际上我用过（还有什么;-)）Vim：它有一个 2html“插件”。请参阅[此处的文档](http://vimdoc.sourceforge.net/htmldoc/syntax.html#:syn-file-remarks)。

因此，当我编辑我的代码时，我只是将其转换为 HTML 并将结果粘贴到 Blogger 的 HTML 编辑器中。

注意：它不是那么漂亮的 HTML（嵌入 css 会更好），但它确实有效。

哦：它有多种语言的语法文件，这使它非常有用。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2011-06-25T08:59:41.140

**Emacs 具体回答：**就博主而言，它允许内联 css。基于 javascript 的荧光笔的问题在于您必须接受他们的配色方案或实现自己的配色方案。但是，像我一样，如果您是自己的 emacs 配色方案的粉丝，那么您有一个更好的选择。我已经破解了 emacs 的“htmlize.el”包以添加以下四个功能......

1.  博客 htmlize 缓冲区
2.  博客-htmlize-区域
3.  blog-htmlize-buffer-with-linum
4.  博客-htmlize-region-with-linum

这些函数将在 emacs 的新缓冲区中输出可复制粘贴的 html（内联样式），您可以直接在博客文章中使用。输出看起来与您在 emacs 中看到的代码完全相同（包括配色方案）。

这是[我博客的链接](http://sujeet-gholap.blogspot.com/2011/05/code-snippets-for-blogging-made-easy.html)，您可以在其中找到有关如何将“blog-htmlize.el”与 emacs 一起使用的详细信息。这也消除了对“小于”和“大于”符号的 html 编码。而且由于 emacs 正在做所有的突出显示和样式设置，您不必担心 js 库是否支持您的代码片段的语言，也不必在 blogger 中干预您的模板代码。

您可以在[此处找到 elisp 文件](https://raw.github.com/gist/1047360/f58b73baf3fd045217f2da447ceba1a8d6b1bea6/blog-htmlize.el)（将文件另存为**blog-htmlize.el**）

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-03-27T10:29:29.627

我在 F# 中推出了自己的方法（参见[这个](https://stackoverflow.com/questions/228605/can-you-propose-a-more-elegant-way-to-tokenize-c-code-for-html-formatting)问题），但它仍然不是完美的（我只是做正则表达式，所以我不认识类或方法名等）。

基本上，据我所知，如果您在 Compose 和 HTML 模式之间切换，博客编辑器有时会吃掉您的尖括号。所以你必须粘贴到 HTML 模式然后直接保存。（我可能错了，现在刚刚尝试过，它似乎工作 - 取决于浏览器？）

当你有泛型时，这太可怕了！

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2012-06-26T09:13:05.333

要发布您的 html、javascript、c# 和 java，您应该将特殊字符转换为 HTML 代码。as `'<'`as`&lt;`和`'>'`to `&gt;`等

将此链接[代码转换器](http://www.google.com/ig/directory?dpos=top&root=/ig&url=hosting.gmodules.com/ig/gadgets/file/102462998830435293579/post-Code.xml&safe=on)添加到 iGoogle。这将帮助您转换特殊字符。

然后添加[SyntaxHighlighter 3.0.83](http://alexgorbatchev.com/SyntaxHighlighter/)新版本，在博客中自定义你的代码。但是您应该知道如何在您的博客模板中配置 syntaxHighlighter。

# .net - 使用 ASP.NET Gridview 的自定义模板字段

> ID：679192
> 
> 赞同：2
> 
> 时间：2009-03-24T20:50:20.173
> 
> 标签：.net, asp.net, gridview

我可以想出几种黑客方法来做到这一点，......但没有真正整洁的“.NET”方式。

我正在使用 Gridview 显示数据表...其中一列专用于显示布尔变量的状态。我想要满足的规范是在代表这个变量的列中有一个“开”和“关”按钮……点击开会将我的数据库中的变量更改为 1，……点击关会改变它为0等。

我通常处理php，但我猜这可以以某种方式使用模板字段以干净的方式完成......但是，..我不知道如何，这就是我问的原因:)

任何提示将不胜感激。安德鲁

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-24T20:56:21.827

像这样的东西应该得到你所追求的。

ASPX 侧：

```
<templateField>
  <itemtemplate>
    <asp:button runat="server" id="myButton" Text='<%# Response.Write(IIF(Eval("MyBool"),"Off", "On")) %>' CommandName='<%# Response.Write(IIF(Eval("MyBool"),"TurnOff", "TurnOn")) %>' CommandArgument='<%# Eval("MyRowIdentifier") %>' />
  </itemTemplate>
</templateField> 
```

后面的代码：

```
protected sub Row_itemCommand (ByVal sender As Object, ByVal e As System.Web.UI.WebControls.GridViewCommandEventArgs) Handles MyGrid.RowCommand
   Dim btn As Button =e.Item.FindControl("myButton")
   Select case e.CommandName 
      case "TurnOff"
        MyTurnOffFunction(e.CommandArgument)
        btn.Text = "Off"
        btn.CommandName="TurnOn"
      Case "TurnOn"
        MyTurnOnFunction(e.CommandArgument)
        btn.Text = "On"
        btn.CommandName="TurnOff"
    End Select

End Sub 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-24T20:57:25.100

您对模板字段是正确的：

```
 <asp:GridView ID="GridView1" runat="server" onrowcommand="GridView1_RowCommand">
    <Columns>
        <asp:TemplateField>
            <ItemTemplate>
                <asp:Image ID="img_on" Visible='<%# (bool) Eval("FieldBoolean") %>' runat="server" ImageUrl="GreenLight.jpg" />
                <asp:Image ID="img_off" Visible='<%# !(bool) Eval("FieldBoolean") %>' runat="server" ImageUrl="RedLight.jpg" />
            </ItemTemplate>
            <EditItemTemplate>
             <asp:button ID="btn_switch" runat="server" Text='<%# Response.Write( (bool) Eval("FieldBoolean") ?  "Off" : "On")) %>' CommandName="switch"
              CommandArgument='<%# Eval("FieldBoolean") %>' />

            </EditItemTemplate>
        </asp:TemplateField>
    </Columns>
</asp:GridView>

protected void GridView1_RowCommand(object sender, GridViewCommandEventArgs e)
        {
            if (e.CommandArgument == "switch")
            {
                UpdateValue(!bool.Parse((string) e.CommandArgument));
            }
        } 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-24T20:58:13.320

我认为你可以这样做：

```
<Columns>
  <asp:TemplateField>
    <ItemTemplate>
      <asp:ImageButton ID="btnEliminar" runat="server" 
         ImageUrl=<%# ((bool) Eval("condition"))? "yes.png":"no.png" %>
         OnClick="btnEliminar_Click"  
      />
    </ItemTemplate>
  </asp:TemplateField>
</columns> 
```

在图像 OnClick 事件中，您应该根据必须评估的一些逻辑更新您的数据库。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-24T20:57:28.253

**页**

```
<ItemTemplate>
    <asp:ImageButton id="OnButton" runat="server" OnClick="ToggleButtons" visible="True"/>
    <asp:ImageButton id="OffButton" runat="server"OnClick="ToggleButtons" visible="False" />
</ItemTemplate> 
```

**代码背后**

```
protected void ToggleButtons(object sender, EventArgs e)
{
    if (OnButton.visible) 
    {
        OnButton.visible = false;
        OnButton.visible = true;
    } else {
        OnButton.visible = true;
        OnButton.visible = false;
    }
    DoWork(OnButton.visible);
} 
```

# outlook - Outlook 拼写检查仅出站

> ID：679198
> 
> 赞同：0
> 
> 时间：2009-03-24T20:52:24.397
> 
> 标签：outlook, spell-checking

在 Outlook 中，管理员可以强制所有用户对每封电子邮件进行拼写检查。

是否可以将 Outlook 设置为*仅对*从公司域出站的电子邮件强制执行拼写检查，以便不会对“内部”电子邮件进行拼写检查，但会检查从域发出的所有电子邮件？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-24T23:20:19.470

您看到的设置可能来自标准 Outlook 组策略，该策略切换 Outlook 设置（工具->选项->拼写->发送前始终检查）。

组策略适用于每台计算机或每个用户。Outlook 在其配置页面中似乎没有提供任何内容，并且组策略中没有任何内容可以使该设置取决于收件人。

我想，也许可以构建某种附加组件来实现这一点，但该功能现在似乎不存在。

# c# - 如何找到给定数组的所有可能子集？

> ID：679203
> 
> 赞同：11
> 
> 时间：2009-03-24T20:54:06.373
> 
> 标签：c#, c++, algorithm

我想在 C# 或 C++ 中提取数组的所有可能子集，然后计算所有子集数组各自元素的总和，以检查其中有多少等于给定数字。

我正在寻找的是算法。我确实理解这里的逻辑，但我现在还不能实现这个逻辑。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-24T21:05:32.210

考虑一组`S`元素`N`和给定的子集，每个元素要么属于或不属于该子集。因此是`2^N`可能的子集（如果您包括原始集和空集），并且存在从`x`between`0`的二进制表示中的位到 的第 th 子集中`2^N`的元素的直接映射。`x``S`

一旦你弄清楚如何枚举给定子集的元素，添加值就很简单了。

`t`为了找到与 large的总和相等的子集`N`，一种优化可能是记录那些超过 的子集`t`，并且不测试任何属于这些子集的适当超集。可以通过单次按位运算和整数比较来测试集合编号是否`x`是集合的超集。`y`

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-03-25T00:12:55.397

您正在寻找的东西称为[电源组](http://en.wikipedia.org/wiki/Power_set)。 [Rosetta Code](http://www.rosettacode.org/wiki/Power_Set)有很多不同的实现，但这里是他们的 C++ 代码（他们使用向量而不是数组，但它应该很容易翻译）。

```
#include <iostream>
#include <set>
#include <vector>
#include <iterator>

typedef std::set<int> set_type;
typedef std::set<set_type> powerset_type;

powerset_type powerset(set_type const& set)
{
  typedef set_type::const_iterator set_iter;
  typedef std::vector<set_iter> vec;
  typedef vec::iterator vec_iter;

  struct local
  {
    static int dereference(set_iter v) { return *v; }
  };

  powerset_type result;

  vec elements;
  do
  {
    set_type tmp;
    std::transform(elements.begin(), elements.end(),
                   std::inserter(tmp, tmp.end()),
                   local::dereference);
    result.insert(tmp);
    if (!elements.empty() && ++elements.back() == set.end())
    {
      elements.pop_back();
    }
    else
    {
      set_iter iter;
      if (elements.empty())
      {
        iter = set.begin();
      }
      else
      {
        iter = elements.back();
        ++iter;
      }
      for (; iter != set.end(); ++iter)
      {
        elements.push_back(iter);
      }
    }
  } while (!elements.empty());

  return result;
}

int main()
{
  int values[4] = { 2, 3, 5, 7 };
  set_type test_set(values, values+4);

  powerset_type test_powerset = powerset(test_set);

  for (powerset_type::iterator iter = test_powerset.begin();
       iter != test_powerset.end();
       ++iter)
  {
    std::cout << "{ ";
    char const* prefix = "";
    for (set_type::iterator iter2 = iter->begin();
         iter2 != iter->end();
         ++iter2)
    {
      std::cout << prefix << *iter2;
      prefix = ", ";
    }
    std::cout << " }\n";
  }
} 
```

输出：

```
{  }
{ 2 }
{ 2, 3 }
{ 2, 3, 5 }
{ 2, 3, 5, 7 }
{ 2, 3, 7 }
{ 2, 5 }
{ 2, 5, 7 }
{ 2, 7 }
{ 3 }
{ 3, 5 }
{ 3, 5, 7 }
{ 3, 7 }
{ 5 }
{ 5, 7 }
{ 7 } 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-03-24T21:19:00.243

It's been one of my college projects 4/5 years ago, and I can't remind the algorithm well. As I see & my memory serves it's using an array as the original set and a bitmask to indicate what elements are present in the current subset.
here's the un-tested code from the archive:

```
#include <iostream>

#ifndef H_SUBSET
#define H_SUBSET

template <class T>
class Subset {
    private:
        int Dimension;
        T *Set;
        bool *Bitmask;
    public:
        Subset(T *set, int dim);
        ~Subset(void);
        void Show(void);
        void NextSubset(void);
        void EmptySet(void);
        void FullSet(void);
        int SubsetCardinality(void);
        int SetCardinality(void);
        T operator[](int index);
};      

template <class T>
int Subset<T>::SetCardinality(void) {
    return Dimension;
}

template <class T>
int Subset<T>::SubsetCardinality(void) {
    int dim = 0;
    for(int i = 0; i<Dimension; i++) {
        if(Bitmask[i]) {
            dim++;
        }
    }
    return dim;
}

template <class T>
void Subset<T>::EmptySet(void) {
    for(int i = 0; i<Dimension; i++) {
        Bitmask[i] = 0;
    }
    return;
}

template <class T>
void Subset<T>::FullSet(void) {
    for(int i = 0; i<Dimension; i++) {
        Bitmask[i] = 1;
    }
    return;
}

template <class T>
void Subset<T>::NextSubset(void) {
    int i = Dimension - 1;
    while(!Bitmask[i]&&i>=0) {
        i--;
        if(i<0) {
            break;
        }
    }
    if(i>=0) {
        Bitmask[i] = !Bitmask[i];
    }
    for(int j = i+1; j < Dimension; j++) {
        Bitmask[j] = !Bitmask[j];
    }
    return;
}

template <class T>
void Subset<T>::Show(void) {
    std::cout << "{ ";
    for(int i=0; i<Dimension; i++) {
        if(Bitmask[i]) {
            std::cout << Set[i] << ", ";
        }
    }
    std::cout << "}";
    return;
}

template <class T>
Subset<T>::Subset(T *set, int dim) {
    Set = new T[dim];
    Bitmask = new bool[dim];
    Dimension = dim;
    for(int i=0; i<dim; i++) {
        Set[i] = set[i];
        Bitmask[i] = true;
    }
}

template <class T>
Subset<T>::~Subset(void) {
    delete [] Set;
    delete [] Bitmask;
}
#endif // H_SUBSET 
```

And if it's your homework, you're killing yourself bro ;)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-24T21:18:56.907

Do you;

A) Really want to find all of the possible subsets?

or

B) Wish to find how many elements in an array can be combined to equal a given number, and see A) as a step towards the solution?

If it's A) then it's quite straightforward but the number of possible subsets becomes ridiculously large very quickly.

If it's B) then you should sort the array first and work from there.

# .net - 用于商业产品的可分发 ASP.NET Web 服务器

> ID：679204
> 
> 赞同：0
> 
> 时间：2009-03-24T20:54:14.873
> 
> 标签：.net, asp.net, hosting

有人知道可以托管 ASP.NET 应用程序的商业支持的可分发 Web 服务器吗？

我有一个基于商业服务器的应用程序，我想在其中添加一个 Web 界面（有点像客户端的门户）。我不能期望我的所有客户都拥有或想要运行 IIS。

如果没有 SSL 支持，Cassini 似乎有点受限，如果有人可以提供有关在哪里可以找到 cassini 源代码以及它是否被许可用于商业产品的信息，那将不胜感激。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-24T20:57:48.673

也许 UltiDev Cassini 是您正在寻找的： [http ://www.ultidev.com/products/Cassini/](http://www.ultidev.com/products/Cassini/)

编辑：卡西尼源可以在这里找到：http: [//blogs.msdn.com/dmitryr/archive/2005/09/27/474534.aspx](http://blogs.msdn.com/dmitryr/archive/2005/09/27/474534.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-24T21:01:09.990

你总是可以看看[Apache](http://httpd.apache.org/) + [Mono](http://www.mono-project.com/Main_Page)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-24T21:18:43.787

我认为你最好的选择可能是自己主持（就像卡西尼一样）。查看[System.Web.Hosting](http://msdn.microsoft.com/en-us/library/system.web.hosting.aspx) APIs ... 根据这篇[博](http://blogs.msdn.com/adarshk/archive/2004/11/10/255467.aspx)文，它们确实支持 SSL 。

实际所需的代码量相当小。

我已经对托管 CLR 和 ASP.NET 的非托管服务器做了类似的事情，它使用 C++/CLI 在托管世界和非托管之间提供了非常简单的互操作。

# objective-c - 将 NSPopupButton 绑定到 NSDictionaryController

> ID：679207
> 
> 赞同：5
> 
> 时间：2009-03-24T20:54:36.870
> 
> 标签：objective-c, cocoa, model-view-controller

我正在尝试一些 MacOS 编程，但在理解绑定如何与 NSPopupButton 一起工作时遇到了一些麻烦。我对绑定到 NSDictionaryController 感兴趣（我认为我不需要中间 NSArrayController 但如果这是最好的方法，我愿意接受）。

我创建了一个控制器对象，它有一个属性“db”，它有一个属性“species”，它是一个 NSMutableDictionary。'species' 字典具有键的 ID 和值的 Species 对象。Species 对象具有描述属性。在 InterfaceBuilder 中，我创建了 MyController、NSDictionaryController 和一个 NSPopupButton。我想用 Species.descriptions 填充弹出窗口。选择后，我需要访问相应的 ID。

我已经设置了 NSDictionaryController 以使用模型键路径“db.species”将“内容字典”绑定到 MyController。使用 NSPopupButton，到目前为止，我已经将“内容值”绑定到 NSDictionaryController，控制器键“arrangedObjects”和模型键路径设置为“value.description”。

这似乎可以填充列表。我的主要问题是连接选择的最佳方法是什么。理想情况下，我想将选择连接到 NSDictionaryController 以便我可以使用 NSDictionaryController 来访问选择。这样做的一个原因是我可以将其他控件连接到 NSDictionaryController 以查看当前选择。如果没有，我应该连接到 MyController 中的属性还是什么？只是寻找最佳实践。我希望通过 Interface Builder 机制，以便我可以轻松地在具有不同视图的另一个应用程序中重用模型和控制器设计。

**使用 Brian 的回答作为指导进行更新：**

NSPopupButton：将内容绑定到 NSDictionaryController->arrangedObjects->value.description

将内容对象绑定到 NSDictionaryController->arrangedObjects->key

将选定索引绑定到 NSDictionaryController->selectionIndex

绑定 NSDictionaryController->db.species

一切似乎都奏效了。我可以使用 [[[controller selectedObjects] lastObject] value] 从控制器中获取对象。我相信它在一个带有键值对的选定对象的数组中。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-25T03:48:42.633

我从来没有尝试过使用 NSDictionaryController，但我认为您希望将弹出窗口的 contentObjects 绑定到 dict 控制器的“arrangedObjects.key”，并将 selectedObject 绑定到 dict 控制器的“选择”键。contentObjects 绑定会将 ID 指定为每个菜单项表示的基础对象。然后当从弹出窗口中选择一个项目时， selectedObject 绑定会将与该菜单项对应的 ID 设置为 dict 控制器的选择。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-25T05:03:05.463

> 我想用 Species.descriptions 填充弹出窗口。选择后，我需要访问相应的 ID。

绑定`content`到字典控制器的`arrangedObjects.value`（不包括`description`- 弹出按钮将为您完成）和`contentObjects`字典控制器的`arrangedObjects.key`.

有关详细信息，请参阅[Cocoa 绑定参考中的 NSPopUpButton](https://developer.apple.com/library/archive/documentation/Cocoa/Reference/CocoaBindingsRef/BindingsText/NSPopUpButton.html#//apple_ref/doc/uid/NSPopUpButton-SW1)。

（我注意到它被描述`content`为“一个 NSArrayController 实例......”。字典控制器是数组控制器，所以这应该不是问题，但绑定到控制器的属性可能是。需要注意的事情。）

# c++ - 如何在 glTexImage2D 中使用动态大小的纹理数组？

> ID：679210
> 
> 赞同：3
> 
> 时间：2009-03-24T20:55:19.117
> 
> 标签：c++, opengl, glteximage2d

目前，我可以加载我创建的静态大小的纹理。在这种情况下，它是 512 x 512。

此代码来自标题：

```
#define TEXTURE_WIDTH 512
#define TEXTURE_HEIGHT 512

GLubyte textureArray[TEXTURE_HEIGHT][TEXTURE_WIDTH][4]; 
```

glTexImage2D的用法如下：

```
glTexImage2D(
    GL_TEXTURE_2D, 0, GL_RGBA,
    TEXTURE_WIDTH, TEXTURE_HEIGHT,
    0, GL_RGBA, GL_UNSIGNED_BYTE, textureArray); 
```

这是我填充数组的方式（粗略的例子，不是我的代码的精确副本）：

```
for (int i = 0; i < getTexturePixelCount(); i++)
{
    textureArray[column][row][0] = (GLubyte)pixelValue1;
    textureArray[column][row][1] = (GLubyte)pixelValue2;
    textureArray[column][row][2] = (GLubyte)pixelValue3;
    textureArray[column][row][3] = (GLubyte)pixelValue4;
} 
```

如何更改它以便不需要 TEXTURE_WIDTH 和 TEXTURE_HEIGHT？也许我可以使用指针样式数组并动态分配内存......

### 编辑：

我想我看到了问题，在 C++ 中它真的无法完成。Budric 指出的解决方法是使用一维数组，但使用所有 3 个维度相乘来表示索引：

```
GLbyte *array = new GLbyte[xMax * yMax * zMax]; 
```

要访问，例如 1/2/3 的 x/y/z，您需要执行以下操作：

```
GLbyte byte = array[1 * 2 * 3]; 
```

但是，问题是，我认为该`glTexImage2D`功能不支持这一点。谁能想到一个适用于这个 OpenGL 函数的解决方法？

### 编辑2：

注意 OpenGL 开发人员，这可以通过使用一维像素数组来克服......

> [0]：第 0 列 > [1]：第 0 行 > [2]：通道 0 ... n > [n]：第 1 行 ... n > [n]：第 1 列 .. n

...无需使用 3 维数组。在这种情况下，我不得不使用这项工作，因为 3 维数组在 C++ 中显然是不可能的。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2012-01-30T11:36:14.730

好的，因为这花了我很长时间才弄清楚，这里是：

我的任务是使用动态纹理数组实现 OpenGL 红皮书（9-1，p373，第 5 版）中的示例。

该示例使用：

```
static GLubyte checkImage[checkImageHeight][checkImageWidth][4]; 
```

正如您所猜测的那样，尝试分配一个 3 维数组是行不通的。某事。像这样***不起作用***：

```
GLubyte***checkImage;
checkImage = new GLubyte**[HEIGHT];

for (int i = 0; i < HEIGHT; ++i)
{
  checkImage[i] = new GLubyte*[WIDTH];

  for (int j = 0; j < WIDTH; ++j)
    checkImage[i][j] = new GLubyte[DEPTH];
} 
```

您必须使用***一维数组***：

```
unsigned int depth = 4;

GLubyte *checkImage = new GLubyte[height * width * depth]; 
```

您可以使用此循环访问元素：

```
for(unsigned int ix = 0; ix < height; ++ix)
{
  for(unsigned int iy = 0; iy < width; ++iy)
  {
    int c = (((ix&0x8) == 0) ^ ((iy&0x8)) == 0) * 255;

    checkImage[ix * width * depth + iy * depth + 0] = c;   //red
    checkImage[ix * width * depth + iy * depth + 1] = c;   //green
    checkImage[ix * width * depth + iy * depth + 2] = c;   //blue
    checkImage[ix * width * depth + iy * depth + 3] = 255; //alpha
  }
} 
```

不要忘记正确删除它：

```
delete [] checkImage; 
```

希望这可以帮助...

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-24T21:32:42.427

您可以使用

```
int width = 1024;
int height = 1024;
GLubyte * texture = new GLubyte[4*width*height];
...
glTexImage2D(
    GL_TEXTURE_2D, 0, GL_RGBA,
    width, height,
    0, GL_RGBA, GL_UNSIGNED_BYTE, textureArray);
delete [] texture;         //remove the un-needed local copy of the texture; 
```

但是，您仍然需要在 glTexImage2D 调用中为 OpenGL 指定宽度和高度。此调用复制纹理数据，并且该数据由 OpenGL 管理。您可以随心所欲地删除、调整大小、更改原始纹理数组，并且它不会与您指定给 OpenGL 的纹理产生不同。

**编辑：** C/C++ 只处理一维数组。您可以执行 texture[a][b] 的事实在编译时由编译器隐藏和转换。编译器必须知道列数并且会做texture[a*cols + b]。

使用一个类来隐藏分配，访问纹理。

出于学术目的，如果您真的想要动态多维数组，则应该使用以下方法：

```
int rows = 16, cols = 16;
char * storage = new char[rows * cols];
char ** accessor2D = new char *[rows];
for (int i = 0; i < rows; i++)
{
    accessor2D[i] = storage + i*cols;
}
accessor2D[5][5] = 2;
assert(storage[5*cols + 5] == accessor2D[5][5]);
delete [] accessor2D;
delete [] storage; 
```

请注意，在所有情况下，我都使用一维数组。它们只是指针数组和指向指针的指针数组。这有内存开销。这也适用于没有颜色分量的二维数组。对于 3D 取消引用，这变得非常混乱。不要在你的代码中使用它。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-24T21:47:53.310

你总是可以把它放在一个班级里。如果你从一个文件中加载图像，你会得到其余数据的高度和宽度（你还能如何使用文件？），你可以将它们存储在一个包装文件加载的类中，而不是使用预处理器定义. 就像是：

```
class ImageLoader
{
...
  ImageLoader(const char* filename, ...);
...
  int GetHeight();
  int GetWidth();
  void* GetDataPointer();
...
}; 
```

更好的是，您可以在其中隐藏对 glTexImage2d 的函数调用。

```
class GLImageLoader
{
...
  ImageLoader(const char* filename, ...);
...
  GLuint LoadToTexture2D(); // returns texture id
...
}; 
```

# c# - C# 在进程被杀死时清理非托管资源

> ID：679214
> 
> 赞同：8
> 
> 时间：2009-03-24T20:56:22.997
> 
> 标签：c#, dispose

我有一个在进程外实例化 COM exe 的类。班级是

```
public class MyComObject:IDisposable
{
    private bool disposed = false;
    MyMath test;

    public MyComObject()
    {
        test = new MyMath();
    }

    ~MyComObject()
    {
        Dispose(false);
    }

    public double GetRandomID()
    {
        if (test != null)
            return test.RandomID();
        else
            return -1;
    }

    public void Dispose()
    {
        Dispose(true);

        GC.SuppressFinalize(this);
    }

    private void Dispose(bool disposing)
    {
       if (test != null)
       {
           Marshal.ReleaseComObject(test);
           test = null;
       }

       disposed = true;
    }
} 
```

我称之为如下

```
static void Main(string[] args)
    {
        MyComObject test = new MyComObject();
        MyComObject test2 = new MyComObject();

        //Do stuff

        test.Dispose();
        test2.Dispose();

        Console.ReadLine();
    } 
```

现在，当程序正常执行时，这会清理我的 COM 对象。但是，如果我在执行过程中关闭程序，则框架不会调用释放我的非托管对象的代码。这很公平。但是，有没有办法强制程序在被杀死的情况下自行清理？

编辑：从任务管理器的硬杀来看，它看起来并不乐观:(

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-24T21:11:06.940

将它包装在 try finally 或 using 子句中将使您大部分时间到达那里：

```
using (MyComObject test = new MyComObject())
using (MyComObject test2 = new MyComObject()) {
    // do stuff
}
Console.ReadLine(); 
```

[但是，您的应用程序如何关闭](http://geekswithblogs.net/akraus1/archive/2006/10/30/95435.aspx)的细节将决定您可以采取的任何其他措施（例如使用[CriticalFinalizerObject](http://msdn.microsoft.com/en-us/library/system.runtime.constrainedexecution.criticalfinalizerobject.aspx)）。

我*认为*关闭（从小 x 开始）的控制台应用程序与 Ctrl-C 相同 - 在这种情况下，您可以为此[订阅 Console.CancelKeyPress](http://msdn.microsoft.com/en-us/library/system.console.cancelkeypress.aspx)。

编辑：您还应该[ReleaseComObject 直到它返回 <= 0](http://msdn.microsoft.com/en-us/library/system.runtime.interopservices.marshal.releasecomobject.aspx)。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-24T21:02:57.647

好吧，一种最佳做法是使用`using`语句：

```
using (MyComObject test = new MyComObject())
using (MyComObject test2 = new MyComObject())
{
    //Do stuff
} 
```

这实质上`finally`是在作用域结束时自动调用 dispose 块。`using`每当您有负责清理的 IDisposable 实例时，您几乎都应该有语句。但是，它并不能解决您的整个过程突然中止的情况。不过，这种情况非常罕见，您可能不想担心。（很难绕过它。）虽然我希望*你*的终结器会用你以前的代码来调用..

# http - 使用 Selenium 检查 HTTP 响应标头的最佳方法

> ID：679218
> 
> 赞同：14
> 
> 时间：2009-03-24T20:57:39.577
> 
> 标签：http, selenium, http-headers, httpresponse

我需要使用 Selenium 检查 HTTP 响应标头的最佳方法。我查看了 Selenium 文档，没有看到任何直接的方法。高度赞赏帮助。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-07-24T17:51:59.960

DefaultSelenium 中的 captureNetworkTraffic() API 捕获 http 请求/响应标头，您可以以 html/xml/plain 格式访问它们。

这是示例代码：

```
Selenium s = new DefaultSelenium(...);
s.start("captureNetworkTraffic=true");
s.open("http://www.google.com");
String xml = s.captureNetworkTraffic("xml"); // html, plain
s.stop(); 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-24T22:53:18.333

我已经在 StackOverflow 上多次回答过这个问题。搜索我以前的答案以挖掘它。您必须编写一些扩展 ProxyHandler 和 SeleniumServer 的自定义 Java 代码的关键。您还需要使用 AFTER 1.0 beta 2 之后的版本。

至于那些问你*为什么*要这样做的人：有很多原因。在我的例子中，我们正在测试一个 AJAX 繁重的应用程序，当出现问题时，我们首先要调试的事情之一就是网络线路。这有助于我们查看 AJAX 调用是否发生，如果发生，响应是什么。我们实际上是在每次 Selenium 测试中自动收集这些信息并捕获它（连同屏幕截图）。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-24T22:32:02.160

我不会将 Selenium 用于此类测试，并建议您使用不同的工具解决各种测试问题。我们所做的是：

*   使用单元测试来测试代码：方法和类

*   用于测试应用程序组件如何挂在一起的集成测试

*   一个简单的功能测试框架，如 Canoo WebTest（或类似的），用于断言 Http 缓存标头、基本页面结构、简单重定向和 cookie 设置/值等内容

*   定制测试以确保页面符合 W3C 标准的有效性

*   JSunit 用于测试我们创建的 Javascript 类和方法

*   Selenium 用于测试 UI 功能/行为以及将 Javascript 集成到这些页面中

值得花时间打破使用这些不同工具测试系统不同方面的责任，因为仅使用 Selenium 可能会导致问题：

*   套房越大，它们的运行速度就越慢。与提到的其他工具相比，Selenium 本质上是较慢的
*   它可以很好地处理行为/功能测试，但是 XPath 可能很脆弱，并且可能需要越来越多的时间和精力来维护
*   通常需要您在应用程序中设置*“真实生活”*数据以逐步完成用户场景（这可能很混乱并且需要很多时间）

还有一些技术——您可能遇到也可能没有遇到——您可以使用这些技术使您的 Selenium 测试[更有弹性](http://act.ualise.com/blogs/continuous-innovation/2009/01/making-your-selenium-xpaths-tests-more-resilient/)。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-06-22T17:04:27.173

我想出了一个使用嵌入式代理的解决方法，由 Proxoid 项目提供。

它的轻量级，与几乎所有其他替代品（如 BrowserMob 甚至 LittleProxy）不同

在这里查看带有代码的 HOWTO：http: [//www.supermind.org/blog/968/howto-collect-webdriver-http-request-and-response-headers](http://www.supermind.org/blog/968/howto-collect-webdriver-http-request-and-response-headers)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-24T21:33:11.380

我使用 Selenium（不是 Selenium RC）来处理这个问题的方法是将 HTML 测试转换为 JSP，然后在需要读取标头或执行 JavaScript（selenium 只是 Javascript）无法完成的任何事情时使用 Java。

也许您可以提供一些有关您计划如何使用 Selenium 的详细信息？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-05-02T10:24:34.443

从 Selenium 读取会话 cookie，然后使用 Selenium 之外的真实 HTTP 库来请求特定页面。

这是Python代码：

```
# get session cookies from Selenium
cookies = {}
for s_cookie in self.selenium.get_cookies():
    cookies[s_cookie["name"]]=s_cookie["value"]

# request the pdf using the cookies:
response = requests.get(self.full_url('/vms/business_unit/2002/operational_unit/200202/guest/40/bill/pdf/'), cookies = cookies)
self.assertEqual(response.headers["content-type"], "application/pdf") 
```

# php - 看似随机的带有 XML 含义的脚本失败，为什么？

> ID：679232
> 
> 赞同：0
> 
> 时间：2009-03-24T21:01:56.043
> 
> 标签：php, xml, internet-explorer

我收到此 XML 错误：

> XML 文档中只允许有一个顶级元素。错误处理资源...

伴随着这个PHP错误：

```
Warning:  file_get_contents(...) 
```

这似乎是直截了当的，除了它不能以任何方式重现，而且它在我们的客户计算机上 100% 发生（超过 6 台）。最初我虽然这只是IE6，但是当他们升级到IE7时，它仍然发生。

虽然 XML 错误似乎是由 PHP 错误触发的，但它只发生在 IE 上，而不会发生在任何其他浏览器上。有没有人遇到过这个，你是怎么找到的？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-24T21:39:45.437

XML 错误是因为 XML 文档必须具有单个根元素。

我怀疑 PHP 应该生成一些 XML，然后将其包含在某个为其提供单个根元素的东西中，并且包装过程失败了。这是一个完全的猜测，我认为我们需要更多关于 PHP 代码正在做什么的信息才能更具体。

如果您可以在 Firefox 3.0 而不是 IE 中打开有问题的资源，您应该能够查看 -> 源代码，这将显示资源的内容。这可能会帮助您诊断问题。如果您不能使用 Firefox，也许您可​​以编写一个小型 HTTP 客户端来检索资源并打印出内容。

# iphone - 从 iPhone 上的其他两个 UIImage 创建一个 UIImage

> ID：679245
> 
> 赞同：14
> 
> 时间：2009-03-24T21:08:22.377
> 
> 标签：iphone, uiimage

我正在尝试在 iPhone 上编写动画，但没有取得太大成功，出现崩溃并且似乎没有任何效果。

我想做的事情看起来很简单，创建一个 UIImage，然后在其中绘制另一个 UIImage 的一部分，我对上下文和图层和东西有点困惑。

有人可以用示例代码解释如何（有效地）编写类似的东西吗？

* * *

## 回答 #1

> 赞同：45
> 
> 时间：2009-04-27T01:13:15.837

作为记录，这非常简单——你需要知道的一切都在下面的例子中：

```
+ (UIImage*) addStarToThumb:(UIImage*)thumb
{
   CGSize size = CGSizeMake(50, 50);
   UIGraphicsBeginImageContext(size);

   CGPoint thumbPoint = CGPointMake(0, 25 - thumb.size.height / 2);
   [thumb drawAtPoint:thumbPoint];

   UIImage* starred = [UIImage imageNamed:@"starred.png"];

   CGPoint starredPoint = CGPointMake(0, 0);
   [starred drawAtPoint:starredPoint];

   UIImage* result = UIGraphicsGetImageFromCurrentImageContext();
   UIGraphicsEndImageContext();

   return result;
} 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2011-02-28T20:21:59.090

我只想对 dpjanes 的上述答案添加评论，因为它是一个很好的答案，但在 iPhone 4（具有高分辨率视网膜显示屏）上会显得块状，因为“UIGraphicsGetImageFromCurrentImageContext()”不会以全分辨率呈现iPhone 4。

请改用“...WithOptions()”。但是由于 WithOptions 直到 iOS 4.0 才可用，您可以对其进行弱链接（[在此处讨论](https://stackoverflow.com/questions/3607082/checking-if-uigraphicsbeginimagecontextwithoptions-is-supported)），然后使用以下代码仅在支持的情况下使用雇用版本：

```
if (UIGraphicsBeginImageContextWithOptions != NULL) {
    UIGraphicsBeginImageContextWithOptions(size, NO, 0.0);
}
else {
    UIGraphicsBeginImageContext();
} 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2013-11-11T03:28:17.757

这是一个将两个相同大小的图像合并为一个的示例。我不知道这是否是最好的，也不知道这种代码是否发布在其他地方。这是我的两分钱。

```
+ (UIImage *)mergeBackImage:(UIImage *)backImage withFrontImage:(UIImage *)frontImage
{

    UIImage *newImage;

    CGRect rect = CGRectMake(0, 0, backImage.size.width, backImage.size.height);

    // Begin context
    UIGraphicsBeginImageContextWithOptions(rect.size, NO, 0);

    // draw images
    [backImage drawInRect:rect];
    [frontImage drawInRect:rect];

    // grab context
    newImage = UIGraphicsGetImageFromCurrentImageContext();

    // end context
    UIGraphicsEndImageContext();

    return newImage;
} 
```

希望这可以帮助。

# asp.net - 脚本标签和链接标签是在 asp:content 里面还是在外面

> ID：679246
> 
> 赞同：10
> 
> 时间：2009-03-24T21:08:43.997
> 
> 标签：asp.net

我有一个包含母版页的页面。我是把脚本和链接标签放在 asp:content 占位符里面还是外面还是有关系。

当我把它放在外面时，我收到以下警告：

仅允许直接在包含内容控件的内容页面中使用内容控件。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-24T21:18:33.647

我可以看到五种（或 8 种）方法：

1.  在代码隐藏（.cs 或 .vb）中使用：
    *   Scriptmanager.RegisterClientScriptinclude - 使用绝对/相对路径
    *   Scriptmanager.RegisterClientScriptInclude - 使用嵌入式资源
    *   Scriptmanager.RegisterSlientScriptBlock - 里面有你的源代码
2.  在设计器中将其内联添加到您的 ASPX 页面
3.  将其粘贴在 asp:content 中，其中内容位于 body 标记内。
4.  将其粘贴在内容位于头部的 asp:content 中（**您已经说过这不是一个选项，所以忽略这个**）。
5.  使用上面在页面上使用的控件内的 ScriptManager 以编程方式添加它。

*“仅允许直接在包含内容控件的内容页面中使用内容控件”* - 您是否忘记了 runat="server"？

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-24T21:15:29.830

如果它是*所有*页面的脚本和链接，它应该在任何 ContentPlaceHolders 之外。如果是*这个*页面的脚本和链接，它应该放在头部的内容中。如果是默认脚本，则将其放在头部 ContentPlaceHolder 中，如果需要，可以将其替换为子页面。（VS 通常会抱怨头部有一个 ContentPlaceHolder，但它对我来说很好用）。

```
// master Page
<head runat="server">
   <asp:ContentPlaceHolder id="head" runat="server">
      <!-- Default scripts and CSS -->
      <link rel="stylesheet" type="text/css" href="default.css" />
      <script type="text/javascript" src="jquery.js"></script>
   </asp:ContentPlaceHolder>
   <!-- Mandatory scripts and css -->
   <link rel="stylesheet" type="text/css" href="all.css" />
   <script type="text/javascript" src="all.js"></script>
</head>
<body>
   Master Page!
   <asp:ContentPlaceHolder id="body" runat="server" />
</body>

// Child (no JQuery)
<asp:Content ContentPlaceHolderID="head" runat="server">
   <link rel="stylesheet" type="text/css" href="default.css" />
   <!-- Don't need JQuery -->
   <script type="text/javascript" src="prototype.js"></script>
</asp:Content>
<asp:Content ContentPlaceHolderID="body" runat="server">
   Child Page!
</asp:Content>

// Child 2 (with JQuery)
<asp:Content ContentPlaceHolderID="body" runat="server">
   Child Page!
</asp:Content> 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-24T21:15:27.570

如果您指的是`<asp:Content />`标签，则不能将它们之外的任何内容放在`.aspx`页面中。因此，您仅限于将它们放在`<asp:Content />`标签内。如果您想要`<script />`和`<link />`标签，您需要`<asp:ContentPlaceHolder />`在`<head>`您的母版页中放置一个，或者通过页面的`Controls`集合动态添加它们。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-24T21:10:41.030

外部。无论如何，ContentPlaceholders 的内部都将被您页面中的内容替换，因此在其中放置任何内容都没有多大意义。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-24T21:11:19.937

外部。在母版页中

占位符是从母版页下降的页面的包装控件。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-05-18T16:45:00.193

在母版页中使用 asp.net scriptreference 标记添加对 javascript 文件的引用，您将能够访问 javascript 文件中所需的所有内容，就像您已添加到本地页面一样。

# sql-server - SQL演员之谜

> ID：679248
> 
> 赞同：1
> 
> 时间：2009-03-24T21:09:18.910
> 
> 标签：sql-server, tsql

我对下面的 T-SQL 有一个真正的谜团。事实上，它可以与`DATAP.Private=1`或`cast as int`on一起使用`Right(CRS,1)`。也就是说，如果我取消注释`DATAP.Private=1`，我会得到错误`Conversion failed when converting the varchar value 'M' to data type int`，如果我然后删除该演员表，查询会再次起作用。有了演员表，查询只能在没有`Private=1`.

我一生都看不到如何`Private=1`向结果集中**添加**任何会导致错误的东西，除非`Private`曾经是“M”，而是`Private`一个`bit`字段！

```
SELECT 
      cast(Right(CRS,1) as int) AS Company
    , cast(PerNr as int) AS PN
    , Round(Sum(Cost),2) AS Total_Cost
FROM 
    DATAP 
    LEFT JOIN BU_Summary ON DATAP.BU=BU_Summary.BU
WHERE 
    DATAP.Extension Is Not Null 
    --And DATAP.Private=1
    And Left(CRS,2)='SB'
    And DATAP.PerNr Between '1' And '9A'
    and Right(CRS,1) <> 'm'
GROUP BY 
      cast(Right(CRS,1) as int)
    , cast(PerNr as int)
ORDER BY 
    cast(PerNr as int) 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-24T21:14:47.663

我过去曾见过这样的事情。该子句可能正在生成一个查询计划，该计划在应用过滤器`DATAP.Private = 1`之前执行 CRS 强制转换。`Right(CRS,1) <> 'm'`

它当然**不应该那样**做，但我在编写的 T-SQL 中也遇到过类似的问题，尤其是在涉及视图时。

您可以重新排序元素以使查询正常工作，或者将未转换的数据值选择到临时表或表变量中，然后在单独的语句中从那里选择和转换作为权宜之计。

如果您检查执行计划，它可能会阐明在何处计算的内容。这可能会给你更多关于你可能会改变的想法。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-24T21:23:42.417

只是一个猜测，但可能是当 Private = 1 时，PerNr 只能是数据中的一个可转换数字（因为它在 PerNr 中可以等于 '9A [或其他任何值]'，从而打破了组中的演员阵容和 order by 子句）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-25T03:03:19.090

我测试时 CAST('9A' AS int) 失败。看起来您正在为分组和排序进行不必要的 CASTS。特别是在 GROUP BY 中，这至少会扼杀任何优化的机会。

# mysql - MySQL 和 Filemaker Pro？

> ID：679249
> 
> 赞同：8
> 
> 时间：2009-03-24T21:09:28.427
> 
> 标签：mysql, web-applications, filemaker

我有一个客户想在他们的办公室里使用 Filemaker 做一些事情，并且可能让我构建一个 Web 应用程序。

上一次使用，或者想到，甚至听说过 Filemaker 大约是在 10 年前，我似乎记得我不想将它用作复杂网络应用程序的后端，所以我在想尝试在 MySQL 上出售它们。

但是，他们的 Filemaker 数据库会与 MySQL 通信吗？知道如何最好地从 Filemaker 中说服他们吗？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-24T22:28:11.263

您可能很难将它们从 FileMaker 中淘汰，因为它实际上是一个非常聪明的工具，用于制作小型内部数据库应用程序，并且拥有非常忠实的用户群。但你是对的——它不是制作 Web 应用程序的好工具。

我与仍在使用自定义 dBase IV 应用程序的客户有类似的问题。幸运的是，Perl 的 CPAN 存档有用于与*任何东西*对话的模块。所以我写了一个脚本，每晚导出整个 dBase IV 数据库，并将其作为一组只读表上传到 MySQL。

不幸的是，这需要每晚关闭 MySQL 30 分钟。（这是一个大型数据库，我们必须将自由格式的文本转换为 HTML。）所以我们切换到 PostgreSQL，并将整个数据库更新作为单个事务执行。

但是，如果您需要对 FileMaker 数据库进行读写访问怎么办？在这种情况下，你有几个选择，其中大多数都是不好的：

1.  构建[双向同步工具](http://work.rowanhick.com/2007/05/28/syncing-up-external-filemaker-data-with-rails/)。
2.  完全摆脱 FileMaker。如果客户的 FileMaker 数据库很小，这可能相对容易。我会首先为他们最重要的数据库编写一个快速而肮脏的克隆，然后在 Web 浏览器中向他们演示。
3.  实际上，基于 FileMaker 的 Web 应用程序可能最好地为客户端提供服务。如果是这样，[请将它们推荐给 Google](http://www.google.com/search?q=filemaker+web+application)。

但是，您如何根据给定的选择向客户推销？最好列出每个选择的成本和收益，让客户决定哪个最适合他们的业务。你可能会失去这份工作，但你会保持诚实建议的声誉，而且你不会参与一个不适合你的客户的项目。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-04-15T13:05:24.943

我们使用 FileMaker 和 PHP/MySQL 开发解决方案。我们的建议是在 Web 应用程序优化技术（如 MySQL）中创建 Web 应用程序。

话虽如此，FileMaker 确实有一个可靠的 PHP API，所以如果网络应用程序有相对轻量级的需求（例如在内部使用），那么使用它并省去同步的麻烦。

FileMaker 的 ESS 技术让 FileMaker 使用 SQL db 作为后端数据源，这为您提供了 2 个选项：

1.  将 ESS 用作在 FileMaker 内同步的一种很好的紧密方式 - 这样您就可以在 FileMaker 解决方案本身中使用“本机”数据源。

2.  使用 ESS 允许 FileMaker 直接在 MySQL 表上用作报告/数据挖掘/临时查询和编辑工具 - 效果很好。

我们发现在带有 ESS/MySQL 后端的 FileMaker 中构建复杂的应用程序非常棘手，因此您是从上面选择 1 还是 2 取决于 FileMaker 使用的复杂程度和繁重程度。

否则，SyncDek 作为第三方自动化同步解决方案享有盛誉。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-03-25T09:08:28.150

我一直在解决类似的问题，并找到了一些 emk 没有提到的解决方案......

1.  FileMaker 可以链接到外部 SQL 数据源 (ESS)，因此您可以使用 ODBC 连接到 MySQL（或其他）数据库并共享数据。[您可以在此处](http://www.filemaker.com/products/filemaker-pro/sql-data.html)找到更多信息。我们试过了，说实话发现它很慢
2.  [Syncdek](http://www.worldsync.com/syncdek/)是一款声称可以让您在 Filemaker、MySQL 和其他结构化源之间进行数据复制和数据传输的产品。
3.  可以将 Filemaker 的[Instant Web Publishing](http://www.filemaker.com/support/technologies/iwp.html)用作 Web 服务，然后您的应用程序可以通过该服务推送和提取数据。我们在[python](http://code.google.com/p/pyfilemaker/)和[php中找到了几个包装器](http://www.filemaker.co.uk/support/technologies/php.html)
4.  您可以在 FileMaker 数据库中放置一个触发器，以便每次更改记录（或您感兴趣的记录的一部分）时，您都可以调用 Web 服务来更新您的网站可以访问的该数据的 MySQL 或 memcached 版本。

我发现人们喜欢 FileMaker，因为它为他们的数据提供了一个非常直观的界面——无需太多开发知识就可以很容易地制作相当大的自包含应用程序。但是，当涉及到与许多用户的协作或以 FileMaker 应用程序以外的格式呈现这些数据时，我们发现性能是一个真正的问题。

# c# - 跟踪匿名用户活动

> ID：679251
> 
> 赞同：2
> 
> 时间：2009-03-24T21:10:29.687
> 
> 标签：c#, sql-server, asp.net-mvc

我需要使用启用的 cookie 跟踪匿名用户。

基本上，他们会浏览该网站，与之互动，我想给他们最好的体验，而不需要实际注册。稍后，如果他们愿意，他们可以注册，他们的网站活动将与他们的新帐户相关联。

像 Stackoverflow 之类的东西，但不同的是，我希望我的大多数用户实际上不会注册，但偶尔会卷土重来。

所以，我不想在用户表中创建一堆虚拟记录。因为我只需要一张桌子，所以我在考虑这样的事情：

**投票历史表**

```
Id    TrackingToken    VotingData
1     100             ...
2     100             ...
3     101             ...
4     102             ... 
```

**用户表**

```
Id    TrackingToken    OtherUsersColumns
1     100             ... 
```

**TrackingTokens 表**

```
LastTrackingToken
102 
```

我会增加一个 LastTrackingToken 整数字段，然后简单地将该值添加到用户 cookie 并用它跟踪他的投票活动。然后，如果他决定注册，我只需将他的 cookie TrackingToken 值添加到他的用户记录中。

最初我在考虑一个 Guid/uniqueidentifier 但由于投票表将非常大而且我需要查询它，我担心索引 uniqueidentifier 字段。

所以，问题是（对不起3个子问题，但它们是如此相关，我认为上下文很重要，所以我不想重复问题和上下文描述）：

1.  在性能和索引方面，整数字段是否更好？请记住，TrackingToken 不是主键字段！

2.  你有什么其他想法我可以完成我概述的场景吗？

3.  如果我决定手动生成整数 TrackingToken，那么可靠地生成/增加新的 TrackingToken 的最佳方法是什么？假设大量并发用户将访问数据库。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-24T21:17:16.380

To answer the 2nd of your questions in this multi-question (*Do you have some other idea how I could accomplish the scenario I outlined*), please see these:

[efficient ways to anonymous personalization using ASP.NET + Cookie](https://stackoverflow.com/questions/234044/efficient-ways-to-anonymous-personalization-using-asp-net-cookie)

[How can I create a local user profile for the anonymous user of an ASP.Net MVC application under IIS 7?](https://stackoverflow.com/questions/526745/how-can-i-create-a-local-user-profile-for-the-anonymous-user-of-an-asp-net-mvc-ap)

[How can I support anonymous users with my application?](https://stackoverflow.com/questions/647038/how-can-i-support-anonymous-users-with-my-application)

All pertain to anonymous profiles in ASP.NET.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-24T21:15:08.070

A Guid is not bad for an index. One thing to think about, a Guid won't be nearly as easy to fudge in the cookie if someone wants to try to game your system.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-25T00:37:46.273

（对于问题 3）如果您决定对 TrackingTokens 使用手动生成，请确保您在交易中保留整数，并且您几乎可以保证您将拥有唯一的整数。您还可以考虑让 SQL Server 自动为您分配它们，它们也将是唯一的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-01-17T17:25:22.867

每次新用户执行某些操作（例如投票）时创建访客用户帐户有什么问题？发生这种情况时，您使用 UUID 或其他一些唯一 ID（不是您建议的整数，以增加安全性）保存一个 cookie，并且一旦该用户注册，您所要做的就是将用户组从“访客”更改为“成员” '。简单的。

# regex - 什么正则表达式将匹配模式或为空？

> ID：679258
> 
> 赞同：13
> 
> 时间：2009-03-24T21:11:59.527
> 
> 标签：regex

我需要匹配模式或为空的正则表达式。

现在我有一个表情...

```
"\(?\d{3}\)?[-\s.]?\d{3}[-\s.]\d{4}/x" 
```

...与美国电话号码匹配。但是，我正在测试的字符串为空是有效的。如果字符串中有任何值，它必须匹配表达式。

我还有其他与美国邮政编码相匹配的模式等需要相同的条件。

在同一个表达式中实现这一目标的最佳方法是什么？

**澄清**：我在 Microsoft 的验证应用程序块中使用 RegexValidator。使用它的一个例子如下：

```
[StringLengthValidator(0, 100, MessageTemplate = "Email must be between {3} and {5}")]
[RegexValidator(@"\w+([-+.']\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*", MessageTemplate = "Valid Email Required.")]
public string EmailAddress
{
    get { return _EmailAddress; } 
    set { SetValue<string>(ref _EmailAddress, value); }
} 
```

这就是为什么我需要解决方案在一个表达式中。

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2009-03-24T21:16:21.547

将整个正则表达式包裹在括号中并放置一个 ? 在末尾：

```
(\(?\d{3}\)?[-\s.]?\d{3}[-\s.]\d{4}/x)? 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-24T21:16:42.183

尝试用`(?:<your_regex>)?`.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-25T12:35:21.897

试试这个：

```
@"^(?:(\()?\d{3}(?(1)\)|[-\s.])\d{3}[-\s.]\d{4})?$" 
```

该`(?(1)\)|[-\s.])`部分是一个条件构造。它说“如果开头有一个 '('（我们知道这是因为第 1 组匹配了一些东西），这里匹配一个 ')'；否则匹配一个连字符、空格或点。” `(?:...)?`正如凯文所说，将整个内容包裹起来可以匹配一个空字符串；如果这对您不起作用，则您一定是放错了括号之一（或者可能是反斜杠之一）。

我添加了`^`and`$`锚点用于测试目的；在验证器控件中，它们不应该是必需的。

# ms-access - 试图限制字段的输入

> ID：679263
> 
> 赞同：1
> 
> 时间：2009-03-24T21:14:48.383
> 
> 标签：ms-access

我在 ms-access 中有一个链接表，可以从 mysql 数据库中提取数据。其中有一个名为“工作”的字段，它应该具有三个可能的值，“主席”、“副主席”和 NULL。我有一个本地表，我的工作标题有两列，标题和值。

职称|价值
主席|主席
副主席|副主席
会员|NULL

看起来在链接表的设计视图中设置一个查找框显示控件应该提供一个解决方案，但我似乎无法将标题字段中的行设置为下拉列表中显示的内容和相应的值值表是字段设置的内容。我错过了什么吗？翻译命令还是什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-24T23:22:02.150

除了显示数据的 JohnFx 实现之外，您还想修复底层表结构。将您的表设置为如下所示：

```
id (autonumber)    title
-------------------------
1                  Chairperson
2                  Vice-chair 
```

将标题的 ID 存储在链接表中，而不是标题字段的文本，并将其设为外键。另外，不要为NULL添加记录，因为外键字段的原则规定该值必须存在于作为主键的表中，否则必须为空。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-24T22:34:08.457

不建议在表中使用查找字段：

[表中查找字段的弊端](http://www.mvps.org/access/lookupfields.htm)

使用查询来显示信息和用于数据输入的表单。

* * *

## 回答 #3

> 赞同：-2
> 
> 时间：2009-03-24T21:26:07.887

在查找选项卡上执行以下操作：

*   将行源设置为包含两列值的查询，标题（按该顺序）
*   将绑定列设置为 1
*   将列数设置为 2
*   将列宽设置为 0;2"（将 2" 更改为显示列宽度所需的任何值）
*   设置“限制列表到”是

# database - Is it more secure to store using a database or a file?

> ID：679270
> 
> 赞同：0
> 
> 时间：2009-03-24T21:16:12.153
> 
> 标签：database, security, file-io, malware

This question is from a decomposition of [What are good programming practices to prevent malware in standalone applications?](https://stackoverflow.com/questions/678471/what-are-good-programming-practices-to-prevent-malware-in-standalone-applications)

The question has to do with malware dynamically getting into a program by infecting data files which the program reads/writes.

Is it safer to require data be stored in a database and only use service calls, no direct file operations when accessing data for a program? Let's say your program loads many images, numeric data tables, or text information as it runs. Assume this is after the program is loaded and initialized to where it can make service calls.

Is it easier to infect a file or a database?

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-24T21:19:26.390

It is easier to infect user-space API than kernel space API.

In other words, the point is moot if you can't trust the services you're using to read the data.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-24T21:39:33.720

我会说这是安全定义（读取预防、写入预防等）以及谁可能具有访问权限以及风险有多大的函数。

您控制的实体通常可能比将控制权交给外部实体“更安全”——但不一定。

通常没有什么是容易指定 wrt 安全性的，因为它始终是风险与成本的权衡。

# email - 在 Emacs 程序中发送电子邮件

> ID：679275
> 
> 赞同：4
> 
> 时间：2009-03-24T21:17:25.507
> 
> 标签：email, emacs, elisp

有没有办法从区域或缓冲区构建电子邮件消息，设置收件人，然后以 elisp 代码发送消息？

我已将 emacs 配置为通过我的[gmail 帐户](http://justinsboringpage.blogspot.com/2009/02/sending-mail-with-emacs-in-windows.html)发送邮件，并且我希望能够从 elisp 程序向自己发送电子邮件。使用的命令是消息邮件。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-24T21:43:28.657

这是消息邮件的包装器，它会提示您输入“收件人”和“主题”行：

```
(defun my-message-mail-region (b e to subject)
  "Send the current region in an email"
  (interactive "r\nsRecipient: \nsSubject: ")
  (let ((orig-buffer (current-buffer)))
    (message-mail to subject)
    (message-goto-body)
    (insert (save-excursion (set-buffer orig-buffer)
                            (buffer-substring-no-properties b e)))
    (message-send-and-exit))) 
```

# c# - Some web services questions

> ID：679276
> 
> 赞同：0
> 
> 时间：2009-03-24T21:17:25.863
> 
> 标签：c#, web-services

I have some Web Service Questions.

I work with VS2005, and I need to build a web service.

1.  Can I copy/move/delete files or folders from a web service?
2.  Can I can make (or use) an SDF Database file from a web service?

thank's in advance

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-24T21:43:17.517

Web服务只是在服务器上执行的代码，它可以做任何它运行的用户有权做的事情

# .net - NHibernate - 强制转义表名

> ID：679279
> 
> 赞同：6
> 
> 时间：2009-03-24T21:17:39.310
> 
> 标签：.net, nhibernate, fluent-nhibernate-mapping, mapping-by-code

有没有关于如何在线使用这个（NHibernate.Criterion.IdentifierEqExpression）的好例子？我找不到任何东西。我对你应该传递给构造函数的内容有点困惑。

我传入了一个 1 的 int32 并且我一直认为我的测试应该基本上执行“where id = 1”类型的查询，而不是用“where id = ？” 还有一些关于位置参数的东西。如果那不是应该传递给构造函数的内容……那是什么？

**真正的问题**
当我查看 SQL 输出时，它似乎工作正常，除了我的表被命名为 User 并且 NHibernate 没有像 [User] 那样将它包含在内。有什么办法可以强制吗？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-03-26T03:41:18.180

将表名指定为` `User``。例如：

```
(HBM)
<class name="User" table="`User`">

(Fluent)
public UserMap()
{
    WithTable("`User`");
    ...

(Mapping By Code)
public UserMap()
{
    Table("`User`");
    ... 
```

同样，对于列，您必须执行以下操作：

```
Map(x => x.IsCurrent, "`Current`"); 
```

哦，使用遗留数据库的乐趣。

# image - 图像数据应该进入 VCS 吗？

> ID：679284
> 
> 赞同：2
> 
> 时间：2009-03-24T21:18:27.063
> 
> 标签：image, version-control, binaryfiles

我们正在我的工作场所对此进行热烈的讨论。我们谈论的是用户为一堆产品上传的图片，而不是显示基本网站所需的图片。我说“不可能”，但我很好奇其他人的想法。

**更新：**只是为了澄清。这些是客户为他们正在输入/修改的产品提供的图像。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-24T21:22:52.433

询问是否应该在版本控制中的其他方式：

*   图像有变化吗？
*   这些变化是否与其他任何事情有关？
*   可以犯错吗？
*   是否需要/需要可追溯性？

如果站点的其余部分受版本控制，则对图像进行版本控制。

如果生成了图像，则版本控制生成器。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-24T21:46:50.910

我同意“没办法”。

网站上可能因日常使用而发生变化的任何内容，或者可由我认为是“内容”的网站的管理人员进行编辑。这包括上传的文件和数据库内容，两者都是单独备份的。一旦部署，版本控制中的网站上的任何内容都不会发生变化。那样更容​​易。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-24T21:49:27.097

据推测，您所说的内容将被归类为用户数据，而不是项目文件。这些东西虽然很重要，但不需要版本控制——这需要一个简单的旧备份机制。

我最近将一个新项目添加到一个新的 SVN 存储库中，每次我查看“上传”文件夹时，我都会意识到将其包含在初始提交中是多么愚蠢。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-24T21:34:12.393

您所说的似乎是数据库中（或可能会）中的内容。如果客户向您提供产品列表以及这些产品的图片，那么这些都应该来自数据库。在这种情况下，我不会因为您的数据库应该被备份，而不是在 VCS 中。

如果不是，并且您的网站是静态的，那么我只会因为它是“网站的一部分”。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-24T21:59:45.467

如果你觉得你必须修改它，以某种方式将这些资源放在主存储库的路径之外，然后为它提供一个专门用于该内容的存储库。

您不希望每个必须签出代码的人在签出或更新时都获得每个图像的副本，这很慢且毫无意义，并且将它们放在主树中只会比您想象的更令人头疼。

```
/common_ancestor
   /project_code/      # repository a
   /resources_dir/     # repository b 
```

如果您必须使用符号链接或网络服务器魔法来实现这一点，那么就这样做，但无论您做什么，*都不*要将这样的内容放在您的主存储库中。

就备份与修订而言，如果您也使用 SVN 作为分发方法，像这样修订它确实会给您带来*一点轻松，这样如果开发人员**需要*一份图像副本用于测试目的，它相对容易获得相对最新的一组。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-24T22:00:35.247

如果您不打算向客户公开版本控制，那还有什么意义呢？

在提交文件之前，客户已经可以自行使用版本控制。你可能想鼓励他们这样做。

# c# - 解决虚拟覆盖中的“最衍生”方法

> ID：679293
> 
> 赞同：0
> 
> 时间：2009-03-24T21:20:13.597
> 
> 标签：c#, overriding, virtual-functions

我有一个简单的基类和派生类：

```
class Base
{
    public virtual void Write(int value)
    {
        Console.WriteLine("base int: {0}", value);
    }

    public virtual void Write(string value)
    {
        Console.WriteLine("base string: {0}", value);
    }
}

class Derived : Base
{
    public override void Write(int value)
    {
        Console.WriteLine("derived int: {0}", value);
    }

    public virtual void Write(IEnumerable enumerable)
    {
        Console.WriteLine("derived IEnumerable: {0}", enumerable);
    }

    public virtual void Write(object o)
    {
        Console.WriteLine("derived obj: {0}", o);
    }
} 
```

如果我运行这个：

```
 static void Main(string[] args)
    {
        Derived d = new Derived();
        Console.WriteLine("derived:");
        d.Write(42);
        d.Write("hello");

        Console.WriteLine("base:");
        Base b = d;
        b.Write(42);
        b.Write("hello");
    } 
```

我得到：

```
derived:
derived obj: 42
derived IEnumerable: hello
base:
derived int: 42
base string: hello 
```

但我希望“b.Write(42)”和“d.Write(42)”是相同的。字符串情况也是如此。

我不明白什么？鉴于我无法修改“Base”的约束，我如何才能使行为成为我所期望的？

**更新**：见[埃里克的帖子](http://blogs.msdn.com/ericgu/archive/2005/12/13/503225.aspx)。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-24T21:41:36.820

发生这种情况是因为 C# 优先考虑在类型中声明的方法，包括覆盖方法。请参阅：[C# 规范的第 7.3 节](http://msdn.microsoft.com/en-us/library/aa691331(VS.71).aspx)。

这篇[博](http://blogs.extremeoptimization.com/jeffrey/archive/2006/02/10/7134.aspx)文解释得很好，也解释了原因。

> 这种非常不直观的行为可以通过以下两条规则来证明：
> 
> 1.  方法是否被覆盖是一个实现细节，应该允许在不破坏客户端代码的情况下进行更改。
> 2.  不破坏继承类的基类更改不应破坏继承类的客户端。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-24T21:32:12.460

string 可以隐式转换为 IEnumerable (of chars)，但它的 ToString() 仍然返回字符串。因此，`b.Write("hello");`正在解析 IEnumerable 虚拟方法，因为它更接近被引用的类型。

我会验证，但如果您在派生类中覆盖字符串重载，它可能会在客户端代码中正确解析。

**编辑**

我错了，覆盖没有帮助。您可能必须重命名派生虚拟对象以避免冲突。

**编辑二**

以下确实有效，但它是超级黑客，我不喜欢它。将此方法添加到`Derived`：

```
public new void Write(string value)
{
    base.Write(value);
} 
```

# java - Gets byte array from a ByteBuffer in java

> ID：679298
> 
> 赞同：109
> 
> 时间：2009-03-24T21:22:09.753
> 
> 标签：java, arrays, bytearray, nio, bytebuffer

Is this the recommended way to get the bytes from the ByteBuffer

```
ByteBuffer bb =..

byte[] b = new byte[bb.remaining()]
bb.get(b, 0, b.length); 
```

* * *

## 回答 #1

> 赞同：118
> 
> 时间：2009-03-24T21:29:28.190

取决于你想做什么。

如果您想要检索剩余的字节（在位置和限制之间），那么您所拥有的将起作用。你也可以这样做：

```
ByteBuffer bb =..

byte[] b = new byte[bb.remaining()];
bb.get(b); 
```

这与[ByteBuffer](http://java.sun.com/j2se/1.5.0/docs/api/java/nio/ByteBuffer.html#get%28byte%5B%5D%29) javadocs 等效。

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2012-11-19T09:06:53.193

请注意， bb.array() 不尊重字节缓冲区的位置，如果您正在处理的字节缓冲区是其他缓冲区的一部分，则可能会更糟。

IE

```
byte[] test = "Hello World".getBytes("Latin1");
ByteBuffer b1 = ByteBuffer.wrap(test);
byte[] hello = new byte[6];
b1.get(hello); // "Hello "
ByteBuffer b2 = b1.slice(); // position = 0, string = "World"
byte[] tooLong = b2.array(); // Will NOT be "World", but will be "Hello World".
byte[] world = new byte[5];
b2.get(world); // world = "World" 
```

这可能不是您打算做的。

如果您真的不想复制字节数组，解决方法可能是使用字节缓冲区的arrayOffset（）+剩余（），但这仅在应用程序支持字节缓冲区的索引+长度时才有效需要。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2017-10-10T16:57:57.067

就如此容易

```
 private static byte[] getByteArrayFromByteBuffer(ByteBuffer byteBuffer) {
    byte[] bytesArray = new byte[byteBuffer.remaining()];
    byteBuffer.get(bytesArray, 0, bytesArray.length);
    return bytesArray;
} 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2014-04-21T01:44:40.920

```
final ByteBuffer buffer;
if (buffer.hasArray()) {
    final byte[] array = buffer.array();
    final int arrayOffset = buffer.arrayOffset();
    return Arrays.copyOfRange(array, arrayOffset + buffer.position(),
                              arrayOffset + buffer.limit());
}
// do something else 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2017-02-04T16:54:48.360

如果对给定 (Direct)ByteBuffer 的内部状态一无所知，并且想要检索缓冲区的全部内容，则可以使用以下方法：

```
ByteBuffer byteBuffer = ...;
byte[] data = new byte[byteBuffer.capacity()];
((ByteBuffer) byteBuffer.duplicate().clear()).get(data); 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-24T21:31:31.523

这是获取 a 的简单方法`byte[]`，但使用 a 的部分目的`ByteBuffer`是避免创建 a `byte[]`。也许您可以`byte[]`直接从`ByteBuffer`.

# python - 我的 Python SOAPpy Web 服务调用有什么问题？

> ID：679302
> 
> 赞同：1
> 
> 时间：2009-03-24T21:23:21.497
> 
> 标签：python, wsdl, soappy

我正在尝试使用 Python 解释器中的以下代码调用简单的 SOAP Web 服务：

```
from SOAPpy import WSDL
wsdl = "http://www.webservicex.net/whois.asmx?wsdl"
proxy = WSDL.Proxy(wsdl)
proxy.soapproxy.config.dumpSOAPOut=1
proxy.soapproxy.config.dumpSOAPIn=1
proxy.GetWhoIS(HostName="google.com") 
```

（是的，我是 Python 的新手，正在做 Diveintopython 的事情......）

对 GetWhoIS 方法的调用失败 - 否则我不会在这里问，我猜。这是我传出的 SOAP：

```
<?xml version="1.0" encoding="UTF-8"?>
<SOAP-ENV:Envelope
  SOAP-ENV:encodingStyle="http://schemas.xmlsoap.org/soap/encoding/"
  xmlns:SOAP-ENC="http://schemas.xmlsoap.org/soap/encoding/"
  xmlns:xsi="http://www.w3.org/1999/XMLSchema-instance"
  xmlns:SOAP-ENV="http://schemas.xmlsoap.org/soap/envelope/"
  xmlns:xsd="http://www.w3.org/1999/XMLSchema">
  <SOAP-ENV:Body>
    <GetWhoIS SOAP-ENC:root="1">
      <HostName xsi:type="xsd:string">google.com</HostName>
    </GetWhoIS>
  </SOAP-ENV:Body>
</SOAP-ENV:Envelope> 
```

这是传入的响应。

```
<?xml version="1.0" encoding="utf-8"?>
<soap:Envelope
    xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:xsd="http://www.w3.org/2001/XMLSchema">
  <soap:Body>
    <soap:Fault>
      <faultcode>soap:Server</faultcode>
      <faultstring>
           System.Web.Services.Protocols.SoapException:
           Server was unable to process request. ---&gt;
           System.ArgumentNullException: Value cannot be null.
         at whois.whois.GetWhoIS(String HostName)
         --- End of inner exception stack trace ---
      </faultstring>
      <detail />
    </soap:Fault>
  </soap:Body>
</soap:Envelope> 
```

（手动格式化以便于阅读）

谁能告诉我我做错了什么？

理想情况下，无论是就 SOAPpy 的使用而言，还是 SOAP 消息不正确的原因。

谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-24T22:12:05.420

你的电话对我来说似乎没问题，我认为这可能是一个肥皂问题或错误配置的服务器（尽管我没有彻底检查过）。

该文件还表明soappy和webservicex.net之间的不兼容性：http: [//users.jyu.fi/~mweber/teaching/ITKS545/exercises/ex5.pdf](http://users.jyu.fi/~mweber/teaching/ITKS545/exercises/ex5.pdf)

在这种特定情况下，我将如何解决这个问题？

```
import urllib

url_handle = urllib.urlopen( "http://www.webservicex.net/whois.asmx/GetWhoIS?HostName=%s" \
                             % ("www.google.com") )
print url_handle.read() 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-24T22:56:40.617

正如@ChristopheD 所提到的，SOAPpy 似乎对于 WDSL 的某些配置有问题。

我尝试使用 suds（Ubuntu 上的 sudo easy_install suds），第一次工作。

```
from suds.client import Client
client = Client('http://www.webservicex.net/whois.asmx?wsdl')
client.service.run_GetWhoIS(HostName="google.com") 
```

乔布斯是个好人。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-10-01T00:15:26.893

由于某种原因，客户端使用几乎不再使用的过时形式发送请求（“SOAP 第 5 节编码”）。你可以根据这个来判断：

```
SOAP-ENV:encodingStyle="http://schemas.xmlsoap.org/soap/encoding/" 
```

但是基于 WSDL，该服务只接受常规的 SOAP 消息。因此，您正在使用的 SOAP 库的 WSDL 解析部分很可能有问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-10-20T15:26:19.887

[请在此处](https://stackoverflow.com/questions/1768185/cant-call-a-webservice-method-using-soappy/2495261#2495261)查看我对另一个问题的回答。.net 要求soap 动作前有名称空间。

# c#-3.0 - When the use of an extension method is a good practice?

> ID：679303
> 
> 赞同：3
> 
> 时间：2009-03-24T21:23:34.447
> 
> 标签：c#-3.0, extension-methods

Extension methods are really interesting for what they do, but I don't feel 100% confortable with the idea of creating a "class member" outside the class.

I prefer to avoid this practice as much as I can, but sometimes it looks better to use extension methods.

Which situations you think are good practices of usage for this feature?

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-24T21:29:13.997

I think that best place for extension methods is "helper" methods or "shortcuts" that make existing API easier and cleanier by providing default values to arguments of existing methods or hiding repeating chains of method calls.

Contrary to the common beliefs that you can "extend" classes for which you do not have access to the source code, you cannot. You have no access to private methods and objects, all you can do is to polish public API and bend it to your likings (not recommended).

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-24T21:30:08.453

它们非常适合接口（您可以在其中添加仅使用接口上现有方法的“复合”行为） - LINQ to Objects 就是最好的例子。

它们对于创建流畅的接口也很有用，而不会影响正在使用的类型。我最喜欢的例子可能不适合生产代码，但对单元测试很方便：

```
DateTime birthday = 19.June(1976) + 8.Hours(); 
```

基本上任何你不想或不能向类型本身添加行为，但你想让类型更容易*使用*的地方，扩展方法都值得考虑。如果您发现自己编写了一堆静态方法来处理特定类型，请考虑扩展方法是否不会使对这些方法的调用看起来更好。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-24T21:29:41.903

当类不可扩展并且您无法控制源代码时。或者，如果它是可扩展的，但您更喜欢能够使用现有类型而不是您自己的类型。如果扩展不改变类的特征，而只是提供（IMO）缺少的功能，我只会做后者。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-24T21:30:57.283

在我看来，扩展方法有助于增强代码的可读性和可维护性。它们似乎最适合您无法访问原始类或该方法破坏原始类的“单一责任原则”的实体。我们在这里看到的后者的一个例子是 DSL。DSL 模型使用扩展方法进行扩展，以使 T4 模板更容易，但除非它们与模型特别相关，否则不会将方法添加到模型中。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-24T21:31:24.303

它们的理想用途是当您有一个将在许多地方实现的接口时，因此您不想给实现者带来巨大的负担，但从调用者的角度来看，您也希望该接口便于使用。

因此，您将“帮助程序”放入一组扩展方法中，从而使界面本身美观而简洁。

```
interface IZoomable
{
    double ZoomLevel { get; set; }
}

public static void SetDefaultZoom(this IZoomable z)
{
    z.ZoomLevel = 100;
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-24T21:29:57.380

扩展方法是向您不拥有（无源）、在框架中或出于任何原因不想继承的类添加功能的好方法。

我喜欢他们，但你是对的。应该明智地使用它们。

# ruby-on-rails - Single sign on for multisite application across domains in rails 2.3.2

> ID：679313
> 
> 赞同：1
> 
> 时间：2009-03-24T21:25:57.763
> 
> 标签：ruby-on-rails, session, single-sign-on

There's a rails recipe that illustrates how to do this in rails 2, but now that sexy rack is in, the solution seemed no longer relevant. How can this be handled in rails 2.3.2?

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-26T02:35:26.573

[开放标识](http://agilewebdevelopment.com/plugins/openidauthentication)？

# ruby-on-rails - 您如何使用具有多对多关系的 :dependent 选项？

> ID：679316
> 
> 赞同：1
> 
> 时间：2009-03-24T21:26:10.913
> 
> 标签：ruby-on-rails, ruby

我有这样的多对多关系：

```
class Event < ActiveRecord::Base
  has_many :calendar_events
  has_many :calendars, :through => :calendar_events
  # ...
end 
```

我想让它在我调用Ruby on Rails 时从表中`some_event.destroy`删除关联记录。`calendar_events`根据 API 文档，我假设您这样做...

```
class Event < ActiveRecord::Base
  has_many :calendar_events, :dependent => :delete_all
  has_many :calendars, :through => :calendar_events
  # ...
end 
```

这是正确的方法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-24T21:29:33.057

是的。这将仅删除所有日历事件。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-24T21:32:02.583

你也可以用 :destroy 代替 :delete_all。但是，对于大量关联对象，全部删除会更快。

请参阅 has_many 上的 Rails 文档 [http://api.rubyonrails.org/classes/ActiveRecord/Associations/ClassMethods.html#M001789](http://api.rubyonrails.org/classes/ActiveRecord/Associations/ClassMethods.html#M001789)

# visual-studio-2005 - Report Matrix filler

> ID：679319
> 
> 赞同：0
> 
> 时间：2009-03-24T21:26:59.837
> 
> 标签：visual-studio-2005, reporting-services, reporting, matrix, crosstab

I have a matix in my report (VS2005) i would like the matrix to display a default of 12 rows even if no data is available. i have not figured out how to do this so i create a group of rectangles below the grid and each row of these rectangles has is visibility changed based on the row count in the matrix.

the problem with this is that these rectangles stil exist when invisible and therefore create a second page of the report that is blank because the matrix has pushed them down.

so my question is how do i remove these rectangles that are invisible or how do i tell the matrix to have a minimum row count of 12.

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-24T21:39:20.867

您可以通过对具有所需维度的表使用左外连接来添加填充符。

在此示例中，并非所有月份都有销售额，但月份表包含所有月份。给定的表

```
month
------------
month_id -- 1-12
month_name -- Jan - Dec

Sales
------------
month_id  --not every month has sale
product
amount

select
    month_name
    ,product
    ,sum(isnull(amount,0))
from
    month
    left outer join sales
        on sales.month_id = month.month_id
group by
    month_name
    ,product 
```

# java - 即使发生异常，如何最好地执行一组方法

> ID：679331
> 
> 赞同：7
> 
> 时间：2009-03-24T21:30:32.230
> 
> 标签：java, exception

在当前的 Java 项目中，我们有类似于以下示例的代码：

```
try {
    doSomeThing(anObject);
}
catch (SameException e) {
    // Do nothing or log, but don't abort current method.
}

try {
    doOtherThing(anObject);
}
catch (SameException e) {
    // Do nothing or log, but don't abort current method.
}

// ... some more calls to different method ...

try {
    finallyDoYetSomethingCompletelyDifferent(anObject);
}
catch (SameException e) {
    // Do nothing or log, but don't abort current method.
} 
```

如您所见，使用完全相同的对象调用了几个不同的方法，并且对于每个调用，相同的异常被捕获并以相同（或以非常相似）的方式处理。异常不会重新抛出，但只能记录然后丢弃。

每个方法都有一个方法的唯一原因`try-catch`是始终执行所有方法，无论先前执行的方法是否失败。

我根本不喜欢上面的代码。它占用了大量空间，非常重复（尤其是在`catch`-block 中完成的日志记录；这里没有介绍）而且看起来很糟糕。

我可以想到一些其他的方法来编写这段代码，但也不是很喜欢它们。我想到了以下选项：

**循环切换序列/for-case 范例**

（参见[Wikipedia](http://en.wikipedia.org/wiki/Loop-switch_sequence)或[The Daily WTF](http://thedailywtf.com/Articles/Switched_on_Loops.aspx)）

```
for (int i = 0; i <= 9; i++) {
    try {
        switch (i) {
            case 0:
                doSomeThing(anObject); break;
            case 1:
                doOtherSomeThing(anObject); break;
            // ...More cases...
            case 9:
                doYetSomethingCompletelyDifferent(anObject); break;
        }
    }
    catch (SameException e) {
        // Do nothing or log, but don't abort current method.
    }
} 
```

这显然是糟糕的代码，非常容易出错并且看起来很业余。

**反射**

使用反射来获取`Method`要调用的方法的对象，并按照它们应该执行的顺序将它们存储在列表中。然后遍历此列表并使用`anObject`as only 参数调用该方法。异常在循环内部处理。

我不喜欢这种方法，因为错误（例如方法名称中的拼写错误）只会在运行时弹出，而且反射 API 有点啰嗦。

**函子**

像这样创建一个 Functor 类：

```
private class Functor
{
    void doStuff(MyObject object) throws SameException;
} 
```

然后创建`Functor`调用方法的对象列表。像这样：

```
List<Functor> functors = new ArrayList<Functor>();

functors.add(new Functor() {
    @Override
    public void execute(MyObject anObject) {
        doSomeThing(anObject);
    }
});

functors.add(new Functor() {
    @Override
    public void execute(MyObject anObject) {
        doOtherSomeThing(anObject);
    }
}); 
```

稍后，迭代此列表并调用`execute()`每个`Functor`对象。我可以用两个词来总结我对这种方法的感受：代码膨胀。

* * *

由于我不太喜欢所有四种方法，因此我想在这里讨论这个问题。你觉得最好的方法是什么？您过去是如何解决类似问题的？是否有一个我完全错过的更简单的解决方案？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-24T21:48:52.497

我会提倡重构方法（或“*为什么我们首先来到这里？* ”）：

考虑一下为什么各个方法在对 myObject 进行“处理”之后会抛出异常，然后可以安全地忽略该异常。由于异常转义了方法，因此 myObject 必须处于未知状态。

如果忽略异常是安全的，那么肯定它一定是错误的方式来传达每种方法中出现问题的方式。

相反，也许是每种方法都需要对失败进行一些登录。如果您不使用静态记录器，则可以将记录器传递给每个方法。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-24T21:37:30.263

在我看来，仿函数方法是最好的方法——Java 没有更好的方法来表示闭包或委托，这只是一种耻辱。这基本上就是您*真正*追求的，而在 C#（和许多其他语言）中，这将是微不足道的。

您可以使用以下方法减少身体膨胀：

```
Functor[] functors = new Functor[] {
    new Functor() { @Override public void execute(MyObject anObject) {
        doSomeThing(anObject);
    }},
    new Functor() { @Override public void execute(MyObject anObject) {
        doSomeOtherThing(anObject);
    }}
}; 
```

此处的空格折叠很可能与您使用的样式指南背道而驰，但我认为它使代码更易于实际阅读，因为您可以更轻松地看到内容。

更好地开始游说 Java 8 中的闭包；）

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-24T22:16:49.823

乍一看，我同意 PeterR：如果可以安全地轻松忽略异常，那么该方法可能根本不应该抛出异常。

但是，如果您确定这正是您想要的，比如说，也许您正在使用坚持抛出特定异常的第 3 方库中的方法，我会选择以下方法：

1.  创建一个包含所有可以调用的方法的接口：

    ```

    公共接口 XyzOperations {
         公共无效doSomething（对象anObject）；
         公共无效doOtherThing（对象anObject）；
         ...
         public void finallyDoYetSomethingCompletelyDifferent(Object anObject);

    ```

2.  为这些方法适当的方法创建一个默认实现类，可能从其他地方重构它们：

    ```
        公共类 DefaultXyzOperations 实现 XyzOperations {
        ...
        }

    ```

3.  使用 Java [Proxy](http://java.sun.com/j2se/1.4.2/docs/api/java/lang/reflect/Proxy.html)类创建一个动态代理，在`XyzOperations`该代理上将所有方法委托给，但在其[InvocationHandler](http://java.sun.com/j2se/1.4.2/docs/api/java/lang/reflect/InvocationHandler.html)`DefaultXyzOperations`中会集中处理异常。我没有编译以下内容，但这是一个基本大纲：

    ```
      XyzOperations xyz = (XyzOperations)Proxy.newProxyInstance(
            XyzOperations.class.getClassLoader(),
            新类[] { XyzOperations.class }，
            新的 InvocationHandler() {
                公共对象调用（对象代理，方法方法，对象 [] args）抛出 Throwable {
                     尝试 {
                          method.invoke(new DefaultXyzOperations(), args);
                     }
                     捕捉（SameException e）{
                         // 期望的异常处理
                     }
                }
            });

    ```

4.  从那时起使用该代理实例，只需调用所需的方法

或者，您可以使用[AspectJ](http://www.eclipse.org/aspectj/)或类似的 AOP 解决方案为所有方法添加周围建议`XyzOperations`并在那里进行异常处理。

您是否愿意引入新的依赖项，或者手动编写代理取决于您的个人喜好以及您需要此类行为的代码总量。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-24T22:01:06.650

我同意彼得的观点。我很难相信你真的想在抛出异常后继续执行某些事情。如果你这样做了，那么可能实际上并没有发生一些特殊的事情。

换句话说，不应将异常用于日志记录或流量控制。仅当发生异常而引发异常的级别的代码无法处理时才应使用它们。

因此，我将内部化日志消息并删除正在引发的异常。

至少，我认为您需要回过头来重新理解代码试图做什么以及正在实施的业务价值或规则。正如 PeterR 所说，试着理解“我们为什么会来到这里？” 代码的一部分以及异常的确切含义。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-24T22:13:09.443

您调用的方法是否在您的控制之下？如果是这样，在这种特殊情况下，返回错误代码（或对象）可能会产生比使用异常更好的整体设计：

```
handle(doSomething(anObject));
handle(doOtherThing(anObject));
// some more calls to different methods
handle(finallyDoYetSomethingCompletelyDifferent(anObject)); 
```

和

```
private void handle(ErrorCode errorCode) {
  // Do something about it
} 
```

和

```
private ErrorCode doSomething(Object anObject) {
  // return ErrorCode describing the operation's outcome
} 
```

这似乎不那么冗长，尽管不是 DRY。

或者，您使用一些 AOP 机制来拦截对 的调用`doSomething`，`doOtherThing`并`finallyDoYetSomethingCompletelyDifferent`使用先处理然后丢弃异常的 Around Advice。将它与 RuntimeExceptions 和基于一些很好的描述性注释的切入点结合起来，您就可以完美地捕捉到某种隐藏的横切关注点。

我承认我喜欢 Functor 方法。

*编辑*：刚刚看到您对其中一个答案的评论。在这种情况下，我可能会采用 AOP 方法。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-24T22:34:05.290

撇开重构问题不谈，[AspectJ](http://www.eclipse.org/aspectj/)（或类似的）似乎是透明地捕获/报告这些异常的最简单方法。您应该能够进行配置，即使您添加新的方法调用，它也会在方法调用周围编织 try/catch（我怀疑，面对有人在没有完全理解的情况下修改该代码时，上面的代码块会非常脆弱背后的原因）

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-25T00:32:24.383

如果你采用不同的代码风格路线，我会坚持一个简单的：

```
try { doSomeThing(anObject); } catch (SameException e) { Log(e); }
try { doOtherThing(anObject); } catch (SameException e) { Log(e); }
// ... some more calls to different method ... 
```

更新：我看不出使用像 Functor 的方法这样的语法如何减少所涉及的任何代码。正如 Jon 所提到的，java 不支持进一步减少它的简单语法。如果它是 c#，那么您可以做很多变化，围绕这样一个事实，即没有太多额外的语法来组合这样的方法，即像*actions.Add(() => doSomething(anObject));这样的表达式。*

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-25T12:10:52.767

让我详细说明一下仿函数方法......

根据应用程序的复杂性，有时值得将部分业务逻辑移动到 conf 文件中，这样可以更恰当、更简洁地表达。通过这种方式，您可以将技术细节（仿函数创建/调用、异常处理）与业务逻辑分开 - 定义要调用的方法和调用顺序。

在最简单的形式中，它可能是这样的：

```
mypackage.Action1
mypackage.Action2
... 
```

其中 ActionX 是实现 Functor 类（或接口）的类。

# visual-studio - Visual Studio 2008 中的 WatiN - 第二种测试方法失败

> ID：679347
> 
> 赞同：8
> 
> 时间：2009-03-24T21:35:50.080
> 
> 标签：visual-studio, testing, automation, watin

当尝试在 Visual Studio 2008 中运行一个非常简单的 WatiN 2.0 (CTP3) 测试时，我发现第一个总是执行得很好。第二种测试方法似乎破坏了 IE 对象中的某些内容，产生以下异常：

> 测试方法 testProject.WatinTest.testTwo 抛出异常：System.Runtime.InteropServices.InvalidComObjectException：无法使用已与其底层 RCW 分离的 COM 对象。

示例代码如下。由于初始化方法在 VS2008 中的工作方式，必须定义浏览器变量`static`，我认为这可能是问题的关键。不幸的是，除非浏览器以通用方法打开，否则这意味着每个测试都有一个单独的窗口，这并不理想

我将非常感谢有关如何解决此问题的任何想法。谷歌搜索和 SO 搜索没有产生任何有用的结果，所以我希望这个问题的一个好的答案能够帮助社区。非常感谢，

* * *

```
 private static IE ie

    [ClassInitialize]
    public static void testInit(TestContext testContext)
    {
        ie = new IE("http://news.bbc.co.uk");
    }

    [TestMethod]
    public void testOne()
    {
        Assert.IsTrue(ie.ContainsText("Low graphics"));
    }

    [TestMethod]
    public void testTwo()
    {
        Assert.IsTrue(ie.ContainsText("Low graphics"));
    } 
```

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-31T13:19:21.323

我以前听说过这个问题，并打算调查一段时间。现在 WatiN 2.0 beta 1 已经可用，我坐下来创建了一个帮助类来使用 Visual Studios 测试运行器解决这个问题。跟随助手类和改进的测试类。我还 发布了有关此解决方案的[博客](http://watinandmore.blogspot.com/2009/03/reusing-ie-instance-in-vs-test.html)，以使其获得更多曝光。

```
public class IEStaticInstanceHelper
{
    private IE _ie;
    private int _ieThread;
    private string _ieHwnd;

    public IE IE
    {
        get
        {
            var currentThreadId = GetCurrentThreadId();
            if (currentThreadId != _ieThread)
            {
                _ie = IE.AttachToIE(Find.By("hwnd", _ieHwnd));
                _ieThread = currentThreadId;
            }
            return _ie;
        }
        set
        {
            _ie = value;
            _ieHwnd = _ie.hWnd.ToString();
            _ieThread = GetCurrentThreadId();
        }
    }

    private int GetCurrentThreadId()
    {
        return Thread.CurrentThread.GetHashCode();
    }
} 
```

以及使用这个助手的测试类：

```
[TestClass]
public class UnitTest 
{
    private static IEStaticInstanceHelper ieStaticInstanceHelper;

    [ClassInitialize]
    public static void testInit(TestContext testContext)
    {
        ieStaticInstanceHelper = new IEStaticInstanceHelper();
        ieStaticInstanceHelper.IE = new IE("http://news.bbc.co.uk");
    }

    public IE IE
    {
        get { return ieStaticInstanceHelper.IE; }
        set { ieStaticInstanceHelper.IE = value; }
    }

    [ClassCleanup]
    public static void MyClassCleanup()
    {
        ieStaticInstanceHelper.IE.Close();
        ieStaticInstanceHelper = null;
    }

    [TestMethod]
    public void testOne()
    {
        Assert.IsTrue(IE.ContainsText("Low graphics"));
    }

    [TestMethod]
    public void testTwo()
    {
        Assert.IsTrue(IE.ContainsText("Low graphics"));
    }
} 
```

HTH，杰伦

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2010-07-12T08:11:03.033

我一直在寻找同样的东西，jvmenen 的回答帮助了我。但是，自从给出答案以来，WatiN 已经进行了一些更新，因此我不得不稍微重写帮助程序类以与最新的 WatiN 版本（当前为 2.0.20）保持一致。

WatiN 不再包含该`IE.AttachToIE`功能，因此我不得不对其进行一些修改。此外，我还使用泛型制作了辅助类，这样任何浏览器类型都可以使用，而不仅仅是 IE（我相信现在 WatiN 支持 IE 和 Firefox，Chrome 即将到来）。

因此，如果其他人也在寻找这个，这是我的版本`IEStaticInstanceHelper`（现在称为`StaticBrowserInstanceHelper`）：

```
class StaticBrowserInstanceHelper<T> where T : Browser
{
    private Browser _browser;
    private int _browserThread;
    private string _browserHwnd;

    public Browser Browser
    {
        get
        {
            int currentThreadId = GetCurrentThreadId();
            if (currentThreadId != _browserThread)
            {
                _browser = Browser.AttachTo<T>(Find.By("hwnd", _browserHwnd));
                _browserThread = currentThreadId;
            }
            return _browser;
        }
        set
        {
            _browser = value;
            _browserHwnd = _browser.hWnd.ToString();
            _browserThread = GetCurrentThreadId();
        }
    }

    private int GetCurrentThreadId()
    {
        return Thread.CurrentThread.GetHashCode();
    }
} 
```

希望这可以帮助某人:)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-25T00:05:22.560

我认为这与您保留 IE 变量的方式有关。我一直在毫无问题地使用它，如示例中所示：[http](http://watin.sourceforge.net/) ://watin.sourceforge.net/ 。我将 watin 测试视为比单元测试更多的功能/集成测试，因此每个测试更像是一个具有不同交互的故事。我使用页面对象模式来帮助构建代码 - 请参阅[http://code.google.com/p/webdriver/wiki/PageObjects](http://code.google.com/p/webdriver/wiki/PageObjects)。

附言。我考虑过重用该实例，但还没有真正尝试过。打开/关闭浏览器实例确实增加了测试时间。

# java - 在 Documentum 6.5 中，即使文档是模板，我的 TBO 也会被触发

> ID：679356
> 
> 赞同：0
> 
> 时间：2009-03-24T21:37:32.697
> 
> 标签：java, documentum, documentum6.5

在 Documentum 6.5 中创建和修改文档模板时，该对象类型的 TBO 被触发。在 5.3 创建模板并没有触发 TBO。

这是一个问题，因为在签入和保存文档时，我让 TBO 对文档进行各种处理。但是，如果文档只是进入我的模板柜的模板，我希望它什么也不做。

有没有其他人遇到过这个问题？有什么策略可以解决这个问题？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-24T21:54:35.400

我认为有某种方法可以以编程方式检测被操作的对象是否是模板，因此您可以将自定义 tbo 逻辑包装在 if 检查中，如果它是模板，则不会执行任何逻辑。然而...

...一般来说，在您的 tbo 中包含大量逻辑并不是一种好的做法，因为 tbo 的运行与上下文无关，并且您经常遇到这样的情况，您希望避免这种情况。最好将这种类型的逻辑放在 sbo 中，然后从您希望调用此逻辑的上下文中调用 sbo。即通过扩展webtop。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-30T04:07:19.597

如果 5.3 不是这种情况，我会提交一个支持错误。作为一种变通方法，您可以检查 TBO 中文档的文件夹路径，如果文档在模板文件夹中，则忽略该事件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-01T15:39:43.677

我解决了这个问题，在创建模板之前使用脚本重命名 TBO。这禁用了 TBO，然后在创建模板后，我将它们命名回来。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-08-10T03:06:05.197

有趣的问题.. 通常模板保存在预定的文件夹位置。在自定义 TBO 对象中，您可以跳过对保存在模板对象路径中的文档的附加行为的调用。

# database - 何时在 db 表中包含相关字段，何时不包含？

> ID：679357
> 
> 赞同：0
> 
> 时间：2009-03-24T21:37:36.080
> 
> 标签：database, database-design

我有一个“帖子”表，我想跟踪每个帖子的评分。通常，我会在同一个表中添加一个带有 int 值的评级字段，该表引用另一个包含实际评级数据的“评级”表。删除该评级字段并根据 postID 直接从评级表中调用评级有什么问题吗？Posts 表不会直接引用评分，但评分表会引用帖子 ID。哪种方式更好/正确。蒂亚

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-24T21:47:27.930

您应该将评级字段直接包含在您的帖子表中。这是一个[规范化](http://en.wikipedia.org/wiki/Database_normalization)的问题，如果你分离那个值，你什么也得不到，因为没有函数依赖。

在极少数情况下，您可能会将此类字段添加为单独的表格。例如，如果您必须将评级值添加到现有表中，并且无论出于何种原因都无法添加新列。

或者，如果行非常大并且变化非常罕见，而评级值变化非常频繁，您可能会获得一些性能。

但我不会说你的情况不属于任何一类。所以只需将其保留在帖子表中即可。

* * *

我将总结一些常见的情况。

```
Posts
========
PostId           Ratings
Text             ==========
RatingId  ====>  RatingId
                 RatingName 
```

如果您有一组可能的评分值，例如“好”、“平均”和“差”，并且所有帖子都共享此值，请使用此值。RatingValue 将是一个由 id 标识的字符串。

如果评级值是一个简单的数字，只需将其包含在帖子表中即可。这可能是你的观点。**为什么要包含整数评级值而不是带有评级名称的字符串？**区别如下。应该包括整数评级，因为每个值都是合法评级。这不适用于字符串评级。它们应该被移到一个单独的表中，因为只有一组有限的字符串代表合法的评级。

```
Posts
===========
PostId
Text
RatingValue 
```

如果您对每个帖子有多个评分，则以下是获得一组有限可能评分的方法。

```
Posts            PostRatings
========         ===========        Ratings
PostId    <====  PostId             ===========
Text             RatingId     ===>  RatingId 
                                    RatingName 
```

如果您有整数评级，则将它们放回帖子评级表中。如果需要人工主键，则需要添加人工主键，因为没有自然主键。

```
 PostRatings
Posts            ==============
========         [PostRatingId]
PostId    <====  PostId
Text             RatingValue 
```

如果您将评分与用户相关联，并且每个用户只允许对给定帖子进行一个评分，您将再次获得自然主键。

```
Posts            PostRatings
========         ===========        User
PostId    <====  PostId             ===========
Text             UserId       ===>  UserId 
                 RatingValue        Name 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-24T21:45:32.583

我认为您刚刚对良好的数据库设计有所了解。第二种方法是正确的，评级表有一个外键 PostId，它引用回 Posts 表。

我不确定第一种方法实际上是如何工作的，您在 Posts 表中是否有单个评级字段引用评级表中的多行？您的评分是否有一个不唯一的参考？无论哪种方式都不是好的做法，请阅读规范化，您就会明白这一点。

# asp.net - 如何在 IE 中设置禁用的 SELECT (DropDownList) 样式？

> ID：679358
> 
> 赞同：3
> 
> 时间：2009-03-24T21:38:04.193
> 
> 标签：asp.net, css, drop-down-menu

我正在用 ASP.NET 编写（最终可能无关紧要）。我已经解决了禁用/只读文本框（HTML INPUT）的灰色默认样式的灰色样式，现在我正在尝试处理 DropDownLists（HTML SELECT）。

我已经尝试过这些——它们适用于 TextBoxes——但没有一个适用于下拉菜单：

```
.ReadableReadonly, select[disabled], input[disabled], select[readonly], input[readonly]
{
    background-color:white;
    color:Black;
}

*[readonly]
{
    background-color:white;
    color:Black;
} 
```

有没有办法让禁用的下拉菜单显示为灰色文本？我将 MSIE 6、7、8 定位为仅用于 Intranet 的应用程序，但我没有选择浏览器。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-24T22:04:22.443

不是IE6/7，没有。这些版本使用操作系统提供的下拉小部件，而不是自己渲染它，因此您的造型机会非常有限。但是背景色确实有效，因此至少白底灰比灰底灰更容易阅读。

可能连背景色都没有的原因是像“[disabled]”这样的属性选择器在 IE 上不起作用。通常你为'.disabled'添加一个规则，并且每次你设置disabled时让生成/设置表单字段的脚本输出“class="disabled"”。

IE8 没问题。

# c# - 我应该先检查一个对象是空还是第二个？

> ID：679359
> 
> 赞同：5
> 
> 时间：2009-03-24T21:38:27.453
> 
> 标签：c#

例如说我创建了一个 Duck

```
Duck myDuck = DuckFactory.CreateDuck(); 
```

过去我总是检查 myDuck 是否为空

```
if (myDuck == null)
{
  // Do stuff
} 
```

我最近查看了一些首先检查 null 的代码。

```
if (null == myDuck)
{
   // Do stuff
} 
```

在我看来，这些是相同的，但是这两者之间有什么区别吗？一个比另一个有什么性能优势吗？是否有推荐的最佳实践来检查对象是否为空？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-03-24T21:39:55.170

第二个源于 C/C++（和其他地方），这是一个有效的构造

```
if (myDuck = null) {
} 
```

这在 C# 中无效（除非您的表达式解析为布尔值）。例如，这是有效的 C#

```
bool b = ...
if (b = true) {
} 
```

当您想要比较时，将常量放在首位是为了阻止意外分配。我会说更多的人把变量放在左边，但把常量放在左边也没有错。

只需选择一个并保持一致。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-24T21:40:32.127

如果您不小心将其放入，则唯一的区别是：

```
if(myDuck = null) ... 
```

但实际上，C# 编译器足够聪明，可以检测到这一点。

如果你不小心放了这个：

```
if(null = myDuck) ... 
```

那么这将导致在 C 或 C++ 时代出现错误。

长话短说：它在 C# 中没有任何区别。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-24T21:41:30.550

如果 (myDuck=null)，首先放置“null”可以防止意外分配。但是，一些编译器在尝试这样做时会抛出错误，因此这一点没有实际意义。IMO 这一切都归结为风格 - 选择一个，并坚持下去:)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-24T21:40:19.287

我认为没有任何区别。

if 语句将简单地检查它包含的表达式是否为真。myDuck 是否位于 == 符号右侧的左侧没有区别。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-24T21:41:59.707

一种看起来像 C++ 语法，另一种像 Java 或 C#。

From what I've read, The "null == myDuck" syntax originated in C from people accidently assigning in their if statements:

```
if (myDuck = null)
  // returns true 
```

# wcf - MSBuild WCF 选项

> ID：679368
> 
> 赞同：0
> 
> 时间：2009-03-24T21:40:39.037
> 
> 标签：wcf, msbuild, svcutil.exe

我想我需要使用自定义的 'svcutil' 选项来生成 WCF 客户端。我知道我可以在我的项目文件中提供自定义预构建事件并在那里应用 svcutil 命令行。

但是我想知道是否有任何文档说明 MSBuild 中存在哪些可覆盖的规则或目标，可用于覆盖 VS 2008 中 WCF 的 SvcUtil 的默认命令行参数。

提前致谢。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-25T03:14:54.693

项目文件往往主要是项目组。如果您查看 Fmk 目录，您将看到 Microsoft.CSharp.targets 文件。这个[链接](http://channel9.msdn.com/wiki/msbuild/modifyingthevsbuildprocess/)解释了更多关于它的信息。

我倾向于添加到 CompileDependsOn 属性（实际上就像在文章中一样:-)

# c++ - DXGetErrorString 新手问题

> ID：679370
> 
> 赞同：1
> 
> 时间：2009-03-24T21:40:54.467
> 
> 标签：c++, directx

我是 C++ 和 Direct X 的新手，我想知道 DXGetErrorString 和 DXGetErrorDescription 的正确用法是什么？

根据[http://msdn.microsoft.com/en-us/library/bb173057(VS.85).aspx](http://msdn.microsoft.com/en-us/library/bb173057(VS.85).aspx)和[http://msdn.microsoft.com/en-us/library/bb173056(VS.85)。 aspx](http://msdn.microsoft.com/en-us/library/bb173056(VS.85).aspx)，这些函数返回一个指向字符串的指针。但是，在我在网络上看到的所有示例中，它们直接使用返回值而没有在之后释放它。

例如：

```
char buf[2048];
sprintf(buf, "Error: %s error description: %s\n",DXGetErrorString(hr),DXGetErrorDescription(hr)); 
```

这是否意味着存在内存泄漏，因为为错误字符串分配的内存和错误描述从未释放？如果没有，它是如何发布的？

感谢您的帮助 ！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-24T21:47:01.720

最有可能的是，这些函数返回一个静态字符串，因此不需要释放它。

它类似于编写这样的代码，您不必担心释放返回值：

```
PCWSTR GetErrorCode(int error)
{
    switch (error)
    {
        case 1:
          return L"File not found";
        ...
        default:
          return "Unknown error";
    }
} 
```

# iphone - 在 iPhone 上填充 Tableview 的问题

> ID：679376
> 
> 赞同：1
> 
> 时间：2009-03-24T21:42:40.467
> 
> 标签：iphone, objective-c, uitableview

## 代码 N°1：

```
NSMutableArray *arrayTmp = [[NSMutableArray alloc] initWithObjects:nil];

[arrayTmp addObject:@"line 1" ];
[arrayTmp addObject:@"line 2" ];

self.list = arrayTmp;
[self.tableView reloadData];
[super viewDidLoad];
[arrayTmp release]; 
```

## 代码 N°2：

```
NSMutableArray *arrayTmp = [[NSMutableArray alloc] initWithObjects:nil];

NSString *fieldName = [[NSString alloc] init];
fieldName = [NSString stringWithFormat:@"%@",@"Ligne1"];
[arrayTmp addObject:(NSString *) fieldName];
[arrayTmp addObject:@"line 2" ];

self.list = arrayTmp;
[self.tableView reloadData];

[super viewDidLoad];
[arrayTmp release]; 
```

*代码 N°1 和 N°2 执行完全相同的工作：它们填充一个表格视图。我的问题是代码 N°2：他显示 tableView 但如果我用手指移动 tableView，iphone 就会冻结。调试器显示以下消息：“GDB：程序接收信号：“EXC_BAD_INSTRUCTION”。我看不出它出了什么问题。有人知道这个问题吗？提前谢谢你。*

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-24T22:01:27.473

我的猜测是`self.list`不保留数组，并且在填充表格视图时添加对该列表中字符串的引用。你的财产应该是这样的；

```
@property (retain) NSArray* list; 
```

这在第一个示例中不是问题，因为字符串是字面的 - 例如，它们嵌入在您的程序中并且永远不会被释放。

第二个示例创建了一个临时字符串，尽管它的引用在添加到数组时会增加，但稍后会在释放数组时释放并销毁。

还有这个代码；

```
NSString *fieldName = [[NSString alloc] init];
fieldName = [NSString stringWithFormat:@"%@",@"Ligne1"]; 
```

将导致内存泄漏。您正在分配一个新字符串，然后将指针中的值更改为 stringWithFormat 调用的结果。如果您希望 fieldname 持续存在，那么正确的代码将是；

```
NSString *fieldName = [[NSString stringWithFormat:@"%@",@"Ligne1"] retain]; 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-06-14T10:23:34.927

```
self.list=[NSArray arrayWithArray:arrayTmp]; 
```

只需分配 self.list 。这是在创造糟糕的执行官。因为您没有为列表分配内存。

保留并不能解决问题

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-26T18:16:10.090

谢谢您的回复。

最后，我通过以下方式解决了我的问题：

- 在我的 NNString 字段名中添加“保留”

- 删除 tableView 方法“cellForRowAtIndexPath”中变量的“释放”

再次感谢您的帮助支持！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-25T13:27:08.060

谢谢你非常好的建议。正如您所建议的，我将数组保留在我的@property 中：

```
 @property (retain) NSArray *list; 
```

## 如果在我的代码中我输入：

```
 NSString *fieldName = [[[NSString alloc] initWithString: @"line 1"] retain];
[arrayTmp addObject:fieldName];
[arrayTmp addObject:@"line 2" ]; 
```

它正在工作！

## 但如果我说：

```
NSString *fieldName = [[[NSString alloc] initWithString: [NSString stringWithFormat: @"line 1"] ] retain];
[arrayTmp addObject:fieldName];
[arrayTmp addObject:@"line 2" ]; 
```

它可以很好地显示 tableview，但是如果我用手指移动 tableView 2 或 3 次，iphone 就会冻结。不幸的是，我需要使用 stringWithFormat 和 stringWithUTF8String 才能从数据库中填充我的 tableView。

错误仍然是“EXC_BAD_ACCESS”。但我不知道如何执行回溯。调试器显示：

# 0 0x300c8c18 在 objc_msgSend

# 1 0x30b524dc 在 -[UILabel 文本]

# 2 0x30c07b44 在-[UITableViewCell layoutSubviews]

# 3 0x30a74020 在-[UIView(CALayerDelegate)_layoutSublayersOfLayer:]

# 4 0x31dd20f0 在 -[CALayer layoutSublayers]

# 5 0x31dd2000 在 CALayerLayoutIfNeeded

# 6 CAContextCommitTransaction 中的 0x31dd1774

# 7 0x31dd143c 在 CATransactionCommit

# 8 0x3026a0ec 在 __CFRunLoopDoObservers

# 9 CFRunLoopRunSpecific 中的 0x30269920

# 10 0x30269326 在 CFRunLoopRunInMode

# 11 0x31563e60 在 GSEventRunModal

# 12 0x30a4feb8 在 -[UIApplication_run]

# 13 0x30a5961c 在 UIApplicationMain

# 14 0x000020bc 在 main.m:14

asm obj_msgSend 0x300c8cc04:1 0x300c8c04 <+0000> teq r0, #0 ; 0x0

0x300c8c08 <+0004> moveq r1, #0 ; 0x0

0x300c8c0c <+0008> bxeq lr

0x300c8c10 <+0012> stmdb sp!, {r3, r4, r5, r6}

0x300c8c14 <+0016> ldr r4, [r0]

## 0x300c8c18 <+0020> ldr r5, [r4, #8]

0x300c8c1c <+0024> ldr r6, [r5]

0x300c8c20 <+0028> 添加 r3, r5, #8 ; 0x8

0x300c8c24 <+0032> 和 r5, r6, r1, lsr #2

0x300c8c28 <+0036> ldr r4, [r3, r5, lsl #2]

0x300c8c2c <+0040> teq r4, #0 ; 0x0

0x300c8c30 <+0044> 添加 r5, r5, #1 ; 0x1

0x300c8c34 <+0048> beq 0x300c8c54

0x300c8c38 <+0052> ldr ip, [r4]

0x300c8c3c <+0056> teq r1, ip

0x300c8c40 <+0060> 和 r5, r5, r6

0x300c8c44 <+0064> bne 0x300c8c28

0x300c8c48 <+0068> ldr ip, [r4, #8]

0x300c8c4c <+0072> ldmia sp!, {r3, r4, r5, r6}

0x300c8c50 <+0076> bx ip

0x300c8c54 <+0080> ldmia sp!, {r3, r4, r5, r6}

0x300c8c58 <+0084> b 0x300c8c5c

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-26T14:30:02.877

以下是您应该如何使用代码 2

```
NSString *fieldName = [[NSString alloc] initWithString:@"Ligne1"];
NSMutableArray *arrayTmp = [NSMutableArray arrayWithObjects:fieldName, @"line2", nil]; //I would suggest using @"Ligne1" instead of fieldName if possible

self.list = [arrayTmp retain]; //This will make sure even after releasing arrayTmp, list is not affected
[self.tableView reloadData];

[arrayTmp release]; 
```

# c# - 在 C# 中访问 Guid 成员

> ID：679381
> 
> 赞同：3
> 
> 时间：2009-03-24T21:43:37.597
> 
> 标签：c#, guid

在 C++ 中，我们可以通过以下方式访问 guid 的成员：

```
GUID guid = {0};
CoCreateGuid(&guid);
dwRand = guid.Data1 & 0x7FFFFFFF; 
```

C++中guid的结构是：

```
Data 1 - unsigned long
Data 2 - unsigned short
Data 3 - unsigned short
Data 4 - unsigned char 
```

问题：如何翻译 C++ 代码中的第三行 ( `dwRand = guid.Data1 & 0x7FFFFFFF;`)。换句话说 - 如何访问 guid 成员？C# 中没有这样的东西。

提前致谢！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-24T21:49:51.497

您可以使用[`Guid.ToByteArray`](http://msdn.microsoft.com/en-us/library/system.guid.tobytearray.aspx)以字节形式获取值，但“分组”字节没有访问器方法/属性。不过，如果您使用 C# 3，您总是可以将它们编写为扩展方法。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-24T22:03:34.240

您可以创建一个结构：

```
public struct MyGuid
{
    public int Data1;
    public short Data2;
    public short Data3;
    public byte[] Data4;

    public MyGuid(Guid g)
    {
        byte[] gBytes = g.ToByteArray();
        Data1 = BitConverter.ToInt32(gBytes, 0);
        Data2 = BitConverter.ToInt16(gBytes, 4);
        Data3 = BitConverter.ToInt16(gBytes, 6);
        Data4 = new Byte[8];
        Buffer.BlockCopy(gBytes, 8, Data4, 0, 8);
    }

    public Guid ToGuid()
    {
        return new Guid(Data1, Data2, Data3, Data4);
    }
} 
```

现在，如果要修改 Guid：

```
Guid g = GetGuidFromSomewhere();
MyGuid mg = new MyGuid(g);
mg.Data1 &= 0x7FFFFFFF;
g = mg.ToGuid(); 
```

# apache - 我是否必须为端口 80 和 443 复制 Virtualhost 指令？

> ID：679383
> 
> 赞同：62
> 
> 时间：2009-03-24T21:44:17.577
> 
> 标签：apache, virtualhost

我有一个长而复杂的 <VirtualHost> 指令列表，我必须将它们复制到端口 80 和 443 的单独 <VirtualHost> 组中，因为我使用的是 SSL。每当我更新我的 mod_rewrite 规则时，我必须记住在两个地方都这样做，否则我会破坏我的应用程序......这种重复是在自找麻烦。有没有办法将这些组合或别名 - 两者之间的唯一区别是端口 443 版本包含 SSLEngine、SSLCertificateFile 等。

我的 <Virtualhost> 包含许多 mod_rewrite 规则、LocationMatch 规则、CGI 指令等。

另外，我不能使用 .htaccess 文件。

* * *

## 回答 #1

> 赞同：52
> 
> 时间：2009-03-24T22:02:36.817

您不能使用包含指令来包含通用规则。[这里](http://httpd.apache.org/docs/2.4/mod/core.html#include)

[文章](http://blog.techstacks.com/2008/01/production-use-for-include-directive.html)

例如。：

```
<VirtualHost _default_:80>
    ...
    include conf/common_rule.conf
</VirtualHost>

<VirtualHost _default_:*>
    ...
    include conf/common_rule.conf
</VirtualHost> 

<VirtualHost _default_:443>
    ... #SSL rules
    include conf/common_rule.conf
</VirtualHost> 
```

* * *

## 回答 #2

> 赞同：36
> 
> 时间：2013-06-13T10:24:19.220

您可以在单个 Virtualhost 指令中使用任意数量的主机和端口。

```
<VirtualHost addr[:port] [addr[:port]] ...> ... </VirtualHost> 
```

在我的情况下，我使用过。

```
<VirtualHost *:80 *:443>
  ServerName loop.lk

 ....
SSLEngine on
SSLCertificateFile /etc/apache2/ssl/local.crt

</VirtualHost> 
```

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2015-11-05T13:17:45.227

很抱歉冒出这样的旧帖子，但为了帮助其他 Google 员工，我想分享一下我是如何处理它的：

我的本地主机上有几个虚拟主机，比如：`localhost`、、`foo.com``bar.com`

这是我的笔记本电脑（macosx）上的本地主机站点，我可以使用自签名证书，因此所有虚拟主机的 ssl 部分都是相同的......

我所做的是这样的：

我创建了目录`/etc/apache2/extra/vhosts/`。

我创建了一个`/etc/apache2/extra/vhosts/localhost.conf`：

```
ServerName localhost
DocumentRoot "/www/localhost"
<Directory /www/localhost>
  Require all granted
</Directory>
ErrorLog "/var/log/apache2/localhost.error_log"
CustomLog "/var/log/apache2/localhost.access_log" common 
```

答`/etc/apache2/extra/vhosts/foo.conf`：

```
ServerName foo.com
DocumentRoot "/www/foo.com"
<Directory /www/foo.com>
  Require all granted
</Directory>
ErrorLog "/var/log/apache2/foo.com.error_log"
CustomLog "/var/log/apache2/foo.com.access_log" common 
```

答`/etc/apache2/extra/vhosts/bar.conf`：

```
ServerName bar.com
DocumentRoot "/www/bar.com"
<Directory /www/bar.com>
  Require all granted
</Directory>
ErrorLog "/var/log/apache2/bar.com.error_log"
CustomLog "/var/log/apache2/bar.com.access_log" common 
```

最后一个`/etc/apache2/extra/vhosts/ssl.conf`：

```
SSLEngine on
SSLCertificateFile "/etc/apache2/ssl/server.crt"
SSLCertificateKeyFile "/etc/apache2/ssl/server.key" 
```

在我的`/etc/apache2/extra/httpd-vhosts.conf`：

```
<VirtualHost *:80>
  Include /etc/apache2/extra/vhosts/localhost.conf
</VirtualHost>
<VirtualHost *:443>
  Include /etc/apache2/extra/vhosts/localhost.conf
  Include /etc/apache2/extra/vhosts/ssl.conf
</VirtualHost>

<VirtualHost *:80>
  Include /etc/apache2/extra/vhosts/foo.conf
</VirtualHost>
<VirtualHost *:443>
  Include /etc/apache2/extra/vhosts/foo.conf
  Include /etc/apache2/extra/vhosts/ssl.conf
</VirtualHost>

<VirtualHost *:80>
  Include /etc/apache2/extra/vhosts/bar.conf
</VirtualHost>
<VirtualHost *:443>
  Include /etc/apache2/extra/vhosts/bar.conf
  Include /etc/apache2/extra/vhosts/ssl.conf
</VirtualHost> 
```

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2018-09-17T20:21:40.930

另一个替代 using 的选项`Include`是 using `Macro`（因此您可以将其全部保存在一个文件中）。

首先启用宏模块：

```
a2enmod macro 
```

然后将您共享的内容放入一个宏中，`use`并从您的虚拟主机中获取：

```
<Macro SharedStuff>
   ServerName example.com
   ServerAdmin example@example.com
   <DocumentRoot /var/www/example>
      ...
   </DocumentRoot>
</Macro>

<VirtualHost *:80>
  Use SharedStuff
</VirtualHost>

<VirtualHost *:443>
  Use SharedStuff

  SSLEngine On
  SSLProtocol All -SSLv2 -SSLv3
  ...
</VirtualHost> 
```

宏也可以带参数，并在包含的其他文件中定义；所以你可以像使用函数一样使用它们，并在你的 Apache 配置文件中节省大量重复。

有关更多详细信息，请参见此处：

[https://httpd.apache.org/docs/2.4/mod/mod_macro.html](https://httpd.apache.org/docs/2.4/mod/mod_macro.html)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-24T22:12:36.997

您可以将通用配置放入单独的文件中，并将其包含在两个 VirtualHost 段中。例如：

```
<VirtualHost 192.168.1.2:80>
  Include conf/common.conf
</VirtualHost>

<VirtualHost 192.168.1.2:443>
  Include conf/common.conf
  (put your ssl specific cofiguration stuff here ...)
</VirtualHost> 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-24T23:11:45.090

您还可以在容器内而不是在容器内指定通用指令。这就是我所做的，主要是因为我更喜欢目录级别的 mod_rewrite 规则而不是服务器级别的规则，但它也应该同样适用于您。

# visual-studio-2008 - Visual Studio 2008 已弃用的方法

> ID：679384
> 
> 赞同：3
> 
> 时间：2009-03-24T21:44:29.683
> 
> 标签：visual-studio-2008

当我在 c#/vb.net 中使用不推荐使用的方法时，我曾经收到警告消息。现在编译器从来没有警告过我。我什至创建了一个新的解决方案和项目，但还是一样。是否存在导致编译器抑制警告消息的 Visual Studio 设置？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-24T21:49:53.243

确实有警告消息的项目设置。

它可以在您的项目属性中的“构建”选项卡的“错误和警告”部分下找到。

# wpf - ElementFlow：MeasureOverride 中的异常

> ID：679389
> 
> 赞同：0
> 
> 时间：2009-03-24T21:46:08.197
> 
> 标签：wpf, itemspanel, measureoverride, elementflow

我正在尝试在我的应用程序中使用 FluidKits ElementFlow-control，但在 ElementFlow 的 MeasureOverride 方法中出现异常。

> 元素“FluidKit.Controls.ElementFlow”的布局测量覆盖不应返回 PositiveInfinity 作为其 DesiredSize，即使 Infinity 作为可用大小传入也是如此。

在 FluidKit 之后的示例应用程序中，一切正常。当调用 MeasureOverride 时，availableSize-struct 会使用控件的边界进行初始化，但在我的应用程序中，它带有宽度和高度的 INF。

我试图找出示例和我的应用程序之间的不同之处，但两者都是一个带有网格的窗口，该窗口带有一个使用 ElementFlow for ItemsPanel 的列表框。

我发现其他人在同样的异常中苦苦挣扎，但除了给列表框一个明确的大小之外，我还没有找到任何解决方案。但我不想给它一个大小，我希望网格来管理它的布局。

有什么建议么？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-06T06:57:59.390

您有机会发布一些示例代码吗？

我有一个类似的问题，原来我必须将网格作为根元素（以前网格在画布中，我最终将它移动到用户控件并且一切正常）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-07T20:44:10.867

请参阅 FluidKit CodePlex 网站上的讨论。简单的答案是打开 ElementFlow 代码并将 MeasureOverride 中的返回值从 availableSize 更改为 _viewport.DesiredSize。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2015-08-13T18:40:21.393

您根本无法在可变大小的网格或面板中使用 ElementFlow 控件。如您得到的异常所示，它不是为了处理这种情况而编写的。

你没有显示你的代码。我只能假设您的控件嵌套和定义方式允许其中一个无限增长。例如，将 ScrollViewer 作为根元素粘贴在页面中，并启用特定方向的滚动。然后你有一个控件，它允许自己在那个方向变大，并且在请求他们的测量（在那个特定的方向）时，它会将无穷大传递给子控件。如果 ElementFlow 控件是 ScrollViewer 的子控件，您将得到这个确切的异常。

如果您显示页面的 xaml，应该很容易看到哪个父控件允许其内容无限增长。

# vb.net - SortedList 未按键排序 - VB.NET

> ID：679402
> 
> 赞同：1
> 
> 时间：2009-03-24T21:48:58.580
> 
> 标签：vb.net, sortedlist, icomparer

我需要要排序的键值对，所以我决定使用 SortedList 而不是 HashTable。

我按以下顺序将数据添加到我的 SortedList 中，这是我需要的顺序

```
 Key          | Value
     --------------------------------
 1   "700-800"    | List(Of Object)
 2   "900-1000"   | List(Of Object)
 3   "1100-1200"  | List(Of Object)
 4   "1700-1800"  | List(Of Object)
 5   "1900-2000"  | List(Of Object) 
```

键是字符串，值是对象列表。键表示一个时隙，该时隙由两个整数值连接并由“-”分隔。“700”作为一个字符串，最初是一个整数 0700。

例如

```
Dim key As String = slotTimeStart.ToString() & "-" & slotTimeEnd.ToString() 
```

但是一旦将这些键值对添加到 SortedList 中，它们就会按顺序出现

```
 3   "1100-1200"  | List(Of Object)
 4   "1700-1800"  | List(Of Object)
 5   "1900-2000"  | List(Of Object)
 1   "700-800"    | List(Of Object)
 2   "900-1000"   | List(Of Object) 
```

不幸的是，我将时隙作为两个无法更改的整数值接收。

有没有办法强制对 SortedList 进行排序？或者这个问题是因为我存储密钥的方式？有没有更好的存储方法？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-24T21:53:26.853

创建一个[`SortedList(Of String, List(Of Object))`](http://msdn.microsoft.com/en-us/library/ms132319.aspx)但将 an 传递[`IComparer(Of String)`](http://msdn.microsoft.com/en-us/library/8ehhxeaf.aspx)给[构造函数](http://msdn.microsoft.com/en-us/library/ms132323.aspx)，其中实现将根据您想要的顺序比较键。

你必须自己实现它，但这不应该太难 - 只需用'-'分割字符串，解析两边`Int32.Parse`并做出相应的反应。如果您的键范围不重叠，您甚至可能不需要担心“-”之后的部分。

编辑：这是一个演示。它只打印出密钥，但这足以表明它们已按照您的需要进行排序。

```
using System;
using System.Collections.Generic;

public class Test
{
    static void Main(string[] args)
    {
        var list = new SortedList<string, int>(new RangeComparer());
        list.Add("900-1000", 10);
        list.Add("1100-1200", 20);
        list.Add("700-800", 30);
        list.Add("1700-18000", 40);
        list.Add("1900-2000", 50);

        foreach (var entry in list)
        {
            Console.WriteLine(entry.Key);
        }
    }
}

public class RangeComparer : IComparer<string>
{
    private static int ParseStartOfRange(string range)
    {
        int hyphenIndex = range.IndexOf('-');
        // Normally do some error checking in case hyphenIndex==-1
        string firstPart = range.Substring(0, hyphenIndex);
        return int.Parse(firstPart);
    }

    public int Compare(string first, string second)
    {
        // In real code you would probably add nullity checks
        int firstStart = ParseStartOfRange(first);
        int secondStart = ParseStartOfRange(second);
        return firstStart.CompareTo(secondStart);
    }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-24T21:50:24.927

看起来您是按字母顺序而不是按数字排序。您必须将密钥设为数字才能获得所需的排序顺序。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-22T10:45:17.220

长度小于 4 位的时间需要以零 ('0') 为前缀，以使其与 4 位的长度相同。这样，标准比较器会将字符串 1 的字符 1（现在将是 0）与字符串 2 的字符 1（将是 1）进行比较，字符串 1 将首先出现。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-03-24T23:16:50.757

键可以是十进制的，看起来像

```
7.08
9.1
11.12
17.18
19.20 
```

并根据需要转换并格式化为字符串。

```
 Dim sl As New SortedList(Of Decimal, Object)
    'sample data
    For x As Integer = 7 To 20 Step 2
        sl.Add(CDec(x + ((x + 1) / 100)), New Object)
    Next

    Dim aKey As Decimal
    Dim slotStart As DateTime = #1:00:00 PM#
    Dim slotEnd As DateTime = #2:00:00 PM#

    aKey = CDec(slotStart.Hour + (slotEnd.Hour / 100))
    sl.Item(aKey) = New Object 
```

# ruby - Ruby：未定义的方法`>'

> ID：679426
> 
> 赞同：7
> 
> 时间：2009-03-24T21:59:38.463
> 
> 标签：ruby, comparison, loops, while-loop

我刚开始学习 Ruby，今天遇到了一个问题。

```
numResults = /\d+/.match(ie.div(:id, 'results_label').text)
puts "Results found: "+numResults.to_s

while(numResults > 0)
.
. some more code
. 
```

我在输出中收到此错误：

> ```
> Exception: undefined method `>' for #<MatchData:0x424c6d4> 
> ```

这真的很奇怪，因为我在 IRB 中做了一个 while 循环，它运行良好。我无法让循​​环内的代码执行，因为程序坚持条件。

有谁知道怎么了？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-24T22:08:34.027

`numResults`是一个`MatchData`对象，不能和`>`方法比较。您需要将其转换为字符串，然后将字符串转换为数字：

```
while(numResults.to_s.to_i > 0) 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-24T22:14:43.607

在字符串与表达式不匹配的情况下，`numResults`将是`nil`

所以如果这就是你要测试的，你会想要

```
while( !numResults.nil? ){ 

} 
```

如果字符串*确实*与表达式匹配，`numResults`则将不`nil`包含匹配的数量（这里最多只有 1 个，因为您没有重复匹配）`numResults.size`

此外，其他张贴者需要记住，`numResults`不包含找到的匹配数，但包含来自文本数据的*实际匹配值。*

尽管

```
numResults.to_s.to_i 
```

可能会起作用，这只是由于`nil.to_s.to_i == 0`.

如果您依赖`numResults`正则表达式匹配计数方面的任何有意义的东西，那么您找错地方了。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-03-24T22:04:18.637

尝试将您的 while 条件更改为：

```
while(numResults.to_i > 0) 
```

这将强制 numResults 为整数。看起来它是作为字符串从您的正则表达式匹配器返回的。

# mysql - Mysql，可能的嵌套类别问题

> ID：679431
> 
> 赞同：5
> 
> 时间：2009-03-24T21:59:58.990
> 
> 标签：mysql

我有一个mysql问题。

我有一个应用程序，我正在从 Coldfusion 和 MSSql 迁移到 PHP/Mysql。

有类别和子类别（显然有无限的子类别）。

给定导航ID，获取产品表中所有记录的最佳方法是什么。

我正在处理两张桌子。一个是 Products 表（其 nav_id 对应于 --->），另一个是包含父/子关系的类别关系表。

所以本质上我想查询这两个表来生成与一个navigationID 和那个NavigationID 的子类别相关的所有产品。

有什么想法或方向吗？我知道必须这样做。正在认为答案将存在于嵌套查询中，但无法绕开它。

Nav_table - 包含

```
ChildNavId      int(11)
ParentNavId     int(11) 
```

Products_Table - 包含

```
productNavID    int(11) // productNavID contains the lowest level NavID 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-24T22:32:55.900

> 有类别和子类别（显然有无限的子类别）。

如果通过这种方式存在任意多个级别的类别嵌套，则无法使用“父引用”模式模型通过单个查询来获取它们。您将不得不递归地反复查询您找到的每个类别的子项，或者只是继续进行越来越长的自连接，直到您选择了最深嵌套的项目。

对于对分层数据的单查询访问，您将不得不研究构建模式的替代方法，主要是：

*   [嵌套集](http://mikehillyer.com/articles/managing-hierarchical-data-in-mysql/)：存储递归遍历树的数字顺序
*   [邻接关系](http://vadimtropashko.wordpress.com/nested-sets-and-relational-division/)：为您的孩子/父母查找添加额外的祖先/后代对

这些方法中的一种或两种，在他们的风格中，可能对你有用。（我通常以嵌套集结束，这样我也能得到一个明确的从前到后的顺序。）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-24T22:10:27.423

听起来像是编写简洁的递归算法的工作，但正如 Alex Taylor 所说，我们需要一个对您有用的模式。

# vmware-server - 我应该将数据存储在 VMWare 服务器（或任何虚拟机）安装的什么位置？

> ID：679444
> 
> 赞同：0
> 
> 时间：2009-03-24T22:04:22.273
> 
> 标签：vmware-server

我家里有一台运行 VMWare Server 的 Linux 服务器。我有一个虚拟机用于我的 Web 服务器，另一个用于我的 zimbra 服务器，另一个用于我的 mysql 服务器，另一个运行 windows xp 进行测试。

我的问题是在哪里存储数据。Web 文件、电子邮件文件、mysql 等？

这些场景中哪一个是最好的？

*   每个虚拟机都将自己的数据存储在自己的虚拟硬盘上
*   新建虚拟机进行数据存储，使用 Samba 或 NFS 共享
*   在主机上使用 Samba 或 NFS 共享数据
*   我还没有想到的其他事情

我知道通过 NFS 或 Samba 远程存储 Mysql 数据文件是一件坏事，但我想将我的数据整合在一起。（或者我可能因为这样想而崩溃）

无论如何，请让我直截了当！谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-24T22:11:04.363

为什么要将数据移出虚拟机？另外，有多少数据是真正的共享数据？如果您想将其移出以便备份到某处，请为每台机器创建单独的备份脚本/协议。备份 MySQL 数据与备份 Windows 文件有很大不同。

如果数据真的是共享的，那么我会：

*   将 Samba/NFS 用于除 MySQL 数据之外的所有内容，并将数据存储在主机或另一台真实机器上。
*   将数据库放在单独的真实机器上，然后简单地将其他机器链接到其中（我可能还会考虑为数据库设置备份脚本）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-24T22:12:35.357

The real best answer really depends on what you need the data for and how important it is. I usually keep all system data for my VM's with the virtual machine. The real important stuff goes into a persistent drive, this is a VM drive which isn't affected by snapshots. I don't know how many times I have lost information because of snapshots.

All of my testing/development VM's reside on dedicated USB hard disk. I have found this extremely handy because I can move them easily to any other machine runing vm server.

If you use NFS, the file server always has to be running for your other VM's to relying on it to work. Seems a little cumbersome to me.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-24T22:10:45.877

这完全取决于您（取决于您已经提到的性能考虑）。由于您正在虚拟化以划分应用程序，因此它将归结为您想要的。

如果您想要更轻松的管理，请将数据放在与使用它的应用程序相同的 VM 上。

如果您想要更精细的备份，请将数据放在单独的 vm 中，或者将数据放在同一 VM 上的单独 VHD 中，然后以不同的方式将它们备份到应用程序 VM。

如果您想了解 SMB/NFS，或者您希望远程客户端想要访问数据而您的配置更改很少，那么可以将数据放在网络上。

虚拟化的好处在于您可以尝试各种方式，看看您最喜欢哪种方式！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-24T22:12:12.207

您最好将数据存储在虚拟硬盘上。这样您就不必担心 NFS 问题并保持另一个运动部件处于良好的工作状态。

# c# - 线程安全和局部变量

> ID：679448
> 
> 赞同：7
> 
> 时间：2009-03-24T22:05:13.253
> 
> 标签：c#

如果我有一个像这样的局部变量：

```
Increment()
{
    int i = getFromDb(); // get count for a customer from db 
}; 
```

这是一个递增的实例类（每次客户 - 实例对象 - 进行购买时），这个变量线程安全吗？我听说局部变量是线程安全的，因为每个线程都有自己的堆栈等。

另外，我认为这个变量是共享状态是否正确？我在思想部门缺乏的是，这个变量将与不同的客户对象（例如 John、Paul 等）一起工作，因此是线程安全的，但这是有缺陷的思想，并且在并发编程方面有点缺乏经验。这听起来很天真，但是我在并发编码方面没有很多经验，就像我通常做的同步编码一样。

编辑：另外，函数调用 getFromDb() 不是问题的一部分，我不希望任何人猜测它的线程安全性，因为它只是一个调用，表明该值是从从数据库获取数据的函数分配的. :)

编辑 2：此外，getFromDb 的线程安全得到保证，因为它只执行读取操作。

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2009-03-24T22:10:25.330

`i`被声明为本地（方法）变量，所以它**通常**只存在于堆栈帧中`Increment()`- 所以是的，`i`是线程安全的......（虽然我不能评论`getFromDb`）。

*除非*：

*   `Increment`是一个迭代器块（即使用`yield return`or `yield break`）
*   `i`用于匿名方法 ( `delegate { i = i + 1;}`) 或 lambda (`foo => {i=i+foo;}`

在上述两种场景中，有一些情况是可以暴露在栈外的。但我怀疑你是否也在这样做。

请注意，*字段*（类上的变量）**不是**线程安全的，因为它们很容易暴露给其他线程。这对于字段更为明显`static`，因为所有线程自动共享相同的字段（线程静态字段除外）。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-24T22:09:56.270

您的语句有两个独立的部分 - 一个函数调用和一个赋值。

赋值是线程安全的，因为变量是本地的。对该方法的每次不同调用都会获得自己的局部变量版本，每个变量都存储在内存中不同位置的不同堆栈帧中。

对 getFromDb() 的调用可能是线程安全的，也可能不是线程安全的——取决于它的实现。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-24T22:10:04.677

只要变量是方法的本地变量，它就是线程安全的。如果它是一个静态变量，那么默认情况下它不会是。

```
class Example
{
  static int var1; //not thread-safe

  public void Method1()
   { int var2; //thread-safe
   }
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-24T22:12:12.677

虽然您的 int i 是线程安全的，但您的整个案例可能不是线程安全的。正如您所说，您的 int i 是线程安全的，因为每个线程都有自己的堆栈跟踪，因此每个线程都有自己的 i。但是，您的线程都共享同一个数据库，因此您的数据库访问不是线程安全的。您需要正确同步数据库访问，以确保每个线程仅在正确的时刻看到数据库。

与通常的并发和多线程一样，如果您只读取信息，则不需要在数据库上进行同步。一旦两个线程尝试从您的数据库中读取/写入同一组信息，您确实需要同步。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-24T22:12:47.963

i 将是“线程安全的”，因为每个线程都会按照您的建议在堆栈上拥有自己的 i 副本。真正的问题是 getFromDb() 线程的内容是否安全？

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-24T22:28:31.730

i 是一个局部变量，所以它不是共享状态。

如果您的 getFromDb() 正在读取，例如，oracle 序列或 sql server 自动增量字段，那么数据库正在处理同步（在大多数情况下，不包括复制/分布式数据库），因此您可以安全地将结果返回给任何调用线。也就是说，数据库保证每个 getFromDB() 调用都会获得不同的值。

线程安全通常需要一点点工作——更改变量的类型很少会为您带来线程安全，因为它取决于您的线程将如何访问数据。您可以通过重新设计算法来省去一些麻烦，以便它使用所有消费者同步的队列，而不是尝试编排一系列锁/监视器。或者如果可能的话，最好让算法无锁。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-21T08:06:18.260

i 在语法上是线程安全的。但是当你给实例变量赋值时，实例方法的返回值给i，那么共享数据就会被多个线程操作。

# silverlight - 使用 ADO.Net 数据服务的 Linq to Sql

> ID：679457
> 
> 赞同：1
> 
> 时间：2009-03-24T22:09:41.247
> 
> 标签：silverlight, web-services, linq-to-sql, ado.net, wcf-data-services

我正在考虑在项目中使用 ADO.Net 数据服务，以便将数据传输到 Silverlight 客户端。我想将数据服务与我现有的 Linq To Sql 类和设计器一起使用。我可能可以将所有内容重新生成为 ADO.Net 实体对象，但由于 DRY 的原因，我觉得这将是一个糟糕的设计。

我是 ADO.Net 数据服务的新手，所以我一直在阅读它，但我发现的大多数文章都是预发布的，所以我有几个问题。

首先，我读到虽然您可以将数据服务与 Linq to Sql 一起使用，但您只能将它们用于读取数据，而不能用于写入。还是这样吗？

其次，我想拥有权限，以便只有某些用户可以查看某些表。我正在使用超越 Asp.net 成员资格和角色的自定义权限系统。ADO.Net 数据服务是否提供自定义授权访问的方法？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-24T22:17:37.950

1) 是的，目前 ADO.net 只有一个 IUpdateable for Entity Framework 的实现。但我很确定你可以找到 LinqToSQL 的免费实现（这是很多人做的第一件事）

2）您可以通过“QueryInterceptors”过滤（或简单地拒绝访问）给定集合来轻松应用所需的任何授权方案。这些基本上是您的服务上的方法，只要有人发送给定集合的查询，就会应用这些方法。这样您就可以根据用户的权限应用更严格的过滤器，或者只是引发异常

# c# - NHibernate Session.Evict()

> ID：679474
> 
> 赞同：9
> 
> 时间：2009-03-24T22:14:40.720
> 
> 标签：c#, nhibernate

我无法访问我面前的代码，所以我只是想知道是否有人可以帮助我使用 Session.Evict()。

假设我有一个带有地址子集的 Person 对象。我从会话中填充 Person 对象并延迟加载 Addresses 集合。然后我调用 Session.Evict(personObject) 将 Person 对象从会话中分离出来。我的问题是，如果我尝试访问 Addresses 集合，它会返回 null，还是会因为 NHibernate 代理找不到关联的会话而出现异常？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-03-25T16:48:21.977

如果您在驱逐实体之前导致延迟加载发生，那么即使在驱逐之后也可以访问该集合。但是，如果您驱逐实体然后尝试延迟加载子集合，您将收到异常。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-25T20:26:57.413

您将收到 NHibernate.LazyInitializationException。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-25T05:50:09.407

我面前也没有代码，但是从记忆中，您可能会遇到异常。

如果你有延迟加载和工作，NHibernate 将尝试加载 Addresses 集合。它永远不应该返回不正确的值/集合，它只会在无法加载所询问的内容时抱怨。

# c# - 一次又一次地以相同的方式重命名文件

> ID：679485
> 
> 赞同：1
> 
> 时间：2009-03-24T22:19:23.517
> 
> 标签：c#, java, batch-file, file-rename

我有一个程序处理我的一些图像，并将它们返回到我的目录。有趣的是，它们现在都是 png 图像而不是 gif。

起初我认为这是简单的重命名，但我使用 createimagefrompng() 使用 php 进行了测试，如果图像不是有效的 png 文件，它将引发错误。没有返回错误。

无论这是否给我 100% 准确的结果都不是这里的问题，问题是我想以类似的方式重命名所有这些文件。

现在虽然我可以编写一个 php 文件来为我执行此操作，但我想知道如何以批处理或 c# 或 java 执行以下操作。

所有这些文件仍然包含字符串“.gif”，我想删除它。在php中，它就像使用foreach循环一样简单，读取文件，使用str_replace，然后销毁旧文件并写入新文件。

我对如何批量、c# 或 java 执行此操作有点困惑，有人可以在这里帮助我吗？

另外，我正在运行 Windows Vista，并且安装了 Powershell 1.0。

解决方案 1 - C#：

```
var files = Directory.GetFiles(@"C:\Downloads\Temp\test\");
foreach (var file in files)
{
  if(file.Contains(".gif"))
  {
    string testing = string.Format("{0}.png", Path.GetFileNameWithoutExtension(file.Replace(".gif", "")));
    File.Move(file, @"C:\Downloads\Temp\test\"+testing);
  }
} 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-24T22:31:14.423

在命令行上：

（假设没有 .gif 文件）

```
REM first rename all .gif.png to .gif
for %i in (*.gif.png) do ren %i %~ni

REN then rename all .gif to .png
for %i in (*.gif) do ren %~ni.gif %~ni.png 
```

用于 /help 以了解您的 Windows 版本支持哪些 % 选项。

以下内容不适用于 .gif.png，抱歉我误读了该部分。

~~在命令行上（更简单！）：~~

> ~~仁 *.gif *.png~~

Java 版本（固定为 .gif.png）：

```
import java.io.File;
import java.io.FilenameFilter;
import java.util.regex.Matcher;
import java.util.regex.Pattern;

public class Main
{
    public static void main(final String[] argv)
    {
        final File   dir;
        final File[] entries;

        dir     = new File(argv[0]);
        entries = dir.listFiles(new FilePatternFilter(".*\\.gif\\.png"));

        for(final File entry : entries)
        {
            if(entry.isFile())
            {
                final String path;
                final String newPath;
                final File   newEntry;

                path     = entry.getPath();
                newPath  = path.substring(0, path.length() - "gif.png".length()) + "png";
                newEntry = new File(newPath);

                if(!(entry.renameTo(newEntry)))
                {
                    System.err.println("could not rename " + entry.getPath() + 
                                       " to " + newEntry.getPath());
                }
            }
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-24T22:28:10.187

在批处理中，您可以执行以下操作：

```
@echo off
setlocal enabledelayedexpansion enableextensions
for %%f in (*.gif.png) do (
    set fn=%%f
    set fn=!fn:.gif=!
    ren "%%f" "!fn!"
)
endlocal 
```

这应该有效，至少如果文件被命名为 .gif.png ...如果不是，请更改`for`语句中的过滤器。`set`可以在语句中找到更多关于替换语句的帮助`help set`。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-24T22:29:11.840

如果您想使用 Java 将文件夹中的所有 .png 文件重命名为 .gif ，我建议您查看[Apache Commons IO](http://commons.apache.org/io/)。FileUtils类提供了一种迭代所有具有给定扩展名 ([iterateFiles][3]) 的文件的方法，而 File 本身提供了一个[renameTo](http://commons.apache.org/io/api-release/org/apache/commons/io/FileUtils.html)[方法](http://java.sun.com/j2se/1.4.2/docs/api/java/io/File.html#renameTo(java.io.File))。

*编辑*：出于某种原因，stackoverflow 不喜欢在链接 3 中使用括号，因此您必须手动复制和粘贴它。我可能会选择批处理方法，因为 Java 并不是您执行管理任务的首选 :)

[3]：[http](http://commons.apache.org/io/api-release/org/apache/commons/io/FileUtils.html#iterateFiles(java.io.File) ://commons.apache.org/io/api-release/org/apache/commons/io/FileUtils.html#iterateFiles(java.io.File , java.lang.String[], boolean)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-24T22:35:24.897

您可能可以在 c# 中执行以下操作

```
var files = new DirectoryInfo(@"c:\files").GetFiles(@"*.gif");
foreach (var file in files)
    File.Move(file.FullName, string.Format("{0}.gif", Path.GetFileNameWithoutExtension(file.FullName))); 
```

或者更简单..

```
var files = Directory.GetFiles(@"c:\files", @"*.gif");
foreach (var file in files)
    File.Move(file, string.Format("{0}.gif", Path.GetFileNameWithoutExtension(file))); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-25T01:58:55.437

如果你可以使用 C，你可以使用 boost::algorithim stringalgo 库和/或 boost::regex，如果你真的想要一个强大的方法来做到这一点。请注意，对移动文件等使用 Windows API EDIT（或 linux 等效项）会快得多，因为它们只会在磁盘上创建新的硬链接，而不是在可能的情况下复制数据。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-03-24T22:26:46.947

对于 C#，以下将执行您想要的操作 - 1\. 打开文件所在[目录](http://msdn.microsoft.com/en-us/library/system.io.directoryinfo.aspx)
的 DirectoryInfo 实例 2\. 获取所有具有您要更改的扩展名的文件。[3\. 通过重命名](http://msdn.microsoft.com/en-us/library/system.io.file.move.aspx)来 更改每个文件的扩展名。

# .net - 适用于 Linux 的 ASP.NET 页面设计器

> ID：679487
> 
> 赞同：3
> 
> 时间：2009-03-24T22:20:07.023
> 
> 标签：.net, asp.net, linux, mono, monodevelop

是否有在 Linux 上运行的简单但体面的 .aspx 设计器？我已经解决了[这个](https://stackoverflow.com/questions/588261/alternative-asp-net-designer-ide)问题中的所有问题，但没有一个满足“在 Linux 上运行”的条件。体面的意思是设计师允许我在网页上放置 asp.net 网络控件，以便在 Monodevelop 中进一步使用。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-24T23:28:10.183

[X-Develop](http://www.omnicore.com/en/xdevelop.htm)还没有。我知道有一些使用 MozEmbed 来实现 MonoDev 的功能（几年前在 SOC 上的 IIRC），但从未集成。

如果您*真的*需要此功能，那么 Windows 的副本（在 VM 中）和 MS Expression Web 或 Web Developer 2008 Express 可能是最佳选择。要么就是这样，要么学习编写标记，这通常是许多开发人员做事的方式。

# c# - 确定端口是否正在使用？

> ID：679489
> 
> 赞同：7
> 
> 时间：2009-03-24T22:21:22.153
> 
> 标签：c#, wcf

有没有办法使用 C# 来确定端口是否可用？我想在使用已使用的端口启动 WCF ServiceHost 实例之前进行检查:-)

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-24T22:33:45.213

您无法确定端口是否可用。你只能确定

1.  你控制了一个端口
2.  一个端口在过去的某个时候是可用的

除非您通过绑定特定套接字并在端口上侦听来控制端口，否则另一个进程可能会出现并控制该端口。

知道端口是否可用的唯一可靠方法是尝试监听它。如果成功，则端口可用并且您可以控制。否则，您知道在**过去**的某个时间点以及可能的现在，该端口是由另一个实体控制的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2015-10-19T10:00:58.323

至于[在 C# 中，如何检查 TCP 端口是否可用？](https://stackoverflow.com/questions/570098/in-c-how-to-check-if-a-tcp-port-is-available)，我认为原始发布者并不确定他是在谈论客户端还是服务器，所以答案也是关于客户端想要连接或服务器想要监听端口。

JaredPar 的答案是正确的（不止这个！）虽然有时可能不方便。

如果您有理由确定没有其他服务器正在抓取您刚刚检查的端口（或者不关心偶尔的故障），您可以尝试（来自[http://www.codeproject.com/Tips/268108/Find-the- open-port-on-a-machine-using-Csharp?msg=4176410#xx4176410xx](http://www.codeproject.com/Tips/268108/Find-the-open-port-on-a-machine-using-Csharp?msg=4176410#xx4176410xx)，类似于[https://stackoverflow.com/a/570461/586754](https://stackoverflow.com/a/570461/586754)）：

```
public static int GetOpenPort(int startPort = 2555)
{
    int portStartIndex = startPort;
    int count = 99;
    IPGlobalProperties properties = IPGlobalProperties.GetIPGlobalProperties();
    IPEndPoint[] tcpEndPoints = properties.GetActiveTcpListeners();

    List<int> usedPorts = tcpEndPoints.Select(p => p.Port).ToList<int>();
    int unusedPort = 0;

    unusedPort = Enumerable.Range(portStartIndex, 99).Where(port => !usedPorts.Contains(port)).FirstOrDefault();
    return unusedPort;
} 
```

# vxworks - 如何从 Workbench 构建 PXE 可引导引导加载程序？

> ID：679490
> 
> 赞同：0
> 
> 时间：2009-03-24T22:21:42.170
> 
> 标签：vxworks, boot, bootstrapping, bootstrapper

我正在尝试构建一个可从 Workbench 进行 PXE 引导的 VxWorks 引导加载程序，但没有任何成功。这是我的环境的一个破败：

*   VxWorks 6.6 + 最新补丁
*   Workbench 3.0 + 最新补丁
*   蒙特维纳 BSP 版本 2.0/1

目标是戴尔 Precision M4400 笔记本电脑。这是我一直在做的事情，但没有成功：

1.  `VxWorks Image Project`使用配置文件在基于 Montevina BSP 的 Workbench 中创建一个新的`PROFILE_BOOTAPP`。
2.  将以下组件添加到内核配置（否则构建失败）：
    - `INCLUDE_TIMER_SYS`
    - `INCLUDE_PCI_BUS`
    - `INCLUDE_PCI_OLD_CONFIG_ROUTINES`
    -`INCLUDE_PENTIUM_PCI`
3.  将`INCLUDE_PC_CONSOLE`组件添加到内核配置中以进行控制台显示（目标上没有任何串行端口）
4.  将构建规范设置为`default_romCompress`并添加一个名为的新构建目标`vxWorks_romCompress.bin`
5.  构建`vxWorks_romCompress.bin`目标，这将创建相应的文件。
6.  将 PXE 填充添加到文件中：
    `cat $WIND_BASE/vxworks-6.6/target/config/montevina/pxeBoot.bin vxWorks_romCompress.bin > vxWorks_romCompress.pxe`
7.  复制`vxWorks_romCompress.pxe`到我的 TFTP 服务器的适当位置，然后从我的目标执行 PXE 引导。

此时，目标成功地从 TFTP 服务器下载文件，但停在那里没有输出。控制台上没有显示任何内容。

和似乎在 Workbench 项目中设置正确（它们分别与旧 config.h 文件的设置匹配和`RAM_HIGH_ADRS`）。`RAM_LOW_ADRS``0x00108000``0x003080000`

（请注意，Montevina BSP 确实附带了一个预构建的`bootrom.pxe`引导加载程序，我**已经**能够成功地进行 PXE 引导。不过，我需要向引导加载程序添加几个组件，并且真的更喜欢通过Workbench 环境，而不是旧的 config.h 方法。）

我还尝试镜像 Workbench 项目的内核配置中包含的组件，以尽可能接近地匹配旧版 config.h 设置，但没有成功。这些是添加的组件（除了这些组件的任何依赖项）：

*   `INCLUDE_PLB_BUS`
*   `DRV_NVRAM_FILE`
*   `INCLUDE_GENERICPHY`
*   `DRV_INTCTLR_IOAPIC`
*   `INCLUDE_GEI825XX_VXB_END`
*   `DRV_TIMER_IA_TIMESTAMP`
*   `INCLUDE_MII_BUS`
*   `DRV_INTCTLR_MPAPIC`
*   `DRV_SIO_NS16550`
*   `INCLUDE_FEI8255X_VXB_END`
*   `DRV_TIMER_LOAPIC`
*   `INCLUDE_SIO_UTILS`
*   `VXBUS_TABLE_CONFIG`
*   `INCLUDE_INTCTLR_LIB`
*   `INCLUDE_DMA_SYS`
*   `INCLUDE_PARAM_SYS`
*   `INCLUDE_SW_FPP`

所以，这就是我现在的位置。我猜问题出在上面的步骤 4-6 中，但我在文档中没有看到任何关于从 Workbench 中使引导加载程序 PXE 可引导的正确方法。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-18T22:22:10.553

风河联系我说目前不支持。

# .net - NHibernate - 多对多加入自身

> ID：679493
> 
> 赞同：1
> 
> 时间：2009-03-24T22:24:58.150
> 
> 标签：.net, nhibernate

我正在尝试创建一个简单的 User 对象，该对象具有指向 IList 的 Friends 属性。

开始只是试图让 ISet 工作。

```
<hibernate-mapping xmlns="urn:nhibernate-mapping-2.2" default-lazy="false"
                   assembly="MyProject.Domain" namespace="MyProject.Domain">
  <class name="User" table="[User]">
    <id name="Id" column="UserId">
      <generator class="increment" />
    </id>
    <property name="UserName" column="UserName" />
    <property name="Location" />
    <set name="Friends" table="Friend" lazy="false">
      <key column="UserId" />
      <many-to-many class="User" column="FriendId" />
    </set>
  </class>
</hibernate-mapping> 
```

这似乎工作正常。但是我如何将其转换为 IList，并可能按建立关系的日期对好友进行排序（按时间倒序） 我可以在好友表中添加“排序依据”字段吗？

到目前为止，这是我的课-

```
public class User
{
    public virtual int Id { get; set; }
    public virtual string UserName { get; set; }
    public virtual string Location { get; set; }
    public virtual ISet<User> Friends { get; set; }

} 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-25T00:42:47.837

您可以使用 Bag 映射代替集合映射来为您提供 IList。您还可以将 order-by 元素添加到 NHibernate 文档中指定的包映射

```
<map
    name="propertyName"                                         (1)
    table="table_name"                                          (2)
    schema="schema_name"                                        (3)
    lazy="true|false"                                           (4)
    inverse="true|false"                                        (5)
    cascade="all|none|save-update|delete|all-delete-orphan"     (6)
    sort="unsorted|natural|comparatorClass"                     (7)
    order-by="column_name asc|desc"                             (8)
    where="arbitrary sql where condition"                       (9)
    fetch="select|join"                                         (10)
    batch-size="N"                                              (11)
    access="field|property|ClassName"                           (12)
>

    <key .... />
    <index .... />
    <element .... />
</map> 
```

# c# - 在 VS 安装程序（安装程序）项目中禁用广告文件关联

> ID：679495
> 
> 赞同：0
> 
> 时间：2009-03-24T22:25:14.063
> 
> 标签：c#, visual-studio, installation, windows-installer

我在 VS 2005 中使用了一个安装项目，并且我已经了解了所有关于广告快捷方式的“乐趣”。

我的项目在桌面和开始菜单上创建程序的快捷方式，每当运行这些快捷方式时，MSI 都会重新安装应用程序（因为已安装的文件已更改）。我还为我的应用程序创建了一个文件关联，它做同样的事情。

我已经想出了如何设置一个可以在构建后运行以禁用广告快捷方式的 vbscript（使用 DISABLEADVTSHORTCUTS = 1），但是，我不知道如何通过文件关联来实现相同的功能！

更新：让我解释一下我在做什么，然后你可以告诉我是否有更好的方法。我包含了我的应用程序所依赖的单独实用程序。我不想将该实用程序的每个文件都添加为依赖项，因为它确实使安装项目变得混乱，所以我将其压缩并添加了 zip。

然后我运行安装程序实现并覆盖 OnAfterInstall 以将实用程序解压缩到适当的位置，然后删除实用程序 zip。当广告的快捷方式运行时，删除实用程序 zip 会触发整个安装/修复过程。

所以我想我的解决方案是 A）禁用广告的快捷方式和广告的文件关联或 B）让 MSI 安装程序不触发对丢失的 zip 文件的安装/修复。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-25T02:04:46.343

问题是**为什么安装的文件发生了变化？**

MSI 修复的好处是，如果出现问题、病毒感染了您的应用程序，或者某些愚蠢的用户删除了错误的文件/注册表项，那么 Windows 安装程序弹性检查就会启动并修复您的所有文件。

在许多情况下，Windows Installer 弹性检查会启动。我建议您更改应用程序的行为，这样您就不会更新已安装的文件。或者，如果您不想遵循“最佳实践”并且不更新已安装的文件，那么您可能需要使用替代安装程序技术。

例如，您不是在对程序文件中的内容进行更改，是吗？您的应用程序如何处理在受限用户帐户下的运行？在终端服务器上？在 Vista 上？这些场景都不允许写入程序文件文件夹（或任何受保护的每台机器位置）

防止这种行为发生的一种解决方案是：

*   安装默认配置文件到`All Users\Application Data`
*   在第一次运行时将这些复制到`Username\Application Data`（又名`%AppData%`）
*   仅更新每个用户的文件。这可以防止在 MSI 修复期间丢失/更改配置。

**更新：**尽量不要在特定组件中将 ZIP 设置为“密钥文件”，我认为 Windows 安装程序只检查密钥文件是否未更改。我认为您可能很快就会遇到 VS2005 设置项目的限制，因此如果您有时间，可能值得一试[WiX 。](http://wix.sf.net/)您还会发现一件事是 Windows Installer 安装项目几乎总是杂乱无章，拥有数百或数千个组件似乎是野兽的本性。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-08T19:00:29.747

尝试在安装项目中标记 .zip 文件属性 Exclude=true，这将使安装程序可以使用该文件，而无需将其安装在目标计算机上。

也就是说，我同意 Sascha 的观点，即安装程序项目通常有数百个依赖项。

# scala - Scala API 设计；返回一个集合的服务，其中我是某个接口（抽象/特征）

> ID：679500
> 
> 赞同：1
> 
> 时间：2009-03-24T22:27:08.317
> 
> 标签：scala, covariance, scala-collections

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-25T09:06:38.187

您的最后一段代码更接近地模仿了您正在模拟的 Java 代码：返回一个可变 Set 的只读视图。

也就是说，在这种情况下，如果您的支持实现是 immutable.Set[ProductImpl] 并且您想返回一个 immutable.Set[IProduct]，则可以安全地进行转换。

```
import scala.collection._

trait IProduct
class ProductImpl extends IProduct

val productsByIsin: immutable.Map[String, immutable.Set[ProductImpl]] =
  immutable.Map.empty
def getProducts(isin: String): immutable.Set[IProduct] =
  productsByIsin.getOrElse(isin, immutable.Set.empty).asInstanceOf[immutable.Set[IProduct]] 
```

# hibernate - 无法使用 Spring JPA Vendor Adapter 使休眠停止显示 SQL

> ID：679518
> 
> 赞同：16
> 
> 时间：2009-03-24T22:34:13.340
> 
> 标签：hibernate, spring, jpa

Hibernate 继续向 stdout 发送 SQL 跟踪，当它隐藏在 JPA 适配器后面时，我不知道如何更改 Hibernate 配置属性。这是 entityManagerFactory 的 Spring bean：

```
<bean id="entityManagerFactory" 
    class="org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean">
    <property name="dataSource" ref="ssapDataSource"/>
    <property name="jpaVendorAdapter">
        <bean class="org.springframework.orm.jpa.vendor.HibernateJpaVendorAdapter" >
            <property name="showSql" value="false"/>
        </bean>
    </property>
</bean> 
```

即使将 showSql 属性设置为 false，Hibernate 仍会继续打印 SQL。

我尝试使用“hibernate.show_sql=false”在我的类路径中创建一个 hibernate.properties 文件，但它也没有选择它。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-08-12T18:58:29.753

尝试在persistance.xml中设置它

```
<persistence>
  <persistence-unit name="PU">
    <properties>
      <property name="hibernate.show_sql" value="false"/>
    </properties>
  </persistence-unit>
</persistence> 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2012-10-10T01:01:12.053

```
<property name="jpaProperties">
    <props>
        <prop key="hibernate.show_sql">false</prop>
    </props>
</property> 
```

这也可以

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-24T22:50:38.947

`org.hibernate.SQL`据我所知，如果日志记录发生在`DEBUG`或级别，Hibernate 还将记录 SQL 语句`ALL`，因此您可以尝试禁用它（例如`log4j.logger.org.hibernate.SQL=info`在使用 Log4J 时）。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-05-03T18:11:01.610

如果您使用的是 spring，请确保您没有将 showSql 属性设置为 true

我自己在做这个

```
<bean id="vendorAdapter" class="org.springframework.orm.jpa.vendor.HibernateJpaVendorAdapter">
    <property name="showSql" value="false"/>
</bean> 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2013-04-29T14:20:02.740

将此添加到您的 log4j.properties

```
log4j.logger.org.hibernate = WARN 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2016-03-31T10:24:20.590

这对我有用：

```
spring.jpa.show-sql=false 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2016-08-25T15:15:11.193

以下是显示或隐藏休眠 sql 查询的三种方法（可能是其他方法）：

1.  在记录器配置（logback 的调试级别）中：

    ```
    <logger name="org.hibernate.SQL" level="DEBUG" /> 
    ```

2.  在 Spring 配置中（例如在 java 配置中）：

    ```
    @Bean
    public LocalContainerEntityManagerFactoryBean entityManagerFactory() {
    final LocalContainerEntityManagerFactoryBean lef = new LocalContainerEntityManagerFactoryBean();
    //...
    final Properties jpaProperties = new Properties(); // java.util
    //TODO replace "true" by a variable
    jpaProperties.setProperty("hibernate.show_sql", "true"); 
    lef.setJpaProperties(jpaProperties);
    return lef;
    } 
    ```

3.  在persistence.xml中

    ```
    <property name="hibernate.show_sql" value="true" /> 
    ```

记录器配置似乎独立于持久性配置。至于持久性配置，spring似乎覆盖了persistence.xml（我用spring加载的persistence.xml对其进行了测试，如果不是这种情况，我不知道会有什么行为）。

两种配置之间的区别在于结果日志记录，使用 logback 它将如下所示：

```
2016-08-25 16:05:39,436 调试 org.hibernate.SQL(92) - 更改表 ...
```

使用持久性配置：

```
休眠：更改表...
```

# c++ - 关于使用用户定义方法扩展 C++ STL 容器的更好方法的建议

> ID：679520
> 
> 赞同：14
> 
> 时间：2009-03-24T22:35:10.513
> 
> 标签：c++, stl

我继承自 C++ STL 容器并向其中添加我自己的方法。其基本原理是，对于客户来说，它看起来像是一个常规列表，但具有可以很容易地调用的特定于应用程序的方法。

这很好用，但我读过很多关于不从 STL 继承的帖子。有人可以就我如何以更好的方式编写下面的代码提供具体建议吗？

```
class Item
{
  int a;
  int b;
  int c;

  int SpecialB()
  {
    return a * b + c;
  }
};

class ItemList : public std::vector<Item>
{
  int MaxA()
  {
    if( this->empty() )
      throw;

    int maxA = (*this)[0].a;

    for( int idx = 1; idx < this->size(); idx++ )
    {
      if( (*this)[idx].a > maxA )
      {
        maxA = (*this)[idx].a;
      }
    }
    return maxA;
  }

  int SpecialB()
  {
    if( this->empty() )
      throw;

    int specialB = (*this)[0].SpecialB();

    for( int idx = 1; idx < this->size(); idx++ )
    {
      if( (*this)[idx].SpecialB() < specialB )
      {
        specialB -= (*this)[idx].c;
      }
    }
    return specialB;
  }

  int AvgC()
  {
    if( this->empty() )
      throw;

    int cSum = 0;
    for( int idx = 0; idx < this->size(); idx++ )
    {
      cSum += (*this)[idx].c;
    }

    return cSum / this->size(); // average
  }
}; 
```

**编辑**：感谢一堆深思熟虑的答案。我将创建辅助函数，从现在开始将永远不会从 STL 容器继承。

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-03-24T23:07:54.587

这是个**坏**主意。

不应该从 STL 类派生的原因有很多，其中最重要的是它们不是为它设计的。Vector 没有虚拟析构函数，因此如果扩展它，超类的析构函数可能无法正确调用，并且会导致内存泄漏。

有关这方面的更多信息，请参阅为什么*不*从`std::string`. 许多相同的观点适用：

[构造函数不适用于从 std::string 继承的类](https://stackoverflow.com/questions/555612/constructor-doesnt-work-for-class-inherited-from-stdstring/555633#555633)

*   没有虚拟析构函数
*   没有受保护的功能（因此您通过继承一无所获）
*   多态性不起作用，您将获得对象切片。 `std::vector`是可分配的，但如果您添加自己的字段，如果您从向量指针或向量引用进行分配，它们将不会在分配时被复制。这是因为`vector`'s`operator=`不知道您的字段。

由于所有这些原因，当涉及到 STL 时，最好制作实用函数而不是扩展。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-03-24T22:36:42.257

为什么需要以这种方式扩展向量？

对你的函子使用标准`<algorithm>`。
例如

[`std::min_element`](http://en.cppreference.com/w/cpp/algorithm/min_element),[`std::max_element`](http://en.cppreference.com/w/cpp/algorithm/max_element)

```
int max_a = std::max_element
        ( 
            v.begin(), 
            v.end(), 
            boost::bind( 
                std::less< int >(),
                bind( &Item::a, _1 ), 
                bind( &Item::a, _2 ) 
            )
        )->a; 
```

[`std::accumulate`](http://en.cppreference.com/w/cpp/algorithm/accumulate)- 用于计算平均值

```
const double avg_c = std::accumulate( v.begin(), v.end(), double( 0 ), boost::bind( Item::c, _1 ) ) / v.size(); // ofcourse check size before divide 
```

您的 ItemList::SpecialB() 可以重写为：

```
int accumulate_func( int start_from, int result, const Item& item )
{
   if ( item.SpecialB() < start_from )
   {
       result -= item.SpecialB();
   }
   return result;
}

if ( v.empty() )
{
    throw sometghing( "empty vector" );
}
const int result = std::accumulate( v.begin(), v.end(), v.front(), boost::bind( &accumulate_func, v.front(), _1, _2 ) ); 
```

顺便说一句：如果您不需要访问成员，则不需要继承。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2009-03-24T22:54:31.623

由于您只能通过使用其公共接口来“扩展”向量，因此编写对向量进行操作而不是作为向量的一部分的函数要有用得多。

哎呀，如果你计划得当，让它与迭代器而不是索引一起工作，它不仅仅可以工作`std::vector`（参见`<algorithm>`一些非常好的例子）。

例如，您可以像这样为 MaxA 使用函子：

```
struct CmpA {
    bool operator()(const Item &item1, const Item &item2) { return item1.a < item2.a; }
}

const int result = std::max_element(v.begin(), v.end(), CmpA()).a; 
```

您的 specialB 可以与仿函数一样简单，并且`std::accumulate`

**编辑：**或者对于 c++11 及更高版本，它可以很简单：

```
const int result = std::max_element(v.begin(), v.end(), [](const Item &item1, const Item &item2) {
    return item1.a < item2.a;
}).a; 
```

**编辑：**你问过为什么这样做更好：

如果您使用算法、模板和迭代器，即使您决定将项目放入 a`std::list<Item>`或其他任何内容中，它也会起作用。它只是更通用，并有助于代码的可重用性。

加上里面的函数`<algorithm>`为你做了很多，所以你可以只使用小的 3 线适配器仿函数。

**编辑：**除此之外，[tgamblin](https://stackoverflow.com/questions/679520/advice-on-a-better-way-to-extend-c-stl-container-with-user-defined-methods/679611#679611)列出了一些非常令人信服的理由，不要从`std::vector`（以及大多数其他标准容器，包括`std::string`）继承。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-03-24T23:41:39.370

我更喜欢将 stl 容器用作**实现细节**，而不是作为解决方案**接口**的一部分。这样，如果需要，我可以在不影响任何调用代码的情况下更改容器（双端队列或列表的向量）。您可能必须通过函数编写一些调用，但封装值得额外输入。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-03-24T23:03:21.850

由于 STL 容器的方法不是虚拟的，因此会出现有关不从 STL 容器继承的警告。因此，如果您不覆盖方法并且不需要多态行为，而只是扩展类 - 继承 STL 容器是可以的。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-03-24T22:57:46.107

如果标准算法没有你需要的，只需编写自由函数，最好是模板化的。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-24T22:53:26.210

我不明白为什么你需要用这些方法扩展向量。您可以将它们编写为独立函数，例如：

```
int MaxA(const std::vector<Item>& vec) {
    if(vec.empty()) {
        throw;
    }

    int maxA = vec[0].a;
    for(std::vector<Item>::const_iterator i = vec.begin(); i != vec.end(); ++i) {
        if(i->a > maxA) {
            maxA = i->a;
        }
    }
    return maxA;
} 
```

或者有 std::max_element 会做同样的事情......当然减去投掷。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-03-25T06:04:49.170

你是正确的，你不应该从 STL 容器继承。虚函数会使它们有意义地变大——向量的基本大小将从 12 字节跳到 16 字节（在我正在使用的实现中）。除此之外，虚函数很难内联，这会减慢代码的速度。如果您发现自己制作了一个包含一百万个大部分为空的向量的数组，那么差异会很快增加。

您仍然可以通过将向量声明为 ItemList 中的成员变量，然后通过您希望公开的任何方法来获得所需的效果。

```
class ItemList {
private:
  std::vector< Item > mItems;
public:
  typedef std::vector< Item >::size_type size_type;
  int MaxA();
  int SpecialB();
  Item &operator[]( size_type offset ) { return mItems[offset]; }
  size_type size() const { return mItems.size(); }
}; 
```

……等等。这是相当多的繁重工作，但它会给你你所要求的效果。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2021-06-11T14:38:06.867

只需编写一个将向量作为私有成员的类，然后编写作用于该向量的公共接口函数。

编辑：我看到 AHelps 已经给出了相同的答案，所以碰碰......

# php - PHP：按半小时间隔对数组进行排序

> ID：679521
> 
> 赞同：0
> 
> 时间：2009-03-24T22:35:13.227
> 
> 标签：php, arrays, multidimensional-array

我在这里有一个非常具体的问题。我有一个多维数组，我想先按半小时时间间隔排序，然后按日期排序。函数[array_multisort](http://us2.php.net/manual/en/function.array-multisort.php)不符合我的要求。

示例：我想要：

```
array(array("time"=>"12:15",
            "date"=>"2009-03-24"),
      array("time"=>"12:10",
            "date"=>"2009-03-23"),
      array("time"=>"12:00",
            "date"=>"2009-03-24"),
      array("time"=>"11:30",
            "date"=>"2009-03-24")); 
```

最终成为：

```
array(array("time"=>"11:30",
            "date"=>"2009-03-24"),
      array("time"=>"12:10",
            "date"=>"2009-03-23"),
      array("time"=>"12:00",
            "date"=>"2009-03-24"),
      array("time"=>"12:15",
            "date"=>"2009-03-24")); 
```

我尝试使用[uksort](http://php.net/manual/en/function.uksort.php)结合我自己的排序回调函数来完成此操作。这是我目前使用的代码：

```
uksort($myArray, "sortThirties");

function sortThirties($a, $b)
{
    //Get the two times as timestamps relative to today
    $one = strtotime($a['time']);
    $two = strtotime($b['time']);

    //Round them down to the nearest half-hour time
    $one = $one - ($one % 1800);
    $two = $two - ($two % 1800);

    //Return the difference if times are unequal
    //If times are equal, return the difference between dates.
    return ($one == $two ? strcmp($a['date'],$b['date']) : $one - $two);
} 
```

运行此函数后，我立即使用 print_r() 打印出数组，并且数据的顺序似乎是随机的。我错过了什么？

**编辑**：事实证明，顺序**是** *完全*随机的。我将此行添加到 sortThirties 函数中：

```
echo "<BR>",$a['time']," ",$b['time']; 
```

我得到的只是 50 页的`<BR>`'s.

我知道数组的结构是正确的，因为在同一个数组上执行的这段代码给了我未排序的数据：

```
foreach($myArray AS $a)
{
    echo "<BR>",$a['date']," ",$a['time'];
} 
```

我唯一能想到的就是uksort一定有问题。有什么想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-24T23:07:40.700

很奇怪。我刚刚在与您提供的类似的数组上尝试了您的代码，并且效果很好。可能性：

*   任何数组时间/日期上的额外空格？
*   PHP版本差异？我注意到 strtotime() 的返回值在 PHP 5.1.0 版本中发生了变化

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-25T07:31:41.097

uksort函数按键对数组进行排序，而**usort****按**值对数组进行排序，并且要排序的数组是准确的：

```
$to_sort = array( 
                  0 => array("time"=>"12:15", "date"=>"2009-03-24"),
                  1 => array("time"=>"12:10", "date"=>"2009-03-23"),
                  2 => array("time"=>"12:00", "date"=>"2009-03-24"),
                  3 => array("time"=>"11:30", "date"=>"2009-03-24")
                ); 
```

你看得到差别吗？:)

# c# - C#字符串操作问题

> ID：679523
> 
> 赞同：5
> 
> 时间：2009-03-24T22:35:47.283
> 
> 标签：c#, linq, string

这是一个简单的问题。我有一个应用程序需要一个电话号码，如“13335557777”，需要反转它并在每个号码之间插入一个点，如下所示：

“7.7.7.7.5.5.5.3.3.3.1。”

我知道我可以使用 StringBuilder 和 for 循环来反转字符串并插入点，但是在 LINQ（或其他方式）中有没有聪明的方法来做到这一点？

注意：为此，我并不真正关心性能或内存分配或其他什么，只是想知道如何在 LINQ 中完成。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-24T22:40:20.860

试试这个

```
var source = GetTheString();
var reversed = source.Reverse().Select(x => x.ToString()).Aggregate((x,y) => x + "." + y); 
```

**编辑**

这个解决方案绝对是针对“聪明”的目的。使用 StringBuilder 构建字符串可能会更高效。该解决方案创建了许多中间字符串。

**编辑2**

关于“聪明”解决方案与 StringBuilder 方法的相对速度存在一些争论。我写了一个快速基准来衡量这种方法。正如预期的那样，StringBuilder 更快。

*   普通聚合（100 个元素）：00:00:00.0418640
*   WithStringBuilder（100 个元素）：00:00:00.0040099
*   普通聚合（1000 个元素）：00:00:00.3062040
*   WithStringBuilder（1000 个元素）：00:00:00.0405955
*   普通聚合（10000 个元素）：00:00:03.0270392
*   WithStringBuilder（10000 个元素）：00:00:00.4149977

但是，速度差异是否显着在很大程度上取决于它在您的应用程序中实际使用的位置。

基准代码。

```
public static class AggregateUnchanged {
    public static string Run(string input) {
        return input
            .Reverse()
            .Select(x => x.ToString())
            .Aggregate((x, y) => x + "." + y);
    }
}

public static class WithStringBuilder {
    public static string Run(string input) {
        var builder = new StringBuilder();
        foreach (var cur in input.Reverse()) {
            builder.Append(cur);
            builder.Append('.');
        }

        if (builder.Length > 0) {
            builder.Length = builder.Length - 1;
        }

        return builder.ToString();
    }
}

class Program {
    public static void RunAndPrint(string name, List<string> inputs, Func<string, string> worker) {

        // Test case. JIT the code and verify it actually works 
        var test = worker("123456");
        if (test != "6.5.4.3.2.1") {
            throw new InvalidOperationException("Bad algorithm");
        }

        var watch = new Stopwatch();
        watch.Start();
        foreach (var cur in inputs) {
            var result = worker(cur);
        }
        watch.Stop();
        Console.WriteLine("{0} ({2} elements): {1}", name, watch.Elapsed, inputs.Count);
    }

    public static string NextInput(Random r) {
        var len = r.Next(1, 1000);
        var builder = new StringBuilder();
        for (int i = 0; i < len; i++) {
            builder.Append(r.Next(0, 9));
        }
        return builder.ToString();
    }

    public static void RunAll(List<string> input) {
        RunAndPrint("Normal Aggregate", input, AggregateUnchanged.Run);
        RunAndPrint("WithStringBuilder", input, WithStringBuilder.Run);
    }

    static void Main(string[] args) {
        var random = new Random((int)DateTime.Now.Ticks);
        RunAll(Enumerable.Range(0, 100).Select(_ => NextInput(random)).ToList());
        RunAll(Enumerable.Range(0, 1000).Select(_ => NextInput(random)).ToList());
        RunAll(Enumerable.Range(0, 10000).Select(_ => NextInput(random)).ToList());
    }
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-24T22:55:27.127

这样做的好处是 String.Join 将比“.Aggregate((x,y) => x + "." + y)" 便宜。

```
var target = string.Join(".", source.Reverse().Select(c => c.ToString()).ToArray()); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-24T22:47:42.857

```
 string x = "123456";
        StringBuilder y = new StringBuilder(x.Length * 2);

        for (int i = x.Length - 1; i >= 0; i--)
        {
            y.Append(x[i]);
            y.Append(".");
        } 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-24T22:41:49.030

（使用`char`列表删除了答案）

根据另一篇文章的评论，我的观点是，虽然 LINQ 等可能是“聪明的”，但它不一定有效。例如，它会产生很多需要收集的中间字符串。

我会坚持`StringBuilder`等，除非你有充分的理由改变它。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-24T22:49:20.730

```
string aString = "13335557777";
string reversed = (from c in aString.Reverse()
                 select c + ".").Aggregate((a, b) => a + b); 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-24T22:50:13.067

这真的是一个linq问题吗？只需在每个字符循环中向后工作：

```
string s = "";
string content = "35557777";
for (int i = content.Length -1; i > 0; i--)
{
    s += content[i] + ".";
}
Console.WriteLine(s);
Console.ReadLine(); 
```

如果它是一个长度超过 4k 的字符串，请使用 StringBuilder。将 LINQ 用于“7.7.7.7.5.5.5.3.3.3.1”。这不是 LINQ 的用途，如果你愿意，可以将我标记为 -99，Marc 也是如此。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2009-03-24T22:48:55.503

只要您已经通过数组，使用 string.Join 会更容易：

```
string[] source = GetTheStringAsArray();
string reversed = string.Join(".", source.Reverse()); 
```

# language-agnostic - 我应该将代表向量分量总和的变量命名为什么？

> ID：679528
> 
> 赞同：1
> 
> 时间：2009-03-24T22:37:25.143
> 
> 标签：language-agnostic, math, naming, linear-algebra

有一个有效的数学术语吗？我可以将这个人命名为“sumXY”，但那是（a）蹩脚的，并且（b）不可扩展，因为上升一个维度需要重命名。

打字时我想到了“componentSum”，但我很想知道它是否有真名。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-24T22:43:59.307

如果您取绝对值的总和，则称为[L1 范数](http://mathworld.wolfram.com/L1-Norm.html)（Lebesgue 1 norm 的缩写）。

如果您不采用绝对值，我建议将其称为总和，或者可能是向量总和（正如其他人所建议的那样）。

**编辑：**

在阅读了各种评论后，我建议使用术语“元素总和”。如果你的向量可以包含负值，并且在求和之前没有取元素的绝对值，那么使用“距离”、“长度”或“标准”等术语是错误的。所有这些都意味着在求和之前取每个元素的绝对值。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-24T22:43:32.943

为什么不直接将其命名为*vector* Sum，其中*vector*是向量的名称。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-24T22:47:37.443

如果您的向量实际上是物理意义上的向量，那么您几乎没有正当理由必须将组件相加。所以我怀疑你正在使用的实际上是一个数字列表（即一个 CS 向量）而不是一个真正的（物理）向量，你不应该太担心命名。`'componentSum'`或者`'cSum'`甚至`'sigma'`......任何对你有意义的东西。

# wcf - WCF：IsInitiating 到底是做什么的？

> ID：679531
> 
> 赞同：4
> 
> 时间：2009-03-24T22:38:13.767
> 
> 标签：wcf

在某些地方，我看到 IsInitiating 创建了一个新会话。其他地方说它仅在需要时才创建新会话。哪个是对的？

为了清楚起见，我想确保我可以在不创建三个会话的情况下调用 IService.Foo 三次。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-24T22:51:12.923

第一次通过通道调用 IsInitiating=true 操作时，会话开始。未来对 IsInitiating=true 操作的调用不会启动新会话，它们只是成为现有会话的一部分。调用 IsTerminating 操作后会话结束（这会导致客户端关闭通道）。一旦 IsTerminating 操作返回，就不能通过通道调用进一步的操作。这些属性使开发人员可以控制相对于会话生命周期的操作调用顺序。

[对不起，这里是源链接。](http://msdn.microsoft.com/en-us/library/system.servicemodel.operationcontractattribute.isinitiating.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2018-07-22T12:43:40.847

划界就是通过一些特殊的属性对服务操作进行注解，以确定其执行顺序中的第一个和最后一个操作。考虑一个具有 4 个方法/操作的服务，分别命名为 SignIn()、GetDetails()。TransferFund() 和 SignOut()。在这种情况下，用户必须先登录，然后尝试获取详细信息并进行转移。如果用户退出，则在他登录之前不应允许他进一步请求。要配置这种类型的执行订单，需要 Demarcation。有两个属性：

```
IsInitiating (Default - True) 
IsTerminating (Default – False) 
```

这些属性决定了应该首先调用哪个操作，哪个应该最后调用？对于上述四种操作，以下可能是一种可能的顺序：

```
[OperationContract(IsInitiating = True)]
 Bool SignIn()

[OperationContract(IsInitiating = false)]
 String GetDetails()

[OperationContract(IsInitiating = false)]
 Bool TransferFund()

[OperationContract(IsInitiating = false, IsTerminating = True)]
 Bool SignOut() 
```

这里的启动和终止是指强制划分的会话，因为服务需要知道客户端是否遵循特定的顺序。这里操作 2,3 和 4 设置为`IsInitiating = false`因此不能先调用，但可以在调用 Isinitiating = True 操作后调用。类似地，操作 4 被注释为`IsTerminating = True`这就是为什么当它被调用时，它会终止会话（以及底层通道），然后客户端无法进行进一步的调用，直到创建新的代理并`IsInitiating = True`调用操作。要使用分界，需要进行以下配置：

会话支持绑定 SessionMode 设置为 Required 当 IsTerminating 操作被调用时，WCF 丢弃通道并且不再接受来自它的进一步消息。如果一个操作没有用这些属性中的任何一个显式修饰，那么这些属性的默认值将适用于它。

目前为止就这样了。

最后，简单回顾一下——WCF 会话有 3 件事要记住：

> 1.  会话绑定
> 2.  SessionMode 服务合同
> 3.  InstanceContextMode 服务行为

分界定义了执行顺序中的第一个和最后一个操作。

# asp.net - 在 asp.net 3.5 中构建一个类似于 stackoverflow 上的“标签编辑器”以添加/删除标签

> ID：679532
> 
> 赞同：1
> 
> 时间：2009-03-24T22:38:39.460
> 
> 标签：asp.net, ajax

对于客户项目，我需要能够从项目（本例中的图片）中添加/删除标签。

我真的很喜欢添加标签在 stackoverflow 中的工作方式。

[替代文字 http://sixfootfour.net/images/Tags.png](http://sixfootfour.net/images/Tags.png)

我知道如何制作自动建议文本框（因为在 asp.net 的 Ajax 控件工具包中有一个控件），但我不知道如何创建标签列表，以及如何添加/删除它没有回发。

我应该研究 JQuery 来解决这个问题，还是我的方法应该是什么？

我使用 Visual Studio 2008 和 ASP.NET 3.5。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-24T22:58:10.897

设置 Web 服务或页面方法以将标签添加到数据库，然后使用 asp.net ajax 调用它是一个简单的解决方案，然后将其与您的自动完成框结合起来。当用户单击 x 时，您可能需要另一种方法来删除要调用的标签。

至于实际的标签，我认为你可以通过为无序列表设计一个带有十字标签的标签来获得相同的外观，也可能是文本。然后，您可以成功使用 javascript 将标签添加到列表中。

[官方网站](http://www.asp.net/ajax/)有一些很好的教程。

# xml - EXI（高效 XML 交换）即将到来…… XML API 准备好了吗？

> ID：679533
> 
> 赞同：13
> 
> 时间：2009-03-24T22:38:54.047
> 
> 标签：xml, api, web-standards, exi

W3 的 EXI（高效 XML 交换）将被标准化。它声称是“最后一个二进制标准”。

它是一种存储 XML 数据的标准，针对处理和存储进行了优化，与 XML 模式捆绑在一起（使数据具有强类型和强结构化）。好吧，有很多声称的优势。处理和内存效率测量给我留下了最深刻的印象。

我在问自己，所有已建立的 XML API 会发生什么？

有一段与我的问题有关：

> 4.2 现有的 XML 处理 API
> 
> 由于 EXI 是 XML Infoset 的编码，EXI 实现可以支持任何用于 XML 处理的常用 XML API，因此 EXI 对现有 XML API 没有直接影响。但是，使用现有的 XML API 还需要将 EXI 文档中出现的所有名称和文本转换为字符串。将来，如果更高层可以直接使用这些数据作为出现在 EXI 文档中的类型值，则可以实现更高的效率。例如，如果更高层需要类型化数据，则通过其字符串形式会产生性能损失，因此直接支持类型化数据的扩展 API 可以在与 EXI 一起使用时提高性能。
> 
> 来自：[http ://www.w3.org/TR/exi-impacts/](http://www.w3.org/TR/exi-impacts/)

我将其理解为：*“将 EXI 与现有 API 一起使用？没有性能提升！（除非你全部重写）”*

我们以 Java 生态系统为例：

我们在最新的 JDK 6 中有大量的 XML API（随着每个主要的 JDK 版本，越来越多的它们被添加。）据我所知，它们中的大多数（如果不是全部）都使用内存中的 DOM 树，或序列化（“文本”）表示来转换/处理/验证/... XML 数据。

你们怎么看，随着 EXI 的引入，这些 API 会发生什么？

谢谢大家的意见。

对于那些不知道 EXI 的人：http: [//www.w3.org/XML/EXI/](http://www.w3.org/XML/EXI/)

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-12-14T21:48:00.793

您不需要任何新的 API 即可获得 EXI 的性能提升。W3C 进行的所有 EXI 测试和性能测量都使用内置在 JDK 中的标准 SAX API。有关最新测试，请参阅[http://www.w3.org/TR/exi-evaluation/#processing-results](http://www.w3.org/TR/exi-evaluation/#processing-results)。在这些没有任何特殊 API 的测试中，EXI 解析平均比 XML 快 14.5 倍。

有一天，如果人们认为它值得，我们可能会看到一些类型化的 XML API 出现。如果发生这种情况，您将从 EXI 获得更好的性能。但是，这并不是获得 W3C 报告的出色性能所必需的。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-07-17T08:07:30.913

让我们将 EXI 视为“更好的 XML GZIP”。仅供参考，它对 API 没有影响，因为您仍然可以使用所有 API（DOM、SAX、StAX、JAXB ...）。只有这样才能获得 EXI，您必须获得一个写入它的流写入器或读取它的流读取器。

执行 EXI 的最有效方法是 StAX。但确实有可能因为 EXI 而出现新的 API。但是谁说 DOM 是高效且为现代语言设计的 ;-)

如果您正在处理大型 XML 文件（其中一些文件只有数百 MB），那么您肯定知道为什么需要 EXI ：节省大量空间，节省大量内存和处理时间。

这与 HTTP Content-Encoding 的目的没有什么不同：您不需要使用它，只是如果双方都理解它，这是执行交换的一种非常有效的方式。

顺便说一句，由于 SOAP 膨胀，EXI 将成为通过 HTTP IMHO 对任何 XML 进行内容添加的首选方式 ;-) 一旦 EXI 安装在浏览器上，它也可以使任何最终用户受益：更快的传输、更快的分析 = 最佳体验永远为同一台机器！

EXI 不弃用字符串表示，只是让它有点不同。哦，顺便说一句，在执行 UTF 时（例如，考虑默认 UTF8），您已经对 32 位 unicode 代码点使用“压缩编码”......这意味着，在线数据与真实数据不同已经 ;-）

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2016-06-28T19:58:23.913

我现在正在处理EXI。

没有很好的通用工具来处理 EXI。一旦您深入了解 EXI，您就会意识到二进制流中有一堆不必要的分隔符，这些分隔符对于模式来说是绝对和完全不需要的。其中一些是幽默的。

如果指定了两个值，您认为以下内容将如何在 EXI 中编码？

```
<xs:complexType name="example">
  <xs:sequence>
    <xs:element name="bool1" type="xs:boolean" minOccurs="0" />
    <xs:element name="bool2" type="xs:boolean" minOccurs="0" />
  </xs:sequence>
</xs:complexType> 
```

您认为它可能最多为 4 位吗？1 位表示是否定义了 bool1，并且表示 bool1 的值，然后是另一个位表示是否定义了 bool2，那么 bool2 的值？

天哪，不！

好吧，让我告诉你男孩和女孩！这就是它的实际编码方式

```
+---- A value of 0 means this element (bool1) is not specified,
|       1 indicates it is specified
|+--- A value of x means this element is undefined,
||      0 means the bool is set to false, 1 is set to true
||+-- A value of 0 means this element (bool2) is not specified,
|||     1 indicates it is specified
|||+- A value of x means this element is undefined
||||    0 means the bool is set to false, 1 is set to true
||||
0x0x  4 0100           # neither bools are specified
0x10  8 00100000       # bool1 is not specified, bool2 is set to false
0x11  8 00101000       # bool1 is not specified, bool2 is set to true
100x  9 000000010      # bool1 is set to false, bool2 is not specified
110x  9 000010010      # bool1 is set to true, bool2 is not specified

1010 13 0000000000000  # bool1 is set to false, bool2 is set to false
1011 13 0000000001000  # bool1 is set to false, bool2 is set to true
1110 13 0000100000000  # bool1 is set to true, bool2 is set to false
1111 13 0000100001000  # bool1 is set to true, bool2 is set to true
        ^           ^
        +-encoding--+

Which can be represented with this tree

  0-0-0-0-0-0-0-0-0-0-0-0-0 (1010)
   \ \   \     \   \
    | |   |     |   1-0-0-0 (1011)
    | |   |     |
    | |   |     1-0 (100x)
    | |   |
    | |   1-0-0-0-0-0-0-0-0 (1110)
    | |        \   \
    | |         |   1-0-0-0 (1111)
    | |         |
    | |         1-0 (110x)
    | |
    | 1-0-0-0-0-0 (0x10) 
    |    \
    |     1-0-0-0 (0x11)
    |
    1-0-0 (0x0x) 
```

最少 4 位，MINIMUM 是为了不定义任何一个。现在我有点不公平，因为我包含了分隔符——完全没有必要的分隔符。

我现在明白这是如何工作的了。这是规格：

[https://www.w3.org/TR/exi/](https://www.w3.org/TR/exi/)

祝你阅读愉快！这对我来说很有趣！！！！@@##！@

现在这只是一个模式，EXI 规范特别指出您仍然可以对不符合模式的 XML 进行编码。这很有趣，因为这应该适用于小型 Web 设备。您如何处理无法在嵌入式设备中处理的意外数据？

为什么，你当然会死。对于您不期望的事情，无法恢复。这些东西不是有屏幕的，能通过串口登录就已经很幸运了。

我使用了 4 个不同的 XSD 生成器/解析器/XML 生成器。其中 3 个被我必须使用的 Schema 卡住了。C 和 C++ 的数据封送处理（请记住，这是针对内存和 CPU 资源很少的嵌入式系统）非常糟糕。

XSD 基本上描述了一种结构或类体系结构，我找不到一个工具可以只创建类。我上面给出的 XSD 示例应该创建一个具有 4 个布尔值的结构，2 个布尔值是值，2 个布尔值表示它们是否已定义。

但那存在吗？好吧，不。

我喜欢 XML，用于描述文档。我真的这样做了——但这就是我讨厌 XML 的地方——对于一个被广泛采用的标准，可用的工具绝对是糟糕的。当架构分布在多个命名空间和文档中时，仅读取架构是一件困难的事情。

*吐槽吐槽*

我们使用它的唯一原因是某些标准委员会坚持使用它。它所做的是为一小部分已经实施这一点的公司创造了垄断地位，这是唯一的目的。

EXI 不是一个被广泛采用的标准，XML 是一个糟糕的数字数据封装器，实现它很痛苦，而且没有合适的工具。EXIP 的版本是 5.0 - 任何开源的东西都是 Java 的 - 至少我有。

对于我的工作领域，EXI 只是一个糟糕的设计决策。我在各种嵌入式系统上研究了大量的通信协议。我在 DOCSIS 工作，所有现代有线调制解调器都使用它——它们使用简单且可扩展的类型/长度/值协议，并提供处理无法识别的类型的规定——这就是为什么总是包含长度的原因。这很简单，实现整个堆栈实际上需要几天时间。

EXI 很难编写代码，没有像样的处理器，最糟糕的是，我发现的所有处理器都可以很好地使用它，只需从 EXI<->XML 转换它——这完全没用。

我已经求助于编写自己的 XSD 解析器，这意味着我必须至少了解该设计中使用它的那些部分的整个 XML 规范——而且范围很广。任何合理的规格都需要我 2 周的时间，我花了 10 年。我的世界上没有人会使用它，除非它被塞进他们的喉咙而且他们不应该，它是一个圆孔的方形钉。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-25T00:01:57.857

我个人宁愿根本不使用 EXI。似乎它把所有关于 XML 的笨拙、坏的东西都塞进了二进制格式，这基本上消除了 XML（纯文本格式）的优势。

似乎行业的总体趋势是转向更轻量级的数据传输模型（例如 HTTP REST），并远离像 SOAP 这样的重量级模型。就个人而言，我对二进制 XML 的想法并不十分兴奋。

任何声称是“最后一个二进制标准”的东西都可能是错误的。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2012-10-05T11:02:01.660

EXI 的问题在于它需要从您的应用程序代码中抽象出来。我在一个中间件产品上工作，其中 XML 的人类可读性在某些方面（日志记录、故障查找等）是关键，但在其他方面可以牺牲（内部应用程序之间的通信以限制 I/O 负载）。

我们目前使用 SOAP 在或拥有客户端、中间件和供应商 Web 应用程序之间进行通信。我想用 EXI 替换它，同时在其他领域保留人类可读的 XML。为了用 EXI 替换 SOAP 通信，我需要：

1.  等到 EXI 被合并到现有的 SOAP 堆栈（Axis/SAAJ）中，或者
2.  在 EXI 之上用我自己的 SOAP-ish 协议替换我现有的 Axis/SAAJ SOAP 客户端/供应商实现

JSON 和 EXI 之间的比较是公平的，但两者的用例不同。JSON 的元数据没有标准，而 XML 有 XML-Schema。对于 XML，有几个标准机构定义了特定行业的数据交换模式。还有一系列建立在 XML 之上的协议/标准，例如 SOAP、XML-Signature、XML-Encryption、WS-Security、SAML 等。这对于 JSON 是不存在的。

因此，对于 B2B 消息交换和其他需要使用行业标准与外部系统集成的情况，XML 是一个更好的选择。EXI 可以为这个世界带来 JSON 的一些好处，但需要将其合并到现有的 XML API 中，然后才能被广泛采用。

# visual-studio - 购买和使用 resharper 的商业利益是什么？

> ID：679536
> 
> 赞同：3
> 
> 时间：2009-03-24T22:40:06.603
> 
> 标签：visual-studio, resharper

我和一位同事有兴趣将 resharper 集成到我们的开发环境中，以获得明显的技术优势（折射等），但我们需要向管理层证明它将如何帮助企业赚钱，以便他们可以为我们购买它.

清单顶部有哪些理由可以证明此次购买的合理性？是否有一篇博客文章或一些类似的文章可以指向我以创建更好的论点？

**编辑**

我们可以让管理层购买 ReSharper 的最佳“弹药”是让我们能够量化（以美元为单位）公司将从使用该工具中看到的节省。

**编辑**

我最终为自己购买了个人许可证。我一点也不后悔，如果他们不能让他们的公司为他们购买它，我会建议任何人这样做。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-24T23:13:55.630

因为开发人员很昂贵，而硬件和工具却不是。如果您购买 resharper 并每天节省一个小时的开发时间（每小时 25 美元），您将在不到两周的时间内收回您的损失。

没有大量的培训时间，因为 Resharper 写得很好，学习如何使用每个功能所需的时间比开发人员尝试做的任何事情要少。一次。

如果不出意外，只需在所述经理观看的情况下执行以下操作：

```
Navigate to a function DoStuff in unopened (large) class SuperDuperUtility by hand/mouse.
Close window.
(With resharper installed:) CTRL+T SDU <ENTER> ALT+\ DS <ENTER> 
```

你的经理可能会说：为什么工作室不这样做呢？

如果他们仍然不听，请购买个人许可证，当您的工作效率提高时，要求加薪。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-24T22:43:15.487

开发人员生产力的显着提高。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-24T23:04:59.210

通过 Resharper 的建议和警告提高代码质量和一致性。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-24T23:30:07.933

我们在我们的开发团队中推出了 ReSharper，在一些传道者不断地谈论它之后，我认为它节省了 10 到 15 分钟的开发时间/人/天——这很快就会增加，有 20 名 C# 开发人员。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-24T22:43:49.667

它有一个 30 天的演示，所以试试看。

我从未尝试过 ReShapper，但我强烈推荐他们的竞争对手[Refactor 和 CodeRush](http://www.devexpress.com/)。只要确保您观看他们的视频，以便您知道如何正确使用它们。

# c# - 从套接字读取直到客户端在 C# 中发送 EOL

> ID：679546
> 
> 赞同：0
> 
> 时间：2009-03-24T22:44:21.007
> 
> 标签：c#, sockets

我有一个看起来像这样的基本套接字服务器：

```
 IPEndPoint localEndPoint = new IPEndPoint(IPAddress.Any, 8000);
    Socket newsock = new Socket(AddressFamily.InterNetwork, SocketType.Stream, ProtocolType.Tcp);
    try
    {
        newsock.Bind(localEndPoint);
    }
    catch (Exception e)
    {
        //Errors handled
    }
    newsock.Listen(10);
    Console.WriteLine("Bound to port 8000");
    Socket client = newsock.Accept();
    while (client.Connected)
    {
        Console.WriteLine("Connection recieved.");
        string outputString = null;
        byte[] buffer = new byte[4];
        client.Receive(buffer);
        string bit = null;
        while (bit != "\r\n" || bit != "\n" || bit != "\r")
        {
            bit = Encoding.ASCII.GetString(buffer);
            outputString += bit;
        }
        Console.WriteLine(outputString);
    } 
```

现在我希望它接受输入，直到用户（当前是 telnet）发送 EOL（按回车键）上面的代码大部分是我迄今为止尝试过的，我应该怎么做？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-24T22:55:00.030

好吧，TCP 在流中工作，因此为了检测任何内容，您将不得不预测 \r\n 不是缓冲区中唯一内容的情况。

代替

```
bit != "\r\n" || bit != "\n" || bit != "\r" 
```

和

```
!bit.Contains("\r") && !bit.Contains("\n") 
```

不要忘记用来自 TCPStream 的数据重新填充“位”......意思是

```
while (bit != "\r\n" || bit != "\n" || bit != "\r")
{
    bit = Encoding.ASCII.GetString(buffer);
    outputString += bit;
} 
```

你需要

```
client.Receive(buffer); 
```

所以它看起来像：

```
while (bit != "\r\n" || bit != "\n" || bit != "\r")
{
    bit = Encoding.ASCII.GetString(buffer);
    outputString += bit;
    client.Receive(buffer);
} 
```

而且...异常处理程序会在客户端断开连接时通知您。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-24T22:53:04.793

发送 EOL 字符时，您可能会收到多个字符尝试：

```
while (bit != null && !bit.EndsWith("\r") && !bit.EndsWith("\n") ) 
```

# asp.net - 在不使用表单身份验证的 asp.net 应用程序中保护 ELMAH

> ID：679548
> 
> 赞同：3
> 
> 时间：2009-03-24T22:45:01.253
> 
> 标签：asp.net, logging, elmah

我有一个非常基本的 asp.net 应用程序，它依赖于母版页的 INIT 事件来通过会话对象验证用户。是的，我知道这是次优的。

我想向其中添加 ELMAH，但在不使用表单身份验证和 web.config 允许/拒绝设置的情况下找不到任何保护控制台的参考。

是否有另一种方法来保护不依赖于表单身份验证的 elmah.axd 文件？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2010-03-19T18:23:47.507

本文介绍如何将 Elmah 错误处理程序包装在另一个允许访问会话状态的事件处理程序中：

[http://groups.google.com/group/elmah/msg/a0aa776d348ba97e](http://groups.google.com/group/elmah/msg/a0aa776d348ba97e)

在 Global.asax 中，您可以拥有如下内容：

```
protected void Application_PreRequestHandlerExecute(Object sender, EventArgs e)
{
    // Get the filename being requested
    string filename = Path.GetFileName(Request.Path).ToLower();

    // Verify that a user is logged in by checking the session
    bool isValid = (HttpContext.Current.Session["User"] != null);

    // Throw error if invalid
    if (filename == "elmah.axd" && !isValid)
        throw new SecurityException("Access to elmah.axd is denied");
} 
```

标准 Elmah 处理程序没有实现 IRequiresSessionState 或 IReadOnlySessionState，因此您必须创建另一个事件处理程序来包装它，如上面提到的链接中所述。否则，您将无法访问 Application_PreRequestHandlerExecute 事件中的会话。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-03-19T18:33:10.633

我是 ELMAH 的 MySQL 支持开发人员之一。允许/拒绝选项不是特定于 Web 表单的。他们可以与任何提供商合作。

1.  要实现自定义的，您需要使用[IPrincipal](http://msdn.microsoft.com/en-us/library/system.security.principal.iprincipal.aspx)接口。
2.  来自允许/拒绝角色的角色是从IPrincipal的这个[IsInRole方法中提取的。](http://msdn.microsoft.com/en-us/library/system.security.principal.iprincipal.isinrole.aspx)
3.  在 global.asax 或您自己的 IHttpHandler 中的 Request_Authentication 上，您需要创建 IPrincipal 对象并将其设置为 Context.User 对象。像这样的东西：

    ```
    private void Request_Authenticate (object sender, EventArgs e) {
        // do checks and create IPrincipal object
        IPrincipal user = new MyPrincipal(...);
        Context.User = user;
    } 
    ```

4.  然后，当为您的 elmah.axd 处理程序检查角色时，它将针对此自定义对象而不是 Web 表单。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-06T08:16:33.653

开箱即用，远程访问被禁用，因此您只能从本地计算机访问错误日志。这里还有更多： [http ://code.google.com/p/elmah/wiki/SecuringErrorLogPages](http://code.google.com/p/elmah/wiki/SecuringErrorLogPages)

# asp.net - 在 asp.net 开发服务器上调试 httpmodule

> ID：679559
> 
> 赞同：13
> 
> 时间：2009-03-24T22:50:27.437
> 
> 标签：asp.net, httpmodule

我想在我的 asp.net 应用程序（v 3.5，visual studio 2008）中集成一些 http 模块，但我不确定在运行 web 时触发的 asp.net 开发服务器中调试时如何调试或使用这些模块应用程序。

我需要在解决方案中包含模块源还是可以将 DLL 放入 BIN 中？我来自 1.1 世界，还不习惯 asp.net 开发服务器。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-03-24T22:54:30.873

按照以下步骤添加 HTTP 模块：

1.  创建一个名为 .NET 的新 Visual Studio .NET C# 类库项目`MyModule`。
2.  设置对程序集的引用`System.Web.dll`。
3.  将以下指令添加到类中：

    ```
    using System.Web; 
    ```

4.  重命名类`SyncModule.cs`，然后更改类定义以反映这一点。

5.  实现`IHttpModule`接口。您的类定义应如下所示：

    ```
    public class SyncModule : IHttpModule 
    ```

6.  决定您将订阅哪些事件。以下列表概述了`HttpApplication`您可以订阅的对象的可用事件：

    *   `AcquireRequestState`: 调用此事件，允许模块获取或创建请求的状态（例如，会话）。
    *   `AuthenticateRequest`：当安全模块需要在处理请求之前对用户进行身份验证时调用此事件。
    *   `AuthorizeRequest`: 当请求需要被授权时，由安全模块调用此事件。认证后调用。
    *   `BeginRequest`：调用此事件以通知模块新请求正在开始。
    *   `Disposed`：调用此事件以通知模块应用程序由于某种原因而结束。允许模块执行内部清理。
    *   `EndRequest`：调用此事件通知模块请求正在结束。
    *   `Error`：调用该事件通知模块在请求处理过程中发生的错误。
    *   `PostRequestHandlerExecute`：调用此事件通知模块处理程序已完成对请求的处理。
    *   `PreRequestHandlerExecute`：调用此事件通知模块该请求的处理程序即将被调用。
    *   `PreSendRequestContent`：调用该事件通知模块内容即将发送给客户端。
    *   `PreSendRequestHeaders`: 调用该事件通知模块HTTP头即将发送给客户端。
    *   `ReleaseRequestState`：调用此事件以允许模块释放状态，因为处理程序已完成处理请求。
    *   `ResolveRequestCache`: 认证后调用此事件。缓存模块使用此事件来确定请求是否应由其缓存处理，或者处理程序是否应处理该请求。
    *   `UpdateRequestCache`：在处理程序响应后调用此事件。缓存模块应该使用响应更新它们的缓存。
7.  实现IHttpModule接口的Init和Dispose方法如下：

    ```
    public void Init(HttpApplication app)
    {
       app.BeginRequest += new EventHandler(OnBeginRequest);
    }
    public void Dispose(){ } 
    ```

8.  为事件创建委托，如下所示：

    ```
    public delegate void MyEventHandler(Object s, EventArgs e); 
    ```

9.  定义一个类型的私有局部变量`MyEventHandler`来保存对事件的引用：

    ```
    private MyEventHandler _eventHandler = null; 
    ```

10.  创建一个事件，将委托连接到 Global.asax 文件或从`HttpApplication`对象继承的类中的方法：

    ```
    public event MyEventHandler MyEvent
    {
       add { _eventHandler += value; }
       remove { _eventHandler -= value; }
    } 
    ```

11.  创建方法，该方法与以下事件`OnBeginRequest`挂钩：`BeginRequest``HttpApplication`

    ```
    public void OnBeginRequest(Object s, EventArgs e)
    {
       HttpApplication app = s as HttpApplication;
       app.Context.Response.Write("Hello from OnBeginRequest in custom module.<br>");
       if(_eventHandler!=null)
          _eventHandler(this, null);
    } 
    ```

12.  编译项目

来源： http: [//support.microsoft.com/kb/307996](http://support.microsoft.com/kb/307996)

向您添加一个 HTTP 模块`web.config`将如下所示：

```
<system.web>
    <httpModules>
       <add name="CustomHttpModule" type="MyCustomHttpModule"/>
    </httpModules>
</system.web> 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2010-04-06T13:29:23.017

在 HttpModule 中没有命中断点的两个常见原因是：

### 断点位于模块构建期间调用的代码中。

这个总是得到我。如果要调试模块的构造***，则应手动附加调试器***。在 Windows 7 上执行此操作（在 Vista 上类似）：

1.  *调试 | 附加到进程...*
2.  选中*Show processes in all sessions*。
3.  选择您的工作进程实例（*w3wp.exe*）
4.  单击*附加*。

刷新你的浏览器，你现在应该点击你的断点。

### 由于配置问题，该模块实际上并未加载。

如果您可以判断模块代码*肯定*正在执行，那么这不是问题。但有时，当一个模块在其他机器上正常加载时，它可能无法在您的开发盒上加载，因为您有不同版本的 IIS 并且您没有必要的配置。

如果是这种情况，请确保为所有需要的 IIS 版本正确连接了模块。

对于 IIS 5.1 和 IIS 6...

```
<system.web>
  <httpModules>
    <add name="CustomHttpModule" type="MyCustomHttpModule"/>
  </httpModules>
</system.web> 
```

...对于 IIS 7+

```
<system.webServer>
  <modules runAllManagedModulesForAllRequests="true">
    <add name="CustomHttpModule" type="MyCustomHttpModule"/>
  </modules>
</system.webServer> 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2011-01-10T03:06:52.153

请注意，这似乎不是开箱即用的。确保不仅包括新模块的类名，而是明确定义其命名空间和（为了完整性）程序集。如果你不这样做，很有可能你最终会遇到 IIS 抱怨无法加载你刚刚编写的新 HTTP 模块。

下面是一个例子。

代替：

```
<add name="CustomHttpModule" type="MyCustomHttpModule"/> 
```

利用：

```
<add name="CustomHttpModule" type="MyCustomRootNamespace.MyCustomHttpModule, MyCustomAssembly"/> 
```

如果不这样做，您的项目可能无法加载。

您可能收到的具体错误取决于您对模块的明确定义。如果省略命名空间，您将看到：

```
Could not load type 'MyCustomHttpModule'. 
```

省略命名空间并包含程序集，您将看到：

```
Could not load type 'MyCustomHttpModule' from assembly 'MyCustomAssembly'. 
```

如果您看到另一条错误消息，那么您遇到的问题与此处讨论的问题不同。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2015-03-12T11:15:03.437

你可以写一行

System.Diagnostics.Debugger.Break(); //显式调用Break进行调试

在 HttpModule 构造期间显式调用断点。

它将要求附加进程（例如 w3wp.exe），然后调试点将命中。

谢谢

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-24T23:06:53.247

您可能还想确保您使用的是 Web 应用程序项目，这是您在 VS2003 中使用的，而不是网站“项目”，它们不是项目。

# directory - ls 无法获取目录大小

> ID：679567
> 
> 赞同：4
> 
> 时间：2009-03-24T22:53:06.400
> 
> 标签：directory, ls

我运行命令未成功获取目录的大小（里面的文件属于目录的大小）

```
ls -lSrh 
```

我只得到目录大小的千位，而它们的内容不止于此。

**您如何以*ls*的数字列出目录的大小，包括其内容？**

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-03-24T22:55:18.157

```
du -sh directory_name 
```

`ls`将为您提供目录*条目*的大小，而不是目录内容的大小。根据我的快速浏览，`man ls`似乎没有一种方法可以`ls`深入并计算目录的大小（很可能是因为这将是一项昂贵的操作）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-27T13:31:24.573

如果要获取目录大小，可以使用

```
du -sh 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-10-04T07:40:30.223

`du -hs`在你有一个大目录之前很好。

例如，如果您存储缓存文件（例如 Rails 的文件系统缓存存储）或上传的文件，……使用分区模式，例如“cache/123/456/789/real_files”，并且您有很多，`du`正在使用永远，最终阻塞所有 IO。

我没有更好的解决方案，但是在高峰时间在生产服务器上运行它之前要考虑这一点。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-10-31T20:49:28.063

基于 Sean Bright 的回答，您可以执行以下操作（在 BASH 中）

```
for each in $(echo */ | sed "s/ /\n/g" | sed "s/\///g");  do du -hs "$each"; done; 
```

这将获得当前目录中所有目录的完整目录内容。

# javascript - 自动选择 - 在浏览器中呈现的文本

> ID：679570
> 
> 赞同：0
> 
> 时间：2009-03-24T22:53:45.947
> 
> 标签：javascript, html, text, selection

谁会知道在浏览器中呈现时自动选择 Paragaph 文本的可能性，最好是使用 JavaScript？

在我的情况下，我在`<p></p>`标签中有大量文本，并希望页面显示为完全选中的文本，就像有人用鼠标手动完成一样。

非常感谢您的建议！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-25T00:28:53.657

根据这篇[文章](http://www.quirksmode.org/dom/range_intro.html)， IE6/7 不支持[W3C 范围](http://www.w3.org/TR/2000/REC-DOM-Level-2-Traversal-Range-20001113/ranges.html)（ChristopheD 的代码），因此您必须进行浏览器检查并为 IE6/7 使用[createTextRange](http://msdn.microsoft.com/en-us/library/ms535872.aspx)。

作为一个小补充，也许您可​​以定义一个函数来封装 ChristopheD 编写的代码并执行类似的操作`<body onload="selectPs()">`，或者`$(document).ready(function() {});`如果您使用 jQuery。可能比将脚本放在 html 代码末尾更有效。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-24T23:34:26.860

在页面末尾附近插入：

```
<script type='text/javascript'>

ptags = window.document.getElementsByTagName("p");
current_selection = window.getSelection();

for (i=0; i< ptags.length; i++)
{
    var r1 = document.createRange();
    r1.setStartBefore(ptags[i]);
    r1.setEndAfter(ptags[i]) ;
    current_selection.addRange(r1);
}

</script> 
```

在 Firefox 3.07 中测试 --> 不太确定跨浏览器兼容性，虽然我认为 IE 应该没问题。

# c++ - 在 C++ 中何时使用“新”，何时不使用？

> ID：679571
> 
> 赞同：123
> 
> 时间：2009-03-24T22:53:50.673
> 
> 标签：c++, new-operator

> **可能重复：**
> [我什么时候应该在 C++ 中使用 new 关键字？](https://stackoverflow.com/questions/655065/when-should-i-use-the-new-keyword-in-c)

什么时候应该在 C++ 中使用“new”运算符？我来自 C#/Java 背景，实例化对象让我感到困惑。

如果我创建了一个名为“Point”的简单类，那么当我创建一个点时，我应该：

```
Point p1 = Point(0,0); 
```

或者

```
Point* p1 = new Point(0, 0); 
```

有人可以为我澄清什么时候使用 new 运算符，什么时候不使用？

**副本：**

[什么时候应该在 C++ 中使用 new 关键字？](https://stackoverflow.com/questions/655065/when-should-i-use-the-new-keyword-in-c)

**有关的：**

[关于 C++ 中自定义对象的构造函数/析构函数和 new/delete 运算符](https://stackoverflow.com/questions/392455/about-constructors-destructors-and-new-delete-operators-in-c-for-custom-objects)

[在 C++ 中正确使用堆栈和堆？](https://stackoverflow.com/questions/599308/proper-stack-and-heap-usage-in-c)

* * *

## 回答 #1

> 赞同：168
> 
> 时间：2009-03-24T22:56:35.657

`new`当你希望一个对象在你之前一直存在时，你应该使用`delete`它。如果你不使用`new`，那么当它超出范围时，对象将被销毁。这方面的一些例子是：

```
void foo()
{
  Point p = Point(0,0);
} // p is now destroyed.

for (...)
{
  Point p = Point(0,0);
} // p is destroyed after each loop 
```

有人会说，使用`new`决定了你的对象是在堆上还是在栈上，但这仅适用于在函数中声明的变量。

在下面的示例中，“p”的位置将是其包含对象 Foo 的分配位置。我更喜欢称之为“就地”分配。

```
class Foo
{

  Point p;
}; // p will be automatically destroyed when foo is. 
```

使用 分配（和释放）对象`new`比就地分配对象要昂贵得多，因此应将其使用限制在必要的地方。

何时分配 via 的第二个示例`new`是用于数组。您不能*在运行时更改就地或堆栈数组的大小，因此您需要一个未确定大小的数组，它必须通过 new 分配。

例如

```
void foo(int size)
{
   Point* pointArray = new Point[size];
   ...
   delete [] pointArray;
} 
```

（*先发制人的挑剔 - 是的，有一些扩展允许可变大小的堆栈分配）。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-03-24T22:57:27.730

看看[这个问题](https://stackoverflow.com/questions/408670/stack-static-and-heap-in-c)和[这个问题](https://stackoverflow.com/questions/79923/what-and-where-are-the-stack-and-heap)，以获得关于 C++ 对象实例化的一些好的答案。

这个基本思想是在堆上实例化的对象（使用new）需要手动清理，在堆栈上实例化的对象（没有new）在超出范围时会自动清理。

```
void SomeFunc()
{
    Point p1 = Point(0,0);
} // p1 is automatically freed

void SomeFunc2()
{
    Point *p1 = new Point(0,0);
    delete p1; // p1 is leaked unless it gets deleted
} 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-24T22:58:25.060

当您希望在堆而不是堆栈上创建对象时，您应该使用 new。这允许通过指针的帮助从当前函数或过程之外访问对象。

在 C++ 中查找指针和内存管理可能对您有用，因为这些是您不太可能在其他语言中遇到的事情。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-24T22:58:06.730

新总是用于分配动态内存，然后必须释放。

通过执行第一个选项，当范围丢失时，该内存将自动释放。

```
Point p1 = Point(0,0); //This is if you want to be safe and don't want to keep the memory outside this function.

Point* p2 = new Point(0, 0); //This must be freed manually. with...
delete p2; 
```

# silverlight - 根据 Silverlight 中的绑定属性隐藏列表框项中的内容

> ID：679575
> 
> 赞同：2
> 
> 时间：2009-03-24T22:54:46.567
> 
> 标签：silverlight, listbox, visibility

我有看起来像这样的 xaml

```
<ListBox>
<ListBox.ItemTemplate>
    <DataTemplate>
        <StackPanel>
            <TextBlock Text="{Binding Name}" />
            <StackPanel Orientation="Vertical" x:Name="contentPanel" >
            Content goes here...
            </StackPanel>
        </StackPanel>
    </DataTemplate>
</ListBox.ItemTemplate> 
```

列表框绑定到一个具有名为 ShowContent 的 bool 属性的对象。如果 ShowContent 的对象为 false，我如何让 silverlight 隐藏 contentPanel？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-24T23:14:59.980

编写一个 BoolToVisibility IValueConveter 并使用它绑定到 contentPanel 的 Visibility 属性

```
<StackPanel Visibility="{Binding YourBoolProperty, Converter={StaticResource boolToVisibilityResourceRef ..../> 
```

您可以在任何地方轻松找到 BoolToVisibility。

如果您是新手，请检查 IValueConveter。[http://msdn.microsoft.com/en-us/library/system.windows.data.ivalueconverter.aspx](http://msdn.microsoft.com/en-us/library/system.windows.data.ivalueconverter.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2013-01-08T05:39:39.320

我建议在 ListBoxItem 级别设置 ListBoxItem 可见性，否则由于默认填充和边框值，您最终会得到很小的空列表框项目，例如

```
<ListBox>
     <ListBox.Resources>
          <Style TargetType="ListBoxItem">
               <Setter Property="Visibility" Value="{Binding MyItem.IsVisible, Converter={StaticResource BooleanToVisibilityConverter}}" />
          </Style>
     </ListBox.Resources>
     <ListBox.ItemTemplate>
          <DataTemplate>
               <StackPanel Orientation="Vertical">
                    <CheckBox Content="{Binding MyItemName}" IsChecked="{Binding IsVisible, Mode=TwoWay}"/>
               </StackPanel>
          </DataTemplate>
     </ListBox.ItemTemplate>
</ListBox> 
```

这隐藏了整个 ListBoxItem 而不仅仅是它的内容。

# linux - Linux 上的 Emacs/xterm 颜色烦恼

> ID：679579
> 
> 赞同：9
> 
> 时间：2009-03-24T22:55:39.387
> 
> 标签：linux, emacs, terminal, colors, xterm

我在本地 Linux 机器和远程集群的登录节点上的控制台窗口中使用 emacs。我经常使用 emacs，并且在我的 .emacs 文件中将前景色设置为白色，如下所示：

```
(set-foreground-color "white")
(set-background-color "black") 
```

但是，当我运行 emacs 时，前景不是白色的；它是灰色的，很难阅读。在我的 Mac 上，具有相同设置的控制台窗口中的 emacs 显示为正确的白色。但是在两个 linux 机器上，在 konsole 和 xterm 中，它都是灰色的。

以防万一，我`TERM`设置为 xterm-color，桌面运行 RHEL 5，集群节点运行 RHEL 4 (CentOS)。

这是 Linux 如何设置终端颜色的默认设置吗？怎样才能变白变白？

**注意：**这是控制台 emacs，而不是 X 下的 emacs。`emacs -nw`如果你已经`DISPLAY`设置了。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-03-25T00:28:47.840

我的 Emacs 上的颜色`brightwhite`看起来不错（在终端下运行，而不是 X）。在 RHEL5 上，我将`TERM`环境变量设置为`xterm-256color`. 如果它工作正常，您应该能够运行[这些脚本](http://www.frexx.de/xterm-256-notes/)并看到 256 色输出。在 Emacs 下，您应该会看到相当平滑的颜色渐变（没有明显重复的颜色）`M-x list-colors-display`。如果没有，您可能缺少正确的 termcap 条目（`libtermcap-devel`我认为尝试安装该软件包）。

如果我更改`TERM`为`xterm-color`，那么`brightwhite`在 的输出中会出现一点灰色`list-colors-display`。

我不确定RHEL4。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-24T23:39:46.473

关于什么：

```
(set-foreground-color "brightwhite") 
```

回应评论：

在 emacs 中，运行`M-x list-colors-display`它应该向您显示 emacs 认为您的终端可用的所有颜色。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-25T00:17:09.693

我做了一些实验，你可以在 emacs 中设置控制台颜色，但你仅限于这个调色板：

```
black                    blue                                         
cyan                     green                                        
magenta                  red                                          
white                    yellow 
```

你得到的白色有点变灰；全亮白色保留给粗体文本。所以如果你跑

```
M-x facemenu-set-bold 
```

您将获得粗体（亮白色）文本以供以后插入。

我没有运气试图将默认面强制为粗体。（我真的不明白面孔在emacs中是如何工作的。）

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-25T00:27:58.900

如果您只是在控制台版本中使用反向视频就足够了？

```
$ emacs -nw -rv 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-24T23:04:38.197

看起来你只是在设置前景色。

```
(set-foreground-color "white")
(set-foreground-color "black") 
```

我确定你的意思`set-background-color`是后者。

我可以在运行 Emacs 时确认这一点：

```
$ emacs -nw -bg black -fg white 
```

也。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2013-09-05T16:28:58.567

我还发现我在终端模式下有奇怪的颜色，最后追溯到字体自定义。我有这样的事情：

```
(custom-set-faces
 ;; custom-set-faces was added by Custom.
 ;; If you edit it by hand, you could mess it up, so be careful.
 ;; Your init file should contain only one such instance.
 ;; If there is more than one, they won't work right.
 '(default ((t (:inherit nil :stipple nil :background "#000a00" :foreground "#ffffed" :inverse-video nil :box nil :strike-through nil :overline nil :underline nil :slant normal :weight normal :height 113 :width normal :foundry "unknown" :family "Droid Sans Mono"))))) 
```

我删除了前景和背景属性，一切都开始看起来很笨拙。

# eclipse - 我可以从 Eclipse 切换 SVN 存储库吗？

> ID：679585
> 
> 赞同：77
> 
> 时间：2009-03-24T22:57:27.170
> 
> 标签：eclipse, svn

我正在将我的 Subversion 存储库从一台机器移动到另一台机器。我在各种机器上都有一些零散的工作副本，我发现我可以使用以下命令轻松地将工作副本从旧服务器切换到新服务器：

```
svn --relocate svn://oldServer/repo svn://newServer/repo 
```

但是，在我的一台机器上，我使用带有 Subclipse 的 Eclipse，并且我不喜欢在我的 Eclipse 项目中使用命令行 SVN。我的问题是是否可以使用 Subclipse 或 Subversive 从 Eclipse 中切换 SVN 存储库。

* * *

## 回答 #1

> 赞同：100
> 
> 时间：2009-03-24T23:58:31.077

我认为您需要进入您的“存储库浏览器”透视图，在那里您右键单击当前存储库并将其“重新定位”到另一个域。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2011-09-01T12:12:58.860

不要使用“团队/切换”选项，而是更改为“SVN 存储库探索”透视图并在存储库的位置属性中更改 URL 位置。就像 Indigo 的魅力一样——在我的例子中使用 Subversive。

使用 Subversive 时，这将显示警告*“附加项目将被重新定位，因为存储库根 URL 与先前输入的不同”*，这正是您想要的。在执行此操作之前，请务必打开您要重新定位的所有项目。

![](https://i.stack.imgur.com/LFFBk.png)

当出现*“无法重新定位连接的项目”*和*“无法执行重新定位，因为新 URL 引用了不同的存储库”时*，那么您的存储库根目录可能没有 trunk/tags/branches 文件夹，或者子文件夹中也有此类文件夹。然后在“高级”选项卡上，禁用“启用结构检测”选项可能会有所帮助。

如果您收到*“无法执行重定位，因为新 URL 引用了无效的存储库（指定的 URL 或凭据不正确）”*，那么还要确保新存储库 URL 中的根路径与旧 URL 的根路径匹配。（换句话说：确保`/new/path`上面的屏幕截图中的子文件夹与旧 URL 相同。）

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2012-05-24T15:40:12.873

只需右键单击项目-> 团队-> 断开连接。

然后再次右键单击项目 -> 团队 -> 共享 -> 到您的新 SVN。

就是这样！

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2011-05-18T14:24:53.967

在 Eclipse Navigator 中，如果您右键单击项目名称，将出现一个子菜单。在该子菜单上选择 Team，它将提供一些额外的菜单选项。选择“切换到另一个分支/标签/修订...”，将出现一个窗口，允许您指定新分支或在您的情况下指定新存储库位置。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2012-07-26T20:54:40.457

您可以执行以下操作：

转到项目资源管理器视图 -> 右键单击​​您的项目 -> 团队 -> 切换 ... 现在选择新 URL。

就这样！

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-10-08T09:03:48.793

我无法从日食中重新定位。我在同一个存储库的不同分支和标签上有不同的项目（只读，仅用于比较不同的版本）。当我们的 svn 服务器的 ip 改变时，我可以通过 TortoiseSVN 但不能从 Subclipse 重新定位。

从更改`http://oldserver/svn/PROJECTNAME`为`http://newserver/svn/PROJECTNAME`我得到：

```
org.apache.subversion.javahl.CientException: Invalid operation on the current working directory
svn: Cannot relocate 'E:\…\workspaces\PROJECTNAME\tags\modulename\2.4.007\base' as it is not the root of a working copy; try relocating 'E:\…\workspaces\PROJECTNAME\tags\modulename\2.4.007' instead 
```

好的，但我无法控制这个。我以涉及我的主机文件的解决方法结束。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2017-06-19T10:46:26.860

在 Eclipse 中，转到 Window -> Perspective -> Open Perspective -> Other -> SVN Repository Exploring。点击确定

然后右键单击要更改的存储库-> 位置属性。

更改网址点击完成。

就是这样！

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2012-05-22T11:10:19.533

您可以只交换 DNS 中的服务器名称；这可能比切换所有工作副本更容易。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2018-07-23T01:02:00.640

团队 -> 断开连接

和

团队 -> 分享 -> 到您的新 SVN

这是比 switch 更好的解决方案。

# c# - 如何从 MapXtreme 样式制作位图

> ID：679588
> 
> 赞同：2
> 
> 时间：2009-03-24T22:58:00.163
> 
> 标签：c#, mapping, gis, mapxtreme

我已经在 MapXtreme 论坛上发布了这个问题，但由于没有人在那里回答问题，我希望这里有人对这个产品有一些经验（mapxtreme 是由制作 MapInfo 的人制作的 GIS SDK）

我正在开发 MapXtreme 桌面应用程序，我们需要我们的特征样式的位图

我尝试了两种方法，但我得到的只是一个带有深色 X 的灰色位图。

这是我在代码中使用的两种方式的代码，但其中一种被注释掉了：

```
 public static Bitmap GetStyleBitmap(Style style)
    {
        var bm = new Bitmap(16, 16, System.Drawing.Imaging.PixelFormat.Format32bppArgb);
        var rect = new System.Drawing.Rectangle(0, 0, 16, 16);
        var ss = new StyleSample();
        ss.Bounds = rect;
        if (style is CompositeStyle)
        {
            ss.ApplyAreaStyle(((CompositeStyle)style).AreaStyle);
            ss.ApplyLineStyle(((CompositeStyle)style).LineStyle);
        }
        if (style is AreaStyle)
        {
            ss.ApplyAreaStyle((AreaStyle)style);
        }
        if (style is SimpleLineStyle)
        {
            ss.ApplyLineStyle((SimpleLineStyle)style);
        }

        //using MapExport
        var me = new MapExport(ss.Map);
        var image = me.Export();
        return new Bitmap(image);

        //using StyleSample.DrawToBitmap
        //ss.DrawToBitmap(bm, rect);
        //return bm;
    } 
```

TIA

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-16T03:25:11.040

在等待答案之后 - 并尝试了无数其他方法 - 一切都无济于事，我决定“手工”完成这一切，即我只需查看样式对象获取它的颜色并绘制适合图层类型的位图（线或多边形）。

它不能处理所有情况，也不能处理线条样式或内部颜色，但它现在可以满足我的目的。

这是执行此操作的代码。

```
 public static Bitmap GetStyleBitmap(FeatureLayer fl)
    {
        Feature f = GetFirstFeature(fl);
        if (f == null) return null;

        var style = f.Style;
        Color c;
        var bm = new Bitmap(16, 16, System.Drawing.Imaging.PixelFormat.Format32bppArgb);
        PointF[] poly = new PointF[] 
        {
            new PointF(2,5),
            new PointF(5,2),
            new PointF(14,7),
            new PointF(14,14),
            new PointF(2,14),
            new PointF(2,4)
        };

        SimpleLineStyle line = null;
        if (style is CompositeStyle)
            line = ((CompositeStyle)style).AreaStyle.Border as SimpleLineStyle;
        if (style is AreaStyle)
            line = ((AreaStyle)style).Border as SimpleLineStyle;

        if (line != null)
        {
            c = line.Color;

            using (var gr = Graphics.FromImage(bm))
            {
                gr.DrawPolygon(new Pen(c, 2), poly);
            }
            return bm;
        }

        line = style as SimpleLineStyle;

        if (line != null)
        {
            c = line.Color;

            using (var gr = Graphics.FromImage(bm))
            {
                gr.DrawLine(new Pen(c, 2), new PointF(2,2), new PointF(14,14));
            }
        }
        return bm;
    } 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-11-18T13:26:01.993

第一个代码已经几乎可以工作了。我只是稍微调整了一下来修复它。我已经针对其中包含 simplevectorpointstyle 的复合样式对其进行了测试。

```
 /// <summary>
    /// Creates an icon for the specified style.
    /// </summary>
    /// <param name="style">The style.</param>
    /// <returns></returns>
    private static Bitmap CreateStyleIcon(Style style)
    {
        const int iconSize = 16; //the size of the icon
        System.Drawing.Rectangle iconArea = new System.Drawing.Rectangle(0, 0, iconSize, iconSize); //a rectangle area for the icon
        StyleSample ss = new StyleSample { Bounds = iconArea };
        if (style is CompositeStyle)
        {
            CompositeStyle compsiteStyle = style as CompositeStyle;
            if (compsiteStyle.AreaStyle != null) //do we have an area style?
            {
                ss.ApplyAreaStyle(compsiteStyle.AreaStyle);
            }
            if (compsiteStyle.LineStyle != null) //do we have an LineStyle style?
            {
                ss.ApplyLineStyle(compsiteStyle.LineStyle);
            }
            if (compsiteStyle.SymbolStyle != null) //do we have an SymbolStyle style?
            {
                ss.ApplySymbol(compsiteStyle.SymbolStyle);
            }
        }
        if (style is AreaStyle)
        {
            ss.ApplyAreaStyle((AreaStyle)style);
        }
        if (style is BaseLineStyle)
        {
            ss.ApplyLineStyle((BaseLineStyle)style);
        }

        //draw the bitmap
        Bitmap iconBitmap = new Bitmap(iconSize, iconSize, System.Drawing.Imaging.PixelFormat.Format32bppArgb);//the bitmap to draw the icon to
        ss.DrawToBitmap(iconBitmap, iconArea);
        return iconBitmap;
    } 
```

# delphi - 无论程序如何退出，如何确保 FormClose 程序运行？

> ID：679595
> 
> 赞同：4
> 
> 时间：2009-03-24T23:02:26.987
> 
> 标签：delphi

在 Delphi 7 中，我有一个 TMainForm.FormClose 过程，旨在在程序退出时写出一些状态。这在手动关闭程序时工作正常。但是，我发现如果程序被 Windows“强制”退出（例如在需要重新启动的 Windows 更新之后），则不会调用 FormClose 过程。

编辑 - 我是新来的，看起来我无法删除自己的帖子。经过一番搜索，我找到[了解决方案](http://www.esanu.name/delphi/Win%20API/Performing%20an%20action%20when%20Windows%20shuts%20down%20a%20Delphi%20app.html)。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-24T23:23:30.197

这个真的很难 如果你在外部杀死一个进程，那就是立即终止。没有机会清理，期间。Windows Update 的重新启动通常会通过向其发送 WM_QUERYENDSESSION 消息来“正确”关闭程序，但无论出于何种原因，它并不总是有效。特别是，如果您的程序延迟很长时间（例如，在退出前询问用户是否要保存），关闭代码将终止该进程。

因此，如果你想保证它总是调用那个事件处理程序，你必须保证你永远不会使用模式对话框或任何会阻止程序在收到 WM_QUERYENDSESSION 时立即退出的任何东西。这可能比它的价值更麻烦。

一种替代方法是做类似于 Firefox 所做的事情：在它仍在运行时将状态数据写入一个临时文件，然后当它重新启动时，检查该文件是否存在以及数据是否表明它仍然在 "开放”状态。如果是这样，您的程序可以知道它的最后一个化身以某种方式被杀死并采取任何适当的措施，例如使用最后可用的数据更新状态日志（或您正在使用的任何内容）。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-25T17:50:17.693

上面的评论建议我总结我找到的答案[（链接）](http://www.esanu.name/delphi/Win%20API/Performing%20an%20action%20when%20Windows%20shuts%20down%20a%20Delphi%20app.html)。基本上，它说为 WM_QUERYENDSESSION 提供您自己的处理程序。这是推荐的代码：

```
procedure TForm1.WMQueryEndSession(var Message: TWMQueryEndSession);
begin
  inherited; { let the inherited message handler respond first }
  {--------------------------------------------------------------------}
  { at this point, you can either prevent windows from closing... }
  { Message.Result:=0; }
  {---------------------------or---------------------------------------}
  { just call the same cleanup procedure that you call in FormClose... }
  MyCleanUpProcedure;
  {--------------------------------------------------------------------}
end;

procedure TForm1.FormClose(Sender: TObject; var Action: TCloseAction);
begin
  MyCleanUpProcedure;
end; 
```

我不确定在调用 MyCleanUpProcedure 之前调用 Inherited 是否完全正确。如果 Inherited 过程首先响应 Windows，Windows 仍然可以在 MyCleanUpProcedure 完成之前关闭应用程序。我不确定 Inherited 对`WM_QUERYENDSESSION`消息做了什么 - 我假设它默认允许立即关闭。在我的应用程序中，MyCleanUpProcedure 运行速度非常快，因此不会由于对`WM_QUERYENDSESSION`消息没有响应而导致 Windows 显示“未响应”对话框。

为了确保我的程序运行完成，程序应该如下所示：

```
procedure TForm1.WMQueryEndSession(var Message: TWMQueryEndSession);
begin
  MyCleanUpProcedure;
  inherited;
end; 
```

或者可能是这个？

```
procedure TForm1.WMQueryEndSession(var Message: TWMQueryEndSession);
begin
  MyCleanUpProcedure;
  Message.Result:=1;    // tell Windows it is OK to shut down
end; 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-30T13:41:00.657

跟进信息：我不知道继承的过程是否除了返回“1”之外还有其他作用，所以我尝试了返回和继承。首先运行我的关机程序，然后返回一个 1，然后继承。

```
procedure TForm1.WMQueryEndSession(var Message: TWMQueryEndSession);
begin
  MyCleanUpProcedure;
  Message.Result:=1;  {Signal that it is OK to shut down}
  inherited; { let the inherited message handler respond }
end; 
```

我已经针对系统关闭（手动或由于 Windows 更新）而我的应用程序仍在运行的情况测试了此代码。以下代码已被验证在这种情况下可以正常工作 - MyCleanUpProcedure 在我的应用程序关闭之前运行。

对于我的应用程序被任务管理器杀死的情况，我没有对此进行测试——这与我的应用程序无关。

# c# - 计算整数十进制长度的最快方法？（。网）

> ID：679602
> 
> 赞同：17
> 
> 时间：2009-03-24T23:04:45.153
> 
> 标签：c#, .net, performance, integer

我有一些代码可以对 64 位整数进行大量比较，但是它必须考虑数字的长度，就好像它被格式化为字符串一样。我无法更改调用代码，只能更改功能。

最简单的方法（除了 .ToString().Length）是：

```
(int)Math.Truncate(Math.Log10(x)) + 1; 
```

然而，这表现相当差。由于我的应用程序只发送正值，并且长度相当均匀地分布在 2 和 9 之间（对 9 有一些偏差），我预先计算了这些值并使用了 if 语句：

```
static int getLen(long x) {
    if (x < 1000000) {
        if (x < 100) return 2;
        if (x < 1000) return 3;
        if (x < 10000) return 4;
        if (x < 100000) return 5;
        return 6;
    } else {
        if (x < 10000000) return 7;
        if (x < 100000000) return 8;
        if (x < 1000000000) return 9; 
        return (int)Math.Truncate(Math.Log10(x)) + 1; // Very uncommon
    }
} 
```

这可以通过平均 4 次比较来计算长度。

那么，我可以使用其他任何技巧来使此功能更快吗？

编辑：这将作为 32 位代码（Silverlight）运行。

更新：

我采纳了 Norman 的建议，稍微改变了 ifs，结果平均只有 3 次比较。根据肖恩的评论，我删除了 Math.Truncate。总之，这推动了大约 10% 的增长。谢谢！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-24T23:08:48.203

两个建议：

1.  剖析并将常见案例放在首位。
2.  在最坏的情况下进行二分搜索以最小化比较的数量。您可以使用恰好三个比较在 8 个备选方案中做出决定。

除非分布非常偏斜，否则这种组合可能不会给您带来太多收益。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-12-11T20:34:38.397

来自 Sean Anderson 的[Bit Twiddling Hacks](http://graphics.stanford.edu/~seander/bithacks.html#IntegerLog10)：

**查找整数的整数对数基数 10**

```
unsigned int v; // non-zero 32-bit integer value to compute the log base 10 of 
int r;          // result goes here
int t;          // temporary

static unsigned int const PowersOf10[] = 
    {1, 10, 100, 1000, 10000, 100000,
     1000000, 10000000, 100000000, 1000000000};

t = (IntegerLogBase2(v) + 1) * 1233 >> 12; // (use a lg2 method from above)
r = t - (v < PowersOf10[t]); 
```

> 整数对数基数 10 是通过首先使用上述技术之一来计算对数基数 2。通过关系 log10(v) = log2(v) / log2(10)，我们需要将其乘以 1/log2( 10)，大约是 1233/4096，或 1233 后右移 12。需要添加一个，因为 IntegerLogBase2 向下舍入。最后，由于值 t 只是一个可能偏离 1 的近似值，因此可以通过减去 v < PowersOf10[t] 的结果来找到精确值。
> 
> 此方法比 IntegerLogBase2 多 6 次操作。它可以通过修改上面的 log base 2 table-lookup 方法来加速（在具有快速内存访问的机器上），以便条目包含为 t 计算的内容（即 pre-add、-mulitply 和 -shift）。这样做只需要 9 次操作即可找到以 10 为底的日志，假设使用了 4 个表（v 的每个字节一个）。

就计算 IntegerLogBase2 而言，该页面上提供了几种替代方案。对于各种高度优化的整数运算，它是一个很好的参考。

您的版本的一个变体也在那里，除了它假设值（而不是值的以 10 为底的对数）是均匀分布的，因此会进行指数排序的搜索：

**以明显的方式查找整数的整数对数基数 10**

```
unsigned int v; // non-zero 32-bit integer value to compute the log base 10 of 
int r;          // result goes here

r = (v >= 1000000000) ? 9 : (v >= 100000000) ? 8 : (v >= 10000000) ? 7 : 
    (v >= 1000000) ? 6 : (v >= 100000) ? 5 : (v >= 10000) ? 4 : 
    (v >= 1000) ? 3 : (v >= 100) ? 2 : (v >= 10) ? 1 : 0; 
```

> 当输入均匀分布在 32 位值上时，此方法效果很好，因为 76% 的输入被第一次比较捕获，21% 被第二次比较捕获，2% 被第三次捕获，依此类推（斩波每次比较剩余的下降 90%）。因此，平均需要少于 2.6 次操作。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-24T23:28:00.403

这是我测试过的二进制搜索版本，它适用于 64 位整数，每次恰好使用五次比较。

```
int base10len(uint64_t n) {
  int len = 0;
  /* n < 10^32 */
  if (n >= 10000000000000000ULL) { n /= 10000000000000000ULL; len += 16; }
  /* n < 10^16 */
  if (n >= 100000000) { n /= 100000000; len += 8; }
  /* n < 100000000 = 10^8 */
  if (n >= 10000) { n /= 10000; len += 4; }
  /* n < 10000 */
  if (n >= 100) { n /= 100; len += 2; }
  /* n < 100 */
  if (n >= 10) { return len + 2; }
  else         { return len + 1; }
} 
```

我怀疑这会比你已经在做的更快。但这是可以预见的。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-24T23:56:52.750

我做了一些测试，这似乎比您现在拥有的代码快 2-4 倍：

```
static int getLen(long x) {
    int len = 1;
    while (x > 9999) {
        x /= 10000;
        len += 4;
    }
    while (x > 99) {
        x /= 100;
        len += 2;
    }
    if (x > 9) len++;
    return len;
} 
```

编辑：
这是一个使用更多 Int32 操作的版本，如果您没有 x64 应用程序，它应该会更好地工作：

```
static int getLen(long x) {
    int len = 1;
    while (x > 99999999) {
        x /= 100000000;
        len += 8;
    }
    int y = (int)x;
    while (y > 999) {
        y /= 1000;
        len += 3;
    }
    while (y > 9) {
        y /= 10;
        len ++;
    }
    return len;
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-24T23:38:18.350

您在代码中评论说 10 位或更多位非常罕见，因此您的原始解决方案还不错

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-25T07:31:35.933

我没有对此进行测试，但基本法的变化说：

Log10(x) = Log2(x) / Log2(10)

如果实施得当，Log2 应该比 Log10 快一点。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-08-25T15:31:49.080

```
static int getDigitCount( int x )
    {
    int digits = ( x < 0 ) ? 2 : 1; // '0' has one digit,negative needs space for sign
    while( x > 9 ) // after '9' need more
        {
        x /= 10; // divide and conquer
        digits++;
        }
    return digits;
    } 
```

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2009-03-24T23:17:58.647

不确定这是否更快......但你总是可以数......

```
static int getLen(long x) {
    int len = 1;
    while (x > 0) {
        x = x/10;
        len++
    };
    return len
}
```

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2009-03-24T23:26:41.577

你说的长度是什么意思？零的数量还是一切？[这](http://www.shrinkrays.net/articles/dotnet-formatting-strings.aspx)确实是重要的数字，但你明白了一般的想法

```
public static string SpecialFormat(int v, int sf)  
{  
     int k = (int)Math.Pow(10, (int)(Math.Log10(v) + 1 - sf));  
     int v2 = ((v + k/2) / k) * k;  
     return v2.ToString("0,0");  
} 
```

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2014-03-07T08:02:40.657

这是一个简单的方法。

```
private static int GetDigitCount(int number)
{
    int digit = 0;

    number = Math.Abs(number);

    while ((int)Math.Pow(10, digit++) <= number);

    return digit - 1;
} 
```

如果 number 是 unsigned int 则不需要“Math.Abs​​(number)”。

我用所有数字类型制作了扩展方法。

```
 private static int GetDigitCount(dynamic number)
    {
        dynamic digit = 0;

        number = Math.Abs(number);

        while ((dynamic)Math.Pow(10, digit++) <= number)
            ;

        return digit - 1;
    }

    public static int GetDigit(this int number)
    {
        return GetDigitCount(number);
    }

    public static int GetDigit(this long number)
    {
        return GetDigitCount(number);
    } 
```

然后你用这个。

```
int x = 100;
int digit = x.GetDigit();  // 3 expected. 
```

# xml - 如何实现共享点列表 web 服务

> ID：679605
> 
> 赞同：0
> 
> 时间：2009-03-24T23:06:06.867
> 
> 标签：xml, web-services, sharepoint, wsdl, list

我想实现一个 web 服务，它使用与[sharepoint 中的 Lists web 服务](http://msdn.microsoft.com/en-us/library/lists.aspx)相同的接口。我不想通过 sharepoint 运行它。什么是开始这方面的好方法？

我尝试使用 wsdl.exe 工具生成一些包装器类，但生成的包装器似乎已经对结构参数进行了处理，并且只是将它们指定为 XML。例如，下面是生成的包装器`GetList`- 它应该返回一个包含列表中信息的结构，但它返回的是 XML。到底是怎么回事？

...

```
/// <remarks/>
[System.CodeDom.Compiler.GeneratedCodeAttribute("wsdl", "2.0.50727.1432")]
[System.Web.Services.WebServiceBindingAttribute(Name="ListsSoap", Namespace="http://schemas.microsoft.com/sharepoint/soap/")]
public interface IListsSoap
{    
    /// <remarks/>
    [System.Web.Services.WebMethodAttribute()]
    [System.Web.Services.Protocols.SoapDocumentMethodAttribute("http://schemas.microsoft.com/sharepoint/soap/GetList", RequestNamespace="http://schemas.microsoft.com/sharepoint/soap/", ResponseNamespace="http://schemas.microsoft.com/sharepoint/soap/", Use=System.Web.Services.Description.SoapBindingUse.Literal, ParameterStyle=System.Web.Services.Protocols.SoapParameterStyle.Wrapped)]
    System.Xml.XmlNode GetList(string listName);   
} 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-25T14:07:58.930

这可能是一个顽固的答案，因为我不太精通创建自己的 Web 服务，但他们不是总是要返回 xml 吗？或者更确切地说是 SOAP

# jquery - 为什么我在 seaside 2.9 中使用 'jQuery ajax' 时没有发生服务器端回调？

> ID：679607
> 
> 赞同：2
> 
> 时间：2009-03-24T23:07:36.007
> 
> 标签：jquery, ajax, seaside

我正在尝试在海边 2.9 中做这样的事情

```
html button 
 onClick: (html jQuery ajax
  serialize: (html jQuery this);
  script: [:s | s << (s jQuery id: stratId) append: [html text: 'bing'. html break]]);
 callback: [2 inspect];
with: 'add option'. 
```

正如我所期望的那样，我的带有 stratId 的 div 被附加了，但我的吱吱声图像中没有得到检查窗口？这样做的正确方法是什么？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-24T23:43:07.543

答案在 JQueryInstance>>#serializeThis 的方法注释的第二部分：

`"Serialize the receiving element. Note that this might not work for all form elements: (1) for check-boxes and multi-select lists Seaside internally depends on an additional hidden form element that is generated automatically, instead use #serializeThisWithHidden (2) submit-button callbacks are ignored, instead use a normal callback to trigger specific code evaluation."`

而是将您的回调代码放入 jQuery 回调本身，也就是 #script: 块。

# javascript - 保存/镜像/爬取使用javascript生成内容的网页

> ID：679609
> 
> 赞同：4
> 
> 时间：2009-03-24T23:07:47.080
> 
> 标签：javascript, browser, web-crawler

我想下载使用 javascript 输出数据的网页。Wget 可以做其他所有事情，但运行 javascript。

甚至像：firefox -remote "saveURL(www.mozilla.org, myfile.html)"

会很棒（不幸的是，这种命令不存在）。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-24T23:16:33.440

我会看看 selenium 浏览器自动化工具 ( [http://seleniumhq.org/](http://seleniumhq.org/) ) - 您可以自动访问网页，并保存生成的 HTML。

我们在之前的项目中使用它来实现类似的目的，取得了巨大的成功。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-24T23:55:32.553

我赞同 Alex 对 Selenium 的建议。它在浏览器中运行，因此它可以在 Javascript 修改 DOM 后捕获输出 HTML。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-25T08:13:47.673

使用浏览器驱动的方法的问题是很难自动化抓取过程。

在您最喜欢的编程语言中寻找“无头浏览器”。或者，您可以使用[Jaxer](http://www.aptana.com/node/429)加载 DOM 服务器端，执行 JavaScript 并让它操作 DOM，然后使用您已经熟悉的相同 JavaScript 抓取修改后的 DOM。这将是我的首选方法。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-24T23:23:14.453

如果它可以是基于 Windows 的应用程序，您可以尝试使用任何编程语言（如 C#、Visual Basic、Delphi 等）的浏览器组件来加载页面，然后查看内容并保存。浏览器组件应基于 IE 渲染引擎，并应支持 JavaScript。[这里](https://stackoverflow.com/questions/679404/trying-to-develop-a-facebook-tumblr-style-news-feed-cms-in-asp-net)有一个关于网站快照的问题。可能对你有些用处。

或者，您可以考虑构建自己的 Firefox 扩展。[在这里](http://www.rietta.com/firefox/Tutorial/overview.html)查看更多详细信息（没有“下一步”按钮，只有左侧用于导航的菜单，起初让我感到困惑）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-03-17T06:26:38.263

我在使用之前已经这样做了：

*   [鸡脚](http://groups.csail.mit.edu/uid/chickenfoot/)
*   [网络套件](http://www.pyside.org/docs/pyside/PySide/QtWebKit/index.html)

# sharepoint - SharePoint Designer 工作流：不守规矩的“收集用户数据”操作

> ID：679612
> 
> 赞同：0
> 
> 时间：2009-03-24T23:07:59.687
> 
> 标签：sharepoint, workflow, sharepoint-designer

我是 SharePoint 在线课程的学生。这个问题让我与之讨论过的每个人都感到困惑，包括老师。当我使用收集数据操作创建工作流时，似乎存在某种问题。我可以创建发送电子邮件并使用其他操作的工作流。什么可能导致这个问题？

我的复制步骤很简单：

使用空白网站模板创建新网站集。创建一个新的自定义列表。在 SharePoint Designer 中，在自定义列表上启动一个新工作流。将收集数据操作添加到工作流。将用户设置为创建任务的用户。将数据设置为任何内容。一个复选框、一个字符串、Choice 无关紧要。将输出变量保留为默认值。出现神秘错误！

当按下 Check Workflow 按钮时，没有任何反应。根本没有消息框出现。步骤面板中的警告图标只是指出存在一些错误，并没有具体说明它们是什么。

此外，当我在创建数据对象后再次单击它时，它不会使用旧值填充表单。它返回到没有字段的默认名称。所以这里肯定有问题。我已将问题缩小到数据对象，但我不知道该怎么做。

对于其他活动，工作流的行为与正常情况一样。例如，删除“收集数据”操作并添加“发送电子邮件”操作，它会成功编译并运行。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-25T15:56:44.643

问题的具体原因现在可能永远是个谜。我清理了整个 SharePoint 安装并重新构建它。不久之后，我按照重现步骤制作了一个正常工作的工作流程。不完全是我正在寻找的解决方案，但我不能永远花在这个上面。

# html - 为什么 Doctype 声明分成两行？

> ID：679620
> 
> 赞同：7
> 
> 时间：2009-03-24T23:12:13.030
> 
> 标签：html

我知道可能还有更重要的问题需要讨论，但以显得愚蠢为代价，我想要一个答案；-)

以此为例：

```
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
"http://www.w3.org/TR/html4/strict.dtd"> 
```

是否符合80列标准？另外，我通常在我的 HTML 中使用单引号，因为它们看起来更容易，这对浏览器有什么影响吗？它会以怪异模式发送 IE6 并将其放在一行和单引号属性上吗？

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-24T23:15:55.940

这只是换行。

此外，XML 将采用任一引号，但约定是双引号。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-24T23:15:56.967

我猜它是为了可读性。

AFAIK，它不必在两条线上，我们所有的网站都在一条线上，SO也是如此。

# .net - 生成用户友好的代码

> ID：679623
> 
> 赞同：3
> 
> 时间：2009-03-24T23:14:00.700
> 
> 标签：.net, random

我正在研究生成随机人类友好代码但不是（容易）猜测的方法。这将用于赠送奖品（想想独特的折扣代码）。我们将生成大约 50k。是否有任何标准方法/算法来实现这一点？我正在考虑使用 GUID 并应用 CRC。这是一个坏主意吗？

如果重要，请使用 .netframework 3.5。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-24T23:31:30.770

我通过从 MD5 校验和中获取位并将它们用于索引到单词列表中来生成人类友好的校验和。例如：

```
: nr@yorkie 7012 ; md5words /home/nr/.profile  
overextend moonscape cucumbers outsmarting 
```

代码大约是 40 行 Lua，不包括单词列表，它包含在脚本中，以便在每个系统上产生相同的结果。

* * *

编辑：

在您的应用程序中，您希望生成 50,000 个密钥。你可以这样做：

```
for ((i=1; i<=50000; i++))
do 
  echo "this is my secret phrase $i" | md5words
done 
```

将此过程与不同的密码短语一起使用会生成以下密钥：

```
Chisinau Phaethon customs Martina
commensurate freewill logical cambered
kamikazes Creighton Dobro's Alonzo
medallion's jesters goofy keystones
Anaxagoras martial Medina's Hon's
acclimatized chirping Cleopatra's mascaras
buoyant nuclear lumbering disagreements
dampens Philby cloak drollness 
```

这些密钥很难伪造：单词列表上有近 100,000 个单词，因此有 10^20 个可能的 4 单词序列。如果您有 100,000 个代码，那么有人能够随机猜出一个代码的机会是 10^15 分之一。如果你限制人们可以尝试的键的数量，比如每 0.3 秒一个键，你就不会有问题。

如果我在您的应用程序中部署这个想法，我会将单词列表修剪为更短的内容，可能只有 10,000 个非常普遍认可的单词。即使在损失了 10^4 的因子之后，这些数字也对您非常有利——猜到密钥的机会将是千亿分之一。

* * *

**更新**：2011 年 8 月，这项技术成为[xkcd 卡通](http://xkcd.com/936/)的主题。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-24T23:43:47.620

我最喜欢的创建人类友好、发音但最终无意义和随机单词的方法是马尔可夫链。这里有一些链接可以帮助您沿着这条道路前进。

[http://www.codinghorror.com/blog/archives/001132.html](http://www.codinghorror.com/blog/archives/001132.html) - Jeff Atwood 的解释（非常好！）

[http://en.wikipedia.org/wiki/Markov_chain](http://en.wikipedia.org/wiki/Markov_chain) - 维基百科关于马尔可夫链的条目很长，而且涉及到数学。

[http://www.cs.bell-labs.com/cm/cs/pearls/sec153.html](http://www.cs.bell-labs.com/cm/cs/pearls/sec153.html) - 来自 Programming Pearls，拥有用于马尔可夫链生成器的 Perl。

[http://www.xradiograph.com/WordSalad/ChainsOfLove](http://www.xradiograph.com/WordSalad/ChainsOfLove) - 链接到马尔可夫链生成器。

[http://www.jwz.org/dadadodo/](http://www.jwz.org/dadadodo/) - Jamie Zawinski 在 C 中的实现。

请记住，您必须为这些生成器提供文本以生成链，然后它会从中生成单词和句子。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-24T23:33:02.043

一些想法跃入脑海：

*   如果长度允许，您总是可以通过从字典中挑选单词来生成短语。有关实践中的一个很好的示例，请参阅[Diceware](http://www.diceware.com/)。

*   如果长度更重要，请使用音节列表，结果将是一个无意义但可发音的单词。但是，您可能需要过滤结果以删除不需要的实际单词。

*   如果不需要发音，但您希望能够快速验证代码是否来自您的系统，那么将（加盐？）计数器的小 CRC 打包到字节数组中并使用[base64](http://en.wikipedia.org/wiki/Base64)或类似编码将起作用。您可以通过保持代码简短和选择消除相似字母的编码来改善人为因素（即表中没有“O”、“o”、“0”和“Q”）。

*   如果代码在实践中需要超过大约 5 个字符，则考虑采用标准的标点符号方案，将其分成块。“A236re8ww1jkm”比“A236-re8wM-1jkz”更难阅读和转录。这里的数字五是一个疯狂的猜测......可能有关于最佳长度的文献。

*   如果这确实是一个加密问题（即，如果伪造这些代码具有重大的实际价值），那么请咨询加密专家以获得最佳实践答案，因为您自己滚动最终会导致悲伤。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-25T00:39:59.607

[Java Pronouncable Passwords](http://www.multicians.org/thvv/gpw.html)是一个生成随机发音词的网站。源是可用的，因此您可以将其移植到您需要的任何系统。

这应该为您提供可以提供给用户的代码，他们有机会实际记住。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-24T23:20:35.333

我以前用过[Base32 来做](http://en.wikipedia.org/wiki/Base32)这类事情。

您只需要一个避免麻烦字符的字母表，如 I、L、1、0、O 等。

**编辑**：所以，澄清一下，只需 Base32 编码足够的随机生成的字节来为您提供所需的字符数。

然后，您可能希望将输出分成 4 组，以提高人类可读性。

**编辑2：**另一个好主意是将最后一个字母作为校验位 - 比如说所有先前字节的总和以32为模。

# joomla - 您如何在 Joomla 1.0 中构建用户对象？

> ID：679634
> 
> 赞同：0
> 
> 时间：2009-03-24T23:17:19.367
> 
> 标签：joomla

我有一个我正在开发的 Joomla 1.0 模块的帮助脚本。我用它来执行 AJAX 任务（读取和写入数据库，返回 JSON），所以我需要停止 Joomla 输出它的标题和诸如此类的东西。

到目前为止，我已经通过将一些代码组合在一起来完成必要的包括设置数据库连接等来解决这个问题：

```
define( '_VALID_MOS', 1 );
require_once '../globals.php';
require_once '../configuration.php';
require_once '../includes/joomla.php'; 
```

唯一的问题是没有创建`$my`变量（`mos_user`当前用户的对象）。

如何创建此用户？我需要包含什么文件？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-24T23:34:33.007

我发现它是`$mainframe`对象上的一个函数，但你也必须构造它：

```
$mainframe = new mosMainFrame( $database, '', '.' );
$mainframe->initSession();
$my = $mainframe->getUser(); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-25T13:38:43.227

您还可以调用 index2.php?no_html=1（后跟您需要的任何其他参数）来获取标准组件的原始输出。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-31T08:49:19.490

在将 1.5 模块迁移到 1.0 时，我刚刚遇到了这个问题，但上述答案似乎都没有给出完整的故事。nickf 的回答让我大部分时间都到达了那里，但后来我在尝试构建大型机时掉进了一个兔子洞。

然后我假设 $my 可能已经创建了，虽然它不能在函数中工作（我是 PHP 新手，所以我认为它可以访问）我发现在模块范围内使用它很好，如图所示以下：

```
<?php
/**
 * Demo package
 *
 * @package    Demo package
 * @subpackage Modules
 */

// no direct access
defined( '_VALID_MOS' ) or die( 'Restricted access' );

class modDcsgSimulatorHelper
{

    /**
     * security by obscurity
     */
    function getAppToken( $username )
    {
      return urlencode($username);
    }
}

$apptoken = modDcsgSimulatorHelper::getAppToken( $my->username );
?>
Run the <A href="http://somesecurewebsite.com?apptoken=<?php echo $apptoken; ?>">A Secure Link</A>. 
```

在有人因为这个非常安全的机制而抨击我之前，请放心，我已经从真正的实现中省略了细节，因为我的答案不必要地冗长。

# c# - TCP 套接字服务器偶尔会随着时间的推移建立 CLOSE_WAIT，直到无法操作

> ID：679643
> 
> 赞同：4
> 
> 时间：2009-03-24T23:20:04.570
> 
> 标签：c#, performance, sockets, crash, wireshark

希望有人可以帮助我们，因为我们正在调查可以去！

我们有一个用 C# 编写的简单异步套接字服务器，它接受来自 ASP.NET Web 应用程序的连接，发送消息，执行一些处理（通常针对 DB，但也针对其他系统），然后将响应发送回客户端. 客户端负责关闭连接。

我们一直遇到问题，如果系统在很长一段时间内（通常是几天）处于重负载状态，CLOSE_WAIT 套接字会在服务器盒（netstat -a）上建立，以至于进程不会接受任何进一步的连接. 在这一点上，我们必须反弹该过程并再次运行它。

我们已经尝试对我们的 ASP.NET 应用程序运行一些负载测试以尝试复制问题（因为无法从代码中推断出某些问题）。我们认为我们已经解决了这个问题，并最终得到了问题的 WireShark[数据包跟踪](http://drop.io/close_wait3793)，在套接字服务器的日志中显示为 SocketException：

> System.Net.Sockets.SocketException：远程主机在 System.Net.Sockets.Socket.BeginSend（Byte[] 缓冲区，Int32 偏移量，Int32 大小，SocketFlags socketFlags，AsyncCallback 回调，对象状态）处强行关闭了现有连接

我试图从数据包跟踪中重现该问题，因为它是一个直接与套接字服务器对话的单线程进程（使用与 ASP.NET 应用程序相同的代码），但我无法做到。

有没有人对接下来要尝试、检查的事情或我们可能做错的明显事情有任何建议？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-25T23:18:41.773

看图

```
http://en.wikipedia.org/wiki/File:Tcp_state_diagram_fixed.svg
```

您的客户端通过调用 close() 关闭了连接，这将 FIN 发送到服务器套接字，服务器套接字确认了 FIN 并且其状态现在更改为 CLOSE_WAIT，并保持这种状态，除非服务器在该套接字上发出 close() 调用。

您的服务器程序需要检测客户端是否中止了连接，然后立即 close() 以释放端口。如何？请参阅读取（）。在读取文件结尾（意味着收到 FIN）时，返回零。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-25T08:34:30.573

如果您的服务器正在累积`CLOSE_WAIT`套接字，则连接完成时它不会关闭其套接字。如果您查看 Chris 帖子评论中的状态图，您会看到一旦套接字关闭并已发送，就会`CLOSE_WAIT`转换为。`LAST_ACK``FIN`

您说由于异步性质而确​​定在哪里执行此操作很复杂？这应该不是问题，如果您的 recv 的回调返回 0 字节，您应该关闭套接字（假设一旦您的客户端关闭其一侧的连接，您就无事可做）。如果您确实需要担心继续发送，请在此处执行 Shutdown(recv) 并记下您的客户端已关闭，一旦您完成发送，请执行 Shutdown(send) 和 Close。

您可能会在读取的回调中发出新的读取，该读取返回 0 表示客户端已关闭，这可能会导致您出现问题？

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-24T23:27:49.967

> 客户端负责关闭连接。

客户端和服务器都必须关闭并关闭套接字。客户端没有完成关闭（不太可能 - 因为它会运行终结器）或服务器没有关闭套接字（可能）。

```
using (Socket s = new Socket(/* */)) {
  /* Do stuff */
  s.Shutdown(SocketShutdown.Both);
  s.Close();
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-24T23:46:28.563

您不应该只将关闭 TCP 套接字的责任留给客户端。如果客户端进程/机器崩溃了怎么办？

理想情况下，您应该设置一个超时，以便如果在一定时间后连接的套接字上没有收到流量，那么它会被服务器关闭。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-04-19T05:34:10.957

无论客户端对套接字的所有操作都完成后发生什么，并且不再需要对套接字进行任何读取操作，客户端都应该发出关闭命令。

发出关闭命令只是告诉侦听器（服务器）需要关闭连接。

简单来说，当服务器再次发出读取命令（listener.read() 或 listener.beginread(...) 在异步模式下），读取将返回一个 0 字节的读取，这本身就表明套接字需要由侦听器关闭，因为客户端上的任何其他操作已停止。

* * *

## 回答 #6

> 赞同：-2
> 
> 时间：2009-03-24T23:29:18.760

CLOSE_WAIT 的目的是在套接字关闭后等待一段时间，以防止重复使用相同的套接字号并从旧连接接收数据包。如果您真的很快打开和关闭大量的套接字，这只会让您感到悲伤。

编辑 - 它应该是 TIME_WAIT，而不是上面的 CLOSE_WAIT。

# linq - Linq 中的多个 WHERE 子句

> ID：679644
> 
> 赞同：77
> 
> 时间：2009-03-24T23:20:11.297
> 
> 标签：linq, linq-to-sql

我是 LINQ 新手，想知道如何执行多个 where 子句。这就是我想要实现的：通过过滤掉某些用户名返回记录。我尝试了下面的代码，但没有按预期工作。

```
DataTable tempData = (DataTable)grdUsageRecords.DataSource;
var query = from r in tempData.AsEnumerable()
            where ((r.Field<string>("UserName") != "XXXX") || (r.Field<string>("UserName") != "XXXX"))                            
            select r;    

            DataTable newDT = query.CopyToDataTable(); 
```

我在这里先向您的帮助表示感谢！！！

* * *

## 回答 #1

> 赞同：120
> 
> 时间：2009-03-24T23:24:50.410

好吧，您可以直接放入多个“where”子句，但我认为您不想这样做。多个“where”子句最终得到一个限制性*更强*的过滤器——我认为你想要一个限制性*更小*的过滤器。我想你真的想要：

```
DataTable tempData = (DataTable)grdUsageRecords.DataSource;
var query = from r in tempData.AsEnumerable()
            where r.Field<string>("UserName") != "XXXX" &&
                  r.Field<string>("UserName") != "YYYY"
            select r;

DataTable newDT = query.CopyToDataTable(); 
```

注意 && 而不是 ||。如果用户名不是 XXXX*且*用户名不是 YYYY，则要选择该行。

编辑：如果你有一个完整的集合，那就更容易了。假设集合被称为`ignoredUserNames`：

```
DataTable tempData = (DataTable)grdUsageRecords.DataSource;
var query = from r in tempData.AsEnumerable()
            where !ignoredUserNames.Contains(r.Field<string>("UserName"))
            select r;

DataTable newDT = query.CopyToDataTable(); 
```

理想情况下，您希望将其设为 a`HashSet<string>`以避免`Contains`调用需要很长时间，但如果集合足够小，则不会产生太大的可能性。

* * *

## 回答 #2

> 赞同：49
> 
> 时间：2012-09-21T06:48:19.207

LINQ 翻译器足够聪明，可以执行：

```
.Where(r => r.UserName !="XXXX" && r.UsernName !="YYYY") 
```

我已经在 LinqPad 中对此进行了测试 ==> 是的，Linq 翻译器足够聪明 :))

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2011-11-02T20:43:16.377

此外，您可以使用 bool 方法

询问 ：

```
DataTable tempData = (DataTable)grdUsageRecords.DataSource;
var query = from r in tempData.AsEnumerable()
            where isValid(Field<string>("UserName"))// && otherMethod() && otherMethod2()                           
            select r;   

        DataTable newDT = query.CopyToDataTable(); 
```

方法：

```
bool isValid(string userName)
{
    if(userName == "XXXX" || userName == "YYYY")
        return false;
    else return true;
} 
```

# asp.net - 像样的 ASP.NET/SQL 教程？

> ID：679647
> 
> 赞同：-1
> 
> 时间：2009-03-24T23:20:53.617
> 
> 标签：asp.net, sql

我以前从未在工作中使用过数据库。我知道一些基本的 SQL 语法。只是在寻找一个体面的教程，它将向我展示如何设置数据库并使用它在 ASP.NET 页面上提供信息。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-24T23:25:20.627

[如何创建数据驱动的网站？](http://www.asp.net/web-forms/videos/how-do-i/how-do-i-create-data-driven-web-sites)[以及来自asp.net](http://www.asp.net/get-started/)的其他教程。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-24T23:22:06.097

您可能会从以下视频教程中受益：

[http://www.learnvisualstudio.net](http://www.learnvisualstudio.net)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-24T23:25:30.003

这是一个关于 ASP.NET 中数据访问的几个主题的教程：

[http://www.asp.net/Learn/data-access/](http://www.asp.net/Learn/data-access/)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-24T23:26:25.990

当我遇到同样的情况时，我发现[4guysfromrolla](http://www.4guysfromrolla.com/)教程非常有用，尽管它们现在可能有点过时了。

也许尝试特别检查一下[这个](http://aspnet.4guysfromrolla.com/articles/110905-1.aspx)

# c# - .NET ref 参数是线程安全的，还是容易受到不安全的多线程访问？

> ID：679654
> 
> 赞同：7
> 
> 时间：2009-03-24T23:24:32.877
> 
> 标签：c#, .net, parameters, thread-safety

**简介编辑：**
我们知道 C# 中的 ref 参数传递对变量的*引用*，允许在调用的方法中更改外部变量本身。但是引用是否像 C 指针那样处理（每次访问该参数时读取原始变量的当前内容，并在每次修改参数时更改原始变量），或者被调用的方法是否可以依赖于一致的引用通话时长？前者带来了一些线程安全问题。尤其：

我在 C# 中编写了一个静态方法，它通过引用传递一个对象：

```
public static void Register(ref Definition newDefinition) { ... } 
```

调用者提供了一个已完成但尚未注册的`Definition`对象，经过一些一致性检查后，我们“注册”了他们提供的定义。但是，如果已经存在具有相同键的定义，则无法注册新键，而是将其引用更新`Definition`为该键的“官方”。

我们希望这是严格线程安全的，但我想到了一个病态的场景。假设客户端（使用我们的库）以非线程安全的方式共享引用，例如使用静态成员而不是局部变量：

```
private static Definition riskyReference = null; 
```

如果一个线程设置`riskyReference = new Definition("key 1");`、填写定义并调用我们`Definition.Register(ref riskyReference);`，而另一个线程也决定设置`riskyReference = new Definition("key 2");`，我们是否保证在我们的 Register 方法中，`newDefinition`我们正在处理的引用不会被其他线程修改（因为对对象被复制进来并在我们返回时被复制出来？），或者其他线程可以在执行过程中替换我们身上的对象（如果我们引用指向原始存储位置的指针？？？），因此打破我们的健全性检查？

请注意，这与对底层对象本身的更改不同，这对于引用类型（类）当然是可能的，但可以通过该类中的适当锁定来轻松防止。但是，我们不能保护对外部客户端变量空间本身的更改！我们必须在方法顶部制作自己的参数副本并覆盖底部的参数（例如），但考虑到处理不安全的参考。

所以，我倾向于认为引用可能会被编译器复制进和复制出，以便该方法处理对原始对象的一致引用（直到它在需要时更改自己的引用），无论可能发生什么发生在其他线程上的原始位置。但是，在文档和 ref 参数的讨论中，我们很难找到关于这一点的明确答案。

任何人都可以通过明确的引用来缓解我的担忧吗？

**Edit for conclusion:**
Having confirmed it with a multi-threaded code example (Thanks Marc!) and thinking about it further, it makes sense that it is indeed the *not-automatically-threadsafe* behavior which I was worred about. One point of "ref" is to pass large structs by reference rather than copy them. Another reason is that you might *want* to set up a long-term monitoring of a variable and need to pass a reference to it which will see changes to the variable (eg. changing between null and a live object), which an automatic copy-in/copy-out would not allow for.

So, to make our `Register` method robust against client insanity, we could implement it like:

```
public static void Register(ref Definition newDefinition) {
    Definition theDefinition = newDefinition; // Copy in.
    //... Sanity checks, actual work...
    //...possibly changing theDefinition to a new Definition instance...
    newDefinition = theDefinition; // Copy out.
} 
```

They'd still have their own threading issues as far as what they end up getting, but at least their insanity wouldn't break our own sanity-checking process and possibly slip a bad state past our checks.

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-24T23:27:34.507

When you use `ref`, you are passing the address of the caller's field/variable. Therefore yes: two threads can compete over the field/variable - but only if they both are talking to that field/variable. If they have a different field/variable to the same instance, then things are sane (assuming it is immutable).

For example; in the code below, `Register` **does** see the changes that `Mutate` makes to the **variable** (each object instance is effectively immutable).

```
using System;
using System.Threading;
class Foo {
    public string Bar { get; private set; }
    public Foo(string bar) { Bar = bar; }
}
static class Program {
    static Foo foo = new Foo("abc");
    static void Main() {
        new Thread(() => {
            Register(ref foo);
        }).Start();
        for (int i = 0; i < 20; i++) {
            Mutate(ref foo);
            Thread.Sleep(100);
        }
        Console.ReadLine();
    }
    static void Mutate(ref Foo obj) {
        obj = new Foo(obj.Bar + ".");
    }
    static void Register(ref Foo obj) {
        while (obj.Bar.Length < 10) {
            Console.WriteLine(obj.Bar);
            Thread.Sleep(100);
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-03-24T23:29:43.910

No, it's not "copy in, copy out". Instead, the variable itself is effectively passed in. Not the value, but the variable itself. Changes made during the method are visible to anything else looking at the same variable.

You can see this without any threading being involved:

```
using System;

public class Test
{
    static string foo;

    static void Main(string[] args)
    {
        foo = "First";
        ShowFoo();
        ChangeValue(ref foo);
        ShowFoo();
    }

    static void ShowFoo()
    {
        Console.WriteLine(foo);
    }

    static void ChangeValue(ref string x)
    {
        x = "Second";
        ShowFoo();
    }
} 
```

The output of this is First, Second, Second - the call to `ShowFoo()` *within `ChangeValue`* shows that the value of `foo` has already changed, which is exactly the situation you're concerned about.

**The solution**

Make `Definition` immutable if it wasn't before, and change your method signature to:

```
public static Definition Register(Definition newDefinition) 
```

Then the caller can replace their variable if they want to, but your cache can't be polluted by a sly other thread. The caller would do something like:

```
myDefinition = Register(myDefinition); 
```

# php - 查找打开的会话数

> ID：679657
> 
> 赞同：3
> 
> 时间：2009-03-24T23:25:16.680
> 
> 标签：php, session

我正在寻找一种简单（无数据库）的方法来列出网站上活跃的用户数量。我能想到的最简单的方法是计算打开的会话数。

此代码*应该可以工作：*

```
$number_of_users = count(scandir(ini_get("session.save_path"))); 
```

当然，它不会因为该目录的安全限制（应该有！！）。有谁知道在不更改目录权限的情况下访问此号码的另一种方法。

**注意：** 我正在寻找一个**不涉及数据库**或降低 PHP 会话安全性的选项。

**结束说明：**对于任何提出这个问题的人，我最终使用了一个来自 root 的 cronjob（每分钟运行一次），它做了类似的事情：

```
ls /var/lib/php5/ | wc -l > /var/www/sessioncount 
```

确保`/var/www/sessioncount`apache 用户可以读取该文件。然后你可以在 PHP 中读取文件：

```
$number_of_users = file_get_contents("/var/www/sessioncount"); 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-25T00:29:20.660

```
<?
// you must set your own accessible session path atop every page.
session_save_path("/home/some/other/location/"); # SECURITY VIOLATION!!!
session_start();

function session_count() {
  $filter = "sess_";
  $files = scandir(session_save_path());
  $count = 0;
  foreach ($files as $file) {
    if(strpos($file,$filter)===0) {
      $count += 1;
    }
  }
  return $count;
}

echo session_count();
?> 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-25T00:22:16.233

在这种情况下，简单并不意味着没有数据库。同样依靠会话来查看有多少用户处于活动状态也是不可靠的。

如果你想走那条路，你可以每隔几分钟做一个由安全进程运行的 cronjob，并将计数保存到 PHP 读取的文件或数据库中。

但我建议走数据库路线。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-10-05T06:33:04.080

为了其他人解决这个问题，在这里。按顺序组装代码，并在途中使用说明。需要 PHP 的 GD 扩展。

在你的 webroot 中创建一个目录，确保 web 守护进程可以写入：

```
mkdir liveusers 
```

**为触摸代码**创建*一个 PHP 脚本（例如**vlive.php**）（顺便说一句，触摸是一个标准的 *nix 命令，使用 system()、passthru() 或 exec() 任何你想使用的命令）。让它*接触*该目录中具有唯一文件名的文件，例如 IP+SessionID 连接在一起：*

 ***```
<?php 
exec("touch ". $_SERVER['DOCUMENT_ROOT']."/liveusers/". md5($_SERVER['REMOTE_ADDR'].session_id())); /* SECURITY RISK */ 
```

现在，在*同一个文件*中，我们需要输出一个 JPEG 并使用正确的 header() 完成它。我将一个名为**pixel.jpg**的 1x1 像素放入 webroot 的**/images/ 目录**中，随意做其他事情：

```
$NewImage = imagecreatefromjpeg($_SERVER['DOCUMENT_ROOT']. "/images/pixel.jpg");
header("Content-type: image/jpeg");
imagejpeg($NewImage);
?> 
```

保存 PHP 文件，然后在您的文档中放置一个标准 HTML 标记以使其有用：

```
<img src="/vlive.php" alt="Imagination!" /> 
```

使用纯 PHP 然后缓存页面只会使实时用户文件几乎不会被*触及*。通过这样做，您仍然可以计算“实时”用户并在您的站点上使用整页缓存系统。

好的，现在访问者加载的每个页面都会触摸他们唯一的文件，所以如果他们刚刚到达，触摸命令将为该用户创建一个文件，如果他们也在访问其他页面，它将使用相同的*触摸*编辑访问日期命令。

这是它变得有用的地方：

在不同的 PHP 脚本中（比如说**readvlive.php**）：

```
<?php 
$livenum = system("find ".$_SERVER['DOCUMENT_ROOT']."/liveusers/ -type f -amin +10 | wc -l");
echo "Live Visitors: ". $livenum;
?> 
```

现在让我们将此片段包含到您希望在其中看到它的 HTML 元素中：

```
<?php include($_SERVER['DOCUMENT_ROOT']. "/readvlive.php"); ?> 
```

好的，现在我们有一个文件，它将打印出访问时间仅在 10 分钟前更改的唯一文件的数量。这些是我们最后十分钟的现场用户...

现在我们在这里有一个选择，同样，如果您使用整页缓存，您可能会将缓存的实时号码冻结到这些文档中，从而使其相当烦人且无用。为此，我建议 PrototypeJS（谷歌它），你使用他们花哨的 AJAX 工具，把它放在**`<head></head>`**

```
<script src="/js/prototype.js" type="text/javascript"></script> 
```

然后将其放在**`</body>`**标签上方。

```
<span id="live_users_count">&nbsp;</span>

<script type="text/javascript">
    <!--
    Event.observe(window, 'load', function() {
        if($('live_users_count')) {
            new Ajax.Updater('live_users_count','/readvlive.php'); 
        }
   }
-->
</script> 
```

应该没问题。。不要太粗糙。如果你担心你的目录将运行多少 find 命令，你可以使用 APC 或其他东西来缓存它。此示例需要 APC 3.1.4：

```
<?php
if(apc_exists('livenum')){
    $livenum = apc_fetch('livenum');echo $livenum;
} else {
    $livenum = system("find ".$_SERVER['DOCUMENT_ROOT']."/liveusers/ -type f -amin +10 | wc -l");
    apc_add('livenum',$livenum,30); 
}
?> 
```

APC 3.0.13 及更高版本：

```
<?php
if($livenum = apc_fetch('livenum')){
    echo $livenum;
} else {
    $livenum = system("find ".$_SERVER['DOCUMENT_ROOT']."/liveusers/ -type f -amin +10 | wc -l");
    apc_add('livenum',$livenum,30); 
}
?> 
```

这些将使用 APC 缓存 30 秒，显示最后 10 分钟的实时用户，将运行 find 命令以每分钟计算两次。不错。:P

清理可以使用 crontab 完成。

脚本（**/root/deloverhead.sh**）：

```
#!/bin/sh
find "/path/to/liveusers/ -type f -amin +60 -exec rm {} \; 
```

crontab 条目（每小时）：

```
0 * * * * /root/deloverhead.sh >/dev/null 2>&1 
```

玩得开心，对不起，我可能会解释一些奇怪的事情。:P

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-25T00:18:00.110

在不构成安全风险的情况下，您无法从 PHP 脚本访问该目录。

实现您想要的最简单的方法是使用数据库。只需存储 ip 和时间戳，然后根据时间戳进行 SELECT 即可获取您网站上的活跃用户数。

# c++ - 如何定义自定义类型的通用 std::list？

> ID：679660
> 
> 赞同：0
> 
> 时间：2009-03-24T23:25:47.710
> 
> 标签：c++, list

我在尝试定义“行”列表时遇到以下错误：

> line-clip.cpp:44：错误：“<”标记之前的预期初始化程序

```
#include <list>

using namespace std;

class Line {
public:
    Point p1;
    Point p2;
    Line(Point P1, Point P2)
    {
        p1 = P1;
        p2 = P2;
    }
}

// Line List
list <Line> lineList; 
```

您如何定义“Line”类型的通用列表？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-24T23:27:19.547

你的类声明后需要一个分号:-)。

```
class Line {
    ...
};    // put a semicolon here. 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-24T23:27:34.850

您在课程结束时缺少一个分号。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-24T23:27:51.340

您的类定义后缺少分号。例如

```
class Line {
 ...
}; 
```

# python - 在 Google App Engine 上分析/优化网站的最佳方式

> ID：679670
> 
> 赞同：15
> 
> 时间：2009-03-24T23:27:38.437
> 
> 标签：python, google-app-engine

我目前正在尝试优化我的网站，该网站在 Google App Engine 上运行。这不是一件容易的事，因为我没有使用任何强大的工具。

有没有人为此目的优化 Python 代码的经验？你找到一个好的 Python 分析器了吗？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-03-25T09:24:50.063

我发现[Gprof2Dot](http://code.google.com/p/jrfonseca/wiki/Gprof2Dot)非常有用。我尝试过的分析模块的输出解释起来非常不直观。

Gprof2Dot 将 cProfile 输出变成一个漂亮的图形，最慢的链（？）突出显示，以及每个函数的一些信息（函数名称、在此函数上花费的时间百分比和调用次数）。

[示例图 (1429x1896px)](http://jrfonseca.googlecode.com/svn/wiki/gprof2dot.png)

我对 App Engine 做的不多，但是在分析非 webapp 脚本时，我倾向于分析运行所有单元测试的脚本，这可能对实际情况不太准确

一种（更好的？）方法是拥有一个执行虚假 WSGI 请求的脚本，然后对其进行分析。

WSGI 是一个非常简单的协议，它基本上是一个带有两个参数的函数，一个带有请求信息，第二个带有回调函数（用于设置标头等）。也许类似于以下内容（这是可能的伪代码）......

```
class IndexHandler(webapp.RequestHandler):
    """Your site"""
    def get(self):
        self.response.out.write("hi")

if __name__ == '__main__':
    application = webapp.WSGIApplication([
        ('.*', IndexHandler),
    ], debug=True)

    # Start fake-request/profiling bit
    urls = [
        "/",
        "/blog/view/hello",
        "/admin/post/edit/hello",
        "/makeanerror404",
        "/makeanerror500"
    ]

    def fake_wsgi_callback(response, headers):
        """Prints heads to stdout"""
        print("\n".join(["%s: %s" % (n, v) for n, v in headers]))
        print("\n")

    for request_url in urls:
        html = application({
        'REQUEST_METHOD': 'GET',
        'PATH_INFO': request_url},
        fake_wsgi_callback
        )
        print html 
```

实际上，App Engine 文档解释了一种更好的分析应用程序的方法：

来自[http://code.google.com/appengine/kb/commontasks.html#profiling](http://code.google.com/appengine/kb/commontasks.html#profiling)：

> 要分析应用程序的性能，首先将应用程序的`main()`函数重命名为`real_main()`. 然后，向您的应用程序添加一个新的 main 函数，`profile_main()`如下所示：
> 
> ```
> def profile_main():
>     # This is the main function for profiling 
>     # We've renamed our original main() above to real_main()
>     import cProfile, pstats
>     prof = cProfile.Profile()
>     prof = prof.runctx("real_main()", globals(), locals())
>     print "<pre>"
>     stats = pstats.Stats(prof)
>     stats.sort_stats("time")  # Or cumulative
>     stats.print_stats(80)  # 80 = how many to print
>     # The rest is optional.
>     # stats.print_callees()
>     # stats.print_callers()
>     print "</pre>" 
> ```
> 
> [...]
> 
> 要使用您的应用程序启用分析，请设置`main = profile_main`. 要正常运行您的应用程序，只需设置`main = real_main`.

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2011-07-24T19:49:08.393

[App Engine Mini Profiler](https://github.com/kamens/gae_mini_profiler)是一种新的嵌入式应用引擎性能工具，它提供 API 调用性能信息（通过 Appstats）和所有函数调用的标准分析数据（通过 cProfiler）

[https://github.com/kamens/gae_mini_profiler](https://github.com/kamens/gae_mini_profiler)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2010-01-03T18:44:41.020

为了分析 API 调用，Guido van Rossum 发布了一个名为 Appstats 的库，该库将记录和显示有关您的应用程序的许多好东西。

您可以在此处获取该库：[https ://sites.google.com/site/appengineappstats/](https://sites.google.com/site/appengineappstats/)

我在我的博客上写了一篇关于它的文章（附有一些截图）：[http ://blog.dantup.com/2010/01/profiling-google-app-engine-with-appstats](http://blog.dantup.com/2010/01/profiling-google-app-engine-with-appstats)

[应用统计 http://blog.dantup.com/pi/appstats_4_thumb.png](http://blog.dantup.com/2010/01/profiling-google-app-engine-with-appstats)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-25T02:59:14.920

python 站点列出了 3 个分析器可供选择：[http ://docs.python.org/library/profile.html](http://docs.python.org/library/profile.html)

# email - 电子邮件发送最佳实践？

> ID：679681
> 
> 赞同：6
> 
> 时间：2009-03-24T23:31:31.627
> 
> 标签：email

标题听起来有点奇怪，但基本上我想知道我应该如何为我正在编写的一些服务器软件设置电子邮件发送？基本上，我发送电子邮件的唯一时间是用户注册帐户或需要重置密码时。高流量网站是否依赖 linux**邮件**应用程序或是否有其他方法（如排队等）？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-25T00:04:02.237

我建议将出站消息保存到数据库，然后对实际传递进行排队，以便另一个专门用于发送电子邮件的应用程序可以处理超时和其他危险——队列将允许您从这些故障中优雅地恢复。

更重要的是，根据您的配置和您使用的消息队列平台的类型，您可以将电子邮件处理外包给另一个或多个服务器，这样它就不会与您的应用程序竞争。并不是说电子邮件特别耗费资源，而是当您忙于扩展时，每一点灵活性都很重要。

最后，另外一个优点是，使用排队消息的单独电子邮件传递应用程序可以为多个应用程序提供服务。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-24T23:34:27.033

这一切都取决于网络主机以及它们为 SMTP 提供的功能。您需要与您的网络主机核对 SMTP IP 或服务器名称。最有可能的是，它们为与您的域关联的电子邮件帐户提供了相同的 POP3 传出 SMTP 信息。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-25T00:29:56.010

一个 linux 服务器应该提供一个名为的程序`sendmail`（尽管它很可能由`exim`or实现`postfix`），这个程序将处理所有的排队、重试等。您将需要提供某种返回地址来处理来自无效地址的退回等等。

如果您的电子邮件需求变得更加复杂，并且如果您控制服务器上安装的内容，您可能需要查看 Daniel J Bernstein 的[qmail](http://en.wikipedia.org/wiki/Qmail)程序，但它的设置是为了帮助复杂的电子邮件负载繁重的用户，您的问题表明你还不在那里。

# java - Oracle：OALL8 处于不一致状态

> ID：679683
> 
> 赞同：8
> 
> 时间：2009-03-24T23:33:15.740
> 
> 标签：java, oracle, jdbc, coldfusion, jrun

作为升级 JRun 的一部分，我们正在从 1.4 JVM 迁移到 1.6 JVM。现在我收到一个非常奇怪的 oracle db 错误：“OALL8 处于不一致状态”。我已经确定了插入根本不使用绑定变量的查询的问题 - 所有内联参数。如果我在没有任何绑定变量的情况下运行查询，则会收到上述错误。一旦我用绑定变量替换了其中一个硬编码值 - 一切都会正常工作。

另一个奇怪的地方是，在执行查询之后，它实际上是提交给数据库的。我可以从另一个会话连接并查看插入的行。我已经尝试将查询包装在事务中，并且它似乎成功了，因为没有显式事务的查询的行为没有改变。

以下是相关细节：

Java 版本：1.6.0_12-b04
虚拟机版本：11.2-b01（HotSpot 服务器）
Oracle 服务器：10.2.0.4
Oracle 客户端：11.1.0.7.0 到 ojdbc6.jar

**更新：**我正在使用 cfqueryparam - 它们在 oracle 世界中被称为绑定变量。虽然这确实解决了眼前的问题，但我们有一个相当大的遗留代码库，作为从 CF7 升级到 CF8 的一部分，我们实际上无法通过所有这些代码库来更新查询。

即使我已经确定了一种失败的特定情况（并将其封装在一个 mxunit 测试中）——这并不意味着没有其他领域可能成为问题。我真的很想有一个解决方案来消除 OALL8 错误，而不是围绕它进行编码。

**更新 2：**在与我们的 DBA 核实后，他将一个名为 CURSOR_SHARING 的参数设置为 SIMILAR。Oracle 默认值为 EXACT。正在发生的事情是当 ColdFusion 将查询交给执行时，Oracle 将所有文字值转换为绑定变量，这似乎使 ColdFusion 感到困惑。将设置转回 EXACT 可以让文字查询正常工作。

**更新 3：** Oracle 终于向我们发布了 JDBC 的带外补丁。它被识别为 JDBC 错误。最新的驱动程序在最终更新时应该包含它。如果您有支持，您还可以通过他们的 TAR 系统请求补丁。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-24T23:47:07.750

所以...使用绑定变量？

无论如何，您都应该使用它们（通过`cfqueryparam`）来确保安全，如果它解决了问题，那就更有理由这样做了。

如果您对实际错误的含义感兴趣，Google 有[很多](http://ramblingabout.wordpress.com/2007/01/22/oall8-is-in-an-inconsistent-state/) [结果](https://students.kiv.zcu.cz/doc/oracle/relnotes.102/b28672/toc.htm)，表明这是 JDBC 驱动程序错误，甚至建议有[补丁](http://www.coderanch.com/t/303240/JDBC/java/Oracle-g-driver-throws-java) [可用](http://asanga-pradeep.blogspot.com/2008/06/oall8-is-in-inconsistent-state-with.html)。

但是我在您的帖子中没有看到实际问题...？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-08-24T15:54:37.697

我发现这个[http://asanga-pradeep.blogspot.com/2008/06/oall8-is-in-inconsistent-state-with.html](http://asanga-pradeep.blogspot.com/2008/06/oall8-is-in-inconsistent-state-with.html)

Oracle 补丁 4390875

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-08-06T07:43:28.677

如果您的应用程序在 weblogic 中运行，您应该将 ojdbc.jar 复制到安装目录 "weblogic81\server\lib" ，覆盖同名文件。

# java - 尝试使用 OCI 连接到 Oracle 时 JVM 崩溃

> ID：679684
> 
> 赞同：3
> 
> 时间：2009-03-24T23:33:34.913
> 
> 标签：java, oracle, oracle10g, oracle-call-interface

我有三台机器设置如下：

*   CompA：运行 Oracle 服务器 10.2.0.3
*   CompB：运行 Oracle 服务器 10.2.0.4 和我的客户端代码
*   CompC：仅运行客户端代码

在 CompB 和 CompC 上的客户端代码上，使用 Thin 驱动程序连接到任一 Oracle DB 都可以完美运行。

我正在尝试使用 OCI 驱动程序从客户端代码连接到每个 Oracle DB

```
Connection conn = DriverManager.getConnection('jdbc:oracle:oci:username/pass@sid'); 
```

从在 jboss 中运行的 Java 类内部。这在 CompB 上工作得很好，但会导致运行 Jboss 的 JVM 每次在 CompC 上进行核心转储。

CompC 可以使用 Sql*Plus 和 jboss 试图引用的同一 tnsnames.ora 文件连接到两个 Oracle 服务器。

这是堆栈跟踪的一部分。它似乎每次都是一致的。

```
堆栈：[0x30fcc000,0x3101d000)，sp=0x3101a868，可用空间=314k
本机帧：（J=编译的 Java 代码，j=解释的，Vv=VM 代码，C=本机代码）
V [libjvm.so+0x2d02d6]
C [libocijdbc10.so+0x585c]
C [libocijdbc10.so+0x70a8] Java_oracle_jdbc_driver_T2CConnection_t2cCreateState+0x15c
j oracle.jdbc.driver.T2CConnection.t2cCreateState([BI[BI[BI[BISI[S[B[B]I+0]
j oracle.jdbc.driver.T2CConnection.logon()V+551
j oracle.jdbc.driver.PhysicalConnection.(Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;Ljava/util/Properties;Loracle/jdbc/driver/OracleDriverExtension;)V +381
j oracle.jdbc.driver.T2CConnection.(Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;Ljava/util/Properties;Loracle/jdbc/driver/OracleDriverExtension;)V +10
j oracle.jdbc.driver.T2CDriverExtension.getConnection(Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;Ljava/util/Properties;)Ljava/sql/Connection;+67
j oracle.jdbc.driver.OracleDriver.connect(Ljava/lang/String;Ljava/util/Properties;)Ljava/sql/Connection;+831
j java.sql.DriverManager.getConnection(Ljava/lang/String;Ljava/util/Properties;Ljava/lang/ClassLoader;)Ljava/sql/Connection;+210
j java.sql.DriverManager.getConnection(Ljava/lang/String;)Ljava/sql/Connection;+15

```

有谁知道这里出了什么问题？

更新：为澄清起见，上面使用的“客户端”指的是我在 jboss 实例中运行的 java 代码。应该在 jboss 启动的 LD_LIBRARY_PATH 中找到的唯一 Oracle 库是 libocijdbc10.so libclntsh.so.10.1 和 libnnz10.so。这三个库和 jboss 服务器本身都在源代码控制中，因此它们在 CompB 和 CompC 上是相同的版本。

CompB 可以使用 OCI 和 Thin 连接到 CompA 和 CompB。CompC 无法使用 OCI 连接，但可以使用 Thin 连接到 CompA 和 CompB，因此它不应该是服务器版本问题。

CompB 和 CompC 都运行 32 位 Ubuntu 8.04，但 CompC 的 CPU 稍慢，只有 1GB 的 RAM，而 CompB 的 RAM 为 3.25GB。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-25T03:00:14.153

好吧，我刚看完一集豪斯，所以让我们在这里尝试鉴别诊断。您知道它适用于两台机器的 Thin 驱动程序，但它在 JBoss 代码中已过期。您不能肯定地说（“客户端”不是很确定），但看起来您在 CompB 和 CompC 上有一个 JBoss 实例，并且当它在 CompB 上的 JBoss 实例中运行但核心转储时，您的代码运行愉快来自 CompC。

从设置中，我推断当您在 CompB 上运行时，您正在与 CompB 上的 Oracle 实例通信。您是否尝试过在 CompB 上运行代码但与 CompA 交谈？您是否尝试在 CompC 上运行代码，但在 CompB 上与 Oracle 通信？

实际错误表明 dynlib 模块“libocijdbc10.so”中的本机代码出现错误，我们知道您在 CompA 和 CompB 上有不同版本的 Oracle 内容。所以我的第一个怀疑是你在两台机器上的 libocijdbc10.so 版本不兼容。我观察到您在 CompA 和 CompB 上有不同版本的 Oracle。我预测 CompB 上与 CompA 的预言机对话的代码将失败，而 CompC 上与 CompB 对话的代码将运行。

您想检查 CompB 和 CompC 上的 Oracle OCI 驱动程序软件的版本。

### 更新

好吧，你说：

> CompB 可以使用 OCI 和 Thin 连接到 CompA 和 CompB。CompC 无法使用 OCI 连接，但可以使用 Thin 连接到 CompA 和 CompB，因此它不应该是服务器版本问题。

所以，你已经缩小了范围。三种连接方法（Thin、SQL*Plus 和 OCI）和三台服务器，唯一失败的是使用 CompC 的 OCI；无法与 CompA 和 CompB 通话。

它遵循的问题是 CompC JBoss 上的配置问题。*在*Oracle 提供的驱动程序中它仍然失败；由于在 CompB 上运行时，相同的代码对 CompA 和 CompB 起作用，因此它必须是 CompC 问题，而不是代码中的问题。

所以

1.  对来自 CompB 和 CompC 的驱动程序库运行*cmp(1)并确认它们是相同的。*
2.  如果不是，则将 CompB 中的驱动程序 rcp 到 CompC 上并进行测试。
3.  找出配置控制出了什么问题。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-25T21:49:34.750

放弃本机 OCI 驱动程序 - 这是一个永无止境的头痛。

使用纯 java 驱动程序——它更稳定、更快并且使用更少的内存。

# iphone - 加载 Youtube 视频时出现问题

> ID：679685
> 
> 赞同：0
> 
> 时间：2009-03-24T23:34:25.660
> 
> 标签：iphone

我正在尝试从 UIWebView 启动嵌入式 Youtube 视频，但是从手机中选择它们时在控制台中出现此错误：

警告：无法读取“/Developer/Platforms/iPhoneOS.platform/DeviceSupport/2.2/Symbols/System/Library/Internet Plug-Ins/YouTubePlugIn.webplugin/YouTubePlugIn”的符号（找不到文件）。

URL 很好，因为我可以从 Safari 播放它。

有人有问题吗？

## 更新：

伙计，我总是对这个论坛的响应速度印象深刻。

无论如何，这是我在网上找到并调整的嵌入代码：

```
- (void)embedYouTube {
NSString* embedHTML = @"\
<html><head>\
<style type=\"text/css\">\
body {\
background-color: transparent;\
color: white;\
}\
</style>\
</head><body style=\"margin:0\">\
<embed id=\"yt\" src=\"%@\" type=\"application/x-shockwave-flash\" \
width=\"%0.0f\" height=\"%0.0f\"></embed>\
</body></html>";
CGRect frame;
frame.size.width=100; frame.size.height=80;
frame.origin.x=10; frame.origin.y=10;
NSString *url=@"http://www.youtube.com/watch?v=g8thp78oXsg";
NSString* html = [NSString stringWithFormat:embedHTML,url, 100, 80];
UIWebView *videoView = [[UIWebView alloc] initWithFrame:frame];
[videoView loadHTMLString:html baseURL:[NSURL URLWithString:nil]];
[self.view addSubview:videoView];
[videoView release];
NSLog(@" in embed %@",html);
} 
```

我将示例 URL 放在上面的“url”中，以显示我正在使用的 URL（哇，很多 url）。

## 更新 2：

所以我什至去了这个网址：

[http://apiblog.youtube.com/2009/02/youtube-apis-iphone-cool-mobile-apps.html](http://apiblog.youtube.com/2009/02/youtube-apis-iphone-cool-mobile-apps.html)

并在此处复制了他们的示例代码：

```
[[UIApplication sharedApplication] openURL:[NSURL URLWithString:@"http://www.youtube.com/v/oHg5SJYRHA0&f=gdata_videos&c=ytapi-my-clientID&d=nGF83uyVrg8eD4rfEkk22mDOl3qUImVMV6ramM"]]; 
```

从 2009 年 2 月 5 日写的那篇文章中，它启动了 Youtube 播放器，但我得到“Youtube 不可用”。

我尝试了 Youtube 帖子，但没有回应。任何人都知道如何让这个简单的功能发挥作用吗？或者这可能与我的 iPhone 有关？

* * *

伙计，我总是对这个论坛的响应速度印象深刻。

无论如何，这是我在网上找到并调整的嵌入代码：

```
- (void)embedYouTube {
NSString* embedHTML = @"\
<html><head>\
<style type=\"text/css\">\
body {\
background-color: transparent;\
color: white;\
}\
</style>\
</head><body style=\"margin:0\">\
<embed id=\"yt\" src=\"%@\" type=\"application/x-shockwave-flash\" \
width=\"%0.0f\" height=\"%0.0f\"></embed>\
</body></html>";
CGRect frame;
frame.size.width=100; frame.size.height=80;
frame.origin.x=10; frame.origin.y=10;
NSString *url=@"http://www.youtube.com/watch?v=g8thp78oXsg";
NSString* html = [NSString stringWithFormat:embedHTML,url, 100, 80];
UIWebView *videoView = [[UIWebView alloc] initWithFrame:frame];
[videoView loadHTMLString:html baseURL:[NSURL URLWithString:nil]];
[self.view addSubview:videoView];
[videoView release];
NSLog(@" in embed %@",html);
} 
```

我将示例 URL 放在上面的“url”中，以显示我正在使用的 URL（哇，很多 url）。

* * *

所以我什至去了这个网址：

[http://apiblog.youtube.com/2009/02/youtube-apis-iphone-cool-mobile-apps.html](http://apiblog.youtube.com/2009/02/youtube-apis-iphone-cool-mobile-apps.html)

并在此处复制了他们的示例代码：

```
[[UIApplication sharedApplication] openURL:[NSURL URLWithString:@"http://www.youtube.com/v/oHg5SJYRHA0&f=gdata_videos&c=ytapi-my-clientID&d=nGF83uyVrg8eD4rfEkk22mDOl3qUImVMV6ramM"]]; 
```

从 2009 年 2 月 5 日写的那篇文章中，它启动了 Youtube 播放器，但我得到“Youtube 不可用”。

我尝试了 Youtube 帖子，但没有回应。任何人都知道如何让这个简单的功能发挥作用吗？或者这可能与我的 iPhone 有关？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-07-22T17:07:52.490

这是不久前的事，但我还添加了无关字符，并且我的嵌入代码已更改。

另外，要注意一些视频要么不可用，要么尚未转换为 h.264，等等。

我仍然收到错误（即）：

警告：无法读取“/Developer/Platforms/iPhoneOS.platform/DeviceSupport/3.2.1 (7B405)/Symbols/System/Library/Internet Plug-Ins/YouTubePlugIn.webplugin/YouTubePlugIn”的符号（找不到文件）。

但是，如果可以播放视频，它们仍然会播放。所以我认为无法找到符号库控制台消息的事实是插件启动之前抛出的“红鲱鱼”。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-24T23:38:41.687

很有意思。不知道 Mobile Safari 有一个插件架构。

我认为您的问题可能是双重的。

1.  您加载 URL 的方式导致 UIWebView 尝试生成此插件，该插件不适用于 UIWebView，仅适用于 Mobile Safari。

2.  您尝试播放的 URL 不是 iPhone 支持的文件类型。你说它在 Safari 中播放，所以它可能不是 2，而是 1 的某个版本。

如果您发布代码，也许我们可以更有帮助地进行调试。

祝你好运！

# wpf - 为什么 ASP.NET MVC 仅限于 ASP？

> ID：679692
> 
> 赞同：7
> 
> 时间：2009-03-24T23:37:02.517
> 
> 标签：wpf, asp.net-mvc

### 复制

> [用于桌面的 MVC .NET？](https://stackoverflow.com/questions/326839/mvc-net-for-the-desktop)

我开发了一些 ASP.NET MVC 应用程序，并且喜欢这个框架。但是，我不太明白的一件事是为什么它仅限于 Web UI。*视图和控制器分离的原因*之一似乎是允许多个视图重用相同的控制器逻辑。例如，我应该能够将 WPF UI 挂在与 Web UI 相同的控制器上。不过，我怀疑我误解了关于关注点分离的一些基本问题。ASP.NET MVC 控制器仅限于在 Web 应用程序中使用是否有原因？

更新：我对“是否可以在桌面上执行 MVC”不太感兴趣 - 我知道 Prism 等允许这样做。然而，从设计的角度来看，我们想要分离关注点的“原因”之一是为了可重用性。如果我们不能重用控制器，在 WPF 应用程序中重写相同的逻辑时，感觉就像是在重复自己。不过，下面的答案确实为我澄清了一些。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-25T00:05:15.040

不得不说 MVC 模型在 web 应用中特别实用，那是因为视图（html 页面）确实是断开的，并且远离控制器和模型。

在桌面应用程序中，情况并非如此，您很快就会错过一些打破模式以使应用程序更有用的机会。
例如，您不能在 WPF 中执行功能强大且节省时间的数据绑定，因为它破坏了 MVC 模式。

WPF 中使用的一个很好的模式是[MV-VM](http://karlshifflett.wordpress.com/2008/11/08/learning-wpf-m-v-vm/)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-24T23:49:38.370

Model View Controller 是一种模式，ASP.NET MVC 是应用于 ASP.NET 的 web 框架的模式。正如它所提到的，这将 url 路由与事物联系起来，使导航更简单，更完整地与动作的调用方式联系起来。

也就是说，在技术上没有什么能阻止您使用 ASP.NET MVC 库中的组件。通过 LINQ 或实体的数据访问层在 ASP.NET MVC 之外可用。同样，该模式本身也有无数的 Winforms 应用程序实现示例。相同的技术可以应用于 WPF。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2010-03-26T15:23:19.913

我知道这说起来很容易，但是如果您很好地实现了数据访问层和业务对象，则可以重用大部分代码。

我们正在使用 ASP.NET MVC。我们有一个单独的项目，其中有我们的业务对象和数据访问层。我们在 Web 项目中的“模型”通常是我们业务对象的轻量级包装器。

我们的控制器方法都非常轻量级，因为在数据访问层和我们的业务对象之间，我们封装并简化了呈现给消费者的大部分业务逻辑。

一旦我们构建了 MVC 应用程序，我们想在 WPF 应用程序中使用我们的一些数据（用于状态显示屏幕）。我们刚刚创建了一个新项目，引用了我们的数据访问层和数据模型，然后我们就离开了。非常简单，并且有大量的代码重用。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-25T00:06:47.423

我不会说你完全误解了关注点分离，事实上你的问题表明你很好地理解了它。

“ASP.NET MVC”这个名字表明微软做出了一个明智的决定，即为基于 w3eb 的应用程序创建一个更专业的 MVC 实现。这使他们能够优化设计，以提高开发人员构建基于 Web 的应用程序和服务的效率。

如果他们创建了一个更通用的“.NET MVC”框架，我预计它将需要在 Web 应用程序与桌面应用程序的需求之间进行更困难的权衡。

就个人而言，我认为 Microsoft 的方法可能会让经验不足的开发人员更加困惑，他们经常认为模式的实现*就是*模式。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-24T23:46:29.843

ASP.NET MVC 是一个用 ASP.NET 做 MVC 的框架；它包括诸如 URL 路由之类的东西。您可以使用 WPF 和 WinForms 很好地进行 MVC（模型-视图-控制器）样式编程。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-24T23:48:13.973

[这是](https://stackoverflow.com/questions/326839/mvc-net-for-the-desktop)我之前尝试过的类似问题 - 让我们看看这次我们想出了什么。

这个问题的另一个方面是，为什么 VS 在可用于 .NET 桌面和 asp.NET 开发的抽象设计工具方面几乎没有？

# c# - 是否可以发布取自 .net 框架并在线修改的代码？

> ID：679695
> 
> 赞同：8
> 
> 时间：2009-03-24T23:38:16.807
> 
> 标签：c#, .net, thread-safety

我使用反射器查看通用字典集合 (Dictionary<TKey, TValue>) 的代码并修改该代码以使其线程安全。我想在我的博客上发布这段代码，以便其他人可以查看它（如果我做错了什么，请告诉我），如果他们愿意，也可以在他们的项目中使用它。从法律上讲，我可以这样做吗？我大量修改了原始代码（并且只从原始代码中获取了一些方法，而不是全部）但基本代码仍然相同，如果我这样做会不会有任何潜在的法律问题？

注意：以防万一有人指向我线程安全字典的实现，我知道已经有使用 ReaderWriterLockSlim 的线程安全字典的实现，但我不希望在读取时（仅在写入时）进行任何锁定，除了我'我使用 .net 2.0 而不是 3.5，所以无论如何我都不能使用 ReaderWriterLockSlim，而且我在某处读到 ReaderWriterLock 在 2.0 中的性能非常差，所以我不想使用它。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-24T23:52:19.313

Microsoft 的 Dictionary 源代码由[Microsoft Reference Source License 的修改版本管理](http://referencesource.microsoft.com/netframeworklicense.aspx)，它基本上只允许您阅读代码。所以不，您绝对不允许在此许可下重新分发修改后的代码。

另一方面，您可以采用[Mono 的 Dictionary<K,V> 实现](http://anonsvn.mono-project.com/viewvc/trunk/mcs/class/corlib/System.Collections.Generic/Dictionary.cs?content-type=text%2Fplain&view=co)并对其进行修改以满足您的需求，因为它在 MIT/X11 下获得许可。[与 .net 中的相比，](http://codebetter.com/blogs/patricksmacchia/archive/2008/10/29/collections-and-performances.aspx)它的性能相当好。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-24T23:41:20.200

除非 .NET 框架以源代码形式发布，并且在允许您进行和分发此类修改（通常称为衍生作品）的许可下发布，否则，不，您现在可以这样做。

虽然 .NET 框架的部分源代码[已经发布](http://weblogs.asp.net/scottgu/archive/2007/10/03/releasing-the-source-code-for-the-net-framework-libraries.aspx)，但它们仅在[参考许可](http://www.microsoft.com/resources/sharedsource/referencesourcelicensing.mspx)下可用。直接从那个页面；

> Microsoft 参考源代码许可证 (Ms-RSL) 是 Microsoft 源代码许可证中限制性最强的。许可证禁止所有源代码的使用，除了出于参考目的查看代码。该许可的目的是使许可人能够发布更敏感的知识产权资产，仅用于审查目的。

如果您希望提供自己的线程安全字典集合，那很好，而且绝对是一个崇高的目标，但是您不能将其基于您无权修改的内容。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-24T23:53:30.950

首先，请咨询律师-我不是律师，所以请对我所说的话持保留态度。此外，此建议将以美国/西欧为中心，因为这些是我最了解的法律。

话虽如此....

从技术上讲，你甚至不能做你做过的事情。.NET Framework 被许可作为操作系统的补充。如果您阅读 .NET 2.0 的 EULA，它包括：

`Microsoft Corporation (or based on where you live, one of its affiliates) licenses this supplement to you. If you are licensed to use Microsoft Windows operating system software (the “software”), you may use this supplement. You may not use it if you do not have a license for the software. You may use a copy of this supplement with each validly licensed copy of the software.`

Windows Vista/XP 的许可证根据 .NET Framework 附带的 EULA 确定您的合法权利。

这会阻止您执行此操作。尤其是：

从 Windows Vista 许可协议：

`You may not`

 `· work around any technical limitations in the software` 

`· reverse engineer, decompile or disassemble the software, except and only to the extent that applicable law expressly permits, despite this limitation`

这是他们的前两点——这两点听起来你都在尝试。重新分配包含在条款的后面。有关完整的详细信息，[请阅读您的操作系统的许可证](http://www.microsoft.com/about/legal/useterms/default.aspx)。

# .net - 是否可以从 ASP.Net 中的字符串创建页面？

> ID：679700
> 
> 赞同：1
> 
> 时间：2009-03-24T23:40:09.873
> 
> 标签：.net, asp.net, virtualpathprovider

我可以从一个文件创建一个页面：

```
Page page = BuildManager.CreateInstanceFromVirtualPath(
    virtualPath, typeof(Page)) as Page; 
```

如何从流或字符串中实例化页面？

谢谢你。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-24T23:59:34.913

您可以创建自己的[VirtualPathProvider](http://msdn.microsoft.com/en-us/library/system.web.hosting.virtualpathprovider.aspx)，它位于 ASP.NET 解析器和文件系统之间。ASP.NET 中的默认提供程序从磁盘读取 ASPX 标记，但您可以创建自己的提供程序以从任何位置（SQL、流、字符串等）读取它。

本质上，它的工作原理是自定义 VirtualPathProvider 类接管了虚拟路径的处理，例如“~/MyPage.aspx”（您必须将其传递给 BuildManager）。它提供了用于决定如何处理“~/MyPage.aspx”的自定义逻辑，其中可能包括返回存储在内存中的字符串或流中的数据。

以下是一些帮助您入门的阅读材料：

*   [如何使用虚拟路径提供程序从 ASP.NET 2.0 中的虚拟路径动态加载和编译内容](http://support.microsoft.com/kb/910441)
*   [使用 VirtualPathProvider 覆盖 ASP.NET 组合行为](http://blogs.msdn.com/davidebb/archive/2005/11/27/497339.aspx)
*   [虚拟化对内容的访问：从 ZIP 文件为您的网站提供服务](http://msdn.microsoft.com/en-us/library/aa479502.aspx)（一个很好的例子，使用相同的概念来做一些不同且相当有趣的事情）

# php - 使用 PHP 将 POST 数据从一个网页传递到另一个网页

> ID：679701
> 
> 赞同：7
> 
> 时间：2009-03-24T23:40:32.713
> 
> 标签：php, post

搜索没有找到类似的问题，所以：PHP生成一个页面使用的POST数据如何从那个页面传递到另一个PHP生成的页面？我有：

*   第 1 页上的表单，通过 POST 将数据发送到 PHP 脚本。
*   第 2 页由该脚本生成，并显示由外部程序使用第 1 页上的条目和后端数据库生成的一个或多个图形。此页面还有另一种形式，其中包含使用新选项重新生成图形的选项（例如放大或截断图形）。
*   如果需要，页面 3 将使用从页面 1 和页面 2 粘合在一起的 POST 数据使用相同的 PHP 脚本生成。除了图表，其基本外观将与页面 2 相同。
*   第 4、5、6 ... 应以与第 3 页相同的方式生成。

那么，如何将用于生成第 2 页的 POST 数据放入第 3 页的 POST 数据中呢？

编辑：由于组织政策，无法使用 cookie（因此会话不可行）。GET 是不可取的，因为我们不希望输入显示在 URL 中。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-03-24T23:42:18.777

我记得很久以前就在这个问题上苦苦挣扎，想知道为什么我根本无法使用修改后的 POST 标头进行重定向。原因是重定向实际上被认为是 GET。

无论如何，您需要将帖子变量存储在隐藏字段中。

```
<input type="hidden" name="someValueFromPageOne" value="blah"> 
```

我建议在每个表单中为所有字段名称添加前缀，以便在最后的合并阶段轻松区分它们。

```
<input type="hidden" name="pageOne_firstName" value="Joe">
<input type="hidden" name="pageTwo_streetNumber" value="22"> 
```

编辑：正如其他人所提到的，使用会话持久化数据是一种可能性，但这成为维护临时状态的非常复杂的问题，例如页面刷新或使用后退按钮可能难以维护。除非您面临极端情况，否则使用字段保存数据要容易得多，因为它们更容易在刷新和其他浏览器行为中存活。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-27T03:44:15.233

Wez Furlong 最近在他的博客上写了 php5 版本（标题为 HTTP post from php, without cURL）：

```
function do_post_request($url, $data, $optional_headers = null)
{
$params = array('http' => array(
'method' => 'post',
'content' => $data
));
if ($optional_headers!== null) {
$params['http']['header'] = $optional_headers;
}
$ctx = stream_context_create($params);
$fp = @fopen($url, 'rb', false, $ctx);
if (!$fp) {
throw new Exception("Problem with $url, $php_errormsg");
}
$response = @stream_get_contents($fp);
if ($response === false) {
throw new Exception("Problem reading data from $url, $php_errormsg");
}
return $response;
} 
```

在帖子中，他提到他总是必须查找如何做到这一点。有趣的是，他是核心开发人员之一！

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-24T23:42:56.810

使用 GET。

在我看来，POST 请求应该修改一些东西（例如向数据库添加记录）。GET 请求应该检索一些东西（例如搜索查询的结果）。

如果您仍然想使用 POST，请查看 PHP 会话。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-24T23:51:09.940

会话是一种痛苦，如果你需要它们，你已经实现了它们。

正如@Soviut 上面所说，隐藏的输入字段可能是解决这个问题的方法。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-25T00:05:12.763

如果您决定使用 dbms 选项来取消会话路由，我很幸运地设计了一个状态类来保存这些内容，并使用 JSON 将对象序列化到会话记录中的单个大字段中。

# javascript - 哪些 html 标签支持 onload/onerror javascript 事件属性？

> ID：679704
> 
> 赞同：22
> 
> 时间：2009-03-24T23:42:15.313
> 
> 标签：javascript, html, onload, onerror

我熟悉 的典型用法`onload`，如下所示：

```
<body onload="alert('Hello, World!');">
...
</body> 
```

触发加载事件的所有 html 元素是什么？（因此执行 onload 属性中提供的 javascript）

例如，一个这样的标签会在加载时`img`执行`onload`属性中提供的 javascript：`some.png`

```
<img onload="someImgLoaded()" src="some.png" /> 
```

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-03-24T23:45:20.750

以下 HTML 标记支持“onload”：

> `<body>, <frame>, <frameset>, <iframe>, <img>, <link>, <script>`

以及以下 Javascript 对象：

> `image, layer, window`

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2013-09-30T11:19:01.790

以下是在请求的资源完成下载时触发​​加载事件的更全面的元素列表：

```
body # (just fires a load event, doesn't make requests itself)
img
image
link
iframe
frameset
frame
script
embed
object
video ?
  source
  track
audio ?
  source
svg
<input type="image" src="submit.gif" alt="Submit">
<object width="400" height="400" data="helloworld.swf"></object>
<map name="planetmap">
  <area shape="rect" coords="0,0,82,126" href="sun.htm" alt="Sun">
webgl? 
```

为了获得最大的覆盖率，最好考虑到所有引用 url 的 html 元素都会产生一个请求，并在该请求成功或失败时触发一个`load`or事件。`error`所以，基本上，任何具有`src`or`href`属性的元素，除了这些标签：

```
a
# What else? Not sure off hand.. 
```

并且包括`body`标签，因为具有讽刺意味的是它没有`src`OR`href`属性。

下面是一些用于发现这些元素的粗略 JavaScript：

```
var tagsToIgnore = ['a'];

['src', 'href'].forEach(function(attr) {
  console.log('====' + attr + '====');
  [].slice.call(document.querySelectorAll('*[' + attr + ']')).forEach(function(el){
    if (!~tagsToIgnore.indexOf(el.tagName.toLowerCase())) {
      console.log(el.tagName);
    }
  });
});
console.log('body # :trollface:'); 
```

此外，使用“使用 src 或 href 的所有内容”方法，您会忽略不相关的或其他通常具有 src 或 href 属性的标签，但并非总是如此。

其他可能导致网络故障的事情：

*   应用程序缓存
*   XMLHttpRequest
*   网络套接字
*   对等连接 (WebRTC)
*   来自：[http ://docs.webplatform.org/w/index.php?search=onerror&fulltext=+&title=Special%3ASearch](http://docs.webplatform.org/w/index.php?search=onerror&fulltext=+&title=Special%3ASearch)

`onload`和`onerror`属性可用于跟踪您的用户是否有活动的互联网连接，这是我试图通过我的库 check-online.js 解决的问题：http: [//github.com/devinrhode2/check-在线的](http://github.com/devinrhode2/check-online)

有一些明显的测试要做，看看是否

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-24T23:43:58.493

`onload`是特定于`body`、`frame`、`iframe`、`img`、`link`和`script`元素的事件。基本上任何代表要加载的资源的东西。对于`body`，那是有问题的文件。对于其他人来说，每一个都相当明显。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-24T23:46:11.047

许多元素都有 onload 事件。你可以在[这里找到它们](http://www.w3schools.com/tags/ev_onload.asp)

但是如果你想测试 DOM 的加载，那么最好使用[window.onload](https://developer.mozilla.org/En/DOM/Window.onload)。还建议您将 javascript 代码与 HTML 标记分开。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-24T23:44:03.173

根据[this page](http://www.w3schools.com/jsref/jsref_onload.asp)，您可以使用`onload`：`<body>`、`<frame>`、`<frameset>`、`<iframe>`、`<img>`、`<link>`和`<script>`。

# linux - 导出 rootfs 或 tmpfs

> ID：679724
> 
> 赞同：2
> 
> 时间：2009-03-24T23:49:27.153
> 
> 标签：linux, mount, nfs

是否可以导出（用于 nfs 挂载）tmpfs 或 rootfs 目录？我有许多 linux 节点，它们被引导到一个基于 ram 的文件系统中，只有 rootfs 和 tmpfs。我希望每个节点都能看到其他节点中的一些文件，所以我试图导出一些目录并尝试挂载到另一个节点上。我在 nfs 服务器的 /var/log/messages 中看到以下错误 - rpc.mountd: getfh failed: No such file or directory

我读过不能导出 tmpfs。rootfs 也一样吗？我有什么选择？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-25T18:40:37.887

`rootfs` **是** `ramfs`或`tmpfs`，取决于内核版本和配置。

`ramfs`不能通过 NFS 导出。但是，通过 NFS 导出`tmpfs`对我有用，并且应该：它已经在主线中使用多年了。 [91828a405ae454a9503c41a7744f6ff877a80714](http://git.kernel.org/?p=linux/kernel/git/torvalds/linux-2.6.git;a=commit;h=91828a405ae454a9503c41a7744f6ff877a80714)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-25T04:34:21.913

这不是一个编程问题，并且确实属于其他地方（就像 Jeff 抛出开关时的 serverfault.com），但是谷歌搜索“linux nfs root”会出现[以下内容](http://www.faqs.org/docs/Linux-mini/NFS-Root.html)，这应该可以帮助您入门。

# prolog - Prolog 家谱

> ID：679728
> 
> 赞同：11
> 
> 时间：2009-03-24T23:51:48.427
> 
> 标签：prolog

我做到了，但没有显示答案当我问起兄弟姐妹，叔叔阿姨时

这是我写的，有什么问题吗？

```
/*uncle(X, Y) :– male(X), sibling(X, Z), parent(Z, Y).*/
/*uncle(X, Y) :– male(X), spouse(X, W), sibling(W, Z), parent(Z, Y).*/

uncle(X,Y) :-
  parent(Z,Y), brother(X,Z). 

aunt(X,Y) :-
  parent(Z,Y), sister(X,Z). 

sibling(X, Y) :-
      parent(Z, X),
      parent(Z, Y),
      X \= Y.

sister(X, Y) :-
      sibling(X, Y),
      female(X).

brother(X, Y) :-
      sibling(X, Y),
      male(X).

parent(Z,Y) :- father(Z,Y).
parent(Z,Y) :- mother(Z,Y).

grandparent(C,D) :- parent(C,E), parent(E,D).

aunt(X, Y) :– female(X), sibling(X, Z), parent(Z, Y).
aunt(X, Y) :– female(X), spouse(X, W), sibling(W, Z), parent(Z, Y).

male(john).
male(bob).
male(bill).
male(ron).
male(jeff).

female(mary).
female(sue).
female(nancy).

mother(mary, sue).
mother(mary, bill).
mother(sue, nancy).
mother(sue, jeff).
mother(jane, ron).

father(john, sue).
father(john, bill).
father(bob, nancy).
father(bob, jeff).
father(bill, ron).

sibling(bob,bill).
sibling(sue,bill).
sibling(nancy,jeff).
sibling(nancy,ron).
sibling(jell,ron). 
```

还有一件事，我如何优化兄弟的规则，使 X 不是自己的兄弟。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-25T00:14:03.070

如果您尝试复制图表，您的某些公理似乎是错误的或缺失的。

失踪：

```
female(jane).

father(john, bob). 
```

错误的：

```
father(john, sue). 
```

这可能会导致兄弟规则发生冲突。但是我对prolog了解多少

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-25T00:15:08.357

你的兄弟规则已经验证了它`brother(bob, bob)`会失败，因为它调用`sibling(X, Y)`了 ，它已经进行了检查以确保`X \= Y`。

此外，看起来好像一切都在我的机器上运行，但我不得不更改这些行上的破折号：

```
aunt(X, Y) :– female(X), sibling(X, Z), parent(Z, Y).
aunt(X, Y) :– female(X), spouse(X, W), sibling(W, Z), parent(Z, Y). 
```

至：

```
aunt(X, Y) :- female(X), sibling(X, Z), parent(Z, Y).
aunt(X, Y) :- female(X), spouse(X, W), sibling(W, Z), parent(Z, Y). 
```

是的，它们看起来相同，但顶级版本中的破折号稍长......当我“咨询”文件时似乎会引起问题。

我之所以注意到这一点，是因为我为 Notepad++ 创建了一个 Prolog 配色方案，如果有人感兴趣，我可以在线发布。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-20T20:52:10.333

为 X 优化兄弟的规则并不是自己的兄弟。

你应该做：

```
brother(X, Y) :-
      sibling(X, Y),
      male(X),
      not X=Y. 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2013-10-11T07:39:32.743

您有一个强大的事实数据库和一个非常重要的谓词，称为`parent(X,Y)`. 从逻辑上思考这种方法。

*   谁是兄弟姐妹：
    a) 男性/女性，因此`male(X)`or`female(X)`必须在谓词内
    b) X 和 Y 具有相同的含义，但要小心使用`mother`or`father`函数，否则结果将显示两次。
    PS：确定`X/=Y`。=)

前任。：
`brother(X,Y):- X/=Y, male(X), father(Father,X), father(Father,Y).`

*   谁是叔叔/阿姨（有点棘手，但不是很多）：
    a）是男性/女性。
    b) 阿姨/叔叔是兄弟姐妹的妈妈或爸爸的姐妹/兄弟。

前任。：
`aunt(X,Y):- female(X), parent(Parent,Y),sister(X,Parent).`

PS：阿姨也可以算是兄弟的爸爸妈妈（叔叔的妻子）的兄弟的妻子。但在这种情况下，您需要引入一个新的事实来表达 a `married_couple`。

`aunt(X,Y):- female(X),
parent(Parent,Y),
(sister(X,Parent); (brother(Parent,Uncle),married_couple(Uncle,X))).`

希望这有效；）

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2016-05-10T16:33:59.133

你的 aunt/2 谓词没有放在一起，因此 Prolog 假设 grandparent/2 是 aunt/2。像下面这样将它们放在一起或使用

```
:- discontiguous(aunt/2). 
```

您使用配偶/2，但不定义它。此外，Prolog 假设某处应该有一个兄弟/2 谓词并使用父亲/2。这样做是因为您在 KB 的底部定义了兄弟姐妹列表。再次，将它们放在一起，如下所示。

就像其他答案中所述，您可以使用 not(X = Y)。

```
parent(Z,Y) :- father(Z,Y) ; mother(Z,Y).

sibling(bob,bill).
sibling(sue,bill).
sibling(nancy,jeff).
sibling(nancy,ron).
sibling(jell,ron).

sibling(X,Y) :-
    parent(A,X),
    parent(A,Y),
    not(X = Y).

sister(X, Y) :-
      sibling(X, Y),
      female(X),
      not(X = Y).

brother(X, Y) :-
      sibling(X, Y),
      male(X),
      not(X = Y).

grandparent(C,D) :- parent(C,E), parent(E,D).

aunt(X,Y) :-
  parent(Z,Y), sister(X,Z). 
aunt(X, Y) :- female(X), sibling(X, Z), parent(Z, Y).
% aunt(X, Y) :- female(X), spouse(X, W), sibling(W, Z), parent(Z, Y). 

uncle(X,Y) :-
  parent(Z,Y), brother(X,Z). 

male(john).
male(bob).
male(bill).
male(ron).
male(jeff).

female(mary).
female(sue).
female(nancy).
female(jane).

mother(mary, sue).
mother(mary, bill).
mother(sue, nancy).
mother(sue, jeff).
mother(jane, ron).

father(john, sue).
father(john, bill).
father(bob, nancy).
father(bob, jeff).
father(bill, ron). 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2017-06-05T12:41:12.020

第一的：

将您的事实放在代码的**开头**！

对于兄弟：

```
equal(X,Y) :-
   X=Y.

different(X,Y):-
   not(equal(X,Y)).

brother(X, Y) :-
  sibling(X, Y),
  male(X),
  different(X,Y). 
```

# python - python中的最小堆

> ID：679731
> 
> 赞同：11
> 
> 时间：2009-03-24T23:52:58.550
> 
> 标签：python, object, heap, min-heap

我想通过定义自定义比较函数将一组对象存储在最小堆中。我看到有一个 heapq 模块可用作 python 发行版的一部分。有没有办法在这个模块中使用自定义比较器？如果没有，其他人是否构建了自定义最小堆？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-03-25T00:49:56.757

两个选项（除了 Devin Jeanpierre 的建议）：

1.  在使用堆之前修饰你的数据。这相当于`key=`排序选项。例如，如果您（出于某种原因）想根据其正弦值堆积一个数字列表：

    ```
    data = [ # list of numbers ]
    heap = [(math.sin(x), x) for x in data]
    heapq.heapify(heap)
    # get the min element
    item = heappop(heap)[1] 
    ```

2.  该`heapq`模块是用纯python实现的。您可以将其复制到您的工作目录并更改相关位。快速浏览一下，您必须修改 siftdown() 和 siftup()，如果需要，可能还需要修改 nlargest 和 nsmallest。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-03-25T00:01:28.527

是的，有办法。定义一个实现自定义比较器的包装类，并使用它们的列表而不是实际对象的列表。这是仍然使用 heapq 模块时最好的情况，因为它没有提供 key= 或 cmp= 参数，就像排序函数/方法所做的那样。

```
def gen_wrapper(cmp):
    class Wrapper(object):
        def __init__(self, value): self.value = value
        def __cmp__(self, obj): return cmp(self.value, obj.value)
    return Wrapper 
```

# c# - 在 C# 中格式化电话号码的最快方法是什么？

> ID：679740
> 
> 赞同：24
> 
> 时间：2009-03-25T00:00:00.123
> 
> 标签：c#

使用 c# 使用美国电话格式 [(XXX) XXX-XXXX] 格式化字符串的最快方法是什么？

我的源格式是一个字符串。

* * *

## 回答 #1

> 赞同：52
> 
> 时间：2009-03-25T00:07:22.197

```
String.Format("{0:(###) ###-#### x ###}", double.Parse("1234567890123")) 
```

将导致 (123) 456-7890 x 123

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-03-25T00:06:34.773

这假设您拥有存储有适当位数的电话号码，例如：

```
string p = "8005551234";

string formatedPhoneNumber = string.Format("({0}) {1}-{2}", p.Substring(0, 3), p.Substring(3, 3), p.Substring(6, 4)); 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-03-25T00:29:24.500

这将采用一个包含十位数字的字符串，以任何方式格式化，例如`"246 1377801"`or even `">> Phone:((246)) 13 - 778 - 01 <<"`，并将其格式化为`"(246) 137-7801"`：

```
string formatted = Regex.Replace(
   phoneNumber,
   @"^\D*(\d)\D*(\d)\D*(\d)\D*(\d)\D*(\d)\D*(\d)\D*(\d)\D*(\d)\D*(\d)\D*(\d)\D*$",
   "($1$2$3) $4$5$6-$7$8$9$10"); 
```

（如果字符串不完全包含十位数字，则原始字符串将保持不变。）

编辑：

构建字符串的一种快速方法是使用 StringBuilder。通过将容量设置为最终字符串的确切长度，您将使用相同的字符串缓冲区而不进行任何重新分配，并且 ToString 方法将缓冲区本身作为最终字符串返回。

这假定源字符串仅包含十位数字：

```
string formatted =
   new StringBuilder(14)
   .Append('(')
   .Append(phoneNumber, 0, 3)
   .Append(") ")
   .Append(phoneNumber, 3, 3)
   .Append('-')
   .Append(phoneNumber, 6, 4)
   .ToString(); 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-03-25T00:04:45.400

我会假设它是：

```
var number = string.Format("({0}) {1}-{2}", oldNumber.Substring(0, 3), oldNumber.Substring(3, 3), oldNumber.Substring(6)); 
```

这假设您将号码存储为“1234567890”并希望它是“(123) 456-7890”。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2018-03-19T15:44:17.007

不是最快的方法，但您可以使用扩展方法（注意该参数必须清除任何以前的电话格式）：

```
public static class StringFormatToWhatever
{
    public static string ToPhoneFormat(this string text)
    {        
        string rt = "";
        if (text.Length > 0)
        {            
            rt += '(';
            int n = 1;
            foreach (char c in text)
            {
                rt += c;
                if (n == 3) { rt += ") "; }
                else if (n == 6) { rt += "-"; }
                n++;
            }
        }
        return rt;
    }
} 
```

然后，将其用作

```
myString.ToPhoneFormat(); 
```

如果您愿意，请根据您的需要进行修改：

*   包括电话分机 (x1234)
*   清除方法内任何现有电话格式的参数
*   使用破折号代替括号
*   吃一个三明治......你的名字！:)

您还可以使用它来格式化每个用户输入中的字符串。

# javascript - Javascript 和单选按钮。我如何获得瓦尔斯？

> ID：679741
> 
> 赞同：1
> 
> 时间：2009-03-25T00:00:52.553
> 
> 标签：javascript, jquery

SO和javascript的新手。我已经用 JQuery 玩了几天了，但我遇到了一个似乎无法解决的问题。我完全没有 js 经验，所以如果有人可以通过字面解释问题所在来帮助我，我将不胜感激。

我有一组单选按钮，可以确定用户是管理员还是用户。我可能也把我的 html 搞砸了，但我需要的是当前勾选的值，所以我可以将它保存到数据库中。如果用户是管理员，则值为 1，如果他是用户，则值为 0。

这是我的html：

```
<tr>
<td class="admMarker"><label for="admEmpIsAdmin">Admin</label>&nbsp;<input type="radio" id="admEmpIsAdmin" name="status" value="1" checked="checked" class="admChkbx"></td>
<td class="admMarker"><label for="admEmpIsUser">User</label>&nbsp;<input type="radio" id="admEmpIsUser" name="status" value="0" class="admChkbx"></td>
</tr> 
```

这是javascript：

```
var admEmpIsAdmin = $("input#admEmpIsAdmin").val(); 
```

有人可以告诉我我在这里做错了什么吗？此代码输出 POST vals，但我也想知道是否有人对我有任何建议，说明当它们从数据库中出来时如何从值中显示当前状态。

谢谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-25T00:03:19.367

试试这个：

```
$('input[name=status]:checked').val() 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-25T00:07:44.910

你可以使用类似的东西

```
var value = null;
for(i=0; i<formName.status.length; i++)
    if(form.status[i].checked)
      value = form.status[i].value; 
```

其中*status*是您的输入（收音机）的名称，而*formName*是您的表单名称（不在代码中）。

编辑：为了正确，我已经编辑了答案，因为只有 form.status.value 不起作用（输入是收音机）。而且我很确定它适用于所有浏览器。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-25T00:03:54.653

尝试：

```
var admEmpIsAdmin = $("input#admEmpIsAdmin").is(":checked"); 
```

# php - 在 PHP 中限制用户登录尝试

> ID：679756
> 
> 赞同：6
> 
> 时间：2009-03-25T00:07:41.040
> 
> 标签：php, security, login, captcha, brute-force

我见过对用户登录尝试有限制的网络应用程序。

这是安全必要性吗？如果是，为什么？

例如： *您有 3 次登录尝试失败，让我们在 10 分钟后重试！*

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-25T03:27:57.050

我曾经看到过一种创造性的方法......

对于每次失败的登录尝试，锁定时间都会增加......呈指数级增长。

```
attempt | lockout time
======================
   1    |     2s
   2    |     4s
   3    |     8s
   4    |    16s
   5    |    32s
   6    |    64s
   7    |   128s
   8    |   256s
   9    |   512s
  10    |  1024s 
```

从理论上讲，它会让用户犯一两个错误，但一旦它看起来成为“黑客”尝试，黑客就会被锁定越来越长的时间。

我自己（还）没有使用过这个，但从概念上讲我非常喜欢这个想法。当然，成功登录后，计数器会重置。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-25T00:12:07.083

限制在网站上进行多少次尝试是为了防止暴力（自动）攻击您的网站。如果您不限制这些尝试，黑客可以设置一个脚本来不断猜测密码，直到找到密码，这可能会影响您的 Web 服务器的可用性。

通常，您可能希望在 3 次尝试后让用户超时（如您提到的 10 分钟），并在连续重复尝试 6 或 9 次后将其锁定，迫使用户与您联系以解锁他们的帐户。这是因为有人可以修改他们的脚本来调整你的超时。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-25T00:16:51.267

如果用户可以设置自己的密码，一些 bot/kid 会尝试使用常用密码列表登录，并成功。如果他们不认识任何用户，他们会尝试常用名称，如 admin、simon、rico 等。

仅在会话中标记用户无济于事，因为他们只需删除 cookie 或查询参数即可。您需要计算 IP 和登录名的失败登录尝试次数。也许对 IP 更加宽容，因为它可以在许多用户之间共享。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-25T01:02:19.553

**澄清** *这是对其他答案的补充。例如，使用良好实施的验证码以及使用会话的反暴力机制。
发问者将此标记为已接受，假设机器无法读取验证码（她**几乎**是对的），因此它得到了负面评价，因为人们认为这不是一个完整的答案并且他们是对的。*

* * *

此外，使用良好实施的 CAPTCHA 可能是增强您的应用程序安全性以抵御暴力攻击的另一种方法。有[各种各样的](http://woork.blogspot.com/2009/02/10-free-captcha-scripts-and-services.html)免费验证码提供商，如果您赶时间，让我们试试简单的方法。还请考虑这里[有人](http://www.google.com/search?q=captcha+is+not+safe)说*“哦，不！这个验证码不够安全，有时他们是对的！”* .

> **“对于那些不知道的人来说，CAPTCHA 是一种可以判断其用户是人类还是另一台计算机的程序。它们是您在注册 Gmail 或发表评论时翻译的扭曲文本的小图像在某人的博客上。他们的目的是确保某人不会使用计算机自动注册数百万个在线帐户，或者..” [ref](http://billthelizard.com/2009/03/worst-captcha-ever.html)。**

* * *

 *## 回答 #5

> 赞同：1
> 
> 时间：2009-03-25T01:30:05.913

对于我自己的项目，我编写了一个通用的“洪水控制”库来处理这类事情。

它允许我指定在 X 时间内可以进行多少次尝试。它允许在短时间内进行一定数量的“宽限”尝试，因此只会捕获真正不寻常的行为。

我在数据库中记录了一些东西：

*   IP 地址（或其前 24 位）
*   尝试的操作（即“登录”、“搜索”、“评论”）
*   尝试的时间
*   尝试次数（尝试计数器）

对于每次尝试，我都会查询部分 IP 地址和操作，如果之前的尝试是在某个时间窗口内进行的，那么我会增加该尝试的尝试计数器。如果尝试计数器超过允许的宽限尝试次数，那么我检查最后一次尝试是否在 X 秒内，如果是，则返回 false - 因此该操作将被阻止（并且用户将被告知在尝试前等待 X 秒再次）。如果尝试计数器低于宽限尝试次数，那么我返回 true 并让它滑动。

如果以后有相同IP的人过来，则不会获取之前的尝试计数，因为它太早了。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-25T00:14:20.667

是的，有必要保护帐户免受复杂的蛮力攻击 - 例如使用机器人和字典文件 - 甚至只是试图猜测帐户密码的人。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-25T03:52:47.270

我认为在数据库中放置一个“失败尝试”计数器将是最安全和最简单的方法。这样用户就无法绕过它（通过禁用 cookie）。当然，在成功登录时重置。

您可以按 IP 和/或用户名计数。IP 的优势在于您可以阻止一个人试图入侵多个帐户。如果您按用户名计数，您可以阻止使用服务器场的人，并且不会意外限制同一网络上的人。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2011-08-17T07:54:23.087

在正确登录后重置失败的尝试几乎会使整个系统变得毫无价值。

然后，任何注册用户都可以对其他人的帐户和密码进行三次猜测，然后用他们自己的登录来重置计数器，然后重复——这也可以自动化。例如，普通注册用户可以暴力破解管理员密码。

重置需要由管理员完成，而不是简单地登录成功。

# c++ - 在这种情况下应该使用 C++ 模板吗？

> ID：679759
> 
> 赞同：1
> 
> 时间：2009-03-25T00:09:52.440
> 
> 标签：c++, templates

我有一个类，我的客户用来 Get() 一个数据包。数据包包含一个 std::vector，其类型在我的 Interface 类内部生成数据包之前是未知的（在此示例中，它取决于 Packet::type 变量）。

我想知道模板是否可以用于此，因为 Packet 类只是一个泛型类，其类型几乎可以是任何东西。

据我所知，它的问题是客户端不知道它是什么类型的数据包，直到他得到数据包并查看 Packet::type 成员。所以，这行不通，因为他无法声明 Get() 将返回的变量（？）

在这种情况下可以优雅地使用模板吗？

我能想到的另一种选择是定义一个基类，并为每种类型创建一个子类。然后，Get() 方法可以返回一个指向基类的指针。然后客户端可以简单地查看 Packet::type (packet->type) 并将其转换为适当的子类。但这有点乱？有没有更优雅的解决方案？

下面的代码大致演示了这个场景：

```
enum
{
  T_FLOAT,
  T_COMPLEX
} TYPE_ENUM;

// T can either be of type float or std::complex
template<typename T>
class Packet
{
public:
  TYPE_ENUM       type;
  std::vector<T>  data;
};

class Interface
{

public:
  // Method that client calls to obtain the packet
  Packet<>  Get()
  {
    return queue.pop(); // return current packet in queue
  }

private:
  Queue<Packet>   queue;
}; 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-25T00:16:08.273

模板都是关于**编译时**类型解析的……如果你不能在运行时确定类型，那么你就不适合应用模板。

正如您所描述的，您将需要在最终数据包类型上启用运行时开关。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-25T00:17:00.097

对数据包类型的操作使用抽象基类和虚拟方法。您不需要强制转换数据包类。模板类的集合是有问题的——您将无法从中添加和删除项目。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-25T00:15:09.760

您可能希望创建一个基类，并保留您拥有的模板 Packet 类。调用这个基类 PacketBase。您的 Packet 类将派生自新的 PacketBase 类。也就是说，在编译时生成的每个 Packet<> 类型都将派生自 PacketBase。

```
class PacketBase
{ 
};

// T can either be of type float or std::complex or ...
template<typename T>
class Packet : public PacketBase
{
public:
  std::vector<T>  data;

  //Put other members you need here
  //Note you don't need the type member that you had before. 
}; 
```

Interface::Get 将返回一个 PacketBase*。这里 PacketBase 仅用作包含任何 Packet<> 类型的通用名称。该队列将存储 PacketBase* 的集合。

```
class Interface
{

public:
  // Method that client calls to obtain the packet
  PacketBase*  Get()
  {
    return queue.pop(); // return current packet in queue
  }

private:
  Queue<PacketBase*>   queue;
}; 
```

要确定您拥有哪种类型的数据包，您可以将 RTTI 与 dynamic_cast 结合使用。

```
InterfaceObject o;
//fill the queue
PacketBase *pPacket = o.Get();
if(dynamic_cast<Packet<float> * >(pPacket) != NULL)
   ;//You have a Packet<float>
else if(dynamic_cast<Packet<std::complex> * >(pPacket) != NULL)
   ;//You have a Packet<std::complex>
//... for each Packet<> type you have 
```

您还可以使用一些虚拟方法来增强您的 PacketBase。然后你可以直接调用那些而不是 RTTI dynamic_cast 的东西。

# ruby-on-rails - Starling：如何加快排队速度

> ID：679761
> 
> 赞同：2
> 
> 时间：2009-03-25T00:10:42.827
> 
> 标签：ruby-on-rails, ruby, asynchronous, workling, starling-server

我今天推出了一个网站，它大量使用 Starling 和 Workling 来处理后台任务队列。

流量一直很重，虽然我的服务器 CPU/内存并没有受到太大压力，但作业队列正在严重备份。

我对 Starling 和 Workling 都没有经验，迫切需要了解如何加快队列速度。

这可能是一个非常简单的配置问题，但非常感谢所有建议和想法。

如果您需要更多信息，请告诉我。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-30T11:23:25.493

我最终弄清楚了如何做到这一点，这很简单。只需从命令行启动更多的工作进程 - 可以运行尽可能多的内存。他们都会从一个或多个 Starling 实例中获取工作，如 workling.yml 中所指定。请注意，`:multiple`必须`=> true`在其中`script/workling_client`才能正常工作。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-25T02:46:12.063

如果您有权访问另一台服务器，则可以在服务器之间拆分任务。您可能已经看过它，但 Railscasts 对 Starling 和 Workling 有很好的[介绍](http://railscasts.com/episodes/128-starling-and-workling)。

您还可以在 Google 图书上查看一本书，其中包含更多高级信息：

[实用的 Rails 插件](http://books.google.com/books?id=c1L4IzmUzicC&pg=PA284&lpg=PA284&dq=how+to+distribute+tasks,+starling+and+workling,+rails&source=bl&ots=0LgV4pDjs9&sig=4c6qf1GN59T-BsxGMpYDWU4XKrk&hl=en&ei=d5rJSfX6Gor2sAPzoLH4Bw&sa=X&oi=book_result&resnum=3&ct=result#PPA283,M1)

# asp.net - ASP.NET 登录控制和 ADO.NET 连接池

> ID：679764
> 
> 赞同：0
> 
> 时间：2009-03-25T00:13:18.140
> 
> 标签：asp.net, sql-server, ado.net

将 ASP.NET 2.0 SqlMembershipProvider 与 MSSQL 2005 一起使用。

为了说明问题：

1) 在页面上创建带有 System.Web.UI.WebControls.Login 控件的简单 ASP.NET 应用程序。更改 Web.config 以使用表单身份验证和 System.Web.Security.SqlMembershipProvider。

2）在浏览器中运行网络应用程序并登录。关闭浏览器。

3) 使用一些 SQL 工具（如 SQL Server Management Studio），运行 sp_who2 以查看连接。找到步骤 2 中 SqlMembershipProvider 使用的连接的 SPID，并执行

```
kill <the found SPID> 
```

（假设使用连接池，默认情况下）。

4) 在浏览器中重新运行 Web 应用程序。尝试再次登录。这次引发了如下所示的 SqlException：

```
[SqlException (0x80131904): A transport-level error has occurred when sending the request to the server. (provider: Shared Memory Provider, error: 0 - No process is on the other end of the pipe.)]
   System.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection) +925466
   System.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection) +800118
   System.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj) +186
   System.Data.SqlClient.TdsParserStateObject.ThrowExceptionAndWarning() +13
   System.Data.SqlClient.TdsParserStateObject.WriteSni() +682631
   System.Data.SqlClient.TdsParserStateObject.WritePacket(Byte flushMode) +265
   System.Data.SqlClient.TdsParserStateObject.ExecuteFlush() +51
   System.Data.SqlClient.TdsParser.TdsExecuteRPC(_SqlRPC[] rpcArray, Int32 timeout, Boolean inSchema, SqlNotificationRequest notificationRequest, TdsParserStateObject stateObj, Boolean isCommandProc) +4163
   System.Data.SqlClient.SqlCommand.RunExecuteReaderTds(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, Boolean async) +1005
   System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method, DbAsyncResult result) +132
   System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method) +32
   System.Data.SqlClient.SqlCommand.ExecuteReader(CommandBehavior behavior, String method) +122
   System.Data.SqlClient.SqlCommand.ExecuteReader(CommandBehavior behavior) +62
   System.Web.Security.SqlMembershipProvider.GetPasswordWithFormat(String username, Boolean updateLastLoginActivityDate, Int32& status, String& password, Int32& passwordFormat, String& passwordSalt, Int32& failedPasswordAttemptCount, Int32& failedPasswordAnswerAttemptCount, Boolean& isApproved, DateTime& lastLoginDate, DateTime& lastActivityDate) +1121
   System.Web.Security.SqlMembershipProvider.CheckPassword(String username, String password, Boolean updateLastLoginActivityDate, Boolean failIfNotApproved, String& salt, Int32& passwordFormat) +105
   System.Web.Security.SqlMembershipProvider.CheckPassword(String username, String password, Boolean updateLastLoginActivityDate, Boolean failIfNotApproved) +42
   System.Web.Security.SqlMembershipProvider.ValidateUser(String username, String password) +83
   System.Web.UI.WebControls.Login.OnAuthenticate(AuthenticateEventArgs e) +160
   System.Web.UI.WebControls.Login.AttemptLogin() +105
   System.Web.UI.WebControls.Login.OnBubbleEvent(Object source, EventArgs e) +99
   System.Web.UI.Control.RaiseBubbleEvent(Object source, EventArgs args) +35
   System.Web.UI.WebControls.Button.OnCommand(CommandEventArgs e) +115
   System.Web.UI.WebControls.Button.RaisePostBackEvent(String eventArgument) +163
   System.Web.UI.WebControls.Button.System.Web.UI.IPostBackEventHandler.RaisePostBackEvent(String eventArgument) +7
   System.Web.UI.Page.RaisePostBackEvent(IPostBackEventHandler sourceControl, String eventArgument) +11
   System.Web.UI.Page.RaisePostBackEvent(NameValueCollection postData) +33
   System.Web.UI.Page.ProcessRequestMain(Boolean includeStagesBeforeAsyncPoint, Boolean includeStagesAfterAsyncPoint) +1746 
```

现在，我明白为什么会发生这种情况 - 即它是由于一个已被终止的池连接，因此当登录控件尝试重用时无效。“kill” session 命令在步骤 3 中执行以模拟会发生的情况，例如，当您需要恢复数据库时。您需要先终止与数据库的所有连接，然后才能恢复它。

在 kill 命令之后强制 web 应用程序重新启动也可以解决它，但我想知道是否有一种相对轻松的方法可以使登录过程更加健壮。如果不知何故，我可以在身份验证过程中捕获此异常，然后重试登录，那将是理想的（因为 ADO.NET 似乎在发生此类故障后清除了连接池，我认为重试会起作用）。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-25T00:23:09.007

您可以创建一个继承 asp:login 控件的新登录控件，然后覆盖 ValidateUser 方法，就像：

```
public override bool ValidateUser(string strName, string strPassword)
{    
    bool boolReturn = false;

    UserProvider oUserProvider = new UserProvider();
    User oUser = oUserProvider.FindUser(strName);

    if (oUser == null)
        return boolReturn;

    boolReturn = oUser.ValidateUsersPasswordForLogon(strPassword);

    return boolReturn;
} 
```

然后在 User 类的创建（捕获 SqlException）周围放置一个 try/catch，然后重试连接？

我没有在 aspnet 会员课程上做太多工作，所以我不太确定

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-26T16:08:28.370

这是用于生产还是开发？我没有看到重新启动开发中的 Web 服务器的大问题。对于生产，无论如何我都会重新启动 Web 服务器以确保清除所有缓存的数据，因为恢复的数据库很可能有不同的数据。

# iphone - 在 iphone 应用程序中重新加载表格视图？

> ID：679773
> 
> 赞同：2
> 
> 时间：2009-03-25T00:16:23.953
> 
> 标签：iphone, cocoa, cocoa-touch

我有一个表视图控制器，它发出一个 http 请求，它返回 xml。我解析 xml 并将其显示在 UITableView 中。第一次调用 http 请求时，一切都按预期工作。第二次调用http请求：我按预期收到了xml，但表没有更新。我每 2 秒调用一次 TableView 的 reloadData 方法，所以这不是问题任何想法？？？？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-25T00:58:52.790

在您更新 XML 后在某处设置断点并检查您提供给表格视图的数据是否是您所期望的。如果没有，请通过调用堆栈查看您遗漏了什么。此外，设置一个计时器来重新加载表格视图确实是一种不好的做法。数据更改后，只需在需要时重新加载即可。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-26T10:29:16.327

嘿，你在使用线程吗？如果是，那么您需要确保在主线程上重新加载 tableview 数据 - 否则 tableview 在您滚动之前不会刷新

每 2 秒重新加载一次 tableview 也是最糟糕的编码方式。仅在实际需要时重新加载 tableview 数据

如果您不使用线程，请确保确实使用它们，以便在您触发 http 请求时不会阻塞主线程和 ui，因为 http 请求需要一段时间才能完成。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-25T01:38:00.653

与 Marc 的响应几乎相同，但操作略有不同 - 在 cellForIndexPath 中设置一个断点，将数据加载到单元格中，然后查看（再次如 Marc 所述）是否有新数据。

如果表格没有重新加载，那么您的数据就没有到达表格可以看到新内容的位置。

# asp.net - Vista Home 上的本地电子邮件测试

> ID：679778
> 
> 赞同：0
> 
> 时间：2009-03-25T00:17:59.347
> 
> 标签：asp.net, windows-vista

使用 Vista Home Basic 测试从开发机器发送电子邮件的最佳方法是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-25T00:21:53.940

免费的 SMTP 服务器是免费的，可以在 Vista 上运行

[http://www.softstack.com/freesmtp.html](http://www.softstack.com/freesmtp.html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-25T00:46:15.223

如果您想要源代码（因此有更多用于测试和日志记录的选项），请查看[Dumbster](http://sourceforge.net/projects/dumbster/) (java) 或 .NET 端口[nDumbster](http://ndumbster.sourceforge.net/default.html)。它不会（不能）中继。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-25T00:25:13.293

除非您已经有一个 SMTP 服务器，否则它只是创建一个小测试页面以使用 System.Net.Mail 类的一个案例

# eclipse - NetBeans 是否与 Eclipse 项目配合得很好，反之亦然？

> ID：679781
> 
> 赞同：5
> 
> 时间：2009-03-25T00:19:11.183
> 
> 标签：eclipse, ide, netbeans

我最近从 Eclipse 切换到了 NetBeans（虽然我周围没有任何我可以轻松访问的当前 Eclipse 项目），但是与我一起工作的很多人（甚至我在学校的部门）都使用 Eclipse 作为他们的主要工具IDE。

将 NetBeans 与其他人在 Eclipse 中制作的项目一起使用是否有任何已知的问题？可能会干扰使用 Eclipse 的人导入我的一个项目的事情怎么样？

谢谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-25T01:47:31.190

Eclipse 项目与 Netbeans 不兼容之一。

话虽如此，您可以轻松地将两个项目配置放在同一个文件夹（或 SCM 系统）上。因此，您可以轻松地集成它们。如果您有普通的 Java 项目（不是 Java EE），则尤其如此。对于 Java EE，事情会稍微复杂一些。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-03-26T20:48:45.747

我在一个成功使用 Eclipse 和 Netbeans 的部门工作。Maven 基本上使这成为可能并且相当容易。如果您使用的是 ant，我想有一些方法可以让 Netbeans 了解该项目。如果您正在使用其他构建工具，则必须在 ant 或 maven 中为 Netbeans 用户设置单独的构建文件...

# php - 在 Ajax 调用中重定向

> ID：679782
> 
> 赞同：0
> 
> 时间：2009-03-25T00:20:18.030
> 
> 标签：php, ajax, caching, header

我需要在不让客户知道的情况下重定向 Ajax 调用。

getPage.php 是一个为给定查询返回 html 等的应用程序。

**getPage.php?hash=interesting-article-title**和**getPage.php?page=3**返回相同。

为了避免客户端必须缓存这两个，我希望通过 PHP 标头 301 和位置将**getPage.php?hash=interesting-article-title**重定向到**getPage.php?page=3 。**

我试过这样做，它什么也没返回。ajax 调用似乎不想被重定向。

有谁知道什么可以解决这个双缓存问题？

我想使用 301 重定向，因为它们是可缓存的。这样，当告诉浏览器获取**hash=insteresting-article-title时，浏览器会自动调用****page=3**。

 **代码示例：

```
 function handleInit(event) {
        if (event.path != "/") {
            var hash = event.path.replace(/\//,"").replace(/\?/g,"");
            getPage(hash);
            currentState.hash = hash;
        } else {
            currentState.id = 1;
        }
        SWFAddress.addEventListener(SWFAddressEvent.CHANGE, handleChange);
    }

    function chapter_forward() {
        if (!freeze) {
            freeze = true;
            getPage(currentState.id - 1);
        }
    }

    function ajax_data(id) {
        return typeof(id) == "string" ? "hash=" : "page=";
    }

    function getPage(id) {
        $.ajax({
            method: "get",
            url: getPage.php,
            data: ajax_data(id) + id.toString(),
            dataType: 'json',
            timeout: 2000,
            error: function() {
                $("#space-3").html('40104 - Request Timeout');
            },
            complete: function() {},
            success: function(result) {
                handleContent(result);
            }
        });
    } 
```

我需要重定向的原因是因为当用户使用他的来回浏览器按钮时，我从 HASH 中获取了 id。

当用户简单地来回导航时，我只需将 +1 添加到当前 ID。

getPage.php 返回如下内容：

```
{"article_id":"3","hash":"music-in-your-ear","title":"Music in your ear.","html":"Blah blah article 3","modified":"Fri, 20 Mar 2009 02:46:00 GMT"} 
```

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-25T00:58:42.930

如果您使用的是 apache，则 mod-rewrites 和重写映射文件是解决此服务器端问题的好方法，假设您的哈希是映射到指定 ID 的术语的预定义列表。

我假设您这样做是为了获得 SEO 的好处？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-25T00:31:41.060

如果您查看[此答案](https://stackoverflow.com/questions/83990/is-it-the-filename-or-the-whole-url-used-as-a-key-in-browser-caches/84010#84010)，浏览器的正确行为是不使用查询参数缓存 url。

当您基本上访问相同的 url 时，我不知道 301 重定向是否有效。

我建议您仔细阅读您的代码，如果它们返回相同的内容，则仅使用其中一个链接。

# code-golf - CodeGolf：计算给定数字的质因数

> ID：679802
> 
> 赞同：0
> 
> 时间：2009-03-25T00:31:57.597
> 
> 标签：code-golf

受[http://codegolf.com/prime-factors](http://codegolf.com/prime-factors)的启发，尝试使用最少的击键次数来解决这个问题。

可悲的是，您只能与 Perl/PHP/Python/Ruby 竞争，我希望看到这个问题在其他不那么传统的语言中得到解决。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-25T01:12:47.453

## Perl

只是函数 - 返回一个主要因素列表（49 个重要*字符）：

```
sub p {
  $p = $_[0];
  return if $p == 1;
  $p % $_ or return($_, p($p/$_)) for 2..$p;
} 
```

用于查找常数的素数（23 个有效*字符）：

```
$, = " ";
print p(10), "\n"; 
```

用于从用户输入中查找数字的素数（28 个有效*字符）：

```
$, = " ";
print p(<STDIN>), "\n"; 
```

*“重要”字符是非空格以及正确语法所需的任何空格。对于任何好奇的人，显着的空格以**粗体显示**。:P

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-08-02T07:52:04.747

# PowerShell，146 ~~161 个~~字符

```
$i="$input"
"$i`: "+(
  $(
    for(;$i-gt1){
      for($x=1;++$x-le5e9){
        if(!($i%$x)){
          $i/=$x
          $x
          break
        }
      }
    }
  ) |
  sort |
  group |
  %{
    ''+$_.Name+('^'+$_.Count)*($_.Count-gt1)
  }) 
```

目前几乎没有打高尔夫球。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-10-22T06:23:04.087

## Python，214 个字符

```
p=int(raw_input())
def r(x,d):d[x]=d.setdefault(x,0)+1;return d
y=lambda x,d:d==x and {x:1} or x%d and y(x,d+1) or r(d,y(x/d,2))
print "%d: %s"%(p," ".join([`x`+("^"+`c` if ~-c else "") for x,c in y(p,2).items()])) 
```

我的第一个代码高尔夫，不要评判。可能可以进行很多优化。

从好的方面来说，它的格式正确。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-10-14T18:52:07.270

# Perl ~~107~~ 98 个字符

```
printf'%d: ',$n=<>;for($p=1;$n>=++$p;){for($i=0;0==$n%$p;$i++){$n/=$p}print$p,
$i>1?"^$i ":" "if$i} 
```

那是

```
printf '%d: ', $n = <>;
for ($p = 1; $n >= ++$p;) {
  for ($i = 0;  0 == $n % $p;  $i++) {
    $n /= $p
  }
  print "$p", $i > 1 ? "^$i " : ' ' if $i
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-08-01T00:24:24.103

# 哈斯克尔

我最近开始学习 Haskell - 这是一种鲜为人知（但非常好）的语言的尝试。

```
main=readLn>>=print.f 2
f a 1=[]
f a x=if x`mod`a==0 then show a:f a(x`div`a)else f(a+1)x 
```

89 个字符，但作弊真的是因为输出格式不正确。我试图更正输出，但不能少于 208 个字符：

```
import List
main=readLn>>=w
w n=putStrLn.foldl1(++).v n.map m.group.f 2$n
m a=' ':head a++j(length a)
v n=((s n++":"):)
s=show
j 1=[]
j n='^':s n
f a 1=[]
f a x=if x`mod`a==0 then s a:f a(x`div`a)else f(a+1)x 
```

欢迎任何改进。顺便说一句，我很惊讶 GHC 可以让你删除多少空白而不抱怨。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-12-07T05:47:04.027

## Python 127 个字符

```
a=input()
x=2
print'%d:'%a,
while x*x<=a:
 c=0
 while a%x==0:a/=x;c+=1
 if c:print`x`+('','^%d'%c)[c!=1],
 x+=1
if a>1:print a 
```

# html - 防止 span 或 div 的换行

> ID：679804
> 
> 赞同：161
> 
> 时间：2009-03-25T00:33:44.503
> 
> 标签：html, css

我想将一组`div`固定宽度的元素放入一个容器中，并出现水平滚动条。`div`/元素应该按照`span`它们在 HTML 中出现的顺序从左到右出现在一行中（基本上是展开的）。

这样，水平滚动条就会出现，并且可以用来代替垂直滚动条来阅读内容（从左到右）。

我试过将它们漂浮在一个容器中，然后在容器上放置一个`white-space: nowrap`样式，但是唉，它似乎仍然可以包裹。

想法？

它看起来像这样：

```
.slideContainer {
    white-space: nowrap;
}
.slide { 
    width: 800px;
    float: left;
    display: inline;
}
```

```
<div class="slideContainer">
    <div class="slide">Some content</div>
    <div class="slide">More content</div>
    <div class="slide">Even More content!</div>
</div>
```

**更新：**
有关示例， 请参见[站点](http://css-tricks.com/how-to-create-a-horizontally-scrolling-site/)，但他们认为不是另一种方式是错误的 - 我敢肯定这篇文章很旧。

* * *

## 回答 #1

> 赞同：198
> 
> 时间：2009-03-25T01:26:59.353

试试这个：

```
.slideContainer {
    overflow-x: scroll;
    white-space: nowrap;
}
.slide {
    display: inline-block;
    width: 600px;
    white-space: normal;
}
```

```
<div class="slideContainer">
    <span class="slide">Some content</span>
    <span class="slide">More content. Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</span>
    <span class="slide">Even more content!</span>
</div>
```

请注意，您可以省略`.slideContainer { overflow-x: scroll; }`（当您阅读本文时，哪些[浏览器可能支持或不支持](https://developer.mozilla.org/en-US/docs/Web/CSS/overflow-x)），您将在窗口上而不是在此容器上获得滚动条。

这里的关键是`display: inline-block`。如今，它具有[不错的跨浏览器支持](http://www.quirksmode.org/css/display.html)，但像往常一样，值得在所有目标浏览器中进行测试以确保。

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2011-05-30T21:08:51.057

它只适用于：

```
.slideContainer {
    white-space: nowrap;
}
.slide { 
    display: inline-block;
    width: 600px;
    white-space: normal;
} 
```

我最初确实有`float : left;`，这阻止了它正常工作。

感谢您发布此解决方案。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2013-07-08T08:18:20.573

[特别是在使用 Twitter 的Bootstrap](http://twitter.github.com/bootstrap/)之类的东西时，`white-space: nowrap;`在对 child 应用 padding 或 margin 时并不总是在 CSS 中工作`div`。然而，相反，添加等效`border: 20px solid transparent;`样式代替填充/边距可以更一致地工作。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-25T00:37:37.210

看起来 div 不会超出身体的宽度。即使在另一个 div 中。

我把它扔了去测试（虽然没有文档类型），但它并没有像想象的那样工作。

```
.slideContainer {
    overflow-x: scroll;
}
.slide {
    float: left;
}
```

```
<div class="slideContainer">
    <div class="slide" style="background: #f00">Some content Some content Some content Some content Some content Some content</div>
    <div class="slide" style="background: #ff0">More content More content More content More content More content More content</div>
    <div class="slide" style="background: #f0f">Even More content! Even More content! Even More content!</div>
</div>
```

我在想的是内部 div 可以通过 iFrame 加载，因为那是另一个页面，它的内容可能很宽。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-25T00:55:04.750

如前所述，您可以使用：

```
overflow: scroll; 
```

如果只希望在必要时出现滚动条，可以使用“auto”选项：

```
overflow: auto; 
```

我认为您不应该将“float”属性与“overflow”一起使用，但我必须先尝试您的示例。

# drupal - 获取 Drupal 节点中的所有评论 ID

> ID：679805
> 
> 赞同：3
> 
> 时间：2009-03-25T00:34:43.830
> 
> 标签：drupal, drupal-comments

我在 Drupal 中有一个带有一些评论的节点。有没有一种简单的方法来获取节点内每个评论的 CID？另外，有没有办法按各种参数、年表、评论的业力等对它们进行排序。谢谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-25T02:45:19.663

我想你应该检查 comment_render 函数。

但是如果您需要自己的排序参数，使用 sql 命令会更容易；

检查：[http ://api.drupal.org/api/function/comment_render/6](http://api.drupal.org/api/function/comment_render/6)

您可以先进行查询，列出您需要订购的所有 cid；

```
$myquery = 'SELECT c.cid, c.pid, c.nid, c.subject, c.comment, c.format, c.timestamp, c.name, c.mail, c.homepage, u.uid, u.name AS registered_name, u.signature, u.picture, u.data, c.status FROM {comments} c INNER JOIN {users} u ON c.uid = u.uid WHERE c.nid
= %d ORDER BY c.uid ASC';

$myresult = db_query($myquery) 
```

此查询存在于 comment_render 函数中。但我试图修改它以供我使用。

现在我们按照我们想要的顺序获得了**节点 id**和**cid**。

这是渲染工作；

```
while ($mycomments = mysql_fetch_row($myresult)){

foreach ($mycomment as $mycid)

comment_render($nid, $mycid)

} 
```

我还没有测试过这个，但我希望它有帮助。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-08-07T20:34:07.777

您可以使用以下函数在 drupal 7 中加载节点的所有注释：

`comment_get_thread($node, $mode, $comment_per_page)`

在此处查看文档：http: [//api.drupal.org/api/drupal/modules%21comment%21comment.module/function/comment_get_thread/7](http://api.drupal.org/api/drupal/modules%21comment%21comment.module/function/comment_get_thread/7)

它还讨论了默认排序参数。然而，这并没有给你一个简单的方法来诉诸评论。我会为此使用视图。然后可以使用 hook_node_view 禁用默认评论显示并添加 views_embed_view('my_view', 'my_display');

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-17T00:11:25.783

更简单的解决方案：

```
$sql = "SELECT cid FROM {comments} WHERE nid=%d ORDER BY timestamp DESC";

$resource = db_query($sql, $node->nid);
while( $row = db_fetch_array( $resource ) ) {
  print comment_render( $node->nid, $row['cid'] );
} 
```

我们的初始 SQL 查询只需要获取评论 ID (cid)，因为 comment_render 的第二个参数将处理获取所有附加信息。

# python - Python 可行的数据库抽象层是什么

> ID：679806
> 
> 赞同：18
> 
> 时间：2009-03-25T00:34:50.397
> 
> 标签：python, sql, mysql, database, sqlite

我开始参与一个开源项目[Gramps](http://www.gramps-project.org/wiki/index.php?title=Main_Page)，该项目正在探索将他们的后端从 BSDDB 切换到关系数据库。无论是 SQLite 还是 MySQL，我们都还没有完全决定，甚至可能会尝试在有限的能力范围内两者都做。我是一名专业开发人员，但我是 python 新手，所以我对当前的工具/库选择不太熟悉。我的任务是研究数据库抽象层。[目前有一个 wiki 讨论正在进行比较它们。](http://www.gramps-project.org/wiki/index.php?title=GEPS_010:_SQL_Backend)对象关系映射器可能很好，但不是绝对必要的。虽然我知道这通常是数据库抽象层的同义词。如果包含一个 ORM，即席查询必须是可用的，而不需要太多的挣扎。

目前该列表包括：

[CouchDB](http://code.google.com/p/couchdb-python/) 我还没有研究过这个。

[DB-API](http://wiki.python.org/moin/DatabaseProgramming/) 这似乎是一个标准的 python api，每个 db 创建自己的模块来使用它。甚至 BSDDB 似乎也写了一个，但我还没有完全探索它。模块可以互换吗？

[SQLAlchemy](http://www.sqlalchemy.org/) 这似乎是现在最流行的？但我对 python 世界的了解非常有限。

[SQLObject](http://www.sqlobject.org/) 我还没有研究过这个。

那么人们对python的数据库抽象层有什么看法和建议呢？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-03-25T00:40:50.727

仔细查看 SQLAlchemy。

您可以使用 SQLite 进行测试和开发。

您可以使用 MySQL 进入生产环境——基本上不对您的应用程序进行任何更改。

DB-API 虽然得到广泛遵守，但具有足够的灵活性，以至于 (1) 您不会与底层 RDBMS 中的 SQL 变体隔离开来，并且 (2) 仍然存在难以隐藏的特定于 DB 驱动程序的特性。

另一个好的 ORM 层是作为[Django](http://docs.djangoproject.com/en/dev/topics/db/models/)一部分的 ORM 。您可以（稍加努力）只使用 Django ORM 而无需使用 Django Web 框架的其余部分。

优先使用 ORM 层（SQLAlchemy 或 SQLObject）而不是 DB-API。

为什么？您的模型应该是一个坚实、清晰、深思熟虑的 OO 模型。关系映射应该排在对象模型之后。SQLAlchemy 使这是一种合理的方法。

“数据库抽象层”将发生在正常的事件过程中。实际上，由于 DB-API（由 SQLAlchemy 使用），您提供了两个抽象层：ORM 和 DB-API。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-25T00:43:57.070

从 Python 访问适当的数据库几乎总是使用符合 DB-API 2.0 的适配器模块来完成。虽然所有 DB-API 模块都具有相同的 API（或非常相似；并非所有后端都支持所有功能），但如果您自己编写 SQL，您可能会用特定于产品的方言编写 SQL，因此它们在就像他们在理论上一样实践。

老实说，SQLite 听起来非常适合您的用例。我不会为“嵌入式 MySQL”而烦恼；这听起来像是两全其美。是否需要像 SQLAlchemy 这样的 ORM 完全取决于您；无论哪种方式都有很好的论据。就个人而言，我不喜欢 ORM，但我有数学学位，所以我欣赏 SQL 作为一门语言这一事实​​可能并不令人惊讶:)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-25T02:02:43.073

CouchDB 不是关系数据库，因此它没有 DB-API 接口。它是一个文档数据库，这意味着它对 Gramps 没有那么有用，因为它需要一些扭曲来识别相关人员之间的联系。最重要的是，它只能在客户端/服务器模式下运行。

任何 ORM，如 SQLAlchemy、SQLObject 或 Django ORM 都是在 DB-API 之上实现的，我建议在直接 DB-API 上使用其中任何一个，因为它可以让 Gramps 灵活地为本地桌面用户在嵌入式模式下运行 sqlite，然后还可以在未来的某个时候与基于 Web 的 Gramps 版本共享 Postgresql/MySQL 数据库连接。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-25T03:33:36.273

我真的很喜欢[风暴](https://storm.canonical.com/)：

> Storm 是 Canonical 开发的 Python 对象关系映射器 (ORM)。该项目已经开发了一年多，用于 Launchpad 等 Canonical 项目，最近已作为开源产品发布。

在我看来，Storm 比 SQLAlchemy 更容易学习。类似于 Django 的 ORM。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2013-06-03T16:54:42.350

web2py 有一个可以独立使用的数据库抽象层。我们在 sqlite3、Microsoft SQL Server、Oracle 和 MySQL 之间进行了零代码更改。印象深刻。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-27T10:19:44.377

当我开始将遗留应用程序转换为使用 ORM 时，我研究了 SQLObject 和 SQLAlchemy。起初我使用 SQLObject，因为它看起来很熟悉（过去的 Django 经验）并且 SQLAlchemy 看起来很复杂。大约 2 小时后，我开始使用 SQLObject 碰壁。然后我再次查看 SQLAlchemy 并立即获得了回报。它不仅能理解和映射数据库中的每一个奇怪的表，它甚至可以做我以后必须做的更奇怪的查找！

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2011-08-30T19:29:10.310

我认为 CouchDB 将是 Gramps 等项目的最佳选择。

对 Gramps 有用的 CouchDB 功能：

*   没有架构，没有迁移。

*   支持将文件直接存储到数据库，例如家庭照片等： http: [//guide.couchdb.org/draft/api.html#attachments](http://guide.couchdb.org/draft/api.html#attachments)

*   Ubuntu 通过 desktop-couch 支持 CouchDB，它与 Ubuntu One 集成以方便共享或备份：[http ://www.freedesktop.org/wiki/Specifications/desktopcouch](http://www.freedesktop.org/wiki/Specifications/desktopcouch)

*   您可以轻松地复制 couchdb 数据库，将它们加入一个大数据库，等等......

*   couchDB 非常灵活。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2009-03-25T09:28:29.990

如果您的项目将有任何真正的复杂性，请远离 ORM。

[http://blogs.tedneward.com/2006/06/26/The+Vietnam+Of+Computer+Science.aspx](http://blogs.tedneward.com/2006/06/26/The+Vietnam+Of+Computer+Science.aspx)

# windows-mobile - 通过单击 Compact Framework 中的列标题对 DataGrid 进行排序？

> ID：679810
> 
> 赞同：2
> 
> 时间：2009-03-25T00:38:37.377
> 
> 标签：windows-mobile, compact-framework, datagrid

这在 .Net Compact Framework 中是否可行？与桌面框架相比，它遗漏了各种各样的东西。

我想知道 Compact Framework 是否在我们的移动应用程序中通过此功能请求占了上风。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2013-09-23T15:39:23.713

由于该网站不再可用，以下是内容：

```
 public static void SortDataGrid(object sender, MouseEventArgs e)
    {
        DataGrid.HitTestInfo hitTest;
        DataTable dataTable;
        DataView dataView;
        string columnName;
        DataGrid dataGrid;

        // Use only left mouse button clicks
        if (e.Button == MouseButtons.Left)
        {
            // Set dataGrid equal to the object that called this event handler
            dataGrid = (DataGrid)sender;

            // Perform a hit test to determine where the mousedown event occurred
            hitTest = dataGrid.HitTest(e.X, e.Y);

            // If the MouseDown event occurred on a column header,
            // then perform the sorting operation.
            if (hitTest.Type == DataGrid.HitTestType.ColumnHeader)
            {
                // Get the DataTable associated with this DataGrid.
                dataTable = (DataTable)dataGrid.DataSource;

                // Get the DataView associated with the DataTable.
                dataView = dataTable.DefaultView;

                // Get the name of the column that was clicked.
                if (dataGrid.TableStyles.Count != 0)
                    columnName = dataGrid.TableStyles[0].GridColumnStyles[hitTest.Column].MappingName;
                else
                    columnName = dataTable.Columns[hitTest.Column].ColumnName;

                // If the sort property of the DataView is already the current
                // column name, sort that column in descending order.
                // Otherwise, sort on the column name.
                if (dataView.Sort == columnName)
                    dataView.Sort = columnName + " DESC";
                else
                    dataView.Sort = columnName;
            }
        }
    } 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-30T13:28:12.323

你的意思[是这样的](http://www.cjcraft.com/Blog/PermaLink,guid,12a73e11-ceff-47a6-8371-d0c0a3db0c00.aspx)？

# compiler-construction - Haskell - 如何最好地表示编程语言的语法？

> ID：679815
> 
> 赞同：21
> 
> 时间：2009-03-25T00:40:58.277
> 
> 标签：compiler-construction, haskell, grammar, representation

我一直在研究 Haskell，我很想在其中编写一个编译器（作为学习练习），因为它的许多固有特性可以很容易地应用于编译器（尤其是递归下降编译器）。

我无法完全理解的是如何以 Haskell-ian 方式表示语言的语法。我的第一个想法是使用递归数据类型定义，但我看不出如何使用它们来匹配语言中的关键字（“if”）。

非常感谢您的想法和建议，

皮特

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-03-25T01:25:28.450

您使用相互递归的代数数据类型来表示程序，并使用**解析组合**器来解析程序。有一百万种口味；[你会在 2009 年 3 月 23 日星期一的课程表](http://www.cs.tufts.edu/~nr/comp150fp/ss.html)上找到三篇有用的教程论文。它们是

*   Graham Hutton 和 Erik Meijer，*[Functional Pearl：Haskell 中的一元解析](http://www.cs.tufts.edu/~nr/comp150fp/archive/graham-hutton/monadic-parsing-jfp.pdf)*(1998)
*   Graham Hutton，*[用于解析的高阶函数](http://www.cs.tufts.edu/~nr/comp150fp/archive/graham-hutton/parsing.ps.gz)*(1992)
*   Jeroen Fokker，*[函数式解析器](http://www.cs.tufts.edu/~nr/comp150fp/archive/jeroen-fokker/parsers.ps.gz)*(1995)

Hutton 和 Meijer 论文是最短和最简单的，但它使用单子，这对业余爱好者来说并不明显。但是，它们具有非常好的表达式语法和解析器。如果你还没有 grok monads，Fokker 的教程就是其中之一。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-03-25T02:14:15.603

递归数据类型对此很好。例如，给定语言：

```
expr ::= var
      |  "true"
      |  "false"
      |  "if" expr "then" expr "else" expr
      |  "(" expr ")" 
```

这种语言的一个示例表达式是：

```
if true then x else (if false then y else true) 
```

您的 Haskell 数据类型如下所示：

```
data Expr = Var String
          | Lit Bool
          | If Expr Expr Expr 
```

然后，您的解析器会负责翻译，例如`x`into`Var "x"`和`true`into`Lit True`等。即：

```
parse "if x then false else true" 
  ==  If (Var "x") (Lit False) (Lit True) 
```

对于编写解析器，您可以使用 Norman 的回答中提到的技术，或者使用[Parsec](http://legacy.cs.uu.nl/daan/parsec.html)或使用像[Happy](http://www.haskell.org/happy/)这样的解析器生成器来自己编写解析器。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-25T14:31:39.170

也许你可以看看一些现实世界的项目，看看他们是如何做到的？

不到一周前，[Language-Python](http://Projects.Haskell.Org/language-python/)项目在[Haskell-Cafe 邮件列表上](http://Haskell.Org/pipermail/haskell-cafe/)[公布](http://Haskell.Org/pipermail/haskell-cafe/2009-March/058051.html)。它是在 Haskell 中实现的[Python解析器，使用](http://Python.Org/)[Happy](http://Haskell.Org/happy/)解析器生成器和[Alex](http://Haskell.Org/alex/)词法分析器生成器。

当然，还有[Pugs](http://PugsCode.Org/)，它是在 Haskell 中的[Perl 6](http://Dev.Perl.Org/perl6/)实现（Perl 6的第一个实现，它符合 Perl 6 规范的重要子集）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-25T01:00:05.347

从您的问题的语气中我无法判断这是您第一次尝试编写编译器，还是您以前编写过编译器并正在寻找特定于 Haskell 的建议。如果您已经是编译器专家，那么我提供的任何小建议都无济于事。:)

编程语言语法通常以[BNF 形式](http://en.wikipedia.org/wiki/Backus%E2%80%93Naur_form)表示，可供 Yacc 或 Bison 等工具用于解析源代码。我不知道这是否算作 Haskell 式的做法，但这是我听说过的唯一方法。通过一些挖掘，您可能会挖掘出一个从 BNF 语法生成 Haskell 代码的工具；我发现这个声称能够做到这一点的[工具。](http://www.cs.chalmers.se/Cs/Research/Language-technology/BNFC/)

快速的谷歌搜索发现了[Haskell 的 BNF 语法](http://www.willamette.edu/~fruehr/254/grammar/haskell.html)，可能还有其他的，以防你想为 Haskell 编写一个编译器（也许你想用 Haskell 编写一个 Haskell 编译器？） C 和 BNF 语法Java似乎很流行。

最后，如果你正在寻找一本关于编译器设计的书，经典的文本是[“The Dragon Book”](http://books.google.ca/books?id=1sGvAAAACAAJ)。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-25T01:14:37.683

[不幸的是， ANTLR](http://www.antlr.org/grammar/list)没有 Haskell 语法，但也许您可以使用上面引用的链接来创建一个。ANTLR 是一个很棒的基于 Java 的解析器生成器。

如果您需要更多动力，Steve Yegge 有一个关于编写编译器的不错的[博客。](http://steve-yegge.blogspot.com/2007/06/rich-programmer-food.html)这很有趣。

# android - 如何取消对我的 APK 的 Jarsign？

> ID：679817
> 
> 赞同：1
> 
> 时间：2009-03-25T00:42:22.113
> 
> 标签：android, jar, apk, jarsigner

如果我有一个 JAR（Android APK），并且我是这样签名的：

```
jarsigner -keystore my.keystore someApk.apk myAlias 
```

我如何取消签名？因为如果我以 zip 文件的形式打开它并尝试提取 AndroidManifest.xml，它们都会搞砸。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-25T01:54:20.333

如果您不关心清单和其他元信息（您可能不关心，因为您只想提取资源），您可以使用 提取文件`jar -xvf myjar.jar`，删除 META-INF 目录，然后创建一个新的（未签名的 jar ）。

如果您*确实*关心元信息，请查看[了解签名和验证](http://java.sun.com/docs/books/tutorial/deployment/jar/intro.html)以了解签名的作用。您应该能够通过编辑清单并删除 jar 的 META-INF 目录中的签名文件来取消对 jar 的签名。

以上内容可能会回答您的问题，但可能无法解决您的问题，因为我不确定拥有签名的 jar 会如何导致资源“混乱”。资源本身不受签名过程的影响。如果你只是通过 jar 命令本身提取资源（如上面第二段），你还有问题吗？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-08-01T05:35:12.783

事实证明，这个问题根本与签名无关——这是因为 XML 文件被编译了。要查看此文件的内容，您必须使用该`aapt`工具。

# sql-server - sql server 2005 t-sql 有哪些新功能？

> ID：679821
> 
> 赞同：1
> 
> 时间：2009-03-25T00:45:28.563
> 
> 标签：sql-server, sql-server-2005, tsql, sql-server-2000

与 2000 相比，我在哪里可以找到 sql server 2005 中新 T-SQL 功能的完整列表？

我知道的几个：Pivot、Output、Try..Catch。还要别的吗？谢谢你。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-25T00:56:05.993

这是来自联机丛书的 Microsoft 参考：http:
[//msdn.microsoft.com/en-us/library/ms189465 (SQL.90).aspx](http://msdn.microsoft.com/en-us/library/ms189465(SQL.90).aspx)

它包含示例数据库增强、tsql 数据类型和其他一些。不是最好的资源（很傻，因为它是为 SQL Server 编写的），而是一些东西。

这是 SQLServerCentral.com 上的一个很好的资源。不幸的是，您需要加入才能查看信息。我已经成为会员多年了，因为网站上有很多优秀的 SQL Server 文章。[http://www.sqlservercentral.com/articles/Development/2738/](http://www.sqlservercentral.com/articles/Development/2738/)
我会把一些信息复制过来，但我认为他们不会对此很高兴。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-25T20:54:38.483

我最喜欢的是：

*   VARCHAR(MAX)
*   ROW_NUMBER()
*   OVER / PARTITION BY（与 ROW_NUMBER() 或任何聚合如 SUM、COUNT 一起使用）
*   索引中包含的列
*   输出子句
*   更新和删除的顶部
*   CTE

实际上..有很多好东西:-)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-25T00:53:57.450

对我的团队来说，sql2005 中最大的新特性可能是镜像数据库的能力。我是那个的超级粉丝。不过，不确定它的 tsql，所以我并没有真正帮助你吗？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-25T01:36:41.280

还有对加密和密钥管理的 T-SQL 支持（如果您想编写函数或存储过程来加密数据，这很有用）。

[这里](http://www.4guysfromrolla.com/articles/022107-1.aspx)有一篇很好的文章，展示了如何使用 T-SQL 创建加密密钥。MSDN 博客上还有另一篇类似的文章，[位于此处](http://blogs.microsoft.co.il/blogs/applisec/archive/2008/06/15/microsoft-sql-server-2005-database-encryption-step-by-step.aspx)。

[可以在此处](http://technet.microsoft.com/en-us/library/ms188357(SQL.90).aspx)找到有关创建密钥（和其他 T-SQL 加密支持）的联机丛书文档。

# iphone - 为什么要将 NSObject 的协议附加到协议实现中

> ID：679822
> 
> 赞同：34
> 
> 时间：2009-03-25T00:45:29.937
> 
> 标签：iphone, objective-c, cocoa

我一直在看到一些类似于以下内容的代码：

```
@protocol MyProtocol <NSObject>
// write some methods.
@end 
```

MyProtocol 符合 NSObject 协议有什么特别的原因吗？如果您执行以下操作，那不是很多余：

```
id <MyProtocol> foo; // foo here conforms to NSObject AND MyProtocol? 
```

只是好奇这是什么逻辑。

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2009-03-25T17:45:16.117

当你声明一个变量时

```
 id<MyProtocol> var; 
```

Objective-C 编译器只知道其中的方法，因此如果您尝试在该实例上调用任何方法，例如`MyProtocol`，就会产生警告。因此，Cocoa 定义了一个镜像类和实例方法的协议。通过声明实现协议，您可以向编译器提示所有方法都将由实现的实例实现。`NSObject``-retain/-release``NSObject``NSObject``MyProtocol``NSObject``NSObject``MyProtocol`

为什么这一切都是必要的？Objective-C 允许对象从任何根类继承。在 Cocoa 中，NSObject 是最常见的，但不是唯一的根类。`NSProxy`例如，也是一个根类。因此类型的实例`id`不一定继承的*方法*`NSObject`。

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2009-03-25T01:20:58.103

我很确定您这样做的原因是将 NSObject 成员（例如保留和释放）添加到您的协议中。从技术上讲，您仍然可以发送这些消息，但是如果没有它，您将收到编译器警告。

* * *

## 回答 #3

> 赞同：24
> 
> 时间：2009-03-25T01:45:42.710

当您拥有具有`@optional`方法的协议时（例如，“现代”Objective-C 2.0 委托经常使用这种技术），它也非常方便。如果您不包含该`NSObject`协议，当您尝试调用`respondsToSelector:`该对象时会收到警告。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-25T00:53:42.053

我从来没有在我的代码中这样做过，但我可以看到它的优势。如果您传递一个参数，`id <SomeProtocol>`如果您想在该对象上调用任何 NSObject 方法，则需要重新转换它。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-26T18:57:04.487

如果您使用任何 NSObject 协议方法，例如保留、释放、类、类名，编译器将给您警告，除非您的协议还包含 NSObject 协议。

# c++ - C++ 资源

> ID：679825
> 
> 赞同：2
> 
> 时间：2009-03-25T00:46:47.313
> 
> 标签：c++

自从我使用 C++ 以来已经有很长时间了。我想再次开始用 C++ 编程，但我正在寻找一个特定的资源，并想知道这里是否有人有任何好的参考资料。我正在寻找一本书、网络教程、视频……任何在你构建应用程序时教你 C++ 的东西。因此，例如，一本书可能会通过启动应用程序来启动这本书......等等。有人有好的参考吗？谢谢

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-25T00:50:00.003

一个很棒的免费教程是[cplusplus.com 上的 C++ 语言教程](http://cplusplus.com/doc/tutorial/)及其[其他资源](http://cplusplus.com/)。

您还可以查看流行的 C++ 书籍，例如：Bjarne Stroustrup 的 C++ Programming Language 或 Scott Meyers 的 Effective C++，

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-25T01:08:51.253

我发现[The C++ FAQ Lite](http://www.parashift.com/c%2B%2B-faq-lite/index.html)是 C++ 建议的最佳站点之一。它不面向初学者，但 C++ 语言也不是。:)

我还将支持 Brian 对 Scott Meyers 的“Effective C++”的推荐。这是你能读到的最好的 C++ 书籍之一。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-25T00:53:03.787

这不是对您要求的确切答案，但如果您将不得不处理维护现有的 C++ 代码和/或如果您通过示例学得很好，我发现[How Not to Program in C++](https://rads.stackoverflow.com/amzn/click/com/1886411956)是一本非常方便的书。示例“坏”程序很容易理解，但您不得不在代码中找到错误。

我也有类似的情况。我在学校学习过使用 C++，但我的大部分职业生涯都是在 Perl/Python/C#/Bash 上度过的，并且忘记了我的“基础知识”。

# prolog - Prolog 寻路

> ID：679826
> 
> 赞同：4
> 
> 时间：2009-03-25T00:47:08.527
> 
> 标签：prolog

如果我有以下谓词*door*，它声明两个房间之间有一扇门：

```
door(office, hall).
door(kitchen, office).
door(hall, "dining room").
door(kitchen, cellar).
door("dining room", kitchen). 
```

以及声明门状态的谓词*doorstate ：*

```
doorstate(hall, office, closed).
doorstate(hall, "dining room", opened).
doorstate("dining room", kitchen, opened).
doorstate(kitchen, office, opened).
doorstate(kitchen, cellar, opened). 
```

如果两个房间之间的所有门都打开，则两个房间之间有一条通道。

我如何编写规则来发现两个房间之间是否有这样的路径？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-25T00:58:46.283

序言的可怕恐怖回来得太快了。

```
wayopen(Room1,Room2) :- doorstate(Room1, Room2, opened).
wayopen(Room1,Room2) :- doorstate(Room1, RoomX, opened), wayopen(RoomX,Room2). 
```

所以我不只是为你做功课，这里是如何理解它：

*   如果两个房间由一扇门连接并且门是打开的，则在两个房间之间的道路是开放的。
*   如果第一种方式有一扇通往另一个房间的门，并且有一条从另一个房间到第二个房间的路，那么这条路在两个房间之间是开放的。

请注意，这些规则只能通过一个方向的门。*你的*功课是让它双向工作。

我们可以从大厅到哪里去？

```
?- wayopen(hall, X).
X = diningroom ;
X = kitchen ;
X = office ;
X = cellar ;
false. 
```

以下是您可以往返的所有房间：

```
?- wayopen(Room1,Room2).
Room1 = hall,
Room2 = diningroom ;
Room1 = diningroom,
Room2 = kitchen ;
Room1 = kitchen,
Room2 = office ;
Room1 = kitchen,
Room2 = cellar ;
Room1 = hall,
Room2 = kitchen ;
Room1 = hall,
Room2 = office ;
Room1 = hall,
Room2 = cellar ;
Room1 = diningroom,
Room2 = office ;
Room1 = diningroom,
Room2 = cellar ;
false. 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-25T18:03:41.937

您需要描述一个`exists_way/2`对称且可传递的关系 ( )。

```
% Base cases
exists_way_(hall, 'dining room').
exists_way_('dining room', kitchen).
exists_way_(kitchen, office).
exists_way_(kitchen, cellar).

% Symmetric
exists_way(R1, R2) :- exists_way_(R1, R2) ; exists_way_(R2, R1).

% Transitive
exists_way(R1, R2) :-
    exists_way_(R1, R3),
    exists_way(R3, R2). 
```

但是，此代码会过度生成解决方案。因此，您需要稍后过滤掉重复项。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-11T20:42:25.270

您需要描述一个`exists_way/2`对称且可传递的关系 ( )。在支持表格的 Prolog（例如[XSB](http://xsb.sourceforge.net/)）中，您可以以非常自然的方式表达这些关系，即就像它们在数学书籍中表达的那样。

```
:- table exists_way/2.

% Open doors
exists_way(hall, 'dining room').
exists_way('dining room', kitchen).
exists_way(kitchen, office).
exists_way(kitchen, cellar).

% Symmetry
exists_way(R1, R2) :-
    exists_way(R2, R1).

% Transitivity
exists_way(R1, R2) :-
    exists_way(R1, R3),
    exists_way(R3, R2). 
```

在这种情况下，查询`exists_way(R1, R2)`提供了 25 个独特的解决方案。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-04-20T11:26:29.270

本着学习的精神：这与您在序言课程的第一周可能遇到的祖父母问题相同。

事实证明，你将在 prolog 中做的很多事情在结构上都非常相似。因此，请确保您掌握有关递归谓词的概念，以及子句必须如何进行的顺序，以便更正和执行。

例如，您应该尽可能避免非尾递归。

# c# - 应用程序关闭时触发事件

> ID：679829
> 
> 赞同：2
> 
> 时间：2009-03-25T00:48:10.710
> 
> 标签：c#

我有一个使用网络套接字的 winforms 应用程序，我想在应用程序关闭时关闭套接字，那么如何在应用程序关闭时触发事件？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-25T00:52:54.910

我找到了应用程序事件。
您可以像这样在应用程序关闭时触发事件

```
System.Windows.Forms.Application.ApplicationExit +=new System.EventHandler(this.shutdownHandler); 
```

* * *

## 回答 #2

> 赞同：-2
> 
> 时间：2009-03-25T00:52:21.620

在主窗口上为“FormClosing”事件创建一个处理程序

# rss - 要在页面上发布的 RSS 提要

> ID：679847
> 
> 赞同：-1
> 
> 时间：2009-03-25T00:57:47.050
> 
> 标签：rss

我正在寻找在 html 中开发一个网页，我需要在其中发布 rss 提要。用户将在一个页面上提交 rss url，并且提要需要显示在不同的页面中

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-11T02:13:24.797

哎呀，这个问题缺乏细节。假设您想使用 php（胡乱猜测，呵呵），请使用[http://simplepie.org/](http://simplepie.org/)来解析提要。

# php - 如果代码抛出通知，我可以让 PHPUnit 失败吗？

> ID：679854
> 
> 赞同：3
> 
> 时间：2009-03-25T01:01:08.667
> 
> 标签：php, phpunit

默认情况下它似乎没有这样做，我也没有看到任何开关。

这是 PHPUnit 2.3.5 和 PHP 5.2.0-8。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-25T15:47:39.707

```
function exception_error_handler($errno, $errstr, $errfile, $errline ) 
{
    throw new ErrorException($errstr, 0, $errno, $errfile, $errline);
}
set_error_handler("exception_error_handler"); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-28T19:21:38.467

您想升级到更新版本的 PHPUnit，请查看[http://www.phpunit.de/](http://www.phpunit.de/)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-25T01:36:46.333

您的可用选项似乎是使用 set_error_handler() 来覆盖错误过程（PHPUnit 安装自己的，您将替换它）。然后，您要么复制 PHPUnit 的错误处理程序所做的事情，除了在 E_NOTICES 上触发失败，要么移交给 PHPUnit 的错误处理程序（您将获得从 set_error_handler() 返回的句柄）并将 E_NOTICES 伪造为更关键的东西。

# sql - 如何在 SQL 中查找重复条目并删除最旧的条目？

> ID：679855
> 
> 赞同：6
> 
> 时间：2009-03-25T01:01:24.967
> 
> 标签：sql, sql-server

我有一个表，它的行是唯一的，除了一列中的一个值（我们称之为“名称”）。另一列是“日期”，它是添加到数据库中的日期。

我想要做的是在“名称”中找到重复的值，然后删除“日期”中日期最旧的值，留下最近的值。

似乎是一个相对简单的查询，但除了简单的查询之外，我对 SQL 知之甚少。

有任何想法吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-25T01:32:21.227

查找重复并删除最旧的

![替代文字](https://farm4.static.flickr.com/3578/3384377552_e72356d8c0_o.png)

这是代码

```
create table #Product (
    ID      int identity(1, 1) primary key,
    Name        varchar(800),
    DateAdded   datetime default getdate()
)

insert  #Product(Name) select 'Chocolate'
insert  #Product(Name,DateAdded) select 'Candy', GETDATE() + 1
insert  #Product(Name,DateAdded) select 'Chocolate', GETDATE() + 5
select * from #Product

;with Ranked as (
    select  ID, 
        dense_rank() 
        over (partition by Name order by DateAdded desc) as DupeCount
    from    #Product P
)
delete  R
from    Ranked R
where   R.DupeCount > 1

select * from #Product 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-25T01:15:29.037

从存在的表 a1 中删除（从表 a2 中选择 *，其中 a2.name = a1.name 和 a2.date > a1.date）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-25T01:21:25.090

您可能可以通过自连接和 IS NOT NULL 来实现这一点。

加入 DELETE 查询可能有点危险，因为在某些情况下，它越复杂，删除的风险就越大。

但我会接近它。

```
DELETE
  a.*
FROM
  mytable AS a
  LEFT JOIN mytable AS b ON
    b.date > a.date
    AND (b.name=a.name OR (b.date = a.date AND b.rowid>a.rowid))
WHERE
  AND b.rowid IS NOT NULL 
```

连接和 IS NOT NULL 查找存在具有相同名称的新行的每一行。它还正确处理具有相同日期的两行的情况 - 如果它们具有相同的日期，则它按 rowid （无论是什么）。

希望这样的事情有效。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2020-12-08T13:43:09.363

我刚刚用谷歌搜索并找到了这个[https://www.sqlshack.com/different-ways-to-sql-delete-duplicate-rows-from-a-sql-table/](https://www.sqlshack.com/different-ways-to-sql-delete-duplicate-rows-from-a-sql-table/)

这对我来说似乎最容易阅读/理解：

```
DELETE FROM [SampleDB].[dbo].[Employee]
    WHERE ID NOT IN
    (
        SELECT MAX(ID) AS MaxRecordID
        FROM [SampleDB].[dbo].[Employee]
        GROUP BY [FirstName], 
                 [LastName], 
                 [Country]
    ); 
```

在您的场景中，您可以按名称分组并选择最大日期而不是 Id

# php - 为 Web 开发人员设计测试

> ID：679857
> 
> 赞同：3
> 
> 时间：2009-03-25T01:01:42.690
> 
> 标签：php, javascript, database-design

我需要为 Web 开发人员设计一个测试。
该测试应该筛选对 DOM 的良好掌握和操作以及设计可扩展和高效的数据库和服务器端代码的良好技能，并针对 Web 特定问题（例如从一种编码转换为另一种编码、干净的输入安全性）进行一些测试）。
最重要的是，把它塞进 3 个小时。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-25T01:04:51.713

一家名为 Red Snapper 的公司[对申请者进行了测试](http://www.redsnapper.net/en/1/carwebdevtest.html)。也许您可以调查一下，看看是否找不到可以帮助您的东西。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-25T01:34:30.660

听起来您已经确切地知道要测试开发人员的内容...为什么不让他创建一个包含您已经提出的一些想法的小网站。但是，在 3 小时内，您不太可能获得任何开发人员的全部经验。

您可以使用消息队列系统之类的东西，因为这应该足够简单，任何用户都可以发布必须由管理员接受的消息 - 一旦被接受，就会显示在页面上。

这个例子可能看起来很简单，但很多东西都包含在这么简单的东西上：数据库输入卫生、数据库创建、管理会话、正确的身份验证和授权、Ajax（如果需要）、业务逻辑与表示的正确分离等。

基本上，如果是 3 小时的冒险，请保持测试简单。

# c++ - 定义函数指针

> ID：679862
> 
> 赞同：7
> 
> 时间：2009-03-25T01:07:33.080
> 
> 标签：c++, function-pointers

我正在尝试调用内部 Windows NT API 函数 NtOpenProcess。我知道调用内部 API 可能是个坏主意，但是对于这个特定的工具，我需要这个 API 提供的低级访问。

我的问题是要使用这样的内部 API，我需要使用 Runtime Dynamic Linking，如[本文所述](http://msdn.microsoft.com/en-us/library/ms686944(VS.85).aspx)

为此，我需要定义一个指向 NtOpenProcess 的函数指针。这是我的声明：

```
typedef NTSTATUS (NTAPI *_NtOpenProcess) (
OUT PHANDLE,
IN ACCESS_MASK,
IN POBJECT_ATTRIBUTES,
IN PCLIENT_ID OPTIONAL);

class procManager
{
    HINSTANCE hNTDLL;
public:
    procManager()
    {
        hNTDLL = LoadLibrary(L"ntdll.dll");
        if (!hNTDLL)
            throw std::runtime_error("NTDLL.DLL failure.");
        _NtOpenProcess NtOpenProcess;
        NtOpenProcess = reinterpret_cast <_NtOpenProcess> (GetProcAddress(hNTDLL, L"NtOpenProcess"));
        if (!NtOpenProcess)
            throw std::runtime_error("NtOpenProcess not found.");
        //Use NTOpenProcess for stuff here
    };
    ~procManager()
    {
        FreeLibrary(hNTDLL);
    };
}; 
```

问题是，显然我上面的 typedef 有一个错误。编译器返回：

> 错误 C2059：语法错误：'__stdcall'

我使用了我的 IDE (Visual Studio 2008) 的方便的花花公子“转到定义”功能，发现声明中的 NTAPI 被定义为 __stdcall。

不幸的是，从我的声明中删除了 NTAPI，使其成为：

```
typedef NTSTATUS (*_NtOpenProcess) (
OUT PHANDLE,
IN ACCESS_MASK,
IN POBJECT_ATTRIBUTES,
IN PCLIENT_ID OPTIONAL); 
```

导致另一个错误：

> 错误 C2065：“_NtOpenProcess”：未声明的标识符

在这一点上，我说“当然它是未定义的，这就是为什么它是 typedef！”

有人在声明中看到我的错误吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-25T01:32:25.813

您是否包括了 "ntdef.h" 和 "ntstatus.h" ？编译器可能无法理解 NTSTATUS。

# linq-to-sql - LINQ to SQL - SubmitChanges() 是否自动启动事务？

> ID：679870
> 
> 赞同：20
> 
> 时间：2009-03-25T01:14:23.813
> 
> 标签：linq-to-sql, transactions

我需要将事务与 LINQ to SQL 一起使用，并且我正在阅读以熟悉它。

SubmitChanges 是否已经交易？

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2009-03-25T01:23:41.560

当您调用 SubmitChanges 时，LINQ to SQL 会检查一组已知对象以确定是否已将新实例附加到它们。如果有，则将这些新实例添加到跟踪对象集中。

在传输任何实际更改之前，**LINQ to SQL 立即启动一个事务来封装一系列单独的命令。**

对对象的更改被一一转换为 SQL 命令并发送到服务器。

此时，数据库检测到的任何错误都会导致提交过程停止，并引发异常。**对数据库的所有更改都将回滚，就好像从未发生过提交一样**。

有关此视图的更多信息，请查看[MSDN 文章](http://msdn.microsoft.com/en-us/library/bb399378.aspx)。

希望这可以帮助！

# user-interface - 黑莓用户界面编程资源

> ID：679877
> 
> 赞同：3
> 
> 时间：2009-03-25T01:18:26.753
> 
> 标签：user-interface, blackberry

一般来说，我是黑莓编程和 Java 的新手。我以前确实有过 C、C++、VB 和其他一些方面的经验。然而，这是我第一次涉足 Java 世界。

我发现了很多关于 MIDP 类的信息，但我宁愿尽可能使用本机 RIM API，尤其是对于 UI 元素。具体来说，我正在考虑使用 MIDP 表单元素来设置我的屏幕布局，但不知道这是否是最佳选择。或者是否有针对此问题的黑莓特定解决方案？如果我确实使用 MIDP 表单元素，它会像原生黑莓应用程序一样呈现吗？或者它看起来像一个 MIDP 应用程序？

另外，是否有人对 BB 特定的教程和示例有很好的资源？开始时最困难的部分似乎是缺乏新手信息。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-25T05:03:26.790

有一个人在这里发帖，他运行了一个关于使用 RIM UI API 的很好的介绍性博客

[http://www.thinkingblackberry.com](http://www.thinkingblackberry.com)

MIDP 看起来像 MIDP。

这里还有一组合理的链接。

[http://supportforums.blackberry.com/rim/board/message?board.id=java_dev&thread.id=13264](http://supportforums.blackberry.com/rim/board/message?board.id=java_dev&thread.id=13264)

这也是一个支持论坛。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-25T03:02:32.603

Blackberry 开发者专区有很多关于 RIM API 的优秀教程和示例：

[http://na.blackberry.com/eng/developers/javaappdev/learningresources/](http://na.blackberry.com/eng/developers/javaappdev/learningresources/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-30T15:52:02.470

只有付出巨大努力才能将 BlackBerry UI 组件与 MIDP 组件混合使用。

无论如何，您应该坚持使用本机 BlackBerry 组件。它们更复杂、更易于使用且面向未来。此外，在黑莓设备上看起来更好。

# c++ - 如何轻松使用 char**？

> ID：679888
> 
> 赞同：2
> 
> 时间：2009-03-25T01:26:00.760
> 
> 标签：c++, char, standard-library

我有一个`char**`我经常需要插入或执行查找的。数组和插入字符串非常繁琐`realloc()`。`malloc()`

是否有任何标准方法可以添加字符串或在 a 中进行查找`char**`？我想我正在寻找类似字符串的东西，但使用`char**`'s 代替。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-25T01:32:22.227

如果您经常插入此结构，则根本不应该使用 a `char**`；数组不是此类操作的合适数据结构。如果可能的话，考虑一个`std::vector<string>`或类似的东西。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-25T01:30:36.893

听起来您想使用诸如 STL 列表或char* 的[Boost Array之类的东西。](http://www.boost.org/doc/libs/1_38_0/doc/html/array.html)

请注意，如果您需要从数组中插入或删除元素，则 STL 向量不是可取的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-25T01:30:22.607

目前尚不清楚您要问什么问题。如果你想要一个字符串序列，也许`Seq_T`Dave Hanson 的[C 接口和实现](http://www.cs.princeton.edu/software/cii/)中的类型可以解决问题——它是用 C 编写的非常有用的数据结构的集合，它可以在你插入时为你增加和缩小内存并删除项目。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-25T01:33:51.207

如果这是普通的 C -

我还没有看到任何标准的方法来做到这一点，但话虽如此，我已经在我的 C 例程中做了很多。实际上，创建一系列函数来对 char* 和 char** 值进行您想要的操作是相当简单的。

对我来说，这只是建立一个（小型）例程库的问题。我从内存管理的例程和我想要的所有 char* 操作开始。然后使用这些来制作插入 char** 等的例程。

对于 C++，您应该考虑重构以使用 std::vector 或其他类似的数据结构。会好很多。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-25T02:30:46.533

如果是 C++，你可以使用 STL，但要注意 STL 的跨平台支持是不确定的，这对你来说可能无关紧要。

如果是 C，那么您可能想要创建一个数据结构来保存所有字符串并在该数据结构上创建插入、删除、修改函数。您应该能够为您选择的数据结构找到大量开源代码。

无论哪种方式选择适当的数据结构，您都需要考虑查找和插入模式，您插入的频率如何？你多久“抬头”一次？是通过搜索匹配的字符串来完成查找，还是可以做一些更智能/更快的事情？基本上需要更多信息。

例如，如果字符串都是唯一的并且您处理大量字符串，那么计算字符串的哈希并将它们存储在类似 RB-tree 的东西中是有意义的。如果你从来没有得到超过 10 个字符串，那么这样做可能没有意义，或者应用程序可能是这样的，你可以简单地为字符串分配一个 ID 并将索引用作查找键。

有很多选择。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-25T03:12:16.043

我同意（许多！）其他人的观点，他们建议另一种数据结构可能更适合这种情况，但如果您出于某种原因**必须**使用，通常的启发式方法是`char**`

1.  始终保持当前长度和可用长度（例如在 a 中`struct`）和
2.  在 ing时总是将缓冲区大小增加两倍（或更多）`realloc`（这导致分配和应对的摊销 O(n) 时间）。

# string - 我的 C 程序中生成字符串所有可能排列的错误在哪里？

> ID：679889
> 
> 赞同：1
> 
> 时间：2009-03-25T01:26:10.370
> 
> 标签：string, permutation

我一直在尝试编写一个 C 程序来生成字符串的所有可能排列（例如下面代码中的 123）。我成功了，但它在每次可能的排列后都会产生一些垃圾值。请帮我找出可能的原因。它与初始化有关吗？代码：

```
#include <stdio.h>
void permute(char number[],char out[],int level,int used[]);
int main()
{   
    char number[] = "123";
    char out[3] = "asd";    // Random initialization
    int used[] = {0,0,0};    // To check if number has been used in the string output
    permute(number,out,0,used);
}   
void permute (char number[],char out[],int level,int used[])
{
    if (level == 3)
    {
        printf("%s\n",out);
        return;
    }
    int i;
    for(i = 0; i < 3;i++ )
    {
            if( used[i] == 1) continue;
            out[level] = number[i];
            used[i] = 1;
            permute( number, out, level + 1,used );
            used[i] = 0;
    }       
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-25T01:36:31.920

我的 C 非常生锈，但我的猜测是它是由于您的字符数组不是以空结尾的事实引起的。

一种选择是单独打印出每个字符：

```
if (level == 3)
{
    int p;
    for(p=0 ; p<3 ; p++) {
        printf("%c", out[p]);
    }
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-25T02:58:21.380

**字符输出[3] = "asd"; // 随机初始化**

将其更改为 out[4] 以便为终止 \0 字符留出空间，并且它应该可以按预期工作。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-25T01:38:37.297

如果你认为它应该停止打印`out`前三个字符之后的内容，问问你自己它是如何知道这样做的。

# .net - 网络服务客户端

> ID：679891
> 
> 赞同：1
> 
> 时间：2009-03-25T01:26:59.697
> 
> 标签：.net, web-services

我有一个基于 .net 的 asmx 服务，我试图找出当前正在使用它的客户端的详细信息。

只是想知道收集诸如客户端 IP 地址、使用我的服务的 URL 等信息的最佳方法是什么。

干杯

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-25T01:34:50.877

IIS 使用[LogParser](http://www.microsoft.com/downloads/details.aspx?FamilyID=890cd06b-abf8-4c25-91b2-f8d975cf8c07&displaylang=en)记录日志。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-25T02:46:35.573

请注意，除了有限的情况（如 Intranet），您收到的 IP 地址可能没有意义。它可以是代理服务器的 IP 地址，也可以是 NAT 设备给出的地址。如果您需要可靠性，那么您需要创造旨在识别机器的价值——IP 地址明确不意味着识别机器。

# nhibernate - 使用 NHibernate 和 Codesmith 生成 ORM

> ID：679895
> 
> 赞同：6
> 
> 时间：2009-03-25T01:30:51.963
> 
> 标签：nhibernate, codesmith

刚开始学习NHiberate。为每个数据库表编写适当的 hbm.xml 配置文件似乎相当乏味。

问题是 NHibernate 可以读入表并自动检索关系和所需的配置文件以及数据库映射器类吗？看来程序员一开始还是要做很多基础工作。然后我遇到了 Codesmith，它有 NIBerate 的模板？它填补了空白吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-25T01:33:47.543

您可以使用代码模板，但这仍然会造成痛苦恕我直言。最好的方法是使用[Fluent nHibernate](http://www.fluentnhibernate.org/)。他们有一个新的自动映射器功能，按惯例使用配置。没有映射文件，它只是假设您使用相似的名称，并且可以定义如何将实体名称转换为表名称的规则。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-25T01:38:33.083

代码生成可以很好地填补这个空白，我开始使用 CodeSmith，但后来他们把它变成了付费项目，所以我搬到了[MyGeneration](http://www.mygenerationsoftware.com)。我的方法是首先攻击数据库，生成映射文件的代码，如果它们尚不存在，则生成类。这让事情进展得非常快，非常适合原型和创建测试数据。

然后通常手动更改映射文件、类和数据库。在某些情况下，我尝试让代码生成作为 CI 的一部分工作——但事实证明，这样做很难，除非你对自己的部分进行了严格的规范，否则你是手工制作的代码更改。部分类是一个帮助，但仍然有可能让整个团队在同一页面上，没有人喜欢让他们的代码被工具覆盖，即使你可以回滚和合并。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-10-30T17:03:23.930

我为 CodeSmith 工作...请记住，MyGeneration 并没有永远更新，这意味着它也缺乏支持。CodeSmith 完全支持其产品和模板。这意味着任何模板错误也将由 Codesmith 修复和验证。

谢谢

——布莱克·涅米斯基

# c# - asp.net 中的 Web.Config 文件

> ID：679901
> 
> 赞同：0
> 
> 时间：2009-03-25T01:32:51.570
> 
> 标签：c#, asp.net, web-config

你能告诉我 web config 配置部分的确切实用视图吗

这是一个例子

```
<configuration>
  <configSections>
    <section name="loggingConfiguration" type="Microsoft.Practices.EnterpriseLibrary.Logging.Configuration.LoggingSettings, Microsoft.Practices.EnterpriseLibrary.Logging, Version=4.1.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35" />
    <section name="exceptionHandling" type="Microsoft.Practices.EnterpriseLibrary.ExceptionHandling.Configuration.ExceptionHandlingSettings, Microsoft.Practices.EnterpriseLibrary.ExceptionHandling, Version=4.1.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35" />
    <section name="dataConfiguration" type="Microsoft.Practices.EnterpriseLibrary.Data.Configuration.DatabaseSettings, Microsoft.Practices.EnterpriseLibrary.Data, Version=4.1.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35" />
    <sectionGroup name="system.web.extensions" type="System.Web.Configuration.SystemWebExtensionsSectionGroup, System.Web.Extensions, Version=3.5.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35">
      <sectionGroup name="scripting" type="System.Web.Configuration.ScriptingSectionGroup, System.Web.Extensions, Version=3.5.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35">
        <section name="scriptResourceHandler" type="System.Web.Configuration.ScriptingScriptResourceHandlerSection, System.Web.Extensions, Version=3.5.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35" allowDefinition="MachineToApplication" requirePermission="false" />
        <sectionGroup name="webServices" type="System.Web.Configuration.ScriptingWebServicesSectionGroup, System.Web.Extensions, Version=3.5.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35">
          <section name="jsonSerialization" type="System.Web.Configuration.ScriptingJsonSerializationSection, System.Web.Extensions, Version=3.5.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35" allowDefinition="Everywhere" requirePermission="false" />
          <section name="profileService" type="System.Web.Configuration.ScriptingProfileServiceSection, System.Web.Extensions, Version=3.5.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35" allowDefinition="MachineToApplication" requirePermission="false" />
          <section name="authenticationService" type="System.Web.Configuration.ScriptingAuthenticationServiceSection, System.Web.Extensions, Version=3.5.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35" allowDefinition="MachineToApplication" requirePermission="false" />
          <section name="roleService" type="System.Web.Configuration.ScriptingRoleServiceSection, System.Web.Extensions, Version=3.5.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35" requirePermission="false" allowDefinition="MachineToApplication" />
        </sectionGroup>
      </sectionGroup>
    </sectionGroup>
  </configSections> 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-25T01:45:56.950

你想知道它是什么意思吗？

它正在为您的 web.config 定义自定义部分。你应该看到

...配置文件中的某处。

它们都来自 Microsoft，前三个来自 EnterpriseLibrary。其余的用于 ASP.NET 中的 AJAX 支持。

如果你想知道这意味着什么：

```
System.Web.Configuration.ScriptingProfileServiceSection, System.Web.Extensions, Version=3.5.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35" 
```

这是一个完全限定的类型名称：

班级名称：

```
System.Web.Configuration.ScriptingProfileServiceSection 
```

大会名称：

```
System.Web.Extensions 
```

组装版本：

```
Version=3.5.0.0 
```

大会文化（语言）：

```
Culture=neutral 
```

和公钥令牌：

```
PublicKeyToken=31BF3856AD364E35 
```

公钥令牌是唯一标识程序集 (dll) 的公钥的一部分。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-25T02:13:58.100

XML 只是定义了碰巧由一些 MS 开发人员创建的自定义配置处理程序，但可能来自任何人。

本节：

```
<section name="loggingConfiguration" type="Microsoft.Practices.EnterpriseLibrary.Logging.Configuration.LoggingSettings, Microsoft.Practices.EnterpriseLibrary.Logging, Version=4.1.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35" /> 
```

允许使用自定义配置元素，例如：

```
<loggingConfiguration somesetting="test" /> 
```

反射使用 type 属性将自定义配置类绑定到 loggingConfiguration XML 元素。

来自 MSDN：[使用 ConfigurationSection 创建自定义配置部分](http://msdn.microsoft.com/en-us/library/2tw134k3.aspx) 这是一篇关于基础知识的优秀博客文章：自定义配置部分的基础[知识](http://www.csharpconsultant.net/post/2009/01/07/The-Very-Basics-of-a-Custom-ConfigurationSection.aspx)

# apache - 停止子域访问根

> ID：679903
> 
> 赞同：0
> 
> 时间：2009-03-25T01:33:50.397
> 
> 标签：apache, .htaccess, subdomain

我有这样的根和子域（给我的朋友）

/home/blahblah/ /home/blahblah/domain.com/

（阿帕奇服务器）

我可以通过使用一些 php shell 脚本来停止子域访问 root 吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-25T03:42:58.463

你能详细说明这个问题吗？

您可以使用 .htaccess 文件来限制/提供对各种事物的访问。您可以查看以下网站以获取更多信息：

[http://httpd.apache.org/docs/2.2/howto/htaccess.html](http://httpd.apache.org/docs/2.2/howto/htaccess.html)

（取决于您的 Apache 版本）

如果您指的是在使用 ftp / sftp 时阻止访问其他目录，则可以设置一个帐户以登录 chroot 环境，而无法访问其他区域。

# javascript - 如何测试一个空的 JavaScript 对象？

> ID：679915
> 
> 赞同：3899
> 
> 时间：2009-03-25T01:39:45.860
> 
> 标签：javascript, javascript-objects

在 AJAX 请求之后，有时我的应用程序可能会返回一个空对象，例如：

```
var a = {}; 
```

我如何检查是否是这种情况？

* * *

## 回答 #1

> 赞同：6926
> 
> 时间：2015-08-20T01:32:52.957

[ECMA 5+](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/keys#Browser_compatibility)：

```
// because Object.keys(new Date()).length === 0;
// we have to do some additional check
obj //  null and undefined check
&& Object.keys(obj).length === 0
&& Object.getPrototypeOf(obj) === Object.prototype 
```

但是请注意，这会创建一个不必要的数组（ 的返回值`keys`）。

前 ECMA 5：

```
function isEmpty(obj) {
  for(var prop in obj) {
    if(Object.prototype.hasOwnProperty.call(obj, prop)) {
      return false;
    }
  }

  return JSON.stringify(obj) === JSON.stringify({});
} 
```

[jQuery](https://api.jquery.com/jQuery.isEmptyObject/) :

```
jQuery.isEmptyObject({}); // true 
```

[lodash](https://lodash.com/docs#isEmpty)：

```
_.isEmpty({}); // true 
```

[下划线](https://underscorejs.org/#isEmpty)：

```
_.isEmpty({}); // true 
```

[胡克](https://github.com/hapijs/hoek)

```
Hoek.deepEqual({}, {}); // true 
```

[ExtJS](https://docs.sencha.com/extjs/6.0.2/modern/Ext.Object.html#method-isEmpty)

```
Ext.Object.isEmpty({}); // true 
```

[AngularJS（版本 1）](https://docs.angularjs.org/api/ng/function/angular.equals)

```
angular.equals({}, {}); // true 
```

[拉姆达](https://ramdajs.com/docs/#isEmpty)

```
R.isEmpty({}); // true 
```

* * *

## 回答 #2

> 赞同：1175
> 
> 时间：2009-03-25T01:49:24.137

如果[ECMAScript 5 支持](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/keys#Browser_compatibility)可用，您可以使用`Object.keys()`：

```
function isEmpty(obj) {
    return Object.keys(obj).length === 0;
} 
```

对于 ES3 和更早版本，没有简单的方法可以做到这一点。您必须明确地遍历属性：

```
function isEmpty(obj) {
    for(var prop in obj) {
        if(obj.hasOwnProperty(prop))
            return false;
    }

    return true;
} 
```

* * *

## 回答 #3

> 赞同：588
> 
> 时间：2010-05-19T14:07:51.293

对于那些有同样问题但使用 jQuery 的人，你可以使用[jQuery.isEmptyObject](http://api.jquery.com/jQuery.isEmptyObject/)。

* * *

## 回答 #4

> 赞同：266
> 
> 时间：2020-01-17T12:53:28.157

# 表现

2020.01.17 今天，我在 Chrome v79.0、Safari v13.0.4 和 Firefox v72.0 上对 macOS High Sierra 10.13.6 进行了测试；对于选择的解决方案。

## 结论

*   基于`for-in`(A, J, L, M) 的解是最快的
*   基于`JSON.stringify`(B, K) 的解决方案很慢
*   令人惊讶的是，基于`Object`(N) 的解决方案也很慢

[![在此处输入图像描述](https://i.stack.imgur.com/yqmYR.png)](https://i.stack.imgur.com/yqmYR.png)

# 细节

下面的代码段中提供了 15 个解决方案。如果您想在您的机器上运行性能测试，请单击[此处](https://jsbench.me/qfkqv692c8/1)。此链接已于 2021.07.08 更新，但最初在[此处](https://jsperf.com/object-empty-ch/1)执行测试- 上表中的结果来自那里（但现在看起来该服务不再有效）。

```
var log = (s, f) => console.log(`${s} --> {}:${f({})}  {k:2}:${f({ k: 2 })}`);

function A(obj) {
  for (var i in obj) return false;
  return true;
}

function B(obj) {
  return JSON.stringify(obj) === "{}";
}

function C(obj) {
  return Object.keys(obj).length === 0;
}

function D(obj) {
  return Object.entries(obj).length === 0;
}

function E(obj) {
  return Object.getOwnPropertyNames(obj).length === 0;
}

function F(obj) {
  return Object.keys(obj).length === 0 && obj.constructor === Object;
}

function G(obj) {
  return typeof obj === "undefined" || !Boolean(Object.keys(obj)[0]);
}

function H(obj) {
  return Object.entries(obj).length === 0 && obj.constructor === Object;
}

function I(obj) {
  return Object.values(obj).every((val) => typeof val === "undefined");
}

function J(obj) {
  for (const key in obj) {
    if (hasOwnProperty.call(obj, key)) {
      return false;
    }
  }
  return true;
}

function K(obj) {
  for (var prop in obj) {
    if (obj.hasOwnProperty(prop)) {
      return false;
    }
  }
  return JSON.stringify(obj) === JSON.stringify({});
}

function L(obj) {
  for (var prop in obj) {
    if (obj.hasOwnProperty(prop)) return false;
  }
  return true;
}

function M(obj) {
  for (var k in obj) {
    if (obj.hasOwnProperty(k)) {
      return false;
    }
  }
  return true;
}

function N(obj) {
  return (
    Object.getOwnPropertyNames(obj).length === 0 &&
    Object.getOwnPropertySymbols(obj).length === 0 &&
    Object.getPrototypeOf(obj) === Object.prototype
  );
}

function O(obj) {
  return !(Object.getOwnPropertyNames !== undefined
    ? Object.getOwnPropertyNames(obj).length !== 0
    : (function () {
        for (var key in obj) break;
        return key !== null && key !== undefined;
      })());
}

log("A", A);
log("B", B);
log("C", C);
log("D", D);
log("E", E);
log("F", F);
log("G", G);
log("H", H);
log("I", I);
log("J", J);
log("K", K);
log("L", L);
log("M", M);
log("N", N);
log("O", O);
```

[![在此处输入图像描述](https://i.stack.imgur.com/ma99z.png)](https://i.stack.imgur.com/ma99z.png)

* * *

## 回答 #5

> 赞同：226
> 
> 时间：2011-03-22T20:35:44.120

您可以使用[Underscore.js](http://underscorejs.org/#isEmpty)。

```
_.isEmpty({}); // true 
```

* * *

## 回答 #6

> 赞同：127
> 
> 时间：2013-11-06T13:48:25.147

```
if(Object.getOwnPropertyNames(obj).length === 0){
  //is empty
} 
```

见[http://bencollier.net/2011/04/javascript-is-an-object-empty/](http://bencollier.net/2011/04/javascript-is-an-object-empty/)

* * *

## 回答 #7

> 赞同：95
> 
> 时间：2013-01-23T20:07:39.217

使用 JSON.stringify 怎么样？它几乎在所有现代浏览器中都可用。

```
function isEmptyObject(obj){
    return JSON.stringify(obj) === '{}';
} 
```

* * *

## 回答 #8

> 赞同：63
> 
> 时间：2013-01-31T10:55:58.457

老问题，但只是有问题。如果您的唯一目的是检查对象是否为空，那么包含 JQuery 并不是一个好主意。相反，只要深入[JQuery 的代码](http://code.jquery.com/jquery-1.9.0.js)，你就会得到答案：

```
function isEmptyObject(obj) {
    var name;
    for (name in obj) {
        if (obj.hasOwnProperty(name)) {
            return false;
        }
    }
    return true;
} 
```

* * *

## 回答 #9

> 赞同：45
> 
> 时间：2012-04-29T19:25:48.123

如果您使用的是较新的浏览器，则有一种简单的方法。 `Object.keys(obj).length == 0`

* * *

## 回答 #10

> 赞同：44
> 
> 时间：2015-12-28T10:40:59.447

对于空对象，使用 Object.keys(obj).length （如上面对 ECMA 5+ 的建议）要慢 10 倍！保持老派（for...in）选项。

在 Node、Chrome、Firefox 和 IE 9 下测试，很明显对于大多数用例：

*   **(for...in...) 是最快的选择！**
*   **Object.keys(obj).length 比空对象慢 10 倍**
*   **JSON.stringify(obj).length 总是最慢的**（并不奇怪）
*   **Object.getOwnPropertyNames(obj).length 比 Object.keys(obj).length 花费**的时间更长，在某些系统上可能更长。

底线性能明智，使用：

```
function isEmpty(obj) { 
   for (var x in obj) { return false; }
   return true;
} 
```

或者

```
function isEmpty(obj) {
   for (var x in obj) { if (obj.hasOwnProperty(x))  return false; }
   return true;
} 
```

查看详细的测试结果和测试代码，[对象是否为空？](https://stackoverflow.com/questions/4994201/is-object-empty/34491287#34491287)

* * *

## 回答 #11

> 赞同：30
> 
> 时间：2012-06-08T08:04:07.907

我正在使用这个。

```
function isObjectEmpty(object) {
  var isEmpty = true;
  for (keys in object) {
     isEmpty = false;
     break; // exiting since we found that the object is not empty
  }
  return isEmpty;
} 
```

例如：

```
var myObject = {}; // Object is empty
var isEmpty  = isObjectEmpty(myObject); // will return true;

// populating the object
myObject = {"name":"John Smith","Address":"Kochi, Kerala"}; 

// check if the object is empty
isEmpty  = isObjectEmpty(myObject); // will return false; 
```

[从这里](https://kiranvj.com/blog/blog/how-to-check-if-a-javascript-object-is-empty/)

**更新**

或者

你可以使用 isEmptyObject 的 jQuery 实现

```
function isEmptyObject(obj) {
  var name;
  for (name in obj) {
    return false;
  }
  return true;
} 
```

* * *

## 回答 #12

> 赞同：27
> 
> 时间：2009-03-25T11:48:51.887

1.  只是一种解决方法。如果没有数据，您的服务器可以生成一些特殊属性吗？

    例如：

    ```
    var a = {empty:true}; 
    ```

    然后您可以轻松地在您的 AJAX 回调代码中检查它。

2.  另一种检查方法：

    ```
    if (a.toSource() === "({})")  // then 'a' is empty 
    ```

**编辑**：如果您使用任何 JSON 库（fe JSON.js），那么您可以尝试 JSON.encode() 函数并针对空值字符串测试结果。

* * *

## 回答 #13

> 赞同：25
> 
> 时间：2011-10-31T13:39:19.573

我的看法：

```
function isEmpty(obj) {
  return Object.keys(obj).length === 0;
}

var a = {
  a: 1,
  b: 2
}
var b = {}

console.log(isEmpty(a)); // false
console.log(isEmpty(b)); // true
```

只是，我认为`Object.keys()`目前并非所有浏览器都实现了。

* * *

## 回答 #14

> 赞同：18
> 
> 时间：2009-04-24T13:09:02.817

```
function isEmpty(obj) {
  for(var i in obj) { return false; }
  return true;
} 
```

* * *

## 回答 #15

> 赞同：17
> 
> 时间：2017-03-29T10:42:36.883

下面的例子展示了如何测试一个 JavaScript 对象是否为空，如果是空的，我们的意思是它没有自己的属性。

该脚本适用于 ES6。

```
const isEmpty = (obj) => {
    if (obj === null ||
        obj === undefined ||
        Array.isArray(obj) ||
        typeof obj !== 'object'
    ) {
        return true;
    }
    return Object.getOwnPropertyNames(obj).length === 0;
};
console.clear();
console.log('-----');
console.log(isEmpty(''));           // true
console.log(isEmpty(33));           // true
console.log(isEmpty([]));           // true
console.log(isEmpty({}));           // true
console.log(isEmpty({ length: 0, custom_property: [] })); // false
console.log('-----');
console.log(isEmpty('Hello'));      // true
console.log(isEmpty([1, 2, 3]));    // true
console.log(isEmpty({ test: 1 }));  // false
console.log(isEmpty({ length: 3, custom_property: [1, 2, 3] })); // false
console.log('-----');
console.log(isEmpty(new Date()));   // true
console.log(isEmpty(Infinity));     // true
console.log(isEmpty(null));         // true
console.log(isEmpty(undefined));    // true
```

* * *

## 回答 #16

> 赞同：13
> 
> 时间：2011-01-25T14:25:42.720

jQuery`isEmptyObject()`对这种情况有特殊的功能：

```
jQuery.isEmptyObject({}) // true
jQuery.isEmptyObject({ foo: "bar" }) // false 
```

阅读更多关于[http://api.jquery.com/jQuery.isEmptyObject/](http://api.jquery.com/jQuery.isEmptyObject/)

* * *

## 回答 #17

> 赞同：10
> 
> 时间：2018-04-09T09:37:41.263

正确答案是：

```
const isEmptyObject = obj =>
  Object.getOwnPropertyNames(obj).length === 0 &&
  Object.getOwnPropertySymbols(obj).length === 0 &&
  Object.getPrototypeOf(obj) === Object.prototype; 
```

这将检查：

*   该对象没有自己的属性（无论可枚举性如何）。
*   该对象没有自己的属性符号。
*   对象的原型正是`Object.prototype`.

换句话说，该对象与使用 创建的对象没有区别`{}`。

* * *

## 回答 #18

> 赞同：8
> 
> 时间：2011-05-24T01:52:50.207

警告！当心 JSON 的限制。

```
javascript:
  obj={  f:function(){}  };
  alert( "Beware!! obj is NOT empty!\n\nobj = {  f:function(){}  }" + 
               "\n\nJSON.stringify( obj )\n\nreturns\n\n" +
                        JSON.stringify( obj ) ); 
```

显示

```
    谨防！！obj 不为空！

    obj = { f:function(){} }

    JSON.stringify（对象）

    返回

    {}

```

* * *

## 回答 #19

> 赞同：8
> 
> 时间：2018-08-09T19:13:31.233

同时，我们可以使用一个函数来检查所有“空”，例如**null、undefined、''、' '、{}、[]**。

```
var isEmpty = function(data) {
  if (typeof(data) === 'object') {
    if (JSON.stringify(data) === '{}' || JSON.stringify(data) === '[]') {
      return true;
    } else if (!data) {
      return true;
    }
    return false;
  } else if (typeof(data) === 'string') {
    if (!data.trim()) {
      return true;
    }
    return false;
  } else if (typeof(data) === 'undefined') {
    return true;
  } else {
    return false;
  }
}

//Use cases and results.

console.log(isEmpty()); // true
console.log(isEmpty(null)); // true
console.log(isEmpty('')); // true
console.log(isEmpty('  ')); // true
console.log(isEmpty(undefined)); // true
console.log(isEmpty({})); // true
console.log(isEmpty([])); // true
console.log(isEmpty(0)); // false
console.log(isEmpty('Hey')); // false
```

* * *

## 回答 #20

> 赞同：7
> 
> 时间：2010-02-26T12:33:27.913

除了 Thevs 的回答：

```
var o = {};
alert($.toJSON(o)=='{}'); // true

var o = {a:1};
alert($.toJSON(o)=='{}'); // false 
```

这是 jquery + jquery.json

* * *

## 回答 #21

> 赞同：6
> 
> 时间：2012-08-16T09:46:12.813

[Sugar.JS](http://sugarjs.com/)为此目的提供了扩展对象。代码简洁明了：

制作一个扩展对象：

```
a = Object.extended({}) 
```

检查它的大小：

```
a.size() 
```

* * *

## 回答 #22

> 赞同：6
> 
> 时间：2019-04-19T17:31:46.873

纯原版 Javascript，完全向后兼容

```
function isObjectDefined (Obj) {
  if (Obj === null || typeof Obj !== 'object' ||
    Object.prototype.toString.call(Obj) === '[object Array]') {
    return false
  } else {
    for (var prop in Obj) {
      if (Obj.hasOwnProperty(prop)) {
        return true
      }
    }
    return JSON.stringify(Obj) !== JSON.stringify({})
  }
}

console.log(isObjectDefined()) // false
console.log(isObjectDefined('')) // false
console.log(isObjectDefined(1)) // false
console.log(isObjectDefined('string')) // false
console.log(isObjectDefined(NaN)) // false
console.log(isObjectDefined(null)) // false
console.log(isObjectDefined({})) // false
console.log(isObjectDefined([])) // false
console.log(isObjectDefined({a: ''})) // true
```

* * *

## 回答 #23

> 赞同：6
> 
> 时间：2019-05-23T08:07:56.893

要真正接受**ONLY** `{}`，使用 Lodash 在 Javascript 中执行此操作的最佳方法是：

```
_.isEmpty(value) && _.isPlainObject(value) 
```

* * *

## 回答 #24

> 赞同：5
> 
> 时间：2020-04-21T19:44:40.553

我能找到的最佳单线解决方案（更新）：

```
isEmpty = obj => !Object.values(obj).filter(e => typeof e !== 'undefined').length;

console.log(isEmpty({}))                                        // true
console.log(isEmpty({a: undefined, b: undefined}))              // true
console.log(isEmpty({a: undefined, b: void 1024, c: void 0}))   // true

console.log(isEmpty({a: [undefined, undefined]}))               // false
console.log(isEmpty({a: 1}))                                    // false
console.log(isEmpty({a: ''}))                                   // false
console.log(isEmpty({a: null, b: undefined}))                   // false
```

* * *

## 回答 #25

> 赞同：5
> 
> 时间：2020-07-19T05:53:29.257

# 1\. 使用 Object.keys

Object.keys 将返回一个数组，其中包含对象的属性名称。如果数组的长度为0，那么我们就知道对象是空的。

```
function isEmpty(obj) {
    return Object.keys(obj).length === 0 && empty.constructor === Object;
} 
```

我们还可以使用 Object.values 和 Object.entries 进行检查。这通常是确定对象是否为空的最简单方法。

# 2\. 使用 for...in 循环对象属性

for...in 语句将遍历对象的可枚举属性。

```
function isEmpty(obj) {
    for(var prop in obj) {
        if(obj.hasOwnProperty(prop))
            return false;
    }

    return true;
} 
```

在上面的代码中，我们会循环遍历对象的属性，如果一个对象至少有一个属性，那么它将进入循环并返回 false。如果对象没有任何属性，那么它将返回 true。

#3。使用 JSON.stringify 如果我们对对象进行字符串化并且结果只是一个左括号和右括号，我们就知道该对象是空的。

```
function isEmptyObject(obj){
    return JSON.stringify(obj) === '{}';
} 
```

# 4\. 使用 jQuery

```
jQuery.isEmptyObject(obj); 
```

# 5\. 使用下划线和 Lodash

```
_.isEmpty(obj); 
```

[资源](https://levelup.gitconnected.com/different-ways-to-check-if-an-object-is-empty-in-javascript-e1252d1c0b34)

* * *

## 回答 #26

> 赞同：5
> 
> 时间：2021-09-08T09:52:35.837

**IsEmpty** Object，出乎意料地失去了它的意义，即：它是编程*语义*，当我们著名的雅虎大师向 ECMA 引入定制的不可枚举的对象属性时，它们被接受了。

[如果你不喜欢历史 - 可以直接跳到工作代码]

我看到很多很好的答案\这个问题\问题的解决方案。但是，获取 ECMA 脚本的最新扩展并不是正确的方法。我们过去常常阻止 Web 以保持 Netscape 4.x 和基于 Netscape 的页面工作和项目的活力，这（顺便说一下）是极其原始的落后和特殊的，拒绝使用新的 W3C 标准和主张 [在那个时候是相当具有革命性的并且对编码人员友好]，而现在对我们自己的遗产却是残酷的。

杀死 Internet Explorer 11 是完全错误的！是的，一些自“冷战”时代以来一直处于休眠状态的渗透微软的老战士同意了——出于所有错误的原因。- 但这并不正确！

在您的答案中使用新引入的方法\属性并将其作为*发现*（“它一直存在，但我们没有注意到它”）而不是*新发明*（实际上是什么）移交，是有点“绿色”和有害。大约 20 年前，我曾经犯过这样的错误，当时我仍然无法分辨那里已经存在什么，并将所有我能找到参考的东西都视为一种常见的工作解决方案......

向后兼容性很重要！

我们只是还不知道。这就是我需要分享我的“百年老”通用解决方案的原因，该解决方案仍然向后和向前兼容，以适应不可预见的未来。

***对in**运算符*有很多攻击，但我认为这样做的人终于明白了，并真正开始理解和欣赏真正的动态类型语言，如 JavaScript 及其美丽的本质。

我的方法旨在简单而有核，出于上述原因，我不称其为“空”，因为该词的含义不再准确。Is Enumerable，似乎是具有确切含义的词。

```
function isEnum( x ) { for( var p in x )return!0; return!1 }; 
```

一些用例：

```
isEnum({1:0})
true

isEnum({})
false

isEnum(null)
false 
```

谢谢阅读！

* * *

## 回答 #27

> 赞同：4
> 
> 时间：2015-06-05T17:16:28.343

另一种选择是使用[is.js](http://arasatasaygin.github.io/is.js/) (14kB) 而不是[jquery](http://jquery.com/) (32kB)、[lodash](https://lodash.com/) (50kB) 或[下划线](http://underscorejs.org/)(16.4kB)。is.js 被证明是上述可用于确定对象是否为空的库中最快的库。

[http://jsperf.com/check-empty-object-using-libraries](http://jsperf.com/check-empty-object-using-libraries)

显然，所有这些库并不完全相同，因此如果您需要轻松操作 DOM，那么[jquery](http://jquery.com/)可能仍然是一个不错的选择，或者如果您需要的不仅仅是类型检查，那么[lodash](https://lodash.com/)或[下划线](http://underscorejs.org/)可能会很好。至于[is.js](http://arasatasaygin.github.io/is.js/)，语法如下：

```
var a = {};
is.empty(a); // true
is.empty({"hello": "world"}) // false 
```

像 underscore's 和 lodash's 一样`_.isObject()`，这不仅适用于 and ，`objects`而且也适用于`arrays`and `strings`。

在这个库的底层使用`Object.getOwnPropertyNames`它类似于`Object.keys`但`Object.getOwnPropertyNames`更彻底，因为它将返回可枚举和不可枚举的属性，如此[处](https://stackoverflow.com/questions/22658488/object-getownpropertynames-vs-object-keys)所述。

```
is.empty = function(value) {
    if(is.object(value)){
        var num = Object.getOwnPropertyNames(value).length;
        if(num === 0 || (num === 1 && is.array(value)) || (num === 2 && is.arguments(value))){
            return true;
        }
        return false;
    } else {
        return value === '';
    }
}; 
```

如果您不想引入库（这是可以理解的）并且您知道您只检查对象（而不是数组或字符串），那么以下函数应该适合您的需要。

```
function isEmptyObject( obj ) {
    return Object.getOwnPropertyNames(obj).length === 0;
} 
```

这只是比 is.js 快一点，只是因为你没有检查它是否是一个对象。

* * *

## 回答 #28

> 赞同：4
> 
> 时间：2018-06-27T11:24:01.807

奇怪的是，我还没有遇到一个解决方案来比较对象的**值**而不是任何条目的存在（也许我在许多给定的解决方案中错过了它）。
如果对象的所有值都未定义，我想介绍一个对象被认为是空的情况：

```
 const isObjectEmpty = obj => Object.values(obj).every(val => typeof val === "undefined")

    console.log(isObjectEmpty({}))                                 // true
    console.log(isObjectEmpty({ foo: undefined, bar: undefined })) // true
    console.log(isObjectEmpty({ foo: false,     bar: null }))      // false
```

## 示例用法

假设，为了举例，你有一个函数 ( )，它从它的参数(和)`paintOnCanvas`中破坏值。如果它们**都**未定义，则它们将被排除在结果选项集之外。如果不是，它们不是，它们都包括在内。`x``y``size`

 **```
function paintOnCanvas ({ brush, x, y, size }) {
  const baseOptions = { brush }
  const areaOptions = { x, y, size }
  const options = isObjectEmpty(areaOptions) ? baseOptions : { ...baseOptions, areaOptions }
  // ...
} 
```

* * *

## 回答 #29

> 赞同：4
> 
> 时间：2020-02-20T23:29:44.243

我知道这不能 100% 回答您的问题，但我之前也遇到过类似的问题，以下是我用来解决这些问题的方法：

我有一个可能返回空对象的 API。因为**我知道**API 需要哪些字段，所以我只检查是否存在任何必填字段。

例如：

API 返回`{} or {agentID: '1234' (required), address: '1234 lane' (opt),...}`. 在我的调用函数中，我只会检查

```
if(response.data && response.data.agentID) { 
  do something with my agentID 
} else { 
  is empty response
} 
```

这样我就不需要使用那些昂贵的方法来检查对象是否为空。如果我的调用函数没有 agentID 字段，该对象将为空。

* * *

## 回答 #30

> 赞同：4
> 
> 时间：2020-07-19T17:08:46.103

我们也可以使用 vanilla js 来处理 null 或 undefined 检查，如下所示，

```
function isEmptyObject(obj) {
  return !!obj && Object.keys(obj).length === 0 && obj.constructor === Object;
}

//tests

isEmptyObject(new Boolean());  // false 
isEmptyObject(new Array());    // false 
isEmptyObject(new RegExp());   // false 
isEmptyObject(new String());   // false 
isEmptyObject(new Number());   // false 
isEmptyObject(new Function()); // false 
isEmptyObject(new Date());     // false
isEmptyObject(null);          // false
isEmptyObject(undefined);     // false
isEmptyObject({});            // true
```

* * *

## 回答 #31

> 赞同：4
> 
> 时间：2020-08-15T07:29:28.367

我喜欢我想出的这个，这里有一些其他答案的帮助。以为我会分享它。

```
Object.defineProperty(Object.prototype, 'isEmpty', {
    get() {
        for(var p in this) {
            if (this.hasOwnProperty(p)) {return false}
        }
        return true;
    }
});

let users = {};
let colors = {primary: 'red'};
let sizes = {sm: 100, md: 200, lg: 300};

console.log(
'\nusers =', users,
'\nusers.isEmpty ==> ' + users.isEmpty,
'\n\n-------------\n',
'\ncolors =', colors,
'\ncolors.isEmpty ==> ' + colors.isEmpty,
'\n\n-------------\n',
'\nsizes =', sizes,
'\nsizes.isEmpty ==> ' + sizes.isEmpty,
'\n',
''
);
```

* * *

## 回答 #32

> 赞同：3
> 
> 时间：2014-10-20T11:28:24.310

这一行代码也有助于回退到旧浏览器。

```
var a = {}; //if empty returns false
(Object.getOwnPropertyNames ? Object.getOwnPropertyNames(a).length !== 0 : (function(){ for(var key in a) break; return !!key })()) //Returns False

var a = {b:2}; //if not empty returns true
(Object.getOwnPropertyNames ? Object.getOwnPropertyNames(a).length !== 0 : (function(){ for(var key in a) break; return !!key })()) //Returns true 
```

* * *

**[Object.getOwnPropertyNames](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/getOwnPropertyNames)**在 ECMA-5 中实现。上面的行适用于具有后备功能的旧浏览器。

* * *

> 另一个快速解决方案是检查`length`, [`Object.keys`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/keys)或[`Object.entries`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/entries)[`Object.values`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/values)

**知识文章：关注此 SO 帖子了解**[Object.keys 与 Object.getOwnPropertyNames](https://stackoverflow.com/questions/22658488/object-getownpropertynames-vs-object-keys)之间的详细区别

* * *

## 回答 #33

> 赞同：3
> 
> 时间：2015-11-23T12:30:35.180

我不敢相信经过两年的 js 编程，它从来没有点击过空对象和数组不是假的，最奇怪的是它从来没有让我失望。

`true`如果输入默认为假，或者它是一个空对象或数组，这将返回。倒数是`trueish`函数

[http://codepen.io/synthet1c/pen/pjmoWL](http://codepen.io/synthet1c/pen/pjmoWL)

```
function falsish( obj ){
    if( (typeof obj === 'number' && obj > 0) || obj === true ){
        return false;
    }
    return !!obj
        ? !Object.keys( obj ).length
        : true;
}

function trueish( obj ){
    return !falsish( obj );
}

falsish({})           //=> true
falsish({foo:'bar'})  //=> false
falsish([])           //=> true
falsish(['foo'])      //=> false
falsish(false)        //=> true
falsish(true)         //=> false
// the rest are on codepen 
```

* * *

## 回答 #34

> 赞同：3
> 
> 时间：2019-03-21T01:56:41.760

```
export function isObjectEmpty(obj) {
  return (
    Object.keys(obj).length === 0 &&
    Object.getOwnPropertySymbols(obj).length === 0 &&
    obj.constructor === Object
  );
} 
```

这包括检查包含**符号属性的对象。**

**Object.keys**不检索符号属性。

* * *

## 回答 #35

> 赞同：3
> 
> 时间：2020-04-07T05:13:44.597

检查值的新方法是 if(Object.entries(this.props.myarticle).length===0){ }

这里 myarticles 是对象

* * *

## 回答 #36

> 赞同：3
> 
> 时间：2020-09-02T07:48:39.807

大多数情况下，您想知道的是，对象在使用之前是否具有属性。因此，不要询问`isEmpty`然后总是检查否定，就像`if(!isEmpty(obj))`您可以测试对象是否不为空并且具有属性一样

```
export function hasProperties(obj): boolean {
  return obj && obj.constructor === Object && Object.keys(obj).length >= 1;
} 
```

* * *

## 回答 #37

> 赞同：2
> 
> 时间：2021-06-01T10:09:36.457

```
isEmptyObject(value) {
  return value && value.constructor === Object && Object.keys(value).length === 0;
} 
```

上面的代码足以检查对象的空性。

一篇非常好的文章写在[how-to-check-if-object-is-empty](https://www.samanthaming.com/tidbits/94-how-to-check-if-object-is-empty/)

* * *

## 回答 #38

> 赞同：1
> 
> 时间：2014-04-19T07:19:08.567

从 jQuery 1.4开始，`isEmptyObject()`方法检查对象本身的属性和从原型继承的属性（因为它不使用 hasOwnProperty）。参数应该始终是纯 JavaScript 对象，因为其他类型的对象（DOM 元素、原始字符串/数字、宿主对象）可能无法在浏览器中给出一致的结果。要确定一个对象是否是纯 JavaScript 对象，请使用`$.isPlainObject()`.

```
jQuery.isPlainObject({}) // true

jQuery.isPlainObject( "test" ) // false 
```

[jQuery API](http://api.jquery.com/jQuery.isPlainObject/)

* * *

## 回答 #39

> 赞同：1
> 
> 时间：2014-06-06T17:58:06.290

我为 AJAX 调用返回了一个空的 JSON 响应，并且在 IE8 中 jQuery.isEmptyObject() 没有正确验证。我添加了一个额外的检查，似乎可以正确捕获它。

```
.done(function(data)
{  
    // Parse json response object
    var response = jQuery.parseJSON(data);

    // In IE 8 isEmptyObject doesn't catch the empty response, so adding additional undefined check
    if(jQuery.isEmptyObject(response) || response.length === 0)
    {
        //empty
    }
    else
    {
        //not empty
    }
}); 
```

* * *

## 回答 #40

> 赞同：1
> 
> 时间：2015-02-18T10:25:45.377

```
 isEmpty = function(obj) {
      if (obj == null) return true;
      if (obj.constructor.name == "Array" || obj.constructor.name == "String") return obj.length === 0;
      for (var key in obj) if (isEmpty(obj[key])) return true;
      return false;
    } 
```

这将检查字符串、数组或对象（映射）的空性。

用法 ：

```
var a = {"a":"xxx","b":[1],"c":{"c_a":""}}
isEmpty(a); // true, because a.c.c_a is empty.
isEmpty("I am a String"); //false 
```

* * *

## 回答 #41

> 赞同：0
> 
> 时间：2015-06-10T11:39:32.253

您可以在使用它之前或在代码开头定义自己的对象原型。

定义应如下所示：

```
Object.prototype.hasOwnProperties = function()
{ 
  for (var k in this)
  { 
    if ( this.hasOwnProperty(k) )
    { 
      return true;
    } 
  }
  return false;
}
```

这是一个使用示例：

```
var a = {};

while ( a.status !== "finished" )
{  
  if ( status === "processing" )
  {
    a.status = "finished";  
  }

  if ( status === "starting" )
  {
    a.status = "processing";  
  }

  if ( !a.hasOwnProperties() )
  {
    a.status = "starting";
  }
}
```

享受！:-)

* * *

## 回答 #42

> 赞同：0
> 
> 时间：2018-08-14T21:49:51.310

这就是我想出的，用来判断对象中是否有任何非空值。

```
function isEmpty(obj: Object): Boolean {
    for (const prop in obj) {
        if (obj.hasOwnProperty(prop)) {
            if (obj[prop] instanceof Object) {
                const rtn = this.isEmpty(obj[prop]);
                if (rtn === false) {
                  return false;
                }
            } else if (obj[prop] || obj[prop] === false) {
                return false;
            }
        }
    }
    return true;
} 
```

* * *

## 回答 #43

> 赞同：0
> 
> 时间：2019-10-18T09:43:38.273

这与在**lodash**源中检查 object 的方式类似：

```
const isEmpty = value => {
  for (const key in value) {
    if (hasOwnProperty.call(value, key)) {
      return false
    }
  }
  return true;
} 
```

但是还有很多其他方法可以做到这一点。

* * *

## 回答 #44

> 赞同：0
> 
> 时间：2019-10-23T15:29:04.927

isEmpty 表示任何类型的值

```
/* eslint-disable no-nested-ternary */

const isEmpty = value => {
  switch (typeof value) {
    case 'undefined':
      return true;
    case 'object':
      return value === null
        ? true
        : Array.isArray(value)
        ? !value.length
        : Object.entries(value).length === 0 && value.constructor === Object;
    case 'string':
      return !value.length;
    default:
      return false;
  }
}; 
```

* * *

## 回答 #45

> 赞同：0
> 
> 时间：2019-11-15T14:12:26.317

```
 let jsObject = JSON.parse(JSON.stringify(obj), (key, value) => {
                if (value === null ||
                    value === '' ||
                    (value.constructor === Object && Object.entries(value).length === 0) ||
                    (value.constructor === Array && value.length === 0)) {
                    return undefined
                }
                return value
            }) 
```

这将递归过滤掉所有无效字段。

* * *

## 回答 #46

> 赞同：0
> 
> 时间：2021-03-20T08:19:04.020

您可以使用 lodash 库而不是制作普通的 JS 函数。

_.isEmpty({}) // 真

这将检查数组和对象是否有值并返回布尔值。

* * *

## 回答 #47

> 赞同：-1
> 
> 时间：2012-03-15T03:52:34.410

这是一个快速、简单的函数：

```
function isEmptyFunction () {
  for (const i in this) return false
  return true
} 
```

作为吸气剂实现：

```
Object.defineProperty(Object.prototype, 'isEmpty', { get: isEmptyFunction })

console.log({}.isEmpty) // true 
```

作为一个单独的函数实现：

```
const isEmpty = Function.prototype.call.bind(isEmptyFunction)

console.log(isEmpty({})) // true 
```

* * *

## 回答 #48

> 赞同：-1
> 
> 时间：2017-11-08T11:06:17.143

尝试[解构](http://exploringjs.com/es6/ch_destructuring.html)

```
const a = {};
const { b } = a;
const emptryOrNot = (b) ? 'not Empty' : 'empty';
console.log(emptryOrNot) 
```

* * *

## 回答 #49

> 赞同：-2
> 
> 时间：2019-11-15T18:06:32.117

### 完美的故障安全解决方案

我认为第一个接受的解决方案在大多数情况下都有效，但不是**Failsafe**。

更好和故障安全的解决方案将是。

```
function isEmptyObject() { 
  return toString.call(obj) === "[object Object]" 
  && Object.keys(obj).length === 0;
} 
```

**或在 ES6/7 中**

```
const isEmptyObject = () => toString.call(obj) === "[object Object]" 
  && Object.keys(obj).length === 0; 
```

使用这种方法，如果 obj 设置为 undefined 或 null，则代码不会中断。并返回空值。

# css - Chrome 和 IE 中的不透明度问题

> ID：679918
> 
> 赞同：0
> 
> 时间：2009-03-25T01:40:58.883
> 
> 标签：css, cross-browser, opacity

我在 IE 7 和 Chrome 中看到奇怪的行为，在我的导航中更改了透明背景 png 的不透明度。

的CSS：

```
 ul.tabs a {
    height: 48px;
    filter:alpha(opacity=80);
    -moz-opacity:0.8;
    -khtml-opacity: 0.8;
    opacity: 0.8;
    }

 div.header ul.tabs a:hover {  
    filter:alpha(opacity=100);
    -moz-opacity:1;
    -khtml-opacity: 1;
    opacity: 1;
    } 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-25T14:41:34.950

我相信在 IE7 中渲染看起来很糟糕的原因是因为 IE7 不能很好地处理不透明度。Rick Strahl 在一篇名为[Internet Explorer 7.0 和不透明度的博文中注意到了这个问题：甚至没有接近！](http://www.west-wind.com/WebLog/posts/7223.aspx)

该博客文章的一条评论链接到 IE 博客文章[IE7 中 ClearType 与 DXTransforms 交互的注释](http://blogs.msdn.com/ie/archive/2006/08/31/730887.aspx)，我们了解到 IE 团队已意识到该问题并提供了包含此 gem 的“解释”：

> “正如我们的用户也注意到的那样，ClearType 文本看起来非常模糊 - 不幸的是这两种技术不能很好地混合。这是因为 DXTransforms 使用的基本卷积变换没有考虑到 ClearType 的空间特性。”

我相信 IE 团队能够将 ClearType 空间卷积转换责任合并到 IE8 中，但是，唉，这并没有进入 IE7。

# c# - 如何在 ASP.NET MVC 中使用 DRY 原则重构此代码？

> ID：679920
> 
> 赞同：4
> 
> 时间：2009-03-25T01:41:25.043
> 
> 标签：c#, asp.net-mvc, coding-style, dry

我的一个控制器中有几种方法可以做到这一点：

```
ViewData["Customers"] = LoadCustomers();
ViewData["Employees"] = LoadEmployees();
ViewData["Statuses"] = LoadStatuses();
etc...... 
```

这是 LoadCustomers()，但 LoadEmployees、LoadStatuses 和所有其他的逻辑几乎完全相同：

```
private static SelectList LoadCustomers()
    {
        IList<Customer> customers;
        try
        {
            IServiceCallService scService = new ServiceCallService();
            customers = scService.GetCustomers();
            Customer c = new Customer
            {
                ID = "",
                Name = "-- Select a Facility --"
            };
            customers.Insert(0, c);
        }
        catch
        {
            customers = new List<Customer>();
            Customer c = new Customer
            {
                ID = "",
                Name = "-- No Facilities on File --"
            };
            customers.Insert(0, c);
        }

        return new SelectList(customers, "ID", "Name");
    } 
```

如何更好地编写此代码，以便每次添加新选择列表时都不需要新方法？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-25T01:49:13.840

这看起来可能是泛型的一个很好的候选者：

```
private static SelectList LoadItems<T>() where T : new, ... 
{                                                // Add any additional interfaces
                                                 // that need to be supported by T
                                                 // for your Load method to work,
                                                 // as appropriate.
    IList<T> items;
    try
    {
        IServiceCallService scService = new ServiceCallService();
        results = scService.Get<T>();  // You'll need to replace GetCustomers() with
                                       //   a generic Get<T> method.

        // ...
    }
    catch         // Really needed? What are you trying to catch here? (This catches
    {             //   everything silently. I suspect this is overkill.)
        // ...
    }

    return new SelectList(items, "ID", "Name");
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-25T12:18:04.763

您也可以尝试更实用的方法。

```
public IList<T> Load<T>(Func<IList<T>> getList, T prependItem)
{
    var list = getList();
    list.Insert(0, prependItem);
    return list;
} 
```

用法：

```
var prependItem = new Customer { ID = "", Name = "-- Select a Facility --" };
ViewData["Customers"] = new SelectList(
    Load(new ServiceCallService().GetCustomers(), prependItem),
    "ID", "Name"); 
```

这种方法还将列表的构造与正在构造的细节（SelectList）分开。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-25T13:58:49.763

I'd go even further and write this in controller code:

```
 ViewData["Customers"] = new SelectList(
      new ServiceCallService().GetCustomers(),
      "ID","Name") 
```

and this in view

```
<%= Html.DropDownList("Customers",
     ((SelectList)ViewData["Customers"]).Count() > 0 ? 
    "-- Select a Facility --" : "-- No Facilities on File --" ) %> 
```

# iphone - 如何使用 CGContextDrawTiledImage 平铺图像？

> ID：679925
> 
> 赞同：8
> 
> 时间：2009-03-25T01:42:13.823
> 
> 标签：iphone, cocoa-touch

我希望能够像 UIImageView 这样的 UI 对象并在其中平铺图像。

我已经能够使用 CGContextDrawTiledImage 来更新主窗口中的背景，但不能更新图像视图。如果我修改 MainView 类中的 drawRect 函数，我可以做到这一点。

我觉得我很接近，但仍然缺少一些东西。有人可以指出我正确的方向吗？

```
- (void)drawRect:(CGRect)rect {

CGImageRef image = CGImageRetain(currentImage.CGImage);

CGRect imageRect;
imageRect.origin = CGPointMake(160, 240);
imageRect.size = CGSizeMake(320.0, 480.0);

CGContextRef uiContext = UIGraphicsGetCurrentContext();

CGContextClipToRect(uiContext, CGRectMake(0.0, 0.0, rect.size.width, rect.size.height));

CGContextDrawTiledImage(uiContext, imageRect, image); 
```

}

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2010-07-12T07:25:06.923

如果您只想在视图中平铺图像，请将其更改为普通 UIView 并使用 UIColor initWithPatternImage 平铺背景：

```
backgroundView.backgroundColor = [[UIColor alloc] initWithPatternImage:[UIImage imageWithContentsOfFile:[self bundlePath:@"some_tile_image.png" inDirectory:@"tiles"]]]; 
```

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-04-01T21:03:00.423

假设你有一个`CGImageRef`你想要平铺的图像，`tileImage`还有一个`UIImageView`被调用的`imageView`。您需要做的是创建一个分配`UIImage`给`image`. `imageView`你可以这样做：

```
CGSize imageViewSize = imageView.bounds.size;
UIGraphicsBeginImageContext(imageViewSize);
CGContextRef imageContext = UIGraphicsGetCurrentContext();
CGContextDrawTiledImage(imageContext, (CGRect){ CGPointZero, imageViewSize }, tileImage);
UIImage *finishedImage = UIGraphicsGetImageFromCurrentImageContext();
UIGraphicsEndImageContext();

imageView.image = finishedImage; 
```

这将创建所需大小的位图图像上下文，将图像平铺到该上下文中，从上下文中获取 a `UIImage`，然后将其分配给`UIImageView`. 只要图像视图和平铺图像已加载并准备就绪，您就可以真正将此代码放在任何地方。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-29T19:19:57.073

与其尝试修改 UIImageView，不如考虑子类化 UIView。UIImageView 是专门为一个非平铺图像设计的，一些内部结构可能会搞砸你。它并不是真的打算按照您描述的方式进行修改。

在 UIView (UITiledImageView?) 的子类中，您可以使用 drawRect: 方法来做您想做的事。您甚至可以为图像、其大小和平铺属性创建 ivars，以获得更大的灵活性和可扩展性。

更新了示例项目：http: [//github.com/kailoa/6tringle-tiledimageview/tree/master](http://github.com/kailoa/6tringle-tiledimageview/tree/master)

相关绘图代码：

```
- (void)drawRect:(CGRect)rect 
{
    if (TiledImage) {

        //Since we are retaining the image, we append with ret_ref.  this reminds us to release at a later date.
        CGImageRef image_to_tile_ret_ref = CGImageRetain(TiledImage.CGImage); 

        CGRect image_rect;
        image_rect.size = TiledImage.size;  //This sets the tile to the native size of the image.  Change this value to adjust the size of an indivitual "tile."

        CGContextRef context = UIGraphicsGetCurrentContext();

        CGContextDrawTiledImage(context, image_rect, image_to_tile_ret_ref);

        CGImageRelease(image_to_tile_ret_ref);
    }
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-07-31T03:34:50.490

很抱歉不知道如何为其他人的答案添加评论，所以我在这里创建了一个新答案：

我只想指出 Kailoa Kadano 提供的答案有一个错误，image_rect.origin 没有正确初始化。

About 3 weeks ago, I copied his code in my project, and it seems working. However, yesterday, I tried to run the code in ios simulator(iphone 4.3), it just hang in CGContextDrawTiledImage. After adding the following line as showed in keremk's answer:

```
image_rect.origin = CGPointMake(0.0, 0.0); 
```

it works again!

It's rather tricky, actually at first I tested under iphone 4.3 simulator, then recently I tested under iphone 4.0 simulator, then yesterday when I switched back to 4.3 simulator or 4.2 simulator, the problem occurs. That is the image_rect.origin is undefined, sometimes it's zero data, maybe sometimes it has some random data.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-29T19:30:14.367

我最近通过创建自定义 UIView 来做到这一点。

```
@interface TiledImageView : UIView {
@private
    UIImage *image_;
}

@property (nonatomic, retain) UIImage *image;
@end 
```

对于 .m 文件：

```
@implementation TiledImageView
@synthesize image = image_;

- (void)dealloc {
    [image_ release];
    [super dealloc];
}

- (id)initWithFrame:(CGRect)frame {
    if (self = [super initWithFrame:frame]) {
        // Initialization code
        self.image = [UIImage imageNamed:@"BGTile.png"];

    }
    return self;
}

- (void)drawRect:(CGRect)rect {
    // Drawing code
    CGImageRef image = CGImageRetain(image_.CGImage);

    CGRect imageRect;
    imageRect.origin = CGPointMake(0.0, 0.0);
    imageRect.size = CGSizeMake(CGImageGetWidth(image), CGImageGetHeight(image));

    CGContextRef context = UIGraphicsGetCurrentContext();   
    CGContextClipToRect(context, CGRectMake(0.0, 0.0, rect.size.width, rect.size.height));  
    CGContextDrawTiledImage(context, imageRect, image);
    CGImageRelease(image);
}

@end 
```

# ruby-on-rails - 如何让故事与 restful_authentication 和 cucumber 一起工作？

> ID：679928
> 
> 赞同：2
> 
> 时间：2009-03-25T01:44:31.853
> 
> 标签：ruby-on-rails, rspec, cucumber, restful-authentication, rspec-stories

克隆最新的稳定版本后

*   [导轨](http://github.com/rails/rails/tree/master)（2.3.2），
*   [rspec](http://github.com/dchelimsky/rspec/tree/master) (1.2.2),
*   [黄瓜](http://wiki.github.com/aslakhellesoy/cucumber)（0.2.0.4...2009-03-24出来），
*   [rspec-rails](http://wiki.github.com/dchelimsky/rspec-rails) (1.2.2),
*   [restful-authentication](http://github.com/technoweenie/restful-authentication/tree/master)（修复了 formatted_user_path 和其他一些问题），
*   [韦拉特](http://wiki.github.com/brynary/webrat)，
*   [rubyist-aasm](http://github.com/rubyist/aasm/tree/master)（和其他一些）

进入一个干净的rails应用程序，并遵循（我相信是）每个插件的所有说明，黄瓜故事仍然失败:-(。这是问题的总结：

1.  尽管创建了 'map.root :controller => "my_controller"' 路由，但重定向并不能立即工作：

    ```
    预期重定向到“/”，没有重定向（Spec::Expectations::ExpectationNotMetError）
    /cygdrive/c/development/test/vendor/plugins/rspec/lib/spec/expectations.rb:57:in `fail_with'
    /cygdrive/c/development/test/vendor/plugins/rspec/lib/spec/expectations/handler.rb:14:in `handle_matcher'
    /cygdrive/c/development/test/vendor/plugins/rspec/lib/spec/expectations/extensions/object.rb:31:in `should'。
    /features/step_definitions/user_steps.rb:111:in `/^an? (.*) 用户名​​为 '(.*)'$/'
    features/sessions.feature:25:in `和一个名为'reggie'的激活用户'

    ```

2.  故事说尽管文件调用 该`logged_in?`方法受到保护：`features/step_definitions/ra_env.rb`

    ```
    ApplicationController.send(:public, :logged\_in?, :current\_user, :authorized?)
    ```

    该调用不是使这些方法无需存根即可使用吗？

哦，我正在尝试运行 autospec，所以我执行了以下命令来启动它：

```
导出 AUTOFEATURE=true
耙规格：服务器：开始
红宝石脚本/自动规范

```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-31T23:07:24.967

我做了一些研究，这就是我得到的。`ra_response_steps.rb`期望重定向变得粗糙，然后定义是否应该遵循重定向的故事。这是失败的，因为 Webrat Session 实现具有以下代码：

```
    def request_page(url, http_method, data) #:nodoc:
      h = 标题
      h['HTTP_REFERER'] = @current_url 如果@current_url

      debug_log "请求页面：#{http_method.to_s.upcase} #{url} 与 #{data.inspect} 和 HTTP 标头 #{h.inspect}"
      如果 h.empty？
        发送“#{http_method}”，网址，数据|| {}
      别的
        发送“#{http_method}”，网址，数据|| {}， H
      结尾

      如果 exception_caught，保存_and_open_page？&& Webrat.configuration.open_error_files?
      raise PageLoadError.new("页面加载不成功（代码：#{response_code.inspect}):\n#{formatted_error}"）除非success_code？

      重启

      @current_url = 网址
      @http_method = http_method
      @数据 = 数据

      如果内部重定向？
        check_for_infinite_redirects
        request_page(response_location, :get, {})
      结尾

      返回响应
    结尾

```

注意`if internal_redirect? ... end`. 这就是使我们的测试失败的原因，因为 webrat 正在跟踪重定向。作为一种解决方法，您可以在 webrat 会话中评论这些行，但这可能不是一个体面的解决方案。我会做更多的工作并在某处发布补丁。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-02-02T06:53:25.377

我发现这篇博文很好地解释了问题的症结所在：

[http://blog.andrew.premdas.org/articles/2008/10/15/webrat-visits-and-redirects](http://blog.andrew.premdas.org/articles/2008/10/15/webrat-visits-and-redirects)

基本上，restful 身份验证测试正在尝试测试不应该使用 webrat 测试的东西。因此，上面推荐的更改与我认为可能应该更改的相反。

我已经更改了 Restful 身份验证测试，以便它们不测试重定向，而只是测试您最终进入的页面。但是，某些我不理解的重定向似乎仍然存在问题：

```
Then she should be at the new session page                     # features/step_definitions/ra_response_steps.rb:15
  expected "session/new", got redirected to "http://www.example.com/session/new" (Spec::Expectations::ExpectationNotMetError) 
```

我不明白这个 example.com 是从哪里来的。其他人有类似的错误吗？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-29T18:41:04.437

我不得不将 user_steps.rb 中注销功能的定义更改为：

def log_out
  get '/logout'
结束

在它试图获取仅在您不删除默认路由时才存在的“/session/destroy”之前。

此外，请确保您在 application_controller 中“包含 AuthenticatedSystem”。

尽管如此，仍在努力解决其他一些问题......

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-05T18:07:56.387

至于“受保护的方法”问题，我发现如果我不使用 autospec 并保留 config.cache_classes=true，那么测试通过。

将 config.cache_classes=false 再次引入错误。

似乎问题在于如何在 rails 中实现类缓存，或者 rspec 如何管理已创建的类。不幸的是，我没有资源对整个日志进行更多调查，并且似乎在以下位置进行了很好的讨论： [http ://groups.google.com/group/rspec/browse_thread/thread/500ede090bd08996/ 25a3d9a7d283696b?lnk=gst&q=cache_classes#25a3d9a7d283696b](http://groups.google.com/group/rspec/browse_thread/thread/500ede090bd08996/25a3d9a7d283696b?lnk=gst&q=cache_classes#25a3d9a7d283696b)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-25T17:10:18.087

我没有太多的指导可以提供，只是同情——我最近花了几个小时来处理同样的问题。从好的方面来说，这就是我学习 RSpec 的方式。

我确实发现的一件事是，很多失败都是我想改变的——例如，我不想在登录时重定向到“/”，而是在其他地方。

最后，大多数故障都很容易解决，只要我想好去哪里找。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-27T03:19:05.590

我正在解决同样的问题。我还没有，但我认为 ApplicationController.send(:public, :logged_in?, :current_user, :authorized?) 需要进入 support/env.rb 。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-07-03T14:27:22.363

我也得到了一些提到的错误。但是我的应用程序中出现的第一个问题是：

多个步骤定义具有相同的正则表达式：

features/step_definitions/user_steps.rb:16:in `/^(.*) (.*) user named '(.*)'$/' features/step_definitions/user_steps.rb:29:in`/^there is no (.*) user named '(.*)'$/'

(黄瓜::冗余)

当然，我可以解决这个问题，但会出现更多错误（包括控制器上受保护的 logged_in? 方法、失败的 RSpecs 等等）。

有谁知道，我们是否在这里都做错了什么？或者仅仅是restful_authentication在其当前版本中被破坏了？

# .net - WPF 将多个控件绑定到不同的数据上下文

> ID：679933
> 
> 赞同：31
> 
> 时间：2009-03-25T01:46:45.950
> 
> 标签：.net, wpf, data-binding, resources

我有一个场景，我真的不知道如何将数据绑定到托管在 UserControl 中的控件到多个数据上下文。

我要绑定的数据来自 2 个类

```
UserInfo, UserExtendedInfo 
```

UserControl 的数据上下文设置为 UserInfo，因此我可以轻松地绑定大多数控件，执行以下操作

```
<Label Name="LblEmail" Text="{Binding Email}" /> 
```

但是我不知道如何轻松地绑定来自 UserExtendedInfo 类的属性。我最初的想法是设置每个想要使用来自 UserExtendedInfo 的数据的控件的数据上下文，这样我就可以做同样的事情。但这似乎很麻烦，因为我必须手动分配每个人。每次 UserControl 变为可见时，必须从数据库中获取 UserExtendedInfo 的数据，以免它不同步。

XAML：

```
<Label Name="LblTest" Text="{Binding Locale}" /> 
```

代码背后：

```
Private Sub UserManager_IsVisibleChanged(ByVal sender As System.Object, ByVal e As System.Windows.DependencyPropertyChangedEventArgs)  
        If DirectCast(e.NewValue, Boolean) Then
            Dim user As UserInfo = DirectCast(DataContext, UserInfo)

            If user IsNot Nothing Then
                Dim usrExt As UserExtenedInfo = UserController.GetUserExtended(user.userID)

                LblTest.DataContext = usrExt
            Else
                Throw New ArgumentException("UserId doesn't exist or is less than 1")
            End If
        End If
    End Sub 
```

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2009-03-25T02:33:26.010

我可能会考虑将您的用户对象包装在一个单独的类中，然后设置包含数据的子面板的 DataContext 属性。

例如：

```
public class UserDataContext
{
  public UserInfo UserInfo { get; set; }
  public UserExtendedInfo UserExtendedInfo { get; set; }
} 
```

然后在您的**UserControl.xaml**中：

```
<!-- Binding for the UserControl should be set in its parent, but for clarity -->
<UserControl DataContext="{Binding UserDataContext}">
  <StackPanel>
    <Grid DataContext="{Binding UserInfo}">
       <TextBlock Text="{Binding Email}" />
    </Grid>
    <Grid DataContext="{Binding UserExtendedInfo}">
       <TextBlock Text="{Binding Locale}" />
       <TextBlock Text="{Binding AboutMe}" />
    </Grid>
  </StackPanel>
</UserControl> 
```

这假设您的 UserInfo 类具有 Email 的属性

和

您的 UserExtendedInfo 类具有 Locale 和 AboutMe 的属性

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2009-12-24T01:39:52.250

这是最简单的方法，而且效果很好。

在您设置上下文的代码隐藏中，只需使用包含所有所需值的匿名类型：

```
DataContext = new
{
  info = FetchUserInfoFromDatabase(),
  extendedInfo = FetchExtendedUserInfoFromDatabase(),
}; 
```

在 XAML 中，您可以绑定到任何东西：

```
<UserControl>
  <StackPanel>
    <TextBlock Text="{Binding info.Email}" />
    <TextBlock Text="{Binding extendedInfo.Locale} />
  ... 
```

或者，您可以像其他答案所描述的那样在两个级别上绑定：

```
<UserControl>
  <StackPanel>
    <Grid DataContext="{Binding info}">
      <TextBlock Text={Binding Email}">
      ... 
```

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2009-03-25T02:48:12.590

这就是 MV-VM 派上用场的地方。这个想法（至少据我所知......对我来说仍然很新）是 Window 本身绑定到“ViewModel”类。ViewModel 类只是一个代表所有数据的类，您的整个页面可以访问它需要的所有内容......它只是将您需要绑定到的所有不同对象汇集到一个类中......并且您将 Window（或 Page）的 DataContext 设置为此类的一个实例。您的 UserInfo 和 UserInfoExtended 实例是 ViewModel 对象的公共属性，您只需使用绑定元素的 Path 即可通过您希望将每个控件绑定到的适当对象的适当属性。

有一个很棒（但很长）的视频解释了这种模式，它通过一个完整的示例说明了实现这一点的许多方法以及为什么这是一个在 WPF 应用程序中使用的方便且可扩展的模型的许多不同原因。它还涵盖了 WPF 的许多功能以及对依赖注入的介绍，这也是非常相关的主题，给出了示例。

这是博客文章的链接，其中包含我正在谈论的视频的链接：

**编辑**：博客文章已被删除（这个答案很老了）。这是 YouTube 上的视频：

[https://www.youtube.com/watch?v=BRxnZahCPFQ](https://www.youtube.com/watch?v=BRxnZahCPFQ)

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2009-12-23T21:51:29.407

里奇和本德威都有很好的答案。今天在 Silverlight 而不是 WPF 中探索同样的主题，我发现没有必要建立多个 DataContexts。修改本德威的例子：

```
<UserControl DataContext="{Binding UserDataContext}">
  <StackPanel>
       <TextBlock Text="{Binding Path=UserInfo.Email}" />
       <TextBlock Text="{Binding Path=UserExtendedInfo.Locale}" />
       <TextBlock Text="{Binding Path=UserExtendedInfo.AboutMe}" />
  </StackPanel>
</UserControl> 
```

使用绑定路径，您可以灵活地混合和匹配到不同类的属性的绑定，而无需考虑控件容器的 DataContext。

您还可以通过添加操作 UserInfo 和 UserExtendedInfo 类的属性的属性来扩展 Bendewey 的 UserDataContext 类的功能。例如，您可以结合名字和姓氏。

您可能希望实现 INotifyPropertyChanged，以便您的控件在您重置 UserInfo 和 UserExtendedInfo 时更新。

通过直接在 UserDataContext 中公开所需的属性，将底层 UserInfo 和 UserExtendedInfo 类与 XAML 完全隔离可能在体系结构上更可取，从而消除了对绑定路径的需要。

# vb.net - 对于 LINQ 投影，我有哪些选择？

> ID：679939
> 
> 赞同：1
> 
> 时间：2009-03-25T01:49:55.803
> 
> 标签：vb.net, linq, linq-to-sql

在 LINQ 中，我想投影不同于数据库表中的名称。我可用于列标题的“友好名称”。带有“%”或可能带有“”（空格）的名称。下面的查询不会编译。

这样的事情是否可能，或者我是否坚持使用可怕的 _ 下划线来表示所有内容？

```
dim query = from p in ctx.SomeTable() _
    select ProductName = p.product_name, _
           [Expiration Date] = p.expiration_date,
           [% of sales] = p.pct_sales 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-25T02:20:42.920

在 LINQ 中，您仍然必须遵循不允许空格或 % 符号的变量命名规则。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-25T06:29:46.207

您仍然必须创建有效的变量名。IMO，将显示名称与变量名称联系起来是一个非常糟糕的主意。i18n 绝对没有机会，这对您来说当然可能不是问题 - 但它在 UI 和数据访问代码之间形成了太紧密的联系。

单独指定列标题会好得多。这样，您最终会得到易于从代码中使用的合理变量名称，以及不受规则或标识符限制的列标题。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-25T02:21:29.957

使用 select 子句当然可以为数据库的字段设计不同的名称。

```
Dim query = From p in ctx.SomeTable() _
  Select ProductName = p.product_name, ExpirationData = p.expiration_date 
```

但是，选择的名称仍然必须是有效的 VB 标识符。所以这将阻止您使用空格或 %

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-25T01:58:33.567

对于 LINQ 查询的**选择**部分，使用类似

```
select new { MyNewProductName = p.product_name, MySillyColumnTitle = p.pct_sales } 
```

等等。将为查询返回的 IEnumerable 集合自动创建这些属性。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-08-27T16:56:26.143

如果您创建一个位于 Linq 和 UI 之间的类，您可以使用

```
Imports System.ComponentModel

Public NotInheritable Class ModelSomeTable

'Help prevent accidental direct field access in the class
<EditorBrowsable(System.ComponentModel.EditorBrowsableState.Never)> _
private _pct_sales as decimal

'Components will know what to use for the heading
<Display("% of sales")> _
Public ReadOnly Property pct_sales() As decimal
    Get
        Return _pct_sales
    End Get
End Property

'code can see it, datagrids/datagridviews and other components won't
private _RowId as integer
<Browsable(false)> _
    Public ReadOnly Property RowId() As integer
    Get
        Return _RowId
    End Get
End Property

End Class 
```

# asp.net - 转到不同页面时如何维护母版页图像菜单上的状态？

> ID：679941
> 
> 赞同：1
> 
> 时间：2009-03-25T01:50:12.353
> 
> 标签：asp.net, navigation, master-pages

我需要设置一个图像菜单。客户想要一种特定的字体，而这些选项卡并不是真正支持 CSS 的。也就是说，我想知道保持所选菜单项状态的方法是什么？

例如：假设我有 5 个标签

--家庭-- --青年-- --青春期-- --成人--

当用户单击“YOUTH”菜单项时，他们会被带到“youth.aspx”页面，该页面包含与该菜单项相关的博客文章摘要。在博客文章摘要的底部有指向“阅读更多>”的链接。阅读更多链接将他们带到“blogpost.aspx”页面。当我转到“blogpost.aspx”时，如何将“青年”菜单项保持在选定状态，同样 - 当我从他们的博客摘要转到“blogposts.aspx”时，如何将其他选项卡保持在选定状态?

添加：我正在构建的框架具有 URL 重写，因此我可以创建路由并生成对用户隐藏的查询字符串参数。我猜这样一种方法是让所有母版页将查询字符串参数映射到菜单中的“选定”状态。

我有一些想法，但我想听听比我了解更多的人的建议。

谢谢你。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-25T01:59:45.873

在重定向到新页面之前，您必须在母版页中“记录”您的当前状态。然后在新页面的母版页上，重新选择您的菜单、设置等。

此类数据的一个好地方是在 Session 中，特别是因为您可以在辅助页面中使用它后立即清除信息。您也可以在查询字符串上传递这些设置，但如果它们很多，您的查询字符串可能会变得复杂。

您将无法从初始页面进行直接导航。HyperLink 控件等控件不会让您有机会记录当前状态。Menu 控件上的 NavigateUrl 属性可能会导致类似的问题。相反，连接菜单上的选择事件，记录然后重定向。

希望这可以帮助。

-一种

# flash - Flash 或 Silverlight 能否用于信息亭应用程序？如何？

> ID：679942
> 
> 赞同：5
> 
> 时间：2009-03-25T01:50:18.830
> 
> 标签：flash, silverlight, kiosk

我的经验只是使用 Flash，恐怕我没有跟上最新的情况。上次我尝试这个时，我隐约记得 Flash 有一个问题，它会慢慢消耗内存，直到最终操作系统锁定。那是几年前的事了，也许不是因为 Flash。

将 Flash 或 Silverlight 用于信息亭类型的应用程序是否存在问题？

它们将如何设置？在网页中托管 Flash/Silverlight 应用程序的“信息亭”模式下使用 FireFox 是否足够好？

**编辑：**

回答有关应用程序类型的问题。此应用程序的交互性有限。它将有一个菜单，用户可以单击菜单来查看由文本、图像和视频组成的不同内容。它可能会有过渡动画。我还不确定信息亭是否应该是触摸屏类型的信息亭。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-26T13:14:37.473

Flash 和 Silverlight 都可以。

Flash 可以嵌入到可执行文件中或编译为 exe。两者都适用于您提到的应用程序类型。Silverlight 3 将启用脱离浏览器的体验。如果信息亭将使用浏览器，这真的无关紧要。

使用 Silverlight 3（目前处于测试阶段），您甚至可以获得多点触控支持。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-25T02:04:35.300

好吧，我从来不需要连续运行 9 个小时的 swf，但我会说闪存在过去几年中取得了长足的进步（尤其是在性能和​​内存管理方面）。现在有一些很棒的运行时，您可以查看桌面上的 RIA 选项：

[Adobe AIR](http://www.adobe.com/products/air/)

[锌](http://www.multidmedia.com/software/zinc/)

[钛](http://titaniumapp.com/)（我目前最喜欢的）

在不知道您将构建什么样的应用程序的情况下，我无法发表太多评论。与 silverlight/Flash-Flex 决定相同，取决​​于您是在构建应用程序还是一些流畅的动画演示......

希望这有帮助，祝你好运！

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-25T02:22:40.357

Flash/Silverlight 似乎是信息亭类型应用程序的完美解决方案。假设信息亭机器需要对它们进行最少的维护，并且应用程序的 Web 部署方法是我们所拥有的最好的最成熟的方法。

使用 Silverlight 的一大优势是，如果您有任何需要在客户端运行的 .Net/Java 类型语言的业务逻辑，通常可以轻松移植以针对 Silverlight 运行时进行编译（如果 .Net，您甚至可能不需要更改一行，具体取决于您使用的 .Net 框架库）。

在这种情况下，唯一可能会限制使用基于浏览器的应用程序的可行性是，如果您有一些额外的硬件访问要求，例如自定义票据打印机、信用卡读卡器等。在这些情况下，您将与浏览器沙箱作斗争让他们工作。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-25T01:56:17.957

您可以查看 Adob​​e AIR（类似于 flex/flash）在桌面/kiosk 上运行应用程序

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-25T02:23:02.680

Silverlight 3 及更高版本有一个名为[Out of Browser](http://silverlight.net/getstarted/silverlight3/default.aspx#whatsnew)的功能，它可能适合您的需求。

# api - 用于直接存款的 API（ACH、EFT 等）

> ID：679946
> 
> 赞同：47
> 
> 时间：2009-03-25T01:52:32.990
> 
> 标签：api, e-commerce, payment-gateway, payment, currency

我正在寻找一种方法来自动从一个银行账户转移到另一个银行账户，而最终用户无需登录到诸如贝宝或亚马逊支付之类的东西来完成这个过程（通过将他们的在线余额转移到他们的银行账户）。我在网上浏览了一下，发现一些供应商*似乎*能够做到这一点，但 API 文档并没有让我对此感到确定。

任何人都可以推荐他们曾经做过这样的事情的服务吗？显然，我正在寻找基于 Web 的 API。整个过程是一个中间人站点，它收集付款（这是简单的部分），然后将付款（减去​​费用）支付到银行账户。

亚马逊支付会很棒（允许三方/市场交易）；但是，我们正在寻找直接到最终用户银行帐户的东西。

（我知道这不是严格意义上的*代码*，但我想可能有人做过类似的事情。）

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-09-24T20:19:07.217

**我绝对会暂时反对 AllianceACH.com。**他们被银行起诉，我们损失了 5000 美元的押金，因为他们没有钱退还。

我很确定他们会倒闭，虽然不是积极的。如果他们最终齐心协力，并退还我们的押金，我肯定会再次使用它们。在他们停止提供 ACH 服务后，我们切换到 FirstAch.com。

FirstACH.com 有你需要的东西——但是我必须警告你他们的界面（API 和 GUI）很糟糕而且很烦人。他们的客户服务无能，他们在与您合作以提供适合您个人需求的解决方案时不够灵活。不幸的是，它们是我们发现的最好的。

我们目前正在研究富国银行的商业解决方案作为替代方案，但我怀疑它不会那么便宜。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2012-03-09T19:13:44.080

我要开始的第一个地方是你的银行。询问他们对于您想做的事情有哪些选择。我很快发现一家好的银行愿意与您坐下来，至少向您展示他们拥有和提供的选择。他们知道业务术语，可以为您翻译。在我们的例子中，我们可以通过每天创建一个 ACH 文件并将该文件 FTP 到银行来自动化 ACH 流程。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-07-21T09:00:49.027

看起来 Payflow ACH 支付也在那里，[Payflow ACH API 链接](https://www.paypalobjects.com/en_US/pdf/ACH_Guide.pdf)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-25T01:58:42.083

我以前见过有人使用[**Alliance**](http://www.allianceach.com/processing/default.aspx)，而且我知道一些内部应用程序使用他们的 ACH API，它处理所有支票处理、直接存款和其他类似性质的交易。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-01T23:21:51.027

您可以使用 ACH Direct 来执行此操作。API 位于此处： [https](https://www.paymentsgateway.net/pdf/agi_integration.pdf) ://www.paymentsgateway.net/pdf/agi_integration.pdf，定价位于 www.achdirect.com/offer。

莱斯利·亨德里克斯

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-04-22T19:25:18.980

[Authorize.NET](http://www.authorize.net/solutions/merchantsolutions/merchantservices/echeck/)也有 eCheck.net：http://www.authorize.net/solutions/merchantsolutions/merchantservices/echeck/

Authorize.NET 通常比其他用于向信用卡收费的支付网关更受信任、可靠且更易于使用。我怀疑 ACH 也一样。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-04-17T18:59:56.697

我同意迈克的观点。与您的银行交谈是一个很好的起点。我们使用 Authorize.net ACH，但它只支持从您的客户支票账户中取款，但不支持存入客户账户。到目前为止（我也在寻找一个简单的解决方案）只有我们的银行提供直接存款功能。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2012-05-01T18:23:16.153

ACH Direct 要求收取 25 美元的安装费。他们在 ISO 下设置新帐户的响应记录也很差。在我看来，FirstACH 没有具有竞争力的价格。

# legacy - 您如何继续使用旧代码和新代码开发大型（长期）软件系统？

> ID：679949
> 
> 赞同：5
> 
> 时间：2009-03-25T01:55:38.643
> 
> 标签：legacy

我在拥有大量用户安装基础的大型代码库上工作。该代码最初是用 vb6 编写的，带有一些用于低级工作的 c++ COM 模块。

重写所有已经用 vb6 编写并且我们的客户每天都在使用的代码是完全不可行的，但我们也在继续对软件（大小）进行改进和定制。

到目前为止，我的解决方案是用 c#（现在的 winforms 甚至 wpf）编写大部分新代码，然后使用 COM 互操作从 vb6 调用模块。

有没有人有像这样的长期软件套件（10 年以上）的经验，不能停止完全重写，但同时需要不断的新开发。此外，在这样的混合系统中，连接模块的最佳方式是什么？我现在正在使用 COM，但也考虑过具有单独进程的 IPC。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-25T02:15:11.593

很难给出一个包罗万象的答案，但高层次的方法是明确的。至少，这是我使用的方法。优先考虑您的目标，然后尝试确定实现这些目标的成本。您的成本基本上归结为“开发人员时间”。

首先，你希望任何正在工作的东西都能继续工作。如果你有一些正在工作的东西，并且没有充分的理由重写它，那就保留它。

如果您的某些现有代码需要更新才能完成其工作，那么您正在考虑维护成本。此时，您需要确定重写是否会提高维护成本，使其值得。不要忘记减去新错误的测试和调试，因为会有新错误。不要仅仅因为它是旧的而忽略工作代码。

如果您现有的代码是足够模块化的，您通常可以一次一点地修改它。首先重写高维护组件。

如果您将在 C# 中进行新的开发，那么您应该可以很好地使用 COM 组件，直到您有足够的理由来替换它们。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-25T02:10:03.850

我认为你有一个很好的计划。这最终会将大部分代码移动到 C# 中，从而利用更好的工具集。

VB6 代码是否包含 COM 对象？

您提到代码“无法完全重写”。但你不必停下来。您可以用等效的 C# 代码逐一替换 VB6 的每一项功能。这将允许您一次进行一项更改（最好使用自动化测试来证明您没有破坏任何东西）。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-25T02:22:26.537

当有激励因素时，根据需要重新编写。

我从事的一个旧 Windows 项目有一个用 C 语言编写的规则引擎，它正在工作，所以我们只是把它作为一个黑盒 DLL。

我们构建了一个新的前端，用户群对应用程序易于使用的新现代外观印象深刻。内部结构并没有真正改变。

数据库访问层使用 SQL Server DBLIB，直到我们升级 SQL Server 才重新编写。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-25T15:47:40.110

我们有几个这样的系统。这一切中令人不安的部分是[VB6 的生命周期支持状态](http://msdn.microsoft.com/en-us/vbrun/ms788707.aspx)。有一个风险（无论多么小），您将无法从 Microsoft 获得帮助解决诸如未来服务器升级等令人瞩目的问题，并且无法自行修复（例如，由于VB6 DLL 和修补的服务器 O/S）。这是您的管理层可能感兴趣的风险——但是，如果您现在没有任何支持协议，也许他们对此感到满意？

我们实际上正在考虑重写和重新设计一些更关键的部分。我们已经尝试过渐进式进化，它可以工作，但会导致（让我们说）有趣的操作和维护情况。我强烈建议您使用大量可配置的日志记录来检测所有内容（旧代码和新代码），如果您还没有的话，以帮助进行故障隔离。

COM 听起来像是旧版和新版之间的合理接口。除非您在组件之间进行非常简单的交互，否则我真的不明白您为什么要回到更基本的 IPC 机制。COM 有其复杂性，但它也提供了许多有用的抽象，例如数据类型和版本控制，您必须重新发明和维护......

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-25T02:07:50.080

我认为您需要为您的客户查看升级路径。事实是，当他们拥有 16 个核心 CPU 时，您会希望通过并发来加快速度。因此，您有一个业务案例可以从 VB6 转向 WCF。WCF 内置了并发和同步支持。它可用于本地进程内通信以及跨进程和跨机器通信。它还具有允许您进行更多 AOP 风格编程的好处。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-25T02:36:32.320

我目前是开发大型遗留系统的几个开发人员之一，该系统最初是 C 和 C++ 与 Win32 的组合，后来是 MFC，在后端 C 代码中有少量汇编。我们最近从 VC++ 6 跳到 Visual Studio 2005（并且已经升级到 2008），以获得我们正在处理的项目的最新版本。自 IDE/编译器升级以来，我们一直在清理一些外观和感觉，并添加了带有 WinForms 的托管 C++，现在添加了带有 WCF 的 C#。

虽然我们系统的基础（包括后端）几乎肯定会保留在 C 中（至少在可预见的将来），但前端中的任何新内容很可能会在 C#/WCF 中完成。当我们有时间和/或需要时，我们打算开始用等效的 C#/WCF 代码替换前端的旧部分。

# apache-flex - crossdomain.xml 和 FileReference.upload 的 Flex 问题

> ID：679952
> 
> 赞同：2
> 
> 时间：2009-03-25T01:57:36.487
> 
> 标签：apache-flex

问候

我有一个 Flex 应用程序，它向位于不同域中的 Web 应用程序发出各种请求。因此，我制作了一个自定义 crossdomain.xml 以允许从我的 Flex 应用程序进行访问。这个文件的内容是

```
> <!DOCTYPE cross-domain-policy SYSTEM
> "http://www.adobe.com/xml/dtds/cross-domain-policy.dtd">
> <cross-domain-policy>
>     <site-control permitted-cross-domain-policies="all"/>
>     <allow-access-from domain="*" secure="false" to-ports="*"/>
> </cross-domain-policy> 
```

这个 crossdomain.xml 位于我的 webapp 的一个子文件夹中：[http://host:port/services/crossdomain.xml](http://host:port/services/crossdomain.xml) 服务（有些是 http 服务，有些是 web 服务）都位于 services 子文件夹中。

我正在使用 Security.loadPolicyFile 加载 crossdomain.xml，一切正常。直到我尝试使用 FileReference 对象上传文件。即使我的 HTTP 表单位于 services 子文件夹下并且我正确加载了 crossdomain.xml 文件（我可以执行 http 请求和 Web 服务请求），每次我尝试上传文件时，我都会遇到臭名昭著的安全沙箱违规。

我错过了什么？是否有任何允许文件上传的特殊说明？根据 Adob​​e 文档 ( [http://livedocs.adobe.com/flex/3/html/help.html?content=05B_Security_10.html](http://livedocs.adobe.com/flex/3/html/help.html?content=05B_Security_10.html) ) 一切都配置良好。有任何想法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-26T22:06:04.127

Flash Player 中的文件上传使用 Socket API 而不是浏览器网络 API。因此，要以这种方式进行操作，您需要有一个[套接字策略文件](http://www.adobe.com/devnet/flashplayer/articles/socket_policy_files.html)。

一个更简单的替代方法是通过 RemoteObject 进行上传。为此，您需要使用 Flash Player 10 中的新 FileReference API，以便您可以读取文件客户端的字节，然后在 RemoteObject 调用中将它们发送到服务器。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-03-07T15:11:51.743

我也遇到了与未找到 crossdomain.xml 404 相同的问题。

我们在项目中将 flex 与 salesforce.com 集成，并遇到 crossdomain.xml 错误。

在登录验证中，我们使用用户名和密码在本地进行测试，并且在错误中我们提供了连接到 salesforce.com 的服务器 URL。

它在除 chrome 之外的所有浏览器中运行良好。然后首先进行更改以检查服务器 URL，并将测试用户名和密码详细信息包含在故障功能中，它也适用于 chrome。未将任何 crossdomain.xml 文件添加到根目录。

可能是 chrome 浏览器的初始测试详细信息没有被错误的 serverl URL 覆盖。

# jquery - 在 jQuery 中，如何选择隐藏元素？

> ID：679958
> 
> 赞同：32
> 
> 时间：2009-03-25T02:00:22.533
> 
> 标签：jquery, css, css-selectors

如何选择以下代码`<span>`中`display`设置的位置`none`？

```
<p id="p1">
<span id="test1" style="display:none">test1</span> 
<span id="test2" >test2</span> 
</p> 
```

我可以通过使用来选择`<span>`ID为“test1”的人`$("span[id='test1']")`，但是当我使用时它不起作用`$("span[style='display:none']")`。

有什么方法可以一次获取这个元素吗？

非常感谢。

* * *

## 回答 #1

> 赞同：51
> 
> 时间：2009-03-25T02:02:57.287

您正在寻找[`:hidden`](http://docs.jquery.com/Selectors/hidden)选择器

请注意，按 ID 选择元素的正确方法很简单：

```
$("#test1"); 
```

以您正在做的方式进行操作会使 jQuery 进行不必要的解析并且速度要慢得多。

如果您只想在`#test1`隐藏时选择它，请执行以下操作：

```
$("#test1:hidden"); 
```

如果要选择`<span>`隐藏在 下的所有元素`#p1`，请执行以下操作：

```
$("span:hidden", "#p1"); 
```

如评论中所述，与此选择器相反的是[`:visible`](http://docs.jquery.com/Selectors/visible)选择器：

```
$("span:visible", "#p1"); 
```

然后将选择`<span>`元素中的任何可见元素`#p1`。

# c# - 删除事件但仍在触发

> ID：679961
> 
> 赞同：1
> 
> 时间：2009-03-25T02:01:49.893
> 
> 标签：c#, winforms, events

我遇到了一个奇怪的错误，即触发了不希望的事件。我可以跟踪代码并看到“onRowLeave”事件处理程序正在使用 -= 语法被删除，然后下一行 DataSource 被更改，这导致“OnRowLeave”处理程序被触发！

因此，似乎删除不起作用。

我可以告诉它没有以某种方式再次添加，因为我在所有添加它的地方都有一个断点 += 并且它没有击中那些。

我在想也许它被添加了两次，并且只删除了一次......这会导致它吗？有什么办法可以在调试器中看到处理程序？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-25T03:00:53.870

->> 我在想它可能被添加了两次，并且只删除了一次……这会导致它吗？

那是对的。

->> 有什么方法可以让我在调试器中看到处理程序？

我不认为这是可能的。此外，如果您不知道添加事件处理程序的次数，那么取消它们并不是一项简单的任务。我想你可以使用反射来实现这一点。

相反，我建议您研究代码并了解您**在哪里**以及**为什么**要注册多个事件，以便您可以在需要时手动删除它们。

*（您可能需要注意（如 nobugz 所建议），OnRowLeave 是 DataGridView 的一种方法，而不是事件。此方法不向用户公开，而是负责引发用户可以捕获的 RowLeave 事件。我不太清楚你为什么使用 OnRowLeave 这个词）*

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-25T05:39:01.773

当我遇到像这样挥之不去的事件处理程序问题时，我通常会提供自己的事件添加/删除方法，并在我自己的容器中跟踪事件处理程序以及其他调试数据（如果它看起来有用的话）。这允许在调试器中检查集合，如果它为以这种方式添加的每个事件关联一个 System.Diagnostics.StackTrace 对象，则附加数据会非常有用。

# ruby-on-rails - 通过固定链接查找项目，如果找不到，则为 404

> ID：679962
> 
> 赞同：3
> 
> 时间：2009-03-25T02:02:12.293
> 
> 标签：ruby-on-rails, ruby, http-status-code-404

我更改了我的显示控制器以通过他们的永久链接而不是他们的 id 来查找记录（为了 SEO 多汁）。

```
def show
  @project = Project.find_by_permalink(params[:id])
end 
```

但是，如果我输入 localhost:3000/projects/foo （并且没有带有 foo 永久链接的项目），我会收到 500 服务器错误，而不是 404 未找到。

为什么会这样，我该如何解决？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-26T01:22:30.277

这可能是 2.3 的新增功能，但您可以在动态查找器之后使用感叹号，如下所示：

```
def show
  @project = Project.find_by_permalink!(params[:id])
end 
```

如果没有发现`ActiveRecord::RecordNotFound`异常，则会引发异常。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-25T03:20:13.933

我假设收到 500 错误，因为您的 show 操作正在尝试引用`@project`find 返回时的属性`nil`

您需要检查以确保`@projects`有一些数据，否则手动渲染 404。在我的网站上，我在类似的情况下呈现了一个名为“错误”的自定义操作：

```
render :action => 'error', :status => 404 if @projects.blank? 
```

如果`@projects`存在，则显示操作将正常呈现。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-26T00:44:59.897

或者您可以引发 404 异常。

# python - 提交文件时出现python curl问题

> ID：679966
> 
> 赞同：3
> 
> 时间：2009-03-25T02:03:46.037
> 
> 标签：python, upload, curl

```
#!/usr/bin/python
import pycurl
import re
import StringIO

#CONSTANTS
URL = "http://www.imagehost.org"
FILE = "/datos/poop1.jpg"
POST_DATA = [("a", "upload"), ("file[]", (pycurl.FORM_FILE, FILE))]

buffer = StringIO.StringIO()

c = pycurl.Curl()
c.setopt( c.URL, URL )
c.setopt( c.POST, 1 )
c.setopt( c.POSTFIELDS, POST_DATA )
##c.setopt( c.HTTPPOST, POST_DATA )
c.setopt( c.USERAGENT,'Curl')
c.setopt( c.WRITEFUNCTION, buffer.write)
c.setopt(pycurl.VERBOSE, 1)

c.perform()
c.close()

#c.setopt(c.PROXY, proxyHostAndPort)
#c.setopt(c.PROXYUSERPWD, proxyAuthentication)

parse = buffer.getvalue()

pattern = re.compile('/<td nowrap="nowrap">(.+)<\/td>\s*<td class="link"><input.+value="([^"]+)" \/><\/td>/i')

result = re.search(pattern, parse)
print result 
```

问题在于如何发帖。

c.setopt( c.POSTFIELDS, POST_DATA ) 不接受列表，所以我应该怎么做而不是添加列表？

并且 c.setopt( c.HTTPPOST, POST_DATA ) 下降：

```
Traceback (most recent call last): 
  File "pymage", line 26, in <module>
c.perform() pycurl.error: (26, 'failed creating formpost data') 
```

更新：

-----------------------------15758382912173403811539561297\r\n内容-处置：表单-数据；name="a"\r\n\r\n上传\r\n-----------------------------15758382912173403811539561297\r\ nContent-Disposition：表单数据；名称="文件[]"; filename="Datos_Pegados_0a17.jpg"\r\n内容类型：图像/jpeg\r\n\r\nÿØÿà

这就是我使用篡改数据得到的结果。

postfield的有趣部分：

表格数据；name="a"\r\n\r\n上传\r\n

表格数据；名称="文件[]"

所以...你说 POST_DATA 应该是 'a=upload&file[]=FILE'？

更新2：

```
<form method="post" action="/" enctype="multipart/form-data" onsubmit="javascript:Upload(); return true;">

<input type="hidden" name="a" value="upload" />

<td class="left">File:</td>
td class="right"><input name="file[]" type="file" size="20" /></td> 
```

那是代码...

现在它正在使用表单数据配置，但它没有上传我相信的文件

c.setopt(c.POSTFIELDS, 'a=upload&file[]=/datos/poop1.jpg')

我得到这个：

```
* About to connect() to www.imagehost.org port 80 (#0)
*   Trying 74.63.87.74... * connected
* Connected to www.imagehost.org (74.63.87.74) port 80 (#0)
> POST / HTTP/1.1
User-Agent: Curl
Host: www.imagehost.org
Accept: */*
Content-Length: 32
Content-Type: application/x-www-form-urlencoded

< HTTP/1.1 200 OK
< Transfer-Encoding: chunked
< Date: Wed, 25 Mar 2009 06:53:49 GMT
< Content-Type: text/html
< Server: nginx/0.7.11
< Set-Cookie: userhash=7c09b97cc70c8c133c850a3e744b416e; expires=Thu, 25-Mar-2010 06:53:49 GMT; path=/; domain=.imagehost.org; httponly
< 
* Connection #0 to host www.imagehost.org left intact
* Closing connection #0 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2011-02-09T09:55:40.220

pycurl 文档对此不是很清楚，但是 HTTPPOST 选项可以采用一个元组列表，每个元组正好两个元素长。每个元组的第一个参数是表单字段名称，第二个是值。

但是，该值也可以是一个元组。该元组必须包含与该字段相关的数据对：（form_option、option_value、form_option、option_value 等）

例如，一个包含三个字段的多部分表单，最后一个是文件上传 - 我们可以设置文件名和 mime 类型：

```
c = pycurl.Curl()
c.setopt(c.URL, base_url + 'upload.cgi')
c.setopt(c.HTTPPOST,[ ("fieldname1", "value1"), 
                      ("fieldname2", "value2"), 
                      ("uploadfieldname", 
                                 (c.FORM_FILE, local_filename, 
                                  c.FORM_CONTENTTYPE, "application/x-gzip"))
                    ]) 
```

您可以在 curl_formadd() 的 C API 的文档中找到选项：http://curl.haxx.se/libcurl/c/curl_formadd.html [但是](http://curl.haxx.se/libcurl/c/curl_formadd.html) ，从 pycurl 源来看，它看起来只有 FORM_FILE、FORM_FILENAME、FORM_CONTENTTYPE并且支持 FORM_COPYCONTENTS。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-08-12T06:50:18.670

Error 26 (in "pycurl.error: (26, 'failed creating formpost data')") means that the filename you specified to upload does not exist. I was running into this same error, and that was definitely the problem. See the curl source code for the location that it generates error 26.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-25T05:17:28.737

我认为 for 的参数`POSTFIELDS`需要是一个简单的 URL 编码字符串，例如：

```
POST_DATA = 'a=foo&b=bar' 
```

接下来，我不确定您的 FILE 内容。查看[此邮件](http://curl.haxx.se/mail/curlpython-2007-03/0003.html)以获取示例。

# windows - 将新添加的应用程序添加到内存中的 Windows 事件

> ID：679973
> 
> 赞同：4
> 
> 时间：2009-03-25T02:06:52.067
> 
> 标签：windows, events, memory

当新应用程序被添加到内存/任务栏时，有什么方法可以获取一些 Windows 事件？
我可以通过迭代 Process.GetProcesses() 来运行应用程序（尽管由于某种原因将排除资源管理器进程），但这意味着我必须每隔几秒检查一次新进程，这不是很好。
我想知道我是否可以在 C# 应用程序中接收到任何中断，然后调用该函数来读取进程？

任何代码示例都会很棒。
谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-25T04:11:33.140

WMI 事件可以在创建新进程时提醒您。根据您可能需要投票的事件。使用 Win32_ProcessStartTrace 类，您不必轮询。新事件在您的代码中作为事件引发。下面是一个示例（在您的项目中添加 System.Management 作为参考）

```
public System.Management.ManagementEventWatcher mgmtWtch;
private delegate void ListBoxItemAdd(string Item);

public Form1()
{
    InitializeComponent();
    mgmtWtch = new System.Management.ManagementEventWatcher("Select * From Win32_ProcessStartTrace");
    mgmtWtch.EventArrived += new System.Management.EventArrivedEventHandler(mgmtWtch_EventArrived);
    mgmtWtch.Start();
}

    void AddItem(string Item)
    {
        if (lwProcesses.InvokeRequired)
            lwProcesses.Invoke(new ListBoxItemAdd(AddItem), Item);
        else
            lwProcesses.Items.Add(Item);
    }

    void mgmtWtch_EventArrived(object sender, System.Management.EventArrivedEventArgs e)
    {
        //MessageBox.Show((string)e.NewEvent["ProcessName"]);
        foreach (Process p in Process.GetProcesses("."))
        {
            string Title = p.MainWindowTitle;
            if (Title.Length > 0) AddItem(Title);
        }

    }

private void Form1_FormClosing(object sender, FormClosingEventArgs e)
{
    mgmtWtch.Stop();
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-25T12:56:22.097

WMI 是一种方法。如果在通过 P/invoke 将代码修改为 c# 后没有实现这个想法，如

[http://www.codeproject.com/KB/threads/procmon.aspx](http://www.codeproject.com/KB/threads/procmon.aspx)

祝你好运。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-25T07:32:14.887

当然，（不需要WMI），只需使用本机创建事件）

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-03-25T03:06:21.297

[这](http://www.codeproject.com/KB/system/soviet_protector.aspx)可能会有所帮助。由于 tnis 涉及在 NT 级别（NtCreateFile() 和 NtOpenFile() 或 NtCreateSection()）挂钩，我怀疑托管 C++ 是要走的路。

# c# - 如何在 ASP.NET Web 服务中使用证书对客户端进行身份验证

> ID：679974
> 
> 赞同：2
> 
> 时间：2009-03-25T02:07:24.967
> 
> 标签：c#, asp.net, web-services, authentication

我需要知道 .net Web 服务如何验证来自使用证书的客户端的请求。我知道客户在提出请求之前必须将其证书附加到服务代理，但我不知道如何检查正确的计算机是否正在与我们联系。

这需要在使用 .Net 框架 2.0 的共享主机环境中实现。请告知这是否可行，或者网络是否应该使用其他身份验证方法，例如基于 SSL 的基本身份验证

如果您需要更多信息，请与我们联系。

谢谢

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-25T02:39:00.880

Web 服务不进行身份验证 - IIS 进行。查看站点或应用程序属性的“安全”选项卡。在底部，有一个“编辑”按钮。出现的对话框底部允许您启用客户端证书映射，并指定如何将客户端证书映射到 Windows 用户。

Web 服务只会将客户端视为经过身份验证的 Windows 用户（它们就是这样）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-25T04:30:53.297

请参阅[使用 Web 服务增强 (WSE) 进行 X.509 证书身份验证和数字签名](http://www.eggheadcafe.com/articles/20021231.asp)。如果可能的话，我会在 .NET 3.5 上推荐 WCF。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-25T04:34:22.100

如果您的客户端有证书，则使用基于 SSL 的基本身份验证是执行此操作的标准方法。

# c# - 大型数据集（SQL 到 C#），长加载时间修复

> ID：679976
> 
> 赞同：3
> 
> 时间：2009-03-25T02:07:46.930
> 
> 标签：c#, sql, dataset, latitude-longitude, large-data-volumes

我有一个正在构建的站点，它是一个基于几个用户偏好创建邮件合并（或多或少......）的应用程序。它可以毫无问题地生成笛卡尔连接价值的数据，但是企业需要让生活变得更加困难......

我必须构建应用程序，以便在验证远程员工的邮政编码后，它会根据媒体目标与该员工的距离为媒体目标创建电子邮件。例如，假设员工在他们工作的地方是众所周知的志愿者。企业希望通过电子邮件向这些员工 5 英里半径范围内的媒体发送有关员工正在从事的工作的消息。这就是事情变得混乱的地方......我在这里有几个选择，我将概述尝试和失败：

1.  最大半径为 20 英里。我创建了一个数据库表，其中包含美国每个邮政编码的记录，并连接到该邮政编码 20 英里内的每个邮政编码。数据集看起来像（名称不同，这是为了论证）：
    ***[SourceZip] | [城市] | [状态] | [关闭邮编] | [城市] | [状态] | [距离]***
    失败：例如，纽约州有来自上述数据集的 35 万条记录（其他州更糟！）。该页面的平均加载时间？6分钟...没有发生。我通过设置断点验证了这一点，断开连接发生在 dataadapter.fill() 阶段。

2.  （由于后勤问题，这个从未实施过）我为每个员工 zip 与距离为 x 或更短的媒体目标 zip 建立了数据库连接。除了源文件和媒体目标结合起来可以达到 34k 以上的个性化电子邮件。34k 数据库连接？即使我可以设计一种重用邮政编码搜索的方法，我还是在数据库中进行了一些测试检查，发现员工工作的纽约有 500 个不同的邮政编码。500 分贝的连接？我怀疑这会奏效，但我可能会感到惊讶。

3.  我解决这个问题的最新方案是希望 Web 服务器运行一个比 .net 数据集对象更好的游戏，方法是获取一个新数据集，如下所示：
    ***[zip] | [经度] | [纬度]***
    然后做一个距离公式来确定数据是否有效。这在很大程度上依赖于 Web 服务器上的处理器。这是一次值得的赌博，还是我会在这次尝试中发现相同的加载时间损害？

    **有没有更好的办法？**

    我感谢任何意见，即使它证实了我对这个项目*可能无法工作*的担忧。

**附加说明**：我无法控制服务器，并且正在运行 SQL2k :(。我正在 Visual Studio 2005 框架 2.0 中对站点进行编程。不过，可能会在接下来的几个月内升级到 SQL2005 和 VS2008。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-25T02:20:22.143

如果您有一个带有经度/纬度坐标的邮政编码数据库，您可以使用我的 Haversine 函数即时计算距离（请参阅我[对这个问题的回答](https://stackoverflow.com/questions/569980/how-to-calculate-distance-from-a-gpx-file)）。

这在具有整个美国邮政编码数据的 Web 应用程序中表现得非常好。

查询类似于以下内容：

```
select * from zip where 
   dbo.udf_Haversine(zip.lat,zip.long, @lat, @lon) < 20   -- (miles) 
```

您不会将此应用于每个收件人的地址，但您将首先确定您的半径内的邮政编码（在嵌套查询中或使用 CTE），然后加入您需要发送邮件的所有地址。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-25T15:33:06.887

如果您有员工数据集、媒体数据集以及源和目标 zip 之间距离的第三个数据集，则可以节省一些时间将 3 个表连接在一起......

```
SELECT *
FROM Employees_List
   INNER JOIN 
       (Media_List INNER JOIN Distance_List ON Media_List.Zip = Distance_List.Target_Zip)
   ON Employees_List.Zip = Distance_List.Source_Zip
WHERE distance_Miles <=5 
```

这样，您可以使用距离设置员工和媒体之间的关系。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-25T02:26:55.183

**编辑**经过调查，Haversine 函数的答案是我将采取的路线......它不像我们的数据库使用的函数那样密集（这将是固定的:)）

你不应该**每次**都计算距离，从long/lat到long/lat是一个繁重的计算，如果你不止一次这样做，那就没有必要了。

话虽如此，我不确定您为什么已经注销了选项＃2。我们实际上正在做类似的事情。也许我对这些数字感到困惑，但是您提到的对于 SQL2k 来说应该没什么。

即使您离线计算美国从 zip 到 zip 的距离，也只有大约 20 亿行。是的，它很多，但它大致是静态的，如果它很慢，可能会被分片，等等。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-26T18:45:35.760

如果您在 MySQL 中按 SOURCEZIP (ALTER TABLE .. ORDER BY (SOURCEZIP) ) 对表和索引进行排序，则选择 350K 行（您的示例为 NY）将不会花费 6 分钟。它应该只需要几分之一秒...... ALTER 将需要很长时间（或者您可以按该顺序创建表）——但由于它是一个静态表，因此毫无价值。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-03-25T02:24:08.107

您使用的是 SQL 2008 吗？如果是这样，新的空间数据功能可能正是您在这里寻找的。您可以像在字符串上使用“LIKE”比较一样轻松地找到另一个范围内的坐标。

[http://www.microsoft.com/sqlserver/2008/en/us/spatial-data.aspx](http://www.microsoft.com/sqlserver/2008/en/us/spatial-data.aspx)

# c - 如何制作可变参数宏（可变数量的参数）

> ID：679979
> 
> 赞同：216
> 
> 时间：2009-03-25T02:08:15.040
> 
> 标签：c, g++, c-preprocessor, variadic

我想用 C 编写一个宏，它接受任意数量的参数，而不是特定的数字

例子：

```
#define macro( X )  something_complicated( whatever( X ) ) 
```

其中`X`是任意数量的参数

我需要这个，因为`whatever`它重载并且可以用 2 或 4 个参数调用。

我尝试定义宏两次，但第二个定义覆盖了第一个！

我正在使用的编译器是 g++（更具体地说，mingw）

* * *

## 回答 #1

> 赞同：325
> 
> 时间：2009-03-25T02:16:27.753

C99方式，VC++编译器也支持。

```
#define FOO(fmt, ...) printf(fmt, ##__VA_ARGS__) 
```

* * *

## 回答 #2

> 赞同：44
> 
> 时间：2011-09-04T21:25:30.390

`__VA_ARGS__`是标准的做法。如果不需要，不要使用编译器特定的技巧。

我真的很生气，我不能对原始帖子发表评论。无论如何，C++ 不是 C 的超集。用 C++ 编译器编译 C 代码真的很愚蠢。不要做唐尼不做的事。

* * *

## 回答 #3

> 赞同：31
> 
> 时间：2009-03-25T02:14:46.913

我认为这是不可能的，你可以用双括号来伪造它......只要你不需要单独的论点。

```
#define macro(ARGS) some_complicated (whatever ARGS)
// ...
macro((a,b,c))
macro((d,e)) 
```

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2009-03-26T20:15:23.860

```
#define DEBUG

#ifdef DEBUG
  #define PRINT print
#else
  #define PRINT(...) ((void)0) //strip out PRINT instructions from code
#endif 

void print(const char *fmt, ...) {

    va_list args;
    va_start(args, fmt);
    vsprintf(str, fmt, args);
        va_end(args);

        printf("%s\n", str);

}

int main() {
   PRINT("[%s %d, %d] Hello World", "March", 26, 2009);
   return 0;
} 
```

如果编译器不理解可变参数宏，您还可以使用以下任一方法去除 PRINT：

```
#define PRINT // 
```

或者

```
#define PRINT if(0)print 
```

第一个注释掉 PRINT 指令，第二个由于 NULL if 条件而阻止 PRINT 指令。如果设置了优化，编译器应该删除从未执行过的指令，例如： if(0) print("hello world"); 或（（无效）0）；

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2009-03-25T02:13:59.990

在这里为 g++ 解释，虽然它是 C99 的一部分，所以应该适用于每个人

[http://www.delorie.com/gnu/docs/gcc/gcc_44.html](http://www.delorie.com/gnu/docs/gcc/gcc_44.html)

快速示例：

```
#define debug(format, args...) fprintf (stderr, format, args) 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2021-10-11T14:27:57.897

• 可变数量的参数用省略号 (...) 表示 • ISO C 的语法要求在“...”之前至少有一个固定参数</p>

例如，您可以键入：

```
#define DEBUGMSG ( int, ...) 
```

# css - Drupal - Apache 的 Mod_Deflate 破坏了 CSS

> ID：679980
> 
> 赞同：0
> 
> 时间：2009-03-25T02:08:51.217
> 
> 标签：css, apache, drupal, themes, mod-deflate

我们在我们的 drupal 站点上启用了 Apache 的 mod_deflate。从那时起，我们注意到 CSS 文件没有正确加载。它不会每次都发生。有点随意。

有没有其他人注意到这个问题？如果是这样，任何建议的解决方案？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-25T02:54:02.763

[使用CSS Gzip 模块](http://drupal.org/project/css_gzip)可能比直接使用 Apache更幸运。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-07-23T06:21:32.657

你在使用 apache 和 mod_fastcgi 吗？

mod_deflate 有时会与 apache mod_fastcgi 中断。

# iphone - 如何在 iPhone 屏幕上用线条绘制签名？

> ID：679983
> 
> 赞同：2
> 
> 时间：2009-03-25T02:12:47.387
> 
> 标签：iphone, objective-c, opengl, quartz-graphics, paint

我想让用户在 iPhone 屏幕上画一个签名，所以我添加了 UIView 的一个子类，并在它的“touchesMoved”方法中添加了一些代码。

```
 -(void)touchesMoved:(NSSet *)touches withEvent:(UIEvent *)event
{
    UITouch *touch = [touches anyObject];
    firstTouch = [touch locationInView:self];

    CGSize mySize = CGSizeMake(5, 5);
    UIGraphicsBeginImageContext(mySize);                                    
    CGContextRef ctx = UIGraphicsGetCurrentContext();                       

    CGContextBeginPath(ctx);                                                
    CGContextSetRGBFillColor(ctx, 1, 0, 0, 1);                              
    CGContextAddRect(ctx, CGRectMake(0, 0, 5, 5));                          
    CGContextFillPath(ctx);                                                 

    UIImage *redRect = UIGraphicsGetImageFromCurrentImageContext();         
    UIGraphicsEndImageContext();                                            

    UIImageView *redRectView = [[UIImageView alloc] initWithImage:redRect]; 
    redRectView.center = CGPointMake(firstTouch.x, firstTouch.y);                               
    [self addSubview:redRectView];                                      

} 
```

我用小矩形绘制它，结果是逐点绘制。因为太丑了，我想用线条画出签名。但是如何区分firstTouch和lastTouch呢？如果我只使用'touchesMoved'方法，我只能得到一个接触点。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-25T06:23:52.587

根据[UIResponder 类参考](http://developer.apple.com/iphone/library/documentation/UIKit/Reference/UIResponder_Class/Reference/Reference.html#//apple_ref/occ/instm/UIResponder/)，您还需要实现
`– touchesBegan:withEvent:`和
`– touchesEnded:withEvent:`。
实现这些方法后，您应该能够获得足够的数据来实现路径贝塞尔曲线或其他合适的解决方案。

[**编辑**] 更好的解决方案是在`UIEvent`控制器收到
`– touchesMoved:withEvent:` 通知后直接从对象获取触摸。此外，[GLPaint 示例代码](https://developer.apple.com/iphone/library/samplecode/GLPaint/index.html)也可能很有帮助。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-30T05:18:51.377

由于 GLPaint 示例代码对于初学者来说可能过于复杂，所以我找到[了这个教程](http://www.ipodtouchfans.com/forums/showthread.php?t=132024)。对于大多数初学者来说，学习起来很简单。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-30T05:51:47.570

请记住，用手指书写的签名与用书写工具书写的签名不同。您可能需要重新考虑使用签名的目的，以及它是否具有您需要的约束力。

# javascript - 如何检查元素的关联事件处理程序？

> ID：679994
> 
> 赞同：10
> 
> 时间：2009-03-25T02:16:40.247
> 
> 标签：javascript, firebug

> **可能的重复：**
> [如何使用 FireBug（或类似工具）调试 Javascript/jQuery 事件绑定](https://stackoverflow.com/questions/570960/how-to-debug-javascript-jquery-event-bindings-with-firebug-or-similar-tool)
> [在调试时或从 JavaScript 代码中如何在 DOM 节点上查找事件侦听器？](https://stackoverflow.com/questions/446892)
> [如何跟踪诸如 onclick onblur 之类的 JavaScript 事件？](https://stackoverflow.com/questions/91367/how-to-trace-javascript-events-like-onclick-onblur)

我正在使用 Firebug 来检查 HTML 代码和 CSS。我需要找到与元素关联的事件和处理程序。

使用 Inspect 按钮，我可以看到所有的 CSS，但找不到事件处理程序。

# sql - 如何让一个sql搜索查询更强大？

> ID：679998
> 
> 赞同：7
> 
> 时间：2009-03-25T02:20:07.807
> 
> 标签：sql, mysql, sql-server, sql-server-2005, tsql

我编写了这个 sql 查询来在表中搜索：

```
SELECT * FROM TableName WHERE Name LIKE '%spa%' 
```

该表包含这些行，例如：

1.  太空公司。
2.  温泉度假村。
3.  温泉酒店。
4.  备件。
5.  没有关键字。

我想知道如何编辑此查询，使其返回排序如下的结果：

> 2 温泉度假村
> 
> 3 温泉酒店
> 
> 1 太空公司
> 
> 4 备件

表示首先包含确切单词然后包含类似单词的项目。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-25T02:37:37.140

就像是

```
Select * from TableName where Name Like 'Spa%'
ORDER BY case when soundex(name) = soundex('Spa') then '1' else soundex(name) end 
```

应该可以正常工作。

实际上这会更好

```
Select * from TableName where Name Like 'Spa%'
ORDER BY DIFFERENCE(name, 'Spa') desc; 
```

FWIW 我做了一些快速测试，如果“名称”在非集群索引中，SQL 将使用索引并且不进行表扫描。此外，LIKE 似乎比 charindex 使用更少的资源（返回不太理想的结果）。在 sql 2000 上测试。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-25T03:07:49.143

你意识到，我想，你的模式几乎消除了这些查询的索引的任何用处？

一个大问题是您的“LIKE '%spa%'”。任何以通配符开头的“LIKE”键都是自动表扫描。

* * *

编辑：我读到您的问题是说有一个字段名称，其字段值类似于“1 Space Company”、“2 Spa 度假村”等，数字后跟单词。而且您需要在搜索键前面加上通配符才能跳过数字部分。（这是为了澄清我的第一条评论。）我猜对了吗？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-25T02:34:06.010

以下应该做必要的事情，但它效率低下，做两个全表选择，它还依赖于你的完全匹配被空格分隔。我认为全文索引会有所帮助，但这有其自身的开销。

```
select distinct * from
(
Select * from TableName 
   where CHARINDEX('spa ', Name) > 0
   or CHARINDEX(' spa', Name) > 0
Union
Select * from TableName 
  where Name Like '%spa%'
) 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-25T13:22:42.907

离开最上面的例子，至少在 MSSQL2005 中将 CLUSTERED 更改为 NONCLUSTERED 会使其进行表扫描。CLUSTERED 为您提供索引查找。看起来它符合问题的条件。

```
创建表 tblTest(ID INT, colname VARCHAR(20) )
创建集群索引 tstidx1_tblTest ON tblTest(colname);
插入 tblTest SELECT 1，“太空公司”
插入 tblTest SELECT 2，“温泉度假村”
插入 tblTest SELECT 3，“温泉酒店”
插入 tblTest SELECT 4，“备件”
插入 tblTest SELECT 5,'WithoutTheKeyword'

SELECT * FROM tblTest WHERE colname LIKE 'Spa%'
ORDER BY DIFFERENCE(colname,'Spa') DESC;

删除表 tblTest

```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-25T18:46:06.033

您基本上需要（精确地）定义您的排名函数到底是什么。如果您有一排是“The Spa”怎么办。或“spa.com”？定义好之后，您需要将该逻辑放入您的 ORDER BY 子句中。例如：

```
SELECT
    name
FROM
    Some_Table
WHERE
    name LIKE '%spa%'
ORDER BY
    CASE
        WHEN name LIKE '% ' + @search_word + ' %' THEN 1   -- Notice the spaces
        ELSE 2
    END,
    name 
```

或者，您可以编写一个排名函数并使用它：

```
SELECT
    name
FROM
    Some_Table
WHERE
    name LIKE '%' + @search_word + '%'
ORDER BY
    dbo.GetNameMatchRank(name, @search_word) 
```

在非常大的结果集上的性能可能不会太好，因此这种方法取决于您预期的搜索结果大小。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-03-25T02:24:32.523

这应该有效：

```
Select * from TableName where Name Like '%spa%'
ORDER BY Name 
```***************