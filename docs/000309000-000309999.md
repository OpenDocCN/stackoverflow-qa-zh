# StackOverflow 问答 000309000-000309999

# c++ - sqlnclir.rll 被连续加载和卸载

> ID：309006
> 
> 赞同：1
> 
> 时间：2008-11-21T14:55:54.177
> 
> 标签：c++, sql-server, visual-c++, sqlncli

我正在与 SQL Server 2000 通信的 C++ 应用程序中使用 SQL Native Client 9。我现在正在调试一些东西，但我注意到让我感到困扰的事情（主要是因为它造成了严重的混乱）是 sqlnclir。 rll 不断被加载和卸载，并且以下行被垃圾邮件发送到我的调试输出窗口。

> ```
> 'my_app.exe': Loaded 'C:\WINDOWS\system32\sqlnclir.rll', Binary was not built with debug information.
> The thread 'Win32 Thread' (0x9f4) has exited with code 0 (0x0).
> 'my_app.exe': Unloaded 'C:\WINDOWS\system32\sqlnclir.rll' 
> ```

“Win32 线程”后的 ID 发生变化，但退出代码始终为 0。

为什么 .rll 会像这样不断地加载和卸载，我该如何防止它发生？

如果上述问题无法回答，我如何防止上述消息被垃圾邮件发送到 MSVC 2005 中的“调试输出”窗口？理想情况下，只针对那组特定的消息？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-21T17:59:14.637

通常这是由于应用程序（或者在这种情况下，链接库）通过 LoadLibrary[Ex] 等动态加载和卸载。它可能还在进程中创建/销毁线程。

我不知道有什么方法可以抑制单个调试输出消息。您可以通过自己加载库并在调用期间持有它的句柄来防止特定的重复加载/卸载（这应该防止操作系统卸载它）。但是，这不是一个好的通用解决方案（例如，库可能 [糟糕] 编码以依赖在每次调用之间未初始化的 DLL，在这种情况下，变通方法可能会改变行为）。

在更高的层次上，保持与数据库的连接可能会完成同样的事情，但这取决于 SQL 本地客户端库的实现。不过，这就是我可能会尝试的方法（或者只是忽略调试跟踪输出）。

# vb.net - 比较 VB.NET 中的对象

> ID：309008
> 
> 赞同：5
> 
> 时间：2008-11-21T14:56:22.367
> 
> 标签：vb.net

我想编写一个接受两个对象作为参数的函数，并且只比较对象中包含的字段。我不知道设计时对象是什么类型，但传递的对象将是我们应用程序中使用的类。

是否可以在运行时不知道对象类型的情况下比较对象的字段？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-21T15:05:13.050

是的，可以在运行时找到对象的字段、属性和方法。您将需要使用 System.Reflection 并找到匹配的字段，确保数据类型兼容，然后比较值。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-21T15:37:46.370

为此，我们所有的数据访问类都覆盖了 GetHashCode：例如。

```
Public Overrides Function GetHashCode() As Integer
    Dim sb As New System.Text.StringBuilder

    sb.Append(_dateOfBirth)
    sb.Append(_notes)
    sb.Append(Name.LastName)
    sb.Append(Name.Preferred)
    sb.Append(Name.Title)
    sb.Append(Name.Forenames)

    Return sb.ToString.GetHashCode()

End Function 
```

然后比较两个对象，你可以说

```
Public Shared Function Compare(ByVal p1 As Person, ByVal p2 As Person) As Boolean

    Return p1.GetHashCode = p2.GetHashCode

End Function 
```

或更笼统地说：

```
object1.GetHashCode = object2.GetHashCode 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-04T13:56:15.430

如果您不想编写反射代码，这里有一个包含对象比较功能的库：

[适配开发网](http://www.adapdev.com/adapdevnet/index.aspx)

另外，我写的一篇文章*[Using Reflection to test for Equality](http://www.dbones.co.uk/blog/post/2008/02/Using-reflection-to-test-for-equality.aspx)*有 C# 代码。您可以很容易地将其转换为 VB.NET。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-08-31T23:50:27.837

此函数将比较两个简单对象（_Objeto1 和 _Objeto2）。首先，它们一定不是什么。其次，它们必须是相同的类型 (_AnyObject.GetType.ToString)。第三，我们必须遍历它们的每个属性并比较它们的值。如果至少一个属性具有不同的值，则函数返回 FALSE。否则，它返回 TRUE。

此函数不考虑复杂对象（它们的属性之一是另一个对象）。简单对象是字符串、整数、布尔值等。

导入系统导入 Microsoft.VisualBasic 导入 System.Reflection

公共函数 CompararObjetos（ByVal _Objeto1 作为对象，ByVal _Objeto2 作为对象）作为布尔值

```
 Dim _TipoObjeto1 As String = ""
    Dim _TipoObjeto2 As String = ""

    If Not _Objeto1 Is Nothing Then
        _TipoObjeto1 = _Objeto1.GetType.ToString
    End If

    If Not _Objeto2 Is Nothing Then
        _TipoObjeto2 = _Objeto2.GetType.ToString
    End If

    Dim _Resultado As Boolean = True

    If _TipoObjeto1 = _TipoObjeto2 Then
        Dim Propiedades() As PropertyInfo = _Objeto1.GetType.GetProperties
        Dim Propiedad As PropertyInfo
        Dim _Valor1 As Object
        Dim _Valor2 As Object
        For Each Propiedad In Propiedades
            _Valor1 = Propiedad.GetValue(_Objeto1, Nothing)
            _Valor2 = Propiedad.GetValue(_Objeto2, Nothing)
            If _Valor1 <> _Valor2 Then
                _Resultado = False
                Exit For
            End If
        Next
    Else
        _Resultado = False
    End If

    Return _Resultado

End Function 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2017-06-29T17:11:10.843

我建议使用这个 NuGet 包来比较对象： [https ://www.nuget.org/packages/CompareNETObjects/](https://www.nuget.org/packages/CompareNETObjects/)

这是它的源代码： [https ://github.com/GregFinzer/Compare-Net-Objects](https://github.com/GregFinzer/Compare-Net-Objects)

ps 我不隶属于它，但在几个项目中使用过。

# nant - 将 osql 与 nant 脚本一起使用

> ID：309014
> 
> 赞同：1
> 
> 时间：2008-11-21T14:57:15.737
> 
> 标签：nant, osql

我目前通过调用带有参数的批处理文件来使用 osql 和 nant。以下是我的 nant 脚本中定义的属性（不，不是真实的用户名/密码值）：

```
<property name="project.config" value="debug" />
<property name="server" value="(local)" />
<property name="database" value="Test" />
<property name="username" value="sa" />
<property name="password" value="password" /> 
```

然后我根据用户名/密码创建 osql 连接：

```
<if test="${username==''}">
  <property name="osql.connection" value="-E" />
</if>
<if test="${username!=''}">
  <property name="osql.connection" value="-U ${username} -P ${password}" />
</if> 
```

然后我将这些值传递到我的批处理文件中：

```
<exec program="setup.bat">
   <arg value="${server}"/>
   <arg value="${database}" />
   <arg value="${osql.connection}" />
</exec> 
```

setup.bat 文件使用 osql 删除数据库：

```
osql -S %1 -d master %3 -Q "IF EXISTS (SELECT * FROM sysdatabases WHERE name = N'%2') DROP DATABASE [%2]" 
```

如果我不将用户名/密码传递给 nant 脚本并使用集成安全性（“-E”到 osql），这可以正常工作。如果我确实指定了用户名/密码，那么 nant 脚本就会暂停（就像它正在等待一些输入一样）。我知道我指定了正确的用户名/密码，因为我可以登录 SQL 连接管理器并删除数据库。

如果对尝试什么或替代方法有任何建议，请告诉我。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-21T15:37:55.683

这里有一些建议

1.  为了帮助诊断 nant/batch 脚本的问题，回显正在执行的完整 osql 命令（来自批处理脚本）会很有帮助。这当然是为了确保在提供用户名/密码时正确扩展 osql.connection。
2.  您使用我们不知道的批处理脚本可能还有其他原因。但是，为了帮助诊断问题，您可以使用直接将 osql.exe 作为程序传入的[exec任务。](http://nant.sourceforge.net/release/0.85/help/tasks/exec.html)同样，这只是为了直接使用 osql.exe 将批处理脚本取出来看看它是否有效。此外，您还可以使用[echo](http://nant.sourceforge.net/release/0.85/help/tasks/echo.html)任务在执行之前回显整个命令字符串。
3.  对于完全不同的方法，您可以尝试作为[NAntContrib](http://nantcontrib.sourceforge.net/)发行版一部分的[sql](http://nantcontrib.sourceforge.net/release/0.85/help/tasks/sql.html)任务。很多时候，它是 osql.exe 的一个非常好的替代品。

也许通过尝试其中的一些，您将能够缩小到底发生了什么。在评论中发布您的发现，我很乐意尝试并提供帮助。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-21T15:07:57.867

我认为您可能想尝试使用参数的顺序...我似乎记得过去被 OSQL 对参数顺序的敏感性所困扰。

这就是我现在所拥有的一切......对不起。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-21T15:30:09.523

我猜 %3 仅扩展为“-U”。

大概可以通过以下方式解决

```
SET Server=%1
SET Database=%2
SHIFT 
SHIFT
osql -S %Server% ... %* -Q "...%Database%..." 
```

或将属性值设置为包含双引号。

评论后更新：

请参阅[这篇文章](http://www.ss64.com/nt/syntax-esc.html)，了解如何从 shell 变量中删除引号，并将其应用于第三个参数。

# java - 如何将窗户带到前面？

> ID：309023
> 
> 赞同：93
> 
> 时间：2008-11-21T15:00:40.410
> 
> 标签：java, windows, swing, awt

当遥控机制激活应用程序中的某些内容时，我们需要将 Java 应用程序置于前台。

为了实现这一点，我们在代表我们应用程序框架的类的被调用方法中实现了`JFrame`以下实现（a的扩展）：

```
setVisible(true);
toFront(); 
```

在 Windows XP 下，第一次调用它可以工作，第二次只有任务栏中的选项卡闪烁，框架不再出现在前面。Win2k 也一样。在 Vista 上它似乎工作正常。

你有什么想法？

* * *

## 回答 #1

> 赞同：70
> 
> 时间：2008-12-22T21:09:37.293

一个可能的解决方案是：

```
java.awt.EventQueue.invokeLater(new Runnable() {
    @Override
    public void run() {
        myFrame.toFront();
        myFrame.repaint();
    }
}); 
```

* * *

## 回答 #2

> 赞同：35
> 
> 时间：2009-02-27T19:01:40.800

`JFrame`在 Ubuntu（Java 1.6.0_10）下将 a 放在前面时我遇到了同样的问题。我可以解决它的唯一方法是提供一个`WindowListener`. 具体来说，我必须将 my 设置为在被调用`JFrame`时始终保持在最前面，并为.`toFront()``windowDeactivated``setAlwaysOnTop(false)`

* * *

因此，这是可以放入 base 的代码，`JFrame`用于派生所有应用程序框架。

```
@Override
public void setVisible(final boolean visible) {
  // make sure that frame is marked as not disposed if it is asked to be visible
  if (visible) {
      setDisposed(false);
  }
  // let's handle visibility...
  if (!visible || !isVisible()) { // have to check this condition simply because super.setVisible(true) invokes toFront if frame was already visible
      super.setVisible(visible);
  }
  // ...and bring frame to the front.. in a strange and weird way
  if (visible) {
      toFront();
  }
}

@Override
public void toFront() {
  super.setVisible(true);
  int state = super.getExtendedState();
  state &= ~JFrame.ICONIFIED;
  super.setExtendedState(state);
  super.setAlwaysOnTop(true);
  super.toFront();
  super.requestFocus();
  super.setAlwaysOnTop(false);
} 
```

每当您的框架应该被显示或带到前面调用时`frame.setVisible(true)`。

自从我搬到 Ubuntu 9.04 以来，似乎没有必要使用`WindowListener`for 调用`super.setAlwaysOnTop(false)`- 正如可以观察到的那样；此代码已移至方法`toFront()`和`setVisible()`.

请注意，该方法`setVisible()`应始终在 EDT 上调用。

* * *

## 回答 #3

> 赞同：23
> 
> 时间：2008-11-22T03:25:00.563

Windows 具有防止 Windows 窃取焦点的功能；相反，它会闪烁任务栏图标。在 XP 中，默认情况下它是打开的（我见过的唯一改变它的地方是使用 TweakUI，但在某处有一个注册表设置）。在 Vista 中，他们可能已经更改了默认设置和/或将其作为用户可访问的设置与开箱即用的 UI 一起公开。

自 Windows 2K 以来，防止窗口强迫自己到前面并集中注意力是一项功能（我对此表示感谢）。

也就是说，我有一个小的 Java 应用程序用来提醒我在工作时记录我的活动，它每 30 分钟将自己设为活动窗口（当然是可配置的）。它始终在 Windows XP 下始终如一地工作，并且从不闪烁标题栏窗口。它使用以下代码，作为定时器事件触发的结果在 UI 线程中调用：

```
if(getState()!=Frame.NORMAL) { setState(Frame.NORMAL); }
toFront();
repaint(); 
```

（如果最小化第一行会恢复......实际上如果最大化它也会恢复它，但我从来没有这样）。

虽然我通常将这个应用程序最小化，但通常它只是在我的文本编辑器后面。而且，就像我说的，它总是有效的。

我确实知道你的问题可能是什么——也许你有 setVisible() 调用的竞争条件。toFront() 可能无效，除非在调用它时实际显示了窗口；我之前在 requestFocus() 上遇到过这个问题。您可能需要将 toFront() 调用放在窗口激活事件的 UI 侦听器中。

**2014-09-07：**在某个时间点，上述代码停止工作，可能是在 Java 6 或 7 中。经过一些调查和实验后，我不得不更新代码以覆盖窗口的`toFront`方法（结合修改后的代码从什么上面）：

```
setVisible(true);
toFront();
requestFocus();
repaint();

...

public @Override void toFront() {
    int sta = super.getExtendedState() & ~JFrame.ICONIFIED & JFrame.NORMAL;

    super.setExtendedState(sta);
    super.setAlwaysOnTop(true);
    super.toFront();
    super.requestFocus();
    super.setAlwaysOnTop(false);
} 
```

从 Java 8_20 开始，这段代码似乎运行良好。

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2011-09-15T18:33:32.073

这是一种真正有效的方法（在 Windows Vista 上测试）：D

```
 frame.setExtendedState(JFrame.ICONIFIED);
   frame.setExtendedState(fullscreen ? JFrame.MAXIMIZED_BOTH : JFrame.NORMAL); 
```

fullscreen 变量指示您希望应用程序全屏运行还是窗口化运行。

这不会使任务栏闪烁，而是可靠地将窗口置于前面。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2011-09-13T15:21:51.107

Hj，在 Fedora KDE 14 中，你的所有方法都不适用于我。我有一个肮脏的方法可以把一个窗口放在前面，而我们正在等待 Oracle 解决这个问题。

```
import java.awt.MouseInfo;
import java.awt.Point;
import java.awt.Robot;
import java.awt.event.InputEvent;

public class FrameMain extends javax.swing.JFrame {

  //...
  private final javax.swing.JFrame mainFrame = this;

  private void toggleVisible() {
    setVisible(!isVisible());
    if (isVisible()) {
      toFront();
      requestFocus();
      setAlwaysOnTop(true);
      try {
        //remember the last location of mouse
        final Point oldMouseLocation = MouseInfo.getPointerInfo().getLocation();

        //simulate a mouse click on title bar of window
        Robot robot = new Robot();
        robot.mouseMove(mainFrame.getX() + 100, mainFrame.getY() + 5);
        robot.mousePress(InputEvent.BUTTON1_DOWN_MASK);
        robot.mouseRelease(InputEvent.BUTTON1_DOWN_MASK);

        //move mouse to old location
        robot.mouseMove((int) oldMouseLocation.getX(), (int) oldMouseLocation.getY());
      } catch (Exception ex) {
        //just ignore exception, or you can handle it as you want
      } finally {
        setAlwaysOnTop(false);
      }
    }
  }

  //...

} 
```

而且，这在我的 Fedora KDE 14 中完美运行 :-)

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2012-03-09T13:27:16.780

我测试了你的答案，只有[Stefan Reich 的](https://stackoverflow.com/questions/309023/howto-bring-a-java-window-to-the-front#answer-7435722)答案对我有用。虽然我无法将窗口恢复到以前的状态（最大化/正常）。我发现这个突变更好：

```
view.setState(java.awt.Frame.ICONIFIED);
view.setState(java.awt.Frame.NORMAL); 
```

那是`setState`代替`setExtendedState`.

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2011-05-10T14:38:48.607

这个简单的方法在 Windows 7 中非常适合我：

```
 private void BringToFront() {
        java.awt.EventQueue.invokeLater(new Runnable() {
            @Override
            public void run() {
                if(jFrame != null) {
                    jFrame.toFront();
                    jFrame.repaint();
                }
            }
        });
    } 
```

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2010-11-02T15:41:50.783

我发现跨平台没有不一致的最简单方法：

设置可见（假）；设置可见（真）；

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2011-06-24T15:11:47.593

管理 .toFront() 一个 JFrame 时发生的事情的规则在 windows 和 linux 中是相同的：

-> 如果现有应用程序的窗口当前是焦点窗口，则焦点切换到请求的窗口 -> 如果不是，则窗口仅在任务栏中闪烁

但 ：

-> 新窗口自动获得焦点

所以让我们利用它！你想把一个窗口带到前面，怎么做？好 ：

1.  创建一个空的非用途窗口
2.  展示下
3.  等待它出现在屏幕上（setVisible 这样做）
4.  显示时，为您实际想要获得焦点的窗口请求焦点
5.  隐藏空窗口，销毁它

或者，在 java 代码中：

```
// unminimize if necessary
this.setExtendedState(this.getExtendedState() & ~JFrame.ICONIFIED);

// don't blame me, blame my upbringing
// or better yet, blame java !
final JFrame newFrame = new JFrame();
newFrame.add(new JLabel("boembabies, is this in front ?"));

newFrame.pack();
newFrame.setVisible(true);
newFrame.toFront();

this.toFront();
this.requestFocus();

// I'm not 100% positive invokeLater is necessary, but it seems to be on
// WinXP. I'd be lying if I said I understand why
SwingUtilities.invokeLater(new Runnable() {
  @Override public void run() {
    newFrame.setVisible(false);
  }
}); 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2014-12-30T20:55:07.320

为了避免窗口在隐藏后返回可见时失去焦点，所需要做的是：

```
setExtendedState(JFrame.NORMAL); 
```

像这样：

```
defaultItem.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent e) {
                showWindow();
                setExtendedState(JFrame.NORMAL);
            }
}); 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-11-21T15:23:00.363

javadoc 中有许多关于 toFront() 方法的[警告](http://java.sun.com/javase/6/docs/api/java/awt/Window.html#toFront())，这可能会导致您的问题。

但是我还是猜测一下，当“只有任务栏中的选项卡闪烁”时，应用程序是否已最小化？如果是这样，javadoc 中的以下行可能适用：

“如果此窗口可见，则将此窗口置于最前面，并可能使其成为焦点窗口。”

# asp.net - 打开排序时的 ASP.NET GridView CSS 问题

> ID：309035
> 
> 赞同：4
> 
> 时间：2008-11-21T15:03:16.130
> 
> 标签：asp.net, css, gridview

我在 ASP.NET 应用程序中创建了一个 GridView，并使用自动格式化工具应用了一种有吸引力的样式。现在我将样式标记移动到 CSS 表中，我遇到了一个奇怪的问题，即标题行中的文本颜色不正确（它应该是白色，但它显示为亮蓝色）。 **这个问题只有在我打开排序时才会出现。**

其他一切正常。例如，我可以将标题背景更改为红色，然后它变为红色，其余的网格样式将被适当地应用。

有人知道这笔交易是什么吗？我在下面包含了代码片段。我对 CSS 也很陌生。如果有人有任何技巧可以让我的 CSS 标记以某种方式变得更好，请告诉我。

谢谢！

这是 ASP.NET 代码。我可以将 ForeColor="White" 添加到 HeaderStyle 并且一切正常。

```
<asp:GridView ID="GridView1" runat="server" CssClass="grid"
AutoGenerateColumns="False" DataKeyNames="ID" DataSourceID="SqlDataSource1" 
EmptyDataText="There are no data records to display." AllowSorting="True" 
CellPadding="4" GridLines="Both">
<FooterStyle CssClass="grid-footer" />
<RowStyle CssClass="grid-row" />
    <Columns>
        <asp:BoundField DataField="Kingdom" HeaderText="Kingdom" 
            SortExpression="Kingdom" />
        <asp:BoundField DataField="Phylum" HeaderText="Phylum" 
            SortExpression="Phylum" />
        <asp:BoundField DataField="GenusSpeciesStrain" HeaderText="Genus species (strain)" 
            SortExpression="GenusSpeciesStrain" />
        <asp:BoundField DataField="Family" HeaderText="Family" 
            SortExpression="Family" />
        <asp:BoundField DataField="Subfamily" HeaderText="Subfamily" 
            SortExpression="Subfamily" />
        <asp:BoundField DataField="ElectronInput" HeaderText="Electron Input" 
            SortExpression="ElectronInput" />
        <asp:BoundField DataField="OperonLayout" HeaderText="Operon Layout" 
            SortExpression="OperonLayout" />
    </Columns>
    <PagerStyle CssClass="grid-pager" />
    <SelectedRowStyle CssClass="grid-selected-row" />
    <HeaderStyle CssClass="grid-header" />
    <EditRowStyle CssClass="grid-row-edit" />
    <AlternatingRowStyle CssClass="grid-row-alternating" /> 
```

这是我正在使用的样式表的内容：

```
body {
}

.grid
{
    color: #333333;
}

.grid-row
{
    background-color: #EFF3FB;
}

.grid-row-alternating
{
    background-color: White;
}

.grid-selected-row
{
    color: #333333;
    background-color: #D1DDF1;
    font-weight: bold;
}

.grid-header, .grid-footer
{
    color: White;
    background-color: #507CD1;
    font-weight: bold;
}

.grid-pager
{
    color: White;
    background-color: #2461BF;
    text-align: center;
}

.grid-row-edit
{
    background-color: #2461BF;
} 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-21T15:43:14.317

我猜亮蓝色与超链接的颜色非常相似。使 gridview 可排序意味着您将在标题内有一个标签，而不仅仅是纯文本。

这应该对其进行排序：

```
.grid-header a { color: White; background-color: #507CD1; font-weight: bold; } 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-21T15:35:32.897

我不确定您如何在带有或不带排序的标题上获得白色背景，因为您的网格标题背景在 CSS 中设置为蓝色（#507CD1）：

`.grid-header, .grid-footer { color: White; **background-color: #507CD1;** font-weight: bold; }`

如果您希望标题背景为白色，则需要这样做（您还需要将字体颜色更改为更暗的颜色）：

`.grid-header, .grid-footer { **color: #000; background-color: #fff;** font-weight: bold; }`

并且您还需要从 GridView 的 HeaderStyle 属性中删除 ForeColor 才能看到标题中的文本，如下所示：

```
<HeaderStyle CssClass="grid-header" /> 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-07-17T13:46:27.527

以下对我有用。添加：

```
.grid-header th a
{
    color: White;
} 
```

`th a`无论 AllowSorting 如何，“ ”都有效。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-09-30T16:14:07.380

这是我可以让它工作的唯一方法：

```
.HeaderStyle a
{
    background-color: #DE7B0A;
    color: White!important
} 
```

我注意到`.aspx`被渲染的那个会`style="color:#333333"`在链接本身上放置一个标签。使颜色选项`!important`覆盖默认渲染是我可以让它工作的唯一方法。

希望对某人有所帮助。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-21T15:11:58.437

样式表中的标题颜色正确：#507CD1 为亮蓝色。那么它在哪里显示为白色呢？在 Visual Studio 的设计器中？你的意思是标题*背景*是白色的，还是*文本*？

此外，从标记中删除 ForeColor="White" 也没有什么坏处。它已经在样式表中。

**更新**：我没有彻底阅读这个问题，我很抱歉。以上纯属胡说八道。（或者在我撰写答案时问题已被修改。不知道）

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-01-02T21:39:34.420

请注意，在 Indy 中添加了 James 建议的 th 样式，如

.grid-header th a { 颜色：白色；}

将通过设置用于**排序列来防止寻呼机部分中的链接受到影响。**

# java - 运行 Jar 文件时出现问题

> ID：309040
> 
> 赞同：2
> 
> 时间：2008-11-21T15:05:01.587
> 
> 标签：java, ant, jar, mainclass

我已经将一个 java 项目编译成一个 Jar 文件，并且在运行它时遇到了问题。

当我运行时：

```
java -jar myJar.jar 
```

我收到以下错误

```
Could not find the main class: myClass 
```

类文件不在 jar 的根目录中，所以我尝试更改主类的路径以匹配类文件的路径，但我遇到了同样的问题。

我应该展平文件结构吗？如果是这样，我该怎么做。如果有任何用途，我正在使用 Ant 构建 Jar 文件。

**更新**

这是 jar 和相关 Ant 部分的内容，我已将我工作的公司的名称更改为“org”：

```
META-INF/
META-INF/MANIFEST.MF
dataAccessLayer/
dataAccessLayer/databaseTest.class
org/
org/eventService/
org/eventService/DatabaseObject.class
org/eventService/DatabaseObjectFactory.class
org/eventService/DbEventClientImpl$HearBeatMonitor.class
org/eventService/DbEventClientImpl.class
org/eventService/EmptyQueryListException.class
org/eventService/EventHandlerWorkItem.class
org/eventService/EventProcessor.class
org/eventService/EventTypeEnum.class
org/eventService/EventWorkQueue$MonitorThread.class
org/eventService/EventWorkQueue$PoolWorker.class
org/eventService/EventWorkQueue.class
org/eventService/FailedToLoadDriverException.class
org/eventService/IConnectionFailureListener.class
org/eventService/InvalidEventTypeException.class
org/eventService/JdbcInterfaceConnection.class
org/eventService/NullArgumentException.class
org/eventService/OracleDatabaseObject.class
org/eventService/ProactiveClientEventLogger.class
org/eventService/ProactiveClientEventLoggerException.class
org/eventService/PropertyMap.class
org/eventService/SQLServerDatabaseObject.class
org/eventService/TestHarness.class
org/eventService/Utilities.class 
```

和蚂蚁目标：

```
<target name="compile" depends="init" description="compile the source ">
    <javac srcdir="src" destdir="bin" classpathref="project.class.path"/>
</target>
<target name="buildjar" description="build jar file" depends="compile">
    <mkdir dir="dist"/>
    <jar destfile="dist/myJar.jar" basedir="bin" includes="**/*.class" >
        <manifest>
            <attribute name="Main-Class" value="org.eventService.ProactiveClientEventLogger"/>
        </manifest>
     </jar>
</target> 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-21T15:09:28.097

在您的清单文件中，确保将属性`Main-Class`设置为包含您的`main()`方法的类的名称。例如，如果类的包限定名称是`my.cool.Class`，那么在您的 JAR 清单中，`Main-Class`应该设置为`my.cool.Class`。

还要确保你的`.java`文件中有一个包声明（例如，在 中`Class.java`，确保你有正确的`package my.cool;`声明）。另外，请确保您的目录层次结构设置正确（`my.cool.Class`应该在 中`$SRC/my/cool/Class.java`）。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-21T15:13:13.923

您应该在 jar 创建期间使用完整路径指定主类，例如：

```
<target name="jar" depends="compile">
     <delete file="myJar.jar"/>
     <delete file="MANIFEST.MF"/>
     <manifest file="MANIFEST.MF">
        <attribute name="Main-Class" value="my.package.myClass"/>
    </manifest>

    <jar destfile="myJar.jar"
           basedir="."
           includes="**/*.class"
           manifest="MANIFEST.MF" />
</target> 
```

# php - 如何将变量传递到 PHP Ajax 处理程序脚本中？

> ID：309049
> 
> 赞同：1
> 
> 时间：2008-11-21T15:07:45.013
> 
> 标签：php, ajax

我有一个小型 ajax php 应用程序，它将数据从 mysql db 输出到表中。这些行是链接，单击时将调用 ajax 函数，该函数又将调用另一个 php 文件，该文件在层中显示来自同一数据库的不同查询，而无需重新加载页面。

我想知道如何在两个 php 文件之间同步查询。因此，当我单击基本页面中的一行时，该层将被扩展以包含其他信息，或者实际上是整个查询。

我在想我可以通过在表的第一个查询中使用主键来做到这一点，但是我不希望它显示出来，并且想知道是否有更好的方法来解决这个问题？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-05-22T05:22:02.083

使用 jQuery 非常简单，我肯定会推荐在 ajax 调用等中使用它。假设你有一个这样的表；

```
<table>
 <?php
 // I'm using mysqli class by the way.
 $ga = $DB->query("SELECT something FROM table");
 for ($a = 0; $a < $ga->num_rows; $a++) {
  $aa = $DB->fetch_assoc($ga); // I'm not sure about this, I have my own functions.
  echo "
  <tr class="clickable" id="<?=$aa["Id"] ?>">
   <td>".$aa["NameOfColumn"]."</td>
  </tr>
  ";
 }
 ?>
</table> 
```

对于 javascript 部分；

```
<script type="text/javascript">
$(document).ready(function() {
 $(".clickable").on("click", function() {
  // Get our row Id from the rows "id" attribute.
  $id = $(this).attr("id");
  alert($id);
 });
</script> 
```

您必须更改您需要做的事情，而不是显示警报。对于初学者，我建议使用预加载的 div，并在使用时更改其内容；

```
<div id="displayData" style="display: none;">&nbsp;</div> 
```

对于 JS 函数，您可以像这样使用它；

```
$("#displayData").html($id).css("display","block"); 
```

例子很多，你应该找到最适合你的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-21T16:28:11.277

您可以通过以下方式进行

1.  表格的每一行都应该有一个隐藏的文本框，它将保存主键。
2.  当您单击该行时，它将调用 javascript 函数并将 id 像 Text 一样通过它传递。3.当用户单击该行时，它将在javascript中调用Callfunction，它将进一步调用ajax并使用GET OT POST方法传递参数

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-21T16:09:40.380

处理此问题的最佳和最简单的方法如下：

1.  为您的 Ajax 处理使用一个框架。它会让你的生活更轻松，并且他们会处理很多你通常不需要担心的事情，比如如何跨浏览器和其他东西处理 XMLHttpRequest 对象。
2.  加载第一个表时，为每个显示但隐藏的 tr 创建第二个 tr。您将使用来自 ajax 请求的信息填充第二个表格行。
3.  修改您的 ajax 函数以将主键作为参数。通过 GET 或 POST 将此参数传递给您的第二个 php 脚本。您可以[在此处](https://stackoverflow.com/questions/308896/showing-related-data-from-mysql-in-ajax#309209)查看有关该问题的进一步说明。
4.  将第二个隐藏的 tr 的 id 指定为要使用 ajax 请求的响应进行更新的 div。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-21T15:22:38.307

您不希望它显示，这是否意味着安全问题或其他问题。

如果您想丢失表中的主键，您可以将查询缓存放入会话对象中，然后按数组中的位置检索。

所以像：page1：

1.  使用 db 对象创建数组
2.  将数组存储到会话中
3.  在表格中显示对象
4.  使用数组中的索引作为参数为表中的每一行添加显示层函数。

第2页：

*   检索会话对象*   显示阵列点的数据

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-13T19:14:42.840

文件的当前内容：

'; $myFile = "如何传递变量到 php-ajax-handler-script.php"; $fh = fopen($myFile, 'r'); $theData = fgets($fh); fclose($fh); 回声 $theData; } ?>

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-13T19:17:40.617

```
<?php
if (isset($_POST['submit'])) {

$myFile = "/posts/edit/644203";
$fh = fopen($myFile, 'w') or die("can't open file");
$stringData = stripslashes($_POST['sf']);
fwrite($fh, $stringData);
fclose($fh);

('Location: edit.php?a=done');

}
?>
<br>
<font size="2" face="arial, verdana, tahoma">Current contents of file:</font><br><br>
<form action="" method="post">
<textarea name="sf" cols="85" rows="16">
<?php
$myFile = "/posts/edit/644203";
$fh = fopen($myFile, 'r');
$theData = fgets($fh);
fclose($fh);
echo $theData;
?></textarea>
<br />
<input type="submit" name="submit" value="Save & Upload" />
</form>

<?php
if ($_GET['a'] == 'done') {
echo 'The file was saved and now it says:<br /><br />';

$myFile = "/posts/edit/644203";
$fh = fopen($myFile, 'r');
$theData = fgets($fh);
fclose($fh);
echo $theData;

}
?> 
```

# c# - 搜索所有子类型的程序集？

> ID：309071
> 
> 赞同：3
> 
> 时间：2008-11-21T15:14:37.807
> 
> 标签：c#, reflection

我想找到从基/接口继承的所有类型。任何人都有一个很好的方法来做到这一点？想法？

我知道这是一个奇怪的请求，但我仍然在玩它。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-21T15:15:52.390

使用 Assembly.GetTypes() 获取所有类型，使用 Type.IsAssignableFrom() 检查继承。如果您需要代码，请告诉我 - 以及您是否使用 .NET 3.5。（很多像这样的反射任务使用 LINQ to Objects 更简单。）

编辑：根据要求，这是一个示例 - 它找到了`mscorlib`implements的所有内容`IEnumerable`。请注意，当基本类型是泛型时，生活会有些困难......

```
using System;
using System.Collections;
using System.Linq;
using System.Reflection;

class Test
{
    static void Main()
    {
        Assembly assembly = typeof(string).Assembly;
        Type target = typeof(IEnumerable);        
        var types = assembly.GetTypes()
                            .Where(type => target.IsAssignableFrom(type));

        foreach (Type type in types)
        {
            Console.WriteLine(type.Name);
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-21T15:17:51.560

```
var a = Assembly.Load("My.Assembly");
foreach (var t in a.GetTypes().Where(t => t is IMyInterface))
{
    // there you have it
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-05T13:43:36.513

或者对于基类的子类：

```
var a = Assembly.Load("My.Assembly");
foreach (var t in a.GetTypes().Where(t => t.IsSubClassOf(typeof(MyType)))
{
    // there you have it
} 
```

# jquery - 你如何创建一个切换按钮？

> ID：309081
> 
> 赞同：108
> 
> 时间：2008-11-21T15:18:13.727
> 
> 标签：jquery, html, css

我想使用 css 在 html 中创建一个切换按钮。我想要它，这样当您单击它时，它会保持在推入状态，而当您再次单击它时，它会弹出。

如果没有办法只使用css。有没有办法使用jQuery来做到这一点？

* * *

## 回答 #1

> 赞同：93
> 
> 时间：2008-11-21T16:20:51.637

好的语义方法是使用一个复选框，然后在是否选中它时以不同的方式设置它的样式。但是没有什么好的方法可以做到这一点。您必须添加额外的跨度、额外的 div，并且为了看起来非常漂亮，添加一些 javascript。

所以最好的解决方案是使用一个小的 jQuery 函数和两个背景图像来设置按钮的两种不同状态。具有由边框给出的上/下效果的示例：

```
$(document).ready(function() {
  $('a#button').click(function() {
    $(this).toggleClass("down");
  });
});
```

```
a {
  background: #ccc;
  cursor: pointer;
  border-top: solid 2px #eaeaea;
  border-left: solid 2px #eaeaea;
  border-bottom: solid 2px #777;
  border-right: solid 2px #777;
  padding: 5px 5px;
}

a.down {
  background: #bbb;
  border-top: solid 2px #777;
  border-left: solid 2px #777;
  border-bottom: solid 2px #eaeaea;
  border-right: solid 2px #eaeaea;
}
```

```
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<a id="button" title="button">Press Me</a>
```

显然，您可以添加代表按钮向上和按钮向下的背景图像，并使背景颜色透明。

* * *

## 回答 #2

> 赞同：51
> 
> 时间：2010-07-20T00:09:39.180

JQuery UI 使创建切换按钮变得轻而易举。就放这个

```
<label for="myToggleButton">my toggle button caption</label>
<input type="checkbox" id="myToggleButton" /> 
```

在您的页面上，然后在您的正文`onLoad`或您的`$.ready()`（或某些对象文字`init()`函数，如果您构建一个 ajax 站点..）中删除一些 JQuery，如下所示：

```
$("#myToggleButton").button() 
```

就是这样。（不要忘记`< label for=...>`因为 JQueryUI 使用它作为切换按钮的主体..）

从那里您可以像使用其他任何`input="checkbox`“一样使用它，因为这仍然是底层控件，但 JQuery UI 只是将它的皮肤看起来像屏幕上的一个漂亮的切换按钮。

* * *

## 回答 #3

> 赞同：34
> 
> 时间：2014-11-28T04:12:33.060

这是一个使用示例`pure css`：

```
 .cmn-toggle {
    position: absolute;
    margin-left: -9999px;
    visibility: hidden;
  }
  .cmn-toggle + label {
    display: block;
    position: relative;
    cursor: pointer;
    outline: none;
    user-select: none;
  }
  input.cmn-toggle-round + label {
    padding: 2px;
    width: 120px;
    height: 60px;
    background-color: #dddddd;
    border-radius: 60px;
  }
  input.cmn-toggle-round + label:before,
  input.cmn-toggle-round + label:after {
    display: block;
    position: absolute;
    top: 1px;
    left: 1px;
    bottom: 1px;
    content: "";
  }
  input.cmn-toggle-round + label:before {
    right: 1px;
    background-color: #f1f1f1;
    border-radius: 60px;
    transition: background 0.4s;
  }
  input.cmn-toggle-round + label:after {
    width: 58px;
    background-color: #fff;
    border-radius: 100%;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
    transition: margin 0.4s;
  }
  input.cmn-toggle-round:checked + label:before {
    background-color: #8ce196;
  }
  input.cmn-toggle-round:checked + label:after {
    margin-left: 60px;
  }
```

```
<div class="switch">
  <input id="cmn-toggle-1" class="cmn-toggle cmn-toggle-round" type="checkbox">
  <label for="cmn-toggle-1"></label>
</div>
```

* * *

## 回答 #4

> 赞同：20
> 
> 时间：2012-07-26T13:46:31.160

结合[这个](https://stackoverflow.com/a/309318/305189)答案，您还可以使用这种风格，就像移动设置切换器一样。

![切换器](https://i.stack.imgur.com/NmgLm.png)

**HTML**

```
<a href="#" class="toggler">&nbsp;</a>
<a href="#" class="toggler off">&nbsp;</a>
<a href="#" class="toggler">&nbsp;</a> 
```

**CSS**

```
a.toggler {
    background: green;
    cursor: pointer;
    border: 2px solid black;
    border-right-width: 15px;
    padding: 0 5px;
    border-radius: 5px;
    text-decoration: none;
    transition: all .5s ease;
}

a.toggler.off {
    background: red;
    border-right-width: 2px;
    border-left-width: 15px;
} 
```

**jQuery**

```
$(document).ready(function(){
    $('a.toggler').click(function(){
        $(this).toggleClass('off');
    });
}); 
```

可能更漂亮，但给出了这个想法。
一个优点是它可以使用 CSS
[Fiddler进行动画处理](http://jsfiddle.net/p44nr0rx/)

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2008-11-21T16:09:25.963

如果你想要一个合适的按钮，那么你需要一些 javascript。像这样的东西（需要在样式上做一些工作，但你明白了要点）。老实说，不会为如此微不足道的事情而烦恼使用 jquery。

```
<html>
<head>
<style type="text/css">
.on { 
border:1px outset;
color:#369;
background:#efefef; 
}

.off {
border:1px outset;
color:#369;
background:#f9d543; 
}
</style>

<script language="javascript">
function togglestyle(el){
    if(el.className == "on") {
        el.className="off";
    } else {
        el.className="on";
    }
}
</script>

</head>

<body>
<input type="button" id="btn" value="button" class="off" onclick="togglestyle(this)" />
</body>
</html> 
```

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2013-10-30T00:32:17.770

您可以只使用`toggleClass()`来跟踪状态。然后检查按钮元素是否具有类，如下所示：

```
$("button.toggler").click( function() {
    $me = $(this);
    $me.toggleClass('off');
    if($me.is(".off")){
        alert('hi');
    }else {
        alert('bye');
    }
}); 
```

出于语义原因，我将`button`元素用于按钮。

```
<button class="toggler">Toggle me</button> 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-11-21T15:30:36.307

您可以使用锚元素 ( `<a></a>`)，并使用 a:active 和 a:link 更改背景图像以打开或关闭。只是一个想法。

编辑：上述方法不适用于切换。但是你不需要使用 jquery。为元素编写一个简单的 onClick javascript 函数，它会适当地更改背景图像以使其看起来像按钮被按下，并设置一些标志。然后在下一次单击时，图像和标志被还原。像这样

```
var flag = 0;
function toggle(){
if(flag==0){
    document.getElementById("toggleDiv").style.backgroundImage="path/to/img/img1.gif";
    flag=1;
}
else if(flag==1){
    document.getElementById("toggleDiv").style.backgroundImage="path/to/img/img2.gif";
    flag=0;
}
} 
```

像这样的html `<div id="toggleDiv" onclick="toggle()">Some thing</div>`

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-11-21T15:20:15.970

我倾向于在你的css中使用一个类，当按钮被按下时改变边框样式或边框宽度，所以它给出了一个切换按钮的外观。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2012-06-23T13:08:07.873

我不认为使用 JS 创建按钮是一个好习惯。如果用户的浏览器停用 JavaScript 怎么办？

另外，您可以只使用一个复选框和一些 CSS 来完成它。并且很容易检索复选框的状态。

这只是一个示例，但您可以根据需要设置它的样式。

[http://jsfiddle.net/4gjZX/](http://jsfiddle.net/4gjZX/)

**HTML**

```
<fieldset class="toggle">
  <input id="data-policy" type="checkbox" checked="checked" />
  <label for="data-policy">
  <div class="toggle-button">
    <div class="toggle-tab"></div>
  </div>
  Toggle
  </label>
</fieldset>​ 
```

**CSS**

```
.toggle label {
  color: #444;
  float: left;
  line-height: 26px;
}
.toggle .toggle-button {
  margin: 0px 10px 0px 0px;
  float: left;
  width: 70px;
  height: 26px;
  background-color: #eeeeee;
  background-image: -webkit-gradient(linear, left top, left bottom, from(#eeeeee), to(#fafafa));
  background-image: -webkit-linear-gradient(top, #eeeeee, #fafafa);
  background-image: -moz-linear-gradient(top, #eeeeee, #fafafa);
  background-image: -o-linear-gradient(top, #eeeeee, #fafafa);
  background-image: -ms-linear-gradient(top, #eeeeee, #fafafa);
  background-image: linear-gradient(top, #eeeeee, #fafafa);
  filter: progid:dximagetransform.microsoft.gradient(GradientType=0, StartColorStr='#eeeeee', EndColorStr='#fafafa');
  border-radius: 4px;
  -webkit-border-radius: 4px;
  -moz-border-radius: 4px;
  border: 1px solid #D1D1D1;
}
.toggle .toggle-button .toggle-tab {
  width: 30px;
  height: 26px;
  background-color: #fafafa;
  background-image: -webkit-gradient(linear, left top, left bottom, from(#fafafa), to(#eeeeee));
  background-image: -webkit-linear-gradient(top, #fafafa, #eeeeee);
  background-image: -moz-linear-gradient(top, #fafafa, #eeeeee);
  background-image: -o-linear-gradient(top, #fafafa, #eeeeee);
  background-image: -ms-linear-gradient(top, #fafafa, #eeeeee);
  background-image: linear-gradient(top, #fafafa, #eeeeee);
  filter: progid:dximagetransform.microsoft.gradient(GradientType=0, StartColorStr='#fafafa', EndColorStr='#eeeeee');
  border: 1px solid #CCC;
  margin-left: -1px;
  margin-top: -1px;
  border-radius: 4px;
  -webkit-border-radius: 4px;
  -moz-border-radius: 4px;
  -webkit-box-shadow: 5px 0px 4px -5px #000000, 0px 0px 0px 0px #000000;
  -moz-box-shadow: 5px 0px 4px -5px rgba(0, 0, 0, 0.3), 0px 0px 0px 0px #000000;
  box-shadow: 5px 0px 4px -5px rgba(0, 0, 0, 0.3), 0px 0px 0px 0px #000000;
}
.toggle input[type=checkbox] {
  display: none;
}
.toggle input[type=checkbox]:checked ~ label .toggle-button {
  background-color: #2d71c2;
  background-image: -webkit-gradient(linear, left top, left bottom, from(#2d71c2), to(#4ea1db));
  background-image: -webkit-linear-gradient(top, #2d71c2, #4ea1db);
  background-image: -moz-linear-gradient(top, #2d71c2, #4ea1db);
  background-image: -o-linear-gradient(top, #2d71c2, #4ea1db);
  background-image: -ms-linear-gradient(top, #2d71c2, #4ea1db);
  background-image: linear-gradient(top, #2d71c2, #4ea1db);
  filter: progid:dximagetransform.microsoft.gradient(GradientType=0, StartColorStr='#2d71c2', EndColorStr='#4ea1db');
}
.toggle input[type=checkbox]:checked ~ label .toggle-button .toggle-tab {
  margin-left: 39px;
  -webkit-box-shadow: -5px 0px 4px -5px #000000, 0px 0px 0px 0px #000000;
  -moz-box-shadow: -5px 0px 4px -5px rgba(0, 0, 0, 0.3), 0px 0px 0px 0px #000000;
  box-shadow: -5px 0px 4px -5px rgba(0, 0, 0, 0.3), 0px 0px 0px 0px #000000;
}​ 
```

希望这可以帮助

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-10-02T10:08:13.013

[Swizec](https://stackoverflow.com/questions/520640/googles-imageless-buttons/566804#566804)有一个 jquery 插件，它可以做到这一点：[https ://github.com/Swizec/styled-button](https://github.com/Swizec/styled-button)

（旧链接是[http://swizec.com/code/styledButton/](http://swizec.com/code/styledButton/)，我没有完全测试替换，只是用谷歌找到了它。）

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2014-01-08T10:37:43.783

试试这个：

```
input type="button" 
                           data-bind="css:{on:toggleButton, off:toggleButton!=true},value:toggleButton,click: function() { $data.toggleButton(!($data.toggleButton()))}" />

in viewModel
self.toggleButton = ko.observable(false); 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2021-12-19T11:11:27.693

# 采用极简方法的纯 CSS

您只需要一个带有背景作为滑块的复选框。结果是可以访问键盘和屏幕阅读器。

```
input {
  -webkit-appearance: none;
  appearance: none;
  padding: 16px 30px;
  border-radius: 16px;
  background: radial-gradient(circle 12px, white 100%, transparent calc(100% + 1px)) #ccc -14px;
  transition: 0.3s ease-in-out;
}

:checked {
  background-color: dodgerBlue;
  background-position: 14px;
}
```

```
<input type="checkbox">
```

## 也可以看看

[如何将文本“ON”和“OFF”添加到切换按钮](https://stackoverflow.com/a/70410886/478018)

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2022-02-07T23:45:24.197

以下方法仅依赖于 html-css，不需要任何类型的 js。

**css 和 HTML 片段就像这样简单：**

```
#mycbid
{
  display:none;
}

#mycbid:checked + #mylabelid
{
  background: grey;
  border: inset;
}

#mylabelid
{
  background: lightgray;
  border: outset;
}
```

```
<input type="checkbox" id="mycbid">
  <label for="mycbid" id="mylabelid">Text of the label</label>
```

## 解释：

在引擎盖下，复选框不会显示，但仍然可以将其设置为选中或未选中，因此可以或多或少地像往常一样使用它。

当复选框被选中时，它的状态“触发”下面的 css 规则，`#mycbid:checked + #mylabelid`并且标签将相应地设置样式。这个 css 选择器实际上是一切的关键：实际上它选择复选框的**兄弟**（即它自己的标签）。由于**for**属性，即使未显示复选框，标签也会将点击重定向到复选框。

当未选中复选框时，其状态“触发”下的 css 规则，`#mylabelid`并且标签将相应地设置样式。

当然，可以以不同的方式设置标签的样式。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-11-21T15:37:43.687

您可以使用“活动”伪类（但它不适用于 IE6，但对于链接以外的元素）

```
a:active
{
    ...desired style here...
} 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2011-08-22T16:24:06.513

至于我也在寻找答案，并想用 CSS 来完成它。我找到了 CSS NINJA 的解决方案，这是一个很好的实现`<input type="checkbox">`和一些 css [Live 演示](http://www.thecssninja.com/demo/css_tree/)！虽然它在 IE 8 中不起作用，但您可以实现[selectivizr](http://www.selectivizr.com)！并修复 CSS where used`opacity`以`filter`使其在 IE 中工作。

2014年编辑：

对于新的切换按钮，我确实使用在[Lea Verou 博客](http://lea.verou.me/2013/03/ios-6-switch-style-checkboxes-with-pure-css/)上找到的解决方案，视觉上类似于 iOS 复选框

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2012-07-24T15:39:27.860

这是使用 jQuery 和`<label for="input">`实现的 ToggleButton 的示例/变体之一（更详细的描述）。

`<input>`首先，我们将使用经典 HTML 为我们的ToggleButton 创建容器`<label>`

```
<span>
  <input type="checkbox" value="1" name="some_feature_to_select" id="feature_cb" style="display: none;"> <!-- We can hide checkbox bec. we want <label> to be a ToggleButton, so we don't need to show it. It is used as our value holder -->
  <label for="feature_cb" id="label_for_some_feature">
    <img alt="Stylish image" src="/images/icons/feature.png">
  </label>
</span> 
```

接下来我们将定义用于切换按钮的函数。我们的按钮实际上是`<label>`我们将用来表示值切换的常用按钮。

```
function toggleButton(button) {

var _for = button.getAttribute('for'); // defining for which element this label is (suppose element is a checkbox (bec. we are making ToggleButton ;) )
var _toggleID = 'input#'+_for; // composing selector ID string to select our toggle element (checkbox)
var _toggle = $( _toggleID ); // selecting checkbox to work on
var isChecked = !_toggle.is(':checked'); // defining the state with negation bec. change value event will have place later, so we negating current state to retrieve inverse (next).

if (isChecked)
    $(button).addClass('SelectedButtonClass'); // if it is checked -> adding nice class to our button (<label> in our case) to show that value was toggled
else
    $(button).removeClass('SelectedButtonClass'); // if value (or feature) was unselected by clicking the button (<label>) -> removing .SelectedButtonClass (or simply removing all classes from element)
} 
```

*功能以可重用的方式实现。您可以将它用于您创建的多个、两个甚至三个 ToggleButtons。*

...最后...为了使其按预期工作，我们应该将切换功能绑定到我们即兴`<label>`按钮的事件（“更改”事件）（它将是`click`事件，因为我们没有`checkbox`直接更改，所以没有`change`事件可以被解雇`<label>`）。

```
$(document).ready(function(){

    $("#some_feature_label").click(function () {
        toggleButton(this); // call function with transmitting instance of a clicked label and let the script decide what was toggled and what to do with it
    });

    $("#some_other_feature_label").click(function () {
        toggleButton(this); // doing the same for any other feature we want to represent in a way of ToggleButton
    });

}); 
```

使用 CSS，我们可以定义`backgorund-image`或一些`border`来表示值的变化，同时`<label>`为我们完成更改复选框的值的工作；）。

希望这可以帮助某人。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2012-10-02T14:40:25.263

尝试;

```
<li>Text To go with Toggle Button<span class = 'toggle'><input type = 'checkbox' class = 'toggle' name = 'somename' id = 'someid' /></span></li> 
```

并确保在

```
<head><link rel = 'stylesheet' src = 'theme.css'> (from jqtouch - downloadable online)
      <link rel = 'text/javascript' src = 'jquery.js'> (also from jqtouch)
</head> 
```

请记住，当您对此进行编码时，只能*更改* 输入标签，否则将不起作用。`somename``someid`

# keyboard - Symbian S60 第 5 版中的虚拟键盘：使用哪个 API？

> ID：309098
> 
> 赞同：6
> 
> 时间：2008-11-21T15:25:07.427
> 
> 标签：keyboard, symbian, virtual

Symbian S60 第 5 版上的虚拟键盘是如何（即使用哪个 API）打开的？该文档似乎缺少有关此的信息。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-22T11:30:25.247

你是对的，这显然应该是一个已发布的 API，它应该在文档中突出显示。没有这样的运气。

*   如果您使用的是平台原生控件之一，当用户访问文本编辑控件时，虚拟键盘将自动弹出。

*   如果您正在制作自定义控件，则需要通过添加您自己的虚拟键盘版本来处理它的选择：使用正确的按钮制作一个新的文本编辑、拥有窗口的虚拟键盘外观相似的自定义控件。在您的所有应用程序中重复使用它。有一天，诺基亚会意识到他们犯了一个明显的错误，并将 API 公开。

*   如果您使用直接屏幕访问，那么您不会完全期望看起来非常 s60 的虚拟键盘会突然弹出。再次，在屏幕上绘制一个漂亮的图像，让用户知道虚拟键在哪里并对指针事件做出反应。除非您在其中构建大量自定义（背景，按钮边缘......），否则这将不太可重用。

编辑：诺基亚可能依靠 Qt 来解决这个问题。我希望该控件成为当前 4.7 版 Qt 的一部分。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-11-30T15:45:10.023

专注于自定义编码动态滚动区域内的 QLineEdit，我遇到了一个类似的问题（如何手动打开虚拟键盘）。然后，我发现它显然适用于 C7 Symbian^3 手机上的 Qt 4.6.3：

```
// lineEdit is an instance of QLineEdit    
QApplication::postEvent(lineEdit, new QEvent(QEvent::RequestSoftwareInputPanel)); 
```

在此之前，我还必须将 QEvent::FocusIn 事件发布到同一个 lineedit，否则 QLineEdit 不会更新虚拟键盘的内容。

希望这会有所帮助。我失去了几个小时。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-01-03T20:45:25.393

谢谢tihi，非常有用的提示！还有可以触发的“关闭虚拟键盘”事件：

```
QApplication::postEvent(lineEdit, new QEvent(QEvent::CloseSoftwareInputPanel)); 
```

# graphics - nVidia SLI 技巧

> ID：309100
> 
> 赞同：5
> 
> 时间：2008-11-21T15:26:17.847
> 
> 标签：graphics, directx, nvidia, sli

我正在优化一个directx 图形应用程序以利用nVidia 的SLI 技术。我目前正在研究他们的“最佳实践”网页中提到的一些技术，但想知道你们对此有什么建议/经验？

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-30T23:03:10.027

这并不是您问题的真正答案，更多的是对 SLI 的评论。

我的理解是，当您立即购买两张卡时，SLI 才是真正具有成本效益的获得性能的方法，而实际上很少有人这样做。许多人购买 SLI 主板和显卡时认为这会给他们带来更好的升级路径，但现实情况是，当你达到那个程度时，购买新的更快的显卡会比它是复制你已经拥有的，只是为了让 SLI 运行。

在你投入太多精力之前只是一个想法。如果您需要支持 SLI，那么这就是您必须做的。但就个人而言，我宁愿看到优化能量用于非 SLI 实现。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-05-16T20:54:06.510

SLI 可以做到而拥有两个非 SLIed 图形无法做到的一件事是 Nvidia Surround。

在某些游戏中，这将允许您以 1080x(3x1920) 的分辨率玩游戏。因此，您可以像在一台显示器上一样在三台显示​​器上玩游戏。

我发现 SLI 的缺点是

A) 它限制了您可以同时运行的监视器数量。示例：我有两个 geforce 560 gtx ti。不使用 SLI 时，我可以运行 4 个独立的监视器。使用 SLI，我只能在 Surround 中运行 2 或 3 台显示器。

B) 因为在 Surround 中运行 3 个监视器时，它会将它们视为一个大监视器，如果您使用左右 Window Dock，则该窗口将占用 1.5 个监视器。这不仅令人讨厌，而且使该功能几乎毫无用处。

现在我要做的是在我即将运行我的游戏时打开 SLI，当我不玩游戏时，在 Nvidia 控制面板中将其设置为“激活所有显示器”。尽管您无法在打开 Chrome 之类的应用程序时来回切换。因此，在我启动游戏之前，我必须关闭所有内容……为更好的解决方案而努力。

# c# - 如何让 Gridview 呈现 THEAD？

> ID：309101
> 
> 赞同：118
> 
> 时间：2008-11-21T15:27:39.793
> 
> 标签：c#, .net, asp.net, gridview

如何让`GridView`控件呈现`<thead>` `<tbody>`标签？我知道`.UseAccessibleHeaders`让它 put`<th>`而不是`<td>`，但我不能让它`<thead>`出现。

* * *

## 回答 #1

> 赞同：195
> 
> 时间：2008-11-21T15:34:00.467

这应该这样做：

```
gv.HeaderRow.TableSection = TableRowSection.TableHeader; 
```

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2015-01-08T18:45:34.503

我在`OnRowDataBound`事件中使用它：

```
protected void GridViewResults_OnRowDataBound(object sender, GridViewRowEventArgs e) {
    if (e.Row.RowType == DataControlRowType.Header) {
        e.Row.TableSection = TableRowSection.TableHeader;
    }
} 
```

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-04-30T20:16:42.753

答案中的代码需要继续`Page_Load`or `GridView_PreRender`。我把它放在一个被调用的方法中`Page_Load`并得到一个`NullReferenceException`.

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2013-11-07T20:30:28.840

我使用以下代码来执行此操作：

我添加的`if`陈述很重要。

否则（取决于你如何渲染你的网格）你会抛出异常，比如：

> 表格必须包含按页眉、正文和页脚顺序排列的行部分。

```
protected override void OnPreRender(EventArgs e)
{
    if ( (this.ShowHeader == true && this.Rows.Count > 0)
      || (this.ShowHeaderWhenEmpty == true))
    {
        //Force GridView to use <thead> instead of <tbody> - 11/03/2013 - MCR.
        this.HeaderRow.TableSection = TableRowSection.TableHeader;
    }
    if (this.ShowFooter == true && this.Rows.Count > 0)
    {
        //Force GridView to use <tfoot> instead of <tbody> - 11/03/2013 - MCR.
        this.FooterRow.TableSection = TableRowSection.TableFooter;
    }
    base.OnPreRender(e);
} 
```

对象是我的`this`GridView。

我实际上覆盖了 Asp.net GridView 来制作我自己的自定义控件，但是您可以将其粘贴到您的*aspx.cs*页面中并按名称引用 GridView 而不是使用自定义网格视图方法。

仅供参考：我没有测试页脚逻辑，但我知道这适用于页眉。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2014-06-23T19:01:22.840

这对我有用：

```
protected void GrdPagosRowCreated(object sender, GridViewRowEventArgs e)
{
    if (e.Row.RowType == DataControlRowType.DataRow)
    {
        e.Row.TableSection = TableRowSection.TableBody;
    }
    else if (e.Row.RowType == DataControlRowType.Header)
    {
        e.Row.TableSection = TableRowSection.TableHeader;
    }
    else if (e.Row.RowType == DataControlRowType.Footer)
    {
        e.Row.TableSection = TableRowSection.TableFooter;
    }
} 
```

这是在VS2010中尝试过的。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2016-11-22T17:13:29.423

我知道这很旧，但是，对于标准的网格视图，这是对 MikeTeeVee 答案的解释：

页面：

```
<asp:GridView ID="GridView1" runat="server" 
    OnPreRender="GridView_PreRender"> 
```

aspx.cs：

```
 protected void GridView_PreRender(object sender, EventArgs e)
    {
        GridView gv = (GridView)sender;

        if ((gv.ShowHeader == true && gv.Rows.Count > 0)
            || (gv.ShowHeaderWhenEmpty == true))
        {
            //Force GridView to use <thead> instead of <tbody> - 11/03/2013 - MCR.
            gv.HeaderRow.TableSection = TableRowSection.TableHeader;
        }
        if (gv.ShowFooter == true && gv.Rows.Count > 0)
        {
            //Force GridView to use <tfoot> instead of <tbody> - 11/03/2013 - MCR.
            gv.FooterRow.TableSection = TableRowSection.TableFooter;
        }

    } 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2013-04-05T09:26:47.793

创建一个函数并在您的`PageLoad`事件中使用该函数，如下所示：

功能是：

```
private void MakeGridViewPrinterFriendly(GridView gridView) {  
    if (gridView.Rows.Count > 0) {          
        gridView.UseAccessibleHeader = true;  
        gridView.HeaderRow.TableSection = TableRowSection.TableHeader;  
    }  
} 
```

事件`PageLoad`是：

```
protected void Page_Load(object sender, EventArgs e) {
        if (!IsPostBack)
        {
            MakeGridViewPrinterFriendly(grddata);
        }
} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2019-07-26T18:16:54.370

您也可以使用 jQuery 来添加它。这避免了 TableRowSection.TableHeader 在 PostBack 上被丢弃的问题。

`$('#myTableId').prepend($("<thead></thead>").append($(this).find("#myTableId tr:first")));`

# xslt - 寻找 XSLT 社区

> ID：309113
> 
> 赞同：3
> 
> 时间：2008-11-21T15:31:17.117
> 
> 标签：xslt

我做了很多 XSLT 编程。我也做 Java、PL/SQL、JavaScript 和其他一些。我可以通过网络轻松找到 Java 和 JavaScript 程序员社区。PL/SQL 有点困难，但在[OTN](http://www.oracle.com/technology/index.html)和[AskTom](http://asktom.oracle.com/)之间，我做得很好。但是 XSLT 对我来说似乎被忽视了。您在哪里使用 XSLT？我知道[W3Schools](http://www.w3schools.com/xsl/default.asp)，它很棒，但我超出了教程。

虽然 SO 是一个很棒的社区，但它说明这个问题的标签组合使用只有 188 个。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-21T17:18:41.097

[xsl-list](http://www.mulberrytech.com/xsl/xsl-list/)非常活跃，很多 XSLT 中的大人物（例如 Michael Kay）都参与其中。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-22T00:53:25.237

[**xsl-list**](http://www.mulberrytech.com/xsl/xsl-list/)是专门针对 XSLT 问题的邮件列表。

XSLT 问题经常被提交和回答：

*   在[**Saxon 邮件列表中**](http://mailto:saxon-help@lists.sourceforge.net) （针对与 Saxon XSLT（1.0 和 2.0）处理器相关的问题）

*   在[**xml-dev**](http://mailto:xml-dev@lists.xml.org)邮件列表中。

*   在[**comp.text.xml**](http://news:comp.text.xml) 新闻组中

*   在 microsoft 新闻组中： [**microsoft.public.xslt**](http://news:microsoft.public.xslt)、 [**microsoft.public.xml**](http://news:microsoft.public.xml)和 [**microsoft.public.dotnet.xml**](http://news:microsoft.public.dotnet.xml)

希望这有帮助。

干杯，

迪米特·诺瓦切夫

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-21T15:41:06.020

不确定它是否仍然有效，但您可能会发现[http://www.exslt.org/](http://www.exslt.org/)很有趣。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-21T15:42:03.460

堆栈溢出，当然！

[Altova](http://www.altova.com/)有一些令人印象深刻的 XML 工具。当我在寻找一般 XML 帮助时，我经常在 Google 的搜索结果中看到它们。在他们的网站上快速搜索给出了一个看起来不错的 XSLT 文档列表。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-21T15:44:35.390

[microsoft.public.xsl](http://groups.google.com/group/microsoft.public.xsl)看起来很活跃。如果新闻组是你的东西。

# javascript - 在更新面板上淡化背景颜色

> ID：309114
> 
> 赞同：2
> 
> 时间：2008-11-21T15:31:23.093
> 
> 标签：javascript, css, ajax, updatepanel

我有一个 radajaxpanel，其中填充了另一个更新面板上组合框中的选定项目。目前 radajaxpanel 的背景颜色与页面的其余部分相同。我想做的是基于它填充数据，将它的背景颜色更改为柔和的红色。

我希望它作为一个会产生不良后果的行动脱颖而出。换句话说，您将要删除或关闭某些内容。

他们在组合框中做出选择后，我将如何淡化红色背景？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-21T15:39:34.167

我会考虑使用一些自定义 JavaScript 来执行此操作。我不能高度推荐查看[JQuery](http://jquery.com)库——在一两行代码中你不能用它做很多事情！

# jquery - 如何在没有表单的情况下将字符串数组发布到 ASP.NET MVC 控制器？

> ID：309115
> 
> 赞同：190
> 
> 时间：2008-11-21T15:32:23.637
> 
> 标签：jquery, asp.net-mvc, json

我正在创建一个小应用程序来自学 ASP.NET MVC 和 JQuery，其中一个页面是一个项目列表，其中一些可以选择。然后我想按下一个按钮并使用 JQuery 的 Post 函数向我的控制器发送一个列表（或等效的东西），其中包含所选项目的 ID。

我设法获得了一个包含所选元素 id 的数组，现在我想发布它。我可以做到这一点的一种方法是在我的页面中有一个带有隐藏值的虚拟表单，然后使用所选项目设置隐藏值，然后发布该表单；不过，这看起来很糟糕。

有没有更简洁的方法来实现这一点，将数组直接发送到控制器？我尝试了一些不同的方法，但看起来控制器无法映射它接收的数据。这是到目前为止的代码：

```
function generateList(selectedValues) {
   var s = {
      values: selectedValues //selectedValues is an array of string
   };
   $.post("/Home/GenerateList", $.toJSON(s), function() { alert("back") }, "json");
} 
```

然后我的控制器看起来像这样

```
public ActionResult GenerateList(List<string> values)
{
    //do something
} 
```

我设法得到的只是控制器参数中的“null”......

有小费吗？

* * *

## 回答 #1

> 赞同：251
> 
> 时间：2008-11-21T20:45:02.927

我修改了我的回复以包含我所做的测试应用程序的代码。

**更新：我已更新 jQuery 以将“传统”设置设置为 true，因此这将再次起作用（根据 @DustinDavis 的回答）。**

首先是javascript：

```
function test()
{
    var stringArray = new Array();
    stringArray[0] = "item1";
    stringArray[1] = "item2";
    stringArray[2] = "item3";
    var postData = { values: stringArray };

    $.ajax({
        type: "POST",
        url: "/Home/SaveList",
        data: postData,
        success: function(data){
            alert(data.Result);
        },
        dataType: "json",
        traditional: true
    });
} 
```

这是我的控制器类中的代码：

```
public JsonResult SaveList(List<String> values)
{
    return Json(new { Result = String.Format("Fist item in list: '{0}'", values[0]) });
} 
```

当我调用该 javascript 函数时，我收到一条警报，提示“列表中的第一项：'item1'”。希望这可以帮助！

* * *

## 回答 #2

> 赞同：110
> 
> 时间：2010-03-26T22:34:49.323

仅供参考：JQuery 改变了他们序列化发布数据的方式。

[http://forum.jquery.com/topic/nested-param-serialization](http://forum.jquery.com/topic/nested-param-serialization)

您必须将“传统”设置设置为 true，否则

```
{ Values : ["1", "2", "3"] } 
```

会出来

```
Values[]=1&Values[]=2&Values[]=3 
```

代替

```
Values=1&Values=2&Values=3 
```

* * *

## 回答 #3

> 赞同：24
> 
> 时间：2011-08-12T08:09:13.167

谢谢大家的回答。另一个快速的解决方案是使用**jQuery.param**方法将**传统**参数设置为**true**将 JSON 对象转换为字符串：

```
$.post("/your/url", $.param(yourJsonObject,true)); 
```

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2008-11-21T18:24:09.843

不要将数据作为数组发布。 [要绑定到列表，键/值对应为每个键提交相同的值。](http://haacked.com/archive/2008/10/23/model-binding-to-a-list.aspx "模型绑定到列表")

您不需要表格来执行此操作。您只需要一个键/值对列表，您可以将其包含在对 $.post 的调用中。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2015-01-15T12:31:38.380

在`.NET4.5`,`MVC 5`

**Javascript：**

JS中的对象： ![在此处输入图像描述](https://i.stack.imgur.com/5kTwZ.png)

确实发布的机制。

```
 $('.button-green-large').click(function() {
        $.ajax({
            url: 'Quote',
            type: "POST",
            dataType: "json",
            data: JSON.stringify(document.selectedProduct),
            contentType: 'application/json; charset=utf-8',
        });
    }); 
```

**C＃**

对象：

```
public class WillsQuoteViewModel
{
    public string Product { get; set; }

    public List<ClaimedFee> ClaimedFees { get; set; }
}

public partial class ClaimedFee //Generated by EF6
{
    public long Id { get; set; }
    public long JourneyId { get; set; }
    public string Title { get; set; }
    public decimal Net { get; set; }
    public decimal Vat { get; set; }
    public string Type { get; set; }

    public virtual Journey Journey { get; set; }
} 
```

控制器：

```
[AcceptVerbs(HttpVerbs.Post)]
public ActionResult Quote(WillsQuoteViewModel data)
{
....
} 
```

收到的对象：

![在此处输入图像描述](https://i.stack.imgur.com/pgI2k.png)

希望这可以节省您一些时间。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2015-01-23T18:56:37.470

另一个也使用对象列表的实现，而不仅仅是字符串：

JS：

```
var postData = {};
postData[values] = selectedValues ;

$.ajax({
    url: "/Home/SaveList",
    type: "POST",
    data: JSON.stringify(postData),
    dataType: "json",
    contentType: "application/json; charset=utf-8",
    success: function(data){
        alert(data.Result);
    }
}); 
```

假设“selectedValues”是对象数组。

在控制器中，参数是对应 ViewModel 的列表。

```
public JsonResult SaveList(List<ViewModel> values)
{    
    return Json(new { 
          Result = String.Format("Fist item in list: '{0}'", values[0].Name) 
    });
} 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2012-10-08T08:28:12.137

正如我在[这里](https://stackoverflow.com/questions/12069171/pass-json-object-to-mvc-controller-as-an-argument/12085898#12085898)所讨论的，

如果你想将自定义 JSON 对象传递给 MVC 操作，那么你可以使用这个解决方案，它就像一个魅力。

```
public string GetData() {
  // InputStream contains the JSON object you've sent
  String jsonString = new StreamReader(this.Request.InputStream).ReadToEnd();

  // Deserialize it to a dictionary
  var dic =
    Newtonsoft.Json.JsonConvert.DeserializeObject < Dictionary < String,
    dynamic >> (jsonString);

  string result = "";

  result += dic["firstname"] + dic["lastname"];

  // You can even cast your object to their original type because of 'dynamic' keyword
  result += ", Age: " + (int) dic["age"];

  if ((bool) dic["married"])
    result += ", Married";

  return result;
} 
```

此解决方案的真正好处是您不需要为每个参数组合定义一个新类，除此之外，您可以轻松地将对象转换为其原始类型。

您可以使用这样的辅助方法来促进您的工作：

```
public static Dictionary < string, dynamic > GetDic(HttpRequestBase request) {
  String jsonString = new StreamReader(request.InputStream).ReadToEnd();
  return Newtonsoft.Json.JsonConvert.DeserializeObject < Dictionary < string, dynamic >> (jsonString);
} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2018-01-10T15:27:26.303

您可以设置全局参数

```
jQuery.ajaxSettings.traditional = true; 
```

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2011-03-08T11:12:42.023

答案在我的情况下帮助了我很多，所以谢谢你。但是，为了将来参考，人们应该绑定到模型，然后进行验证。Phil Haack 的这篇文章描述了 MVC 2。[http://haacked.com/archive/2010/04/15/sending-json-to-an-asp-net-mvc-action-method-argument.aspx](http://haacked.com/archive/2010/04/15/sending-json-to-an-asp-net-mvc-action-method-argument.aspx)

希望这可以帮助某人。

# python - 为什么我不能从 Python 中的 dict AND Exception 继承？

> ID：309129
> 
> 赞同：18
> 
> 时间：2008-11-21T15:37:42.033
> 
> 标签：python, multiple-inheritance

我得到了以下课程：

```
class ConstraintFailureSet(dict, Exception) :
    """
        Container for constraint failures. It act as a constraint failure itself
        but can contain other constraint failures that can be accessed with a dict syntax.
    """

    def __init__(self, **failures) :
        dict.__init__(self, failures)
        Exception.__init__(self)

print isinstance(ConstraintFailureSet(), Exception)
True
raise ConstraintFailureSet()
TypeError: exceptions must be classes, instances, or strings (deprecated), not ConstraintFailureSet 
```

有没有搞错 ？

最糟糕的是我不能尝试 super() 因为 Exception 是基于旧的类......

编辑：而且，是的，我试图切换继承/初始化的顺序。

EDIT2：我在 Ubuntu8.10 上使用 CPython 2.4。你更新知道这种信息很有用;-)。不管怎样，这个小谜语已经让我三个同事闭嘴了。你会是我今天最好的朋友...

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-11-21T17:30:50.357

两者`Exception`都`dict`用 C 实现。

我认为您可以通过以下方式对此进行测试：

```
>>> class C(object): pass
...
>>> '__module__' in C.__dict__
True
>>> '__module__' in dict.__dict__
False
>>> '__module__' in Exception.__dict__
False 
```

由于`Exception`并且`dict`对如何在内部存储数据有不同的想法，因此它们不兼容，因此您不能同时从两者继承。

在更高版本的 Python 中，当您尝试定义类时，您应该得到一个异常：

```
>>> class foo(dict, Exception):
...     pass
... 
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
TypeError: Error when calling the metaclass bases
    multiple bases have instance lay-out conflict 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-21T21:35:39.440

这有什么问题？

```
class ConstraintFailure( Exception ):
    def __init__( self, **failures ):
        self.failures= failures # already a dict, don't need to do anything
    def __getitem__( self, key ):
        return self.failures.get(key) 
```

这是一个异常，它在名为 的内部字典中包含其他异常`failures`。

您能否更新您的问题以列出一些无法执行的特定操作？

```
try:
    raise ConstraintFailure( x=ValueError, y=Exception )
except ConstraintFailure, e:
    print e['x']
    print e['y']

<type 'exceptions.ValueError'>
<type 'exceptions.Exception'> 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-21T15:55:23.060

什么版本的 Python？

在 2.5.1 中，我什至无法定义继承自`dict`和的类`Exception`：

```
>>> class foo(dict, Exception):
...   pass
... 
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
TypeError: Error when calling the metaclass bases
    multiple bases have instance lay-out conflict 
```

如果您使用的是旧版本，则它可能不会在类型定义期间进行此检查，并且冲突会导致稍后出现异常。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-21T16:00:08.230

## 没有理由，只有解决方案

目前我仍然不知道为什么，但我使用`UserDict.UserDict`. 由于它是纯 Python，因此速度较慢，但​​我认为在应用程序的这一部分上它不会很麻烦。

无论如何仍然对答案感兴趣;-)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-29T08:22:38.793

我几乎可以肯定，2.4 的问题是由旧样式类的异常引起的。

```
$ python2.4
Python 2.4.4 (#1, Feb 19 2009, 09:13:34)
>>> type(dict)
<type 'type'>
>>> type(Exception)
<type 'classobj'>
>>> type(Exception())
<type 'instance'>

$ python2.5
Python 2.5.4 (r254:67916, Feb 17 2009, 23:11:16)
>>> type(Exception)
<type 'type'>
>>> type(Exception())
<type 'exceptions.Exception'> 
```

在这两个版本中，如消息所述，异常可以是类、实例（旧式类）或字符串（已弃用）。

从 2.5 版开始，异常层次结构最终基于新样式类。现在也允许从 BaseException 继承的新样式类的实例。但是在 2.4 中，从 Exception（旧样式类）和 dict（新样式类）的多重继承导致新样式类不允许作为异常（无论如何混合旧样式类和新样式类可能很糟糕）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2015-12-17T12:30:02.037

用于`collections.UserDict`避免元类冲突：

```
class ConstraintFailureSet(coll.UserDict, Exception):
        """
            Container for constraint failures. It act as a constraint failure itself
            but can contain other constraint failures that can be accessed with a dict syntax.
        """

        def __init__(self, **failures) :
            coll.UserDict.__init__(self, failures)
            Exception.__init__(self)

print( isinstance(ConstraintFailureSet(), Exception)) #True
raise ConstraintFailureSet() 
```

# python - Komodo Edit 和 Notepad++ ::: Pros & Cons ::: Python dev

> ID：309135
> 
> 赞同：16
> 
> 时间：2008-11-21T15:38:10.707
> 
> 标签：python, editor, notepad++, komodo, komodoedit

我正在使用 Notepad++ 进行 python 开发，几天前我发现了免费的 Komodo Edit。

我需要这两个编辑器之间的 Python 开发优缺点...

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-11-21T21:54:28.967

我已经为 Google App Engine 进行了一些 Python 编程工作，我从 Notepad++ 开始，然后最近使用两个优秀的启动教程转移到 Komodo - 这两个教程都可以方便地从[这篇博客文章](http://blogs.activestate.com/2008/04/komodo-does-it "Komodo 无所不能：Google App Engine")链接（直接：[here](http://abaditya.com/2008/04/19/a-pseudo-ide-for-google-app-engine-komodo-edit/ "Google App Engine 的伪 IDE")和[here](http://www.toddnemet.com/using-komodo-edit-as-an-ide-for-google-app-engine/ "使用 Komodo Edit 作为 Google App Engine 的 IDE")）。

*   Komodo 支持将您的工作基本组织到项目中，而 Notepad++ 不支持（除了物理文件夹组织）。
*   自定义命令工具栏可用于跟踪大量常用命令，甚至链接到 URL（如在线文档等）。
*   它有一个有效的（如果有时是笨拙的）代码完成机制。

简而言之，它是一个提供所有优点的 IDE。

Notepad++ 更简单，加载速度更快，并且支持一些基本的可配置运行命令；如果您喜欢在命令行或 Python shell 中进行所有执行和调试，这是一个不错的选择。我的建议是两个都试试！

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-11-24T17:35:18.130

我刚刚下载并开始使用 Komodo Edit。我一直在使用记事本++。以下是我对一些功能的看法：

科莫多编辑优点：

*   你可以跳转到一个函数定义，即使它在另一个文件中（我喜欢这个）
*   有一个插件可以在侧面显示当前文件的类、函数等列表。Notepad++ 曾经有一个这样的插件，但它不再适用于当前版本，并且有一段时间没有更新。

记事本++优点：

*   如果您选择一个单词，它将突出显示当前文档中的所有这些单词（更容易找到拼写错误），而无需点击`Ctrl`+ `F`。
*   使用 HTML 时，当光标在标签上/标签中时，开始和结束标签都会突出显示

任何人都知道在 Komodo Edit 中最后两件事是否可行？

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-11-24T18:00:25.880

我使用科莫多编辑。主要原因是：Intellisense（不如 VisualStudio，但 Python 是一种很难进行智能感知的语言）和跨平台兼容性。能够在我的 Windows 机器、我的 linux 机器和我的 macbook 上使用相同的编辑器而感觉几乎没有变化，这真是太好了。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-02-01T23:32:06.143

我同时使用 Komodo Edit 和 Notepad++。

Notepad++ 启动速度更快，而且更轻巧，所以我经常使用它进行快速一次性编辑。

我将 Komodo Edit 用于主要项目，例如我的 django 和 wxPython 应用程序。KE 是一个全功能的 IDE，所以它有更多的功能。

Komodo Edit 用于 Python 编程的主要优点：

*   将文件组作为项目管理
*   使用自定义命令运行文件、运行nosetests/pylint 等。
*   自动完成和语法检查
*   Mozilla 扩展系统，有几个有用的扩展可用
*   用 JavaScript 或 Python 编写宏
*   拼写检查

Notepad++ 在 Python 开发中缺少的一些小东西：

*   冒号后不自动缩进
*   ~~您不能在文件类型的基础上设置制表符/空格（我喜欢为 HTML 使用制表符）~~
*   ~~没有代码完成或工具提示~~
*   没有即时语法检查

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-11-21T15:39:48.893

据我所知，Notepad++ 不会向您显示每个方法的文档字符串。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-11-24T17:38:38.653

我发现 Notepad++ for Python 的一个缺点是它倾向于（对我来说）默默地混合制表符和空格。我知道这是可配置的，但它让我很吃惊，尤其是在尝试与使用不同编辑器/IDE 的其他人一起工作时，所以要小心。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-22T15:31:00.830

我还没有使用过 Komodo（由于我当时的连接速度很慢，下载还没有完全完成），但我经常将 Eclipse 与 PyDev 一起使用，并享受其他受访者描述的“IDE”功能。但是，我也经常对它消耗多少资源感到沮丧。

我最近下载了 Notepad++（下载大小要小得多；-)）并且一直很喜欢它。编辑器本身又好又快，而且看起来是可扩展的。我希望将一些我最喜欢的功能从 IDE 复制到 Notepad++ 中，并在未来某个遥远的地方进行迁移。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-01T11:19:57.917

如果我必须在 Notepad++ 和 Komodo 之间进行选择，我会选择 PyScripter ;.) 说真的，我认为 PyScripter 是一个很好的选择......

* * *

## 回答 #9

> 赞同：-4
> 
> 时间：2008-11-21T21:27:20.083

自己都下载了。更喜欢科莫多。

Komodo 优点：更喜欢它。做得更多。看起来像一个IDE。编辑 Django 模板

Notepad++ 缺点：不太喜欢它。做的少。看起来不像和IDE。

# c# - 在图形中生成明显不同的 RGB 颜色

> ID：309149
> 
> 赞同：91
> 
> 时间：2008-11-21T15:43:06.407
> 
> 标签：c#, random, graph, colors

在生成图表并显示不同的数据集时，通常最好按颜色区分数据集。所以一条线是红色的，下一条是绿色的，依此类推。问题在于，当数据集的数量未知时，需要随机生成这些颜色，并且它们通常最终彼此非常接近（例如绿色、浅绿色）。

关于如何解决这个问题以及如何产生明显不同的颜色的任何想法？

如果有任何示例（如果您觉得更容易，请随意讨论问题和解决方案，如果您发现这更容易）是基于 C# 和 RGB 的颜色，我会很棒。

* * *

## 回答 #1

> 赞同：135
> 
> 时间：2008-11-21T15:54:48.583

您有 0 到 255 R、G 和 B 三个颜色通道。

首先通过

```
0, 0, 255
0, 255, 0
255, 0, 0 
```

然后通过

```
0, 255, 255
255, 0, 255
255, 255, 0 
```

然后除以 2 => 128 并重新开始：

```
0, 0, 128
0, 128, 0
128, 0, 0
0, 128, 128
128, 0, 128
128, 128, 0 
```

除以 2 => 64

下次将 64 添加到 128 => 192

根据规律。

简单的编程并为您提供相当独特的颜色。

**编辑：请求代码示例**

另外 - 如果灰色是可接受的颜色，则添加如下附加图案：

```
255, 255, 255
128, 128, 128 
```

有许多方法可以处理在代码中生成这些。

# 简单的方法

如果您可以保证您永远不需要超过固定数量的颜色，只需按照此模式生成一组颜色并使用这些颜色：

```
 static string[] ColourValues = new string[] { 
        "FF0000", "00FF00", "0000FF", "FFFF00", "FF00FF", "00FFFF", "000000", 
        "800000", "008000", "000080", "808000", "800080", "008080", "808080", 
        "C00000", "00C000", "0000C0", "C0C000", "C000C0", "00C0C0", "C0C0C0", 
        "400000", "004000", "000040", "404000", "400040", "004040", "404040", 
        "200000", "002000", "000020", "202000", "200020", "002020", "202020", 
        "600000", "006000", "000060", "606000", "600060", "006060", "606060", 
        "A00000", "00A000", "0000A0", "A0A000", "A000A0", "00A0A0", "A0A0A0", 
        "E00000", "00E000", "0000E0", "E0E000", "E000E0", "00E0E0", "E0E0E0", 
    }; 
```

# 艰难的道路

如果您不知道需要多少种颜色，下面的代码将使用此模式生成多达 896 种颜色。(896 = 256 * 7 / 2) 256 是每个通道的颜色空间，我们有 7 种模式，在我们得到仅由 1 个颜色值分隔的颜色之前停止。

我可能比我需要的更努力地处理这段代码。首先，有一个从 255 开始的强度生成器，然后根据上述模式生成值。模式生成器只是循环通过七种颜色模式。

```
using System;

class Program {
    static void Main(string[] args) {
        ColourGenerator generator = new ColourGenerator();
        for (int i = 0; i < 896; i++) {
            Console.WriteLine(string.Format("{0}: {1}", i, generator.NextColour()));
        }
    }
}

public class ColourGenerator {

    private int index = 0;
    private IntensityGenerator intensityGenerator = new IntensityGenerator();

    public string NextColour() {
        string colour = string.Format(PatternGenerator.NextPattern(index),
            intensityGenerator.NextIntensity(index));
        index++;
        return colour;
    }
}

public class PatternGenerator {
    public static string NextPattern(int index) {
        switch (index % 7) {
        case 0: return "{0}0000";
        case 1: return "00{0}00";
        case 2: return "0000{0}";
        case 3: return "{0}{0}00";
        case 4: return "{0}00{0}";
        case 5: return "00{0}{0}";
        case 6: return "{0}{0}{0}";
        default: throw new Exception("Math error");
        }
    }
}

public class IntensityGenerator {
    private IntensityValueWalker walker;
    private int current;

    public string NextIntensity(int index) {
        if (index == 0) {
            current = 255;
        }
        else if (index % 7 == 0) {
            if (walker == null) {
                walker = new IntensityValueWalker();
            }
            else {
                walker.MoveNext();
            }
            current = walker.Current.Value;
        }
        string currentText = current.ToString("X");
        if (currentText.Length == 1) currentText = "0" + currentText;
        return currentText;
    }
}

public class IntensityValue {

    private IntensityValue mChildA;
    private IntensityValue mChildB;

    public IntensityValue(IntensityValue parent, int value, int level) {
        if (level > 7) throw new Exception("There are no more colours left");
        Value = value;
        Parent = parent;
        Level = level;
    }

    public int Level { get; set; }
    public int Value { get; set; }
    public IntensityValue Parent { get; set; }

    public IntensityValue ChildA {
        get {
            return mChildA ?? (mChildA = new IntensityValue(this, this.Value - (1<<(7-Level)), Level+1));
        }
    }

    public IntensityValue ChildB {
        get {
            return mChildB ?? (mChildB = new IntensityValue(this, Value + (1<<(7-Level)), Level+1));
        }
    }
}

public class IntensityValueWalker {

    public IntensityValueWalker() {
        Current = new IntensityValue(null, 1<<7, 1);
    }

    public IntensityValue Current { get; set; }

    public void MoveNext() {
        if (Current.Parent == null) {
            Current = Current.ChildA;
        }
        else if (Current.Parent.ChildA == Current) {
            Current = Current.Parent.ChildB;
        }
        else {
            int levelsUp = 1;
            Current = Current.Parent;
            while (Current.Parent != null && Current == Current.Parent.ChildB) {
                Current = Current.Parent;
                levelsUp++;
            }
            if (Current.Parent != null) {
                Current = Current.Parent.ChildB;
            }
            else {
                levelsUp++;
            }
            for (int i = 0; i < levelsUp; i++) {
                Current = Current.ChildA;
            }

        }
    }
} 
```

* * *

## 回答 #2

> 赞同：93
> 
> 时间：2012-09-01T02:08:07.147

要实现一个变体列表，你的颜色去哪里，255 然后使用所有可能性，然后添加 0 和具有这两个值的所有 RGB 模式。然后添加 128 和所有 RGB 组合。然后是 64。然后是 192。等等。

在 Java 中，

```
public Color getColor(int i) {
    return new Color(getRGB(i));
}

public int getRGB(int index) {
    int[] p = getPattern(index);
    return getElement(p[0]) << 16 | getElement(p[1]) << 8 | getElement(p[2]);
}

public int getElement(int index) {
    int value = index - 1;
    int v = 0;
    for (int i = 0; i < 8; i++) {
        v = v | (value & 1);
        v <<= 1;
        value >>= 1;
    }
    v >>= 1;
    return v & 0xFF;
}

public int[] getPattern(int index) {
    int n = (int)Math.cbrt(index);
    index -= (n*n*n);
    int[] p = new int[3];
    Arrays.fill(p,n);
    if (index == 0) {
        return p;
    }
    index--;
    int v = index % 3;
    index = index / 3;
    if (index < n) {
        p[v] = index % n;
        return p;
    }
    index -= n;
    p[v      ] = index / n;
    p[++v % 3] = index % n;
    return p;
} 
```

这将在未来无限地（2^24）产生这种类型的模式。但是，在大约一百个点之后，您可能不会看到蓝色位置为 0 或 32 的颜色之间有太大差异。

您最好将其标准化为不同的颜色空间。LAB 颜色空间，例如 L、A、B 值标准化和转换。因此，颜色的独特性是通过更类似于人眼的东西来推动的。

getElement() 反转 8 位数字的字节序，并从 -1 而不是 0 开始计数（用 255 屏蔽）。所以它变成 255,0,127,192,64,... 随着数字的增长，它移动的有效位越来越少，细分数字。

getPattern() 确定模式中最重要的元素应该是什么（它是立方根）。然后继续分解涉及最重要元素的 3N²+3N+1 个不同模式。

该算法将产生（前 128 个值）：

```
#FFFFFF 
#000000 
#FF0000 
#00FF00 
#0000FF 
#FFFF00 
#00FFFF 
#FF00FF 
#808080 
#FF8080 
#80FF80 
#8080FF 
#008080 
#800080 
#808000 
#FFFF80 
#80FFFF 
#FF80FF 
#FF0080 
#80FF00 
#0080FF 
#00FF80 
#8000FF 
#FF8000 
#000080 
#800000 
#008000 
#404040 
#FF4040 
#40FF40 
#4040FF 
#004040 
#400040 
#404000 
#804040 
#408040 
#404080 
#FFFF40 
#40FFFF 
#FF40FF 
#FF0040 
#40FF00 
#0040FF 
#FF8040 
#40FF80 
#8040FF 
#00FF40 
#4000FF 
#FF4000 
#000040 
#400000 
#004000 
#008040 
#400080 
#804000 
#80FF40 
#4080FF 
#FF4080 
#800040 
#408000 
#004080 
#808040 
#408080 
#804080 
#C0C0C0 
#FFC0C0 
#C0FFC0 
#C0C0FF 
#00C0C0 
#C000C0 
#C0C000 
#80C0C0 
#C080C0 
#C0C080 
#40C0C0 
#C040C0 
#C0C040 
#FFFFC0 
#C0FFFF 
#FFC0FF 
#FF00C0 
#C0FF00 
#00C0FF 
#FF80C0 
#C0FF80 
#80C0FF 
#FF40C0 
#C0FF40 
#40C0FF 
#00FFC0 
#C000FF 
#FFC000 
#0000C0 
#C00000 
#00C000 
#0080C0 
#C00080 
#80C000 
#0040C0 
#C00040 
#40C000 
#80FFC0 
#C080FF 
#FFC080 
#8000C0 
#C08000 
#00C080 
#8080C0 
#C08080 
#80C080 
#8040C0 
#C08040 
#40C080 
#40FFC0 
#C040FF 
#FFC040 
#4000C0 
#C04000 
#00C040 
#4080C0 
#C04080 
#80C040 
#4040C0 
#C04040 
#40C040 
#202020 
#FF2020 
#20FF20 
```

从左到右，从上到下阅读。729 种颜色 (9³)。所以直到 n = 9 的所有模式。你会注意到它们开始发生冲突的速度。只有这么多 WRGBCYMK 变体。而这个解决方案，虽然聪明，但基本上只做不同深浅的原色。

![彩色网格，729 16x16](https://i.stack.imgur.com/d799s.png)

大部分冲突是由于果岭以及大多数果岭与大多数人的相似程度。要求每个人在开始时都有最大的不同，而不是仅仅不同到不同的颜色。这个想法的基本缺陷导致了原色图案和相同的色调。

* * *

使用 CIELab2000 颜色空间和距离例程随机选择并尝试 10k 种不同的颜色，并找到与先前颜色的最大距离最小距离，（几乎是请求的定义）避免了比上述解决方案更长的冲突：

![最大颜色距离](https://i.stack.imgur.com/WWANF.png)

这可以称为 Easy Way 的静态列表。花了一个半小时生成了 729 个条目：

```
#9BC4E5
#310106
#04640D
#FEFB0A
#FB5514
#E115C0
#00587F
#0BC582
#FEB8C8
#9E8317
#01190F
#847D81
#58018B
#B70639
#703B01
#F7F1DF
#118B8A
#4AFEFA
#FCB164
#796EE6
#000D2C
#53495F
#F95475
#61FC03
#5D9608
#DE98FD
#98A088
#4F584E
#248AD0
#5C5300
#9F6551
#BCFEC6
#932C70
#2B1B04
#B5AFC4
#D4C67A
#AE7AA1
#C2A393
#0232FD
#6A3A35
#BA6801
#168E5C
#16C0D0
#C62100
#014347
#233809
#42083B
#82785D
#023087
#B7DAD2
#196956
#8C41BB
#ECEDFE
#2B2D32
#94C661
#F8907D
#895E6B
#788E95
#FB6AB8
#576094
#DB1474
#8489AE
#860E04
#FBC206
#6EAB9B
#F2CDFE
#645341
#760035
#647A41
#496E76
#E3F894
#F9D7CD
#876128
#A1A711
#01FB92
#FD0F31
#BE8485
#C660FB
#120104
#D48958
#05AEE8
#C3C1BE
#9F98F8
#1167D9
#D19012
#B7D802
#826392
#5E7A6A
#B29869
#1D0051
#8BE7FC
#76E0C1
#BACFA7
#11BA09
#462C36
#65407D
#491803
#F5D2A8
#03422C
#72A46E
#128EAC
#47545E
#B95C69
#A14D12
#C4C8FA
#372A55
#3F3610
#D3A2C6
#719FFA
#0D841A
#4C5B32
#9DB3B7
#B14F8F
#747103
#9F816D
#D26A5B
#8B934B
#F98500
#002935
#D7F3FE
#FCB899
#1C0720
#6B5F61
#F98A9D
#9B72C2
#A6919D
#2C3729
#D7C70B
#9F9992
#EFFBD0
#FDE2F1
#923A52
#5140A7
#BC14FD
#6D706C
#0007C4
#C6A62F
#000C14
#904431
#600013
#1C1B08
#693955
#5E7C99
#6C6E82
#D0AFB3
#493B36
#AC93CE
#C4BA9C
#09C4B8
#69A5B8
#374869
#F868ED
#E70850
#C04841
#C36333
#700366
#8A7A93
#52351D
#B503A2
#D17190
#A0F086
#7B41FC
#0EA64F
#017499
#08A882
#7300CD
#A9B074
#4E6301
#AB7E41
#547FF4
#134DAC
#FDEC87
#056164
#FE12A0
#C264BA
#939DAD
#0BCDFA
#277442
#1BDE4A
#826958
#977678
#BAFCE8
#7D8475
#8CCF95
#726638
#FEA8EB
#EAFEF0
#6B9279
#C2FE4B
#304041
#1EA6A7
#022403
#062A47
#054B17
#F4C673
#02FEC7
#9DBAA8
#775551
#835536
#565BCC
#80D7D2
#7AD607
#696F54
#87089A
#664B19
#242235
#7DB00D
#BFC7D6
#D5A97E
#433F31
#311A18
#FDB2AB
#D586C9
#7A5FB1
#32544A
#EFE3AF
#859D96
#2B8570
#8B282D
#E16A07
#4B0125
#021083
#114558
#F707F9
#C78571
#7FB9BC
#FC7F4B
#8D4A92
#6B3119
#884F74
#994E4F
#9DA9D3
#867B40
#CED5C4
#1CA2FE
#D9C5B4
#FEAA00
#507B01
#A7D0DB
#53858D
#588F4A
#FBEEEC
#FC93C1
#D7CCD4
#3E4A02
#C8B1E2
#7A8B62
#9A5AE2
#896C04
#B1121C
#402D7D
#858701
#D498A6
#B484EF
#5C474C
#067881
#C0F9FC
#726075
#8D3101
#6C93B2
#A26B3F
#AA6582
#4F4C4F
#5A563D
#E83005
#32492D
#FC7272
#B9C457
#552A5B
#B50464
#616E79
#DCE2E4
#CF8028
#0AE2F0
#4F1E24
#FD5E46
#4B694E
#C5DEFC
#5DC262
#022D26
#7776B8
#FD9F66
#B049B8
#988F73
#BE385A
#2B2126
#54805A
#141B55
#67C09B
#456989
#DDC1D9
#166175
#C1E29C
#A397B5
#2E2922
#ABDBBE
#B4A6A8
#A06B07
#A99949
#0A0618
#B14E2E
#60557D
#D4A556
#82A752
#4A005B
#3C404F
#6E6657
#7E8BD5
#1275B8
#D79E92
#230735
#661849
#7A8391
#FE0F7B
#B0B6A9
#629591
#D05591
#97B68A
#97939A
#035E38
#53E19E
#DFD7F9
#02436C
#525A72
#059A0E
#3E736C
#AC8E87
#D10C92
#B9906E
#66BDFD
#C0ABFD
#0734BC
#341224
#8AAAC1
#0E0B03
#414522
#6A2F3E
#2D9A8A
#4568FD
#FDE6D2
#FEE007
#9A003C
#AC8190
#DCDD58
#B7903D
#1F2927
#9B02E6
#827A71
#878B8A
#8F724F
#AC4B70
#37233B
#385559
#F347C7
#9DB4FE
#D57179
#DE505A
#37F7DD
#503500
#1C2401
#DD0323
#00A4BA
#955602
#FA5B94
#AA766C
#B8E067
#6A807E
#4D2E27
#73BED7
#D7BC8A
#614539
#526861
#716D96
#829A17
#210109
#436C2D
#784955
#987BAB
#8F0152
#0452FA
#B67757
#A1659F
#D4F8D8
#48416F
#DEBAAF
#A5A9AA
#8C6B83
#403740
#70872B
#D9744D
#151E2C
#5C5E5E
#B47C02
#F4CBD0
#E49D7D
#DD9954
#B0A18B
#2B5308
#EDFD64
#9D72FC
#2A3351
#68496C
#C94801
#EED05E
#826F6D
#E0D6BB
#5B6DB4
#662F98
#0C97CA
#C1CA89
#755A03
#DFA619
#CD70A8
#BBC9C7
#F6BCE3
#A16462
#01D0AA
#87C6B3
#E7B2FA
#D85379
#643AD5
#D18AAE
#13FD5E
#B3E3FD
#C977DB
#C1A7BB
#9286CB
#A19B6A
#8FFED7
#6B1F17
#DF503A
#10DDD7
#9A8457
#60672F
#7D327D
#DD8782
#59AC42
#82FDB8
#FC8AE7
#909F6F
#B691AE
#B811CD
#BCB24E
#CB4BD9
#2B2304
#AA9501
#5D5096
#403221
#F9FAB4
#3990FC
#70DE7F
#95857F
#84A385
#50996F
#797B53
#7B6142
#81D5FE
#9CC428
#0B0438
#3E2005
#4B7C91
#523854
#005EA9
#F0C7AD
#ACB799
#FAC08E
#502239
#BFAB6A
#2B3C48
#0EB5D8
#8A5647
#49AF74
#067AE9
#F19509
#554628
#4426A4
#7352C9
#3F4287
#8B655E
#B480BF
#9BA74C
#5F514C
#CC9BDC
#BA7942
#1C4138
#3C3C3A
#29B09C
#02923F
#701D2B
#36577C
#3F00EA
#3D959E
#440601
#8AEFF3
#6D442A
#BEB1A8
#A11C02
#8383FE
#A73839
#DBDE8A
#0283B3
#888597
#32592E
#F5FDFA
#01191B
#AC707A
#B6BD03
#027B59
#7B4F08
#957737
#83727D
#035543
#6F7E64
#C39999
#52847A
#925AAC
#77CEDA
#516369
#E0D7D0
#FCDD97
#555424
#96E6B6
#85BB74
#5E2074
#BD5E48
#9BEE53
#1A351E
#3148CD
#71575F
#69A6D0
#391A62
#E79EA0
#1C0F03
#1B1636
#D20C39
#765396
#7402FE
#447F3E
#CFD0A8
#3A2600
#685AFC
#A4B3C6
#534302
#9AA097
#FD5154
#9B0085
#403956
#80A1A7
#6E7A9A
#605E6A
#86F0E2
#5A2B01
#7E3D43
#ED823B
#32331B
#424837
#40755E
#524F48
#B75807
#B40080
#5B8CA1
#FDCFE5
#CCFEAC
#755847
#CAB296
#C0D6E3
#2D7100
#D5E4DE
#362823
#69C63C
#AC3801
#163132
#4750A6
#61B8B2
#FCC4B5
#DEBA2E
#FE0449
#737930
#8470AB
#687D87
#D7B760
#6AAB86
#8398B8
#B7B6BF
#92C4A1
#B6084F
#853B5E
#D0BCBA
#92826D
#C6DDC6
#BE5F5A
#280021
#435743
#874514
#63675A
#E97963
#8F9C9E
#985262
#909081
#023508
#DDADBF
#D78493
#363900
#5B0120
#603C47
#C3955D
#AC61CB
#FD7BA7
#716C74
#8D895B
#071001
#82B4F2
#B6BBD8
#71887A
#8B9FE3
#997158
#65A6AB
#2E3067
#321301
#FEECCB
#3B5E72
#C8FE85
#A1DCDF
#CB49A6
#B1C5E4
#3E5EB0
#88AEA7
#04504C
#975232
#6786B9
#068797
#9A98C4
#A1C3C2
#1C3967
#DBEA07
#789658
#E7E7C6
#A6C886
#957F89
#752E62
#171518
#A75648
#01D26F
#0F535D
#047E76
#C54754
#5D6E88
#AB9483
#803B99
#FA9C48
#4A8A22
#654A5C
#965F86
#9D0CBB
#A0E8A0
#D3DBFA
#FD908F
#AEAB85
#A13B89
#F1B350
#066898
#948A42
#C8BEDE
#19252C
#7046AA
#E1EEFC
#3E6557
#CD3F26
#2B1925
#DDAD94
#C0B109
#37DFFE
#039676
#907468
#9E86A5
#3A1B49
#BEE5B7
#C29501
#9E3645
#DC580A
#645631
#444B4B
#FD1A63
#DDE5AE
#887800
#36006F
#3A6260
#784637
#FEA0B7
#A3E0D2
#6D6316
#5F7172
#B99EC7
#777A7E
#E0FEFD
#E16DC5
#01344B
#F8F8FC
#9F9FB5
#182617
#FE3D21
#7D0017
#822F21
#EFD9DC
#6E68C4
#35473E
#007523
#767667
#A6825D
#83DC5F
#227285
#A95E34
#526172
#979730
#756F6D
#716259
#E8B2B5
#B6C9BB
#9078DA
#4F326E
#B2387B
#888C6F
#314B5F
#E5B678
#38A3C6
#586148
#5C515B
#CDCCE1
#C8977F 
```

使用蛮力（通过 CIELab Delta2000 测试所有 16,777,216 种 RGB 颜色/从黑色开始）产生一个系列。在 26 左右开始发生冲突，但可以通过目视检查和手动下降（计算机无法完成）使其达到 30 或 40。因此，以编程方式进行绝对最大值只能生成几十种不同的颜色。离散列表是您最好的选择。与以编程方式相比，您将通过列表获得更多离散的颜色。简单的方法是最好的解决方案，开始混合和匹配其他方法来改变你的数据而不是颜色。

![最大差异](https://i.stack.imgur.com/2PTeH.png)

```
#000000
#00FF00
#0000FF
#FF0000
#01FFFE
#FFA6FE
#FFDB66
#006401
#010067
#95003A
#007DB5
#FF00F6
#FFEEE8
#774D00
#90FB92
#0076FF
#D5FF00
#FF937E
#6A826C
#FF029D
#FE8900
#7A4782
#7E2DD2
#85A900
#FF0056
#A42400
#00AE7E
#683D3B
#BDC6FF
#263400
#BDD393
#00B917
#9E008E
#001544
#C28C9F
#FF74A3
#01D0FF
#004754
#E56FFE
#788231
#0E4CA1
#91D0CB
#BE9970
#968AE8
#BB8800
#43002C
#DEFF74
#00FFC6
#FFE502
#620E00
#008F9C
#98FF52
#7544B1
#B500FF
#00FF78
#FF6E41
#005F39
#6B6882
#5FAD4E
#A75740
#A5FFD2
#FFB167
#009BFF
#E85EBE 
```

更新：我以 1024 蛮力持续了大约一个月。 [![1024](https://i.stack.imgur.com/cuF3C.png)](https://i.stack.imgur.com/cuF3C.png)

```
public static final String[] indexcolors = new String[]{
        "#000000", "#FFFF00", "#1CE6FF", "#FF34FF", "#FF4A46", "#008941", "#006FA6", "#A30059",
        "#FFDBE5", "#7A4900", "#0000A6", "#63FFAC", "#B79762", "#004D43", "#8FB0FF", "#997D87",
        "#5A0007", "#809693", "#FEFFE6", "#1B4400", "#4FC601", "#3B5DFF", "#4A3B53", "#FF2F80",
        "#61615A", "#BA0900", "#6B7900", "#00C2A0", "#FFAA92", "#FF90C9", "#B903AA", "#D16100",
        "#DDEFFF", "#000035", "#7B4F4B", "#A1C299", "#300018", "#0AA6D8", "#013349", "#00846F",
        "#372101", "#FFB500", "#C2FFED", "#A079BF", "#CC0744", "#C0B9B2", "#C2FF99", "#001E09",
        "#00489C", "#6F0062", "#0CBD66", "#EEC3FF", "#456D75", "#B77B68", "#7A87A1", "#788D66",
        "#885578", "#FAD09F", "#FF8A9A", "#D157A0", "#BEC459", "#456648", "#0086ED", "#886F4C",
        "#34362D", "#B4A8BD", "#00A6AA", "#452C2C", "#636375", "#A3C8C9", "#FF913F", "#938A81",
        "#575329", "#00FECF", "#B05B6F", "#8CD0FF", "#3B9700", "#04F757", "#C8A1A1", "#1E6E00",
        "#7900D7", "#A77500", "#6367A9", "#A05837", "#6B002C", "#772600", "#D790FF", "#9B9700",
        "#549E79", "#FFF69F", "#201625", "#72418F", "#BC23FF", "#99ADC0", "#3A2465", "#922329",
        "#5B4534", "#FDE8DC", "#404E55", "#0089A3", "#CB7E98", "#A4E804", "#324E72", "#6A3A4C",
        "#83AB58", "#001C1E", "#D1F7CE", "#004B28", "#C8D0F6", "#A3A489", "#806C66", "#222800",
        "#BF5650", "#E83000", "#66796D", "#DA007C", "#FF1A59", "#8ADBB4", "#1E0200", "#5B4E51",
        "#C895C5", "#320033", "#FF6832", "#66E1D3", "#CFCDAC", "#D0AC94", "#7ED379", "#012C58",
        "#7A7BFF", "#D68E01", "#353339", "#78AFA1", "#FEB2C6", "#75797C", "#837393", "#943A4D",
        "#B5F4FF", "#D2DCD5", "#9556BD", "#6A714A", "#001325", "#02525F", "#0AA3F7", "#E98176",
        "#DBD5DD", "#5EBCD1", "#3D4F44", "#7E6405", "#02684E", "#962B75", "#8D8546", "#9695C5",
        "#E773CE", "#D86A78", "#3E89BE", "#CA834E", "#518A87", "#5B113C", "#55813B", "#E704C4",
        "#00005F", "#A97399", "#4B8160", "#59738A", "#FF5DA7", "#F7C9BF", "#643127", "#513A01",
        "#6B94AA", "#51A058", "#A45B02", "#1D1702", "#E20027", "#E7AB63", "#4C6001", "#9C6966",
        "#64547B", "#97979E", "#006A66", "#391406", "#F4D749", "#0045D2", "#006C31", "#DDB6D0",
        "#7C6571", "#9FB2A4", "#00D891", "#15A08A", "#BC65E9", "#FFFFFE", "#C6DC99", "#203B3C",
        "#671190", "#6B3A64", "#F5E1FF", "#FFA0F2", "#CCAA35", "#374527", "#8BB400", "#797868",
        "#C6005A", "#3B000A", "#C86240", "#29607C", "#402334", "#7D5A44", "#CCB87C", "#B88183",
        "#AA5199", "#B5D6C3", "#A38469", "#9F94F0", "#A74571", "#B894A6", "#71BB8C", "#00B433",
        "#789EC9", "#6D80BA", "#953F00", "#5EFF03", "#E4FFFC", "#1BE177", "#BCB1E5", "#76912F",
        "#003109", "#0060CD", "#D20096", "#895563", "#29201D", "#5B3213", "#A76F42", "#89412E",
        "#1A3A2A", "#494B5A", "#A88C85", "#F4ABAA", "#A3F3AB", "#00C6C8", "#EA8B66", "#958A9F",
        "#BDC9D2", "#9FA064", "#BE4700", "#658188", "#83A485", "#453C23", "#47675D", "#3A3F00",
        "#061203", "#DFFB71", "#868E7E", "#98D058", "#6C8F7D", "#D7BFC2", "#3C3E6E", "#D83D66",
        "#2F5D9B", "#6C5E46", "#D25B88", "#5B656C", "#00B57F", "#545C46", "#866097", "#365D25",
        "#252F99", "#00CCFF", "#674E60", "#FC009C", "#92896B", "#1E2324", "#DEC9B2", "#9D4948",
        "#85ABB4", "#342142", "#D09685", "#A4ACAC", "#00FFFF", "#AE9C86", "#742A33", "#0E72C5",
        "#AFD8EC", "#C064B9", "#91028C", "#FEEDBF", "#FFB789", "#9CB8E4", "#AFFFD1", "#2A364C",
        "#4F4A43", "#647095", "#34BBFF", "#807781", "#920003", "#B3A5A7", "#018615", "#F1FFC8",
        "#976F5C", "#FF3BC1", "#FF5F6B", "#077D84", "#F56D93", "#5771DA", "#4E1E2A", "#830055",
        "#02D346", "#BE452D", "#00905E", "#BE0028", "#6E96E3", "#007699", "#FEC96D", "#9C6A7D",
        "#3FA1B8", "#893DE3", "#79B4D6", "#7FD4D9", "#6751BB", "#B28D2D", "#E27A05", "#DD9CB8",
        "#AABC7A", "#980034", "#561A02", "#8F7F00", "#635000", "#CD7DAE", "#8A5E2D", "#FFB3E1",
        "#6B6466", "#C6D300", "#0100E2", "#88EC69", "#8FCCBE", "#21001C", "#511F4D", "#E3F6E3",
        "#FF8EB1", "#6B4F29", "#A37F46", "#6A5950", "#1F2A1A", "#04784D", "#101835", "#E6E0D0",
        "#FF74FE", "#00A45F", "#8F5DF8", "#4B0059", "#412F23", "#D8939E", "#DB9D72", "#604143",
        "#B5BACE", "#989EB7", "#D2C4DB", "#A587AF", "#77D796", "#7F8C94", "#FF9B03", "#555196",
        "#31DDAE", "#74B671", "#802647", "#2A373F", "#014A68", "#696628", "#4C7B6D", "#002C27",
        "#7A4522", "#3B5859", "#E5D381", "#FFF3FF", "#679FA0", "#261300", "#2C5742", "#9131AF",
        "#AF5D88", "#C7706A", "#61AB1F", "#8CF2D4", "#C5D9B8", "#9FFFFB", "#BF45CC", "#493941",
        "#863B60", "#B90076", "#003177", "#C582D2", "#C1B394", "#602B70", "#887868", "#BABFB0",
        "#030012", "#D1ACFE", "#7FDEFE", "#4B5C71", "#A3A097", "#E66D53", "#637B5D", "#92BEA5",
        "#00F8B3", "#BEDDFF", "#3DB5A7", "#DD3248", "#B6E4DE", "#427745", "#598C5A", "#B94C59",
        "#8181D5", "#94888B", "#FED6BD", "#536D31", "#6EFF92", "#E4E8FF", "#20E200", "#FFD0F2",
        "#4C83A1", "#BD7322", "#915C4E", "#8C4787", "#025117", "#A2AA45", "#2D1B21", "#A9DDB0",
        "#FF4F78", "#528500", "#009A2E", "#17FCE4", "#71555A", "#525D82", "#00195A", "#967874",
        "#555558", "#0B212C", "#1E202B", "#EFBFC4", "#6F9755", "#6F7586", "#501D1D", "#372D00",
        "#741D16", "#5EB393", "#B5B400", "#DD4A38", "#363DFF", "#AD6552", "#6635AF", "#836BBA",
        "#98AA7F", "#464836", "#322C3E", "#7CB9BA", "#5B6965", "#707D3D", "#7A001D", "#6E4636",
        "#443A38", "#AE81FF", "#489079", "#897334", "#009087", "#DA713C", "#361618", "#FF6F01",
        "#006679", "#370E77", "#4B3A83", "#C9E2E6", "#C44170", "#FF4526", "#73BE54", "#C4DF72",
        "#ADFF60", "#00447D", "#DCCEC9", "#BD9479", "#656E5B", "#EC5200", "#FF6EC2", "#7A617E",
        "#DDAEA2", "#77837F", "#A53327", "#608EFF", "#B599D7", "#A50149", "#4E0025", "#C9B1A9",
        "#03919A", "#1B2A25", "#E500F1", "#982E0B", "#B67180", "#E05859", "#006039", "#578F9B",
        "#305230", "#CE934C", "#B3C2BE", "#C0BAC0", "#B506D3", "#170C10", "#4C534F", "#224451",
        "#3E4141", "#78726D", "#B6602B", "#200441", "#DDB588", "#497200", "#C5AAB6", "#033C61",
        "#71B2F5", "#A9E088", "#4979B0", "#A2C3DF", "#784149", "#2D2B17", "#3E0E2F", "#57344C",
        "#0091BE", "#E451D1", "#4B4B6A", "#5C011A", "#7C8060", "#FF9491", "#4C325D", "#005C8B",
        "#E5FDA4", "#68D1B6", "#032641", "#140023", "#8683A9", "#CFFF00", "#A72C3E", "#34475A",
        "#B1BB9A", "#B4A04F", "#8D918E", "#A168A6", "#813D3A", "#425218", "#DA8386", "#776133",
        "#563930", "#8498AE", "#90C1D3", "#B5666B", "#9B585E", "#856465", "#AD7C90", "#E2BC00",
        "#E3AAE0", "#B2C2FE", "#FD0039", "#009B75", "#FFF46D", "#E87EAC", "#DFE3E6", "#848590",
        "#AA9297", "#83A193", "#577977", "#3E7158", "#C64289", "#EA0072", "#C4A8CB", "#55C899",
        "#E78FCF", "#004547", "#F6E2E3", "#966716", "#378FDB", "#435E6A", "#DA0004", "#1B000F",
        "#5B9C8F", "#6E2B52", "#011115", "#E3E8C4", "#AE3B85", "#EA1CA9", "#FF9E6B", "#457D8B",
        "#92678B", "#00CDBB", "#9CCC04", "#002E38", "#96C57F", "#CFF6B4", "#492818", "#766E52",
        "#20370E", "#E3D19F", "#2E3C30", "#B2EACE", "#F3BDA4", "#A24E3D", "#976FD9", "#8C9FA8",
        "#7C2B73", "#4E5F37", "#5D5462", "#90956F", "#6AA776", "#DBCBF6", "#DA71FF", "#987C95",
        "#52323C", "#BB3C42", "#584D39", "#4FC15F", "#A2B9C1", "#79DB21", "#1D5958", "#BD744E",
        "#160B00", "#20221A", "#6B8295", "#00E0E4", "#102401", "#1B782A", "#DAA9B5", "#B0415D",
        "#859253", "#97A094", "#06E3C4", "#47688C", "#7C6755", "#075C00", "#7560D5", "#7D9F00",
        "#C36D96", "#4D913E", "#5F4276", "#FCE4C8", "#303052", "#4F381B", "#E5A532", "#706690",
        "#AA9A92", "#237363", "#73013E", "#FF9079", "#A79A74", "#029BDB", "#FF0169", "#C7D2E7",
        "#CA8869", "#80FFCD", "#BB1F69", "#90B0AB", "#7D74A9", "#FCC7DB", "#99375B", "#00AB4D",
        "#ABAED1", "#BE9D91", "#E6E5A7", "#332C22", "#DD587B", "#F5FFF7", "#5D3033", "#6D3800",
        "#FF0020", "#B57BB3", "#D7FFE6", "#C535A9", "#260009", "#6A8781", "#A8ABB4", "#D45262",
        "#794B61", "#4621B2", "#8DA4DB", "#C7C890", "#6FE9AD", "#A243A7", "#B2B081", "#181B00",
        "#286154", "#4CA43B", "#6A9573", "#A8441D", "#5C727B", "#738671", "#D0CFCB", "#897B77",
        "#1F3F22", "#4145A7", "#DA9894", "#A1757A", "#63243C", "#ADAAFF", "#00CDE2", "#DDBC62",
        "#698EB1", "#208462", "#00B7E0", "#614A44", "#9BBB57", "#7A5C54", "#857A50", "#766B7E",
        "#014833", "#FF8347", "#7A8EBA", "#274740", "#946444", "#EBD8E6", "#646241", "#373917",
        "#6AD450", "#81817B", "#D499E3", "#979440", "#011A12", "#526554", "#B5885C", "#A499A5",
        "#03AD89", "#B3008B", "#E3C4B5", "#96531F", "#867175", "#74569E", "#617D9F", "#E70452",
        "#067EAF", "#A697B6", "#B787A8", "#9CFF93", "#311D19", "#3A9459", "#6E746E", "#B0C5AE",
        "#84EDF7", "#ED3488", "#754C78", "#384644", "#C7847B", "#00B6C5", "#7FA670", "#C1AF9E",
        "#2A7FFF", "#72A58C", "#FFC07F", "#9DEBDD", "#D97C8E", "#7E7C93", "#62E674", "#B5639E",
        "#FFA861", "#C2A580", "#8D9C83", "#B70546", "#372B2E", "#0098FF", "#985975", "#20204C",
        "#FF6C60", "#445083", "#8502AA", "#72361F", "#9676A3", "#484449", "#CED6C2", "#3B164A",
        "#CCA763", "#2C7F77", "#02227B", "#A37E6F", "#CDE6DC", "#CDFFFB", "#BE811A", "#F77183",
        "#EDE6E2", "#CDC6B4", "#FFE09E", "#3A7271", "#FF7B59", "#4E4E01", "#4AC684", "#8BC891",
        "#BC8A96", "#CF6353", "#DCDE5C", "#5EAADD", "#F6A0AD", "#E269AA", "#A3DAE4", "#436E83",
        "#002E17", "#ECFBFF", "#A1C2B6", "#50003F", "#71695B", "#67C4BB", "#536EFF", "#5D5A48",
        "#890039", "#969381", "#371521", "#5E4665", "#AA62C3", "#8D6F81", "#2C6135", "#410601",
        "#564620", "#E69034", "#6DA6BD", "#E58E56", "#E3A68B", "#48B176", "#D27D67", "#B5B268",
        "#7F8427", "#FF84E6", "#435740", "#EAE408", "#F4F5FF", "#325800", "#4B6BA5", "#ADCEFF",
        "#9B8ACC", "#885138", "#5875C1", "#7E7311", "#FEA5CA", "#9F8B5B", "#A55B54", "#89006A",
        "#AF756F", "#2A2000", "#576E4A", "#7F9EFF", "#7499A1", "#FFB550", "#00011E", "#D1511C",
        "#688151", "#BC908A", "#78C8EB", "#8502FF", "#483D30", "#C42221", "#5EA7FF", "#785715",
        "#0CEA91", "#FFFAED", "#B3AF9D", "#3E3D52", "#5A9BC2", "#9C2F90", "#8D5700", "#ADD79C",
        "#00768B", "#337D00", "#C59700", "#3156DC", "#944575", "#ECFFDC", "#D24CB2", "#97703C",
        "#4C257F", "#9E0366", "#88FFEC", "#B56481", "#396D2B", "#56735F", "#988376", "#9BB195",
        "#A9795C", "#E4C5D3", "#9F4F67", "#1E2B39", "#664327", "#AFCE78", "#322EDF", "#86B487",
        "#C23000", "#ABE86B", "#96656D", "#250E35", "#A60019", "#0080CF", "#CAEFFF", "#323F61",
        "#A449DC", "#6A9D3B", "#FF5AE4", "#636A01", "#D16CDA", "#736060", "#FFBAAD", "#D369B4",
        "#FFDED6", "#6C6D74", "#927D5E", "#845D70", "#5B62C1", "#2F4A36", "#E45F35", "#FF3B53",
        "#AC84DD", "#762988", "#70EC98", "#408543", "#2C3533", "#2E182D", "#323925", "#19181B",
        "#2F2E2C", "#023C32", "#9B9EE2", "#58AFAD", "#5C424D", "#7AC5A6", "#685D75", "#B9BCBD",
        "#834357", "#1A7B42", "#2E57AA", "#E55199", "#316E47", "#CD00C5", "#6A004D", "#7FBBEC",
        "#F35691", "#D7C54A", "#62ACB7", "#CBA1BC", "#A28A9A", "#6C3F3B", "#FFE47D", "#DCBAE3",
        "#5F816D", "#3A404A", "#7DBF32", "#E6ECDC", "#852C19", "#285366", "#B8CB9C", "#0E0D00",
        "#4B5D56", "#6B543F", "#E27172", "#0568EC", "#2EB500", "#D21656", "#EFAFFF", "#682021",
        "#2D2011", "#DA4CFF", "#70968E", "#FF7B7D", "#4A1930", "#E8C282", "#E7DBBC", "#A68486",
        "#1F263C", "#36574E", "#52CE79", "#ADAAA9", "#8A9F45", "#6542D2", "#00FB8C", "#5D697B",
        "#CCD27F", "#94A5A1", "#790229", "#E383E6", "#7EA4C1", "#4E4452", "#4B2C00", "#620B70",
        "#314C1E", "#874AA6", "#E30091", "#66460A", "#EB9A8B", "#EAC3A3", "#98EAB3", "#AB9180",
        "#B8552F", "#1A2B2F", "#94DDC5", "#9D8C76", "#9C8333", "#94A9C9", "#392935", "#8C675E",
        "#CCE93A", "#917100", "#01400B", "#449896", "#1CA370", "#E08DA7", "#8B4A4E", "#667776",
        "#4692AD", "#67BDA8", "#69255C", "#D3BFFF", "#4A5132", "#7E9285", "#77733C", "#E7A0CC",
        "#51A288", "#2C656A", "#4D5C5E", "#C9403A", "#DDD7F3", "#005844", "#B4A200", "#488F69",
        "#858182", "#D4E9B9", "#3D7397", "#CAE8CE", "#D60034", "#AA6746", "#9E5585", "#BA6200"
    }; 
```

* * *

## 回答 #3

> 赞同：28
> 
> 时间：2012-02-22T22:36:19.157

我已经在网上建立了一个页面，用于在程序上生成视觉上不同的颜色： http:
[//phrogz.net/css/distinct-colors.html](http://phrogz.net/css/distinct-colors.html)

与此处均匀跨过 RGB 或 HSV 空间的其他答案不同（其中[轴值和感知差异之间存在非线性关系](http://phrogz.net/tmp/colordifferences/)），我的页面使用标准[CMI(I:c)](http://en.wikipedia.org/wiki/Color_difference#CMC_l:c_.281984.29)颜色距离算法来防止两种颜色太视觉上接近。

页面的最后一个选项卡允许您以多种方式对值进行排序，然后将它们交错（有序随机播放），以便您获得非常不同的颜色并排放置。

*在撰写本文时，它仅在 Chrome 和 Safari 中运行良好，并为 Firefox 提供了 shim；它在界面中使用 HTML5 范围输入滑块，IE9 和 Firefox 尚不原生支持。*

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2008-11-21T16:03:30.517

我认为[HSV](http://en.wikipedia.org/wiki/HSL_color_space)（或 HSL）空间在这里有更多的机会。如果您不介意额外的转换，只需旋转色调值即可轻松浏览所有颜色。如果这还不够，您可以更改饱和度/值/亮度值并再次进行旋转。或者，您可以随时更改色调值或更改“步进”角度并旋转更多次。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2011-09-17T01:34:10.937

以前的 RGB 解决方案存在缺陷。它们没有利用整个颜色空间，因为它们使用颜色值和 0 作为通道：

```
#006600
#330000
#FF00FF 
```

相反，他们应该使用所有可能的颜色值来生成在颜色通道中最多可以有 3 个不同值的混合颜色：

```
#336600
#FF0066
#33FF66 
```

使用完整的色彩空间，您可以生成更多不同的颜色。例如，如果每个通道有 4 个值，则可以生成4*4*4= **64种颜色。**使用另一种方案，只能生成 4*7+1= **29**种颜色。

如果您想要 N 种颜色，则每个通道所需的值数为：**ceil(cube_root(N))**

这样，您就可以确定可能的（0-255 范围）值（python）：

```
max = 255
segs = int(num**(Decimal("1.0")/3))
step = int(max/segs)
p = [(i*step) for i in xrange(segs)]
values = [max]
values.extend(p) 
```

然后您可以遍历 RGB 颜色（不推荐这样做）：

```
total = 0
for red in values:
  for green in values:
    for blue in values:
      if total <= N:
        print color(red, green, blue)
      total += 1 
```

嵌套循环会起作用，但不推荐使用，因为它会偏向蓝色通道，并且生成的颜色不会有足够的红色（N 很可能小于所有可能颜色值的数量）。

您可以为循环创建更好的算法，其中每个通道都被平等对待，并且更多不同的颜色值比小的颜色值更受青睐。

我有一个解决方案，但不想发布它，因为它不是最容易理解或有效的。但是，如果您真的想要，您可以查看[解决方案。](http://www.8bitrobot.com/2011/09/16/n-distinct-colors/)

这是 64 种生成颜色的示例：[64 种颜色](http://www.8bitrobot.com/wp-content/uploads/2011/09/colors64.html)

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2016-06-28T22:56:09.903

我需要相同的功能，但形式很简单。

我需要的是从增加的索引值中生成尽可能独特的颜色。

这是 C# 中的代码（任何其他语言实现都应该非常相似）

机制非常简单

1.  从 0 到 7 的 indexA 值生成 color_writers 模式。

2.  对于索引 < 8，这些颜色为 = color_writer[indexA] * 255。

3.  对于 8 到 15 之间的索引，这些颜色为 = color_writer[indexA] * 255 + (color_writer[indexA+1]) * 127

4.  对于 16 到 23 之间的索引，这些颜色为 = color_writer[indexA] * 255 + (color_writer[indexA+1]) * 127 + (color_writer[indexA+2]) * 63

等等：

[![兰德颜色发生器](https://i.stack.imgur.com/uCTO8.jpg)](https://i.stack.imgur.com/uCTO8.jpg)

```
 private System.Drawing.Color GetRandColor(int index)
    {
        byte red = 0;
        byte green = 0;
        byte blue = 0;

        for (int t = 0; t <= index / 8; t++)
        {
            int index_a = (index+t) % 8;
            int index_b = index_a / 2;

            //Color writers, take on values of 0 and 1
            int color_red = index_a % 2;
            int color_blue = index_b % 2;
            int color_green = ((index_b + 1) % 3) % 2;

            int add = 255 / (t + 1);

            red = (byte)(red+color_red * add);
            green = (byte)(green + color_green * add);
            blue = (byte)(blue + color_blue * add);
        }

        Color color = Color.FromArgb(red, green, blue);
        return color;
    } 
```

注意：为避免生成明亮且难以看到的颜色（在本示例中：白色背景上的黄色），您可以使用递归循环对其进行修改：

```
 int skip_index = 0;
    private System.Drawing.Color GetRandColor(int index)
    {
        index += skip_index;
        byte red = 0;
        byte green = 0;
        byte blue = 0;

        for (int t = 0; t <= index / 8; t++)
        {
            int index_a = (index+t) % 8;
            int index_b = index_a / 2;

            //Color writers, take on values of 0 and 1
            int color_red = index_a % 2;
            int color_blue = index_b % 2;
            int color_green = ((index_b + 1) % 3) % 2;

            int add = 255 / (t + 1);

            red = (byte)(red + color_red * add);
            green = (byte)(green + color_green * add);
            blue = (byte)(blue + color_blue * add);
        }

        if(red > 200 && green > 200)
        {
            skip_index++;
            return GetRandColor(index);
        }

        Color color = Color.FromArgb(red, green, blue);
        return color;
    } 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-21T15:54:06.870

我会从 100% 的设定亮度开始，然后先绕过原色：

FF0000, 00FF00, 0000FF

然后组合

FFFF00、FF00FF、00FFFF

接下来例如将亮度减半并进行同一轮。没有太多真正明显不同的颜色，在这些之后我会开始改变线宽并做点/虚线等。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2010-10-07T11:58:51.710

我以更短的方式实现了这个算法

```
void ColorValue::SetColorValue( double r, double g, double b, ColorType myType )
{
   this->c[0] = r;
   this->c[1] = g;
   this->c[2] = b;

   this->type = myType;
}

DistinctColorGenerator::DistinctColorGenerator()
{
   mFactor = 255;
   mColorsGenerated = 0;
   mpColorCycle = new ColorValue[6];
   mpColorCycle[0].SetColorValue( 1.0, 0.0, 0.0, TYPE_RGB);
   mpColorCycle[1].SetColorValue( 0.0, 1.0, 0.0, TYPE_RGB);
   mpColorCycle[2].SetColorValue( 0.0, 0.0, 1.0, TYPE_RGB);
   mpColorCycle[3].SetColorValue( 1.0, 1.0, 0.0, TYPE_RGB);
   mpColorCycle[4].SetColorValue( 1.0, 0.0, 1.0, TYPE_RGB);
   mpColorCycle[5].SetColorValue( 0.0, 1.0, 1.0, TYPE_RGB);
}

//----------------------------------------------------------

ColorValue DistinctColorGenerator::GenerateNewColor()
{
   int innerCycleNr = mColorsGenerated % 6;
   int outerCycleNr = mColorsGenerated / 6;
   int cycleSize = pow( 2, (int)(log((double)(outerCycleNr)) / log( 2.0 ) ) );
   int insideCycleCounter = outerCycleNr % cyclesize;

   if ( outerCycleNr == 0)
   {
      mFactor = 255;
   }
   else
   {
      mFactor = ( 256 / ( 2 * cycleSize ) ) + ( insideCycleCounter * ( 256 / cycleSize ) );
   }

   ColorValue newColor = mpColorCycle[innerCycleNr] * mFactor;

   mColorsGenerated++;
   return newColor;
} 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2019-07-02T08:34:48.173

如果有人需要在 C# 中为白色前景生成随机的中到高深色，这里是代码。

```
[DllImport("shlwapi.dll")]
public static extern int ColorHLSToRGB(int H, int L, int S);

public static string GetRandomDarkColor()
{
    int h = 0, s = 0, l = 0;
    h = (RandomObject.Next(1, 2) % 2 == 0) ? RandomObject.Next(0, 180) : iApp.RandomObject.Next(181, 360);
    s = RandomObject.Next(90, 160);
    l = RandomObject.Next(80, 130);

    return System.Drawing.ColorTranslator.FromWin32(ColorHLSToRGB(h, l, s)).ToHex();
}

private static string ToHex(this System.Drawing.Color c)
{
    return "#" + c.R.ToString("X2") + c.G.ToString("X2") + c.B.ToString("X2");
} 
```

您可以`RandomObject`用自己的`Random`类对象替换。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2010-12-02T23:17:14.120

您还可以将色彩空间视为 0 到 255 的三个数字的所有组合，包括 0 到 255。这是 0 到 255^3 之间数字的 base-255 表示，强制保留三位小数（如果需要，在末尾添加零。）

因此，要生成 x 种颜色，您需要计算 x 均匀分布的百分比，从 0 到 100。通过将这些百分比乘以 255^3 来获取数字，将这些数字转换为以 255 为底，然后如前所述添加零。

基本转换算法，供参考（在非常接近 C# 的伪代码中）：

```
int num = (number to convert);
int baseConvert = (desired base, 255 in this case);
(array of ints) nums = new (array of ints);
int x = num;
double digits = Math.Log(num, baseConvert); //or ln(num) / ln(baseConvert)
int numDigits = (digits - Math.Ceiling(digits) == 0 ? (int)(digits + 1) : (int)Math.Ceiling(digits)); //go up one if it turns out even
for (int i = 0; i < numDigits; i++)
{
  int toAdd = ((int)Math.Floor(x / Math.Pow((double)convertBase, (double)(numDigits - i - 1))));
  //Formula for 0th digit: d = num / (convertBase^(numDigits - 1))
  //Then subtract (d * convertBase^(numDigits - 1)) from the num and continue
  nums.Add(toAdd);
  x -= toAdd * (int)Math.Pow((double)convertBase, (double)(numDigits - i - 1));
}
return nums; 
```

如果需要，您可能还需要做一些事情来稍微增加范围，以避免出现白色和黑色。这些数字实际上并不是一个平滑的色标，但如果你没有太多，它们会生成单独的颜色。

[这个问题](https://stackoverflow.com/questions/923771/quickest-way-to-convert-a-base-10-number-to-any-base-in-net)有更多关于.NET 中的基本转换。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2013-02-02T08:54:57.490

获得第 n 种颜色。只需这种代码就足够了。我在我的opencv聚类问题中使用了这个。随着 col 的变化，这将创建不同的颜色。

```
for(int col=1;col<CLUSTER_COUNT+1;col++){
switch(col%6)
   {
   case 1:cout<<Scalar(0,0,(int)(255/(int)(col/6+1)))<<endl;break;
   case 2:cout<<Scalar(0,(int)(255/(int)(col/6+1)),0)<<endl;break;
    case 3:cout<<Scalar((int)(255/(int)(col/6+1)),0,0)<<endl;break;
    case 4:cout<<Scalar(0,(int)(255/(int)(col/6+1)),(int)(255/(int)(col/6+1)))<<endl;break;
    case 5:cout<<Scalar((int)(255/(int)(col/6+1)),0,(int)(255/(int)(col/6+1)))<<endl;break;
    case 0:cout<<Scalar((int)(255/(int)(col/6)),(int)(255/(int)(col/6)),0)<<endl;break;
   }
} 
```

* * *

## 回答 #12

> 赞同：-3
> 
> 时间：2008-11-21T15:57:27.190

您可以获得一组随机的 3 255 个值，并根据最后一组 3 个值进行检查，确保它们在使用之前与旧值至少相差 X。

旧：190、120、100

新：180、200、30

如果 X = 20，那么新的集合将重新生成。

# c# - PCL 光栅彩色图形失真。代码包括：我错过了什么？

> ID：309150
> 
> 赞同：3
> 
> 时间：2008-11-21T15:43:14.050
> 
> 标签：c#, graphics, printer-control-language

下面的函数将彩色光栅图像打印到 PCL-5 打印机。该功能改编自我们完美运行的 2 色 (1bpp) 打印功能，但颗粒状的 2 色打印除外。问题是图像出现了一个从图像右侧延伸到页面边缘的大黑条，如下所示：

```
 IMAGE#########################################
  IMAGE#########AREA COMPLETELY BLACK###########
  IMAGE######################################### 
```

图像本身看起来很完美，否则。

各种 PCL-to-PDF 工具根本不显示图像，这让我相信我忘记了做某事。之前发送了适当的重置 (\u001bE\u001b%-12345X)，之后发送了页面。

有 PCL 专家吗？我有 PCL 5 颜色技术参考手册，它让我走到了这一步。这最后一件事让我发疯了。

*编辑：我现在知道是什么命令导致了问题，但我不知道为什么：

```
 stream("\u001b*r0F"); 
```

这应该使图像与页面（纵向、横向）一起旋转。如果我删除它，问题就会消失。我可以通过预先旋转位图来补偿，但我真的很想知道是什么原因造成的！

```
 static void PrintImage()
    {
        // Get an image into memory
        Image original = Image.FromFile("c:\\temp\\test.jpg");
        Bitmap newBitmap = new Bitmap(original, original.Width, original.Height);

        stream(String.Format("\u001b*p{0:d}x*p{1:d}Y", 1000, 1000));// Set cursor.
        stream("\u001b*t300R");                                     // 300 DPI
        stream(String.Format("\u001b*r{0:d}T", original.Height));   // Height
        stream(String.Format("\u001b*r{0:d}S", original.Width));    // Width

        stream("\u001b*r3U");      // 8-bit color palette
        stream("\u001b*r0F");      // Follow logical page layout (landscape, portrait, etc..)
        // Set palette depth, 3 bytes per pixel RGB
        stream("\u001b*v6W\u0000\u0003\u0000\u0008\u0008\u0008");  
        stream("\u001b*r1A");      // Start raster graphics
        stream("\u001b*b0M");      // Compression 0 = None, 1 = Run Length Encoding

        // Not fast, but fast enough.  
        List<byte> colors = new List<byte>();
        for (int y2 = 0; y2 < original.Height; y2++)
        {
            colors.Clear();
            for (int x2 = 0; x2 < original.Width; x2++)
            {
                Color c = newBitmap.GetPixel(x2, y2);
                colors.Add(c.R);
                colors.Add(c.G);
                colors.Add(c.B);
            }

            stream(String.Format("\u001b*b{0}W", colors.Count));     // Length of data to send
            streamBytes(colors.ToArray());                           // Binary data
        }
        stream("\u001b*rB");   // End raster graphics  (also tried *rC -- no effect)
    } 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-22T13:37:13.290

您的代码存在一些问题。首先你的光标位置代码不正确，它应该是：

```
"\u001b*p{0:d}x1:d}Y", 1000, 1000 
```

这相当于：

```
<esc>*p1000x1000Y 
```

你有过：

```
<esc>*p1000x*p1000Y 
```

将 PCL 命令连接在一起时，您匹配相同的参数化值和组，然后简单地添加值 + 参数化字符 + 值 + 参数化字符等。确保最终的参数化字符是表示 PCL 命令结束的大写字母。

此外，在定义图像时，我建议您还以分点为单位指定宽度和高度，这应该有助于页面上图像 (*r3A) 的缩放，因此请添加它（就在您的分辨率命令之后应该是合适的位置） ：

```
Int32 deciHeight = original.Height / (int)original.HorizontalResolution * 720;
Int32 deciWidth = original.Width / (int)original.VerticalResolution * 720;
stream("\u001b*t{0:d}h{1:d}V", deciHeight, deciWidth)); 
```

另一个建议是将所有这些写入文件（查看您的编码）并使用少数 PCL 查看器之一查看您的数据，而不是始终打印它。应该为您节省一些时间和一两个森林！我已经尝试了所有这些，并建议花费 89 美元购买[pclWorks](http://www.pagetech.com)。如果你要做很多 PCL，他们也有一个完整的 SDK。我们不使用它，因为我们自己对所有 PCL 进行硬编码，但它看起来确实不错。

至于旋转，我们在某些设备上遇到了问题，您可以先旋转 jpg（original.RotateFlip）然后将其写出来。

我今天没有太多时间，但希望我的评论有所帮助。我可以在周一或周二测试您的代码并使用它并发表任何进一步的评论。

请记住，尽管 PCL 是一种标准，但它从制造商到制造商和设备到设备的支持可能是一个问题，而且大不相同。在做基本的事情时，大多数设备看起来都还可以；但是，如果您进入宏或复杂图形，您会发现差异。

# ms-word - 如何从 Word 2007 文档链接到 chm 文件主题？

> ID：309153
> 
> 赞同：4
> 
> 时间：2008-11-21T15:43:27.110
> 
> 标签：ms-word, docx, chm

有没有办法从 Microsoft Word docx 文档链接到 chm 文件，并在其中链接到某个主题？类似的东西：

> "有关此属性的更多信息，请参阅 [link ref="./SomeDirectory/somedocument.chm!Sometopic.Somesubtopic" text="MyClass.MyProperty"]

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-26T14:10:05.813

我不认为仅仅一个指向 .chm 文件的文件链接就可以完成这项工作。

对我来说，以下链接格式有效（请注意，.chm 文件必须位于受信任的位置，默认情况下网络共享不起作用）：

mk:@MSITStore:C:\SomeDirectory\help.chm::/helppage.htm

编辑

> 对于相对路径，似乎必须使用以下模式：
> 
> ms-its:.\help.chm::/html/main.htm
> 
> （请参阅 [链接到 CHM - 一些注释](http://kb.helpwaregroup.com/ms-html-help/merge/notes)）

此链接将在 IE 中打开（在 HTML 帮助查看器中单击鼠标右键可在属性下查看此链接的位置）。

另一种选择是插入一个 MACROBUTTON 并使用一个宏打开 HTML 帮助查看器。这将是 VBA 代码：

```
Declare Function HtmlHelp Lib "HHCtrl.ocx" Alias "HtmlHelpA" _
   (ByVal hwndCaller As Long, _
   ByVal pszFile As String, _
   ByVal uCommand As Long, _
   dwData As Any) As Long

Private Declare Function FindWindow Lib "user32" Alias "FindWindowA" (ByVal lpClassName As String, ByVal lpWindowName As String) As Long

Public Function GetWindowHandle() As Long
    'obtain Word's hwnd
    'NOTE: there is a possibility of getting the wrong hwnd.  If two word windows
    'are open with the same caption, this *could* happen.  In order to prevent this,
    'you can either change the caption to something strange before trying to find it,
    'or you can compare processId's with GetCurrentProcessId and GetWindowThreadProcessId
    'You can always search the top level windows yourself.

    GetWindowHandle = FindWindow(Word8ClassName, ActiveDocument.Windows(1) & " - " & ActiveDocument.Application.Caption)

End Function

Public Function ShowHelp(strPage As String)

    On Error Resume Next

    HtmlHelp GetWindowHandle, "fullpathtohelpfile.chm", HH_DISPLAY_TOPIC, ByVal strPage

End Function 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-26T14:17:40.990

为了在 chm 文件中找到页面的地址，您需要右键单击页面（页面本身，而不是内容树中的链接）并选择“属性”。在“地址（URL）”下，您可以找到您要查找的内容，例如

> mk:@MSITStore:D:\Tools\Foo\Bar.chm::/help/base/index.html

好消息：您可以用鼠标选择属性表中的文本并复制它；-)

至于如何将 URL 插入 word 中以使其正常工作，我不知道，但一个简短的*试验和错误*应该可以让你到达那里。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-21T23:06:56.747

您应该可以通过设置文件的超链接并使用“#”标题锚来做到这一点（我不确定它叫什么......）但这里有一个例子：

```
C:\Helpfiles\Help.chm#Topic 
```

# json - JSON 验证是最佳实践吗？

> ID：309156
> 
> 赞同：19
> 
> 时间：2008-11-21T15:44:25.297
> 
> 标签：json, validation, schema, jsonschema

[验证 JSON](http://www.json.com/json-schema-proposal/)是否是最佳实践？

使用[JSON 模式提案](http://json-schema.org/)和[JSON 模式验证器的 JavaScript 实现](http://code.google.com/p/jsonschema/)，这种做法似乎相对容易实现。那么，它是否应该成为任何强大应用程序的一部分？或者您是否采用其他首选策略来处理错误的 JSON？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-21T16:09:55.620

在服务器上，必须验证来自外部的数据。

在浏览器中，如果您可以保证 JSON 是由您控制的服务器代码生成的，并且它所依赖的任何数据都已在服务器上验证，那么它与安全 POV 是多余的。即便如此，它仍然可以用于调试。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-10-21T06:43:53.443

我对此的 2c 是：

(a) 是的，显然传入的数据应该经过验证，但是

(b) 最好的地方不是使用 Json 数据，而是使用实际的业务逻辑对象，如果使用数据绑定。JSON 验证仅在您处理“原始”JSON 时才有意义，但大多数服务（至少在 Java 中）首先使用数据绑定，然后对 biz 逻辑对象进行操作，而不是数据格式（这通常几乎是一个实现细节）

# java - 将应用程序嵌入到另一个应用程序中

> ID：309158
> 
> 赞同：2
> 
> 时间：2008-11-21T15:44:48.853
> 
> 标签：java, swing, embed

我相信你们中的一些人注意到，如果您有 Acrobat Reader（或任何其他 pdf 查看器），并在 Firefox 中打开一个 pdf，您会看到它嵌入在您的选项卡中。有没有办法在 JFrame 中嵌入应用程序？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-22T13:30:11.900

这是一个相当棘手的问题。一般来说，像Adobe Reader这样的原生应用程序不提供可以嵌入到swing应用程序中的组件。但在 Windows 中，有 COM/OLE 方法允许将应用程序嵌入在一起。这篇[文章](http://www.javalobby.org/java/forums/t70811.html)可以帮助你。它指向允许这种嵌入的两个项目 JCOM 和 JACOB。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-21T15:47:00.580

是的，但该应用程序需要提供可嵌入的 JComponent 版本。

# haskell - haskell 类型类中的多个类型参数

> ID：309159
> 
> 赞同：9
> 
> 时间：2008-11-21T15:46:21.940
> 
> 标签：haskell, typeclass

我正在尝试在 Haskell98 中进行一些抽象，但不知道该怎么做。

我想做的是为可以转换为列表的类型定义一个类。

```
toList :: a -> [b] 
```

但我不知道如何为这个方法定义一个类。我提出了以下三个想法：

```
class ToList a b where
    toList :: a -> [b]

class ToList a where
    toList :: a -> [b]

class ToList a where
    toList :: a b -> [b] 
```

第一个不起作用，因为 Haskell98 不允许多个参数类。

第二个不起作用，因为 b 依赖于 a 并且不能为每个 b 实现。

第三个也不起作用，因为我不知道如何用“b”不是最后一个类型参数的类型来实例化类。

```
data HTree a b = Nil | Node a b (HTree a b) (HTree a b)

toList Nil = []
toList Node x y l r = toList l ++ [(x,y)] ++ toList r 
```

或者

```
toList Nil = []
toList Node x y l r = toList l ++ [x] ++ toList r 
```

我该怎么做这样的事情？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-23T07:11:24.067

另请参阅标准库中的[Data.Foldable](http://www.haskell.org/ghc/docs/latest/html/libraries/base/Data-Foldable.html)`toList` ，它为任何`Foldable`实例提供了一个函数。 `Foldable`实例化需要一些复杂性，但这将是一个好习惯。作为奖励，您的`HTree`类型几乎与文档中的示例实例完全相同。

此外，我建议将您更改`HTree`为：

```
data HTree a = Nil | Node a (HTree a) (HTree a) 
```

然后使用`HTree (a,b)`而不是`HTree a b`. 这个单参数版本将更容易与标准类型和实例组合，并且它更能说明正在发生的事情，因为它以相同的方式依赖于两个参数。它也是一个`Functor`, 并且定义这样一个实例将使这种类型非常好用。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-21T21:10:37.557

我建议[Type 类不像它们最初看起来那样有用](http://www.ninebynine.org/Software/Learning-Haskell-Notes.html#type-class-misuse)- 如果假定的类只有一个接口方法，请考虑改为声明一个函数类型。我也来自 OO 背景，发现我花了太多时间试图让“类”意味着我认为的意思，而实际上我应该使用“数据”。

只需编写您的 toList' 函数然后“提升”它以对您的数据结构进行操作就容易得多。事实上，广受好评的[Yet Another Haskell 教程](http://www.cs.utah.edu/~hal/docs/daume02yaht.pdf)通过大量练习展示了它是如何完成的，并使用二叉​​树作为示例。提升的好处在于它区分了重要的东西——数据类型的结构，而不是 toList 的实现——所以一旦提升执行“按顺序遍历数据类型”，你就可以使用提升来做任何事情 - toList、打印等等。支持 toList 不是数据结构的重要部分，所以不应该在类声明中——重要的部分是如何遍历数据结构。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-11-22T11:27:18.920

您可能希望为 ToList 类选择最后一个选项，并创建`(HTree a)`ToList 的实例。然后`toList`有类型 `(HTree a b) -> [b]`，不是例子`(HTree a b) -> [(a,b)]`。我假设您将 a 视为“键”，将 b 视为“值”类型。

```
class ToList a where
    toList :: a b -> [b]

data HTree a b = Nil | Node a b (HTree a b) (HTree a b)

instance ToList (HTree a) where
    toList Nil = []
    toList (Node x y l r) = toList l ++ [y] ++ toList r

test = toList (Node "a" 1 (Node "b" 2 Nil Nil) Nil)
-- test == [2,1] 
```

# c# - 在 C# 中，通过 this.XYZ 访问当前对象的属性与仅 XYZ 相比被认为是糟糕的样式

> ID：309161
> 
> 赞同：1
> 
> 时间：2008-11-21T15:46:47.413
> 
> 标签：c#, coding-style

这是一个从不使用 this.XYZ 构造的简单案例吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-21T15:51:58.993

如果它违反了你的风格准则，它只会被认为是糟糕的风格。有时`this`需要使用 using 来限定局部变量上的成员变量：

```
public MyType(int arg)
{
    this.arg = arg;
} 
```

这个问题也可以通过样式指南来缓解。例如，带有“_”的前缀成员：

```
public MyType(int arg)
{
    _arg = arg;
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-21T15:52:13.767

我不会说这是糟糕的风格 - 但它并不是特别地道。

我几乎唯一的用途`this.foo`是将参数复制到字段中时：

```
public Person (string name, string occupation)
{
   this.name = name;
   this.occupation = occupation;
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-21T15:52:29.930

我从来没有听说过这是一个风格问题。我过去一直这样做是为了获得智能感知，但后来我开始使用`Ctrl`- `j`，然后我发现自己无需使用拐杖就能记住对象的属性。

可能是因为随着我获得更多经验，我的对象变得不那么复杂......

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-21T15:54:45.010

我总是用这个。对于全局变量。这样，我可以清楚地知道我使用的是全局变量，而不必使用像“_”这样的前缀。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-21T16:04:35.303

MS 工具 StyleCop 在分析源代码时坚持使用 this.XYZ（或者应该是 this.Xyz）变体。

# sql - 如何在 T-SQL 中将 int 转换为零填充字符串？

> ID：309165
> 
> 赞同：46
> 
> 时间：2008-11-21T15:47:25.853
> 
> 标签：sql, tsql

假设我有一个值为 1 的 int。如何将该 int 转换为零填充字符串，例如`00000001`？

* * *

## 回答 #1

> 赞同：45
> 
> 时间：2008-11-21T15:58:32.430

```
Declare @MyInt integer Set @MyInt = 123
Declare @StrLen TinyInt Set @StrLen = 8

Select Replace(Str(@MyInt, @StrLen), ' ' , '0') 
```

* * *

## 回答 #2

> 赞同：35
> 
> 时间：2008-11-21T15:55:02.420

另一种方法是：

```
DECLARE @iVal int = 1
select REPLACE(STR(@iVal, 8, 0), ' ', '0') 
```

* * *

## 回答 #3

> 赞同：33
> 
> 时间：2013-08-21T00:32:26.693

从 SQL Server 2012 开始，您现在可以这样做：

```
format(@int, '0000#') 
```

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2010-03-07T17:27:43.573

这对我有用：

```
SELECT RIGHT('000' + CAST(Table.Field AS VARCHAR(3)),3) FROM Table 
```

...

我创建了这个用户函数

T-SQL 代码：

```
CREATE FUNCTION CIntToChar(@intVal Int, @intLen Int) RETURNS nvarchar(24) AS BEGIN

IF @intlen > 24
   SET @intlen = 24

RETURN REPLICATE('0',@intLen-LEN(RTRIM(CONVERT(nvarchar(24),@intVal)))) 
    + CONVERT(nvarchar(24),@intVal) END 
```

例子 ：

选择 dbo.CIntToChar(867, 6) 作为 COD_ID

输出

000867

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2018-06-05T09:38:44.433

使用`FORMAT(<your number>,'00000000')`尽可能多的零，以便在最终结果中包含数字。

[这是 FORMAT 函数的官方文档](https://docs.microsoft.com/en-us/sql/t-sql/functions/format-transact-sql?view=sql-server-2017)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-21T16:13:27.283

如果我试图填充到特定的总长度，我会使用 REPLICATE 和 DATALENGTH 函数，如下所示：

```
DECLARE @INT INT
DECLARE @UNPADDED VARCHAR(3)
DECLARE @PADDED VARCHAR(3)

SET @INT = 2
SET @UNPADDED = CONVERT(VARCHAR(3),@INT)
SET @PADDED = REPLICATE('0', 3 - DATALENGTH(@UNPADDED)) + @UNPADDED
SELECT @INT, @UNPADDED, @PADDED 
```

为了简单起见，我在这里使用了变量，但是您可以看到，您可以指定总字符串的最终长度，而不必担心开头的 INT 的大小，只要它 <= 最终字符串长度即可。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-13T16:33:56.180

我总是使用：

```
SET @padded = RIGHT('z0000000000000'
  + convert(varchar(30), @myInt), 8) 
```

z 阻止 SQL 将字符串隐式转换为 int 以进行加法/连接。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-01-13T17:15:35.237

如果 int 可以变为负数，那么您就有问题了，所以为了解决这个问题，我有时会这样做：

```
DECLARE @iVal int 
set @iVal = -1
    select 
        case 
            when @ival >= 0 then right(replicate('0',8) + cast(@ival as nvarchar(8)),8)
            else '-' + right(replicate('0',8) + cast(@ival*-1 as nvarchar(8)),8)
        end 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2015-05-09T06:58:08.697

考虑使用 '0' 填充的非常直接的方法是，如果您将 @_int 固定为 4 位小数，则注入 4 个 '0'：

```
 select RIGHT( '0000'+ Convert(varchar, @_int), 4) as txtnum 
```

; 如果你的固定空间是 3，你注入 3'0's

```
 select RIGHT( '000'+ Convert(varchar, @_int), 3) as txtnum 
```

; 下面我注入 '00' 为每个建筑物生成 99 个标签

```
declare @_int int
set @_int = 1
while @_int < 100 Begin
    select BldgName + '.Floor_' + RIGHT( '00'+ Convert(varchar, @_int), 2) 
    + '.balcony' from dbo.tbl_FloorInfo group by BldgName
    set @_int = @_int +1
End 
```

结果是：

```
 'BldgA.Floor_01.balcony'
    'BldgB.Floor_01.balcony'
    'BldgC.Floor_01.balcony'
     ..
     ..
    'BldgA.Floor_10.balcony'
    'BldgB.Floor_10.balcony'
    'BldgC.Floor_10.balcony'
     ..
     ..
     ..
    'BldgA.Floor_99.balcony'
    'BldgB.Floor_99.balcony'
    'BldgC.Floor_99.balcony' 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-11-21T16:06:45.877

或者，如果您真的想成为硬核…… ;-)

```
declare @int int
set @int = 1

declare @string varchar(max)
set @string = cast(@int as varchar(max))

declare @length int
set @length = len(@string)

declare @MAX int
set @MAX = 8

if @length < @MAX
begin
    declare @zeros varchar(8)
    set @zeros = ''

    declare @counter int
    set @counter = 0

    while (@counter < (@MAX - @length))
    begin
        set @zeros = @zeros + '0'
        set @counter = @counter + 1
    end
    set @string = @zeros + @string
end
print @string 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2014-10-09T22:32:34.363

然后是这个，使用 REPLICATE：

```
SELECT REPLICATE('0', 7) + '1' 
```

当然，您可以根据需要将文字 7 和 '1' 替换为适当的函数；以上为您提供了示例。例如：

```
SELECT REPLICATE('0', 8 - LEN(CONVERT(nvarchar, @myInt))) + CONVERT(nvarchar, @myInt) 
```

将用零填充小于 8 位的整数，最多 8 个字符。

现在，REPLICATE 的第二个参数中的负数将返回 NULL。因此，如果有可能（例如，在上面的示例中，@myInt 可能超过 1 亿），那么如果字符数超过 8 个，您可以使用 COALESCE 返回不带前导零的数字：

```
SELECT COALESCE(REPLICATE('0', 8 - LEN(CONVERT(nvarchar, @myInt))) + CONVERT(nvarchar, @myInt), CONVERT(nvarchar, @myInt)) 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2018-04-16T19:20:05.673

我认为 Charles Bretana 的答案是最简单和最快的。不使用的类似解决方案`STR`是：

```
SELECT REPLACE(REVERSE(
        CONVERT(CHAR(5 /*<= Target length*/)
                , REVERSE(CONVERT(VARCHAR(100), @MyInt)))
     ), ' ', '0') 
```

# .net - 在 XAML 中调试和发布程序集引用

> ID：309186
> 
> 赞同：2
> 
> 时间：2008-11-21T15:52:50.570
> 
> 标签：.net, wpf, visual-studio

在 XAML 命名空间声明中，有没有办法根据您当前的配置来消除不同命名的程序集的歧义？

我正在重新设计项目构建系统。旧系统将调试和发布程序集构建为单独的目录，这意味着以下（大致）可以在 XAML 文档的顶部正常工作：

```
<Window x:Class="test.MainWindow"
...
    xmlns:tns="clr-namespace:TestNameSpace;assembly=SampleAssembly"
... 
```

我们收到的重组请求是通过对调试和发布配置进行不同命名来区分我们的程序集。所以我们的SampleAssembly.dll，之前建在两个单独的目录下，现在是同一个目录下的两个程序集，SampleAssemblyDebug.dll和SampleAssemblyRelease.dll。有没有办法调整 XAML 行以根据配置引用正确的程序集？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-23T20:08:03.953

目前这是不可能的，没有一些讨厌的预编译技巧。但是，您可以做的是在您的程序集上定义程序集级别属性[XmlnsDefinitionAttribute](http://msdn.microsoft.com/en-us/library/system.windows.markup.xmlnsdefinitionattribute.aspx) ，然后使用您在 XAML 中定义的 uri 命名空间。

例如，在您的 AssemblyInfo.cs 文件中，您可以使用以下内容：

```
[assembly: XmlnsDefinition("http://mytest.com", "TestNameSpace")] 
```

然后在 XAML 中：

```
<Window
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:test="http://mytest.com">
    <Grid>
        <test:MyButton></test:MyButton>
    </Grid>
</Window> 
```

其中 MyButton 是 TestNameSpace 命名空间中的一种类型。

# sharepoint - SharePoint：多行文本字段的最大大小是多少？我可以设置吗？

> ID：309188
> 
> 赞同：5
> 
> 时间：2008-11-21T15:53:37.820
> 
> 标签：sharepoint

多行文本字段的最大大小是多少？我可以设置吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-25T09:23:45.033

多行文本字段在 sharepoint 中定义为“Note”类型，它作为 ntext sql 类型存储在 DB 中。

在 SQL 类型中可以存储 2gb 的 char 数据，即 1,073,741,823 个字符。

显然，应该允许获取多大的数据存在实际限制——因为 SP 是一个基于 Web 的系统，你不希望一直来回传递 2gb。

您无法设置它，但您可以使用工作流来检查字段中数据的大小并截断或警告字段的大小。

# window - 如何以编程方式确定应用程序是否在任务栏中闪烁

> ID：309189
> 
> 赞同：1
> 
> 时间：2008-11-21T15:54:06.650
> 
> 标签：window, taskbar, flashwindowex

我可以使用“FlashWindowEx”在任务栏中使窗口闪烁，但我可以调用什么来确定窗口是否已经完成？是否有一个标志可以设置在我可以查询的地方？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-21T18:03:04.860

似乎这种事情是不可能的。但是，可能有解决方法。例如，您可以保留一个布尔变量“flash = false”。然后在调用 FlashWindowEx 时将其设置为“true”，并在应用程序通常获得焦点的情况下设置为“false”。

参考：

> [http://forums.microsoft.com/MSDN/ShowPost.aspx?PostID=1846008&SiteID=1](http://forums.microsoft.com/MSDN/ShowPost.aspx?PostID=1846008&SiteID=1)

# linux - 用于递归查找和替换的内置 unix/linux 命令？

> ID：309191
> 
> 赞同：1
> 
> 时间：2008-11-21T15:54:28.770
> 
> 标签：linux, unix, command-line

许多人将 find 和 sed、perl 或任何数量的其他 unix 命令串在一起以跨多个文件进行查找和替换。但是，有一个简单的命令可以为您轻松完成吗？

编辑：数字忍者指出它是 rpl。

然而，这不是一个内置命令，但是对于像 Ubuntu 这样的基于 debian 的发行版，您可以简单地使用 sudo apt-get install rpl 安装它

我猜想它可以通过其他 *nix 操作系统中的大多数包管理器获得。OS X 用户可以在 [http://www.laffeycomputer.com/rpl.html下载二进制文件](http://www.laffeycomputer.com/rpl.html)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-21T15:58:45.143

我相信你在想'rpl' [http://www.linux.org/apps/AppId_2684.html](http://www.linux.org/apps/AppId_2684.html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-21T16:11:21.763

我认为以下的一些变化会起作用：

```
寻找 。-name *.extension | perl -pi.bak -e "s/text_to_be_replaced/replacement/"
```

# java - Java Transport.send() 它是线程安全的吗？

> ID：309202
> 
> 赞同：6
> 
> 时间：2008-11-21T15:57:37.690
> 
> 标签：java, email, concurrency

该方法是静态的，但我找不到它是否是线程安全的。我计划一次使用多个线程来使用此方法，如果可能的话，我想避免同步块。

```
javax.mail.Transport.send(msg); 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-06-14T15:37:55.503

拥有一个非线程安全的静态方法通常是糟糕的设计并且违反了预期。

文档确实似乎没有提及线程安全，但快速浏览代码*表明*该实现是线程安全的，方法是在每次调用时创建一个线程限制的 Transport 实例并委托给它。

为了绝对确定，我建议从日历中抽出几天进行适当的分析。

# java - 如何将 java.util.Date 存储到 UTC/GMT 时区的 MySQL 时间戳字段中？

> ID：309203
> 
> 赞同：15
> 
> 时间：2008-11-21T15:57:45.100
> 
> 标签：java, mysql

我使用了一个新的 Date() 对象来填充 MySQL DB 中的一个字段，但存储在该字段中的实际值是在我的本地时区中。

如何配置 MySQL 以将其存储在 UTC/GMT 时区？

我认为，配置连接字符串会有所帮助，但我不知道如何。连接字符串中有许多属性，例如 useTimezone、serverTimzone、useGmtMillisForDatetimes、useLegacyDatetimeCode、...

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-11-22T17:03:18.710

简短的回答是：

*   将“default-time-zone=utc”添加到 my.cnf
*   在您的代码中，始终以 UTC 格式“思考”，除非为您的用户显示日期
*   使用 JDBC 获取/设置日期或时间戳时，始终使用 Calendar 参数，设置为 UTC：

    resultset.getTimestamp("my_date", Calendar.getInstance(TimeZone.getTimeZone("UTC")));

*   要么将您的服务器与 NTP 同步，要么仅依靠数据库服务器告诉您现在是什么时间。

* * *

长答案是这样的：

在处理任何数据库中的日期和时区以及任何客户端代码时，我通常推荐以下策略：

1.  **将您的数据库配置为使用 UTC timezone**，而不是使用服务器的本地时区（当然，除非它是 UTC）。

    *   如何执行此操作取决于您的数据库服务器。MySQL 的说明可以在这里找到：http: [//dev.mysql.com/doc/refman/5.0/en/time-zone-support.html](http://dev.mysql.com/doc/refman/5.0/en/time-zone-support.html)。基本上你需要在 my.cnf 中这样写：default-time-zone=utc

    *   通过这种方式，您可以在任何地方托管您的数据库服务器，轻松更改您的托管位置，并且更普遍地在您的服务器上操作日期，而不会产生任何歧义。

    *   如果您真的更喜欢使用本地时区，我建议您至少关闭夏令时，因为数据库中的日期不明确可能是一场真正的噩梦。
        *   *例如，如果您正在构建电话服务并且您在数据库服务器上使用夏令时，那么您就是在自找麻烦：将无法判断是否有客户从“2008-10-26 02:30 :00" 到 "2008-10-26 02:35:00" 实际上调用了 5 分钟或 1 小时 5 分钟（假设夏令时发生在 10 月 26 日凌晨 3 点）！*
2.  **在您的应用程序代码中，始终使用 UTC 日期，除非向您的用户显示日期。**

    *   在 Java 中，从数据库中读取时，始终使用：

    时间戳 myDate = resultSet.getTimestamp("my_date", Calendar.getInstance(TimeZone.getTimeZone("UTC")));

    *   如果您不这样做，则时间戳将被假定为您的本地时区，而不是 UTC。
3.  **同步您的服务器或仅依赖数据库服务器的时间**

    *   如果您的 Web 服务器在一台（或多台）服务器上，而您的数据库服务器在另一台服务器上，那么我强烈建议您将它们的时钟与 NTP 同步。

    *   或者，只依靠一台服务器告诉你现在几点。通常，数据库服务器是最好的请求时间的服务器。换句话说，避免这样的代码：

    prepareStatement = connection.prepareStatement("UPDATE my_table SET my_time = ? WHERE [...]");
    java.util.Date now = new java.util.Date(); // 当地时间！:-(
    preparedStatement.setTimestamp(1, new Timestamp(now.getTime()));
    int result =preparedStatement.execute();

    *   相反，依赖于数据库服务器的时间：

    PreparedStatement = connection.prepareStatement("UPDATE my_table SET my_time = NOW() WHERE [...]");
    int 结果=preparedStatement.execute();

希望这可以帮助！:-)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-11-15T19:58:14.570

MiniQuark 总体上为数据库提供了一些很好的答案，但有一些 MySql 特定的怪癖需要考虑......

> 将数据库配置为使用 UTC 时区

这实际上不足以解决问题。如果按照 OP 的要求将 java.util.Date 传递给 MySql，MySql 驱动程序将**更改该值**以使其看起来与数据库时区中的本地时间相同。

示例：如果您的数据库配置为 UTC。您的应用程序是 EST。您在 5:00 (EST) 传递一个 java.util.Date 对象。数据库会将其转换为 5:00 UTC 并存储。惊人的。

您必须在传递数据以“撤消”此自动调整之前调整时间。就像是...

```
long originalTime = originalDate.getTime();
Date newDate = new Date(originalTime - TimeZone.getDefault().getOffset(originalTime));
ps.setDate(1, newDate); 
```

读回数据需要类似的转换..

```
long dbTime = rs.getTimestamp(1).getTime();
Date originalDate = new Date(dbTime + TimeZone.getDefault().getOffset(dbTime)); 
```

这是另一个有趣的怪癖......

> 在 Java 中，从数据库读取时，始终使用： Timestamp myDate = resultSet.getTimestamp("my_date", Calendar.getInstance(TimeZone.getTimeZone("UTC")));

MySql 实际上忽略了那个 Calendar 参数。无论您传递什么日历，这都会返回相同的值。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2013-03-20T20:08:50.923

我遇到了同样的问题，我花了将近一天的时间才找到。我在 MySQL 中存储 DateTime 列。在亚马逊云中运行的 RDS 实例默认正确设置为具有 UTC 时间戳。

越野车代码是：

```
 String startTime = "2013-02-01T04:00:00.000Z";
    DateTime dt = ISODateTimeFormat.dateTimeParser().parseDateTime(startTime);            

    PreparedStatement stmt = connection.prepareStatement(insertStatementTemplate);

    Timestamp ts = new Timestamp(dt.getMillis());
    stmt.setTimestamp(1, ts, Calendar.getInstance(TimeZone.getTimeZone("UTC"))); 
```

在上面的代码中，“.setTimestamp”调用不会将日期作为 UTC 日期！

经过数小时的调查，结果证明这是 Java / MySQL 驱动程序中的一个已知错误。对 setTimestamp 的调用只是忽略了 Calendar 参数。

要解决此问题，请将“ **useLegacyDatetimeCode=false** ”添加到您的数据库 URI。

```
private final static String DatabaseName =
  "jdbc:mysql://foo/?useLegacyDatetimeCode=false"; 
```

一旦我这样做了，存储在 MySQL 数据库中的日期就是正确的 UTC 格式，而不是我本地工作站的时区。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-21T16:20:40.170

好吧，如果我们谈论使用`PreparedStatement`s，那么有一种[setDate 形式](http://java.sun.com/javase/6/docs/api/java/sql/PreparedStatement.html#setDate(int,%20java.sql.Date,%20java.util.Calendar))，您可以在其中将日历集传递到特定时区。

例如，如果您有一个名为 stmt 的 PreparedStatement，一个名为 date 的 Date，并假设日期是第二个参数：

```
stmt.setDate(2, date, Calendar.getInstance(TimeZone.getTimeZone("GMT"))); 
```

最好的部分是，即使 GMT 是无效的时区名称，由于 getTimeZone 的默认行为，它仍然返回 GMT 时区。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-22T18:28:48.040

java Date 与时区无关。它始终以 GMD(UTC) 表示日期，以从纪元开始的毫秒数为单位。

时区相关的唯一时间是当您将日期作为字符串发出或将数据字符串解析为日期对象时。

# c# - 变量前缀（“匈牙利符号”）真的有必要了吗？

> ID：309205
> 
> 赞同：39
> 
> 时间：2008-11-21T15:58:03.383
> 
> 标签：c#, naming-conventions, hungarian-notation

由于 C# 是强类型的，我们真的需要为变量添加前缀吗？

例如

```
iUserAge
iCounter
strUsername 
```

我过去常常加前缀，但**以后我看不到任何好处**。

* * *

## 回答 #1

> 赞同：49
> 
> 时间：2008-11-21T16:03:04.543

> 变量前缀（匈牙利语）真的有必要了吗？

# 不！

事实上，微软自己的[风格指南](http://msdn.microsoft.com/en-us/library/ms229042.aspx)（实践起源）现在反对它。特别是，请参阅[通用命名约定](http://msdn.microsoft.com/en-us/library/ms229045.aspx)部分，其中包括以下文本（粗体，不少于）：

> **不要使用匈牙利符号。**

当然，这些指南在 Microsoft 之外不具有约束力或强制性。然而，这是平台供应商发布的建议，它不仅仅是从任何先前的指南中删除积极的建议，而是今天的措辞强硬和强调的消极建议。

换句话说，不要再使用它们了。

* * *

## 回答 #2

> 赞同：30
> 
> 时间：2008-11-21T16:11:05.367

我认为唯一适合弯曲标准和前缀变量的地方：

*   控制名称：`txtWhatever`- 我知道我不是唯一一个。好消息是你可以在 txtName 旁边想出 lblName 之类的东西，而且你不需要进入 NameLabel/NameTextBox 方向。

*   类成员变量：`_whatever`. 我已经尝试了 m_ 并且根本没有前缀，最后得到了简单的下划线。m_ 更难输入，没有前缀有时会让人感到困惑（尤其是在维护期间，我知道你们所有人在编写代码时都熟记于心）

不过，我没有发现任何一致的情况，在变量前面加上它的类型会使代码更具可读性。

编辑：我确实阅读了 Microsoft 指南。但是，我认为编码风格可以在适当的情况下发展和/或“弯曲”。正如我上面提到的，我发现在反复试验中使用下划线前缀很有用，而且肯定比在代码中的任何地方都使用 this.whatever 更好。

支持“进化”理论——早在 .NET 1.x 中，当微软发布编码指南时，他们建议对所有内容使用 Camel 大小写，甚至是常量。我现在看到他们已经改变并建议将 Pascal case 用于常量或公共只读字段。

此外，即使是 .NET Framework 类库目前也充满了 m_ 和 _ 和 s_（尝试使用反射器浏览实现）。所以毕竟，这取决于开发人员，只要在您的项目中保持一致性。

* * *

## 回答 #3

> 赞同：22
> 
> 时间：2008-11-21T19:02:58.047

如果匈牙利语的意思是“带有类型缩写的前缀”，例如 uCount 或 pchzName，那么我会说这种做法很糟糕，而且谢天谢地，它似乎正在逐渐淡出常用用法。

但是，我仍然认为前缀对于作用域非常有用。在我的工作室，我们使用此约定为变量添加前缀：

```
i_  // input-only function parameter (most are these)
o_  // output-only function parameter (so a non-const & or * type)
io_ // bidirectional func param
_   // private member var (c#)
m_  // private member var (c++)
s_  // static member var (c++)
g_  // global (rare, typically a singleton accessor macro) 
```

我发现这非常有用。func 参数前缀特别有用。在函数内部，您总是可以一眼就知道该 var 的来源。通常，当我们想要修改它或改变它的含义时，我们会将 var 复制到另一个。

简而言之：现代工具不需要类型前缀。IDE 负责为您识别和检查这些内容。但是基于范围的前缀对于可读性和清晰度非常有用。

*还有一些有趣的附带好处，例如 Intellisense。*您可以键入 i_ ctrl-space 并获取 func 的所有输入参数以供选择。或 g_ ctrl-space 获取所有单身人士。这是一个节省时间的方法。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2008-11-21T16:01:07.447

没有。我们[曾经](http://www.joelonsoftware.com/articles/Wrong.html)需要吗？

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2008-11-21T16:02:20.907

匈牙利符号很丑陋。唯一的例外是接口，大多数人认为它是可以接受的。

Linus 总结得很好：“将函数的类型编码到名称中（所谓的匈牙利表示法）是大脑受损 - 编译器无论如何都知道类型并且可以检查它们，它只会让程序员感到困惑”

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2008-11-21T16:01:14.827

不，[匈牙利表示法](http://en.wikipedia.org/wiki/Hungarian_notation)只是给代码增加了不必要的噪音，并且对于编译器类型检查来说是多余的。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2008-11-21T18:29:01.627

是的，如果按照最初的意思使用匈牙利符号，而不是按照 Microsoft 实现的那样使用。很像上面的例子，它将文本框和相应的标签显示为 lblWhatever、txtWhatever。用它来定义变量的用途，而不是类型。它可以提供信息来知道你的号码是moneyTotal，它告诉我的不仅仅是数据类型。

但是，像常用的那样吗？不。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2008-11-21T16:02:38.740

前缀是 VB（和更早的！）时代​​的遗留物，当时[匈牙利符号](http://en.wikipedia.org/wiki/Hungarian_notation)为王。情况已不再如此，尽管 C#[社区确实强制要求](http://msdn.microsoft.com/en-us/library/8bc1fexb(VS.71).aspx)为接口使用 Capital 前缀`I`（例如`ILoadable`）。

当前的 Microsoft 指南在[此处](http://msdn.microsoft.com/en-us/library/xzf533w0(VS.71).aspx)。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2008-11-21T19:17:49.360

不再需要匈牙利符号来识别字符串示例中的数据类型，但它仍然可以用于以其他方式识别变量的特征。这是一篇很好的文章，讨论了使用匈牙利符号的有用方法：http: [//www.joelonsoftware.com/articles/Wrong.html](http://www.joelonsoftware.com/articles/Wrong.html)

这是摘录

“在 Simonyi 的匈牙利符号版本中，每个变量都带有一个小写标签前缀，表示该变量所包含的东西的种类。

例如，如果变量名是 rwCol，则 rw 是前缀。

我是故意用类型这个词的，因为西蒙尼在他的论文中错误地使用了类型这个词，而一代又一代的程序员误解了他的意思。”

他还使用了一个示例来识别前缀为“s”或“u”的字符串，以识别它们是否可以安全打印出来，例如 print(uSomeString); 之类的语句。很容易被识别为错误的。

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2009-11-17T23:32:55.957

我看到的大多数反对匈牙利符号的论点都提到现代编辑器和 IDE 完全能够为您提供您需要了解的有关每个标识符的所有信息。很公平。

但是打印代码呢？你不会在纸上进行代码审查或演练吗？您不将打印代码用于培训目的吗？您不使用代码片段来获取在线帮助吗？匈牙利符号在这些场合*非常*有价值。

我一直在我的所有代码中使用（某种）匈牙利符号。我发现它的缺席很丑陋，而且缺乏信息。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2008-11-21T16:04:47.160

我个人不再这样做了，但是您仍然会有人争论为范围添加前缀。

我选择 Microsoft 并将他们的[大写样式](http://msdn.microsoft.com/en-us/library/x2dbyw72(VS.71).aspx)用于所有命名约定。在我看来，该链接所在的整个“类库开发人员设计指南”部分是纯金的。

此外，我喜欢 Addison Wesley 的“框架设计指南”一书。它涵盖了所有这些指南，并附有来自 Microsoft 团队成员的注释，说明他们为什么推荐他们所提议的内容以及如何在组织内采用它。

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2008-11-21T16:05:51.057

好吧，为了反驳，我会说 - 这取决于。我个人反对他们，但这取决于你的团队。每个团队都应负责制定自己的一套指南。希望这不包括所谓的匈牙利符号，但它确实应该是一个团队的决定。您可能会发现想要打破风格准则的情况。

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2008-11-21T21:24:01.087

让我对这个问题感到好奇的是，引入前缀（即匈牙利符号）的语言（C 然后是 C++）也是强类型的。据我所知，Pascal 在 Microsoft 的使用也是如此。而且它似乎也与 Mesa 一起使用，这是一种强类型语言，匈牙利人可能对 [;<) 有一定的了解。

在这种情况下，从问题的角度出发并考虑（1）什么问题被用来帮助解决问题以及（2）这个问题是如何消失的，这是公平的。

我知道这并不完全是一个答案，但它可能比全面反对使用过时或错误的前缀更有用。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2008-11-21T16:05:27.453

尽管编译器可以快速轻松地检查变量的类型，但人类在浏览一段源代码时却无法做到这一点。因此，有些人（比如我）更喜欢让变量名更冗长一些，使它们可以快速识别为全局变量或类变量、字符串或 int 等。

它可能对编译器没有帮助，但是当读取一段外国代码时，它肯定会节省您手动查找每个变量的时间......

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2008-11-21T18:56:57.983

当然不。作为一般规则，我开始相信这只是噪音。如果您是独立顾问，或者您的公司没有全面的风格指南，[IDesign](http://www.idesign.net/idesign/DesktopDefault.aspx)有一个很好的指南。只需查看页面的右侧，您就可以 D/L 他们的 C# 编码标准文档的最新版本。

史蒂夫

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2009-05-26T20:11:02.960

匈牙利符号从来都不是用来显示变量是什么数据类型的。建议使用“str”或“i”来隐式定义类型是被误解的。这意味着只显示变量的“种类”，而不是“类型”。

因此，要回答这个问题，现在不应该使用它，过去也不应该使用它。

我知道它已被链接，但滚动到 Joel 文章的底部以获取更多信息 - [http://www.joelonsoftware.com/articles/Wrong.html](http://www.joelonsoftware.com/articles/Wrong.html)在那里他谈到了匈牙利语的位置

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2009-05-06T20:23:43.217

我只在我的数据库（PostgreSQL）中使用它

```
t_ for table name
v_ for view name
i_ for index name
trig_ for trigger

sp_ for stored procedure name
p_ for parameter    
v_ for variable
c_ for cursor
r_ for record 
```

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2008-11-21T16:05:11.510

有关良好约定的一般概述，请参见此处：http: [//msdn.microsoft.com/en-us/library/ms229002.aspx](http://msdn.microsoft.com/en-us/library/ms229002.aspx)

有一本关于这方面的书，他们在其中解释了每个约定背后的原因。读起来很有趣。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2008-11-21T19:22:23.843

不，我们不需要它们。我过去常常遵循这一点，我们被迫遵循那种编码标准。

此外，借助内置于 VS 和其他第三方插件（如 CodeRush express 和 Refactor Pro）中的 Intellisense、代码定义窗口和重构工具，在没有它的情况下使用代码会更容易。

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2008-11-21T16:26:51.700

我总是在实例成员变量前面加上**m__**和在静态成员变量前面加上**s_**。我遇到了来自推荐/反对这种方法的 MS 人员的可变文章。

我也很确定在使用 Reflector 查看标准 .NET 库时遇到了**m_前缀......**

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2008-11-21T20:24:54.577

在代码内部和处理数据类型时，我认为没有理由使用匈牙利符号。

但是当我使用一系列用户界面控件时，无论它们是文本框、下拉列表、网格还是其他什么，我都喜欢让我的智能感知为我工作。因此，为了实现这一点，我通常使用前缀“uxSomeControlName”来制作控件的 ID。这样，当我在寻找那个文本框来获取它的文本值时，我所要做的就是输入“ux”并显示所有用户界面 ID。无需搜索 txt、ddl、grd 或其他任何内容。

现在这是正确的，如果您阅读上述内容，则不。但是当我只需要知道两个字母时，我不想坐下来尝试记住十几个或更多控件名称。

就像我说的，这只是在前端工作时。

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2009-08-17T08:17:14.827

我一直都在使用它，但这可能是因为我将 VBA 与 Access 和 Excel 一起使用。

对我来说 CountAll 是一个名字 intCountAll 是一个有这个区别的名字，它额外描述了这个名字（从来没有打算为机器只用于人类），比如 sintCountAll 告诉我它的静态 pintCountAll 私有和 gintCountAll 全局所以为了我使用它的目的；它非常有用。

*   控制名称是一个更安全的时间，而不是 ControlName 我有 lblControlName、txtControlName、cboControlName、lstControlName 等，所以当我使用 VBA 时，我只需输入 lst 并且我有我需要的所有名称，所以我不必记住确切的名称是什么这为我节省了很多时间，但这主要是 Access 和 Excel 中的 VBA。

问候埃米尔

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2008-11-21T16:04:42.370

我会为 C# 考虑的唯一前缀是 _ 用于成员变量，例如

```
public class Test
{
    private int _id;
} 
```

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2008-11-21T16:09:58.943

我想说的是，在当今大多数类型有限的语言中——特别是没有无符号类型的概念——那么一个命名良好的变量不应该需要前缀。

在具有有符号和无符号类型的语言中，或大量类似类型（例如，short、int、long 或 Int8、Int16、In32）中，前缀是有用的，尽管其他人已经或将要说什么（他们会，你知道它）。

当您尝试在表达式中混合不同符号的整数类型时，编译器最多会发出警告，例如，如果您将 IDE 配置为仅在构建中显示错误（而不是警告），则很容易错过这一点最后的总结（就像你可以用 Visual Studio 做的那样）。在算术中混合符号会严重破坏你的一天，所以不要让你或你的继任者头疼，并给他们一个线索。记住——你不是唯一一个会查看代码的人。

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2008-11-21T17:50:39.957

一个不存在的问题的解决方案。

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2008-11-21T18:39:55.410

虽然今天许多程序员都放弃了它，但在某些情况下我仍然会使用它。这里是其中的一些;

*   如果您正在维护已经使用它的代码，那么我会继续使用它。

*   当您的公司风格指南仍然需要甚至建议时。

*   当您的文档有一个简单的按字母数字排序的变量列表时，它有助于对类似类型进行分组。

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2008-11-21T20:35:03.777

我有时会使用一种前缀，其中 pName 是传递给我的函数的参数（注意我没有为类型添加前缀），oName 是我当前方法的本地，mName 是我所在类的成员，cName 是常量或静态只读成员。

我个人觉得它有帮助。

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2009-05-06T20:37:06.837

最简洁的答案是不。但...

我看到了摆脱匈牙利符号的意义，我们商店的标准也禁止它，但我仍然发现它在我的一次性或小型实用程序项目中很有用，原因只有一个：当我编码到一个Web 或 win 表单中的大量控件，使用 HN 可以轻松使用 Intellisense 确保我在编码时捕获每个控件。

如果我有五个复选框，并且它们的名称都以 chk 开头，那么输入 chk 会给我每个复选框的列表，我可以轻松地选择我正在处理的那个。

另外，有时我发现自己想知道“那个复选框又叫什么名字了？” 我不得不中断并再次查看 .ASPX 页面。

我妥协的一种方法是从 HN 开始，然后一旦我完成了 win 或 web 表单中的主要代码，我的最后一步是对 HN 命名的控件进行全局重命名。这实际上对我来说效果很好。YMMV，当然。

* * *

## 回答 #29

> 赞同：-1
> 
> 时间：2008-11-21T16:03:26.337

不，如果您的方法太长以至于您无法在使用的同时阅读定义，或者名称不暗示类型，那么您将面临比命名更严重的设计问题。

但是，我坚持要使用它们的类型为控件添加前缀，例如 txtName。

# generics - 为什么泛型称为泛型？

> ID：309206
> 
> 赞同：22
> 
> 时间：2008-11-21T15:58:04.833
> 
> 标签：generics, language-agnostic, semantics

冒着成为农村白痴的风险，有人可以向我解释为什么泛型被称为泛型吗？我了解它们的用法和好处，但是如果[泛型的定义](http://dictionary.reference.com/browse/generic)是“通用的”并且泛型集合是类型安全的，那么为什么这不是用词不当呢？

例如，一个 ArrayList 可以包含任何对象：

```
ArrayList myObjects = new ArrayList();
myObjects.Add("one");
myObjects.Add(1); 
```

而字符串类型的通用集合只能保存字符串：

```
var myStrings = new List<string>();
myStrings.Add("one");
myStrings.Add("1"); 
```

我只是不清楚为什么它被称为“通用”。如果答案是“......这使得设计类和方法成为可能，这些类和方法可以推迟一种或多种类型的规范，直到类或方法被客户端代码声明和实例化。” 从[这里开始](http://msdn.microsoft.com/en-us/library/512aeb7t(VS.80).aspx)，我想这是有道理的。也许我有这种心理失误，因为我是在 Java 引入泛型之后才开始编程的，所以我不记得它们之前的时间。但是还是...

任何帮助表示赞赏。

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-11-21T16:01:27.697

“通用”正在谈论实施。您编写一个适用于任何类型的“通用”列表实现，而不必为要使用的每种类型编写特定的实现。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-11-24T23:15:31.110

我认为此类问题的正确答案几乎总是“主要是历史原因”。泛型也可以被称为“方案”或“类”或“类型族”或“类”或“类型函数”或“静态”或“希腊类型”或其他一百万种事物中的任何一种。很久以前，有人决定使用“通用”这个词，但它卡住了。

Java 意义上的“通用”至少可以追溯到 1970 年代中期。美国国防部正在为其新的编程语言（后来的 ADA）编写一份需求文档。早期的草稿（[“木人”](http://www.iment.com/maida/computer/requirements/woodenman.htm#sb.8)，1975 年 8 月）说：

> 可扩展语言中需要编译时间参数，以允许规范通用过程和数据结构（例如堆栈和队列），而无需对每种元素类型重复定义。

这是文档中“通用”的唯一用法。我不清楚它是如何打算的。但是到了 1977 年 7 月（[“Tinman”](http://www.iment.com/maida/computer/requirements/ironman.htm#s12.)），有一整段是关于泛型的，而且这个术语显然已经有了特定的含义：

> 12D。通用定义
> 
> 应该可以定义函数、过程和带有参数的类型，这些参数在每次调用的翻译过程中被实例化。此类参数可以是任何已定义的标识符（包括用于变量、函数或类型的标识符）、表达式或语句。与所有其他参数一样，这些参数应在调用的上下文中进行评估。

到 1978 年 6 月（[“Steelman”](http://www.iment.com/maida/computer/steel/steelman.htm)），它成立了行话；在文件的其他部分中，"通用"一词还有其他用途，明确提到了这一特征。在完成的语言中，`generic`是一个保留字。

这些文件的作者都列在网站上，而且大概大多数人都还在。打电话给他们并询问他们记得什么会很好。

* * *

我在学术界发现的最早与“泛型”相关的用法是在 Robin Milner 的[“编程中的类型多态性理论”](http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.67.5276)（1978 年）中（他觉得有必要解释他所说的“泛型”是什么意思，所以它不能有当时在学术界普遍使用）：

> 所以这是*map*的泛型类型，也就是说，在这个声明的范围内任何出现的*map*都必须分配这个类型的一些替换实例。

“泛型类型变量”成为 CS 行话。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-11-24T23:26:43.043

```
bool Equals(int x, int y) 
```

上面的方法只能比较整数，所以可以说它是*专门*用于比较整数的。

```
bool Equals<T>(T x, T y); 
```

上面的方法可以比较任何类型的值，所以我们可以说它不是*专门*针对任何特定类型的——它是*通用*的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-21T16:01:27.180

我不想进入语言的语义（英语，而不是 java），并冒着用重言式回答你的风险；泛型方法称为泛型，因为正如您所说，它可以在一般意义上使用，它没有特定类型，可以普遍使用

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-21T16:04:39.390

好的，对此持保留态度，因为我***完全***在猜测，但我想知道它是否可能是“生成类型”的混蛋。

从概念上讲，当您将 List 特化为 List<String> 时，它会生成一个新类型。至少，这是它在 C++ 模板和 C# 泛型中的工作方式。

在 Java 中，由于编译器使用类型擦除丢弃了参数化，它实际上***并没有***生成新的专用类型，所以谁知道呢？

我想你可以说 Java 实现了生成类型的泛型版本:)

* * *

编辑：

这是另一种观点...

当他们引用“通用”类型时，类型 List< String > 并不是他们所说的。我认为该术语实际上是指 List< T > 类型，这就是该类型以其通用形式存在的方式。List< String > 是泛型 List< T > 的特化。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-21T16:00:49.150

如果他们称其为“类型参数”，人们会将其与 Type 类型的参数混淆。

此外， ArrayList 不是“通用的”。它仅适用于对象类型。如果你向它提出要求，它会给你一个对象引用。这是一种非常具体的行为。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-21T16:02:07.587

接受对象的类不是泛型的，它非常具体地采用本身就是泛型类型的类型*。*另一方面，泛型类可以与任何特定类型一起使用。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-21T16:02:07.803

因为您正在创建能够以相同方式对任何类型（在您指定的约束范围内）进行操作的“通用”代码......

您熟悉的一个很好的例子是 Add 运算符几乎可以用于任何语言......它可以“添加”整数、浮点数、双精度数、小数、二进制、十六进制，无论它们是否有符号、无符号、有多少位， ETC...

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2008-11-21T16:01:05.497

我不是“母语”英语演讲者，所以我可能是错的，但“泛型”的重点是定义泛型类型，不是吗？

# xml - XQuery（或 XPath）是否具有更新、插入和删除以及选择的等价物？

> ID：309212
> 
> 赞同：9
> 
> 时间：2008-11-21T16:00:09.040
> 
> 标签：xml, xslt, xpath, xquery

我知道如何使用 XPath 从 XML 中找到我需要的东西。语法需要一点时间来适应，但它非常强大。我也对学习 XQuery 很感兴趣，但是类似 SQL 的语法似乎很尴尬。即便如此，如果它不仅可以提供 select 等效项，还可以像 SQL 那样提供更新、插入和删除，我会原谅所有的尴尬。

那么，XQuery 是否具有 Update、Insert、Delete 和 Select 的等价物？

XPath 是否有我忽略的这些等价物？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-11-22T20:28:00.233

没有[**。XPath**](http://www.w3.org/TR/xpath20/)或[**XQuery**](http://www.w3.org/TR/xquery/)都没有类似 SQL 的更新/插入/删除功能。

您需要寻找“ [**XQuery 1.0 Update Facility**](http://www.w3.org/TR/xquery-update-10/) ”的实现。

目前（2008 年 11 月），已知三个这样的：

1.  [**SaxonSA X​​SLT 和 XQuery 处理器**](http://www.saxonica.com/)— [**Michael Kay**](http://en.wikipedia.org/wiki/Michael_Kay_(software_engineer))；从 9.1 版开始支持，但仅限于商业版。
2.  [**MonetDB/XQuery -**](http://monetdb.cwi.nl/XQuery/) [**MonetDB**](http://monetdb.cwi.nl/Home/index.html)关系数据库系统之上的开源 XQuery 处理器
3.  [**XQilla**](http://xqilla.sourceforge.net/) - 一个开源 ( [ASL2.0](http://www.apache.org/licenses/LICENSE-2.0.html) ) XQuery 处理库，支持最新的 XQuery 更新功能。XQilla 是用 C++ 编写的，包括一个命令行可执行 shell，用于对存储在本地文件系统上的 XML 内容执行查询。该库是积极开发的，是受支持的 Oracle 产品[Berkeley DB XML](http://www.oracle.com/database/berkeley-db/xml/)的一部分。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-11-21T16:11:40.407

查看[XQuery Update Facility](http://www.w3.org/TR/xquery-update-10/)，查看[XQuery 用例](http://www.w3.org/TR/xquery-update-10-use-cases/)或查看[XML Query 工作组](http://www.w3.org/XML/Query/)页面。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-12-13T21:05:33.207

在 SQL Server 2005/8 中，XQuery 的扩展称为[XML DML](http://msdn.microsoft.com/en-us/library/ms177454.aspx)，并且支持使用语句的[替换值来修改数据。](http://msdn.microsoft.com/en-us/library/ms190675.aspx)

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-11-21T16:14:43.660

XPath 是一种用于寻址 XML 文档部分的语言。所以它不能有任何 DML 语句。根据定义，它是 select 语句。

# msbuild - 如何将 MSBuild .proj 文件添加到我的解决方案？

> ID：309255
> 
> 赞同：3
> 
> 时间：2008-11-21T16:08:05.653
> 
> 标签：msbuild

有谁知道如何将 MSBuild .proj 文件添加到我的解决方案中？

我刚刚从供应商那里获得了现有代码，其解决方案引用了 MSBuild .proj 文件作为其项目之一。当我打开解决方案时，项目显示为（不可用）。看来我需要安装某种项目模板才能正确打开该项目。我安装了[Codeplex MSBuild Template](http://www.codeplex.com/MSBuildTemplate)，但这似乎不是。

有任何想法吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2011-07-25T21:52:19.543

如果您不需要 IDE 支持，则可以使用 MSBuild 解决方案扩展目标来执行此操作。

使用以下代码创建一个名为“before.SolutionName.sln.targets”的文件：

```
<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <ItemGroup>
    <ProjectReference Include="CustomProject\CustomProject.proj">
      <AdditionalProperties>Configuration=$(Configuration); Platform=AnyCPU</AdditionalProperties>
      <Configuration>$(Configuration)</Configuration>
      <Platform>AnyCPU</Platform>
    </ProjectReference>
  </ItemGroup>
</Project> 
```

当您的解决方案由 MSBuild（即/构建服务器）在命令行构建时，自定义 MSBuild 项目将被拉入 MSBuild 将解决方案转换为的临时内存项目文件中。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-21T16:14:05.800

我真的让它工作了！我重新启动了 Visual Studio，但在安装了上面提到的 MSBuild 模板后，仍然看到项目不可用。我不得不手动重新加载项目。这解决了这个问题。

# java - 如何在 Struts 动作类中设置 tile 的 body URL？

> ID：309283
> 
> 赞同：0
> 
> 时间：2008-11-21T16:13:52.913
> 
> 标签：java, struts, tiles

我正在使用带有瓷砖的 struts 1.1。

我有像这样定义的瓷砖

```
<definition name="cnmp.body.index" extends="cnmp.mainLayout" >
  <put name="title"  value="CNM Portal" />
  <put name="bodytitle"  value="Home" />
  <put name="body"   value="/00-CNM_Landing.jsp" />
</definition> 
```

我希望能够在我的 java Action 类中设置 body 参数的值。我会从 ActionMapping 或 ActionForm 中得到什么来做到这一点？

```
public class TileForwardAction extends Action
{
public ActionForward execute(ActionMapping mapping, ActionForm arg1,
        HttpServletRequest arg2, HttpServletResponse arg3) throws Exception
{
    return mapping.findForward("theTile");           
}
} 
```

struts 配置文件看起来像

```
 <action-mappings>

  <action   path = "/index"
            type = "com.bellsouth.snt.cnmp.ui.action.TileForwardAction"
            scope = "request"
            input = "cnmp.body.index"
            parameter= "theTile"
    >    
      <forward name="theTile" path="cnmp.body.index"/>       
  </action> 
```

谢谢

* * *

受公认答案的启发，我想出了以下解决方案

在 tile def 中定义的页面中，我有以下内容

```
<% String destAttr=(String)request.getAttribute("dest"); %>

<jsp:include page="<%=destAttr%>" flush="true" /> 
```

在动作课中（因为我很懒）我有以下

```
 request.setAttribute("dest", "landingB.jsp"); 
```

它奏效了。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-05T00:50:07.497

您可能想要查看对控制器类的磁贴支持。瓷砖 def 条目看起来像这样：

```
<definition 
  name="cnmp.body.index" 
  extends="cnmp.mainLayout"
  controllerClass="org.yourpackage.YourControllerClass">
  <put name="title"  value="CNM Portal" />
  <put name="bodytitle"  value="Home" />
  <put name="body"   value="/00-CNM_Landing.jsp" />
</definition> 
```

然后 YourControllerClass 将实现 perform() 方法，如：

```
public class YourControllerClasss implements Controller
    public void perform(ComponentContext context,
      HttpServletRequest request,
      HttpServletResponse response,
      ServletContext servletContext)
      throws ServletException, IOException {

      //some logic to determine what the 'body' should be

      if (service.isUp()){
        request.setAttribute("nameOfJSPToImport", "/jsps/import-me.jsp");
      }else{
        request.setAttribute("nameOfJSPToImport", "/jsps/import-me-instead.jsp");
      }

    }
} 
```

上面的示例可以直接在您的操作中完成，而无需使用 TilesController，但 TilesController 可以帮助您减少操作的混乱。无论技术如何，总体目标都是参数化 NM_Landing.jsp，然后实际更改定义的“body”属性正在使用的 jsp。例如，NM_landing.jsp 可能只是包含调用类似

```
<c:import url="${nameOfJSPToImport}" /> 
```

# c# - 对象转储程序/单元测试

> ID：309286
> 
> 赞同：2
> 
> 时间：2008-11-21T16:14:05.923
> 
> 标签：c#, unit-testing

我目前正在编写一个对象转储器（允许不同的转储策略）。

当然，我想编写单元测试来验证我将开发的内容是否符合我期望的所有功能。

但是，我无法想象我将如何对此解决方案进行测试。我考虑过创建一组对象，这些对象可以保存每个属性被访问的次数。似乎几乎没问题。但是我怎样才能验证他们的公共领域已经被访问了呢？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-21T16:26:09.503

你为什么要明确关心属性被访问了多少次等？我只是测试输出是否符合预期。如果出于某种原因需要采用一种特定策略（例如，字段而不是属性），那么可能有一种简单的测试方法（例如，使属性返回大写版本）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-21T17:37:33.353

我将专注于验证输出而不是验证是否访问了属性。我可能会读取一个属性，但不能正确转储它，对吧？

这是一个测试结果而不是测试实现的示例。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-21T20:16:10.507

您只需要测试转储的值是分配给属性/公共字段的值。只需确保为每个属性/字段分配不同的值。

# c# - 在 C# 异常处理程序中，我可以找到传递给引发异常的方法的参数吗？

> ID：309291
> 
> 赞同：5
> 
> 时间：2008-11-21T16:14:50.367
> 
> 标签：c#, exception

我正在为一个相当复杂的分层系统编写一个错误处理模块。有时我们的数据层会抛出模糊的异常。

注销引发异常的方法的参数*值会非常方便。*

我可以反映异常的 TargetSite 属性来查找方法的参数类型和名称，但我似乎无法获取值......我错过了什么吗？

* * *

欺骗

[在 .net 异常中如何获取带有参数值的堆栈跟踪](https://stackoverflow.com/questions/157911/in-a-net-exception-how-to-get-a-stacktrace-with-argument-values)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-21T16:24:02.033

内置框架 ArgumentOutOfRangeException （如果传入的参数...超出范围...具有导致错误的方法参数的私有字段和公共属性...当您创建此异常时，您应该抛出一个方法，你在ctor中传递参数值......

```
throw new ArgumentOutOfRangeException(string parameterName, 
           object actualValue, string message); 
```

对于其他异常，如果您在抛出异常的方法中捕获异常，并将其包装在您自己的自定义异常中，该异常具有这些方法参数的附加字段和属性

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-21T16:22:55.203

简而言之……不。由于某些原因，请参阅有关[捕获方法状态](https://stackoverflow.com/questions/168396/capturing-method-state-using-reflection#168421)的此问题。

# linux - 如何将 Linux 内核编译并安装到 ARM 套件中

> ID：309292
> 
> 赞同：2
> 
> 时间：2008-11-21T16:15:27.810
> 
> 标签：linux, embedded, arm, xenomai

我身边有一个 ARM 套件，我的机器上有一个用 Xenomai 修补的 Linux 内核源代码。我知道我可以通过 USB 电缆和（当然是基于 Windows 的）软件将数据发送到套件，但我不*知道*我应该发送什么才能使套件运行 Linux。

（评论澄清：这是一个 Atmel AT91SAM9260-EK 套件。它使用 SAM-BA 和 SAM-PROG 通过串行或 USB 电缆加载和卸载数据。）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-21T16:47:12.613

您可能想查看一些交叉编译器，例如[OpenEmbedded](http://wiki.openembedded.net/index.php/Main_Page)，它将帮助您为 ARM 架构编译内核。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-21T21:26:58.040

我将从 Atmel 的 ATM91SAM9 Linux 软件包开始，然后按照说明进行操作。

链接：

[http://www.atmel.com/dyn/products/tools_card.asp?tool_id=4335](http://www.atmel.com/dyn/products/tools_card.asp?tool_id=4335)

否则，您需要在 Linux 机器上使用 ARM 后端设置 GCC，构建 Linux 二进制文件，然后弄清楚如何将其加载到开发板上。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-21T21:35:20.283

我建议使用 jtag 和 openOCD，然后您只需使用 JTAG 将文件系统和内核映像放在闪存中，在我们的引导加载程序可以找到的地方。您可能需要更改引导加载程序。另一种选择是您可以启动您的微型计算机，然后将引导加载程序插入程序的 RAM，然后将程序计数器更改为指向它。该引导加载程序可以初始化 UART/USB，然后您就有一个传输文件的主机端程序。这种方法非常复杂，通常只有在您不想在 jtag 上花费 100 美元时才有用（提示，购买一个有用的 jtag）

# dbase - DBase 索引

> ID：309296
> 
> 赞同：0
> 
> 时间：2008-11-21T16:16:04.377
> 
> 标签：dbase

dbf文件中第一条记录的索引值是0还是1？索引是从零开始的吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-23T18:02:42.723

DBF 总是基于计数的。我不确定你在追求什么，但鉴于这个事实，我不得不说 1。记录 1 = 表中的第一条记录，而不是记录 0。转到 0 表示转到顶部。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-21T16:24:08.120

我不确定，但这可能会给你一个线索。

[http://www.dbase.com/knowledgebase/int/db7_file_fmt.htm](http://www.dbase.com/knowledgebase/int/db7_file_fmt.htm)

> 1.3.1 标准属性和约束描述符数组
> 
> > 表字段偏移量 - 基数为 1。01 表示表中的第一个字段，02 表示第二个字段，依此类推。注意：在约束的情况下，这将为 0。

# regex - 帮助修改 RegEx 以返回数字范围

> ID：309303
> 
> 赞同：0
> 
> 时间：2008-11-21T16:16:56.153
> 
> 标签：regex

当前`"I ([a-zA-z]\d]{3} "`，当以下模式为真时，此表达式返回：

```
我 AAA
我Z99

```

我需要修改它，以便它会在 I 之后返回一系列字母数字，从 2 到 13，没有空格。

例子：

```
我 AAA
我A321
我ASHG310310

```

谢谢，

戴夫

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-21T16:20:48.797

没有引号：

```
“我（[a-zA-Z\d]{2,13}）”

```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-21T16:24:27.743

{} 括号允许使用逗号分隔的两个参数，表示最小和最大重复次数。另外，我不确定您的原始正则表达式是否符合您的意图 - 正如它所写的那样，它接受 3 组字母和数字。

你可能想试试

```
I ([a-zA-Z]|\d){2,13} 
```

这里有一个参考页面：[http ://www.regular-expressions.info/reference.html](http://www.regular-expressions.info/reference.html)

# php - 考虑 ATK 框架

> ID：309304
> 
> 赞同：1
> 
> 时间：2008-11-21T16:17:11.690
> 
> 标签：php, frameworks

有人用过 ATK 框架吗？据称它旨在开发用于商业用途的应用程序。操作数据、知识库等……这是我主要开发的（在一边——供我自己使用）。该网站没有给我一个很好的概述为什么它可能比其他框架更好。

你对这个产品有什么想法/经验？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2010-06-17T21:45:22.707

首先，让我说我现在使用 ATK 才几天，而我的同事已经使用了将近 6 个月。
ATK 框架确实是非常优秀的框架——但具有非常特殊的用途。
如果您正在寻找帮助您构建管理面板的框架 - ATK 将为您节省大量时间。您只需编写几行代码即可构建完整且非常好的管理面板。
我唯一不喜欢这个框架的是你不能真正控制一切（事情在幕后发生）以及它不支持 UNIX TIMESTAMPS 的事实（我试图生成日期字段但是它不想接受时间戳所以我不得不改变一些东西，添加一个类）。
ATK 社区真的很棒，在我的同事的帮助下——我在 3 小时内就学到了很多关于这个框架的东西。
**但是**，如果您正在寻找通用框架来对整个站点进行编码 - 您可能希望避免使用这个。
就个人而言，我将（很快）使用 ATK+Zend 框架组合 - ATK 用于后端，Zend 用于前端。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2011-08-09T21:06:44.557

ATK 是一个很棒的框架。我用它来创建[MySHI](http://sourceforge.net/apps/mediawiki/myshi/index.php?title=Main_Page)。一个开源项目，我在 2008 年花了一些时间。我还没有使用 Django 构建任何东西，但已经完成了一次或两次教程。

ATK 类似于 Django 的管理界面。Django 是一个更好的通用框架。但我发现 ATK 是一个更全面的业务逻辑框架。Django 的管理界面只是用于管理网站内容的粗略后端界面，它的原始设计并不意味着作为大型数据库驱动网站的前端。

对于创建以数据为中心的数据库的 Web 界面（开箱即用），ATK 似乎更好地匹配创建完整 UI 所必需的内容。他们俩最大的问题是当你想做一些不属于框架的事情时。有时，任何一个似乎都会阻止你做你知道你应该能够做的事情。

攻击力缺点

*   小型开发团队（但反应合理）
*   缺乏营销（没有嗡嗡声）
*   小用户群（获得帮助）
*   PHP（Python 是当前的热潮，但 PHP 没有任何问题）
*   文档（有限，但在完成本教程之后，大部分内容都是 API。）

如果我今天要开始一个项目，我可能会选择其中一个。如果项目很小，表关系很少，并且我提前知道自定义用户 ui 是必要的，我会选择 Django。想想一个简单的个人银行登记簿。如果我要开始一个具有许多表关系的项目并且数据库管理员是用户界面，那么我会选择 ATK。用发票来思考客户管理。如果我要开始一个高度复杂的项目，我可能需要做一些框架架构师没有想到的事情，那么我会选择一个更通用和开放的框架，比如 Pyramid 或 Ruby on Rails（我仍然试图自己回答这个问题） . 想想电子病历。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-09T07:02:46.750

这是我用过的最好的框架..它处理所有 CRUD 功能..所以它只使用几行代码来创建一个简单的基于 Web 的系统..这个框架将驱使您了解所有开发人员需要什么来构建一个伟大的系统..您是否想要与其他工具集成..这取决于..我相信如果不努力你就不可能成为最好的..这是事实，因为我在编程论文中失败了..那么现在！我是开发者！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-08-17T10:13:33.143

几天前我刚刚下载了 ATK 框架，现在完成了我当前软件项目中的一个模块，本周将提交给我的客户。我可以说 ATK 节省了我的时间和精力。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-04-27T22:47:33.337

我们现在已经在四个项目中使用了 ATK 框架，并且总体上对该框架感到满意。它非常适合快速应用程序开发，使我们能够在几周内完成功能齐全的业务流程站点。我们成功地集成了像 Aurigma Image Uploader 这样的第三方控件来处理复杂的图像操作和管理，使用该框架来处理每个表有数百万条记录的数据库，并将数据导出例程一次扩展到数十万条记录。我们在 ATK 框架中遇到的最大问题是我们需要做的事情的文档和具体示例，这些事情不适合正常的 ATK 用例。我们已经与 iBuildings 签订了一两次合同，以进行非常具体的更改来支持我们的项目，他们的工作反应非常迅速和彻底。我们也使用了其他框架，包括 Zend Framework 和 .NET——虽然它们都有自己的优势，但我可以告诉你，我没有看到比使用 ATK 更快的方法来创建功能齐全的应用程序，但你确实牺牲了一些控制权究竟是如何在幕后完成的。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2010-04-29T16:40:35.270

我们在工作中使用 atk 框架，我必须说这是我用过的最糟糕的框架。没有什么像其他框架一样 - 没有什么像它应该和文档那样工作 - 顺便说一句。什么文件？

这不仅不好，而且完全无法使用

# constructor - DDD + 公共无参数构造函数——它们应该存在吗？

> ID：309307
> 
> 赞同：5
> 
> 时间：2008-11-21T16:18:18.053
> 
> 标签：constructor, domain-driven-design

DDD 的租户之一是不允许您的对象进入无效状态。对我来说，这意味着不应该有一个公共的无参数构造函数，因为这将是一个 99% 的时间处于无效状态的对象。

这是前进的好方法吗？当您只想快速更新课程时，它会变成一个巨大的 PITA。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-21T16:30:58.980

好问题。我有 DDD 纳粹朋友说无参数构造函数是魔鬼。我在一定程度上同意这一点，但我也觉得这取决于课程的目的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-21T19:29:27.933

正如 Kilhoffer 所说，这取决于你想在课堂上做什么。在什么情况下，您希望在不实际初始化属性的情况下新建一个类？如果您希望调用不需要任何数据的实例方法，您可以考虑将这些方法标记为静态或将这些方法移动到单独的类中。您的班级也可能有一个额外的有效状态 - 完全为空。

就个人而言，我相信一切都是适度的。如果 PITA 因子很高，并且您有理由确定不会遇到问题，那么似乎无参数构造函数就可以了。在某些时候，我认为这成为一个意见问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-18T16:39:17.330

这完全取决于谁调用了构造函数。如果只有您的工厂这样做，那么就没有真正的问题，因为您的工厂方法成为“域端”构造函数，而真正的构造函数是实现细节。

# svn - 对于 SVN 备份，“热拷贝”是否足够，还是我应该担心完整和增量转储？

> ID：309322
> 
> 赞同：8
> 
> 时间：2008-11-21T16:21:56.390
> 
> 标签：svn, backup

对于我的个人资料，我`svnadmin hotcopy`每周只使用一次该命令，但对于包含许多开发人员的任务关键型存储库，这是否足够？还是我应该花时间制定一个更严格的备份策略，包括完整备份和增量备份？

`hotcopy`似乎是最简单的方法，但如果由于某种原因它被损坏，我希望能够恢复它。只是通过转储`hotcopy`允许我这样做吗？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-11-21T20:34:39.003

您是担心 hotcopy 还是担心每周只备份一次？

即使其他进程（例如您的开发人员）同时访问该存储库，Hotcopy 也会为您的存储库生成一个安全且完整的备份。如果您仍然不信任它，请关闭对存储库的所有访问并通过使用常用文件系统工具将其复制到某处来备份它。（开发人员不会全天候工作，是吗？）

如果你担心每周一次的部分：想想如果 repo 在安排下一次备份的前一天消失会发生什么。有关系吗？如果是，请更频繁地进行备份。就是这么简单。

您的存储库是否太大而无法保存数天或数周的完整备份？实施使用完整备份和增量备份的轮换备份方案。您是否有足够的空间进行备份？省去麻烦，只需进行完整备份。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-11-21T17:18:45.233

[另一个好的策略是保留第二个 SVN 存储库并使用svnsync](http://svnbook.red-bean.com/en/1.5/svn.reposadmin.maint.html#svn.reposadmin.maint.replication)将其与主存储库同步，通常使用提交后挂钩。

主要优点是，如果第一个存储库由于某种原因出现故障，您可以立即切换到备份存储库，并继续使用它而不会停机。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-21T16:58:16.537

我利用`python`脚本为企业的 SVN 1.4.x 存储库（当时托管在 Windows 上）实施了备份计划[`svn-backup-dumps.py`](http://svn.collab.net/repos/svn/trunk/tools/server-side/svn-backup-dumps.py)

`svn-backup-dump.py`我从挂钩中调用`post-commit`以触发特定修订的增量备份。我曾经`schtasks`使用相同的脚本安排每周一次的“完整”备份。

恢复（由于粗心删除存储库中的目录，我们不得不做两次）相对简单：获取最新的完整备份，恢复它。将增量应用到最后一个修订版。

我还没有研究过 1.5 在这方面的改进/更改，但我相信类似的计划对你很有效。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-11-03T12:45:06.110

称我为老派，但是对分区进行子版本控制然后按计划重影呢？

Davide Gualano 建议的 svnsync 选项听起来也不错。我倾向于使用此选项来防止对我的驱动器进行不必要的分区（这也可能会以错误的方式影响其他管理员，并且在我的某些 VPS 环境中没有意义）。

# 添加

我最近一直在使用 svnadmin 'dump' 命令。这很像 mysql dump 命令，因为它将您的存储库导出到 bak create 命令。该命令可以实现为 crontab / 计划任务，然后作为文件复制到外部驱动器。示例命令：

```
svnadmin dump c:\svn\project > c:\dumps\project.bak

svnadmin load c:\svn\project < c:\dumps\project.bak 
```

然后使用 robocopy / 你选择的复制工具将文件移动到另一个位置。如果您想将文件完全移出 repo 服务器但没有外部访问 subverion 时，这很有用。

我还没有把它归结为一门艺术。当我在机器之间移动这些文件时，我偶尔会得到类似“UUID 不匹配”的信息。我一直在通过删除/在项目文件夹下划线来解决这个问题，然后使用：

```
svnadmin create c:\svn\project

svnadmin load c:\svn\project < c:\dumps\project.bak 
```

这应该消除错误。您可能需要重新创建或恢复与 Eclipse 或其他项目的链接。如果 UUID 被破坏，它可能也会影响使用该项目的其他人，所以这应该是一个考虑因素。

您可以将此方法用作 Hotcopy 的备用方法。在它们之间，您应该能够恢复回购。

PS Ken，看起来 svn-backup-dumps.py 已移至此处：http: [//svn.apache.org/repos/asf/subversion/trunk/tools/server-side/svn-backup-dumps.py](http://svn.apache.org/repos/asf/subversion/trunk/tools/server-side/svn-backup-dumps.py)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-24T19:23:40.250

如果您在先前未损坏的备份之上热复制损坏的存储库，那么是的，您将丢失未损坏的备份。

如果您对此感到担忧，那么正如其他人所说，您需要轮换备份。

您也可以安排自动运行“svnadmin verify”。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-11-21T16:29:12.647

过去我只靠热拷贝就运气不好。如果代码在一天中多次更新和提交，则可能值得采用更深入的备份策略。

# java - 从 Java 代码构建 exe 的最佳免费工具？

> ID：309329
> 
> 赞同：10
> 
> 时间：2008-11-21T16:23:41.927
> 
> 标签：java, deployment, exe

> **可能重复：**
> [如何将我的 java 程序转换为 .exe 文件？](https://stackoverflow.com/questions/147181/how-can-i-convert-my-java-program-to-an-exe-file)

我过去使用过 JSmoothGen，但最近我们看到许多机器拒绝运行它生成的 .exe。它似乎也不再被积极维护。

有没有更积极维护和更可靠的替代方案？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-21T16:30:23.113

我使用支持 Windows、Mac 和 Linux 的[Launch4J 。](http://launch4j.sourceforge.net/)我建议放弃有点不稳定的 GUI 工具，自己编写（简短、易读的）配置文件。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-21T16:25:55.383

gnu 编译器 gcj

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-21T16:56:09.240

我发现这篇文章信息量很大[http://www.excelsior-usa.com/articles/java-to-exe.html](http://www.excelsior-usa.com/articles/java-to-exe.html)。

有人已经提到[了 Launch4j](http://launch4j.sourceforge.net/)，但是，我发现[Jsmooth](http://jsmooth.sourceforge.net/)更好一点。它们都非常相似，但我会弄乱两者，看看你更喜欢哪个。

编辑：对不起，我不知何故略过了你在问题中提到的 Jsmooth。如果 Jsmooth 不适合您，那么我会选择 Launch4j。我仍然推荐那篇文章。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-22T06:34:37.137

[http://sourceforge.net/projects/javaround](http://sourceforge.net/projects/javaround)

高温高压

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-11-21T21:14:34.053

也不是完全需要制作 .exe。至少在 Windows 上，只要安装了 Java 运行时并且在机器上设置了 .jar 扩展名，.jar 文件就可以执行。

[注意：我刚刚发现某些东西破坏了以前对我有用的文件关联。它现在仅在我是管理员时才有效，否则 JAR 图标甚至会消失。我假设最近的一些安装已经搞砸了，候选者是 (1) OpenOffice.org 3.0，(2) WinRAR，或 (3) Java 更新下载。但是，当关联工作时，以下所有工作都有效。]

“程序”Clicker.jar 在以下情况下作为 Java 应用程序运行：(1) 我在 Windows 资源管理器窗口中双击它，(2) 当我在同一目录中创建控制台 shell 并执行命令“ >Clicker.jar" (3) 当我将快捷方式发送到我的桌面并双击它时，以及 (4) 当我将完整路径放入 Windows XP Run ... 框中时。

我不知道这些会在 PATH 搜索中找到，而且我通常不会安排。

# c# - 来自值的枚举字符串名称

> ID：309333
> 
> 赞同：510
> 
> 时间：2008-11-21T16:24:08.167
> 
> 标签：c#, enums

我有一个这样的枚举构造：

```
public enum EnumDisplayStatus
{
    None    = 1,
    Visible = 2,
    Hidden  = 3,
    MarkedForDeletion = 4
} 
```

在我的数据库中，枚举是按值引用的。我的问题是，如何将枚举的数字表示转回字符串名称。

例如，给定`2`结果应该是`Visible`.

* * *

## 回答 #1

> 赞同：661
> 
> 时间：2008-11-21T16:25:37.303

您可以`int`使用简单的强制转换将背面转换为枚举成员，然后调用`ToString()`：

```
int value = GetValueFromDb();
var enumDisplayStatus = (EnumDisplayStatus)value;
string stringValue = enumDisplayStatus.ToString(); 
```

* * *

## 回答 #2

> 赞同：222
> 
> 时间：2012-12-14T13:07:39.473

如果您需要在`"Visible"`不获取`EnumDisplayStatus`实例的情况下获取字符串，您可以这样做：

```
int dbValue = GetDBValue();
string stringValue = Enum.GetName(typeof(EnumDisplayStatus), dbValue); 
```

* * *

## 回答 #3

> 赞同：186
> 
> 时间：2012-01-02T09:00:20.023

试试这个：

```
string m = Enum.GetName(typeof(MyEnumClass), value); 
```

* * *

## 回答 #4

> 赞同：76
> 
> 时间：2018-06-14T20:44:00.710

用这个：

```
string bob = nameof(EnumDisplayStatus.Visible); 
```

* * *

## 回答 #5

> 赞同：33
> 
> 时间：2020-01-16T21:03:55.347

使用`nameof` [表达式](https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/operators/nameof)的最快的编译时间解决方案。

返回枚举的文字类型大小写，或者在其他情况下，返回 a `class`、`struct`或*任何类型*的`variable`（arg、param、local 等）。

```
public enum MyEnum {
    CSV,
    Excel
}

string enumAsString = nameof(MyEnum.CSV)
// enumAsString = "CSV" 
```

**笔记：**

*   你不想用完全大写的形式命名一个枚举，而是用来证明`nameof`.

* * *

## 回答 #6

> 赞同：27
> 
> 时间：2008-11-21T16:26:36.647

你可以投

```
int dbValue = 2;
EnumDisplayStatus enumValue = (EnumDisplayStatus)dbValue;
string stringName = enumValue.ToString(); //Visible 
```

啊..肯特打败了我：）

* * *

## 回答 #7

> 赞同：18
> 
> 时间：2019-02-22T08:39:59.597

**解决方案：**

```
int enumValue = 2; // The value for which you want to get string 
string enumName = Enum.GetName(typeof(EnumDisplayStatus), enumValue); 
```

此外，使用**GetName**比**Enum 的显式转换**更好。

**[性能基准代码]**

```
Stopwatch sw = new Stopwatch (); sw.Start (); sw.Stop (); sw.Reset ();
double sum = 0;
int n = 1000;
Console.WriteLine ("\nGetName method way:");
for (int i = 0; i < n; i++) {
   sw.Start ();
   string t = Enum.GetName (typeof (Roles), roleValue);
   sw.Stop ();
   sum += sw.Elapsed.TotalMilliseconds;
   sw.Reset ();
}
Console.WriteLine ($"Average of {n} runs using Getname method casting way: {sum / n}");
Console.WriteLine ("\nExplicit casting way:");
for (int i = 0; i < n; i++) {
   sw.Start ();
   string t = ((Roles)roleValue).ToString ();
   sw.Stop ();
   sum += sw.Elapsed.TotalMilliseconds;
   sw.Reset ();
}
Console.WriteLine ($"Average of {n} runs using Explicit casting way: {sum / n}"); 
```

**[样本结果]**

```
GetName method way:
Average of 1000 runs using Getname method casting way: 0.000186899999999998
Explicit casting way:
Average of 1000 runs using Explicit casting way: 0.000627900000000002 
```

* * *

## 回答 #8

> 赞同：15
> 
> 时间：2008-11-21T16:29:19.933

数据库到 C#

```
EnumDisplayStatus status = (EnumDisplayStatus)int.Parse(GetValueFromDb()); 
```

C# 到数据库

```
string dbStatus = ((int)status).ToString(); 
```

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2018-11-29T12:44:51.563

只需要：

```
string stringName = EnumDisplayStatus.Visible.ToString("f");
// stringName == "Visible" 
```

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2019-04-11T05:11:18.473

获取字符串值 [Name]：

```
EnumDisplayStatus enumDisplayStatus = (EnumDisplayStatus)GetDBValue();
string stringValue = $"{enumDisplayStatus:G}"; 
```

并获取枚举值：

```
string stringValue = $"{enumDisplayStatus:D}";
SetDBValue(Convert.ToInt32(stringValue )); 
```

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2019-07-11T06:48:24.110

我使用了下面给出的这段代码

```
 CustomerType = ((EnumCustomerType)(cus.CustomerType)).ToString() 
```

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2008-11-21T16:27:12.247

只需将 int 转换为枚举类型：

```
EnumDisplayStatus status = (EnumDisplayStatus) statusFromDatabase;
string statusString = status.ToString(); 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2021-09-17T17:07:03.410

你可以试试这个

```
string stringValue=( (MyEnum)(MyEnum.CSV)).ToString(); 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2022-02-12T10:07:41.910

鉴于：

```
enum Colors {
    Red = 1,
    Green = 2,
    Blue = 3
}; 
```

在 .NET 4.7 中，以下

```
Console.WriteLine( Enum.GetName( typeof(Colors), Colors.Green ) );
Console.WriteLine( Enum.GetName( typeof(Colors), 3 ) ); 
```

将显示

```
Green
Blue 
```

在 .NET 6 中，上述内容仍然有效，但也：

```
Console.WriteLine( Enum.GetName( Colors.Green ) );
Console.WriteLine( Enum.GetName( (Colors)3 ) ); 
```

将显示：

```
Green
Blue 
```

# language-features - 你希望哪些功能是通用语言？

> ID：309334
> 
> 赞同：7
> 
> 时间：2008-11-21T16:24:19.193
> 
> 标签：language-features

你希望哪些功能是通用语言？更准确地说，我的意思是通常根本不存在但很高兴看到的功能，而不是“我希望动态类型很流行”。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-21T16:35:08.377

我经常认为“可观察”会成为一个很好的字段修饰符（如公共、私有、静态等）

```
GameState {
   observable int CurrentScore;
} 
```

然后，其他类可以声明该属性的观察者：

```
ScoreDisplay {
   observe GameState.CurrentScore(int oldValue, int newValue) {
      ...do stuff...
   }
} 
```

编译器将使用通知代码包装对 CurrentScore 属性的所有访问，并在值修改后立即通知观察者。

当然，您可以在大多数编程语言中使用事件侦听器和属性更改处理程序做同样的事情，但这是一个巨大的痛苦，需要大量零碎的管道，特别是如果您不是您想要其值的类的作者观察。在这种情况下，您通常必须编写一个包装子类，将所有操作委托给原始对象并从 mutator 方法发送更改事件。为什么编译器不能生成所有愚蠢的样板代码？

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-21T16:32:59.223

我想最明显的答案是类似 Lisp 的宏。能够用你的代码处理你的代码是一种奇妙的“元”，并且允许从（几乎）从头开发一些非常令人印象深刻的功能。

紧随其后的是 C++ 等语言中的双重或多重分派。如果多态性可以扩展到虚函数的参数，我会喜欢它。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-11-21T16:45:15.503

我希望更多的语言拥有像 Haskell 这样的类型系统。Haskell 使用了一个非常棒的[类型推断](http://en.wikipedia.org/wiki/Type_inference)系统，所以你几乎不需要*声明*类型，但它仍然是一种强类型语言。

我也很喜欢你在 Haskell 中声明新类型的方式。我认为它比例如面向对象的系统要好得多。例如，要在 Haskell 中声明二叉树，我可以执行以下操作：

```
data Tree a = Node a (Tree a) (Tree a) | Nothing 
```

所以复合数据类型更像是代数类型而不是对象。我认为它使对程序的推理变得容易得多。

另外，在类型类中混合要好得多。类型类只是类型实现的一组类——有点像 Java 等语言中的接口，但更像是 Ruby 等语言中的 mixin，我猜。这有点酷。

理想情况下，我希望看到一种像 Python 这样的语言，但使用像 Haskell 这样的数据类型和类型类而不是对象。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-11-21T17:05:27.163

我是闭包/匿名函数的忠实粉丝。

```
my $y = "world"; 

my $x = sub {  print @_ , $y }; 

&$x( 'hello' );  #helloworld 
```

和

```
my $adder = sub {
    my $reg = $_[0];
    my $result = {};
    return sub { return $reg + $_[0]; }
};

print $adder->(4)->(3); 
```

我只是希望它们更普通。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-11-21T17:24:50.477

我想念其他语言的 Lisp 中的东西：

*   多个返回值
*   函数的必需、关键字、可选和剩余参数（可自由混合）
*   用作一流的对象（如今变得越来越普遍）
*   尾调用优化
*   作用于语言而不是文本的宏
*   一致的语法

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2012-05-27T02:39:13.593

`immutable`关键词。是的，你可以制作不可变的对象，但在大多数语言中这很痛苦。

```
class JustAClass 
{
    private int readonly id;   
    private MyClass readonly obj;
    public MyClass 
    { 
        get 
        {
            return obj;
        }
    }
} 
```

显然它似乎`JustAClass`是一个不可变的类。但事实并非如此。因为另一个对象持有相同的引用，可以修改该`obj`对象。

所以最好引入新的`immutable`关键字。何时`immutable`使用该对象将被视为不可变的。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-11-21T16:25:40.970

首先，如果您想使用转义码，我希望字符串的标准是使用前缀，而不是默认使用它们。例如，在 C# 中，您可以为原始字符串添加 @ 前缀。同样，Python 有 r 前缀。当我不想要原始字符串并且需要转义码时，我宁愿使用 @/r。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-11-21T18:38:31.560

实际上*设计*用于元编程的更强大的模板，而不是真正为相对简单的泛型而设计的 C++ 模板，并且几乎是偶然地图灵完备的。D 编程语言有这些，但它还不是很主流。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-11-21T16:27:17.067

我喜欢 Ruby 语言中的一些数组操作功能。我希望我们有一些内置到 .Net 和 Java 中。当然，您始终可以创建这样的库，但不必这样做就好了！

此外，当您需要静态索引器时，它们也很棒。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-11-21T17:58:28.757

类型推断。它正在慢慢进入主流语言，但仍然不够好。F# 是这里的黄金标准

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-11-21T16:30:11.837

我希望有一个自反转的赋值运算符，它在超出范围时回滚。这将替换：

```
type datafoobak = item.datafoobak
item.datafoobak = 'tootle'
item.handledata()
item.datafoobak = datafoobak 
```

有了这个

```
item.datafoobar @=@ 'tootle'
item.handledata() 
```

可以明确回滚此类更改，但一旦超出范围，它们也会回滚。这种特性可能有点容易出错，但在某些情况下它也会使代码更清晰。某种浅层克隆可能是一种更有效的方法：

```
itemclone = item.shallowclone
itemclone.datafoobak='tootle'
itemclone.handledata() 
```

但是，如果它们的函数修改了它们的内部数据，那么浅层克隆可能会出现问题……尽管可逆分配也是如此。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-11-21T16:52:34.567

我想看看单方法和单操作员接口：

```
interface Addable<T> --> HasOperator( T = T + T)

interface Splittable<T> --> HasMethod( T[] = T.Split(T) ) 
```

...或类似的东西...

我设想它是鸭子类型的类型安全实现。接口不会是原始类作者提供的保证。它们是由第三方 API 的消费者做出的断言，以在原始作者没有预料到的情况下提供有限的类型安全性。

（实践中一个很好的例子是人们从一开始就在 C# 中争相使用的 INumeric 接口。）

在像 Ruby 这样的鸭式语言中，您可以调用任何您想要的方法，并且直到运行时才知道是否支持该操作，因为该方法可能不存在。

我希望能够对类型安全做出小的保证，以便我可以多态地调用异构对象上的方法，只要所有这些对象都具有我想要调用的方法或运算符。

而且我应该能够验证我想在编译时调用的方法/运算符的存在。等到运行时是傻瓜:o)

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2011-06-03T16:39:25.027

这里有几个很好的答案，但我会补充一些：

1 - 能够获取当前代码和调用者代码的字符串表示，以便我可以轻松输出变量名称及其值，或随时打印当前类、函数或堆栈跟踪的名称。

2 - 管道也不错。此功能在 shell 中很常见，但在其他类型的语言中并不常见。

3 - 能够轻松地将任意数量的方法委托给另一个类。这看起来像继承，但即使存在继承，有时我们也需要某种无法实现为子类的包装器或存根，并且转发所有方法需要大量样板代码。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-11-21T17:50:50.220

Lisp 风格的宏。

多发。

尾调用优化。

头等舱延续。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-11-21T17:53:47.237

叫我傻，但我不认为每个功能都属于每种语言。这是“万事通，无所事事”综合症。我喜欢拥有各种可用的工具，每一种工具都是针对特定任务的最佳工具。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2011-02-01T13:47:53.307

函数式函数，如 map、flatMap、foldLeft、foldRight 等。类型系统，如 scala (builder-safety)。使编译器在编译时删除高级库，同时如果您在“解释”或“较少编译”模式下运行（速度......有时您需要它）仍然拥有它们。

* * *

## 回答 #17

> 赞同：-1
> 
> 时间：2008-11-21T17:54:49.107

我想要一种限制性更强的语言，并且旨在生成良好、可维护的代码而没有任何技巧。此外，它的设计应该使编译器能够在编译时尽可能多地进行检查。

从一个新的基于 VM 的重 OO 语言开始。

*   如果存在操作符重载和多重继承等复杂性，则删除它们。
*   强制所有非最终变量为私有。
*   成员应该默认为“Final”，但应该有一个“Variable”标签来覆盖它。（这可能需要对构建器模式的内置支持才能完全有效）。
*   默认情况下，变量不应允许“Null”值，但变量和参数应具有“可空”标记，表明该变量可接受 null。

能够避免一些常见的有问题的模式也很好：

*   一些简化 IOC/DI 以消除单例的内置方法，
*   Java——消除检查的异常，这样人们就不再投入空的catch。

最后关注代码的可读性：

*   命名参数
*   删除创建超过 100 行的方法的能力。
*   添加一些复杂性分析，以帮助检测复杂的方法和类。

我确定我没有命名 1/10 可能的项目，但基本上我说的是可以编译为与 C# 或 Java 相同的字节码的东西，但限制如此之大，以至于程序员几乎忍不住要编写好的代码.

是的，我知道有一些 lint 类型的工具可以做到这一点，但我从未在我从事过的任何项目中看到它们（而且它们不会在我现在正在处理的代码上实际运行，例如）所以它们不是很有帮助，我希望看到当您输入 101 行方法时编译实际上*会失败......*

# sql - SQL Server 2000，“FOR XML AUTO”通过 http 查询，需要“内容长度 = 12345”返回 XML 标头

> ID：309364
> 
> 赞同：0
> 
> 时间：2008-11-21T16:29:44.817
> 
> 标签：sql, xml, sql-server-2000, xquery

SQL Server 2000 大师的，

我已经将 SQL 2000 设置为接受 HTTP 查询，即 [http://74.22.98.66/MYDATABASE?sql=](http://74.22.98.66/MYDATABASE?sql=) {CALL+sp_XMLDATA}+&root=root (ficticious url) 它工作得很好，并通过 IE7 url 返回以下 XML -

```
<?xml version="1.0" encoding="utf-8" ?> 
 <root>
  <g c="15" /> 
  <g c="8" /> 
  <g c="19" /> 
  </root> 
```

但是，我还需要在 XML 标头“Content Length = 12345”中检索作为返回，即

```
<?xml version="1.0" encoding="utf-8" "Content Length = 12345" ?> 
 <root>
  <g c="15" /> 
  <g c="8" /> 
  <g c="19" /> 
  </root> 
```

如何通过 SQL 2000 http 查询返回“内容长度 = 12345”？

供参考 -

```
CREATE Procedure XML_Count

AS

DECLARE @Q_3_1_1 AS INT
DECLARE @Q_3_1_2 AS INT
DECLARE @Q_3_1_3 AS INT

CREATE TABLE #Temp1 (c INT, n INT)

INSERT INTO #Temp1 SELECT (select count(Q_3_1)   from  tblTEST  where Q_3_1 between 0 and .33) , (SELECT n = '1')
INSERT INTO #Temp1 SELECT (select count(Q_3_1)  from  tblTEST where Q_3_1 between .34 and .66) , (SELECT n = '2')
INSERT INTO #Temp1 SELECT (select count(Q_3_1)  from  tblTEST   where Q_3_1 between .64 and .99) , (SELECT n = '3')

SELECT c FROM #Temp1 AS g
ORDER BY n ASC

FOR XML AUTO 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-04-27T00:54:42.627

这可能是[XML 模板](http://tutorials.freeskills.com/sql-server-2000-and-xml-part-5-xml-templates.htm)的工作。使用模板时，您可以控制标题并使其完全按照您想要的方式。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-18T12:23:38.597

我发现：通常情况下 content-length 不是 XML 标头属性，[而是 HTTP 字段](http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html)。需要更多信息：
您使用哪种技术从 SQL Server 检索 XML 数据？
SQL DB 和您的应用程序之间的大量数据传输是否存在任何问题？
您是否收到任何错误消息？

# java - 面向消息的中间件 (MoM) 与。企业服务总线 (ESB)

> ID：309374
> 
> 赞同：31
> 
> 时间：2008-11-21T16:31:30.273
> 
> 标签：java, soa, messaging, esb, mom

我来自妈妈的背景。我想我从概念上理解 ESB。但是，在从架构上做出选择时，我不太确定两者之间的实际差异。

这是我想知道的

1）任何可以在这方面帮助我的在线链接。

2）有人可以告诉我在哪里使用一个而不是另一个有意义。

任何帮助都会很有用。

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2008-11-24T16:36:19.230

消息传递倾向于集中在网络周围的可靠消息交换；使用队列作为可靠的负载均衡器和主题来实现发布和订阅。

ESB 通常倾向于在消息传递之外添加不同的特性，例如编排、路由、转换和中介。

我建议阅读[企业集成模式](http://www.enterpriseintegrationpatterns.com/toc.html)，它概述了您将倾向于在集成问题中使用的常见模式，这些问题都基于消息总线（尽管也可以与其他网络技术一起使用）。

例如使用开源；[Apache ActiveMQ](http://activemq.apache.org/)提供松散耦合的可靠消息交换。然后，您可以使用[Apache Camel](http://activemq.apache.org/camel/)实现[企业集成模式](http://activemq.apache.org/camel/enterprise-integration-patterns.html)，以实现智能路由、转换、编排、[使用其他技术](http://activemq.apache.org/camel/components.html)等。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2011-05-14T19:48:23.250

我将 MOM 解决方案和 ESB 解决方案放在两个不同的平面上。

我认为 MOM 是 ESB 解决方案的构建块。事实上，ESB 解决方案仅使用特定 MO​​M 实现提供的范式即可达到其自己的松散耦合和异步通信能力。

因此，MOM 代表在定制级别的 QoS 上的数据/事件分发解决方案（根据特定的供应商实现），而不是 ESB 代表提供在 SOA 场景中实现复杂编排的能力的解决方案（我们有多个提供商提供他们的服务，并且有多个有兴趣使用第一家提供的服务的消费者）。

复杂的编排意味着遗留系统之间的通信，每个系统都有自己的数据域表示（特定数据上的规则和服务）和自己的通信范式（一个消费者使用 CORBA 与 ESB 交互，另一个使用 WS，等等）。

很明显，ESB 代表了一种更复杂的架构解决方案，旨在提供**数据总线**的抽象（例如每个人在他自己的 pc 中拥有的电子总线），能够将过多的服务提供商连接到一个未明确指定的过多的服务消费者，**隐藏**（i）数据表示和（ii）通信中的异质性。

很抱歉这篇长文，但概念很复杂，很难在简短的陈述中有效和高效。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-22T01:50:00.567

ESB 通常是对消息进行路由、记录​​、转换和执行其他“技术”（即非业务）功能的层。它可以处理来自消息传递系统的消息（例如基于 JMS 的消息），也可以处理其他类型的消息（例如基于 SOAP 的 Web 服务）。在这方面，它比 MoM 更通用。

免责声明：我是一名 IBM WebSphere 顾问——尽管我不是以官方身份在此做出贡献。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-26T08:21:40.297

具有真正形式的 Web 服务的 ESB 通过通过消息元素之一发送数据来提供应用程序松散耦合。

MOM 不仅提供应用程序松散耦合，还提供处理松散耦合。

ESB 附带了支持以治理为中心的方法的附加功能。

两者可以单独使用，也可以根据场景一起使用。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-04-14T19:44:12.253

IBM 和 Oracle 拥有 SOA 认证。由于他们是市场的领导者（Gartner 魔力象限），我会阅读他们如何定义 SOA 和 ESB（以及支持 SOA 所需的方法和组件，如治理、注册表等）

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-03-29T00:48:11.357

EBS 只是另一个流行词，SOA 2.0 也是如此。

您可以使用带有队列的普通 Web 服务轻松实现 ESB 系统。您可以使用 SOA 1.0（Tibco、BizzTalk）进行消息路由和/或编排，一件事并不能真正阻止另一件事。更重要的是，赋予系统中交换的消息的语义起着重要作用，在这种情况下是事件。作为事件的消息是关于系统中发生的某些事情的触发器，因此上下文是不同的。

# linq - 如何使用Linq根据计数器设置属性

> ID：309382
> 
> 赞同：1
> 
> 时间：2008-11-21T16:33:34.667
> 
> 标签：linq, linq-to-xml

假设我有一个看起来像这样的 xml 文档

```
<foo>
<bar id="9" />
<bar id="4" />
<bar id="3" />
</foo> 
```

我想使用 linq 将 id 重置为 0、1、2。最简单的方法是什么？

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-21T16:42:32.230

```
XElement xml = GetXml();
var i = 0;
foreach (var e in xml.Elements("bar"))
  e.SetAttributeValue("id", i++); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-21T19:09:13.653

您可以使用 linq 方法而不是 foreach 来做到这一点，但没有太大的好处：

```
XElement xml = GetXml();
int updatedElements = xml.Elements("bar")
    .Select((x, i) =>
    {
        x.SetAttributeValue("id", i);
        return x;
    })
    .Count(); 
```

在这里，Count() 方法是枚举查询所必需的。任何枚举查询都可以。

如果使用 Select 作为 mutator 困扰您（就像我一样），请改用 List(T).ForEach：

```
XElement xml = GetXml();
xml.Elements("bar")
    .Select( (x, i) => new {x, i})
    .ToList()
    .ForEach(a => a.x.SetAttributeValue("id", a.i)); 
```

# java - Java：如何测试调用 System.exit() 的方法？

> ID：309396
> 
> 赞同：225
> 
> 时间：2008-11-21T16:38:58.930
> 
> 标签：java, multithreading, unit-testing, junit, testability

我有一些方法应该调用`System.exit()`某些输入。不幸的是，测试这些情况会导致 JUnit 终止！将方法调用放在新线程中似乎没有帮助，因为`System.exit()`终止了 JVM，而不仅仅是当前线程。是否有任何常见的模式来处理这个问题？例如，我可以用存根代替`System.exit()`吗？

[编辑] 有问题的类实际上是一个命令行工具，我试图在 JUnit 中进行测试。也许 JUnit 根本就不是适合这项工作的工具？欢迎提出补充回归测试工具的建议（最好是与 JUnit 和 EclEmma 很好集成的工具）。

* * *

## 回答 #1

> 赞同：236
> 
> 时间：2008-11-21T16:48:22.920

事实上，[Derkeiler.com](http://coding.derkeiler.com/Archive/Java/comp.lang.java.programmer/2008-04/msg02603.html)建议：

*   为什么`System.exit()`？

> 与其以 System.exit(whateverValue) 终止，不如抛出一个未经检查的异常？在正常使用中，它会一直漂移到 JVM 的最后一搏并关闭您的脚本（除非您决定在途中的某个地方捕获它，这可能在某天有用）。
> 
> 在 JUnit 场景中，它将被 JUnit 框架捕获，该框架将报告某某测试失败并顺利进行下一个测试。

*   防止`System.exit()`实际退出 JVM：

> 尝试修改 TestCase 以使用阻止调用 System.exit 的安全管理器运行，然后捕获 SecurityException。

```
public class NoExitTestCase extends TestCase 
{

    protected static class ExitException extends SecurityException 
    {
        public final int status;
        public ExitException(int status) 
        {
            super("There is no escape!");
            this.status = status;
        }
    }

    private static class NoExitSecurityManager extends SecurityManager 
    {
        @Override
        public void checkPermission(Permission perm) 
        {
            // allow anything.
        }
        @Override
        public void checkPermission(Permission perm, Object context) 
        {
            // allow anything.
        }
        @Override
        public void checkExit(int status) 
        {
            super.checkExit(status);
            throw new ExitException(status);
        }
    }

    @Override
    protected void setUp() throws Exception 
    {
        super.setUp();
        System.setSecurityManager(new NoExitSecurityManager());
    }

    @Override
    protected void tearDown() throws Exception 
    {
        System.setSecurityManager(null); // or save and restore original
        super.tearDown();
    }

    public void testNoExit() throws Exception 
    {
        System.out.println("Printing works");
    }

    public void testExit() throws Exception 
    {
        try 
        {
            System.exit(42);
        } catch (ExitException e) 
        {
            assertEquals("Exit status", 42, e.status);
        }
    }
} 
```

* * *

2012 年 12 月更新：

[Will](https://stackoverflow.com/users/557117/will)[在评论](https://stackoverflow.com/questions/309396/java-how-to-test-methods-that-call-system-exit/309427#comment19186122_309427)中建议使用[**System Rules**](http://stefanbirkner.github.com/system-rules/)，这是一组用于测试代码的 JUnit(4.9+) 规则，其中使用`java.lang.System`. **[Stefan Birkner](https://stackoverflow.com/users/557091/stefan-birkner)**在2011 年 12 月[的回答](https://stackoverflow.com/a/8658497/6309)
中 最初提到了这一点。

```
System.exit(…) 
```

> 使用[`ExpectedSystemExit`](http://stefanbirkner.github.com/system-rules/#ExpectedSystemExit)规则来验证是否`System.exit(…)`被调用。
> 您也可以验证退出状态。

例如：

```
public void MyTest {
    @Rule
    public final ExpectedSystemExit exit = ExpectedSystemExit.none();

    @Test
    public void noSystemExit() {
        //passes
    }

    @Test
    public void systemExitWithArbitraryStatusCode() {
        exit.expectSystemExit();
        System.exit(0);
    }

    @Test
    public void systemExitWithSelectedStatusCode0() {
        exit.expectSystemExitWithStatus(0);
        System.exit(0);
    }
} 
```

* * *

## 回答 #2

> 赞同：127
> 
> 时间：2011-12-28T16:25:40.190

库[System Lambda](https://github.com/stefanbirkner/system-lambda/)有一个方法。使用`catchSystemExit`此规则，您可以测试调用 System.exit(...) 的代码：

```
public class MyTest {
    @Test
    public void systemExitWithArbitraryStatusCode() {
        SystemLambda.catchSystemExit(() -> {
            //the code under test, which calls System.exit(...);
        });
    }

    @Test
    public void systemExitWithSelectedStatusCode0() {
        int status = SystemLambda.catchSystemExit(() -> {
            //the code under test, which calls System.exit(0);
        });

        assertEquals(0, status);
    }
} 
```

对于 Java 5 到 7，库[系统规则](https://stefanbirkner.github.com/system-rules/)有一个名为 ExpectedSystemExit 的 JUnit 规则。使用此规则，您可以测试调用 System.exit(...) 的代码：

```
public class MyTest {
    @Rule
    public final ExpectedSystemExit exit = ExpectedSystemExit.none();

    @Test
    public void systemExitWithArbitraryStatusCode() {
        exit.expectSystemExit();
        //the code under test, which calls System.exit(...);
    }

    @Test
    public void systemExitWithSelectedStatusCode0() {
        exit.expectSystemExitWithStatus(0);
        //the code under test, which calls System.exit(0);
    }
} 
```

完全披露：我是这两个库的作者。

* * *

## 回答 #3

> 赞同：32
> 
> 时间：2008-11-21T16:59:19.967

如何将“ExitManager”注入此方法：

```
public interface ExitManager {
    void exit(int exitCode);
}

public class ExitManagerImpl implements ExitManager {
    public void exit(int exitCode) {
        System.exit(exitCode);
    }
}

public class ExitManagerMock implements ExitManager {
    public bool exitWasCalled;
    public int exitCode;
    public void exit(int exitCode) {
        exitWasCalled = true;
        this.exitCode = exitCode;
    }
}

public class MethodsCallExit {
    public void CallsExit(ExitManager exitManager) {
        // whatever
        if (foo) {
            exitManager.exit(42);
        }
        // whatever
    }
} 
```

生产代码使用 ExitManagerImpl ，测试代码使用 ExitManagerMock 并且可以检查是否调用了 exit() 以及使用哪个退出代码。

* * *

## 回答 #4

> 赞同：32
> 
> 时间：2009-07-26T18:27:49.360

您实际上*可以*`System.exit`在 JUnit 测试中模拟或存根该方法。

例如，使用[JMockit](http://jmockit.github.io)您可以编写（还有其他方法）：

```
@Test
public void mockSystemExit(@Mocked("exit") System mockSystem)
{
    // Called by code under test:
    System.exit(); // will not exit the program
} 
```

编辑：替代测试（使用最新的 JMockit API），它不允许任何代码在调用后运行`System.exit(n)`：

```
@Test(expected = EOFException.class)
public void checkingForSystemExitWhileNotAllowingCodeToContinueToRun() {
    new Expectations(System.class) {{ System.exit(anyInt); result = new EOFException(); }};

    // From the code under test:
    System.exit(1);
    System.out.println("This will never run (and not exit either)");
} 
```

* * *

## 回答 #5

> 赞同：21
> 
> 时间：2008-11-21T16:50:49.547

我们在代码库中使用的一个技巧是将 System.exit() 调用封装在 Runnable impl 中，该方法默认使用该方法。为了进行单元测试，我们设置了一个不同的模拟 Runnable。像这样的东西：

```
private static final Runnable DEFAULT_ACTION = new Runnable(){
  public void run(){
    System.exit(0);
  }
};

public void foo(){ 
  this.foo(DEFAULT_ACTION);
}

/* package-visible only for unit testing */
void foo(Runnable action){   
  // ...some stuff...   
  action.run(); 
} 
```

...和 ​​JUnit 测试方法...

```
public void testFoo(){   
  final AtomicBoolean actionWasCalled = new AtomicBoolean(false);   
  fooObject.foo(new Runnable(){
    public void run(){
      actionWasCalled.set(true);
    }   
  });   
  assertTrue(actionWasCalled.get()); 
} 
```

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-11-21T18:31:29.157

我喜欢已经给出的一些答案，但我想展示一种不同的技术，这种技术在测试遗留代码时通常很有用。给定如下代码：

```
public class Foo {
  public void bar(int i) {
    if (i < 0) {
      System.exit(i);
    }
  }
} 
```

您可以进行安全重构以创建包装 System.exit 调用的方法：

```
public class Foo {
  public void bar(int i) {
    if (i < 0) {
      exit(i);
    }
  }

  void exit(int i) {
    System.exit(i);
  }
} 
```

然后你可以为你的测试创建一个假的，覆盖退出：

```
public class TestFoo extends TestCase {

  public void testShouldExitWithNegativeNumbers() {
    TestFoo foo = new TestFoo();
    foo.bar(-1);
    assertTrue(foo.exitCalled);
    assertEquals(-1, foo.exitValue);
  }

  private class TestFoo extends Foo {
    boolean exitCalled;
    int exitValue;
    void exit(int i) {
      exitCalled = true;
      exitValue = i;
    }
} 
```

这是一种用行为替换测试用例的通用技术，我在重构遗留代码时一直使用它。它通常不是我要离开的地方，而是让现有代码被测试的中间步骤。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2010-01-31T17:45:23.687

对于 VonC 在 JUnit 4 上运行的答案，我已将代码修改如下

```
protected static class ExitException extends SecurityException {
    private static final long serialVersionUID = -1982617086752946683L;
    public final int status;

    public ExitException(int status) {
        super("There is no escape!");
        this.status = status;
    }
}

private static class NoExitSecurityManager extends SecurityManager {
    @Override
    public void checkPermission(Permission perm) {
        // allow anything.
    }

    @Override
    public void checkPermission(Permission perm, Object context) {
        // allow anything.
    }

    @Override
    public void checkExit(int status) {
        super.checkExit(status);
        throw new ExitException(status);
    }
}

private SecurityManager securityManager;

@Before
public void setUp() {
    securityManager = System.getSecurityManager();
    System.setSecurityManager(new NoExitSecurityManager());
}

@After
public void tearDown() {
    System.setSecurityManager(securityManager);
} 
```

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2011-12-29T15:36:02.843

## 创建一个包装 System.exit() 的模拟类

我同意[EricSchaefer](https://stackoverflow.com/a/309467/78973)的观点。但是如果你使用像[Mockito](http://code.google.com/p/mockito/)这样的好的模拟框架，一个简单的具体类就足够了，不需要一个接口和两个实现。

## 在 System.exit() 上停止测试执行

**问题：**

```
// do thing1
if(someCondition) {
    System.exit(1);
}
// do thing2
System.exit(0) 
```

模拟`Sytem.exit()`不会终止执行。如果您想测试`thing2`未执行的，这很糟糕。

**解决方案：**

[您应该按照martin](https://stackoverflow.com/a/309434/78973)的建议重构此代码：

```
// do thing1
if(someCondition) {
    return 1;
}
// do thing2
return 0; 
```

并`System.exit(status)`在调用函数中做。这迫使你将所有的`System.exit()`s 放在一个地方或附近`main()`。这比`System.exit()`在你的逻辑深处调用更干净。

## 代码

包装：

```
public class SystemExit {

    public void exit(int status) {
        System.exit(status);
    }
} 
```

主要的：

```
public class Main {

    private final SystemExit systemExit;

    Main(SystemExit systemExit) {
        this.systemExit = systemExit;
    }

    public static void main(String[] args) {
        SystemExit aSystemExit = new SystemExit();
        Main main = new Main(aSystemExit);

        main.executeAndExit(args);
    }

    void executeAndExit(String[] args) {
        int status = execute(args);
        systemExit.exit(status);
    }

    private int execute(String[] args) {
        System.out.println("First argument:");
        if (args.length == 0) {
            return 1;
        }
        System.out.println(args[0]);
        return 0;
    }
} 
```

测试：

```
public class MainTest {

    private Main       main;

    private SystemExit systemExit;

    @Before
    public void setUp() {
        systemExit = mock(SystemExit.class);
        main = new Main(systemExit);
    }

    @Test
    public void executeCallsSystemExit() {
        String[] emptyArgs = {};

        // test
        main.executeAndExit(emptyArgs);

        verify(systemExit).exit(1);
    }
} 
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-11-21T16:45:07.610

快速查看 api，表明 System.exit 可以抛出异常 esp。如果安全管理器禁止关闭虚拟机。也许解决方案是安装这样的管理器。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2008-11-21T16:55:13.297

您可以使用 java SecurityManager 来防止当前线程关闭 Java VM。下面的代码应该做你想做的事：

```
SecurityManager securityManager = new SecurityManager() {
    public void checkPermission(Permission permission) {
        if ("exitVM".equals(permission.getName())) {
            throw new SecurityException("System.exit attempted and blocked.");
        }
    }
};
System.setSecurityManager(securityManager); 
```

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2013-06-11T19:51:55.527

您可以通过替换 Runtime 实例来测试 System.exit(..)。例如使用 TestNG + Mockito：

```
public class ConsoleTest {
    /** Original runtime. */
    private Runtime originalRuntime;

    /** Mocked runtime. */
    private Runtime spyRuntime;

    @BeforeMethod
    public void setUp() {
        originalRuntime = Runtime.getRuntime();
        spyRuntime = spy(originalRuntime);

        // Replace original runtime with a spy (via reflection).
        Utils.setField(Runtime.class, "currentRuntime", spyRuntime);
    }

    @AfterMethod
    public void tearDown() {
        // Recover original runtime.
        Utils.setField(Runtime.class, "currentRuntime", originalRuntime);
    }

    @Test
    public void testSystemExit() {
        // Or anything you want as an answer.
        doNothing().when(spyRuntime).exit(anyInt());

        System.exit(1);

        verify(spyRuntime).exit(1);
    }
} 
```

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2020-11-24T09:04:37.413

系统存根 - [https://github.com/webcompere/system-stubs](https://github.com/webcompere/system-stubs) - 也能够解决这个问题。它共享 System Lambda 的语法，用于包装我们*知道*将执行的代码`System.exit`，但是当其他代码意外退出时，这可能会导致奇怪的效果。

通过 JUnit 5 插件，我们可以确保任何退出都将转换为异常：

```
@ExtendWith(SystemStubsExtension.class)
class SystemExitUseCase {
    // the presence of this in the test means System.exit becomes an exception
    @SystemStub
    private SystemExit systemExit;

    @Test
    void doSomethingThatAccidentallyCallsSystemExit() {
        // this test would have stopped the JVM, now it ends in `AbortExecutionException`
        // System.exit(1);
    }

    @Test
    void canCatchSystemExit() {
        assertThatThrownBy(() -> System.exit(1))
            .isInstanceOf(AbortExecutionException.class);

        assertThat(systemExit.getExitCode()).isEqualTo(1);
    }
} 
```

或者，也可以使用类似断言的静态方法：

```
assertThat(catchSystemExit(() -> {
   //the code under test
   System.exit(123);
})).isEqualTo(123); 
```

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2010-06-22T20:08:21.357

在某些环境中，调用程序会使用返回的退出代码（例如 MS Batch 中的 ERRORLEVEL）。我们在代码中对执行此操作的主要方法进行了测试，我们的方法是使用与此处其他测试中使用的类似的 SecurityManager 覆盖。

昨晚我用 Junit @Rule 注释整理了一个小 JAR 来隐藏安全管理器代码，以及基于预期返回代码添加预期。[http://code.google.com/p/junitsystemrules/](http://code.google.com/p/junitsystemrules/)

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2020-01-27T12:12:21.850

大多数解决方案将

*   `System.exit()`在调用时刻终止测试（方法，而不是整个运行）
*   忽略一个已经安装的`SecurityManager`
*   有时非常特定于测试框架
*   限制每个测试用例最多使用一次

因此，大多数解决方案不适合以下情况：

*   副作用的验证将在调用后执行`System.exit()`
*   现有的安全管理器是测试的一部分。
*   使用了不同的测试框架。
*   您希望在单个测试用例中进行多次验证。这可能是严格不推荐的，但有时会非常方便，尤其是与 结合使用`assertAll()`，例如。

我对其他答案中提出的现有解决方案所施加的限制不满意，因此我自己想出了一些东西。

下面的类提供了一个方法`assertExits(int expectedStatus, Executable executable)`，该方法`System.exit()`使用指定的`status`值调用该方法，并且可以在它之后继续测试。它的工作方式与 JUnit 5 相同`assertThrows`。它还尊重现有的安全经理。

还有一个问题：当被测代码安装了一个新的安全管理器时，它完全取代了测试设置的安全管理器。我知道的所有其他`SecurityManager`基于解决方案的解决方案都遇到了同样的问题。

```
import java.security.Permission;

import static java.lang.System.getSecurityManager;
import static java.lang.System.setSecurityManager;
import static org.junit.jupiter.api.Assertions.assertEquals;
import static org.junit.jupiter.api.Assertions.fail;

public enum ExitAssertions {
    ;

    public static <E extends Throwable> void assertExits(final int expectedStatus, final ThrowingExecutable<E> executable) throws E {
        final SecurityManager originalSecurityManager = getSecurityManager();
        setSecurityManager(new SecurityManager() {
            @Override
            public void checkPermission(final Permission perm) {
                if (originalSecurityManager != null)
                    originalSecurityManager.checkPermission(perm);
            }

            @Override
            public void checkPermission(final Permission perm, final Object context) {
                if (originalSecurityManager != null)
                    originalSecurityManager.checkPermission(perm, context);
            }

            @Override
            public void checkExit(final int status) {
                super.checkExit(status);
                throw new ExitException(status);
            }
        });
        try {
            executable.run();
            fail("Expected System.exit(" + expectedStatus + ") to be called, but it wasn't called.");
        } catch (final ExitException e) {
            assertEquals(expectedStatus, e.status, "Wrong System.exit() status.");
        } finally {
            setSecurityManager(originalSecurityManager);
        }
    }

    public interface ThrowingExecutable<E extends Throwable> {
        void run() throws E;
    }

    private static class ExitException extends SecurityException {
        final int status;

        private ExitException(final int status) {
            this.status = status;
        }
    }
} 
```

您可以像这样使用该类：

```
 @Test
    void example() {
        assertExits(0, () -> System.exit(0)); // succeeds
        assertExits(1, () -> System.exit(1)); // succeeds
        assertExits(2, () -> System.exit(1)); // fails
    } 
```

如有必要，可以轻松地将代码移植到 JUnit 4、TestNG 或任何其他框架。唯一特定于框架的元素是未通过测试。这可以很容易地更改为独立于框架的东西（除了*Junit 4* `Rule`

有改进的空间，例如，`assertExits()`可定制消息的重载。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2010-10-20T11:28:48.757

用于`Runtime.exec(String command)`在单独的进程中启动 JVM。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2012-03-27T23:49:01.423

解决方案有一个小问题`SecurityManager`。一些方法，例如`JFrame.exitOnClose`，也调用`SecurityManager.checkExit`。在我的应用程序中，我不希望那个调用失败，所以我使用了

```
Class[] stack = getClassContext();
if (stack[1] != JFrame.class && !okToExit) throw new ExitException();
super.checkExit(status); 
```

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2021-07-09T22:03:35.373

可用于单元和集成测试的一种普遍有用的方法是拥有一个包私有（默认访问）可模拟运行器类，它提供 run() 和 exit() 方法。这些方法可以被测试模块中的 Mock 或 Fake 测试类覆盖。

测试类（JUnit 或其他）提供了 exit() 方法可以代替 System.exit() 抛出的异常。

```
package mainmocked;
class MainRunner {
    void run(final String[] args) {
        new MainMocked().run(args);    
    }
    void exit(final int status) {
        System.exit(status);
    }
} 
```

下面带有 main() 的类，也有一个 altMain() 来接收模拟或假跑步者，当单元或集成测试时：

```
package mainmocked;

public class MainMocked {
    private static MainRunner runner = new MainRunner();

    static void altMain(final String[] args, final MainRunner inRunner) {
        runner = inRunner;
        main(args);
    }

    public static void main(String[] args) {
        try {
          runner.run(args);
        } catch (Throwable ex) {
            // Log("error: ", ex);
            runner.exit(1);
        }
        runner.exit(0);
    } // main

    public void run(String[] args) {
        // do things ...
    }
} // class 
```

一个简单的模拟（使用 Mockito）将是：

```
@Test
public void testAltMain() {
    String[] args0 = {};
    MainRunner mockRunner = mock(MainRunner.class);
    MainMocked.altMain(args0, mockRunner);

    verify(mockRunner).run(args0);
    verify(mockRunner).exit(0);
  } 
```

更复杂的测试类将使用 Fake，其中 run() 可以做任何事情，并使用 Exception 类来替换 System.exit()：

```
private class FakeRunnerRuns extends MainRunner {
    @Override
    void run(String[] args){
        new MainMocked().run(args);
    }
    @Override
    void exit(final int status) {
        if (status == 0) {
            throw new MyMockExitExceptionOK("exit(0) success");
        }
        else {
            throw new MyMockExitExceptionFail("Unexpected Exception");
        } // ok
    } // exit
} // class 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2021-09-30T15:52:03.857

这里的另一种技术是将附加代码引入（希望少数）逻辑执行 System.exit() 的地方。当逻辑作为单元测试的一部分被调用时，这个额外的代码 *可以避免执行 System.exit() 。*例如，定义一个包私有常量，如 TEST_MODE，它通常为 false。然后让单元测试代码将此设置为 true 并向被测代码添加逻辑以检查该情况并绕过 System.exit 调用，而是抛出单元测试逻辑可以捕获的异常。顺便说一句，在 2021 年，使用像 spotbugs 这样的东西，这个问题可以表现在“java.io.IOException：现有连接被远程主机强行关闭”这个晦涩的错误中。

* * *

## 回答 #19

> 赞同：-1
> 
> 时间：2008-11-21T16:50:42.277

调用 System.exit() 是一种不好的做法，除非它在 ​​main() 中完成。这些方法应该抛出一个异常，最终被你的 main() 捕获，然后用适当的代码调用 System.exit。

# php - mysql php：在mysql数据库之间切换很慢

> ID：309402
> 
> 赞同：2
> 
> 时间：2008-11-21T16:40:41.143
> 
> 标签：php, mysql, sql

在我连接到 mysql 的 php 脚本中，我必须在同一个脚本中查询 2 个数据库以获取不同的信息。更具体地说，一个数据库中的 Faxarchives 和另一个数据库中的 Faxusers。

在我的代码中，我查询传真用户，然后查询每个用户，我查询传真存档以获取用户历史记录。

我可能会做类似的事情：

```
function getUserarchive( $userid) { 
  $out= ""; 
  $dbname = 'Faxarchive';
  $db = mysql_select_db($dbname);
  $sql = "select sent, received from faxarchivetable where userid = '" . $userid . "'"; 

  if ( $rs = mysql_query($sql) { 
    while ($row = mysql_fetch_array($rs) ) { 
      $out = $row['sent'] . " " . $row['received']; 
    }//end while 
  }//end if query

  return ($out); 
}//end function 

$conn = mysql_connect($dbhost, $dbuser, $dbpass) or die ('Error connecting to mysql');

$dbname = 'Faxusers';
$db = mysql_select_db($dbname);
$sql="select distinct userid from faxuserstable"; 
if ( $rs = mysql_query($sql) { 
  while ($row = mysql_fetch_array($rs) ) { 
    $out = $row['userid'] . ":" . getuserarchive($row['userid']); 
  }//end while 
}//end if query 
```

我猜每个用户的数据库之间的切换会导致速度缓慢。无论如何，我怎样才能提高处理速度？

提前致谢。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-21T16:51:45.597

你有几个问题。首先，您的函数 getUserarchive 始终拉回所有行。看起来您忘记将 SQL 限制为仅特定的用户 ID。这是您的速度问题的一个重要原因。

另一种选择是传入您感兴趣的所有用户 ID。将 SQL 重写为 SELECT sent, received FROMfaxarchivetable WHERE userid IN (...)，这意味着您可以选择从您的传真存档表中提取所有信息，而不是每个用户标识一个。

最后，如果两个数据库都在同一个 MySQL 服务器上，您只需进行一次选择即可获取所有信息： SELECT Faxusers.faxuserstable.userid, sent, received FROM Faxusers.faxuserstable JOIN Faxarchive.faxarchivetable ON Faxusers.faxuserstable.userid = Faxarchive.faxarchivetable.userid

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-21T17:26:21.067

你知道你可以通过限定表名来查询不同数据库中的表吗？

例如，我认为您可以在一个 SQL 查询中获取所有信息，如下所示：

```
SELECT sent, received 
FROM Faxarchive.faxarchivetable
WHERE userid IN ( SELECT DISTINCT userid FROM Faxusers.faxuserstable ); 
```

哦，这与 ChrisInEdmonton 的观点相同。我没有注意到他的回答。

# http - 最好使用 HTTP REFERER 进行重定向还是使用其他方法？

> ID：309405
> 
> 赞同：1
> 
> 时间：2008-11-21T16:41:35.603
> 
> 标签：http, redirect

目前，我们正在存储用户的 HTTP_REFERER，以便我们可以将用户重定向回他们登录之前浏览的上一个页面。

Http Referer 来自客户端，可以是欺骗性的，也可以是空白的。是否有更安全/可靠的方法来提供这种方便的用户重定向？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-21T16:45:16.593

以某种方式运行

```
history.go(-1); 
```

是我能想到的唯一选择（javascript）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-21T16:48:00.940

你有会议吗？

如果是这样，您可以在服务器端跟踪他们在此会话中访问了哪些页面，并将它们发送回上一个页面。

（缓存可能会搞砸，但您可以适当地设置 cache-control: 标头）

但这一切似乎是痛苦多于收获。将它们发送回欺骗页面是否有任何真正的问题，如果它们足够愚蠢的话？

保罗。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-21T16:48:53.980

通常我通过登录表单传递它。

```
<form action="login" method="post">
<input type="hidden" name="url" value="... whatever the current url is ...">
<input type="text" name="username">
<input type="text" name="password">
</form> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-21T16:49:16.057

从来没听说过。但是，您是否认为普通用户会假装他们的Referer只是为了被重定向到错误的地方？这看起来不太可能。

我担心需要将用户重定向到他们来自哪里，甚至不需要询问他们。我要么有一个偏好选项来决定是否允许它（以及在哪里），要么事先询问他们重定向，能够拒绝重定向。

如果 RoBorg 假设您将在与您自己的站点不同的站点上提供登录屏幕并且您想要存储源站点，那么您当然可以使用相同的表单来发送他们登录的站点。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-21T16:57:57.800

尽管我猜您需要检查 XSRF，但引用者可能对大多数用户都可以正常工作。我们所做的是，当有人点击他们必须登录的区域时，他们会被重定向到登录页面，其中包含他们在会话中存储位置的 URL。

一旦他们登录，他们就会被重定向到以前的 URL。

当然，这在很大程度上取决于您的身份验证是如何设置的！

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-21T17:05:17.350

我实际上有一个函数，它使用几种不同的方法进行重定向，具体取决于用户进入登录页面所采用的路径。

我在用户登录后调用的函数如下所示：

```
Protected Sub doRedirect(ByVal sender As Object, ByVal e As System.EventArgs)
    If Not Request.QueryString("rtn") Is Nothing Then
        Response.Redirect(Request.QueryString("rtn").ToString)
    ElseIf Me.hidden_return.Value <> "" Then
        Response.Redirect(Me.hidden_return.Value)
    ElseIf Not Request.UrlReferrer Is Nothing AndAlso Request.UrlReferrer.Segments(Request.UrlReferrer.Segments.Length - 1) <> "login.aspx" Then
        Response.Redirect(Request.UrlReferrer.ToString)
    Else
        Response.Redirect("default.aspx")
    End If
End Sub 
```

显然，这一切都可以在客户端进行欺骗，但我真的不在乎他们是否想欺骗自己。

# python - 如何在 Windows 上为 Python 2.6 设置 Setuptools？

> ID：309412
> 
> 赞同：85
> 
> 时间：2008-11-21T16:44:44.833
> 
> 标签：python, windows, setuptools

有没有办法在没有 exe 安装程序的情况下在 Windows 中安装适用于 Python 2.6 的 Setuptools？

目前还没有构建，Setuptools 的维护者表示可能需要一段时间才能完成。

有谁知道无论如何安装它的方法？

* * *

## 回答 #1

> 赞同：104
> 
> 时间：2008-11-21T18:56:40.230

第一个选项 - 在线安装（即在整个安装过程中保持与 Internet 的连接）：

1.  下载[setuptools-0.6c9.tar.gz](https://pypi.org/project/setuptools/0.6c9/)
2.  使用[7-zip](http://www.7-zip.org/)将其解压缩到 Windows Python 安装文件夹之外的文件夹（目录）
3.  转到文件夹（请参阅步骤 2）并从相应的 dos（命令）提示符运行 ez_setup.py
4.  确保您的 PATH 包含适当的 C:\Python2X\Scripts 目录

第二种选择：

1.  下载[setuptools-0.6c9.tar.gz](https://pypi.org/project/setuptools/0.6c9/)
2.  [将 setuptools-0.6c9-py2.6.egg](http://pypi.python.org/packages/2.6/s/setuptools/setuptools-0.6c9-py2.6.egg#md5=ca37b1ff16fa2ede6e19383e7b59245a)下载到 Windows Python 安装文件夹之外的文件夹（目录）
3.  使用[7-zip将 ez_setup.py 解压到](http://www.7-zip.org/)[setuptools-0.6c9-py2.6.egg](http://pypi.python.org/packages/2.6/s/setuptools/setuptools-0.6c9-py2.6.egg#md5=ca37b1ff16fa2ede6e19383e7b59245a)相同的文件夹中
4.  进入相应的dos提示符，在命令提示符下运行python ez_setup.py setuptools-0.6c9-py2.6.egg
5.  确保您的 PATH 包含适当的 C:\Python2X\Scripts 目录

第三个选项（假设您的机器上有 Visual Studio 2005 或 MinGW）

1.  下载[setuptools-0.6c9.tar.gz](https://pypi.org/project/setuptools/0.6c9/)
2.  使用[7-zip](http://www.7-zip.org/)将其解压缩到 Windows Python 安装文件夹之外的文件夹（目录）
3.  转到文件夹（请参阅步骤 2）并从相应的 dos（命令）提示符运行 python setup.py install

请提供反馈。

* * *

## 回答 #2

> 赞同：50
> 
> 时间：2009-01-08T18:27:59.063

您可以下载并运行[http://peak.telecommunity.com/dist/ez_setup.py](http://peak.telecommunity.com/dist/ez_setup.py)。这将下载并安装 setuptools。

[更新]

此脚本不再有效 - 它下载的 setuptools 版本不在 ez_setup.py 中指定的 URI - 导航到[http://pypi.python.org/packages/2.7/s/setuptools/](http://pypi.python.org/packages/2.7/s/setuptools/)以获取最新版本 -脚本也做了一些 md5 检查，我没有进一步研究它。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-03-23T21:37:23.157

11 月 21 日的答案对我不起作用。我按照方法 1 的说明让它在我的 64 位 Vista 机器上工作，除了我输入的第 3 步：

setup.py 安装

所以，总而言之，我做到了：

1.  下载 setuptools-0.6c9.tar.gz
2.  使用 7-zip 将其解压到您的 Windows Python 安装文件夹之外的文件夹（目录）
3.  在 DOS（命令）提示符下，cd 到新创建的 setuptools-0.6c9 文件夹并输入“setup.py install”（不带引号）。
4.  确保您的 PATH 包含适当的 C:\Python2X\Scripts 目录

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-11-16T05:56:23.653

我能够找到执行谷歌的EXE，

您只需从以下网址下载它，然后双击并安装....

[http://pypi.python.org/packages/2.6/s/setuptools/setuptools-0.6c11.win32-py2.6.exe#md5=1509752c3c2e64b5d0f9589aafe053dc](http://pypi.python.org/packages/2.6/s/setuptools/setuptools-0.6c11.win32-py2.6.exe#md5=1509752c3c2e64b5d0f9589aafe053dc)

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-12-19T03:15:06.657

我通过下载源代码然后运行（从提取的目录）快速运行它：

```
python.exe setup.py bdist_wininst 
```

构建`dist\setuptools-0.6c9.win32.exe`，这正是您正在寻找的安装程序。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-04-17T04:21:19.910

刚刚安装setuptools如下：

1.  下载[http://pypi.python.org/packages/source/s/setuptools/setuptools-0.6c9.tar.gz#md5=3864c01d9c719c8924c455714492295e](http://pypi.python.org/packages/source/s/setuptools/setuptools-0.6c9.tar.gz#md5=3864c01d9c719c8924c455714492295e)，并解压缩到我的 Python 安装之外的文件夹中。
2.  命令提示符，然后 cd 进入该文件夹。
3.  输入*python setup.py 安装*

这将从源代码安装到您的 python 的站点包文件夹和所需的任何其他步骤中。这是在 Windows XP SP2 上。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-01T15:32:06.333

“第一个选项”（4 个步骤：下载、提取、运行、验证 PATH）在我的安装了 Python 2.6 32 位的 Windows Server 2008 x64 机器上不起作用，在我的安装了 Python 2.6 32 位的 Vista x64 机器上也不起作用安装。

“第二个选项（5 个步骤：下载、解压缩、解压、运行、验证 PATH）在 Windows Server 2008 x64 和 Windows Vista x64 上均有效。

非常感谢您提供说明！

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-05-22T10:59:37.177

OP 选项 1 对我不起作用。

但是，按照 NathanD 的说法执行 setup.py install 确实可以解决问题。

也许这应该成为选项1？

维尔纳

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2010-05-03T00:52:29.063

`setuptools` [已](http://pypi.python.org/pypi/setuptools/0.6c11)在 0.6c11 版本中更新。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2011-06-20T23:45:52.450

最简单的 setuptools 安装选项是使用预打包的 Windows Installer。

对于Windows 上的**32 位**Python，官方 setuptools 页面已更新，并包含适用于 Python 2.6 和 2.7 的 Windows 安装程序：

*   [http://pypi.python.org/pypi/setuptools](http://pypi.python.org/pypi/setuptools)

对于Windows 上的**64 位**Python，可在此处获得 setuptools Windows 安装程序：

*   [http://www.lfd.uci.edu/~gohlke/pythonlibs/](http://www.lfd.uci.edu/~gohlke/pythonlibs/)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-03-23T21:49:22.677

我的建议是等到 Python 2.6.2 在 Windows 上使用 Python 2.6。仍然有一些错误使它不太理想（[这个特别讨厌](http://sourceforge.net/tracker/index.php?func=detail&aid=2609380&group_id=78018&atid=551954)）。就个人而言，即使从源代码安装后，我也无法让 setuptools 在 Vista x64 上完全正常工作。在 Python 2.5.4 下，我没有遇到任何问题。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-05-03T15:39:56.793

第二种选择对我有用。

两个注意事项：

一种。安装后，当你在 vista 中使用 easy_install 时，请以管理员身份进行。（右键单击您的命令行快捷方式，然后单击“以管理员身份运行”）。我在不这样做的情况下尝试运行 easy_install 时遇到了麻烦。

湾。他的意思是使用 setuptools-0.6c9.tar.gz 中的 ez_setup

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2014-03-28T19:26:30.740

Python 拥有一切可以做到这一点。

从[https://pypi.python.org/pypi/setuptools#installing-and-using-setuptools](https://pypi.python.org/pypi/setuptools#installing-and-using-setuptools)我得到了**ez_setup.py**的 URL ：[https://bitbucket.org/pypa/setuptools/raw/bootstrap/ez_setup。 py](https://bitbucket.org/pypa/setuptools/raw/bootstrap/ez_setup.py)

而是下载它并摆弄文件，我们可以从控制台执行此操作：

```
import urllib
url = 'https://bitbucket.org/pypa/setuptools/raw/bootstrap/ez_setup.py'
ezcode = urllib.urlopen(url).read()
exec(ezcode) 
```

* * *

## 回答 #14

> 赞同：-1
> 
> 时间：2009-12-20T20:00:59.290

[ActivePython](http://activestate.com/activepython)已经包含 setuptools（实际上是[Distribute](http://python-distribute.org/)），以及 pip 和 virtualenv。

# paypal - 您可以强制 PayPal Payments Standard API 先显示信用卡字段吗？

> ID：309421
> 
> 赞同：29
> 
> 时间：2008-11-21T16:46:07.247
> 
> 标签：paypal

我正在使用 PayPal 网站付款标准。每当用户使用我发送的变量登陆 PayPal 时，它会显示一个 PayPal 登录表单，并在底部显示“没有 PayPal 帐户？使用您的信用卡或银行帐户（如果可用）。”

我希望它默认始终要求信用卡，并且可能会说“有 PayPal？使用它！”。有任何想法吗？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2011-11-10T23:05:16.577

我一直在努力解决这个问题，并在罗伯茨关于在 ExpressCheckout API 中使用 LANDINGPAGE=Billing 的评论之后找到了答案。

* * *

从页面：

[https://cms.paypal.com/us/cgi-bin/?cmd=_render-content&content_ID=developer/e_howto_api_nvp_r_SetExpressCheckout](https://cms.paypal.com/us/cgi-bin/?cmd=_render-content&content_ID=developer/e_howto_api_nvp_r_SetExpressCheckout)

**LANDINGPAGE**：要显示的 PayPal 页面的类型。

它是以下值之一：

*   计费 - 非 PayPal 帐户
*   登录 - 贝宝账户登录

* * *

另请参阅：

**SOLUTIONTYPE**：结帐流程的类型。它是以下值之一：

*   独家 – 买家无需创建 PayPal 账户即可结账。这称为 PayPal 帐户可选。
*   马克——买家必须有一个 PayPal 账户才能结账。

注意：如果您的商家帐户中启用了 PayPal Account Optional，您可以通过 Mark 选择性地覆盖 PayPal Account Optional 设置。如果 PayPal Account Optional 在您的帐户中关闭，则通过 Sole 无效

* * *

希望这可以帮助。

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2009-03-13T13:45:35.860

在[PayPal 开发人员社区的一个线程中，](http://www.paypaldeveloper.com/pdn/board/message?board.id=basicpayments&message.id=28117&query.id=71300)他们通过对结帐页面的基于 cookie 的访问来解释这一点。

基本上，如果 PayPal 检测到您是用户并发现他们的 cookie，他们将默认显示登录表单。

如果他们看不到该 cookie，那么他们将首先显示信用卡选项，并附注如果您已经有 PayPal 帐户，请登录。

所以答案是否定的。

# java - 如何在 Java 中将 InputStream 读取/转换为字符串？

> ID：309424
> 
> 赞同：4483
> 
> 时间：2008-11-21T16:47:40.287
> 
> 标签：java, string, io, stream, inputstream

如果你有一个`java.io.InputStream`对象，你应该如何处理那个对象并产生一个`String`？

* * *

假设我有一个`InputStream`包含文本数据的，我想将它转换为一个`String`，所以例如我可以将它写入一个日志文件。

`InputStream`获取并将其转换为 的最简单方法是`String`什么？

```
public String convertStreamToString(InputStream is) {
    // ???
} 
```

* * *

## 回答 #1

> 赞同：3130
> 
> 时间：2016-02-17T00:58:48.863

总结其他答案我发现了 11 种主要方法（见下文）。我写了一些性能测试（见下面的结果）：

**将 InputStream 转换为字符串的方法：**

1.  使用`IOUtils.toString`（Apache 实用程序）

    ```
     String result = IOUtils.toString(inputStream, StandardCharsets.UTF_8); 
    ```

2.  使用`CharStreams`（番石榴）

    ```
     String result = CharStreams.toString(new InputStreamReader(
           inputStream, Charsets.UTF_8)); 
    ```

3.  使用`Scanner`（JDK）

    ```
     Scanner s = new Scanner(inputStream).useDelimiter("\\A");
     String result = s.hasNext() ? s.next() : ""; 
    ```

4.  使用**流 API** (Java 8)。**警告**：此解决方案将不同的换行符（如`\r\n`）转换为`\n`.

    ```
     String result = new BufferedReader(new InputStreamReader(inputStream))
       .lines().collect(Collectors.joining("\n")); 
    ```

5.  使用**并行流 API** (Java 8)。**警告**：此解决方案将不同的换行符（如`\r\n`）转换为`\n`.

    ```
     String result = new BufferedReader(new InputStreamReader(inputStream))
        .lines().parallel().collect(Collectors.joining("\n")); 
    ```

6.  使用`InputStreamReader`和`StringBuilder`（JDK）

    ```
     int bufferSize = 1024;
     char[] buffer = new char[bufferSize];
     StringBuilder out = new StringBuilder();
     Reader in = new InputStreamReader(stream, StandardCharsets.UTF_8);
     for (int numRead; (numRead = in.read(buffer, 0, buffer.length)) > 0; ) {
         out.append(buffer, 0, numRead);
     }
     return out.toString(); 
    ```

7.  使用`StringWriter`和`IOUtils.copy`（Apache Commons）

    ```
     StringWriter writer = new StringWriter();
     IOUtils.copy(inputStream, writer, "UTF-8");
     return writer.toString(); 
    ```

8.  使用`ByteArrayOutputStream`和`inputStream.read`（JDK）

    ```
     ByteArrayOutputStream result = new ByteArrayOutputStream();
     byte[] buffer = new byte[1024];
     for (int length; (length = inputStream.read(buffer)) != -1; ) {
         result.write(buffer, 0, length);
     }
     // StandardCharsets.UTF_8.name() > JDK 7
     return result.toString("UTF-8"); 
    ```

9.  使用`BufferedReader`（JDK）。**警告：**此解决方案将不同的换行符（如`\n\r`）转换为`line.separator`系统属性（例如，在 Windows 中为“\r\n”）。

    ```
     String newLine = System.getProperty("line.separator");
     BufferedReader reader = new BufferedReader(
             new InputStreamReader(inputStream));
     StringBuilder result = new StringBuilder();
     for (String line; (line = reader.readLine()) != null; ) {
         if (result.length() > 0) {
             result.append(newLine);
         }
         result.append(line);
     }
     return result.toString(); 
    ```

10.  使用`BufferedInputStream`和`ByteArrayOutputStream`（JDK）

    ```
    BufferedInputStream bis = new BufferedInputStream(inputStream);
    ByteArrayOutputStream buf = new ByteArrayOutputStream();
    for (int result = bis.read(); result != -1; result = bis.read()) {
        buf.write((byte) result);
    }
    // StandardCharsets.UTF_8.name() > JDK 7
    return buf.toString("UTF-8"); 
    ```

11.  使用`inputStream.read()`和`StringBuilder`（JDK）。**警告**：此解决方案存在 Unicode 问题，例如俄语文本（仅适用于非 Unicode 文本）

    ```
    StringBuilder sb = new StringBuilder();
    for (int ch; (ch = inputStream.read()) != -1; ) {
        sb.append((char) ch);
    }
    return sb.toString(); 
    ```

**警告**：

1.  解决方案 4、5 和 9 将不同的换行符转换为一个。

2.  解决方案 11 无法正确处理 Unicode 文本

**性能测试**

small `String`(length = 175), url in [github](https://github.com/Vedenin/useful-java-links/blob/master/helloworlds/5.0-other-examples/src/main/java/other_examples/ConvertInputStreamToStringBenchmark.java) (mode = Average Time, system = Linux, score 1,343 最好)的性能测试：

```
 Benchmark                         Mode  Cnt   Score   Error  Units
 8\. ByteArrayOutputStream and read (JDK)        avgt   10   1,343 ± 0,028  us/op
 6\. InputStreamReader and StringBuilder (JDK)   avgt   10   6,980 ± 0,404  us/op
10\. BufferedInputStream, ByteArrayOutputStream  avgt   10   7,437 ± 0,735  us/op
11\. InputStream.read() and StringBuilder (JDK)  avgt   10   8,977 ± 0,328  us/op
 7\. StringWriter and IOUtils.copy (Apache)      avgt   10  10,613 ± 0,599  us/op
 1\. IOUtils.toString (Apache Utils)             avgt   10  10,605 ± 0,527  us/op
 3\. Scanner (JDK)                               avgt   10  12,083 ± 0,293  us/op
 2\. CharStreams (guava)                         avgt   10  12,999 ± 0,514  us/op
 4\. Stream Api (Java 8)                         avgt   10  15,811 ± 0,605  us/op
 9\. BufferedReader (JDK)                        avgt   10  16,038 ± 0,711  us/op
 5\. parallel Stream Api (Java 8)                avgt   10  21,544 ± 0,583  us/op 
```

big `String`(length = 50100), url in [github](https://github.com/Vedenin/useful-java-links/blob/master/helloworlds/5.0-other-examples/src/main/java/other_examples/ConvertBigStringToInputStreamBenchmark.java) (mode = Average Time, system = Linux, score 200,715 最好)的性能测试：

```
 Benchmark                        Mode  Cnt   Score        Error  Units
 8\. ByteArrayOutputStream and read (JDK)        avgt   10   200,715 ±   18,103  us/op
 1\. IOUtils.toString (Apache Utils)             avgt   10   300,019 ±    8,751  us/op
 6\. InputStreamReader and StringBuilder (JDK)   avgt   10   347,616 ±  130,348  us/op
 7\. StringWriter and IOUtils.copy (Apache)      avgt   10   352,791 ±  105,337  us/op
 2\. CharStreams (guava)                         avgt   10   420,137 ±   59,877  us/op
 9\. BufferedReader (JDK)                        avgt   10   632,028 ±   17,002  us/op
 5\. parallel Stream Api (Java 8)                avgt   10   662,999 ±   46,199  us/op
 4\. Stream Api (Java 8)                         avgt   10   701,269 ±   82,296  us/op
10\. BufferedInputStream, ByteArrayOutputStream  avgt   10   740,837 ±    5,613  us/op
 3\. Scanner (JDK)                               avgt   10   751,417 ±   62,026  us/op
11\. InputStream.read() and StringBuilder (JDK)  avgt   10  2919,350 ± 1101,942  us/op 
```

图表（性能测试取决于 Windows 7 系统中的输入流长度）
[![在此处输入图像描述](https://i.stack.imgur.com/AYYhz.png)](https://i.stack.imgur.com/AYYhz.png)

性能测试（平均时间）取决于 Windows 7 系统中的输入流长度：

```
 length  182    546     1092    3276    9828    29484   58968

 test8  0.38    0.938   1.868   4.448   13.412  36.459  72.708
 test4  2.362   3.609   5.573   12.769  40.74   81.415  159.864
 test5  3.881   5.075   6.904   14.123  50.258  129.937 166.162
 test9  2.237   3.493   5.422   11.977  45.98   89.336  177.39
 test6  1.261   2.12    4.38    10.698  31.821  86.106  186.636
 test7  1.601   2.391   3.646   8.367   38.196  110.221 211.016
 test1  1.529   2.381   3.527   8.411   40.551  105.16  212.573
 test3  3.035   3.934   8.606   20.858  61.571  118.744 235.428
 test2  3.136   6.238   10.508  33.48   43.532  118.044 239.481
 test10 1.593   4.736   7.527   20.557  59.856  162.907 323.147
 test11 3.913   11.506  23.26   68.644  207.591 600.444 1211.545 
```

* * *

## 回答 #2

> 赞同：2724
> 
> 时间：2008-11-21T16:54:20.960

一个很好的方法是使用[Apache commons](http://commons.apache.org/) `[IOUtils](https://commons.apache.org/proper/commons-io/javadocs/api-release/org/apache/commons/io/IOUtils.html)`将其复制`InputStream`到`StringWriter`... 之类的

```
StringWriter writer = new StringWriter();
IOUtils.copy(inputStream, writer, encoding);
String theString = writer.toString(); 
```

甚至

```
// NB: does not close inputStream, you'll have to use try-with-resources for that
String theString = IOUtils.toString(inputStream, encoding); 
```

或者，`ByteArrayOutputStream`如果您不想混合使用 Streams 和 Writers ，则可以使用

* * *

## 回答 #3

> 赞同：2343
> 
> 时间：2011-03-26T20:40:25.823

这是一种仅使用标准 Java 库的方法（请注意，流未关闭，您的里程可能会有所不同）。

```
static String convertStreamToString(java.io.InputStream is) {
    java.util.Scanner s = new java.util.Scanner(is).useDelimiter("\\A");
    return s.hasNext() ? s.next() : "";
} 
```

我从[“愚蠢的扫描仪技巧”](https://community.oracle.com/blogs/pat/2004/10/23/stupid-scanner-tricks)文章中学到了这个技巧。它起作用的原因是因为[Scanner](http://download.oracle.com/javase/8/docs/api/java/util/Scanner.html)迭代流中的标记，在这种情况下，我们使用“输入边界的开始”（\A）分隔标记，因此只为流的全部内容提供一个标记。

**注意，如果您需要具体说明输入流的编码，您可以向`Scanner`构造函数提供第二个参数，指示要使用的字符集（例如“UTF-8”）。**

帽子小费也送给[雅各布](https://stackoverflow.com/users/68127/jacob-gabrielson)，他曾经向我指出上述文章。

* * *

## 回答 #4

> 赞同：876
> 
> 时间：2008-12-08T20:13:42.033

Apache Commons 允许：

```
String myString = IOUtils.toString(myInputStream, "UTF-8"); 
```

当然，您可以选择除 UTF-8 之外的其他字符编码。

另见：（[文档](http://commons.apache.org/proper/commons-io/javadocs/api-2.4/org/apache/commons/io/IOUtils.html#toString%28java.io.InputStream,%20java.lang.String)）

* * *

## 回答 #5

> 赞同：311
> 
> 时间：2008-11-21T18:34:11.147

考虑到文件一个应该首先得到一个`java.io.Reader`实例。然后可以读取它并将其添加到 a （如果我们不在多个线程中访问它，我们`StringBuilder`不需要，并且速度更快）。这里的诀窍是我们在块中工作，因此不需要其他缓冲流。块大小被参数化以用于运行时性能优化。`StringBuffer``StringBuilder`

```
public static String slurp(final InputStream is, final int bufferSize) {
    final char[] buffer = new char[bufferSize];
    final StringBuilder out = new StringBuilder();
    try (Reader in = new InputStreamReader(is, "UTF-8")) {
        for (;;) {
            int rsz = in.read(buffer, 0, buffer.length);
            if (rsz < 0)
                break;
            out.append(buffer, 0, rsz);
        }
    }
    catch (UnsupportedEncodingException ex) {
        /* ... */
    }
    catch (IOException ex) {
        /* ... */
    }
    return out.toString();
} 
```

* * *

## 回答 #6

> 赞同：263
> 
> 时间：2011-08-04T08:29:44.007

采用：

```
InputStream in = /* Your InputStream */;
StringBuilder sb = new StringBuilder();
BufferedReader br = new BufferedReader(new InputStreamReader(in));
String read;

while ((read=br.readLine()) != null) {
    //System.out.println(read);
    sb.append(read);
}

br.close();
return sb.toString(); 
```

* * *

## 回答 #7

> 赞同：177
> 
> 时间：2010-07-13T15:56:24.490

如果您使用的是 Google-Collections/Guava，您可以执行以下操作：

```
InputStream stream = ...
String content = CharStreams.toString(new InputStreamReader(stream, Charsets.UTF_8));
Closeables.closeQuietly(stream); 
```

请注意，第二个参数（即 Charsets.UTF_8）`InputStreamReader`不是必需的，但如果您知道编码，通常最好指定编码（您应该这样做！）

* * *

## 回答 #8

> 赞同：145
> 
> 时间：2015-09-02T11:50:45.063

为了完整起见，这里是**Java 9**解决方案：

```
public static String toString(InputStream input) throws IOException {
    return new String(input.readAllBytes(), StandardCharsets.UTF_8);
} 
```

这使用了[`readAllBytes`](https://docs.oracle.com/javase/9/docs/api/java/io/InputStream.html#readAllBytes--)添加到 Java 9 中的方法。

* * *

## 回答 #9

> 赞同：132
> 
> 时间：2012-05-08T20:24:11.537

这是最适合 Android 和任何其他 JVM 的纯 Java 解决方案。

这个解决方案运行得非常好......它简单、快速，并且在大小流上都一样！（见上面的基准.. **8 号**）

```
public String readFullyAsString(InputStream inputStream, String encoding)
        throws IOException {
    return readFully(inputStream).toString(encoding);
}

public byte[] readFullyAsBytes(InputStream inputStream)
        throws IOException {
    return readFully(inputStream).toByteArray();
}

private ByteArrayOutputStream readFully(InputStream inputStream)
        throws IOException {
    ByteArrayOutputStream baos = new ByteArrayOutputStream();
    byte[] buffer = new byte[1024];
    int length = 0;
    while ((length = inputStream.read(buffer)) != -1) {
        baos.write(buffer, 0, length);
    }
    return baos;
} 
```

* * *

## 回答 #10

> 赞同：73
> 
> 时间：2009-06-10T21:07:11.713

采用：

```
import java.io.BufferedInputStream;
import java.io.ByteArrayOutputStream;
import java.io.InputStream;
import java.io.IOException;

public static String readInputStreamAsString(InputStream in)
    throws IOException {

    BufferedInputStream bis = new BufferedInputStream(in);
    ByteArrayOutputStream buf = new ByteArrayOutputStream();
    int result = bis.read();
    while(result != -1) {
      byte b = (byte)result;
      buf.write(b);
      result = bis.read();
    }
    return buf.toString();
} 
```

* * *

## 回答 #11

> 赞同：66
> 
> 时间：2013-01-01T03:43:47.320

这是我经过一些实验后想出的最优雅的纯 Java（无库）解决方案：

```
public static String fromStream(InputStream in) throws IOException
{
    BufferedReader reader = new BufferedReader(new InputStreamReader(in));
    StringBuilder out = new StringBuilder();
    String newLine = System.getProperty("line.separator");
    String line;
    while ((line = reader.readLine()) != null) {
        out.append(line);
        out.append(newLine);
    }
    return out.toString();
} 
```

* * *

## 回答 #12

> 赞同：61
> 
> 时间：2018-02-13T21:30:08.930

我在这里对 14 个不同的答案进行了基准测试（很抱歉没有提供学分，但重复的太多了）。

结果非常令人惊讶。事实证明，Apache **IOUtils**是最慢的，`ByteArrayOutputStream`也是最快的解决方案：

所以首先这里是最好的方法：

```
public String inputStreamToString(InputStream inputStream) throws IOException {
    try(ByteArrayOutputStream result = new ByteArrayOutputStream()) {
        byte[] buffer = new byte[1024];
        int length;
        while ((length = inputStream.read(buffer)) != -1) {
            result.write(buffer, 0, length);
        }

        return result.toString(UTF_8);
    }
} 
```

## 20 个周期内 20 MB 随机字节的基准测试结果

以毫秒为单位的时间

*   字节数组输出流测试：194
*   NioStream：198
*   Java9ISTransferTo：201
*   Java9ISReadAllBytes：205
*   BufferedInputStreamVsByteArrayOutputStream：314
*   ApacheStringWriter2：574
*   GuavaCharStreams：589
*   ScannerReaderNoNextTest: 614
*   扫描仪阅读器：633
*   ApacheStringWriter：1544
*   StreamApi：错误
*   ParallelStreamApi：错误
*   BufferReaderTest：错误
*   InputStreamAndStringBuilder：错误

## 基准测试源代码

```
import com.google.common.io.CharStreams;
import org.apache.commons.io.IOUtils;

import java.io.*;
import java.nio.ByteBuffer;
import java.nio.channels.Channels;
import java.nio.channels.ReadableByteChannel;
import java.nio.channels.WritableByteChannel;
import java.util.Arrays;
import java.util.List;
import java.util.Random;
import java.util.stream.Collectors;

/**
 * Created by Ilya Gazman on 2/13/18.
 */
public class InputStreamToString {

    private static final String UTF_8 = "UTF-8";

    public static void main(String... args) {
        log("App started");
        byte[] bytes = new byte[1024 * 1024];
        new Random().nextBytes(bytes);
        log("Stream is ready\n");

        try {
            test(bytes);
        } catch (IOException e) {
            e.printStackTrace();
        }
    }

    private static void test(byte[] bytes) throws IOException {
        List<Stringify> tests = Arrays.asList(
                new ApacheStringWriter(),
                new ApacheStringWriter2(),
                new NioStream(),
                new ScannerReader(),
                new ScannerReaderNoNextTest(),
                new GuavaCharStreams(),
                new StreamApi(),
                new ParallelStreamApi(),
                new ByteArrayOutputStreamTest(),
                new BufferReaderTest(),
                new BufferedInputStreamVsByteArrayOutputStream(),
                new InputStreamAndStringBuilder(),
                new Java9ISTransferTo(),
                new Java9ISReadAllBytes()
        );

        String solution = new String(bytes, "UTF-8");

        for (Stringify test : tests) {
            try (ByteArrayInputStream inputStream = new ByteArrayInputStream(bytes)) {
                String s = test.inputStreamToString(inputStream);
                if (!s.equals(solution)) {
                    log(test.name() + ": Error");
                    continue;
                }
            }
            long startTime = System.currentTimeMillis();
            for (int i = 0; i < 20; i++) {
                try (ByteArrayInputStream inputStream = new ByteArrayInputStream(bytes)) {
                    test.inputStreamToString(inputStream);
                }
            }
            log(test.name() + ": " + (System.currentTimeMillis() - startTime));
        }
    }

    private static void log(String message) {
        System.out.println(message);
    }

    interface Stringify {
        String inputStreamToString(InputStream inputStream) throws IOException;

        default String name() {
            return this.getClass().getSimpleName();
        }
    }

    static class ApacheStringWriter implements Stringify {

        @Override
        public String inputStreamToString(InputStream inputStream) throws IOException {
            StringWriter writer = new StringWriter();
            IOUtils.copy(inputStream, writer, UTF_8);
            return writer.toString();
        }
    }

    static class ApacheStringWriter2 implements Stringify {

        @Override
        public String inputStreamToString(InputStream inputStream) throws IOException {
            return IOUtils.toString(inputStream, UTF_8);
        }
    }

    static class NioStream implements Stringify {

        @Override
        public String inputStreamToString(InputStream in) throws IOException {
            ReadableByteChannel channel = Channels.newChannel(in);
            ByteBuffer byteBuffer = ByteBuffer.allocate(1024 * 16);
            ByteArrayOutputStream bout = new ByteArrayOutputStream();
            WritableByteChannel outChannel = Channels.newChannel(bout);
            while (channel.read(byteBuffer) > 0 || byteBuffer.position() > 0) {
                byteBuffer.flip();  //make buffer ready for write
                outChannel.write(byteBuffer);
                byteBuffer.compact(); //make buffer ready for reading
            }
            channel.close();
            outChannel.close();
            return bout.toString(UTF_8);
        }
    }

    static class ScannerReader implements Stringify {

        @Override
        public String inputStreamToString(InputStream is) throws IOException {
            java.util.Scanner s = new java.util.Scanner(is).useDelimiter("\\A");
            return s.hasNext() ? s.next() : "";
        }
    }

    static class ScannerReaderNoNextTest implements Stringify {

        @Override
        public String inputStreamToString(InputStream is) throws IOException {
            java.util.Scanner s = new java.util.Scanner(is).useDelimiter("\\A");
            return s.next();
        }
    }

    static class GuavaCharStreams implements Stringify {

        @Override
        public String inputStreamToString(InputStream is) throws IOException {
            return CharStreams.toString(new InputStreamReader(
                    is, UTF_8));
        }
    }

    static class StreamApi implements Stringify {

        @Override
        public String inputStreamToString(InputStream inputStream) throws IOException {
            return new BufferedReader(new InputStreamReader(inputStream))
                    .lines().collect(Collectors.joining("\n"));
        }
    }

    static class ParallelStreamApi implements Stringify {

        @Override
        public String inputStreamToString(InputStream inputStream) throws IOException {
            return new BufferedReader(new InputStreamReader(inputStream)).lines()
                    .parallel().collect(Collectors.joining("\n"));
        }
    }

    static class ByteArrayOutputStreamTest implements Stringify {

        @Override
        public String inputStreamToString(InputStream inputStream) throws IOException {
            try(ByteArrayOutputStream result = new ByteArrayOutputStream()) {
                byte[] buffer = new byte[1024];
                int length;
                while ((length = inputStream.read(buffer)) != -1) {
                    result.write(buffer, 0, length);
                }

                return result.toString(UTF_8);
            }
        }
    }

    static class BufferReaderTest implements Stringify {

        @Override
        public String inputStreamToString(InputStream inputStream) throws IOException {
            String newLine = System.getProperty("line.separator");
            BufferedReader reader = new BufferedReader(new InputStreamReader(inputStream));
            StringBuilder result = new StringBuilder(UTF_8);
            String line;
            boolean flag = false;
            while ((line = reader.readLine()) != null) {
                result.append(flag ? newLine : "").append(line);
                flag = true;
            }
            return result.toString();
        }
    }

    static class BufferedInputStreamVsByteArrayOutputStream implements Stringify {

        @Override
        public String inputStreamToString(InputStream inputStream) throws IOException {
            BufferedInputStream bis = new BufferedInputStream(inputStream);
            ByteArrayOutputStream buf = new ByteArrayOutputStream();
            int result = bis.read();
            while (result != -1) {
                buf.write((byte) result);
                result = bis.read();
            }

            return buf.toString(UTF_8);
        }
    }

    static class InputStreamAndStringBuilder implements Stringify {

        @Override
        public String inputStreamToString(InputStream inputStream) throws IOException {
            int ch;
            StringBuilder sb = new StringBuilder(UTF_8);
            while ((ch = inputStream.read()) != -1)
                sb.append((char) ch);
            return sb.toString();
        }
    }

    static class Java9ISTransferTo implements Stringify {

        @Override
        public String inputStreamToString(InputStream inputStream) throws IOException {
            ByteArrayOutputStream bos = new ByteArrayOutputStream();
            inputStream.transferTo(bos);
            return bos.toString(UTF_8);
        }
    }

    static class Java9ISReadAllBytes implements Stringify {

        @Override
        public String inputStreamToString(InputStream inputStream) throws IOException {
            return new String(inputStream.readAllBytes(), UTF_8);
        }
    }

} 
```

* * *

## 回答 #13

> 赞同：41
> 
> 时间：2014-07-17T17:58:02.157

我会使用一些 Java 8 技巧。

```
public static String streamToString(final InputStream inputStream) throws Exception {
    // buffering optional
    try
    (
        final BufferedReader br
           = new BufferedReader(new InputStreamReader(inputStream))
    ) {
        // parallel optional
        return br.lines().parallel().collect(Collectors.joining("\n"));
    } catch (final IOException e) {
        throw new RuntimeException(e);
        // whatever.
    }
} 
```

除了更简洁之外，与其他一些答案基本相同。

* * *

## 回答 #14

> 赞同：37
> 
> 时间：2011-10-12T17:23:01.347

我进行了一些计时测试，因为时间总是很重要。

我试图以 3 种不同的方式将响应转换为字符串。（如下所示）
为了便于阅读，我省略了 try/catch 块。

为了给出上下文，这是所有 3 种方法的前面代码：

```
 String response;
   String url = "www.blah.com/path?key=value";
   GetMethod method = new GetMethod(url);
   int status = client.executeMethod(method); 
```

1)

```
 response = method.getResponseBodyAsString(); 
```

2)

```
InputStream resp = method.getResponseBodyAsStream();
InputStreamReader is=new InputStreamReader(resp);
BufferedReader br=new BufferedReader(is);
String read = null;
StringBuffer sb = new StringBuffer();
while((read = br.readLine()) != null) {
    sb.append(read);
}
response = sb.toString(); 
```

3)

```
InputStream iStream  = method.getResponseBodyAsStream();
StringWriter writer = new StringWriter();
IOUtils.copy(iStream, writer, "UTF-8");
response = writer.toString(); 
```

因此，在使用相同的请求/响应数据对每种方法运行 500 次测试之后，这里是数字。再一次，这些是我的发现，你的发现可能并不完全相同，但我写这篇文章是为了向其他人说明这些方法的效率差异。

排名：
方法 #1
方法 #3 - 比 #1 慢 2.6%
方法 #2 - 比 #1 慢 4.3%

这些方法中的任何一种都是获取响应并从中创建字符串的合适解决方案。

* * *

## 回答 #15

> 赞同：36
> 
> 时间：2015-02-26T18:39:52.800

[使用Stream](http://docs.oracle.com/javase/8/docs/api/java/util/stream/Stream.html)的纯 Java 解决方案，从 Java 8 开始工作。

```
import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStream;
import java.io.InputStreamReader;
import java.util.stream.Collectors;

// ...
public static String inputStreamToString(InputStream is) throws IOException {
    try (BufferedReader br = new BufferedReader(new InputStreamReader(is))) {
        return br.lines().collect(Collectors.joining(System.lineSeparator()));
    }
} 
```

正如 Christoffer Hammarström 在[其他答案](https://stackoverflow.com/a/309448/639687)下面所提到的，明确指定[Charset](https://docs.oracle.com/javase/8/docs/api/java/nio/charset/Charset.html)更安全。即 InputStreamReader 构造函数可以更改如下：

```
new InputStreamReader(is, Charset.forName("UTF-8")) 
```

* * *

## 回答 #16

> 赞同：28
> 
> 时间：2012-03-30T19:52:31.960

这里或多或少是 sampath 的答案，稍微清理一下并表示为一个函数：

```
String streamToString(InputStream in) throws IOException {
  StringBuilder out = new StringBuilder();
  BufferedReader br = new BufferedReader(new InputStreamReader(in));
  for(String line = br.readLine(); line != null; line = br.readLine()) 
    out.append(line);
  br.close();
  return out.toString();
} 
```

* * *

## 回答 #17

> 赞同：27
> 
> 时间：2012-03-07T07:32:10.243

如果您喜欢冒险，您可以混合使用 Scala 和 Java，然后得到以下结果：

```
scala.io.Source.fromInputStream(is).mkString("") 
```

混合 Java 和 Scala 代码和库有它的好处。

在此处查看完整描述：[Idiomatic way to convert an InputStream to a String in Scala](https://stackoverflow.com/q/5221524/828757)

* * *

## 回答 #18

> 赞同：26
> 
> 时间：2010-05-18T12:57:53.437

如果您不能使用 Commons IO (FileUtils/IOUtils/CopyUtils)，下面是一个使用 BufferedReader 逐行读取文件的示例：

```
public class StringFromFile {
    public static void main(String[] args) /*throws UnsupportedEncodingException*/ {
        InputStream is = StringFromFile.class.getResourceAsStream("file.txt");
        BufferedReader br = new BufferedReader(new InputStreamReader(is/*, "UTF-8"*/));
        final int CHARS_PER_PAGE = 5000; //counting spaces
        StringBuilder builder = new StringBuilder(CHARS_PER_PAGE);
        try {
            for(String line=br.readLine(); line!=null; line=br.readLine()) {
                builder.append(line);
                builder.append('\n');
            }
        } 
        catch (IOException ignore) { }

        String text = builder.toString();
        System.out.println(text);
    }
} 
```

或者，如果您想要原始速度，我会提出 Paul de Vrieze 建议的变体（避免使用 StringWriter（在内部使用 StringBuffer）：

```
public class StringFromFileFast {
    public static void main(String[] args) /*throws UnsupportedEncodingException*/ {
        InputStream is = StringFromFileFast.class.getResourceAsStream("file.txt");
        InputStreamReader input = new InputStreamReader(is/*, "UTF-8"*/);
        final int CHARS_PER_PAGE = 5000; //counting spaces
        final char[] buffer = new char[CHARS_PER_PAGE];
        StringBuilder output = new StringBuilder(CHARS_PER_PAGE);
        try {
            for(int read = input.read(buffer, 0, buffer.length);
                    read != -1;
                    read = input.read(buffer, 0, buffer.length)) {
                output.append(buffer, 0, read);
            }
        } catch (IOException ignore) { }

        String text = output.toString();
        System.out.println(text);
    }
} 
```

* * *

## 回答 #19

> 赞同：21
> 
> 时间：2016-01-28T15:55:21.727

使用Java 9 中支持的[java.io.InputStream.transferTo(OutputStream)](https://docs.oracle.com/javase/9/docs/api/java/io/InputStream.html#transferTo-java.io.OutputStream-)和采用字符集名称的[ByteArrayOutputStream.toString(String) ：](https://docs.oracle.com/javase/9/docs/api/java/io/ByteArrayOutputStream.html#toString-java.lang.String-)

```
public static String gobble(InputStream in, String charsetName) throws IOException {
    ByteArrayOutputStream bos = new ByteArrayOutputStream();
    in.transferTo(bos);
    return bos.toString(charsetName);
} 
```

* * *

## 回答 #20

> 赞同：20
> 
> 时间：2012-11-17T12:39:05.803

如果您使用流阅读器，请确保在最后关闭流

```
private String readStream(InputStream iStream) throws IOException {
    //build a Stream Reader, it can read char by char
    InputStreamReader iStreamReader = new InputStreamReader(iStream);
    //build a buffered Reader, so that i can read whole line at once
    BufferedReader bReader = new BufferedReader(iStreamReader);
    String line = null;
    StringBuilder builder = new StringBuilder();
    while((line = bReader.readLine()) != null) {  //Read till end
        builder.append(line);
        builder.append("\n"); // append new line to preserve lines
    }
    bReader.close();         //close all opened stuff
    iStreamReader.close();
    //iStream.close(); //EDIT: Let the creator of the stream close it!
                       // some readers may auto close the inner stream
    return builder.toString();
} 
```

* * *

编辑：在 JDK 7+ 上，您可以使用 try-with-resources 构造。

```
/**
 * Reads the stream into a string
 * @param iStream the input stream
 * @return the string read from the stream
 * @throws IOException when an IO error occurs
 */
private String readStream(InputStream iStream) throws IOException {

    //Buffered reader allows us to read line by line
    try (BufferedReader bReader =
                 new BufferedReader(new InputStreamReader(iStream))){
        StringBuilder builder = new StringBuilder();
        String line;
        while((line = bReader.readLine()) != null) {  //Read till end
            builder.append(line);
            builder.append("\n"); // append new line to preserve lines
        }
        return builder.toString();
    }
} 
```

* * *

## 回答 #21

> 赞同：19
> 
> 时间：2014-06-08T07:46:30.557

这个很好，因为：

*   它安全地处理字符集。
*   您可以控制读取缓冲区的大小。
*   您可以设置构建器的长度，它不必是精确值。
*   没有库依赖。
*   适用于 Java 7 或更高版本。

*怎么做？*

```
public static String convertStreamToString(InputStream is) throws IOException {
   StringBuilder sb = new StringBuilder(2048); // Define a size if you have an idea of it.
   char[] read = new char[128]; // Your buffer size.
   try (InputStreamReader ir = new InputStreamReader(is, StandardCharsets.UTF_8)) {
     for (int i; -1 != (i = ir.read(read)); sb.append(read, 0, i));
   }
   return sb.toString();
} 
```

对于 JDK 9

```
public static String inputStreamString(InputStream inputStream) throws IOException {
    try (inputStream) {
        return new String(inputStream.readAllBytes(), StandardCharsets.UTF_8);
    }
} 
```

* * *

## 回答 #22

> 赞同：19
> 
> 时间：2014-08-03T09:47:56.910

`org.apache.commons.io.IOUtils` [这是改编自源代码](http://grepcode.com/file/repo1.maven.org/maven2/commons-io/commons-io/2.4/org/apache/commons/io/IOUtils.java)的答案，适用于那些想要 apache 实现但不想要整个库的人。

```
private static final int BUFFER_SIZE = 4 * 1024;

public static String inputStreamToString(InputStream inputStream, String charsetName)
        throws IOException {
    StringBuilder builder = new StringBuilder();
    InputStreamReader reader = new InputStreamReader(inputStream, charsetName);
    char[] buffer = new char[BUFFER_SIZE];
    int length;
    while ((length = reader.read(buffer)) != -1) {
        builder.append(buffer, 0, length);
    }
    return builder.toString();
} 
```

* * *

## 回答 #23

> 赞同：19
> 
> 时间：2020-04-05T00:03:47.143

```
String inputStreamToString(InputStream inputStream, Charset charset) throws IOException {
    try (
            final StringWriter writer = new StringWriter();
            final InputStreamReader reader = new InputStreamReader(inputStream, charset)
        ) {
        reader.transferTo(writer);
        return writer.toString();
    }
} 
```

*   纯 Java 标准库解决方案 - 无库
*   从 Java 10 开始 - [Reader#transferTo(java.io.Writer)](https://docs.oracle.com/en/java/javase/14/docs/api/java.base/java/io/Reader.html#transferTo(java.io.Writer))
*   无环解决方案
*   没有换行符处理

* * *

## 回答 #24

> 赞同：17
> 
> 时间：2016-07-29T20:58:25.250

另一个，适用于所有 Spring 用户：

```
import java.nio.charset.StandardCharsets;
import org.springframework.util.FileCopyUtils;

public String convertStreamToString(InputStream is) throws IOException { 
    return new String(FileCopyUtils.copyToByteArray(is), StandardCharsets.UTF_8);
} 
```

中的实用方法`org.springframework.util.StreamUtils`类似于 中的实用方法`FileCopyUtils`，但它们在完成时使流保持打开状态。

* * *

## 回答 #25

> 赞同：16
> 
> 时间：2014-04-09T10:37:52.460

这是在不使用任何第三方库的情况下转换`InputStream`为的完整方法。`String`用于`StringBuilder`单线程环境，否则使用`StringBuffer`.

```
public static String getString( InputStream is) throws IOException {
    int ch;
    StringBuilder sb = new StringBuilder();
    while((ch = is.read()) != -1)
        sb.append((char)ch);
    return sb.toString();
} 
```

* * *

## 回答 #26

> 赞同：16
> 
> 时间：2015-02-04T01:12:24.673

Kotlin 用户只需执行以下操作：

```
println(InputStreamReader(is).readText()) 
```

然而

```
readText() 
```

是 Kotlin 标准库的内置扩展方法。

* * *

## 回答 #27

> 赞同：15
> 
> 时间：2012-11-02T12:37:53.307

以下是使用字节数组缓冲区仅使用 JDK 的方法。这实际上是 commons-io`IOUtils.copy()`方法的全部工作方式。如果您从 a而不是复制，则可以替换`byte[]`为。`char[]``Reader``InputStream`

```
import java.io.ByteArrayOutputStream;
import java.io.InputStream;

...

InputStream is = ....
ByteArrayOutputStream baos = new ByteArrayOutputStream(8192);
byte[] buffer = new byte[8192];
int count = 0;
try {
  while ((count = is.read(buffer)) != -1) {
    baos.write(buffer, 0, count);
  }
}
finally {
  try {
    is.close();
  }
  catch (Exception ignore) {
  }
}

String charset = "UTF-8";
String inputStreamAsString = baos.toString(charset); 
```

* * *

## 回答 #28

> 赞同：10
> 
> 时间：2016-08-09T20:18:26.087

JDK 中最简单的方法是使用以下代码片段。

```
String convertToString(InputStream in){
    String resource = new Scanner(in).useDelimiter("\\Z").next();
    return resource;
} 
```

* * *

## 回答 #29

> 赞同：9
> 
> 时间：2016-01-21T14:28:38.293

用`reduce`,`concat`在 Java 8 中可以表示为：

```
String fromFile = new BufferedReader(new   
InputStreamReader(inputStream)).lines().reduce(String::concat).get(); 
```

* * *

## 回答 #30

> 赞同：8
> 
> 时间：2015-09-02T11:19:27.193

这是我的基于**Java 8**的解决方案，它使用*新的 Stream API*从以下位置收集所有行`InputStream`：

```
public static String toString(InputStream inputStream) {
    BufferedReader reader = new BufferedReader(
        new InputStreamReader(inputStream));
    return reader.lines().collect(Collectors.joining(
        System.getProperty("line.separator")));
} 
```

* * *

## 回答 #31

> 赞同：5
> 
> 时间：2012-07-24T10:19:19.867

下面的代码对我有用。

```
URL url = MyClass.class.getResource("/" + configFileName);
BufferedInputStream bi = (BufferedInputStream) url.getContent();
byte[] buffer = new byte[bi.available() ];
int bytesRead = bi.read(buffer);
String out = new String(buffer); 
```

请注意，根据 Java 文档，该`available()`方法可能不适用于`InputStream`但始终适用于`BufferedInputStream`. 如果您不想使用`available()`方法，我们可以随时使用以下代码

```
URL url = MyClass.class.getResource("/" + configFileName);
BufferedInputStream bi = (BufferedInputStream) url.getContent();
File f = new File(url.getPath());
byte[] buffer = new byte[ (int) f.length()];
int bytesRead = bi.read(buffer);
String out = new String(buffer); 
```

我不确定是否会有任何编码问题。请评论，如果代码有任何问题。

* * *

## 回答 #32

> 赞同：5
> 
> 时间：2013-03-09T20:13:49.450

好吧，你可以自己编程......这并不复杂......

```
String Inputstream2String (InputStream is) throws IOException
    {
        final int PKG_SIZE = 1024;
        byte[] data = new byte [PKG_SIZE];
        StringBuilder buffer = new StringBuilder(PKG_SIZE * 10);
        int size;

        size = is.read(data, 0, data.length);
        while (size > 0)
        {
            String str = new String(data, 0, size);
            buffer.append(str);
            size = is.read(data, 0, data.length);
        }
        return buffer.toString();
    } 
```

* * *

## 回答 #33

> 赞同：5
> 
> 时间：2013-12-05T17:53:07.687

JDK 7/8 答案关闭了流并仍然抛出 IOException：

```
StringBuilder build = new StringBuilder();
byte[] buf = new byte[1024];
int length;
try (InputStream is = getInputStream()) {
  while ((length = is.read(buf)) != -1) {
    build.append(new String(buf, 0, length));
  }
} 
```

* * *

## 回答 #34

> 赞同：5
> 
> 时间：2014-02-20T17:24:38.347

我写了一个可以做到这一点的课程，所以我想我会与大家分享。有时您不想仅仅为了一件事而添加 Apache Commons，并且想要比不检查内容的 Scanner 更愚蠢的东西。

用法如下

```
// Read from InputStream
String data = new ReaderSink(inputStream, Charset.forName("UTF-8")).drain();

// Read from File
data = new ReaderSink(file, Charset.forName("UTF-8")).drain();

// Drain input stream to console
new ReaderSink(inputStream, Charset.forName("UTF-8")).drainTo(System.out); 
```

这是 ReaderSink 的代码：

```
import java.io.*;
import java.nio.charset.Charset;

/**
 * A simple sink class that drains a {@link Reader} to a {@link String} or
 * to a {@link Writer}.
 *
 * @author Ben Barkay
 * @version 2/20/2014
 */
public class ReaderSink {
    /**
     * The default buffer size to use if no buffer size was specified.
     */
    public static final int DEFAULT_BUFFER_SIZE = 1024;

    /**
     * The {@link Reader} that will be drained.
     */
    private final Reader in;

    /**
     * Constructs a new {@code ReaderSink} for the specified file and charset.
     * @param file      The file to read from.
     * @param charset   The charset to use.
     * @throws FileNotFoundException    If the file was not found on the filesystem.
     */
    public ReaderSink(File file, Charset charset) throws FileNotFoundException {
        this(new FileInputStream(file), charset);
    }

    /**
     * Constructs a new {@code ReaderSink} for the specified {@link InputStream}.
     * @param in        The {@link InputStream} to drain.
     * @param charset   The charset to use.
     */
    public ReaderSink(InputStream in, Charset charset) {
        this(new InputStreamReader(in, charset));
    }

    /**
     * Constructs a new {@code ReaderSink} for the specified {@link Reader}.
     * @param in    The reader to drain.
     */
    public ReaderSink(Reader in) {
        this.in = in;
    }

    /**
     * Drains the data from the underlying {@link Reader}, returning a {@link String} containing
     * all of the read information. This method will use {@link #DEFAULT_BUFFER_SIZE} for
     * its buffer size.
     * @return  A {@link String} containing all of the information that was read.
     */
    public String drain() throws IOException {
        return drain(DEFAULT_BUFFER_SIZE);
    }

    /**
     * Drains the data from the underlying {@link Reader}, returning a {@link String} containing
     * all of the read information.
     * @param bufferSize    The size of the buffer to use when reading.
     * @return  A {@link String} containing all of the information that was read.
     */
    public String drain(int bufferSize) throws IOException {
        StringWriter stringWriter = new StringWriter();
        drainTo(stringWriter, bufferSize);
        return stringWriter.toString();
    }

    /**
     * Drains the data from the underlying {@link Reader}, writing it to the
     * specified {@link Writer}. This method will use {@link #DEFAULT_BUFFER_SIZE} for
     * its buffer size.
     * @param out   The {@link Writer} to write to.
     */
    public void drainTo(Writer out) throws IOException {
        drainTo(out, DEFAULT_BUFFER_SIZE);
    }

    /**
     * Drains the data from the underlying {@link Reader}, writing it to the
     * specified {@link Writer}.
     * @param out           The {@link Writer} to write to.
     * @param bufferSize    The size of the buffer to use when reader.
     */
    public void drainTo(Writer out, int bufferSize) throws IOException {
        char[] buffer = new char[bufferSize];
        int read;
        while ((read = in.read(buffer)) > -1) {
            out.write(buffer, 0, read);
        }
    }
} 
```

* * *

## 回答 #35

> 赞同：5
> 
> 时间：2015-12-24T11:08:53.673

基于[已接受的 Apache Commons 答案](https://stackoverflow.com/questions/309424/read-convert-an-inputstream-to-a-string?page=1&tab=votes#309448)的第二部分，但填补了始终关闭流的小空白：

```
 String theString;
    try {
        theString = IOUtils.toString(inputStream, encoding);
    } finally {
        IOUtils.closeQuietly(inputStream);
    } 
```

* * *

## 回答 #36

> 赞同：4
> 
> 时间：2014-01-16T14:03:45.767

您可以使用 Apache Commons。

在 IOUtils 中，您可以找到具有三个有用实现的 toString 方法。

```
public static String toString(InputStream input) throws IOException {
        return toString(input, Charset.defaultCharset());
}

public static String toString(InputStream input) throws IOException {
        return toString(input, Charset.defaultCharset());
}

public static String toString(InputStream input, String encoding)
            throws IOException {
        return toString(input, Charsets.toCharset(encoding));
} 
```

* * *

## 回答 #37

> 赞同：4
> 
> 时间：2014-02-07T05:17:11.203

试试这4个语句..

根据 Fred 回忆的观点，不建议附加`String`with`+=`运算符，因为每次将新对象`char`附加到现有对象时，都会再次`String`创建一个新`String`对象并将其地址分配给`st`旧`st`对象成为垃圾。

```
public String convertStreamToString(InputStream is)
{
    int k;
    StringBuffer sb=new StringBuffer();
    while((k=fin.read()) != -1)
    {
        sb.append((char)k);
    }
    return sb.toString();
} 
```

* * *

**不推荐，但这也是一种方式**

```
public String convertStreamToString(InputStream is) { 
    int k;
    String st="";
    while((k=is.read()) != -1)
    {
        st+=(char)k;
    }
    return st;
} 
```

* * *

## 回答 #38

> 赞同：4
> 
> 时间：2014-08-25T12:30:46.593

```
InputStream is = Context.openFileInput(someFileName); // whatever format you have

ByteArrayOutputStream bos = new ByteArrayOutputStream();

byte[] b = new byte[8192];
for (int bytesRead; (bytesRead = is.read(b)) != -1;) {
    bos.write(b, 0, bytesRead);
}

String output = bos.toString(someEncoding); 
```

* * *

## 回答 #39

> 赞同：4
> 
> 时间：2015-07-09T13:20:56.260

如果输入流来自类路径资源（这似乎是流行的任务），[Guava 提供了更短的高效自动关闭解决方案：](https://code.google.com/p/guava-libraries/wiki/IOExplained)

```
byte[] bytes = Resources.toByteArray(classLoader.getResource(path)); 
```

或者

```
String text = Resources.toString(classLoader.getResource(path), StandardCharsets.UTF_8); 
```

还有[ByteSource](http://docs.guava-libraries.googlecode.com/git-history/release/javadoc/com/google/common/io/ByteSource.html)和[CharSource](http://docs.guava-libraries.googlecode.com/git-history/release/javadoc/com/google/common/io/CharSource.html)的一般概念，它们温和地处理打开和关闭流。

因此，例如，不要显式打开一个小文件来读取其内容：

```
String content = Files.asCharSource(new File("robots.txt"), StandardCharsets.UTF_8).read();
byte[] data = Files.asByteSource(new File("favicon.ico")).read(); 
```

要不就

```
String content = Files.toString(new File("robots.txt"), StandardCharsets.UTF_8);
byte[] data = Files.toByteArray(new File("favicon.ico")); 
```

* * *

## 回答 #40

> 赞同：4
> 
> 时间：2017-01-26T19:40:23.513

[在 Groovy 中](http://docs.groovy-lang.org/latest/html/groovy-jdk/java/io/InputStream.html#getText())

```
inputStream.getText() 
```

* * *

## 回答 #41

> 赞同：4
> 
> 时间：2017-05-10T11:38:07.673

*Raghu K Nair*是唯一使用扫描仪的人。我使用的代码有点不同：

```
String convertToString(InputStream in){
    Scanner scanner = new Scanner(in)
    scanner.useDelimiter("\\A");

    boolean hasInput = scanner.hasNext();
    if (hasInput) {
        return scanner.next();
    } else {
        return null;
    }

} 
```

关于分隔符：[如何在 Java Scanner 中使用分隔符？](https://stackoverflow.com/questions/28766377/how-do-i-use-a-delimiter-in-java-scanner)

* * *

## 回答 #42

> 赞同：3
> 
> 时间：2017-01-09T05:42:53.883

```
public String read(InputStream in) throws IOException {
    try (BufferedReader buffer = new BufferedReader(new InputStreamReader(in))) {
        return buffer.lines().collect(Collectors.joining("\n"));
    }
} 
```

* * *

## 回答 #43

> 赞同：3
> 
> 时间：2018-04-07T12:53:23.680

与奥基奥：

```
String result = Okio.buffer(Okio.source(inputStream)).readUtf8(); 
```

* * *

## 回答 #44

> 赞同：2
> 
> 时间：2013-05-30T14:52:24.690

```
InputStreamReader i = new InputStreamReader(s);
BufferedReader str = new BufferedReader(i);
String msg = str.readLine();
System.out.println(msg); 
```

这里 s 是你的`InputStream`对象，它将被转换成`String`

* * *

## 回答 #45

> 赞同：2
> 
> 时间：2017-08-06T18:08:30.527

您可以使用[Cactoos](http://www.cactoos.org)：

```
String text = new TextOf(inputStream).asString(); 
```

UTF-8 编码是默认编码。如果您需要另一个：

```
String text = new TextOf(inputStream, "UTF-16").asString(); 
```

* * *

## 回答 #46

> 赞同：2
> 
> 时间：2018-06-28T12:45:51.530

我已经创建了这段代码，它可以工作。不需要外部插件。

有一个转换器`String`to`Stream`和`Stream`to `String`：

```
import java.io.ByteArrayInputStream;
import java.io.InputStream;

public class STRINGTOSTREAM {

    public static void main(String[] args)
    {
        String text = "Hello Bhola..!\nMy Name Is Kishan ";

        InputStream strm = new ByteArrayInputStream(text.getBytes());    // Convert String to Stream

        String data = streamTostring(strm);

        System.out.println(data);
    }

    static String streamTostring(InputStream stream)
    {
        String data = "";

        try
        {
            StringBuilder stringbuld = new StringBuilder();
            int i;
            while ((i=stream.read())!=-1)
            {
                stringbuld.append((char)i);
            }
            data = stringbuld.toString();
        }
        catch(Exception e)
        {
            data = "No data Streamed.";
        }
        return data;
    } 
```

* * *

## 回答 #47

> 赞同：2
> 
> 时间：2018-11-07T23:21:37.777

# ISO-8859-1

如果您知道输入流的编码是 ISO-8859-1 或 ASCII，这是一种**非常高效的方法。**`StringWriter`它 (1) 避免了's internal中出现的不必要的同步`StringBuffer`，(2) 避免了 的开销`InputStreamReader`，并且 (3) 最小化了`StringBuilder`'s internal`char`数组必须被复制的次数。

```
public static String iso_8859_1(InputStream is) throws IOException {
    StringBuilder chars = new StringBuilder(Math.max(is.available(), 4096));
    byte[] buffer = new byte[4096];
    int n;
    while ((n = is.read(buffer)) != -1) {
        for (int i = 0; i < n; i++) {
            chars.append((char)(buffer[i] & 0xFF));
        }
    }
    return chars.toString();
} 
```

# UTF-8

相同的通用策略可用于使用 UTF-8 编码的流：

```
public static String utf8(InputStream is) throws IOException {
    StringBuilder chars = new StringBuilder(Math.max(is.available(), 4096));
    byte[] buffer = new byte[4096];
    int n;
    int state = 0;
    while ((n = is.read(buffer)) != -1) {
        for (int i = 0; i < n; i++) {
            if ((state = nextStateUtf8(state, buffer[i])) >= 0) {
                chars.appendCodePoint(state);
            } else if (state == -1) { //error
                state = 0;
                chars.append('\uFFFD'); //replacement char
            }
        }
    }
    return chars.toString();
} 
```

其中`nextStateUtf8()`函数定义如下：

```
/**
 * Returns the next UTF-8 state given the next byte of input and the current state.
 * If the input byte is the last byte in a valid UTF-8 byte sequence,
 * the returned state will be the corresponding unicode character (in the range of 0 through 0x10FFFF).
 * Otherwise, a negative integer is returned. A state of -1 is returned whenever an
 * invalid UTF-8 byte sequence is detected.
 */
static int nextStateUtf8(int currentState, byte nextByte) {
    switch (currentState & 0xF0000000) {
        case 0:
            if ((nextByte & 0x80) == 0) { //0 trailing bytes (ASCII)
                return nextByte;
            } else if ((nextByte & 0xE0) == 0xC0) { //1 trailing byte
                if (nextByte == (byte) 0xC0 || nextByte == (byte) 0xC1) { //0xCO & 0xC1 are overlong
                    return -1;
                } else {
                    return nextByte & 0xC000001F;
                }
            } else if ((nextByte & 0xF0) == 0xE0) { //2 trailing bytes
                if (nextByte == (byte) 0xE0) { //possibly overlong
                    return nextByte & 0xA000000F;
                } else if (nextByte == (byte) 0xED) { //possibly surrogate
                    return nextByte & 0xB000000F;
                } else {
                    return nextByte & 0x9000000F;
                }
            } else if ((nextByte & 0xFC) == 0xF0) { //3 trailing bytes
                if (nextByte == (byte) 0xF0) { //possibly overlong
                    return nextByte & 0x80000007;
                } else {
                    return nextByte & 0xE0000007;
                }
            } else if (nextByte == (byte) 0xF4) { //3 trailing bytes, possibly undefined
                return nextByte & 0xD0000007;
            } else {
                return -1;
            }
        case 0xE0000000: //3rd-to-last continuation byte
            return (nextByte & 0xC0) == 0x80 ? currentState << 6 | nextByte & 0x9000003F : -1;
        case 0x80000000: //3rd-to-last continuation byte, check overlong
            return (nextByte & 0xE0) == 0xA0 || (nextByte & 0xF0) == 0x90 ? currentState << 6 | nextByte & 0x9000003F : -1;
        case 0xD0000000: //3rd-to-last continuation byte, check undefined
            return (nextByte & 0xF0) == 0x80 ? currentState << 6 | nextByte & 0x9000003F : -1;
        case 0x90000000: //2nd-to-last continuation byte
            return (nextByte & 0xC0) == 0x80 ? currentState << 6 | nextByte & 0xC000003F : -1;
        case 0xA0000000: //2nd-to-last continuation byte, check overlong
            return (nextByte & 0xE0) == 0xA0 ? currentState << 6 | nextByte & 0xC000003F : -1;
        case 0xB0000000: //2nd-to-last continuation byte, check surrogate
            return (nextByte & 0xE0) == 0x80 ? currentState << 6 | nextByte & 0xC000003F : -1;
        case 0xC0000000: //last continuation byte
            return (nextByte & 0xC0) == 0x80 ? currentState << 6 | nextByte & 0x3F : -1;
        default:
            return -1;
    }
} 
```

# 自动检测编码

如果您的输入流是使用 ASCII 或 ISO-8859-1 或 UTF-8 编码的，但您不确定是哪一个，我们可以使用与上一个类似的方法，但有一个额外的编码检测组件来*自动检测*返回字符串之前的编码。

```
public static String autoDetect(InputStream is) throws IOException {
    StringBuilder chars = new StringBuilder(Math.max(is.available(), 4096));
    byte[] buffer = new byte[4096];
    int n;
    int state = 0;
    boolean ascii = true;
    while ((n = is.read(buffer)) != -1) {
        for (int i = 0; i < n; i++) {
            if ((state = nextStateUtf8(state, buffer[i])) > 0x7F)
                ascii = false;
            chars.append((char)(buffer[i] & 0xFF));
        }
    }

    if (ascii || state < 0) { //probably not UTF-8
        return chars.toString();
    }
    //probably UTF-8
    int pos = 0;
    char[] charBuf = new char[2];
    for (int i = 0, len = chars.length(); i < len; i++) {
        if ((state = nextStateUtf8(state, (byte)chars.charAt(i))) >= 0) {
            boolean hi = Character.toChars(state, charBuf, 0) == 2;
            chars.setCharAt(pos++, charBuf[0]);
            if (hi) {
                chars.setCharAt(pos++, charBuf[1]);
            }
        }
    }
    return chars.substring(0, pos);
} 
```

如果您的输入流的编码既不是 ISO-8859-1 也不是 ASCII 也不是 UTF-8，那么我会遵循已经存在的其他答案。

* * *

## 回答 #48

> 赞同：2
> 
> 时间：2019-11-20T12:49:24.323

此代码适用于新的 Java 学习者：

```
 private String textDataFromFile;

public String getFromFile(InputStream myInputStream) throws FileNotFoundException, IOException {

      BufferedReader bufferReader = new BufferedReader (new InputStreamReader(myInputStream));

       StringBuilder stringBuilder = new StringBuilder();

  String eachStringLine;

    while((eachStringLine=bufferReader.readLine()) != null){          
        stringBuilder.append(eachStringLine).append("\n");
    }

   textDataFromFile = stringBuilder.toString(); 

  return textDataFromFile;

} 
```

* * *

## 回答 #49

> 赞同：2
> 
> 时间：2020-12-12T13:50:39.947

*如果您需要将字符串转换为没有* **外部库的特定字符集，** *则：*

```
public String convertStreamToString(InputStream is) throws IOException {
  try (ByteArrayOutputStream baos = new ByteArrayOutputStream();) {
    is.transferTo(baos);
    return baos.toString(StandardCharsets.UTF_8);
  }
} 
```

* * *

## 回答 #50

> 赞同：1
> 
> 时间：2014-09-11T08:22:25.170

以下不解决原始问题，而是一些响应。

几个回应表明形式的循环

```
String line = null;
while((line = reader.readLine()) != null) {
  // ...
} 
```

或者

```
for(String line = reader.readLine(); line != null; line = reader.readLine()) {
    // ...
} 
```

第一种形式通过在封闭范围内声明一个变量“read”来污染封闭范围的命名空间，该变量不会用于 for 循环之外的任何内容。第二种形式复制了 readline() 调用。

这是用 Java 编写这种循环的一种更简洁的方法。事实证明，for 循环中的第一个子句不需要实际的初始值设定项。这将变量“line”的范围保持在 for 循环的主体内。优雅多了！我还没有看到任何人在任何地方使用过这种形式（我在几年前的一天偶然发现了它），但我一直都在使用它。

```
for (String line; (line = reader.readLine()) != null; ) {
    //...
} 
```

* * *

## 回答 #51

> 赞同：1
> 
> 时间：2017-10-21T09:46:13.847

这个问题的解决方案不是最简单的，但是由于没有提到 NIO 流和通道，这里有一个使用 NIO 通道和 ByteBuffer 将流转换为字符串的版本。

```
public static String streamToStringChannel(InputStream in, String encoding, int bufSize) throws IOException {
    ReadableByteChannel channel = Channels.newChannel(in);
    ByteBuffer byteBuffer = ByteBuffer.allocate(bufSize);
    ByteArrayOutputStream bout = new ByteArrayOutputStream();
    WritableByteChannel outChannel = Channels.newChannel(bout);
    while (channel.read(byteBuffer) > 0 || byteBuffer.position() > 0) {
        byteBuffer.flip();  //make buffer ready for write
        outChannel.write(byteBuffer);
        byteBuffer.compact(); //make buffer ready for reading
    }
    channel.close();
    outChannel.close();
    return bout.toString(encoding);
} 
```

这是一个如何使用它的示例：

```
try (InputStream in = new FileInputStream("/tmp/large_file.xml")) {
    String x = streamToStringChannel(in, "UTF-8", 1);
    System.out.println(x);
} 
```

这种方法的性能应该对大文件有好处。

* * *

## 回答 #52

> 赞同：0
> 
> 时间：2014-02-20T15:28:59.300

此代码段位于 \sdk\samples\android-19\connectivity\NetworkConnect\NetworkConnectSample\src\main\java\com\example\android\networkconnect\MainActivity.java 中，该代码段已根据 Apache 许可证 2.0 版获得许可并由 Google 编写.

```
/** Reads an InputStream and converts it to a String.
 * @param stream InputStream containing HTML from targeted site.
 * @param len Length of string that this method returns.
 * @return String concatenated according to len parameter.
 * @throws java.io.IOException
 * @throws java.io.UnsupportedEncodingException
 */
private String readIt(InputStream stream, int len) throws IOException, UnsupportedEncodingException {
    Reader reader = null;
    reader = new InputStreamReader(stream, "UTF-8");
    char[] buffer = new char[len];
    reader.read(buffer);
    return new String(buffer);
} 
```

* * *

## 回答 #53

> 赞同：0
> 
> 时间：2016-02-29T17:18:34.047

将 inputStream 转换为 String 的方法

```
public static String getStringFromInputStream(InputStream inputStream) {

    BufferedReader bufferedReader = null;
    StringBuilder stringBuilder = new StringBuilder();
    String line;

    try {
        bufferedReader = new BufferedReader(new InputStreamReader(
                inputStream));
        while ((line = bufferedReader.readLine()) != null) {
            stringBuilder.append(line);
        }
    } catch (IOException e) {
        logger.error(e.getMessage());
    } finally {
        if (bufferedReader != null) {
            try {
                bufferedReader.close();
            } catch (IOException e) {
                logger.error(e.getMessage());
            }
        }
    }
    return stringBuilder.toString();
} 
```

* * *

## 回答 #54

> 赞同：0
> 
> 时间：2016-03-10T06:01:50.477

```
InputStream  inputStream = null;
BufferedReader bufferedReader = null;
try {
    BufferedReader bufferedReader = new BufferedReader(new InputStreamReader(inputStream));
    String stringBuilder = new StringBuilder();
    String content;
    while((content = bufferedReader.readLine()) != null){
        stringBuilder.append(content);
    }
    System.out.println("content of file::" + stringBuilder.toString());
}
catch (IOException e) {
            e.printStackTrace();
        }finally{           
            if(bufferedReader != null){
                try{
                    bufferedReader.close();
                }catch(IoException ex){
                   ex.printStackTrace();
            } 
```

* * *

## 回答 #55

> 赞同：0
> 
> 时间：2016-05-26T05:07:49.160

您还可以从指定的资源路径获取 InputStream：

```
public static InputStream getResourceAsStream(String path)
{
    InputStream myiInputStream = ClassName.class.getResourceAsStream(path);
    if (null == myiInputStream)
    {
        mylogger.info("Can't find path = ", path);
    }

    return myiInputStream;
} 
```

从特定路径获取 InputStream：

```
public static URL getResource(String path)
{
    URL myURL = ClassName.class.getResource(path);
    if (null == myURL)
    {
        mylogger.info("Can't find resource path = ", path);
    }
    return myURL;
} 
```

* * *

## 回答 #56

> 赞同：0
> 
> 时间：2019-03-28T08:49:36.783

我建议使用**StringWriter**类来解决这个问题。

```
StringWriter wt= new StringWriter();
IOUtils.copy(inputStream, wt, encoding);
String st= wt.toString(); 
```

* * *

## 回答 #57

> 赞同：-1
> 
> 时间：2014-05-12T18:04:39.807

我有可用的 log4j，所以我可以使用 org.apache.log4j.lf5.util.StreamUtils.getBytes 来获取字节，我可以使用 String ctor 将其转换为字符串

```
String result = new String(StreamUtils.getBytes(inputStream)); 
```

* * *

## 回答 #58

> 赞同：-2
> 
> 时间：2015-11-17T03:23:02.347

注意：这可能不是一个好主意。此方法使用递归，因此会`StackOverflowError`很快达到：

```
public String read (InputStream is) {
    byte next = is.read();
    return next == -1 ? "" : next + read(is); // Recursive part: reads next byte recursively
} 
```

* * *

## 回答 #59

> 赞同：-2
> 
> 时间：2021-09-13T21:13:54.727

```
Dont want anyone to waste time on reading such structured response

Just showing signature of get api method
getMyData(KeyValueObject<String, List<String>> input){} which returns List<KeyValueObject<String, String>>
where KVO is like this

public class KeyValueObject<T, K> {
  private T key;
  private K value;
}

to make a call from another api and reading response 

Response response = ClientBuilder.newClient()
                    .target("https:/something")
                    .request(MediaType.APPLICATION_JSON)
.put(Entity.json(new KeyValueObject<>()));

            if (response != null && response.getStatus() == 200) {
                @SuppressWarnings("unchecked")
                KeyValueObject<String, String>[] output= response.readEntity(KeyValueObject[].class);

            } 
```

* * *

## 回答 #60

> 赞同：-2
> 
> 时间：2021-11-06T16:34:58.540

最简单的方法，一个班轮

```
 public static void main(String... args) throws IOException {
        System.out.println(new String(Files.readAllBytes(Paths.get("csv.txt"))));
    } 
```

* * *

## 回答 #61

> 赞同：-3
> 
> 时间：2013-05-10T17:25:15.743

```
 InputStream IS=new URL("http://www.petrol.si/api/gas_prices.json").openStream();   

  ByteArrayOutputStream BAOS=new ByteArrayOutputStream();
  IOUtils.copy(IS, BAOS);
  String d= new String(BAOS.toByteArray(),"UTF-8");           

System.out.println(d); 
```

* * *

## 回答 #62

> 赞同：-10
> 
> 时间：2012-07-19T17:33:39.780

快捷方便：

```
String result = (String)new ObjectInputStream( inputStream ).readObject(); 
```

# iis - 无明显原因的 IIS 页面重定向

> ID：309431
> 
> 赞同：2
> 
> 时间：2008-11-21T16:49:36.430
> 
> 标签：iis, redirect

我是 IIS 管理员，而不是本网站的开发人员，所以代码对我来说是不透明的。不过，我很难过，不知道在哪里看。

使用 Windows 窗体身份验证，用户被定向到登录页面。如果他们的密码过期，他们将被定向到 ChgExpiredPwd.aspx。在我们的开发和测试服务器上，这是可行的。在我们的生产服务器上，用户再次被重定向到登录页面，并带有“ReturnURL=ChgExpiredPwd.aspx”。不是期望的行为。

Fiddler 说服务器正在响应立即 302 重定向到登录页面。测试服务器以 200 响应。站点和该页面的 IIS 属性没有重定向 - 全部为“指定文件”。代码隐藏中没有内置重定向，所以我可以看到它。目标页面中没有重定向，尽管重定向发生在服务器端，所以它必须在代码中的某个地方。如果我从生产中获取 \bin*.dll 并将其全部用于测试，它不会重现错误。

我没主意了。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-21T16:59:47.953

查看站点根目录下的 web.config 文件。基于表单的身份验证通常在那里配置，默认行为是从“安全”页面重定向到登录以进行身份​​验证（如果用户尚未这样做），它传递的参数之一是 ReturnURL。

这很好地解释了它：http: [//msdn.microsoft.com/en-us/library/aa480476.aspx](http://msdn.microsoft.com/en-us/library/aa480476.aspx)

# .net - ActiveRecord 是否处理锁定和更新？

> ID：309437
> 
> 赞同：1
> 
> 时间：2008-11-21T16:51:09.467
> 
> 标签：.net, activerecord, castle

ActiveRecord 似乎不适合记录锁定和数据库更新。如何在断开连接的多用户环境（例如网站和 Web 服务）中同步更新？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-21T17:11:24.857

如果您谈论的是 Castle ActiveRecord（用于 .Net），我相信您可以使用 NHibernate 支持的所有并发模型。例如版本列：

[http://www.darkside.co.za/archive/2008/05/20/castle-activerecord-using-the-version-attribute.aspx](http://www.darkside.co.za/archive/2008/05/20/castle-activerecord-using-the-version-attribute.aspx)

# linux - 在 Red Hat 上的 Firefox 中播放 wav 文件

> ID：309438
> 
> 赞同：1
> 
> 时间：2008-11-21T16:51:22.183
> 
> 标签：linux, firefox, audio, wav

我们有一个 JavaScript 结构，可以在 Windows 和 MacOSX 上的 Firefox 中播放 .wav 文件，但它不适用于 Red Hat Linux。我需要什么扩展？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-21T17:51:16.210

~~Firefox 3.1 将支持~~Firefox 3.5，支持`<audio>`标签，一个标准的标签来处理声音。如果你使用它，你将不需要扩展。

不幸的是，这只适用于最新的浏览器（例如，Firefox 3 是最新的稳定版本，但不支持此标签。您可能也无法使其与 Internet Explorer 一起使用）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-21T23:51:32.060

试试 mplayerplug-in，它在 rpmforge 和 rpmfusion 中可用。它需要安装 mplayer（显然）并且 AFAIK 它几乎可以播放任何东西。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-08-26T11:48:11.753

你试过[月光吗？](http://mono-project.com/Moonlight)当您第一次询问时，我认为 Media Codec 包不可用，但现在可用 ;-)

# emacs - Lisp In A Box - 为什么要启动服务器？

> ID：309440
> 
> 赞同：9
> 
> 时间：2008-11-21T16:51:37.627
> 
> 标签：emacs, lisp, slime, lisp-in-a-box

我决定重新使用 LISP（自从我的 AI 课程以来就没有使用它）以更熟悉一般的函数式编程，所以我下载了 Lisp In A Box（我们实际上在之前的课程中使用过），它附带CLISP 和 Emacs。

当我运行它时，它说：

> 连接到 1617 端口。拿这个 REPL，兄弟，希望它对你有好处。

什么？所以我更仔细地查看了 Lisp In A Box 网页，发现了这个：

> SLIME 是 Emacs 的集成开发环境，它通过网络套接字与 Common Lisp 实现接口。很多关于 SLIME 的信息都可以在 CLiki 的 SLIME 节点上找到。SLIME 手册以 PDF 格式在线提供。

我有点理解 SLIME 是什么（某种对 emacs 的扩展，对吗？）但是为什么文本编辑器会启动自己的服务器并连接到它呢？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-21T16:54:06.077

目的是让 Lisp 可以并行运行。

Slime 连接到会话，然后您可以从许多不同的窗口（甚至机器）拥有相同的环境、定义等。例如，这意味着您可以启动应用程序并即时调试它。

有关详细信息，请查看[此博客](http://bc.tech.coop/blog/081209.html)。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-11-21T21:01:01.400

套接字比管道更灵活。一方面，SLIME 允许您连接到网络上的 Swank 服务器，这对于在具有长时间运行进程的远程机器（例如 Web 服务器）上进行实时修复非常有用。鉴于此，为什么要通过抽象通信以同时支持管道和套接字来增加另一层复杂性？无论如何，管道并不比套接字更容易编程。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-22T23:21:04.250

好吧，Slime 启动 Lisp 进程，为您提供集成开发环境。这样您就可以即时测试和调试代码，还可以检查对象。我认为选择带有套接字的架构是为了在不同的 lisp（顺便说一句，Slime 还支持[Clojure](http://clojure.org/)和[MIT Scheme](http://www.gnu.org/software/mit-scheme)）和 OS-es（Slime 也适用于 Windows）之间具有更好的可移植性。它还允许跨平台开发——您可以从 Emacs 在目标架构上测试您的软件。

所以我认为，这个决定很棒，你只是不应该将 swank（Slime 后端）放在生产服务器上。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-21T17:38:40.620

您将获得一个并行运行的 REPL（读取-评估-打印-循环），以便您可以在编辑器中即时编译和测试代码片段。《Practical Common Lisp》（网络上免费提供）对此有很好的解释，是一本非常好的学习 Lisp 的书。

# iphone - Interface Builder 无法正确显示 160dpi 图像？

> ID：309449
> 
> 赞同：1
> 
> 时间：2008-11-21T16:54:36.763
> 
> 标签：iphone, cocoa-touch, interface-builder

我正在开发一个 iPhone 应用程序。一个简单的图像是主视图的背景。我已经在后台设置了一个 UIImageView 并使用 IB 设置了一个图像。

该图像是 160dpi PNG 图像。它看起来像 IB 中的 CRAP。在模拟器中运行时，它是好的，清晰的。

我应该如何工作并将控件精确地放置在分辨率如此低的图像上？这是一个错误吗？

谢谢你的帮助！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-04T20:42:38.213

实际上，DPI 根本不是无关紧要的。

将 DPI 更改为 72，图像将在 IB/Xcode 中正常显示。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-22T04:37:09.620

IB is not a tool for designing a UI, it is a tool for implementing one. It is designed to perform well rather than display well (this is more important in complex desktop UI design than mobile but the tool is the same for both). The best advice is perhaps to take a cue from the publishing world (where this is a common practice for applications that display large amounts of high resolution graphics such as Adobe InDesign) and keep track of exact measurements for controls - the x,y coordinate positions and height/width. Then you can use the inspector to precisely position controls.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-24T21:56:34.110

当我在 IB 中处理图像时，我看不到这样的东西。也许您的 PNG 文件有什么特别之处？你说它是 160 dpi，这无关紧要。更重要的是它的像素尺寸，以及它们与屏幕尺寸的比较。

也许 UIImageView 在渲染你的 PNG 时遇到了问题，并且出于某种原因使用了预览图标？尝试使用不同的图像，或尝试将图像大小调整为 480x320，使用 32 位颜色。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-09T03:37:58.053

我也想知道这个。我不认为图像的 DPI 是这样做的，因为我有一个项目，在一台机器上的 IB 中一切看起来都很好，然后在我的笔记本电脑上，它显示了 OP 描述的方式。

图像尺寸与 iPhone 屏幕和视图尺寸 (320x480) 相同，但图像显示全部很小，而不是填满 UIImageView 的整个尺寸。如果我缩放以填充，那么图像在 320x480 处变得非常模糊，即使我可以确认这些是图像的实际尺寸......它的作用就像图像本身是 320x480 的空白空间和一个小的版本我的图像以它为中心……这很奇怪。正如我所说 - 这是同一个项目，在另一台机器上的 IB 中看起来完全正常（当它们构建时，它们在模拟器中看起来都很正常）。这也发生在我朋友的 macbook 上。

IB中是否有一些设置可能有所不同？

编辑：我猜我说得太早了——我回到另一台机器上，这次发现了同样的问题，而且确实是 dpi。这一定是最近对 xcode/IB 的更新之一发生了变化，因为我最初从未见过这个问题，而且图像文件完全相同......奇怪。

# asp.net - MS sql中奇怪的smallmoney到.Net中的十进制

> ID：309454
> 
> 赞同：0
> 
> 时间：2008-11-21T16:56:43.340
> 
> 标签：asp.net

我在 db 中有一个 smallmoney 值为 25.00，当我将其读取到 .net decmial 时，它在 asp.net gridview 上变为 25.0000。它在哪里附加了额外的两位数？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-21T16:58:24.353

这完全是格式化的结果——在这两种情况下，数据库中的实际值都只是 25。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-21T17:00:12.040

这只是各种格式的默认精度和显示的一个例子。如果您希望数据以某种格式显示，最好明确说明该格式。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-21T17:03:42.390

SQLServer 中的 smallmoney 和 money 都具有小数点后 4 位的精度。

SQL 中的格式可能与您的方案无关，但如果您在 SQL 中对其进行格式化，您有多种选择。

# fuzzy-search - 如何在大型字符串数据库中找到字符串的最佳模糊匹配

> ID：309479
> 
> 赞同：21
> 
> 时间：2008-11-21T17:02:15.763
> 
> 标签：fuzzy-search, string-search

我有一个字符串数据库（任意长度），其中包含超过一百万个项目（可能更多）。

我需要将用户提供的字符串与整个数据库进行比较，如果存在则检索相同的字符串，否则返回最接近的模糊匹配（60% 相似性或更好）。理想情况下，搜索时间应低于一秒。

我的想法是在根据长度缩小数据库中的候选者之后，使用编辑距离将每个数据库字符串与搜索字符串进行比较。

但是，由于我需要经常执行此操作，我正在考虑构建数据库字符串的索引以保存在内存中并查询索引，而不是直接查询数据库。

关于如何以不同方式解决此问题或如何构建内存索引的任何想法？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-21T18:21:50.067

[这篇论文似乎准确地描述了你想要什么。](http://en.scientificcommons.org/514330)

Lucene ( [http://lucene.apache.org/](http://lucene.apache.org/) ) 也实现了 Levenshtein 编辑距离。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-21T18:59:11.300

您没有提及您的数据库系统，但对于 PostrgreSQL，您可以使用以下 contrib 模块：[trgm - PostgreSQL 的三元组匹配](http://www.sai.msu.su/~megera/postgres/gist/pg_trgm/README.pg_trgm)

> pg_trgm contrib 模块提供函数和索引类，用于根据 trigram 匹配确定文本的相似性。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-14T11:23:07.283

如果您的数据库支持它，您应该使用全文搜索。否则，您可以使用诸如 lucene 之类的索引器及其各种实现。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-21T17:13:49.250

由于数据量很大，因此在插入记录时，我将计算语音算法的值并将其存储在索引列中，然后将我的选择查询约束（WHERE 子句）在该列的某个范围内。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-21T17:54:25.580

计算 SOUNDEX 哈希（内置在许多 SQL 数据库引擎中）并按它索引。

SOUNDEX 是基于单词发音的哈希值，因此同一个单词的拼写错误很可能具有相同的 SOUNDEX 哈希值。

然后找到搜索字符串的 SOUNDEX 哈希，并在其上进行匹配。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-02-13T14:11:29.653

[Dan Gusfield](http://wwwcsif.cs.ucdavis.edu/~gusfield/)所著*的《字符串、树和序列的算法：计算机科学和计算生物学*》一书中对相关算法进行了非常广泛的解释。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2015-11-10T13:29:01.740

[https://en.wikipedia.org/wiki/Levenshtein_distance](https://en.wikipedia.org/wiki/Levenshtein_distance)

Levenshtein 算法已在一些 DBMS 中实现

（例如 PostgreSql：[http](http://www.postgresql.org/docs/9.1/static/fuzzystrmatch.html) ://www.postgresql.org/docs/9.1/static/fuzzystrmatch.html ）

# c# - C# 清理文件名

> ID：309485
> 
> 赞同：192
> 
> 时间：2008-11-21T17:04:40.423
> 
> 标签：c#, validation, path, sanitize, invalid-characters

我最近一直在将一堆 MP3 从不同的位置移动到一个存储库中。我一直在使用 ID3 标签构建新文件名（感谢 TagLib-Sharp！），我注意到我得到了`System.NotSupportedException`：

> *“不支持给定路径的格式。”*

这是由`File.Copy()`或生成的`Directory.CreateDirectory()`。

没过多久就意识到我的文件名需要清理。所以我做了很明显的事情：

```
public static string SanitizePath_(string path, char replaceChar)
{
    string dir = Path.GetDirectoryName(path);
    foreach (char c in Path.GetInvalidPathChars())
        dir = dir.Replace(c, replaceChar);

    string name = Path.GetFileName(path);
    foreach (char c in Path.GetInvalidFileNameChars())
        name = name.Replace(c, replaceChar);

    return dir + name;
} 
```

令我惊讶的是，我继续得到例外。原来 ':' 不在 的集合中`Path.GetInvalidPathChars()`，因为它在路径根中有效。我想这是有道理的——但这一定是一个非常普遍的问题。有没有人有一些清理路径的短代码？这是我想出的最彻底的方法，但感觉它可能有点矫枉过正。

```
 // replaces invalid characters with replaceChar
    public static string SanitizePath(string path, char replaceChar)
    {
        // construct a list of characters that can't show up in filenames.
        // need to do this because ":" is not in InvalidPathChars
        if (_BadChars == null)
        {
            _BadChars = new List<char>(Path.GetInvalidFileNameChars());
            _BadChars.AddRange(Path.GetInvalidPathChars());
            _BadChars = Utility.GetUnique<char>(_BadChars);
        }

        // remove root
        string root = Path.GetPathRoot(path);
        path = path.Remove(0, root.Length);

        // split on the directory separator character. Need to do this
        // because the separator is not valid in a filename.
        List<string> parts = new List<string>(path.Split(new char[]{Path.DirectorySeparatorChar}));

        // check each part to make sure it is valid.
        for (int i = 0; i < parts.Count; i++)
        {
            string part = parts[i];
            foreach (char c in _BadChars)
            {
                part = part.Replace(c, replaceChar);
            }
            parts[i] = part;
        }

        return root + Utility.Join(parts, Path.DirectorySeparatorChar.ToString());
    } 
```

任何使此功能更快且更少巴洛克式的改进将不胜感激。

* * *

## 回答 #1

> 赞同：341
> 
> 时间：2009-05-11T08:52:03.233

要清理文件名，您可以这样做

```
private static string MakeValidFileName( string name )
{
   string invalidChars = System.Text.RegularExpressions.Regex.Escape( new string( System.IO.Path.GetInvalidFileNameChars() ) );
   string invalidRegStr = string.Format( @"([{0}]*\.+$)|([{0}]+)", invalidChars );

   return System.Text.RegularExpressions.Regex.Replace( name, invalidRegStr, "_" );
} 
```

* * *

## 回答 #2

> 赞同：151
> 
> 时间：2012-11-29T01:28:46.347

更短的解决方案：

```
var invalids = System.IO.Path.GetInvalidFileNameChars();
var newName = String.Join("_", origFileName.Split(invalids, StringSplitOptions.RemoveEmptyEntries) ).TrimEnd('.'); 
```

* * *

## 回答 #3

> 赞同：89
> 
> 时间：2012-10-16T22:42:36.740

基于 Andre 的出色回答，但考虑到 Spud 对保留字的评论，我制作了这个版本：

```
/// <summary>
/// Strip illegal chars and reserved words from a candidate filename (should not include the directory path)
/// </summary>
/// <remarks>
/// http://stackoverflow.com/questions/309485/c-sharp-sanitize-file-name
/// </remarks>
public static string CoerceValidFileName(string filename)
{
    var invalidChars = Regex.Escape(new string(Path.GetInvalidFileNameChars()));
    var invalidReStr = string.Format(@"[{0}]+", invalidChars);

    var reservedWords = new []
    {
        "CON", "PRN", "AUX", "CLOCK$", "NUL", "COM0", "COM1", "COM2", "COM3", "COM4",
        "COM5", "COM6", "COM7", "COM8", "COM9", "LPT0", "LPT1", "LPT2", "LPT3", "LPT4",
        "LPT5", "LPT6", "LPT7", "LPT8", "LPT9"
    };

    var sanitisedNamePart = Regex.Replace(filename, invalidReStr, "_");
    foreach (var reservedWord in reservedWords)
    {
        var reservedWordPattern = string.Format("^{0}\\.", reservedWord);
        sanitisedNamePart = Regex.Replace(sanitisedNamePart, reservedWordPattern, "_reservedWord_.", RegexOptions.IgnoreCase);
    }

    return sanitisedNamePart;
} 
```

这些是我的单元测试

```
[Test]
public void CoerceValidFileName_SimpleValid()
{
    var filename = @"thisIsValid.txt";
    var result = PathHelper.CoerceValidFileName(filename);
    Assert.AreEqual(filename, result);
}

[Test]
public void CoerceValidFileName_SimpleInvalid()
{
    var filename = @"thisIsNotValid\3\\_3.txt";
    var result = PathHelper.CoerceValidFileName(filename);
    Assert.AreEqual("thisIsNotValid_3__3.txt", result);
}

[Test]
public void CoerceValidFileName_InvalidExtension()
{
    var filename = @"thisIsNotValid.t\xt";
    var result = PathHelper.CoerceValidFileName(filename);
    Assert.AreEqual("thisIsNotValid.t_xt", result);
}

[Test]
public void CoerceValidFileName_KeywordInvalid()
{
    var filename = "aUx.txt";
    var result = PathHelper.CoerceValidFileName(filename);
    Assert.AreEqual("_reservedWord_.txt", result);
}

[Test]
public void CoerceValidFileName_KeywordValid()
{
    var filename = "auxillary.txt";
    var result = PathHelper.CoerceValidFileName(filename);
    Assert.AreEqual("auxillary.txt", result);
} 
```

* * *

## 回答 #4

> 赞同：35
> 
> 时间：2013-04-24T09:29:55.900

```
string clean = String.Concat(dirty.Split(Path.GetInvalidFileNameChars())); 
```

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2018-11-19T13:09:38.110

这里有很多可行的解决方案。只是为了完整起见，这是一种不使用正则表达式但使用 LINQ 的方法：

```
var invalids = Path.GetInvalidFileNameChars();
filename = invalids.Aggregate(filename, (current, c) => current.Replace(c, '_')); 
```

此外，这是一个非常简短的解决方案；）

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2014-05-20T03:37:28.510

我想以某种方式保留字符，而不仅仅是简单地用下划线替换字符。

我认为的一种方法是用看起来相似的字符替换字符，这些字符（在我的情况下）不太可能用作常规字符。所以我拿了无效字符列表并找到了类似的东西。

以下是使用look-a-likes 进行编码和解码的函数。

***此代码不包括所有 System.IO.Path.GetInvalidFileNameChars() 字符的完整列表。因此，您可以扩展或使用下划线替换任何剩余的字符。***

```
private static Dictionary<string, string> EncodeMapping()
{
    //-- Following characters are invalid for windows file and folder names.
    //-- \/:*?"<>|
    Dictionary<string, string> dic = new Dictionary<string, string>();
    dic.Add(@"\", "Ì"); // U+OOCC
    dic.Add("/", "Í"); // U+OOCD
    dic.Add(":", "¦"); // U+00A6
    dic.Add("*", "¤"); // U+00A4
    dic.Add("?", "¿"); // U+00BF
    dic.Add(@"""", "ˮ"); // U+02EE
    dic.Add("<", "«"); // U+00AB
    dic.Add(">", "»"); // U+00BB
    dic.Add("|", "│"); // U+2502
    return dic;
}

public static string Escape(string name)
{
    foreach (KeyValuePair<string, string> replace in EncodeMapping())
    {
        name = name.Replace(replace.Key, replace.Value);
    }

    //-- handle dot at the end
    if (name.EndsWith(".")) name = name.CropRight(1) + "°";

    return name;
}

public static string UnEscape(string name)
{
    foreach (KeyValuePair<string, string> replace in EncodeMapping())
    {
        name = name.Replace(replace.Value, replace.Key);
    }

    //-- handle dot at the end
    if (name.EndsWith("°")) name = name.CropRight(1) + ".";

    return name;
} 
```

您可以选择自己喜欢的样子。我在 Windows 中使用 Character Map 应用程序来选择我的`%windir%\system32\charmap.exe`

**当我通过发现进行调整时，我将更新此代码。**

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2013-07-29T15:57:50.460

我正在使用该`System.IO.Path.GetInvalidFileNameChars()` 方法检查无效字符，并且没有问题。

我正在使用以下代码：

```
foreach( char invalidchar in System.IO.Path.GetInvalidFileNameChars())
{
    filename = filename.Replace(invalidchar, '_');
} 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-11-22T03:10:05.570

我认为问题在于您首先调用`Path.GetDirectoryName`了错误的字符串。如果其中包含非文件名字符，.Net 无法判断字符串的哪些部分是目录并抛出。您必须进行字符串比较。

假设只有文件名不好，而不是整个路径，试试这个：

```
public static string SanitizePath(string path, char replaceChar)
{
    int filenamePos = path.LastIndexOf(Path.DirectorySeparatorChar) + 1;
    var sb = new System.Text.StringBuilder();
    sb.Append(path.Substring(0, filenamePos));
    for (int i = filenamePos; i < path.Length; i++)
    {
        char filenameChar = path[i];
        foreach (char c in Path.GetInvalidFileNameChars())
            if (filenameChar.Equals(c))
            {
                filenameChar = replaceChar;
                break;
            }

        sb.Append(filenameChar);
    }

    return sb.ToString();
}
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2012-04-30T10:26:38.303

我过去在这方面取得了成功。

不错，简短而静态:-)

```
 public static string returnSafeString(string s)
    {
        foreach (char character in Path.GetInvalidFileNameChars())
        {
            s = s.Replace(character.ToString(),string.Empty);
        }

        foreach (char character in Path.GetInvalidPathChars())
        {
            s = s.Replace(character.ToString(), string.Empty);
        }

        return (s);
    } 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2015-05-21T19:53:38.680

下面是一个基于 Andre 代码的高效延迟加载扩展方法：

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace LT
{
    public static class Utility
    {
        static string invalidRegStr;

        public static string MakeValidFileName(this string name)
        {
            if (invalidRegStr == null)
            {
                var invalidChars = System.Text.RegularExpressions.Regex.Escape(new string(System.IO.Path.GetInvalidFileNameChars()));
                invalidRegStr = string.Format(@"([{0}]*\.+$)|([{0}]+)", invalidChars);
            }

            return System.Text.RegularExpressions.Regex.Replace(name, invalidRegStr, "_");
        }
    }
} 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-11-21T17:47:22.320

如果您将目录和文件名附加在一起并对其进行清理而不是单独清理它们，您的代码会更干净。至于清理 :，只需取字符串中的第二个字符。如果等于“replacechar”，则用冒号替换。由于此应用程序是供您自己使用的，因此这样的解决方案应该足够了。

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2012-01-11T18:58:59.563

```
using System;
using System.IO;
using System.Linq;
using System.Text;

public class Program
{
    public static void Main()
    {
        try
        {
            var badString = "ABC\\DEF/GHI<JKL>MNO:PQR\"STU\tVWX|YZA*BCD?EFG";
            Console.WriteLine(badString);
            Console.WriteLine(SanitizeFileName(badString, '.'));
            Console.WriteLine(SanitizeFileName(badString));
        }
        catch (Exception ex)
        {
            Console.WriteLine(ex.ToString());
        }
    }

    private static string SanitizeFileName(string fileName, char? replacement = null)
    {
        if (fileName == null) { return null; }
        if (fileName.Length == 0) { return ""; }

        var sb = new StringBuilder();
        var badChars = Path.GetInvalidFileNameChars().ToList();

        foreach (var @char in fileName)
        {
            if (badChars.Contains(@char)) 
            {
                if (replacement.HasValue)
                {
                    sb.Append(replacement.Value);
                }
                continue; 
            }
            sb.Append(@char);
        }
        return sb.ToString();
    }
} 
```

* * *

## 回答 #13

> 赞同：-1
> 
> 时间：2021-01-18T14:51:25.450

基于@fiat 和@Andre 的方法，我也想分享我的解决方案。主要区别：

*   它是一种扩展方法
*   正则表达式在第一次使用时被编译，以节省大量执行时间
*   保留字被保留

```
public static class StringPathExtensions
{
    private static Regex _invalidPathPartsRegex;

    static StringPathExtensions()
    {
        var invalidReg = System.Text.RegularExpressions.Regex.Escape(new string(Path.GetInvalidFileNameChars()));
        _invalidPathPartsRegex = new Regex($"(?<reserved>^(CON|PRN|AUX|CLOCK\\$|NUL|COM0|COM1|COM2|COM3|COM4|COM5|COM6|COM7|COM8|COM9|LPT0|LPT1|LPT2|LPT3|LPT4|LPT5|LPT6|LPT7|LPT8|LPT9))|(?<invalid>[{invalidReg}:]+|\\.$)", RegexOptions.Compiled);
    }

    public static string SanitizeFileName(this string path)
    {
        return _invalidPathPartsRegex.Replace(path, m =>
        {
            if (!string.IsNullOrWhiteSpace(m.Groups["reserved"].Value))
                return string.Concat("_", m.Groups["reserved"].Value);
            return "_";
        });
    }
} 
```

# c++ - 如何在 C++ 中读取 system() 调用的结果？

> ID：309491
> 
> 赞同：3
> 
> 时间：2008-11-21T17:06:41.857
> 
> 标签：c++, linux, operating-system, system-calls

我正在使用以下代码尝试`df`在 Linux 中使用`popen`.

```
#include <iostream> // file and std I/O functions

int main(int argc, char** argv) {
    FILE* fp;
    char * buffer;
    long bufSize;
    size_t ret_code;

    fp = popen("df", "r");
    if(fp == NULL) { // head off errors reading the results
        std::cerr << "Could not execute command: df" << std::endl;
        exit(1);
    }

    // get the size of the results
    fseek(fp, 0, SEEK_END);
    bufSize = ftell(fp);
    rewind(fp);

    // allocate the memory to contain the results
    buffer = (char*)malloc( sizeof(char) * bufSize );
    if(buffer == NULL) {
        std::cerr << "Memory error." << std::endl;
        exit(2);
    }

    // read the results into the buffer
    ret_code = fread(buffer, 1, sizeof(buffer), fp);
    if(ret_code != bufSize) {
        std::cerr << "Error reading output." << std::endl;
        exit(3);
    }

    // print the results
    std::cout << buffer << std::endl;

    // clean up
    pclose(fp);
    free(buffer);
    return (EXIT_SUCCESS);
} 
```

这段代码给了我一个退出状态为“2”的“内存错误”，所以我可以看到*它*失败的地方，我只是不明白*为什么*。

我从[Ubuntu Forums](http://ubuntuforums.org/showthread.php?t=285287)和[C++ Reference](http://en.cppreference.com/w/cpp/io/c/fread)上找到的示例代码把它放在一起，所以我没有嫁给它。如果有人可以提出更好的方法来读取 system() 调用的结果，我愿意接受新的想法。

**编辑原文：**好的，`bufSize`结果是否定的，现在我明白为什么了。您不能像我天真地尝试那样随机访问管道。

我不能成为第一个尝试这样做的人。有人可以给（或指向我）一个示例，说明如何将 system() 调用的结果读取到 C++ 中的变量中吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-24T04:03:22.760

你让这一切变得太难了。 *popen(3)*返回标准管道文件的常规旧`FILE *`文件，也就是说，换行符终止的记录。*在 C 语言中使用fgets(3)*可以非常高效地阅读它：

```
#include <stdio.h>
char bfr[BUFSIZ] ;
FILE * fp;
// ...
if((fp=popen("/bin/df", "r")) ==NULL) {
   // error processing and return
}
// ...
while(fgets(bfr,BUFSIZ,fp) != NULL){
   // process a line
} 
```

在 C++ 中它更容易——

```
#include <cstdio>
#include <iostream>
#include <string>

FILE * fp ;

if((fp= popen("/bin/df","r")) == NULL) {
    // error processing and exit
}

ifstream ins(fileno(fp)); // ifstream ctor using a file descriptor

string s;
while (! ins.eof()){
    getline(ins,s);
    // do something
} 
```

那里还有一些错误处理，但这就是想法。关键是您将`FILE *`from *popen*视为*any* `FILE *`，并逐行阅读。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-21T17:17:55.843

为什么会`std::malloc()`失败？

显而易见的原因是“因为`std::ftell()`返回了一个负符号数，然后将其视为一个巨大的无符号数”。

根据[文档](http://en.cppreference.com/w/cpp/io/c/ftell)，`std::ftell()`失败时返回 -1。它失败的一个明显原因是*您无法在管道或 FIFO 中查找*。

跑不了的; 不读就无法知道命令输出的长度，只能读一次。您必须分块读取它，根据需要增加缓冲区或动态解析。

`df`但是，当然，您可以通过直接使用系统调用可能用于获取其信息来简单地避免整个问题： `statvfs()`.

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-21T19:20:53.380

（关于术语的注释：Unix和Linux中的“系统调用”通常是指从用户空间代码调用内核函数。将其称为“`system()`调用结果”或“`system(3)`调用结果”会更清楚，但最好只说“捕获进程的输出”。）

无论如何，您可以像读取任何其他文件一样读取进程的输出。具体来说：

*   您可以使用`pipe()`、`fork()`和开始该过程`exec()`。这为您提供了一个文件描述符，然后您可以使用循环`read()`从文件描述符到缓冲区和`close()`完成后的文件描述符。这是最低级别的选项，为您提供最大的控制权。
*   您可以使用 开始该过程`popen()`，就像您正在做的那样。这为您提供了文件流。在循环中，您可以使用 、或将流中的 using 读取到临时变量或缓冲区中`fread()`，正如 Zarawesome 的回答所演示的那样，然后处理该缓冲区或将其附加到 C++ 字符串。`fgets()``fgetc()`
*   您可以使用 开始该过程`popen()`，然后使用非标准[__gnu_cxx::stdio_filebuf](http://gcc.gnu.org/onlinedocs/libstdc++/libstdc++-html-USERS-3.4/class____gnu__cxx_1_1stdio__filebuf.html)`std::istream`来包装它，然后从 中创建一个`stdio_filebuf`并将其视为任何其他 C++ 流。这是最类似于 C++ 的方法。这是此方法示例的[第 1 部分](http://www.krugle.org/kse/files/cvs/cvs.sourceforge.net/gmodconfig/gmodconfig/src/pipereader.cpp)和[第 2 部分。](http://www.krugle.org/kse/files/cvs/cvs.sourceforge.net/gmodconfig/gmodconfig/src/pipereader.cpp#4)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-21T17:14:34.943

我不确定您是否可以像这样 fseek/ftell 管道流。

你检查过 bufSize 的值吗？malloc 失败的原因之一是缓冲区大小异常。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-24T01:43:33.620

感谢所有花时间回答的人。一位同事向我介绍了[ostringstream](http://www.cplusplus.com/reference/iostream/ostringstream/)课程。这是一些示例代码，它们基本上完成了我在原始问题中尝试做的事情。

```
#include <iostream> // cout
#include <sstream> // ostringstream

int main(int argc, char** argv) {
    FILE* stream = popen( "df", "r" );
    std::ostringstream output;

    while( !feof( stream ) && !ferror( stream ))
    {
        char buf[128];
        int bytesRead = fread( buf, 1, 128, stream );
        output.write( buf, bytesRead );
    }
    std::string result = output.str();
    std::cout << "<RESULT>" << std::endl << result << "</RESULT>" << std::endl;
    return (0);
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-21T19:35:51.133

要回答更新中的问题：

```
char buffer[1024];
char * line = NULL;
while ((line = fgets(buffer, sizeof buffer, fp)) != NULL) {
    // parse one line of df's output here.
} 
```

这够了吗？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-21T17:13:03.450

检查你的 bufSize。`ftell`可以在错误时返回 -1，这可能导致 malloc 不分配缓冲区具有 NULL 值。

`ftell`失败的原因是因为popen。你不能搜索管道。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-21T17:14:30.653

首先要检查的是 bufSize 的值 - 如果它恰好 <= 0，那么当您尝试分配大小为 0 的缓冲区时，malloc 可能会返回 NULL。

另一种解决方法是要求 malloc 为您提供大小为 (bufSize + n) 且 n >= 1 的缓冲区，这应该可以解决这个特定问题。

除此之外，您发布的代码是纯 C，而不是 C++，所以包含有点过头了。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-21T17:43:43.403

管道不是随机访问的。它们是连续的，这意味着一旦您读取了一个字节，管道就不会再次将其发送给您。这意味着，显然，你不能倒带。

如果您只想将数据输出回用户，您可以执行以下操作：

```
// your file opening code

while (!feof(fp))
{
char c = getc(fp);
std::cout << c;
} 
```

这将一个接一个地从 df 管道中提取字节，并将它们直接泵入输出。

现在，如果您想作为一个整体访问 df 输出，您可以将其通过管道传输到一个文件中并读取该文件，或者将输出连接到一个构造中，例如 C++ 字符串。

# sql - 用户定义的函数 SQL Server 2005 被错误地标记为非确定性？

> ID：309492
> 
> 赞同：4
> 
> 时间：2008-11-21T17:06:56.333
> 
> 标签：sql, sql-server, sql-server-2005, user-defined-functions, deterministic

与[这个问题](https://stackoverflow.com/questions/303318/deterministic-scalar-functions)相关，我决定检查我的数据仓库中的 UDF（这在很大程度上应该是确定性的），我发现了几个不应该的。

例如：

```
CREATE FUNCTION [udf_YearFromDataDtID]
(
    @DATA_DT_ID int
)
RETURNS int
AS
BEGIN
    RETURN @DATA_DT_ID / 10000
END 
```

显示在此查询中：

```
SELECT  ROUTINE_NAME
FROM    INFORMATION_SCHEMA.ROUTINES
WHERE   IS_DETERMINISTIC = 'NO'
        AND ROUTINE_TYPE = 'FUNCTION'
ORDER BY ROUTINE_NAME 
```

为什么是这样？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-21T17:13:44.010

哎呀-显然，它需要指定 SCHEMABINDING 否则[可能会导致性能问题](http://kbalertz.com/952217/query-references-nondeterministic-function-slower-Server-Server.aspx)

```
ALTER FUNCTION [udf_YearFromDataDtID]
(
    @DATA_DT_ID int
)
RETURNS int
WITH SCHEMABINDING
AS
BEGIN
    RETURN @DATA_DT_ID / 10000
END 
```

看起来我可以通过修复这些来获得一些性能提升。好的。

# c# - 在 Visual C# 中，我无法公开我的公共类

> ID：309494
> 
> 赞同：1
> 
> 时间：2008-11-21T17:08:59.573
> 
> 标签：c#, .net

我正在尝试在 Visual C# 中创建一个程序，该程序具有我创建的类，并在应用程序启动时创建我的类对象数组，并且我的对象数组可以在整个程序中使用。因此，任何函数或控件的事件都可以访问对象数组及其成员变量。我将我的类创建为“公共”，但由于某种原因，我在构建时遇到这些错误：“当前上下文中不存在名称'MyArrayObjectNameHere'”当我尝试访问加载文件对话框事件中的对象成员变量时我正在尝试将文件中的数据加载到对象数组的成员变量中。

对象数组是否需要在某个地方声明和构造，以便它存在于每个上下文中？如果是这样，你能告诉我这是哪里吗？

我目前在运行 form1 之前在 main 函数中声明它。

我的类定义在它自己的 .cs 文件和程序命名空间中如下所示：

```
public class MyClass
{
    public int MyInt1;
    public int MyInt2;
} 
```

在表单加载之前，我在主函数中声明了这样的对象数组：

```
MyClass[] MyArrayObject;
MyArrayObject = new MyClass[50];
for (int i = 0; i < 50; i++)
{
    MyArrayObject[i] = new MyClass();
} 
```

提前感谢您的帮助。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-21T17:25:53.627

您的问题是您在主函数中定义它，因此它只会存在于主函数中。您需要在类内部定义它，而不是在函数内部

```
公共部分类Form1：Form
{
我的类[] 我的数组对象；// 在这里声明它，它将在任何地方都可用

公共表格1（）
{
 //在这里实例化
 MyArrayObject = new MyClass[50];
 对于 (int i = 0; 我
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-21T17:16:04.363

在所有上下文中只有静态对象可用。虽然您的设计缺乏......呃，只是总体上缺乏，但您可以这样做的方法是添加第二个静态类来维护您的 MyClass 的数组：

```
public static class MyClassManager
{
  private MyClass[] _myclasses;
  public MyClass[] MyClassArray
  {
    get
    {
      if(_myclasses == null)
      {
      _myClasses = new MyClass[50];
      for(int i = 0; i < 50;i++)
        _myClasses[i] = new MyClass();
      }
      return _myclasses;

    }
  }
} 
```

做一个自己的最爱，并通过 Jeffrey Richter 的 C# 获取 CLR。跳过前几章，阅读其余部分。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-21T17:17:18.247

您需要使数组成为某个类的静态成员，.NET 在任何类之外都没有全局范围。

例如

```
class A
{
    public static B[] MyArray;
}; 
```

然后，您可以在任何地方以 A.MyArray 的形式访问它

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-14T13:32:03.347

不好，对我这样的学习者很有用。

# java - Java中的Windows快捷方式（.lnk）解析器？

> ID：309495
> 
> 赞同：26
> 
> 时间：2008-11-21T17:09:05.720
> 
> 标签：java, windows, windows-vista, shortcuts, lnk

我目前正在使用`Win32ShellFolderManager2`并`ShellFolder.getLinkLocation`在 Java 中解析 Windows 快捷方式。不幸的是，如果 Java 程序在 Vista 下作为服务运行`getLinkLocation`，这将不起作用。具体来说，我收到一个异常说明“无法获取 shell 文件夹 ID 列表”。

搜索网络确实会提到此错误消息，但总是与`JFileChooser`. 我没有使用`JFileChooser`，我只需要将`.lnk`文件解析到其目的地。

有谁知道`.lnk`我可以使用的用 Java 编写的文件的第 3 方解析器？

[从那以后，我在这里](http://mediasrv.ns.ac.yu/extra/fileformat/windows/lnk/shortcut.pdf)找到了 .lnk 格式的非官方文档，但如果有人以前做过，我宁愿不必做这项工作，因为这种格式相当可怕。

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2012-02-22T21:35:49.190

添加了评论（一些解释以及到目前为止对每个贡献者的信任），对文件魔术的额外检查，快速测试以查看给定文件是否可能是有效链接（不读取所有字节），抛出修复如果文件太小，则带有适当消息而不是 ArrayIndexOutOfBoundsException 的 ParseException 进行了一些常规清理。

来源[在这里](https://raw.github.com/codebling/WindowsShortcuts/master/org/stackoverflowusers/file/WindowsShortcut.java)（如果您有任何更改，请将它们直接推送到 GitHub[存储库](https://git@github.com/codebling/WindowsShortcuts.git)/[项目](https://github.com/codebling/WindowsShortcuts)。

```
package org.stackoverflowusers.file;

import java.io.ByteArrayOutputStream;
import java.io.File;
import java.io.FileInputStream;
import java.io.IOException;
import java.io.InputStream;
import java.text.ParseException;

/**
 * Represents a Windows shortcut (typically visible to Java only as a '.lnk' file).
 *
 * Retrieved 2011-09-23 from http://stackoverflow.com/questions/309495/windows-shortcut-lnk-parser-in-java/672775#672775
 * Originally called LnkParser
 *
 * Written by: (the stack overflow users, obviously!)
 *   Apache Commons VFS dependency removed by crysxd (why were we using that!?) https://github.com/crysxd
 *   Headerified, refactored and commented by Code Bling http://stackoverflow.com/users/675721/code-bling
 *   Network file support added by Stefan Cordes http://stackoverflow.com/users/81330/stefan-cordes
 *   Adapted by Sam Brightman http://stackoverflow.com/users/2492/sam-brightman
 *   Based on information in 'The Windows Shortcut File Format' by Jesse Hager &lt;jessehager@iname.com&gt;
 *   And somewhat based on code from the book 'Swing Hacks: Tips and Tools for Killer GUIs'
 *     by Joshua Marinacci and Chris Adamson
 *     ISBN: 0-596-00907-0
 *     http://www.oreilly.com/catalog/swinghks/
 */
public class WindowsShortcut
{
    private boolean isDirectory;
    private boolean isLocal;
    private String real_file;

    /**
     * Provides a quick test to see if this could be a valid link !
     * If you try to instantiate a new WindowShortcut and the link is not valid,
     * Exceptions may be thrown and Exceptions are extremely slow to generate,
     * therefore any code needing to loop through several files should first check this.
     *
     * @param file the potential link
     * @return true if may be a link, false otherwise
     * @throws IOException if an IOException is thrown while reading from the file
     */
    public static boolean isPotentialValidLink(File file) throws IOException {
        final int minimum_length = 0x64;
        InputStream fis = new FileInputStream(file);
        boolean isPotentiallyValid = false;
        try {
            isPotentiallyValid = file.isFile()
                && file.getName().toLowerCase().endsWith(".lnk")
                && fis.available() >= minimum_length
                && isMagicPresent(getBytes(fis, 32));
        } finally {
            fis.close();
        }
        return isPotentiallyValid;
    }

    public WindowsShortcut(File file) throws IOException, ParseException {
        InputStream in = new FileInputStream(file);
        try {
            parseLink(getBytes(in));
        } finally {
            in.close();
        }
    }

    /**
     * @return the name of the filesystem object pointed to by this shortcut
     */
    public String getRealFilename() {
        return real_file;
    }

    /**
     * Tests if the shortcut points to a local resource.
     * @return true if the 'local' bit is set in this shortcut, false otherwise
     */
    public boolean isLocal() {
        return isLocal;
    }

    /**
     * Tests if the shortcut points to a directory.
     * @return true if the 'directory' bit is set in this shortcut, false otherwise
     */
    public boolean isDirectory() {
        return isDirectory;
    }

    /**
     * Gets all the bytes from an InputStream
     * @param in the InputStream from which to read bytes
     * @return array of all the bytes contained in 'in'
     * @throws IOException if an IOException is encountered while reading the data from the InputStream
     */
    private static byte[] getBytes(InputStream in) throws IOException {
        return getBytes(in, null);
    }

    /**
     * Gets up to max bytes from an InputStream
     * @param in the InputStream from which to read bytes
     * @param max maximum number of bytes to read
     * @return array of all the bytes contained in 'in'
     * @throws IOException if an IOException is encountered while reading the data from the InputStream
     */
    private static byte[] getBytes(InputStream in, Integer max) throws IOException {
        // read the entire file into a byte buffer
        ByteArrayOutputStream bout = new ByteArrayOutputStream();
        byte[] buff = new byte[256];
        while (max == null || max > 0) {
            int n = in.read(buff);
            if (n == -1) {
                break;
            }
            bout.write(buff, 0, n);
            if (max != null)
                max -= n;
        }
        in.close();
        return bout.toByteArray();
    }

    private static boolean isMagicPresent(byte[] link) {
        final int magic = 0x0000004C;
        final int magic_offset = 0x00;
        return link.length >= 32 && bytesToDword(link, magic_offset) == magic;
    }

    /**
     * Gobbles up link data by parsing it and storing info in member fields
     * @param link all the bytes from the .lnk file
     */
    private void parseLink(byte[] link) throws ParseException {
        try {
            if (!isMagicPresent(link))
                throw new ParseException("Invalid shortcut; magic is missing", 0);

            // get the flags byte
            byte flags = link[0x14];

            // get the file attributes byte
            final int file_atts_offset = 0x18;
            byte file_atts = link[file_atts_offset];
            byte is_dir_mask = (byte)0x10;
            if ((file_atts & is_dir_mask) > 0) {
                isDirectory = true;
            } else {
                isDirectory = false;
            }

            // if the shell settings are present, skip them
            final int shell_offset = 0x4c;
            final byte has_shell_mask = (byte)0x01;
            int shell_len = 0;
            if ((flags & has_shell_mask) > 0) {
                // the plus 2 accounts for the length marker itself
                shell_len = bytesToWord(link, shell_offset) + 2;
            }

            // get to the file settings
            int file_start = 0x4c + shell_len;

            final int file_location_info_flag_offset_offset = 0x08;
            int file_location_info_flag = link[file_start + file_location_info_flag_offset_offset];
            isLocal = (file_location_info_flag & 2) == 0;
            // get the local volume and local system values
            //final int localVolumeTable_offset_offset = 0x0C;
            final int basename_offset_offset = 0x10;
            final int networkVolumeTable_offset_offset = 0x14;
            final int finalname_offset_offset = 0x18;
            int finalname_offset = link[file_start + finalname_offset_offset] + file_start;
            String finalname = getNullDelimitedString(link, finalname_offset);
            if (isLocal) {
                int basename_offset = link[file_start + basename_offset_offset] + file_start;
                String basename = getNullDelimitedString(link, basename_offset);
                real_file = basename + finalname;
            } else {
                int networkVolumeTable_offset = link[file_start + networkVolumeTable_offset_offset] + file_start;
                int shareName_offset_offset = 0x08;
                int shareName_offset = link[networkVolumeTable_offset + shareName_offset_offset]
                    + networkVolumeTable_offset;
                String shareName = getNullDelimitedString(link, shareName_offset);
                real_file = shareName + "\\" + finalname;
            }
        } catch (ArrayIndexOutOfBoundsException e) {
            throw new ParseException("Could not be parsed, probably not a valid WindowsShortcut", 0);
        }
    }

    private static String getNullDelimitedString(byte[] bytes, int off) {
        int len = 0;
        // count bytes until the null character (0)
        while (true) {
            if (bytes[off + len] == 0) {
                break;
            }
            len++;
        }
        return new String(bytes, off, len);
    }

    /*
     * convert two bytes into a short note, this is little endian because it's
     * for an Intel only OS.
     */
    private static int bytesToWord(byte[] bytes, int off) {
        return ((bytes[off + 1] & 0xff) << 8) | (bytes[off] & 0xff);
    }

    private static int bytesToDword(byte[] bytes, int off) {
        return (bytesToWord(bytes, off + 2) << 16) | bytesToWord(bytes, off);
    }

} 
```

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-03-23T09:58:43.790

[Sam Brightman 的解决方案](https://stackoverflow.com/a/352738/675721)仅适用于本地文件。我添加了对网络文件的支持：

*   [Java中的Windows快捷方式（.lnk）解析器？](https://stackoverflow.com/questions/309495/windows-shortcut-lnk-parser-in-java)
*   [http://code.google.com/p/8bits/downloads/detail?name=The_Windows_Shortcut_File_Format.pdf](http://code.google.com/p/8bits/downloads/detail?name=The_Windows_Shortcut_File_Format.pdf)
*   [http://www.javafaq.nu/java-example-code-468.html](http://www.javafaq.nu/java-example-code-468.html)

    ```
    public class LnkParser {

    public LnkParser(File f) throws IOException {
        parse(f);
    }

    private boolean isDirectory;
    private boolean isLocal;

    public boolean isDirectory() {
        return isDirectory;
    }

    private String real_file;

    public String getRealFilename() {
        return real_file;
    }

    private void parse(File f) throws IOException {
        // read the entire file into a byte buffer
        FileInputStream fin = new FileInputStream(f);
        ByteArrayOutputStream bout = new ByteArrayOutputStream();
        byte[] buff = new byte[256];
        while (true) {
            int n = fin.read(buff);
            if (n == -1) {
                break;
            }
            bout.write(buff, 0, n);
        }
        fin.close();
        byte[] link = bout.toByteArray();

        parseLink(link);
    }

    private void parseLink(byte[] link) {
        // get the flags byte
        byte flags = link[0x14];

        // get the file attributes byte
        final int file_atts_offset = 0x18;
        byte file_atts = link[file_atts_offset];
        byte is_dir_mask = (byte)0x10;
        if ((file_atts & is_dir_mask) > 0) {
            isDirectory = true;
        } else {
            isDirectory = false;
        }

        // if the shell settings are present, skip them
        final int shell_offset = 0x4c;
        final byte has_shell_mask = (byte)0x01;
        int shell_len = 0;
        if ((flags & has_shell_mask) > 0) {
            // the plus 2 accounts for the length marker itself
            shell_len = bytes2short(link, shell_offset) + 2;
        }

        // get to the file settings
        int file_start = 0x4c + shell_len;

        final int file_location_info_flag_offset_offset = 0x08;
        int file_location_info_flag = link[file_start + file_location_info_flag_offset_offset];
        isLocal = (file_location_info_flag & 2) == 0;
        // get the local volume and local system values
        //final int localVolumeTable_offset_offset = 0x0C;
        final int basename_offset_offset = 0x10;
        final int networkVolumeTable_offset_offset = 0x14;
        final int finalname_offset_offset = 0x18;
        int finalname_offset = link[file_start + finalname_offset_offset] + file_start;
        String finalname = getNullDelimitedString(link, finalname_offset);
        if (isLocal) {
            int basename_offset = link[file_start + basename_offset_offset] + file_start;
            String basename = getNullDelimitedString(link, basename_offset);
            real_file = basename + finalname;
        } else {
            int networkVolumeTable_offset = link[file_start + networkVolumeTable_offset_offset] + file_start;
            int shareName_offset_offset = 0x08;
            int shareName_offset = link[networkVolumeTable_offset + shareName_offset_offset]
                    + networkVolumeTable_offset;
            String shareName = getNullDelimitedString(link, shareName_offset);
            real_file = shareName + "\\" + finalname;
        }
    }

    private static String getNullDelimitedString(byte[] bytes, int off) {
        int len = 0;
        // count bytes until the null character (0)
        while (true) {
            if (bytes[off + len] == 0) {
                break;
            }
            len++;
        }
        return new String(bytes, off, len);
    }

    /*
     * convert two bytes into a short note, this is little endian because it's
     * for an Intel only OS.
     */
    private static int bytes2short(byte[] bytes, int off) {
        return ((bytes[off + 1] & 0xff) << 8) | (bytes[off] & 0xff);
    }

    /**
     * Returns the value of the instance variable 'isLocal'.
     *
     * @return Returns the isLocal.
     */
    public boolean isLocal() {
        return isLocal;
    }
    } 
    ```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2016-08-15T09:56:16.500

我可以在 GitHub 上推荐这个存储库：

[https://github.com/BlackOverlord666/mslinks](https://github.com/BlackOverlord666/mslinks)

在那里，我找到了一个**创建**快捷方式的简单解决方案：

`ShellLink.createLink("path/to/existing/file.txt", "path/to/the/future/shortcut.lnk");`

如果您想**阅读**快捷方式：

```
File shortcut = ...;
String pathToExistingFile = new ShellLink(shortcut).resolveTarget(); 
```

如果要**更改**快捷方式的图标，请使用：

```
ShellLink sl = ...;
sl.setIconLocation("/path/to/icon/file"); 
```

您可以编辑快捷链接的大多数属性，例如**工作目录、工具提示文本、图标、命令行参数、热键、创建 LAN 共享文件和目录的链接**等等...

希望这可以帮助你:)

亲切的问候约书亚弗兰克

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-12-09T13:45:24.983

链接到的代码 plan9assembler 似乎只需稍作修改即可工作。我认为只是在需要更改的函数中将s 向上转换为s`& 0xff`时防止符号扩展的“” 。我添加了[http://www.i2s-lab.com/Papers/The_Windows_Shortcut_File_Format.pdf](http://www.i2s-lab.com/Papers/The_Windows_Shortcut_File_Format.pdf)中描述的功能来连接“路径名的最后部分”，即使在实践中这似乎没有在我的示例中使用. 我没有在标题中添加任何错误检查或处理网络共享。这是我现在使用的：`byte``int``bytes2short`

```
import java.io.ByteArrayOutputStream;
import java.io.File;
import java.io.FileInputStream;
import java.text.DecimalFormat;
import java.text.NumberFormat;

public class LnkParser {

    public LnkParser(File f) throws Exception {
        parse(f);
    }

    private boolean is_dir;

    public boolean isDirectory() {
        return is_dir;
    }

    private String real_file;

    public String getRealFilename() {
        return real_file;
    }

    private void parse(File f) throws Exception {
        // read the entire file into a byte buffer
        FileInputStream fin = new FileInputStream(f);
        ByteArrayOutputStream bout = new ByteArrayOutputStream();
        byte[] buff = new byte[256];
        while (true) {
            int n = fin.read(buff);
            if (n == -1) {
                break;
            }
            bout.write(buff, 0, n);
        }
        fin.close();
        byte[] link = bout.toByteArray();

        // get the flags byte
        byte flags = link[0x14];

        // get the file attributes byte
        final int file_atts_offset = 0x18;
        byte file_atts = link[file_atts_offset];
        byte is_dir_mask = (byte) 0x10;
        if ((file_atts & is_dir_mask) > 0) {
            is_dir = true;
        } else {
            is_dir = false;
        }

        // if the shell settings are present, skip them
        final int shell_offset = 0x4c;
        final byte has_shell_mask = (byte) 0x01;
        int shell_len = 0;
        if ((flags & has_shell_mask) > 0) {
            // the plus 2 accounts for the length marker itself
            shell_len = bytes2short(link, shell_offset) + 2;
        }

        // get to the file settings
        int file_start = 0x4c + shell_len;

        // get the local volume and local system values
        final int basename_offset_offset = 0x10;
        final int finalname_offset_offset = 0x18;
        int basename_offset = link[file_start + basename_offset_offset]
                                + file_start;
        int finalname_offset = link[file_start + finalname_offset_offset]
                                + file_start;
        String basename = getNullDelimitedString(link, basename_offset);
        String finalname = getNullDelimitedString(link, finalname_offset);
        real_file = basename + finalname;
    }

    private static String getNullDelimitedString(byte[] bytes, int off) {
        int len = 0;
        // count bytes until the null character (0)
        while (true) {
            if (bytes[off + len] == 0) {
                break;
            }
            len++;
        }
        return new String(bytes, off, len);
    }

    /*
     * convert two bytes into a short note, this is little endian because it's
     * for an Intel only OS.
     */
    private static int bytes2short(byte[] bytes, int off) {
        return ((bytes[off + 1] & 0xff) << 8) | (bytes[off] & 0xff);
    }
} 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-05-13T14:45:34.927

我还在 Java 中的“.lnk”上工作过（现在没有时间）。我的代码在[这里](http://kac-repo.xt.pl/cgi-bin/gitweb.cgi?p=jshortcut.git;a=summary "git 仓库")

它有点乱（一些测试垃圾），但本地和网络解析效果很好。创建链接也实现了。请测试并向我发送补丁。

解析示例：

```
Shortcut scut = Shortcut.loadShortcut(new File("C:\\t.lnk"));
System.out.println(scut.toString()); 
```

创建新链接：

```
Shortcut scut = new Shortcut(new File("C:\\temp"));
OutputStream os = new FileOutputStream("C:\\t.lnk");
os.write(scut.getBytes());
os.flush();
os.close(); 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2015-08-31T10:08:35.420

@Code Bling 的解决方案不适用于用户目录中的文件。
例如“C:/Users/Username/Filename.txt”。
原因是：在[The_Windows_Shortcut_File_Format.pdf](https://code.google.com/p/8bits/downloads/detail?name=The_Windows_Shortcut_File_Format.pdf)

@Stefan Cordes 在第 6 页提到的它说只有前 2 位对卷信息很重要。当卷信息的第一位为“0”时，所有其他位可能会被随机垃圾填充。

因此，如果涉及到：

```
isLocal = (file_location_info_flag & 2) == 0; 
```

那么`file_location_info_flag`可能是“3”。这个文件仍然是本地的，但是这行代码分配`false`给`isLocal`.

所以我建议对@Code Bling 的代码进行以下调整：

```
isLocal = (file_location_info_flag & 1) == 1; 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2018-08-30T21:13:26.530

这个短代码真的很有用......

但是需要两个修复：

*   如果名称不以“.lnk”结尾，isPotentialValidLink 改进为不加载文件

    ```
     public static boolean isPotentialValidLink(final File file) {
        final int minimum_length = 0x64;
        boolean isPotentiallyValid = false;
        if (file.getName().toLowerCase().endsWith(".lnk"))
            try (final InputStream fis = new FileInputStream(file)) {
                isPotentiallyValid = file.isFile() && fis.available() >= minimum_length && isMagicPresent(getBytes(fis, 32));
            } catch (Exception e) {
                // forget it
            }
        return isPotentiallyValid;
      } 
    ```

*   偏移量必须用 32 位计算，而不仅仅是一个字节......

    ```
     final int finalname_offset = bytesToDword(link,file_start + finalname_offset_offset) + file_start;
     final int basename_offset = bytesToDword(link,file_start + basename_offset_offset) + file_start; 
    ```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2020-07-15T20:49:51.703

我发现了其他非专业技术。完成我的工作。

```
File file=new File("C:\\ProgramData\\Microsoft\\Windows\\Start Menu\\Programs\\TeamViewer.lnk");//shortcut link
            FileInputStream stream=new FileInputStream(file);
            DataInputStream st=new DataInputStream(stream);
           byte[] bytes=new byte[(int)stream.getChannel().size()];
           stream.read(bytes);
           String data=new String(bytes);
           int i1=data.indexOf("C:\\Program Files");
           int i2=data.indexOf(".exe",i1);
           System.out.println(data.substring(i1, i2+4)); 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-22T20:29:42.537

给定的代码运行良好，但有一个错误。Java 字节是从 -128 到 127 的有符号值。我们想要一个从 0 到 255 的无符号值来获得正确的结果。只需将 bytes2short 函数更改如下：

```
static int bytes2short(byte[] bytes, int off) {
    int low = (bytes[off]<0 ? bytes[off]+256 : bytes[off]);
    int high = (bytes[off+1]<0 ? bytes[off+1]+256 : bytes[off+1])<<8;
    return 0 | low | high;
} 
```

# c# - 在 C# 中初始化结构数组

> ID：309496
> 
> 赞同：54
> 
> 时间：2008-11-21T17:09:14.267
> 
> 标签：c#, arrays, struct

如何尽可能清楚地初始化 const / static 结构数组？

```
class SomeClass
{

    struct MyStruct
    {
        public string label;
        public int id;
    };

    const MyStruct[] MyArray = {
          {"a", 1}
          {"b", 5}
          {"q", 29}
    };
}; 
```

* * *

## 回答 #1

> 赞同：57
> 
> 时间：2008-11-21T17:18:47.370

首先，你*真的*必须有一个可变结构吗？他们几乎总是一个坏主意。公共领域也是如此。有一些非常偶然的情况下它们是合理的（通常两个部分一起，如`ValueTuple`），但在我的经验中它们非常罕见。

除此之外，我只需要创建一个构造函数来获取这两位数据：

```
class SomeClass
{

    struct MyStruct
    {
        private readonly string label;
        private readonly int id;

        public MyStruct (string label, int id)
        {
            this.label = label;
            this.id = id;
        }

        public string Label { get { return label; } }
        public string Id { get { return id; } }

    }

    static readonly IList<MyStruct> MyArray = new ReadOnlyCollection<MyStruct>
        (new[] {
             new MyStruct ("a", 1),
             new MyStruct ("b", 5),
             new MyStruct ("q", 29)
        });
} 
```

请注意使用[ReadOnlyCollection](http://msdn.microsoft.com/en-us/library/ms132474.aspx)而不是公开数组本身 - 这将使其不可变，避免[直接公开数组的问题](http://blogs.msdn.com/ericlippert/archive/2008/09/22/arrays-considered-somewhat-harmful.aspx)。（代码显示确实初始化了一个结构数组 - 然后它只是将引用传递给 . 的构造函数`ReadOnlyCollection<>`。）

* * *

## 回答 #2

> 赞同：28
> 
> 时间：2008-11-21T17:22:16.440

您使用的是 C# 3.0 吗？您可以像这样使用对象初始值设定项：

```
static MyStruct[] myArray = 
            new MyStruct[]{
                new MyStruct() { id = 1, label = "1" },
                new MyStruct() { id = 2, label = "2" },
                new MyStruct() { id = 3, label = "3" }
            }; 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-11-21T17:24:27.840

默认情况下，您不能初始化 null 以外的引用类型。您必须将它们设为只读。所以这可以工作；

```
 readonly MyStruct[] MyArray = new MyStruct[]{
      new MyStruct{ label = "a", id = 1},
      new MyStruct{ label = "b", id = 5},
      new MyStruct{ label = "c", id = 1}
    }; 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2017-10-24T18:13:01.820

像这样更改`const`并`static readonly`初始化它

```
static readonly MyStruct[] MyArray = new[] {
    new MyStruct { label = "a", id = 1 },
    new MyStruct { label = "b", id = 5 },
    new MyStruct { label = "q", id = 29 }
}; 
```

* * *

## 回答 #5

> 赞同：-3
> 
> 时间：2008-11-21T17:41:25.873

我会在设置静态只读数组的值的类上使用静态构造函数。

```
public class SomeClass
{
   public readonly MyStruct[] myArray;

   public static SomeClass()
   {
      myArray = { {"foo", "bar"},
                  {"boo", "far"}};
   }
} 
```

# sharepoint - SharePoint 没有 SQL 注入漏洞的证据？

> ID：309497
> 
> 赞同：7
> 
> 时间：2008-11-21T17:09:17.793
> 
> 标签：sharepoint, api, architecture, sql-injection

我的公司要求所有生产站点都通过 AppScan 安全扫描。有时，当我们扫描 SharePoint 安装时，该软件会检测到 SQL 盲注漏洞。我很确定这是一个误报——AppScan 可能将 HTTP 响应中的一些其他活动解释为盲注的成功。但很难证明情况确实如此。

我怀疑 MOSS 07 和 WSS 3.0 的 SharePoint 只在幕后使用存储过程。有谁知道微软是否有任何关于此效果的文档，此外，是否有任何存储过程使用动态生成的 SQL？如果一切都是 sproc，并且它们都不是动态的，那么我们将有很好的证据表明 SharePoint 没有 SQL 注入漏洞。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-21T17:21:17.333

它们并不都是存储过程。特别是，像交叉列表连接这样的东西会产生一些可怕的语法。例如，查看[本文](http://blogs.msdn.com/jannemattila/archive/2008/06/21/sql-server-profiler-and-spquery.aspx)中的 SQL Trace 窗口。此外，由于开发人员可以编写用户控件和 API 调用，因此如果您使用自定义模块，则无法保证您不会受到 SQL 注入的影响。

我的猜测是，SharePoint 至少总是使用命名参数。但是，您最好的选择可能是运行 SQL 跟踪并比较结果。此外，如果您是一个足够大的客户，您可以尝试致电您当地的 MSFT 传播者（或在[connect.microsoft.com](http://connect.microsoft.com)上发布问题），看看是否能得到答复。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-21T18:56:02.197

谢谢。我自己查看了分析器，发现了一些东西： 看起来 SharePoint 只是在执行存储过程。偶尔会出现一些纯 SQL，但这些似乎仅限于“exec sp_oledb_ro_usrname”和“select collat​​ionname(...)”，它们似乎是一些深入的内部事物，并且可能不会作为 SQL 在所有，但只是以这种方式出现在分析器中......？

SharePoint 偶尔会使用 sp_executesql，但这是一个参数化调用，因此可能不会被注入。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2013-11-01T14:11:01.660

有许多基于响应延迟的相对较新的盲 SQL 注入向量 - 例如使用`WAITFOR DELAY`. 至少 sqlmap 和 BurpSuite 使用它们（可能还有其他人）。

然而，这些向量很容易出现误报，因为触发因素是 HTTP 响应延迟，如果您通过 Internet 进行扫描，也可能由于其他数千个原因而发生这种情况。如果您通过 LAN 获得这些，我会更加怀疑，但仍会调查服务器端其他可能的延迟原因。仅当您在多次独立尝试中始终如一地获得延迟时，您可能正在处理一个漏洞。

另请注意，SharePoint 经常在许多 vuln 扫描程序中触发旧的 FrontPage 漏洞，这也是误报 - 有关详细信息，请参阅本文[“安全扫描程序结果中的 SharePoint 和 FrontPage 服务器扩展”](http://ipsec.pl/node/1088)。

# jquery - 为什么我不能集中使用 slideDown() 显示的控件？

> ID：309506
> 
> 赞同：1
> 
> 时间：2008-11-21T17:13:15.540
> 
> 标签：jquery

当您单击按钮并设置其焦点时，我想显示一个带有输入的 div。

如果我使用 show()，它可以工作，但如果我使用 slideDown() **，动画完成后焦点会丢失**。我怎样才能防止这种情况发生？

示例代码：

```
$("document").ready(function(){
    $("#MyButton").click(function(e){
        e.preventDefault();
        $(".SlidingDiv").slideDown();
        $("#MyInput").focus();
    });
});

<input type="button" value="Click Me" id="MyButton" />
<div class="SlidingDiv" style="display:none;"><input type="text" id="MyInput" /></div> 
```

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-11-21T17:30:17.923

试试这个：

```
$(function(){
    $("#MyButton").click(function(e){
        e.preventDefault();
        $(".SlidingDiv").slideDown(function(){
            // Callback function - will occur when sliding is complete.
            $("#MyInput").focus();
        });
    });
}); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-21T17:18:10.227

我认为您只能在 DIV 完全停止滑动后才能聚焦元素？
没有把握...

# sql - SQL Server：在 SQL Server 中确定日期，但保持确定性

> ID：309522
> 
> 赞同：6
> 
> 时间：2008-11-21T17:17:34.407
> 
> 标签：sql, sql-server, indexing, sql-server-2000, deterministic

（这与[在 SQL server 中设置日期](https://stackoverflow.com/questions/85373/floor-a-date-in-sql-server)有关。）

是否存在确定性表达式来确定 DATETIME？当我将其用作计算列公式时：

```
DATEADD(dd, DATEDIFF(dd, 0, [datetime_column]), 0) 
```

在该列上放置索引时出现错误：

> 无法创建索引，因为键列“EffectiveDate”不确定或不精确。

但是 DATEDIFF 和 DATEADD 根据定义都是确定性函数。问题在哪里？是否可以？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-21T19:51:16.233

我的猜测是，这是某种错误。在 SQL 2005 中，我能够毫无问题地创建这样的索引视图（代码如下）。当我尝试在 SQL 2000 上运行它时，我遇到了与您遇到的相同的错误。

以下似乎适用于 SQL 2000，但我收到一条警告，指出索引将被忽略，并且每次从视图中选择时都必须进行转换。

```
CONVERT(CHAR(8), datetime_column, 112) 
```

在 SQL 2005 中工作：

```
CREATE TABLE dbo.Test_Determinism (
    datetime_column DATETIME    NOT NULL    DEFAULT GETDATE())
GO

CREATE VIEW dbo.Test_Determinism_View
WITH SCHEMABINDING
AS
    SELECT
        DATEADD(dd, DATEDIFF(dd, 0, [datetime_column]), 0) AS EffectiveDate
    FROM
        dbo.Test_Determinism
GO

CREATE UNIQUE CLUSTERED INDEX IDX_Test_Determinism_View ON dbo.Test_Determinism_View (EffectiveDate)
GO 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-21T17:28:10.970

您的列 [datetime_column] 的默认值是否设置为“getDate()”？

如果是这样，由于 getdate() 函数是不确定的，这将导致此错误...

用户定义的函数是确定性的还是非确定性的取决于函数的编码方式。用户定义的函数是确定性的，如果：

1.  该函数是模式绑定的。
2.  用户定义函数调用的所有内置或用户定义函数都是确定性的。
3.  函数体不引用函数范围之外的数据库对象。例如，确定性函数不能引用函数本地表变量以外的表。
4.  该函数不调用任何扩展存储过程。

不满足这些条件的用户定义函数被标记为不确定的。用户定义的函数体中不允许内置的非确定性函数。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-21T17:29:11.997

试试这个：

```
CAST(FLOOR(CAST([datetime_column] as FLOAT)) AS DateTime) 
```

它应该比 CONVERT 选项快得多。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2013-07-24T11:00:01.793

这是我回答原始问题的最佳答案：

试试这个：

```
/* create a deterministic schema bound function */
CREATE FUNCTION FloorDate(@dt datetime)
RETURNS datetime
WITH SCHEMABINDING
AS
BEGIN 
    RETURN CONVERT(datetime,  FLOOR(CONVERT(float, @dt)))
END
GO 
```

要进行测试，请尝试以下操作。请注意计算列使用“PERSISTED”，引用函数时使用 [dbo.]

```
/*create a test table */
CREATE TABLE [dbo].[TableTestFloorDate](
    [Id] [int] IDENTITY(1,1) NOT NULL,
    [TestDate] [datetime] NOT NULL,
    [TestFloorDate]  AS ([dbo].[FloorDate]([TestDate])) PERSISTED,
 CONSTRAINT [PK_TableTestFloorDate] PRIMARY KEY CLUSTERED 
(
    [Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) 
) 
```

您现在应该能够在计算列上添加索引（但请参阅稍后的问题）

```
CREATE INDEX IX_TestFloorDate ON  [dbo].[TableTestFloorDate](TestFloorDate) 
```

根据需要多次插入一些随机数据，但如果您希望测试索引使用/执行计划，则更多（1000+）更好

```
INSERT INTO TableTestFloorDate (TestDate) VALUES( convert(datetime, RAND()*50000)) 
```

获取结果

```
SELECT * FROM TableTestFloorDate WHERE TestFloorDate='2013-2-2' 
```

现在这里是 GOTCHA... 已在计算列上创建的索引未使用！相反，即使在持久字段 TestFloorDate 上选择数据时，SQLServer（或至少我的版本）更喜欢 TestDate 上的索引。

```
CREATE INDEX IX_TestFloorDate ON  [dbo].[TableTestFloorDate](TestDate) 
```

我很确定（从内存中）计算的持久列上的索引从性能角度来看是有益的 - 我想你只需要尝试/测试你自己的特定用法

（希望我有帮助！）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-21T17:29:15.337

看看[Cade Roux 提出并回答的那个问题](https://stackoverflow.com/questions/309492/user-defined-functions-sql-server-2005-flagged-incorrectly-as-non-deterministic)。也许解决方案是使用 WITH SCHEMABINDING 创建一个函数，然后在计算列中使用它

**编辑**

我了解您的目标是能够在该列上建立索引。

如果计算列无法做到这一点，那么唯一的选择可能是创建一个普通列并在每次更新它所基于的列时修改该列中的数据。（在触发器中说）

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-21T18:03:50.587

我建议稍微简单一些：

```
 cast(cast([datetime_column] as int) as datetime) 
```

但我怀疑你会遇到同样的问题。

现在，如果问题在于转换回日期时间，您可能需要考虑将`cast([datetime_column] as int)`其用作单独的字段，仅用于索引。

# c# - 无法访问网络服务

> ID：309533
> 
> 赞同：1
> 
> 时间：2008-11-21T17:20:00.987
> 
> 标签：c#, web-services, asmx

我有一个网络服务@ [http://recpushdata.cyndigo.com/Jobs.asmx](http://recpushdata.cyndigo.com/Jobs.asmx)，但我无法访问它，尽管我将它正确地添加为 WebReference。

任何帮助都会很棒。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-05T14:31:07.167

你的意思是你得到“测试表格只适用于来自本地机器的请求”。访问方法时出错？如果是这样，您需要将以下内容添加到 web.config 的 <system.web> 部分

```
<webServices>
  <protocols>
    <add name="HttpGet"/>
    <add name="HttpPost"/>
  </protocols>
</webServices> 
```

这使您可以从本地计算机访问该方法

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-21T17:22:21.107

AFAI 可以看到，asmx 页面有服务器错误，所以你将无法访问它。联系 Web 服务的管理员以修复错误。

# ruby - 使用 Ruby 的递归目录列表，文件名中包含中文字符

> ID：309539
> 
> 赞同：5
> 
> 时间：2008-11-21T17:22:10.390
> 
> 标签：ruby, file, unicode, directory-listing, cjk

我想在一个目录中生成一个文件列表。一些文件名包含中文字符。

例如：[试验].Test.txt

我正在使用以下代码：

```
require 'find'
dirs = ["TestDir"]
for dir in dirs
    Find.find(dir) do |path|
    if FileTest.directory?(path)
    else
        p path
    end
    end
end 
```

运行脚本会生成一个文件列表，但中文字符会被转义（替换为反斜杠后跟数字）。使用上面的示例文件名将产生：

“TestDir/[\312\324\321\351]Test.txt”而不是“TestDir/[试验].Test.txt”。

如何修改脚本以输出汉字？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-21T18:31:59.077

Ruby 需要知道您正在处理代码中的 unicode。使用 KCODE 设置适当的字符编码，如下所示：

```
$KCODE = 'utf-8' 
```

我认为 utf-8 对于汉字来说已经足够了。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-06-07T14:35:43.427

以下代码更优雅，不需要“查找”。它会在工作目录（或您放入的任何目录）中生成文件列表（但不是目录）。

```
Dir.entries(Dir.pwd).each do |x|
  p x.encode('UTF-8') unless FileTest.directory?(x)  
end 
```

并获得递归挖掘一个级别使用：

```
Dir.glob('*/*').each do |x|
  p x.encode('UTF-8') unless FileTest.directory?(x)  
end 
```

我确信有一种方法可以让它一直向下运行，但`Dir.glob('**/*')`如果我没记错的话会遍历整个文件系统。

# java - 集成 Grails 和 GWT

> ID：309543
> 
> 赞同：17
> 
> 时间：2008-11-21T17:22:41.870
> 
> 标签：java, gwt, grails, groovy

对于不喜欢（或不知道）HTML/JS/CSS 来构建富 Web 界面的 Java 开发人员来说，GWT 似乎是一项非常好的技术。在服务器端，Grails 看起来也很不错，它经常被描述为“面向 Java 开发人员的 Rails”。我读过 Grails 的“约定优于配置”方法，以及动态语言 (Groovy) 的优势，可以真正减少需要编写的（样板）代码量，同时仍然利用同类最佳的 Java 技术比如 Spring 和 Hibernate。

无论如何，我还没有读到太多关于这些技术如何协同工作的信息。在服务器端将 GWT 与 Grails 集成起来有多容易？我有兴趣了解使用这些技术构建应用程序的任何人的经验吗？也非常欢迎关于构建 GWT-Grails 网站的资源（书籍/网站）的建议。

干杯，唐

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-11-22T12:30:50.243

Grails 已经有一个 gwt 插件：[检查一下](http://grails.org/GWT+Plugin)。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-23T13:53:02.867

您确实在服务器端提到过 - GWT 和 grails 实际上并没有在服务器端很好地集成（考虑到 grails 域对象的工作情况，不如您预期的那么好）。对于 RPC，它的插件工作得非常好。

问题是域对象不能被序列化和通过网络传输 - 毕竟，它们是 groovy 对象。您将需要自定义制作数据传输对象 (DTO)，并手动进行编组。可以将其自动化，但没有任何开源代码可以自动执行它 - 所以滚动你自己的代码是唯一的解决方案。

或者看看你是否可以让 Hibernate4gwt 与 grails 一起工作——但我怀疑它也不会开箱即用。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-07-31T18:17:18.917

另一种方法：将 Grails 与 SmartGWT 一起使用。使用基于 REST 的集成来代替 GWT-RPC（太复杂，并且正如其他人所指出的，与 Grails 不兼容），因为 Grails 对序列化为 XML 或 JSON 有很好的支持，而 SmartGWT 具有内置的 REST 支持。看看这个显示示例源的博客 - 为任何 Grails 对象构建可重用的主从屏幕非常容易。

[http://josip-dev.blogspot.com/2010/06/grails-smart-gwt.html](http://josip-dev.blogspot.com/2010/06/grails-smart-gwt.html)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-21T20:38:39.150

> 借助动态语言（Groovy）的优势，可以真正减少需要编写的（样板）代码量

这就是 RoR 阵营的人们一直在宣扬的。在一些最初的繁荣之后，RoR 项目在更大的项目中不可避免地遇到了麻烦。项目越大，应该委派给编译器的工作就越多，即静态语言越有价值。目前，RoR 热潮已经一去不复返了。

例如，您现在需要使用 JPA/Hibernate 编写的（额外）代码量几乎为零。仅注释。它甚至可以在运行时通过类路径找到映射的 bean！SpringFramework 也使许多其他“样板”代码块过时。

在我的 GWT 项目中（必须承认，到目前为止），我使用了 JPA（Hibernate）、DAO 层、业务委托模式，它既简单又健壮。

# java - 助手/实用程序类应该是抽象的吗？

> ID：309553
> 
> 赞同：52
> 
> 时间：2008-11-21T17:27:10.800
> 
> 标签：java, abstract-class

我经常发现自己从类中提取常见行为到只包含一组静态方法的帮助程序/实用程序类中。我经常想知道是否应该将这些类声明为抽象类，因为我真的想不出实例化这些类的正当理由？

将这样的类声明为抽象类的优点和缺点是什么。

```
public [abstract] class Utilities{

   public static String getSomeData(){
       return "someData";
   }

   public static void doSomethingToObject(Object arg0){
   }
} 
```

* * *

## 回答 #1

> 赞同：83
> 
> 时间：2008-11-21T17:32:27.590

您可以只声明一个什么都不做的私有构造函数。

将类声明为“抽象”的问题在于，abstract 关键字通常意味着该类旨在被子类化和扩展。这绝对不是你想要的。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2008-11-21T17:33:14.127

不要费心将它们抽象化，而是包含一个私有的无参数构造函数以防止它们被实例化。

感兴趣的人的比较点：在 C# 中，您可以将类声明为静态，使其以编译形式抽象*和*密封（Java 的最终形式），并且根本没有任何实例构造函数。这也使得声明该类型的参数、变量、数组等成为编译时错误。便利。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-11-22T17:51:38.130

我没有将实用程序类声明为抽象的，而是将它们声明为最终的并将构造函数设为私有。这样它们就不能被子类化，也不能被实例化。

```
 public final class Utility
{
    private Utility(){}

    public static void doSomethingUseful()
    {
        ...
    }
} 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-01-29T20:35:27.093

我会在私有构造函数之外添加更多步骤：

```
public class Foo {
   // non-instantiable class
   private Foo() { throw new AssertionError(); }
} 
```

抛出`AssertionError`阻止同一类中的方法实例化该类（好吧，他们可以尝试）。这通常不是问题，但在团队环境中，你永远不知道有人会做什么。

关于“abstract”关键字，我注意到在许多实例中都包含实用程序类：

```
public class CoreUtils { ... }
public class WebUtils extends CoreUtils { ... }

public class Foo { ... WebUtils.someMethodInCoreUtils() ... } 
```

我相信这样做是为了让人们不必记住要包含哪个实用程序类。这有什么缺点吗？这是反模式吗？

问候， LES

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-11-21T17:31:55.580

通过将它们声明为抽象，您实际上是在向其他编码人员表明您打算派生这些类。真的，你是对的，没有太大区别，但这里的语义实际上更多的是关于其他人查看你的代码的解释。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-11-22T16:56:17.150

正如其他人所说，制作一个私有的无参数构造函数。除了类本身之外，没有人可以创建它的实例。

正如其他人已经展示了它是如何用其他语言完成的，下面是你如何在下一个 C++ 版本中做到这一点，如何使一个类不可实例化：

```
struct Utility { 
    static void doSomething() { /* ... */ } 
    Utility() = delete; 
}; 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2019-08-21T13:52:21.463

我认为最好使用私有的无参数构造函数来声明实用程序类 final。此外，此类的所有成员都应该是静态的。

在一个语句中完成所有这些操作的一种简单方法是使用[`@UtilityClass`Lombok 的注释](https://projectlombok.org/features/experimental/UtilityClass)：

```
@UtilityClass
public class Utilities{

   public String getSomeData() {
       return "someData";
   }

   public void doSomethingToObject(Object arg0) {
   }
} 
```

如果您使用`@UtilityClass`注解，您可以跳过上面示例中的静态关键字，因为 Lombok 在编译期间会自动添加它们。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-21T17:31:57.890

不，但是如果您的语言支持它，则有一个强有力的论据，即在大多数情况下它们应该（可以）被声明为“静态”......静态告诉编译器它们不能被实例化，并且它们中的所有方法必须是静态的。

摘要适用于具有基于实例的实现细节的类，派生类的实例将使用这些细节......

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-21T17:41:28.960

Helper / Utility 方法很好。不必担心将它们添加到应用程序或框架内的库中。我见过的大多数框架都以多种方式使用它们。

话虽如此，如果您想真正了解它们，您应该研究C# 3.0 中的[扩展方法](http://weblogs.asp.net/dwahlin/archive/2008/01/25/c-3-0-features-extension-methods.aspx)。使用扩展方法将使您的实用程序更像是您的框架的“整体”部分，这看起来就像您通过考虑使它们抽象来尝试做的事情。更不用说扩展方法写起来很有趣！

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-11-22T16:14:53.020

有人提到，在 C# 3.0 中，您可以通过扩展方法来实现这一点。我不是 C# 人，在 1.5/2.0 的日子里做过一些，但从那以后就没有使用过。基于一个非常粗略的理解，我认为可以在 java 中使用静态导入来完成类似的事情。我意识到这根本不是一回事，但如果目标是让这些实用方法对调用类看起来更“原生”（因为没有更好的术语），我认为它会成功。假设我在原始问题中声明了 Utilities 类。

```
import static Utilities.getSomeData;

public class Consumer {

    public void doSomething(){

        String data =  getSomeData();
    }

} 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-01-29T21:10:27.087

我可以提供一些建设性的建议吗？

如果你做了很多这样的事情，你会遇到两个问题。

首先，采用参数的静态方法通常应该是作为该参数的对象的一部分。我意识到这对像 String 这样的对象没有帮助，但是如果它需要您定义的对象，您几乎可以肯定地通过将您的帮助器作为该对象的方法来改进该对象。

如果它采用所有本机值，您可能可以定义一个对象，它是它的一种方法。看看您是否可以找到这些原生值的任何分组并将它们分组为一个对象。如果你只是尝试一下，你会发现这个小迷你物体还有很多其他用途，而且在你知道它之前它会非常有用。

另一件事，如果你有一个带有一堆半相关的静态方法和静态变量的实用程序类，你几乎总是希望它是一个单例。我通过反复试验发现了这一点，但是当你发现你需要超过 1 个（最终你会）时，将单例变为多例（？）然后尝试将静态类更改为多例（好的，所以我现在正在编造词）。

祝你好运。对我来说，这些东西主要是反复试验——不过就像 5 年前一样，我从来没有找到一个我后悔没有静态类/方法的实例。

# java - 如何阻止 Sun JDK1.6 内置 StAX 解析器解析 DTD 实体

> ID：309565
> 
> 赞同：2
> 
> 时间：2008-11-21T17:31:04.317
> 
> 标签：java, xml, parsing, stax

我正在使用基于 StAX 事件的 API 来修改 XML 流。该流代表一个 HTML 文档，带有 DTD 声明。我想将此 DTD 声明复制到输出文档中（使用 编写`XMLEventWriter`）。当我要求工厂忽略 DTD 时，它不会下载 DTD，而是删除整个语句，只留下一个“ `<!DOCUMENTTYPE`”字符串。如果不忽略，则下载整个 DTD，并在逐字输出 DTD 事件时包含在内。我不想花时间下载这个 DTD，但要包含完整的 DTD 规范（解析实体已被禁用，我不需要它）。有谁知道如何禁用外部 DTD 的获取。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-21T18:04:03.237

您应该能够实现一个自定义 XMLResolver，它将获取外部 DTD 的尝试重定向到本地资源（如果您的代码仅解析特定的文档类型，这通常是 JAR 中的类资源）。

```
class CustomResolver implements javax.xml.stream.XMLResolver {

  public Object resolveEntity(String publicID,
                              String systemID,
                              String baseURI,
                              String namespace)
                  throws XMLStreamException 
  {
    if ("The public ID you expect".equals(publicID)) {
      return getClass().getResourceAsStream("doc.dtd");
    } else {
      return null;
    }
  } 
```

请注意，某些文档仅包含“systemID”，因此您应该回退到检查它。系统标识符的问题在于它应该是“系统”特定的 URL，而不是众所周知的稳定 URI。在实践中，它经常被当作 URI 来使用。

请参阅[setXMLResolver](http://java.sun.com/javase/6/docs/api/javax/xml/stream/XMLInputFactory.html#setXMLResolver(javax.xml.stream.XMLResolver))方法。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-27T20:42:18.613

另外：如果到目前为止您一直在使用与 JDK 1.6 捆绑的默认 Sun stax 解析器，那么您的原始方法（将 SUPPORT_DTD 设置为 false）可能适用于 Woodstox。

# sql-server - SQL 2005 触发问题

> ID：309566
> 
> 赞同：1
> 
> 时间：2008-11-21T17:31:38.047
> 
> 标签：sql-server, sql-server-2005, stored-procedures, triggers

我可以确定导致触发器从触发器中触发的存储过程的名称吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-21T17:33:00.397

我不确定，但是如果它不是由存储过程触发的呢？

你也许可以[`DBCC INPUTBUFFER`](http://msdn.microsoft.com/en-us/library/ms187730.aspx)像[本文](http://vyaskn.tripod.com/tracking_sql_statements_by_triggers.htm)中那样使用。

# jquery - jQuery 验证：如何不显示错误？或如何将错误显示为工具提示？

> ID：309574
> 
> 赞同：11
> 
> 时间：2008-11-21T17:34:22.017
> 
> 标签：jquery, validation

我希望我的错误浮在左对齐的未验证输入字段上方。我怎样才能做到这一点？

如果我不能，我该如何关闭错误？我仍然希望字段验证（并突出显示错误），但不希望显示实际的错误消息。我似乎在 jQuery 文档中找不到任何可以让我打开/关闭它们的东西......？？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-11-23T04:03:37.940

正如 J Cooper 建议的那样，为您的 jQuery 验证调用使用 errorPlacement 属性：

```
$(...).validate({
    errorPlacement: function(error, element) {
        error.insertBefore(element);
    }
}); 
```

和 CSS 来设置错误样式（在您的样式表中，或单个元素中）：

```
label.error {
    /* Move the error above the input element. */
    position: absolute;
    line-height: 1.5em;
    margin-top: -1.5em;

    background-color: red;
    color: white;
    padding: 0 2px;
} 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-11-21T21:11:08.740

您需要 errorPlacement 选项，可能还需要 errorContainer 和 errorElement 以进行进一步自定义。

请参阅[http://docs.jquery.com/Plugins/Validation/validate#toptions](http://docs.jquery.com/Plugins/Validation/validate#toptions)

# embedded - Windows CE 设备：在无头设备上使用 .zip 或 .cab 部署？

> ID：309578
> 
> 赞同：2
> 
> 时间：2008-11-21T17:35:25.807
> 
> 标签：embedded, installation, windows-ce

我有一个我们正在部署的 Windows CE 设备，但是我们可以完全控制它上面安装的软件。

这不是典型的 Windows Mobile 设备，而是用户不会与之交互的无头设备。我知道在 PDA 风格的 WinCE 设备上，.cab 文件是首选的应用程序分发方法。

但是，在无头设备上，我们将编写某种类型的升级/补丁服务器，它将 ping 服务器以获取更新、下载它们并在可用时自动安装。

我还想要一个 .cab 文件，还是一个 .zip（甚至其他东西）更好？

.cab 文件的要求是什么 - 什么样的限制/要求可能会妨碍并令人烦恼？有什么好处？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-21T17:51:28.660

我会坚持使用 CAB 作为一个包，因为即使是无头设备也可以使用 CAB 提取工具。如果你压缩它，那么你必须添加一个 ZIP 支持库和应用程序。CAB 还能够添加注册表项并定义比 zip 更多不同的目标位置（我希望 x.dll 在 \Windows 中，但 prog.exe 在我的程序文件夹中 - 尝试使用 ZIP）。

要记住的一件事是 wceload（CAB 提取器）默认使用 UI，因此您将要使用 /noui 开关之类的东西。

如果您是真正的无头，这可能不是问题（很长一段时间都没有这样做），但是相当常见的“无头”配置具有显示支持，并且显示器根本没有连接，或者类似于 NOP VGAFLAT 驱动程序. 这允许您运行 shell 并访问所有漂亮的 shell API，但增加了 GWES 将对话框呈现到不存在的显示器上的挑战。

OpenNETCF 也有一个 CAB 安装程序 SDK，您可以使用它通过创建自己的安装程序应用程序来完全删除任何 UI。这可能有用也可能没有用，具体取决于安装的方式和时间（例如通过 HKLM\Init 或 otehr）。

# c++ - C++ STL 中的 const_iterator 和非 const 迭代器有什么区别？

> ID：309581
> 
> 赞同：165
> 
> 时间：2008-11-21T17:36:25.023
> 
> 标签：c++, stl, iterator, constants

`const_iterator`a和 an有什么区别，`iterator`你会在哪里使用一个而不是另一个？

* * *

## 回答 #1

> 赞同：149
> 
> 时间：2008-11-21T17:39:25.253

`const_iterator`s 不允许您更改它们指向的值，常规`iterator`s 可以。

与 C++ 中的所有内容一样，始终喜欢`const`，除非有充分的理由使用常规迭代器（即，您想使用它们不会`const`更改指向值的事实）。

* * *

## 回答 #2

> 赞同：47
> 
> 时间：2008-11-21T17:51:09.473

它们几乎应该是不言自明的。如果 iterator 指向 T 类型的元素，则 const_iterator 指向“const T”类型的元素。

它基本上等同于指针类型：

```
T* // A non-const iterator to a non-const element. Corresponds to std::vector<T>::iterator
T* const // A const iterator to a non-const element. Corresponds to const std::vector<T>::iterator
const T* // A non-const iterator to a const element. Corresponds to std::vector<T>::const_iterator 
```

一个 const 迭代器总是指向同一个元素，所以迭代器*本身*就是 const。但是它指向的元素不一定是const，所以它指向的元素是可以改变的。const_iterator 是指向 const 元素的迭代器，因此虽然迭代器本身可以更新（例如，递增或递减），但它指向的元素不能更改。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2010-09-02T16:18:15.773

不幸的是，许多 STL 容器的方法都使用**迭代器**而不是**const_iterators**作为参数。所以如果你有一个**const_iterator**，你不能说“在这个迭代器指向的元素之前插入一个元素”（在我看来，这样的事情在概念上并不是违反 const 的）。**如果您仍然想这样做，则必须使用std::advance()**或**boost::next()**将其转换为非常量迭代器。例如。**boost::next(container.begin(), std::distance(container.begin(), the_const_iterator_we_want_to_unconst))**。如果**容器**是**std::list**，则该调用的运行时间将为**O(n)**。

因此，在任何“合乎逻辑”的地方添加 const 的通用规则对于 STL 容器来说就不那么通用了。

但是，boost 容器采用 const_iterators（例如 boost::unordered_map::erase()）。因此，当您使用 boost 容器时，您可以“积极进取”。顺便说一句，有人知道 STL 容器是否或何时会修复？

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-11-21T17:51:33.607

尽可能使用**const_iterator** ，别无选择时使用**iterator 。**

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2016-12-22T02:55:04.043

**最小的可运行示例**

非常量迭代器允许您修改它们指向的内容：

```
std::vector<int> v{0};
std::vector<int>::iterator it = v.begin();
*it = 1;
assert(v[0] == 1); 
```

常量迭代器不会：

```
const std::vector<int> v{0};
std::vector<int>::const_iterator cit = v.begin();
// Compile time error: cannot modify container with const_iterator.
//*cit = 1; 
```

如上所示，`v.begin()`被`const`重载，并根据容器变量的 const-ness返回`iterator`或返回：`const_iterator`

*   [begin() 如何知道要返回哪种返回类型（const 或 non-const）？](https://stackoverflow.com/questions/12646998/how-does-begin-know-which-return-type-to-return-const-or-non-const)
*   [const 和非常量函数的重载是如何工作的？](https://stackoverflow.com/questions/5103543/how-does-overloading-of-const-and-non-const-functions-work)

`const_iterator`弹出的常见情况是在方法`this`中使用when `const`：

```
class C {
    public:
        std::vector<int> v;
        void f() const {
            std::vector<int>::const_iterator it = this->v.begin();
        }
        void g(std::vector<int>::const_iterator& it) {}
}; 
```

`const`使`this`const，从而使`this->v`const。

您通常可以使用 忘记它`auto`，但如果您开始传递这些迭代器，您将需要考虑它们的方法签名。

就像 const 和 non-const 一样，您可以轻松地将 non-const 转换为 const，但反之则不行：

```
std::vector<int> v{0};
std::vector<int>::iterator it = v.begin();

// non-const to const.
std::vector<int>::const_iterator cit = it;

// Compile time error: cannot modify container with const_iterator.
//*cit = 1;

// Compile time error: no conversion from const to no-const.
//it = ci1; 
```

使用哪一个：类似于`const int`vs `int`：只要您可以使用 const 迭代器（当您不需要用它们修改容器时），就更喜欢它们，以便更好地记录您在不修改的情况下阅读的意图。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-21T18:42:17.683

（正如其他人所说） const_iterator 不允许您修改它指向的元素，这在 const 类方法中很有用。它还允许您表达您的意图。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2011-01-17T06:32:18.577

好的，让我先用一个非常简单的例子来解释它，而不使用常量迭代器考虑我们有随机整数集合“randomData”

```
 for(vector<int>::iterator i = randomData.begin() ; i != randomData.end() ; ++i)*i = 0;
for(vector<int>::const_iterator i = randomData.begin() ; i!= randomData.end() ; ++i)cout << *i; 
```

可以看出，在集合内写入/编辑数据时使用了普通迭代器，但为了读取目的，使用了常量迭代器。如果您尝试在第一个 for 循环中使用常量迭代器，您将得到错误。作为一个经验法则，使用常量迭代器来读取集合内的数据。

# perl - 如何将文件名附加到该文件中每一行的末尾？

> ID：309604
> 
> 赞同：0
> 
> 时间：2008-11-21T17:48:30.210
> 
> 标签：perl, bash, sed, awk

我需要对数百个文件执行以下操作： 将文件名（可能包含空格）附加到文件中每一行的末尾。

在我看来应该有一些方法可以做到这一点：

```
sed -e 's/$/FILENAME/' * 
```

其中`FILENAME`表示当前文件的名称。是否有代表当前文件名的 sed 变量？或者是否有人使用 bash、awk 等有不同的解决方案？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-21T18:04:11.770

我确定还有其他方法可以做到这一点，我会使用 perl：

```
perl -p -i -e 's/$/$ARGV/;' * 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-21T17:53:37.330

您可以使用 bash 脚本来完成

```
for i in * 
do
  sed -e "s/\$/$i/" "$i" 
done 
```

单行版本：

```
for i in * ; do sed -e "s/\$/$i/" "$i" ; done 
```

**编辑：**如果您想用新的名称附加行*替换文件的内容，请执行以下操作：*

```
TFILE=`mktemp`
for i in * 
do
  sed -e "s/\$/$i/" "$i" > $TFILE
  cp -f $TFILE "$i"
done
rm -f $TFILE 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-21T18:01:02.947

某些版本的 sed 支持“--in-place”参数，因此您可以将 Tyler 的解决方案浓缩为

```
for i in * ; do 
  sed -e "s/\$/$i/" --in-place "$i" 
done 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-21T18:11:51.910

```
awk '{print $0,FILENAME}' > tmpfile 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-21T17:54:49.450

在 BASH 中，我会做一些事情：

```
for f in *; do echo $f >> $f; done 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-21T18:09:24.553

或多或少是 Tyler 的建议，只是做了一些修改以允许名称中的空格。虽然我希望有一个单行...

```
(
  OLDIFS=$IFS
  IFS=$'\n'
  for f in *
  do
    IFS=OLDIFS
    sed -e "s/\$/$f/" $f > tmpfile
    mv tmpfile $f
    IFS=$'\n'
  done
) 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-03-18T17:24:13.230

这可能对您有用：

```
printf "%s\n" * | sed 's/.*/sed -i "s|$| &|" &/' | bash 
```

# php - 在 PHP 中通过 SSH 连接到 MySQL 服务器

> ID：309615
> 
> 赞同：20
> 
> 时间：2008-11-21T17:53:18.047
> 
> 标签：php, mysql, ssh

我想通过 ssh 建立一个到我的 mysql 服务器的 ssh 隧道。

理想情况下，我会返回一个 mysqli 数据库指针，就像我直接连接一样。

我在一个没有[SSH2](http://ca.php.net/ssh2)库的共享主机上，但我可以使用 PECL 在本地安装它们。

如果有一种方法可以使用本机命令，那就太好了。

我在想这样的事情，但是如果没有这些库，它将无法工作。

```
$connection = ssh2_connect('SERVER IP', 22); 

ssh2_auth_password($connection, 'username', 'password');

$tunnel = ssh2_tunnel($connection, 'DESTINATION IP', 3307);

$db = new mysqli_connect('127.0.0.1', 'DB_USERNAME', 'DB_PASSWORD', 
                         'dbname', 3307, $tunnel)
    or die ('Fail: ' . mysql_error()); 
```

有人有想法么？我在liquidweb 上运行一个共享的CentOS linux 主机。

关于使隧道持久化的任何想法？是否可以用另一个脚本建立它并利用它`PHP`？

谢谢。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-11-22T05:44:32.560

我会使用[autossh](http://www.harding.motd.ca/autossh/)工具为您的 mysql 数据库创建一个持久的 ssh 隧道。然后，您在 PHP 代码中所要做的就是将其指向 localhost。

您可以通过以下方式对此进行测试（无需自动重启）：

```
ssh -L 3306:localhost:3306 user@domain.com 
```

设置一个 ssh 密钥，这样您就不需要使用密码，并调整 mysql 系统上的 .ssh/authorized_keys 文件，只允许它用于端口转发。

有关 ssh 技巧的更多信息，请参阅[Brian Hatch](http://www.hackinglinuxexposed.com/articles/20030228.html)关于 SSH 和端口转发的优秀系列。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2012-09-30T09:39:40.823

在 SQL 操作过程中，隧道必须保持打开状态。以下来自[RJMetrics](http://blog.rjmetrics.com/PHP-MySQL-and-SSH-Tunneling-Port-Forwarding/)的示例说明：

这是通用的 SSH 命令语法：

```
ssh -f -L bind-ip-address:bind-port:remote-ip-address:remote-port \
username@remote-server [command] >> /path/to/logfile 
```

以下是仅用 2 行 PHP 代码安全地建立远程数据库连接的方法：

```
shell_exec("ssh -f -L 127.0.0.1:3307:127.0.0.1:3306 user@remote.rjmetrics.com sleep 60 >> logfile");  
$db = mysqli_connect("127.0.0.1", "sqluser", "sqlpassword", "rjmadmin", 3307); 
```

我们使用该`shell_exec()`函数创建具有 60 秒打开窗口的隧道，然后使用该`mysqli_connect()`函数使用转发端口打开数据库连接。请注意，我们必须在此处使用“mysqli”库，因为`mysql_connect()`不允许我们指定端口并且`mysql_*`不推荐使用函数。

`sleep 60`: 说到隧道连接，我们基本上有两种选择：让连接一直打开，或者根据需要打开并关闭它。我们更喜欢后者，因此我们在建立隧道时不指定`-N`选项，这将使其保持打开状态，直到手动终止进程（不利于自动化）。由于`-N`未指定，我们的隧道将在其 SSH 会话未用于任何操作时自行关闭。这是理想的行为，除了在我们创建隧道和通过隧道启动并运行 MySQL 连接之间的几秒钟。在此期间为我们争取一些时间，我们发出无害的`sleep 60`创建隧道时的命令，这基本上为我们赢得了 60 秒的时间，以便在隧道自行关闭之前让其他东西通过隧道。只要在那个时间范围内建立了 MySQL 连接，我们就都准备好了。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-01-23T11:22:16.947

我通过根凭据和公钥对执行 SSH 来尝试它。它允许我通过命令行而不是通过 PHP 代码进行连接。

我还尝试通过创建一个隧道（通过使用 SSH2 函数），并从 PHP 代码（，等）运行 shell`system`命令`exec`；没有任何效果。

最后我尝试了 SSH2 函数来执行 shell 命令，它终于工作了:)

这是我的代码，如果对您有帮助：

```
$connection = ssh2_connect($remotehost, '22');
if (ssh2_auth_password($connection, $user,$pass)) {
    echo "Authentication Successful!\n";
} else {
    die('Authentication Failed...');
}

$stream=ssh2_exec($connection,'echo "select * from zingaya.users where id=\"1606\";"  | mysql');
stream_set_blocking($stream, true);
while($line = fgets($stream)) {
    flush();
    echo $line."\n";
} 
```

如果想专门使用 PHP 函数，试试这个。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-22T06:07:03.263

这*是*可能的，但为什么呢？它比它需要的更复杂，而且容易出错。

不能在本地运行数据库吗？如果不是，你能不使用 SQLite、XML 文件或其他不需要单独的服务器守护程序的东西吗？

您*真的*不想在 PHP 脚本中初始化隧道。初始化 SSH 隧道需要很长时间（很容易是一两秒），这意味着每个连接到数据库的页面在加载时都会有 2 秒的延迟。

如果您*必须*这样做（我强烈建议不要这样做），最好的方法是拥有一个在后台维护连接的脚本..

设置[SSH 密钥对](https://stackoverflow.com/questions/7260/how-do-i-setup-public-key-authentication)。然后使用[autossh](http://www.harding.motd.ca/autossh/)或执行所需 SSH 命令的简单脚本，等到进程终止并重新启动它。它可能更智能，并尝试每 10-20 秒运行一次命令，如果失败则重新连接。

使用 SSH 密钥对，您不必在脚本中硬编码远程用户密码。我建议限制远程用户可以做什么（通过使用专用隧道用户，并给它一个受限的外壳，请参阅[这个](https://stackoverflow.com/questions/8021/allow-user-to-set-up-an-ssh-tunnel-but-nothing-else)问题）

简而言之，我强烈建议先尝试 SQLite，然后看看使用 XML 文件存储数据的可行性，然后尝试让你的 web 主机获取本地 MySQL 服务器，*然后*查看 SSH 隧道选项。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-21T18:53:45.930

埃里克，

我认为你在这方面不走运。您可以在 PHP 代码中使用 ssh 扩展，或者如果您可以访问服务器，则可以尝试在命令行上创建 ssh 隧道。

不过，您可能需要特殊权限才能执行此操作。您似乎也没有对此主机帐户的 ssh 访问权限。

——若昂

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-22T04:43:31.433

我认为您最好的选择是寻找不同的托管服务提供商；我建议使用 VPS 解决方案（虚拟专用服务器），它可以让您完全控制您的虚拟主机。这样，如果您不喜欢默认配置，您可以自己升级它。

# svn - 基于 Web 的 Subversion 浏览器

> ID：309618
> 
> 赞同：2
> 
> 时间：2008-11-21T17:54:15.440
> 
> 标签：svn

你最喜欢哪个基于 Web 的浏览**Subversion**存储库的界面？我们已经尝试过**Viewvc**，但安装对我们来说似乎太复杂了。

这不是民意调查。我真的很想让办公室里的人能够使用他们的网络浏览器访问存储库中的数据，并查看谁修改了每个文件以及何时修改。

**Subversion**提供网页浏览，但很差，[Viewvc](http://upload.wikimedia.org/wikipedia/en/6/63/ViewCVS.png)看起来不错但安装太难。

我不是在谈论**Subversion**客户端，而只是一个显示提交历史的网络，例如在[bitbucket](http://media.bitbucket.org/img/promo/ss1.png)。此外，每个修订版的 ZIP 文件的直接链接也很棒。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-14T17:37:43.830

我喜欢 Atlassian 的 Fisheye（née Cenqua）。它可能有太多你喜欢的功能（搜索、审计和代码审查支持现在都是软件包的一部分），但它具有浏览 SVN（或实际上任何 VC 系统）的最佳界面，我还没有遇到过。不利的一面是，它是商业的（如果你是商业的，那就是。他们为 OSS 项目提供免费实例）并且价格不菲。

您可以在[http://fisheye3.cenqua.com](http://fisheye3.cenqua.com)查看他们的演示实例，

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2015-02-11T13:58:16.220

仔细查看[VisualSVN Server 3.2 和更新版本中基于 Web 的存储库客户端](http://demo-server.visualsvn.com/!/#)。

*   它开箱即用，不需要任何手动配置步骤，
*   功能修订历史浏览器，
*   渲染*降价文档*，
*   更改文件的内联差异，
*   语法高亮。

* * *

## 回答 #3

> 赞同：-2
> 
> 时间：2008-11-22T09:31:37.937

如果您正在寻找简单性，您只需将浏览器指向存储库 URL 即可浏览存储库。

# java - Java中哪些情况需要同步方法访问？

> ID：309631
> 
> 赞同：19
> 
> 时间：2008-11-21T17:59:09.720
> 
> 标签：java, concurrency, synchronization, methods, non-static

在什么情况下需要同步对实例成员的访问？我知道对类的静态成员的访问总是需要同步的——因为它们在类的所有对象实例之间共享。

我的问题是，如果我不同步实例成员，我什么时候会出错？

例如，如果我的班级是

```
public class MyClass {
    private int instanceVar = 0;

    public setInstanceVar()
    {
        instanceVar++;
    }

    public getInstanceVar()
    {
        return instanceVar;
    }
} 
```

在什么情况下（使用类`MyClass`）我*需要*方法： `public synchronized setInstanceVar()`和 `public synchronized getInstanceVar()`？

提前感谢您的回答。

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2008-11-21T18:18:50.150

`synchronized`修饰符确实是一个*坏*主意，应该不惜一切代价避免。我认为 Sun 试图让锁定更容易实现是值得称道的，但这`synchronized`只会带来更多的麻烦，而不是值得。

问题是一个`synchronized`方法实际上只是获取锁`this`并在方法执行期间持有它的语法糖。因此，`public synchronized void setInstanceVar()`将相当于这样的事情：

```
public void setInstanceVar() {
    synchronized(this) {
        instanceVar++;
    }
} 
```

这很糟糕，原因有两个：

*   同一类中的所有`synchronized`方法都使用完全相同的锁，这会降低吞吐量
*   任何人都可以使用锁，包括其他班级的成员。

没有什么可以阻止我在另一个班级做这样的事情：

```
MyClass c = new MyClass();
synchronized(c) {
    ...
} 
```

在该`synchronized`块中，我持有所有`synchronized`方法都需要的锁`MyClass`。这进一步降低了吞吐量并*显着*增加了死锁的机会。

更好的方法是拥有一个专用`lock`对象并直接使用该`synchronized(...)`块：

```
public class MyClass {
    private int instanceVar;
    private final Object lock = new Object();     // must be final!

    public void setInstanceVar() {
        synchronized(lock) {
            instanceVar++;
        }
    }
} 
```

或者，您可以使用`java.util.concurrent.Lock`接口和`java.util.concurrent.locks.ReentrantLock`实现来获得基本相同的结果（实际上，在 Java 6 上也是如此）。

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2008-11-21T18:01:27.690

这取决于您是否希望您的类是线程安全的。大多数类不应该是线程安全的（为简单起见），在这种情况下您不需要同步。如果您需要它是线程安全的，您应该同步访问*或*使变量可变。（它避免了其他线程获取“陈旧”数据。）

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-21T18:08:27.940

如果你想让这个类线程安全，我会声明`instanceVar`以`volatile`确保你总是从内存中获得最新的值，而且我也会这样做，`setInstanceVar()` `synchronized`因为在 JVM 中，增量不是原子操作。

```
private volatile int instanceVar =0;

public synchronized setInstanceVar() { instanceVar++;

} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-21T18:15:10.687

. 粗略地说，答案是“视情况而定”。在此处同步您的 setter 和 getter 仅具有保证多个线程无法读取彼此之间的变量增量操作的预期目的：

```
 synchronized increment()
 { 
       i++
 }

 synchronized get()
 {
   return i;
  } 
```

但这甚至在这里都行不通，因为要确保您的调用者线程获得与它增加的相同的值，您必须保证您是原子地增加然后检索，而您在这里没有这样做 - 即您必须做类似的事情

```
 synchronized int {
    increment
    return get()
  } 
```

基本上，同步对于定义需要保证运行线程安全的操作很有用（换句话说，您不能创建一个单独的线程破坏您的操作并使您的类行为不合逻辑或破坏您期望的数据状态的情况成为）。这实际上是一个比这里可以解决的更大的话题。

这本书[Java Concurrency in Practice](https://rads.stackoverflow.com/amzn/click/com/0321349601)非常好，而且肯定比我可靠得多。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-21T18:46:26.240

简单地说，当您有多个线程访问同一实例的同一方法时，您使用同步，这将改变对象/或应用程序的状态。

它是一种防止线程之间竞争条件的简单方法，实际上你应该只在计划让并发线程访问同一个实例（例如全局对象）时使用它。

现在，当您使用并发线程读取对象实例的状态时，您可能需要查看 java.util.concurrent.locks.ReentrantReadWriteLock ——理论上它允许同时读取多个线程，但仅允许一个线程写入。因此，在每个人似乎都在给出的 getter 和 setting 方法示例中，您可以执行以下操作：

```
public class MyClass{
    private ReentrantReadWriteLock rwl = new ReentrantReadWriteLock();
    private int myValue = 0;

    public void setValue(){
        rwl.writeLock().lock();
        myValue++;
       rwl.writeLock().unlock();
    }

    public int getValue(){
       rwl.readLock.lock();
       int result = myValue;
       rwl.readLock.unlock();
       return result;
    }
} 
```

* * *

## 回答 #6

> 赞同：-3
> 
> 时间：2008-11-21T18:04:32.363

在 Java 中，对 int 的操作是原子的，所以不，在这种情况下，如果您所做的只是一次 1 次写入和 1 次读取，则不需要同步。

如果这些是 long 或 double，您确实需要同步，因为可能会更新 long/double 的一部分，然后读取另一个线程，最后更新 long/double 的另一部分。

# .net - 是否可以创建一个显示 html 内容的消息框？

> ID：309633
> 
> 赞同：0
> 
> 时间：2008-11-21T17:59:45.883
> 
> 标签：.net, winforms

我想显示看起来不错的消息框，可以使用粗体/斜体文本和不同颜色的文本。标准 MessageBox.Show 不提供此功能。

我一直在尝试使用 WebBrowser 控件创建一个消息框，以使用 HTML 语法显示格式良好的文本。但我没有成功。

你知道这是否可能，或者你知道用格式化文本显示消息框的任何其他方式吗？我希望消息框根据其内容动态调整自身大小。

（对于 Windows 窗体）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-21T18:05:21.753

您可以创建自己的 Form 类来承载 WebBrowser 控件（或 RTF 控件）以显示格式化的内容。只需给它一个类似于 MessageBox 的接口 (API)，这样您就可以以几乎相同的方式使用它（例如，检查用户的 Yes/No 或 Ok/Cancel/etc 响应）。

对于大小，您可能需要检查正在显示的内容并使用一些 System.Drawing 功能来获取它的字体/内容的大小。然后相应地调整窗口大小和/或显示和隐藏滚动条，以便仅在绝对必要时才显示它们。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-12T21:03:17.690

我刚刚创建并发布了一个产品 HTML MessageBox，它正好解决了 Mikael 的问题。它是标准 Windows API MessageBox 调用的直接替代品，允许您使用粗体、下划线、斜体和字体。它的行为类似于标准的 MessageBox，自动调整消息大小，自动换行等。另外，它是一个小型的手动编码控件，不使用重量级的 IE 窗口来显示 HTML。

产品中包含用于使用标准 Windows API 调用约定、通过 COM 或从 .NET 类调用它的接口。（还有 PowerBuilder，因为我最初创建它是为了在我自己的 PowerBuilder 应用程序中工作！）

它位于 www.HTML-MessageBox.com。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-08-22T21:36:25.397

我在之前的回复中提到的 HTML MessageBox 现在是免费软件，可从 www.software4nonprofits.com/HtmlMessageBox 获得。（旧网址不久前消失了 - 抱歉！）

# c# - 防止 Pocket PC 设备在断电时关闭应用程序

> ID：309638
> 
> 赞同：1
> 
> 时间：2008-11-21T18:02:56.827
> 
> 标签：c#, pocketpc

当按下电源按钮时，如何防止袖珍 PC 设备从我的应用程序中关闭？我正在使用 C#。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-24T07:47:46.787

您可以使用 Microsoft.WindowsCE.Form.MessageWindows 类来拦截电源按钮事件。该解决方案不可移植，因为不同机器中的硬件密钥会有所不同。

但是，我建议您不要完全禁用关机。[在这里](https://stackoverflow.com/questions/281139/how-do-i-keep-a-windows-mobile-professional-device-in-the-unattended-power-state#281345)查看我在另一个问题中的回答。您还可以使用[openetcf](http://www.opennetcf.com/)轻松创建断电事件处理程序并注册唤醒事件。您应该根据您要实现的目标来实现应用程序逻辑，例如每隔一分钟唤醒一次以运行一个进程。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-22T23:17:28.033

您可以尝试更改设备“BLK1：”的电源要求，即黑光设备。请注意，所有设备和操作系统版本或供应商特定扩展的行为可能不同。

为此，您可以编写如下内容：

```
 [DllImport("coredll")]
    private extern static IntPtr SetPowerRequirement(string pvDevice, int deviceState, 
                int deviceFlags, IntPtr pvSystemState, int stateFlags);

    [DllImport("coredll")]
    private extern static int ReleasePowerRequirement(IntPtr handle); 
```

并这样称呼它：

```
 IntPtr handle = SetPowerRequirement("BLK1:", 0 /* D0, Full On */, 1, IntPtr.Zero, 0);
    // Do something that requires the device to stay on ...
    ReleasePowerRequirement(handle); 
```

但这通常不是一个好的做法，让设备长时间打开背光可能会大大降低其自主性。

# c# - .net (C#) 中的 Xml 序列化和架构

> ID：309639
> 
> 赞同：1
> 
> 时间：2008-11-21T18:03:02.070
> 
> 标签：c#, .net, xml, serialization

以下问题是关于用于数据交换的 .net 类型库的 XML 序列化/反序列化和模式验证。

* * *

第一个问题，如果我有一个自定义 xml 命名空间说“ [http://mydomain/mynamespace](http://mydomain/mynamespace) ”，我是否必须添加一个

```
[XmlRoot(Namespace = "http://mydomain/mynamespace")] 
```

到我图书馆里的每一堂课。或者有没有办法将此命名空间定义为整个程序集的默认命名空间？

* * *

第二个问题，总是添加命名空间背后是否有原因

```
xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" 
```

即使没有对任何命名空间的实际引用？我只是觉得他们给生成的 xml 添加了噪音。有没有办法删除它们，只在生成的 xml 中有自定义命名空间？

* * *

第三个问题，是否有工具支持模式定义的生成（例如，对于程序集的所有公共 [Serializable] 类）以及针对可用的特定模式验证 xml？

如果有，您会推荐 W3C 或 RELAX NG 的 XML Schema 吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-21T20:22:51.257

Just to add - the "xsi" etc is there to support things like xsi:nil on values later on - a well-known pattern for nullable values. It has to write the stream "forwards only", and it doesn't know (when it writes the first bit) whether it will need nil or not, so it assumes that writing it unnecessarily once is better than having to use the full namespace potentially lots of times.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-21T18:29:35.587

1) XmlRoot 只能在类/结构/接口级别（或返回值）设置。所以你不能在装配级别上使用它。您正在寻找的是[XmlnsDefinitionAttribute](http://msdn.microsoft.com/en-us/library/system.windows.markup.xmlnsdefinitionattribute.aspx)，但我相信它只被 XamlWriter 使用。

2）如果您担心混乱，您应该避免使用 xml。格式良好的 xml 充满了混乱。我相信有办法与序列化程序生成的 xml 交互，但不能直接与 XmlSerializer 交互。您可以更好地控制使用[XmlWriter](http://msdn.microsoft.com/en-us/library/10y9yyta.aspx)类生成的 XML。 [查看此处了解如何使用 XmlWriter 处理命名空间。](http://msdn.microsoft.com/en-us/library/cfche0ka.aspx)

3) [XSD.exe](http://msdn.microsoft.com/en-us/library/x6c1kb0s.aspx)可用于为 POCO 生成模式，我相信（我一直都是手工编写的；我可能很快就会用它来写很多东西，但是！）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-21T20:50:43.480

Tools, - xsd.exe, with a command line like

```
xsd /c /n:myNamespace.Schema.v2_0  myschema_v2_0.xsd 
```

I put the schema in a separate project.

[liqudXML](http://www.liquid-technologies.com/Product_XmlDataBinding.aspx) which is useful if there are several schemas, or you want full support of the schema features (DateTimes with offsets, positive/Negative decimals,), and cross platform generation.

# iphone - Cocoa Touch 中代表和控制器的职责？

> ID：309651
> 
> 赞同：14
> 
> 时间：2008-11-21T18:07:16.383
> 
> 标签：iphone, cocoa-touch

我是 iPhone 开发的新手。几乎每个示例项目（以及默认项目模板）都有一个或多个委托和控制器。有人可以详细说明代表的职责与控制器的职责吗？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-21T18:59:53.750

我认为区分两者的最简单方法是：

*   委托是一种协议（接口），它定义了一个对象为了从其他对象接收特定消息而实现的方法。委托对象最常用于接收异步回调，例如用户输入、I/O。
*   控制器是一个通常包含 UI 元素（视图、控件等）和数据的对象，它既可以接收消息也可以向其中的各种对象发送消息。在许多情况下，控制器**是**一个委托，可以实现多个委托协议来接收来自多个对象的事件。

请记住，许多 UI 元素和控件允许您通过将事件链接到 Interface Builder 中的 IBAction 方法将事件传递回控制器。这非常方便，因为它不需要额外的代码来实现委托。但是，其他一些 API（例如 ABPeoplePickerNavigationController 或 NSURLConnection）在 Interface Builder 中没有可视化，因此必须使用委托来处理它们的事件。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-21T21:27:01.330

委托是一些对象，它实现了一组方法，您的应用程序或您链接的框架依赖于这些方法的运行。它是一种实现基于委托的设计模式的方法，其中执行操作的责任从某个根源转移到感兴趣的第三方。例如，具有为第三方提供在应用程序生命周期中的特定时间执行操作的能力的`UIApplication`委托*方法。*它可以被视为时间线中的一个里程碑，您可以为故事做出贡献。

控制者是完全不同的动物，负责控制。ViewController 负责管理视图——在需要时将它们从磁盘加载到内存中，并在不需要时卸载它们。它们将某些底层模型对象的内容转换为视图对象可用的形式，从磁盘或互联网将内容加载到内存模型中，并在您保存和/或退出时将内容转储回磁盘。

# web-services - 用于从桌面编辑现有列表的 Sharepoint Web 服务

> ID：309659
> 
> 赞同：2
> 
> 时间：2008-11-21T18:11:41.833
> 
> 标签：web-services, sharepoint, moss

也许我没有正确地询问或搜索：

我想要一个桌面脚本（当前使用 python）来更新共享点站点上的列表。

当前脚本读取各种文件共享、ftp 站点和 ArcGIS 数据库，以确定哪些元数据文件已更新和发布。然后该脚本将所有这些结果写入 Excel 电子表格。

我们想做同样的事情，但将数据保存在共享点列表而不是电子表格中。我们不需要上传任何文件（这是我在搜索中不断遇到的），只需更新或添加到列表中。

我们可能不太关心我们使用什么语言或工具，我们只是无法访问 Share Point 服务器上的任何自定义编码。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-21T18:38:31.733

您应该能够使用 Sharepoint 服务器上的列表 web 服务，

网址通常是：

```
http://host/sitename/_vti_bin/lists.asmx
```

您正在查看 UpdateListItems 网络服务调用。我不知道 python，但我每天都使用 C# 并使用 sharepoint，您可以在 Windows 应用程序上的[MSDN](http://msdn.microsoft.com/hi-in/library/ms440289(en-us).aspx)上找到一个工作示例来调用 Web 服务。

# apache-flex - 当我将鼠标悬停在 Flex 中的图表线上时，如何显示信息？

> ID：309662
> 
> 赞同：2
> 
> 时间：2008-11-21T18:12:57.913
> 
> 标签：apache-flex, charts, mouseover

我正在构建一个简单的 Flex 应用程序，我想在其中显示一个折线图，然后当用户将鼠标悬停在一条线上时，在一个小弹出框中显示一些信息。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-22T15:23:38.257

您可以将 LineChart 的 showDataTips 属性设置为 true。该属性在 LineChart 扩展的 ChartBase 基类中定义。有关 showDataTips 的更多信息在这里：

[http://livedocs.adobe.com/flex/3/langref/mx/charts/chartClasses/ChartBase.html#showDataTips](http://livedocs.adobe.com/flex/3/langref/mx/charts/chartClasses/ChartBase.html#showDataTips)

您可以通过指定自定义 dataTipFunction 来自定义数据提示标注中显示的内容。

当您将鼠标悬停在构成该线的点上时，使用数据提示将为您提供标注。如果您想提供有关线条的一般信息，您应该将图表与图例结合起来，以描述线条所代表的内容。创建图例就这么简单（其中 lineChart 是 LineChart 的 id 值）：

<mx:图例 dataProvider="{lineChart}" />

# c# - 以编程方式为 LINQ 生成类型化数据集 - 缺少“元数据文件”？

> ID：309665
> 
> 赞同：3
> 
> 时间：2008-11-21T18:14:16.167
> 
> 标签：c#, .net, linq

标题说明了我正在尝试做的事情。如果我不指定`LinqOverTypedDatasets`选项，我可以成功生成程序集，但我希望我的类型化 DataSet 支持使用 LINQ 的查询。

我的代码输出错误：

`error CS0006: Metadata file 'System.Data.DataSetExtensions.dll' could not be found`

编码：

```
//System.Data.DataSet myDataSet = << assume myDataSet is valid DataSet object >>;

Dictionary<string, string> options = new Dictionary<string, string>();
options.Add("CompilerVersion", "v3.5");

using (CSharpCodeProvider cscp = new CSharpCodeProvider(options))
{
    CodeNamespace ns = new CodeNamespace("DBSPPS");
    CodeCompileUnit ccu = new CodeCompileUnit();

    using (StringWriter schemaWriter = new StringWriter())
    {
        myDataSet.WriteXmlSchema(schemaWriter);
        TypedDataSetGenerator.Generate(schemaWriter.ToString(),
            ccu,
            ns,
            cscp,
            TypedDataSetGenerator.GenerateOption.LinqOverTypedDatasets
            );
    }

    StringWriter codeWriter = new StringWriter();

    cscp.GenerateCodeFromNamespace(ns, codeWriter, new CodeGeneratorOptions());

    CompilerParameters parameters = new CompilerParameters();
    parameters.GenerateExecutable = false;
    parameters.OutputAssembly = "DBSPPS.dll";
    parameters.ReferencedAssemblies.Add("System.dll");
    parameters.ReferencedAssemblies.Add("System.Data.dll");
    parameters.ReferencedAssemblies.Add("System.Xml.dll");
    parameters.ReferencedAssemblies.Add("System.Data.DataSetExtensions.dll");

    CompilerResults cr = cscp.CompileAssemblyFromSource(parameters,new string[]{ codeWriter.ToString() });

    foreach (string msg in cr.Output)
        Console.WriteLine(msg);
} 
```

**编辑：想通了，更正的代码出现在上面！:) MSDN 文档在描述将编译器版本设置为 3.5 时是错误的。CompilerVersion 的值应该是“v3.5”而不是文档所说的“3.5”。**

当我没有引用所需的程序集（System.dll 等）时，我得到了相同的编译错误，这是通过将它们添加到对象的`ReferencedAssemblies`集合来修复的`CompilerParameters`。但是，当我收到关于 的错误消息时`System.Data.DataSetExtensions.dll`，将该程序集添加到`ReferencedAssemblies`仍然会导致相同的错误。

我注意到它`System.Data.DataSetExtensions.dll`不在我预期的位置 ( `\WINDOWS\Microsoft.NET\Framework\v3.5`)，而是在`\Program Files\Reference Assemblies\Microsoft\Framework\v3.5`. 我尝试指定完整路径，但也没有用。我假设由于没有为其他引用的程序集指定完整路径，因此它在 GAC 中找到了它们。这不是`System.Data.DataSetExtensions.dll`吗？还是有其他事情发生？

谢谢你的帮助。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-21T20:27:56.147

尝试调整配置，使其了解 3.5 - 请参阅[此处](http://msdn.microsoft.com/en-us/library/bb537926.aspx)的配置示例。

# asp.net - Sharepoint 中的 UI

> ID：309668
> 
> 赞同：2
> 
> 时间：2008-11-21T18:14:56.257
> 
> 标签：asp.net, sharepoint

我们的网络团队被要求在 Sharepoint 中构建一些用户界面。UI 主要是需要写入 SQL Server 数据库的表单。

ASP.NET 是最好的方法吗？如果是这样，将 ASP.NET 应用程序集成到 Sharepoint 的最佳方式是什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-21T18:21:00.690

您有 4 个选项：

```
1\. Build web parts 
2\. build user controls , and use smart part to display them.
3\. use infopath 
4\. host the asp.net in an iframe (page viewer web part). 
```

我会构建 Web 部件，但用户控件和智能部件可能更快，最快的仍然是 infopath，但 infopath 不会使用您指定的页面布局或母版页。

如果 Web 应用程序已经开发，那么您正在查看选项 4，如果尚未开发，那么我建议您使用 1 或 2，这使您可以灵活地重用站点中其他地方的控件以及使用共享点元数据。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-25T12:34:05.087

另一种选择：创建您自己的 aspx 页面，并参考默认的 SharePoint 母版页。使用功能上传它。如果您想控制整个页面，而不仅仅是 Web 部件区域，这比 Web 部件要好。当您想让高级用户轻松配置功能和放置时，Web 部件会更好。

应用程序页面适用于系统和管理页面，因为一旦复制到布局文件夹，它们就可以在您的所有网站上使用。它们还有一个很好的权限模型，通过从 LayoutsPageBase 类继承，因此您可以轻松地限制对某些用户的访问。但我不会将它用于普通用户页面，即。作为应用程序本身的一部分的功能。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-22T04:16:45.963

您还可以构建 SharePoint“应用程序页面”来执行此操作。这是将现有页面从 ASP.NET 世界迁移到 SharePoint 应用程序的好方法。

IMO，所有这些合理建议中的最佳决定将取决于您计划实施的特定功能。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-21T19:21:07.030

我会结合 Mauro 的答案的 1 和 2。在您自己的 Web 部件中封装您的用户控件。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-21T19:49:41.840

或者您可以使用 Sharepoint 中的数据视图连接到后端

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-21T20:26:52.793

Mauro 的选项 2 是最快和最灵活的方式。如果您使用智能部件，您只需专注于开发常规的 ASP.NET 用户控件。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-22T04:02:07.600

如果您有 MOSS Enterprise，则可能需要查看 BDC。您还可以查看一些第 3 部分 Web 部件，它们将为您完成一些工作。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-25T12:54:48.243

在 SharePoint 中构建 UI 的最简单方法是创建一个 UserControl，然后创建您自己的 WebPart，并在其中使用 LoadControl 加载您的 UserControl...

然后，要拥有一个真正响应迅速的应用程序（无耻插件 - 我是 Ra-Ajax 的开发人员），您还可以使用[Ra-Ajax 之](http://ra-ajax.org)类的东西来获得应该与 SharePoint 无缝协作的 Ajax 功能......

完整的解决方案看起来像这样；

```
public class MyWebPart : WebPart
{
   protected override OnInit(EventArgs e)
   {
      EnsureChildControls();
      base.OnInit(e);
   }

   override void CreateChildControls()
   {
      LoadControl("SomeUserControlAtSomePath.ascx");
      base.CreateChildControls();
   }
} 
```

# xaml - Silverlight 2 用户控件 - 元素上的未知属性名称

> ID：309671
> 
> 赞同：3
> 
> 时间：2008-11-21T18:15:41.763
> 
> 标签：xaml, silverlight-2.0

更新：

截图[http://farm4.static.flickr.com/3277/3048788466_661e8e5e78_b.jpg](http://farm4.static.flickr.com/3277/3048788466_661e8e5e78_b.jpg)

重现：

1.  从 Silveright.net 获取此示例项目 - [http://download.microsoft.com/download/5/9/2/5922d533-7ed5-4065-a138-ce3d9ca266e5/4-UserControls_Source_CS.zip](http://download.microsoft.com/download/5/9/2/5922d533-7ed5-4065-a138-ce3d9ca266e5/4-UserControls_Source_CS.zip)

2.  打开 UserControlDemo 解决方案。然后在 Page.xaml 的第 9 行，您将看到错误。

    [http://download.microsoft.com/download/5/9/2/5922d533-7ed5-4065-a138-ce3d9ca266e5/4-UserControls_Source_CS.zip](http://download.microsoft.com/download/5/9/2/5922d533-7ed5-4065-a138-ce3d9ca266e5/4-UserControls_Source_CS.zip)

我正在使用[它](http://silverlight.net/learn/tutorials/UserControls.aspx)作为我的指南在 Silverlight 2 中创建一个用户控件。

问题是当我在 Page.xaml 中使用我的用户控件时，XAML 画布显示此错误：“元素上的未知属性名称 ...。”

由于此错误，我无法再预览我的 XAML 画布。奇怪的是，该项目仍然可以精美地构建和呈现我的用户控件。

在调查了这个问题后，我发现问题的原因是我的用户控件使用的是一个静态资源样式。当我删除此样式属性时，我的 Page.xaml XAML 文件中的错误消失了。

此错误已在[其他](https://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=376059) [在线](https://silverlight.net/forums/t/30696.aspx) [线程](http://silverlight.net/forums/p/41995/117724.aspx)中讨论过，但不幸的是没有解决。

我正在使用 Visual Studio 2008 和 Silverlight 2 的最新版本和服务包。

我正在做的事情有问题还是这是 VS/Silverlight 错误？

提前致谢！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-25T05:11:10.610

根据我的经验，Visual Studio XAML 设计器，尤其是 Silverlight，几乎可以解决任何问题。我无法打开一个没有各种神秘错误的 XAML 文件，当它在设计器中呈现时，它通常不是很有用。

# c++ - 我可以在 uclibc linux 上使用 boost 吗？

> ID：309672
> 
> 赞同：8
> 
> 时间：2008-11-21T18:16:08.283
> 
> 标签：c++, linux, boost, uclinux, uclibc

有没有人有在基于 uclibc 的系统上运行使用 boost 库的 C++ 应用程序的经验？甚至可能吗？你会使用哪个 C++ 标准库？uclibc++ 可以与 boost 一起使用吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-21T23:21:27.277

我们在[Arcom Vulcan](http://www.arcom.com/pc104-ixp425-vulcan.htm)上使用了许多 Boost 库（线程、文件系统、信号、函数、绑定、任何、asio、smart_ptr、元组），这对于嵌入式设备（64M RAM，533MHz XScale）来说非常强大。一切都很漂亮。

GCC 3.4，但我们没有使用 uclib++（Arcom 提供了一个包含 libstd++ 的工具链）。

假设编译器支持良好，许多嵌入式设备将愉快地运行许多 Boost 库。请注意使用。Boost 库提高了抽象级别，并且可以轻松使用比您想象的更多的资源。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-25T17:18:04.747

我们在运行 uClinux 的 ARMv4 平台上将 Boost 与 GCC 2.95.3、libstdc++ 和 STLport 一起使用。Boost 的某些部分与 GCC 2.x 不兼容，但在我们的特定情况下运行良好的部分。我们使用最多的库是*date_time*、*bind*、*function*、*tuple*和*thread*。

我们遇到的一些库是*lambda*、*shared_pointer*和*format*。这些问题很可能是由我们的 GCC 版本引起的，因为当您包含过多的模板结构或深度级别的模板结构时，它会出现问题。

如果可能的话，我建议您使用您的特定工具链运行 boost 测试套件以确保兼容性。至少你可以编译一个本地工具链，以确保你的库版本是兼容的。

我们没有使用 uClibc++，因为这不是我们的工具链提供商推荐的，所以我无法评论那个特定的组合。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-20T19:28:31.497

我用谷歌搜索了“uclibc stlport”。似乎至少有几个版本的 uclibc 可以编译 stlport（请参阅[this](http://lists.uclibc.org/pipermail/uclibc/2003-January/005481.html)）。鉴于此，我想说 Boost 只需几个编译步骤即可。我读过 David Abrahams（他是 boost 社区的活跃成员）的消息，其中说 Boost 不直接依赖于使用的 libc。但是某些库可能仍然会导致问题，例如 Boost.Python，因为它依赖于其他可能难以用 uclibc 编译的东西（在我的示例中是 Python）。

希望这可以帮助

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-21T19:07:17.867

我没有尝试过，但我不知道任何关于 uclibc 会阻止 Boost 工作的信息。

试试看，看看会发生什么，我会说。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-01-25T17:05:57.877

是的，您可以将 boost 与 uclibc 一起使用。
我在 ARM9260 上使用 boost 1.45 和 uclibc 进行了尝试

1.  使用新鲜的 OpenEmbedded
2.  将其配置为使用 Angstrom
3.  配置 Angstrom 以使用 uclibc
4.  提升 - bitbake 提升

# c# - 需要一个好的 ASP.NET 菜单

> ID：309674
> 
> 赞同：2
> 
> 时间：2008-11-21T18:17:24.410
> 
> 标签：c#, asp.net, menu

我正在寻找一个在 ASP.NET 中使用的好菜单。我目前正在使用 asp 菜单。我需要它在 IE 6、7、8、Firefox 和 Safari 中工作。我还需要它不要给页面客户端增加很多开销。我需要能够从数据库中加载它。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-21T18:26:25.797

编写您自己的服务器控件来实现 asp.net 菜单控件，但更进一步并实现 CSS 友好的适配器，这将为您提供符合标准的代码，而不是 asp:menu 创建的通常的垃圾 html 表。

您可以在此处阅读更多信息：[http ://www.asp.net/cssadapters/Whitepaper.aspx](http://www.asp.net/cssadapters/Whitepaper.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-21T18:33:42.787

您可以将此代码用作灵感：[http ://trac2.assembla.com/GiusCms/browser/trunk/Controls/Controls/Menu.cs](http://trac2.assembla.com/GiusCms/browser/trunk/Controls/Controls/Menu.cs)

此控件能够使用任何 SiteMapDataSource。或者您可以根据需要简单地自定义它。使用 CSS 隐藏和显示内部子菜单。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-18T00:57:36.273

我来这篇文章是因为我在使用 IE8 时遇到了空白问题。如果其他人对此进行了快速修复，请尝试手动设置菜单项的 DynamicMenuStyle 属性的 z-index 属性，这就是我为它的 css 所做的。

```
 .HorizontalMenu_DynamicMenuStyle
{
    font-family: Verdana;
    font-size: medium;
    background-color: #FCFCFC;
    border: solid 1px green;
    z-index: 100;
} 
```

看看这个

[http://blogs.msdn.com/giorgio/archive/2009/02/01/asp-net-menu-and-ie8-rendering-white-issue.aspx](http://blogs.msdn.com/giorgio/archive/2009/02/01/asp-net-menu-and-ie8-rendering-white-issue.aspx)

[http://weblogs.asp.net/bleroy/archive/2009/03/23/asp-menu-fix-for-ie8-problem-available.aspx](http://weblogs.asp.net/bleroy/archive/2009/03/23/asp-menu-fix-for-ie8-problem-available.aspx)

# java - 如何让摇摆 JButton 在按住时重复其动作？

> ID：309675
> 
> 赞同：5
> 
> 时间：2008-11-21T18:17:57.360
> 
> 标签：java, swing, event-listener

我正在使用 Swing 创建一个触摸屏应用程序，并请求更改其中一个按钮，以便在按住按钮时它的行为类似于键盘。
（首先，我不确定触摸屏是否会允许用户“按住”按钮，但假设他们现在可以）

我打算在被调用时开始循环`mousePressed`，然后在被调用时结束循环`mouseReleased`。这将涉及启动一个线程并必须处理同步以及`invokeLater()`在`EventQueue`.

有没有一种非常简单的方法来做我想做的事？我希望我只是没有看到 API 来做到这一点。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-21T18:24:58.000

[javax.swing.Timer](http://docs.oracle.com/javase/6/docs/api/javax/swing/Timer.html)是你的朋友。这[是一篇](http://docs.oracle.com/javase/tutorial/uiswing/misc/timer.html)包含更多信息的文章。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-21T18:25:48.047

我会这样做：

*   监听 mousePressed 并安排 java.util.Timer 稍后启动。
*   计时器执行该操作并将其自身设置为再次调度。
*   听 mouseReleased 取消 Timer。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-21T18:45:14.963

我选择了 java.swing.Timer，因为它会自动回发到 Swing EventQueue，而这正是我想要的。谢谢您的帮助。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2016-05-11T14:35:17.580

以下是通过继承 JButton 来实现的方法：

```
import java.awt.Font;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.awt.event.MouseEvent;
import java.awt.event.MouseListener;

import javax.swing.Action;
import javax.swing.BorderFactory;
import javax.swing.JButton;
import javax.swing.SwingUtilities;

public class TypomaticButton extends JButton implements MouseListener {
    private boolean autotype = false;
    private static Thread theThread = null;
    private String myName = "unknown";
    private int 
        speed = 150, 
        wait = 300,
        decrement = (wait - speed) / 10; 

    TypomaticButton(Action action){
        super(action);
        myName = action.getValue(Action.NAME).toString();
        addMouseListener(this);
    }

    TypomaticButton(String text){
        super(text);
        setBorder(BorderFactory.createEmptyBorder(6, 6, 6, 6));

        myName = text;
        addMouseListener(this);
    }

    @Override
    public void mouseClicked(MouseEvent arg0) {}

    @Override
    public void mouseEntered(MouseEvent arg0) { }

    @Override
    public void mouseExited(MouseEvent arg0) {  }

    @Override
    public void mousePressed(MouseEvent arg0) {
        autotype = true;
        theThread = new Thread(new Runnable() { // do it on a new thread so we don't block the UI thread
            @Override
            public void run() {
                for (int i = 10000; i > 0 && autotype; i--) { // don't go on for ever
                    try {
                        Thread.sleep(wait);     // wait awhile
                    } catch (InterruptedException e) {
                        break;
                    }
                    if(wait != speed){
                        wait = wait - decrement;        // gradually accelerate to top speed
                        if(wait < speed)
                            wait = speed;
                    }
                    SwingUtilities.invokeLater(new Runnable() { // run this bit on the UI thread
                        public void run() {
                            if(!autotype)   // it may have been stopped meanwhile
                                return;
                            ActionListener[] als = getActionListeners();
                            for(ActionListener al : als){   // distribute to all listeners
                                ActionEvent aevent = new ActionEvent(getClass(), 0, myName);
                                al.actionPerformed(aevent);
                            }
                        }
                    });
                }
                autotype = false;
            }
        });
        theThread.start();
    }

    @Override
    public void mouseReleased(MouseEvent arg0) {
        autotype = false;
        wait = 300;
    }

    void speed(int millisecs){
        speed = millisecs;
        decrement = (wait - speed) / 10; 
    }

    void stop(){
        autotype = false;
        if(theThread != null){
            theThread.interrupt();
        }
    }

} 
```

它也加速了。

希望有帮助。

# javascript - 如何在 JavaScript 中建立对象之间的继承？

> ID：309680
> 
> 赞同：1
> 
> 时间：2008-11-21T18:19:03.020
> 
> 标签：javascript, oop, inheritance

我有以下代码创建两个对象（ProfileManager 和 EmployerManager），其中对象 EmployerManager 应该从对象 ProfileManager 继承。但是，当我发出警报时（pm instanceof ProfileManager）；它返回假。

```
function ProfileFactory(profileType) {
    switch(profileType)
    {
        case 'employer':
            return new EmployerManager();
            break;
    }
}

function ProfileManager() {
    this.headerHTML = null;
    this.contentHTML = null;
    this.importantHTML = null;

    this.controller = null;

    this.actions = new Array();
    this.anchors = new Array();
}

ProfileManager.prototype.loadData = function(action, dao_id, toggleBack) {

    var step = this.actions.indexOf(action);

    var prv_div = $('div_' + step - 1);
    var nxt_div = $('div_' + step);

    new Ajax.Request(this.controller, {
            method: 'get',
            parameters: {action : this.actions[step], dao_id : dao_id},
            onSuccess: function(data) {
                nxt_div.innerHTML = data.responseText;

                if(step != 1 && !prv_div.empty()) {
                    prv_div.SlideUp();
                }

                nxt_div.SlideDown();

                for(i = 1; i <= step; i++)
                {
                    if($('step_anchor_' + i).innerHTML.empty())
                    {
                        $('step_anchor_' + i).innerHTML = this.anchors[i];
                    }
                }
            }
        }
    )   
}

EmployerManager.prototype.superclass = ProfileManager;

function EmployerManager() {
    this.superclass();

    this.controller = 'eprofile.php';

    this.anchors[1] = 'Industries';
    this.anchors[2] = 'Employer Profiles';
    this.anchors[3] = 'Employer Profile';

    this.actions[1] = 'index';
    this.actions[2] = 'employer_list';
    this.actions[3] = 'employer_display';   
}

var pm = new ProfileFactory('employer');
alert(pm instanceof ProfileManager); 
```

顺便说一句，这是我第一次尝试面向对象的 JavaScript，所以如果你觉得有必要评论我的方法的愚蠢性，请随时这样做，但请提供有关如何更好地解决问题的建议。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-21T18:33:54.567

我一直在使用类似于 Dean Edward 的 Base.js 模型的东西。 [http://dean.edwards.name/weblog/2006/03/base/](http://dean.edwards.name/weblog/2006/03/base/)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-21T22:04:23.843

Prototype 通过[Object.extend()](http://www.prototypejs.org/api/object/extend)函数支持（模拟）类继承。

然而，有人可能会说，试图将基于类的继承强加于不支持类的语言是“当你只有一把锤子时，整个世界看起来就像一颗钉子”的一个例子。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-22T13:09:36.077

感谢所有的评论。但是，在对 EmployerManager 的声明进行此更改时找到了问题的解决方案：

```
function EmployerManager() {

    this.controller = 'eprofile.php';
    this.anchors = new Array('Industries', 'Employer Profiles', 'Employer Profile');
    this.actions = new Array('index', 'employer_list', 'employer_display'); 
}

EmployerManager.prototype = new ProfileManager; 
```

显然 JavaScript 支持两种不同类型的继承，基于函数和基于原型。基于函数的版本是我最初发布的，但由于 EmployerManager 看不到作为 ProfileManager 原型一部分的 loadData 方法，因此无法正常工作。

这个新的例子是基于原型的，现在可以工作了。EmployerManager 现在是 ProfileManager 的一个实例。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-21T18:56:32.477

在您的代码中，pm 是 EmployerManager 的一个实例，它具有 ProfileManager 的超类。这对我来说似乎倒退了。ProfileManager 不应该有一个 EmployerManager 的超类吗？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-21T22:37:41.047

我只是想插话，虽然 JavaScript 是一种面向对象的语言，但它没有其他流行的 OO 语言中常见的许多功能。相反，它还具有其他流行的 OO 语言所没有的许多特性。

正如您已经发现的那样，继承是通过原型对象管理的，而不是通过类继承来管理的。但是，使用“instanceof”运算符时不会检查原型对象。这意味着 JavaScript 不支持多态性。至少不是开箱即用。

您可以找到使 JavaScript 符合您习惯的 OOP 模型的库；如果你在枪下，这可能是最好的解决方案。（虽然没有库在使用“instanceof”检查时会使 JavaScript 对象多态；可能需要一个 isInstanceOf 函数。）或者您可以选择另一种符合 OOP 模型的语言，但您可能正在工作在浏览器中，所以这显然不是一个选择。或者你可以回答这个问题，“我如何在没有多态性的情况下解决我的问题？”

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-12T03:28:56.073

您应该注意到（由我）[提出了同样的问题。](https://stackoverflow.com/questions/224345/is-there-a-right-way-to-do-inheritance-in-javascript-if-so-what-is-it)查看该帖子上的答案。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2015-04-09T00:16:09.763

您可以使用**new**或[**Object.create**](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/create)来实现经典继承

```
function A(){
    B.call(this);
}
function B(){
}

//there are 2 ways to make instanceof works
//1\. use Object.create
A.prototype = Object.create(B.prototype);
//2\. use new
//A.prototype = new B();

console.log(new A() instanceof B); //true

//make instanceof works
EmployerManager.prototype = Object.create(ProfileManager.prototype);
//add other prototype memebers
EmployerManager.prototype.superclass = ProfileManager;

console.log(new EmployerManager() instanceof ProfileManager); //true 
```

# javascript - 如何从特定字段集中获取表单字段？

> ID：309682
> 
> 赞同：1
> 
> 时间：2008-11-21T18:20:04.313
> 
> 标签：javascript, forms, dom, xhtml

我正在编写一个按字段集划分的 HTML 表单，我需要从函数中的特定字段集中获取表单字段。
目前是这样的：

```
function conta(Fieldset){  
    var Inputs = Fieldset.getElementsByTagName("input");  
    var Selects = Fieldset.getElementsByTagName("select");  
    /* Doing the stuff I need to do in two iterations, one for each field type */  
} 
```

但是谁知道未来会发生什么，如果表单有一些新的字段类型（单选框、复选框），维护起来可能会变得很糟糕。
我知道`form`元素具有 `elements`返回所有表单字段的属性，我希望我可以使用类似的东西。
（我知道我仍然需要在迭代中的一堆条件中区分字段类型，但我认为它会更快更容易保持。除非它不是而且我不应该这样做）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-08-25T09:29:41.220

没有 jQuery，没问题：

```
function condat(fieldset) {
    var tagNames = ['input', 'select', 'textarea'];  // Insert other tag names here
    var elements = [];

    for (var i in tagNames)
        elements.concat(fieldset.getElementsByTagName(tagNames[i]);

    for (var i in elements) {
        // Do what you want
    }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-21T18:30:23.997

如果您想使用 jQuery（我会），@Ryan 走在正确的轨道上，但我会建议更多类似的东西：

```
$('fieldset#fieldset1 > input[type=text]').each( function() {
      ... do something for text inputs }
 );

$('fieldset#fieldset1 > input[type=radio]').each( function() {
      ... do something for radios }
 );

$('fieldset#fieldset1 > select').each( function() {
      ... do something for selects }
 );

$('fieldset#fieldset1 > textarea').each( function() {
      ... do something for textareas }
 ); 
```

作为对 if-then-else 结构的改进。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-21T18:30:49.750

单选按钮和复选框仍然是输入标签，将在 Inputs 变量中。问题是，您需要为选中状态添加处理程序以查看选择了哪些单选按钮和复选框。

更糟糕的是，您可以拥有多个具有相同名称的单选按钮和复选框……事实上，您必须使用单选按钮，否则它们不会按预期工作。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2017-11-02T07:43:15.910

Filip Dupanović 解决方案与 Cargowire 的第二条评论一起为我工作，但仅进行了少量修改。Cargowire 的第二条评论只生成了一个数组，它只保存了 tagNames 数组的切片字符（我会在评论中写这个，但到目前为止我还没有代表）。

这是有效的：

```
function condat(fieldset) {
    var tagNames = ['input', 'select', 'textarea'];  // Insert other tag names here
    var elements = [];

    for (var i in tagNames) {
        elements = elements.concat([].slice.call(fieldset.getElementsByTagName(tagNames[i])));
    }
    for (var i in elements) {
        // Do what you want.
        // Attributes of the selected tag's can be referenced for example as 
        // elements[i].value = ...;
    }
} 
```

一个有用的应用是定义仅重置字段集而不是整个表单的按钮。只需`elements[i].value = elements[i].defaultValue;`在`//do what you want`部分中使用，即可重置文本输入。当然，将 condat 函数绑定到提供 fieldset dom 元素作为参数的按钮的 onclick 事件上。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-21T18:25:32.990

尚未对此进行测试并且不知道它是如何工作的，但是您可以在此处使用 JQuery 将所有元素选择到 JQuery 对象中

```
//$("input select textarea").each(function() {
$(":input").each(function() { //even better
    // do stuff here
}); 
```

这至少会清理代码，尽管您仍然必须像您提到的那样根据字段类型添加条件语句。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2017-11-02T07:54:06.220

您应该只使用 querySelectorAll：

```
function condat(fieldset) {
   var elements = fieldset.querySelectorAll('input, select, textarea');
   elements.forEach(function(element){
     // Do what you want with every element
   });
} 
```

# c# - ASP.NET 2.0：如何在不创建历史记录点的情况下让页面记住视图状态？

> ID：309683
> 
> 赞同：1
> 
> 时间：2008-11-21T18:20:26.620
> 
> 标签：c#, asp.net-ajax, updatepanel, viewstate

我有一个页面，上面有几个字段和一个运行时生成的图像。此页面的内容位于 UpdatePanel 中。有一个按钮可以将用户带到第二个页面，该页面有一个在单击时调用 javascript:history.go(-1) 的按钮。

问题是，第一页做了一个完整的请求，而不是回发，或者只是使用它在离开它之前所处的状态。也就是说，这些字段都被重置为其默认值，从而使用户感到困惑。无论导航如何，我都希望保留他们的价值观。我不想为每个字段更改创建一个新的历史状态。

有任何想法吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-22T09:24:29.587

唯一的其他选择是使用 JavaScript（有限制）跟踪客户端 cookie 中的字段状态。最好在导航到辅助页面之前执行 AJAX 调用，这将允许服务器保存页面的状态，以便在发生反向导航时可以正确地将该状态呈现给浏览器。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-24T17:01:09.710

我想当我有更多时间来研究 AJAX 想法时，我会尝试它。我可能只会发回视图状态字段：P 感谢您的输入。

# winforms - System.Reflection.PropertyInfo.SetValue() 调用按钮的默认事件处理程序

> ID：309706
> 
> 赞同：0
> 
> 时间：2008-11-21T18:31:58.983
> 
> 标签：winforms, reflection, c#-2.0

所以我不太确定为什么会发生这种情况，但我正在运行一些 DataRows，其中我有我想要设置的控件名称、属性和值。一切正常，除非我设置按钮的 TEXT 属性。由于某种原因，点击事件被称为......

这是我得到的一些代码：

```
string controlName, value, property;
Control currentControl = null;
System.Reflection.PropertyInfo propertyInfo = null;

// run through all rows in the table and set the property
foreach (DataRow r in languageDataset.Tables[_parentForm.Name].Rows)
{
  controlName = r["ControlName"].ToString().ToUpper();
  value = r["Value"].ToString();
  property = r["Property"].ToString();

  // check all controls on the form
  foreach (Control c in formControls)
  {
    // only change it if its the right control
    if (c.Name.ToUpper() == controlName)
    {
      propertyInfo = c.GetType().GetProperty(property);

      if (propertyInfo != null)
        propertyInfo.SetValue(c, value, null);  ******Calls Event Handler?!?!******
      //

      currentControl = c;
      break;
    }
  }
} 
```

那么为什么它会在设置值时调用事件处理程序呢？这就是我设置它的原因：

```
<SnappletChangePassword>  
  <ControlName>buttonAcceptPassword</ControlName>
  <Property>Text</Property>  
  <Value>Accept</Value>
</SnappletChangePassword> 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-21T18:50:53.907

我无法用一个简单的简短但完整的程序来重现它：

```
using System;
using System.Drawing;
using System.Reflection;
using System.Windows.Forms;

class Test
{
    static void Main()
    {
        Button goButton = new Button { 
            Text = "Go!",
            Location = new Point(5, 5)
        };

        Button targetButton = new Button {
            Text = "Target",
            Location = new Point(5, 50)
        };
        goButton.Click += (sender, args) => SetProperty(targetButton, "Text", "Changed");
        targetButton.Click += (sender, args) => MessageBox.Show("Target clicked!");

        Form f = new Form { Width = 200, Height = 120,
                Controls = { goButton, targetButton }
        };
        Application.Run(f);
    }

    private static void SetProperty(object target, string propertyName, object value)
    {
        PropertyInfo property = target.GetType().GetProperty(propertyName);
        property.SetValue(target, value, null);
    }
} 
```

你能想出一个类似完整的程序来*演示*它吗？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-21T20:00:39.837

可悲的是，不，我也无法复制它。我不确定是什么原因造成的，但我所做的只是删除按钮并将其放回原处。

不知道它是什么，但感谢代码。

你不是在.Net2.0中写的吗？

# unit-testing - 如何正确地对我的 DAL 进行单元测试？

> ID：309708
> 
> 赞同：13
> 
> 时间：2008-11-21T18:32:14.040
> 
> 标签：unit-testing, entity-framework, mocking, data-access-layer

我是单元测试的新手。但是如何对使用 Entity Framework 编写的 DAL 进行单元测试，以便确保我的 DAL 代码正常工作但实际上没有触及数据库？有人可以提供尽可能详细的信息吗？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-11-21T19:09:48.113

如果您想测试您的数据访问层是否正常工作，您确实需要在某个时候针对数据库对其进行测试，否则您实际上并没有测试它是否有效。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-06T22:35:45.720

对 DAL 进行单元测试是开发中非常常见的难题。在大多数情况下，我建议你跳过它。

如今，大多数 ORM 都提供某种查询语言，无论是 LINQ 或 HQL，还是其他风格。因为正确的单元测试要求您实际上不访问数据库，所以您必须模拟 ORM，这样做是您能想到的最大痛苦。这不值得，IMO。最终，您只需要测试您是否在代码中编写了正确的查询；您根本没有得到回归值，并且可以通过检查代码更好地服务于您的目的。

然而，我并不是说你不应该测试你对 DAL 的使用。只是不要尝试单元测试。您仍然应该为您的程序/系统提供一套集成和用户验收测试；让那些处理测试您的数据访问。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-21T19:34:50.840

当我对我的 DAL 进行单元测试时，我在单元测试结束时使用事务和回滚，因此数据库是干净的。

# objective-c - Cocoa 的依赖注入框架？

> ID：309711
> 
> 赞同：52
> 
> 时间：2008-11-21T18:32:58.123
> 
> 标签：objective-c, cocoa, dependency-injection

Interface Builder 可用于 Cocoa 应用程序中的基本依赖注入，但是当您不想在 NIB 文件中实例化对象时，是否有人知道用于 Objective-C/Cocoa 的更完整的依赖注入框架？

**编辑**

澄清一下，我承认 IB 可用于基本 DI，但我正在寻找一个功能更完整的框架，包括单独的生产和测试配置，类似于 Groovy 或 Springs。

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2010-12-16T14:36:35.733

AtomicObject 的[反对意见。](https://github.com/atomicobject/objection)它是按照 Guice 的形象塑造的。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2011-06-28T18:14:05.803

我会冒险出去谈谈这个。最佳答案所描述的依赖注入并没有解决那些寻求使用它的人所面临的核心问题。我们想要一种开发方式，其中组件 A 不直接实例化或引用组件 B。组件 A 由协议绑定到组件 B，并且根本不被组件 A 引用。这允许组件 B 在任何时候被替换，而不会永远感人的 A 部分。我投了反对票，但我会研究你的参考资料，因为似乎有一些人同意你的观点。我不是想辩论，只是想学习。我想更多地了解“不，你不需要这样做”的方法。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2009-01-29T02:57:42.537

我想您会发现在诸如 Objective C、Ruby、Lisp 等后期绑定语言中不需要它。就像 Jamis 透露他在尝试构建 needle 时走上一条过于复杂的道路一样，[重新审视了 Ruby-Net::SSH](http://weblog.jamisbuck.org/2007/7/29/net-ssh-revisited)的 DI 框架。

这里有一些链接，有望为您提供一些示例代码，以便在 Objective C 中执行类似的操作。使用类别，您基本上可以在运行时更改任何类的行为。请参阅[Mac 开发人员提示 – Objective-C：类别](http://macdevelopertips.com/objective-c/objective-c-categories.html)和类别[上的 Cocoa API 文档](http://developer.apple.com/mac/library/documentation/Cocoa/Conceptual/ObjectiveC/Articles/ocCategories.html)。本质上，您不需要某个中心位置来请求可配置的“执行 x 的事情”，因为您可以直接实例化 TheThingThatDoesX，如果有其他东西需要更改/挂钩到该行为，它可以使用类别。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2012-12-30T07:14:40.950

**台风**

差不多一年前，我发布了：[https ://github.com/typhoon-framework/Typhoon](https://github.com/typhoon-framework/Typhoon)

**[Typhoon 网站](http://www.typhoonframework.org)列出了主要功能。快速总结：**

*   非侵入性的。不需要宏或 XML。使用**[强大的 Objective-C 运行时方法](https://github.com/typhoon-framework/Typhoon/wiki/Quick-Start)**。

*   使同一基类或协议的多个配置变得容易。

*   没有魔法字符串 - 支持 IDE 重构、代码完成和编译时检查。

*   支持注入视图控制器和故事板集成。

*   支持初始化程序和属性注入，以及生命周期管理。

*   强大的内存管理功能。提供预配置的对象，没有单例的内存开销。

*   对循环依赖的出色支持。

*   倾斜。它的占用空间非常小，因此适用于 CPU 和内存受限的设备。

*   久经考验 - 用于各种 Appstore 特色应用程序

*   一个国际分布的核心团队（我们甚至监控 StackOverflow），因此对您的任何问题的支持都不会太远:)

**API 文档和示例应用程序**

*   API 文档：[http ://www.typhoonframework.org/docs/latest/api/](http://www.typhoonframework.org/docs/latest/api/)
*   我们有一个不错的示例应用程序：[https ://github.com/jasperblues/Typhoon-example](https://github.com/jasperblues/Typhoon-example)

**质量控制：**

我们还保持着强大的质量控制系统。

*   每次提交都会触发一系列[回归测试](http://www.typhoonframework.org/docs/latest/test-results/)
*   我们保持高测试覆盖率。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-11-21T19:30:26.433

您不必在 NIB 文件中实例化对象。如果您将文件的所有者设置为对象的类，然后将视图/窗口/任何内容中的内容链接到该类，则可以通过手动加载 nib 文件在运行时将对象设置为所有者。这样你就可以拥有一个对象的动态实例，它仍然可以正确注入依赖项。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2010-09-06T06:32:19.297

[Objective-IOC 的](http://github.com/mivasi/Objective-IOC)依赖注入实现怎么样

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2011-11-16T11:27:25.237

ObjectivePim 呢？ [目标Pim](https://github.com/vbergae/ObjectivePim)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2010-10-06T12:18:28.293

我写了一个非常简单的 DI 容器，代码在[GitHub 上](http://github.com/zoul/Factory)。它只能做最基本的事情，即。发现一个对象的依赖关系并使用其他给定的对象来满足它们。我发现要在现实世界的应用程序中使用，代码非常简单，而且很有趣。

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2010-02-19T09:00:35.893

有没有看过Mac OS X 10.6的[关联引用功能？](http://developer.apple.com/mac/library/documentation/Cocoa/Conceptual/ObjectiveC/Articles/ocAssociativeReferences.html#//apple_ref/doc/uid/TP30001163-CH24-SW1)

我相信有了这个，就有可能构建或已经拥有类似于 DI 的东西。据我所知，对象中需要的任何引用都必须使用 objc_getAssociatedObject() 手动获取。

曼弗雷德

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2010-12-10T15:58:40.497

Interface Builder 不执行任何依赖注入。它不需要。Interface Builder 序列化对象。当笔尖“唤醒”（又名打开）时，没有“依赖关系”需要解决——只有要设置的属性。非常非常简单。打开 nib 仅依赖于 NSCoding 协议和键值编码。

依赖注入，在最好的情况下几乎是一个临时项目，或者充其量是独立设计的组件之间的通用粘合层，在编写良好的 Objective-C 代码中是没有用的。您正在要求一个您不需要的工具。

在 Objective-C 中，需要匿名服务的软件声明了一个协议。然后服务采用此协议。客户端将服务加载为动态插件。另一方面，如果服务器是在客户端之前编写的，那么只需编写一个新的插件来使现有接口适应协议。与尝试定义中间数据驱动系统以在运行时“发现”（请）接口相比，这需要更少的工作，并且更直接。

DI 的最大秘密在于它是一种用 XML 而不是本地语言编写代码的方式，这对每个人来说不是很明显吗？我真的很想听听一个很好的论点，说明 XML 如何在某种程度上是一种比真正的编程语言更好的编程语言。这没有任何意义。

* * *

## 回答 #11

> 赞同：-2
> 
> 时间：2009-01-27T19:58:30.653

我整天都在使用 Spring，并且检查了 Groovy。我绝不是 XCode/Cocoa 专家，但 IB 只做了一些依赖注入，而 Groovy 甚至没有真正声称这样做。

我认为您不是在寻找 DI，而是在寻找一组编译良好的集成库，这样您就不必输入其他人也输入过的大量代码。我认为 Cocoa 没有类似 Spring 的框架，因为出于某种原因，人们倾向于将“开源”视为“不依赖于平台”，因此 Cocoa 有点被冷落了。

不过，根据您的需要，有一些可用于 Cocoa 的不错的免费开源库，所有这些都列在 CocoaDev 的一个[不错的列表中](http://www.cocoadev.com/index.pl?CocoaOpen)。

我知道这不是春天，但我希望它有所帮助。

* * *

## 回答 #12

> 赞同：-2
> 
> 时间：2009-10-29T15:49:33.967

DI 是需要动态绑定的运行时执行环境的属性。我对 Obj-C 和 Cocoa 很陌生，所以我可能会说话不顺。除非我遗漏了什么，否则我看不出如何实现 DI，除非通过解释 Obj C 而不是编译它，或者通过修改运行时环境。

我怀疑 IB 类似 DI 的行为是因为有一个特定于域的运行时环境与使用它构建的应用程序相关联。

不过我很高兴得到纠正。

类别似乎是 mixin 的实现，允许将方法动态分派给委托。相当酷，类似于Java的接口概念，认为细节不同，从以下，我看不出是否可以在类别中定义常量，尽管成员字段不能。

[Objective-C 类别](http://macdevelopertips.com/objective-c/objective-c-categories.html)

# apache-flex - Flash TextField HTML - 如何防止丢失图像的错误对话框？（错误 #2044：未处理的 IOErrorEvent:.text=错误 #2035：找不到 URL）

> ID：309713
> 
> 赞同：1
> 
> 时间：2008-11-21T18:33:22.007
> 
> 标签：apache-flex, flash, actionscript-3, actionscript, flex3

我正在使用 Flash TextField 控件在 Flash 演示文稿中显示一些 HTML 内容，以便在大型触摸屏信息亭上显示。不幸的是，如果显示的 HTML 内容中的任何图像标签指向不存在的图像，则会显示一个带有错误消息的对话框

```
Error #2044: Unhandled IOErrorEvent:. text=Error #2035: URL Not Found. 
```

我试图避免弹出该对话。通过加载器类加载内容的[解决方案](http://www.kirupa.com/forum/showthread.php?t=287501)`IOErrorEvent.IO_ERROR`是 catch ，但我尝试在 TextField、舞台上、Main 和 loaderInfo 上进行监听，但无济于事。我已经尝试将整个东西包装在一个 try-catch 中，但这也不起作用。

这是我用来寻找解决方案的简化代码：

```
package {
    import flash.display.Sprite;
    import flash.errors.IOError;
    import flash.events.Event;
    import flash.events.IOErrorEvent;
    import flash.text.TextField;
    import flash.text.TextFieldType;

    public class Main extends Sprite {

        public function Main():void {
            if (stage) init();
            else addEventListener(Event.ADDED_TO_STAGE, init);
        }

        private function init(e:Event = null):void {
            removeEventListener(Event.ADDED_TO_STAGE, init);

            var html:TextField = new TextField();
            html.type = TextFieldType.DYNAMIC;
            html.multiline = true;
            html.htmlText = "Bogus image: <img src=\"foo.jpg\" />";         

            addChild(html);
        }
    }
} 
```

**编辑：这是整个工作代码。**

当然，对于动态内容等，您需要一个图像列表和一个生成处理程序的函数等。

```
package {
    import flash.display.Loader;
    import flash.display.Sprite;
    import flash.errors.IOError;
    import flash.events.Event;
    import flash.events.IOErrorEvent;
    import flash.text.TextField;
    import flash.text.TextFieldType;

    public class Main extends Sprite {

        public function Main():void {
                if (stage) init();
                else addEventListener(Event.ADDED_TO_STAGE, init);
        }

        private function init(e:Event = null):void {
                removeEventListener(Event.ADDED_TO_STAGE, init);

                var html:TextField = new TextField();
                html.type = TextFieldType.DYNAMIC;
                html.multiline = true;
                html.htmlText = "Bogus image: <img id=\"image\" src=\"foo.jpg\" />";                 

                var loader:Loader = html.getImageReference("image") as Loader;
                if(loader){         
                    loader.contentLoaderInfo.addEventListener(IOErrorEvent.IO_ERROR, function(e:Event):void {
                            trace("Error loading foo.jpg!");
                        });
                }               

                addChild(html);
        }
    }
} 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-27T20:54:15.607

您可以将 ID 添加到图像

```
html.htmlText = "Bogus image: <img src=\"foo.jpg\" id="image" />"; 
```

然后为 HTML 中的每个图像设置 IOErrorEvent 处理程序

```
var loader:Loader = html.getImageReference("image") as Loader;
if(loader){
    loader.contentLoaderInfo.addEventListener(IOErrorEvent.IO_ERROR, function(e:Event):void{});
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-08T16:35:03.783

这是一个很酷的问题。

我有两个建议。

1）不要使用文本字段。我猜你和我一样是在 Flex 之前用 Flash 开发的。您可能已经知道这一点，但我花了一些时间才发现：TextField 对象不适合在 Flex 中常规使用。从 Flex3 语言参考中查看这一点：

> TextField 类用于为文本显示和输入创建显示对象。SWF 文件中的所有动态和输入文本字段都是 TextField 类的实例。您可以使用 TextField 类来执行低级文本呈现。但是，在 Flex 中，您通常使用 Label、Text、TextArea 和 TextInput 控件来处理文本。

显然，使用 TextField 并没有什么问题，但我发现当我试图找出棘手的问题时，尽可能多地“按部就班”地删除未知数确实很有帮助（尽可能多地，至少）。

2）我想我会尝试扩展 Text 组件，或者创建一个基于 Text 的新组件。在此组件中，我将添加逻辑以将图像加载并插入到 TextField 对象中。这样，您可以在将字符串插入 TextField 之前轻松构建和验证要插入 TextField 对象的字符串。

如果你得到这个工作，请发布 - 我可以自己使用它。:)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-01-14T19:48:34.430

如果您有办法使用新的 FTE/TLF 组件，请这样做。Adobe 基本上放弃了旧的 TextField API，同样的错误是我过去不得不放弃许多项目和组件的原因。抛出此错误，基本上无法捕获。在我看来，Flash 工作最糟糕的方面之一。

TLF 解决了这些问题，并且更容易使用。在旧 API 中需要几天的实验现在只需要几个小时。我在新 API 上构建了一些富文本编辑器，使用起来非常好。你会很高兴你做到了:)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-02-03T00:14:06.593

我能够检测到图像何时加载，但我想我会遵循 TLF 的建议。无论如何，如果您需要知道，您必须在 Loader 上实现一个 enter_frame 事件侦听器，并检查字节属性 Lenght 上的 contentInfo，如果图像尚未加载，则长度为 0xffffffff，如果图像已加载，则长度为文件的大小，如果有错误，则字节属性为 NULL。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-10-21T19:26:37.320

```
 var html:TextField = new TextField();
   html.width=388.95;
   html.height=400;
   html.type = TextFieldType.DYNAMIC;
   html.multiline = true;
   html.htmlText = "Bogus image: <img id='image' src='foo.jpg'/>";                 
   var loader:Loader = html.getImageReference("image") as Loader;
loader.contentLoaderInfo.addEventListener(Event.COMPLETE, completeHan);
function completeHan(e:Event){
    addChild(html);
}

This will work.. 
```

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-12-01T02:42:18.963

这也是我正在处理的一个问题：这是一个真正的烦恼。我真的很想能够捕捉到所有的错误。我以为你可以说...

```
stage.addEventListener(IOError.IO_ERROR, myErrorHandler); 
```

...但这似乎不起作用，正如您所指出的那样。

也许您可以检查以确保信息亭的 Flash 播放器不是调试版本。我不认为发布版本会引发对话框（可能是错误的）。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2010-01-14T19:44:01.877

不可能的！如果您使用 Loader 加载不存在的图像，也会出现同样的问题！Flex 是一个框架，Image 类使用这个 Flash Loader 对象，但有很多代码行（查看 SwfLoader 的源代码...）。

您可以在设置 htmlText 属性之前检查您的图像 URL，或者您可以创建自己的组件来显示文本和图像..

我不敢相信这个简单而愚蠢的错误仍然没有被 Adob​​e 修复！

# vim - 在 Vim 中查看最近的文档列表

> ID：309723
> 
> 赞同：164
> 
> 时间：2008-11-21T18:37:26.837
> 
> 标签：vim, recent-documents

有没有办法查看你在 Vim 中打开的最近文档列表？我意识到我可以查看光标跳转列表，`:ju`然后转到列表中的光标位置，但这并不理想，因为列表中会有多个相同文档的列表。是否有另一个命令可以满足我的要求？

* * *

## 回答 #1

> 赞同：234
> 
> 时间：2011-01-08T12:27:35.643

不要使用插件，除非你想要一个漂亮的菜单。来自[Vim 文档：开始](http://vimdoc.sourceforge.net/htmldoc/starting.html#:oldfiles)（或`:help old`）：

```
:ol[dfiles] 
```

然后打开列出的文件之一，使用：`'0`, `'1`, `'2`, ...`'9`

* * *

列出文件中存储有标记的`viminfo`文件。

```
:bro[wse] ol[dfiles][!] 
```

用 列出文件名`:oldfiles`，然后提示输入一个数字。当数字有效时，列表中的文件将被编辑。用于`!`放弃修改后的缓冲区。

* * *

## 回答 #2

> 赞同：31
> 
> 时间：2008-11-21T18:42:31.787

最近使用 (MRU) 插件提供了对 Vim 中最近打开/编辑的文件列表的轻松访问。当您在 Vim 中打开/编辑文件时，该插件会自动存储文件名。

[http://www.vim.org/scripts/script.php?script_id=521](http://www.vim.org/scripts/script.php?script_id=521)

* * *

## 回答 #3

> 赞同：25
> 
> 时间：2018-05-28T04:03:46.607

此外`:oldfiles`，[fzf.vim](https://github.com/junegunn/fzf.vim)有`:History`.

* * *

## 回答 #4

> 赞同：18
> 
> 时间：2019-02-22T14:56:14.473

启动 Vim 并按 Ctrl-oo 打开以前编辑的文件。继续按 o（同时仍按 Ctrl 键）以循环浏览较早的文件。见[https://dev.to/jovica/3-little-known-but-useful-vim-tips-1pbg](https://dev.to/jovica/3-little-known-but-useful-vim-tips-1pbg)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2017-11-30T03:05:24.793

vim 插件：**minibufexpl**可以帮助你。打开的文件列表显示在屏幕的顶部或底部：

[![在此处输入图像描述](https://i.stack.imgur.com/TXBJ1.png)](https://i.stack.imgur.com/TXBJ1.png)

在 vim 普通模式下，键入**:b${bufid}**跳转到第**${bufid}_th**缓冲区，例如：键入**:b13**跳转到第**13**个缓冲区，即。ngx_mail_ssl_module.c。

另外，您可以在 vimrc 中映射一些方便的**绑定**，例如：

```
" ------------------------------- minibufexpl mappings -----------------------------------
"let g:miniBufExplSplitBelow=1
nnoremap <silent> <leader>bn :bn<cr>
nnoremap <silent> <leader>bp :bp<cr>
nnoremap <silent> <leader>bf :bf<cr>
nnoremap <silent> <leader>bl :bl<cr>
nnoremap <silent> <leader>bt :TMiniBufExplorer<cr> 
```

从这里获取插件：[https ://github.com/fholgado/minibufexpl.vim](https://github.com/fholgado/minibufexpl.vim)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2018-01-11T00:26:59.587

除了`oldfiles`有一个好东西叫做[tinyMRU](https://github.com/romainl/vim-tinyMRU)。

> Vim-tinyMRU 的唯一目的是提供一个直观的替代内置 :oldfile 命令。不多也不少。

这很简单：

[https://github.com/romainl/vim-tinyMRU/blob/master/plugin/tinymru.vim](https://github.com/romainl/vim-tinyMRU/blob/master/plugin/tinymru.vim)

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2018-05-15T07:15:09.787

一个好的插件是[https://github.com/Shougo/denite.nvim](https://github.com/Shougo/denite.nvim)

您可以调用`:Denite file_old`以便对旧文件列表进行模糊搜索。特别是，只需点击`Enter`将重新打开上次打开的文件。为此分配快捷方式很有用：

```
nnoremap <leader>o :Denite<space>file_old<CR> 
```

`:browse oldfiles`与, `q`, `1`,相比，这节省了很少的击键次数`Enter`

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2018-12-01T08:13:32.770

我访问最近文件的最简单方法是将以下内容添加到一个人的 .gvimrc 文件中：

```
let g:netrw_sort_by           = 'time'

let g:netrw_sort_direction    = 'r' 
```

这些行让 netrw 根据最近修改的文件对文件进行排序。然后一个简单的调用：e。并选择一个想要的文件。

此解决方案的前提是文件保存在 .gvimrc 中指定的一个主目录中。例如

```
cd ~/vim 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2021-04-22T17:00:12.973

没有直接的答案，但相关。

您可以定义`aliases`通过 vim 打开最后打开的文件：

```
alias vil='vim -c "normal! '\''0"' # open the last file
alias vil1='vim -c "normal! '\''1"'  # open the second last file ...
alias vil2='vim -c "normal! '\''2"' 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2021-12-22T06:43:19.657

`:ol`有效，但为什么不使用模糊搜索从一长串文件中快速获取完全匹配？

有一个非常方便的插件，ctrlp，它可以让你使用`:CtrlPMRU`，你可以快速得到你要找的东西。

多年来，ctrlp 是我为 vim 安装的第一件事！

[https://github.com/ctrlpvim/ctrlp.vim](https://github.com/ctrlpvim/ctrlp.vim)

# language-agnostic - 角动量传递方程

> ID：309733
> 
> 赞同：5
> 
> 时间：2008-11-21T18:41:15.893
> 
> 标签：language-agnostic, physics, equation, angular-momentum, rigid-bodies

对于如何计算两个刚体之间的角动量传递，是否有人对可以相对容易地实现的方程有任何好的参考？

我一直在寻找这种东西一段时间，我还没有找到任何特别容易理解的问题解释。

确切地说，问题是这样产生的；两个刚体在一个无摩擦（好，几乎）的表面上运动；把它想象成空气曲棍球。两个刚体接触，然后移开。现在，不考虑角动量，方程相对简单；问题变成了，物体之间的角动量转移会发生什么？

例如，假设这两个物体没有任何角动量；他们没有旋转。当它们以斜角相互作用时（行进矢量与它们的质心线不对齐），显然它们的一定量的动量被转换为角动量（即它们每个都得到一定量的自旋），但是如何很多，这样的方程式是什么？

这可能可以通过使用多体刚性系统进行计算来解决，但我想要进行更优化的计算，所以我可以实时计算这些东西。是否有人对方程式有任何想法，或指向这些计算的开源实现以包含在项目中？准确地说，我需要这是一个相当优化的计算，因为需要在模拟的单个“滴答”中模拟交互的数量。

编辑：好的，看起来关于这个主题的准确信息并不多。而且我发现“程序员物理学”类型的书有点太……愚蠢到真正得到；我不想要算法的代码实现；我想弄清楚（或至少为我勾勒出）算法。只有这样，我才能根据我的需要适当地优化它。有人对此类主题有任何数学参考吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-12T18:18:59.483

如果您对旋转非球形物体感兴趣，那么[http://www.myphysicslab.com/collision.html](http://www.myphysicslab.com/collision.html)将展示如何进行。物体的不对称性意味着碰撞过程中的法向接触力可以在它们各自的 CG 周围产生扭矩，从而导致物体开始旋转。

在台球或空气曲棍球的情况下，事情有点微妙。由于身体是球形/圆形，法向力总是穿过 CG，所以没有扭矩。然而，法向力并不是唯一的力。还有一个与接触法线相切的摩擦力，它将产生一个关于 CG 的扭矩。摩擦力的大小与法向力和摩擦系数成正比，与相对运动的方向相反。它的方向与物体在其接触点的相对运动相反。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-06-12T17:23:02.817

嗯，我最喜欢的物理书是[Halliday 和 Resnick](https://rads.stackoverflow.com/amzn/click/com/0471320579)。我从来没有觉得那本书对我来说是愚蠢的（愚蠢在头骨内，而不是在页面上......）。

如果你设置了一个思维问题，你就可以开始对这将如何发挥作用有所了解。

想象一下，你的两个刚性空气曲棍球底部没有摩擦，但边缘的摩擦系数最大。显然，如果两个冰球以相同的动能朝向对方，它们将完美地弹性碰撞并朝相反的方向返回。

但是，如果它们的中心偏移 2*radius - epsilon，它们将几乎不会接触到外围的一点。如果它们在边缘周围有非常高的摩擦系数，你可以想象它们的所有能量都会转移到旋转中。当然，撞击后必须分开，否则当他们粘在一起时，他们会立即停止自己的旋转。

因此，如果您只是在寻找看似合理且有趣的东西（游戏物理学），我会说您可以标准化摩擦系数以解释两个物体之间的微小接触区域（选择看起来有趣的东西）并使用物体路径和撞击点之间的角度的正弦值。直接，你会得到一个反弹，45度会给你反弹和旋转，90度偏移会给你最大的旋转和最小的反弹。

显然，以上都不是准确的模拟。不过，它应该是一个足够简单的框架来引发有趣的行为。

编辑：好的，我想出了另一个有趣的例子，也许更能说明问题。

想象一个单一的圆盘（如上）朝着一个静止的、刚性的、接近一维的针尖移动，它提供了以前的高摩擦力但低粘性。如果圆盘经过的距离刚好接近边缘，你可以想象它的一小部分线性能量将转化为旋转能量。

但是，您可以确定的一件事是，在这种接触之后存在最大的旋转能量：圆盘最终不能以这样的速度旋转，以至于它的外边缘以高于原始线速度的速度移动。因此，如果磁盘以每秒一米的速度移动，它的外边缘就不会以每秒一米的速度移动。

所以，既然我们有一篇很长的文章，那么有一些简单的概念应该有助于直觉：

1.  冲击角度的正弦值会影响最终的旋转。
2.  线性能量将决定最大可能的旋转能量。
3.  单个参数可以模拟相关的摩擦系数，使其在模拟中看起来很有趣。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-21T19:05:05.267

你应该看看[《面向游戏开发者的物理学》](https://rads.stackoverflow.com/amzn/click/com/0596000065) ——一本 O'Reilly 的书很难出错。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-21T19:12:07.343

除非您有充分的理由重新发明轮子，否则我建议您仔细查看一些开源物理引擎的源代码，例如[Open Dynamics Engine](http://www.ode.org/)或[Bullet](http://www.bulletphysics.com/)。该领域的高效算法是一种艺术形式，毫无疑问，最好的实现是在野外，在这些经过同行评审的项目中找到的。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-07-04T17:52:06.663

请看看这个参考！如果你想真正进入力学，这是要走的路，它是正确和数学上正确的方法！

Glocker Ch.，集值力定律：非光滑系统的动力学。应用力学讲义 1，施普林格出版社，柏林，海德堡，2001 年，222 页。PDF（内容，149 kB）

Pfeiffer F.，Glocker Ch.，单边接触多体动力学。JohnWiley & Sons，纽约，1996 年，317 页。PDF（内容，398 kB）

Glocker Ch.，Dynamik von Starrkörpersystemen mit Reibung und Stößen。VDI-Fortschrittberichte Mechanik/Bruchmechanik, Reihe 18, Nr. 182，VDI 出版社，杜塞尔多夫，1995 年，220 页。PDF (4094 KB)

# c# - 有没有更好的方法可以从任意输入转换为 ASCII？

> ID：309734
> 
> 赞同：2
> 
> 时间：2008-11-21T18:41:38.513
> 
> 标签：c#, encoding, stream, ascii

我需要能够获取可能具有字节顺序标记 (BOM) 的任意文本输入来标记其编码，并将其输出为 ASCII。我们有一些不了解 BOM 的旧工具，我需要向它们发送纯 ASCII 数据。

现在，我刚刚写完这段代码，我简直不敢相信这里的低效率。数据的四个副本，更不用说 StreamReader 内部的任何中间缓冲区。有一个更好的方法吗？

```
// i_fileBytes is an incoming byte[]

string unicodeString = new StreamReader(new MemoryStream(i_fileBytes)).ReadToEnd();
byte[] unicodeBytes  = Encoding.Unicode.GetBytes(unicodeString.ToCharArray());
byte[] ansiBytes     = Encoding.Convert(Encoding.Unicode, Encoding.ASCII, unicodeBytes);
string ansiString    = Encoding.ASCII.GetString(ansiBytes); 
```

我需要 StreamReader() 因为它有一个内部 BOM 检测器来选择编码来读取文件的其余部分。然后剩下的就是让它转换成最终的 ASCII 字符串。

有一个更好的方法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-21T18:57:57.137

如果内存中已经有 i_fileBytes，则可以检查它是否以 BOM 开头，然后使用`Encoding.Unicode.GetString`. （使用允许您指定索引和长度的重载。）

所以作为代码：

```
int start = (i_fileBytes[0] == 0xff && i_fileBytes[1] == 0xfe) ? 2 : 0;
string text = Encoding.Unicode.GetString(i_fileBytes, start, i_fileBytes.Length-start); 
```

但是请注意，这假定了真正的小端 UTF-16 编码。如果您确实需要首先检测编码，您可以重新实现 StreamReader 所做的事情，或者只是从前（比如说）10 个字节构建一个 StreamReader，然后使用 CurrentEncoding 属性来确定*应该*用于编码的内容。

编辑：现在，至于到 ASCII 的转换——如果你真的只需要它作为一个 .NET 字符串，那么大概你想要做的就是用“？”替换任何非 ASCII 字符。或类似的东西。（或者，抛出异常可能会更好......当然，这取决于你。）

编辑：请注意，在检测编码时，最好只调用`Read()`一次来读取一个字符。不要`ReadToEnd()`通过选择 10 个字节作为任意数量的数据来调用 as，它可能会在字符中间结束。我不知道这是否会引发异常，但无论如何它没有任何好处......

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-07-27T20:08:20.887

```
System.Text.Encoding.ASCII.GetBytes(new StreamReader(new MemoryStream(i_fileBytes)).ReadToEnd()) 
```

这应该可以节省一些往返行程。

# user-interface - 搜索/过滤/布尔表达式的最佳 UI

> ID：309735
> 
> 赞同：10
> 
> 时间：2008-11-21T18:42:12.957
> 
> 标签：user-interface, filtering

有一些简单的，一些复杂的，但我找不到黄金标准。谁能指出我让用户定义搜索条件（或过滤器）以检索结果的“最佳”方式？

这很复杂，因为：

*   需要支持大约 10 种不同类型的元素
*   支持和，或，不
*   括号（95% 人口的杀手）

作为一个例子，我查看了 MorningStar 高级基金过滤器，它可以但不是 web2.0（ajax、JQuery .. 换句话说，不酷）并且它处理括号很差。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-21T20:13:56.657

检查 iTunes 中的智能播放列表。我发现这个 UI 非常清晰。

OS X 中的 Finder 具有类似的 GUI，但也允许通过按*Alt*和`(+)`/来嵌套“括号” `(-)`。

# java - 如何在非静态内部类的另一个实例中引用外部类？

> ID：309737
> 
> 赞同：14
> 
> 时间：2008-11-21T18:42:27.310
> 
> 标签：java, syntax, reference, inner-classes

我正在使用 Apache Commons EqualsBuilder 为非静态 Java 内部类构建 equals 方法。例如：

```
import org.apache.commons.lang.builder.EqualsBuilder;

public class Foo {
    public class Bar {
        private Bar() {}

        public Foo getMyFoo() {
            return Foo.this
        }

        private int myInt = 0;

        public boolean equals(Object o) {
            if (o == null || o.getClass() != getClass) return false;

            Bar other = (Bar) o;
            return new EqualsBuilder()
                .append(getMyFoo(), other.getMyFoo())
                .append(myInt, other.myInt)
                .isEquals();
        }
    }

    public Bar createBar(...) {
        //sensible implementation
    }

    public Bar createOtherBar(...) {
        //another implementation
    }

    public boolean equals(Object o) {
        //sensible equals implementation
    }
} 
```

除了声明方法之外，是否有可以引用`other`的语法？类似的东西（不起作用）？`Foo``getMyFoo()``other.Foo.this`

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-21T19:14:48.727

不。

最好的方法可能是您建议的：将 getFoo() 方法添加到您的内部类。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-21T19:27:48.123

不，没有吸气剂是不可能的。'this' 关键字将始终指向当前实例。我很好奇您为什么要这样做……似乎您以错误的方式进行构图。

```
public class Foo {

  public Bar createBar(){
    Bar bar = new Bar(this)
    return bar;
  }
}

public class Bar {
  Foo foo;
  public Bar(Foo foo){
    this.foo = foo;
  }

  public boolean equals(Object other) {
    return foo.equals(other.foo);
  }
} 
```

由于使用 Foo.this 将内部类 (Foo myFoo = new Foo(); myFoo.new Bar(); 的创建限制为一个实例，我会说这更干净。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-11-21T19:29:12.253

是的：

```
public class Foo {
    public class Bar {
        public Foo getMyFoo() {
            return Foo.this;
        }
    }
    public Foo foo(Bar bar) {
        return bar.getMyFoo();
     }
    public static void main(String[] arguments) {
        Foo foo1=new Foo();
        Bar bar1=foo1.new Bar();
        Foo foo=(new Foo()).foo(bar1);
        System.out.println(foo==foo1);
    }
} 
```

# php - 从两个父类继承

> ID：309740
> 
> 赞同：4
> 
> 时间：2008-11-21T18:43:18.447
> 
> 标签：php, oop, inheritance, multiple-inheritance

我很久以前就读过这个，但现在从未尝试过，我不记得这是否可能。是否可以在 php5 上从两个父级扩展一个类，例如

class_d 扩展了 class_c 和 class_b

此外，如果 class_c 和 class_b 本身是从 class_a 扩展的，你能做到这一点......所以你会得到这样的东西

```
 class_a
                  class_b          class_c
                          class_d 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-21T18:50:26.293

PHP 不支持多重继承（您正在寻找的）。

您可能想要检查[组合](http://www.devshed.com/c/a/PHP/Object-Interaction-in-PHP-Introduction-to-Composition/)（其中一个类包含父类的实例）甚至[接口](http://us.php.net/interfaces)，如果它专门适用于您的情况。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-21T18:50:56.497

您想要的称为多重继承。它在 PHP 中不存在。

虽然存在替代方案：[Composition](http://www.devshed.com/c/a/PHP/Object-Interaction-in-PHP-Introduction-to-Composition/)，父级可以继承另一个，[mixins](http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/125282)甚至更多......

来自：[http ://www.phpbuilder.com/board/showthread.php?t=10351110](http://www.phpbuilder.com/board/showthread.php?t=10351110)

# php - 用于检查链接上次修改时间的 PHP 脚本

> ID：309744
> 
> 赞同：2
> 
> 时间：2008-11-21T18:44:26.727
> 
> 标签：php, url, datemodified

是否有接受 URL 并从标题中检索上次修改日期的基本 php 方法？

这似乎是 php 可以做的事情，但我不确定要检查哪个对象。

谢谢

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-21T18:52:37.303

试一试……使用[cURL](http://www.php.net/curl)。

```
$c = curl_init('http://...');
curl_setopt($c, CURLOPT_HEADER, 1); // Include the header
curl_setopt($c, CURLOPT_RETURNTRANSFER, 1); // Return the result instead of printing it
$result = curl_exec($c);

if (curl_errno($c))
    die(curl_error($c));

// $result now contains the response, including the headers

if (preg_match('/Last-Modified:(.*?)/i', $result, $matches))
    var_dump($matches[1]); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-21T19:34:40.200

谢谢...我尝试稍微修改您的版本，这似乎对我有用：

```
$c = curl_init('http://...');    
curl_setopt($c, CURLOPT_HEADER, 1); // Include the header    
curl_setopt($c, CURLOPT_RETURNTRANSFER, 1);
curl_setopt($c, CURLOPT_FILETIME, 1);   
curl_exec($c);
$result = curl_getinfo($c);   

if (curl_errno($c))
    die(curl_error($c));

echo date('G:i M jS \'y',(int)$result['filetime']); 
```

# unix - 检查变量是否是 UNIX shell 中的数字

> ID：309745
> 
> 赞同：24
> 
> 时间：2008-11-21T18:44:32.423
> 
> 标签：unix, shell

如何在 UNIX shell 中检查变量是数字还是包含数字？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-11-21T19:01:51.967

```
if echo $var | egrep -q '^[0-9]+$'; then
    # $var is a number
else
    # $var is not a number
fi 
```

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2008-11-21T18:57:34.610

Shell 变量没有类型，所以最简单的方法是使用返回类型`test`命令：

```
if [ $var -eq $var 2> /dev/null ]; then ... 
```

（或者用正则表达式解析它）

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2013-05-08T15:29:15.203

没有叉子，没有管道。纯 POSIX 外壳：

```
case $var in
   (*[!0-9]*|'') echo not a number;;
   (*)           echo a number;;
esac 
```

（假设*number := a string of digits*）。如果您想允许带单个前导`-`或`+`的带符号数字，请像这样去掉可选符号：

```
case ${var#[-+]} in
   (*[!0-9]*|'') echo not a number;;
   (*)           echo a number;;
esac 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-11-21T19:07:04.560

在启用了 extglob 选项的 ksh93 或 bash 中：

```
if [[ $var == +([0-9]) ]]; then ... 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2013-05-08T14:49:25.363

这是一个仅使用基本外壳中可用功能的版本（即它可以在 中工作`sh`），并且比 using 少一个过程`grep`：

```
if expr "$var" : '[0-9][0-9]*$'>/dev/null; then
    echo yes
else
    echo no
fi 
```

这会检查 是否*仅*`$var`代表一个整数；调整正则表达式以适应口味，并注意正则表达式参数隐式锚定在开头。*`expr`*

 ** * *

## 回答 #6

> 赞同：2
> 
> 时间：2014-02-20T06:07:40.523

我是 shell 编程的新手，所以我尝试找出最简单和可读的它只会检查 var 是否大于或等于 0 我认为这是选择参数的好方法......可能不是以前的...... ：

```
if [ $var -ge 0 2>/dev/null ] ; then ... 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2013-05-08T12:07:54.220

这可以使用正则表达式进行检查。

```
 ###    
    echo $var|egrep '^[0-9]+$'
    if [ $? -eq 0 ]; then
        echo "$var is a number"
    else
        echo "$var is not a number"
    fi 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2015-10-01T11:26:02.600

## 整数

```
if echo "$var" | egrep -q '^\-?[0-9]+$'; then 
    echo "$var is an integer"
else 
    echo "$var is not an integer"
fi 
```

**测试（使用 var=2 等）：**

```
2 is an integer
-2 is an integer
2.5 is not an integer 
2b is not an integer 
```

## 数字

```
if echo "$var" | egrep -q '^\-?[0-9]*\.?[0-9]+$'; then 
    echo "$var is a number"
else 
    echo "$var is not a number"
fi 
```

**测试（使用 var=2 等）：**

```
2 is a number
-2 is a number
-2.6 is a number
-2.c6 is not a number
2\. is not a number
2.0 is a number 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2014-05-15T08:54:52.473

```
if echo $var | egrep -q '^[0-9]+$' 
```

实际上，如果 var 是多行的，这不起作用。

IE

```
var="123
qwer" 
```

特别是如果 var 来自文件：

```
var=`cat var.txt` 
```

这是最简单的：

```
if [ "$var" -eq "$var" ] 2> /dev/null
then echo yes
else echo no
fi 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2014-06-27T19:52:11.580

这是没有任何正则表达式的测试（tcsh 代码）：

创建文件校验码：

#！/usr/bin/env tcsh

```
if ( "$*" == "0" ) then
    exit 0 # number
else
    ((echo "$*" | bc) > /tmp/tmp.txt) >& /dev/null
    set tmp = `cat /tmp/tmp.txt`
    rm -f /tmp/tmp/txt
    if ( "$tmp" == "" || $tmp == 0 ) then
        exit 1 # not a number
    else
        exit 0 # number
    endif

endif 
```

并运行

```
chmod +x checknumber 
```

利用

```
checknumber -3.45 
```

你会得到错误级别的结果（$？）。

您可以轻松优化它。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2017-12-06T22:13:36.300

```
( test ! -z "$num" && test "$num" -eq "$num" 2> /dev/null ) && {
   # $num is a number
} 
```

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2013-10-02T15:12:08.010

```
a=123
if [ `echo $a | tr -d [:digit:] | wc -w` -eq 0 ]
then
    echo numeric
else
    echo ng
fi 
```

> 数字

```
a=12s3
if [ `echo $a | tr -d [:digit:] | wc -w` -eq 0 ]
then
    echo numeric
else
    echo ng
fi 
```

> 吴

* * *

## 回答 #13

> 赞同：-1
> 
> 时间：2014-05-15T13:10:32.033

您可以使用简单的测试命令来做到这一点。

```
$ test ab -eq 1 >/dev/null 2>&1
$ echo $?
2

$ test 21 -eq 1 >/dev/null 2>&1
$ echo $?
1

$ test 1 -eq 1 >/dev/null 2>&1
$ echo $?
0 
```

因此，如果退出状态是 0 或 1，那么它是一个整数，但如果存在状态是 2，那么它不是一个数字。

* * *

## 回答 #14

> 赞同：-1
> 
> 时间：2016-01-20T03:54:19.060

从命令行获取值并显示 THE INPUT IS DECIMAL/NON-DECIMAL 和 NUMBER 与否：

```
NUMBER=$1

            IsDecimal=`echo "$NUMBER" | grep "\."`

if [ -n "$IsDecimal" ]
then
            echo "$NUMBER is Decimal"
            var1=`echo "$NUMBER" | cut -d"." -f1`
            var2=`echo "$NUMBER" | cut -d"." -f2`

            Digit1=`echo "$var1" | egrep '^-[0-9]+$'`
            Digit2=`echo "$var1" | egrep '^[0-9]+$'`
            Digit3=`echo "$var2" | egrep '^[0-9]+$'`

            if [ -n "$Digit1" ] && [ -n "$Digit3" ]
            then
                echo "$NUMBER is a number"
            elif [ -n "$Digit2" ] && [ -n "$Digit3" ]
            then
                echo "$NUMBER is a number"

            else
                echo "$NUMBER is not a number"
            fi
else
            echo "$NUMBER is not Decimal"

            Digit1=`echo "$NUMBER" | egrep '^-[0-9]+$'`
            Digit2=`echo "$NUMBER" | egrep '^[0-9]+$'`

            if [ -n "$Digit1" ] || [ -n "$Digit2" ]; then
                echo "$NUMBER is a number"
            else
                echo "$NUMBER is not a number"
            fi
fi 
```

# ruby - Ruby 语句链接

> ID：309753
> 
> 赞同：1
> 
> 时间：2008-11-21T18:46:20.937
> 
> 标签：ruby

鉴于以下 Ruby 语句：

（读取输入并将每个单词存储在数组中，删除单词之间的空格等）

```
input = gets.chomp
inArr = []
input.strip.each (" ") { |w| inArr.push w }
inArr.delete_if {|ele| ele == " "}
inArr.each {|w| w.strip!} 
```

我想知道是否有人可以建议一种优化此代码的方法，可能是通过链接或删除一些不需要的语句，因为我觉得这可以用更少的代码来完成，但是由于我是 Ruby 新手，所以我很难怎么看 ：）

谢谢，

R M

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-21T18:50:16.763

`gets.split`应该得到你想要的

```
>> gets.split
this is a test
=> ["this", "is", "a", "test"] 
```

# html - 一行上的 CSS 块元素

> ID：309769
> 
> 赞同：8
> 
> 时间：2008-11-21T18:52:10.410
> 
> 标签：html, css, web-standards

处理一系列需要排成一行的块元素的最常见方法是什么（例如，如果 javascript 需要能够修改它们的宽度）？将 float:left 应用于它们每个与使用定位来放置它们的优缺点是什么？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-11-21T22:56:31.290

好吧，如果您不太关心旧浏览器（我在看您，IE6），最好的方法是使用

```
display:inline-block; 
```

基本上，它创建了一个盒子模型元素而不在它之前或之后清除，所以它保持在行中。每个现代浏览器都能很好地解释它。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-21T22:32:00.373

浮动将是我的选择，但这实际上取决于您希望实现的目标。如果你能提供一个更具体的例子，我可以给你一个明确的理由，说明我认为你应该使用什么以及为什么要使用。但是，这是我遇到的一组简短的利弊（我假设定位是指绝对定位）：

定位优势：

*   相对于标记为相对位置的下一个祖先非常精确的定位 - 具有很大的灵活性
*   允许元素在视觉上与它们在 DOM 中的顺序不同

定位缺点：

*   更难与其他元素对齐，因为定位的元素不再在文档流中，而且还因为所需的精度级别。
*   其他元素忽略绝对定位元素，这意味着您可能有潜在的重叠，除非您考虑了定位元素的最小和最大尺寸
*   如果您对列使用绝对定位，则更难实现页脚。

浮动优点：

*   非常容易构建简单和高级的布局
*   没有页脚问题
*   不用担心精度，浏览器会为您处理
*   父容器伸展

浮动缺点：

*   对于那些对浮动布局缺乏经验的人来说，很多陷阱可能会导致在 SO 上提出许多问题 :)

至于塞巴斯蒂安提到的 clear:both 元素，有一个简单的方法。假设您有一个容器 div 和 2 个浮动 div。

html:

```
<div id="con">
    <div class="float"></div>
    <div class="float"></div>
</div> 
```

CSS：

```
#con { background:#f0f; }
.float { float:left; width:100px; height:100px; background:#0ff; } 
```

如果您要运行此代码，您会注意到容器 div（洋红色）只有一个像素高，而浮动 div 是正确的 - 这是 Sebastian 提到的问题。现在你可以接受他的建议并添加一个 br 或浮动容器，这不会是非常语义化的 - 所以这里有一个稍微优雅的解决方案。只需添加溢出：隐藏；像这样到容器 div：

```
#con { background:#f0f; overflow:hidden; } 
```

现在您的容器应该正确包装浮动的 div。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-21T18:58:55.060

父容器不会随着它们一起伸展，除非它也被分配了一个浮动标签或者有一个带有 clear:both 的 br；在底部。

我会选择 float:left 而不是定位。当一个对象拉伸时，浏览器会进行所有的对齐。所以你需要关心的就更少了。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-21T19:13:06.140

我想我不会明确定位元素，而是指示浏览器使用 display:inline 对元素使用内联布局，并让浏览器处理定位。

关于浮动与定位，我认为使用定位排列它们的唯一方法是使用绝对定位，这意味着您需要处理（浏览器视口的）重新大小以将元素保持在适当的位置。

我认为通过使用 float 属性，浏览器会为您处理调整大小的问题并将元素重新呈现在正确的位置。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-21T22:34:28.307

对我来说，在这种情况下浮动的唯一缺点是你要么需要左对齐它们，要么右对齐它们——居中不是一种选择。但是，您已经提到您正在使用绝对值作为宽度，因此您可以将所有浮动元素嵌套在 DIV 元素中，并将 margin-right 或 margin-left 添加到父 DIV 以模拟居中对齐。

# language-agnostic - 如何设计一个只有一个重型工作方法和返回其他方法的数据的类？

> ID：309775
> 
> 赞同：3
> 
> 时间：2008-11-21T18:54:19.797
> 
> 标签：language-agnostic, oop

我想设计一个类，将字符串解析为对我的应用程序有意义的标记。

我该如何设计它？

1.  提供一个接受字符串的 ctor，提供一个 Parse 方法并提供返回单个标记、标记计数等的方法（我们称它们为“次要”）。或者
2.  提供一个不接受任何内容的 ctor，提供一个接受字符串的 Parse 方法和上面的次要方法。或者
3.  提供一个接受字符串并仅提供次要方法但不提供解析方法的 ctor。解析由ctor完成。

1 和 2 的缺点是用户可以调用次要方法而不调用 Parse 方法。我必须检查调用 Parse 方法的每个次要方法。

我在 3 中看到的问题是 parse 方法可能会做很多事情。将它放在ctor中似乎不正确。

2 的方便之处在于用户可以解析任意数量的字符串，而无需一次又一次地实例化该类。

什么是好方法？有哪些考虑？

（语言是 c#，如果有人关心的话）。

谢谢

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-21T19:02:22.120

我将有一个带有 Parse 方法的单独类，该方法接受一个字符串并将其转换为一个单独的新对象，该对象具有字符串中每个值的属性。

```
ValueObject values = parsingClass.Parse(theString); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-21T19:14:12.923

我认为这是一个非常好的问题......

一般来说，我会选择类似于上面选项 3 的东西。基本上，想想你的班级和它的作用；除了要解析的数据和解析的标记之外，它是否有任何有效数据？如果没有，那么我通常会说，如果你没有这些东西，那么你就没有你的类的实例；你有一个不完整的类实例；你想避免的事情。

您指出的一个考虑因素是令牌的解析可能是一个计算相对复杂的过程；可能需要一段时间。我同意你的观点，你可能不想在构造函数中这样做；在这种情况下，使用 Parse() 方法可能是有意义的。然而，随之而来的问题是，在 parse() 方法完成之前，是否可以对您的类进行任何明智的操作。如果没有，那么你又回到了原点；在 parse() 方法完成之前，您实际上处于类的“不完整实例”状态；也就是说，它实际上是无用的。当然，如果您愿意并且能够在应用程序中使用一些多线程，这一切都会改变；如果你' 愿意将计算复杂的操作卸载到另一个线程上，并在你的类方法/访问器上保持某种同步，直到你完成，然后整个 parse() 事情更有意义，因为你可以选择在一个完全新线程。但是，您仍然会遇到在完全解析所有内容之前尝试使用您的类的问题。

不过，我认为这个设计中出现的一个更广泛的问题是，这段代码的更大范围是什么？这段代码将用于什么用途，我的意思是，不仅仅是现在，还有预期用途，但是否有可能该代码可能需要像您的应用程序一样增长或更改？在执行的稳定性**方面**，您能否期望它完全稳定，或者您要解析的数据集或要解析的数据大小或您要解析的标记将来可能会发生变化？如果实现有可能发生变化，请考虑它可能发生变化的所有方式；以我的经验，这些考虑可能会强烈地导致一种或另一种实施。考虑这些事情并非易事；不是由一个长镜头。

为了避免你认为这只是吹毛求疵，我会说，保守估计，我编写的类中约有 10% 到 15% 甚至在项目完成之前就需要进行某种程度的重构；很少有我从事过的设计能够幸存下来，以与以前相同的方式出现。因此，考虑实现的可能排列对于确定您的实现应该是什么非常有用。例如，如果您的实现永远不可能改变要标记化的字符串的大小，您可以对计算复杂性做出假设，这可能会导致您在整体设计上以一种或另一种方式进行。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-21T19:44:06.170

如果该类的唯一目的是将输入字符串解析为一组属性，那么我在选项 3 中看不到任何真正的缺点。解析操作可能很昂贵，但如果你必须在某个时候这样做'要使用它。

您提到选项 2 很方便，因为您可以在不重新实例化对象的情况下解析新值，但如果解析操作如此昂贵，我认为这没有太大区别。比较以下代码：

```
// Using option 3
ParsingClass myClass = new ParsingClass(inputString);

// Parse a new string.
myClass = new ParsingClass(anotherInputString);

// Using option 2
ParsingClass myClass = new ParsingClass();
myClass.Parse(inputString);

// Parse a new string.
myClass.Parse(anotherInputString); 
```

使用上没有太大区别，但是使用选项 2，您必须检查所有次要方法和属性，以查看是否已发生解析，然后才能继续。（选项 1 要求您执行选项 2 在内部执行的所有操作，但还允许您在使用它时编写选项 3 样式的代码。）

或者，您可以将构造函数设为私有，并将 Parse 方法设为静态，让 Parse 方法返回对象的实例。

```
// Option 4
ParsingClass myClass = ParsingClass.Parse(inputString);

// Parse a new string.
myClass = ParsingClass.Parse(anotherInputString); 
```

选项 1 和 2 提供了更大的灵活性，但需要更多的代码来实现。选项 3 和 4 不太灵活，但要编写的代码也更少。基本上，这个问题没有一个正确的答案。这实际上是最适合您现有代码的问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-25T12:11:26.270

两个重要的考虑：

1）解析会失败吗？

如果是这样，并且如果你把它放在构造函数中，那么它必须抛出一个异常。Parse 方法可以返回一个指示成功的值。因此，请检查您的同事对在没有停止显示的情况下抛出异常的感受：默认是假设他们不会喜欢它。

2) 构造函数必须使您的对象进入有效状态。

如果您不介意“尚未解析任何内容”作为对象的有效状态，那么 parse 方法可能是要走的路，并调用类 SomethingParser。

如果你不想这样，那么在构造函数（或工厂，正如 Garry 建议的那样）中解析，并调用 ParsedSomething 类。

不同之处可能在于您是否打算将这些东西作为参数传递给其他方法。如果是这样，那么拥有“尚未准备好”状态是一件痛苦的事情，因为您要么必须在每个被调用者中检查它并优雅地处理它，要么您必须编写诸如“参数必须已经解析字符串”之类的文档. 然后很可能无论如何都要用断言检查每个被调用者。

您可能可以使用它，使初始状态与解析空字符串（或其他一些基本值）后的状态相同，从而避免“尚未准备好”问题。

无论如何，如果这些东西可能是参数，我个人会说它们必须在构建后立即“准备就绪”。如果它们只是要在本地使用，那么如果他们可以在不做繁重的工作的情况下创建它们，那么您可能会给用户更多的灵活性。代价是需要两行代码而不是一行代码，这使您的类更难使用。

你可以考虑给这个东西两个构造函数和一个 Parse 方法：字符串构造函数相当于调用无参数构造函数，然后调用 Parse。

# sql-server-2005 - 全文搜索单个字符

> ID：309784
> 
> 赞同：1
> 
> 时间：2008-11-21T18:56:53.753
> 
> 标签：sql-server-2005

我有一个带有 TEXT 列的表，其中的内容只是 CSV 数字的字符串。示例 ",1,76,77,115," 每个字符串可以有任意数量的数字。

我正在尝试设置全文索引，以便我可以快速搜索此列。这很好用。而不是运行查询

```
where MY_COL LIKE '%,77,%' and MY_COL LIKE '%,115,%' 
```

我可以

```
where CONTAINS(MY_COL,'77 and 115') 
```

但是，当我尝试搜索单个字符时，它不起作用。

```
where CONTAINS(MY_COL,'1') 
```

但我知道应该有记录返回！我很快发现我需要编辑噪声文件并重建索引。但即使这样做了，它仍然不起作用。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-29T19:02:49.093

以这种方式使用关系数据库会受到伤害。

使用适当的模式。要么将值存储在不同的行中，要么对列使用数组数据类型。

这将使解决问题变得微不足道。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-23T18:50:39.337

我解决了自己的问题，尽管我不确定是什么解决了它。

我删除了我的表并填充了一个新表（我的程序进行批处理）并创建了一个新的全文索引。也许我没有足够的耐心让索引完全重建。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-05T16:17:42.493

同意。12,15,33 如何不返回该记录以使用全文搜索 1？使用实际的表模式来完成此操作。

# sql - 如何强制 Postgres 使用特定索引？

> ID：309786
> 
> 赞同：146
> 
> 时间：2008-11-21T18:56:57.983
> 
> 标签：sql, postgresql, indexing

当 Postgres 坚持执行顺序扫描时，如何强制它使用索引？

* * *

## 回答 #1

> 赞同：124
> 
> 时间：2008-11-21T19:04:03.803

假设您询问的是在许多数据库中发现的常见“索引提示”功能，PostgreSQL 不提供这样的功能。这是 PostgreSQL 团队有意识的决定。[可以在此处](http://blog.2ndquadrant.com/hinting_at_postgresql/)找到关于为什么以及您可以做什么的一个很好的概述。原因基本上是它是一种性能黑客，随着数据的变化，它往往会在以后导致更多问题，而 PostgreSQL 的优化器可以根据统计数据重新评估计划。换句话说，今天可能是一个好的查询计划可能不会一直是一个好的查询计划，并且索引提示会一直强制执行特定的查询计划。

作为一个非常钝的锤子，对测试很有用，可以使用`enable_seqscan`和`enable_indexscan`参数。看：

*   [检查索引使用情况](http://www.postgresql.org/docs/current/static/indexes-examine.html)
*   [`enable_`参数](http://www.postgresql.org/docs/current/static/runtime-config-query.html)

这些*不适合正在进行的生产使用*。如果您在选择查询计划时遇到问题，您应该查看[用于跟踪查询性能问题的文档](http://www.postgresql.org/docs/current/static/performance-tips.html)。不要只是设置`enable_`参数然后走开。

除非您有充分的理由使用索引，否则 Postgres 可能会做出正确的选择。为什么？

*   对于小型表，执行顺序扫描会更快。
*   当数据类型不正确匹配时，Postgres 不使用索引，您可能需要包含适当的强制转换。
*   您的规划器设置可能会导致问题。

另请参阅[此旧新闻组帖子](http://archives.postgresql.org/pgsql-sql/2006-02/msg00188.php)。

* * *

## 回答 #2

> 赞同：97
> 
> 时间：2012-11-16T01:33:06.460

可能是使用的唯一正当理由

```
set enable_seqscan=false 
```

当您正在编写查询并希望快速查看查询计划实际上是什么时，如果表中有大量数据。或者当然，如果您需要快速确认您的查询没有使用索引，仅仅是因为数据集太小。

* * *

## 回答 #3

> 赞同：37
> 
> 时间：2018-10-16T10:31:16.600

# TL;博士

运行以下三个命令，查看问题是否解决：

```
ANALYZE;
SET random_page_cost = 1.0;
SET effective_cache_size = 'X GB';    # replace X with total RAM size minus 2 GB 
```

请继续阅读以了解更多详细信息和背景信息。

# 第 1 步：分析表

作为解决问题的简单第一次尝试，以`ANALYZE;`数据库超级用户身份运行命令以更新所有表统计信息。从[文档](https://www.postgresql.org/docs/current/sql-analyze.html)中：

> 查询计划器使用这些统计信息来帮助确定最有效的查询执行计划。

# 第 2 步：设置正确的随机页面成本

索引扫描需要非顺序的磁盘页面获取。PostgreSQL 使用`random_page_cost`配置参数来估计这种非顺序提取相对于顺序提取的成本。从[文档](https://www.postgresql.org/docs/current/static/runtime-config-query.html#RUNTIME-CONFIG-QUERY-CONSTANTS)中：

> 减少这个值 [...] 将导致系统更喜欢索引扫描；提高它会使索引扫描看起来相对更昂贵。

默认值为`4.0`，因此假设与顺序提取相比，*平均*成本因子为 4，同时考虑到缓存效果。但是，如果您的数据库存储在*SSD 驱动器上*，那么您应该根据文档实际设置`random_page_cost`为：`1.1`

> 与顺序驱动器（例如固态驱动器）相比，具有较低随机读取成本的存储也可以用较低的 值`random_page_cost`（例如 ）更好地建模`1.1`。

此外，如果索引大部分（甚至完全）缓存在 RAM 中，那么索引扫描将始终*比*磁盘服务的顺序扫描快得多。然而，查询规划器不知道索引的哪些部分已经被缓存，因此可能会做出错误的决定。

如果您的数据库索引被频繁使用，并且系统有足够的 RAM，那么索引最终可能会被缓存。在这种情况下，`random_page_cost`可以将其设置为`1.0`，甚至设置为以下值，`1.0`以积极地倾向于使用索引扫描（尽管文档建议不要这样做）。您将不得不尝试不同的值，看看哪些对您有用。

作为旁注，您还可以考虑使用[pg_prewarm](https://www.postgresql.org/docs/current/static/pgprewarm.html)扩展将索引显式缓存到 RAM 中。

你可以`random_page_cost`这样设置：

```
SET random_page_cost = 1.0; 
```

# 步骤 3：设置正确的缓存大小

在具有 8 GB 或更多 GB RAM 的系统上，您应该将`effective_cache_size`配置参数设置为 PostgreSQL 通常可用于数据缓存的内存量。从[文档](https://www.postgresql.org/docs/current/static/runtime-config-query.html#RUNTIME-CONFIG-QUERY-CONSTANTS)中：

> 较高的值使其更有可能使用索引扫描，较低的值使其更有可能使用顺序扫描。

请注意，此参数不会更改 PostgreSQL 实际分配的内存量，而仅用于计算成本估算。一个合理的值（至少在专用数据库服务器上）是总 RAM 大小减去 2 GB。默认值为`4 GB`。

你可以`effective_cache_size`这样设置：

```
SET effective_cache_size = '14 GB';   # e.g. on a dedicated server with 16 GB RAM 
```

# 第 4 步：永久修复问题

您可能希望永久使用`ALTER SYSTEM SET ...`或`ALTER DATABASE db_name SET ...`设置新的配置参数值（全局或每个数据库）。有关设置参数的详细信息，请参阅[文档](https://www.postgresql.org/docs/current/config-setting.html)。

# 第 5 步：其他资源

如果它仍然不起作用，那么您可能还想看看[这个关于服务器调优的 PostgreSQL Wiki 页面](https://wiki.postgresql.org/wiki/Tuning_Your_PostgreSQL_Server)。

* * *

## 回答 #4

> 赞同：25
> 
> 时间：2015-06-16T05:17:16.040

有时 PostgreSQL 无法为特定条件做出最佳索引选择。举个例子，假设有一个交易表有几百万行，其中任何一天都有几百行，并且该表有四个索引：transaction_id、client_id、date 和 description。您要运行以下查询：

```
SELECT client_id, SUM(amount)
FROM transactions
WHERE date >= 'yesterday'::timestamp AND date < 'today'::timestamp AND
      description = 'Refund'
GROUP BY client_id 
```

PostgreSQL 可能会选择使用索引 transactions_description_idx 而不是 transactions_date_idx，这可能导致查询需要几分钟而不是不到一秒。如果是这种情况，您可以通过捏造这样的条件来强制使用日期索引：

```
SELECT client_id, SUM(amount)
FROM transactions
WHERE date >= 'yesterday'::timestamp AND date < 'today'::timestamp AND
      description||'' = 'Refund'
GROUP BY client_id 
```

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2009-07-09T17:58:04.820

这个问题本身是非常无效的。强制（例如通过 enable_seqscan=off）是非常糟糕的主意。检查它是否会更快可能很有用，但生产代码不应该使用这样的技巧。

相反 - 对您的查询进行解释分析，阅读它，并找出 PostgreSQL 选择错误（在您看来）计划的原因。

网上有一些工具可以帮助阅读解释分析输出 - 其中之一是[explain.depesz.com](http://explain.depesz.com/) - 由我编写。

另一种选择是加入[freenode](http://freenode.net/) irc 网络上的#postgresql 频道，并与那里的人交谈以帮助您 - 因为优化查询不是“问一个问题，得到一个快乐的答案”的问题。它更像是一次对话，有很多东西要检查，很多东西要学习。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2021-07-08T17:12:57.463

PostgreSQL 需要注意的一件事；您期望使用索引但未使用索引的地方是 VACUUM ANALYZE 表。

```
VACUUM ANALYZE schema.table; 
```

这会更新计划程序使用的统计信息，以确定执行查询的最有效方式。这可能会导致索引被使用。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2017-10-26T21:26:53.370

有一个技巧可以推动 postgres 更喜欢 seqscan`OFFSET 0`在子查询中添加 a

当您只需要 n 个第一个/最后一个元素时，这对于优化链接大/巨大表的请求非常方便。

假设您正在查找涉及具有 100k（或更多）条目的多个表的第一个/最后 20 个元素，当您要查找的内容在前 100 个或 1000 个中时，没有必要构建/链接所有数据的所有查询条目。例如，在这种情况下，执行顺序扫描的速度要快 10 倍以上。

请参阅[如何防止 Postgres 内联子查询？](https://stackoverflow.com/questions/14897816/how-can-i-prevent-postgres-from-inlining-a-subquery)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2021-06-08T07:13:14.740

索引只能在某些情况下使用。

1.  例如，值的类型适合列的类型。
2.  在与值进行比较之前，您没有对列进行操作。

给定一个包含 3 列的客户表，所有列都有 3 个索引。

```
create table customer(id numeric(10), age int, phone varchar(200)) 
```

例如，数据库可能会尝试使用索引 idx_age 而不是使用电话号码。

您可以通过执行年龄操作来破坏索引年龄的使用：

```
 select * from customer where phone = '1235' and age+1 = 24 
```

（虽然您正在寻找 23 岁）

这当然是一个非常简单的例子，postgres 的智能可能足以做出正确的选择。但有时除了欺骗系统之外别无他法。

另一个例子是

```
select * from customer where phone = '1235' and age::varchar = '23' 
```

但这可能比上述选项更昂贵。

不幸的是，您不能像在 MSSQL 或 Sybase 中那样将索引的名称设置到查询中。

```
select * from customer (index idx_phone) where phone = '1235' and age = 23. 
```

这将有助于避免此类问题。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2021-03-02T17:48:19.697

显然，在某些情况下，可以通过重复两次类似的条件来暗示 Postgre 使用索引。

我观察到的具体情况是使用 PostGIS`gin`索引和[ST_Within](https://postgis.net/docs/ST_Within.html)谓词，如下所示：

```
select *
from address
natural join city
natural join restaurant
where st_within(address.location, restaurant.delivery_area)
and restaurant.delivery_area ~ address.location 
```

请注意，第一个谓词`st_within(address.location, restaurant.delivery_area)`由 PostGIS 自动分解为，`(restaurant.delivery_area ~ address.location) AND _st_contains(restaurant.delivery_area, address.location)`因此添加第二个谓词`restaurant.delivery_area ~ address.location`是完全多余的。尽管如此，第二个谓词说服了计划者`address.location`在我需要的特定情况下使用空间索引，将运行时间提高了 8 倍。

# java - 声明并抛出与未声明异常的抛出

> ID：309790
> 
> 赞同：9
> 
> 时间：2008-11-21T18:57:55.953
> 
> 标签：java, exception

在Java中，孪生方法有什么区别？

```
public void methodA() throws AnException {
    //do something
    throw new AnException();
}

public void methodA() {
    //do the same thing
    throw new AnException();
} 
```

我有一种直觉，它与设计良好的方法有关（因为我将 methodA 放在接口中，以 methodA* 在其实现中的方式声明它，并收到来自 Java 的警告“A* 无法覆盖 A，因为A* 不会抛出 AnException")。

这个推测正确吗？

这两种做事方式是否还有其他微妙的内涵？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-11-21T19:09:27.067

如果 AnException 是一个检查异常（换句话说，如果它不扩展 RuntimeException），那么 methodA 将不会编译。必须始终声明已检查的异常。

如果 AnException 是未经检查的异常（如果它确实扩展了 RuntimeException），则 java 编译器允许其中的任何一个，并且 java 运行时等效地解释任何一个。出于文档的原因，在这种情况下仍可能首选方法 A。您的方法的 javadoc 将显示它可能会抛出 AnException。让您的方法的用户知道他们应该期待什么异常是很好的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-22T16:34:53.360

除了其他人给出的关于您自己的方法可编译性的好答案之外，还有在超类中实现接口和覆盖方法的问题。

该规则说您可以覆盖/实现一个方法，但**您不能**为原始方法签名声明的那些声明额外的异常。要理解这一点，请考虑这个例子。

假设您正在使用某种数据结构：

```
public abstract class AbstractBox {
  public abstract void addItem(Item newItem);
  public abstract void removeItem(Item oldItem);
} 
```

您有自己的实现，但您决定声明未出现在原始签名中的异常：

```
public class MyBox extends AbstractBox {
  public void addItem(Item newItem) throws ItemAlreadyPresentException {...}
  public void removeItem(Item oldItem) throws NoSuchItemException {...}
} 
```

现在让我们考虑这个处理 Box 对象并接收 MyBox 实例的通用代码：

```
public void boxHandler(AbstractBox box) {
  Item item = new Item();
  box.removeItem(item);
} 
```

编写此代码的人没有预料到任何异常，她也不打算处理实现者异常。为防止这种情况，编译器将不允许您在原始签名中声明其他异常。

当然，如果您在内部处理异常......好吧，编译器将非常乐意允许您从签名中删除声明的异常；-)

希望这可以帮助...

尤瓦尔=8-)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-22T15:35:49.603

第一个方法必须在 try catch 块中或在声明 throws AnException 的方法中调用，否则编译将失败。

第二个没有这个限制

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-21T19:11:29.543

在第二种方法中，AnException 类需要是 RuntimeException 的子类，这意味着声明不是强制性的，方法调用者不必处理它。RuntimeException 的一个示例是 ArrayOutOfBoundException，想象一下，如果您每次使用 List 时都会显式处理异常（通过声明 throws 或使用 try/catch 块）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-21T19:11:54.583

出于纯粹的文档原因，最好将异常包含在函数定义中。这样，调用者就可以清楚地知道需要处理哪些异常。我还猜测编译器需要为抛出异常的函数做一些高级设置。

# initialization - C、C++、C#、Java 和 Python 中的声明、定义、初始化

> ID：309801
> 
> 赞同：10
> 
> 时间：2008-11-21T19:01:04.260
> 
> 标签：initialization, language-design, declaration, definition

这些术语在上述每种语言中的含义是什么？为什么这些语言在这方面有所不同（无论它们在哪里，如果有的话）？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-21T19:17:21.920

# C/C++：

*声明*是一个声明，它说“这是某物的名称和它的类型，但我不会告诉你更多关于它的信息”。

*定义*是一个陈述，它说“这是某物的名称以及它到底是什么”。对于函数，这将是函数体；对于全局变量，这将是变量所在的翻译单元。

*初始化*是变量也被赋予初始值的定义。某些语言会自动将所有变量初始化为某个默认值，例如 0、false 或 null。有些（如 C/C++）并非在所有情况下：所有全局变量都是默认初始化的，但堆栈上的局部变量和堆上动态分配的变量不是默认初始化的 - 它们具有未定义的内容，因此您必须显式初始化他们。C++ 也有默认的构造函数，这完全是另一回事。

例子：

```
 // In global scope:
extern int a_global_variable;  // declaration of a global variable
int a_global_variable;         // definition of a global variable
int a_global_variable = 3;     // definition & initialization of a global variable

int some_function(int param);  // declaration of a function
int some_function(int param)    // definition of a function
{
    return param + 1;
}

struct some_struct;  // declaration of a struct; you can use pointers/references to it, but not concrete instances
struct some_struct   // definition of a struct
{
    int x;
    int y;
};

class some_class;  // declaration of a class (C++ only); works just like struct
class some_class   // definition of a class (C++ only)
{
    int x;
    int y;
};

enum some_enum;  // declaration of an enum; works just like struct & class
enum some_enum   // definition of an enum
{
   VALUE1,
   VALUE2
}; 
```

我对您询问的其他语言不太熟悉，但我相信它们在声明和定义之间没有太大区别。C# 和 Java 对所有对象都有默认初始化 - 如果您没有显式初始化，所有对象都将初始化为 0、false 或 null。Python 更加宽松，因为变量在使用前不需要声明。由于绑定是在运行时解析的，因此也不需要函数声明。

# c# - 无需在 classname.designer.cs 文件中手动设置事件处理程序

> ID：309802
> 
> 赞同：0
> 
> 时间：2008-11-21T19:01:04.400
> 
> 标签：c#, winforms, events

除了双击 UI 元素之外，有没有办法在 classname.designer.cs 文件中手动设置事件处理程序？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-21T19:02:29.547

如果我正确地遵循了你的问题，你可以在你的代码隐藏中这样做：

```
myButton.Click += myHandler; 
```

或者您可以使用匿名委托：

```
myButton.Click += delegate
{
    MessageBox.Show("Clicked!");
}; 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-23T14:18:47.997

单击“属性”窗口中的闪电图标。双击要实施的事件。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-21T19:02:56.050

当然。在初始化期间的某个地方使用`myControl.Event += new EventHandler(SomeHandlerMethodInYourClass)`，例如在表单的构造函数中。

# windows - 环回接口上的 TIME_WAIT

> ID：309803
> 
> 赞同：1
> 
> 时间：2008-11-21T19:01:07.973
> 
> 标签：windows, networking, tcp, loopback, time-wait

为什么与环回接口的 TCP 连接最终会出现`TIME_WAIT`（套接字关闭并`SO_DONTLINGER`设置），但与不同主机的相同连接不会结束`TIME_WAIT`（它们会立即重置/销毁）？

以下是用于说明的场景：

(A) 两个应用程序，一个客户端和一个服务器，都在同一台 Windows 机器上运行。客户端通过服务器的loopback接口（127.0.0.1，端口xxxx）连接服务器，发送数据，接收数据，关闭socket（`SO_DONTLINGER`设置）。

假设连接*非常*短暂，因此客户端应用程序每秒都在建立和销毁大量连接。最终结果是套接字最终在 中`TIME_WAIT`，并且客户端最终耗尽了它的最大套接字数（在 Windows 上，默认情况下约为 3900，我们假设此值不会在注册表中更改）。

(B) 与场景 (A) 相同的两个应用程序，但服务器在不同的主机上（客户端仍在 Windows 上运行）。这些连接在各方面都是相同的，只是它们的目的地不是 127.0.0.1，而是其他一些 IP。这里客户端机器上的连接不会进入`TIME_WAIT`，客户端应用程序可以无限期地继续建立连接。

为什么会出现差异？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-21T19:12:27.483

TIME_WAIT 状态只发生在连接的一端——首先关闭的一端。对于环回接口，两端都在同一台机器上，因此您将始终看到 TIME_WAIT。

在您的其他情况下，请尝试查看另一台机器。我想你会在那里看到 TIME_WAIT 套接字。

# asp.net - ASP.NET 2.0 中的 Gridview 列宽

> ID：309815
> 
> 赞同：8
> 
> 时间：2008-11-21T19:04:32.617
> 
> 标签：asp.net, gridview

如何在 ASP.NET 2.0 中控制 gridview 控件的列宽？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-13T14:31:24.023

You can use the HeaderStyle-Width, ItemStyle-Width or FooterStyle-Width properties. These can be applied to all the columns or per-column basis.

```
 <asp:GridView ID="GridView1" runat="server">
        <HeaderStyle Width="10%" />
        <RowStyle Width="10%" />
        <FooterStyle Width="10%" />
        <Columns>
            <asp:BoundField HeaderText="Name" DataField="LastName" 
                HeaderStyle-Width="10%" ItemStyle-Width="10%"
                FooterStyle-Width="10%" />
        </Columns>
    </asp:GridView> 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-21T19:19:27.687

我使用列的标题样式来做到这一点：

```
<asp:BoundField HeaderText="Name" DataField="LastName">
   <HeaderStyle Width="20em" />
</asp:BoundField> 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2012-02-09T16:56:34.770

这是以编程方式执行此操作的 C# 代码：

```
columnName.ItemStyle.Width = Unit.Percentage(someDouble); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-08-09T11:45:29.767

```
Gridview.Columns[1].ItemStyle.Width = 100; 
```

这将以像素为单位设置。

# c++ - 帕斯卡风格铁路图

> ID：309816
> 
> 赞同：1
> 
> 时间：2008-11-21T19:04:41.117
> 
> 标签：c++, syntax, pascal

在哪里可以找到描述 C++ 语法的帕斯卡风格铁路图？（作为 EBNF 的替代品）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-21T19:17:00.173

不存在，据我所知。C++ 语法甚至不能用正确的 EBNF 表达——它是一种上下文相关的语法，任何试图解析它的东西都必须能够处理 C++ 代码，至少就模板实例化和重载解析而言（更不用说宏了） ）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-19T15:11:51.837

我不知道 C++ 图是否有一些铁路图（我不太重视这些图像），但将 EBNF 转换为这些图是一项纯粹的机械工作。

关于 C++ 的语法：如果看 C++ 标准附录中的语法，那就是**上下文无关**语法。这种文法的问题在于它是一种**模棱两可**的文法。另一件事是，语法接受不是有效 C++ 程序的字符串——但对于每一种带有变量声明的类型化语言来说都是如此。如果语法是**undecidable**，则意味着您无法判断某个字符串是否是根据语法生成的。顺便说一句，给定的 C++ 文件是否编译确实是一个无法确定的问题，因为模板是图灵完备的。

这种模棱两可的语法不受欢迎的原因是它使解析器更复杂、更慢和/或需要更多内存。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-21T19:21:33.237

没有一个——C++ 语法不仅**不是**上下文无关的，而且是不可判定的。看[http://yosefk.com/c++fqa/defective.html#defect-2](http://yosefk.com/c++fqa/defective.html#defect-2)和相关链接进行更深入的讨论。

# mysql - MySQL：当日期在字符串中时，如何请求大于今天的日期

> ID：309818
> 
> 赞同：1
> 
> 时间：2008-11-21T19:05:10.167
> 
> 标签：mysql, sql-server

我正在尝试将信息从 MySQL 数据库中提取到 MS SQL 数据库中。数据库一团糟，开发人员不再可用。

所有日期都在 char 字段中，我使用

```
SELECT concat( mid(DueDate, 7, 4), mid(DueDate, 4, 2), mid(DueDate, 1, 2)) as DueDate FROM TableName 
```

以某种格式获取日期字段，以便 MS sql 服务器可以导入它们。

现在，我只想导出日期大于今天的记录，所以问题是：

*   MySQL 中 GetDate() 的等价物是什么？
*   有没有更好的方法来确定日期以进行比较？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-21T19:07:14.717

在 MySQL 中，您可以使用[STR_TO_DATE](http://dev.mysql.com/doc/refman/5.0/en/date-and-time-functions.html#function_str-to-date)函数将字符串转换为日期。

一个示例用法是：

```
mysql> SELECT STR_TO_DATE('04/31/2004', '%m/%d/%Y');
        -> '2004-04-31' 
```

要在 MySQL 中获取当前日期，只需使用 NOW() 函数。然后，您可以使用类似的方法检查解析的日期是否晚于今天

```
WHERE STR_TO_DATE('04/31/2009', '%m/%d/%Y') > NOW() 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-21T21:51:47.847

MySQL 等价于 getdate() 是 CURDATE()

```
mysql> 选择 IF(CURDATE()<NOW(), 1, 0);
+---------------+
| IF(CURDATE()<NOW(), 1, 0) |
+---------------+
| 1 |
+---------------+
一组中的 1 行（0.00 秒）

mysql> 选择 IF(CURDATE()=NOW(), 1, 0); +---------------+
| IF(CURDATE()=NOW(), 1, 0) |
+---------------+
| 0 |
+---------------+
一组中的 1 行（0.00 秒）

```

# css - CSS 约定/代码布局模型

> ID：309819
> 
> 赞同：24
> 
> 时间：2008-11-21T19:05:15.080
> 
> 标签：css, coding-style, conventions

是否有任何尝试并创建了一种形式化的方法来组织 CSS 代码？在我去制定我自己的保持可读性的策略之前，我想知道还有什么。谷歌并不是很有帮助，因为我不完全确定要搜索哪些术语。

我更多地考虑缩进/间距，何时使用新行，命名约定等。

有任何想法吗？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-11-21T20:22:54.267

ClearLeft 的 Natalie Down 制作了一个非常棒的幻灯片，涵盖了这个主题和更多内容[http://natbat.net/2008/Sep/28/css-systems/](http://natbat.net/2008/Sep/28/css-systems/)

下载 PDF，因为它包含比幻灯片更多的信息。我会向所有技能水平的 CSS 开发人员推荐这个。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-21T20:24:18.960

根据通常的代码格式辩论，这都是非常主观的，我不知道任何正式的约定。

我选择的方法是使用所有小写类和带有下划线分隔单词的 id（`#page_container`例如）。我首先声明我的所有**标签**样式（`html`、`body`、`ul`等），然后是所有类和 ID，按字母顺序排序。此外，每个类、id 或标签中定义的所有样式也是按字母顺序定义的。使用此约定可以更轻松地跟踪特定样式。

对于格式化，我总是将其压缩得尽可能小，但仍然清晰易读。我将所有内容放在一条带有适当空白的行上。如果您有 Visual Studio，则可以指定此格式并自动为您设置这种格式（在*Tools、Options、Text Editor、CSS、Format*下将 Style 设置为**Compact 规则**）。

 *命名约定在这里非常主观，但要记住的是，将元素命名为它们的预期目的，而不是它们的样式含义。例如，如果您有一个公司标语，您想用一个大的红色字体名称设置 id`#slogan`而不是`#red_bold`.

这是一个完整的示例，可以为您提供一个想法：

```
body { background-color: #fff; color: #999; font-family: verdana, arial, helvetica, sans-serif; font-size: 76%; padding: 0; margin: 0; }
a { color: #2c5eb4; text-decoration: none; }
a:hover { text-decoration: underline; }
h1, h2, h3, h4, h5, h6 { color: #f70; font-family: helvetica, verdana, arial, serif; font-weight: bold; margin: 1.2em 0; }
h1 { font-size: 2.4em; line-height: 1.2em;  margin-bottom: 0em; margin-top: 0em; }
h2 { font-size: 1.7em; }
h3 { font-size: 1.4em; }
h4 { font-size: 1.2em; font-weight: bold; }
h5 { font-size: 1.0em; font-weight: bold; }
h6 { font-size: 0.8em; font-weight: bold; }
img { border: 0; }
li, ol, ul { font-size: 1.0em; line-height: 1.8em; list-style-position: inside; margin-bottom: 0.1em; margin-left: 0; margin-top: 0.2em; }
#content { clear: both; margin: 0; margin-top: -4em; }
#columns { height: 36em; }
#column1, #column2, #column3, #column4 { border-right: 1px solid #dbdbdb; float: left; width: 18%; margin: 0 0.5em; padding: 0 1em; height: 100%; }
#column1 { width: 28%; }
#column1 input { float: right; }
#column1 label { color: #999; float: left; }
#column2 a, #column3 a { font-weight: bold; }
#column4 { border-right: 0; }
#form { margin: 0 2em; }
.help_button { float: right; text-align: right; width: 30px; } 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-21T20:34:24.010

这是我如何订购我的 CSS 属性的草稿。它大致遵循先做定位和布局的指导方针，然后是排版，然后是背景和其他小事。我尝试根据它们对盒子模型的影响来尽可能合理地对我的属性进行排序。但是，我的订单往往会有所变化。我很感激对此的任何评论。

```
el {
    display:;
    float:;
    clear:;
    visibility:;
    position:;
    top:;
    right:;
    bottom:;
    left:;
    z-index:;
    width:;
    min-width:;
    height:;
    min-height:;
    overflow:;
    margin:;
    padding:;
    border:;
    border-top:;
    border-right:;
    border-bottom:;
    border-left:;
    border-width:;
    border-top-width:;
    border-right-width:;
    border-bottom-width:;
    border-left-width:;
    border-color:;
    border-top-color:;
    border-right-color:;
    border-bottom-color:;
    border-left-color:;
    border-style:;
    border-top-style:;
    border-right-style:;
    border-bottom-style:;
    border-left-style:;
    border-collapse:;
    border-spacing:;
    outline:;
    list-style:;
    font:;
    font-family:;
    font-size:;
    line-height:;
    font-weight:;
    text-align:;
    text-indent:;
    text-transform:;
    text-decoration:;
    white-space:;
    vertical-align:;
    color:;
    opacity:;
    background:;
    background-color:;
    background-image:;
    background-position:;
    background-repeat:;
    cursor:;
    } 
```

就我个人而言，我更喜欢将每行的一个属性缩进一个制表符，而右花括号缩进一个制表符。对我来说，这种方式更清晰，但这绝对是意见/偏好问题。

我曾经使用 tab 缩进 css 声明以尽可能匹配我的 html 父/子关系，但我不再这样做了。CSSEdit 的分组功能有助于大大减少这样做的诱惑。

CSS 实际上并没有任何规定的代码结构约定。因此，归结为最适合您的方法。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-21T20:15:20.803

好吧，我个人不知道任何约定本身，但我知道有很多建议可以遵循，但基本上取决于你想如何实现你的 CSS 让你选择一个最适合你。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-10-01T18:47:30.627

文件应该是模块化的，所以你可以使用`@import`s. 我通常有一个用于基类（例如排版和颜色）的 base.css 文件。根据您的站点结构，在面向用户的样式表中重用其他 CSS“部分”可能是有利的。这些后代样式表可以根据需要以更细的粒度扩展基本样式（例如，`.warn {color:red;}`可以通过`p.warn {font-style:italic;}`、 或扩展`h1.warn {border:5px solid red;}`），这是实现所谓[的面向对象的 CSS](http://github.com/stubbornella/oocss/wiki)的一种很好的设计模式。

在文件本身中，我喜欢按字母顺序排列我的选择器和属性列表。我尝试为不同类型的选择器维护单独的列表（首先是 id 列表，然后是我的类列表，然后是我的元素选择器列表），但我发现这不必要地困难，所以我所有的选择器都按字母顺序排列列表。这样我就可以快速找到所有复杂选择器的根或赋予简单选择器的任何样式。

在复杂的选择器中，我按字母顺序列出每个选择器。

如果由于某种原因我不能使用 Sass，我可能会模仿它的[嵌套](http://sass-lang.com/tutorial.html#nesting)模式（我仍然不确定这是否可行），如下所示：

```
@import url('/css/base.css');

a {
  color:#369;
  font-family: Helvetica, sans-serif;
  font-weight: bold;
  text-decoration: underscore; }
  a img {
    border: 0; }

blockquote, .nav, p {
  margin-bottom: 10px; }
blockquote {
  background: #eee;
  padding: 10px; }

h1, h2, h3, h4 {
  font-family: Georgia, serif; }
h1.warning {
  border: 5px solid red; }

.nav a {
  font-size: 150%;
  padding: 10px; }
.nav li {
  display: inline-block; }

p.warning {
  font-style: italic; }
  p.warning a {
    background: #fff;
    border-bottom: 2px solid #000;
    padding: 5px; }
  p.warning .keyword {
    text-decoration: underline; } 
```

不幸的是，您可能会寻找边距，`p`却没有意识到它是`blockquote, .nav, p`. 这也不是非常“面向对象”的设计，但可以说它比在几乎每个需要样式的元素上放置类字符串要好。

因此，这种方法并不完美，也不能完全让您免于有时不得不在文件中查找，但当我因无法控制的原因无法使用 CSS 模板工具时，这是我开发的最佳方法。我很想听听有关改进此方法的任何建议:)

# foxpro - 今天维护 Clipper 5.3 代码的最佳方法是什么？

> ID：309825
> 
> 赞同：7
> 
> 时间：2008-11-21T19:07:53.390
> 
> 标签：foxpro, dbase, clipper

在 DOS、Windows 或 Linux 上是否有任何后续产品？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-21T19:18:05.770

有很多可用的 Clipper 编译器：[Harbor](http://www.harbour-project.org/)、[CLIP](http://www.itk.ru/english/index.shtml)和[xHarbour](http://www.xharbour.org/)，仅举几例免费的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-06-28T03:02:58.463

Harbor 99.99% 兼容。您也可以轻松调用 win DLL。我正在保持这种方式，通过编写新的 DLL 添加新功能。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-09-27T05:54:44.483

毫无疑问，要走的路是[Harbour](http://en.wikipedia.org/wiki/Harbour_%28software%29)。不要把时间浪费在像 CLIP 或 xHarbour 这样被放弃的项目上。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-21T22:14:02.750

I've used [CLIP](http://www.itk.ru/english/index.shtml) in Linux... worked awesome. Has a lot of goodies you won't find in Standard DOS CA-Clipper.

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-11-04T21:39:07.897

不！这是最好的方法！转向现代语言（C#、VB.Net、Java、OO Cobol(!)、Python 或 Ruby）。

我更喜欢 C# 和 OO Cobol（www.alchemysolutions.com、www.Veryant.com、www.microfocus.com、www.legacyj.com、www.cobol-it.com、www.ibm.com/cobol）。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-04T14:21:09.263

[FlagShip](http://www.fship.com)是一个支持良好、稳定的 Clipper 编译器，适用于所有风格的 Unix。美国的一些主要零售连锁店仍在使用基于 Clipper 的销售点系统，这些系统已移植到 Linux 上的 FlagShip。它有一些很好的面向对象的扩展和一种非常简单的方法，可以在需要的地方放入内联 C 代码。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-01-02T18:12:30.603

我发现 xHabour 有时可以在打印机上工作，有时不能。这是相当恶化的。所以，我不再使用它了。

我有一个维护和迁移旧的 Clipper 和 Foxpro 应用程序的利基市场。最大的问题，尤其是在 Clipper 中，是第三方库。此类代码不会在 Windows Clipper 编译器中编译，并且 Clipper 应用程序通常不使用多个此类库。有时代码已移植到 Windows，但通常没有。

顺便说一句，当另一家大公司打电话说他们有一个自 1992 年以来在 Clipper 或 FoxDOS 中运行的关键任务应用程序时，我并不感到惊讶，我可以将它迁移到 Windows 中。Clipper 就像 COBOL。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-12T18:50:15.427

甚至不要考虑使用 FlagShip 6。与非常好的 FlagShip 4 相比，它的速度非常慢，但是如果你想拥有一个最新的服务器（更新的 glibc），你必须在 Linux 上使用 FlagShip 6。港湾无疑是现在要走的路！

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-21T21:57:13.750

[CA Visual Objects](http://www.cavo.com/) (VO) is the official successor, however don't expect to just recompile your Clipper 5.3 app into VO. All of the screen interface code will need to be rewritten for a new UI.

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2010-02-23T04:41:47.337

我从未使用过它，但我知道创建[Vulcan.NET](http://www.govulcan.net/portal/)是为了提供从 Clipper/xBase/Visual Objects 到 .NET Framework 的升级路径。也许值得一瞧。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-11-24T04:31:51.923

我还在做 Clipper 5.3 维护编程。它绝不是一种死语言，news:comp.lang.clipper 上有一个充满活力的用户社区（也可以通过[Google Groups](http://groups.google.com.au/group/comp.lang.clipper/topics)访问）。如果你去 xHarbour，在 news:comp.lang.xharbour 有很强的存在感（[同上](http://groups.google.com.au/group/comp.lang.xharbour/topics)）

# sql - 我应该提交还是回滚读取事务？

> ID：309834
> 
> 赞同：102
> 
> 时间：2008-11-21T19:10:27.423
> 
> 标签：sql, database, transactions

我有一个在事务中执行的读取查询，以便我可以指定隔离级别。查询完成后，我该怎么办？

*   提交交易
*   回滚事务
*   什么都不做（这将导致事务在 using 块结束时回滚）

做每一件事的意义是什么？

```
using (IDbConnection connection = ConnectionFactory.CreateConnection())
{
    using (IDbTransaction transaction = connection.BeginTransaction(IsolationLevel.ReadUncommitted))
    {
        using (IDbCommand command = connection.CreateCommand())
        {
            command.Transaction = transaction;
            command.CommandText = "SELECT * FROM SomeTable";
            using (IDataReader reader = command.ExecuteReader())
            {
                // Read the results
            }
        }

        // To commit, or not to commit?
    }
} 
```

编辑：问题不在于是否应该使用事务或者是否有其他方法来设置事务级别。问题是提交或回滚不修改任何内容的事务是否有任何区别。有性能差异吗？它会影响其他连接吗？还有其他区别吗？

* * *

## 回答 #1

> 赞同：54
> 
> 时间：2008-11-21T21:47:08.310

你承诺。时期。没有其他明智的选择。如果您开始交易，您应该关闭它。提交会释放您可能拥有的任何锁，并且对于 ReadUncommitted 或 Serializable 隔离级别同样明智。依赖隐式回滚——虽然在技术上可能是等效的——只是一种糟糕的形式。

如果这还不能说服您，请想象下一个在您的代码中间插入更新语句的人，并且必须跟踪发生的隐式回滚并删除他的数据。

* * *

## 回答 #2

> 赞同：33
> 
> 时间：2008-11-21T19:22:32.377

如果您没有更改任何内容，那么您可以使用 COMMIT 或 ROLLBACK。任何一个都将释放您获得的任何读锁，并且由于您没有进行任何其他更改，因此它们将是等效的。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-11-21T19:17:19.157

如果您开始一个事务，那么最佳实践是始终提交它。如果在你的 use(transaction) 块内抛出异常，事务将自动回滚。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-25T09:33:25.783

恕我直言，将只读查询包装在事务中是有意义的，因为（尤其是在 Java 中）您可以告诉事务是“只读的”，而 JDBC 驱动程序可以考虑优化查询（但不必这样做，所以没有人将阻止您发出`INSERT`尽管如此）。例如，Oracle 驱动程序将完全避免在标记为只读的事务中对查询的表锁定，这在重度读取驱动的应用程序上获得了很多性能。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2017-05-05T14:04:55.803

考虑**嵌套事务**。

大多数 RDBMS 不支持嵌套事务，或者尝试以非常有限的方式模拟它们。

例如，在 MS SQL Server 中，内部事务（不是真正的事务，MS SQL Server 只是计算事务级别！）中的回滚将回滚在**最外层**事务（这是真正的事务）中发生的所有事情。

一些数据库包装器可能会将内部事务中的回滚视为发生错误的标志，并回滚最外面事务中的所有内容，无论最外面的事务是提交还是回滚。

因此，当您不能排除您的组件被某个软件模块使用时，COMMIT 是安全的方法。

请注意，这是对该问题的一般回答。该代码示例通过打开一个新的数据库连接巧妙地解决了外部事务的问题。

关于性能：根据隔离级别，SELECT 可能需要不同程度的 LOCK 和临时数据（快照）。这在事务关闭时被清除。这是通过 COMMIT 还是 ROLLBACK 完成的并不重要。所花费的 CPU 时间可能存在微不足道的差异 - 解析 COMMIT 可能比 ROLLBACK（少两个字符）和其他细微差异更快。显然，这只适用于只读操作！

完全没有要求：另一个可能阅读代码的程序员可能会认为 ROLLBACK 意味着错误条件。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-11-21T19:15:29.520

只是一个旁注，但你也可以这样编写代码：

```
using (IDbConnection connection = ConnectionFactory.CreateConnection())
using (IDbTransaction transaction = connection.BeginTransaction(IsolationLevel.ReadUncommitted))
using (IDbCommand command = connection.CreateCommand())
{
    command.Transaction = transaction;
    command.CommandText = "SELECT * FROM SomeTable";
    using (IDataReader reader = command.ExecuteReader())
    {
        // Do something useful
    }
    // To commit, or not to commit?
} 
```

如果你稍微重新构造一些东西，你也许可以将 IDataReader 的 using 块移动到顶部。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-21T21:45:37.517

如果将 SQL 放入存储过程并将其添加到查询上方：

```
set transaction isolation level read uncommitted 
```

那么您不必跳过 C# 代码中的任何环节。在存储过程中设置事务隔离级别不会导致该设置应用于该连接的所有未来使用（这是您必须担心的其他设置，因为连接是池化的）。在存储过程结束时，它只是回到初始化连接的任何地方。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2015-09-08T10:05:23.433

ROLLBACK 多用于发生错误或异常情况，COMMIT 用于成功完成。

我们应该使用 COMMIT （成功）和 ROLLBACK （失败）关闭事务，即使在似乎无关紧要的只读事务的情况下也是如此。事实上，为了一致性和面向未来，它确实很重要。

一个只读事务在逻辑上可能以多种方式“失败”，例如：

*   查询没有按预期返回准确的一行
*   存储过程引发异常
*   发现提取的数据不一致
*   用户中止事务，因为它花费的时间太长
*   死锁或超时

如果 COMMIT 和 ROLLBACK 被正确用于只读事务，如果在某些时候添加了 DB 写入代码，它将继续按预期工作，例如用于缓存、审计或统计。

隐式 ROLLBACK 应仅用于“致命错误”情况，即应用程序崩溃或退出并出现不可恢复的错误、网络故障、电源故障等。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-21T19:14:01.567

鉴于 READ 不会改变状态，我什么也不做。执行提交不会做任何事情，除了浪费一个周期将请求发送到数据库。您尚未执行更改状态的操作。对于回滚也是如此。

但是，您应该确保清理对象并关闭与数据库的连接。如果重复调用此代码，不关闭连接可能会导致问题。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2017-11-13T06:44:26.217

如果您将 AutoCommit 设置为 false，则为 YES。

在使用 JDBC（Postgresql 驱动程序）的实验中，我发现如果选择查询中断（因为超时），那么除非您回滚，否则您无法启动新的选择查询。

* * *

## 回答 #11

> 赞同：-3
> 
> 时间：2008-11-21T19:15:20.957

您是否需要阻止其他人读取相同的数据？为什么要使用事务？

@Joel - 我的问题最好表述为“为什么在读取查询上使用事务？”

@Stefan - 如果您要使用 AdHoc SQL 而不是存储过程，那么只需在查询中的表之后添加 WITH (NOLOCK)。这样，您就不会在应用程序和数据库中为事务产生开销（尽管很小）。

```
SELECT * FROM SomeTable WITH (NOLOCK) 
```

编辑@评论 3：由于问题标签中有“sqlserver”，我假设 MSSQLServer 是目标产品。现在已经澄清了这一点，我已经编辑了标签以删除特定的产品参考。

我仍然不确定你为什么要首先在读取操作上进行事务。

* * *

## 回答 #12

> 赞同：-3
> 
> 时间：2008-11-21T19:19:25.457

在您的代码示例中，您有

1.  // 做一些有用的事情

    您是否正在执行更改数据的 SQL 语句？

如果没有，则没有“读取”事务之类的东西...只有插入，更新和删除语句（可以更改数据的语句）的更改才在事务中...您在说的是SQL的锁由于影响该数据的其他事务，服务器会放置您正在读取的数据。这些锁的级别取决于 SQL Server 隔离级别。

但是，如果您的 SQL 语句没有更改任何内容，则您不能提交或回滚任何内容。

如果您正在更改数据，那么您可以更改隔离级别而无需显式启动事务......每个单独的 SQL 语句都隐含在事务中。显式启动事务只需要确保 2 个或更多语句在同一个事务中。

如果您只想设置事务隔离级别，那么只需将命令的 CommandText 设置为“设置事务隔离级别可重复读取”（或您想要的任何级别），将 CommandType 设置为 CommandType.Text，然后执行命令。（您可以使用 Command.ExecuteNonQuery() ）

注意：如果您正在执行 MULTIPLE 读取语句，并希望它们都“看到”与第一个语句相同的数据库状态，那么您需要将隔离级别设置为可重复读取或可序列化...

# nhibernate - 映射具有多个包含相同对象类型的集合属性的类

> ID：309850
> 
> 赞同：1
> 
> 时间：2008-11-21T19:16:26.243
> 
> 标签：nhibernate, nhibernate-mapping

我们的系统会生成包含用户选择的收件人/抄送/密送联系人列表的电子邮件。我想将它们按如下方式存储在我们的 SQL Server 数据库中，这是简化的数据库表结构：

```
CREATE TABLE [Contact] (
    [ContactID] [int] IDENTITY (1, 1) NOT NULL,
    [Name] [varchar] (100) NOT NULL,
    [EmailAddress] [varchar] (100) NOT NULL,
    CONSTRAINT [PK_Contact] PRIMARY KEY CLUSTERED ([ContactID])
)

CREATE TABLE [Email] (
    [EmailID] [int] IDENTITY (1, 1) NOT NULL,
    [Subject] [varchar] (500) NOT NULL,
    [Message] [text] NULL,
    [DateSent] [datetime] NOT NULL,
    CONSTRAINT [PK_Email] PRIMARY KEY CLUSTERED ([EmailID])
)

CREATE TABLE [EmailContact] (
    [EmailID] [int] NOT NULL,
    [ContactID] [int] NOT NULL,
    [Type] [varchar] (4) NOT NULL,
    CONSTRAINT [PK_EmailContactList] PRIMARY KEY CLUSTERED 
    (
        [EmailID],
        [ContactID],
        [Type]
    ),
    CONSTRAINT [FK_EmailContact_Contact] FOREIGN KEY ([ContactID]) REFERENCES [Contact] ([ContactID]),
    CONSTRAINT [FK_EmailContact_Email] FOREIGN KEY ([EmailID]) REFERENCES [Email] ([EmailID])
) 
```

对我来说，这看起来像是电子邮件和联系人对象之间的多对多关系。但是，我希望电子邮件域对象为每个列表的联系人（收件人/抄送/密送）具有 3 个单独的 IList 属性，这样我就可以启用以下代码：

```
testEmail.ToContacts.Add(contact1)
testEmail.CCContacts.Add(contact2)
testEmail.BCCContacts.Add(contact3) 
```

这可以在不添加额外的域对象（EmailContact）的情况下完成吗？我是否需要将两个多对一关系与像[Billy McCafferty 提到](http://devlicio.us/blogs/billy_mccafferty/archive/2008/07/11/when-to-use-many-to-one-s-vs-many-to-many-with-nhibernate.aspx)的其他域对象一起使用？

另外，我将如何表示我的 NHibernate 映射文件？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-21T19:29:44.360

根据您引用的 Billy McCafferty 的文章：

> 乍一看，这可能意味着您必须在域模型中创建一个 CustomerAddress 对象以在数据库中反映此关系表；NHibernate 并非如此。相反，您只需向 Customer.hbm.xml 添加一个多对多关联，这表明应该将 CustomerAddresses 表用作管理这种多对多关系的查找。

用您的“EmailContacts”替换 McCafferty 的“CustomerAddresses”示例。根据文章，您将需要一个“EmailContacts”*表*来表示电子邮件和联系人之间的多对多关系，而不是`EmailContacts`域对象。如果您需要 To、CC 和 BCC 三个单独的关系，请创建三个连接表：`To_EmailAddresses`、`CC_EmailAddresses`和`BCC_EmailAddresses`。

我对 NHibernate 并不完全熟悉，因此我不确切知道如何更新映射文件，但文章指出与您的电子邮件域对象 (Email.hbm.xml) 相关的文件将是要更新的文件。NHibernate 文档应该告诉您如何在映射文件中表示多对多关系。

# algorithm - 在没有单一权威集合可供参考的情况下，跟踪一组对象大小的优雅方法是什么？

> ID：309852
> 
> 赞同：1
> 
> 时间：2008-11-21T19:16:56.943
> 
> 标签：algorithm, computer-science, design-principles

**更新：请在设计原则、优雅、意图表达的背景下阅读此问题，尤其是通过设计选择发送给其他程序员的“信号”。**

我有一组对象的两个“视图”。一种是通过字符串值索引对象的字典/地图。另一个是按序数（排序整数）索引对象的字典/地图。没有对象的“主”集合本身可以作为对象数量的权威来源，但是两个字典都应该始终包含对所有对象的引用。

当一个新项目被添加到集合中时，一个引用被添加到两个字典中，然后需要进行一些受新对象总数影响的处理。

我应该使用什么作为权威来源来参考对象集的当前大小？似乎我所有的选择在一个维度上都存在缺陷。我可以始终如一地参考其中一本词典，但这将暗示该词典优于另一本。我可以添加第三个集合，一个简单的对象列表作为权威列表，但这会增加冗余。存储运行计数似乎最简单，但也增加了冗余，并且比动态引用集合的自跟踪计数更脆弱。

是否有其他选择可以让我避免选择较小的邪恶，或者我必须接受优雅的妥协？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-21T19:32:42.107

我建议封装：创建一个隐藏“管理”细节（例如当前计数）的类，并使用它来公开两个集合的不可变“视图”。

客户将向“manglement”对象询问对其中一个集合的适当引用。

向集合添加“术语”（因为没有更好的词）的客户端将通过“manglement”对象来完成。

这样，您的假设和实现选择对服务的客户端“隐藏”，并且您可以记录大小/计数的集合选择是任意的。未来的维护者可以在不破坏客户端的情况下更改计数的管理方式。

顺便说一句，是的，我的意思是“manglement”——我最喜欢的管理不当（在任何情况下！）

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-21T19:58:54.393

我将创建一个具有（至少）两个集合的类。

*   按字符串排序的集合版本
*   按序号排序的集合版本
*   （可选）主集合

该课程将处理细节管理：

*   集合内容的同步
*   标准收集操作（例如，允许用户获取大小、添加或检索项目）
*   让用户按字符串或序数获取

这样，您可以在需要任何一种行为的任何地方使用相同的集合，但仍然抽象出您想要的“索引”行为。

单独的类为您提供了一个接口，用于解释您对如何使用该类的意图。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-21T19:27:10.620

如果两个字典都包含对每个对象的引用，那么它们的计数应该相同，对吗？如果是这样，只需选择一个并保持一致。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-21T19:33:33.120

我不认为这有什么大不了的。每次需要访问它们时，只需以相同的顺序引用它们。

如果你真的担心它，你可以用一个暴露公共接口的包装器来封装集合——比如

*   添加项目）
*   数数（）

这样，它将始终是一致的和原子的——或者至少你可以这样实现它。

但是，我不认为这有什么大不了的。

# asp.net - WebResource.axd 上的“填充无效且无法删除”异常

> ID：309859
> 
> 赞同：30
> 
> 时间：2008-11-21T19:18:05.787
> 
> 标签：asp.net, viewstate, webresource.axd

我有一个在我们本地环境中运行良好的 ASP.NET 2.0 应用程序。当发布到测试服务器时，我们在服务器上遇到间歇性错误。

这是最常见的：

填充无效且无法移除。说明：执行当前 Web 请求期间发生未处理的异常。请查看堆栈跟踪以获取有关错误及其源自代码的位置的更多信息。

> 异常详细信息：System.Security.Cryptography.CryptographicException： **填充无效且无法删除。**
> 
> 源错误：
> 
> 在执行当前 Web 请求期间生成了未处理的异常。可以使用下面的异常堆栈跟踪来识别有关异常起源和位置的信息。
> 
> 堆栈跟踪：
> 
> [CryptographicException：填充无效且无法删除。]
> System.Security.Cryptography.RijndaelManagedTransform.DecryptData(Byte[] inputBuffer, Int32 inputOffset, Int32 inputCount, Byte[]& outputBuffer, Int32 outputOffset, PaddingMode paddingMode, Boolean fLast) +1545747
> System.Security.Cryptography.RijndaelManagedTransform.TransformFinalBlock(Byte[] inputBuffer, Int32 inputOffset, Int32 inputCount) +257
> System.Security.Cryptography.CryptoStream.FlushFinalBlock() +30 System.Web.Configuration.MachineKeySection.EncryptOrDecryptData(Boolean fEncrypt, Byte [] buf, Byte[] 修饰符, Int32 开始, Int32 长度, Boolean useValidationSymAlgo) +164
> System.Web.UI.Page.DecryptString(String s) +83
> System.Web.Handlers.AssemblyResourceLoader.System.Web.IHttpHandler.ProcessRequest(HttpContext context) +148
> System.Web.CallHandlerExecutionStep.System.Web.HttpApplication.IExecutionStep.Execute() +358 System.Web.HttpApplication.ExecuteStep(IExecutionStep 步骤, Boolean & completedSynchronously) +64

这发生在对特定 WebResource.axd 请求的请求上。

我们看到的另一个错误是：

> **视图状态 MAC 验证失败。如果此应用程序由 Web Farm 或集群托管，请确保配置指定相同的 validationKey 和验证算法。AutoGenerate 不能在集群中使用。**说明：执行当前 Web 请求期间发生未处理的异常。请查看堆栈跟踪以获取有关错误及其源自代码的位置的更多信息。
> 
> 异常详细信息：System.Web.HttpException：视图状态 MAC 验证失败。如果此应用程序由 Web Farm 或集群托管，请确保配置指定相同的 validationKey 和验证算法。AutoGenerate 不能在集群中使用。

发布表单时偶尔会发生此错误。

现在，在您介入并告诉我此错误的明显（通常）答案之前，请考虑一下：

*   应用程序部署到 IIS6 上的 Windows Server 2003
*   它不在网络场上。这里只使用了一个网络服务器。
*   应用程序池标识是一个自定义服务帐户，我确实`aspnet_regiss -ga <username>`在服务器上运行。没有效果。

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-03-06T07:31:26.517

该错误是因为您的 appdomain 已被回收/重新启动。当发生这种情况时，应用程序和机器密钥设置为自动，它会改变。这会影响资源 url (.axd) 的 url 中信息的解密。设置一个固定的机器密钥将防止它再次发生。

请检查此以获取有关类似案例的更多信息（解释与视图状态验证问题有关，但原因相同）： http: [//www.developmentnow.com/blog/InvalidViewstate+Or+Unable+To+验证+数据+错误.aspx](http://www.developmentnow.com/blog/InvalidViewstate+Or+Unable+To+Validate+Data+Error.aspx)

我也想了很久。在我看到这个问题后，它又让我想到了：[这是企图破坏我的 ASP.Net 站点的安全性吗？](https://stackoverflow.com/questions/617782/is-this-an-attempt-to-break-my-asp-net-sites-security/617940#617940)...我刚刚回答的非常相似。我有一种感觉，它是在重新启动某些东西，因为当我们发布了一些回收应用程序的东西时，日志中显示了错误，但我没有任何其他来源说明它的关系（今天我在 invalidviewstate 上发现了这种情况，因为机器键更改:))

附言。上面终于在单个服务器上解释了它:)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-21T19:34:30.183

当页面在浏览器中完全加载之前生成帖子时会出现此问题。看看[这个](https://stackoverflow.com/questions/121579/im-getting-a-strange-unhandled-exception-from-my-aspnet-application-validation)问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-21T22:37:09.833

本，

对于您的第一个问题，我发现这似乎更符合您所看到的问题，因为问题是偶尔发生的。您应该可以在[http://www.codeproject.com/KB/security/Cryptor.aspx#aes](http://www.codeproject.com/KB/security/Cryptor.aspx#aes)找到对此的完整解释。

您真正需要做的是将 RijndaelAlg.Padding 设置为 PaddingMode.ISO10126、PaddingMode.PKCS7 或 PaddingMode.ANSIX923。如果在加密和解密时使用相同的值，这 3 个值中的任何一个都应该起作用。其他值适用于某些数据，但不适用于所有数据。上面的 URL 解释了原因。

我不明白的是微软提供有时不起作用的选项的原因，或者至少为什么它们不默认为可靠选项的原因。

# iphone - OpenGL ES 中的自定义视图转换

> ID：309880
> 
> 赞同：9
> 
> 时间：2008-11-21T19:24:47.113
> 
> 标签：iphone, animation, opengl-es

我正在尝试创建一个自定义转换，以替代您将在此处获得的默认转换，例如：

```
[self.navigationController pushViewController:someController animated:YES]; 
```

我准备了一个基于 OpenGL 的视图，它对映射到平面的一些静态纹理执行效果（假设它是核心动画中翻转效果的副本）。我不知道该怎么做是：

*   抓取当前视图内容并从中制作纹理（我记得看到一个功能可以做到这一点，但找不到它）
*   如何对当前不在屏幕上并将替换当前视图的视图执行相同的操作
*   是否有一些我可以连接的 API 以使我的转换类尽可能地原生（使其成为一种核心动画效果）？

非常感谢任何想法或链接！

**更新**

Jeffrey Forbes 的答案非常适合作为捕获视图内容的解决方案。

我还没有弄清楚的是如何捕获我想要转换到的视图的内容，在转换完成之前应该是不可见的。

另外，我应该使用哪种方法来呈现 OpenGL 视图？出于演示目的，我使用了 pushViewController。但是，这会影响导航栏，我实际上想用动画返回一个项目，请查看此视频以获取解释：

[http://vimeo.com/4649397](http://vimeo.com/4649397)。

另一种选择是使用 presentViewController，但会显示全屏。您认为创建另一个窗口（或视图？）可能有用吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-23T04:16:56.103

虽然我不能完全回答你的问题，但我自己也要做一些研究，但我可以提供一些帮助：

- 为了获得 UINavigationController 的视图，您需要截取屏幕截图。最简单的方法是将其抓取到 UIImage 中：

```
UIGraphicsBeginImageContext(self.view.frame.size);
[[self.view layer] renderInContext:UIGraphicsGetCurrentContext()];
UIImage* test = UIGraphicsGetImageFromCurrentImageContext();
UIImageView* view = [[UIImageView alloc] initWithImage:test];
UIGraphicsEndImageContext(); 
```

我不确定您是否可以将 GLContext（在手机上不熟悉）渲染为 CGImage，但我会做类似的事情（并从中初始化 UIImage）。我会预先渲染您尝试执行的动画的每一帧，并使用其中提供的动画内容将其拍成 UIImageView。也就是说，如果您的动画足够简单。否则，它可能归结为编写自己的动画函数：-/

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-03-01T07:50:40.260

我刚刚组合了一个过渡类来在 OpenGL ES 中实现你自己的过渡动画。

随意在[这里阅读](http://memention.com/blog/2010/02/28/Bells-and-Whistles.html)

项目中有两个示例转换，请随意添加您自己的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-18T08:30:30.833

我认为您可能正在考虑的功能是[http://www.opengl.org/sdk/docs/man/xhtml/glCopyTexImage2D.xml](http://www.opengl.org/sdk/docs/man/xhtml/glCopyTexImage2D.xml) ...您将视口设置为纹理大小，然后像往常一样绘制，然后执行glCopyTexImage2D 将场景复制到纹理上。

或者您应该查看 FrameBuffer 对象。XCode 中的默认 OpenGL 模板使用这些。只需生成示例项目即可查看它们是如何工作的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2015-01-11T08:23:31.157

我最近在像你这样的视图控制器之间写了一些过渡动画。如果您想从不可见视图中获取任何额外信息，您可以尝试像这样延迟过渡：

```
- (void)animationFromModalView:(UIView *)modalView toMasterView:(UIView *)masterView
{

[masterView setNeedsLayout];
[masterView layoutIfNeeded];

[self performSelector:@selector(delayAnimationFromModalViewToMasterView) withObject:nil afterDelay:.1f];
} 
```

# c# - Castle ActiveRecord 类有哪些自动代码生成工具？

> ID：309882
> 
> 赞同：2
> 
> 时间：2008-11-21T19:25:01.530
> 
> 标签：c#, .net, orm, code-generation, castle-activerecord

如果我有一个现有的数据库，我希望能够基于 db 模式自动生成相应的 Castle ActiveRecord C# 类。我的主要目的是避免手动创建每个类。对于带有可以专门为 Castle ActiveRecord 执行此操作的模板的代码生成工具，我有哪些选择？

（注意：这个问题通常与 codegen 工具无关。我正在寻找特定于 Castle ActiveRecord 的工具，或者已经为 ActiveRecord 编写了 codegen 模板。）

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-21T19:33:56.020

那么有[http://using.castleproject.org/display/Contrib/ActiveWriter](http://using.castleproject.org/display/Contrib/ActiveWriter)和[http://www.mygenerationsoftware.com/](http://www.mygenerationsoftware.com/) 两者都是免费的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-06-17T08:25:44.220

这是为 Castle ActiveRecord 编写的： [http ://roytate.blogspot.com/2007/07/castle-active-record-code-generator.html](http://roytate.blogspot.com/2007/07/castle-active-record-code-generator.html)

# language-agnostic - 代码高尔夫：数字到单词

> ID：309884
> 
> 赞同：39
> 
> 时间：2008-11-21T19:25:39.330
> 
> 标签：language-agnostic, nlp, code-golf, rosetta-stone

代码高尔夫系列似乎相当流行。我遇到了一些将数字转换为单词表示的代码。一些例子是（编程乐趣的 2 的幂）：

*   2 -> 两个
*   1024 -> 一千二十四
*   1048576 -> 一百万四万八千五百七十六

我的同事提出的算法将近两百行。似乎会有更简洁的方法来做到这一点。

当前指南：

*   欢迎以任何**编程**语言提交（我向 PhiLho 道歉，因为最初在这方面缺乏明确性）
*   最大输入为 2^64（有关单词，请参见以下链接，感谢 mmeyers）
*   [首选英文输出的小规模](http://en.wikipedia.org/wiki/Long_and_short_scales)，但欢迎任何算法。只需与编程语言一起评论所使用的方法即可。

* * *

## 回答 #1

> 赞同：70
> 
> 时间：2008-11-22T15:40:37.207

好的，我认为现在是我自己在 Windows BATCH 脚本中实现的时候了（应该在 Windows 2000 或更高版本上工作）。

这是代码：

```
@echo off

set zero_to_nineteen=Zero One Two Three Four Five Six Seven Eight Nine Ten Eleven Twelve Thirteen Fourteen Fifteen Sixteen Seventeen Eighteen Nineteen
set twenty_to_ninety=ignore ignore Twenty Thirty Forty Fifty Sixty Seventy Eighty Ninety
set big_numbers=ignore Thousand Million Billion Trillion Quadrillion Quintillion Sextillion Septillion Octillion Nonillion Decillion Undecillion Duodecillion Tredecillion Quattuordecillion Quindecillion Sexdecillion Septendecillion Octodecillion Novemdecillion Vigintillion
rem             10^0   10^3     10^6    10^9    10^12    10^15       10^18       10^21      10^24      10^27     10^30     10^33     10^36       10^39        10^42        10^45             10^48         10^51        10^54           10^57         10^60          10^63

call :parse_numbers %*

exit /B 0

:parse_numbers
    :parse_numbers_loop
        if "$%~1" == "$" goto parse_numbers_end
        call :parse_number %~1
        echo %~1 -^> %parse_number_result%
        shift
        goto parse_numbers_loop
    :parse_numbers_end
    exit /B 0

:parse_number
    call :get_sign %~1
    set number_sign=%get_sign_result%
    call :remove_groups %get_sign_result_number%
    call :trim_leading_zeros %remove_groups_result%
    set number=%trim_leading_zeros_result%
    if "$%number%" == "$0" (
        set parse_number_result=Zero
        exit /B 0
    )
    set counter=0
    set parse_number_result=
    :parse_number_loop
        set last_three=%number:~-3%
        set number=%number:~0,-3%
        call :parse_three %last_three%
        call :get_from %counter% %big_numbers%
        if "$%get_from_result%" == "$" (
            set parse_number_result=* ERR: the number is too big! Even wikipedia doesn't know how it's called!
            exit /B 0
        )
        if not "$%parse_three_result%" == "$Zero" (
            if %counter% == 0 (
                set parse_number_result=%parse_three_result%
            ) else (
                if not "$%parse_number_result%" == "$" (
                    set parse_number_result=%parse_three_result% %get_from_result% %parse_number_result%
                ) else (
                    set parse_number_result=%parse_three_result% %get_from_result%
                )
            )
        )
        set /A counter+=1
        if not "$%number%" == "$" goto parse_number_loop
    if "$%parse_number_result%" == "$" (
        set parse_number_result=Zero
        exit /B 0
    ) else if not "$%number_sign%" == "$" (
        set parse_number_result=%number_sign% %parse_number_result%
    )
    exit /B 0

:parse_three
    call :trim_leading_zeros %~1
    set three=%trim_leading_zeros_result%
    set /A three=%three% %% 1000
    set /A two=%three% %% 100
    call :parse_two %two%
    set parse_three_result=
    set /A digit=%three% / 100
    if not "$%digit%" == "$0" (
        call :get_from %digit% %zero_to_nineteen%
    )
    if not "$%digit%" == "$0" (
        if not "$%get_from_result%" == "$Zero" (
            set parse_three_result=%get_from_result% Hundred
        )
    )
    if "$%parse_two_result%" == "$Zero" (
        if "$%parse_three_result%" == "$" (
            set parse_three_result=Zero
        )
    ) else (
        if "$%parse_three_result%" == "$" (
            set parse_three_result=%parse_two_result%
        ) else (
            set parse_three_result=%parse_three_result% %parse_two_result%
        )
    )
    exit /B 0

:parse_two
    call :trim_leading_zeros %~1
    set two=%trim_leading_zeros_result%
    set /A two=%two% %% 100
    call :get_from %two% %zero_to_nineteen%
    if not "$%get_from_result%" == "$" (
        set parse_two_result=%get_from_result%
        goto parse_two_20_end
    )
    set /A digit=%two% %% 10
    call :get_from %digit% %zero_to_nineteen%
    set parse_two_result=%get_from_result%
    set /A digit=%two% / 10
    call :get_from %digit% %twenty_to_ninety%
    if not "$%parse_two_result%" == "$Zero" (
        set parse_two_result=%get_from_result% %parse_two_result%
    ) else (
        set parse_two_result=%get_from_result%
    )
    goto parse_two_20_end
    :parse_two_20_end
    exit /B 0

:get_from
    call :trim_leading_zeros %~1
    set idx=%trim_leading_zeros_result%
    set /A idx=0+%~1
    shift
    :get_from_loop
        if "$%idx%" == "$0" goto get_from_loop_end
        set /A idx-=1
        shift
        goto get_from_loop
    :get_from_loop_end
    set get_from_result=%~1
    exit /B 0

:trim_leading_zeros
    set str=%~1
    set trim_leading_zeros_result=
    :trim_leading_zeros_loop
        if not "$%str:~0,1%" == "$0" (
            set trim_leading_zeros_result=%trim_leading_zeros_result%%str%
            exit /B 0
        )
        set str=%str:~1%
        if not "$%str%" == "$" goto trim_leading_zeros_loop
    if "$%trim_leading_zeros_result%" == "$" set trim_leading_zeros_result=0
    exit /B 0

:get_sign
    set str=%~1
    set sign=%str:~0,1%
    set get_sign_result=
    if "$%sign%" == "$-" (
        set get_sign_result=Minus
        set get_sign_result_number=%str:~1%
    ) else if "$%sign%" == "$+" (
        set get_sign_result_number=%str:~1%
    ) else (
        set get_sign_result_number=%str%
    )
    exit /B 0

:remove_groups
    set str=%~1
    set remove_groups_result=%str:'=%
    exit /B 0 
```

这是我使用的测试脚本：

```
@echo off
rem 10^x:x= 66  63  60  57  54  51  48  45  42  39  36  33  30  27  24  21  18  15  12   9   6   3   0
call number                                                                                          0
call number                                                                                          2
call number                                                                                        -17
call number                                                                                         30
call number                                                                                         48
call number                                                                                       -256
call number                                                                                        500
call number                                                                                        874
call number                                                                                      1'024
call number                                                                                    -17'001
call number                                                                                    999'999
call number                                                                                  1'048'576
call number                                                                         -1'000'001'000'000
call number                                                                    912'345'014'587'957'003
call number                                                       -999'912'345'014'587'124'337'999'999
call number                                        111'222'333'444'555'666'777'888'999'000'000'000'001
call number                               -912'345'014'587'912'345'014'587'124'912'345'014'587'124'337
call number    999'999'999'999'999'999'999'999'999'999'999'999'999'999'999'999'999'999'999'999'999'999
call number  1'000'000'000'000'000'000'000'000'000'000'000'000'000'000'000'000'000'000'000'000'000'000
rem 10^x:x= 66  63  60  57  54  51  48  45  42  39  36  33  30  27  24  21  18  15  12   9   6   3   0 
```

这是我从测试脚本中得到的输出：

```
0 -> Zero
2 -> Two
-17 -> Minus Seventeen
30 -> Thirty
48 -> Forty Eight
-256 -> Minus Two Hundred Fifty Six
500 -> Five Hundred
874 -> Eight Hundred Seventy Four
1'024 -> One Thousand Twenty Four
-17'001 -> Minus Seventeen Thousand One
999'999 -> Nine Hundred Ninety Nine Thousand Nine Hundred Ninety Nine
1'048'576 -> One Million Forty Eight Thousand Five Hundred Seventy Six
-1'000'001'000'000 -> Minus One Trillion One Million
912'345'014'587'957'003 -> Nine Hundred Twelve Quadrillion Three Hundred Forty Five Trillion Fourteen Billion Five Hundred Eighty Seven Million Nine Hundred Fifty Seven Thousand Three
-999'912'345'014'587'124'337'999'999 -> Minus Nine Hundred Ninety Nine Septillion Nine Hundred Twelve Sextillion Three Hundred Forty Five Quintillion Fourteen Quadrillion Five Hundred Eighty Seven Trillion One Hundred Twenty Four Billion Three Hundred Thirty Seven Million Nine Hundred Ninety Nine Thousand Nine Hundred Ninety Nine
111'222'333'444'555'666'777'888'999'000'000'000'001 -> One Hundred Eleven Undecillion Two Hundred Twenty Two Decillion Three Hundred Thirty Three Nonillion Four Hundred Forty Four Octillion Five Hundred Fifty Five Septillion Six Hundred Sixty Six Sextillion Seven Hundred Seventy Seven Quintillion Eight Hundred Eighty Eight Quadrillion Nine Hundred Ninety Nine Trillion One
-912'345'014'587'912'345'014'587'124'912'345'014'587'124'337 -> Minus Nine Hundred Twelve Tredecillion Three Hundred Forty Five Duodecillion Fourteen Undecillion Five Hundred Eighty Seven Decillion Nine Hundred Twelve Nonillion Three Hundred Forty Five Octillion Fourteen Septillion Five Hundred Eighty Seven Sextillion One Hundred Twenty Four Quintillion Nine Hundred Twelve Quadrillion Three Hundred Forty Five Trillion Fourteen Billion Five Hundred Eighty Seven Million One Hundred Twenty Four Thousand Three Hundred Thirty Seven
999'999'999'999'999'999'999'999'999'999'999'999'999'999'999'999'999'999'999'999'999'999 -> Nine Hundred Ninety Nine Vigintillion Nine Hundred Ninety Nine Novemdecillion Nine Hundred Ninety Nine Octodecillion Nine Hundred Ninety Nine Septendecillion Nine Hundred Ninety Nine Sexdecillion Nine Hundred Ninety Nine Quindecillion Nine Hundred Ninety Nine Quattuordecillion Nine Hundred Ninety Nine Tredecillion Nine Hundred Ninety Nine Duodecillion Nine Hundred Ninety Nine Undecillion Nine Hundred Ninety Nine Decillion Nine Hundred Ninety Nine Nonillion Nine Hundred Ninety Nine Octillion Nine Hundred Ninety Nine Septillion Nine Hundred Ninety Nine Sextillion Nine Hundred Ninety Nine Quintillion Nine Hundred Ninety Nine Quadrillion Nine Hundred Ninety Nine Trillion Nine Hundred Ninety Nine Billion Nine Hundred Ninety Nine Million Nine Hundred Ninety Nine Thousand Nine Hundred Ninety Nine
1'000'000'000'000'000'000'000'000'000'000'000'000'000'000'000'000'000'000'000'000'000'000 -> * ERR: the number is too big! Even wikipedia doesn't know how it's called! 
```

如果我能找到更多[的大数字名称](http://en.wikipedia.org/wiki/Names_of_large_numbers)，该脚本将支持更大的数字。但目前，该脚本将适用于从 -(10^66-1) 到 (10^66-1) 的所有数字。

我不得不提一下，我在 BATCH 中解决这个问题很有趣。:)

* * *

## 回答 #2

> 赞同：45
> 
> 时间：2009-01-03T07:57:26.797

**C# - 30 行，包括。方法声明和 { }s**：

考虑到前面提到的所有逗号、ands 和连字符。我只包括了 octillion，因为 decimal.MaxValue 仅在 octillions 中。对于更大的整数，您需要将相应的项目添加到 thou[] 数组中，并可能将数字作为字符串传递，通过使用最后 3 个字符而不是像我在这里使用模数来修改行以提取块。

```
 static string wordify(decimal v)
    {
        if (v == 0) return "zero";
        var units = " one two three four five six seven eight nine".Split();
        var teens = " eleven twelve thir# four# fif# six# seven# eigh# nine#".Replace("#", "teen").Split();
        var tens = " ten twenty thirty forty fifty sixty seventy eighty ninety".Split();
        var thou = " thousand m# b# tr# quadr# quint# sext# sept# oct#".Replace("#", "illion").Split();
        var g = (v < 0) ? "minus " : "";
        var w = "";
        var p = 0;
        v = Math.Abs(v);
        while (v > 0)
        {
            int b = (int)(v % 1000);
            if (b > 0)
            {
                var h = (b / 100);
                var t = (b - h * 100) / 10;
                var u = (b - h * 100 - t * 10);
                var s = ((h > 0) ? units[h] + " hundred" + ((t > 0 | u > 0) ? " and " : "") : "")
                      + ((t > 0) ? (t == 1 && u > 0) ? teens[u] : tens[t] + ((u > 0) ? "-" : "") : "")
                      + ((t != 1) ? units[u] : "");
                s = (((v > 1000) && (h == 0) && (p == 0)) ? " and " : (v > 1000) ? ", " : "") + s;
                w = s + " " + thou[p] + w;
            }
            v = v / 1000;
            p++;
        }
        return g + w;
    } 
```

调用使用：

```
static void Main(string[] args)
{
  Console.WriteLine(wordify(decimal.MaxValue));
} 
```

输出：

> 七十九亿、二百二十八亿、一百六十二亿、五百一十四亿、两百六十四亿、三百三十七万亿、五千九百三十亿，五亿四千三百万，九十五万，三百三十五

* * *

## 回答 #3

> 赞同：40
> 
> 时间：2009-05-14T10:31:27.977

在[A86](http://eji.com/a86/)汇编器中 - 汇编为 .COM 可执行文件：

```
dd 0ba02c6bfh, 0b8bd10c1h, 0e808b512h, 0ea870100h, 08700e9e8h, 010273eah
dd 0e0e8c2h, 06b51872h, 0c000ebe8h, 0b3c02e8h, 03368067dh, 0b2e901h
dd 0baaa5004h, 0fd8110c1h, 0cd7c1630h, 0bf3031bbh, 0a0571000h, 0ec880080h
dd 0c581c589h, 023c0081h, 0e7f087ch, 0823e38h, 027b00875h, 0e901d068h
dd 0b6400080h, 04f6f603h, 080d08a1ch, 0b60f80c4h, 07f06c7f4h, 088303000h
dd 0ac00813eh, 087ef828h, 0b00056e8h, 051e81dh, 0d83850adh, 0e7f157ch
dd 0a74fc38h, 0262ce088h, 0e901a368h, 01d2c003bh, 0580036e8h, 0b7efc38h
dd 0774d838h, 0f828e088h, 0800026e8h, 0127e1dfah, 0afd448ah, 0440afe44h
dd 074f838ffh, 0e8c28a05h, 0cafe000fh, 0ab7cee39h, 05a2405c6h, 021cd09b4h
dd 05e856c3h, 020b05e00h, 0c5bec3aah, 074c00a02h, 03c80460ah, 0fefa755bh
dd 046f675c8h, 0745b3cach, 0f8ebaae8h, 0eec1d689h, 08a3c8a03h, 07e180cah
dd 0cfd2c1feh, 0ebe8c342h, 0fed8d0ffh, 0c3f775cdh, 01e581e8fh, 0303c5ea8h
dd 0df6f652ah, 078bde03ch, 05e027500h, 01ec1603ch, 07d40793dh, 0603c8080h
dd 09f6f2838h, 040f17a3dh, 080f17a22h, 0403d7264h, 0793cdee1h, 0140740f1h
dd 01e2f7d32h, 02f488948h, 0a7c43b05h, 0a257af9bh, 0be297b6ch, 04609e30ah
dd 0b8f902abh, 07c21e13eh, 09a077d9eh, 054f82ab5h, 0fabe2af3h, 08a6534cdh
dd 0d32b4c97h, 035c7c8ceh, 082bcc833h, 0f87f154fh, 0650ff7eah, 02f143fdfh
dd 0a1fd687fh, 0c3e687fdh, 0c6d50fe0h, 075f13574h, 0898c335bh, 0e748ce85h
dd 08769676fh, 0ad2cedd3h, 0928c77c7h, 077e2d18eh, 01a77e8f6h
db 0bah, 01bh 
```

这是一个 454 字节的可执行文件。

这是（稍微小一点的）代码。由于 A86 是仅 8086 的汇编器，因此我不得不手动编写 32 位扩展代码：

```
 mov di,strings
    mov dx,tree_data * 8 + 1
    mov bp,code_data * 8
l1:
    mov ch,8
    call extract_bits
    xchg dx,bp
    call extract_bit
    xchg dx,bp
    jnc l2
    add dx,ax
l2:
    call extract_bit
    jc l3
    mov ch,6
    call extract_bits
    shr al,2
    cmp al,11
    push l27
    jl get_string
l25:
    add al,48+32
    stosb
l27:
    mov dx,tree_data * 8 + 1
l3:
    cmp bp,end_data * 8
    jl l1

convert:
    mov bx,'01'
    mov di,01000h
    push di

    mov al,[80h]
    mov ah,ch
    mov bp,ax
    add bp,81h
    cmp al,2
    jl zero
    jg l90
    cmp byte ptr [82h],bh
    jne l90
zero:   
    mov al,39
    push done

get_string:
    mov si,strings-1
    or al,al
    je l36
l35:
    inc si
    cmp byte ptr [si],';'+32
    jne l35
    dec al
    jnz l35
l36:
    inc si
l37:
    lodsb
    cmp al,';'+32
    je ret
    stosb
    jmp l37

l90:
    inc ax
    mov dh,3
    div dh
    add al,28
    mov dl,al
    add ah,80h
    db 0fh, 0b6h, 0f4h ; movzx si,ah
    mov word ptr [80h],'00'

l95:    
    lodsb

    sub al,bh
    jle l100
    call get_string2
    mov al,29
    call get_string2

l100:
    lodsw
    push ax
    cmp al,bl
    jl l150
    jg l140
    cmp ah,bh
    je l140

    mov al,ah
    sub al,'0'-10
    push l150

get_string2:
    push si
    call get_string
    pop si
    mov al,' '
    stosb
    ret

l140:
    sub al,'0'-19
    call get_string2

l150:
    pop ax
    cmp ah,bh
    jle l200
    cmp al,bl
    je l200
    mov al,ah
    sub al,bh
    call get_string2

l200:
    cmp dl,29
    jle l300

    mov al,[si-3]
    or al,[si-2]
    or al,[si-1]
    cmp al,bh
    je l300

    mov al,dl
    call get_string2

l300:
    dec dl
    cmp si,bp
    jl l95

done:   
    mov byte ptr [di],'$'
    pop dx
    mov ah,9
    int 21h 
    int 20h

l41:
    rcr al,1
    dec ch
    jz ret

extract_bits:
    push l41
extract_bit:
    mov si,dx
    shr si,3
    mov bh,[si]
    mov cl,dl
    and cl,7
    inc cl
    ror bh,cl
    inc dx
    ret

tree_data:
    dw 01e8fh, 01e58h, 05ea8h, 0303ch, 0652ah, 0df6fh, 0e03ch, 078bdh
    dw 07500h, 05e02h, 0603ch, 01ec1h, 0793dh, 07d40h, 08080h, 0603ch
    dw 02838h, 09f6fh, 07a3dh, 040f1h, 07a22h, 080f1h, 07264h, 0403dh
    dw 0dee1h, 0793ch, 040f1h, 01407h, 07d32h, 01e2fh, 08948h
    db 048h
code_data:
    dw 052fh, 0c43bh, 09ba7h, 057afh, 06ca2h, 0297bh, 0abeh, 09e3h
    dw 0ab46h, 0f902h, 03eb8h, 021e1h, 09e7ch, 077dh, 0b59ah, 0f82ah
    dw 0f354h, 0be2ah, 0cdfah, 06534h, 0978ah, 02b4ch, 0ced3h, 0c7c8h
    dw 03335h, 0bcc8h, 04f82h, 07f15h, 0eaf8h, 0ff7h, 0df65h, 0143fh
    dw 07f2fh, 0fd68h, 0fda1h, 0e687h, 0e0c3h, 0d50fh, 074c6h, 0f135h
    dw 05b75h, 08c33h, 08589h, 048ceh, 06fe7h, 06967h, 0d387h, 02cedh
    dw 0c7adh, 08c77h, 08e92h, 0e2d1h, 0f677h, 077e8h, 0ba1ah
    db 01bh
end_data:

strings: 
```

文本使用 Huffman 编码存储。命令行作为字符串传递，因此转换它很简单 - 将字符串分成三个一组，并使用当前乘数（百万、数千等）解析每个组（数百、十和单位）。

* * *

## 回答 #4

> 赞同：36
> 
> 时间：2008-11-21T19:57:11.433

Lisp，仅使用标准函数：

```
(format nil "~r" 1234) ==> "one thousand two hundred thirty-four" 
```

奖金：

```
(format nil "~@r" 1234)  ==> "MCCXXXIV" 
```

* * *

## 回答 #5

> 赞同：28
> 
> 时间：2008-11-21T20:04:10.170

C++，15 行：

```
#include <string>
using namespace std;

string Thousands[] = { "zero", "thousand", "million", "billion", "trillion", "quadrillion", "quintillion", "sexillion", "septillion", "octillion", "nonillion", "decillion" };
string Ones[] = { "zero", "one", "two", "three", "four", "five", "six", "seven", "eight", "nine", "ten", "eleven", "twelve", "thirteen", "fourteen", "fifteen", "sixteen", "seventeen", "eighteen", "nineteen" };
string Tens[] = { "zero", "ten", "twenty", "thirty", "forty", "fifty", "sixty", "seventy", "eighty", "ninety" };
string concat(bool cond1, string first, bool cond2, string second) { return (cond1 ? first : "") + (cond1 && cond2 ? " " : "") + (cond2 ? second : ""); }

string toStringBelowThousand(unsigned long long n) {
  return concat(n >= 100, Ones[n / 100] + " hundred", n % 100 != 0, (n % 100 < 20 ? Ones[n % 100] : Tens[(n % 100) / 10] + (n % 10 > 0 ? " " + Ones[n % 10] : "")));
}

string toString(unsigned long long n, int push = 0) {
  return n == 0 ? "zero" : concat(n >= 1000, toString(n / 1000, push + 1), n % 1000 != 0, concat(true, toStringBelowThousand(n % 1000), push > 0, Thousands[push]));
} 
```

用法：

```
cout << toString(51351);   // => fifty one thousand three hundred fifty one 
```

* * *

## 回答 #6

> 赞同：23
> 
> 时间：2008-11-21T19:51:09.167

这是作弊吗？

```
perl -MNumber::Spell -e 'print spell_number(2);' 
```

* * *

## 回答 #7

> 赞同：18
> 
> 时间：2009-01-03T17:25:34.963

Paul Fischer 和 Darius：你们有一些很棒的想法，但我讨厌看到它们以如此冗长的方式实施。:) 开个玩笑，您的解决方案很棒，但我又挤出了~~14~~ 30 个字节，同时保持在 79 列内并保持 python 3 兼容性。

所以这是我的 79 列中的 416 字节 python：（谢谢大家，我站在你的肩膀上）

```
w=lambda n:_(n,["","thousand "]+p("m b tr quadr quint","illion"))[:-1]or"zero"
_=lambda n,S:n*"x"and _(n//M,S[1:])+(Z[n%M//C]+"hundred ")*(n%M//C>0)+(n%C>19
and p("twen thir fo"+R,"ty")[n%C//10-2]+Z[n%10]or Z[n%C])+S[0]*(n%M>0)
p=lambda a,b="":[i+b+" "for i in a.split()]
R="r fif six seven eigh nine"
M=1000
C=100
Z=[""]+p("one two three four five%st nine ten eleven twelve"%R[5:20])+p(
"thir fou"+R,"teen") 
```

和测试：

```
if __name__ == "__main__":
    import sys
    assert(w(0)=="zero")
    assert(w(100)=="one hundred")
    assert(w(1000000)=="one million")
    assert(w(1024)=="one thousand twenty four")
    assert(w(1048576)=="one million forty eight thousand five hundred seventy six") 
```

* * *

## 回答 #8

> 赞同：17
> 
> 时间：2008-11-22T03:55:17.507

请参阅递归的更好答案。好多了

[大流士](https://stackoverflow.com/questions/309884/code-golf-number-to-words#310098)的疯狂道具以获得灵感。你的大`W`-（现在是我的`p`）特别聪明。

```
w=lambda n:["zero"," ".join(_(n,0))][n>0]
_=lambda n,l:_(n//M,l+1)+[E,Z[n%M//C]+["hundred"]][n%M//C>0]+\
(p("twen thir fo"+R,"ty")[n%C//10-2]+Z[n%10]if n%C>19 else Z[n%C])+\
[E,([E,["thousand"]]+p("m b tr quadr quint","illion"))[l]][n%M>0]if n else E
p=lambda a,b:[[i+b]for i in a.split()]
E=[];R="r fif six seven eigh nine";M=1000;C=100
Z=[E]+p("one two three four five six seven eight nine ten eleven twelve","")+\
p("thir fou"+R,"teen") 
```

我用这个测试它：

```
if __name__ == "__main__":
    import sys
    print w(int(sys.argv[1]))
    assert(w(100)=="one hundred")
    assert(w(1000000)=="one million")
    assert(w(1024)=="one thousand twenty four")
    assert(w(1048576)=="one million forty eight thousand five hundred seventy six") 
```

在这一点上，这是对 Darius 当前解决方案的调整，这反过来又是对我的旧解决方案的调整，这是受他的启发，他在评论中给出了一些错误提示。这也是对 Python 的犯罪。

下面的剧透，[rot13'd](http://rot13.com/)为你的保护，因为一半的乐趣高尔夫弄清楚如何。我强烈推荐[mnenhy](http://mnenhy.mozdev.org/installation.html#instFF) Firefox 扩展来内联解码这个（和其他简单的编码方案）。

Pbafgnagf (V eranzrq gurz guvf erivfvba gb ubcrshyyl znxr gurz pyrnere.)

*   `R`: Gur rzcgl frg。
*   `E`: Gung juvpu vf va pbzzba orgjrra pbhagvat va gur "grraf" ( *e* grra, *svs* grra, *fvk* grra...) naq va gur graf ( *e* gl, *svs* gl, *fvk* gl....)
*   `Z`, `P`: Jung gurl ner va Ebzna ahzrenyf。
*   `M`: Nyy gur ahzoref sebz bar gb gjragl。

Shapgvbaf (fbzr nyfb eranzrq guvf ebhaq)

*   `j`: Gur choyvp-snpvat shapgvba, juvpu gheaf n ahzore vagb jbeqf。
*   `_`: Erphefviryl gheaf gur ahzore vagb jbeqf, gubhfnaq-ol-gubhfnaq。 `a`vf gur ahzore，`y`vf ubj sne guebhtu gur cbjref bs 1000 jr ner。Ergheaf n yvfg bs fvatyrgba yvfgf bs rnpu jbeq va gur ahzore, rt `[['bar'],['gubhfnaq'],['gjragl'],['sbhe']]`。
*   `c`: sbe rnpu jbeq va gur fcnpr-frcnengrq jbeq yvfg `n`, nccraqf `o`nf n fhssvk naq chgf gurz rnpu vagb n fvatyrgba yvfg。斯伯克兹西尔, `c("z o ge","vyyvba") == [['zvyyvba'],['ovyyvba'],['gevyyvba']]`.

* * *

## 回答 #9

> 赞同：10
> 
> 时间：2008-11-21T20:32:16.557

Python，446 字节。80列以下的所有行，该死的。这是[Paul Fisher 的解决方案](https://stackoverflow.com/questions/309884/code-golf-number-to-words#310829)，几乎每一行都进行了编码调整，低于他的 488 字节版本；从那以后，他又挤出了几个字节，我承认了。去投票给他的答案！

```
g=lambda n:["zero"," ".join(w(n,0))][n>0]
w=lambda n,l:w(n//m,l+1)+[e,z[n%m//100]+["hundred"]][n%m//100>0]+\
(p("twen thir fo"+r,"ty")[n%100//10-2]+z[n%10]if n%100>19 else z[n%100])+\
[e,k[l]][n%m>0]if n else e
p=lambda a,b:[[i+b]for i in a.split()]
e=[];r="r fif six seven eigh nine";m=1000
k=[e,["thousand"]]+p("m b tr quadr quint","illion")
z=[e]+p("one two three four five six seven eight nine ten eleven twelve","")+\
p("thir fou"+r,"teen") 
```

历史变得复杂起来。我从下面的未混淆代码开始，它支持负数和范围检查，加上一些数字中的破折号以获得更好的英语：

```
>>> n2w(2**20)
'one million forty-eight thousand five hundred seventy-six'

def n2w(n):
    if n < 0:  return 'minus ' + n2w(-n)
    if n < 10: return W('zero one two three four five six seven eight nine')[n]
    if n < 20: return W('ten eleven twelve',
                        'thir four fif six seven eigh nine',
                        'teen')[n-10]
    if n < 100: 
        tens = W('', 'twen thir for fif six seven eigh nine', 'ty')[n//10-2]
        return abut(tens, '-', n2w(n % 10))
    if n < 1000:
        return combine(n, 100, 'hundred')
    for i, word in enumerate(W('thousand', 'm b tr quadr quint', 'illion')):
        if n < 10**(3*(i+2)):
            return combine(n, 10**(3*(i+1)), word)
    assert False

def W(b, s='', suff=''): return b.split() + [s1 + suff for s1 in s.split()]
def combine(n, m, term): return abut(n2w(n // m) + ' ' + term, ' ', n2w(n % m))
def abut(w10, sep, w1):  return w10 if w1 == 'zero' else w10 + sep + w1 
```

然后我通过混淆（对我来说是新的）将它压缩到大约 540 个字节，Paul Fisher 发现了一个更短的算法（删除破折号）以及一些非常可怕的 Python 编码技巧。我窃取了编码技巧以降低到 508（仍然没有获胜）。我尝试用一​​种新算法重新开始，但它无法击败费舍尔的算法。最后，这是他的代码的调整。尊重！

混淆代码已针对干净代码进行了测试，该代码由眼球检查了一堆案例。

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2008-11-22T08:21:02.430

好的，这是 F#，试图保持可读性，大约 830 字节：

```
#light
let thou=[|"";"thousand";"million";"billion";"trillion";"quadrillion";"quintillion"|]
let ones=[|"";"one";"two";"three";"four";"five";"six";"seven";"eight";"nine";"ten";"eleven";
  "twelve";"thirteen";"fourteen";"fifteen";"sixteen";"seventeen";"eighteen";"nineteen"|]
let tens=[|"";"";"twenty";"thirty";"forty";"fifty";"sixty";"seventy";"eighty";"ninety"|]
let (^-) x y = if y="" then x else x^"-"^y
let (^+) x y = if y="" then x else x^" "^y
let (^?) x y = if x="" then x else x^+y
let (+^+) x y = if x="" then y else x^+y
let Tiny n = if n < 20 then ones.[n] else tens.[n/10] ^- ones.[n%10]
let Small n = (ones.[n/100] ^? "hundred") +^+ Tiny(n%100)
let rec Big n t = if n = 0UL then "" else
  (Big (n/1000UL) (t+1)) +^+ (Small(n%1000UL|>int) ^? thou.[t])
let Convert n = if n = 0UL then "zero" else Big n 0 
```

这是单元测试

```
let Show n = 
    printfn "%20u -> \"%s\"" n (Convert n)

let tinyTests = [0; 1; 10; 11; 19; 20; 21; 30; 99] |> List.map uint64
let smallTests = tinyTests @ (tinyTests |> List.map (fun n -> n + 200UL))
let MakeTests t1 t2 = 
    List.map (fun n -> n * (pown 1000UL t1)) smallTests
    |> List.map_concat (fun n -> List.map (fun x -> x * (pown 1000UL t2) + n) smallTests)
for n in smallTests do
    Show n
for n in MakeTests 1 0 do
    Show n
for n in MakeTests 5 2 do
    Show n            
Show 1000001000678000001UL
Show 17999999999999999999UL 
```

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2008-11-21T20:01:24.653

这是 C 语言中一个相对简单的实现（52 行）。

**注意**：这不执行任何边界检查；调用者必须确保调用缓冲区足够大。

```
#include <stdio.h>
#include <string.h>

const char *zero_to_nineteen[20] = {"", "One ", "Two ", "Three ", "Four ", "Five ", "Six ", "Seven ", "Eight ", "Nine ", "Ten ", "Eleven ", "Twelve ", "Thirteen ", "Fourteen ", "Fifteen ", "Sixteen ", "Seventeen ", "Eighteen ", "Nineteen "};

const char *twenty_to_ninety[8] = {"Twenty ", "Thirty ", "Forty ", "Fifty ", "Sixty ", "Seventy ", "Eighty ", "Ninety "};

const char *big_numbers[7] = {"", "Thousand ", "Million ", "Billion ", "Trillion ", "Quadrillion ", "Quintillion "};

void num_to_word(char *buf, unsigned long long num)
{
  unsigned long long power_of_1000 = 1000000000000000000ull;
  int power_index = 6;

  if(num == 0)
  {
    strcpy(buf, "Zero");
    return;
  }

  buf[0] = 0;

  while(power_of_1000 > 0)
  {
    int group = num / power_of_1000;
    if(group >= 100)
    {
      strcat(buf, zero_to_nineteen[group / 100]);
      strcat(buf, "Hundred ");
      group %= 100;
    }

    if(group >= 20)
    {
      strcat(buf, twenty_to_ninety[group / 10 - 2]);
      group %= 10;
    }

    if(group > 0)
      strcat(buf, zero_to_nineteen[group]);

    if(num >= power_of_1000)
      strcat(buf, big_numbers[power_index]);

    num %= power_of_1000;
    power_of_1000 /= 1000;
    power_index--;
  }

  buf[strlen(buf) - 1] = 0;
} 
```

这是一个更加模糊的版本（682 个字符）。如果我真的尝试过，它可能会减少一点。

```
#include <string.h>
#define C strcat(b,
#define U unsigned long long
char*z[]={"","One","Two","Three","Four","Five","Six","Seven","Eight","Nine","Ten","Eleven","Twelve","Thirteen","Fourteen","Fifteen","Sixteen","Seventeen","Eighteen","Nineteen"},*t[]={"Twenty ","Thirty ","Forty ","Fifty ","Sixty ","Seventy ","Eighty ","Ninety "},*q[]={"","Thousand ","Million ","Billion ","Trillion ","Quadrillion ","Quintillion "};
void W(char*b,U n){U p=1000000000000000000ull;int i=6;*b=0;if(!n)strcpy(b,"Zero ");else while(p){int g=n/p;if(g>99){C z[g/100]);C " ");C "Hundred ");g%=100;}if(g>19){C t[g/10-2]);g%=10;}if(g)C z[g]),C " ");if(n>=p)C q[i]);n%=p;p/=1000;i--;}b[strlen(b)-1]=0;} 
```

* * *

## 回答 #12

> 赞同：5
> 
> 时间：2008-11-21T22:48:58.560

一个 T-SQL (SQL Server 2005) 函数，包括测试用例：

```
if exists (select 1 from sys.objects where object_id = object_id(N'dbo.fnGetNumberString'))
    drop function fnGetNumberString
go

/*
Tests:
declare @tests table ( testValue bigint )
insert into @tests select -43213 union select -5 union select 0 union select 2 union select 15 union select 33 union select 100 union select 456 union select 1024 union select 10343 union select 12345678901234 union select -3434343434343

select testValue, dbo.fnGetNumberString(testValue) as textValue
from @tests
*/

create function dbo.fnGetNumberString
(
    @value bigint
)
returns nvarchar(1024)
as
begin
    if @value = 0 return 'zero' -- lets me avoid special-casing this later

    declare @isNegative bit
    set @isNegative = 0

    if @value < 0
        select @isNegative = 1, @value = @value * -1

    declare @groupNames table ( groupOrder int, groupName nvarchar(15) )
    insert into @groupNames select 1, '' union select 2, 'thousand' union select 3, 'million' union select 4, 'billion' union select 5, 'trillion' union select 6, 'quadrillion' union select 7, 'quintillion' union select 8, 'sextillion'

    declare @digitNames table ( digit tinyint, digitName nvarchar(10) )
    insert into @digitNames select 0, '' union select 1, 'one' union select 2, 'two' union select 3, 'three' union select 4, 'four' union select 5, 'five' union select 6, 'six' union select 7, 'seven' union select 8, 'eight' union select 9, 'nine' union select 10, 'ten' union select 11, 'eleven' union select 12, 'twelve' union select 13, 'thirteen' union select 14, 'fourteen' union select 15, 'fifteen' union select 16, 'sixteen' union select 17, 'seventeen' union select 18, 'eighteen' union select 19, 'nineteen'

    declare @tensGroups table ( digit tinyint, groupName nvarchar(10) )
    insert into @tensGroups select 2, 'twenty' union select 3, 'thirty' union select 4, 'forty' union select 5, 'fifty' union select 6, 'sixty' union select 7, 'seventy' union select 8, 'eighty' union select 9, 'ninety'

    declare @groups table ( groupOrder int identity, groupValue int )

    declare @convertedValue varchar(50)

    while @value > 0
    begin
        insert into @groups (groupValue) select @value % 1000

        set @value = @value / 1000
    end

    declare @returnValue nvarchar(1024)
    set @returnValue = ''

    if @isNegative = 1 set @returnValue = 'negative'

    select @returnValue = @returnValue +
        case when len(h.digitName) > 0 then ' ' + h.digitName + ' hundred' else '' end +
        case when len(isnull(t.groupName, '')) > 0 then ' ' + t.groupName + case when len(isnull(o.digitName, '')) > 0 then '-' else '' end + isnull(o.digitName, '') else case when len(isnull(o.digitName, '')) > 0 then ' ' + o.digitName else '' end end +
        case when len(n.groupName) > 0 then ' ' + n.groupName else '' end
    from @groups g
        join @groupNames n on n.groupOrder = g.groupOrder
        join @digitNames h on h.digit = (g.groupValue / 100)
        left join @tensGroups t on t.digit = ((g.groupValue % 100) / 10)
        left join @digitNames o on o.digit = case when (g.groupValue % 100) < 20 then g.groupValue % 100 else g.groupValue % 10 end
    order by g.groupOrder desc

    return @returnValue
end
go 
```

* * *

## 回答 #13

> 赞同：5
> 
> 时间：2008-11-23T03:51:49.947

这是一个 Scala 解决方案。我不喜欢让它看起来很短——我牺牲了一点可读性:(

```
对象数字拼写器 {
  val 数字 = Array("","一","二","三","四","五","六","七","八","九")
  val teens = Array(“十”、“十一”、“十二”、“十三”、“十四”、“十五”、“十六”、“十七”、“十八”、“十九”)
  val tens = Array(“”, “十”, “二十”, “三十”, “四十”, “五十”, “六十”, “七十”, “八十”, “九十”)
  val数千=数组（“”，“千”，“百万”，“十亿”，“万亿”，“万亿”，“五亿”）

  def spellGroup(num:Int) = {
    val (v3, v2, v1) = ((num / 100) % 10, (num / 10) % 10, num % 10)
    val hs = v3 匹配 { case 0 => ""; 案例 d => 数字（d）+“百”}
    val ts = v2 匹配 {
      案例 0 => 数字（v1）
      案例 1 => 青少年（v1）
      case _ => v3 匹配 { case 0 => tens(v2); case _ => 十位（v2）+“-”+数字（v1）}
    }
    hs + ts
  }

  def numberGroups(num:Long) = {
    def _numberGroups(num:Long, 因子:Int):List[(Double,Int)] = 因子匹配 {
      案例 0 => 列表((num % 1000,0))
      case _ => ((num / Math.pow(1000, factor)) % 1000, factor) :: _numberGroups(num, factor - 1)
    }
    val ints = _numberGroups(num, 6) 映射 (x => (x._1.asInstanceOf[Int],x._2))
    整数 dropWhile (x => x._1 == 0.0)
  }

  def spell(num:Long) = num match { case 0 => "zero"; case _ => (numberGroups(num) map { x => spellGroup(x._1) + " " +数千(x._2) + " " }).mkString.trim }
}

```

用法是：

```
NumSpeller.spell(458582) 
```

* * *

## 回答 #14

> 赞同：4
> 
> 时间：2008-12-28T11:31:32.900

## `Perl 5.10`

```
my %expo=(0,'',
  qw'1 thousand 2 million 3 billion 4 trillion 5 quadrillion 6 quintillion
  7 sextillion 8 septillion 9 octillion 10 nonillion 11 decillion 12 undecillion
  13 duodecillion 14 tredecillion 15 quattuordecillion 16 quindecillion
  17 sexdecillion 18 septendecillion 19 octodecillion 20 novemdecillion
  21 vigintillion'
);

my %digit=(0,'',
  qw'1 one 2 two 3 three 4 four 5 five 6 six 7 seven 8 eight 9 nine 10 ten
  11 eleven 12 twelve 13 thirteen 14 fourteen 15 fifteen 16 sixteen 17 seventeen
  18 eighteen 19 nineteen 2* twenty 3* thirty 4* forty 5* fifty 6* sixty
  7* seventy 8* eighty 9* ninety'
);

sub spell_number(_){
  local($_)=@_;
  ($_,@_)=split/(?=(?:.{3})*+$)/;
  $_=0 x(3-length).$_;
  unshift@_,$_;
  my @o;
  my $c=@_;
  for(@_){
    my $o='';
    /(.)(.)(.)/;
    $o.=$1?$digit{$1}.' hundred':'';
    $o.=$2==1?
      ' '.$digit{$2.$3}
    :
      ($2?' '.$digit{"$2*"}:'').
      ($2&&$3?' ':'').
      $digit{$3}
    ;
    $o.=--$c?($o?' '.$expo{$c}.', ':''):'';
    push@o,$o;
  }
  my $o;
  $o.=$_ for@o;
  $o=~/^\s*+(.*?)(, )?$/;
  $o?$1:'zero';
} 
```

*笔记：*

*   这几乎适用于早期的 Perls，这`split()`似乎是主要问题。就目前而言，字符串占据了大部分字符。
*   我可以通过删除`my`'s 和`local`, 并将它们全部放在一条线上来缩短它。
*   我使用[Number::Spell](http://search.cpan.org/perldoc?Number::Spell)作为起点。
*   在`strict`和下工作`warnings`。

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2008-11-21T20:23:00.383

嗯，你可能把标准设置得有点高，无论是在极限（18,446,744,073,709,552,000，我什至不知道怎么写！）和目标（其他代码打高尔夫球导致短代码，这个会很长至少对于数据（单词））。

无论如何，为了记录，我在 PHP 中给出了一个众所周知的法语解决方案（不是我的！）：[Écriture des nombres en français](http://www.miakinen.net/vrac/nombres "法语文学典籍")。:-)

请注意您的措辞的歧义（自愿或非自愿）：“*欢迎以任何语言提交*”
我首先将其视为“自然语言”，在理解您可能是指“编程语言......
该算法可能在英语中更简单（并且更少的区域变体...）。

* * *

## 回答 #16

> 赞同：3
> 
> 时间：2009-05-13T18:57:46.513

在[D 编程语言中](http://www.digitalmars.com/d/1.0/)

```
string Number(ulong i)
{
    static string[] names = [
      ""[],
      " thousand",
      " million",
      " billion",
      " trillion",
      " quadrillion",
      ];
    string ret = null;
    foreach(mult; names)
    {
       if(i%1000 != 0)
       {
           if(ret != null) ret = ret ~ ", "
           ret = Cent(i%1000) ~ mult ~ ret;
       }
       i /= 1000;
    }
    return ret;
}

string Cent(int i)
{
   static string[] v = 
        [""[], "one", "two", "three", "four", 
        "five", "six", "seven", "eight", "nine"];

   static string[] tens = 
        ["!"[], "!", "twenty", "thirty", "forty", 
        "fifty", "sixty", "seventy", "eighty", "ninety"];

   string p1, p2, p3 = "";

   if(i >= 100)
   {
      p1 = v[i/100] ~ " hundred";
      p3 = (i % 100 != 0) ? " and " : ""; //optional
   }
   else
      p1 = "";

   i %= 100;
   switch(i)
   {
       case 0, 1, 2, 3, 4, 5, 6, 7, 8, 9:
          p2 = v[i];
          break;

       case 10: p2 = "ten"; break;
       case 11: p2 = "eleven"; break;
       case 12: p2 = "twelve"; break;
       case 13: p2 = "thirteen"; break;
       case 14: p2 = "fourteen"; break;
       case 15: p2 = "fifteen"; break;
       case 16: p2 = "sixteen"; break;
       case 17: p2 = "seventeen"; break;
       case 18: p2 = "eighteen"; break;
       case 19: p2 = "nineteen"; break;

       default:
           p2 = tens[i/10] ~ "-" ~ v[i%10];
           break;

   }

   return p1 ~ p3 ~ p2;
}

import std.stdio;
void main()
{
  writef("%s\n", Number(8_000_400_213));
} 
```

[在这里试试](http://codepad.org/3qVrddCd)

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2008-12-31T00:40:59.827

有人打算很快添加适当的逗号和“和”吗？还是从 21 到 99 连字？否则没什么意义，恕我直言：）

‘九十九万九千九十九十九’

对比

‘九十九万九千九十九’

（不，我的不起作用。然而。）

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2008-12-31T02:13:10.513

```
#!/usr/bin/env perl
my %symbols = (
1 => "One", 2 => "Two", 3 => "Three", 4 => "Four", 5 => "Five",
6 => "Six", 7 => "Seven", 8 => "Eight", 9 => "Nine", 10 => "Ten",
11 => "Eleven", 12 => "Twelve", 13 => "Thirteen", 14 => "Fourteen",
15 => "Fifteen", 16 => "Sixteen", 17 => "Seventeen", 18 => "Eighteen",
19 => "Nineteen", 20 => "Twenty", 30 => "Thirty", 40 => "Forty",
50 => "Fifty", 60 => "Sixty", 70 => "Seventy", 80 => "Eighty",
90 => "Ninety", 100 => "Hundred");

my %three_symbols = (1 => "Thousand", 2 => "Million", 3 => "Billion" );

sub babo {
my ($input) = @_;
my @threes = split(undef, $input);
my $counter = ($#threes + 1);
my $remainder = $counter % 3;
my @result;

while ($counter > 0){
    my $digits = "";
    my $three;
    my $full_match = 0;

    if ($remainder > 0){
        while ($remainder > 0) {
            $digits .= shift(@threes);
            $remainder--;
            $counter--;
        }
    }
    else {
        $digits = join('',@threes[0,1,2]);
        splice(@threes, 0, 3);
        $counter -= 3;
    }
    if (exists($symbols{$digits})){
        $three = $symbols{$digits};
        $full_match = 1;
    }
    elsif (length($digits) == 3) {
        $three = $symbols{substr($digits,0,1)};
        $three .= " Hundred";
        $digits = substr($digits,1,2);
        if (exists($symbols{$digits})){
            $three .= " " . $symbols{$digits};
            $full_match = 1;
        }
    }
    if ($full_match == 0){
        $three .= " " . $symbols{substr($digits,0,1)."0"};
        $three .= " " . $symbols{substr($digits,1,1)};
    }
    push(@result, $three);
    if ($counter > 0){
        push(@result, "Thousand");
    }
}
my $three_counter = 0;
my @r = map {$_ eq "Thousand" ? $three_symbols{++$three_counter}:$_ }
    reverse @result;
return join(" ", reverse @r);
}
print babo(1) . "\n";
print babo(12) . "\n";
print babo(120) . "\n";
print babo(1234) . "\n";
print babo(12345) . "\n";
print babo(123456) . "\n";
print babo(1234567) . "\n";
print babo(1234567890) . "\n"; 
```

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2008-11-21T19:28:37.387

我现在找不到该文件，但这是我上学的编程问题介绍（学期末）。我们必须能够将浮点数转换为有效的书面数字，以便在支票上使用。

作业完成后，教授展示了一些 C++ 代码，这些代码仅使用我们已经涵盖的概念来解决问题。它只运行了 43 行，并且有据可查。

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2009-07-24T06:49:41.517

这是 PHP 中的一个，从*[Convert Numbers to Words](http://www.phpro.org/examples/Convert-Numbers-to-Words.html)*：

```
convert_number(2850) 
```

返回

> 20850

如果你想要一个更棒的处理逗号和数字的工具，请查看 zac hesters 在*[Language Display Functions](http://code.zacharyhester.com/?type=flat&lang=php&name=language)*的工作：

```
function convert_number($number)
{
    if (($number < 0) || ($number > 999999999))
    {
        throw new Exception("Number is out of range");
    }

    $Gn = floor($number / 1000000);  /* Millions (giga) */
    $number -= $Gn * 1000000;
    $kn = floor($number / 1000);     /* Thousands (kilo) */
    $number -= $kn * 1000;
    $Hn = floor($number / 100);      /* Hundreds (hecto) */
    $number -= $Hn * 100;
    $Dn = floor($number / 10);       /* Tens (deca) */
    $n = $number % 10;               /* Ones */

    $res = "";

    if ($Gn)
    {
        $res .= convert_number($Gn) . " Million";
    }

    if ($kn)
    {
        $res .= (empty($res) ? "" : " ") .
            convert_number($kn) . " Thousand";
    }

    if ($Hn)
    {
        $res .= (empty($res) ? "" : " ") .
            convert_number($Hn) . " Hundred";
    }

    $ones = array("", "One", "Two", "Three", "Four", "Five", "Six",
        "Seven", "Eight", "Nine", "Ten", "Eleven", "Twelve", "Thirteen",
        "Fourteen", "Fifteen", "Sixteen", "Seventeen", "Eightteen",
        "Nineteen");
    $tens = array("", "", "Twenty", "Thirty", "Fourty", "Fifty", "Sixty",
        "Seventy", "Eigthy", "Ninety");

    if ($Dn || $n)
    {
        if (!empty($res))
        {
            $res .= " and ";
        }

        if ($Dn < 2)
        {
            $res .= $ones[$Dn * 10 + $n];
        }
        else
        {
            $res .= $tens[$Dn];

            if ($n)
            {
                $res .= "-" . $ones[$n];
            }
        }
    }

    if (empty($res))
    {
        $res = "zero";
    }

    return $res;
} 
```

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2009-07-24T17:45:53.047

### Perl 和 CPAN 一起工作：

```
#!/usr/bin/perl

use strict;
use warnings;

use Lingua::EN::Numbers qw(num2en);

print num2en($_), "\n" for 2, 1024, 1024*1024; 
```

```
C:\Temp> n.pl
二
一千二十四
一百万、四万八千、五百七十六
```

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2009-05-12T10:48:38.193

几年前，我用 C# 为多语言应用程序创建了这个。

这是基类：

```
public abstract class ValueSource
{
    public abstract object Value { get; }
} 
```

这个是wordify..

```
public abstract class NumberTextValueSource:ValueSource
{
    public abstract decimal Number { get; }
    public abstract string Format { get; }
    public abstract string Negative { get; }
    public abstract bool UseValueIfZero { get; }
    public abstract string N0 { get; }
    public abstract string N1 { get; }
    public abstract string N2 { get; }
    public abstract string N3 { get; }
    public abstract string N4 { get; }
    public abstract string N5 { get; }
    public abstract string N6 { get; }
    public abstract string N7 { get; }
    public abstract string N8 { get; }
    public abstract string N9 { get; }
    public abstract string N10 { get; }
    public abstract string N11 { get; }
    public abstract string N12 { get; }
    public abstract string N13 { get; }
    public abstract string N14 { get; }
    public abstract string N15 { get; }
    public abstract string N16 { get; }
    public abstract string N17 { get; }
    public abstract string N18 { get; }
    public abstract string N19 { get; }
    public abstract string N20 { get; }
    public abstract string N30 { get; }
    public abstract string N40 { get; }
    public abstract string N50 { get; }
    public abstract string N60 { get; }
    public abstract string N70 { get; }
    public abstract string N80 { get; }
    public abstract string N90 { get; }
    public abstract string N100 { get; }
    public abstract string NHundred { get; }
    public abstract string N1000 { get; }
    public abstract string NThousand { get; }
    public abstract string NMillion { get; }
    public abstract string NBillion { get; }
    public abstract string NTrillion { get; }
    public abstract string NQuadrillion { get; }

    string getOne(Type t, string v)
    {
        if (v[0] == '0' && !UseValueIfZero)
            return "";
        return (string)t.GetProperty("N" + v[0].ToString()).GetValue(this, null);
    }

    string getTwo(Type t, string v)
    {
        if (v[0] == '0')
            if (v[1] != '0')
                return getOne(t, v.Substring(1));
            else
                return "";

        if (v[1] == '0' || v[0] == '1')
            return (string)t.GetProperty("N" + v).GetValue(this, null);

        return (string)t.GetProperty("N" + v[0].ToString() + "0").GetValue(this, null) +
               getOne(t, v.Substring(1));
    }

    string getThree(Type t, string v)
    {
        if(v[0] == '0')
            return getTwo(t,v.Substring(1));

        if (v[0] == '1')
            return
                N100 +
                getTwo(t, v.Substring(1));
        return
            getOne(t, v[0].ToString()) +
            NHundred +
            getTwo(t, v.Substring(1));
    }

    string getFour(Type t, string v)
    {
        if (v[0] == '0')
            return getThree(t, v.Substring(1));
        if (v[0] == '1')
            return
                N1000 +
                getThree(t, v.Substring(1));
        return
            getOne(t, v[0].ToString()) +
            NThousand +
            getThree(t, v.Substring(1));
    }

    string getFive(Type t, string v)
    {
        if (v[0] == '0')
            return getFour(t, v.Substring(1));
        return
            getTwo(t, v.Substring(0, 2)) +
            NThousand +
            getThree(t, v.Substring(2));
    }

    string getSix(Type t, string v)
    {
        if (v[0] == '0')
            return getFive(t, v.Substring(1));
        return
            getThree(t, v.Substring(0, 3)) +
            NThousand +
            getThree(t, v.Substring(3));
    }

    string getSeven(Type t, string v)
    {
        if (v[0] == '0')
            return getSix(t, v.Substring(1));
        return
            getOne(t, v[0].ToString()) +
            NMillion +
            getSix(t, v.Substring(3));
    }

    string getEight(Type t, string v)
    {
        if (v[0] == '0')
            return getSeven(t, v.Substring(1));
        return
            getTwo(t, v.Substring(0, 2)) +
            NMillion +
            getSix(t, v.Substring(2));
    }

    string getNine(Type t, string v)
    {
        if (v[0] == '0')
            return getEight(t, v.Substring(1));
        return
            getThree(t, v.Substring(0, 3)) +
            NMillion +
            getSix(t, v.Substring(3));
    }

    string getTen(Type t, string v)
    {
        if (v[0] == '0')
            return getNine(t, v.Substring(1));
        return
            getOne(t, v.Substring(0, 1)) +
            NBillion +
            getNine(t, v.Substring(1));
    }

    string getEleven(Type t, string v)
    {
        if (v[0] == '0')
            return getTen(t, v.Substring(1));
        return
            getTwo(t, v.Substring(0, 2)) +
            NBillion +
            getNine(t, v.Substring(2));
    }

    string getTwelve(Type t, string v)
    {
        if (v[0] == '0')
            return getEleven(t, v.Substring(1));
        return
            getThree(t, v.Substring(0, 3)) +
            NBillion +
            getNine(t, v.Substring(3));
    }

    string getThirteen(Type t, string v)
    {
        if (v[0] == '0')
            return getTwelve(t, v.Substring(1));
        return
            getOne(t, v.Substring(0, 1)) +
            NTrillion +
            getTwelve(t, v.Substring(1));
    }

    string getForteen(Type t, string v)
    {
        if (v[0] == '0')
            return getThirteen(t, v.Substring(1));
        return
            getTwo(t, v.Substring(0, 2)) +
            NTrillion +
            getTwelve(t, v.Substring(2));
    }

    string getFifteen(Type t, string v)
    {
        if (v[0] == '0')
            return getForteen(t, v.Substring(1));
        return
            getThree(t, v.Substring(0, 3)) +
            NTrillion +
            getTwelve(t, v.Substring(3));
    }

    string getSixteen(Type t, string v)
    {
        if (v[0] == '0')
            return getFifteen(t, v.Substring(1));
        return
            getOne(t, v.Substring(0, 1)) +
            NQuadrillion +
            getFifteen(t, v.Substring(1));
    }

    string getSeventeen(Type t, string v)
    {
        if (v[0] == '0')
            return getSixteen(t, v.Substring(1));
        return
            getTwo(t, v.Substring(0, 2)) +
            NQuadrillion +
            getFifteen(t, v.Substring(2));
    }

    string getEighteen(Type t, string v)
    {
        if (v[0] == '0')
            return getSeventeen(t, v.Substring(1));
        return
            getThree(t, v.Substring(0, 3)) +
            NQuadrillion +
            getFifteen(t, v.Substring(3));
    }

    string convert(Type t, string hp)
    {
        switch (hp.Length)
        {
            case 1:
                return getOne(t, hp);
            case 2:
                return getTwo(t, hp);
            case 3:
                return getThree(t, hp);
            case 4:
                return getFour(t, hp);
            case 5:
                return getFive(t, hp);
            case 6:
                return getSix(t, hp);
            case 7:
                return getSeven(t, hp);
            case 8:
                return getEight(t, hp);
            case 9:
                return getNine(t, hp);
            case 10:
                return getTen(t, hp);
            case 11:
                return getEleven(t, hp);
            case 12:
                return getTwelve(t, hp);
            case 13:
                return getThirteen(t, hp);
            case 14:
                return getForteen(t, hp);
            case 15:
                return getFifteen(t, hp);
            case 16:
                return getSixteen(t, hp);
            case 17:
                return getSeventeen(t, hp);
            case 18:
                return getEighteen(t, hp);
        }
        return "";
    }

    public override object Value
    {
        get
        {
            decimal d = Number;
            decimal highPoint, lowPoint;
            bool isNeg = d < 0;
            d = Math.Abs(d);
            highPoint = Math.Floor(d);
            lowPoint = d - highPoint;
            Type t = this.GetType();

            string strHigh = convert(t, highPoint.ToString()),
                    strLow =
                       lowPoint > 0 ?
                       convert(t, lowPoint.ToString().Substring(2)) :
                       UseValueIfZero ? N0 : "";
            if (isNeg) strHigh = Negative + " " + strHigh;
            return string.Format(Format, strHigh, strLow);
        }
    }
} 
```

这个是针对土耳其莱拉（TRY）的：

```
public class TRYNumberTextValueSource:NumberTextValueSource
{
    decimal num;
    public TRYNumberTextValueSource(decimal value)
    {
        num = Math.Round(value, 2);
    }
    public override decimal Number
    {
        get { return num; }
    }

    public override string Format
    {
        get
        {
            if (num == 0)
                return N0 + " YTL";
            if (num > -1 && num < 1)
                return "{0}{1} Kurus";
            return "{0} YTL {1} Kurus";
        }
    }

    public override string Negative
    {
        get { return "-"; }
    }

    public override bool UseValueIfZero
    {
        get { return false; }
    }

    public override string N0
    {
        get { return "sifir"; }
    }

    public override string N1
    {
        get { return "bir"; }
    }

    public override string N2
    {
        get { return "iki"; }
    }

    public override string N3
    {
        get { return "üç"; }
    }

    public override string N4
    {
        get { return "dört"; }
    }

    public override string N5
    {
        get { return "bes"; }
    }

    public override string N6
    {
        get { return "alti"; }
    }

    public override string N7
    {
        get { return "yedi"; }
    }

    public override string N8
    {
        get { return "sekiz"; }
    }

    public override string N9
    {
        get { return "dokuz"; }
    }

    public override string N10
    {
        get { return "on"; }
    }

    public override string N11
    {
        get { return "onbir"; }
    }

    public override string N12
    {
        get { return "oniki"; }
    }

    public override string N13
    {
        get { return "onüç"; }
    }

    public override string N14
    {
        get { return "ondört"; }
    }

    public override string N15
    {
        get { return "onbes"; }
    }

    public override string N16
    {
        get { return "onalti"; }
    }

    public override string N17
    {
        get { return "onyedi"; }
    }

    public override string N18
    {
        get { return "onsekiz"; }
    }

    public override string N19
    {
        get { return "ondokuz"; }
    }

    public override string N20
    {
        get { return "yirmi"; }
    }

    public override string N30
    {
        get { return "otuz"; }
    }

    public override string N40
    {
        get { return "kirk"; }
    }

    public override string N50
    {
        get { return "elli"; }
    }

    public override string N60
    {
        get { return "altmis"; }
    }

    public override string N70
    {
        get { return "yetmis"; }
    }

    public override string N80
    {
        get { return "seksen"; }
    }

    public override string N90
    {
        get { return "doksan"; }
    }

    public override string N100
    {
        get { return "yüz"; }
    }

    public override string NHundred
    {
        get { return "yüz"; }
    }

    public override string N1000
    {
        get { return "bin"; }
    }

    public override string NThousand
    {
        get { return "bin"; }
    }

    public override string NMillion
    {
        get { return "milyon"; }
    }

    public override string NBillion
    {
        get { return "milyar"; }
    }

    public override string NTrillion
    {
        get { return "trilyon"; }
    }

    public override string NQuadrillion
    {
        get { return "trilyar"; }
    }
} 
```

它是这样使用的：

```
MessageBox.show((string)(new TRYNumberTextValueSource(12345)).Value); 
```

# windows-ce - WinCE 6.0 在 ARM 目标上的典型中断延迟是多少？

> ID：309887
> 
> 赞同：2
> 
> 时间：2008-11-21T19:25:57.393
> 
> 标签：windows-ce, arm, latency, interrupt

ARM 目标上 WinCE 6.0 的典型中断延迟是多少？

（只是寻找性能估计的大概值）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-21T19:39:57.833

取决于处理器速度。在大多数情况下，ISR 的单位数到低 10 微秒。请参阅[这篇文章](http://msdn.microsoft.com/en-us/library/ms836535.aspx)以获得更深入的信息。它涵盖高达 4.2。5.0 的行为与 4.2 几乎相同。我没有在同一场景中专门测试 6.0，但由于内核驱动程序现在不需要 thunk，因此 ISR 可能相同，而 IST 可能要快得多。用户模式驱动程序可能与较旧的 4.2/5.0 结果相匹配。

# java - 在Java中覆盖equals时，为什么使用Object以外的参数不起作用？

> ID：309892
> 
> 赞同：11
> 
> 时间：2008-11-21T19:28:12.710
> 
> 标签：java, overloading

我最近遇到了一个有趣的行为。似乎如果我重写 .equals() 以获取 Object 以外的参数，它就不会被调用。谁能向我解释为什么会这样？这似乎违反了我对 OOP 中多态性的理解，但也许我遗漏了一些东西。

这是更简单的代码，显示了我所看到的：

```
public class MyClass {
  private int x;
  public MyClass(int n) { x = n; }
  public boolean equals(Object o) { return false; }
  public boolean equals(MyClass mc) { return x == mc.x; }
  public static void main(String[] args) {
    List<MyClass> list = new ArrayList<MyClass>();
    list.add(new MyClass(3));
    System.out.println("Contains 3? " + list.contains(new MyClass(3)));
  }
} 
```

当它运行时，它会打印“ `Contains 3? false`”。看起来好像调用了 equals(Object) 函数，即使还有另一个可以工作。相比之下，如果我这样写 equals ，则代码按预期工作：

```
public boolean equals(Object o) {
  if(!(o instanceof MyClass))
    return false;
  MyClass mc = (MyClass)o;
  return x == mc.x;
} 
```

为什么不根据参数的类型确定要调用哪个版本的函数？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-11-21T19:41:23.883

您正在混淆“覆盖”和“重载”。

覆盖——为多态性添加现有方法的替换定义。该方法必须具有相同的签名。签名由名称和参数类型组成。在运行时根据目标对象的运行时类型选择覆盖的方法。

重载——添加一个名称相同但签名不同的方法。在编译时根据目标对象的编译时类型选择重载方法。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-11-21T19:35:57.013

equals(Object) 覆盖了一个超级方法；如果不使用完全相同的签名，您就*无法覆盖超级方法（嗯，有一些例外，如协变返回类型和异常）。*

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-11-21T20:55:25.043

请注意，您正在调用的方法在 ArrayList `<E`> 的 javadoc 中定义为

```
boolean contains(Object o)
    Returns true if this list contains the specified element. 
```

代替

```
boolean contains(E o)
    Returns true if this list contains the specified element. 
```

ArrayList.java的实现：

```
private transient Object elementData[];

public boolean contains(Object elem) {
    return indexOf(elem) >= 0;
}

public int indexOf(Object elem) {
    if (elem == null) {
        for (int i = 0; i < size; i++)
            if (elementData[i]==null)
                return i;
    } else {
        for (int i = 0; i < size; i++)
            if (elem.equals(elementData[i]))
                return i;
    }
    return -1;
} 
```

它使用 Object 超类中定义的 equals 方法，因为在 ArrayList `<E`> 的实现中未覆盖 equals 方法。

在 java 中重写 Object equals 时，您也应该重写 Object hashCode 方法。

无论如何，您可能想尝试以下代码：

```
class A{    
    public int content;    
    A(){
        this(0);
    }    
    A(int value){
        content = value;
    }   
    public boolean equals(Object obj){
        System.out.println("overriding equals method");
        return this.content == ((A) obj).content;
    }    
    public boolean equals(A a){
        System.out.println("overloading equals method");
        return this.content == a.content;
    }    
    public static void main(String[] args){
        A x = new A(1);
        A y = new A(2);
        Object z  = new A(1);
        System.out.println(x.equals(y));
        System.out.println(x.equals(x));
        System.out.println(x.equals(z));
        //override as z is declared as Object at compile time
        //so it will use methods in class Object instead of class A
        System.out.println(x.equals((Object) y));
        System.out.println(x.equals((Object) x));        
    }   
}
//rant: they didn't teach me these in javaschool and I had to learn it the hard way. 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-21T19:44:06.123

有不同类型的[http://en.wikipedia.org/wiki/Polymorphism_(computer_science)](http://en.wikipedia.org/wiki/Polymorphism_(computer_science))。java 不做[http://en.wikipedia.org/wiki/Double_dispatch](http://en.wikipedia.org/wiki/Double_dispatch)。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-21T19:47:32.203

contains(Object) 方法的 ArrayList 实现必然会在内部使用 Object.equals(Object) 方法，因此它永远不会知道您重载了 equals(MyClass) 方法。只会找到一个覆盖方法（具有匹配的签名）。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-11-21T19:39:26.883

好的，让我重新措辞。

（1）因为编译器消除了与泛型有关的所有信息（擦除，请参见[此处](http://www.angelikalanger.com/GenericsFAQ/FAQSections/TechnicalDetails.html#Type%20Erasure)），以及（2）因为您无法覆盖没有完全相同签名（equals（Object））的方法，（3）在运行时所有对象在List 被视为对象，而不是 MyClass 的实例。因此，被调用的方法是 equals(Object)，因为这是被您的类覆盖的方法。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-11-21T19:53:26.417

您假设 in 中的`contains()`方法在`List`运行时知道对象的类型，这是不正确的。

由于擦除，在运行时`List<MyClass>`只是一个常规`List`，因此该`contains()`方法将其参数视为一个`Object`，因此调用对象而不是您在其执行中`equals()`定义的对象。`MyClass`

# installation - VDPROJ 自动升级与卸载/重新安装

> ID：309895
> 
> 赞同：9
> 
> 时间：2008-11-21T19:28:46.670
> 
> 标签：installation, windows-installer, vdproj

我看到了关于由 VDPROJ 文件生成的 MSI 文件的令人困惑的行为。如果我在 Visual Studio 中构建我的 MSI，然后右键单击并从 Visual Studio 中选择“安装”，它将自动卸载已安装的任何版本，然后安装新的 MSI。

但是，如果获取生成的 MSI 并直接运行它，如果已经安装了以前的版本，它会报错。我必须先明确卸载它（在添加/删除程序中）。

这是怎么回事？是否有 Visual Studio 执行 MSI 的命令行参数？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-21T19:33:49.017

是的，Visual Stuido 将在运行您的安装时将[RE](https://docs.microsoft.com/en-us/windows/desktop/msi/reinstall) ​​INSTALLMODE和[REINSTALL](https://docs.microsoft.com/en-us/windows/desktop/msi/reinstallmode)属性传递给 Windows 安装程序

就像是：

```
msiexec /i your.msi REINSTALLMODE=vomus REINSTALL=ALL 
```

检查上面链接的 MSDN 文档以查看这些选项的作用

编辑：
现在我想起来了。Studio 也可能只是先使用 /x 命令行参数卸载您的应用程序

```
msiexec /x <package> or <product code> 
```

也许其他人可以确认正在使用哪个？

# html - 在 Flex 中显示 HTML 的最佳方式是什么？

> ID：309897
> 
> 赞同：7
> 
> 时间：2008-11-21T19:29:26.480
> 
> 标签：html, apache-flex, actionscript, text

我的 HTML 包含诸如商标“TM”之类的符号作为上标 (™)。在普通 HTML 中，我会使用`"&trade;"`或`&#153;`显示商标 TM。但是，我找不到将这样的 HTML 导入 Flex 并使其正确显示的方法。我对`<li>`标签有类似的问题。

我的 HTML：

```
<p>This information is intellectual property of My Company&#153;.</p>

<p>Available features:</p>

<li>Feature 1</li>
<li>Feature 2</li>
<li>Feature 3</li>
<li>Feature 4</li>

<p>COPYRIGHT INFORMATION:</p>

<p>Copyright &#169; 2008, My Company. All rights reserved.</p> 
```

我让它工作的唯一方法是将内容直接复制并粘贴到 Flex 中：

```
<mx:Text width="100%" height="100%">
    <mx:htmlText>
        <![CDATA[
This information is intellectual property of My Company™. 

Available features:

•   Feature 1
•   Feature 2
•   Feature 3
•   Feature 4

COPYRIGHT INFORMATION:

Copyright © 2008, My Company. All rights reserved. 
        ]]>
    </mx:htmlText>
</mx:Text> 
```

我想使用一个可以在运行时导入到我的 Flex 应用程序中的外部 HTML 文件，这样我就不必为简单的内容更改重新编译应用程序。

我听说 iFrame 选项有太多问题，所以我想尽可能避免这种情况。

有没有人有任何其他好的建议来处理这个问题？

谢谢你。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-24T18:46:08.517

好吧，这是一个棘手的问题。我刚刚完成了一个项目，我们使用这个开源库来显示 HTML： [http ://code.google.com/p/flex-htmlfilter](http://code.google.com/p/flex-htmlfilter)

它处理列表、表格等，并且非常容易使用。但是，我认为它不支持商标符号。不过，它确实支持其他一些。

我正在使用它从 CMS 中提取内容并显示在我的 Flash 电影中。它工作得很好，并为我提供了我需要的所有 Flash 样式灵活性。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-10-31T18:39:20.690

我不知道这是否是解决所有问题的好方法，但是如果您想使用 RichText 控件，您可以将 FlowText 加载到其中，这样您就可以使用更多 HTML，包括上标和其他字形，就像您想要的一样使用。

[如何在flex中使用上标？](https://stackoverflow.com/questions/4601507/how-to-use-superscripting-in-flex/13164076#13164076)

# javascript - 如何在 Javascript 中打开许多新窗口？

> ID：309921
> 
> 赞同：1
> 
> 时间：2008-11-21T19:37:48.947
> 
> 标签：javascript, popup

想知道如何使用 Javascript 打开许多新窗口。我在互联网上找到了很多地方，向您展示如何使用 Javascript 打开新的浏览器窗口，但我想打开一个新的 UNIQUE 窗口。例如。

我在一个页面上有两个链接。用户单击两个链接，它们都在同一个窗口中打开。我希望每个链接都用 JAVASCRIPT 打开一个新窗口。

另一个例子。 **我刚刚用 javascript 打开了一个窗口，我在新打开的窗口中有一个链接。我单击该链接，它会在同一个窗口中打开。我想用 JAVASCRIPT 将它从那个窗口中弹出，而不是使用同一个窗口。**

帮助？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-21T19:41:00.420

```
window.open('page.html','WindowTitle','width=400,height=200') 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-21T20:42:42.387

就像之前的海报说的，你想要`window.open(...)`

```
var WindowObjectReference = window.open(strUrl, strWindowName [, strWindowFeatures]); 
```

[https://developer.mozilla.org/En/DOM/Window.open](https://developer.mozilla.org/En/DOM/Window.open)

确保`strWindowName`每次调用都不同，因为这决定了在哪个窗口中打开 URL。

# c++ - 在 C++ 中，为什么语言不强制对类/结构的公共、私有和受保护成员进行分组？

> ID：309922
> 
> 赞同：2
> 
> 时间：2008-11-21T19:38:43.093
> 
> 标签：c++, private, public, protected, access-specifier

仅允许逻辑分组吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-21T19:41:15.817

它为您提供灵活性。例如，您可能有一堆构造函数，一些是公共的，一些是受保护的，一些是私有的——您不希望它们全部组合在一起吗？

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-21T20:16:17.010

你为什么要强迫它？它根本不会帮助编译器，它不会客观地使人们更容易阅读。C/C++ 哲学的一部分是该语言不会制定不启用某种特性/功能的任意规则。

它确实使代码生成变得更加容易。许多编码风格对每个类多次使用访问说明符——首先定义所有局部类型，然后定义所有构造函数，然后定义所有方法，然后定义所有实例变量，等等......

C++ 为您提供了足够的绳索，足以让您自食其果，但同样的灵活性可以让您构建优雅、可维护且抽象良好的应用程序。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-21T19:41:57.127

我认为你是对的。不强制使用它可以让用户按照他们认为合适的方式对事物进行分组，以获得更好的代码可读性。

编译器可能会在内存中以不同的方式组织事物。

**编辑**：根据规范：

> §9.2 第 12 条（1998 年和 2003 年标准）：
> 
> 在没有中间访问说明符的情况下声明的（非联合）类的非静态数据成员被分配，以便后面的成员在类对象中具有更高的地址。由访问说明符分隔的非静态数据成员的分配顺序未指定 (11.1)。实现对齐要求可能会导致两个相邻的成员不会被立即分配；管理虚拟功能 (10.3) 和虚拟基类 (10.1) 的空间要求也是如此。

我在[相关的 SO 问题中找到了此信息](https://stackoverflow.com/questions/281045/do-classstruct-members-always-get-created-in-memory-in-the-order-they-were-decl)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-21T20:13:28.373

我实际上以一种有点不愉快的方式利用了这一点：我经常使用的代码习惯是私有成员，具有公共访问器功能。

我有一个宏（不寒而栗），它会从一行自动生成这些。

例子：

```
PROPERTY(int, MyVal); 
```

...生成：...

```
private:
  int fMyVal;
public:
  void setMyVal(const int f) { fMyVal = f; };
  int getMyVal() { return fMyVal; }; 
```

只要您记住 PROPERTY 宏会切换当前的可见性，这就可以正常工作，这并不令人愉快....

例如：

```
protected:
  int v1;
  PROPERTY (int, v2) // fv2 is  private with public accessors
  int v3;  // whoops. f3 is public, 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-21T19:46:32.827

我的猜测是它是 C 哲学的产物，它假设您知道自己在做什么，并为您提供最大的灵活性。这就像在 if 语句中允许单个 = 一样。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-21T21:40:10.320

在“The C++ Programming Language, 3rd edition”中，Stroustrup 说这是为了使代码生成更容易。

尽管实际二进制文件中每个字段的位置是基于在源代码中声明该字段的顺序是有意义的，但是这允许某人保持与 C 甚至其他语言/规范的某种布局兼容性。

# sql - 带有 OR 的 SELECT，包括表连接

> ID：309930
> 
> 赞同：0
> 
> 时间：2008-11-21T19:41:48.500
> 
> 标签：sql

我有一个包含三个表的数据库：Books（包含书籍详细信息，PK 是 CopyID）、Keywords（关键字列表，PK 是 ID）和 KeywordsLink，它是 Books 和带有字段 ID 的关键字之间的多对多链接表， BookID 和 KeywordID。

我正在尝试在我的应用程序中创建一个高级搜索表单，您可以在其中搜索各种条件。目前，我使用 Title、Author 和 Publisher（全部来自 Book 表）。它产生如下 SQL：

```
SELECT * FROM Books WHERE Title Like '%Software%' OR Author LIKE '%Spolsky%'; 
```

我想将此搜索扩展到使用标签进行搜索 - 基本上是添加另一个 OR 子句来搜索标签。我试图通过执行以下操作来做到这一点

```
SELECT *
    FROM Books, Keywords, Keywordslink
    WHERE Title LIKE '%Joel%'
       OR (Name LIKE '%good%' AND BookID=Books.CopyID AND KeywordID=Keywords.ID) 
```

我认为使用方括号可能会将第二部分分隔成自己的有点子句，因此仅在该部分中评估了联接-但似乎并非如此。它给我的只是一长串满足这`Title LIKE '%Joel%'`一点的一本书的多份副本。

有没有办法使用纯 SQL 来做到这一点，或者我必须使用两个 SQL 语句并将它们组合到我的应用程序中（在此过程中删除重复项）。

如果这很重要，我目前正在使用 MySQL，但该应用程序使用 ODBC，我希望使其与 DB 无关（甚至可能最终使用 SQLite 或拥有它，以便用户可以选择要使用的 DB）。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-21T19:47:48.393

您需要将 3 个表连接在一起，从而为您提供一个表格结果集。然后，您可以检查您喜欢的任何列，并确保您得到*不同的*结果（即没有重复）。

像这样：

```
select distinct b.*
from books b
left join keywordslink kl on kl.bookid = b.bookid
left join keywords k on kl.keywordid = k.keywordid
where b.title like '%assd%'
or k.keyword like '%asdsad%' 
```

您还应该尽量避免以百分号 (%) 开头的 LIKE 值，因为这意味着 SQL Server 不能在该列上使用索引，并且必须执行完整（和慢速）表扫描。这开始使您的查询成为“开始于”查询。

也可以考虑 SQL Server 中的全文搜索选项。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-21T19:48:01.390

您在这里所做的是通过用逗号连接表格但没有任何连接条件来制作笛卡尔结果集。将您的语句切换为使用外部连接语句，这应该允许您引用关键字。我不知道你的架构，但也许这样的事情会起作用：

```
SELECT 
  * 
FROM 
  Books 
  LEFT OUTER JOIN KeywordsLink ON KeywordsLink.BookID = Books.CopyID 
  LEFT OUTER JOIN Keywords ON Keywords.ID = KeywordsLink.KeywordID 
WHERE Books.Title LIKE '%JOEL%' 
      OR Keywords.Name LIKE '%GOOD%' 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-21T19:48:45.507

使用`UNION`.

```
(SELECT Books.* FROM <first kind of search>)
UNION
(SELECT Books.* FROM <second kind of search>) 
```

关键是您可以编写两个（或更多）简单而有效的查询，而不是一个试图一次完成所有事情的复杂查询。

如果结果行数很少，那么`UNION`开销就会很小（`UNION ALL`如果你没有重复或不关心它们，你可以使用更快）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-21T19:46:36.633

```
SELECT * FROM books WHERE title LIKE'%Joel%' OR bookid IN 
         (SELECT bookid FROM keywordslink WHERE keywordid IN
         (SELECT id FROM keywords WHERE name LIKE '%good%')) 
```

注意旧版本的 MySQL 不喜欢子选择。我认为他们已经解决了这个问题。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-21T19:48:28.347

您还必须通过指定类似的东西来限制连接的产品

> ```
> Books.FK1 = 关键字.FK1 和
> Books.FK2 = 关键字link.FK2 和
> 关键字.FK3 = 关键字链接.FK3
> ```

但我不知道您的确切数据模型，因此您的解决方案可能略有不同。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-21T19:49:35.303

我不知道有什么方法可以在 SQL 中完成“条件连接”。我认为最好分别执行这两个语句并将它们组合在应用程序中。这种方法也更有可能保持与 DB 无关。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-21T21:23:32.540

看起来尼尔巴恩威尔已经涵盖了我会给出的答案，但我会添加一件事......

书籍可以有多个作者。如果您的数据模型真的按照您的查询所暗示的那样设计，您可能需要考虑更改它以适应这一事实。

# c# - 您应该跨项目使用部分类吗？

> ID：309939
> 
> 赞同：49
> 
> 时间：2008-11-21T19:45:31.940
> 
> 标签：c#, partial-classes

我有一个包含所有数据库逻辑的类库。我的 DAL/BLL。

我有几个 Web 项目将使用相同的数据库和类，所以我认为将数据层抽象到自己的项目中是个好主意。

但是，在为某些项目的类添加功能时，我想为某些类添加方法。

例如，我的数据层有 Product 和 SomeItem 对象：

```
// Data Access Layer project

namespace DAL {
  public class Product { 
     //implementation here 
  }

  public class SomeItem {
     //implementation here 
  }
} 
```

在一个项目中，我想添加一个由不同内容项使用的接口，所以我有一个名为：

```
// This is in Web Project
namespace DAL {
  public partial class Product : ICustomBehaviour {

    #region ICustomBehaviour Implementation
       TheSharedMethod();
    #endregion
  }
} 
```

***使用相同*的命名空间在单独的项目（创建依赖项）中编写部分类是个好主意吗？如果这是一个坏主意，我怎样才能让这种类型的功能发挥作用？**

它似乎不想在编译时合并它们，所以我不确定我做错了什么。

* * *

## 回答 #1

> 赞同：90
> 
> 时间：2008-11-21T19:46:59.537

您不能跨项目编写部分类。部分类是仅编译时的句法糖——整个类型以单个程序集结束，即一个项目。

（顺便说一句，您的原始 DAL 文件也必须声明该类是部分的。）

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2018-01-16T09:15:50.000

使用 Visual Studio 2015 及更高版本**，可以**跨项目拆分部分类：使用[共享项目](https://stackoverflow.com/q/30634753/814206 "Visual Studio 2015 中的共享项目和类库有什么区别？ - 堆栈溢出")（另请参阅[此 MSDN 博客](https://blogs.msdn.microsoft.com/dotnet/2014/04/21/sharing-code-across-platforms/ "跨平台共享代码 |  .NET 博客")）。

对于我的情况，我需要以下内容：

*   一个类库，它定义了一些被多个客户端应用程序用作接口的类。
*   客户端应用程序。
*   在数据库中创建表的设置应用程序。
    由于安装程序的限制，此设置必须是独立的。它不能引用 .NET 框架之外的任何程序集。设置应该将一些枚举常量插入到表中，因此理想情况下它应该引用类库。
    该设置可以导入共享项目。
*   由于共享项目类似于复制粘贴代码，所以我想尽可能少地移动到共享项目中。

以下示例演示了部分类和共享项目如何允许将类拆分到不同的项目中。

在类库中，Address.cs：

```
namespace SharedPartialCodeTryout.DataTypes
{
    public partial class Address
    {
        public Address(string name, int number, Direction dir)
        {
            this.Name = name;
            this.Number = number;
            this.Dir = dir;
        }

        public string Name { get; }
        public int Number { get; }
        public Direction Dir { get; }
    }
} 
```

类库是一个普通的 Visual Studio 类库。它导入 SharedProject，除此之外它的 .csproj 没有什么特别之处：

```
<?xml version="1.0" encoding="utf-8"?>
<Project ToolsVersion="15.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <Import Project="$(MSBuildExtensionsPath)\$(MSBuildToolsVersion)\Microsoft.Common.props" Condition="Exists('$(MSBuildExtensionsPath)\$(MSBuildToolsVersion)\Microsoft.Common.props')" />
  <PropertyGroup>
<!-- standard Visual Studio stuff removed -->
    <OutputType>Library</OutputType>
<!-- standard Visual Studio stuff removed -->
  </PropertyGroup>
<!-- standard Visual Studio stuff removed -->
  <ItemGroup>
    <Reference Include="System" />
  </ItemGroup>
  <ItemGroup>
    <Compile Include="Address.cs" />
    <Compile Include="Properties\AssemblyInfo.cs" />
  </ItemGroup>
  <Import Project="..\SharedProject\SharedProject.projitems" Label="Shared" />
  <Import Project="$(MSBuildToolsPath)\Microsoft.CSharp.targets" />
</Project> 
```

`Address.Direction`在 SharedProject 中实现：

```
namespace SharedPartialCodeTryout.DataTypes
{
    public partial class Address
    {
        public enum Direction
        {
            NORTH,
            EAST,
            SOUTH,
            WEST
        }
    }
} 
```

SharedProject.shproj 是：

```
<?xml version="1.0" encoding="utf-8"?>
<Project ToolsVersion="15.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <PropertyGroup Label="Globals">
    <ProjectGuid>33b08987-4e14-48cb-ac3a-dacbb7814b0f</ProjectGuid>
    <MinimumVisualStudioVersion>14.0</MinimumVisualStudioVersion>
  </PropertyGroup>
  <Import Project="$(MSBuildExtensionsPath)\$(MSBuildToolsVersion)\Microsoft.Common.props" Condition="Exists('$(MSBuildExtensionsPath)\$(MSBuildToolsVersion)\Microsoft.Common.props')" />
  <Import Project="$(MSBuildExtensionsPath32)\Microsoft\VisualStudio\v$(VisualStudioVersion)\CodeSharing\Microsoft.CodeSharing.Common.Default.props" />
  <Import Project="$(MSBuildExtensionsPath32)\Microsoft\VisualStudio\v$(VisualStudioVersion)\CodeSharing\Microsoft.CodeSharing.Common.props" />
  <PropertyGroup />
  <Import Project="SharedProject.projitems" Label="Shared" />
  <Import Project="$(MSBuildExtensionsPath32)\Microsoft\VisualStudio\v$(VisualStudioVersion)\CodeSharing\Microsoft.CodeSharing.CSharp.targets" />
</Project> 
```

它的 .projiitems 是：

```
<?xml version="1.0" encoding="utf-8"?>
<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <PropertyGroup>
    <MSBuildAllProjects>$(MSBuildAllProjects);$(MSBuildThisFileFullPath)</MSBuildAllProjects>
    <HasSharedItems>true</HasSharedItems>
    <SharedGUID>33b08987-4e14-48cb-ac3a-dacbb7814b0f</SharedGUID>
  </PropertyGroup>
  <PropertyGroup Label="Configuration">
    <Import_RootNamespace>SharedProject</Import_RootNamespace>
  </PropertyGroup>
  <ItemGroup>
    <Compile Include="$(MSBuildThisFileDirectory)Address.Direction.cs" />
  </ItemGroup>
</Project> 
```

常规客户使用`Address`包括`Address.Direction`：

```
using SharedPartialCodeTryout.DataTypes;
using System;

namespace SharedPartialCodeTryout.Client
{
    class Program
    {
        static void Main(string[] args)
        {
            // Create an Address
            Address op = new Address("Kasper", 5297879, Address.Direction.NORTH);
            // Use it
            Console.WriteLine($"Addr: ({op.Name}, {op.Number}, {op.Dir}");
        }
    }
} 
```

常规客户端 csproj 引用类库而**不是**SharedProject：

```
<?xml version="1.0" encoding="utf-8"?>
<Project ToolsVersion="15.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <Import Project="$(MSBuildExtensionsPath)\$(MSBuildToolsVersion)\Microsoft.Common.props" Condition="Exists('$(MSBuildExtensionsPath)\$(MSBuildToolsVersion)\Microsoft.Common.props')" />
  <PropertyGroup>
<!-- Removed standard Visual Studio Exe project stuff -->
    <OutputType>Exe</OutputType>
<!-- Removed standard Visual Studio Exe project stuff -->
  </PropertyGroup>
<!-- Removed standard Visual Studio Exe project stuff -->
  <ItemGroup>
    <Reference Include="System" />
  </ItemGroup>
  <ItemGroup>
    <Compile Include="Program.cs" />
    <Compile Include="Properties\AssemblyInfo.cs" />
  </ItemGroup>
  <ItemGroup>
    <None Include="App.config" />
  </ItemGroup>
  <ItemGroup>
    <ProjectReference Include="..\SharedPartialCodeTryout.DataTypes\SharedPartialCodeTryout.DataTypes.csproj">
      <Project>{7383254d-bd80-4552-81f8-a723ce384198}</Project>
      <Name>SharedPartialCodeTryout.DataTypes</Name>
    </ProjectReference>
  </ItemGroup>
  <Import Project="$(MSBuildToolsPath)\Microsoft.CSharp.targets" />
</Project> 
```

DbSetup 仅使用枚举：

DbSetup.csproj 不引用类库；它只导入 SharedProject：

```
<?xml version="1.0" encoding="utf-8"?>
<Project ToolsVersion="15.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <Import Project="$(MSBuildExtensionsPath)\$(MSBuildToolsVersion)\Microsoft.Common.props" Condition="Exists('$(MSBuildExtensionsPath)\$(MSBuildToolsVersion)\Microsoft.Common.props')" />
  <PropertyGroup>
<!-- Removed standard Visual Studio Exe project stuff -->
    <OutputType>Exe</OutputType>
<!-- Removed standard Visual Studio Exe project stuff -->
  <?PropertyGroup>
<!-- Removed standard Visual Studio Exe project stuff -->
  <ItemGroup>
    <Reference Include="System" />
    <Reference Include="Microsoft.CSharp" />
  </ItemGroup>
  <ItemGroup>
    <Compile Include="Program.cs" />
    <Compile Include="Properties\AssemblyInfo.cs" />
  </ItemGroup>
  <ItemGroup>
    <None Include="App.config" />
  </ItemGroup>
  <Import Project="..\SharedProject\SharedProject.projitems" Label="Shared" />
  <Import Project="$(MSBuildToolsPath)\Microsoft.CSharp.targets" />
</Project> 
```

总结：

> 您可以跨项目拆分部分课程吗？

是的，使用 Visual Studio 的共享项目。

> 使用相同的命名空间在单独的项目（创建依赖项）中编写部分类是个好主意吗？

通常不是（见其他答案）；在某些情况下，如果您知道自己在做什么，它会很方便。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-12-20T19:53:40.020

我无法回答您关于组织图层的最佳方式的问题，但我可以尝试回答您关于如何最好地模拟部分类的问题。

这里有一些想法：

*   首先想到的是继承。它不一定总是最好的解决方案，但您可能别无选择，因为您可能需要能够让您的对象能够像基类一样被对待。
*   组合也是一个不错的选择（即将类包装在另一个类中）。这使您可以更好地与 DAL 解耦，但实施起来可能很乏味。
*   如果你真的只需要在现有类上添加一两个方法，你也可以考虑使用[扩展方法](http://msdn.microsoft.com/en-us/library/bb383977.aspx)，但是如果你使用它们太多，它们会很快创建意大利面条代码。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-11-21T19:48:01.280

部分类必须存在于同一个程序集中。否则，编译器将如何决定将部分类合并到哪里？

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-21T19:53:05.793

我同意 Jon Skeet 的回答。

我认为无论如何处理这样的问题都不是一个好的选择。已经有很好的设计模式展示了分割代码层/层的最佳方法，这只是一个语法糖，以便微软可以将 WinForms/WebForms 设计器文件分开并防止人们破坏它们。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-03-11T19:15:28.563

我看不出这个方案不起作用的原因：

两个文件包含存储机制（或其他一些功能）。它们指定继承但不包含业务逻辑：

*   ProductDataAccess.cs
*   ProductWeb.cs

一个文件包含业务逻辑：

*   ProductBusinessLogic.cs

现在创建两个项目：

*   WebProject 包含 ProductWeb.cs 和 ProductBusinessLogic.cs。
*   DataProject 包含 ProductDataAccess.cs 和 ProductBusinessLogic.cs

两个项目都使用相同的业务逻辑。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-20T19:36:50.493

虽然我同意 Neil 关于 pre-linq 开发的观点，但我也希望我能够做到这一点，以便将业务逻辑与 Linq2SQL 设计器生成的部分类分开。例如：

```
Northind.DAL (prj)
-NorthindDataContext (EntityNamespace set to "Northwind.BLL")
--Product() (Entity, partial class auto-generated)
--Category() (Entity, partial class auto-generated)
--Supplier() (Entity, partial class auto-generated)

Northind.BLL (prj)
-Product() : IMyCustomEnityInterface, BaseEntity (override OnValidate(), etc)
-Category() : IMyCustomEnityInterface, BaseEntity (override OnValidate(), etc)
-Supplier() : IMyCustomEnityInterface, BaseEntity (override OnValidate(), etc) 
```

不幸的是，我们不能这样做......实际上我很想知道在使用 LINQ 时推荐的分割层/层的方法。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2014-05-22T15:39:45.790

不可以。你不能在不同的项目中编写部分类。因为编译器一次只获得一个项目进行编译，因此只扫描该项目中的类、方法、字段等列表。所以如果你有部分类的某些部分在其他项目，编译器找不到那些。

# regex - 如何编写只返回“I”，后跟“J”或“V”，然后是 1 到 3 个数字的正则表达式？

> ID：309943
> 
> 赞同：1
> 
> 时间：2008-11-21T19:46:41.783
> 
> 标签：regex

需要一个仅返回带有“I”的表达式，后跟“J”或“V”（无引号），然后至少包含 1 个数字，最多 3 个数字。

IJ###
IV###
IJ##
IV##
IJ#
I v#

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-21T19:48:33.090

取决于你的口味

```
I(J|V)[0-9]{1,3} 
```

“我”之后还需要一个空格吗？

```
I (J|V)[0-9]{1,3} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-21T19:49:00.780

您的描述与您的示例不符，并且您需要注意一些惯用的事情（不区分大小写，这取决于正则表达式引擎）

```
I [JV]\d{1,3} 
```

这将匹配

*   我J1
*   我J12
*   我J123
*   我V1
*   我 V12
*   我V123

但不会匹配

*   我 1
*   我 12
*   我123

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-21T19:50:21.150

使用 RegExBuddy 测试：

我[合资]\d{1,3}\s

编辑：

很像 Vinko Vrsalovic 之一，但如果你有 I J12345678，它会在你的表情中抓住“I J123”。添加 \s 需要在末尾添加一个特殊字符，例如空格、换行符等...

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-21T23:29:29.743

我认为其他人错过了`v#`规范。

```
I[JVv]\d{1,3} 
```

当然，也许小写字母`v`是一个错字。

# python - 如何显式引用字符串值（Python DB API/Psycopg2）

> ID：309945
> 
> 赞同：29
> 
> 时间：2008-11-21T19:47:11.657
> 
> 标签：python, sql, django, psycopg2

由于某些原因，我想对字符串值进行显式引用（成为构造 SQL 查询的一部分），而不是等待`cursor.execute`方法对其第二个参数的内容执行隐式引用。

“隐式引用”是指：

```
value = "Unsafe string"
query = "SELECT * FROM some_table WHERE some_char_field = %s;"
cursor.execute( query, (value,) ) # value will be correctly quoted 
```

我更喜欢这样的东西：

```
value = "Unsafe string"
query = "SELECT * FROM some_table WHERE some_char_field = %s;" % \
    READY_TO_USE_QUOTING_FUNCTION(value)
cursor.execute( query ) # value will be correctly quoted, too 
```

Python DB API 规范是否期望如此低的级别（我在[PEP 249](http://www.python.org/dev/peps/pep-0249/)文档`READY_TO_USE_QUOTING_FUNCTION`中找不到这样的功能）。如果没有，也许 Psycopg2 提供了这样的功能？如果没有，也许 Django 提供了这样的功能？我不想自己写这样的函数......

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2008-11-23T11:47:54.167

好的，所以我很好奇，去看了psycopg2的来源。原来我不必比示例文件夹走得更远:)

是的，这是特定于 psycopg2 的。基本上，如果你只想引用一个字符串，你可以这样做：

```
from psycopg2.extensions import adapt

print adapt("Hello World'; DROP DATABASE World;") 
```

但是您可能想要做的是编写和注册自己的适配器；

在 psycopg2 的示例文件夹中，您可以找到文件[“myfirstrecipe.py”](http://sourcecodebrowser.com/psycopg2/2.4.5/myfirstrecipe_8py_source.html)，其中有一个如何以特殊方式转换和引用特定类型的示例。

如果你有你想做的事情的对象，你可以只创建一个符合“IPsycopgSQLQuote”协议的适配器（请参阅 pydocs 以获取 myfirstrecipe.py-example ......实际上这是我能找到的唯一参考该名称) 引用您的对象，然后像这样注册它：

```
from psycopg2.extensions import register_adapter

register_adapter(mytype, myadapter) 
```

此外，其他示例也很有趣。尤其是 ['dialtone.py'](http://sourcecodebrowser.com/psycopg2/2.4.5/dialtone_8py_source.html)和['simple.py'](http://sourcecodebrowser.com/psycopg2/2.4.5/simple_8py_source.html)。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2014-07-05T20:46:46.157

我猜你正在寻找[mogrify](http://initd.org/psycopg/docs/cursor.html#cursor.mogrify)功能。

例子：

```
>>> cur.mogrify("INSERT INTO test (num, data) VALUES (%s, %s)", (42, 'bar'))
"INSERT INTO test (num, data) VALUES (42, E'bar')" 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-22T00:01:40.737

你应该尽量避免自己引用。正如人们指出的那样，它不仅是特定于数据库的，而且引用中的缺陷是 SQL 注入错误的根源。

如果您不想单独传递查询和值，请传递参数列表：

```
def make_my_query():
    # ...
    return sql, (value1, value2)

def do_it():
    query = make_my_query()
    cursor.execute(*query) 
```

（我可能有 cursor.execute 的语法错误）这里的重点是，仅仅因为 cursor.execute 接受了许多参数，这并不意味着你必须单独处理它们。您可以将它们作为一个列表来处理。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-21T20:25:48.990

这将取决于数据库（iirc，mysql 允许`\`作为转义字符，而像 oracle 之类的东西希望引号加倍：） `'my '' quoted string'`。

如果我错了，有人纠正我，但双引号方法是标准方法。

可能值得看看其他数据库抽象库做了什么（sqlalchemy、cx_Oracle、sqlite 等）。

我不得不问 - 你为什么要内联值而不是绑定它们？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-21T20:07:31.693

这将取决于数据库。例如，在 MySQLdb 的情况下，`connection`该类有一个`literal`方法可以将值转换为正确的转义表示以传递给 MySQL（这就是`cursor.execute`使用的方法）。

我想 Postgres 有类似的东西，但我认为作为 DB API 2.0 规范的一部分，我不认为有一个函数可以转义值。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-23T15:17:20.810

我认为您没有给出任何充分的理由来避免这样做是正确的方式。请按照设计使用 APi，不要太努力地使您的代码对下一个人来说可读性降低，并且变得更脆弱。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-12-12T21:09:27.313

[根据psycopg 扩展文档](http://initd.org/psycopg/docs/extensions.html)，您的代码片段会像这样

```
from psycopg2.extensions import adapt

value = "Unsafe string"
query = "SELECT * FROM some_table WHERE some_char_field = %s;" % \
    adapt(value).getquoted()
cursor.execute( query ) # value will be correctly quoted, too 
```

该`getquoted`函数`value`以带引号和转义字符串的形式返回 ，因此您也可以使用：`"SELECT * FROM some_table WHERE some_char_field = " + adapt(value).getquoted()`。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2019-01-29T18:41:58.037

[PyPika](https://pypi.org/project/PyPika/)是构建 SQL 语句的另一个不错的选择。使用示例（基于项目主页上的示例）：

```
>>> from pypika import Order, Query
>>> Query.from_('customers').select('id', 'fname', 'lname', 'phone').orderby('id', order=Order.desc)
SELECT "id","fname","lname","phone" FROM "customers" ORDER BY "id" DESC 
```

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2008-11-23T14:39:48.220

如果您使用 django，您可能希望使用自动适应当前配置的 DBMS 的引用功能：

```
from django.db import backend
my_quoted_variable = backend.DatabaseOperations().quote_name(myvar) 
```

* * *

## 回答 #10

> 赞同：-2
> 
> 时间：2013-02-07T23:32:41.990

```
import re

def db_quote(s):
  return "\"" + re.escape(s) + "\"" 
```

可以完成至少适用于 MySQL 的简单引用工作。我们真正需要的是 cursor.format() 函数，它可以像 cursor.execute() 一样工作，除了它会返回结果查询而不是执行它。有时您不希望查询完全执行 - 例如，您可能希望先记录它，或者在继续之前将其打印出来进行调试。

# asp.net-mvc - 任何人都可以推荐一个 ASP.NET MVC 群聊控件吗？

> ID：309947
> 
> 赞同：1
> 
> 时间：2008-11-21T19:47:46.977
> 
> 标签：asp.net-mvc, components, chat

我需要在 ASP.NET MVC 网页上提供一个窗口，该网站的注册用户可以在其中进行实时群聊。

任何人都可以推荐一个可以提供我可以嵌入到 ASP.NET MVC 页面上的实时群聊的组件或控件吗？

我愿意使用免费或商业组件，以及网络服务。

我研究了一些 web 2.0 方法，例如：

*   Campfire - 问题是，它会将您带到一个单独的站点，并且我无法嵌入聊天窗口（至少在我联系支持人员时他们是这么说的）
*   Meebo - 要求用户拥有 Meebo 帐户（我认为）

这里的独特之处在于我需要使站点用户能够彼此实时聊天 - 而不是与中央支持人员（如 LivePerson 或 Meebo 小部件）。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-21T19:52:53.983

您真正需要的只是一个向其发布新消息的操作、一个轮询更新的操作以及一个放置项目的 div。

您可以使用 ajax 和在 ASP.NET MVC 中的 ChatController 上的这两个操作轻松完成所有这些操作。

不过，对于 Campfire +1，它是一个非常完善的工具。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-03T00:20:40.120

Campfire 有一个名为[Tinder](http://opensoul.org/2006/12/8/tinder-campfire-api)的非官方开发人员 API 。

[我在这里](http://www.campfirenow.com/?source=37s+home)看到 37 Signals 在他们的网站上宣传它，所以它可能还不错。

# javascript - 使用 JSONP 时如何捕获 jQuery $.getJSON（或数据类型设置为“jsonp”的 $.ajax）错误？

> ID：309953
> 
> 赞同：76
> 
> 时间：2008-11-21T19:48:35.927
> 
> 标签：javascript, jquery, jsonp

将 JSONP 与 jQuery 一起使用时是否可以捕获错误？我已经尝试了 $.getJSON 和 $.ajax 方法，但都不会捕获我正在测试的 404 错误。这是我尝试过的（请记住，这些都可以成功，但是我想在失败时处理这种情况）：

```
jQuery.ajax({
    type: "GET",
    url: handlerURL,
    dataType: "jsonp",
    success: function(results){
        alert("Success!");
    },
    error: function(XMLHttpRequest, textStatus, errorThrown){
        alert("Error");
    }
}); 
```

并且：

```
jQuery.getJSON(handlerURL + "&callback=?", 
    function(jsonResult){
        alert("Success!");
    }); 
```

我也尝试添加 $.ajaxError 但这也不起作用：

```
jQuery(document).ajaxError(function(event, request, settings){
   alert("Error");
}); 
```

提前感谢您的任何回复！

* * *

## 回答 #1

> 赞同：54
> 
> 时间：2013-09-29T07:49:39.967

[这](https://stackoverflow.com/a/19075640/2314737)是我对类似问题的广泛回答。

这是代码：

```
jQuery.getJSON(handlerURL + "&callback=?", 
    function(jsonResult){
        alert("Success!");
    })
.done(function() { alert('getJSON request succeeded!'); })
.fail(function(jqXHR, textStatus, errorThrown) { alert('getJSON request failed! ' + textStatus); })
.always(function() { alert('getJSON request ended!'); }); 
```

* * *

## 回答 #2

> 赞同：51
> 
> 时间：2008-11-21T20:27:54.070

似乎不返回成功结果的 JSONP 请求永远不会触发任何事件，成功或失败，无论好坏，这显然是设计使然。

在搜索他们的错误跟踪器后，有[一个补丁](http://dev.jquery.com/attachment/ticket/3442/jsonabort.patch)可能是使用超时回调的可能解决方案。请参阅[错误报告 #3442](http://dev.jquery.com/attachment/ticket/3442)。如果您无法捕获错误，您至少可以在等待一段合理的成功时间后超时。

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2012-08-03T16:21:54.323

# 检测 JSONP 问题

如果您不想下载依赖项，您可以自己检测错误状态。这简单。

您只能通过使用某种超时来检测 JSONP 错误。如果在特定时间内没有有效的响应，则假设一个错误。不过，错误基本上可以是任何东西。

这是检查错误的简单方法。只需使用一个`success`标志：

```
var success = false;

$.getJSON(url, function(json) {
    success = true;
    // ... whatever else your callback needs to do ...
});

// Set a 5-second (or however long you want) timeout to check for errors
setTimeout(function() {
    if (!success)
    {
        // Handle error accordingly
        alert("Houston, we have a problem.");
    }
}, 5000); 
```

正如评论中提到的黎明骑士，您也可以使用 clearTimeout 代替：

```
var errorTimeout = setTimeout(function() {
    if (!success)
    {
        // Handle error accordingly
        alert("Houston, we have a problem.");
    }
}, 5000);

$.getJSON(url, function(json) {
    clearTimeout(errorTimeout);
    // ... whatever else your callback needs to do ...
}); 
```

为什么？继续阅读...

* * *

## 简而言之，JSONP 的工作原理如下：

JSONP 不像常规 AJAX 请求那样使用 XMLHttpRequest。相反，它会`<script>`在页面中注入一个标签，其中“src”属性是请求的 URL。响应的内容被包装在一个 Javascript 函数中，然后在下载时执行该函数。

**例如。**

JSONP 请求：`https://api.site.com/endpoint?this=that&callback=myFunc`

Javascript 会将这个脚本标签注入到 DOM 中：

```
<script src="https://api.site.com/endpoint?this=that&callback=myFunc"></script> 
```

`<script>`将标签添加到 DOM时会发生什么？显然，它会被执行。

因此，假设对该查询的响应产生了如下 JSON 结果：

```
{"answer":42} 
```

对于浏览器来说，这与脚本的源代码相同，因此它会被执行。但是当你执行这个时会发生什么：

```
<script>{"answer":42}</script> 
```

好吧，没什么。它只是一个对象。它不会被存储、保存，也不会发生任何事情。

这就是 JSONP 请求将其结果包装在一个函数中的原因。必须支持 JSONP 序列化的服务器会看到`callback`您指定的参数，并改为返回：

```
myFunc({"answer":42}) 
```

然后它被执行：

```
<script>myFunc({"answer":42})</script> 
```

...这更有用。在这种情况下，您的代码中的某处是一个名为的全局函数`myFunc`：

```
myFunc(data)
{
    alert("The answer to life, the universe, and everything is: " + data.answer);
} 
```

就是这样。这就是 JSONP 的“魔力”。然后构建超时检查非常简单，如上所示。发出请求，然后立即开始超时。X 秒后，如果您的标志仍未设置，则请求超时。

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2013-09-05T15:46:45.650

我知道这个问题有点老了，但我没有看到一个可以简单解决问题的答案，所以我想我会分享我的“简单”解决方案。

```
$.getJSON("example.json", function() {
      console.log( "success" );
}).fail(function() { 
      console.log( "error" ); 
}); 
```

我们可以简单地使用`.fail()`回调来检查是否发生错误。

希望这可以帮助 ：）

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2010-06-05T20:06:55.363

如果您与提供者合作，您可以发送另一个查询字符串参数作为出现错误时回调的函数。

?callback=?&error=?

这称为 JSONPE，但它根本不是事实上的标准。

然后，提供程序将信息传递给错误函数以帮助您进行诊断。

虽然对通信错误没有帮助 - 必须更新 jQuery 以在超时时回调错误函数，如 Adam Bellaire 的回答。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2010-01-18T12:03:27.280

似乎现在正在工作：

```
jQuery(document).ajaxError(function(event, request, settings){
   alert("Error");
}); 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2012-06-22T15:30:59.717

我用它来捕捉 JSON 错误

```
try {
   $.getJSON(ajaxURL,callback).ajaxError();
} catch(err) {
   alert("wow");
   alert("Error : "+ err);
} 
```

**编辑：**或者，您也可以收到错误消息。这会让你知道错误到底是什么。在 catch 块中尝试以下语法

```
alert("Error : " + err); 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2012-09-13T13:13:34.100

Mayby 这行得通吗？

```
.complete(function(response, status) {
    if (response.status == "404")
        alert("404 Error");
    else{
        //Do something
    }   
    if(status == "error")
        alert("Error");
    else{
        //Do something
    }
}); 
```

我不知道状态何时进入“错误”模式。但我用 404 对其进行了测试，它响应了

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2013-08-02T14:01:49.413

您可以通过在 ajax 请求中添加此属性来显式处理任何错误号：

```
statusCode: {
        404: function() {
          alert("page not found");
        }
    } 
```

所以，你的代码应该是这样的：

```
jQuery.ajax({
type: "GET",
statusCode: {
        404: function() {
          alert("page not found");
        }
},
url: handlerURL,
dataType: "jsonp",
success: function(results){
    alert("Success!");
},
error: function(XMLHttpRequest, textStatus, errorThrown){
    alert("Error");
}
}); 
```

希望这对你有帮助:)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2013-11-28T02:57:51.827

我还在[堆栈**溢出**中发布了这个答案-getJSON 调用中的错误处理](https://stackoverflow.com/questions/1740218/error-handling-in-getjson-calls/20256885#20256885)

我知道已经有一段时间没有人在这里回答了，发帖人可能已经从这里或其他地方得到了他的回答。然而，我确实认为这篇文章将帮助任何寻找在执行 getJSON 请求时跟踪错误和超时的方法的人。因此，在我对问题的回答下方

getJSON 结构如下（可在[http://api.jqueri.com](http://api.jquery.com/jQuery.getJSON/#jQuery-getJSON-url-data-success-data--textStatus--jqXHR- "用于 getJSON 的 jquery api")上找到）：

```
$(selector).getJSON(url,data,success(data,status,xhr)) 
```

大多数人使用

```
$.getJSON(url, datatosend, function(data){
    //do something with the data
}); 
```

他们使用 url var 提供指向 JSON 数据的链接，datatosend 作为添加`"?callback=?"`和其他变量的地方，这些变量必须发送以获取返回的正确 JSON 数据，以及成功函数作为处理数据的函数.

但是，您可以在成功函数中添加状态和 xhr 变量。status 变量包含以下字符串之一：“success”、“notmodified”、“error”、“timeout”或“parsererror”，xhr 变量包含返回的 XMLHttpRequest 对象（[在 w3schools 上找到](http://www.w3schools.com/jquery/ajax_getjson.asp "w3schools 链接到 getJSON")）

```
$.getJSON(url, datatosend, function(data, status, xhr){
    if (status == "success"){
        //do something with the data
    }else if (status == "timeout"){
        alert("Something is wrong with the connection");
    }else if (status == "error" || status == "parsererror" ){
        alert("An error occured");
    }else{
        alert("datatosend did not change");
    }         
}); 
```

这种方式很容易跟踪超时和错误，而无需实现在请求完成后启动的自定义超时跟踪器。

希望这可以帮助仍在寻找这个问题的答案的人。

# plc - 学习PLC编程

> ID：309963
> 
> 赞同：38
> 
> 时间：2008-11-21T19:51:10.603
> 
> 标签：plc

如何学习PLC编程？不同品牌的PLC会有很大的不同吗？梯形图编程和PLC编程一样吗？

* * *

## 回答 #1

> 赞同：59
> 
> 时间：2009-07-22T20:56:41.483

我做了很多 PLC 编程，现在做了很多 .NET 编程。无论哪种方式进行转换都是非常危险的，因为许多您认为应该可以转移的技能（模式等）会让您误入歧途。

我告诉人们的最大区别是PC程序代码应该像其他程序员一样被编写，而PLC程序（梯形逻辑）必须像维护人员一样被编写。大多数设施（尤其是制造）的维护经常直接连接到 PLC，并且在在线模式下，他们可以以图形方式查看代码执行以找出问题所在。

例如，如果输出没有打开，他们会在编程软件的查找功能中输入输出电气设备 ID，找到输出线圈，然后从那里开始追溯寻找问题。一些 PLC 程序员经常犯的错误之一是将他们的 I/O “映射”到一个结构中（在 PLC 中，这些被称为用户定义类型），他们使用复制指令将所有输入或输出移动到结构。从 PC 编程的角度来看是有道理的，但它会让维护人员想杀了你。通常，编程软件提供交叉引用功能，他们可以在其中指定输出线圈，它会告诉他们在程序中的任何地方都使用了它。如果使用复制指令将 I/O 的 10 个字移动到 10 个字的数据结构中，他' s 必须坐在那里数位，以​​确定副本源中的哪个位映射到副本目标端的哪个位。确实，注释可以提供帮助，但也存在问题……PLC 存储整个程序，如果您需要排除故障并且没有原始程序的副本，则允许您在紧急情况下从其中上传程序. 问题是由于空间原因，PLC 不存储注释。因此，如果生产线出现故障，每分钟的停机成本为 5000 美元，而一个人带着笔记本电脑跑出去，他可能不得不在没有评论的情况下快速上传并尝试排除故障。将这些复制说明放在那里，浪费了他 10 分钟的时间，仅仅让公司损失了 50,000 美元的停机时间。这些是您在编写 PLC 程序时必须注意的事项。

其他一些提示：一些 PLC 支持 FOR 循环。 **永远不要**使用它们。出于与上述相同的原因，它们使维护人员很难对代码进行故障排除。这是因为如果您在 PLC 中有一段代码每次扫描多次被扫描（如循环的内容），那么当您进入在线调试模式时，软件无法显示每个代码的值执行此扫描的 10 个循环，所以你真的不知道你在看什么值。然后，您必须编写所有这些棘手的代码，以将特定循环索引的循环值提取到您可以监控的其他一些标签（变量）中。这只是在紧急情况下解决问题的另一个障碍。每次扫描多次使用子程序会遇到同样的问题。

维护人员很难理解间接寻址（我们称之为数组）。当您处理配方管理（存储和检索如何构建零件的值）时，通常可以使用它们，但您应该尽量在程序的控制部分远离它。

在 PC 编程中，我们当然寻求尽可能多地重用代码。然而，在 PLC 和控制系统中，停机时间非常昂贵，硬件也很昂贵。内存很便宜，实际上PLC编程器也很便宜。因此，如果您的机器上有 10 个相同的东西（如传送带驱动器或其他东西），那么您将有 10 个不同的文件（子程序），每个驱动器一个，每个驱动器都有自己的变量与之关联：例如Drive1_Run、Drive2_Run、Drive3_Run 等等。当你来自 PC 编程背景时，你会觉得这很“错误”，但这都是因为我在上面提出的观点。当你处于停机状态，有人说 Drive 3 不工作时，你打开笔记本电脑，转到 Drive 3 的文件，然后查看 Run 输出梯级。在程序执行期间，您从那里开始进行故障排除。没有断点（程序永远不会停止）。

祝你的努力好运。如果您想查看它们，[我从我多年的 PLC 编程中](http://www.contactandcoil.com/)写了一些更多的见解。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2008-11-21T19:59:27.873

您可以从 Internet 上的各种资源中学习 PLC 编程，其中之一是[this（wikibooks）](http://en.wikibooks.org/wiki/Introductory_PLC_Programming)或[this](http://www.eod.gvsu.edu/~jackh/books/plcs/pdf/plcbook5_0.pdf)

除非您使用 PLC 特定功能，否则您编写的程序在用于 LLD（梯形逻辑图）的不同品牌的 PLC 中几乎相同。但是如果你使用像 IL（指令列表）这样的语言，会有更多的差异。但是一旦你编写了程序，不同品牌的存储和执行格式会有很大的不同

梯形逻辑是 PLC 的 5 种编程语言之一，其他分别是 FBD（功能框图）、ST（结构化文本，类似于 Pascal 编程语言）、IL（指令列表，类似于汇编语言）和 SFC（顺序函数）图表）。这些只是编程语言的各种表示形式，如果您愿意，可以使用各种风格。但通常，一个给定的品牌只支持其中一个。在美国，LLD 被广泛使用，而在欧洲，IL 更受欢迎。

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2008-11-21T20:09:12.547

梯形图，通常称为 LD，是 ISO 61131 自动化编程标准中定义的几种语言风格之一。其他有SFC（顺序流程图）、FBD（功能框图）、ST（结构化文本）和IL（指令列表）。IL 类似于汇编程序，很少有人使用它。ST 是一种基于文本的编程，很像早期版本的 BASIC。它也不经常使用。LD 的设计类似于电气控制面板上的继电器触点（许多 PLC 已替换）。FBD 看起来更像是电路图。SFC 基本上是一个流程图。

有些PLC支持全部，有些只支持一些，甚至一个。虽然 LD 是最常见的，但 FBD 和 SFC 越来越受欢迎。

不同的品牌确实使用略有不同的编程语言。它们通常足够相似，一旦你了解了一个品牌，你就可以使用它们中的任何一个，但你不能直接从一个 PLC 获取代码并在另一个品牌上使用。

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2008-11-21T20:20:18.220

到目前为止给出的答案非常符合目标。我发现PLC在语言和设置方面具有分裂的个性。他们的核心设计是为电气人员提供一种灵活的方法，为他们的整体设计设置控制逻辑。PLC 基本上是一堆输入和一堆输出，它们的连接方式由您加载到设备中的软件控制。

用于 PLC 的语言的重点之一是具有电气背景的人可以使用它们。因此，对于习惯于高级语言甚至汇编语言的人来说，习语和结构似乎与直觉相悖。例如，对于电气人员来说，梯形逻辑非常容易使用。

然而近年来，PLC 一直支持多种语言以实现最大的灵活性。然而，在我看来，我工作的少数 PLC 在编程环境方面非常缺乏。诸如将变量名称分配给内存位置之类的简单事情通常没有设计到所使用的语言中。那些容易工作的往往不是最经济有效的工作。

尽管存在这些缺陷，但它们非常适合简化复杂的电气系统。如果你和别人一起做一个项目，你会发现你的编程知识将帮助项目解决棘手的程序。我能够获取一个 100 梯级的梯形逻辑程序并将其重写为三分之一的梯级。一旦我能够学习梯形逻辑语言，我就能够实现各种优化，从而降低程序的复杂性。

一个提示是，您将需要了解闩锁。有时您需要存储或保持一些输出，除非您有锁存器，否则结果将在下一个周期消失。一旦你理解了这个问题，它就会变得清晰，但起初这对我来说是一个很大的挫败感。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2009-09-22T06:58:56.240

PLC 编程应被视为 PLC 软件工程输出的实施活动，除非您将 PLC 纯粹用作机械或电气解决方案的替代组件的一部分。

以此为基础，PLC 编程环境通常是 IEC61131 驱动的，保证循环时间，“抢先式”实时，无需处理实时操作系统相关问题，连续代码扫描，非程序指针，不同于典型计算机任务产生的概念一种多任务处理。代码执行自然是原子的，不需要在任务之间使用监视器。

每种语言都与您的代码与您要实现的逻辑模型的可想象性有密切关系。

1.  梯形图有其关于电力潮流联锁方式的基本概念。单个网络中的代码解析是水平或垂直扫描（您可以从制造商或其他站点找到有关此主题的资源）。如果您的代码具有单次扫描分辨率性质并且在一个网络内，则某些不可思议的行为可能是由于扫描类型造成的（重要的是要记住梯形图只是电路的仿真，它在执行中仍然是顺序的）。

2.  FBD 或功能块图是电子信号流，但今天可以是数据流，具体取决于 PLC 的类型。FBD 显示更清晰的执行顺序，在扫描顺序上与水平扫描梯形图非常相似。今天，FBD 通常用作对象功能块的容器，尽管依赖实现和与过程模型的视觉相似性取决于 PLC 类型。

3.  Literal 与 BASIC 非常相似，但只是语法；执行仍然是扫描的。文字语言有利于数学计算。对于高级实现，使用 Literal 可以更容易地使用对象内的方法或属性派生。使用类似英语的状态表示或常量的状态机编程使程序非常易读。

4.  语句列表看起来类似于汇编助记符，但再次执行仍然是扫描而不是程序指针。它在位运算和括号式离散逻辑方面很强大。它可以是一种非常有效的语言，可以与适当的结构和注释一起使用。

5.  SFC 或顺序流程图是顺序实现的补充语言。SFC 对动作块激活、状态转换、并行序列激活和合并具有固有的规则。然而，复杂的异常分支或并发动作管理会使实现变得复杂并且流程图难以阅读。

IO 处理、通信、热备的 PLC 系统管理是硬件配置工作，并且取决于产品。一般来说，可以与软件工程分开处理。然而，与PLC系统管理相关的数据属于“定位”（独立数据寻址区域）类型，软件工程中良好的数据建模方法有助于系统数据的可管理性。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2010-12-02T03:58:24.820

[在线 PLC 模拟器](http://www.plcsimulator.net/)可能很有用。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2012-10-09T21:16:10.313

您可以使用**结构化文本 (ST)**，它由一系列指令组成，根据高级语言（“IF..THEN..ELSE”）或循环（WHILE..DO）的确定，这些指令可以被执行。

我发现它比梯子更好，因为它接近标准编程语言。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-11-21T20:03:37.443

我在大学里学过一点 PLC 编程。在我看来，它比组装低一级，但我们使用的设备不是最新的。

我相信你需要一个 PLC 驱动程序，但我会先寻找模拟器并在购买之前阅读更多相关信息。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-10-30T20:01:16.800

Allen-Bradley 有一个免费的基于 dos 的软件 PLC，专门用于培训。如果你去他们的网站，你可能会找到它，或者谷歌它。它用于在学校教授 PLC 编程。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2010-09-15T23:59:44.463

对于尝试学习梯形逻辑的初学者，最好的方法是参加[http://plcs.net上的免费在线培训](http://plcs.net)

* * *

## 回答 #11

> 赞同：-3
> 
> 时间：2008-11-21T19:57:44.333

PLC 是用于使用梯形逻辑的设备的术语。以更典型的编程语言编程的设备通常称为微控制器。但是，我们中的一些人有时会将它们全部归为 PLC 名称。:-) 不确定梯形逻辑有多少变化，但微控制器代码可能会有很大差异。

# asp.net - ASP.NET WebForms + Postback 然后打开弹出窗口

> ID：309979
> 
> 赞同：3
> 
> 时间：2008-11-21T19:54:29.707
> 
> 标签：asp.net, webforms

我有一个必须回发才能执行某些逻辑的 LinkBut​​ton。

完成后，我不想在浏览器中重新加载页面，而是想保留它并弹出一个新窗口。

到目前为止，我的最佳想法是将 LinkBut​​ton 放在 UpdatePanel 中，并让它在重新加载时呈现一些 JavaScript，但我认为这完全是 hacky。另外，如果我没记错的话，更新面板中的 JavaScript 无论如何都不会运行。

还有其他想法吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-21T21:56:51.223

使用 LinkBut​​ton.PostBackUrl 将不同的页面设置为 POST 到，并使用一些客户端脚本来获取新窗口（并恢复旧目标，以便将来的回发正常工作）。第二页可以使用 PreviousPage 从原始页面访问任何需要的状态。

```
<script runat="server">
   void lnk_Click(object sender, EventArgs e) {
      // Do work
   }
</script>

<script type="text/javascript">
   var oldTarget, oldAction;
   function newWindowClick(target) {
      var form = document.forms[0];
      oldTarget = form.target;
      oldAction = form.action;
      form.target = target;

      window.setTimeout(
         "document.forms[0].target=oldTarget;"
         + "document.forms[0].action=oldAction;", 
         200
      );
   }
</script>

<asp:LinkButton runat="server" PostBackUrl="Details.aspx" Text="Click Me"
  OnClick="lnk_Click"
  OnClientClick="newWindowClick('details');" /> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-21T21:22:50.840

这是代码：

```
protected void Button1_Click(object sender, EventArgs e)

{

// Do some server side work

string script = "window.open('http://www.yahoo.com','Yahoo')";

if (!ClientScript.IsClientScriptBlockRegistered("NewWindow"))

{

ClientScript.RegisterClientScriptBlock(this.GetType(),"NewWindow",script, true);

}

} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-21T20:00:24.093

您可以尝试的一件事是让您的 LinkBut​​ton OnClick 事件进行处理，然后使用弹出代码注册一个 Page.ClientScript.RegisterStartupScript，这会将一些 Javascript 放入标签中以在页面加载后触发。处理完成后，这应该会启动您的新窗口。

编辑：阅读您的评论，我相信您仍然可以使用这种方法，将结果存储在会话变量中，然后让弹出页面从那里提取结果。

# linq-to-sql - LinqToSql .Contains 和 nvarchar vs varchar 参数 -> 索引转换计划

> ID：309991
> 
> 赞同：6
> 
> 时间：2008-11-21T19:59:36.937
> 
> 标签：linq-to-sql, orm

我只有一个映射在数据上下文中的表。这是感兴趣列的属性和属性：

```
[Column(Storage="_CustomerNumber", DbType="VarChar(25)")]
public string CustomerNumber
{ 
```

该列实际上是一个 varchar(25) 并且有一个索引。

我有一些简单的代码：

```
DataClasses1DataContext myDC = new DataClasses1DataContext();
myDC.Log = Console.Out;

List<string> myList = new List<string>() { "111", "222", "333" };
myDC.Customers
    .Where(c => myList.Contains(c.CustomerNumber))
    .ToList(); 
```

生成此 SQL 文本：

```
SELECT [t0].[CustomerNumber], [t0].[CustomerName]
FROM [dbo].[Customers] AS [t0]
WHERE [t0].[CustomerNumber] IN (@p0, @p1, @p2)
-- @p0: Input NVarChar (Size = 3; Prec = 0; Scale = 0) [111]
-- @p1: Input NVarChar (Size = 3; Prec = 0; Scale = 0) [222]
-- @p2: Input NVarChar (Size = 3; Prec = 0; Scale = 0) [333]
-- Context: SqlProvider(Sql2005) Model: AttributedMetaModel Build: 3.5.21022.8 
```

请注意，参数是 nvarchar！

当此查询访问数据库时，它会生成一个可怕的计划，该计划涉及在查找之前**将 CustomerNumber 上的数百万行索引转换为 nvarchar 。**

我不允许更改表，但我可以更改查询和 dbml。在不进行此索引转换的情况下，我该怎么做才能获取数据？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2010-11-10T17:16:39.667

这是我现在解决这个问题的方法。这会将参数转换为所需的类型，然后运行查询。它生成的 sql 与最初生成的 sql 相同，只是参数类型不同。

```
DbCommand myCommand = myDataContext.GetCommand(query);

foreach (DbParameter dbParameter in myCommand.Parameters)
{
  if (dbParameter.DbType == System.Data.DbType.String)
  {
    dbParameter.DbType = System.Data.DbType.AnsiString;
  }
}    

myDataContext.Connection.Open();

System.Data.Common.DbDataReader reader = myCommand.ExecuteReader();
List<RecordType> result = myDataContext.Translate<RecordType>(reader).ToList();

myDataContext.Connection.Close(); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-21T20:12:18.610

这就是我可以解决的问题。我也有兴趣查看其他解决方案：

```
List<IQueryable<Customer>> myQueries = 
    myList.Select(s => myDC.Customers.Where(c => c.CustomerNumber == s)).ToList();
IQueryable<Customers> myQuery = myQueries.First();
foreach(IQueryable<Customer> someQuery in myQueries.Skip(1))
{
    myQuery = myQuery.Concat(someQuery);
}
myQuery.ToList(); 
```

这会生成以下 SQL：

```
SELECT [t4].[CustomerNumber], [t4].[CustomerName]
FROM (
    SELECT [t2].[CustomerNumber], [t2].[CustomerName]
    FROM (
        SELECT [t0].[CustomerNumber], [t0].[CustomerName]
        FROM [dbo].[Customer] AS [t0]
        WHERE [t0].[CustomerNumber] = @p0
        UNION ALL
        SELECT [t1].[CustomerNumber], [t1].[CustomerName]
        FROM [dbo].[Customer] AS [t1]
        WHERE [t1].[CustomerNumber] = @p1
        ) AS [t2]
    UNION ALL
    SELECT [t3].[CustomerNumber], [t3].[CustomerName]
    FROM [dbo].[Customer] AS [t3]
    WHERE [t3].[CustomerNumber] = @p2
    ) AS [t4]
-- @p0: Input VarChar (Size = 3; Prec = 0; Scale = 0) [111]
-- @p1: Input VarChar (Size = 3; Prec = 0; Scale = 0) [222]
-- @p2: Input VarChar (Size = 3; Prec = 0; Scale = 0) [333]
-- Context: SqlProvider(Sql2005) Model: AttributedMetaModel Build: 3.5.21022.8 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-09-09T17:22:06.673

对于我正在处理的项目，我们必须使用`ObjectContext`而不是`DbContext`，所以我没有现成`GetCommand()`的访问权限或`DbParameters`. 我所做的是将查询转换为字符串，删除查询中的 NVARCHAR 指示符，然后针对`ObjectContext`. 这是给定示例的详细实现：

```
List<string> myList = new List<string>() { "111", "222", "333" };

IQueryable<Customers> badQuery =  myDC.Customers
    .Where(c => myList.Contains(c.CustomerNumber));

string query = ((System.Data.Objects.ObjectQuery)badQuery).ToTraceString();
query = query.Replace(",N'", ",'").Replace("(N'","('");

List<Customers> customers = myDC.ExecuteStoreQuery<Customers>(query).ToList(); 
```**