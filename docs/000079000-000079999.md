# StackOverflow 问答 000079000-000079999

# java - Griffon 支持哪些 Java 版本？

> ID：79002
> 
> 赞同：3
> 
> 时间：2008-09-17T01:39:30.787
> 
> 标签：java, swing, groovy, griffon

我想编写一个 Swing 应用程序，`Griffon`但我不确定我可以支持哪些 Java 版本。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-17T01:43:45.927

根据 Griffon 网站，1.5 或更高。

[http://groovy.codehaus.org/Installing+Griffon](http://groovy.codehaus.org/Installing+Griffon)

# c++ - 是否有适用于 Linux 的 C++ gdb GUI？

> ID：79023
> 
> 赞同：221
> 
> 时间：2008-09-17T01:42:57.143
> 
> 标签：c++, linux, gdb, debugging

简而言之：是否有人知道 gdb 的 GUI 可以使其与您在最新版本的 Visual C++ 中获得的功能集相当或接近？

详细说明：作为一个在 Windows 中花费大量时间进行编程的人，每当我必须在 Linux 中编写 C++ 代码时，我发现的一个较大的绊脚石是使用命令行 gdb 调试任何东西所花费的时间比在Visual Studio，它似乎并没有通过实践变得更好。有些事情只是更容易或更快地以图形方式表达。

具体来说，我正在寻找一个 GUI：

*   处理所有基础知识，例如单步执行代码、监视变量和断点
*   理解并能显示复杂和嵌套的 C++ 数据类型的内容
*   在显示参数类型等相关信息的同时，不会被模板化代码和数据结构所迷惑，并且最好可以智能地单步执行
*   可以处理线程应用程序并在不同线程之间切换以单步执行或查看状态
*   除了在 gdb 中启动程序之外，还可以处理附加到已启动的进程或读取核心转储

如果不存在这样的程序，那么我想听听人们对至少满足某些要点的程序的体验。有人有什么建议吗？

**编辑：**
列出可能性很好，我会尽我所能，但如果你能在你的回复中包括它会更有帮助：
(a)你是否实际使用过这个 GUI，如果是这样，您对此有什么正面/负面的反馈。
(b) 如果您知道，上面提到的哪些功能是/不支持的

列表很容易获得，这样的网站很棒，因为您可以了解人们使用应用程序的个人体验。

* * *

## 回答 #1

> 赞同：86
> 
> 时间：2008-09-17T02:28:17.177

Eclipse CDT 将提供与使用 Visual Studio 相当的体验。我每天都使用 Eclipse CDT 来编写代码以及调试本地和远程进程。

如果您不熟悉使用基于 Eclipse 的 IDE，那么 GUI 需要一点时间来适应。但是，一旦您了解了 Eclipse 独有的 GUI 思想（例如透视图），使用该工具就会成为一种很好的体验。

CDT 工具提供了一个不错的 C/C++ 索引器，使您可以快速找到对代码库中方法的引用。它还提供了一个很好的宏扩展工具和有限的重构支持。

关于对调试的支持，CDT 能够执行您列表中的所有操作，但读取核心转储除外（它可能支持此功能，但我从未尝试使用此功能）。另外，我使用模板调试代码的经验是有限的，所以我不确定CDT在这方面会提供什么样的体验。

有关使用 Eclipse CDT 进行调试的更多信息，您可能需要查看以下指南：

*   [与 CDT 调试器交互，第 2 部分：使用 Eclipse CDT 和 MI 访问 gdb](http://www.ibm.com/developerworks/library/os-eclipse-cdt-debug2/index.html)
*   [CDT 调试教程](http://download.eclipse.org/tools/cdt/docs/tutorials/debug_tutorial/cdt_w_debug.htm)

* * *

## 回答 #2

> 赞同：79
> 
> 时间：2008-09-17T02:08:37.457

gdb -tui 如果你想要一些图形用户界面的东西，但仍然是基于字符的。

* * *

## 回答 #3

> 赞同：56
> 
> 时间：2008-09-17T01:45:42.397

您不会发现*任何*覆盖 GDB 的东西可以与 Visual Studio 调试器的原始功能相媲美。它太强大了，而且它在 IDE 中集成得也很好。

对于 Linux 替代方案，如果您喜欢免费软件，请尝试 DDD。

* * *

## 回答 #4

> 赞同：49
> 
> 时间：2011-06-01T05:43:20.873

查看[Nemiver C/C++ 调试器](https://wiki.gnome.org/Apps/Nemiver)。它很容易在 Ubuntu 中安装（开发者工具/调试）。

**更新：**新链接。

* * *

## 回答 #5

> 赞同：32
> 
> 时间：2010-08-24T13:40:34.567

Qt Creator 似乎是个好东西。一位同事向我展示了一种设置调试的方法：

*   创建一个新项目“基于 Makefile 的项目的导入”。
*   将它指向你的根项目文件夹（它会索引它下面的源，而且速度非常快）。
*   转到项目设置并添加运行配置，然后指定要调试的可执行文件及其参数。
*   Qt Creator 似乎坚持在调试之前构建您的项目。如果你不想这样，或者不使用make，只需转到项目->构建（左侧面板），然后，在“构建步骤”的右侧面板中，删除所有步骤，包括默认情况下的步骤您创建了项目。

对于调试我已经编译的应用程序来说，这似乎需要做很多工作，但这是值得的。调试器以与 Visual Studio 类似的方式显示线程、堆栈和局部变量，甚至使用许多相同的键盘快捷键。它似乎很好地处理模板，至少 std::string 和 std::map。似乎支持附加到现有进程和核心转储，但我尚未对其进行测试。

请记住，我现在使用它不到一个小时，但到目前为止我印象深刻。

* * *

## 回答 #6

> 赞同：30
> 
> 时间：2009-02-02T01:29:55.360

我讨厌 Windows 开发的想法，但 VC++ 调试器是我见过的最好的调试器之一。我还没有找到接近 VC 的 GUI 前端。

一旦你真正习惯了 GDB，它就很棒。在愤怒中使用它，你会变得非常熟练。我可以毫不费力地在一个程序周围做你列出的所有事情。在我精通之前，确实需要一个月左右的时间才能通过 SSH 链接连接到远程服务器。我永远不会回去。

DDD 确实很强大，但也有很多问题。我发现当它收到来自 GDB 的消息时，它经常冻结。这很好，因为它有一个 gdb 界面窗口，因此您可以看到正在发生的事情并直接与 gdb 交互。由于某种原因，DDD 不能在我的环境中的远程 X 会话上使用（一个真正的问题，因为我在做 Unix 开发时坐在瘦客户端上）所以它不适合我。

KDevelop 遵循典型的 KDE 风格，向用户展示一切。我也从来没有在 KDevelop 中调试非 KDevelop 程序的运气。

Gnat Programming Studio (GPS) 实际上是一个很好的 GDB 前端。它不仅管理 Ada 项目，因此如果您需要调试器，值得一试。

您可以使用 Eclipse，但它的重量很重，而且与我共事过的许多经验丰富的 Unix 人员（包括我在内）不太关心它的界面，这不仅是 STFU，而且不会妨碍您。Eclipse 似乎也占用了很多空间，像狗一样跑。

* * *

## 回答 #7

> 赞同：27
> 
> 时间：2009-07-15T11:54:53.840

我用cgdb，简单实用

* * *

## 回答 #8

> 赞同：16
> 
> 时间：2008-09-17T02:10:07.547

我经常使用 DDD，一旦你学会使用它，它就会非常强大。我要说的一件事是不要在 WAN 上通过 X 使用它，因为它似乎做了很多不必要的屏幕更新。

另外，如果您不与 GDB 配对并且不介意花一点钱，那么我会尝试 TotalView。它有一些陡峭的学习曲线（它肯定会更直观），但它是我在任何平台上使用过的最好的 C++ 调试器，并且可以扩展为以自定义方式内省您的对象（因此允许您查看STL 列表作为对象的实际列表，而不是一堆令人困惑的内部数据成员等）

* * *

## 回答 #9

> 赞同：8
> 
> 时间：2008-09-17T01:48:54.680

查看 Eclipse CDT 项目。它是一个面向 C/C++ 开发的 Eclipse 插件，包括一个功能相当丰富的调试透视图（在幕后使用 GDB）。它可在各种平台上使用。

* * *

## 回答 #10

> 赞同：7
> 
> 时间：2008-09-17T01:50:48.623

DDD 是 gdb 的 GNU 前端：[http ://www.gnu.org/software/ddd/](http://www.gnu.org/software/ddd/)

* * *

## 回答 #11

> 赞同：7
> 
> 时间：2009-01-03T15:49:44.707

与 eclipse gdb 前端相似的是 emacs 前端，它与 emacs IDE 紧密相关。如果您已经使用 emacs，您会喜欢它：

[GDB Emacs 前端](https://stackoverflow.com/questions/164693/whats-the-best-stable-c-ide-with-a-gui-that-runs-on-linux#350855)

* * *

## 回答 #12

> 赞同：6
> 
> 时间：2008-10-25T19:01:28.570

我使用了 KDbg（仅在 KDE 下工作）。

* * *

## 回答 #13

> 赞同：5
> 
> 时间：2008-09-23T12:10:04.580

我已经为 gdb 尝试了几种不同的 gui，并且发现 DDD 比它们更好。虽然我无法评论其他非 gdb 的 Linux 产品，但我在其他平台上使用了许多其他调试器。

gdb 完成了您愿望清单中的大部分工作。DDD 对他们提出了更好的要求。例如，线程切换变得更简单。设置断点与您期望的一样简单。

如果您想做一些晦涩的事情，您还会获得一个 cli 窗口。

DDD 的一个突出于我使用过的任何其他调试器的特性是数据“绘图”。这允许您将结构、对象和内存显示和排列为可拖动的框。双击指针将打开取消引用的数据，并带有返回父级的可视链接。

* * *

## 回答 #14

> 赞同：5
> 
> 时间：2010-11-20T15:47:24.847

Qt Creator-on-Linux 现在肯定与 Visual Studio-on-Windows for C++ 相提并论。我什至会在调试器方面说得更好。

* * *

## 回答 #15

> 赞同：5
> 
> 时间：2013-11-13T00:50:01.010

此列表中缺少一个 IDE，它非常高效（我在许多 C/C++ 项目中使用它，没有任何问题）：[Netbeans](https://netbeans.org/kb/docs/cnd/quickstart.html)。

* * *

## 回答 #16

> 赞同：3
> 
> 时间：2008-09-17T01:47:34.403

可以单步执行的内容将在很大程度上受到 g++ 生成的调试信息的限制。Emacs 为 gdb 提供了一个接口，让您可以通过工具栏/菜单对其进行控制，并在单独的窗口中显示数据，以及直接键入 gdb 命令。Eclipse 的 CDT 提供了类似的工具。我听说过 Anjuta 和 Code::Blocks，但从未使用过它们。

* * *

## 回答 #17

> 赞同：3
> 
> 时间：2008-09-17T02:16:58.997

作为熟悉 Visual Studio 的人，我已经查看了几个开源 IDE 来替换它，而 KDevelop 是最接近 Visual C++ 人员可以坐下来开始使用的 IMO。当您在调试模式下运行项目时，它使用 gdb，但 kdevelop 几乎可以处理整个事情，因此您不必知道它是 gdb；您只是单步执行或将监视分配给变量。

不幸的是，它仍然不如 Visual Studio 调试器好。

* * *

## 回答 #18

> 赞同：3
> 
> 时间：2009-02-02T01:01:44.340

您没有提及您使用的是 Windows 还是 UNIX。

在 UNIX 系统上，[KDevelop](http://www.kdevelop.org/)很好，但我使用[KDbg](http://www.kdbg.org/)，因为它易于使用，并且还可以与不是在 KDevelop 中开发的应用程序一起使用。

[Eclipse](http://www.eclipse.org/)在两个平台上都很好。

在 Windows 上，有一个名为[Wascana Desktop Developer](http://wascana.sourceforge.net/)的很棒的包，它是 Eclipse CDT 和 MinGW，它们全部打包并预先配置好，以最大限度地减少痛苦。这是我在 Windows 上开发 GNU 代码时发现的最好的东西。

我用过所有这些调试器，但没有一个比 MS Dev Studio 好。Eclipse/Wascana 可能是最接近的，但它确实有一些限制，例如您无法进入 DLL，并且它在检查变量方面做得不那么好。

* * *

## 回答 #19

> 赞同：3
> 
> 时间：2015-04-07T11:56:54.527

你有没有看过[DS-5 调试器](https://developer.arm.com/products/software-development-tools/ds-5-development-studio/ds-5-debugger/overview)？

有一个付费版本，其中包含许多有用的功能，但您也可以免费使用社区版（这对于嵌入式系统也非常有用）。

在使用 eclipse 在真实设备上调试 Android 应用程序时，我对这个工具有很好的体验。

* * *

## 回答 #20

> 赞同：2
> 
> 时间：2011-11-24T11:15:01.287

[Code:Blocks](http://www.codeblocks.org/) C++ IDE 有一个图形包装器，具有一些您想要的功能，但没有 VS 的强大功能。

* * *

## 回答 #21

> 赞同：2
> 
> 时间：2014-05-27T23:08:52.583

[VisualGDB](http://visualgdb.com)是另一个 Visual Studio 插件，用于在 linux 和嵌入式平台上开发和调试应用程序。

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2008-09-17T01:53:34.530

KDevelop 工作得很好。

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2009-01-02T01:52:23.003

您是否尝试过使用 cygwin gdb 的 gdb -w。它应该有一个运行良好的 Windows 界面。

我发现的唯一问题是，在我现在的机器上，直到我安装了 ddd 之后它才以这种方式运行。我怀疑它需要在我安装 ddd 时安装的 tcltk。

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2008-09-17T02:08:21.890

最新版本的 Geany 支持它（但仅在 Linux 上）

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2009-12-03T20:35:23.237

如果您在 Visual Studio 下寻找 gdb，请检查[WinGDB](http://www.wingdb.com)。

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2009-12-03T20:53:12.263

在过去的 15 个月中，我使用了洞察力（FC6 附带）。它不是很好，它是用 Tcl/Tk 编写的，但它简单实用。DDD 具有相似的质量/实用性，但使用起来有些困难（各种 GUI 陷阱和遗漏）。我还尝试将 gdb 与我的 IDE SlickEdit 集成。它工作正常（我玩了大约 4 个小时），但我不喜欢 GUI 上下文切换。我希望我的 IDE 在调试时保持不变；在 Windows 上，我使用 SlickEdit 进行 IDE 和 Visual Studio 调试器进行调试。因此，从 3：Insight、DDD 和 SlickEdit 来看，Insight 是我的第一选择，我使用它 >95% 的时间，命令行 gdb 和 DDD 占另外 5%。如果有机会，我会在某个时候评估 Eclipse，我的工作 PC 似乎没有足够的 RAM（仅 1GB）来相当好地运行 Eclipse。

我还听到了很多对 TotalView 的赞誉，包括在工作面试中的第一手。我在 2008 年底获得了我们公司的评估，但最后我们没有继续，因为 gdb 足以满足我们的需求；它是免费且无处不在的。

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2012-02-16T07:21:52.200

使用 www.zero-bugs.com/ 零调试器，它需要 gcc 的 C++0x 支持

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2016-07-04T19:41:26.710

我正在寻找一个调试器来逐步执行正在运行的程序。说：附上。该程序是用 eclipse 构建的，但由于可能存在一些多线程障碍，因此没有喜欢的源文件。任何。

我对 NetBeans 非常满意。

*   [调试] 从菜单 -> 附加调试器...
*   由于进程选择了要调试的那个
*   作为项目[新项目]

现在窗口消失了，你什么也看不见。脱离过程。阅读广场“停止”有帮助。

*   从项目中导入源代码，例如文件夹。“.../MyProject/src
*   现在它出现在您的项目中，您可以设置断点。
*   再次附加调试器
*   选择要调试的进程。
*   如果程序到达下一个断点，调试器应该停止。

转到 [window] -> [Debugging] -> 你的窗口会变得舒适吗？

# user-interface - 关于禁用或隐藏菜单项的规则

> ID：79033
> 
> 赞同：4
> 
> 时间：2008-09-17T01:43:29.267
> 
> 标签：user-interface, standards

您是否曾经遇到过您真的很想使用但不能导致它被禁用或更糟糕的菜单功能一起消失的情况？

有一个论点是始终启用菜单，然后向用户显示一条消息，解释为什么当他们单击菜单功能时无法激活它。我认为这有好处，但也许有更聪明的方法来解决这个问题。

我很想听听其他人的想法。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-17T01:48:26.460

如果您指的是 Joel 的帖子[Don't hide or disable menu items](http://www.joelonsoftware.com/items/2008/07/01.html)，他[在 StackOverflow 播客中澄清说](https://stackoverflow.fogbugz.com/default.asp?W13086)，他希望有信息 - 而不是对话框 - 告诉您为什么菜单项不会做任何事情：

> 所以，我想到的用例是，你提到在 Windows Media Player 中，当你收听播客等时，你可以更快地播放内容，它会加快播放速度。当我在那里查看时，它被禁用了。而且我不知道如何启用它。很明显，帮助文件没有帮助——不是任何人都阅读帮助文件，但即使你这样做了，你也找不到答案。这有点令人沮丧，我宁愿启用该菜单项并让它告诉我“由于以下原因，我现在不打算这样做。我拒绝这样做。”

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-17T01:52:27.887

与大多数关于可用性的问题一样，答案是“视情况而定”。这取决于问题域、用户类型、功能的关键程度等等。你的问题没有单一的答案。

我认为普遍的共识是，永远不要从菜单中完全删除项目。菜单允许用户自由地发现可用的功能，但如果这些项目被隐藏或四处移动，它对用户没有任何帮助。此外，移动它们会使您无法熟练使用该应用程序，因为您必须不断扫描菜单以查找要选择的项目。

至于禁用与启用一个项目并显示一个对话框或消息来解释为什么它不是你可以做的事情，我通常更喜欢前者。但是，如果无法合理地期望用户从显示屏上直观地理解某个功能，则启用它是一个不错的选择。

例如，如果“粘贴”被禁用，对于大多数计算机用户来说，没有什么可以粘贴是相当明显的。但是，如果您有一个“Frizzle the Bonfraz”菜单项，并且用户可能不知道 Bonfraz 是什么或为什么他们可能想要启用它但不能，那么最好让它至少启用一段时间。

再说一次，这取决于。如果可能的话，做你认为最好的，然后询问你的用户。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-17T02:03:24.053

概括一下（可能是不正确的......），您更喜欢以下哪种情况：

1.  发现自己在一个没有船或桥的岛上。当然，你可以和镇上的村民交谈，他会告诉你让一座桥出现的魔法词……但你不知道魔法的存在。
2.  你看到有一座桥；然而，当你到达它时，有一个标志告诉你这座桥不开放使用。
3.  你看到有一座桥并庆祝！当你走到桥的尽头时，它会告诉你出口没有打开。他们必须回去。

也许我有偏见，但我不认为启用菜单选项并允许用户单击它是最好的主意。那只是在浪费别人的时间。在他们单击该项目之前，他们无法区分该项目是否可用。（场景#3）

将物品全部隐藏起来有其优点和缺点。完全隐藏，您冒着用户永远不会发现所有这些功能的风险；然而，与此同时，您有机会使您的应用程序“有趣”和“可发现”。我一直认为动作的可见性更适合工具栏之类的项目。一个很好的例子是在某些应用程序中，当您单击图像时，图片工具栏会弹出……而当您单击文本时，它会消失。一般来说，如果您的应用程序的整体体验倾向于用户的“发现”和“探索”态度，我会说这样的事情是最好的。（场景#1）

我通常会建议禁用这些项目并向用户提供工具提示，告知他们如何启用它（甚至是指向帮助的链接？）；但是，这不能过分。这必须适度进行。（场景#2）

一般来说，当它是用户可以轻松发现的与上下文相关的操作（即图片工具栏）时，隐藏这些项目。如果用户不容易找到它，请将其禁用。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-17T01:45:44.737

将其禁用，但让工具提示解释为什么它被禁用

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-17T02:56:26.140

您可以在状态栏中显示“原因”。或者更好的是，使用描述操作的文本并在可能的操作时包含信息。例如，对于“复制”菜单项，状态栏中的文本将是：复制选定的文本。注意'selected'部分，它告诉用户他需要选择文本来启用菜单项。

我正在制作的工具中的另一个示例，我们有“删除数据库”菜单项，但只有在您连接到它时才能执行此操作。因此，状态栏中的文本类似于：“删除数据库（仅在连接时）”。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-17T01:47:59.537

我一直认为你应该尽可能地隐藏。（您的应用程序不应该比用户可以/应该做的更复杂。）

如果您显示用户不应该使用的菜单选项，他们可能会单击它，但认为您的应用程序已损坏，因为没有任何反应。

至少我是这么认为的……

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-17T01:49:11.717

这取决于实际情况。如果菜单项在当前上下文中应用但由于状态不可用，则应将其禁用。如果上下文已更改，不再适用，则应将其删除。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-17T01:51:37.203

我自己从来没有真正理解过这一点（我不编写 GUI 程序）。为什么甚至首先隐藏或禁用菜单项？对于大多数正在寻找特定菜单选项以发现它被禁用甚至不存在的用户来说，这是不直观的。

工具提示也不直观。如果我在菜单项之间移动鼠标，我不会暂停足够长的时间来获得工具提示解释。我更可能会因为我希望通过菜单访问的东西不存在或被禁用而感到沮丧。

也就是说，我实际上并不经常使用 GUI 菜单。我发现可用的选项通常没用，或者可以通过一些更直观的方式访问，例如常用的键盘快捷键。

# php - 检索树中作为另一个子节点的所有节点

> ID：79041
> 
> 赞同：0
> 
> 时间：2008-09-17T01:44:11.807
> 
> 标签：php, tree

我有一个网络系统，它有一个保存在数据库中的经典父子菜单，字段 id 作为 PK，parent_id 指向拥有的菜单。（是的，我知道这不能很好地扩展，但这是另一个话题）。

所以对于这些记录（id-parent_id 对）：

```
0-7 0-4 4-9 4-14 4-16 9-6 
```

我有这棵树：

```
0
├ 7
└ 4
  ├ 9
  | └ 6     
  ├ 14
  └ 16 
```

我需要隐藏一个顶部节点，所以我必须列出该特定节点的所有子节点，即对于 4，它们将是 (9, 6, 14, 16)。顺序无所谓。

我很困惑......这是否适合经典的树问题？还是图表？

我怎样才能组成这个结构并使用 php 解决这个问题？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-17T01:53:42.017

相邻列表模型很难处理。我所在的公司现在将它们用于层次结构，这引起了极大的头痛。我已经成功地为以前的雇主使用了 Celko 的嵌套集模型，它们非常适合创建、维护和使用层次结构（树）。

我找到了描述它们的链接：http: [//www.intelligententerprise.com/001020/celko.jhtml](http://www.intelligententerprise.com/001020/celko.jhtml)

但我也推荐 Joe Celko 写的书“Smarties 的 SQL：高级 SQL 编程”，其中涵盖了嵌套集。

[Joe Celko 为 Smarties 编写的 SQL：高级 SQL 编程](https://rads.stackoverflow.com/amzn/click/com/0123693799)

[Joe Celko 为 Smarties 编写的 SQL 中的树和层次结构](https://rads.stackoverflow.com/amzn/click/com/1558609202)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-17T01:48:11.657

这是使用递归的绝佳机会！

伪代码：

```
nodeList = {}
enumerateNodes(rootNode, nodeList);

function enumerateNodes(node, nodeList) {
   nodeList += node;
   foreach ( childnode in node.children ) {
       enumerateNodes(childnode, nodeList);
   }
} 
```

编辑：没有注意到你的树是相邻的列表格式。在我开始使用它之前，我可能只是将它构建到一个实际的树数据结构中。只需遍历所有对（第一次看到它们时创建节点）并链接它们。我*觉得*应该很简单...

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-17T01:54:53.090

这是一个图形问题。查看[BFS（广度优先搜索）](http://en.wikipedia.org/wiki/Breadth-first_search)和[DFS（深度优先搜索）。](http://en.wikipedia.org/wiki/Depth-first_search). 你可以用谷歌搜索这些术语并在网络上找到数百个实现。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-17T02:21:12.700

这对于嵌套集实现来说是微不足道的。有关更多详细信息，请参见此处：

[http://mikehillyer.com/articles/managing-hierarchical-data-in-mysql/](http://mikehillyer.com/articles/managing-hierarchical-data-in-mysql/)

否则，编写如下内容：

```
def get_subtree(node)
  if children.size > 0
    return children.collect { |n| get_subtree(n) }
  else
    return node
  end
end 
```

# macos - OSX 10.5 Leopard Symbol Mangling with $non_lazy_ptr

> ID：79054
> 
> 赞同：3
> 
> 时间：2008-09-17T01:46:34.233
> 
> 标签：macos, osx-leopard, name-mangling, darwin, non-lazy-ptr

为什么 Leopard 会用 $non_lazy_ptr 破坏一些符号？更重要的是，修复未定义符号错误的最佳方法是什么，因为符号已被 $​​non_lazy_ptr 破坏？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-17T04:23:06.650

来自：[开发者连接 - 间接寻址](http://developer.apple.com/library/mac/#documentation/developertools/conceptual/MachOTopics/1-Articles/indirect_addressing.html#//apple_ref/doc/uid/TP40004919-SW1)

间接寻址是代码生成技术的名称，它允许从另一个文件引用一个文件中定义的符号，而无需引用文件明确了解定义该符号的文件的布局。因此，定义文件可以独立于参考文件进行修改。间接寻址最大限度地减少了必须由动态链接器修改的位置数量，这有助于代码共享并提高性能。

当一个文件使用另一个文件中定义的数据时，它会创建符号引用。符号引用标识从中导入符号的文件和引用的符号。有两种类型的符号引用：非惰性和惰性。

加载模块时，动态链接器会解析非惰性符号引用（绑定到它们的定义）。非惰性符号引用本质上是一个符号指针——一个指针大小的数据。编译器为数据符号或函数地址生成非惰性符号引用。

惰性符号引用在第一次使用时由动态链接器解析（而不是在加载时）。对引用符号的后续调用直接跳转到符号的定义。惰性符号引用由符号指针和符号存根组成，这是一小部分直接取消引用并跳过符号指针的代码。当编译器遇到对另一个文件中定义的函数的调用时，它会生成惰性符号引用。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-14T14:19:00.947

用人类的话说：编译器生成带有 $non_lazy_ptr 附加到它们的存根以加速链接。您可能会看到从 _Foo$non_lazy_ptr 引用的函数 Foo 未定义，或者类似的东西 - 这些不是一回事。确保在您将应用程序链接到的目标文件/库中实际声明并导出符号。至少那是我的问题，我还认为这是一个奇怪的链接器问题，直到我发现我的问题出在其他地方 - 在 Google 上发现了其他几个可能的原因。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-08-11T20:59:58.730

```
ranlib -c libwhatever.a 
```

是解决该问题的可靠方法。在为 iOS 构建 PJSIP 库时，我遇到了同样的问题。这个库使用了一个基于 autoconf 的 make 系统，但需要对各种文件进行一些调整以使 iOS 一切正常。在此过程中，我设法删除了库规则中的 ranlib 行，然后开始在我的项目链接中收到关于未定义`_PJ_NO_MEMORY_EXCEPTION`引用的错误。`_PJ_NO_MEMORY_EXCEPTION$non_lazy_ptr`

将 ranlib 行添加回库文件解决了它。现在我在 rules.mak 中的 LIBS 完整条目是

```
$(LIB): $(OBJDIRS) $(OBJS) $($(APP)_EXTRA_DEP)
    if test ! -d $(LIBDIR); then $(subst @@,$(subst /,$(HOST_PSEP),$(LIBDIR)),$(HOST_MKDIR)); fi
    $(LIBTOOL) -o $(LIB) $(OBJS)
    $(RANLIB) -c $(LIB) 
```

希望这有助于其他人尝试将通用 UNIX 配置的外部库与 iPhone 或 iOS 一起使用。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-06-17T14:05:41.157

如果其他人遇到了我遇到的同样问题：

头文件里有a `extern NSString* const someString;`，但是忘记放实现文件了。作为`NSString* const someString=@"someString";`

这解决了它。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-28T20:34:49.860

你的库文件上的ranlib -c 解决了这个问题

# .net - 随着摩尔定律的通过，您是否认为框架可能会发生转变？

> ID：79093
> 
> 赞同：0
> 
> 时间：2008-09-17T01:52:49.837
> 
> 标签：.net, c, winapi

框架以牺牲操作系统的速度和混淆为代价来简化编码。随着摩尔定律的通过，您是否认为框架可能会发生转变？

我怀疑 Vista 没有取得巨大成功的原因之一是它的运行速度比 XP 慢得多，而且由于计算机的速度没有像过去那样大幅度提高，这种变化似乎是一种倒退。

多年来，CPU 的速度超过了软件的速度，因此增加了操作系统混淆和膨胀层的新框架几乎没有造成什么伤害。想象一下 Windows 95 在今天的硬件上运行的速度有多快（给定一些内存调整）。Win2K 和 WinXP 是很大的改进，我们可以忍受它们因为更快的计算机而变得更慢。

然而，即使在几年前，我注意到用 MS 基础类编写的程序看起来并不像直接编写到 API 中的代码那样清晰。由于这些框架（如 .Net 和其他框架）的激增只会使这种情况变得更糟，我们是否可能会发现能够将“C”代码直接写入 Win32 API（或其他操作系统中的等价物）将成为强大的竞争优势，即使它确实需要更长的时间来写？或者在更长的开发时间中进行权衡是否不值得？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-17T01:57:09.530

如果存在使应用程序更快的选择压力，我认为人们会更好地编写封装功能的框架，而不会过多地减慢系统速度。

处理像素的 Boost::Gil 框架是一个很好的基于模板的系统，它归结为许多内联函数 - 编译器创建的输出与没有像素包装器并直接访问值时相同。

所以 - 至于你的问题，我认为框架编写者的职责是确保他们的框架快速而精简。这可能意味着他们会检测哪些功能正在使用并删除与未使用功能相关的代码。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-17T02:20:39.253

我认为实现这一目标的挑战是找到足够多的开发人员，他们有信心编写代码，而无需借助当今许多框架的“拐杖”。越来越多的计算机科学/软件工程学术课程忽略了世界上的 C 语言，转而支持 Java 和 .NET（并不是说我反对 Java 或 .NET，我相信很多人都靠 .NET 谋生，许多其他人都这样做），因为这是当今行业的需求。

因此，应届毕业生认为许多框架是理所当然的（除非他们有足够的兴趣亲自了解“幕后”发生了什么）。自学成才的开发人员也很可能会选择更容易学习和使用的东西。同样，尽管人们非常热衷于并不厌其烦地了解他们使用的任何框架的幕后发生的事情，但仍然如此。

所以我同意之前的一篇文章，框架的作者可能会想出创造性的方法来确保他们的东西高效运行。我的印象是，相当多的开发人员对框架如何做 X 并不真正感兴趣，他们只是希望它为他们做这件事，以便帮助他们更快地完成工作。在我看来，对于许多人来说，必须摆脱框架并不容易。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-17T07:54:43.583

对于许多软件来说，性能不是问题，是时候上市了。这通常是“内部”的情况，团队可能更关心快速将应用程序的初始版本呈现给用户，而不是它的速度（或什至稳定）。除此之外，编写良好的框架将简化作为框架设计目标的应用程序的开发，如果有可用的框架，您经常会因为不使用框架而发疯。当然，您冒着风险，框架将允许您完成 80% 的目标，然后让您高枕无忧，但是，您通常可以通过在框架之外为最后一个工作来缓解这种情况20%。就像软件中的所有优点一样，它通常都是关于分层的；您可能首先选择 .Net 作为“框架” 然后决定为您的应用程序的某些部分使用特定的.Net GUI“框架”，然后可能为其他部分使用单独的套接字“框架”。或者，您可能决定在 C++ 中工作并使用 boost 作为框架，或者，可能选择一个更专注的框架，为您提供更多抽象和（希望）更高的编码速度。

问题通常是选择正确的框架并决定您愿意牺牲多少性能来简化开发。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-17T02:07:31.687

存在封装通用功能的框架；这永远不会改变

是什么让你认为摩尔定律已经死了？麻省理工学院的学生培育出能够自组装纳米线电路的细菌，摩尔还没有死……

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-17T04:36:05.310

“这个词在我们的行业中被过度使用了。如果你指的是 MFC 或 .Net 之类的东西，那么我认为它们会继续存在。它们与运行时的性能无关。它们与代码重用、可维护性和关注点分离。”

我不得不说，在很多情况下，它们确实与运行时的性能有很大关系。即使你调用了框架，它直接调用了 API 调用（在这种情况下没有意义，但这是速度最好的情况），仍然会有额外的函数调用的性能损失，这可以有时很重要。

另外，我不得不承认，希望对原帖的尊重，Vista*是*退步了。由于 DRM 之类的东西不是“功能”，所以速度很慢。Windows XP 实际上在许多方面都比 Windows 2000 快。Vista当然不是。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-05-02T09:28:21.263

WinRT 不就是为了解决这个问题，即尝试吃掉我们的蛋糕吗？据我了解，WinRT 应该在保持速度的同时为我们提供更高级别的交互，因为它不是附加层，而是替代 C/C++ 基础级 OS api 以供 .NET 直接使用？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-17T01:56:26.427

离开框架将是一种倒退，我认为并希望这不会发生。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-17T02:17:55.797

**“框架”**到底是什么意思。这个词在我们的行业中被过度使用了。如果您指的是 MFC 或 .Net 之类的东西，那么我认为它们会继续存在。它们与运行时的性能无关。*它们与代码重用、可维护性和关注点分离有关。*

顺便说一句，Vista 并不慢，因为它使用了框架；*它很慢，因为它使用了很多无用的框架，例如 DRM*。它也可能因质量低下而受到影响，因为 MS 正在慢慢成为一个更加官僚的公司——*我的看法*。Vista也缺乏目标。它没有带来任何值得升级的东西。它试图用 GUI 结霜来补偿。

# c# - .NET (C#)：只有进程句柄或 PID 时获取子窗口？

> ID：79111
> 
> 赞同：22
> 
> 时间：2008-09-17T01:54:52.747
> 
> 标签：c#, .net, windows, user-interface

一种特殊情况的问题：

*   我开始一个过程`System.Diagnostics.Process.Start(..)`
*   该过程会打开一个启动画面——这个启动画面成为主窗口。
*   启动画面关闭并显示“真实”用户界面。主窗口（启动画面）现在无效。
*   我还有 Process 对象，可以查询它的句柄、模块等。但是主窗口句柄现在无效了。

此时我需要获取进程的 UI（或 UI 句柄）。假设我无法更改流程的行为以使其更容易（或更理智）。

我在网上四处看了看，但我承认我没有找一个多小时。似乎它应该有点微不足道:-(

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-17T02:15:28.767

如果您不介意使用 Windows API，您可以使用[`EnumWindowsProc`](http://msdn.microsoft.com/en-gb/library/windows/desktop/ms633498.aspx), 并检查出现的每个句柄[`GetWindowThreadProcessId`](http://msdn.microsoft.com/en-gb/library/windows/desktop/ms633522.aspx)（以查看它是否在您的进程中），然后可能`IsWindowVisible`,`GetWindowCaption`并`GetWindowTextLength`确定`hWnd`您的进程中的哪个句柄你要。

虽然如果你之前没有使用过这些功能，那么这种方法将是一个真正的痛苦，所以希望有一种更简单的方法。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-17T02:14:21.937

@ageektrapped 在正确的轨道上，但`FindWindow`不会搜索子窗口。

为此，您将需要使用[`FindWindowEx`](http://pinvoke.net/default.aspx/user32/FindWindowEx.html)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2010-12-27T00:46:34.843

谢谢您的回答。多亏了你，我想出了如何知道进程的主窗口是否在前面：

注意：当然这需要 System.Diagnostic 和 System.Runtime.Interrop

```
public bool IsWindowActive(Int32 PID)
{
  return IsWindowActive(Process.GetProcessById(PID));
}

[DllImport("user32.dll")]
private static extern
IntPtr GetForegroundWindow();

public bool IsWindowActive(Process proc)
{
  proc.Refresh();
  return proc.MainWindowHandle.Equals(GetForegroundWindow());
} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-18T03:49:05.520

您可能会发现，如果您调用 .Refresh() 会获得新的顶级窗口。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-17T02:06:52.983

如果您知道窗口的标题，则可以通过 P/Invoke 使用 Win32 调用 FindWindow。

您可以在 pinvoke.net 上[找到签名](http://pinvoke.net/default.aspx/user32/FindWindow.html)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-17T02:27:28.067

据我了解`MainWindowHandle`，您开始的过程的属性无效。如果是这种情况，您可以使用[`FindWindow`](http://msdn.microsoft.com/en-us/library/ms633499.aspx)返回所需窗口句柄的函数（来自 Win32 SDK）。您所需要的只是目标应用程序主窗口的类名。您可以使用 Spy++ 或[Winspector](http://www.windows-spy.com/)获得它。您还需要通过检查窗口的进程 ID 来确保您拥有正确的窗口[`GetWindowThreadProcessId`](http://msdn.microsoft.com/en-us/library/ms633522.aspx)。

最后，我不得不说我不是 Win32 方面的专家，对于你的情况可能有更好的解决方案。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-29T18:14:44.543

使用 Process.GetProcessById(proc.Id); proc 是你的启动画面。为我工作。

现在，如何使用 win32 访问 System.Windows.Forms 中的主窗口属性以使其获得焦点？毕竟.net 应该是一个一站式的解决方案——不是吗？

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-09T21:22:24.430

在代码的某处，创建了“真正的”主窗口。您可以当时保存窗口句柄，然后在启动画面关闭后，您可以将 Application.MainWindow 设置为真实窗口。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-09T21:40:47.637

MainWindowHandle 属性在首次访问后被缓存，这就是为什么即使在句柄失效后您也看不到它发生变化的原因。GregUzelac 的信息是正确的。调用 Proces.Refresh 将导致对 Process.MainWindowHandle 的下一次调用重新执行逻辑以查找新的主窗口句柄。Michael 的逻辑也有效，因为新进程没有 MainWindowHandle 的缓存版本。

# cuda - 分配给设备内存的 CUDA 全局（如 C 语言）动态数组

> ID：79121
> 
> 赞同：7
> 
> 时间：2008-09-17T01:55:53.493
> 
> 标签：cuda, nvidia

所以，我试图编写一些利用 Nvidia 的 CUDA 架构的代码。我注意到在设备之间进行复制确实会损害我的整体性能，所以现在我正在尝试将大量数据移动到设备上。

由于这些数据用于许多功能，我希望它是全球性的。是的，我可以传递指针，但我真的很想知道在这种情况下如何使用全局变量。

所以，我有想要访问设备分配数组的设备函数。

理想情况下，我可以这样做：

```
__device__ float* global_data;

main()
{
  cudaMalloc(global_data);
  kernel1<<<blah>>>(blah); //access global data
  kernel2<<<blah>>>(blah); //access global data again
} 
```

但是，我还没有弄清楚如何创建一个动态数组。我通过如下声明数组找到了解决方法：

```
__device__ float global_data[REALLY_LARGE_NUMBER]; 
```

虽然这不需要 cudaMalloc 调用，但我更喜欢动态分配方法。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-17T03:52:41.950

像这样的东西应该可以工作。

```
#include <algorithm>

#define NDEBUG
#define CUT_CHECK_ERROR(errorMessage) do {                                 \
        cudaThreadSynchronize();                                           \
         cudaError_t err = cudaGetLastError();                             \
         if( cudaSuccess != err) {                                         \
                     fprintf(stderr, "Cuda error: %s in file '%s' in line %i : %s.\n",    \
                                             errorMessage, __FILE__, __LINE__, cudaGetErrorString( err) );\
                     exit(EXIT_FAILURE);                                                  \
                 } } while (0)

__device__ float *devPtr;

__global__
void kernel1(float *some_neat_data)
{
    devPtr = some_neat_data;
}

__global__
void kernel2(void)
{
    devPtr[threadIdx.x] *= .3f;
}

int main(int argc, char *argv[])
{
    float* otherDevPtr;
    cudaMalloc((void**)&otherDevPtr, 256 * sizeof(*otherDevPtr));
    cudaMemset(otherDevPtr, 0, 256 * sizeof(*otherDevPtr));

    kernel1<<<1,128>>>(otherDevPtr);
    CUT_CHECK_ERROR("kernel1");

    kernel2<<<1,128>>>();

    CUT_CHECK_ERROR("kernel2");

    return 0;
} 
```

试一试。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-17T02:24:59.977

花一些时间专注于 NVIDIA 提供的大量文档。

从编程指南：

```
float* devPtr;
cudaMalloc((void**)&devPtr, 256 * sizeof(*devPtr));
cudaMemset(devPtr, 0, 256 * sizeof(*devPtr)); 
```

这是一个如何分配内存的简单示例。现在，在您的内核中，您应该接受一个指向浮点数的指针，如下所示：

```
__global__
void kernel1(float *some_neat_data)
{
    some_neat_data[threadIdx.x]++;
}

__global__
void kernel2(float *potentially_that_same_neat_data)
{
    potentially_that_same_neat_data[threadIdx.x] *= 0.3f;
} 
```

所以现在你可以像这样调用它们：

```
float* devPtr;
cudaMalloc((void**)&devPtr, 256 * sizeof(*devPtr));
cudaMemset(devPtr, 0, 256 * sizeof(*devPtr));

kernel1<<<1,128>>>(devPtr);
kernel2<<<1,128>>>(devPtr); 
```

> 由于这些数据用于许多功能，我希望它是全球性的。

使用全局变量的充分理由很少。这绝对不是一个。我将把它作为一个练习来扩展这个例子，包括将“devPtr”移动到全局范围。

编辑：

好的，根本问题是这样的：您的内核只能访问设备内存，并且它们可以使用的唯一全局范围指针是 GPU 指针。从 CPU 调用内核时，在幕后发生的事情是指针和原语在内核执行之前被复制到 GPU 寄存器和/或共享内存中。

所以我能建议的最接近的是：使用 cudaMemcpyToSymbol() 来实现你的目标。但是，在后台，考虑另一种方法可能是正确的事情。

```
#include <algorithm>

__constant__ float devPtr[1024];

__global__
void kernel1(float *some_neat_data)
{
    some_neat_data[threadIdx.x] = devPtr[0] * devPtr[1];
}

__global__
void kernel2(float *potentially_that_same_neat_data)
{
    potentially_that_same_neat_data[threadIdx.x] *= devPtr[2];
}

int main(int argc, char *argv[])
{
    float some_data[256];
    for (int i = 0; i < sizeof(some_data) / sizeof(some_data[0]); i++)
    {
        some_data[i] = i * 2;
    }
    cudaMemcpyToSymbol(devPtr, some_data, std::min(sizeof(some_data), sizeof(devPtr) ));
    float* otherDevPtr;
    cudaMalloc((void**)&otherDevPtr, 256 * sizeof(*otherDevPtr));
    cudaMemset(otherDevPtr, 0, 256 * sizeof(*otherDevPtr));

    kernel1<<<1,128>>>(otherDevPtr);
    kernel2<<<1,128>>>(otherDevPtr);

    return 0;
} 
```

在这个例子中不要忘记'--host-compilation=c++'。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-18T16:55:53.043

我继续尝试分配临时指针并将其传递给类似于 kernel1 的简单全局函数的解决方案。

好消息是它确实有效:)

但是，我认为这会使编译器感到困惑，因为我现在在尝试访问全局数据时得到“建议：无法判断指针指向什么，假设是全局内存空间”。幸运的是，这个假设恰好是正确的，但是警告很烦人。

无论如何，为了记录 - 我已经查看了许多示例，并且确实运行了 nvidia 练习，其中的重点是让输出说“正确！”。但是，我还没有看过*所有*这些。如果有人知道他们进行动态全局设备内存分配的 sdk 示例，我仍然想知道。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-17T02:35:32.073

嗯，正是将 devPtr 移动到全局范围的问题是我的问题。

我有一个完全可以做到这一点的实现，两个内核都有一个指向传入数据的指针。我明确不想传入这些指针。

我已经相当仔细地阅读了文档，并访问了 nvidia 论坛（谷歌搜索了一个小时左右），但我还没有找到实际运行的全局动态设备数组的实现（我尝试了几个编译和然后以新的有趣的方式失败）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-18T02:27:59.993

查看 SDK 中包含的示例。其中许多示例项目都是通过示例学习的不错方式。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-08-18T11:21:28.347

> 由于这些数据用于许多功能，我希望它是全球性的。

-

> 使用全局变量的充分理由很少。这绝对不是一个。我将把它作为一个练习来扩展这个例子，包括将“devPtr”移动到全局范围。

如果内核在由数组组成的大型 const 结构上运行怎么办？使用所谓的常量内存不是一种选择，因为它的大小非常有限..所以你必须把它放在全局内存中..？

# c# - 创建将 T 限制为枚举的通用方法

> ID：79126
> 
> 赞同：1342
> 
> 时间：2008-09-17T01:56:19.267
> 
> 标签：c#, generics, enums, generic-constraints

我正在构建一个函数来扩展这个`Enum.Parse`概念

*   允许在未找到 Enum 值的情况下解析默认值
*   不区分大小写

所以我写了以下内容：

```
public static T GetEnumFromString<T>(string value, T defaultValue) where T : Enum
{
    if (string.IsNullOrEmpty(value)) return defaultValue;
    foreach (T item in Enum.GetValues(typeof(T)))
    {
        if (item.ToString().ToLower().Equals(value.Trim().ToLower())) return item;
    }
    return defaultValue;
} 
```

我得到一个错误约束不能是特殊类`System.Enum`。

很公平，但是是否有一种解决方法来允许通用枚举，或者我将不得不模仿该`Parse`函数并将类型作为属性传递，这会强制对您的代码进行丑陋的装箱要求。

**编辑**以下所有建议都非常感谢，谢谢。

已经确定（我已经离开循环以保持不区分大小写 - 我在解析 XML 时使用它）

```
public static class EnumUtils
{
    public static T ParseEnum<T>(string value, T defaultValue) where T : struct, IConvertible
    {
        if (!typeof(T).IsEnum) throw new ArgumentException("T must be an enumerated type");
        if (string.IsNullOrEmpty(value)) return defaultValue;

        foreach (T item in Enum.GetValues(typeof(T)))
        {
            if (item.ToString().ToLower().Equals(value.Trim().ToLower())) return item;
        }
        return defaultValue;
    }
} 
```

**编辑：**（2015 年 2 月 16 日）Christopher Currens在下面[的 MSIL 或 F# 中发布了一个编译器强制类型安全的通用解决方案，](https://stackoverflow.com/a/8086788)非常值得一看，并点赞。如果解决方案在页面上进一步冒泡，我将删除此编辑。

**编辑 2：**（2021 年 4 月 13 日）由于这个问题现在已经得到解决和支持，自 C# 7.3 以来，我已经改变了接受的答案，尽管全面阅读顶级答案对于学术和历史兴趣是值得的 :)

* * *

## 回答 #1

> 赞同：1075
> 
> 时间：2008-09-17T04:13:40.747

由于`Enum`Type 实现`IConvertible`了接口，更好的实现应该是这样的：

```
public T GetEnumFromString<T>(string value) where T : struct, IConvertible
{
   if (!typeof(T).IsEnum) 
   {
      throw new ArgumentException("T must be an enumerated type");
   }

   //...
} 
```

这仍然允许传递实现`IConvertible`. 不过机会很少。

* * *

## 回答 #2

> 赞同：831
> 
> 时间：2011-11-10T21:46:36.500

## C# 7.3 终于支持这个特性了！

以下片段（来自[dotnet 示例](https://github.com/dotnet/samples/blob/3ee82879284e3f4755251fd33c3b3e533f7b3485/snippets/csharp/keywords/GenericWhereConstraints.cs#L180-L190)）演示了如何：

```
public static Dictionary<int, string> EnumNamedValues<T>() where T : System.Enum
{
    var result = new Dictionary<int, string>();
    var values = Enum.GetValues(typeof(T));

    foreach (int item in values)
        result.Add(item, Enum.GetName(typeof(T), item));
    return result;
} 
```

确保将 C# 项目中的语言版本设置为 7.3 版。

* * *

原答案如下：

我玩游戏迟到了，但我把它当作一个挑战，看看它是如何完成的。这在 C#（或 VB.NET，但向下滚动到 F#）中是不可能的，但在 MSIL 中*是可能的。*我写了这个小……东西

```
// license: http://www.apache.org/licenses/LICENSE-2.0.html
.assembly MyThing{}
.class public abstract sealed MyThing.Thing
       extends [mscorlib]System.Object
{
  .method public static !!T  GetEnumFromString<valuetype .ctor ([mscorlib]System.Enum) T>(string strValue,
                                                                                          !!T defaultValue) cil managed
  {
    .maxstack  2
    .locals init ([0] !!T temp,
                  [1] !!T return_value,
                  [2] class [mscorlib]System.Collections.IEnumerator enumerator,
                  [3] class [mscorlib]System.IDisposable disposer)
    // if(string.IsNullOrEmpty(strValue)) return defaultValue;
    ldarg strValue
    call bool [mscorlib]System.String::IsNullOrEmpty(string)
    brfalse.s HASVALUE
    br RETURNDEF         // return default it empty

    // foreach (T item in Enum.GetValues(typeof(T)))
  HASVALUE:
    // Enum.GetValues.GetEnumerator()
    ldtoken !!T
    call class [mscorlib]System.Type [mscorlib]System.Type::GetTypeFromHandle(valuetype [mscorlib]System.RuntimeTypeHandle)
    call class [mscorlib]System.Array [mscorlib]System.Enum::GetValues(class [mscorlib]System.Type)
    callvirt instance class [mscorlib]System.Collections.IEnumerator [mscorlib]System.Array::GetEnumerator() 
    stloc enumerator
    .try
    {
      CONDITION:
        ldloc enumerator
        callvirt instance bool [mscorlib]System.Collections.IEnumerator::MoveNext()
        brfalse.s LEAVE

      STATEMENTS:
        // T item = (T)Enumerator.Current
        ldloc enumerator
        callvirt instance object [mscorlib]System.Collections.IEnumerator::get_Current()
        unbox.any !!T
        stloc temp
        ldloca.s temp
        constrained. !!T

        // if (item.ToString().ToLower().Equals(value.Trim().ToLower())) return item;
        callvirt instance string [mscorlib]System.Object::ToString()
        callvirt instance string [mscorlib]System.String::ToLower()
        ldarg strValue
        callvirt instance string [mscorlib]System.String::Trim()
        callvirt instance string [mscorlib]System.String::ToLower()
        callvirt instance bool [mscorlib]System.String::Equals(string)
        brfalse.s CONDITION
        ldloc temp
        stloc return_value
        leave.s RETURNVAL

      LEAVE:
        leave.s RETURNDEF
    }
    finally
    {
        // ArrayList's Enumerator may or may not inherit from IDisposable
        ldloc enumerator
        isinst [mscorlib]System.IDisposable
        stloc.s disposer
        ldloc.s disposer
        ldnull
        ceq
        brtrue.s LEAVEFINALLY
        ldloc.s disposer
        callvirt instance void [mscorlib]System.IDisposable::Dispose()
      LEAVEFINALLY:
        endfinally
    }

  RETURNDEF:
    ldarg defaultValue
    stloc return_value

  RETURNVAL:
    ldloc return_value
    ret
  }
} 
```

如果它是有效的 C#，它**会**生成一个看起来像这样的函数：

```
T GetEnumFromString<T>(string valueString, T defaultValue) where T : Enum 
```

然后使用以下 C# 代码：

```
using MyThing;
// stuff...
private enum MyEnum { Yes, No, Okay }
static void Main(string[] args)
{
    Thing.GetEnumFromString("No", MyEnum.Yes); // returns MyEnum.No
    Thing.GetEnumFromString("Invalid", MyEnum.Okay);  // returns MyEnum.Okay
    Thing.GetEnumFromString("AnotherInvalid", 0); // compiler error, not an Enum
} 
```

不幸的是，这意味着您的这部分代码是用 MSIL 而不是 C# 编写的，唯一的额外好处是您可以通过`System.Enum`. 这也有点令人失望，因为它被编译成一个单独的程序集。但是，这并不意味着您必须以这种方式部署它。

通过删除该行`.assembly MyThing{}`并调用 ilasm 如下：

```
ilasm.exe /DLL /OUTPUT=MyThing.netmodule 
```

你得到一个网络模块而不是一个程序集。

不幸的是，VS2010（以及更早的版本，显然）不支持添加 netmodule 引用，这意味着您在调试时必须将其保留在 2 个单独的程序集中。将它们添加为程序集的唯一方法是使用`/addmodule:{files}`命令行参数自己运行 csc.exe。在 MSBuild 脚本中不会*太痛苦。*当然，如果你是勇敢或愚蠢的，你可以每次手动运行 csc 。而且它肯定会变得更加复杂，因为多个程序集需要访问它。

所以，它可以在.Net中完成。值得付出额外的努力吗？嗯，好吧，我想我会让你决定那个。

* * *

### F# 解决方案作为替代方案

额外信用：事实证明，`enum`除了 MSIL：F# 之外，至少还有一种其他 .NET 语言可以对 进行通用限制。

```
type MyThing =
    static member GetEnumFromString<'T when 'T :> Enum> str defaultValue: 'T =
        /// protect for null (only required in interop with C#)
        let str = if isNull str then String.Empty else str

        Enum.GetValues(typedefof<'T>)
        |> Seq.cast<_>
        |> Seq.tryFind(fun v -> String.Compare(v.ToString(), str.Trim(), true) = 0)
        |> function Some x -> x | None -> defaultValue 
```

这个更易于维护，因为它是一种具有完整 Visual Studio IDE 支持的知名语言，但您仍然需要在解决方案中为它创建一个单独的项目。但是，它自然会产生相当不同的 IL（代码*非常*不同），并且它依赖于`FSharp.Core`库，就像任何其他外部库一样，它需要成为您的发行版的一部分。

以下是如何使用它（基本上与 MSIL 解决方案相同），并表明它在其他同义结构上正确失败：

```
// works, result is inferred to have type StringComparison
var result = MyThing.GetEnumFromString("OrdinalIgnoreCase", StringComparison.Ordinal);
// type restriction is recognized by C#, this fails at compile time
var result = MyThing.GetEnumFromString("OrdinalIgnoreCase", 42); 
```

* * *

## 回答 #3

> 赞同：248
> 
> 时间：2015-02-15T15:16:07.153

# C# ≥ 7.3

从 C# 7.3（适用于 Visual Studio 2017 ≥ v15.7）开始，此代码现在完全有效：

```
public static TEnum Parse<TEnum>(string value)
    where TEnum : struct, Enum
{
 ...
} 
```

* * *

# C# ≤ 7.2

您可以通过滥用约束继承来获得真正的编译器强制枚举约束。以下代码同时指定了 a`class`和 a`struct`约束：

```
public abstract class EnumClassUtils<TClass>
where TClass : class
{

    public static TEnum Parse<TEnum>(string value)
    where TEnum : struct, TClass
    {
        return (TEnum) Enum.Parse(typeof(TEnum), value);
    }

}

public class EnumUtils : EnumClassUtils<Enum>
{
} 
```

用法：

```
EnumUtils.Parse<SomeEnum>("value"); 
```

注意：这在 C# 5.0 语言规范中有特别说明：

> 如果类型参数 S 依赖于类型参数 T 那么： [...] S 具有值类型约束和 T 具有引用类型约束是有效的。实际上，这将 T 限制为 System.Object、System.ValueType、System.Enum 和任何接口类型。

* * *

## 回答 #4

> 赞同：31
> 
> 时间：2013-05-24T14:07:25.683

**编辑**

[Julien Lebosquain](https://stackoverflow.com/a/28527552/422877)现在已经很好地回答了这个问题。我还想用`ignoreCase`,`defaultValue`和可选参数扩展他的答案，同时添加`TryParse`和`ParseOrDefault`。

```
public abstract class ConstrainedEnumParser<TClass> where TClass : class
// value type constraint S ("TEnum") depends on reference type T ("TClass") [and on struct]
{
    // internal constructor, to prevent this class from being inherited outside this code
    internal ConstrainedEnumParser() {}
    // Parse using pragmatic/adhoc hard cast:
    //  - struct + class = enum
    //  - 'guaranteed' call from derived <System.Enum>-constrained type EnumUtils
    public static TEnum Parse<TEnum>(string value, bool ignoreCase = false) where TEnum : struct, TClass
    {
        return (TEnum)Enum.Parse(typeof(TEnum), value, ignoreCase);
    }
    public static bool TryParse<TEnum>(string value, out TEnum result, bool ignoreCase = false, TEnum defaultValue = default(TEnum)) where TEnum : struct, TClass // value type constraint S depending on T
    {
        var didParse = Enum.TryParse(value, ignoreCase, out result);
        if (didParse == false)
        {
            result = defaultValue;
        }
        return didParse;
    }
    public static TEnum ParseOrDefault<TEnum>(string value, bool ignoreCase = false, TEnum defaultValue = default(TEnum)) where TEnum : struct, TClass // value type constraint S depending on T
    {
        if (string.IsNullOrEmpty(value)) { return defaultValue; }
        TEnum result;
        if (Enum.TryParse(value, ignoreCase, out result)) { return result; }
        return defaultValue;
    }
}

public class EnumUtils: ConstrainedEnumParser<System.Enum>
// reference type constraint to any <System.Enum>
{
    // call to parse will then contain constraint to specific <System.Enum>-class
} 
```

使用示例：

```
WeekDay parsedDayOrArgumentException = EnumUtils.Parse<WeekDay>("monday", ignoreCase:true);
WeekDay parsedDayOrDefault;
bool didParse = EnumUtils.TryParse<WeekDay>("clubs", out parsedDayOrDefault, ignoreCase:true);
parsedDayOrDefault = EnumUtils.ParseOrDefault<WeekDay>("friday", ignoreCase:true, defaultValue:WeekDay.Sunday); 
```

* * *

**老的**

通过使用评论和“新”发展，我对[Vivek 的回答](https://stackoverflow.com/a/79903)进行了旧改进：

*   `TEnum`为用户清晰使用
*   添加更多接口约束以进行额外的约束检查
*   让[`TryParse`](http://msdn.microsoft.com/en-us/library/dd991317.aspx)处理`ignoreCase`现有参数（在VS2010/.Net 4中引入）
*   可选地使用通用[`default`值](http://msdn.microsoft.com/en-us/library/xwth0h0d.aspx)（在 VS2005/.Net 2 中引入）
*   使用带有默认值的[可选参数](http://msdn.microsoft.com/en-us/library/dd264739.aspx)`defaultValue`（在 VS2010/.Net 4 中引入），for和`ignoreCase`

导致：

```
public static class EnumUtils
{
    public static TEnum ParseEnum<TEnum>(this string value,
                                         bool ignoreCase = true,
                                         TEnum defaultValue = default(TEnum))
        where TEnum : struct,  IComparable, IFormattable, IConvertible
    {
        if ( ! typeof(TEnum).IsEnum) { throw new ArgumentException("TEnum must be an enumerated type"); }
        if (string.IsNullOrEmpty(value)) { return defaultValue; }
        TEnum lResult;
        if (Enum.TryParse(value, ignoreCase, out lResult)) { return lResult; }
        return defaultValue;
    }
} 
```

* * *

## 回答 #5

> 赞同：25
> 
> 时间：2018-03-22T15:27:56.050

从 C# <=7.2 开始，现有答案是正确的。但是，有一个 C# 语言[功能请求](https://github.com/dotnet/csharplang/issues/104)（与[corefx](https://github.com/dotnet/corefx/issues/15453)功能请求相关联）允许执行以下操作；

```
public class MyGeneric<TEnum> where TEnum : System.Enum
{ } 
```

在撰写本文时，该功能是语言发展会议上的“讨论中”。

**编辑**

根据[nawfal](https://stackoverflow.com/users/661933/nawfal)的信息，这是在 C# [7.3](https://docs.microsoft.com/en-us/visualstudio/releasenotes/vs2017-Preview-relnotes#csharp)中引入的。

**编辑 2**

这现在在 C# 7.3 中（[发行说明](https://docs.microsoft.com/en-us/dotnet/csharp/whats-new/csharp-7-3)）

样本;

```
public static Dictionary<int, string> EnumNamedValues<T>()
    where T : System.Enum
{
    var result = new Dictionary<int, string>();
    var values = Enum.GetValues(typeof(T));

    foreach (int item in values)
        result.Add(item, Enum.GetName(typeof(T), item));
    return result;
} 
```

* * *

## 回答 #6

> 赞同：20
> 
> 时间：2008-09-17T02:32:54.700

您可以为该类定义一个静态构造函数，该构造函数将检查类型 T 是否为枚举，如果不是则抛出异常。这是 Jeffery Richter 在他的《CLR via C#》一书中提到的方法。

```
internal sealed class GenericTypeThatRequiresAnEnum<T> {
    static GenericTypeThatRequiresAnEnum() {
        if (!typeof(T).IsEnum) {
        throw new ArgumentException("T must be an enumerated type");
        }
    }
} 
```

然后在 parse 方法中，您可以只使用 Enum.Parse(typeof(T), input, true) 将字符串转换为枚举。最后一个 true 参数用于忽略输入的大小写。

* * *

## 回答 #7

> 赞同：18
> 
> 时间：2018-05-10T09:55:13.803

还应该考虑的是，由于使用 Enum 约束的 C# 7.3 的发布是开箱即用的，而无需进行额外的检查和其他工作。

因此，如果您已将项目的语言版本更改为 C# 7.3，那么接下来的代码将可以正常工作：

```
 private static T GetEnumFromString<T>(string value, T defaultValue) where T : Enum
    {
        // Your code goes here...
    } 
```

如果您不知道如何将语言版本更改为 C# 7.3，请参阅以下屏幕截图： [![在此处输入图像描述](https://i.stack.imgur.com/GMWgy.png)](https://i.stack.imgur.com/GMWgy.png)

**编辑 1 - 所需的 Visual Studio 版本并考虑使用 ReSharper**

要让 Visual Studio 识别新语法，您至少需要 15.7 版。您可以在 Microsoft 的发行说明中找到同样提到的内容，请参阅[Visual Studio 2017 15.7 发行说明](https://docs.microsoft.com/en-us/visualstudio/releasenotes/vs2017-relnotes#whats-new-in-157)。感谢@MohamedElshawaf 指出这个有效的问题。

请注意，在我的情况下，ReSharper 2018.1 在编写此 EDIT 时还不支持 C# 7.3。激活 ReSharper 后，它将 Enum 约束突出显示为一个错误，告诉我*Cannot use 'System.Array', 'System.Delegate', 'System.Enum', 'System.ValueType', 'object' as type parameter constraint*。ReSharper 建议快速修复*删除方法类型参数 T 的“枚举”约束*

*但是，如果您在工具 -> 选项 -> ReSharper Ultimate -> 常规*下暂时关闭 ReSharper，您会发现语法非常好，因为您使用的是 VS 15.7 或更高版本以及 C# 7.3 或更高版本。

* * *

## 回答 #8

> 赞同：11
> 
> 时间：2008-09-17T02:24:14.567

我通过 dimarzionist 修改了样本。此版本仅适用于 Enums 而不允许结构通过。

```
public static T ParseEnum<T>(string enumString)
    where T : struct // enum 
    {
    if (String.IsNullOrEmpty(enumString) || !typeof(T).IsEnum)
       throw new Exception("Type given must be an Enum");
    try
    {

       return (T)Enum.Parse(typeof(T), enumString, true);
    }
    catch (Exception ex)
    {
       return default(T);
    }
} 
```

* * *

## 回答 #9

> 赞同：11
> 
> 时间：2010-12-16T11:24:29.120

我试着改进一下代码：

```
public T LoadEnum<T>(string value, T defaultValue = default(T)) where T : struct, IComparable, IFormattable, IConvertible
{
    if (Enum.IsDefined(typeof(T), value))
    {
        return (T)Enum.Parse(typeof(T), value, true);
    }
    return defaultValue;
} 
```

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2008-09-17T02:00:07.570

希望这会有所帮助：

```
public static TValue ParseEnum<TValue>(string value, TValue defaultValue)
                  where TValue : struct // enum 
{
      try
      {
            if (String.IsNullOrEmpty(value))
                  return defaultValue;
            return (TValue)Enum.Parse(typeof (TValue), value);
      }
      catch(Exception ex)
      {
            return defaultValue;
      }
} 
```

* * *

## 回答 #11

> 赞同：6
> 
> 时间：2010-04-18T05:38:20.310

我确实有特定的要求，我需要将枚举与与枚举值关联的文本一起使用。例如，当我使用枚举指定错误类型时，它需要描述错误详细信息。

```
public static class XmlEnumExtension
{
    public static string ReadXmlEnumAttribute(this Enum value)
    {
        if (value == null) throw new ArgumentNullException("value");
        var attribs = (XmlEnumAttribute[]) value.GetType().GetField(value.ToString()).GetCustomAttributes(typeof (XmlEnumAttribute), true);
        return attribs.Length > 0 ? attribs[0].Name : value.ToString();
    }

    public static T ParseXmlEnumAttribute<T>(this string str)
    {
        foreach (T item in Enum.GetValues(typeof(T)))
        {
            var attribs = (XmlEnumAttribute[])item.GetType().GetField(item.ToString()).GetCustomAttributes(typeof(XmlEnumAttribute), true);
            if(attribs.Length > 0 && attribs[0].Name.Equals(str)) return item;
        }
        return (T)Enum.Parse(typeof(T), str, true);
    }
}

public enum MyEnum
{
    [XmlEnum("First Value")]
    One,
    [XmlEnum("Second Value")]
    Two,
    Three
}

 static void Main()
 {
    // Parsing from XmlEnum attribute
    var str = "Second Value";
    var me = str.ParseXmlEnumAttribute<MyEnum>();
    System.Console.WriteLine(me.ReadXmlEnumAttribute());
    // Parsing without XmlEnum
    str = "Three";
    me = str.ParseXmlEnumAttribute<MyEnum>();
    System.Console.WriteLine(me.ReadXmlEnumAttribute());
    me = MyEnum.One;
    System.Console.WriteLine(me.ReadXmlEnumAttribute());
} 
```

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2009-07-07T17:00:47.777

有趣的是，显然这[在其他语言中是可能的](http://social.msdn.microsoft.com/Forums/en-US/vs2010ctpvbcs/thread/5844d719-3ef6-4000-913c-27c108269e71)（直接托管 C++，IL）。

去引用：

> ...这两个约束实际上都会产生有效的 IL，如果用另一种语言编写，也可以由 C# 使用（您可以在托管 C++ 或 IL 中声明这些约束）。

谁知道

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2014-03-25T13:40:43.580

这是我的看法。从答案和MSDN结合

```
public static TEnum ParseToEnum<TEnum>(this string text) where TEnum : struct, IConvertible, IComparable, IFormattable
{
    if (string.IsNullOrEmpty(text) || !typeof(TEnum).IsEnum)
        throw new ArgumentException("TEnum must be an Enum type");

    try
    {
        var enumValue = (TEnum)Enum.Parse(typeof(TEnum), text.Trim(), true);
        return enumValue;
    }
    catch (Exception)
    {
        throw new ArgumentException(string.Format("{0} is not a member of the {1} enumeration.", text, typeof(TEnum).Name));
    }
} 
```

[MSDN 源](http://msdn.microsoft.com/en-us/library/kxydatf9%28v=vs.110%29.aspx)

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2021-10-14T15:44:51.907

请注意，`System.Enum` `Parse()`&`TryParse()`方法仍然有`where struct`约束而不是`where Enum`，因此无法编译：

```
 bool IsValid<TE>(string attempted) where TE : Enum
    {
        return Enum.TryParse(attempted, out TE _);
    } 
```

但这将：

```
bool Ok<TE>(string attempted) where TE : struct,Enum
{
    return Enum.TryParse(attempted, out var _)
} 
```

因此，`where struct,Enum`可能比仅仅更可取`where Enum`

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2010-10-04T23:09:58.317

我一直很喜欢这个（你可以酌情修改）：

```
public static IEnumerable<TEnum> GetEnumValues()
{
  Type enumType = typeof(TEnum);

  if(!enumType.IsEnum)
    throw new ArgumentException("Type argument must be Enum type");

  Array enumValues = Enum.GetValues(enumType);
  return enumValues.Cast<TEnum>();
} 
```

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2012-04-23T01:23:29.307

我喜欢 Christopher Currens 使用 IL 的解决方案，但对于那些不想处理将 MSIL 包含到他们的构建过程中的棘手业务的人，我在 C# 中编写了类似的函数。

请注意，您不能使用通用限制，`where T : Enum`因为 Enum 是特殊类型。因此我必须检查给定的泛型类型是否真的是枚举。

我的功能是：

```
public static T GetEnumFromString<T>(string strValue, T defaultValue)
{
    // Check if it realy enum at runtime 
    if (!typeof(T).IsEnum)
        throw new ArgumentException("Method GetEnumFromString can be used with enums only");

    if (!string.IsNullOrEmpty(strValue))
    {
        IEnumerator enumerator = Enum.GetValues(typeof(T)).GetEnumerator();
        while (enumerator.MoveNext())
        {
            T temp = (T)enumerator.Current;
            if (temp.ToString().ToLower().Equals(strValue.Trim().ToLower()))
                return temp;
        }
    }

    return defaultValue;
} 
```

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2013-07-25T07:55:49.840

我已经将 Vivek 的解决方案封装到一个实用程序类中，您可以重用它。请注意，您仍然应该在您的类型上定义类型约束“where T: struct, IConvertible”。

```
using System;

internal static class EnumEnforcer
{
    /// <summary>
    /// Makes sure that generic input parameter is of an enumerated type.
    /// </summary>
    /// <typeparam name="T">Type that should be checked.</typeparam>
    /// <param name="typeParameterName">Name of the type parameter.</param>
    /// <param name="methodName">Name of the method which accepted the parameter.</param>
    public static void EnforceIsEnum<T>(string typeParameterName, string methodName)
        where T : struct, IConvertible
    {
        if (!typeof(T).IsEnum)
        {
            string message = string.Format(
                "Generic parameter {0} in {1} method forces an enumerated type. Make sure your type parameter {0} is an enum.",
                typeParameterName,
                methodName);

            throw new ArgumentException(message);
        }
    }

    /// <summary>
    /// Makes sure that generic input parameter is of an enumerated type.
    /// </summary>
    /// <typeparam name="T">Type that should be checked.</typeparam>
    /// <param name="typeParameterName">Name of the type parameter.</param>
    /// <param name="methodName">Name of the method which accepted the parameter.</param>
    /// <param name="inputParameterName">Name of the input parameter of this page.</param>
    public static void EnforceIsEnum<T>(string typeParameterName, string methodName, string inputParameterName)
        where T : struct, IConvertible
    {
        if (!typeof(T).IsEnum)
        {
            string message = string.Format(
                "Generic parameter {0} in {1} method forces an enumerated type. Make sure your input parameter {2} is of correct type.",
                typeParameterName,
                methodName,
                inputParameterName);

            throw new ArgumentException(message);
        }
    }

    /// <summary>
    /// Makes sure that generic input parameter is of an enumerated type.
    /// </summary>
    /// <typeparam name="T">Type that should be checked.</typeparam>
    /// <param name="exceptionMessage">Message to show in case T is not an enum.</param>
    public static void EnforceIsEnum<T>(string exceptionMessage)
        where T : struct, IConvertible
    {
        if (!typeof(T).IsEnum)
        {
            throw new ArgumentException(exceptionMessage);
        }
    }
} 
```

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2016-11-01T09:29:45.720

我创建了一个扩展方法`to get integer value from enum` 看看方法实现

```
public static int ToInt<T>(this T soure) where T : IConvertible//enum
{
    if (typeof(T).IsEnum)
    {
        return (int) (IConvertible)soure;// the tricky part
    }
    //else
    //    throw new ArgumentException("T must be an enumerated type");
    return soure.ToInt32(CultureInfo.CurrentCulture);
} 
```

这是用法

```
MemberStatusEnum.Activated.ToInt()// using extension Method
(int) MemberStatusEnum.Activated //the ordinary way 
```

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2017-07-24T06:49:10.730

如之前的其他答案所述；虽然这不能在源代码中表达，但实际上可以在 IL 级别完成。@Christopher Currens的[回答](https://stackoverflow.com/a/8086788/684096)显示了 IL 如何做到这一点。

使用[Fody](https://github.com/Fody/Fody)的 Add-In [ExtraConstraints.Fody](https://github.com/Fody/ExtraConstraints)有一个非常简单的方法，加上构建工具，可以实现这一点。只需将他们的 nuget 包 ( `Fody`, `ExtraConstraints.Fody`) 添加到您的项目中并添加如下约束（Excerpt from the Readme of ExtraConstraints）：

```
public void MethodWithEnumConstraint<[EnumConstraint] T>() {...}

public void MethodWithTypeEnumConstraint<[EnumConstraint(typeof(ConsoleColor))] T>() {...} 
```

Fody 将添加必要的 IL 以使约束存在。还要注意约束代表的附加功能：

```
public void MethodWithDelegateConstraint<[DelegateConstraint] T> ()
{...}

public void MethodWithTypeDelegateConstraint<[DelegateConstraint(typeof(Func<int>))] T> ()
{...} 
```

关于 Enums，您可能还想注意非常有趣的[Enums.NET](https://github.com/TylerBrinkley/Enums.NET)。

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2019-11-06T13:29:48.153

这是我的实现。基本上，您可以设置任何属性并且它可以工作。

```
public static class EnumExtensions
    {
        public static string GetDescription(this Enum @enum)
        {
            Type type = @enum.GetType();
            FieldInfo fi = type.GetField(@enum.ToString());
            DescriptionAttribute[] attrs =
                fi.GetCustomAttributes(typeof(DescriptionAttribute), false) as DescriptionAttribute[];
            if (attrs.Length > 0)
            {
                return attrs[0].Description;
            }
            return null;
        }
    } 
```

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2017-11-23T14:17:57.757

如果之后可以使用直接转换，我想您可以`System.Enum`在必要时在方法中使用基类。您只需要仔细替换类型参数即可。所以方法实现就像：

```
public static class EnumUtils
{
    public static Enum GetEnumFromString(string value, Enum defaultValue)
    {
        if (string.IsNullOrEmpty(value)) return defaultValue;
        foreach (Enum item in Enum.GetValues(defaultValue.GetType()))
        {
            if (item.ToString().ToLower().Equals(value.Trim().ToLower())) return item;
        }
        return defaultValue;
    }
} 
```

然后你可以像这样使用它：

```
var parsedOutput = (YourEnum)EnumUtils.GetEnumFromString(someString, YourEnum.DefaultValue); 
```

* * *

## 回答 #22

> 赞同：-7
> 
> 时间：2018-05-30T04:11:57.363

为了完整起见，以下是一个 Java 解决方案。我确信同样可以在 C# 中完成。它避免了必须在代码中的任何地方指定类型 - 相反，您可以在尝试解析的字符串中指定它。

问题是没有任何方法可以知道字符串可能匹配哪个枚举——所以答案是解决这个问题。

不要只接受字符串值，而是接受一个同时具有枚举和“enumeration.value”形式的值的字符串。工作代码如下 - 需要 Java 1.8 或更高版本。这也会使 XML 更加精确，因为您会看到类似 color="Color.red" 而不仅仅是 color="red" 的内容。

您将使用包含枚举名称点值名称的字符串调用 acceptEnumeratedValue() 方法。

该方法返回正式的枚举值。

```
import java.util.HashMap;
import java.util.Map;
import java.util.function.Function;

public class EnumFromString {

    enum NumberEnum {One, Two, Three};
    enum LetterEnum {A, B, C};

    Map<String, Function<String, ? extends Enum>> enumsByName = new HashMap<>();

    public static void main(String[] args) {
        EnumFromString efs = new EnumFromString();

        System.out.print("\nFirst string is NumberEnum.Two - enum is " + efs.acceptEnumeratedValue("NumberEnum.Two").name());
        System.out.print("\nSecond string is LetterEnum.B - enum is " + efs.acceptEnumeratedValue("LetterEnum.B").name());

    }

    public EnumFromString() {
        enumsByName.put("NumberEnum", s -> {return NumberEnum.valueOf(s);});
        enumsByName.put("LetterEnum", s -> {return LetterEnum.valueOf(s);});
    }

    public Enum acceptEnumeratedValue(String enumDotValue) {

        int pos = enumDotValue.indexOf(".");

        String enumName = enumDotValue.substring(0, pos);
        String value = enumDotValue.substring(pos + 1);

        Enum enumeratedValue = enumsByName.get(enumName).apply(value);

        return enumeratedValue;
    }

} 
```

# asp.net-mvc - 在 ASP.NET MVC 中实现配置文件提供程序

> ID：79129
> 
> 赞同：63
> 
> 时间：2008-09-17T01:56:37.173
> 
> 标签：asp.net-mvc, profile, profile-provider

对于我的一生，我无法让 SqlProfileProvider 在我正在处理的 MVC 项目中工作。

我意识到的第一个有趣的事情是 Visual Studio 不会自动为您生成 ProfileCommon 代理类。这没什么大不了的，因为扩展 ProfileBase 类很简单。创建 ProfileCommon 类后，我编写了以下用于创建用户配置文件的 Action 方法。

```
[AcceptVerbs("POST")]
public ActionResult CreateProfile(string company, string phone, string fax, string city, string state, string zip)
{
    MembershipUser user = Membership.GetUser();
    ProfileCommon profile = ProfileCommon.Create(user.UserName, user.IsApproved) as ProfileCommon;

    profile.Company = company;
    profile.Phone = phone;
    profile.Fax = fax;
    profile.City = city;
    profile.State = state;
    profile.Zip = zip;
    profile.Save();

    return RedirectToAction("Index", "Account"); 
}
```

我遇到的问题是对 ProfileCommon.Create() 的调用无法转换为 ProfileCommon 类型，因此我无法取回我的配置文件对象，这显然会导致下一行失败，因为配置文件为空。

以下是我的 web.config 的片段：

```
<profile defaultProvider="AspNetSqlProfileProvider" automaticSaveEnabled="false" enabled="true">
    <providers>
        <clear/>
        <add name="AspNetSqlProfileProvider" type="System.Web.Profile.SqlProfileProvider, System.Web, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a" connectionStringName="ApplicationServices" applicationName="/" />
    </providers>
    <properties>
        <add name="FirstName" type="string" />
        <add name="LastName" type="string" />
        <add name="Company" type="string" />
        <add name="Phone" type="string" />
        <add name="Fax" type="string" />
        <add name="City" type="string" />
        <add name="State" type="string" />
        <add name="Zip" type="string" />
        <add name="Email" type="string" >
    </properties>
</profile>
```

MembershipProvider 工作顺利，所以我知道连接字符串很好。

以防万一，这是我的 ProfileCommon 类：

```
public class ProfileCommon : ProfileBase
    {
        public virtual string Company
        {
            get
            {
                return ((string)(this.GetPropertyValue("Company")));
            }
            set
            {
                this.SetPropertyValue("Company", value);
            }
        }

        public virtual string Phone
        {
            get
            {
                return ((string)(this.GetPropertyValue("Phone")));
            }
            set
            {
                this.SetPropertyValue("Phone", value);
            }
        }

        public virtual string Fax
        {
            get
            {
                return ((string)(this.GetPropertyValue("Fax")));
            }
            set
            {
                this.SetPropertyValue("Fax", value);
            }
        }

        public virtual string City
        {
            get
            {
                return ((string)(this.GetPropertyValue("City")));
            }
            set
            {
                this.SetPropertyValue("City", value);
            }
        }

        public virtual string State
        {
            get
            {
                return ((string)(this.GetPropertyValue("State")));
            }
            set
            {
                this.SetPropertyValue("State", value);
            }
        }

        public virtual string Zip
        {
            get
            {
                return ((string)(this.GetPropertyValue("Zip")));
            }
            set
            {
                this.SetPropertyValue("Zip", value);
            }
        }

        public virtual ProfileCommon GetProfile(string username)
        {
            return ((ProfileCommon)(ProfileBase.Create(username)));
        }
    }
```

关于我可能做错了什么的任何想法？你们其他人有没有成功地将 ProfileProvider 与 ASP.NET MVC 项目集成？

先感谢您...

* * *

## 回答 #1

> 赞同：56
> 
> 时间：2009-01-12T08:25:20.520

这是您需要做的：

1) 在 Web.config 的部分，除了您的其他属性设置之外，添加“继承”属性：

```
<profile inherits="MySite.Models.ProfileCommon" defaultProvider=".... 
```

2) 从 Web.config 中删除整个`<properties>`部分，因为您已经在自定义 ProfileCommon 类中定义了它们，并且在上一步中还指示从自定义类继承

3) 将 ProfileCommon.GetProfile() 方法的代码更改为

```
public virtual ProfileCommon GetProfile(string username)        
{            
     return Create(username) as ProfileCommon;      
} 
```

希望这可以帮助。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-17T06:45:13.877

不确定整个问题，但我在您的代码中注意到一件事：

```
ProfileCommon profile = (ProfileCommon)ProfileCommon.Create(user.UserName, user.IsApproved) as ProfileCommon; 
```

您不需要 (ProfileCommon) 和 as ProfileCommon。它们都进行强制转换，但 () 抛出异常，而 as 如果无法进行强制转换，则返回 null。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-09-18T16:06:42.990

试试[Web Profile Builder](http://code.msdn.microsoft.com/WebProfileBuilder)。它是一个从 web.config 自动生成 WebProfile 类（相当于 ProfileCommon）的构建脚本。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-04T04:53:02.097

MVC Beta 中的 web.config 文件是错误的。SqlProfileProvider 位于 System.Web.Profile，而不是 System.Web.Security。改变这个，它应该开始为你工作。

# macos - 从 macOS 上的会话中注销其他用户的最佳方法是什么？

> ID：79133
> 
> 赞同：7
> 
> 时间：2008-09-17T01:57:15.580
> 
> 标签：macos, macos-sierra, sysadmin

换句话说：

1.  以 Bert（管理员）身份登录
2.  使用快速用户切换，以 Ernie 身份登录（Bert 保持登录状态）
3.  切换回伯特
4.  伯特注销厄尼

实现第 4 步的最佳方法是什么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2017-03-21T02:56:54.383

`sudo launchctl bootout user/$(id -u <username>)`

替换`<username>`为目标用户的用户名。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-17T02:27:54.697

[这个论坛帖子](http://macosx.com/tech-support/mac/force-shutdown-logoff-restart-via-applescript/25909.html)有一个用于 OSX 的 bash 脚本，它应该可以解决问题。它将用户名作为参数并注销该用户。

我没试过，所以你的里程可能会有所不同。但它看起来适合您的需求。你到底想达到什么目的？

# windows - 如何创建容器文件？

> ID：79136
> 
> 赞同：2
> 
> 时间：2008-09-17T01:57:53.490
> 
> 标签：windows, macos, file-format, container-file

我想为我的应用程序创建一个文件格式，例如 Quake、OO 和 MS Office 07。

基本上是一个未压缩的 zip 文件夹或 tar 文件。

我需要它是跨平台的（mac和windows）。

我可以通过命令提示符和 bash 做某事吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-17T02:02:56.317

如果您想要一个可移植到所有平台并包含结构化数据的单个文件，请考虑使用 sqlite。您将获得一个功能齐全的符合 ACID 的数据库，该数据库作为单个文件存在于磁盘上。

您可以链接一些库以直接访问该文件，还可以使用一个命令行工具。无论您使用哪种语言，很可能都支持它。

[http://www.sqlite.org](http://www.sqlite.org)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-17T01:59:51.503

到处都支持 Zip。如果您只需要一个容器，那么这些肯定是不错的选择。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-17T02:00:29.397

看看开源的[7Zip](http://www.7-zip.org/)压缩格式。对于您的特定需求，您可以在“存档”模式下使用它，零压缩但速度非常快。

它从该站点提供了一个强大的 SDK，LZMA：

“LZMA是7-Zip程序中7z格式的默认和通用压缩方式。LZMA提供了很高的压缩比和非常快的解压速度，因此非常适合嵌入式应用。例如，它可以用于ROM（固件) 压缩。

LZMA SDK 提供了开发使用 LZMA 压缩的应用程序所需的文档、示例、头文件、库和工具。”

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-17T02:15:34.727

SQLite 很棒。

单个文件，跨平台，一个小型库，对数据的 SQL 访问，事务，整个 enchilada。

在崩溃的情况下，您可以使用事务来保证一致的返回点。检查[sqlite 的用途](http://sqlite.org/whentouse.html)，他们特别提倡将其用作桌面应用程序的数据模型层。

此外，还有一个命令行工具可以手动访问数据。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-17T02:06:13.203

你应该问自己的第一件事是，“我真的需要自己做吗？”

根据您要使用它的目的，您可能最好使用通用格式和一些已经很好地处理其中一种格式的预制库。

好的起点： http: [//www.destructor.de/libtar/index.htm](http://www.destructor.de/libtar/index.htm) （tar——一种“容器”格式） [http://www.zlib.net/](http://www.zlib.net/) （zlib——一种压缩数据的方法在您将其放入容器之前或之后）

如果你仍然认为你需要自己制作，我建议先学习一些非常简单的东西，比如 tar 的格式：

[http://en.wikipedia.org/wiki/Tar_(file_format)](http://en.wikipedia.org/wiki/Tar_(file_format)) 或 [http://schmidt.devlib.org/file-formats/tar-archive-file-format.html](http://schmidt.devlib.org/file-formats/tar-archive-file-format.html)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-17T21:20:47.767

我不会制定格式，而是决定约定。容器中的一个或多个命名文件具有访问其余文件所需的元数据，并且知道如何处理它们。但是，容器本身应该只是一些普遍存在的格式，例如 zip。在这里，无需重新发明轮子。

# svn - 如何将具有历史记录的 SVN 存储库迁移到新的 Git 存储库？

> ID：79165
> 
> 赞同：1565
> 
> 时间：2008-09-17T02:04:20.853
> 
> 标签：svn, git, version-control, git-svn

我阅读了 Git 手册、常见问题解答、Git - SVN 速成课程等，它们都解释了这个和那个，但你在任何地方都找不到像这样的简单说明：

SVN 存储库位于：`svn://myserver/path/to/svn/repos`

Git 存储库位于：`git://myserver/path/to/git/repos`

```
git-do-the-magic-svn-import-with-history \
svn://myserver/path/to/svn/repos \
git://myserver/path/to/git/repos 
```

我不希望它那么简单，也不希望它是一个命令。但我确实希望它不会试图解释任何事情 - 只是说给出这个例子要采取的步骤。

* * *

## 回答 #1

> 赞同：1617
> 
> 时间：2010-10-19T19:45:07.157

创建`users.txt`用于将 SVN 用户映射到 Git 的用户文件（即 ）：

```
user1 = First Last Name <email@address.com>
user2 = First Last Name <email@address.com>
... 
```

您可以使用此单线从现有的 SVN 存储库构建模板：

```
svn log -q | awk -F '|' '/^r/ {gsub(/ /, "", $2); sub(" $", "", $2); print $2" = "$2" <"$2">"}' | sort -u > users.txt 
```

如果 SVN 发现丢失的 SVN 用户，而不是在文件中，它将停止。但在那之后，您可以更新文件并从上次中断的地方继续。

现在从存储库中提取 SVN 数据：

```
git svn clone --stdlayout --no-metadata --authors-file=users.txt svn://hostname/path dest_dir-tmp 
```

此命令将在其中创建一个新的 Git 存储库`dest_dir-tmp`并开始拉取 SVN 存储库。请注意，“--stdlayout”标志意味着您具有通用的“主干/、分支/、标签/”SVN 布局。如果您的布局不同，请熟悉`--tags`、`--branches`、`--trunk`选项（通常`git svn help`）。

允许所有常用协议：`svn://`, `http://`, `https://`. URL 应该以基本存储库为目标，例如[http://svn.mycompany.com/myrepo/repository](http://svn.mycompany.com/myrepo/repository)。URL 字符串**不能**包含`/trunk`,`/tag`或`/branches`。

请注意，执行此命令后，经常会出现操作“挂起/冻结”的情况，并且在初始化新存储库后可能会卡住很长时间是很正常的。最终，您将看到指示它正在迁移的日志消息。

另请注意，如果您省略该`--no-metadata`标志，Git 会将有关相应 SVN 修订的信息附加到提交消息（即`git-svn-id: svn://svn.mycompany.com/myrepo/<branchname/trunk>@<RevisionNumber> <Repository UUID>`）

如果未找到用户名，请更新您的`users.txt`文件，然后：

```
cd dest_dir-tmp
git svn fetch 
```

如果您有一个大型项目，直到获取所有 Subversion 提交，您可能需要多次重复最后一个命令：

```
git svn fetch 
```

完成后，Git 会将 SVN 检出`trunk`到新分支中。任何其他分支都设置为远程。您可以通过以下方式查看其他 SVN 分支：

```
git branch -r 
```

如果要在存储库中保留其他远程分支，则需要手动为每个分支创建一个本地分支。（跳过trunk/master。）如果你不这样做，分支将不会在最后一步被克隆。

```
git checkout -b local_branch remote_branch
# It's OK if local_branch and remote_branch are the same names 
```

标签作为分支导入。您必须创建一个本地分支，创建一个标签并删除该分支才能将它们作为 Git 中的标签。使用标签“v1”来做到这一点：

```
git checkout -b tag_v1 remotes/tags/v1
git checkout master
git tag v1 tag_v1
git branch -D tag_v1 
```

将您的 GIT-SVN 存储库克隆到一个干净的 Git 存储库中：

```
git clone dest_dir-tmp dest_dir
rm -rf dest_dir-tmp
cd dest_dir 
```

您之前从远程分支创建的本地分支将仅作为远程分支复制到新克隆的存储库中。（跳过trunk/master。）对于您要保留的每个分支：

```
git checkout -b local_branch origin/remote_branch 
```

最后，从干净的 Git 存储库中删除指向现在已删除的临时存储库的远程：

```
git remote rm origin 
```

* * *

## 回答 #2

> 赞同：540
> 
> 时间：2008-09-17T02:08:25.197

魔法：

```
$ git svn clone http://svn/repo/here/trunk 
```

Git 和 SVN 的运作方式非常不同。你需要学习 Git，如果你想跟踪 SVN 上游的变化，你需要学习`git-svn`. `git-svn` [主页有一个很好的示例](https://git-scm.com/docs/git-svn)部分：

```
$ git svn --help 
```

* * *

## 回答 #3

> 赞同：201
> 
> 时间：2008-09-17T02:10:22.180

[干净地将您的 Subversion 存储库迁移到 Git 存储库](https://web.archive.org/web/20160314221641/https://jonmaddox.com/2008/03/05/cleanly-migrate-your-subversion-repository-to-a-git-repository/)。首先，您必须创建一个文件，将您的 Subversion 提交作者姓名映射到 Git 提交者，例如`~/authors.txt`：

```
jmaddox = Jon Maddox <jon@gmail.com>
bigpappa = Brian Biggs <bigpappa@gmail.com> 
```

然后您可以将 Subversion 数据下载到 Git 存储库中：

```
mkdir repo && cd repo
git svn init http://subversion/repo --no-metadata
git config svn.authorsfile ~/authors.txt
git svn fetch 
```

如果您使用的是 Mac，则可以`git-svn`通过安装 MacPorts来获取`git-core +svn`.

如果您的 subversion 存储库与所需的 git 存储库位于同一台机器上，那么您可以在 init 步骤中使用此语法，否则都一样：

```
git svn init file:///home/user/repoName --no-metadata 
```

* * *

## 回答 #4

> 赞同：73
> 
> 时间：2011-02-01T07:53:50.143

我使用了[svn2git 脚本](https://github.com/nirvdrum/svn2git)，效果非常好。

* * *

## 回答 #5

> 赞同：60
> 
> 时间：2008-09-17T18:20:16.700

我建议在尝试不断使用 git-svn 之前先熟悉 Git，即将 SVN 作为集中式存储库并在本地使用 Git。

但是，对于包含所有历史记录的简单迁移，以下是几个简单的步骤：

初始化本地仓库：

```
mkdir project
cd project
git svn init http://svn.url 
```

标记您想要开始导入修订的时间：

```
git svn fetch -r42 
```

（或所有转速的“git svn fetch”）

实际上，从那时起获取所有内容：

```
git svn rebase 
```

您可以使用 Gitk 检查导入的结果。我不确定这是否适用于 Windows，它适用于 OSX 和 Linux：

```
gitk 
```

当您在本地克隆了 SVN 存储库时，您可能希望将其推送到集中式 Git 存储库以便于协作。

首先创建你的空远程仓库（也许在[GitHub 上](http://github.com)？）：

```
git remote add origin git@github.com:user/project-name.git 
```

然后，可以选择同步您的主分支，以便当两者都包含新内容时，拉取操作将自动将远程 master 与本地 master 合并：

```
git config branch.master.remote origin
git config branch.master.merge refs/heads/master 
```

之后，您可能有兴趣尝试我自己的`git_remote_branch`工具，它有助于处理远程分支：

第一篇解释性帖子：“ [Git 远程分支](http://programblings.com/2008/06/23/git-remote-branches/)”

最新版本的跟进：“ [git 与 git_remote_branch 协作的时间](http://programblings.com/2008/08/06/time-to-git-collaborating-with-git_remote_branch/)”

* * *

## 回答 #6

> 赞同：33
> 
> 时间：2011-11-24T20:12:41.430

有一个新的解决方案可以从 Subversion 平滑迁移到 Git（或同时使用两者）：[SubGit](http://subgit.com/)。

我自己也在做这个项目。我们在我们的存储库中使用 SubGit——我的一些队友使用 Git 和一些 Subversion，到目前为止它运行良好。

要使用 SubGit 从 Subversion 迁移到 Git，您需要运行：

```
$ subgit install svn_repos
...
TRANSLATION SUCCESSFUL 
```

之后，您将在 svn_repos/.git 中获得 Git 存储库并可以克隆它，或者继续使用 Subversion 和这个新的 Git 存储库：SubGit 将确保两者始终保持同步。

如果您的 Subversion 存储库包含多个项目，则将在 svn_repos/git 目录中创建多个 Git 存储库。要在运行之前自定义翻译，请执行以下操作：

```
$ subgit configure svn_repos
$ edit svn_repos/conf/subgit.conf (change mapping, add authors mapping, etc)
$ subgit install svn_repos 
```

使用[SubGit](http://subgit.com/)，您可以迁移到纯 Git（不是 git-svn）并开始使用它，同时在需要时仍保留 Subversion（例如，对于您已经配置的构建工具）。

希望这可以帮助！

* * *

## 回答 #7

> 赞同：20
> 
> 时间：2008-09-17T17:09:55.480

请参阅官方[git-svn 手册页](http://git-scm.com/docs/git-svn)。特别是，在“基本示例”下查看：

> 跟踪和贡献整个 Subversion 管理的项目（包括主干、标签和分支）：

```
# Clone a repo (like git clone):
    git svn clone http://svn.foo.org/project -T trunk -b branches -t tags 
```

* * *

## 回答 #8

> 赞同：14
> 
> 时间：2011-02-11T21:17:27.193

Pro Git 8.2 解释它： http: [//git-scm.com/book/en/Git-and-Other-Systems-Migrating-to-Git](http://git-scm.com/book/en/Git-and-Other-Systems-Migrating-to-Git)

* * *

## 回答 #9

> 赞同：14
> 
> 时间：2015-02-06T11:12:04.073

# [SubGit](http://www.subgit.com/)（与蓝屏死机相比）

```
subgit import --svn-url url://svn.serv/Bla/Bla  directory/path/Local.git.Repo 
```

就是这样。

+ 要从 SVN 更新，第一个命令会创建一个 Git 存储库。

```
subgit import  directory/path/Local.git.Repo 
```

* * *

我使用了一种方法来立即迁移到 Git 以获得巨大的存储库。
当然，你需要一些准备。
但是您可能根本不会停止开发过程。

这是我的方式。

我的解决方案如下所示：

*   **将 SVN 迁移到 Git 存储库**
*   **在团队切换到**.

对于大型 SVN 存储库，迁移需要大量时间。
但是更新完成的迁移只需几秒钟。

当然，我正在使用[SubGit](http://www.subgit.com/remote-book.html#7)，妈妈。git-svn 让我[蓝屏死机](http://en.wikipedia.org/wiki/Blue_Screen_of_Death)。只是不断。git-svn 让我厌烦了 Git 的“[文件名太长](https://stackoverflow.com/questions/21123415/git-pull-aborted-with-error-filename-too-long)”致命错误。

**脚步**

**1.** [下载SubGit](http://www.subgit.com/download.html)

**2.**准备迁移和更新命令。

假设我们是为 Windows 做的（移植到 Linux 很简单）。
在 SubGit 的安装**bin**目录 (subgit-2.XX\bin) 中，创建两个 .bat 文件。

迁移的文件/命令的内容：

```
start    subgit import --svn-url url://svn.serv/Bla/Bla  directory/path/Local.git.Repo 
```

“开始”命令在这里是可选的 (Windows)。它将允许在启动时查看错误，并在 SubGit 完成后打开一个 shell。

您可以在此处[添加类似于 git-svn 的附加参数](http://www.subgit.com/remote-book.html#7)。我只使用**--default-domain myCompanyDomain.com**来修复 SVN 作者的电子邮件地址的域。
我有标准的 SVN 存储库的结构（主干/分支/标签），我们没有遇到“作者映射”的问题。所以我什么都不做了。

*（如果您想迁移分支之类的标签，或者您的 SVN 有多个分支/标签文件夹，您可以考虑使用更详细的 SubGit[方法](https://stackoverflow.com/questions/23251394/subgit-import-and-multiple-branches-directories)）*

**提示 1**：使用 --minimal-revision YourSvnRevNumber 快速查看事情的结果（某种调试）。特别有用的是查看已解析的作者姓名或电子邮件。
或者限制迁移历史深度。

**提示 2**：迁移可能会被中断 ( `Ctrl`+ `C`) 并通过运行下一个更新命令/文件来恢复。
我不建议对大型存储库这样做。我收到“内存不足 Java+Windows 异常”。

**提示 3**：最好创建结果裸存储库的副本。

用于更新的文件/命令的内容：

```
start    subgit import  directory/path/Local.git.Repo 
```

当您想要获取最后一个团队对您的 Git 存储库的提交时，您可以随时运行它。

**警告！**不要触摸您的裸存储库（例如创建分支）。
您将遇到下一个致命错误：

> 不可恢复的错误：不同步且无法同步...正在将 Subversion 修订版转换为 Git 提交...

**3.**运行第一个命令/文件。大型存储库需要很长时间。我不起眼的存储库需要 30 小时。

就是这样。
您可以通过运行第二个文件/命令随时从 SVN 更新您的 Git 存储库。在将您的开发团队切换到 Git 之前。
只需几秒钟。

* * *

* * *

还有一项更有用的任务。

**将本地 Git 存储库推送到远程 Git 存储库**

是你的情况吗？让我们继续。

1.  配置你的遥控器

跑：

```
$ git remote add origin url://your/repo.git 
```

2.  准备将巨大的本地 Git 存储库初始发送到远程存储库

默认情况下，你的 Git 不能发送大块。 [致命：远端意外挂断](https://stackoverflow.com/a/18696820/390940)

让我们为它奔跑：

```
git config --global http.postBuffer 1073741824 
```

524288000 - 500 MB 1073741824 - 1 GB 等

修复本地[证书问题](https://www.google.com/search?newwindow=1&espv=2&q=windows+git+unable+to+get+local+issuer+certificate&oq=windows+git+unable+to+get+local+issuer+certificate&gs_l=serp.3...53528.55201.0.55497.12.9.0.0.0.1.398.398.3-1.1.0.msedr...0...1c.1.61.serp..12.0.0.rqc3smB1Tyo)。如果您的 git-server 使用损坏的证书。

**我有禁用[证书](https://stackoverflow.com/a/8755199/390940)。**

此外，您的 Git 服务器可能有[需要更正的请求数量限制](https://stackoverflow.com/questions/13456025/rpc-failed-result-22-http-code-404)。

3.  [将所有迁移推](https://stackoverflow.com/questions/6865302/push-local-git-repo-to-new-remote-including-all-branches-and-tags)送到团队的远程 Git 存储库。

使用本地 Git 运行：

```
git push origin --mirror 
```

（旧 Git 版本*的 git push origin '*:*' ）*

如果您收到以下信息：**错误：无法生成 git：没有这样的文件或目录**……对我来说，完全重建我的存储库可以解决这个错误（30 小时）。您可以尝试下一个命令

```
git push origin --all
git push origin --tags 
```

或者尝试[重新安装 Git](https://groups.google.com/d/msg/msysgit/6bFAPUQDQLI/d_ko7gWViC8J)（**对我没用**）。或者您可以从所有标签创建分支并推送它们。或者，或者，或者……

* * *

## 回答 #10

> 赞同：12
> 
> 时间：2015-03-20T18:20:29.037

# [重新开始](http://www.catb.org/esr/reposurgeon/)

[对于复杂的病例， Eric S. Raymond](https://en.wikipedia.org/wiki/Eric_S._Raymond)的reposurgeon是首选工具。除了 SVN 之外，它还通过`fast-export`格式支持许多其他版本控制系统，还支持[CVS](http://en.wikipedia.org/wiki/Concurrent_Versions_System)。作者报告了[Emacs](http://en.wikipedia.org/wiki/Emacs)和[FreeBSD](https://en.wikipedia.org/wiki/FreeBSD)等古老存储库的成功转换。

该工具显然[旨在接近完美的转换](http://www.catb.org/~esr/reposurgeon/features.html)（例如将 SVN 的`svn:ignore`属性转换为`.gitignore`文件），即使对于具有悠久历史的困难存储库布局也是如此。在许多情况下，其他工具可能更易于使用。

在深入研究`reposurgeon`命令行文档之前，请务必阅读出色的[DVCS 迁移指南](http://www.catb.org/esr/dvcs-migration-guide.html)，该指南逐步介绍了转换过程。

* * *

## 回答 #11

> 赞同：8
> 
> 时间：2014-03-13T13:58:34.153

atlassian 网站上的本指南是我发现的最好的指南之一：

[https://www.atlassian.com/git/migration](https://www.atlassian.com/git/migration)

这个工具 - [https://bitbucket.org/atlassian/svn-migration-scripts](https://bitbucket.org/atlassian/svn-migration-scripts) - 对于生成您的authors.txt 也非常有用。

* * *

## 回答 #12

> 赞同：8
> 
> 时间：2014-07-22T04:36:33.677

* * *

## 回答 #13

> 赞同：7
> 
> 时间：2008-09-21T02:15:07.947

GitHub 现在具有[从 SVN 存储库导入](http://github.com/blog/156-subversion-importing)的功能。不过，我从未尝试过。

* * *

## 回答 #14

> 赞同：7
> 
> 时间：2013-09-25T09:23:33.273

仅使用 git、SVN 和 bash 的一些扩展答案。它包括不使用带有 trunk/branches/tags 目录布局的常规布局的 SVN 存储库的步骤（SVN 绝对不会强制执行这种布局）。

首先使用此 bash 脚本扫描您的 SVN 存储库以查找不同的贡献者，并为映射文件生成模板：

```
#!/usr/bin/env bash
authors=$(svn log -q | grep -e '^r' | awk 'BEGIN { FS = "|" } ; { print $2 }' | sort | uniq)
for author in ${authors}; do
  echo "${author} = NAME <USER@DOMAIN>";
done 
```

使用它来创建一个`authors`文件，在其中将 svn 用户名映射到开发人员使用[`git config`](https://www.kernel.org/pub/software/scm/git/docs/git-config.html)属性`user.name`和设置的用户名和电子邮件`user.email`（请注意，对于像 GitHub 这样的服务，只有匹配的电子邮件就足够了）。

然后[`git svn`](https://www.kernel.org/pub/software/scm/git/docs/git-svn.html)将 svn 存储库克隆到 git 存储库，告诉它映射：

`git svn clone --authors-file=authors --stdlayout svn://example.org/Folder/projectroot`

这可能需要非常长的时间，因为 git svn 将单独检查每个存在的标签或分支的每个修订。（请注意，SVN 中的标签只是真正的分支，因此它们最终在 Git 中也是如此）。您可以通过删除 SVN 中不需要的旧标签和分支来加快速度。

在同一网络中的服务器或同一服务器上运行它也可以真正加快速度。此外，如果由于某种原因此过程被中断，您*可以*使用

`git svn rebase --continue`

在很多情况下，你已经完成了。但是，如果您的 SVN 存储库有一个非常规的布局，您只需在 SVN 中有一个目录，您想放入一个 git 分支，您可以执行一些额外的步骤。

最简单的方法是在您的服务器上创建一个新的 SVN 存储库，该存储库遵循约定并用于`svn copy`将您的目录放在主干或分支中。如果您的目录一直位于存储库的根目录，这可能是唯一的方法，当我上次尝试时，这`git svn`只是拒绝进行结帐。

您也可以使用 git 执行此操作。只需使用要`git svn clone`放入 git 分支的目录即可。

运行后

```
git branch --set-upstream master git-svn
git svn rebase 
```

请注意，这需要 Git 1.7 或更高版本。

* * *

## 回答 #15

> 赞同：7
> 
> 时间：2016-02-24T14:45:17.963

我已经发布了一步一步的指南（[这里](http://blog.10pines.com/2016/02/24/svn-to-git/)）将 svn 转换为 git，包括将 svn 标签转换为 git 标签和 svn 分支转换为 git 分支。

简洁版本：

1) 从特定的修订号克隆 svn。（修订号必须是您要迁移的最早版本）

```
git svn clone --username=yourSvnUsername -T trunk_subdir -t tags_subdir -b branches_subdir -r aRevisionNumber svn_url gitreponame 
```

2）获取svn数据。这一步是最耗时的一步。

```
cd gitreponame
git svn fetch 
```

重复 git svn fetch 直到完成且没有错误

3) 更新主分支

```
git svn rebase 
```

4) 通过复制引用从 svn 分支创建本地分支

```
cp .git/refs/remotes/origin/* .git/refs/heads/ 
```

5）将svn标签转换为git标签

```
git for-each-ref refs/remotes/origin/tags | sed 's#^.*\([[:xdigit:]]\{40\}\).*refs/remotes/origin/tags/\(.*\)$#\2 \1#g' | while read p; do git tag -m "tag from svn" $p; done 
```

6) 将存储库放在更好的地方，例如 github

```
git remotes add newrepo git@github.com:aUser/aProjectName.git
git push newrepo refs/heads/*
git push --tags newrepo 
```

如果您想了解更多详细信息，请阅读我[的帖子](http://blog.10pines.com/2016/02/24/svn-to-git/)或询问我。

* * *

## 回答 #16

> 赞同：6
> 
> 时间：2016-05-02T16:13:49.740

我们可以使用`git svn clone`如下命令。

*   `svn log -q <SVN_URL> | awk -F '|' '/^r/ {sub("^ ", "", $2); sub(" $", "", $2); print $2" = "$2" <"$2">"}' | sort -u > authors.txt`

上面的命令将从 SVN 提交创建作者文件。

*   `svn log --stop-on-copy <SVN_URL>`

当你的 SVN 项目创建时，上面的命令会给你第一个修订号。

*   `git svn clone -r<SVN_REV_NO>:HEAD --no-minimize-url --stdlayout --no-metadata --authors-file authors.txt <SVN_URL>`

上面的命令将在本地创建 Git 存储库。

问题是它不会将分支和标签转换为推送。您将不得不手动执行它们。例如下面的分支：

```
$ git remote add origin https://github.com/pankaj0323/JDProjects.git
$ git branch -a
* master
  remotes/origin/MyDevBranch
  remotes/origin/tags/MyDevBranch-1.0
  remotes/origin/trunk
$$ git checkout -b MyDevBranch origin/MyDevBranch
Branch MyDevBranch set up to track remote branch MyDevBranch from origin.
Switched to a new branch 'MyDevBranch'
$ git branch -a
* MyDevBranch
  master
  remotes/origin/MyDevBranch
  remotes/origin/tags/MyDevBranch-1.0
  remotes/origin/trunk
$ 
```

对于标签：

```
$git checkout origin/tags/MyDevBranch-1.0
Note: checking out 'origin/tags/MyDevBranch-1.0'.
You are in 'detached HEAD' state. You can look around, make experimental
changes and commit them, and you can discard any commits you make in this
state without impacting any branches by performing another checkout.

If you want to create a new branch to retain commits you create, you may
do so (now or later) by using -b with the checkout command again. Example:

  git checkout -b new_branch_name

HEAD is now at 3041d81... Creating a tag
$ git branch -a
* (detached from origin/tags/MyDevBranch-1.0)
  MyDevBranch
  master
  remotes/origin/MyDevBranch
  remotes/origin/tags/MyDevBranch-1.0
  remotes/origin/trunk
$ git tag -a MyDevBranch-1.0 -m "creating tag"
$git tag
MyDevBranch-1.0
$ 
```

现在将 master、branchs 和 tags 推送到远程 git 存储库。

```
$ git push origin master MyDevBranch MyDevBranch-1.0
Counting objects: 14, done.
Delta compression using up to 8 threads.
Compressing objects: 100% (11/11), done.
Writing objects: 100% (14/14), 2.28 KiB | 0 bytes/s, done.
Total 14 (delta 3), reused 0 (delta 0)
To https://github.com/pankaj0323/JDProjects.git
 * [new branch]      master -> master
 * [new branch]      MyDevBranch -> MyDevBranch
 * [new tag]         MyDevBranch-1.0 -> MyDevBranch-1.0
$ 
```

# **svn2git 实用程序**

[svn2git](https://github.com/nirvdrum/svn2git)实用程序消除了使用分支和标签的手动工作。

使用命令安装它`sudo gem install svn2git`。之后运行以下命令。

*   `$ svn2git <SVN_URL> --authors authors.txt --revision <SVN_REV_NO>`

现在您可以列出分支、标签并轻松推送它们。

```
$ git remote add origin https://github.com/pankaj0323/JDProjects.git
$ git branch -a
  MyDevBranch
* master
  remotes/svn/MyDevBranch
  remotes/svn/trunk
$ git tag
  MyDevBranch-1.0
$ git push origin master MyDevBranch MyDevBranch-1.0 
```

想象一下，你有 20 个分支和标签，显然 svn2git 会为你节省很多时间，这就是为什么我比原生命令更喜欢它的原因。这是一个很好的原生命令包装器`git svn clone`。

有关完整示例，请参阅我的[博客条目](http://www.journaldev.com/10618/svn-to-git-migration-complete-tutorial)。

* * *

## 回答 #17

> 赞同：5
> 
> 时间：2013-04-18T03:41:17.967

TortoiseGit 就是这样做的。看到这篇博文：http: [//jimmykeen.net/articles/03-nov-2012/how-migrate-from-svn-to-git-windows-using-tortoise-clients](http://jimmykeen.net/articles/03-nov-2012/how-migrate-from-svn-to-git-windows-using-tortoise-clients)

是的，我知道用链接回答不是很好，但它是一个解决方案，嗯？

* * *

## 回答 #18

> 赞同：4
> 
> 时间：2014-09-13T13:04:29.957

对于**GitLab**用户，我在这里提出了我如何从 SVN 迁移的要点：

[https://gist.github.com/leftclickben/322b7a3042cbe97ed2af](https://gist.github.com/leftclickben/322b7a3042cbe97ed2af)

# 从 SVN 迁移到 GitLab 的步骤

## 设置

*   SVN 托管在`svn.domain.com.au`.
*   SVN 可以通过`http`（其他协议应该可以）访问。
*   GitLab 托管于`git.domain.com.au`：
    *   使用命名空间创建一个组`dev-team`。
    *   至少创建一个用户帐户，将其添加到组中，并具有用于迁移的帐户的 SSH 密钥（使用 测试`ssh git@git.domain.com.au`）。
    *   该项目`favourite-project`是在`dev-team`命名空间中创建的。
*   该文件`users.txt`包含相关的用户详细信息，每行一个用户，格式为`username = First Last <address@domain.com.au>`，其中`username`是 SVN 日志中给出的用户名。（有关详细信息，请参阅参考部分中的第一个链接，特别是用户 Casey 的回答）。

## 版本

*   颠覆版本 1.6.17 (r1128011)
*   混帐版本 1.9.1
*   GitLab 版本 7.2.1 ff1633f
*   Ubuntu 服务器 14.04

## 命令

```
bash
git svn clone --stdlayout --no-metadata -A users.txt 
http://svn.domain.com.au/svn/repository/favourite-project
cd favourite-project
git remote add gitlab git@git.domain.com.au:dev-team/favourite-project.git
git push --set-upstream gitlab master 
```

就是这样！在 GitLab Web UI 中重新加载项目页面，您将看到现在列出的所有提交和文件。

## 笔记

*   如果有未知用户，该`git svn clone`命令将停止，在这种情况下，更新`users.txt`，`cd favourite-project`并将`git svn fetch`从它停止的地方继续。
*   `trunk`SVN 存储库的标准布局是必需的`tags`。`branches`
*   提供给`git svn clone`命令的 SVN URL 停止在紧接在上面的级别`trunk/`，`tags/`并且`branches/`。
*   该`git svn clone`命令产生大量输出，包括顶部的一些警告；我忽略了警告。

* * *

## 回答 #19

> 赞同：3
> 
> 时间：2011-03-22T00:34:48.103

我强烈推荐我刚刚发现的这个[简短的截屏视频系列。](http://www.tfnico.com/presentations/git-and-subversion)作者带您了解基本操作，并展示一些更高级的用法。

* * *

## 回答 #20

> 赞同：3
> 
> 时间：2014-06-17T04:43:33.357

如果您使用 SourceTree，您可以直接从应用程序执行此操作。转到文件-> 新建/克隆，然后执行以下操作：

1.  输入远程 SVN URL 作为“源路径/URL”。
2.  出现提示时输入您的凭据。
3.  输入本地文件夹位置作为“目标路径”。
4.  给它一个名字。
5.  在高级选项中，从“创建类型的本地存储库”的下拉列表中选择“Git”。
6.  您可以选择指定要从中克隆的修订。
7.  点击克隆。

在 SourceTree 中打开 repo，您​​将看到您的提交消息也已迁移。

现在转到存储库 -> 存储库设置并添加新的远程存储库详细信息。如果您愿意，请删除 SVN 远程（我通过“编辑配置文件”选项执行此操作。

当您准备好并自由编码时，将代码推送到新的远程仓库。

* * *

## 回答 #21

> 赞同：2
> 
> 时间：2008-09-26T13:13:26.187

另外，当尝试使用 git-svn dcommits 进行 git 操作时，git-stash 命令是天赐之物。

一个典型的过程：

1.  设置 git 仓库
2.  对不同的文件做一些工作
3.  决定检查一些工作，使用 git
4.  决定要`svn-dcommit`
5.  得到可怕的“不能用脏索引提交”错误。

解决方案（需要 git 1.5.3+）：

```
git stash; git svn dcommit ; git stash apply 
```

* * *

## 回答 #22

> 赞同：2
> 
> 时间：2012-02-16T18:28:52.833

我只是想将我的贡献添加到 Git 社区。我编写了一个简单的 bash 脚本，它可以自动执行完整的导入。与其他迁移工具不同，该工具依赖于原生 git 而不是 jGit。此工具还支持具有大量修订历史和/或大型 blob 的存储库。它可以通过 github 获得：

[https://github.com/onepremise/SGMS](https://github.com/onepremise/SGMS)

此脚本将使用以下格式转换存储在 SVN 中的项目：

```
/trunk
  /Project1
  /Project2
/branches
     /Project1
     /Project2
/tags
 /Project1
 /Project2 
```

该方案也很受欢迎并受到支持：

```
/Project1
     /trunk
     /branches
     /tags
/Project2
     /trunk
     /branches
     /tags 
```

每个项目将按项目名称同步：

```
Ex: ./migration https://svnurl.com/basepath project1 
```

如果您希望转换完整的 repo，请使用以下语法：

```
Ex: ./migration https://svnurl.com/basepath . 
```

* * *

## 回答 #23

> 赞同：2
> 
> 时间：2013-11-06T14:06:24.420

这是一个没有依赖关系的简单 shell 脚本，它将一个或多个 SVN 存储库转换为 git 并将它们推送到 GitHub。

[https://gist.github.com/NathanSweet/7327535](https://gist.github.com/NathanSweet/7327535)

在大约 30 行脚本中：使用 git SVN 克隆，从 SVN::ignore 属性创建 .gitignore 文件，推送到裸 git 存储库，将 SVN 主干重命名为 master，将 SVN 标签转换为 git 标签，并将其推送到 GitHub同时保留标签。

为了将十几个 SVN 存储库从 Google Code 迁移到 GitHub，我经历了很多痛苦。我使用 Windows 并没有帮助。Ruby 在我的旧 Debian 机器上被各种损坏了，让它在 Windows 上运行是个笑话。其他解决方案无法使用 Cygwin 路径。即使我得到了一些工作，我也无法弄清楚如何让标签显示在 GitHub 上（秘密是 --follow-tags）。

最后，我拼凑了两个简短的脚本，链接在上面，效果很好。解决方案不需要比这更复杂！

* * *

## 回答 #24

> 赞同：2
> 
> 时间：2018-02-06T06:37:45.860

我在一台 Windows 机器上，并制作了一个小批量，只需调用即可将具有历史记录（但没有分支）的 SVN 存储库转移到 GIT 存储库

`transfer.bat http://svn.my.address/svn/myrepo/trunk https://git.my.address/orga/myrepo`

也许任何人都可以使用它。它创建一个 TMP 文件夹，用 git 签出那里的 SVN 存储库，并添加新的来源并推送它......并再次删除该文件夹。

```
@echo off 
SET FROM=%1 
SET TO=%2 
SET TMP=tmp_%random%

echo from:  %FROM% 
echo to:    %TO% 
echo tmp:   %TMP%

pause

git svn clone  --no-metadata --authors-file=users.txt %FROM% %TMP%  
cd %TMP% 
git remote add origin %TO% 
git push --set-upstream origin master

cd .. 
echo delete %TMP% ... 
pause

rmdir /s /q %TMP% 
```

您仍然需要 users.txt 和您的用户映射，例如

```
User1 = User One <u.1@xxx.com> 
```

* * *

## 回答 #25

> 赞同：1
> 
> 时间：2020-08-24T23:45:48.443

首先，归功于@cmcginty 的回答。这对我来说是一个很好的起点，我将在这里发布的大部分内容都大量借鉴了它。然而，我正在移动的存储库有多年的历史，这导致了在对这封信的答复之后出现了一些问题（数百个分支和标签需要手动移动；稍后阅读更多内容）。

因此，经过数小时的搜索和反复试验，我能够编写一个脚本，使我可以轻松地将多个项目从 SVN 迁移到 GIT，并且我决定在这里分享我的发现，以防其他人站在我的立场上。

<tl;dr> 让我们开始吧

* * *

首先，创建一个“作者”文件，它将基本的 svn 用户转换为更复杂的 git 用户。最简单的方法是使用命令从您要移动的 svn 存储库中提取所有用户。

```
svn log -q | awk -F '|' '/^r/ {sub("^ ", "", $2); sub(" $", "", $2); print $2" = "$2" <"$2">"}' | sort -u > authors-transform.txt 
```

这将生成一个名为 authors-transform.txt 的文件，其中每个用户在运行它的 svn 存储库中进行了更改。

```
someuser = someuser <someuser> 
```

更新以包含 git 的全名和电子邮件

```
someuser = Some User <someuser@somewhere.com> 
```

现在使用您的作者文件开始克隆

```
git svn clone --stdlayout --no-metadata -r854:HEAD --authors-file=authors-transform.txt https://somesvnserver/somerepo/ temp 
```

*   --stdlayout 表示 svn repo 遵循标准 /trunk /branches /tags 布局
*   --no-metadata 告诉 git 不要在每个 git 提交上标记与 svn 提交相关的元数据。如果这不是单向转换，请删除此标签
*   -r854:HEAD 仅获取修订版 854 以上的历史记录。这是我遇到的第一个障碍；我正在转换的 repo 在修订版 853 中有一个“损坏的”提交，因此它不会克隆。使用此参数允许您仅克隆部分历史记录。
*   temp 是为初始化新的 git 存储库而创建的目录的名称

此步骤可能需要一段时间，尤其是在大型或旧的 repo 上（我们的一个大约需要 18 小时）。您还可以使用该 -r 开关仅获取一小段历史记录来查看克隆，然后再获取其余部分。

移动到新目录

```
cd temp 
```

如果您仅在克隆中提取部分内容，则获取任何丢失的历史记录

```
git svn fetch 
```

标签在克隆期间创建为分支。如果您只有几个，则可以一次转换一个。

```
git 1.0.0 origin/tags/1.0.0 
```

但是，如果您有数百个标签，这会很乏味，因此以下脚本对我有用。

```
for brname in `git branch -r | grep tags | awk '{gsub(/^[^\/]+\//,"",$1); print $1}'`; do echo $brname; tname=${brname:5}; echo $tname; git tag $tname origin/tags/$tname; done 
```

您还需要检查您想要保留的所有分支

```
git checkout -b branchname origin/branches/branchname 
```

如果你也有很多分支，这个脚本可能会有所帮助

```
for brname in `git branch -r | grep -v master | grep -v HEAD | grep -v trunk | grep -v tags | awk '{gsub(/^[^\/]+\//,"",$1); print $1}'`; do echo $brname; git checkout -b $brname origin/$brname; done 
```

这将忽略主干分支，因为它已经作为主分支检出，并在稍后删除重复分支保存步骤，并忽略我们已经转换的 /tags。

现在是查看新存储库的好时机，并确保您有一个**本地**分支或标签来存放您想要保留的任何内容，因为稍后将删除远程分支。

好的，现在让我们将我们签出的所有内容克隆到一个干净的 repo（这里命名为 temp2）

```
cd ..
git clone temp temp2
cd temp2 
```

现在我们需要再次检查所有分支，然后再将它们推送到它们的最终远程，因此请从上面按照您最喜欢的方法进行操作。

如果您正在关注 gitflow，您可以将您的工作分支重命名为开发。

```
git checkout -b WORKING
git branch -m develop
git push origin --delete WORKING
git push origin -u develop 
```

现在，如果一切看起来都不错，您就可以推送到您的 git 存储库了

```
git remote set-url origin https://somebitbucketserver/somerepo.git
git push -u origin --all
git push origin --tags 
```

我确实遇到了最后一个问题，即 Control Freak 最初阻止我推送不是我创建的标签，因此如果您的团队使用 Control Freak，您可能需要禁用或调整该设置以进行初始推送。

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2010-09-24T14:13:01.617

*[通过 Subversion 有效地使用 Git](http://www.viget.com/extend/effectively-using-git-with-subversion/)*是对 git-svn 的温和介绍。对于现有的 SVN 存储库，git-svn 使这变得超级简单。如果您正在启动一个新的存储库，那么首先创建一个空的 SVN 存储库然后使用 git-svn 导入比相反的方向要容易得多。可以创建一个新的 Git 存储库然后导入 SVN，但这有点痛苦，特别是如果您是 Git 新手并希望保留提交历史。

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2015-07-09T13:19:08.817

下载适用于 Windows 的 Ruby 安装程序并使用它安装最新版本。将 Ruby 可执行文件添加到您的路径。

*   安装 svn2git
*   开始菜单 -> 所有程序 -> Ruby -> 使用 Ruby 启动命令提示符
*   然后输入“gem install svn2git”并输入

    **迁移 Subversion 存储库**

*   打开 Ruby 命令提示符并转到要迁移文件的目录

    然后 svn2git [http://[域名](http://[domain)]/svn/ [repository root]

*   将项目迁移到 Git 可能需要几个小时，具体取决于项目代码大小。

*   这个主要步骤有助于创建如下所述的 Git 存储库结构。

    SVN (/Project_components) 主干 --> Git master SVN (/Project_components) 分支 --> Git 分支 SVN (/Project_components) 标签 --> Git 标签

创建远程存储库并推送更改。

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2015-07-30T14:56:26.747

GitHub 有一个导入器。创建存储库后，您可以通过其 URL 从现有存储库导入。如果适用，它将询问您的凭据并从那里开始。

当它运行时，它会找到作者，你可以简单地将他们映射到 GitHub 上的用户。

我现在已经将它用于几个存储库，而且它非常准确且速度也快得多！大约 4000 次提交的存储库花了 10 分钟，而我的朋友花了四天时间！

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2016-01-19T14:17:52.183

这里的几个答案是指[https://github.com/nirvdrum/svn2git](https://github.com/nirvdrum/svn2git)，但对于大型存储库，这可能会很慢。我尝试使用[https://github.com/svn-all-fast-export/svn2git](https://github.com/svn-all-fast-export/svn2git)代替它，它是一个名称完全相同但用于将 KDE 从 SVN 迁移到 Git 的工具。

设置它需要做更多的工作，但是当我完成转换后，我需要花费几分钟，而其他脚本则需要花费数小时。

* * *

## 回答 #30

> 赞同：0
> 
> 时间：2016-02-15T13:00:40.403

有不同的方法可以实现这一目标。我已经尝试了其中的一些，发现在 Windows 操作系统上只安装了 git 和 svn 确实可以工作。

先决条件：

1.  Windows 上的 git（我用过这个）[https://git-scm.com/](https://git-scm.com/)
2.  安装了控制台工具的 svn（我用过 tortoise svn）
3.  转储您的 SVN 存储库的文件。 `svnadmin dump /path/to/repository > repo_name.svn_dump`

实现最终目标的步骤（将所有具有历史记录的存储库移动到 git，首先是本地 git，然后是远程）

1.  在目录 REPO_NAME_FOLDER 中创建空存储库（使用控制台工具或 tortoiseSVN） `cd REPO_NAME_PARENT_FOLDER`，将 dumpfile.dump 放入 REPO_NAME_PARENT_FOLDER

2.  `svnadmin load REPO_NAME_FOLDER < dumpfile.dump`等待这个操作，可能会很长

3.  这个命令是无声的，所以打开第二个 cmd 窗口：`svnserve -d -R --root REPO_NAME_FOLDER` 为什么不直接使用 file:///......？`Unable to open ... to URL:`由于答案[https://stackoverflow.com/a/6300968/4953065](https://stackoverflow.com/a/6300968/4953065) ，导致下一个命令将失败

4.  创建新文件夹 SOURCE_GIT_FOLDER

5.  `cd SOURCE_GIT_FOLDER`
6.  git svn clone svn://localhost/ 等待这个操作。

最后，我们得到了什么？

让我们检查一下我们的本地存储库：

```
git log 
```

看到你之前的提交了吗？如果是 - 好的

因此，现在您拥有功能齐全的本地 git 存储库，其中包含您的源代码和旧的 svn 历史记录。现在，如果要将其移动到某个服务器，请使用以下命令：

```
git remote add origin https://fullurlpathtoyourrepo/reponame.git
git push -u origin --all # pushes up the repo and its refs for the first time
git push -u origin --tags # pushes up any tags 
```

就我而言，我不需要标签命令，因为我的仓库没有标签。

祝你好运！

* * *

## 回答 #31

> 赞同：0
> 
> 时间：2016-06-07T16:02:29.763

将 svn 子模块/文件夹 'MyModule' 转换为具有历史记录的 git，没有标签或分支。

*   git svn clone --no-metadata --trunk=SomeFolder1/SomeFolder2/SomeFolder3/MyModule [http://svnhost:port/repo_root_folder/MyModule_temp](http://svnhost:port/repo_root_folder/MyModule_temp) -A C:\cheetah\svn\authors-transform.txt
*   git clone MyModule_temp 我的模块
*   cd MyModule
*   git流初始化
*   git 远程 set-url 来源 [https://userid@stashhost/stash/scm/xyzxyz/MyModule.git](https://userid@stashhost/stash/scm/xyzxyz/MyModule.git)
*   git push -u 起源大师
*   git push -u 起源开发

要保留 svn 忽略列表，请在步骤 1 之后使用上述注释

* * *

## 回答 #32

> 赞同：0
> 
> 时间：2017-01-03T17:33:27.843

我使用以下脚本读取包含我所有 SVN 存储库列表的文本文件并将它们转换为 Git，然后`git clone --bare`用于转换为裸 Git 存储库：

```
#!/bin/bash
file="list.txt"
while IFS= read -r repo_name
do
 printf '%s\n' "$repo_name"
 sudo git svn clone --shared --preserve-empty-dirs --authors-file=users.txt file:///programs/svn/$repo_name
 sudo git clone --bare /programs/git/$repo_name $repo_name.git
 sudo chown -R www-data:www-data $repo_name.git
 sudo rm -rf $repo_name
done <"$file" 
```

list.txt 的格式为：

```
repo1_name
repo2_name 
```

users.txt 格式如下：

> `(no author) = Prince Rogers <prince.rogers.nelson@payesley.park.org>`

www-data 是 Apache Web 服务器用户，需要通过 HTTP 推送更改的权限。

* * *

## 回答 #33

> 赞同：0
> 
> 时间：2021-07-04T06:31:08.573

`SVN`多合一 -用于`GIT`迁移的 shell 脚本。用占位符提及`GIT`和`SVN`细节`<>`

```
#!/bin/bash

######## Project name 
PROJECT_NAME="Helloworld"
EMAIL="example mail"

#Credientials Repo
GIT_USER='<git username>'
GIT_PWD='<git password>'
SVN_USER='<svn username>'
SVN_PWD='<svn password>'

######## SVN repository to be migrated # Dont use https - error will be thrown
BASE_SVN="<SVN URL>/Helloworld"

#Organization inside BASE_SVN
BRANCHES="branches"
TAGS="tags"
TRUNK="trunk"

#Credientials
git config --global user.name '<git username>'
git config --global user.password '<git password>'
git config --global credential.helper 'cache --timeout=3600'

######## GIT repository to migrate - Ensure already project created in Git
GIT_URL=https://$GIT_USER:$GIT_PWD@<GIT URL>/Helloworld.git

###########################
#### Don't need to change from here
###########################

#Geral Configuration
ABSOLUTE_PATH=$(pwd)
TMP=$ABSOLUTE_PATH/$PROJECT_NAME

#Branchs Configuration
SVN_BRANCHES=$BASE_SVN/$BRANCHES
SVN_TAGS=$BASE_SVN/$TAGS
SVN_TRUNK=$BASE_SVN/$TRUNK

AUTHORS=$PROJECT_NAME"-authors.txt"

echo '[LOG] Starting migration of '$SVN_TRUNK
echo '[LOG] Using: '$(git --version)
echo '[LOG] Using: '$(svn --version | grep svn,)

mkdir $TMP
echo
echo '[DIR] cd' $TMP
cd $TMP

echo
echo '[LOG] Getting authors'
svn --username $SVN_USER --password $SVN_PWD log -q $BASE_SVN | awk -F '|' '/^r/ {sub("^ ", "", $2); sub(" $", "", $2); print $2" = "$2" <"$2"@"$EMAIL">"}' | sort -u >> $AUTHORS

echo
echo '[RUN] git svn clone --authors-file='$AUTHORS' --trunk='$TRUNK' --branches='$BRANCHES' --tags='$TAGS $BASE_SVN $TMP
git svn clone --authors-file=$AUTHORS --trunk=$TRUNK --branches=$BRANCHES --tags=$TAGS $BASE_SVN $TMP

#Not working so no need to mention it
#--stdlayout $PROJECT_NAME
echo
echo '[RUN] svn ls '$SVN_BRANCHES
svn ls $SVN_BRANCHES

echo 
echo 'git branch -a'
git branch -a

echo
echo '[LOG] Getting first revision'
FIRST_REVISION=$( svn log -r 1:HEAD --limit 1 $BASE_SVN | awk -F '|' '/^r/ {sub("^ ", "", $1); sub(" $", "", $1); print $1}' )

echo
echo '[RUN] git svn fetch -'$FIRST_REVISION':HEAD'
git svn fetch -$FIRST_REVISION:HEAD

#Branches and Tags  
echo
echo '[RUN] svn ls '$SVN_BRANCHES
for BRANCH in $(svn ls $SVN_BRANCHES); do
    echo git branch ${BRANCH%/} remotes/svn/${BRANCH%/}
    git branch ${BRANCH%/} remotes/svn/${BRANCH%/}
done

git for-each-ref --format="%(refname:short) %(objectname)" refs/remotes/origin/tags | grep -v "@" | cut -d / -f 3- |
while read ref
do
  echo git tag -a $ref -m 'import tag from svn'
  git tag -a $ref -m 'import tag from svn'
done

git for-each-ref --format="%(refname:short)" refs/remotes/origin/tags | cut -d / -f 1- |
while read ref
do
  git branch -rd $ref
done

echo
echo 'git tag'
git tag

echo
echo 'git show-ref --tags'
git show-ref --tags

echo
echo '[RUN] git remote add origin '$GIT_URL
git remote add origin $GIT_URL

echo
echo '[RUN] git push'
git push origin --all --force
git push origin --tags

#echo git branch -d -r trunk
#git branch -d -r trunk

git config --global credential.helper cache
echo 'Successful.' 
```

*   当您运行上述脚本时，它将从 SVN 获取分支和标签详细信息并将其放在`.git`文件夹下。
*   交叉检查是否所有分支都存在于`SVN`该文件夹下应该可用的`.git/refs/heads`目录中。
*   如果缺少某些分支，`SVN`那么请手动将分支文件从复制`.git/refs/remotes/origin/<branches>`到`.git/refs/heads`
*   仅复制分支（包括`master`）并忽略（如果有）`tags`或`trunk`.
*   现在再次运行脚本。您可以在 git 存储库中`branches`查看所有内容。`tags`

* * *

## 回答 #34

> 赞同：-1
> 
> 时间：2018-02-11T13:45:29.980

# 为此，我使用**了 svn2git**库，过程如下：

> sudo apt-get install git-core git-svn ruby
> ​​ sudo gem install svn2git
> svn log --quiet | grep -E "r[0-9]+ \| .+ \|" | 剪切-d'|' -f2 | sed 's/ //g' | 排序 | uniq > authors.txt（此命令用于映射作者）

上述步骤应在您要从 svn 转换为 git 的文件夹中执行。

> 像这样在 authors.txt 中每行添加一个映射

```
anand = Anand Tripathi <email_id>
trip = Tripathi Anand <email_id> 
```

为新的 git 存储库创建一个文件夹并执行以下命令，路径为 authors.txt

```
svn2git <svn_repo_path> --nobranches --notags --notrunk --no-minimize-url --username <user_name> --verbose  --authors <author.txt_path>

If no trunk and no tag and branch is present then have to execute the above command else if root is trunk then mention rootistrunk or trunk is present then --trunk <trunk_name> 
```

> git remote add origin
> git push --all origin
> git push --tags origin

# c# - 结合两个 SyndicationFeed

> ID：79197
> 
> 赞同：10
> 
> 时间：2008-09-17T02:13:22.127
> 
> 标签：c#, linq, .net-3.5

什么是结合**feed**和**feed2**的简单方法？我希望将**feed2**中的项目添加到**feed**。我还想避免重复，因为当问题同时使用 WPF 和 Silverlight 标记时，**提要**可能已经有项目。

```
Uri feedUri = new Uri("http://stackoverflow.com/feeds/tag/silverlight");
XmlReader reader = XmlReader.Create(feedUri.AbsoluteUri);
SyndicationFeed feed = SyndicationFeed.Load(reader);    

Uri feed2Uri = new Uri("http://stackoverflow.com/feeds/tag/wpf");
XmlReader reader2 = XmlReader.Create(feed2Uri.AbsoluteUri);
SyndicationFeed feed2 = SyndicationFeed.Load(reader2); 
```

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-09-17T18:49:42.810

您可以使用 LINQ 简化代码以加入两个列表（不要忘记将 System.Linq 放入您的 usings 中，如果需要，请在项目中参考 System.Core）这是一个 Main 执行联合并将它们打印到控制台（使用正确清理阅读器）。

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Xml;
using System.ServiceModel.Syndication;

namespace FeedUnion
{
    class Program
    {
        static void Main(string[] args)
        {
            Uri feedUri = new Uri("http://stackoverflow.com/feeds/tag/silverlight"); 
            SyndicationFeed feed;
            SyndicationFeed feed2;
            using(XmlReader reader = XmlReader.Create(feedUri.AbsoluteUri))
            {
                feed= SyndicationFeed.Load(reader); 
            }
            Uri feed2Uri = new Uri("http://stackoverflow.com/feeds/tag/wpf"); 
            using (XmlReader reader2 = XmlReader.Create(feed2Uri.AbsoluteUri))
            {
            feed2 = SyndicationFeed.Load(reader2);
            }
            SyndicationFeed feed3 = new SyndicationFeed(feed.Items.Union(feed2.Items));
            StringBuilder builder = new StringBuilder();
            using (XmlWriter writer = XmlWriter.Create(builder))
            {
                feed3.SaveAsRss20(writer);
                System.Console.Write(builder.ToString());
                System.Console.Read();
            }
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-17T02:41:20.873

好吧，一种可能性是创建一个新的联合提要，它是第一个提要的克隆，然后简单地遍历第二个提要上的每个帖子，检查第一个是否存在，如果不存在则添加它。

类似于以下内容：

```
SyndicationFeed newFeed = feed.clone;
foreach(SyndicationItem item in feed2.items)
{
  if (!newFeed.contains(item))
    newFeed.items.Add(item);
} 
```

也许能够做到。看起来“项目”是一个简单的可编号的联合项目列表，所以没有理由不能简单地添加它们。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-17T02:40:43.387

如果它仅用于 stackoverflow，您可以使用：
[https](https://stackoverflow.com/feeds/tag/silverlight%20wpf)
://stackoverflow.com/feeds/tag/silverlight%20wpf 这**将**合并两个标签。

对于更通用的解决方案，我不知道。您可能必须手动迭代两个提要的元素并将它们连接在一起。您可以比较 <entry> 的 <id> 元素以查看它们是否重复。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-01-18T19:38:59.933

我已经将今天接受的答案变成了一个单元测试，只是为了稍微探索一下：

```
 [TestMethod]
    public void ShouldCombineRssFeeds()
    {
        //reference: http://stackoverflow.com/questions/79197/combining-two-syndicationfeeds

        SyndicationFeed feed;
        SyndicationFeed feed2;

        var feedUri = new Uri("http://stackoverflow.com/feeds/tag/silverlight");
        using(var reader = XmlReader.Create(feedUri.AbsoluteUri))
        {
            feed = SyndicationFeed.Load(reader);
        }

        Assert.IsTrue(feed.Items.Count() > 0, "The expected feed items are not here.");

        var feed2Uri = new Uri("http://stackoverflow.com/feeds/tag/wpf");
        using(var reader2 = XmlReader.Create(feed2Uri.AbsoluteUri))
        {
            feed2 = SyndicationFeed.Load(reader2);
        }

        Assert.IsTrue(feed2.Items.Count() > 0, "The expected feed items are not here.");

        var feedsCombined = new SyndicationFeed(feed.Items.Union(feed2.Items));

        Assert.IsTrue(
            feedsCombined.Items.Count() == feed.Items.Count() + feed2.Items.Count(),
            "The expected number of combined feed items are not here.");

        var builder = new StringBuilder();
        using(var writer = XmlWriter.Create(builder))
        {
            feedsCombined.SaveAsRss20(writer);
            writer.Flush();
            writer.Close();
        }

        var xmlString = builder.ToString();

        Assert.IsTrue(new Func<bool>(
            () =>
            {
                var test = false;

                var xDoc = XDocument.Parse(xmlString);
                var count = xDoc.Root.Element("channel").Elements("item").Count();
                test = (count == feedsCombined.Items.Count());

                return test;
            }
        ).Invoke(), "The expected number of RSS items are not here.");
    } 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-07-29T06:39:09.323

```
 //Executed and Tested :)            
        using (XmlReader reader = XmlReader.Create(strFeed))
        {
            rssData = SyndicationFeed.Load(reader);
            model.BlogFeed = rssData; ;
        }
        using (XmlReader reader = XmlReader.Create(strFeed1))
        {
            rssData1 = SyndicationFeed.Load(reader);
            model.BlogFeed = rssData1;
        }

        SyndicationFeed feed3 = new SyndicationFeed(rssData.Items.Union(rssData1.Items));
        model.BlogFeed = feed3;           
        return View(model); 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2016-02-06T09:55:27.660

这对我来说很好：

```
// create temporary List of SyndicationItem's
List<SyndicationItem> tempItems = new List<SyndicationItem>();

// add all feed items to the list
tempItems.AddRange(feed.Items);
tempItems.AddRange(feed2.Items);

// remove duplicates with Linq 'Distinct()'-method depending on yourattributes

// add list without duplicates to 'feed2'
feed2.Items = tempItems 
```

# c++ - *nix 的最佳 C++ IDE

> ID：79210
> 
> 赞同：31
> 
> 时间：2008-09-17T02:17:08.390
> 
> 标签：c++, ide

*nix 环境中最好的 C++ IDE 是什么？我听说 Eclipse 的 C/C++ 模块和 Notepad++ 一样不错，但除了这两个之外我没有真正的想法。有什么想法或意见吗？

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2008-09-17T02:38:36.183

在 Ubuntu 上，存储库中可用的一些 IDE 是：

*   [开发者](http://www.kdevelop.org/)
*   [吉尼](http://geany.uvena.de/)
*   [安茹塔](http://anjuta.sf.net/)

还有：

*   [Eclipse](http://eclipse.org)（由于文件/文件夹权限问题，建议您不要从存储库安装）
*   [代码::块](http://www.codeblocks.org/)

当然，每个人都喜欢的基于文本的编辑器：

*   vi/vim
*   emacs

vim 和 emacs 确实是非常强大的工具，但是学习曲线非常陡峭。

我真的不太喜欢**Eclipse**，我觉得它有问题而且有点太笨重。
我已经开始使用**Geany**作为一个简单但功能强大且*可用*的IDE。它具有基本的代码完成功能，并且是一个漂亮、干净的 [Gnome] 界面。
**Anjuta**我试了一天，一点也不喜欢。我发现它不如 Geany 有用。

**Kdevelop**和**code::blocks**得到了很多好评，但我还没有尝试过。我使用 gnome，但我还没有看到在 gnome 中看起来不错的 KDE 应用程序（抱歉，我确信它是一个很棒的程序）。

如果在 linux 下只发布 Bloodshed dev-c++ 就好了。这是一个很棒的（但仅限 Windows）程序。你总是可以在 Wine 下运行它；）

在某种程度上，它归结为个人喜好。我的建议是研究 Kdevelop、Geany 和 code::blocks 作为起点。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2008-09-17T02:21:48.720

作为一名在 linux 下编写代码多年的程序员，我似乎无法摆脱使用 Vim 编写代码。

一旦你学会了它，并学习了它的一些更高级的特性（代码折叠、如何使用 ctags、如何有效地使用多个缓冲区等），移动到另一个编辑器是非常困难的——因为其他所有东西似乎都缺少你的特性'习惯了。

唯一具有 vim 功能超集的编辑器是 emacs。我强烈建议学习其中的一个 - 如果您有任何问题，请不要犹豫，在这里或在 irc.freenode.net 上的 #emacs 或 #vim 中提问 - 有一个非常大且有用的社区可以帮助您了解哪些扩展或命令最适合您面临的软件编辑问题。

[编辑：评论指出“vim 不是 IDE”，我同意。我不喜欢 IDE 名称，因为它意味着一个带有项目经理和一堆下拉框的 gui。我喜欢使用术语“**好工具**”。请参阅[Ted Leung](http://www.sauria.com/blog/2008/07/20/ides-and-dynamic-languages/)关于此事的著作]

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-09-17T02:30:18.390

我会推荐[CodeBlocks](http://www.codeblocks.org/)。

强调：

*   开源！GPLv3，无隐藏费用。
*   跨平台。在 Linux、Mac、Windows 上运行（使用 wxWidgets）。
*   用 C++ 编写。不需要解释语言或专有库。
*   可通过插件扩展

编译器：

*   多编译器支持：
    *   GCC (MingW / GNU GCC)
    *   MSVC++
    *   数字火星
    *   Borland C++ 5.5
    *   打开沃通
    *   ...和更多

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2010-08-22T08:42:09.093

我很惊讶没有人提到[Qt Creator](http://qt.nokia.com/products/developer-tools)，因为它在大多数存储库中都可用，体积非常小，但可以很好地完成我需要的大多数事情。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2008-09-17T02:20:02.750

我只使用 Emacs。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-09-17T02:27:19.830

Emacs 是一款出色的、不受我限制但可以做任何事情的 IDE。请参阅其他相关问题：[Using Emacs as an IDE](https://stackoverflow.com/questions/63421/using-emacs-as-an-ide)

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2008-09-17T03:49:22.380

我的投票是KDevelop（我希望我有更多的分数，所以我可以“投票”，所以我可以间接地同意其他人而不是评论）。

我已经将 Eclipse 用于个人用途大约几年了，我说服自己“自从 IBM 捐赠了它，它一定很好”，但后来我发现了 KDevelop 并且从未回头。因为我很喜欢 Microsoft Visual Studio 的专业用途，所以 KDevelop 对我来说是最舒服的。

我想将编程作为一种爱好来享受，而不是花时间查找`ctrl`- `k`-`k`和`ctrl`- `k`-做了什么`b`。就像其他人提到的那样，任何对他们“感觉正确”的东西都是最好的 IDE。对我来说，KDevelop 感觉最舒服，因为我可以专注于编码（我可能会将键重新映射到其他 IDE 以使其感觉像 VS，但如前所述，我宁愿花时间编码，这更有趣）。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2008-09-17T02:18:06.047

[KDevelop](http://www.kdevelop.org)很好，尤其是在您运行 KDE 时。作为额外的奖励，它支持多种语言。我发现它的嵌入式终端非常有用。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2008-09-17T04:06:26.380

如果您来自 Windows 和 Visual Studio，您可能会发现 Code::Blocks 符合您的期望。

那是我的经验；我先尝试了其他几个，但他们似乎都希望我在开始做任何有趣的事情之前先做一个冗长的教程——而且要尝试十几个 IDE，这可能需要几天时间。

有了 Code::Blocks，我就没有什么难关了，而且在我提高工作效率之前，我几乎不需要学习什么*强制性的东西。*我还是更喜欢 Visual Studio，但是 Code::Blocks 可以打开我的 Visual Studio 项目，而且它似乎不想让我浪费任何时间，所以它对我来说是最成功的 *nix IDE。

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2008-09-17T06:26:56.713

我使用 NetBeans C++ 插件，它非常棒。我来自 Visual Studio 背景和 Netbeans 项目管理非常相似。我尝试了 KDevelop，但发现它有点不稳定（这是 12 个月前的事，所以现在可能更好了）。

我还为使用 KDevelop 的依赖关系而苦苦挣扎——即，一个程序需要首先构建大量的库——但 Netbeans 使这变得简单。

唯一的抱怨是，作为一个 Java 应用程序，它并不是特别快——在 VMWare 下运行时非常明显。

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2008-09-17T07:43:51.380

简单地说，Netbeans。你必须尝试一下。它是那么好。它比带有 CDT 插件的 Eclipse 好得多。

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2008-09-17T02:21:49.407

Netbeans 的 C++ 支持获得了一些不错的评价：http: [//www.netbeans.org/features/cpp/](http://www.netbeans.org/features/cpp/)

我从未使用 Netbeans 或 Eclipse 进行 C++ 开发，但值得一看。

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2008-09-17T06:40:23.997

在切换到 ubuntu 之前，我是 VisualStudio + VA-X 用户，并且需要在任何 IDE 中具有良好的自动完成和功能导航功能。

我尝试过 Netbeans、Eclipse CDT、CodeBlocks、Geany、Anjuta、KDevelop 并最终选择了 KDevelop，因为这是我最接近 VS+VA-X 的地方。

Eclipse 和 NetBeans 对我来说太重太慢了。大多数其他 IDE 都有错误/不完整/愚蠢的自动完成和其他功能；或者他们想要控制你的代码并且需要导入到项目中；或者他们将 101 个文件放在您的源文件夹中。只有 KDevelop 允许我有一个简单的链接到我的 src 文件夹并让我工作。自动完成并不出色，但比其他人更好。

KDevelop 不能很好地与我的 Gnome 融合，但我可以忍受它；）

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2008-09-17T02:26:05.217

我真的很喜欢[CodeLite](http://codelite.org)。查看它的[功能页面](http://codelite.org/Main/ReadMore)。

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2008-09-17T03:27:10.983

就个人而言，我也同意 kDevelop 人群的观点。Eclipse 感觉有点笨重并且有点不稳定。关于 kDeveloper 的某些东西总是让人感觉不错。

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2008-09-17T06:42:07.487

终极++ [ [http://www.ultimatepp.org/index.html]](http://www.ultimatepp.org/index.html])

[编辑]
它确实有自己的 C++ 类库（正如 Hernan 指出的那样），但没有什么能阻止您使用任何其他类库（如 SDL），或者您可以推出自己的。如果你愿意，你甚至可以使用 boost，但我必须说我发现一些提供的类和技术更有用。

我最欣赏的是它与调试器和非常完整的上下文相关编辑器的出色集成。它使用 Linux 上的标准编译器和调试器（gcc、g++、gdb）和该平台上的 MS 编译器/调试器。

我唯一的（非常小的）抱怨是项目的自制名称（称为 Nest 等）。这是不必要的，甚至可能会让认真的开发人员感到反感，但它们只是名字，我发现我很容易忽略它。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2008-09-17T02:38:03.550

我之前问过这个问题来体验 Linux 用户，他们总是说 Vim 和 automake。我使用 Vim 作为我在 Linux 中的默认编辑器，一段时间后它变得直观。我在学习 C++ 的同时通过一些小例子来学习它，所以我可以同时学习两者。

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2008-09-17T05:33:35.983

在我以前的工作中，我们使用[SlickEdit](http://www.slickedit.com)在 Debian 下进行 C++ 开发。它是跨平台的并且非常强大。

不过，它不是免费的。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2010-08-22T09:01:47.080

大多数 IDE 的问题是他们希望对项目的组织方式有一定程度的控制，如果您必须与其他人一起处理该项目，这可能是个问题。根据我的经验，这会导致两个相关的问题：

*   如果您在特定的 IDE 中启动项目，他们会为您布局特定的目录结构、文件组织、文件命名约定、构建系统等。当然，这些选项中的大多数都是可自定义的，但并不总是可以遵守特定的您可能需要遵守的约定。具有复杂构建系统的项目可能难以在 IDE 中实现。此外，该项目可能不适合外部独立修改；例如，如果您打算编写一个开源应用程序，*请避免将 IDE 作为项目的依赖项*。

*   如果您导入从其他地方开始的项目，那么使用 IDE 提供的所有功能可能不是很容易。您必须弄清楚如何挂钩构建系统、调试器（因为二进制文件可能不是预期的）等。对于大型和复杂的项目尤其如此。

在 Windows 下这些都不是问题的原因是 Visual Studio 是*事实上的标准*。在 *nix 下，在协作开发项目时倾向于不强制使用特定的工具/编辑器，这就是出现这些“跨 IDE 通信”问题的原因。

最后一点，如果您学习 kdevelop 或 netbeans，如果有一天您必须在一台安装它们的机器上工作，您可能会遇到问题（例如，您可能没有可用的 Java 运行时并且您可能不被允许安装它）。如果你学习（比如说）Vim + 插件，你会更安全：你可以将你的配置作为 .zip 文件保存在你的网络服务器上，并且非常确定 Vim 将始终在任何地方可用。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2008-09-17T02:19:39.273

我不能真正保证 Eclipse 模块，但这可能归因于我在 Windows 上并且几乎不知道我在做什么的事实。

不过，您最喜欢的文本编辑器不会出错。

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2008-09-17T03:47:29.497

Eclipse 还不错，但是您必须按照 Eclipse 的方式做事。Eclipse 有一些关于目录布局的内置想法。对于一个新项目，Eclipse 是一个合理的选择。将现有项目导入 Eclipse 可能需要进行一些重组。

我曾经在 QNX for C++ 下使用 Eclipse。QNX 的人实际上开发了 C++ 功能，所以 QNX 会有一个 IDE。

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2008-09-17T07:37:26.153

Emacs 适用于简单的事情，但我将 Eclipse 用于任何较大的项目。

# c# - 如何使用 Asp.net MVC 从页面中引用位于 View 文件夹中的 .js 文件

> ID：79215
> 
> 赞同：4
> 
> 时间：2008-09-17T02:18:06.653
> 
> 标签：c#, javascript, asp.net-mvc

例如，如果我有一个位于 Views/Home/Index.aspx 的页面和一个位于 Views/Home/Index.js 的 JavaScript 文件，你如何在 aspx 页面上引用它？

即使编译器说路径正确，下面的示例也不起作用

```
<script src="Index.js" type="text/javascript"></script> 
```

完全相同的问题已在此处更详细地发布： [http ://forums.asp.net/p/1319380/2619991.aspx](http://forums.asp.net/p/1319380/2619991.aspx)

如果目前无法做到这一点，将来还会有吗？如果没有，每个人都如何管理大型 Asp.net MVC 项目的 javascript 资源？您是否只是在 Content 文件夹中创建一个文件夹结构来反映您的 View 文件夹结构？呸！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-17T02:23:29.450

您可以使用如下所示的 VirtualPathUtility.ToAbsolute 方法将 .js 文件的应用程序相对 url 转换为可以写入页面的绝对 URL：

```
<script type="text/javascript" src="<%=VirtualPathUtility.ToAbsolute("~/Views/Home/Index.js") %>"></script> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-17T02:26:30.707

您应该有单独的脚本文件夹结构。例如应用程序根目录下的 JavaScript 文件夹。使用视图存储 js 文件不仅会影响路径解析问题，还会影响安全性和权限。此外，如果您决定将来将某些应用程序部件存储在专用子文件夹中时单独部署它们，那么以后将 JS 文件作为程序集资源嵌入会容易得多。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-17T03:49:10.883

对于使用 Content 文件夹的共享 javascript 资源是有意义的。问题是我特别试图解决的是永远不会重用的特定于 aspx 页面的 javascript。

我想我要做的就是将 aspx 页面特定的 javascript 放在页面本身上，并将共享的 js 资源保存在 Content 文件夹中。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-17T06:55:18.720

这是 HtmlHelper 的一个很好的扩展方法：

```
public static class JavaScriptExtensions
{
    public static string JavaScript(this HtmlHelper html, string source)
    {
        TagBuilder tagBuilder = new TagBuilder("script");
        tagBuilder.Attributes.Add("type", "text/javascript");
        tagBuilder.Attributes.Add("src", VirtualPathUtility.ToAbsolute(source));
        return tagBuilder.ToString(TagRenderMode.Normal);
    }
} 
```

像这样使用它：

```
<%=Html.JavaScript("~/Content/MicrosoftAjax.js")%> 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-11-11T13:32:14.933

如果将页面重新路由到自定义 RouteHandler，则可以在将 RequestContext 处理给 MvcHandler 类之前检查文件是否存在。

示例（不完整）：

```
public class RouteHandler : IRouteHandler
{
    public IHttpHandler 
    GetHttpHandler(RequestContext requestContext)
    {
        var request = requestContext.HttpContext.Request;

        // Here you should probably make the 'Views' directory appear in the correct place.
        var path = request.MapPath(request.Path); 
        if(File.Exists(path)) {
            // This is internal, you probably should make your own version.
            return new StaticFileHandler(requestContext);
        }
        else {
            return new MvcHandler(requestContext);
        }
    }
} 
```

# database - Oracle 数据库统计信息应该多久运行一次？

> ID：79229
> 
> 赞同：22
> 
> 时间：2008-09-17T02:20:48.630
> 
> 标签：database, performance, oracle, statistics

根据您的经验，Oracle 数据库统计信息应该多久运行一次？我们的开发团队最近发现，我们的生产箱已经超过 2 1/2 个月没有运行统计数据。这对我来说听起来很长一段时间，但我不是 DBA。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2013-05-24T18:32:51.203

由于默认情况下会自动收集 Oracle 11g 统计信息。

安装 Oracle 数据库时预定义了两个调度程序窗口：

*   WEEKNIGHT_WINDOW 从每周一到周五晚上 10 点开始，到早上 6 点结束。
*   WEEKEND_WINDOW 涵盖周六和周日的全天。

最后一次收集统计数据是什么时候？

```
SELECT owner, table_name, last_analyzed FROM all_tables ORDER BY last_analyzed DESC NULLS LAST; --Tables.
SELECT owner, index_name, last_analyzed FROM all_indexes ORDER BY last_analyzed DESC NULLS LAST; -- Indexes. 
```

自动统计收集的状态？

```
SELECT * FROM dba_autotask_client WHERE client_name = 'auto optimizer stats collection'; 
```

Windows 组？

```
SELECT window_group_name, window_name FROM dba_scheduler_wingroup_members; 
```

窗口时间表？

```
SELECT window_name, start_time, duration FROM dba_autotask_schedule; 
```

在此模式中手动收集数据库统计信息：

```
EXEC dbms_stats.gather_schema_stats(ownname=>NULL, cascade=>TRUE); -- cascade=>TRUE means include Table Indexes too. 
```

手动收集所有模式中的数据库统计信息！

```
-- Probably need to CONNECT / AS SYSDBA
EXEC dbms_stats.gather_database_stats; 
```

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-09-17T02:47:43.510

每当数据“显着”变化时。

如果一个表从 1 行变为 200 行，这是一个重大变化。当一个表从 100,000 行变为 150,000 行时，这并不是一个非常显着的变化。当一个表从 1000 行在通常查询的 X 列中具有相同值的行变为 1000 行在 X 列中具有几乎唯一的值时，这是一个重大变化。

统计信息存储有关项目计数和相对频率的信息——它可以“猜测”有多少行符合给定条件。当它猜错时，优化器可以选择一个**非常**次优的查询计划。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2008-09-18T05:44:52.047

在我的上一份工作中，我们每周运行一次统计数据。如果我没记错的话，我们将它们安排在星期四晚上，而在星期五，DBA 非常小心地监控运行时间最长的查询是否有任何意外情况。（选择星期五是因为它通常是在代码发布之后，并且往往是流量相当低的一天。）当他们看到一个错误的查询时，他们会找到一个更好的查询计划并保存它，这样它就不会再次意外更改. （Oracle 有工具可以自动为您执行此操作，您告诉它要优化的查询，它就会执行。）

许多组织避免运行统计数据是因为担心会意外弹出错误的查询计划。但这通常意味着他们的查询计划会随着时间的推移变得越来越糟糕。当他们运行统计数据时，他们会遇到许多问题。由此产生的解决这些问题的争夺证实了他们对运行统计数据的危险的担忧。但是，如果他们定期进行统计，按应有的方式使用监控工具，并在出现问题时解决问题，那么他们就不会那么头疼了，而且他们不会一下子遇到所有问题。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-09-17T03:06:02.157

您使用的是哪个 Oracle 版本？检查引用 Oracle 10 的此页面：

[http://www.acs.ilstu.edu/docs/Oracle/server.101/b10752/stats.htm](http://www.acs.ilstu.edu/docs/Oracle/server.101/b10752/stats.htm)

它说：

> 收集统计信息的推荐方法是允许 Oracle 自动收集统计信息。Oracle 自动收集所有数据库对象的统计信息，并在定期安排的维护作业中维护这些统计信息。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-17T03:10:45.047

当我管理一个由 Oracle 支持的大型多用户计划系统时，我们的 DBA 每周都有一项工作来收集统计数据。此外，当我们推出可能影响统计数据或受统计数据影响的重大更改时，我们会强制工作超出周期以赶上进度。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-03-10T15:13:04.283

对于 10g 和更高版本的 oracle，优化器需要关于表和索引的最新统计信息来做出“好的”执行计划决策。您收集统计数据的频率是一个棘手的问题。这取决于您的应用程序、架构、数据速率和业务实践。一些被编写为向后兼容旧版本 oracle 的第三方应用程序在新的优化器中表现不佳。这些应用程序要求表没有统计信息，以便数据库返回到规则库执行计划。但平均而言，oracle 建议在具有陈旧统计信息的表上收集统计信息。您可以将表设置为监视并检查它们的状态，并让它们分析是否/何时过时。通常这就足够了，有时却不够。这真的取决于你的数据库。对于我的数据库，我们有一组 OLTP 表，需要每晚收集统计信息以保持性能。其他表每周分析一次。在我们的大型 dw 数据库上，我们根据需要进行分析，因为表太大而无法进行常规分析，而不会影响整体数据库负载和性能。所以正确的答案是，取决于应用、数据变化和业务需求。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-17T20:18:16.247

确保平衡新统计信息导致查询计划发生不良更改的风险与陈旧统计信息本身可能导致查询计划更改的风险。

想象一下，您有一个带有表 ISSUE 和列 CREATE_DATE 的错误数据库，其中列中的值或多或少地单调增加。现在，假设该列上有一个直方图，它告诉 Oracle 该列的值在 2008 年 1 月 1 日和 2008 年 9 月 17 日之间均匀分布。这使得优化器可以合理地估计行数如果您正在查找上周（即 9 月 7 日至 13 日）创建的所有问题，则将被退回。但是，如果继续使用应用程序并且从不更新统计信息，则此直方图将越来越不准确。因此，优化器会期望对“上周创建的问题”的查询随着时间的推移越来越不准确，最终可能导致 Oracle 对查询计划产生负面影响。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-08T13:34:18.360

对于数据仓库类型的系统，您可以考虑完全不收集统计信息，并依赖动态采样（将 optimizer_dynamic_sampling 设置为 2 级或更高级别）。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2014-09-22T11:54:35.787

通常不建议在整个数据库上如此频繁地收集统计信息，除非您有充分的理由这样做，例如数据库上频繁发生批量插入或大数据更改。以这种频率收集数据库的统计信息可能会将查询执行计划更改为新的不良执行计划，这可能会花费您很多时间来尝试调整受新不良计划影响的每个查询，这就是为什么您应该测试收集的影响测试数据库上的新统计信息，或者如果您没有时间或人力，至少您应该通过在收集新统计信息之前备份原始统计信息来保留备用计划，这样万一您收集了新的统计信息，然后查询没有按预期执行，您可以轻松恢复原始统计信息。

There is a very useful script can help you backup original statistics and gather new ones and provide you with SQL command you can use to restore back the original statics in case the thing didn't go as expected after gathering new statistics. You can find the script in this link: [http://dba-tips.blogspot.com/2014/09/script-to-ease-gathering-statistics-on.html](http://dba-tips.blogspot.com/2014/09/script-to-ease-gathering-statistics-on.html)

# database - 你怎么知道什么是好的索引？

> ID：79241
> 
> 赞同：10
> 
> 时间：2008-09-17T02:22:41.527
> 
> 标签：database, oracle, indexing

在 Oracle 中处理表时，您如何知道何时设置了一个好的索引和一个坏的索引？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-09-17T02:31:42.160

这取决于您所说的“好”和“坏”的含义。基本上，您需要意识到您添加的每个索引都会提高该列的任何搜索的性能（因此向人员表的“姓氏”列添加索引将提高其中包含“其中姓氏=”的查询的性能）但是降低整个表的写入性能。

原因是当您添加或更新一行时，它必须添加或更新表本身以及该行所属的每个索引。因此，如果您在一个表上有五个索引，则每次添加都必须写入六个位置 - 五个索引和表 - 在最坏的情况下，更新可能会触及六个位置。

索引创建是查询速度和写入速度之间的平衡行为。在某些情况下，例如在通宵工作中每周仅加载一次数据但每天查询数千次的数据集市，使用索引过载并尽可能加快查询速度是非常有意义的。然而，在在线交易处理系统的情况下，您想尝试在它们之间找到平衡。

所以简而言之，为选择查询中经常使用的列添加索引，但尽量避免添加太多，因此首先添加最常用的列。

之后是负载测试的问题，以查看性能在生产条件下的反应，并进行大量调整以找到可接受的平衡。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-17T02:39:32.827

多样化、高度具体或独特的字段可以作为良好的索引。如日期和时间戳、唯一递增数字（通常用作主键）、人名、车牌号等...

一个反例是性别 - 只有两个常见值，因此索引并不能真正帮助减少必须扫描的行数。

全长的描述性自由格式字符串会产生较差的索引，因为执行查询的人很少知道字符串的确切值。

线性排序的数据（例如时间戳或日期）通常用作聚集索引，它强制将行按索引顺序存储，并允许按顺序访问，从而大大加快范围查询（例如'给我所有的销售订单在 10 月和 12 月之间”）。在这种情况下，数据库引擎可以简单地查找范围指定的第一条记录并开始顺序读取，直到它到达最后一条。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-17T14:14:40.457

@臭名昭著的牛——你必须考虑主键，而不是索引。

@Xenph Yan——其他人没有提到的是选择创建什么*样*的索引。有些数据库实际上并没有给您太多选择，但有些数据库有多种可能的索引。B 树是*默认*的，但并不总是最好的索引。选择正确的结构取决于您期望的使用类型。您最需要支持哪种查询？您是处于以读为主还是以写为主的环境中？你的写入是由更新还是附加控制的？等等等等。

此处提供了不同类型索引及其优缺点的说明：http: [//20bits.com/2008/05/13/interview-questions-database-indexes/](https://web.archive.org/web/20080701193711/http://20bits.com/2008/05/13/interview-questions-database-indexes/)。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-17T02:25:02.847

这是一篇很棒的 SQL Server 文章： [http ://www.sql-server-performance.com/tips/optimizing_indexes_general_p1.aspx](http://www.sql-server-performance.com/tips/optimizing_indexes_general_p1.aspx)

虽然这些机制在 Oracle 上不起作用，但这些技巧非常恰当（减去聚集索引上的东西，它在 Oracle 中的工作方式不太一样）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-03T12:53:19.513

如果您正在尝试改进特定查询，请遵循一些经验法则。

对于一个特定的表（你认为 Oracle 应该从哪里开始）尝试索引 WHERE 子句中使用的每个列。首先放置具有相等性的列，然后放置具有范围或类似的列。

例如：

```
WHERE CompanyCode = ? AND Amount BETWEEN 100 AND 200 
```

如果列的大小非常大（例如，您正在存储一些 XML 或其他内容），您最好将它们排除在索引之外。这将使扫描的索引更小，假设您无论如何都必须转到表行以满足选择列表。

或者，如果 SELECT 和 WHERE 子句中的所有值都在索引中，Oracle 将不需要访问表行。因此，有时最好将选定的值放在索引的最后，并避免一起访问表。

你可以写一本关于最好的索引方法的书——找作家乔纳森·刘易斯。

* * *

## 回答 #6

> 赞同：-2
> 
> 时间：2008-09-17T02:32:38.133

一个好的索引是你可以依赖的东西，它对于特定的表行是唯一的。

一种常用的索引方案是使用对表中的每一行递增 1 的数字。每行最终都会有不同的数字索引。

# .net - 如何强制所有子级覆盖父级的 Clone() 方法？

> ID：79244
> 
> 赞同：1
> 
> 时间：2008-09-17T02:22:54.460
> 
> 标签：.net, c++-cli

如何确保所有派生的 C++/CLI 类将覆盖基类的 ICloneable::Clone() 方法？

你觉得我应该担心这个吗？或者这不是基类作者的责任？

**修正：**对不起，我忘了提到基类是一个非抽象类。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-17T02:33:27.897

在基类中声明它是纯虚拟的。

类 Base
{
...
vitual void Clone() = 0;
};

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-17T02:33:44.713

好吧，我不能说这是否是基类的责任，也不会在这里讨论基于继承的合同的危险。

在任何情况下，您*都可以*强制某个类覆盖一个方法 - 例如，“Clone()”，通过使其成为抽象类的*纯虚拟*成员

```
public ref class ClonableBase abstract
{
 public:
   virtual void Clone() = 0;
} 
```

注意“abstract”和“=0;”。抽象允许类在没有警告的情况下包含纯虚拟成员，并且 =0; 意味着这个方法是纯虚拟的——也就是说，它不包含主体。请注意，您不能实例化抽象类。

现在你可以

```
public ref class ClonableChild : public ClonableBase
{
 public:
   virtual void Clone();
}

void ConableChild::Clone()
{
  //some stuff here
} 
```

如果您在 ClonableChild 中没有 Clone 覆盖，则会出现编译器错误。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-17T02:25:54.250

将 Clone() 方法声明为抽象的。即使父类确实有具体的实现，这也应该有效。

当然，执行此类操作时的风险是派生类的编写者会生气，说“我无论如何也不打算使用 Clone”并执行字节复制，甚至“返回 this”之类的操作，以摆脱错误。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-17T04:42:41.270

如果基类是非抽象的，那么就没有办法在编译时强制它被覆盖。您可能做的最好的事情是：

```
virtual void Clone()
{
   throw gcnew NotSupportedException();
} 
```

这样，派生类将不得不重写该方法，否则您的应用程序将遇到 NotSupportedException。这至少会在测试过程中立即表明某些地方不正确。它会给你一些寻找的东西，以便你知道什么时候遇到一个没有正确覆盖克隆的类。根据您对派生类的控制程度，这对于稳健性可能很重要。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-17T02:49:35.050

```
class Base
{
...
virtual void Clone() = 0;
}; 
```

是正确的。

如果您想要克隆的一些默认行为，请尝试：

```
class Base
{
...
virtual void Clone()
{ 
   ...
   doClone();
   ...
};

...

private:
virtual void doClone() = 0;
}; 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-17T11:20:13.170

由草本萨特[阅读](http://www.gotw.ca/gotw/071.htm)。这正是你要问的

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-17T04:21:15.813

> **修正：**对不起，我忘了提到基类是一个非抽象类。

从这个新角度来看，我很确定您根本不想强迫任何人覆盖 Clone()。例如，如果我的派生类不添加任何字段，它可能不需要自己的专用 Clone() 方法。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-17T04:51:21.530

经过一番思考，我找到了这个解决方案：

```
Object^ BaseClass::Clone()
{
  if(this->GetType() != BaseClass::typeid)
  {
    throw gcnew System::NotImplementedException("The Clone() method is not implemented for " + this->GetType()->ToString() + "!");
  }

  BaseClass^ base = gcnew BaseClass();
  ... // Copy the fields here
  return base;
} 
```

如果您尝试克隆尚未覆盖基类的 Clone() 方法的派生类的实例，则会引发 NotImplementedException。

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2008-09-17T02:34:57.630

Thomas 是正确的，但是使该类抽象的一种方法是定义一个纯虚拟方法。

这是通过说：

虚拟无效克隆（）= 0；

除非派生类实现 Clone，否则他们将无法实例化它，因此如果他们希望自己的类有用，他们将别无选择。

# operating-system - 什么是多任务操作系统？

> ID：79248
> 
> 赞同：11
> 
> 时间：2008-09-17T02:23:47.780
> 
> 标签：operating-system, computer-science

多任务操作系统的特点是什么？
是什么让它多任务处理？
有非多任务操作系统吗？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-09-17T02:28:12.903

> 多任务操作系统的特点是什么？是什么让它多任务处理？

多任务操作系统允许一次运行多个程序。它们可以支持抢先式多任务处理，其中操作系统将时间分配给应用程序（几乎所有现代操作系统）或协作多任务处理，其中操作系统等待程序交还控制权（Windows 3.x、Mac OS 9 和更早版本）。

> 有非多任务操作系统吗？

任何一次只允许做一件事的操作系统（例如 DOS）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-17T02:26:51.097

多任务操作系统是：

一种操作系统，可让您感知同时运行的 2 个或更多任务/作业/进程。它通过在这些任务/作业/进程之间划分系统资源来做到这一点。并在任务/​​作业/流程之间切换，同时一遍又一遍地快速执行。

是的，有非多任务操作系统，例如：commodore 64 的操作系统（Commodore BASIC 2.0）。可能是某些公司的一些定制软件。可能像 ATM 机或电影院存根票系统。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-17T02:26:56.540

多任务操作系统能够并行管理各种进程。一种特殊的能力是在进程之间共享 CPU 时间。

是的，有很多非多任务操作系统。回到过去，它们是规则：例如 MSDOS。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-17T02:30:22.023

来自恐龙操作系统书（“应用操作系统概念”）：

**分时**或多**任务处理**是多道程序的逻辑扩展。CPU通过在它们之间切换来执行多个作业，但是切换发生得如此频繁，以至于用户可以在每个程序运行时与它进行交互。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-08-31T15:37:09.937

**分时/**多任务是多道程序的逻辑扩展。多任务操作系统允许通过在它们之间切换来同时执行多个作业。通常 CPU 一次只处理一个任务，但切换速度非常快，看起来 CPU 正在执行多个一次处理。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-17T02:29:34.710

我不确定你是否应该在这里问你的作业问题......;）

多任务操作系统允许您“同时”运行多个进程（任务）。当然，它们实际上并不同时运行，因为只有一个 CPU。发生的情况是一个进程运行了一段时间，然后操作系统中断（通过中断），存储当前进程的状态（上下文），恢复另一个进程的上下文，并允许另一个进程运行一段时间，等等。

MS-DOS 是非多任务操作系统的一个例子：只要你在玩 Commander Keen，你的计算机上就不能运行其他任务（包括 DOS shell 本身）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-17T02:32:24.903

（抢占式）多任务操作系统能够同时运行多个进程，并且每次都可以控制哪个进程正在使用 CPU 和其他资源，这与协作式多任务操作系统相反，后者的进程必须自愿放弃 CPU，从而导致挂起和崩溃。

通常，现代多任务操作系统还提供进程之间的内存隔离并支持不同的安全级别，允许操作系统代码做用户代码不能做的事情。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-17T02:36:03.833

有一种流行的非多任务操作系统尚未列出：PalmOS。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-17T02:38:24.250

多任务操作系统将是一种允许同时执行多个（超过 1 个）进程的操作系统。您习惯的操作系统，如 Unix、Windows 和 OSX 是多任务操作系统。

非多任务操作系统的一个例子是 MS-DOS。尽管您可以在 MS-DOS 下同时运行多个进程，但在 Windows 3.1 或 Windows 9x 的帮助下，操作系统本身是非多任务处理的。

有关计算机多任务处理的更多信息，您可能需要查看维基百科页面：[http ://en.wikipedia.org/wiki/Computer_multitasking](http://en.wikipedia.org/wiki/Computer_multitasking)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-17T02:39:03.750

[维基百科](http://en.wikipedia.org/wiki/Computer_multitasking)对多任务处理有很好的了解。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2010-08-13T04:59:56.257

多任务操作系统是允许用户同时运行各种任务的操作系统。实际上并非如此，因为只有一个 cpu。这背后的概念是分时。操作系统将cpu时间分配给各种任务，但是这个时间非常小（纳秒），用户感觉所有的程序或任务都在同时运行。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2010-08-17T10:37:54.917

对于用户来说，并行工作已经完成只是一种错觉，但并不完全是这样。

# css - 查找不存在的样式参考

> ID：79258
> 
> 赞同：1
> 
> 时间：2008-09-17T02:25:08.993
> 
> 标签：css

是否有一个工具可以为我找到我在 HTML 中引用但实际上并不存在的所有 css 类？

IE。如果我的 HTML 中有 <ul class="topnav" /> 并且任何引用的 CSS 文件中都不存在 topnav 类。

这类似于[SO#33242](https://stackoverflow.com/questions/33242/how-can-i-find-unused-images-and-css-styles-in-a-website)，它询问如何查找未使用的 CSS 样式。这不是重复的，因为该问题询问未使用哪些 CSS 类。这是相反的问题。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-17T02:48:38.423

您可以将此 JavaScript 放在可以为您执行此任务的页面中：

```
function forItems(a, f) {
  for (var i = 0; i < a.length; i++) f(a.item(i))
}

function classExists(className) {
  var pattern = new RegExp('\\.' + className + '\\b'), found = false

  try {
    forItems(document.styleSheets, function(ss) {
      // decompose only screen stylesheets
      if (!ss.media.length || /\b(all|screen)\b/.test(ss.media.mediaText))
        forItems(ss.cssRules, function(r) {
          // ignore rules other than style rules
          if (r.type == CSSRule.STYLE_RULE && r.selectorText.match(pattern)) {
            found = true
            throw "found"
          }
        })
    })
  } catch(e) {}

  return found
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-17T02:31:01.367

Firefox 中的错误控制台。虽然，它给出了**所有**的 CSS 错误，所以你必须通读它。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-17T02:33:20.423

[IntelliJ Idea](http://www.jetbrains.com/idea/features/html_css_editor.html "智能理念")工具也可以做到这一点。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-18T22:29:48.917

[这个 Firefox 扩展](http://www.sitepoint.com/dustmeselectors/)正是你想要的。

它定位所有未使用的选择器。

# windows - 如何从 Windows Vista Complete PC Backup 中提取文件？

> ID：79264
> 
> 赞同：2
> 
> 时间：2008-09-17T02:26:09.803
> 
> 标签：windows, api, windows-vista, backup

是否有程序或 API 可以用来从 Windows Vista Complete PC 备份映像中提取单个文件？

我喜欢有一个完整的映像来恢复的想法，但讨厌我必须进行两次备份的想法，一个用于恢复单个文件，另一个用于在发生灾难性故障时恢复我的计算机。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-17T03:11:53.657

是的，有一个 API。Windows Vista Complete PC Backup 创建一个 .vhd（虚拟硬盘）映像，可以通过[Virtual Server 2005 API](http://technet.microsoft.com/en-us/library/cc756145.aspx)或从 Virtual Server 2005 中提供的命令行实用程序访问，该实用程序可在[此处](http://technet.microsoft.com/en-us/virtualserver/default.aspx)免费获得。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-09-14T03:25:09.103

[7-Zip](http://www.google.com/url?sa=t&source=web&cd=1&ved=0CEAQFjAA&url=http://www.7-zip.org/&ei=9R1wTqmOJIqugQel9t2MBQ&usg=AFQjCNElgl3u-wgL-ZOjo_CH4znsHpsyyw&sig2=_n_0s3MDtdi3ZvKKxBcKtg)将打开 WindowsImageBackup 的 .vhd 文件...

# sql - 你如何解释查询的解释计划？

> ID：79266
> 
> 赞同：90
> 
> 时间：2008-09-17T02:26:18.930
> 
> 标签：sql, database, performance, oracle, sql-execution-plan

当试图了解 SQL 语句是如何执行的时，有时建议查看解释计划。在解释（理解）解释计划时应该经历什么过程？什么应该突出，“哦，这工作很棒？” 与“哦，不，那不对。”

* * *

## 回答 #1

> 赞同：81
> 
> 时间：2008-10-01T12:31:22.673

每当我看到关于全表扫描不好而索引访问好的评论时，我都会不寒而栗。全表扫描、索引范围扫描、快速全索引扫描、嵌套循环、合并连接、哈希连接等都是分析人员必须理解的简单访问机制，并结合数据库结构和查询目的的知识为了得出任何有意义的结论。

完全扫描只是读取数据段（表或表（子）分区）的大部分块的最有效方式，虽然它通常可以指示性能问题，但仅在上下文中是否是实现查询目标的有效机制。作为一名数据仓库和 BI 人员，我对性能的第一个警告标志是基于索引的访问方法和嵌套循环。

因此，对于如何阅读解释计划的机制，Oracle 文档是一个很好的指南：http: [//download.oracle.com/docs/cd/B28359_01/server.111/b28274/ex_plan.htm#PFGRF009](http://download.oracle.com/docs/cd/B28359_01/server.111/b28274/ex_plan.htm#PFGRF009)

还请仔细阅读《性能调优指南》。

还有一个“基数反馈”的谷歌，一种技术，其中解释计划可用于将查询中各个阶段的基数估计与执行期间经历的实际基数进行比较。我相信 Wolfgang Breitling 是该方法的作者。

所以，底线：了解访问机制。了解数据库。了解查询的意图。避免经验法则。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-09-19T11:13:30.050

这个话题太大了，无法在这样的问题中回答。您应该花一些时间阅读[Oracle 的性能调优指南](http://download.oracle.com/docs/cd/B19306_01/server.102/b14211/toc.htm)

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-17T03:41:26.110

下面的两个示例显示了使用 INDEX 的 FULL 扫描和 FAST 扫描。

最好专注于您的成本和基数。查看示例，索引的使用降低了运行查询的成本。

它有点复杂（我没有 100% 的处理）但基本上成本是 CPU 和 IO 成本的函数，基数是 Oracle 期望解析的行数。减少这两者是一件好事。

不要忘记查询的成本会受到您的查询和 Oracle 优化器模型（例如：COST、CHOOSE 等）以及您运行统计信息的频率的影响。

**示例 1：**

[扫描 http://docs.google.com/a/shanghainetwork.org/File?id=dd8xj6nh_7fj3cr8dx_b](http://docs.google.com/a/shanghainetwork.org/File?id=dd8xj6nh_7fj3cr8dx_b)

**使用索引的示例 2：**

[索引 http://docs.google.com/a/fukuoka-now.com/File?id=dd8xj6nh_9fhsqvxcp_b](http://docs.google.com/a/fukuoka-now.com/File?id=dd8xj6nh_9fhsqvxcp_b)

正如已经建议的那样，请注意 TABLE SCAN。您通常可以避免这些。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-17T05:43:11.997

寻找诸如顺序扫描之类的东西可能会有些用处，但现实存在于数字中……除非数字只是估计值！通常**比**查看查询*计划*更有用的是查看实际*执行情况*。在 Postgres 中，这就是 EXPLAIN 和 EXPLAIN ANALYZE 之间的区别。EXPLAIN ANALYZE 实际执行查询，并获取每个节点的真实时间信息。这让您可以看到*实际*发生的事情，而不是计划者*认为*会发生的事情。很多时候，您会发现顺序扫描根本不是问题，而是查询中的其他内容。

另一个关键是确定实际昂贵的步骤是什么。许多图形工具将使用不同大小的箭头来指示计划中不同部分的成本。在这种情况下，只需寻找有细箭头进入和粗箭头离开的步骤。如果您不使用 GUI，则需要观察数字并寻找它们突然变大的地方。稍加练习，就可以很容易地找出问题区域。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-19T01:16:37.393

对于这些问题，最好的办法是[ASKTOM](http://asktom.oracle.com/pls/asktom/f?p=100:11:0::::P11_QUESTION_ID:231814117467)。特别是他对该问题的回答包含指向在线 Oracle 文档的链接，其中解释了许多此类规则。

要记住的一件事是，解释计划确实是最好的猜测。

学习使用 sqlplus 并尝试使用 AUTOTRACE 命令将是一个好主意。有了一些硬数字，您通常可以做出更好的决定。

但你应该问。他什么都知道：）

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-17T02:29:57.547

解释的输出告诉您每个步骤花费了多长时间。首先是找到花费了很长时间的步骤并理解它们的含义。诸如顺序扫描之类的事情会告诉您您需要更好的索引 - 这主要是研究您的特定数据库和经验的问题。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-17T02:30:22.100

一个“哦，不，那不对”通常是**表扫描**的形式。表扫描不使用任何特殊索引，并且有助于清除内存缓存中的所有有用信息。例如，在 postgreSQL 中，你会发现它看起来像这样。

```
Seq Scan on my_table  (cost=0.00..15558.92 rows=620092 width=78) 
```

有时，表扫描比使用索引查询行更理想。但是，这是您似乎正在寻找的危险信号模式之一。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-09-17T02:31:32.253

基本上，您会查看每个操作，并根据您对操作应该如何工作的了解，看看这些操作是否“有意义”。

例如，如果您在各自的列 C 和 D (AC=BD) 上连接两个表 A 和 B，并且您的计划在表上显示聚集索引扫描（SQL Server 术语 - 不确定 oracle 术语） A，然后嵌套循环连接到表 B 上的一系列聚集索引搜索，您可能会认为有问题。在这种情况下，您可能希望引擎执行一对索引扫描（在连接列上的索引上），然后进行合并连接。进一步的调查可能会揭示错误的统计信息，从而使优化器选择该连接模式或实际不存在的索引。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-17T02:29:51.963

查看计划的每个子部分花费的时间百分比，并考虑引擎在做什么。例如，如果它正在扫描一个表，请考虑在正在扫描的字段上放置一个索引

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-17T02:33:39.333

我主要寻找索引或表扫描。这通常告诉我我在 where 语句或 join 语句中的重要列上缺少索引。

来自[http://www.sql-server-performance.com/tips/query_execution_plan_analysis_p1.aspx](http://www.sql-server-performance.com/tips/query_execution_plan_analysis_p1.aspx)：

> 如果您在执行计划中看到以下任何内容，则应将其视为警告信号并调查它们是否存在潜在的性能问题。从性能的角度来看，它们中的每一个都不太理想。
> 
> ```
> * Index or table scans: May indicate a need for better or  additional indexes.
> * Bookmark Lookups: Consider changing the current clustered index,
>   consider using a covering index, limit
>   the number of columns in the SELECT
>   statement.
> * Filter: Remove any functions in the WHERE clause, don't include wiews
>   in your Transact-SQL code, may need
>   additional indexes.
> * Sort: Does the data really need to be sorted? Can an index be used to
>   avoid sorting? Can sorting be done at
>   the client more efficiently? 
> ```
> 
> 并非总是可以避免这些，但是您可以避免的越多，查询性能就会越快。

* * *

## 回答 #11

> 赞同：-7
> 
> 时间：2008-09-17T10:25:49.010

## 经验法则

（您可能也想阅读详细信息：

*   [甲骨文文档](http://download.oracle.com/docs/cd/B28359_01/server.111/b28274/ex_plan.htm#PFGRF009)
*   [斯通](http://asktom.oracle.com/pls/asktom/f?p=100:11:0::::P11_QUESTION_ID:231814117467)
*   [SQL Server 文档](http://www.sql-server-performance.com/tips/query_execution_plan_analysis_p1.aspx)
    ）

### 坏的

几个大表的表扫描

### 好的

使用唯一索引
索引包含所有必填字段

### 最常见的胜利

在我见过的大约 90% 的性能问题中，最简单的方法是将包含大量（4 个或更多）表的查询分解为 2 个较小的查询和一个临时表。

# javascript - 如何使用javascript跳过字段？

> ID：79275
> 
> 赞同：1
> 
> 时间：2008-09-17T02:27:20.110
> 
> 标签：javascript, firefox, focus, skip

我有这样的表格：

```
<form name="mine">
    <input type=text name=one>
    <input type=text name=two>
    <input type=text name=three>
</form> 
```

当用户在“一”中输入值时，我有时想跳过“二”字段，具体取决于他输入的内容。例如，如果用户键入“123”并使用 Tab 移动到下一个字段，我想跳过它并转到第三个字段。

我尝试使用`OnBlur`and `OnEnter`，但没有成功。

**尝试1：**

```
<form name="mine">
    <input type=text name=one onBlur="if (document.mine.one.value='123') document.three.focus();>
    <input type=text name=two>
    <input type=text name=three>
</form> 
```

**尝试2：**

```
<form name="mine">
    <input type=text name=one>
    <input type=text name=two onEnter="if (document.mine.one.value='123') document.three.focus();>
    <input type=text name=three>
</form> 
```

但这些都不起作用。看起来浏览器不允许您在焦点变化时弄乱焦点。

顺便说一句，这一切都在 Linux 上使用 Firefox 进行了尝试。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-17T02:32:29.397

尝试将 tabindex 属性附加到您的元素，然后以编程方式（在 javaScript 中更改它）：

```
<INPUT tabindex="3" type="submit" name="mySubmit"> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-17T02:33:27.850

您可以在字段 2 上使用[onfocus](http://www.w3schools.com/jsref/jsref_onfocus.asp)事件，该事件将在收到焦点时调用。此时，应更新字段 1 的值，然后您可以执行检查。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-17T02:35:24.960

如果您使用了您描述的方法，并且它们有效，那么当用户单击该字段时，焦点也会发生变化，而不是使用 Tab 键。我可以向您保证，这会导致用户感到沮丧。（为什么它不起作用超出了我的范围。）

相反，如前所述，只要字段一的内容发生变化，就立即更改相应字段的 tabindex。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-17T02:37:08.653

```
<form name="mine">
    <input type="text" name="one" onkeypress="if (mine.one.value == '123') mine.three.focus();" />
    <input type="text" name="two">
    <input type="text" name="three">
</form> 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-17T02:37:19.590

尝试`onkeypress`代替`onblur`. 此外，在第二`onfocus`场是你应该发送到第三场的地方。我假设如果一个是 123，你不希望他们输入两个，所以你可以检查两个`onfocus`并发送到三个。

# sql - 任何数据库都可以做数学吗？

> ID：79292
> 
> 赞同：2
> 
> 时间：2008-09-17T02:29:45.830
> 
> 标签：sql, database, math

数据库（特别是 MySQL，任何 SQL——MS、Oracle、Postgres——一般来说）能否进行大规模更新，并自行确定新值应该是什么？例如，我有一个数据库，其中包含有关一堆计算机的信息，所有这些计算机都有各种大小的驱动器——从 20 GB 到 250 GB 不等。然后有一天，我们通过添加 120 GB 硬盘来升级每台计算机。有没有办法说类似

```
update computers set total_disk_space = (whatever that row's current total_disk_space is plus 120) 
```

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-17T02:32:04.360

对于整个表然后：

```
Update Computers 
Set Total_Disk_Space = Total_Disk_Space + 120; 
```

如果您只想更新某些内容，那么您需要过滤器，例如：

```
Update Computers
Set Total_Disk_Space = Total_Disk_Space + 120
Where PurchaseDate BETWEEN '1/1/2008' AND GETDATE(); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-17T02:30:58.887

是的：

```
update computers set total_disk_space = total_disk_space + 120; 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-17T02:34:11.950

在您的示例中，如果 total_disk_space 是 INT 您可以使用：

```
UPDATE computers
SET total_disk_space = total_disk_space + 120; 
```

如果你在存储角色数据，那么它会更有趣。

# perl - 是否有关于迁移到 Moose 的非常好的网络资源？

> ID：79322
> 
> 赞同：9
> 
> 时间：2008-09-17T02:33:21.360
> 
> 标签：perl, moose

包含模块本身的文档非常薄，而且往往指向 MOP。

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-09-17T03:11:51.893

首先，如果您还没有阅读手册，则应该通读该[手册。](http://metacpan.org/pod/Moose::Manual)然后你可以继续阅读[食谱](http://metacpan.org/pod/Moose::Cookbook)。

我认为这些天的文档实际上非常好，只要您阅读正确的文档即可。除非您对 Moose 的自省功能感兴趣，否则您*真的*不应该费心查看大多数文档以查找以 " " 开头的任何类名。`Moose::Meta`我试图在 Moose.pm 文档中使这一点更加明显，从 0.57 开始，该文档告诉您首先阅读[手册](http://metacpan.org/pod/Moose::Manual)和[食谱](http://metacpan.org/pod/Moose::Cookbook)。

如果您来自执行 Perl 5 OO“老派方式”的背景，我还建议您查看[`Moose::Manual::Unsweetened`](http://metacpan.org/pod/Moose::Manual::Unsweetened)文档，该文档将 Moose 与等效的 Perl 5“手动”代码进行了比较。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-17T16:34:42.430

[http://moose.perl.org](http://moose.perl.org)是 Moose 的一个很好的中心资源

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-09-17T04:37:25.417

一旦您阅读了 Dave 提到的文档，如果您对它如何变得更平易近人或让您走上正轨（或者更容易找到）有所了解，也许您想将其贡献给文档。开发人员无法真正从新用户的角度阅读介绍性文档。因此，针对文档提交错误报告（可能带有补丁）和/或在邮件列表或 irc 频道上讨论它。这将帮助你的下一个人。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-10-27T23:27:51.283

我发现这张[Moose 快速参考表](http://users.ox.ac.uk/~oliver/data/files/moose-quick-ref.pdf)非常宝贵。我总是忘记在哪个手册部分查找特定功能。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2014-10-23T00:05:18.930

我也刚刚开始转向 Moose。由于术语“*好*”可能相当主观，因此我将详细说明我在这些资源中发现的优点。根据您在 Perl 中的技能/经验，这些资源可能或多或少有用。

我从这个[Perl Monks 页面](http://www.perlmonks.org/?node_id=702738 "Perl 僧侣")开始。并直接进入底部列出的[Moose::Cookbok链接。](http://search.cpan.org/perldoc?Moose%3A%3ACookbook)在那里，作者包含了更多指向演示 Moose 语法和面向对象程序的 pod 的链接。订单安排得很好；从简单和基本的 OOP 开始，Moose 在顶部，随着您向下浏览页面，逐步进入更复杂的示例。pod 写得很好，不会过于冗长，并且清楚地解释了代码的每一块。

我敢肯定，一旦您完成了 Cookbook，您就可以查看 Perl Monks 页面上列出的任何其他内容。我仍在浏览 Cookbook 中的示例，所以我还没有检查 Perl Monks 中列出的所有资源，但我确信它们很好。

# windows - 你推荐什么开源的虚拟专用服务器程序，以 windows 为主机

> ID：79350
> 
> 赞同：-1
> 
> 时间：2008-09-17T02:37:37.467
> 
> 标签：windows, open-source, vps

我希望在位于数据中心的 Windows Server 2003 R2 64 位版本服务器上运行 4 个虚拟服务器（各种 linux 风格）。如果需要，我还可以购买 2008 服务器或 32 位 2k3。他们每个人都有自己的网络 IP 地址，以便可以公开访问。我对 VPS 软件了解不多，但以前使用过它。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-17T12:09:34.067

[Virtual Server 2005 R2 SP1](http://technet.microsoft.com/en-gb/bb738033.aspx)是免费的（需要注册）并支持 x64 主机。它不支持 x64 来宾。

Windows Server 2008 包括 Hyper-V，这是 Microsoft 的新虚拟化技术，它支持 x64 来宾和多个虚拟处理器。也有没有 Hyper-V 的版本，价格略低，以满足反垄断当局的要求。必须下载Hyper-V[更新，因为它是在 Windows Server 2008 的其余部分发布后完成的。](http://support.microsoft.com/?kbid=950050)

[VMware Server](http://www.vmware.com/products/server/)也是免费的。它支持（实验性地）最多 2 个虚拟 CPU。

为了获得最佳性能，您需要虚拟机中的驱动程序和补丁程序与虚拟化环境配合良好。在 Virtual Server 中，这些被称为 Additions，在 Hyper-V 中它们是集成组件，而对于 VMware，它们是 VMware Tools。由于内核二进制兼容性的性质（没有保证），通常只支持特定的发行版。

*   [下载适用于 Linux 的虚拟服务器添加](http://technet.microsoft.com/en-us/virtualserver/bb676671.aspx)
*   [下载 Hyper-V Linux 集成组件](https://connect.microsoft.com/SelfNomination.aspx?ProgramID=1863&pageType=1&SiteID=495)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-17T02:41:24.523

不幸的是，获得良好性能的唯一方法是使用 Linux 作为主机，使用 Windows 作为客户机。x64 上的签名驱动程序要求实质上阻止了任何开源实现具有合理的性能。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-17T03:02:29.340

如果您要运行 4 个虚拟服务器，所有这些服务器都将是 linux 风格，为什么您不在 linux 中运行主机呢？

如果出于某种原因您必须使用 Windows 机器，我会说获取 2003 32 位签名驱动程序实际上只是 2008 年的一个问题，但即使在 2003 年我也不能真正推荐 64 位，除非有紧迫的要求（如 Exchange 2007)

# ruby - 如何将单个对象变成可在 ruby 中枚举的对象

> ID：79352
> 
> 赞同：2
> 
> 时间：2008-09-17T02:38:02.380
> 
> 标签：ruby

我有一个可以返回单个对象或对象集合的方法。我希望能够在该方法的结果上运行 object.collect，无论它是否已经是单个对象或集合。我怎样才能做到这一点？

```
profiles = ProfileResource.search(params)
output = profiles.collect do | profile |
    profile.to_hash
end 
```

如果配置文件是单个对象，则当我尝试对该对象执行 collect 时会收到 NoMethodError 异常。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-17T02:53:15.540

小心使用 flatten 方法，如果 search() 返回嵌套数组，则可能会导致意外行为。

```
profiles = ProfileResource.search(params)
profiles = [profiles] if !profiles.respond_to?(:collect)
output = profiles.collect do |profile|
    profile.to_hash
end 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-17T03:00:29.843

这是一个衬垫：

```
[*ProfileResource.search(params)].collect { |profile| profile.to_hash } 
```

诀窍是 splat (*) 将单个元素和可枚举转换为参数列表（在本例中为新数组运算符）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-17T02:45:46.230

```
profiles = [ProfileResource.search(params)].flatten
output = profiles.collect do |profile|
    profile.to_hash
end 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-17T02:47:45.540

在类的`search`方法中`ProfileResource`，总是返回一个对象的集合（通常是一个数组），即使它只包含一个对象。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-17T03:00:45.710

如果集合是一个数组，你可以使用这个技术

```
profiles = [*ProfileResource.search(params)]
output = profiles.collect do | profile |
    profile.to_hash
end 
```

这将保证您的个人资料始终是一个数组。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-17T03:01:19.873

```
profiles = ProfileResource.search(params)
output = Array(profiles).collect do |profile|
    profile.to_hash
end 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-17T03:14:44.913

您可以首先使用“pofiles.respond_to?”检查对象是否响应“收集”方法。

来自[Ruby 编程](http://www.ruby-doc.org/docs/ProgrammingRuby/)

> obj.respond_to?(aSymbol, includePriv=false) -> true or false
> 
> 如果 obj 响应给定的方法，则返回 true。仅当可选的第二个参数的计算结果为 true 时，私有方法才会包含在搜索中。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-17T10:03:31.967

您也可以使用 Kernel#Array 方法。

```
profiles = Array(ProfileResource.search(params))
output = profiles.collect do | profile |
    profile.to_hash
end 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-19T16:28:51.247

另一种方法是实现 Enumerable 要求您提供 each 方法。

所以。你可以将 Enumerable 混入你的班级，并给它一个虚拟的每个工作......

```
类 YourClass
  包括可枚举

  ......非常重要和惊天动地的东西......

  定义每个
    产量（自我）如果block_given？
  结尾
结尾

```

这样，如果您从搜索中自行返回单个项目，则可枚举方法仍将按预期工作。

这种方式的优点是对它的所有支持都在您的班级内部，而不是在必须多次复制的外部。

当然，更好的方法是更改​​搜索的实现，使其返回一个数组，而不管返回多少项。

# .net - 什么最适合桌面小部件（小尺寸和漂亮的图形）？

> ID：79356
> 
> 赞同：4
> 
> 时间：2008-09-17T02:38:22.707
> 
> 标签：.net, c++, wpf, .net-3.5

如果我想创建一个漂亮的小部件以保持在后台运行且内存占用很小，我将从哪里开始构建 Windows 应用程序。它的目标是使更新的项目列表保持在 Web 服务之外。类似于 RSS 阅读器。

注意：数据层将通过 REST 连接，我已经有一个 C# dll，我认为它不会对占用空间产生太大影响。

显然我想使用一个不错的 WPF 项目，但是 ~60,000k 的初始大小太大了。

*C# Forms 应用程序大约是 ~20,000k

*C++ 形式 ~16,000k

*CLR 或 MFC 小得多，小于 5

有没有办法剥离 WPF 或表单？如果我坚持使用 CLR 或 MFC，那么让它变得漂亮的最简单方法是什么。（我在 MFC 的经验是制作非常好的奖励表格）

*更新：澄清*上述大小是进程运行时使用的内存，而不是可执行文件。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-17T04:03:56.667

关于：

> 更新：澄清上述大小是进程运行时使用的内存，而不是可执行文件。

好的，当您运行一个小型 C# Win Forms 应用程序时，为其保留的最小 RAM 量约为 2 兆，也许是 4 兆。这只是它创建的一个工作集。它没有积极使用所有这些内存或类似的东西。它只是预先保留了那么多空间，因此它不必在以后根据需要对更多内存进行长/慢/昂贵的请求。

预先保留较小的尺寸可能是错误的优化。

（如果真的很重要，您可以使用 pinvoke 调用来减少工作集。请参阅[pinvoke 以了解“设置进程工作集大小”](http://www.pinvoke.net/default.aspx/kernel32.SetProcessWorkingSetSize)）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-17T03:41:50.947

如果您打算使用“已经有一个 C# dll”，那么目标计算机上必须已经安装了 .net。

在这种情况下，C# win 表单应用程序不需要接近 20 兆。最小的 hello world 类型 win 格式为 7 KB。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-17T03:49:22.253

如果它确实必须尽可能小，请使用纯 C 并直接与 Windows API 对话。

但是，由于由于.NET dll，您无论如何都会加载CLR，所以我会选择不那么痛苦的东西，并且简单地将C# 用于UI。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-10-02T19:18:25.027

为什么不使用 Silverlight？这是[一篇](http://blogs.msdn.com/gavingear/archive/2007/06/07/how-to-create-an-ink-enabled-sidebar-gadget-using-silverlight.aspx)关于这样做的文章。

# c - 在 OpenGL 中绕视线旋转时如何防止变形？

> ID：79360
> 
> 赞同：4
> 
> 时间：2008-09-17T02:38:41.503
> 
> 标签：c, opengl

我在 XZ 平面上画了一个椭圆，并在 Y 轴和 Z 轴上稍微向上设置我的视角，从 45 度角看椭圆的中心，使用 gluPerspective() 设置我的视锥.

[![椭圆](https://farm4.static.flickr.com/3153/2863703051_a768ed86a9_m.jpg)](http://www.flickr.com/photos/rampion/2863703051/ "Rampion 的椭圆，在 Flickr 上")

未旋转时，椭圆的长轴跨越了我的视口的宽度。当我围绕视线旋转 90 度时，椭圆的长轴现在跨越视口的高度，从而使椭圆变形（在这种情况下，使其看起来不那么偏心）。

[![旋转椭圆](https://farm4.static.flickr.com/3187/2863703073_24c6549d4b_m.jpg)](http://www.flickr.com/photos/rampion/2863703073/ "在 Flickr 上通过 rampion 旋转椭圆")

我需要做些什么来防止这种变形（或至少考虑它），所以围绕视线的旋转保留了椭圆的感知主轴（在这种情况下，导致它超出视口）？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-17T02:51:34.500

当您调用 gluPerspective() 时，您似乎使用 1.0 作为方面。您应该使用宽度/高度。例如，如果您的视口是 640x480，您将使用 1.33333 作为宽高比参数。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-17T02:53:25.807

根据OpenGL规范：

```
void gluPerspective( GLdouble fovy,
                     GLdouble aspect,
                     GLdouble zNear,
                   GLdouble zFar ) 
```

方面应该是您的窗口宽度和高度的函数。特别是宽度除以高度（但要注意除以零）。

也许您使用 1 作为不准确的方面，除非您的窗口是正方形。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-17T02:58:10.863

看起来您的 gluPerspective 调用中的 aspect 参数需要调整。请参阅[手册页](http://www.opengl.org/documentation/specs/man_pages/hardcopy/GL/html/glu/perspective.html)。如果您的窗口在物理上是方形的，则纵横比将为 1，您的问题就会消失。但是，您的窗口是矩形的，因此视锥体必须是非方形的。

将纵横比设置为 window_width / window_height，您的椭圆应该看起来正确。请注意，每当窗口调整大小时，您都需要更新它；如果您使用 GLUT 设置一个[glutReshapeFunc](http://developer.apple.com/documentation/Darwin/Reference/ManPages/man3/glutReshapeFunc.3.html)并在那里重新计算投影矩阵。

# sql - SQL 文本搜索和排序

> ID：79367
> 
> 赞同：2
> 
> 时间：2008-09-17T02:39:33.000
> 
> 标签：sql, search

我有一个查询：

```
SELECT *
FROM Items
WHERE column LIKE '%foo%'
   OR column LIKE '%bar%' 
```

我如何订购结果？

假设我有与“foo”匹配的行和与“bar”匹配的行，但我也有与“foobar”匹配的行。

如何对返回的行进行排序，以便第一个结果是匹配更多 LIKE 的结果？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-17T02:43:43.147

案例或 RDBMS 支持的条件构造是一种方法

```
select *, case when col like '%foo%' and col like '%bar%' then 2 end 
else 1 end as ordcol 
from items 
where col like '%foo%' or col like '%bar%' order by ordcol 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-17T02:48:10.577

```
SELECT * FROM Items WHERE column LIKE '%foo%' OR column LIKE '%bar%' 
ORDER BY 
(IF(column LIKE '%foo%',1,0) + IF(column LIKE '%bar%',1,0)) 
DESC 
```

if 的语法是

`IF ( condition, true_value, false_value )`

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-17T10:21:25.883

```
SELECT * FROM Items
WHERE col LIKE '%foo%'
    OR col LIKE '%bar%'
ORDER BY CASE WHEN col LIKE '%foo%' THEN 1
                WHEN col LIKE '%bar%' THEN 2
            END 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-17T02:47:08.987

您可以使用`UNION`：

```
SELECT * FROM Items WHERE column LIKE '%foo%' AND column LIKE '%bar%'
UNION
SELECT * FROM Items WHERE column LIKE '%foo%' AND NOT (column LIKE '%bar%')
UNION
SELECT * FROM Items WHERE column LIKE '%bar%' AND NOT (column LIKE '%foo%'); 
```

但这在性能方面可能很糟糕。更糟糕的是，我猜你想用它来构建一个搜索引擎，首先给出最有意义的结果，然后单词的数量不限制为 2。

在这种情况下，您可以创建一个`score`包含匹配数的列。像这样的东西：

```
SELECT
    *,
    (IF(column LIKE '%bar%', 1, 0) + IF(column LIKE '%foo%', 1, 0)) AS score
FROM Items
WHERE column LIKE '%foo%' OR column LIKE '%bar%'
ORDER BY score DESC; 
```

我的 SQL 有点生疏，但至少在 MySQL 5.0 中应该可以实现这样的操作。另请参阅该`IF`功能的手册：http: [//dev.mysql.com/doc/refman/5.0/en/control-flow-functions.html](http://dev.mysql.com/doc/refman/5.0/en/control-flow-functions.html)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-17T02:41:10.250

哪个数据库管理系统？

例如，它可以通过 CTE 或 Union 来完成，但如果你使用的是 MySQL，那么你可以忘记它。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-17T02:43:56.483

试试这个代码：

```
SELECT * FROM Items WHERE column LIKE '%foo%' OR column LIKE '%bar%'
order by (select count(*) from items i where i.column= item.column) DESC 
```

如果您不关心细节， 您也可以按`column`and分组。`count(*)``ORDER`

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-17T02:46:12.983

您可能想试一试：

```
SELECT *
FROM Items
WHERE column LIKE '%foo%' OR column LIKE '%bar%'
ORDER BY CASE WHEN column LIKE '%foo%' AND column LIKE '%bar%' THEN 1 ELSE 0 END DESC 
```

注意：这是干编码的，可能不是很便携。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-17T03:19:06.743

由于您的查询当前正在编写，WHERE 子句不会为您提供任何可用于对结果进行排序的信息。我喜欢[布赖恩的想法](https://stackoverflow.com/questions/79367/sql-text-searching-and-ordering#79380)；添加一个常量列并联合查询，您甚至可以在一个结果集中获得所有内容。例如：

```
SELECT 1 as rank, * FROM Items WHERE column LIKE '%foo%' AND column LIKE '%bar%'
UNION
SELECT 2 as rank, * FROM Items WHERE column LIKE '%foo%' AND column NOT LIKE '%bar%'
UNION
SELECT 2 as rank, * FROM Items WHERE column LIKE '%bar%' AND column NOT LIKE '%foo%'
ORDER BY rank 
```

但是，这只会给你这样的东西：

*   匹配 foo 和匹配 bar 的所有行的无序集
*   后面是（无序集）与 foo 或 bar 匹配的所有行，但不能同时匹配两者（尽管您可以在最后一个 SELECT 语句中使用不同的常量将其分成两个单独的组）。

这可能正是您要查找的内容，但它不会告诉您哪些行匹配 foo 三次，或者将它们排在仅包含一个 foo 实例的行之前。此外，所有这些 LIKE 都会变得昂贵。如果您真正想做的是根据相关性（无论您如何定义）对结果进行排序，那么最好使用全文索引。如果你使用的是 MS SQL Server，它有一个内置的服务可以做到这一点，也有第三方产品可以做到这一点。

编辑：在查看了所有其他答案之后（当我开始我的时候只有*两个*- 我显然必须学会更快地思考;-)）很明显有几种方法可以解决这个问题，具体取决于你想要完成的事情。我建议您根据解决方案**在您的系统上的表现来测试和比较解决方案**. 我不是性能/调优专家，但函数往往会减慢速度，尤其是在您对函数的结果进行排序时。LIKE 运算符也不一定是敏捷的。作为开发人员，使用“IF”和“CASE”等熟悉的结构似乎很自然，但是使用更多基于集合的方法的查询通常在 RDMS 中具有更好的性能。同样，YMMV，所以最好测试一下你是否完全关心性能。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-17T02:55:53.583

2个查询：

```
SELECT * FROM Items WHERE column LIKE '%foo%' AND column LIKE '%bar%';

SELECT * FROM Items WHERE (column LIKE '%foo%' AND column NOT LIKE '%bar%') OR (column NOT LIKE '%foo%' AND LIKE '%bar%')
```

（SQL 中没有异或）

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-17T03:00:04.073

并非所有 RDBMS 都支持 IF（或 Oracle 中的 DECODE）语句。如果不是，您可以使用子查询来定义表“a”并搜索所有员工的名为 JO SMITH 或组合。

```
SELECT 
 a.employee_id,
 a.surname,
 sum(a.counter)
FROM

 (SELECT
   employee_id,
   surname,
   1 as counter
  FROM
   MyTable
  WHERE
   surname like '%SMITH%'

  UNION ALL

  SELECT
   employee_id,
   surname,
   1 as counter
  FROM
   MyTable
  WHERE
   surname like '%JO%'
   ) a

GROUP BY 
 a.employee_id,
 a.surname
ORDER BY 3,1,2 
```

确保你使用 UNION ALL 否则它将不起作用。您也可以使用 UPPER() 使您的搜索不区分大小写。

# browser - 通过不同的端口访问网站？

> ID：79381
> 
> 赞同：22
> 
> 时间：2008-09-17T02:41:53.820
> 
> 标签：browser, ports

我想从不同于 80 或 8080 的端口访问网站。这可能吗？我只想通过不同的端口查看该网站。我没有路由器。我知道这是可以做到的，因为我有一个可以通过不同端口访问网站的浏览器，Xero Bank 称为 XB Browser。

* * *

感谢您的回答。因此，如果我在一台计算机上设置代理，我可以让它从我的计算机转到另一台计算机，然后将网站返回给我。这会绕过日志记录软件吗？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-09-17T02:46:08.147

如果您的问题是关于 IIS（或其他服务器）配置 - 是的，这是可能的。您只需在默认站点或虚拟目录下创建端口映射，并将特定端口分配给您需要的站点。例如，它有时对 Web 服务非常有用，当默认端口分配给某些 UI 前端并且您希望将服务分配给相同的地址但具有不同的端口时。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2011-01-07T23:25:00.240

一个简单的方法是访问[http://websitename.com:174](http://websitename.com:174)，您将通过不同的端口进入。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-09-17T02:53:55.867

您可以使用 ssh 将端口转发到其他地方。

如果您有两台计算机，一台用于浏览，另一台可免费访问网站且未登录（即您拥有它并且它坐在家里），那么您可以在它们之间建立一个隧道来转发 http 流量超过。

例如，我使用 ssh 通过端口转发从工作中连接到我的家庭计算机，如下所示：

```
ssh -L 22222:<target_website>:80 <home_computer> 
```

然后我可以将浏览器指向

```
http://localhost:22222/ 
```

这个请求将通过 ssh 转发。由于工作电脑是先联系家用电脑，再联系目标网站，所以很难登录。

但是，这一切都涉及“如何绕过网络代理”等，我建议您创建一个新问题，询问您到底想做什么。

IE。“我如何绕过网络代理来避免我的流量被记录？”

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-17T02:43:39.120

不，因为服务器决定它在哪个端口上运行。也许你可以安装一个代理，它会重定向端口，但最终连接会在你的机器上的端口 80 上建立。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-17T02:44:46.823

您可以在任何端口上运行 Web 服务器。80 与 8080（非特权端口上的 Web 服务器）和 443（Web 服务器 + ssl）一样只是约定。但是，如果您希望通过将浏览器指向不同的端口来查看某个网站，那么您可能不走运。除非 Web 服务器明确地在该端口上运行，否则您只会收到一条错误消息。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-17T02:49:50.930

这取决于。

另一端的 Web 服务器将设置为某个端口，通常为 80，并且只接受该特定端口上的请求。链条上的某些东西需要与网站的 80 端口通信。

如果您控制网站，那么您可以更改端口，或让它接受多个端口上的请求。

如果网站已经在使用不同的端口，您可以使用冒号语法来引用另一个端口（例如： [http](http://server.com:1234) ://server.com: 1234 表示端口 1234）。

如果您想在客户端使用不同的端口，但又想与 Web 服务器端的端口 80 通信，则需要将流量从端口 x 路由到端口 80。启动并运行此端口的常用方法是使用端口转发。ssh 可以为您执行此操作，请参见[此处](http://www.securityfocus.com/infocus/1816)了解 Unix/技术概述，或者如果您使用的是 Windows ，请参见[此处。](http://www.cs.uu.nl/technical/services/ssh/putty/puttyfw.html)

希望有帮助。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-17T02:43:26.627

在查看网站时，它被分配了一个随机端口，它总是来自端口 80（通常总是，除非服务器管理员更改了端口），除非您可以控制服务器，否则其他人无法更改该端口。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-17T02:43:38.433

如果网站服务器正在侦听不同的端口，那么可以，只需使用[http://address:port/](http://address:port/)

如果服务器没有监听不同的端口，那么显然你不能。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-17T02:44:06.263

除非您通过代理浏览，否则托管您要访问的站点的 Web 服务器必须配置为侦听 80 或 8080 以外的端口。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-17T02:44:48.807

也许这很明显，但 FWIW 仅当 Web 服务器在备用端口上为该网站提供请求时才有效。网络服务器仅在端口 80 上服务站点的情况并不少见。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-17T02:45:03.983

您只能通过与 http 服务器绑定的端口访问网站。示例：我有一个 Web 服务器，它正在侦听端口 123 上的连接，你只能让我的页面连接到我的 123 端口。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-17T02:51:15.047

为了澄清之前的答案，HTTP 协议在端口 80 上“注册”，而基于 SSL 的 HTTP（又名 HTTPS）在端口 443 上注册。

[IANA 记录了](http://www.iana.org/assignments/port-numbers)众所周知的端口号。

如果您的意思是 Web 服务器上的“绕过日志记录软件”，则不会。至少，它会通过代理系统的 IP 地址看到来自您的流量。如果您试图规避 IT 部门实施的控制，那么您需要重新考虑这一点。如果您的 IT 部门阻止任何出站端口 80、8080 或 443 的流量，那是有原因的。询问您的 IT 主管。如果您需要从本地工作站访问这些出站端口来完成您的工作，请使用它们。

安装代理服务器或使用免费代理服务可能违反公司政策，并可能使您的工作面临风险。

# operating-system - 什么是循环调度？

> ID：79389
> 
> 赞同：14
> 
> 时间：2008-09-17T02:43:34.567
> 
> 标签：operating-system, computer-science, scheduler

在多任务操作系统上下文中，有时您会听到术语循环调度。它指的是什么？
还有什么其他类型的调度？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-09-17T02:47:44.010

**循环调度**

如果您是 100 位客人的聚会的主人，循环调度意味着您为每位客人花费 1 分钟（固定金额）。您一个接一个地检查每位客人，100 分钟后，您将与每位客人共度 1 分钟。更多关于[维基百科](http://en.wikipedia.org/wiki/Round-robin_scheduling "循环调度")。

还有许多其他类型的调度，例如基于优先级（即最重要的人优先）、先到先服务、最早截止日期优先（即最早离开的人）等。您可以通过谷歌搜索开始用于调度算法或[在 Wikipedia 上](http://en.wikipedia.org/wiki/Scheduling_algorithm "scheduling algorithms")查看调度

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-17T15:03:50.667

时间片是实践中任何循环调度系统所固有的，AFAIK。

我不同意 InSciTek Jeff 的暗示，即以下*是*循环调度：

> 也就是说，轮询轮换中具有相同优先级的每个任务都可以被允许运行，直到它们达到资源阻塞条件，然后才让步给轮换中的下一个任务。

我不明白这怎么能被认为是循环。这实际上是抢占式调度。但是，可以有一个调度算法，它同时包含循环调度和抢占调度的元素，如果同时启用循环调度和抢占（默认禁用循环），VxWorks 就会这样做。*启用循环调度的方法是在kernelTimeSlice*中提供一个非零值。

我同意这个说法：

> 因此，虽然基于时间片的调度意味着轮询调度，但轮询调度不需要基于相等时间的时间片。

你是对的，它不需要相同的时间。抢占可以解决这个问题。实际上在 VxWorks 中，如果在循环调度期间任务被抢占，当任务再次获得控制权时，它将在分配的剩余时间内执行。

针对 InSciTek Jeff 的编辑（我没有评论权限）是的，我指的是任务锁定/中断禁用，尽管我显然没有很好地表达。你的第二条评论抢先了我（哈！）。我希望讨论更重要的一点，即您相信循环调度可以在没有时间切片的情况下存在。还是您只是指基于相等时间的时间切片？我不同意前者，但同意后者。我渴望学习。谢谢。

Edit2 针对 Jeff：

> 轮询可以在没有时间片的情况下存在。这正是禁用 kernelTimeSlice（零）时 VxWorks 中发生的情况。

我不同意这种说法。请参阅[本文档](http://www.slac.stanford.edu/exp/glast/flight/sw/vxdocs/vxworks/guide/c-basic.html)第 2.2.3 节，其标题为 Round-Robin Scheduling。

> 循环调度使用时间片来实现 CPU 公平分配给具有相同优先级的所有任务。在一组具有相同优先级的任务中，每个任务在定义的时间间隔或时间片内执行。通过调用 kernelTimeSlice( ) 启用循环调度，它接受时间片或间隔的参数。[...] 如果启用了循环调度，并且为正在执行的任务启用了抢占，则系统滴答处理程序会增加任务的时间片计数。

时间片是循环调度中固有的。否则，您将依靠任务放弃 CPU 控制权，而循环调度旨在解决此问题。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-17T13:40:38.403

这里的答案甚至 Wikipedia 文章都描述了循环调度，以固有地包括周期性时间片。虽然这很常见，但我认为循环调度和时间片***并不***完全相同。当然，为了使时间片有意义，轮询调度在轮换到每个任务时是隐含的，但是您可以在没有时间片的情况下进行循环调度。也就是说，轮询轮换中具有相同优先级的每个任务都可以被允许运行，直到它们达到资源块条件，然后才让轮换中的下一个任务运行。换句话说，当存在相同优先级的任务时，重新调度点***不是***时间抢先的。

上面的想法实际上是专门在风河的VxWorks内核的情况下实现的。在他们的优先级方案中，每个优先级的任务循环运行，但如果没有在内核中专门启用该功能，则不会进行时间切片。这种灵活性的原因是为了避免时间片任务的开销，这些任务已知会在有界的时间内运行到一个块中。

因此，虽然基于时间片的调度意味着轮询调度，但轮询调度不需要基于相等时间的时间片。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-05-23T12:35:05.390

一个观点。似乎我们正在将两种机制交织在一起。假设仅 OP 的原始断言“在多任务操作系统上下文中”然后

1 - 循环调度程序总是调度循环队列中的下一个项目。

2 - 调度程序如何重新获得控制以执行调度是独立且不相关的。

I don't disagree that the most prevalent method for 2 is time-slicing / yield waiting for resource, but as has been noted there are others. If I am not mistaken the first Mac's didn't utilize time-slicing, they used voluntary yield / yield waiting for resource (20+ year old brain cells can be wrong sometimes;).

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-17T02:48:13.277

轮询是一种简单的调度算法，其中时间在没有优先级的作业之间平均分配。

例如 - 如果您有 5 个进程正在运行 - 每个进程将被允许运行 1/5 单位时间，然后才允许另一个进程运行。循环法通常很容易在操作系统中实现。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-04-09T07:12:21.097

实际上，您对抢占式调度和循环法感到困惑。Infact RR 是抢占式调度的一部分。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2017-02-16T14:41:35.990

循环调度基于时间共享，也称为量子（CPU 一次性给予任何进程的最大时间）。队列中有多个进程（需要不同的时间来完成，也就是突发时间），CPU 必须全部处理它们，因此它不断在进程之间切换，以根据量子值为每个进程提供相等的时间。这种类型的调度称为循环调度。查看这个简单的视频以轻松了解循环调度：[https ://www.youtube.com/watch?v=9hw-_qJ55K4](https://www.youtube.com/watch?v=9hw-_qJ55K4)

# monitoring - 应用程序健康监控系统有哪些要求？

> ID：79415
> 
> 赞同：11
> 
> 时间：2008-09-17T02:45:41.423
> 
> 标签：monitoring, health-monitoring

应用程序运行状况监控系统至少应该为您（开发人员）和/或您的老板（IT 经理）和/或运营（待命）员工做什么？

除了最低要求，它还应该做什么？

监控“基础设施”应用程序（ms-exchange、apache 等）是否足够，或者是否还需要监控单个用户应用程序、网站和数据库？

如果是后者，您需要了解它们的哪些信息？

附录：感谢您的意见，我真的在寻找应用程序级监控而不是基础设施监控，但很高兴了解两者

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-09-17T02:51:12.317

*   应用程序是否正在运行。
*   cpu/内存/网络使用异常。
*   报告任何未处理的异常。
*   各种模块的状态（如果适用）。
*   外部组件（数据库、Web 服务、文件服务器等）的状态
*   待处理的后台任务数（如果适用）。
*   也许跟踪应用程序的使用情况并报告使用最多/最少使用功能的统计信息，以便您了解优化在哪些方面最有益。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-17T02:51:23.080

答案是“视情况而定”。为什么需要监控？您的运营人员有多大？你需要报告吗？应用环境是什么？谁在乎申请是否失败？谁在乎是否发生异常？是否有任何错误可恢复？我可以问这样的问题很长时间。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-17T02:54:55.710

这是一个开放式问题，但我将从物理测量开始。
1\. 我认为托管此站点的所有机器都可以 ping 通吗？
2.所有应该提供内容的机器实际上都在提供一些内容吗？（理想情况下，这将来自外部网络。）
3\. 每台机器上的每个预期服务是否正在运行？
3a。这些服务最近有运行吗？
4、每台机器是否有剩余硬盘空间？（别忘了db）
5\. 这些机器有备份吗？最后一次是什么时候？

一旦制定了系统的物理监控，就可以解决特定于系统的问题吗？

1\. 自动化脚本可以登录吗？花了多长时间？
2\. 有多少用户在直播？是否添加了一百万个虚假帐户？
......
这类问题变得更加模糊，并且可能非常特定于系统。当响应物理测量时，它们通常也可以被动地推导出来。硬盘满了，也许是因为一堆代理创建了太多假用户，所以网络服务器日志被填满了。那种事。

虽然 A 计划不一定是被动的，但它是许多站点设置监控系统的方式。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-08-27T14:04:18.717

好问题。

前段时间我们一直在寻找一些应用级监控解决方案来满足我们的需求，但没有任何运气。流行的监控解决方案主要用于监控基础设施 - 在我看来 - 它们对于大多数中小型公司的要求来说太复杂了。

我们需要（主要）以下功能：

*   警报 - 我们想尽快了解事件
*   无痛管理 - 托管服务将是最好的
*   可视化——很高兴知道发生了什么并从数据中获取一些知识

因为我们没有找到合适的解决方案，所以我们开始编写自己的解决方案。最后，我们以名为[AlertGrid](http://alert-grid.com)的启动和运行服务结束。（您当然可以免费查看。）

它背后的想法是提供一种简单的方法来处理自定义监控场景。集成 API 非常简单（一个函数有两个必需参数）。目前，我们和其他人将其用于：

*   监控计划任务（cron 作业）
*   监控整个应用程序逻辑执行
*   应用程序错误警报
*   我们还在研究使用 AlertGrid 进行基本基础设施监控的示例

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-17T02:49:52.850

最低要求：确保它正在运行:)

但是，其他一些东西会非常有用。例如，CPU 负载、RAM 使用率以及（在多用户系统中）哪个用户正在运行什么。此外，对于访问网络的应用程序，每个应用程序的网络连接列表。而且（如果您可以访问客户端计算机）能够看到应用程序的“窗口标题”会很酷 - 如果它更改并保存它，可能每 2-3 分钟检查一次。此外，应用程序打开的文件列表可能非常有用，但这不是必须的。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-17T02:53:23.293

我认为这相当简单 - 监控，以便在出现问题之前尽早警告您。这意味着监控依赖关系和应用程序本身。

如果您不打算提供有关您正在监视的应用程序的详细信息，那么很难提供细节，所以我会说将其用作一般规则。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-17T02:57:08.807

至少您想知道系统是否健康。这在定义您的系统是否健康方面是主观的。是否计算机已启动，是否存在所需资源，数据是否正在流经系统，数据是否正确产生结果等等。

在我的项目中，我们对其中的大部分进行监控，然后再进行一些监控。它真的归结为您可以用来分析一切正常的最高级别。在我们的例子中，我们需要知道数据输出。如果您只需要知道这些机器是否正常运行，那么您就无需尝试向没有经验的最终用户展示问题所在。

如果您对数据结果过于努力，也有一些“现成的”工具可以为您完成很多艰苦的工作。当我环顾四周时，我特别喜欢[Nagios](http://www.nagios.org/)，但我们需要的不仅仅是它可以轻易展示的东西，所以我编写了自己的监控系统。基本上我们还会观察系统中的“特殊性”、内存/cpu 峰值等......

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-11-13T05:30:14.703

感谢大家的投入，我真的在寻找应用程序级监控而不是基础设施监控，但很高兴了解两者

区别在于：

*   基础设施监控将是服务器加上 MS Exchange Server、Apache、IIS 等
*   应用程序监控将是用户机器和他们用来完成工作的特定程序，和/或服务器以及他们运行以保持数据流动的数据移动/后端应用程序

有时很难划清界限——过于简单的定义可能是“如果你的团队编写了它，它就是一个应用程序；如果你买了它，它就是基础架构”

我认为在实践中最好同时监控两者

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2010-06-17T23:17:30.820

您需要做的是分解应用程序的业务流程，然后让软件在主要业务组件上发出事件。此外，您需要创建端到端合成交易（例如，模拟最终用户点击网站）。所有这些数据都将被输入监控工具。过去，我为流入 Tivoli Monitoring 的 JMX 适配器的应用程序完成了 JMX，然后我完成了实现“假用户”的脚本，然后将结果通过管道输入到 Tivoli Monitoring 的脚本适配器中。Tivoli Monitoring 获取数据，然后根据该原始数据创建应用程序运行状况和性能图表。

# visual-studio - Visual Studio 2005：请停止在“设计模式”中打开我的 CS 文件！

> ID：79434
> 
> 赞同：9
> 
> 时间：2008-09-17T02:48:42.727
> 
> 标签：visual-studio, designer

我认为它将我的 Web 服务的 CS 文件与相关的 ASMX 文件相关联。但无论发生什么，我都无法双击打开 CS 文件——我必须“查看代码”，否则它会在设计器中打开。

有人知道如何关闭这种自动行为吗？我只想编辑代码！

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-09-17T20:20:55.740

尝试右键单击，选择“打开方式...”，标记“CSharp 编辑器”并选择“设置为默认值”。

这适用于避免 WinForms 设计器。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-03T15:20:47.617

我在尝试处理类似问题时发现了这个问题。我在一个文件中有一个 C# 类，每当我双击该文件时，它都会尝试以设计模式打开，但设计模式对这个类毫无意义。我只想看代码。

我发现将 [System.ComponentModel.DesignerCategory("")] 属性添加到我的类修复了这个问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-17T02:51:40.210

在解决方案资源管理器视图中，单击“显示所有文件”图标。这将在您的每个文件旁边放置“+”符号。单击 + 它将展开以显示包含 ASMX 代码的 .CS 文件。此时，请双击该文件。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-17T03:10:58.307

出于某种原因，VS2005 在 Web 服务方面似乎有点倒退。要在代码视图中打开 Web 服务，请双击 .asmx 文件，而不是 .asmx.cs 文件。

我想这有点道理，因为在涉及 Web 服务时没有什么可“设计”的，但如果您一直在使用 .aspx 文件，那就违反直觉了。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-07-01T16:59:29.490

**根据我的经验，如果您在解决方案资源管理器**中双击文件时发现已写入的编辑器（即非默认编辑器）正在打开，那么基础项目的**用户选项**文件 (.user) 或解决方案的**用户选项**文件 (.suo)。（我不确定是哪个，但我怀疑设置存储在 .suo 文件中。）删除 .suo 和所有项目 .user 文件解决了问题。

我个人在项目开始时将**表单编辑器**设置为我的默认表单编辑器。在表单稳定并且需要较少的用户界面设计更改后，我切换了默认编辑器。

# ruby-on-rails - 哪个 Rails 插件最适合基于角色的权限？（请为每个答案提供一项提名）

> ID：79438
> 
> 赞同：5
> 
> 时间：2008-09-17T02:49:47.233
> 
> 标签：ruby-on-rails

我需要为我的 Rails 应用程序添加基于角色的权限，并且想知道有哪些最好的插件可供研究。我目前正在使用 RESTful 身份验证插件来处理用户身份验证。为什么你建议的插件比其他插件更好？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-11-09T10:29:10.090

我必须推荐easy_roles。它的重量超轻，不需要额外的桌子等。

[http://github.com/platform45/easy_roles](http://github.com/platform45/easy_roles)

[http://gemcutter.org/gems/easy_roles](http://gemcutter.org/gems/easy_roles)

但是角色身份验证绝对取决于站点。不同的角色授权插件适合不同的站点。

如果您觉得 easy_roles 不适合您的需求，请查看：

[http://ruby-toolbox.com/categories/rails_authorization.html](http://ruby-toolbox.com/categories/rails_authorization.html)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-17T02:51:57.337

我使用并且非常喜欢 role_requirement： [http ://code.google.com/p/rolerequirement/](http://code.google.com/p/rolerequirement/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-17T08:00:53.930

我们也将 role_requirement 放入[Bort](http://github.com/fudgestudios/bort/tree/master)，因为它可能是目前最好的解决方案。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-18T15:08:26.077

我是一个非常满意的 ACL 用户

[http://agilewebdevelopment.com/plugins/acl_system](http://agilewebdevelopment.com/plugins/acl_system)

试试吧！

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-18T16:04:09.453

我推荐[Rails Authorization](http://blog.gingertech.net/2008/05/21/rails-authorization-plugin/)，它可以很好地与 Restful Authentication 一起使用。

# c# - 来自实时音频输入的每分钟节拍数

> ID：79445
> 
> 赞同：43
> 
> 时间：2008-09-17T02:51:13.970
> 
> 标签：c#, audio, signal-processing

我想编写一个简单的 C# 应用程序来监视线路输入音频并给我当前（好吧，滚动平均）每分钟节拍。

我看过[这篇 gamedev 文章](http://www.gamedev.net/page/resources/_/technical/math-and-physics/beat-detection-algorithms-r1952)，这绝对没有帮助。我经历并试图实施他正在做的事情，但它只是没有用。

我知道必须有大量的解决方案来解决这个问题，因为很多 DJ 软件都可以做到，但我没有找到任何开源库或自己做的说明。

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-09-17T10:06:17.153

使用滑动窗口 FFT 计算功率谱： 取 1024 个样本：

```
double[] signal = stream.Take(1024); 
```

将其输入 FFT 算法：

```
double[] real = new double[signal.Length];
double[] imag = new double[signal.Length);
FFT(signal, out real, out imag); 
```

你会得到一个实部和一个虚部。不要扔掉虚部。对实部和虚部做同样的事情。虽然虚部确实与实部异相 pi / 2，但它仍然包含 50% 的频谱信息。

编辑：

计算功率而不是幅度，这样当它响亮时你有一个高数字，当它安静时接近零：

```
for (i=0; i < real.Length; i++) real[i] = real[i] * real[i]; 
```

虚部也是如此。

```
for (i=0; i < imag.Length; i++) imag[i] = imag[i] * imag[i]; 
```

现在您有了最后 1024 个样本的功率谱。其中频谱的第一部分是低频，频谱的最后一部分是高频。

如果您想在流行音乐中找到 BPM，您可能应该专注于低音。您可以通过对功率谱的较低部分求和来获得低音强度。使用哪些数字取决于采样频率：

```
double bassIntensity = 0;
for (i=8; i < 96; i++) bassIntensity += real[i]; 
```

现在再次执行相同操作，但在计算新光谱之前将窗口移动 256 个样本。现在你最终计算了每 256 个样本的 bassIntensity。

这对于您的 BPM 分析来说是一个很好的输入。当低音很安静时，你没有节拍，当它响亮时，你有节拍。

祝你好运！

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-09-17T09:30:33.947

有一个名为 Dancing Monkeys 的优秀项目，它通过音乐程序生成 DDR 舞步。它所做的大部分工作都是基于（必须非常准确）节拍分析，他们的项目论文详细描述了各种节拍检测算法及其对任务的适用性。它们包括对每种算法的原始论文的引用。他们还为他们的解决方案发布了 matlab 代码。我敢肯定，在这些之间你可以找到你需要的东西。

这一切都在这里： http: [//monket.net/dancing-monkeys-v2/Main_Page](http://monket.net/dancing-monkeys-v2/Main_Page)

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-09-17T03:04:18.120

并不是说我知道如何实现这一点，而是从音频工程的角度来看，您需要先进行过滤。低音鼓击打将是第一个检查。一个低通滤波器可以为您提供低于 200Hz 的任何内容，应该可以为您提供非常清晰的低音鼓画面。可能还需要一个门来清除来自其他具有如此低谐波的乐器的杂波。

接下来要检查的是军鼓命中。你必须均衡这个。军鼓发出的“裂纹”大约是记忆中的 1.5kHz，但你肯定需要对它进行门控。

下一个挑战是为时髦的节拍制定算法。您将如何以编程方式找到节拍 1？我想您会跟踪以前的节拍并使用匹配某事或其他内容的模式。因此，您可能需要几个小节才能准确找到节拍。然后是 4/4、3/4、6/8 之类的时间问题，哇，我无法想象要准确地做到这一点需要什么！我相信这对音频硬件/软件公司来说是值得的。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-09-17T02:57:55.437

这绝不是一个容易的问题。我会尽量给你一个概述。

您可以执行以下操作：

1.  计算信号在 5 毫秒内的平均（均方根）响度。（以前从未这样做过，我不知道一个好的块大小是多少。）
2.  使用 FFT 算法对“阻塞”信号进行傅里叶变换。
3.  找到变换后信号中幅度最大的分量。

傅里叶变换基本上是一种计算信号中所有频率强度的方法。如果您对“阻塞”信号执行此操作，则节拍的频率有望成为最强的频率。

也许您需要先应用一个过滤器，以专注于通常包含有关 BPM 的最多信息的特定频率（如低音）。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2012-04-26T23:19:55.163

我发现这个库似乎有一个非常可靠的实现来检测**Beats per Minute**。 [https://github.com/owoudenberg/soundtouch.net](https://github.com/owoudenberg/soundtouch.net)

它基于[http://www.surina.net/soundtouch/index.html](http://www.surina.net/soundtouch/index.html)，在很多 DJ 项目中使用[http://www.surina.net/soundtouch/applications.html](http://www.surina.net/soundtouch/applications.html)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-11-18T20:45:35.897

首先，Hallgrim 产生的不是功率谱密度函数。任何信号的统计周期都可以通过自相关函数得出。自相关信号的傅立叶变换是功率谱密度。PSD 中除 0 Hz 以外的主要峰值将对应于信号中的有效周期性（以 Hz 为单位）...

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-20T21:44:14.710

最简单的方法是让用户按照节拍的节奏点击一个按钮，然后计算点击次数除以时间。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2015-03-08T10:46:10.560

我建议查看 BASS 音频库和 BASS.NET 包装器。它有一个内置的 BPMCounter 类。

此特定功能的详细信息可在 [http://bass.radio42.com/help/html/0833aa5a-3be9-037c-66f2-9adfd42a8512.htm](http://bass.radio42.com/help/html/0833aa5a-3be9-037c-66f2-9adfd42a8512.htm)中找到。

# .net-3.5 - .NET 3.5 SP1 对 ASP.NET 的更改

> ID：79451
> 
> 赞同：0
> 
> 时间：2008-09-17T02:51:44.797
> 
> 标签：.net-3.5

我想在我的开发服务器中测试新的 SP1，然后为我的生产服务器安装它。但我想知道它对 ASP.NET 部分有什么特别的增强，因为那是我担心的地方。

我阅读了在 SP1 下载页面中找到的文档，但它对我来说有点太笼统了，在 ASP.NE 部分上并不多。有人对此有任何线索吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-17T02:58:58.960

[http://weblogs.asp.net/scottgu/archive/2008/05/12/visual-studio-2008-and-net-framework-3-5-service-pack-1-beta.aspx](http://weblogs.asp.net/scottgu/archive/2008/05/12/visual-studio-2008-and-net-framework-3-5-service-pack-1-beta.aspx)

那里有一个关于 Web 开发改进的部分。它也可能含糊不清，但有指向视频和更多信息的链接。我建议检查一下。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-17T02:59:08.973

短名单：

ASP.NET：动态数据现在包含在 .Net 3.5 中，所有必要的 VS 项目模板也可用 ASP.NET：添加了历史支持。现在，我们可以以非常简单的方式控制按下后退/前进按钮上的 AJAX 页面行为，这在之前在 MS 演示 ASP.NET 中显示：添加了脚本组合功能以减少请求数量并改善页面加载时间。在此之前，我们对结合 VS2008 的客户端脚本使用自定义方法：添加了对 JavaScript 代码格式化和 Intellisense 的更丰富的支持，尤其是对于单独的 .js 文件

更多博客：[http ://dimarzionist.wordpress.com/2008/05/13/full-list-of-changes-in-sp1-beta/](http://dimarzionist.wordpress.com/2008/05/13/full-list-of-changes-in-sp1-beta/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-17T03:02:48.827

请查看这篇文章：[隐藏的宝石 - 不一样的旧 3.5 SP1 帖子](http://www.hanselman.com/blog/PermaLink.aspx?guid=54292847-2b74-4f6d-a380-a65b25993b6c)

它详细介绍了 SP1 中的一些小改进。它还链接到 Scott Guthrie 关于 SP1 的文章。

根据我的经验，升级进展顺利。我在一个 AJAX 编码不佳的网站上遇到了一个问题 - 没什么大不了的。

*   罗恩

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-17T03:14:13.290

老实说，我从 SP1 中看到的唯一真正的改进是因为我一直没有寻找具体的改进，它现在将从项目中的所有文件中读取您的 TODO 和 HACK 任务，而不仅仅是打开的文件。不过，该特定功能很有用。

# python - 测试 GUI 代码：我应该使用模拟库吗？

> ID：79454
> 
> 赞同：8
> 
> 时间：2008-09-17T02:52:58.007
> 
> 标签：python, unit-testing, user-interface, tdd

最近，我在用 Python 开发 GUI 应用程序时一直在试验 TDD。我发现有测试来验证我的代码的功能是非常令人放心的，但是遵循一些 TDD 的推荐实践是很棘手的。也就是说，首先编写测试很困难。而且我发现很难让我的测试可读（由于大量使用模拟库）。

我选择了一个名为[mocker](http://labix.org/mocker)的模拟库。我经常使用它，因为我正在测试的大部分代码都会调用（a）我的应用程序中依赖于系统状态的其他方法或（b）没有事件循环就无法存在的 ObjC/Cocoa 对象等。

无论如何，我有很多看起来像这样的测试：

```
def test_current_window_controller():
    def test(config):
        ac = AppController()
        m = Mocker()
        ac.iter_window_controllers = iwc = m.replace(ac.iter_window_controllers)
        expect(iwc()).result(iter(config))
        with m:
            result = ac.current_window_controller()
            assert result == (config[0] if config else None)
    yield test, []
    yield test, [0]
    yield test, [1, 0] 
```

请注意，这实际上是三个测试；都使用相同的参数化测试功能。这是正在测试的代码：

```
def current_window_controller(self):
    try:
        # iter_window_controllers() iterates in z-order starting
        # with the controller of the top-most window
        # assumption: the top-most window is the "current" one
        wc = self.iter_window_controllers().next()
    except StopIteration:
        return None
    return wc 
```

我在使用 mocker 时注意到的一件事是，首先编写应用程序代码然后再返回编写测试更容易，因为大多数时候我都在模拟许多方法调用和编写模拟的语法调用比应用程序代码更冗长（因此更难编写）。编写应用程序代码并以此为基础对测试代码进行建模会更容易。

我发现使用这种测试方法（以及一些纪律），我可以轻松编写具有 100% 测试覆盖率的代码。

我想知道这些测试是否是好的测试？当我最终发现编写好测试的秘诀时，我会后悔这样做吗？

我是否违反了 TDD 的核心原则，以至于我的测试是徒劳的？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-17T04:33:46.390

**如果您在编写代码并使其通过之后再编写测试，那么您并没有进行 TDD**（您也没有从测试优先或测试驱动开发中获得任何好处。查看 SO questions 以获取有关 TDD 的权威书籍)

> 我在使用 mocker 时注意到的一件事是，首先编写应用程序代码然后再返回编写测试更容易，因为大多数时候我都在模拟许多方法调用和编写模拟的语法调用比应用程序代码更冗长（因此更难编写）。编写应用程序代码并以此为基础对测试代码进行建模会更容易。

当然，它更容易，因为您只是在通过使用特定类型的画笔将天空涂成橙色后测试天空是否为橙色。这是改造测试（为了自信）。模拟很好，但你应该知道如何以及何时使用它们 - 就像谚语所说的“当你有一把锤子时，一切看起来都像钉子” 写一大堆不可读和没有帮助的东西也很容易- 是测试。花在了解测试内容上的时间是浪费的时间，可用于修复损坏的测试。

重点是：

*   阅读[Mocks are not stubs -](http://martinfowler.com/articles/mocksArentStubs.html#ClassicalAndMockistTesting)如果您还没有的话，请阅读 Martin Fowler。谷歌出一些好的[ModelViewPresenter](http://martinfowler.com/eaaDev/ModelViewPresenter.html)模式 GUI 的文档实例（如有必要，假/模拟 UI）。
*   研究您的选择并明智地选择。我会扮演那个在你左肩上戴着白色光环的人说“不要这样做”。阅读这个问题，了解[我的原因](https://stackoverflow.com/questions/59195/how-are-mocks-meant-to-be-used)- 圣贾斯汀在你的右肩上。相信他也有话要说：）

* * *

## 回答 #2

> 赞同：-2
> 
> 时间：2008-09-17T03:30:19.070

当您重构代码（即完全重写或移动模块）时，单元测试非常有用。只要在进行重大更改之前进行单元测试，您就会有信心在完成时没有忘记移动或包含某些内容。

* * *

## 回答 #3

> 赞同：-3
> 
> 时间：2008-09-17T11:08:17.270

**请记住，TDD 不是灵丹妙药。**这很难，应该很难，而且“提前”编写模拟测试尤其困难。

所以我会说——做对你有用的事。即使它不是“经过认证的 TDD”。我基本上做同样的事情。

您可能希望为位于控制器代码和 GUI 库代码之间的 GUI 提供自己的 API。这可能更容易模拟，或者您甚至可以添加一些测试挂钩。

最后但并非最不重要的一点是，您的代码对我来说看起来并不太难读。使用模拟的代码通常更难理解。幸运的是，Python 中的模拟比其他语言更容易、更干净。

# javascript - 如何选择与过滤器匹配的连续元素

> ID：79455
> 
> 赞同：7
> 
> 时间：2008-09-17T02:53:06.557
> 
> 标签：javascript, jquery

给定这个例子：

```
<img class="a" />
<img />
<img class="a" />
<img class="a" id="active" />
<img class="a" />
<img class="a" />
<img />
<img class="a" /> 
```

*（我刚刚使用了 img 标签作为示例，这不是我的代码中的内容）*

使用 jQuery，您将如何选择与 #active 相邻的类为“a”的 img 标签（在本例中为中间四个）？

您可以通过遍历所有以下和前面的元素来相当容易地做到这一点，当过滤条件失败时停止，但我想知道 jQuery 是否可以原生？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-17T05:30:03.387

这就是我最后想出的。

```
// here's our active element.
var $active = $('#active');

// here is the filter we'll be testing against.
var filter = "img.a";

// $all will be the final jQuery object with all the consecutively matched elements.
// start it out by populating it with the current object.
var $all = $active;

for ($curr = $active.prev(filter); $curr.length > 0; $curr = $curr.prev(filter)) {
    $all = $all.add($curr);
}
for ($curr = $td.next(filter); $curr.length > 0; $curr = $curr.next(filter)) {
    $all = $all.add($curr);
} 
```

对于后续问题，我可以看到如何通过将其变成一个带有两个参数的函数来轻松概括它：一个初始元素和一个过滤器字符串 - 任何人都可以指出正确的方向以找出如何扩展jQuery对象添加这样的功能？

* * *

**编辑**：从那以后，我发现 each() 函数在某些方面会做得很好。在我自己的情况下，它并没有那么干净，因为我想要所有这些元素的单个 jQuery 对象，但这里是你如何将每个对象用于不同的目的（在这个例子中隐藏连续的“.a”元素：）

```
$('#active')
    .nextAll()
    .each(hideConsecutive)
    .end()
    .prevAll()
    .each(hideConsecutive)
;
function hideConsecutive(index, element) {
    var $e = $(element);
    if (!$e.is(".a")) {
        return false;    // this stops the each function.
    } else {
        $e.hide('slow');
    }
} 
```

--

编辑：我现在把它放在一个插件中。如果您有兴趣，请查看[http://plugins.jquery.com/project/Adjacent 。](http://plugins.jquery.com/project/Adjacent)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-17T02:55:32.853

我相信循环是你最好的选择。但是您可以尝试，每个活动，然后前后移动，直到条件中断，如果集合足够大，这会更快。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-18T14:07:15.703

下面的代码将添加两个新函数，nextConsecutive() 和 prevConsecutive()。他们应该做你想做的事。

$.each( ['prev', 'next'], function(unusedIndex, name) { $.fn[ name + 'Consecutive' ] = function(matchExpr) {

```
 var $all = 
        (name == 'prev')
             ? $(this).prevAll()
             : $(this).nextAll();
    if (!matchExpr)
        return $all;

    var $notMatch = $($all).not(matchExpr).filter(':first');
    if ($all.index($notMatch) != -1)
        return $allConsecutive = $all.slice(0, $all.index($notMatch));

    return $all;
}; 
```

});

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-17T03:48:26.547

波浪号 (~) 是[兄弟选择器](http://docs.jquery.com/Selectors/siblings#prevsiblings)：

```
$('#active ~ img.a').hide(); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-17T04:04:13.013

@Prestaul

```
$('#active ~ img.a') 
```

只会选择*以下*兄弟姐妹，并且也会包括不连续的兄弟姐妹。文档：[http ://docs.jquery.com/Selectors/siblings#prevsiblings](http://docs.jquery.com/Selectors/siblings#prevsiblings)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-17T04:26:46.003

这是另一种方法，尽管兄弟选择器的答案非常酷：

```
var next = $('#active').next('.a');
var prev = $('#active').prev('.a'); 
```

**编辑：**我重新阅读了您的要求，这并不是您想要的。您可以使用 nextAll 和 prevAll，但它们也不会在没有类名的 IMG 处停止。

# html - 如何垂直对齐 div 中的元素？

> ID：79461
> 
> 赞同：964
> 
> 时间：2008-09-17T02:53:36.477
> 
> 标签：html, css, vertical-alignment

我有一个`div`带有两个图像和一个`h1`. 所有这些都需要在 div 内垂直对齐，彼此相邻。

其中一张图像需要`absolute`定位在`div`.

在所有常见浏览器上工作所需的 CSS 是什么？

```
<div id="header">
  <img src=".." ></img>
  <h1>testing...</h1>
  <img src="..."></img>
</div> 
```

* * *

## 回答 #1

> 赞同：1047
> 
> 时间：2008-09-17T15:38:49.320

哇，这个问题很流行。这是基于对`vertical-align`财产的误解。这篇优秀的文章解释了它：

[理解`vertical-align`，或 Gavin Kistner 的“如何（不）垂直居中内容”](http://phrogz.net/CSS/vertical-align/index.html)。

**[“如何在 CSS 中居中”</a>](http://howtocenterincss.com/)**[是一个很棒的网络工具，可以帮助找到不同情况下必要的 CSS 居中属性。](http://howtocenterincss.com/)

 [* * *

简而言之[^(（并防止链接腐烂）)]：](http://howtocenterincss.com/) 

[](http://howtocenterincss.com/)
*   [**内联元素**（并且*只有*内联元素）可以通过`vertical-align: middle`. 但是，“上下文”不是整个父容器的高度，而是它们所在的文本行的高度](http://howtocenterincss.com/)[。jsfiddle 示例](http://jsfiddle.net/jBthq/)
*   对于块元素，垂直对齐更难，很大程度上取决于具体情况：
    *   如果内部元素可以有一个**固定的高度**，你可以确定它的位置`absolute`并指定它的`height`,`margin-top`和`top`位置。[jsfiddle 示例](http://jsfiddle.net/YFncP/2/)
    *   如果居中元素**由一行组成** *并且* **其父高度是固定**的，您可以简单地设置容器`line-height`以填充其高度。根据我的经验，这种方法非常通用。[jsfiddle 示例](http://jsfiddle.net/d4zGF/)
    *   ……还有更多这样的特殊情况。

* * *

## 回答 #2

> 赞同：297
> 
> 时间：2015-06-26T16:56:47.803

现在 Flexbox 支持正在增加，这个应用于包含元素的 CSS 将垂直居中包含的项目：

```
.container {
    display: flex;
    align-items: center;
} 
```

如果您还需要针对[Internet Explorer 10](https://en.wikipedia.org/wiki/Internet_Explorer_11#Internet_Explorer_10)和更早的 (< [4.4](https://en.wikipedia.org/wiki/Android_version_history#Android_4.4_KitKat_.28API_level_19.29) (KitKat)) Android 浏览器，请使用前缀版本：

```
.container {
    display: -ms-flexbox;
      display: -webkit-flex;
    display: flex;

       -ms-flex-align: center;
    -webkit-align-items: center;
       -webkit-box-align: center;

       align-items: center;
} 
```

* * *

## 回答 #3

> 赞同：128
> 
> 时间：2013-05-03T11:11:34.453

我使用了这个非常简单的代码：

HTML：

```
<div class="ext-box">
    <div class="int-box">
        <h2>Some txt</h2>
        <p>bla bla bla</p>
    </div>
</div> 
```

CSS：

```
div.ext-box { display: table; width:100%;}
div.int-box { display: table-cell; vertical-align: middle; } 
```

显然，无论您使用 a`.class`还是 an `#id`，结果都不会改变。

* * *

## 回答 #4

> 赞同：90
> 
> 时间：2018-08-01T06:38:35.953

```
 .outer {
   display: flex;
   align-items: center; 
   justify-content: center;
 } 
```

* * *

## 回答 #5

> 赞同：56
> 
> 时间：2011-05-11T10:24:00.537

它对我有用：

```
.vcontainer {
    min-height: 10em;
    display: table-cell;
    vertical-align: middle;
} 
```

* * *

## 回答 #6

> 赞同：35
> 
> 时间：2018-01-30T13:49:18.167

## 垂直和水平对齐元素

使用其中任何一个。结果将是相同的：

1.  引导程序 4
2.  CSS3

[![在此处输入图像描述](https://i.stack.imgur.com/MqvVH.png)](https://i.stack.imgur.com/MqvVH.png)

### 1.引导4.3+

对于垂直对齐：`d-flex align-items-center`

对于水平对齐：`d-flex justify-content-center`

对于垂直和水平对齐：`d-flex align-items-center justify-content-center`

```
.container {
    height: 180px;
    width:100%;
    background-color: blueviolet;
}

.container > div {
  background-color: white;
  padding: 1rem;
}
```

```
<link href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
rel="stylesheet"/>

<div class="d-flex align-items-center justify-content-center container">
  <div>I am in Center</div>
</div>
```

### 2.CSS 3

```
.container {
    height: 180px;
    width:100%;
    background-color: blueviolet;
}

.container > div {
  background-color: white;
  padding: 1rem;
}

.center {
  display: flex;
  align-items: center;
  justify-content: center;
}
```

```
<div class="container center">
    <div>I am in Center</div>
</div>
```

* * *

## 回答 #7

> 赞同：27
> 
> 时间：2012-04-16T20:19:19.603

我朋友的一个技巧：

HTML：

```
<div style="height:100px; border:1px solid;">
    <p style="border:1px dotted;">I'm vertically centered.</p>
</div> 
```

CSS：

```
div:before {content:" "; display:inline-block; height:100%; vertical-align:middle;}
div p {display:inline-block;} 
```

[演示](http://dabblet.com/gist/2867324)在这里

* * *

## 回答 #8

> 赞同：22
> 
> 时间：2014-10-14T09:07:45.453

要将块元素定位到中心（适用于[Internet Explorer 9](https://en.wikipedia.org/wiki/Internet_Explorer_9)及更高版本），它需要一个包装器`div`：

```
.vcontainer {
  position: relative;
  top: 50%;
  transform: translateY(-50%);
  -webkit-transform: translateY(-50%);
} 
```

* * *

## 回答 #9

> 赞同：16
> 
> 时间：2008-09-17T04:34:51.630

> 所有这些都需要在 div 内垂直对齐

*怎么*对齐？图像的顶部与文本的顶部对齐？

> 其中一张图像需要绝对定位在 div 内。

相对于 DIV 绝对定位？也许你可以勾勒出你正在寻找的东西......？

[fd 描述](https://stackoverflow.com/questions/79461/vertical-alignment-of-elements-in-a-div#79550)了绝对定位的步骤，以及调整`H1`元素的显示以使图像与其内联显示。为此，我将补充一点，您可以使用以下`vertical-align`样式对齐图像：

```
#header h1 { display: inline; }
#header img { vertical-align: middle; } 
```

...这会将标题和图像放在一起，顶部边缘对齐。存在其他对齐选项；[请参阅文档](http://www.w3.org/TR/CSS2/visudet.html#propdef-vertical-align)。您可能还会发现删除 DIV 并将图像移动到`H1`元素内是有益的——这为容器提供了语义价值，并且无需调整`H1`:

```
<h1 id=header">
   <img src=".." ></img>
   testing...
   <img src="..."></img>
</h1> 
```

* * *

## 回答 #10

> 赞同：16
> 
> 时间：2012-04-01T18:58:07.883

使用这个公式，它会一直工作而不会出现裂缝：

```
#outer {height: 400px; overflow: hidden; position: relative;}
#outer[id] {display: table; position: static;}

#middle {position: absolute; top: 50%;} /* For explorer only*/
#middle[id] {display: table-cell; vertical-align: middle; width: 100%;}

#inner {position: relative; top: -50%} /* For explorer only */
/* Optional: #inner[id] {position: static;} */
```

```
<div id="outer">
  <div id="middle">
    <div id="inner">
      any text
      any height
      any content, for example generated from DB
      everything is vertically centered
    </div>
  </div>
</div>
```

* * *

## 回答 #11

> 赞同：16
> 
> 时间：2014-01-18T10:13:26.410

几乎所有方法都需要指定高度，但通常我们没有任何高度。

所以这是一个不需要知道高度的 CSS 3 三行技巧。

```
.element {
    position: relative;
    top: 50%;
    transform: translateY(-50%);
} 
```

它甚至在 IE9 中也受支持。

及其供应商前缀：

```
.element {
    position: relative;
    top: 50%;
    -webkit-transform: translateY(-50%);
    -ms-transform: translateY(-50%);
    transform: translateY(-50%);
} 
```

来源：*[只需 3 行 CSS 即可垂直对齐任何内容](http://zerosixthree.se/vertical-align-anything-with-just-3-lines-of-css/)*

* * *

## 回答 #12

> 赞同：12
> 
> 时间：2019-07-29T05:19:50.830

### 在父 div 中制作中心子 div 的三种方法

*   绝对定位方式
*   弹性盒方法
*   变换/翻译方法

[![在此处输入图像描述](https://i.stack.imgur.com/IJ41P.png)](https://i.stack.imgur.com/IJ41P.png)

[演示](https://jsfiddle.net/vahid_634/Lsvcrf1g/4/)

```
/* Absolute Positioning Method */
.parent1 {
  background: darkcyan;
   width: 200px;
   height: 200px;
   position: relative;
}
.child1 {
  background: white;
  height: 30px;
  width: 30px;
  position: absolute;
  top: 50%;
  left: 50%;
  margin: -15px;
}

/* Flexbox Method */
.parent2 {
  display: flex;
  justify-content: center;
  align-items: center;
  background: darkcyan;
  height: 200px;
  width: 200px;
}
.child2 {
  background: white;
  height: 30px;
  width: 30px;
}

/* Transform/Translate Method */
.parent3 {
  position: relative;
  height: 200px;
  width: 200px;
  background: darkcyan;
}
.child3 {
  background: white;
  height: 30px;
  width: 30px;
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
}
```

```
<div class="parent1">
  <div class="child1"></div>
</div>
<hr />

<div class="parent2">
  <div class="child2"></div>
</div>
<hr />

<div class="parent3">
  <div class="child3"></div>
</div>
```

* * *

## 回答 #13

> 赞同：11
> 
> 时间：2014-10-14T15:26:29.200

我的诀窍是在 div 中放置一个表格，其中包含一行和一列，设置 100% 的宽度和高度，以及属性*vertical-align:middle*：

```
<div>

    <table style="width:100%; height:100%;">
        <tr>
            <td style="vertical-align:middle;">
                BUTTON TEXT
            </td>
        </tr>
    </table>

</div> 
```

小提琴： http: [//jsfiddle.net/joan16v/sbq​​jnn9q /](http://jsfiddle.net/joan16v/sbqjnn9q/)

* * *

## 回答 #14

> 赞同：6
> 
> 时间：2019-03-08T15:43:52.433

使用 display flex，首先你需要包装你想要对齐的项目的容器：

```
<div class="outdiv">
    <div class="indiv">
        <span>test1</span>
        <span>test2</span>
    </div>
</div> 
```

然后在我的示例中应用以下 CSS 内容来包装*div*或*outdiv*：

```
.outdiv {
    display: flex;
    justify-content: center;
    align-items: center;
} 
```

* * *

## 回答 #15

> 赞同：4
> 
> 时间：2015-12-16T19:35:20.680

使用 CSS 垂直居中，您可以让外部容器像表格一样，而内容像表格单元格一样。在这种格式中，您的对象将保持居中。:)

我以在 JSFiddle 中嵌套多个对象为例，但核心思想是这样的：

**HTML**

```
<div class="circle">
  <div class="content">
    Some text
  </div>
</div> 
```

**CSS**

```
.circle {
  /* Act as a table so we can center vertically its child */
  display: table;
  /* Set dimensions */
  height: 200px;
  width: 200px;
  /* Horizontal center text */
  text-align: center;
  /* Create a red circle */
  border-radius: 100%;
  background: red;
}

.content {
  /* Act as a table cell */
  display: table-cell;
  /* And now we can vertically center! */
  vertical-align: middle;
  /* Some basic markup */
  font-size: 30px;
  font-weight: bold;
  color: white;
} 
```

多对象示例：

**HTML**

```
<div class="container">
  <div class="content">

    <div class="centerhoriz">

      <div class="circle">
        <div class="content">
          Some text
        </div><!-- content -->
      </div><!-- circle -->

      <div class="square">
        <div class="content">
          <div id="smallcircle"></div>
        </div><!-- content -->
      </div><!-- square -->

    </div><!-- center-horiz -->

  </div><!-- content -->
</div><!-- container --> 
```

**CSS**

```
.container {
  display: table;
  height: 500px;
  width: 300px;
  text-align: center;
  background: lightblue;
}

.centerhoriz {
  display: inline-block;
}

.circle {
  display: table;
  height: 200px;
  width: 200px;
  text-align: center;
  background: red;
  border-radius: 100%;
  margin: 10px;
}

.square {
  display: table;
  height: 200px;
  width: 200px;
  text-align: center;
  background: blue;
  margin: 10px;
}

.content {
  display: table-cell;
  vertical-align: middle;
  font-size: 30px;
  font-weight: bold;
  color: white;
}

#smallcircle {
  display: inline-block;
  height: 50px;
  width: 50px;
  background: green;
  border-radius: 100%;
} 
```

**结果**

[![结果](https://i.stack.imgur.com/p1Cyh.png)](https://i.stack.imgur.com/p1Cyh.png)

[https://jsfiddle.net/martjemeyer/ybs032uc/1/](https://jsfiddle.net/martjemeyer/ybs032uc/1/)

* * *

## 回答 #16

> 赞同：4
> 
> 时间：2017-08-02T10:35:32.693

我找到了一种新的解决方法，可以使用 CSS 3 垂直对齐 div 中的多个文本行（我还使用 bootstrap v3 网格系统来美化 UI），如下所示：

```
.immediate-parent-of-text-containing-div {
    height: 50px;         /* Or any fixed height that suits you. */
}

.text-containing-div {
    display: inline-grid;
    align-items: center;
    text-align: center;
    height: 100%;
} 
```

根据我的理解，包含元素的文本的直接父级必须有一定的高度。

* * *

## 回答 #17

> 赞同：3
> 
> 时间：2008-09-17T03:08:18.233

默认情况下，h1 是一个块元素，将在第一个 img 之后的行上渲染，并将导致第二个 img 出现在该块之后的行上。

要阻止这种情况发生，您可以将 h1 设置为具有内联流行为：

```
#header > h1 { display: inline; } 
```

至于将 img 绝对定位在*div 内*，您需要将包含的 div 设置为“已知大小”，然后才能正常工作。根据我的经验，您还需要将 position 属性从默认值更改 - position: relative 对我有用：

```
#header { position: relative; width: 20em; height: 20em; }
#img-for-abs-positioning { position: absolute; top: 0; left: 0; } 
```

如果你可以让它工作，你可能想尝试从 div.header 逐步删除高度、宽度、位置属性，以获得所需的最少属性来获得你想要的效果。

**更新：**

这是一个适用于 Firefox 3 的完整示例：

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
          "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
    <head>
        <title>Example of vertical positioning inside a div</title>
        <style type="text/css">
            #header > h1 { display: inline; }
            #header { border: solid 1px red; 
                      position: relative; }
            #img-for-abs-positioning { position: absolute;
                                       bottom: -1em; right: 2em; }
        </style>
    </head>

    <body>
        <div id="header">
            <img src="#" alt="Image 1" width="40" height="40" />
            <h1>Header</h1>
            <img src="#" alt="Image 2" width="40" height="40" 
                 id="img-for-abs-positioning" />
        </div>
    </body>
</html> 
```

* * *

## 回答 #18

> 赞同：3
> 
> 时间：2016-10-06T19:57:20.543

我们可以使用 CSS 函数计算来计算元素的大小，然后相应地定位子元素。

示例 HTML：

```
<div class="box">
    <span><a href="#">Some Text</a></span>
</div> 
```

和 CSS：

```
.box {
    display: block;
    background: #60D3E8;
    position: relative;
    width: 300px;
    height: 200px;
    text-align: center;
}

.box span {
    font: bold 20px/20px 'source code pro', sans-serif;
    position: absolute;
    left: 0;
    right: 0;
    top: calc(50% - 10px);
}

a {
    color: white;
    text-decoration: none;
} 
```

此处创建的演示：[https ://jsfiddle.net/xnjq1t22/](https://jsfiddle.net/xnjq1t22/)

该解决方案适用于响应式`div` `height`和响应`width`式。

注意：*calc*函数未测试与旧浏览器的兼容性。

* * *

## 回答 #19

> 赞同：2
> 
> 时间：2019-07-19T17:32:12.420

我最喜欢的新方法是使用 CSS 网格：

```
/* technique */

.wrapper {
  display: inline-grid;
  grid-auto-flow: column;
  align-items: center;
  justify-content: center;
}

/* visual emphasis */

.wrapper {
  border: 1px solid red;
  height: 180px;
  width: 400px;
}

img {
  width: 100px;
  height: 80px;
  background: #fafafa;
}

img:nth-child(2) {
  height: 120px;
}
```

```
<div class="wrapper">
  <img src="https://source.unsplash.com/random/100x80/?bear">
  <img src="https://source.unsplash.com/random/100x120/?lion">
  <img src="https://source.unsplash.com/random/100x80/?tiger">
</div>
```

* * *

## 回答 #20

> 赞同：2
> 
> 时间：2020-11-11T05:32:44.187

仅使用 Bootstrap 类：

*   分区：`class="container d-flex"`
*   div内的元素：`class="m-auto"`

```
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.3/css/bootstrap.min.css" crossorigin="anonymous">

<div class="container d-flex mt-5" style="height:110px; background-color: #333;">
  <h2 class="m-auto"><a href="https://hovermind.com/">H➲VER➾M⇡ND</a></h2>
</div>
```

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2013-10-02T07:17:38.030

只需在 div 中使用一个单元格表格！只需将单元格和表格高度设置为 100%，您就可以使用垂直对齐。

div 内的一个单元格表处理垂直对齐，并且向后兼容回石器时代！

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2014-07-27T20:00:50.413

**一年多以来，我一直在使用以下解决方案（没有定位和行高），它也适用于[Internet Explorer 7](https://en.wikipedia.org/wiki/Internet_Explorer_7)和[Internet Explorer 8](https://en.wikipedia.org/wiki/Internet_Explorer_8)。**

```
<style>
.outer {
    font-size: 0;
    width: 400px;
    height: 400px;
    background: orange;
    text-align: center;
    display: inline-block;
}

.outer .emptyDiv {
    height: 100%;
    background: orange;
    visibility: collapse;
}

.outer .inner {
    padding: 10px;
    background: red;
    font: bold 12px Arial;
}

.verticalCenter {
    display: inline-block;
    *display: inline;
    zoom: 1;
    vertical-align: middle;
}
</style>

<div class="outer">
    <div class="emptyDiv verticalCenter"></div>
    <div class="inner verticalCenter">
        <p>Line 1</p>
        <p>Line 2</p>
    </div>
</div> 
```

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2014-09-16T11:39:46.360

`i`这是我对 a 中元素的个人解决方案`div`。

[JSFiddle 示例](http://jsfiddle.net/3FvxA/683/)

## HTML

```
<div class="circle">
    <i class="fa fa-plus icon">
</i></div> 
```

## CSS

```
.circle {
   border-radius: 50%;
   color: blue;
   background-color: red;
   height:100px;
   width:100px;
   text-align: center;
   line-height: 100px;
}

.icon {
  font-size: 50px;
  vertical-align: middle;
} 
```

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2015-07-07T21:13:38.827

对我来说，它是这样工作的：

```
<div style="width:70px; height:68px; float:right; display: table-cell; line-height: 68px">
    <a href="javascript:void(0)" style="margin-left: 4px; line-height: 2" class="btn btn-primary">Login</a>
</div> 
```

使用 Bootstrap 类将“a”元素转换为按钮，现在它在外部“div”内垂直居中。

* * *

## 回答 #25

> 赞同：-3
> 
> 时间：2013-10-02T07:03:37.410

只是这个：

```
<div>
    <table style="width: 100%; height: 100%">
        <tr>
            <td style="width: 100%; height: 100%; vertical-align: middle;">
               What ever you want vertically-aligned
            </td>
        </tr>
    </table>
</div> 
```

div 内的一个单元格表处理垂直对齐，并且向后兼容回石器时代！

* * *

## 回答 #26

> 赞同：-3
> 
> 时间：2014-01-04T11:41:46.387

```
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN">
<html>
    <head>
        <style type="text/css">
            #style_center { position:relative; top:50%; left:50%; }
            #style_center_absolute { position:absolute; top:50px; left:50px; }
            <!--#style_center { position:relative; top:50%; left:50%; height:50px; margin-top:-25px; }-->
        </style>
    </head>

    <body>
        <div style="height:200px; width:200px; background:#00FF00">
            <div id="style_center">+</div>
        </div>
    </body>
</html> 
```

* * *

## 回答 #27

> 赞同：-4
> 
> 时间：2013-11-22T16:28:28.483

这只是另一种（响应式）方法：

```
html,
    body {
        height: 100%;
    }
    body {
        margin: 0;
    }

    .table {
        display: table;
        width:  auto;
        table-layout:auto;
        height: 100%;
    }
        .table:nth-child(even) {
            background: #a9edc3;
        }
        .table:nth-child(odd) {
            background: #eda9ce;
        }

    .tr {
        display: table-row;
    }
    .td {
        display: table-cell;
        width: 50%;
        vertical-align: middle;
    } 
```

[http://jsfiddle.net/herrfischerhamburg/JcVxz/](http://jsfiddle.net/herrfischerhamburg/JcVxz/)

* * *

## 回答 #28

> 赞同：-8
> 
> 时间：2008-09-17T03:01:23.417

```
<div id="header" style="display: table-cell; vertical-align:middle;"> 
```

...

或 CSS

```
.someClass
{
   display: table-cell;
   vertical-align:middle;
} 
```

[**浏览器覆盖率**](http://caniuse.com/#search=table-cell)

# ruby - 为什么模块不总是尊重 ruby 中的“require”？

> ID：79466
> 
> 赞同：0
> 
> 时间：2008-09-17T02:54:33.230
> 
> 标签：ruby

（对不起，我第一次发布此代码时应该更清楚代码。希望这是有道理的）

文件“size_specification.rb”

```
class SizeSpecification
  def fits?     
  end
end 
```

文件“some_module.rb”

```
require 'size_specification'

module SomeModule
  def self.sizes
    YAML.load_file(File.dirname(__FILE__) + '/size_specification_data.yml')
  end
end 
```

文件“size_specification_data.yml

```
--- 
- !ruby/object:SizeSpecification 
  height: 250
  width: 300 
```

然后当我打电话

```
SomeModule.sizes.first.fits? 
```

我得到一个例外，因为“尺寸”是对象而不是 SizeSpecification，所以它们没有“适合”功能。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-18T17:35:31.590

你的设置和红宝石安装好吗？我创建了这 3 个文件并在“test.rb”中写了以下内容

```
require 'yaml'
require "some_module"

SomeModule.sizes.first.fits? 
```

然后我运行它。

```
$ ruby --version
ruby 1.8.6 (2008-06-20 patchlevel 230) [i486-linux]
$ ruby -w test.rb 
$ 
```

没有错误！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-19T16:57:22.367

问题代码让我有点困惑。

一般来说，对于 Ruby，如果发生这种情况，这是一个好兆头，表明我正在尝试以错误的方式做事。

询问与您的实际预期结果相关的问题可能会更好，而不是针对您的问题的特定“攻击”的细节。他们我们可以说'nonono，不要那样做，这样做'或'ahhhhh，现在我明白你想做什么'

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-17T04:44:44.320

在第二次阅读时我有点困惑，您似乎想将类混合到模块中，这可能不是那么可取的。YAML 还应该加载 SizeSpecifications 的数组吗？

似乎您没有将模块混入您的班级。如果我在 irb 中运行测试，则 require 会引发 LoadError。所以我假设你已经把两个文件放在一起，如果没有转储它。

通常你会在模块中编写功能，然后将其混合到类中。所以你可以像这样修改你的代码：

```
class SizeSpecification
  include SomeModule
  def fits?     
  end
end 
```

这将允许您说：

```
SizeSpecification::SomeModule.sizes 
```

我想你也应该能够说：

```
SizeSpecification.sizes 
```

但是，这需要您将 self 从 sizes 方法定义的前缀中去掉。

这有帮助吗？

# sql-server - 用于报告的备份数据

> ID：79468
> 
> 赞同：0
> 
> 时间：2008-09-17T02:54:48.657
> 
> 标签：sql-server, database

在 sql server 2005 中将数据从销售表传输到销售历史表的最佳方法是什么。销售历史表将用于报告。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-17T03:30:24.547

Bulkcopy 速度很快，它不会使用事务日志。在一天结束时运行一批。

从生产服务器中删除复制的记录是一种不同的情况，需要在该服务器的维护方法/计划中进行规划。您的报告服务器解决方案不应干扰或影响生产服务器。

请记住，您的报告服务器并不是数据的备份，而是专门用于报告目的的副本。

还要检查您的报告服务器的服务器设置是否处于[简单恢复模式](http://technet.microsoft.com/en-us/library/ms191164.aspx)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-17T04:10:25.933

看看 SSAS。OLAP 是为报告而构建的，并且易于使用 excel 数据透视表等工具进行查询。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-17T03:38:27.647

大多数解决方案需要 2 个步骤；- 将记录从源复制到目标 - 从源中删除记录。您的源表必须有一个主键。

“最佳”方法取决于很多事情。
有多少记录？这是生产环境吗？你有什么工具？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-17T03:51:15.557

除非您要移动大量数据，否则一个简单的存储过程应该可以解决问题。[sql server 作业](http://msdn.microsoft.com/en-us/library/ms187910.aspx)可以管理调用 proc 的时间。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-08-15T21:40:26.210

如果您只想将数据移动到另一个表，请使用 BulkCopy/BulkInsert。如果您想构建报告，我建议您使用 BI 解决方案，例如 MS 分析服务 (OLAP)。

在同一个数据库中维护两个或多个历史/存档表是困难的，而且在我看来很难看。对于报告解决方案，无论如何您都将考虑该信息的所有表格。仅当您要将数据放在一边并且长时间不接触它时，才应使用历史/存档表，即。将其存档在操作数据库之外。

# ruby-on-rails - 为 Phusion 乘客应用程序设置环境变量

> ID：79474
> 
> 赞同：7
> 
> 时间：2008-09-17T02:56:14.490
> 
> 标签：ruby-on-rails, ruby, passenger, env

我已经设置了开发中的Passenger（Mac OS X），它完美无缺。唯一的问题是后来出现的：现在我有一个自定义`GEM_HOME`路径和 ImageMagick 二进制文件安装在`"/usr/local"`. 我可以将它们放在获取源的 shell rc 文件之一中，这解决了从控制台生成的进程的环境变量；但是乘客呢？以这种方式运行时，同一个应用程序找不到我的宝石。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-09-17T08:54:05.643

我知道两种解决方案。第一个（[在此处](http://www.viget.com/extend/rubyinline-in-shared-rails-environments/)记录）与 manveru 的基本相同——直接在您的代码中设置 ENV 变量。

第二个是围绕Passenger 使用的Ruby 解释器创建一个包装器，并[在此处](http://blog.rayapps.com/2008/05/21/using-mod_rails-with-rails-applications-on-oracle/)记录（查找passenger_with_ruby）。要点是您创建（并在 Apache 配置中将 PassengerRuby 指向）/usr/bin/ruby_with_env，这是一个可执行文件，其中包括：

```
#!/bin/bash
export ENV_VAR=value
/usr/bin/ruby $* 
```

两者都有效；我认为，前一种方法不那么骇人听闻。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-17T04:30:03.547

在执行任何要求之前（尤其是在要求 ruby​​gems 之前），您可以执行以下操作：

```
ENV['GEM_HOME'] = '/foo' 
```

这将更改此进程内的环境变量。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-12T16:39:51.530

我发现如果你在计算机上有 root 权限，那么你可以在“envvars”文件中设置必要的环境变量，apachectl 将在启动 Apache 之前执行这个文件。

envvars 通常位于 apachectl 所在的同一目录中 - 在 Mac OS X 上，它位于 /usr/sbin。如果找不到，请查看 apachectl 脚本的源代码。

更改 envvars 文件后，使用“apachectl -k restart”重新启动 Apache。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-17T03:22:09.887

我也遇到过这个问题。[看起来](http://groups.google.com/group/phusion-passenger/browse_thread/thread/79474d37028f2a03)，Passenger 没有传递使用`SetEnv`apache 指令设置的值——这很不幸。

也许可以在您的 environment.rb 或 boot.rb 中设置环境变量（假设您正在谈论 Rails 应用程序；我不熟悉 Rack，但大概它具有类似的功能）

# statistics - 偏离平均值的“标准偏差数”的正确术语是什么

> ID：79476
> 
> 赞同：3
> 
> 时间：2008-09-17T02:56:28.153
> 
> 标签：statistics

我已经计算了一组值的均值和方差，并且我想传递代表集合中每个数字的标准偏差与均值的 # 的值。有没有更好的术语，或者我应该称之为 num_of_std_devs_from_mean ...

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-17T03:08:08.267

这里的一些建议： [标准分数](http://en.wikipedia.org/wiki/Standard_score)（z值，z分数，正常分数）

但是“sigma”或“stdev_distance”可能会更清楚

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-17T02:58:34.747

标准偏差通常用字母 σ (sigma) 表示。就个人而言，我认为如果您确实说出标准偏差的数量，更多人会理解您的意思。

至于变量名，只要注释声明就可以将其缩短为 std_devs。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-17T02:59:15.823

[西格玛](http://en.wikipedia.org/wiki/Standard_deviation)是你想要的，我想。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-17T02:58:13.407

那就是规范你的价值观。您可以将其称为标准化值。也许 norm_val 会更合适。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-17T03:00:55.803

我一直听说它是标准偏差的数量

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-17T03:25:03.827

[偏差](http://en.wikipedia.org/wiki/Deviation_(statistics))可能是你所追求的。偏差是数据点与平均值之间的距离。

# perl - 如何将事务与 Stomp 和 ActiveMQ（和 Perl）一起使用？

> ID：79482
> 
> 赞同：10
> 
> 时间：2008-09-17T02:57:59.773
> 
> 标签：perl, activemq, stomp

我正在尝试用 ActiveMQ 替换一些定制的消息队列，我需要从 Perl 与他们（很多）交谈。ActiveMQ 提供了一个 Stomp 接口，而 Perl 有 Net::Stomp，所以这看起来应该没问题，但事实并非如此。

即使我通过 Stomp 发送 BEGIN 命令，使用 SEND 发送的消息也会立即发布，如果我 ABORT 事务，则不会发生任何事情。

我找不到任何明确的答案表明它是不可能的，这是可能的，或者有一些相关的配置。此外，Stomp 似乎不是检查服务器错误响应的好协议。

我运气不好？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-17T08:07:52.977

顺便说一句，问 Perl/ActiveMQ/Stomp 问题的最佳地点是[ActiveMQ 用户论坛](http://activemq.apache.org/discussion-forums.html)，因为那里有很多 Perl-Stomp 人。

STOMP 交易的诀窍是确保您发送的每条消息或您做出的每条确认都包含交易 ID 标头。请参阅[STOMP 协议的事务处理部分](http://stomp.codehaus.org/Transaction+Handling)。

这样做的原因是，如果您的客户端是多线程的，那么使用 STOMP 您可以同时进行许多事务 - 以及一些非事务操作。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-18T15:32:15.910

看看[Net::Stomp::Receipt](http://search.cpan.org/~huguei/Net-Stomp-Receipt-0.34/lib/Net/Stomp/Receipt.pm)。它是 Net::Stomp 的子类，它实现了 Stomp 协议的“回执”，并允许您确保正确接收您的消息，否则中止交易。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-03T17:53:33.067

您必须将确认包装在事务中。

在伪代码（或伪 STOMP）中，这将是：

*   BEGIN [TRANSACTION-ID] -> 发送到服务器
*   MESSAGE [MESSAGE-ID] (received) <- 从服务器接收
*   ACK [MESSAGE-ID] [TRANSACTION-ID] -> 发送到服务器
*   COMMIT [TRANSACTION-ID] -> 发送到服务器

我已经使用 PHP 驱动程序进行了这项工作（当我传入一个框架对象进行确认时，修补中止调用以使用事务 ID）。

不幸的是，在重新传递四条消息后，客户端停止了。至少这发生在我身上。

# linux - linux正常运行时间历史

> ID：79490
> 
> 赞同：37
> 
> 时间：2008-09-17T02:59:11.737
> 
> 标签：linux

如何获取我的 debian 机器的正常运行时间历史记录？重新启动后，我没有看到 uptime 命令打印正常运行时间历史记录的选项。如果重要的话，我想使用这些正常运行时间在 php 中绘制一个页面，以显示我的网络服务器在启动之间的正常运行时间长度。

更新：不确定它是基于时间长度还是最后一次在重新启动时重置，但我只使用最后一个命令获得最新的启动时间戳。last -x 也不会返回任何进一步的信息。听起来脚本是我最好的选择。

更新： Uptimed 是我正在寻找的信息，不知道如何在代码中 grep 该信息。管理我自己的数据库脚本听起来最适合应用程序。

* * *

## 回答 #1

> 赞同：52
> 
> 时间：2008-09-17T03:08:46.190

安装[uptimed](https://github.com/rpodgorny/uptimed)。它完全符合您的要求。

编辑：

您可以像这样轻松地将其包含在 PHP 页面中：

```
<? system("/usr/local/bin/uprecords -a -B"); ?> 
```

[例子](https://web.archive.org/web/20090228064718/http://www.robertjohnkaper.com/software/uptimed/example.html)

* * *

## 回答 #2

> 赞同：30
> 
> 时间：2008-09-17T03:01:45.677

该[`last`](http://linux.about.com/library/cmd/blcmdl1_last.htm)命令将为您提供系统的重新启动时间。您可以计算每次连续重新启动之间的差异，这应该可以延长机器的正常运行时间。

**更新**

[1800 INFORMATION](https://stackoverflow.com/questions/79490/linux-uptime-history#79553)答案是一个更好的解决方案。

* * *

## 回答 #3

> 赞同：30
> 
> 时间：2008-09-17T03:06:16.633

您可以创建一个运行正常运行时间并将其转储到文件的简单脚本。

```
uptime >> uptime.log 
```

然后为它设置一个cron作业。

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2008-09-17T04:56:11.673

试试这个：

```
last | grep reboot 
```

* * *

## 回答 #5

> 赞同：15
> 
> 时间：2013-09-22T12:39:07.417

根据`last`手册页：

> 每次重新启动系统时，伪用户重新启动都会登录。因此，上次重新启动将显示自创建日志文件以来所有重新启动的日志。

所以最后一列`#last reboot`命令为您提供正常运行时间历史记录：

```
#last reboot
reboot   system boot  **************** Sat Sep 21 03:31 - 08:27 (1+04:56)   
reboot   system boot  **************** Wed Aug  7 07:08 - 08:27 (46+01:19) 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-17T03:04:35.623

这不会在两次启动之间存储，但[Uptimes Project](http://www.uptimes-project.org)是第三方跟踪它的选项，带有适用于一系列平台的软件。

Debian 上可用的另一个工具是[uptimed](http://podgorny.cz/moin/Uptimed)，它跟踪引导之间的正常运行时间。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-17T03:36:46.043

*我将通过在您的 crontab 中输入以下内容 [单行*- 我刚刚将其分隔以进行格式化]来创建一个 cron 作业以所需的分辨率（例如 10 分钟）运行（cron -l to list, cron -e编辑）。

```
0,10,20,30,40,50 * * * *
    /bin/echo $(/bin/date +\%Y-\%m-\%d) $(/usr/bin/uptime)
    >>/tmp/uptime.hist 2>&1 
```

这会在机器运行时每十分钟将日期、时间和正常运行时间附加到 uptime.hist 文件中。然后，您可以手动检查此文件以找出信息或编写脚本来处理您认为合适的信息。

每当正常运行时间减少时，自上一次记录以来就会重新启动。当线路之间有很大的间隔（即超过预期的十分钟）时，机器在此期间一直处于停机状态。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-17T03:00:31.950

我不认为这些信息会在重新启动之间保存。

如果正确关闭，您可以在关闭时运行一个命令来节省正常运行时间，这样您就可以在重新启动后读取它。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-17T03:03:31.490

此信息通常不会保存。但是，您可以注册一个在线服务来为您完成这项工作。您只需安装一个客户端，它将每 5 分钟将您的正常运行时间发送到服务器，该站点将向您显示正常运行时间图表：

[http://uptimes-project.org/](http://uptimes-project.org/)

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2011-06-13T12:00:04.033

或者您可以使用 tuptime [https://sourceforge.net/projects/tuptime/](https://sourceforge.net/projects/tuptime/)来计算总的正常运行时间。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2014-04-16T22:52:19.950

您可以使用 tuptime，这是一个简单的命令，用于报告 linux 中的总正常运行时间，使其在重新启动之间保持不变。

[http://sourceforge.net/projects/tuptime/](http://sourceforge.net/projects/tuptime/)

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2019-04-13T08:43:11.977

由于我在这里没有找到可以追溯的答案，也许这会对某人有所帮助。

kern.log（取决于你的发行版）应该记录一个时间戳。它将类似于：2019-01-28T06:25:25.459477+00:00 someserver kernel: [44114473.614361] somemessage

“44114473.614361”代表自上次启动以来的秒数，从中您可以计算正常运行时间而无需安装任何东西。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2013-11-25T14:01:56.643

Nagios 甚至可以制作非常漂亮的图表。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2020-06-02T06:33:10.923

# 使用系统日志

对于任何来这里寻找他们过去正常运行时间的人。@1800_Information 的解决方案是对未来的一个很好的建议，但我需要找到我过去在特定日期正常运行时间的信息。

因此，我使用 syslog 来确定当天系统何时启动（当天的第一个日志条目）以及系统何时再次关闭。

## 开机时间

要获取月份和日期的系统开始时间 grep 并仅显示第一行：

```
sudo grep "May 28" /var/log/syslog* | head 
```

## 关机时间

要获取月份和日期的系统关闭时间 grep 并仅显示最后几行：

```
sudo grep "May 28" /var/log/syslog* | tail 
```

# perl - 如何使用带有自编译 Perl 和 mod_perl 的供应商 Apache？

> ID：79493
> 
> 赞同：5
> 
> 时间：2008-09-17T02:59:27.587
> 
> 标签：perl, apache, mod-perl

我想使用 Apple 或 RedHat 的内置 Apache，但我想使用 Perl 5.10 和 mod_perl。实现此目的的最少侵入方式是什么？我想要为供应商的 Apache、dav、php 等提供免费安全补丁的优势，但我非常关心我使用的 Perl 版本以及我的 @INC 路径中的内容。我不介意编译我自己的 mod_perl。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-17T13:19:37.720

1.  按照 mod_perl 文档中的任何特殊说明构建您的 Perl 5.10 版本。告诉 Perl 配置器安装在一些非标准的地方，比如 /usr/local/perl/5.10.0

2.  使用说明针对您的发行版的 Apache 构建共享库（或动态或 .so）mod_perl，但请确保使用*您*的 perl 版本运行 Makefile.PL：

    /usr/local/perl/5.10.0/bin/perl Makefile.PL APXS=/usr/bin/apxs

3.  像往常一样安装和配置 mod_perl。

在第一步之后，改变你的路径可能会有所帮助，这样你就不会意外地对你正在使用的 Perl 版本感到困惑：

```
export PATH=/usr/local/perl/5.10.0/bin:$PATH 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-17T03:36:07.997

你会想看看[mod_so](http://httpd.apache.org/docs/2.2/mod/mod_so.html)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-17T04:34:33.957

我以前做过。它不是很漂亮，但它确实有效，特别是因为供应商 perl 通常有 2-3 年的历史。

我开始制作自己的 perl RPM，将 perl 安装到不同的位置，例如`/opt/`. 这很简单。我主要是从这个开始的，因为我不希望使用 perl 的系统实用程序在我升级/安装新模块时中断。我不得不修改我的所有脚本以`#!/opt/bin/perl`在顶部指定，有时我什至使用路径来确保我的 perl 排在第一位。

接下来，我抓取了一个 mod_perl 源 RPM 并将其修改为使用 my`/opt/bin/perl`而不是`/usr/bin/perl`. 我无法访问我所做的更改，因为它是在不同的演出中。我花了一点时间才得到它。

它确实有效，但我不是 RPM 向导，所以依赖性检查效果不佳。例如，我可以卸载我的自定义 RPM 并破坏一切。这对我来说没什么大不了的，所以我继续前进。

我还将 RPM 与模块的 CPAN 安装混合在一起（我有没有提到我们用自己的代码构建了自己的自定义 CPAN 镜像？）。这也有点脆弱。同样，我没有资源（即时间）来弄清楚如何弯曲[cpan2rpm](http://sourceforge.net/projects/cpan2rpm/)以使用我的 perl 而不会导致 RPM 冲突。

如果我要重新做一遍，我会制作一个自定义的 5.10 perl RPM，然后替换系统 perl。然后我将使用`cpan2rpm`创建我的软件所需的 RPM 包并编译我自己的 mod_perl RPM。

# facebook - 如何从其他网站导入 Facebook 好友

> ID：79496
> 
> 赞同：6
> 
> 时间：2008-09-17T02:59:59.567
> 
> 标签：facebook, language-agnostic

我正在寻找一种连接到 Facebook 的方法，允许用户输入他们的用户名和密码，让我们的应用程序连接到他们的帐户并获取他们的联系人，以便他们可以邀请他们加入他们在我们网站上的群组。我以前写过一个 Facebook 应用程序，但这不是一个应用程序，而是一个连接器，这样他们就可以邀请他们所有的朋友或只是一些朋友到我们正在开发的网站。

我见过其他几个网站这样做，并且还连接到 Yahoo、Gmail 和 Hotmail 联系人。我不认为他们使用 Facebook Connect 来做到这一点，因为它太新了，但他们可能是。

任何语言的任何解决方案都可以，因为我可以移植任何示例来使用 C#。我在 Google 或 Facebook 上找不到任何专门解决此特定问题的内容。任何帮助表示赞赏。

我看到第一个答案被删除，这表明我可能需要刮掉朋友页面。我环顾四周，这可能是我需要做的。我认为任何其他方式都需要该人将其添加为应用程序。我想知道如何删除答案，也许那个用户删除了它。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-17T03:17:26.917

没有回答这个问题，但希望能提供一些见解......

像这样的功能告诉人们可以在站点 B 的表单上输入站点 A 的用户名和密码。这绝对是不行的。请不要让人以为是。

但也许 Facebook API 允许您通过让人们登录*Facebook 本身*来授予您的应用程序访问权限来规避这个问题。一个细微但重要的区别。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-10-22T12:30:29.603

您可以使用[Facebook Connect](https://developers.facebook.com/docs/guides/web/)的“帐户链接”。

[来自Facebook 开发者 wiki](https://developers.facebook.com/docs/reference/fbml/request-form/)的 Python/Django 示例：

**页：**

```
def invite_friends(request): 
    #HTML escape function for invitation content. 
    from cgi import escape 
    facebook_uid = request.facebook.uid 

    # Convert the array of friends into a comma-delimeted string. 
    exclude_ids = ",".join([str(a) for a in request.facebook.friends.getAppUsers()]) 

    # Prepare the invitation text that all invited users will receive. 
    content = """<fb:name uid="%s" firstnameonly="true" shownetwork="false"/>       wants to invite you to play Online board games, <fb:req-choice url="%s" label="Put Online Gaming and Video Chat on your profile!"/>""" % (facebook_uid, request.facebook.get_add_url()) 

    invitation_content = escape(content, True) 
    return render_to_response('facebook/invite_friends.fbml',
            {'content': invitation_content, 'exclude_ids': exclude_ids }) 
```

**模板：**

```
<fb:request-form action="http://apps.facebook.com/livevideochat/?skipped=1"     
        method="POST" invite="true" type="Online Games" 
        content="{{ content }}">        

    <fb:multi-friend-selector max="20" 
        actiontext="Here are your friends who aren't using Online Games and Live Video Chat. Invite them to play Games Online today!" 
        showborder="true" rows="5" exclude_ids="{{ exclude_ids }}"> </fb:request-form> 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-06-29T02:22:04.480

我不久前问过这个问题，在 facebook connect 上线之前。真正做到这一点的最好方法是使用 facebook connect。

[http://developers.facebook.com/connect.php?tab=website](http://developers.facebook.com/connect.php?tab=website)

我目前在我们的实时站点上使用它，并在 Codeplex 上使用 Facebook Developer Toolkit for .NET：

[http://www.codeplex.com/FacebookToolkit](http://www.codeplex.com/FacebookToolkit)

祝你好运！

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-18T15:28:14.297

我查了一下，可以回答我自己的帖子，所以就在这里。

事实证明，您将不得不刮掉 Facebook 使用条款中不合法的朋友列表。所以我们不会为我们的网站这样做。这里有几篇文章展示了当你不遵守规则时会发生什么。Plaxo 用 Scoble 测试了他们的抓取，Facebook 在今年 1 月关闭了 Scobles 帐户。

[http://scobleizer.com/2008/01/03/what-i-was-using-to-hit-facebook/](http://scobleizer.com/2008/01/03/what-i-was-using-to-hit-facebook/)

[http://news.cnet.com/8301-13577_3-9839474-36.html](http://news.cnet.com/8301-13577_3-9839474-36.html)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-17T03:12:09.303

似乎 Facebook 对此有一个 api。在此处查看此博客。

[http://developers.facebook.com/news.php?blog=1&story=73](http://developers.facebook.com/news.php?blog=1&story=73)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-13T05:55:44.370

这是一个开源 PHP 5 工具，可让您从电子邮件和一些社交网络（包括 Facebook）导入联系人：[OpenInviter](http://openinviter.com/index.php)是一个开源 PHP 类，用 PHP5 编写，用于从大多数知名电子邮件中导入联系人提供商和社交网络。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2011-07-11T15:16:42.360

只需使用 FB Connect 将它们导入 Yahoo。都好了吗？没有屏幕抓取，没有 FB 违规。完毕。

# jquery - 无法从 JQuery ajax 调用接收 JSON

> ID：79498
> 
> 赞同：11
> 
> 时间：2008-09-17T03:00:04.307
> 
> 标签：jquery, ajax, json

我已经确定来自服务器的 JSON 是有效的（手动进行 ajax 调用），但我真的很想使用 JQuery。我还使用 firebug 确定发送到服务器的“发布”URL 是正确的。但是，错误回调仍在被触发（解析错误）。我也试过数据类型：文本。

我应该包括其他选项吗？

```
$(function() {
    $("#submit").bind("click", function() {
        $.ajax({
            type: "post",
            url: "http://myServer/cgi-bin/broker" ,
            datatype: "json",
            data: {'start' : start,'end' : end},
            error: function(request,error){
                alert(error);
            },
            success: function(request) {
                alert(request.length);
            }
        }); // End ajax
    }); // End bind
}); // End eventlistener 
```

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-09-17T03:22:15.410

以下是我会尝试的一些建议：

1）您指定的“数据类型”选项应该是“数据类型”（我相信区分大小写）

2) 尝试使用 'contentType' 选项：

```
contentType: "application/json; charset=utf-8" 
```

我不确定这将有多大帮助，因为它在对您的帖子网址的请求中使用，而不是在响应中。有关更多信息，请参阅本文： http: [//encosia.com/2008/06/05/3-mistakes-to-avoid-when-using-jquery-with-aspnet-ajax](http://encosia.com/2008/06/05/3-mistakes-to-avoid-when-using-jquery-with-aspnet-ajax) （它是为 asp.net 编写的，但可能适用）

3) 三重检查您的帖子 url 的输出并通过 JSON 验证器运行输出，以绝对确定它是有效的并且可以解析为 JSON 对象。[http://www.jsonlint.com](http://www.jsonlint.com)

希望有些帮助！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-03-12T09:43:36.897

为什么`myResult`而不是`request`？

```
success: function(request) {
  alert(myResult.length);
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-06-22T04:29:51.057

数据参数错误。这是一个有效的示例：

数据：{索引：ddl.selectedIndex}，

这将构造一个具有名为 index 的属性的对象，其值为 ddl.selectedIndex。

您需要从数据参数行中删除引号

祝你好运A

# c# - 实时系统的架构？

> ID：79533
> 
> 赞同：2
> 
> 时间：2008-09-17T03:04:28.010
> 
> 标签：c#, .net, architecture, frameworks, synchronization

我想请教一些关于构建实时系统的架构或技术方面的建议或经验。在我有一些开发“排队管理系统”的经验之前，我已经通过在操作员更改队列号时向所有操作员发送 TcpServer 和 TcpClient 消息来完成。但我认为这个策略有很多复杂和问题。

谁能指导我一些想法或框架？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-17T04:02:26.403

首先：由于 .NET 的非确定性，铁杆实时窥视将在同一句话中使用“.NET”和“实时”提出问题；）

话虽如此，如果您只是在现有实时系统上实现监控或可视化层（例如，实现 SCADA 类型的系统），那么 .NET 应该没问题。那么你的网络架构可以归结为两种情况：

*   客户端从服务器轮询：您创建一个包含大部分流程逻辑的集中式服务器，客户端定期从该服务器轮询。
*   服务器支持发布/订阅机制：客户端订阅服务器的信息，服务器在发生更新时发出更新。

没有一种“正确”的方式来进行上述交流；这在很大程度上取决于更新的大小和频率、网络流量等。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-17T03:22:14.707

我没有从事任何实时工作，但我认为研究[实时 linux](http://www.ibm.com/developerworks/linux/library/l-real-time-linux/)将是了解他们在处理实时应用程序时提出的问题和解决方案的良好开端。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-02T14:01:47.473

我建议看看[QNX](http://www.qnx.com)。

# sql-server - 您可以在 SQL Server 中使用哪些全文搜索工具？

> ID：79536
> 
> 赞同：-1
> 
> 时间：2008-09-17T03:04:37.340
> 
> 标签：sql-server, indexing, full-text-search

除了全文索引和使用 LIKE 关键字之外，还有哪些其他工具可以在 MS SQL 之上构建搜索功能？这个问题特别适用于搜索记录，而不是文件。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-17T03:19:33.357

在 SO podcast 的第 11 集中，Jeff 和 Joel 讨论了 SQL Server 的全文搜索，Joel 的推荐是[Lucene.NET](http://incubator.apache.org/lucene.net/)。[你可以在那一集的文字记录](https://stackoverflow.fogbugz.com/default.asp?W12621)中看到他们的讨论，大约在页面下方的四分之一处。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-17T03:11:04.640

2008 年的[全文搜索功能](http://technet.microsoft.com/en-us/library/cc721269.aspx)得到了改进 - 也许先看看那里..

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-17T03:12:43.387

我相信 MS SQL 2005+ 能够使用正则表达式进行搜索。

MSDN 有一篇关于此[http://msdn.microsoft.com/en-us/magazine/cc163473.aspx](http://msdn.microsoft.com/en-us/magazine/cc163473.aspx)的文章。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-28T14:25:55.713

我在这里记录了我如何在我的 ASP.NET 应用程序 BugTracker.NET 中使用 Lucene.NET：

[http://www.ifdefined.com/blog/post/2009/02/Full-Text-Search-in-ASPNET-using-LuceneNET.aspx](http://www.ifdefined.com/blog/post/2009/02/Full-Text-Search-in-ASPNET-using-LuceneNET.aspx)

# c++ - 哪个是帮助教授编程的最佳 Linux C/C++ 调试器（或 gdb 的前端）？

> ID：79537
> 
> 赞同：108
> 
> 时间：2008-09-17T03:05:11.660
> 
> 标签：c++, linux, debugging

我向新手教授一种“精简版”C++ 编程课程（“精简版”意味着没有指针、没有类，只是普通的旧 C，加上引用和 STL 字符串和向量）。学生之前没有编程经验，所以我相信使用交互式调试器可以帮助他们理解程序流程、变量和递归。

该课程在 Linux 中教授。教他们使用 gdb 只是矫枉过正（他们不会使用或理解大多数功能）。我只需要一些简单但易于使用的东西：查看程序现在在哪一行，堆栈中有什么（局部变量，以前的调用等）。我看起来类似于旧的 Turbo Pascal 或 Turbo C++ Borland 的调试器或 Visual Studio 调试器。

谢谢，

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2008-09-17T03:07:51.903

[ddd](http://www.gnu.org/software/ddd/)是一个非常不错的 gdb 图形前端。缺点之一是经典的 X 界面，但我似乎记得它非常直观。

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2012-01-21T10:48:13.343

您可以尝试使用由 Red Hat 编写的用于 gdb 的图形前端[Insight或者如果您使用 GNOME 桌面环境，您也可以尝试](http://sources.redhat.com/insight)[Nemiver](http://projects.gnome.org/nemiver/)。

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2008-09-17T03:16:36.857

您可能想查看 Eclipse CDT。它提供了一个在多个平台（例如 Windows、Linux、Mac OS X 等）上运行的 C/C++ IDE。使用 Eclipse CDT 进行调试与使用其他工具（例如 Visual Studio）相当。

您可以查看[Eclipse CDT 调试教程](http://download.eclipse.org/tools/cdt/docs/tutorials/debug_tutorial/cdt_w_debug.htm)，其中还包含许多屏幕截图。

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2010-05-05T14:16:17.113

除了其他好东西之外，[Qt Creator还具有良好的调试器集成，适用于所有支持的平台上的 CDB、GDB 和 Symnbian 调试器。](http://qt.nokia.com/products/developer-tools)您无需使用 Qt 即可使用 Qt Creator IDE，也无需使用 QMake - 它还集成了 CMake，尽管 QMake 非常易于使用。

您可能想使用 Qt Creator 作为 IDE 来教授编程，考虑到它有一些很好的特性：

*   非常智能和高级的 C++ 编辑器
*   项目和构建管理工具
*   QMake 和 CMake 集成
*   集成的上下文相关帮助系统
*   优秀的可视化调试器（CDB、GDB 和 Symbian）
*   支持 GCC 和 VC++
*   快速代码导航工具
*   支持 Windows、Linux 和 Mac OS X

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2008-09-17T03:29:13.770

也许它对 gdb 是间接的（因为它是一个 IDE），但我的建议是[KDevelop](http://www.kdevelop.org/ "KDevelop")。被 Visual Studio 的调试器宠坏了（专业工作多年），到目前为止，我觉得在 KDevelop 中调试最舒服（作为家里的爱好，因为我买不起 Visual Studio 供个人使用 - 直到 Express Edition 出来）。与我尝试过的其他 IDE（包括 Eclipse CDT）相比，它在调试单步执行、单步执行等方面确实“看起来类似于”Visual Studio（放置断点有点尴尬，因为我不这样做）编码的时候不喜欢用鼠标太多，但不难）。

# java - 扫描仪无法解析为类型

> ID：79538
> 
> 赞同：0
> 
> 时间：2008-09-17T03:05:13.390
> 
> 标签：java, eclipse, ubuntu

我刚刚安装了 Ubuntu 8.04，并且正在学习 Java 课程，所以我想为什么在安装 IDE 时不安装它。因此，我选择了我选择的 IDE，Eclipse，并制作了一个非常简单的程序 Hello World，以确保一切顺利运行。当我使用 Scanner 进行用户输入时，我得到一个非常奇怪的错误：

**我的代码：**

```
导入 java.util.Scanner；类测试{
    公共静态无效主要（字符串[]参数）{
        扫描仪 sc = new Scanner(System.in);
        System.out.println("hi");
    }
}
```

**输出：**

```
线程“main”java.lang.Error 中的异常：未解决的编译问题：
    扫描仪无法解析为类型
    扫描仪无法解析为类型

   在 test.main(test.java:5)

```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-17T03:08:21.183

Scanner 类是 Java 5 中的新类。我不知道 Hardy 的默认 Java 环境是什么，但它不是 Sun 的，因此可能已经过时。

我建议安装软件包 sun-java6-jdk 以获得最新版本，然后告诉 Eclipse 使用它。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-17T03:10:10.150

如果您使用的是 1.5 之前的 Java 版本，则 java.util.Scanner 不存在。

您的 Eclipse 项目设置使用哪个版本的 JDK？

查看项目、属性、Java 构建路径——查找“JRE 系统库”条目，它旁边应该有一个版本号。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-17T12:18:00.613

也可能是尽管您拥有 JDK 1.5 或更高版本，但该项目设置了一些特定设置，告诉它编译为 1.4。您可以通过 Project >> Properties >> Java Compiler 进行测试，并确保“Compiler Compliance Level”设置为 1.5 或更高。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-23T17:32:14.877

我知道，自从问题发布以来已经有一段时间了。但该解决方案可能仍然会引起任何人的兴趣。其实很简单...

在 Ubuntu 下，您需要将 java 编译器“javac”设置为使用 sun 的 jdk 而不是任何其他替代方案。到目前为止发布的一些答案的不同之处在于我说的是 javac 而不是 java。为此，请启动一个 shell 并执行以下操作：

1.  以 root 或 sudo 身份在命令行输入：

`# update-alternatives --config javac`

2.  找到指向 sun 的 jdk 的数字，输入这个数字，然后点击“ENTER”。

3.  你完成了！从现在开始，您可以在 Ubuntu 下享受 java.util.Scanner 了。

`System.out.println("Say thank you, Mr."); Scanner scanner = java.util.Scanner(System.in); String thanks = scanner.next(); System.out.println("Your welcome.");`

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2020-03-31T20:42:46.253

您导入了 Scanner 但您没有使用它。您正在使用需要用户输入的扫描仪。您试图打印出一件事，但是您将程序暴露给您将使用自己的输入的事实，因此它决定在您提供用户输入后打印“Hello World”。但是由于您没有决定程序将打印什么，因此系统会感到困惑，因为它不知道要打印什么。你需要类似`int a=sc.nextInt();`or的东西`String b=sc.nextLine();`，然后给你的用户输入。但是你说你想要`Hello World!`，所以 Scanner 是多余的。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2021-06-17T07:37:31.120

```
package com.company;

import java.util.Scanner;

public class Main {

    public static void main(String[] args) {
        Scanner in = new Scanner(System.in);
        System.out.print("Input seconds: ");
        int num = in.nextInt();

        for (int i = 1; i <=num; i++) {

            if(i%10==3)
            {
                System.out.println(i);
            }
        }

    }
} 
```

# javascript - 表单和 jQuery

> ID：79541
> 
> 赞同：4
> 
> 时间：2008-09-17T03:06:19.380
> 
> 标签：javascript, jquery, webforms

我正在为我管理的网站创建一个简单的表单。我将 jQuery 用于我的 JavaScript。我注意到大量的 jQuery 和表单插件。有没有人有任何他们觉得特别有用的最爱？特别是，帮助验证的插件将是最有用的。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-17T05:21:30.817

jQuery[表单插件](http://malsup.com/jquery/form/)非常标准。它处理序列化表单字段和 AJAX 提交。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-17T03:09:15.190

[表单验证](http://plugins.jquery.com/project/validate)是我想到的。我认为这里在 SO 中使用。

# asp.net - 脚本资源处理程序

> ID：79542
> 
> 赞同：0
> 
> 时间：2008-09-17T03:06:22.717
> 
> 标签：asp.net, ajax, asp.net-ajax

有谁知道很多关于 Asp.Net webconfig 元素? 我正在查看它，因为我正在现有站点中实现 MS Ajax 更新面板，并且在环顾四周之后，在网络上我没有找到很多关于它的信息。

为了避免大量回复告诉我更新面板效率低下，它实际上并没有提供任何好处等等。我知道！假设我有使用它的理由并将其留在那里。

我想我的主要问题是；设置 enableCompression="true" 和 enableCaching="true" 会以任何方式帮助我的更新面板的性能吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-17T03:10:32.300

鉴于更新面板实际发生的 DOM 遍历通常不是阻碍性能的内容。它是 PC/浏览器。

我知道这正是您不想要的，但除非您的面板包含大量数据，否则压缩和缓存不会对您有很大帮助。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-10T18:16:39.427

我从 scriptresourcehandler 文档中获取了这个：默认情况下，ScriptResourceHandler 类为 Internet Explorer 7 压缩和缓存嵌入的脚本文件。

因此，如果您将 enableCompression/enableCaching 设置为 true，我认为您不会看到任何区别，因为如果您使用的是 IE7，它已经发生了。

# windows - 最好的win32编译脚本语言？

> ID：79582
> 
> 赞同：2
> 
> 时间：2008-09-17T03:15:16.207
> 
> 标签：windows, compiler-construction, scripting

Win32 最好的可编译脚本语言是什么？我更喜欢 .EXE，因为我不想先在服务器上安装运行时（我的公司通过远程管理许多），但我需要能够通过网络执行 NTFS 权限和（如果可能的话）API 之类的事情。

有一个小的 Perl 似乎能够完成大部分工作，但它似乎在很长一段时间内都没有更新/开发。我想知道 Lua，但我不知道它是否具备我需要的一切（并且不想通过 50 个图书馆网站寻找答案）。有什么想法吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-17T03:23:15.483

您是否考虑过使用 EXE 制作工具？例如，您可以在 Python 中编写代码并使用[py2exe](http://www.py2exe.org)创建一个可以在任何地方运行的独立 EXE（它实际上将 Python 打包到 exe 中，因此您不必安装运行时）。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-17T03:27:20.810

Ruby 是我选择的脚本语言。

试试[RubyScript2Exe](http://www.erikveen.dds.nl/rubyscript2exe/)。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-17T03:24:05.390

几乎按照定义，脚本语言不会编译成独立的可执行文件。所以也许你需要重申你的意图或给出一些关于你想要创建什么样的程序的指示。

C# 是一种功能强大的语言，可以编译为 .EXE，并允许您与几乎任何东西进行交互（必要时通过本机 p/invoke 调用）。可以从 Microsoft 网站免费下载一个基本但非常有用的 Visual Studio for C#。.NET 运行时已安装在当今的大多数系统上。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-17T03:56:18.243

你考虑[过 AutoIt](http://www.autoitscript.com/autoit3/)吗？

它是一种脚本语言，您可以快速将脚本转换为 exe...

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-17T04:02:50.180

在 OSCON 2005 上，我听到 Damien Conway 说“唯一比 Perl 更好的是运行良好的东西，即使它不是用 Perl 编写的。”

这是个好建议。与其寻找可以编译为 .EXE 的*最佳*语言，不如更担心用可以编译为.EXE*的*语言编写它。使用任何有效的方法。请记住，您的编程质量比您使用的语言更重要。

也就是说，我喜欢 py2exe。YMMV。祝你好运！

# php - 是否有用于 Javascript 或 PHP 的解析表达式语法 (PEG) 库？

> ID：79584
> 
> 赞同：18
> 
> 时间：2008-09-17T03:15:37.437
> 
> 标签：php, javascript, parsing, generative-programming

我发现自己被用于描述域特定语言的解析表达式语法形式主义所吸引，但到目前为止，我发现的实现代码是用 Java 和 Haskell 等语言编写的，这些语言在我的组织的共享托管环境中对 Web 服务器不友好不得不忍受。

有谁知道任何用于 Javascript 或 PHP 的 PEG 库或 PackRat 解析器生成器？当然，可以生成 Javascript 或 PHP 源代码的任何语言的代码生成器都可以解决问题。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2010-03-19T09:01:53.630

我最近编写[了 PEG.js](http://pegjs.majda.cz/)，一个基于 PEG 的 JavaScript 解析器生成器。它可以从命令行使用，也可以从浏览器中试用。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-09-17T03:20:14.260

事实上，Javascript 有一个：OMeta。[http://www.tinlizzie.org/ometa/](http://www.tinlizzie.org/ometa/)

我还在 Python 中实现了这个版本：http: [//github.com/python-parsley/parsley](http://github.com/python-parsley/parsley)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2011-03-15T22:29:25.817

php PEG [https://github.com/maetl/php-peg](https://github.com/maetl/php-peg)

这个帖子很老了，但我是通过谷歌找到的，应该已经回答了

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2012-11-12T02:46:23.560

[语言.js](http://languagejs.com/)：

> Language.js 是一个基于 PEG（Parsing Expression Grammar）的开源实验性新解析器，特别添加了“naughty OR”运算符，以独特的新方式处理错误。它利用 memoization 实现线性时间解析速度

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-09-01T19:22:31.113

还有用于 JavaScript 的[Kouprey](http://freecode.com/projects/kouprey)，它是一个非常易于使用的 PEG 生成器/库。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-25T07:20:43.550

看看[https://github.com/leblancmeneses/NPEG](https://github.com/leblancmeneses/NPEG) 可以很方便的转换成php。解析树是使用匿名函数创建的。

* * *

## 回答 #7

> 赞同：-3
> 
> 时间：2008-09-17T03:21:22.633

**你看过[ANTLR](http://www.antlr.org/)吗？** 它生成词法分析器和解析器代码，处理抽象语法树，让您插入要注入词法分析器/解析器代码的语法代码，并且**它可用于多种语言！**

# sql - 如何解析存储在 MS SQL 2005 中的 varbinary 中的 excel (.xls) 文件？

> ID：79592
> 
> 赞同：3
> 
> 时间：2008-09-17T03:16:52.253
> 
> 标签：sql, excel, stored-procedures, etl, xls

**问题**

如何最好地解析/访问/提取作为二进制数据存储在 SQL 2005 字段中的“excel 文件”数据？

（因此所有数据最终都可以存储在其他表的其他字段中。）

**背景**

基本上，我们的客户需要来自其用户的大量详细数据。不幸的是，我们的客户不能要求他们的用户进行任何类型的数据库导出。所以我们的客户必须为他们的用户提供某种 UI 来输入数据。我们的客户认为所有用户都可以接受的 UI 非常出色，因为它具有相当强大的 UI。所以考虑到所有这些，我们的客户需要自动解析这些数据并将其存储在他们的数据库中。

我们试图让我们的客户相信用户只会这样做一次，然后坚持使用数据库导出！但客户不能*要求*其用户的数据库导出。

*   我们的客户要求我们解析一个 excel 文件
*   客户的用户使用 excel 作为“最佳”用户界面来输入所有需要的数据
*   为用户提供了必须填写的空白 Excel 模板
    *   这些模板具有固定数量的唯一命名选项卡
    *   这些模板有许多必须完成的固定区域（单元格）
    *   这些模板还有一些区域，用户可以在其中插入多达数千个格式相同的行
*   完成后，用户通过标准 html 文件上传提交 excel 文件
*   我们的客户将此文件原始存储到他们的 SQL 数据库中

**给定**

*   标准 excel (".xls") 文件（本机格式，不是逗号或制表符分隔）
*   文件原始存储在`varbinary(max)`SQL 2005 字段中
*   excel 文件数据在行之间不一定是“统一的”——也就是说，我们不能假设一列都是相同的数据类型（例如，可能有行标题、列标题、空单元格、不同的“格式”， ...)

**要求**

*   代码完全在 SQL 2005 中（存储过程，SSIS？）
*   能够访问任何工作表（选项卡）上的值
*   能够访问任何单元格中的值（无需公式数据或取消引用）
*   单元格值不能假设在行之间是“一致的”——也就是说，我们不能只假设一列都是相同的数据类型（例如，可能有行标题、列标题、空单元格、公式、不同的“格式”，...）

**喜好**

*   没有文件系统访问权限（没有写入临时 .xls 文件）
*   以定义的格式检索值（例如，实际日期值而不是像 39876 这样的原始数字）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-17T03:40:48.500

我的想法是，任何事情都可以做，但要付出代价。在这种特殊情况下，价格似乎太高了。

我没有经过测试的解决方案给你，但我可以分享我如何第一次尝试这样的问题。

我的第一种方法是在 SqlServer 机器上安装 excel 并编写一些程序集以使用 excel API 使用行上的文件，然后将它们作为程序集加载到 Sql server 上。

正如我所说，这只是一个想法，我没有细节，但我相信这里的其他人可以补充或批评我的想法。

但我真正的建议是重新考虑整个项目。读取存储在数据库表格行的单元格中的二进制文件的表格数据是没有意义的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-17T10:12:57.760

这看起来像是一个“我不会从这里开始”的问题。

“在服务器上安装 Excel 并开始编码”的答案看起来是唯一的途径，但它必须首先值得探索替代方案：这将是痛苦的、昂贵的和耗时的。

我强烈认为我们正在寻找一个“要求”，它是错误问题的答案。

什么业务问题正在创造这种需求？是什么驱动了它？尝试[五个为什么](http://en.wikipedia.org/wiki/5_Whys)作为探索历史的一种可能方式。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-08T20:07:53.263

您可以将 varbinary 写入原始文件目标吗？然后使用 Excel Source 作为优先约束中下一步的输入。

我没有尝试过，但这就是我会尝试的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-17T03:21:04.133

听起来您正在尝试将整个数据库表存储在电子表格中，然后存储在单个表的字段中。将数据存储在数据库表中，然后在需要时将其导出为 XLS 不是更简单吗？

如果不打开实例 Excel 并让 Excel 解析工作表引用，我不确定它是否可行。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-18T17:06:52.613

好吧，正如其他人已经指出的那样，整个设置似乎有点扭曲:-)。

如果您确实无法更改要求和整个设置：为什么不探索诸如[Aspose.Cells](http://www.aspose.com/categories/file-format-components/aspose.cells-for-.net-and-java/default.aspx)或[Syncfusion XlsIO](http://www.syncfusion.com/products/xlsio/backoffice/default.aspx)等原生 .NET 组件，它们允许您读取和解释原生 Excel (XLS) 文件。我对两者中的任何一个都非常满意，您应该能够将二进制 Excel 读入 MemoryStream，然后将其输入其中一个 Excel 读取组件，然后就可以了。

因此，通过一些 .NET 开发和 SQL CLR，我想这应该是可行的——不确定这是否是最好的方法，但它应该可以工作。

# c# - 将内部数据元素映射到外部供应商的 XML 模式

> ID：79594
> 
> 赞同：4
> 
> 时间：2008-09-17T03:17:33.033
> 
> 标签：c#, xml, xslt, mapping, coldfusion

我正在考虑使用 Altova MapForce（或类似的东西）来生成 XSLT 和/或 Java 或 C# 类来进行翻译。今天，我们直接从数据库中提取数据并手动构建一个 XML 字符串，然后将其发布到 Web 服务。

应该是 db -> (internal)XML -> XSLT -> (External)XML？你们这些人在广阔的世界里做什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-17T03:22:02.243

我将使用开箱即用的 XML 序列化类之一来生成内部 XML，然后使用 XSLT 转换为外部 XML。您还可以生成一个模式，以强制翻译代码（无论将驱动您的 XSLT 翻译）继续获取它期望翻译的 XML，以防对对象的更改破坏了事情。

市场上有许多 XSLT 编辑器可以帮助您进行映射，但我更喜欢只使用常规的 XML 编辑器。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-17T03:23:04.627

是的，我认为您正在使用 MapForce 走在正确的道路上。如果您不想编写代码来执行实际的转换，MapForce 也可以为您完成。从长远来看，这可能更好，因为它需要维护的代码更少。

除非您确实需要 B2B 集成和编排，否则请避开更昂贵的选项（例如 BizTalk）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-17T03:24:22.127

你用的是什么数据库？Oracle 有一些不错的 XML 映射工具。有一些 Java 绑定工具（一个是[http://java.sun.com/developer/technicalArticles/WebServices/jaxb](http://java.sun.com/developer/technicalArticles/WebServices/jaxb)）。但是，如果您有条件，可以考虑使用内置“to_xml”方法的 Ruby。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-17T03:46:40.780

**提示 #1：避免使用 XSLT。**

工具支持很烂。由此产生的解决方案将是不可维护的。

**提示 #2：消除所有不必要的步骤。**

只需将您的结果集（假设您使用 JDBC 或等效）转换为出站 XML。

**提示#3：假设所有基于模式的工具的使用都是不正确的，并相应地进行计划。**

换句话说，只是假装它。如果您必须喷出一些突变的 SOAP（我知道是冗余的）有效负载，只需模拟一个有效的 SOAP 消息，然后将其转换为模板。速度不烂。

也就是说，最好/正确的答案是使用“XML Writer”风格的解决方案。有几个。

最好的是我写的[LOX (Lightweight Objects for XML)](https://lox.dev.java.net/)。

公共 API 使用 Builder 设计模式。由于幕后的一些魔法，不可能创建格式错误的 XML。

**请注意：**如果 XML 是答案，那么您问错了问题。有时，我们被迫违背自己的意愿以某种方式使用它。发生这种情况时，使用能够最大限度减少开发人员工作量并提高代码可维护性的工具至关重要。

# python - 如何开始处理与网站活动相关的电子邮件？

> ID：79602
> 
> 赞同：1
> 
> 时间：2008-09-17T03:19:29.003
> 
> 标签：python, email

我正在编写一个需要通过电子邮件进行用户交互的 Web 应用程序。我很好奇是否有学习处理电子邮件的最佳实践或推荐来源。我正在用 Python 编写我的应用程序，但我不确定要使用哪个邮件服务器或如何格式化消息或主题行以考虑自动处理。我也在寻找有关处理反弹的指导。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-17T03:31:07.383

这里有一些关于如何自动发送电子邮件的非常严重的问题，这里有一些：

使用电子邮件库。Python 包括一个称为“电子邮件”的方法。这是你的朋友，它会阻止你做任何可悲的错误。[阅读Python 手册](http://docs.python.org/lib/node161.html)中的示例。

一些可以阻止您被垃圾邮件过滤器阻止的要点：

始终从有效的电子邮件地址发送。您必须能够向该地址发送电子邮件并收到它（它可以在收到后进入 /dev/null，但必须可以在那里 /deliver/）。这将阻止执行发件人地址验证的垃圾邮件过滤器阻止您的邮件。

您在 server.sendmail(fromaddr, [toaddr]) 行上发送的电子邮件地址将是退回邮件的地方。电子邮件中的 From: 行是一个完全不同的地址，当用户点击“Reply:”时，邮件将发送至该地址。利用这一点，反弹可以去一个地方，而回复去另一个地方。

将电子邮件发送到本地邮件服务器，我推荐使用 postfix。此本地服务器将接收您的邮件并负责将其发送到您的上游服务器。一旦它被传递到本地服务器，从编程的角度来看它是“发送的”。

如果您的站点位于声誉良好的数据中心的静态 IP 上，请不要害怕直接将邮件中继到 Internet。如果您在一个充满脚本小子和垃圾邮件发送者的数据中心，您将需要通过具有良好声誉的公共 MTA 转发此邮件，希望您能够轻松解决此问题。

不要仅以 HTML 格式发送电子邮件。始终以纯文本和 HTML 格式发送，或者仅以纯文本形式发送。很好，我使用纯文本电子邮件客户端，你不想惹恼我。

确认您没有在您的电子邮件域上运行 SPF，或者将其配置为允许您的服务器发送邮件。通过在您的域上进行 TXT 查找来做到这一点。

```
$ dig google.com txt
...snip...
;; ANSWER SECTION:
google.com.     300 IN  TXT "v=spf1 include:_netblocks.google.com ~all" 
```

正如您从该结果中看到的那样，那里有一个 SPF 记录。如果您没有 SPF，则不会有 TXT 记录。在维基百科上阅读更多关于[SPF 的信息](http://en.wikipedia.org/wiki/Sender_Policy_Framework)。

希望有帮助。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-17T03:44:00.677

有关自动邮件处理的一些一般信息...

首先，邮件服务器“品牌”本身对于广播或接收电子邮件并不重要。它们都支持标准的 smtp/pop3 通信协议。大多数甚至有 IMAP 支持，并有一定程度的垃圾邮件过滤。也就是说，尝试使用当前一代的电子邮件服务器。

其次，请注意，为了减少垃圾邮件，许多接收邮件服务器会简单地丢弃邮件，而不是回复邮件帐户不存在。这意味着您可能不会收到这些。

请记住，通过垃圾邮件过滤器是一门艺术。许多 isp 对重复消息、基于关键字或其他内容*看起来像垃圾邮件的消息等进行监视。这有时与发送的消息数量无关；*我已经看到只有 50 个副本的邮件被 AOL 阻止，即使它们是合法的电子邮件。因此，测试是您的朋友，请查看[维基百科](http://en.wikipedia.org/wiki/Anti-spam_techniques_(e-mail))上关于反垃圾邮件技术的这篇文章。然后确保你没有做那些废话。

**

至于处理消息，请记住它是一个排队系统。通过 POP3 连接到服务器以检索邮件、打开邮件、执行某些操作、删除邮件或将其存档，然后继续。

关于退回，让邮件服务器完成大部分工作。您应该能够将其配置为在无法传递消息时通知服务器上的某个电子邮件帐户。您可以定期检查该帐户并根据需要处理未送达报告。

# css - 如何保存包含所有媒体的公共 html 页面并保留结构

> ID：79612
> 
> 赞同：5
> 
> 时间：2008-09-17T03:21:33.180
> 
> 标签：css, screen-scraping, screen, directory-structure

寻找可以让我抓取 HTML 模型并保持页面完整性的`Linux application` *（或 Firefox 扩展） 。*

Firefox 做得几乎完美，但没有抓取 CSS 中引用的图像。

Firefox 的 Scrapbook 扩展可以获取所有内容，但会扁平化目录结构。

如果所有文件夹都成为页面的子级，我不会非常介意`index`。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-17T03:26:32.077

请参阅[使用 wget 进行网站镜像](http://www.devarticles.com/c/a/Web-Services/Website-Mirroring-With-wget/1/)

```
wget --mirror –w 2 –p --HTML-extension –-convert-links http://www.yourdomain.com 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-17T03:23:50.600

你试过[wget吗？](http://linuxreviews.org/quicktips/wget/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-17T03:28:00.387

`wget -r`做你想做的事，如果没有，有很多标志来配置它。见`man wget`。

另一个选项是`curl`，它更强大。见[http://curl.haxx.se/](http://curl.haxx.se/)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-17T03:26:22.107

[Teleport Pro](http://www.tenmax.com/teleport/pro/home.htm)非常适合这种事情。您可以将它指向完整的网站，它会下载一份本地维护目录结构的副本，并根据需要将绝对链接替换为相对链接。您还可以指定是否要从原始站点链接到的其他第三方网站的内容。

# ruby-on-rails - Ruby/Rails 集合到集合

> ID：79632
> 
> 赞同：6
> 
> 时间：2008-09-17T03:25:18.240
> 
> 标签：ruby-on-rails, ruby

我有一个连接表的两个表 - 这只是伪代码：

```
Library
Book
LibraryBooks 
```

我需要做的是，如果我有图书馆的 id，我想获取该图书馆所有书籍所在的所有图书馆。

因此，如果我有图书馆 1，图书馆 1 中有书 A 和 B，而书 A 和 B 在图书馆 1、2 和 3 中，那么是否有一种优雅的（单行）方法可以在 rails 中做到这一点？

我刚在想：

```
l = Library.find(1)
allLibraries = l.books.libraries 
```

但这似乎不起作用。建议？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-17T10:18:44.753

```
l = Library.find(:all, :include => :books)
l.books.map { |b| b.library_ids }.flatten.uniq 
```

请注意，`map(&:library_ids)`它比`map { |b| b.library_ids }`Ruby 1.8.6 慢，而在 1.9.0 中更快。

我还应该提到，如果你使用`:joins`而不是`include`那里，它会在同一个查询中找到图书馆和相关书籍，从而加快数据库时间。`:joins`但是，只有在图书馆有书的情况下才有效。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-17T03:26:40.407

也许：

```
l.books.map {|b| b.libraries} 
```

或者

```
l.books.map {|b| b.libraries}.flatten.uniq 
```

如果你想把它全部放在一个平面阵列中。

当然，你真的应该把它定义为Library上的一个方法，以维护封装的崇高事业。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-17T03:48:53.567

如果您想要返回一维库数组，并删除重复项。

```
l.books.map{|b| b.libraries}.flatten.uniq 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-17T08:59:40.340

一个问题

```
l.books.map{|b| b.libraries}.flatten.uniq 
```

是它将为 l 中的每一本书生成一个 SQL 调用。更好的方法（假设我了解您的架构）可能是：

```
LibraryBook.find(:all, :conditions => ['book_id IN (?)', l.book_ids]).map(&:library_id).uniq 
```

# java - 在 Windows/Linux/Mac 上的 Java 程序中对全局热键做出反应？

> ID：79658
> 
> 赞同：22
> 
> 时间：2008-09-17T03:28:15.177
> 
> 标签：java, windows, linux, macos, hotkeys

Java6 应用程序位于系统托盘中。它需要使用热键（例如 Super-G 或 Ctrl-Shift-L 等）激活并执行某些操作（例如显示输入框）。

## 我该怎么做：

*   Windows（XP 或 Vista）
*   操作系统/X
*   Linux（Gnome 或 KDE）

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2011-06-21T07:56:12.113

我已经使用 JNA 为 java 中的全局热键编译了一个库。它目前支持 Windows、Linux 和 Mac OSX。它还支持 windows 和 linux 上的媒体键。

如果有人有兴趣，请尝试[https://github.com/tulskiy/jkeymaster](https://github.com/tulskiy/jkeymaster)

我将不胜感激任何反馈。

谢谢你。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-14T18:29:52.220

对于 Linux (X11) 有 JXGrabKey：http: [//sourceforge.net/projects/jxgrabkey/](http://sourceforge.net/projects/jxgrabkey/)

还有一个在 Linux 上获取全局热键的教程：[http ://ubuntuforums.org/showthread.php?t=864566](http://ubuntuforums.org/showthread.php?t=864566)

我还没有找到 OS X 的解决方案。

要为所有 3 个平台构建一些东西，我建议将 JIntellitype（它是 Apache 许可证）剥离为它的全局热键功能，并使用 OS X 和 X11 功能扩展它......

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-09-17T03:33:04.243

如果不使用本机接口，这似乎无法以跨平台方式实现。

在 Windows 上，您可以使用免费的[JIntellitype](http://melloware.com/products/jintellitype/index.html)库。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-10-27T17:31:43.667

If anyone wants to do the OSX or Linux versions of the JNI part of Jintellitype I would be more than happy to add those to the JIntellitype library.

Melloware

[http://www.melloware.com](http://www.melloware.com)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-05-23T10:48:42.397

我发现[这个](http://biletnikov-dev.blogspot.com/2009/09/global-hotkeys-for-java-applications_25.html)解决方案在 Windows 上工作得很好。它不需要您安装任何软件，例如 JIntelliType。请注意，这是 32 位 dll，您可以为 64 位 JVM 重新编译。所有学分归于博客的原作者。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2020-11-29T23:54:23.077

我在这里为全局键/鼠标事件编写了一个 Java 库。这适用于 Windows、Linux X11 和 OSX。

[https://github.com/repeats/SimpleNativeHooks](https://github.com/repeats/SimpleNativeHooks)

# java - 用于输入日期的 Java JFormattedTextField

> ID：79662
> 
> 赞同：1
> 
> 时间：2008-09-17T03:29:03.147
> 
> 标签：java, validation, date, mask

我一直无法使 JFormattedTextField 使用格式为 dd/MM/yyyy 的日期。具体来说，当用户键入时，光标应该“跳过”斜线，并直接到达下一个数字位置。

此外，JFormattedTextField 必须验证输入的日期是否有效，如果日期无效则以某种方式拒绝它，或者将其“更正”为有效日期，例如如果用户输入“13”作为月份，则将其设置为“01 " 并将 +1 添加到年份。

我尝试使用带有 JFormattedTextField 的 validate() 方法的掩码（“##/##/####”）来检查日期是否有效，但似乎这两者不能很好地协同工作（或者我'我在 Java 上太绿了，不知道如何...... :)，然后用户可以在该字段上键入任何内容。

非常感谢任何帮助！谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-17T03:31:39.100

尝试使用 JCalendar

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-17T13:14:45.470

您可能必须使用常规 JTextField 并使用自定义文档调用 setDocument()。我建议扩展 PlainDocument，这样可以在文档更改时轻松验证输入，并根据需要添加斜杠。

# sql-server - 如何最好地在 MS SQL Server 中复制整个数据库？

> ID：79669
> 
> 赞同：22
> 
> 时间：2008-09-17T03:30:37.883
> 
> 标签：sql-server, database

我需要将大约 40 个数据库从一台服务器复制到另一台服务器。新数据库应该有新的名称，但所有的表、数据和索引都与原始数据库相同。到目前为止，我一直：

1) 创建每个目标数据库
2) 使用“ [Tasks->Export Data](http://msdn.microsoft.com/en-us/library/ms140052.aspx) ”命令分别为每个数据库创建和填充表
3) 使用 SQL 脚本重建每个数据库的所有索引

每个数据库只有三个步骤，但我敢打赌有一个更简单的方法。那里有任何 MS SQL Server 专家有什么建议吗？

* * *

## 回答 #1

> 赞同：47
> 
> 时间：2008-09-17T03:34:50.450

鉴于您在多个数据库上执行此操作——您需要一个简单的脚本解决方案，而不是点击式解决方案。

这是我保留的备份脚本。让它为一个文件工作，然后为多个文件修改它。

```
(on source server...)
BACKUP DATABASE Northwind
  TO DISK = 'c:\Northwind.bak'

(target server...)
RESTORE FILELISTONLY
  FROM DISK = 'c:\Northwind.bak'

(look at the device names... and determine where you want the mdf and
ldf files to go on this target server)

RESTORE DATABASE TestDB
  FROM DISK = 'c:\Northwind.bak'
  WITH MOVE 'Northwind' TO 'c:\test\testdb.mdf',
  MOVE 'Northwind_log' TO 'c:\test\testdb.ldf'
GO 
```

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-09-17T03:33:43.790

也许最简单的是分离/重新连接。右键单击数据库上的服务器管理器，任务 --> 分离。然后将 MDF/LDF 文件复制到新服务器，然后通过单击服务器图标和任务--> 附加重新附加。它会要求您提供 MDF 文件 - 确保名称等准确无误。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-17T03:38:08.333

为了方便

*   stop server/fcopy/attach 可能是最简单的。
*   备份/恢复 - 可以非常简单和容易地断开连接
*   传输 DTS 任务 - 需要文件复制权限
*   复制 - 最简单的设置

考虑目标服务器上的权限、用户和组的事情，尤其是。如果您正在转移或恢复。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-17T05:15:39.410

***已经有更好的答案，但这是一个“也跑”，因为它只是另一种选择。***

对于免费的低价，您可以查看[Microsoft SQL Server 数据库发布向导](http://www.microsoft.com/downloads/details.aspx?familyid=56E5B1C5-BF17-42E0-A410-371A838E570A&displaylang=en)。此工具允许您编写模式、数据或数据和模式的脚本。Plus 可以从 UI 或命令行运行<-想想 CI 过程。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-17T03:31:35.980

备份 -> 恢复是最简单的，如果不使用复制的话。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-17T11:35:10.903

如果您使用备份/恢复解决方案，您可能会有孤立的用户，因此请务必查看这篇关于如何修复它们的[文章<microsoft>。](http://technet.microsoft.com/en-us/library/ms175475.aspx)

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-11-30T05:48:07.537

另一个快速简单的检查方法：

简单的 SQL 批量复制

[http://projects.c3o.com/files/3/plugins/entry11.aspx](http://projects.c3o.com/files/3/plugins/entry11.aspx)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-17T03:32:40.097

使用企业管理器中的标准 SQL 备份工具备份数据库，然后当您在第二台服务器上恢复时，您可以指定新数据库的名称。

这是完整维护模式的最佳方式。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-17T03:32:57.053

使用备份将数据库恢复到具有新名称的新服务器。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-17T03:40:12.400

Redgate SQL 比较和 SQL 数据比较。迄今为止，比较捆绑包是我为之工作的公司所做的最好的投资。移动电子培训内容轻而易举。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-06-30T17:31:37.817

检查这些链接：

*   [对于多个数据库的备份](http://ysgitdiary.blogspot.com/2009/06/backup-sql-server-2005-2008-databases.html)
*   [和单数据库恢复](http://ysgitdiary.blogspot.com/2009/06/restore-db-from-file-on-sql-server-2005.html)

# c++ - 做定点数学的最佳方法是什么？

> ID：79677
> 
> 赞同：54
> 
> 时间：2008-09-17T03:32:07.630
> 
> 标签：c++, fixed-point

我需要为没有 FPU 的 Nintendo DS 加速一个程序，所以我需要将浮点数学（模拟且缓慢）更改为定点。

我是如何开始的，我将浮点数更改为整数，每当需要转换它们时，我使用**x>>8**将定点变量 x 转换为实际数字，并使用**x<<8**转换为定点。很快我发现不可能跟踪需要转换的内容，并且我还意识到很难更改数字的精度（在这种情况下为 8。）

我的问题是，我应该如何使这更容易并且仍然快速？我应该制作一个 FixedPoint 类，还是只制作一个 FixedPoint8 typedef 或带有一些函数/宏的结构来转换它们，或者其他什么？我应该在变量名中添加一些东西来显示它的定点吗？

* * *

## 回答 #1

> 赞同：54
> 
> 时间：2008-09-17T04:20:52.443

你可以试试我的定点类（最新可用@ [https://github.com/eteran/cpp-utilities](https://github.com/eteran/cpp-utilities)）

```
// From: https://github.com/eteran/cpp-utilities/edit/master/Fixed.h
// See also: http://stackoverflow.com/questions/79677/whats-the-best-way-to-do-fixed-point-math
/*
 * The MIT License (MIT)
 * 
 * Copyright (c) 2015 Evan Teran
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 */

#ifndef FIXED_H_
#define FIXED_H_

#include <ostream>
#include <exception>
#include <cstddef> // for size_t
#include <cstdint>
#include <type_traits>

#include <boost/operators.hpp>

namespace numeric {

template <size_t I, size_t F>
class Fixed;

namespace detail {

// helper templates to make magic with types :)
// these allow us to determine resonable types from
// a desired size, they also let us infer the next largest type
// from a type which is nice for the division op
template <size_t T>
struct type_from_size {
    static const bool is_specialized = false;
    typedef void      value_type;
};

#if defined(__GNUC__) && defined(__x86_64__)
template <>
struct type_from_size<128> {
    static const bool           is_specialized = true;
    static const size_t         size = 128;
    typedef __int128            value_type;
    typedef unsigned __int128   unsigned_type;
    typedef __int128            signed_type;
    typedef type_from_size<256> next_size;
};
#endif

template <>
struct type_from_size<64> {
    static const bool           is_specialized = true;
    static const size_t         size = 64;
    typedef int64_t             value_type;
    typedef uint64_t            unsigned_type;
    typedef int64_t             signed_type;
    typedef type_from_size<128> next_size;
};

template <>
struct type_from_size<32> {
    static const bool          is_specialized = true;
    static const size_t        size = 32;
    typedef int32_t            value_type;
    typedef uint32_t           unsigned_type;
    typedef int32_t            signed_type;
    typedef type_from_size<64> next_size;
};

template <>
struct type_from_size<16> {
    static const bool          is_specialized = true;
    static const size_t        size = 16;
    typedef int16_t            value_type;
    typedef uint16_t           unsigned_type;
    typedef int16_t            signed_type;
    typedef type_from_size<32> next_size;
};

template <>
struct type_from_size<8> {
    static const bool          is_specialized = true;
    static const size_t        size = 8;
    typedef int8_t             value_type;
    typedef uint8_t            unsigned_type;
    typedef int8_t             signed_type;
    typedef type_from_size<16> next_size;
};

// this is to assist in adding support for non-native base
// types (for adding big-int support), this should be fine
// unless your bit-int class doesn't nicely support casting
template <class B, class N>
B next_to_base(const N& rhs) {
    return static_cast<B>(rhs);
}

struct divide_by_zero : std::exception {
};

template <size_t I, size_t F>
Fixed<I,F> divide(const Fixed<I,F> &numerator, const Fixed<I,F> &denominator, Fixed<I,F> &remainder, typename std::enable_if<type_from_size<I+F>::next_size::is_specialized>::type* = 0) {

    typedef typename Fixed<I,F>::next_type next_type;
    typedef typename Fixed<I,F>::base_type base_type;
    static const size_t fractional_bits = Fixed<I,F>::fractional_bits;

    next_type t(numerator.to_raw());
    t <<= fractional_bits;

    Fixed<I,F> quotient;

    quotient  = Fixed<I,F>::from_base(next_to_base<base_type>(t / denominator.to_raw()));
    remainder = Fixed<I,F>::from_base(next_to_base<base_type>(t % denominator.to_raw()));

    return quotient;
}

template <size_t I, size_t F>
Fixed<I,F> divide(Fixed<I,F> numerator, Fixed<I,F> denominator, Fixed<I,F> &remainder, typename std::enable_if<!type_from_size<I+F>::next_size::is_specialized>::type* = 0) {

    // NOTE(eteran): division is broken for large types :-(
    // especially when dealing with negative quantities

    typedef typename Fixed<I,F>::base_type     base_type;
    typedef typename Fixed<I,F>::unsigned_type unsigned_type;

    static const int bits = Fixed<I,F>::total_bits;

    if(denominator == 0) {
        throw divide_by_zero();
    } else {

        int sign = 0;

        Fixed<I,F> quotient;

        if(numerator < 0) {
            sign ^= 1;
            numerator = -numerator;
        }

        if(denominator < 0) {
            sign ^= 1;
            denominator = -denominator;
        }

            base_type n      = numerator.to_raw();
            base_type d      = denominator.to_raw();
            base_type x      = 1;
            base_type answer = 0;

            // egyptian division algorithm
            while((n >= d) && (((d >> (bits - 1)) & 1) == 0)) {
                x <<= 1;
                d <<= 1;
            }

            while(x != 0) {
                if(n >= d) {
                    n      -= d;
                    answer += x;
                }

                x >>= 1;
                d >>= 1;
            }

            unsigned_type l1 = n;
            unsigned_type l2 = denominator.to_raw();

            // calculate the lower bits (needs to be unsigned)
            // unfortunately for many fractions this overflows the type still :-/
            const unsigned_type lo = (static_cast<unsigned_type>(n) << F) / denominator.to_raw();

            quotient  = Fixed<I,F>::from_base((answer << F) | lo);
            remainder = n;

        if(sign) {
            quotient = -quotient;
        }

        return quotient;
    }
}

// this is the usual implementation of multiplication
template <size_t I, size_t F>
void multiply(const Fixed<I,F> &lhs, const Fixed<I,F> &rhs, Fixed<I,F> &result, typename std::enable_if<type_from_size<I+F>::next_size::is_specialized>::type* = 0) {

    typedef typename Fixed<I,F>::next_type next_type;
    typedef typename Fixed<I,F>::base_type base_type;

    static const size_t fractional_bits = Fixed<I,F>::fractional_bits;

    next_type t(static_cast<next_type>(lhs.to_raw()) * static_cast<next_type>(rhs.to_raw()));
    t >>= fractional_bits;
    result = Fixed<I,F>::from_base(next_to_base<base_type>(t));
}

// this is the fall back version we use when we don't have a next size
// it is slightly slower, but is more robust since it doesn't
// require and upgraded type
template <size_t I, size_t F>
void multiply(const Fixed<I,F> &lhs, const Fixed<I,F> &rhs, Fixed<I,F> &result, typename std::enable_if<!type_from_size<I+F>::next_size::is_specialized>::type* = 0) {

    typedef typename Fixed<I,F>::base_type base_type;

    static const size_t fractional_bits = Fixed<I,F>::fractional_bits;
    static const size_t integer_mask    = Fixed<I,F>::integer_mask;
    static const size_t fractional_mask = Fixed<I,F>::fractional_mask;

    // more costly but doesn't need a larger type
    const base_type a_hi = (lhs.to_raw() & integer_mask) >> fractional_bits;
    const base_type b_hi = (rhs.to_raw() & integer_mask) >> fractional_bits;
    const base_type a_lo = (lhs.to_raw() & fractional_mask);
    const base_type b_lo = (rhs.to_raw() & fractional_mask);

    const base_type x1 = a_hi * b_hi;
    const base_type x2 = a_hi * b_lo;
    const base_type x3 = a_lo * b_hi;
    const base_type x4 = a_lo * b_lo;

    result = Fixed<I,F>::from_base((x1 << fractional_bits) + (x3 + x2) + (x4 >> fractional_bits));

}
}

/*
 * inheriting from boost::operators enables us to be a drop in replacement for base types
 * without having to specify all the different versions of operators manually
 */
template <size_t I, size_t F>
class Fixed : boost::operators<Fixed<I,F>> {
    static_assert(detail::type_from_size<I + F>::is_specialized, "invalid combination of sizes");

public:
    static const size_t fractional_bits = F;
    static const size_t integer_bits    = I;
    static const size_t total_bits      = I + F;

    typedef detail::type_from_size<total_bits>             base_type_info;

    typedef typename base_type_info::value_type            base_type;
    typedef typename base_type_info::next_size::value_type next_type;
    typedef typename base_type_info::unsigned_type         unsigned_type;

public:
    static const size_t base_size          = base_type_info::size;
    static const base_type fractional_mask = ~((~base_type(0)) << fractional_bits);
    static const base_type integer_mask    = ~fractional_mask;

public:
    static const base_type one = base_type(1) << fractional_bits;

public: // constructors
    Fixed() : data_(0) {
    }

    Fixed(long n) : data_(base_type(n) << fractional_bits) {
        // TODO(eteran): assert in range!
    }

    Fixed(unsigned long n) : data_(base_type(n) << fractional_bits) {
        // TODO(eteran): assert in range!
    }

    Fixed(int n) : data_(base_type(n) << fractional_bits) {
        // TODO(eteran): assert in range!
    }

    Fixed(unsigned int n) : data_(base_type(n) << fractional_bits) {
        // TODO(eteran): assert in range!
    }

    Fixed(float n) : data_(static_cast<base_type>(n * one)) {
        // TODO(eteran): assert in range!
    }

    Fixed(double n) : data_(static_cast<base_type>(n * one))  {
        // TODO(eteran): assert in range!
    }

    Fixed(const Fixed &o) : data_(o.data_) {
    }

    Fixed& operator=(const Fixed &o) {
        data_ = o.data_;
        return *this;
    }

private:
    // this makes it simpler to create a fixed point object from
    // a native type without scaling
    // use "Fixed::from_base" in order to perform this.
    struct NoScale {};

    Fixed(base_type n, const NoScale &) : data_(n) {
    }

public:
    static Fixed from_base(base_type n) {
        return Fixed(n, NoScale());
    }

public: // comparison operators
    bool operator==(const Fixed &o) const {
        return data_ == o.data_;
    }

    bool operator<(const Fixed &o) const {
        return data_ < o.data_;
    }

public: // unary operators
    bool operator!() const {
        return !data_;
    }

    Fixed operator~() const {
        Fixed t(*this);
        t.data_ = ~t.data_;
        return t;
    }

    Fixed operator-() const {
        Fixed t(*this);
        t.data_ = -t.data_;
        return t;
    }

    Fixed operator+() const {
        return *this;
    }

    Fixed& operator++() {
        data_ += one;
        return *this;
    }

    Fixed& operator--() {
        data_ -= one;
        return *this;
    }

public: // basic math operators
    Fixed& operator+=(const Fixed &n) {
        data_ += n.data_;
        return *this;
    }

    Fixed& operator-=(const Fixed &n) {
        data_ -= n.data_;
        return *this;
    }

    Fixed& operator&=(const Fixed &n) {
        data_ &= n.data_;
        return *this;
    }

    Fixed& operator|=(const Fixed &n) {
        data_ |= n.data_;
        return *this;
    }

    Fixed& operator^=(const Fixed &n) {
        data_ ^= n.data_;
        return *this;
    }

    Fixed& operator*=(const Fixed &n) {
        detail::multiply(*this, n, *this);
        return *this;
    }

    Fixed& operator/=(const Fixed &n) {
        Fixed temp;
        *this = detail::divide(*this, n, temp);
        return *this;
    }

    Fixed& operator>>=(const Fixed &n) {
        data_ >>= n.to_int();
        return *this;
    }

    Fixed& operator<<=(const Fixed &n) {
        data_ <<= n.to_int();
        return *this;
    }

public: // conversion to basic types
    int to_int() const {
        return (data_ & integer_mask) >> fractional_bits;
    }

    unsigned int to_uint() const {
        return (data_ & integer_mask) >> fractional_bits;
    }

    float to_float() const {
        return static_cast<float>(data_) / Fixed::one;
    }

    double to_double() const        {
        return static_cast<double>(data_) / Fixed::one;
    }

    base_type to_raw() const {
        return data_;
    }

public:
    void swap(Fixed &rhs) {
        using std::swap;
        swap(data_, rhs.data_);
    }

public:
    base_type data_;
};

// if we have the same fractional portion, but differing integer portions, we trivially upgrade the smaller type
template <size_t I1, size_t I2, size_t F>
typename std::conditional<I1 >= I2, Fixed<I1,F>, Fixed<I2,F>>::type operator+(const Fixed<I1,F> &lhs, const Fixed<I2,F> &rhs) {

    typedef typename std::conditional<
        I1 >= I2,
        Fixed<I1,F>,
        Fixed<I2,F>
    >::type T;

    const T l = T::from_base(lhs.to_raw());
    const T r = T::from_base(rhs.to_raw());
    return l + r;
}

template <size_t I1, size_t I2, size_t F>
typename std::conditional<I1 >= I2, Fixed<I1,F>, Fixed<I2,F>>::type operator-(const Fixed<I1,F> &lhs, const Fixed<I2,F> &rhs) {

    typedef typename std::conditional<
        I1 >= I2,
        Fixed<I1,F>,
        Fixed<I2,F>
    >::type T;

    const T l = T::from_base(lhs.to_raw());
    const T r = T::from_base(rhs.to_raw());
    return l - r;
}

template <size_t I1, size_t I2, size_t F>
typename std::conditional<I1 >= I2, Fixed<I1,F>, Fixed<I2,F>>::type operator*(const Fixed<I1,F> &lhs, const Fixed<I2,F> &rhs) {

    typedef typename std::conditional<
        I1 >= I2,
        Fixed<I1,F>,
        Fixed<I2,F>
    >::type T;

    const T l = T::from_base(lhs.to_raw());
    const T r = T::from_base(rhs.to_raw());
    return l * r;
}

template <size_t I1, size_t I2, size_t F>
typename std::conditional<I1 >= I2, Fixed<I1,F>, Fixed<I2,F>>::type operator/(const Fixed<I1,F> &lhs, const Fixed<I2,F> &rhs) {

    typedef typename std::conditional<
        I1 >= I2,
        Fixed<I1,F>,
        Fixed<I2,F>
    >::type T;

    const T l = T::from_base(lhs.to_raw());
    const T r = T::from_base(rhs.to_raw());
    return l / r;
}

template <size_t I, size_t F>
std::ostream &operator<<(std::ostream &os, const Fixed<I,F> &f) {
    os << f.to_double();
    return os;
}

template <size_t I, size_t F>
const size_t Fixed<I,F>::fractional_bits;

template <size_t I, size_t F>
const size_t Fixed<I,F>::integer_bits;

template <size_t I, size_t F>
const size_t Fixed<I,F>::total_bits;

}

#endif 
```

它被设计成几乎可以替代浮点数/双精度数，并且具有可选择的精度。它确实使用 boost 来添加所有必要的数学运算符重载，所以你也需要它（我相信这只是一个头文件依赖，而不是库依赖）。

顺便说一句，常见的用法可能是这样的：

```
using namespace numeric;
typedef Fixed<16, 16> fixed;
fixed f; 
```

唯一真正的规则是数字必须加起来等于系统的本机大小，例如 8、16、32、64。

* * *

## 回答 #2

> 赞同：34
> 
> 时间：2008-09-17T03:42:55.593

在现代 C++ 实现中，使用简单和精简的抽象（例如具体类）不会降低性能。定点计算**正是**使用适当设计的类可以避免大量错误的地方。

因此，**您应该编写一个 FixedPoint8 类**。彻底测试和调试它。如果您必须说服自己与使用普通整数相比它的性能，请测量它。

通过将定点计算的复杂性转移到一个地方，它将使您免于许多麻烦。

`FixedPoint8`如果您愿意，您可以通过将其设置为模板并将旧的替换为，例如，进一步增加您的类的实用性，`typedef FixedPoint<short, 8> FixedPoint8;`但是在您的目标架构上，这可能不是必需的，因此首先要避免模板的复杂性。

互联网上的某个地方可能有一个很好的定点类 - 我会开始从[Boost](http://www.boost.org/)库中查找。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-09-17T03:50:55.823

您的浮点代码是否真的使用小数点？如果是这样：

首先，您必须阅读 Randy Yates 关于定点数学简介的论文： [http ://www.digitalsignallabs.com/fp.pdf](http://www.digitalsignallabs.com/fp.pdf)

然后，您需要对浮点代码进行“分析”，以找出代码中“关键”点所需的定点值的适当范围，例如 U(5,3) = 左侧 5 位，3 位右边，未署名。

此时，可以套用上述论文中的算术规则；规则指定如何解释算术运算产生的位。您可以编写宏或函数来执行这些操作。

保留浮点版本很方便，以便比较浮点与定点的结果。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2008-09-17T03:49:09.243

如果没有特殊的硬件来处理它，我根本不会在 CPU 上使用浮点。我的建议是将所有数字视为缩放到特定因子的整数。例如，所有货币值都以整数表示的美分，而不是浮点数表示的美元。例如，0.72 表示为整数 72。

加法和减法是一个非常简单的整数运算，例如（0.72 + 1 变为 72 + 100 变为 172 变为 1.72）。

乘法稍微复杂一些，因为它需要一个整数乘法，然后是一个比例缩减，例如（0.72 * 2 变成 72 * 200 变成 14400 变成 144（缩减）变成 1.44）。

这可能需要特殊函数来执行更复杂的数学运算（正弦、余弦等），但即使是那些也可以通过使用查找表来加速。示例：由于您使用的是固定 2 表示，因此 (0.0,1] (0-99) 范围内只有 100 个值，并且 sin/cos 在此范围之外重复，因此您只需要一个 100 整数查找表。

干杯，帕克斯。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-09-17T03:37:32.220

更改定点表示通常称为“缩放”。

如果你可以用一个没有性能损失的类来做到这一点，那么这就是要走的路。它在很大程度上取决于编译器及其内联方式。如果使用类会降低性能，那么您需要更传统的 C 风格方法。OOP 方法将为您提供传统实现仅近似的编译器强制类型安全。

@cibyr 有一个很好的 OOP 实现。现在换一种更传统的。

要跟踪缩放了哪些变量，您需要使用一致的约定。在每个变量名的末尾做一个符号表示该值是否被缩放，并编写宏 SCALE() 和 UNSCALE() 扩展为 x>>8 和 x<<8。

```
#define SCALE(x) (x>>8)
#define UNSCALE(x) (x<<8)

xPositionUnscaled = UNSCALE(10);
xPositionScaled = SCALE(xPositionUnscaled); 
```

使用这么多符号似乎是一项额外的工作，但请注意如何在不查看其他行的情况下一眼看出任何行是正确的。例如：

```
xPositionScaled = SCALE(xPositionScaled); 
```

显然是错误的，通过检查。

这是[Joel 在这篇文章中提到的](http://www.joelonsoftware.com/articles/Wrong.html)**Apps Hungarian**理念的一种变体。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2008-09-17T05:26:16.017

当我第一次遇到定点数时，我发现 Joe Lemieux 的文章[Fixed-point Math in C](http://www.embedded.com/columns/15201575?_requestid=65598)非常有帮助，它确实提出了一种表示定点值的方法。

不过，我并没有最终使用他的联合表示来表示定点数。我主要有 C 中定点的经验，所以我也没有选择使用类。不过，在大多数情况下，我认为在宏中定义小数位数并使用描述性变量名称会使这很容易使用。另外，我发现最好有用于乘法，尤其是除法的宏或函数，否则你很快就会得到不可读的代码。

例如，使用 24.8 值：

```
 #include "stdio.h"

/* Declarations for fixed point stuff */

typedef int int_fixed;

#define FRACT_BITS 8
#define FIXED_POINT_ONE (1 << FRACT_BITS)
#define MAKE_INT_FIXED(x) ((x) << FRACT_BITS)
#define MAKE_FLOAT_FIXED(x) ((int_fixed)((x) * FIXED_POINT_ONE))
#define MAKE_FIXED_INT(x) ((x) >> FRACT_BITS)
#define MAKE_FIXED_FLOAT(x) (((float)(x)) / FIXED_POINT_ONE)

#define FIXED_MULT(x, y) ((x)*(y) >> FRACT_BITS)
#define FIXED_DIV(x, y) (((x)<<FRACT_BITS) / (y))

/* tests */
int main()
{
    int_fixed fixed_x = MAKE_FLOAT_FIXED( 4.5f );
    int_fixed fixed_y = MAKE_INT_FIXED( 2 );

    int_fixed fixed_result = FIXED_MULT( fixed_x, fixed_y );
    printf( "%.1f\n", MAKE_FIXED_FLOAT( fixed_result ) );

    fixed_result = FIXED_DIV( fixed_result, fixed_y );
    printf( "%.1f\n", MAKE_FIXED_FLOAT( fixed_result ) );

    return 0;
} 
```

哪个写出来

```
9.0
4.5

```

请注意，这些宏存在各种整数溢出问题，我只是想让宏保持简单。这只是我如何在 C 中完成此操作的一个快速而肮脏的示例。在 C++ 中，您可以使用运算符重载使事情变得更清晰。实际上，您也可以轻松地使 C 代码更漂亮......

我想这是一种冗长的说法：我认为使用 typedef 和宏方法是可以的。只要您清楚哪些变量包含定点值，维护起来并不难，但它可能不会像 C++ 类那样漂亮。

如果我处于你的位置，我会尝试获取一些分析数据来显示瓶颈在哪里。如果它们相对较少，则使用 typedef 和宏。如果您决定需要用定点数学全局替换所有浮点数，那么您可能会更好地使用一个类。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-09-17T03:40:54.850

[Tricks of the Game Programming Gurus](https://rads.stackoverflow.com/amzn/click/com/0672305070)的原始版本有一整章是关于实现定点数学的。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-09-17T03:48:10.167

```
template <int precision = 8> class FixedPoint {
private:
    int val_;
public:
    inline FixedPoint(int val) : val_ (val << precision) {};
    inline operator int() { return val_ >> precision; }
    // Other operators...
}; 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-17T03:37:08.087

无论您决定采用哪种方式（我倾向于使用 typedef 和一些 CPP 宏进行转换），您都需要小心谨慎地来回转换。

您可能会发现您永远不需要来回转换。想象一下整个系统中的一切都是 x256。

# sql - 在 MS SQL 中计算百分位排名

> ID：79688
> 
> 赞同：26
> 
> 时间：2008-09-17T03:34:25.787
> 
> 标签：sql, sql-server, math

在 MSSQL 2005 中计算百分位排名（例如第 90 个百分位或中位数分数）的最佳方法是什么？

我希望能够为单个分数列选择第 25、中位数和第 75 个百分位数（最好在单个记录中，以便我可以结合平均值、最大值和最小值）。例如，结果的表输出可能是：

```
Group  MinScore  MaxScore  AvgScore  pct25  median  pct75
-----  --------  --------  --------  -----  ------  -----
T1     52        96        74        68     76      84
T2     48        98        74        68     75      85 
```

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-09-17T04:28:03.003

我认为这将是最简单的解决方案：

```
SELECT TOP N PERCENT FROM TheTable ORDER BY TheScore DESC 
```

其中 N = (100 - 所需百分位数)。因此，如果您希望所有行都在第 90 个百分位，您将选择前 10%。

我不确定您所说的“最好在单个记录中”是什么意思。您的意思是计算单个记录的给定分数将落入哪个百分位？例如，您是否希望能够做出诸如“您的分数是 83，这使您处于第 91 个百分位”之类的陈述。?

编辑：好的，我对您的问题进行了更多思考，并提出了这种解释。您是否在问如何计算特定百分位数的截止分数？例如这样的事情：要进入第 90 个百分位，您的分数必须大于 78。

如果是这样，则此查询有效。我不喜欢子查询，所以根据它的用途，我可能会尝试找到一个更优雅的解决方案。但是，它确实返回具有单个分数的单个记录。

```
-- Find the minimum score for all scores in the 90th percentile
SELECT Min(subq.TheScore) FROM
(SELECT TOP 10 PERCENT TheScore FROM TheTable
ORDER BY TheScore DESC) AS subq 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2011-06-28T20:42:40.940

查看 NTILE 命令——它会很容易地给你百分位数！

```
SELECT  SalesOrderID, 
    OrderQty,
    RowNum = Row_Number() OVER(Order By OrderQty),
    Rnk = RANK() OVER(ORDER BY OrderQty),
    DenseRnk = DENSE_RANK() OVER(ORDER BY OrderQty),
    NTile4  = NTILE(4) OVER(ORDER BY OrderQty)
FROM Sales.SalesOrderDetail 
WHERE SalesOrderID IN (43689, 63181) 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-09-05T23:24:14.127

这个怎么样：

```
SELECT
  Group,
  75_percentile =  MAX(case when NTILE(4) OVER(ORDER BY score ASC) = 3 then score  else 0 end),
  90_percentile =  MAX(case when NTILE(10) OVER(ORDER BY score  ASC) = 9 then score  else 0 end)     
FROM TheScore
GROUP BY Group 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-05T00:13:13.427

我一直在努力解决这个问题，这就是我到目前为止的想法：

```
CREATE PROCEDURE [dbo].[TestGetPercentile]

@percentile as float,
@resultval as float output

AS

BEGIN

WITH scores(score, prev_rank, curr_rank, next_rank) AS (
    SELECT dblScore,
        (ROW_NUMBER() OVER ( ORDER BY dblScore ) - 1.0) / ((SELECT COUNT(*) FROM TestScores) + 1)  [prev_rank],
        (ROW_NUMBER() OVER ( ORDER BY dblScore ) + 0.0) / ((SELECT COUNT(*) FROM TestScores) + 1)  [curr_rank],
        (ROW_NUMBER() OVER ( ORDER BY dblScore ) + 1.0) / ((SELECT COUNT(*) FROM TestScores) + 1)  [next_rank]
    FROM TestScores
)

SELECT @resultval = (
    SELECT TOP 1 
    CASE WHEN t1.score = t2.score
        THEN t1.score
    ELSE
        t1.score + (t2.score - t1.score) * ((@percentile - t1.curr_rank) / (t2.curr_rank - t1.curr_rank))
    END
    FROM scores t1, scores t2
    WHERE (t1.curr_rank = @percentile OR (t1.curr_rank < @percentile AND t1.next_rank > @percentile))
        AND (t2.curr_rank = @percentile OR (t2.curr_rank > @percentile AND t2.prev_rank < @percentile))
)

END 
```

然后在另一个存储过程中我这样做：

```
DECLARE @pct25 float;
DECLARE @pct50 float;
DECLARE @pct75 float;

exec SurveyGetPercentile .25, @pct25 output
exec SurveyGetPercentile .50, @pct50 output
exec SurveyGetPercentile .75, @pct75 output

Select
    min(dblScore) as minScore,
    max(dblScore) as maxScore,
    avg(dblScore) as avgScore,
    @pct25 as percentile25,
    @pct50 as percentile50,
    @pct75 as percentile75
From TestScores 
```

它仍然不能完全满足我的要求。这将获得所有测试的统计数据；而我希望能够从其中包含多个不同测试的 TestScores 表中进行选择，并为每个不同的测试返回相同的统计数据（就像我在问题的示例表中一样）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-06-28T10:21:41.173

第 50 个百分位数与中位数相同。在计算其他百分位数时，比如第 80 个，将 80% 的数据按升序排序，其余 20% 的数据按降序排序，取两个中间值的平均值。

注意：中位数查询已经存在了很长时间，但不记得我从哪里得到它，我只是修改它来计算其他百分位数。

```
DECLARE @Temp TABLE(Id INT IDENTITY(1,1), DATA DECIMAL(10,5))

INSERT INTO @Temp VALUES(0)
INSERT INTO @Temp VALUES(2)
INSERT INTO @Temp VALUES(8)
INSERT INTO @Temp VALUES(4)
INSERT INTO @Temp VALUES(3)
INSERT INTO @Temp VALUES(6)
INSERT INTO @Temp VALUES(6)
INSERT INTO @Temp VALUES(6) 
INSERT INTO @Temp VALUES(7)
INSERT INTO @Temp VALUES(0)
INSERT INTO @Temp VALUES(1)
INSERT INTO @Temp VALUES(NULL)

--50th percentile or median
SELECT ((
        SELECT TOP 1 DATA
        FROM   (
                SELECT  TOP 50 PERCENT DATA
                FROM    @Temp
                WHERE   DATA IS NOT NULL
                ORDER BY DATA
                ) AS A
        ORDER BY DATA DESC) + 
        (
        SELECT TOP 1 DATA
        FROM   (
                SELECT  TOP 50 PERCENT DATA
                FROM    @Temp
                WHERE   DATA IS NOT NULL
                ORDER BY DATA DESC
                ) AS A
        ORDER BY DATA ASC)) / 2.0

--90th percentile 
SELECT ((
        SELECT TOP 1 DATA
        FROM   (
                SELECT  TOP 90 PERCENT DATA
                FROM    @Temp
                WHERE   DATA IS NOT NULL
                ORDER BY DATA
                ) AS A
        ORDER BY DATA DESC) + 
        (
        SELECT TOP 1 DATA
        FROM   (
                SELECT  TOP 10 PERCENT DATA
                FROM    @Temp
                WHERE   DATA IS NOT NULL
                ORDER BY DATA DESC
                ) AS A
        ORDER BY DATA ASC)) / 2.0

--75th percentile
SELECT ((
        SELECT TOP 1 DATA
        FROM   (
                SELECT  TOP 75 PERCENT DATA
                FROM    @Temp
                WHERE   DATA IS NOT NULL
                ORDER BY DATA
                ) AS A
        ORDER BY DATA DESC) + 
        (
        SELECT TOP 1 DATA
        FROM   (
                SELECT  TOP 25 PERCENT DATA
                FROM    @Temp
                WHERE   DATA IS NOT NULL
                ORDER BY DATA DESC
                ) AS A
        ORDER BY DATA ASC)) / 2.0 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-17T03:47:33.350

我可能会使用 sql server 2005

> row_number() over (order by score) / (select count(*) from scores)

或类似的规定。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-17T03:48:22.443

我会做类似的事情：

```
select @n = count(*) from tbl1
select @median = @n / 2
select @p75 = @n * 3 / 4
select @p90 = @n * 9 / 10

select top 1 score from (select top @median score from tbl1 order by score asc) order by score desc 
```

这是正确的吗？

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2019-03-08T15:37:01.800

百分位数由下式计算

`(Rank -1) /(total_rows -1)`当您按升序对值进行排序时。

下面的查询将为您提供介于 0 和 1 之间的百分位数。分数最低的人将有 0 个百分位数。

```
SELECT Name, marks, (rank_1-1)/((select count(*) as total_1 from table)-1)as percentile_rank
from
(
SELECT Name,
       Marks,
       RANK() OVER (ORDER BY Marks) AS rank_1
       from table
) as A 
```

# c# - 通过反射获取命名空间中的所有类型

> ID：79693
> 
> 赞同：297
> 
> 时间：2008-09-17T03:35:24.677
> 
> 标签：c#, .net, reflection, namespaces

如何通过 C# 中的反射获取命名空间中的所有类？

* * *

## 回答 #1

> 赞同：335
> 
> 时间：2008-09-17T03:43:01.660

`namespace`以下代码打印当前程序集中定义的指定类的名称。
正如其他人指出的那样，命名空间可以分散在不同的模块之间，因此您需要首先获取程序集列表。

```
string nspace = "...";

var q = from t in Assembly.GetExecutingAssembly().GetTypes()
        where t.IsClass && t.Namespace == nspace
        select t;
q.ToList().ForEach(t => Console.WriteLine(t.Name)); 
```

* * *

## 回答 #2

> 赞同：97
> 
> 时间：2013-05-12T05:16:21.640

正如 FlySwat 所说，您可以在多个程序集中拥有相同的命名空间（例如`System.Collections.Generic`）。如果尚未加载所有这些程序集，则必须加载它们。因此，要获得完整的答案：

```
AppDomain.CurrentDomain.GetAssemblies()
                       .SelectMany(t => t.GetTypes())
                       .Where(t => t.IsClass && t.Namespace == @namespace) 
```

除非您想要其他域的类，否则这应该有效。要获取所有域的列表，请点击[此链接。](https://stackoverflow.com/questions/388554/list-appdomains-in-process)

* * *

## 回答 #3

> 赞同：33
> 
> 时间：2008-09-17T03:38:33.700

```
using System.Reflection;
using System.Collections.Generic;
//...

static List<string> GetClasses(string nameSpace)
{
    Assembly asm = Assembly.GetExecutingAssembly();

    List<string> namespacelist = new List<string>();
    List<string> classlist = new List<string>();

    foreach (Type type in asm.GetTypes())
    {
        if (type.Namespace == nameSpace)
            namespacelist.Add(type.Name);
    }

    foreach (string classname in namespacelist)
        classlist.Add(classname);

    return classlist;
} 
```

注意：上面的代码说明了发生了什么。如果您实现它，可以使用简化版本：

```
using System.Linq;
using System.Reflection;
using System.Collections.Generic;
//...

static IEnumerable<string> GetClasses(string nameSpace)
{
    Assembly asm = Assembly.GetExecutingAssembly();
    return asm.GetTypes()
        .Where(type => type.Namespace == nameSpace)
        .Select(type => type.Name);
} 
```

* * *

## 回答 #4

> 赞同：25
> 
> 时间：2016-01-19T05:28:15.253

对于特定的程序集、名称空间和类名：

```
var assemblyName = "Some.Assembly.Name"
var nameSpace = "Some.Namespace.Name";
var className = "ClassNameFilter";

var asm = Assembly.Load(assemblyName);
var classes = asm.GetTypes().Where(p =>
     p.Namespace == nameSpace &&
     p.Name.Contains(className) 
).ToList(); 
```

注意：项目必须引用程序集

* * *

## 回答 #5

> 赞同：14
> 
> 时间：2008-09-17T03:52:04.713

这是针对 LoaderException 错误的修复程序，如果其中一个类型继承另一个程序集中的类型，您可能会发现：

```
// Setup event handler to resolve assemblies
AppDomain.CurrentDomain.ReflectionOnlyAssemblyResolve += new ResolveEventHandler(CurrentDomain_ReflectionOnlyAssemblyResolve);

Assembly a = System.Reflection.Assembly.ReflectionOnlyLoadFrom(filename);
a.GetTypes();
// process types here

// method later in the class:
static Assembly CurrentDomain_ReflectionOnlyAssemblyResolve(object sender, ResolveEventArgs args)
{
    return System.Reflection.Assembly.ReflectionOnlyLoad(args.Name);
} 
```

这应该有助于加载其他程序集中定义的类型。

希望有帮助！

* * *

## 回答 #6

> 赞同：10
> 
> 时间：2008-09-17T03:39:58.003

您将无法获取命名空间中的所有类型，因为命名空间可以桥接多个程序集，但您可以获取程序集中的所有类并检查它们是否属于该命名空间。

`Assembly.GetTypes()`适用于本地程序集，或者您可以先加载程序集然后调用`GetTypes()`它。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2013-01-09T11:37:57.110

就像@aku 回答一样，但使用扩展方法：

```
string @namespace = "...";

var types = Assembly.GetExecutingAssembly().GetTypes()
    .Where(t => t.IsClass && t.Namespace == @namespace)
    .ToList();

types.ForEach(t => Console.WriteLine(t.Name)); 
```

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2014-12-22T08:10:01.453

在一行中按命名空间名称的一部分获取所有类：

```
var allClasses = Assembly.GetExecutingAssembly().GetTypes().Where(a => a.IsClass && a.Namespace != null && a.Namespace.Contains(@"..your namespace...")).ToList(); 
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-09-17T03:51:15.200

命名空间实际上在运行时的设计中相当被动，主要用作组织工具。.NET 中类型的全名由命名空间和类/枚举/等组成。结合。如果您只想通过特定的程序集，您只需循环通过程序集返回的类型。[GetExportedTypes()](http://msdn.microsoft.com/en-us/library/system.reflection.assembly.getexportedtypes.aspx)检查类型的值。[命名空间](http://msdn.microsoft.com/en-us/library/system.type.namespace.aspx)。如果您尝试浏览当前 AppDomain 中加载的所有程序集，则需要使用 AppDomain.CurrentDomain。[获取程序集（）](http://msdn.microsoft.com/en-us/library/system.appdomain_members.aspx)

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-04-18T05:43:19.533

```
//a simple combined code snippet 

using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Reflection;

namespace MustHaveAttributes
{
  class Program
  {
    static void Main ( string[] args )
    {
      Console.WriteLine ( " START " );

      // what is in the assembly
      Assembly a = Assembly.Load ( "MustHaveAttributes" );
      Type[] types = a.GetTypes ();
      foreach (Type t in types)
      {

        Console.WriteLine ( "Type is {0}", t );
      }
      Console.WriteLine (
         "{0} types found", types.Length );

      #region Linq
      //#region Action

      //string @namespace = "MustHaveAttributes";

      //var q = from t in Assembly.GetExecutingAssembly ().GetTypes ()
      //        where t.IsClass && t.Namespace == @namespace
      //        select t;
      //q.ToList ().ForEach ( t => Console.WriteLine ( t.Name ) );

      //#endregion Action  
      #endregion

      Console.ReadLine ();
      Console.WriteLine ( " HIT A KEY TO EXIT " );
      Console.WriteLine ( " END " );
    }
  } //eof Program

  class ClassOne
  {

  } //eof class 

  class ClassTwo
  {

  } //eof class

  [System.AttributeUsage ( System.AttributeTargets.Class |
    System.AttributeTargets.Struct, AllowMultiple = true )]
  public class AttributeClass : System.Attribute
  {

    public string MustHaveDescription { get; set; }
    public string MusHaveVersion { get; set; }

    public AttributeClass ( string mustHaveDescription, string mustHaveVersion )
    {
      MustHaveDescription = mustHaveDescription;
      MusHaveVersion = mustHaveVersion;
    }

  } //eof class 

} //eof namespace 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2016-02-29T19:25:02.720

非常简单

```
Type[] types = Assembly.Load(new AssemblyName("mynamespace.folder")).GetTypes();
foreach (var item in types)
{
} 
```

# memory - 更严重的罪过：副作用或传递大量物体？

> ID：79709
> 
> 赞同：5
> 
> 时间：2008-09-17T03:39:16.913
> 
> 标签：memory, r, function, global-variables, side-effects

我在函数内部的循环中有一个函数。内部函数在内存中获取并存储大量数据向量（作为全局变量......我使用的是“R”，类似于“S-Plus”）。循环遍历要获取的一长串数据。外部函数启动该过程并传入要获取的数据集列表。

```
for (dataset in list_of_datasets) {
  for (datachunk in dataset) {
    <process datachunk>
    <store result? as vector? where?>
  }
} 
```

我对内部函数进行了编程，以便在移动到下一个数据集之前存储每个数据集，因此外部函数的所有工作都会作为对全局变量的副作用发生......这是一个很大的禁忌。这比收集和返回一个巨大的、占用大量内存的向量是好还是坏？有没有更好的第三种方法？

如果我将数据向量存储在数据库中而不是内存中，答案会改变吗？理想情况下，我希望能够在不丢失终止之前处理的所有信息的情况下终止该功能（或使其因网络超时而失败）。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-17T03:48:29.900

在外部函数中使用变量而不是全局变量。这让您获得了两种方法的最佳效果：您不会改变全局状态，也不会复制大量数据。如果您必须提前退出，只需返回部分结果。

（请参阅 R 手册中的“范围”部分：http: [//cran.r-project.org/doc/manuals/R-intro.html#Scope](http://cran.r-project.org/doc/manuals/R-intro.html#Scope)）

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-17T04:11:08.660

记住你的 Knuth。“过早的优化是所有编程罪恶的根源。”

试试无副作用的版本。看看它是否符合您的绩效目标。如果是这样，那太好了，你一开始就没有问题。如果不是，则使用副作用，并为下一个程序员记下您的手是被迫的。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-17T03:51:30.190

它不会对内存使用产生太大影响，因此您不妨使代码干净。

由于 R 对变量进行了修改时复制，因此修改全局对象将具有与在返回值中传递某些内容相同的内存含义。

如果您将输出存储在数据库中（甚至存储在文件中），您将不会遇到内存使用问题，并且数据将在创建时增量可用，而不仅仅是在最后。数据库是否更快主要取决于您使用了多少内存：减少垃圾收集是否会支付写入磁盘的成本。

R 中有时间和内存分析器，因此您可以凭经验看到影响是什么。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-17T03:58:26.367

我不确定我是否理解这个问题，但我有几个解决方案。

1.  在函数内部，创建一个向量列表并返回它。

2.  在函数内部，创建一个环境并将所有向量存储在其中。只要确保在出现错误时返回环境即可。

在 R 中：

```
help(environment)

# You might do something like this:

outer <- function(datasets) {
  # create the return environment
  ret.env <- new.env()
  for(set in dataset) {
    tmp <- inner(set)
    # check for errors however you like here.  You might have inner return a list, and
    # have the list contain an error component
    assign(set, tmp, envir=ret.env)
  }
  return(ret.env)
}

#The inner function might be defined like this

inner <- function(dataset) {
  # I don't know what you are doing here, but lets pretend you are reading a data file
  # that is named by dataset
  filedata <- read.table(dataset, header=T)
  return(filedata)
} 
```

莱夫

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-17T19:39:37.370

FYI, here's a full sample toy solution that avoids side effects:

```
outerfunc <- function(names) {
  templist <- list()
  for (aname in names) {
    templist[[aname]] <- innerfunc(aname)
  }
  templist
}

innerfunc <- function(aname) {
  retval <- NULL
  if ("one" %in% aname) retval <- c(1)
  if ("two" %in% aname) retval <- c(1,2)
  if ("three" %in% aname) retval <- c(1,2,3)
  retval
}

names <- c("one","two","three")

name_vals <- outerfunc(names)

for (name in names) assign(name, name_vals[[name]]) 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-17T03:49:36.560

第三种方法：内部函数返回对大数组的引用，然后循环内的下一条语句取消引用并将其存储在需要的任何位置（理想情况下使用单个指针存储，而不必 memcopy 整个数组）。

这消除了副作用和大型数据结构的传递。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-09-17T03:43:22.923

在不知道使用的语言/编译器的情况下很难明确地说出来。但是，如果您可以简单地将指针/引用传递给您正在创建的对象，那么对象本身的大小与函数调用的速度无关。在路上操纵这些数据可能是另一回事。

# embedded - vxWorks“内核外壳”和“主机外壳”有何不同？

> ID：79727
> 
> 赞同：6
> 
> 时间：2008-09-17T03:41:33.553
> 
> 标签：embedded, vxworks, rtos

在 vxWorks RTOS 中，有一个 shell 允许您向嵌入式系统发出命令。
文档涉及内核外壳、主机外壳和目标外壳。三者有什么区别？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-17T23:50:58.187

目标外壳和内核外壳是相同的。它们指的是在目标上运行的外壳。您可以使用串行端口或 telnet 会话连接到 shell。任务在目标上运行并解析接收到的所有命令并对其进行操作，将数据输出回端口。

主机外壳是在开发站上运行的进程。它与目标上的调试代理进行通信。所有的命令实际上都是在主机上解析的，只有简化的请求被发送到目标代理：

*   读/写内存
*   设置/删除断点
*   创建/删除/暂停/恢复任务
*   调用函数

这导致对目标的实时影响较小。

这两个 shell 都允许用户执行低级调试（反汇编、断点等）并调用目标上的函数。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-22T02:51:18.477

主机 shell 和目标 shell 之间存在一些差异，您可以使用 h 命令获取两个 shell 支持的实际命令。

主机外壳支持更多的命令行编辑功能，如自动补码和符号查找等。

# c# - .Net Gridview alpha排序，需要数字排序

> ID：79736
> 
> 赞同：0
> 
> 时间：2008-09-17T03:42:58.150
> 
> 标签：c#, .net, gridview

这是我第一个真正需要 .NET 世界中的任何 Gridview 专家的问题。

我从代码隐藏创建了一个 Gridview，我在列中保存了一堆数字数据。虽然，我确实在代码隐藏的数字字段中添加了逗号。当我将它加载到 Gridview 时，我打开了排序功能，但是 gridview 选择 ALPHA 排序而不是数字排序，因为我添加了这些逗号。

所以我需要帮助。有人愿意试一试吗？我需要将 gridview 中的一些列更改为数字排序，而不是它使用的 alpha 排序。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-17T03:59:39.203

如果您最终实现了自己的比较器并将它们排序为字符串，则“正确”处理数字的算法称为自然排序。杰夫在这里写了一篇很好的文章：
[人类排序：自然排序顺序](https://blog.codinghorror.com/sorting-for-humans-natural-sort-order/)

你可以在这里找到一个很好的 C# 实现：http:
[//www.codeproject.com/KB/string/NaturalSortComparer.aspx](http://www.codeproject.com/KB/string/NaturalSortComparer.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-17T05:47:46.103

根据您进行排序的确切方式，您可以使用上述方法之一，或者如果列实际上是数字类型，您可以返回数据库并在那里完成排序，然后稍后将您的装饰添加到它。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-18T22:00:19.940

P-Invoke 是您的朋友。

```
[DllImport("Shlwapi.dll", CharSet = CharSet.Unicode)]
private static extern int StrCmpLogicalW(string psz1, string psz2); 
```

然后您可以将其用作您自己的比较器。

例如（在 VS2005 中），

```
Array.Sort(tringArray, delegate(string left, string right)
{
    return StrCmpLogicalW(left, right);
}); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-20T22:45:16.060

相反，我只是使用了 JQUERY 表排序器。

可以在这里找到：[tablesorter](http://tablesorter.com/docs/)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-01-27T17:49:19.763

我意识到这确实很旧，但是您将数据与演示文稿混合在一起；这就是搞砸了。从 SQL 中取出数字而不添加逗号，然后在表示层中添加它们。

# excel - 从托管的 HP 质量中心导出错误跟踪数据的最佳方式是什么？

> ID：79737
> 
> 赞同：4
> 
> 时间：2008-09-17T03:43:01.193
> 
> 标签：excel, bug-tracking, hp-quality-center

这个问题可能过于特定于产品，但我想知道是否有人从 HP 质量中心导出错误跟踪数据。

HP Quality Center (QC) 有一个老式的 COM API，但我宁愿使用 Web 服务，甚至可能使用屏幕抓取工具将数据导出到 Excel 电子表格中。

无论如何，从托管的 HP 质量中心导出错误跟踪数据的最佳方式是什么？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-17T07:31:47.120

您可以使用此 QC API 代码来修改错误/要求。

```
TDAPIOLELib.TDConnection connection = new TDAPIOLELib.TDConnection(); 
connection.InitConnectionEx("http://SERVER:8080/qcbin"); 
connection.Login("USERNAME", "PASSWORD"); 
connection.Connect("QCDOMAIN", "QCPROJECT"); 
TDAPIOLELib.BugFactory bugFactory = connection.BugFactory as TDAPIOLELib.BugFactory; 
TDAPIOLELib.List bugList = bugFactory.NewList(""); 
foreach (TDAPIOLELib.Bug bug in bugList) 
{ 
  // View / Modify the properties 
  // bug.ID, bug.Name, etc. 
  // Save them when done 
  // bug.Post(); 
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-20T09:36:18.190

就个人而言，我喜欢 COM API，并使用它来生成 Word 和 Excel 报告。我用VS2005做了一些实验，结果令人鼓舞。

如果你不想走这条路，我有几个建议。

1.  如果您使用图表选项（分析 > 图表）。每个图表都有一个称为数据网格的选项卡，可让您将数据导出到 Excel 和许多其他数据格式。
2.  如果您是管理员，或者与您的管理员友好，您可以将整个数据库转储到 access 中，然后导入 Excel。当然，你会失去所有的表关系，但总比没有好。这也是学习数据库模式的好方法。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-08T17:05:08.200

不幸的是，QC 目前没有公开任何网络服务。我认为最简单的方法是直接查询数据库。您要查找的数据在 BUG 表中的项目架构中。

QC 也有一个 excel 插件，您可能想尝试一下，但它主要用于将缺陷从 excel 添加到 QC。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-20T09:56:12.283

如果您可以手动导出（即不使用程序），以下将是导出缺陷数据的最简单方法。

在 QC 9.2（可能也存在于早期版本中）`Export/All`中，`Defects`菜单中有一个，可将缺陷网格中的缺陷导出到 Excel 工作表中。

导出的字段是缺陷网格中显示的字段，可以使用“选择列”按钮（看起来像绿色网格）进行自定义。

# c++ - 如何确定安装了哪个版本的 Direct3D？

> ID：79745
> 
> 赞同：3
> 
> 时间：2008-09-17T03:44:27.570
> 
> 标签：c++, windows, direct3d

我们有一个需要使用 Direct3D 的应用程序。具体来说，它至少需要 DirectX 9.0c 版本 4.09.0000.0904。虽然这应该存在于所有较新的 XP 机器上，但它可能不会安装在较旧的 XP 机器上。如何以编程方式（使用 C++）确定它是否已安装？我希望能够向用户提供 Direct3D 将不可用的信息消息。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-17T03:56:05.373

调用 DirectXSetupGetVersion：http: [//msdn.microsoft.com/en-us/library/microsoft.directx_sdk.directsetup.directxsetupgetversion](http://msdn.microsoft.com/en-us/library/microsoft.directx_sdk.directsetup.directxsetupgetversion)

您需要包含 dsetup.h

这是该站点的示例代码：

```
DWORD dwVersion;
DWORD dwRevision;
if (DirectXSetupGetVersion(&dwVersion, &dwRevision))
{
    printf("DirectX version is %d.%d.%d.%d\n",
           HIWORD(dwVersion), LOWORD(dwVersion),
           HIWORD(dwRevision), LOWORD(dwRevision));
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-17T03:53:00.873

根据 DirectX 9.0 SDK（2004 年夏季）文档，请参阅位于 \Samples\Multimedia\DXMisc\GetDXVer 的 GetDXVer SDK 示例。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-17T04:10:17.727

快速的 Google 搜索会找到[这篇文章](http://www.codersource.net/win32_registry_operations.html)，它确定了版本号在注册表中的位置，然后提供了一个案例语句，将内部版本号映射到我们更熟悉的版本号。

另一个快速的 Google 搜索出现了一个用 C++[读取注册表](http://www.codersource.net/win32_registry_operations.html)的示例。

享受...

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-07-17T01:42:32.213

是的，使用 2009 年 3 月 DirectX SDK 中的 DirectX 安装示例中显示的机制。（查看示例浏览器中的“系统”类别。）

不要使用注册表！这些东西是无证的，不能保证有效。

唯一受支持的方法是使用 DirectSetup API，它显示在 DirectX 安装示例中。我还在我的书[The Direct3D Graphics Pipeline](http://www.xmission.com/~legalize/book/download/)中的第 24 章中介绍了这些内容。您可以在上述网址免费下载该章节。

# python - 单元测试导致 sys.exit()

> ID：79754
> 
> 赞同：19
> 
> 时间：2008-09-17T03:46:55.350
> 
> 标签：python, unit-testing

无论我做什么 sys.exit() 都会被 unittest 调用，即使是最琐碎的例子。我不知道我的安装是否搞砸了或发生了什么。

```
IDLE 1.2.2      ==== No Subprocess ====
>>> import unittest
>>> 
>>> class Test(unittest.TestCase):
        def testA(self):
            a = 1
            self.assertEqual(a,1)

>>> unittest.main()
option -n not recognized
Usage: idle.pyw [options] [test] [...]

Options:
  -h, --help       Show this message
  -v, --verbose    Verbose output
  -q, --quiet      Minimal output

 Examples:
   idle.pyw                               - run default set of tests
   idle.pyw MyTestSuite                   - run suite 'MyTestSuite'
   idle.pyw MyTestCase.testSomething      - run MyTestCase.testSomething
   idle.pyw MyTestCase                    - run all 'test*' test methods
                                           in MyTestCase

Traceback (most recent call last):
  File "<pyshell#7>", line 1, in <module>
    unittest.main()
  File "E:\Python25\lib\unittest.py", line 767, in __init__
    self.parseArgs(argv)
  File "E:\Python25\lib\unittest.py", line 796, in parseArgs
    self.usageExit(msg)
  File "E:\Python25\lib\unittest.py", line 773, in usageExit
    sys.exit(2)
SystemExit: 2
>>> 
```

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2010-07-09T18:30:28.477

在新的 Python 2.7 版本中，[unittest.main()](http://docs.python.org/library/unittest.html#unittest.main)有一个新参数。

如果 'exit' 设置为`False`，`sys.exit()`则在执行期间不调用`unittest.main()`。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-09-17T03:59:27.830

您的示例也在我的安装中退出。我可以通过更改使其执行测试并留在 Python 中

```
unittest.main() 
```

到

```
unittest.TextTestRunner().run(unittest.TestLoader().loadTestsFromTestCase(Test)) 
```

Python 库参考中提供[了](http://docs.python.org/library/unittest.html#basic-example)更多信息。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-09-17T03:58:24.637

不要试图`unittest.main()`从 IDLE 中运行。它正在尝试访问`sys.argv`，它正在获取 IDLE 开始时使用的参数。要么以与 IDLE 不同的方式运行测试，要么调用`unittest.main()`它自己的 Python 进程。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-09-17T04:19:45.600

弹出打开源代码到`unittest.py`. 在运行所有测试后被`unittest.main()`硬编码调用。`sys.exit()`用于`TextTestRunner`从提示符运行测试套件。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2014-01-21T15:18:13.030

很高兴能够在第一次尝试 unittest 模块时证明您的测试有效，并且知道您不会退出 Python shell。但是，这些解决方案取决于版本。

## 蟒蛇2.6

我在工作中使用 Python 2.6 `import`ing `unittest2 as unittest`（`unittest`据说是 Python 2.7 中的模块）。

在 Python 2.6的`unittest.main(exit=False)`unittest2 中不起作用，而 JoeSkora 的解决方案可以，重申一下：

```
unittest.TextTestRunner().run(unittest.TestLoader().loadTestsFromTestCase(Test)) 
```

要将其分解为其组件和默认参数，并为各种组合对象使用正确的语义名称：

```
import sys # sys.stderr is used in below default args

test_loader = unittest.TestLoader()
loaded_test_suite = test_loader.loadTestsFromTestCase(Test)
                                           # Default args:
text_test_runner = unittest.TextTestRunner(stream=sys.stderr,
                                           descriptions=True, 
                                           verbosity=1)
text_test_runner.run(loaded_test_suite) 
```

## Python 2.7 和 3

在 Python 2.7 及更高版本中，以下应该可以工作。

```
unittest.main(exit=False) 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-01-02T20:34:33.633

```
try:
    sys.exit()
except SystemExit:
    print('Simple as that, but you should really use a TestRunner instead') 
```

# subdomain - 通配符子域

> ID：79764
> 
> 赞同：20
> 
> 时间：2008-09-17T03:48:10.683
> 
> 标签：subdomain, localhost, wildcard, mamp, wildcard-subdomain

我知道以前有过一些关于这方面的讨论，但我已经尝试了所有建议的（我能找到的），到目前为止没有任何东西对我有用......

考虑到这一点，这就是我想要做的：

首先，我想允许用户发布页面并给他们每个他们选择的子域（例如：user.mysite.com）。据我所知，最好的方法是使用 mod_rewrite 和 .htaccess 将 user.mysite.com 映射到 mysite.com/user - 对吗？

如果这是正确的，有人可以给我关于如何做到这一点的明确说明吗？

另外，我在本地使用 MAMP 进行所有开发，所以如果有人能告诉我如何设置我的本地环境以相同的方式工作（我读过这更难），我将不胜感激。老实说，我一直在尝试一切都无济于事，因为这是我第一次做这样的事情，我完全迷失了。非常感谢您的帮助！

**更新：** *其中一些答案真的很有帮助，但对于我想到的系统，为每个用户手动添加子域不是一种选择。我真正要问的是如何即时执行此操作，并将 wildcard.mysite.com 重定向到 mysite.com/wildcard——Tumblr 的设置方式是我想做的一个完美示例。再次感谢！*

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-09-17T03:55:11.773

至于如何设置 DNS 子域通配符，这将是您的 DNS 托管服务提供商的一项功能。这将是不同的步骤，具体取决于您拥有的托管服务提供商，这对他们来说是一个更好的问题。

一旦你用 DNS 主机设置了它，从你的 web 应用程序中你实际上只是 URL 重写，这可以通过 web 服务器本身的某种模块来完成，例如 isapi rewrite 如果你在 IIS 上（这个如果可能，将是首选路线）。您还可以在应用程序级别处理重写（例如在 ASP.NET 上使用路由）。

您将重写 URL，因此[http://myname.domain.com](http://myname.domain.com)将变为[http://domain.com/something.aspx?name=myname](http://domain.com/something.aspx?name=myname)或其他内容。从那里开始，您只需像平常一样处理 myname 值在查询字符串中一样。那有意义吗？希望我没有误解你在追求什么。

**编辑：**

我并不是建议您为每个用户创建一个子域，而是为域本身创建一个通配符子域，因此*任何*.domain.com（基本上是 *.domain.com）都会进入您的站点。我用[mydomain](http://www.mydomain.com/)设置了几个域。他们的设置说明如下：

> 是的，您可以配置通配符，但只有将其设置为 A 记录时才会起作用。通配符不适用于 C 名称。要使用通配符，请使用星号字符“*”。例如，如果您使用通配符*.domain.com 创建和记录，则在“* ”所在位置输入的任何内容都将解析为指定的 IP 地址。因此，如果您在域名前输入“www”、“ftp”、“站点”或其他任何内容，它将始终解析为 IP 地址

我有一些是以这种方式设置的，让 *.domain.com 访问我的站点。然后，我可以在我的 Web 应用程序中读取基本 URL，以查看 ryan.domain.com 是当前访问的内容，或者 bill.domain.com 是已使用的内容。然后我可以：

1.  使用 URL 重写，以便子域成为查询字符串的一部分或
2.  只需从访问的 URL 中读取主机值并根据该值执行一些逻辑。

那有意义吗？我有几个站点以这种确切的方式设置：使用 DNS 主机为域创建通配符，然后简单地从 URL 中读取主机或基域，以根据子域（实际上是用户名）决定显示什么)

**编辑2：**

如果没有 DNS 条目，就无法做到这一点。“在线世界”需要知道 name1.domain.com、name2.domain.com、...、nameN.domain.com 都指向您服务器的 IP 地址。执行此操作的唯一方法是使用适当的 DNS 条目。您必须使用您的 DNS 主机为您的域添加通配符 DNS 条目。然后，您只需从 URL 中读取子域并在代码中采取适当的操作即可。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-09-17T04:54:05.687

如果您正在运行 *AMP，最好的做法是按照 Thomas 的建议在 Apache 中做虚拟主机。您可以使用或不使用您描述的重定向来执行此操作。

## 虚拟主机

很可能您会想做[基于名称的虚拟主机](http://httpd.apache.org/docs/2.0/vhosts/examples.html)，因为它最容易设置并且只需要一个 IP 地址（因此也很容易在本地 MAMP 机器上设置和测试）。基于 IP 的虚拟主机在其他一些方面更好，但您必须为每个域设置一个 IP 地址。

这个[Wikipedia 页面](http://en.wikipedia.org/wiki/Virtual_hosting)在底部讨论了如何进行基于名称的虚拟主机的差异和链接。

在您的本地机器上进行测试，您还必须在 /etc/hosts 中为您的假测试域名设置假 DNS 名称。即，如果您有 Apache 在 localhost 上侦听并在您的 Apache 配置中设置 vhost1.test.domain 和 vhost2.test.domain，您只需将这些域添加到 /etc/hosts 中的 127.0.0.1 行，在 localhost 之后：

```
127.0.0.1 localhost vhost1.test.domain vhost2.test.domain 
```

一旦你完成了 /etc/hosts 编辑并将基于名称的虚拟主机配置添加到你的 Apache 配置文件中，就是这样，重新启动 Apache 并且你的测试域应该可以工作。

## 使用 mod_rewrite 重定向

如果您想使用 mod_rewrite 进行重定向（这样 user.example.com 不会直接托管，而是重定向到 example.com/user），那么您还需要执行 RewriteCond 以匹配子域并重定向它：

```
RewriteEngine On
RewriteCond %{HTTP_HOST} ^subdomain\.example\.com
RewriteRule ^(.*)$ http://example.com/subdomain$1 [R] 
```

你可以把它放在一个 .htaccess 或者你的主要 Apache 配置中。

您需要为要重定向的每个子域添加一对规则，例如最后两个规则。或者，您可以在 RewriteCond 中捕获子域，以便能够使用一个通配符规则将 *.example.com 重定向到 example.com/ * - 但从安全角度来看，这对我来说真的很糟糕。

## 一起，虚拟主机和重定向

最好更明确一点，为您要侦听的每个主机名设置一个虚拟主机配置部分，并将这些主机名中的每一个的重写规则放在其虚拟主机配置中。（如果可以的话，将这种东西放在 Apache 配置中而不是 .htaccess 中总是更安全、更快——.htaccess 会降低性能，因为 Apache 会不断地在文件系统中搜索 .htaccess 文件并重新解析它们，并且它不太安全，因为这些可能会被用户搞砸。）

这样一来，Apache 配置中的虚拟主机配置将是：

```
NameVirtualHost 127.0.0.1:80

# Your "default" configuration must go first
<VirtualHost 127.0.0.1:80>
  ServerName example.com
  ServerAlias www.example.com
  DocumentRoot /www/siteroot
  # etc.
</VirtualHost>

# First subdomain you want to redirect
<VirtualHost 127.0.0.1:80>
  ServerName vhost1.example.com
  RewriteEngine On
  RewriteRule ^(.*)$ http://example.com/vhost1$1 [R]
</VirtualHost>

# Second subdomain you want to redirect
<VirtualHost 127.0.0.1:80>
  ServerName vhost2.example.com
  RewriteEngine On
  RewriteRule ^(.*)$ http://example.com/vhost2$1 [R]
</VirtualHost> 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2012-11-26T20:03:22.060

我意识到我回答这个问题已经很晚了，但是在本地开发解决方案方面我遇到了同样的问题。在[另一个 SO 线程](https://stackoverflow.com/questions/1562954/public-wildcard-domain-name-to-resolve-to-127-0-0-1)中，我找到了更好的解决方案，并认为我会与将来有相同问题的任何人分享它们：

VMware 拥有的通配符域，可将任何子域解析为 127.0.0.1：

```
vcap.me resolves to 127.0.0.1
www.vcap.me resolves to 127.0.0.1 
```

或更多功能 37 Signals 拥有一个域，可以使用特定格式将任何子域映射到任何给定 IP：

```
127.0.0.1.xip.io resolves to 127.0.0.1
www.127.0.0.1.xip.io resolves to 127.0.0.1
db.192.168.0.1.xip.io resolves to 192.168.0.1 
```

有关更多信息，请参见[xip.io](http://xip.io/)

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2016-12-03T09:15:11.367

我在 Ubuntu 16.04 上，从 14.04 开始，我在[这里](http://evans.io/legacy/posts/wildcard-subdomains-of-localhost/)使用 Dave Evans 提供的解决方案，它对我来说很好用。

1.  安装`dnsmasq`

    ```
    sudo apt-get install dnsmasq 
    ```

2.  使用以下行在 dir`localhost.conf`下创建新文件`/etc/dnsmasq.d`

    ```
    #file /etc/dnsmasq.d/localhost.conf
    address=/localhost/127.0.0.1 
    ```

3.  编辑`/etc/dhcp/dhclient.conf`并添加以下行

    ```
    prepend domain-name-servers 127.0.0.1; 
    ```

    *（您可能会发现该行已经存在，您只需取消注释即可。）*

4.  最后一个是重启服务

    ```
    sudo systemctl restart dnsmasq
    sudo dhclient 
    ```

最后，您应该检查它是否正常工作。

```
dig whatever.localhost 
```

**笔记：**

如果您想在您的网络服务器上使用它，您只需将其更改`127.0.0.0`为您的实际 IP 地址。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-08-01T07:27:45.510

我必须对我的一个网站做同样的事情。您可以按照以下步骤

1.  如果您的服务器上有 cPanel，请创建子域`*`，如果没有，则必须在 DNS 中设置 A 记录（对于 BIND，请参见[http://ma.tt/2003/10/wildcard-dns-和子域/](http://ma.tt/2003/10/wildcard-dns-and-sub-domains/)）。在你的开发上。服务器您最好通过将每个子域添加到您的`hosts`文件来伪造子域。

2.  （如果您使用 cPanel，则不必这样做）。您必须将以下内容添加到您的 apache vhosts 文件中。这在很大程度上取决于您正在运行的服务器类型（共享与否）。以下代码不完整。它只是给方向。注意：`ServerAlias example.com *.example.com`很重要。

    ```
    <VirtualHost 127.0.0.1:80>  
            DocumentRoot /var/www/  
            ServerName example.com  
            ServerAlias example.com *.example.com  
    </VirtualHost> 
    ```

3.  接下来，因为您可以使用 PHP 脚本检查“主机”标头并找出子域并相应地提供内容。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-17T03:54:31.633

> 首先，我想允许用户发布页面并给他们每个他们选择的子域（例如：user.mysite.com）。据我所知，最好的方法是使用 mod_rewrite 和 .htaccess 将 user.mysite.com 映射到 mysite.com/user - 对吗？

[使用虚拟主机](http://httpd.apache.org/docs/1.3/vhosts/)可能会更好。这样，每个用户都可以拥有一个几乎独立于其他用户的网络服务器配置。

语法是这样的：

```
<虚拟主机 *:80>
    DocumentRoot /var/www/user
    服务器名称 user.mysite.com
    ...
</虚拟主机>
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-17T04:09:33.593

从我在许多虚拟主机上看到的情况来看，他们在 apache 上设置了一个虚拟主机。

因此，如果您的 www.mysite.com 是从 /var/www 提供的，您可以为每个用户创建一个文件夹。然后将虚拟主机映射到该文件夹​​。

这样，mysite.com/user 和 user.mysite.com 都可以工作。

至于您的测试环境，如果您在 Windows 上，我建议编辑您的 HOSTS 文件以将 mysite.com 映射到您的本地 PC (127.0.0.1)，以及您为测试设置的任何子域。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2018-08-21T13:02:17.827

我为 Ubuntu 18.04 找到的解决方案与[此](https://stackoverflow.com/a/40946135/82782)类似，但涉及 NetworkManager 配置：

1.  编辑该文件`/etc/NetworkManager/NetworkManager.conf`，并将该行添加`dns=dnsmasq`到该`[main]`部分

    ```
    sudo editor /etc/NetworkManager/NetworkManager.conf 
    ```

    应该是这样的：

    ```
    [main]
    plugins=ifupdown,keyfile
    dns=dnsmasq
    ... 
    ```

2.  开始使用 NetworkManager 的 resolv.conf

    ```
    sudo rm /etc/resolv.conf
    sudo ln -s /var/run/NetworkManager/resolv.conf /etc/resolv.conf 
    ```

3.  使用通配符配置创建文件

    ```
    echo 'address=/.localhost/127.0.0.1' | sudo tee /etc/NetworkManager/dnsmasq.d/localhost-wildcard.conf 
    ```

4.  重新加载 NetworkManager 配置

    ```
    sudo systemctl reload NetworkManager 
    ```

5.  测试一下

    ```
    dig localdomain.localhost 
    ```

您还可以添加任何其他域，这对于使用本地开发设置时的某些类型的身份验证非常有用。

```
echo 'address=/.local-dev.workdomain.com/127.0.0.1' | sudo tee /etc/NetworkManager/dnsmasq.d/workdomain-wildcard.conf 
```

然后这个工作：

```
dig petproject.local-dev.workdomain.com

;; ANSWER SECTION:
petproject.local-dev.workdomain.com. 0 IN   A   127.0.0.1 
```

# .net - 在.Net中处理跨时区的仅日期日期

> ID：79774
> 
> 赞同：2
> 
> 时间：2008-09-17T03:49:15.860
> 
> 标签：.net, date

好的 - 有点拗口。所以我遇到的问题是 - 我需要存储一个到期日期，其中*只*需要日期部分并且我不想要任何时区转换。因此，例如，如果我将到期设置为“2008 年 3 月 8 日”，我希望将该值返回给任何客户——无论他们的时区是什么。将其作为 DateTime 进行远程处理的问题在于它被存储/发送为“2008 年 3 月 8 日 00:00”，这意味着对于从我以西的任何时区连接的客户来说，它会被转换并因此翻转为“2008 年 3 月 7 日”任何建议干净地处理这种情况？显然将它作为字符串发送会起作用。还要别的吗 ？谢谢，伊恩

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-17T07:21:13.260

我不确定您指的是什么远程处理技术，但这是 WCF 的一个真正问题，它目前仅支持将 DateTime 序列化为 xs:DateTime，不适用于您对时区不感兴趣的仅日期值。

.NET 3.5 引入了新的 DateTimeOffset 类型，这对于在时区之间传输 DateTime 很有用，但对仅日期方案没有帮助。

理想情况下，WCF 需要有选择地支持 xs:Date 以按照此处的要求对日期进行序列化：

[http://connect.microsoft.com/wcf/feedback/ViewFeedback.aspx?FeedbackID=349215](http://connect.microsoft.com/wcf/feedback/ViewFeedback.aspx?FeedbackID=349215)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-17T10:50:06.907

我这样做：每当我在内存中有日期或存储在文件中时，它总是在 UTC 的 DateTime 中。当我向用户显示日期时，它始终是一个字符串。当我在字符串和 DateTime 之间进行转换时，我也会进行时区转换。

这样我就不必在我的逻辑中处理时区，只需在演示文稿中。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-17T03:52:03.997

您可以将其作为 UTC 时间发送

dateTime1.ToUniversalTime()

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-17T03:55:02.163

我认为作为时间戳字符串发送将是最快/最简单的方法，尽管您可以考虑强制语言环境停止发生时间转换。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-17T04:00:48.373

您可以创建一个结构 Date 来访问您想要/需要的详细信息，例如：

```
public struct Date
{
    public int Month; //or string instead of int
    public int Day;
    public int Year;
} 
```

这是轻量级、灵活的，可让您完全控制。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-17T04:01:02.837

为什么不将其作为字符串发送，然后根据需要将其转换回日期类型？这样它就不会在不同的时区转换。把事情简单化。

编辑：我喜欢 Struct 的想法，允许良好的功能。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-17T04:39:52.210

我过去在应用程序上处理此问题的最简单方法是将日期存储为 yyyy-mm-dd 格式的字符串。它是明确的，不会被任何东西自动翻译。

是的，这很痛苦……

# c - 解析 HTTP 标头

> ID：79780
> 
> 赞同：18
> 
> 时间：2008-09-17T03:49:47.417
> 
> 标签：c, http, post, header

我对用 C 语言构建一个小型、高效的 Web 服务器产生了新的兴趣，并且在解析来自 HTTP Header 的 POST 方法时遇到了一些麻烦。有人对如何处理从“已发布”数据中检索名称/值对有任何建议吗？

```
POST /test HTTP/1.1
Host: test-domain.com:7017
User-Agent: Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.0.1) Gecko/2008070208 Firefox/3.0.1
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-us,en;q=0.5
Accept-Encoding: gzip,deflate
Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.7
Keep-Alive: 300
Connection: keep-alive
Referer: http://test-domain.com:7017/index.html
Cookie: __utma=43166241.217413299.1220726314.1221171690.1221200181.16; __utmz=43166241.1220726314.1.1.utmccn=(direct)|utmcsr=(direct)|utmcmd=(none)
Cache-Control: max-age=0
Content-Type: application/x-www-form-urlencoded
Content-Length: 25

field1=asfd&field2=a3f3f3
// ^-this 
```

我认为没有切实的方法可以从整体上检索底线并确保它每次都有效。我不喜欢在任何事情上进行硬编码。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-09-17T03:55:14.800

您可以通过搜索换行符换行符或更具体地 \r\n\r\n 来检索名称/值对（在此之后，消息的正文将开始）。

然后，您可以简单地用 & 拆分列表，然后在 = 之间拆分每个返回的字符串以表示名称/值对。

请参阅[HTTP 1.1 RFC](https://www.rfc-editor.org/rfc/rfc2616)。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-22T12:07:38.900

一旦您在标头中有 Content-Length，您就知道在空行之后要读取的字节数。如果出于任何原因（GET 或 POST）Content-Length 不在标头中，则意味着在空行 (crlf) 之后没有可读取的内容。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-17T04:00:27.017

您需要继续将流解析为标头，直到看到空白行。其余的是 POST 数据。

您需要为发布数据编写一个小解析器。您可以使用 C 库例程来做一些快速而肮脏的事情，例如 index、strtok 和 sscanf。如果您对“小”的定义有足够的空间，您可以使用正则表达式库甚至使用 flex 和 bison 来做一些更精细的事情。

至少，我认为这种回答你的问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2017-11-23T05:00:11.780

尽管有 IETF RFC，但这里有一个更中肯的答案。假设您意识到标题中`/r/n`的行之后总是有一个额外`Content-Length`的，您应该能够将其隔离到一个`char*`名为`data`. 这是我们开始的地方。

```
char *data = "f1=asfd&f2=a3f3f3";
char f1[100], 
char f2[100];
sscanf(data, "%s&%s", &f1, &f2); // get the field tuples

char f1_name[50];
char f1_data[50];
sscanf(f1, "%s=%s", f1_name, f1_data);  

char f2_name[50];
char f2_data[50];
sscanf(f2, "%s=%s", f2_name, f2_data); 
```

# .net - 使用 .net 托管代码抓取命令窗口的屏幕

> ID：79787
> 
> 赞同：5
> 
> 时间：2008-09-17T03:51:16.230
> 
> 标签：.net, console, screen-scraping, buffer, console-scraping

我正在 dot net 中编写一个程序，它将使用框架 2.0 的 Process 对象执行脚本和命令行程序。我希望能够在我的程序中访问进程的屏幕缓冲区。我对此进行了调查，看来我需要访问控制台标准输出和标准错误缓冲区。有人知道这是如何使用托管代码完成的吗？

我想我需要使用附加到任务的 Windows 控制台的 AttachConsole 和 ReadConsoleOutput，以便从控制台屏幕读取字符和属性数据块。我需要做的是托管代码。

请参阅[http://msdn.microsoft.com/en-us/library/ms684965(VS.85).aspx](http://msdn.microsoft.com/en-us/library/ms684965(VS.85).aspx)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-17T03:54:09.607

您可以使用 System.Diagnostics.Process 类的 StandardError、StandardOutput 和 StandardInput 属性来完成此操作。

MSDN 有一个很好的[例子来重定向标准进出](http://msdn.microsoft.com/en-us/library/system.diagnostics.process.standardinput.aspx)进程。

请注意，您只能重定向您启动的进程的输出。您未启动的外部进程在事后无法重定向其标准输出。

另请注意，要使用 StandardInput，必须将 ProcessStartInfo.UseShellExecute 设置为 false，并且必须将 ProcessStartInfo.RedirectStandardInput 设置为 true。否则，写入 StandardInput 流会引发异常。

# sql - 从时间间隔数据中绘制每小时条形图的优雅方法？

> ID：79789
> 
> 赞同：3
> 
> 时间：2008-09-17T03:51:32.140
> 
> 标签：sql, excel, charts, group-by

我有一个显示开始和停止时间的时间表条目列表。它位于 MySQL 数据库中。我需要根据这些数据创建条形图，底部是一天中的 24 小时，以及一天中每个小时的工时。

例如，如果 Alice 从 15:30 到 19:30 工作而 Bob 从 12:15 到 17:00 工作，则图表将如下所示：

[![示例图表](https://i.stack.imgur.com/HHrs0.png)](https://i.stack.imgur.com/HHrs0.png)

我现在有一个 WTFey 解决方案，其中涉及到 DY 列或类似的电子表格。所需的分辨率是 15 分钟间隔。

我假设这是最好在数据库中完成的事情，然后导出以创建图表。如果我遗漏任何细节，请告诉我。谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-17T04:55:55.823

创建一个表，其中包含从午夜到午夜的时间，其中包含一天中的每一分钟。在数据仓库世界中，我们称之为时间维度。这是一个例子：

```
TIME_DIM
 -id
 -time_of_day
 -interval_15 
 -interval_30 
```

表中数据的一个示例是

```
id   time_of_day    interval_15    interval_30
1    00:00          00:00          00:00
...
30   00:23          00:15          00:00
...
100  05:44          05:30          05:30 
```

然后您所要做的就是将您的表加入时间维度，然后按 interval_15 分组。例如：

```
SELECT b.interval_15, count(*) 
FROM my_data_table a
INNER JOIN time_dim b ON a.time_field = b.time
WHERE a.date_field = now()
GROUP BY b.interval_15 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-17T04:54:35.500

我想出了一个伪代码解决方案，希望它有所帮助。

```
create an array named timetable with 24 entries
initialise timetable to zero

for each user in SQLtable
  firsthour = user.firsthour
  lasthour = user.lasthour

  firstminutes = 4 - (rounded down integer(user.firstminutes/15))
  lastminutes = rounded down integer(user.lastminutes/15)

  timetable(firsthour) = timetable(firsthour) + firstminutes
  timetable(lasthour) = timetable(lasthour) + lastminutes

  for index=firsthour+1 to lasthour-1
    timetable(index) = timetable(index) + 4
  next index

next user 
```

现在时间表数组以 15 分钟的粒度保存您想要的值，即。值 4 = 1 小时，5 = 1 小时 15 分钟，14 = 3 小时 30 分钟。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-17T05:00:18.887

这是另一个不同角度的伪代码解决方案；更密集一点，因为它每 24 小时执行 96 次查询：

```
results = []
for time in range(0, 24, .25):
  amount = mysql("select count(*) from User_Activity_Table where time >= start_time and time <= end_time")
  results.append(amount) 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-17T10:06:19.930

这个怎么样：

使用那个“时间”表，但有两列，包含 15 分钟的间隔。from_times 是每 15 分钟的时间，to_times 是下一个 from_times 的前一秒。例如 12:30:00 到 12:44:59。

现在获取您的人员工作表，我在这里称之为“活动”，其中包含 start_time 和 end_time 列。

我根据原始问题为 Alice 和 Bob 添加了值。

这是来自 MySQL 的查询：

```
SELECT HOUR(times.from_time) AS 'TIME', count(*) / 4 AS 'HOURS'
FROM times
  JOIN activity
  ON times.from_time >= activity.start_time AND 
     times.to_time   <= activity.end_time
GROUP BY HOUR(times.from_time)
ORDER BY HOUR(times.from_time) 
```

这给了我这个：

```
TIME   HOURS
12     0.7500
13     1.0000
14     1.0000
15     1.5000
16     2.0000
17     1.0000
18     1.0000
19     0.7500 
```

看起来对...

# python - 如何将本地时间字符串转换为 UTC？

> ID：79797
> 
> 赞同：365
> 
> 时间：2008-09-17T03:52:42.700
> 
> 标签：python, datetime, utc, localtime

如何将*本地时间的日期时间字符串转换为**UTC 时间*的字符串？

我确定我以前做过这个，但找不到它，所以希望将来能帮助我（和其他人）做到这一点。

**澄清**：例如，如果我`2008-09-17 14:02:00`在本地时区（`+10`），我想生成一个具有等效`UTC`时间的字符串：`2008-09-17 04:02:00`。

此外，来自[http://lucumr.pocoo.org/2011/7/15/eppur-si-muove/](http://lucumr.pocoo.org/2011/7/15/eppur-si-muove/)，请注意，通常这是不可能的，因为 DST 和其他问题没有从本地时间到的唯一转换UTC 时间。

* * *

## 回答 #1

> 赞同：338
> 
> 时间：2008-09-17T04:07:28.343

首先，将字符串解析为一个简单的日期时间对象。这是一个`datetime.datetime`没有附加时区信息的实例。请参阅其[文档](https://docs.python.org/3/library/datetime.html#available-types)。

使用该[`pytz`](http://pytz.sourceforge.net/)模块，它带有完整的时区列表 + UTC。弄清楚本地时区是什么，从中构造一个时区对象，然后对其进行操作并将其附加到天真的日期时间。

最后，使用`datetime.astimezone()`方法将日期时间转换为UTC。

源代码，使用本地时区“America/Los_Angeles”，字符串“2001-2-3 10:11:12”：

```
from datetime import datetime   
import pytz

local = pytz.timezone("America/Los_Angeles")
naive = datetime.strptime("2001-2-3 10:11:12", "%Y-%m-%d %H:%M:%S")
local_dt = local.localize(naive, is_dst=None)
utc_dt = local_dt.astimezone(pytz.utc) 
```

从那里，您可以使用该`strftime()`方法根据需要格式化 UTC 日期时间：

```
utc_dt.strftime("%Y-%m-%d %H:%M:%S") 
```

* * *

## 回答 #2

> 赞同：196
> 
> 时间：2010-02-01T07:00:27.827

**注意**- 自 2020 年起，您不应使用`.utcnow()`或`.utcfromtimestamp(xxx)`. 由于您可能已经转向 python3，您应该使用时区感知日期时间对象。

```
>>> from datetime import timezone
>>> 
>>> # alternative to '.utcnow()'
>>> dt_now = datetime.datetime.now(datetime.timezone.utc)
>>>
>>> # alternative to '.utcfromtimestamp()'
>>> dt_ts = datetime.fromtimestamp(1571595618.0, tz=timezone.utc) 
```

详情见：见：[https ://blog.ganssle.io/articles/2019/11/utcnow.html](https://blog.ganssle.io/articles/2019/11/utcnow.html)

## 原始答案（从 2010 年开始）：

datetime 模块的[utcnow()](http://docs.python.org/library/datetime.html#datetime.datetime.utcnow)函数可用于获取当前 UTC 时间。

```
>>> import datetime
>>> utc_datetime = datetime.datetime.utcnow()
>>> utc_datetime.strftime("%Y-%m-%d %H:%M:%S")
'2010-02-01 06:59:19' 
```

正如汤姆上面提到的链接：http: [//lucumr.pocoo.org/2011/7/15/eppur-si-muove/](http://lucumr.pocoo.org/2011/7/15/eppur-si-muove/) 说：

> UTC 是一个没有夏令时的时区，并且仍然是一个过去没有配置更改的时区。
> 
> *始终以 UTC 测量和存储时间*。
> 
> 如果您需要记录所用时间的位置，请单独存储。 ***不要**存储本地时间+时区信息！*

**注意**- 如果您的任何数据位于使用 DST 的区域，`pytz`请使用并查看 John Millikin 的答案。

如果您想从给定的字符串中获取 UTC 时间，并且您很幸运地处于世界上不使用 DST 的地区，或者您的数据仅与 UTC 偏移而未应用 DST：

--> 使用本地时间作为偏移值的基础：

```
>>> # Obtain the UTC Offset for the current system:
>>> UTC_OFFSET_TIMEDELTA = datetime.datetime.utcnow() - datetime.datetime.now()
>>> local_datetime = datetime.datetime.strptime("2008-09-17 14:04:00", "%Y-%m-%d %H:%M:%S")
>>> result_utc_datetime = local_datetime + UTC_OFFSET_TIMEDELTA
>>> result_utc_datetime.strftime("%Y-%m-%d %H:%M:%S")
'2008-09-17 04:04:00' 
```

--> 或者，从已知的偏移量，使用 datetime.timedelta()：

```
>>> UTC_OFFSET = 10
>>> result_utc_datetime = local_datetime - datetime.timedelta(hours=UTC_OFFSET)
>>> result_utc_datetime.strftime("%Y-%m-%d %H:%M:%S")
'2008-09-17 04:04:00' 
```

更新：

由于 python 3.2`datetime.timezone`可用。您可以使用以下命令生成时区感知日期时间对象：

```
import datetime

timezone_aware_dt = datetime.datetime.now(datetime.timezone.utc) 
```

如果您准备好进行时区转换，请阅读以下内容：

[https://medium.com/@eleroy/10-things-you-need-to-know-about-date-and-time-in-python-with-datetime-pytz-dateutil-timedelta-309bfbafb3f7](https://medium.com/@eleroy/10-things-you-need-to-know-about-date-and-time-in-python-with-datetime-pytz-dateutil-timedelta-309bfbafb3f7)

* * *

## 回答 #3

> 赞同：68
> 
> 时间：2008-09-17T04:15:39.290

感谢@rofly，从字符串到字符串的完整转换如下：

```
time.strftime("%Y-%m-%d %H:%M:%S", 
              time.gmtime(time.mktime(time.strptime("2008-09-17 14:04:00", 
                                                    "%Y-%m-%d %H:%M:%S")))) 
```

`time`我对/`calendar`功能的总结：

`time.strptime`
字符串 --> 元组（没有应用时区，所以匹配字符串）

`time.mktime`
本地时间元组->自纪元以来的秒数（始终为本地时间）

`time.gmtime`
自纪元以来的秒数 --> UTC 元组

和

`calendar.timegm`
UTC中的元组->自纪元以来的秒数

`time.localtime`
自纪元以来的秒数->本地时区中的元组

* * *

## 回答 #4

> 赞同：41
> 
> 时间：2012-10-26T09:38:42.033

这里总结了常见的 Python 时间转换。

有些方法会减少几分之一秒，并用*(s)*标记。`ts = (d - epoch) / unit`可以改用诸如此类的显式公式（感谢 jfs）。

*   struct_time (UTC) → POSIX *(s)* :
    `calendar.timegm(struct_time)`
*   Naïve datetime (local) → POSIX *(s)* :
    `calendar.timegm(stz.localize(dt, is_dst=None).utctimetuple())`
    (DST 转换期间的异常，请参阅 jfs 的评论)
*   天真的日期时间（UTC）→POSIX *（s）*：
    `calendar.timegm(dt.utctimetuple())`
*   知道日期时间→POSIX *（s）*：
    `calendar.timegm(dt.utctimetuple())`
*   POSIX → struct_time (UTC, *s* ):
    `time.gmtime(t)`
    (见 jfs 的评论)
*   Naïve datetime (local) → struct_time (UTC, *s* ):
    `stz.localize(dt, is_dst=None).utctimetuple()`
    (DST 转换期间的异常，请参阅 jfs 的评论)
*   天真的日期时间 (UTC) → struct_time (UTC, *s* )：
    `dt.utctimetuple()`
*   知道 datetime → struct_time (UTC, *s* )：
    `dt.utctimetuple()`
*   POSIX → 天真的日期时间（本地）：（
    `datetime.fromtimestamp(t, None)`
    在某些情况下可能会失败，请参阅下面 jfs 的评论）
*   struct_time (UTC) → Naïve datetime (local, *s* ):
    `datetime.datetime(struct_time[:6], tzinfo=UTC).astimezone(tz).replace(tzinfo=None)`
    (不能代表闰秒，见 jfs 的评论)
*   朴素日期时间 (UTC) → 朴素日期时间（本地）：
    `dt.replace(tzinfo=UTC).astimezone(tz).replace(tzinfo=None)`
*   Aware datetime → Naïve datetime (local):
    `dt.astimezone(tz).replace(tzinfo=None)`
*   POSIX → 朴素日期时间 (UTC)：
    `datetime.utcfromtimestamp(t)`
*   struct_time (UTC) → Naïve datetime (UTC, *s* )：（
    `datetime.datetime(*struct_time[:6])`
    不能代表闰秒，见 jfs 的评论）
*   朴素日期时间（本地）→ 朴素日期时间（UTC）：（
    `stz.localize(dt, is_dst=None).astimezone(UTC).replace(tzinfo=None)`
    DST 转换期间的异常，请参阅 jfs 的评论）
*   知道日期时间 → 朴素的日期时间 (UTC)：
    `dt.astimezone(UTC).replace(tzinfo=None)`
*   POSIX → 感知日期时间：（
    `datetime.fromtimestamp(t, tz)`
    对于非 pytz 时区可能会失败）
*   struct_time (UTC) → Aware datetime *(s)* :
    `datetime.datetime(struct_time[:6], tzinfo=UTC).astimezone(tz)`
    (不能代表闰秒，见 jfs 的评论)
*   Naïve datetime (local) → Aware datetime：
    `stz.localize(dt, is_dst=None)`
    （DST 转换期间的异常，请参阅 jfs 的评论）
*   天真的日期时间 (UTC) → 知道日期时间：
    `dt.replace(tzinfo=UTC)`

资料来源：[taaviburns.ca](http://taaviburns.ca/presentations/what_you_need_to_know_about_datetimes/)

* * *

## 回答 #5

> 赞同：24
> 
> 时间：2008-09-17T03:54:39.403

```
def local_to_utc(t):
    secs = time.mktime(t)
    return time.gmtime(secs)

def utc_to_local(t):
    secs = calendar.timegm(t)
    return time.localtime(secs) 
```

来源： http: [//feihonghsu.blogspot.com/2008/02/converting-from-local-time-to-utc.html](http://feihonghsu.blogspot.com/2008/02/converting-from-local-time-to-utc.html)

[bd808](https://stackoverflow.com/users/8171/bd808)的示例用法：如果您的源是`datetime.datetime`object `t`，请调用：

```
local_to_utc(t.timetuple()) 
```

* * *

## 回答 #6

> 赞同：23
> 
> 时间：2011-12-19T14:58:01.647

我对[dateutil](http://labix.org/python-dateutil)很满意（在 SO 上广泛推荐其他相关问题）：

```
from datetime import *
from dateutil import *
from dateutil.tz import *

# METHOD 1: Hardcode zones:
utc_zone = tz.gettz('UTC')
local_zone = tz.gettz('America/Chicago')
# METHOD 2: Auto-detect zones:
utc_zone = tz.tzutc()
local_zone = tz.tzlocal()

# Convert time string to datetime
local_time = datetime.strptime("2008-09-17 14:02:00", '%Y-%m-%d %H:%M:%S')

# Tell the datetime object that it's in local time zone since 
# datetime objects are 'naive' by default
local_time = local_time.replace(tzinfo=local_zone)
# Convert time to UTC
utc_time = local_time.astimezone(utc_zone)
# Generate UTC time string
utc_string = utc_time.strftime('%Y-%m-%d %H:%M:%S') 
```

（代码源自[将 UTC 日期时间字符串转换为本地日期时间](https://stackoverflow.com/a/4771733/165673)的答案）

* * *

## 回答 #7

> 赞同：19
> 
> 时间：2012-04-06T07:54:41.060

pytz 的另一个示例，但包括 localize()，它节省了我的时间。

```
import pytz, datetime
utc = pytz.utc
fmt = '%Y-%m-%d %H:%M:%S'
amsterdam = pytz.timezone('Europe/Amsterdam')

dt = datetime.datetime.strptime("2012-04-06 10:00:00", fmt)
am_dt = amsterdam.localize(dt)
print am_dt.astimezone(utc).strftime(fmt)
'2012-04-06 08:00:00' 
```

* * *

## 回答 #8

> 赞同：12
> 
> 时间：2012-08-29T21:40:03.333

我在[python-dateutil](https://dateutil.readthedocs.org/en/latest/relativedelta.html)方面取得了最大的成功：

```
from dateutil import tz

def datetime_to_utc(date):
    """Returns date in UTC w/o tzinfo"""
    return date.astimezone(tz.gettz('UTC')).replace(tzinfo=None) if date.tzinfo else date 
```

* * *

## 回答 #9

> 赞同：8
> 
> 时间：2011-02-04T05:38:34.257

```
import time

import datetime

def Local2UTC(LocalTime):

    EpochSecond = time.mktime(LocalTime.timetuple())
    utcTime = datetime.datetime.utcfromtimestamp(EpochSecond)

    return utcTime

>>> LocalTime = datetime.datetime.now()

>>> UTCTime = Local2UTC(LocalTime)

>>> LocalTime.ctime()

'Thu Feb  3 22:33:46 2011'

>>> UTCTime.ctime()

'Fri Feb  4 05:33:46 2011' 
```

* * *

## 回答 #10

> 赞同：8
> 
> 时间：2020-09-28T07:09:29.983

自 Python 3.6 起可用的选项：`datetime.astimezone(tz=None)`可用于获取表示本地时间[(docs)](https://docs.python.org/3/library/datetime.html#datetime.datetime.astimezone)的感知日期时间对象。然后可以轻松地将其转换为 UTC。

```
from datetime import datetime, timezone
s = "2008-09-17 14:02:00"

# to datetime object:
dt = datetime.fromisoformat(s) # Python 3.7

# I'm on time zone Europe/Berlin; CEST/UTC+2 during summer 2008
dt = dt.astimezone()
print(dt)
# 2008-09-17 14:02:00+02:00

# ...and to UTC:
dtutc = dt.astimezone(timezone.utc)
print(dtutc)
# 2008-09-17 12:02:00+00:00 
```

旁注：虽然所描述的到 UTC 的转换工作得非常好，但`.astimezone()`将`tzinfo`datetime 对象设置为 timedelta 派生的时区 - 所以不要期望它有任何“DST 意识”。

* * *

## 回答 #11

> 赞同：6
> 
> 时间：2010-02-27T16:12:25.903

如果您更喜欢 datetime.datetime：

```
dt = datetime.strptime("2008-09-17 14:04:00","%Y-%m-%d %H:%M:%S")
utc_struct_time = time.gmtime(time.mktime(dt.timetuple()))
utc_dt = datetime.fromtimestamp(time.mktime(utc_struct_time))
print dt.strftime("%Y-%m-%d %H:%M:%S") 
```

* * *

## 回答 #12

> 赞同：6
> 
> 时间：2018-05-02T15:50:14.787

## 简单的

我是这样做的：

```
>>> utc_delta = datetime.utcnow()-datetime.now()
>>> utc_time = datetime(2008, 9, 17, 14, 2, 0) + utc_delta
>>> print(utc_time)
2008-09-17 19:01:59.999996 
```

## 花式实施

如果你想变得花哨，你可以把它变成一个仿函数：

```
class to_utc():
    utc_delta = datetime.utcnow() - datetime.now()

    def __call__(cls, t):
        return t + cls.utc_delta 
```

结果：

```
>>> utc_converter = to_utc()
>>> print(utc_converter(datetime(2008, 9, 17, 14, 2, 0)))
2008-09-17 19:01:59.999996 
```

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2009-09-23T06:28:23.760

怎么样 -

```
time.strftime("%Y-%m-%dT%H:%M:%SZ", time.gmtime(seconds)) 
```

如果是秒，`None`则它将本地时间转换为 UTC 时间，否则将传入的时间转换为 UTC。

* * *

## 回答 #14

> 赞同：4
> 
> 时间：2012-08-21T16:30:50.050

你可以这样做：

```
>>> from time import strftime, gmtime, localtime
>>> strftime('%H:%M:%S', gmtime()) #UTC time
>>> strftime('%H:%M:%S', localtime()) # localtime 
```

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2021-09-20T21:39:04.147

这是 Python3.9 中原生**zoneinfo**[模块](https://docs.python.org/3/library/zoneinfo.html)的示例：

 **```
from datetime import datetime
from zoneinfo import ZoneInfo

# Get timezone we're trying to convert from
local_tz = ZoneInfo("America/New_York")
# UTC timezone
utc_tz = ZoneInfo("UTC")

dt = datetime.strptime("2021-09-20 17:20:00","%Y-%m-%d %H:%M:%S")
dt = dt.replace(tzinfo=local_tz)
dt_utc = dt.astimezone(utc_tz)

print(dt.strftime("%Y-%m-%d %H:%M:%S"))
print(dt_utc.strftime("%Y-%m-%d %H:%M:%S")) 
```

这可能比仅`dt.astimezone()`在您要转换的时区不反映系统的本地时区的情况下使用更可取。不必依赖外部库也很好。

**注意**：这可能不适用于 Windows 系统，因为[zoneinfo 依赖于](https://docs.python.org/3/library/zoneinfo.html#data-sources)可能不存在的 IANA 数据库。可以安装[tzdata](https://tzdata.readthedocs.io/en/latest/)包作为解决方法。它是第一方包，但不在标准库中。

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2011-11-09T16:59:57.613

用于避开夏令时等。

以上答案都没有对我特别有帮助。下面的代码适用于 GMT。

```
def get_utc_from_local(date_time, local_tz=None):
    assert date_time.__class__.__name__ == 'datetime'
    if local_tz is None:
        local_tz = pytz.timezone(settings.TIME_ZONE) # Django eg, "Europe/London"
    local_time = local_tz.normalize(local_tz.localize(date_time))
    return local_time.astimezone(pytz.utc)

import pytz
from datetime import datetime

summer_11_am = datetime(2011, 7, 1, 11)
get_utc_from_local(summer_11_am)
>>>datetime.datetime(2011, 7, 1, 10, 0, tzinfo=<UTC>)

winter_11_am = datetime(2011, 11, 11, 11)
get_utc_from_local(winter_11_am)
>>>datetime.datetime(2011, 11, 11, 11, 0, tzinfo=<UTC>) 
```

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2017-02-20T15:32:49.180

使用[http://crsmithdev.com/arrow/](http://crsmithdev.com/arrow/)

```
arrowObj = arrow.Arrow.strptime('2017-02-20 10:00:00', '%Y-%m-%d %H:%M:%S' , 'US/Eastern')

arrowObj.to('UTC') or arrowObj.to('local') 
```

这个图书馆让生活变得轻松:)

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2020-06-06T20:25:10.207

我的一个项目中有这段代码：

```
from datetime import datetime
## datetime.timezone works in newer versions of python
try:
    from datetime import timezone
    utc_tz = timezone.utc
except:
    import pytz
    utc_tz = pytz.utc

def _to_utc_date_string(ts):
    # type (Union[date,datetime]]) -> str
    """coerce datetimes to UTC (assume localtime if nothing is given)"""
    if (isinstance(ts, datetime)):
        try:
            ## in python 3.6 and higher, ts.astimezone() will assume a
            ## naive timestamp is localtime (and so do we)
            ts = ts.astimezone(utc_tz)
        except:
            ## in python 2.7 and 3.5, ts.astimezone() will fail on
            ## naive timestamps, but we'd like to assume they are
            ## localtime
            import tzlocal
            ts = tzlocal.get_localzone().localize(ts).astimezone(utc_tz)
    return ts.strftime("%Y%m%dT%H%M%SZ") 
```

* * *

## 回答 #19

> 赞同：2
> 
> 时间：2020-10-31T20:23:46.243

在 python 3.9.0 中，将本地时间解析`local_time`为`datetime.datetime`对象后，只需使用`local_time.astimezone(datetime.timezone.utc)`.

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2018-12-13T10:53:34.970

[我在这里](https://stackoverflow.com/a/1596308/289368)找到了另一个问题的最佳答案。它只使用 python 内置库，不需要您输入本地时区（在我的情况下是一个要求）

```
import time
import calendar

local_time = time.strptime("2018-12-13T09:32:00.000", "%Y-%m-%dT%H:%M:%S.%f")
local_seconds = time.mktime(local_time)
utc_time = time.gmtime(local_seconds) 
```

我在这里重新发布答案，因为这个问题会根据搜索关键字在谷歌中弹出，而不是链接问题。

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2021-09-02T13:45:03.547

对于任何对最受好评的答案感到困惑的人。您可以通过生成 datetime 对象将 datetime 字符串转换为 python 中的 utc 时间，然后您可以使用 astimezone(pytz.utc) 以 utc 获取 datetime。

例如。

假设我们有本地日期时间字符串，如`2021-09-02T19:02:00Z`isoformat

现在将此字符串转换为 utc 日期时间。我们首先需要使用这个字符串生成日期时间对象

`dt = datetime.strptime(dt,'%Y-%m-%dT%H:%M:%SZ')`

这将为您提供 python datetime 对象，然后您可以使用`astimezone(pytz.utc)`获取 utc datetime 之类的

`dt = datetime.strptime(dt,'%Y-%m-%dT%H:%M:%SZ') dt = dt.astimezone(pytz.utc)`

这将为您提供 UTC 格式的日期时间对象，然后您可以使用将其转换为字符串`dt.strftime("%Y-%m-%d %H:%M:%S")`

完整代码例如：

```
from datetime import datetime
import pytz

def converLocalToUTC(datetime, getString=True, format="%Y-%m-%d %H:%M:%S"):
    dt = datetime.strptime(dt,'%Y-%m-%dT%H:%M:%SZ')
    dt = dt.astimezone(pytz.utc)

    if getString:
        return dt.strftime(format)
    return dt 
```

那么你可以称它为

`converLocalToUTC("2021-09-02T19:02:00Z")`

从 [https://stackoverflow.com/a/79877/7756843获得帮助](https://stackoverflow.com/a/79877/7756843)

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2020-07-09T14:17:27.920

如果您已经有一个 datetime 对象`my_dt`，您可以将其更改为 UTC：

```
datetime.datetime.utcfromtimestamp(my_dt.timestamp()) 
```

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2020-07-10T18:28:30.413

**简而言之**，将任何`datetime`日期转换为 UTC 时间：

```
from datetime import datetime

def to_utc(date):
    return datetime(*date.utctimetuple()[:6]) 
```

* * *

让我们用一个例子来解释。首先，我们需要`datetime`从字符串创建一个：

```
>>> date = datetime.strptime("11 Feb 2011 17:33:54 -0800", "%d %b %Y %H:%M:%S %z") 
```

然后，我们可以调用该函数：

```
>>> to_utc(date)
datetime.datetime(2011, 2, 12, 1, 33, 54) 
```

逐步介绍该功能的工作原理：

```
>>> date.utctimetuple()
time.struct_time(tm_year=2011, tm_mon=2, tm_mday=12, tm_hour=1, tm_min=33, tm_sec=54, tm_wday=5, tm_yday=43, tm_isdst=0)
>>> date.utctimetuple()[:6]
(2011, 2, 12, 1, 33, 54)
>>> datetime(*date.utctimetuple()[:6])
datetime.datetime(2011, 2, 12, 1, 33, 54) 
```

* * *

## 回答 #24

> 赞同：-1
> 
> 时间：2018-01-11T09:03:52.493

在python3中：

`pip install python-dateutil`

```
from dateutil.parser import tz

mydt.astimezone(tz.gettz('UTC')).replace(tzinfo=None) 
```

* * *

## 回答 #25

> 赞同：-3
> 
> 时间：2010-11-06T16:02:06.517

怎么样 -

```
time.strftime("%Y-%m-%dT%H:%M:%SZ", time.gmtime(seconds)) 
```

如果是秒，`None`则它将本地时间转换为 UTC 时间，否则将传入的时间转换为 UTC。

# operating-system - 文件修改时间和文件更改时间有什么区别？

> ID：79809
> 
> 赞同：19
> 
> 时间：2008-09-17T03:54:55.237
> 
> 标签：operating-system, filesystems

我对术语文件修改时间和文件更改时间感到困惑。任何人都可以帮助使其更清楚吗？

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2008-09-17T03:58:13.717

mtime 是修改时间 - 内容已更改。

ctime 是状态更改时间 - 权限和所有权以及内容。

[维基百科](http://en.wikipedia.org/wiki/Stat_(Unix))说：

> ```
> * mtime: time of last modification (ls -l),
> * ctime: time of last status change (ls -lc) and
> * atime: time of last access (ls -lu). 
> ```
> 
> 请注意，ctime 不是文件创建的时间。写入文件会更改其 mtime、ctime 和 atime。文件权限或文件所有权的更改会更改其 ctime 和 atime。读取文件会改变它的时间。使用 noatime 选项挂载的文件系统不会在读取时更新 atime，而 relatime 选项仅在前一个 atime 比 mtime 或 ctime 旧时才提供更新。与 atime 和 mtime 不同，ctime 不能用 utime() 设置（例如通过 touch 使用）；将其设置为任意值的唯一方法是更改​​系统时钟。

# javascript - 需要javascript代码来按住按钮

> ID：79816
> 
> 赞同：17
> 
> 时间：2008-09-17T03:55:36.827
> 
> 标签：javascript, mouse

我想要一个简短的最小可能的javascript例程，当一个按钮上发生鼠标按下时，它首先响应就像单击鼠标一样，然后如果用户按住按钮，它会响应，就好像用户不断发送鼠标点击一样，一段时间后使用按下按钮就像用户正在加速他们的鼠标点击......基本上把它想象成一个随着时间加速的按键重复。
即用户按住鼠标按钮（x=调用函数） - x___x___x___x__x__x_x_x_x_xxxxxxx

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-09-17T04:25:29.390

```
function holdit(btn, action, start, speedup) {
    var t;

    var repeat = function () {
        action();
        t = setTimeout(repeat, start);
        start = start / speedup;
    }

    btn.mousedown = function() {
        repeat();
    }

    btn.mouseup = function () {
        clearTimeout(t);
    }
};

/* to use */
holdit(btn, function () { }, 1000, 2); /* x..1000ms..x..500ms..x..250ms..x */ 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-17T03:58:57.270

按下按钮时，`window.setTimeout`使用您的预期时间和功能调用`x`，并在结束时再次设置计时器，`x`但这次间隔更小。

`window.clearTimeout`释放鼠标按钮时使用清除超时。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-17T04:10:38.677

只需将下面的 toggleOn 放在按钮的 OnMouseDown 中，将 toggleOff 放在按钮的 OnMouseUp 中。

```
var tid = 0;
var speed = 100;

function toggleOn(){
    if(tid==0){
        tid=setInterval('ThingToDo()',speed);
    }
}
function toggleOff(){
    if(tid!=0){
        clearInterval(tid);
        tid=0;
    }
}
function ThingToDo{

} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2017-04-14T07:41:13.750

我刚刚发布了一个 jQuery 插件，在这个[repo上查看这个](https://github.com/phuong/jqueryClickAndHold)[演示](https://phuong.github.io/jqueryClickAndHold/)。

```
$('button').clickAndHold(function (e, n) {
    console.log("Call me baby ", n);
}); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2019-10-04T13:37:24.393

@glenuular：感谢这个有趣的方法！它有一些小问题： - 起始值没有重置，所以在第二次使用时它开始太快了。- 起始值被无限分割，所以在短时间内变得非常小。- 参数未传递给被调用的方法。（现在限制为 6 个参数，通常足以通过 'ev'）。

```
 function holdit( btn, method, start, speedup ) {
    var t, keep = start;
    var repeat = function () {
        var args = Array.prototype.slice.call( arguments );
        method.apply( this, args );
        t = setTimeout( repeat, start, args[0], args[1], args[2], args[3], args[4], args[5] );
        if ( start > keep / 20 ) start = start / speedup;
    }
    btn.onmousedown = btn.mousedown = repeat;
    //
    btn.onmouseout = btn.mouseout = btn.onmouseup = btn.mouseup = function () {
        clearTimeout( t );
        start = keep;
    }
}; 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2021-12-29T15:41:49.743

我升级了 neouser99 解决方案，因为我遇到了一些问题^^

```
let holdIt = (btn, action, start, speedup, limit) => {
    let t;
    let startValue = start;

    let repeat = () => {
        action();
        t = setTimeout(repeat, startValue);
        (startValue > limit) ? startValue /= speedup: startValue = limit;
    }

    btn.onmousedown = () => {
        repeat();
    }

    const stopActionEvents = ['mouseup', 'mouseout'];

    stopActionEvents.forEach(event => {
        btn.addEventListener(event, () => {
            clearTimeout(t);
            startValue = start;
        })
    });

};

holdIt(actionButton, functionToDo, 500, 2, 5); 
```

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-09-17T04:04:17.350

类似下面的伪代码可能会起作用..

```
var isClicked = false;
var clickCounter = 100;
function fnTrackClick(){
   if(isClicked){
      clickCounter--;
      setTimeout(clickCounter * 100, fnTrackClick);
   }
}

<input type="button" value="blah" onmousedown="isClicked=true;" onmouseover="fnTrackClick();" onmouseup="isClicked = false;" /> 
```

# java - 在 UI 中使用 Hibernate 对象图之前加载它的最佳方法是什么？

> ID：79843
> 
> 赞同：1
> 
> 时间：2008-09-17T04:02:00.993
> 
> 标签：java, hibernate

情况是这样的：

*   您有一个 Hibernate 上下文，其中包含一个定义了一些延迟加载的对象图。
*   您想在 UI 中按原样使用 Hibernate 对象，而不必在某处复制数据。
*   有不同的 UI 上下文需要不同数量的数据。
*   数据太大，每次都急于加载整个图表。

以可配置的方式在对象图中加载所有适当的对象，以便无需返回数据库加载更多数据即可访问它们的最佳方法是什么？

任何帮助。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-17T04:19:52.180

假设您有客户，并且在某一时刻您必须处理他的订单，也许他的订单有奖金。

然后我会定义一个具有流畅界面的存储库，这将允许我说类似的话：

```
new ClientRepo().LoadClientBy(id)
                .WithOrders()
                .WithBonus()
                .OrderByName(); 
```

那里有你需要的一切的客户。您最好提前知道当前操作需要什么。这样您可以避免不必要的数据库访问。（您团队中的新开发人员通常会这样做 - 调用属性而不知道它实际上是对数据库的调用）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-17T05:00:17.997

如果它是一个 web 应用程序并且您使用的是 Spring，那么 OpenSessionInViewFilter 可能是您的问题的解决方案。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-17T20:12:01.863

我们在项目中使用的一种方法是为您拥有的每个视图创建一个服务。然后视图获取此特定视图所需的子图，始终尝试减少发送到数据库的 sql 数量。因此，我们使用大量连接来获取 n:1 关联对象。

如果您使用的是直接连接到数据库的 2 层桌面应用程序，您可以只保留附加的对象并随时自动加载其他数据。否则，您必须将其重新附加到会话并初始化您需要的关联`Hibernate.initialize(Object entity, String propertyName)`

（内存不足，可能不是 100% 正确）

# python - 您如何为 Bigtable/Datastore (GAE) 设计数据模型？

> ID：79850
> 
> 赞同：18
> 
> 时间：2008-09-17T04:02:53.720
> 
> 标签：python, database, google-app-engine, bigtable

由于 Google App Engine 数据存储区基于[Bigtable](http://research.google.com/archive/bigtable.html)，而且我们知道这不是关系型数据库，您如何为使用此类数据库系统的应用程序设计***数据库架构*/*数据模型？***

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-09-17T06:02:38.567

设计大表模式是一个开放的过程，基本上需要您考虑：

*   您将使用的访问模式以及每种模式的使用频率
*   你的类型之间的关系
*   您将需要哪些索引
*   您将使用的写入模式（为了有效地分散负载）

GAE 的数据存储会自动对您的数据进行非规范化处理。也就是说，每个索引都包含（大部分）完整的数据副本，因此每个索引都会显着增加执行写入所需的时间和使用的存储空间。

如果不是这种情况，那么设计 Datastore 架构的工作量会大很多：您必须仔细考虑每种类型的主键，并考虑您的决定对数据位置的影响。例如，当呈现一篇博客文章时，您可能需要显示评论以配合它，因此每个评论的键可能会以相关文章的键开头。

对于 Datastore，这没什么大不了的：您使用的查询将类似于“Select * FROM Comment WHERE post_id = N”。（如果您想对评论进行分页，您还需要一个限制子句，以及可能的“AND comment_id > last_comment_id”后缀。）添加这样的查询后，Datastore 将为您构建索引，您的读取将是神奇地快。

需要记住的是，每个额外的索引都会产生一些额外的成本：最好使用尽可能少的访问模式，因为它会减少 GAE 将构建的索引数量，从而减少数据所需的总存储空间.

阅读这个答案，我发现它有点模糊。也许一个动手设计问题将有助于缩小范围？:-)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-13T03:49:29.923

您可以使用 www.web2py.com。您构建模型和应用程序一次，它可以在 GAE 上运行，也可以在 SQLite、MySQL、Posgres、Oracle、MSSQL、FireBird 上运行

* * *

## 回答 #3

> 赞同：-2
> 
> 时间：2008-09-17T06:01:53.450

由于 GAE 建立在 Django 中如何管理数据的基础上，因此在 Django 文档中有很多关于如何解决类似问题的信息（例如，请参阅[此处](http://www.djangobook.com/en/1.0/chapter05/)，向下滚动到“您的第一个模型”）。

简而言之，您将 db 模型设计为常规对象模型，并让 GAE 整理所有对象关系映射。

# networking - 检测非托管第 2 层交换机的网络映射算法？

> ID：79853
> 
> 赞同：11
> 
> 时间：2008-09-17T04:03:17.027
> 
> 标签：networking, topology

我继承了一个分布在仓库/前台办公室的网络，该网络由大约 50 台台式电脑、各种服务器、网络打印机和路由器/交换机组成。

“智能”路由器位于服务器机房中。随着公司的发展，我们增加了额外的空间，并且不是很优雅地通过天花板等运行各种长度的 CAT5。我一直在天花板上找到各种集线器和开关——它们都没有以任何方式标记或记录.

当然，das blinken-lights 告诉我*有人*连接到这些设备，我只是无法找出是*谁*。

我可以运行传统的网络地图工具（有很多这样的东西），它向我展示了网络中基于 IP 的东西。这很好，但我已经掌握了信息。我需要知道的是网络拓扑——交换机（网桥）是如何互连的等等。而且由于它们是现成的 linksys 非托管类型，它们不响应 SNMP，所以我不能使用它...

我可以用来分析和检测网络中不响应 SNMP 的集线器和交换机之类的最好/最便宜的工具是什么？

如果没有你知道的工具——你会建议用什么通用算法来找出这个问题？我的猜测是我可以查看设备（交换机、台式机等）的 MAC 转发表并以这种方式构建一个链，但我不知道是否可以从非托管交换机获得它（更不用说一个枢纽）。

（这个专利有一些巧妙的想法，但我找不到任何用它构建的软件：[http](http://www.freepatentsonline.com/6628623.html) ://www.freepatentsonline.com/6628623.html ）

谢谢！！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-17T13:12:54.413

一个想法可能是使用像 3com network director 试用版（或 The Dude）这样的程序。使用它来发现您的所有工作站和任何其他具有 IP 地址的东西。

等待一段安静的时间并拔下每个集线器/交换机……然后您至少可以开始制作地图，其余的将沿着电缆爬行。网络管理确实意味着变脏。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-17T13:24:18.207

您可能无法显式**检测**非托管设备...但是您的托管设备上有 MAC -> 交换机端口映射，对吗？如果是这样，您应该能够**推断**出存在多个连接客户端的非托管交换机/集线器——我不知道您如何找到只有一个客户端的端口。

1.  记录所有智能交换机和客户端设备的 MAC 地址
2.  从您已知的智能开关之一开始
3.  对于交换机上的每个端口，列出它转发的 MAC 地址。如果它列出一个客户，它是直接的。如果它不止一个，并且没有一个地址在您已知的交换机 MAC 中，那么您就有了一个愚蠢的交换机。如果您的一组已知开关中有一个以上的地址，请在此开关上递归。

您的网络拓扑中可能没有任何意外循环（或者您的网络可能无法工作），因此您可以假设核心之外的树结构。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-19T13:32:53.013

您可以尝试从智能交换机中获取生成树协议信息；即使是非托管交换机也必须参与此协议（但这不适用于集线器）。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-17T04:13:45.520

我不认为非托管交换机/集线器会有 arp 条目——在 mac 层透明是它们存在的原因。

而且我认为没有办法让他们的 MAC 转发表不将它们拆开并找到一个 JTAG 或其他端口与他们交谈，这不太可能是可行的。

我能想到的最好办法是依次对每个内部 IP 进行 pingflood，然后在此过程中尝试 ping 所有其他 IP。这将有所帮助，因为您只会从不与您正在 pingflooding 的机器共享（现在已经被遗忘）链接的机器获得体面的响应。基本上，您使用的是交换机上的背板比它们之间的互连要快得多的事实来映射出哪些连接是通过互连，哪些是通过背板。这还可以让您观看 das blinkenlights 并找出哪些端口用于连接到哪些 IP。

可悲的是，我知道没有软件可以为您执行此操作。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-29T20:50:35.563

我个人也遇到过同样的问题。乐趣。我通过在主数据柜中安装新的 Cisco Catalyst 交换机并将每个端口上的智能端口配置文件设置为“桌面”来部分解决了该问题。这将端口限制为 1 个 MAC 地址。

第一次在非托管设备上激活多个设备时，任何连接了非托管集线器/交换机的端口都将自动禁用。

当我找到非托管集线器/交换机时，我将它们替换为配置为将每个端口限制为 1 个 MAC 的托管交换机。

如果您的预算不允许这样做，另一种方法是目视跟踪每条线路并手动验证是否存在未管理的网络设备。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2015-08-25T10:19:04.333

我一直在研究这个，我发现了这篇旧的研究论文[Using VPS Probing to Discover Layer 2 Topology](http://www.wand.net.nz/~salcock/discovery/discovery.html)。理论上，您可以使用可变数据包大小 (VPS) 探测通过它们引入的延迟来发现第 2 层交换机。我还没有机会在实践中尝试它。

Update: I found a later version of the paper called [Using Simple Per-Hop Capacity Metrics to Discover Link Layer Network Topology](http://wand.net.nz/pubs/223/pdf/PAM_paper.pdf)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-19T19:08:05.827

如果您还没有，请尝试 HP Openview 试用版，除了使用 SNMP 之外，它还使用 ARP 表来确定您的拓扑。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-01-22T06:05:13.467

您可以在下个月发布的 AdventNet 的 opmanager8.0 中期待这些功能

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-09-11T01:48:10.660

您可以尝试 NetskateKoban，它会为您提供连接到托管交换机每个端口的终端数量的地图。您可以通过供应商名称从那里了解未管理设备的存在。

我们已经看到了类似的问题，网络管理员必须弄清楚存在多少交换机（托管/非托管）。它会给你这些地方的位置。试试看……一切顺利

# sql-server - 从另一个存储过程计算存储过程结果的最有效方法是什么？

> ID：79856
> 
> 赞同：2
> 
> 时间：2008-09-17T04:03:38.413
> 
> 标签：sql-server, tsql

在存储过程中，我需要获取另一个存储过程的结果计数。具体来说，我需要知道它是否返回任何结果或一个空集。

我可以创建一个临时表/表变量，将存储过程执行到其中，然后对该数据运行选择计数。但我真的不关心数据本身，我需要的只是计数（或数据的存在/不存在）。我想知道是否有更有效的方法来获取这些信息。

我不想只复制其他存储过程的内容并将其重写为选择计数。存储过程更改太频繁以至于无法使用。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-17T04:06:08.627

好吧，根据存储过程的工作方式，@@ROWCOUNT 返回 SP 将执行的任何操作（包括更新）的结果数：http: [//msdn.microsoft.com/en-us/library/ms187316.aspx](http://msdn.microsoft.com/en-us/library/ms187316.aspx)

这仅在您在 sp 中执行的最后一件事是将行返回给客户端时才有效……否则您将获得其他语句的结果。说得通？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-17T04:05:01.203

@@ROWCOUNT

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-17T04:06:00.250

使用输出参数

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-17T04:30:42.187

我认为您可以返回行数（使用 RETURN）或使用 out 参数来获取值。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-17T04:05:23.357

如果您可以将其他过程重写为返回结果集的简单函数，则可以简单地从中选择 count(*)。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-17T05:01:05.297

似乎是其他人更改了其他存储过程，无论对此类过程进行更改，您都需要一些东西来有效地检查结果。

创建一个 tempt 表并将该过程的结果插入其中。

然后您可以对结果执行行计数。如果我正确理解您的问题，这不是最有效但最可靠的解决方案。

片段：

```
DECLARE @res AS TABLE (
    [EmpID] [int] NOT NULL,
    [EmpName] [varchar](30) NULL,
    [MgrID] [int] NULL
)

INSERT @res 
EXEC dbo.ProcFoo

SELECT COUNT(*) FROM @res 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-10-09T17:01:08.310

我认为你应该这样做：

```
Create  Procedure   [dbo].[GetResult]   (
    @RowCount   BigInt  =   -1  Output
)   As  Begin

    /*
        You can do whatever else you should do here.
    */

    Select  @RowCount   =   Count_Big(*)
        From    dbo.SomeLargeOrSmallTable
        Where   SomeColumn  =   'Somefilters'
        ;

    /*
        You can do whatever else you should do here.
    */

    --Reporting how your procedure has done the statements. It's just a sample to show you how to work with the procedures. There are many ways for doing these things.
    Return  @@Error;

End; 
```

写完之后，你可以得到这样的输出结果：

```
Declare @RowCount   BigInt
,   @Result     Int
;

Execute @Result =   [dbo].[GetResult]   @RowCount   Out

Select  @RowCount
,   @Result
; 
```

干杯

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-17T12:30:53.873

鉴于您实际上并不需要知道计数，而只需要知道您的 sproc 是否有数据，我建议您这样做：

```
CREATE PROCEDURE subProcedure @param1, @param2, @Param3 tinyint OUTPUT
AS
BEGIN
  IF EXISTS(SELECT * FROM table1 WHERE we have something to work with)
   BEGIN
    -- The body of your sproc
    SET @Param3 = 1
   END
  ELSE
   SET @Param3 = 0
END 
```

现在您可以执行存储过程并检查@Param3 的值：

```
DECLARE @ThereWasData tinyint
exec subProcedure 'foo', 'bar', @ThereWasData OUTPUT
IF @ThereWasData = 1 
  PRINT 'subProcedure had data'
ELSE
  PRINT 'subProcedure had NO data' 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2016-09-01T22:52:39.930

```
 create proc test
    as
    begin
     select top 10 * from customers
    end
    go

    create proc test2 (@n int out)
    as
    begin
    exec test
    set @n = @@rowcount
    --print @n
    end
    go

    declare @n1 int =0

    exec test2 @n1 out
    print @n1
    --output result: 10 
```

# c# - 用于创建 CA 的 C# 实用程序

> ID：79875
> 
> 赞同：1
> 
> 时间：2008-09-17T04:07:25.690
> 
> 标签：c#, openssl, certificate-authority

我想在 C# 中创建一个实用程序，以允许某人在 Windows 中轻松创建证书颁发机构 (CA)。有什么想法/建议吗？

我知道我可以使用 OpenSSL 来做到这一点。最后，我希望这个实用程序能做的不仅仅是生成 CA。我还想避免需要安装 OpenSSL 才能运行我的实用程序。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-17T04:12:48.143

由于 OpenSSL 是 Apache 许可的（即 BSD 风格），您可以简单地将其作为 DLL 与您的应用程序一起分发。（也许自己构建它以仅在一个 DLL 中拥有您需要的所有功能。）然后使用 p/invoke 调用与此 DLL 对话。

（也许您甚至可以将本机代码直接链接到您的 .NET 可执行文件中？对此不确定。）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-02-09T11:45:53.637

看看 BouncyCastle [http://www.bouncycastle.org/csharp/](http://www.bouncycastle.org/csharp/)

# ruby-on-rails - ActiveRecord#save_only_valid_attributes

> ID：79880
> 
> 赞同：0
> 
> 时间：2008-09-17T04:07:48.187
> 
> 标签：ruby-on-rails, ruby

我正在寻找一种`#save`方法的变体，它只会保存没有附加错误的属性。所以一个模型可以在整体上不有效的情况下更新，这仍然可以防止将无效数据保存到数据库中。

“有效属性”是指那些在调用 @model_instance.errors.on(:attribute) 时给出 nil 的属性

任何人都知道如何做到这一点？

到目前为止，我有以下内容：

```
def save_valid_attributes 
 valid? 
 update_atrtibutes attributes.inject({}){|k, v, m| m[k] = v unless errors_on(k.to_sym); m} 
end 
```

如果没有对分配进行处理，这在我的情况下是有效的。例如，我有一个数据库列“start_date”，并定义了两个方法：

```
def nice_start_date=(startdate)
 self.start_date = Chronic.parse(startdate) || startdate
end

def nice_start_date
 self.start_date.to_s
end 
```

这两种方法允许我在保存之前使用 Chronic 正确解析用户输入的日期。所以，第二种方法，一次一个属性：

```
def save_valid_attributes(attrib) 
  valid?
  attrib.each{|(k,v)| send("${k}=", v); save; reload)
end 
```

每次都需要重新加载模型，因为如果其中一个日期无效且未保存，它将阻止所有进一步的属性保存。

有一个更好的方法吗？我确信这在 Rails 世界中并不少见，我只是似乎无法在 Google 的知识世界中找到任何东西。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-09-18T00:40:57.613

我不确定如果没有很多麻烦，你会有多少运气。

无论您的框架如何实现 DRY 和 OO 以及多么简单（在这种情况下是 - 很多 =），您仍然必须记住它是在一个沼泽标准关系数据库前面运行的，该数据库具有原子提交作为它的*定义之一* *特点*。它是从头开始设计的，以确保您的所有更改都已提交，或者没有。

您将有效地使用与 rails + 设计工作方式100％背道而驰的标准功能。这很可能导致（如前所述）不一致的数据。

话说回来 。. . 总是有可能的。我会按照对您关心的属性进行手动验证的方式进行查看，然后使用内置方法`object.update_attribute_with_validation_skipping.`

祝你好运！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-04-14T11:45:45.657

您可以像这样覆盖`#save`：

```
def save
  errors.each do |attr, msg|
    send("#{attr}=", send("#{attr}_was"))
  end
  super
end 
```

这将重置所有带有错误附加到其原始值的属性。

# java - 基于 Swing 的应用程序的最佳测试工具是什么？

> ID：79891
> 
> 赞同：37
> 
> 时间：2008-09-17T04:10:54.810
> 
> 标签：java, swing, testing

虽然我们尝试为我们的应用程序设置尽可能多的单元测试，但我总是发现缺少 UI 级测试的数量。那里有很多选择，但我不确定从哪里开始是个好地方。

用于测试 Swing 应用程序的首选单元测试工具是什么？你为什么喜欢它？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-09-17T05:15:50.283

在我们这边，我们使用[FEST](http://code.google.com/p/fest/)来测试 SWING GUI 。这是经典摆动机器人上的适配器，但它极大地简化了它的使用。

结合 TestNG，我们发现它是一种通过 GUI 模拟“人类”动作的简单方法。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-11-04T02:10:12.223

如果您的目标应用程序有**自定义组件**，我肯定会推荐[Marathon](http://www.marathontesting.com/)来自动化您的测试。

我的任务是自动化一个包含几个*极其*复杂的自定义组件的应用程序，这些组件都是在内部从头开始编写的。我经历了一个持续两个月的审查过程，在这个过程中，我从近 30 种可用的测试工具列表中决定使用哪种测试工具，包括商业和 FOSS。

它是*唯一*能够成功自动化我们特定自定义组件的测试工具；IBM 的 Rational Functional Tester、Microfocus 的 TestPartner、QF-Test、Abbot 和 FEST 都**失败了**。

从那以后，我已经能够成功地将测试与 Cruise Control 集成，以便它们在完成应用程序的每个构建时运行。

不过要提醒一句：
1) 在处理 JTable 的方式上，它的边缘相当粗糙。我通过为他们编写自己的代理类来解决这个问题。
2) 还不支持拖放动作的录制/回放。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-23T16:56:51.163

考虑 Marathon ( [http://www.marathontesting.com/Home.html)——](http://www.marathontesting.com/Home.html)--tests)测试是用 Jython 编写的，因此很容易根据对象状态编写任何类型的谓词。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-17T19:59:36.540

我有机会玩过一次 QF-TEST。它是商业的，但提供了很多功能。也许你看看它：[http ://www.qftest.de/en/index.html](http://www.qftest.de/en/index.html)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-06-16T11:51:22.423

您可以尝试使用[Cucumber](http://cukes.info)和[Swinger](http://github.com/demetriusnunes/swinger)为 Swing GUI 应用程序用简单的英语编写功能验收测试。Swinger 在后台使用 Netbeans 的[Jemmy](http://jemmy.dev.java.net)库来驱动应用程序。

Cucumber 允许您编写如下测试：

```
 Scenario: Dialog manipulation
    Given the frame "SwingSet" is visible
      And the frame "SwingSet" is the container
    When I click the menu "File/About"
    Then I should see the dialog "About Swing!"
    Given the dialog "About Swing!" is the container
    When I click the button "OK"
    Then I should not see the dialog "About Swing!" 
```

看看这个[Swinger 视频演示](http://blog.demetriusnunes.com/past/2009/6/9/who_said_you_cant_test_swing_apps/)，看看它的实际效果。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2011-06-06T01:03:06.670

我强烈推荐 QFTest。我已将它用于我的商业产品，并且几乎为零代码（我的应用程序需要使用 java 客户端 API 来处理某些事情）。它很好地处理了摆动组件的识别，并且非常容忍对 GUI 的更新——（调整大小、重新定位和添加组件不会破坏现有的测试）。我已经对功能进行了重大更新，并且我的测试仍然有效。

它很贵，但我认为它会在几个月内收回成本。

在 QFTTest 之前，我尝试过：

1) Automatedqa - 好工具，但以 Windows 为中心，不理解 Swing。类似于快速测试专业版。

2)UISpec4J - 在每周投入 50 个小时之后，我遇到了脆弱性和它产生的神秘 Java 代码的问题。使用它太费力了——尝试调试/更新数百行执行一系列 GUI 操作的 java 对我的大脑不起作用。我最终避免编写测试，因为它比实际编写应用程序本身要复杂得多！

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-17T05:06:27.513

尝试磅： http: [//pounder.sourceforge.net/](http://pounder.sourceforge.net/)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-26T22:37:08.017

我喜欢 Jemmy，为测试 Netbeans 而编写的库。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2012-10-10T14:39:10.933

不是回答，而是提炼。

录制和播放是错误的。团队需要在编写代码之前编写测试的能力。否则，编码人员会完成他们的工作并等待测试人员争先恐后地记录测试（当他们发现问题时会被修复中断）。

在 BDD/TDD/ATDD 类型的设置中，您确实需要某种工具，允许您为尚未编写的代码编写脚本测试，指定 UI 元素名称等。

是否有适用于非瀑布测试的工具？

# embedded - vxWorks 如何处理具有相同优先级的两个任务？

> ID：79892
> 
> 赞同：3
> 
> 时间：2008-09-17T04:11:04.573
> 
> 标签：embedded, vxworks, rtos

我们的 vxWorks 嵌入式系统中有两个任务（T1 和 T2）具有相同的优先级 (110)。
如果两个任务都准备好运行，常规的 vxWorks 调度程序如何处理这个问题？
哪个任务先执行？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-17T05:19:36.983

首先运行的任务是由 VxWorks 调度程序任务实现的最先产生的任务。VxWorks 默认使用**基于优先级的调度**。因此，在您的情况下，由于 T1 和 T2 具有相同的优先级，因此首先获得 CPU 的任何一个都将无限期地继续运行，直到它被显式阻塞（使用*taskSuspend*或*taskDelay*），此时另一个 READY 任务将执行直到它被阻塞， 等等。这应该由信号量或互斥量（互斥量？）

这个确切的问题阐明了基于优先级的调度的主要问题。我们如何确定让这些任务运行多长时间？他们具有相同的优先级这一事实使事情变得复杂。另一个问题是具有高优先级（数字越小表示优先级越高）的 VxWorks 任务可能会抢占您必须在代码中准备的应用程序。这些问题可以通过使用**循环调度**来解决。轮询调度带来的额外问题和解决方案都[在这里](http://www.cs.ru.nl/lab/vxworks/vxworksOS.html)描述。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-18T00:04:17.357

VxWorks 有 256 个优先级（0 为最高，255 为最低）。在任何给定时间，最高优先级的任务都在 CPU 上运行。每个优先级在概念上都有一个队列，多个任务排队等待执行。

我们有 3 个优先级相同的任务 A、B、C。假设 A 正在执行。
当 A 阻塞（taskDelay、SemTake、msgQReceive）时，B 将开始执行。
当 A 解除阻塞时，它被放在队列的末尾。我们现在有 B、C、A。
当 B 阻塞时，C 接管，等等......

如果启用了循环调度（时间片），则适用相同的概念，但当时间片结束时，任务会被放在队列的末尾。

请注意，被更高优先级任务抢占的任务不会影响队列的顺序。如果 A 正在运行并被抢占，它将在更高优先级的任务完成后继续执行。它不会放在队列的末尾。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-18T20:28:34.133

默认情况下，首先产生的那个将被执行，除非它放弃 CPU，否则另一个永远不会运行。

您可以显式启用循环，而不是时间片。

# visual-studio - mspdbsrv.exe 永远存在？

> ID：79898
> 
> 赞同：39
> 
> 时间：2008-09-17T04:12:14.587
> 
> 标签：visual-studio

有没有办法阻止mspdbsrv.exe在编译完成后继续运行？甚至在我终止视觉工作室之后？或者甚至可能一开始就阻止它产卵？

这家伙到底有什么用？

使用 vs2005

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2010-03-02T14:16:53.903

[MS 建议在此处](http://blogs.msdn.com/ravi_kumar/archive/2009/06/17/my-2-cents-on-mspdbsrv-exe.aspx)的项目选项中添加构建后事件。

> [...]有时即使在构建结束后 mspdbsrv.exe 仍然存在。在这种情况下，添加构建后事件来终止 mspdbsrv.exe 是安全的。

可以在[链接](http://blogs.msdn.com/ravi_kumar/archive/2009/06/17/my-2-cents-on-mspdbsrv-exe.aspx)页面上找到有关 postbuild-Events 的背景信息。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-09-17T05:01:32.330

mspdbsrv.exe 是 Visual Studio 在编译时用于创建 .pdb 文件的进程；这些是让您调试应用程序的符号文件。有时，当您退出 Visual Studio 时，它会发疯并且无法正确关闭。即使在退出并重新启动 Visual Studio 之后，我也遇到了这个原因导致编译错误。如果 mspdbsrv.exe 在您身上损坏，请使用[进程资源管理器](http://technet.microsoft.com/en-us/sysinternals/bb896653)或任务列表（在 Windows 中为 Ctrl+Alt+Delete）手动终止 mspdbsrv.exe。

对于它的价值，我还没有在 Visual Studio 2008 中看到这个问题，但我只使用了几天。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-08T22:40:02.223

谷歌搜索似乎表明 mspdbsrv.exe 僵尸是 VS2005 中的一个已知问题。我们遇到过类似的（间歇性）问题，但似乎没有解决方案。

是的，这很糟糕。

# java - 将静态分析工具相互集成？

> ID：79918
> 
> 赞同：1
> 
> 时间：2008-09-17T04:17:18.117
> 
> 标签：java, code-analysis, static-analysis

人们如何集成各种静态分析工具，例如 PMD、Checkstyle 和 FindBugs，以便以某种统一的方式一起使用它们？特别是，我对生成一个包含来自所有工具的警告的统一报告很感兴趣。此外，我希望能够用看起来相当一致的警告抑制来标记我的代码。

我在这里的问题并不是要解决工具“重叠”，比如 PMD 和 Checkstyle 正在寻找相同的东西。那是另一个问题。

请在对[相关问题](https://stackoverflow.com/questions/4080/what-code-analysis-tools-do-you-use-for-your-java-projects)[的回答中查看我对此事的一些想法](https://stackoverflow.com/questions/4080/what-code-analysis-tools-do-you-use-for-your-java-projects#79845)。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-15T00:47:17.760

我今天偶然发现了[JcReport](http://www.jcoderz.org/fawkez/wiki/JcReport)，我认为它完全符合您的要求。至少，它以组合方式处理报告；抑制仍然是特定于工具的。该工具声称支持将 PMD、CPD、FindBugs、CheckStyle 和 Cobertura 的输出自动集成到单个 HTML 报告中。

我还没有尝试过，但肯定打算很快。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-16T10:49:43.130

另一种选择是收集。[http://jbrugge.com/glean/](http://jbrugge.com/glean/)

来自他们的网站：Glean 是一个 Ant 脚本框架，用于生成对团队源代码的反馈。Glean 的目标是尽可能减少痛苦地为您的构建周期添加反馈。这些脚本驱动许多开源工具并收集生成的 HTML 供您部署到项目网站或其他一些常见的团队区域。在每日构建周期结束时添加它，这是一种在一个地方保持大量反馈源最新的快速方法。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-17T04:21:49.587

我不清楚在你的书中什么是单一的统一报告，但这就是我所做的。

我使用 Maven2 进行构建，您可以使用它配置一系列报告插件（包括 PMD、CPD、checkstyle、coberturba 等）。Maven 还将为您的项目自动生成一个网站（站点插件），其中包含所有报告，采用易于浏览的网页格式。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-17T14:50:15.270

感谢您的回复！

这里的目标是配置这些工具，使它们以某种相似的方式相互关联。这不仅仅是简单地转储他们自动生成的任何报告，或者使用他们开箱即用的任何警告抑制提示。

例如，我将 PMD、Checkstyle 和 FindBugs 配置为以以下格式报告所有警告：

```
/absolute-path/filename:line-number:column-number: warning(tool-name): message
```

所以警告可能如下所示：

```
/project/src/com/example/Foo.java:425:9: warning(Checkstyle): Missing a Javadoc comment.
```

此外，我的源代码中的所有警告抑制都标有包含字符串“ `SuppressWarnings`”的符号，而不管静态分析工具是否被抑制。有时这个符号是一个注释，有时它在注释中，但它总是有那个名字。

[我在这里](https://stackoverflow.com/questions/4080/what-code-analysis-tools-do-you-use-for-your-java-projects#79845)更详细地解释了这些想法。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-17T04:23:22.110

如果您使用 Maven 构建项目，并且您将这些工具“插入”到您的 Maven 构建中，那么为构建生成的 Maven 报告将包括这些静态分析工具的输出。

# memory-management - 堆栈和堆是什么以及在哪里？

> ID：79923
> 
> 赞同：8899
> 
> 时间：2008-09-17T04:18:06.337
> 
> 标签：memory-management, stack, language-agnostic, dynamic-memory-allocation, heap-memory

编程语言书籍解释了值类型是在**堆栈**上创建的，而引用类型是在**堆上**创建的，但没有解释这两个东西是什么。我还没有阅读对此的明确解释。我明白什么*是堆栈*。但，

*   它们在哪里，是什么（物理上在真实计算机的内存中）？
*   它们在多大程度上受操作系统或语言运行时的控制？
*   他们的范围是什么？
*   是什么决定了它们每个的大小？
*   是什么让一个更快？

* * *

## 回答 #1

> 赞同：6510
> 
> 时间：2008-09-17T04:52:19.437

堆栈是为执行线程预留的内存空间。调用函数时，堆栈顶部会保留一个块用于局部变量和一些簿记数据。当该函数返回时，该块将变为未使用，并且可以在下次调用函数时使用。堆栈始终以 LIFO（后进先出）顺序保留；最近保留的块总是下一个要释放的块。这使得跟踪堆栈变得非常简单；从堆栈中释放一个块只不过是调整一个指针。

堆是为动态分配预留的内存。与堆栈不同，堆中块的分配和释放没有强制模式；您可以随时分配块并随时释放它。这使得在任何给定时间跟踪堆的哪些部分已分配或空闲变得更加复杂。有许多自定义堆分配器可用于针对不同的使用模式调整堆性能。

每个线程都有一个堆栈，而应用程序通常只有一个堆（尽管有多个堆用于不同类型的分配并不少见）。

直接回答您的问题：

> *它们在多大程度上受操作系统或语言运行时的控制？*

操作系统在创建线程时为每个系统级线程分配堆栈。通常，语言运行时调用操作系统来为应用程序分配堆。

> *他们的范围是什么？*

堆栈附加到线程，因此当线程退出时，堆栈被回收。堆通常由运行时在应用程序启动时分配，并在应用程序（技术进程）退出时回收。

> *是什么决定了它们每个的大小？*

堆栈的大小在创建线程时设置。堆的大小在应用程序启动时设置，但可以随着空间的需要而增长（分配器从操作系统请求更多内存）。

> *是什么让一个更快？*

堆栈更快，因为访问模式使得从中分配和释放内存变得微不足道（指针/整数只是增加或减少），而堆在分配或释放中涉及更复杂的簿记。此外，堆栈中的每个字节往往被非常频繁地重用，这意味着它往往被映射到处理器的缓存，从而使其非常快。堆的另一个性能损失是堆，主要是全局资源，通常必须是多线程安全的，即每个分配和释放需要 - 通常 - 与程序中的“所有”其他堆访问同步。

清晰的演示： ![](https://i.stack.imgur.com/i6k0Z.png)
[图片来源：[vikashazrati.wordpress.com](http://vikashazrati.wordpress.com/2007/10/01/quicktip-java-basics-stack-and-heap/)]

* * *

## 回答 #2

> 赞同：2557
> 
> 时间：2008-09-17T04:20:06.487

**堆：**

*   像堆一样存储在计算机 RAM 中。
*   在堆栈上创建的变量将超出范围并自动释放。
*   与堆上的变量相比，分配速度要快得多。
*   使用实际的堆栈数据结构实现。
*   存储本地数据，返回地址，用于参数传递。
*   当使用太多堆栈时（主要来自无限或太深的递归，非常大的分配），可能会发生堆栈溢出。
*   在堆栈上创建的数据可以在没有指针的情况下使用。
*   如果您确切知道在编译时间之前需要分配多少数据并且它不是太大，您将使用堆栈。
*   通常在程序启动时已经确定了最大大小。

**堆：**

*   就像堆栈一样存储在计算机 RAM 中。
*   在 C++ 中，堆上的变量必须手动销毁，并且永远不会超出范围。`delete`使用、`delete[]`或释放数据`free`。
*   与堆栈上的变量相比，分配速度较慢。
*   按需使用以分配数据块供程序使用。
*   当有很多分配和释放时，可能会产生碎片。
*   在 C++ 或 C 中，在堆上创建的数据将由指针指向，并分别用`new`or分配`malloc`。
*   如果请求分配的缓冲区太大，可能会出现分配失败。
*   如果您不确切知道在运行时需要多少数据，或者如果您需要分配大量数据，您将使用堆。
*   负责内存泄漏。

**例子：**

```
int foo()
{
  char *pBuffer; //<--nothing allocated yet (excluding the pointer itself, which is allocated here on the stack).
  bool b = true; // Allocated on the stack.
  if(b)
  {
    //Create 500 bytes on the stack
    char buffer[500];

    //Create 500 bytes on the heap
    pBuffer = new char[500];

   }//<-- buffer is deallocated here, pBuffer is not
}//<--- oops there's a memory leak, I should have called delete[] pBuffer; 
```

* * *

## 回答 #3

> 赞同：1451
> 
> 时间：2009-03-19T14:38:04.627

最重要的一点是，堆和栈是内存分配方式的通用术语。它们可以以许多不同的方式实现，并且这些术语适用于基本概念。

*   在一堆物品中，物品按照它们放置在那里的顺序一个放在另一个上面，您只能移除最上面的一个（不会将整个东西翻倒）。

    ![像一堆文件一样堆叠](https://i.stack.imgur.com/ZLzMV.jpg)

    堆栈的简单性在于您不需要维护一个包含每个已分配内存部分的记录的表；您需要的唯一状态信息是指向堆栈末尾的单个指针。要分配和取消分配，您只需增加和减少单个指针。注意：有时可以实现堆栈以从一段内存的顶部开始并向下扩展而不是向上增长。

*   在堆中，物品的放置方式没有特定的顺序。您可以按任何顺序进入和移除项目，因为没有明确的“顶部”项目。

    ![像一堆甘草一样堆](https://i.stack.imgur.com/kINqo.jpg)

    堆分配需要维护已分配和未分配内存的完整记录，以及一些开销维护以减少碎片，找到足够大以适应请求大小的连续内存段，等等。内存可以随时释放，留下可用空间。有时，内存分配器将执行维护任务，例如通过移动分配的内存或垃圾收集来对内存进行碎片整理 - 在运行时识别内存不再在范围内并释放它。

这些图像应该很好地描述了在堆栈和堆中分配和释放内存的两种方式。嗯！

*   它们在多大程度上受操作系统或语言运行时的控制？

    如前所述，堆和堆栈是通用术语，可以通过多种方式实现。计算机程序通常有一个称为[调用堆栈](http://en.wikipedia.org/wiki/Call_stack)的堆栈，它存储与当前函数相关的信息，例如指向它被调用的任何函数的指针，以及任何局部变量。因为函数调用其他函数然后返回，所以堆栈会增长和缩小以保存来自调用堆栈更下方的函数的信息。程序实际上并没有对其进行运行时控制。它由编程语言、操作系统甚至系统架构决定。

    堆是用于任何动态随机分配的内存的通用术语；即乱序。内存通常由操作系统分配，应用程序调用 API 函数来执行此分配。管理动态分配的内存需要相当多的开销，这通常由所使用的编程语言或环境的运行时代码处理。

*   他们的范围是什么？

    调用堆栈是一个如此低级的概念，它与编程意义上的“范围”无关。如果您反汇编一些代码，您将看到对堆栈部分的相对指针样式引用，但就更高级别的语言而言，该语言强加了自己的范围规则。然而，堆栈的一个重要方面是，一旦函数返回，该函数本地的任何内容都会立即从堆栈中释放。考虑到您的编程语言的工作方式，这将按照您期望的方式工作。在堆中，也很难定义。范围是操作系统公开的任何内容，但是您的编程语言可能会添加有关应用程序中“范围”是什么的规则。处理器架构和操作系统使用虚拟寻址，处理器将其转换为物理地址，并且存在页面错误等。它们跟踪哪些页面属于哪些应用程序。不过，您永远不需要担心这一点，因为您只需使用您的编程语言用来分配和释放内存的任何方法，并检查错误（如果分配/释放因任何原因失败）。

*   是什么决定了它们每个的大小？

    同样，它取决于语言、编译器、操作系统和架构。堆栈通常是预先分配的，因为根据定义它必须是连续的内存。语言编译器或操作系统决定了它的大小。您不会在堆栈上存储大量数据，因此它将足够大以至于永远不会完全使用它，除非在不需要的无限递归（因此，“堆栈溢出”）或其他不寻常的编程决策的情况下。

    堆是可以动态分配的任何东西的总称。根据你看待它的方式，它的大小会不断变化。在现代处理器和操作系统中，它的确切工作方式无论如何都是非常抽象的，所以你通常不需要太担心它是如何工作的，除了（在它允许你的语言中）你不能使用内存您尚未分配或已释放的内存。

*   是什么让一个更快？

    堆栈更快，因为所有空闲内存始终是连续的。不需要维护所有空闲内存段的列表，只需一个指向当前堆栈顶部的指针。为此，编译器通常将此指针存储在一个特殊的快速[寄存器](http://en.wikipedia.org/wiki/Stack_register)中。更重要的是，堆栈上的后续操作通常集中在非常靠近的内存区域中，这在非常低的级别有利于处理器片上缓存的优化。

* * *

## 回答 #4

> 赞同：784
> 
> 时间：2009-07-31T15:54:58.987

（我已将这个答案从另一个或多或少是这个问题的欺骗的问题中移出。）

您的问题的答案是特定于实现的，并且可能因编译器和处理器架构而异。但是，这里有一个简化的解释。

*   堆栈和堆都是从底层操作系统分配的内存区域（通常是按需映射到物理内存的虚拟内存）。
*   在多线程环境中，每个线程都有自己完全独立的堆栈，但它们将共享堆。并发访问必须在堆上进行控制，而在堆栈上是不可能的。

## 堆

*   堆包含已用块和空闲块的链表。通过从空闲块之一创建合适的块来满足堆上的新分配（通过`new`或）。`malloc`这需要更新堆上的块列表。有关堆上块的*元信息*也存储在堆上，通常位于每个块前面的一小块区域中。
*   随着堆的增长，新块通常从低地址分配到高地址。因此，您可以将堆视为内存块的*堆*，随着内存的分配，其大小会增加。如果堆对于分配来说太小，通常可以通过从底层操作系统获取更多内存来增加大小。
*   分配和释放许多小块可能会使堆处于这样一种状态，即在已使用的块之间散布着许多小的空闲块。分配大块的请求可能会失败，因为没有一个空闲块大到足以满足分配请求，即使空闲块的组合大小可能足够大。这称为*堆碎片*。
*   当与空闲块相邻的已用块被释放时，新的空闲块可以与相邻的空闲块合并以创建更大的空闲块，从而有效地减少堆的碎片。

![堆](https://i.stack.imgur.com/0Obi0.png)

## 堆栈

*   *堆栈通常与 CPU 上名为堆栈指针*的特殊寄存器密切配合工作。最初，堆栈指针指向堆栈的顶部（堆栈上的最高地址）。
*   CPU 有特殊的指令，用于*将*值压入堆栈并将它们从堆栈中*弹出。*每次*推送*都将值存储在堆栈指针的当前位置并减少堆栈指针。*pop*检索堆栈指针指向的值，然后增加堆栈指针（不要被以下事实混淆：向堆栈*添加*值会*减少*堆栈指针，而*删除*值*会增加*堆栈指针。记住堆栈增长到底端）。存储和检索的值是 CPU 寄存器的值。
*   如果函数有参数，则在调用该函数之前将这些参数压入堆栈。然后，函数中的代码能够从当前堆栈指针向上导航堆栈以定位这些值。
*   当调用函数时，CPU 使用特殊指令将当前*指令指针*压入堆栈，即堆栈上执行的代码的地址。CPU 然后通过将指令指针设置为被调用函数的地址来跳转到该函数。稍后，当函数返回时，旧指令指针从堆栈中弹出，并在调用函数后的代码处继续执行。
*   进入函数时，堆栈指针会减小，以便在堆栈上为本地（自动）变量分配更多空间。如果函数有一个本地 32 位变量，则在堆栈上留出四个字节。当函数返回时，堆栈指针被移回以释放分配的区域。
*   嵌套函数调用就像一个魅力。每次新调用都会分配函数参数、局部变量的返回地址和空间，这些*激活记录*可以为嵌套调用堆叠，并在函数返回时以正确的方式展开。
*   由于堆栈是有限的内存块，调用太多嵌套函数和/或为局部变量分配太多空间可能会导致*堆栈溢出。*通常，用于堆栈的内存区域的设置方式是，在堆栈底部（最低地址）下方写入将触发 CPU 中的陷阱或异常。这种异常情况可以被运行时捕获并转换为某种堆栈溢出异常。

![堆栈](https://i.stack.imgur.com/9UshP.png)

> 可以在堆而不是堆栈上分配函数吗？

不，函数（即本地或自动变量）的激活记录分配在堆栈上，该堆栈不仅用于存储这些变量，还用于跟踪嵌套函数调用。

如何管理堆实际上取决于运行时环境。C 使用`malloc`和 C++ 使用`new`，但许多其他语言都有垃圾收集。

但是，堆栈是与处理器架构密切相关的更底层的功能。当没有足够的空间时增加堆并不太难，因为它可以在处理堆的库调用中实现。然而，增加堆栈通常是不可能的，因为堆栈溢出只有在为时已晚时才被发现；关闭执行线程是唯一可行的选择。

* * *

## 回答 #5

> 赞同：431
> 
> 时间：2012-11-09T12:28:34.980

在以下 C# 代码中

```
public void Method1()
{
    int i = 4;
    int y = 2;
    class1 cls1 = new class1();
} 
```

这是内存的管理方式

![堆栈上的变量图片](https://i.stack.imgur.com/NS0k7.jpg)

`Local Variables`只要函数调用进入堆栈，它就需要持续。堆用于存放我们事先并不真正知道其生命周期但我们希望它们能持续一段时间的变量。在大多数语言中，如果我们想将变量存储在堆栈中，我们必须在编译时知道变量有多大。

对象（随着我们更新它们的大小会有所不同）在堆上，因为我们在创建时不知道它们会持续多久。在许多语言中，堆被垃圾收集以查找不再有任何引用的对象（例如 cls1 对象）。

在 Java 中，大多数对象直接进入堆。在 C / C++ 等语言中，当您不处理指针时，结构和类通常会保留在堆栈上。

更多信息可以在这里找到：

[堆栈和堆内存分配的区别 « timmurphy.org](http://timmurphy.org/2010/08/11/the-difference-between-stack-and-heap-memory-allocation/)

和这里：

[在堆栈和堆上创建对象](https://root.cern.ch/root/htmldoc/guides/users-guide/ALittleC++.html#creating-objects-on-the-stack-and-heap)

本文为上图来源：[6个重要的.NET概念：栈、堆、值类型、引用类型、装箱、拆箱 - CodeProject](http://www.codeproject.com/Articles/76153/Six-important-NET-concepts-Stack-heap-value-types#Stack%20and%20Heap)

但请注意，它可能包含一些不准确之处。

* * *

## 回答 #6

> 赞同：222
> 
> 时间：2008-09-17T04:27:45.110

**堆栈** 当您调用一个函数时，该函数的参数加上一些其他开销都放在堆栈上。一些信息（例如去哪里返回）也存储在那里。当您在函数中声明一个变量时，该变量也会在堆栈上分配。

释放堆栈非常简单，因为您总是以与分配相反的顺序释放。当您输入函数时会添加堆栈内容，退出函数时会删除相应的数据。这意味着您倾向于停留在堆栈的一个小区域内，除非您调用许多调用许多其他函数的函数（或创建递归解决方案）。

**堆堆** 是放置动态创建的数据的通用名称。如果您不知道您的程序将创建多少艘飞船，您可能会使用 new（或 malloc 或等效的）运算符来创建每艘飞船。这种分配会持续一段时间，所以我们很可能会以不同于我们创建它们的顺序释放它们。

因此，堆要复杂得多，因为最终会出现未使用的内存区域与块交错 - 内存变得碎片化。找到所需大小的空闲内存是一个难题。这就是为什么应该避免使用堆的原因（尽管它仍然经常使用）。

**堆栈和堆的实现** 通常取决于运行时/操作系统。通常，对性能至关重要的游戏和其他应用程序会创建自己的内存解决方案，这些解决方案会从堆中获取大量内存，然后在内部将其分发出去，以避免依赖操作系统来获取内存。

这仅在您的内存使用与标准完全不同的情况下才实用 - 即对于您在一个巨大的操作中加载一个关卡并且可以在另一个巨大的操作中丢弃全部内容的游戏。

**内存中的物理位置** 这并不像您想象的那么重要，因为一种称为[虚拟内存](http://en.wikipedia.org/wiki/Virtual_memory)的技术使您的程序认为您可以访问物理数据在其他地方（甚至在硬盘上！）的某个地址。随着调用树的深入，您获得的堆栈地址将按递增顺序排列。堆的地址是不可预测的（即特定于实现的）并且坦率地说并不重要。

* * *

## 回答 #7

> 赞同：215
> 
> 时间：2012-11-10T23:03:13.893

其他答案只是避免解释静态分配的含义。因此，我将在下面解释三种主要的分配形式以及它们通常与堆、堆栈和数据段的关系。我还将展示一些 C/C++ 和 Python 中的示例，以帮助人们理解。

“静态”（AKA 静态分配）变量不在堆栈上分配。不要这么假设——很多人这样做只是因为“静态”听起来很像“堆栈”。它们实际上既不存在于堆栈中，也不存在于堆中。它们是所谓的[数据段](http://en.wikipedia.org/wiki/Data_segment)的一部分。

但是，通常最好考虑“**范围**”和“**生命周期**”而不是“堆栈”和“堆”。

范围是指代码的哪些部分可以访问变量。通常我们会考虑**局部作用域**（只能由当前函数访问）与**全局作用域**（可以在任何地方访问），尽管作用域会变得更加复杂。

生命周期是指在程序执行期间分配和释放变量的时间。通常我们会想到**静态分配**（变量将在程序的整个持续时间内持续存在，这对于在多个函数调用中存储相同的信息很有用）与**自动分配**（变量仅在对函数的单个调用期间持续存在，使其有用存储仅在函数期间使用并且一旦完成就可以丢弃的信息）与**动态分配**（其持续时间在运行时定义的变量，而不是像静态或自动的编译时间）。

尽管大多数编译器和解释器在使用堆栈、堆等方面类似地实现此行为，但只要行为正确，编译器有时可能会破坏这些约定。例如，由于优化，局部变量可能只存在于寄存器中或被完全删除，即使大多数局部变量存在于堆栈中。正如一些评论中所指出的，您可以自由地实现一个编译器，它甚至不使用堆栈或堆，而是使用其他一些存储机制（很少这样做，因为堆栈和堆非常适合此）。

我将提供一些简单的带注释的 C 代码来说明所有这些。最好的学习方法是在调试器下运行程序并观察其行为。如果您更喜欢阅读python，请跳到答案的末尾:)

```
// Statically allocated in the data segment when the program/DLL is first loaded
// Deallocated when the program/DLL exits
// scope - can be accessed from anywhere in the code
int someGlobalVariable;

// Statically allocated in the data segment when the program is first loaded
// Deallocated when the program/DLL exits
// scope - can be accessed from anywhere in this particular code file
static int someStaticVariable;

// "someArgument" is allocated on the stack each time MyFunction is called
// "someArgument" is deallocated when MyFunction returns
// scope - can be accessed only within MyFunction()
void MyFunction(int someArgument) {

    // Statically allocated in the data segment when the program is first loaded
    // Deallocated when the program/DLL exits
    // scope - can be accessed only within MyFunction()
    static int someLocalStaticVariable;

    // Allocated on the stack each time MyFunction is called
    // Deallocated when MyFunction returns
    // scope - can be accessed only within MyFunction()
    int someLocalVariable;

    // A *pointer* is allocated on the stack each time MyFunction is called
    // This pointer is deallocated when MyFunction returns
    // scope - the pointer can be accessed only within MyFunction()
    int* someDynamicVariable;

    // This line causes space for an integer to be allocated in the heap
    // when this line is executed. Note this is not at the beginning of
    // the call to MyFunction(), like the automatic variables
    // scope - only code within MyFunction() can access this space
    // *through this particular variable*.
    // However, if you pass the address somewhere else, that code
    // can access it too
    someDynamicVariable = new int;

    // This line deallocates the space for the integer in the heap.
    // If we did not write it, the memory would be "leaked".
    // Note a fundamental difference between the stack and heap
    // the heap must be managed. The stack is managed for us.
    delete someDynamicVariable;

    // In other cases, instead of deallocating this heap space you
    // might store the address somewhere more permanent to use later.
    // Some languages even take care of deallocation for you... but
    // always it needs to be taken care of at runtime by some mechanism.

    // When the function returns, someArgument, someLocalVariable
    // and the pointer someDynamicVariable are deallocated.
    // The space pointed to by someDynamicVariable was already
    // deallocated prior to returning.
    return;
}

// Note that someGlobalVariable, someStaticVariable and
// someLocalStaticVariable continue to exist, and are not
// deallocated until the program exits. 
```

为什么区分生命周期和范围很重要的一个特别尖锐的例子是变量可以具有局部范围但静态生命周期 - 例如，上面代码示例中的“someLocalStaticVariable”。这样的变量会使我们常见但非正式的命名习惯变得非常混乱。例如，当我们说“*本地*”时，我们通常表示“*本地范围的自动分配变量*”，而当我们说全局时，我们通常表示“*全局范围的静态分配变量*”。不幸的是，当谈到“*文件范围内的静态分配变量*”之类的事情时，很多人只会说......“*嗯？？？* ”。

C/C++ 中的一些语法选择加剧了这个问题——例如，许多人认为全局变量不是“静态的”，因为下面显示的语法。

```
int var1; // Has global scope and static allocation
static int var2; // Has file scope and static allocation

int main() {return 0;} 
```

请注意，在上面的声明中放置关键字“static”会阻止 var2 具有全局范围。然而，全局 var1 具有静态分配。这不直观！出于这个原因，我在描述范围时尽量不要使用“静态”这个词，而是说“文件”或“文件受限”范围之类的东西。然而，许多人使用短语“静态”或“静态范围”来描述只能从一个代码文件访问的变量。在生命周期的上下文中，“静态”*始终*意味着变量在程序启动时分配并在程序退出时释放。

有些人认为这些概念是特定于 C/C++ 的。他们不是。例如，下面的 Python 示例说明了所有三种类型的分配（在解释语言中可能存在一些细微的差异，我不会在这里讨论）。

```
from datetime import datetime

class Animal:
    _FavoriteFood = 'Undefined' # _FavoriteFood is statically allocated

    def PetAnimal(self):
        curTime = datetime.time(datetime.now()) # curTime is automatically allocatedion
        print("Thank you for petting me. But it's " + str(curTime) + ", you should feed me. My favorite food is " + self._FavoriteFood)

class Cat(Animal):
    _FavoriteFood = 'tuna' # Note since we override, Cat class has its own statically allocated _FavoriteFood variable, different from Animal's

class Dog(Animal):
    _FavoriteFood = 'steak' # Likewise, the Dog class gets its own static variable. Important to note - this one static variable is shared among all instances of Dog, hence it is not dynamic!

if __name__ == "__main__":
    whiskers = Cat() # Dynamically allocated
    fido = Dog() # Dynamically allocated
    rinTinTin = Dog() # Dynamically allocated

    whiskers.PetAnimal()
    fido.PetAnimal()
    rinTinTin.PetAnimal()

    Dog._FavoriteFood = 'milkbones'
    whiskers.PetAnimal()
    fido.PetAnimal()
    rinTinTin.PetAnimal()

# Output is:
# Thank you for petting me. But it's 13:05:02.255000, you should feed me. My favorite food is tuna
# Thank you for petting me. But it's 13:05:02.255000, you should feed me. My favorite food is steak
# Thank you for petting me. But it's 13:05:02.255000, you should feed me. My favorite food is steak
# Thank you for petting me. But it's 13:05:02.255000, you should feed me. My favorite food is tuna
# Thank you for petting me. But it's 13:05:02.255000, you should feed me. My favorite food is milkbones
# Thank you for petting me. But it's 13:05:02.256000, you should feed me. My favorite food is milkbones 
```

* * *

## 回答 #8

> 赞同：175
> 
> 时间：2008-09-17T04:48:43.063

其他人已经很好地回答了粗略的笔画，所以我将提供一些细节。

1.  堆栈和堆不必是单数。拥有多个堆栈的常见情况是进程中有多个线程。在这种情况下，每个线程都有自己的堆栈。您还可以拥有多个堆，例如，某些 DLL 配置可能会导致从不同堆分配不同的 DLL，这就是为什么释放由不同库分配的内存通常不是一个好主意的原因。

2.  [在 C 中，您可以通过使用在堆栈上分配的alloca](https://www.freebsd.org/cgi/man.cgi?alloca)来获得可变长度分配的好处，而不是在堆上分配的 alloc。此内存不会在您的 return 语句中保留下来，但它对于暂存缓冲区很有用。

3.  在 Windows 上创建一个您不经常使用的巨大临时缓冲区并不是免费的。这是因为编译器会生成一个堆栈探测循环，每次输入函数时都会调用该循环以确保堆栈存在（因为 Windows 在堆栈末尾使用单个保护页来检测何时需要增加堆栈。如果您访问的内存超过堆栈末尾的一页，您将崩溃）。例子：

```
void myfunction()
{
   char big[10000000];
   // Do something that only uses for first 1K of big 99% of the time.
} 
```

* * *

## 回答 #9

> 赞同：143
> 
> 时间：2008-09-17T07:16:07.983

其他人已经直接回答了您的问题，但是在尝试理解堆栈和堆时，我认为考虑传统 UNIX 进程的内存布局（没有线程和`mmap()`基于 - 的分配器）是有帮助的。[内存管理词汇表](http://www.memorymanagement.org/glossary/b.html#term-brk)网页有一个内存布局图。

堆栈和堆传统上位于进程的虚拟地址空间的两端。堆栈在访问时会自动增长，达到内核设置的大小（可以使用 调整`setrlimit(RLIMIT_STACK, ...)`）。当内存分配器调用`brk()`or`sbrk()`系统调用时，堆会增长，将更多的物理内存页面映射到进程的虚拟地址空间。

在没有虚拟内存的系统中，例如一些嵌入式系统，通常采用相同的基本布局，只是堆栈和堆的大小是固定的。但是，在其他嵌入式系统中（例如基于 Microchip PIC 单片机的系统），程序堆栈是一个单独的内存块，无法通过数据移动指令寻址，只能通过程序流指令（调用、返回等）。其他架构（例如 Intel Itanium 处理器）具有[多个堆栈](http://blogs.msdn.com/oldnewthing/archive/2005/04/21/410397.aspx)。从这个意义上说，堆栈是 CPU 架构的一个元素。

* * *

## 回答 #10

> 赞同：124
> 
> 时间：2014-06-11T19:42:07.593

**什么是堆栈？**

堆栈是一堆对象，通常是整齐排列的对象。

[![在此处输入图像描述](https://i.stack.imgur.com/GTa97.jpg)](https://i.stack.imgur.com/GTa97.jpg)

> > 计算架构中的堆栈是以后进先出的方式添加或删除数据的内存区域。
> > 在多线程应用程序中，每个线程都有自己的堆栈。

**什么是堆？**

堆是杂乱无章的东西堆积起来的不规则集合。

[![在此处输入图像描述](https://i.stack.imgur.com/rz43z.jpg)](https://i.stack.imgur.com/rz43z.jpg)

> > 在计算架构中，堆是动态分配的内存区域，由操作系统或内存管理器库自动管理。
> > 在程序执行期间，堆上的内存会被定期分配、释放和调整大小，这可能会导致称为碎片的问题。
> > 当分配的内存对象之间的小空间太小而无法容纳额外的内存对象时，就会发生碎片。
> > 最终结果是不能用于进一步内存分配的堆空间百分比。

**两者一起**

> > 在多线程应用程序中，每个线程都有自己的堆栈。但是，所有不同的线程将共享堆。
> > 因为在多线程应用程序中不同的线程共享堆，这也意味着线程之间必须有一些协调，以便它们不会尝试访问和操作堆中的相同内存块同时。

**哪个更快——堆栈还是堆？为什么？**

> > 堆栈比堆快得多。
> > 这是因为在堆栈上分配内存的方式。
> > 在堆栈上分配内存就像向上移动堆栈指针一样简单。

对于刚接触编程的人来说，使用堆栈可能是一个好主意，因为它更容易。
因为堆栈很小，所以当您确切知道数据需要多少内存时，或者如果您知道数据的大小非常小，您会想要使用它。
当您知道需要大量内存来存储数据时，最好使用堆，或者您只是不确定需要多少内存（例如使用动态数组）。

### Java 内存模型

[![在此处输入图像描述](https://i.stack.imgur.com/yZK6t.png)](https://i.stack.imgur.com/yZK6t.png)

堆栈是存储局部变量（包括方法参数）的内存区域。当涉及到对象变量时，这些仅仅是堆上实际对象的引用（指针）。
每次实例化一个对象时，都会留出一块堆内存来保存该对象的数据（状态）。由于对象可以包含其他对象，因此其中一些数据实际上可以保存对这些嵌套对象的引用。

* * *

## 回答 #11

> 赞同：123
> 
> 时间：2008-09-17T04:29:20.257

堆栈是内存的一部分，可以通过几个关键的汇编语言指令进行操作，例如“pop”（从堆栈中删除并返回一个值）和“push”（将一个值推送到堆栈），但也可以调用 (调用子程序 - 这会将地址推送到堆栈中）并返回（从子程序返回 - 这会将地址从堆栈中弹出并跳转到它）。它是堆栈指针寄存器下方的内存区域，可以根据需要进行设置。堆栈还用于将参数传递给子程序，也用于在调用子程序之前保存寄存器中的值。

堆是由操作系统提供给应用程序的内存的一部分，通常通过诸如 malloc 之类的系统调用。在现代操作系统上，这个内存是一组只有调用进程才能访问的页面。

堆栈的大小是在运行时确定的，一般在程序启动后不会增长。在 C 程序中，堆栈需要足够大以容纳每个函数中声明的每个变量。堆将根据需要动态增长，但操作系统最终会发出调用（它通常会使堆增长超过 malloc 请求的值，因此至少一些未来的 malloc 不需要回到内核来获得更多内存。这种行为通常是可定制的）

因为您在启动程序之前已经分配了堆栈，所以在使用堆栈之前您永远不需要 malloc，所以这是一个轻微的优势。在实践中，很难预测在具有虚拟内存子系统的现代操作系统中什么会快什么会慢，因为页面是如何实现的以及它们存储在哪里是一个实现细节。

* * *

## 回答 #12

> 赞同：119
> 
> 时间：2008-09-17T04:57:51.887

我想很多其他人在这个问题上给了你大部分正确的答案。

然而，一个被遗漏的细节是“堆”实际上应该被称为“自由存储”。这种区别的原因是最初的自由存储是用一种称为“二项式堆”的数据结构实现的。出于这个原因，从 malloc()/free() 的早期实现中分配是从堆中分配的。然而，在现代，大多数免费商店都是用非常复杂的数据结构实现的，这些数据结构不是二项式堆。

* * *

## 回答 #13

> 赞同：95
> 
> 时间：2009-03-19T15:55:06.803

你可以用堆栈做一些有趣的事情。例如，你有像[alloca](http://everything2.com/title/alloca%2528%2529)这样的函数（假设你可以通过关于它的使用的大量警告），这是一种 malloc 形式，专门使用堆栈而不是堆来存储内存。

也就是说，基于堆栈的内存错误是我经历过的最糟糕的一些错误。如果您使用堆内存，并且超出了分配块的范围，那么您很有可能触发段错误。（不是 100%：您的块可能偶然与您之前分配的另一个块相邻。）但是由于在堆栈上创建的变量始终彼此相邻，因此越界写入可能会更改另一个变量的值。我了解到，每当我觉得我的程序不再遵守逻辑规律时，很可能是缓冲区溢出。

* * *

## 回答 #14

> 赞同：93
> 
> 时间：2009-03-19T15:13:42.123

简单地说，堆栈是创建局部变量的地方。此外，每次调用子程序时，程序计数器（指向下一条机器指令的指针）和任何重要的寄存器，有时参数都会被压入堆栈。然后子例程内的任何局部变量都被压入堆栈（并从那里使用）。当子例程完成时，所有东西都会从堆栈中弹出。PC 和寄存器数据在弹出时得到并放回原处，因此您的程序可以继续进行。

堆是内存动态内存分配的区域（显式“新”或“分配”调用）。它是一种特殊的数据结构，可以跟踪不同大小的内存块及其分配状态。

在“经典”系统中，RAM 的布局使得堆栈指针从内存底部开始，堆指针从顶部开始，它们彼此相向增长。如果它们重叠，则说明您的 RAM 不足。但是，这不适用于现代多线程操作系统。每个线程都必须有自己的堆栈，并且这些堆栈可以动态创建。

* * *

## 回答 #15

> 赞同：86
> 
> 时间：2009-04-02T01:25:29.557

来自 WikiAnwser。

### 堆

当一个函数或方法调用另一个函数，而另一个函数又调用另一个函数等时，所有这些函数的执行将保持挂起，直到最后一个函数返回其值。

这个挂起的函数调用链就是堆栈，因为堆栈中的元素（函数调用）相互依赖。

堆栈在异常处理和线程执行中很重要。

### 堆

堆只是程序用来存储变量的内存。堆的元素（变量）相互之间没有依赖关系，可以随时随机访问。

* * *

## 回答 #16

> 赞同：58
> 
> 时间：2014-01-30T06:33:51.820

**堆**

*   访问速度非常快
*   不必显式取消分配变量
*   空间由CPU高效管理，内存不会碎片化
*   仅局部变量
*   堆栈大小限制（取决于操作系统）
*   变量无法调整大小

**堆**

*   变量可以全局访问
*   内存大小没有限制
*   （相对）较慢的访问
*   无法保证有效地使用空间，随着内存块的分配和释放，内存可能会随着时间的推移而变得碎片化
*   您必须管理内存（您负责分配和释放变量）
*   可以使用 realloc() 调整变量的大小

* * *

## 回答 #17

> 赞同：54
> 
> 时间：2016-05-02T12:16:40.800

## 简而言之

堆栈用于静态内存分配和堆用于动态内存分配，两者都存储在计算机的 RAM 中。

* * *

## 详细地

**堆栈**

堆栈是一种“LIFO”（后进先出）数据结构，由 CPU 密切管理和优化。每次函数声明一个新变量时，它都会被“推入”堆栈。然后每次函数退出时，该函数压入堆栈的所有变量都被释放（也就是说，它们被删除）。释放堆栈变量后，该内存区域可用于其他堆栈变量。

使用堆栈存储变量的优点是内存是为您管理的。您不必手动分配内存，也不必在不再需要时释放它。更重要的是，由于 CPU 如此高效地组织堆栈内存，读取和写入堆栈变量非常快。

更多可以在**[这里](https://en.wikipedia.org/wiki/Stack_(abstract_data_type))**找到。

* * *

**堆**

堆是计算机内存中的一个区域，它不会自动为您管理，也不是由 CPU 严格管理。它是一个更自由浮动的内存区域（并且更大）。要在堆上分配内存，您必须使用 malloc() 或 calloc()，它们是 C 的内置函数。一旦你在堆上分配了内存，你有责任在你不再需要它时使用 free() 来释放该内存。

如果你不这样做，你的程序就会发生所谓的内存泄漏。也就是说，堆上的内存仍将被留出（并且不会对其他进程可用）。正如我们将在调试部分看到的，有一个名为[Valgrind](http://en.wikipedia.org/wiki/Valgrind)的工具可以帮助您检测内存泄漏。

与堆栈不同，堆对可变大小没有大小限制（除了计算机明显的物理限制）。堆内存的读取和写入速度稍慢，因为必须使用指针来访问堆上的内存。我们将很快讨论指针。

与堆栈不同，在堆上创建的变量可以被程序中任何位置的任何函数访问。堆变量在范围内本质上是全局的。

更多可以在**[这里](https://en.wikipedia.org/wiki/Memory_management)**找到。

* * *

分配在栈上的变量直接存储到内存中，访问这块内存非常快，它的分配是在程序编译的时候处理的。当一个函数或方法调用另一个函数，而另一个函数又调用另一个函数等时，所有这些函数的执行将保持挂起，直到最后一个函数返回其值。堆栈始终以 LIFO 顺序保留，最近保留的块始终是下一个要释放的块。这使得跟踪堆栈变得非常简单，从堆栈中释放一个块只不过是调整一个指针。

在堆上分配的变量在运行时分配它们的内存，访问这块内存有点慢，但堆大小仅受虚拟内存大小的限制。堆的元素彼此之间没有依赖关系，并且总是可以随时随机访问。您可以随时分配块并随时释放它。这使得在任何给定时间跟踪堆的哪些部分已分配或空闲变得更加复杂。

[![在此处输入图像描述](https://i.stack.imgur.com/KdBPf.png)](https://i.stack.imgur.com/KdBPf.png)

如果您确切知道在编译时需要分配多少数据，并且不会太大，则可以使用堆栈。如果您不知道运行时需要多少数据或者需要分配大量数据，则可以使用堆。

在多线程情况下，每个线程都有自己完全独立的堆栈，但它们将共享堆。堆栈是特定于线程的，而堆是特定于应用程序的。堆栈在异常处理和线程执行中很重要。

每个线程都有一个堆栈，而应用程序通常只有一个堆（尽管有多个堆用于不同类型的分配并不少见）。

[![在此处输入图像描述](https://i.stack.imgur.com/J0teH.gif)](https://i.stack.imgur.com/J0teH.gif)

在运行时，如果应用程序需要更多的堆，它可以从空闲内存中分配内存，如果堆栈需要内存，它可以从为应用程序分配的空闲内存中分配内存。

[**甚至，这里**](http://net-informations.com/faq/net/stack-heap.htm)和[**这里**](http://gribblelab.org/CBootcamp/7_Memory_Stack_vs_Heap.html)给出了更多细节。

* * *

现在来**回答你的问题**。

> **它们在多大程度上受操作系统或语言运行时的控制？**

操作系统在创建线程时为每个系统级线程分配堆栈。通常，语言运行时调用操作系统来为应用程序分配堆。

更多可以在**[这里](https://stackoverflow.com/questions/79923/what-and-where-are-the-stack-and-heap/80113#80113)**找到。

> **他们的范围是什么？**

已经在上面给出了。

> “如果您确切知道在编译时需要分配多少数据，并且它不是太大，您可以使用堆栈。如果您不知道运行时需要多少数据或者如果您不知道在运行时需要多少数据，您可以使用堆。你需要分配大量数据。”

更多可以在[这里](https://stackoverflow.com/questions/408670/stack-static-and-heap-in-c)找到。

> **是什么决定了它们每个的大小？**

堆栈的大小由[操作系统](https://en.wikipedia.org/wiki/Operating_system)在创建线程时设置。堆的大小在应用程序启动时设置，但它可以随着空间的需要而增长（分配器从操作系统请求更多内存）。

> **是什么让一个更快？**

堆栈分配要快得多，因为它真正所做的只是移动堆栈指针。使用内存池，您可以从堆分配中获得相当的性能，但这会稍微增加复杂性并带来一些麻烦。

此外，堆栈与堆不仅是性能考虑因素；它还告诉你很多关于对象的预期生命周期的信息。

可以从**[这里](https://stackoverflow.com/questions/161053/which-is-faster-stack-allocation-or-heap-allocation)**找到详细信息。

* * *

## 回答 #18

> 赞同：53
> 
> 时间：2017-07-18T15:04:12.300

**好的，**简而言之，它们的意思是**订购**和**未订购**......！

**堆栈**：在堆栈项目中，事物相互叠加，意味着处理速度更快，效率更高！...

所以总是有一个索引来指向特定的项目，处理也会更快，项目之间也有关系！...

**堆**：没有顺序，处理速度会变慢，值会乱成一团，没有特定的顺序或索引……有随机性，它们之间没有关系……所以执行和使用时间可能会有所不同……

我还创建了下面的图像以显示它们的外观：

[![在此处输入图像描述](https://i.stack.imgur.com/9c2VH.png)](https://i.stack.imgur.com/9c2VH.png)

* * *

## 回答 #19

> 赞同：43
> 
> 时间：2017-09-14T17:32:19.853

**虚拟内存中每个进程的**堆栈**、**堆**和**数据：****

 **[![堆栈、堆和静态数据](https://bayanbox.ir/view/581244719208138556/virtual-memory.jpg)](https://bayanbox.ir/view/581244719208138556/virtual-memory.jpg)

* * *

## 回答 #20

> 赞同：37
> 
> 时间：2015-03-27T19:55:51.967

在 1980 年代，UNIX 像兔子一样传播开来，大公司纷纷推出自己的产品。埃克森美孚拥有一个，数十个品牌名称已被历史遗忘。内存的布局方式由许多实现者自行决定。

一个典型的 C 程序在内存中被平放，并有机会通过更改 brk() 值来增加。通常，HEAP 刚好低于这个 brk 值，增加 brk 会增加可用堆的数量。

单个堆栈通常是 HEAP 下方的区域，它是一段内存，在下一个固定内存块的顶部之前不包含任何价值。下一个块通常是 CODE，它可以被当时著名的黑客攻击中的堆栈数据覆盖。

一个典型的内存块是 BSS（零值块），它在一家制造商的产品中意外地没有归零。另一个是包含初始化值的 DATA，包括字符串和数字。第三种是包含 CRT（C 运行时）、main、函数和库的 CODE。

UNIX 中虚拟内存的出现改变了许多限制。没有客观的理由为什么这些块需要是连续的、大小固定的，或者现在以特定的方式排序。当然，在 UNIX 之前是不受这些限制的 Multics。这是一个示意图，显示了那个时代的一种内存布局。

![典型的 1980 年代风格的 UNIX C 程序内存布局](https://i.stack.imgur.com/eeefv.png)

* * *

## 回答 #21

> 赞同：28
> 
> 时间：2015-12-17T15:08:41.510

几分钱：我认为，绘制内存图形会更好，更简单：

[![这是我对进程内存构建的愿景，通过简化以便更容易理解正在发生的事情](https://i.stack.imgur.com/nlb7A.jpg)](https://i.stack.imgur.com/nlb7A.jpg)

箭头 - 显示增长堆栈和堆的位置，进程堆栈大小有限制，在操作系统中定义，线程堆栈大小限制通常由线程创建 API 中的参数。堆通常受进程最大虚拟内存大小的限制，例如 32 位 2-4 GB。

如此简单的方法：进程堆通常用于进程和内部的所有线程，在常见情况下用于内存分配，例如**malloc()**。

堆栈是用于存储常见情况下函数返回指针和变量的快速存储器，在函数调用中作为参数处理，局部函数变量。

* * *

## 回答 #22

> 赞同：25
> 
> 时间：2015-03-02T01:29:43.773

由于有些答案很挑剔，我将贡献我的一点。

令人惊讶的是，没有人提到不仅在外来语言（PostScript）或平台（Intel Itanium）中，而且在[*纤维*](http://en.wikipedia.org/wiki/Fiber_(computer_science))，[*绿色线程*](http://en.wikipedia.org/wiki/Green_threads)中都可以找到多个（即与运行的操作系统级线程的数量无关）调用堆栈以及[*协程*](http://en.wikipedia.org/wiki/Coroutine)的一些实现。

纤维、绿色线程和协程在很多方面都很相似，这会导致很多混乱。光纤和绿色线程之间的区别在于，前者使用协作多任务，而后者可能具有协作或抢占式（甚至两者兼而有之）。关于纤维和协程之间的区别，请参见[此处](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2014/n4024.pdf)。

在任何情况下，纤程、绿色线程和协程的目的都是在单个操作系统级线程中同时执行多个功能，但**不是**并行执行（请参阅[此 SO 问题](https://stackoverflow.com/questions/1050222/concurrency-vs-parallelism-what-is-the-difference)以了解区别），从而在彼此之间来回传输控制以有组织的方式。

当使用纤程、绿色线程或协程时，*通常*每个函数都有一个单独的堆栈。（从技术上讲，每个函数不仅是堆栈，而且整个执行上下文都是每个函数。最重要的是，CPU 寄存器。）对于每个线程，堆栈的数量与并发运行的函数一样多，并且线程在执行每个函数之间切换根据您的程序的逻辑。当一个函数运行到它的末尾时，它的堆栈被销毁。因此，**堆栈的数量和生命周期**是动态的，**而不是由操作系统级线程的数量决定的！**

请注意，我说“*通常*每个函数都有一个单独的堆栈”。couroutines有*stackful*和*stackless*两种实现。最著名的堆栈式 C++ 实现是[Boost.Coroutine](http://www.boost.org/doc/libs/1_53_0/libs/coroutine/doc/html/index.html)和[Microsoft PPL](https://msdn.microsoft.com/en-us/library/dd492418.aspx)的`async/await`. （但是，在 C++17 中提出的 C ++ 的[可恢复函数](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2014/n4134.pdf)（又名 "`async`和"）很可能使用无堆栈协程。）`await`

Fibers 对 C++ 标准库的提议即将发布。此外，还有一些第三方[库](https://stackoverflow.com/questions/1285714/lightweight-portable-c-fibers-mit-license)。绿色线程在 Python 和 Ruby 等语言中非常流行。

* * *

## 回答 #23

> 赞同：25
> 
> 时间：2017-11-15T18:27:52.453

我有一些东西要分享，虽然要点已经讲过了。

**堆**

*   访问速度非常快。
*   存储在 RAM 中。
*   函数调用与传递的局部变量和函数参数一起加载。
*   当程序超出范围时，空间会自动释放。
*   存储在顺序内存中。

**堆**

*   相对于 Stack 的访问速度较慢。
*   存储在 RAM 中。
*   动态创建的变量存储在这里，稍后需要在使用后释放分配的内存。
*   存储在内存分配完成的任何地方，始终由指针访问。

**有趣的注释：**

*   如果函数调用存储在堆中，则会导致 2 个混乱点：
    1.  由于堆栈中的顺序存储，执行速度更快。堆中存储会导致大量时间消耗，从而使整个程序执行速度变慢。
    2.  如果函数存储在堆中（指针指向的杂乱存储），则无法返回调用者地址（由于内存中的顺序存储，堆栈给出）。

* * *

## 回答 #24

> 赞同：17
> 
> 时间：2019-02-20T02:04:38.187

哇！这么多答案，我不认为其中一个是正确的......

1）它们在哪里，是什么（物理上在真实计算机的内存中）？

堆栈是从分配给程序映像的最高内存地址开始的内存，然后从那里减少值。它保留给被调用的函数参数和函数中使用的所有临时变量。

有两个堆：公共的和私有的。

私有堆在程序中最后一个代码字节之后的 16 字节边界（对于 64 位程序）或 8 字节边界（对于 32 位程序）开始，然后从那里增加值。它也称为默认堆。

如果私有堆太大，它将与堆栈区域重叠，如果堆栈太大，堆栈也会与堆重叠。因为堆栈从较高的地址开始并向下工作到较低的地址，通过适当的黑客攻击，您可以使堆栈变得如此之大，以至于它会超出私有堆区域并与代码区域重叠。诀窍是重叠足够多的代码区域，以便您可以挂钩到代码中。这样做有点棘手，并且您可能会面临程序崩溃的风险，但它很容易且非常有效。

公共堆驻留在程序映像空间之外的自己的内存空间中。如果内存资源变得稀缺，正是这些内存将被吸走到硬盘上。

2）它们在多大程度上受操作系统或语言运行时的控制？

堆栈由程序员控制，私有堆由操作系统管理，公共堆不受任何人控制，因为它是一种操作系统服务——你提出请求，要么被批准，要么被拒绝。

2b) 他们的范围是什么？

它们对程序都是全局的，但它们的内容可以是私有的、公共的或全局的。

2c) 是什么决定了它们的大小？

堆栈和私有堆的大小由编译器运行时选项决定。公共堆在运行时使用大小参数进行初始化。

2d) 是什么让一个更快？

它们不是为了快速而设计的，而是为了有用而设计的。程序员如何利用它们决定了它们是“快”还是“慢”

参考：

[https://norasandler.com/2019/02/18/Write-a-Compiler-10.html](https://norasandler.com/2019/02/18/Write-a-Compiler-10.html)

[https://docs.microsoft.com/en-us/windows/desktop/api/heapapi/nf-heapapi-getprocessheap](https://docs.microsoft.com/en-us/windows/desktop/api/heapapi/nf-heapapi-getprocessheap)

[https://docs.microsoft.com/en-us/windows/desktop/api/heapapi/nf-heapapi-heapcreate](https://docs.microsoft.com/en-us/windows/desktop/api/heapapi/nf-heapapi-heapcreate)

* * *

## 回答 #25

> 赞同：10
> 
> 时间：2017-07-27T22:14:58.197

许多答案作为概念是正确的，但我们必须注意，硬件（即微处理器）需要一个堆栈来允许调用子例程（汇编语言中的 CALL..）。（OOP 家伙会称之为*方法*）

在堆栈上保存返回地址并调用 → push / ret → pop 直接在硬件中进行管理。

您可以使用堆栈来传递参数..即使它比使用寄存器慢（微处理器专家会说还是一本好的 1980 年代 BIOS 书......）

*   没有堆栈，**任何**微处理器都无法工作。（我们无法想象没有子程序/函数的程序，即使是汇编语言）
*   没有堆它可以。（汇编语言程序可以在没有的情况下工作，因为堆是一个操作系统概念，而 malloc 是一个 OS/Lib 调用。

堆栈使用速度更快，因为：

*   是硬件，甚至推/弹出都非常有效。
*   malloc 需要进入内核模式，使用锁/信号量（或其他同步原语）执行一些代码并管理一些跟踪分配所需的结构。

* * *

## 回答 #26

> 赞同：2
> 
> 时间：2020-03-22T03:16:01.807

> 堆栈本质上是一个易于访问的内存，它只是将其项目作为一个 - 好 - 堆栈来管理。只有**事先知道其大小的项目才能进入堆栈**。数字、字符串、布尔值就是这种情况。
> 
> **堆是您无法预先确定确切大小和结构的项目的**内存。由于对象和数组可以在运行时变异和更改，因此它们必须进入堆。

资料来源：[学术](https://academind.com/learn/javascript/reference-vs-primitive-values/)

* * *

## 回答 #27

> 赞同：1
> 
> 时间：2020-07-05T10:50:49.853

CPU 堆栈和堆在物理上与 CPU 和寄存器如何与内存一起工作，机器汇编语言如何工作，而不是高级语言本身有关，即使这些语言可以决定一些小事情。

所有现代 CPU 都使用“相同”的微处理器理论：它们都基于所谓的“寄存器”，有些用于“堆栈”以获得性能。从一开始，所有 CPU 都有堆栈寄存器，而且它们一直都在这里，就像我所知的那样。汇编语言从一开始就相同，尽管存在差异……直到 Microsoft 及其中间语言 (IL) 改变了范式以拥有 OO 虚拟机汇编语言。所以将来我们将能够拥有一些 CLI/CIL CPU（MS 的一个项目）。

CPU 具有堆栈寄存器来加速内存访问，但与使用其他寄存器来完全访问进程的所有可用内存相比，它们受到限制。这就是我们谈论堆栈和堆分配的原因。

总之，一般来说，堆是巨大而缓慢的，用于“全局”实例和对象内容，因为堆栈小而快，并且用于“局部”变量和引用（隐藏指针以忘记管理它们）。

因此，当我们在方法中使用 new 关键字时，引用（一个 int）是在堆栈中创建的，但如果我记得的话，对象及其所有内容（值类型以及对象）都是在堆中创建的。但是本地基本值类型和数组是在堆栈中创建的。

内存访问的区别在于单元引用级别：寻址堆，即进程的整体内存，在处理 CPU 寄存器方面需要更多的复杂性，而不是在寻址方面“更多”本地的堆栈，因为 CPU 堆栈如果我记得的话，寄存器被用作基地址。

这就是为什么当我们有很长或无限的递归调用或循环时，我们很快就会发生堆栈溢出，而不会冻结现代计算机上的系统......

[.NET 中的 C# 堆（ing）与堆栈（ing）](https://www.c-sharpcorner.com/article/C-Sharp-heaping-vs-stacking-in-net-part-i/)

[堆栈与堆：知道区别](https://www.guru99.com/stack-vs-heap.html)

[存储它的静态类内存分配 C#](https://stackoverflow.com/questions/33562199/static-class-memory-allocation-where-it-is-stored-c-sharp)

[堆栈和堆是什么以及在哪里？](https://stackoverflow.com/questions/79923/what-and-where-are-the-stack-and-heap)

[https://en.wikipedia.org/wiki/Memory_management](https://en.wikipedia.org/wiki/Memory_management)

[https://en.wikipedia.org/wiki/Stack_register](https://en.wikipedia.org/wiki/Stack_register)

汇编语言资源：

[装配编程教程](https://www.tutorialspoint.com/assembly_programming/index.htm)

[英特尔® 64 和 IA-32 架构软件开发人员手册](https://software.intel.com/content/www/us/en/develop/articles/intel-sdm.html)

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2020-04-09T15:29:52.797

感谢您进行了非常好的讨论，但作为一个真正的菜鸟，我想知道说明保存在哪里？在开始时，科学家们在两种架构之间做出选择（冯诺伊曼认为一切都被认为是数据，而哈佛则为指令保留一个内存区域，另一个用于数据）。最终，我们采用了冯诺依曼设计，现在一切都被认为是“相同的”。这让我在学习汇编时感到很困难 [https://www.cs.virginia.edu/~evans/cs216/guides/x86.html](https://www.cs.virginia.edu/~evans/cs216/guides/x86.html) 因为他们谈论寄存器和堆栈指针。

以上所有内容都在谈论数据。我的猜测是，由于指令是具有特定内存占用的已定义事物，因此它将进入堆栈，因此汇编中讨论的所有“那些”寄存器都在堆栈上。当然，随后出现了面向对象编程，指令和数据混合到一个动态的结构中，所以现在指令也将保留在堆上？

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2021-10-11T08:20:01.637

创建进程时，在加载代码和数据之后，操作系统设置堆在数据结束后开始，并根据体系结构堆栈到地址空间的顶部

当需要更多堆时，操作系统将动态分配并且堆块总是几乎连续的

请看`brk()`,`sbrk()`和`alloca()`linux 中的系统调用

* * *

## 回答 #30

> 赞同：0
> 
> 时间：2021-11-20T22:17:13.183

> 它们在哪里，是什么（物理上在真实计算机的内存中）？

**回答：** **两者都在 RAM 中。**

**在旁边：**

*RAM 就像一张桌子，而 HDD/SSD（永久存储）就像书架。要阅读任何东西，您必须在办公桌上打开一本书，并且您只能在办公桌上打开尽可能多的书。要拿到一本书，你可以从书架上把它拿出来，然后在你的桌子上打开。要归还书，您需要合上办公桌上的书并将其放回书架。*

*堆栈和堆是我们给编译器将不同类型的数据存储在同一位置（即 RAM 中）的两种方式的名称。*

> 他们的范围是什么？
> 是什么决定了它们每个的大小？
> 是什么让一个更快？

**回答：**

1.  **堆栈用于静态（固定大小）数据**

    一种。*在编译时，编译器会读取代码中使用的变量类型。*

    一世。它为这些变量分配固定数量的内存。
    ii. 这个内存的大小不能增长。

    湾。*内存是连续的（单个块），因此访问* **有时** *比堆快*

    C。*放置在堆栈上的对象在运行时在内存中增长超过堆栈大小会导致* **堆栈溢出错误**

2.  **堆用于动态（改变大小）数据**

    一种。 内存量仅受 RAM i*中可用空间量的限制。*
    使用量可以在运行时根据需要增加或减少

    湾。*由于项目是通过在 RAM 中的任何位置找到空白空间来在堆上分配的，因此数据并不总是在连续的部分中，这* **有时** *会使访问速度比堆栈慢*

    C。*程序员使用关键字手动将项目放入堆栈，`new`并且必须在使用完毕后手动释放此内存。*
    一世。当不再需要**内存泄漏时重复分配新内存而不释放它的代码。**

**在旁边：**

堆栈和堆的引入主要不是为了提高速度；引入它们是为了处理内存溢出。关于使用堆栈与堆的第一个问题应该是是否会发生内存溢出。如果一个对象打算增长到未知数量（如链表或成员可以保存任意数量数据的对象），请将其放在堆上。尽可能使用 C++ 标准库 (STL) 容器**vector**、**map**和**list**，因为它们具有内存和速度效率，并且可以让您的生活更轻松（您无需担心内存分配/释放）。

在让你的代码运行之后，如果你发现它运行的慢得令人无法接受，那么回去重构你的代码，看看它是否可以更有效地编程。结果可能证明问题与堆栈或堆完全无关（例如，使用迭代算法而不是递归算法，查看 I/O 与 CPU 密集型任务，也许添加多线程或多处理）。

我在上面说*有时*更慢/更快，因为程序的速度可能与在堆栈或堆上分配的项目无关。

> 它们在多大程度上受操作系统或语言运行时的控制？

**回答：**

*   **堆栈大小由编译器在编译时确定。**

*   **堆大小在运行时变化。**（*堆在运行时与操作系统一起工作以分配内存。*）

**在旁边：**

下面是关于控制和编译时与运行时操作的更多信息。

每台计算机都有一个独特的**指令集架构（ISA）**，即它的硬件命令（例如“MOVE”、“JUMP”、“ADD”等）。

*   操作系统只不过是一个资源管理器（控制如何/何时/在何处使用内存、处理器、设备和信息）。

*   操作系统的 ISA 称为**裸机**，其余命令称为**扩展机**。**内核**是扩展机的第一层。它控制诸如

    *   确定哪些任务可以使用处理器（调度程序），
    *   分配给任务（调度程序）的内存或硬件寄存器数量，以及
    *   应该执行任务的顺序（流量控制器）。
*   当我们说“编译器”时，我们通常指的是编译器、汇编器和链接器

    *   编译器将源代码转换为汇编语言并将其传递给汇编器，
    *   汇编器将汇编语言转换为机器代码（ISA 命令），并将其传递给链接器
    *   链接器获取所有机器代码（可能从多个源文件生成）并将其组合到一个程序中。
*   机器代码在执行时被传递给内核，它决定何时运行并获得控制权，但机器代码本身包含用于请求文件、请求内存等的 ISA 命令。因此代码发出 ISA 命令，但一切都必须通过由内核。

# php - 在 PHP 中更改文本编码的最佳方法是什么

> ID：79928
> 
> 赞同：0
> 
> 时间：2008-09-17T04:19:08.453
> 
> 标签：php, encoding, utf-8

我想通过过滤器运行文本以确保它都是 UTF-8 编码的。使用 PHP 执行此操作的推荐方法是什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-17T04:22:44.203

你的问题不清楚，你是不是想编码一些东西？如果是这样[**utf8_encode**](http://us2.php.net/manual/en/function.utf8-encode.php)是你的朋友。您是否试图确定它是否不需要编码？如果是这样，**utf8_encode**仍然是您的朋友，因为您可以检查结果是否与输入相同！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-17T04:27:00.387

[在此处](http://be.php.net/manual/en/ref.mbstring.php)检查多字节字符串函数

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-17T04:31:24.383

你需要知道你的输入字符串是用什么字符集编码的，否则这将无济于事。

如果你想正确地做到这一点，这篇文章可能会有所帮助：[每个软件开发人员绝对、肯定必须了解 Unicode 和字符集的绝对最低要求（没有借口！）](http://www.joelonsoftware.com/articles/Unicode.html)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-17T04:32:06.910

给定一个字节流，你必须知道它是从什么编码开始的——电子邮件使用 mime 标头指定编码，http 使用 http 标头指定编码。此外，您可以在网页的元标记中指定编码，但并非总是如此。

无论如何，一旦您知道要转换的编码，请使用**iconv**将其转换为 utf8。查看 php 文档的 iconv 部分，那里有很多很好的信息。

啊，托马斯发布了我正在寻找的链接。必读。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-17T14:16:57.800

检查*UTF-8*有效性的最简单方法：

1.  如果只允许一行：

    ```
    preg_match('/^.*$/Du', $value) 
    ```

2.  如果允许多行：

    ```
    preg_match('/^.*$/sDu', $value) 
    ```

这适用于**PHP >= 4.3.5**，并且不需要任何非默认 PHP 模块。

# macos - Mac (68000) 汇编程序的名称是什么？

> ID：79929
> 
> 赞同：4
> 
> 时间：2008-09-17T04:19:22.917
> 
> 标签：macos, assembly, 68000

我敢肯定有几个，但是当您彻底崩溃计算机时，我正在考虑的那个会显示一个漂亮的文本屏幕。

文本是“好吧，给我抽个腌鱼。”

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-17T04:37:55.197

没有其他人回答过这个问题，所以我会回答我能回答的部分：最初的 Macintosh 调试器是[MacsBug](http://en.wikipedia.org/wiki/MacsBug)。

就 kipper 的引述而言，唯一能想到的就是 **[Pathogen](http://virus.wikidot.com/pathogen)** 计算机病毒。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2010-09-30T06:46:41.050

汇编程序的名称是 Fantasm。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-17T05:12:58.857

还有另一个名为 TMON 的 68000 Macintosh 调试器。我不记得里面有 kipper 的名言，但已经有一段时间了。

# java - Perl 是否有与 Java 的 Robot 类 (java.awt.Robot) 等效的东西？

> ID：79935
> 
> 赞同：3
> 
> 时间：2008-09-17T04:20:05.753
> 
> 标签：java, perl, automated-tests, awtrobot

Perl 是否有与 Java 的 Robot 类 (java.awt.Robot) 等效的东西？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-17T20:11:51.957

Alternatively, you can surely use the [WWW::Mechanize](http://search.cpan.org/~petdance/WWW-Mechanize-1.34/lib/WWW/Mechanize.pm) module to create an agent as we do here at work. We have a tool called AppMon that is really just a dramatized wrapper around Mechanize.

The Mechanize module allows you to use scripts that look a lot like this:

```
use WWW::Mechanize;

my $Agent = WWW::Mechanize->new(cookie_jar => {});

$Agent->get("http://www.google.com/search?q=stack+overflow+mechanize");
print "Found Mechanize" $Agent->content =~ /WWW::Mechanize/; 
```

and will result in "Found Mechanize" being output. This is a very simple script, but rest assured you can interact with forms quite well.

You can also move to Ruby and use Watir, or Selenium as another alternative, albeit not as interesting (in terms of coding) or automate-able. Selenium has a firefox extension that is quite useful for creating the selenium scripts and can change them between the various languages that it supports, which is pretty extensive in terms of automation.

## Update - Nov 2016

Although I haven't had much of an opportunity to play with it, there are also webdriver packages for most languages, and Perl is no different.

[Selenium::Remote::Driver](http://search.cpan.org/~aivaturi/Selenium-Remote-Driver-0.15/lib/Selenium/Remote/Driver.pm)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-17T04:30:09.583

如果您正在寻找一种方法来控制浏览器以进行功能测试，Selenium 具有 Perl 绑定：[http ://selenium.openqa.org/](http://selenium.openqa.org/)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-17T05:56:06.663

对于 X (Linux/Unix)，有[X11::GUITest](http://search.cpan.org/perldoc?X11::GUITest)。

对于 Windows，有[Win32::CtrlGUI](http://search.cpan.org/perldoc?Win32::CtrlGUI)，尽管安装它的先决条件可能有点棘手。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-17T14:26:13.987

在 Windows 上，我一直使用[Win32::GuiTest](http://search.cpan.org/~karasik/Win32-GuiTest-1.54/lib/Win32/GuiTest.pm)。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-17T04:26:36.893

在 Linux/Unix 上有：

[http://sourceforge.net/projects/x11guitest](http://sourceforge.net/projects/x11guitest)

对于使用 Perl 的 Windows 或 Mac，我不熟悉类似的东西。

# linq-to-sql - 如何加载多对多 LINQ 查询？

> ID：79939
> 
> 赞同：6
> 
> 时间：2008-09-17T04:20:36.737
> 
> 标签：linq-to-sql

我有以下（非常标准的）表结构：

```
Post <-> PostTag <-> Tag 
```

假设我有以下记录：

```
PostID Title
1,     'Foo'
2,     'Bar'
3,     'Baz'

TagID Name
1,    'Foo'
2,    'Bar'

PostID TagID
1      1
1      2
2      2 
```

换句话说，第一个帖子有两个标签，第二个有一个，第三个没有。

**我想在一个查询中加载所有帖子及其标签，**但无法找到正确的运算符组合。我已经能够加载*仅带有标签*的帖子或*多个标签时重复的帖子*。

鉴于上面的数据库，**我想在 Post objects 的集合属性中接收三个帖子及其标签（如果有）**。有可能吗？

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-17T14:24:22.213

耶！有效。

如果有人遇到同样的问题，这就是我所做的：

```
public IList<Post> GetPosts(int page, int record)
{
    var options = new DataLoadOptions();
    options.LoadWith<Post>(p => p.PostTags);
    options.LoadWith<PostTag>(pt => pt.Tag);
    using (var db = new DatabaseDataContext(m_connectionString))
    {
        var publishDateGmt = (from p in db.Posts
                              where p.Status != PostStatus.Hidden
                              orderby p.PublishDateGmt descending
                              select p.PublishDateGmt)
                              .Skip(page * record)
                              .Take(record)
                              .ToList()
                              .Last();
        db.LoadOptions = options;
        return (from p in db.Posts
                where p.Status != PostStatus.Closed 
                    && p.PublishDateGmt >= publishDateGmt
                orderby p.PublishDateGmt descending
                select p)
                .Skip(page * record)
                .ToList();
    }
} 
```

这仅执行两个查询并为每个帖子加载所有标签。

这个想法是在我们需要的最后一个帖子中获取一些值来限制查询（在这种情况下，PublishDateGmt 列就足够了），然后使用该值而不是 Take() 来限制第二个查询。

感谢您的帮助西洛克。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-17T13:46:53.473

对不起。您提供的解决方案有效，但我发现它在使用 Take(N) 分页时会中断。我正在使用的完整方法如下：

```
public IList<Post> GetPosts(int page, int records)
{
    var options = new DataLoadOptions();
    options.LoadWith<Post>(p => p.PostTags);
    options.LoadWith<PostTag>(pt => pt.Tag);
    using (var db = new BlogDataContext())
    {
        db.LoadOptions = options;
        return (from p in db.Posts
                where p.Status != PostStatus.Closed
                orderby p.PublishDateGmt descending
                select p)
                .Skip(page * records)
                //.Take(records)
                .ToList();
    }
} 
```

注释了 Take() 方法后，它会生成一个类似于您发布的查询，但如果我再次添加 Take()，它会生成 1 + N x M 个查询。

所以，我想我现在的问题是：**是否有替代 Take() 方法来对记录进行分页？**

谢谢

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-17T06:53:28.863

这有点奇怪，因为

```
DataLoadOptions o = new DataLoadOptions ( );
o.LoadWith<Listing> ( l => l.ListingStaffs );
o.LoadWith<ListingStaff> ( ls => ls.MerchantStaff );
ctx.LoadOptions = o;

IQueryable<Listing> listings = (from a in ctx.Listings
            where a.IsActive == false 
                            select a);
List<Listing> list = listings.ToList ( ); 
```

结果如下查询：

```
SELECT [t0].*, [t1].*, [t2].*, (
SELECT COUNT(*)
FROM [dbo].[LStaff] AS [t3]
INNER JOIN [dbo].[MStaff] AS [t4] ON [t4].[MStaffId] = [t3].[MStaffId]
WHERE [t3].[ListingId] = [t0].[ListingId]
) AS [value]
FROM [dbo].[Listing] AS [t0]
LEFT OUTER JOIN ([dbo].[LStaff] AS [t1]
INNER JOIN [dbo].[MStaff] AS [t2] ON [t2].[MStaffId] = [t1].[MStaffId]) ON 
[t1].[LId] = [t0].[LId] WHERE NOT ([t0].[IsActive] = 1) 
ORDER BY [t0].[LId], [t1].[LStaffId], [t2].[MStaffId] 
```

（我缩短了名称并在选择中添加了 *）。

所以它似乎可以选择。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-17T04:26:56.440

我已经在另一篇文章中回答了这个问题：[关于急切加载](https://stackoverflow.com/questions/50169/optimizing-a-linq-to-sql-query#50240)。在您的情况下，它可能类似于：

```
DataLoadOptions options = new DataLoadOptions();    
options.LoadWith<Post>(p => p.PostTag);
options.LoadWith<PostTag>(pt => pt.Tag); 
```

虽然要小心 - 在将任何查询发送到数据库之前必须设置 DataLoadOptions - 如果没有，则会引发异常（不知道为什么在 Linq2Sql 中会这样 - 可能会在以后的版本中修复）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-17T04:35:02.083

抱歉，没有，Eager Loading 将为每个帖子的每个标签执行一个额外的查询。

使用此代码进行测试：

```
var options = new DataLoadOptions();
options.LoadWith<Post>(p => p.PostTags);
options.LoadWith<PostTag>(pt => pt.Tag);
using (var db = new BlogDataContext())
{
    db.LoadOptions = options;
    return (from p in db.Posts
            where p.Status != PostStatus.Closed
            orderby p.PublishDateGmt descending
            select p);
} 
```

在示例数据库中，它将执行 4 个查询，这在生产中是不可接受的。任何人都可以提出另一种解决方案吗？

谢谢

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-10-20T17:42:41.083

我知道这是一篇旧文章，但我发现了一种在只执行一个查询时使用 Take() 的方法。诀窍是在嵌套查询中执行 Take()。

```
var q = from p in db.Posts
        where db.Posts.Take(10).Contains(p)
        select p; 
```

将 DataLoadOptions 与上面的查询一起使用将在一个查询中为您提供前十个帖子，包括它们的关联标签。生成的 SQL 将是以下内容的不太简洁的版本：

```
SELECT p.PostID, p.Title, pt.PostID, pt.TagID, t.TagID, t.Name FROM Posts p
JOIN PostsTags pt ON p.PostID = pt.PostID
JOIN Tags t ON pt.TagID = t.TagID
WHERE p.PostID IN (SELECT TOP 10 PostID FROM Posts) 
```

# database - 在日期时间字段上仅存储日期的最佳方式？

> ID：79949
> 
> 赞同：3
> 
> 时间：2008-09-17T04:22:01.397
> 
> 标签：database, tsql

场景：一个存储过程从代码中接收一个 DateTime，假设是 DateTime.Now 值，作为 datetime 参数。存储过程只需要在行上存储日期时间的日期部分，但保留所有与日期相关的算术，例如，在时间间隔内进行搜索并根据日期进行报告。

我知道有几种方法，但是考虑到性能和浪费空间有什么更好的方法？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-17T04:33:24.787

业务逻辑应该在过程之外处理。procs 作业应该是保存传递给它的数据。如果要求只存储日期而不是时间，那么 BL/DL 应该传入 DateTime.Now**.Date** （或等效的......基本上是 DateTime 对象的 Date 部分）。

如果由于某种原因您无法控制代码，则总有 convert(varchar(10), @YOURDATETIME, 101)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-17T04:24:19.283

用时间 = 午夜存储日期

编辑：我假设 MS SQL Server

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-17T04:29:54.030

本质上，您只会存储 DateTime 对象的 Date 部分。这意味着无论您希望如何处理查询数据，返回的日期都将始终设置为 00:00:00。

在这种情况下，与时间相关的函数是无用的（即使您的原始 DateTime 对象使用它们），因为您的数据库会删除此信息。

尽管您必须为从数据库返回的每个日期假定一个午夜时间，但与日期相关的算术仍然适用。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-17T05:07:52.143

SQL Server 2008 具有不存储时间的仅日期类型 (DATE)。考虑升级。

[http://www.sqlteam.com/article/using-the-date-data-type-in​​-sql-server-2008](http://www.sqlteam.com/article/using-the-date-data-type-in-sql-server-2008)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-17T18:39:09.043

如果您正在使用 Oracle，请在存储过程中对日期时间使用 TRUNC 函数。这将只返回日期部分。

# design-patterns - 使用 db4o 进行报告

> ID：79953
> 
> 赞同：7
> 
> 时间：2008-09-17T04:23:32.657
> 
> 标签：design-patterns, reporting, db4o

过去，我在许多项目中都使用过 db4o，并取得了很大的成功。随着时间的推移，它似乎有了很大的发展，随着每个人的舌头上像 LINQ 这样的现代趋势，它再次激发了我的兴趣，尤其是现在我知道它开始支持透明的激活和持久性，这让我很感兴趣，但是朋友当我第一次提到 db4o 时向我提出了一个非常好的问题，即使有了现代创新，我仍然不知道如何回答。

生成类似于大型跨表复杂约束报告的报告的最佳/最快/最常用方法是什么，可以在 SQL 等平台上如此有效地完成？我非常了解节省了多少时间、精力和开发时间，甚至获得了许多性能提升，尤其是在 ORM 上，但有些应用程序需要复杂的报告，我不知道如何使用对象和对象查询来表达，我也是担心性能，因为即使在专门为此目的设计的系统上优化和维护复杂的报告也可能是压倒性的。

--
编辑：

更清楚地说，对象数据源等可用于将 db4o 拉入与 SqlDataSource 等人相同的数据丰富的控件中。我在 db4o 站点上被提到了关于将它与 ReportViewer 一起使用的文档，并建议我将数据非规范化到报告数据库中，但这个问题意味着对如何完成查询类型提出概念挑战RDBMS 表现如此出色，以至于它们占据了整个行业。我喜欢 db4o，但如果不将所有相关对象从数据库中拉出、激活它们并执行计算，我想不出一种真正有效的方法来报告存在于几种不同类型（或 SQL 中的表）中的聚合数据在应用程序级代码中。我可能错了，但这似乎不可能

我希望在我们设法聚集在这里的聪明才智中，有人知道我不知道的事情，或者对未来的实施有创新的想法，可以扩展 ODBMS 领域。我知道各种 ORM 实现了复杂报告对象的方法，我想知道是否有任何具有这些技术经验的人可能有一些创造性的东西，不依赖于我的代码和 db4o 之外的任何技术（我可以使用单独的 SQL 服务器）。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-17T15:03:35.223

为了解决通过 db4o 报告的性能成本问题，我建议与 db4o 容器并行维护一个高度非规范化的（sqlite ？）数据库。针对 db 运行报告，针对 db4o 运行正常的应用程序逻辑。

是的，这需要更多的工作，但这样您将获得高性能报告，同时保持 db4o 的实用性。

如果您已正确分离数据访问代码，则应该很容易更新任何保存对象的代码以更新报告数据库。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-04T06:08:11.347

请看[这个页面](http://developer.db4o.com/Resources/view.aspx/Reference/Implementation_Strategies/Reporting/)。

最好的，

德语

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-17T14:29:35.447

我对这个问题的有限理解是，由于缺少一些功能，例如 Count、Aggregate 等，目前使用 DB4O 很难进行报告。就目前而言，您必须自己实现这些，而这意味着性能不佳（例如激活所有记录，然后对记录执行计数操作）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-19T22:41:52.473

我不熟悉 db4o。但我知道一些过度报告软件。其中一些具有数据接口，您可以编写自己的连接器，例如[i-net Crystal-Clear](http://www.inetsoftware.de/)。如果您可以查询简单对象（字符串、数字、...）的简单列表，那么它很简单。

另一个简单的解决方案是编写一个虚拟 JDBC 驱动程序。有一个样本。您希望在 db4o 上运行的查询将作为虚拟存储过程提供。使用可选参数，您可以过滤 db4o 上的数据以获得最佳性能。这样的虚拟 JDBC 驱动程序可以编写 3-4 小时。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-09-28T20:14:07.953

它*也可能*归结为您使用的报告工具。例如，我实施了一个项目，该项目使用 Microsoft 的 Reporting Services 客户端引擎来呈现报告——不依赖于 SQL 服务器——只需为其提供对象。所有的聚合都由报告引擎执行，这意味着您的代码只需要查找和具体化底层对象。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-07-21T12:45:08.500

Far too late to be useful to you. But I suggest that people who find this question might want to look at Jasper Reports. There is a "commercial" version of the product. However, it's actually an open source solution and can be found on [sourceforge](http://sourceforge.net/projects/jasperreports/).

Seems it's actually pretty good. There's even a [report server](http://sourceforge.net/projects/jasperserver/) and BI functionality (again, all open source). So it might be worth a look for somebody who is a bit interested.

# visual-studio - Visual Studio 打开默认浏览器而不是 Internet Explorer

> ID：79954
> 
> 赞同：207
> 
> 时间：2008-09-17T04:23:35.510
> 
> 标签：visual-studio, internet-explorer

当我在 Visual Studio 中调试时，Firefox 会打开，这很烦人，因为 Internet Explorer 和 Visual Studio 具有连接，例如当您关闭启动调试打开的 Internet Explorer 浏览器时，Visual Studio 会停止调试。如何让 Visual Studio 打开 Internet Explorer 而无需将 Internet Explorer 设置为我的默认浏览器？

* * *

## 回答 #1

> 赞同：281
> 
> 时间：2008-09-17T04:24:58.083

Scott Guthrie 发表了一篇关于[如何更改 Visual Studio 的默认浏览器](http://weblogs.asp.net/scottgu/archive/2005/11/18/430943.aspx)的帖子：

> 1) 右键单击​​解决方案资源管理器中的 .aspx 页面
> 
> 2）选择“浏览方式”上下文菜单选项
> 
> 3) 在对话框中，您可以选择或添加浏览器。如果您希望 Firefox 在列表中，请单击“添加”并指向 firefox.exe 文件名
> 
> 4) 当您在网站上运行任何页面时，单击“设为默认值”按钮使其成为默认浏览器。

然而，我不喜欢这样一个事实，即这并不像它应该的那样简单。

* * *

## 回答 #2

> 赞同：122
> 
> 时间：2010-09-14T16:41:50.903

在 Visual Studio 2010 中，默认浏览器经常被重置（几乎每次更改 IDE 设置时，甚至在重新启动 Visual Studio 之后）。现在有一个 2010 的默认浏览器选择器扩展来帮助解决这个问题：

**！！！更新！！！**根据@Cory 的说法，WoVS 默认浏览器切换器似乎不再免费[提供](https://stackoverflow.com/users/74757/cory)。您可以尝试使用[Default Browser Changer](http://visualstudiogallery.msdn.microsoft.com/233945ae-0b7b-47e7-9b02-c5a11798afb5)，但我尚未对其进行测试。如果您已经拥有 WoVS 插件，我建议您备份它，以便以后安装。

**以下解决方案可能不再有效：**

**WoVS 默认浏览器切换器**：http : [//visualstudiogallery.msdn.microsoft.com/en-us/bb424812-f742-41ef-974a-cdac607df921](http://visualstudiogallery.msdn.microsoft.com/en-us/bb424812-f742-41ef-974a-cdac607df921)

![WoVS 默认浏览器切换器](https://i.stack.imgur.com/EJESt.png)

**编辑：**这也适用于**ASP.NET MVC**应用程序。

**注意：**安装此扩展程序的一个负面影响是它似乎每月更新一次。这导致一些人卸载它，因为对他们来说，它比它修复的问题更麻烦。不管它通过扩展管理器很容易更新，我仍然觉得它非常有用。

启动VS时会看到如下错误：

> 默认浏览器切换器 beta 位已过期。请使用扩展管理器或访问 VS Gallery 下载更新的位。

* * *

## 回答 #3

> 赞同：43
> 
> 时间：2012-05-30T11:35:16.297

对于**MVC3**，您*不必*添加任何虚拟文件来设置某个浏览器。你所要做的就是：

*   项目的“显示所有文件”
*   转到 bin 文件夹
*   右键单击唯一的 .xml 文件以找到“浏览方式...”选项

![设置 MVC3 项目默认浏览器](https://i.stack.imgur.com/dWpO3.png)

* * *

## 回答 #4

> 赞同：26
> 
> 时间：2008-09-17T04:24:36.243

右键单击 aspx 文件并选择“浏览方式”。我认为有一个选项可以设置为默认值。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2009-07-27T17:46:38.697

也可能对 ASP.NET MVC 有所帮助：

> 在 MVC 应用程序中，您必须右键单击 Default.aspx，这是该解决方案中唯一的“真实”网页。默认页面显示“浏览方式...”</p>

从[http://avaricesoft.wordpress.com/2008/08/04/](http://avaricesoft.wordpress.com/2008/08/04/) ...

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2011-06-14T02:52:21.647

如果您正在运行 MVC 3 应用程序 - 在您的解决方案资源管理器中单击显示所有文件图标，然后在 Global.asax 文件下应该有一个名为 YourProjectName.Publish.XML 的文件，右键单击它，然后单击“浏览方式”。 ..”并选择您喜欢的浏览器作为默认浏览器。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-09-17T04:25:09.097

在解决方案资源管理器中，右键单击任何 ASPX 页面并选择“浏览方式”并选择 IE 作为默认值。

注意...相同的步骤可用于将 Google Chrome 添加为浏览器选项，并可选择将其设置为默认浏览器。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2010-03-23T16:35:32.323

如果您的项目中没有 .aspx（即其 XBAP）但仍需要使用 IE 进行调试，请快速注意，只需将 htm 页面添加到您的项目并右键单击该页面以设置默认值。这很hacky，但它有效：P

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2011-09-30T12:12:37.950

您也可以通过 firefox 进行调试。

请按照以下步骤操作：`Tool`->`Attach to process`并选择`firefox.exe`您的默认浏览器。然后调试器将与这个浏览器一起工作。但是当 Firefox 是 32 位而 VS2010 是 64 位时，我遇到了一些麻烦。

无论如何右键单击当前文档，浏览而`-->`不是选择您的浏览器，而不是将其设置为默认值。这种方式比较好。因为firefox的进程id可能会改变，所以你会因为再次附加进程而烦恼。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2017-04-19T20:01:42.537

在 VS 2017 中，使用 Chrome 调试 ASP.NET 项目不会让您使用您的 Google 帐户登录。

要解决此问题，请转到工具 -> 选项 -> 调试 -> 常规并关闭设置为 ASP.NET（Chrome 和 IE）启用 JavaScript 调试。

[![https://msdnshared.blob.core.windows.net/media/2016/11/debugger-settings-1024x690.png](https://i.stack.imgur.com/WOXe1.png)](https://i.stack.imgur.com/WOXe1.png)

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2017-05-02T06:08:52.710

在 Visual Studio 2013 中，可以按如下方式完成：

1) 确保您已从解决方案探索窗口中选择了一个启动项目 2) 这会在调试下拉菜单的左侧带来一个下拉菜单。您可以从这个新的下拉列表中选择浏览器。

关键是应该有一个项目被选为启动

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2015-07-06T23:19:05.387

您提到了 Visual Studio。这适用于 Visual Studio 2013。在第二行的“菜单和工具”中，在“调试”正下方，您有一个下拉框，为您提供“模拟器”的列表/选项。您的 IE 应该在选项中，选择它然后您很好。简单的方法 。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2019-04-26T15:08:04.150

您的项目**可能没有 aspx 文件**，因为它可能是另一种 Web 项目。

但是，如果它有一个***ClientApp*文件夹**：

1.  转到*解决方案资源管理器*( `Ctrl`++ `Alt`)的标准视图`L`，您可以在其中找到*您的项目*名称解决方案（单击顶部的文件夹图标以确保（说“解决方案和文件夹”））
2.  **右键单击*ClientApp*文件夹**本身
3.  *Browse with...*将显示在顶部附近（在*View in Browser*选项附近），单击它并显示浏览器对话框
4.  点击您喜欢的浏览器
5.  单击*设置为默认值*
6.  单击*浏览*以确认（这将打开您刚刚在该文件夹中选择的浏览器）

* * *

## 回答 #14

> 赞同：-3
> 
> 时间：2012-08-27T12:17:51.963

另一种方法是在 Visual Studio 中执行以下操作：

1.  选择调试
2.  选项和设置
3.  展开环境
4.  选择网络浏览器
5.  单击“ **Internet Explorer 选项**”按钮
6.  选择“**程序**”选项卡
7.  为 Internet Explorer选择“**设为默认值”按钮**

# php - 如何将PHP中的字符串截断为最接近一定数量字符的单词？

> ID：79960
> 
> 赞同：199
> 
> 时间：2008-09-17T04:24:04.277
> 
> 标签：php, string, function

我有一个用 PHP 编写的代码片段，它从数据库中提取一段文本并将其发送到网页上的小部件。原始文本块可以是一篇冗长的文章，也可以是一两句话；但是对于这个小部件，我不能显示超过 200 个字符。我可以使用 substr() 在 200 个字符处截断文本，但结果会在单词中间截断——我真正想要的是在最后一个*单词*末尾截断200 个字符之前的文本。

* * *

## 回答 #1

> 赞同：237
> 
> 时间：2008-09-17T04:27:34.970

通过使用[自动换行](http://www.php.net/wordwrap)功能。它将文本拆分为多行，以使最大宽度为您指定的宽度，并在单词边界处中断。拆分后，你只需取第一行：

```
substr($string, 0, strpos(wordwrap($string, $your_desired_width), "\n")); 
```

这个 oneliner 无法处理的一件事是文本本身短于所需宽度的情况。要处理这种极端情况，应该执行以下操作：

```
if (strlen($string) > $your_desired_width) 
{
    $string = wordwrap($string, $your_desired_width);
    $string = substr($string, 0, strpos($string, "\n"));
} 
```

* * *

如果文本在实际剪切点之前包含换行符，则上述解决方案存在过早剪切文本的问题。这是解决此问题的版本：

```
function tokenTruncate($string, $your_desired_width) {
  $parts = preg_split('/([\s\n\r]+)/', $string, null, PREG_SPLIT_DELIM_CAPTURE);
  $parts_count = count($parts);

  $length = 0;
  $last_part = 0;
  for (; $last_part < $parts_count; ++$last_part) {
    $length += strlen($parts[$last_part]);
    if ($length > $your_desired_width) { break; }
  }

  return implode(array_slice($parts, 0, $last_part));
} 
```

此外，这里是用于测试实现的 PHPUnit 测试类：

```
class TokenTruncateTest extends PHPUnit_Framework_TestCase {
  public function testBasic() {
    $this->assertEquals("1 3 5 7 9 ",
      tokenTruncate("1 3 5 7 9 11 14", 10));
  }

  public function testEmptyString() {
    $this->assertEquals("",
      tokenTruncate("", 10));
  }

  public function testShortString() {
    $this->assertEquals("1 3",
      tokenTruncate("1 3", 10));
  }

  public function testStringTooLong() {
    $this->assertEquals("",
      tokenTruncate("toooooooooooolooooong", 10));
  }

  public function testContainingNewline() {
    $this->assertEquals("1 3\n5 7 9 ",
      tokenTruncate("1 3\n5 7 9 11 14", 10));
  }
} 
```

# **编辑 ：**

不处理像“à”这样的特殊 UTF8 字符。在 REGEX 末尾添加 'u' 来处理它：

`$parts = preg_split('/([\s\n\r]+)/u', $string, null, PREG_SPLIT_DELIM_CAPTURE);`

* * *

## 回答 #2

> 赞同：144
> 
> 时间：2008-09-17T04:41:34.390

这将返回单词的前 200 个字符：

```
preg_replace('/\s+?(\S+)?$/', '', substr($string, 0, 201)); 
```

* * *

## 回答 #3

> 赞同：50
> 
> 时间：2011-01-12T04:29:50.643

```
$WidgetText = substr($string, 0, strrpos(substr($string, 0, 200), ' ')); 
```

你就拥有了它——一种将任何字符串截断为最接近的整个单词的可靠方法，同时保持在最大字符串长度以下。

我已经尝试了上面的其他示例，但它们没有产生预期的结果。

* * *

## 回答 #4

> 赞同：40
> 
> 时间：2013-07-25T08:10:31.117

当我注意到[wordwrap](http://php.net/wordwrap)函数的 $break 参数时，以下解决方案诞生了：

> 字符串自动换行（字符串 $str [, int $width = 75 [, string $break = "\n" [, bool $cut = false ]]] ）

这是**解决方案**：

```
/**
 * Truncates the given string at the specified length.
 *
 * @param string $str The input string.
 * @param int $width The number of chars at which the string will be truncated.
 * @return string
 */
function truncate($str, $width) {
    return strtok(wordwrap($str, $width, "...\n"), "\n");
} 
```

**示例#1。**

```
print truncate("This is very long string with many chars.", 25); 
```

上面的示例将输出：

```
This is very long string... 
```

**示例#2。**

```
print truncate("This is short string.", 25); 
```

上面的示例将输出：

```
This is short string. 
```

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2008-09-17T06:08:57.707

请记住，当您在某些语言（例如中文和日语）不使用空格字符来分割单词的任何地方使用“单词”进行分割时。此外，恶意用户可以简单地输入不带任何空格的文本，或者使用与标准空格字符相似的 Unicode，在这种情况下，您使用的任何解决方案都可能最终显示整个文本。解决此问题的一种方法可能是在正常拆分空格后检查字符串长度，然后，如果字符串仍高于异常限制 - 在这种情况下可能为 225 个字符 - 继续并在该限制下将其愚蠢地拆分。

当涉及到非 ASCII 字符时，还要注意这样的事情；包含它们的字符串可能会被 PHP 的标准 strlen() 解释为比实际更长，因为单个字符可能占用两个或多个字节，而不仅仅是一个。如果你只是使用 strlen()/substr() 函数来分割字符串，你可能会在一个字符的中间分割一个字符串！如有疑问，[mb_strlen()](http://us3.php.net/manual/en/function.mb-strlen.php) / [mb_substr()](http://php.net/mb_substr)会更简单一些。

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2008-09-17T04:29:46.603

使用 strpos 和 substr：

```
<?php

$longString = "I have a code snippet written in PHP that pulls a block of text.";
$truncated = substr($longString,0,strpos($longString,' ',30));

echo $truncated; 
```

这将为您提供一个在 30 个字符后的第一个空格处截断的字符串。

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2008-09-17T04:31:26.867

干得好：

```
function neat_trim($str, $n, $delim='…') {
   $len = strlen($str);
   if ($len > $n) {
       preg_match('/(.{' . $n . '}.*?)\b/', $str, $matches);
       return rtrim($matches[1]) . $delim;
   }
   else {
       return $str;
   }
} 
```

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2010-03-26T12:36:03.183

这是我基于@Cd-MaN 方法的函数。

```
function shorten($string, $width) {
  if(strlen($string) > $width) {
    $string = wordwrap($string, $width);
    $string = substr($string, 0, strpos($string, "\n"));
  }

  return $string;
} 
```

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2014-07-03T15:04:13.963

```
$shorttext = preg_replace('/^([\s\S]{1,200})[\s]+?[\s\S]+/', '$1', $fulltext); 
```

描述：

*   `^`- 从字符串的开头开始
*   `([\s\S]{1,200})`- 获得 1 到 200 个任意字符
*   `[\s]+?`- 短文本末尾不包含空格，这样我们可以避免`word ...`而不是`word...`
*   `[\s\S]+`- 匹配所有其他内容

测试：

1.  [`regex101.com`](http://regex101.com/r/bV7dJ6/3)让我们添加`or`一些其他的`r`
2.  [`regex101.com`](http://regex101.com/r/bV7dJ6/4) `orrrr`正好 200 个字符。
3.  [`regex101.com`](http://regex101.com/r/bV7dJ6/5)第五后`r` `orrrrr`排除。

享受。

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2015-09-01T20:55:28.570

令人惊讶的是，要找到这个问题的完美解决方案是多么棘手。我还没有在此页面上找到至少在某些情况下不会失败的答案（特别是如果字符串包含换行符或制表符，或者如果单词 break 不是空格，或者如果字符串具有 UTF- 8 个多字节字符）。

这是一个适用于所有情况的简单解决方案。这里有类似的答案，但是如果您希望它与多行输入一起使用，“s”修饰符很重要，并且“u”修饰符可以正确评估 UTF-8 多字节字符。

```
function wholeWordTruncate($s, $characterCount) 
{
    if (preg_match("/^.{1,$characterCount}\b/su", $s, $match)) return $match[0];
    return $s;
} 
```

一个可能的边缘情况......如果字符串在前 $characterCount 个字符中根本没有任何空格，它将返回整个字符串。如果您更喜欢它强制在 $characterCount 处中断，即使它不是单词边界，您也可以使用它：

```
function wholeWordTruncate($s, $characterCount) 
{
    if (preg_match("/^.{1,$characterCount}\b/su", $s, $match)) return $match[0];
    return mb_substr($return, 0, $characterCount);
} 
```

最后一个选项，如果你想让它在截断字符串时添加省略号......

```
function wholeWordTruncate($s, $characterCount, $addEllipsis = ' …') 
{
    $return = $s;
    if (preg_match("/^.{1,$characterCount}\b/su", $s, $match)) 
        $return = $match[0];
    else
        $return = mb_substr($return, 0, $characterCount);
    if (strlen($s) > strlen($return)) $return .= $addEllipsis;
    return $return;
} 
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-09-17T04:33:57.420

我会使用 preg_match 函数来执行此操作，因为您想要的是一个非常简单的表达式。

```
$matches = array();
$result = preg_match("/^(.{1,199})[\s]/i", $text, $matches); 
```

该表达式的意思是“匹配任何以空格结尾的长度为 1-200 的子字符串”。结果在 $result 中，匹配在 $matches 中。这可以解决您最初的问题，该问题专门以任何空间结尾。如果要使其以换行符结尾，请将正则表达式更改为：

```
$result = preg_match("/^(.{1,199})[\n]/i", $text, $matches); 
```

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2011-10-26T14:37:56.980

好的，所以我根据上述答案得到了另一个版本，但考虑到了更多的东西（utf-8、\n 和   ;），如果与 wp.

```
function neatest_trim($content, $chars) 
  if (strlen($content) > $chars) 
  {
    $content = str_replace('&nbsp;', ' ', $content);
    $content = str_replace("\n", '', $content);
    // use with wordpress    
    //$content = strip_tags(strip_shortcodes(trim($content)));
    $content = strip_tags(trim($content));
    $content = preg_replace('/\s+?(\S+)?$/', '', mb_substr($content, 0, $chars));

    $content = trim($content) . '...';
    return $content;
  } 
```

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2011-11-09T22:29:11.407

这是对 mattmac 的回答的一个小修复：

```
preg_replace('/\s+?(\S+)?$/', '', substr($string . ' ', 0, 201)); 
```

唯一的区别是在 $string 的末尾添加一个空格。这确保了最后一个词不会按照 ReX357 的评论被截断。

我没有足够的代表点将其添加为评论。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2012-04-05T09:32:56.550

```
/*
Cut the string without breaking any words, UTF-8 aware 
* param string $str The text string to split
* param integer $start The start position, defaults to 0
* param integer $words The number of words to extract, defaults to 15
*/
function wordCutString($str, $start = 0, $words = 15 ) {
    $arr = preg_split("/[\s]+/",  $str, $words+1);
    $arr = array_slice($arr, $start, $words);
    return join(' ', $arr);
} 
```

用法：

```
$input = 'Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna liqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.';
echo wordCutString($input, 0, 10); 
```

这将输出前 10 个单词。

该`preg_split`函数用于将字符串拆分为子字符串。字符串被分割的边界是使用正则表达式模式指定的。

`preg_split`函数接受 4 个参数，但现在只有前 3 个与我们相关。

第一个参数 - 模式 第一个参数是正则表达式模式，字符串将沿着该模式进行拆分。在我们的例子中，我们希望跨单词边界分割字符串。因此，我们使用预定义的字符类`\s`来匹配空格字符，例如空格、制表符、回车和换行。

第二个参数 - 输入字符串 第二个参数是我们要拆分的长文本字符串。

第三个参数——限制 第三个参数指定应该返回的子字符串的数量。如果将限制设置为`n`， preg_split 将返回一个包含 n 个元素的数组。第一个`n-1`元素将包含子字符串。最后一个`(n th)`元素将包含字符串的其余部分。

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2021-03-10T06:27:18.107

你可以使用这个：

```
function word_shortener($text, $words=10, $sp='...'){

  $all = explode(' ', $text);
  $str = '';
  $count = 1;

  foreach($all as $key){
    $str .= $key . ($count >= $words ? '' : ' ');
    $count++;
    if($count > $words){
      break;
    }
  }

  return $str . (count($all) <= $words ? '' : $sp);

} 
```

例子：

```
word_shortener("Hello world, this is a text", 3); // Hello world, this...
word_shortener("Hello world, this is a text", 3, ''); // Hello world, this
word_shortener("Hello world, this is a text", 3, '[read more]'); // Hello world, this[read more] 
```

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2010-12-09T16:28:08.740

基于@Justin Poliey 的正则表达式：

```
// Trim very long text to 120 characters. Add an ellipsis if the text is trimmed.
if(strlen($very_long_text) > 120) {
  $matches = array();
  preg_match("/^(.{1,120})[\s]/i", $very_long_text, $matches);
  $trimmed_text = $matches[0]. '...';
} 
```

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2014-06-13T11:37:05.113

我有一个功能几乎可以满足您的需求，如果您进行一些编辑，它将完全适合：

```
<?php
function stripByWords($string,$length,$delimiter = '<br>') {
    $words_array = explode(" ",$string);
    $strlen = 0;
    $return = '';
    foreach($words_array as $word) {
        $strlen += mb_strlen($word,'utf8');
        $return .= $word." ";
        if($strlen >= $length) {
            $strlen = 0;
            $return .= $delimiter;
        }
    }
    return $return;
}
?> 
```

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2014-12-11T10:33:32.263

我就是这样做的：

```
$string = "I appreciate your service & idea to provide the branded toys at a fair rent price. This is really a wonderful to watch the kid not just playing with variety of toys but learning faster compare to the other kids who are not using the BooksandBeyond service. We wish you all the best";

print_r(substr($string, 0, strpos(wordwrap($string, 250), "\n"))); 
```

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2020-04-03T23:50:50.007

虽然这是一个相当老的问题，但我想我会提供一个替代方案，因为它没有被提及并且对 PHP 4.3+ 有效。

通过使用精度修饰符，您可以使用[`sprintf`](https://www.php.net/manual/en/function.sprintf.php)函数族来截断文本 。`%.ℕs`

> 一个句`.`点后跟一个整数，其含义取决于说明符：
> 
> *   对于 e、E、f 和 F 说明符：这是要在小数点后打印的位数（默认为 6）。
> *   对于 g 和 G 说明符：这是要打印的有效数字的最大数量。
> *   **对于 s 说明符：它充当截止点，为字符串设置最大字符限制**

## 简单截断[https://3v4l.org/QJDJU](https://3v4l.org/QJDJU)

```
$string = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ';
var_dump(sprintf('%.10s', $string)); 
```

**结果**

```
string(10) "0123456789" 
```

* * *

## 扩展截断[https://3v4l.org/FCD21](https://3v4l.org/FCD21)

由于`sprintf`功能类似于`substr`并且将部分切断单词。以下方法将通过使用`strpos(wordwrap(..., '[break]'), '[break]')`特殊分隔符来确保单词不会被截断。这使我们能够检索位置并确保我们不匹配标准句子结构。

返回一个字符串而不部分切断单词并且不超过指定的宽度，同时如果需要保留换行符。

```
function truncate($string, $width, $on = '[break]') {
    if (strlen($string) > $width && false !== ($p = strpos(wordwrap($string, $width, $on), $on))) {
        $string = sprintf('%.'. $p . 's', $string);
    }
    return $string;
}
var_dump(truncate('0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ', 20));

var_dump(truncate("Lorem Ipsum is simply dummy text of the printing and typesetting industry.", 20));

var_dump(truncate("Lorem Ipsum\nis simply dummy text of the printing and typesetting industry.", 20)); 
```

**结果**

```
/* 
string(36) "0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"  
string(14) "Lorem Ipsum is" 
string(14) "Lorem Ipsum
is" 
*/ 
```

结果使用`wordwrap($string, $width)`或`strtok(wordwrap($string, $width), "\n")`

```
/*
string(14) "Lorem Ipsum is"
string(11) "Lorem Ipsum"
*/ 
```

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2020-12-02T03:42:07.257

```
// a looonnng string ...
$str = "Le Lorem Ipsum est simplement du 
faux texte employé dans la composition et 
la mise en page avant impression. 
Le Lorem Ipsum est le faux texte standard de 
l'imprimerie depuis les années 1500, quand un 
imprimeur anonyme assembla ensemble des morceaux 
de texte pour réaliser un livre spécimen de polices
de texte. Il n'a pas fait que survivre cinq siècles,
mais s'est aussi adapté à la bureautique informatique,
sans que son contenu n'en soit modifié. Il a été 
popularisé dans les années 1960 grâce à la vente 
de feuilles Letraset contenant des passages du
Lorem Ipsum, et, plus récemment, par son inclusion 
dans des applications de mise en page de texte, 
comme Aldus PageMaker";
// number chars to cut
$number_to_cut = 300;
// string truncated in one line !
$truncated_string = 
substr($str, 0, strrpos(substr($str, 0, $number_to_cut), ' '));
// test return
echo $truncated_string;

// variation (add ellipsis) : echo $truncated_string.' ...';

// output :
/* Le Lorem Ipsum est simplement du 
faux texte employé dans la composition et 
la mise en page avant impression. 
Le Lorem Ipsum est le faux texte standard de 
l'imprimerie depuis les années 1500, quand un 
imprimeur anonyme assembla ensemble des morceaux 
de texte pour réaliser un livre
*/ 
```

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2013-02-26T12:48:07.903

我知道这是旧的，但是...

```
function _truncate($str, $limit) {
    if(strlen($str) < $limit)
        return $str;
    $uid = uniqid();
    return array_shift(explode($uid, wordwrap($str, $limit, $uid)));
} 
```

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2015-06-24T15:03:34.273

我创建了一个更类似于 substr 的函数，并使用了@Dave 的想法。

```
function substr_full_word($str, $start, $end){
    $pos_ini = ($start == 0) ? $start : stripos(substr($str, $start, $end), ' ') + $start;
    if(strlen($str) > $end){ $pos_end = strrpos(substr($str, 0, ($end + 1)), ' '); } // IF STRING SIZE IS LESSER THAN END
    if(empty($pos_end)){ $pos_end = $end; } // FALLBACK
    return substr($str, $pos_ini, $pos_end);
} 
```

Ps.：全长切割可能小于substr。

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2016-01-28T12:04:21.283

[在Dave](https://stackoverflow.com/a/4665347/2321998)和[AmalMurali](https://stackoverflow.com/questions/79960/how-to-truncate-a-string-in-php-to-the-word-closest-to-a-certain-number-of-chara/4665347#comment36125374_4665347)的代码中添加了 IF/ELSEIF 语句，用于处理不带空格的字符串

```
if ((strpos($string, ' ') !== false) && (strlen($string) > 200)) { 
    $WidgetText = substr($string, 0, strrpos(substr($string, 0, 200), ' ')); 
} 
elseif (strlen($string) > 200) {
    $WidgetText = substr($string, 0, 200);
} 
```

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2018-05-11T11:00:25.630

我发现这行得通：

```
function abbreviate_string_to_whole_word($string, $max_length, $buffer) {
    if (strlen($string) > $max_length) {
        $string_cropped = substr($string, 0, $max_length - $buffer);
        $last_space = strrpos($string_cropped, " ");
        if ($last_space > 0) {
            $string_cropped = substr($string_cropped, 0, $last_space);
        }
        $abbreviated_string = $string_cropped . "&nbsp;...";
    }
    else {
        $abbreviated_string = $string;
    }
    return $abbreviated_string;
} 
```

缓冲区允许您调整返回字符串的长度。

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2021-10-11T20:24:52.883

> 据我所知，这里所有的解决方案都只对起点固定的情况有效。
> 
> 允许你打开这个：
> 
> ```
> Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna liqua. Ut enim ad minim veniam. 
> ```
> 
> 进入这个：
> 
> ```
> Lorem ipsum dolor sit amet, consectetur... 
> ```
> 
> ### 如果您想截断一组特定关键字周围的单词怎么办？

# 截断一组特定关键字周围的文本。

目标是能够转换它：

```
Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna liqua. Ut enim ad minim veniam. 
```

进入这个：

```
...consectetur adipisicing elit, sed do eiusmod tempor... 
```

这是显示搜索结果、摘录等时非常常见的情况。要实现这一点，我们可以结合使用这两种方法：

```
 /**
     * Return the index of the $haystack matching $needle,
     * or NULL if there is no match.
     *
     * This function is case-insensitive  
     * 
     * @param string $needle
     * @param array $haystack
     * @return false|int
     */
    function regexFindInArray(string $needle, array $haystack): ?int
    {
        for ($i = 0; $i < count($haystack); $i++) {
            if (preg_match('/' . preg_quote($needle) . '/i', $haystack[$i]) === 1) {
                return $i;
            }
        }
        return null;
    }

    /**
     * If the keyword is not present, it returns the maximum number of full 
     * words that the max number of characters provided by $maxLength allow,
     * starting from the left.
     *
     * If the keyword is present, it adds words to both sides of the keyword
     * keeping a balanace between the length of the suffix and the prefix.
     *
     * @param string $text
     * @param string $keyword
     * @param int $maxLength
     * @param string $ellipsis
     * @return string
     */
    function truncateWordSurroundingsByLength(string $text, string $keyword, 
            int $maxLength, string $ellipsis): string
    {
        if (strlen($text) < $maxLength) {
            return $text;
        }

        $pattern = '/' . '^(.*?)\s' .
                   '([^\s]*' . preg_quote($keyword) . '[^\s]*)' .
                   '\s(.*)$' . '/i';
        preg_match($pattern, $text, $matches);

        // break everything into words except the matching keywords, 
        // which can contain spaces
        if (count($matches) == 4) {
            $words = preg_split("/\s+/", $matches[1], -1, PREG_SPLIT_NO_EMPTY);
            $words[] = $matches[2];
            $words = array_merge($words, 
                              preg_split("/\s+/", $matches[3], -1, PREG_SPLIT_NO_EMPTY));
        } else {
            $words = preg_split("/\s+/", $text, -1, PREG_SPLIT_NO_EMPTY);
        }

        // find the index of the matching word
        $firstMatchingWordIndex = regexFindInArray($keyword, $words) ?? 0;

        $length = false;
        $prefixLength = $suffixLength = 0;
        $prefixIndex = $firstMatchingWordIndex - 1;
        $suffixIndex = $firstMatchingWordIndex + 1;

        // Initialize the text with the matching word
        $text = $words[$firstMatchingWordIndex];

        while (($prefixIndex >= 0 or $suffixIndex <= count($words))
                and strlen($text) < $maxLength and strlen($text) !== $length) {
            $length = strlen($text);
            if (isset($words[$prefixIndex])
                and (strlen($text) + strlen($words[$prefixIndex]) <= $maxLength)
                and ($prefixLength <= $suffixLength 
                     or strlen($text) + strlen($words[$suffixIndex]) <= $maxLength)) {
                $prefixLength += strlen($words[$prefixIndex]);
                $text = $words[$prefixIndex] . ' ' . $text;
                $prefixIndex--;
            }
            if (isset($words[$suffixIndex])
                and (strlen($text) + strlen($words[$suffixIndex]) <= $maxLength)
                and ($suffixLength <= $prefixLength 
                     or strlen($text) + strlen($words[$prefixIndex]) <= $maxLength)) {
                $suffixLength += strlen($words[$suffixIndex]);
                $text = $text . ' ' . $words[$suffixIndex];
                $suffixIndex++;
            }
        }

        if ($prefixIndex > 0) {
            $text = $ellipsis . ' ' . $text;
        }
        if ($suffixIndex < count($words)) {
            $text = $text . ' ' . $ellipsis;
        }

        return $text;
    } 
```

现在你可以这样做：

```
$text = 'Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do' .
        'iusmod tempor incididunt ut labore et dolore magna liqua. Ut enim' .
        'ad minim veniam.';

$text = truncateWordSurroundingsByLength($text, 'elit', 25, '...');

var_dump($text); // string(32) "... adipisicing elit, sed do ..." 
```

[运行代码](http://sandbox.onlinephpfunctions.com/code/4f8a17dba1b7937c00a496424731b17917b9af9e)。

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2021-12-18T18:51:10.433

```
function trunc($phrase, $max_words) {
       $phrase_array = explode(' ',$phrase);
       if(count($phrase_array) > $max_words && $max_words > 0)
          $phrase = implode(' ',array_slice($phrase_array, 0, $max_words)).'...';
       return $phrase;
    } 
```

* * *

## 回答 #27

> 赞同：-1
> 
> 时间：2014-02-09T13:24:07.727

我以前用过这个

```
<?php
    $your_desired_width = 200;
    $string = $var->content;
    if (strlen($string) > $your_desired_width) {
        $string = wordwrap($string, $your_desired_width);
        $string = substr($string, 0, strpos($string, "\n")) . " More...";
    }
    echo $string;
?> 
```

* * *

## 回答 #28

> 赞同：-1
> 
> 时间：2018-03-09T13:26:34.837

我相信这是最简单的方法：

```
$lines = explode('♦♣♠',wordwrap($string, $length, '♦♣♠'));
$newstring = $lines[0] . ' &bull; &bull; &bull;'; 
```

我正在使用特殊字符来分割文本并剪切它。

* * *

## 回答 #29

> 赞同：-1
> 
> 时间：2018-12-22T09:01:22.303

用这个：

以下代码将删除“，”。如果您有任何其他字符或子字符串，您可以使用它来代替 ','

```
substr($string, 0, strrpos(substr($string, 0, $comparingLength), ',')) 
```

// 如果你有另一个字符串帐户

```
substr($string, 0, strrpos(substr($string, 0, $comparingLength-strlen($currentString)), ',')) 
```

* * *

## 回答 #30

> 赞同：-2
> 
> 时间：2014-04-01T10:32:13.767

可能这会帮助某人：

```
<?php

    $string = "Your line of text";
    $spl = preg_match("/([, \.\d\-''\"\"_()]*\w+[, \.\d\-''\"\"_()]*){50}/", $string, $matches);
    if (isset($matches[0])) {
        $matches[0] .= "...";
        echo "<br />" . $matches[0];
    } else {
        echo "<br />" . $string;
    }

?> 
```

* * *

## 回答 #31

> 赞同：-2
> 
> 时间：2015-08-26T12:46:05.160

在这里你可以试试这个

```
substr( $str, 0, strpos($str, ' ', 200) ); 
```

# python - 在 Python 中用空格分割字符串——保留带引号的子字符串

> ID：79968
> 
> 赞同：312
> 
> 时间：2008-09-17T04:25:15.710
> 
> 标签：python, regex

我有一个这样的字符串：

```
this is "a test" 
```

我正在尝试在 Python 中编写一些东西来按空格分割它，同时忽略引号内的空格。我正在寻找的结果是：

```
['this','is','a test'] 
```

PS。我知道你会问“如果引号中有引号会发生什么，好吧，在我的应用程序中，这永远不会发生。

* * *

## 回答 #1

> 赞同：474
> 
> 时间：2008-09-17T04:27:32.240

您想要`split`，来自内置[`shlex`](https://docs.python.org/library/shlex.html)模块。

```
>>> import shlex
>>> shlex.split('this is "a test"')
['this', 'is', 'a test'] 
```

这应该完全符合您的要求。

* * *

## 回答 #2

> 赞同：69
> 
> 时间：2008-09-17T04:27:59.730

看看`shlex`模块，特别是`shlex.split`.

```
>>> import shlex
>>> shlex.split('This is "a test"')
['This', 'is', 'a test'] 
```

* * *

## 回答 #3

> 赞同：45
> 
> 时间：2009-02-07T23:17:26.980

我在这里看到看起来复杂和/或错误的正则表达式方法。这让我感到惊讶，因为正则表达式语法可以很容易地描述“空格或被引号包围的东西”，并且大多数正则表达式引擎（包括 Python 的）都可以在正则表达式上拆分。因此，如果您要使用正则表达式，为什么不直接说出您的意思呢？：

```
test = 'this is "a test"'  # or "this is 'a test'"
# pieces = [p for p in re.split("( |[\\\"'].*[\\\"'])", test) if p.strip()]
# From comments, use this:
pieces = [p for p in re.split("( |\\\".*?\\\"|'.*?')", test) if p.strip()] 
```

解释：

```
[\\\"'] = double-quote or single-quote
.* = anything
( |X) = space or X
.strip() = remove space and empty-string separators 
```

不过，shlex 可能会提供更多功能。

* * *

## 回答 #4

> 赞同：32
> 
> 时间：2009-02-08T02:18:46.410

根据您的用例，您可能还想查看该[`csv`](https://docs.python.org/library/csv.html)模块：

```
import csv
lines = ['this is "a string"', 'and more "stuff"']
for row in csv.reader(lines, delimiter=" "):
    print(row) 
```

输出：

```
['this', 'is', 'a string']
['and', 'more', 'stuff'] 
```

* * *

## 回答 #5

> 赞同：16
> 
> 时间：2014-04-18T13:29:10.143

我使用 shlex.split 处理 70,000,000 行 squid 日志，太慢了。所以我切换到re。

如果你对 shlex 有性能问题，请试试这个。

```
import re

def line_split(line):
    return re.findall(r'[^"\s]\S*|".+?"', line) 
```

* * *

## 回答 #6

> 赞同：10
> 
> 时间：2018-11-08T15:21:24.610

似乎出于性能原因`re`更快。这是我使用保留外引号的最小贪心运算符的解决方案：

```
re.findall("(?:\".*?\"|\S)+", s) 
```

结果：

```
['this', 'is', '"a test"'] 
```

`aaa"bla blub"bbb`由于这些标记没有用空格分隔，因此它会将类似的结构放在一起。如果字符串包含转义字符，则可以这样匹配：

```
>>> a = "She said \"He said, \\\"My name is Mark.\\\"\""
>>> a
'She said "He said, \\"My name is Mark.\\""'
>>> for i in re.findall("(?:\".*?[^\\\\]\"|\S)+", a): print(i)
...
She
said
"He said, \"My name is Mark.\"" 
```

请注意，这也`""`通过`\S`模式的一部分匹配空字符串。

* * *

## 回答 #7

> 赞同：9
> 
> 时间：2018-07-27T14:53:46.983

被接受的`shlex`方法的主要问题是它不会忽略引用子字符串之外的转义字符，并且在某些极端情况下会产生一些意外的结果。

我有以下用例，其中我需要一个拆分函数来拆分输入字符串，以便保留单引号或双引号子字符串，并能够在此类子字符串中转义引号。不带引号的字符串中的引号不应与任何其他字符区别对待。一些具有预期输出的示例测试用例：

```
输入字符串 | 预期产出
================================================
 'abc def' | ['abc', 'def']
 "abc \\s def" | ['abc', '\\s', 'def']
 '"abc def" ghi' | ['abc def', 'ghi']
 "'abc def' ghi" | ['abc def', 'ghi']
 '"abc \\" def" ghi' | ['abc " def', 'ghi']
 "'abc \\' def' ghi" | [“abc'def”，'ghi']
 "'abc \\s def' ghi" | ['abc \\s def', 'ghi']
 '"abc \\s def" ghi' | ['abc \\s def', 'ghi']
 '"" 测试' | [''， '测试']
 "'' 测试" | [''， '测试']
 "abc'def" | [“abc'def”]
 "abc'def'" | ["abc'def'"]
 "abc'def' ghi" | ["abc'def'", 'ghi']
 "abc'def'ghi" | [“abc'def'ghi”]
 'abc"def' | ['abc"def']
 'abc“定义”' | ['abc“定义”']
 'abc"def" ghi' | ['abc"def"', 'ghi']
 'abc"def"ghi' | ['abc"def"ghi']
 "r'AA'r'.*_xyz$'" | ["r'AA'", "r'.*_xyz$'"]
 'abc"def ghi"' | ['abc"def ghi"']
 'abc"def ghi""jkl"' | ['abc"def ghi""jkl"']
 'a"b c"d"e"f"g h"' | ['a"b c"d"e"f"g h"']
 'c="ls /" 键入键' | ['c="ls /"', '类型', '键']
 "abc'def ghi'" | ["abc'def ghi'"]
 "c='ls /' 键入键" | ["c='ls /'", '类型', '键']
```

我最终使用以下函数来拆分字符串，以便所有输入字符串的预期输出结果：

```
import re

def quoted_split(s):
    def strip_quotes(s):
        if s and (s[0] == '"' or s[0] == "'") and s[0] == s[-1]:
            return s[1:-1]
        return s
    return [strip_quotes(p).replace('\\"', '"').replace("\\'", "'") \
            for p in re.findall(r'(?:[^"\s]*"(?:\\.|[^"])*"[^"\s]*)+|(?:[^\'\s]*\'(?:\\.|[^\'])*\'[^\'\s]*)+|[^\s]+', s)] 
```

它不漂亮；但它有效。以下测试应用程序检查其他方法（`shlex`以及`csv`现在）和自定义拆分实现的结果：

```
#!/bin/python2.7

import csv
import re
import shlex

from timeit import timeit

def test_case(fn, s, expected):
    try:
        if fn(s) == expected:
            print '[ OK ] %s -> %s' % (s, fn(s))
        else:
            print '[FAIL] %s -> %s' % (s, fn(s))
    except Exception as e:
        print '[FAIL] %s -> exception: %s' % (s, e)

def test_case_no_output(fn, s, expected):
    try:
        fn(s)
    except:
        pass

def test_split(fn, test_case_fn=test_case):
    test_case_fn(fn, 'abc def', ['abc', 'def'])
    test_case_fn(fn, "abc \\s def", ['abc', '\\s', 'def'])
    test_case_fn(fn, '"abc def" ghi', ['abc def', 'ghi'])
    test_case_fn(fn, "'abc def' ghi", ['abc def', 'ghi'])
    test_case_fn(fn, '"abc \\" def" ghi', ['abc " def', 'ghi'])
    test_case_fn(fn, "'abc \\' def' ghi", ["abc ' def", 'ghi'])
    test_case_fn(fn, "'abc \\s def' ghi", ['abc \\s def', 'ghi'])
    test_case_fn(fn, '"abc \\s def" ghi', ['abc \\s def', 'ghi'])
    test_case_fn(fn, '"" test', ['', 'test'])
    test_case_fn(fn, "'' test", ['', 'test'])
    test_case_fn(fn, "abc'def", ["abc'def"])
    test_case_fn(fn, "abc'def'", ["abc'def'"])
    test_case_fn(fn, "abc'def' ghi", ["abc'def'", 'ghi'])
    test_case_fn(fn, "abc'def'ghi", ["abc'def'ghi"])
    test_case_fn(fn, 'abc"def', ['abc"def'])
    test_case_fn(fn, 'abc"def"', ['abc"def"'])
    test_case_fn(fn, 'abc"def" ghi', ['abc"def"', 'ghi'])
    test_case_fn(fn, 'abc"def"ghi', ['abc"def"ghi'])
    test_case_fn(fn, "r'AA' r'.*_xyz$'", ["r'AA'", "r'.*_xyz$'"])
    test_case_fn(fn, 'abc"def ghi"', ['abc"def ghi"'])
    test_case_fn(fn, 'abc"def ghi""jkl"', ['abc"def ghi""jkl"'])
    test_case_fn(fn, 'a"b c"d"e"f"g h"', ['a"b c"d"e"f"g h"'])
    test_case_fn(fn, 'c="ls /" type key', ['c="ls /"', 'type', 'key'])
    test_case_fn(fn, "abc'def ghi'", ["abc'def ghi'"])
    test_case_fn(fn, "c='ls /' type key", ["c='ls /'", 'type', 'key'])

def csv_split(s):
    return list(csv.reader([s], delimiter=' '))[0]

def re_split(s):
    def strip_quotes(s):
        if s and (s[0] == '"' or s[0] == "'") and s[0] == s[-1]:
            return s[1:-1]
        return s
    return [strip_quotes(p).replace('\\"', '"').replace("\\'", "'") for p in re.findall(r'(?:[^"\s]*"(?:\\.|[^"])*"[^"\s]*)+|(?:[^\'\s]*\'(?:\\.|[^\'])*\'[^\'\s]*)+|[^\s]+', s)]

if __name__ == '__main__':
    print 'shlex\n'
    test_split(shlex.split)
    print

    print 'csv\n'
    test_split(csv_split)
    print

    print 're\n'
    test_split(re_split)
    print

    iterations = 100
    setup = 'from __main__ import test_split, test_case_no_output, csv_split, re_split\nimport shlex, re'
    def benchmark(method, code):
        print '%s: %.3fms per iteration' % (method, (1000 * timeit(code, setup=setup, number=iterations) / iterations))
    benchmark('shlex', 'test_split(shlex.split, test_case_no_output)')
    benchmark('csv', 'test_split(csv_split, test_case_no_output)')
    benchmark('re', 'test_split(re_split, test_case_no_output)') 
```

输出：

```
shlex

[确定] abc def -> ['abc', 'def']
[失败] abc \s def -> ['abc', 's', 'def']
[确定]“abc def”ghi->['abc def'，'ghi']
[ 好 ] 'abc def' ghi -> ['abc def', 'ghi']
[确定]“abc\”def“ghi->['abc“def'，'ghi']
[失败] 'abc \' def' ghi -> 异常：没有结束引号
[ OK ] 'abc \s def' ghi -> ['abc \\s def', 'ghi']
[ 好 ] "abc \s def" ghi -> ['abc \\s def', 'ghi']
[确定]“”测试-> [''，'测试']
[确定]''测试-> [''，'测试']
[失败] abc'def -> 异常：没有结束引号
[失败] abc'def' -> ['abcdef']
[失败] abc'def' ghi -> ['abcdef', 'ghi']
[失败] abc'def'ghi -> ['abcdefghi']
[失败] abc"def -> 异常：没有结束引号
[失败] abc"def" -> ['abcdef']
[失败] abc"def" ghi -> ['abcdef', 'ghi']
[失败] abc"def"ghi -> ['abcdefghi']
[失败] r'AA' r'.*_xyz$' -> ['rAA', 'r.*_xyz$']
[失败] abc"def ghi" -> ['abcdef ghi']
[失败] abc"def ghi""jkl" -> ['abcdef ghijkl']
[失败] a"b c"d"e"f"g h" -> ['ab cdefg h']
[失败] c="ls /" 键入键 -> ['c=ls /', 'type', 'key']
[失败] abc'def ghi' -> ['abcdef ghi']
[失败] c='ls /' 键入键 -> ['c=ls /', 'type', 'key']

CSV

[确定] abc def -> ['abc', 'def']
[ 好 ] abc \s def -> ['abc', '\\s', 'def']
[确定]“abc def”ghi->['abc def'，'ghi']
[失败] 'abc def' ghi -> ["'abc", "def'", 'ghi']
[失败] "abc \" def" ghi -> ['abc \\', 'def"', 'ghi']
[失败] 'abc \' def' ghi -> ["'abc", "\\'", "def'", 'ghi']
[失败] 'abc \s def' ghi -> ["'abc", '\\s', "def'", 'ghi']
[ 好 ] "abc \s def" ghi -> ['abc \\s def', 'ghi']
[确定]“”测试-> [''，'测试']
[失败]''测试-> [“''”，'测试']
[ 好 ] abc'def -> ["abc'def"]
[确定] abc'def'-> [“abc'def'”]
[OK] abc'def' ghi -> ["abc'def'", 'ghi']
[确定] abc'def'ghi -> [“abc'def'ghi”]
[确定] abc"def -> ['abc"def']
[确定] abc“def”-> ['abc“def”']
[确定] abc"def" ghi -> ['abc"def"', 'ghi']
[确定] abc"def"ghi -> ['abc"def"ghi']
[确定] r'AA' r'.*_xyz$' -> ["r'AA'", "r'.*_xyz$'"]
[失败] abc"def ghi" -> ['abc"def', 'ghi"']
[失败] abc"def ghi""jkl" -> ['abc"def', 'ghi""jkl"']
[失败] a"b c"d"e"f"g h" -> ['a"b', 'c"d"e"f"g', 'h"']
[失败] c="ls /" 键入键-> ['c="ls', '/"', 'type', 'key']
[失败] abc'def ghi' -> ["abc'def", "ghi'"]
[失败] c='ls /' 类型键 -> ["c='ls", "/'", 'type', 'key']

关于

[确定] abc def -> ['abc', 'def']
[ 好 ] abc \s def -> ['abc', '\\s', 'def']
[确定]“abc def”ghi->['abc def'，'ghi']
[ 好 ] 'abc def' ghi -> ['abc def', 'ghi']
[确定]“abc\”def“ghi->['abc“def'，'ghi']
[确定]'abc\'def'ghi->[“abc'def”，'ghi']
[ OK ] 'abc \s def' ghi -> ['abc \\s def', 'ghi']
[ 好 ] "abc \s def" ghi -> ['abc \\s def', 'ghi']
[确定]“”测试-> [''，'测试']
[确定]''测试-> [''，'测试']
[ 好 ] abc'def -> ["abc'def"]
[确定] abc'def'-> [“abc'def'”]
[OK] abc'def' ghi -> ["abc'def'", 'ghi']
[确定] abc'def'ghi -> [“abc'def'ghi”]
[确定] abc"def -> ['abc"def']
[确定] abc“def”-> ['abc“def”']
[确定] abc"def" ghi -> ['abc"def"', 'ghi']
[确定] abc"def"ghi -> ['abc"def"ghi']
[确定] r'AA' r'.*_xyz$' -> ["r'AA'", "r'.*_xyz$'"]
[确定] abc"def ghi" -> ['abc"def ghi"']
[确定] abc"def ghi""jkl" -> ['abc"def ghi""jkl"']
[确定] a"b c"d"e"f"g h" -> ['a"b c"d"e"f"g h"']
[ OK ] c="ls /" 键入键-> ['c="ls /"', 'type', 'key']
[OK] abc'def ghi' -> ["abc'def ghi'"]
[ OK ] c='ls /' 键入键 -> ["c='ls /'", 'type', 'key']

shlex：每次迭代 0.335ms
csv：每次迭代 0.036 毫秒
回复：每次迭代 0.068 毫秒

```

所以性能要好得多`shlex`，并且可以通过预编译正则表达式进一步提高，在这种情况下，它将优于该`csv`方法。

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2008-09-17T06:08:38.160

由于这个问题是用正则表达式标记的，所以我决定尝试一种正则表达式方法。我首先用 \x00 替换引号部分中的所有空格，然后用空格分隔，然后将 \x00 替换回每个部分中的空格。

两个版本都做同样的事情，但 splitter 比 splitter2 更易读。

```
import re

s = 'this is "a test" some text "another test"'

def splitter(s):
    def replacer(m):
        return m.group(0).replace(" ", "\x00")
    parts = re.sub('".+?"', replacer, s).split()
    parts = [p.replace("\x00", " ") for p in parts]
    return parts

def splitter2(s):
    return [p.replace("\x00", " ") for p in re.sub('".+?"', lambda m: m.group(0).replace(" ", "\x00"), s).split()]

print splitter2(s) 
```

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2018-04-12T08:28:50.937

不同答案的速度测试：

```
import re
import shlex
import csv

line = 'this is "a test"'

%timeit [p for p in re.split("( |\\\".*?\\\"|'.*?')", line) if p.strip()]
100000 loops, best of 3: 5.17 µs per loop

%timeit re.findall(r'[^"\s]\S*|".+?"', line)
100000 loops, best of 3: 2.88 µs per loop

%timeit list(csv.reader([line], delimiter=" "))
The slowest run took 9.62 times longer than the fastest. This could mean that an intermediate result is being cached.
100000 loops, best of 3: 2.4 µs per loop

%timeit shlex.split(line)
10000 loops, best of 3: 50.2 µs per loop 
```

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2017-03-26T23:08:09.597

要保留引号，请使用此功能：

```
def getArgs(s):
    args = []
    cur = ''
    inQuotes = 0
    for char in s.strip():
        if char == ' ' and not inQuotes:
            args.append(cur)
            cur = ''
        elif char == '"' and not inQuotes:
            inQuotes = 1
            cur += char
        elif char == '"' and inQuotes:
            inQuotes = 0
            cur += char
        else:
            cur += char
    args.append(cur)
    return args 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2010-01-29T01:36:23.620

嗯，似乎找不到“回复”按钮......无论如何，这个答案是基于 Kate 的方法，但正确地将字符串拆分为包含转义引号的子字符串，并且还删除了子字符串的开始和结束引号：

```
 [i.strip('"').strip("'") for i in re.split(r'(\s+|(?<!\\)".*?(?<!\\)"|(?<!\\)\'.*?(?<!\\)\')', string) if i.strip()] 
```

这适用于字符串`'This is " a \\\"test\\\"\\\'s substring"'`（不幸的是，疯狂的标记对于防止 Python 删除转义是必要的）。

如果不需要返回列表中的字符串中的结果转义，您可以使用该函数的这个稍作改动的版本：

```
[i.strip('"').strip("'").decode('string_escape') for i in re.split(r'(\s+|(?<!\\)".*?(?<!\\)"|(?<!\\)\'.*?(?<!\\)\')', string) if i.strip()] 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2012-06-25T17:51:17.063

为了解决某些 Python 2 版本中的 unicode 问题，我建议：

```
from shlex import split as _split
split = lambda a: [b.decode('utf-8') for b in _split(a.encode('utf-8'))] 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2020-03-30T11:49:43.317

作为一个选项尝试 tssplit：

```
In [1]: from tssplit import tssplit
In [2]: tssplit('this is "a test"', quote='"', delimiter='')
Out[2]: ['this', 'is', 'a test'] 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2015-09-09T13:19:59.330

我建议：

测试字符串：

```
s = 'abc "ad" \'fg\' "kk\'rdt\'" zzz"34"zzz "" \'\'' 
```

还捕获“”和“”：

```
import re
re.findall(r'"[^"]*"|\'[^\']*\'|[^"\'\s]+',s) 
```

结果：

```
['abc', '"ad"', "'fg'", '"kk\'rdt\'"', 'zzz', '"34"', 'zzz', '""', "''"] 
```

忽略空的“”和“”：

```
import re
re.findall(r'"[^"]+"|\'[^\']+\'|[^"\'\s]+',s) 
```

结果：

```
['abc', '"ad"', "'fg'", '"kk\'rdt\'"', 'zzz', '"34"', 'zzz'] 
```

* * *

## 回答 #15

> 赞同：-3
> 
> 时间：2008-09-17T04:31:38.737

试试这个：

```
 def adamsplit(s):
    result = []
    inquotes = False
    for substring in s.split('"'):
      if not inquotes:
        result.extend(substring.split())
      else:
        result.append(substring)
      inquotes = not inquotes
    return result 
```

一些测试字符串：

```
'This is "a test"' -> ['This', 'is', 'a test']
'"This is \'a test\'"' -> ["This is 'a test'"] 
```

* * *

## 回答 #16

> 赞同：-3
> 
> 时间：2008-09-17T05:46:57.667

如果您不关心子字符串而不是简单的

```
>>> 'a short sized string with spaces '.split() 
```

表现：

```
>>> s = " ('a short sized string with spaces '*100).split() "
>>> t = timeit.Timer(stmt=s)
>>> print "%.2f usec/pass" % (1000000 * t.timeit(number=100000)/100000)
171.39 usec/pass 
```

或字符串模块

```
>>> from string import split as stringsplit; 
>>> stringsplit('a short sized string with spaces '*100) 
```

性能：字符串模块似乎比字符串方法执行得更好

```
>>> s = "stringsplit('a short sized string with spaces '*100)"
>>> t = timeit.Timer(s, "from string import split as stringsplit")
>>> print "%.2f usec/pass" % (1000000 * t.timeit(number=100000)/100000)
154.88 usec/pass 
```

或者你可以使用 RE 引擎

```
>>> from re import split as resplit
>>> regex = '\s+'
>>> medstring = 'a short sized string with spaces '*100
>>> resplit(regex, medstring) 
```

表现

```
>>> s = "resplit(regex, medstring)"
>>> t = timeit.Timer(s, "from re import split as resplit; regex='\s+'; medstring='a short sized string with spaces '*100")
>>> print "%.2f usec/pass" % (1000000 * t.timeit(number=100000)/100000)
540.21 usec/pass 
```

对于非常长的字符串，您不应将整个字符串加载到内存中，而是拆分行或使用迭代循环

# c++ - 为什么我不能在 VS.NET 调试器中单步执行剪贴板代码？

> ID：79992
> 
> 赞同：1
> 
> 时间：2008-09-17T04:28:45.733
> 
> 标签：c++, visual-studio, winapi, debugging, clipboard

理想情况下，读者已将本机 C++ 程序升级到 Visual Studio 2008，其中包含一个 OpenClipboard() 块。为什么不尝试在从 OpenClipboard() 获得成功的返回码并单步执行代码之后设置断点。根据互联网，它可能适用于您的系统，但当然，不适用于我的系统，感谢您的尝试。

谷歌搜索例如 (( OpenClipboard 1418 vc6 )) 会发现诸如“GetClipboardData 在调试器中失败”和“在 VC++6 中没有错误但在 VC++2005 中出错”之类的文章。目前实用，问题已解决 - 我根本无法在此类代码中设置断点，我需要存储信息并在剪贴板操作完成后设置断点。错误 1418 是“线程没有打开剪贴板”，但只要您不使用 VS.NET，它就可以正常工作，或者就像我说的，如果您将断点保留在剪贴板打开关闭块之外。

知道 VS.NET 调试器的确切问题是什么，我会感觉更好。

作为一个 C++ 人，我只是模糊地意识到在做 dot-Net 时你不应该考虑线程。无论如何，当您单步通过本机 C++ 代码时，我没有找到真正发生的事情的大师级解释，事实上问题是否在于 dot-Net 调试器以某种方式巧妙地干扰了线程信息。

系统方面：大约一年前，两个双核 Xeon，根据 XP-pro 的 4 个 CPU。我刚刚通过在 XP-SP2-32 位下的 vc6 中单步调试代码。所以我知道代码在 vc6 下非常好。但是，当我使用 10 兆字节的 CF_TEXT 进行测试时，我遇到了异常。我想尝试在 XP-x64 更好的异常模型下调试。

用visual-studio-2008重新编译，我根本无法让代码单步运行。OpenClipboard 工作，但 EnumClipboardFormats() 没有工作，单步时没有任何工作。但是，当我在完整的代码块下方设置断点时，一切正常。*YES* vc2008 对 szBuf 周围的堆栈帧损坏进行了精确诊断。vc2008 有很多值得喜欢的地方。如果这只是一个剪贴板问题，那就太好了 - 不知道我会被迫担心通过任何事情，线程上下文问题是否可能是由于 dot-Net-debugger。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-17T04:49:39.707

我从来没有调查过这个，但很容易猜到：

1.  [剪贴板是共享资源](http://blogs.msdn.com/oldnewthing/archive/2008/06/04/8572362.aspx)
2.  在任何给定时间点，只有一个应用程序（每个桌面）可以“拥有”剪贴板
3.  您的应用拥有它（调用后`OpenClipboard()`）
4.  VS 想要它（可能是因为它是一个编辑器）
5.  当您的应用程序在断点处停止时，再多的等待也不会找到不属于您的应用程序的剪贴板。
6.  欢闹接踵而至！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-02T11:41:56.450

不要浪费时间怀疑这是一个 .NET 的东西。有时，Visual Studio.NET 和 .NET 运行时之间的关系就像 ActiveX 和 ActiveDirectory - 它告诉您涉及到哪个营销商，Visual Studio.NET 实际上有许多调试器。本机、脚本或托管 - 只有后者真正与 .NET 相关。您将使用本机调试器。

如果您想进行调查，我建议使用 Microsoft Detours 挂钩 OpenClipboard，然后在调试器中运行您的应用程序。您将能够看到谁在争夺剪贴板。

# multicore - 您今天推荐哪种并行编程模型来利用明天的众核处理器？

> ID：79999
> 
> 赞同：46
> 
> 时间：2008-09-17T04:29:37.197
> 
> 标签：multicore, parallel-processing

如果您今天从头开始编写一个新应用程序，并希望它扩展到您明天可以投入使用的所有内核，您会选择哪种并行编程模型/系统/语言/库？为什么？

我对这些轴上的答案特别感兴趣：

1.  程序员生产力/易用性（凡人能成功使用吗？）
2.  目标应用领域（它（不）擅长什么问题？）
3.  并发风格（它是否支持任务、管道、数据并行、消息......？）
4.  可维护性/面向未来（20 年后还会有人使用它吗？）
5.  性能（它如何在什么样的硬件上扩展？）

我故意模糊应用程序的性质，以期获得对各种应用程序有用的良好一般答案。

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-09-17T15:10:10.417

多核编程实际上可能需要不止一种范式。目前的一些竞争者是：

1.  [映射减少](http://labs.google.com/papers/mapreduce.html)。这在问题可以很容易地分解为并行块的情况下效果很好。
2.  [嵌套数据并行](http://www.haskell.org/haskellwiki/GHC/Data_Parallel_Haskell)。这类似于 MapReduce，但实际上支持问题的递归分解，即使递归块的大小不规则。期待 NDP 在运行在大规模并行但有限的硬件（如 GPU）上的纯函数式语言中大获全胜。
3.  [软件事务内存](http://en.wikipedia.org/wiki/Software_transactional_memory)。如果您需要传统线程，STM 可以让它们变得可以忍受。您在关键部分付出了 50% 的性能损失，但您可以轻松地将复杂的锁定方案扩展到 100 多个处理器。但是，这不适用于分布式系统。
4.  [带有消息传递的并行对象线程](http://www.erlang.org/)。Erlang 使用了这个非常聪明的模型。每个“对象”都成为一个轻量级线程，对象通过异步消息和模式匹配进行通信。它基本上是真正的并行 OO。这在几个现实世界的应用程序中取得了很好的成功，并且对于不可靠的分布式系统非常有效。

其中一些范例可以为您提供最大的性能，但只有在问题完全分解时才有效。其他人牺牲了一些性能，但允许更广泛的算法。我怀疑以上的某种组合最终将成为标准工具包。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-09-17T05:04:04.133

我真正喜欢的两个解决方案是[加入微积分](http://Moscova.Inria.Fr/join/)（[JoCaml](http://JoCaml.Inria.Fr/)、[Polyphonic C#](http://Research.Microsoft.Com/~nick/polyphony/)、[Cω](http://Research.Microsoft.Com/COmega/)）和[演员模型](http://Wikipedia.Org/wiki/Actor_model)（[Erlang](http://Erlang.Org/)、[Scala](http://Scala-Lang.Org/)、[E](http://ERights.Org/)、[Io](http://IoLanguage.Com/)）。

我对[Software Transactional Memory](http://Wikipedia.Org/wiki/Software_transactional_memory)没有特别的印象。只是感觉它的存在只是为了让线程能够再坚持一段时间，即使它们应该在几十年前就死了。但是，它确实具有三个主要优点：

1.  人们了解数据库中的事务
2.  已经有关于事务性 RAM 硬件的讨论
3.  尽管我们都希望它们消失，但线程可能会在接下来的几十年中成为主要的并发模型，尽管这可能是可悲的。STM可以显着减轻疼痛。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-09-17T04:35:18.667

mapreduce/hadoop 范式很有用且相关。特别是对于那些习惯于 perl 之类的语言的人来说，映射数组并对每个元素执行一些操作的想法应该非常流畅和自然，而 mapreduce/hadoop 只是将它带到下一个阶段并说没有理由数组的每个元素都需要在同一台机器上处理。

从某种意义上说，它经受了更多的考验，因为谷歌正在使用 mapreduce，而且很多人一直在使用 hadoop，并且已经证明它可以很好地通过网络在多台机器上扩展应用程序。如果您可以跨网络扩展多台机器，则可以扩展单台机器中的多个内核。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2008-09-17T04:33:07.220

对于 .NET 应用程序，我选择“ [.NET Parallel Extensions (PLINQ)](http://msdn.microsoft.com/en-us/magazine/cc163329.aspx) ”，它非常易于使用，并且允许我在几分钟内并行化现有代码。

1.  学习很简单
2.  用于对大型对象数组执行复杂操作，因此无法评论其他应用程序
3.  支持任务和管道
4.  应该在未来几年内得到支持，但谁知道呢？
5.  CTP 版本有一些性能问题，但看起来已经很有希望了。

Mono[可能会获得](http://tirania.org/blog/archive/2008/Jul-26-1.html)对 PLINQ 的支持，因此它也可能是一个跨平台的解决方案。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-09-17T04:46:01.103

对于繁重的计算等，像[Haskell](http://www.haskell.org/)这样的纯函数式语言很容易[并行化](http://www.macs.hw.ac.uk/~dsg/gph/)，而不需要程序员的任何努力。除了学习 Haskell，就是这样。

但是，我不认为这是（不远的）未来的方式，仅仅是因为太多的程序员太习惯于命令式编程范式。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-09-18T01:20:15.630

[kamaelia](http://www.kamaelia.org/Home)是一个**python 框架**，用于构建具有大量通信进程的应用程序。

> # ![](https://i.stack.imgur.com/I1E9Z.png)Kamaelia - 并发变得有用、有趣
> 
> 在 Kamaelia 中，您可以使用**相互通信的简单组件**构建系统。这加快了开发速度，极大地帮助了维护，还意味着您可以**构建自然并发的软件**。它旨在供**任何**开发人员访问，包括新手。它也让它变得有趣:)
> 
> 什么样的系统？网络服务器、客户端、桌面应用程序、基于 pygame 的游戏、转码系统和管道、数字电视系统、垃圾邮件根除器、教学工具等等 :)

另请参阅问题[多核和并发 - 语言、库和开发技术](https://stackoverflow.com/questions/121674/multi-core-and-concurrency-languages-libraries-and-development-techniques)

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-09-17T04:36:19.957

我打赌用承诺来传达事件循环，正如在[Twisted](http://twistedmatrix.com)、[E](http://erights.org)、[AmbientTalk](http://prog.vub.ac.be/amop/start)等系统中实现的那样。它们保留了编写具有与非并发/并行应用程序相同的执行模型假设的代码的能力，但可以扩展到分布式和并行系统。（这就是我在[Ecru](http://launchpad.net/ecru)上工作的原因。）

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-09-17T04:40:56.483

看看[二郎](http://www.erlang.org/)。谷歌它，并观看各种演示文稿和视频。我尊敬的许多程序员和架构师都非常喜欢它的可扩展性。我们在我工作量很大的地方使用它...

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-09-17T15:32:58.710

如前所述，纯函数式语言本质上是可并行的。然而，命令式语言对许多人来说更直观，而且我们深深植根于命令式遗留代码。基本问题是纯函数式语言显式表达副作用，而命令式语言通过语句顺序隐式表达副作用。

我相信以声明方式表达副作用的技术（例如，在面向对象的框架中）将允许编译器将命令式语句分解为它们的函数关系。这应该允许代码以与纯函数代码大致相同的方式自动并行化。

当然，就像今天仍然希望用汇编语言编写某些性能关键代码一样，明天仍然需要编写性能关键的显式并行代码。但是，我概述的技术应该有助于自动利用众核架构，而开发人员只需花费最少的精力。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-03-18T14:53:15.097

我很惊讶没有人建议 MPI（消息传递接口）。虽然是为分布式内存设计的，但具有必要且频繁的全局耦合（求解具有数十亿未知数的线性和非线性方程）的 MPI 程序已被证明可以扩展到 200k 个内核。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2009-06-02T15:55:15.020

这个问题似乎一直以不同的措辞出现——也许 StackOverflow 中有不同的选区。 [基于流的编程](http://www.jpaulmorrison.com/fbp/)(FBP) 是一种已经存在 30 多年的概念/方法，并被用于处理加拿大一家主要银行的大部分批处理。它在 Java 和 C# 中具有基于线程的实现，尽管早期的实现是基于光纤的（C++ 和大型机汇编器——银行使用的一种）。解决利用多核问题的大多数方法都涉及尝试采用传统的单线程程序并确定哪些部分可以并行运行。FBP 采用了不同的方法：应用程序从一开始就设计为多个异步运行的“黑盒”组件（想想制造装配线）。由于组件之间的接口是数据流，FBP本质上是语言无关的，因此支持混合语言应用，和特定领域的语言。出于同样的原因，副作用最小化。它也可以描述为“无共享”模型和 MOM（面向消息的中间件）。MapReduce 似乎是 FBP 的一个特例。FBP 与 Erlang 的主要区别在于 Erlang 在许多短寿命线程方面运行，因此绿色线程在那里更合适，而 FBP 使用较少（通常为几十到几百）寿命较长的线程。为一个 而 FBP 使用更少（通常是几十到几百）寿命更长的线程。为一个 而 FBP 使用更少（通常是几十到几百）寿命更长的线程。为一个*已经使用了 30 多年的批处理网络的一部分，请参阅*批处理*[网络的一部分](http://www.jpaulmorrison.com/fbp/image010.jpg)。有关交互式应用程序的高级设计，请参阅[经纪应用程序高级设计](http://www.jpaulmorrison.com/cgi-bin/wiki.pl?BrokerageApplication)。已经发现 FBP 可以产生更多可维护的应用程序，并缩短运行时间 - 即使在单核机器上也是如此！*

 ** * *

## 回答 #12

> 赞同：1
> 
> 时间：2011-05-10T00:27:31.000

并行编程 IMO 分为三个部分：识别并行度和指定并行度。识别=将算法分解为并发的工作块，指定=进行实际的编码/调试。识别与您将使用哪个框架来指定并行性无关，我认为框架对此没有多大帮助。它对您的应用程序、目标平台、常见的并行编程权衡（硬件延迟等）以及最重要的经验有很好的理解。但是可以讨论指定，这就是我尝试在下面回答的内容：

我尝试了许多框架（在学校和工作中）。既然您询问了多核，它们都是共享内存，我将坚持使用我使用过的三个共享内存框架。

Pthreads（它不是​​一个真正的框架，但绝对适用）：

优点：-Pthreads 非常通用。对我来说，pthread 就像是并行编程的集合。您可以在 pthread 中编写任何范例。- 它很灵活，因此您可以根据需要使其具有高性能。没有固有的限制可以减慢您的速度。您可以编写自己的构造和原语并获得尽可能快的速度。

缺点： - 要求您自己完成所有工作，例如管理工作队列、任务分配。- 实际的语法很丑陋，而且你的应用程序通常有很多额外的代码，这使得代码难以编写，然后又难以阅读。

开放式MP：

优点： - 代码看起来很干净，管道和任务拆分主要在引擎盖下 - 半灵活。它为您提供了几个有趣的工作安排选项

缺点： - 用于类似并行的简单 for 循环。（较新的英特尔版本也支持任务，但任务与 Cilk 相同）。- 底层结构可能会或可能不会为性能而精心编写。GNUs 的实现还可以。英特尔的 ICC 对我来说效果更好，但我宁愿自己写一些东西以获得更高的性能。

Cilk、英特尔 TBB、苹果 GCD：

优点： - 可证明是任务级并行的最佳底层算法 - 串行/并行任务的体面控制 - TBB 也有一个我使用的管道并行框架（坦率地说，这不是最好的） - 消除了大量编写的任务用于基于任务的系统的代码，如果您人手不足，这可能是一个很大的优势

缺点： - 对底层结构性能的控制较少。我知道英特尔 TBB 的底层数据结构性能很差，例如，工作队列很糟糕（我在 2008 年看到它时）。- 代码有时看起来很糟糕，包含他们希望你使用的所有关键字和流行语 - 需要阅读大量参考资料才能理解他们的“灵活”API

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-10-23T11:08:19.063

另请参阅问题[多核和并发 - 语言、库和开发技术](https://stackoverflow.com/questions/121674/multi-core-and-concurrency-languages-libraries-and-development-techniques)

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2009-06-02T16:48:07.447

具有多个工作人员系统的作业队列（不确定正确的术语 - 消息队列？）

为什么？

主要是因为这是一个非常简单的概念。你有一个需要处理的东西的列表，然后是一堆获取工作并处理它们的进程。

此外，与原因不同，例如，Haskell 或 Erlang 如此并发/可并行（？），它完全与语言无关 - 您可以用 C、Python 或任何其他语言（甚至使用 shell 脚本）轻松实现这样的系统，而我怀疑 bash 会很快获得软件事务内存或连接演算。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2008-09-17T04:59:33.350

如果您的问题域允许尝试考虑无共享模型。您在进程和线程之间共享的越少，您设计复杂的并发模型就越少。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2009-08-28T04:18:16.660

我真的很喜欢[Clojure](http://www.clojure.org)选择的模型。Clojure 使用不可变数据结构和软件事务内存的组合。

不可变的数据结构是永远不会改变的。可以使用修改后的数据创建新版本的结构，但如果您有一个指向数据结构的“指针”，它永远不会从您的下方改变。这很好，因为您可以访问该数据而不必担心并发问题。

软件事务内存在这些答案的其他地方进行了讨论，但足以说明它是一种机制，多个线程都可以对某些数据进行操作，如果它们发生冲突，则其中一个线程将回滚以重试。当存在碰撞风险但不太可能时，这允许更快的速度。

有一段来自作者 Rich Hickey 的[视频](http://clojure.blip.tv/file/812787)，其中包含更多细节。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2008-09-17T04:34:36.763

Qt concurrent 为多核提供了一个非常易于使用的 MapReduce 实现。它是多操作系统。

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2009-08-28T04:52:57.153

一条有价值的路径可能是[OpenCL](http://en.wikipedia.org/wiki/OpenCL)，它提供了一种跨异构计算资源分配某些类型的计算负载的方法，即相同的代码将在多核 CPU 和商品 GPU 上运行。ATI 最近发布了正是这样一个[工具链](http://ati.amd.com/technology/streamcomputing/opencl.html)。NVidia 的[CUDA](http://www.nvidia.com/object/cuda_home.html)工具链与此类似，但更受限制。Nvidia似乎也正在开发一个OpenCL [sdk](http://www.nvidia.com/object/cuda_opencl.html)

应该注意的是，在工作负载不具有数据并行性质的情况下，这可能无济于事，例如，它对典型的事务处理没有多大帮助。OpenCL 主要面向数学密集型计算类型，例如科学/工程模拟或金融建模。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2009-08-28T03:53:56.553

在过去的十年中，我们一直在使用[PARLANSE](http://www.semanticdesigns.com/Products/PARLANSE)，一种具有显式并发偏序规范的并行编程语言，来实现可扩展的程序分析和转换系统（[DMS Software Reengineering Toolkit](http://www.semanticdesigns.com/Products/DMS/DMSToolkit.html)) 主要进行符号计算而不是数字计算。PARLANSE 是一种编译的类 C 语言，具有传统的标量数据类型字符、整数、浮点数、动态数据类型字符串和数组、复合数据类型结构和联合以及词法范围的函数。虽然大多数语言都是 vanilla（操作数上的算术表达式、if-then-else 语句、do 循环、函数调用），但并行性不是。通过定义代码块（例如，a 之前 b、a 之前 c、d 之前 c）上的“在先”关系来表示并行性，写为

```
(|;  a  (... a's computation)
     (<< a) b ( ... b's computation ... )
     (<< a) c ( ....c's computation ...)
     (>> c) d ( ... d's computation...)
)|; 
```

<< 和 >> 运算符指的是“时间顺序”。PARLANSE 编译器可以看到这些并行计算并预分配计算颗粒 a、b、c、d 所需的所有结构，并生成自定义代码来启动/停止每个结构，从而最大限度地减少启动和停止这些并行颗粒的开销。

请参阅此链接以[*并行*](https://stackoverflow.com/questions/1862599/multithreading-puzzles/1866161#1866161)[迭代深化搜索 15-puzzle 的最优解](https://stackoverflow.com/questions/1862599/multithreading-puzzles/1866161#1866161)，这是 8-puzzle 的 4x4 老大哥。它仅使用*潜在*的并行作为并行结构 **(|| abcd ) ，表示计算***a* *b* *c* *d*没有偏序约束，但它也使用推测并异步中止无法找到解决方案的任务。它在一小段代码中包含了很多想法。[](https://stackoverflow.com/questions/1862599/multithreading-puzzles/1866161#1866161)

 *****PARLANSE 在多核 PC 上运行。一个大的 PARLANSE 程序（我们已经构建了许多超过 100 万行或更多的程序）将有数千个这样的偏序，其中一些调用包含其他的函数。到目前为止，我们在最多 8 个 CPU 上取得了不错的成绩，在最多 16 个 CPU 上取得了不错的回报，我们仍在调整系统。（我们认为当前 PC 上大量内核的真正问题是内存带宽：16 个内核冲击内存子系统会产生巨大的带宽需求）。

大多数其他语言没有公开并行性，因此很难找到，并且运行时系统通过使用通用调度原语来调度计算粒度付出了高昂的代价。我们认为这是灾难的根源，或者至少由于阿姆达尔定律而导致性能不佳：如果与工作相比，调度谷物的机器指令数量很大，那么您就不会高效。OTOH，如果您坚持使用具有许多机器指令的计算粒度来保持相对较低的调度成本，那么您将找不到独立的计算粒度，因此您没有任何有用的并行性来调度。所以 PARLANSE 背后的关键思想是最小化调度 grain 的成本，使 grain 可以很小，以便在实际代码中可以找到很多。

十年来，我们一直在研究这个问题。很难做到这一点。我看不出那些没有在这个时间框架内构建并行语言并使用/调整它们的人如何有很大的机会构建有效的并行系统。

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2010-05-23T19:23:46.870

> 如果您今天从头开始编写一个新应用程序，并希望它扩展到您明天可以投入使用的所有内核，您会选择哪种并行编程模型/系统/语言/库？

也许今天最广泛适用的是 Cilk 样式的任务队列（现在在 .NET 4 中可用）。它们非常适合使用分而治之的问题来解决，并且具有可预测的子任务复杂性（例如已知函数参数复杂性的并行`map`和`reduce`数组以及快速排序等算法），并且涵盖了许多实际问题。

此外，这仅适用于像今天的多核这样的共享内存架构。虽然我不相信这种基本架构会很快消失，但我确实相信它必须在某个时候与分布式并行性相结合。这可以是多核 CPU 上的多核集群的形式，在多核之间传递消息，或者是内核层次结构的形式，它们之间具有可预测的通信时间。这些将需要完全不同的编程模型才能获得最大效率，我相信对它们知之甚少。

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2008-10-23T11:18:27.063

Erlang 是更“成熟的解决方案”，并且是可移植和开源的。我摆弄着 Polyphonic C# ，我不知道每天用它编程会怎样。

几乎所有语言/操作系统都有库和扩展，谷歌事务内存。这是 MS 的一个有趣的方法。

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2008-09-17T04:34:56.793

我会使用 Java——它是可移植的，所以未来的处理器不会成为问题。我还将使用标准互斥例程作为库（减少并行代码的调试）对我的应用程序进行编码，将接口/逻辑和数据（更像是 3 层 Web 应用程序）的层分开。请记住，Web 服务器可以很好地扩展到许多处理器，并且是通往多核的最不痛苦的途径。或者查看旧的连接机器模型，它带有一个与数据绑定的虚拟处理器。**********