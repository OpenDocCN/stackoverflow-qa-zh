# StackOverflow 问答 000178000-000178999

# python - WSGI 中间件建议

> ID：178001
> 
> 赞同：3
> 
> 时间：2008-10-07T11:18:18.503
> 
> 标签：python, pylons, wsgi

我听说周围有很多有趣且有用的 WSGI 中间件。但是，我不确定哪些（除了那些是塔的一部分）有用且稳定。你最喜欢的 WSGI 中间件是什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-08T01:31:37.953

WSGI.org 有一个相当全面的[WSGI Middleware & Utilities](http://wsgi.org/wsgi/Middleware_and_Utilities)列表。

# c# - 模拟 <%#Bind(...) %>

> ID：178005
> 
> 赞同：0
> 
> 时间：2008-10-07T11:19:34.833
> 
> 标签：c#, asp.net, data-binding

ASP.NET：

在代码隐藏中，我可以`<%# Eval("Property")%>`通过调用来模拟`DataBinder.Eval(myObject,"Property");`

如何模拟对 的调用`<%# Bind("Property")%>`？

非常感谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-07T11:23:13.407

`DataBinder.`**`GetPropertyValue(`**`myObject,"Property"`**`)`**

# javascript - 在 Firefox 和 Internet Explorer 中使用 XPath 选择 HTML 元素的不同结果

> ID：178016
> 
> 赞同：6
> 
> 时间：2008-10-07T11:23:45.840
> 
> 标签：javascript, internet-explorer, xpath

我正在尝试在文档中选择特定的 HTML 元素，对于我只使用的 Firefox：

```
xpathobj = document.evaluate(xpath, document, null,
               XPathResult.FIRST_ORDERED_NODE_TYPE, null); 
```

效果很好。但是，当我尝试 IE equivilent 时：

```
xmlDoc=new ActiveXObject("Microsoft.XMLDOM");
xmlDoc.async=false;
xmlDoc.load(document);
xmlDoc.setProperty("SelectionLanguage", "XPath");
xpathobj = xmlDoc.selectNodes(xpath); 
```

我没有返回任何对象。所以我的问题是有一种简单的方法可以使用 XPath 在 IE 中获取我想要的元素吗？我使用的 XPath 看起来像

```
/HTML/BODY/DIV[9]/DIV[2] 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-07T11:31:49.257

看看[http://dev.abiss.gr/sarissa/](http://dev.abiss.gr/sarissa/)项目。他们已将大部分与 XML 相关的 API 迁移到 IE。否则它确实也很容易实现。您需要解决的问题是：将 HTML 序列化为有效的 XML，将 XMLDOM XPath 查询的结果与原始 HTMLDOM 同步。据我所知，他们已经在他们的库中完成了它，但是，它的性能可能会更好。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-02-02T11:34:10.263

问题可能在于 IE5+ 中的 [1] 实际上是 FF 中的 [2]。Microsoft 完全决定编号应该从 [0] 而不是 w3c 指定的 [1] 开始。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-08T12:25:24.687

嗨，最后我想出了我自己的狡猾的解决方案，任何关于改进它的建议都会非常感激。它利用了一些原型功能：

在 IE5+ 中使用“/HTML/BODY/DIV[9]/DIV[2]”形式的 xpath

函数getXPathElement（xpath，元素）{

```
//Specific to project, here i know that the body element will always have the id "top"
//but otherwise the element that is passed in should be first element in the xpath 
//statement eg. /HTML/BODY/DIV the element passed in should be HTML
if(!element){
    element = $("top");
    var xpathArrayIndex = 3;
} else {
    var xpathArrayIndex = 1;
}
//split the xpath statement up
var xpathArray = xpath.split("/");

var carryOn = true; 
while(carryOn){
    decendents = element.childElements();
    //check to see if we are at the end of the xpath statement
    if(xpathArrayIndex == xpathArray.length){
        return element;
    }
    //if there is only one decendent make it the next element
    if(decendents.size() == 1) {
        element = decendents.first();
    } else {
    //otherwise search the decendents for the next element
        element = getXPathElementByIndex(decendents, xpathArray[xpathArrayIndex]);
    }
    xpathArrayIndex++;
} 
```

}

函数getXPathElementByIndex（后代，xpathSegment）{

```
var decendentsArray = decendents.toArray();
//seperate the index from the element name
var temp = xpathSegment.split("[");
var elementName = temp[0];
//get the index as a number eg. "9]" to 9
var elementIndex = +temp[1].replace("]", "");
//the number of matching elements
var count = 0;

//keeps track of the number of iterations
var i = 0;
while(count != elementIndex) {
    //if the decendent's name matches the xpath element name increment the count
    if(decendentsArray[i].nodeName == elementName){
        count++;
    }
    i++;
}
var element = decendentsArray[i - 1];
return element; 
```

}

感谢大家的帮助，无论哪种方式，我都对各种 javascript 框架有所了解。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-07-20T03:50:54.373

oly1234 的代码中存在一些错误，我尝试修复如下：

```
function getXPathElement(xpath, element){
if(!element){
    element = document;
}
var xpathArray = xpath.split("/");

element = findXPathRoot(xpathArray[0],xpathArray[1],element);

for(var i=1; i<xpathArray.length; i++){
    if(xpathArray[i].toLowerCase()=="html"){
        continue;
    }
    if(!element){
        return element;
    }
    element = getXPathElementByIndex(element.childNodes,xpathArray[i]);         
}
return element;
}

function findXPathRoot(rootPath,htmlPath,element){
if(rootPath == ""&&htmlPath.toLowerCase() == "html"){
    return element.documentElement;
}
return document.getElementsByTagName(rootPath)[0];
}
function getXPathElementByIndex(decendents, xpathSegment){
//seperate the index from the element name
var temp = xpathSegment.split("[");
var elementName = temp[0];
//get the index as a number eg. "9]" to 9
if(temp[1]){
    var elementIndex = temp[1].replace("]", "");
}else{
    var elementIndex = 1;
}
//the number of matching elements
var count = 0;
for(var i=0;i < decendents.length; i++){
    if (decendents[i].nodeName.toLowerCase() == elementName.toLowerCase()) {
        count++;
        if(count==elementIndex){
            return decendents[i];
        }
    }
}
return null;
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-08T08:55:49.990

我有点担心像这样使用 xml，因为您无法确定一个人拥有的 XML DLL 的版本（如果有的话）。仍然有公司成群结队地使用 IE5.0，而 5.5 有一个特别复杂的 XML 实现。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-01T11:13:57.357

[W3C Dom Level 3 XPath](http://www.w3.org/TR/2004/NOTE-DOM-Level-3-XPath-20040226/)的另一个 JavaScript 实现可以[在 Source Forge](http://js-xpath.sourceforge.net/)上找到。但似乎不活跃。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-07T11:26:31.153

您确定在您的 Internet Explorer 版本中实现了 X-Path 吗？如：您使用的是什么版本？

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-07T11:58:36.987

jQuery 使用插件实现[了跨浏览器兼容的 xPath 选择器子集](http://docs.jquery.com/Release:jQuery_1.2#XPath_Compatibility_Plugin)。您的示例“/HTML/BODY/DIV[9]/DIV[2]”应该可以在其中工作。

（编辑 - 谢尔盖伊林斯基更正）

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-07-20T02:36:02.230

我找不到一个简单通用的解决方案，你可以编写自定义函数来实现一点 xpath 但在 internet explorer 6 或更低版本中很难完成......

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-10-08T07:41:58.190

而不是做

```
xmlDoc.load(document); 
```

尝试

```
xmlDoc.loadXML(document.body.outerHTML) 
```

这只有在您的 HTML 文档被格式化为 XHTML 标准时才真正起作用。此外，BODY 标记将是根节点，因此您必须将 XPATH 更改为“/BODY/DIV[9]/DIV[2]”

# flash - 如何将 Google 地图嵌入 Flash 网站？

> ID：178020
> 
> 赞同：5
> 
> 时间：2008-10-07T11:25:30.673
> 
> 标签：flash, actionscript, google-maps

我想在我正在构建的 Flash 站点中包含 Google 地图。我想尽可能多地保留缩放、打印、复制/发送 url、方向功能。请问有人可以建议最好的方法吗？谢谢。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-07T11:45:56.543

请参阅[Google Maps API for Flash](http://code.google.com/apis/maps/documentation/flash/)

> 该 API 允许 Flex 开发人员将 Google 地图嵌入 Flash 应用程序中。与 JavaScript 版本类似，此 ActionScript API 提供了许多实用程序，用于通过各种服务来操作和向地图添加内容，使您能够在您的网站上嵌入强大的交互式地图应用程序。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-07T13:57:25.670

[Stamen](http://stamen.com)为 Flash（ActionScript 2.0 和 ActionScript 3.0）和 Python 中基于瓦片的地图开发了一个“BSD 许可的显示和交互库”，称为[ModestMaps](http://modestmaps.com/) 虽然不是 Google 地图的最佳选择，但它也支持 Open Street Map、Yahoo 等作为 MS 地图。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-07T11:34:45.537

我在 Flash 上看过谷歌地图。也许您可以购买某种组件。

# c# - 为什么 C# 和 Java 中存在“null”？

> ID：178026
> 
> 赞同：77
> 
> 时间：2008-10-07T11:30:36.560
> 
> 标签：c#, java, null

我们注意到我们用 C#（或 Java）开发的软件中的许多错误会导致 NullReferenceException。

语言中甚至包含“null”是否有原因？

毕竟，如果没有“null”，我就不会有错误，对吧？

换句话说，语言中的哪些特性在没有 null 的情况下无法工作？

* * *

## 回答 #1

> 赞同：92
> 
> 时间：2008-10-07T11:47:23.157

[Anders Hejlsberg，“C# 之父”，刚刚在他的 Computerworld 采访](https://www2.computerworld.com.au/article/261958/a-z_programming_languages_c_/?pp=3)中谈到了这一点：

> 例如，在类型系统中，我们没有区分值类型和引用类型以及类型的可空性。这可能听起来有点古怪或有点技术性，但在 C# 中，引用类型可以为空，例如字符串，但值类型不能为空。拥有不可为空的引用类型肯定会很好，所以你可以声明'这个字符串永远不能为空，我希望你的编译器检查我永远不会在这里碰到一个空指针'。
> 
> 今天人们遇到的 50% 的错误，在我们的平台上使用 C# 编码，Java 也是如此，可能是空引用异常。如果我们有一个更强大的类型系统，可以让您说“此参数可能永远不会为空，并且您的编译器请在每次调用时通过对代码进行静态分析来检查它”。然后我们就可以消除错误类别。

Cyrus Najmabadi，前 C# 团队的软件设计工程师（现在在 Google 工作）在他的博客上讨论了这个主题：（[第 1](http://blogs.msdn.com/cyrusn/archive/2005/04/25/411617.aspx)次，第[2 次](http://blogs.msdn.com/cyrusn/archive/2005/04/25/411630.aspx)，[第 3 次](http://blogs.msdn.com/cyrusn/archive/2005/04/26/412040.aspx)，[第 4 次](http://blogs.msdn.com/cyrusn/archive/2005/04/27/412444.aspx)）。似乎采用不可为空类型的最大障碍是符号会扰乱程序员的习惯和代码库。大约 70% 的 C# 程序引用最终可能是不可为空的。

如果你真的想在 C# 中使用不可为空的引用类型，你应该尝试使用[Spec#](http://research.microsoft.com/specsharp/) ，这是一个允许使用“！”的 C# 扩展。作为一个不可为空的符号。

```
static string AcceptNotNullObject(object! s)
{
    return s.ToString();
} 
```

* * *

## 回答 #2

> 赞同：30
> 
> 时间：2008-10-07T11:37:56.107

空值是引用类型的自然结果。如果你有一个引用，它必须引用某个对象——或者为空。如果要禁止空值，则始终必须确保使用某些非空表达式初始化每个变量-即使在初始化阶段读取变量时也会遇到问题。

你会如何提议删除无效的概念？

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2009-01-28T17:41:05.250

就像面向对象编程中的许多事情一样，这一切都可以追溯到 ALGOL。[托尼·霍尔（Tony Hoare）只是称其为“十亿美元的错误”。](http://lambda-the-ultimate.org/node/3186 "托尼·霍尔 / 历史上的坏主意：“无效参考：十亿美元的错误”")如果有的话，那是轻描淡写的。

这是[一个非常有趣的论文](http://www.ccs.neu.edu/scheme/pubs/dissertation-cobbe.pdf)，关于如何使可空性不是 Java 中的默认值。与 C# 的相似之处是显而易见的。

* * *

## 回答 #4

> 赞同：17
> 
> 时间：2008-10-07T11:48:03.670

[C# 中的Null](http://en.wikipedia.org/wiki/Null_(computer_programming) "维基百科")主要是 C++ 的遗留物，它的指针不指向内存中的任何内容（或者更确切地说，是 adress `0x00`）。在[这次采访中](http://www.computerworld.com.au/index.php/id;1149786074;pp;3 "Compuworld：编程语言的 AZ：C#")，Anders Hejlsberg 说他希望在 C# 中添加不可为空的引用类型。

但是，Null 在类型系统中也有合法的位置，类似于[底部类型](http://en.wikipedia.org/wiki/Bottom_type)（**顶部**`object`类型在哪里）。在 lisp 中，底部类型是，在 Scala 中是.**`NIL``Nothing`**

 **可以设计没有任何空值的C # `null`，但是您必须为人们通常对. 如果 C++ 和 Java 程序员确实在这方面取得了成功，他们的采用率可能会降低。至少在他们看到 C# 程序从来没有任何空指针异常之前是这样。`unitialized-value``not-found``default-value``undefined-value``None<T>`

* * *

## 回答 #5

> 赞同：13
> 
> 时间：2008-10-07T11:39:24.327

删除 null 不会解决太多问题。对于在 init 上设置的大多数变量，您需要有一个默认引用。由于变量指向错误的对象，您会得到意想不到的行为，而不是空引用异常。至少空引用会快速失败，而不是导致意外行为。

您可以查看空对象模式以找到解决部分问题的方法

* * *

## 回答 #6

> 赞同：12
> 
> 时间：2008-10-07T11:37:41.787

Null 是一个非常强大的功能。如果你没有价值，你会怎么做？它是空的！

一种思想是永不返回 null，另一种思想是永远。例如，有人说您应该返回一个有效但为空的对象。

我更喜欢 null 因为它更真实地表明它实际上是什么。如果我无法从我的持久层检索实体，我想要 null。我不想要一些空值。但这就是我。

它对原语特别方便。例如，如果我有 true 或 false，但它用于安全表单，其中权限可以是 Allow、Deny 或未设置。好吧，我希望它不设置为空。所以我可以使用布尔？

还有很多我可以继续说的，但我会把它留在那里。

* * *

## 回答 #7

> 赞同：12
> 
> 时间：2008-10-07T13:06:26.490

> **毕竟，如果没有“null”，我就不会有错误，对吧？**

答案是**否定**的。问题不在于 C# 允许 null，问题在于您有错误，这些错误恰好通过 NullReferenceException 表现出来。如前所述，空值在语言中具有指示“空”引用类型或非值（空/无/未知）的目的。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2008-10-07T13:18:10.587

Null 不会导致 NullPointerExceptions...

程序员导致 NullPointerExceptions。

如果没有空值，我们将返回使用实际的任意值来确定函数或方法的返回值是否无效。您仍然必须检查返回的 -1 （或其他），删除空值不会神奇地解决惰性，但会混淆它。

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2008-10-07T14:30:15.060

该问题可以解释为“为每个引用类型（如 String.Empty）设置默认值还是 null 更好？”。在这个方面，我更喜欢空值，因为；

*   我不想为我编写的每个类编写一个默认构造函数。
*   我不希望为这些默认值分配一些不必要的内存。
*   检查引用是否为空比值比较便宜。
*   很有可能有更多更难检测的错误，而不是 NullReferenceExceptions。有这样一个异常清楚地表明我做错了（假设）是一件好事。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2008-10-07T11:38:13.893

“Null”包含在语言中，因为我们有值类型和引用类型。这可能是一个副作用，但我认为这是一个很好的。它给了我们很大的权力来控制我们如何有效地管理内存。

为什么我们有空？...

值类型存储在“堆栈”上，它们的值直接位于那块内存中（即 int x = 5 意味着该变量的内存位置包含“5”）。

另一方面，引用类型在堆栈上有一个“指针”，指向堆上的**实际**值（即字符串x =“ello”意味着堆栈上的内存块只包含一个指向堆上实际值的地址）。

空值仅仅意味着我们在堆栈上的值不指向堆上的任何实际值——它是一个空指针。

希望我解释得足够好。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2008-10-07T12:18:12.953

在某些情况下，*null*是表示引用尚未初始化的好方法。这在某些情况下很重要。

例如：

```
MyResource resource;
try
{
  resource = new MyResource();
  //
  // Do some work
  //
}
finally
{
  if (resource != null)
    resource.Close();
} 
```

在大多数情况下，这是通过使用*using*语句来完成的。但这种模式仍然被广泛使用。

关于您的 NullReferenceException，通过实施检查所有参数的有效性的编码标准，通常很容易减少此类错误的原因。根据项目的性质，我发现在大多数情况下检查暴露成员的参数就足够了。如果参数不在预期范围内，则会抛出某种*ArgumentException*，或者返回错误结果，具体取决于使用的错误处理模式。

参数检查本身并不能消除错误，但是在测试阶段发生的任何错误都更容易定位和纠正。

作为注释，[Anders Hejlsberg](http://en.wikipedia.org/wiki/Anders_Hejlsberg)提到了缺乏非空强制执行是 C# 1.0 规范中最大的错误之一，现在包括它是“困难的”。

如果您仍然认为静态强制的非空引用值非常重要，您可以查看[spec#](http://research.microsoft.com/SpecSharp/)语言。它是 C# 的扩展，其中非空引用是语言的一部分。这确保了标记为非空的引用永远不会被分配空引用。

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2008-10-07T12:30:02.413

如果你得到一个“NullReferenceException”，也许你一直在引用不再存在的对象。这不是“null”的问题，而是您的代码指向不存在的地址的问题。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2008-10-07T12:25:45.590

Null 在 C#/C++/Java/Ruby 中可用，最好将其视为某些晦涩的过去 (Algol) 的奇怪现象，它以某种方式幸存至今。

您可以通过两种方式使用它：

*   声明引用而不初始化它们（不好）。
*   表示可选性（OK）。

正如您所猜到的，1) 是在普通命令式语言中给我们带来无尽麻烦的原因，早就应该被禁止，2) 是真正的基本特征。

有一些语言可以避免 1）而不防止 2）。

例如[OCaml](http://caml.inria.fr/resources/doc/index.en.html)就是这样一种语言。

一个简单的函数返回一个从 1 开始不断递增的整数：

```
let counter = ref 0;;
let next_counter_value () = (counter := !counter + 1; !counter);; 
```

关于可选性：

```
type distributed_computation_result = NotYetAvailable | Result of float;;
let print_result r = match r with
    | Result(f) -> Printf.printf "result is %f\n" f
    | NotYetAvailable -> Printf.printf "result not yet available\n";; 
```

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2008-10-07T12:58:37.490

一份回复提到数据库中有空值。没错，但它们与 C# 中的空值有很大不同。

在 C# 中，空值是不引用任何内容的引用的标记。

在数据库中，空值是不包含值的值单元格的标记。值单元格通常是指表格中行和列的交集，但值单元格的概念可以扩展到表格之外。

乍一看，两者之间的差异似乎微不足道。但事实并非如此。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2008-10-07T11:36:49.403

我无法谈论您的具体问题，但听起来问题不在于 null 的存在。Null 存在于数据库中，您需要一些方法来在应用程序级别解释这一点。请注意，我认为这不是它存在于 .net 中的唯一原因。但我认为这是原因之一。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2008-10-07T12:44:05.117

我很惊讶没有人谈论数据库作为他们的答案。数据库具有可为空的字段，任何将从数据库接收数据的语言都需要处理它。这意味着有一个空值。

事实上，这非常重要，以至于对于像 int 这样的基本类型，您可以让它们为空！

还要考虑函数的返回值，如果你想让一个函数除以几个数字并且分母可以是 0 怎么办？在这种情况下，唯一的“正确”答案将是空的。（我知道，在这样一个简单的例子中，异常可能是一个更好的选择......但在某些情况下，所有值都是正确的，但有效数据可能会产生无效或无法计算的答案。不确定应该在这种情况下使用异常案例...）

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2008-10-07T13:53:29.860

除了已经提到的所有原因之外，当您需要一个尚未创建的对象的占位符时，还需要 NULL。例如。如果您在一对对象之间有循环引用，那么您需要 null 因为您不能同时实例化两者。

```
class A {
  B fieldb;
}

class B {
  A fielda;
}

A a = new A() // a.fieldb is null
B b = new B() { fielda = a } // b.fielda isnt
a.fieldb = b // now it isnt null anymore 
```

编辑：您可能能够提取一种没有空值的语言，但它绝对不是面向对象的语言。例如，prolog 没有空值。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2008-10-07T11:53:54.983

如果您创建一个实例变量作为对某个对象的引用的对象，那么在您将任何对象引用分配给它之前，您建议该变量具有什么值？

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2008-10-07T13:39:29.577

我提议：

1.  禁止空
2.  扩展布尔值：True、False 和 FileNotFound

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2008-10-07T13:45:05.850

通常 - NullReferenceException 表示某些方法不喜欢它所传递的内容并返回一个空引用，后来在使用前没有检查引用就被使用了。

该方法可以抛出一些更详细的异常而不是返回 null，这符合*快速失败*的思维模式。

或者该方法可能会返回 null 以方便您，以便您可以编写*if*而不是*尝试*避免异常的“开销”。

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2010-11-09T03:34:30.360

*   显式归零，尽管这很少必要。也许人们可以将其视为一种防御性编程形式。
*   在将字段从一个数据源（字节流、数据库表）映射到对象时，使用它（或用于不可为空的 nullable(T) 结构）作为标志来指示缺少的字段。为每个可能的可空字段创建一个布尔标志可能会变得非常笨拙，并且当该字段范围内的所有值都有效时，可能无法使用像 -1 或 0 这样的标记值。当有许多字段时，这尤其方便。

这些是使用案例还是滥用案例是主观的，但我有时会使用它们。

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2011-12-06T00:03:01.663

如果框架允许创建某种类型的数组而不指定应该对新项目做什么，则该类型必须具有一些默认值。对于实现可变引用语义 (*) 的类型，在一般情况下没有合理的默认值。我认为 .NET 框架的一个弱点是无法指定非虚拟函数调用应该禁止任何空值检查。这将允许像 String 这样的不可变类型作为值类型，通过返回像 Length 这样的属性的合理值。

(*) 请注意，在 VB.NET 和 C# 中，可变引用语义可以由类或结构类型实现；结构类型将通过充当其持有不可变引用的类对象的包装实例的代理来实现可变引用语义。

如果可以指定一个类应该具有不可为空的可变值类型语义（这意味着 - 至少 - 实例化该类型的字段将使用默认构造函数创建一个新的对象实例，并且复制该类型的字段将通过复制旧实例来创建一个新实例（递归处理任何嵌套的值类型类）。

然而，目前尚不清楚框架中应该为此构建多少支持。让框架本身识别可变值类型、可变引用类型和不可变类型之间的区别，将允许类本身持有对来自外部类的可变和不可变类型的混合引用，从而有效地避免对深度不可变对象进行不必要的复制。

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2013-02-21T20:58:14.883

很抱歉回答晚了四年，我很惊讶到目前为止没有一个答案以这种方式回答了原始问题：

像**C# 和 Java**这样的语言，就像 C 和它们之前的其他语言一样，**使`null`**程序员可以通过有效地使用指针来**编写快速、优化的代码。**

* * *

*   低级视图

先说一点历史。之所以`null`发明是为了效率。在汇编中进行低级编程时，没有抽象，您在寄存器中有值，并且您希望充分利用它们。将零定义为**无效的指针值是表示****对象或空的**一种极好的策略。

当您可以零内存开销、非常快速地实现**可选值**模式时，为什么要浪费内存中一个非常好的单词的大部分可能值呢？这就是`null`它如此有用的原因。

*   高级视图。

从语义上讲，`null`对于编程语言来说，这绝不是必要的。例如，在 Haskell 等经典函数式语言或 ML 家族中，没有 null，而是命名为 Maybe 或 Option 的类型。它们代表了更高级别的**可选值**概念，而不以任何方式关心生成的汇编代码的外观（这将是编译器的工作）。

这也非常有用，因为它使编译器能够**捕获更多的错误**，这意味着更少的 NullReferenceExceptions。

*   把它们放在一起

与这些非常高级的编程语言相比，C# 和 Java 允许**每个引用类型可能的 null 值（这是***最终将使用指针实现*的类型的另一个名称）。

这似乎是一件坏事，但它的好处是程序员可以使用它在后台如何工作的知识来创建更高效​​的代码（即使该语言具有垃圾收集）。

这就是为什么`null`现在仍然存在于语言中的原因：在对可选值的一般概念的需求和对效率的永远存在的需求之间进行权衡。

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2014-04-01T22:19:01.833

没有 null 就无法工作的功能是能够表示“没有对象”。

物体的缺失是一个重要的概念。在面向对象编程中，我们需要它来表示对象之间的可选关联：对象 A 可以附加到对象 B，或者 A 可能没有对象 B。没有 null 我们仍然可以模拟：例如我们可以使用一个对象列表将 B 与 A 关联起来。该列表可以包含一个元素（一个 B），也可以为空。这有点不方便，并不能真正解决任何问题。假设存在 B 的代码，例如`aobj.blist.first().method()`将以类似于空引用异常的方式爆炸：（如果`blist`为空，则行为是`blist.first()`什么？）

说到列表，null 可以让你终止一个链表。A`ListNode`可以包含对另一个`ListNode`可以为空的引用。其他动态集合结构（例如树）也是如此。Null 允许您拥有一个普通的二叉树，其叶节点通过具有为空的子引用来标记。

列表和树可以在没有 null 的情况下构建，但它们必须是循环的，否则是无限/惰性的。这可能会被大多数程序员认为是不可接受的约束，他们更愿意在设计数据结构时有选择。

与空引用相关的痛苦，例如由于错误和导致异常而意外产生的空引用，部分是静态类型系统的结果，该系统将空值引入每种类型：有一个空字符串，空整数，空小部件， ...

在动态类型语言中，可以有一个空对象，它有自己的类型。这样做的结果是您拥有 null 的所有代表性优势，以及更高的安全性。例如，如果您编写一个接受 String 参数的方法，那么您可以保证该参数将是一个字符串对象，而不是 null。String 类中没有 null 引用：已知为 String 的东西不能是对象 null。引用在动态语言中没有类型。诸如类成员或函数参数之类的存储位置包含一个值，该值可以是对对象的引用。该对象具有类型，而不是引用。

因此，这些语言提供了一个干净的、或多或少纯数学的“null”模型，然后静态语言将其变成了某种科学怪人的怪物。

* * *

## 回答 #25

> 赞同：-3
> 
> 时间：2008-10-07T11:37:50.680

Null 是任何 OO 语言的基本要求。任何未分配对象引用的对象变量都必须为空。

# delphi - 如何在 Delphi 7 中禁用 CPU 窗口

> ID：178068
> 
> 赞同：14
> 
> 时间：2008-10-07T11:40:42.530
> 
> 标签：delphi, debugging, ide, window, cpu

在 Delphi 7 中单步执行程序时，有时会弹出 CPU 窗口，然后单步执行该指令。我觉得这很烦人，因为我只想执行 Pascal Code。

有谁知道如何禁用此 CPU 弹出窗口？

***如果这个窗口永远不会显示，我不会感到抱歉。***

Delphi 5 上没有发生这种情况，这是我以前用于 Delphi 的 IDE。我确实主要使用 Step-Over 按钮，并且仅在想要了解使用过的（帕斯卡）单位的细节时才进入。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2010-01-22T00:30:30.667

在 RAD studio 2009 中，您可以访问`Tools->Options->Debugger Options->Codegear Debuggers`. 在`General`中，选择`Ignore non-user breakpoints`。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-11-07T08:02:44.723

默认情况下，Delphi 不会进入 CPU 窗口。所以你的问题的答案不是它不能完成。也许问题应该是：我做了什么导致了这个。

**编辑**：
从评论中我了解到，当您按下暂停中断调试器时会发生这种情况。
当你点击暂停时，它会停在它正在执行的确切位置，这并不奇怪。
这很可能出现在您没有源代码的某些 Windows 代码中。
通过选择`Run -> Run to Next Source Line`或`Shift`-`F7`您的程序将执行得更远一些，直到它遇到一些它确实有源代码的代码。

这是您问题的答案，但请记住，您可能会在永远无法到达下一个源代码行的地方中断。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-14T08:45:18.017

看来我解决了：添加到注册表：HKCU\Software\Borland|Delphi\7.0\Debugging: E​​nableCPU (stringvalue):0

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-12-16T20:24:52.427

修改以下注册表项：

```
HKEY_CURRENT_USER/software/Borland/Delphi/6.0/Debugging/Integrated Debugging = 0 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-07T12:02:40.737

当当前单元没有调试信息时，您将进入 CPU 窗口。

尝试启用 Debug-DCU（在 Project/Options.../Compiler 中）。如果您尚未检查其他调试选项，请同时激活它们。

# apache-flex - DDD 和异步存储库

> ID：178070
> 
> 赞同：3
> 
> 时间：2008-10-07T11:41:01.017
> 
> 标签：apache-flex, asynchronous, domain-driven-design, ddd-repositories

我们正在开发一个使用 RMI 和 JMS 连接到 Java 后端的富客户端（用 Flex 编写）。我正在考虑以 DDD 方式实现客户端，以便它具有用于域对象上的 CRUD 操作的存储库。

然而，问题是所有后端通信都是异步发生的，我无法强制客户端等待继续，直到它收到响应。这意味着，在低级别上，我可以调用远程对象上的方法并获得 AsyncToken 作为返回值。然后我可以监听 asynctoken 上的事件以查看调用是通过还是失败。然而，这打破了存储库背后的主要思想，向客户隐藏技术细节。

我猜可能有两种选择：

1.  让存储库上的方法返回 asynctoken，这对我来说似乎是一个混乱的解决方案
2.  让这些方法返回一个空集合（例如 findAll），当收到响应时该集合将被填充。

两者都有优点和缺点，我想从你们那里得到一些意见。

（更进一步，什么是好的缓存策略？根据情况，我不希望存储库在每次向它请求所有实体时都调用服务器。这将如何影响存储库上方法的签名。 )

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-29T07:01:56.990

Flex 和 Flash 远程处理本质上是异步的，因此与这种范式作斗争会给您带来很多麻烦。我们的服务委托从每个方法返回 AsyncToken，我们从来没有遇到过问题。

如果您想确保应用程序在结果/故障返回之前不会呈现新视图或执行其他逻辑，您可以执行以下操作：

1.  为自定义事件附加一个事件侦听器，该事件将调用您的“发布结果/故障代码”
2.  进行异步调用
3.  处理结果/故障
4.  调度自定义事件以从 #1 触发您的侦听器

请记住，每次进行异步调用时，这都会导致大量烦人的样板代码。我会非常仔细地考虑您是否真的需要同步执行路径。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-21T13:49:02.330

我建议返回一个 AsyncToken，因为返回一个空集合感觉不对。

在从缓存返回数据的情况下，返回一个 CompletedAsyncToken (: AsyncToken)，只要订阅了 COMPLETE 事件（然后删除了处理程序），它就会自动触发带有数据的 COMPLETE 事件。

```
public class CompleteAsyncToken : AsyncToken
{
    public function CompleteAsyncToken(data : Object)
    {
        super(data);
    }

    public override addEventListener(type:String, listener:Function, useCapture:Boolean = false, priority:int = 0, useWeakReference:Boolean = false) : void
    {
        super.addEventListener(type, listener, useCapture, priority, useWeakReference);

        if (type == Event.COMPLETE)
        {
            // Don't just execute listener as EventDispatcher is not that simple
            super.dispatchCompleteEvent();
            super.removeEventListener(type, listener);
        }
    } 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-21T11:53:53.543

一种策略是在存储库前面创建一个外观。您的客户端将对外观进行异步调用，而外观又对您的存储库进行同步调用。这将允许您的存储库以同步方式继续工作，而外观管理您调用的异步方面。

# knowledge-management - 在组织中记住技术知识的最佳方式是什么

> ID：178110
> 
> 赞同：12
> 
> 时间：2008-10-07T11:54:54.780
> 
> 标签：knowledge-management

*   我们使用公司维基吗？
*   您如何将技术文档保存为源代码控制的一部分，然后从各种源文件中获得指向它们的链接（要了解其工作原理，请参阅目录中的文章...）

这些方法和其他方法的优缺点是什么？为此目的有什么好的工具吗？

**如果您推荐一个 wiki，** 您会推荐使用哪些 Wiki？内部的？托管？自由？有薪酬的？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-10-07T11:57:23.353

我建议使用维基。它作为中央文档源工作得非常好，并具有内置的修订控制。您还可以通过 URL 引用代码中的文档。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-10-07T12:10:36.183

人是贵公司最有效的知识容器。而最有效的知识转移方式是人与人之间的交流。Wiki 和文档也很有用，但除非您的员工是出色的技术作家，否则书面文档是一种传递除最琐碎知识之外的所有知识的糟糕方式。作家需要花费数年时间才能写出一本书，因此您不能指望开发人员在几个小时内就能编写出高质量的文档。

在您的组织中保持知识的最佳方式是让人们一起工作。确保没有人单独工作。让人们结对编程并检查彼此的代码。组织技术会议等。

如果您真的想将知识存储在某个地方，请尝试丰富数据。轻松将白板图片等添加到 wiki。书面文档的另一个问题是人们似乎认为冗长的抽象文本是“专业的”。确保您的文档简短、清晰且中肯，以便人们真正阅读它。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-10-07T11:56:44.260

如果您能够获得支持，那么具有声誉的社交媒体（例如这个网站）可以在 Intranet 上运行*得非常好。*人们需要一些激励来充实知识库。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-07T12:13:49.140

我会推荐[MindTouch Deki](http://wiki.mindtouch.com/)。它不仅仅是一个 wiki，还集成了许多其他来源，包括将其集成到组织中的自定义数据源中的能力。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-07T12:08:46.420

Wiki 运行良好，但我们用 Ignite 和 Camtasia 截屏视频补充了 Wiki。这些可以在描述配置等时节省时间。截屏视频操作简单、快捷，您不必担心是否为观众捕捉到了正确的细节，因为他们可以倒带/重播他们需要查看的部分。

我们已经尝试过知识库文章，但它让人们变得懒惰——“我不明白这部分”意味着你将重写一大堆。给一个人一个截屏视频，他们可以自己做笔记。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-07T12:12:49.983

无论解决方案如何，在公司中保留知识的最重要的事情就是强制人们使用该系统。Wiki 是我的最爱，但如果没有管理层或团队领导的强制执行，很难保持这种有用的知识水平——人们似乎讨厌记录它，尤其是当它使它们很容易被替换时。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-10-07T15:18:30.907

Wiki 很好，但尚未提及其最大优势之一。很多时候，文档中的缺陷不是由编写它的人发现的，因为作者不需要或阅读文档。当作者休假或生病时发现缺陷，并且其他人试图遵循文档并且其中一部分不起作用。使用 Wiki，任何可怜的家伙最终发现文档中的缺陷都可以立即纠正它，而不必给作者发电子邮件，因为它被埋在作者度假时收到的其他数千封电子邮件中，或者试图记住告诉作者回来后的作者。

此外，确保至少有两个人知道如何做所有事情，并*保持人员配备水平*。当有人离开时，如果您已经有其他人可以做他们所做的一切，那么不替换他们可能是非常诱人的，但是如果您现在拥有多个基础设施或代码，每一个都只能由一个人理解，那么您很容易受到攻击. 知识从一个人转移到另一个人需要时间和动手工作。这并不容易，但它比尝试仅从文档中学习基础设施或代码库要容易得多。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-07T11:58:56.410

我过去使用过这两种方法，发现 wiki 格式是最容易接受的。在源代码控制中存储文档可能会对合并版本产生影响（显然取决于使用的源代码控制软件和应用的方法）。基于 wiki 的解决方案也是如此，但由于某种原因，它似乎从未在我使用的实现中出现过大问题。

主要 wiki 的可搜索性是其成功的另一个主要因素。在 wiki 中查找搜索词比在可能不相关的代码段中查找对文档的引用要容易得多。

<2c />

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-10-07T11:59:53.707

我喜欢维基。我什至将它们用于我自己的爱好项目，记录我如何解决我不想再次处理的令人讨厌的问题，或者维护对相关资源的引用列表。

让很多人为这样的 wiki 做出贡献更加强大，但是讨论的可能性也非常重要。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-10-07T12:00:15.440

我实际上已经开始了一个解决它的副项目。它仍处于规划阶段，但我已经确定了组织中保留技术知识的一些领域。现在，这并不适用于每个组织，但每个组织都至少使用其中一个。

*   人们
*   静态 Web（Internet 和 Intranet）站点
*   书籍（公司图书馆）
*   书籍（个人的书籍）
*   动态 Web（Internet 和 Intranet）站点
*   数据库和存储库

你如何使用这些是不同的，但关键是让人们使用静态和/或动态网站来捕获信息，或者至少确定它在书籍和存储库中的位置。如果人们不为知识库提供食物，那么你使用什么技术就无关紧要了。从我能够收集到的知识中，知识必须是最新的、准确的和深入的，否则它是徒劳的。

正如 Vinko Vrsalovic 指出的那样，另一个重要的关键概念是将数据/信息/知识链接回其推理的能力。需求分析中的一个常见做法是跟踪需求源的能力。对于知识也应该这样说。组织中的每个人都可以了解世界上的一切。但是，如果没有人知道为什么该知识有用或在何处/何时使用该知识，那就浪费了。

如果我遗漏了任何内容，请随时编辑此帖子或回复评论。我认为这个问题将有助于我的项目工作。

编辑 1：添加了 Vinko Vrsalovic，它不仅仅是关于知识，而是将数据链接回与知识相关的生产问题。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2010-10-20T11:28:14.313

我已经看到很多知识讨论发生在组织内的电子邮件中。这些知识会在电子邮件中保留很长时间，最终会丢失，并且不属于原始讨论的其他人无法访问。

使用[http://grexit.com](http://grexit.com)之类的工具可以帮助您将这些知识从收件箱中转移到组织内的 coomon 共享存储库中。目前这仅适用于 Google Apps，但值得一试。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-10-07T12:04:47.100

绝对是维基。我们使用[TWiki](http://twiki.org/)并使用一些优秀的插件。

编辑：我忘了补充一点，您可能想查阅有关文档和版本控制的[这个问题的答案。](https://stackoverflow.com/questions/29810/is-version-control-ie-subversion-applicable-in-document-tracking)

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-10-07T12:14:52.040

使用 wiki，但要确保某人对其中的内容拥有编辑所有权。该人需要确保遵守命名标准和文档层次结构 - 公司 wiki 很容易变得一团糟。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-10-07T12:32:50.553

我会给你一些 Wiki 的缺点，或者可能需要额外思考的地方：

1.  如果技术知识/文档与无权访问您的 Wiki 的客户或组织共享
2.  与特定软件版本相关的文档通常与发布相关的源一起保存得更好。通常 Wiki 包含最新的信息，但可能很难（取决于编辑的关心）将文档映射到旧版本

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-10-07T12:38:24.783

我认为，您使用的工具并不那么重要。真正重要的是，您团队中的所有成员都同意一种方式和一个文档位置。

您可以使用 wiki 或笔记数据库或自酿应用程序。

我个人更喜欢所有东西都在一个地方。因此，对于技术文档，源代码控制系统将是正确的位置。对于非开发人员使用的文档，源代码管理绝对是错误的地方。对于全面的文档，也许共享点服务器是您应该使用的工具。它具有某种版本控制，无需特殊的客户端应用程序即可访问。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-10-07T16:10:11.487

我们结合使用项目博客和维基。

我认为人们对 wiki 感到有些厌烦——他们觉得他们至少需要输入几个段落来证明输入的合理性——所以我们创建了一个博客，它对于捕捉实时发生的小事情或事情很有用，例如，“我将列字段长度从 40 更改为 50”或“清除了比上周旧的审计表数据”。

我期望（希望）随着项目的进展，一些博客条目将成为更长的 wiki 条目的源材料。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2008-10-07T16:23:03.287

作为 wiki 的替代方案，请考虑使用 SharePoint。它允许您处理事件（如会议）、任务和文档。它非常适用于非技术人群，这可以让技术作家和管理人员了解正在发生的事情。它也是 Windows 2003 的一部分，因此您可能不需要额外的许可证。

不利的一面是，我几乎可以保证会有一个 luddite 将每一个 UI 小问题都归咎于你。不过，高层可能会喜欢它。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2012-10-15T11:14:38.687

您可能可以看看[Associativy](http://associativy.com/)。它将知识片段存储为图的节点，其中边表示关联（在人类意义上）连接。该图可以多种方式搜索和探索，给定一组搜索词，软件能够“思考”一个合适的关联。

我是开源的，并且在[Orchard CMS](http://orchardproject.net/)上运行，这也是一个开源项目。

这是一个无耻的插件（Associativy 是我的项目），对不起。

编辑：刚刚认识到这个问题有多老....

# windows - 将 Windows 手动重置事件移植到 Linux？

> ID：178114
> 
> 赞同：14
> 
> 时间：2008-10-07T11:55:39.240
> 
> 标签：windows, linux, multithreading, pthreads

将 Windows 手动重置事件移植到 pthread 是否有比 pthread 条件变量 + pthread 互斥体 + 如果设置或未设置事件的标志更简单的解决方案？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-10-07T15:15:28.900

Pthreads 是低级结构。不，没有更简单的机制。`pthread_cond__*`在概念上类似于自动重置事件。小心，`pthread_cond_wait`可能会有虚假的唤醒，因此无论情况如何，都不应在没有某种外部标志的情况下使用它。

不过，建立自己的并不会太难。

```
#include <pthread.h>
#include <stdbool.h>

struct mrevent {
    pthread_mutex_t mutex;
    pthread_cond_t cond;
    bool triggered;
};

void mrevent_init(struct mrevent *ev) {
    pthread_mutex_init(&ev->mutex, 0);
    pthread_cond_init(&ev->cond, 0);
    ev->triggered = false;
}

void mrevent_trigger(struct mrevent *ev) {
    pthread_mutex_lock(&ev->mutex);
    ev->triggered = true;
    pthread_cond_signal(&ev->cond);
    pthread_mutex_unlock(&ev->mutex);
}

void mrevent_reset(struct mrevent *ev) {
    pthread_mutex_lock(&ev->mutex);
    ev->triggered = false;
    pthread_mutex_unlock(&ev->mutex);
}

void mrevent_wait(struct mrevent *ev) {
     pthread_mutex_lock(&ev->mutex);
     while (!ev->triggered)
         pthread_cond_wait(&ev->cond, &ev->mutex);
     pthread_mutex_unlock(&ev->mutex);
} 
```

这可能不适合您的用法，因为您通常会使用不同的锁来代替`ev->mutex`，但这是它通常使用方式的要点。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2012-04-12T01:41:08.843

You can easy implement manual-reset events with pipes:

event is in triggered state -> there is something to read from the pipe

SetEvent -> write()

ResetEvent -> read()

WaitForMultipleObjects -> poll() (or select()) for reading

the "SetEvent" operation should write something (e.g. 1 byte of any value) just to put the pipe in non-empty state, so subsequent "Wait" operation, that is, poll() for data available for read will not block.

The "ResetEvent" operation will read up the data written to make sure pipe is empty again. The read-end of the pipe should be made non-blocking so that trying to reset (read from) already reset event (empty pipe) wont block - fcntl(pipe_out, F_SETFL, O_NONBLOCK) Since there may be more than 1 SetEvents before the ResetEvent, you should code it so that it reads as many bytes as there are in the pipe:

```
char buf[256]; // 256 is arbitrary
while( read(pipe_out, buf, sizeof(buf)) == sizeof(buf)); 
```

Note that waiting for the event does not read from the pipe and hence the "event" will remain in triggered state until the reset operation.

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2012-06-29T11:22:32.050

我更喜欢管道方法，因为通常不仅需要等待一个事件，还需要多个对象，例如`WaitForMultipleObjects(...)`. 并且使用管道可以轻松地将 windows`WaitForMultipleObjects`调用替换为`poll(...)`, `select`,`pselect`和`epoll`。

有一种轻量级的进程同步方法，称为`Futex`（快速用户空间锁定系统调用）。有一个函数`futex_fd`可以为 futex 获取一个或多个文件描述符。该文件描述符以及可能代表真实文件、设备、套接字等的许多其他文件描述符可以传递给`select`、`poll`或`epoll`. 不幸的是，它*已从*内核中删除。所以管道技巧仍然是唯一可以做到这一点的工具：

```
int pipefd[2];
char buf[256]; // 256 is arbitrary
int r = pipe2(pipefd, O_NONBLOCK);

void setEvent()
{
  write(pipefd[1], &buf, 1); 
}

void resetEvent() {  while( read(pipefd[0], &buf, sizeof(buf)) > 0 ) {;} }

void waitForEvent(int timeoutMS)
{ 
   struct pollfd fds[1];
   fds[0].fd = pipefd[0];
   fds[0].events = POLLRDNORM;
   poll(fds, 1, timeoutMS);
}

// finalize:
close(pipefd[0]);
close(pipefd[1]); 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2012-02-28T21:40:00.767

不，没有更简单的解决方案，但以下代码可以解决问题：

```
void LinuxEvent::wait()
{
    pthread_mutex_lock(&mutex);

    int signalValue = signalCounter;

    while (!signaled && signalValue == signalCounter)
    {
        pthread_cond_wait(&condition, &mutex);
    }

    pthread_mutex_unlock(&mutex);
}

void LinuxEvent::signal()
{
    pthread_mutex_lock(&mutex);

    signaled = true;
    signalCounter++;
    pthread_cond_broadcast(&condition);

    pthread_mutex_unlock(&mutex);
}

void LinuxEvent::reset()
{
    pthread_mutex_lock(&mutex);
    signaled = false;
    pthread_mutex_unlock(&mutex);
} 
```

调用 signal() 时，事件进入有信号状态，所有等待线程都将运行。然后事件将保持在信号状态，所有调用 wait() 的线程都不会等待。对 reset() 的调用将使事件恢复到非信号状态。

如果您执行快速信号/重置以唤醒等待的线程，则 signalCounter 就在那里。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-10-06T07:30:14.087

我认为 Windows 事件更类似于信号量。即对于自动重置，您将使用二进制信号量和 sem_timedwait() 函数。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2013-01-22T14:29:03.107

我们一直在寻找类似的解决方案，将一些重度多线程 C++ 代码从 Windows 移植到 Linux，并最终编写了一个开源的、MIT 许可[的 Linux 事件库](https://github.com/NeoSmart/PEvents)。它应该是您正在寻找的解决方案，并且已经过严格的性能和资源消耗审查。

它实现了手动和自动重置事件，以及`WaitForSingleObject`和`WaitForMultipleObject`功能。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2015-07-11T18:36:51.503

[我们（完全披露：我在 NeoSmart Technologies 工作）编写了一个名为pevents](https://github.com/NeoSmart/PEvents)的开源（MIT 许可）库，它在 POSIX 上[实现 WIN32 手动和自动重置事件](http://neosmart.net/blog/2011/waitformultipleobjects-and-win32-events-for-linux-and-read-write-locks-for-windows/)，并包括 WaitForSingleObject 和 WaitForMultipleObjects 克隆。从那时起，它就得到了一些采用（它在 Linux/Mac 上的 Steam 中使用）并且运行良好。

虽然我个人建议您在 POSIX 机器上编码时使用 POSIX 多线程和信号范式，但如果您需要，pevents 为您提供了另一种选择。

# sql - 函数与存储过程

> ID：178128
> 
> 赞同：91
> 
> 时间：2008-10-07T11:59:49.277
> 
> 标签：sql, sql-server, database, function, stored-procedures

假设我必须实现一段 T-SQL 代码，该代码必须返回一个表作为结果。我可以实现一个表值函数或返回一组行的存储过程。我应该使用什么？

简而言之，我想知道的是：

**函数和存储过程之间的主要区别是什么？**使用其中一种时，我必须考虑哪些因素？

* * *

## 回答 #1

> 赞同：52
> 
> 时间：2008-10-07T12:05:49.483

如果您可能希望将这段代码的结果与其他表结合起来，那么显然表值函数将允许您在单个 SELECT 语句中组合结果。

通常，有一个层次结构（View < TV Function < Stored Proc）。你可以在每一个中做更多的事情，但是随着功能的增加，组合输出和优化器真正参与的能力会降低。

因此，使用任何一个最低限度可以让您表达您想要的结果。

* * *

## 回答 #2

> 赞同：50
> 
> 时间：2008-10-07T12:07:13.240

函数必须是确定性的，不能用于对数据库进行更改，而存储过程允许您进行插入和更新等。

您应该限制函数的使用，因为它们对大型复杂查询造成了巨大的可伸缩性问题。它们成为查询优化器的“黑匣子”，您将看到使用函数和简单地将代码插入查询之间的巨大性能差异。

但在非常特殊的情况下，它们对于表值回报绝对有用。

如果您需要解析逗号分隔的列表，以模拟将数组传递给过程，函数可以为您将列表转换为表格。这是 Sql Server 2005 的常见做法，因为我们还不能将表传递给存储过程（我们可以使用 2008）。

* * *

## 回答 #3

> 赞同：46
> 
> 时间：2008-10-07T12:16:10.757

[从文档](http://msdn.microsoft.com/en-us/library/ms187650.aspx)：

> 如果存储过程满足以下条件，则可以将其重写为表值函数：
> 
> *   该逻辑可以在单个 SELECT 语句中表达，但它是一个存储过程，而不是一个视图，只是因为需要参数。
>     
>     
> *   存储过程不执行更新操作，除了表变量。
>     
>     
> *   不需要动态 EXECUTE 语句。
>     
>     
> *   存储过程返回一个结果集。
>     
>     
> *   存储过程的主要目的是构建要加载到临时表中的中间结果，然后在 SELECT 语句中对其进行查询。

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2014-01-18T13:04:57.063

我将写一些存储过程和函数之间有趣的区别。

*   我们可以在选择查询中使用函数，但我们不能在选择查询中使用存储过程。
*   我们不能在函数中使用非确定性函数，但我们可以在存储过程中使用非确定性函数。现在问题来了，什么是非确定性函数..答案是：-

    > 非确定性函数是在不同时间为相同输入值返回不同输出的函数，例如 getdate()。每当它运行时，它总是返回不同的值。

    例外：-

    > sql server 2000 之前的早期版本不允许在用户定义的函数中使用 getdate() 函数，但 2005 及更高版本允许我们在用户定义的函数中使用 getdate() 函数。
    > 
    > Newid() 是非确定性函数的另一个例子，但不能用于用户定义的函数，但我们可以在存储过程中使用它。

*   我们可以在存储过程中使用 DML（插入、更新、删除）语句，但不能在物理表或永久表的函数中使用 DML 语句。如果我们想在函数中进行 DML 操作，我们可以在表变量上而不是在永久表上进行。

*   我们不能在函数中使用错误处理，但我们可以在存储过程中进行错误处理。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2013-04-01T18:47:36.053

1.  过程可以返回零或 n 个值，而函数可以返回一个强制值。

2.  过程可以有输入/输出参数，而函数只能有输入参数。

3.  过程允许在其中选择以及 DML 语句，而函数只允许在其中选择语句。

4.  函数可以从过程中调用，而过程不能从函数中调用。

5.  异常可以由过程中的 try-catch 块处理，而 try-catch 块不能在函数中使用。

6.  我们可以在过程中进行事务管理，而不能在功能中进行。

7.  过程不能在 select 语句中使用，而函数可以嵌入在 select 语句中。

8.  UDF（用户定义函数）可以在 SQL 语句中的 // 部分的任何位置使用，`WHERE`而`HAVING`存储`SELECT`过程则不能。

9.  返回表的 UDF 可以被视为另一个行集。这可以在`JOIN`s 中与其他表一起使用。

10.  内联 UDF 可以看作是接受参数的视图，并且可以在`JOIN`s 和其他行集操作中使用。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2008-10-07T12:06:54.723

例如，如果您有一个函数，则可以将其用作 SQL 语句的一部分

```
SELECT function_name(field1) FROM table 
```

它不适用于存储过程。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2011-07-27T06:16:07.067

我用长时间运行的逻辑运行了一些测试，在表值函数和存储过程以及直接的 EXEC/SELECT 中运行相同的代码位（长 SELECT 语句），并且每个执行相同。

在我看来，总是使用表值函数而不是存储过程来返回结果集，因为它使逻辑在随后加入它们的查询中更容易和可读，并且使您能够重用相同的逻辑。为了避免对性能造成太大影响，我经常使用“可选”参数（即您可以将 NULL 传递给它们）以使函数能够更快地返回结果集，例如：

```
CREATE FUNCTION dbo.getSitePermissions(@RegionID int, @optPersonID int, optSiteID int)
AS
RETURN 
    SELECT DISTINCT SiteID, PersonID
    FROM dbo.SiteViewPermissions
    WHERE (@optPersonID IS NULL OR @optPersonID = PersonID)
    AND (@optSiteID IS NULL OR @optSiteID = SiteID)
    AND @RegionID = RegionID 
```

通过这种方式，您可以在许多不同的情况下使用此功能，并且不会对性能造成巨大影响。我相信这比事后过滤更有效：

```
SELECT * FROM dbo.getSitePermissions(@RegionID) WHERE SiteID = 1 
```

我在几个函数中使用了这种技术，有时还有一长串这种类型的“可选”参数。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2008-10-07T12:06:35.550

当我返回的只是一个没有影响的表时，我个人使用表值函数。基本上，我将它们视为参数化视图。

如果我需要返回多个记录集或者表中会有更新的值，我会使用存储过程。

我的 2 美分

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2008-10-23T01:10:10.987

如上所述，函数更具可读性/可组合性/自我记录，但通常性能较差，如果您在连接中对它们感到厌烦，可能会严重降低性能，例如

```
SELECT *
FROM dbo.tvfVeryLargeResultset1(@myVar1) tvf1
INNER JOIN dbo.tvfVeryLargeResultset1(@myVar2) tvf2
    ON (tvf1.JoinId = tvf2.JoinId) 
```

通常，您只需要接受 tvf 可以消除的代码冗余（以不可接受的性能成本为代价）。

**我还没有提到的另一点是，您不能在多语句 tvf 中使用数据库状态更改临时表。** 与临时表在功能上最等效的机制是不改变状态的内存表变量，对于大型数据集，临时表可能比表变量更高效。（其他替代方案包括动态表和公用表值表达式，但在一定程度的复杂性下，这些不再是 IMO 的好选择。）

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-10-07T12:08:28.917

这取决于:) 如果您想在另一个过程中使用表值结果，您最好使用 TableValued 函数。如果结果是针对客户端的，则存储过程通常是更好的选择。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-10-07T21:45:10.343

我会对两者进行性能测试。sp 方法或派生表可能比函数快得多，如果是这样，则应使用该方法。一般来说，我会避免使用函数，因为它们可能会消耗性能。

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2019-12-25T12:25:46.717

存储过程是预编译的查询，执行速度更快，并从 sql 注入中保存。它们可以返回 0 或 N 个值。我们可以在存储过程中执行 DML 操作。我们可以在过程中使用函数，也可以在选择查询中使用函数。函数用于返回函数中不可能的任何值和 DML 操作。函数有标量和表值两种类型。标量函数返回单个值，用于返回表行的表值函数。

# wpf - 将 UserControl 的 Dependency Property 值传输到其中的 Control

> ID：178135
> 
> 赞同：2
> 
> 时间：2008-10-07T12:03:52.747
> 
> 标签：wpf, data-binding, user-controls

我有一个 UserControl（复合控件），可以显示为以下伪 XAML 代码：

```
<UserControl>
  <DockPanel>
    <TextBox />
    <Button />
  </DockPanel>
</UserControl> 
```

我在很多地方使用这个自定义控件，并使用 WPF 样式设置其中一些样式。此样式将 UserControl 的 Background 属性设置为一种颜色。但是这个背景颜色是在 UserControl 的背景表面上绘制的，但我希望它只在 TextBox 控件的背景上绘制。这就是我得到的（颜色=红色）：

[替代文字 http://img261.imageshack.us/img261/8600/62858047wi3.png](http://img261.imageshack.us/img261/8600/62858047wi3.png)

如果我将 UserControl 的 Background 属性绑定到我的 TextBox 控件的 background 属性，我会得到以下内容：

[替代文字 http://img111.imageshack.us/img111/1637/30765795kw5.png](http://img111.imageshack.us/img111/1637/30765795kw5.png)

现在它还绘制了内部 TextBox 控件的背景，但 UserControl 的背景颜色仍然存在。有什么方法可以删除 UserControl 的背景画吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-07T13:25:48.183

有很多方法可以做到这一点，但我建议在您的用户控件上公开您自己的属性并绑定到您的用户控件内部。例如：

```
<UserControl x:Name="_root" ...>
    ...
    <Button Background="{Binding ButtonBackground, ElementName=_root}"/>
</UserControl> 
```

另一种方法是明确地将背景颜色设置`TextBox`为某物。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-07T14:16:56.770

我同意肯特的观点。有多种方法可以解决此问题。

但是只使用 UserControl 中的 Style 来设置 TextBox 的背景呢？是否有任何特殊原因导致以下内容不适合您？

```
<UserControl
    x:Class="StackOverflowQuestion.UserControl1"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    Height="300"
    Width="300"
>
    <UserControl.Resources>
        <Style x:Key="textBoxStyle" TargetType="{x:Type TextBox}">
            <Setter Property="Background" Value="Red"/>
        </Style>
    </UserControl.Resources>
    <DockPanel>
        <TextBox Text="Test" Style="{StaticResource textBoxStyle}"/>
        <Button/>
    </DockPanel>
</UserControl> 
```

如果您真的想利用用户控件上的属性集并让它影响用户控件的内部，我会按照肯特的建议进行修改。我将绑定文本框的背景，以便用户在用户控件上设置的任何背景画笔都会流（属性值继承）到按钮。或者，换句话说，TextBox 的背景确实是您想要做出不同的东西。

```
<UserControl x:Name="_root" ...>
    <TextBox Background="{Binding TextBoxBackground, ElementName=_root}"/>
    <Button/>
</UserControl> 
```

# delphi - 如何在Delphi中将对象方法作为参数传递，然后调用它？

> ID：178138
> 
> 赞同：17
> 
> 时间：2008-10-07T12:04:18.380
> 
> 标签：delphi, pointers, callback

我担心这可能是一个有点愚蠢的问题，但它让我很困惑。

我正在寻找将对象的方法传递给过程的最简单方法，以便过程可以调用对象的方法（例如，在超时之后，或者可能在不同的线程中）。所以基本上我想：

*   捕获对对象方法的引用。
*   将该引用传递给一个过程。
*   使用该引用，从过程中调用对象的方法。

我想我可以使用接口实现相同的效果，但我认为还有另一种方法，因为存在这种“对象过程”类型声明。

以下内容*不起作用*，但它可能有助于解释我在哪里感到困惑......？

```
interface 
  TCallbackMethod = procedure of object;

  TCallbackObject = class
    procedure CallbackMethodImpl;
    procedure SetupCallback;
  end;

implementation

procedure CallbackTheCallback(const callbackMethod: TCallbackMethod);
begin
  callbackMethod();
end;

procedure TCallbackObject.CallbackMethodImpl;
begin
  // Do whatever.
end;

procedure TCallbackObject.SetupCallback;
begin
  // following line doesn't compile - it fails with "E2036 Variable required"
  CallbackTheCallback(@self.CallbackMethodImpl);
end; 
```

（一旦问题得到回答，我将删除上面的代码，除非它以某种方式有助于解释。）

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-10-07T12:15:50.807

只需删除指针的东西。德尔福会为你做：

```
procedure TCallbackObject.SetupCallback;
begin
  CallbackTheCallback(CallbackMethodImpl);
end; 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-07T18:22:49.020

您不需要指针语法的原因是您已将方法类型声明为对象过程。编译器将从“对象”语句中找出如何处理从回调过程中传递方法。

# ms-access - 如何使用 Microsoft Access 创建自动管理的“上次更新”字段

> ID：178144
> 
> 赞同：5
> 
> 时间：2008-10-07T12:05:12.310
> 
> 标签：ms-access

最初我想问是否有一种简单的方法可以使用 MS Access 提供自动管理的最后更新字段。

经过一番谷歌搜索后，我发现了以下方法：

```
Private Sub Form_Dirty(Cancel As Integer)

   Me.Last_Update = Date()

End Sub 
```

这似乎可以完成这项工作。我想我也会与其他人分享（如果有人有一些值得考虑的优点，请随时分享）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-07T14:55:29.733

此外，添加列验证规则（或`CHECK`约束）以确保在更新表时更新“时间戳”列，而不是通过您的表单。SQL DLL（ANSI-92 查询模式语法）看起来像这样：

```
CREATE TABLE MyTable 
(
   key_col INTEGER NOT NULL UNIQUE, 
   data_col INTEGER NOT NULL
)
;
ALTER TABLE MyTable ADD
   my_timestamp_col  DATETIME 
      DEFAULT NOW() 
   NOT NULL
;
ALTER TABLE MyTable ADD
   CONSTRAINT my_timestamp_col__must_be_current_timestamp
      CHECK (my_timestamp_col = NOW())
; 
```

使用 Jet 4.0（Access 2007 之前，即在从引擎中删除用户级安全性之前）的另一种方法是创建一个“助手”Jet SQL `PROCEDURE`（访问术语：使用 SQL 'Action' 语句定义的存储查询对象，与一个 SQL`SELECT`查询），它会自动更新“时间戳”列，然后从表中删除“更新”权限，并在`PROC`例如 SQL DDL/DCL 上授予它们，例如：

```
CREATE PROCEDURE MyProc 
(
   arg_key INTEGER, 
   arg_new_data INTEGER
)
AS 
UPDATE MyTable
   SET data_col = arg_new_data, 
       my_timestamp_col = NOW()
 WHERE key_col = arg_key
;
REVOKE UPDATE ON MyTable FROM PUBLIC
;
GRANT UPDATE ON MyProc TO PUBLIC
; 
```

这里的优点是所有更新都必须通过`PROC`，因此在开发人员的控制之下；缺点是 Access/Jet SQL 是您的表单也必须使用`PROC`，这意味着范式转变远离了 Access 著名的标准“数据绑定表单”方法。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-07T18:31:15.617

您也可以将相同的代码放入更新前。

不同之处在于 OnDirty 将在您第一次开始编辑记录时标记记录；而 BeforeUpdate 将在记录提交到数据库之前对其进行标记。

如果您的用户开始编辑记录、参加会议并在一小时后完成编辑，则后者可能更可取。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-07T12:14:33.100

在具有访问后端的访问数据库上，这可能是您的最佳选择——但如果您有一个 MS-SQL 后端，请在表上放置一个更新触发器，以便您可以捕获编辑，无论它们来自何处。

```
CREATE TRIGGER [Table_stampUpdates] ON [dbo].[Table]
 FOR Update 
AS 
BEGIN 
UPDATE Table
SET 
modified_by = right(system_user, len(system_user) - charindex('\', system_user)), modified_on = getdate() 
FROM Table inner join inserted on Table.PrimaryKey = Inserted.PrimaryKey
 END 
```

# c# - 如何验证 Windows 服务是否正在运行

> ID：178147
> 
> 赞同：194
> 
> 时间：2008-10-07T12:05:59.717
> 
> 标签：c#, windows-services, watchdog

我有一个 C# 应用程序（在 XP 嵌入式上运行 2.0），它与作为 Windows 服务实现的“看门狗”通信。当设备启动时，此服务通常需要一些时间才能启动。我想从我的代码中检查服务是否正在运行。我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：396
> 
> 时间：2008-10-07T12:10:39.240

我想这样的事情会起作用：

添加`System.ServiceProcess`到您的项目引用（它在 .NET 选项卡上）。

```
using System.ServiceProcess;

ServiceController sc = new ServiceController(SERVICENAME);

switch (sc.Status)
{
    case ServiceControllerStatus.Running:
        return "Running";
    case ServiceControllerStatus.Stopped:
        return "Stopped";
    case ServiceControllerStatus.Paused:
        return "Paused";
    case ServiceControllerStatus.StopPending:
        return "Stopping";
    case ServiceControllerStatus.StartPending:
        return "Starting";
    default:
        return "Status Changing";
} 
```

编辑：还有一种方法`sc.WaitforStatus()`可以获取所需的状态和超时，从未使用过它，但它可能适合您的需要。

编辑：获得状态后，要再次获得状态，您需要先致电`sc.Refresh()`。

参考： .NET 中的[ServiceController](http://msdn.microsoft.com/en-us/library/system.serviceprocess.servicecontroller(VS.80).aspx)对象。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2014-06-24T07:48:58.367

在这里，您可以获得本地计算机中的所有可用服务及其状态。

```
ServiceController[] services = ServiceController.GetServices();
foreach(ServiceController service in services)
{
    Console.WriteLine(service.ServiceName+"=="+ service.Status);
} 
```

您可以将您的服务与循环内的 service.name 属性进行比较，并获得服务的状态。有关详细信息，请访问 [http://msdn.microsoft.com/en-us/library/system.serviceprocess.servicecontroller.aspx](http://msdn.microsoft.com/en-us/library/system.serviceprocess.servicecontroller.aspx) 也 [http://msdn.microsoft.com/en-us/library/microsoft.windows.design .servicemanager(v=vs.90).aspx](http://msdn.microsoft.com/en-us/library/microsoft.windows.design.servicemanager(v=vs.90).aspx)

# c++ - 通过 MAPI 读取 Exchange 服务器时间

> ID：178173
> 
> 赞同：2
> 
> 时间：2008-10-07T12:15:37.873
> 
> 标签：c++, exchange-server, mapi

我想计算 Exchange 邮箱中邮件的年龄，以确保它们在我们的程序（C++、MAPI）处理它们之前至少在那里停留一分钟。这样[我们使用的垃圾邮件过滤器](http://www.cloudmark.com/server/)应该有足够的时间来完成它的工作。

因为我们的程序运行的 PC 上的时间可能与 Exchange 服务器使用的时间不同，所以我们的程序必须通过 MAPI 读取服务器时间。

有没有优雅的解决方案？我能想到的一种方法是修改一些 Item 并立即阅读它的*PR_LAST_MODIFICATION_TIME*，但我想避免这种情况。

**编辑：**
我们的程序是一个批处理作业，每 10 分钟运行一次并读取日志邮箱。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-08T01:01:32.600

我认为当邮件到达 Exchange 邮箱时，您会收到 MAPI 事件通知。我建议将这些消息推入队列并`n`在处理消息之前等待几秒钟（例如 60 秒）。由于时间与通知事件相关，因此计算机之间的时钟漂移不会有问题。

在启动您的应用程序时，您将被迫再次对现有消息执行此操作，但我不认为这会造成问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-07T12:25:37.323

您可以使用`PR_MESSAGE_DELIVERY_TIME`.

根据[MSDN](http://msdn.microsoft.com/en-us/library/ms528590(EXCHG.10).aspx "MSDN")：

> 该`PR_MESSAGE_DELIVERY_TIME`属性描述了消息存储在服务器上的时间，而不是传输提供程序将消息从服​​务器复制到本地存储时的下载时间。

除此之外 - 当您的解决方案无论如何都在客户端上运行时 - 为什么不首先使用客户端时间？时钟是否不正确，对于相对时间（例如“...之后一分钟”），这应该没有区别。

# ruby - OO 设计：Ruby 类的多重持久性设计

> ID：178187
> 
> 赞同：1
> 
> 时间：2008-10-07T12:19:37.693
> 
> 标签：ruby, oop

我正在为我的邮件服务器的日志条目设计一个类。我已经解析了日志条目并创建了类层次结构。现在我需要将内存中的表示保存到磁盘。我需要将它保存到多个目的地，如 mysql 和磁盘文件。我不知道设计持久性机制的正确方法。挑战是：

1.  如何传递持久性初始化信息，如文件名、传递给它们的数据库连接参数。我能想到的选项都很丑，例如：

    1.1 构造函数：随着我添加更多持久性，它变得丑陋。

    1.2 方法：Object.mysql_params(" ")，又是丑陋的屁股

2.  调用每个持久性机制的“正确”方法名称：例如：Object.save_mysql、Object.save_file 或 Object.save (mysql) 和 Object.save(file)

我确信有一些模式可以解决这个特定问题。我使用 ruby​​ 作为我的语言，没有任何轨道，即纯 ruby​​ 代码。任何线索都非常受欢迎。

拉吉

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-07T13:45:28.050

就我个人而言，我会打破一些东西 - 表示日志条目的对象真的不应该担心它应该如何保存它，所以我可能会创建一个 MySQLObjectStore 和 FileObjectStore，您可以单独配置它们并通过要保存的对象。您可以为您的 Object 类提供一个包含存储类型的类变量，以便在保存时调用。

```
class Object
  cattr_accessor :store

  def save
    @@store.save(self)
  end
end

class MySQLObjectStore
  def initialize(connection_string)
    # Connect to DB etc...
  end

  def save(obj)
    # Write to database
  end
end

store = MySQLObjectStore.new("user:password@localhost/database")
Object.store = store

obj = Object.new(foo)
obj.save 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-07T13:53:42.387

除非我完全误解了你的问题，否则我建议使用策略模式。与其让这个类尝试写入所有这些不同的源，不如将该责任委托给另一个类。有一堆 LogWriter 类，每个类都负责将对象保存到特定的数据存储中。所以你可能有一个 MySqlLogWriter、FileLogWriter 等。

这些对象中的每一个都可以自己实例化，然后可以将持久性对象传递给它：

```
lw = FileLogWriter.new "log_file.txt"
lw.Write(log) 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-07T13:57:12.503

你真的应该在这里分开你的担忧。消息和保存消息的方式是两个不同的东西。事实上，在很多情况下，不为每条消息打开一个新的 mysql 连接或新的文件指针也会更有效。

我将创建一个由 FileSaver 和 MysqlSaver 扩展的 Saver 类，它们每个都有一个保存方法，该方法传递您的消息。saver 负责提取消息中适用的部分并将它们保存到它负责的介质中。

# c# - C#中的位域

> ID：178188
> 
> 赞同：4
> 
> 时间：2008-10-07T12:19:56.787
> 
> 标签：c#, data-structures, bit-manipulation, bit-fields

所以，位域。具体来说，大位域。我了解如何在位域中操作单个值，但是我将如何在一个大集合上执行此操作，例如：

```
uint[] bitfield = new uint[4] { 0x0080000, 0x00FA3020, 0x00C8000, 0x0FF00D0 }; 
```

我遇到的具体问题是在整个阵列中进行左右移位。因此，例如，如果我`>> 4`在上面的数组上做了一个，我最终会得到：

```
uint[4] { 0x0008000, 0x000FA302, 0x000C800, 0x00FF00D }; 
```

现在，这里的一个（过于）简单化的算法可能看起来像（这是我在运行中编写代码）：

```
int shift = 4;
for (int i = 0; i <= shift; i++) {
    for (int j = bitfield.GetUpperBound(0); j > 0; j--) {
        bitfield[j] = bitfield[j] >> 1;
        bitfield[j] = bitfield[j] + ((bitfield[j-1] & 1) << (sizeof(uint)*8));
    }
    bitfield[0] = bitfield[0] >> 1;
} 
```

有什么内置的东西可以简化处理这类数据的工作吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-07T12:25:03.657

是什么让您认为 BitArray 在内部使用布尔值？它使用布尔值来表示 API 方面的位，但在底层我相信它使用 int[]。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-07T15:32:02.767

我不确定这是否是最好的方法，但这可能有效（将班次限制在 0-31 范围内。

```
 public static void ShiftLeft(uint[] bitfield, int shift) {

        if(shift < 0 || shift > 31) {
            // handle error here
            return;
        }

        int len = bitfield.Length;
        int i = len - 1;
        uint prev = 0;

        while(i >= 0) {
            uint tmp        = bitfield[i];
            bitfield[i] = bitfield[i] << shift;
            if(i < len - 1) {
                bitfield[i] |= (uint)(prev & (1 >> shift) - 1 ) >> (32 - shift);
            }
            prev = tmp;

            i--;
        }

    }

    public static void ShiftRight(uint[] bitfield, int shift) {

        if(shift < 0 || shift > 31) {
            // handle error here
            return;
        }
        int len = bitfield.Length;
        int i = 0;
        uint prev = 0;

        while(i < len) {
            uint tmp        = bitfield[i];
            bitfield[i] = bitfield[i] >> shift;
            if(i > 0) {
                bitfield[i] |= (uint)(prev & (1 << shift) - 1 ) << (32 - shift);
            }
            prev = tmp;

            i++;
        }

    } 
```

PD：有了这个改变，你应该能够处理大于 31 位的移位。可以对其进行重构以使其看起来不那么难看，但是在我的测试中，它可以工作并且在性能方面似乎并不算太​​差（除非实际上有内置的东西可以处理大型位集，可能就是这种情况）。

```
 public static void ShiftLeft(uint[] bitfield, int shift) {

        if(shift < 0) {
            // error
            return;
        } 

        int intsShift = shift >> 5;

        if(intsShift > 0) {
            if(intsShift > bitfield.Length) {
                // error
                return;
            }

            for(int j=0;j < bitfield.Length;j++) {
                if(j > intsShift + 1) {     
                    bitfield[j] = 0;
                } else {
                    bitfield[j] = bitfield[j+intsShift];
                }
            }

            BitSetUtils.ShiftLeft(bitfield,shift - intsShift * 32);
            return;
        }

        int len = bitfield.Length;
        int i = len - 1;
        uint prev = 0;

        while(i >= 0) {
            uint tmp    = bitfield[i];
            bitfield[i] = bitfield[i] << shift;
            if(i < len - 1) {
                bitfield[i] |= (uint)(prev & (1 >> shift) - 1 ) >> (32 - shift);
            }
            prev = tmp;

            i--;
        }

    }

    public static void ShiftRight(uint[] bitfield, int shift) {

        if(shift < 0) {
            // error
            return;
        } 

        int intsShift = shift >> 5;

        if(intsShift > 0) {
            if(intsShift > bitfield.Length) {
                // error
                return;
            }

            for(int j=bitfield.Length-1;j >= 0;j--) {
                if(j >= intsShift) {        
                    bitfield[j] = bitfield[j-intsShift];
                } else {
                    bitfield[j] = 0;
                }
            }

            BitSetUtils.ShiftRight(bitfield,shift - intsShift * 32);
            return;
        }

        int len = bitfield.Length;
        int i = 0;
        uint prev = 0;

        while(i < len) {
            uint tmp    = bitfield[i];
            bitfield[i] = bitfield[i] >> shift;
            if(i > 0) {
                bitfield[i] |= (uint)(prev & (1 << shift) - 1 ) << (32 - shift);
            }
            prev = tmp;

            i++;
        }

    } 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-07T14:09:44.757

使用扩展方法，您可以这样做：

```
public static class BitArrayExtensions
{
    public static void DownShift(this BitArray bitArray, int places)
    {
        for (var i = 0; i < bitArray.Length; i++)
        {
            bitArray[i] = i + places < bitArray.Length && bitArray[i + places];
        }
    }

    public static void UpShift(this BitArray bitArray, int places)
    {
        for (var i = bitArray.Length - 1; i >= 0; i--)
        {
            bitArray[i] = i - places >= 0 && bitArray[i - places];
        }
    }
} 
```

不幸的是，我想不出一种方法来重载班次运算符。（主要是因为`BitArray`是密封的。）

如果您打算操作`int`s 或`uint`s，您可以创建扩展方法来将位插入/从`BitArray`. （`BitArray`有一个构造函数，它接受一个 s 数组`int`，但这只会带你走那么远。）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-07T14:23:33.263

这不包括具体的移位，但对于处理大型集合可能很有用。它在 C 中，但我认为它可以很容易地适应 C#

[位掩码的大小是否有实际限制？](https://stackoverflow.com/questions/177054/is-there-a-practical-limit-to-the-size-of-bit-masks#177092)

# asp.net-mvc - 在 ASP.NET MVC 中，我在使用正确的类型化对象呈现页面时遇到不正确的类型错误

> ID：178194
> 
> 赞同：6
> 
> 时间：2008-10-07T12:23:21.493
> 
> 标签：asp.net-mvc

我正在使用 MVC Preview 5 开发应用程序。我使用了类型化视图。

设置 debug="false" 后，我发现我收到以下形式的错误：

> “传入字典的模型项的类型为'blah.Models.UserAdmin.IndexData'，但该字典需要'blah.Models.OrganisationAdmin.IndexData'类型的模型项”。

打开调试时，我没有收到这些错误。

看起来 MVC 框架正在按视图名称缓存视图。如果我有两个使用同名视图的操作（尽管在不同的命名空间中），我发现只有第一个执行的操作是成功的，第二个总是导致这个错误。

例如，我有一个 UserAdminController 和一个 OrganisationAdminController。

*   两者都有一个“索引”动作。

*   两者都使用名为“Index.aspx”的视图（每个都包含在控制器的视图文件夹中；Views/UserAdmin/Index.aspx 和 Views/OrganisationAdmin.Index.aspx）。

*   两个视图都是类型化的，并使用称为 IndexData 的模型（blah.Models.UserAdmin.IndexData 和 blah.Models.OrganisationAdmin.IndexData）

如果我首先访问 OrganisationAdmin/Index，我发现任何后续尝试查看 UserAdmin/Index 都会导致上面显示的错误消息。

相反，如果我首先访问 UserAdmin/Index（在重新启动应用程序后），我发现导航到 OrganisationAdmin/Index 会导致等效错误（类型相反）。

我将我的一个视图重命名为“UserAdminIndex.aspx”，这似乎解决了这个问题。但是，这不应该是一个问题。MVC 框架肯定支持类似命名的视图吗？我错过了什么？

感激地收到任何帮助。

沙

请注意，我看到了“在 ASP.NET MVC 中，我在使用正确的类型化对象呈现用户控件时遇到了不正确的类型错误”的问题。我面临着类似的问题，但我没有使用 RenderUserControl()。

堆栈跟踪：

```
InvalidOperationException: The model item passed into the dictionary is of type 'blah.Models.RoleAdmin.IndexData' but this dictionary requires a model item of type 'blah.Models.UserAdmin.IndexData'.]
   System.Web.Mvc.ViewDataDictionary`1.SetModel(Object value) +231
   System.Web.Mvc.ViewDataDictionary..ctor(ViewDataDictionary viewDataDictionary) +99
   System.Web.Mvc.ViewPage`1.SetViewData(ViewDataDictionary viewData) +60
   System.Web.Mvc.WebFormView.RenderViewPage(ViewContext context, ViewPage page) +64
   System.Web.Mvc.WebFormView.Render(ViewContext viewContext, TextWriter writer) +85
   System.Web.Mvc.ViewResult.ExecuteResult(ControllerContext context) +206
   System.Web.Mvc.ControllerActionInvoker.InvokeActionResult(ActionResult actionResult) +19
   System.Web.Mvc.<>c__DisplayClass12.<InvokeActionResultWithFilters>b__f() +18
   System.Web.Mvc.ControllerActionInvoker.InvokeActionResultFilter(IResultFilter filter, ResultExecutingContext preContext, Func`1 continuation) +257
   System.Web.Mvc.<>c__DisplayClass14.<InvokeActionResultWithFilters>b__11() +20
   System.Web.Mvc.ControllerActionInvoker.InvokeActionResultFilter(IResultFilter filter, ResultExecutingContext preContext, Func`1 continuation) +257
   System.Web.Mvc.<>c__DisplayClass14.<InvokeActionResultWithFilters>b__11() +20
   System.Web.Mvc.ControllerActionInvoker.InvokeActionResultWithFilters(ActionResult actionResult, IList`1 filters) +188
   System.Web.Mvc.ControllerActionInvoker.InvokeAction(ControllerContext controllerContext, String actionName) +386
   System.Web.Mvc.Controller.ExecuteCore() +112
   System.Web.Mvc.ControllerBase.Execute(RequestContext requestContext) +23
   System.Web.Mvc.ControllerBase.System.Web.Mvc.IController.Execute(RequestContext requestContext) +7
   System.Web.Mvc.MvcHandler.ProcessRequest(HttpContextBase httpContext) +107
   System.Web.Mvc.MvcHandler.ProcessRequest(HttpContext httpContext) +39
   System.Web.Mvc.MvcHandler.System.Web.IHttpHandler.ProcessRequest(HttpContext httpContext) +7
   System.Web.CallHandlerExecutionStep.System.Web.HttpApplication.IExecutionStep.Execute() +181
   System.Web.HttpApplication.ExecuteStep(IExecutionStep step, Boolean& completedSynchronously) +75 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2014-07-14T09:51:15.077

这个错误让我发疯。该模型被指定在我的视图顶部。然而，该死的事情是要求一个不同的模型。

原来在已经成为布局页面的地方有一个孤立的 ModelType 引用。它在我的视图中被引用为 Layout = "~/Views/_layout.vbhtml"

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-07T13:23:42.743

是的，该错误已报告。最好暂时保留调试，或修改有问题的代码（抱歉不记得在哪里）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-08-26T11:21:33.710

我认为您的用户控件和视图具有相同的名称。

# python - Python：我可以有一个带有命名索引的列表吗？

> ID：178199
> 
> 赞同：45
> 
> 时间：2008-10-07T12:25:25.170
> 
> 标签：python, arrays

在 PHP 中，我可以命名我的数组索引，这样我就可以有类似的东西：

```
$shows = Array(0 => Array('id' => 1, 'name' => 'Sesame Street'), 
               1 => Array('id' => 2, 'name' => 'Dora The Explorer')); 
```

这在 Python 中可能吗？

* * *

## 回答 #1

> 赞同：62
> 
> 时间：2008-10-07T12:29:57.673

这听起来像使用命名索引的 PHP 数组与 python dict 非常相似：

```
shows = [
  {"id": 1, "name": "Sesaeme Street"},
  {"id": 2, "name": "Dora The Explorer"},
] 
```

有关更多信息，请参阅[http://docs.python.org/tutorial/datastructures.html#dictionaries](http://docs.python.org/tutorial/datastructures.html#dictionaries)。

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2008-10-07T12:33:18.647

PHP 数组实际上是映射，相当于 Python 中的 dicts。

因此，这是 Python 的等价物：

`showlist = [{'id':1, 'name':'Sesaeme Street'}, {'id':2, 'name':'Dora the Explorer'}]`

排序示例：

```
from operator import attrgetter

showlist.sort(key=attrgetter('id')) 
```

但！使用您提供的示例，更简单的数据结构会更好：

```
shows = {1: 'Sesame Street', 2:'Dora the Explorer'} 
```

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2008-10-07T14:21:43.563

@Unkwntech，

你想要的东西在刚刚发布的 Python 2.6 中以[命名元组](http://docs.python.org/whatsnew/2.6.html#new-improved-and-deprecated-modules)的形式提供。他们允许你这样做：

```
import collections
person = collections.namedtuple('Person', 'id name age')

me = person(id=1, age=1e15, name='Dan')
you = person(2, 'Somebody', 31.4159)

assert me.age == me[2]   # can access fields by either name or position 
```

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2008-10-07T12:29:21.277

是的，

```
a = {"id": 1, "name":"Sesame Street"} 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2016-09-03T13:39:23.260

该`pandas`库有一个非常简洁的解决方案：`Series`.

```
book = pandas.Series( ['Introduction to python', 'Someone', 359, 10],
   index=['Title', 'Author', 'Number of pages', 'Price'])
print book['Author'] 
```

有关更多信息，请查看它的文档： http: [//pandas.pydata.org/pandas-docs/stable/generated/pandas.Series.html](http://pandas.pydata.org/pandas-docs/stable/generated/pandas.Series.html)。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2020-06-05T06:21:00.210

我想你要问的是关于 python 字典的问题。在那里你可以随意命名你的索引。例如：

```
dictionary = {"name": "python", "age": 12} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-07T15:55:45.150

Python 将列表和字典作为 2 个独立的数据结构。PHP 将两者合二为一。在这种情况下，您应该使用 dicts。

* * *

## 回答 #8

> 赞同：-2
> 
> 时间：2008-10-13T22:32:51.077

我是这样做的：

```
def MyStruct(item1=0, item2=0, item3=0):
    """Return a new Position tuple."""
    class MyStruct(tuple):
        @property
        def item1(self):
            return self[0]
        @property
        def item2(self):
            return self[1]
        @property
        def item3(self):
            return self[2]
    try:
        # case where first argument a 3-tuple                               
        return MyStruct(item1)
    except:
        return MyStruct((item1, item2, item3)) 
```

我用列表而不是元组做了更复杂的操作，但是我覆盖了 setter 和 getter。

无论如何，这允许：

```
 a = MyStruct(1,2,3)
    print a[0]==a.item1 
```

# java - JSP 中的 IP 子网验证

> ID：178200
> 
> 赞同：2
> 
> 时间：2008-10-07T12:25:31.707
> 
> 标签：java, ip-address, netmask

我有以下 JSP 代码，它保护我的网页并仅显示它以了解 IP

```
String ip_h = request.getRemoteAddr();  
String host_h = request.getRemoteHost();  
String iplist[] = new String[1];  
iplist[0] = "127.0.0.1";  
iplist[1] = "10.217.106.248";  

int count = iplist.length;  
boolean flag = false;  
int zz = 0;  
//return;
System.out.println(host_h);  
while ( (flag==false) && ( zz < count) )  
{  
   if (ip_h.equals(iplist[zz]) || host_h.equals(iplist[zz]) )  
   {  
      flag = true;  
   }  
   zz++;  
} 
```

但是，我宁愿检查子网范围，即允许所有属于 10.217.0.0/16 的用户。

我该怎么做呢？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-07T12:46:09.933

IP 地址（至少是 IPv4 地址）实际上旨在表示为 32 位整数。如果您首先将 IP 地址转换为整数，则检查子网范围变得相对简单，即检查（在您的示例中）前 16 位是否与范围的前 16 位匹配。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-07T12:46:43.880

你不想使用应用程序服务器来锁定 IP 范围吗？在 apache 中，您可以为目录创建别名，将代码放在目录中，然后在 alias 指令中只允许某些 ip 或范围：

别名 /mydir "/usr/local/mydir"

order deny,allow deny from all Allow from 10.217.106.248 Allow from 127.0.0.1 allow from 10.217.106 #这是一个范围

这样你就不必编码这种“幻数”

我相信你可以在其他网络服务器上做这种事情

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-07T14:11:29.463

随意使用这个 IpRangeFilter 类。请参阅班级评论以获取解释。

```
import java.net.InetAddress;
import java.net.UnknownHostException;
import java.util.regex.Matcher;
import java.util.regex.Pattern;

import org.apache.commons.collections15.Predicate;
import org.apache.commons.lang.builder.EqualsBuilder;
import org.apache.commons.lang.builder.HashCodeBuilder;

/**
 * I am a filter used to determine if a given IP Address is covered by the IP range specified in 
 * the constructor.  I accept IP ranges in the form of full single IP addresses, e.g. 10.1.0.23
 * or network/netmask pairs in CIDR format e.g. 10.1.0.0/16
 */
public class IpRangeFilter implements Predicate<InetAddress> {

    private final long network;
    private final long netmask;

    private final String ipRange;

    private static final Pattern PATTERN = Pattern.compile("((?:\\d|\\.)+)(?:/(\\d{1,2}))?");

    public IpRangeFilter(String ipRange) throws UnknownHostException {
        Matcher matcher = PATTERN.matcher(ipRange);
        if (matcher.matches()) {
            String networkPart = matcher.group(1);
            String cidrPart = matcher.group(2);

            long netmask = 0;
            int cidr = cidrPart == null ? 32 : Integer.parseInt(cidrPart);
            for (int pos = 0; pos < 32; ++pos) {
                if (pos >= 32-cidr) {
                    netmask |= (1L << pos);
                }
            }

            this.network = netmask & toMask(InetAddress.getByName(networkPart));
            this.netmask = netmask;
            this.ipRange = ipRange;

        } else {
            throw new IllegalArgumentException("Not a valid IP range: " + ipRange);
        }
    }

    public String getIpRange() {
        return ipRange;
    }

    public boolean evaluate(InetAddress address) {
        return isInRange(address);
    }

    public boolean isInRange(InetAddress address) {
        return network == (toMask(address) & netmask);
    }

    /**
     * Convert the bytes in the InetAddress into a bit mask stored as a long.
     * We could use int's here, but java represents those in as signed numbers, which can be a pain 
     * when debugging.
     * @see http://www.captain.at/howto-java-convert-binary-data.php
     */
    static long toMask(InetAddress address) {
        byte[] data = address.getAddress();
        long accum = 0;
        int idx = 3;
        for ( int shiftBy = 0; shiftBy < 32; shiftBy += 8 ) {
            accum |= ( (long)( data[idx] & 0xff ) ) << shiftBy;
            idx--;
        }
        return accum;
    }
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-07T12:54:31.320

试试`Subnet`这个[错误报告](http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=4262187)中的课程。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-07T13:06:38.707

您可以使用以下代码，当然它假设输入数据是正确的，所以它需要一些美化（以防万一）

```
public class IPUtil
{

    private static int[] split(String ip)
    {
        int[] result = new int[4];
        StringTokenizer st = new StringTokenizer(ip, ".");
        for (int i = 0; i < 4; i++)
        {
            result[i] = Integer.parseInt(st.nextToken());
        }
        return result;
    }

    public static boolean matches(String visitorIpString, String ipString, String maskString)
    {
        int[] vip = split(visitorIpString);
        int[] ip = split(ipString);
        int[] mask = split(maskString);

        for (int i = 0; i < 4; i++)
        {
            if ((vip[i] & mask[i]) != ip[i])
            {
                return false;
            }
        }
        return true;
    }

    public static void main(String[] args)
    {

        String ip = "192.168.12.0";
        String mask = "255.255.255.0";
        String visitorIP = "192.168.12.55";

        System.out.println(matches(visitorIP, ip, mask));
    }
} 
```

# .net - 业务对象 DAL 设计

> ID：178203
> 
> 赞同：5
> 
> 时间：2008-10-07T12:26:09.163
> 
> 标签：.net, data-access-layer, business-objects

在设计业务对象时，我尝试了几种不同的方法来编写数据访问层。有些人比其他人做得更好，但我一直觉得必须有一个“更好”的方法。

我真的很想看看人们在不同情况下处理 DAL 的不同方式，以及他们对该技术如何运作或运作不佳的看法。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-07T13:20:01.283

我现在非常依赖[Billy McCafferty 的 NHibernate 最佳实践文章/许多 Web/WinForms 应用程序的示例代码](http://www.codeproject.com/KB/architecture/NHibernateBestPractices.aspx "文章在这里")。这是一篇写得很精彩的文章，除了教您基本的 NHibernate 和 TDD 之外，它还将为您提供一个很好的可靠示例架构。他试图向您概述他的架构和设计决策。

他使用通用 DataAccessObjects 创建了一个非常优雅的 DAL，您可以为每个域对象扩展它——并且它使用接口和 DAOFactory 非常松散地耦合到 BL。我建议首先查看 BasicSample，特别是如果您以前没有使用过 NHibernate。

请注意，本文严重依赖 NHibernate，但我认为可以轻松更改它的通用方法以适应其他 ORM。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-07T12:34:46.727

不幸的是，我认为没有“更好的方法”，它过于依赖于您使用的 DAL 方法的具体情况。Martin Fowler[的企业应用程序架构模式是](https://rads.stackoverflow.com/amzn/click/com/0321127420)对“最先进技术”的一个很好的讨论。

第 10 章，数据源架构模式专门讨论了业务应用程序中最常用的模式。

但总的来说，我发现使用满足基本可维护性和适应性要求的最简单方法是最佳选择。

例如，在最近的一个项目中，我只需要一个简单的“行数据网关”。（这只是为每个相关数据库表生成的代码类，包括执行 CRUD 操作的方法）。没有关于 ORM 与存储过程的无休止的争论，它只是工作，并且很好地完成了所需的工作。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-07T13:33:41.257

如果您要走 NHibernate 路线（上面@Watson 的好文章链接顺便说一句），那么我强烈建议您从 codebetter 签出 suvius-flamingo 示例项目。他有一个非常漂亮、简洁的示例项目，展示了 MVC 和 NHibernate 的实际应用。

这是[suvius-flamingo 链接](http://codebetter.com/blogs/kyle.baley/archive/2008/09/26/asp-net-mvc-sample-project-suvius-flamingo.aspx)。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-07T13:46:37.633

[更新]这不再有效，这个项目的设计被改变了[/更新]

在我们的开源项目 Bunian 中，我们得出结论，业务对象（整个组件）是系统的核心，一切都应该围绕它，包括数据访问层。

业务组件将向其他人指示它需要什么，通过 itnerfaces 暗示这一点。例如 Business Object *Person*将有一个名为*IRepositoryForPerson*的接口成员，该成员将在需要时通过依赖注入容器分配一个实例。

有关更多详细信息，请在此处查看我的博客文章：

[http://www.emadashi.com/index.php/2008/11/data-access-within-business-objects-bunian-design//](http://www.emadashi.com/index.php/2008/11/data-access-within-business-objects-bunian-design/)

并在这里查看 Bunian 的代码（虽然它还很业余）：

[http://www.codeplex.com/Bunian](http://www.codeplex.com/Bunian)

当然，这种方法会出现新事物，例如数据访问会话的生命周期（例如，如果您使用 NHibernate）。但那是我想的另一个问题:)

希望这个对你有帮助

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-07T14:10:56.897

我假设您的意思是编写访问 SQL 的 DAL，因为这是当今最常见的部分。如果针对 SQL 编写 DAL 的最大问题是 ORM 部分。也就是说，OO 编程和关系数据库模式之间存在根本的阻抗不匹配。在编写 ORM 方面已经有许多伟大的、甚至是成功的尝试。但是它们都面临着同样的问题，而这正是它们的好处：它们将您从正在生成的底层 SQL 中抽象出来。为什么这是一个问题，因为您的数据库的性能是您的系统整体运行情况的关键组成部分。许多 ORM（也许是大多数）不仅在许多标准查询中表现不佳，但实际上鼓励使用会大大降低性能的模式（查询集合时在循环内重复遍历关系是一个常见的例子，解决死锁是另一个例子）。当然，在详细学习了 ORM API 之后，通常可以找到绕过这些性能坑洞的方法。

我目前对 ORM 状态的看法是，我希望它做的事情尽可能少，同时仍然为我提供一个可靠的库的效率，该库负责处理数据访问的所有细节。换句话说，因为我认为它们还不够“好”，并且可能永远不会使用 SQL 作为后端，所以我想保留在裸机级别的控制权，我将通过以下方式开始编写 SQL在许多情况下，无论 ORM 是什么，都会毫不犹豫地动手，因为我知道我希望根据给定需求查询数据的具体方式。

这显然是一种比您虔诚地按照预期使用 ORM 更脆弱的编码方法，因此，您必须在单元测试、SQL 注入和适当的关注点分离方面更加勤奋。所以，总而言之，我同意 Ash，虽然这并不意味着他/她同意我 :)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-07T12:37:07.330

有几种常见的模式。[《企业架构模式》](https://rads.stackoverflow.com/amzn/click/com/0321127420)一书是这些方面的一个很好的参考：

*   表数据网关
*   行数据网关
*   活动记录
*   数据映射器

如果您使用 ORM，例如 llblgen，您可以选择自助服务或适配器。

# asp.net - 多租户 ASP.NET 网站中的用户可配置安全性

> ID：178210
> 
> 赞同：3
> 
> 时间：2008-10-07T12:29:19.483
> 
> 标签：asp.net, security, multi-tenant

我们正在用 ASP.NET 构建一个多租户网站，我们必须让每个客户配置自己的安全模型。他们必须能够定义自己的角色，并将用户置于这些角色中。做这个的最好方式是什么？

有很多简单的 page_load 事件示例，其代码如下：

```
 if (!user.InGroup("Admin")
       Response.Redirect("/NoAccess.aspx"); 
```

但这会对代码中的组和权限进行硬编码。如何使其用户可配置？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-07T12:54:51.430

也许将可配置的角色放在一个数据库表中，在其中存储角色和租户，然后将 PagePermissions 放在另一个表中，例如：

```
Table "Role"
RoleId, TenantId, Role

Table "PagePermissions"
PageId, RoleId

Table "UserRoles"
UserId, RoleId 
```

然后在页面加载中检查用户是否在具有该页面权限的 RoleId 中，例如：

```
Select PageId FROM 
UserRoles UR INNER JOIN PagePermissions PP
ON UR.RoleId = PP.RoleID
WHERE UR.Userid = @UserId AND PP.PageID = @PageId 
```

如果没有返回行，则拒绝该用户。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-07T12:37:03.850

我将为在配置文件中轻松管理的网站创建一个配置系统。您可以在哪里获得键入的成员并像这样使用。

```
foreach(var group in ThisPageConfiguration.AcceptedRoleNames)
if (user.IsInRole(group))
... 
```

然后每个客户都可以在他们的配置文件中配置他们的站点......以及您想要配置的所有其他类型的东西。

# java - log4j 与 logback

> ID：178215
> 
> 赞同：163
> 
> 时间：2008-10-07T12:30:08.157
> 
> 标签：java, logging, log4j, logback

我们在自制包装器后面使用 log4j。我们计划现在使用它的更多功能。

我们应该更新到 logback 吗？

（我的意思是框架不是像 SLF4J 这样的外观）

* * *

## 回答 #1

> 赞同：215
> 
> 时间：2009-05-29T09:08:04.973

Logback 原生实现了 SLF4J API。这意味着如果你使用 logback，你实际上是在使用 SLF4J API。从理论上讲，您可以直接使用 logback API 的内部进行日志记录，但非常不鼓励这样做。所有关于记录器的 logback 文档和示例都是根据 SLF4J API 编写的。

因此，通过使用 logback，您实际上是在使用 SLF4J，如果您出于任何原因想要切换回 log4j，只需将 slf4j-log4j12.jar 放到您的类路径中即可在几分钟内完成。

当从 logback 迁移到 log4j 时，logback 特定部分，特别是那些包含在*logback.xml*配置文件中的部分，仍然需要迁移到它的 log4j 等价物，即*log4j.properties*。当向另一个方向迁移时，需要将 log4j 配置（即*log4j.properties*）转换为其等效的 logback。有一个[在线工具](http://logback.qos.ch/translator/)可以做到这一点。迁移配置文件所涉及的工作量*远*少于迁移分布在所有软件源代码及其依赖项中的记录器调用所需的工作量。

* * *

## 回答 #2

> 赞同：56
> 
> 时间：2010-01-29T05:54:49.703

你应该？ **是**的。

为什么？ [Log4J](http://logging.apache.org/log4j/)基本上已被[Logback](http://logback.qos.ch/)弃用。

很紧急吗？也许不吧。

是无痛的吗？可能，但这可能取决于您的日志记录语句。

请注意，如果您真的想充分利用 LogBack（或 SLF4J），那么您确实需要编写[正确的日志记录语句](http://slf4j.org/faq.html#logging_performance)。这将产生一些优点，例如由于惰性评估而更快的代码，以及更少的代码行，因为您可以避免守卫。

最后，我强烈推荐 SLF4J。（为什么要用你自己的外观重新创建轮子？）

* * *

## 回答 #3

> 赞同：53
> 
> 时间：2014-03-01T14:06:43.617

在日志世界中，有 Facades（如 Apache Commons Logging、slf4j 甚至 Log4j 2.0 API）和实现（Log4j 1 + 2、java.util.logging、TinyLog、Logback）。

基本上你应该用 slf4j IF 替换你的自制包装器，并且只有当你出于某种原因对它不满意时。虽然 Apache Commons Logging 并没有真正提供现代 API，但 slf4j 和新的 Log4j 2 外观正在提供它。鉴于相当多的应用程序使用 slf4j 作为包装器，使用它可能是有意义的。

slf4j 提供了许多不错的 API 糖，例如 slf4j 文档中的这个示例：

`logger.debug("Temperature set to {}. Old temperature was {}.", t, oldT);`

这是变量替换。Log4j 2 也支持这一点。

但是你需要知道 slf4j 是由 QOS 开发的，他们也维护 logback。Log4j 2.0 在 Apache Software Foundation 中诞生。在过去的三年里，一个充满活力和活跃的社区再次在那里成长。如果你喜欢开源，因为它由 Apache 软件基金会提供所有保证，你可能会重新考虑使用 slf4j 以支持直接使用 Log4j 2。

请注意：

过去 log4j 1 没有被主动维护，而 Logback 是。但今天情况不同了。Log4j 2 得到积极维护，几乎定期发布。它还包括许多现代功能，并且 -imho- 使一些事情比 Logback 更好。这有时只是一个品味问题，您应该得出自己的结论。

我写了一篇关于 Log4j 2.0 新特性的快速概述：http: [//www.grobmeier.de/the-new-log4j-2-0-05122012.html](http://www.grobmeier.de/the-new-log4j-2-0-05122012.html)

阅读时您会发现 Log4j 2 的灵感来自 Logback，但也受到其他日志框架的启发。但是代码库不同；它与 Log4j 1 几乎没有任何共享，而与 Logback 共享零。这导致了一些改进，例如示例 Log4j 2 使用字节流而不是引擎盖下的字符串进行操作。此外，它在重新配置时不会丢失事件。

Log4j 2 可以以比我知道的其他框架更高的速度记录：http: [//www.grobmeier.de/log4j-2-performance-close-to-insane-20072013.html](http://www.grobmeier.de/log4j-2-performance-close-to-insane-20072013.html)

而且用户社区似乎仍然比 Logbacks 大得多：http: [//www.grobmeier.de/apache-log4j-is-the-leading-logging-framework-06082013.html](http://www.grobmeier.de/apache-log4j-is-the-leading-logging-framework-06082013.html)

总而言之，最好的主意是您选择最适合您想要实现的目标的日志框架。如果我在生产环境中禁用日志记录并仅在我的应用程序中执行基本日志记录，我不会切换完整的框架。但是，如果您在日志记录方面做得更多，只需查看框架及其开发人员提供的功能即可。虽然您通过 QOS 获得了对 Logback 的商业支持（我听说），但目前还没有对 Log4j 2 的商业支持。另一方面，如果您需要进行审计日志记录并且需要异步附加程序提供的高性能，那么这样做很有意义检查 log4j 2。

请注意，尽管它们提供了所有舒适，但外墙总是会吃一点性能。它可能根本不会影响您，但如果您的资源不足，您可能需要保存所有可以拥有的东西。

如果不更好地了解您的要求，几乎不可能给出建议。只是：不要因为很多人切换而切换。切换只是因为你看到了它的价值。而关于 log4j 已死的论点也不再重要了。它还活着，而且很热。

**免责声明：我目前是 Apache 日志服务副总裁，也参与了 log4j。**

* * *

## 回答 #4

> 赞同：20
> 
> 时间：2008-10-07T13:39:39.497

不完全回答您的问题，但是如果您可以摆脱自制的包装器，那么Hibernate 现在已切换到[Java 的简单日志记录外观 (SLF4J) （而不是公共日志记录）。](http://www.slf4j.org/)

> SLF4J 没有遇到使用 Jakarta Commons Logging (JCL) 观察到的类加载器问题或内存泄漏。

SLF4J 支持 JDK 日志记录、log4j 和 logback。所以在合适的时候从 log4j 切换到 logback 应该是相当容易的。

编辑：我没有说清楚的道歉。我建议使用 SLF4J 来隔离自己，不必在 log4j 或 logback 之间做出艰难的选择。

* * *

## 回答 #5

> 赞同：14
> 
> 时间：2008-10-07T14:28:25.327

你的决定应该基于

*   您对这些“更多功能”的实际需求；和
*   您实施变更的预期成本。

您应该抵制仅仅因为它“更新、更闪亮、更好”而改变 API 的冲动。我遵循“如果它没有坏，不要踢它”的政策。

如果您的应用程序需要一个非常复杂的日志框架，您可能需要考虑原因。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2012-08-14T19:33:33.483

Mature project or even project deep into development stages would probably loose more than gain from such upgrade, IMHO. Logback is certainly much more advanced in an array of points, but not to an extent for complete replacement in a working system. I would certainly consider logback for a new development, but existing log4j is good enough and mature for anything already released and met end user. This is very subjective, you should see cost yourself.

# casting - 在 Informix 中进行铸造

> ID：178216
> 
> 赞同：3
> 
> 时间：2008-10-07T12:30:58.387
> 
> 标签：casting, informix

在 Informix 中，如何将`char(8)`类型转换为`money`类型，以便可以将其与另一种`money`类型进行比较？

使用“ `tblAid.amt::money as aid_amt`”不起作用。使用“ `(tblAid.amt * 1) AS aid_amt`”不起作用。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-09T04:01:45.187

试试这个 -->

```
select (disb_amt::NUMERIC) disb_amt from tmp_kygrants; 
```

您可以将金额作为数字进行比较。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-09T18:43:51.223

第一个问题 - 为什么你不在数字列中存储数值？这将使您的其余问题变得毫无意义。这也意味着您的系统将表现得更好。当需要存储数据值时，使用明显类型；除非数据是字符串，否则不要使用字符串类型。

如前所述，您可以使用非标准 Informix 强制转换表示法：

```
SELECT some_column::MONEY FROM WhereEver; 
```

您还可以更加注意强制转换类型 - 例如使用 MONEY(8,2)。您还可以使用标准符号：

```
SELECT CAST(some_column AS MONEY(8,2)) FROM WhereEver; 
```

这假设您使用的是 IDS 9.x 或更高版本——旧产品根本不支持强制转换。然而，一般来说，Informix 非常擅长自动进行转换（例如，将数字转换为字符串）。但是，字符串是按字典顺序而不是数字进行比较的，因此在这种情况下 CAST 可能更明智——但首先通过使用正确的类型来避免强制转换的需要仍然更明智。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-09T04:18:08.600

自从我玩过 informix 以来已经有一段时间了，目前我手边没有一个正在运行的实例。但是，这里有两件事可能会导致问题：

1) 因为它是一个 char(8)，所以它可以包含在没有一点“清理”的情况下无法转换为数字的值。例如“abc”。或“1,234,567.00”。
2) 尾随空格。（char 与 varchar 相对）。

您在显式演员 (::money) 中遇到什么 informix 错误？

# php - 最佳实践：放置所需文件的位置

> ID：178228
> 
> 赞同：2
> 
> 时间：2008-10-07T12:34:39.987
> 
> 标签：php, coding-style

我正在使用许多“帮助器”类，它们有效地具有一堆静态函数，允许控制器和操作访问共享功能块。

问题是这些文件已被用作跨模块/应用程序所需的任何功能的垃圾场，因此它们的大小 > 3k 行，并且在顶部它们有大约 50 个`require_once`声明！

显然，如果应用程序中的视图不想使用这些帮助程序提供的一小部分功能，它会继承所有必需的文件，最终导致应用程序膨胀。

`require_once`如果我要根据需要包含文件，那么当我需要使用这些帮助程序提供的大量功能时，我最终可能会对所需文件进行多次调用，这有它自己的开销（与频率相结合）文件。

所以基本上我的问题是在哪里取得平衡，是否有可以采用的最佳实践？

谢谢，

弗隆加

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-07T12:38:09.730

看看[自动加载功能](http://www.php.net/autoload)。这将在需要时将您的所有内容减少到仅需要的内容。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-07T12:40:57.883

构建此类依赖项以保持“非循环”时最好的选择。您可以让更高级别的功能“需要”它需要运行的低级别功能，但以某种方式设计它，以便事物不会相互指向。

这样，通过将其分解为足够小的单元，您将能够确保当您不需要所有模块时，只引入最少数量的依赖项。

我当然不知道有任何理由“要求”您不会在页面中使用的代码。

# language-agnostic - 除了作为一系列视图之外，人们还能如何呈现架构文档？

> ID：178231
> 
> 赞同：3
> 
> 时间：2008-10-07T12:34:49.003
> 
> 标签：language-agnostic, architecture

大多数（如果不是所有）我见过（和开发）的架构文档都以一系列视图（逻辑、物理、用例等）的形式呈现。这是首选布局吗？还有哪些其他款式？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-07T13:23:20.327

由于它很复杂，否则很难做到。

我喜欢从总体要求的单段摘要开始。如果没有一个段落摘要，那可能是最重要的构建。

一旦总结出来，就会有架构特性的概述。在那之后，没有人会读一个字。

这不是小说。没有故事情节。没有剧情。没有冲突。没有字符。至少，我找不到使架构可读的方法。

您可以期望的最好的参考作品是具有足够的索引、交叉引用、概述和侧边栏供人们使用的参考作品。

事实上，重要的是拉出。图片是所有任何人都会使用的。这些将被放入PPT中，用于内部和外部演示。

所以，不要在写作上浪费太多时间。将时间花在人们每天想要使用的概述、摘要、功能列表和图片上。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-07T16:00:04.767

这可能是题外话，但无论如何使用[Joel 的想法来使规范“有趣”](http://www.joelonsoftware.com/articles/fog0000000033.html)可用是这个领域吗？

# c# - 凭证缓存

> ID：178233
> 
> 赞同：0
> 
> 时间：2008-10-07T12:35:29.580
> 
> 标签：c#, vb.net, active-directory, credentials

有谁知道如何使用凭证缓存或网络凭证使用 C# 或 VB 从 Active Directory 获取用户的个人信息？我需要获取个人信息，例如姓名、电话 ID 等。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-07T12:41:32.343

请参阅[System.DirectoryServices 类文档](http://msdn.microsoft.com/en-us/library/system.directoryservices.aspx)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-19T21:27:28.600

```
DirectorySearcher ds = new DirectorySearcher("LDAP://DC=test,dc=com");
ds.Filter = String.Format("&(samaccountname={0})(objectcategory=user)",Environment.Username);
ds.PropertiesToLoad.Add("telephoneNumber");
ds.PropertiesToLoad.Add("Name");
// add all properties here
DirectoryEntry de = ds.FindOne(); 
```

默认情况下，用户将有足够的权限阅读自己的个人详细信息。
如果他们不这样做，您可能需要在您的目录上使用委派以允许 SELF 读取访问额外属性

> ID：178247
> 
> 赞同：
> 
> 时间：
> 
> 标签：

None

# authentication - 如何实现查询字符串认证

> ID：178251
> 
> 赞同：3
> 
> 时间：2008-10-07T12:40:57.480
> 
> 标签：authentication

我正在开发一个客户的网站，他们正在向他们的客户发送时事通讯（通过网站管理界面）。时事通讯对于每个订阅的收件人/客户都是个人的。每个收件人/客户也是具有用户名/密码的用户，使他们能够登录网站并管理他们的时事通讯订阅并参与网站社区。

这一切都像一个魅力。现在我的客户想要在时事通讯电子邮件中添加一个“管理我的订阅”链接，当按下该链接时，它会自动在网站上登录收件人/客户，而无需记住用户名和密码。

通过这样的链接可以很容易地解决这个问题：

[http://mysite.com/manage.aspx?user=peter&password=hounddog](http://mysite.com/manage.aspx?user=peter&password=hounddog)

当然，信息不应该是明文，而是以某种方式加密。

然而，这带来了一个问题，因为如果通过提供有效的用户名和密码，用户可以在网站上进行身份验证的唯一方法。以安全的名义，密码作为散列值存储在数据库中，使我无法在链接中插入密码。

在不影响安全性的情况下完成此任务的最佳方法是什么？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-07T12:47:36.327

如果您希望人们能够在不输入密码的情况下登录，您*将不得不在某种程度上损害您的安全性。*请注意，即使您可以访问密码（如您的示例中所示），您也必须将其嵌入到以明文形式传输的邮件消息中。

您可以创建与每个用户和消息关联的 Guid，并将其附加到 URL，并允许其自动登录。

您也许可以隔离权限，以便通过时事通讯 guid 链接登录*仅*允许用户管理订阅，但仍需要真正的密码登录才能参与论坛。在这种情况下，如果有人从邮件消息中访问 Guid，那么可能造成的破坏是非常有限的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-07T12:50:20.813

您不能插入与密码的哈希值捆绑在一起的加密用户名吗？

我的意思是，将用户名加密和编码为始终为特定长度或在其中包含已知的中断字符，然后附加密码哈希值。这样，您可以轻松地拆分查询字符串，同时仍然对用户名和密码进行安全编码。哈希值的直接比较就足够了，未加密、解码的用户名允许访问。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-07T12:48:40.817

使用包含访问令牌的加密 cookie 怎么样？此 cookie 将在一个单独的页面成功验证后交付。

这种标记也可以是 URL 查询字符串的一部分。

您也可以考虑使用安全的 https 而不是 http。

# c# - ServiceProvider、缓存等使用泛型完成，无需强制转换

> ID：178255
> 
> 赞同：1
> 
> 时间：2008-10-07T12:42:12.857
> 
> 标签：c#, generics

我说的是c#~~3.5~~3.0。当缓存或 ServiceProvider 只能为整个应用程序提供一个实例时，我知道该怎么做。在这种情况下，ServiceProvider 看起来像这样

```
public static class Service<T>
{
    public static T Value {get; set;}
} 
```

并且可以用于不同的类型，如下所示：

```
Service<IDbConnection>.Value = new SqlConnection("...");
Service<IDesigner>.Value = ...;
//...
IDbCommand cmd = Service<IDbConnection>.Value.CreateCommand(); 
```

静态缓存也很简单：

```
public static class Cache<T>
{
    private static Dictionary<int, T> cache = new Dictionary<int, T>();

    public static void Add(int key, T value)
    {
        cache.Add(key, value);
    }

    public static T Find(int key)
    {
        return cache[key];
    }
} 
```

并且可以像这样使用：

```
Cache<string>.Add(1, "test");
Cache<DateTime>.Add(2, DateTime.Now);
//...
string found = Cache<string>.Find(1); 
```

**我的问题是**：当我想拥有 2 个或更多不同的实例时，如何创建类似的缓存或服务提供者。这是示例代码，我想如何使用服务提供者：

```
ServiceProvider provider = new ServiceProvider();
provider.Add<IDbConnection>(new SqlConnection("..."));
provider.Add<IDesigner>(...);
//...
ServiceProvider provider1 = new ServiceProvider();
provider1.Add<IDbConnection>(new SqlConnection("..."));
//...
//...
IDbCommand cmd1 = provider.GetService<IDbConnection>().CreateCommand();
IDbCommand cmd2 = provider1.GetService<IDbConnection>().CreateCommand(); 
```

我脑海中唯一的实现是使用**我想避免的强制转换**。

```
public class ServiceProvider
{
    private Dictionary<Type, object> services = new Dictionary<Type, object>();
    public void Add<T>(T value)
    {
        services.Add(typeof(T), value);
    }

    public T GetService<T>()
    {
        return (T) services[typeof (T)];
    }
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-07T12:58:57.787

为什么你特别渴望避免铸造？是的，它感觉“不安全”——但您基本上可以保证它不会成为 ServiceProvider 中的问题，并且客户端不会进行任何强制转换。

这是一个相当普遍的问题，但我不相信在 .NET 泛型中有任何好的解决方案 - 这是一种基本上无法表达的类型关系。

编辑：我现在已经[在博客](http://msmvps.com/blogs/jon_skeet/archive/2008/10/08/mapping-from-a-type-to-an-instance-of-that-type.aspx)上写了这个并将行为封装在一个类型中。如果它让您的事情变得更清洁，请随意使用该代码。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-09T11:34:01.373

正如我在[Jon Skeet 的博客上](http://msmvps.com/blogs/jon_skeet/archive/2008/10/08/mapping-from-a-type-to-an-instance-of-that-type.aspx)发布的那样，如果担心的话，以下方法可能会帮助您避免强制转换（尽管这可能会引入一些比强制转换更严重的问题 :)）。

如果您有一个弱字典实现（使用弱引用键并清除其他未引用键及其关联值的实现），您可以尝试这样的事情：

```
 public class TypeDictionary  
   {    
       private class InnerTypeDictionary<T>
       {
           static WeakDictionary<TypeDictionary, T> _innerDictionary = new WeakDictionary<TypeDictionary, T>();
           public static void Add(TypeDictionary dic, T value)
           {
               _innerDictionary.Add(dic, value);
           }

           public static T GetValue(TypeDictionary dic)
           {
               return _innerDictionary[dic];
           }
       }

       public void Add<T>(T value)
       {
           InnerTypeDictionary<T>.Add(this, value);
       }

       public T GetValue<T>()
       {
           return InnerTypeDictionary<T>.GetValue(this);
       }
   } 
```

它的好处是将所有类型查找变成静态泛型类型查找，而无需直接求助于`System.Type`对象，所以我想这可能会给您带来性能提升。我很想知道它是否适合您的缓存方案。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-09T21:44:07.147

~~我想我找到了解决方案。这里你有我的 ServiceProvider 实现你可以在[我的博客](http://seermindflow.blogspot.com/2008/10/is-it-possible-to-write-c-application.html)上找到它的描述。~~

```
public class ServiceContainer : IDisposable
{
    readonly IList<IService> services = new List<IService>();

    public void Add<T>(T service)
    {
        Add<T,T>(service);
    }

    public void Add<Key, T>(T service) where T : Key
    {
         services.Add(new Service<Key>(this, service));
    }

    public void Dispose()
    {
        foreach(var service in services)
            service.Remove(this);
    }

    ~ServiceContainer()
    {
        Dispose();
    }

    public T Get<T>()
    {
        return Service<T>.Get(this);
    }
}

public interface IService
{
    void Remove(object parent);
}

public class Service<T> : IService
{
    static readonly Dictionary<object, T> services = new Dictionary<object, T>();

    public Service(object parent, T service)
    {
        services.Add(parent, service);
    }

    public void Remove(object parent)
    {
        services.Remove(parent);
    }

    public static T Get(object parent)
    {
        return services[parent];
    }
} 
```

是的，它使用静态字段，但是在终结器中删除了所有引用，因此唯一的缺点是 ServiceProvider 比通常更长时间地保持一个 GC 生成。

**编辑**：好的，经过几次尝试，我必须承认 Jon Skeet 是对的，目前这个问题没有简单的解决方案。我上面写的解决方案只有在满足 2 个约束条件下才能工作：

1.  我用`Dictionary<WeakReference, T> services`而不是`Dictionary<object, T> services`
2.  任何服务都不会引用 ServiceProvider。

否则你会有内存泄漏:-(

Microsoft 可以提供的简单解决方案是创建本机 WeakReference< T > 这将解决第 2 个约束。我们可以编写如下服务：

```
Dictionary<WeakReference, WeakReference<T>> services 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-21T20:06:03.427

如果不进行强制转换，就没有好的方法可以做到这一点。不要纠结于选角成本。专注于实际影响性能的事情......例如，散列并不是免费的。您不应该在每次想要使用服务时都回拨给您的服务提供商。一次获取参考，您不必担心检索的安装成本：

```
var service = provider.GetService<MyService>();
service.DoSomething();
service.DoSomethingElse(); 
```

# vim - 如何避免 vim 中大文件的语法高亮显示？

> ID：178257
> 
> 赞同：20
> 
> 时间：2008-10-07T12:43:28.347
> 
> 标签：vim, colors, vim-syntax-highlighting

由于语法高亮，巨大的文件需要永远在 vim 中加载和使用。

我正在寻找一种限制突出显示文件大小的方法，这样大于（比如说）10MB 的文件将是无色的。

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-02-17T22:39:14.727

将以下行添加到 _vimrc 中，有一个好处：它也可以处理 gzip 压缩文件（这是大文件的常见情况）：

```
autocmd BufWinEnter * if line2byte(line("$") + 1) > 1000000 | syntax clear | endif 
```

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-10-07T15:40:44.840

添加到您的 .vimrc：

```
autocmd BufReadPre * if getfsize(expand("%")) > 10000000 | 语法关闭 | 万一
```

请注意，这会禁用所有缓冲区中的语法突出显示；语法是全局 vim 的东西，不能仅限于单个缓冲区。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-10-07T12:46:13.460

我自己没有尝试过，但[LargeFile](http://www.vim.org/scripts/script.php?script_id=1506)插件似乎正是为了解决您正在寻找的那种东西。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-07T13:13:55.587

vim -u NONE <文件名>

这将跳过配置文件中的所有初始化。

运行 gvim 时使用大写 U。

"-i NONE" 只排除 viminfo 被加载。如果您在那里定义了语法高亮，那也会有所帮助。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-07T13:00:04.070

vim -c 'syntax off' 文件名.ext

# oop - 什么应该是OO，什么不应该？

> ID：178262
> 
> 赞同：5
> 
> 时间：2008-10-07T12:45:36.360
> 
> 标签：oop

我读过很多人说有些东西不应该用面向对象的风格来写——作为一个从 C 背景学习 OO 风格的人，这是什么意思？

什么不应该是OO，为什么有些东西更适合这个设计，我们怎么知道什么时候最好做什么？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-07T12:55:02.707

现实世界充满了物体。

使软件世界与现实世界相匹配是有帮助的。

“‘系统实用程序’呢？它们只处理套接字、进程和文件系统之类的抽象。” 它们对我来说听起来很像。他们有属性和行为，他们有关联。

如果您正在寻找OO*更好的***证据**，那么没有任何证据。没有什么比这*更好*了，因为*更好*是一个非常模糊的术语。任何聪明的人都可以编写任何风格的任何程序。您可以采用函数式、过程式、面向对象或任何您喜欢的方式。

 ***我使用 OO 是因为我的大脑非常小，必须学会在其极限内生活。OO 是帮助我在编程中挣扎的拐杖。如果我更聪明、更富有、更漂亮，我就不需要帮助，而且我可以编写非 OO 程序。可悲的是，我并不聪明。如果没有类定义来隔离责任和构建架构，我仍然会编写单文件“hello world”变体。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-07T13:24:07.190

一个简单的经验法则是封装复杂的数据和重复使用的代码，而忽略那些不是的。这使您可以将复杂的数据结构与其操作方法放在一起，以获得更大的可移植性和灵活性。例如具有按属性类型智能排序的数据库对象列表。

OO 代码还会混淆您不需要知道的内容。例如，我不需要知道我的排序算法是什么，直到它减慢我的速度，或者我是否已经在为高性能环境进行编程。

OO 代码的另一个优点是它的多态性，即您可以使用后续类型来更改操作而无需程序知道或关心它的方式。一个例子是具有多种文件列表类型的存档格式：列表中可能有一个结构数组（记录或结构），这些结构在列表类型之间变化，但继承自基类并且知道哪个底层结构的复杂性使用消失。如果没有面向对象，将很难管理它，坦率地说，管理它已经足够困难，因为它是*面向*对象的。

如果您已经不知道如何解决问题，OO 和 MVC 并不能解决您的问题，它们只是为您提供了更强大的方法来打击自己——只是这一次您可能不知道为什么。所以请记住，如果它是什么，OO 不是“灵丹妙药”......但请记住，在正确的情况和正确的程序员的情况下，它可能是灵丹妙药。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-07T12:55:44.733

面向对象的设计就是随着系统的增长而管理复杂性。因此，OO 设计对于较小的不太复杂的系统，或者对于您知道永远不会增长的系统来说可能是过度的。

当然，问题是我们很少能确定系统不会增长。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-07T12:59:48.377

我同意以上（或以下？）的大部分内容，即 OO 的存在是为了简化复杂的问题和软件设计。

然而，有很多时候它是极端过度的。我无法告诉你有多少次我希望有一个 Visual Studio Unrefactor 按钮只是为了理解代码并将所有基类放在一个文件中以提高可读性。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-07T12:56:54.873

除了存储过程，我想不出任何东西。为自己获取一份 Reflector 并使用它来查看 .NET 框架 dll 作为一个很好的学习课程。或者，市场上有大量关于 C++ 和 OO 的书籍，因为那已经有一段时间了。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-08T20:17:32.043

如果您正在编写移动应用程序（至少我可以代表 .NET 移动），那么您应该尽可能地尝试非 OO。随着移动设备的进步，您不想浪费系统内存，因为您已经将处理与抽象层、内存中的大型数据集或其他会减慢速度的实体捆绑在一起。你会想写得尽可能简单。

* * *

## 回答 #7

> 赞同：-2
> 
> 时间：2008-10-07T12:53:54.160

提示：您应该将此问题标记为“主观”，因为每个人似乎对此类事情都有不同的看法。

# javascript - 用于删除给定域中所有 cookie 的 JavaScript 小书签

> ID：178263
> 
> 赞同：17
> 
> 时间：2008-10-07T12:45:37.127
> 
> 标签：javascript, cookies, bookmarklet

我正在测试一个将 cookie 写入 subdomain.thisdomain.com 和其中的几个子文件夹的 Web 应用程序。我正在寻找可以放入书签的 JavaScript，它将删除该子域下的所有 cookie，无论它们存在于哪个文件夹中。

有任何想法吗？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-10-07T17:31:57.610

源自[我在这里的回答](https://stackoverflow.com/questions/179355/clearing-all-cookies-with-javascript#179514)：

```
javascript:new function(){var c=document.cookie.split(";");for(var i=0;i<c.length;i++){var e=c[i].indexOf("=");var n=e>-1?c[i].substr(0,e):c[i];document.cookie=n+"=;expires=Thu, 01 Jan 1970 00:00:00 GMT";}}(); return void(0); 
```

由于浏览器安全问题，这仅在可以访问您要删除的所有 cookie 的页面上执行时才有效。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-07T12:54:31.833

我会向 Firebug 推荐[Firecookie](https://addons.mozilla.org/en-US/firefox/addon/6683)扩展。

# database - 嵌入式系统上的 Sqlite

> ID：178264
> 
> 赞同：9
> 
> 时间：2008-10-07T12:45:40.730
> 
> 标签：database, sqlite, embedded

我有一个使用 Sqlite 在 PC 上生成的数据库文件。然后将该文件传输到没有操作系统的基于 ARM7 的嵌入式系统。嵌入式系统必须访问这个数据库，但不需要更新它。

我一直在尝试让 sqlite3 足够小以用于嵌入式系统，但到目前为止，我无法将应用程序大小设置为低于 256 KB（我的限制）。

有没有人能够将 sqlite3 缩小到这个大小？有没有其他软件可以用来读取这个数据库？

编辑：我正在尝试使用 C 访问数据库。这将使用 sqlite3_exec() 函数完成。

有两张桌子。一个表有 ID 和文本，第二个表有 ID，链接到第一个表的 ID、文本和状态值。唯一需要的访问权限是第一个表上的 ID 或部分文本，以及第二个表上的 ID。

也许有一些独立的代码可以用来访问数据库？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-07T13:21:01.780

我想出的最小的 sqlite3 是 327 KB（对于 PowerPC），这对于系统来说已经足够了，所以我不再试图让它更小。这是完整的 sqlite3 CLI 二进制文件，单独的 C API 会稍微小一些。

我设置了 SQLITE_OMIT_AUTHORIZATION、SQLITE_OMIT_EXPLAIN、SQLITE_OMIT_PROGRESS_CALLBACK 和 SQLITE_OMIT_TCL_VARIABLE 来调整二进制文件的大小，并使用 -Os 将其调整到那个大小。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-09T14:44:11.097

如果您不需要 SQL 的全部功能，那么研究替代解决方案可能会很有趣，例如[Berkeley DB](http://en.wikipedia.org/wiki/Berkeley_DB)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-29T02:47:54.033

您可能想看一下 cdb 它非常适合“恒定”数据，代码是开源的，可以编译成微小的可执行文件，您甚至可以将其删除以使 exe 更小。10k以下应该很容易。谷歌 CDB

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-07T13:10:39.807

您可以将数据库文件导出为 XML 或文本或其他“平面”文件吗？这在嵌入式环境中更容易使用。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-07T17:32:09.793

我会先尝试使用 sqlite2，它可能更精简（或不精简）。如果这没有帮助，我会说使用您自己的二进制编码。

除非您的数据文件非常大，否则您在 SQLite 的出色优化中会失去什么，您将通过不使用 SQL 获得。

当然，使用适当的数据结构（很可能是 B*Tree 或类似的）。

# c++ - 你知道的最难理解的 C++ 代码是什么？

> ID：178265
> 
> 赞同：21
> 
> 时间：2008-10-07T12:45:57.577
> 
> 标签：c++

今天在工作中我们遇到了以下代码（你们中的一些人可能认识它）：

```
#define GET_VAL( val, type ) \
    {                                                   \
        ASSERT( ( pIP + sizeof(type) ) <= pMethodEnd ); \
        val = ( *((type *&)(pIP))++ );                  \
    } 
```

基本上我们有一个字节数组和一个指针。该宏返回对类型变量的引用并将指针前进到该变量的末尾。

它让我想起了好几次我需要“像解析器一样思考”才能理解 C++ 代码。

您是否知道其他代码示例会导致您停下来阅读它几次，直到您设法掌握它应该做什么？

* * *

## 回答 #1

> 赞同：43
> 
> 时间：2008-10-07T16:11:21.860

Quake 3 中的逆平方根实现：

```
float InvSqrt (float x){
    float xhalf = 0.5f*x;
    int i = *(int*)&x;
    i = 0x5f3759df - (i>>1);
    x = *(float*)&i;
    x = x*(1.5f - xhalf*x*x);
    return x;
} 
```

**更新：** [这是如何工作](http://www.lomont.org/Math/Papers/2003/InvSqrt.pdf)的（感谢 ryan_s）

* * *

## 回答 #2

> 赞同：33
> 
> 时间：2008-10-07T13:29:16.663

这是最近在reddit上 [http://www.eelis.net/C++/analogliterals.xhtml](http://www.eelis.net/C++/analogliterals.xhtml)

```
 assert((o-----o
        |     !
        !     !
        !     !
        !     !
        o-----o ).area == ( o---------o
                            |         !
                            !         !
                            o---------o ).area ); 
```

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2008-10-07T14:00:41.593

达夫的设备（[http://en.wikipedia.org/wiki/Duff%27s_device](http://en.wikipedia.org/wiki/Duff%27s_device)）让我做噩梦：

```
strcpy(to, from, count)
char *to, *from;
int count;
{
    int n = (count + 7) / 8;
    switch (count % 8) {
    case 0: do { *to = *from++;
    case 7:      *to = *from++;
    case 6:      *to = *from++;
    case 5:      *to = *from++;
    case 4:      *to = *from++;
    case 3:      *to = *from++;
    case 2:      *to = *from++;
    case 1:      *to = *from++;
            } while (--n > 0);
    }
} 
```

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2008-10-07T13:11:13.110

我知道它是 C 而不是 C++，但总是有[International Obfuscated C Code Contest](http://www.ioccc.org/)。我在那里看到了一些会让你头晕目眩的代码。

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2008-10-07T13:12:59.597

这是在不创建临时变量的情况下交换两个整数的众所周知但仍然令人印象深刻的方法：

```
// a^=b^=a^=b;     // int a and int b will be swapped
// Technically undefined behavior as variable may only 
// be assined once within the same statement.
// 
// But this can be written correctly like this.
// Which still looks cool and unreadable ;-)

a^=b;
b^=a;
a^=b; 
```

* * *

## 回答 #6

> 赞同：10
> 
> 时间：2008-10-07T13:45:12.683

```
unsigned int reverse(register unsigned int x)
{
 x = (((x & 0xaaaaaaaa) >> 1) | ((x & 0x55555555) << 1));
 x = (((x & 0xcccccccc) >> 2) | ((x & 0x33333333) << 2));
 x = (((x & 0xf0f0f0f0) >> 4) | ((x & 0x0f0f0f0f) << 4));
 x = (((x & 0xff00ff00) >> 8) | ((x & 0x00ff00ff) << 8));
 return((x >> 16) | (x << 16));
} 
```

反转 int 中位的顺序。

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2008-10-07T16:05:55.537

大多数 Boost 的东西——模板元编程已经够糟糕了，但是当你考虑到让它在某些编译器上工作所需的变通办法时（*coughborlandcough*），它变得非常荒谬。试着理解 Boost.Bind。你试一试。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-10-07T12:58:22.700

C，但出现在 C++ 中，我发现逗号运算符真的混淆了代码，拿这个......

```
ihi = y[0]>y[1] ? (inhi=1,0) : (inhi=0,1); 
```

简洁且相当优雅，但很容易错过或误解。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2010-03-23T15:13:40.273

任何前缀为：

[/* 你不应该理解这个 */](http://cm.bell-labs.com/cm/cs/who/dmr/odd.html)

* * *

## 回答 #10

> 赞同：-3
> 
> 时间：2008-10-07T13:13:21.970

二进制移位一直让我感到困惑。包中的一个示例`java.util.concurrent.ConcurrentHashMap`：

```
return ((h << 7) - h + (h >>> 9) + (h >>> 17)) 
```

* * *

## 回答 #11

> 赞同：-5
> 
> 时间：2008-10-07T13:57:55.200

我投票支持一些黑魔法黑客模板元编程（不幸的是手头没有任何东西可以发布它）。

# macos - 在 Mac Firefox 中测试网站

> ID：178279
> 
> 赞同：6
> 
> 时间：2008-10-07T12:50:55.197
> 
> 标签：macos, testing, browser, virtual-machine, emulation

我需要在 Mac Firefox 中使用动态菜单测试站点，但我在 Windows 中运行。一个简单的 browsershot.com 测试无济于事；我需要实际使用该网站。

如何在没有 Mac 的情况下获得进行 Mac 仿真的方法？那里有某种远程虚拟机产品吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-07T12:56:19.117

我们正是为此使用[BrowserCam](http://www.browsercam.com/)。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-07T13:25:10.400

我意识到最初的问题要求虚拟解决方案，但是，到目前为止，还没有合法的方法可以在非 Apple 硬件上模拟 Mac。

如果您完全反对购买 Mac，像 BrowserCam 这样的服务是最好的选择。[BrowserCam](http://www.browsercam.com/Default2.aspx)的远程访问费用约为每年 400 美元，而且他们有可能适合的更便宜的套餐。

根据您需要测试的频率（以及在哪些浏览器/平台上），您可能需要考虑购买 Mac Mini。[翻新](http://store.apple.com/1-800-MY-APPLE/WebObjects/AppleStore.woa/wa/RSLID?sf=wHF2F2PHCCCX72KDY&nclm=CertifiedMac)的Mini售价在 500 美元到 600 美元之间，从长远来看可能会更便宜。

如果跨平台测试是贵公司业务的核心，那么运行 OS X 和 Windows（带有 Parallels、BootCamp 或 VMWare）的全尺寸基于 Intel 的 Mac 进行测试可能是更好的选择。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-07T12:54:14.050

查看[OSx86 项目](http://wiki.osx86project.org/wiki/index.php/Vmware_how_to)。我以前用过这个，效果很好，很容易理解。

# exception - 如何在 ANTLR 2 中找到字符位置？

> ID：178289
> 
> 赞同：1
> 
> 时间：2008-10-07T12:53:43.770
> 
> 标签：exception, parsing, antlr

我有一个简单的语法，并使用 antlr 2.7.7 生成了一对 c# 类。当解析器发现带有令牌的错误时，它会抛出异常；我想找出令牌来的解析流中有多少字符。我怎么做？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-07T13:27:24.560

您应该阅读 Terrence Parr 的书“The Definitive ANTLR Reference”中的第 10 章（“错误报告和恢复”）。

不知道您使用的是哪种目标语言，很难确切地告诉您该做什么。但我假设您使用的是 Java 目标，如果我错了，您可以纠正我。

当 ANTLR 识别器无法匹配输入字符串时，它会根据失败上下文抛出一个非常具体的异常。（有九种不同的异常，RecognitionException 是根类型，它自己有八个子类：MismatchedTokenException、MismatchedTreeNodeException、NoViableAltException、EarlyExitException、FailedPredicateException、MismatchedRangeException、MismatchedSetException、MismatchedNotSetException）。

根异常类型 (RecognitionException) 有一些方便的公共字段，您可能想看看它们（特别是：“index”、“line”和“charPositionInLine”）。“索引”字段告诉您发现错误的确切字符位置。“line”和“charPositionInLine”字段是不言自明的。这是JavaDoc：

[http://www.antlr.org/api/Java/classorg_1_1antlr_1_1runtime_1_1_recognition_exception.html](http://www.antlr.org/api/Java/classorg_1_1antlr_1_1runtime_1_1_recognition_exception.html)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-07T13:06:08.380

自从我玩 ANTLR 以来已经很久了，但是如果我没记错的话，为了做你想做的事，我必须对解析器进行子类化，以保持一个字符计数器，每次找到新令牌时都会递增（使用令牌当然长度）。

# asp.net - asp.net：IIS 服务不可用

> ID：178290
> 
> 赞同：1
> 
> 时间：2008-10-07T12:53:46.953
> 
> 标签：asp.net, .net, iis, http-status-code-503

当我尝试通过用我的新代码替换旧代码来更新 IIS 网络服务器上的代码时，当我尝试访问服务器上任何被替换的页面时，我会收到 503 Service Unavailable 回复。

此故障的原因是什么？我可以采取哪些步骤来纠正此类错误？

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-07T13:26:51.253

我会做几件事：

检查 Windows 事件日志以查找任何与 Web 相关的错误。

检查 IIS 日志以查看请求是否有任何奇怪之处。

仔细检查所有新文件的权限，确保它们与有效的文件匹配。

部署后执行 IISReset。

确保您的虚拟目录或子文件夹在 IIS 中正确设置，并且在部署中没有更改。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-09-14T07:08:52.650

如果关联的 ApplicationPool 被禁用，您还会收到“服务不可用”异常。（可以在日志中看到）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-07T13:35:27.930

回复这个答案，我好像记得遇到过这样的问题，原来是因为我是通过ftp更新文件的，FTP用户和IIS用户的权限有冲突。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2013-05-21T19:33:36.057

我花了几个小时在 Windows 2012 Server 的 IIS 上寻找 Service Unavailable, 503 的解决方案。最后，它有助于重新启动服务器并且一切正常。重新启动 IIS 是不够的。

这不是第一次重启帮助，Windows 2012 Server 上的 FTP 服务器也出现了同样的问题。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-07T13:36:05.917

您可能需要与有权访问服务器的人一起查看错误。除此之外，您可以尝试将旧代码放回去看看它是否仍然有效？如果不是，则可能是配置错误。

此外，编辑 web.config 将使应用程序重新启动。当您无法访问 IIS 时，这是一个有用的技巧。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-07T12:57:14.870

可能是很多东西。您是否在更新页面后尝试了 iisreset？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-07T13:00:06.393

我同意尤金的观点。这可能是很多事情。如果您在本地发布，您的本地 IIS 可以运行页面吗？

# python - 摊铺机 0.8.1 与 python 2.6 的兼容性

> ID：178300
> 
> 赞同：0
> 
> 时间：2008-10-07T12:56:40.753
> 
> 标签：python, bootstrapper, build-environment

有没有人设法使用 paver 和 python 2.6 引导其开发区域？

我已经安装了 python 2.6，用 easy_install-2.6 安装了摊铺机，一切看起来都很好。但是当我尝试启动引导方法时，它会在尝试下载[http://pypi.python.org/packages/2.6/s/setuptools/setuptools-0.6c8时引发 urllib2.HTTPError（：HTTP 错误 404：未找到） -py2.6.egg](http://pypi.python.org/packages/2.6/s/setuptools/setuptools-0.6c8-py2.6.egg)。我尝试在 support-files 目录中添加正确的 setuptools EGG 文件（即 0.6c9），bootstrap.py 找到 EGG 文件，但似乎没有使用它，因为它仍然尝试下载 0.6c8 版本不再可用。

任何想法如何解决这个问题？

提前致谢

伯特兰

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2010-04-24T09:15:11.027

你应该尝试更新的版本。=) [http://www.blueskyonmars.com/projects/paver/](http://www.blueskyonmars.com/projects/paver/)

# .net - 如何确定 .Net DLL 是否用于 GUI 应用程序或 Web 服务？

> ID：178306
> 
> 赞同：3
> 
> 时间：2008-10-07T12:57:35.167
> 
> 标签：.net, web-services, user-interface, dll

如何在 .Net DLL 中确定它是在 Windows GUI 应用程序还是 Web 服务中运行？我有一个在两个应用程序之间共享的低级类，并且需要在 Web 服务中使用它时禁用消息框。

Windows 应用程序有 200 多个解决方案，我无法重构现有代码。Web 服务需要重用一些功能，我正在寻找快速修复。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-07T13:00:25.987

只是一条一般建议，您的低级类可能不应该使用消息框本身，但应该允许中间（更接近界面）类来处理您可能需要消息框的情况。

如果您这样做了，那么您只需为 Web 使用与桌面不同的更高级别的类，并且每个类都将具有适合其上下文的通知工具。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-07T12:59:19.047

如果它在 Web 上下文中运行，则 HttpContext.Current 不会为空。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-07T13:23:55.020

您可以使用[Environment.UserInteractive](http://msdn.microsoft.com/en-us/library/system.environment.userinteractive.aspx)属性。

> 对于在没有用户界面的情况下运行的 Windows 进程或 IIS 等服务，UserInteractive 属性报告为 false。如果此属性为 false，则不要显示模式对话框或消息框，因为没有供用户交互的图形用户界面。

我知道您无法做到这一点，但是....您可能还想考虑一下您的应用程序设计。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-07T13:20:12.953

我不知道这是否会奏效，但它可能会。使用这些 Win32 调用：

GetModuleFileNameEx 获取 dll 的 exe 并保存以供以后比较。
EnumWindows 获取所有顶级窗口。
GetWindowModuleFileName 将窗口句柄从 EnumWindows 转换为模块名称。

如果您可以在 GetWindowModuleFileName 的结果中找到您自己的 exe，那么您的 dll 正在 GUI 应用程序中运行。

# sql - SQL Server 数据存储：4 GB Raw，SQL Server 有多少？

> ID：178307
> 
> 赞同：1
> 
> 时间：2008-10-07T12:58:07.617
> 
> 标签：sql, sql-server

我有一个 SQL Server 2005 数据库，并且有 4 GB 的文本文件需要导入其中。问题是，如果这 4 GB 的文本文件在压缩时是 1.2 GB，如果将它们导入，数据库会有多大？默认情况下 SQL Server 是否会收缩数据，或者我将如何设置它（考虑将数据库创建为分离项，以便稍后附加到另一个数据库）。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-07T13:01:38.200

SQL Server 默认不会收缩数据。事实上，每列和每行都会有少量开销，因此需要更多空间。

如果您确实必须将这些文件存储在数据库中（建议您不要），请查看我不久前发表的这篇[文章。](http://mitch-wheat.blogspot.com/2007/05/save-and-restore-filesimages-to-sql.html)在 SQL Server 2008 中，他们引入了 FILESTREAM 类型。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-07T13:34:44.563

有两个主要因素：

*   索引会增加空间需求。
*   标准化将减少空间需求。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-07T13:05:18.927

没有自动压缩 - 尽管您可以将压缩数据放在列中，但很难搜索。

这些是否被导入到一组规范化表中？是否有空格或其他数据将被删除（逗号）？

如果是这样，您可以期望从规范化和空间修剪中节省空间。

# validation - 你验证你的 URL 变量吗？

> ID：178320
> 
> 赞同：9
> 
> 时间：2008-10-07T13:01:13.723
> 
> 标签：validation, url, server-side

当您使用 GET 请求通过您的站点传递变量时，您是否在使用它们之前验证（正则表达式、过滤器等）它们？

假设您有 URL [http://www.example.com/i=45&p=custform](http://www.example.com/i=45&p=custform)。你知道“i”总是一个整数，而“p”总是只包含字母和/或数字。是否值得花时间确保没有人试图操纵这些值然后重新提交页面？

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2008-10-07T13:02:41.040

是的。毫无疑问。永远不要相信用户输入。

为了改善用户体验，可以（恕我直言）在客户端验证输入字段。这可以抢占到只导致相同表单和错误消息的服务器的往返行程。

但是，必须**始终**在服务器端验证输入，因为用户只能在 GET url 中手动更改输入数据或发送精心设计的 POST 数据。

在最坏的情况下，您最终可能会遇到[SQL 注入](http://unixwiz.net/techtips/sql-injection.html)，甚至更糟的是[XSS](http://www.cgisecurity.com/articles/xss-faq.shtml)漏洞。

大多数框架已经有一些内置的方法来清理输入，但即使没有这个，使用常规异常和查找表的组合来清理输入通常也很容易。

*   假设您知道它是一个整数，使用 int.Parse 或将其与正则表达式“^\d+$”匹配。
*   如果它是一个字符串并且选择有限，请制作一个字典并通过它运行字符串。如果您没有得到匹配，请将字符串更改为默认值。
*   如果它是用户指定的字符串，请将其与严格的正则表达式匹配，例如 "^\w+$"

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-07T13:03:03.907

与任何用户输入一样，检查以确保它是您所期望的**非常重要。**所以是的！

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-07T13:03:05.983

是的，是的，三次是的。

当然，许多 Web 框架都会为您执行此操作，例如 Struts 2。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-07T13:05:54.293

一个重要原因是检查[sql 注入](http://en.wikipedia.org/wiki/SQL_injection)。所以是的，总是清理用户输入。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-07T13:30:18.813

不仅仅是其他人在说什么。想象一个名为 nc 的查询字符串变量，当用户每页分别选择 10、50 和 100 个结果时，可以看到它的值分别为 10、50 和 100。现在想象有人将其更改为 50000。如果您只是检查它是否为整数，则每页将显示 50000 个结果，影响您的综合浏览量、服务器负载、脚本时间等。另外，这可能是您的整个数据库。当您有这样的规则（每页 10、50 或 100 个结果）时，您应该额外检查 nr 的值是否仅为 10、50 或 100，如果不是，请将其设置为默认值。这可以简单地是一个 min(nc, 100)，因此如果 nc 更改为 25、75 等，它将起作用，但如果它看到任何高于 100 的值，它将默认为 100。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-08T14:45:43.980

我想强调这是多么重要。我知道第一个答案讨论了 SQL 注入和 XSS 漏洞。SQL Injection 的最新进展是在查询字符串中传递二进制编码的 SQL 语句，如果它发现 SQL 注入漏洞，它将在数据库中的每个文本字段中添加一个 http://reallybadsite.com'/>。

作为 Web 开发人员，我们必须验证所有输入，并清理所有输出。

请记住，黑客不会使用 IE 来破坏您的网站，因此您不能依赖网络中的任何验证。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-07T13:13:51.360

是的，尽可能彻底地检查它们。在 PHP 中，我总是检查类型 ( `IsInt(i), IsString(p)`)。

# javascript - 如何检查元素是否隐藏在 jQuery 中？

> ID：178325
> 
> 赞同：8314
> 
> 时间：2008-10-07T13:03:18.057
> 
> 标签：javascript, jquery, dom, visibility

是否可以使用函数来切换元素的可见性`.hide()`，`.show()`或者`.toggle()`？

你将如何测试一个元素是`visible`or `hidden`？

* * *

## 回答 #1

> 赞同：9949
> 
> 时间：2008-10-07T13:30:22.217

由于问题涉及单个元素，因此此代码可能更合适：

```
// Checks CSS content for display:[none|block], ignores visibility:[true|false]
$(element).is(":visible");

// The same works with hidden
$(element).is(":hidden"); 
```

它与[twernt 的建议](https://stackoverflow.com/questions/178325/how-do-you-test-if-something-is-hidden-in-jquery/178386#178386)相同，但适用于单个元素；它[与 jQuery FAQ 中推荐的算法相匹配](https://stackoverflow.com/questions/178325/how-do-i-check-if-an-element-is-hidden-in-jquery/4685330#4685330)。

我们使用 jQuery 的[is()](https://api.jquery.com/is/)来检查所选元素与另一个元素、选择器或任何 jQuery 对象。该方法遍历 DOM 元素以找到满足传递参数的匹配项。如果匹配则返回true，否则返回false。

* * *

## 回答 #2

> 赞同：1561
> 
> 时间：2008-10-07T13:16:15.160

您可以使用[`hidden`](http://docs.jquery.com/Selectors/hidden)选择器：

```
// Matches all elements that are hidden
$('element:hidden') 
```

和[`visible`](http://docs.jquery.com/Selectors/visible)选择器：

```
// Matches all elements that are visible
$('element:visible') 
```

* * *

## 回答 #3

> 赞同：1046
> 
> 时间：2008-10-07T13:09:04.100

```
if ( $(element).css('display') == 'none' || $(element).css("visibility") == "hidden"){
    // 'element' is hidden
} 
```

上述方法没有考虑父级的可见性。要同时考虑父母，您应该使用`.is(":hidden")`or `.is(":visible")`。

例如，

```
<div id="div1" style="display:none">
  <div id="div2" style="display:block">Div2</div>
</div> 
```

> 上述方法将考虑`div2`可见`:visible`而不可见。但是上面的方法在很多情况下可能很有用，尤其是当您需要查找隐藏的父级中是否有任何可见的错误 div 时，因为在这种情况下`:visible`将不起作用。

* * *

## 回答 #4

> 赞同：569
> 
> 时间：2011-03-24T18:44:10.323

这些答案都没有解决我所理解的问题，这就是我一直在寻找的问题，*“我如何处理有的物品`visibility: hidden`？”* . 既`:visible`不会也`:hidden`不会处理这个问题，因为他们都在根据文档寻找显示。据我所知，没有选择器来处理 CSS 可见性。这是我解决它的方法（标准 jQuery 选择器，可能有更简洁的语法）：

```
$(".item").each(function() {
    if ($(this).css("visibility") == "hidden") {
        // handle non visible state
    } else {
        // handle visible state
    }
}); 
```

* * *

## 回答 #5

> 赞同：418
> 
> 时间：2011-01-13T21:13:18.467

从*[如何确定切换元素的状态？](http://learn.jquery.com/using-jquery-core/faq/how-do-i-determine-the-state-of-a-toggled-element/)*

* * *

`:visible`您可以使用and选择器确定元素是否折叠`:hidden`。

```
var isVisible = $('#myDiv').is(':visible');
var isHidden = $('#myDiv').is(':hidden'); 
```

如果您只是根据其可见性对元素进行操作，则可以只在选择器表达式中包含`:visible`或`:hidden`。例如：

```
 $('#myDiv:visible').animate({left: '+=200px'}, 'slow'); 
```

* * *

## 回答 #6

> 赞同：317
> 
> 时间：2009-07-25T10:21:40.420

通常在检查某些东西是否可见时，您会立即继续并用它做其他事情。jQuery 链接使这很容易。

因此，如果您有一个选择器，并且您希望仅在可见或隐藏时对其执行某些操作，您可以使用`filter(":visible")`或`filter(":hidden")`将其与您要执行的操作链接起来。

因此，不要`if`像这样声明：

```
if ($('#btnUpdate').is(":visible"))
{
     $('#btnUpdate').animate({ width: "toggle" });   // Hide button
} 
```

或者更高效，但更丑陋：

```
var button = $('#btnUpdate');
if (button.is(":visible"))
{
     button.animate({ width: "toggle" });   // Hide button
} 
```

您可以在一行中完成所有操作：

```
$('#btnUpdate').filter(":visible").animate({ width: "toggle" }); 
```

* * *

## 回答 #7

> 赞同：259
> 
> 时间：2011-11-25T09:16:10.040

`:visible`根据[jQuery 文档](https://api.jquery.com/hidden-selector/)的选择器：

> *   它们的 CSS`display`值为`none`.
> *   它们是带有`type="hidden"`.
> *   它们的宽度和高度明确设置为 0。
> *   祖先元素是隐藏的，因此该元素不会显示在页面上。
> 
> 带有`visibility: hidden`或的元素`opacity: 0`被认为是可见的，因为它们仍然占用布局中的空间。

这在某些情况下很有用，而在其他情况下则无用，因为如果您想检查元素是否可见（`display != none`），忽略父母的可见性，您会发现这样做`.css("display") == 'none'`不仅更快，而且还会正确返回可见性检查。

如果要检查可见性而不是显示，则应使用：`.css("visibility") == "hidden"`。

还要考虑[额外的 jQuery 注释](https://api.jquery.com/visible-selector/)：

> 因为`:visible`是 jQuery 扩展而不是 CSS 规范的一部分，所以使用的查询`:visible`不能利用原生 DOM`querySelectorAll()`方法提供的性能提升。要在使用`:visible`to 选择元素时获得最佳性能，首先使用纯 CSS 选择器选择元素，然后使用`.filter(":visible")`.

此外，如果您担心性能，您应该检查*[Now you see me... show/hide performance](http://www.learningjquery.com/2010/05/now-you-see-me-showhide-performance)* (2010-05-04)。并使用其他方法显示和隐藏元素。

* * *

## 回答 #8

> 赞同：230
> 
> 时间：2012-04-24T21:04:11.617

**[元素可见性和 jQuery 是](http://web-profile.net/jquery/dev/jquery-element-visible-hidden/)**如何工作的；

可以使用或`display:none`隐藏元素。这些方法之间的区别：`visibility:hidden``opacity:0`

*   `display:none`隐藏元素，不占用空间；
*   `visibility:hidden`隐藏元素，但仍然占用布局空间；
*   `opacity:0`将元素隐藏为“visibility:hidden”，在布局中仍然占用空间；唯一的区别是不透明度可以让一个元素部分透明；

    ```
    if ($('.target').is(':hidden')) {
      $('.target').show();
    } else {
      $('.target').hide();
    }
    if ($('.target').is(':visible')) {
      $('.target').hide();
    } else {
      $('.target').show();
    }

    if ($('.target-visibility').css('visibility') == 'hidden') {
      $('.target-visibility').css({
        visibility: "visible",
        display: ""
      });
    } else {
      $('.target-visibility').css({
        visibility: "hidden",
        display: ""
      });
    }

    if ($('.target-visibility').css('opacity') == "0") {
      $('.target-visibility').css({
        opacity: "1",
        display: ""
      });
    } else {
      $('.target-visibility').css({
        opacity: "0",
        display: ""
      });
    } 
    ```

    **有用的 jQuery 切换方法：**

    ```
    $('.click').click(function() {
      $('.target').toggle();
    });

    $('.click').click(function() {
      $('.target').slideToggle();
    });

    $('.click').click(function() {
      $('.target').fadeToggle();
    }); 
    ```

* * *

## 回答 #9

> 赞同：229
> 
> 时间：2011-07-06T20:19:00.383

这对我有用，我正在使用`show()`并使`hide()`我的 div 隐藏/可见：

```
if( $(this).css('display') == 'none' ){
    /* your code goes here */
} else {
    /* alternate logic   */
} 
```

* * *

## 回答 #10

> 赞同：176
> 
> 时间：2012-07-16T19:18:19.367

您也可以使用纯 JavaScript 执行此操作：

```
function isRendered(domObj) {
    if ((domObj.nodeType != 1) || (domObj == document.body)) {
        return true;
    }
    if (domObj.currentStyle && domObj.currentStyle["display"] != "none" && domObj.currentStyle["visibility"] != "hidden") {
        return isRendered(domObj.parentNode);
    } else if (window.getComputedStyle) {
        var cs = document.defaultView.getComputedStyle(domObj, null);
        if (cs.getPropertyValue("display") != "none" && cs.getPropertyValue("visibility") != "hidden") {
            return isRendered(domObj.parentNode);
        }
    }
    return false;
} 
```

笔记：

1.  无处不在

2.  适用于嵌套元素

3.  适用于 CSS 和内联样式

4.  不需要框架

* * *

## 回答 #11

> 赞同：175
> 
> 时间：2012-02-03T16:04:31.903

我会使用 CSS 类`.hide { display: none!important; }`。

对于隐藏/显示，我调用`.addClass("hide")/.removeClass("hide")`. 为了检查可见性，我使用`.hasClass("hide")`.

如果您不打算使用`.toggle()`或方法，这是一种检查/隐藏/显示元素的简单明了的`.animate()`方法。

* * *

## 回答 #12

> 赞同：151
> 
> 时间：2013-01-25T05:34:11.117

**[演示链接](https://freakyjolly.com/demo/check-if-visible-or-hidden-jquery.html)**

```
$('#clickme').click(function() {
  $('#book').toggle('slow', function() {
    // Animation complete.
    alert($('#book').is(":visible")); //<--- TRUE if Visible False if Hidden
  });
});
```

```
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<div id="clickme">
  Click here
</div>
<img id="book" src="https://upload.wikimedia.org/wikipedia/commons/8/87/Google_Chrome_icon_%282011%29.png" alt="" width="300"/>
```

**来源（来自我的博客）：**

[Blogger 即插即用 - jQuery 工具和小部件：如何使用 jQuery 查看元素是隐藏还是可见](http://bloggerplugnplay.blogspot.in/2013/01/how-to-see-if-element-is-hidden-or.html)

* * *

## 回答 #13

> 赞同：142
> 
> 时间：2012-05-23T12:59:08.400

可以简单地使用`hidden`or`visible`属性，例如：

```
$('element:hidden')
$('element:visible') 
```

或者您可以将其简化*如下*。

```
$(element).is(":visible") 
```

* * *

## 回答 #14

> 赞同：141
> 
> 时间：2012-06-13T13:20:45.833

`ebdiv`应设置为`style="display:none;"`。它适用于显示和隐藏：

```
$(document).ready(function(){
    $("#eb").click(function(){
        $("#ebdiv").toggle();
    });    
}); 
```

* * *

## 回答 #15

> 赞同：129
> 
> 时间：2012-04-21T23:40:30.517

您应该考虑的另一个答案是，如果您要隐藏一个元素，则应该使用[jQuery](http://en.wikipedia.org/wiki/JQuery)，但不是实际隐藏它，而是删除整个元素，而是将其[HTML](http://en.wikipedia.org/wiki/HTML)内容和标签本身复制到 jQuery 变量中，然后您需要做的就是测试屏幕上是否有这样的标签，使用正常的`if (!$('#thetagname').length)`.

* * *

## 回答 #16

> 赞同：111
> 
> 时间：2014-05-06T10:50:31.090

在 jQuery中针对选择器测试元素时`:hidden`，应考虑**绝对定位元素可能被识别为隐藏，尽管它们的子元素是可见的**。

首先，这似乎有点违反直觉——尽管仔细查看 jQuery 文档会给出相关信息：

> 元素可以被认为是隐藏的有几个原因：[...]它们的宽度和高度被明确设置为0。[...]

所以这对于盒子模型和元素的计算样式来说实际上是有意义的。即使宽度和高度没有*显式*设置为 0，它们也可能被*隐式*设置。

看看下面的例子：

```
console.log($('.foo').is(':hidden')); // true
console.log($('.bar').is(':hidden')); // false
```

```
.foo {
  position: absolute;
  left: 10px;
  top: 10px;
  background: #ff0000;
}

.bar {
  position: absolute;
  left: 10px;
  top: 10px;
  width: 20px;
  height: 20px;
  background: #0000ff;
}
```

```
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<div class="foo">
  <div class="bar"></div>
</div>
```

* * *

**jQuery 3.x 的更新：**

使用 jQuery 3，所描述的行为将会改变！如果元素具有任何布局框，包括零宽度和/或高度的布局框，则元素将被视为可见。

JSFiddle 与 jQuery 3.0.0-alpha1：

[http://jsfiddle.net/pM2q3/7/](http://jsfiddle.net/pM2q3/7/)

相同的 JavaScript 代码将具有以下输出：

```
console.log($('.foo').is(':hidden')); // false
console.log($('.bar').is(':hidden')); // false 
```

* * *

## 回答 #17

> 赞同：99
> 
> 时间：2012-07-20T12:44:24.263

```
expect($("#message_div").css("display")).toBe("none"); 
```

* * *

## 回答 #18

> 赞同：84
> 
> 时间：2013-10-28T06:43:14.080

```
$(document).ready(function() {
  if ($("#checkme:hidden").length) {
    console.log('Hidden');
  }
});
```

```
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<div id="checkme" class="product" style="display:none">
  <span class="itemlist"><!-- Shows Results for Fish --></span> Category:Fish
  <br>Product: Salmon Atlantic
  <br>Specie: Salmo salar
  <br>Form: Steaks
</div>
```

* * *

## 回答 #19

> 赞同：71
> 
> 时间：2013-06-04T13:42:53.373

要检查它是否不可见，我使用`!`：

```
if ( !$('#book').is(':visible')) {
    alert('#book is not visible')
} 
```

或者下面也是sam，将jQuery选择器保存在一个变量中，以便在多次需要时有更好的性能：

```
var $book = $('#book')

if(!$book.is(':visible')) {
    alert('#book is not visible')
} 
```

* * *

## 回答 #20

> 赞同：65
> 
> 时间：2013-07-18T21:17:52.810

## 使用类切换，而不是样式编辑。. .

使用为“隐藏”元素指定的类很容易，也是最有效的方法之一。使用“无”样式切换“隐藏”类`Display`将比直接编辑该样式执行得更快。*[我在 Stack Overflow 问题Turning two elements visible/hidden in the same div 中](https://stackoverflow.com/questions/17725361/turning-two-elements-visible-hidden-in-same-div/17726550#answer-17726550)*非常彻底地解释了其中的一些内容。

* * *

## JavaScript 最佳实践和优化

以下是 Google 前端工程师 Nicholas Zakas 的 Google Tech Talk 视频：

*   **[加速你的 Javascript](http://www.youtube.com/watch?v=mHtdZgou0qU)** (YouTube)

* * *

## 回答 #21

> 赞同：63
> 
> 时间：2014-04-09T17:06:44.017

毕竟，没有一个例子适合我，所以我自己写了。

**测试**（不支持 Internet Explorer `filter:alpha`）：

a) 检查文档是否未隐藏

b）检查元素是否具有零宽度/高度/不透明度或`display:none`/`visibility:hidden`内联样式

c）检查元素的中心（也因为它比测试每个像素/角更快）是否未被其他元素（以及所有祖先，例如：`overflow:hidden`/滚动/一个元素覆盖另一个）或屏幕边缘隐藏

d) 检查元素是否具有零宽度/高度/不透明度或`display:none`/可见性：隐藏在计算样式中（在所有祖先中）

**经测试**

Android 4.4 (Native browser/Chrome/Firefox), Firefox (Windows/Mac), Chrome (Windows/Mac), Opera (Windows [Presto](http://en.wikipedia.org/wiki/Presto_%28layout_engine%29) /Mac WebKit), Internet Explorer (Internet Explorer 5-11 文档模式 + Internet Explorer 8 on a虚拟机）和 Safari（Windows/Mac/iOS）。

```
var is_visible = (function () {
    var x = window.pageXOffset ? window.pageXOffset + window.innerWidth - 1 : 0,
        y = window.pageYOffset ? window.pageYOffset + window.innerHeight - 1 : 0,
        relative = !!((!x && !y) || !document.elementFromPoint(x, y));
        function inside(child, parent) {
            while(child){
                if (child === parent) return true;
                child = child.parentNode;
            }
        return false;
    };
    return function (elem) {
        if (
            document.hidden ||
            elem.offsetWidth==0 ||
            elem.offsetHeight==0 ||
            elem.style.visibility=='hidden' ||
            elem.style.display=='none' ||
            elem.style.opacity===0
        ) return false;
        var rect = elem.getBoundingClientRect();
        if (relative) {
            if (!inside(document.elementFromPoint(rect.left + elem.offsetWidth/2, rect.top + elem.offsetHeight/2),elem)) return false;
        } else if (
            !inside(document.elementFromPoint(rect.left + elem.offsetWidth/2 + window.pageXOffset, rect.top + elem.offsetHeight/2 + window.pageYOffset), elem) ||
            (
                rect.top + elem.offsetHeight/2 < 0 ||
                rect.left + elem.offsetWidth/2 < 0 ||
                rect.bottom - elem.offsetHeight/2 > (window.innerHeight || document.documentElement.clientHeight) ||
                rect.right - elem.offsetWidth/2 > (window.innerWidth || document.documentElement.clientWidth)
            )
        ) return false;
        if (window.getComputedStyle || elem.currentStyle) {
            var el = elem,
                comp = null;
            while (el) {
                if (el === document) {break;} else if(!el.parentNode) return false;
                comp = window.getComputedStyle ? window.getComputedStyle(el, null) : el.currentStyle;
                if (comp && (comp.visibility=='hidden' || comp.display == 'none' || (typeof comp.opacity !=='undefined' && comp.opacity != 1))) return false;
                el = el.parentNode;
            }
        }
        return true;
    }
})(); 
```

如何使用：

```
is_visible(elem) // boolean 
```

* * *

## 回答 #22

> 赞同：63
> 
> 时间：2015-04-27T07:57:27.150

**使用 adblocker 的可见**检查的示例已激活：

```
$(document).ready(function(){
  if(!$("#ablockercheck").is(":visible"))
    $("#ablockermsg").text("Please disable adblocker.").show();
});
```

```
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<div class="ad-placement" id="ablockercheck"></div>
<div id="ablockermsg" style="display: none"></div>
```

“ablockercheck” 是 adblocker 阻止的 ID。因此，检查它是否可见，您可以检测广告拦截器是否已打开。

* * *

## 回答 #23

> 赞同：55
> 
> 时间：2014-01-31T06:24:04.563

您需要同时检查...显示和可见性：

```
if ($(this).css("display") == "none" || $(this).css("visibility") == "hidden") {
    // The element is not visible
} else {
    // The element is visible
} 
```

如果我们检查`$(this).is(":visible")`，jQuery 会自动检查这两个东西。

* * *

## 回答 #24

> 赞同：52
> 
> 时间：2015-04-07T12:26:38.890

```
$(document).ready(function() {
   var visible = $('#tElement').is(':visible');

   if(visible) {
      alert("visible");
                    // Code
   }
   else
   {
      alert("hidden");
   }
});
```

```
<script src="https://code.jquery.com/jquery-1.10.2.js"></script>

<input type="text" id="tElement" style="display:block;">Firstname</input>
```

* * *

## 回答 #25

> 赞同：42
> 
> 时间：2014-08-11T05:28:37.783

只需通过检查布尔值来检查可见性，例如：

```
if (this.hidden === false) {
    // Your code
} 
```

我为每个功能使用了这段代码。否则，您可以`is(':visible')`用于检查元素的可见性。

* * *

## 回答 #26

> 赞同：40
> 
> 时间：2014-03-19T12:42:17.013

因为`Elements with visibility: hidden or opacity: 0 are considered visible, since they still consume space in the layout`（如[jQuery :visible Selector](https://api.jquery.com/visible-selector/)所述） - 我们可以通过这种方式检查元素是否*真的*可见：

```
function isElementReallyHidden (el) {
    return $(el).is(":hidden") || $(el).css("visibility") == "hidden" || $(el).css('opacity') == 0;
}

var booElementReallyShowed = !isElementReallyHidden(someEl);
$(someEl).parents().each(function () {
    if (isElementReallyHidden(this)) {
        booElementReallyShowed = false;
    }
}); 
```

* * *

## 回答 #27

> 赞同：38
> 
> 时间：2014-08-23T20:53:24.313

但是如果元素的 CSS 如下所示呢？

```
.element{
    position: absolute;left:-9999;    
} 
```

因此，还应考虑[对 Stack Overflow 问题*How to check if an element is off-screen 的回答。*](https://stackoverflow.com/questions/8897289)

* * *

## 回答 #28

> 赞同：36
> 
> 时间：2014-08-29T20:20:35.590

可以创建一个函数来检查可见性/显示属性，以衡量元素是否显示在 UI 中。

```
function checkUIElementVisible(element) {
    return ((element.css('display') !== 'none') && (element.css('visibility') !== 'hidden'));
} 
```

[工作小提琴](http://jsfiddle.net/w8bytkqc/)

* * *

## 回答 #29

> 赞同：35
> 
> 时间：2013-11-05T23:32:02.897

这里还有一个三元条件表达式来检查元素的状态，然后切换它：

```
$('someElement').on('click', function(){ $('elementToToggle').is(':visible') ? $('elementToToggle').hide('slow') : $('elementToToggle').show('slow'); }); 
```

* * *

## 回答 #30

> 赞同：34
> 
> 时间：2013-11-15T10:41:14.557

```
if($('#postcode_div').is(':visible')) {
    if($('#postcode_text').val()=='') {
        $('#spanPost').text('\u00a0');
    } else {
        $('#spanPost').text($('#postcode_text').val());
} 
```

* * *

## 回答 #31

> 赞同：32
> 
> 时间：2014-04-12T07:38:40.827

```
.is(":not(':hidden')") /*if shown*/ 
```

* * *

## 回答 #32

> 赞同：22
> 
> 时间：2015-08-18T09:04:15.413

```
if($('#id_element').is(":visible")){
   alert('shown');
}else{
   alert('hidden');
} 
```

* * *

## 回答 #33

> 赞同：21
> 
> 时间：2016-06-01T06:36:49.450

我搜索了这个，对于我的情况，没有一个答案是正确的，所以我创建了一个函数，如果一个人的眼睛看不到元素，它将返回 false

```
jQuery.fn.extend({
  isvisible: function() {
    //
    //  This function call this: $("div").isvisible()
    //  Return true if the element is visible
    //  Return false if the element is not visible for our eyes
    //
    if ( $(this).css('display') == 'none' ){
        console.log("this = " + "display:none");
        return false;
    }
    else if( $(this).css('visibility') == 'hidden' ){
        console.log("this = " + "visibility:hidden");   
        return false;
    }
    else if( $(this).css('opacity') == '0' ){
        console.log("this = " + "opacity:0");
        return false;
    }   
    else{
        console.log("this = " + "Is Visible");
        return true;
    }
  }  
}); 
```

* * *

## 回答 #34

> 赞同：19
> 
> 时间：2016-11-05T12:26:27.057

作为`hide()`,`show()`并将`toggle()`内联 css (display:none 或 display:block) 附加到元素。同样，我们可以很容易地使用三元运算符通过检查显示 CSS 来检查元素是隐藏还是可见。

**更新：**

*   您还需要检查元素 CSS 是否设置为可见性：“可见”或可见性：“隐藏”
*   如果显示属性设置为 inline-block、block、flex，该元素也将可见。

因此，我们可以检查使其不可见的元素的属性。所以他们是`display: none`并且`visibility: "hidden";`

我们可以创建一个对象来检查负责隐藏元素的属性：

```
var hiddenCssProps = {
display: "none",
visibility: "hidden"
} 
```

我们可以通过循环遍历对象匹配中的每个键值来检查键的元素属性是否与隐藏属性值匹配。

```
var isHidden = false;
for(key in hiddenCssProps) {
  if($('#element').css(key) == hiddenCssProps[key]) {
     isHidden = true;
   }
} 
```

如果要检查元素高度：0 或宽度：0 或更多的属性，可以扩展此对象并为其添加更多属性并进行检查。

* * *

## 回答 #35

> 赞同：18
> 
> 时间：2016-12-13T09:33:37.887

有很多方法可以检查一个元素在 jQuery 中是可见还是隐藏。

*演示 HTML 示例参考*

```
<div id="content">Content</div>
<div id="content2" style="display:none">Content2</div> 
```

**使用可见性过滤器选择器`$('element:hidden')`或`$('element:visible')`**

*   `$('element:hidden')`：选择所有隐藏的元素。

    ```
    Example:
       $('#content2:hidden').show(); 
    ```

*   `$('element:visible')`：选择所有可见的元素。

    ```
    Example:
       $('#content:visible').css('color', '#EEE'); 
    ```

> [在http://api.jquery.com/category/selectors/visibility-filter-selectors/](http://api.jquery.com/category/selectors/visibility-filter-selectors/)阅读更多内容

**使用`is()`过滤**

```
 Example:
       $('#content').is(":visible").css('color', '#EEE');

    Or checking condition
    if ($('#content').is(":visible")) {
         // Perform action
    } 
```

> [在http://api.jquery.com/is/](http://api.jquery.com/is/)阅读更多内容

* * *

## 回答 #36

> 赞同：18
> 
> 时间：2017-05-06T06:38:07.090

只需检查该元素是否**可见**，它将返回一个**boolean**。jQuery 通过向元素添加*display none*来隐藏元素，所以如果你想使用纯 JavaScript，你仍然可以这样做，例如：

```
if (document.getElementById("element").style.display === 'block') {
  // Your element is visible; do whatever you'd like
} 
```

此外，您可以使用 jQuery，因为您的其余代码似乎正在使用它，并且您的代码块更小。像下面的 jQuery 中的东西对你有同样的作用：

```
if ($(element).is(":visible")) {
    // Your element is visible, do whatever you'd like
}; 
```

在 jQuery 中使用该`css`方法也可以导致相同的结果：

```
if ($(element).css('display') === 'block') {
    // Your element is visible, do whatever you'd like
} 
```

此外，在检查可见性和显示的情况下，您可以执行以下操作：

```
if ($(this).css("display") === "block" || $(this).css("visibility") === "visible") {
   // Your element is visible, do whatever you'd like
} 
```

* * *

## 回答 #37

> 赞同：17
> 
> 时间：2016-04-12T01:11:51.033

这就是[jQuery](https://github.com/jquery/jquery/blob/055cb7534e2dcf7ee8ad145be83cb2d74b5331c7/src/css/hiddenVisibleSelectors.js)在内部解决这个问题的方式：

```
jQuery.expr.pseudos.visible = function( elem ) {
    return !!( elem.offsetWidth || elem.offsetHeight || elem.getClientRects().length );
}; 
```

如果您不使用 jQuery，则可以利用此代码并将其转换为您自己的函数：

```
function isVisible(elem) {
    return !!( elem.offsetWidth || elem.offsetHeight || elem.getClientRects().length );
}; 
```

只要元素可见，它`isVisible`就会返回。`true`

* * *

## 回答 #38

> 赞同：17
> 
> 时间：2016-05-02T12:31:08.800

你可以使用这个：

```
$(element).is(':visible'); 
```

## 示例代码

```
$(document).ready(function()
{
    $("#toggle").click(function()
    {
        $("#content").toggle();
    });

    $("#visiblity").click(function()
    {
       if( $('#content').is(':visible') )
       {
          alert("visible"); // Put your code for visibility
       }
       else
       {
          alert("hidden");
       }
    });
});
```

```
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>

<p id="content">This is a Content</p>

<button id="toggle">Toggle Content Visibility</button>
<button id="visibility">Check Visibility</button>
```

* * *

## 回答 #39

> 赞同：14
> 
> 时间：2016-12-06T08:44:11.063

我只是想澄清一下，在 jQuery 中，

> 元素可以被认为是隐藏的，原因如下：
> 
> *   它们的 CSS 显示值为 none。
> *   它们是 type="hidden" 的表单元素。
> *   它们的宽度和高度明确设置为 0。
> *   祖先元素是隐藏的，因此该元素不会显示在页面上。
> 
> 具有可见性的元素：隐藏或不透明度：0 被认为是可见的，因为它们仍然占用布局中的空间。在隐藏元素的动画期间，该元素被认为是可见的，直到动画结束。
> 
> 来源[：：隐藏选择器 | jQuery API 文档](https://api.jquery.com/hidden-selector/)

```
if($('.element').is(':hidden')) {
  // Do something
} 
```

* * *

## 回答 #40

> 赞同：12
> 
> 时间：2015-08-24T12:10:35.547

这是检查标签是否可见的一些选项

```
 // using a pure CSS selector  
   if ($('p:visible')) {  
      alert('Paragraphs are visible (checked using a CSS selector) !');  
   };  

   // using jQuery's is() method  
   if ($('p').is(':visible')) {  
      alert('Paragraphs are visible (checked using is() method)!');  
   };  

   // using jQuery's filter() method  
   if ($('p').filter(':visible')) {  
      alert('Paragraphs are visible (checked using filter() method)!');  
   };  

   // you can use :hidden instead of :visible to reverse the logic and check if an element is hidden  
   // if ($('p:hidden')) {  
   //    do something  
   // }; 
```

* * *

## 回答 #41

> 赞同：12
> 
> 时间：2016-04-04T08:21:05.327

您可以在可见时添加一个类。添加一个类，`show`. 然后检查它是否有一个类：

```
$('#elementId').hasClass('show'); 
```

如果您有`show`课程，则返回 true。

像这样添加CSS：

```
.show{ display: block; } 
```

* * *

## 回答 #42

> 赞同：11
> 
> 时间：2016-12-01T06:46:05.227

```
$( "div:visible" ).click(function() {
  $( this ).css( "background", "yellow" );
});
$( "button" ).click(function() {
  $( "div:hidden" ).show( "fast" );
}); 
```

API 文档：[**可见选择器**](https://api.jquery.com/visible-selector/)

* * *

## 回答 #43

> 赞同：11
> 
> 时间：2018-10-10T15:01:09.013

# 1 • jQuery 解决方案

### 判断一个元素在jQuery中是否可见的方法

```
<script>
if ($("#myelement").is(":visible")){alert ("#myelement is visible");}
if ($("#myelement").is(":hidden")){alert ("#myelement is hidden"); }
</script> 
```

### 在id 为“myelement”的元素的所有*可见div 子元素上循环：*

```
$("#myelement div:visible").each( function() {
 //Do something
}); 
```

### 浏览 jQuery 的源代码

这是 jQuery 实现此功能的方式：

```
jQuery.expr.filters.visible = function( elem ) {
    return !!( elem.offsetWidth || elem.offsetHeight || elem.getClientRects().length );
}; 
```

# 2 •[如何检查元素是否在屏幕外 - CSS](https://stackoverflow.com/questions/8897289/how-to-check-if-an-element-is-off-screen)

使用 Element.getBoundingClientRect() 您可以轻松检测您的元素是否在视口的边界内（即屏幕上或屏幕外）：

```
jQuery.expr.filters.offscreen = function(el) {
  var rect = el.getBoundingClientRect();
  return (
           (rect.x + rect.width) < 0 
             || (rect.y + rect.height) < 0
             || (rect.x > window.innerWidth || rect.y > window.innerHeight)
         );
}; 
```

然后，您可以通过多种方式使用它：

```
// Returns all elements that are offscreen
$(':offscreen');

// Boolean returned if element is offscreen
$('div').is(':offscreen'); 
```

如果您使用 Angular，请检查：*[Don't use hidden attribute with Angular](http://www.talkingdotnet.com/dont-use-hidden-attribute-angularjs-2/)*

* * *

## 回答 #44

> 赞同：9
> 
> 时间：2017-03-20T05:07:28.770

检查隐藏元素的方法太多了。这是最好的选择（我只是推荐你）：

> 使用 jQuery，在 CSS 中创建一个元素“display:none”以隐藏。

重点是：

```
$('element:visible') 
```

以及一个使用示例：

```
$('element:visible').show(); 
```

* * *

## 回答 #45

> 赞同：8
> 
> 时间：2017-08-08T17:47:36.730

只需检查`display`属性（或`visibility`取决于您喜欢哪种隐身）。例子：

```
if ($('#invisible').css('display') == 'none') {
    // This means the HTML element with ID 'invisible' has its 'display' attribute set to 'none'
} 
```

* * *

## 回答 #46

> 赞同：6
> 
> 时间：2020-09-23T05:05:45.363

使用隐藏选择，您可以匹配所有隐藏元素

```
$('element:hidden') 
```

使用可见选择，您可以匹配所有可见元素

```
$('element:visible') 
```

* * *

## 回答 #47

> 赞同：5
> 
> 时间：2018-08-15T01:48:34.890

如果要检查一个元素是否在页面上可见，取决于其父元素的可见性，您可以检查元素的`width`和`height`是否都等于`0`。

jQuery

`$element.width() === 0 && $element.height() === 0`

香草

`element.clientWidth === 0 && element.clientHeight === 0`

或者

`element.offsetWidth === 0 && element.offsetHeight === 0`

* * *

## 回答 #48

> 赞同：5
> 
> 时间：2018-09-12T09:34:43.773

一个 jQuery 解决方案，但对于那些想要更改按钮文本的人来说仍然更好：

```
$(function(){
  $("#showHide").click(function(){
    var btn = $(this);
    $("#content").toggle(function () {
      btn.text($(this).css("display") === 'none' ? "Show" : "Hide");
    });
   });
 });
```

```
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>

<button id="showHide">Hide</button>
<div id="content">
  <h2>Some content</h2>
  <p>
  What is Lorem Ipsum? Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book. It has survived not only five centuries, but also the leap into electronic typesetting, remaining essentially unchanged.
  </p>
</div>
```

* * *

## 回答 #49

> 赞同：5
> 
> 时间：2020-02-15T19:54:11.010

### 用于检查元素是否可见、不显示甚至不透明度级别的扩展功能

`false`如果元素不可见，则返回。

```
function checkVisible(e) {
    if (!(e instanceof Element)) throw Error('not an Element');
    const elementStyle = getComputedStyle(e);
    if (elementStyle.display === 'none' || elementStyle.visibility !== 'visible' || elementStyle.opacity < 0.1) return false;
    if (e.offsetWidth + e.offsetHeight + e.getBoundingClientRect().height +
        e.getBoundingClientRect().width === 0) {
        return false;
    }
    const elemCenter   = {
        x: e.getBoundingClientRect().left + e.offsetWidth / 2,
        y: e.getBoundingClientRect().top + e.offsetHeight / 2
    };
    if (elemCenter.x < 0 || elemCenter.y < 0) return false;
    if (elemCenter.x > (document.documentElement.clientWidth || window.innerWidth)) return false;
    if (elemCenter.y > (document.documentElement.clientHeight || window.innerHeight)) return false;
    let pointContainer = document.elementFromPoint(elemCenter.x, elemCenter.y);
    do {
        if (pointContainer === e) return true;
    } while (pointContainer = pointContainer.parentNode);
    return false;
} 
```

* * *

## 回答 #50

> 赞同：4
> 
> 时间：2017-03-25T08:49:30.440

公平地说，这个问题早于日期*这个*答案。

我添加它不是为了批评 OP，而是为了帮助任何仍在问这个问题的人。

确定某物是否可见的正确方法是咨询您的视图模型；

如果您不知道这意味着什么，那么您将踏上探索之旅，这将使您的工作变得更加轻松。

[这是模型-视图-视图-模型](https://en.wikipedia.org/wiki/Model%E2%80%93view%E2%80%93viewmodel)的概述架构 (MVVM)

[淘汰赛JS](http://knockoutjs.com)是一个绑定库，它可以让你在不学习整个框架的情况下尝试这些东西。

这里有一些 JavaScript 代码和一个可能可见或不可见的 DIV。

```
<html>
<body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/knockout/3.4.1/knockout-min.js"></script>
<script>
    var vm = {
        IsDivVisible: ko.observable(true);
    }
    vm.toggle = function(data, event) {
      // Get current visibility state for the div
      var x = IsDivVisible();
      // Set it to the opposite
      IsDivVisible(!x);
    }
    ko.applyBinding(vm);
</script>
<div data-bind="visible: IsDivVisible">Peekaboo!</div>
<button data-bind="click: toggle">Toggle the div's visibility</button>
</body>
</html> 
```

请注意，toggle 函数不会参考 DOM 来确定 div 的可见性；它咨询视图模型。

* * *

## 回答 #51

> 赞同：3
> 
> 时间：2016-03-23T13:21:42.460

```
if($("h1").is(":hidden")){
    // your code..
} 
```

* * *

## 回答 #52

> 赞同：3
> 
> 时间：2017-09-26T09:11:02.590

您可以通过切换类在可见或隐藏时使用 CSS 类：

```
.show{ display :block; } 
```

设置您的 jQuery`toggleClass()`或`addClass()`或`removeClass();`.

举个例子，

`jQuery('#myID').toggleClass('show')`

上面的代码会`show`在元素没有时添加 css 类，当元素有类时`show`将删除`show`。

当你检查它是否可见时，你可以按照这个 jQuery 代码，

`jQuery('#myID').hasClass('show');`

`#myID`当元素有我们的类 ( ) 时，上面的代码将返回一个布尔值 (true) `show`，当它没有 ( `show`) 类时返回 false。

* * *

## 回答 #53

> 赞同：3
> 
> 时间：2017-12-22T20:12:25.693

```
isHidden = function(element){
    return (element.style.display === "none");
};

if(isHidden($("element")) == true){
    // Something
} 
```

* * *

## 回答 #54

> 赞同：3
> 
> 时间：2019-07-18T10:37:02.480

您可以使用 jQuery 的`is()`函数来检查所选元素的可见或隐藏。该方法遍历 DOM 元素以找到满足传递参数的匹配项。如果匹配则返回 true，否则返回 false。

```
<script>
    ($("#myelement").is(":visible"))? alert("#myelement is visible") : alert("#myelement is hidden");
</script> 
```

* * *

## 回答 #55

> 赞同：2
> 
> 时间：2019-06-12T06:46:44.673

```
content.style.display != 'none' 
```

```
function toggle() {
  $(content).toggle();
  let visible= content.style.display != 'none'
  console.log('visible:', visible);
}
```

```
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

<button onclick="toggle()">Show/hide</button>
<div id="content">ABC</div>
```

* * *

## 回答 #56

> 赞同：1
> 
> 时间：2018-07-29T21:07:22.920

`event`不要为每个单独编写一个，而是`element`这样做：

```
$('div').each(function(){
  if($(this).css('display') === 'none'){
    $(this).css({'display':'block'});
  }
}); 
```

您也可以在输入上使用它：

```
$('input').each(function(){
  if($(this).attr('type') === 'hidden'){
    $(this).attr('type', 'text');
  }
}); 
```

* * *

## 回答 #57

> 赞同：1
> 
> 时间：2019-12-10T07:05:47.600

下面的代码检查一个元素在 jQuery 中是隐藏的还是可见的

```
// You can also do this...

        $("button").click(function(){
            // show hide paragraph on button click
            $("p").toggle("slow", function(){
                // check paragraph once toggle effect is completed
                if($("p").is(":visible")){
                    alert("The paragraph  is visible.");
                } else{
                    alert("The paragraph  is hidden.");
                }
            });
        }); 
```

* * *

## 回答 #58

> 赞同：1
> 
> 时间：2020-09-02T07:36:11.550

```
 hideShow(){
  $("#accordionZiarat").hide();
  // Checks CSS content for display:[none|block], ignores visibility:[true|false]
  if ($("#accordionZiarat").is(":visible")) {
    $("#accordionZiarat").hide();
  }

  else if ($("#accordionZiarat").is(":hidden")) {
    $("#accordionZiarat").show();
  }

  else{

  } 
```

* * *

## 回答 #59

> 赞同：1
> 
> 时间：2021-12-21T09:46:22.797

有两种方法可以检查元素的可见性。

```
if($('.selector').is(':visible')){
    // element is visible
}else{
    // element is visible
} 
```

或者

```
if($('.selector:visible')){
    // element is visible
}else{
    // element is visible
} 
```

* * *

## 回答 #60

> 赞同：1
> 
> 时间：2022-01-05T15:43:30.820

这个问题最简单的答案是这样的：

```
function checkUIElementVisible(element) {
    return ((element.css('display') !== 'none') && (element.css('visibility') !== 'hidden'));
} 
```

* * *

## 回答 #61

> 赞同：0
> 
> 时间：2017-04-29T10:25:22.423

```
$('someElement').on('click', function(){ $('elementToToggle').is(':visible') 
```

* * *

## 回答 #62

> 赞同：0
> 
> 时间：2021-01-22T11:32:13.617

```
if($(element).is(":visible")) {
  console.log('element is visible');
} else {
  console.log('element is not visible');
} 
```

* * *

## 回答 #63

> 赞同：-2
> 
> 时间：2021-12-24T08:00:52.043

如果你隐藏在课堂上 - d-none

```
if (!$('#ele').hasClass('d-none')) {
        $('#ele').addClass('d-none'); //hide 

    } 
```

# c++ - 调整 MFC 窗口的大小

> ID：178326
> 
> 赞同：9
> 
> 时间：2008-10-07T13:03:52.220
> 
> 标签：c++, mfc

我有一个 MFC 应用程序，我已经工作了几个星期了，我想在加载时手动设置主框架的尺寸，有人可以帮我解决这个问题，特别是在哪里放置代码?

谢谢！

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-07T13:28:44.747

您还可以`SetWindowPos()`从内部`CMainFrame::OnCreate()`或`CWinApp`派生类'中设置大小（使用 ） `InitInstance`。查找显示 的行`pMainFrame->ShowWindow()`，并在该行之前调用`pMainFrame->SetWindowPos()`。这就是我总是这样做的地方。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-07T13:09:56.250

使用 .. 查找您的屏幕尺寸

```
CRect rect;
SystemParametersInfo(SPI_GETWORKAREA,0,&rect,0);
screen_x_size=rect.Width();  
screen_y_size=rect.Height(); 
```

使用这些值来计算窗口的 X 和 Y 大小，然后..

```
::SetWindowPos(m_hWnd,HWND_TOPMOST,0,0,main_x_size,main_y_size,SWP_NOZORDER); 
```

`main_x_size`你的`main_y_size`尺码在哪里？

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-07T13:16:44.817

我认为您正在寻找[PreCreateWindow](http://msdn.microsoft.com/en-us/library/4yc5skce(VS.80).aspx)并且您的应用程序不是基于对话框的。

它是 CWnd 类的一个虚拟成员函数，在创建窗口之前由框架调用。因此，这是放置更改的正确位置。

你应该这样写：

```
BOOL CMyWindow::PreCreateWindow(CREATESTRUCT& cs)
{
   cs.cy = 640; // width
   cs.cx = 480; // height
   cs.y = 0; // top position
   cs.x = 0; // left position
   // don't forget to call base class version, suppose you derived you window from CWnd
   return CWnd::PreCreateWindow(cs);
}
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2020-06-21T17:54:25.917

你可以使用这个：

```
CRect rect;
SystemParametersInfo(SPI_GETWORKAREA, 0, &rect, 0);
left = -3, right = 3;
rect.top = 100;
rect.bottom = 500;
rect.left = 100;
rect.right = 800;
//or use
CRect cr;
cr.SetRect(POINT{ 100,100 }, POINT{ 500,800 });
MoveWindow(rect); 
```

# php - 在 PHP (>= 5.0) 中，通过引用传递是否更快？

> ID：178328
> 
> 赞同：74
> 
> 时间：2008-10-07T13:04:40.800
> 
> 标签：php, performance, pass-by-reference

在 PHP 中，函数参数可以通过在函数声明中的参数前加上一个 & 符号来通过引用传递，如下所示：

```
function foo(&$bar)
{
    // ...
} 
```

现在，我知道这*不是*为了提高性能而设计的，而是为了允许函数更改通常超出其范围的变量。

相反，PHP 似乎使用 Copy On Write 来避免复制对象（可能还有数组），直到它们被更改。因此，对于不更改其参数的函数，其效果应该与您通过引用传递它们一样。

但是，我想知道 Copy On Write 逻辑是否可能在传递引用时短路，以及这是否会对性能产生任何影响。

*ETA：可以肯定的是，我认为它不会更快，而且我很清楚这不是引用的用途。所以我认为我自己的猜测非常好，我只是在寻找一个真正知道幕后肯定发生了什么的人的答案。在 PHP 开发的五年中，我总是发现很难通过阅读源代码来获得有关 PHP 内部结构的优质信息。*

* * *

## 回答 #1

> 赞同：90
> 
> 时间：2010-10-02T11:48:57.873

在使用 20 kB 的字符串调用函数进行 100 000 次迭代的测试中，结果是：

### 只读取/使用参数的函数

```
pass by value:      0.12065005 seconds
pass by reference:  1.52171397 seconds 
```

### 写入/更改参数的功能

```
pass by value:      1.52223396 seconds
pass by reference:  1.52388787 seconds 
```

* * *

## 结论

1.  按值传递参数总是更快

2.  如果函数改变了传递的变量的值，实际上与按引用传递比按值传递相同

* * *

## 回答 #2

> 赞同：37
> 
> 时间：2008-10-07T13:14:43.090

Zend 引擎使用写时复制，当您自己使用引用时，它会产生一些额外的开销。虽然只能在撰写本文时找到[此提及，并且](http://web.archive.org/web/20130406174901/http://www.thedeveloperday.com/php-lazy-copy/)[手册中的](http://www.php.net/references)评论包含其他链接。

[（编辑）关于对象和引用](http://www.php.net/manual/en/language.oop5.references.php)的手册页包含有关对象变量与引用有何不同的更多信息。

* * *

## 回答 #3

> 赞同：30
> 
> 时间：2011-07-05T03:54:03.397

我对此进行了一些测试，因为我不确定给出的答案。

我的结果表明，通过引用传递大型数组或字符串明显更快。

这是我的结果： ![基准](https://i.stack.imgur.com/HIhrA.png)

Y 轴 (Runs) 是在 1 秒内可以调用函数的次数 * 10

对每个函数/变量重复测试 8 次

这是我使用的变量：

```
$large_array = array_fill(PHP_INT_MAX / 2, 1000, 'a');
$small_array = array('this', 'is', 'a', 'small', 'array');
$large_object = (object)$large_array;
$large_string = str_repeat('a', 100000);
$small_string = 'this is a small string';
$value = PHP_INT_MAX / 2; 
```

这些是功能：

```
function pass_by_ref(&$var) {
}

function pass_by_val($var) {
} 
```

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2011-10-01T14:05:13.303

我已经尝试过将 10k 字节字符串的值和引用传递给两个相同的函数。一个按值取参数，第二个按引用取参数。它们是常见的函数——接受参数，进行简单的处理并返回一个值。我对两者都进行了 100 000 次调用，发现引用并不是为了提高性能而设计的 - 引用的利润接近 4-5%，并且只有当字符串变得足够大时才会增长（100k 和更长，提高了 6-7%） . 所以，我的结论是**不要使用引用来提高性能，这个东西不是为了那个。**

我使用 PHP 版本 5.3.1

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-07T13:06:58.317

我很确定不，它不会更快。此外，它在手册中特别指出不要尝试使用引用来提高性能。

编辑：找不到它说的地方，但它就在那里！

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2018-02-19T07:45:44.660

我试图用一个基于我正在从事的项目的真实示例来对此进行基准测试。与往常一样，差异微不足道，但结果有些出乎意料。对于我见过的大多数基准测试，被调用的函数实际上并没有改变传入的值。我对其执行了一个简单的 str_replace() 。

```
**Pass by Value Test Code:**

$originalString=''; // 1000 pseudo-random digits

function replace($string) {
    return str_replace('1', 'x',$string);
}
$output = '';
/* set start time */
$mtime = microtime();
$mtime = explode(" ", $mtime);
$mtime = $mtime[1] + $mtime[0];
$tstart = $mtime;
set_time_limit(0);

for ($i = 0; $i < 10; $i++ ) {
    for ($j = 0; $j < 1000000; $j++) {
        $string = $originalString;
        $string = replace($string);
    }
}

/* report how long it took */
$mtime = microtime();
$mtime = explode(" ", $mtime);
$mtime = $mtime[1] + $mtime[0];
$tend = $mtime;
$totalTime = ($tend - $tstart);
$totalTime = sprintf("%2.4f s", $totalTime);
$output .= "\n" . 'Total Time' .
    ': ' . $totalTime;
$output .= "\n" . $string;
echo $output; 
```

**通过参考测试代码**

一样的，除了

```
function replace(&$string) {
    $string = str_replace('1', 'x',$string);
}
/* ... */
replace($string); 
```

**以秒为单位的结果（1000 万次迭代）：**

```
PHP 5
    Value:     14.1007
    Reference: 11.5564

PHP 7
    Value:     3.0799
    Reference: 2.9489 
```

每次函数调用的差别只有几分之一毫秒，但对于这个用例，通过引用传递在 PHP 5 和 PHP 7 中都更快。

（注意：PHP 7 测试是在更快的机器上执行的——PHP 7 更快，但可能没有那么快。）

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2014-07-26T21:34:15.497

没有什么比一段测试代码更好的了

```
<?PHP
$r = array();

for($i=0; $i<500;$i++){
$r[]=5;
}

function a($r){
$r[0]=1;
}
function b(&$r){
$r[0]=1;
}

$start = microtime(true);
for($i=0;$i<9999;$i++){
  //a($r);
  b($r);
}
$end = microtime(true);

echo $end-$start;
?> 
```

最后结果！数组越大（或调用次数越多），差异就越大。所以在这种情况下，通过引用调用更快，因为值在函数内部发生了变化。

否则“按引用”和“按值”之间没有真正的区别，编译器足够聪明，不会在不需要时每次都创建新副本。

* * *

## 回答 #8

> 赞同：-2
> 
> 时间：2019-02-25T15:30:29.237

很简单，不需要测试任何东西。取决于用例。

对于少量参数，按值传递总是比参考值更快。这取决于架构允许通过寄存器 (ABI) 传递多少变量。

例如 x64 将允许您通过寄存器传递 4 个 64 位值。 [https://en.wikipedia.org/wiki/X86_calling_conventions](https://en.wikipedia.org/wiki/X86_calling_conventions)

这是因为您不必取消引用指针，只需直接使用值即可。

如果您需要传递的数据大于 ABI，则其余值将进入堆栈。在这种情况下，数组或对象（例如是类，或结构 + 标头）将始终比引用更快。

这是因为引用只是指向您的数据（不是数据本身）的指针，大小固定，例如 32 位或 64 位，具体取决于机器。该指针将适合一个 CPU 寄存器。

PHP 是用 C/C++ 编写的，所以我希望表现相同。

* * *

## 回答 #9

> 赞同：-3
> 
> 时间：2008-10-07T13:17:33.037

传递对象时无需添加 & 运算符。在 PHP 5+ 中，对象无论如何都是通过引用传递的。

# c# - C#中的多重继承

> ID：178333
> 
> 赞同：234
> 
> 时间：2008-10-07T13:05:23.077
> 
> 标签：c#, interface, multiple-inheritance

由于多重继承不好（它使源代码更复杂）C# 没有直接提供这样的模式。但有时拥有这种能力会有所帮助。

例如，我可以使用接口和三个类似的类来实现缺少的多重继承模式：

```
public interface IFirst { void FirstMethod(); }
public interface ISecond { void SecondMethod(); }

public class First:IFirst 
{ 
    public void FirstMethod() { Console.WriteLine("First"); } 
}

public class Second:ISecond 
{ 
    public void SecondMethod() { Console.WriteLine("Second"); } 
}

public class FirstAndSecond: IFirst, ISecond
{
    First first = new First();
    Second second = new Second();
    public void FirstMethod() { first.FirstMethod(); }
    public void SecondMethod() { second.SecondMethod(); }
} 
```

每次我向其中一个接口添加方法时，我也需要更改*FirstAndSecond*类。

有没有办法像在 C++ 中那样将多个现有类注入一个新类？

也许有使用某种代码生成的解决方案？

或者它可能看起来像这样（虚构的 c# 语法）：

```
public class FirstAndSecond: IFirst from First, ISecond from Second
{ } 
```

这样当我修改其中一个接口时就不需要更新类 FirstAndSecond 了。

* * *

### 编辑

也许考虑一个实际的例子会更好：

您已经在项目内的不同位置使用了一个现有的类（例如，基于 ITextTcpClient 的基于文本的 TCP 客户端）。现在您觉得有必要为您的类创建一个组件，以便 Windows 窗体开发人员可以轻松访问。

据我所知，您目前有两种方法可以做到这一点：

1.  编写一个从组件继承的新类，并使用类本身的实例实现 TextTcpClient 类的接口，如 FirstAndSecond 所示。

2.  编写一个继承自 TextTcpClient 并以某种方式实现 IComponent 的新类（实际上还没有尝试过）。

在这两种情况下，您都需要按方法而不是按类工作。既然您知道我们将需要 TextTcpClient 和 Component 的所有方法，那么将这两者组合到一个类中将是最简单的解决方案。

为避免冲突，这可以通过代码生成来完成，其中结果可以在之后更改，但是手动输入是纯粹的痛苦。

* * *

## 回答 #1

> 赞同：225
> 
> 时间：2008-10-07T13:13:31.330

考虑只使用*[组合](http://en.wikipedia.org/wiki/Object_composition)*而不是尝试模拟多重继承。您可以使用接口来定义构成组合的类，例如：`ISteerable`隐含类型的属性`SteeringWheel`、`IBrakable`隐含类型的属性`BrakePedal`等。

完成此操作后，您可以使用添加到 C# 3.0 的[扩展方法](http://msdn.microsoft.com/en-us/library/bb383977.aspx)功能来进一步简化对这些隐含属性的调用方法，例如：

```
public interface ISteerable { SteeringWheel wheel { get; set; } }

public interface IBrakable { BrakePedal brake { get; set; } }

public class Vehicle : ISteerable, IBrakable
{
    public SteeringWheel wheel { get; set; }

    public BrakePedal brake { get; set; }

    public Vehicle() { wheel = new SteeringWheel(); brake = new BrakePedal(); }
}

public static class SteeringExtensions
{
    public static void SteerLeft(this ISteerable vehicle)
    {
        vehicle.wheel.SteerLeft();
    }
}

public static class BrakeExtensions
{
    public static void Stop(this IBrakable vehicle)
    {
        vehicle.brake.ApplyUntilStop();
    }
}

public class Main
{
    Vehicle myCar = new Vehicle();

    public void main()
    {
        myCar.SteerLeft();
        myCar.Stop();
    }
} 
```

* * *

## 回答 #2

> 赞同：143
> 
> 时间：2009-11-08T07:09:29.780

> 由于多重继承不好（它使源代码更复杂）C# 没有直接提供这样的模式。但有时拥有这种能力会有所帮助。

C# 和 .net CLR 还没有实现 MI，因为他们还没有得出结论它将如何在 C#、VB.net 和其他语言之间进行互操作，而不是因为“它会使源代码更复杂”

MI 是一个有用的概念，未回答的问题如下：-“当您在不同的超类中有多个公共基类时，您会怎么做？

Perl 是我曾经使用过的唯一一种在 MI 工作并且运行良好的语言。.Net 可能有朝一日会推出它，但目前还没有，CLR 确实已经支持 MI，但正如我所说，除此之外还没有任何语言结构。

在那之前，你会被代理对象和多个接口卡住:(

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2011-05-14T14:48:48.753

我创建了一个[C# 后编译器](https://github.com/jordao76/nroles)来实现这种功能：

```
using NRoles;

public interface IFirst { void FirstMethod(); }
public interface ISecond { void SecondMethod(); }

public class RFirst : IFirst, Role {
  public void FirstMethod() { Console.WriteLine("First"); }
}

public class RSecond : ISecond, Role {
  public void SecondMethod() { Console.WriteLine("Second"); }
}

public class FirstAndSecond : Does<RFirst>, Does<RSecond> { } 
```

您可以将后编译器作为 Visual Studio 构建后事件运行：

> C:\some_path\nroles-v0.1.0-bin\nutate.exe "$(TargetPath)"

在同一个程序集中，您可以像这样使用它：

```
var fas = new FirstAndSecond();
fas.As<RFirst>().FirstMethod();
fas.As<RSecond>().SecondMethod(); 
```

在另一个程序集中，您可以像这样使用它：

```
var fas = new FirstAndSecond();
fas.FirstMethod();
fas.SecondMethod(); 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-10-07T13:09:28.763

您可以拥有一个实现 IFirst 和 ISecond 的抽象基类，然后仅从该基类继承。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2018-11-13T19:41:33.410

现在使用 C# 8，您实际上可以通过接口成员的默认实现实现多重继承：

```
interface ILogger
{
    void Log(LogLevel level, string message);
    void Log(Exception ex) => Log(LogLevel.Error, ex.ToString()); // New overload
}

class ConsoleLogger : ILogger
{
    public void Log(LogLevel level, string message) { ... }
    // Log(Exception) gets default implementation
} 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2017-12-14T23:26:26.520

在我自己的实现中，我发现使用 MI 的类/接口虽然“形式良好”，但往往过于复杂，因为您只需要为几个必要的函数调用设置所有多重继承，就我而言，需要重复数十次。

取而代之的是，在不同的模块化变体中简单地制作静态“调用函数的函数”作为一种 OOP 替代品更容易。我正在研究的解决方案是 RPG 的“法术系统”，其中效果需要**大量**混合和匹配函数调用，以在不重写代码的情况下提供极其多样化的法术，就像这个例子似乎表明的那样。

大多数函数现在可以是静态的，因为我不一定需要拼写逻辑的实例，而类继承甚至不能在静态时使用虚拟或抽象关键字。接口根本无法使用它们。

以这种方式，IMO 编码似乎更快、更清晰。如果您只是在做函数，并且不需要继承**属性**，请使用函数。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-07T13:23:19.000

如果您可以忍受 IFirst 和 ISecond 的方法只能与 IFirst 和 ISecond 的合同交互的限制（就像在您的示例中一样）......您可以使用扩展方法执行您所要求的操作。在实践中，这种情况很少见。

```
public interface IFirst {}
public interface ISecond {}

public class FirstAndSecond : IFirst, ISecond
{
}

public static MultipleInheritenceExtensions
{
  public static void First(this IFirst theFirst)
  {
    Console.WriteLine("First");
  }

  public static void Second(this ISecond theSecond)
  {
    Console.WriteLine("Second");
  }
} 
```

///

```
public void Test()
{
  FirstAndSecond fas = new FirstAndSecond();
  fas.First();
  fas.Second();
} 
```

所以基本思想是你在接口中定义所需的实现......这个必需的东西应该支持扩展方法中的灵活实现。任何时候您需要“向接口添加方法”，而不是添加扩展方法。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2014-01-15T18:33:58.407

是的，使用接口很麻烦，因为每当我们在类中添加方法时，我们都必须在接口中添加签名。另外，如果我们已经有一个包含一堆方法但没有接口的类怎么办？我们必须为我们想要继承的所有类手动创建接口。最糟糕的是，如果子类要从多个接口继承，我们必须在子类的Interfaces中实现所有方法。

**通过遵循外观设计模式，我们可以使用访问**器模拟从多个类继承。用 {get;set;} 将类声明为需要继承的类内部的属性，所有公共属性和方法都来自该类，并在子类的构造函数中实例化父类。

例如：

```
 namespace OOP
 {
     class Program
     {
         static void Main(string[] args)
         {
             Child somechild = new Child();
             somechild.DoHomeWork();
             somechild.CheckingAround();
             Console.ReadLine();
         }
     }

     public class Father 
     {
         public Father() { }
         public void Work()
         {
             Console.WriteLine("working...");
         }
         public void Moonlight()
         {
             Console.WriteLine("moonlighting...");
         }
     }

     public class Mother 
     {
         public Mother() { }
         public void Cook()
         {
             Console.WriteLine("cooking...");
         }
         public void Clean()
         {
             Console.WriteLine("cleaning...");
         }
     }

     public class Child 
     {
         public Father MyFather { get; set; }
         public Mother MyMother { get; set; }

         public Child()
         {
             MyFather = new Father();
             MyMother = new Mother();
         }

         public void GoToSchool()
         {
             Console.WriteLine("go to school...");
         }
         public void DoHomeWork()
         {
             Console.WriteLine("doing homework...");
         }
         public void CheckingAround()
         {
             MyFather.Work();
             MyMother.Cook();
         }
     }

 } 
```

有了这个结构，子类就可以访问父类和母类的所有方法和属性，模拟多重继承，继承父类的一个实例。不太一样，但很实用。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2017-02-20T10:20:59.010

这与 Lawrence Wenham 的回答类似，但根据您的用例，它可能是也可能不是改进——您不需要设置器。

```
public interface IPerson {
  int GetAge();
  string GetName();
}

public interface IGetPerson {
  IPerson GetPerson();
}

public static class IGetPersonAdditions {
  public static int GetAgeViaPerson(this IGetPerson getPerson) { // I prefer to have the "ViaPerson" in the name in case the object has another Age property.
    IPerson person = getPerson.GetPersion();
    return person.GetAge();
  }
  public static string GetNameViaPerson(this IGetPerson getPerson) {
    return getPerson.GetPerson().GetName();
  }
}

public class Person: IPerson, IGetPerson {
  private int Age {get;set;}
  private string Name {get;set;}
  public IPerson GetPerson() {
    return this;
  }
  public int GetAge() {  return Age; }
  public string GetName() { return Name; }
} 
```

现在任何知道如何获取人的对象都可以实现 IGetPerson，并且它会自动拥有 GetAgeViaPerson() 和 GetNameViaPerson() 方法。从这一点开始，基本上所有的 Person 代码都进入 IGetPerson，而不是 IPerson，除了新的 ivars，它们都必须进入。在使用这样的代码时，您不必担心您的 IGetPerson 对象本身是否实际上是 IPerson。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2017-04-04T10:13:35.733

我们似乎都在沿着接口路径前进，但这里明显的另一种可能性是做 OOP 应该做的事情，并建立你的继承树...... *（这不就是类设计的全部吗？关于？）*

```
class Program
{
    static void Main(string[] args)
    {
        human me = new human();
        me.legs = 2;
        me.lfType = "Human";
        me.name = "Paul";
        Console.WriteLine(me.name);
    }
}

public abstract class lifeform
{
    public string lfType { get; set; }
}

public abstract class mammal : lifeform 
{
    public int legs { get; set; }
}

public class human : mammal
{
    public string name { get; set; }
} 
```

这种结构提供了可重用的代码块，当然，应该如何编写 OOP 代码？

如果这种特殊方法不太符合要求，我们只需根据所需对象创建新类......

```
class Program
{
    static void Main(string[] args)
    {
        fish shark = new fish();
        shark.size = "large";
        shark.lfType = "Fish";
        shark.name = "Jaws";
        Console.WriteLine(shark.name);
        human me = new human();
        me.legs = 2;
        me.lfType = "Human";
        me.name = "Paul";
        Console.WriteLine(me.name);
    }
}

public abstract class lifeform
{
    public string lfType { get; set; }
}

public abstract class mammal : lifeform 
{
    public int legs { get; set; }
}

public class human : mammal
{
    public string name { get; set; }
}

public class aquatic : lifeform
{
    public string size { get; set; }
}

public class fish : aquatic
{
    public string name { get; set; }
} 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-07T13:31:55.503

多重继承是导致问题多于解决的问题之一。在 C++ 中，它符合给你足够的绳索来吊死自己的模式，但 Java 和 C# 选择了不给你选择的更安全的路线。最大的问题是如果你继承了多个类，这些类的方法具有相同的签名，而被继承者没有实现。应该选择哪个类的方法？还是不应该编译？通常还有另一种方法可以实现大多数不依赖于多重继承的东西。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2011-08-24T14:40:29.873

如果 X 继承自 Y，则有两个有点正交的效果：

1.  Y 将为 X 提供默认功能，因此 X 的代码只需包含与 Y 不同的内容。
2.  几乎在任何需要 Y 的地方，都可以使用 X。

尽管继承提供了这两个特性，但不难想象在没有另一个的情况下可以使用其中一个。我所知道的任何.net语言都没有直接的方法来实现第一个而没有第二个，尽管可以通过定义一个从不直接使用的基类来获得这样的功能，并且有一个或多个直接从它继承的类而不添加任何东西新的（这样的类可以共享它们的所有代码，但不能相互替代）。然而，任何符合 CLR 的语言都将允许使用提供接口的第二个特性（可替换性）而没有第一个特性（成员重用）的接口。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2012-03-28T11:35:53.613

我知道我知道即使它不允许等等，有时你实际上需要它，所以对于那些：

```
class a {}
class b : a {}
class c : b {} 
```

就像我的情况一样，我想做这个类 b：Form（是的 w​​indows.forms）类 c：b {}

因为一半的功能是相同的，并且接口你必须全部重写

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2015-10-12T13:04:18.593

由于多重继承（MI）的问题不时出现，我想添加一种方法来解决组合模式的一些问题。

正如问题中提出的那样，我建立在`IFirst`, `ISecond`, `First`, `Second`,方法的基础上。`FirstAndSecond`我将示例代码缩减为`IFirst`，因为无论接口/ MI 基类的数量如何，模式都保持不变。

让我们假设，使用 MI`First`并且`Second`都将派生自同一个基类`BaseClass`，仅使用来自的公共接口元素`BaseClass`

这可以通过`BaseClass`在`First`and`Second`实现中添加容器引用来表达：

```
class First : IFirst {
  private BaseClass ContainerInstance;
  First(BaseClass container) { ContainerInstance = container; }
  public void FirstMethod() { Console.WriteLine("First"); ContainerInstance.DoStuff(); } 
}
... 
```

事情变得更加复杂，当`BaseClass`引用受保护的接口元素时，或者何时`First`并且`Second`将是 MI 中的抽象类，要求它们的子类实现一些抽象部分。

```
class BaseClass {
  protected void DoStuff();
}

abstract class First : IFirst {
  public void FirstMethod() { DoStuff(); DoSubClassStuff(); }
  protected abstract void DoStuff(); // base class reference in MI
  protected abstract void DoSubClassStuff(); // sub class responsibility
} 
```

C# 允许嵌套类访问其包含类的受保护/私有元素，因此这可用于链接实现中的抽象位`First`。

```
class FirstAndSecond : BaseClass, IFirst, ISecond {
  // link interface
  private class PartFirst : First {
    private FirstAndSecond ContainerInstance;
    public PartFirst(FirstAndSecond container) {
      ContainerInstance = container;
    }
    // forwarded references to emulate access as it would be with MI
    protected override void DoStuff() { ContainerInstance.DoStuff(); }
    protected override void DoSubClassStuff() { ContainerInstance.DoSubClassStuff(); }
  }
  private IFirst partFirstInstance; // composition object
  public FirstMethod() { partFirstInstance.FirstMethod(); } // forwarded implementation
  public FirstAndSecond() {
    partFirstInstance = new PartFirst(this); // composition in constructor
  }
  // same stuff for Second
  //...
  // implementation of DoSubClassStuff
  private void DoSubClassStuff() { Console.WriteLine("Private method accessed"); }
} 
```

涉及相当多的样板，但如果 FirstMethod 和 SecondMethod 的实际实现足够复杂并且访问的私有/受保护方法的数量适中，那么这种模式可能有助于克服缺乏多重继承的问题。

# version-control - 为什么分布式源代码控制被认为更难？

> ID：178341
> 
> 赞同：12
> 
> 时间：2008-10-07T13:08:24.897
> 
> 标签：version-control

人们向新手推荐 SVN 以进行源代码控制似乎相当普遍（至少在这里），因为它比分布式选项之一“更容易”。在为我的许多项目切换到 Git 之前，作为一个非常随意的 SVN 用户，我发现根本不是这种情况。

从概念上讲，使用（或其他方式）设置 DCVS 存储库*更容易*`git init`，而无需在 SVN 的情况下设置外部存储库。

SVN、Git、Mercurial、Bazaar 之间的基本功能都使用基本相同的命令来提交、查看差异等。这是一个新人真正要做的事情。

与 SVN 的“提交所有内容”策略相比，Git 要求在提交之前显式添加更改的方式的微小差异在概念上很简单，除非我弄错了，否则在使用 Mercurial 或 Bazaar 时甚至都不是问题。

那么为什么认为 SVN 更容易呢？我认为这根本不是真的。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-07T13:16:14.647

如果您只为自己使用版本控制，SVN 可能更难，因为设置更难。但是，如果您想通过 Web 与多个开发人员合作，服务器端控件具有以下优势：

*   您有一个中心位置，它始终拥有最先进的官方资源，即 SVN 服务器
*   由于每个人总是将他的更改与中央服务器合并，因此冲突更少，手动修复冲突也更少
*   您可以集中控制源
*   您有一个正式的修订号而不是修订哈希，在所有开发人员中都相同并显示官方进度（它是一个向上计数的数字，与哈希不同，哈希只是一个身份指纹，因此您可以看到哪个代码更新或年纪大了，就这个数字

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-07T13:28:44.450

分布式版本控制系统是一件非常好的事情 (tm)，但我发现采用的主要障碍是教育用户了解新 SCM 提供的新可能性。

再加上 UI 工具的数量经常乏善可陈（半成品的乌龟实现等），让许多早已放弃命令行以追求好的 UI 工具的同事白了眼。

此外，使用 CVS 之类的工具，我发现人们讨厌分支和合并，因为他们真的不希望整天被困在进行三向合并，通常不确定哪个是正确的合并。

我的观点是：首先告诉人们他们获得了什么（不仅仅是“嘿，看看这个新的酷玩具”），并让他们了解使用命令行是可行的方法，并且频繁的恒定时间分支是一件好事.

诸如 mercurial 之类的许多系统都带有完整的补丁队列系统，这意味着从持续集成的角度来看，您*知道*任何投入生产的东西都已经过 QA 的批准。这样的事情很难用 CVS 或 SVN 正确完成。

使用 Mercurial，人们将拥有用于当前工作的私有存储库，并且所有开发人员在服务器上共享一个开发人员树。CI 系统监视开发者树并提取所有更改、构建和执行单元测试。如果一切通过，它会将更改传播到测试树，从那里为 QA 人员构建可交付成果。添加的每个变更集都会获得一个令牌。当 QA 认为某个功能已完成时，他们会使用此标记对测试树进行注释，然后相关的变更集会自动传播到生产树。

使用这种方法，您将永远不会手动向生产分支或测试分支提交任何内容。而是代码的状态和 QA 的签核决定了生产分支的内容，

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-10-07T13:14:23.200

我相信从概念上来说，考虑一个集中的存储库，每个开发人员都提交他的工作，而不是整个存储库的多个副本，这些副本都不代表“真相”。由于大多数开发人员都熟悉客户端-服务器模型和后端数据库的概念，因此这是一个很自然的概念。

当然，分布式源代码控制系统的强大之处在于它们不必坚持这种模式，但对于新手来说，似乎更容易掌握。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-07T13:19:06.607

Svn 强制使用单个工作线。您可以提交，也可以不提交。有类似的经历，我不觉得 Hg 或 Git 很难使用，但是，我在一个团队工作，他们似乎觉得使用它们是噩梦。

自动分支、多头、何时合并以及何时不合并的整个概念完全让他们无法理解，更不用说他们很难摆脱“使用 $somecore 提交/结帐”的心态，这会导致他们在看到推送时完全混淆在 2 个签出副本之间。

（有一段时间有人重复合并了两个不应该合并的分支，因为他们无法掌握这个概念。）

然而，那些在分布式 SCMS 上遇到问题的人让我问[了这个问题](https://stackoverflow.com/questions/132520/good-excuses-not-to-use-version-control)

**编辑/注释** Mercurials 与 git 相比，我注意到的最大区别在于，让新手更难使用 mercurial 是 mercurials 推/拉的默认行为就像做 git push --all / git pull --all ，它可以传播私有分支并添加很多混乱（特别是当一个新的分支出现时，mercurial 害怕地冻结并询问你如何处理它而不是继续卡车运输），以及 mac 上的默认合并/冲突解决工具只是破坏了一组更改盲目地。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-07T13:23:32.917

我认为 SVN 的工具集要广泛得多，因此您可以坐下来教人们（TortoiseSVN、RapidSVN 等），即使他们对存储库的工作原理没有太多概念。为您托管 SVN（例如使用 trac）也相对容易，无需了解任何内容。分布式的还没有这种支持，我相信当他们这样做时，他们的意见会改变。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-07T13:15:00.873

我认为使用 DVCS 设置存储库*实际上*更容易，但*在概念上*更难。毕竟，使用集中式 VCS，用户无需设置自己的存储库，他们只需在 Assembla 上创建一个帐户或为他们设置存储库。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-07T14:57:45.267

DVCS 目前缺乏好的桌面客户端。尽管大多数人说，版本控制系统可能很难正确使用，所以一个好的桌面客户端真的可以提供帮助 - 而 TortoiseSVN 在这里表现出色。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-02T13:55:50.533

在 Codice，我们努力让它尽可能简单，但解释起来总是有点困难，当然，这取决于观众。

对于 OSS 项目和小型团队，尤其是在笔记本电脑上工作、到处移动、在家工作、有时在飞机上工作等的人，这非常容易。但是，每当您与公司/企业交谈时，他们都会对它的多站点角色感到兴奋，但乍一看并没有那么多关于分布式的。这完全取决于该小组是否拥有大多数高级开发人员。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-06-15T19:04:21.787

这是[糟糕的营销](http://jamesmckay.net/2010/03/command-line-instructions-are-not-a-good-marketing-strategy/)，就这么简单。太多的 DVCS 介绍都集中在命令行上并说“哇，这不是太棒了，您只需键入 hg merge 就可以进行合并”，而完全没有注意到许多人（尤其是在 Windows 领域）对命令行。是的，Joel Spolsky，我在这里查看您自己的[hginit.com——](http://hginit.com/)我们需要 TortoiseHg 版本！

也许两年前他们的 GUI 实现很差，但最近他们突飞猛进。TortoiseHg 现在是 1.0 版，虽然它在视觉上可能没什么值得大书特书的地方，但它非常可靠、稳定且易于使用。TortoiseGit 也是坚如磐石的，它在抽象出 git 命令行的所有复杂性方面做得很好。

# asp.net - 当我编辑 web.config 时会发生什么？

> ID：178342
> 
> 赞同：82
> 
> 时间：2008-10-07T13:08:50.497
> 
> 标签：asp.net, sharepoint, iis-6

我需要在实时 Sharepoint 环境中编辑 web.config 文件，但我不确定如果这样做会发生什么（我想输出自定义错误）。

这会导致 IIS6 工作进程回收吗？

活跃用户会因此失去他们的会话状态吗？

或者我可以安全地编辑文件吗？

* * *

## 回答 #1

> 赞同：78
> 
> 时间：2008-10-07T13:13:05.183

应用程序池将重新启动，会话状态将丢失。想象每个 ASP.NET 应用程序（在 IIS 中定义）都是桌面上的一个程序。保存 web.config 将执行类似于关闭程序并重新打开它的操作。

* * *

## 回答 #2

> 赞同：30
> 
> 时间：2008-10-07T13:14:48.767

1.  是的。它将被回收。
2.  是的。他们将失去他们的会话。
3.  是的。您可以安全地编辑该文件。我建议您阅读这篇 MSDN 文章：[Working with web.config Files in Windows SharePoint Services](http://msdn.microsoft.com/en-us/library/ms868619.aspx)

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-10-08T15:25:12.153

此外，如果会话状态配置为进程外（数据库或服务），则回收应用程序池*不会*丢失任何会话状态。这对于 Sharepoint 和 vanilla ASP.Net 一样适用。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2018-06-20T23:11:22.050

当您编辑 web.config 时，它将重新启动该 Web 应用程序的 AppDomain（不是 AppPool）并清除所有占用的资源和内存。因此在该 App Pool 下运行的其他 Web 应用程序不会受到影响。它还将清除会话（进程内）和内存缓存。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-08T06:43:46.013

正如一些人已经提到的：IIS 中站点的应用程序池将重新启动（这通常需要几秒钟）。结果，下一页请求将变慢（因为不再缓存任何内容）。用户的会话状态也会丢失；但是默认情况下不使用 WSS 会话状态，在 MOSS 中它由 InfoPath Form Services 使用。因此，您可能没有与丢失会话状态相关的大问题。

另一方面; 为了克服这些问题：通常要做的是创建一个 SharePoint 解决方案 (WSP)，该解决方案部署并启动一个计时器作业以从代码更改 web.config（使用对象模型的 SPWebConfigModification 类）。好处是您可以安排更改的执行，这样您的用户就不会注意到它。

# visual-studio - 无法在 Visual Studio 2005 中开始调试

> ID：178351
> 
> 赞同：3
> 
> 时间：2008-10-07T13:10:18.293
> 
> 标签：visual-studio

我的“开始调试”按钮和元素菜单是灰色的……但仅在我的一个项目（一个 ASP.NET 网站）上。我不知道我做了什么来禁用它。

我已经检查了解决方案和项目的“属性”页面中的所有内容。我什至将它与另一个项目进行了比较，但似乎没有任何效果......也许我错过了一个选项？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-20T05:15:46.537

听起来您的启动项目都设置为“无需调试即可启动”，因为这会导致按钮和元素变灰。

这可以从解决方案 -> 设置启动项目中修复。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-07T13:13:33.590

它是一个启动项目吗？您只能调试可以实际启动的项目。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-07T13:15:55.503

右键单击项目，然后单击属性。然后单击“开始选项”（或类似内容）以查看设置。如果它是一个可执行项目，您可能想要选择将启动项目输出的选项。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-07T13:16:27.593

如果您能够启动项目，通常可以使用 Ctrl+Alt+P 附加调试器（或从调试菜单中选择附加到进程），然后从出现的列表中选择进程。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-08T09:04:43.657

您是否正在运行 COM+ 事件系统服务？

# asp.net - DropDownList 何时在 SelectedIndexChanged 事件处理程序中保留回发的值

> ID：178389
> 
> 赞同：1
> 
> 时间：2008-10-07T13:16:48.390
> 
> 标签：asp.net, vb.net, webforms, drop-down-menu

**澄清所有这些问题绝对不是源于重新绑定控件，并且绑定后值不会保持初始值。**

我在多个项目中使用的 aspx 页面上有一个 DropDownList。

在页面的生命周期中，SelectedValue 在处理 SelectedIndexChanged 事件之前发生更改。

在一个项目中，当代码到达事件处理程序时，SelectedValue 返回到客户端发布的内容，而在另一个项目中，新的 SelectedValue 存在。

Viewstate 在这两种情况下都处于打开状态，控件没有被反弹，并且遵循与我能收集到的所有内容完全相同的流程。

控件没有再次初始化，我彻底检查了这一点，并没有保留初始值，而是保留代码中设置的值。

我实际上需要在第一个项目中发生的事件处理程序点的发布值，但不明白为什么它会变回发布值以及如何在第二个项目中复制此行为。

如果有任何不清楚的地方，我很乐意进一步澄清。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-07T13:19:40.100

也许在 on_load 事件中执行了两次初始化，因为您没有在测试中使用[IsPostBack](http://msdn.microsoft.com/fr-fr/library/system.web.ui.page.ispostback(VS.80).aspx)检查页面是否回发？

十分钟前我的一位同事恰好发生了这种情况:-)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-07T13:28:33.857

许多人错误地认为 DropDownLists 必须启用 ViewState 才能保留选定的值。我几乎从来没有在 DropDownLists 上将 EnableViewState 设置为 true，因为它们在带有已发布值的表单中工作正常。（并且在 DataBinding 控件上将其设置为 true 将导致长视图状态）

**发布的值（下拉列表中的选定项目）是从页面中OnInit**之后的后参数加载的，因此如果您将数据绑定到 OnInit 中的下拉列表，它将正常工作。

如果您在**OnLoad**中绑定，则选定的值将被覆盖。

也许您在错误的事件中进行了数据绑定，以便选定的值被下拉菜单上的 DataBind 调用覆盖？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-07T13:21:41.360

当我忘记在某处检查 IsPostback 时，我通常会看到这种行为。该页面将在转到 SelectedIndexChanged 事件处理程序之前加载所有原始数据。

# asp.net - ASP.NET 母版页和内容页中的表单元素

> ID：178396
> 
> 赞同：24
> 
> 时间：2008-10-07T13:19:39.147
> 
> 标签：asp.net, forms, webforms, master-pages

好的，我当前项目中的另一个障碍。

**我的母版页和内容页中都**没有表单元素，我倾向于在内容中包含相关的所有表单。

然而，在当前项目中，我们有一个他们想要两者的页面。**右上角的登录表单和内容中的问题表单。**

在尝试解决这个问题后，我遇到了 ASP.NET 抱怨母版页中需要单个表单元素的问题。TBH，我真的不明白为什么这是 ASP.NET 的要求，但是嘿嘿。

**有谁知道我是否/如何让主页面和内容页面包含独立工作的表单元素？**

如果没有，您能否就如何继续获得所需的外观/功能提供建议？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-10-27T16:54:59.310

我想我会回顾一下我的一些悬而未决的问题，看看我是否可以关闭其中一些。

这个很有趣。我完全不相信在 ASP.NET 页面上只能有一个表单。这对我来说毫无意义。我已经看到很多网页在网页上具有多个表单，**为什么 ASP.NET 页面应该有所不同？**

所以，它让我思考。

### 为什么 ASP.NET 页面*需要*表单元素？

ASP.NET 页面尝试通过 PostBack 模型提供状态持久性来模拟 WinForms 环境。这为无状态环境提供了状态元素。为了做到这一点，运行时需要能够在每个“表单”中保持这种状态。它通过将数据回发给自己来做到这一点。需要注意的是：

*   PostBack 并没有什么花哨的地方。
*   它使用来自任何其他堆栈的 HTTP 表单和 POST，与任何其他表单相同。
*   只是因为它看起来可能在做一些特别的事情，但实际上并非如此，所发生的只是 POST 返回一些有关导致它的原因的信息，因此您可以在服务器端代码中执行诸如处理客户端事件之类的事情。

### 那为什么只有一个？

这对我来说是百万英镑的问题（我是英国人）。我知道 ASP.NET 需要这个，特别是如果您使用 ASP.NET 服务器控件，但**为什么我不能自己制作附加表单？**

所以，我想搞砸了，只是制作你自己的表格！

我做到了。我添加了一个沼泽标准的简单表单，提交操作为“#”。然后，这将对当前页面执行 POST，其中包含请求中给定表单的表单数据。

你猜怎么了？一切都很好。所以我最终得到：

*   一个母版页，其中包含一个 HTML 表单
*   此表单回传到当前页面（基本上是使用主页面的页面）。
*   在主页面的 Page_Load 代码隐藏中，我添加了代码来检查请求以查看请求中传递了哪些数据。如果它包含数据（比如隐藏字段），那么我知道帖子来自母版页上的表单，如果不是，那么它很可能是来自内容的 PostBack，可以忽略。
*   然后我用标签包围了内容`<form runat="server" id="aspNetForm"...> </form>`标签。这意味着所有内容页面都会自动拥有一个可以使用的表单。

这为我的问题提供了一个相对简单、干净的解决方案。我的登录表单与创建的所有内容表单一起工作得很好，其中一些是复杂的表单，其他的使用大量的服务器控件和许多 PostBacks，等等。

我希望这对其他人有帮助。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-07T13:28:29.800

表单标记本身位于 MasterPage 中，因此，您可以将任何 asp.net 服务器控件编码到您希望的母版页上。您可以在母版页的代码隐藏文件中编写这些服务器控件的处理逻辑。

因此，在您的示例中，您可以在母版页的右上角设置登录控件，然后在母版页的代码页中设置身份验证逻辑，而不是在您的内容页中。

这允许您在每个页面上都有登录控件，并维护该处理，以及维护内容控件及其在其各个页面上的处理。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-07T13:49:43.470

其他人已经提到在给定的 ASP.NET 页面中只能有一个表单元素，并且它将包含在母版页中。到现在为止还挺好。但我不认为这可以帮助你完全达到你想去的地方......

在您的母版页中，您已经（我假设！）定义了`asp:ContentPlaceHolder`控件。您使用母版的页面将具有相应的`asp:Content`标签。您所有的页面内容都必须放在这些相应的`asp:Content`标签中。

一旦进入该标记，它们就成为母版页表单的一部分。母版页可以响应来自其自己的控件的事件，而页面本身则响应来自其自己的控件的事件，并且您已经设置好了。

如果您需要页面与母版页交互，您可以通过`Page.Master`属性访问它。要与母版页中的任何公开可见的代码（方法、属性等）进行交互，您需要将此属性转换为正确的类型，并从那里访问公开可见的代码。

在这种情况下，这应该可以帮助您到达需要的位置。（它在多个站点上对我有用！）

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-27T17:17:51.073

抢，

有趣的解决方案。我看不出你在做什么有任何问题。然而，有些人可能会遇到的问题是，如果他们尝试使用 2 个服务器表单来执行此操作。ASP.NET 中没有规定一个页面上不能有超过 1 个 HTML 表单，只是页面上不能有多个“runat='server'”表单。显然，您已经找到了一种非常简单的方法来满足您的需求。

我发现在大多数情况下处理单个表单不是问题，因为 ASP.NET 框架基本上用命名容器为我们分离了所有内容。但是在您最初的帖子评论中，您遇到了一个重要因素，该因素缺席但对原始问题的本质至关重要：输入关键行为。这总是会给工作带来麻烦。

如果您要使用标准的“包罗万象”服务器表单，您不能使用文本框文本更改事件来捕获正确的操作吗？当然，如果用户在按 Enter 之前更改了这两个值，您会得到奇怪的行为。而且我认为 Enter 键的核心问题是，一旦您在 HTML 表单上提交了多个提交输入，在文本框中按 ENTER 将无济于事。只有当只有一个 INPUT 元素时，回车键才会导致“点击”。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2013-01-12T17:24:23.370

以前的答案都没有给出代码示例。这是 Visual Studio 2012 Site.Master 的简化版本，它说明了如何执行此操作：

```
<%@ Master Language="C#" AutoEventWireup="true" CodeBehind="Site - Copy.Master.cs" Inherits="WebApplication1.Site1Master" %>
<!DOCTYPE html>
<html>
    <head runat="server">
        <title>This is a title</title>
        <asp:ContentPlaceHolder runat="server" ID="HeadContent" />
    </head>
    <body>
    <form runat="server">
    <header>
        <div class="content-wrapper">
            <div class="float-right">
                <section id="login">
                    <asp:LoginView runat="server" ViewStateMode="Disabled">
                        <AnonymousTemplate>
                             <asp:ContentPlaceHolder runat="server" ID="AnonContent" />
                        </AnonymousTemplate>
                        <LoggedInTemplate>
                            <asp:ContentPlaceHolder runat="server" ID="LoggedInContent" />
                        </LoggedInTemplate>
                    </asp:LoginView>
                </section>
            </div>
        </div>
    </header>
        <div id="body">
        <asp:ContentPlaceHolder runat="server" ID="FeaturedContent" />
        <section class="content-wrapper main-content clear-fix">
            <asp:ContentPlaceHolder runat="server" ID="MainContent" />
        </section>
    </div>
    </form>
</body>
</html> 
```

因此，您将所有内容都包含在单个表单元素中，因此您可以在母版页中放置控件，而您的内容页面也可以使用控件。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-07T13:26:24.860

ASP.NET 页面上只能有一个表单。处理此问题的一种方法是在母版页的登录按钮上放置一个事件处理程序。处理程序将验证用户并在成功时重定向到同一页面（以正确运行 Page_Load 处理程序，该处理程序在事件处理程序之前运行）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-20T11:12:36.577

我通过在母版页中嵌入 iframe 解决了当前项目中“单击登录子表单中的返回键导致主表单提交”的问题。iframe 指向对用户进行身份验证的 login.aspx 页面。

```
<iframe id="login" src="login.aspx" frameborder="0" enableviewstate="false" scrolling="no" runat="server"></iframe> 
```

（出于某种原因，我需要关闭 /iframe 标记，否则设计视图会混淆）

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-11-07T12:52:53.470

您可以通过以下方式从 aspx 表单访问 MasterPage 控件：将贬损标签添加到 aspx 表单**<%@ MasterType VirtualPath="~/Site.Master %>** 并在后面的代码中使用**Master.FindControl();**通过以下方式获取控件ID

例如，如果您想获取 **Control form = Master.FindControl("form")**

现在您可以在代码中使用母版页的表单。

我希望这会有所帮助。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2011-11-18T23:17:28.987

药膏！在类似的帖子中，我发布了一个可能对您有所帮助的答案。您可以使用 jquery 将内容添加到空 div。该内容可以包括表单标签，甚至是独立于服务器端代码所做的任何事情的提交函数。唯一的缺点是如果用户没有启用 javascript！

而不是重新发布相同的答案（以及代码），这里是链接：

[在 asp.net webform 上的 Jquery Ajax 加载表单](https://stackoverflow.com/questions/2027643/jquery-ajax-loading-form-on-asp-net-webform/8190289#8190289)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2015-09-16T12:58:05.037

这是 ASP.NET 的限制

ASP.NET is designed to have one form per page and only one form. When it was originally designed that was not a problem.

However since then this has been identified as a huge problem with accessibility.

Microsoft Fix for this was ASP.NET MVC, if you are able to I would suggest considering moving to ASP.NET MVC as it solves a large number of problems with ASP.NET

* * *

## 回答 #11

> 赞同：-2
> 
> 时间：2010-03-31T10:20:38.197

您可以拥有超过 1 个表格。（一次只有 1 个可见）代码行 1 = 表格 1 可见 / 表格 2 隐藏。代码 2 表 2 可见/表 1 隐藏。= 已解决（这也适用于静态接触形式

* * *

## 回答 #12

> 赞同：-3
> 
> 时间：2008-10-07T13:21:35.057

不，每页只能有一个 asp.net 表单。这是自 1.0 以来的规则

他们应该共享相同的表格

# model-view-controller - 在 MVC 框架下，其他开发人员会期望哪种目录结构？

> ID：178398
> 
> 赞同：5
> 
> 时间：2008-10-07T13:19:54.780
> 
> 标签：model-view-controller, frameworks

通常，MVC 框架的结构类似于：

```
/models
/views
/controllers
/utils 
```

但是，在 Web 应用程序套件中，我认为将所有模型、视图和控制器聚集在一起可能不是为了清晰起见最好的方法，除非我将系统视为一个应用程序而不是应用程序套件。但是，有些东西将每个“应用程序”联系在一起，例如用户和用户角色的概念。

所以我有三种可能的解决方案：

(1) 做我不想做的事，将每个模型、视图和控制器放在一起，不管它属于哪个应用程序。这将套件视为单个应用程序，因为它们由包括用户在内的多个公共线程捆绑在一起。

(2) 按应用对代码进行分组。

```
/app1
    /models
    /views
    /controllers
    /utils
/app2
    /models
    /views
    /controllers
    /utils 
```

(3) 按类型对代码进行分组，让实用程序代码在所有应用程序之间共享。

```
/models
    /app1
    /app2
/views
    /app1
    /app2
/controllers
    /app1
    /app2
/utils 
```

有没有我错过的选项？对于未来的开发人员来说，最合乎逻辑的方案是什么？我个人更喜欢 2 和 3，但也许大多数人会期望 1。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-07T13:28:06.743

2是一个好的开始。您应该考虑拥有一个通用文件夹，您可以在其中存储应用程序套件中所有应用程序使用的任何通用模型、视图和实用程序。

```
/app1
   /models
   /views
   /controllers
   /utils
/app2
   /models
   /views
   /controllers
   /utils
/common
   /models
   /views
   /utils 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-07T13:26:42.800

假设您想要对应用程序进行一些分离，那么 2) 似乎是您的最佳选择。您还可以在“/app#”级别有一个“/common”文件夹，用于跨所有应用程序共享资源……例如共享实用程序类或其他。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-07T13:22:36.600

如果您的应用程序共享数据，那么（对我而言）将模型分组在一起可能是有意义的。

然而，对于视图和控制器来说，将它们分开可能更有意义，因为我假设它们具有独立的业务逻辑和表示。

此外，如果您的应用程序单独保存在版本控制中（您正在使用版本控制，对吗？:)，这使得第一个或第三个选项难以实现。

所以考虑到所有事情，我可能会在顶层分离应用程序，就像你的第二个例子一样。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-07T13:24:52.850

我通常按​​功能对代码进行分组，因此在您的情况下按应用程序分组对我来说最有意义。原因是，如果我想处理特定功能，我不应该在三个单独的文件夹中搜索我需要的组件。如果您按高级功能分组，您就会知道您需要的一切都在一起。

# mysql - MySql 5.0 可以查看位于另一台服务器上的表吗

> ID：178401
> 
> 赞同：3
> 
> 时间：2008-10-07T13:20:10.300
> 
> 标签：mysql, views

MySql 5.0 视图可以使用位于另一台服务器上的表吗？创建这样一个视图的语法是什么？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-07T15:28:47.857

联合表： [http ://dev.mysql.com/doc/refman/5.0/en/federated-storage-engine.html](http://dev.mysql.com/doc/refman/5.0/en/federated-storage-engine.html)

这允许远程访问表，就好像远程表是本地表一样。它有其局限性，但似乎满足我的需求。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-07T13:28:22.127

是的，您可以在一个数据库中创建引用另一个数据库甚至另一个主机的对象。这样做的语法是这样的：

```
USE localhost.myDB;

SELECT * FROM host2.db.tableName; 
```

# javascript - 选择除第一个之外的所有子元素

> ID：178407
> 
> 赞同：85
> 
> 时间：2008-10-07T13:21:20.610
> 
> 标签：javascript, jquery

说我有以下内容：

```
<ul>
 <li>First item</li>
 <li>Second item</li>
 <li>Third item</li>
</ul> 
```

如何在使用 jQuery 的第一个子元素之后选择所有子元素？所以我可以实现类似：

```
<ul>
 <li>First item</li>
 <li class="something">Second item</li>
 <li class="something">Third item</li>
</ul> 
```

* * *

## 回答 #1

> 赞同：143
> 
> 时间：2008-10-07T13:25:15.860

您应该能够使用“not”和“first child”选择器。

```
$("li:not(:first-child)").addClass("something"); 
```

[http://docs.jquery.com/Selectors/not](http://docs.jquery.com/Selectors/not)

[http://docs.jquery.com/Selectors/firstChild](http://docs.jquery.com/Selectors/firstChild)

* * *

## 回答 #2

> 赞同：38
> 
> 时间：2008-10-09T12:26:55.743

根据我对这里四种方法的完全不科学的分析，看起来它们之间的速度差异并不大。我在包含一系列不同长度的无序列表的页面上运行每一个，并使用 Firebug 分析器对它们进行计时。

```
$("li").slice(1).addClass("something"); 
```

平均时间：5.322ms

```
$("li:gt(0)").addClass("something"); 
```

平均时间：5.590ms

```
$("li:not(:first-child)").addClass("something"); 
```

平均时间：6.084ms

```
$("ul li+li").addClass("something"); 
```

平均时间：7.831ms

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2008-10-07T13:24:49.950

[http://docs.jquery.com/Traversing/slice](http://docs.jquery.com/Traversing/slice)

```
$("li").slice(1).addClass("something"); 
```

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2008-10-07T13:45:04.073

一个更优雅的查询（选择前面有 li 元素的所有 li 元素）：

`$('ul li+li')`

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-07T13:29:13.857

这应该工作

```
$('ul :not(:first-child)').addClass('something'); 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-10-07T14:31:45.913

我会用

```
$("li:gt(0)").addClass("something"); 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-07T13:27:49.567

这就是我到目前为止的工作

```
$('.certificateList input:checkbox:gt(0)') 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2018-05-21T08:52:04.130

使用 jQuery .not() 方法

```
$('li').not(':first').addClass('something'); 
```

或者

```
var firstElement = $('li').first();
$('li').not(firstElement).addClass('something'); 
```

# objective-c - 解决 Objective-C 命名空间冲突的最佳方法是什么？

> ID：178434
> 
> 赞同：176
> 
> 时间：2008-10-07T13:27:41.377
> 
> 标签：objective-c, cocoa, macos, namespaces

Objective-C 没有命名空间；它很像 C，一切都在一个全局命名空间中。通常的做法是在类前面加上首字母，例如，如果你在 IBM 工作，你可以在它们前面加上“IBM”；如果你为微软工作，你可以使用“MS”；等等。有时缩写是指项目，例如 Adium 为类加上“AI”前缀（因为它背后没有公司，你可以使用缩写）。Apple 用 NS 为类添加前缀，并表示此前缀仅供 Apple 使用。

到目前为止一切顺利。但是在前面的类名后面附加 2 到 4 个字母是一个非常非常有限的命名空间。例如，MS 或 AI 可能具有完全不同的含义（例如 AI 可能是人工智能），其他一些开发人员可能决定使用它们并创建一个同名的类。*Bang*，命名空间冲突。

好的，如果这是您自己的一个类和您正在使用的外部框架之一之间的冲突，您可以轻松更改类的命名，没什么大不了的。**但是，如果您使用两个外部框架，这两个框架您都没有源代码并且无法更改，该怎么办？**您的应用程序与它们都链接，并且您会遇到名称冲突。你将如何解决这些问题？以您仍然可以使用这两个类的方式解决它们的最佳方法是什么？

在 C 中，您可以通过不直接链接到库来解决这些问题，而是在运行时使用 dlopen() 加载库，然后使用 dlsym() 找到您要查找的符号并将其分配给全局符号（您可以以任何你喜欢的方式命名），然后通过这个全局符号访问它。例如，如果您因为某个 C 库有一个名为 open() 的函数而发生冲突，您可以定义一个名为 myOpen 的变量并让它指向该库的 open() 函数，因此当您想使用系统 open() ，您只需使用 open() ，当您想使用另一个时，您可以通过 myOpen 标识符访问它。

在 Objective-C 中是否有类似的可能，如果没有，是否有任何其他聪明、棘手的解决方案可以用来解决命名空间冲突？有任何想法吗？

* * *

### 更新：

只是为了澄清这一点：当然欢迎建议如何提前避免命名空间冲突或如何创建更好的命名空间的答案；但是，我不会接受它们作为**答案**，因为它们不能解决我的问题。我有两个库，它们的类名发生冲突。我无法改变它们；我没有任何一个的来源。碰撞已经存在，关于如何提前避免碰撞的提示将不再有帮助。我可以将它们转发给这些框架的开发人员，并希望他们将来选择更好的命名空间，但目前我正在寻找一种解决方案，以便现在在单个应用程序中使用这些框架。有什么解决方案可以使这成为可能吗？

* * *

## 回答 #1

> 赞同：93
> 
> 时间：2008-10-07T22:17:27.113

使用唯一前缀为类添加前缀基本上是唯一的选择，但有几种方法可以减少繁琐和丑陋。[这里](http://www.cocoadev.com/index.pl?AlternativesToPrefixing)对选项进行了长时间的讨论。我最喜欢的是`@compatibility_alias`Objective-C 编译器指令（[在此处](http://developer.apple.com/library/mac/#documentation/DeveloperTools/gcc-4.0.1/gcc/compatibility_005falias.html)描述）。您可以使用`@compatibility_alias`“重命名”一个类，允许您使用 FQDN 或一些这样的前缀来命名您的类：

```
@interface COM_WHATEVER_ClassName : NSObject
@end

@compatibility_alias ClassName COM_WHATEVER_ClassName
// now ClassName is an alias for COM_WHATEVER_ClassName

@implementation ClassName //OK
//blah
@end

ClassName *myClass; //OK 
```

作为完整策略的一部分，您可以使用唯一前缀（例如 FQDN）为所有类添加前缀，然后使用所有前缀创建标头`@compatibility_alias`（我想您可以自动生成所述标头）。

像这样加前缀的缺点是，`COM_WHATEVER_ClassName`除了编译器之外，您必须在需要来自字符串的类名的任何内容中输入真实的类名（例如上面）。值得注意的是，`@compatibility_alias`是编译器指令，而不是运行时函数，因此`NSClassFromString(ClassName)`会失败（返回`nil`）——你必须使用`NSClassFromString(COM_WHATERVER_ClassName)`. 您可以使用`ibtool`通过构建阶段来修改 Interface Builder nib/xib 中的类名，这样您就不必在 Interface Builder 中编写完整的 COM_WHATEVER_...。

最后警告：因为这是一个编译器指令（并且是一个晦涩难懂的指令），它可能无法跨编译器移植。特别是，我不知道它是否适用于 LLVM 项目的 Clang 前端，尽管它应该适用于 LLVM-GCC（LLVM 使用 GCC 前端）。

* * *

## 回答 #2

> 赞同：48
> 
> 时间：2008-10-08T04:51:59.030

如果您不需要同时使用两个框架中的类，并且您的目标是支持 NSBundle 卸载的平台（OS X 10.4 或更高版本，不支持 GNUStep），那么性能对您来说真的不是问题，我相信您可以在每次需要使用其中的类时加载一个框架，然后在需要使用另一个框架时卸载它并加载另一个框架。

我最初的想法是使用 NSBundle 加载其中一个框架，然后复制或重命名该框架内的类，然后加载另一个框架。这有两个问题。首先，我找不到复制指向重命名或复制类的数据的函数，并且第一个框架中引用重命名类的任何其他类现在将引用来自其他框架的类。

如果有办法复制 IMP 指向的数据，则不需要复制或重命名类。您可以创建一个新类，然后复制 ivars、方法、属性和类别。更多的工作，但这是可能的。但是，您仍然会遇到框架中引用错误类的其他类的问题。

编辑：据我所知，C 和 Objective-C 运行时之间的根本区别在于，当库被加载时，这些库中的函数包含指向它们引用的任何符号的指针，而在 Objective-C 中，它们包含这些符号的名称。因此，在您的示例中，您可以使用 dlsym 获取符号在内存中的地址并将其附加到另一个符号。库中的其他代码仍然有效，因为您没有更改原始符号的地址。Objective-C 使用查找表将类名映射到地址，并且是 1-1 映射，因此不能有两个具有相同名称的类。因此，要加载这两个类，其中一个必须更改其名称。但是，当其他类需要访问具有该名称的类之一时，

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2009-06-16T17:43:34.433

一些人已经分享了一些可能有助于解决问题的棘手而聪明的代码。一些建议可能有效，但都不太理想，其中一些实施起来非常糟糕。（有时丑陋的黑客是不可避免的，但我会尽可能避免它们。）从实际的角度来看，这是我的建议。

1.  在任何情况下，将冲突通知**两个**框架的开发人员，并明确表示他们未能避免和/或处理它会给您带来真正的业务问题，如果不解决，可能会导致业务收入损失。强调虽然在每个类的基础上解决现有冲突是一种不那么侵入性的解决方法，但完全更改它们的前缀（或者如果它们当前没有，则使用一个，并且对它们感到羞耻！）是确保它们不会的最佳方法再次看到同样的问题。
2.  如果命名冲突仅限于一组相当小的类，请查看是否可以仅解决这些类，特别是如果您的代码没有直接或间接使用其中一个冲突类。如果是这样，请查看供应商是否会提供不包含冲突类的框架的自定义版本。如果不是，请坦率地说，他们的不灵活正在降低您使用他们的框架的投资回报率。不要因为在合理范围内咄咄逼人而感到难过——客户永远是对的。;-)
3.  如果一个框架更“可有可无”，您可能会考虑将其替换为另一个框架（或代码组合），第三方或自制软件。（后者是最坏的情况，因为它肯定会产生额外的业务成本，包括开发和维护。）如果这样做，请告知该框架的供应商您决定不使用他们的框架的确切原因。
4.  如果这两个框架都被认为对您的应用程序同样不可或缺，请探索将其中一个框架的使用分解到一个或多个单独进程的方法，也许像 Louis Gerbarg 建议的那样通过 DO 进行通信。根据沟通的程度，这可能没有您想象的那么糟糕。几个程序（包括 QuickTime，我相信）使用这种方法来提供更细粒度的安全性，这些安全性是通过[在 Leopard 中使用安全带沙箱配置文件](http://www.318.com/techjournal/security/a-brief-introduction-to-mac-os-x-sandbox-technology/)提供的，这样只有特定的代码子集才被允许执行关键或敏感操作。性能将是一个权衡，但可能是您唯一的选择

我猜许可费用、条款和期限可能会阻止对这些点的即时行动。希望您能够尽快解决冲突。祝你好运！

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-02-28T00:00:52.937

这很糟糕，但是您可以使用[分布式对象](http://developer.apple.com/DOCUMENTATION/Cocoa/Conceptual/DistrObjects/DistrObjects.html)来将其中一个类仅保留在从属程序地址和 RPC 中。如果你来回传递大量的东西，那将会变得一团糟（如果两个类都直接操作视图等，这可能是不可能的）。

还有其他潜在的解决方案，但其中很多取决于具体情况。特别是，您使用的是现代运行时还是旧版运行时，您是胖还是单一架构，32 位还是 64 位，您的目标操作系统版本是什么，您是动态链接、静态链接还是您有选择，它是否可能可以做一些可能需要维护新软件更新的事情。

如果你真的很绝望，你可以做的是：

1.  不直接链接到其中一个库
2.  实现 objc 运行时例程的替代版本，在加载时更改名称（检查[objc4](http://www.opensource.apple.com/darwinsource/10.5.6/objc4-371.2/runtime/)项目，您究竟需要做什么取决于我上面提出的一些问题，但无论答案是什么，它都应该是可能的）。
3.  使用类似[mach_override](http://guiheneuf.org/mach%20inject%20for%20intel.html)的东西来注入你的新实现
4.  使用普通方法加载新库，它将通过修补的链接器例程并更改其类名

以上将是相当劳动密集型的，如果您需要针对多个拱门和不同的运行时版本实现它，那将是非常不愉快的，但它绝对可以工作。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-12-07T18:35:53.323

您是否考虑过使用运行时函数 (/usr/include/objc/runtime.h) 将其中一个冲突类克隆为非冲突类，然后加载冲突类框架？（这将需要在不同时间加载碰撞框架才能工作。）

您可以使用运行时检查类 ivars、方法（具有名称和实现地址）和名称，并动态创建您自己的以具有相同的 ivar 布局、方法名称/实现地址，并且仅在名称上有所不同（以避免碰撞）

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-02-27T07:49:06.813

绝望的情况需要采取绝望的措施。您是否考虑过破解其中一个库的目标代码（或库文件），将冲突符号更改为另一个名称 - 长度相同但拼写不同（但建议，名称长度相同）？天生恶心。

不清楚您的代码是否直接调用具有相同名称但实现不同的两个函数，或者冲突是否是间接的（也不清楚它是否有任何区别）。但是，重命名至少有一个外部机会。将拼写差异最小化也可能是一个想法，这样如果符号在表中按排序顺序排列，重命名就不会使事情乱序。如果他们正在搜索的数组未按预期排序，则二进制搜索之类的事情会变得不安。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2013-12-26T19:04:26.123

`@compatibility_alias`将能够解决类命名空间冲突，例如

```
@compatibility_alias NewAliasClass OriginalClass; 
```

但是，**这不会解决任何枚举、类型定义或协议命名空间冲突**。此外，它不能很好地与`@class`原始类的前向 decls 配合使用。由于大多数框架都会附带这些非类的东西，如 typedef，您可能无法仅使用 compatible_alias 来解决命名空间问题。

我查看[了与您类似的问题](http://michaelchinen.com/2013/12/25/namespacing-a-framework-in-objective-c-compatibility_alias-and-defines/)，但我可以访问源代码并正在构建框架。我为此找到的最佳解决方案是`@compatibility_alias`有条件地使用 #defines 来支持 enums/typedefs/protocols/etc。您可以有条件地在相关标头的编译单元上执行此操作，以最大程度地减少在其他冲突框架中扩展内容的风险。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-03-04T03:54:42.310

似乎问题在于您无法在同一翻译单元（源文件）中引用来自两个系统的头文件。如果您在库周围创建objective-c 包装器（使它们在过程中更有用），并且在包装器类的实现中仅#include 每个库的标头，这将有效地分离名称冲突。

我在 Objective-C 中没有足够的经验（刚刚开始），但我相信这就是我在 C 中会做的事情。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-07T14:14:04.560

为文件添加前缀是我所知道的最简单的解决方案。Cocoadev 有一个命名空间页面，这是社区为避免命名空间冲突所做的努力。随意将您自己的添加到此列表中，我相信这就是它的用途。

[http://www.cocoadev.com/index.pl?ChooseYourOwnPrefix](http://www.cocoadev.com/index.pl?ChooseYourOwnPrefix)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-03-01T17:18:50.127

如果您遇到冲突，我建议您认真考虑如何从您的应用程序中重构其中一个框架。发生冲突表明两者正在做类似的事情，您可能只需通过重构您的应用程序就可以使用额外的框架。这不仅可以解决您的命名空间问题，还可以使您的代码更健壮、更易于维护和更高效。

对于更技术性的解决方案，如果我处于您的位置，这将是我的选择。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2012-05-20T03:27:45.863

如果冲突仅发生在静态链接级别，那么您可以选择使用哪个库来解析符号：

```
cc foo.o -ldog bar.o -lcat 
```

如果`foo.o`和`bar.o`都引用该符号`rat`，则将`libdog`解析`foo.o`'s`rat`并将`libcat`解析`bar.o`'s `rat`。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2013-05-31T16:01:52.787

只是一个想法.. 没有经过测试或证明，可能是标记的方式，但是您是否考虑过为您使用的更简单的框架中的类编写适配器.. 或者至少是它们的接口？

如果您要围绕较简单的框架（或您访问最少的接口）编写一个包装器，则不可能将该包装器编译到库中。鉴于该库是预编译的，并且只需要分发**它的**头文件，您将有效地隐藏底层框架，并且可以自由地将它与第二个框架结合起来并发生冲突。

当然，我很欣赏有时您可能需要同时使用两个框架中的类，但是，您可以为该框架的进一步类适配器提供工厂。在这一点的背后，我想您需要进行一些重构才能从两个框架中提取您正在使用的接口，这应该为您构建包装器提供一个很好的起点。

当您需要来自包装库的更多功能时，您可以在库的基础上进行构建，并在它发生更改时简单地重新编译。

同样，没有得到证实，但感觉就像添加了一个视角。希望能帮助到你 ：）

* * *

## 回答 #13

> 赞同：-1
> 
> 时间：2013-01-18T00:54:49.267

如果您有两个具有相同函数名称的框架，您可以尝试动态加载框架。这将是不雅的，但可能。我不知道如何使用 Objective-C 类来做到这一点。我猜`NSBundle`该类将具有加载特定类的方法。

# c# - 在 ASP.NET 网站中正确使用文件设计器文件

> ID：178444
> 
> 赞同：2
> 
> 时间：2008-10-07T13:28:56.353
> 
> 标签：c#, .net, asp.net, visual-studio, designer

我需要将现有网页放入 Visual Studio 2008 中的现有 ASP.NET 网站项目中。我只是尝试将整个文件夹内容拖放到 Visual Studio 解决方案资源管理器中，甚至将它们复制到网站文件夹中。

两种方式，Visual Studio 似乎都无法将 .designer.cs 文件映射到相应的 .aspx（或 .master）文件，即使在重新启动整个 IDE 之后也是如此。解决方案资源管理器条目如下所示：

```
- Main.aspx
    Main.aspx.cs
  Main.aspx.designer.cs 
```

我可以以任何方式使 Visual Studio 文件成为 aspx 文件下方的设计器文件吗？我强烈希望有一种比手动创建每个文件并手动将内容复制并粘贴到每个文件中更简单的方法。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-08T06:28:12.240

听起来您正试图将 Web 应用程序文件带入网站。*如果是这种情况*，甚至不需要设计器文件。只是不包括他们。它们是在网站运行时在运行时生成和编译的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-07T13:57:23.423

有点自我回答我的问题：

在**Web 项目**中 - 与**网站**相反- 它通过拖放到解决方案资源管理器中完美地工作，就像我之前为网站所做的那样。要决定使用哪种类型的“网站单元”，stackoverflow 上有另一个线程：[ASP.NET Web Site 或 Web Project](https://stackoverflow.com/questions/10798/aspnet-web-site-or-web-project)。

在网站中，我什至不能使用 YonahW 的解决方案，因为我不能只将文件放入正确的网站目录而不导致它们自动添加到网站中。无论如何，谢谢你，YonahW。:-)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-07T13:47:25.317

尝试通过文件系统复制文件，然后右键单击项目并选择添加现有项目，此时您可以一次选择所有项目，这通常会将它们放在适当的位置。

# c++ - 从多选列表视图 ctrl 获取选定的成员

> ID：178449
> 
> 赞同：0
> 
> 时间：2008-10-07T13:30:20.187
> 
> 标签：c++, mfc, controls

我有一个列表视图控件，目前只允许选择一个项目。然后我通过以下代码阅读：

无效 CApp::OnNMClickList1(NMHDR *pNMHDR, LRESULT *pResult) { int nSelected = (m_List.GetSelectionMark()); ...

但是，现在我想让这个列表能够多选，GetSelectionMark() 总是返回一个索引。谁能帮我重新编码以返回选定索引的列表？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-07T13:47:29.870

用于[`GetFirstSelectedItemPosition()`](http://msdn.microsoft.com/en-us/library/hdxt1akf(VS.80).aspx)查找第一个选定项目，然后[`GetNextSelectedItem()`](http://msdn.microsoft.com/en-us/library/z1dasx7t(VS.80).aspx)查找其余项目，您就完成了。:)

# c# - 在 C# 中重新引发异常的正确方法是什么？

> ID：178456
> 
> 赞同：501
> 
> 时间：2008-10-07T13:33:55.080
> 
> 标签：c#, .net, exception

这样做更好吗：

```
try
{
    ...
}
catch (Exception ex)
{
    ...
    throw;
} 
```

或这个：

```
try
{
    ...
}
catch (Exception ex)
{
    ...
    throw ex;
} 
```

他们做同样的事情吗？这个比那个好吗？

* * *

## 回答 #1

> 赞同：858
> 
> 时间：2008-10-07T13:36:44.713

您应该始终使用以下语法重新引发异常。否则你会踩到堆栈跟踪：

```
throw; 
```

如果您打印由 产生的跟踪`throw ex`，您会看到它以该语句结束，而不是异常的真正来源。

基本上，使用`throw ex`.

* * *

如果需要重新抛出来自其他地方（AggregateException、TargetInvocationException）或可能来自另一个线程的异常，您也不应该直接重新抛出它。而是保留所有必要信息的[ExceptionDispatchInfo 。](https://docs.microsoft.com/en-us/dotnet/api/system.runtime.exceptionservices.exceptiondispatchinfo)

```
try
{
    methodInfo.Invoke(...);
}
catch (System.Reflection.TargetInvocationException e)
{
    System.Runtime.ExceptionServices.ExceptionDispatchInfo.Capture(e.InnerException).Throw();
    throw; // just to inform the compiler that the flow never leaves the block
} 
```

* * *

## 回答 #2

> 赞同：161
> 
> 时间：2008-10-07T13:43:24.980

我的偏好是使用

```
try
{
}
catch (Exception ex)
{
     ...
     throw new Exception ("Add more context here", ex)
} 
```

这保留了原始错误，但它允许您添加更多上下文，例如对象 ID、连接字符串等。通常我的异常报告工具会报告五个链接的异常，每个都报告更多细节。

* * *

## 回答 #3

> 赞同：42
> 
> 时间：2008-10-07T13:43:44.607

**如果您在没有**变量的情况下引发异常（第二个示例），堆栈跟踪将包括引发异常的原始方法。

在第一个示例中，堆栈跟踪将更改以反映当前方法。

例子：

```
static string ReadAFile(string fileName) {
    string result = string.Empty;
    try {
        result = File.ReadAllLines(fileName);
    } catch(Exception ex) {
        throw ex; // This will show ReadAFile in the stack trace
        throw;    // This will show ReadAllLines in the stack trace
    } 
```

* * *

## 回答 #4

> 赞同：22
> 
> 时间：2008-10-07T13:37:16.990

第一个保留异常的原始堆栈跟踪，第二个将其替换为当前位置。

因此，第一个*要好得多*。

* * *

## 回答 #5

> 赞同：16
> 
> 时间：2012-08-13T11:28:53.657

我同意大多数时候你要么想做一个 plain `throw`，尽可能多地保留关于哪里出了问题的信息，或者你想抛出一个新的异常，它可能包含一个内部异常，或者不是，取决于您想了解导致它的内部事件的可能性有多大。

不过也有例外。在几种情况下，一个方法将调用另一个方法，并且在内部调用中导致异常的条件应被视为外部调用中的相同异常。

一个示例是使用另一个集合实现的专用集合。假设它是 a`DistinctList<T>`包装 a `List<T>`，但拒绝重复的项目。

如果有人调用`ICollection<T>.CopyTo`您的集合类，它可能只是`CopyTo`对内部集合的直接调用（如果说，所有自定义逻辑仅适用于添加到集合或设置它）。现在，该调用将引发的条件与您的集合应引发的条件完全相同，以匹配`ICollection<T>.CopyTo`.

现在，您根本无法捕获异常，并让它通过。但是，在这里，用户在`List<T>`调用`DistinctList<T>`. 这不是世界末日，但您可能希望隐藏这些实现细节。

或者您可以自己检查：

```
public CopyTo(T[] array, int arrayIndex)
{
  if(array == null)
    throw new ArgumentNullException("array");
  if(arrayIndex < 0)
    throw new ArgumentOutOfRangeException("arrayIndex", "Array Index must be zero or greater.");
  if(Count > array.Length + arrayIndex)
    throw new ArgumentException("Not enough room in array to copy elements starting at index given.");
  _innerList.CopyTo(array, arrayIndex);
} 
```

这不是更糟糕的代码，因为它是样板文件，我们可能只是从其他实现中复制它`CopyTo`，它不是简单的传递，我们必须自己实现它。尽管如此，它还是会不必要地重复将在 中进行的*完全相同的*检查`_innerList.CopyTo(array, arrayIndex)`，因此它添加到我们代码中的唯一内容是可能存在错误的 6 行代码。

我们可以检查并包装：

```
public CopyTo(T[] array, int arrayIndex)
{
  try
  {
    _innerList.CopyTo(array, arrayIndex);
  }
  catch(ArgumentNullException ane)
  {
    throw new ArgumentNullException("array", ane);
  }
  catch(ArgumentOutOfRangeException aore)
  {
    throw new ArgumentOutOfRangeException("Array Index must be zero or greater.", aore);
  }
  catch(ArgumentException ae)
  {
    throw new ArgumentException("Not enough room in array to copy elements starting at index given.", ae);
  }
} 
```

就添加的可能有错误的新代码而言，情况更糟。我们并没有从内部异常中获得任何东西。如果我们将一个空数组传递给这个方法并接收一个`ArgumentNullException`，我们将不会通过检查内部异常并了解调用`_innerList.CopyTo`传递给一个空数组并抛出一个`ArgumentNullException`。

在这里，我们可以做我们想做的一切：

```
public CopyTo(T[] array, int arrayIndex)
{
  try
  {
    _innerList.CopyTo(array, arrayIndex);
  }
  catch(ArgumentException ae)
  {
    throw ae;
  }
} 
```

如果用户使用不正确的参数调用它，我们期望必须抛出的每一个异常都将被该重新抛出正确地抛出。如果这里使用的逻辑中存在错误，则它位于两行之一 - 要么我们错误地决定这是这种方法有效的情况，要么我们错误地`ArgumentException`寻找异常类型。这是 catch 块可能有的仅有的两个错误。

现在。我仍然同意，大多数时候您要么想要一个普通的，`throw;`要么您想要构建自己的异常，以便从相关方法的角度更直接地匹配问题。在上述情况下，这样的重新抛出更有意义，还有很多其他情况。例如，举一个非常不同的例子，如果使用 a`FileStream`和 an实现的 ATOM 文件阅读器`XmlTextReader`接收到文件错误或无效的 XML，那么它可能希望抛出与从这些类中接收到的完全相同的异常，但它应该查看调用者`AtomFileReader`正在抛出`FileNotFoundException`or `XmlException`，因此它们可能是类似重新抛出的候选者。

我们也可以将两者结合起来：

```
public CopyTo(T[] array, int arrayIndex)
{
  try
  {
    _innerList.CopyTo(array, arrayIndex);
  }
  catch(ArgumentException ae)
  {
    throw ae;
  }
  catch(Exception ex)
  {
    //we weren't expecting this, there must be a bug in our code that put
    //us into an invalid state, and subsequently let this exception happen.
    LogException(ex);
    throw;
  }
} 
```

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2010-07-05T13:29:24.523

您应该始终使用“投掷”；在 .NET 中重新抛出异常，

请参阅博客文章*[Throw 与 Throw ex](http://weblogs.asp.net/bhouse/archive/2004/11/30/272297.aspx)*。

基本上，MSIL (CIL) 有两条指令——“throw”和“rethrow”以及 C# 的“throw ex;”。被编译成 MSIL 的 "throw" 和 C# 的 "throw;" - 进入MSIL“重投”！基本上我可以看到“throw ex”覆盖堆栈跟踪的原因。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2008-10-07T13:37:34.133

第一个更好。如果您尝试调试第二个并查看调用堆栈，您将看不到原始异常的来源。如果您真的需要重新抛出，有一些技巧可以保持调用堆栈完整（尝试​​搜索，之前已经回答过）。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2011-01-08T00:00:45.063

我发现如果在捕获它的同一方法中抛出异常，则不会保留堆栈跟踪，因为它的价值。

```
void testExceptionHandling()
{
    try
    {
        throw new ArithmeticException("illegal expression");
    }
    catch (Exception ex)
    {
        throw;
    }
    finally
    {
        System.Diagnostics.Debug.WriteLine("finally called.");
    }
} 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-01-04T21:55:06.230

这取决于。在调试版本中，我希望尽可能少地查看原始堆栈跟踪。在这种情况下，“投掷”；符合要求。

然而，在发布版本中，（a）我想记录包含原始堆栈跟踪的错误，一旦完成，（b）重新设计错误处理以使用户更有意义。这里“抛出异常”是有道理的。确实，重新抛出错误会丢弃原始堆栈跟踪，但非开发人员从看到堆栈跟踪信息中一无所获，因此重新抛出错误是可以的。

```
 void TrySuspectMethod()
        {
            try
            {
                SuspectMethod();
            }
#if DEBUG
            catch
            {
                //Don't log error, let developer see
                //original stack trace easily
                throw;
#else
            catch (Exception ex)
            {
                //Log error for developers and then
                //throw a error with a user-oriented message
                throw new Exception(String.Format
                    ("Dear user, sorry but: {0}", ex.Message));
#endif
            }
        } 
```

问题的措辞方式，将“Throw:”与“Throw ex;”相提并论。让它有点像红鲱鱼。真正的选择是在“投掷”之间。和“Throw Exception”，其中“Throw ex;” 是“抛出异常”的一个不太可能的特例。

# python - Python，单元测试和模拟导入

> ID：178458
> 
> 赞同：14
> 
> 时间：2008-10-07T13:34:42.690
> 
> 标签：python, unit-testing, refactoring, python-import

我在一个项目中，我们开始重构一些庞大的代码库。立即出现的一个问题是每个文件都会导入许多其他文件。我如何以优雅的方式在我的单元测试中模拟它，而无需更改实际代码，以便我可以开始编写单元测试？

例如：包含我要测试的功能的文件导入了其他十个文件，这些文件是我们软件的一部分，而不是 python 核心库。

我希望能够尽可能单独地运行单元测试，现在我只测试不依赖于正在导入的文件中的东西的函数。

感谢所有的答案。

从一开始我真的不知道我想做什么，但现在我想我知道了。

问题是，由于某些第三方自动魔术，某些导入仅在整个应用程序运行时才有可能。所以我不得不在我用 sys.path 指出的目录中为这些模块创建一些存根

现在我可以在我的单元测试文件中导入包含我想要为其编写测试的函数的文件，而不会抱怨缺少模块。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-07T17:30:27.597

如果你想导入一个模块，同时确保它不导入任何东西，你可以替换`__import__`内置函数。

例如，使用这个类：

```
class ImportWrapper(object):
    def __init__(self, real_import):
        self.real_import = real_import

    def wrapper(self, wantedModules):
        def inner(moduleName, *args, **kwargs):
            if moduleName in wantedModules:
                print "IMPORTING MODULE", moduleName
                self.real_import(*args, **kwargs)
            else:
                print "NOT IMPORTING MODULE", moduleName
        return inner

    def mock_import(self, moduleName, wantedModules):
        __builtins__.__import__ = self.wrapper(wantedModules)
        try:
            __import__(moduleName, globals(), locals(), [], -1)
        finally:
            __builtins__.__import__ = self.real_import 
```

在您的测试代码中，不要编写，而是`import myModule`编写：

```
wrapper = ImportWrapper(__import__)
wrapper.mock_import('myModule', []) 
```

to的第二个参数`mock_import`是您*确实*要在内部模块中导入的模块名称列表。

这个例子可以进一步修改，例如导入其他模块而不是仅仅不导入它，或者甚至用你自己的一些自定义对象来模拟模块对象。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-07T13:59:18.833

“导入很多其他文件”？导入许多属于您的自定义代码库的其他文件？或者导入许多属于 Python 发行版的其他文件？还是导入很多其他的开源项目文件？

如果您的导入不起作用，那么您有一个“简单”的`PYTHONPAT`H 问题。将所有各种项目目录放到一个`PYTHONPATH`可用于测试的目录中。我们有一个相当复杂的路径，在 Windows 中我们这样管理它

```
@set Part1=c:\blah\blah\blah
@set Part2=c:\some\other\path
@set that=g:\shared\stuff
set PYTHONPATH=%part1%;%part2%;%that% 
```

我们将路径的每一部分分开，以便我们 (a) 知道事物来自哪里，并且 (b) 在我们移动事物时可以管理变化。

由于按`PYTHONPATH`顺序搜索，我们可以通过调整路径上的顺序来控制使用的内容。

一旦你拥有了“一切”，它就变成了一个信任问题。

任何一个

*   您信任某些东西（即 Python 代码库）并导入它。

或者

*   您不信任某些东西（即您自己的代码）并且您

    1.  单独测试它并
    2.  模拟它以进行独立测试。

你会测试 Python 库吗？如果是这样，你有很多工作。如果不是，那么，你或许应该只模拟你实际要测试的东西。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-07T14:05:11.660

如果你真的想搞砸 python 导入机制，看看这个[`ihooks`](http://pydoc.org/2.4.1/ihooks.html)模块。它提供了用于更改`__import__`内置行为的工具。但是从您的问题中不清楚为什么需要这样做。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-07T14:53:38.130

如果您想在单元测试之前快速进行修复，则无需进行任何困难的操作。

如果单元测试与您要测试的代码在同一个文件中，只需从`globals()`字典中删除不需要的模块。

这是一个相当长的例子：假设你有一个`impp.py`包含内容的模块：

```
value = 5 
```

现在，在您的测试文件中，您可以编写：

```
>>> import impp
>>> print globals().keys()
>>> def printVal():
>>>     print impp.value
['printVal', '__builtins__', '__file__', 'impp', '__name__', '__doc__'] 
```

请注意，这`impp`是全局变量，因为它是导入的。调用`printVal`使用`impp`模块的函数仍然有效：

```
>>> printVal()
5 
```

但是现在，如果您从...中删除`impp`密钥`globals()`

```
>>> del globals()['impp']
>>> print globals().keys()
['printVal', '__builtins__', '__file__', '__name__', '__doc__'] 
```

...并尝试打电话`printVal()`，你会得到：

```
>>> printVal()
Traceback (most recent call last):
  File "test_imp.py", line 13, in <module>
    printVal()
  File "test_imp.py", line 5, in printVal
    print impp.value
NameError: global name 'impp' is not defined 
```

...这可能正是您想要实现的目标。

要在您的单元测试中使用它，您可以在运行测试套件之前删除全局变量，例如`__main__`：

```
if __name__ == '__main__':
    del globals()['impp']
    unittest.main() 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-07T15:30:34.720

在你上面的评论[中](https://stackoverflow.com/questions/178458/python-unit-testing-and-mocking-imports#178829)，你说你想说服 python 某些模块已经被导入。这似乎仍然是一个奇怪的目标，但如果这真的是你想做的，原则上你可以在导入机制的背后偷偷摸摸，改变`sys.modules`. 不确定这对于包导入如何工作，但对于绝对导入应该没问题。

# php - 使用 PHP 设置本地服务器

> ID：178462
> 
> 赞同：0
> 
> 时间：2008-10-07T13:36:12.780
> 
> 标签：php, apache, localhost

我正在尝试在我的机器上本地设置 Apache/PHP/Postgresql 服务器。我正在使用 32 位的 Windows Vista 商业版。我尝试手动安装所有东西（一次一个东西，apache、postgresql 和 php（所有最新的稳定版本）），然后在我启动并运行所有东西之后。

每当我尝试在我的机器上运行脚本时，我都会收到“你想对 *.php 文件做什么？” 对话。该对话框是浏览器的打开/保存对话框

我只是想获取 phpinfo() 的输出以确保一切正常运行......

我已经尝试过使用 Apache conf 文件，但由于我不太了解自己在做什么，所以我再次重新安装了所有内容，但问题仍然存在。我有点感觉它一定与未正确安装 PHP 的东西有关。

当我尝试获取 phpinfo 的输出时，如下所示：

```
<pre><?php
   phpinfo();
?></pre> 
```

我得到*.php 文件的浏览器“打开/保存”对话框。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-07T13:43:40.097

您的 httpd.conf 文件中应该有这样的内容：

```
LoadModule php5_module "c:/php/php5apache2_2.dll"
AddType application/x-httpd-php .php
PHPIniDir "c:/php" 
```

确保它就位，并且不要忘记重新启动 apache！

在 Windows 中，conf 文件的默认位置是`C:\Program Files\Apache Group\Apache2\conf\httpd.conf`

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-07T13:46:41.480

您也可以在[安装部分](http://hu.php.net/manual/en/install.php)查看 PHP 的官方页面。

如果您在[Windows](http://hu.php.net/manual/en/install.windows.php)上，则有一个更紧密的链接。

您还可以为此使用一些预编译的安装程序，例如[XAMMP](http://www.apachefriends.org/en/xampp.html)，并在设置好并使用 Web 服务器和 php 运行之后安装 Postgres。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-07T13:44:37.693

你在 Windows 上吗？

我使用[Wamp 服务器](http://www.wampserver.com/en/)，这是在 Windows 上轻松安装和配置 Apache、MySQL 和 PHP 的绝佳方式。

如果您想改用 Postgres，只要您已单独安装它，它就可以正常工作。（您可以使用 Wamp 做的一件好事是通过 GUI 几乎即时添加和删除 PHP 扩展，而 pgsql 就是其中之一）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-07T13:44:43.467

也许有人可以提供帮助，但如果你能提供一些相关的细节，你会好得多。

你使用什么样的系统？请明确点。

您所说的“一切正常运行”是什么意思？

当您“尝试运行脚本”时，您在做什么？

您使用了哪些安装程序？（如果您从脚本或操作方法中跟踪它们，我们至少需要知道在哪里可以找到脚本或操作方法。）

我们不会自动知道这些事情。对你来说似乎很明显的事情对我们来说可能不清楚，对你来说似乎无关紧要的事情可能会变得至关重要。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-07T13:45:26.193

在 httpd.conf 中，确保正在加载 PHP 模块并且该行没有被注释掉。（httpd.conf 中的注释以 # 开头。）

还有你在运行什么操作系统？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-07T13:47:15.597

我遇到了同样的问题，您需要配置 apache 并添加 php 模块...例如，我从源代码和 apache 编译了 php。这样做之后，我将 libphp5.so 从 php/lib 目录复制到 apache/modules 目录中。比你必须在 http.conf 中添加 php

LoadModule php5_module 模块/libphp5.so

AddHandler php5-脚本 php

然后你可以重新启动 apache....这不是最优雅的解决方案，但它可以工作。

# c# - 如何在 C# 中创建具有不同线程的键盘挂钩？

> ID：178470
> 
> 赞同：1
> 
> 时间：2008-10-07T13:38:32.480
> 
> 标签：c#, keyboard-hook

我正在使用 SetWindowsHookEx 在 c# 中创建一个低级键盘挂钩，问题是如何使键盘事件函数在主线程以外的线程上运行？另外，除了主线程之外，我目前没有其他线程，那么如何创建一个在键盘钩子事件发生之前会停止的线程？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-07T13:45:00.470

这是[C# 键盘挂钩](http://forum.cheatengine.org/viewtopic.php?t=192699&sid=d25bb4a9d48a3518bba28ec63d6510a2)的代码。

你只需要调用 Hook.CreateHook(METHODNAMEHERE); 在一个新的线程中（参见线程类）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-07T13:45:26.617

由于有一个如何在新线程上设置挂钩的答案，因此这只回答了问题的第二部分：

如果您使用的是 Windows 窗体应用程序，那么在使用附加线程时会遇到一些问题。他们需要使用 Control.Invoke 与表单控件进行通信。

除此之外，启动你的“worker”线程，并让它等待一些 ManualResetEvent 或 AutoResetEvent。当您的键盘挂钩收到按键通知时，使用一些“共享”字段来放置键，然后重置事件，“等待”线程可以处理它。

不要忘记在“共享”字段周围实施适当的锁定。

# asp.net - LINQ 查询到 WebControl.Controls

> ID：178473
> 
> 赞同：1
> 
> 时间：2008-10-07T13:39:44.847
> 
> 标签：asp.net, linq, web-controls

我在页面上有三个 TextBox 控件

```
<asp:TextBox ID="TextBox1" runat="server" AutoPostBack="True"
        OnTextChanged="TextBox_TextChanged" TabIndex="1">
<asp:TextBox ID="TextBox2" runat="server" AutoPostBack="True"
        OnTextChanged="TextBox_TextChanged" TabIndex="2">
<asp:TextBox ID="TextBox3" runat="server" AutoPostBack="True"
        OnTextChanged="TextBox_TextChanged" TabIndex="3"> 
```

和一个事件处理程序

```
protected void TextBox_TextChanged(object sender, EventArgs e)
{
    WebControl changed_control = (WebControl)sender;

    var next_controls = from WebControl control in changed_control.Parent.Controls
                        where control.TabIndex > changed_control.TabIndex
                        orderby control.TabIndex
                        select control;

    next_controls.DefaultIfEmpty(changed_control).First().Focus();
} 
```

这段代码的含义是在页面回发后自动选择带有下一个 TabIndex 的 TextBox（参见[Little JB 的问题](https://stackoverflow.com/questions/173810/autopostback-with-textbox-loses-focus-question-made-clearer)）。实际上，我收到 InvalidCastException，因为无法从 System.Web.UI.LiteralControl（WebControl.Controls 实际上包含 LiteralControls）转换为 System.Web.UI.WebControls.WebControl。

我很感兴趣是否有可能以某种方式修改这种方法以获得有效的解决方案？谢谢！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-07T13:48:01.743

[类型](http://msdn.microsoft.com/en-us/library/bb360913.aspx)

```
from control in changed_control
  .Parent
  .Controls
  .OfType<WebControl>() 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-07T13:46:22.057

您应该能够使用 OfType 方法，仅返回给定类型的控件。

例如

```
var nextcontrols = from WebControl control in     
                   Changed_control.Parent.Controls.OfType<TextBox>()... etc 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-07T13:49:04.080

问题是 LiteralControl 没有从 WebControl 继承。但是它不能有焦点，所以不选择它们是可以的。在您的 LINQ 语句中，为 WebControl 添加另一个条件检查。所以你的 where 线应该是`where control.TabIndex > changed_control.TabIndex && control is WebControl`。

# java - PreparedStatement IN 子句的替代方案？

> ID：178479
> 
> 赞同：369
> 
> 时间：2008-10-07T13:41:36.310
> 
> 标签：java, security, jdbc, prepared-statement, in-clause

`IN`使用带有 实例的SQL 子句的最佳解决方法是什么`java.sql.PreparedStatement`，由于 SQL 注入攻击安全问题，不支持多个值：一个`?`占位符代表一个值，而不是值列表。

考虑以下 SQL 语句：

```
SELECT my_column FROM my_table where search_column IN (?) 
```

使用本质上是对首先 `preparedStatement.setString( 1, "'A', 'B', 'C'" );`使用原因的解决方法的非工作尝试。`?`

有哪些解决方法？

* * *

## 回答 #1

> 赞同：211
> 
> 时间：2008-10-09T22:13:14.000

[此处](http://www.javaranch.com/journal/200510/Journal200510.jsp#a2)提供了对各种可用选项的分析，以及每种选项的优缺点。

建议的选项是：

*   Prepare `SELECT my_column FROM my_table WHERE search_column = ?`，为每个值执行它并在客户端合并结果。只需要一个准备好的语句。缓慢而痛苦。
*   准备`SELECT my_column FROM my_table WHERE search_column IN (?,?,?)`并执行它。每个大小的 IN 列表需要一个准备好的语句。快速而明显。
*   准备`SELECT my_column FROM my_table WHERE search_column = ? ; SELECT my_column FROM my_table WHERE search_column = ? ; ...`并执行它。[或者用`UNION ALL`这些分号代替。--ed] 每个大小的 IN 列表需要一个准备好的语句。非常慢，严格来说比 差`WHERE search_column IN (?,?,?)`，所以我不知道为什么博主甚至建议它。
*   使用存储过程来构造结果集。
*   准备 N 个不同的 size-of-IN-list 查询；比如说，有 2、10 和 50 个值。要搜索具有 6 个不同值的 IN 列表，请填充 size-10 查询，使其看起来像`SELECT my_column FROM my_table WHERE search_column IN (1,2,3,4,5,6,6,6,6,6)`. 任何体面的服务器都会在运行查询之前优化重复值。

这些选项都不是理想的。

如果您使用 JDBC4 和支持的服务器，最好的选择是按照[此处所述](https://stackoverflow.com/questions/178479/preparedstatement-in-clause-alternatives/10240302#10240302)`x = ANY(y)`使用`PreparedStatement.setArray`

不过，似乎没有任何方法可以`setArray`使用 IN 列表。

* * *

有时 SQL 语句在运行时加载（例如，从属性文件），但需要可变数量的参数。在这种情况下，首先定义查询：

```
query=SELECT * FROM table t WHERE t.column IN (?) 
```

接下来，加载查询。然后在运行之前确定参数的数量。知道参数计数后，运行：

```
sql = any( sql, count ); 
```

例如：

```
/**
 * Converts a SQL statement containing exactly one IN clause to an IN clause
 * using multiple comma-delimited parameters.
 *
 * @param sql The SQL statement string with one IN clause.
 * @param params The number of parameters the SQL statement requires.
 * @return The SQL statement with (?) replaced with multiple parameter
 * placeholders.
 */
public static String any(String sql, final int params) {
    // Create a comma-delimited list based on the number of parameters.
    final StringBuilder sb = new StringBuilder(
        String.join(", ", Collections.nCopies(possibleValue.size(), "?")));

    // For more than 1 parameter, replace the single parameter with
    // multiple parameter placeholders.
    if (sb.length() > 1) {
        sql = sql.replace("(?)", "(" + sb + ")");
    }

    // Return the modified comma-delimited list of parameters.
    return sql;
} 
```

对于某些不支持通过 JDBC 4 规范传递数组的数据库，该方法可以方便地将 slow子句条件`= ?`转换为 fast`IN (?)`子句条件，然后可以通过调用该`any`方法进行扩展。

* * *

## 回答 #2

> 赞同：133
> 
> 时间：2012-04-20T04:32:39.820

PostgreSQL 的解决方案：

```
final PreparedStatement statement = connection.prepareStatement(
        "SELECT my_column FROM my_table where search_column = ANY (?)"
);
final String[] values = getValues();
statement.setArray(1, connection.createArrayOf("text", values));

try (ResultSet rs = statement.executeQuery()) {
    while(rs.next()) {
        // do some...
    }
} 
```

或者

```
final PreparedStatement statement = connection.prepareStatement(
        "SELECT my_column FROM my_table " + 
        "where search_column IN (SELECT * FROM unnest(?))"
);
final String[] values = getValues();
statement.setArray(1, connection.createArrayOf("text", values));

try (ResultSet rs = statement.executeQuery()) {
    while(rs.next()) {
        // do some...
    }
} 
```

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2008-10-09T21:52:49.640

没有简单的方法AFAIK。如果目标是保持较高的语句缓存率（即不为每个参数计数创建一个语句），您可以执行以下操作：

1.  创建一个带有几个（例如 10 个）参数的语句：

    ... WHERE A IN (?,?,?,?,?,?,?,?,?,?) ...

2.  绑定所有实际参数

    setString(1,"foo"); setString(2,"bar");

3.  将其余部分绑定为 NULL

    setNull(3,Types.VARCHAR) ... setNull(10,Types.VARCHAR)

NULL 从不匹配任何内容，因此它会被 SQL 计划生成器优化。

当您将 List 传递给 DAO 函数时，逻辑很容易自动化：

```
while( i < param.size() ) {
  ps.setString(i+1,param.get(i));
  i++;
}

while( i < MAX_PARAMS ) {
  ps.setNull(i+1,Types.VARCHAR);
  i++;
} 
```

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2018-04-29T09:33:40.570

您可以使用`Collections.nCopies`来生成占位符集合并使用以下方法加入它们`String.join`：

```
List<String> params = getParams();
String placeHolders = String.join(",", Collections.nCopies(params.size(), "?"));
String sql = "select * from your_table where some_column in (" + placeHolders + ")";
try (   Connection connection = getConnection();
        PreparedStatement ps = connection.prepareStatement(sql)) {
    int i = 1;
    for (String param : params) {
        ps.setString(i++, param);
    }
    /*
     * Execute query/do stuff
     */
} 
```

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2008-10-07T23:49:31.420

一个令人不快但肯定可行的解决方法是使用嵌套查询。创建一个包含一列的临时表 MYVALUES。将您的值列表插入到 MYVALUES 表中。然后执行

```
select my_column from my_table where search_column in ( SELECT value FROM MYVALUES ) 
```

丑陋，但如果您的值列表非常大，这是一个可行的选择。

如果您的数据库不缓存准备好的语句，这种技术具有额外的优势，即来自优化器的可能更好的查询计划（检查一个页面的多个值，表扫描一次而不是每个值一次等）可以节省开销。您的“插入”需要批量完成，并且可能需要调整 MYVALUES 表以具有最小的锁定或其他高开销保护。

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2016-02-17T14:44:18.823

## in() 运算符的局限性是万恶之源。

它适用于琐碎的情况，您可以使用“自动生成准备好的语句”来扩展它，但它总是有其局限性。

*   如果您正在创建具有可变数量参数的语句，这将在每次调用时产生 sql 解析开销
*   在许多平台上，in() 运算符的参数数量是有限的
*   在所有平台上，总 SQL 文本大小是有限的，因此无法为 in 参数发送 2000 个占位符
*   无法发送 1000-10k 的绑定变量，因为 JDBC 驱动程序有其局限性

in() 方法在某些情况下已经足够好了，但不是火箭证明:)

火箭证明解决方案是在单独的调用中传递任意数量的参数（例如，通过传递一组参数），然后有一个视图（或任何其他方式）在 SQL 中表示它们并在你的 where 中使用标准。

蛮力变体在这里[http://tkyte.blogspot.hu/2006/06/varying-in-lists.html](http://tkyte.blogspot.hu/2006/06/varying-in-lists.html)

但是，如果您可以使用 PL/SQL，那么这种混乱会变得非常整洁。

```
function getCustomers(in_customerIdList clob) return sys_refcursor is 
begin
    aux_in_list.parse(in_customerIdList);
    open res for
        select * 
        from   customer c,
               in_list v
        where  c.customer_id=v.token;
    return res;
end; 
```

然后您可以在参数中传递任意数量的逗号分隔的客户 ID，并且：

*   不会有解析延迟，因为 select 的 SQL 是稳定的
*   没有流水线功能的复杂性——它只是一个查询
*   SQL 使用简单的连接，而不是 IN 运算符，这非常快
*   毕竟，*不*使用任何普通的 select 或 DML 访问数据库是一个很好的经验法则，因为它是 Oracle，它提供的光年比 MySQL 或类似的简单数据库引擎还要多。PL/SQL 允许您以有效的方式从应用程序域模型中隐藏存储模型。

这里的诀窍是：

*   我们需要一个接受长字符串的调用，并将其存储在 db session 可以访问它的位置（例如简单的包变量或 dbms_session.set_context）
*   然后我们需要一个可以将其解析为行的视图
*   然后你有一个包含你正在查询的 id 的视图，所以你只需要一个简单的连接到所查询的表。

视图如下所示：

```
create or replace view in_list
as
select
    trim( substr (txt,
          instr (txt, ',', 1, level  ) + 1,
          instr (txt, ',', 1, level+1)
             - instr (txt, ',', 1, level) -1 ) ) as token
    from (select ','||aux_in_list.getpayload||',' txt from dual)
connect by level <= length(aux_in_list.getpayload)-length(replace(aux_in_list.getpayload,',',''))+1 
```

其中 aux_in_list.getpayload 指的是原始输入字符串。

* * *

一种可能的方法是传递 pl/sql 数组（仅由 Oracle 支持），但是您不能在纯 SQL 中使用这些数组，因此始终需要转换步骤。转换不能在 SQL 中完成，所以毕竟，传递一个带有字符串中所有参数的 clob 并在视图中转换它是最有效的解决方案。

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2016-04-08T05:06:57.013

这是我在自己的应用程序中解决它的方法。理想情况下，您应该使用 StringBuilder 而不是对字符串使用 +。

```
 String inParenthesis = "(?";
    for(int i = 1;i < myList.size();i++) {
      inParenthesis += ", ?";
    }
    inParenthesis += ")";

    try(PreparedStatement statement = SQLite.connection.prepareStatement(
        String.format("UPDATE table SET value='WINNER' WHERE startTime=? AND name=? AND traderIdx=? AND someValue IN %s", inParenthesis))) {
      int x = 1;
      statement.setLong(x++, race.startTime);
      statement.setString(x++, race.name);
      statement.setInt(x++, traderIdx);

      for(String str : race.betFair.winners) {
        statement.setString(x++, str);
      }

      int effected = statement.executeUpdate();
    } 
```

如果您决定稍后更改查询，则使用上面 x 之类的变量而不是具体数字会很有帮助。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2008-10-07T13:45:29.267

我从来没有尝试过，但是 .setArray() 会做你想要的吗？

**更新**：显然不是。setArray 似乎仅适用于来自您从先前查询中检索到的 ARRAY 列或具有 ARRAY 列的子查询的 java.sql.Array。

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2011-02-24T12:44:47.207

我的解决方法是：

```
create or replace type split_tbl as table of varchar(32767);
/

create or replace function split
(
  p_list varchar2,
  p_del varchar2 := ','
) return split_tbl pipelined
is
  l_idx    pls_integer;
  l_list    varchar2(32767) := p_list;
  l_value    varchar2(32767);
begin
  loop
    l_idx := instr(l_list,p_del);
    if l_idx > 0 then
      pipe row(substr(l_list,1,l_idx-1));
      l_list := substr(l_list,l_idx+length(p_del));
    else
      pipe row(l_list);
      exit;
    end if;
  end loop;
  return;
end split;
/ 
```

现在您可以使用一个变量来获取表中的一些值：

```
select * from table(split('one,two,three'))
  one
  two
  three

select * from TABLE1 where COL1 in (select * from table(split('value1,value2')))
  value1 AAA
  value2 BBB 
```

因此，准备好的语句可以是：

```
 "select * from TABLE where COL in (select * from table(split(?)))" 
```

问候，

哈维尔·伊巴内斯

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2008-10-07T13:47:36.063

我想您可以（使用基本的字符串操作）在 中生成查询字符串，`PreparedStatement`以使`?`' 的数量与列表中的项目数相匹配。

当然，如果你这样做，你离在查询中生成一个巨大的链接只有一步之遥`OR`，但是在查询字符串中没有正确的数量`?`，我不知道你还能如何解决这个问题。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2016-06-09T19:34:41.323

[您可以使用此 javadoc](http://docs.oracle.com/javase/6/docs/api/java/sql/PreparedStatement.html#setArray(int,%20java.sql.Array))中提到的 setArray 方法：

```
PreparedStatement statement = connection.prepareStatement("Select * from emp where field in (?)");
Array array = statement.getConnection().createArrayOf("VARCHAR", new Object[]{"E1", "E2","E3"});
statement.setArray(1, array);
ResultSet rs = statement.executeQuery(); 
```

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2015-04-20T04:46:38.823

这是一个完整的 Java 解决方案，可以为您创建准备好的语句：

```
/*usage:

Util u = new Util(500); //500 items per bracket. 
String sqlBefore  = "select * from myTable where (";
List<Integer> values = new ArrayList<Integer>(Arrays.asList(1,2,4,5)); 
string sqlAfter = ") and foo = 'bar'"; 

PreparedStatement ps = u.prepareStatements(sqlBefore, values, sqlAfter, connection, "someId");
*/

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.SQLException;
import java.util.ArrayList;
import java.util.List;

public class Util {

    private int numValuesInClause;

    public Util(int numValuesInClause) {
        super();
        this.numValuesInClause = numValuesInClause;
    }

    public int getNumValuesInClause() {
        return numValuesInClause;
    }

    public void setNumValuesInClause(int numValuesInClause) {
        this.numValuesInClause = numValuesInClause;
    }

    /** Split a given list into a list of lists for the given size of numValuesInClause*/
    public List<List<Integer>> splitList(
            List<Integer> values) {

        List<List<Integer>> newList = new ArrayList<List<Integer>>(); 
        while (values.size() > numValuesInClause) {
            List<Integer> sublist = values.subList(0,numValuesInClause);
            List<Integer> values2 = values.subList(numValuesInClause, values.size());   
            values = values2; 

            newList.add( sublist);
        }
        newList.add(values);

        return newList;
    }

    /**
     * Generates a series of split out in clause statements. 
     * @param sqlBefore ""select * from dual where ("
     * @param values [1,2,3,4,5,6,7,8,9,10]
     * @param "sqlAfter ) and id = 5"
     * @return "select * from dual where (id in (1,2,3) or id in (4,5,6) or id in (7,8,9) or id in (10)"
     */
    public String genInClauseSql(String sqlBefore, List<Integer> values,
            String sqlAfter, String identifier) 
    {
        List<List<Integer>> newLists = splitList(values);
        String stmt = sqlBefore;

        /* now generate the in clause for each list */
        int j = 0; /* keep track of list:newLists index */
        for (List<Integer> list : newLists) {
            stmt = stmt + identifier +" in (";
            StringBuilder innerBuilder = new StringBuilder();

            for (int i = 0; i < list.size(); i++) {
                innerBuilder.append("?,");
            }

            String inClause = innerBuilder.deleteCharAt(
                    innerBuilder.length() - 1).toString();

            stmt = stmt + inClause;
            stmt = stmt + ")";

            if (++j < newLists.size()) {
                stmt = stmt + " OR ";
            }

        }

        stmt = stmt + sqlAfter;
        return stmt;
    }

    /**
     * Method to convert your SQL and a list of ID into a safe prepared
     * statements
     * 
     * @throws SQLException
     */
    public PreparedStatement prepareStatements(String sqlBefore,
            ArrayList<Integer> values, String sqlAfter, Connection c, String identifier)
            throws SQLException {

        /* First split our potentially big list into lots of lists */
        String stmt = genInClauseSql(sqlBefore, values, sqlAfter, identifier);
        PreparedStatement ps = c.prepareStatement(stmt);

        int i = 1;
        for (int val : values)
        {

            ps.setInt(i++, val);

        }
        return ps;

    }

} 
```

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2015-06-01T12:18:02.207

Spring 允许[将 java.util.Lists 传递给 NamedParameterJdbcTemplate](http://docs.spring.io/spring/docs/4.2.x/spring-framework-reference/html/jdbc.html#jdbc-in-clause)，它会根据参数的数量自动生成 (?, ?, ?, ..., ?)。

对于 Oracle，[这篇博](https://blogs.itemis.de/kloss/2009/03/05/arrays-preparedstatements-jdbc-and-oracle/)文讨论了 oracle.sql.ARRAY 的使用（Connection.createArrayOf 不适用于 Oracle）。为此，您必须修改 SQL 语句：

```
SELECT my_column FROM my_table where search_column IN (select COLUMN_VALUE from table(?)) 
```

[oracle table 函数](http://stevenfeuersteinonplsql.blogspot.de/2015/04/table-functions-introduction-and.html)将传递的数组转换为可在`IN`语句中使用的类似表的值。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-10-07T14:13:09.070

尝试使用 instr 函数？

```
select my_column from my_table where  instr(?, ','||search_column||',') > 0 
```

然后

```
ps.setString(1, ",A,B,C,"); 
```

诚然，这有点肮脏，但它确实减少了 sql 注入的机会。无论如何都可以在oracle中使用。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2009-12-16T12:42:48.790

在 PreparedStatement 中生成查询字符串，以使多个 ? 与列表中的项目数相匹配。这是一个例子：

```
public void myQuery(List<String> items, int other) {
  ...
  String q4in = generateQsForIn(items.size());
  String sql = "select * from stuff where foo in ( " + q4in + " ) and bar = ?";
  PreparedStatement ps = connection.prepareStatement(sql);
  int i = 1;
  for (String item : items) {
    ps.setString(i++, item);
  }
  ps.setInt(i++, other);
  ResultSet rs = ps.executeQuery();
  ...
}

private String generateQsForIn(int numQs) {
    String items = "";
    for (int i = 0; i < numQs; i++) {
        if (i != 0) items += ", ";
        items += "?";
    }
    return items;
} 
```

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2011-11-21T19:30:54.997

[Sormula](http://www.sormula.org/)通过允许您提供 java.util.Collection 对象作为参数来支持 SQL IN 运算符。它创建一个带有 ? 对于集合中的每个元素。请参见[示例 4](http://www.sormula.org/example4/)（示例中的 SQL 是一个注释，用于阐明 Sormula 创建但未使用的内容）。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2013-08-24T19:29:46.653

而不是使用

```
SELECT my_column FROM my_table where search_column IN (?) 
```

使用 Sql 语句作为

```
select id, name from users where id in (?, ?, ?) 
```

和

```
preparedStatement.setString( 1, 'A');
preparedStatement.setString( 2,'B');
preparedStatement.setString( 3, 'C'); 
```

或者使用存储过程，这将是最好的解决方案，因为 sql 语句将被编译并存储在数据库服务器中

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2013-09-12T07:21:19.157

我遇到了一些与准备好的声明相关的限制：

1.  准备好的语句仅缓存在同一会话（Postgres）中，因此它仅适用于连接池
2.  @BalusC 提出的许多不同的预处理语句可能会导致缓存溢出，并且之前缓存的语句将被丢弃
3.  必须优化查询并使用索引。听起来很明显，但是例如@Boris 在最佳答案之一中提出的 ANY(ARRAY...) 语句不能使用索引，尽管缓存，查询也会很慢
4.  准备好的语句也会缓存查询计划，并且语句中指定的任何参数的实际值都不可用。

在提出的解决方案中，我会选择一个不会降低查询性能并减少查询次数的解决方案。这将是来自@Don 链接的#4（批处理少量查询）或为不需要的“？”指定 NULL 值。@Vladimir Dyuzhev 提出的标记

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2018-02-28T17:55:44.360

SetArray 是最好的解决方案，但它不适用于许多旧驱动程序。在 java8 中可以使用以下解决方法

```
String baseQuery ="SELECT my_column FROM my_table where search_column IN (%s)"

String markersString = inputArray.stream().map(e -> "?").collect(joining(","));
String sqlQuery = String.format(baseSQL, markersString);

//Now create Prepared Statement and use loop to Set entries
int index=1;

for (String input : inputArray) {
     preparedStatement.setString(index++, input);
} 
```

此解决方案优于其他丑陋的 while 循环解决方案，其中查询字符串是通过手动迭代构建的

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2019-01-11T03:44:58.087

我刚刚为此制定了一个特定于 PostgreSQL 的选项。这有点像 hack，并且有其自身的优缺点和局限性，但它似乎可以工作，并且不限于特定的开发语言、平台或 PG 驱动程序。

诀窍当然是找到一种方法将任意长度的值集合作为单个参数传递，并让数据库将其识别为多个值。我工作的解决方案是从集合中的值构造一个分隔字符串，将该字符串作为单个参数传递，并使用 string_to_array() 以及 PostgreSQL 所需的强制转换以正确使用它。

因此，如果您想搜索“foo”、“blah”和“abc”，您可以将它们连接成一个字符串，如：'foo,blah,abc'。这是直接的SQL：

```
select column from table
where search_column = any (string_to_array('foo,blah,abc', ',')::text[]); 
```

您显然会将显式转换更改为您希望结果值数组成为的任何内容——int、text、uuid 等。而且因为该函数采用单个字符串值（或者两个我想，如果您想自定义分隔符同样），您可以将其作为参数传递给准备好的语句：

```
select column from table
where search_column = any (string_to_array($1, ',')::text[]); 
```

这甚至足够灵活，可以支持 LIKE 比较之类的事情：

```
select column from table
where search_column like any (string_to_array('foo%,blah%,abc%', ',')::text[]); 
```

同样，毫无疑问，这是一个 hack，但它可以工作，并且允许您仍然使用预编译的准备好的语句，这些语句采用**ahem**离散参数，并具有伴随的安全性和（也许）性能优势。它是可取的并且实际上是有效的吗？当然，这取决于，因为您在查询运行之前就已经进行了字符串解析和可能的强制转换。如果您希望发送三个、五个、几十个值，当然，这可能没问题。几千？是的，也许没有那么多。YMMV，限制和排除适用，没有明示或暗示的保证。

但它有效。

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2021-04-22T08:29:11.993

似乎没有其他人建议使用现成的查询构建器，例如[jOOQ](https://www.jooq.org)或[QueryDSL](http://www.querydsl.com)甚至是管理开箱即用的[动态](https://www.jooq.org/doc/latest/manual/sql-building/conditional-expressions/in-predicate/)[列表的](https://www.jooq.org/doc/latest/manual/sql-building/conditional-expressions/in-predicate/)[Criteria Query](https://www.baeldung.com/hibernate-criteria-queries)，可能包括管理可能出现的所有边缘情况，例如：[`IN`](https://www.jooq.org/doc/latest/manual/sql-building/conditional-expressions/in-predicate/)

*   每个列表运行 Oracle 最多 1000 个元素`IN`（与绑定值的数量无关）
*   遇到任何驱动程序的最大绑定值数量，[我已在此答案中记录](https://stackoverflow.com/a/54149292/521799)
*   遇到游标缓存争用问题，因为太多不同的 SQL 字符串被“硬解析”并且无法再缓存执行计划（jOOQ 和最近 Hibernate 通过提供[`IN`列表填充](https://www.jooq.org/doc/latest/manual/sql-building/dsl-context/custom-settings/settings-in-list-padding/)来解决这个问题）

（免责声明：我为 jOOQ 背后的公司工作）

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2008-10-07T14:15:46.303

只是为了完整性：只要值集不是太大，您*也*可以简单地字符串构造一个语句，如

```
... WHERE tab.col = ? OR tab.col = ? OR tab.col = ? 
```

然后您可以将其传递给 prepare()，然后在循环中使用 setXXX() 来设置所有值。这看起来很糟糕，但是许多“大型”商业系统通常会做这种事情，直到它们达到特定于 DB 的限制，例如 Oracle 中的语句为 32 KB（我认为是）。

当然，您需要确保集合永远不会过大，或者在发生错误时进行错误捕获。

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2008-10-07T15:49:34.023

按照亚当的想法。使您准备好的语句类似于 select my_column from my_table where search_column in (#) 创建一个字符串 x 并用一些“？，？，？”填充它 取决于您的值列表然后只需将查询中的 # 更改为您的新字符串 x 填充

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2014-01-26T09:32:03.250

对于 PreparedStatement 中的 IN 子句，我们可以使用不同的替代方法。

1.  使用单个查询 - 最慢的性能和资源密集型
2.  使用 StoredProcedure - 最快但特定于数据库
3.  为 PreparedStatement 创建动态查询 - 性能良好，但没有从缓存中受益，并且每次都重新编译 PreparedStatement。
4.  在 PreparedStatement 查询中使用 NULL - 最佳性能，当您知道 IN 子句参数的限制时效果很好。如果没有限制，则可以批量执行查询。示例代码片段是；

    ```
     int i = 1;
        for(; i <=ids.length; i++){
            ps.setInt(i, ids[i-1]);
        }

        //set null for remaining ones
        for(; i<=PARAM_SIZE;i++){
            ps.setNull(i, java.sql.Types.INTEGER);
        } 
    ```

[您可以在此处](http://www.journaldev.com/2521/jdbc-preparedstatement-in-clause-alternative-approaches)查看有关这些替代方法的更多详细信息。

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2015-01-02T06:23:42.467

在某些情况下，正则表达式可能会有所帮助。这是我在 Oracle 上检查过的一个示例，它可以工作。

```
select * from my_table where REGEXP_LIKE (search_column, 'value1|value2') 
```

但是它有很多缺点：

1.  它应用的任何列都应该转换为 varchar/char，至少是隐式的。
2.  需要注意特殊字符。
3.  它可能会降低性能——在我的例子中，IN 版本使用索引和范围扫描，而 REGEXP 版本进行完整扫描。

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2015-03-15T14:56:44.103

在检查了不同论坛中的各种解决方案并没有找到好的解决方案之后，我觉得我想出的以下 hack 是最容易遵循和编码的：

示例：假设您有多个参数要传入“IN”子句。只需在“IN”子句中放置一个虚拟字符串，例如，“PARAM”确实表示将代替该虚拟字符串的参数列表。

```
 select * from TABLE_A where ATTR IN (PARAM); 
```

您可以将所有参数收集到 Java 代码中的单个字符串变量中。这可以按如下方式完成：

```
 String param1 = "X";
    String param2 = "Y";
    String param1 = param1.append(",").append(param2); 
```

在我们的例子中，您可以将用逗号分隔的所有参数附加到单个字符串变量“param1”中。

将所有参数收集到一个字符串中后，您只需将查询中的虚拟文本（即本例中的“PARAM”）替换为参数字符串，即 param1。这是您需要做的：

```
 String query = query.replaceFirst("PARAM",param1); where we have the value of query as 

    query = "select * from TABLE_A where ATTR IN (PARAM)"; 
```

您现在可以使用 executeQuery() 方法执行查询。只需确保您的查询中的任何地方都没有“PARAM”一词。您可以使用特殊字符和字母的组合来代替单词“PARAM”，以确保查询中不会出现这样的单词。希望你得到解决方案。

注意：虽然这不是一个准备好的查询，但它完成了我希望我的代码完成的工作。

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2015-04-01T18:12:37.637

只是为了完整性，因为我没有看到其他人建议它：

在实施上述任何复杂建议之前，请考虑 SQL 注入是否确实是您的场景中的问题。

在许多情况下，提供给 IN (...) 的值是一个 id 列表，这些 id 的生成方式可以确保不可能进行注入...（例如，先前 select some_id from some_table where 的结果一些条件。）

如果是这种情况，您可能只是连接此值而不使用服务或准备好的语句，或者将它们用于此查询的其他参数。

```
query="select f1,f2 from t1 where f3=? and f2 in (" + sListOfIds + ");"; 
```

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2017-06-07T21:05:11.477

PreparedStatement 没有提供任何处理 SQL IN 子句的好方法。根据[http://www.javaranch.com/journal/200510/Journal200510.jsp#a2](http://www.javaranch.com/journal/200510/Journal200510.jsp#a2) “您不能替换本来应该成为 SQL 语句一部分的东西。这是必要的，因为如果 SQL 本身可以更改，则驱动程序无法预编译语句。它还具有防止 SQL 注入攻击的良好副作用。” 我最终使用了以下方法：

```
String query = "SELECT my_column FROM my_table where search_column IN ($searchColumns)";
query = query.replace("$searchColumns", "'A', 'B', 'C'");
Statement stmt = connection.createStatement();
boolean hasResults = stmt.execute(query);
do {
    if (hasResults)
        return stmt.getResultSet();

    hasResults = stmt.getMoreResults();

} while (hasResults || stmt.getUpdateCount() != -1); 
```

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2021-08-19T19:16:51.500

好的，所以我不记得我之前是如何（或在哪里）这样做的，所以我来堆栈溢出以快速找到答案。我很惊讶我做不到。

所以，很久以前我解决IN问题的方法是这样的：

**其中 myColumn in ( select regexp_substr(:myList,'[^,]+', 1, level) from dual connect by regexp_substr(:myList, '[^,]+', 1, level) 不为空）**

将 myList 参数设置为逗号分隔的字符串：A,B,C,D...

注意：您必须设置两次参数！

* * *

## 回答 #30

> 赞同：-1
> 
> 时间：2020-01-15T07:19:13.463

这对我有用（伪代码）：

```
public class SqlHelper
{
    public static final ArrayList<String>platformList = new ArrayList<>(Arrays.asList("iOS","Android","Windows","Mac"));

    public static final String testQuery = "select * from devices where platform_nm in (:PLATFORM_NAME)";
} 
```

指定绑定：

```
public class Test extends NamedParameterJdbcDaoSupport
public List<SampleModelClass> runQuery()
{
    //define rowMapper to insert in object of SampleClass
    final Map<String,Object> map = new HashMap<>();
    map.put("PLATFORM_LIST",DeviceDataSyncQueryConstants.platformList);
    return getNamedParameterJdbcTemplate().query(SqlHelper.testQuery, map, rowMapper)
} 
```

* * *

## 回答 #31

> 赞同：-3
> 
> 时间：2017-02-01T19:28:25.117

我的解决方法（JavaScript）

```
 var s1 = " SELECT "

 + "FROM   table t "

 + "  where t.field in ";

  var s3 = '(';

  for(var i =0;i<searchTerms.length;i++)
  {
    if(i+1 == searchTerms.length)
    {
     s3  = s3+'?)';
    }
    else
    {
        s3  = s3+'?, ' ;
    }
   }
    var query = s1+s3;

    var pstmt = connection.prepareStatement(query);

     for(var i =0;i<searchTerms.length;i++)
    {
        pstmt.setString(i+1, searchTerms[i]);
    } 
```

`SearchTerms`是包含您的输入/键/字段等的数组

# mysql - 非地理环境中的路径

> ID：178482
> 
> 赞同：1
> 
> 时间：2008-10-07T13:42:11.800
> 
> 标签：mysql, algorithm

对于学校项目，我需要创建一种基于最终用户选择创建个性化查询的方法。
由于用户基本上可以从任何表格组合中选择任何字段，因此我需要找到一种方法来映射表格以便进行连接并且没有无关数据（这可能会导致报告不连贯，但我们愿意生活接着就，随即）。

对于最多两个表，我已经设法设计了一个运行良好的算法。但是，当我添加另一个表时，我找不到通过我的数据库的路径。可用于个性化报告的所有表格都可以链接在一起，因此这一切都归结为找到要使用的路径。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-10-07T13:52:37.647

您也许可以尝试某种形式的[A* 算法](http://en.wikipedia.org/wiki/A*_search_algorithm)。基本上，这会查看每个可能的下一个选项，并对其应用启发式算法，该函数大致确定该节点与您的目标之间的距离。然后它选择更接近的一个并重复。实现 A* 最困难的部分是设计一个好的启发式算法。

如果没有更多关于表格如何组合在一起的信息，或者您所说的表格中的“路径”是什么意思，那么很难推荐一些东西。

看起来它不喜欢我的链接，可能是其中的 *，尝试：

```
http://en.wikipedia.org/wiki/A*_search_algorithm
```

**编辑：** 如果这是整个数据库，我会使用[深度优先的详尽搜索](http://en.wikipedia.org/wiki/Depth-first_search)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-07T14:39:53.387

我考虑过使用 A* 或类似的算法，但正如你所说，最难的部分*是*设计启发式算法。

我的表以某种主干为中心，有很多分支，每个分支最多通向一个叶节点。[这是实际的地图](http://www.2shared.com/file/4053143/f955c523/dbMap.html)（因为我偏执，所以删除了表名）。假设我想查看 A、B 和 C 表中的数据，我需要一个算法来找到蓝色路径。

# c# - C# 运算符 => 是什么意思？

> ID：178516
> 
> 赞同：6
> 
> 时间：2008-10-07T13:47:31.993
> 
> 标签：c#, operators

最近一篇文章的答案（在 C# 中模仿 times() Ruby 方法的机会吗？）在用法示例中使用**=>运算符。**这个运营商是做什么的？我在我的 C# 书中找不到它，而且很难在网上搜索到这样的符号。（我找不到它。）

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-10-07T13:50:14.453

它并不是真正的运算符，它是 lambda 表达式语法的一部分。特别是 => 是将参数与 lambda 表达式的主体分开的位。

您的书是否涵盖 C# 3.0？如果不是，它将不包含 lambda 表达式。如果是这样，它真的应该覆盖它们！希望使用正确的术语，您将能够在 TOC 或索引中找到它。

编辑：更多信息：lambda 表达式是一种语法糖，用于创建委托的实例*或*表达式树（后者是 .NET 3.5 的新内容）。Lambda 表达式几乎完全取代了匿名方法（来自 C# 2.0），尽管它们不像匿名方法那样支持“我不关心参数”的概念。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-07T13:50:19.413

这将是一个 lambda 表达式：

[http://msdn.microsoft.com/en-us/library/bb397687.aspx](http://msdn.microsoft.com/en-us/library/bb397687.aspx)

这里有一个例子：

```
MyControl.OnMouseDown += (sender, e) =>
{
  // Do something in the mouse down event
}; 
```

在这里，我创建了一个 lambda 表达式事件委托。它基本上使我不必在课堂上为它创建一个单独的函数。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-07T13:51:44.077

lambda 表达式是一个匿名函数，可以包含表达式和语句，并可用于创建委托或表达式树类型。

所有 lambda 表达式都使用 lambda 运算符 =>，读作“goes to”。lambda 运算符的左侧指定输入参数（如果有），右侧保存表达式或语句块

[http://msdn.microsoft.com/en-us/library/bb397687.aspx](http://msdn.microsoft.com/en-us/library/bb397687.aspx)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-08T04:48:36.417

=> 标记称为**lambda 运算符**。

它在 lambda 表达式中用于将左侧的输入变量与右侧的 lambda 主体分开。

[MSDN](http://msdn.microsoft.com/en-us/library/bb311046.aspx)

# php - CodeIgniter 项目中的资产应该放在哪里？

> ID：178519
> 
> 赞同：18
> 
> 时间：2008-10-07T13:48:09.933
> 
> 标签：php, codeigniter

我刚开始使用CodeIgniter，我不确定css、js和图像之类的东西应该去哪里。在整个系统文件夹之外似乎还可以，但这意味着一切都是分开的。内部意味着文件路径更长，我担心它可能会搞砸。这个问题的最佳实践是什么？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-10-07T13:51:25.713

我通常将单独的文件夹放在根级别，所以我最终得到这样的目录结构：

```
/system
/css
/js
/img 
```

似乎对我有用-当您使用时`site_url(url)`，它生成的 URL 来自根目录，因此您可以使用它`site_url('css/file.css')`来生成样式表的 URL 等。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2012-08-04T00:52:34.627

就个人而言，我将`application`目录从目录中剥离出来，`system`并使其成为`system`. 然后我创建一个项目目录，在`public_html (www)`其中移动 index.php 并存储我的公共资产。

假设您正在处理的项目名为`projekt`. 在父目录中`public_html (www)`创建一个名为 的目录`CISYSTEM`，并在该目录中根据您正在使用的版本创建一个目录`202`，`210`等等。

```
/CISYSTEM
    /202
    /210
    /another_CI_version
/projekt_application
    /models
    /views
    /controllers
    /private_assets
/public_html
    /projekt
        index.php
        .htaccess
        css
        img
        js
        lib 
```

这种目录结构的美妙之处在于它增加了另一层安全性，并使升级/更换 CI 核心变得非常容易。另外，您不应该对核心进行更改 - 拥有一个存储核心的目录并让所有项目引用它可以保持干燥。

不过，所有这些目录改组都需要您重新路由一些东西。幸运的是，CodeIgniter 使它变得简单——所有的更改都可以在`index.php`文件中进行。

打开`index.php`并重新路由几件事：

改变：`$system_path = 'system';`

到：`$system_path = '../../CISYSTEM/210';`

改变：`$application_folder = 'application';`

到：`$application_folder = '../../projekt_application';`

* * *

`site_url()`另外，我看到很多人在其他答案中谈论使用。我推荐一种不那么冗长的使用方式……如果你使用 HTML 的元素`site_url()`，你不必每次都调用它：`<base>`

`<base href="<?= site_url();?>">`

只需将其包含在您的应用程序中`<head>`，您就可以直接调用您的控制器......如：

`<a href='controllername/functionname'>Some Action</a>`

干杯

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-07T18:44:54.297

我讨厌在根级别有这么多目录，所以我使用 /public 并使用 htaccess 将 /scripts 重写为 /public/scripts 等等。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-07T23:33:00.690

我发现最好将资产保持在根级别。您可以使用`<?=base_url()?>`来回显站点的完整根目录。在配置文件中，您设置了网站的根目录。这个声明只是呼应了这一点。

因此，您可以像这样使用包含：

```
<link href="<?=base_url()?>/css/style.css" rel="stylesheet" type="text/css" /> 
```

在你的代码中的任何地方，它仍然会得到[http://example.com/css/style.css](http://example.com/css/style.css)。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-09-07T10:05:02.993

base_url()/css/name.css

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-04-19T17:14:28.630

为了以这种方式使用 site_url(url) 帮助程序，您必须首先配置 Apache mod_rewrite（或等效项）以从 URI 中删除 index.php 段。

否则，site_url 方法会将 index.php 添加到 URL，如果您将它们放在上面的基本目录中，这可能会搞砸资产的路径。

这是关于从 URI 中删除 index.php 的 CodeIgniter 文档：

[http://codeigniter.com/wiki/mod_rewrite/](http://codeigniter.com/wiki/mod_rewrite/)

# .net - 大多数有用的 .NET 实用程序类开发人员倾向于重新发明而不是重用

> ID：178524
> 
> 赞同：56
> 
> 时间：2008-10-07T13:49:36.483
> 
> 标签：.net

我最近阅读了去年的这篇 Phil Haack 帖子（[The Most Useful .NET Utility Classes Developers Tend To Reinvent 而不是 Reuse](http://haacked.com/archive/2007/06/13/the-most-useful-.net-utility-classes-developers-tend-to-reinvent.aspx)），我想看看是否有人对列表有任何补充。

* * *

## 回答 #1

> 赞同：47
> 
> 时间：2008-10-07T14:26:45.813

人们倾向于使用以下丑陋且注定会失败的东西：

```
string path = basePath + "\\" + fileName; 
```

更好更安全的方法：

```
string path = Path.Combine(basePath, fileName); 
```

我还看到人们编写自定义方法来读取文件中的所有字节。这个非常方便：

```
byte[] fileData = File.ReadAllBytes(path); // use path from Path.Combine 
```

正如[TheXenocide](https://stackoverflow.com/users/8543/thexenocide)指出的那样，同样适用于`File.ReadAllText()`和`File.ReadAllLines()`

* * *

## 回答 #2

> 赞同：36
> 
> 时间：2008-10-07T13:54:22.620

`String.IsNullOrEmpty()`

* * *

## 回答 #3

> 赞同：35
> 
> 时间：2008-10-07T14:05:29.460

```
Path.GetFileNameWithoutExtension(string path) 
```

返回指定路径字符串的文件名，不带扩展名。

```
Path.GetTempFileName() 
```

在磁盘上创建一个唯一命名的零字节临时文件并返回该文件的完整路径。

* * *

## 回答 #4

> 赞同：28
> 
> 时间：2008-10-07T14:46:38.893

`System.Diagnostics.Stopwatch`班级。

* * *

## 回答 #5

> 赞同：23
> 
> 时间：2008-10-07T13:53:25.100

字符串格式。

我见过的次数

```
return "£" & iSomeValue 
```

而不是

```
return String.Format ("{0:c}", iSomeValue) 
```

或者人们附加百分号 - 类似的事情。

* * *

## 回答 #6

> 赞同：22
> 
> 时间：2008-10-07T13:53:06.787

枚举.Parse()

* * *

## 回答 #7

> 赞同：20
> 
> 时间：2008-10-07T14:42:41.930

试图找出我的文档在用户计算机上的位置。只需使用以下内容：

```
string directory =
Environment.GetFolderPath(Environment.SpecialFolder.MyDocuments); 
```

* * *

## 回答 #8

> 赞同：20
> 
> 时间：2008-10-07T13:55:28.513

String.Join() （但是，几乎每个人都知道 string.Split 并且似乎每有机会就使用它......）

* * *

## 回答 #9

> 赞同：20
> 
> 时间：2008-10-07T19:51:11.727

我最近需要在 Windows 应用程序中下载一些文件。我在 WebClient 对象上找到了 DownloadFile 方法：

```
 WebClient wc = new WebClient();
    wc.DownloadFile(sourceURLAddress, destFileName); 
```

* * *

## 回答 #10

> 赞同：14
> 
> 时间：2008-10-07T14:15:41.390

将 / 硬编码到目录操作字符串中，而不是使用：

```
IO.Path.DirectorySeparatorChar 
```

* * *

## 回答 #11

> 赞同：13
> 
> 时间：2008-10-07T14:32:55.897

**StringBuilder**类，尤其是Method **AppendFormat**。

PS：如果您正在寻找字符串操作性能测量： [StringBuilder vs. String / Fast String Operations with .NET 2.0](http://www.codeproject.com/KB/cs/StringBuilder_vs_String.aspx)

* * *

## 回答 #12

> 赞同：12
> 
> 时间：2008-10-07T16:19:52.950

```
Environment.NewLine 
```

* * *

## 回答 #13

> 赞同：12
> 
> 时间：2008-10-07T21:33:52.613

不要使用 Guid 生成文件名，只需使用：

```
Path.GetRandomFileName() 
```

* * *

## 回答 #14

> 赞同：10
> 
> 时间：2009-01-06T17:07:44.140

许多新的 Linq 功能似乎并不为人所知：

**`Any<T>() & All<T>()`**

```
if( myCollection.Any( x => x.IsSomething ) )
    //...

bool allValid = myCollection.All( 
    x => x.IsValid ); 
```

**`ToList<T>(), ToArray<T>(), ToDictionary<T>()`**

```
var newDict = myCollection.ToDictionary(
    x => x.Name,
    x => x.Value ); 
```

**`First<T>(), FirstOrDefault<T>()`**

```
return dbAccessor.GetFromTable( id ).
    FirstOrDefault(); 
```

**`Where<T>()`**

```
//instead of
foreach( Type item in myCollection )
    if( item.IsValid )
         //do stuff

//you can also do
foreach( var item in myCollection.Where( x => x.IsValid ) )
    //do stuff

//note only a simple sample - the logic could be a lot more complex 
```

您可以在 Linq 语法之外使用所有真正有用的小功能。

* * *

## 回答 #15

> 赞同：9
> 
> 时间：2008-10-08T05:06:49.877

*   使用[DebuggerDisplay](http://msdn.microsoft.com/en-us/library/x810d419.aspx)属性而不是 ToString() 来简化调试。
*   [可枚举.Range](http://msdn.microsoft.com/en-us/library/system.linq.enumerable.range.aspx)
*   [来自FSharp.Core](http://rabdullin.com/using-tuples-in-c/)的元组！

* * *

## 回答 #16

> 赞同：8
> 
> 时间：2008-10-07T14:42:25.690

请参阅[隐藏的 .NET 基类库类](https://stackoverflow.com/questions/122784/hidden-net-base-class-library-classes)

* * *

## 回答 #17

> 赞同：8
> 
> 时间：2010-06-17T22:52:57.770

For all it's hidden away under the Microsoft.VisualBasic namespace, [TextFieldParser](http://msdn.microsoft.com/en-us/library/microsoft.visualbasic.fileio.textfieldparser.aspx) is actually a very nice csv parser. I see a lot of people either roll their own (badly) or use something like the nice [Fast CSV](http://www.codeproject.com/KB/database/CsvReader.aspx) library on Code Plex, not even knowing this is already baked into the framework.

* * *

## 回答 #18

> 赞同：8
> 
> 时间：2008-10-07T13:55:35.003

System.Text.RegularExpressions.Regex

* * *

## 回答 #19

> 赞同：8
> 
> 时间：2008-10-07T14:00:15.040

`input.StartsWith("stuff")`代替`Regex.IsMatch(input, @"^stuff")`

* * *

## 回答 #20

> 赞同：6
> 
> 时间：2008-10-07T14:18:47.203

文件的东西。

```
using System.IO;

File.Exists(FileNamePath)

Directory.Exists(strDirPath)

File.Move(currentLocation, newLocation);

File.Delete(fileToDelete);

Directory.CreateDirectory(directory)

System.IO.FileStream file = System.IO.File.Create(fullFilePath); 
```

* * *

## 回答 #21

> 赞同：6
> 
> 时间：2008-10-07T14:25:37.783

`System.IO.File.ReadAllText`vs 使用 StreamReader 为小文件编写逻辑。

`System.IO.File.WriteAllText`vs 使用 StreamWriter 为小文件编写逻辑。

* * *

## 回答 #22

> 赞同：4
> 
> 时间：2008-10-07T13:57:12.550

许多人似乎喜欢手动单步执行 XML 文件来查找内容，而不是使用 XPathNaviagator。

* * *

## 回答 #23

> 赞同：4
> 
> 时间：2008-10-07T16:00:00.963

大多数人忘记，如果文件夹已经存在，Directory.CreateDirectory() 会优雅地降级，并用毫无意义的 if (!Directory.Exists(....)) 调用包装它。

* * *

## 回答 #24

> 赞同：1
> 
> 时间：2009-01-06T16:19:36.500

myString.Equals(另一个字符串)

和选项，包括特定文化的选项。

我敢打赌，至少有 50% 的开发人员会写出类似这样的东西： if (s == "id") {...}

* * *

## 回答 #25

> 赞同：-5
> 
> 时间：2008-10-07T14:30:14.513

Path.Append 在我见过的东西中总是被遗忘。

# php - PHP/PDO 和 SQL Server 连接和 i18n 问题

> ID：178530
> 
> 赞同：5
> 
> 时间：2008-10-07T13:50:32.813
> 
> 标签：php, sql-server, sql-server-2005

在我们的网络应用程序中，我们使用 PHP5.2.6 + PDO 连接到 SQL Server 2005 数据库并存储俄语文本。

数据库排序规则是`Cyrillic_General_CI_AS`，表排序规则是`Cyrillic_General_CI_AS`，列类型是`NVARCHAR(MAX)`。

我们尝试使用以下两种方案连接到数据库，这两种方案都会导致不同的问题。

1.  *PDO mssql：*

    ```
    $dbh = new PDO ('mssql:host='.$mssql_server.';dbname='.$mssql_db, $mssql_login, $mssql_pwd); 
    ```

    在这种情况下，像这样的简单查询的结果：

    ```
    SELECT field1 FROM tbl1 WHERE id=1 
    ```

    显示`field1`截断为 255 字节的数据。

2.  *PDO 数据库：*

    ```
    $dbh = new PDO ('odbc:DSN=myDSN;UID='.$mssql_login.';PWD='.$mssql_pwd); 
    ```

    在这种情况下，同一查询的结果显示完整的未截断数据，但带有问号而不是俄语符号。

* * *

笔记：

*   在 SQL Management Studio 中，数据不会被截断，俄语符号也能正确显示。
*   我们有 Windows 2003 Enterprise Edition SP2

那么我们应该选择什么样的连接方式以及如何解决相应的问题呢？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-13T12:25:52.080

连接后尝试执行`SET NAMES "charset"`。

我不知道要匹配的字符集`Cyrillic_General_CI_AS`是什么，但试试“西里尔文”？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-02-26T20:31:12.207

我必须这样做才能从 MSSQL 中的 NVARCHAR 字段中获取可用数据：

```
$_ = iconv('Windows-1252', 'UTF-8', $_); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-07T13:59:11.220

我一直很幸运地全面使用 utf8_general_ci - 用于连接、排序规则 - 一切。

但是，我只有使用 MySQL 和 PostgreSql 的经验——没有使用 SQL Server。

至于您的 DSN 问题 - 我不确定。

祝你好运！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-14T17:35:04.747

如果您未设置 PDO，请使用[FreeTDS](http://php.net/manual/en/book.mssql.php) - 又称程序 mssql_* 调用。在 PDO*修复*之前，这是推荐的解决方法之一。从 PHP 5.1.2 开始，FreeTDS 有一个[mssql.charset-option](http://php.net/manual/en/mssql.configuration.php)。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-22T16:16:04.123

在使用 PDO 实现 SQL Server 2005 和 PHP 5.x 时，我也注意到了同样的问题。当我将 nvarchar(MAX) 字段更改为 nvarchar(255) 时，奇怪的问号字符停止出现。我绝对相信它与 PDO 和 MS SQL 服务器中的 ODBC 驱动程序有关。当您在 varchar 中隐式指定最大字符时，它可以解决问题。

# visual-studio-2008 - 如何增加 VC9 (MSVC 2008) 中允许的修饰名称长度？

> ID：178532
> 
> 赞同：1
> 
> 时间：2008-10-07T13:51:12.733
> 
> 标签：visual-studio-2008, visual-c++, visual-c++-2008, name-decoration

我有一组相当庞大和复杂的程序可以从 VC8 移植到 VC9。其中一个模块有许多分层的 typedef，这会导致编译器生成 C4503 警告（装饰名称被截断）。生成的 LIB 文件将无法正确链接到项目中的其他模块。VC8 对此没有任何问题，这使我得出结论，要么修饰过程已更改为生成更长的名称，要么已减少修饰名称长度的内部限制。克服这个问题的最好方法是什么？

由于遗留代码的原因，MSDN 建议用结构替换 typedefs 是不切实际的。

有问题的 typedef 是（经过清理的代码）：

```
enum Type{
    TYPE_COUNT,
    TYPE_VALUE
};

typedef MyVector< Container*, CriticalSectionLock > Containers;
typedef MyVector< MyClassType*, CriticalSectionLock >::const_iterator const_iterator_type;
typedef MyVector< stl::pair< string, Type > >::const_iterator const_iterator_def;
typedef MyVector< Container** >::const_iterator const_iterator_container;
typedef MyVector< stl::pair < MyBase*, MyVector< stl::pair< Container**, Containers* > > > >::const_iterator const_iterator; 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-20T16:02:00.097

由于似乎没有办法增加编译器对修饰名称长度的内部限制，所以我硬着头皮做了 MSDN 中建议的更改。见：http: [//msdn.microsoft.com/en-us/library/074af4b6.aspx](http://msdn.microsoft.com/en-us/library/074af4b6.aspx)

我只需要将第一个 typedef 更改为结构。这需要对遗留代码进行大约 200 次其他更改，这很乏味，但在其他方面并不困难。但是，我将在接下来的一周左右进行回归测试，以确保这不会搞砸。

这是基本的变化：（请注意，我被迫向结构添加了一些 ctor）

```
enum Type{
    TYPE_COUNT,
    TYPE_VALUE
 };

 struct Containers 
 {
    MyVector<Container*, CriticalSectionLock > Element;
    Containers(int num, Container* elem):Element(num, elem){}
    Containers(){}
 };
 typedef MyVector< MyClassType*, CriticalSectionLock >::const_iterator  const_iterator_type;
 typedef MyVector< stl::pair< string, Type > >::const_iterator const_iterator_def;
 typedef MyVector< Container** >::const_iterator const_iterator_container;
 typedef MyVector< stl::pair < MyBase*, MyVector< stl::pair< Container**, Containers* > > > >::const_iterator const_iterator; 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-21T21:00:26.157

@Roel：正如我在原始帖子中提到的：“生成的 LIB 文件将无法正确链接到项目中的其他模块。”

IOW，这不仅仅是一个“警告”。它导致项目不工作。

我发布的修复程序完全实施起来有些困难和乏味，但它确实有效。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-19T14:56:42.803

```
#pragma warning(disable:xxx). 
```

人的生命太短暂了。

# delphi - 为什么我的 Delphi 7 调试器随机决定停止接受某些键盘输入

> ID：178537
> 
> 赞同：1
> 
> 时间：2008-10-07T13:52:00.847
> 
> 标签：delphi, keyboard, madexcept

也许这是一个总体问题，因为我在 Firefox 中看到了类似的错误，我想知道如何避免对它们进行编码。

没有明显的原因，功能键、箭头键（以及解锁的数字键盘）、箭头上方的 6 个键和退格键停止工作。其他所有键似乎都有效，让我认为这是某种中断问题。当我重新启动 Delphi 时它再次工作。

这是在 IBM M 型键盘上，所以肯定不会是硬件问题，尽管如果有人知道得更好，我不会那么天真，我已经注意到不同键盘的这一点。

我实际上对 Delphi 的修复并不感兴趣，我只是想知道如何避免键盘输入错误。我肯定在调试充满错误的代码。我只是想知道为什么它会导致部分键盘出现故障。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-07T13:55:28.390

我怀疑这是德尔福的错。我正在使用 Delphi 7，从来没有遇到过这个问题。我建议你寻找另一个罪魁祸首。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-07T14:29:42.110

如果在调试器中发生这种情况，则可能是按键消息处理未能完成。尝试按下所有 Alt、shift、control 和所有其他此类键，以查看问题是否解决。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-08T07:32:03.717

还是全局键盘挂钩有问题？尝试禁用尽可能多的具有全局热键的实用程序。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-14T20:40:13.393

哈！我终于弄清楚了它在做什么，我已经安装了 MadExcept，当我使用 Ctrl-Shift-C 自动生成类函数时，我得到了一个 delphi 异常。我会得到一个错误，这是一个秘密的 MadExcept 错误。如果我单击“确定”，它将阻止我输入一些“元”键盘输入。如果我在该存根类上再次按 Ctrl-Shift-C 并弹出错误。我可以点击详细信息，然后它会告诉我有关错误的常规 MadExcept 信息。我可以点击详细信息并继续编程，我的 IDE 又好了！

# perl - 你如何在 Perl 中对浮点数进行四舍五入？

> ID：178539
> 
> 赞同：186
> 
> 时间：2008-10-07T13:52:27.710
> 
> 标签：perl, floating-point, rounding

如何将十进制数（浮点数）四舍五入到最接近的整数？

例如

```
1.2 = 1
1.7 = 2 
```

* * *

## 回答 #1

> 赞同：206
> 
> 时间：2008-10-07T13:54:12.120

的输出[`perldoc -q round`](http://perldoc.perl.org/perlfaq4.html#Does-Perl-have-a-round%28)-function%3f--What-about-ceil()-and-floor()%3f--Trig-functions%3f)

> Perl 有 round() 函数吗？ceil() 和 floor() 呢？三角函数？
> 
> 请记住，[`int()`](http://perldoc.perl.org/functions/int.html)仅向 截断`0`。用于四舍五入到一定位数，[`sprintf()`](http://perldoc.perl.org/functions/sprintf.html)或者[`printf()`](http://perldoc.perl.org/functions/printf.html)通常是最简单的方法。
> 
> ```
>  printf("%.3f", 3.1415926535);       # prints 3.142 
> ```
> 
> 该[`POSIX`](http://perldoc.perl.org/POSIX.html)模块（标准 Perl 发行版的一部分）实现 `ceil()`、`floor()`和许多其他数学和三角函数。
> 
> ```
>  use POSIX;
>     $ceil   = ceil(3.5);                        # 4
>     $floor  = floor(3.5);                       # 3 
> ```
> 
> 在 5.000 到 5.003 perls 中，在[`Math::Complex`](http://perldoc.perl.org/Math/Complex.html) 模块中完成了三角函数。在 5.004 中，该[`Math::Trig`](http://perldoc.perl.org/Math/Trig.html)模块（标准 Perl 发行版的一部分）实现了三角函数。在内部它使用[`Math::Complex`](http://perldoc.perl.org/Math/Complex.html)模块并且一些函数可以从实轴突破到复平面，例如2的反正弦。
> 
> 金融应用程序中的四舍五入可能会产生严重影响，并且应精确指定所使用的四舍五入方法。在这些情况下，不信任 Perl 使用的任何系统舍入可能是值得的，而是自己实现所需的舍入功能。
> 
> 要了解原因，请注意在中途交替时您仍然会遇到问题：
> 
> ```
>  for ($i = 0; $i < 1.01; $i += 0.05) { printf "%.1f ",$i}
> 
>     0.0 0.1 0.1 0.2 0.2 0.2 0.3 0.3 0.4 0.4 0.5 0.5 0.6 0.7 0.7
>     0.8 0.8 0.9 0.9 1.0 1.0 
> ```
> 
> 不要责怪 Perl。这与 C 中的相同。IEEE 说我们必须这样做。绝对值是整数的 Perl 数字`2**31`（在 32 位机器上）将非常像数学整数一样工作。不保证其他数字。

* * *

## 回答 #2

> 赞同：148
> 
> 时间：2009-08-13T21:26:05.420

虽然不同意关于中途标记等的复杂答案，但对于更常见（并且可能微不足道）的用例：

`my $rounded = int($float + 0.5);`

**更新**

如果您的结果可能为`$float`负，则以下变体将产生正确的结果：

`my $rounded = int($float + $float/abs($float*2 || 1));`

通过这个计算，-1.4 舍入为 -1，-1.6 舍入为 -2，零不会爆炸。

* * *

## 回答 #3

> 赞同：78
> 
> 时间：2008-10-07T13:54:09.920

您可以使用[Math::Round 之](http://search.cpan.org/dist/Math-Round)类的模块：

```
use Math::Round;
my $rounded = round( $float ); 
```

或者你可以用粗略的方式来做：

```
my $rounded = sprintf "%.0f", $float; 
```

* * *

## 回答 #4

> 赞同：47
> 
> 时间：2008-10-07T15:37:02.927

如果您决定使用 printf 或 sprintf，请注意他们使用[Round half to even](http://en.wikipedia.org/wiki/Rounding#Round_half_to_even)方法。

```
foreach my $i ( 0.5, 1.5, 2.5, 3.5 ) {
    printf "$i -> %.0f\n", $i;
}
__END__
0.5 -> 0
1.5 -> 2
2.5 -> 2
3.5 -> 4 
```

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2008-10-07T13:58:29.757

请参阅[perldoc/perlfaq](http://perldoc.perl.org/perlfaq4.html)：

> 请记住，它`int()`只是向 0 截断。用于四舍五入到一定数量的数字，`sprintf()`或者`printf()`通常是最简单的方法。
> 
> ```
>  printf("%.3f",3.1415926535);
>  # prints 3.142 
> ```
> 
> 该`POSIX`模块（标准 Perl 发行版的一部分）实现`ceil()`、`floor()`和许多其他数学和三角函数。
> 
> ```
> use POSIX;
> $ceil  = ceil(3.5); # 4
> $floor = floor(3.5); # 3 
> ```
> 
> 在 5.000 到 5.003 perls 中，在`Math::Complex`模块中完成了三角函数。
> 
> 在 5.004 中，`Math::Trig`模块（标准 Perl 发行版的一部分）> 实现了三角函数。
> 
> 在内部它使用`Math::Complex`模块并且一些函数可以从实轴突破到复平面，例如2的反正弦。
> 
> 金融应用程序中的四舍五入可能会产生严重影响，并且应精确指定所使用的四舍五入方法。在这些情况下，不信任 Perl 使用的任何系统舍入可能是值得的，而是自己实现所需的舍入功能。
> 
> 要了解原因，请注意在中途交替时您仍然会遇到问题：
> 
> ```
> for ($i = 0; $i < 1.01; $i += 0.05)
> {
>    printf "%.1f ",$i
> }
> 
> 0.0 0.1 0.1 0.2 0.2 0.2 0.3 0.3 0.4 0.4 0.5 0.5 0.6 0.7 0.7 0.8 0.8 0.9 0.9 1.0 1.0 
> ```
> 
> 不要责怪 Perl。这与 C 中的相同。IEEE 说我们必须这样做。Perl 数字的绝对值是小于 2**31 的整数（在 32 位机器上），其工作方式与数学整数非常相似。不保证其他数字。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2011-06-13T20:51:58.523

您不需要任何外部模块。

```
$x[0] = 1.2;
$x[1] = 1.7;

foreach (@x){
  print $_.' = '.( ( ($_-int($_))<0.5) ? int($_) : int($_)+1 );
  print "\n";
} 
```

我可能错过了你的观点，但我认为这是做同样工作的更清洁的方式。

这样做是遍历元素中的每个正数，以您提到的格式打印数字和四舍五入的整数。该代码仅基于小数连接各自的舍入正整数。int($_) 基本上将数字*四舍五入，*因此 ($ *-int($* )) 捕获小数。如果小数（根据定义）严格小于 0.5，则向下取整。如果不是，则通过加 1 进行舍入。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2014-09-12T14:13:38.203

以下会将正数或负数四舍五入到给定的小数位：

```
sub round ()
{
    my ($x, $pow10) = @_;
    my $a = 10 ** $pow10;

    return (int($x / $a + (($x < 0) ? -0.5 : 0.5)) * $a);
} 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2010-12-21T21:06:50.170

以下是对值求和的五种不同方法的示例。第一种是执行求和（并且失败）的幼稚方式。第二次尝试使用`sprintf()`，但也失败了。第三次使用`sprintf()`成功，而最后两次（第 4 次和第 5 次）使用`floor($value + 0.5)`.

```
 use strict;
 use warnings;
 use POSIX;

 my @values = (26.67,62.51,62.51,62.51,68.82,79.39,79.39);
 my $total1 = 0.00;
 my $total2 = 0;
 my $total3 = 0;
 my $total4 = 0.00;
 my $total5 = 0;
 my $value1;
 my $value2;
 my $value3;
 my $value4;
 my $value5;

 foreach $value1 (@values)
 {
      $value2 = $value1;
      $value3 = $value1;
      $value4 = $value1;
      $value5 = $value1;

      $total1 += $value1;

      $total2 += sprintf('%d', $value2 * 100);

      $value3 = sprintf('%1.2f', $value3);
      $value3 =~ s/\.//;
      $total3 += $value3;

      $total4 += $value4;

      $total5 += floor(($value5 * 100.0) + 0.5);
 }

 $total1 *= 100;
 $total4 = floor(($total4 * 100.0) + 0.5);

 print '$total1: '.sprintf('%011d', $total1)."\n";
 print '$total2: '.sprintf('%011d', $total2)."\n";
 print '$total3: '.sprintf('%011d', $total3)."\n";
 print '$total4: '.sprintf('%011d', $total4)."\n";
 print '$total5: '.sprintf('%011d', $total5)."\n";

 exit(0);

 #$total1: 00000044179
 #$total2: 00000044179
 #$total3: 00000044180
 #$total4: 00000044180
 #$total5: 00000044180 
```

请注意，`floor($value + 0.5)`可以替换为`int($value + 0.5)`以删除对`POSIX`.

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2011-08-22T22:38:37.807

负数会增加一些人们需要注意的怪癖。

`printf`-style 方法为我们提供了正确的数字，但它们可能会导致一些奇怪的显示。我们发现这种方法（在我看来是愚蠢的）`-`表明它是否应该或不应该。例如，四舍五入到小数点后一位的 -0.01 会返回 -0.0，而不仅仅是 0。如果您要使用`printf`样式方法，并且您知道不需要小数，请使用`%d`和不使用`%f`（当您需要小数时，就在显示变得不稳定）。

虽然它是正确的并且对于数学来说没什么大不了的，但对于显示来说，它看起来很奇怪，显示像“-0.0”这样的东西。

对于 int 方法，负数可以改变你想要的结果（尽管有一些参数可以使它们是正确的）。

`int + 0.5`除非您希望它以这种方式工作，否则会导致负数的真正问题，但我想大多数人都不会。-0.9 应该四舍五入到 -1，而不是 0。如果您知道要让负数成为天花板而不是地板，那么您可以在单线中做到这一点，否则，您可能需要使用带有小数的 int 方法修改（这显然只能取回整数：

```
my $var = -9.1;
my $tmpRounded = int( abs($var) + 0.5));
my $finalRounded = $var >= 0 ? 0 + $tmpRounded : 0 - $tmpRounded; 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2011-11-09T11:35:35.910

我的 sprintf 解决方案

```
if ($value =~ m/\d\..*5$/){
    $format =~ /.*(\d)f$/;
    if (defined $1){
       my $coef = "0." . "0" x $1 . "05";    
            $value = $value + $coef;    
    }
}

$value = sprintf( "$format", $value ); 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2016-09-23T19:47:44.850

如果您只关心从整个浮点数（即 12347.9999 或 54321.0001）中获取整数值，那么这种方法（从上面借用和修改）可以解决问题：

```
my $rounded = floor($float + 0.1); 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2021-05-12T04:05:41.767

使用[`Math::BigFloat`](https://perldoc.perl.org/Math::BigFloat)您可以执行以下操作：

```
use Math::BigFloat;

print Math::BigFloat->new(1.2)->bfround(1); ## 1
print Math::BigFloat->new(1.7)->bfround(1); ## 2 
```

这可以包装在一个子例程中

```
use Math::BigFloat;

sub round {
  Math::BigFloat->new(shift)->bfround(1);
}

print round(1.2); ## 1
print round(1.7); ## 2 
```

* * *

## 回答 #13

> 赞同：-1
> 
> 时间：2019-12-07T10:55:26.987

大量阅读有关如何舍入数字的文档，许多专家建议编写自己的舍入例程，因为您的语言提供的“罐装”版本可能不够精确，或者包含错误。然而，我想他们说的是许多小数位，而不仅仅是一位、两位或三位。考虑到这一点，这是我的解决方案（尽管并不完全符合我的要求，因为我需要显示美元——不过，这个过程并没有太大的不同）。

```
sub asDollars($) {
  my ($cost) = @_;
  my $rv = 0;

  my $negative = 0;
  if ($cost =~ /^-/) {
    $negative = 1;
    $cost =~ s/^-//;
  }

  my @cost = split(/\./, $cost);

  # let's get the first 3 digits of $cost[1]
  my ($digit1, $digit2, $digit3) = split("", $cost[1]);
  # now, is $digit3 >= 5?
  # if yes, plus one to $digit2.
  # is $digit2 > 9 now?
  # if yes, $digit2 = 0, $digit1++
  # is $digit1 > 9 now??
  # if yes, $digit1 = 0, $cost[0]++
  if ($digit3 >= 5) {
    $digit3 = 0;
    $digit2++;
    if ($digit2 > 9) {
      $digit2 = 0;
      $digit1++;
      if ($digit1 > 9) {
        $digit1 = 0;
        $cost[0]++;
      }
    }
  }
  $cost[1] = $digit1 . $digit2;
  if ($digit1 ne "0" and $cost[1] < 10) { $cost[1] .= "0"; }

  # and pretty up the left of decimal
  if ($cost[0] > 999) { $cost[0] = commafied($cost[0]); }

  $rv = join(".", @cost);

  if ($negative) { $rv = "-" . $rv; }

  return $rv;
}

sub commafied($) {
  #*
  # to insert commas before every 3rd number (from the right)
  # positive or negative numbers
  #*
  my ($num) = @_; # the number to insert commas into!

  my $negative = 0;
  if ($num =~ /^-/) {
    $negative = 1;
    $num =~ s/^-//;
  }
  $num =~ s/^(0)*//; # strip LEADING zeros from given number!
  $num =~ s/0/-/g; # convert zeros to dashes because ... computers!

  if ($num) {
    my @digits = reverse split("", $num);
    $num = "";

    for (my $i = 0; $i < @digits; $i += 3) {
      $num .= $digits[$i];
      if ($digits[$i+1]) { $num .= $digits[$i+1]; }
      if ($digits[$i+2]) { $num .= $digits[$i+2]; }
      if ($i < (@digits - 3)) { $num .= ","; }
      if ($i >= @digits) { last; }
    }

    #$num =~ s/,$//;
    $num = join("", reverse split("", $num));
    $num =~ s/-/0/g;
  }

  if ($negative) { $num = "-" . $num; }

  return $num; # a number with commas added
  #usage: my $prettyNum = commafied(1234567890);
} 
```

* * *

## 回答 #14

> 赞同：-2
> 
> 时间：2009-08-13T14:25:56.847

```
cat table |
  perl -ne '/\d+\s+(\d+)\s+(\S+)/ && print "".**int**(log($1)/log(2))."\t$2\n";' 
```

# java - 是否可以在另一个中包含/嵌入一个 Java EE 应用程序（war 文件）？

> ID：178554
> 
> 赞同：3
> 
> 时间：2008-10-07T13:54:43.133
> 
> 标签：java, jakarta-ee, war

我有一个应用程序，它是一个门户应用程序，我想允许其他用户将他们的应用程序添加到它。为了做到这一点，我需要一些方法来访问他们在我的应用程序。这可能吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-07T14:01:43.197

您不能将 WAR 放在其他 WAR 中。您需要一个 EAR 文件来包含 WAR、EJB 等。实现 WAR 间通信的一种方法是将该逻辑直接打包到 EAR 中。这一切都取决于你想要做什么。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-07T14:47:50.560

进行 .WAR 间通信的方法是通过 [http://java.sun.com/j2ee/1.4/docs/api/javax/servlet/ServletContext.html#getContext(java.lang.String)方法](http://java.sun.com/j2ee/1.4/docs/api/javax/servlet/ServletContext.html#getContext(java.lang.String))

ServletContext.getContext(URIOfOtherWAR_resource)

我已经成功地用它来做你所说的事情。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-07T14:14:51.423

也许您需要一个插件系统或 portlet，因此您的用户不会开发一个 war 应用程序，而是将他们的 portlet 包含在您的应用程序中（war）。有一个标准：JSR 168 和几个实现：http: [//developers.sun.com/portalserver/reference/techart/jsr168/](http://developers.sun.com/portalserver/reference/techart/jsr168/)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-07T14:34:52.960

正如其他人所指出的，在 WAR 中嵌入 WAR 不是一种选择。但是，我可能会为您提供解决方法。

我熟悉的大多数 Web 容器都具有“测试部署/自动部署”模式/功能，如果将 WAR 复制到正确的目录中，它们将自动部署应用程序。

您的门户应用程序当然可以允许上传 WAR，并且它可以将上传的字节存储在给定文件名下的给定目录中。您的 Web 容器可以完成其余的工作。然后，您可以从您的门户或其他任何地方链接到新应用程序。这一切都相对容易做到。

但是，请注意，如果存在任何安全问题，这是一个可怕的想法。您实际上是在允许您的用户在您的服务器上执行任意代码。除非您完全相信所有潜在用户都是无恶意且完全胜任的（想想无限循环），否则您在这里会遇到很多麻烦。

# c# - 如何将带有枚举的 VB.net 接口转换为 C#

> ID：178561
> 
> 赞同：7
> 
> 时间：2008-10-07T13:55:51.447
> 
> 标签：c#, vb.net, interface, enums

我有以下需要移植到 C# 的 VB.net 接口。C# 不允许在接口中进行枚举。如何在不更改使用此接口的代码的情况下移植它？

```
Public Interface MyInterface

    Enum MyEnum
        Yes = 0
        No = 1
        Maybe = 2
    End Enum

    ReadOnly Property Number() As MyEnum

End Interface 
```

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-10-07T13:57:52.957

```
public enum MyEnum
{
    Yes = 0,
    No = 1,
    Maybe = 2
}

public interface IMyInterface
{
    MyEnum Number { get; }
} 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-10-07T14:24:53.477

简而言之，您不能在不破坏代码的情况下更改该接口，因为 C# 不能在接口中嵌套类型。当您实现 VB.NET 版本的接口时，您指定 Number 将返回 MyInterface.MyEnum 类型：

```
class TestClass3 : TestInterfaces.MyInterface
{

    TestInterfaces.MyInterface.MyEnum TestInterfaces.MyInterface.Number
    {
        get { throw new Exception("The method or operation is not implemented."); }
    }

} 
```

但是，由于 C# 不能在接口内嵌套类型，如果您将枚举数从接口中分离出来，您将返回一个不同的数据类型：在本例中为 MyEnum。

```
class TestClass2 : IMyInterface
{

    MyEnum IMyInterface.Number
    {
        get { throw new Exception("The method or operation is not implemented."); }
    }

} 
```

考虑使用完全限定的类型名称。在 VB.NET 接口中，您有一个返回类型

MyProject.MyInterface.MyEnum

在 C# 界面中，您有：

我的项目.MyEnum。

不幸的是，必须更改实现 VB.NET 接口的代码以支持 MyInterface.Number 返回的类型已更改的事实。

IL 支持在接口内嵌套类型，所以 C# 不支持的原因是个谜：

```
.class public interface abstract auto ansi MyInterface 
```

{ .property instance valuetype TestInterfaces.MyInterface/MyEnum Number { .get instance valuetype TestInterfaces.MyInterface/MyEnum TestInterfaces.MyInterface::get_Number() }

```
.class auto ansi sealed nested public MyEnum
    extends [mscorlib]System.Enum 
```

{ .field 公共静态文字值类型 TestInterfaces.MyInterface/MyEnum Maybe = int32(2)

```
 .field public static literal valuetype TestInterfaces.MyInterface/MyEnum No = int32(1)

    .field public specialname rtspecialname int32 value__

    .field public static literal valuetype TestInterfaces.MyInterface/MyEnum Yes = int32(0)

} 
```

}

如果您在使用此接口的其他程序集中有大量代码，最好将其保存在单独的 VB.NET 程序集中，并从您的 C# 项目中引用它。否则，转换它是安全的，但您必须更改任何使用它的代码以返回不同的类型。

# java - 如何确定 web.xml 中侦听器的顺序

> ID：178562
> 
> 赞同：25
> 
> 时间：2008-10-07T13:55:58.670
> 
> 标签：java, servlets, jakarta-ee

我的 Java webapp 中有一堆 servlet 上下文侦听器，每个侦听器都收集有关环境的一些信息。

其中一些依赖于另一个听众收集的信息。但是我无法确定监听器注册和调用的顺序，所以我不得不复制代码。

我知道听众是按照他们在 web.xml 中的顺序注册的，但这对我来说听起来有点模糊，太模糊以至于无法依赖它。

你有提示我如何解决我的问题吗？

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2008-10-07T14:58:13.833

所有 servlet 容器和 Java EE 容器都严格执行规范的这一部分。您可以依赖于侦听器按照您在 web.xml 中指定的顺序调用的事实。

您可以拥有一个应用程序级别的数据结构（HashMap），每个过滤器/侦听器在遇到来自请求的数据时都会对其进行更新。这将让每个 Listener 只更新必要的内容。您可以将公共代码放在基础侦听器中，这样就不会出现代码重复。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-10-07T14:06:19.570

为什么这么模糊？web.xml 中的顺序非常明确地表示它们被调用的顺序，Java EE 规范中非常清楚地说明了这一点。完全可以依赖它。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-07T14:05:00.117

看起来您可以创建一个 ListenerManager，将其放置为您唯一的侦听器，并让它包含其他侦听器。当事件到来时，只需按照您需要的顺序（可能是您在 ListenerManager 的构造函数中创建它们的顺序）调用其他每个 Listener。

不幸的是，这意味着添加侦听器时会更改代码，但是您可以通过巧妙地使用属性文件和 create-from-class-name 代码来避免这种情况。

# user-interface - 客户编号、订单编号的最佳格式是什么？

> ID：178572
> 
> 赞同：52
> 
> 时间：2008-10-07T13:57:49.960
> 
> 标签：user-interface

一家大型国际公司部署了一个新的网络和 MOTO（邮购和电话订购）处理系统。除其他事项外，您的任务是设计订单和客户识别号的格式。

你认为最好的格式是什么？请列出任何假设和考虑。

* * *

**接受的答案**

迈克尔·哈伦的答案是由于投票最多而被选中，但请务必阅读其他答案和评论，因为它们使迈克尔的答案更加完整。

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2008-10-07T14:00:36.913

使用所有数字或所有字母。如果您必须将其混淆，请确保没有不明确的字符（Il1m、O0 等）。

显示/打印时，每 3-4 个字符放置一个空格，但确保您的系统可以处理没有空格的输入。

编辑：要考虑的另一件事是建立区分订单、客户等的内置方式。例如，客户总是从 10 开始，订单总是从 20 开始，供应商总是从 30 开始，等等。

* * *

## 回答 #2

> 赞同：31
> 
> 时间：2009-03-20T18:46:31.220

**不要将****任何**可变的客户/订单信息编码到数字中！你必须假设**一切都是可变的！**

上述一些建议包括区域代码。公司可以搬家。您自己的公司可能会重组和更改自己的区域定义。客户/公司名称也可以更改。

**客户/订单信息属于客户/订单记录。不在身份证里。** 您可以稍后修改客户/订单记录。ID 通常是用石头写的。

即使只是将生成数字的日期编码到 ID 中似乎也是安全的，但前提是生成数字的系统上的日期永远不会出错。同样，这属于记录。否则永远无法纠正。

是否会有多个系统生成这些数字？如果是这样，如果您仅使用基于日期和/或顺序的数字，则可能会出现重复。

在对公司了解不多的情况下，**我会开始走这条路：**

*   标识号码类型的单字符代码。 **C**代表客户，**R**代表订单（不要使用“O”，因为它可能与零混淆）等。
*   生成号码的系统的标识符。这个标识符的长度取决于这些系统中有多少。
*   序列号，对生成它的系统来说是唯一的。只是一个柜台。
*   一个随机数，以防止可猜测的订单/客户编号。只要你的妄想症需要，就做这个。
*   一个简单的校验和。不是为了安全，而是为了检查错误。

正如其他人所指出的那样，将其分成几段使其更具人类可读性。

**CX5-0000758-82314-12**是这种方法生成的可能数字。这包括：

*   C：是客户编号。
*   X5：产生号码的电台。
*   0000758：这是 X5 生成的第 758 个数字。我们可以在停用此站 ID 或站本身之前生成 1000 万。或者不要用零填充并且没有限制。
*   82314：这是随机生成的，有 1/100,000 的机会猜测客户 ID。
*   12：校验和。

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2009-03-16T16:26:09.017

仅使用数字的主要优点是使用 10 键可以更有效地输入它们。

该编号的长度应尽可能短，同时仍包含您希望编目的整个实体空间，并留有余地。这可能很棘手，应该考虑一下。给定一组元素，一个小的[集合论](http://en.wikipedia.org/wiki/Permutation "关于排列的维基百科条目")可以为您提供可以访问的唯一键的数量。

说话时，将数字分成两到四位数是很自然的。通过以某种模式插入破折号，您可以“强迫”客户以更有效和更明确的方式重复它们。

例如，323-23-5344，当然是社会安全号码格式，有助于告知说话者在说出号码时在哪里暂停。它还在书写数字时提供视觉描述，并在复制数字时便于比较。

我支持订购系统正确屏蔽输入的建议，以便在任何时候都不需要输入破折号。这应该贯彻到打印的表格中，以明确预期应该输入的内容。例如，每个数字的打印框由打印的破折号分隔。

我不同意应该在这个数字中嵌入太多信息，特别是如果这些属性可能会改变。例如，假设我们给“323”赋予“是一个好客户”的意思，但他们以一种态度打了四次电话。那么我们是否要将他们的客户密钥更改为“324”，“是个混蛋”？如果他们在 04 区并将公司搬到 05 区怎么办？

如果发生这种情况，您的选择将是在整个数据库中更新该主键，或者忍受嵌入在该键中的信息不再可靠的模棱两可，从而使嵌入在有问题的键中的所有信息变得有用。

最好将可能更改的属性作为单独的字段存储在数据库中，并将客户编号作为该客户的唯一、不变的键。

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2008-10-07T14:07:19.503

以丹尼尔和迈克尔的问题为基础：如果分开的数字意味着别的东西，那就更好了。例如，我在一家公司工作，其帐号如下：

> xxxx-xxxx-xxxxxxxx

第一组数字代表该地区，第二组数字代表该地区的市场。一旦您习惯了知道号码的来源，就可以很容易地判断帐户所在的区域，甚至无需查看客户的帐户。

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2009-03-17T22:15:33.060

在回答这个问题时，我做了几个假设；有些是基于它是一个大型国际组织这一事实，有些是基于该格式适用于两种不同的表格类型这一事实。

**基于它是一个国际组织这一事实的假设：**

*   很可能每个地区都需要独立运营——也就是说，A 地区必须能够独立于 B 地区添加客户编号
*   每个地区可能使用不同的语言，因此为了使世界各地的用户可以轻松输入标识符，最好只使用数字和空格。

**基于以下事实的假设：将使用此格式的两个表：**

*   这种格式可能被列出的两个以上的表使用，因此它应该能够处理任意大量的表。
*   有经验的用户应该能够根据编码到标识符本身的信息知道他们正在查看的标识符类型。
*   如果标识符在整个系统中是全局唯一的，那就太好了。

**注意事项：**

*   对于一家全球性公司，如果只使用数字，标识符可能会很长。我们应该尽量限制编码到标识符中的无关信息的数量。
*   标识符应在有限范围内进行自我验证；那是一个程序应该能够检测大部分无效标识符，而无需查找任何内容。这意味着校验和。

**建议格式：** SSSS0RR0TTC

建议的格式尽可能简单，但并不简单：

*   **C**第一个（最右边的）字符将是标识符中所有其他字符的校验和。一个简单的校验和就可以了。这将消除 90% 的所有打字错误。如果确定这还不够，则可以将其扩展为 2 位数字，这将消除 99% 的所有打字错误。
*   **TT**接下来的 N 位数字代表表格类型编号。没有表类型编号可以包含数字零。
*   下一个数字是零。这个零将表类型编号与区域编号分开。
*   **RR**接下来的 N 位数字是地区编号。任何地区编号都不能包含零。
*   下一个数字是零。这个零将区域与序列号分开。
*   **SSSS**接下来的 N 位数字是序列号。此数字可以包含零。
*   按惯例打印或键入时，每组四个数字都用空格分隔。在内部，它们没有分开，但这有助于用户正确传输它们。

**例子**

*   假设：

    *   客户表类型=1
    *   订单表表类型=2
    *   美国-阿拉巴马州的地区代码=1
    *   CA-阿尔伯塔的地区代码=43
    *   埃塞俄比亚地区代码=924
*   10 1013 - 阿拉巴马州的客户 #1（3 是校验和：1 +1 + 1）
*   10 1024 - 阿拉巴马州订单#1
*   9259 0304 3016 - 客户#925903，加拿大艾伯塔省
*   20 3043 4092 4023 - 订单号 2030434 在埃塞俄比亚

**这种方法的优点：**

*   90% 的打错号码会被抓到
*   有无限数量的表格类型
*   地区数量不限
*   每张表的序号数量不限
*   标识符号对于系统是全局唯一的。这很重要——客户编号不能被误认为是订单编号，反之亦然。
*   每个区域可以独立添加序列号，无需全局键

**缺点**

*   每个标识符至少为六个字符
*   表类型编号和区域编号不能包含零，因为零用于将序列号与区域编号与表类型编号分开。

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2009-03-16T15:05:32.190

*   **使数字尽可能长，但不要再长了。**每次支付水费时，我都必须输入我的 20 位客户编号和 18 位发票编号。值得庆幸的是，我的客户编号中的破折号将其分为两部分。

*   **不要依赖前导零。**必须弄清楚我的发票号码中有多少个零非常烦人。以 000000000051415432 为例。他们的系统不会只识别 51415432。

*   **将数字组合在一起**。如果您绝对必须使用长数字，那么四位数的块应该可以很好地工作。

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2009-03-18T16:16:15.617

我*永远不会*在 ID 中使用用户信息。假设您使用客户姓氏的首字母后跟一些数字：例如 Thomsom 可能是客户 THOM-0001。只是，看来你弄错了，这个人的名字是汤姆森而不是汤姆森。用户数据可以更正，ID 永远不可修改。所以下次你在 TOMS 下查找 Tomson 时——……你找不到他。与其他数据相同，例如客户类型。它总是可以改变的，ID不能。
这对于 RDBMS 来说是非常基础的。

只需使用计数。为了便于阅读，最好插入分隔符，这样您的连续数字永远不会超过 4 个：9999-9999 优于 999-99999。并且不要使数字超过必要的时间；人们对被简化为 20 位数字比仅仅被简化为数字更恼火。

不过，有一个问题。特别是如果您有一家小型企业，简单的柜台可以提供比您想要的更多的东西。假设我向您订购了一些东西，订单号是090145。下个月我再次订购，订单号是090171。呃..一个月26个订单？同样，在一家活跃了 10 年的企业中成为客户 0006 时，我会感到不舒服。
解决方案很简单：跳过数字。不要使用随机数，因为您仍然希望它们按顺序排列。

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2008-10-07T14:29:26.323

我会让我的订单号遵循以下格式：

```
ddmmyyyy-####-#### 
```

其中####-#### 在每天开始时重置为零。这使得将订单与下达日期关联起来非常容易。

对于客户 ID，我会混合使用大写字母和数字，但正如迈克尔所说，避免常见的错误字母 (0,o,L,1,5,s)。这将为您提供 30 个字符来处理。如果您使用 20 个字符，这将为您提供几乎 64 位范围的客户 ID——对安全性非常有利。确保在生成 ID 时使用安全的随机数生成器。至于如何显示格式，应该如下：

```
####-####-####-####-#### 
```

正如迈克尔再次所说，确保您的系统可以处理破折号、空格、没有空格或没有破折号。（它应该在验证之前从输入中删除所有这些字符。）

我希望这会有所帮助！

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2009-03-16T17:09:07.913

您可以添加一个小的校验和（例如使用 XOR）来确保（增强）给定 ID 的正确性。如果是邮寄，请考虑[z-base-32](http://zooko.com/repos/z-base-32/base32/DESIGN)编码。但是在这里，对于电话订单，您可能更喜欢十进制标识。

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2008-10-07T14:08:53.917

假设订单/客户的创建不是集中的，或者不会总是集中的，使用 GUID

如果订单/客户的创建总是集中的，无符号整数就可以了

没有令人信服的理由让客户编号的订单编号“意味着”任何东西，而且很可能任何发明的分段编号方案都必须在未来进行彻底改革。坚持一些独特而无意义的东西。

编辑：对于 MOTO，任何多字符字母标识符都会在电话中引起问题，因此 GUID 是正确的。假设有多个分散的 MOTO 位置，为每个 MOTO 位置分配一个前缀（A、B、C 等，或 01、02、...），并为客户和订单 ID 使用整数或大整数，例如 01-1是来自 MOTO 位置 #1 的第一个订单。请注意，零填充是不必要的，对数字施加了隐含的数字限制，并要求客户在说出数字时区分六个零和七个零。如果您必须使用填充的固定长度格式，请将数字分成不超过 4 或 5 位的组。

ADDENDUM：订单号和客户号不必是各自表的主键，只是用于查找的唯一索引列。您可能希望对数据库中的主键使用更简单/更有效的方法。

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2009-03-22T06:18:06.043

1.  我们在我工作的一些参考“数字”中使用前导零，我无法告诉你在过去七年中我浪费了多少时间，迫使 Excel 将它们视为文本。不要这样做。

2.  自动递增整数对计算机来说都很好，但它们大大降低了人类发现错误的能力。这有多重要取决于您的业务。我使用与财产（住房）相关的数据，我们的主要参考资料中嵌入了前门。这并不优雅，但这意味着有经验的管理人员可以在接近数据库之前发现 90% 的小错误（当我们收到发票等时）。但是在你不依赖这种过程的环境中，这个论点就不那么引人注目了。

（现在，有些人强烈警告在引用中使用有意义的数据，因为它可能会被改变，这有一些道理，但你可以很聪明。你不必选择明显变幻无常的东西，比如这个人是否已婚——您可以将自己定位在过去的事件上，例如代表他们首次开设特定帐户的地区的角色。即使您不这样做，也要有某种模式来帮助与客户沟通。我在许多呼叫中心工作过人们有时会带着从出生证明开始的每一份文件来电话，因为他们拼命地试图找到他们的账户/订单/客户号码。我不认为说“这将是一个介于 1 到 100 万亿之间的数字”会是非常便利）

3.  有人说过，但不要创建非常长的引用。我们是忙碌的人，我们没有时间通过​​电话系统输入这个废话并在数字 17 上犯了一个错误，只是为了重新启动（再次）。您的一些客户可能有残疾，而且越来越多的客户可能会超过 55 岁。再次注意零。您会看到十四位数字的采购订单号等。他们认为他们会下多少订单？

4.  如果将在您的网络之外进行任何数据聚合（因此未连接到您的数据库） - 具有某种校验位/正则表达式模式，您的合作伙伴/供应商可以验证他们没有犯错。这方面的一个例子是英国的电力供应编号系统 (MPAN) 就是一个很好的例子 - 专为人们维护自己的记录而设计，而无需下载宇宙中每个电表的大列表来检查他们没有制作一个错字。

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2008-10-07T14:03:19.527

我只会使用数字，因为它是一家国际公司。我会每隔 4-6 个数字使用空格或破折号来分隔它。我还会将格式分开以便快速识别

例子：

000-00000-00000 - 可能是客户编号

00000-00000-00000-00000 - 可能是订单号

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2009-03-17T16:01:09.910

坚持数字（没有字符或特殊的东西）：

*   可以轻松输入到 IVR 流程中
*   它的国际化 - 没有语言麻烦
*   字符与数字之间没有混淆 - O 与 0，I 与 1
*   只要前导 0 没有意义，您就可以更有效地存储/操作它们

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2009-03-18T02:02:07.527

我会为订单号和客户号使用完全数字系统，这将允许您避免其他语言的问题。

避免使用前导零，因为这可能会导致数据输入和验证出现问题。

每个数字的位数将取决于您的预期音量。您将始终拥有比客户编号更多的订单编号。从 100000 开始的六位数客户编号仍将为您提供 899,999 个客户。为订单号添加额外的 3-4 位数字，将为每位客户提供 999 至 9,999 个订单（如果您考虑一次性客户，则更多）。

无需在编号序列中构建任何类型的标识。您还有其他数据库字段来识别客户来自哪里等。不要使您的系统过于复杂。

KISS（保持简单的stackoverflow）

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2009-03-21T23:43:42.730

我建议使用 16 位标识符，当打印或显示给客户时，其格式为 xxxx-xxxx-xxxx-xxxx，但在系统中存储为不带破折号的数字。

使用这种格式的原因是，它使人们更容易通过电话读出号码来阅读，因为他们可以分 4 批进行阅读，而不是试图记住他们已经说了多少。

如果您希望前 4 位可用于识别号码的类型，1000 用于客户，2000 用于供应商，3000 用于订单，4000 用于发票等。

如果您希望将此类信息编码在数字本身中，则第二组可以使用年/月标识符，使用 yymm 格式，因此 1000-0903-xxxx-xxxx 将是 2009 年 3 月输入的客户。

这将为您留下 8 位数的实际数据本身。

我认为在标识符中使用字母对于任何处理电话的系统来说都是一个非常糟糕的主意，因为口音和理解的差异如此之多，以至于人们一定会因为试图让他们的标识符被某人识别而感到不安无法正确理解他们的口音。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2009-03-18T01:35:41.490

对格式问题的额外考虑 - 在代码中，为 OrderId 和 CustomerId 创建一个单独的类。这些类是不可变的，并验证它们的输入以确保它们是可接受的 ID。此外，没有值可以是订单 ID 和客户 ID。

最简单的方法就是让 OrderId 的支持值是以 1 开头的整数，而 CustomerIds 是以 2 开头的整数，或类似的东西。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2009-03-18T02:17:07.117

哇 - 多么简单但有启发性的问题！还有很多自相矛盾的答案。我认为这里有 3 个明显的候选答案：

1) 使用自动递增的长整数。2) 使用 GUID 3) 使用在 ID 中包含其他信息的复合类型。

对于更简单的系统，尤其是所有用户都访问中央数据库的基于 Web 的系统，(1) 效果很好。它的优点是数字尽可能短且简单，但不能更短，避免使用字母字符（您会惊讶于相同字母的名称在不同国家/地区有多么不同 - 一个国家 E 是另一个国家 I）。它本质上并没有区分订单 ID 和客户 ID，但是您总是可以在每个订单 ID 前面或附加一个“C”或“O”，然后在输入时默默地删除它们？它也没有校验和或错误检查。

对于许多软件组件需要动态创建数字的分布式系统，不参考主数据库 (2) 是唯一的方法。它们的优点是主要进行错误检查，因为地址空间非常大，但出于同样的原因，它们太长且字母数字太长，无法通过电话轻松阅读。

至于 (3) - 将区域信息或今天的日期嵌入数字中 - 这些都是经验丰富的开发人员训练自己的想法。一开始看起来是个好主意，但总是回来困扰你。考虑客户移动到新状态，或者订单在最初发出一周后手动重新输入密钥的情况？这些信息项属于相关表中，它们可以独立于 ID 进行编辑，ID 应该只代表实体身份。重复一遍：永远不要在 ID 或主密钥中编码业务数据 - 每次您这样做时，您都会留下一个定时炸弹，让其他人有一天可以清理。

鉴于这是一个集中式（基于电话的）系统，我会选择选项 (1)，直到出现明确的更改需求。越简单通常越好。按照其他人的建议插入连字符，并根据需要在前面或后面加上校验和和/或识别字母。

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2009-03-18T03:13:13.877

**第一步：**在一个大到需要这样一个系统的组织中，有一个你正在替换的现有系统。如果可能，继续以前系统的方案。如果您可以访问旧系统中的数据，即使是在基本级别上，它也会使很多事情变得更容易。

也就是说，通常有充分的理由来更改方案，特别是当它来自遗留系统时。不过，我发现在继续之前正式排除旧方案通常会有所帮助。

**第二步：**像这样的系统永远不会存在于真空中。是否已经存在用于用户和/或订单 ID 的组织范围的方案，例如在会计、库存管理或 CRM 系统中？如果是这样，请考虑采用现有方案以使互操作性更容易。许多大型组织有多种方法来指定单个客户或订单，这使得从数据中获取有用的情报变得更加困难。

**第三步：**如果旧系统的方案太糟糕而无法继续，并且没有其他方案可以采用，请自行推出。在这种情况下，看看原始方案的缺点，不管它们是什么，并纠正它们。正确答案将取决于应用程序的具体要求。您给我们的问题陈述太模糊，无法有效推测最终形式可能是什么样子。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2009-03-20T18:55:51.400

我总是坚持使用自动递增数字，并且我总是将序列播种到足够高的位置，以便它们都具有一致的位数 - 似乎不那么令人困惑。

我有时也会开始一个订单号，比如 6 位数，从 200,000 开始，客户编号为 5 位数，从 10,000 开始，例如，这会给我 90,000 个唯一的客户编号和 800,000 个唯一的订单号以供使用，您总是可以通过查看它是客户编号还是订单编号。（也就是说，如果客户代表通过电话询问一个号码，那么它会立即很明显是哪个）

但是，我不会在依赖于此的应用程序中构建逻辑，因此即使它确实翻转了，系统也不会关心。

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2014-01-06T11:21:43.840

这里最大的问题是尽量不要过度思考问题。

虽然我在电子商务系统方面更有经验，但我认为这篇文章中的一些观点可以应用于邮购和电话订购系统。

对于订单，自增整数完美地用作数据库中的主键以及客户将在他/她的发票上看到的数字。绝对没有理由为您的数字创建一些过于复杂的算法。如果您想知道他们来自哪个国家/地区，请使用数据库中的单独字段。此外，如果您担心您的竞争对手在监视您；让他们！如果您的业务围绕着监视您的竞争对手，因为您没有产生足够的收入，那么您的商业理念很可能一开始就不好。此外，如果您想愚弄您的竞争对手，您可以创建自己的脚本来自动创建虚假订单。如果您的电子商务系统设计良好，那么这将不是问题。

使用自增整数的关键内容：

*   所有数字/数字 => 更易于沟通，通过电话没有歧义，适用于使用 0-9 作为数字系统的所有语言/文化
*   无需额外编码
*   发票上看起来不错，这是客户在电话中需要拼出的最短的位数
*   适用于小型和大型企业
*   它是可扩展的
*   服务意识/客户意识（什么对客户最好）（参见第 1 和第 3 条）
*   简单的

无论何时或无论您设计什么，都应该始终从对客户最好的东西开始。归根结底，他们会把食物放在你的桌子上。满意的客户是回头客。

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2014-12-03T08:47:07.950

对我来说，我更喜欢今天交易的日期+计数器的组合。我被要求只提供 5 位数的订单号。因此，我想出了以下内容：

1.  我必须得到当前日期
2.  获取今天交易的当前计数器，然后加 1。

我决定使用大于十进制（10）的计数，所以我使用基数 16 进行计数。因此，如果我从十六进制（FFFFF）中得到最大的 5 位数字，那将是 1,048,575 个计数。通过涉及日期，我可以说我每天可以获得 1,048,575 次计数。因此，为了使该计数每天都独一无二，我通过获取以下总和来混合日期：

*   当前年份从实施年份开始计数，即 1
*   当前小时（最大为 24）
*   一年中的当前日期（最大值为 365）

因此，我最多可以有 3 个字符开始计数。所以这将是 XXX + 今天的当前交易。例子：

当前日期：2014-12-31 01:22 PM 实施日期：2010 今日交易总数：100

计数：(5 + 13 + 365) + 101 = 383101 订单号：AD-5D87D

**AD**只有一个自定义订单号前缀。所以到那时我的订单号将从我的实施日期算起 1000000 年。

无论如何，如果您认为每天的交易量可以高达 1000000 次，这不是一个好的解决方案。

# c# - 如何在 Webbrowser 控件中禁用“安全警报”窗口

> ID：178578
> 
> 赞同：9
> 
> 时间：2008-10-07T13:58:33.110
> 
> 标签：c#, https, browser, certificate

我正在使用 Webbrowser 控件以“不受信任的证书”登录到 HTTPS 站点。但我会弹出关于不受信任证书的标准窗口“安全警报”：

![安全警报窗口](https://i.stack.imgur.com/U01dp.jpg)

我必须按标题找到此窗口并将其发送`Alt`+`Y`以按*是*：

```
int iHandle = NativeWin32.FindWindow(null, "Security Alert");
NativeWin32.SetForegroundWindow(iHandle);
System.Windows.Forms.SendKeys.Send("Y%"); 
```

但用户可以看到此窗口闪烁。

如何忽略此警报？
或者在 Webbrowser 控件中禁用此“不受信任的证书”检查？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-07T14:02:46.457

这应该这样做：

```
public static bool ValidateServerCertificate(object sender, X509Certificate certificate, X509Chain chain, SslPolicyErrors sslPolicyErrors)
{
    return true;
}

ServicePointManager.ServerCertificateValidationCallback = new RemoteCertificateValidationCallback(ValidateServerCertificate); 
```

显然，盲目地允许证书是一种安全风险。当心。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-06-27T20:18:17.640

如果证书不是来自受信任的证书颁发机构（提示中的第一点），那么您可以在相关 PC 上的受信任的根证书颁发机构下安装证书。

您可以在查看证书下执行此操作。

在某些方面，这可能是一个更简单的解决方案，因为它不需要任何接受任何和所有证书的代码更改。但是，它确实需要在使用应用程序的任何地方安装证书。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2016-02-12T12:45:36.750

在这里，我们采用解决方案：我在 Browser_Navigated 事件上运行它，因为在此之前底层的 activeX 组件为空。

**参考：**[https://social.msdn.microsoft.com/Forums/vstudio/en-US/4f686de1-8884-4a8d-8ec5-ae4eff8ce6db/new-wpf-webbrowser-how-do-i-suppress-script-errors？论坛=wpf](https://social.msdn.microsoft.com/Forums/vstudio/en-US/4f686de1-8884-4a8d-8ec5-ae4eff8ce6db/new-wpf-webbrowser-how-do-i-suppress-script-errors?forum=wpf)

```
 private void Browser_Navigating_1(object sender, NavigatingCancelEventArgs e)
        {
        HideScriptErrors(Browser,true);

        }

    public void HideScriptErrors(WebBrowser wb, bool Hide)
    {

        FieldInfo fiComWebBrowser = typeof(WebBrowser).GetField("_axIWebBrowser2", BindingFlags.Instance | BindingFlags.NonPublic);
        if (fiComWebBrowser == null) return;
        object objComWebBrowser = fiComWebBrowser.GetValue(wb);

        if (objComWebBrowser == null) return;

        objComWebBrowser.GetType().InvokeMember(
        "Silent", BindingFlags.SetProperty, null, objComWebBrowser, new object[] { Hide });

    } 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-11-01T14:16:04.023

当我将 WebBrowser.ScriptErrorsSuppressed 属性设置为 false 时，我不再收到这些弹出窗口

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2015-07-01T11:57:37.080

[我看到了这个解决方案。它对我有用。它非常简单。](http://blogs.msdn.com/b/ieinternals/archive/2011/05/04/side-effects-of-setting-the-silent-scripterrorssuppressed-property-for-web-browser-control.aspx)

# active-directory - 使用 kerberos 将 Linux 绑定到 Active Directory

> ID：178580
> 
> 赞同：4
> 
> 时间：2008-10-07T13:58:56.587
> 
> 标签：active-directory, ldap, kerberos, pam

我们正在尝试将 Linux 机器（debian 4.0）绑定到 W2k3 AD。我们已经正确配置了 kerberos，以便我们可以获取 TGT。并且用户正确地进行身份验证。但是，PAM 似乎是粘性检票口。例如，当我们尝试以 AD 用户之一的身份通过 SSH 连接到 linux 机器时，身份验证成功（根据 auth.log），但我从来没有得到 shell。默认环境配置正确，PAM 甚至可以正确创建 Homedir。作为参考，我们大致遵循：

[https://help.ubuntu.com/community/ActiveDirectoryHowto](https://help.ubuntu.com/community/ActiveDirectoryHowto)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-08T09:09:59.633

如果您确信除了 PAM 正常工作之外的所有内容，我建议将调试选项传递给 pam_krb5.so 以查看是否可以为正在发生的事情提供线索。

我还建议使用以下方法验证 nss-ldap 是否正确设置

```
getent passwd avalidusername 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-12-04T04:02:15.050

POSIX 帐户要求您在用户帐户中设置有效的 shell。使用 LDAP 时，这由属性 loginShell 引用。您需要使用 PAM 并将适当的属性映射到配置中的 loginShell 或 DC 上用于 UNIX 的活动 MS 服务，这将扩展 AD 架构以包含所需的 POSIX 属性。

请参阅[http://www.ietf.org/rfc/rfc2307.txt](http://www.ietf.org/rfc/rfc2307.txt)作为对 RFC2307 的参考，它为 LDAP 定义了这一点。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-17T17:01:01.523

我曾经在我们的服务器上使用过类似的东西。这是我们用来配置它的过程：

同样安装：

```
$ sudo apt-get update
$ sudo apt-get install likewise-open 
```

加入域（假设域“domain.local”）

```
$ sudo domainjoin-cli join domain.local Administrator
$ sudo update-rc.d likewise-open defaults
$ sudo /etc/init.d/likewise-open start 
```

假设您正在使用 sudo 并且希望 AD 用户能够拥有 sudoer 权限，您需要编辑 sudoers 文件。这可以通过以下命令完成：

```
$ sudo visudo 
```

然后将以下内容添加到文件末尾（假设域“DOMAIN”和所有应该拥有 sudo 的用户都在活动目录中名为“linux_admin”的组中）：

```
%DOMAIN\\linux_admin ALL=(ALL) ALL 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-03-22T20:00:32.020

一个简单的解决方案.. [pam_krb5+ldap 项目](http://pam-krb5-ldap.sourceforge.net)

pam_krb5 PAM 模块的一个分支，它提供了一个非常易于使用的配置，用于针对现有的 Active Directory 域和/或 OpenLDAP 服务器使用 linux 客户端身份验证。

# session - Microsoft ReportViewer: Session Expired Errors

> ID：178600
> 
> 赞同：21
> 
> 时间：2008-10-07T14:04:36.747
> 
> 标签：session, reportviewer

The project is ASP.NET 2.0, I have never been able to reproduce this myself, but I get emails informing me it happens to clients many times a week, often a few times in a row.

Here is the full error:

Exception Details:

> Microsoft.Reporting.WebForms.AspNetSessionExpiredException: ASP.NET session has expired

Stack Trace:

> [AspNetSessionExpiredException: ASP.NET session has expired] at Microsoft.Reporting.WebForms.ReportDataOperation..ctor() at Microsoft.Reporting.WebForms.HttpHandler.GetHandler() at Microsoft.Reporting.WebForms.HttpHandler.ProcessRequest(HttpContext context) at System.Web.HttpApplication.CallHandlerExecutionStep.System.Web.HttpApplication.IExecutionStep.Execute() at System.Web.HttpApplication.ExecuteStep(IExecutionStep step, Boolean& completedSynchronously) Session Objects:75de8e1d65ff40d1ba666d940af5b118: Microsoft.Reporting.WebForms.ReportHierarchy 5210064be1fa4d6abf5dd5e56b262974: Microsoft.Reporting.WebForms.ReportHierarchy

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-10-07T14:48:43.850

We had the same problem. So far, we only found it when the session expired but they used the back button in a browser that does aggressive caching, which is fine. But the ReportViewer tried to to a refresh even though the main page did not. So, we just added some hacky Global.asax error handling:

```
protected void Application_Error(object sender, EventArgs e)
{
    Exception exc = Server.GetLastError().GetBaseException();
    if (exc is Microsoft.Reporting.WebForms.AspNetSessionExpiredException)
    {
        Server.ClearError();
        Response.Redirect(FormsAuthentication.LoginUrl + "?ReturnUrl=" + HttpUtility.UrlEncode(Request.Url.PathAndQuery), true);
    }
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-27T15:10:03.233

**Session Timeout**

This can be due to your session timeout being too low. Check out the "sessionState" section of your Web.Config, e.g. :-

```
<system.web><sessionState mode="InProc" timeout="60" /></system.web> 
```

Which would set a session timeout of 60 minutes.

**Application Pool Recycle**

Another possible cause, and one which we ran into, is that your application pool is being recycled for some reason.

In out case it was because we were hitting a "Maximum virtual memory" setting, I just upped that and everything has been fine since.

Have a look in your System Event Log for 1010, 1011, 1074, 1077, 1078, 1079, 1080 and 1117 events from W3SVC and see if your app pool is being recycled and if so, it should state why.

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-09-21T17:14:57.303

Here was my fix.

Running IIS on a web farm, and each farm has a web garden count=3 each,

I simply made a seperate application pool just for sql reports and set that web gardern count=1 just for this reporting pool.

then, made a virtual directory in IIS and a seperate project for reporting - using that reporting pool

problem solved.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-10-09T11:17:22.793

I had this problem when developing on my own PC and could not find an answer anywhere on the net. It turned out that one of my teammates added this to the web.config:

```
<httpCookies httpOnlyCookies="false" requireSSL="true" /> 
```

So the `web.config` on the developer’s desktop should not have the tag and the DEV/QAS and Prod web.config files should have it.

I also understand it is possible for developers to use IIS Express and then they could use SSL locally.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-07T14:13:40.363

What is the question? The session expired and they cannot continue.

Check the report process speed. Build in some kind of benchmark or simply ask them to measure the report processing.

Easily can be that it is working for you, but not for them (slower network, more data to handle, slower DB server, and so on).

**Edit:** [Here is](http://social.msdn.microsoft.com/Forums/en-US/vsreportcontrols/thread/94a3b28c-273b-4781-b83c-2265effb96f5/) another explanaition and maybe a solution for the problem, but I don't recomment to set the worker process number to 1 on a procudtion environment.

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-03-08T09:47:53.823

`web gardern count=1` Works for me

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2021-07-06T13:51:41.340

Check number of **Maximum Worker Processes** for Application Pool, because Asp NET Session is different for Worker Processes.

If you have more than 1 **Worker Process** and **In-Process Sesion State** then each process will have their own Session.

**Sesion State Types**

1.  In-process: Session state is stored in the worker process where the ASP.NET application runs.
2.  State Server: Session state is stored outside the worker process where the ASP.NET application runs.
3.  SQL Server: Session state is stored in a SQL Server database.

# spry - Spry 地区的条件加倍

> ID：178601
> 
> 赞同：0
> 
> 时间：2008-10-07T14:04:45.407
> 
> 标签：spry

```
<div spry:region="ds1" spry:repeatchildren="ds1">
  <b spry:if=" '{title}'!='' ">
    <!-- this is the first if --> 
    <a href="#"  spry:if=" '{author}'!='' ">{author}
      <!-- this is the second if -->
    </a>
  </b>
</div> 
```

我想知道是否有任何简单的方法

```
if(x==y && i>j) 
```

在

```
<b>spry</b> 
```

地区。我在 spry 文档 (labs.adobe.com/technologies/spry/) 中找不到任何信息

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-05-11T12:43:31.893

属性内的语法`spry:if`是 Javascript，因此您可以使用`&&`：

```
<b spry:if="'{title}' != '' && '{author}' != ''">
<!-- ... -->
</b> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-07-28T11:37:19.033

你也可以调用一个函数

```
spry:if="myFunc();" 
```

并在您的函数中返回布尔值作为结果

```
function myfunc()
{
//do somethings ;
if(...)
return true;
else
return false;
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-06-08T19:43:29.520

通常我喜欢这样

```
<div spry:region="ds1" spry:repeatchildren="ds1">
    <b spry:if=" '{ds1::title}'!='' && '{ds1::author}'!=''">
        <a href="#">{author}</a>
    </b>
</div> 
```

# inversion-of-control - Windsor Container：如何指定一个公共属性不应该被容器填充？

> ID：178611
> 
> 赞同：13
> 
> 时间：2008-10-07T14:06:15.403
> 
> 标签：inversion-of-control, castle-windsor, property-injection

在实例化一个类时，Windsor 默认将类的所有公共属性视为可选依赖项并尝试满足它们。就我而言，这会创建一个相当复杂的循环依赖，导致我的应用程序挂起。

我如何明确告诉温莎城堡它不应该试图满足公共财产的要求？我认为一定有那个程度的属性。但是我找不到它，所以请让我知道适当的命名空间/程序集。

如果有任何方法可以在没有属性（例如 Xml 配置或通过代码配置）的情况下执行此操作，那将是更可取的，因为发生这种情况的特定库迄今为止不需要依赖于 castle。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-08T10:03:40.027

您可以使用[Castle.Core.DoNotWireAttribute](http://svn.castleproject.org:8080/svn/castle/trunk/Core/Castle.Core/Attributes/DoNotWireAttribute.cs)属性来阻止 IoC 容器连接属性（这是在 Castle.Core 程序集中，这意味着您的库只需要依赖于轻量级 Castle.Core 程序集 -例如，如果您想在完全不反转控制容器的情况下使用代码，或者在不同的 IoC 容器中使用）。

我不相信有任何方法可以防止在 Xml 配置中发生连线，但是添加对此的支持相当容易 - 如果我必须这样做，我可能会：

1.  在 xml 中的属性声明上引入某种属性：**<myprop wire="false" />**
2.  从[PropertiesDependenciesModelInspector](http://svn.castleproject.org:8080/svn/castle/trunk/InversionOfControl/Castle.MicroKernel/ModelBuilder/Inspectors/PropertiesDependenciesModelInspector.cs)继承，重写**InspectProperties**方法以应用一些额外的逻辑来识别哪些属性应该作为依赖项添加到组件模型（检查 model.Configuration 中的 wire="false" 属性/值对）。
3.  [从DefaultComponentModelBuilder](http://svn.castleproject.org:8080/svn/castle/trunk/InversionOfControl/Castle.MicroKernel/ModelBuilder/DefaultComponentModelBuilder.cs)继承并覆盖**InitializeContributors**以包含您的替换**PropertiesDependenciesModelInspector** - 或者只是删除现有的属性贡献者并在运行时通过**AddContributor** / **RemoveContributor**方法添加您自己的。
4.  替换分配给容器内核的**ComponentModelBuilder服务实例。**

另一种可能对您有用的方法是在请求任何服务实例之前手动从模型中删除依赖项，即。

```
kernel.GetHandler(typeof(MyComponent)).ComponentModel.Dependencies.RemoveAll(d => d.DependencyKey == "PropertyThatShouldNotBeWired"); 
```

不过，使用这种方法的 YMMV - 特别是如果您有可启动的服务或其他设施，它们可能会在注册后急切地实例化您的组件。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-09-01T15:29:12.147

我创建了一个工具来帮助解决这个问题：

*   [Castle.Facilities.OptionalPropertyInjection](http://using.castleproject.org/display/Contrib/Castle.Facilities.OptionalPropertyInjection)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2013-09-16T15:31:23.020

我不知道你们当时使用的是哪个版本的 Castle，但提到的解决方案都没有奏效。另外，还有很多死链接。

使用城堡 3.1，这里是我想出的解决方案（感谢一些城堡源代码挖掘）：

```
container.Register(Component.For(type)
                                        .LifestyleTransient()
                                        .Properties( propertyInfo => propertyInfo.PropertyType != typeof(MyOtherType))); 
```

'Properties' 函数在构造 ComponentModel 时添加了由 castle 使用的属性过滤器。在我的情况下，除了属性类型“MyOtherType”之外，所有属性依赖都将得到满足。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2018-11-21T17:44:46.893

也许它会对某人有所帮助。在 Windsor 4.1 中，注册期间有 PropertiesIgnore 方法。

```
Component.For<Role>().LifestyleTransient().PropertiesIgnore((model, propertyInfo) => true) 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-08T09:50:56.243

**DoNotWire 属性**

*   类：[http ://svn.castleproject.org:8080/svn/castle/trunk/Core/Castle.Core/Attributes/DoNotWireAttribute.cs](http://svn.castleproject.org:8080/svn/castle/trunk/Core/Castle.Core/Attributes/DoNotWireAttribute.cs)
*   测试：[http ://svn.castleproject.org:8080/svn/castle/trunk/InversionOfControl/Castle.Windsor.Tests/IgnoreWireTestCase.cs](http://svn.castleproject.org:8080/svn/castle/trunk/InversionOfControl/Castle.Windsor.Tests/IgnoreWireTestCase.cs)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2019-02-12T15:36:24.170

这可以通过以下代码实现：

```
var container = new WindsorContainer();

// We don't want to inject properties, only ctors
var propInjector = container.Kernel.ComponentModelBuilder
                         .Contributors
                         .OfType<PropertiesDependenciesModelInspector>()
                         .Single();
container.Kernel.ComponentModelBuilder.RemoveContributor(propInjector); 
```

源[城堡温莎文档](https://github.com/castleproject/Windsor/blob/master/docs/how-properties-are-injected.md)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-08T13:40:12.443

在这里也发布在谷歌群组论坛上：[http ://groups.google.com/group/castle-project-devel/browse_thread/thread/43aa513817bd057a](http://groups.google.com/group/castle-project-devel/browse_thread/thread/43aa513817bd057a)

# c# - Team Foundation Server 示例中的 InvalidProgramException

> ID：178619
> 
> 赞同：0
> 
> 时间：2008-10-07T14:08:45.850
> 
> 标签：c#, exception, tfs

嗨，我在尝试运行名为“C# Example.WorkItemBrowser”的示例项目时收到 System.InvalidProgramException。当我尝试执行这些行时，也会出现异常：

```
TeamFoundationServer tfserver = new TeamFoundationServer("http://localhost:8085");
tfserver.EnsureAuthenticated();
WorkItemStore store = new WorkItemStore(tfserver);
Console.WriteLine(store.Projects.Count); 
```

为此，我正在使用 2008 Visual Studio SDK。

用于程序集 Microsoft.TeamFoundation.WorkItemTracking.Client.dll 的 PEVerify

得到这个输出：

```
[MD]: Error: Value class has neither fields nor size parameter. [token:0x020000B3]
[MD]: Error: Value class has neither fields nor size parameter. [token:0x020000BF]
[MD]: Error: Value class has neither fields nor size parameter. [token:0x020000C4]
3 Error(s) Verifying Microsoft.TeamFoundation.WorkItemTracking.Client.dll 
```

SDK 的全新下载和安装以及卸载和安装以及再次安装 .net 3.5 sp1 并没有帮助。

我的问题描述有问题还是其他地方没有发生？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2010-07-12T07:08:32.997

这解决了我的问题：http: [//blogs.msdn.com/b/jianges/archive/2008/03/28/tfs-sdk-will-cause-invalidprogramexception-while-running-as-64-bit.aspx](http://blogs.msdn.com/b/jianges/archive/2008/03/28/tfs-sdk-will-cause-invalidprogramexception-while-running-as-64-bit.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-18T23:34:26.143

我只是一个非常相似的[问题](https://stackoverflow.com/questions/1015648/how-do-i-distribute-a-service-that-uses-the-team-foundation-server-api)。

事实证明，您必须在执行此代码的机器上安装 Team Explorer。您是将它部署到另一台机器上还是在没有安装 Team Explorer 的机器上尝试它？

# asp.net - ASP.NET xsd 数据集我把它放在哪里

> ID：178630
> 
> 赞同：1
> 
> 时间：2008-10-07T14:12:29.103
> 
> 标签：asp.net, xsd

我正在尝试将 ASP.NET 网站转换为 Web 应用程序项目。转换顺利，我认为除了以前我在 App_Code 文件夹中有 2 个 xsd 文件。我相信这个文件夹不会在 web 应用程序项目中使用，所以我现在将 xsd 文件放在哪里。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-07T14:15:42.107

我认为您不必特别将它们放在任何地方。出于组织的目的，您可以创建一个数据目录。如果项目足够小，我将它留在根目录中。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-07T14:45:49.037

您可以将文件放置在您想要的任何位置，但您必须小心您的命名空间引用仍然正确。

我会在项目属性中查看您的 Root Namespace 声明，以确保将其设置为您所期望的。此外，您需要查看 TableAdapter 对象的位置，因为那是实际错误所在的位置，而不是在 StudentQueriesDataTable 的声明中（由您的 xsd 作为发布的问题引用）

# windows-services - 作为域帐户运行 Windows 服务所需的最低权限

> ID：178633
> 
> 赞同：41
> 
> 时间：2008-10-07T14:12:51.753
> 
> 标签：windows-services, permissions, rights

有谁知道我需要授予域用户帐户的最低权限才能以该用户身份运行 Windows 服务？

为简单起见，假设服务除了启动、停止和写入“应用程序”事件日志之外什么都不做——即没有网络访问、没有自定义事件日志等。

我知道我可以使用内置的 Service 和 NetworkService 帐户，但由于网络策略到位，我可能无法使用这些帐户。

* * *

## 回答 #1

> 赞同：83
> 
> 时间：2008-10-07T14:16:24.603

两种方式：

1.  编辑服务的属性并设置登录用户。将自动分配适当的权限。

2.  手动设置：进入管理工具 -> 本地安全策略 -> 本地策略 -> 用户权限分配。编辑“作为服务登录”项并在那里添加您的域用户。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-07T14:14:43.793

我知道该帐户需要具有“作为服务登录”权限。除此之外，我不确定。可以在[这里找到作为服务登录的快速参考，](http://www.greyware.com/software/rum/rights.asp)[这里](http://technet.microsoft.com/en-us/library/bb457125.aspx)有很多特定权限的信息。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-02-24T10:13:12.370

“BypassTraverseChecking”意味着您可以直接访问任何深层子目录，即使您不具备对中间目录的所有中间访问权限，即它之上的所有目录都指向根级别。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-01-05T02:28:15.137

感谢您的链接，克里斯。我经常想知道诸如“BypassTraverseChecking”之类的特权的具体影响，但从来没有费心去查找它们。

我在运行服务时遇到了有趣的问题，发现在管理员完成初始安装后它无法访问它的文件。在我发现文件问题之前，我一直认为除了作为服务登录之外它还需要一些东西。

1.  禁用简单文件共享。
2.  暂时将我的服务帐户设为管理员。
3.  使用服务帐户获取文件的所有权。
4.  从管理员组中删除服务帐户。
5.  重启。

在取得所有权期间，有必要禁用从父目录继承权限并沿树递归地应用权限。

但是，无法找到“**授予**所有权”选项来避免将服务帐户临时设为管理员。

无论如何，我想我会发布这个，以防其他人走上我正在寻找安全策略问题的同一条道路，而这实际上只是文件系统权限。

# iphone - 发现我在 iPhone 上使用的互联网连接类型的方法

> ID：178636
> 
> 赞同：4
> 
> 时间：2008-10-07T14:13:18.277
> 
> 标签：iphone, cocoa-touch

我需要知道我的应用程序运行时可用的 Internet 连接。我查看了 Apple 的 Reachability 示例，但这仅在 wifi 和运营商网络之间有所不同。我需要知道的是选择了什么运营商网络，UMTS 或 EDGE 或 GPRS。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-07T15:00:35.137

目前，此信息不可用。如果您需要此功能，请提交一个新错误并提及这是错误 6014806 的副本。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-04T03:28:25.653

您可以通过检查往返服务器的延迟来猜测您所在的网络类型。如果您获得的数据低于 100 毫秒，则几乎可以肯定您使用的是 WiFi。

GPRS 和 EDGE 以大约 600 毫秒的延迟运行。UMTS/HSDPA 为 100-200 毫秒。

资料来源：我的非正式测试和 [AT&T][1] 数据。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-07-14T06:00:36.713

与其为 3G、EDGE、GPRS、wifi 宽带硬编码您网站的不同版本，不如构建一个框架来检测连接速度并将您的网站引导至适当的带宽水平？这样，您将在慢速 3G / wifi 上获得适当的结果，并且它会自然地扩展到下一代无线宽带（例如 WiMax 和 802.11n），而只需最少的努力/中断。

例如，您可以确定不同的带宽“检查点”（可能对应于 3G、EDGE 等），然后您可以执行一些操作，例如传输一些小数据位或缓存所有通用的小图像（例如图标）带宽级别，在后台对下载速度进行基准测试并相应地设置带宽级别。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-04-17T13:35:07.387

**仅文件**

我喜欢 Wedge 的回答。我不确定该文件是否不会被 ISP 缓存。您可以始终生成一个新文件名，或者选择一个足够大的文件名，以便您只测试足够长的时间才能获得结果。

**简单的延迟**

使用延迟的想法很接近，但正如 Shivan 所说，它是不准确的。澳大利亚到英国的用户将获得大约 350 毫秒的延迟，而本地用户可以看到它低至 30-40 毫秒

**解决方案：平均偏差**

如果你用 3 个数据包 ping 你的服务器，然后查看 3G 下的平均偏差 (mdev)，它通常在 50 毫秒以下。使用 2G/EDGE 几乎总是超过 100 毫秒。我在 65 毫秒到 AUS 时得到了一个异常值。

我的测试发现了 4ms-38ms 的范围，只有一个例外是从比利时到澳大利亚的测试，时间为 202ms。

希望这对某人有用..

# c# - WCF反序列化如何在不调用构造函数的情况下实例化对象？

> ID：178645
> 
> 赞同：79
> 
> 时间：2008-10-07T14:15:21.517
> 
> 标签：c#, .net, wcf, reflection, serialization

WCF 反序列化有一些神奇之处。它如何在不调用其构造函数的情况下实例化数据协定类型的实例？

例如，考虑这个数据契约：

```
[DataContract]
public sealed class CreateMe
{
   [DataMember] private readonly string _name;
   [DataMember] private readonly int _age;
   private readonly bool _wasConstructorCalled;

   public CreateMe()
   {
      _wasConstructorCalled = true;
   }

   // ... other members here
} 
```

通过获取此对象的实例时，`DataContractSerializer`您将看到该字段`_wasConstructorCalled`为`false`.

那么，WCF 是如何做到这一点的呢？这是其他人也可以使用的技术，还是隐藏在我们之外？

* * *

## 回答 #1

> 赞同：102
> 
> 时间：2008-10-07T17:20:30.050

`FormatterServices.GetUninitializedObject()`将创建一个实例而不调用构造函数。我通过使用[Reflector](http://www.red-gate.com/products/reflector/index.htm)并挖掘了一些核心的 .Net 序列化类找到了这个类。

我使用下面的示例代码对其进行了测试，看起来效果很好：

```
using System;
using System.Reflection;
using System.Runtime.Serialization;

namespace NoConstructorThingy
{
    class Program
    {
        static void Main()
        {
            // does not call ctor
            var myClass = (MyClass)FormatterServices.GetUninitializedObject(typeof(MyClass));

            Console.WriteLine(myClass.One); // writes "0", constructor not called
            Console.WriteLine(myClass.Two); // writes "0", field initializer not called
        }
    }

    public class MyClass
    {
        public MyClass()
        {
            Console.WriteLine("MyClass ctor called.");
            One = 1;
        }

        public int One { get; private set; }
        public readonly int Two = 2;
    }
} 
```

[http://d3j5vwomefv46c.cloudfront.net/photos/large/687556261.png](http://d3j5vwomefv46c.cloudfront.net/photos/large/687556261.png)

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2010-04-02T17:41:24.410

是的，FormatterServices.GetUninitializedObject() 是魔法的源泉。

如果你想做任何特殊的初始化，请看这个。 [http://blogs.msdn.com/drnick/archive/2007/11/19/serialization-and-types.aspx](http://blogs.msdn.com/drnick/archive/2007/11/19/serialization-and-types.aspx)

# c# - 推荐的 c# winform 控件包

> ID：178661
> 
> 赞同：3
> 
> 时间：2008-10-07T14:19:42.660
> 
> 标签：c#, winforms, controls

我正在寻找商业/免费推荐的 c# winform 控件包

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-08T04:52:44.427

**[开发快递](http://www.devexpress.com/)**

*我试过[ComponentOne](http://www.componentone.com/)， DevExpress 和[Telerik](http://www.telerik.com/)*

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-07T14:23:28.847

请参阅以下线程：

*   [.NET Usercontrols telerik devexpress infragistics ComponentOne whos best](https://stackoverflow.com/questions/169357/net-usercontrols-telerik-devexpress-infragistics-componentone-whos-best#170227)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-07T14:29:59.553

我使用了[Infragistics](http://www.infragistics.com/)和[DevExpress](http://www.devexpress.com)的控件，发现 DevExpress 的控件要好得多。

虽然，我的 Infragistics 曝光是 .NET 1.1，而 DevExpress 一直是 1.1 到现在。

编辑：

DevExpress 网站上提供的支持也从未失败过解决我遇到的问题，我记得 Infragistics 网格控件存在问题并且无法解决，相信我，我正在做很多更复杂的事情目前有 DevEx 的东西！

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-07T14:35:28.980

[我一直在使用Component Factory](http://www.componentfactory.com/products.php)的一些重量较轻的组件。他们有一个免费工具包，其中包含基本 winform 组件的版本。据我所知，他们没有网格控件。

对于网格，我使用了 DivElements 的[SandGrid](http://www.divelements.com/net/controls/sandgrid/)。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-07T15:18:24.837

我真的很喜欢 Winforms Infragistics 控件

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-07T14:39:14.307

我使用了 Telerik 控件套件，它们相当不错。

# ria - 服务器辅助的 MVC 框架是否达到顶峰？

> ID：178663
> 
> 赞同：2
> 
> 时间：2008-10-07T14:20:25.810
> 
> 标签：ria, sofea

十多年来，我一直在开发 Web 应用程序，从[CGI](http://en.wikipedia.org/wiki/Common_Gateway_Interface)到[ASP.Net](http://en.wikipedia.org/wiki/Asp.net)和[Struts](http://en.wikipedia.org/wiki/Apache_Struts) + [Spring](http://en.wikipedia.org/wiki/Spring_framework) + [Hibernate](http://en.wikipedia.org/wiki/Hibernate_(Java))。流行的架构风格似乎是[服务器辅助的 MVC](http://en.wikipedia.org/wiki/Model-view-controller#Implementations_of_MVC_as_web-based_frameworks)，例如[Struts](http://en.wikipedia.org/wiki/Apache_Struts)、[Ruby on Rails](http://en.wikipedia.org/wiki/Ruby_on_Rails)等。最近的发展让我问这些是否在下降。

*   Adobe 的[AIR](http://www.adobe.com/products/air/)和[Flex](http://www.adobe.com/products/flex/)
*   微软的[WPF](http://en.wikipedia.org/wiki/Windows_Presentation_Foundation)和[Silverlight](http://en.wikipedia.org/wiki/Silverlight)
*   谷歌的[Chrome](http://www.google.com/chrome)和[Gears](http://gears.google.com/)
*   [SOFEA](http://wisdomofganesh.blogspot.com/2007/11/sofea-and-soui-there-is-difference.html)和[SOUI](http://www.appcelerant.com/mvc_is_dead.html)

所有这一切让我相信，在网络的发明开始了 15 年的分心之后，我们开始完全循环。在这段时间里，我们一直对 Web 提供的所有东西如此着迷，以至于我们没有注意到 Web 应用程序的可用性（和开发人员体验）与桌面应用程序相比非常糟糕。似乎我们现在在说“去**他妈的！我们喜欢网络的好处，但我们也想要更好的可用性、离线功能以及与桌面更好的集成！** ”。

上面提到的所有发展似乎都在推动我们朝着将表示逻辑放回原来的位置的方向前进：客户端。不要误会我的意思，我认为服务器辅助的 MVC 框架不会很快消失，但我确实认为它们正在下降，而[RIA](http://en.wikipedia.org/wiki/Rich_Internet_application)和[RDA](http://en.wikipedia.org/wiki/Rich_Desktop_Applications/Rich_Internet_Desktop_Applications_(RDA/RIDA))正在上升。

***所以你怎么看？服务器辅助的 MVC 框架是否接近[顶峰](http://www.appcelerant.com/mvc_is_dead.html)？***

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-07T14:40:38.220

我同意，在某种程度上——我们正在变得更加以客户为中心，但我认为这是因为客户实际上是在以标准化的方式前进。

我们从客户端上的所有内容开始 - 因为这就是全部。然后是客户端-服务器，将两者分开，然后逐渐减少客户端位并推回服务器，原因有一个：

客户端很糟糕（win95，macos<10，unix X11），部署是一场噩梦。部署浏览器很简单。

那正在改变。Air 很容易安装，.NET 3.5 也是如此。Air 应用程序易于部署（单击此处 - 说是！），就像 WPF Click-once 应用程序一样。网络现在实际上是环境的一部分，而不是必须添加的特殊内容。数据库是您可以嵌入到 silverlight 应用程序（SQL Server Compact Edition）或 iphone (SqLite) 中的东西，而不是您必须拥有大型服务器的东西。

并且所有内容都具有自动更新功能，这使安装后的故事变得更好。

我不认为他们在下降 - 我认为逻辑刚刚被再次推出，未来会被拉回，只会被推出等等。

Silverlight/Air/Flash等都非常强大，但是作为服务器MVC框架基础的HTML + Javascript已经大量出现，尤其是如果你忽略IE6这个b'stard。

无论如何，我仍然会在服务器辅助的 MVC 框架中为 RIA 编写后端，即使他们抛出的是 JSON，而不是 HTML。因此，尽管它们不再是万能的，但它们还远未消亡（或达到顶峰）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-12T13:56:34.730

让我们澄清一些事情！

1.  MVC 只是一种用于分离关注点的设计模式。与服务器端框架没有真正的关系。
2.  没有技术性的 Web 1.0 或 Web 2.0 ... JavaScript 和 Flash 存在多年。它只是关于社交网络，标签等。

服务器端框架**根本没有死**。如果客户端架构/渲染不好，我同意 Nic Wise。你能打印一个 HTML 页面吗（每次都以同样的方式）？不，您不能，因为每个浏览器（-engine）都有自己的 HTML 描述表示。只是因为 JavaScript/Flash... 是很多人/公司的限制，服务器端处理会在那里停留很长时间。

长期以来，开发“随处运行”JavaScript 一直是个负担！如今，我们有像 JQuery 这样的框架可以为您完成这项工作。我用 JavaScript 编写了自己的主页，使用 EJS（嵌入式 JavaScript）作为模板/mvc。旧的臃肿的 JSP/PHP 页面表明，将业务逻辑与设计不同是一件非常好的事情。

每个 Web 应用程序的一个坏问题是决定将应用程序的状态保存在哪里！如果您选择了错误的方式，您将无法扩展。具有面向服务后端的以客户端为中心的框架允许您很好地扩展。

我一直在使用 SOFEA/SOUI。如果您有针对最常见问题的现成框架堆栈，您会喜欢的。

Air 和 Flex 很好，但它们带来了很多限制（Flash/JS...）。Google 的 Chrome 和 Gears 需要您在计算机上安装 Google 软件。谁在这附近有 Gears？Gears 尚未确立为广泛分布的标准。

如果您有使用 Hibernate/Spring 和 Struts 的经验，那么您应该尝试 Grails！很高兴开发 GWT/FLEX&AIR/SOFEA&SOUI 后端以及旧的服务器端 HTML 渲染。

我喜欢 SOFEA/SOUI，因为它不是侵入性的，它提供了投资保护（SOA 服务）和高可重用率。这也是将负载从服务器转移到客户端的好方法。

# coding-style - 你如何记录你的编码标准？

> ID：178664
> 
> 赞同：16
> 
> 时间：2008-10-07T14:20:45.093
> 
> 标签：coding-style, standards

您发现发布编码标准的最佳方式是什么？为什么？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-07T14:26:36.843

我们使用我们的**代码来记录标准**。这与高级/首席工程师的执法一起对我们很有帮助。我们不维护实际文档的原因是因为我们发现没有人阅读它并且它很快就会过时。

恕我直言，证明这一点所需要的只是显示样式/标准的现有代码。

轻装出行！

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-07T14:36:20.787

如果您在 .NET 中进行开发。我建议使用 StyleCop 来检查您的构建。我还建议使用 ReSharper 和 StyleCop 插件。

使用 ReSharper 和 StyleCop 插件，您会在违反标准的代码下看到红色的“波浪状”线条，一个简单的鼠标悬停就可以解释原因。没有代码审查，没有要维护的文档。

在您的构建过程中使用 StyleCop 将确保所有签入的代码都符合标准。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-10-07T14:33:13.367

在我看来，发布编码标准的唯一有效方法是将其集成到开发人员使用的 ide 中（例如 eclipse 或 idea）。所以新代码将遵循开箱即用的标准，旧代码可以使用 ide 重新格式化。

只有少数开发人员会阅读编码标准，之后会使用它们的人更少……

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-10-07T14:23:48.083

如果您指的是样式指南 - Word 文档或 PDF。IMO，这是“一成不变”的东西，但是在每个项目的基础上（如果你看到一些不起作用的东西，为下一个项目修复它，特别是如果它在项目的后期并且你有很多遵循现有样式的代码）。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-10-07T14:30:56.977

我们将它放在 wiki 上，并附有指向代码片段的链接，这很有帮助。

然后，我们在 Eclipse 中设置了一个代码格式化程序，以尽可能接近此编码标准，尽管这对最佳实践编码方法没有帮助。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-10-07T14:26:52.630

每当我负责制定编码标准时，我都会尝试在互联网上找到一个适合我们需求并使用它的好标准。我会采用任何格式，通常是 PDF 或 Word。

重新发明轮子是没有意义的——我不妨利用别人所做的辛勤工作。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-10-07T14:31:26.070

我认为最好的方法是使用 Checkstyle 来强制执行您的编码标准，并确保如果某些代码违反了 checkstyle 规则，则构建会失败。

然后使用代码审查和结对编程，让后辈可以向前辈学习

您还可以设置一个 wiki 页面。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-10-07T16:24:54.110

我们使用以下内容：

1.  编辑器中的工具/插件（checkstyle、pmd、内部工具）
2.  构建时间检查会生成报告。
3.  wiki 用于记录代码审查评论
4.  从 3 开始，我们将“可工具化”的工具重构为内部工具。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-10-07T19:07:40.117

这取决于具体情况：

我在一家只有三个开发人员的小公司工作。在那里，我们刚刚 *谈过*。如果对编码风格有疑问，这意味着无非就是询问您的共同开发人员。过了一会儿，有人意识到，同样的问题被问了好几次，并在我们的 wiki 中打开了一个编码标准页面。

今天我在一个小型研究实验室工作。在这个特定领域，我们没有正式的编码标准。然而，当我们在团队中工作并定期进行配对会议时，隐含的编码标准似乎不知从何而来。

* * *

从一些开发飞机导航系统的朋友那里，我知道他们同意基于以下代码的编码标准

*   安全和政府限制
*   来自 QA 部门的需求和投入
*   如果仍有选择的自由：来自开发人员的意见

该编码标准被记录下来并由 QA 强制执行。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-10-07T19:22:35.983

我们目前在 Wiki 中拥有只有高级开发人员有权编辑的编码标准。然而，就像许多人已经说过的那样，没有人在最初几天后阅读它。我们目前正在尝试将我们的编码标准纳入 .NET 端的 StyleCop。Delphi 的东西有点难，因为我们没有像 StyleCop 这样的 Delphi 框架可供使用。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-10-11T17:35:16.607

我尽一切努力让每个人都能轻松申请：

*   首先，团队中的每个人都应该同意应用它们
*   我共享使用过的编辑器的设置（gvim，emacs ...）
*   我提供带有样板标题的空源文件
*   我在一张参考表上总结了标准，没有显示规则，而是一段正确格式化为标准化的代码

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2008-12-09T20:08:17.690

我们已执行以下操作来记录我们的编码标准：

1.  将它们写在一个纯文字文件中。本样式指南的基础是 Sun 编码约定。
2.  配置 Checkstyle 和 PMD 以遵循这些编码约定，另外为 Eclipse 提供了一个默认工作区，该工作区具有适合定义的 Checkstyle 和 PMD 配置的正确配置。
3.  在我们的编码约定中添加了三个章节，解释了 Checkstyle、PMD 和 Eclipse 配置完成了样式指南的哪些部分，以便每个架构师都可以修改样式指南以及 Checkstyle、PMD 和 Eclipse 的配置。
4.  开发了一些小插件，以便通过将 Checkstyle 和 PMD 与我们的插件一起安装，我们由 Checkstyle 和 PMD 定义的编码约定是默认的并且易于选择。

We think that it helps a lot not only to write it down, but to integrate it in the development environment. On the other hand, we do that only for Eclpise, because it is too much to do if you want that for each and every IDE on earth.

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-10-07T14:25:12.883

我们的项目主要是在 python 中，所以我们基本上采用了[Python Coding Guidelines](http://www.python.org/dev/peps/pep-0008/)，在这里和那里改变了一些我们不喜欢的东西，并将它们贴在我们的[Trac](http://trac.edgewall.org/) wiki 上。它在首页上直接链接，以便开发人员知道在哪里可以找到它。到目前为止，它实际上在被跟踪方面做得相当不错！

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-10-07T14:26:10.777

代码指南是描述实践的公司范围的文档。它是可用的，并且必须非常严格地遵循。

代码格式标准取决于团队（或项目）成员之间的决定。[对于我们的项目，它作为Resharper](http://jetbrains.com/resharper)插件的一组设置保存在 SVN 中。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2008-10-07T14:26:39.480

对于初始过程，准备一个带有子标题的 wiki 有助于收集来自不同开发人员的意见。一旦收集了反馈，就可以对其进行整理和“发布”。

**更新：**

几年过去了，Google Docs 现在充当了一种 wiki。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2008-10-07T14:26:52.617

我通过以下方式记录代码标准：

*   最重要的一般风格的结构（如缩进，换行，大括号，......）
*   到不太明显的细节（之前/之后的空间`(`或`)`）
*   代码示例
*   设置描述以配置 Eclipse 代码格式化程序
*   散文

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2008-10-07T14:28:22.877

当我管理一个小团队时，我们的“编码标准”是 CVS 上的一个包装脚本，当您签入代码时，它会在您的代码上运行缩进（带有团队范围的 rc 文件）。

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2008-10-07T14:28:48.930

用于管理更改的带有 SVN 的内部网站。团队始终可以在线获得“最新”。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2008-10-07T15:07:17.323

我们从繁琐且容易过时的 Word 文档迁移到

*   带有标准和示例的 Wiki 页面
*   在 CI 过程中运行的自动编码标准验证工具

**注意**我们还有一个客户端，除了在 CI 周期中构建本身之外，它不使用运行任何东西。他们将规则保留在 ReSharper 中，并对结果非常满意

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2008-10-07T15:48:06.227

如果您使用的是 Eclipse，则可以使用格式化程序（Preferences->Java->Code Style->Formatters）在保存源文件时自动格式化代码。我们只是在我们的 wiki 上提供了我们公司的格式化程序，每个人都将它导入 Eclipse。

格式化程序很酷的一点是，您可以决定要使用哪一个，这样您就可以拥有不同格式的不同项目。但是，我们通常只使用一种格式，因此我们的代码在所有项目中都是统一的。

# java - JEdi torPane 在显示 HTML 时是否存在字符集问题？

> ID：178667
> 
> 赞同：4
> 
> 时间：2008-10-07T14:21:39.927
> 
> 标签：java, html, swing, jeditorpane

我有以下代码：

```
import javax.swing.JEditorPane;
import javax.swing.JFrame;
import javax.swing.JScrollPane;
import javax.swing.ScrollPaneConstants;

public class ScratchPad {

    public static void main(String args[]) throws Exception {
        String html ="<html>"+
"<head>"+
"<meta http-equiv=\"Content-Type\" content=\"text/html; charset=ISO-8859-1\"/>"+ // this is the problem right here
"<title>Error 400 BAD_REQUEST</title>"+
"</head>"+
"<body>"+
"<h2>HTTP ERROR: 400</h2><pre>BAD_REQUEST</pre>"+
"<p>RequestURI=null</p>"+
"<p><i><small><a href=\"http://jetty.mortbay.org\">Powered by jetty://</a></small></i></p>"+
"</body>"+
"</html>";
        JFrame f = new JFrame();
        JEditorPane editor = new JEditorPane();
        editor.setEditable( false );
        editor.getDocument().putProperty( "Ignore-Charset", "true" );  // this line makes no difference either way
        editor.setContentType( "text/html" );
        editor.setText( html );

        f.add( new JScrollPane(editor, ScrollPaneConstants.VERTICAL_SCROLLBAR_AS_NEEDED,
                                ScrollPaneConstants.HORIZONTAL_SCROLLBAR_NEVER) );
        f.pack();
        f.setVisible( true );
    }

} 
```

如果你运行它，你会注意到框架是空白的。但是，如果我从元标记中删除“; charset=ISO-8859-1”，就会显示 HTML。任何想法为什么以及我可以做些什么来防止这种情况（除了手动破解我无法控制的 HTML 字符串......）。

**编辑 #1** - putProperty("Ignore-Charset", "true") 不幸的是没有区别。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-09-14T11:53:59.063

在 setText 之前和 setContentType 之后使用以下行。

```
editor.getDocument().putProperty("IgnoreCharsetDirective", Boolean.TRUE); 
```

This is one of the mystic undocumented features. setContentType create a new Document that it has no effect if you set it before.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-06T20:23:44.730

当我运行代码时，我只能在删除***元***行时看到 HTML 文本。也许它与运行它的系统的字符设置有关。

# flash - 在浏览器中闪烁到全屏

> ID：178669
> 
> 赞同：4
> 
> 时间：2008-10-07T14:22:19.193
> 
> 标签：flash, actionscript-3, browser, fullscreen

如何在浏览器中以全屏模式制作我的 Flash 应用程序？我知道舞台可以置于该模式，但是当我在任何浏览器中运行应用程序时，这不起作用。所以，这是可以做到的，但是怎么做呢？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-10-07T15:06:16.797

在包含 Flash SWF 的 HTML 中，将以下参数添加到您的 <object> 标记中：

```
<param name="allowFullScreen" value="true" /> 
```

以及 <embed> 标签的以下属性：

```
allowFullScreen="true" 
```

或者，如果您使用的是[SWFObject](http://code.google.com/p/swfobject/)（应该如此），请将 allowFullscreen 参数添加到您的嵌入代码中。请参阅[SWFObject 文档](http://code.google.com/p/swfobject/wiki/documentation)以了解实现此目的的各种方法。

在您的 Flash/Flex 文件中，您需要为用户提供一种启动全屏模式的方法——**您不能在没有用户启动的情况下强制全屏**。无论您让用户做什么，都包含此代码作为对其的响应：

```
stage.displayState = StageDisplayState.FULL_SCREEN; //Flash
systemManager.stage.displayState = StageDisplayState.FULL_SCREEN; // Flex 
```

* * *

## 回答 #2

> 赞同：-2
> 
> 时间：2008-10-07T14:29:50.940

我相信这是一个简单的动作脚本命令。[来源](http://www.adobe.com/support/flash/action_scripts/actionscript_dictionary/actionscript_dictionary372.html "来源")

```
 fscommand( "fullscreen" ,  "true" ) 
```

# asp.net - asp.net：是否可以将大型 ASP.NET 页面拆分为多个部分？

> ID：178675
> 
> 赞同：3
> 
> 时间：2008-10-07T14:23:52.950
> 
> 标签：asp.net

是否可以将大型 ASP.NET 页面拆分为多个部分？JSP 有[jsp:include](http://java.sun.com/products/jsp/tags/11/syntaxref1112.html)指令。ASP.NET 中是否有任何等价物

我对重复使用这些片段不感兴趣。我只想组织 HTML/ASP 代码。

这样做是不是用户控件和母版页过大了？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-07T14:25:27.830

[MasterPage 模型](http://msdn.microsoft.com/en-us/library/wtxbf3hh.aspx)和[UserControls](http://msdn.microsoft.com/en-us/library/y6wb1a0e.aspx)是对此的两个开箱即用的解决方案。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-07T14:41:41.383

```
<!--#include file="inc_footer.aspx"--> 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-07T14:28:03.643

如果它只是 ASP.net，那么正如 John Rudy 所建议的，用户控件是拆分页面和重用代码的绝佳方式。

如果您的任何用户控件使用 Javascript，那么需要注意的一个大问题是使用[ClientID](http://blogs.telerik.com/AtanasKorchev/Posts/08-06-06/The_difference_between_ID_ClientID_and_UniqueID.aspx)来引用该控件。当您将用户控件添加到页面时，ASP.NET 会破坏 ID 以防止冲突。客户 ID 保证唯一。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-07T14:28:57.540

您应该查看 ASP.NET 用户控件，它允许您将 UI 功能封装到更小更易于管理的块中。

[http://quickstarts.asp.net/QuickStartv20/aspnet/doc/ctrlref/userctrl/default.aspx](http://quickstarts.asp.net/QuickStartv20/aspnet/doc/ctrlref/userctrl/default.aspx)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-07T14:31:49.737

如果您谈论的是特定页面（与用户控件相反，后者更适合多页面重用），您也可以使用[Partial Classes](http://msdn.microsoft.com/en-us/library/wa80x488(VS.80).aspx)。

默认情况下，ASP.NET 2.0 及更高版本 ASPX 页面中的 AFAIK 已经是部分类（在 Designer.aspx 文件中包含所有控件声明）。

# c# - 非托管 vc++ 静态库和 C# GUI 应用程序

> ID：178681
> 
> 赞同：1
> 
> 时间：2008-10-07T14:25:21.993
> 
> 标签：c#, visual-c++, mfc

基本上我有一堆非托管的 VC++ 静态库。而使用这些的 VC++ GUI 应用程序是基于 MFC 的。目标是用 C# 中完成的 GUI 应用程序替换 GUI 应用程序，但使用所有相同的静态库。问题是这是否可能，如果是，那么实现这一目标的正确方法是什么？

建议，有人吗？谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-07T14:28:49.553

是的，可以将 C++/CLI 用于托管 C++ 代码。您将编写一个 C++/CLI WinForms 应用程序，并按照正常方式简单地链接到您的静态库中。

但是，如果 GUI 代码和库之间有很多紧密耦合，那么这可能会有点混乱。您将需要担心在托管和非托管世界之间转换某些数据类型，尤其是字符串。如果您需要传递托管对象/数组

[Wikipedia](http://en.wikipedia.org/wiki/C%2B%2B/CLI)上有很好的介绍， [MSDN](http://msdn.microsoft.com/en-us/library/xey702bw.aspx)上有很多文档。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-07T15:02:34.963

Rob 是正确的 - 您可以完全在 C++/CLI 中完成，但我们发现将一些本机类包装在托管的 WinForms 用户控件类中最有用。这个托管类包含本机类的一个实例，不仅在方法调用中编组数据（如字符串），而且还将本机回调（使用 boost::signal 实现）转换为 .NET 事件。[此问题](https://stackoverflow.com/questions/163757/how-to-use-boostbind-in-ccli-to-bind-a-member-of-a-managed-class)中详细说明了此信号事件转换的整个解决方案。.NET WinForms 用户控件还捕获本机异常并将它们作为托管异常重新抛出，并将非 .NET 接口（返回迭代器的方法）转换为更 .NET 风格的接口，您可以在[这个问题](https://stackoverflow.com/questions/85033/converting-stdvectoriterator-to-net-interface-in-ccli). 然后我们可以直接在 WPF 应用程序中使用 .NET 类。请注意，如果将其包装为 .NET 类，则必须放入 DLL 中才能从 C# 中使用。

# javascript - 为什么我会收到此 Javascript 运行时错误？

> ID：178696
> 
> 赞同：4
> 
> 时间：2008-10-07T14:27:34.050
> 
> 标签：javascript, html, internet-explorer

我的网页上有以下 JavaScript...

```
64    var description = new Array();
65    description[0] = "..."
66    description[1] = "..."
...
78    function init() {
79        document.getElementById('somedivid').innerHTML = description[0];
80    }
81
82    window.onload = init(); 
```

在 Microsoft Internet Explorer 中，它会导致以下错误...

> 发生了运行时错误。
> 你想调试吗？
> 
> 行：81
> 错误：未实现

![javascript运行时错误](https://i.stack.imgur.com/n06sz.gif)

第 79 行按预期执行。

如果第 79 行被注释掉，它仍然会抛出错误。

如果我注释掉第 82 行，则该函数不会执行并且没有错误。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-10-07T14:32:52.900

第 82 行不应该是：

```
window.onload = init; 
```

当您执行“init()”时，它是对返回 void 的函数的调用。您最终会在页面加载之前调用该函数。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-07T14:39:43.043

要保留任何先前设置的 onload 函数，请尝试此

```
var prevload = window.onload;
window.onload = function(){
    prevload();
    init();
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-07T14:31:08.643

尝试为“加载”添加一个事件侦听器，或使用声明性语法`<body onload="init()">`。

编辑：此外，说`window.onload = init();`将 window.onload 设置为调用的结果`init()`。你的意思是`window.onload = init;`（一个lambda表达式）。这仍然是不好的做法，因为它会覆盖其他可能绑定到`window.onload`.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-07T14:35:18.357

除了这里提出的 onload 修复，还要检查是否有多个元素具有该 ID，我相信 IE 将返回具有该 ID 的所有元素的集合，在这种情况下，您需要从在访问该属性之前收集或确保您使用的是唯一 ID。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-07T14:40:00.467

[尝试在启用了FireBug](https://addons.mozilla.org/en-US/firefox/addon/1843)插件的 FireFox 中运行它。这将允许您调试 javascript

# java - 通用的、注释驱动的事件通知框架

> ID：178700
> 
> 赞同：7
> 
> 时间：2008-10-07T14:28:47.917
> 
> 标签：java, events, annotations, notifications

虽然 Java 中简单的、接口驱动的事件通知框架自寒武纪之前就已经存在（例如 java.beans.PropertyChangeSupport），但使用注释驱动的事件通知代替框架变得越来越流行。

例如，请参阅[JBossCache 2.2](http://www.jboss.org/file-access/default/members/jbosscache/freezone/docs/2.2.0.GA/userguide_en/html_single/index.html#api.listener)。侦听器类对其侦听器方法进行了注释，而不是遵循严格的接口。这更容易编程，也更容易阅读，因为您不必编写您不感兴趣的侦听器回调的空实现（是的，我知道侦听器适配器超类）。

这是来自 JBossCache 文档的示例：

```
@CacheListener
public class MyListener {
   @CacheStarted
   @CacheStopped
   public void cacheStartStopEvent(Event e) {
         switch (e.getType()) {
            case Event.Type.CACHE_STARTED:
               System.out.println("Cache has started");
               break;    
            case Event.Type.CACHE_STOPPED:    
               System.out.println("Cache has stopped");
               break;    
         }
   }    

   @NodeCreated    
   @NodeRemoved
   @NodeVisited
   @NodeModified
   @NodeMoved
   public void logNodeEvent(NodeEvent ne) {
         log("An event on node " + ne.getFqn() + " has occured");
   } 
```

}

这样做的问题在于，由于它具有注释反射性质，因此编写框架以支持此类事情的过程更加复杂。

所以，在我开始编写通用框架的道路之前，我希望有人已经做到了。有没有人遇到过这样的事情？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-12-30T13:23:00.243

您现在已经可以使用[EventBus](http://eventbus.org "事件总线")做到这一点。

以下示例来自[EventBus 入门指南](http://eventbus.org/confluence/display/EventBus/Getting+Started)。基于已发布事件更新的状态栏，无需将状态栏控件/小部件注册为发布者的侦听器。如果没有 EventBus，则需要将状态栏作为侦听器添加到许多类。状态栏也可以随时创建和销毁。

```
public StatusBar extends JLabel {
    public StatusBar() {
        AnnotationProcessor.process(this);
    }
    @EventSubscriber(eventClass=StatusEvent.class)
    public void updateStatus(StatusEvent statusEvent) {
        this.setText(statusEvent.getStatusText();
    }
} 
```

一个类似的项目是[ELF（事件侦听器框架）](https://elf.dev.java.net/)，但它似乎不太成熟。

我目前正在研究[Publish-Subscribe Event Driven Programming |上的事件通知框架。Kev 的 Spring vs Java EE Dev](http://spring-java-ee.blogspot.com/2009/12/publish-subscribe-event-driven.html)和后续文章。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2010-01-10T22:56:12.797

我已经制作了[http://neoevents.googlecode.com](http://neoevents.googlecode.com)来处理这种基于注释的事件处理程序。

```
@actionPerformed
private void onClick() {
    //do something
}

protected void initComponents() {
    JButton button = new JButton("Click me!!!");
    button.addActionListener(new ActionListener(this) );
} 
```

它看起来和我预期的一样简单。注释可用于 J2SE 中的每个侦听器。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-07T15:30:14.580

不要把复杂误认为聪明。在我看来，这将是：

1.  调试的噩梦
2.  难以遵循（从维护的角度来看，或者有人试图在 6 个月后改变某些东西）
3.  充满了`if (event instanceof NodeCreatedEvent)`类似的代码。为什么这比子类化更好，`adapter`我不知道！

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-07T15:53:22.583

我在这里看到的主要问题是方法参数，它限制了哪些方法实际上可以用于哪些事件，并且没有编译时帮助。

这就是接口对我来说对 Java 事件模型等观察者模式实现具有吸引力的原因。像 eclipse 这样的工具可以自动生成方法存根，这样你就不会弄错签名。在您的示例中，很容易使用错误的参数类型并且在事件发生之前永远不会知道它（这可能是几个月后的错误情况）

您可能会尝试的一件事是我的注释和处理器，用于实现观察者和空对象实现。假设你有

```
package a.b.c;

public interface SomeListener {
    void fee();
    void fie();
    void fo();
    void fum();
} 
```

并想创建一个监听器实例。你可以写

```
package x.y.z;

import a.b.c.SomeListener;
import com.javadude.annotation.Bean;
import com.javadude.annotation.NullObject;

@Bean(nullObjectImplementations = {@NullObject(type = SomeListener.class) })
public class Foo extends FooGen implements SomeListener {
    @Override
    public void fie() {
        // whatever code you need here
    }
} 
```

要为这些事件创建源，您可以编写

```
package a.b.c;

import com.javadude.annotation.Bean;
import com.javadude.annotation.Observer;

@Bean(observers = {@Observer(type = SomeListener.class)})
public class Source extends SourceGen {
    // SourceGen will have add/remove listener and fire methods
    //   for each method in SomeListener
} 
```

如果您有兴趣，请参阅[http://code.google.com/p/javadude/wiki/Annotations 。](http://code.google.com/p/javadude/wiki/Annotations)也可能给你一些其他的想法。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2012-01-24T11:24:44.197

[Google Guava v11](http://code.google.com/p/guava-libraries/)添加了一个[使用这种样式的 EventBus 组件](http://code.google.com/p/guava-libraries/wiki/EventBusExplained)。他们还[解释了为什么他们决定使用注释而不是接口](http://code.google.com/p/guava-libraries/wiki/EventBusExplained#Why_use_an_annotation_to_mark_handler_methods,_rather_than_requi)。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-13T10:39:15.283

我也一直在考虑一个通用的注释驱动的事件框架。我喜欢静态类型提供的好处，但是当前的接口驱动事件模型使用起来很痛苦（丑陋的代码）。是否可以使用自定义注释处理器进行一些编译时检查？这可能有助于增加我们已经习惯的一些缺失的“安全性”。

许多错误检查也可以在侦听器向事件生产者“注册”时完成。因此，应用程序会提前失败（当注册监听器时），甚至可能在启动时失败。

这是我一直在玩弄的通用框架的示例：

```
public class ExampleProducer {

    private EventSupport<ActionEvent> eventSupport;

    public ExampleProducer() {
        eventSupport = new EventSupport<ActionEvent>(this);
    }

    @AddListenersFor(ActionEvent.class)
    public void addActionListener(Object listener)
    {
        eventSupport.addListener(listener);
    }

    @RemoveListenersFor(ActionEvent.class)
    public void removeActionListener(Object listener)
    {
        eventSupport.removeListener(listener);
    }

    public void buttonClicked() {
        eventSupport.fire(new ActionEvent(this, 
                              ActionEvent.ACTION_PERFORMED, "Click"));
    }
   } 
```

生产者使用`EventSupport`，它使用反射来调用事件。如前所述，`EventSupport`可以在注册事件侦听器时执行一些初始检查。

```
public class ExampleListener
{   
  private ExampleProducer submitButton;

  public ExampleListener()
  {
    submitButton = new ExampleProducer();
    EventSupport.autoRegisterEvents(this);
  }

  @HandlesEventFor("submitButton")
  public void handleSubmitButtonClick(ActionEvent event)
  {
    //...some code to handle the event here
  }
} 
```

在这里，`EventSupport`有一个静态方法，它使用反射向事件生产者自动注册侦听器。这消除了手动向事件源注册的需要。自定义注解处理器可用于验证`@HandlesEventFor`注解是否引用了`ExampleListener`. 注释处理器也可以进行其他检查，例如确保事件处理程序方法签名与注册方法之一匹配`ExampleProducer`（基本上，可以在注册时执行相同的检查）。

你怎么看？这值得花一些时间来充分开发吗？

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2010-05-03T16:40:19.583

[这是一个名为SJES](http://code.google.com/p/sjes/)的类似项目。

```
public class SomeController {

private Calculator c1 = new Calculator();
private Calculator c2 = new Calculator();

public SomeController() {
    c1.registerReceiver(this);
    c2.registerReceiver(this);
    c1.add(10, 10);
    c2.add(20, 20);
}

@EventReceiver(handleFor="c1")
public void onResultC1(Calculator.Event e) {
    System.out.println("Calculator 1 got: " + e.result);
}

@EventReceiver(handleFor="c2")
public void onResultC2(Calculator.Event e) {
    System.out.println("Calculator 2 got: " + e.result);
}

@EventReceiver
public void onResultAll(Calculator.Event e) {
    System.out.println("Calculator got: " + e.result);
}
}

public class Calculator {

private EventHelper eventHelper = new EventHelper(this);

public class Event {

    long result;

    public Event(long result) {
        this.result = result;
    }
}

public class AddEvent extends Event {

    public AddEvent(long result) {
        super(result);
    }
}

public class SubEvent extends Event {

    public SubEvent(long result) {
        super(result);
    }
}

public void unregisterReceiver(Object o) {
    eventHelper.unregisterReceiver(o);
}

public void registerReceiver(Object o) {
    eventHelper.registerReceiver(o);
}

public void add(long a, long b) {
    eventHelper.fireEvent(new AddEvent(a + b));
}

public void sub(long a, long b) {
    eventHelper.fireEvent(new SubEvent(a - b));
}

public void pass(long a) {
    eventHelper.fireEvent(new Event(a));
}
} 
```

我认为这很容易使用。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2012-10-23T09:36:44.967

您还可以查看[MBassador](https://github.com/bennidi/mbassador)它是注释驱动的，非常轻量级并使用弱引用（因此很容易集成到对象生命周期管理由诸如 spring 或 guice 或 somethign 之类的框架完成的环境中）。

它提供了一种对象过滤机制（因此您可以订阅 NodeEvent 并附加一些过滤器以将消息处理限制为仅一组特定类型）。您还可以定义自己的注释来自定义处理程序的声明。

而且它非常快速且资源高效。查看这个[基准](https://github.com/bennidi/eventbus-performance)，显示使用 Guava 或 mbassador 的不同场景的性能图。

# timestamp - unix 时间戳是存储时间戳的最佳方式吗？

> ID：178704
> 
> 赞同：63
> 
> 时间：2008-10-07T14:29:21.957
> 
> 标签：timestamp

我总是对所有事情都使用 unix 时间戳，但我想知道是否有更好的方法。

你用什么来存储时间戳，为什么？

* * *

## 回答 #1

> 赞同：100
> 
> 时间：2008-10-07T14:50:28.357

无论您选择存储时间戳，重要的是要避免区域解释问题和时间偏移问题。无论区域如何，Unix 时间戳的解释都是相同的，并且无论时区如何，都是从同一时间点计算出来的——这些都是好事。

谨防将时间戳存储为不明确的字符串，例如 01/02/2008，因为这可以解释为 2008 年 1 月 2 日或 2008 年 2 月 1 日，具体取决于语言环境。

存储小时/分钟/秒时，重要的是要知道指定了“哪个”小时/分钟/秒。您可以通过包含时区信息来做到这一点（Unix 时间戳不需要，因为它被假定为 UTC）。

但是，请注意 Unix 时间戳不能唯一地表示某些时刻：当 UTC 有闰秒时，Unix 时间戳不会改变，因此 UTC 23:59:60 和第二天 00:00:00 具有相同的Unix 表示。因此，如果您确实需要一秒或更佳的分辨率，请考虑另一种格式。

如果您更喜欢比 Unix 时间戳更易于阅读的存储格式，请考虑[使用 ISO 8601](http://en.wikipedia.org/wiki/ISO_8601)。

一种有助于保持直截了当的技术是将日期存储为 UTC，并且在向用户显示日期时仅应用时区或 DST 偏移量。

* * *

## 回答 #2

> 赞同：31
> 
> 时间：2008-10-07T14:48:15.490

如果您要存储日志文件，请出于对 pete 的喜爱，使其具有人类可读性和词汇可排序性。

例如 2008-10-07 09:47:02。

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2008-10-07T14:32:49.140

[32 位 Unix 时间戳将在几年后（2038 年 1 月）溢出](http://en.wikipedia.org/wiki/Year_2038_problem)，所以这可能是一个考虑因素。我通常在 SQL 中使用 DATETIME 格式，即 YYYY-MM-DD HH:MM:SS，时间为 24 小时制。我尝试以相同的格式输出到文件，只是为了让我的生活更轻松。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-10-07T14:33:09.280

您需要存储什么时代以及达到什么分辨率？如果您需要微秒，或者石器时代的日期 time_t 可能不是最好的。对于一般商业目的，它非常好（假设是 64 位）

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-10-07T14:43:25.453

这取决于您需要时间戳的用途。

unix 时间戳不能表示 2008-12-31T23:59:59Z 之后 1 秒的时间。如果您使用 unix 时间戳执行 '2009-01-01T09:00:00' - '2008-12-31T09:00:00'，则结果不正确：这两个日期之间会有闰秒并且它们是分开的86401 秒（不是 86400，因为 unix 时间戳会告诉你）。

除此之外以及其他响应者所说的，是的——unix时间戳是要走的路:)

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-10-07T14:44:45.200

时间戳在数据库上不是一个好主意，因为它们不考虑夏令时或当前本地时间。在 MySQL 上，最好将其存储为时间，然后使用[MySQL 日期和时间函数](http://dev.mysql.com/doc/refman/5.0/en/date-and-time-functions.html)来检索您想要的部分，或与其他日期进行比较。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-10-07T14:34:10.697

如果我需要亚秒级精度，则 timeval 样式（time_t + 微秒），否则只需 time_t。您可以使用 64 位整数值来存储 time_t * 1000000 + usec，并且您可以防溢出超过 +/- 292,000 年。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2010-10-12T16:06:10.963

对于在 2038+ 中输入未来日期的用户来说，UNIX 时间戳 32 位问题似乎很烦人。

对 MySQL 使用 DATETIME 序列，或者将日期存储为 BIGINT(8) 无符号（最大值：18 quintillion）或 FLOAT，以便您可以输入大数字。然后你不能使用例如 PHP 的 date() 函数，因为它只允许整数作为参数（受 32 位系统限制）。

**我找到的解决方案**是使用**PHP 5.2.0**函数。[这是 DateTime PHP 解决方案](http://www.infernodevelopment.com/forum/Thread-Solution-2038-PHP-Date-Bug-Y2-038K-UNIX-TIMESTAMP-BUG)。

无需更改 UNIX_TIMESTAMP 格式。只要您将 BIGINT(8) 未签名作为您的 MySQL 时间戳存储。您将不再受 32 位系统的限制。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-07T14:36:52.253

时间戳基本上是：

*   一个明显的时间点

由于时间点具有无限的分辨率，因此选择时间戳格式的重要一点是：它是否具有足够的分辨率？

*   [Unix 时间](http://en.wikipedia.org/wiki/Unix_time)仅以秒为单位。
*   [分机 4](http://en.wikipedia.org/wiki/Ext4#Improved_timestamps)有纳秒
*   [Java](http://java.sun.com/j2se/1.4.2/docs/api/java/sql/Timestamp.html#getNanos())有纳秒

对于我拥有的大多数应用程序，纳秒就足够了。所以到目前为止，Java Timestamp 对我来说是正确的解决方案。

# .net - How do I find out if a column exists in a VB.Net DataRow

> ID：178712
> 
> 赞同：60
> 
> 时间：2008-10-07T14:30:09.427
> 
> 标签：.net, vb.net, ado.net, dataset, datarow

I am reading an XML file into a DataSet and need to get the data out of the DataSet. Since it is a user-editable config file the fields may or may not be there. To handle missing fields well I'd like to make sure each column in the DataRow exists and is not DBNull.

I already check for DBNull but I don't know how to make sure the column exists without having it throw an exception or using a function that loops over all the column names. What is the best method to do this?

* * *

## 回答 #1

> 赞同：174
> 
> 时间：2008-10-07T14:39:44.290

DataRow's are nice in the way that they have their underlying table linked to them. With the underlying table you can verify that a specific row has a specific column in it.

```
 If DataRow.Table.Columns.Contains("column") Then
        MsgBox("YAY")
    End If 
```

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2008-10-07T14:37:47.023

You can use `DataSet.Tables(0).Columns.Contains(name)` to check whether the `DataTable` contains a column with a particular name.

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2015-12-03T22:31:53.397

Another way to find out if a column exists is to check for `Nothing` the value returned from the `Columns` collection indexer when passing the column name to it:

```
If dataRow.Table.Columns("ColumnName") IsNot Nothing Then
    MsgBox("YAY")
End If 
```

This approach might be preferred over the one that uses the `Contains("ColumnName")` method when the following code will subsequently need to get that `DataColumn` for further usage. For example, you may want to know which type has a value stored in the column:

```
Dim column = DataRow.Table.Columns("ColumnName")
If column IsNot Nothing Then
    Dim type = column.DataType
End If 
```

In this case this approach saves you a call to the `Contains("ColumnName")` at the same time making your code a bit cleaner.

* * *

## 回答 #4

> 赞同：-3
> 
> 时间：2008-10-07T14:32:26.817

You can encapsulate your block of code with a try ... catch statement, and when you run your code, if the column doesn't exist it will throw an exception. You can then figure out what specific exception it throws and have it handle that specific exception in a different way if you so desire, such as returning "Column Not Found".

# c# - 以编程方式锁定 Active Directory 帐户

> ID：178730
> 
> 赞同：3
> 
> 时间：2008-10-07T14:33:00.327
> 
> 标签：c#, active-directory

我必须在 C# 中以编程方式锁定 Active Directory 中的用户帐户。

不幸的是，它不能通过 userAccountControl 属性起作用。每次我将 userAccountControl 设置为 528（=带有锁定标志的普通帐户）时，Active Directory 都不会接受该值并将其重置为 512（=普通帐户），恕不另行通知。

现在我尝试通过提供不正确的凭据来锁定帐户（见下文），但这也不起作用。

```
int retries = 0;
while (!adsUser.IsAccountLocked && retries < MAX_LOCK_RETRIES)
{
     retries++;

    try
    {  
        new DirectoryEntry(userPath, logonName, incorrectPassword).RefreshCache();
    }
    catch (Exception)
    { 
        /* ... */ 
    }
    adsUser.GetInfo();
} 
```

有任何想法吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-07T14:39:56.897

确保您用于禁用帐户的帐户具有足够的权限来禁用帐户。请参阅Microsoft 的[此示例](http://msdn.microsoft.com/en-us/library/ms696026(VS.85).aspx)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-10-28T14:53:51.890

此代码将用于锁定 AD 中的用户

```
/// <summary>
/// Locks a user account
/// </summary>
/// <param name="userName">The name of the user whose account you want to unlock</param>
/// <remarks>
/// This actually trys to log the user in with a wrong password. 
/// This in turn will lock the user out
/// </remarks>
public void LockAccount(string userName)
{
    DirectoryEntry user = GetUser(userName);
    string path = user.Path;
    string badPassword = "SomeBadPassword";
    int maxLoginAttempts = 10;

    for (int i = 0; i &lt maxLoginAttempts; i++)
    {
        try
        {
            new DirectoryEntry(path, userName, badPassword).RefreshCache();
        }
        catch (Exception e)
        {

        }
    }
    user.Close();
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2015-02-17T16:01:09.773

根据您的 Active Directory 策略，可能需要交互式登录尝试来锁定帐户。您可以使用[`LogonUser`advapi32.dll 的方法](https://msdn.microsoft.com/en-us/library/windows/desktop/aa378184%28v=vs.85%29.aspx)模拟那些。在我的测试中，我发现运行此循环 100 次并不能保证在域控制器上尝试 100 次错误密码，因此您应该[检查用户是否被锁定](https://stackoverflow.com/a/12992684/982237)并在必要时进行更多尝试。

这样做的底线是您应该禁用帐户而不是尝试锁定它。锁定帐户和禁用帐户之间[没有功能差异](http://www.windows-active-directory.com/difference-between-disabled-expired-and-locked-account.html)。下面的代码是一个黑客。

```
using System;
using System.Runtime.InteropServices;

namespace Test
{
    class Program
    {
        static void Main(string[] args)
        {
            IntPtr token = IntPtr.Zero;
            string userPrincipalName = "userID@domain.com";
            string authority = null; // Can be null when using UPN (user principal name)
            string badPassword = "bad";

            int maxTries = 100;
            bool res = false;

            for (var i = 0; i < maxTries; i++)
            {
                res = LogonUser(userPrincipalName, authority, badPassword, LogonSessionType.Interactive, LogonProvider.Default, out token);
                CloseHandle(token);
            }
        }

        [DllImport("advapi32.dll", SetLastError = true)]
        static extern bool LogonUser(
          string principal,
          string authority,
          string password,
          LogonSessionType logonType,
          LogonProvider logonProvider,
          out IntPtr token);

        [DllImport("kernel32.dll", SetLastError = true)]
        static extern bool CloseHandle(IntPtr handle);
        enum LogonSessionType : uint
        {
            Interactive = 2,
            Network,
            Batch,
            Service,
            NetworkCleartext = 8,
            NewCredentials
        }

        enum LogonProvider : uint
        {
            Default = 0, // default for platform (use this!)
            WinNT35,     // sends smoke signals to authority
            WinNT40,     // uses NTLM
            WinNT50      // negotiates Kerb or NTLM
        }
    }
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-06-17T18:16:01.460

一旦您拥有目录条目对象，这将起作用。

```
DirectoryEntry de = result.GetDirectoryEntry();
int val = (int)de.Properties["userAccountControl"].Value;
de.Properties["userAccountControl"].Value = val | 0x0002; 
```

# vba - Excel VBA中的OnClick

> ID：178738
> 
> 赞同：24
> 
> 时间：2008-10-07T14:34:13.723
> 
> 标签：vba, excel

有没有办法用 Excel 捕捉单击 VBA 中的单元格？我不是指该`Worksheet_SelectionChange`事件，因为如果多次单击单元格，它不会触发多次。`BeforeDoubleClick`也不能解决我的问题，因为我不想要求用户经常双击它。

我当前的解决方案确实适用于该`SelectionChange`事件，但它似乎需要使用全局变量和其他次优的编码实践。它似乎也容易出错。

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-10-08T07:38:39.023

显然，没有完美的答案。但是，如果您想允许用户

1.  选择某些单元格
2.  允许他们更改这些单元格，并且
3.  捕获每次点击，甚至重复点击同一个单元格，

那么最简单的方法似乎是将焦点从所选单元格上移开，以便单击它会触发 Select 事件。

一种选择是按照我上面的建议移动焦点，但这会阻止单元格编辑。另一种选择是将选择范围扩大一个单元格（左/右/上/下），因为这允许编辑原始单元格，但如果再次单击该单元格会触发 Select 事件。

如果您只想捕获选择单列单元格，您可以在右侧插入一个隐藏列，扩展选择以在用户单击时将隐藏单元格包含在右侧，这将为您提供一个可编辑的单元格，可以每次点击它都会被困住。代码如下

```
Private Sub Worksheet_SelectionChange(ByVal Target As Range)
  'prevent Select event triggering again when we extend the selection below
  Application.EnableEvents = False
  Target.Resize(1, 2).Select
  Application.EnableEvents = True
End Sub 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-07T22:27:19.150

为了捕获对同一单元格的重复点击，您需要将焦点移动到不同的单元格，这样每次点击时，您实际上是在移动选择。

当您单击任何单元格时，下面的代码将选择屏幕上可见的左上角单元格。显然，它的缺陷是它不会捕获对左上角单元格的点击，但可以对其进行管理（例如，如果活动单元格位于左上角，则通过选择右上角单元格）。

```
Private Sub Worksheet_SelectionChange(ByVal Target As Range)
  'put your code here to process the selection, then..
  ActiveWindow.VisibleRange.Cells(1, 1).Select
End Sub 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-07T18:26:55.393

SelectionChange 是为此内置在 Excel 对象模型中的事件。它应该完全按照您的意愿行事，只要用户在任何地方点击就触发......

我不确定我是否理解您在这里对全局变量的反对意见，如果您使用 Application.SelectionChange 事件，您只需要 1 即可。但是，如果您使用后面的 Workbook 类代码（捕获 Workbook.SelectionChange 事件）或后面的 Worksheet 类代码（捕获 Worksheet.SelectionChange）事件，则不需要任何代码。（除非您的问题是 VBA 中的“全局变量重置”问题，否则只有一个解决方案：处处错误处理。不允许任何未处理的错误，而是将它们记录下来和/或将错误“软报告”为消息框给用户。）

您可能还需要捕获 Worksheet.Activate() 和 Worksheet.Deactivate() 事件（或 Workbook 类中的等效事件）和/或 Workbook.Activate 和 Workbook.Deactivate() 事件，以便您知道用户何时拥有切换工作表和/或工作簿。Window activate 和 deactivate 事件应该使这种方法完成。它们都可以调用相同的确切过程，但是，它们都表示相同的东西：用户更改了“焦点”，如果您愿意的话。

如果您不喜欢 VBA，顺便说一句，您可以使用 VB.NET 或 C# 来做同样的事情。

*[编辑：当用户在当前选定的单元格中单击时，Dbb 对 SelectionChange 事件没有进行单击提出了很好的观点。如果你需要选择它，那么你需要使用子类化。]*

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-07T14:42:03.367

我不这么认为。但是您可以创建一个形状对象（或艺术字或类似的东西）挂钩单击事件并将对象放置到指定单元格的位置。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-13T21:25:28.527

这对我有用......

```
Private Sub Worksheet_Change(ByVal Target As Range)

    If Mid(Target.Address, 3, 1) = "$" And Mid(Target.Address, 2, 1) < "E" Then
       ' The logic in the if condition will filter for a specific cell or block of cells
       Application.ScreenUpdating = False
       'MsgBox "You just changed " & Target.Address

       'all conditions are true .... DO THE FUNCTION NEEDED 
       Application.ScreenUpdating = True
    End If
    ' if clicked cell is not in the range then do nothing (if condttion is not run)  
End Sub 
```

注意：在实际使用中，如果用户在 A4 到 D500 的数据范围内添加了一个项目，此函数会重新计算数据透视表。工作表中有受保护和不受保护的部分，因此实际的点击检查是列是否小于“E” 逻辑可以变得像您想要包含或排除任意数量的区域一样复杂

```
block1  = row > 3 and row < 5 and column column >"b" and < "d" 
block2  = row > 7 and row < 12 and column column >"b" and < "d" 
block3  = row > 10 and row < 15 and column column >"e" and < "g"

If block1 or block2 or block 3 then
  do function .....
end if 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2018-05-25T12:12:45.907

我有一个类似的问题，我通过运行宏“onTime”来修复，并使用一些全局变量只在用户停止点击后运行。

```
Public macroIsOnQueue As Boolean
Private Sub Worksheet_SelectionChange(ByVal Target As Range)
    macroIsOnQueue = False
    Application.OnTime (Now() + TimeValue("00:00:02")), "addBordersOnRow"
    macroIsOnQueue = True
End sub
Sub addBordersOnRow()
    If macroIsOnQueue Then        
       macroIsOnQueue = False
       ' add code here
    End if
End sub 
```

这样，每当用户在 2 秒内更改选择时，macroIsOnQueue 变量都会设置为 false，但最后一次更改选择时，macroIsOnQueue 设置为 true，并且宏将运行。

希望这会有所帮助，玩得开心 VBA ！

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2020-04-23T01:22:31.850

只是 dbb 已接受答案的后续行动：与其在选择的右侧添加直接单元格，不如选择远离工作范围的单元格（即您知道用户永远不需要的虚拟单元格）。在以下代码单元`ZZ1`中是虚拟单元

```
Private Sub Worksheet_SelectionChange(ByVal Target As Range)
  Application.EnableEvents = False
  Union(Target, Me.Range("ZZ1")).Select
  Application.EnableEvents = True

  ' Respond to click/selection-change here

End Sub 
```

# c# - 编译器无法在接口和异常之间选择重载

> ID：178740
> 
> 赞同：1
> 
> 时间：2008-10-07T14:34:53.740
> 
> 标签：c#, .net, compiler-construction

尝试使用可以为 XML 解析提供位置参考的 excpetion 类，发现了一个有趣的行为 - 当我尝试将 XmlReader 作为参数传递时，编译器无法在使用接口的重载和需要 System.Exception 的重载之间进行选择。

详情如下：

```
//exception overloads:
public FilterXmlParseException(string message, Exception innerException)
        : base(message, innerException) { }
public FilterXmlParseException(string message, IXmlLineInfo lineInfo) {...}

//Usage:
XmlReader reader = ...
IXmlLineInfo lineinfo = (IXmlLineInfo)reader;

//fails
throw new FilterXmlParseException("<Filter> element expected", reader);

//ok
throw new FilterXmlParseException("<Filter> element expected", lineinfo); 
```

它失败了，因为它无法选择正确的重载。但是为什么呢？我们看到 XmlReader 支持一个接口并且它不是从 System.Exception 继承的

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-07T14:39:41.357

该行：

```
//fails
throw new FilterXmlParseException("<Filter> element expected", reader); 
```

因为 XmlReader 没有实现 IXmlLineInfo。我不确定你的演员表是否有效，但演员表不是静态检查的。如果它真的有效，那是因为具体类（继承自 XmlReader）实现了这个接口，而编译器却无从得知。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-07T14:41:22.727

它无法为 XmlReader 调用选择重载，因为*这两种*重载都不可接受。XmlReader 不继承自 Exception，所以第一次调用无效。XmlReader 也不实现 IXmlLineInfo。

它在第二种情况下起作用的原因是你在强迫演员。但是，我相信如果您要实际运行该代码，它会抛出 InvalidCastException。阅读有关 XmlReader 的文档，您会发现它实现的唯一接口是 IDispoable。

[http://msdn.microsoft.com/en-us/library/system.xml.xmlreader.aspx](http://msdn.microsoft.com/en-us/library/system.xml.xmlreader.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-07T14:42:43.677

看起来是实现 IXmlLineInfo 的 XmlTextReader，而不是 XmlReader

[http://msdn.microsoft.com/en-us/library/system.xml.ixmllineinfo(VS.71).aspx](http://msdn.microsoft.com/en-us/library/system.xml.ixmllineinfo(VS.71).aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-07T14:45:22.563

您遗漏了关键部分：

```
XmlReader reader = XmlTextReader.Create(sreader, readerSettings); 
```

您调用一个返回 的方法`XmlTextReader`，但变量的类型是`XmlReader`。

转换发生在运行时，因此`reader`可以将运行时值转换为`IXmlLineInfo`，因为`XmlTextReader`支持该接口，即使`XmlReader`不支持。

重载解决虽然发生在编译时，所以因为`XmlReader`不支持`IXmlLineInfo`，它不能与签名匹配。

您可以通过以下方式修复它：

```
XmlTextReader reader = (XmlTextReader)XmlTextReader.Create(sreader, readerSettings); 
```

请注意，您需要强制转换，因为返回类型`Create`是`XmlReader`，即使它实际上返回 a `XmlTextReader`。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-07T14:50:11.523

感谢您的回答。

我知道基类没有实现 IXmlLineInfo。

但实际上我是在使用 XmlTextReader.Create 来获取实际阅读器的实例。

所以我想实际的解决方案是使用 XmlTextReader 构造函数而不是工厂方法来防止这种混淆

# .net - 获取包含 chr(0) 的字符串的整个输出

> ID：178751
> 
> 赞同：0
> 
> 时间：2008-10-07T14:36:55.840
> 
> 标签：.net, vb.net

这是示例：

```
 Dim TestString As String = "Hello," & Chr(0) & "World"
    MsgBox(TestString, , "TestString.Length=" & TestString.Length.ToString) 
```

结果 - 消息框显示“Hello”，标题为 TestString.Length=12

我猜 chr(0) 被视为零终止字符串的结尾，但这不是我想要的。

使用 Chr(0) 的正确方法是什么？

* * *

我也在 asp.net 中尝试过，但无济于事。我正在通过套接字发送字符串。我的问题是，当我调试它时，整个字符串并没有加起来。我需要给他们发送一个相当大的字符串。消息窗口上真正出现的内容并不困扰我。我用上面的例子。我只需要将多个变量正确添加到字符串中。另一个例子是

```
"SCORE".ToString.PadRight(8, chr(0)) & "3.0".ToString.PadRight(10, chr(0)) & "0".ToString.PadRight(1, "0") 
```

预期值将得分 3.00

我得到的是 score3.0

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-07T14:42:24.440

您绝对正确，将 Chr(0) 视为控制字符，表示“这是该字符串的结尾”。你希望这个角色如何表现？空间？换行？您只需要完整地打印字符串，还是关于字符串还有其他重要的事情？

我只是打电话`TestString.Replace(chr(0), " ")`或 VB.NET 中的任何等价物

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-07T14:48:26.393

我认为问题不在于 vb 字符串，正如您的长度输出所证明的那样。我认为可能仍然使用将 char(0) 视为终止符的 windows api 的 MsgBox 函数。

如果您的调试或其他内容想要表示存在 char(0)，则应将其替换为您理解代表 char(0) 的可打印字符集。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-07T14:58:30.087

MsgBox 最有可能使用 Windows API 函数[MessageBox](http://msdn.microsoft.com/en-us/library/ms645505(VS.85).aspx)，它使用以空字符结尾的字符串，因此只会显示第一个空字符。大多数 Windows api 都使用空终止字符串（如果不是全部？），因此您可能必须找到一种不同的方式来显示字符串。

您的调试工具（例如visual studio）也可能将字符串视为空终止，它只会显示到第一个空（但是我不确定这一点，并且目前不在我可以在vs08上测试它的计算机上）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-07T15:07:10.630

提问者示例中的示例代码（“SCORE”.ToString ...）在控制台应用程序中对我来说很好。VS2005 调试器没有正确显示字符串，但它输出到控制台就好了。所以，我的感觉是要么你认为它不正确，因为调试器错误地这样说，要么你的输出字符串不够长，无法包含所有填充。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-07T14:41:37.313

chr(0) 为空。你是在一个空格 chr(32) 之后还是只输入 vblf 或在 Enter(Return) chr(13) 之后输入 vbcrlf

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-07T14:41:39.420

实际上 Chr(0) 用于终止字符串，如果您想要换行符，您可以使用 VB.NET 中的 Environment.NewLine() 或 VB6 中的 vbNewLine

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-07T14:49:58.747

似乎 VB 正确处理了字符串，因为它知道正确的长度（12），所以问题出在你显示字符串的时候。您可以在要显示时将 chr(0) 替换为空格吗？

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-07T17:39:47.330

看看[Jon Skeet](http://www.yoda.arachsys.com/csharp/strings.html)关于字符串的文章。似乎 TestString 将包含所有字符，包括嵌入的 \0，但显示不正确。这篇文章包括一个正确显示字符串的函数（在 c# 中）。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2021-04-09T12:00:19.740

在过程声明中使用*MarshalAs*属性，返回包含 chr(0) 的字符串，如下所示

```
<DllImport("my.dll", ... )> _
Sub modifyStr(<MarshalAs(UnmanagedType.BStr)> ByRef stringContainingNullChars as String) 
```

# java - 使用 AllegroGraph RDF 存储的对象到三元组映射？

> ID：178752
> 
> 赞同：0
> 
> 时间：2008-10-07T14:37:18.647
> 
> 标签：java, rdf, sparql, allegrograph

我的项目是在 AllegroGraph RDF 存储之上构建一个 Java Web 应用程序。我想找到一个很好的解决方案来映射来自商店的三元组和我们的域对象。我研究了[Topaz](http://www.topazproject.org/trac/)，这是一个以 Hibernate 精神开发的对象/三重映射 API。问题是他们目前没有连接到 AllegroGraph 的连接器。

鉴于有限的 API 支持，有没有人想出一个好的 Java 对象/三元映射方案？使这个问题变得更加困难的一个问题是，与 SQL 不同，SPARQL 标准仅支持读取操作，因此写入是通过 RDF 存储的专有 API 完成的，我真的很想在我们的应用程序中抽象出这些细节。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-20T18:37:59.173

对于一般的 OO-RDF 映射，您可能想看看：

*   OpenRDF Elmo [http://www.openrdf.org/](http://www.openrdf.org/)（仅适用于 sesame，但设计为可扩展并扩展 sesame 以在 allegrograph 之上工作（查看风帆（存储和推理层）架构）
*   Sommer [https://sommer.dev.java.net/](https://sommer.dev.java.net/)这里有一些关于它是如何工作的解释[http://blogs.oracle.com/bblfish/](http://blogs.oracle.com/bblfish/)
*   还有 RDFReactor [http://semanticweb.org/wiki/RDFReactor](http://semanticweb.org/wiki/RDFReactor)，它在 RDF2go 之上工作。RDF2go 是一个抽象层，具有 jena 或 sesame 的实现。同样没有关于 AllegroGraph 的内容，因此您需要绑定的实现。

我不知道 RDFReactor 但我知道 sommer 和 elmo 都基于 POJO 的注释，并允许通过直接基于三元组的 API 或使用 SPARQL 的查询进行更新。

至于 AllegroGraph 本身，我不知道有什么具体的，但它们似乎支持 Sesame 并与之交互，所以你也许可以这样工作。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-07T15:01:48.443

我喜欢[redland RDF 库](http://librdf.org/)。RDF 解析、存储、SPARQL/RDQL 查询，相当完整，但模块化程度足以只使用您想要的。他们有 Java 绑定，但我只使用了 C API（并且还写了一个（部分）Lua 绑定）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-10-25T12:51:53.027

> 使这个问题变得更加困难的一个问题是，与 SQL 不同，SPARQL 标准仅支持读取操作，因此写入是通过 RDF 存储的专有 API 完成的，我真的很想在我们的 application.details 中抽象出这些细节应用。

AllegroGraph 支持开源 Jena API，您可以通过它执行写操作。这个很酷; 有用。也许这对于您的目的来说已经足够抽象了。

# asp.net - 如何调试尖峰 ASP.NET 进程的内存转储？

> ID：178762
> 
> 赞同：4
> 
> 时间：2008-10-07T14:38:49.190
> 
> 标签：asp.net, .net, debugging, windbg

抱歉，我想不出一个很好的方式来表达我的真正问题。

我在 64 位机器上运行一个高流量的 ASP.NET 站点。但是，由于应用程序的一些遗留组件，我有 IIS 在 32 位模式下运行。我正在一个应用程序池中运行这个特定的 Web 应用程序，该应用程序池启用了 Web Garden 选项（在 8 核机器内运行 6 个进程）。

每周一到两次，其中一个进程将飙升至 100% 的 CPU 利用率，从而导致站点的速度大幅下降，所以我的计划是等到这种情况发生，内存转储有问题的进程，然后在 WinDbg 周围戳到零用于查看代码在哪里旋转的线程。

我之前使用 WinDbg 进行过调试，以找出导致网站死锁的原因，但那是几个月前的事了，我不记得我是如何让它工作的。（作为旁注，这是记录您所做的一切的课程。）

我在运行该站点的 Windows 2003 服务器上运行 WinDbg，以防止任何 DLL 版本问题。到目前为止，这是我的步骤，请让我知道我哪里出错了，以获取我收到的错误消息。

1.  我首先使用 UserDump 使用以下命令对尖峰进程进行内存转储，其中 3389 是进程的 ID：

    `userdump -k 3389`

2.  我将转储加载到 WinDbg 的 x86 版本中。

3.  由于我在 64 位机器上运行 32 位，我首先加载内存转储，然后：

    `.load wow64exts`

    `.effmach x86`

4.  我确保我的符号路径包含包含我的应用程序 PDB 文件的目录：

    `.sympath+ c:\inetpub\myapp\bin`

5.  仅运行 `.load SOS' 失败，并出现“系统找不到指定的文件”错误，所以我采用以下完全合格的路线，该路线有效：

    `.load c:\windows\microsoft.net\framework\v2.0.50727\sos`

从这里开始，我迷路了。我尝试了任何 SOS 命令，例如`!threads`，只是为了得到这个错误：

```
Failed to load data access DLL, 0x80004005 
```

该错误还伴随着我应该验证的项目编号列表。我已经验证我正在运行最新版本的调试器，mscordacwks.dll 实际上与 mscorwks.dll 文件位于同一目录中，并且我在与转储文件相同的架构上进行调试。

我也运行了神奇的“ `.cordll -ve -u -l`”命令，但这并不能解决任何问题。`CLR DLL status: No load attempts`当我执行那个时，我总是用“”打招呼。然后我尝试“ `.reload`”，它会产生一些像“ `WARNING: wldap32 overlaps dnsapi`”这样的警告。我*希望*它说类似“ `CLRDLL: Loaded DLL C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\mscordacwks.dll`”。但事实并非如此。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-07T14:45:08.960

在运行 sos 命令之前尝试执行 !sw。请参阅此[博客文章](http://blogs.msdn.com/alejacma/archive/2008/07/18/How-to-use-Windbg-to-debug-a-dump-of-a-32bit-.NET-app-running-on-a-x64-machine.aspx)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-07T14:41:29.153

*   [(MSDN) 如何：使用 CLR Profiler](http://msdn.microsoft.com/en-us/library/ms979205.aspx)
*   [（MSDN 杂志）调查内存问题](http://msdn.microsoft.com/en-us/magazine/cc163528.aspx)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-07T15:18:20.047

根据我的经验，应用程序池激增可能是因为它被回收了。您是否尝试过 IIS 崩溃/挂起代理和 IIS 转储？

[http://www.microsoft.com/downloads/details.aspx?FamilyID=01c4f89d-cc68-42ba-98d2-0c580437efcf&DisplayLang=en](http://www.microsoft.com/downloads/details.aspx?FamilyID=01c4f89d-cc68-42ba-98d2-0c580437efcf&DisplayLang=en)

它们还包括一个转储文件分析器，它将告诉您内存泄漏，甚至建议您的代码需要修复的区域（完整的链接到适用的 MSKB 文章！）

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-30T12:52:32.540

伙计 - 不确定这是否有帮助，但也许试试这个。

1.  将 c:\windows\microsoft.net\framework\v2.0.50727\sos.dll 复制到安装 windbg 的同一目录（例如 c:\program files\Debugging Tools for Windows\ ）。为什么？轻松加载sos文件
2.  运行windbg
3.  加载内存转储文件。对我来说，我使用 ctrl-D 或 File -> open crash dump
4.  .load sos <-- 注意加载命令之前的句号
5.  .symfix c:\temp\debug_symbols
6.  .reload

好的..注意命令行。这告诉我转储所在的当前线程。这对于高 CPU 场景可能没用..因为我们可以在任何线程中。

所以从这里我查看正在运行的线程并检查*最繁忙*的线程

8 !threadpool <-- 这样我就可以看到 cpu 利用率来检查我们是否处于垃圾（忙碌）状态......例如 100% cpu 或其他什么。

9 !runaway <--列出最长的线程...例如。

```
0:027 !runaway
User Mode Time
Thread       Time
18:704       0 days 0:00:17.843   <-- Thread #18
19:9f4       0 days 0:00:13.328   <-- Thread #19
16:1948      0 days 0:00:10.718
26:a7c       0 days 0:00:01.375
24:114       0 days 0:00:01.093
27:d54       0 days 0:00:00.390
28:1b70      0 days 0:00:00.328
0:b7c       0 days 0:00:00.171
25:3f8       0 days 0:00:00.000
23:1968      0 days 0:00:00.000 
```

线程 18 和 19 已经挂了一段时间了.. 嗯.... 他们卡在一个循环中了吗？

10.  ~18s <--转到线程 18。
11.  !clrstack <-- clr call stack .. 就像在windows中调试一样。

..从这里你可以通过提供地址引用和东西来转储对象和东西。

查看 !help 列出一些可以尝试使用的命令 .. 我认为 !help.sos 也可以吗？

HTH ..如果你仍然被卡住，问问什么有效，什么无效。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-08-05T23:01:56.810

我只需要处理一个类似的问题。就我而言，事实证明 WinDbg 无法找到正确版本的 mscorwks.dll。除了框架版本之外，还有一个 DLL 的修订版，它可以在相同的框架版本之间有所不同。

理论上，Microsoft 符号服务器应该能够提供必要的 DLL，但对我来说并没有发生。为了解决这个问题，我曾经`!sym noisy`获取有关符号加载的更多信息。当我这样做时`!dumpstack`，我收到了错误消息：

`SYMSRV: http://msdl.microsoft.com/download/symbols/mscorwks.dll/492B82C1590000/mscorwks.dll not found`

为了解决这个问题，我在本地符号缓存中创建了适当的文件夹，并从转储所在的机器上复制了 mscorwks.dll。之后`.reload`，WinDbg 在本地符号缓存中找到了需要的 DLL，然后愉快地继续。

或者，您可以找到与`lm v m mscorwks`. [然后，您可以从此列表](https://docs.microsoft.com/en-us/archive/blogs/dougste/version-history-of-the-clr-2-0)中找到包含您需要的版本的更新。您需要从特定更新中提取必要的 DLL 到正确的位置。

# .net - 什么是跟踪，应该如何进行？

> ID：178772
> 
> 赞同：3
> 
> 时间：2008-10-07T14:40:43.477
> 
> 标签：.net, log4net, trace

什么是跟踪，应该如何进行？

我在我的项目中包含了一个通用实用程序库，我希望能够从中获得一些输出。我一直在使用 log4net，但我不想让我的常用实用程序库依赖于 log4net。那有意义吗？

编辑：日志记录和跟踪之间是否存在关联？出于某种原因，我是否想将跟踪和登录放到同一个流中？

我是否应该用 System.Diagnostics.Trace.WriteLine(..)s 替换我项目中的一些 log4net Logger.Debug(..)？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-07T14:44:01.380

以下是 .NET BCL 团队的 Mike Rousos 的一些博客文章：

*   [Tracing Primer - Part I](http://blogs.msdn.com/bclteam/archive/2005/03/15/396431.aspx) - 是对追踪 API 的简单介绍。
*   [A Tracing Primer – Part II (A)](http://blogs.msdn.com/bclteam/archive/2005/09/21/472015.aspx)  – 主要讨论过滤事件
*   [A Tracing Primer – Part II (B)](http://blogs.msdn.com/bclteam/archive/2005/09/21/472021.aspx)  – 讨论开发自定义跟踪侦听器（将跟踪事件引导到您想要的任何地方的插件）。
*   [A Tracing Primer – Part II (C)](http://blogs.msdn.com/bclteam/archive/2005/09/21/472049.aspx) – 讨论如何解释配置文件。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-07T15:01:08.100

在您的所有项目和库中使用 log4net 不仅更容易（更好地阅读）吗？通过这种方式，项目可以指定他们想要如何记录内容，而您的公共库的日志记录将只听该项目。

如果您有一个用于公共库的自定义记录器，那么您最终会在一个地方拥有公共日志，而在另一个地方拥有应用程序（项目）日志。

例如，您可以查看 NHibernate 或 Castle ActiveRecord。这两个都可以被视为“通用实用程序”（它们正在执行您的数据访问）。他们都使用 log4net。因此，通过在您的项目中使用它们，并使用 log4net 作为您的项目记录器，您可以指定将所有日志记录数据集中到一个位置。

如果您愿意，您甚至可以以不同的方式设置不同的记录器。以便在 INFO 级别记录您的常见日志，并在 ERROR 记录您的项目日志。

* * *

我刚刚发现另一个关于跟踪 VS 日志记录的问题，它似乎很深入。看看它。也许它会有所帮助。[跟踪与日志记录以及 log4net 如何适应？](https://stackoverflow.com/questions/172372/tracing-versus-logging-and-how-does-log4net-fit-in)

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-10-07T15:12:54.363

我同意 FryHard，或者使用您的自定义类更好地扩展 log4net。

# sql - 我是否需要设置 Kerberos 才能在 SQL Server 2005 中使用复制？

> ID：178797
> 
> 赞同：0
> 
> 时间：2008-10-07T14:45:18.147
> 
> 标签：sql, sql-server, replication, kerberos

我想在三台 SQL 服务器上设置复制，其中一台没有为 Kerberos 配置。（SPN 尚未设置）

我是否需要 Kerberos 和传递委派才能在 SQL Server 2005 中使用复制？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-07T14:52:43.827

不可以。但是您需要复制代理在具有相关权限的帐户上下文中运行。[请参阅此处](http://msdn.microsoft.com/en-us/library/ms151868.aspx)的MSDN 。

# diagram - 以图形方式表示页面流的最佳方式是什么，适用于面向操作的 Web 应用程序？

> ID：178806
> 
> 赞同：10
> 
> 时间：2008-10-07T14:47:29.440
> 
> 标签：diagram, modeling, page-flow

以图形方式表示页面流的最佳方式是什么，适用于面向操作的 Web 应用程序？

您使用什么模型来表示包含页面（视图）的页面流（页面流程图）、对这些视图（事件）和流程的用户操作？

这些图表应作为理解业务领域专家（例如指定电子商务网站的人）、技术分析师（负责设计 Web 应用程序的人）和 Web 开发人员（负责实施解决方案的人）之间的起点)

我不是在寻找一个软件解决方案来帮助我绘制这些图表，我也不是在寻找一个 Web 流框架来让我在软件中实现这些页面流。

但是，我正在寻找一个使用铅笔和纸绘制页面流程的好方案

例如，一个好的答案可能如下

*   带有大写字母标签的矩形代表页面
*   带有小写标签的箭头表示用户操作
*   带有大写字母标签的钻石代表一个过程
*   入口点始终从左侧（箭头从左侧进入页面）
*   退出点始终从右侧（箭头从右侧走出页面）

如果有一个公认的标准，或者如果这个问题空间实际上是一个存在标准的更大问题空间的特定情况，请强调这一点。

本着 Stack Overflow 的精神，请每个答案一个方案，并投票而不是重复

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-10-07T15:01:32.297

我一直很喜欢[Jesse James Garret 的](http://www.jjg.net/ia/visvocab/)视觉语言。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-12T01:38:41.637

查看 nAML（.NET 应用程序建模语言）。它包括一个 Visio 模板，非常有趣且富有表现力。

[http://code.msdn.microsoft.com/naml](http://code.msdn.microsoft.com/naml)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-17T14:05:30.380

我发现修改状态图对这个目的最有用。我将可视资源（html 或 jsp 页面）表示为一种状态，并且转换是用户可以在该页面上执行的操作。

然后我为视觉页面之间的动作引入另一个符号。

状态图对于非技术人员来说很容易理解并且足够表达以捕捉一些复杂的交互。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-09-25T14:37:58.817

看看 yuml.me，因为它很容易使用并生成漂亮的“邋遢”图表

# c# - 为什么这个 JavaScript 不显示确认框？

> ID：178809
> 
> 赞同：1
> 
> 时间：2008-10-07T14:48:13.603
> 
> 标签：c#, .net, asp.net, javascript

我正在尝试修复我继承的产品中的一些错误，并且我有这段 javascript 应该突出显示几个框并弹出一个确认框。目前发生的情况是我看到这些框改变了颜色并且有 5 秒左右的延迟，然后就好像丢失的确认只是接受了自己。有没有比我更聪明的人看到这段代码有什么问题？

```
function lastCheckInv() {

    document.getElementById("ctl00$ContentPlaceHolderMain$INDet$txtInvNumber").style.background = "yellow";
    document.getElementById("ctl00$ContentPlaceHolderMain$INDet$txtInvNumber").focus();
    document.getElementById("ctl00_ContentPlaceHolderMain_INDet_AddCharges").style.background = "yellow";
    document.getElementById("ctl00_ContentPlaceHolderMain_INDet_lblFreight").style.background = "yellow";
    bRetVal = confirm("Are you sure the information associated with this invoice is correct?");

    return bRetVal;

} 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-07T14:50:52.740

我能想到的唯一一件事是，如果确认之前的其中一行抛出异常，而您实际上永远不会到达确认。

如果您使用的是 IE，请确保已启用脚本调试。如果您使用的是 Firefox，请安装 Firebug 插件并为您的网站启用它。

或者，对于非常原始的调试，只需在每个语句之后放置警报并找出它在哪里轰炸。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-07T14:55:18.517

您应该使用以下方法从 JavaScript 引用您的控件：

```
document.getElementById(<%= txtInvNumber.ClientID %>).style.background = "yellow" 
```

如果这没有帮助，请尝试在 JavaScript 中设置断点并单步执行以查看失败的位置。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-07T15:18:20.470

这个测试脚本在 IE、Firefox 和 Opera 中运行良好。因此，您的基本语法似乎没有任何问题。问题出在 ID 中（这与它在 5 秒后确认的行为不相符）或页面上其他一些冲突的 JavaScript 中。如果不查看更多页面，将很难为您提供帮助。

```
<script language="javascript">
function lastCheckInv() {

    document.getElementById("test1").style.background = "yellow";
    document.getElementById("test1").focus();
    document.getElementById("test2").style.background = "yellow";
    document.getElementById("test3").style.background = "yellow";
    bRetVal = confirm("Are you sure?");

    return bRetVal;

}
</script>

<form method="get" onsubmit="return lastCheckInv();">
    <input id="test1" name="test1" value="Hello">
    <input id="test2" name="test2" value="Hi">
    <input id="test3" name="test3" value="Bye">
    <input type="submit" name="Save" value="Save">
</form> 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-07T14:52:26.310

一些想法：可能是`.focus()`电话将您的确认隐藏在页面后面吗？或者可能是您的控制 ID 之一不正确导致`.style.background`引用失败？

1.  你应该在显示确认框*后*设置焦点，否则确认框会抢走焦点，使该行毫无意义。
2.  不要像那样对 ASP.Net id 进行硬编码。虽然它们通常是一致的，但 ASP.net 的未来版本不能保证相同的方案，这意味着您在将来某个时候更新此代码时会让自己感到痛苦。使用控件的服务器端 .ClientID 属性将这些值作为可以引用的变量写入 javascript。

更新：
根据您对另一个回复的评论，如果函数返回 true，此代码将导致回发。`.focus()`在这种情况下，除非您要返回 false，否则运行这条线根本没有意义。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-27T17:06:39.643

```
function lastCheckInv()

{    
   document.getElementById("ctl00_ContentPlaceHolderMain_INDet_txtInvNumber").style.background = "yellow";    
   document.getElementById("ctl00_ContentPlaceHolderMain_INDet_txtInvNumber").focus();    
   document.getElementById("ctl00_ContentPlaceHolderMain_INDet_AddCharges").style.background = "yellow";    
   document.getElementById("ctl00_ContentPlaceHolderMain_INDet_lblFreight").style.background = "yellow";    
   return confirm("Are you sure the information associated with this invoice is correct?");    
} 
```

您的函数中的前两行是错误的，$ 在 ASP.Net 控件的 UniqueID 中。

在客户端，您必须使用 ClientID，将 $ 替换为 _ 。

如果您确定控件存在，则上面的代码可能会起作用。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-07T15:47:09.910

I do not like accesing objects directly by

```
document.getElementById("ctl00_ContentPlaceHolderMain_INDet_lblFreight").style.background = "yellow"; 
```

If the object is not returned JavaScript will error out. I prefer the method of

```
var obj = document.getElementById("ctl00_ContentPlaceHolderMain_INDet_lblFreight");

if(obj)
{
    obj.style.background = "yellow";
} 
```

My guess is you are trying to access an object that is not on the DOM, so it never gets to the confirm call.

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-08T01:14:00.483

bRetVal 实际上是在任何地方声明的吗？

如果不是，“ *var bRetVal = confirm* ....”是告诉 jscript 它是一个变量的友好方式。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-07T16:42:54.387

检查元素是否确实存在可能是值得的。另外，尝试将焦点延迟到确认（）之后：

```
function lastCheckInv() {

    var myObjs,bRetVal;

    myObjs=[
        "ctl00_ContentPlaceHolderMain_INDet_AddCharges",
        "ctl00_ContentPlaceHolderMain_INDet_lblFreight",
        "ctl00$ContentPlaceHolderMain$INDet$txtInvNumber"
    ];

    bRetVal = confirm("Are you sure the information associated with this invoice is correct?");

    for (var i=0, j=myObjs.length, myElement; i<j; i++){

        myElement=document.getElementById(myObjs[i]);

        if (!myElement){
        // this element is missing
        continue;
        }

        else {

        // apply colour
        myElement.style.background = "yellow";

       // focus the last object in the array

            if (i == (j-1) ){
            myObj.focus();
            }

        }

    }

    return bRetVal;

} 
```

# c# - 使用显式接口来确保针对接口进行编程

> ID：178821
> 
> 赞同：8
> 
> 时间：2008-10-07T14:51:12.020
> 
> 标签：c#, design-patterns, interface

我已经看到了使用显式接口作为将类使用锁定到该接口的方法的论点。争论似乎是，通过强制其他人对接口进行编程，您可以确保更好地解耦类并允许更轻松的测试。

例子：

```
public interface ICut
{
    void Cut();
}
public class Knife : ICut
{
    void ICut.Cut()
    {
        //Cut Something
    }
} 
```

并使用 Knife 对象：

```
ICut obj = new Knife();
obj.Cut(); 
```

你会推荐这种接口实现方法吗？为什么或者为什么不？

编辑：另外，鉴于我使用的是显式接口，以下内容将不起作用。

```
Knife obj = new Knife();
obj.Cut(); 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-07T15:02:00.097

引用 GoF 第 1 章：

*   “编程到接口，而不是实现”。
*   “优先于类继承的对象组合”。

由于 C# 没有多重继承，因此对象组合和接口编程是要走的路。

ETA：无论如何你都不应该使用多重继承，但这完全是另一个话题.. :-)

ETA2：我不太确定显式接口。这似乎没有建设性。如果实例化为 ICut，为什么我想要一个只能 Cut() 的刀？

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-07T15:21:15.953

我只在我想限制对某些方法的访问的情况下使用它。

```
public interface IWriter
{
    void Write(string message);
}

public interface IReader
{
    string Read();
}

public class MessageLog : IReader, IWriter
{
      public string Read()
      {
           // Implementation

          return "";
      }

      void IWriter.Write(string message)
      {
           // Implementation
      }
}

public class Foo
{
    readonly MessageLog _messageLog;
    IWriter _messageWriter;

    public Foo()
    {
         _messageLog = new MessageLog();
         _messageWriter = _messageLog;
    }

    public IReader Messages
    {
        get { return _messageLog; }
    }
} 
```

现在 Foo 可以使用 _messageWriter 将消息写入它的消息日志，但客户端只能读取。这在您的类是 ComVisible 的情况下特别有用。您的客户端无法转换为 Writer 类型并更改消息日志中的信息。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-07T14:57:48.717

是的。而不仅仅是为了测试。将常见行为分解为接口（或抽象类）是有意义的；这样你就可以利用多态性。

```
public class Sword: ICut
{    
  void ICut.Cut()   
  {        
     //Cut Something   
  }
} 
```

工厂可以退回一种锋利的工具！：

```
ICut obj = SharpImplementFactory();

obj.Cut(); 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-24T17:57:47.727

这是一个坏主意，因为它们的使用破坏了多态性。使用的引用类型不应改变对象的行为。如果要确保松散耦合，请将类设为内部并使用 DI 技术（例如 Spring.Net）。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-26T14:18:29.860

毫无疑问，强制您的代码用户将您的对象转换为您希望他们使用的接口类型具有某些优势。

但是，总的来说，对接口进行编程是一个方法或过程问题。仅仅通过使您的代码对用户感到厌烦，并不能实现对接口的编程。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-07T14:54:57.333

那么有一个组织优势。您可以将您的 ICuttingSurface、ICut 和相关功能封装到一个独立且可单元测试的程序集中。ICut 接口的任何实现都很容易 Mockable，并且可以只依赖于 ICut 接口而不是实际的实现，这使得系统更加模块化和干净。

这也有助于使继承更加简化，并为您提供更多使用多态的灵活性。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-07T14:57:57.093

在这种方法中使用接口本身并不会导致代码解耦。如果这就是你所做的一切，它只会增加另一层混淆，并且可能会在以后使这更加混乱。

但是，如果您将基于接口的编程与控制反转和依赖注入相结合，那么您真的会有所收获。如果您从事测试驱动开发，您还可以通过这种类型的设置使用模拟对象进行单元测试。

然而，IOC、DI 和 TDD 本身都是主要主题，并且针对这些主题中的每一个都编写了整本书。希望这会给你一个可以研究的东西的起点。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-24T17:43:33.123

只允许期望显式接口类型的调用者确保方法仅在需要它们的上下文中可见。

考虑游戏中的一个逻辑实体，您决定代替负责绘制/勾选实体的类，您希望勾选/绘制代码在实体中。

实现 IDrawable.draw() 和 ITickable.tick() 确保实体只能在游戏期望的时候被绘制/勾选。否则这些方法将永远不可见。

较小的好处是在实现多个接口时，显式实现可以让您解决两个接口方法名称冲突的情况。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-06-12T16:57:53.750

显式实现接口的另一个潜在场景是处理已经实现了功能但使用不同方法名称的现有类。例如，如果你的 Knife 类已经有一个名为 Slice 的方法，你可以这样实现接口：

```
public class Knife : ICut
{
     public void Slice()
     {
          // slice something
     }

     void ICut.Cut()
     {
          Slice();
     }
} 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-10-07T14:54:35.820

如果客户端代码除了可以使用对象之外不关心任何`Cut()`事情，那么使用`ICut`.

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-07T14:57:41.900

是的，但不一定出于给定的原因。

一个例子：

在我当前的项目中，我们正在构建一个数据输入工具。我们有所有（或几乎所有）选项卡都使用的某些功能，并且我们正在编写一个页面（该项目是基于 Web 的）以包含所有数据输入控件。

此页面上有导航，以及与所有常见操作交互的按钮。

通过定义实现每个函数的方法的接口 (IDataEntry)，并在每个控件上实现该接口，我们可以让 aspx 页面在执行实际数据输入的用户控件上触发公共方法。

通过定义一组严格的交互方法（例如示例中的“剪切”方法），接口允许您获取一个对象（无论是业务对象、Web 控件还是您拥有的任何东西）并在定义的范围内使用它方式。

对于您的示例，您可以在任何 ICut 对象上调用 cut，无论是刀、锯、喷灯还是单丝线。

出于测试目的，我认为接口也很好。如果您根据接口的预期功能定义测试，您可以按照描述定义对象并测试它们。这是一个非常高级的测试，但它仍然可以确保功能。然而，这不应该取代单个对象方法的单元测试......如果它导致错误的东西被剪切或在错误的位置，那么知道“obj.Cut”会导致剪切是没有好处的。

# c# - 使用 WCF 时创建工厂方法的最佳方法是什么？

> ID：178822
> 
> 赞同：2
> 
> 时间：2008-10-07T14:51:20.710
> 
> 标签：c#, .net, wcf, web-services

我已经建立了一个复杂的查询机制，我想为其提供一个工厂，以帮助人们使用常见的查询模式。我的方法都通过 WCF 作为 SOAP Web 服务公开。确保我的工厂易于在所有可能希望使用我的服务的客户中使用的最佳方法是什么（因为我不希望我的所有客户都使用 .net）？

更新：我想编写一些工厂方法来帮助针对我编写的“查询系统”的常见模式。我目前从我的服务中公开了多个 OperationContracts，并且还公开了多个 DataContracts。对于构建工厂以返回我的自定义查询对象以支持我假设他们想要的常见模式的最佳方法，我有一个心理障碍。

一个具体的例子是，一种方法基于搜索请求对象返回我的数据库上的命中，该搜索请求对象具有多组多个匹配概念，我的代码将所有这些转换为 LINQ 表达式树，此搜索请求对象中的一个公共组将是将结果限制为仅来自美国的来源，这实际上是一组大约 20 个匹配项并且可以转移，因此我宁愿仅根据数据返回组对象，而不是显示硬编码的代码示例关于项目的来源，然后他们可以在他们的搜索请求对象中使用。对于像“GroupFactory.CreateGroupOfSomethingOrOther”这样的工厂方法来说，这听起来很理想，但是对我来说最好的地方是什么？还是我只是在我的脑海中让这件事变得比应该的要复杂得多？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-20T19:15:47.927

除非您以他们的母语为每个消费者提供库，否则您无法真正提供工厂。代替返回分组对象的工厂，考虑添加一些需要较少粒度配置的过滤器对象。

例如，而不是：

```
GetMatches(new GetMatchRequest() { 
        Filter = new FilterByState() { 
            "AZ", "CA", "OH", ... }}); 
```

考虑：

```
GetMatches(new GetMatchRequest() { Filter = new FilterByCountry("USA") }); 
```

所有常见的过滤器都来自类似`FilterBase`或实现的东西`IFilter`。在服务器端，调用类似`FilterBase.ConstructQueryObject()`返回更细粒度的对象。

# com - 只有在实现 COM 对象的 DLL 被签名时才创建 COM 对象？

> ID：178824
> 
> 赞同：1
> 
> 时间：2008-10-07T14:52:00.427
> 
> 标签：com, code-signing

我们有一些代码使用 LoadLibrary 和 GetProcAddress 来为我们的一个产品实现插件架构。我们确保即将加载的 DLL 使用我们的代码签名密钥进行签名。

我们正在更改插件架构以改用 COM。实例化 COM 对象时，有没有办法强制执行代码签名（最好使用我们的证书）？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-07T15:09:47.397

您需要使用 Authenticode API 在 DLL 级别执行此操作。标准 API 被称为[WinVerifyTrust()](http://msdn.microsoft.com/en-us/library/aa388208.aspx)并且那里记录了示例。还有另一个[知识库文章编号 323809](http://support.microsoft.com/kb/323809)，它提供了一个示例，说明如何从附加到 DLL 的验证码信息中剥离其他细节。

当然，这些 API 期望获得 DLL 本身的路径，而在 COM 插件场景中，您通常不会直接接触它，而是依靠注册来找到正确的二进制文件。您可以手动滚动您的加载方案（即使用 LoadLibrary() 加载 DLL 并自己调用[DllGetClassObject()](http://msdn.microsoft.com/en-us/library/ms680760(VS.85).aspx)），或者只是要求您的 API 用户遵守其他规则，例如将 DLL 放置在特定位置而不管注册。

或者像 Rob Walker 建议的那样，自己在注册表中查找 CLSID 注册，并使用它来查找正确的 DLL 进行验证。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-07T15:07:16.747

我认为您不能直接执行此操作，但您可以在注册表中查找 CLSID 使用的 DLL 并在发出 CoCreateInstance 调用之前检查其签名。

# math - 数学方程式网页控制？

> ID：178827
> 
> 赞同：1
> 
> 时间：2008-10-07T14:52:57.057
> 
> 标签：math, user-controls

是否有任何简单的 Web 应用程序或用户控件可以轻松创建数学方程式并将其存储为文本字符串？

**更新：**一个 ASP.NET 控件将是理想的。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-07T14:57:16.533

这可能是一个起点：[http ://thornahawk.unitedti.org/equationeditor/equationeditor.php](http://thornahawk.unitedti.org/equationeditor/equationeditor.php)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-07T23:01:43.247

Galwegian 的建议实际上在 PHP 中并没有多大作用，因此将其转换为 ASP.NET 控件应该不会太难。编辑器全部使用 Javascript，您当然可以从 .NET 中引用。当您单击“渲染方程式”时，PHP 代码只会接收 AJAX 请求并将它们传递给 codecogs.com 以创建实际图像。

您可以将该位移植到 .NET，或者使用[jsMath](http://www.math.union.edu/~dpvc/jsMath/examples/Henrici.html)进行渲染。这不像 LaTeX 渲染的图像那么漂亮，但由于它是 Javascript，您可以让它在您编辑时不断更新渲染的方程，而不是需要一个按钮来更新它。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-07T14:57:44.003

对此没有简短的回答，但[Wikipedia](http://en.wikipedia.org/wiki/MathML)很好地涵盖了您的选择，包括[MathML](http://en.wikipedia.org/wiki/MathML)（数学标记语言）

他们列出了一个 javascript 库[ASCIIMathML](http://www1.chapman.edu/~jipsen/mathml/asciimath.html)，它与显示组件[MathPlayer](http://en.wikipedia.org/wiki/MathPlayer)一起在 Mozilla (Firefox) 和 IE 中工作。

# java - 是否有技术原因更喜欢使用 logback 而不是 log4j？

> ID：178836
> 
> 赞同：78
> 
> 时间：2008-10-07T14:55:58.830
> 
> 标签：java, logging, log4j, logback

新项目是否应该使用 logback 而不是 log4j 作为日志框架？

或者换句话说：'logback 是否比 log4j 更好（留下 logback 的 SLF4J-'功能'）？

* * *

## 回答 #1

> 赞同：83
> 
> 时间：2009-05-31T22:10:56.907

您应该使用 SLF4J+Logback 进行日志记录。

它提供了简洁的功能，例如参数化消息和（与 commons-logging 相比）映射诊断上下文（MDC、[javadoc](http://slf4j.org/apidocs/org/slf4j/MDC.html)、[文档](http://logback.qos.ch/manual/mdc.html)）。

使用 SLF4J 使得日志后端可以以一种非常优雅的方式进行交换。

此外，SLF4J[支持将](http://slf4j.org/legacy.html)其他日志框架桥接到您将使用的实际 SLF4J 实现，因此来自第三方软件的日志事件将显示在您的统一日志中 - 除了无法桥接的 java.util.logging与其他日志框架相同。

[SLF4JBridgeHandler 的javadocs](http://slf4j.org/api/org/slf4j/bridge/SLF4JBridgeHandler.html)中解释了桥接 jul 。

我在几个项目中使用 SLF4J+Logback 组合的体验非常好，而 LOG4J 开发几乎停滞不前。

SLF4J 有以下剩余的缺点：

*   它不支持可变参数以保持与 Java < 1.5 的兼容
*   它不支持同时使用参数化消息和异常。
*   它不包含对LOG4J 所具有的嵌套诊断上下文（NDC、 [javadoc ）的支持。](http://logging.apache.org/log4j/1.2/apidocs/org/apache/log4j/NDC.html)

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2011-05-18T12:27:21.463

作者（Logback 和 Log4j 的作者）在[http://logback.qos.ch/reasonsToSwitch.html](http://logback.qos.ch/reasonsToSwitch.html)列出了更改的原因列表。

这里有一些让我印象深刻的；

*   **更快的实施**

    基于我们之前在 log4j 上的工作，logback 内部已经被重写，在某些关键执行路径上的执行速度提高了大约十倍。logback 组件不仅速度更快，而且内存占用更小。

*   **自动重新加载配置文件**

    Logback-classic 可以在修改时自动重新加载其配置文件。扫描过程既快速又安全，因为它不涉及创建单独的扫描线程。这种技术上的微妙之处确保 logback 在应用程序服务器中运行良好，更普遍地在 JEE 环境中运行。

*   **带有包装数据的堆栈跟踪**

    当 logback 打印异常时，堆栈跟踪将包含打包数据。这是由 logback-demo web-application 生成的示例堆栈跟踪。

    14：28：48.835 [btpool0-7] 信息 cqldemo.prime.PrimeAction - 99 不是有效值 java.lang.Exception：99
    在 ch.qos.logback.demo.prime.PrimeAction.execute 无效（PrimeAction.java :28) [classes/:na] 在 org.apache.struts.action.RequestProcessor.processActionPerform(RequestProcessor.java:431) [struts-1.2.9.jar:1.2.9] 在 org.apache.struts.action。 RequestProcessor.process(RequestProcessor.java:236) [struts-1.2.9.jar:1.2.9] at org.apache.struts.action.ActionServlet.doPost(ActionServlet.java:432) [struts-1.2.9.jar :1.2.9] 在 javax.servlet.http.HttpServlet.service(HttpServlet.java:820) [servlet-api-2.5-6.1.12.jar:6.1.12]
    在 org.mortbay.jetty.servlet.ServletHolder.handle(ServletHolder.java:502) [jetty-6.1.12.jar:6.1.12] 在 ch.qos.logback.demo.UserServletFilter.doFilter(UserServletFilter.java:44 ) [classes/:na] 在 org.mortbay.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1115) [jetty-6.1.12.jar:6.1.12] 在 org.mortbay.jetty.servlet。 ServletHandler.handle(ServletHandler.java:361) [jetty-6.1.12.jar:6.1.12] 在 org.mortbay.jetty.webapp.WebAppContext.handle(WebAppContext.java:417) [jetty-6.1.12.jar :6.1.12] 在 org.mortbay.jetty.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:230) [jetty-6.1.12.jar:6.1.12]

    从上面可以看出，应用程序使用的是 Struts 版本 1.2.9，并且部署在 jetty 版本 6.1.12 下。因此，堆栈跟踪将快速通知读者有关异常中的类以及它们所属的包和包版本。当您的客户向您发送堆栈跟踪时，作为开发人员，您将不再需要要求他们向您发送有关他们正在使用的软件包版本的信息。该信息将成为堆栈跟踪的一部分。有关详细信息，请参阅“%xThrowable”转换字。

    这个特性非常有用，以至于一些用户错误地认为它是他们的 IDE 的一个特性。

*   **自动删除旧的日志档案**

    通过设置 TimeBasedRollingPolicy 或 SizeAndTimeBasedFNATP 的 maxHistory 属性，可以控制归档文件的最大数量。如果您的滚动策略要求每月滚动并且您希望保留一年的日志，只需将 maxHistory 属性设置为 12。超过 12 个月的存档日志文件将被自动删除。

那里可能存在偏见，但同一个人确实编写了两个框架，如果他说使用 Logback 而不是 Log4j，他可能值得一听。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-01-20T12:47:08.900

在所有情况下，我都会使用 slf4j 进行日志记录。这允许您在部署时而不是代码时选择要使用的实际日志记录后端。

事实证明，这对我来说非常有价值。它允许我在旧 JVM 中使用 log4j，在 1.5+ JVM 中使用 logback，如果需要，还可以使用 java.util.logging。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-04-22T17:02:32.517

Logback 更了解 Java EE：
通常（从代码到文档）它牢记容器——多个应用程序如何共存、类加载器如何实现等。记录器的上下文、JNDI、JMX 配置等。

从开发人员的角度来看几乎相同，Logback 添加了参数化日志记录（无需使用 if(logger.isDebugEnabled()) 来避免字符串连接开销）

Log4j – 唯一的巨大优势是旧的 JVM 支持、小型 (IMO) NDC（仅限 Logback MDC）、一些扩展。例如，我为 Log4j 编写了 configureAndWatch 扩展，而 Logback 则没有

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-07T15:50:10.000

I would think that your decision should come down to the same one it would if you were deciding between using log4j or Jakarta Commons Logging - are you developing a library which will be included in other applications? If so, then it doesn't seem fair to force users of your library to also use your logging library of choice.

If the answer is no, I would just go with what is simpler to add and what you are more comfortable with. Sounds like logback is just as extensible and reliable as log4j, so if you're comfortable using it, go ahead.

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-07T15:08:32.377

最初的 log4j 和 logback 是由同一个人设计和实现的。

一些开源工具使用了 SLF4J。我没有看到这个工具有任何重大缺陷。因此，除非您的代码库中有很多 log4j 扩展，否则我会继续使用 logback。

* * *

## 回答 #7

> 赞同：-3
> 
> 时间：2008-10-07T14:58:45.500

我对 SLF4J 不熟悉，我只对 logback 进行了简要介绍，但我想到了两件事。

首先，您为什么将工具排除在检查之外？我认为保持开放的心态并检查所有可能性以选择最佳方案是很重要的。

其次，我认为在某些项目中，一种工具比另一种工具更好，而在不同的项目中可能正好相反。我不认为一种工具总是比另一种工具更好。毕竟，**没有灵丹妙药**。

回答您的问题 - 是和否。这取决于项目，以及团队对一种工具的熟悉程度。如果整个团队都非常满意，我不会说“不要使用 log4j”，它满足所有需求，并且 logback 不提供我们完成任务所需的任何东西。

# regex - 如何使用 Perl 正则表达式找到重复的字母？

> ID：178837
> 
> 赞同：24
> 
> 时间：2008-10-07T14:56:20.997
> 
> 标签：regex, perl, character

我正在寻找一个可以找到重复字母的正则表达式。所以任何字母两次或更多，例如：

```
booooooot or abbott 
```

我不会提前知道我要找的那封信。

这是我在面试中被问到，然后在面试中被问到的问题。没有多少人能正确理解。

* * *

## 回答 #1

> 赞同：54
> 
> 时间：2008-10-07T15:00:06.043

您可以找到任何字母，然后使用`\1`第二次（或更多）找到相同的字母。如果您只需要知道该字母，那么`$1`将包含它。否则，您可以将第二个匹配项连接到第一个匹配项上。

```
my $str = "Foooooobar";

$str =~ /(\w)(\1+)/;

print $1;
# prints 'o'
print $1 . $2;
# prints 'oooooo' 
```

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-10-07T15:03:02.137

我认为您实际上想要这个而不是 "\w"，因为它包括数字和下划线。

```
([a-zA-Z])\1+ 
```

好的，好的，我可以提示一下 Leon。将此用于 unicode-world 或 posix 的东西。

```
([[:alpha:]])\1+ 
```

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-10-07T14:58:58.650

我认为使用反向引用会起作用：

```
(\w)\1+ 
```

`\w`基本上是`[a-zA-Z_0-9]`这样，如果您只想匹配 A 和 Z 之间的字母（不区分大小写），请`[a-zA-Z]`改用。

*（编辑：或者，就像 Tanktalus 在他的评论中提到的（以及其他人也回答过的那样）* `[[:alpha:]]`*，这是对语言环境敏感的）*

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-10-07T14:58:30.040

使用 \N 引用以前的组：

```
/(\w)\1+/g 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-10-07T15:55:28.787

您可能需要注意什么是字母，这取决于您的语言环境。使用 ISO Latin-1 将允许将带重​​音的西方语言字符匹配为字母。在以下程序中，默认语言环境无法识别 é，因此*créé*无法匹配。取消注释区域设置代码，然后它开始匹配。

另请注意，\w 包括数字和下划线字符以及所有字母。要仅获取字母，您需要获取非字母数字、数字和下划线字符的补码。这样就只剩下字母了。

通过将其作为问题来理解，这可能更容易理解：

> “什么正则表达式匹配除 3 之外的任何数字？”
> 答案是：
> `/[^\D3]/`

```
#! /usr/local/bin/perl

use strict;
use warnings;

# uncomment the following three lines:
# use locale;
# use POSIX;
# setlocale(LC_CTYPE, 'fr_FR.ISO8859-1');

while (<DATA>) {
    chomp;
    if (/([^\W_0-9])\1+/) {
        print "$_: dup [$1]\n";
    }
    else {
        print "$_: nope\n";
    }
}

__DATA__
100
food
créé
a::b 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-10-07T18:08:55.507

以下代码将返回重复两次或更多次的所有字符：

```
my $str = "SSSannnkaaarsss";

print $str =~ /(\w)\1+/g; 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-10-08T04:01:45.700

只是为了踢，一种完全不同的方法：

```
if ( ($str ^ substr($str,1) ) =~ /\0+/ ) {
    print "found ", substr($str, $-[0], $+[0]-$-[0]+1), " at offset ", $-[0];
} 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-07T19:28:48.247

仅供参考，除了 RegExBuddy，gskinner.com 上的 RegExr 是一个真正方便的用于测试正则表达式的免费[网站](http://www.gskinner.com/RegExr/)。处理`([[:alpha:]])(\1+)`得很好。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-07T14:58:52.537

怎么样：

```
(\w)\1+ 
```

第一部分围绕一个字符创建一个未命名的组，然后反向引用查找相同的字符。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2011-08-08T22:15:08.167

我认为这也应该有效：

`((\w)(?=\2))+\2`

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2012-05-23T21:42:17.523

```
/(.)\\1{2,}+/u 
```

'u' 修饰符与 unicode 匹配

# c++ - 取消引用结构中的可变大小数组

> ID：178838
> 
> 赞同：1
> 
> 时间：2008-10-07T14:56:59.950
> 
> 标签：c++, struct

结构似乎是解析二进制数据块（即文件或网络数据包）的有用方法。在 blob 中有可变大小的数组之前，这很好而且很花哨。例如：

```
struct nodeheader{
        int flags;
        int data_size;
        char data[];
}; 
```

这使我可以找到最后一个数据字符：

```
nodeheader b;
cout << b.data[b.data_size-1]; 
```

问题是，我想要多个可变长度数组：

```
struct nodeheader{
    int friend_size;
    int data_size;
    char data[];
    char friend[];
}; 
```

我不是手动分配这些结构。我有一个像这样的文件：

```
char file_data[1024];
nodeheader* node = &(file_data[10]); 
```

当我试图解析一个二进制文件（更具体地说是一个类文件）时。我已经用 Java 编写了一个实现（这是我的课堂作业），不，我正在用 C++ 编写个人版本，并希望无需编写 100 行代码就能摆脱困境。有任何想法吗？

谢谢，斯特凡

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-07T15:02:57.863

您不能有多个可变大小的数组。编译器在编译时应该如何知道friend[]的位置？友元的位置取决于 data[] 的大小，而数据的大小在编译时是未知的。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-07T15:06:49.697

这是一个非常危险的结构，我建议不要这样做。当它是最后一个元素时，您只能在结构中包含可变长度数组，并且当您这样做时，您必须确保分配足够的内存，例如：

```
nodeheader *nh = (nodeheader *)malloc(sizeof(nodeheader) + max_data_size); 
```

您要做的只是使用常规动态分配的数组：

```
struct nodeheader
{
  char *data;
  size_t data_size;
  char *friend;
  size_t friend_size;
};

nodeheader AllocNodeHeader(size_t data_size, size_t friend_size)
{
  nodeheader nh;
  nh.data = (char *)malloc(data_size);  // check for NULL return
  nh.data_size = data_size;
  nh.friend = (char *)malloc(friend_size);  // check for NULL return
  nh.friend_size = friend_size;

  return nh;
}

void FreeNodeHeader(nodeheader *nh)
{
  free(nh->data);
  nh->data = NULL;
  free(nh->friend);
  nh->friend = NULL;
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-07T15:05:17.983

你不能——至少不能以你尝试的简单方式。结构末尾的未调整大小的数组基本上是结构末尾的偏移量，没有内置方法来查找结尾。

所有字段都在编译时转换为数字偏移量，因此它们需要在当时是可计算的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-09T07:31:13.280

到目前为止的答案严重地过度复杂化了一个简单的问题。Mecki 关于为什么不能按照您尝试的方式完成它是正确的，但是您可以非常相似地完成它：

```
struct nodeheader
{
    int friend_size;
    int data_size;
};

struct nodefile
{
    nodeheader *header;
    char *data;
    char *friend;
};

char file_data[1024];

// .. file in file_data ..

nodefile file;
file.header = (nodeheader *)&file_data[0];
file.data = (char *)&file.header[1];
file.friend = &file.data[file->header.data_size]; 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-07T15:21:40.807

对于您正在做的事情，您需要格式的编码器/解码器。解码器获取原始数据并填写您的结构（在您的情况下为数据的每个部分的副本分配空间），解码器写入原始二进制文件。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-10-07T15:08:40.800

（是“使用 std::vector”）

编辑：

在阅读反馈时，我想我应该扩展我的答案。您可以在结构中有效地放置两个可变长度数组，如下所示，当 file_data 超出范围时，将自动为您释放存储空间：

```
struct nodeheader {
    std::vector<unsigned char> data;
    std::vector<unsigned char> friend_buf; // 'friend' is a keyword!
    // etc...
};

nodeheader file_data; 
```

现在 file_data.data.size() 等为您提供长度，&file_data.data[0] 为您提供指向数据的原始指针（如果需要）。

您必须从文件中零碎地填充文件数据 - 读取每个缓冲区的长度，在目标向量上调用 resize()，然后读入数据。（有一些方法可以稍微更有效地做到这一点。在磁盘文件 I/O 的上下文中，我假设这无关紧要）。

顺便说一句，即使对于他的“精致而漂亮”的案例，OP 的技术也不正确，例如，最后只有一个 VLA。

```
char file_data[1024];
nodeheader* node = &(file_data[10]); 
```

不能保证 file_data 与 nodeheader 类型正确对齐。更喜欢通过 malloc() 获取 file_data - 这保证返回与任何类型对齐的指针 - 或者（更好）首先声明缓冲区为正确类型：

```
struct biggestnodeheader {
    int flags;
    int data_size;
    char data[ENOUGH_SPACE_FOR_LARGEST_HEADER_I_EVER_NEED];
};

biggestnodeheader file_data;
// etc... 
```

# xml - 根据日期值计算周数

> ID：178845
> 
> 赞同：6
> 
> 时间：2008-10-07T14:58:05.253
> 
> 标签：xml, xslt, date

是否有一些简单的方法可以根据存储在 XML 中的日期值计算 Weeknumber 值？

它需要是纯 XSLT 解决方案。我不能使用任何代码:(

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-07T22:05:49.693

如果您可以使用 EXSLT，则可以使用[多种日期函数](http://www.exslt.org/date/index.html)。所有这些都在 Saxon 中实现，但如果您使用 MSXSL，Chris Bayes 已将它们实现为扩展函数，您实际上可以将其放置在 msxsl:script 元素内的转换中。他的实现从每个特定的日期功能页面链接。

[week-in-year()](http://www.exslt.org/date/functions/week-in-year/index.html)是您正在寻找的功能吗？

**编辑：**根据 JeniT 的评论，在同一个站点上 有一个[纯 XSLT 1.0 模板，其功能与 week-in-year() （我认为是她写的）相同，它可能更符合您的要求。](http://www.exslt.org/date/functions/week-in-year/date.week-in-year.template.xsl)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-07T15:11:58.437

如果您总是希望一周从同一天开始，那么周计算可能会变得非常复杂，因为一年中的第一天总是在变化。有一个计算它的 ISO 标准，请参阅[此 Wikipedia 文章](http://en.wikipedia.org/wiki/ISO_week)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-16T16:49:32.810

**这是一个纯 XSLT 1.0 解决方案**：

可以使用**`datetime_lib.xsl`**Martin Rowlinson 的样式表模块，它附带**[XSelerator](http://sourceforge.net/projects/xselerator)**（一个不错的 XSLT IDE，最近在 sourceforge 上免费提供）。您必须下载并安装此应用程序，然后您会发现大量额外的库以及高级技术和解决方案的示例。

该**`datetime_lib.xsl`** 文件可以在以下位置找到（对于典型安装）：

       C:\Program Files\Marrowsoft\Xselerator25\Samples\Libraries\

在这个库中，这里是名为“week-number”的模板：

```
<xsl:template name="周数">
    <xsl:param name="年份"/>
    <xsl:param name="月"/>
    <xsl:param name="day"/>
    <!-- 或 -->
    <xsl:param name="date" select="''"/> <!-- 格式：yyyymmdd 或 yyyy-mm-dd -->
    <!-- 或 -->
    <xsl:param name="julian-day" select="''"/>
    <!-- 缩减日期 -->
    <xsl:variable name="tdate" select="translate($date,'-','')"/>
    <!-- 决定传递了哪些参数 -->
    <xsl:变量名="yyyy">
        <xsl:选择>
            <xsl:when test="string-length($date) > 0"><xsl:value-of select="substring($tdate,1,4)"/></xsl:when>
            <xsl:when test="string-length($julian-day) > 0">
                <xsl:变量名="jdate">
                    <xsl:call-template name="julian-day-to-date">
                        <xsl:with-param name="julian-day" select="$julian-day"/>
                    </xsl:调用模板>
                </xsl:变量>
                <xsl:value-of select="substring($jdate,1,4)"/>
            </xsl:when>
            <xsl:otherwise><xsl:value-of select="$year"/></xsl:otherwise>
        </xsl:选择>
    </xsl:变量>
    <!-- 获取儒略日数 -->
    <xsl:变量名="jd">
        <xsl:选择>
            <xsl:when test="string-length($julian-day) > 0"><xsl:value-of select="$julian-day"/></xsl:when>
            <xsl：否则>
                <xsl:call-template name="date-to-julian-day">
                    <xsl:with-param name="year" select="$year"/>
                    <xsl:with-param name="month" select="$month"/>
                    <xsl:with-param name="day" select="$day"/>
                    <xsl:with-param name="date" select="$date"/>
                </xsl:调用模板>
            </xsl:否则>
        </xsl:选择>
    </xsl:变量>
    <!-- 获取明年第一个工作日的儒略日数 -->
    <xsl:变量名="fyjd">
        <xsl:call-template name="first-day-of-year">
            <xsl:with-param name="year" select="$yyyy+1"/>
            <xsl:with-param name="as-julian-day" select="true()"/>
        </xsl:调用模板>
    </xsl:变量>
    <!-- 决定这个日期的“工作”年份是哪一年 -->
    <xsl:variable name="start-jd">
        <xsl:选择>
            <xsl:when test="$jd >= $fyjd"><xsl:value-of select="$fyjd"/></xsl:when>
            <xsl：否则>
                <xsl:call-template name="date-to-julian-day">
                    <xsl:with-param name="日期">
                        <xsl:call-template name="first-day-of-year">
                            <xsl:with-param name="year" select="$yyyy"/>
                        </xsl:调用模板>
                    </xsl:with-param>
                </xsl:调用模板>
            </xsl:否则>
        </xsl:选择>
    </xsl:变量>
    <!-- 最终计算输出 -->
    <xsl:value-of select="floor(($jd - $start-jd) div 7) + 1"/>
</xsl:模板>
```

这是一个使用“week-number”模板的简单 XSLT 转换：

```
<xsl:stylesheet 版本="1.0"
 xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
 xmlns:msxsl="urn:schemas-microsoft-com:xslt">

 <xsl:导入 href=
 "C:\Program Files\Marrowsoft\Xselerator25\Samples\Libraries\datetime_lib.xsl"/>

 <xsl:输出方法="文本"/>

 <xsl:模板匹配="/">
     <xsl:call-template name="week-number">
       <xsl:with-param name="date" select="'2008-11-16'"/>
     </xsl:调用模板>
 </xsl:模板>
</xsl:样式表>
```

当应用于任何源 XML 文档（未使用）时，会产生所需的结果：

   **46**

希望这次的答案真的更有帮助。

干杯，

迪米特雷·诺瓦切夫。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-08T14:35:24.830

查看 Sal Mangano 的 XSLT Cookbook。有趣的是，它可以在[Google Books](http://books.google.com/books?id=su4pWUPWwuEC&pg=PA125&lpg=PA125&dq=xslt%20weeknumber&source=web&ots=nBBc3DVJYU&sig=l19cpOhwd9_PqrB72b9CCZk9wUA)上找到。

xslt 2.0 的方式是：

```
<xsl:function name="chkbk:calculate-week-number" as="xs:integer">
    <xsl:param name="date" as="xs:date" />
    <xsl:sequence select="xs:integer(format-date($date,'[W]'))" />
</xsl:function> 
```

对于 1.0 方式，请参阅 Cookbox 预览。顺便说一句，我只是用谷歌搜索 xslt weeknumber 来找到它。

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2008-10-07T15:05:11.993

我使用 Visual Basic 进行编程，所以我知道如何使用 VB.NET 进行编程。将您的 XML 日期读入一个变量（我们称之为*SomeDate*）。然后你构建一个新的日期，你**知道**它是包含未知日期的年初。然后，您让*DateDiff*函数完成它的工作来告诉您周数。

```
Dim SomeDate As Date = ReadDateFromXML()
Dim YearStart As New Date(Year(SomeDate), 1, 1)
Dim WeekNumber As Integer = DateDiff(DateInterval.WeekOfYear, YearStart, SomeDate) 
```

* * *

## 回答 #6

> 赞同：-3
> 
> 时间：2008-10-07T15:10:16.960

在 C# 中：

```
DateTime date = DateTime.Now;
int week = date.DayOfYear / 7;
Console.WriteLine(week); 
```

# visual-studio - 安装 ReSharper 后 Visual Studio 2005 Intellisense 停止工作

> ID：178846
> 
> 赞同：22
> 
> 时间：2008-10-07T14:58:06.140
> 
> 标签：visual-studio, visual-studio-2005, resharper

我安装了 ReSharper 评估版并卸载了它。之后 Visual Studio 的 Intellisense 停止工作。我已经重新启动计算机，但我仍然有这个问题。

任何人都可以在这里帮助我吗？

我正在使用 Visual Studio 2005。谢谢。

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2008-10-07T15:06:22.507

尝试打开 Visual Studio 命令提示符并输入：

```
devenv.exe /ResetSettings 
```

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2008-10-07T15:06:39.680

尝试转到工具 > 选项 > 文本编辑器 > C# 并检查语句完成下的所有选项。我认为 Resharper 在安装时会禁用这些。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-07T15:02:26.180

有时删除 ncb 文件会有所帮助。进入你的解决方案目录，找到 sln 文件，里面也会有一个同名文件，扩展名为 ncb。确保 Visual Studio 已关闭（至少不要打开该项目），然后删除该文件。不用担心 Visual Studio 会为您重建它。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2011-05-11T08:26:14.280

devenv.exe /ResetSettings 是唯一对我有用的东西。命令提示符的完整路径如下（VS 2008）

C:\Program Files\Microsoft Visual Studio 9.0\Common7\IDE>devenv.exe /ResetSettings

我花了一段时间才找到所以我想我会发布这个来帮助

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-10-23T17:37:35.413

devenv /ResetSettings 在卸载 ReSharper 后工作。我不必进行维修。我确实验证了在 Text Editor > C# 下检查了设置，但 ResetSettings 是唯一有效的方法。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-09-27T11:24:26.037

您可以尝试通过以下方式重置您的 Visual Studio 设置

1.  如果它正在运行，则从 Tast Manager 结束进程 devenv.exe。（它可以关闭您的浏览器和 Visual Studio）
2.  从开始运行 devenv /resetuserdata -> 运行

希望它可以帮助你。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2012-04-21T17:54:24.683

像这篇文章一样禁用更新智能感知： [http](http://amastaneh.blogspot.com/2007/11/disable-updating-intellisense.html) ://amastaneh.blogspot.com/2007/11/disable-updating-intellisense.html 尽管旧版本似乎对我有用。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-07T15:14:35.157

我会先尝试对安装进行“修复”。控制面板，添加/删除程序，选择Microsoft Visual Studio 2005，点击“更改/删除”。它将加载安装对话框并为您提供“修复”选项。

YMMV，但至少它应该将很多 VS 资源重置为“新鲜”状态。

# ado.net - oledb/ado.net：获取命令的文本，所有参数都被替换

> ID：178857
> 
> 赞同：4
> 
> 时间：2008-10-07T14:59:16.093
> 
> 标签：ado.net, parameters, oledb

是否可以获得`OleDbCommand`所有参数替换为其值的文本？例如，在下面的代码中，我正在寻找一种获取查询文本的方法

```
SELECT * FROM my_table WHERE c1 = 'hello' and c2 = 'world' 
```

在我完成分配参数之后。

```
var query = "SELECT * FROM my_table WHERE c1 = ? and c2 = ?";
var cmd = new OleDbCommand(query, connection);
cmd.Parameters.Add("@p1", OleDbType.WChar).Value = "hello";
cmd.Parameters.Add("@p2", OleDbType.WChar).Value = "world"; 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-07T15:04:13.180

不：您必须自己遍历参数集合，执行 string.Replace() 以获得等效项。当您必须使用`?`语法而不是`@parametername`语法时，这尤其痛苦。

这样做的原因是整个字符串*从未*组装过。参数并被发送到服务器并被视为数据，并且永远不会包含在字符串中。

尽管如此，我理解你的痛苦。如果它们包含某种`.ComposeSQL()`可以*用于调试目的*的方法会很好，这可能还会产生编译器警告以帮助避免在生产中使用。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-07T15:07:10.273

如果您只需要查看执行了哪些查询而不需要以编程方式使用它，则可以使用 SQL Profiler。

# database - 如何将 MSAccess 连接添加到 CodeIgniter 或 CakePHP？

> ID：178860
> 
> 赞同：3
> 
> 时间：2008-10-07T14:59:54.390
> 
> 标签：database, ms-access, cakephp, codeigniter

我正在尝试将 Microsoft Access 数据库用于我正在考虑在 CodeIgniter 或 CakePHP 中进行的演示项目。忽略使用 Microsoft Access 的可能愚蠢之处，我无法准确地弄清楚连接字符串如何与框架的数据库设置相对应。在直接 PHP 中，我可以使用此代码连接到 Access 数据库：

```
$db_connection = odbc_connect(
  "DRIVER={Microsoft Access Driver (*.mdb)}; DBQ=\\path\\to\\db.mdb", 
  "ADODB.Connection", "", "SQL_CUR_USE_ODBC"
); 
```

这些字符串如何与 Code Igniter db 设置相对应？这似乎不太有效：

```
$db['access']['hostname'] = "{Microsoft Access Driver (*.mdb)}";
$db['access']['username'] = "ADODB.Connection";
$db['access']['password'] = "";
$db['access']['database'] = "\\path\\to\\db.mdb";
$db['access']['dbdriver'] = "odbc";
$db['access']['dbprefix'] = "";
$db['access']['pconnect'] = TRUE;
$db['access']['db_debug'] = TRUE;
$db['access']['cache_on'] = FALSE;
$db['access']['cachedir'] = "";
$db['access']['char_set'] = "utf8";
$db['access']['dbcollat'] = "utf8_general_ci"; 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-04T01:38:06.297

尝试设置 DSN 并更改为以下内容：

```
$db['access']['hostname'] = "<dsn name>";
$db['access']['username'] = "";
$db['access']['password'] = "";
$db['access']['database'] = "<dsn name>"; 
```

CodeIgniter 文档中还有一个部分涉及连接字符串：

[http://codeigniter.com/user_guide/database/connecting.html](http://codeigniter.com/user_guide/database/connecting.html)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-04T02:46:31.290

是否可以改用 SQL Express（免费！）引擎来导入/导出您的 MS Access 数据库？你可以稍后感谢我。:-)

另一种选择是使用 ADOdb 库而不是 CI 的本机 DB 库，尽管您将失去 CI 的 Active Record 支持，并且必须在 CI 中重写某些库才能使用它，但如果您仍然想使用 CI，这是值得的使用您的应用程序不支持的数据库。当 Postgres 实现中出现错误时，我必须尽早这样做。

# asp.net - 根据用户更改主题/ CSS

> ID：178863
> 
> 赞同：10
> 
> 时间：2008-10-07T15:00:17.260
> 
> 标签：asp.net, css

我正在构建一个我们最终会贴上白标的产品。现在我正试图找出以编程方式满足这些要求的最佳方法，以便用户可以通过他们的配置文件/设置表单更新网站的基本设计（即标题颜色等）。

要求：

1.  用户可以更新标志（这是完整的）
2.  用户可以更新基本设计元素（基于 CSS），即页眉颜色、页脚颜色、侧边栏颜色 - 所有基本 CSS 覆盖

我们不想使用 ASP.Net Themes/Skins，因为这需要将静态主题存储在本地文件系统中。我们想使用 CSS 覆盖基本样式并将其存储在数据库中。

我们最初的计划是将 CSS 存储在数据库中的一个简单的 varchar 字段中，并在 Pre-Init 事件中使用“！”将该 CSS 写入母版页。覆盖基本样式。这是最好的解决方案吗？如果没有，你做了什么来完成这个功能/

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-07T22:28:19.087

我几个月前去过那里。虽然使用由专用处理程序/servlet 生成的动态 CSS 是第一个解决方案，但为了提高性能，现在在文件上生成自定义 CSS，覆盖标准 CSS 的基本元素：

```
<link rel="stylesheet" href="standard.css" />
<link rel="stylesheet" href="<%= customer_code %>/custom_style.css" />
...
<img scr="<%= customer_code %>/logo.png" /> 
```

每个自定义 CSS 都有自己的 URL，因此您可以让浏览器缓存它们。

这将使您为用户将提出**的每个请求保存：**

1.  从数据库到应用层的流量
2.  从应用层到浏览器的流量
3.  应用层的一些计算

我将支持用户应该填写一个详细说明他们想要进行哪些自定义的网络表单的想法。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-07T15:21:52.193

首先，确定哪些资源可以替换，是否可以添加资源。您需要将这些存储在某个地方；对于徽标等小型资源，数据库可能很好，否则您需要担心数据库的大小。

然后，您可以确定您希望用户自定义多少功能：只是颜色，还是整个样式？如果只是颜色，您可以在 CSS 文件中定义一些变量并动态提供文件，并从数据库加载数据。CSS 文件可能称为 styles.asp 并包含如下代码：

```
.header_area {
  border: 1px solid <%=headerBorderColor%>;
  background-color:  <%=headerBGColor%>;
  foreground-color:  <%=headerFGColor%>;
} 
```

（我使用的语法是JSP语法，我不懂ASP，但是思路是一样的。）

或者，允许用户指定整个样式表，替换默认样式表或补充它。然后将整个工作表存储在数据库中并使用其自己的 URL 提供服务（不要将其嵌入页面中）。

```
<link rel="stylesheet" href="default_styles.css">
<link rel="stylesheet" href="white_label_css.asp"> 
```

如果使用 asp 页面提供 css 文件，请确保在 css 文件上正确设置缓存标头和内容类型。

如果您担心用户可以在 white_label_css 文件中放入什么样的内容，您可以通过制作自定义工具来限制它，该工具会生成 css 并将其存储在 db 中。例如，不是允许用户上传任何文件并将其存储在数据库中，而是用户必须填写一个 Web 表单，详细说明他们想要进行哪些自定义。这样，您可以确保只允许某些 css 规则/更改（但这可能不够灵活）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-07T16:08:14.097

我喜欢使用 ASP.Net 处理程序使用动态 CSS 的想法......

```
<link rel="stylesheet" href="style.ashx" /> 
```

**风格.ashx**

```
<!--WebHandler Language="C#" Class="StyleSheetHandler"--> 
```

**样式表处理程序.cs**

```
public class StyleSheetHandler : IHttpHandler {
        public void ProcessRequest (HttpContext context)
        {   
            context.Response.ContentType = "text/css";
            context.Response.ContentEncoding = System.Text.Encoding.UTF8;

            string css = BuildCSSString(); //not showing this function

            context.Response.Cache.SetExpires(DateTime.Now.AddSeconds(600));
            context.Response.Cache.SetCacheability(HttpCacheability.Public);
            context.Response.Write( css );
        }

        public bool IsReusable
        {
            get { return true; }
        }

} 
```

BuildCSSString() 函数将根据存储在数据库中的值构建 css 并将其返回以覆盖母版页上的基本样式。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-07T15:02:58.720

您提出的方法是我将如何解决这个问题：将用户可控制的值（可能只是颜色和字体大小）上传到链接到用户的表中。

您希望用户拥有的徽标/头像可以存储在 db 中或作为 fs 上的文件。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-07T15:14:21.320

我认为这取决于您的用户对 CSS 的了解程度。如果他们是 Web 开发人员或有这种倾向，让他们编写 CSS 可能没问题。如果没有，您要么必须根据他们的输入静态生成它并将其存储在数据库中，要么您可以只存储输入的值并使用自定义处理程序动态生成 CSS。

自定义处理程序方法意味着您可以在 CSS 中间替换值，而不必担心 !important 或声明项目的顺序以确保发生正确的覆盖。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-07T15:15:21.597

以 php 为例，您可以创建动态 css，因此这与存储在数据库中的用户信息相结合就足够了。

试试[这里](http://www.digital-web.com/articles/generating_dynamic_css_with_php/)或[这里](http://www.barelyfitz.com/projects/csscolor/)作为介绍。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-07T15:23:20.817

如果我理解正确，您希望促进颜色和排版相关的更改。布局呢？如果我们安全地假设只有颜色和排版会改变，我们可以在现有的基本 CSS 文件的末尾重用相同的样式类，从而覆盖样式（使用 !important 虽然是个好主意，但可以防止用户用他们的自定义覆盖样式）。

这些新创建的类可以压缩为单行字符串并存储为 varchar，然后在构建页面时内联/复制。我可以想到以下选项

1.  内联 CSS
2.  创建一个文件分区，您可以在其中转储生成的 CSS 文件并让浏览器引用该位置（通过创建软链接？）
3.  使用 Ajax，检索 CSS 并修改 DOM

如果布局要改变，我们的汤会更浓，我会避免这种情况，因为脚本/事件处理涉及的复杂性太多了。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2008-10-07T15:06:07.560

我会避免使用 !important 子句，而只是确保它们的值出现在`<style>`导入常规样式表之后的标记中。

否则，我会这样做。

# svn - 如果我不使用 Subversion 1.5 中的 --Reintegrate 选项会发生什么？

> ID：178867
> 
> 赞同：1
> 
> 时间：2008-10-07T15:01:38.803
> 
> 标签：svn, tortoisesvn, merge, reintegration

我以为我已经弄清楚了关于 Subversion 1.5 需要了解的所有内容，并且很高兴地在我的功能分支和主干之间进行了合并。

然后我意识到我并没有做我认为我应该做的事情。

从功能分支合并回主干时，我没有使用 --reintegrate 参数。

具体来说，我使用 TortoiseSVN 1.5.3 并且我一直在选择第一个合并选项“合并一系列修订”而不指定范围。

从主干合并到分支时，我认为这是正确的，但我也明白，在以其他方式合并时，我应该使用 --reintegrate 参数。

相反，在任一方向合并时，我一直选择第二个选项，显然在每种情况下都选择了相反的 url。

它似乎确实在每种情况下都处理了正确的文件......

**那么我搞砸了什么（如果有的话）？**

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-07T23:22:34.423

这篇[博文](http://blogs.open.collab.net/svn/2008/07/subversion-merg.html)解释了可能出现的问题、`--reintegrate`创建的原因以及它的实际作用。

[如帖子](http://blogs.open.collab.net/svn/2008/07/subversion-merg.html)中所述，从功能分支合并回主干而不使用`--reintegrate`很可能只会导致一些额外的冲突

# sql-server-2000 - 我可以在 Nunit 中创建数据库死锁测试吗？

> ID：178876
> 
> 赞同：4
> 
> 时间：2008-10-07T15:02:40.703
> 
> 标签：sql-server-2000, nunit, deadlock, msdtc

在这个 asp.net 中，我正在清理可能会发生死锁。我想确保代码正确处理它们，所以我正在尝试编写触发死锁的 NUnit 测试.....

DAO 按实体拆分。每个实体都有一组测试，它们被 Startup() 和 Teardown() 方法包围，这些方法创建一个事务范围，然后在测试完成后将其回滚。这对其他一切都很好，但对于死锁完全没用。

如何使用可以可靠复制的 TransactionScope 和 SQL2000（即涉及 MSDTC）设置和运行“死锁”测试？更多细节：我知道有一种情况，如果两个用户使用不同的、特定的数据值调用两个函数，那么*可能会*导致死锁。我怎样才能在 NUNIT 中模拟这个 - 并让死锁*总是*发生？

是的，我确实从“你为什么不首先阻止死锁发生”行动计划开始，但我无法控制可能发生死锁的代码 - 我只是调用函数，它们可以死锁.

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-08T21:36:54.150

如果您的死锁导致抛出异常，您希望使用 Mock 对象来模拟抛出的异常。

基本思想是您告诉您的 Mock Object 框架（我喜欢[TypeMock](http://www.typemock.com/)）改为抛出异常，如下所示：

```
MockObject mo = MockManager.MockObject(typeof(MyDeadlockException));
mock.ExpectAndThrow("MyMethod", (MyDeadlockException)mo.Object); 
```

其他模拟框架的想法基本相同。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-10T03:17:22.920

这些解决方案中的大多数都涉及多个线程。这是一个没有。

[关闭这些漏洞 - 重现数据库错误](http://www.simple-talk.com/sql/t-sql-programming/close-these-loopholes---reproduce-database-errors/)

作者是亚历克斯库兹涅佐夫。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-07T15:18:52.107

如果您在交易过程中的一项测试只是“等待”了 5 分钟呢？或者，您只需编写一个启动事务的测试，创建一条新记录，然后在不提交的情况下更新该记录。然后，在其中启动一个新事务并尝试读取已创建且当前正在更新的记录。你会在那里陷入僵局。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-07T15:29:16.953

如果您手动锁定了一个表并始终保持锁定状态怎么办？那么，您对该表采取的任何操作都会产生死锁情况吗？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-07T16:20:51.777

遇到这种情况，但是否可以在您的 TestSetup 方法中实际创建到数据库的 SQLConnection？然后，使用它，您可以发出一个命令来锁定表或采取一些行动来锁定记录或页面？那样的话，它会在你正在进行的任何其他交易之外吗？不过，这似乎是您已经考虑过的一个选项。你的情况我错过了什么？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-09T01:03:34.937

对于单元测试，您可能希望避免实际使用数据库。你怎么知道你有死锁。您应该测试告诉您存在死锁的条件并在测试中创建它。

如果您调用服务并返回错误，则模拟是模仿的理想方式。只需让模拟返回您期望的错误。如果您正在等待超时或其他东西，那么同样适用。

一般来说，单元测试应该只在被测试的代码上运行，而不是依赖于任何其他代码或组件。也就是说 - 数据库本质上是另一个组件，您可能正在使用 nunit 进行某种功能测试来驱动它们。

在这种情况下，您确实必须创建死锁情况，但锁定记录或表，然后调用尝试使用相同记录并处理响应的组件。

# .net - 在不更改包含控件的不透明度的情况下更改表单不透明度

> ID：178887
> 
> 赞同：4
> 
> 时间：2008-10-07T15:05:20.493
> 
> 标签：.net, winforms

是否可以使用 .NET 中的[Windows 窗体](http://en.wikipedia.org/wiki/Windows_Forms)来更改窗体的不透明度，而不会自动更改窗体中控件的不透明度？

我有一个最大化运行的表单，它在表单的中心包含一个 flowlayoutpanel，里面有控件。我想降低表单的不透明度，以便 flowlayoutpanel 周围的“备用”部分部分透明，但 flowlayoutpanel 本身保持实心（我的目标是[灯箱](http://www.huddletogether.com/projects/lightbox/)样式效果）。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-09T15:08:01.237

当然，这在 WPF 中可以通过将表单的背景设置为透明来实现（而不是将不透明度设置为 0，后者基本上设置了前景和背景的透明度）。

如果您真的想要，我不明白为什么您不能使用 WindowsFormsHost 将 winforms 组件嵌入到透明的 wpf 表单中。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-07-14T05:33:51.730

[Form.TransparencyKey 属性](http://msdn.microsoft.com/en-us/library/system.windows.forms.form.transparencykey%28v=VS.85%29.aspx)

当 TransparencyKey 属性被分配一个 Color 时，具有相同 BackColor 的窗体区域将透明显示。

如果分配给 TransparencyKey 属性的颜色与窗体上的任何控件相同，它们也将透明显示。例如，如果窗体上有一个 Button 控件，其 TransparencyKey 属性设置为 SystemColors.Control，则该控件将透明显示，除非 Button 控件的 BackColor 属性更改为不同的颜色。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-07T15:24:34.950

不幸的是，`Opacity`是 的属性`Form`，不是`Control`。我能想到的唯一方法是，如果您自己自定义绘制表单并在用于绘制表单背景的画笔中使用 alpha 组件。

即使那样，我也不认为它会起作用，因为桌面组合管理器（特别是在 Windows Vista 上相关）需要知道您的表单应该如何与桌面的其余部分组合，而且我认为画笔只会是透明的反对表格背景，而不是它下面的任何东西。

# c# - WinForm 启动时显示控制台窗口 (C#)

> ID：178888
> 
> 赞同：4
> 
> 时间：2008-10-07T15:05:29.747
> 
> 标签：c#, .net, winforms

这是一个小错误（坦率地说，为了上线，我愿意与之共存），但我想知道是否有其他人有解决它的想法。

我有一个 C# WinForms 应用程序。当应用程序通过可执行文件（而不是调试器）启动时，用户首先看到的是控制台窗口，然后是主窗口（预加载完成后）。

我不想显示控制台窗口。（就像我说的，这是一个小错误。）

项目输出已设置为 Windows 应用程序。

这是 Main() 方法的（大部分）代码。我已经剪掉了各种与专有/安全相关的东西，并在适当的地方用评论替换它。

```
[STAThread]
static void Main()
{
    try
    {
        Application.EnableVisualStyles();
        Application.SetCompatibleTextRenderingDefault(false);

        // SNIP: Get username from Windows, associate with DB user

        if (user == null || user.UID == 0 || (user.Active.HasValue && !(user.Active.Value)))
        {
            MessageBox.Show(ErrorStrings.UnknownUser, ErrorStrings.TitleBar, MessageBoxButtons.OK,
                MessageBoxIcon.Error);
            Application.Exit();
            return;
        }

        // SNIP: Associate user with employee object    

        Application.Run(new MainForm());
    }
    catch (Exception ex)
    {
        if (ExceptionPolicy.HandleException(ex, UiStrings.ExceptionPolicy))
        {
            string message = ErrorStrings.UnhandledPreface + ex.ToString();
            MessageBox.Show(message, ErrorStrings.TitleBar, MessageBoxButtons.OK, MessageBoxIcon.Error);
            Application.Exit();
        }
    }
} 
```

有人有想法么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-07T15:09:14.467

我的第一个猜测是仔细检查您的项目属性设置并确保输出类型是 Windows 应用程序而不是控制台应用程序。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-07T15:36:38.077

我找到了。

在 Visual Studio 中构建项目时，没有任何问题——没有控制台窗口。

当项目从 CruiseControl 构建时，我们会得到一个控制台窗口。

区别？Visual Studio（基于我对 WinForms 应用程序的选择）将 /target:winexe 附加到 csc 行。

CruiseControl 调用一系列 NAnt 脚本。在 source.build 脚本中，编译步骤配置错误，目标是 exe 而不是 winexe——相当于在 VS 中选择“Console App”。因此，发布版本与调试版本的控制台窗口。

相关的 NAnt：

```
<csc output="${build.outputPath}\[myapp].exe" target="winexe" debug="Full" rebuild="true">
    <!-- lots of references, sources and resources -->
</csc> 
```

是的，现在我觉得自己很笨。:)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-07T15:10:00.250

如果您在 Visual Studio 中导航到项目的属性选项卡，您应该能够将输出类型设置为 Windows 应用程序。听起来它可能当前设置为控制台应用程序。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-07T15:14:55.750

如上所述，检查以确保您的项目的属性设置为 Windows 应用程序而不是控制台应用程序。如果这不是问题，那么您的应用程序的一个组件可能正在使用 Win32 API 调用手动创建控制台窗口`AllocConsole()`，或者您可能在后台启动命令行应用程序而没有`UseShellExecute=false; CreateNoWindow=true;`在 StartInfo 中使用。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-07T15:27:40.217

备份您的代码，然后对其进行破解，删除与此问题无关的所有内容。换句话说，有一个“删除代码，构建它，运行它，看看控制台是否仍然弹出”的循环。最终，您应该最终发现问题或能够发布一个简短但完整的程序，以便我们可以重现它并帮助修复它。

# c# - C# WebBrowser 控制 System.AccessViolationException

> ID：178898
> 
> 赞同：31
> 
> 时间：2008-10-07T15:06:57.497
> 
> 标签：c#, .net, exception, browser

我有一个使用内置 webbrowser 控件的程序。在使用它的某个时候，我不确定在什么时候，但它似乎是随机的，我收到以下错误：

```
System.AccessViolationException

FullText = System.AccessViolationException: Attempted to read or write protected memory. This is often an indication that other memory is corrupt.
at System.Windows.Forms.UnsafeNativeMethods.DispatchMessageW(MSG& msg)
at System.Windows.Forms.Application.ComponentManager.System.Windows.Forms.UnsafeNativeMethods.IMsoComponentManager.FPushMessageLoop(Int32 dwComponentID, Int32 reason, Int32 pvLoopData)
at System.Windows.Forms.Application.ThreadContext.RunMessageLoopInner(Int32 reason, ApplicationContext context)
at System.Windows.Forms.Application.ThreadContext.RunMessageLoop(Int32 reason, ApplicationContext context)
at System.Windows.Forms.Application.Run(Form mainForm) 
```

有没有人知道我为什么会得到这个以及如何防止它？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2011-03-07T17:45:32.340

我们最近在几个客户的机器上遇到了类似的问题。这个问题原来是某些环境中 MSHTML 控件中的一个错误。该问题的一个常见症状似乎是 jscript.dll 库的注册损坏。

可能有助于诊断是否是同一问题的症状 - jscript.dll 未在调试器的模块中列出，并且未由进程加载；崩溃的本机堆栈跟踪如下：

```
mshtml!CRootTracker::CollectGarbageInternal+0xd
mshtml!CDoc::ReduceMemoryPressureTask+0x29
mshtml!CStackPtrAry<unsigned long,12>::GetStackSize+0xb6
mshtml!GlobalWndProc+0x183
USER32!InternalCallWinProc+0x23
USER32!UserCallWinProcCheckWow+0x109
USER32!DispatchMessageWorker+0x3bc
USER32!DispatchMessageW+0xf 
```

解决方案是重新注册 jscript.dll 库，崩溃应该会消失。

重新注册库的方法如下（给出了 64 位 Windows 的示例，否则只需要第一行）：

```
C:\Windows\System32\regsvr32.exe C:\Windows\System32\jscript.dll
C:\Windows\SysWOW64\regsvr32.exe C:\Windows\SysWOW64\jscript.dll 
```

这两个命令都必须是“以管理员身份运行”。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2011-07-03T23:27:09.293

在尝试访问 WebBrowser.ReadyState 和 WebBrowser.Document 时，我曾多次遇到此异常。

我只在 Windows XP 32 位上遇到了例外情况。在其他解决方案没有帮助之后，它似乎是一个线程问题。我用互斥锁包围了所有访问 Web 浏览器控件的代码块，这似乎解决了问题。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-07T15:17:30.003

我的直觉是，您正在尝试在导航到文档之前操纵文档。在更改文档文本或 html 之前尝试导航到“about:blank”。

如果您已经在执行导航，请注意导航是异步的，因此您需要监视浏览器的事件以检测导航何时完成。否则，您可能会尝试在文档存在之前对其进行写入。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-08T22:34:26.860

我们也在打这个。不一致的是，我们会得到这个异常。

一些有助于缩小范围的问题：您是否直接使用任何 mshtml 接口（例如 mshtml.dll）？直接进行任何 COM 互操作？

我们发现不正确地调用某些 COM MSHTML 接口会导致这种情况。

我们还发现不正确地执行 COM 编组会导致这种情况。

如果内置 WebBrowser 使用的 MSHTML 界面导入存在错误，则可能导致此问题。

从另一个域访问文档 IFRAME 元素可能会导致此问题。

在文档尚未完全准备好时进行 WebBrowser 调用也可能导致此问题。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-11T01:19:47.947

您要导航到的页面是否托管任何 ActiveX 控件？如果是，其中之一可能有缺陷。还要检查您在 IE 中的页面。看看他们是否以同样的方式崩溃。如果它特定于内容或浏览器控件，这将有助于隔离。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-09T21:03:00.227

只是一个建议，我不是这方面的专家，但在以前的应用程序中使用了很多 WebBrowser，但是为什么不编写一个函数来等待 1 秒，然后再尝试通过浏览器并始终事先检查 readystate。可能会慢一点，但它应该使它防弹。:)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-13T16:26:32.790

我最终只是在浏览器中打开了网页。这样我就不用担心这个了。不过，它抛出这个错误仍然很奇怪。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-12-17T09:42:17.670

这似乎是一个 Vista 问题，发生在我身上的是我的 C# webBrowser1 打开了一个运行 Java 小程序的网页，该小程序打开了一个运行 ActiveX 应用程序/脚本的外部 IE 网页。

当 ActiveX 脚本尝试更新回 C# 应用程序的内存时，Vista 中的 DEP“数据执行保护”会将此操作标记为恶意/病毒，并以 System.AccessViolationException: Attempted to read or write protected memory 结束程序。这通常表明其他内存已损坏。”

我对此的解决方法是使用 cmd 中的这一行在 Vista 中打开 DEP

```
"bcdedit.exe /set {current} nx AlwaysOff" 
```

并重新启动机器。

XP 也运行 DEP，所以在某些情况下，我猜这里也会发生这种寒冷。要测试它是否是 DEP 问题，请执行此操作。

右键单击“我的电脑”选择“属性”和“高级”在“启动和故障恢复”下，单击“设置”现在单击“编辑”记事本刚刚开始。只需替换行： Code: noexecute optionn by AlwaysOff 重新启动PC完成交易。

如果您想重新激活 DEP，则足以进行反向操作，如下所示：

替换为引号：AlwaysOff noexecute = noexecute = optin

# c# - 将类列表序列化为 XML

> ID：178899
> 
> 赞同：35
> 
> 时间：2008-10-07T15:06:59.633
> 
> 标签：c#, xml, serialization

我有一组要序列化为 XML 文件的类。它看起来像这样：

```
public class Foo
{
  public List<Bar> BarList { get; set; }
} 
```

bar 只是属性集合的包装器，如下所示：

```
public class Bar
{
  public string Property1 { get; set; }
  public string Property2 { get; set; }
} 
```

我想标记它，以便它输出到一个 XML 文件 - 这将用于持久性，也可以通过 XSLT 将设置呈现为一个很好的人类可读形式。

我想得到一个很好的 XML 表示，如下所示：

```
<?xml version="1.0" encoding="utf-8"?>
<Foo>
  <BarList>
    <Bar>
      <Property1>Value</Property1>
      <Property2>Value</Property2>   
    </Bar>
    <Bar>
      <Property1>Value</Property1>
      <Property2>Value</Property2>   
    </Bar>
  </Barlist>
</Foo> 
```

Barlist 中的所有 Bars 都在哪里写出了它们的所有属性。我相当确定我需要对类定义进行一些标记才能使其工作，但我似乎找不到正确的组合。

我已经用属性标记了 Foo

```
[XmlRoot("Foo")] 
```

和`list<Bar>`带有属性的

```
[XmlArray("BarList"), XmlArrayItem(typeof(Bar), ElementName="Bar")] 
```

试图告诉序列化器我想要发生什么。但是，这似乎不起作用，我只得到一个空标签，如下所示：

```
<?xml version="1.0" encoding="utf-8"?>
<Foo> 
  <Barlist />
</Foo> 
```

我不确定我使用自动属性的事实是否应该有任何影响，或者使用泛型是否需要任何特殊处理。我已经让它与更简单的类型（如字符串列表）一起使用，但到目前为止我还没有找到类列表。

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2008-10-07T15:10:14.540

只是检查一下，您是否将 Bar 标记为 [Serializable]？

此外，您需要在 Bar 上使用无参数 ctor 来反序列化

嗯，我用过：

```
public partial class Form1 : Form
{
    public Form1()
    {
        InitializeComponent();
    }

    private void button1_Click(object sender, EventArgs e)
    {

        Foo f = new Foo();

        f.BarList = new List<Bar>();

        f.BarList.Add(new Bar { Property1 = "abc", Property2 = "def" });

        XmlSerializer ser = new XmlSerializer(typeof(Foo));

        using (FileStream fs = new FileStream(@"c:\sertest.xml", FileMode.Create))
        {
            ser.Serialize(fs, f);
        }
    }
}

public class Foo
{
    [XmlArray("BarList"), XmlArrayItem(typeof(Bar), ElementName = "Bar")]
    public List<Bar> BarList { get; set; }
}

[XmlRoot("Foo")]
public class Bar
{
    public string Property1 { get; set; }
    public string Property2 { get; set; }
} 
```

这产生了：

```
<?xml version="1.0"?>
<Foo xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema">
  <BarList>
    <Bar>
      <Property1>abc</Property1>
      <Property2>def</Property2>
    </Bar>
  </BarList>
</Foo> 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-07T15:20:54.097

一切看起来都很棒。正如@Carl 所说，您需要将**[Serializable]**属性添加到您的类中，但除此之外，您的 XML 创建应该可以找到。

**富**

```
[Serializable]
[XmlRoot("Foo")]
public class Foo
{
    [XmlArray("BarList"), XmlArrayItem(typeof(Bar), ElementName = "Bar")]
    public List<Bar> BarList { get; set; }
} 
```

**酒吧**

```
[Serializable]
public class Bar
{
    public string Property1 { get; set; }
    public string Property2 { get; set; }
} 
```

**测试代码**

```
Foo f = new Foo();
f.BarList = new List<Bar>();
f.BarList.Add(new Bar() { Property1 = "s", Property2 = "2" });
f.BarList.Add(new Bar() { Property1 = "s", Property2 = "2" });

FileStream fs = new FileStream("c:\\test.xml", FileMode.OpenOrCreate);
System.Xml.Serialization.XmlSerializer s = new System.Xml.Serialization.XmlSerializer(typeof(Foo));
s.Serialize(fs, f); 
```

**输出**

```
<?xml version="1.0" ?> 
<Foo xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema">
    <BarList>
        <Bar>
            <Property1>s</Property1> 
            <Property2>2</Property2> 
        </Bar>
        <Bar>
            <Property1>s</Property1> 
            <Property2>2</Property2> 
        </Bar>
    </BarList>
</Foo> 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2017-11-10T04:59:36.480

```
var xmlfromLINQ = new XElement("BarList",
            from c in BarList 
            select new XElement("Bar",
                new XElement("Property1", c.Property1),
                new XElement("Property2", c.Property2)
             )); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2013-07-31T20:49:55.937

自发布此项目以来已经超过 5 年。我从 2013 年 7 月（.NET Framework 4.5）开始提供我的经验。对于它的价值和可能涉及的对象：

当我像这样定义一个类时：（VB.Net代码）

```
<Serializable> Public Class MyClass
    Public Property Children as List(of ChildCLass)
    <XmlAttribute> Public Property MyFirstProperty as string
    <XmlAttribute> Public Property MySecondProperty as string
End Class

<Serializable> Public Class ChildClass
    <XmlAttribute> Public Property MyFirstProperty as string
    <XmlAttribute> Public Property MySecondProperty as string
End Class 
```

使用此定义，该类被（反）序列化而没有任何问题。这是来自这里的 XML：

```
<MyClass> MyFirstProperty="" MySecondProperty=""
    <Children>
        <ChildClass> MyFirstProperty="" MySecondProperty=""
        </ChildClass>
   </Children>
</MyClass> 
```

我只花了两天时间就弄清楚解决方案是省略`<XmlElement>`List(of T) 元素的前缀。

# javascript - JavaScript 中的这个东西是什么？

> ID：178904
> 
> 赞同：9
> 
> 时间：2008-10-07T15:07:17.450
> 
> 标签：javascript, object-literal

```
var something = {

wtf: null,
omg: null
}; 
```

自从我上次使用 JavaScript 编程以来，我的 JavaScript 知识仍然非常零散，但我想我现在已经重新学习了其中的大部分内容。除了这个。我不记得以前见过这个。它是什么？我在哪里可以了解更多信息？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-10-07T15:08:40.380

它是对象文字语法。'wft' 和 'omg' 是属性名称，而 null 和 null 是属性值。

它相当于：

```
var something = new Object();
something.wtf = null;
something.omg = null; 
```

查看 mozilla 关于对象文字的文档：http: [//developer.mozilla.org/En/Core_JavaScript_1.5_Guide :Literals#Object_Literals](http://developer.mozilla.org/En/Core_JavaScript_1.5_Guide:Literals#Object_Literals)

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-10-07T15:15:00.960

它是一个具有两个属性的对象字面量。通常这是人们创建关联数组或哈希的方式，因为 JS 本身并不支持该数据结构。尽管请注意它仍然是一个成熟的对象，但您甚至可以将函数添加为属性：

```
var myobj = {
    name: 'SO',
    hello: function() {
        alert(this.name);
    }
}; 
```

您可以使用 for 循环遍历属性：

```
for (i in myobj) {
    // myobj[i]
    // Using the brackets (myobj['name']) is the same as using a dot (myobj.name)
} 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-10-07T15:16:18.990

从“我想要一个 Javascript 中的关联数组”的角度进行解释（在许多情况下，对象文字最终被用于）

来自[“掌握 Javascript 数组”](http://www.hunlock.com/blogs/Mastering_Javascript_Arrays)

关联数组是使用字符串而不是数字作为索引的数组。

```
var normalArray    = [];
    normalArray[1] = 'This is an enumerated array';

    alert(normalArray[1]);   // outputs: This is an enumerated array

var associativeArray           = [];
    associativeArray['person'] = 'John Smith';

    alert(associativeArray['person']); // outputs: John Smith 
```

Javascript 没有，也不支持关联数组。但是…… Javascript 中的所有数组都是对象，并且 Javascript 的对象语法给出了关联数组的基本模拟。出于这个原因，上面的示例代码实际上可以工作。请注意，这不是一个真正的数组，如果您尝试使用它，它会有真正的陷阱。示例中的“person”元素成为 Array 对象的属性和方法的一部分，就像 .length、.sort()、.splice() 和所有其他内置属性和方法一样。

您可以使用以下循环遍历对象的属性...</p>

```
var associativeArray = [];
associativeArray["one"] = "First";
associativeArray["two"] = "Second";
associativeArray["three"] = "Third";
for (i in associativeArray) { 
   document.writeln(i+':'+associativeArray[i]+', '); 
   // outputs: one:First, two:Second, three:Third
}; 
```

在上面的例子中，associativeArray.length 将为零，因为我们实际上并没有在 Array 中放入任何东西，而是将它放入 associativeArray 的对象中。associativeArray[0] 将未定义。

上面示例中的循环还将获取已添加到数组中的任何方法、属性和原型，而不仅仅是您的数据。人们对 Prototype 库的很多问题是他们的关联数组中断，因为 Prototype 向 Array 对象添加了一些有用的 Prototype 函数，并且 for i in x 循环选择了这些额外的方法。这就是使用 Array/objects 作为穷人的关联数组的缺陷。

作为最后一个示例，无论您是否将 associativeArray 定义为 Array ([])、Object({})、Regular Expression (//)、String("") 或任何其他 Javascript 对象，前面的代码都将起作用.

底线是——不要试图使用关联数组，它们是什么的代码——对象属性，而不是数组。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-10-07T15:09:17.820

它是一个**Object 字面**量（或者，有时是带有 Hash 类的库中的一个**vanilla 对象**）。

与以下内容相同：

```
var o = new Object();
o.wtf = null;
o.omg = null; 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-10-07T15:09:15.883

这是一个对象字面量。它实际上等效于以下内容：

```
var something = new Object();
something["wtf"] = null;
something["omg"] = null; 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-07T15:08:48.040

我相信它是一个具有 2 个属性的对象，WTF 和 OMG。

你可以说

```
something.wtf = "myMessage";
alert(something.wtf); 
```

查看 JSON.ORG

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-07T16:23:44.457

这段代码：

```
var something = {wtf:null} 
```

与以下效果相同：

```
var something={};
something.wtf=null; 
```

或者对于不必要的冗长：

```
var something=new Object();
something.wtf=null; 
```

记住最后一行与

```
something["wtf"]=null; 
```

所以你可以使用：

```
var myName="wtf";
something[myName]=null; 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-07T15:09:03.560

这是内联 JavaScript 对象实例化的示例。

# xml - 从 XML 到 XSD

> ID：178907
> 
> 赞同：4
> 
> 时间：2008-10-07T15:07:27.963
> 
> 标签：xml, xsd

如果我有一个复杂的 XML 文件，是否有一种便宜或免费的方法可以从中获得 XSD 的粗略近似值？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-02-24T22:43:46.743

一个好的 xml 到 xsd 转换器是 Trang。它是一个非常小的命令行工具，可以解决问题。它可以在 kam 的博客上找到 - [http://www.dotkam.com/2008/05/28/generate-xsd-from-xml/](http://www.dotkam.com/2008/05/28/generate-xsd-from-xml/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-07T15:08:36.150

如果您使用 Visual Studio，它包含一个名为 xsd.exe 的控制台程序，该程序可以自动从 xml 生成架构。

它还可以从模式中自动生成类或数据集。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-07T15:09:43.230

是的。有一些工具可以分析您的 XML 并提供 XSD。例如，Visual Studio 2005 和 2008 包括一个从 IDE 中创建 XSD 命令以及一个命令行工具 xsd.exe，它将执行此操作。

但是请注意，它只能从您提供的 XML 中推断出 XSD，因此 XSD 可能只能正确验证一个文件。创建 XSD 后，您应该考虑针对其他 XML 文件对其进行重构，以确保它正确符合您要验证的格式。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-07T15:15:17.010

XmlSpy 也有这个功能。如果它比VS更好，我不知道。但是对于使用 xml 和 xsds，我更喜欢 et 而不是 VS

# c# - 如何在左侧停靠的 MenuStrip 上绘制箭头？

> ID：178909
> 
> 赞同：0
> 
> 时间：2008-10-07T15:07:54.110
> 
> 标签：c#, .net, winforms, menustrip

我有一个 C# 表单，其中放置了一个 left-docking `MenuStrip`。这`MenuStrip`包含一些包含子菜单的菜单项，以及一些有效按钮的菜单项（单击它们会导致发生动作；注意，我意识到这不是一个好的设计）。

我想让具有与之关联的菜单的菜单项在菜单项上绘制向右箭头，就像上下文菜单一样。我已经分类`ToolStripProfessionalRenderer`并且可以`OnRenderArrow()`在适当的时间调用（例如，在`OnRenderItemText()`或类似的时间），但我似乎没有办法确定箭头的正确位置。

所以，这里有两个相互关联的问题：

1.  有没有办法强制在顶级菜单项上绘制箭头？
2.  如果没有，有没有办法确定菜单项上箭头的正确位置，以便`OnRenderArrow()`可以手动调用？

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-07T15:57:29.220

为什么不考虑使用 System.Windows.Forms.ToolStrip 而不是 MenuStrip。这将允许您内置箭头功能，甚至可以解决您遇到的不良设计问题。

如果您愿意，您可以指定工具条项目不显示图像而只显示文本。通过这种方式，您几乎可以完全模仿菜单条的功能，但可以免费使用“下拉箭头”。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-07T15:37:14.783

我能够将其作为解决方案一起破解，但我仍然想要一些不那么钝的东西：

```
protected override void OnRenderItemText(ToolStripItemTextRenderEventArgs e)
{
    base.OnRenderItemText(e);
    if (e.Item.GetType() == typeof(ToolStripMenuItem))
    {
        ToolStripMenuItem tsmi = (ToolStripMenuItem)e.Item;
        if (tsmi.HasDropDownItems && tsmi.OwnerItem == null)
        {
            Rectangle bounds = tsmi.Bounds;
            bounds.X = bounds.Right - 25;
            bounds.Width = 25;
            bounds.Y = 0;
            ToolStripArrowRenderEventArgs tsarea = new ToolStripArrowRenderEventArgs(
                e.Graphics,
                e.Item,
                bounds,
                e.TextColor,
                ArrowDirection.Right);
            OnRenderArrow(tsarea);
        }
    }
} 
```

# sql - 按共享元素对集合列表进行分区

> ID：178913
> 
> 赞同：5
> 
> 时间：2008-10-07T15:08:33.763
> 
> 标签：sql, algorithm, set

这是问题的要点：给定一个集合列表，例如：

```
[ (1,2,3), (5,2,6), (7,8,9), (6,12,13), (21,8,34), (19,20) ] 
```

返回集合的组列表，以便具有共享元素的集合在同一组中。

```
[ [ (1,2,3), (5,2,6), (6,12,13) ], [ (7,8,9), (21,8,34) ], [ (19,20) ] ] 
```

请注意粘性 - 集合 (6,12,13)​​ 与 (1,2,3) 没有共享元素，但由于 (5,2,6)，它们被放在同一个组中。

更复杂的是，我应该提一下，我并没有真正拥有这些整洁的集合，而是一个包含数百万行的 DB 表，如下所示：

```
element | set_id
----------------
1       | 1
2       | 1
3       | 1
5       | 2
2       | 2
6       | 2 
```

等等。所以我很想用 SQL 来做这件事，但我会对解决方案的总体方向感到满意。

**编辑**：将表列名称更改为 (element, set_id) 而不是 (key, group_id)，以使术语更加一致。请注意，Kev 的答案使用旧的列名。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-07T21:46:23.557

问题正是超图连通分量的计算：整数是顶点，集合是超边。计算连接组件的一种常用方法是一个接一个地泛洪它们：

*   对于所有 i = 1 到 N，请执行以下操作：
*   如果 i 已被某个 j < i 标记，则继续（我的意思是跳到下一个 i）
*   否则 flood_from(i,i)

其中 flood_from(i,j) 将被定义为

*   对于每个包含 i 的集合 S，如果它还没有被 j 标记，那么：
*   用 j 标记 S 并且对于 S 的每个元素 k，如果 k 还没有被 j 标记，则用 j 标记它，并调用 flood_from(k,j)

然后，集合的标签会为您提供您正在寻找的连接组件。

* * *

就数据库而言，该算法可以表示为：在数据库中添加一个 TAG 列，然后通过以下方式计算集合 i 的连通分量

*   S = 选择 set_id == i 的所有行
*   对于 S 中的行，将 TAG 设置为 i
*   S' = 选择未设置 TAG 且元素在元素 (S) 中的所有行
*   当 S' 不为空时，执行
*   ---- 为 S' 中的行设置 TAG 为 i
*   ---- S'' = 选择未设置 TAG 且元素在元素中的所有行（S'）
*   ---- S = S 联合 S'
*   ---- S' = S''
*   返回 set_id(S)

* * *

呈现此算法的另一种（理论）方式是说您正在寻找映射的不动点：

*   如果 A = {A [1] , ..., A [n] } 是一组集合，定义 union(A) = A [1] union ... union A [n]
*   如果 K = {k [1] , ..., k [p] } 是一个整数集合，定义发病率(K) = 与 K 相交的集合

然后如果 S 是一个集合，则通过在 S 上迭代 (incidences)o(union) 直到达到一个固定点，获得 S 的连通分量：

1.  K = S
2.  K' = 发生率（联合（K））。
3.  如果 K == K'，则返回 K，否则 K = K' 并转到 2。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-07T15:12:03.303

您可以将其视为一个图问题，其中集合 (1,2,3) 通过 2 连接到集合 (5,2,6)。然后使用标准算法来细化连接的子图。

这是一个快速的python实现：

```
nodes = [ [1,2,3], [2,4,5], [6,7,8], [10,11,12], [7,10,13], [12], [] ]
links = [ set() for x in nodes ]

#first find the links
for n in range(len(nodes)):
    for item in nodes[n]:
        for m in range(n+1, len(nodes)):
            if (item in nodes[m]):
                links[n].add(m)
                links[m].add(n)

sets = []
nodes_not_in_a_set = range(len(nodes))

while len(nodes_not_in_a_set) > 0:
    nodes_to_explore = [nodes_not_in_a_set.pop()]
    current_set = set()
    while len(nodes_to_explore) > 0:
        current_node = nodes_to_explore.pop()
        current_set.add(current_node)
        if current_node in nodes_not_in_a_set:
            nodes_not_in_a_set.remove(current_node)
        for l in links[current_node]:
            if l not in current_set and l not in nodes_to_explore:
                nodes_to_explore.append(l)
    if len(current_set) > 0:
        sets.append(current_set)

for s in sets:
    print [nodes[n] for n in s] 
```

输出：

```
[[]]
[[6, 7, 8], [10, 11, 12], [7, 10, 13], [12]]
[[1, 2, 3], [2, 4, 5]] 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-07T15:16:14.967

这可能效率很低，但至少应该可以：从一个键开始，选择包含该键的所有组，选择这些组的所有键，选择包含这些键的所有组等，并且只要一个步骤不会添加新的键或组，您有一个子图的所有组的列表。排除这些并从头开始重复，直到没有数据为止。

我认为，就 SQL 而言，这需要一个存储过程。WITH RECURSIVE 可能会以某种方式帮助您，但我还没有任何经验，而且我不确定它在您的数据库后端是否可用。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-07T15:59:22.133

在考虑了更多之后，我想出了这个：

1.  创建一个名为`groups`列的表`(group_id, set_id)`
2.  按 对`sets`表格进行排序`element`。现在应该很容易找到重复的元素。
3.  遍历 sets 表，当您找到重复元素时，请执行以下操作：
    1.  如果表中`set_id`存在其中一个字段`groups`，则添加另一个具有相同的`group_id`.
    2.  如果表中都不`set_id`存在，则`groups`生成一个新的组ID，并将两个`set_id`s都添加到`groups`表中。

最后我应该有一个`groups`包含所有集合的表。

这不是纯 SQL，但看起来像 O(nlogn)，所以我想我可以忍受。

[马特的回答](https://stackoverflow.com/questions/178913/partition-a-list-of-sets-by-shared-elements#178940)似乎更正确，但我不确定如何在我的情况下实现它。

# ios - 如何将图片保存到 iPhone 照片库？

> ID：178915
> 
> 赞同：199
> 
> 时间：2008-10-07T15:08:36.260
> 
> 标签：ios, iphone, cocoa-touch, camera, uiimage

我需要做什么才能将我的程序生成的图像（可能来自相机，也可能不是）保存到 iPhone 上的系统照片库中？

* * *

## 回答 #1

> 赞同：417
> 
> 时间：2008-10-07T15:32:02.110

您可以使用此功能：

```
UIImageWriteToSavedPhotosAlbum(UIImage *image, 
                               id completionTarget, 
                               SEL completionSelector, 
                               void *contextInfo); 
```

如果您想在保存完成时收到通知，您只需要**completionTarget**、**completionSelector**和**contextInfo**`UIImage`，否则您可以传入`nil`.

参见[官方文档`UIImageWriteToSavedPhotosAlbum()`](https://developer.apple.com/documentation/uikit/1619125-uiimagewritetosavedphotosalbum?language=objc)。

* * *

## 回答 #2

> 赞同：63
> 
> 时间：2010-09-21T13:53:03.990

**在 iOS 9.0 中已弃用。**

使用 iOS 4.0+ AssetsLibrary 框架的 UIImageWriteToSavedPhotosAlbum 方法比 UIImageWriteToSavedPhotosAlbum 快得多

```
 ALAssetsLibrary *library = [[ALAssetsLibrary alloc] init];

    [library writeImageToSavedPhotosAlbum:[image CGImage] orientation:(ALAssetOrientation)[image imageOrientation] completionBlock:^(NSURL *assetURL, NSError *error){
    if (error) {
    // TODO: error handling
    } else {
    // TODO: success handling
    }
}];
[library release]; 
```

* * *

## 回答 #3

> 赞同：32
> 
> 时间：2013-12-24T07:36:57.473

最简单的方法是：

```
UIImageWriteToSavedPhotosAlbum(myUIImage, nil, nil, nil); 
```

对于`Swift`，可以参考[使用 swift 保存到 iOS 照片库](https://www.hackingwithswift.com/read/13/5/saving-to-the-ios-photo-library)

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2013-04-02T03:35:26.343

要记住的一件事：如果您使用回调，请确保您的选择器符合以下形式：

```
- (void) image: (UIImage *) image didFinishSavingWithError: (NSError *) error contextInfo: (void *) contextInfo; 
```

否则，您将因以下错误而崩溃：

`[NSInvocation setArgument:atIndex:]: index (2) out of bounds [-1, 1]`

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2010-03-30T02:16:53.373

只需像这样将图像从数组传递给它

```
-(void) saveMePlease {

//Loop through the array here
for (int i=0:i<[arrayOfPhotos count]:i++){
         NSString *file = [arrayOfPhotos objectAtIndex:i];
         NSString *path = [get the path of the image like you would in DOCS FOLDER or whatever];
         NSString *imagePath = [path stringByAppendingString:file];
         UIImage *image = [[[UIImage alloc] initWithContentsOfFile:imagePath]autorelease];

         //Now it will do this for each photo in the array
         UIImageWriteToSavedPhotosAlbum(image, nil, nil, nil);
        }
} 
```

抱歉，错字有点匆忙，但你明白了

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2013-08-13T23:01:51.243

保存一组照片时，不要使用 for 循环，请执行以下操作

```
-(void)saveToAlbum{
   [self performSelectorInBackground:@selector(startSavingToAlbum) withObject:nil];
}
-(void)startSavingToAlbum{
   currentSavingIndex = 0;
   UIImage* img = arrayOfPhoto[currentSavingIndex];//get your image
   UIImageWriteToSavedPhotosAlbum(img, self, @selector(image:didFinishSavingWithError:contextInfo:), nil);
}
- (void)image: (UIImage *) image didFinishSavingWithError: (NSError *) error contextInfo: (void *) contextInfo{ //can also handle error message as well
   currentSavingIndex ++;
   if (currentSavingIndex >= arrayOfPhoto.count) {
       return; //notify the user it's done.
   }
   else
   {
       UIImage* img = arrayOfPhoto[currentSavingIndex];
       UIImageWriteToSavedPhotosAlbum(img, self, @selector(image:didFinishSavingWithError:contextInfo:), nil);
   }
} 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2015-03-18T21:32:30.117

在**斯威夫特**：

```
 // Save it to the camera roll / saved photo album
    // UIImageWriteToSavedPhotosAlbum(self.myUIImageView.image, nil, nil, nil) or 
    UIImageWriteToSavedPhotosAlbum(self.myUIImageView.image, self, "image:didFinishSavingWithError:contextInfo:", nil)

    func image(image: UIImage!, didFinishSavingWithError error: NSError!, contextInfo: AnyObject!) {
            if (error != nil) {
                // Something wrong happened.
            } else {
                // Everything is alright.
            }
    } 
```

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2015-10-06T04:58:29.637

**下面的功能会起作用。您可以从这里复制并粘贴到那里...**

```
-(void)savePhotoToAlbum:(UIImage*)imageToSave {

    CGImageRef imageRef = imageToSave.CGImage;
    NSDictionary *metadata = [NSDictionary new]; // you can add
    ALAssetsLibrary *library = [[ALAssetsLibrary alloc] init];

    [library writeImageToSavedPhotosAlbum:imageRef metadata:metadata completionBlock:^(NSURL *assetURL,NSError *error){
        if(error) {
            NSLog(@"Image save eror");
        }
    }];
} 
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2019-01-18T08:44:48.247

斯威夫特 4

```
func writeImage(image: UIImage) {
    UIImageWriteToSavedPhotosAlbum(image, self, #selector(self.finishWriteImage), nil)
}

@objc private func finishWriteImage(_ image: UIImage, didFinishSavingWithError error: NSError?, contextInfo: UnsafeRawPointer) {
    if (error != nil) {
        // Something wrong happened.
        print("error occurred: \(String(describing: error))")
    } else {
        // Everything is alright.
        print("saved success!")
    }
} 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2010-05-20T01:33:32.690

我的最后一个答案会做到这一点..

对于您要保存的每个图像，将其添加到 NSMutableArray

```
 //in the .h file put:

NSMutableArray *myPhotoArray;

///then in the .m

- (void) viewDidLoad {

 myPhotoArray = [[NSMutableArray alloc]init];

}

//However Your getting images

- (void) someOtherMethod { 

 UIImage *someImage = [your prefered method of using this];
[myPhotoArray addObject:someImage];

}

-(void) saveMePlease {

//Loop through the array here
for (int i=0:i<[myPhotoArray count]:i++){
         NSString *file = [myPhotoArray objectAtIndex:i];
         NSString *path = [get the path of the image like you would in DOCS FOLDER or whatever];
         NSString *imagePath = [path stringByAppendingString:file];
         UIImage *image = [[[UIImage alloc] initWithContentsOfFile:imagePath]autorelease];

         //Now it will do this for each photo in the array
         UIImageWriteToSavedPhotosAlbum(image, nil, nil, nil);
        }
} 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2011-03-11T11:46:05.020

```
homeDirectoryPath = NSHomeDirectory();
unexpandedPath = [homeDirectoryPath stringByAppendingString:@"/Pictures/"];

folderPath = [NSString pathWithComponents:[NSArray arrayWithObjects:[NSString stringWithString:[unexpandedPath stringByExpandingTildeInPath]], nil]];

unexpandedImagePath = [folderPath stringByAppendingString:@"/image.png"];

imagePath = [NSString pathWithComponents:[NSArray arrayWithObjects:[NSString stringWithString:[unexpandedImagePath stringByExpandingTildeInPath]], nil]];

if (![[NSFileManager defaultManager] fileExistsAtPath:folderPath isDirectory:NULL]) {
    [[NSFileManager defaultManager] createDirectoryAtPath:folderPath attributes:nil];
} 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2015-07-20T08:38:00.623

根据上面的一些答案，我为此创建了一个 UIImageView 类别。

头文件：

```
@interface UIImageView (SaveImage) <UIActionSheetDelegate>
- (void)addHoldToSave;
@end 
```

执行

```
@implementation UIImageView (SaveImage)
- (void)addHoldToSave{
    UILongPressGestureRecognizer* longPress = [[UILongPressGestureRecognizer alloc] initWithTarget:self action:@selector(handleLongPress:)];
    longPress.minimumPressDuration = 1.0f;
    [self addGestureRecognizer:longPress];
}

-  (void)handleLongPress:(UILongPressGestureRecognizer*)sender {
    if (sender.state == UIGestureRecognizerStateEnded) {

        UIActionSheet* _attachmentMenuSheet = [[UIActionSheet alloc] initWithTitle:nil
                                                                          delegate:self
                                                                 cancelButtonTitle:@"Cancel"
                                                            destructiveButtonTitle:nil
                                                                 otherButtonTitles:@"Save Image", nil];
        [_attachmentMenuSheet showInView:[[UIView alloc] initWithFrame:self.frame]];
    }
    else if (sender.state == UIGestureRecognizerStateBegan){
        //Do nothing
    }
}
-(void)actionSheet:(UIActionSheet *)actionSheet clickedButtonAtIndex:(NSInteger)buttonIndex{
    if  (buttonIndex == 0) {
        UIImageWriteToSavedPhotosAlbum(self.image, nil,nil, nil);
    }
}

@end 
```

现在只需在你的 imageview 上调用这个函数：

```
[self.imageView addHoldToSave]; 
```

您可以选择更改 minimumPressDuration 参数。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2016-04-24T04:56:26.983

在**斯威夫特 2.2**

```
UIImageWriteToSavedPhotosAlbum(image: UIImage, _ completionTarget: AnyObject?, _ completionSelector: Selector, _ contextInfo: UnsafeMutablePointer<Void>) 
```

如果您不想在图像保存完成时收到通知，那么您可以在**completionTarget**、**completionSelector**和**contextInfo**参数中传递 nil。

例子：

```
UIImageWriteToSavedPhotosAlbum(image, self, #selector(self.imageSaved(_:didFinishSavingWithError:contextInfo:)), nil)

func imageSaved(image: UIImage!, didFinishSavingWithError error: NSError?, contextInfo: AnyObject?) {
        if (error != nil) {
            // Something wrong happened.
        } else {
            // Everything is alright.
        }
    } 
```

这里要注意的重要一点是，您观察图像保存的方法应该具有这 3 个参数，否则您将遇到 NSInvocation 错误。

希望能帮助到你。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2014-01-22T11:21:51.693

你可以用这个

```
dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^{
   UIImageWriteToSavedPhotosAlbum(img.image, nil, nil, nil);
}); 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2020-09-24T12:43:08.147

对于 Swift 5.0

我使用此代码将图像复制到我的应用程序创建的相册中；当我想复制图像文件时，我调用“startSavingPhotoAlbume()”函数。首先，我从 App 文件夹中获取 UIImage，然后将其保存到相册。因为它无关紧要，所以我没有展示如何从 App 文件夹中读取图像。

```
var saveToPhotoAlbumCounter = 0

func startSavingPhotoAlbume(){
    saveToPhotoAlbumCounter = 0
    saveToPhotoAlbume()
}

func saveToPhotoAlbume(){  
    let image = loadImageFile(fileName: imagefileList[saveToPhotoAlbumCounter], folderName: folderName)
    UIImageWriteToSavedPhotosAlbum(image!, self, #selector(image(_:didFinishSavingWithError:contextInfo:)), nil)
}

@objc func image(_ image: UIImage, didFinishSavingWithError error: NSError?, contextInfo: UnsafeRawPointer) {
    if (error != nil) {
        print("ptoto albume savin error for \(imageFileList[saveToPhotoAlbumCounter])")
    } else {

        if saveToPhotoAlbumCounter < imageFileList.count - 1 {
            saveToPhotoAlbumCounter += 1
            saveToPhotoAlbume()
        } else {
            print("saveToPhotoAlbume is finished with \(saveToPhotoAlbumCounter) files")
        }
    }
} 
```

# .net - 如何为 TabControlAdv 的选项卡标题创建上下文菜单

> ID：178919
> 
> 赞同：0
> 
> 时间：2008-10-07T15:08:55.027
> 
> 标签：.net, syncfusion

我想在 Syncfusion TabControlAdv 控件中为我的选项卡标题提供一个上下文菜单，并为每个选项卡内的控件提供一个单独的菜单。可能的菜单项将是“添加选项卡”、“删除选项卡”和“克隆选项卡”，当用户在我的控件（将有一个数据网格）中间单击鼠标右键时，它们都没有多大意义。有人可以分享一个链接或代码片段来展示我如何做到这一点吗？

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-08-30T06:27:14.953

您是否尝试在[Syncfusion 论坛](http://www.syncfusion.com/support/forums)上发布您的问题？

# jquery - jQuery ajax 调用后 IE 7 重定向

> ID：178921
> 
> 赞同：4
> 
> 时间：2008-10-07T15:08:57.273
> 
> 标签：jquery, ajax, internet-explorer-7

我的文件中有以下代码，用于从 AJAX 调用加载带有 HTML 的 div：

```
$('#searchButton').click( function() {
    $('#inquiry').load('/search.php?pid=' + $('#searchValue').val());
}); 
```

这在 Firefox 和 Google Chrome 中运行良好，但每当我在 IE 中进行搜索时，我都会被重定向回 index.php。我从 Firebug 中获取了 URL 并将其粘贴到 IE 中，并且没有发生重定向，我只是得到了应该返回的输出。

我还尝试将其更改为 $.get() 请求和完整的 $.ajax() 请求，但仍然是相同的重定向。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-07T15:12:33.460

IE 以不同的方式处理默认事件（还要注意在文本字段中按回车键）。IE 导致某些默认事件处理程序触发。如果 searchButton 是 HREF 为 "" 的链接，它将重新加载当前页面。您可以尝试将 href 设置为“javascript:void(0)”或执行以下操作：

```
$('#searchButton').click( function(e) {
    $('#inquiry').load('/search.php?pid=' + $('#searchValue').val());
    e.preventDefault();
}); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-07T15:28:28.513

更多乐趣。我有以这种形式包装的输入文本和按钮：

```
<form onSubmit="return false;">
[HTML]
</form> 
```

而 IE 似乎忽略了返回错误。我尝试将 jQuery 函数修改为像史蒂夫的那样，但它仍然不正确地刷新。

我删除了表单标签并处理了它。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-07T22:17:31.747

将表单的 action 属性设置为 javascript 函数（例如您的搜索处理函数）或“return false”

当您按 Enter 键时，MSIE 正在触发表单操作

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-07T22:37:04.763

您的函数应返回 false 以阻止按钮的提交操作。不过，我不知道 jQuery 是如何处理的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2014-05-29T08:56:57.523

您应该像以下方式一样防止默认值..

```
var searchbutton = $('#searchButton');
var inquirysearchvalue = $('#inquiry').load('/search.php?pid=' + $('#searchValue');

searchbutton.click( function(e) {
    inquirysearchvalue.val());
    e.preventDefault();
}); 
```

# c++ - 迭代器..为什么要使用它们？

> ID：178934
> 
> 赞同：22
> 
> 时间：2008-10-07T15:10:49.937
> 
> 标签：c++, stl, iterator

在 STL 库中，一些容器具有迭代器，并且通常认为它们是迭代这些容器的更好方法，而不是简单的 for 循环，例如

```
for ( int i=0; i < vecVector.size(); i++ )
{

..

} 
```

谁能告诉我为什么以及在什么情况下我应该使用迭代器以及在什么情况下上面的代码片段？

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2008-10-07T15:20:10.230

请注意，vector 的通常实现不会使用“int”作为索引/大小的类型。因此，您的代码至少会引发编译器警告。

### 通用性

迭代器增加了代码的通用性。

例如：

```
typedef std::vector<int> Container ;

void doSomething(Container & p_aC)
{
    for(Container::iterator it = p_aC.begin(), itEnd = p_aC.end(); it != itEnd; ++it)
    {
       int & i = *it ; // i is now a reference to the value iterated
       // do something with "i"
    }
} 
```

现在，让我们假设您将向量更改为列表（因为在您的情况下，列表现在更好）。您只需要更改 typedef 声明，并重新编译代码。

如果您改用基于索引的代码，则需要重新编写它。

### 使用权

迭代器应该被视为一种超级指针。它“指向”值（或者，在映射的情况下，指向键/值对）。

但它具有移动到容器中下一个项目的方法。或者上一个。一些容器甚至提供随机访问（向量和双端队列）。

### 算法

大多数 STL 算法都适用于迭代器或迭代器范围（同样，因为通用性）。您将无法在此处使用索引。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2008-10-07T15:14:31.817

使用迭代器可以让您的代码与容器的实现无关。如果您的容器的随机访问很便宜，那么在性能方面没有太大差异。

但在很多情况下，您不会知道是否是这种情况。如果您尝试在链接列表上使用您的方法，例如，使用下标，则容器将不得不在每次迭代时遍历列表以找到您的元素。

因此，除非您确定对容器的随机访问很便宜，否则请使用迭代器。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-07T16:39:47.607

如果您使用迭代器作为函数的参数，您可以将其与所使用的“容器”类型分离。例如，您可以将函数的结果定向到控制台输出而不是向量（下面的示例）。这个技巧对于减少类之间的耦合非常有效。松散耦合的类更容易测试。

```
#include <iostream>
#include <vector>
#include <algorithm>

using namespace std;

template <typename InputIterator, typename OutputIterator>
void AddOne(InputIterator begin, InputIterator end, OutputIterator dest)
{
    while (begin != end)
    {
        *dest = *begin + 1;
        ++dest;
        ++begin;
    }
}

int _tmain(int argc, _TCHAR* argv[])
{
    vector<int> data;
    data.push_back(1);
    data.push_back(2);
    data.push_back(3);

    // Compute intermediate results vector and dump to console
    vector<int> results;
    AddOne(data.begin(), data.end(), back_inserter(results));
    copy(results.begin(), results.end(), ostream_iterator<int>(cout, " "));
    cout << endl;

    // Compute results and send directly to console, no intermediate vector required
    AddOne(data.begin(), data.end(), ostream_iterator<int>(cout, " "));
    cout << endl;

    return 0;
} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-07T15:17:41.640

在您的示例中，对 vecVector.size() 的调用效率低于使用迭代器。迭代器本质上使您不必担心被迭代的容器的大小。此外，迭代器不必按顺序进行。它只需要以它认为合适的任何方式响应 .next 调用。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-07T15:19:32.213

好吧，一方面，如果您将该向量转换为列表，则上述内容将不再有效。

迭代器允许您创建不需要知道它们工作的容器类型的函数模板。您甚至可以执行以下操作：

```
#include <algorithm>

void printvalue(double s)
{
    // Do something with s
}

int _tmain(int argc, _TCHAR* argv[])
{
    double s[20] = {0};

    std::for_each(s, s+20, printvalue);

    return 0;
} 
```

这是因为标准指针也是 for_each 的有效迭代器。

戴夫

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-08T08:28:30.250

迭代器主要是更高级别的抽象。

您的代码段假定容器可以被索引。这适用于`std::vector<>`其他一些容器，例如原始数组。

但是`std::set<>`完全没有索引，并且索引运算符`std::map<>`会将提供给它的任何参数插入到映射中 - 而不是您的`for`-loop 中的预期行为。

此外，性能问题只有在测量和证明时才是问题。

# build-process - 如何解压缩 BAT 文件目录中的最新文件？

> ID：178936
> 
> 赞同：3
> 
> 时间：2008-10-07T15:11:13.680
> 
> 标签：build-process, batch-file, unzip

我正在开发一个构建系统。构建系统将结果以 zip 文件的形式发布到目录中。不幸的是，我没有简单的方法知道 zip 文件的名称，因为它带有时间戳。对于接下来的操作，我必须将这个 zip 文件解压缩到某个特定位置，然后再进行一些文件操作。

我想我可以更改构建系统，因此我从命令行指定结果 zip 文件的名称，但是，我认为找出哪个是最新文件并解压缩它可能是最简单的（如果前面的过程是成功的）。

如何发出仅对目录中最新的 zip 文件生效而忽略所有其他文件的解压缩命令？

编辑：我决定改用 ANT 中的功能来完成这项任务。但是，提高袖子仍然是一个巧妙的技巧……感谢您的回答！

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-07T15:23:47.837

这应该这样做：

```
FOR /F usebackq %%i IN (`DIR /B /O-D *.ZIP`) DO UNZIP %%i && GOTO DONE || GOTO DONE
:DONE 
```

这工作如下：

*   `DIR /B /O-D *.ZIP`以“裸”（即仅名称）格式以相反的日期顺序列出所有 ZIP 文件。
*   `FOR /F usebackq`用于循环命令的输出。
*   `&& GOTO DONE || GOTO DONE`确保`UNZIP`仅针对第一个文件运行。如果由于某种原因解压缩失败，您需要同时使用`&&`(and) 和`||`(or)。

您需要更改`UNZIP %%i`要使用的任何解压缩命令。

**编辑** 只要 Zip 文件名不包含任何空格，上述内容就可以工作。如果要处理带空格的文件名，请使用以下变体：

```
FOR /F "tokens=*" %%i IN ('DIR /B /O-D *.ZIP') DO UNZIP "%%i" && GOTO DONE || GOTO DONE
:DONE 
```

区别在于：

*   “tokens=*”选项返回整个文件名，即使它包含空格。

*   传递给 UNZIP 的文件名被引用

*   此变体对 DIR 命令使用单引号，因此不需要“usebackq”选项。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-07T15:27:22.230

如果 Cygwin 或其他类 Unix 环境是替代方案

```
unzip "$(ls -tr *zip | tail -n1)" 
```

会做的

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-10-07T15:14:11.677

我认为您需要 7-zip 才能编写压缩/解压缩脚本。

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2008-10-07T15:12:18.017

当您有 powershell 或控制台应用程序时，为什么要使用 bat 文件？

# .net - 使用 Javascript 过滤 div 的“列表”

> ID：178948
> 
> 赞同：3
> 
> 时间：2008-10-07T15:14:20.197
> 
> 标签：.net, asp.net, jquery, webforms

我有一个中继器，它为从某个方法返回的每个项目输出如下所示的 div。

```
<div class="editor-area">
    <div class="title">the title</div>
    <div>the description</div>
    <div class="bottom-bar">
        <a href="link">Modify</a>
        <a href="link2">Delete</a>
    </div>
</div> 
```

我需要在页面上有一个文本框，允许用户根据标题字段中的内容过滤列表。我希望它在用户输入时发生。

我可以在不寻求帮助的情况下完成这件事，但我想把它做好。我正在使用 ASP.Net 2.0 WebForms（不幸的是），如果它对此有用的话，我可以使用 jQuery（我对它的经验很少）。

任何提示或样品将不胜感激。

如果过滤操作需要几秒钟，你如何防止它锁定屏幕？我应该对什么事件进行过滤？jQuery 中有什么东西可以让 javascript 变得更简洁吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-07T15:24:25.870

是的，这对于 jQuery 来说非常简单。首先隐藏所有内容：

```
$("div.title").hide(); 
```

（将“div”类型的元素与“title”类匹配。）现在显示匹配项：

```
$("div.title:contains(searchText)").show(); 
```

[“包含”的帮助。](http://docs.jquery.com/Selectors/contains#text)

除非您的页面很大，否则不应该花费“几秒钟”来完成此操作。您可以在 onKeyDown 和 onChange 中执行此操作。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-07T16:53:01.447

克雷格非常接近。将 ".parent()" 放在 ".hide()" 或 ".show()" 之前以显示或隐藏父 div。

至于您的第二条评论，这是一个单独的问题，但是是的，您需要考虑非文本输入。另一个想法是在过滤器文本框为空白时显示所有内容。

# visual-c++ - 用 gmp 添加浮点数会给出“正确”的结果，有点像

> ID：178952
> 
> 赞同：1
> 
> 时间：2008-10-07T15:14:39.087
> 
> 标签：visual-c++, floating-point, bignum, gmp

在下面的代码中，我使用`mpf_add`添加两个浮点值的字符串表示。我现在不明白的是为什么`2.2 + 3.2 = 5.39999999999999999999999999999999999999`。我会认为这`gmp`是足够聪明的给予`5.4`。

我不理解 gmp 如何浮动？

（顺便说一句，当我第一次写这篇文章时，我不确定如何插入小数点，因此最后是加/减数字）

```
BSTR __stdcall FBIGSUM(BSTR p1, BSTR p2 ) {
  USES_CONVERSION;

  F(n1);
  F(n2);
  F(res);

  LPSTR sNum1 = W2A( p1 );
  LPSTR sNum2 = W2A( p2 );

  mpf_set_str( n1, sNum1, 10 );
  mpf_set_str( n2, sNum2, 10 );

  mpf_add( res, n1, n2 );

  char * buff =  (char *) _alloca( 1024 );
  char expBuffer[ 20 ];
  mp_exp_t exp;

  mpf_get_str(buff, &exp, 10, 0, res);

  char * temp = ltoa( (long) exp, expBuffer, 10 );
  if (exp >= 0) {
    strcat(buff, "+" );
  }
  strcat(buff, expBuffer );

  BSTR bResult = _com_util::ConvertStringToBSTR( buff );
  return bResult;
} 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-07T15:18:00.127

这是因为在二进制环境中使用浮点运算的固有错误。

有关详细信息，请参阅[IEEE 754](http://en.wikipedia.org/wiki/IEEE_754)标准。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-07T15:23:22.987

[沃伦](https://stackoverflow.com/users/4418/warren) [说](https://stackoverflow.com/questions/178952/adding-floats-with-gmp-gives-correct-results-sort-of#178978)了什么。

如果您使用二进制编码的十进制而不是浮点数，您可能会得到更好的结果，尽管我不能真正将您引导到任何库。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-08T18:28:44.157

我最终自己回答了这个问题。对我来说，解决方案是用我以前在学校做的代码来做。该方法的工作原理如下：

1.  取每个数字并确保小数点右侧的位数相同。因此，如果添加`2.1`and `3.457`，则将第一个“规范化”为`2.100`. 记录小数点右侧的位数，在本例中为三位。
2.  现在删除小数点并使用`mpz_add`将两个数字相加，现在变成`2100`和`3457`。结果是`5557`。
3.  最后，从右边重新插入小数点三个字符（在这种情况下），给出正确答案`5.557`。

我在 VBScript 中对解决方案进行了原型设计（下）

```
function fadd( n1, n2 )
    dim s1, s2, max, mul, res
    normalise3 n1, n2, s1, s2, max
    s1 = replace( s1, ".", "" )
    s2 = replace( s2, ".", "" )
    mul = clng(s1) + clng(s2)
    res = left( mul, len(mul) - max ) & "." & mid( mul, len( mul ) - max + 1 )
    fadd = res
end function

sub normalise3( byval n1, byval n2, byref s1, byref s2, byref numOfDigits )
    dim a1, a2
    dim max
    if instr( n1, "." ) = 0 then n1 = n1 & "."
    if instr( n2, "." ) = 0 then n2 = n2 & "."
    a1 = split( n1, "." )
    a2 = split( n2, "." )
    max = len( a1(1) )
    if len( a2(1) ) > max then max = len( a2( 1 ) )
    s1 = a1(0) & "." & a1(1) & string( max - len( a1( 1 )), "0" )
    s2 = a2(0) & "." & a2(1) & string( max - len( a2( 1 )), "0" )
    numOfDigits = max
end sub 
```

最后是 Visual C++（下）。

```
#define Z(x) mpz_t x; mpz_init( x );

BSTR __stdcall FADD( BSTR p1, BSTR p2 ) {
  USES_CONVERSION;

  LPSTR sP1 = W2A( p1 );
  LPSTR sP2 = W2A( p2 );

  char LeftOf1[ 1024 ];
  char RightOf1[ 1024 ];
  char LeftOf2[ 1024 ];
  char RightOf2[ 1024 ];
  char * dotPos;
  long numOfDigits;
  int i;
  int amtOfZeroes;

  dotPos = strstr( sP1, "." );
  if ( dotPos == NULL ) {
    strcpy( LeftOf1, sP1 );
    *RightOf1 = '\0';
  } else {
    *dotPos = '\0';
    strcpy( LeftOf1, sP1 );
    strcpy( RightOf1, (dotPos + 1) );
  }

  dotPos = strstr( sP2, "." );
  if ( dotPos == NULL ) {
    strcpy( LeftOf2, sP2 );
    *RightOf2 = '\0';
  } else {
    *dotPos = '\0';
    strcpy( LeftOf2, sP2 );
    strcpy( RightOf2, (dotPos + 1) );
  }

  numOfDigits = strlen( RightOf1 ) > strlen( RightOf2 ) ? strlen( RightOf1 ) : strlen( RightOf2 );

  strcpy( sP1, LeftOf1 );
  strcat( sP1, RightOf1 );
  amtOfZeroes = numOfDigits - strlen( RightOf1 );
  for ( i = 0; i < amtOfZeroes; i++ ) {
    strcat( sP1, "0" );
  }
  strcpy( sP2, LeftOf2 );
  strcat( sP2, RightOf2 );
  amtOfZeroes = numOfDigits - strlen( RightOf2 );
  for ( i = 0; i < amtOfZeroes; i++ ) {
    strcat( sP2, "0" );
  }

  Z(n1);
  Z(n2);
  Z(res);

  mpz_set_str( n1, sP1, 10 );
  mpz_set_str( n2, sP2, 10 );
  mpz_add( res, n1, n2 );

  char * buff =  (char *) _alloca( mpz_sizeinbase( res, 10 ) + 2 + 1 );

  mpz_get_str(buff, 10, res);

  char * here = buff + strlen(buff) - numOfDigits; 

  memmove( here + 1, here, strlen(buff)); // plus trailing null
  *(here) = '.';

  BSTR bResult = _com_util::ConvertStringToBSTR( buff );
  return bResult;
} 
```

我接受 C 有点……嗯……狡猾，所以请随时批评它。感谢所有有用的评论。

我也从这里开始实施 FSUB 和 FMUL。FDIV 几乎没有那么令人满意，最终有三个版本并使用有理数。

# regex - flex（词法分析器）正则表达式 - 重用定义

> ID：178963
> 
> 赞同：1
> 
> 时间：2008-10-07T15:15:58.303
> 
> 标签：regex, flex-lexer, lexical-analysis

我有这个工作定义：

```
IDENTIFIER   [a-zA-Z][a-zA-Z0-9]* 
```

我不想一直重复 [a-zA-Z] 和 [0-9]，所以我做了两个新定义

```
DIGIT    [0-9]
VALID    [a-zA-Z] 
```

如何重写 IDENTIFIER 规则以使用 DIGIT 和 VALID 定义？

我不知道如何进行“第二次”比赛，我被困在这里：

```
IDENTIFIER {VALID}[{VALID}{DIGIT}]* // This syntax is incorrect 
```

谢谢。

编辑：我正在使用的整个测试程序：http: [//pastebin.com/f5b64183f](http://pastebin.com/f5b64183f)。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-07T15:30:43.937

看起来您实际上想要：

```
IDENTIFIER {VALID}({VALID}|{DIGIT})* 
```

`[{VALID}{DIGIT}]`解决`[[A-Za-z][0-9]]`哪个不是合法的构造。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2008-10-07T15:19:16.177

我认为这会做到，但我无法测试它。你有样本数据吗？

```
(?:[a-zA-Z])+(?:[0-9])+ 
```

# javascript - 提交 POST 表单后，打开一个显示结果的新窗口

> ID：178964
> 
> 赞同：154
> 
> 时间：2008-10-07T15:16:01.567
> 
> 标签：javascript, html, post

[JavaScript 发布请求（如表单提交](https://stackoverflow.com/q/133925)）向您展示了如何提交您通过 JavaScript 中的 POST 创建的表单。下面是我修改后的代码。

```
var form = document.createElement("form");

form.setAttribute("method", "post");
form.setAttribute("action", "test.jsp");

var hiddenField = document.createElement("input");  

hiddenField.setAttribute("name", "id");
hiddenField.setAttribute("value", "bob");
form.appendChild(hiddenField);
document.body.appendChild(form); // Not entirely sure if this is necessary          
form.submit(); 
```

我想做的是在新窗口中打开结果。我目前正在使用这样的东西在新窗口中打开页面：

```
onclick = window.open(test.html, '', 'scrollbars=no,menubar=no,height=600,width=800,resizable=yes,toolbar=no,status=no'); 
```

* * *

## 回答 #1

> 赞同：226
> 
> 时间：2008-10-07T15:23:31.410

添加

```
<form target="_blank" ...></form> 
```

或者

```
form.setAttribute("target", "_blank"); 
```

根据您的表单定义。

* * *

## 回答 #2

> 赞同：134
> 
> 时间：2008-10-08T00:54:56.107

如果您想按照问题中的方式从 Javascript 创建和提交表单，并且想要创建具有自定义功能的弹出窗口，我建议使用此解决方案（我将评论放在我添加的行上方）：

```
var form = document.createElement("form");
form.setAttribute("method", "post");
form.setAttribute("action", "test.jsp");

// setting form target to a window named 'formresult'
form.setAttribute("target", "formresult");

var hiddenField = document.createElement("input");              
hiddenField.setAttribute("name", "id");
hiddenField.setAttribute("value", "bob");
form.appendChild(hiddenField);
document.body.appendChild(form);

// creating the 'formresult' window with custom features prior to submitting the form
window.open('test.html', 'formresult', 'scrollbars=no,menubar=no,height=600,width=800,resizable=yes,toolbar=no,status=no');

form.submit(); 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2012-09-24T20:55:06.947

```
var urlAction = 'whatever.php';
var data = {param1:'value1'};

var $form = $('<form target="_blank" method="POST" action="' + urlAction + '">');
$.each(data, function(k,v){
    $form.append('<input type="hidden" name="' + k + '" value="' + v + '">');
});
$form.submit(); 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2017-01-07T20:43:25.043

流窗口最简单的工作解决方案（在 Chrome 上测试）：

```
<form action='...' method=post target="result" onsubmit="window.open('','result','width=800,height=400');">
    <input name="..">
    ....
</form> 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-03-06T01:21:29.167

我知道这个基本方法：

1)

```
<input type=”image” src=”submit.png”&gt; (in any place) 
```

2)

```
<form name=”print”&gt;
<input type=”hidden” name=”a” value=”&lt;?= $a ?>”&gt;
<input type=”hidden” name=”b” value=”&lt;?= $b ?>”&gt;
<input type=”hidden” name=”c” value=”&lt;?= $c ?>”&gt;
</form> 
```

3)

```
<script>
$(‘#submit’).click(function(){
    open(”,”results”);
    with(document.print)
    {
        method = “POST”;
        action = “results.php”;
        target = “results”;
        submit();
    }
});
</script> 
```

作品！

# performance - log4net 日志记录方法（调试、信息等）有多快？

> ID：178973
> 
> 赞同：6
> 
> 时间：2008-10-07T15:17:35.667
> 
> 标签：performance, logging, log4net

[我是log4net](http://logging.apache.org/log4net)的忠实粉丝，但最近，一些（在我的部门）质疑它是否包含在我们的项目中，因为每种日志记录方法看似繁重。我认为有比其他技术更好的技术，但这是另一个问题。

我很想知道，log4net DebugFormat 类型调用对您的应用程序的典型影响是什么。我将省略每行代码的日志语句数量等变量，因为我只是在寻找你在现实世界中看到的任何东西。

而且，我知道在长评估语句中添加保护子句的简单技术，例如：

```
if (log.IsDebug)
{
  log.DebugFormat(...);
} 
```

所以，让我们暂时将其排除在考虑之外。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-07T15:44:24.580

我不熟悉 log4net 或 log.DebugFormat(...)。

但是伐木的成本实际上是在两个方面。

第一个是日志调用，第二个是日志信息的实际持久化。

当实际上不需要记录时，守卫有助于将记录调用减少到最低限度。它往往非常快，因为它只不过是一个方法调用和两个标量的比较。

但是，当您不使用守卫时，成本很可能成为创建实际日志记录参数的代价。

例如，在 log4j 中，这是一个常见的习惯用法：

```
log.debug("Runtime error. Order #" + order.getOrderNo() + " is not posted."); 
```

在这里，成本是对生成消息的字符串表达式的实际评估。这是因为无论日志记录级别如何，都会创建该表达式和结果字符串。想象一下，如果你有类似的东西：

```
log.debug("Something wrong with this list: " + longListOfData); 
```

这可能会创建一个大而昂贵的字符串变量，如果没有为 DEBUG 设置日志级别，那么它只会被浪费。

守卫：

```
if (log.isDebug()) {
    log.debug(...);
} 
```

消除这个问题，因为 isDebug 调用很便宜，尤其是与参数的实际创建相比。

在我的代码中，我编写了一个用于日志记录的包装器，我可以像这样创建日志：

```
log.debug("Runtime error. Order # {0} is not posted.", order.getOrderNo()); 
```

这是一个很好的妥协。这依赖于 Java 可变参数，我的代码检查日志记录级别，然后适当地格式化消息。这几乎和守卫一样快，但写起来更干净。

现在，log.DebugFormat 可能会做类似的事情，我不知道。

当然，最重要的是日志记录的实际成本（到屏幕、到文件、到套接字等）。但这只是您需要接受的成本。我的最佳实践是，在实际可行的情况下，将实际的日志消息路由到一个队列，然后使用单独的线程将其收割并输出到正确的通道。至少，这有助于使日志与主计算保持一致，但它本身就有费用和复杂性。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2012-12-08T19:23:53.710

I know this is an old thread, but how about using an approach that avoids filling the code with if statements based on log level, such as this one: [http://www.beefycode.com/post/Extension-Methods-for-Deferred-Message-Formatting-in-Log4Net.aspx](http://www.beefycode.com/post/Extension-Methods-for-Deferred-Message-Formatting-in-Log4Net.aspx)

Using lambda expression to build the message, you can avoid even evaluating it entirely.

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-07T15:37:57.013

[log4net 常见问题解答对此有答案](http://logging.apache.org/log4net/release/faq.html#perf-not-logging)，尽管没有达到您正在寻找的详细程度。

总之：使用那些保护条款。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2012-05-15T18:46:21.023

只是给 Will Hartung 的回答一个 .NET 的观点 :)

DebugFormat 代码为：

```
if (IsDebugEnabled)
{
    Logger.Log(ThisDeclaringType, m_levelDebug, new SystemStringFormat(CultureInfo.InvariantCulture, format, args), null);
} 
```

基本上是一样的，所以我相信当你使用 DebugFormat 时，你不需要使用保护子句（你可能仍然有一个小的开销，但我认为它小到可以忽略不计）

会留下评论，但我没有足够的声誉：/

# c# - 清理数据库返回数据

> ID：178976
> 
> 赞同：2
> 
> 时间：2008-10-07T15:17:54.853
> 
> 标签：c#, asp.net, sql, database, exception

我想知道每个人都认为处理您自己的数据库结果的最佳方法是什么。可能会涉及其他团队，并且总是有可能更改程序/数据并出现错误结果。我的问题是这个。是让异常发生、捕获并记录它还是尝试处理所有意外事件并隐藏错误更好？说，像下面这样。

```
if (dr.Table.Columns.Contains("column") && !dr["column"].Equals(DBNull.Value))
{
    this.value = (type)dr["column"];
}
else
{
   this.value= null;
} 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-07T15:19:37.673

就我个人而言，我喜欢快速失败——当然，带有适当的道歉用户信息。有些事情值得从中恢复，但是像您期望为非空的列之类的事情对我来说听起来更重要。

当然，我也会尝试设置一些冒烟测试，以确保您在生产前发现它:)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-07T15:21:44.457

数据库约束应该为您处理大部分问题。对于不是，我建议回到数据库设计并修复这些约束。

如果做不到这一点，最好在该字段上返回异常，以便可以修复（或删除）数据。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-08T12:48:16.183

处理您认为值得处理的所有事情，并在“不可能”发生时捕获异常。

正如[@AviewAnew](https://stackoverflow.com/questions/178976/sanitizing-database-return-data#178985)所说，您可能有点偏执，但这并不意味着您错了！

我会认为缺少列会比空值更糟糕，那么为缺少的列抛出异常怎么样？

```
try // wrap everything in a try/catch to handle things I haven't thought of
{

    if ( !dr.Table.Columns.Contains("column") )
    {
        throw new SomeSortOfException("cloumn: " + column + " is missing" );
    }
    else // strictly don't need the else but it makes the code easier to follow
    {
        if (dr["column"].Equals(DBNull.Value))
        {
            this.value= null;
        }
        else
        {
            this.value = (type) dr["column"];
        }
    }
}
catch( SomeSortOfException ex )
{
    throw;
}
catch( Exception ex )
{
    // handle or throw impossible exceptions here
} 
```

另一方面......如果您要在整个代码中进行所有这些检查，那么维护开销将是相当可观的。...这是另一件事要考虑。

你的来电！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-11-18T21:03:05.603

我会尽力确保它不会首先发生或尽量减少它可能发生的机会。

例如来自 jonSkeet 的帖子。如果您期望列的非空条件，那么该列是否存在约束？如果不是，您可能会期待它，因为 DBA/DB 开发人员告诉您它会是这样。我会告诉他们，您将依赖这一事实并鼓励、刺激、哄骗他们添加非空约束。如果您期望唯一值，请要求唯一约束。只有大写字符，添加检查约束。您的代码检查所有大写字母，然后检查下一个应用程序和下一个应用程序以及下一个应用程序（如果可以完成一次），这几乎没有意义。记住干——不要重复自己。

For the missing column error, my proactive approach is to make sure that there's an understanding by the db development team as to which tables and views and procedures are used by applications. Each application should have it's own username, each app's username should be granted select on only the tables it needs - *not* as a security feature but as documentation. If you change THIS table, it's used by these apps. Same with procs, grant execute to the apps which use it. If you keep this tight, and inculcate a *"check for external dependencies when making changes"* attitude, you'll head a lot of those errors off.

# asp.net - 在多个选项卡中使用相同的 asp 面板

> ID：178977
> 
> 赞同：0
> 
> 时间：2008-10-07T15:17:56.100
> 
> 标签：asp.net, vb.net

在 Ajax 工具包中，您可以使用 Tab Container 并将 TabPanels 添加到其中。

我有一些控件希望能够在所有选项卡中使用，并根据需要使用其他控件定制选项卡。

我的问题是如何在多个选项卡上重用面板？基本上我追求这样的事情

```
<TabContainer>
<tabPanel1>
<contentTemplate>
<pnl1></pnl1>
//other controls here 
</contentTemplate>
</tabPanel1>

<tabPanel2>
<contentTemplate>
<pnl1></pnl1>
//other controls here
</contentTemplate>
<tabPanel2>
</tabContainer>

<pnl1>
//some controls here
</pnl1> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-07T16:14:40.557

使面板成为用户控件，然后将用户控件拖放到每个选项卡面板中。

```
<TabContainer>
  <tabPanel1>
    <contentTemplate>
      <uc1:MyControl id="myControl" runat="server" />
    </contentTemplate>
  </tablPanel1>

  <tabPanel2>
    <contentTemplate>
      <uc1:MyControl id="myControl2" runat="server" />
    </contentTemplate>
  </tablPanel2>
</TabContainer>

<uc1:MyControl id="myControl3" runat="server" /> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-07T16:49:12.640

没有办法重用同一个面板。我想您可以在每次单击选项卡时使用 JavaScript 将面板附加到新的父级，但这似乎比它的价值更麻烦。

考虑将面板移到选项卡之外，使其始终可见。选项卡用于更改内容，它可能会违反 UI 约定来执行您正在尝试的操作。

# logging - 记录您的应用程序有哪些好的技术？

> ID：178993
> 
> 赞同：6
> 
> 时间：2008-10-07T15:20:36.063
> 
> 标签：logging

日志记录会很快变得复杂。考虑到您有一些代码，如何向其中添加日志记录？您使用什么库？

有哪些好的代码技术可以最大限度地利用日志记录语句，同时对应用程序的影响最小？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-07T15:22:05.813

库：[Log4J](http://logging.apache.org/log4j/1.2/index.html)和[Log4Net](http://logging.apache.org/log4net/index.html)（分别用于 Java 和 .NET）

从 Log4J 网站：

> 在代码中插入日志语句是一种低技术的调试方法。这也可能是唯一的方法，因为调试器并不总是可用或适用的。这通常是分布式应用程序的情况。
> 
> 另一方面，有些人认为日志语句会污染源代码并降低可读性。（我们认为情况正好相反）。在没有预处理器的 Java 语言中，日志语句会增加代码的大小并降低其速度，即使关闭了日志记录也是如此。鉴于一个合理大小的应用程序可能包含数千条日志语句，因此速度尤为重要。
> 
> 使用 log4j 可以在运行时启用日志记录，而无需修改应用程序二进制文件。log4j 包的设计使这些语句可以保留在交付的代码中，而不会产生沉重的性能成本。可以通过编辑配置文件来控制日志记录行为，而无需接触应用程序二进制文件。
> 
> 日志记录为开发人员提供了应用程序故障的详细上下文。另一方面，测试为应用程序提供了质量保证和信心。不应混淆日志记录和测试。它们是互补的。当日志被明智地使用时，它可以被证明是一个必不可少的工具。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-07T15:29:15.610

在其他问题中对此进行了相当多的讨论。如果您是 C# 人，请查看[What is the best logging solution for ac# net 3.5 project](https://stackoverflow.com/questions/98080/what-is-the-best-logging-solution-for-a-c-net-35-project)或[What's your logging理念？](https://stackoverflow.com/questions/44554/whats-your-logging-philosophy)

搜索 Logging，您会发现更多。:)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-07T15:25:36.117

查看 Log4X 日志的工具：[ChainSaw](http://logging.apache.org/chainsaw/index.html)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-07T16:35:25.493

关于日志记录实践，我想补充一些方面。

1.  将功能日志与开发日志分开成为一种实践。在生产环境中，功能日志可能涉及 DBMS 或其他一些资源。我们可以通过在实际记录器上编写包装器来实现这一点。
2.  在多用户环境中，日志语句变得难以阅读，具有唯一的用户会话 ID 并在开发阶段记录它。然后一个简单的 perl 脚本可以过滤掉这些部分，使调试更简单。如上所述使用包装类很容易
3.  Wrapper 类还使您免于被绑定到一个特定的日志记录 API。
4.  在可能的情况下尝试面向方面的日志记录方法，这基本上是使用切入点完成的（方法入口/出口点可以很容易地覆盖）。清理代码会更容易。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2018-04-18T18:03:04.397

当您决定您的日志记录理念以使其具有性能意识时，几乎没有什么需要考虑的事情。首先让我们分解用于日志记录的资源。

*   用于附加或组装特定日志行和垃圾收集的 CPU 时间
*   用于附加或组装特定日志行的工作内存
*   写入目标 (I/O) 所花费的 CPU 时间，可以是文件、控制台、网络等。
*   花在等待或争夺共享资源或共享目的地上的时间。这可能是磁盘上的文件或日志框架内的同步方法。
*   为持久化日志文件而占用的磁盘空间或任何其他存储空间

以下是您可以采取的措施来尽量减少上述情况。

*   控制日志记录。具有适当的日志级别，因此只能在生产中使用 INFO、WARN、ERROR，而在开发中只能使用 DEBUG、TRACE。最重要的是，级别不应该控制将日志写入目标，但它也应该控制组装日志行。为此，请使用参数化日志记录（[https://www.slf4j.org/faq.html#logging_performance](https://www.slf4j.org/faq.html#logging_performance)）或在组装日志行之前简单地检查日志级别是否已启用。使用 lambda 也是一种替代方法。
*   避免昂贵的格式化。如果需要漂亮的打印，请编写一个日志提取工具，将原始日志行转换为漂亮的日志行，这将离线和按需进行。如果将日志转发到 Splunk 或 ElasticSearch 之类的工具，则可以轻松完成许多有用的事情。
*   最小化日志大小。使用速记代码最小化日志行的大小，同时保持可读性。
*   最小化日志频率。在决定记录某些内容时，粗略估计多少日志大小/事务或多少日志行/事务。如果超过 1:100，那么记录太多了，这取决于。
*   尝试异步日志记录。换句话说，不要在事务线程中写入目标 (I/O)，而是将其添加到缓冲区并在后台处理它。RandomAccessFileAppender 就是 Log4J 提供的这种工具
*   分而治之。将日志分段。稍后在生产中，这可用于通过为不同的日志设置不同的目标（文件）来分散目标 (I/O) 上的负载

# unit-testing - 当您要向一个几乎没有 *NO* 单元测试代码的大型（且肮脏的）代码库添加一些新功能时，您会怎么做？

> ID：178997
> 
> 赞同：10
> 
> 时间：2008-10-07T15:21:32.100
> 
> 标签：unit-testing, testing, refactoring

[Martin Fowler](https://rads.stackoverflow.com/amzn/click/com/0201485672)说我们应该在添加新功能之前进行重构（鉴于原始程序结构不完善）。

所以我们都想重构这个*肮脏*的代码库，这是肯定的。我们还知道，如果没有单元测试代码，很容易引入细微的错误。

但这是一个庞大的代码库。为其添加一整套测试似乎是不切实际的。

在这种情况下你会怎么做？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-10-07T15:23:02.813

我的建议是你尽可能少地触摸并添加你需要的东西。我发现最好不要管它，尤其是在你的最后期限很紧的时候。

如果您进行了单元测试，那将是另一回事，但是当您更改代码时，就像触摸蜘蛛网一样。改变一件事会影响其他一切。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-10-07T15:53:30.193

Let me recommend the book [Working effectively with legacy code](https://rads.stackoverflow.com/amzn/click/com/0131177052 "Working effectively with legacy code") by Michael Feathers. It contains a lot of realistic examples and shows good techniques for tackling the legacy code beast.

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-10-07T15:24:13.373

将单元测试添加到要重构的代码中。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2008-10-07T15:26:44.010

请参阅[Repose 的 Trickle Theory](http://www.randsinrepose.com/archives/2006/09/25/trickle_theory.html)中的 Rands，了解他遇到的大量错误的类似问题。他的建议：

> 我的建议是：开始

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-10-07T15:36:20.760

当单元测试不存在或很难在给定的时间范围内添加适当的覆盖范围时，您将不得不依赖定期测试。从理论上讲，您所说的这个庞大而肮脏的代码库在过去一段时间内被认为适合使用。为了做出决定，要么进行程序员测试，要么进行 QA 测试，要么进行某种由客户进行的测试。您想了解它是如何完成的，做了什么，是否足以涵盖您将进行的更改，然后承诺再次完成该操作以及新代码所需的任何测试，直到产品好足够的。

单元测试对程序员来说是一项很棒的服务，但它们并不是唯一的测试类型。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-10-07T16:43:22.917

我发现自己经常处于这种情况，因为这几乎是我过去两年一直坚持的。

正确的方法实际上更多地取决于社会和组织方面，而不是技术方面。您的工作是为您的组织创造价值。如果重构产生的价值大于成本，那么你应该能够出售它。就我而言，关键因素包括：

1.  **相关项目的预期所有权。** 如果您希望在可预见的未来成为这个特定软件的重要利益相关者，那么这是一个支持对糟糕的代码库 b/c 进行更广泛修改的论据，随着您继续维护它，它将获得更多回报。如果您要添加免下车功能，请采用更加不干涉的方法。

2.  **所做更改的复杂性。** 如果您正在对代码库进行非常复杂的更改（“脏”代码库中的典型情况，b/c 此类源通常是紧密耦合且不连贯的），则更有可能需要进行一些重构。此类更改也不是成为代码忍者的结果，因为它们对于您进行简单*推理是必要的*关于你正在做的改变。这也与您正在修改的代码库的“坏处”有关。几乎不可能为紧密耦合、不连贯的混乱创建最简单的单元测试。（我根据经验说话。我几乎无法维护的项目之一是大约 20k 行，不包括生成的代码，包含在 12 个文件中。整个应用程序是一个名为“Form1”的类。这是开发人员滥用部分类特征。）

3.  **组织监督。** 您的组织监督的强度和严格性在这里发挥作用。如果您的团队确实执行了一些核心最佳实践，例如代码审查，并且不只是口头上说，我更倾向于不进行广泛的重构。价值权衡可能更倾向于尽可能少地接触，因为您有另一双新的眼睛检查以确保您所做的少数更改都不会产生不良的副作用。同样，更严格的监督更有可能对“游击式”代码策略感到不满，即进行更改请求中未*严格*要求的更改。

4.  **你的老板。** 如果你的老板站在你这边，你就更有可能对你的代码库进行长期的价值改进，特别是如果你可以在以后的预算小时数方面证明现在增加的成本是合理的。请记住，您的经理比您更了解该软件在大局中的作用。如果它是一个只有十或二十人使用的软件，它就不需要像一个十或两万人使用的软件所要求的那种长期维护改进。

在考虑像这样的任何时间投资时，您需要回答的核心问题是，“价值在哪里？” 然后你需要追逐那个价值。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-10-07T15:27:25.350

不要将其视为*非此即彼*的命题。通过添加单元测试可以增加价值——您不必添加整个套件即可获得添加一些测试的好处。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-10-07T16:27:10.347

很大程度上取决于您的语言。如果您使用的是静态类型语言，则可能无需单元测试就可以逃脱。我从事过许多与您所描述的完全一样的工作。

如果工作量很大（比如说，一个人一年或 3 个人 4 个月），那么您可能希望有人拆开代码并首先对其进行分析。

如果它是一种动态语言，那么问题会更大——你需要一定程度的单元测试。也许您可以将单元测试添加到您需要接触的领域。

我只区分静态语言和动态语言，因为在静态类型语言中进行重构要容易得多——它们往往更容易预测。我并不讨厌 Ruby 或其他任何东西——我也在 ROR 上花了一年的时间。我只是认为他们需要不同的方法。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-10-07T15:50:39.483

First thing, add tests for the parts you're going to change. Second, refactor the code until it makes sense to a sane person. Third, make the required changes.

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-10-09T05:53:01.763

Fowler 还建议你永远不要在没有测试安全的情况下进行重构。但是，您如何进行这些测试呢？而且，你能走多远？

之前推荐的书（ Michael Feathers 的[《有效处理遗留代码》](https://rads.stackoverflow.com/amzn/click/com/0131177052)）是该主题的权威著作。

需要快速阅读？查看 Michael 早期的同名[文章 (PDF) 。](http://www.objectmentor.com/resources/articles/WorkingEffectivelyWithLegacyCode.pdf)

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-10-07T15:23:57.243

你必须从某个地方开始。您可以从在可能的地方添加测试开始，并随着您的前进而构建您的测试套件。即使您有一些“愚蠢的”测试，它们什么都不做，只是告诉您您只能测试代码的某些部分告诉您一些事情。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-10-07T15:24:10.847

如果添加一套测试是不切实际的，那么代码库就存在严重问题。

添加新代码并*希望*它可以正常工作是不好的。

编写测试、重构基础并添加新代码。如果你不能测试它，你永远不会知道它是否正确。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-11-01T03:12:39.837

尽量少碰。并祈祷。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-11-01T03:25:51.340

我同意其他的，尽量少碰。但是，您也可以随时开始为您将要接触的新功能和/或现有功能编写单元测试。没有人说您需要编写单元测试来测试 100% 的现有代码库。*****