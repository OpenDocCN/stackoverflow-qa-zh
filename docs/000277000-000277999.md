# StackOverflow 问答 000277000-000277999

# wpf - WPF 自定义路由事件问题

> ID：277001
> 
> 赞同：7
> 
> 时间：2008-11-10T03:29:21.140
> 
> 标签：wpf, event-bubbling, routed-events

如何让两个不相关的控件引发相同的自定义事件？到目前为止，我看到的所有示例都在单个控件中定义了一个事件，我应该采取不同的方法吗？

例如。我想从按钮和文本框的 OnFocus 处理程序中引发自定义冒泡事件。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-10T04:43:42.893

首先让我说你的问题并没有明确表明你不想使用现有的[UIElement.GotFocusEvent](http://msdn.microsoft.com/en-us/library/system.windows.uielement.gotfocusevent.aspx)，但我假设你知道它并且有你不使用它的理由。

您始终可以在静态类上注册自定义事件，并在您想要的任何地方引发它。[Keyboard 类](http://msdn.microsoft.com/en-us/library/system.windows.input.keyboard(VS.85).aspx)处理它的所有事件（例如[Keyboard.KeyDownEvent](http://msdn.microsoft.com/en-us/library/system.windows.input.keyboard.keydownevent(VS.85).aspx)）。

```
public static class RoutedEventUtility
{
    public static readonly RoutedEvent MyCustomEvent = EventManager.RegisterRoutedEvent("MyCustomEvent", RoutingStrategy.Bubble, typeof(RoutedEventHandler), typeof(RoutedEventUtility));
} 
```

就像任何其他 RoutedEvent 一样引发事件。

```
RoutedEventArgs args = new RoutedEventArgs(RoutedEventUtility.MyCustomEvent);
RaiseEvent(args); 
```

如果您希望另一个班级将事件作为公共字段拥有，那么您将需要添加一个所有者。

```
public class MyCustomControl : Control
{
    public static readonly RoutedEvent MyCustomEvent = RoutedEventUtility.MyCustomEvent.AddOwner(typeof(MyCustomControl));
} 
```

# java - 如何使用 JProgressBar？

> ID：277007
> 
> 赞同：7
> 
> 时间：2008-11-10T03:34:25.500
> 
> 标签：java, swing

我需要从文本文件中加载一堆单词（大约 70,000 个），将其添加到哈希表（使用 soundex 作为键）并对值进行排序。在执行所有这些操作时，我想使用 JProgressBar 显示一个进度条。诸如[this](http://java.sun.com/docs/books/tutorial/uiswing/components/progress.html)和[this](http://www.dreamincode.net/forums/showtopic27952.htm)之类的文章仅给出了一个非真实示例（while 循环）。谁能建议我应该如何进行。如何从上述条件中获取一个数字来设置进度条的值？此外，似乎有不同的方法可以做到这一点 - 使用线程、计时器等。对于上述情况，哪种方法可能是最好的方法？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-10T04:18:32.477

我会在专用工作线程上循环读取文本文件，而不是事件调度线程 (EDT)。如果我知道要阅读的单词总数，那么我可以计算循环每次迭代完成的百分比并相应地更新进度条。

**示例代码**

以下代码在预处理和后处理期间将进度条置于不确定模式，并显示指示工作正在进行的动画。从输入文件迭代读取时使用确定模式。

```
// INITIALIZATION ON EDT 

// JProgressBar progress = new JProgressBar();
// progress.setStringPainted(true);

// PREPROCESSING

// update progress bar (indeterminate mode)
SwingUtilities.invokeLater(new Runnable()
{
    @Override
    public void run()
    {
        progress.setIndeterminate(true);
        progress.setString("Preprocessing...");
    }
});

// perform preprocessing (open input file, determine total number of words, etc)

// PROCESSING 

// update progress bar (switch to determinate mode)
SwingUtilities.invokeLater(new Runnable()
{
    @Override
    public void run()
    {
        progress.setIndeterminate(false);
    }
});

int count = 0;

while (true)
{
    // read a word from the input file; exit loop if EOF

    // compute soundex representation

    // add entry to map (hash table)

    // compute percentage completed
    count++;
    final int percent = count * 100 / total;

    // update progress bar on the EDT
    SwingUtilities.invokeLater(new Runnable()
    {
        @Override
        public void run()
        {
            progress.setString("Processing " + percent + "%");
            progress.setValue(percent);
        }
    });
}

// POSTPROCESSING 

// update progress bar (switch to indeterminate mode)
SwingUtilities.invokeLater(new Runnable()
{
    @Override
    public void run()
    {
        progress.setIndeterminate(true);
        progress.setString("Postprocessing...");
    }
});

// perform postprocessing (close input file, etc)

// DONE! 

SwingUtilities.invokeLater(new Runnable()
{
    @Override
    public void run()
    {
        progress.setIndeterminate(false);
        progress.setString("Done!");
        progress.setValue(100);
    }
}); 
```

**建议**

*   考虑编写一个方便的方法来更新 EDT 上的进度条，以减少代码中的混乱 ( `SwingUtilities.invokeLater... public void run()...`)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-20T10:30:25.750

使用 SwingWorker：http: [//java.sun.com/docs/books/tutorial/uiswing/concurrency/interim.html](http://java.sun.com/docs/books/tutorial/uiswing/concurrency/interim.html)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-11-19T19:41:44.440

获取文件大小并计算每次迭代处理的字节数。这样，您不必循环浏览文件两次。

# c# - 在 C# 中将字段标记为“只读”有什么好处？

> ID：277010
> 
> 赞同：353
> 
> 时间：2008-11-10T03:37:50.530
> 
> 标签：c#, readonly, processing-efficiency, memory-efficient

将成员变量声明为只读有什么好处？它只是防止有人在类的生命周期内改变它的值，还是使用这个关键字会带来任何速度或效率的提高？

* * *

## 回答 #1

> 赞同：209
> 
> 时间：2008-11-10T05:32:05.370

我不相信使用只读字段会带来任何性能提升。这只是一个检查，以确保一旦对象完全构建，该字段就不能指向新值。

然而，“只读”与其他类型的只读语义非常不同，因为它是由 CLR 在运行时强制执行的。readonly 关键字编译为 .initonly ，可由 CLR 验证。

这个关键字的真正优势是生成不可变的数据结构。根据定义，不可变数据结构一旦构造就不能更改。这使得推理结构在运行时的行为变得非常容易。例如，将不可变结构传递给代码的另一个随机部分是没有危险的。他们永远无法更改它，因此您可以针对该结构进行可靠的编程。

Robert Pickering 写了一篇很好的博客文章，介绍了不变性的好处。可以在[此处](https://dzone.com/articles/getting-know-immutable-data-st)或在[archive.org 备份](https://web.archive.org/web/20190910111734/http://strangelights.com/blog/archive/2008/05/18/1617.aspx)中找到该帖子。

* * *

## 回答 #2

> 赞同：206
> 
> 时间：2008-11-10T03:48:07.313

该`readonly`关键字用于将成员变量声明为常量，但允许在运行时计算该值。这与使用`const`修饰符声明的常量不同，后者必须在编译时设置其值。使用`readonly`您可以在声明中或在该字段所属的对象的构造函数中设置字段的值。

如果您不想重新编译引用该常量的外部 DLL（因为它在编译时被替换），也可以使用它。

* * *

## 回答 #3

> 赞同：80
> 
> 时间：2008-11-10T04:47:53.057

使用 没有明显的性能优势`readonly`，至少我从未见过任何地方提到过。这只是为了完全按照您的建议进行操作，以防止在初始化后进行修改。

所以它的好处在于它可以帮助您编写更健壮、更易读的代码。当您在团队中工作或进行维护时，此类事情的真正好处就来了。声明某事`readonly`类似于在代码中为该变量的使用订立合同。`internal`将其视为以与or之类的其他关键字相同的方式添加文档`private`，您是在说“初始化后不应修改此变量”，而且您正在*强制执行*它。

因此，如果您`readonly`通过设计创建一个类并标记一些成员变量，那么您可以防止您自己或其他团队成员稍后在扩展或修改您的类时犯错误。在我看来，这是一个值得拥有的好处（以额外的语言复杂性为代价，正如 doofledorfer 在评论中提到的那样）。

* * *

## 回答 #4

> 赞同：59
> 
> 时间：2008-11-23T19:20:50.197

用非常实用的术语来说：

如果您在 dll A 中使用 const 并且 dll B 引用该 const，则该 const 的值将被编译到 dll B 中。如果您使用该 const 的新值重新部署 dll A，则 dll B 仍将使用原始值。

如果您在 dll A 和 dll B 中使用 readonly 引用该 readonly，则将始终在运行时查找该 readonly。这意味着如果您使用该只读的新值重新部署 dll A，则 dll B 将使用该新值。

* * *

## 回答 #5

> 赞同：20
> 
> 时间：2011-05-25T09:29:34.857

编译器可能会根据 readonly 关键字的存在进行性能优化。

这仅适用于只读字段也标记为*static*的情况。在这种情况下，JIT 编译器可以假设这个静态字段永远不会改变。JIT 编译器在编译类的方法时可以考虑到这一点。

一个典型的例子：你的类可能有一个在构造函数中初始化的静态只读*IsDebugLoggingEnabled*字段（例如基于配置文件）。一旦实际方法被 JIT 编译，编译器可能会在未启用调试日志记录时省略整个代码部分。

我没有检查这个优化是否真的在当前版本的 JIT 编译器中实现，所以这只是猜测。

* * *

## 回答 #6

> 赞同：11
> 
> 时间：2008-11-23T19:29:14.140

请记住，只读仅适用于值本身，因此如果您使用引用类型，只读只会保护引用不被更改。实例的状态不受只读保护。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2018-04-29T18:43:20.587

令人惊讶的是，readonly 实际上会导致代码变慢，正如 Jon Skeet 在测试他的 Noda Time 库时发现的那样。在这种情况下，在 20 秒内运行的测试在删除 readonly 后只用了 4 秒。

[https://codeblog.jonskeet.uk/2014/07/16/micro-optimization-the-surprising-inefficiency-of-readonly-fields/](https://codeblog.jonskeet.uk/2014/07/16/micro-optimization-the-surprising-inefficiency-of-readonly-fields/)

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2013-01-23T23:22:35.653

不要忘记有一种解决方法可以使用参数 `readonly`在任何构造函数之外设置字段。`out`

有点乱，但是：

```
private readonly int _someNumber;
private readonly string _someText;

public MyClass(int someNumber) : this(data, null)
{ }

public MyClass(int someNumber, string someText)
{
    Initialise(out _someNumber, someNumber, out _someText, someText);
}

private void Initialise(out int _someNumber, int someNumber, out string _someText, string someText)
{
    //some logic
} 
```

此处进一步讨论：http: [//www.adamjamesnaylor.com/2013/01/23/Setting-Readonly-Fields-From-Chained-Constructors.aspx](http://www.adamjamesnaylor.com/2013/01/23/Setting-Readonly-Fields-From-Chained-Constructors.aspx)

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2018-06-17T13:38:05.160

*添加一个基本方面来回答这个问题：*

通过省略运算符，可以将属性表示为只读`set`。所以在大多数情况下，您不需要将`readonly`关键字添加到属性中：

```
public int Foo { get; }  // a readonly property 
```

与此相反：字段需要`readonly`关键字才能达到类似的效果：

```
public readonly int Foo; // a readonly field 
```

因此，将字段标记为`readonly`可以实现与没有`set`运算符的属性类似的写保护级别的一个好处 - 如果出于任何原因，无需将字段更改为属性。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2010-02-10T12:04:54.830

小心私有只读数组。如果这些将客户端作为对象公开（您可以像我一样为 COM 互操作执行此操作），则客户端可以操作数组值。将数组作为对象返回时使用 Clone() 方法。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2016-06-09T18:47:22.200

使用只读标记的另一个有趣部分是保护字段不被单例初始化。

例如在[csharpindepth](http://csharpindepth.com/Articles/General/Singleton.aspx)的代码中：

```
public sealed class Singleton
{
    private static readonly Lazy<Singleton> lazy =
        new Lazy<Singleton>(() => new Singleton());

    public static Singleton Instance { get { return lazy.Value; } }

    private Singleton()
    {
    }
} 
```

readonly 在保护字段 Singleton 不被初始化两次方面起着很小的作用。另一个细节是，对于上述场景，您不能使用 const，因为 const 在编译时强制创建，但单例在运行时创建。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2016-06-28T10:59:23.220

如果您有一个预定义或预先计算的值需要在整个程序中保持不变，那么您应该使用常量，但是如果您有一个需要在运行时提供但一旦分配的值应该在整个程序中保持不变，您应该使用只读。例如，如果您必须分配程序启动时间，或者您必须在对象初始化时存储用户提供的值，并且您必须限制它进行进一步的更改，您应该使用只读。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2017-05-12T15:16:59.860

`readonly`可以在声明时初始化或仅从构造函数中获取其值。不像`const`它必须同时初始化和声明。 `readonly` *拥有一切* `const` *，加上构造函数初始化*

**代码** [https://repl.it/HvRU/1](https://repl.it/HvRU/1)

```
using System;

class MainClass {
    public static void Main (string[] args) {

        Console.WriteLine(new Test().c);
        Console.WriteLine(new Test("Constructor").c);
        Console.WriteLine(new Test().ChangeC()); //Error A readonly field 
        // `MainClass.Test.c' cannot be assigned to (except in a constructor or a 
        // variable initializer)
    }

    public class Test {
        public readonly string c = "Hello World";
        public Test() {

        }

        public Test(string val) {
          c = val;
        }

        public string ChangeC() {
            c = "Method";
            return c ;
        }
    }
} 
```

* * *

## 回答 #14

> 赞同：-1
> 
> 时间：2013-03-20T23:51:43.520

WPF 可以带来性能优势，因为它消除了对昂贵的 DependencyProperties 的需求。这对于集合特别有用

# css - 糟糕的 Safari 渲染

> ID：277016
> 
> 赞同：0
> 
> 时间：2008-11-10T03:41:20.383
> 
> 标签：css

我正在使用我正在开发的 Web 应用程序在 Safari 中遇到严重的渲染问题。大多数设计都是使用绝对定位的 div 完成的。这在 Internet Explorer、Firefox、Chrome、Opera、Netscape 和 konqueror 上表现良好。在 Safari 中，它只是一团糟。

Safari 是否不支持 div 元素的绝对定位？

排除故障并找出 safari 浏览器发生了什么的最佳方法是什么？ [![替代文字](https://i.stack.imgur.com/gtgCi.jpg)](https://i.stack.imgur.com/gtgCi.jpg)

更新：我想指出我确实找到了这个问题，我要感谢所有提出建议的人。提供最有用信息的是 WebKit 的“检查元素”。似乎它们与 CSS 中的内联样式和样式发生冲突。虽然 safari 从 .css 文件中获取样式，但其他浏览器使用的是内联样式。我能够看到这些与建议的工具中的信息的冲突。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-10T03:52:38.053

**1\. Safari 的支持？**

Safari 实际上是一个**不错的浏览器**。如果它有缺陷的话，它们并不比任何其他浏览器差，也不属于旧的IE浏览器，它存在非常严重的问题，甚至缺乏对Web标准的基本支持。具体回答你的问题，是的，它**确实支持绝对定位**。

Safari 肯定可以呈现现代 X/HTML CSS 设计，而且由于您的受众主要使用 Safari，您不妨**忘记关闭浏览器的概念**。它是一个很好的浏览器，无论如何我们都无力改变它。我们**只需要处理这些错误**，无论它们是什么。

**2、如何调试？**

如果没有具体的例子，这不是任何人都可以真正帮助你做的事情。可以公平地说，您在**控制基于 css 的布局**时遇到了一些问题。您可能有一些**无效的标记**，在某些情况下可能会产生您所描述的那种极端的特定于浏览器的异常。

**从基础**开始。验证您的标记和 CSS。

*   [**标记验证器**](http://validator.w3.org/)
*   [**CSS 验证器**](http://jigsaw.w3.org/css-validator/)

确保您在[**标准模式下**](https://stackoverflow.com/questions/255470/what-are-the-different-doctypes-in-html-and-what-do-they-mean#255474)进行渲染。

**寻找特定问题的答案**

如果一切都验证了，但您**仍然遇到问题**，您将不得不一一追踪它们。即使您在 Safari 中逐个重建页面以查看事情从哪里开始放松，这样做也是值得的。如果在这个过程中你真的不明白为什么存在某种行为，你至少会有一个**特定的问题**可以用来四处寻找答案。它**可能已经在 SO 上得到了回答**，如果没有，你可以问它。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-10T04:07:33.233

问题可能出在您的 JavaScript 中；Safari 最引人注目的事情之一是它喜欢在出现任何错误后停止执行 JavaScript。

CSS 可能不是问题，因为 Safari 比其他任何浏览器都有更好的标准和 CSS 支持（好吧，我说过了。）

在最近[的 WebKit 夜间构建中](http://nightly.webkit.org)使用内置的[Web Inspector](http://trac.webkit.org/wiki/Web%20Inspector)来跟踪您的问题。

# c# - 使用从泛型方法获取的参数调用方法

> ID：277018
> 
> 赞同：3
> 
> 时间：2008-11-10T03:43:03.673
> 
> 标签：c#, generics, reflection, casting

我有一个类存储要调用的 WS 方法的名称以及服务接收的唯一参数的类型和值（它将是参数的集合，但让示例保持简单）：

```
public class MethodCall
{
  public string Method { get; set; }
  public Type ParType { get; set; }
  public string ParValue { get; set; }
  public T CastedValue<T>()
  {
    return (T)Convert.ChangeType(ParValue, ParType);
  }
} 
```

我有一个方法，它采用方法名称和参数，并使用反射调用该方法并返回结果。当我像这样使用它时，它可以正常工作：

```
callingclass.URL = url;
callingclass.Service = serviceName;
object[] Params = { (decimal)1 };
callingclass.CallMethod("Hello", Params); 
```

但是我的类型，示例中的十进制，是在 MethodCall 的实例中给出的。所以如果我有这个代码：

```
MethodCall call = new MethodCall();
call.Method = "Hello";
call.ParType = typeof(decimal);
call.ParValue = "1"; 
```

选项 1，不编译：

```
object[] Params = { (call.ParType)call.ParValue }; //Compilation error: The type or namespace name 'call' could not be found (are you missing a using directive or an assembly reference?) 
```

选项 2，也不编译：

```
object[] Params = { call.CastedValue<call.ParType>() }; //Compilation error: Cannot implicitly convert type 'call.ParType' to 'object' 
```

选项 3，使用反射，编译但在调用服务时不起作用：

```
object[] Params = { typeof(MethodCall).GetMethod("CastedValue").MakeGenericMethod(call.ParType).Invoke(this, null) };

callingclass.CallMethod(call.Method, Params); 
```

[例外情况是： ConnectionLib.WsProxyParameterExeption：URL ' http://localhost/MyTestingService/](http://localhost/MyTestingService/) ' 中方法'TestService.Hello' 的参数错误。

那么有人可以指出我正确的方法来完成这项工作吗？

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-10T05:00:36.700

对不起，我应该补充一点，如果我这样做：

```
object[] Params = { Convert.ChangeType(call.ParValue, call.ParType)}; 
```

它工作正常，但调用对象中泛型方法的重点是避免在使用时进行强制转换。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-10T06:53:12.370

如果您使用反射调用该方法，那么无论如何最终都会有效地进行转换。您在这里没有泛型的速度优势或编译时类型安全优势 - 我真的不认为您使用它对自己有任何好处。

*当您确实*在编译时静态地知道类型时，泛型很有用，至少在*某个地方*。您拥有`ParType`属性的事实确实与泛型的观点背道而驰。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-10T06:42:13.997

您不能只将字符串（“1”）转换为小数，即使您可以怀疑通用版本是否会知道它……它会尝试进行保留引用的转换，当您'd 需要一个运算符转换（它们在 C# 中共享语法，但非常不同）。

所以基本上，我认为 Convert.ChangeType 是你唯一明智的选择。

我确实有[一些代码](http://www.pobox.com/~skeet/csharp/miscutil/usage/genericoperators.html)允许您通过泛型使用运算符转换，但是字符串和十进制之间没有运算符转换，所以它无济于事。

# performance - 高性能 BPEL 引擎？

> ID：277022
> 
> 赞同：4
> 
> 时间：2008-11-10T03:48:01.493
> 
> 标签：performance, bpel

我正在为我们的高性能电信应用程序评估 BPEL 引擎，但性能似乎很差。我们评估了 Apache Ode、SunBPEL 引擎、Active BPEL 等。您知道任何更快的 BPEL 引擎实现或 C/C++ 中的 BPEL 实现吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2010-02-07T13:47:33.670

我相信您的性能测量非常简短。

例如，我熟悉 Apache ODE，我必须说有很多可能性可以加快速度。在进行配置优化后，比如使用内存进程和禁用调试事件，我在 SoapUI 中获得了 60 TPS。在我做了一些代码改进之后，它上升到了 150。所以未来还有优化的空间。

我不知道你需要多少TPS，但是单机60就足够了。

至于优化持久化进程，您需要调整数据库中的索引。

如果您想了解更多关于优化的详细信息，可以在[ODE 用户组](http://markmail.org/search/apache+ode+list:org.apache.ode.user)发帖。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-10T04:35:54.800

您看过 Oracle BPEL 吗？如果它像他们的数据库一样，它可能很快但很难配置和管理。

# wcf - 可扩展（插件/插件）WCF 服务主机的想法？

> ID：277028
> 
> 赞同：4
> 
> 时间：2008-11-10T03:53:02.560
> 
> 标签：wcf, plugins, add-in, lazy-loading, mef

我正在寻找有关如何构建可扩展 WCF 服务器（具有动态加载的服务）的建议，最好使用 System.Addins 或 MEF。

服务器应托管实现最小“插件”API（StartService/StopService/GetStatus?/etc）的任何 WCF 服务（包含在 DLL 程序集中，在运行时加载）。

[这篇文章](http://blogs.microsoft.co.il/blogs/alon/archive/2008/03/12/hosting-plug-in-wcf-services.aspx)是一个好的开始。一些要讨论的目标和要点：

*   为每个服务使用/不使用隔离的 AppDomain？
*   如何配置每个服务（端点、传输协议）？XML-config 文件还是更好的选择？
*   程序集的延迟/延迟加载（当服务请求到达时）？可能的？有用？如何？
*   磁盘上的文件更改时重新加载程序集（对开发环境有用）；
*   磁盘配置更改时服务重启；

当然，其他想法总是受欢迎的；）

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-09T05:26:56.707

*   是的，为每个服务使用隔离[`AppDomain`](http://msdn.microsoft.com/en-us/library/system.appdomain.aspx)。您需要`AppDomain`隔离，这样您就不会关闭正在运行的其他服务，以防万一出现故障。

*   提供 WCF 当前所做的所有方式，无论是通过编程还是通过配置。程序访问很困难，因为[`ServiceHost`](http://msdn.microsoft.com/en-us/library/system.servicemodel.servicehost.aspx)实例不可序列化，因此跨应用程序域边界获取信息将是一件痛苦的事。

*   我会说这是可能的。但是，这基本上是复制[Windows Process Activation Service](http://msdn.microsoft.com/en-us/library/ms730158.aspx)，因此您可能希望开始在那里寻找您的功能。

*   它对开发很有帮助，但老实说，我不认为它有那么重要的功能。它使您的代码复杂化以获得不太可衡量的收益（IMO）。我宁愿编写一个脚本来停止服务、复制文件并重新启动它，而不是使代码库过于复杂并且总是不得不观察程序集。

*   现在你在谈论 IIS。您基本上可以让 IIS 托管您的服务，它会在配置文件更改时回收它。

话虽如此，似乎 WAS 和 IIS 为您提供了您想要的大部分内容（高度可用、隔离的应用程序域、配置等），因此您可能想问为什么要自己做这件事。

# git - 合并多个 git 存储库

> ID：277029
> 
> 赞同：212
> 
> 时间：2008-11-10T03:54:04.477
> 
> 标签：git

假设我有一个看起来像的设置

```
phd/code/
phd/figures/
phd/thesis/ 
```

由于历史原因，这些都有自己的 git 存储库。但我想将它们组合成一个以简化一些事情。例如，现在我可能会进行两组更改并且必须执行类似的操作

```
cd phd/code
git commit 
cd ../figures
git commit 
```

（现在）表演就好了

```
cd phd
git commit 
```

似乎有几种方法可以使用子模块或从我的子存储库中提取，但这比我正在寻找的要复杂一些。至少，我会很高兴

```
cd phd
git init
git add [[everything that's already in my other repositories]] 
```

但这似乎不是一个单行字。有什么`git`可以帮助我吗？

* * *

## 回答 #1

> 赞同：155
> 
> 时间：2009-03-06T08:58:07.900

这是我在[这里](https://stackoverflow.com/questions/614229/can-i-move-the-git-directory-for-a-repo-to-its-parent-directory/614254)给出的解决方案：

1.  首先对你的 phd 目录做一个完整的备份：我不想为你失去多年的辛勤工作负责！;-)

    ```
    $ cp -r phd phd-backup 
    ```

2.  移动`phd/code`to的内容`phd/code/code`，并修复历史，使其看起来一直存在（这使用 git 的[filter-branch](http://git-scm.com/docs/git-filter-branch)命令）：

    ```
    $ cd phd/code
    $ git filter-branch --index-filter \
        'git ls-files -s | sed "s#\t#&code/#" |
         GIT_INDEX_FILE=$GIT_INDEX_FILE.new \
         git update-index --index-info &&
         mv $GIT_INDEX_FILE.new $GIT_INDEX_FILE' HEAD 
    ```

3.  `phd/figures`and的内容相同`phd/thesis`（只需替换`code`为`figures`and `thesis`）。

    现在你的目录结构应该是这样的：

    ```
    phd
      |_code
      |    |_.git
      |    |_code
      |         |_(your code...)
      |_figures
      |    |_.git
      |    |_figures
      |         |_(your figures...)
      |_thesis
           |_.git
           |_thesis
                |_(your thesis...) 
    ```

4.  然后在根目录中创建一个 git 存储库，将所有内容拉入其中并删除旧存储库：

    ```
    $ cd phd
    $ git init

    $ git pull code
    $ rm -rf code/code
    $ rm -rf code/.git

    $ git pull figures --allow-unrelated-histories
    $ rm -rf figures/figures
    $ rm -rf figures/.git

    $ git pull thesis --allow-unrelated-histories
    $ rm -rf thesis/thesis
    $ rm -rf thesis/.git 
    ```

    最后，您现在应该拥有您想要的东西：

    ```
    phd
      |_.git
      |_code
      |    |_(your code...)
      |_figures
      |    |_(your figures...)
      |_thesis
           |_(your thesis...) 
    ```

这个过程的一个好的方面是它将保留**非版本控制的**文件和目录。

希望这可以帮助。

* * *

不过只有一个警告：如果您的`code`目录已经有一个`code`子目录或文件，那么事情可能会出错（当然也一样`figures`）`thesis`。如果是这种情况，只需在完成整个过程之前重命名该目录或文件：

```
$ cd phd/code
$ git mv code code-repository-migration
$ git commit -m "preparing the code directory for migration" 
```

当程序完成后，添加最后一步：

```
$ cd phd
$ git mv code/code-repository-migration code/code
$ git commit -m "final step for code directory migration" 
```

当然，如果`code`子目录或文件没有版本控制，只需使用`mv`代替`git mv`，而忘记`git commit`s.

* * *

## 回答 #2

> 赞同：78
> 
> 时间：2008-11-10T05:01:12.907

> [`git-stitch-repo`](https://metacpan.org/pod/distribution/Git-FastExport/script/git-stitch-repo)将处理`git-fast-export --all --date-order`命令行上给出的 git 存储库的输出，并创建一个适合的流`git-fast-import`，将创建一个新存储库，其中包含尊重所有源存储库历史的新提交树中的所有提交。

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2009-04-23T00:35:13.150

也许，简单地（类似于前面的答案，但使用更简单的命令）在每个单独的旧存储库中进行提交，将内容移动到适当命名的子目录中，例如：

```
$ cd phd/code
$ mkdir code
# This won't work literally, because * would also match the new code/ subdir, but you understand what I mean:
$ git mv * code/
$ git commit -m "preparing the code directory for migration" 
```

然后将三个独立的 repos 合并为一个新的 repos，方法如下：

```
$ cd ../..
$ mkdir phd.all
$ cd phd.all
$ git init
$ git pull ../phd/code
... 
```

然后您将保存您的历史记录，但将继续使用一个 repo。

* * *

## 回答 #4

> 赞同：20
> 
> 时间：2011-02-09T21:32:34.623

您可以尝试[子树合并策略](http://www.kernel.org/pub/software/scm/git/docs/howto/using-merge-subtree.html)。它可以让你将 repo B 合并到 repo A。它的优点`git-filter-branch`是它不需要你重写你的 repo A 的历史（打破 SHA1 总和）。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2010-07-26T15:25:55.770

git-filter-branch 解决方案运行良好，但请注意，如果您的 git 存储库来自 SVN 导入，它可能会失败并显示如下消息：

```
Rewrite 422a38a0e9d2c61098b98e6c56213ac83b7bacc2 (1/42)mv: cannot stat `/home/.../wikis/nodows/.git-rewrite/t/../index.new': No such file or directory 
```

在这种情况下，您需要从过滤器分支中排除初始修订 -`HEAD`即将末尾更改为`[SHA of 2nd revision]..HEAD`- 请参阅：

[http://www.git.code-experiments.com/blog/2010/03/merging-git-repositories.html](http://www.git.code-experiments.com/blog/2010/03/merging-git-repositories.html)

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2013-11-25T16:25:51.927

[Aristotle Pagaltzis 的回答](https://stackoverflow.com/a/277089/305973)中的 git-stitch-repo仅适用于具有简单、线性历史的存储库。

[MiniQuark 的答案](https://stackoverflow.com/a/618113/305973)适用于所有存储库，但它不处理标签和分支。

我创建了一个程序，其工作方式与 MiniQuark 描述的相同，但它使用一个合并提交（具有 N 个父级），并且还重新创建所有标签和分支以指向这些合并提交。

有关如何使用它的示例，请参阅[git-merge-repos 存储库。](https://github.com/robinst/git-merge-repos#readme)

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2013-03-25T00:58:18.940

@MiniQuark 解决方案对我帮助很大，但不幸的是它没有考虑源存储库中的标签（至少在我的情况下）。以下是我对@MiniQuark 答案的改进。

1.  首先创建包含组合仓库和合并仓库的目录，为每个合并的仓库创建目录。

    > $ mkdir new_phd
    > $ mkdir new_phd/代码
    > $ mkdir new_phd/figures
    > $ mkdir new_phd/论文

2.  拉取每个存储库并获取所有标签。（仅针对`code`子目录提供说明）

    > $ cd new_phd/code
    > $ git init
    > $ git pull ../../original_phd/code master
    > $ git fetch ../../original_phd/code refs/tags/*:refs/tags/*

3.  （这是对 MiniQuark 答案中第 2 点的改进）移动`new_phd/code`to的内容并在每个**标签**`new_phd/code/code`之前添加前缀`code_`

     **> $ git filter-branch --index-filter 'git ls-files -s | sed "s-\t\"*-&code/-" | GIT_INDEX_FILE=$GIT_INDEX_FILE.new git update-index --index-info && mv $GIT_INDEX_FILE.new $GIT_INDEX_FILE' --tag-name-filter 'sed "s -.*-code_&-"' 头** 
***   这样做之后，标签的数量将是过滤分支之前的两倍。旧标签保留在 repo 中，并`code_`添加带有前缀的新标签。

    > $ git tag
    > mytag1
    > code_mytag1

    手动删除旧标签：

    > $ ls .git/refs/tags/* | grep -v "/code_" | xargs rm

    对其他子目录重复第 2,3,4 点

    *   现在我们有了@MiniQuark anwser point 3 中的目录结构。

    *   按照 MiniQuark anwser 的第 4 点执行操作，但在执行拉取操作后和删除`.git`目录之前，获取标签：

    > $ git fetch 目录 refs/tags/*:refs/tags/*

    继续..** 

 **这只是另一种解决方案。希望它可以帮助某人，它帮助了我:)

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2011-06-02T02:00:57.673

我创建了一个工具来完成这项任务。使用的方法类似（内部制作一些东西，如 --filter-branch）但更友好。是 GPL 2.0

[http://github.com/geppo12/GitCombineRepo](http://github.com/geppo12/GitCombineRepo)

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2014-05-10T01:55:00.980

实际上，git-stitch-repo 现在支持分支和标签，包括带注释的标签（我发现我报告了一个错误，并且已修复）。我发现有用的是标签。由于标签附加到提交，并且一些解决方案（如 Eric Lee 的方法）无法处理标签。您尝试从导入的标签创建一个分支，它将撤消任何 git 合并/移动并将您发送回来，就像合并的存储库与标签来自的存储库几乎相同。此外，如果您在“合并/合并”的多个存储库中使用相同的标签，也会出现问题。例如，如果您有 repo 的 A 和 B，两者都具有标签 rel_1.0。您将 repo A 和 repo B 合并到 repo AB 中。由于 rel_1.0 标签位于两个不同的提交上（一个用于 A，一个用于 B），AB 中会显示哪个标签？来自导入的 repo A 或来自导入的 repo B 的标签，但不能同时使用两者。

git-stitch-repo 通过创建 rel_1.0-A 和 rel_1.0-B 标签来帮助解决这个问题。您可能无法签出 rel_1.0 标记并期望两者，但至少您可以看到两者，理论上，您可以将它们合并到一个公共本地分支中，然后在该合并分支上创建一个 rel_1.0 标记（假设您只是合并而不更改源代码）。最好使用分支，因为您可以将每个 repo 中的分支合并到本地分支中。（dev-a 和 dev-b 可以合并到本地 dev 分支，然后可以推送到源）。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-11-10T04:42:54.067

你建议的顺序

```
git init
git add *
git commit -a -m "import everything" 
```

会起作用，但你会丢失你的提交历史。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2015-07-28T16:43:01.073

在 mainProject 中合并 secondProject：

A) 在第二个项目中

```
git fast-export --all --date-order > /tmp/secondProjectExport 
```

B）在主项目中：

```
git checkout -b secondProject
git fast-import --force < /tmp/secondProjectExport 
```

在这个分支中做所有你需要做的重大转换并提交它们。

C）然后回到master和两个分支之间的经典合并：

```
git checkout master
git merge secondProject 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2019-06-27T09:42:38.020

这个 bash 脚本可以解决[sed 制表符](https://unix.stackexchange.com/questions/145299/simple-sed-replacement-of-tabs-mysteriously-failing)问题（例如在 MacOS 上）和丢失文件的问题。

```
export SUBREPO="subrepo"; # <= your subrepository name here
export TABULATOR=`printf '\t'`;
FILTER='git ls-files -s | sed "s#${TABULATOR}#&${SUBREPO}/#" |
  GIT_INDEX_FILE=$GIT_INDEX_FILE.new \
  git update-index --index-info &&
  if [ -f "$GIT_INDEX_FILE.new" ]; then mv $GIT_INDEX_FILE.new $GIT_INDEX_FILE; else echo "git filter skipped missing file: $GIT_INXEX_FILE.new"; fi'

git filter-branch --index-filter "$FILTER" HEAD 
```

这是[miniquark](https://stackoverflow.com/users/38626/miniquark)、[marius-butuc](https://stackoverflow.com/users/341929/marius-butuc)和[ryan](https://stackoverflow.com/users/850830/ryan)的帖子的组合。为他们喝彩！

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2015-10-17T01:27:49.000

我也会在这里提出我的解决方案。它基本上是一个相当简单的 bash 脚本包装器`git filter-branch`。与其他解决方案一样，它只迁移主分支而不迁移标签。但是完整的主提交历史会被迁移，并且它是一个简短的 bash 脚本，因此用户应该相对容易查看或调整。

[https://github.com/Oakleon/git-join-repos](https://github.com/Oakleon/git-join-repos)

# vb.net - 显示数据输入错误的最佳方式

> ID：277031
> 
> 赞同：1
> 
> 时间：2008-11-10T03:54:41.323
> 
> 标签：vb.net

我为一个迎合寡妇的合作社创建了一个 VB.Net 贷款应用程序。该应用程序跟踪会员的贷款和付款，也用作会计系统。在我的第一个版本中，用户觉得每次出现错误时都显示一个消息框非常烦人。我的解决方案是在标签控件中输出错误。用户接受了修改，但我觉得我做错了。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-10T04:00:35.353

他们可能对中断输入流程的模态对话框感到恼火。想象一下，如果 Word 每次输入一个它在字典中找不到的单词时都会打断你，而不是只是用红色下划线并让你稍后更正你的错别字。你会打字很慢。

我建议您只突出显示输入错误，并让它们在完成后返回并修复它们。如果他们尝试提交表单（或任何类似的表单），则显示对话框并且在他们修复或确认标记有错误的字段之前不要让他们提交。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-10T05:09:42.500

从其他人的验证器控件开始，如下所示：

[http://www.codeproject.com/KB/validation/validationprovider.aspx](http://www.codeproject.com/KB/validation/validationprovider.aspx)

然后在必要时对其进行修改。正如蜥蜴所暗示的那样，这个可以正常工作，对违规字段进行不烦人的标记。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-10T05:57:04.137

*   您能否突出显示包含错误的字段并将错误消息显示为鼠标悬停或悬停文本？

*   如果合适，您可能在某处有一个鲜红色的按钮，它会显示带有*所有*错误`"Show Errors"`列表的令人讨厌的弹出窗口。

 *不请自来的建议：如果错误消息告诉用户如何*修复*错误，而不是出了什么问题，则它们会更有帮助。

祝你好运！

# asp.net - 使用 Asp.NET 和 Facebook API 的成功网站

> ID：277034
> 
> 赞同：3
> 
> 时间：2008-11-10T04:01:24.587
> 
> 标签：asp.net, facebook

有没有用 asp.net 和 facebook api 构建的网站？我正在寻找一些想法和灵感来做一些社交网络网络编程。我确实找到了一些 asp.net/facebook 博客条目，但仍然找不到任何在这方面成功完成一些工作的网站。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-10T08:05:21.320

您创建想法的框架不是几乎无关紧要吗？如果一个站点是用 ASP.Net、Ruby on Rails、PHP*等等等等等等*，它应该不会有太大的区别。

为什么不使用 Facebook API 寻找*任何*成功的网站（无论实施如何）？或者您想了解如何在 ASP.net 中专门实现一些东西？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-25T17:22:27.750

It's certainly doable, here's an example: [http://apps.new.facebook.com/louisefy/](http://apps.new.facebook.com/louisefy/), [http://www.new.facebook.com/apps/application.php?id=21805666590](http://www.new.facebook.com/apps/application.php?id=21805666590)

And a blog post with a bit of explanation: [http://www.itu.dk/~friism/blog/?p=92](http://www.itu.dk/~friism/blog/?p=92)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-18T02:19:39.103

我通过谷歌找到了这个：

[礼品清单](http://weblogs.asp.net/mikebosch/archive/2008/08/05/giftlistr-asp-net-mvc-facebook-application.aspx)

以下是一些提到 facebook .net 包装器的链接：

[SilverLight 和 Facebook](http://community.irritatedvowel.com/blogs/pete_browns_blog/archive/2008/10/16/How-to-Build-Facebook-Applications-with-Silverlight-2-RTW-_1320_-Part-1-of-2.aspx)

[脸书网](http://www.nikhilk.net/FacebookNET.aspx)

# perl - 如何在 Perl 中捕获和处理信号？

> ID：277043
> 
> 赞同：2
> 
> 时间：2008-11-10T04:12:58.293
> 
> 标签：perl, signals

有什么方法可以捕获错误并从 Perl 中优雅地退出？我正在处理一个脚本，该脚本可能由于来自操作系统或我服务器上运行的其他应用程序的 SIG 事件而失败。我希望在关闭脚本执行期间打开的所有文件和其他属性后捕获此事件，显示错误并退出。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-10T04:20:45.157

使用 %SIG 散列来安装信号处理程序。例子：

$SIG{INT} = 'SigIntHandler';

其中 SigIntHandler 是您编写的子程序，当中断被捕获时被调用。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-10T04:19:08.903

请参阅[perldoc sigtrap](http://www.perl.com/doc/manual/html/lib/sigtrap.html)。

# java - 我需要用 bcrypt 存储盐吗？

> ID：277044
> 
> 赞同：195
> 
> 时间：2008-11-10T04:14:55.340
> 
> 标签：java, encryption, passwords, salt, bcrypt

[bCrypt 的 javadoc](http://www.mindrot.org/files/jBCrypt/jBCrypt-0.2-doc/)有如何加密密码的代码：

```
String pw_hash = BCrypt.hashpw(plain_password, BCrypt.gensalt()); 
```

要检查明文密码是否与之前已散列的密码匹配，请使用 checkpw 方法：

```
if (BCrypt.checkpw(candidate_password, stored_hash))
    System.out.println("It matches");
else
    System.out.println("It does not match"); 
```

这些代码片段暗示我随机生成的盐被扔掉了。是这种情况，还是这只是一个误导性的代码片段？

* * *

## 回答 #1

> 赞同：221
> 
> 时间：2008-11-10T04:33:24.197

盐被合并到哈希中（以 base64 样式格式编码）。

例如，在传统的 Unix 密码中，salt 存储为密码的前两个字符。其余字符代表哈希值。检查器函数知道这一点，并将散列分开以取出盐。

# windows - FileChooser 选择目录，而不是文件

> ID：277053
> 
> 赞同：4
> 
> 时间：2008-11-10T04:25:08.173
> 
> 标签：windows, pywin32, filechooser

我的代码处理 Windows 框上文件夹中的所有文件。我想使用标准的文件选择器对话框为用户（恰好也是我）提供选择要处理的文件夹的选项。

我正在尝试使用[GetOpenFileName](http://msdn.microsoft.com/en-us/library/ms646927(VS.85).aspx "GetOpenFileName 的 MSDN 页面")函数来实现这一点。（我实际上是通过[pywin32](http://docs.activestate.com/activepython/2.5/pywin32/win32gui__GetOpenFileNameW_meth.html "关于 GetOpenFileNameW 的 PyWin32 手册")从 Python 调用它，但这不应该是相关的。）

我可以让它选择一个特定的文件，但我看不到任何让用户选择文件夹的选项。

有没有我不理解的标志组合，我是完全调用了错误的函数还是有另一个习惯用法？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-10T04:37:56.900

不幸的是，我认为您完全调用了错误的函数。自从我完成 Win32 gui 的东西以来已经有一段时间了。但我似乎记得有一种不同的方式可以调出“选择目录”框。它不是一个直接的 Win32 函数，而是一些 shell API 函数，需要一大堆代码来完成最简单的事情。

更新：一点谷歌揭示了[SHBrowseForFolder](http://msdn.microsoft.com/en-us/library/bb762115(VS.85).aspx)功能。

更新二：这是[Python 的一个例子](http://timgolden.me.uk/python/win32_how_do_i/browse-for-a-folder.html)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-10T04:52:06.140

正如 Greg 提到的，您想要的功能是一个 shell 功能。您需要的特定功能是[`SHBrowseForFolder`](http://msdn.microsoft.com/en-us/library/aa453669.aspx)，调用起来非常麻烦。还有提到该示例的[PyWin32 文档。](http://docs.activestate.com/activepython/2.5/pywin32/shell__SHBrowseForFolder_meth.html)`browse_for_folder.py`

# ios - 从 iPhone 上的 NSString 中删除 HTML 标签

> ID：277055
> 
> 赞同：108
> 
> 时间：2008-11-10T04:27:08.450
> 
> 标签：ios, objective-c, iphone, cocoa-touch, nsstring

有几种不同的方法可以`HTML tags`从`NSString`in 中删除`Cocoa`。

[一种方法](http://cocoa.karelia.com/Foundation_Categories/NSString/_Flatten__a_string_.m)是将字符串渲染成一个`NSAttributedString`，然后抓取渲染的文本。

[另一种方法](http://sugarmaplesoftware.com/25/strip-html-tags/#comment-71)是使用`NSXMLDocument's`-`objectByApplyingXSLTString`方法来应用执行此操作的`XSLT`转换。

不幸的是，iPhone 不支持`NSAttributedString`或`NSXMLDocument`. 有太多的边缘案例和格式错误`HTML`的文档让我觉得使用 regex 或`NSScanner`. 有人对此有解决方案吗？

一个建议是简单地查找开始和结束标记字符，除了非常琐碎的情况外，这种方法将不起作用。

例如，这些情况（来自同一主题的 Perl Cookbook 章节）会破坏这种方法：

```
<IMG SRC = "foo.gif" ALT = "A > B">

<!-- <A comment> -->

<script>if (a<b && a>c)</script>

<![INCLUDE CDATA [ >>>>>>>>>>>> ]]> 
```

* * *

## 回答 #1

> 赞同：310
> 
> 时间：2011-02-03T13:56:53.850

一种快速且“脏”（删除 < 和 > 之间的所有内容）的解决方案，适用于 iOS >= 3.2：

```
-(NSString *) stringByStrippingHTML {
  NSRange r;
  NSString *s = [[self copy] autorelease];
  while ((r = [s rangeOfString:@"<[^>]+>" options:NSRegularExpressionSearch]).location != NSNotFound)
    s = [s stringByReplacingCharactersInRange:r withString:@""];
  return s;
} 
```

我已将此声明为 os NSString 类别。

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2011-09-08T00:41:27.257

此`NSString`类别使用`NSXMLParser`来准确`HTML`删除`NSString`. 这是一个可以轻松包含到您的项目中`.m`的单个文件。`.h`

[https://gist.github.com/leighmcculloch/1202238](https://gist.github.com/leighmcculloch/1202238)

`html`然后通过执行以下操作进行剥离：

导入标头：

```
#import "NSString_stripHtml.h" 
```

然后调用stripHtml：

```
NSString* mystring = @"<b>Hello</b> World!!";
NSString* stripped = [mystring stripHtml];
// stripped will be = Hello World!! 
```

`HTML`这也适用于技术上不是的畸形`XML`。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2013-06-13T07:08:20.973

```
UITextView *textview= [[UITextView alloc]initWithFrame:CGRectMake(10, 130, 250, 170)];
NSString *str = @"This is <font color='red'>simple</font>";
[textview setValue:str forKey:@"contentToHTMLString"];
textview.textAlignment = NSTextAlignmentLeft;
textview.editable = NO;
textview.font = [UIFont fontWithName:@"vardana" size:20.0];
[UIView addSubview:textview]; 
```

对我来说很好

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2013-10-10T09:00:41.733

你可以像下面这样使用

```
-(void)myMethod
 {

 NSString* htmlStr = @"<some>html</string>";
 NSString* strWithoutFormatting = [self stringByStrippingHTML:htmlStr];

 }

 -(NSString *)stringByStrippingHTML:(NSString*)str
 {
   NSRange r;
   while ((r = [str rangeOfString:@"<[^>]+>" options:NSRegularExpressionSearch]).location     != NSNotFound)
  {
     str = [str stringByReplacingCharactersInRange:r withString:@""];
 }
  return str;
 } 
```

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2010-11-12T11:15:27.610

用这个

```
NSString *myregex = @"<[^>]*>"; //regex to remove any html tag

NSString *htmlString = @"<html>bla bla</html>";
NSString *stringWithoutHTML = [hstmString stringByReplacingOccurrencesOfRegex:myregex withString:@""]; 
```

不要忘记将其包含在您的代码中：#import "RegexKitLite.h" 这是下载此 API 的链接：[http ://regexkit.sourceforge.net/#Downloads](http://regexkit.sourceforge.net/#Downloads)

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2008-11-10T19:40:12.493

看看 NSXMLParser。这是一个 SAX 风格的解析器。您应该能够使用它来检测 XML 文档中的标签或其他不需要的元素并忽略它们，只捕获纯文本。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2014-03-13T14:45:46.760

这是一个比公认答案更有效的解决方案：

```
- (NSString*)hp_stringByRemovingTags
{
    static NSRegularExpression *regex = nil;
    static dispatch_once_t onceToken;
    dispatch_once(&onceToken, ^{
        regex = [NSRegularExpression regularExpressionWithPattern:@"<[^>]+>" options:kNilOptions error:nil];
    });

    // Use reverse enumerator to delete characters without affecting indexes
    NSArray *matches =[regex matchesInString:self options:kNilOptions range:NSMakeRange(0, self.length)];
    NSEnumerator *enumerator = matches.reverseObjectEnumerator;

    NSTextCheckingResult *match = nil;
    NSMutableString *modifiedString = self.mutableCopy;
    while ((match = [enumerator nextObject]))
    {
        [modifiedString deleteCharactersInRange:match.range];
    }
    return modifiedString;
} 
```

上面的`NSString`类别使用正则表达式来查找所有匹配的标签，复制原始字符串，最后通过以相反的顺序迭代它们来删除所有的标签。它更有效，因为：

*   正则表达式只初始化一次。
*   使用原始字符串的单个副本。

这对我来说表现得足够好，但使用的解决方案`NSScanner`可能更有效。

与接受的答案一样，此解决方案并未解决@lfalin 要求的所有边境案例。这些将需要更昂贵的解析，而平均用例很可能不需要。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2014-05-26T00:08:30.363

没有循环（至少在我们这边）：

```
- (NSString *)removeHTML {

    static NSRegularExpression *regexp;
    static dispatch_once_t onceToken;
    dispatch_once(&onceToken, ^{
        regexp = [NSRegularExpression regularExpressionWithPattern:@"<[^>]+>" options:kNilOptions error:nil];
    });

    return [regexp stringByReplacingMatchesInString:self
                                            options:kNilOptions
                                              range:NSMakeRange(0, self.length)
                                       withTemplate:@""];
} 
```

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2015-03-23T09:41:43.163

```
NSAttributedString *str=[[NSAttributedString alloc] initWithData:[trimmedString dataUsingEncoding:NSUTF8StringEncoding] options:@{NSDocumentTypeDocumentAttribute: NSHTMLTextDocumentType, NSCharacterEncodingDocumentAttribute: [NSNumber numberWithInt:NSUTF8StringEncoding]} documentAttributes:nil error:nil]; 
```

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2011-08-12T00:43:37.250

```
#import "RegexKitLite.h"

string text = [html stringByReplacingOccurrencesOfRegex:@"<[^>]+>" withString:@""] 
```

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2009-10-05T10:13:15.767

如果您想从网页（HTML 文档）中获取不带 html 标记的内容，请在`UIWebViewDidfinishLoading` **委托**方法中使用此代码。

```
 NSString *myText = [webView stringByEvaluatingJavaScriptFromString:@"document.documentElement.textContent"]; 
```

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2012-08-24T19:51:07.520

我已经扩展了 m.kocikowski 的答案，并试图通过使用 NSMutableString 来提高它的效率。我还构建了它以在静态 Utils 类中使用（我知道 Category 可能是最好的设计），并删除了 autorelease 以便它在 ARC 项目中编译。

包括在这里，以防有人发现它有用。

**。H**

```
+ (NSString *)stringByStrippingHTML:(NSString *)inputString; 
```

**.m**

```
+ (NSString *)stringByStrippingHTML:(NSString *)inputString 
{
  NSMutableString *outString;

  if (inputString)
  {
    outString = [[NSMutableString alloc] initWithString:inputString];

    if ([inputString length] > 0)
    {
      NSRange r;

      while ((r = [outString rangeOfString:@"<[^>]+>" options:NSRegularExpressionSearch]).location != NSNotFound)
      {
        [outString deleteCharactersInRange:r];
      }      
    }
  }

  return outString; 
} 
```

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2008-11-10T04:56:26.223

我想最安全的方法就是解析 <>s，不是吗？循环遍历整个字符串，并将未包含在 <>s 中的任何内容复制到新字符串。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2013-09-23T21:56:13.530

这是**m.kocikowski**答案的现代化，它删除了空格：

```
@implementation NSString (StripXMLTags)

- (NSString *)stripXMLTags
{
    NSRange r;
    NSString *s = [self copy];
    while ((r = [s rangeOfString:@"<[^>]+>\\s*" options:NSRegularExpressionSearch]).location != NSNotFound)
        s = [s stringByReplacingCharactersInRange:r withString:@""];
    return s;
}

@end 
```

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2015-02-18T23:55:33.653

以下是公认的答案，但不是类别，而是简单的辅助方法，其中传递了字符串。（谢谢你 m.kocikowski）

```
-(NSString *) stringByStrippingHTML:(NSString*)originalString {
    NSRange r;
    NSString *s = [originalString copy];
    while ((r = [s rangeOfString:@"<[^>]+>" options:NSRegularExpressionSearch]).location != NSNotFound)
        s = [s stringByReplacingCharactersInRange:r withString:@""];
    return s;
} 
```

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2015-11-08T12:44:49.543

这是快速版本：

```
func stripHTMLFromString(string: String) -> String {
  var copy = string
  while let range = copy.rangeOfString("<[^>]+>", options: .RegularExpressionSearch) {
    copy = copy.stringByReplacingCharactersInRange(range, withString: "")
  }
  copy = copy.stringByReplacingOccurrencesOfString("&nbsp;", withString: " ")
  copy = copy.stringByReplacingOccurrencesOfString("&amp;", withString: "&")
  return copy
} 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2010-10-04T12:17:59.307

如果你愿意使用[Three20 框架](http://three20.info/)，它在 NSString 上有一个类别，添加了 stringByRemovingHTMLTags 方法。请参阅 Three20Core 子项目中的 NSStringAdditions.h。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2013-07-25T20:43:01.403

更多地从 m.kocikowski 和 Dan J 的答案中扩展这一点，并为新手提供更多解释

1# 首先，您必须创建[objective-c-categories](http://mobile.tutsplus.com/tutorials/iphone/objective-c-categories/)以使代码在任何类中都可用。

**。H**

```
@interface NSString (NAME_OF_CATEGORY)

- (NSString *)stringByStrippingHTML;

@end 
```

**.m**

```
@implementation NSString (NAME_OF_CATEGORY)

- (NSString *)stringByStrippingHTML
{
NSMutableString *outString;
NSString *inputString = self;

if (inputString)
{
    outString = [[NSMutableString alloc] initWithString:inputString];

    if ([inputString length] > 0)
    {
        NSRange r;

        while ((r = [outString rangeOfString:@"<[^>]+>" options:NSRegularExpressionSearch]).location != NSNotFound)
        {
            [outString deleteCharactersInRange:r];
        }
    }
}

return outString;
}

@end 
```

2#然后只需导入您刚刚创建的类别类的**.h文件，例如**

```
#import "NSString+NAME_OF_CATEGORY.h" 
```

3#调用方法。

```
NSString* sub = [result stringByStrippingHTML];
NSLog(@"%@", sub); 
```

*结果*是 NSString 我想从中剥离标签。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2015-04-22T18:56:46.597

我遵循 m.kocikowski 接受的答案，并稍作修改以使用自动释放池来清理由 stringByReplacingCharactersInRange 创建的所有临时字符串

在此方法的注释中，它声明 /* 用指定字符串替换范围内的字符，返回新字符串。*/

因此，根据 XML 的长度，您可能会创建大量新的自动释放字符串，这些字符串直到下一个 @autoreleasepool 结束时才会被清理。如果您不确定何时会发生这种情况，或者用户操作可能会在此之前反复触发对该方法的多次调用，那么您可以将其包装在 @autoreleasepool 中。这些甚至可以在可能的情况下嵌套并在循环中使用。

Apple 对@autoreleasepool 的引用说明了这一点......“如果您编写一个创建许多临时对象的循环。您可以在循环内使用自动释放池块在下一次迭代之前处理这些对象。在循环中使用自动释放池块有助于减少应用程序的最大内存占用。” 我没有在循环中使用它，但至少这种方法现在可以自行清理。

```
- (NSString *) stringByStrippingHTML {
    NSString *retVal;
    @autoreleasepool {
        NSRange r;
        NSString *s = [[self copy] autorelease];
        while ((r = [s rangeOfString:@"<[^>]+>" options:NSRegularExpressionSearch]).location != NSNotFound) {
            s = [s stringByReplacingCharactersInRange:r withString:@""];
        }
        retVal = [s copy];
    } 
    // pool is drained, release s and all temp 
    // strings created by stringByReplacingCharactersInRange
    return retVal;
} 
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2016-01-27T10:35:31.783

另一种方式：

**界面：**

`-(NSString *) stringByStrippingHTML:(NSString*)inputString;`

**执行**

```
(NSString *) stringByStrippingHTML:(NSString*)inputString
{ 
NSAttributedString *attrString = [[NSAttributedString alloc] initWithData:[inputString dataUsingEncoding:NSUTF8StringEncoding] options:@{NSDocumentTypeDocumentAttribute: NSHTMLTextDocumentType,NSCharacterEncodingDocumentAttribute: @(NSUTF8StringEncoding)} documentAttributes:nil error:nil];
NSString *str= [attrString string]; 

//you can add here replacements as your needs:
    [str stringByReplacingOccurrencesOfString:@"[" withString:@""];
    [str stringByReplacingOccurrencesOfString:@"]" withString:@""];
    [str stringByReplacingOccurrencesOfString:@"\n" withString:@""];

    return str;
} 
```

**实现**

`cell.exampleClass.text = [self stringByStrippingHTML:[exampleJSONParsingArray valueForKey: @"key"]];`

或简单

`NSString *myClearStr = [self stringByStrippingHTML:rudeStr];`

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2017-10-05T09:54:05.023

@m.kocikowski 的更新答案适用于最新的 iOS 版本。

```
-(NSString *) stringByStrippingHTMLFromString:(NSString *)str {
NSRange range;
while ((range = [str rangeOfString:@"<[^>]+>" options:NSRegularExpressionSearch]).location != NSNotFound)
    str = [str stringByReplacingCharactersInRange:range withString:@""];
return str; 
```

}

* * *

## 回答 #22

> 赞同：-3
> 
> 时间：2008-11-13T18:02:48.233

这是一篇博客文章，讨论了一些可用于剥离 HTML 的库 [http://sugarmaplesoftware.com/25/strip-html-tags/](http://sugarmaplesoftware.com/25/strip-html-tags/) 请注意提供其他解决方案的注释。

# graphics - 打印机/绘图仪上的 Direct3D 输出

> ID：277059
> 
> 赞同：2
> 
> 时间：2008-11-10T04:33:36.363
> 
> 标签：graphics, printing, directx, plot, direct3d

将 Direct3D 输出发送到打印机或绘图仪的最佳方式是什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-06T23:54:37.983

我会通过从前端缓冲区创建一个 BMP 文件然后打印该 BMP 来做到这一点：

[http://www.mvps.org/directx/articles/screengrab.htm](http://www.mvps.org/directx/articles/screengrab.htm)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-31T02:00:13.720

我想说发送屏幕截图或图像仅适用于打印机（光栅图形）。如果你想在绘图仪上绘图，你需要使用你想要绘图的特定型号绘图仪的特殊说明。绘图仪仅限于绘制线条艺术，而不是光栅图形。看看这篇[维基百科文章](http://en.wikipedia.org/wiki/Plotter)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-10T04:42:39.887

我会截取整个 3d 场景的屏幕截图，然后打印出来。

# reporting-services - 如何在 Reporting Services 中动态设置数据源？

> ID：277069
> 
> 赞同：4
> 
> 时间：2008-11-10T04:43:33.253
> 
> 标签：reporting-services

我正在寻找一种在 SQL Server Reporting Services 中更改报表数据源的方法。

基本上我正在寻找的功能是报表顶部的下拉框（参数），它允许报表用户选择不同的数据源来运行报表（所以当下拉选择被更改并查看单击报告，它运行相同的报告，但针对不同的数据源）。

有没有办法做到这一点？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-10T05:39:14.390

如果您指的是 SQL Server Reporting Services，那么您只能拥有一个数据源（报表的本地数据源或共享数据源）。您必须变得棘手，例如让存储过程根据可以链接到报表下拉列表的参数返回不同的数据集。

请参阅（SQL 2000 链接，不确定您使用的是什么版本）：

*   [定义报告数据](http://msdn.microsoft.com/en-au/library/aa237261(SQL.80).aspx)
*   [使用动态查询](http://msdn.microsoft.com/en-au/library/aa237255(SQL.80).aspx)

另一方面，如果您乐于使用（恕我直言更灵活）报告查看器控件（Web 或 WinForms 版本），那么您可以表示您喜欢的任何 UI，并根据用户交互生成您喜欢的任何数据，然后简单地得到查看器使用相同的引擎为您呈现输出。最大的区别是所有工作都由客户端完成（对于 Web 应用程序，客户端是您的 Web 服务器而不是数据库服务器）。

看：

*   [GotReportViewer.com](http://www.gotreportviewer.com)

# flash - 为什么 Flash CS3 要求您在为 actionscript (as3) 导出时指定基类？

> ID：277073
> 
> 赞同：0
> 
> 时间：2008-11-10T04:46:50.190
> 
> 标签：flash, actionscript-3, dry, flash-cs3

在库中，右键单击您为其编写了 ActionScript 类的影片剪辑，然后选择“链接...”。请注意，“基类”字段不为空（不能为空）。可能是`flash.display.MovieClip`，但也可能是其他东西，这取决于您的类继承自什么。只有在为 ActionScript 3 发布时才需要此基类字段。

那么谁能告诉我为什么 Flash CS3 坚持让我在 ActionScript 文件*和*Linkage 对话框中都提供基类？如果两个位置之间的基类不同，它仍然可以毫无错误地发布，并且链接对话框似乎被忽略（只要它有效）。

基类字段有什么意义！？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-10T08:14:52.780

我经常使用它，因此为多个对象设置相同的基类，而不为它们创建单独的类 .as 文件。当您做更多图形类型的东西并且并不真正需要单独的类但确实需要以编程方式创建它们时，它很有用。

我不知道为什么它允许您在此处设置不正确的参数，我怀疑这是输入 Flash IDE 时非常“轻松的视图”的传统。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-10-08T21:14:10.057

来自： http: [//www.adobe.com/devnet/flash/quickstart/external_files_as3/](http://www.adobe.com/devnet/flash/quickstart/external_files_as3/)

> Base Class 的值默认为 flash.display.MovieClip。除非您使用的是使用外部类功能的自动生成的类，否则请使用此默认值。基类不是扩展的同义词；**如果您指定的自定义类本身扩展了另一个类，则无需将此超类指定为 Base Class**。在这种情况下，默认的 flash.display.MovieClip 就足够了。但是，如果您希望 RedFish 和 BlueFish 这两个符号功能相同但具有不同的外观，您可以使用创作工具创建不同的外观，然后将它们的基类设置为 Fish 并在外部 Fish.as 中使用 Fish 类文件为两条鱼提供功能。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-08-07T00:02:27.677

它可以是 Button、Sprite、MovieClip 或任何其他显示对象。您只是在创建其中一个的特殊版本。您需要为 Flash 提供您正在创建的类型。

# git - 如何在 git 中找到 origin/master 的位置，以及如何更改它？

> ID：277077
> 
> 赞同：233
> 
> 时间：2008-11-10T04:50:26.877
> 
> 标签：git, git-push, git-remote

我是一个 Git 新手。我最近将一个 Rails 项目从 Subversion 移到了 Git。我在这里按照教程：[http ://www.simplisticcomplexity.com/2008/03/05/cleanly-migrate-your-subversion-repository-to-a-git-repository/](http://www.simplisticcomplexity.com/2008/03/05/cleanly-migrate-your-subversion-repository-to-a-git-repository/)

我也在使用 unfuddle.com 来存储我的代码。我在上下班的火车上对我的 Mac 笔记本电脑进行了更改，然后在我有网络连接时使用以下命令将它们推送到 unfuddle：

```
git push unfuddle master 
```

我使用 Capistrano 进行部署，并使用 master 分支从 unfuddle 存储库中提取代码。

最近，当我在笔记本电脑上运行“git status”时，我注意到以下消息：

```
# On branch master
# Your branch is ahead of 'origin/master' by 11 commits.
#
nothing to commit (working directory clean) 
```

我很困惑为什么。我认为我的笔记本电脑是起源......但不知道我最初从 Subversion 中提取或推送到 Unfuddle 的事实是否是导致消息显示的原因。我怎样才能：

1.  找出 Git 认为“起源/主人”在哪里？
2.  如果它在其他地方，我如何将我的笔记本电脑变成'origin/master'？
3.  收到此消息即可离开。这让我觉得 Git 对某事不满意。

我的 Mac 正在运行 Git 版本 1.6.0.1。

* * *

当我`git remote show origin`按照 dbr 的建议运行时，我得到以下信息：

```
~/Projects/GeekFor/geekfor 10:47 AM $ git remote show origin
fatal: '/Users/brian/Projects/GeekFor/gf/.git': unable to chdir or not a git archive
fatal: The remote end hung up unexpectedly 
```

当我`git remote -v`按照 Aristotle Pagaltzis 的建议运行时，我得到以下信息：

```
~/Projects/GeekFor/geekfor 10:33 AM $ git remote -v
origin  /Users/brian/Projects/GeekFor/gf/.git
unfuddle    git@spilth.unfuddle.com:spilth/geekfor.git 
```

现在，有趣的是，我正在`geekfor`目录中处理我的项目，但它说我的来源是`gf`目录中的本地计算机。我相信`gf`这是我在将项目从 Subversion 转换为 Git 时使用的临时目录，并且可能是我推到 unfuddle 的地方。然后我相信我从 unfuddle 到`geekfor`目录中检查了一个新副本。

所以看起来我应该听从 dbr 的建议并做：

```
git remote rm origin
git remote add origin git@spilth.unfuddle.com:spilth/geekfor.git 
```

* * *

## 回答 #1

> 赞同：285
> 
> 时间：2010-04-06T17:00:57.487

我来到这个问题是为了寻找关于“你的分支在……前面”的消息的解释，在 git 的一般方案中是什么意思。这里没有答案，但是由于这个问题目前出现在谷歌的顶部，当你搜索“你的分支在'origin/master'之前”这个短语时，我已经弄清楚了这个消息的真正含义，我想我会在这里发布信息。

所以，作为一个 git 新手，我可以看到我需要的答案是一个明显的新手答案。具体来说，“您的分支在...之前”这句话的意思是您已经添加并提交到本地存储库的文件，但从未推送到源。至少对我来说，“git diff”没有显示出任何差异这一事实进一步混淆了这条消息的意图。直到我运行“git diff origin/master”，我才被告知我的本地存储库和远程主存储库之间存在差异。

所以，要清楚：

* * *

**“你的分支在前面……”** => 你需要推送到远程主机。运行**“git diff origin/master”**以查看本地存储库和远程主存储库之间的差异。

* * *

希望这对其他新手有所帮助。

（另外，我承认有些配置的细微之处可能会使这个解决方案部分失效，例如 master 可能实际上不是“remote”，并且“origin”是约定使用的可重新配置的名称，等等。但是新手确实不关心这类事情。我们想要简单、直接的答案。一旦我们解决了紧迫的问题，我们可以稍后阅读其中的微妙之处。）

伯爵

* * *

## 回答 #2

> 赞同：214
> 
> 时间：2008-11-10T06:16:45.063

> `1.`找出 Git 认为 'origin/master' 在哪里使用[`git-remote`](http://schacon.github.com/git/git-remote.html#_commands)

```
git remote show origin 
```

..这将返回类似..

```
* remote origin
  URL: me@remote.example.com:~/something.git
  Remote branch merged with 'git pull' while on branch master
    master
  Tracked remote branch
    master 
```

远程基本上是到远程存储库的链接。当你这样做..

```
git remote add unfuddle me@unfuddle.com/myrepo.git
git push unfuddle 
```

..git 会将更改推送到您添加的地址。它就像一个书签，用于远程存储库。

当您运行时`git status`，它会检查远程是否缺少提交（与您的本地存储库相比），如果是，则检查有多少提交。如果您将所有更改推送到“原点”，两者都将同步，因此您不会收到该消息。

> `2.`如果它在其他地方，我如何将我的笔记本电脑变成'origin/master'？

这样做没有任何意义。说“起源”被重命名为“笔记本电脑”——你永远不想`git push laptop`从你的笔记本电脑上做。

如果要删除原始遥控器，请执行此操作..

```
git remote rm origin 
```

这不会删除任何内容（就文件内容/修订历史而言）。这将停止“您的分支在前面......”消息，因为它不再将您的存储库与远程存储库进行比较（因为它已经消失了！）

要记住的一件事是 没有什么特别的`origin`，它只是 git 使用的默认名称。

当你做`origin`类似`git push`或`git pull`. 因此，如果您有一个经常使用的遥控器（在您的情况下是 Unfuddle），我建议您将 unfuddle 添加为“origin”：

```
git remote rm origin
git remote add origin git@subdomain.unfuddle.com:subdomain/abbreviation.git 
```

或使用 set-url 在一个命令中执行上述操作：

```
git remote set-url origin git@subdomain.unfuddle.com:subdomain/abbreviation.git 
```

然后你可以简单地做`git push`或`git pull`更新，而不是`git push unfuddle master`

* * *

## 回答 #3

> 赞同：39
> 
> 时间：2011-03-30T01:02:42.803

我遇到了一个与我的工作目录类似的问题，`ahead of origin by X commits`但`git pull`结果是`Everything up-to-date`. [我确实按照这个建议](http://fvue.nl/wiki/Git:_Your_branch_is_ahead_of_the_tracked_remote_branch)设法解决了这个问题。我在这里发布这个，以防它帮助其他有类似问题的人。

基本修复如下：

```
$ git push {remote} {localbranch}:{remotebranch} 
```

括号中的单词应替换为您的远程名称、本地分支名称和远程分支名称。例如

```
$ git push origin master:master 
```

* * *

## 回答 #4

> 赞同：24
> 
> 时间：2012-06-08T12:47:06.160

有时，原始主机（origin/master）的本地缓存版本和真正的原始主机之间存在差异。

如果你运行`git remote update`这将与 origin/master 重新同步原始 master

请参阅此问题的已接受答案

[git pull origin master 和 git pull origin/master 的区别](https://stackoverflow.com/questions/2883840/differences-between-git-pull-origin-master-git-pull-origin-master)

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2008-11-10T05:09:59.317

> 我以为我的笔记本电脑是起源……</p>

这有点荒谬：`origin`指的是默认远程存储库——您通常从中获取/拉取其他人的更改的存储库。

> 我怎样才能：

1.  `git remote -v`会告诉你是什么`origin`；[是您对存储库](http://book.git-scm.com/4_tracking_branches.html)分支的`origin/master`最后已知状态的“书签” ，而您自己的则是. [这一切都应该如此](http://book.git-scm.com/3_distributed_workflows.html)。`master``origin``master``origin/master`

2.  你没有。至少将存储库作为其自身的默认远程存储库是没有意义的。

3.  它不是。它只是告诉您，您在本地进行了一些不在远程存储库中的提交（根据该存储库的最后已知状态）。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2011-06-01T19:28:24.857

**[ 解决方案 ]**

```
$ git push origin 
```

^这为我解决了。它做了什么，它将我的主人（在笔记本电脑上）与远程服务器上的“原点”同步。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2010-07-29T18:10:13.527

我正在努力解决这个问题，之前的答案都没有解决我所看到的问题。我已将问题简化为基本问题，看看我是否可以清楚地说明我的问题。

我创建了一个新的存储库（rep1），将一个文件放入其中并提交。

```
mkdir rep1
cd rep1
git init
echo "Line1" > README
git add README
git commit -m "Commit 1" 
```

我创建了一个 rep1 的克隆并将其命名为 rep2。我查看 rep2 内部并查看文件是否正确。

```
cd ~
git clone ~/rep1 rep2
cat ~/rep2/README 
```

在 rep1 中，我对文件进行了一次更改并提交它。然后在 rep1 我创建一个远程指向 rep2 并推送更改。

```
cd ~/rep1
<change file and commit>
git remote add rep2 ~/rep2
git push rep2 master 
```

现在，当我进入 rep2 并执行“git status”时，我被告知我领先于原点。

```
# On branch master
# Your branch is ahead of 'origin/master' by 1 commit.
#
# Changes to be committed:
#   (use "git reset HEAD <file>..." to unstage)
#
#   modified:   README
# 
```

rep2 中的 README 与第二次提交之前的原样相同。我所做的唯一修改是rep1，我想做的就是将它们推送到rep2。我没有掌握什么？

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2011-04-20T03:03:51.777

等你“推”。尝试：

`$ git push`

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2011-07-25T22:22:19.877

我最近遇到了这个问题，我认为这是因为我删除了一些不再需要的文件。问题是 git 不知道文件已被删除，它看到服务器仍然有它。（服务器 = 来源）

所以我跑了

```
git rm $(git ls-files --deleted) 
```

然后运行提交并推送。

这解决了这个问题。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2012-01-03T23:17:21.257

我也是一个 git 新手。我遇到了同样的问题，即“您的分支在 N 次提交之前位于 origin/master 之前”消息。执行建议的“git diff origin/master”确实显示了一些我不想保留的差异。所以 ...

由于我的 git clone 用于托管，并且我想要主仓库的精确副本，并且不关心保留任何本地更改，我决定保存我的整个仓库，并创建一个新的：

（在主机上）

```
mv myrepo myrepo
git clone USER@MASTER_HOST:/REPO_DIR myrepo 
```

为了方便起见，我曾经在我的主机上对克隆进行更改。不再。我将对 master 进行这些更改，在那里 git commit 并执行 git pull。希望这应该让我在主机上的 git clone 完全同步。

/奈良

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2011-06-10T00:07:17.787

我对我的回购也有同样的疑惑。就我而言，我有一个旧遥控器，我不再推它了，所以我需要将它移除。

获取遥控器列表：

```
git remote 
```

删除不需要的

```
git remote rm {insert remote to remove} 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2011-08-23T15:24:19.233

在您自己的提交发生之前，可以重置为特定的提交。

```
$ git status
# On branch master
# Your branch is ahead of 'origin/master' by 2 commits.
#
nothing to commit (working directory clean) 
```

用于`git log`查找在本地更改发生之前您所做的提交是什么提交。

```
$ git log
commit 3368e1c5b8a47135a34169c885e8dd5ba01af5bb
...
commit baf8d5e7da9e41fcd37d63ae9483ee0b10bfac8e
... 
```

记下本地提交并直接重置为之前的提交：

```
git reset --hard baf8d5e7da9e41fcd37d63ae9483ee0b10bfac8e 
```

* * *

## 回答 #13

> 赞同：-1
> 
> 时间：2012-01-17T11:48:34.007

我遇到了问题“您的分支在 nn 次提交之前领先于 'origin/master'。” 当我推送到远程存储库时：

```
git push ssh://git@xxx.repositryhosting.com/yyy/zzz.git 
```

当我发现我的远程地址在文件 .git/FETCH_HEAD 中并使用时：

```
git push 
```

问题消失了。

# ruby-on-rails - Rails 多线程的几种情况

> ID：277081
> 
> 赞同：4
> 
> 时间：2008-11-10T04:55:45.350
> 
> 标签：ruby-on-rails, multithreading

Rails 现在使[多线程](http://guides.rubyonrails.org/2_2_release_notes.html#_thread_safety)应用程序成为可能，但听起来它并不适用于所有情况（例如，如果您使用的是 Mongrel，听起来这根本不会影响您）。

什么时候可以对 Rails 应用程序进行多线程处理？

[本文](http://www.koziarski.net/archives/2008/12/11/fun-with-threads)提供了有关多线程陷阱的更多信息。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-10T16:32:36.270

除非您使用 JRuby，否则我会避开 Ruby 中的多线程应用程序。Ruby 线程不是本机线程，根据我的经验，它们确实工作得非常糟糕。此外，Ruby 的内存管理器还有很多不足之处，因此按进程而不是按线程进行隔离是一种更适合生产的方法。

JRuby 是一个不同的故事。它使用 Java 的线程，可以转换为本地线程，它使用 Java 的垃圾收集器，非常棒。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-10T15:00:44.180

根据经验，如果您打算使用 Threads，那么您的方法很可能不是更好的方法。首先尝试详细说明您需要线程的原因，如果您仍然需要它们，请谨慎使用它们:)

# c# - 如果我只有一个窗口句柄 (hWnd)，我如何 GetModuleFileName()？

> ID：277085
> 
> 赞同：10
> 
> 时间：2008-11-10T04:59:01.007
> 
> 标签：c#, winapi, hwnd, getmodulefilename

我正在尝试获取位于我的 C# 2.0 应用程序之外的窗口的可执行文件的名称。我的应用程序当前使用来自“user32.dll”的 GetForegroundWindow() 调用获取窗口句柄 (hWnd)。

从我能够做的挖掘来看，我想我想使用 GetModuleFileNameEx() 函数（来自 PSAPI）来获取名称，但 GetModuleFileNameEx() 需要一个进程的句柄，而不是一个窗口。

是否可以从窗口句柄获取进程句柄？（我需要先获取窗口的线程句柄吗？）

编辑了第一句话，让我更清楚我想要做什么。

**更新！**这是我发现对我有用的 C# 代码。唯一需要注意的是，它*有时*会返回驱动器号为“？”的文件/路径。而不是实际的驱动器号（如“C”）。——还没弄清楚为什么。

```
[DllImport("user32.dll")]
static extern uint GetWindowThreadProcessId(IntPtr hWnd, out uint lpdwProcessId);

[DllImport("kernel32.dll")]
static extern IntPtr OpenProcess(UInt32 dwDesiredAccess, Int32 bInheritHandle, UInt32 dwProcessId);

[DllImport("psapi.dll")]
static extern uint GetModuleFileNameEx(IntPtr hProcess, IntPtr hModule, [Out] StringBuilder lpBaseName, [In] [MarshalAs(UnmanagedType.U4)] int nSize);

[DllImport("kernel32.dll")]
[return: MarshalAs(UnmanagedType.Bool)]
static extern bool CloseHandle(IntPtr hObject);

private string GetWindowModuleFileName(IntPtr hWnd)
{
    uint processId = 0;
    const int nChars = 1024;
    StringBuilder filename = new StringBuilder(nChars);
    GetWindowThreadProcessId(hWnd, out processId);
    IntPtr hProcess = OpenProcess(1040, 0, processId);
    GetModuleFileNameEx(hProcess,IntPtr.Zero,filename,nChars);
    CloseHandle(hProcess);
    return (filename.ToString());
} 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-26T16:36:08.730

一个小时以来一直在为同样的问题苦苦挣扎，第一个字母也被替换为**?** 通过使用 GetModuleFileNameEx。Finaly 使用**System.Diagnostics.Process**类提出了这个解决方案。

```
[DllImport("user32.dll")]
public static extern IntPtr GetWindowThreadProcessId(IntPtr hWnd, IntPtr ProcessId);

void GetProcessPathFromWindowHandle(IntPtr hwnd)
{
   uint pid = 0;
   Win32.GetWindowThreadProcessId(hwnd, out pid);
   Process p = Process.GetProcessById((int)pid);
   return p.MainModule.FileName;
} 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-10T05:09:37.350

您可以调用[GetWindowThreadProcessId](http://msdn.microsoft.com/en-us/library/ms633522(VS.85).aspx)，它将返回与窗口关联的进程。

由此，您可以调用[OpenProcess](http://msdn.microsoft.com/en-us/library/ms684320.aspx)来打开进程并获取进程的句柄。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-11T02:38:59.823

如果您在 Windows 64 位平台上运行，则可能需要改用 QueryFullProcessImageName。这将返回用户样式路径，而 GetProcessImageFileName 返回需要使用 NtQuerySymbolicLinkObject 或 ZwQuerySymbolicLinkObject 转换的系统样式路径。

一个庞大的示例函数 - 建议分解成可重复使用的位。

```
typedef DWORD (__stdcall *PfnQueryFullProcessImageName)(HANDLE hProcess, DWORD dwFlags, LPTSTR lpImageFileName, PDWORD nSize);
typedef DWORD (__stdcall *PfnGetModuleFileNameEx)(HANDLE hProcess, HMODULE hModule, LPTSTR lpImageFileName, DWORD nSize);

std::wstring GetExeName( HWND hWnd ){
// Convert from Window to Process ID
DWORD dwProcessID = 0;
::GetWindowThreadProcessId(hWnd, &dwProcessID);

// Get a handle to the process from the Process ID
HANDLE hProcess = ::OpenProcess(PROCESS_QUERY_INFORMATION | PROCESS_VM_READ, FALSE, dwProcessID);

// Get the process name
if (NULL != hProcess) {
    TCHAR szEXEName[MAX_PATH*2] = {L'\0'};
    DWORD nExeName = sizeof(szEXEName)/sizeof(TCHAR);

    //  the QueryFullProcessImageNameW does not exist on W2K
    HINSTANCE hKernal32dll = LoadLibrary(L"kernel32.dll");
    PfnQueryFullProcessImageName pfnQueryFullProcessImageName = NULL;
    if(hKernal32dll != NULL) {
        pfnQueryFullProcessImageName = (PfnQueryFullProcessImageName)GetProcAddress(hKernal32dll, "QueryFullProcessImageNameW");
        if (pfnQueryFullProcessImageName != NULL) 
            pfnQueryFullProcessImageName(hProcess, 0, szEXEName, &nExeName);
        ::FreeLibrary(hKernal32dll);
    } 

    // The following was not working from 32 querying of 64 bit processes
    // Use as backup for when function above is not available 
    if( pfnQueryFullProcessImageName == NULL ){ 
        HINSTANCE hPsapidll = LoadLibrary(L"Psapi.dll");
        PfnGetModuleFileNameEx pfnGetModuleFileNameEx = (PfnGetModuleFileNameEx)GetProcAddress(hPsapidll, "GetModuleFileNameExW");
        if( pfnGetModuleFileNameEx != NULL )    
            pfnGetModuleFileNameEx(hProcess, NULL, szEXEName, sizeof(szEXEName)/sizeof(TCHAR));
        ::FreeLibrary(hPsapidll);
    }

    ::CloseHandle(hProcess);

    return( szEXEName );
} 
return std::wstring();
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-10T05:10:07.647

你到底想做什么？[您可以使用GetWindowThreadProcessId()](http://msdn.microsoft.com/en-us/library/ms633522(VS.85).aspx)获取创建窗口的进程的进程 ID ，然后使用[OpenProcess()](http://msdn.microsoft.com/en-us/library/ms684320(VS.85).aspx)获取进程句柄。但这似乎很笨拙，我觉得有一种更优雅的方式来做你想做的事。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-05-31T07:52:31.613

试试这个来获取可执行文件的文件名：

C＃：

```
string file = System.Windows.Forms.Application.ExecutablePath; 
```

制造

# java - 如何在 xml 中引用自定义函数

> ID：277092
> 
> 赞同：3
> 
> 时间：2008-11-10T05:07:34.283
> 
> 标签：java, xml, xacml

如何在 xml 中引用自定义函数？假设我有一个用 Java 编写的函数并希望它通过 xml 标签引用，这怎么可能？

当前情景：我正在使用包含 xml 标签的 XACML2.0，我想在 Java 中引用一些与后端数据通信的函数，我无法在 xacml 中引用函数。请问你能帮帮我吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-09T13:57:16.380

您应该阅读 Java 中的反射。

以下示例将调用该方法

myObjectThatContainsMethod#methodNameAsString（整数 arg1，整数 arg2）

```
Integer[] params = {new Integer(123),new Integer(567)}; 
Class cl=Class.forName("stringParsedFromYourXML"); 
Class[] par=new Class[2]; 
par[0]=Integer.TYPE; 
par[1]=Integer.TYPE; 
Method mthd=cl.getMethod("methodNameAsString", parameterTypes); 
mthd.invoke(new myObjectThatContainsMethod(), params); 
```

希望有帮助..

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-06-12T08:25:05.690

首先，您需要选择 XACML 的实现。你应该选择一个用 Java 编写的，以使事情变得更简单。

其他一切都取决于所选的实现。实现应该记录如何添加自定义函数。如果没有记录，请询问作者。

# java - 尝试删除文件时出现 AccessControlException

> ID：277100
> 
> 赞同：1
> 
> 时间：2008-11-10T05:15:14.563
> 
> 标签：java, security, servlets, filesystems, io

我们有一个使用 log4j 进行日志记录的 java web 服务应用程序。当 log4j 尝试删除其滚动日志文件时引发异常

```
Exception:java.security.AccessControlException: access denied
(java.io.FilePermission /var/opt/SUNWappserver/domains/domain1/
applications/j2ee-modules/ourwebservice/WEB-INF/logs/IMWrapper.log.10 delete) 
```

当我们`ls`在目录中执行操作时，服务帐户确实有权读取和写入文件和目录。

从一些最初的谷歌搜索看来，我们可能必须更改`security.policy`文件以允许服务删除文件。有什么建议么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-10T07:30:26.177

作为快速修复，您可以使用具有以下内容的策略文件启动应用程序：

```
grant {
    permission java.security.AllPermission;
}; 
```

使用命令行选项：

-Djava.security.policy=file:<your_policy_file>

有关如何配置策略文件以获得所需访问权限的更多信息，请参阅[此链接。](http://java.sun.com/j2se/1.5.0/docs/guide/security/PolicyFiles.html)

编辑：对不起，但我不知道如何配置您的 Web 应用程序如何使用该策略文件，但至少该链接应该提示您获得所需的权利......

# cocoa - Mac OS X - 系统偏好设置面板无法打开

> ID：277102
> 
> 赞同：2
> 
> 时间：2008-11-10T05:17:57.083
> 
> 标签：cocoa, macos, system

我正在处理系统偏好设置窗格。它在某些计算机上可以正常打开，但在其他 Mac（均运行 10.5.5）上，首选项窗格拒绝加载并简单地挂起，将以下内容吐到控制台中：

```
11/9/08 8:38:50 PM [0x0-0x31031].com.apple.systempreferences[369] Sun Nov 9 20:38:50 Macintosh.local System Preferences[369] <Error>: Failed to create window context device 
11/9/08 8:38:50 PM [0x0-0x31031].com.apple.systempreferences[369] Sun Nov 9 20:38:50 Macintosh.local System Preferences[369] <Error>: CGWindowContextCreate: failed to create context delegate.
11/9/08 8:38:55 PM [0x0-0x31031].com.apple.systempreferences[369] Sun Nov 9 20:38:55 Macintosh.local System Preferences[369] <Error>: Failed to create window context device 
```

任何想法为什么会发生这种情况？

谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-13T20:23:58.700

与特定系统首选项窗格关联的首选项文件很可能已损坏。

您可以尝试从用户 ~/Library/Preferences/ 文件夹中删除关联的首选项文件，并关闭系统首选项，然后重新启动计算机。通常对于 Apple 系统首选项，该文件是 ~/Library/Preferences/com.apple.systempreferences.plist。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2014-01-17T17:54:17.397

我知道这是一个旧线程，但我总是发布我刚刚存档的答案，其他人可能会遇到问题。

通常，当您遇到 Account Prefpane not loading 错误时，通常是因为 2 个 Guest 帐户驻留在计算机上。首先转到 Macintosh HD（或根 HDD 名称）并转到 Users 文件夹。在这里签到，看看您是否有多个访客帐户。然后确保您没有登录任何访客帐户，打开终端并输入：

须藤 dscl 。-删除 /users/guest1

那应该删除其他用户帐户，然后尝试打开帐户 prefpane。

# c# - 寻找一些有趣的 C# 编程问题

> ID：277106
> 
> 赞同：24
> 
> 时间：2008-11-10T05:25:29.487
> 
> 标签：c#

我厌倦了典型的 CRUD 编程类型的应用程序。我想研究一些有趣（不太难）的编程问题。有没有什么网站可以帮助我锻炼大脑？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-11-10T05:31:47.290

Project Euler：[http](http://projecteuler.net/) ://projecteuler.net/是一个很好的随机有趣问题的集合。

有点相关（不总是编程，但程序员通常很感兴趣）是 IBM 思考这个站点：[http ://domino.research.ibm.com/Comm/wwwr_ponder.nsf/pages/index.html](http://domino.research.ibm.com/Comm/wwwr_ponder.nsf/pages/index.html)

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-11-10T05:33:32.763

另一个很棒的网站是... stackoverflow.com :)

这个网站上有一些非常棒的问题。我发现挑选一些问题并为它们制定答案很有趣。我经常选择一个主题。例如在上周，我尝试只使用一个 LINQ 表达式来解决尽可能多的问题。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-10T06:01:44.143

检查[DotNetPerls](http://dotnetperls.com/)，他们有很多专注于 C# 编程的问题和解决方案。

我也喜欢 Jon Skeet 的[C# Brainteasers](http://www.yoda.arachsys.com/csharp/teasers.html)，很好的代码片段，可以阅读和了解更多关于该语言的信息，其中一些有非常有趣和令人惊讶的结果......

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-10T05:36:30.993

我以前在[Ruby Quiz](http://rubyquiz.com/)上使用过这些问题。除了 Dave Thomas 的[CodeKata 之外](http://codekata.com/)，看看你附近是否有[Coding Dojo](http://codingdojo.org/)。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-10-11T09:30:48.873

结帐[CodeChef](http://www.codechef.com/) 有趣的问题在这里任何语言 vl 做

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2013-09-24T19:54:03.860

试试[SPOJ](http://www.spoj.com/)，他们有很多问题需要你解决。它们的难度也各不相同。

# .net - 绑定 DataGridView 的自定义排序

> ID：277127
> 
> 赞同：4
> 
> 时间：2008-11-10T05:38:32.533
> 
> 标签：.net, sorting, datagridview

我有一个绑定到 DataTable 的 DataGridView。我有一列是伪整数——你知道那种，大多数时候它有整数，但有时反而有一个 N/A。此列是 varchar，但我想让它像 int 列一样排序，将 N/A 视为 -1。

DataGridView 提供了这一点——*如果*它没有绑定到 DataTable。如果是绑定的，它会使用绑定对象的排序机制，而 DataTables 不会公开该功能。

我可以使用我想要的行为在 DataTable 中创建一个自定义列，但是因为 DataGridView 绑定到 DataTable，它按它显示的列进行排序。我可以在 DataGridView 中创建一个自定义列，但是当我已经有了一个最有效的解决方案时，我需要将表设置为虚拟模式以按此排序。

如何让它按照我的需要对我的伪整数列进行排序 - 在可能的情况下，按整数排序？这种情况似乎非常普遍，我敢肯定它已经被提供了。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2010-07-14T10:52:40.943

当我不得不处理与此类似的排序问题时，我最喜欢的方法是向 DataTable 添加一列并将伪 int 解析为我想要的可排序 int。然后在 DataGridView 的绑定中，您可以简单地隐藏该数据列，但因为它在那里，您仍然可以对其进行排序。它会在内存中添加一些额外的数据来执行此操作，因此根据性能影响和排序数据的大小，这可能是一个潜在的问题。此外，无论何时修改数据，您都需要确保这个额外的列保持一致。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-10T05:54:18.947

尝试绑定到*DataView*，而不是*DataTable*，例如：

```
private void SortByTwoColumns()
{
   DataView myDataView = DataTable1.DefaultView;
   myDataView.Sort = "State, ZipCode DESC";
   myGridView.DataSource = myDataView;
} 
```

您有几种处理 N/A 数据的选择 - *SELECT*语句、*RowPrePaint*事件等。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-07-27T08:34:32.113

为什么不直接更改 SQL 查询以将此列返回为 int（-1 表示“N/A”），然后为显示的列使用自定义格式化程序？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-07-14T10:44:32.763

也许您可以调整我的博客文章中的代码以提供特定于您的 int 列的 IComparer：

[http://adamhouldsworth.blogspot.com/2010/01/bound-datagridview-sorting.html](http://adamhouldsworth.blogspot.com/2010/01/bound-datagridview-sorting.html)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-12-03T18:31:08.387

除了 Joel Etherton 的回答之外，还有一个您可以处理的事件，它可以让您覆盖单元格的显示值。

所以，就像他说的，你需要两列。一种是强类型数值列，文本值为 -1。另一个是具有实际值（混合数字和文本值）的隐藏文本列。原样它会正确排序，但用户将看到 -1s 而不是实际值。

为了解决这个问题，我们需要这段代码：

```
Private Sub dgDisplay_CellFormatting(ByVal sender As Object, _
ByVal e As System.Windows.Forms.DataGridViewCellFormattingEventArgs) _
Handles dgDisplay.CellFormatting
    If Not (e.ColumnIndex = dgDisplay.Columns("NumericColumn").Index _
    AndAlso e.RowIndex >= 0) Then Exit Sub

    Dim newVal As String = dgDisplay.Item("ActualColumn", e.RowIndex).Value
    e.Value = newVal
End Sub 
```

这将显示您想要查看的实际文本值，即使绑定中的值`DataSource`只是一个数字。

如果您要在`DataView`您身后进行任何过滤，请`DataGridView`确保您在隐藏列上进行过滤。

# c# - 我可以在初始配置后关闭 NHibernate ShowSQL（在运行时）

> ID：277136
> 
> 赞同：6
> 
> 时间：2008-11-10T05:40:44.573
> 
> 标签：c#, nhibernate

我的 NHibernate 配置设置为显示所有交互的 sql。因此，我的一些大型集成测试表现不佳（尤其是在生成测试报告时）。

有没有办法在运行时关闭 ShowSql - 然后以编程方式将其重新打开。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-10T07:46:38.220

您可以在运行时对您的配置对象使用 SetProperties()，然后从该配置创建一个 SessionFactory。SetProperties 将 Dictionary 作为参数。然后新的 SessionFactory 将使用新的配置设置。

```
 IDictionary<string, string> props = new Dictionary<string, string>();
        props["show_sql"] = "true";

        Configuration config = new NHibernate.Cfg.Configuration();
        config.SetProperties(props);
        config.Configure();
        config.AddAssembly(typeof(User).Assembly);

        ISessionFactory factory = config.BuildSessionFactory(); 
```

有关更多信息，请查看文档的这一部分： [ISessionFactory 配置](http://www.hibernate.org/hib_docs/nhibernate/html/session-configuration.html)

希望能帮助到你。

/埃里克

# java - 在 Java 中确定文件总字数的最佳方法是什么？

> ID：277143
> 
> 赞同：4
> 
> 时间：2008-11-10T05:49:24.353
> 
> 标签：java, perl, file, word-count

在Java中查找文本文件中单词总数的最佳方法是什么？我认为 Perl 是寻找此类东西的最佳选择。如果这是真的，那么从 Java 中调用 Perl 函数会是最好的吗？在这种情况下你会怎么做？有更好的想法吗？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-11-10T06:20:21.217

```
int count = 0;
Scanner sc = new Scanner(new File("my-text-file.txt")); 
while (sc.hasNext()) {
   ++count;
   sc.next();
} 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-11-10T09:32:43.640

恭喜您偶然发现了最大的语言问题之一！什么是词？据说一个词是唯一真正意味着它是什么的词。语言学的整个领域都致力于单词/意义单位——形态学。

我假设您的问题与计算英语单词有关。然而，由于语言差异，创建一个与语言无关的单词计数器/解析器几乎是不可能的。例如，有人可能认为只处理由空格分隔的字符组就足够了。但是，如果您查看以下日语示例，您会发现该方法不起作用：

これは日本语の例文です。</p>

此示例包含 3 个不同的单词，并且没有一个用空格分隔。通常，日语单词边界是使用基于字典的方法解析的，并且有许多商业库可用于此。我们有幸有英文空格吗！我相信印度语、汉语和韩语也有类似的问题。

如果该解决方案实际上要以任何可能的多语言输入方式部署，那么能够根据被解析的语言插入不同的字数统计方法将非常重要。

我认为第一个答案是一个很好的答案，因为它使用 Java 的 Unicode 空白值作为分隔符的知识。它通过使用以下正则表达式进行匹配来标记化：`\p{javaWhitespace}+`

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-10T06:01:19.027

虽然 Perl 可以做到这一点，但我认为将它链接到 / 调用它来完成这种任务是过分的（除非你已经测试过了）。

*   我的建议是在网络上寻找和学习你需要的代码，例如：http: [//schmidt.devlib.org/java/word-count.html](http://schmidt.devlib.org/java/word-count.html)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-10T16:59:01.333

如果您使用的是 unix，`wc -w filename`则可以解决问题。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-10T05:58:32.963

对“单词”的定义做出一些假设，一种解决方案是使用文本流阅读器打开文件并对其进行扫描，计算非连续空白字符的数量，最后加上一个，例如

```
 this is some sample text
 this is some more sample text 
```

上面的文本将有 11 个单词，计为 9 个空格和 1 个换行符和 1 个文件结尾

* * *

## 回答 #6

> 赞同：-2
> 
> 时间：2008-11-10T05:56:33.187

我将一个`word_count`int 初始化为 1，然后循环遍历文件中的每个字符并`word_count`为每个空白字符递增，*除非*前一个字符是空白字符。（空格、制表符或换行符。）

# ide - 什么是开发框架？什么是 IDE？

> ID：277148
> 
> 赞同：1
> 
> 时间：2008-11-10T05:52:28.730
> 
> 标签：ide, development-environment

当我开始编程时，我使用的是 Ruby 和它附带的彩色小记事本。自从我开始学习 Java 以来，我一直在使用 Eclipse，它显然是一个 IDE。现在我在 Reddit 上阅读了一些关于这个 Mono 的内容，但我认为我并不完全理解它是什么。该网站说它是一个开发框架：这只是 IDE 的另一个词吗？我是一个真正的初学者，想要使用多种语言工作，从 Java 和 Ruby 到 z80 和 ARM9……是否有适合小我的 IDE 或开发框架？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-10T05:55:53.577

框架是一组用于构建应用程序的类和支持代码。这可以像 C 标准库一样简单，也可以像 Smalltalk 环境一样复杂，甚至可以包括用于复杂应用程序的基础设施，如动态或 ERP 系统 - 但本质上框架只是一个类库

IDE（集成开发环境）是编写程序的工具；该工具本质上只是一个包含支持编译和调试等的文本编辑器的程序

[顺便说一下，mono 是 .NET 框架的基于 linux 的实现]

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-10T06:37:46.520

现在我一直很喜欢这个比喻：

*   类库：你在得到你需要的东西后进出的妈妈和流行商店。
*   框架：像沃尔玛这样的大型超市，它们把你吸进它们的存在中，让你依赖自己。

IDE 是另一个问题，您最好看看[https://stackoverflow.com/questions/7388/best-ides-for-different-programming-languages](https://stackoverflow.com/questions/7388/best-ides-for-different-programming-languages)或其他类似的问题。

# html - 是否可以从 HTML 表单触发 HTTP DELETE 请求？

> ID：277149
> 
> 赞同：16
> 
> 时间：2008-11-10T05:52:48.747
> 
> 标签：html, asp.net-mvc

我有一个 ASP.NET MVC 项目，并且我有一个接受 GET、POST 和 DELETE 请求的操作。`Action`每种类型的请求都通过我的控制器方法上的属性进行过滤。

```
[ActionName(Constants.AdministrationGraphDashboardAction),
AcceptVerbs(HttpVerbs.Post)]
public ActionResult GraphAdd([ModelBinder(typeof (GraphDescriptorBinder))] GraphDescriptor details);

[ActionName(Constants.AdministrationGraphDashboardAction),
AcceptVerbs(HttpVerbs.Delete)]
public ActionResult GraphDelete([ModelBinder(typeof (RdfUriBinder))] RdfUri graphUri) 
```

我的`GraphAdd`方法效果很好。我想弄清楚的是如何创建一个 HTML`<form />`或`<a />`（链接），这将导致浏览器执行 HTTP 删除请求并触发我的 GraphDelete 方法。

如果有办法做到这一点，有人可以发布一些示例 HTML，如果可用，我应该使用 MVC HtmlHelper 方法吗？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-11-10T06:38:43.350

我不相信这是可能的。HTML4 和 XHTML 1.0 中表单元素的方法属性只接受 GET 或 POST。此外，大多数网络服务器的标准配置都会拒绝 DELETE 和 PUT 请求。假设您已将网络服务器配置为允许使用 PUT / DELETE 之类的方法（例如 WebDav 所做的），那么您可以创建自己的 HTTP 请求：

```
DELETE /resource.html HTTP/1.1
Host: domain.com 
```

并妥善处理。但是，没有办法通过当前的 HTML 表单来做到这一点。出于兴趣，有[一些关于](http://www.whatwg.org/specs/web-forms/current-work/#for-http)HTML5 中的 DELETE 支持的讨论。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-05-29T18:36:26.600

使用 XMLHttpRequest，它不仅是“最佳实践”，而且是唯一的方法。

# c# - 为 IEnumerable 定义扩展方法 返回 IEnumerable ?

> ID：277150
> 
> 赞同：32
> 
> 时间：2008-11-10T05:53:01.803
> 
> 标签：c#, .net, extension-methods

如何定义`IEnumerable<T>`返回的扩展方法`IEnumerable<T>`？目标是使扩展方法对所有人可用，并且`IEnumerable`可以是匿名类型。`IEnumerable<T>``T`

* * *

## 回答 #1

> 赞同：50
> 
> 时间：2008-11-10T06:27:20.300

编写任何迭代器的最简单方法是使用迭代器块，例如：

```
static IEnumerable<T> Where<T>(this IEnumerable<T> data, Func<T, bool> predicate)
{
    foreach(T value in data)
    {
        if(predicate(value)) yield return value;
    }
} 
```

这里的关键是“ `yield return`”，它将方法变成一个迭代器块，编译器生成一个枚举器（`IEnumerator<T>`），它做同样的事情。调用时，泛型类型推断会`T`自动处理，因此您只需要：

```
int[] data = {1,2,3,4,5};
var odd = data.Where(i=>i%2 != 0); 
```

以上可以与匿名类型一起使用就好了。

当然，您可以指定`T`是否需要（只要它不是匿名的）：

```
var odd = data.Where<int>(i=>i%2 != 0); 
```

Re `IEnumerable`（非通用），嗯，最简单的方法是让调用者使用`.Cast<T>(...)`或`.OfType<T>(...)`获得`IEnumerable<T>`第一个。您可以在上面传入`this IEnumerable`，但调用者必须指定`T`自己，而不是让编译器推断它。您不能将其与`T`匿名类型一起使用，因此这里的寓意是：不要将非泛型形式`IEnumerable`与匿名类型一起使用。

有一些稍微复杂的场景，方法签名使得编译器无法识别`T`（当然你不能为匿名类型指定它）。在这些情况下，通常可以重新考虑编译器*可以*在推理中使用的不同签名（可能通过直通方法），但您需要在此处发布实际代码以提供答案。

* * *

（更新）

经过讨论，这是一种利用`Cast<T>`匿名类型的方法。关键是提供一个可用于类型推断的参数（即使从未使用过该参数）。例如：

```
static void Main()
{
    IEnumerable data = new[] { new { Foo = "abc" }, new { Foo = "def" }, new { Foo = "ghi" } };
    var typed = data.Cast(() => new { Foo = "never used" });
    foreach (var item in typed)
    {
        Console.WriteLine(item.Foo);
    }
}

// note that the template is not used, and we never need to pass one in...
public static IEnumerable<T> Cast<T>(this IEnumerable source, Func<T> template)
{
    return Enumerable.Cast<T>(source);
} 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-11-10T06:32:32.643

```
using System;
using System.Collections.Generic;

namespace ExtentionTest {
    class Program {
        static void Main(string[] args) {

            List<int> BigList = new List<int>() { 1,2,3,4,5,11,12,13,14,15};
            IEnumerable<int> Smalllist = BigList.MyMethod();
            foreach (int v in Smalllist) {
                Console.WriteLine(v);
            }
        }

    }

    static class EnumExtentions {
        public static IEnumerable<T> MyMethod<T>(this IEnumerable<T> Container) {
            int Count = 1;
            foreach (T Element in Container) {
                if ((Count++ % 2) == 0)
                    yield return Element;
            }
        }
    }
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-10T06:04:28.427

这篇文章可以帮助您入门：[How do you write a C# Extension Method for a Generically Typed Class](https://stackoverflow.com/questions/68750/how-do-you-write-a-c-extension-method-for-a-generically-typed-class#68772)。我不确定它是否正是您正在寻找的东西，但它可能会让您入门。

# visual-studio - 如何阻止 VS2008 尝试将 .ASP 页面编译为 Visual Basic？

> ID：277159
> 
> 赞同：1
> 
> 时间：2008-11-10T05:56:51.017
> 
> 标签：visual-studio, visual-studio-2008, compiler-construction, asp-classic

我有一个混合了 ASP（经典）和 ASP.NET 页面的网站。

出于某种原因，Visual Studio（特别是 2008 Pro）一直在尝试编译 ASP 经典页面。

***如何防止它尝试编译 .asp 页面？***

原因：我在包含类的特定 .asp 文件上遇到大量错误。我相信它正在尝试将其编译为 Visual Basic 类，而不是将其视为 vBScript 类。无论如何，它应该跳过 .asp 文件，对吗？

这是错误：

> 不再支持属性 Get/Let/Set；使用新的属性声明语法。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-16T08:26:27.397

您是否安装了 Service Pack 1？它解决了经典 ASP 的一些问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-10T08:04:18.467

那些经典 ASP 页面上的 @Page 指令是什么？您是否尝试过插入`<% @Page language="vbscript" %>`可能已经这样做了？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-11T00:48:23.477

这是一种解决方案。转到文件资源管理器（在 Windows 中，而不是在 vs 中），选择属性并将它们隐藏。这将阻止 Visual Studio 编译文件。

# silverlight - WPF/Silverlight 中的动画资源？

> ID：277168
> 
> 赞同：3
> 
> 时间：2008-11-10T06:01:59.680
> 
> 标签：silverlight, animation

我正在寻找一些好的资源来提升 WPF/Silverlight 中使用的动画/故事板概念。任何指针？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-12T19:30:25.960

发布的一个链接是特定于 WPF 的。对于 Silverlight，这里有一些其他资源。

*   [MSDN 动画概述](http://msdn.microsoft.com/en-us/library/cc189019(VS.95).aspx)
*   [Silverlight SDK 博客](http://blogs.msdn.com/silverlight_sdk/archive/2008/03/21/silverlight-animations-a-walkthrough.aspx)
*   [亚当金尼动画动手实验室](http://adamkinney.com/blog/346/default.aspx)
*   [Nikhil 的效果和过渡](http://www.nikhilk.net/Silverlight-Effects-Transitions.aspx)（高级）

还有更多，但这些是我找到的一些商品。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-10T06:44:55.460

[这个](http://dotnetslackers.com/articles/wpf/IntroductionToWPFAnimations.aspx)网站有一些很好的资源，涵盖了我正在寻找的一些信息。

# python - 有没有好的 Python GUI shell？

> ID：277170
> 
> 赞同：13
> 
> 时间：2008-11-10T06:02:59.897
> 
> 标签：python, shell, user-interface

前几天我看到了这个（*一直*向下滚动以查看一些聪明的东西）：

> [http://www.mono-project.com/docs/tools+libraries/tools/repl/](http://www.mono-project.com/docs/tools+libraries/tools/repl/)

并想知道 Python 是否存在类似的东西。

那么，有没有一个好的 Python GUI shell 可以做 C# shell 可以做的事情？

编辑：这里是文章截图的链接，展示了我感兴趣的内容。

我感兴趣的事物类型的一个例子：

[http://www.mono-project.com/archived/images/7/75/GSharpPlot.png](http://www.mono-project.com/archived/images/7/75/GSharpPlot.png)

他们能够添加钩子来生成图形等 GUI 元素，甚至可以做一些愚蠢的事情，比如：

[http://www.mono-project.com/archived/images/b/bf/GSharpRenderHandler.png](http://www.mono-project.com/archived/images/b/bf/GSharpRenderHandler.png)

我认为这对于我尝试过的任何控制台 shell（常规 python shell，ipython）都是不可能的。

编辑：我不是在寻找 IDE。如果您查看链接，您将了解我想要什么。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-11-10T10:23:00.400

我知道的一个提供类似功能（内联绘图、可自定义渲染）的项目是[Reinteract](http://fishsoup.net/software/reinteract/)。另一个（虽然对于一般用途可能有点重量级）是[SAGE](http://www.sagemath.org/)，它为基于 Web 的[笔记本](http://www.sagenb.org)提供功能。

这些并不完全是外壳 - 它们更多地被设计为数学笔记本（例如，您可以修改较早的结果并将更改传播到以后的计算），但它们接近您正在寻找的东西，并且可能会被修改为这样使用。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-11-10T06:49:18.587

你看过[ipython](http://ipython.scipy.org/moin/)吗？它不像“gui”。没有笑脸，对不起。;-) 虽然它是一个非常好的 Python 交互式 shell。

编辑：我看到你修改了你的问题以强调**GUI**的重要性。在这种情况下，IPython 将不是一个很好的匹配项。

不妨为您节省另一个死胡同：我去看了 DrPython，希望它与 PLT 的 DrScheme 相似，它看起来也与您链接的示例相当。不幸的是，DrPython 与 DrScheme 并不完全一样。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-11-10T06:21:04.087

据我所知，没有任何东西可以提供 Mono 家伙在他们的新 shell 中实现的那种神奇功能，但这并不是说“基本”python 交互式 shell 不是一个功能 -完整而强大的应用程序。我可以看到类似 C# shell 之类的东西正在开发中，但我认为截至今天，您所指的那些功能相当独特。有人可能会争辩说，这是因为没有人想到它们，或者是因为没有人真正需要它们。我倾向于订阅后者，尽管我认为两者都是合理的。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2010-03-02T15:23:54.603

（对不起，线程死灵，但这个页面在谷歌搜索中仍然很高，我认为一定对这个主题有一些兴趣。）

我认为 Python 的一个 GUI shell 是相当新的[DreamPie](http://dreampie.sourceforge.net/)。它并没有问题中的屏幕截图那么远，但它可能是最接近的。他们至少在有用的功能列表中突出显示了交互式绘图。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-11-11T07:55:39.607

您正在寻找[Reinteract](http://www.reinteract.org/)，这是一个基于 Python 的 shell，[至少部分启发](http://tirania.org/blog/archive/2008/Nov-02.html)了您找到的 C# shell。它肯定仍在开发中，但已经非常有用。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-11-10T16:41:18.453

我认为 Pycrust 与 matplotlib 的结合可以完全满足您的需求。Pycrust 是 wxPython 安装的一部分，matplotlib 应该单独安装。两者都可以在大约 5 分钟内轻松安装。

阅读[这篇](http://eli.thegreenplace.net/2008/07/26/matplotlib-plotting-with-python/)关于将 matplotlib 与 Pycrust 集成以生成动态图的信息，就像您发布的链接中的图一样。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-05-23T18:53:17.280

[DreamPie](http://www.dreampie.org/)是我个人的最爱。它似乎没有比 CSharpRepl 更具限制性。例如，如果安装了 matplotlib，则可以完成图形绘制示例。DreamPie 的网站 ( [http://dreampie.sourceforge.net/](http://dreampie.sourceforge.net/) ) 上有一个关于这种效果的示例屏幕截图。

Bpython 类似，我更喜欢它。但它仅在 Linux 上以二进制形式提供。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2013-05-28T03:45:37.843

[Light Table](http://www.lighttable.com/)正在解决这个问题。IDE 同时是一个 REPL——它具有 iPython 的在线绘图功能。

# browser - 导航前拦截 URL

> ID：277178
> 
> 赞同：1
> 
> 时间：2008-11-10T06:10:13.267
> 
> 标签：browser, url-interception

我想拦截用户在浏览器中输入的任何 URL，并在允许导航继续之前执行一些任务（任何方式都可能很好 - 即通过插件、代理或任何其他创造性建议）。澄清一下 - 我不是指需要捕捉这个的特定应用程序，而是 - 用户在其浏览器上所做的任何导航都需要被捕捉（即用户没有打开我的应用程序，它应该在后台运行或类似的东西......）提前谢谢......

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-10T06:29:26.880

我认为您不能“拦截”用户通过 javascript 输入的内容。它闻起来像一个大的安全漏洞。您可以检测到用户何时离开页面，但您无法检测到他接下来要去哪里。

*   如果您只需要处理 URL 字符串，代理是一个不错的选择。但是任何更复杂的东西在代理中实现都会很复杂。

*   但是，插件取决于您所针对的浏览器，您不能制作一个针对所有浏览器并同时控制用户导航的插件。但是，如果您要选择用户使用的浏览器，那么也许可以。

*   滚动您自己的浏览器（使用 IE 的 ActiveX 控件）或使用其中一种开源替代品并使用它怎么样？

您希望进行的具体处理是什么？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-10T06:12:08.940

如果您使用的是 Javascript，当用户存在一个名为`onunload`.

```
window.onunload = function() {
    alert("You're leaving this page.");
}; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-10T06:38:24.880

您可以创建一个隐藏框架，将[手表](http://www.devguru.com/Technologies/Ecmascript/Quickref/watch.html)添加到`window.location`主框架的对象中。我不确定您是否可以在 IE 中使用手表 - 如果不能，您可能需要定期轮询另一个窗口以查看它在哪个页面上。

如果用户在浏览器窗口中键入地址，则您无法捕获该地址（因为您的框架将被删除），但您将获得他们点击的所有链接（甚至指向外部站点）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-10-22T19:51:50.307

您可能想看看[Fiddler](http://www.fiddler2.com/fiddler2/)：

> ... Web 调试工具，可从几乎任何应用程序捕获、重放和修改 HTTP 和 HTTPS 流量。

据我了解，它充当轻量级代理，可以执行 .NET 脚本定义的各种很酷的事情。

如果您感兴趣，您还可以对其进行设置，以便您可以通过它运行移动设备。

# firefox - 安装 Firefox XPI 文件时如何避免（作者未验证）消息

> ID：277181
> 
> 赞同：6
> 
> 时间：2008-11-10T06:12:03.293
> 
> 标签：firefox, plugins, signing, xpi

我需要做些什么来避免 Firefox 中的插件“手动安装”，我必须去哪里或者我必须做些什么来避免在下载插件时出现（作者未验证）消息。理想情况下，我想自动启动插件的安装，如果我需要以某种方式签署插件以表明它没有做任何恶意的事情，我也想这样做。

谢谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-10T11:37:19.860

签署 XPI 将删除警告消息，但仍然没有自动安装扩展或插件的方法。

我写了几篇关于[XPI 格式](http://o-regan.org/2007/04/11/firefox-xpi-internal-structure/)的文章和一个使用 java 命令行工具进行[签名的方法。](http://o-regan.org/2007/04/23/extension-signing-with-xpisigner/)

[XPISigner](https://code.google.com/p/xpisigner/)工具大大简化了流程，并且可以集成到构建系统中。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-10T06:21:58.110

这是[官方教程](http://www.mozdevgroup.com/docs/pete/Signing-an-XPI.html)，仅涉及签署 XPI。出于相当明显的安全原因，我不相信自动安装插件是可能的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-07-24T23:28:09.860

在 FF 2.0.3 上为我工作：

```
<script type="application/javascript">
<!--
function install (aEvent)
{
  var params = {
    "Foo": { URL: aEvent.target.href,
             IconURL: aEvent.target.getAttribute("iconURL"),
             Hash: aEvent.target.getAttribute("hash"),
             toString: function () { return this.URL; }
    }
  };
  InstallTrigger.install(params);

  return false;
}
-->
</script>

<a href="http://www.example.com/foo.xpi"
  iconURL="http://www.example.com/foo.png"
  hash="sha1:28857e60d043447c5f4550853f2d40770b326a13"
  onclick="return install(event);">Install Extension!</a> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-10T06:43:41.420

这是处理签署 XPI的[官方教程。](https://www.mozdevgroup.com/docs/pete/Signing-an-XPI.html)出于安全考虑，无法自动安装。

# python - 有没有一种更 Pythonic 的方式来将两个 HTML 标题行与 colspan 合并？

> ID：277187
> 
> 赞同：1
> 
> 时间：2008-11-10T06:17:39.460
> 
> 标签：python, beautifulsoup

我在 Python 中使用 BeautifulSoup 来解析一些 HTML。我正在处理的问题之一是我遇到标​​题行之间的 colspan 不同的情况。（标题行是需要组合以获得我的行话中的列标题的行）即一列可能跨越其上方或下方的许多列，并且需要根据跨度附加或前置单词。下面是执行此操作的例程。我使用 BeautifulSoup 拉出 colspan 并拉出每行中每个单元格的内容。longHeader 是包含最多项目的标题行的内容，spanLong 是一个列表，其中包含行中每个项目的跨度。这可行，但看起来不是很 Pythonic。

Alos-如果 diff <0，它就不会工作，我可以用我用来让它工作的相同方法来解决这个问题。但在我这样做之前，我想知道是否有人可以快速查看这个并提出一种更 Pythonic 的方法。我是一名长期的 SAS 程序员，所以我很难打破常规——我会像编写 SAS 宏一样编写代码。

```
longHeader=['','','bananas','','','','','','','','','','trains','','planes','','','','']
shortHeader=['','','bunches','','cars','','trucks','','freight','','cargo','','all other','','']
spanShort=[1,1,3,1,3,1,3,1,3,1,3,1,3,1,3]
spanLong=[1,1,3,1,1,1,1,1,1,1,1,1,3,1,3,1,3,1,3]
combinedHeader=[]
sumSpanLong=0
sumSpanShort=0
spanDiff=0
longHeaderCount=0

for each in range(len(shortHeader)):
    sumSpanLong=sumSpanLong+spanLong[longHeaderCount]
    sumSpanShort=sumSpanShort+spanShort[each]
    spanDiff=sumSpanShort-sumSpanLong
    if spanDiff==0:
        combinedHeader.append([longHeader[longHeaderCount]+' '+shortHeader[each]])
        longHeaderCount=longHeaderCount+1
        continue
    for i in range(0,spanDiff):
            combinedHeader.append([longHeader[longHeaderCount]+' '+shortHeader[each]])
            longHeaderCount=longHeaderCount+1
            sumSpanLong=sumSpanLong+spanLong[longHeaderCount]
            spanDiff=sumSpanShort-sumSpanLong
            if spanDiff==0:
                combinedHeader.append([longHeader[longHeaderCount]+' '+shortHeader[each]])
                longHeaderCount=longHeaderCount+1
                break

print combinedHeader 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-10T09:05:10.277

这是您的算法的修改版本。*zip*用于迭代**较短**的长度和标题，而一个*类对象*用于计算和迭代**较长**的项目，以及组合标题。*while*更适合内循环。（原谅太短的名字）。

```
class collector(object):
    def __init__(self, header):
        self.longHeader = header
        self.combinedHeader = []
        self.longHeaderCount = 0
    def combine(self, shortValue):
        self.combinedHeader.append(
            [self.longHeader[self.longHeaderCount]+' '+shortValue] )
        self.longHeaderCount += 1
        return self.longHeaderCount

def main():
    longHeader = [ 
       '','','bananas','','','','','','','','','','trains','','planes','','','','']
    shortHeader = [
    '','','bunches','','cars','','trucks','','freight','','cargo','','all other','','']
    spanShort=[1,1,3,1,3,1,3,1,3,1,3,1,3,1,3]
    spanLong=[1,1,3,1,1,1,1,1,1,1,1,1,3,1,3,1,3,1,3]
    sumSpanLong=0
    sumSpanShort=0

    combiner = collector(longHeader)
    for sLen,sHead in zip(spanShort,shortHeader):
        sumSpanLong += spanLong[combiner.longHeaderCount]
        sumSpanShort += sLen
        while sumSpanShort - sumSpanLong > 0:
            combiner.combine(sHead)
            sumSpanLong += spanLong[combiner.longHeaderCount]
        combiner.combine(sHead)

    return combiner.combinedHeader 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-10T13:20:02.900

在这个例子中，你实际上做了很多事情。

1.  您已经“过度处理”了 Beautiful Soup Tag 对象以创建列表。将它们保留为标签。

2.  所有这些类型的合并算法都很难。它有助于处理对称合并的两件事。

这是一个可以直接使用 Beautiful Soup Tag 对象的版本。此外，此版本不假设两行的长度。

```
def merge3( row1, row2 ):
    i1= 0
    i2= 0
    result= []
    while i1 != len(row1) or i2 != len(row2):
        if i1 == len(row1):
            result.append( ' '.join(row1[i1].contents) )
            i2 += 1
        elif i2 == len(row2):
            result.append( ' '.join(row2[i2].contents) )
            i1 += 1
        else:
            if row1[i1]['colspan'] < row2[i2]['colspan']:
                # Fill extra cols from row1
                c1= row1[i1]['colspan']
                while c1 != row2[i2]['colspan']:
                    result.append( ' '.join(row2[i2].contents) )
                    c1 += 1
            elif row1[i1]['colspan'] > row2[i2]['colspan']:
                # Fill extra cols from row2
                c2= row2[i2]['colspan']
                while row1[i1]['colspan'] != c2:
                    result.append( ' '.join(row1[i1].contents) )
                    c2 += 1
            else:
                assert row1[i1]['colspan'] == row2[i2]['colspan']
                pass
            txt1= ' '.join(row1[i1].contents)
            txt2= ' '.join(row2[i2].contents)
            result.append( txt1 + " " + txt2 )
            i1 += 1
            i2 += 1
    return result 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-10T07:25:44.283

也许看看部分问题的 zip 函数：

```
>>> execfile('so_ques.py')
[[' '], [' '], ['bananas bunches'], [' '], [' cars'], [' cars'], [' cars'], [' '], [' trucks'], [' trucks'], [' trucks'], [' '], ['trains freight'], [' '], ['planes cargo'], [' '], [' all other'], [' '], [' ']]

>>> zip(long_header, short_header)
[('', ''), ('', ''), ('bananas', 'bunches'), ('', ''), ('', 'cars'), ('', ''), ('', 'trucks'), ('', ''), ('', 'freight'), ('', ''), ('', 'cargo'), ('', ''), ('trains', 'all other'), ('', ''), ('planes', '')]
>>> 
```

`enumerate`可以帮助避免使用计数器进行一些复杂的索引：

```
>>> diff_list = []
>>> for place, header in enumerate(short_header):
    diff_list.append(abs(span_short[place] - span_long[place]))

>>> for place, num in enumerate(diff_list):
    if num:
        new_shortlist.extend(short_header[place] for item in range(num+1))
    else:
        new_shortlist.append(short_header[place])

>>> new_shortlist
['', '', 'bunches', '', 'cars', 'cars', 'cars', '', 'trucks', 'trucks', 'trucks', '',... 
>>> z = zip(new_shortlist, long_header)
>>> z
[('', ''), ('', ''), ('bunches', 'bananas'), ('', ''), ('cars', ''), ('cars', ''), ('cars', '')... 
```

更多的pythonic命名可能会增加清晰度：

```
 for each in range(len(short_header)):
        sum_span_long += span_long[long_header_count]
        sum_span_short += span_short[each]
        span_diff = sum_span_short - sum_span_long
        if not span_diff:
            combined_header.append... 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-11T06:41:52.687

我想我会回答我自己的问题，但我确实得到了很多帮助。感谢所有的帮助。经过一些小的更正后，我使 S.LOTT 的答案起作用。（它们可能小到不可见（内部笑话））。所以现在的问题是为什么这更 Pythonic？我想我看到它的密度较低/使用原始输入而不是推导/我无法判断它是否更容易阅读--->虽然它很容易阅读

## S.LOTT 的回答已更正

```
row1=headerCells[0]
row2=headerCells[1]

i1= 0
i2= 0
result= []
while i1 != len(row1) or i2 != len(row2):
    if i1 == len(row1):
        result.append( ' '.join(row1[i1]) )
        i2 += 1
    elif i2 == len(row2):
        result.append( ' '.join(row2[i2]) )
        i1 += 1
    else:
        if int(row1[i1].get("colspan","1")) < int(row2[i2].get("colspan","1")):
            c1= int(row1[i1].get("colspan","1"))
            while c1 != int(row2[i2].get("colspan","1")): 
                txt1= ' '.join(row1[i1])  # needed to add when working adjust opposing case
                txt2= ' '.join(row2[i2])     # needed to add  when working adjust opposing case
                result.append( txt1 + " " + txt2 )  # needed to add when working adjust opposing case
                print 'stayed in middle', 'i1=',i1,'i2=',i2, ' c1=',c1
                c1 += 1
                i1 += 1    # Is this the problem it

        elif int(row1[i1].get("colspan","1"))> int(row2[i2].get("colspan","1")):
                # Fill extra cols from row2  Make same adjustment as above
            c2= int(row2[i2].get("colspan","1"))
            while int(row1[i1].get("colspan","1")) != c2:
                result.append( ' '.join(row1[i1]) )
                c2 += 1
                i2 += 1
        else:
            assert int(row1[i1].get("colspan","1")) == int(row2[i2].get("colspan","1"))
            pass

        txt1= ' '.join(row1[i1])
        txt2= ' '.join(row2[i2])
        result.append( txt1 + " " + txt2 )
        print 'went to bottom', 'i1=',i1,'i2=',i2
        i1 += 1
        i2 += 1
print result 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-12T04:20:19.540

好吧，我现在有一个答案。我正在考虑这个问题，并决定我需要使用每个答案的一部分。我仍然需要弄清楚我想要一个类还是一个函数。但我有我认为可能比其他任何算法都更 Pythonic 的算法。但是，它大量借鉴了一些非常慷慨的人提供的答案。我非常感谢这些，因为我学到了很多东西。

为了节省编写测试用例的时间，我将在 IDLE 中粘贴我一直在使用的完整代码，并在其后添加一个 HTML 示例文件。除了对类/函数做出决定（并且我需要考虑如何在我的程序中使用此代码）之外，我很高兴看到任何使代码更加 Pythonic 的改进。

```
from BeautifulSoup import BeautifulSoup

original=file(r"C:\testheaders.htm").read()

soupOriginal=BeautifulSoup(original)
all_Rows=soupOriginal.findAll('tr')

header_Rows=[]
for each in range(len(all_Rows)):
    header_Rows.append(all_Rows[each])

header_Cells=[]
for each in header_Rows:
    header_Cells.append(each.findAll('td'))

temp_Header_Row=[]
header=[]
for row in range(len(header_Cells)):
    for column in range(len(header_Cells[row])):
        x=int(header_Cells[row][column].get("colspan","1"))
        if x==1:
            temp_Header_Row.append( ' '.join(header_Cells[row][column]) )

        else:
            for item in range(x):

                temp_Header_Row.append( ''.join(header_Cells[row][column]) )

    header.append(temp_Header_Row)
temp_Header_Row=[]
combined_Header=zip(*header)

for each in combined_Header:
    print each 
```

好的测试文件内容如下对不起我试图附上这些但无法实现：

```
 <TABLE style="font-size: 10pt" cellspacing="0" border="0" cellpadding="0" width="100%">
  <TR valign="bottom">
  <TD width="40%">&nbsp;</TD>
  <TD width="5%">&nbsp;</TD>
  <TD width="3%">&nbsp;</TD>
  <TD width="3%">&nbsp;</TD>
  <TD width="1%">&nbsp;</TD>

  <TD width="5%">&nbsp;</TD>
  <TD width="3%">&nbsp;</TD>
  <TD width="3%">&nbsp;</TD>
  <TD width="1%">&nbsp;</TD>

  <TD width="5%">&nbsp;</TD>
  <TD width="3%">&nbsp;</TD>
  <TD width="1%">&nbsp;</TD>
  <TD width="1%">&nbsp;</TD>

  <TD width="5%">&nbsp;</TD>
  <TD width="3%">&nbsp;</TD>
  <TD width="1%">&nbsp;</TD>
  <TD width="1%">&nbsp;</TD>

  <TD width="5%">&nbsp;</TD>
  <TD width="3%">&nbsp;</TD>
  <TD width="3%">&nbsp;</TD>
  <TD width="1%">&nbsp;</TD>
  </TR>
  <TR style="font-size: 10pt" valign="bottom">
  <TD>&nbsp;</TD>
  <TD>&nbsp;</TD>
  <TD>&nbsp;</TD>
  <TD>&nbsp;</TD>
  <TD>&nbsp;</TD>
  <TD>&nbsp;</TD>
  <TD>&nbsp;</TD>
  <TD>&nbsp;</TD>
  <TD>&nbsp;</TD>
  <TD>&nbsp;</TD>
  <TD nowrap align="right" colspan="2">FOODS WE LIKE</TD>
  <TD>&nbsp;</TD>
  <TD>&nbsp;</TD>
  <TD nowrap align="right" colspan="2">&nbsp;</TD>
  <TD>&nbsp;</TD>
  <TD>&nbsp;</TD>
  <TD nowrap align="right" colspan="2">&nbsp;</TD>
  <TD>&nbsp;</TD>
  </TR>
  <TR style="font-size: 10pt" valign="bottom">
  <TD>&nbsp;</TD>
  <TD>&nbsp;</TD>
  <TD nowrap align="CENTER" colspan="6">SILLY STUFF</TD>

  <TD>&nbsp;</TD>
  <TD>&nbsp;</TD>
  <TD nowrap align="right" colspan="2">OTHER THAN</TD>
  <TD>&nbsp;</TD>
  <TD>&nbsp;</TD>
  <TD nowrap align="CENTER" colspan="6">FAVORITE PEOPLE</TD>
  <TD>&nbsp;</TD>
  </TR>
  <TR style="font-size: 10pt" valign="bottom">
  <TD>&nbsp;</TD>
  <TD>&nbsp;</TD>
  <TD nowrap align="right" colspan="2">MONTY PYTHON</TD>
  <TD>&nbsp;</TD>
  <TD>&nbsp;</TD>
  <TD nowrap align="right" colspan="2">CHERRYPY</TD>
  <TD>&nbsp;</TD>
  <TD>&nbsp;</TD>
  <TD nowrap align="right" colspan="2">APPLE PIE</TD>
  <TD>&nbsp;</TD>
  <TD>&nbsp;</TD>
  <TD nowrap align="right" colspan="2">MOTHERS</TD>
  <TD>&nbsp;</TD>
  <TD>&nbsp;</TD>
  <TD nowrap align="right" colspan="2">FATHERS</TD>
  <TD>&nbsp;</TD>
  </TR>
  <TR style="font-size: 10pt" valign="bottom">
  <TD nowrap align="left">Name</TD>
  <TD>&nbsp;</TD>
  <TD nowrap align="right" colspan="2">SHOWS</TD>
  <TD>&nbsp;</TD>
  <TD>&nbsp;</TD>
  <TD nowrap align="right" colspan="2">PROGRAMS</TD>
  <TD>&nbsp;</TD>
  <TD>&nbsp;</TD>
  <TD nowrap align="right" colspan="2">BANANAS</TD>
  <TD>&nbsp;</TD>
  <TD>&nbsp;</TD>
  <TD nowrap align="right" colspan="2">PERFUME</TD>
  <TD>&nbsp;</TD>
  <TD>&nbsp;</TD>
  <TD nowrap align="right" colspan="2">TOOLS</TD>
  <TD>&nbsp;</TD>
  </TR>
  </TABLE> 
```

# opengl - 将位图转换为多边形 - （反向光栅化）

> ID：277195
> 
> 赞同：5
> 
> 时间：2008-11-10T06:23:55.407
> 
> 标签：opengl, bitmap, polygon, raster

给定一个带有一些纯色斑点的位图图像，你会使用什么算法来构造与这些斑点形状相同的多边形？

这可以通过多个步骤完成：高分辨率多边形可以稍后通过最佳拟合算法进行切割。如果您能告诉我如何将生成的多边形切割成凸组件，以便它们可以在 OpenGL 中毫无问题地渲染，则可以加分。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-10T08:16:59.453

反向光栅化称为[矢量化](http://en.wikipedia.org/wiki/Vectorization_(computer_graphics))。算法通常相当复杂，这里是其中一些的[googlet](http://www.google.com/search?q=vectorization+algorithms&rls=p,com.microsoft:en-gb)。查看稀疏像素跟踪和稀疏像素矢量化以获取一些很好的示例。

有关多边形分割的好算法，请查看 Joespeh O'Rourkes 'Computational Geometry in C'，ISBN 0-521-44034-3，或搜索[凹多边形分割](http://www.google.com/search?hl=en&safe=off&rls=p%2Ccom.microsoft%3Aen-gb&q=concave+polygon+partitioning)算法，例如[这个](http://netcode.ru/dotnet/?lang=&katID=30&skatID=249&artID=6531)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-02-10T20:43:30.417

这在 GIS 中很常见——例如从航空摄影中自动提取特征。选择的开源工具是：

[http://www.gdal.org/gdal_polygonize.html](http://www.gdal.org/gdal_polygonize.html)

[http://www.gdal.org/gdal__alg_8h.html#3f522a9035d3512b5d414fb4752671b1](http://www.gdal.org/gdal__alg_8h.html#3f522a9035d3512b5d414fb4752671b1)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2021-04-22T01:33:47.520

我`findContours`通过他们的 Python 接口使用 OpenCV 的方法： [https ://opencv-python-tutroals.readthedocs.io/en/latest/py_tutorials/py_imgproc/py_contours/py_contours_begin/py_contours_begin.html](https://opencv-python-tutroals.readthedocs.io/en/latest/py_tutorials/py_imgproc/py_contours/py_contours_begin/py_contours_begin.html)

# asp.net - asp.net 菜单控件在 Safari 中无法正确显示

> ID：277197
> 
> 赞同：8
> 
> 时间：2008-11-10T06:26:41.533
> 
> 标签：asp.net, aspmenu

我正在处理的网站正在使用 Databound asp:Menu 控件。发送 1 个菜单项时，它呈现的 HTML 在 Firefox（和 IE）中是绝对正确的，但在 Safari 和 Chrome 中确实弄乱了代码。下面是发送到每个浏览器的代码。我已经测试了几个浏览器，它们的渲染都非常相似，所以我只在渲染源上发布了两个变体。

**我的问题是：如何让 ASP.NET 向 Chrome 和 Safari 发送与 Firefox 和 IE 相同的 html 和 javascript？**

```
<!-- This is how the menu control is defined -->
<asp:Menu ID="menu" runat="server" BackColor="#cccccc"
    DynamicHorizontalOffset="2" Font-Names="Verdana" StaticSubMenuIndent="10px" StaticDisplayLevels="1"
    CssClass="left_menuTxt1" Font-Bold="true" ForeColor="#0066CC">
    <DataBindings>
        <asp:MenuItemBinding DataMember="MenuItem" NavigateUrlField="NavigateUrl" TextField="Text"
            ToolTipField="ToolTip" />
    </DataBindings>
    <StaticSelectedStyle BackColor="#0066CC" HorizontalPadding="5px" VerticalPadding="2px"
        Font-Names="Verdama" CssClass="left_menuTxt1" Font-Bold="true" />
    <StaticMenuItemStyle HorizontalPadding="5px" VerticalPadding="8px" />
    <DynamicMenuStyle BackColor="#fbfbfb" BorderColor="#989595" BorderStyle="Inset" BorderWidth="1"
        Width="80px" VerticalPadding="1" />
    <DynamicMenuItemStyle HorizontalPadding="5px" VerticalPadding="2px" Font-Name="Verdama"
        ForeColor="#c6c4c4" CssClass="left_menuTxt1" Font-Bold="true" />
    <DynamicSelectedStyle BackColor="#cccccc" HorizontalPadding="5px" VerticalPadding="2px"
        Font-Names="Verdama" CssClass="left_menuTxt1" Font-Bold="true" />
</asp:Menu>
<!-- From Safari View Page Source (Chrome source very similar) -->
<span title="Order" class="ctl00_leftNav_menu_4">
<a class="ctl00_leftNav_menu_1 ctl00_leftNav_menu_3" 
  href="javascript:__doPostBack('ctl00$leftNav$menu','oMy Order')">
My Order
<img src="/WWW/WebResource.axd?d=glUTEfEv7p9OrdeaMxkMzhqz2JugrMr8aE43O2XGHAA1&amp;t=633590571537099818" 
alt="Expand My Order" 
align="absmiddle" 
style="border-width:0px;" /></a></span><br />

<!-- From Firefox View Page Source (IE View page similar) -->
<table>
<tr onmouseover="Menu_HoverStatic(this)" 
    onmouseout="Menu_Unhover(this)" 
    onkeyup="Menu_Key(event)" 
    title="Order" 
    id="ctl00_leftNav_menun0">
  <td>
    <table class="ctl00_leftNav_menu_4" cellpadding="0" cellspacing="0" border="0" width="100%">
     <tr>
       <td style="white-space:nowrap;width:100%;">
          <a class="ctl00_leftNav_menu_1 ctl00_leftNav_menu_3" 
             href="../Order/OrderList.aspx">
My Order
          </a>
       </td>
       <td style="width:0;">
           <img src="/WWW/WebResource.axd?d=glUTEfEv7p9OrdeaMxkMzhqz2JugrMr8aE43O2XGHAA1&amp;t=633590571537099818" 
                alt="Expand My Order" style="border-style:none;vertical-align:middle;" />
       </td>
     </tr>
  </table>
 </td>
</tr>
</table> 
```

更新：我的解决方案帖子是正确的..但我无法将自己的标记为正确...所以如果有人想复制它，我可以关闭它。:)

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-10T06:47:35.890

我从[weblogs.asp.net](http://weblogs.asp.net/dannychen/archive/2005/11/21/using-device-filters-and-making-menu-work-with-safari.aspx)上的评论中找到了这个解决方案。这可能是一个黑客，但它确实有效。

这种跨浏览器兼容性的斗争越来越令人不安。

```
 if (Request.UserAgent.IndexOf("AppleWebKit") > 0)
    {

        Request.Browser.Adapters.Clear();

    } 
```

如果有人有更好的解决方案而不是黑客，如果您发布它，我将不胜感激。从我广泛的网络搜索来看，菜单控件的这个问题似乎并不孤单，所以一些好的参考可以帮助其他处于相同情况的人。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-10T14:25:52.503

我也遇到了 asp:menu 控件和 webkit 的问题。另外，很难完全按照我想要的方式设计。我的建议是使用 CSS Friendly Control Adapters：

*   [http://www.asp.net/cssadapters/](http://www.asp.net/cssadapters/)
*   [http://www.asp.net/CSSAdapters/Menu.aspx](http://www.asp.net/CSSAdapters/Menu.aspx)

这会将菜单的表格转换为更现代且对 SEO 友好的标记。你的菜单看起来更像这样：

```
<ul class="AspNet-Menu">
  <li class="Leaf Selected">
    <a href="Orders.aspx" class="Link Selected">Orders</a></li>
  <li class="ALeaf">
    <a href="MyOrders.aspx" class="Link">My Orders</a></li>
</ul> 
```

在我的测试中，所有浏览器中的标记都是相同的。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-01-08T21:16:00.830

如果您有多个网络应用程序，这是为 chrome 和 safari 解决此问题的最简单方法：

**在 "%SystemRoot%\Microsoft.NET\Framework[version]\CONFIG\Browsers" 中创建一个名为 safari.browser 的文件，其中包含以下内容：**

```
<browsers>
    <browser refID="Safari1Plus">
        <controlAdapters>
            <adapter controlType="System.Web.UI.WebControls.Menu"
                     adapterType="" />
        </controlAdapters>
    </browser>
</browsers> 
```

这将告诉 asp.net 在为 safari 呈现菜单控件时不要使用适配器。Safari1Plus 定义在同一目录中 mozilla.browser 文件的末尾。这也适用于 chrome，因为它们都使用 webkit，这是 asp.net 识别 Safari1Plus 的方式。

**接下来运行 %SystemRoot%\Microsoft.NET\Framework[version]\aspnet_regbrowsers -i**

这会将所有浏览器文件编译成一个程序集并将其添加到 GAC。

现在 asp.net 菜单将在 safari 和 chrome 中正确呈现。

或者，您可以将文件添加到每个 Web 应用程序的 App_Browsers 目录中。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2011-02-04T16:47:18.383

我只是想提交一个替代选项。这适用于 ASP.NET 3.5。

*   将“App_Browsers”ASP.NET 文件夹添加到您的项目中
*   在此文件夹中创建浏览器文件
*   在浏览器文件中，在标签之间添加以下代码`<browsers>`：

    `<browser id="Chrome" parentID="Safari1Plus">`
    `<controlAdapters>`
    `<adapter controlType="System.Web.UI.WebControls.Menu" adapterType="" />`
    `</controlAdapters>`
    `</browser>`

这应该在 Chrome/Safari 中正确呈现菜单控件。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2010-06-11T18:33:47.273

[Mayank Sharma](http://geekswithblogs.net/bullpit/archive/2009/07/08/aspmenu-rendering-problems-in-ie8-safari-and-chrome.aspx)找到了一种适用于母版页的解决方案，而不是编辑单个页面。所有使用母版页的页面都是无缝修复的。它仍然是一个黑客，但你做你必须做的。这是后面的准系统示例母版页代码。

```
using System;
using System.Web.UI;

/// <summary>
/// Summary description for ExampleMasterPage
/// </summary>
public class ExampleMasterPage : MasterPage
{    
    public ExampleMasterPage() { }

    protected override void AddedControl(Control control, int index)
    {
        if (Request.ServerVariables["http_user_agent"]
            .IndexOf("Safari", StringComparison.CurrentCultureIgnoreCase) != -1)
        {
            this.Page.ClientTarget = "uplevel";
        }
        base.AddedControl(control, index);
    }
} 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2011-09-22T08:53:51.880

像魔术一样工作！

```
 If Request.ServerVariables("http_user_agent").IndexOf("Safari", StringComparison.CurrentCultureIgnoreCase) <> -1 Or Request.UserAgent.Contains("AppleWebKit") Then
        Request.Browser.Adapters.Clear()
        Page.ClientTarget = "uplevel"
    End If 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-06-29T15:16:00.933

这是转换为 VB.NET 的 @Mayank Sharma / @jball C# 版本。感谢修复家伙，困扰我几个月了。我的问题是 MAC 和 PC 上的每个浏览器都可以正常工作，除了 IE8 和 Chrome。但是 Chrome，尽管我很喜欢它，但经常无法运行 Google Docs - 解决这个问题！！！

```
Protected Overrides Sub AddedControl(ByVal control As Control, ByVal index As Integer)
    If Request.ServerVariables("http_user_agent").IndexOf("fake_user_agent", StringComparison.CurrentCultureIgnoreCase) <> -1 Then
      Me.Page.ClientTarget = "uplevel"
    End If
    MyBase.AddedControl(control, index)
  End Sub 
```

您会注意到我必须检查“fake_user_agent”，而不是“Safari”。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2011-05-06T13:59:16.033

Chrome 和 Safari 无法正确呈现菜单控件的问题是由于 Chrome 和 Safari 正在呈现导航跳过链接图像框。

如果您`display: none;`在图像上为跳过链接执行 css，则菜单控件会按应有的方式定位自身。

我已经在一个简单的 1 级菜单而不是嵌套菜单上对此进行了测试。

[http://www.stfu.com/2011/05/05/asp-net-menu-control-positioning-in-safari-google-chrome/](http://www.s-t-f-u.com/2011/05/05/asp-net-menu-control-positioning-in-safari-google-chrome/)

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2009-05-21T19:06:26.193

像这样添加`ClientTarget="uplevel"`到页面指令使 Safari 工作：

```
<%@ Page ClientTarget="uplevel" ... %> 
```

# c - OpenGL 包含 OS X 上的指令

> ID：277207
> 
> 赞同：3
> 
> 时间：2008-11-10T06:33:20.083
> 
> 标签：c, macos, opengl

我有点困惑为什么这段代码可以编译。我省略了“必要的” `#include <OpenGL/gl.h>`，但程序仍然可以编译。当我的程序从 GL 库调用函数而不包括它们时，这怎么可能。

```
int main(int argc, char** argv)
{

    glClearColor(1.0,1.0,1.0,1.0);
    return 0;
} 
```

我使用这个编译命令：

```
 gcc -framework GLUT -framework OpenGL test.c 
```

我假设添加 -framework 只是指定库所在的链接器，但我认为我仍然需要标头？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-10T06:48:49.773

glClearColor 不是宏，因此您*不需要*标题来定义它。如果添加警告：

```
gcc -o test -Wall -W test.c -framework GLUT -framework OpenGL 
```

然后你会收到关于 glClearColor 隐式声明的警告。您也将无法使用任何宏，因为编译器会给您一个错误，即它们未定义。由于链接器正确解析了 glClearColor 符号，因此您永远不会收到错误。

我还想到，您可能一直想知道这一点，因为您认为您正在为 C++ 进行编译。您给出的示例实际上编译了 C 代码，其中未能声明函数原型不是错误。如果您打算将其编译为 C++ 代码，则需要以下命令行：

g++ -o test test.cpp -framework OpenGL

在这种情况下，您肯定会因为不包含 gl.h 而收到错误，并且您的代码将无法编译。从命令行执行 GCC 时，g++ 是 C++ 编译器，而 gcc 是通用 C 编译器。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-10T06:53:29.513

在 C（C99 之前）中，您不必为了使用它们而声明函数。编译器将假定该函数采用您传递给它的提升参数类型，并假定该函数返回一个`int`. 然而，这可能会产生很大的问题，如果函数没有，则行为是不确定的。让我们看看这个：

```
/* file1.c */
void foo(char a, char b) {
    /* doing something ... */
}

/* main.c */
int main(void) {
    char a = 'a', b = 'b';
    /* char variables are promoted to int 
       before being passed */
    foo(b, a); 
} 
```

因为如果在调用函数时没有声明函数，则类型会被提升（`char -> int, float -> double`），所以参数无法再在内存中的正确位置传递。访问 b 可能会产生一个奇怪的参数值。作为一个侧节点，当您将参数传递给`vararg functions`like`prinft`或没有原型的函数（like `void f()`，其中没有关于参数类型和计数的信息）时，也会出现同样的问题。这就是您始终必须`va_arg`使用其提升类型来访问可变参数的原因。如果你不这样做，GCC 会警告你。

始终包含正确的头文件，这样您就不会遇到这个问题。

**编辑：**感谢 Chris 指出`char literals`(like `'a'`) 始终是`int`C中的类型

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-10T08:28:58.090

这实际上与经典的 C&R hello world 片段有关：
[http ://en.wikipedia.org/wiki/Hello_world#History](http://en.wikipedia.org/wiki/Hello_world#History)

# version-control - 作为一个单独的开发者，我应该如何使用 Mercurial？

> ID：277208
> 
> 赞同：62
> 
> 时间：2008-11-10T06:34:03.953
> 
> 标签：version-control, mercurial

我决定将 Mercurial 用于一个小型的个人项目。

我读过的大部分帮助都是关于合并多个用户之间的更改。因为我是独奏，这不会发生。

我应该有多个存储库吗？我的开发计算机已经每晚都备份到我的 Windows Home Server，所以在别处有第二个存储库只是为了备份目的似乎没有什么价值。

我应该每天分支吗？或者只是在发布附近？还是什么时候？

一般来说，您建议单独使用 Mercurial 的开发人员采取哪些做法？

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2009-03-01T17:39:13.460

我使用 Mercurial 开发 FsCheck，这是一个托管在 codeplex 中的单元测试框架。我目前是唯一的开发人员，但偶尔会有人给我发补丁。

具体来说，我的文件系统中有一个名为“FsCheck”的文件夹。在那，我有一个存储库，因此有一个名为 main 的文件夹。通常，我在处理特定功能或错误修复或其他任何内容的文件夹旁边有几个文件夹，例如错误转义异常和功能状态检查和补丁用户Foo。这些是使用 hg clone 创建的。

当我完成某个功能或错误修复后，我会提交该文件夹中的所有内容并推送到 main。可能合并到main中。（hg 提交、hg 推送、hg 合并）。然后我删除了文件夹（小心使用 hg status 和 hg dedicated ，我不会丢掉有用的东西）。

我几乎从不在 main 工作，除非在发布之前进行最后的清理（比如文档）。在发布之前，我在 main 中标记了发布号（hg tag v0.5.1）。

Codeplex 使用 svn 作为源控制。我只使用它来存储版本，为此我使用本地签出的 SVN 工作副本，我使用 hg 存档将 Mercurial 存储库复制到其中。然后使用 svn 提交。原始的，但它可以工作（在我看来，在 Windows 上使用 Mercurial 作为 SVN“超级客户端”还不是很友好）

我还不需要对以前的版本进行维护，但我会通过从该版本的修订版中克隆主存储库来做到这一点（这很容易，因为我标记了它），并在那个单独的存储库中工作。合并回主干就像将更改推送到主干并合并一样容易。

总之：

*   一个文件夹，用于存储您的所有项目的存储库，以及您的项目名称
*   在该文件夹中，每个“工作单元”有一个主存储库和一个临时存储库，并带有工作单元的描述性名称。

这很好，因为您的分支和您正在处理的内容在文件系统中直观可见。

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2009-02-24T07:21:50.553

从你的问题的措辞来看，我认为你可能对版本控制术语有一些误解。

每个项目都应该有一个存储库。您可以将存储库简单地视为文件系统上的文件夹。当您在特定文件夹中初始化 Mercurial 存储库时，该文件夹中的每个文件及其任何子文件夹都有资格添加到存储库以进行版本控制。您不一定要添加所有内容，但如果您愿意，可以添加任何内容。

如果您愿意，可以将此本地存储库推送到远程存储库，作为备份形式或作为与他人共享代码的方法。但如果它只是一个个人项目，这很可能没有必要，特别是因为您已经有了一个备份解决方案。

分支通常用于将项目的不同“版本”分开。正如一些人所提到的，这对于作为独立开发人员尝试重构代码的方法或测试特定问题的不同方法时很有用。如果它不成功，你不必担心找出回滚到哪里，你只需烧掉分支。如果它确实有效，则将分支合并回主存储库（“主干”）并继续。

如果您确实到了“发布”代码的地步，并且需要继续维护旧版本，那么您还需要使用分支。例如，假设您发布了 1.0 版，并且有人开始使用它。当他们使用它时，您私下继续努力开发下一个版本，可能是 1.1，在您的主干存储库中添加功能。现在，有人在已发布的 1.0 代码中发现了一个错误，您需要修复它，但您不能只在主干中修复它并给他们该代码，因为它处于没有发布的状态。这就是 1.0 分支派上用场的地方。您可以修复 1.0 分支中的错误，并将错误修复更改合并到主干中，以便在那里修复错误。然后您可以使用错误修复重新打包 1.0 并将其发布给您的用户，

除此之外，使用 Mercurial 独奏通常不会涉及很多花哨的工作。做一些工作，当你完成一个特性时，提交它给自己一个“检查点”，如果需要，你可以在未来返回。您不需要每次保存或类似的东西时都提交，只要在您觉得添加了一些重要的东西时就这样做。如果您需要回顾它，这将为您提供该项目的良好历史。

有关更多信息，我强烈建议您花点时间阅读这本书：[分布式修订控制与 Mercurial](http://hgbook.red-bean.com/hgbook.html)。您不必阅读高级主题，但至少阅读第 1-5 章和第 8 章可以很好地介绍 Mercurial 和一般的版本控制。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-24T07:44:27.363

我使用了不同于 Mercurial 的另一个分布式版本控制系统，但我怀疑这是否重要。

在我的个人项目中，我大量使用分支。我通常有一个主要的开发分支（“主干”），它应该始终有一个工作版本。我的意思是单元测试和其他自动化测试通过，并且所有代码都通过这些测试进行测试，除了我明确排除在测试覆盖范围之外的小部分。这确保了行李箱始终处于良好的状态以供进一步发展。

每当我开始进行更改时，我都会从主干分支创建一个新分支。这给了我自由破解的自由。例如，我可能不担心通过这个分支的自动化测试。由于它是一个孤立的区域，我可以随意提交，而且我确实这样做了：微提交是我最喜欢的分布式版本控制功能。分支中的工作完成后，我将其合并回主干。

这种工作方式的好处是，如果事实证明我正在进行的更改是一个坏主意，我可以轻松退出。事实上，没有什么可以退出的，因为更改尚未合并。

有时我很懒，不会为我正在开发的一些新事物创建新分支。当我需要比预期更多的时间来完成工作时，事实总是证明这是一个错误。当我需要在此过程中进行另一个不相关的更改时，情况会变得更糟。当我遵循 all-work-in-its-own-branch 风格时，可以在自己的分支中完成不相关的更改，合并到主干中，然后如果需要，另一个分支可以合并来自主干的更改。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-02-24T07:48:49.133

我每天都使用 Mercurial，请参见[此处](http://echoreply.us/hg/index.php)，我还在少数支持 Mercurial 的免费托管服务之一[ShareSource](http://sharesource.org)（我在积分页面上）提供帮助。[自从Xen](http://xen.org)放弃 BitKeeper以来，我一直在使用 HG 。

我会建议你，对于个人项目，不惜一切代价避免分支。Mercurial 关于[分支是什么的想法](http://www.selenic.com/mercurial/wiki/index.cgi/Branch)与您的预期有很大不同。Git 等其他系统使分支（和疯狂科学家的想法）更容易一些。但是，我只在需要简单、便宜的分支时才使用 Git。

我与 hg 的典型一天：

```
(See where I left off)
# hg status 

(See what I was doing with foo)
# hg diff -r tip src/foo/foo.c

(Finish one module, commit it)
# hg commit src/foo/foo.c

(Push changes)
# hg push 
```

合并也非常简单，以及从相关存储库中提取特定修订。但是，如果你是单独的，很可能会遇到要解决的合并问题，你可能会因为不更新远程仓库而搞砸了。

我已经开始了一些个人爱好项目，这些项目在我发布一年后广受欢迎，我很高兴我使用了 HG。它的语法接近颠覆，非常直观且非常便携。

当然，是的，我使用 Git 和 SVN .. 但不用于个人项目。关于我的 repo 索引（发布的链接）的注释，我用 PHP 重新编写了 hgwebdir，因为我想轻松地修改它的外观并从每个 repo 中提取 RSS。

简而言之，对于个人使用，您会发现它非常友好。提交、标签等很简单。除非你真的需要它们，否则避免使用分支。

这是我前段时间写的一篇教程，描述了如何使用[Mercurial 来管理网站](http://echoreply.us/tuto/mercurial_site_management.html)，你可能会在设置密钥、hgrc 等时对它感兴趣。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-11-10T07:01:02.960

这些通常与您从事任何软件项目的工作相同。简单地拥有或不拥有版本控制超出了任何讨论范围；）

通常，您只需在功能准备就绪时提交。由于您有备份，因此您无需每天提交即可安全地存储您的工作。

对于分支：在我的个人项目中，我主要使用它来尝试想法，例如。当我对同一问题有另一种解决方案时。为此，我也喜欢 Git 的 stash 命令。

但是我确实有多个存储库。我有一个带有 shell 访问权限的主机，我推送到该主机。因此，无论我在哪里工作和拥有任何工作站（在工作中：当我有时间编写代码时，在家里的桌面上以及在父母家时在笔记本电脑上时），我都可以与该存储库同步。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-11-10T06:50:10.270

我不知道您为什么需要多个存储库，因为您已经在备份存储库所在的计算机。

也许你会为自己分支，如果说你想研究一个特性并且不想在你的主代码分支中打乱。

但也许你会从我之前提出的[问题中提取一些东西。](https://stackoverflow.com/questions/119396/source-code-control-policy)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-03T14:20:57.540

我之前使用 CVS、Perforce、Subversion 作为我的个人版本控制系统，大约两周前开始使用 Mercurial :-) 在工作中我们使用 MS Team System ...

对我来说，最值得注意的新事物是不同机器之间的轻松传输。在工作中，我在一个 mercurial repo 中有一些东西（使用 hg 作为团队系统的超级客户端）。我定期将所有更改推入/拉出笔记本电脑，因此我在两台机器上都有完整的历史记录。

在家里，我也从笔记本电脑推/拉回购。

因此，我可以在任何地方工作（家庭办公室使用强大的计算机，在路上使用笔记本电脑或在工作中），而不必担心我是否会丢失更改。好的，偶尔我需要合并两个更改，但这很少会造成伤害……恕我直言，hg 做得很好。

此外，使用 mercurial 的“设置成本”非常低。您阅读了教程，安装它，说“hg init”并继续工作。无需再决定某些东西是否属于您的神圣 SVN 服务器，放在哪里等等。Mercurial 的“摩擦”比 SVN 的低一点。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-10T19:46:35.710

我认为这取决于您是否同时维护现有应用程序*并*添加功能（或修复大错误）。

这样，您可以在主分支中修复错误，同时在其自己的分支中创建新功能。

我对我的应用程序就是这样做的，但使用的是本地版本的 CVS。此外，如果您的团队中添加了新的开发人员，您就可以开始了。

我同意这是与备份不同的问题。

祝你好运，
兰迪·施泰格鲍尔

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-17T04:04:31.233

SCM 是编辑器的一种“智能”撤消缓冲区扩展。您可以回到过去，您可能已经解决了一个问题，但删除了它，因为它已被重构，但您将再次需要解决方案，等等。设置一个视觉差异，它会告诉您自上次以来您所做的更改提交或在过去两天里，如果我不喜欢我的旧解决方案，我会不断审查我的代码并更改它。

分支正在处理流：当您开始朝一个方向前进，但它需要更多思考，同时您想从事其他工作时，它会有所帮助。

请注意，DVCS 将存储库作为一个单元处理。您可以逐个文件提交（使用过滤器），但它们会将更改存储在整个存储库中。它使 cvs (svn) 用户感到困惑，因为单个文件更改更规律。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-02-19T11:55:42.027

拥有多个克隆的另一个很好的理由（至少如果你有不止一台计算机）是你很容易看到你是否在你的代码中引入了任何依赖项。（即您的代码将在另一台机器上运行，它可能没有您的主工作站拥有的所有开发包）

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-02-27T07:06:07.900

我建议您[阅读此链接](http://bazaar-vcs.org/Workflows)，其中概述了您可以实施 SCC 的各种方法，并选择最适合您需求的方法

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-03-02T08:38:22.333

像 Mercurial 和 Bazaar 和 Git 这样的 DVC 已经使许多东西变得便宜，这样一支军队就可以从扩展的功能中受益。

1.  如果您保持纪律以使工作分支保持最新或脱离主线并将所有增量有意义地同步到 DVC 中，则您可以快速尝试“一次性”代码。

    代码流畅无忧，实际上它可以提供一种精神上的自由来尝试多种解决方案，然后再选择首选解决方案。

2.  有些人为他们实现的每个功能（尤其是在 git 中）创建分支，无论其大小。在 mercurial 中，这种开发方法很便宜，那么为什么不使用该功能呢？所以这可能意味着每天多次提交较小的提交和较大的提交。

    一种。如果您采用这种方法，您可能希望在工作日结束时将更改推送到主机外存储库，以涵盖 *当天完成的工作*与*发生 WHS 备份*的时间之间的时间。

    湾。我已经在我的 WHS 上安装了*CopSSH*，它在大约 5MB 中为 Windows 框提供了 SSH/SFTP/SCP 功能。在此之前，我在 Virtual Server 2005 上运行 Ubuntu Linux，以提供类似的功能等服务。 *您可以通过 ssh 将您的 mercurial 推送到 WHS 框*

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2010-11-16T18:35:05.567

我总是使用 Git 或 Mercurial，即使是单独使用。

当我想让一些可重用的组件可用于其他项目时，我会分离存储库。我配置为当我提交时，它也会自动推送（我使用 Tortoise HG 插件），因为有时我忘记推送，而当我在地理上移动时我需要那个代码，明白吗？

所以，这是我的建议。

# asp.net - 我需要获取在 ASP.net 中散列的密码

> ID：277210
> 
> 赞同：0
> 
> 时间：2008-11-10T06:35:12.047
> 
> 标签：asp.net, hash

我以散列形式存储我的所有密码。我需要找回这些密码，例如

我的密码是“123456”，我将其保存为散列的“3453474852dfdsfdsfdf”值。

我需要从散列值中检索原始密码。（获取密码）。

我怎样才能做到这一点？。我正在做 SHA1 哈希算法。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-11-10T06:38:36.580

这是不可能的。SHA1 是一种非常小心谨慎[的单向函数](https://secure.wikimedia.org/wikipedia/en/wiki/One-way_function)。

您为什么要尝试恢复原始密码？身份验证不需要它，因为您只需散列输入密码并比较散列值。

如果是因为用户忘记了密码，那么标准做法似乎是生成一个随机重置链接并将其通过电子邮件发送给用户。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-10T06:39:01.897

你不能。[散列函数](http://en.wikipedia.org/wiki/Cryptographic_hash_function)（与[加密](http://en.wikipedia.org/wiki/Encryption)相反）的要点在于它是*一个单向*过程。换句话说，可以有多个密码哈希到相同的值，并且没有办法从哈希到原始密码。

这很有用，因为您不需要任何类型的“主密码”或双向加密所需的其他秘密 - 但这确实意味着您永远无法从散列值中取回原始密码。如果您确实需要密码，则必须使用加密/解密而不是散列。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-10T06:40:07.153

你不能那样做，这就是哈希函数的意义所在。事实上，多个密码可以给你相同的哈希，所以即使你找到一个字符串给你这个哈希，它也可能不是正确的。
如果您需要找回密码，请不要使用散列，使用 RSA 之类的东西。

一些链接供您阅读：

*   [http://en.wikipedia.org/wiki/Cryptographic_hash_function](http://en.wikipedia.org/wiki/Cryptographic_hash_function)
*   [http://en.wikipedia.org/wiki/RSA](http://en.wikipedia.org/wiki/RSA)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-10T09:34:58.580

关于该主题的两篇有趣的文章：[您可能错误地存储了密码](http://www.codinghorror.com/blog/archives/000953.html "编码恐怖：您可能错误地存储了密码")和[Rainbow Hash Cracking](http://www.codinghorror.com/blog/archives/000949.html "编码恐怖：彩虹哈希破解") ...

因此，这取决于您打算做什么（密码存储保险箱或为网站上的用户存储密码等）。对于前一种用法，你可以看看[KeePass](http://keepass.info/ "KeePass 密码保险箱")是如何工作的（它是开源的）。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-10T06:57:37.790

你不能，这就是哈希的用途。正因为如此，许多网站都可以选择*重置*密码（即将您提供的新密码的哈希值放入数据库）。您通常找不到*检索*当前密码的选项（即通过邮件将其发送给您）。

如果网站确实提供了此功能，则意味着它们**不**存储密码哈希，而是存储明文或加密密码。由于存储哈希是最佳做法，因此您应该避开提供密码检索的站点。

而且您应该避免自己开发这样的网站；-)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-10T06:54:50.587

如果您不使用[盐](http://en.wikipedia.org/wiki/Salt_(cryptography))，那么您可以使用[字典攻击](http://en.wikipedia.org/wiki/Dictionary_attack)来破解密码。

编辑：我意识到他最初的问题是如何检索*他存储*的密码，但是为问题标题所暗示的更通用的问题提供解决方案让我很开心。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-10T07:19:08.510

理论上你不能像其他评论提到的那样。

我认为 Rick 想说的是，如果攻击者知道您使用 SHA1 算法进行散列和您使用的盐，他们可以将散列映射到密码以尝试检索密码。

但要回答你的问题：不，你不能轻易做到这一点。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-10T09:49:14.417

在这里并不是要粗鲁，但是您真的了解为什么首先要对密码进行哈希处理吗？

# validation - 是否有用于英国地址或电话号码验证的伪代码？

> ID：277211
> 
> 赞同：6
> 
> 时间：2008-11-10T06:35:32.093
> 
> 标签：validation, phone-number, street-address

您是否有用于在英国对以下项目进行现场验证的伪代码？我来自美国，所以我现在只知道美国的那些。

*   地址第一行
*   电话号码
*   手机号码（如果他们对此有特殊规定，他们可能没有）
*   邮政编码

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-10T07:40:45.160

地址第 1 行，如果您想验证用户输入的自由格式，您可能会被淹没。有很大的可变性。您可以使用邮政编码地址文件（见下文）来协助，

通常，如果您想要一个“标准”地址，面向英国的网站会询问邮政编码，然后提示用户从该邮政编码的所有地址中选择正确的地址

电话号码和手机号码。请参阅此处[http://en.wikipedia.org/wiki/Telephone_numbers_in_the_United_Kingdom](http://en.wikipedia.org/wiki/Telephone_numbers_in_the_United_Kingdom)。可以在此处找到验证这些（多种语言）的脚本：[http ://www.braemoor.co.uk/software/telnumbers.shtml](http://www.braemoor.co.uk/software/telnumbers.shtml)

邮政编码格式：[http](http://en.wikipedia.org/wiki/UK_postcodes) ://en.wikipedia.org/wiki/UK_postcodes （包含验证的正则表达式，并引用列出有效地址的邮政编码地址文件）

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-10T07:37:13.013

地址行 1 几乎可以是任何东西。并不总是有门牌号码。

电话号码：区号的长度各不相同。我不想发誓全长是否恒定，但我怀疑它总是至少 10 位数。手机号码（IME）通常以 07 开头，而固定电话通常以 01 或 02 开头。特殊号码（免费、本地费率等）通常以 08 开头。我会尝试为此找到参考。（编辑：再一次，有一篇很好的[维基百科文章](http://en.wikipedia.org/wiki/UK_telephone_numbers)。）

维基百科有[一篇关于英国邮政编码的好文章](http://en.wikipedia.org/wiki/UK_postcodes)，包括它们的正则表达式。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-10T08:18:41.230

Perl 的[Number::Phone](http://search.cpan.org/dist/Number-Phone)模块可以处理英国的电话号码。[皇家邮政](http://www.royalmail.com/)提供地址验证和列表清理服务。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-10T08:32:14.523

对于英国电话号码，您最好的选择（不幸的是）可能是从 Ofcom 下载编号计划（它们是 excel 电子表格，包含所有相关的号码范围，分为区号、“地理号码”、个人号码、手机号码、各种服务号码、不同的付费号码以及从号码范围到运营商的映射（不过，后者可能不是您需要的）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-10T11:14:48.627

与此类问题一样，不要沉迷于过度验证。检查最有可能严重畸形的输入，然后继续。试图跟踪在任何特定语言环境中使用的电话号码的前缀和长度是对您时间的极大浪费。让一些可能可以修复的错误通过告诉他们“无效”而失去客户要好。

（您在英国获得的最接近标准地址格式的是邮政编码加门牌号码。即使这样也总是有例外。）

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-09-03T18:25:22.033

[我已经在这里](https://github.com/django/django/pull/316/files)开始了用于 GB 电话号码的 Django 表单验证的代码（或至少一堆 RegEx 模式）。[这里](http://thedjangoforum.com/board/thread/1269/)
有一个基本的解释。

# php - 如何捕获 PHP 致命 (`E_ERROR`) 错误？

> ID：277224
> 
> 赞同：576
> 
> 时间：2008-11-10T06:42:27.647
> 
> 标签：php, fatal-error

我可以`set_error_handler()`用来捕获大多数 PHP 错误，但它不适用于致命 ( `E_ERROR`) 错误，例如调用不存在的函数。还有其他方法可以捕获这些错误吗？

我正在尝试调用`mail()`所有错误并正在运行 PHP 5.2.3。

* * *

## 回答 #1

> 赞同：649
> 
> 时间：2010-01-27T10:48:50.157

`register_shutdown_function`使用需要 PHP 5.2+的 记录致命错误：

```
register_shutdown_function( "fatal_handler" );

function fatal_handler() {
    $errfile = "unknown file";
    $errstr  = "shutdown";
    $errno   = E_CORE_ERROR;
    $errline = 0;

    $error = error_get_last();

    if($error !== NULL) {
        $errno   = $error["type"];
        $errfile = $error["file"];
        $errline = $error["line"];
        $errstr  = $error["message"];

        error_mail(format_error( $errno, $errstr, $errfile, $errline));
    }
} 
```

您必须定义`error_mail`和`format_error`函数。例如：

```
function format_error( $errno, $errstr, $errfile, $errline ) {
    $trace = print_r( debug_backtrace( false ), true );

    $content = "
    <table>
        <thead><th>Item</th><th>Description</th></thead>
        <tbody>
            <tr>
                <th>Error</th>
                <td><pre>$errstr</pre></td>
            </tr>
            <tr>
                <th>Errno</th>
                <td><pre>$errno</pre></td>
            </tr>
            <tr>
                <th>File</th>
                <td>$errfile</td>
            </tr>
            <tr>
                <th>Line</th>
                <td>$errline</td>
            </tr>
            <tr>
                <th>Trace</th>
                <td><pre>$trace</pre></td>
            </tr>
        </tbody>
    </table>";
    return $content;
} 
```

使用[Swift Mailer](http://swiftmailer.org/)编写`error_mail`函数。

也可以看看：

*   *[$php_errormsg](http://php.net/manual/en/reserved.variables.phperrormsg.php)*
*   *[预定义常量](http://php.net/manual/en/errorfunc.constants.php)*

* * *

## 回答 #2

> 赞同：164
> 
> 时间：2010-08-02T15:04:39.350

我刚刚想出了这个解决方案（PHP 5.2.0+）：

```
function shutDownFunction() {
    $error = error_get_last();
     // Fatal error, E_ERROR === 1
    if ($error['type'] === E_ERROR) {
         // Do your stuff
    }
}
register_shutdown_function('shutDownFunction'); 
```

不同的错误类型在*[Predefined Constants](http://www.php.net/manual/en/errorfunc.constants.php)*中定义。

* * *

## 回答 #3

> 赞同：121
> 
> 时间：2008-11-10T09:44:04.490

PHP 没有提供传统的方法来捕获致命错误并从中恢复。这是因为处理通常不应在致命错误后恢复。匹配输出缓冲区的字符串（如原始帖子所建议的那样，PHP.net 上描述的技术）绝对是不明智的。这简直是​​不可靠的。

从错误处理程序方法中调用 mail() 函数也被证明是有问题的。如果你有很多错误，你的邮件服务器就会加载很多工作，你会发现自己的收件箱很粗糙。为避免这种情况，您可以考虑运行 cron 定期扫描错误日志并相应地发送通知。您可能还想研究系统监控软件，例如[Nagios](http://www.nagios.org/)。

* * *

谈谈有关注册关闭功能的信息：

确实可以注册关机功能，这是一个很好的答案。

这里的重点是，我们通常不应该尝试从致命错误中恢复，尤其是不要对输出缓冲区使用正则表达式。我正在回复[接受的答案](https://stackoverflow.com/questions/277224/how-do-i-catch-a-php-fatal-error/277230#277230)，该答案与 php.net 上的建议相关联，该建议已被更改或删除。

该建议是在异常处理期间对输出缓冲区使用正则表达式，并且在发生致命错误的情况下（通过与您可能期望的任何配置错误文本的匹配检测到），尝试进行某种恢复或继续处理。这不是推荐的做法（我相信这也是我找不到原始建议的原因。我要么忽略它，要么 php 社区将其击落）。

可能值得注意的是，较新的 PHP 版本（大约 5.1）似乎在调用输出缓冲回调之前更早地调用了关闭函数。在版本 5 和更早的版本中，该顺序是相反的（输出缓冲回调之后是关闭函数）。此外，由于大约 5.0.5（比提问者的版本 5.2.3 早得多），对象在调用已注册的关闭函数之前就已卸载，因此您将无法依赖内存中的对象来执行很多东西。

所以注册一个关闭函数是好的，但是应该由一个关闭函数执行的任务可能仅限于少数几个温和的关闭过程。

对于偶然发现这个问题并在最初接受的答案中看到建议的人来说，这里的关键要点只是一些智慧的话。不要正则表达式你的输出缓冲区。

* * *

## 回答 #4

> 赞同：55
> 
> 时间：2018-01-22T12:29:17.317

致命错误或可恢复的致命错误现在抛出**PHP 7 或更高版本**`Error`中的实例。像任何其他异常一样，可以使用块捕获对象。**`Error``try/catch`**

 ****例子：**

```
<?php
$variable = 'not an object';

try {
    $variable->method(); // Throws an Error object in PHP 7 or higger.
} catch (Error $e) {
    // Handle error
    echo $e->getMessage(); // Call to a member function method() on string
} 
```

[https://3v4l.org/67vbk](https://3v4l.org/67vbk)

或者您可以使用`Throwable`接口来捕获所有异常。

**例子：**

```
<?php
    try {
        undefinedFunctionCall();
    } catch (Throwable $e) {
        // Handle error
        echo $e->getMessage(); // Call to undefined function undefinedFunctionCall()
    } 
```

[https://3v4l.org/Br0MG](https://3v4l.org/Br0MG)

欲了解更多信息： http: [//php.net/manual/en/language.errors.php7.php](http://php.net/manual/en/language.errors.php7.php)

* * *

## 回答 #5

> 赞同：38
> 
> 时间：2011-03-04T09:38:21.937

好吧，似乎有可能以其他方式捕获致命错误:)

```
ob_start('fatal_error_handler');

function fatal_error_handler($buffer){
    $error = error_get_last();
    if($error['type'] == 1){
        // Type, message, file, line
        $newBuffer='<html><header><title>Fatal Error </title></header>
                      <style>
                    .error_content{
                        background: ghostwhite;
                        vertical-align: middle;
                        margin:0 auto;
                        padding: 10px;
                        width: 50%;
                     }
                     .error_content label{color: red;font-family: Georgia;font-size: 16pt;font-style: italic;}
                     .error_content ul li{ background: none repeat scroll 0 0 FloralWhite;
                                border: 1px solid AliceBlue;
                                display: block;
                                font-family: monospace;
                                padding: 2%;
                                text-align: left;
                      }
                      </style>
                      <body style="text-align: center;">
                        <div class="error_content">
                             <label >Fatal Error </label>
                             <ul>
                               <li><b>Line</b> ' . $error['line'] . '</li>
                               <li><b>Message</b> ' . $error['message'] . '</li>
                               <li><b>File</b> ' . $error['file'] . '</li>
                             </ul>

                             <a href="javascript:history.back()"> Back </a>
                        </div>
                      </body></html>';

        return $newBuffer;
    }
    return $buffer;
} 
```

* * *

## 回答 #6

> 赞同：27
> 
> 时间：2016-04-15T05:31:05.917

您无法捕获/处理致命错误，但您可以记录/报告它们。为了快速调试，我修改了这个简单代码的一个答案

```
function __fatalHandler()
{
    $error = error_get_last();

    // Check if it's a core/fatal error, otherwise it's a normal shutdown
    if ($error !== NULL && in_array($error['type'],
        array(E_ERROR, E_PARSE, E_CORE_ERROR, E_CORE_WARNING,
              E_COMPILE_ERROR, E_COMPILE_WARNING,E_RECOVERABLE_ERROR))) {

        echo "<pre>fatal error:\n";
        print_r($error);
        echo "</pre>";
        die;
    }
}

register_shutdown_function('__fatalHandler'); 
```

* * *

## 回答 #7

> 赞同：26
> 
> 时间：2012-05-11T04:51:30.213

我开发了一种方法来捕获 PHP 中的所有错误类型（几乎所有）！我不确定 E_CORE_ERROR （我认为不适用于该错误）！但是，对于其他致命错误（E_ERROR、E_PARSE、E_COMPILE...），仅使用一个错误处理函数就可以正常工作！我的解决方案是：

将以下代码放在您的主文件 (index.php) 中：

```
<?php
    define('E_FATAL',  E_ERROR | E_USER_ERROR | E_PARSE | E_CORE_ERROR |
            E_COMPILE_ERROR | E_RECOVERABLE_ERROR);

    define('ENV', 'dev');

    // Custom error handling vars
    define('DISPLAY_ERRORS', TRUE);
    define('ERROR_REPORTING', E_ALL | E_STRICT);
    define('LOG_ERRORS', TRUE);

    register_shutdown_function('shut');

    set_error_handler('handler');

    // Function to catch no user error handler function errors...
    function shut(){

        $error = error_get_last();

        if($error && ($error['type'] & E_FATAL)){
            handler($error['type'], $error['message'], $error['file'], $error['line']);
        }

    }

    function handler( $errno, $errstr, $errfile, $errline ) {

        switch ($errno){

            case E_ERROR: // 1 //
                $typestr = 'E_ERROR'; break;
            case E_WARNING: // 2 //
                $typestr = 'E_WARNING'; break;
            case E_PARSE: // 4 //
                $typestr = 'E_PARSE'; break;
            case E_NOTICE: // 8 //
                $typestr = 'E_NOTICE'; break;
            case E_CORE_ERROR: // 16 //
                $typestr = 'E_CORE_ERROR'; break;
            case E_CORE_WARNING: // 32 //
                $typestr = 'E_CORE_WARNING'; break;
            case E_COMPILE_ERROR: // 64 //
                $typestr = 'E_COMPILE_ERROR'; break;
            case E_CORE_WARNING: // 128 //
                $typestr = 'E_COMPILE_WARNING'; break;
            case E_USER_ERROR: // 256 //
                $typestr = 'E_USER_ERROR'; break;
            case E_USER_WARNING: // 512 //
                $typestr = 'E_USER_WARNING'; break;
            case E_USER_NOTICE: // 1024 //
                $typestr = 'E_USER_NOTICE'; break;
            case E_STRICT: // 2048 //
                $typestr = 'E_STRICT'; break;
            case E_RECOVERABLE_ERROR: // 4096 //
                $typestr = 'E_RECOVERABLE_ERROR'; break;
            case E_DEPRECATED: // 8192 //
                $typestr = 'E_DEPRECATED'; break;
            case E_USER_DEPRECATED: // 16384 //
                $typestr = 'E_USER_DEPRECATED'; break;
        }

        $message =
            '<b>' . $typestr .
            ': </b>' . $errstr .
            ' in <b>' . $errfile .
            '</b> on line <b>' . $errline .
            '</b><br/>';

        if(($errno & E_FATAL) && ENV === 'production'){

            header('Location: 500.html');
            header('Status: 500 Internal Server Error');

        }

        if(!($errno & ERROR_REPORTING))
            return;

        if(DISPLAY_ERRORS)
            printf('%s', $message);

        //Logging error on php file error log...
        if(LOG_ERRORS)
            error_log(strip_tags($message), 0);
    }

    ob_start();

    @include 'content.php';

    ob_end_flush();
?> 
```

* * *

## 回答 #8

> 赞同：17
> 
> 时间：2010-09-25T20:15:25.917

您不能像这样在注册的关闭函数中抛出异常：

```
<?php
    function shutdown() {
        if (($error = error_get_last())) {
           ob_clean();
           throw new Exception("fatal error");
        }
    }

    try {
        $x = null;
        $x->method()
    } catch(Exception $e) {
        # This won't work
    }
?> 
```

但是您可以捕获请求并将其重定向到另一个页面。

```
<?php
    function shutdown() {
        if (($error = error_get_last())) {
           ob_clean();
           # Report the event, send email, etc.
           header("Location: http://localhost/error-capture");
           # From /error-capture. You can use another
           # redirect, to e.g. the home page
        }
    }
    register_shutdown_function('shutdown');

    $x = null;
    $x->method()
?> 
```

* * *

## 回答 #9

> 赞同：14
> 
> 时间：2012-07-24T15:11:26.080

如果您使用的是 PHP >= 5.1.0，只需对 ErrorException 类执行以下操作：

```
<?php
    // Define an error handler
    function exception_error_handler($errno, $errstr, $errfile, $errline ) {
        throw new ErrorException($errstr, $errno, 0, $errfile, $errline);
    }

    // Set your error handler
    set_error_handler("exception_error_handler");

    /* Trigger exception */
    try
    {
        // Try to do something like finding the end of the internet
    }
    catch(ErrorException $e)
    {
        // Anything you want to do with $e
    }
?> 
```

* * *

## 回答 #10

> 赞同：10
> 
> 时间：2014-10-21T13:21:25.370

### Zend Framework 2 中的不错的解决方案：

```
/**
 * ErrorHandler that can be used to catch internal PHP errors
 * and convert to an ErrorException instance.
 */
abstract class ErrorHandler
{
    /**
     * Active stack
     *
     * @var array
     */
    protected static $stack = array();

    /**
     * Check if this error handler is active
     *
     * @return bool
     */
    public static function started()
    {
        return (bool) static::getNestedLevel();
    }

    /**
     * Get the current nested level
     *
     * @return int
     */
    public static function getNestedLevel()
    {
        return count(static::$stack);
    }

    /**
     * Starting the error handler
     *
     * @param int $errorLevel
     */
    public static function start($errorLevel = \E_WARNING)
    {
        if (!static::$stack) {
            set_error_handler(array(get_called_class(), 'addError'), $errorLevel);
        }

        static::$stack[] = null;
    }

    /**
     * Stopping the error handler
     *
     * @param  bool $throw Throw the ErrorException if any
     * @return null|ErrorException
     * @throws ErrorException If an error has been catched and $throw is true
     */
    public static function stop($throw = false)
    {
        $errorException = null;

        if (static::$stack) {
            $errorException = array_pop(static::$stack);

            if (!static::$stack) {
                restore_error_handler();
            }

            if ($errorException && $throw) {
                throw $errorException;
            }
        }

        return $errorException;
    }

    /**
     * Stop all active handler
     *
     * @return void
     */
    public static function clean()
    {
        if (static::$stack) {
            restore_error_handler();
        }

        static::$stack = array();
    }

    /**
     * Add an error to the stack
     *
     * @param int    $errno
     * @param string $errstr
     * @param string $errfile
     * @param int    $errline
     * @return void
     */
    public static function addError($errno, $errstr = '', $errfile = '', $errline = 0)
    {
        $stack = & static::$stack[count(static::$stack) - 1];
        $stack = new ErrorException($errstr, 0, $errno, $errfile, $errline, $stack);
    }
} 
```

此类允许您`ErrorHandler`有时在需要时启动特定内容。然后你也可以停止 Handler。

使用此类，例如：

```
ErrorHandler::start(E_WARNING);
$return = call_function_raises_E_WARNING();

if ($innerException = ErrorHandler::stop()) {
    throw new Exception('Special Exception Text', 0, $innerException);
}

// or
ErrorHandler::stop(true); // directly throws an Exception; 
```

完整类代码链接：
[https ://github.com/zendframework/zf2/blob/master/library/Zend/Stdlib/ErrorHandler.php](https://github.com/zendframework/zf2/blob/master/library/Zend/Stdlib/ErrorHandler.php)

### 一个可能更好的解决方案是来自[Monolog](https://github.com/Seldaek/monolog)的解决方案：

链接到完整的课程代码：
[https ://github.com/Seldaek/monolog/blob/master/src/Monolog/ErrorHandler.php](https://github.com/Seldaek/monolog/blob/master/src/Monolog/ErrorHandler.php)

它还可以使用该`register_shutdown_function`函数处理 FATAL_ERRORS。根据此类，FATAL_ERROR 是以下之一`array(E_ERROR, E_PARSE, E_CORE_ERROR, E_COMPILE_ERROR, E_USER_ERROR)`。

```
class ErrorHandler
{
    // [...]

    public function registerExceptionHandler($level = null, $callPrevious = true)
    {
        $prev = set_exception_handler(array($this, 'handleException'));
        $this->uncaughtExceptionLevel = $level;
        if ($callPrevious && $prev) {
            $this->previousExceptionHandler = $prev;
        }
    }

    public function registerErrorHandler(array $levelMap = array(), $callPrevious = true, $errorTypes = -1)
    {
        $prev = set_error_handler(array($this, 'handleError'), $errorTypes);
        $this->errorLevelMap = array_replace($this->defaultErrorLevelMap(), $levelMap);
        if ($callPrevious) {
            $this->previousErrorHandler = $prev ?: true;
        }
    }

    public function registerFatalHandler($level = null, $reservedMemorySize = 20)
    {
        register_shutdown_function(array($this, 'handleFatalError'));

        $this->reservedMemory = str_repeat(' ', 1024 * $reservedMemorySize);
        $this->fatalLevel = $level;
    }

    // [...]
} 
```

* * *

## 回答 #11

> 赞同：10
> 
> 时间：2011-10-19T20:31:02.010

我需要处理生产中的致命错误，以显示静态样式的*503 Service Unavailable* HTML 输出。这无疑是一种“捕获致命错误”的合理方法。这就是我所做的：

我有一个自定义错误处理函数“error_handler”，它将在任何 E_ERROR、E_USER_ERROR 等上显示我的“503 服务不可用”HTML 页面。现在将在关闭函数上调用它，捕获我的致命错误，

```
function fatal_error_handler() {

    if (@is_array($e = @error_get_last())) {
        $code = isset($e['type']) ? $e['type'] : 0;
        $msg = isset($e['message']) ? $e['message'] : '';
        $file = isset($e['file']) ? $e['file'] : '';
        $line = isset($e['line']) ? $e['line'] : '';
        if ($code>0)
            error_handler($code, $msg, $file, $line);
    }
}
set_error_handler("error_handler");
register_shutdown_function('fatal_error_handler'); 
```

在我的自定义 error_handler 函数中，如果错误是 E_ERROR、E_USER_ERROR 等。我还调用`@ob_end_clean();`清空缓冲区，从而删除 PHP 的“致命错误”消息。

请注意严格的 isset() 检查和`@`静默函数，因为我们不希望我们的 error_handler 脚本生成任何错误。

在仍然同意keparo的情况下，捕获致命错误确实违背了“致命错误”的目的，因此它并不是真正打算让您进行进一步处理。不要在此关闭过程中运行任何 mail() 函数，因为您肯定会备份邮件服务器或收件箱。而是将这些事件记录到文件中并安排一个[cron](https://en.wikipedia.org/wiki/Cron)作业来查找这些*error.log*文件并将它们邮寄给管理员。

* * *

## 回答 #12

> 赞同：8
> 
> 时间：2013-06-27T12:59:15.463

这只是获取当前 error_handler 方法的一个好技巧 =)

```
<?php
    register_shutdown_function('__fatalHandler');

    function __fatalHandler()
    {
        $error = error_get_last();

        // Check if it's a core/fatal error. Otherwise, it's a normal shutdown
        if($error !== NULL && $error['type'] === E_ERROR) {

            // It is a bit hackish, but the set_exception_handler
            // will return the old handler
            function fakeHandler() { }

            $handler = set_exception_handler('fakeHandler');
            restore_exception_handler();
            if($handler !== null) {
                call_user_func(
                    $handler,
                    new ErrorException(
                        $error['message'],
                        $error['type'],
                        0,
                        $error['file'],
                        $error['line']));
            }
            exit;
        }
    }
?> 
```

我还想指出，如果你打电话

```
<?php
    ini_set('display_errors', false);
?> 
```

PHP 停止显示错误。否则，错误文本将在您的错误处理程序之前发送到客户端。

* * *

## 回答 #13

> 赞同：7
> 
> 时间：2012-05-02T23:33:38.110

PHP 有可捕获的致命错误。它们被定义为 E_RECOVERABLE_ERROR。PHP 手册将 E_RECOVERABLE_ERROR 描述为：

> 可捕获的致命错误。它表示发生了可能危险的错误，但并未使引擎处于不稳定状态。如果错误未被用户定义的句柄捕获（另见[set_error_handler()](http://www.php.net/manual/en/function.set-error-handler.php)），应用程序将中止，因为它是 E_ERROR。

[您可以通过使用set_error_handler()](http://www.php.net/manual/en/function.set-error-handler.php)并检查 E_RECOVERABLE_ERROR来“捕捉”这些“致命”错误。我发现在捕获此错误时抛出异常很有用，然后您可以使用 try/catch。

这个问题和答案提供了一个有用的示例：[如何在 PHP 类型提示中捕获“可捕获的致命错误”？](https://stackoverflow.com/questions/2468487/how-can-i-catch-a-catchable-fatal-error-on-php-type-hinting)

但是，可以处理 E_ERROR 错误，但由于引擎处于不稳定状态，因此无法从中恢复。

* * *

## 回答 #14

> 赞同：6
> 
> 时间：2014-11-09T13:32:29.093

由于这里的大多数答案都不必要地冗长，因此这是我的最高投票答案的非丑陋版本：

```
function errorHandler($errno, $errstr, $errfile = '', $errline = 0, $errcontext = array()) {
    //Do stuff: mail, log, etc
}

function fatalHandler() {
    $error = error_get_last();
    if($error) errorHandler($error["type"], $error["message"], $error["file"], $error["line"]);
}

set_error_handler("errorHandler")
register_shutdown_function("fatalHandler"); 
```

* * *

## 回答 #15

> 赞同：5
> 
> 时间：2008-11-10T09:04:58.500

并不真地。致命错误被称为致命错误，因为它们是致命的。你无法从他们身上恢复过来。

* * *

## 回答 #16

> 赞同：3
> 
> 时间：2012-12-21T08:34:56.937

在某些情况下，即使是致命错误也应该被捕获（您可能需要在优雅退出之前进行一些清理，而不仅仅是死掉......）。

我在我的[CodeIgniter](https://en.wikipedia.org/wiki/CodeIgniter)应用程序中实现了一个 pre_system 挂钩，这样我就可以通过电子邮件获取我的致命错误，这有助于我找到未报告的错误（或者在修复后报告的错误，因为我已经知道它们:)）。

Sendemail 检查是否已经报告了错误，以便它不会多次向您发送已知错误的垃圾邮件。

```
class PHPFatalError {

    public function setHandler() {
        register_shutdown_function('handleShutdown');
    }
}

function handleShutdown() {
    if (($error = error_get_last())) {
        ob_start();
        echo "<pre>";
        var_dump($error);
        echo "</pre>";
        $message = ob_get_clean();
        sendEmail($message);
        ob_start();
        echo '{"status":"error","message":"Internal application error!"}';
        ob_flush();
        exit();
    }
} 
```

* * *

## 回答 #17

> 赞同：3
> 
> 时间：2011-11-08T21:55:07.893

我开发了这个功能，以使“沙箱”代码成为可能，这可能会导致致命错误。由于闭包抛出的异常`register_shutdown_function`不会从 pre-fatal 错误调用堆栈中发出，因此我被迫在此函数之后退出以提供统一的使用方式。

```
function superTryCatchFinallyAndExit( Closure $try, Closure $catch = NULL, Closure $finally )
{
    $finished = FALSE;
    register_shutdown_function( function() use ( &$finished, $catch, $finally ) {
        if( ! $finished ) {
            $finished = TRUE;
            print "EXPLODE!".PHP_EOL;
            if( $catch ) {
                superTryCatchFinallyAndExit( function() use ( $catch ) {
                    $catch( new Exception( "Fatal Error!!!" ) );
                }, NULL, $finally );                
            } else {
                $finally();                
            }
        }
    } );
    try {
        $try();
    } catch( Exception $e ) {
        if( $catch ) {
            try {
                $catch( $e );
            } catch( Exception $e ) {}
        }
    }
    $finished = TRUE;
    $finally();
    exit();
} 
```

* * *

## 回答 #18

> 赞同：-1
> 
> 时间：2021-06-26T01:28:18.003

从 PHP 7.4.13 开始，我的经验是程序中所有可能的错误和异常都可以通过两个回调函数来捕获：

```
set_error_handler("ErrorCB");
set_exception_handler("ExceptCB"); 
```

ErrorCB 只是以任何所需的方式报告其参数并调用 Exit()。

exceptCB 在其异常参数上调用“get”方法，并执行一些逻辑来确定文件、行和函数的位置（询问我是否需要详细信息），并以任何所需的方式报告信息并返回。

唯一需要 try/catch 是如果您需要抑制某些代码的错误，而 @ 或 isset() 还不够。在不设置处理程序的情况下对“主函数”使用 try/catch 会失败，因为它不会捕获所有错误。

如果有人发现生成此方法无法捕获的错误的代码，请告诉我，我将编辑此答案。这种方法无法拦截的一个错误是 PHP 程序末尾附近的单个 { 字符；这会产生一个 Parse 错误，这要求您通过包含错误处理的 Include 文件运行您的主 PHP 程序。

我还没有发现需要 register_shutdown_function()。

请注意，我关心的只是报告错误然后退出程序；我不需要从错误中恢复——这确实是一个更困难的问题。

# javascript - 如何将移动设备重定向到不同的 URL？

> ID：277226
> 
> 赞同：0
> 
> 时间：2008-11-10T06:43:51.593
> 
> 标签：javascript, browser, mobile

我想检查用户是从移动设备还是 PC 上查看我的网站。如果它是移动设备，我想像谷歌一样重定向我的网站网址......

如果可能的话，我想在 JavaScript 中实现它。我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-10T07:23:49.560

您通常使用 User-Agent 标头来检测浏览器。

这是基本上可以做到这一点的 JavaScript 代码（但仅适用于主流浏览器，您必须添加移动用户代理）

[http://www.quirksmode.org/js/detect.html](http://www.quirksmode.org/js/detect.html)

这是移动浏览器标识符列表

[http://www.zytrax.com/tech/web/mobile_ids.html](http://www.zytrax.com/tech/web/mobile_ids.html)

鉴于新手机出现在市场上的比例，该列表并不完整，而且永远不会完整，但是当我这样做时，我所做的是将所有收到的用户代理存储在数据库中，然后查找它们以将它们归类为手机以及哪个品牌/型号。

虽然你不能依赖 JavaScript，但最好在服务器代码中完成（并非所有移动浏览器都执行 JavaScript）。

SO上有一个相关的问题，但我找不到。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-10T07:27:03.987

请参阅此[现有问题](https://stackoverflow.com/questions/142273/standard-way-to-detect-mobile-browsers-in-a-web-application-based-on-the-http-r "检测移动浏览器的标准方法...")。

做这个服务器端会更好，因为许多移动浏览器甚至不支持 JavaScript。基本上，您想检查用户代理并与已知移动浏览器列表进行比较。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-10T10:27:53.357

这是此查询的简单答案。这不会检测到移动浏览器，但会`mobile.html`通过以下脚本将页面重定向到我们的页面；

找出浏览器窗口大小并重定向它..

```
winWidth=document.all?document.body.clientwidth:window.innderwidth;
if (winwidth<800)
{
 window.location.replace("mobile.html");
} 
```

# asp.net - 如何确定 ASP.NET 页面是否在缓存中？

> ID：277228
> 
> 赞同：0
> 
> 时间：2008-11-10T06:45:30.060
> 
> 标签：asp.net, caching

我需要找出网页是否被缓存。那是新加载的或出现在缓存中。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-10T10:41:51.970

在响应中的某处包含生成的时间戳，并将时间戳存储在服务器的某处（可能在缓存对象中）。这样，您可以通过检查这些值来了解页面的版本。

如果您可以详细说明您所面临的情况，我相信您会得到更好的答案。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-10T10:22:41.930

您有客户端或服务器端缓存，它们是离散的，因为它们彼此不知道。

在服务器端检查 Response.Cache 对象。

# php - 将天数增加到 php 当前 Date()

> ID：277247
> 
> 赞同：58
> 
> 时间：2008-11-10T06:59:24.197
> 
> 标签：php, date, days

如何在 PHP 中将特定天数添加到当前日期？

我已经得到了当前日期：

```
$today = date('y:m:d'); 
```

只需添加 x 天数即可

* * *

## 回答 #1

> 赞同：124
> 
> 时间：2008-11-10T07:11:23.643

`php`支持 c 风格的日期函数。`strtotime`您可以通过该功能添加或减去带有英语风格短语的日期时段。例子...

```
$Today=date('y:m:d');

// add 3 days to date
$NewDate=Date('y:m:d', strtotime('+3 days'));

// subtract 3 days from date
$NewDate=Date('y:m:d', strtotime('-3 days'));

// PHP returns last sunday's date
$NewDate=Date('y:m:d', strtotime('Last Sunday'));

// One week from last sunday
$NewDate=Date('y:m:d', strtotime('+7 days Last Sunday')); 
```

或者

```
<select id="date_list" class="form-control" style="width:100%;">
<?php
$max_dates = 15;
$countDates = 0;
while ($countDates < $max_dates) {
    $NewDate=Date('F d, Y', strtotime("+".$countDates." days"));
    echo "<option>" . $NewDate . "</option>";
    $countDates += 1;
}
?> 
```

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2008-11-10T07:03:30.553

一天是86400秒。

```
$tomorrow = date('y:m:d', time() + 86400); 
```

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2015-01-18T15:24:39.990

添加 x 号的最简单方法。天..

```
echo date('Y-m-d',strtotime('+1 day'));    //+1 day from today 
```

或从指定日期...

```
echo date('Y-m-d',strtotime('+1 day', strtotime('2007-02-28'))); 
```

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2012-12-25T03:28:18.737

使用 php 5.3

```
 $date = new DateTime();
    $interval = new DateInterval('P1D');
    echo $date->format('Y-m-d') , PHP_EOL;
    $date->add($interval);
    echo $date->format('Y-m-d'), PHP_EOL;
    $date->add($interval);
    echo $date->format('Y-m-d'), PHP_EOL; 
```

将输出

2012-12-24

2012-12-25

2012-12-26

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2008-11-10T07:03:59.757

该[`date_add()`](http://ca.php.net/manual/en/function.date-add.php)功能应该做你想做的事。此外，请查看该[`DateTime`](http://laughingmeme.org/2007/02/27/)对象的文档（非官方的，但官方的文档有点稀疏），它比 PHP 中的过程函数好用得多。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2015-04-24T14:50:59.620

如果您在多个地方需要此代码，那么我建议您添加一个简短的函数以使您的代码更简单且更易于测试。

```
function add_days( $days, $from_date = null ) {
    if ( is_numeric( $from_date ) ) { 
        $new_date = $from_date; 
    } else { 
        $new_date = time();
    }

    // Timestamp is the number of seconds since an event in the past
    // To increate the value by one day we have to add 86400 seconds to the value
    // 86400 = 24h * 60m * 60s
    $new_date += $days * 86400;

    return $new_date;
} 
```

然后你可以像这样在任何地方使用它：

```
$today       = add_days( 0 );
$tomorrow    = add_days( 1 );
$yesterday   = add_days( -1 );
$in_36_hours = add_days( 1.5 );

$first_reminder  = add_days( 10 );
$second_reminder = add_days( 5, $first_reminder );
$last_reminder   = add_days( 3, $second_reminder ); 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2019-05-22T05:38:50.863

```
$NewDate=Date('Y-m-d', strtotime('+365 days')); 
```

> 回声 $NewDate; //2020-05-21

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2018-04-20T19:27:32.643

向选择元素添加 15 天（使用“生死存亡”建议）

```
<select id="date_list" class="form-control" style="width:100%;">
<?php
$max_dates = 15;
$countDates = 0;
while ($countDates < $max_dates) {
    $NewDate=Date('F d, Y', strtotime("+".$countDates." days"));
    echo "<option>" . $NewDate . "</option>";
    $countDates += 1;
}
?> 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2019-06-11T14:51:39.797

`$NewTime = mktime(date('G'), date('i'), date('s'), date('n'), date('j') + $DaysToAdd, date('Y'));`

来自[mktime 文档](https://www.php.net/manual/en/function.mktime.php)：

> mktime() 对于进行日期算术和验证很有用，因为它会自动为超出范围的输入计算正确的值。

这种方法的优点是您可以在易于阅读的代码行中添加或减去任何时间间隔（小时、分钟、秒、天、月或年）。

请注意，在性能方面存在折衷，因为由于对 date() 函数的所有调用，此代码比 strtotime("+1 day") 慢约 2.5 倍。如果您处于循环中，请考虑重新使用这些值。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2020-11-29T09:23:09.760

您还可以使用面向对象编程 (OOP) 而不是过程编程：

```
$fiveDays = new DateInterval('P5D');
$today = new DateTime();
$fiveDaysAgo = $today->sub(fiveDays); // or ->add(fiveDays); to add 5 days 
```

或者只用一行代码：

```
$fiveDaysAgo = (new DateTime())->sub(new DateInterval('P5D')); 
```

* * *

## 回答 #11

> 赞同：-2
> 
> 时间：2016-12-01T06:18:36.570

```
<?php
$dt = new DateTime;
if(isset($_GET['year']) && isset($_GET['week'])) {
    $dt->setISODate($_GET['year'], $_GET['week']);
} else {
    $dt->setISODate($dt->format('o'), $dt->format('W'));
}
$year = $dt->format('o');
$week = $dt->format('W');
?>

<a href="<?php echo $_SERVER['PHP_SELF'].'?week='.($week-1).'&year='.$year; ?>">Pre Week</a> 
<a href="<?php echo $_SERVER['PHP_SELF'].'?week='.($week+1).'&year='.$year; ?>">Next Week</a>
<table width="100%" style="height: 75px; border: 1px solid #00A2FF;">
<tr>
<td style="display: table-cell;
    vertical-align: middle;
    cursor: pointer;
    width: 75px;
    height: 75px;
    border: 4px solid #00A2FF;
    border-radius: 50%;">Employee</td>
<?php
do {
    echo "<td>" . $dt->format('M') . "<br>" . $dt->format('d M Y') . "</td>\n";
    $dt->modify('+1 day');
} while ($week == $dt->format('W'));
?>
</tr>
</table> 
```

# css - 取消 CSS 声明

> ID：277256
> 
> 赞同：16
> 
> 时间：2008-11-10T07:10:43.643
> 
> 标签：css

是否有可能有一个基本上“撤消”先前规则的 CSS 规则？

一个例子：

```
<blockquote>
    some text <em>more text</em> other text
</blockquote> 
```

假设有这个 CSS：

```
blockquote {
    color: red;
} 
```

...但我希望`<em>`保持正常的文本颜色（您可能不一定知道）。

基本上，有没有办法做这样的事情？

```
blockquote em {
    color: inherit-from-blockquote's-parent
} 
```

* * *

编辑：我实际上试图让它工作的代码实际上有点复杂。也许这会更好地解释它：

```
This text should be *some unknown colour*
<ul>
    <li>This text should be BLUE
        <ul>
            <li>Same as outside the UL</li>
            <li>Same as outside the UL</li>
        </ul>
    </li>
</ul>

ul {
    color: blue;
}
ul ul {
    color: ???;
} 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-10T08:16:52.153

仅使用 CSS，您不能引用父级的父级。

您可以做的就是尝试混合使用特定的 CSS 选择器和标记，以便出现所需的效果。

```
<td>
  This is the enclosing element.
  <ul>
    <li>This is the first level UL, direct child of TD
      <ul>
        <li>This is the second level UL</li>
        <li>Same as outside the UL</li>
      </ul>
    </li>
  </ul>
</td> 
```

CSS：

```
td > ul
  color: blue; /* this affects the "direct child" UL only */
} 
```

您会将样式继承的深度限制在一级，因此内部 UL 在颜色方面没有样式，并从封闭文本中获取其设置。

阅读有关[CSS 子选择器](http://meyerweb.com/eric/articles/webrev/200006b.html)的更多信息，并注意旧版浏览器可能有其怪癖。

* * *

**编辑**

对于 Internet Explorer 6，可以在某种程度上伪造子选择器。使用前请务必系好安全带（有条件的注释等）：

```
td ul {
  color: expression(/TD/.test(this.parentNode.tagName)? "blue" : "black");
} 
```

这假定“黑色”作为外部颜色。如果这个颜色值可能会发生变化，恐怕你就不走运了。除非您可以定义一个`expression()`能够从上下文中获取颜色值的对象（例如检查父元素的一些其他属性）。或者您放弃并使用 JS 框架，正如其他人已经建议的那样。

无需使用 JS 的懦弱解决方案当然是：

```
td ul.first {
  color: blue;
} 
```

但我明白你为什么要避免这种情况。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-11-10T18:22:23.053

使用它来确保继承覆盖任何其他可能设置颜色的内容：

```
blockquote em {
    color: inherit !important;
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-10T08:20:21.053

放弃使用一段javascript来检测父类的样式并设置？:)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-09T14:29:12.813

与其试图强制选择器从其祖父母继承字体颜色，我建议您为选择器及其祖父母提供字体颜色的共享声明。

以块引用为例，假设 body 是祖父母：

```
body, blockquote em {
       color:[whatever];
}

blockquote {
       color:red;
} 
```

在无序列表的情况下，它将是：

```
body, ul ul {
       color:[whatever];
}

ul {
       color:blue;
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-10T07:19:40.223

好的，带有示例的附加文本非常清楚地说明了这个问题。而且我很害怕你想要的东西是不可能的。

如果您知道“未知颜色”，您当然可以重复该颜色。但我认为 CSS 需要一些机制来添加变量或引用。

所以你必须坚持繁琐的：

```
ul {
  color: blue;
}
li ul {
  color: sameenvironment;  /* Sorry but you have to add the specific colour here */
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-10T07:22:09.673

我的 CSS 有点生锈，但这应该可以工作：

```
blockquote {
    color: red;
}

blockquote em {
    color: inherit;
} 
```

您将块引用设置为红色，但`<em>'s`块引用中包含的所有内容都应该继承......嗯，它们应该从周围的文本继承还是从块引用继承？

我认为，如果上述方法无法按您的意愿工作，那么使用当前标记无法做到这一点。您将不得不使用其他标记，或明确设置颜色，例如

```
blockquote em {
        color: Purple;
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-10T07:38:20.483

如果您可以更改您的html，您可以尝试

```
<li><span>This text should be BLUE</span>
    <ul>
        <li>Same as outside the UL</li>
        <li>Same as outside the UL</li>
    </ul>
</li> 
```

和风格

```
li span{
    color: blue;
} 
```

编辑另一种无需额外跨度标签即可完成此操作的方法：

如果我们假设我们有一个样式类（或任何其他选择器）定义为外部 ul 的父级。我们可以像这样修改css：

```
.parentStyle,
.parentStyle li li{
     color:red;
}
li{
     color:blue;
} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2014-04-13T04:37:22.377

我也有这个问题，但是在我看了其他答案之后，我突然想到了，

```
 body {
        color : initial;
    } 
```

IE 目前不支持此功能，我相信 Gecko 需要 -moz-initial ..

```
 body {
        color : unset;
    } 
```

现在还不太支持这个。我只是想把我的答案分享给其他想到这个的人。

# c++ - 在 Visual Studio 中预处理后如何查看 C/C++ 源文件？

> ID：277258
> 
> 赞同：218
> 
> 时间：2008-11-10T07:11:08.883
> 
> 标签：c++, c, debugging, visual-studio-2005, c-preprocessor

假设我有一个包含许多预处理器指令的源文件。预处理器完成后是否可以看到它的外观？

* * *

## 回答 #1

> 赞同：161
> 
> 时间：2008-11-10T08:33:17.533

`cl.exe`，Microsoft Visual C++ 的命令行界面，具有用于输出预处理文件的三个不同选项（因此在先前关于 Visual C++ 的响应中存在不一致）：

*   `/E`:[预处理到标准输出](http://msdn.microsoft.com/en-us/library/3xkfswhy.aspx)（类似于 GCC 的 -E 选项）
*   `/P`:[预处理到文件](http://msdn.microsoft.com/en-us/library/8z9z0bx6.aspx)
*   `/EP`:[在没有#line 指令的情况下预处理到标准输出](http://msdn.microsoft.com/en-us/library/becb7sys.aspx)

如果要对没有#line 指令的文件进行预处理，请结合`/P`和`/EP`选项。

* * *

## 回答 #2

> 赞同：123
> 
> 时间：2008-11-10T07:15:27.270

大多数编译器都可以选择只运行预处理器。 *例如*，gcc 提供 -E：

```
 -E  Stop after the preprocessing stage; do not run the compiler proper.  
       The output is in the form of preprocessed source code, which is sent
       to the standard output. 
```

所以你可以运行：

```
gcc -E foo.c 
```

如果你找不到这样的选项，你也可以在你的机器上找到 C 预处理器。它通常称为 cpp 并且可能已经在您的路径中。像这样调用它：

```
cpp foo.c 
```

如果需要从其他目录中包含头文件，则可以将 -I/path/to/include/dir 传递给其中任何一个，就像使用常规编译一样。

对于 Windows，我将把它留给其他海报提供答案，因为我不是那里的专家。

* * *

## 回答 #3

> 赞同：108
> 
> 时间：2008-11-10T07:18:50.163

右键单击解决方案资源管理器上的文件，转到属性。在 Configuration Properties->C/C++->Preprocessor 下，“生成预处理文件”就是您要查找的内容。然后在解决方案资源管理器中右键单击该文件并选择“编译”。预处理文件在输出目录（例如Release、Debug）中创建，扩展名为.i（感谢Steed 的评论）。

* * *

## 回答 #4

> 赞同：21
> 
> 时间：2008-11-10T08:06:13.580

您通常需要对预处理器的输出进行一些后处理，否则所有宏都只是扩展为一个行，这很难阅读和调试。对于 C 代码，类似以下内容就足够了：

```
gcc -E code.c | sed '/^\#/d' | indent -st -i2 > code-x.c 
```

对于 C++ 代码，它实际上要困难得多。对于 GCC/g++，我发现[这个 Perl 脚本](https://raw.githubusercontent.com/vicaya/hypertable/e893460eaf628e2bf329ee6d30371751c5f82f5d/bin/gpp.pl)很有用。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2008-11-10T07:16:14.100

`cl /EP`如果您使用的是 Microsoft 的 C++ 编译器，请尝试一下。

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2013-03-06T23:16:57.797

我对 Microsoft 编译器一无所知，但在 GCC 上你可以使用它：

```
gcc -E -P -o result.c my_file.h 
```

如果您想查看评论，请使用：

```
gcc -E -C -P -o result.c my_file.h 
```

[此页面](http://gcc.gnu.org/onlinedocs/gcc/Preprocessor-Options.html)提供更多选项。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2008-11-10T07:15:54.647

在 Visual Studio 中，您可以使用 /P 编译文件（或项目）。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2013-01-24T19:38:21.280

正如 bk1e 和 Andreas M. 回答的那样，编译器的 /P 选项将导致它预处理文件。但是，在我使用 VS2005 和 Platform Builder（用于嵌入式 ARM 处理器）的项目中，该项目没有在对话框中显示启用该选项的选项（如 Jim B 所述）。

我可以手动运行 CL 并添加 /P，但它失败了，因为我不知道在完整构建期间由 Platform Builder 无形激活的所有适当命令行选项。所以我需要知道所有这些选项。

我的解决方案是查看 build.log 文件，并找到执行的行

`CL blah-blah-blah myfile.c`

我将此行复制到剪贴板。“blah-blah-blah”部分包含构建选项，并且很大。

回到 IDE，我右键单击 myfile.c，选择“打开构建窗口”，然后在该窗口中粘贴构建命令行，并添加一个“/P”。

`CL /P blah-blah-blah myfile.c`

完毕。生成了 myfile.i 文件，其中包含预处理器输出。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2014-10-04T07:00:42.770

[CPIP](http://cpip.sourceforge.net/)是一个用 Python 编写的新的 C/C++ 预处理器。如果您想要预处理文件的详细视觉表示，请试一试。

> CPIP 是用 Python 实现的 C/C++ 预处理器。大多数预处理器将预处理视为一项必须尽快完成的肮脏工作。这使得在预处理阶段追踪细微缺陷变得非常困难，因为预处理器会丢弃许多有用的信息，以尽可能便宜地获得结果。
> 
> 很少有开发人员真正了解预处理，对许多人来说，这是一种晦涩难懂的黑魔法。CPIP 旨在改进这一点，并通过记录预处理的每一个细节，以便 CPIP 可以生成一些关于文件依赖关系、宏使用等的精彩视觉信息。
> 
> CPIP 并非旨在替代 cpp（或任何其他已建立的预处理器），而是 CPIP 认为清晰度和理解比处理速度更重要。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2015-01-31T02:24:45.553

在 Windows 操作系统上，此问题的简单单行答案是在 DOS 提示符下使用以下命令查看预处理文件：

```
CL /P /C myprogram.c 
```

这将生成一个名为**myprogram.i**的文件。打开它并查看您的扩展预处理器。

# java - 使用 Java 传输文件的最佳方式是什么？

> ID：277260
> 
> 赞同：9
> 
> 时间：2008-11-10T07:13:23.047
> 
> 标签：java, file-io

我正在编写将文件从客户端上传到服务器的代码，但性能并没有我想象的那么快。

**我有正在进行文件传输的当前代码片段，我想知道如何加快传输速度。**

对不起所有的代码：

```
InputStream fileItemInputStream ;
OutputStream saveFileStream;
int[] buffer;
while (fileItemInputStream.available() > 0) {
    buffer = Util.getBytesFromStream(fileItemInputStream);
    Util.writeIntArrToStream(saveFileStream, buffer);
}
saveFileStream.close();
fileItemInputStream.close(); 
```

Util 方法如下：

```
public static int[] getBytesFromStream(InputStream in, int size) throws IOException {
    int[] b = new int[size];
    int count = 0;
    while (count < size) {
        b[count++] = in.read();
    }
    return b;
} 
```

和：

```
public static void writeIntArrToStream(OutputStream out, int[] arrToWrite) throws IOException {
    for (int i = 0; i < arrToWrite.length; i++) {
        out.write(arrToWrite[i]);
    }
} 
```

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-11-10T07:18:46.670

一次读取一个字节将非常低效。您还依赖`available`，这很少是一个好主意。*（如果当前*没有可用的字节，它将返回 0 ，但可能还会有更多。）

这是复制流的正确代码类型：

```
public void copyStream(InputStream input, OutputStream output) throws IOException
{
    byte[] buffer = new byte[32*1024];
    int bytesRead;
    while ((bytesRead = input.read(buffer, 0, buffer.length)) > 0)
    {
        output.write(buffer, 0, bytesRead);
    }
} 
```

（调用者应该关闭两个流。）

# asp.net-mvc - 带有相对路径的 ASP.Net MVC 和 RenderPartial

> ID：277284
> 
> 赞同：11
> 
> 时间：2008-11-10T07:28:44.730
> 
> 标签：asp.net-mvc, renderpartial

我一直在玩 ASP.NET MVC 并且有一个问题。或者也许它担心我做错了。只是在一个蹩脚的网站上工作以伸展我的翅膀。很抱歉，这个问题一点也不简洁。

好的，这是场景。当用户访问主页/索引时，页面应显示产品列表和文章列表。文件布局是这样的（DAL 是我的数据访问层）：

```
控制器
    家
        指数       

意见
    家
        索引继承自 ViewPage
    产品         
        列表继承自 ViewUserControl<IEnumerable<DAL.Product>>
        Single 继承自 ViewUserControl<DAL.Product>
    文章
        List 继承自 ViewUserControl<IEnumerable<DAL.Article>>
        Single 继承自 ViewUserControl<DAL.Article>

```

```
Controllers.HomeController.Index produces a View whose ViewData contains two entries, a IEnumerable<DAL.Product> and a IEnumerable<DAL.Article>.

View.Home.Index will use those view entries to call:
Html.RenderPartial("~/Views/Product/List.ascx", ViewData["ProductList"])
and Html.RenderPartial("~/Views/Article/List.ascx", ViewData["ArticleList"])

View.Product.List will call
foreach(Product product in View.Model)
    Html.RenderPartial("Single", product);

View.Article.List does something similar to View.Product.List 
```

然而，这种方法失败了。这种方法对我来说很有意义，但也许对这些 MVC 平台有更多经验的人会发现更好的方法。

以上在 View.Product.List 中产生错误。调用`Html.RenderPartial("Single",...)`抱怨未找到“单一”视图。该错误表明：

```
找不到局部视图“单一”。搜索了以下位置：
~/Views/Home/Single.aspx
~/Views/Home/Single.ascx
~/Views/Shared/Single.aspx
~/Views/Shared/Single.ascx

```

因为我是从 Product 中的视图调用 RenderAction()，所以我希望运行时在 Views\Product 中查找“Single”视图。然而，查找似乎是相对于调用原始视图（/Controller/Home 调用 /Views/Product）的控制器而不是当前视图。

所以我可以通过更改 Views\Product 来解决这个问题，例如：

```
View.Product.List will call
foreach(Product product in View.Model)
    Html.RenderPartial(**"~/Views/Product/Single.ascx"**, product);
```

代替

```
View.Product.List will call
foreach(Product product in View.Model)
    Html.RenderPartial(**"Single"**, product); 
```

此修复程序有效，但是.. 我不明白为什么我需要指定视图的完整路径。对我来说，相对于当前视图的路径而不是原始控制器的视图路径来解释相对名称是有意义的。我想不出任何有用的情况，其中解释相对于控制器视图而不是当前视图的名称是有用的（除了在它们相同的典型情况下）。

这个时候我应该打个问号吧？强调这一点实际上是一个问题。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-11T20:33:07.970

> 因为我是从 Product 的视图中调用 RenderAction()
> 
> ...
> 
> 我不明白为什么我需要指定视图的完整路径。对我来说，相对于当前视图的路径而不是原始控制器的视图路径来解释相对名称是有意义的

我认为您误解的部分是“执行地点”，因为没有更好的或官方的术语。路径与您的视图无关，甚至与您所说的“控制器视图”无关。它们与定义控制器上下文的请求 URL 相关。我可能说得不太好，但是如果您在 Reflector 中花一点时间查看 URL 和路由是如何解析的，我想这一切都会在您的脑海中形成。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-11T18:14:23.587

[编辑：

我在想，你有两种情况：

*   家庭控制器是唯一一个引用产品/文章列表用户控件的控制器
*   用户控件由多个控制器共享

在第一种情况下，视图用户控件确实属于主控制器，将它们放在主控制器文件夹中是有意义的。在第二种情况下，将它们放在共享文件夹中是有意义的，因为它们将由控制器共享。

无论哪种情况，您都可以将它们放在子文件夹中。喜欢 Views/Home/Products 然后尝试 RendarPartial("Product/Single") 看看会发生什么？我不知道它是否会尝试将其解决为：Home/Product/Single，然后是 Shared/Product/Single。如果子文件夹有效，它似乎允许产品和文章的逻辑分离，同时表明它们仍然是主控制器的成员或由所有控制器共享。

]

查看史蒂夫·桑德森的这篇博文：

[http://blog.codeville.net/2008/10/14/partial-requests-in-aspnet-mvc/](http://blog.codeville.net/2008/10/14/partial-requests-in-aspnet-mvc/)

您所做的并没有错，但它似乎确实违反了 View/Controller 文件夹名称的约定。也就是说，想要定义与控制器无关的视图用户控件并嵌套它们似乎是有效的。所以我不知道！

无论如何，该链接仅描述了一种方法，而不是使用 RenderPartial 来呈现使用控件，它定义了 RenderPartialRequest 的方法，该方法呈现控制器操作的返回值（在您的情况下为用户控件）。因此，您可以添加带有返回用户控件的操作列表的产品和文章控制器，然后从主页/索引视图中调用这两个操作。这对我来说似乎更直观，但只是一种意见。

他还提到了来自 MVC Contrib 的子控制器，我很确定有人希望这样的东西成为 ASP.NET MVC 版本的一部分。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-11T20:56:34.240

通过查看 MVCStoreFront 示例，这就是他们为调用 RenderPartial 构建所有内容的方式

```
Views
    Shared
        ProductSingle
        ProductList
        ArticleSingle
        ArticleList 
```

然后通过以下方式渲染它们：

```
<% Html.RenderPartial("ProductSingle", ViewData["ProductList"]); %>
<% Html.RenderPartial("ProductList", product); %>
<% Html.RenderPartial("ArticleSingle", article); %>
<% Html.RenderPartial("ArticleList", ViewData["ArticleList"]); %> 
```

# windows - 什么是相当于 Linux/bash 的 $ 的 Windows/cmd.exe？-- 程序退出/返回码？

> ID：277288
> 
> 赞同：6
> 
> 时间：2008-11-10T07:30:56.770
> 
> 标签：windows, cmd, return-code

> **可能重复：**
> [如何从 Windows 命令行获取应用程序退出代码？](https://stackoverflow.com/questions/334879/how-do-i-get-the-application-exit-code-from-a-windows-command-line)

在 Unix/bash 中，我可以简单地说：

> $回声$？

从交互式和非交互式 shell 中找出程序的返回/退出代码。

现在，我怎样才能在 Windows/cmd.exe 中做同样的事情？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-11-10T07:39:08.767

使用“errorlevel”，如下所示：

```
IF ERRORLEVEL 1 GOTO ERROR 
```

errorlevel 命令有点奇怪；如果返回码等于或**高于**指定的错误级别，则返回 true。你也可以写

```
IF %ERRORLEVEL% NEQ 0 GOTO ERROR 
```

[此页面](http://www.robvanderwoude.com/errorlevel.html)很好地概述了如何在 .bat 文件中使用错误级别。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-08-06T04:33:35.430

等效的是：

```
echo %ERRORLEVEL% 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-10T07:32:13.710

检查错误级别

# user-interface - 是否值得保持操作系统的外观和感觉？

> ID：277290
> 
> 赞同：8
> 
> 时间：2008-11-10T07:31:24.430
> 
> 标签：user-interface, usability

尝试将 GUI 保持在系统外观内是否值得？

每个主要程序都有自己的反正......（visual studio，iexplorer，firefox，symantec实用程序，adobe......）

还是应该只将框架和对话框留在系统外观范围内？

**更新：**

一个简单的例子，如果你想在你的选项卡上添加一个关闭按钮，通常你会根据你当前的桌面主题来做。但是如果用户有不同的主题，你的关闭按钮就不合适了，它就不再适合系统的外观了。

我玩过 uxtheme api，但你无能为力，而且我看到的一些主题是不完整的集合。

因此，为了解决这个问题，我认为最好的方法是像visual studio/firefox/chrome那样用你的主题来滚动你自己的标签控件......

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-11-10T07:37:47.037

我认为，除非您的程序成为用户生活中非常重要的一部分，否则您应该努力尽量减少“惊喜”并最大限度地提高可识别性（这甚至是一个词吗？）。

因此，如果您正在制作可供 1.000 人每天使用 10 分钟的东西，请选择系统外观和机制。

另一方面，如果你正在制作一个 100 人每天使用 6 个小时的东西，我会开始探索我可以塞进哪些 UI 改进和快捷方式来让这 6 个小时更容易处理。

但是请注意，UI 修复不能以牺牲性能为代价。当有人认为在 .Net 中简单地覆盖 OnPaint 事件就足够时，这几乎总是如此。

在不知不觉中，您再次拦截了 NC_PAINT 和 NC_BACKGROUNDERASE 以及所有这些小技巧，以使其与内置控件一样快。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-10T08:18:40.433

我倾向于同意这里的其他人——尤其是 Soraz 和 Smaci。

不过，我要补充一件事。如果您确实觉得 OS L&F 过于受限，并且您有充分的理由超越它，我会努力遵循“起搏和领先”的原则（我在此从 NLP 上下文中借用）。

这个想法是，您仍然希望尽可能多地利用您的目标受众对主机操作系统的熟悉程度（这方面的例外情况很少见，正如 Smaci 已经涵盖的那样）。因此，您尽可能多地使用“标准”控件和行为（这是“步调”） - 但在必要时以仍然尽可能“适合”的方式扩展它（领先）。

您已经提到了这个原则在工作中的一些很好的例子——Visual Studio，甚至在某种程度上是 Office（Office 是“特殊的”，因为在这里切齿的新 UI 样式通常会重新回到未来的操作系统版本中——或者 de-事实标准）。

我提出这一点是为了对比那些“按自己的方式做”的应用程序类型——通常是因为它们是从另一个平台移植过来的，或者是在 GUI 和核心中被编写成跨平台的。Java 应用程序通常属于这一类，但它们并不是唯一的。它不像以前那么糟糕，但即使在今天，大多数专业音频应用程序都有混合 UI，显示了它们的血统，因为它们多年来一直从一个平台移植到另一个平台。虽然这些示例可能有很好的商业原因，但它们的用户界面往往很糟糕，如果可能的话，应该避免走这条路！

最重要的原则仍然是遵循最不意外的路径，并考虑您的用户对操作系统的熟悉程度，以及他们在操作系统上使用您的应用程序的时间与其他人的比例。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-10T07:51:22.657

是的，如果只是因为它使操作系统能够使用任何内置的可访问性功能，如文本到语音。对于需要可访问性功能来拥有另一个破坏他们习惯的所有工具的 UI 的人来说，没有什么比这更烦人的了。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-10T07:58:32.050

我想说这取决于用户、应用程序和平台。界面对用户来说应该是直观的，只有在适合这些用户的情况下，才与遵循系统 UI 标准相同。例如，在过去，我曾参与开发用于在 Windows CE 手持设备上交付乳制品和面包的手持系统。在这种情况下，用户通常不具备计算机知识，并且教育背景薄弱。用户界面通过简单的语言专注于易用性，并以预先存在的纸质表单系统为模型。它没有尝试遵循 Windows 的外观和感觉，因为这不合适。

目前，我为一个通常受过第三级教育且计算机知识渊博的用户群开发非常图形化的软件。这里的期望是该软件将坚持并扩展 Windows 的外观和感觉。

软件应该尽可能简单直观，如何实现这一点完全取决于上下文。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-10T08:24:17.677

我想回答另一个问题（不是真正的 Stackoverflow 协议，但我认为，在这种情况下，这是合理的）

问题是“是否值得打破操作系统的外观和感觉？” 换句话说，

1.  你有这样做的理由吗？（为了以某种方式呈现数据，这在正常 L&F 中是不可能的）
2.  你这样做有什么收获？（提高可用性？）
3.  你这样做会失去什么？（直觉和熟悉度？）

不要简单地做到“与众不同”

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-11T15:33:34.580

一般来说，是的。但是，尽管没有针对其运行的所有操作系统进行格式化，但偶尔有一些程序运行良好。例如，emacs 的运行与 OS X 或 Windows（甚至可能是 gnome/KDE）上的每个界面指南都完全相反，而且它不会很快消失。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-11T16:04:30.850

我*强烈*建议让您的应用程序看起来像原生的。

将应用程序移植到新平台的开发人员似乎犯的一个常见错误是，新应用程序的外观和感觉应该与旧平台上的一样。

不，新应用程序的外观和感觉应该与用户在新平台上习惯的所有其他应用程序一样。

否则，你会得到像 Windows 上的 iTunes 这样的可憎之物。相同的 UI 设计可能在一个平台上完全正确，而在下一个平台上则大错特错。

您会发现您的用户可能无法指出他们不喜欢您的应用程序的原因，但他们只是觉得很难使用。

是的，有有效的例外，但它们很少见（果然，它们往往是 Office 和 Firefox 等主要应用程序，而不是小应用程序）。如果您不确定必须在 StackOverflow 上提问，那么您的应用程序不是其中之一。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-10T07:35:47.120

如果您使用（或开发）Mac，那么绝对是的！

这也应该适用于 Windows。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-10T07:38:20.670

这取决于您定义*系统外观*的范围有多广……但总的来说，您应该保留它。

不要因为区别于他的习惯而让用户感到惊讶。*这就是我们称他为用户*的原因之一;-)

Firefox 和 Adob​​e 产品通常不这样做，因为它们针对的是几个平台，这些平台都有自己的 L&F。但是 Visual Studio 保留了典型的 Windows L&F。而且，只要您只为 Windows 开发，您也应该这样做。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-11-10T07:46:13.587

除了 Windows 上没有明确定义的外观之外，您应该始终尝试遵循主机平台原生 L&F。但是请注意，外观与外观一样**重要**。以违反直觉的方式运行的程序与拥有自己丑陋小部件的程序一样令人讨厌。

Fraps 是一个很好的例子（恕我直言），该程序实际上非常有用，但违反了几个用户界面准则并且看起来非常丑陋。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-11-10T14:38:46.797

如果您正在为 Apple 的 Mac OS X 或 Microsoft Windows 进行开发，供应商会提供接口指南，任何应用程序***都应***遵循这些指南才能成为“本机”。

请参阅[在确定菜单项的放置位置时是否需要遵循任何标准？](https://stackoverflow.com/questions/268532/are-there-any-standards-to-follow-in-determining-where-to-place-menu-items)了解更多信息。

# java - Eclipse RCP：我应该将模型对象保存在哪里以及它们如何与视图对话？

> ID：277291
> 
> 赞同：9
> 
> 时间：2008-11-10T07:31:52.727
> 
> 标签：java, eclipse, eclipse-plugin, eclipse-rcp

在 Eclipse RCP 的处理方式中，我应该将模型对象保存在哪里？当它们被加载或更改时，它们应该如何与视图对话？

我正在尝试将我现有的应用程序移植到 Eclipse RCP。它可以被视为一个类似 IDE 的应用程序：我打开一个文件，其中包含指向源文件的链接。源文件显示在树视图中。我可以编辑源代码，并将源代码构建到一些输出中......

例如，当我处理 Open 命令时，我将在哪里创建模型对象以便我的视图可以看到它们？我宁愿避免使用单例管理器类，但这可能是最简单的方法。

浏览 JDT 的源代码时发现的有趣代码是 JavaCore、JavaModel、JavaModelManager。和 Java 项目。

* * *

```
IProject[] projects= ResourcesPlugin.getWorkspace().getRoot().getProjects(); 
```

* * *

```
public static IJavaProject create(IProject project) {
    if (project == null) {
        return null;
    }
    JavaModel javaModel = JavaModelManager.getJavaModelManager().getJavaModel();
    return javaModel.getJavaProject(project);
} 
```

* * *

有关的：

*   [你如何在 Eclipse 声明式服务和视图（ContentProviders）之间进行通信](https://stackoverflow.com/questions/282509/how-do-you-communicate-between-eclipse-declarative-services-and-views-contentpr)
*   [通过视图链接使您的 Eclipse 应用程序更丰富](http://www-128.ibm.com/developerworks/java/library/os-ecllink/index.html)

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-10T09:21:08.640

我相信这最好通过 Listeners 来实现。

您的数据（模型）在私有包中，只有这些数据的接口在公共包中公开。

![替代文字](https://wiki.eclipse.org/images/1/10/Mvc.png)

您将在此[wiki 部分](http://wiki.eclipse.org/JFace_Data_Binding_Introduction)中找到原理，也可[在此处找到具体示例](http://wiki.eclipse.org/JFace_Data_Binding/Snippets)。

* * *

关于模型，类似 osgi 的方法是使用主机插件作为可访问对象。IE：

```
MyPlugin.getDefault().getModel() 
```

这将允许您设置/处置模型以及插件生命周期。

如果模型在一个插件中，它可以为监听器定义扩展点。视图可以扩展这些扩展点，然后在加载模型插件时自动注册。一旦从模型中获得第一条消息，视图就可以查询模型以获取所需的信息。

可以在[本文](http://www.vogella.de/articles/EclipseDataBinding/article.html)中找到一个很好的数据绑定示例。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-10T12:33:43.460

我们倾向于使用`IEditorPart`s 来存储模型的保留副本（源自`IEditorInput`）。

如果视图需要了解模型，则使用 ISelection 框架和焦点将模型从编辑器移动到视图。

# java - Java浮点高精度库

> ID：277309
> 
> 赞同：23
> 
> 时间：2008-11-10T07:45:18.037
> 
> 标签：java, floating-point

有哪些 Java 库可以快速实现精度为数千位的浮点或定点运算？它们的性能如何？

对我的一个要求是它实现了一种乘法算法，该算法优于简单乘法算法，该算法需要 4 倍的时间来获得 2 倍大的数字（比较[乘法算法](http://en.wikipedia.org/wiki/Multiplication_algorithms)）。

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2008-11-12T16:53:55.713

[Arbitrary Precision Arithmetic](http://en.wikipedia.org/wiki/Bignum)页面上提到了三个库：java.math（包含提到的 BigDecimal）、[Apfloat](http://www.apfloat.org/)和[JScience](http://jscience.org/)。我对它们进行了一点速度检查，它只使用加法和乘法。

结果是，对于相对较少的数字，BigDecimal 是可以的（对于 1000 位数字，它的速度是其他数字的一半），但是如果您使用更多的数字，那就太差了 - JScience 大约快 4 倍。但明显的性能赢家是 Apfloat。其他库似乎使用天真的乘法算法，其时间与位数的平方成正比，但 Apfloat 的时间似乎几乎呈线性增长。在 10000 位上，它是 JScience 的 4 倍，但在 40000 位上，它是 JScience 的 16 倍。

另一方面：JScience 为数学问题提供了出色的功能：矩阵、向量、符号算法、方程系统的解等等。所以我可能会选择 JScience，然后编写一个包装器来将 Apfloat 集成到 JScience 的算法中——由于良好的设计，这似乎很容易实现。

（更新：我为 JScience 的 number 包编写了一个测试套件并修复了一些错误。这进入了 4.3.1 版。所以我可以建议检查一下。）

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-11-10T07:50:13.160

你检查过[BigDecimal](http://java.sun.com/javase/6/docs/api/java/math/BigDecimal.html)的性能吗？我在 JavaDoc 中看不到任何明显的东西，但它肯定是我的第一个停靠港。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-10T23:36:03.937

你可以看看[JScience](http://jscience.org/)库和他们的[实](http://jscience.org/api/org/jscience/mathematics/number/Real.html)数类。我不确定性能与 BigDecimal 相比如何，但该库的目标是为科学应用程序提供高度调整的类，这似乎是一个好兆头。

* * *

## 回答 #4

> 赞同：-3
> 
> 时间：2011-02-12T22:43:26.493

Apfloat 在尾数上提供高精度，但在指数上的精度似乎低于通常的精度（基于它与 double 可以处理的值的“零对数”崩溃的事实）。所以它对大数字没有用。

此外，文档说：

“构造函数 Apfloat(float,long) 和 Apfloat(double,long) 存在一个陷阱。由于浮点数和双精度数始终在内部以基数 2 表示，因此转换为任何其他基数通常会导致舍入错误，并且生成的 apfloat不会准确到所需的位数。

例如，0.3 不能精确地以 2 为底。当你构造一个像 new Apfloat(0.3f, 1000) 这样的 apfloat 时，得到的数字不会精确到 1000 位，而只能精确到大约 7 位（以基数为单位） 10）。实际上，结果数字将类似于 0.30000001192092896..."

这似乎使 Apfloat 的用处最小。

BigDecimal 没有对数函数，文档也没有说明它是否允许您制作比双精度更大的数字；指数是32位，有点。

# wpf - gridview项目超过显示高度时不出现垂直滚动条

> ID：277316
> 
> 赞同：1
> 
> 时间：2008-11-10T07:55:22.900
> 
> 标签：wpf, gridview, listview, scrollviewer

我将以下语句放在 xaml 中网格的第二行：

```
<ScrollViewer VerticalScrollBarVisibility="Auto" Grid.Row="1">
     <ListView Name="listView" Margin="5" Grid.Row="1">

                <ListView.View>
                    <GridView AllowsColumnReorder="True">
                        <GridViewColumn DisplayMemberBinding="{Binding Path=DateTime}" Header="Date Time" Width="140"/>
                        <GridViewColumn DisplayMemberBinding="{Binding Path=Vehicle}" Header="Vehicle" Width="130"/>
                        <GridViewColumn DisplayMemberBinding="{Binding Path=AlarmType}" Header="Alarm Type" Width="100"/>
                        <GridViewColumn DisplayMemberBinding="{Binding Path=Direction}" Header="Direction" Width="100"/>
                        <GridViewColumn DisplayMemberBinding="{Binding Path=Speed}" Header="Speed" Width="100"/>
                        <GridViewColumn DisplayMemberBinding="{Binding Path=Alarmed}" Header="Alarmed" Width="100"/>
                        <GridViewColumn DisplayMemberBinding="{Binding Path=LoadType}" Header="Load Type" Width="100"/>
                        <GridViewColumn DisplayMemberBinding="{Binding Path=Status}" Header="Status" Width="110"/>
                    </GridView>
                </ListView.View>
            </ListView>     
        </ScrollViewer>
 </Grid> 
```

我将 listView.ItemSource 绑定到代码中定义的 ObservableCollection 以将数据填充到列表中。当添加到 GridView 的项目数超过列表视图高度时，垂直滚动条没有按照我在 XAML 中指定的方式出现。我做错了什么？非常感谢您的意见。谢谢你。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-10T10:40:30.490

这个对我有用：

```
<Window x:Class="WpfApplication1.Window1"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    Title="Window1" Height="300" Width="300">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <ScrollViewer VerticalScrollBarVisibility="Auto" Grid.Row="1">
            <ListView Name="listView" Margin="5" Grid.Row="1">

                <ListView.View>
                    <GridView AllowsColumnReorder="True">
                        <GridViewColumn DisplayMemberBinding="{Binding Path=.}" Header="Whatever" Width="140"/>
                    </GridView>
                </ListView.View>
            </ListView>
        </ScrollViewer>
    </Grid>
</Window> 
```

但是，`ListView`控件模板已经包含一个`ScrollViewer`这样的，以便在需要时`ScrollViewer`出现*在*`ListView`as 中。为什么你需要把它包在另一个？

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-10T09:40:01.003

查看边距和填充是否正确。滚动条可以在某些东西的后面。

将外部容器高度设置为固定值，它可以*拉伸*列表视图，因此它永远不会显示滚动条。

高温高压

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-06-28T05:53:09.160

试试这个代码：

```
ListView listView = new ListView();
listView.SetValue(Grid.RowProperty, 1);
listView.SetValue(Grid.ColumnProperty, 1);
MainGrid.Children.Add(listView); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-04-28T22:20:29.553

```
<Grid x:Name="MainMenuButtonGrid">
  <StackPanel Margin="50,0,0,0">
    <TextBlock Text="Please select any employee" Foreground="Wheat"/>
    <ListView x:Name="listEmployeeDetail" SelectedValuePath="EmployeeID">
      <ListView.View>
        <GridView>
          <GridViewColumn Header="EmployeeName" Width="100" DisplayMemberBinding="{Binding EmployeeName}"></GridViewColumn>
        </GridView>
      </ListView.View>
    </ListView>
  </StackPanel>
</Grid> 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-12-08T06:33:53.257

无需使用`ScrollViewer`. 只需删除`ScrollViewer`并仅使用`ListView`并尝试。

```
ListView listView = new ListView();
listView.SetValue(Grid.RowProperty, 1);
listView.SetValue(Grid.ColumnProperty, 1);
MainGrid.Children.Add(listView); 
```

无需指定列表视图的宽度和高度。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2021-01-31T17:44:01.930

您可以简单地使用 MaxHeight 属性将您的列表视图限制到特定高度，滚动条将自动出现。例如 ：

```
 <ListView Name="listView" Margin="5" Grid.Row="1" MaxHeight="300">
            <ListView.View>
                <GridView AllowsColumnReorder="True">
                    <GridViewColumn DisplayMemberBinding="{Binding Path=DateTime}" Header="Date Time" Width="140"/>
                    <GridViewColumn DisplayMemberBinding="{Binding Path=Vehicle}" Header="Vehicle" Width="130"/>
                    <GridViewColumn DisplayMemberBinding="{Binding Path=AlarmType}" Header="Alarm Type" Width="100"/>
                    <GridViewColumn DisplayMemberBinding="{Binding Path=Direction}" Header="Direction" Width="100"/>
                    <GridViewColumn DisplayMemberBinding="{Binding Path=Speed}" Header="Speed" Width="100"/>
                    <GridViewColumn DisplayMemberBinding="{Binding Path=Alarmed}" Header="Alarmed" Width="100"/>
                    <GridViewColumn DisplayMemberBinding="{Binding Path=LoadType}" Header="Load Type" Width="100"/>
                    <GridViewColumn DisplayMemberBinding="{Binding Path=Status}" Header="Status" Width="110"/>
                </GridView>
            </ListView.View>
        </ListView> 
```

# apache-flex - 确定组件在 Flex 中是否完全可见的算法？

> ID：277327
> 
> 赞同：2
> 
> 时间：2008-11-10T08:01:38.020
> 
> 标签：apache-flex

是否有一种内置方法可以确定组件在 Flex 应用程序中是否完全可见（即不是以一种方式或另一种方式离开屏幕）。如果不是，我将如何解决它？

如果我的主要“下一个”和“上一个”按钮不在屏幕上，我想显示或隐藏其他“下一个”和“上一个”按钮。

什么事件最好听“重新计算”？阶段.调整大小？

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-11T13:31:15.077

这是一种计算组件是否在舞台边界内的方法，但是它不会告诉您该组件是否被另一个组件隐藏，或者该组件是否因为位于另一个容器的边界之外而被隐藏。

```
public function isComponentWithinStage(c:UIComponent):Boolean {
    var tl:Point = c.localToGlobal(new Point(0, 0));
    var br:Point = c.localToGlobal(new Point(c.width, c.height));

    //are we off the left or top of stage?
    if ( tl.x < 0 || tl.y < 0 ) {
        return false;
    }

    var stage:Stage = Application.application.stage;

    //off the right or bottom of stage?
    if ( br.x > stage.width || br.y > stage.height ) {
        return false;
    }

    return true;
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-10T09:34:32.027

你能给出可见项目的细节和它所在的容器吗？是否必须滚动一些容器才能到达按钮？还是有人将 flexlib:MDICanvas 的子窗口部分拖出屏幕？

我认为这将归结为组件的 x,y 位置是否超出其容器的宽度和高度（依此类推，直到您到达顶级应用程序为止。）

# ms-access - MS Access：如何绕过/抑制错误？

> ID：277340
> 
> 赞同：0
> 
> 时间：2008-11-10T08:12:01.507
> 
> 标签：ms-access, vba, error-handling

我正在执行这样的查询

```
select field from table; 
```

在该查询中，有一个循环在许多表上运行。所以，如果表格中不存在该字段，我会得到一个

> 运行时错误 3061

我怎样才能绕过这个错误，比如这个错误流上的那个应该去另一个点？

这是我最近通过这个论坛后的代码。

```
Option Explicit

Private Sub UpdateNulls()
 Dim rs2 As DAO.Recordset
  Dim tdf As DAO.TableDef
  Dim db As Database
  Dim varii As Variant, strField As String
  Dim strsql As String, strsql2 As String, strsql3 As String
  Dim astrFields As Variant
  Dim intIx As Integer
  Dim field As Variant
  Dim astrvalidcodes As Variant
  Dim found As Boolean
  Dim v As Variant

  Open "C:\Documents and Settings\Desktop\testfile.txt" For Input As #1
  varii = ""
  Do While Not EOF(1)
    Line Input #1, strField
    varii = varii & "," & strField
  Loop
  Close #1
  astrFields = Split(varii, ",")  'Element 0 empty

        For intIx = 1 To UBound(astrFields)

        'Function ListFieldDescriptions()
                            Dim cn As New ADODB.Connection, cn2 As New ADODB.Connection
                            Dim rs As ADODB.Recordset, rs3 As ADODB.Recordset
                            Dim connString As String
                            Dim SelectFieldName

                            Set cn = CurrentProject.Connection

                            SelectFieldName = astrFields(intIx)

                            Set rs = cn.OpenSchema(adSchemaColumns, Array(Empty, Empty, Empty, SelectFieldName))

                           'Show the tables that have been selected '
                            While Not rs.EOF

                           'Exclude MS system tables '
                            If Left(rs!Table_Name, 4) <> "MSys" Then
                            strsql = "Select t.* From [" & rs!Table_Name & "] t Inner Join 01UMWELT On t.fall = [01UMWELT].fall Where [01UMWELT].Status = 4"
                            End If

                            Set rs3 = CurrentDb.OpenRecordset(strsql)

            'End Function

            strsql2 = "SELECT label.validcode FROM variablen s INNER JOIN label ON s.id=label.variablenid WHERE varname='" & astrFields(intIx) & "'"

            Set db = OpenDatabase("C:\Documents and Settings\Desktop\Codebook.mdb")
            Set rs2 = db.OpenRecordset(strsql2)

                With rs2
                .MoveLast
                .MoveFirst
                 astrvalidcodes = rs2.GetRows(.RecordCount)
                .Close '
                End With

                    With rs3
                    .MoveFirst
                    While Not rs3.EOF
                        found = False
                        For Each v In astrvalidcodes
                        If v = .Fields(0) Then
                        found = True
                        Debug.Print .Fields(0)
                        Debug.Print .Fields(1)

              Exit For
                    End If
                    Next
                If Not found Then
                msgbox "xxxxxxxxxxxxxxxx"

                End If
                End If
                .MoveNext

                Wend
                End With

           On Error GoTo 0        'End of special handling

    Wend

Next intIx

  End Sub 
```

我得到一个

> 类型不匹配运行时错误

在`Set rs3 = CurrentDb.OpenRecordset(strsql)`

我想我搞混了`ado`，`dao`但我不确定它在哪里。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-10T08:38:47.477

使用`On Error`VBA 提供的语句：

```
Sub TableTest
  On Error Goto TableTest_Error

  ' ...code that can fail... '

  Exit Sub

:TableTest_Error
  If Err.Number = 3061 Then
    Err.Clear()
    DoSomething()
  Else
    MsgBox Err.Description ' or whatever you find appropriate '
  End If
End Sub 
```

或者，您可以逐行关闭自动错误处理（例如中断执行并显示错误消息）：

```
Sub TableTest
  ' ... fail-safe code ... '

  On Error Resume Next
  ' ...code that can fail... '
  If Err.Number = 3061 Then
    Err.Clear()
    DoSomething()
  Else
    MsgBox Err.Description
  End If
  On Error Goto 0

  ' ...mode fail-safe code... '
End Sub 
```

有这些语句可用：

*   `On Error Resume Next`完全关闭 VBA 集成的错误处理（消息框等），执行只是在下一行恢复。请务必在使用后尽早检查错误，因为悬空错误会破坏正常的执行流程。捕获错误后立即清除它以防止发生这种情况。
*   `On Error Goto <Jump Label>`在给定的标签处恢复执行，主要用于捕获各种错误的每个函数的错误处理程序。
*   `On Error Goto <Line Number>`在给定的行号处恢复。远离它，它没有用，甚至很危险。
*   `On Error Goto 0`是近亲。恢复 VBA 集成错误管理（消息框等）

* * *

**编辑**

从编辑的问题中，这是我解决您问题的建议。

```
For Each FieldName In FieldNames ' assuming you have some looping construct here '

  strsql3 = "SELECT " & FieldName & " FROM table"

  On Error Resume Next
  Set rs3 = CurrentDb.OpenRecordset(strsql3)

  If Err.Number = 3061 Then
    ' Do nothing. We dont care about this error '
    Err.Clear
  Else
    MsgBox "Uncaught error number " & Err.Number & " (" & Err.Description & ")"
    Err.Clear
  End If

  On Error GoTo 0

Next FieldName 
```

在继续使用同一个 Sub 或 Function 中的循环之前，请务必*在任何情况下清除错误。*正如我所说，悬空错误会导致代码流变得意外！

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-10T11:00:48.687

与其捕获错误，不如使用 TableDefs 来检查字段或混合使用 ADO 和 DAO？ADO Schemas 可以提供包含必填字段的表列表：

```
Function ListTablesContainingField()
Dim cn As New ADODB.Connection, cn2 As New ADODB.Connection
Dim rs As ADODB.Recordset, rs2 As ADODB.Recordset
Dim connString As String
Dim SelectFieldName

    Set cn = CurrentProject.Connection

    SelectFieldName = "Fall" 'For tksy '

    'Get names of all tables that have a column called 'ID' '
    Set rs = cn.OpenSchema(adSchemaColumns, _
    Array(Empty, Empty, Empty, SelectFieldName))

    'Show the tables that have been selected '
    While Not rs.EOF

        'Exclude MS system tables '
        If Left(rs!Table_Name, 4) <> "MSys" Then
            ' Edit for tksy, who is using more than one forum '
            If tdf.Name = "01UMWELT" Then
                strSQL = "Select * From 01UMWELT Where Status = 5"
            Else
                strSQL = "Select a.* From [" & rs!Table_Name _
                & "] a Inner Join 01UMWELT On a.fall = 01UMWELT.fall " _
                & "Where 01UMWELT.Status = 5"
            End If
            Set rs2 = CurrentDb.OpenRecordset(strSQL)

            Do While Not rs2.EOF
                For i = 0 To rs2.Fields.Count - 1
                    If IsNull(rs2.Fields(i)) Then
                        rs2.Edit
                        rs2.Fields(i) = 111111
                        rs2.Update
                    End If
                Next
                rs2.MoveNext
             Loop
        End If
        rs.MoveNext
    Wend
    rs.Close
    Set cn = Nothing

End Function 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-10T08:37:23.720

试试这个：

On Error Resume Next ' 如果发生错误，则转到下一条语句。

...尝试选择的语句...

如果 (Err <> 0) 那么

```
...act on error, or simply ignore if necessary... 
```

万一

On Error Goto 0 ' 将错误处理重置为先前的状态。

# ruby-on-rails - Rails 中的日期/时间比较

> ID：277345
> 
> 赞同：2
> 
> 时间：2008-11-10T08:17:24.460
> 
> 标签：ruby-on-rails, ruby

我希望能够在 Rails 中比较日期和时间，而不必总是调用 to_time 或 to_date 方法。所以我写了以下代码：

```
class Date
  def ==(other)
    if other.kind_of?(Time)
      self.to_time == other
    else
      super(other)
    end
  end
end 
```

我知道有一种简单的方法来编写它，这样我就可以使它适用于 >、<、>=、<= 和 <=>。但我忘了怎么做 :P 有什么想法吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-11T14:47:58.527

让任何旧的 Ruby 类具有可比性的最简单方法是实现 <=> 实例方法并包含[Comparable](http://www.ruby-doc.org/core/classes/Comparable.html) mixin。届时您将免费获得 >、<、>=、<=、== 等方法。

解决此问题的一种方法是重新打开日期和时间类，`include Comparable`并在必要时重新定义它们的`<=>`方法以进行日期/时间转换（否则回退到原始`<=>`定义）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-10T13:59:03.897

好吧，Date 和 Time 类只是实现了 <=>，这是普通的 Ruby 比较方法/运算符。

另请参阅[Date#<=>](http://ruby-doc.org/core/classes/Date.html#M000685)和[Time#<=>](http://ruby-doc.org/core/classes/Time.html#M000258)的文档。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-10T10:20:01.610

你的例子看起来不错，但我不会使用`kind_of?`- 如果`other`没有实现`to_time`你会得到一个异常！

更新：您正在寻找的可能是`<=>`运营商！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-10T15:01:51.710

我相信您所要求的已经使用其他海报提到的比较运算符实现了。

```
(segfault@megumi)(01:35)% ./script/console
Loading development environment (Rails 2.2.0)
irb(main):001:0> a = Date.now
NoMethodError: private method `now' called for Date:Class
    from (irb):1
    from :0
irb(main):002:0> a = Date.today
    => Mon, 10 Nov 2008
irb(main):003:0> b = Time.today
    => Mon Nov 10 00:00:00 -0500 2008
irb(main):004:0> a == b
    => nil
irb(main):005:0> puts "a" if a == b
    => nil
irb(main):006:0> puts "a" if a != b
    a
    => nil
irb(main):007:0> 
```

# algorithm - 减去月份的日期“换行”

> ID：277351
> 
> 赞同：3
> 
> 时间：2008-11-10T08:21:10.787
> 
> 标签：algorithm

一个月计算的 1 - 1 = 12 的数学表达方式是什么？加法很容易，12 + 1 % 12 = 1，但减法引入了 0，把东西塞满了。

我的实际要求是 x = x + d，其中 x 在求和之前和之后必须始终介于 1 和 12 之间，并且 d 是任何无符号整数。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-10T08:24:43.230

假设 x 和 y 都在 1-12 范围内：

```
((x - y + 11) % 12) + 1 
```

要打破这一点：

```
// Range = [0, 22]
x - y + 11

// Range = [0, 11]
(x - y + 11) % 12

// Range = [1, 12]
((x - y + 11) % 12) + 1 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-10T08:32:26.460

我会在内部使用基于 0 的月份 (0-11)，将一个仅用于外部消耗（输出，另一个调用方法期望 1-12 等）相加，这样您就可以像环绕一样轻松地向后环绕向前。

```
>>> for i in range(15):
...  print '%d + 1 => %d' % (i, (i+1)%12)
...
0 + 1 => 1
1 + 1 => 2
2 + 1 => 3
3 + 1 => 4
4 + 1 => 5
5 + 1 => 6
6 + 1 => 7
7 + 1 => 8
8 + 1 => 9
9 + 1 => 10
10 + 1 => 11
11 + 1 => 0
12 + 1 => 1
13 + 1 => 2
14 + 1 => 3
>>> for i in range(15):
...  print '%d - 1 => %d' % (i, (i-1)%12)
...
0 - 1 => 11
1 - 1 => 0
2 - 1 => 1
3 - 1 => 2
4 - 1 => 3
5 - 1 => 4
6 - 1 => 5
7 - 1 => 6
8 - 1 => 7
9 - 1 => 8
10 - 1 => 9
11 - 1 => 10
12 - 1 => 11
13 - 1 => 0
14 - 1 => 1 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-10T08:31:46.147

你也必须小心加法，因为 (11 + 1) % 12 = 0。试试这个：

```
x % 12 + 1 
```

这来自使用归一化函数：

```
norm(x) = ((x - 1) % 12) + 1 
```

代替，

```
norm(x + 1) = (((x + 1) - 1) % 12 + 1

norm(x + 1) = (x) % 12 + 1 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-10T08:41:12.103

%（模数）运算符为 x % N 生成 0..(N-1) 范围内的答案。假设您的输入在 1..N 范围内（对于 N = 12），用于添加的一般添加代码到当前月份 x 的正数 y 个月应该是：

```
(x + y - 1) % 12 + 1 
```

当 y 为 1 时，这减少到

```
x % 12 + 1 
```

减法基本相同。但是，当操作数中的一个（或两个）为负时，模运算符的不同实现产生的答案存在复杂性。如果已知要减去的数字在 1..N 范围内，那么您可以使用以下事实：以 N 为模减去 y 与以 N 为模加 (N - y) 相同。如果 y 不受约束（但为正)，然后使用：

```
(x + (12 - (y % 12) - 1) % 12 + 1 
```

当值的范围不受控制时，这种双模运算是解决此类问题的常见部分。

# java - Java: `enum` vs `String` as Parameters

> ID：277364
> 
> 赞同：11
> 
> 时间：2008-11-10T08:37:01.660
> 
> 标签：java, enums, string, constants

I've been reading through the details of the `System` libraries `set` and `get` methods yet the parameters are usually Strings.

Would you consider the use of `String` as parameters bad practise since the inclusion of `enum`?

A better alternative at minimum might be `public final String`, No?

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-11-10T08:44:55.123

I would consider Enums to be a better approach than Strings. They are type safe and comparing them is faster than comparing Strings.

As a pre Java 1.5 alternative you could use the type-safe enum pattern suggested by Joshua Bloch in his book Effective Java. For type-safe enums see also [http://www.javacamp.org/designPattern/enum.html](http://www.javacamp.org/designPattern/enum.html)

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-11-10T09:50:38.377

If your set of parameters is limited and known at compile time, use `enum`.

If your set of parameters is open and unkown at compile time, use strings.

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-11-10T08:46:45.727

Just because you declare a `public final String` as something you expect to have passed into a method as a parameter, there's nothing stopping me from passing in anything I like.

Using `enum`s means that I can't create my own object to pass in, protecting both sides of the issue. The only time I can think you should be using constant Strings in lieu of enums is if you need to allow room for the user to extend your method to enable custom functionality...

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-11-10T08:47:46.520

If you're referring to System.setProperty(), System.getProperty(), or System.getenv(), I think Strings are appropriate here since the set of possible keys is open. The key parameter corresponds to an actual text/string type value in some file or store somewhere.

If you have a closed set of keys, I think enums would be much preferred.

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2011-04-21T19:30:40.447

Although using enums is type safe, the need of converting enum to string and vice versa is quite frequent. And there is no built-in feature to do that in Java. And you'll eventually end up with using valueOf() and toString(). And using that approach will be no much different from using just strings. Because you'll need to handle situations where string can not be converted to Enum.

So just using static final strings is easy and is a common practice, AFAIK.

For example, you'll want to interact with a server using some API. You'll need to define every method and a response as Enum. And then you'll need to add toString and valueOf methods. Why just not use String?

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-11-10T08:45:23.280

I've learned the "method of least surprise". Instinctively, using enum is the right thing. So i would go for it. I'm sure the Java makers think alike.

**Edit**: Excellent explanation of POLS: [http://benpryor.com/blog/2006/06/29/api-design-the-principle-of-least-surprise/](http://benpryor.com/blog/2006/06/29/api-design-the-principle-of-least-surprise/)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-10T08:47:52.980

Usage of strings in existing APIs is not bad practice; it is bad practice to change the APIs just because Java has now support for enums. For new APIs, I agree with what everybody else said.

# java - Euler Project Help (Problem 12) - Prime Factors 等

> ID：277368
> 
> 赞同：1
> 
> 时间：2008-11-10T08:38:28.273
> 
> 标签：java

我不想问，但我很困在这里。

我需要测试一系列数字以找到第一个具有 500 多个因素的数字： [http ://projecteuler.net/index.php?section=problems&id=12](http://projecteuler.net/index.php?section=problems&id=12)

- 起初我试图强行回答（在很长一段时间后找到一个带有 480 的数字）

-我现在正在研究确定一个数字的主要因素，然后用它们来找到所有其他因素。

我目前处于可以为我输入的任何数字获得一系列素因子的阶段 - 即 300 具有素因子 2 2 3 5 5

使用这一系列主要因素，我需要能够计算剩余因素 - 这是我坚持的部分。基本上，据我了解，我需要计算数组中所有可能的数字组合......

即 2 * 2
2 * 2 * 3
2 * 2 * 3 * 5
2 * 3
2 * 3 * 3
...等等-但有趣的是...
2 * 5
2 * 3 * 5
...即数组中不相邻的数字

我想不出一种方法可以为任何长度的数组以通用方式对此进行编码......

我需要帮助！PS - 我正在使用 Java

编辑：我的蛮力代码 - 因为有人建议蛮力问题会起作用，所以我的代码中可能有错误:(

```
package euler.problem12;

public class Solution {

    public static void main(String[] args) {
        int next = 1;
        int triangle = 0;
        int maxFactors = 0;

        while(true) {
            triangle = triangle + next;

            int factors = 1;
            int max = (int) triangle / 2;

            for(int i = 1; i <= max; ++i) {
                if(triangle % i == 0) {
                    factors ++;
                }
            }

            if(factors > maxFactors) {
                maxFactors = factors;

                System.out.println(triangle + "\t" + factors);
            }

            next++;
        }
    }
} 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-10T10:00:36.593

好的，第二次尝试，因为我让事情变得太难了。

答案在这里给出：http: [//mathforum.org/library/drmath/view/57151.html](http://mathforum.org/library/drmath/view/57151.html)

> 如果将一个数字分解为其主要功率因数，则通过将所有指数加 1 并将这些结果相乘来找到因子的总数。例子：108 = 2^2 * 3^3，所以因子的总数是(2+1) * (3+1) = 3 * 4 = 12。果然108的因子是1,2,3 , 4, 6, 9, 12, 18, 27, 36, 54, 和 108。这是因为要成为一个因数，一个数必须具有相同的质数，并且提高到相同或更低的幂。

因此，如果您知道主要因素，您只需计算重复的因素并使用上述计算即可计算出因素的数量。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-10T08:43:00.447

据我所知，问题 12 没有提到任何关于素数的内容？这是你看的那个吗？

> 三角形数的序列是通过将自然数相加生成的...

如果是这样，那么也许不考虑素数会有所帮助吗？;)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-03T09:53:23.313

可能晚了3个月，但这里......

我看到答案二已经剥夺了为您提供所需答案的功能，但在回答您最初的问题时，假设您出于某种原因需要生成所有因素，那么您就是这样做的：

假设您在数组中有因子：

int[] primeFactors = new int[] {2, 2, 3, 5, 5};

您需要做的是为每个可能的深度递归每个有序排列，然后将结果集减少为唯一值。

我将解释我的意思：“按顺序排列”：假设您从数组的位置 0 开始，下一个元素必须是 1、2、3 或 4，如果您从 1 开始，则下一个元素必须是 2 , 3 或 4 等等。

“每个可能的深度”：每个单一因素，然后是任何两个因素，然后是任何三个因素，依此类推，直到你得到所有五个因素。

“减少集合”：如果你取两个元素，比如 0&3、0&4、1&3 或 1&4，它们都给你 2 * 5 = 10，它们都提供因子 10，所以你需要将你的集合筛选为不同的值。（呼，这比我预期的要长...... :)）

这样做的方法是使用两种方法，一种选择最大递归深度，启动递归并筛选最终结果，另一种递归值：

```
public static void main(String[] args) {
    int[] primeFactors = new int[] {2, 2, 3, 5, 5};
    List<Integer> allFactors = getAllFactors(primeFactors);
    for (int factor : allFactors) {
        System.out.println("Factor: " + factor);
    }
}

private static List<Integer> getAllFactors(int[] primeFactors) {
    Set<Integer> distinctFactors = new HashSet<Integer>();
    for (int maxDepth = 0; maxDepth <= primeFactors.length; maxDepth++) {
        permutatPrimeFactors(0, maxDepth, 0, 1, primeFactors, distinctFactors);
    }
    List<Integer> result = new ArrayList<Integer>(distinctFactors);
    Collections.sort(result);
    return result;
}

private static void permutatPrimeFactors(int depth, int maxDepth, int minIndex, int valueSoFar, int[] primeFactors, Set<Integer> distinctFactors) {
    if (depth == maxDepth) {
        distinctFactors.add(valueSoFar);
        return;
    }

    for (int index = minIndex; index < primeFactors.length; index++) {
        permutatPrimeFactors(depth + 1, maxDepth, index + 1, valueSoFar * primeFactors[index], primeFactors, distinctFactors);
    }
} 
```

getAllFactors 使用 Set 来确保我们只获得不同的值，然后将它们添加到列表中并对其进行排序，以便我们可以按顺序显示因子。

permutatPrimeFactors 从零项（因子 = 1）到所有项（因子 = 1 * 2 * 2 *3 * 5 * 5 = 300）生成。

希望有帮助。

# api - 是否有指纹读取器 api/sdk？

> ID：277373
> 
> 赞同：18
> 
> 时间：2008-11-10T08:44:22.923
> 
> 标签：api, sdk, fingerprint

我需要从我的应用程序中读取用户的指纹。

我真正想要的是一个简单的 SDK，它可以与许多廉价的指纹读取器一起使用，但我可以处理仅适用于一种特定型号的东西，如果该型号便宜且在全球范围内可用。

而且**它必须是免版税的**，我可以为开发许可证付费，但如果我必须为每次安装付费，我就无法使用它。

我所做的与登录或加密无关，因此阅读器随附的软件对我来说可能毫无用处。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-11-10T10:11:29.630

据我所知，没有用于读取指纹数据的标准 API，因为它是一个相当新的领域，并且没有标准的方法。每个制造商都会提供自己的 API 来读取硬件。API 可能只是硬件的 IO 规范，并且没有任何库，这使事情变得有点棘手。这归结为两个因素。首先是指纹读取器用于许多应用——定制硬件、嵌入式系统到 PC 身份验证等等。从制造商的角度来看，为所有这些不同的系统提供软件是不可行的。其次，每个制造商使用不同的方法来读取和处理捕获的图像，这会使通用 API 出现问题。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-03-18T15:25:34.707

这是一个老问题，但我在研究这个话题时碰到了它。

我确实找到了一个免费的 Linux 库 - [libfprint](http://www.reactivated.net/fprint/wiki/Main_Page)

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-11-10T11:01:17.970

Digitalpersona 有适用于 windows 和 linux 的免费 SDK。 [http://www.digitalpersona.com/products/developer.php](http://www.digitalpersona.com/products/developer.php)

我不知道使用他们的 SDK 进行部署是否有成本。

（实际上，他们似乎不按机器/用户许可收费。）

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-10T10:11:34.137

您是否查看过[BioAPI 联盟](http://www.bioapi.org/)网站？[Google code](http://code.google.com/p/bioapi-linux/)上有一个 linux 库。

还有[libchipcard](http://www2.aquamaniac.de/sites/libchipcard/index.php)，但它没有提到指纹读取器，只有智能卡。

希望有帮助。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-13T20:28:33.417

Symbol 为其 MC75 手持设备提供了一个 api：

[http://support.symbol.com/support/search.do?cmd=displayKC&docType=kc&externalId=12364&sliceId=&dialogID=104336066&stateId=1%200%20104330426](http://support.symbol.com/support/search.do?cmd=displayKC&docType=kc&externalId=12364&sliceId=&dialogID=104336066&stateId=1%200%20104330426)

当然，它只适用于他们的 Windows Mobile 6 MC75 设备。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2020-08-12T13:26:58.957

请参阅[Windows 生物识别框架](https://docs.microsoft.com/ru-ru/windows/win32/secbiomet/biometric-service-api-portal)。

# process - 贵公司收集什么样的统计数据来定义代码/软件产品质量

> ID：277382
> 
> 赞同：8
> 
> 时间：2008-11-10T08:55:02.730
> 
> 标签：process, metrics

我所知道的大多数编程公司/经理只能根据事后发现/解决的错误数量来定义质量。

然而，大多数优秀的程序员一旦开始干预代码，就会天生就能感知质量。（对吧？）

您知道的任何编程公司是否成功地将这些信息转换为组织可以衡量和跟踪以确保质量的指标？

我问，因为我经常听到心怀不满的经理们的咆哮，他们无法说出真正的质量是什么。但是我听说像 HoneyWell 这样的一些组织有很多数字来跟踪程序员的表现，所有这些都转化为数字，并且可以在评估过程中勾选。因此，我向整个社区提出了问题，以提出他们所知道的统计数据。

关于可以很好地测量杂乱代码的工具的建议也会有所帮助。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-10T09:14:46.077

在一个客户站点，我们使用了 CRAP 指标，该指标定义为：

垃圾(m) = comp(m)^2 * (1 – cov(m)/100)^3 + comp(m)

其中 comp(m) 是给定方法的圈复杂度，而 cov(m) 是该方法的单元测试覆盖率级别。我们使用 NDepend 和 NCover 提供原始信息来计算指标。这对于查找代码库中应注意的特定区域很有用。此外，我们的目标不是将特定值指定为目标，而是随着时间的推移进行改进。

无论如何都不是完美的，但仍然有用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-10T09:29:45.237

只是一个快速的提醒：

代码质量是：

*   不是由单一标准定义的：代码质量涉及几组人：[开发人员、项目经理和利益相关者](https://stackoverflow.com/questions/195887#195932)，他们都需要以不同的方式看待代码质量。

*   不是由来自一个公式的一个数字定义，而是由该[数字的](https://stackoverflow.com/questions/207652#207699)[***趋势***](https://stackoverflow.com/questions/207652#207699)定义：“坏”注释本身并不意味着任何东西，特别是如果它是遗留代码，而是一个不断恶化的坏注释......令人担忧；）

# mysql - 如何过滤 MySQL 数据库中的项目列表？

> ID：277383
> 
> 赞同：2
> 
> 时间：2008-11-10T08:55:58.330
> 
> 标签：mysql

我在 mysql 表 file1=(1,2,3,4,6,7) 中有列表存储，而其他列表 file2 = (3,2,4,8,9,10,12) 没有存储在表中，我想要比较两者，结果应该像 result=(6,7,8,9,10,12) 然后计算百分比。比如 mysql 数据结构中的 100*(result/file1+file2) 。我不知道我会怎么做。请知道身体知道指导我或给我一个小例子。谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-10T09:45:25.173

创建一个临时表来存储尚未在表中的“其他”列表，然后使用连接或联合来获得您想要的结果。

如果要选择不在任一列表中的值，则可以使用`GROUP BY`和`COUNT`计算每个数字的出现次数，然后`HAVING`选择计数为 1 的行。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-10T09:10:04.510

我认为您不能在纯 sql 中轻松做到这一点。您需要一种程序语言来获取第一个列表中的结果，合并，排序，与第二个列表唯一并计算结果。

# windows - 如何更新 Perl 命令行应用程序的进度显示？

> ID：277384
> 
> 赞同：5
> 
> 时间：2008-11-10T09:01:55.510
> 
> 标签：windows, perl, command-line, progress-bar

我有一个小的 Perl 脚本（在 Windows 上），它可以帮我检查一些文件，以帮助我完成日常业务。目前它打印出类似...

```
0%
25%
50%
75%
Complete 
```

但我记得我过去使用的脚本不是逐行打印进度，而是更新了显示器上的输出，大概是通过将光标移回并重叠打印那里的内容。

有谁知道需要什么魔法吗？可移植性对我来说并不重要，脚本是一次性的。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-10T09:18:15.057

您可以使用[诅咒](http://search.cpan.org/~mdxi/Curses-UI/lib/Curses/UI/Dialog/Progress.pm)并制作一个不错的进度条。

**编辑**：或者做这样的事情：

```
print "#####                                 [ 10%]\r";
# Do something
print "##########                            [ 20%]\r";
# Do something else
print "###############                       [ 30%]\r";
# Do some more
# ...
# ...
# ...
print "##################################### [100%]\n";
print "Done.\n"; 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-10T09:10:49.440

除了其他答案， \r 将回到当前行的开头

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-11-10T11:45:39.440

如果您需要在 Perl 中做某事，很可能有人已经完成并将其上传到 CPAN。查看一些[名称中带有“progress”](http://search.cpan.org/search?query=progress&mode=all)的模块。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-11-10T11:48:39.027

您可能对[智能评论](http://metacpan.org/pod/Smart::Comments)感兴趣。这可能比编写自己的进度条更容易。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-10T09:05:03.460

您应该能够打印退格字符 '\b' 以将光标向后移动，这样您就可以覆盖之前打印的内容。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-10T09:06:32.490

我不知道这是否适用于 Perl，但在 C/C++ 中你可以使用

```
\b
```

退格。使用其中的几个，您可以移动光标以覆盖旧值。

# networking - 设计应用协议

> ID：277403
> 
> 赞同：19
> 
> 时间：2008-11-10T09:14:48.043
> 
> 标签：networking, protocols

我有一个现有的独立应用程序，它将由第三方使用网络协议进行扩展。这些功能已经实现，我所需要的只是将它们暴露给外部。

假设已经选择了传输协议 (UDP)，是否有任何资源可以帮助我设计我的应用程序协议？

似乎有很多关于软件设计的信息，但没有关于协议设计的信息。我已经看过[Application Protocol Design](http://www.faqs.org/docs/artu/ch05s03.html)。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-10T12:13:36.857

请参阅[Jabber 协议设计指南](http://xmpp.org/extensions/xep-0134.html#guidelines)和[RFC 4101](https://www.rfc-editor.org/rfc/rfc4101)。尽管它旨在使 RFC 更易于审阅者理解，但该 RFC 提供了一些有趣的建议。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-10T10:10:20.100

你看过[谷歌协议缓冲区](http://code.google.com/apis/protocolbuffers/docs/overview.html)吗？这似乎是解决此问题的好方法。

您可以创建一个与现有应用程序通信的端点，然后使用 protobuffer 协议从“外部”响应。它是二进制的，所以它又小又快，你不必编写自己的协议管理器，因为你可以使用谷歌的。缺点是它必须在系统的两侧（在您的“服务器”端和消费者/客户端）上实现。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-10T09:52:35.050

首先，UDP 主要是一种单向广播传输方法。此外，它**可能是有损**的，因此您需要能够处理丢失的数据包和乱序的数据包。如果您需要 UDP 的任何级别的可靠性，或者需要双向连接，那么您最终将需要 TCP 的所有内容，因此您最好从它开始并让网络堆栈来处理它。

接下来，如果您的数据可能大于单个 IP 数据包，那么您将需要某种方法来识别每个数据包的开始和结束，以及处理非法或损坏数据包的方法。我会推荐某种带有数据包长度的标头，某种页脚，也许还有校验和。

然后，您需要某种方式对消息和响应进行编码。周围有许多 RPC 协议。您可以查看 SOAP，或者设计一个自定义的基于 XML 的协议，或者一个二进制协议。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-11-10T10:43:39.423

[协议缓冲区](http://code.google.com/p/protobuf/)的另一个建议- 很好的紧凑二进制文件。但是请注意，虽然二进制协议定义明确，但还没有一个公认的 RPC 标准（[有几个标准正在进行中](http://code.google.com/p/protobuf/wiki/RPCImplementations)，倾向于 TCP 或 HTTP）。

[该规范使得在不同架构](http://code.google.com/p/protobuf/wiki/OtherLanguages)中拥有客户端和服务器变得非常容易，这很好——而且它是可扩展的。

警告：我是其中一个[.NET 版本](http://code.google.com/p/protobuf-net/)的作者，所以我很可能有偏见；-p

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-11T22:18:23.983

你真的应该认真思考你是否真的想设计、记录和维护自己的协议或使用已经存在的东西。很可能已经有符合您需求的书面协议。取决于你在做什么，一开始它可能看起来有点矫枉过正，实现所有规范看起来很乏味，而且比编写自己的规范要少得多，但如果你打算在几年内继续积极开发你的应用程序，它应该可以节省你大量的时间和金钱来使用已经存在并为第三方所知的东西。此外，如果您可以为该协议使用现有的库，那么实现部分应该会快很多。

设计新协议比实现一个协议更有趣，但比维护一个协议要少，因为你必须忍受所有的缺陷。没有一种协议是完美的，但如果你从未设计过一种协议，你可以放心，与设计你可以使用的现有众所周知的协议的人相比，你在设计它时会犯更多的错误。

简而言之，尽可能利用已经存在的东西。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-10T09:58:36.770

如果您选择 XML，请记住您将有大量的标记开销。

与 xml 相比，一个简单的二进制协议也不需要太多的资源来解析。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-10T09:54:06.310

如果您不想从头开始构建您的协议，您应该看看[SOAP](http://en.wikipedia.org/wiki/SOAP_(protocol))。对不同编程语言的支持各不相同，但明确鼓励跨语言通信。

不幸的是，UDP 和 SOAP 似乎还处于起步阶段，HTTP 是最常用的。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-10T10:28:09.407

> 我有一个现有的独立应用程序，它将由第三方使用网络协议进行扩展。

这将有助于更多地了解您的程序的功能以及这些 3rd 方扩展的性质。也许使用UDP的一些理由？

# algorithm - 最佳压缩算法？（最佳定义见下文）

> ID：277409
> 
> 赞同：8
> 
> 时间：2008-11-10T09:19:55.317
> 
> 标签：algorithm, compression

我想以压缩格式存储以下元组的列表，我想知道哪种算法给了我

*   最小压缩尺寸
*   最快的解压/压缩
*   权衡最优（权衡曲线的“拐点”）

我的数据如下所示：

```
(<int>, <int>, <double>), 
(<int>, <int>, <double>), 
...
(<int>, <int>, <double>) 
```

两个整数之一指的是一个时间点，很可能最终出现在一个列表中的数字彼此接近。另一个 int 表示一个抽象 id，并且这些值不太可能接近，尽管它们也不会是完全随机的。double 表示传感器读数，虽然这些值之间存在一些相关性，但它可能没有多大用处。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-10T09:39:49.973

由于“时间”整数可以彼此接近，因此请尝试仅存储第一个整数，然后将差异保存到之前的整数（增量编码）。您也可以对第二个 int 尝试相同的操作。

您可以尝试的另一件事是将数据从 [int1, int2, double], [int1, int2, double]... 重新组织到 [int1, int1...], [int2, int2...], [double ， 双倍的...]。

要找出结果的压缩范围，您可以将数据写入文件并从 Christian Martelock 下载压缩器[CCM](http://lovepimple.110mb.com/compressors/ccm130c.zip)。我发现它对于此类数据收集表现得非常好。它使用了一种非常快速的[上下文混合](http://en.wikipedia.org/wiki/Context_mixing)算法。您还可以将其与 WinZIP 等其他压缩器进行比较，或使用 zLib 等压缩库来查看是否值得。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-10T09:42:25.040

如果我正确阅读了这个问题，那么您只是想有效地存储数据。显然压缩 xml 之类的简单选项很简单，但还有更直接的二进制序列化方法。想到的一个飞跃是 Google 的[协议缓冲区](http://code.google.com/p/protobuf/)。

例如，在带有[protobuf-net](http://code.google.com/p/protobuf-net/)的 C# 中，您可以简单地创建一个类来保存数据：

```
[ProtoContract]
public class Foo {
    [ProtoMember(1)]
    public int Value1 {get;set;}
    [ProtoMember(2)]
    public int Value2 {get;set;}
    [ProtoMember(3)]
    public double Value3 {get;set;}
} 
```

然后只需通过 ProtoBuf.Serializer 类 [de] 序列化 List 或 Foo[] 等。

我并不是说它会*像*滚动你自己的那样节省空间，但它会非常接近。协议缓冲区规范很好地利用了空间（例如，对整数使用 base-128，这样小的数字占用更少的空间）。但是尝试一下会很简单，不需要自己编写所有的序列化代码。

这种方法不仅易于实现，还具有易于从其他架构中使用的优点，因为有[各种语言](http://code.google.com/p/protobuf/wiki/OtherLanguages)的协议缓冲区实现。它还使用比常规 [de] 压缩 (GZip/DEFLATE/etc) 和/或基于 xml 的序列化更少的 CPU。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-10T09:47:37.087

大多数压缩算法对此类数据的效果同样糟糕。但是，您可以做一些事情（“预处理”）来增加数据的可压缩性，然后再将其提供给 gzip 或类似算法的 deflate。尝试以下操作：

首先，如果可能，按升序对元组进行排序。首先使用抽象 ID，然后使用时间戳。假设您有许多来自同一个传感器的读数，相似的 id 将被放在一起。

接下来，如果定期采取措施，则将时间戳替换为与前一个时间戳的差异（当然，传感器的第一个元组除外。）例如，如果所有措施都以 5 分钟的间隔进行，则两个时间戳之间的差值通常接近 300 秒。因此，时间戳字段将更加可压缩，因为大多数值都是相等的。

然后，假设测量值及时稳定，将所有读数替换为同一传感器先前读数的增量。同样，大多数值将接近于零，因此更可压缩。

此外，浮点值是非常糟糕的压缩候选，因为它们的内部表示。尝试将它们转换为整数。例如，温度读数很可能不需要超过两位小数。将值乘以 100 并四舍五入到最接近的整数。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-10T09:51:26.940

这是大多数搜索引擎中常用的方案：存储值的增量并使用可变字节编码方案对增量进行编码，即如果增量小于 128，则可以仅使用 1 个字节对其进行编码。有关详细信息，请参阅 Lucene 和协议缓冲区中的 vint。

这不会为您提供最佳压缩比，但通常是编码/解码吞吐量最快的。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-10T10:30:46.440

按照已经提出的排序，然后存储

（第一个整数）（第二个整数）（双打）

转置矩阵。然后压缩

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-10T10:35:35.540

很好的答案，记录在案，我将把我赞成的答案合并到我最终使用的方法中：

1.  对数据进行排序和重组，使相似的数字彼此相邻，即先按 id 排序，然后按时间戳排序，然后重新排列 from `(<int1>, <int2>, <double>), ...`to `([<int1>, <int1> ...], [<int2>, <int2> ... ], [<double>, <double> ...])`（如 [schnaader](https://stackoverflow.com/questions/277409/best-compression-algorithm-see-below-for-definition-of-best#277434)和[Stephan Leclercq所建议的）](https://stackoverflow.com/questions/277409/best-compression-algorithm-see-below-for-definition-of-best#277450)

2.  [按照schnaader](https://stackoverflow.com/questions/277409/best-compression-algorithm-see-below-for-definition-of-best#277434)和[ididak](https://stackoverflow.com/questions/277409/best-compression-algorithm-see-below-for-definition-of-best#277460)的建议，对时间戳（可能还有其他值）使用增量编码

3.  使用协议缓冲区进行序列化（我将在应用程序中使用它们，因此不会添加依赖项或任何东西）。感谢[Marc Gravell](https://stackoverflow.com/questions/277409/best-compression-algorithm-see-below-for-definition-of-best#277441)指点我。

# flash - JavaFX 与 Flash 和 Flex 相比如何？

> ID：277414
> 
> 赞同：31
> 
> 时间：2008-11-10T09:26:27.020
> 
> 标签：flash, apache-flex, javafx

我知道 Flex 还不错，但也开始使用 Java FX。我有点困惑。Java FX 似乎更关注低级绘图操作和动画。更少创建像 Flex 这样的标准 UI。

那么JavaFX 是不是更像Flash 而不是Flex？

另一方面，JavaFX 也支持 Swing 组件以及数据绑定，这使它看起来更像 Flex。

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-11-10T14:11:54.463

我认为 JavaFX 更像 Flex，因为 JavaFX 更多的是构建应用程序而不是动画（我认为这是 Flex 和 Flash 之间的敏感区别之一）。

我认为 JavaFX 和 Flex 是富 Internet 应用程序编程的未来继承者。它们都旨在扩展 RIA 的可能性。

我看到的 JavaFX 的最大好处之一是**您可以通过简单地导入现有的 Java 业务逻辑来使用它**。

一些语言特性，例如**绑定**和**作为数据类型的持续时间**，是范式转换的，因为它们使某些功能成为可能并且易于使用：

*   绑定：将两个值连接在一起，因此您可以在另一个值更新时自动更新一个值。示例：“名称：绑定 textfield.getValue”。比设置观察者模式来观察变量的变化要容易得多。
*   Duration 可以用作数据类型：“var frameDelay = 5ms”。在处理动画时，将 Duration 作为语言的一个组成部分似乎很容易。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-11-08T07:16:02.357

我想补充几点，

1.  Flex 比 JavaFX 稳定得多，JavaFX 是相当新的。

2.  JavaFX 语法真的很糟糕，它不必要的复杂，flex 哪里是纯 xml，可以很容易阅读和理解，我不明白是什么让 java 人认为使用 xml（如 silverlight 和 flex）而不是使用 xml（如 silverlight 和 flex），制作新的语言语法会令人震惊世界？新语法意味着新的学习曲线。

3.  Flex 运行在 Flash 上，全球 95% 的安装，只有 1.2MB 的 Flash 下载，而 JavaFX + Java 运行时最小为 30 mb，这对发布者来说太大了。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-25T13:24:37.403

刚刚看到Chet Haase 的[这篇文章](http://tech.groups.yahoo.com/group/flexcoders/message/130608)，他之前在 Sun 从事 Java FX 工作，但现在在 Adob​​e 工作，从事 Flex。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2011-01-21T15:21:26.787

最近我同时使用了 Adob​​e Flex 4 和 Java Fx 1.3.1，我同意它们都是非常强大的富互联网图形应用程序开发工具。

我对 Adob​​e Flex 4 的看法是，它是一款非常简单的设计工具。它通过自动生成代码来处理很多编程部分。所以我的投票是“简易工具”。如果您对数据源进行任何更改、更改标签标识符等，它会生成代码并更正代码中的任何引用。

与 Adob​​e Flex 相比，Java Fx 1.3.1 稍微难一些，但在外观和感觉、“图形效果”方面没有可比性，而这在 Java 兼容性方面是最好的。

Adobe Flex 4 builder 不是免费的 Java Fx 1.3.1 + NetBeans 是免费的。这在自由开发者社区中产生了很大的不同。

同样，此比较不适用于“桌面应用程序”与“移动应用程序”与“Web 应用程序”

在打印、将应用程序下载到 excel 或 csv 等方面都有进一步的限制。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-10T15:55:27.797

我会说它更像是 Flash——或者至少它是关于将类似 Flash 的能力带入 Java。不要忘记 Flex 是建立在 Flash 之上的。我所看到的 JavaFX 脚本与 ActionScript 非常相似，而与 MXML 完全不同。Sun 似乎在强调诸如视频之类的重要性以及使用来自行业标准设计程序的矢量图形的能力。

我认为 Flash 的美妙之处在于能够创建您自己的、漂亮的 UI 组件，而 Flex 是关于使用标签布置标准组件的能力。再说一次，它更像是 Flash。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-17T17:05:11.187

我是具有 Flash 背景的 Flex 开发人员 - 没有 Java 经验。所以，我通常会跳过这个帖子，但我碰巧看到了这篇文章，就在刚才：

[http://www.insideria.com/2008/11/is-client-side-java-losing-gro.html](http://www.insideria.com/2008/11/is-client-side-java-losing-gro.html)

它包含一个关于 Java 和 Flex 的简短讨论，但最适合您的问题的是，Yaba，是指向一个名为 Sharendipitous 的小组发布的一系列文章的链接，这些文章是关于他们从 Java 到 Flex 的转换 - 他们为什么做出决定，如何做出决定他们做到了，等等。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2010-12-16T14:35:40.663

收听 Adob​​e 的 James Ward 的采访。

[采访 Adob​​e 的 James Ward](http://www.artima.com/lejava/mp3/jamesWardJavaOne07.mp3)

# javascript - 如何查看 v8 生成的机器码？

> ID：277423
> 
> 赞同：27
> 
> 时间：2008-11-10T09:31:58.320
> 
> 标签：javascript, code-generation, v8

有人知道我如何查看[v8](http://code.google.com/p/v8/)从 Javascript 生成的实际机器代码吗？我已经到了最远的地方`Script::Compile()`，`src/api.cc`但我不知道从那里去哪里。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-07-29T00:55:44.143

我不知道如何从 C++ 代码调用反汇编程序，但是有一种快速而简单的方法可以从 shell 中获得反汇编。

首先，使用反汇编器支持编译 v8：

```
scons [your v8 build options here] disassembler=on sample=shell 
```

现在您可以使用“--print_code”选项调用 shell：

```
./shell --print_code hello.js 
```

这应该给你这样的东西：

```
--- Raw source ---
print("hello world");

--- Code ---
kind = FUNCTION
Instructions (size = 134)
0x2ad0a77ceea0     0  55             push rbp
0x2ad0a77ceea1     1  488bec         REX.W movq rbp,rsp
0x2ad0a77ceea4     4  56             push rsi
0x2ad0a77ceea5     5  57             push rdi
0x2ad0a77ceea6     6  49ba59c13da9d02a0000 REX.W movq r10,0x2ad0a93dc159    ;; object: 0xa93dc159 <undefined>
0x2ad0a77ceeb0    16  4952           REX.W push r10
0x2ad0a77ceeb2    18  49ba688b700000000000 REX.W movq r10,0x708b68
0x2ad0a77ceebc    28  493b22         REX.W cmpq rsp,[r10]
0x2ad0a77ceebf    31  0f824e000000   jc 115  (0x2ad0a77cef13)
0x2ad0a77ceec5    37  488b462f       REX.W movq rax,[rsi+0x2f]
0x2ad0a77ceec9    41  4883ec18       REX.W subq rsp,0xlx
0x2ad0a77ceecd    45  49ba094b3ea9d02a0000 REX.W movq r10,0x2ad0a93e4b09    ;; object: 0xa93e4b09 <String[5]: print>
0x2ad0a77ceed7    55  4c8955e0       REX.W movq [rbp-0x20],r10
0x2ad0a77ceedb    59  488945d8       REX.W movq [rbp-0x28],rax
0x2ad0a77ceedf    63  49ba014d3ea9d02a0000 REX.W movq r10,0x2ad0a93e4d01    ;; object: 0xa93e4d01 <String[11]: hello world>
0x2ad0a77ceee9    73  4c8955d0       REX.W movq [rbp-0x30],r10
0x2ad0a77ceeed    77  49baa06c7ba7d02a0000 REX.W movq r10,0x2ad0a77b6ca0    ;; debug: statement 0
                                 ;; code: contextual, CALL_IC, UNINITIALIZED, argc = 1
0x2ad0a77ceef7    87  49ffd2         REX.W call r10
0x2ad0a77ceefa    90  488b75f8       REX.W movq rsi,[rbp-0x8]
0x2ad0a77ceefe    94  4883c408       REX.W addq rsp,0xlx
0x2ad0a77cef02    98  488945e8       REX.W movq [rbp-0x18],rax
0x2ad0a77cef06   102  488be5         REX.W movq rsp,rbp      ;; js return
0x2ad0a77cef09   105  5d             pop rbp
0x2ad0a77cef0a   106  c20800         ret 0x8
0x2ad0a77cef0d   109  cc             int3
0x2ad0a77cef0e   110  cc             int3
0x2ad0a77cef0f   111  cc             int3
0x2ad0a77cef10   112  cc             int3
0x2ad0a77cef11   113  cc             int3
0x2ad0a77cef12   114  cc             int3
0x2ad0a77cef13   115  49ba60657ba7d02a0000 REX.W movq r10,0x2ad0a77b6560    ;; code: STUB, StackCheck, minor: 0
0x2ad0a77cef1d   125  49ffd2         REX.W call r10
0x2ad0a77cef20   128  488b7df0       REX.W movq rdi,[rbp-0x10]
0x2ad0a77cef24   132  eb9f           jmp 37  (0x2ad0a77ceec5)

RelocInfo (size = 10)
0x2ad0a77ceea8  embedded object  (0xa93dc159 <undefined>)
0x2ad0a77ceecf  embedded object  (0xa93e4b09 <String[5]: print>)
0x2ad0a77ceee1  embedded object  (0xa93e4d01 <String[11]: hello world>)
0x2ad0a77ceeed  statement position  (0)
0x2ad0a77ceeef  code target (context) (CALL_IC)  (0x2ad0a77b6ca0)
0x2ad0a77cef06  js return
0x2ad0a77cef15  code target (STUB)  (0x2ad0a77b6560)

hello world 
```

当然，您的输出会有所不同。以上来自为 Linux x64 编译的 v8 主干。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2014-04-09T10:43:58.020

您需要构建具有反汇编器支持的 v8。

下载 v8 源代码。

```
git clone https://chromium.googlesource.com/v8/v8.git 
```

使用反汇编器支持构建。

```
make dependencies
make ia32.release objectprint=on disassembler=on 
```

根据您的需要，使用某些标志调用 d8 (v8 shell)。

```
out/ia32.release/d8 --code-comments --print-code <app.js> 
```

以供参考：

*   *--code-comments*：包括代码注释。
*   *--print-code*：将代码打印到*stdout*。
*   *--print-code-stubs*：打印代码存根。
*   *--print-opt-code*：打印优化的代码。
*   *--trace-hydrogen*：将IR（中间表示）代码打印到hydrogen.cfg。这个文件可以用[Java 的 C1Visualizer](https://java.net/projects/c1visualizer/downloads)打开。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2017-10-01T09:58:53.770

尝试使用 NodeJS 或 Chrome：

1.  `-print-opt-code`: 通过优化编译器生成的代码。
2.  `-print-bytecode`: 解释器生成的字节码。
3.  `-trace-opt`和`-trace-depot`：哪些功能是（去）优化的。

查看@Franziska Hinkelmann 的这篇文章：

[https://medium.com/dailyjs/understanding-v8s-bytecode-317d46c94775](https://medium.com/dailyjs/understanding-v8s-bytecode-317d46c94775)

另外你也可以试试

`D8`：它将帮助您编译`V8`和查看从 JavaScript 生成的汇编代码。

用法和详细信息：

[http://www.mattzeunert.com/2015/08/19/viewing-assembly-code-generated-by-v8.html](http://www.mattzeunert.com/2015/08/19/viewing-assembly-code-generated-by-v8.html)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-10T12:59:33.410

你走在正确的轨道上，我想。

看起来您需要从 Script::Compile 到 Compiler::Compile，这将引导您到代码生成器（codegen*.cc 和 .h）。

所有这一切都是为了说明，看看 codegen-ia32.cc，如果你在构建时定义 ENABLE_DISSSEMBLER，我认为你的反汇编应该被打印出来。

当然，所有这一切都只是快速浏览我在这里拥有的源的旧副本，所以 YMMV，但我认为这应该可行。

（再次查看您的帖子，我看到您正在寻找机器语言，而不是汇编程序 - 我不确定，但如果您想要汇编代码输出而不是反汇编，您可能必须修改逻辑）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2015-04-13T14:30:44.957

看一下`v8_root/build/features.gypi`，您会发现与反汇编器相关的以及许多其他 V8 编译时功能开关。

# merge - 合并 MS Word 文件的工具

> ID：277431
> 
> 赞同：5
> 
> 时间：2008-11-10T09:38:11.163
> 
> 标签：merge, ms-word, ms-office

我有大量的 Word 文件需要合并（加入）到一个文件中，并且使用 Word 合并（一个一个）会很耗时。您是否体验过任何可以处理这项工作的工具？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-10T09:55:54.153

```
Sub MergeAllDocuments(AllDocumentsPath as String, MasterDocumentPath as String)
  Dim MasterDocument As Document

  Set MasterDocument = Documents.Open(FileName:=MasterDocumentPath)

  TheDocumentPath = Dir(AllDocumentsPath , vbNormal)
  While TheDocumentPath <> ""
    ' Append the next doc to the end of the master doc. (The 
    ' special "\EndOfDoc" bookmark is always available!)
    MasterDocument.Bookmarks("\EndOfDoc").Range.InsertFile TheDocumentPath
    TheDocumentPath = Dir
  Wend

  MasterDocument.Save
End Sub

MergeAllDocuments "C:\MySeparateDocuments\*.doc", "C:\MasterDocument.doc" 
```

我有一个问题——你为什么要做这样的事情（至少有“大量”文件）？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-10T09:46:57.290

不久前，我偶然发现了 Graham Skan 的一篇文章。它可能会让你开始：

```
Sub InsertFiles()
    Dim strFileName As String
    Dim rng As Range
    Dim Doc As Document
    Const strPath = "C:\Documents and Settings\Graham Skan\My Documents\Allwork\" 'adjust as necessary '"

    Set Doc = Documents.Add
    strFileName = Dir$(strPath & "\*.doc")
    Do
        Set rng = Doc.Bookmarks("\EndOfDoc").Range
        If rng.End > 0 Then 'section break not necessary before first document.'
            rng.InsertBreak wdSectionBreakNextPage
            rng.Collapse wdCollapseEnd
        End If
        rng.InsertFile strPath & "\" & strFileName
        strFileName = Dir$()
    Loop Until strFileName = ""
End Sub 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-10T09:39:24.110

您是否尝试过使用 Word COM api？你可以自动化很多事情——也许你可以自动化合并。

你真的需要做一个实际的合并，还是你想把文件连接在一起。这两件事是完全不同的。

当您有两个版本的原始文件具有（可能冲突的）更改时，将使用合并。我真的看不出您将如何拥有需要将所有文件合并在一起的“大量”文件。这绝对是一场冲突的噩梦。您的意思是将它们的集合合并到单个文件中吗？

加入将是当您想要一个接一个地连接它们时。这会容易得多。这很可能使用 COM api。

# html - HTML Click 在 IE 中工作，而不是 FireFox、Chrome

> ID：277437
> 
> 赞同：1
> 
> 时间：2008-11-10T09:40:54.900
> 
> 标签：html, internet-explorer, firefox-3

这一定很简单：我基于具有两个选项的表单设置了一个框架页面，其中包含两个可能的目标框架来源。我使用 OnClick 事件来捕获用户的点击以显示相应的页面。它在 Internet Explorer 7 中运行良好，交换了两个源页面。FireFox 3 和 Chrome 仅显示默认源。

HEAD 脚本部分：

```
function SwapInlineFrameSource()

{
var rsRadio, rsiFrame;

rsRadio=document.getElementById('County');

rsiFrame=document.getElementById('RatesFrame')

if (rsRadio.checked===true) {

    rsiFrame.src="SantaCruzRates.htm";

    }

else {

    rsiFrame.src="DelNorteRates.htm";

    }

} 
```

身体形式部分（评论显示在这里）：

```
<input type="radio" value="SC" checked name="County"   onclick="SwapInlineFrameSource()"> 
    Santa Cruz
<input type="radio" value="DN" name="County" onclick="SwapInlineFrameSource()" > 
    Del Norte 
```

我错过了什么？（现场示例：[http](http://www.raintrees.com/rates.html) ://www.raintrees.com/rates.html ）

谢谢！

先生

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-10T09:51:16.987

您正在使用 getElementByID，但没有为输入指定 ID。也许考虑一下：

```
function SwapInlineFrameSource(rdoButton)
{
  rsiFrame = document.getElementById("RatesFrame");
  rsiFrame.src = rdoButton.value;
}

<input type="radio" value="SantaCruzRates.htm" checked="checked" name="County" onClick="SwapInlineFrameSource(this);">Santa Cruz</input>
<input type="radio" value="DelNorteRates.htm" name="County" onClick="SwapInlineFrameSource(this);">Del Norte</input> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-10T09:50:36.083

你的代码是错误的......

```
var rsRadio, rsiFrame;
rsRadio=document.getElementById('County');
rsiFrame=document.getElementById('RatesFrame')
if (rsRadio.checked===true) { 
```

我假设您的意思是 getElementsByName 而不是 ID 因为您在这些单选按钮上没有县的 ID。

实际上，您需要确定选中了哪个单选按钮，这样您就可以进行类似的操作（假设只有 2 个选项）

```
if(document.getElementsByName()[0].checked){
    // show Santa Cruz Rates
}else{
    // show other rates
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-10T09:48:08.523

我不相信 getElementById 适用于 Firefox 中的帧。我一直使用框架[“frameID”]，它似乎更一致地工作。

# c# - 在单例后面抽象 IoC 容器 - 做错了吗？

> ID：277438
> 
> 赞同：10
> 
> 时间：2008-11-10T09:41:41.310
> 
> 标签：c#, singleton, inversion-of-control

通常，我喜欢让应用程序完全不了解 IoC 容器。但是，我遇到了需要访问它的问题。为了消除痛苦，我使用了一个基本的 Singleton。在你跑上山或拔出猎枪之前，让我回顾一下我的解决方案。基本上，IoC 单例完全没有做任何事情，它只是委托给一个必须传入的内部接口。我发现这使得使用单例变得不那么痛苦。

下面是 IoC 包装器：

```
public static class IoC
    {
        private static IDependencyResolver inner;

        public static void InitWith(IDependencyResolver container)
        {
            inner = container;
        }

        /// <exception cref="InvalidOperationException">Container has not been initialized.   Please supply an instance if IWindsorContainer.</exception>
        public static T Resolve<T>()
        {
            if ( inner == null)
                throw new InvalidOperationException("Container has not been initialized.  Please supply an instance if IWindsorContainer.");

            return inner.Resolve<T>();
        }

        public static T[] ResolveAll<T>()
        {
            return inner.ResolveAll<T>();
        }
    } 
```

IDependencyResolver：

```
public interface IDependencyResolver
    {
        T Resolve<T>();
        T[] ResolveAll<T>();
    } 
```

到目前为止，我使用它的几次都取得了巨大的成功（也许每隔几个项目一次，我真的不想完全使用它），因为我可以注入任何我想要的东西：Castle，一个存根，假货，等等

这是一条湿滑的路吗？我会在未来遇到潜在的问题吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-13T10:01:04.000

我已经看到即使 Ayende 在 Rhino Commons 代码中也实现了这种模式，但我建议尽可能不要使用它。温莎城堡默认没有此代码是有原因的。StructureMap 确实如此，但 Jeremy Miller 一直在远离它。理想情况下，您应该像对待任何全局变量一样怀疑容器本身。

但是，作为替代方案，您始终可以将容器配置为将 IDependencyResolver 解析为对容器的引用。这可能听起来很疯狂，但它明显更加灵活。只要记住一个对象应该调用“新”或执行处理的经验法则，但不能两者兼而有之。对于“调用新”替换为“解决参考”。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-10T10:34:08.350

那不是真正的单例类。那是一个带有静态成员的静态类。是的，这似乎是一个好方法。

我认为 JP Boodhoo 甚至为这种模式起了一个名字。[静态网关模式](http://codebetter.com/jpboodhoo/2007/10/15/the-static-gateway-pattern)。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-11T00:25:14.740

请注意：Microsoft Patterns and Practices 创建了一个通用服务定位器 ( [http://www.codeplex.com/CommonServiceLocator](http://www.codeplex.com/CommonServiceLocator) )，大多数主要的 IoC 容器将在不久的将来实施该定位器。您可以开始使用它来代替您的 IDependencyResolver。

顺便说一句：这是解决您的问题的常用方法，并且效果很好。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2013-06-28T09:49:42.333

这一切都取决于使用情况。像这样使用容器称为服务定位器模式。在某些情况下它不适合，而在某些情况下它确实适用。

如果你用谷歌搜索“服务定位器模式”，你会看到很多博客文章说它是一种反模式，但事实并非如此。该模式只是被过度使用（/滥用）。

对于典型的业务线应用程序，您不应该使用 SL，因为您隐藏了依赖项。您还遇到了另一个问题：如果您使用根容器（而不是其中一个生命周期），则无法管理状态/生命周期。

服务定位器非常适合基础架构。例如，ASP.NET MVC 使用服务定位器来解决每个控制器的所有依赖关系。

# mysql - MySql：MyISAM 与 Inno DB！

> ID：277440
> 
> 赞同：44
> 
> 时间：2008-11-10T09:42:23.120
> 
> 标签：mysql, database, innodb, myisam

MySql 中的 MyISAM 和 Inno DB 类型有什么区别？

* * *

## 回答 #1

> 赞同：58
> 
> 时间：2008-11-10T09:45:20.710

主要区别在于 InnoDB 支持事务，而 MyISAM 不支持。

还有许多其他差异，但我知道的常见差异是：

*   MyISAM 通常被认为在搜索方面更快，但最近的 InnoDB 改进正在消除这种差异并提高高并发工作负载性能
*   InnoDB 支持事务，而 MyISAM 不支持
*   InnoDB 支持引用完整性，而 MyISAM 不支持
*   InnoDB 处理索引有点不同，将主键存储为每个索引的一部分（使索引在磁盘上占用更多空间，但也使覆盖索引更有可能）
*   MyISAM 进行表级锁定，而 InnoDB 可以进行行级锁定
*   MySQL 配置文件中使用了不同的内存/缓冲区/索引设置
*   InnoDB 通常被认为具有更好的崩溃恢复
*   正如另一个答案中提到的，数据以不同的方式存储在磁盘上。我相信 InnoDB 在这方面是可配置的，如果需要，每个表可以有一个文件等

我敢肯定，谷歌搜索或 MySQL 网站会更详细地提出许多其他差异。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2011-10-15T05:35:44.110

> **InnoDB 和 MyISAM**

***特点和性能比较：***

1.  InnoDB 较新，而 MyISAM 较旧。
2.  InnoDB 更复杂，而 MyISAM 更简单。
3.  InnoDB 在数据完整性方面更加严格，而 MyISAM 是松散的。
4.  InnoDB 实现了用于插入和更新的行级锁，而 MyISAM 实现了表级锁。
5.  InnoDB 有事务，而 MyISAM 没有。
6.  InnoDB 有外键和关系约束，而 MyISAM 没有。
7.  InnoDB 有更好的崩溃恢复，而 MyISAM 在系统崩溃时恢复数据完整性方面很差。
8.  MyISAM 有全文搜索索引，而 InnoDB 没有。

鉴于这些差异，InnoDB 和 MyISAM 各有其独特的优势和劣势。它们在某些情况下都比另一个更适合。

***InnoDB 的优势***

1.  InnoDB 应该用于优先考虑数据完整性的地方，因为它在关系约束和事务的帮助下固有地处理它们。
2.  在写入密集型（插入、更新）表中更快，因为它利用行级锁定并且只保留对正在插入或更新的同一行的更改。

***InnoDB 的缺点***

1.  由于 InnoDB 必须处理表之间的不同关系，数据库管理员和方案创建者必须花费更多时间来设计比 MyISAM 更复杂的数据模型。
2.  消耗更多的系统资源，例如 RAM。事实上，许多人建议在安装 MySQL 后如果没有实质性的需要，关闭 InnoDB 引擎。
3.  没有全文索引。

***MyISAM 的优势***

1.  设计和创建更简单，因此更适合初学者。不用担心表之间的外部关系。
2.  由于结构更简单，因此总体上比 InnoDB 更快，因此服务器资源的成本要低得多。
3.  全文索引。
4.  特别适用于读取密集型（选择）表。

***MyISAM 的缺点***

1.  没有数据完整性（例如关系约束）检查，这是数据库管理员和应用程序开发人员的责任和开销。
2.  不支持在银行等关键数据应用程序中必不可少的交易。
3.  对于频繁插入或更新的表，比 InnoDB 慢，因为整个表都被锁定以进行任何插入或更新。

比较非常简单。InnoDB 更适合需要频繁插入和更新的数据危急情况。另一方面，MyISAM 在不太依赖于数据完整性并且大多只是选择和显示数据的应用程序中表现更好。

***参考：*** [InnoDB 和 MyISAM 的比较](http://www.kavoir.com/2009/09/mysql-engines-innodb-vs-myisam-a-comparison-of-pros-and-cons.html)

您还可以在此处查看更多详细信息： [MyISAM 或 InnoDB MySQL 引擎？](http://linuxers.org/howto/myisam-or-innodb-mysql-engine)

希望这可以帮助。

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2008-11-10T10:53:05.630

MyISAM 支持（非标准 SQL）全文索引，而 InnoDB 仍然不支持。这是我们今天使用 MyISAM 的唯一原因。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-11-10T10:14:13.337

MyISAM 和 InnoDB 最重要的区别在于 InnoDB 支持事务和外键。如果您需要外键和相关功能（例如自动级联删除），则需要使用 InnoDB。

在大多数情况下，InnoDB 比 MyISAM 慢，但由于更好的锁定机制，在某些条件下可以执行得更快；MyISAM 在执行插入/更新时锁定整个表以供读取。InnoDB 可以进行行级锁定，从而允许对表进行多个并发写入和读取。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-11-10T11:58:52.160

您可以在 MySQL 文档中获得有关 MyISAM 和 InnoDB 的更多信息：

[http://dev.mysql.com/doc/refman/5.1/en/myisam-storage-engine.html](http://dev.mysql.com/doc/refman/5.1/en/myisam-storage-engine.html)

[http://dev.mysql.com/doc/refman/5.1/en/innodb-overview.html](http://dev.mysql.com/doc/refman/5.1/en/innodb-overview.html)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-10T09:45:20.493

主要区别在于 InnoDB 支持[transactions](http://dev.mysql.com/doc/refman/5.0/en/ansi-diff-transactions.html)，而 MyISAM 不支持。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-10T09:48:22.000

MyISAM 和 InnoDB 也以不同的方式将数据存储在磁盘上。MyISAM 为每个表使用一个数据文件和一个索引文件，存储在以数据库命名的目录中。InnoDB 似乎将所有内容集中在一个名为 ibdata1 的文件中。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2010-10-14T19:16:24.043

## NFS 支持

与 MyISAM 不同，InnoDB 在 NFS 上可能存在问题。

从[配置 InnoDB (MySQL 5.5 版)](http://dev.mysql.com/doc/refman/5.5/en/innodb-configuration.html)

> 警告
> 
> 如果您的数据考虑可靠性，请不要将 InnoDB 配置为使用 NFS 卷上的数据文件或日志文件。潜在问题因操作系统和 NFS 版本而异，包括缺乏对冲突写入的保护以及对最大文件大小的限制等问题。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2014-09-10T14:42:53.063

InnoDB 特点 1\. 提供完整的事务能力和完整的 ACID（原子性、一致性、隔离性和持久性）合规性。

2.  它具有行级锁定。通过支持行级锁定，您可以将数据添加到 InnoDB 表，而无需引擎在每次插入时锁定表，这加快了数据库中信息的恢复和存储。

3.  InnoDB 系统的关键是数据库、缓存和索引结构，其中索引和数据都缓存在内存中以及存储在磁盘上。这可以实现非常快速的恢复，甚至可以在非常大的数据集上工作。

4.  InnoDB 支持外键约束

5.  InnoDB 支持自动崩溃恢复
6.  InnoDB 支持表压缩（读/写）
7.  InnoDB 支持空间数据类型（无空间索引）

8.  Innodb 支持非锁定 ANALYZE TABLE 并且仅在服务器运行时间较长时才需要，因为它会在表打开时深入索引统计并获取索引信息。

9.  Innodb 没有单独的索引文件，因此不必打开它们。

10.  Innodb 按主键顺序（在 ALTER 之后）一次构建其索引，这意味着索引树不是按最佳顺序构建的并且是碎片化的。目前无法对 InnoDB 索引进行碎片整理，因为 InnoDB 无法构建在 MySQL 5.0 中通过排序索引。即使删除和重新创建 InnoDB 索引也可能会导致索引碎片化，具体取决于数据。

11.  一个表最多可以包含 1000 列。

12.  InnoDB 内部最大密钥长度为 3500 字节，但 MySQL 本身将其限制为 3072 字节。（MySQL 5.0.17 之前的非 64 位构建以及 5.0.15 之前的所有构建为 1024 字节。）

13.  InnoDB 中的默认数据库页面大小为 16KB。通过重新编译代码，您可以将其设置为 8KB 到 64KB 范围内的值。您必须在 univ.i 源文件中更新 UNIV_PAGE_SIZE 和 UNIV_PAGE_SIZE_SHIFT 的值。
14.  InnoDB 表不支持 FULLTEXT 索引。

    MYISAM 特点

    1.  无交易支持
    2.  表级锁定
    3.  提供全文搜索
    4.  表中数据没有限制。
    5.  快速 COUNT(*)s（不使用 WHERE、GROUP BY 或 JOIN 时）
    6.  全文索引
    7.  更小的磁盘占用
    8.  非常高的表压缩（只读）
    9.  空间数据类型和索引（R-tree）
15.  通过使用 DATA DIRECTORY='/path/to/data/directory' 或 INDEX DIRECTORY='/path/to/index/directory' 您可以指定 MyISAM 存储引擎应该将表的数据文件和索引文件放在哪里。目录必须是目录的完整路径名，而不是相对路径。

[您可以在http://faisalbhagat.blogspot.com/2014/09/innodb-vs-myisam.html](http://faisalbhagat.blogspot.com/2014/09/innodb-vs-myisam.html)找到更多详细信息

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-11-10T12:55:27.457

以下是 InnoDB 和 MyIsam 之间差异的描述：

[InnoDB 和 MyIsam 的区别](http://tag1consulting.com/MySQL_Engines_MyISAM_vs_InnoDB)

几个区别：

*   **MISAM**不支持任何数据库事务，
*   **INNODB**将提供交易
*   **MISAM**提供表级锁定，
*   **INNODB**提供行级锁定
*   **INNOBD**支持外键，**MYISAM**不...

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-11-10T13:12:56.503

MyISAM 在备份方面更方便，因为锁定所有表并直接在文件系统中复制文件相当简单。（作为 perl 脚本的 mysqlhotcopy 甚至是 mysql afaik 的一部分）

InnoDB 稍微复杂一些，仅仅复制文件是行不通的，因为它们无法在另一台机器上开箱即用地恢复。

但是，也有提供 InnoDB hotcopying 的商业软件。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-10-13T16:26:33.860

[虽然事务支持是主要区别，但如果您将长时间运行的 SELECT 查询与 UPDATE 语句混合使用](http://blog.scoutapp.com/articles/2009/10/09/choosing-between-the-mysql-myisam-and-innodb-table-types)，则表级锁定可能会成为问题。

# sql - 函数索引在 SQL 中是如何工作的？

> ID：277447
> 
> 赞同：2
> 
> 时间：2008-11-10T09:45:53.877
> 
> 标签：sql, database

有谁知道函数索引在数据库中是如何工作的？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-10T09:59:34.240

在 Oracle 中有一种叫做**基于函数的索引：**

Oracle 8i 引入了基于函数的索引来解决以下问题：在查询的 where 子句中对**索引列执行函数保证****不会使用索引**。

这是一个链接： [Oracle-Base 上的基于函数的索引](http://www.oracle-base.com/articles/8i/FunctionBasedIndexes.php)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-10T10:24:48.823

如果您正在谈论在创建索引时获取函数的结果，则从 SQL 中使用此功能，如下所示：

```
CREATE INDEX index_name ON table_name (function_name(column_name)); 
```

规划器可以将其用于以下查询：

```
SELECT foo FROM table_name WHERE bar = function_name(column_name); 
```

有关详细信息，请参阅给定的 RDBMS 文档（例如，在 PostgreSQL 中，它被称为[表达式索引](http://www.postgresql.org/docs/current/static/indexes-expressional.html)）。

# qt - 翻译 Qt 应用程序

> ID：277453
> 
> 赞同：4
> 
> 时间：2008-11-10T09:48:33.793
> 
> 标签：qt, translation, qt-linguist

我需要将我的应用程序翻译成多种不同的语言，我有翻译人员并且知道我可以使用 Qt Linguist。但是据我所知，我必须自己打包 Linguist 并将其发送给翻译人员。

是否有基于 Web 的解决方案或其他包含 ts 文件的 Qt Linguist 软件包？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-10T12:50:29.340

我认为您必须自己打包。然而，在前几天浏览 qt-apps.org 时，我确实遇到了[Qt Linguist Download](http://www.qt-apps.org/content/show.php/Qt+Linguist+Download?content=89360)，它似乎是 Linguist 的打包版本，旨在完全满足这一需求。我自己并没有真正使用过这个——我们的翻译是在内部完成的，所以我们没有遇到这个特殊的问题。

# visual-studio - 框架 goto 定义显示注释，这些是从 xml 注释生成的吗？

> ID：277459
> 
> 赞同：1
> 
> 时间：2008-11-10T09:51:22.587
> 
> 标签：visual-studio, metadata, xml-comments

最近我有点惊讶地发现，我精心设计的 xml 评论并没有在我的同事的智能感知中出现。一直将关联程序集与项目引用一起使用，我没有意识到您还必须导出 .xml 文档才能访问此信息。

这让我想知道 .Net 框架智能感知是如何工作的。如果我理解正确，.xml 文件必须隐藏在特殊文件夹中的某个地方吗？

但我的主要问题是关于“转到定义”——如果你在 .Net 框架程序集上转到定义，你会得到从元数据生成的信息——而且还有很多有用的评论——这些是从 Xml 评论神奇地生成的，还是有人有写一个宏+来转换它们只是为了构建？换一种说法：我怎样才能为我的程序集获得这种效果？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-11T16:39:49.423

您的项目是否配置为生成 XML 文档？仅仅因为您将注释添加到源代码，编译器将不会生成 .xml 文件，除非它被告知。

在项目属性页面中，转到“构建”选项卡并查看“输出”部分。您应该会看到一个标题为“XML 文档文件”的复选框条目。如果该复选框后面的文本框为空，则您没有生成 XML 文档文件。

生成 XML 文档文件后，您应该会在 IntelliSense 工具提示中看到您的注释。如果您包含对其他项目的引用作为项目引用，这应该会自动发生。如果包含对程序集的引用，则需要确保 xml 文件与引用的程序集位于同一位置。（当您构建时，您应该获取所有在 bin/debug 或 bin/release 文件夹中的程序集的 xml 文件。）

对于 .NET Framework 程序集本身，相应的 xml 文档文件作为框架的一部分安装。对于 .NET 2.0、3.0 或 3.5，文档文件位于`C:\Windows\Microsoft.NET\Framework\v2.0.50727\en`（假设框架的默认安装）。IntelliSense 工具提示和 Visual Studio 中的“转到定义”功能都使用这些文件来显示此信息。没有发生任何特殊处理或运行宏来实现这一点。Visual Studio 最可能使用的唯一信息是注册表项的组合，以确定文档文件的正确路径。

虽然您可能可以在同一文件夹中找到您自己的程序集的 xml 文档文件，但我建议您不要这样做，因为这样您会使用非框架相关文件污染框架安装。

# sql-server - Visual Studio 2008 是否支持 SQL 报告服务 2008

> ID：277465
> 
> 赞同：0
> 
> 时间：2008-11-10T09:53:51.787
> 
> 标签：sql-server, reporting-services, ssrs-2008

我需要通过数据扩展发送邮件我有 Visual Studio 2008。我正在从 Visual Studio 2005 迁移。

会不会。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-10T13:15:36.420

你可以这样做[http://sqlcat.com/technicalnotes/archive/2008/07/09/scaling-up-reporting-services-2008-vs-reporting-services-2005-lessons-learned.aspx](http://sqlcat.com/technicalnotes/archive/2008/07/09/scaling-up-reporting-services-2008-vs-reporting-services-2005-lessons-learned.aspx)

# asp.net - 从 HTML 内容解析纯文本电子邮件 (ASP.NET)

> ID：277469
> 
> 赞同：1
> 
> 时间：2008-11-10T09:55:19.397
> 
> 标签：asp.net, html, email, parsing, plaintext

是的，简而言之，我们基本上已经有了一个生成电子邮件 HTML 内容的系统。它并不完美，但它有效。

由此，我们需要能够导出电子邮件的明文替代方案。我正在考虑立即开始并创建一个正则表达式以`<*>`从消息中删除标签 - 但后来我意识到**这并不好，因为我们确实需要一些格式信息（段落、换行符、图像等）。**

**注意：**我可以实际发送邮件和设置替代视图等，这**只是从 HTML 获取纯文本。**

所以，我正在思考一些想法。将发布一个作为答案，看看你们的想法，但我想我会把它打开到地板上。:)

如果您需要更多说明，请大声喊叫。

非常感谢，

抢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-10T13:24:18.600

## 我的解决方案

好的，就是这样！我想出了一个解决我的问题的方法，它就像一个魅力！

现在，这里有一些我想设定的目标：

*   电子邮件的所有内容都应保留在 ASPX 页面中（就像当前的 HTML 内容一样）。
*   除了说“”之外，我不希望客户端代码做任何事情`SendMail("PageX.aspx")`。
*   我不想写太多代码。
*   我想让代码在语义上尽可能正确（没有*真正*疯狂的黑客攻击！）。

### 过程

所以，这就是我最终做的事情：

*   转到电子邮件消息的母版页。创建一个 ASP.NET [MultiView 控件](http://msdn.microsoft.com/en-us/library/3ek2z7fh(VS.85).aspx)。此控件将有两个视图 - HTML 和 PlainText。
*   在每个视图中，我为实际内容添加了内容占位符。
*   然后我抓取了所有现有的 ASPX 代码（例如页眉和页脚）并将其粘贴在 HTML 视图中。所有这一切，DocType 和一切。这确实会导致 VS 有点抱怨。**忽略它。**
*   然后，我当然向 PlainText 视图添加了新内容，以便在 PlainText 环境中最好地复制 HTML 视图。
*   然后我向 Master 添加了一些代码`Page_Load`，检查 QueryString 参数“type”，它可以是“html”或“text”。如果不存在，它会落入“文本”。根据值，它会**切换视图。**
*   然后，我转到内容页面并为 PlainText 等效项添加新的占位符，并根据需要添加文本。
*   为了让我的生活更轻松，然后我重载了我的`SendMail`方法以获取所需页面的响应，传递 " `type=html`" 和 " " 并酌情`type=text`创建[AlternateView 。](http://msdn.microsoft.com/en-us/library/system.net.mail.alternateview.aspx)

### 总之

所以，简而言之：

*   视图将内容（HTML 和文本）的实际“视图”分开。
*   母版页根据 QueryString 自动切换视图。
*   内容页面负责其视图的外观。

任务完成！

如果其中任何一个不清楚，请大声疾呼。我想在某个时候更详细地创建关于此的博客文章。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-10T09:56:38.037

### 我的点子

根据 HTML 内容创建页面并遍历控件树。然后，您可以从控件中选择文本并根据需要处理不同的控件（例如，对图像使用 ALT 文本，对 HR 使用“____”等）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-10T10:49:08.960

您可以确保 HTML 邮件采用 XHTML 格式，以便您可以使用标准 XML 工具轻松解析它，然后创建您自己的输出纯文本的 DOM 序列化程序。涵盖一般的 XHTML 仍然需要大量工作，但是对于您计划在电子邮件中使用的有限子集，它可以工作。

或者，如果您不介意使用其他程序，您可以使用 -dump 开关切换到 lynx Web 浏览器。

# excel - 编程 Excel

> ID：277474
> 
> 赞同：3
> 
> 时间：2008-11-10T09:56:58.583
> 
> 标签：excel, vsto

我想让我的男朋友尝尝编程的味道。如果由我决定，我会教 Scheme、Haskell 或 F#，但因为他更愿意学习对他作为财务顾问的工作有用的东西，即 Excel 编程。

Excel 编程有哪些选择？对于刚刚学习编程但想要完成任务的人，您会推荐哪一个？你有什么书/资源推荐给他（高级 Excel 用户，初级程序员）或我（中级 Excel 用户，高级程序员）吗？

谢谢。我创建[了一个关于 Excel 编程的博客](http://excel4vivi.blogspot.com/)来记录我们的发现。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-10T14:34:47.633

作为一名长期（商业）Excel 用户和程序员，我建议从一本好的 VBA 书籍开始，重点介绍 Basic 语言的关键特性，以及如何与 Excel 对象（工作簿、工作表等）进行通信。最初，我不会担心用户表单——我已经很多年没有使用过用户表单了——起初我也不会太担心数据库。

我建议特别关注两个领域，从 Basic 语言本身开始，使用 Debug.Print 将输出写入即时窗口，并忽略附加了 Excel 的事实。[通过解决一些欧拉问题](http://projecteuler.net/)，您可以在这方面获得很好的实践，这些问题有利于没有用户界面的纯代码解决方案。

之后，我将学习如何与 Excel 对象对话，并阅读尽可能多的 Excel 论坛和网页以获取技巧。例如，一次读取和写入多个单元比一次读取一个要快得多。

是的，VBA 不像大多数“专业”语言那样功能齐全，但与大多数语言相比，它有一个关键优势——它更容易编写，普通用户也可以检查、修改和维护——而且可检查性和灵活性是在商业世界中至关重要。与 Excel 一起，它是一个了不起的商业工具。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-10T10:07:27.577

基本上有两个大的选择：他可以编写 VBA 代码（宏）或 .NET 代码。

VBA 代码建立在简单的语言之上，门槛低。但是，如果他对一般编程感兴趣，那么学习 .NET（最好是 C#）可能会更好。它比 VBA 强大得多，并且会教他更多关于正确的软件构造和它背后的基本概念的知识。

我认为最好让他先编写一些愚蠢的小 Winforms 应用程序以了解基础知识，然后再研究 Excel 互操作性。您可以通过谷歌搜索“C# Excel”找到一堆 C#/Excel 互操作代码示例。这是一个例子：

[http://dotnetperls.com/Content/Excel-Interop-Performance.aspx](http://dotnetperls.com/Content/Excel-Interop-Performance.aspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-10T10:56:08.963

至少在运行时方面，VBA 是 VB6。它有足够的 OO 能力来理解封装和（排序，不想引发一场宗教战争）多态性/继承，如果您接受接口提供这些方面的某些方面的话。如果他在 Excel 中花费大量时间，那么我希望他目前所做的一些重复性的事情可以从录制宏中受益，然后学习清理它。这可能导致编写他自己的工作表函数、循环和各种有用的东西。如果他真的很先进（小测验：他知道将公式放在名称中吗？他对数组公式感到满意吗？）那么他就会对 VBA 可以提供帮助的事情感到恼火。

我想我现在会忽略.Net，它太大了，他需要很长时间才能产生自己的解决方案。

或者，只教他 Ruby。[当我的孩子们从Scratch](http://scratch.mit.edu/)继续前进时，这就是我要开始做的事情。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-10T10:59:03.603

对于刚接触开发并希望掌握基础知识的人来说，VBA 是一个很好的起点。通过利用 Excel 或 Word COM 库，可以通过多种不同的语言对 Excel 进行编程。这可以用 C# 等语言轻松完成，但不适合刚开始编程的人。

只是提醒一下。尽管 VBA 是一种功能齐全的编程语言并且能够支持复杂的应用程序，但它会鼓励不良的编程实践。我已经看到这种情况发生在广泛使用 Excel 进行精算计算的大型组织中。本质上，代码是由精算师编写的，考虑到财务计算——而不是软件工程。

从长远来看，Java 或 C# 等企业编程语言会更好。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-10T10:03:56.680

宏是编写 Excel 的一种方法。查看此 YouTube 视频： http://in.youtube.com/watch?v= [k_fWcffRAG4](http://in.youtube.com/watch?v=k_fWcffRAG4) 它演示了如何录制和使用宏。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-10T10:22:28.873

你可以用 VBA 做很多事情，可能比金融界的人想做的还要多。我相信，VBA 就是为这样的人设计的，但它通常会受到负面报道。我认为，如果你是一名程序员，如果你的男朋友教你的 VBA，他会对编程有所了解，并且还必须提供一个非常有用的工作工具，远远领先于通过录制宏可以实现的任何事情。此外，从 VBA 到 VBScript 只需很短的一步。

# objective-c - 使用超类初始化器初始化一个类

> ID：277478
> 
> 赞同：9
> 
> 时间：2008-11-10T09:59:15.613
> 
> 标签：objective-c, oop, inheritance, initialization

我有两个类，一个是另一个的子类（比如`Animal`and `Dog`）。超类有一些初始化器（比如`initAnimal`），子类有一些初始化器（比如`initDog`）。问题是（从编译器的角度来看）做类似的事情是完全合法的`Dog *adog = [[Dog alloc] initAnimal]`，即。使用它的超类初始化器初始化一个类。我不喜欢这样，因为子类可以有一些我想确保初始化的额外实例变量。查看头文件可以解决这个问题，但是有没有一种简单的方法可以让编译器为我检查？我有一种感觉，我错过了一些非常明显的东西，但我就是不能指望它:-)

*更新：* and`initDog`不是`initAnimal`最好的例子。我的意思是两个真正不同的初始化程序（例如`init`for`Animal`和`initWithFur`for `Dog`）。如果我希望每只狗都分配一些毛发，我会将毛发作为初始化程序的一部分，这样没有人可以在没有毛发的情况下获得狗对象。但是仍然很容易错误地用超类初始化实例`init`，然后我就被淹没了。

感谢 Jason 提出指定的初始化程序。我以前没有想到，但我可以重载超类的指定初始化程序并在那里设置一些合理的默认值。但是，如果我能以某种方式使使用其他初始化程序而不是类本身的初始化程序成为非法，我仍然更愿意——还有更多的想法吗？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-11-10T10:07:10.387

通常在 Objective-C 中，您为每个类创建一个指定的初始化程序，然后子类使用相同的初始化程序。因此，您只需使用 init，而不是使用 initAnimal 和 initDog。然后，狗子类将定义自己的 init 方法并在其父类中调用指定的初始化程序：

```
@implementation Dog
-(id)init
{
    if( (self = [super init]) ) {  // call init in Animal and assign to self
        // do something specific to a dog
    }
    return self;
}
@end 
```

您实际上不必指定 initDog 和 initAnimal，因为该类是在赋值的右侧声明的...

*更新：我将以下内容添加到答案中以反映问题中的其他信息*

有许多方法可以确保子类不调用它们指定的初始化程序以外的初始化程序，并且您最终选择的方式将主要基于您的整个设计。Objective-C 的优点之一是它非常灵活。我将在这里给你两个例子来帮助你入门。

首先，如果您创建的子类具有与其父类不同的指定初始化程序，则可以重载父类的初始化程序并引发异常。这将让程序员立即知道他们违反了您的类的协议......但是，应该说明您应该有一个*很好*的理由这样做，并且应该很好地记录子类可能不会使用与超类相同的初始化程序。

```
@implementation Dog
-(id)init
{
    // Dog does not respond to this initializer
    NSAssert( false, @"Dog classes must use one of the designated initializers; see the documentation for more information." );

    [self autorelease];
    return nil;
}

-(id)initWithFur:(FurOptionsType)furOptions
{
    if( (self = [super init]) ) {
        // do stuff and set up the fur based on the options
    }
    return self;
}
@end 
```

另一种方法是让初始化程序更像您的原始示例。在这种情况下，您可以将父类的默认初始化更改为始终失败。然后，您可以为您的父类创建一个私有初始化程序，然后确保每个人都在子类中调用适当的初始化程序。这种情况显然更复杂：

```
@interface Animal : NSObject
-(id)initAnimal;
@end

@interface Animal ()
-(id)_prvInitAnimal;
@end

@interface Dog : Animal
-(id)initDog;
@end

@implementation Animal
-(id)init
{
    NSAssert( false, @"Objects must call designated initializers; see documentation for details." );

    [self autorelease];
    return nil;
}

-(id)initAnimal
{
    NSAssert( [self isMemberOfClass:[Animal class]], @"Only Animal may call initAnimal" );

    // core animal initialization done in private initializer
    return [self _prvInitAnimal];
}

-(id)_prvInitAnimal
{
    if( (self = [super init]) ) {
        // do standard animal initialization
    }
    return self;
}
@end

@implementation Dog
-(id)initDog
{
    if( (self = [super _prvInitAnimal]) ) {
        // do some dog related stuff
    }
    return self;
}
@end 
```

在这里，您可以看到 Animal 和 Dog 类的接口和实现。Animal 是指定的顶级对象，因此会覆盖 NSObject 的 init 实现。任何在 Animal 或 Animal 的任何子类上调用 init 的人都会收到一个断言错误，将它们引用到文档中。Animal 还在私有类别上定义了私有初始化器。私有类别将保留在您的代码中，Animal 的子类在调用 super 时会调用此私有初始化程序。它的目的是在 Animal 的超类（本例中为 NSObject）上调用 init 并执行任何可能需要的通用初始化。

最后，Animal 的 initAnimal 方法的第一行是一个断言，即接收者实际上是一个 Animal 而不是某个子类。如果接收者不是 Animal，则程序将因断言错误而失败，程序员将参考文档。

这些只是您如何根据特定要求设计某些东西的两个示例。但是，我*强烈*建议您考虑您的设计约束，看看您是否真的需要这种类型的设计，因为它在 Cocoa 和大多数 OO 设计框架中是非标准的。例如，您可以考虑制作各种动物的根级对象，而只使用一个 Animal 协议，要求所有各种“动物”都响应某些动物通用消息。这样，每个动物（以及 Animal 的真正子类）都可以自己处理它们指定的初始化程序，而不必依赖以这种特定、非标准方式表现的超类。

# lisp - 如何让 Ltk 显示用户正在编写的内容以及函数打印的内容？

> ID：277480
> 
> 赞同：1
> 
> 时间：2008-11-10T10:00:08.700
> 
> 标签：lisp, common-lisp, tcl, tk, ltk

函数类型如下：

```
(defun display-all ()
  "Display all items in the database."
  (dolist (item *database*)
    (format t "~{~a:~10t~a~%~}~%" item)))

(defun prompt-read (prompt)
  (format *query-io* "~a: " prompt)
  (force-output *query-io*)
  (read-line *query-io*))

(defun prompt-for-item ()
  (make-database
   (prompt-read "Name")
   (prompt-read "Price"))) 
```

我已阅读 Ltk 文档，但似乎没有任何文本小部件使​​用示例。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-10T20:19:43.957

您像其他所有小部件一样创建文本小部件。Lisp 端对象具有`text`带有 writer 方法的访问器函数，该方法在 Tk 端设置文本。最小的例子：

```
(with-ltk ()
  (let* ((text-widget (make-instance 'text :width 15 :height 2))
         (b1 (make-instance 'button
                            :text "Print"
                            :command #'(lambda () (princ (text text-widget)))))
         (b2 (make-instance 'button :text "Reset"
                            :command #'(lambda () (setf (text text-widget) "reset")))))
    (pack text-widget)
    (pack b1)
    (pack b2))) 
```

# c++ - 如何在启用 ANSI 的同时在 gcc 中启用 C++ 样式的注释？

> ID：277482
> 
> 赞同：19
> 
> 时间：2008-11-10T10:00:34.910
> 
> 标签：c++, c, gcc, comments

这是我在哪里工作的一个问题，所以我做了一点挖掘，答案是 ExpertsExchange 一个。所以我把你交给最初的提问者，Manchung：

> 我有一个用纯 C 语言编写的项目，用于嵌入式系统。所以，我使用纯 C 来最小化代码大小。
> 
> 当我编译项目时，我使用 -ansi 标志来确保代码符合 ANSI 标准。然而，使用这个 ansi 标志的缺点是我只能使用 C 风格的注释 (/*comments */)。当我需要使用嵌套注释时，这让我很头疼。
> 
> 所以，我的问题是：我可以使用哪些开关/标志来允许我使用 C++ 样式的注释（// 注释），同时保持启用 ANSI 检查？

这也几乎总结了我的问题。

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2008-11-10T10:31:44.470

在最近的 gcc 版本中，`-ansi`记录为与`-std=c89`. 新的注释语法仅适用于 C99 标准，因此`-std=c99`允许。

还有`-std=gnu89`, 它与所有 gcc 扩展相同，`-std=c89`但允许所有 gcc 扩展（包括 C++ 样式的注释语法，早在它被添加到标准之前，它就是一个 GNU 扩展）。

还要查看`-pedantic`标志，它可以为您提供一些有用的警告。

参考：

*   [http://gcc.gnu.org/onlinedocs/gcc/C-Dialect-Options.html](http://gcc.gnu.org/onlinedocs/gcc/C-Dialect-Options.html)
*   [http://gcc.gnu.org/onlinedocs/gcc/Warning-Options.html](http://gcc.gnu.org/onlinedocs/gcc/Warning-Options.html)

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2008-11-10T10:36:55.943

如果你想使用 C++ 风格的注释仅仅是因为你想注释掉块，并且对嵌套 /* ... */ 感到头疼，你可以使用这种技术：

```
#if 0
... code ...
#endif 
```

这实际上也可以完成这项工作。

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2008-11-10T10:06:31.993

您可以使用 -lang-c-c++-comments 预处理器来同时拥有 ANSI 模式和 C++ 样式的注释。

```
gcc -Wp,-lang-c-c++-comments -c source.c 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2010-07-22T11:51:23.167

如果您`-ansi`仅用于检查兼容性，那么最简单的方法可能是准备一个脚本或 makefile 目标，将完整的源代码树复制到“ansi”文件夹中，同时修补 // 注释。在伪bash中：

```
SRC=main.c blip.c blip.h
cp makefile ansi-src/
for F in $SRC do
# does not handle // in string literals or /**/ comments!
sed 's/\/\/.*//g' < $F >ansi-src/$F
done
cd ansi-src
make CFLAGS=-ansi 
```

如果您的 SCC 支持它，也可以将其制成一个提交挂钩，该挂钩在每次提交后以 ANSI 模式在专用机器上自动构建代码，并通过邮件向您发送有关它的报告。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-07-26T20:20:16.670

恐怕编写某种评论重写实用程序（正如 Luther Blissett 所建议的那样）可能是您在这里唯一的选择。在现代版本的 gcc 中，似乎没有任何类型的编译器标志或 CLI 选项可以在使用`-ansi`或`-std=c89`使用时启用 C++ 样式的注释。

通过从不同的角度接近它，您可能会得到您想要的东西。您可能能够使用编译器标志进行编译`-std=c99`并使用编译器标志来*禁用*您不想要的特定于 C99 的扩展（在不了解为什么您需要符合 ANSI 的更多信息的情况下，我不能推荐特定标志）。

* * *

## 回答 #6

> 赞同：-2
> 
> 时间：2010-10-11T09:05:21.573

您可以自动构建一个去掉注释的源代码副本，并在您的程序中使用它。

例如[，这](http://bash.cyberciti.biz/academic/sed-remove-c-cpp-comments/)看起来很有希望

* * *

## 回答 #7

> 赞同：-7
> 
> 时间：2008-11-10T10:04:47.177

C 已经有近十年的 C++ 风格的注释了，也许你应该升级一下？

# string - 如何在 Perl 中重复 N 次字符串？

> ID：277485
> 
> 赞同：64
> 
> 时间：2008-11-10T10:01:24.377
> 
> 标签：string, perl, operators, repeat

在 Python 中，如果我这样做：

```
print "4" * 4 
```

我明白了

```
> "4444" 
```

在 Perl 中，我会得到

```
> 16 
```

有没有一种简单的方法可以在 Perl 中完成前者？

* * *

## 回答 #1

> 赞同：103
> 
> 时间：2008-11-10T10:02:56.743

```
$ perl -e 'print "4" x 4; print "\n"'
4444 
```

x 运算符记录在 perldoc [perlop](http://perldoc.perl.org/perlop.html)中。顺便说一下，这里的二进制意味着一个运算符采用两个参数，而不是由位组成。

> 二进制“x”是重复运算符。在标量上下文中，或者如果左操作数没有括在括号中，则它返回一个字符串，该字符串由左操作数重复右操作数指定的次数组成。在列表上下文中，如果左操作数用括号括起来或者是由“ `qw/STRING/`”组成的列表，则重复该列表。如果右操作数为零或负数，则根据上下文返回空字符串或空列表。

```
 print '-' x 80;             # Print row of dashes

       print "\t" x ($tab/8), ' ' x ($tab%8);      # Tab over

       @ones = (1) x 80;           # A list of 80 1’s
       @ones = (5) x @ones;        # Set all elements to 5 
```

`perl -e`旨在从命令行执行 Perl 代码：

```
$ perl --帮助
用法：perl [switches] [--] [programfile] [arguments]

  -e 编写一行程序（允许几个-e，省略程序文件）

```

* * *

## 回答 #2

> 赞同：44
> 
> 时间：2008-11-10T11:28:02.593

在 Perl 中，您想使用“x”运算符。

注意之间的区别

```
"4" x 4 
```

和

```
("4") x 4 
```

前者产生一个重复的字符串：

```
"4444" 
```

后者是一个重复的列表：

```
("4", "4", "4", "4") 
```

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2008-11-10T10:05:15.867

在 Perl 中非常相似

```
print "4" x 4; 
```

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2008-11-10T13:17:09.723

FWIW，它也在`print 4 x 4`Perl 中。

通常，在 Perl 中，运算符是单态的，即。对于字符串语义、数字语义、按位语义等，您有不同的运算符集，这很有意义，并且操作数的类型在很大程度上无关紧要。当您将数字运算符应用于字符串时，首先将字符串转换为数字并获得您要求的运算（例如乘法），当您将字符串运算符应用于数字时，它会变成字符串并且您获得您要求的操作（例如重复）。Perl 首先关注操作符，其次才是操作数的类型——如果它确实让他们注意的话。

这与 Python 和大多数其他语言相反，在这些语言中，您使用一组运算符，并且操作数的类型决定了您将实际获得哪些语义——即。运算符是多态的。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2015-05-07T12:19:36.407

到目前为止给出的所有答案都没有提到该运算符`x`不仅适用于字符串*文字*，而且适用于作为字符串的变量或*评估**为*字符串的表达式，例如

 *```
use feature 'say';

my $msg = "hello ";
say $msg x 2;
say chr(33) x 3; 
```

像这样

```
hello hello
!!! 
```

而且，**更重要**的是，如果表达式`x`还没有**自动转换**为字符串（感谢[ggorlen](https://stackoverflow.com/posts/30100928/timeline#comment_125504067)将我指向那个方向！）。所以例如

```
say 4 x 2;
say [$msg] x 2; 
```

将导致类似以下内容的输出

```
44
ARRAY(0x30ca10)ARRAY(0x30ca10) 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2017-06-26T09:21:25.997

如果要打印 10 个字符“A”，也可以这样做

```
perl -e 'print "A" x 10'; echo 
```

输出示例

```
user@linux:~$ perl -e 'print "A" x 10'; echo
AAAAAAAAAA
user@linux:~$ 
```

# java - html 到 jsp 电子邮件表单发布 - 空参数

> ID：277491
> 
> 赞同：0
> 
> 时间：2008-11-10T10:03:35.573
> 
> 标签：java, html, email, forms, post

我有一个简单的表格

表单动作="email.jsp" 方法="post"

```
 <label for="firstname">Your Name: </label>
              input type="text" id="name"<br/>
        <label for="email">Your Email: </label>
              input type="text" id="address"<br/>
    <label for="message">Message: </label>
              textarea size="30" rows="4" class="expand" id="comments"</textarea<br/>
        input type="submit" value="Send" input type="reset" 
```

/形式

并发布到在 tomcat 5.5 中运行的 email.jsp 页面，为我使用的另一个网站工作，该网站在 flash 中

每次我向其发布数据时，此 email.jsp 都会提供空值 - 代码如下

谁能看到我做错了什么？

```
<%@ page import="sun.net.smtp.SmtpClient, java.io.*, javax.servlet.http.HttpServletResponse, javax.servlet.jsp.PageContext" %>
<%
 String name = request.getParameter("name"); 
 out.print(name);
 String address = request.getParameter("address");
 String comments = request.getParameter("comments");
 String from="test@there.com.au";
 String to="test@where.com";
 try{
     SmtpClient client = new SmtpClient("localhost");
     client.from(from);
     client.to(to);
     PrintStream message = client.startMessage();
     message.println("From: " + from);
     message.println("To: " + to);
     message.println();
     message.println("Enquiry :-) from " + name + " at " + address);
     message.println();     
     message.println("Details: "+ comments);
     client.closeServer();
  }
  catch (IOException e){    
     System.out.println("ERROR SENDING EMAIL:"+e);
  }
out.print("Email Sent Correctly");
%> 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-10T10:21:48.017

您的 HTML 有点乱码，但看起来您没有为输入指定“名称”属性。“id”属性适用于从 <label> 引用您的字段或从 Javascript 访问您的输入，但浏览器不会在 POST 请求中使用它。

解决方案很简单，将“name”属性添加到您的输入元素，如下所示：

```
<input type="text" id="name" name="name" /> 
```

# c# - 避免在字符串的开头和结尾输入双引号

> ID：277492
> 
> 赞同：1
> 
> 时间：2008-11-10T10:03:43.810
> 
> 标签：c#, sql, syntax

在数据库中，我有一个包含“默认”的字符串。我只想用 0 替换该默认值。我有类似的东西：

```
select * from tblname where test = 'default' 
```

我不想用引号代替“默认”。

我想

```
select * from tblname where test = 0 
```

有什么办法吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-10T10:12:32.170

我假设该字段`test`是文本类型（varchar、char 等）。

首先：更新表以包含“0”，其中包含“默认”。

```
UPDATE tblname SET test = '0' WHERE test = 'default' 
```

然后：选择其中包含“0”的所有行。您不能省略引号，因为它们是 SQL 语法的一部分。

```
SELECT * FROM tblname WHERE test = '0' 
```

为了能够省略引号，您必须将字段转换为数字字段（int、float 等）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-10T10:10:11.723

我认为你会更好地使用格式字符串

```
string myVar = "0";
string sql = String.Format(@"select * from tblname where test = \"{0}\"", myVar); 
```

您还应该问自己为什么要动态生成内联 SQL 而不是使用存储过程，因为除非您清理输入，否则 SQL 注入攻击可能会发生。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-10T10:25:23.173

为了实现简单的字符串替换，您可以做很多事情；但是，我强烈建议您研究参数化，以提供注入安全性和查询计划重用。

参数也可以通过避免引用问题而受益 - 所以只需替换`'default'`为（例如）`@p1`你就可以排序了。此替换可以是：

```
-- TSQL
REPLACE(@cmd, '''default''', '@p1') 
```

或者

```
// C#
.Replace(@"'default'", @"@p1") 
```

在 C# 中，这将`DbCommand`带有参数；从 T-SQL 你可能会考虑`sp_ExecuteSQL`. 无论哪种方式，您都希望最终得到：

```
select * from tblname where test = @p1 
```

并提供@p1 作为参数。所以从 C# 开始：

```
DbParameter param = cmd.CreateParameter();
param.Value = 0; // etc
cmd.Parameters.Add(param); 
```

或者来自 TSQL：

```
EXEC sp_ExecuteSQL @cmd, N'@p1 varchar(50)', 0 
```

（替换`varchar(50)`为正确的类型）

# java - Spring @Autowireing，如何使用对象工厂来选择实现？

> ID：277494
> 
> 赞同：0
> 
> 时间：2008-11-10T10:04:00.503
> 
> 标签：java, spring

我试图让一段运行时状态决定使用哪个接口实现，最好仅通过自动装配。

我已经尝试为使用动态代理的接口创建一个对象工厂，并且我使用限定符来强制@Autowired 注入使用工厂。限定符是必要的，因为工厂和实现都响应相同的接口。

问题是我最终用@Qualifier 注释了每个@Autowired 引用。我真正想做的是用@NotCandidateForAutowiringByInterface（我的幻想注释）之类的东西来注释非工厂实现，或者更好地让spring在注入到非限定字段时更喜欢单个非限定bean

我可能会在这里完全错误地思考，所以欢迎提出其他建议。有谁知道如何做到这一点？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-10T10:57:45.060

我自己还没有看过这个，但我注意到[Spring JavaConfig](http://www.springsource.org/javaconfig)被做成了 M4，它似乎允许通过注释和 Java 代码的组合进行更灵活的配置。我想知道它是否会为您的问题提供解决方案。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-11T19:30:42.073

您可以使用 @Resource 并指定工厂的 bean 名称。

# java - JAXB：如何在解组 XML 文档期间忽略命名空间？

> ID：277502
> 
> 赞同：72
> 
> 时间：2008-11-10T10:09:04.220
> 
> 标签：java, xml, xml-serialization, jaxb

我的架构指定了一个命名空间，但文档没有。在 JAXB 解组（XML -> 对象）期间忽略命名空间的最简单方法是什么？

换句话说，我有

```
<foo><bar></bar></foo> 
```

代替，

```
<foo xmlns="http://tempuri.org/"><bar></bar></foo> 
```

* * *

## 回答 #1

> 赞同：106
> 
> 时间：2010-01-27T16:26:41.830

Here is an extension/edit of VonCs solution just in case someone doesn´t want to go through the hassle of implementing their own filter to do this. It also shows how to output a JAXB element without the namespace present. This is all accomplished using a SAX Filter.

Filter implementation:

```
import org.xml.sax.Attributes;
import org.xml.sax.SAXException;

import org.xml.sax.helpers.XMLFilterImpl;

public class NamespaceFilter extends XMLFilterImpl {

    private String usedNamespaceUri;
    private boolean addNamespace;

    //State variable
    private boolean addedNamespace = false;

    public NamespaceFilter(String namespaceUri,
            boolean addNamespace) {
        super();

        if (addNamespace)
            this.usedNamespaceUri = namespaceUri;
        else 
            this.usedNamespaceUri = "";
        this.addNamespace = addNamespace;
    }

    @Override
    public void startDocument() throws SAXException {
        super.startDocument();
        if (addNamespace) {
            startControlledPrefixMapping();
        }
    }

    @Override
    public void startElement(String arg0, String arg1, String arg2,
            Attributes arg3) throws SAXException {

        super.startElement(this.usedNamespaceUri, arg1, arg2, arg3);
    }

    @Override
    public void endElement(String arg0, String arg1, String arg2)
            throws SAXException {

        super.endElement(this.usedNamespaceUri, arg1, arg2);
    }

    @Override
    public void startPrefixMapping(String prefix, String url)
            throws SAXException {

        if (addNamespace) {
            this.startControlledPrefixMapping();
        } else {
            //Remove the namespace, i.e. don´t call startPrefixMapping for parent!
        }

    }

    private void startControlledPrefixMapping() throws SAXException {

        if (this.addNamespace && !this.addedNamespace) {
            //We should add namespace since it is set and has not yet been done.
            super.startPrefixMapping("", this.usedNamespaceUri);

            //Make sure we dont do it twice
            this.addedNamespace = true;
        }
    }

} 
```

This filter is designed to both be able to add the namespace if it is not present:

```
new NamespaceFilter("http://www.example.com/namespaceurl", true); 
```

and to remove any present namespace:

```
new NamespaceFilter(null, false); 
```

The filter can be used during parsing as follows:

```
//Prepare JAXB objects
JAXBContext jc = JAXBContext.newInstance("jaxb.package");
Unmarshaller u = jc.createUnmarshaller();

//Create an XMLReader to use with our filter
XMLReader reader = XMLReaderFactory.createXMLReader();

//Create the filter (to add namespace) and set the xmlReader as its parent.
NamespaceFilter inFilter = new NamespaceFilter("http://www.example.com/namespaceurl", true);
inFilter.setParent(reader);

//Prepare the input, in this case a java.io.File (output)
InputSource is = new InputSource(new FileInputStream(output));

//Create a SAXSource specifying the filter
SAXSource source = new SAXSource(inFilter, is);

//Do unmarshalling
Object myJaxbObject = u.unmarshal(source); 
```

To use this filter to output XML from a JAXB object, have a look at the code below.

```
//Prepare JAXB objects
JAXBContext jc = JAXBContext.newInstance("jaxb.package");
Marshaller m = jc.createMarshaller();

//Define an output file
File output = new File("test.xml");

//Create a filter that will remove the xmlns attribute      
NamespaceFilter outFilter = new NamespaceFilter(null, false);

//Do some formatting, this is obviously optional and may effect performance
OutputFormat format = new OutputFormat();
format.setIndent(true);
format.setNewlines(true);

//Create a new org.dom4j.io.XMLWriter that will serve as the 
//ContentHandler for our filter.
XMLWriter writer = new XMLWriter(new FileOutputStream(output), format);

//Attach the writer to the filter       
outFilter.setContentHandler(writer);

//Tell JAXB to marshall to the filter which in turn will call the writer
m.marshal(myJaxbObject, outFilter); 
```

This will hopefully help someone since I spent a day doing this and almost gave up twice ;)

* * *

## 回答 #2

> 赞同：36
> 
> 时间：2014-06-24T12:49:57.463

I have encoding problems with XMLFilter solution, so I made XMLStreamReader to ignore namespaces:

```
class XMLReaderWithoutNamespace extends StreamReaderDelegate {
    public XMLReaderWithoutNamespace(XMLStreamReader reader) {
      super(reader);
    }
    @Override
    public String getAttributeNamespace(int arg0) {
      return "";
    }
    @Override
    public String getNamespaceURI() {
      return "";
    }
}

InputStream is = new FileInputStream(name);
XMLStreamReader xsr = XMLInputFactory.newFactory().createXMLStreamReader(is);
XMLReaderWithoutNamespace xr = new XMLReaderWithoutNamespace(xsr);
Unmarshaller um = jc.createUnmarshaller();
Object res = um.unmarshal(xr); 
```

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2008-11-10T10:14:37.703

我相信您必须[将名称空间添加](https://download.oracle.com/javaee-archive/jaxb.java.net/users/2008/05/7860.html)到您的 xml 文档中，例如，使用[SAX 过滤器](https://web.archive.org/web/20090113211510/http://www.digitalkarate.net/?p=63)。

这意味着：

*   使用一个新类定义一个 ContentHandler 接口，该类将在 JAXB 获取 SAX 事件之前拦截它们。
*   定义一个 XMLReader，它将设置内容处理程序

然后将两者链接在一起：

```
public static Object unmarshallWithFilter(Unmarshaller unmarshaller,
java.io.File source) throws FileNotFoundException, JAXBException 
{
    FileReader fr = null;
    try {
        fr = new FileReader(source);
        XMLReader reader = new NamespaceFilterXMLReader();
        InputSource is = new InputSource(fr);
        SAXSource ss = new SAXSource(reader, is);
        return unmarshaller.unmarshal(ss);
    } catch (SAXException e) {
        //not technically a jaxb exception, but close enough
        throw new JAXBException(e);
    } catch (ParserConfigurationException e) {
        //not technically a jaxb exception, but close enough
        throw new JAXBException(e);
    } finally {
        FileUtil.close(fr); //replace with this some safe close method you have
    }
} 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2012-12-07T11:23:43.727

In my situation, I have many namespaces and after some debug I find another solution just changing the NamespaceFitler class. For my situation (just unmarshall) this work fine.

```
 import javax.xml.namespace.QName;
 import org.xml.sax.Attributes;
 import org.xml.sax.ContentHandler;
 import org.xml.sax.SAXException;
 import org.xml.sax.helpers.XMLFilterImpl;
 import com.sun.xml.bind.v2.runtime.unmarshaller.SAXConnector;

 public class NamespaceFilter extends XMLFilterImpl {
    private SAXConnector saxConnector;

    @Override
    public void startElement(String uri, String localName, String qName, Attributes atts) throws SAXException {
        if(saxConnector != null) {
            Collection<QName> expected = saxConnector.getContext().getCurrentExpectedElements();
            for(QName expectedQname : expected) {
                if(localName.equals(expectedQname.getLocalPart())) {
                    super.startElement(expectedQname.getNamespaceURI(), localName, qName, atts);
                    return;
                }
            }
        }
        super.startElement(uri, localName, qName, atts);
    }

    @Override
    public void setContentHandler(ContentHandler handler) {
        super.setContentHandler(handler);
        if(handler instanceof SAXConnector) {
            saxConnector = (SAXConnector) handler;
        }
    }
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-28T16:14:06.173

在将 XML 文档提供给 JAXB 之前向其添加默认名称空间的另一种方法是使用[JDom](http://jdom.org)：

1.  将 XML 解析为文档
2.  遍历所有元素并设置命名空间
3.  Unmarshall using a JDOMSource

Like this:

```
public class XMLObjectFactory {
    private static Namespace DEFAULT_NS = Namespace.getNamespace("http://tempuri.org/");

    public static Object createObject(InputStream in) {
        try {
            SAXBuilder sb = new SAXBuilder(false);
            Document doc = sb.build(in);
            setNamespace(doc.getRootElement(), DEFAULT_NS, true);
            Source src = new JDOMSource(doc);
            JAXBContext context = JAXBContext.newInstance("org.tempuri");
            Unmarshaller unmarshaller = context.createUnmarshaller();
            JAXBElement root = unmarshaller.unmarshal(src);
            return root.getValue();
        } catch (Exception e) {
            throw new RuntimeException("Failed to create Object", e);
        }
    }

    private static void setNamespace(Element elem, Namespace ns, boolean recurse) {
        elem.setNamespace(ns);
        if (recurse) {
            for (Object o : elem.getChildren()) {
                setNamespace((Element) o, ns, recurse);
            }
        }
    } 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2020-10-20T08:36:16.750

This is just a modification of lunicon's answer ([https://stackoverflow.com/a/24387115/3519572](https://stackoverflow.com/a/24387115/3519572)) if you want to replace one namespace for another during parsing. And if you want to see what exactly is going on, just uncomment the output lines and set a breakpoint.

```
public class XMLReaderWithNamespaceCorrection extends StreamReaderDelegate {

    private final String wrongNamespace;
    private final String correctNamespace;

    public XMLReaderWithNamespaceCorrection(XMLStreamReader reader, String wrongNamespace, String correctNamespace) {
        super(reader);

        this.wrongNamespace = wrongNamespace;
        this.correctNamespace = correctNamespace;
    }

    @Override
    public String getAttributeNamespace(int arg0) {
//        System.out.println("--------------------------\n");
//        System.out.println("arg0: " + arg0);
//        System.out.println("getAttributeName: " + getAttributeName(arg0));
//        System.out.println("super.getAttributeNamespace: " + super.getAttributeNamespace(arg0));
//        System.out.println("getAttributeLocalName: " + getAttributeLocalName(arg0));
//        System.out.println("getAttributeType: " + getAttributeType(arg0));
//        System.out.println("getAttributeValue: " + getAttributeValue(arg0));
//        System.out.println("getAttributeValue(correctNamespace, LN):"
//                + getAttributeValue(correctNamespace, getAttributeLocalName(arg0)));
//        System.out.println("getAttributeValue(wrongNamespace, LN):"
//                + getAttributeValue(wrongNamespace, getAttributeLocalName(arg0)));

        String origNamespace = super.getAttributeNamespace(arg0);

        boolean replace = (((wrongNamespace == null) && (origNamespace == null))
                || ((wrongNamespace != null) && wrongNamespace.equals(origNamespace)));
        return replace ? correctNamespace : origNamespace;
    }

    @Override
    public String getNamespaceURI() {
//        System.out.println("getNamespaceCount(): " + getNamespaceCount());
//        for (int i = 0; i < getNamespaceCount(); i++) {
//            System.out.println(i + ": " + getNamespacePrefix(i));
//        }
//
//        System.out.println("super.getNamespaceURI: " + super.getNamespaceURI());

        String origNamespace = super.getNamespaceURI();

        boolean replace = (((wrongNamespace == null) && (origNamespace == null))
                || ((wrongNamespace != null) && wrongNamespace.equals(origNamespace)));
        return replace ? correctNamespace : origNamespace;
    }
} 
```

usage:

```
InputStream is = new FileInputStream(xmlFile);
XMLStreamReader xsr = XMLInputFactory.newFactory().createXMLStreamReader(is);
XMLReaderWithNamespaceCorrection xr =
    new XMLReaderWithNamespaceCorrection(xsr, "http://wrong.namespace.uri", "http://correct.namespace.uri");
rootJaxbElem = (JAXBElement<SqgRootType>) um.unmarshal(xr);
handleSchemaError(rootJaxbElem, pmRes); 
```

# pdc2008 - 我需要观看的最佳 PDC 2008 视频有哪些？

> ID：277510
> 
> 赞同：2
> 
> 时间：2008-11-10T10:13:56.177
> 
> 标签：pdc2008, pdc

[考虑到此处](http://channel9.msdn.com/posts/pdc2008/RSS/Default.aspx)发布的 PDC 视频的完整列表，考虑到它们与您的工作、技术等的相关性，您认为下载和观看的最佳会议是什么？恳求，每个答案一个会话（仅对分为两部分的会话例外），请投票以便将最好的移到顶部。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-10T10:18:37.430

我不得不说我最喜欢的会议是“C# 的未来”视频，非常高兴能够看到 C# 和 .NET 框架的未来。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-10T12:23:12.093

斯科特·汉塞尔曼斯

**Microsoft .NET Framework：婴儿概述和应用程序** [http://channel9.msdn.com/pdc2008/TL49/](http://channel9.msdn.com/pdc2008/TL49/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-10T10:14:55.347

对我来说，最好的会议是[Mono](http://channel9.msdn.com/pdc2008/PC54/)会议，非常值得一看。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-10T10:57:40.380

我真的很喜欢看[A Lap Around VSTS 2010](http://channel9.msdn.com/pdc2008/TL47/)。但[C# IDE 提示和技巧](http://channel9.msdn.com/pdc2008/TL46/)会议是我迄今为止看过的最喜欢的会议。我展示了许多简单的捷径和工具，让您的日常生活更轻松。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-10T11:43:12.440

我认为我最喜欢的是并行编程

并行编程 [http://channel9.msdn.com/pdc2008/TL26/](http://channel9.msdn.com/pdc2008/TL26/)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-10T12:07:10.753

我可以推荐关于“速度”的那些。当我在那里时，我发现它们非常有趣，但如果您对此不感兴趣，您还应该查看针对并行性的那些。

**速度会话：** [http ://channel9.msdn.com/tags/pdc2008.velocity/](http://channel9.msdn.com/tags/pdc2008.velocity/)

**并行会话：** [http ://channel9.msdn.com/tags/pdc2008.parallelism/](http://channel9.msdn.com/tags/pdc2008.parallelism/)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-10T14:00:32.053

如果你在做线程并行工作：TL58 Research: Concurrency Analysis Platform and Tools for Finding Concurrency Bugs and TL55 The Concurrency and Coordination Runtime and Decentralized Software Services Toolkit

最后朝着并发程序的确定性测试和调试进展。

# delphi - Delphi：您如何自动更新您的应用程序？

> ID：277514
> 
> 赞同：41
> 
> 时间：2008-11-10T10:15:58.310
> 
> 标签：delphi, auto-update

我一直在考虑滚动我自己的代码以使我的 Delphi 应用程序能够无缝更新，因为我将进一步追求“经常发布，尽早发布”的心态。那里有各种 Delphi 解决方案（免费软件和付费软件），我想问一下您是否一直在使用其中的任何一个，或者只是继续在该领域使用您自己的解决方案。欢迎对自动更新主题发表任何评论。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-11-10T15:02:15.690

无论您使用什么方案，知道您实际上可以重命名正在运行的 .exe 文件可能会很方便。所以重命名文件，复制新文件效果很好。下次有人启动该程序时，他们将启动新版本。这在许多用户运行相同的 .exe 文件的环境中当然非常方便，例如在 citrix/终端服务器/网络共享案例中。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-11-10T12:52:37.463

几年前，我写了一个简单的工具，它启动而不是真正的程序，检查更新、加载和安装它们（如果有的话），最后启动真正的应用程序。

但是，如果您的程序在适当管理的环境中工作，那么这种方法就会出现问题，在这种环境中，用户通常没有对程序目录的写访问权。您不能再在这样的环境中简单地更新您自己的程序。这就是为什么现在很多程序都带有自己的更新工具，可以安装它以使用提升的权限运行，这样即使只有标准用户登录系统，也可以应用程序更新。

您必须决定是否可以假定您的目标受众在高级用户或管理员帐户上运行，或者您是否必须处理上述问题。有了 Vista，事情已经变得相当困难了。

面对所有这些问题（通过代理进行网络访问、缺少安装目录的写入权限、需要更新更新程序本身正在使用的文件——仅举几例），我不会再尝试自己编写代码了。更好地检查是否有任何一种可用的解决方案可以满足您的所有需求。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-11-10T13:48:38.363

我使用[Synapse](http://synapse.ararat.cz/doku.php/download)例程 GetHTTP 返回特定资源，如果找到，则检查本地系统以查看是否需要更新。如果是这样，那么资源会告诉我要启动哪个页面，然后我将 URL 放入 shell 执行中，以便显示用户首选的浏览器。

大多数情况下，下载是由 InnoSetup 创建的安装程序，它将用户系统和数据库更新到最新版本。当需要新的“付费”升级时，我会将用户发送到“购买升级”表单。我的 Web 资源是 ASP 页面，因此我可以根据客户的版本号重定向到不同的资源。

对于主应用程序（我们的应用程序有一个服务器部分和一个客户端部分），我有一个加载器，它将检查服务器以查看服务器上客户端文件的版本是否与客户端上的版本不同......如果因此，如果用户想要更新/恢复，它会提示用户。我们选择提示用户，因为有时意外错误可能会进入系统，用户必须仅降级/升级特定机器以帮助排除故障。我维护了一个最低版本的数据库记录，该版本通过数据库补丁更新，因此如果必须停用某个版本，则相应地更新记录。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-11-10T12:04:53.160

我也基于 Indy 创建了自己的解决方案，用于下载和[http://sourceforge.net/projects/makeupdate/](http://sourceforge.net/projects/makeupdate/)用于文件修补。在此之前，我使用并尝试了几种商业工具，但没有人能完全满足我的需求。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-11-17T10:30:02.047

我使用[TmxWebUpdate](http://www.torry.net/authorsmore.php?id=3079)。它是免费的、简单的，让您可以很好地控制整个过程。我实际上拥有带有 TWebUpdate 的 TMS 组件包，但从未真正找到切换的好理由。

编辑：链接已更新

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2009-09-23T21:46:19.927

我们也推出了自己的产品。它真的不是太难。

我们的过程是这样的：

*   当主应用程序启动时，它会检查（使用突触库中的函数）是否有可用的更新（当然，假设它被配置为检查）。

*   如果是这样，它会通知用户并询问他们是否要更新。

*   如果他们这样做，它会启动一个更新程序 .exe，并关闭主应用程序。

*   更新程序 exe 根据它检索到的文本文件的内容下载新文件，并将文件保存*在内存中*。

*   当更新程序正确下载所有内容后，它将下载的文件保存到磁盘，备份它替换的所有文件。这样，如果下载中断，您最终不会安装一半的文件。

*   最后，它再次启动主应用程序，然后自行关闭。

Vista 的诀窍是您需要在更新程序的清单中有一个条目，以强制它以管理员权限运行。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-11-10T10:20:35.883

通常我们使用第三方工具。但在某些情况下它不可用，所以我创建了一个自己的解决方案，这是非常标准的：

*   获取带有更新信息的 xml（或任何其他格式）。
*   如果发布了较新的文件，请下载并安装它们。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2008-11-10T15:31:37.080

我使用[TWebUpdate](http://www.tmssoftware.com/site/wupdate.asp)。它工作正常并且有很多有趣的选项，但文档不是很好，我确实遇到了一些问题 - 这就是为什么我下载完整的安装程序，而不仅仅是文件......

我会密切关注这个问题，顺便说一句...

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2010-08-14T07:51:06.213

我们使用我们自己的解决方案，遵循以下步骤：

1.  应用程序连接到 http 资源并将信息文件（ini 文本文件）下载到内存，检查最新版本的版本号。
2.  如果有更新的版本可用，应用程序会将压缩的二进制包下载到 exe 位置。
3.  下载完成后，要求用户重新启动应用程序。
4.  启动时，应用程序检查是否存在更新包
5.  应用程序提取包内容（通常是一个新的应用程序 exe，但也可能有其他资源，例如更新的语言文件等） - 对于每个文件，它首先将当前/旧文件重命名为临时名称，然后提取新文件。如果该过程在任何时候失败，则将恢复临时文件。
6.  完成后，应用程序执行新的 exe 并自行关闭。

无需额外的更新程序，应用程序 exe 可以自行处理。

对于压缩包，我们使用我们自己的更新生成器。该包包含一个文件索引，其中包含文件哈希、目标文件夹（主 exe 的相对路径）和压缩文件。在更新期间，我们将存储的哈希与提取的文件进行比较以检测损坏的文件。

在 Vista 中，我看到了两种解决方案，可以让标准用户帐户真正更新应用程序文件：

1.  配置您的设置以更改程序安装目录的权限。这样，可以在具有有限权限的帐户上修改“C:\Program Files (x86)\Your Company\You App”中的文件。

    InnoSetup 的示例代码为：

    ```
    [Dirs]
    Name: "{app}"; Permissions: users-modify 
    ```

2.  将您计划更新的文件安装到 ProgramData 文件夹而不是用户定义的目录，并将此目录用作覆盖文件夹。如果 ProgramData 中存在文件，请使用这些文件，否则请检查安装目录。

    InnoSetup 代码：

    ```
    [Files]
    Source: "C:\Your Project\YourApp.exe"; DestDir: "{commonappdata}\Company Name\App Name\"; 
    ```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-11-21T12:09:27.993

与“stg”和“GuyWithDogs”相同，我使用的是 TMS 的 TWebUpdate。虽然文档不是很好，但学习起来并不难。

使用 TWebUpdate，您可以选择使用什么协议，可以通过 HTTP、FTP 或网络访问来完成。

对于通信层，TWebUpdate 使用 WinInet。在某些机器中，windows / IE URL 缓存可能令人沮丧，因此我添加了一个例程，首先从缓存中清除自动更新服务器地址，以确保从服务器收集的信息是最新的。

# c++ - 如何将文件内容识别为 ASCII 或二进制

> ID：277521
> 
> 赞同：29
> 
> 时间：2008-11-10T10:20:21.797
> 
> 标签：c++, ascii, binaryfiles, file-format

您如何使用 C++ 识别文件内容是 ASCII 还是二进制？

* * *

## 回答 #1

> 赞同：55
> 
> 时间：2008-11-10T10:40:43.563

如果文件**仅**包含十进制字节 9–13、32–126，则它可能是纯 ASCII 文本文件。否则，它不是。但是，它可能仍然是另一种编码的文本。

如果**除**上述字节外，文件**仅**包含十进制字节 128–255，则它可能是 8 位或可变长度基于 ASCII 编码的文本文件，例如 ISO-8859-1、UTF-8 或ASCII+Big5。如果不是，出于某些目的，您可能可以在这里停下来并认为该文件是二进制文件。但是，它可能仍然是 16 位或 32 位编码的文本。

如果文件不符合上述约束，请检查文件的前 2-4 个字节是否有[字节顺序标记](http://en.wikipedia.org/wiki/Byte_Order_Mark#Representations_of_byte_order_marks_by_encoding)：

*   如果前两个字节是 hex `FE FF`，则文件**暂定**为UTF-16 BE。
*   如果前两个字节是 hex `FF FE`，而后两个字节**不是**hex `00 00`，则文件**暂定**为UTF-16 LE。
*   如果前四个字节是 hex `00 00 FE FF`，则文件**暂定**为UTF-32 BE。
*   如果前四个字节是 hex `FF FE 00 00`，则文件**暂定**为UTF-32 LE。

如果通过上述检查，您已经确定了一个暂定编码，那么只检查下面的相应编码，以确保该文件不是恰好匹配字节顺序标记的二进制文件。

如果您尚未确定暂定编码，则该文件可能仍然是其中一种编码的文本文件，因为字节顺序标记不是强制性的，因此请检查以下列表中的所有编码：

*   如果文件**只**包含大端双字节字，十进制值为 9–13、32–126 和 128 或更高，则该文件可能是 UTF-16 BE。
*   如果文件**只**包含小端的双字节字，十进制值为 9–13、32–126 和 128 或更高，则该文件可能是 UTF-16 LE。
*   如果文件**只**包含大端四字节字，十进制值为 9–13、32–126 和 128 或更高，则该文件可能是 UTF-32 BE。
*   如果文件**只**包含小端四字节字，十进制值为 9–13、32–126 和 128 或更高，则该文件可能是 UTF-32 LE。

如果在所有这些检查之后，您仍然没有确定编码，则该文件不是我所知道的任何基于 ASCII 编码的文本文件，因此对于大多数目的，您可能会认为它是二进制文件（它可能仍然是非 ASCII 编码的文本文件，例如 EBCDIC，但我怀疑这远远超出了您的关注范围）。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2008-11-10T10:26:04.873

您使用带有 stream.get() 的普通循环遍历它，并检查您读取的字节值是否为`<= 127`. 许多方法中的一种方法：

```
int c;
std::ifstream a("file.txt");
while((c = a.get()) != EOF && c <= 127) 
    ;
if(c == EOF) {
    /* file is all ASCII */
} 
```

但是，正如有人提到的，所有文件毕竟都是二进制文件。此外，不清楚您所说的“ascii”是什么意思。如果你的意思是字符代码，那么这确实是你要走的路。但是，如果您仅指字母数字值，则需要另一种方法。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-11-10T10:54:27.123

我的文本编辑器决定是否存在空字节。实际上，这非常有效：没有空字节的二进制文件极为罕见。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2008-11-10T10:24:56.810

*每一个*的内容*都是二进制的。所以，其他什么都不知道，你无法确定。*

 *ASCII 是一个解释问题。如果你在文本编辑器中打开一个二进制文件，你就会明白我的意思。

大多数二进制文件包含一个固定的标题（每种类型），您可以查找，或者您可以将文件扩展名作为提示。如果您期望 UTF 编码的文件，您可以查找字节顺序标记，但它们也是可选的。

除非您更仔细地定义您的问题，否则不可能有明确的答案。

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2008-11-10T10:43:04.790

看看[文件命令](http://linux.about.com/library/cmd/blcmdl1_file.htm)是如何工作的；它有三种策略来确定文件的类型：

*   文件系统测试
*   [幻数](http://linux.about.com/library/cmd/blcmdl5_magic.htm)测试
*   和语言测试

根据您的平台以及您感兴趣的可能文件，您可以查看它的实现，甚至调用它。

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2008-11-10T11:35:10.257

如果问题真的是如何只检测 ASCII，那么 litb 的答案就是正确的。但是，如果 san 在知道如何确定文件是否包含文本之后，那么问题就会变得更加复杂。ASCII 只是一种 - 越来越不受欢迎 - 表示文本的方式。Unicode 系统 - UTF16、UTF32 和 UTF8 越来越受欢迎。从理论上讲，可以通过检查前两个字节是否为 unicocode 字节顺序标记 (BOM) 0xFEFF（如果字节顺序颠倒，则为 0xFFFE）来轻松测试它们。然而，由于这两个字节搞砸了 Linux 系统的许多文件格式，因此不能保证它们存在。此外，二进制文件可能以 0xFEFF 开头。

如果文件是 unicode，查找 0x00（或其他控制字符）也无济于事。如果文件是 UFT16，并且文件包含英文文本，那么每隔一个字符将是 0x00。

如果您知道将写入文本文件的语言，则可以分析字节并统计确定它是否包含文本。例如，英语中最常见的字母是 E 后跟 T。因此，如果文件包含的 E 和 T 比 Z 和 X 多得多，那么它很可能是文本。当然，有必要将其作为 ASCII 和各种 unicode 进行测试以确保。

如果文件不是用英语编写的——或者你想支持多种语言——那么剩下的只有两个选项是查看 Windows 上的文件扩展名，并根据“魔术文件”代码的数据库检查前四个字节以确定文件的类型，从而确定它是否包含文本。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-10T10:22:59.590

好吧，这取决于您对 ASCII 的定义。您可以检查 ASCII 代码 <128 的值或您定义的某些字符集（例如 'a'-'z'、'A'-'Z'、'0'-'9'...）并处理文件如果它包含一些其他字符，则为二进制。

您还可以检查常规换行符（0x10 或 0x13,0x10）以检测文本文件。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-11-10T10:55:13.770

要检查，您必须将文件作为二进制文件打开。您无法将文件作为文本打开。ASCII 实际上是二进制的子集。之后，您必须检查字节值。ASCII 的字节值是 0-127，但 0-31 是控制字符。TAB、CR 和 LF 是唯一常用的控制字符。你不能（便携式）使用'A'和'Z'；不能保证它们是ASCII（！）。如果你需要它们，你必须定义。

```
const unsigned char ASCII_A = 0x41; // NOT 'A'
const unsigned char ASCII_Z = ASCII_A + 25; 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-11-18T06:06:33.140

这个问题确实没有正确或错误的答案，只是复杂的解决方案不适用于所有可能的文本文件。

这是关于记事本如何检测 ascii 文件类型的[旧新事物文章的链接。](http://blogs.msdn.com/oldnewthing/archive/2007/04/17/2158334.aspx)它并不完美，但看看微软如何处理它很有趣。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2015-03-23T17:25:04.347

[Github 的语言学家](https://rubygems.org/gems/github-linguist)使用[charlock holmes 库](https://github.com/brianmario/charlock_holmes)来检测二进制文件，而二进制文件又使用[ICU](http://site.icu-project.org/)的[charset 检测](http://userguide.icu-project.org/conversion/detection)。

ICU 库可用于许多编程语言，包括 C 和 Java。

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2021-07-30T03:36:47.527

```
bool checkFileASCIIFormat(std::string fileName)
{
    bool ascii = true;
    std::ifstream read(fileName);
    int line;
    while ((ascii) && (!read.eof())) {
        line = read.get();
        if (line > 127) {
            //ASCII codes only go up to 127
            ascii = false;
        }
    }

    return ascii;
} 
```

# visual-studio - 团队系统单元测试和配置

> ID：277524
> 
> 赞同：0
> 
> 时间：2008-11-10T10:21:18.220
> 
> 标签：visual-studio, visual-studio-2008, unit-testing

在 vs team system 2008 单元测试中，如何在测试本身中加载应用程序配置文件？

我在测试项目中有一个 app.config，引用了 System.Configuration 但是在运行测试时，它看不到 app.config

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-10T11:34:16.030

有一个预构建批处理事件，可以从您的应用程序目录复制它。

您可以通过右键单击您的测试项目（或应用程序）并单击属性来添加它。当页面打开时，从菜单中选择“构建事件”并输入您的命令，例如：

xcopy ../app.config ../../Test/bin/app.config

或者自己维护一份副本。

# file - 使用 OpenNETCF.Desktop.Communication.dll 的 RAPI 复制文件

> ID：277529
> 
> 赞同：1
> 
> 时间：2008-11-10T10:22:54.863
> 
> 标签：file, copy, rapi

我目前正在使用 OpenNETCF.Desktop.Communication.dll 将文件从我的桌面复制到 CE 设备，但我不断收到错误消息：

'无法创建远程文件'

我的开发环境是VS2005（VB.NET）

我的代码：

```
ObjRapi.Connect()
ObjRapi.CopyFileToDevice("C:\results.txt", "\results.txt")
ObjRapi.Dispose()
ObjRapi.Disconnect() 
```

有没有人遇到过这个问题，你有没有设法绕过它。

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-10T10:31:31.227

我以前遇到过一次，但我真的不记得是什么原因造成的。

通过查看您的代码，我唯一能想到的是这一行：

```
ObjRapi.CopyFileToDevice("C:\results.txt", "\ \results.txt") 
```

我不确定，但您可以尝试将目标路径更改为不同的路径。像这样的东西：

```
ObjRapi.CopyFileToDevice("C:\results.txt", "\My Documents\results.txt") 
```

我目前无法真正测试它，但我真的不明白为什么它不起作用。

编辑：我刚刚查看了一些使用 RAPI 编写的代码，当我进行任何复制时，我的行看起来像这样：

```
ObjRapi.CopyFileToDevice("C:\results.txt", "\My Documents\results.txt",True) 
```

最后的布尔值是一个覆盖开关，将其设置为 true 可能会起作用。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-24T04:18:50.220

试试这个

将 myrapi 调暗为新 RAPI

```
 If myrapi.DevicePresent = True Then
            myrapi.Connect()

            If myrapi.Connected = True Then
                Windows.Forms.Cursor.Current = Cursors.WaitCursor
                If myrapi.DeviceFileExists("\Backup\stock.txt") Then
                    myrapi.CopyFileFromDevice(Application.StartupPath 

                Windows.Forms.Cursor.Current = Cursors.Default
                MessageBox.Show("File Copied Successfully", "Success", MessageBoxButtons.OK, MessageBoxIcon.Information, MessageBoxDefaultButton.Button1)

            Else
                MessageBox.Show("Please Connect to the Mobile Device", "Connection Failed", MessageBoxButtons.OK, MessageBoxIcon.Information, MessageBoxDefaultButton.Button1)
            End If

        Else
            MessageBox.Show("Please Connect to the Mobile Device", "Connection Failed", MessageBoxButtons.OK, MessageBoxIcon.Information, MessageBoxDefaultButton.Button1)
        End If

    Catch ex As Exception
        MsgBox(ex.Message)
    End Try 
```

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2010-03-23T08:54:03.557

您必须使用以下代码：

```
op.CopyFileToDevice(@"C:\results.txt", @"\Temp\results.txt"); 
```

在您的代码中，您没有提到要复制文件的路径。

希望这会帮助你。

# c# - ASP.NET MVC 中枚举的默认模型绑定？

> ID：277539
> 
> 赞同：0
> 
> 时间：2008-11-10T10:26:18.647
> 
> 标签：c#, asp.net-mvc, html-helper

如何将使用`Html.RadioButton()`HTML 帮助程序生成的单选按钮的值绑定到具有结构作为类型的字段？

不那么抽象：

CommonProject.Services.SearchBag.Effects：

```
public enum Effects
{
    Any,
    Solid,
    Effect
} 
```

在强类型 ViewData 中：

```
public class SearchBag{    
    public Effects EffectIndicator { get; set; }
} 
```

在我看来（这实际上不起作用）：

```
<%=Html.RadioButton("SearchBag.EffectIndicator", "Any", ViewData.Model.SearchBag.EffectIndicatorIsAny, new { @id = "SearchBag.EffectIndicatorAny" })%> 
```

**更新**
它似乎工作一次..
最初它根据需要创建单选按钮，然后当您更改值并回发时，该值被正确绑定。然后在重新生成页面时，按钮的所有值都设置为您之前选择的值。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-11-19T22:49:40.857

如果您的视图是使用 SearchBag 作为您的视图数据类的强类型，那么您应该能够按照以下方式执行一些操作：

```
<%= Html.RadioButtonFor(model => model.EffectIndicator, "Any", new { @id = "SearchBag.EffectIndicatorAny" }) %> 
```

然后，当您的视图表单提交回控制器时，它看起来像：

```
public class MyController : Controller
{
    public ActionResult MyActionMethod(SearchBag searchBag)
    {
        Effects selectedEffect = searchBag.EffectIndicator;
    }
} 
```

这有帮助吗？

# msbuild - .NET Framework 3.5 的 .NET Framework 2.0 SDK 的等效项是什么？

> ID：277540
> 
> 赞同：3
> 
> 时间：2008-11-10T10:27:25.633
> 
> 标签：msbuild, .net-3.5, .net-2.0

在我们的构建服务器上，我们安装了 .NET Framework 2.0 SDK 以启动 MSBuild 并运行我们的构建。现在我们正在升级到 .NET Framework 3.5。我们不想安装完整的 Visual Studio，但在 Internet 上也找不到 .NET Framework 3.5 SDK？

问题：我们需要下载和安装什么来获得等效的 .NET Framework 3.5 SDK 安装？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-10T10:32:10.990

.net 3.5 附带了编译器和与之捆绑的 msbuild。只需下载普通的 .net 3.5 框架（不是客户端配置文件）就可以了。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-10T10:34:16.370

这[是](http://www.microsoft.com/downloads/details.aspx?FamilyId=F26B1AA4-741A-433A-9BE5-FA919850BDBF&displaylang=en)你要找的吗？

编辑：+1 约阿希姆的回答。不知道 MSBuild 是 SDK 的一部分。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-10T10:37:09.843

[适用于 Windows Server 2008 和 .NET Framework 3.5 的 Microsoft Windows SDK](http://www.microsoft.com/downloads/details.aspx?FamilyId=F26B1AA4-741A-433A-9BE5-FA919850BDBF)

实际上，您只需要 SDK 来做一些事情（RDL 报告编译器`.targets`文件让我想起了，因为它最近让我很恼火）。框架本身可以做大部分事情。

# java - 目前，您是否会使用 JBoss 或 Glassfish（或其他）作为新项目的 Java EE 服务器？

> ID：277543
> 
> 赞同：137
> 
> 时间：2008-11-10T10:28:38.877
> 
> 标签：java, jboss, jakarta-ee, glassfish

如果您今天开始了一个新的 Java EE 项目，该项目将在大约一年内完成，您会选择哪个应用程序服务器，为什么？

你的部分答案应该包括你的决定论据。以及您在使用您选择的 Java EE 服务器和市场上其他可用服务器方面的经验。这些很有趣，因为我们都对您的答案中的调查和想法有所了解。

* * *

## 回答 #1

> 赞同：181
> 
> 时间：2008-11-10T20:04:10.137

在过去的 10 多年里，我使用过 WebLogic、WebSphere、JBoss、GlassFish、Resin、Jetty、Tomcat 和其他一些工具。所以，如果我正在考虑一个新项目，我会先问自己几个问题。我不会再质疑的一件事是，除非我受到折磨直到我为妈妈哭泣，否则我会坚决拒绝使用 JSP。

由于某人的授权，我是否必须兼容/部署到特定产品？有没有办法忽略他们或以其他方式说服他们？如果是这样，这就是你的答案。

我必须使用 EJB 吗？真的吗？尽可能避免使用它们——它们实际上只需要非常大的企业级系统。请记住，它们只是工具，而且是大工具（谁能说“金大锤”？）。它们被严重过度使用，所以真的，真的怀疑你是否需要它们。如果您确实需要它们，那么这会删除您的几个选项，包括我最喜欢的 Jetty。

您是否必须使用任何其他主要的 J2EE 技术，如 JMS、ESB 等？如果是这样，而且您真的不能没有，那么您将再次受限于成熟的 J2EE 容器。例如，在您致力于 BPM 之前，请仔细考虑和调查，并（几乎）不惜一切代价避免使用 AquaLogic BPM —— 它非常丑陋。

如果您真的必须使用成熟的 J2EE 容器，请首先考虑开源，因为它更健壮、支持更好且更具成本效益。他们拥有更大的客户群和更开放的支持互动，因此他们倾向于更快地获得更好的修复。但是，Resin 还不成熟，相对于 GlassFish 或 JBoss，我会避免使用它——我发现它在部署和支持方面存在问题。我更喜欢 JBoss，因为它有更广泛的客户群、成熟度等。GlassFish 更难融入自动化构建/部署过程，但它的某些特定功能（如果您需要它们）可能会更好。

我是否有特殊的理由需要 Apache？然后倾向于Tomcat，也许还有一些东西。

我可以只使用 servlet 吗？然后我会使用 Jetty——它是最轻、最快、最简单、最灵活的解决方案。如果我反对能够使用 Jetty，我会质疑我对原因的所有假设。YAGNI 适用。

最好是在 Jetty 上使用 StringTemplate/WebStringTemplate：一个干净、健壮、快速、可维护的解决方案，没有许可费用、良好的声誉和支持等。这就是我现在开始的地方。

大多数应用程序/系统选择了许多花哨的 J2EE 功能，而他们真正需要的是 servlet 和 JDBC 以及一些不错的体系结构/设计。质疑为什么你认为你需要更多。

在成熟的容器中，我会避​​免使用 WebLogic 和 WebSphere，除非你支持一个主要的公共网站（我现在雇主的网站部署在 WebLogic 上，它每月获得 11+ 百万次点击，其他网站具有可比性）。WebLogic 真正声名鹊起的是它们相对容易的集群，但要（几乎）不惜一切代价避免其专有的供应商锁定功能。WebSphere 简直就是一场噩梦，我会不惜一切代价避免——在过去做过几个项目之后，我拒绝做涉及 WebSphere 的项目。这两种产品都不值得支付巨额的许可费用，除非您确实有特殊需求来推动使用专有功能。在作为许多财富 500 强公司的高级架构师/工程师的十年中，我还没有看到这样的需求。另一方面，

即使对于真正庞大、高流量的公共网站，专有产品仍然值得怀疑。我宁愿将每年数百万美元的许可费花在一些好的硬件上，并从少数真正优秀的顾问那里花一些宝贵的时间来解决一个简单的可扩展性解决方案。每年额外的数百万可以用来生产一些值得在那个漂亮的网站上销售的东西......

*编辑：另一件要考虑的...*

我最近遇到了[兵马俑](http://www.terracotta.org/)。我正在重新考虑一切，并希望尽快将其部署到一个重要的系统中。特别是，Terracotta 的集群比其他任何东西都好，所以我不会再推荐 WebLogic 的集群。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-06-29T10:53:17.200

术语“应用程序服务器”是模棱两可的。使用 GlassFish v3，您可以从传统的 Web 容器开始，然后发展（使用 OSGi 和简单的“添加容器”功能）以添加您想要的任何内容：JPA、JAX-RS、EJB、JTA、JMS、ESB等等……但它是相同的产品、相同的管理界面等。这对您来说是否有资格作为应用服务器？-亚历克西斯（太阳）

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-11-10T10:52:22.993

我通常会问自己的第一个问题是“我可以用 Tomcat 做到这一点吗？”。如果答案是否定的，因为我需要 JMS 或 JTA，那么我求助于应用程序服务器。

大约 3 年前，我使用 WebLogic 8，对 WebLogic 的易用性和许可/成本模型感到满意。我们将它用于两个项目，一个是 Web 服务，另一个是门户。在这两个项目中，我们都没有遇到 WebLogic 或 WebLogic Portal 的任何问题。

在过去的两年里，我一直在使用 WebSphere。每当我与 IBM 谈判时，它的成本总是 WebLogic 同等产品的两倍，但公司政策规定必须使用 WebSphere。我发现 WebSphere 的学习曲线比 WebLogic 陡峭得多，而且我们的构建/部署/测试生命周期非常耗时，因此我们在开发环境中使用了 Tomcat。但是我在 WebSphere 上遇到的最大问题是我们遇到了一个错误，迫使我们升级到下一个补丁版本，结果却遇到了解析 web.xml 的新问题。完成所有这些工作需要 48 小时轮班。

目前虽然我正在使用 JBoss。大约 3 个月前，我正准备使用 Tomcat 和 Jetspeed 2 开始我的新项目，但我注意到 Jetspeed 2 现在似乎有点停滞不前，而 JBoss Portal 2.7.0 刚刚发布并支持 JSR 286/Portlet 2.0。我试了一下 JBoss，发现它很容易设置和管理。构建/部署/测试周期非常快，除非我在某处更改了 Spring XML 文件，否则我很少需要重新启动服务器。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-11-10T10:44:24.103

我已经使用 jBoss 3-4 年了。

jBoss 的参数：

1.  开源。
2.  提供商业支持。
3.  庞大、活跃的用户社区。

反对 jBoss 的论据：

1.  没有通用访问，受支持的 Java EE 5 容器版本。
2.  大量文档但冗长；很难找到“我该如何做 x？”的答案。
3.  与其他商业产品相比，4.x 的管理工具较差。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2011-05-08T03:49:18.200

签出 GlassFish 3.1！构建在模块化、基于 Java EE 6 的 GlassFish v3 内核之上，版本 3.1 提供集群、集中管理和高可用性。

有关详细信息，请参阅[http://blogs.oracle.com/nazrul/entry/glassfish_3_1](http://blogs.oracle.com/nazrul/entry/glassfish_3_1)。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2012-10-04T08:39:25.293

这里没有讨论的另一点是性能。如果这是由于服务类型或用户数量而引起的问题，则以下内容将适用：

*   Tomcat 似乎比 Glassfish 慢
*   Glassfish 似乎比 Resin 慢
*   Resin 比 G-WAN + Java 慢很多

请注意，G-WAN 仅依赖于 JVM：它不使用任何其他容器（除非明确指定），因此您可以将其保留给 Web 应用程序的性能关键部分。

由于 G-WAN 支持其他语言（C、C++、C#、D、Objective-C），您甚至可以使用原始 C 语言处理应用程序的某些部分，同时保留 Java 用于其他任务。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-11-10T18:32:17.870

我可能会将您首选的操作系统作为决策标准。如果您为操作系统和应用服务器使用相同的供应商，它应该更容易支持。如果您已经与一个或两个供应商建立了关系，请考虑他们是否适合处理。

从技术角度来看，我会选择 GlassFish，因为它支持最新的创新。我不认为 JBoss 不好，因为它根本不是最新的。

我的大部分经验是在 WebLogic 上，但我使用过 JBoss 和 GlassFish。我刚刚在完整的 Sun 开源堆栈（OpenSolaris、GlassFish、MySQL）上发布了一个新站点，这是一次很棒的体验，只有一点点挫折。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-12-24T18:16:55.767

我仍然认为 WebLogic 是市场上最好的 Java EE 应用服务器。如果你能负担得起这些许可费，我认为这是值得的。

我很惊讶地看到结合 Tomcat、OpenEJB 和 ActiveMQ 可以走多远。在我看来，这似乎是一种低成本的选择。

我还会研究 Spring dm Server。它基于 Tomcat，但我认为他们添加的 OSGi 片段可能会在短期内无处不在。如果能做到和 Spring 框架一样的质量，确实非常好。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-06-02T20:25:45.633

另一种选择：根本不使用应用服务器。

查看[http://www.atomikos.com/Publications/J2eeWithoutApplicationServer](http://www.atomikos.com/Publications/J2eeWithoutApplicationServer)。

对于 web 项目，如果必须的话，保留一个轻量级的 web 容器，并结合 Wicket 之类的东西来避免 JSP/JSF 或 struts 的复杂性。

HTH 家伙

# javascript - 如何将焦点设置到独立于 id 的 HTML 表单中的第一个输入元素？

> ID：277544
> 
> 赞同：92
> 
> 时间：2008-11-10T10:30:31.137
> 
> 标签：javascript, html, forms, focus

有没有一种简单的方法可以在加载页面时将网页**的焦点**（输入光标）设置**在第一个输入元素**（文本框、下拉列表...）上，而无需知道元素的 id？

我想将它实现为我的 Web 应用程序的所有页面/表单的通用脚本。

* * *

## 回答 #1

> 赞同：149
> 
> 时间：2011-06-22T20:49:01.947

虽然这不能回答问题（需要一个通用脚本），但我认为其他人知道 HTML5 引入了“自动对焦”属性可能会很有用：

```
<form>
  <input type="text" name="username" autofocus>
  <input type="password" name="password">
  <input type="submit" value="Login">
</form> 
```

[深入了解HTML5](http://fortuito.us/diveintohtml5/forms.html#autofocus)有更多信息。

* * *

## 回答 #2

> 赞同：102
> 
> 时间：2008-11-10T21:01:23.407

您还可以尝试基于 jQuery 的方法：

```
$(document).ready(function() {
    $('form:first *:input[type!=hidden]:first').focus();
}); 
```

* * *

## 回答 #3

> 赞同：39
> 
> 时间：2008-11-10T10:36:45.507

```
document.forms[0].elements[0].focus(); 
```

这可以使用循环来细化，例如。不关注某些类型的字段，禁用字段等。*更好的做法是在您确实*想要聚焦的字段中添加一个 class="autofocus" ，然后遍历 forms[i].elements[j] 以查找该类名。

无论如何：在每个页面上都这样做通常不是一个好主意。当您关注输入时，用户将失去例如。从键盘滚动页面。如果出乎意料，这可能会很烦人，因此只有在您非常确定使用表单字段将成为用户想要做的事情时才自动聚焦。IE。如果你是谷歌。

* * *

## 回答 #4

> 赞同：19
> 
> 时间：2010-04-30T13:33:06.917

我发现最全面的 jQuery 表达式是（通过[这里](http://www.gerd-riesselmann.net/development/focus-first-form-field-with-jquery)的帮助）

```
$(document).ready(function() {
    $('input:visible:enabled:first').focus();
}); 
```

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2008-11-10T11:14:38.613

如果您使用的是[Prototype](http://www.prototypejs.org/) JavaScript 框架，那么您可以使用[focusFirstElement](http://prototypejs.org/doc/latest/dom/Form/focusFirstElement/)方法：

```
Form.focusFirstElement(document.forms[0]); 
```

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2008-11-10T10:34:10.940

这里有一篇文章可能有用：[将焦点设置为网页上的第一个输入](http://www.codeproject.com/KB/scripting/FocusFirstInput.aspx)

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2008-11-10T11:01:23.787

您还需要跳过任何隐藏的输入。

```
for (var i = 0; document.forms[0].elements[i].type == 'hidden'; i++);
document.forms[0].elements[i].focus(); 
```

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2013-08-21T03:16:53.790

我正在使用这个：

```
$("form:first *:input,select,textarea").filter(":not([readonly='readonly']):not([disabled='disabled']):not([type='hidden'])").first().focus(); 
```

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2021-01-28T11:54:43.107

我需要为在我页面上的模态 div 中动态显示的表单解决这个问题，不幸`autofocus`的是，当通过更改`display`属性（至少在 Chrome 中没有）显示包含 div 时，它不被尊重。我不喜欢任何需要我的代码来推断我应该将焦点设置到哪个控件的解决方案，因为隐藏或零大小输入的复杂性等。我的解决方案是`autofocus`无论如何都要在我的输入上设置属性，然后在我显示 div 时在我的代码中设置焦点：

```
form.querySelector('*[autofocus]').focus(); 
```

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2008-11-10T12:58:41.303

将此代码放在`body`标签的末尾将自动将第一个可见的、非隐藏的启用元素聚焦在屏幕上。它将处理我能在短时间内提出的大多数情况。

```
<script>
    (function(){
        var forms = document.forms || [];
        for(var i = 0; i < forms.length; i++){
            for(var j = 0; j < forms[i].length; j++){
                if(!forms[i][j].readonly != undefined && forms[i][j].type != "hidden" && forms[i][j].disabled != true && forms[i][j].style.display != 'none'){
                    forms[i][j].focus();
                    return;
                }
            }
        }
    })();
</script> 
```

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2013-01-25T04:43:26.230

尝试了上面的很多答案，但它们都不起作用。在以下位置找到这个：[http](http://www.kolodvor.net/2008/01/17/set-focus-on-first-field-with-jquery/#comment-1317) ://www.kolodvor.net/2008/01/17/set-focus-on-first-field-with-jquery/#comment-1317 谢谢 Kolodvor。

```
$("input:text:visible:first").focus(); 
```

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2012-10-23T02:25:21.043

这将获得任何可见公共输入中的第一个，包括文本区域和选择框。这也确保它们没有被隐藏、禁用或只读。它还允许一个目标 div，我在我的软件中使用它（即，此表单内的第一个输入）。

```
$("input:visible:enabled:not([readonly]),textarea:visible:enabled:not([readonly]),select:visible:enabled:not([readonly])", 
    target).first().focus(); 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2014-10-20T06:28:33.883

对于那些使用 JSF2.2+ 并且不能将 autofocus 作为没有值的属性传递给它的人，使用这个：

```
 p:autofocus="true" 
```

并将其添加到命名空间 p 中（也经常使用 pt。随你喜欢）。

```
<html ... xmlns:p="http://java.sun.com/jsf/passthrough"> 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2019-04-19T12:28:19.210

没有 jquery，例如使用常规 javascript：

```
document.querySelector('form input:not([type=hidden])').focus() 
```

适用于 Safari 但不适用于 Chrome 75（2019 年 4 月）

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2014-05-08T12:02:54.090

与`AngularJS`：

```
angular.element('#Element')[0].focus(); 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2014-06-02T11:30:51.057

这包括 textareas 并且不包括单选按钮

```
$(document).ready(function() {
    var first_input = $('input[type=text]:visible:enabled:first, textarea:visible:enabled:first')[0];
    if(first_input != undefined){ first_input.focus(); }
}); 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2017-12-06T15:19:46.273

您应该能够使用 clientHeight 而不是检查 display 属性，因为父级可能隐藏此元素：

```
function setFocus() {
    var forms = document.forms || [];
        for (var i = 0; i < forms.length; i++) {
            for (var j = 0; j < forms[i].length; j++) {
            var widget = forms[i][j];
                if ((widget && widget.domNode && widget.domNode.clientHeight > 0) && typeof widget.focus === "function")
                 && (typeof widget.disabled === "undefined" || widget.disabled === false)
                 && (typeof widget.readOnly === "undefined" || widget.readOnly === false)) {
                        widget.focus();
                        break;
                }
            }
        }
    }   
} 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2019-02-18T17:25:15.830

没有第三方库，使用类似

```
 const inputElements = parentElement.getElementsByTagName('input')
  if (inputChilds.length > 0) {
    inputChilds.item(0).focus();
  } 
```

确保您考虑所有表单元素标签，排除隐藏/禁用的标签，如其他答案等等。

# git - 我可以使用 Git 在存储库中搜索匹配的文件名吗？

> ID：277546
> 
> 赞同：78
> 
> 时间：2008-11-10T10:31:12.740
> 
> 标签：git

只需说我在 Git 存储库的多个子目录中有一个文件：“HelloWorld.pm”。

我想发出一个命令来查找与“HelloWorld.pm”匹配的所有文件的完整路径：

例如：

```
/path/to/repository/HelloWorld.pm
/path/to/repository/but/much/deeper/down/HelloWorld.pm
/path/to/repository/please/dont/make/me/search/through/the/lot/HelloWorld.pm 
```

如何使用 Git 有效地查找与给定文件名匹配的所有完整路径？

我意识到我可以使用 Linux/Unix find 命令来做到这一点，但我希望避免扫描所有子目录以查找文件名的实例。

* * *

## 回答 #1

> 赞同：117
> 
> 时间：2011-04-15T19:51:36.880

[`git ls-files`](http://www.kernel.org/pub/software/scm/git/docs/git-ls-files.html)将为您提供存储库（缓存或索引）当前状态的所有文件的列表。您可以传入一个模式以获取与该模式匹配的文件。

```
git ls-files HelloWorld.pm '**/HelloWorld.pm' 
```

如果您想查找一组文件并通过它们的内容 grep，您可以这样做[`git grep`](http://www.kernel.org/pub/software/scm/git/docs/git-grep.html)：

```
git grep some-string -- HelloWorld.pm '**/HelloWorld.pm' 
```

* * *

## 回答 #2

> 赞同：45
> 
> 时间：2011-08-05T17:18:04.357

嗯，最初的问题是关于存储库的。一个存储库包含超过 1 个提交（至少在一般情况下），但在搜索之前给出的答案仅通过一个提交。

因为我找不到真正搜索整个提交历史的答案，所以我编写了一个快速蛮力脚本 git-find-by-name，它考虑了（几乎）所有提交。

```
#! /bin/sh
tmpdir=$(mktemp -td git-find.XXXX)
trap "rm -r $tmpdir" EXIT INT TERM

allrevs=$(git rev-list --all)
# well, nearly all revs, we could still check the log if we have
# dangling commits and we could include the index to be perfect...

for rev in $allrevs
do
  git ls-tree --full-tree -r $rev >$tmpdir/$rev 
done

cd $tmpdir
grep $1 * 
```

也许有更优雅的方式。

请注意将参数传递给 grep 的简单方式，因此它将匹配文件名的一部分。如果不需要锚定您的搜索表达式和/或添加合适的 grep 选项。

对于深入的历史，输出可能太吵了，我想到了一个将修订列表转换为范围的脚本，就像 git rev-list 可以做的相反。但到目前为止，它仍然是一个想法。

* * *

## 回答 #3

> 赞同：25
> 
> 时间：2008-11-10T10:34:55.387

尝试：

```
git ls-tree -r HEAD | grep HelloWorld.pm 
```

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2014-06-18T15:26:36.577

```
git ls-files | grep -i HelloWorld.pm 
```

grep -i 使 grep 不区分大小写。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2013-05-10T23:55:05.247

[我承认，这有点滥用评论，但我还不能发表评论，并认为我会改进@uwe-geuder 的回答。]

```
#!/bin/bash
#
#

# I'm using a fixed string here, not a regular expression, but you can easily
# use a regular expression by altering the call to grep below.
name="$1"

# Verify usage.
if [[ -z "$name" ]]
then
    echo "Usage: $(basename "$0") <file name>" 1>&2
    exit 100
fi  

# Search all revisions; get unique results.
while IFS= read rev
do
    # Find $name in $rev's tree and only use its path.
    grep -F -- "$name" \
        <(git ls-tree --full-tree -r "$rev" | awk '{ print $4 }')
done < \
    <(git rev-list --all) \
    | sort -u 
```

再次向@uwe-geuder +1 以获得很好的答案。

如果您对 BASH 本身感兴趣：

除非您保证在 for 循环中分词（例如使用这样的数组：），否则`for item in "${array[@]}"`我强烈建议`while IFS= read var ; do ... ; done < <(command)`您在循环的命令输出由换行符`read -d''`分隔时使用空字符串`$'\0'`）。虽然`git rev-list --all`保证使用 40 字节的十六进制字符串（没有空格），但我从不喜欢冒险。我现在可以轻松地将命令更改`git rev-list --all`为任何产生行的命令

我还建议使用内置的 BASH 机制来注入输入和过滤输出而不是临时文件。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2015-12-05T02:29:47.127

Uwe Geuder (@uwe-geuder) 的脚本很棒，但实际上没有必要将每个 ls-tree 输出转储到其自己的目录中，未经过滤。

更快并且使用更少的存储空间：在输出上运行 grep 然后存储它，如本[要点所示](https://gist.github.com/dirkjot/073ffac502567e32f7ad)

# regex - 正则表达式跳过捕获组中的字符

> ID：277547
> 
> 赞同：47
> 
> 时间：2008-11-10T10:31:15.330
> 
> 标签：regex

是否可以在正则表达式中跳过捕获组中的几个字符？我正在使用 .NET 正则表达式，但这没关系。

基本上，我正在寻找的是：

> [随机文本]AB-123[随机文本]

我需要捕获'AB123'，不带连字符。

我知道 AB 是 2 或 3 个大写字符，而 123 是 2 或 3 位数字，但这不是难点。困难的部分（至少对我来说）是跳过连字符。

我想我可以分别捕获两者，然后将它们连接到代码中，但我希望我有一个更优雅、仅限正则表达式的解决方案。

有什么建议么？

* * *

## 回答 #1

> 赞同：52
> 
> 时间：2008-11-10T10:38:49.997

简而言之：你不能。匹配始终是连续的，即使它包含零宽度断言等内容，如果您想找到下一个字符，则无法匹配下一个字符。

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2008-11-10T10:45:50.667

确实没有办法创建一个表达式，以使匹配的文本与源文本中的文本不同。您需要在单独的步骤中删除连字符，方法是分别匹配第一部分和第二部分并连接两个组：

```
match = Regex.Match( text, "([A-B]{2,3})-([0-9]{2,3})" );
matchedText = string.Format( "{0}{1}", 
    match.Groups.Item(1).Value, 
    match.Groups.Item(2).Value ); 
```

或者通过在与匹配过程分开的步骤中删除连字符：

```
match = Regex.Match( text, "[A-B]{2,3}-[0-9]{2,3}" );
matchedText = match.Value.Replace( "-", "" ); 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-10T10:58:36.133

您断言如果没有子分组+连接它就不可能做到这一点是正确的。

你也可以像 Jeff-Hillman 那样做，只是在事后去掉坏角色。

在这里要注意的重要一点是，您“不要对所有内容都使用正则表达式”。

正则表达式是为解决非平凡问题而设计的不太复杂的解决方案，你不应该对所有事情都使用“哦，我们将使用正则表达式”，你不应该养成认为你可以解决问题的习惯一步正则表达式。

当有一种可行的简单方法有效时，一定要使用它。

另一种想法，如果您碰巧需要在代码体中返回多个匹配项，请查找基于您的语言“回调”的正则表达式，它允许将任何匹配/找到的组传递给可以进行内联替换的函数调用。（在进行正则表达式替换时特别方便）。

不知道它在.Net中是如何工作的，但是在php中你会做类似的事情（不是确切的代码）

```
 function strip_reverse( $a )
  {
     $a = preg_replace("/-/", "", $a );
     return reverse($a);
  }
  $b = preg_replace_callback( "/(AB[-]?cde)/" , 'strip_reverse' , "Hello World AB-cde" ; 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2015-11-21T17:49:24.757

您可以使用嵌套的捕获组，如下所示：

```
((AB)-(123)) 
```

第一个捕获组是`AB-123`，第二个是`AB`，第三个是`123`。然后，您所要做的就是加入第二组和第三组，并留出一个空格。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2018-01-27T08:03:21.473

有点晚了，但我想我想出了这个。至少有一种方法可以做到这一点。

我使用积极的前瞻在我的文本中的 # 符号处停止。我不想要空格或 # 符号，所以我必须想办法“跳过”它们。因此，当我被迫再次匹配它们时，我将它们倾倒到一个我不打算使用的垃圾组（即，一个比特桶）中，代码中是 . 现在，我的位置指针是 # 符号之外的一个字符位置（我想要的位置，跳过空格和 # 符号）。我现在只匹配文件名末尾的 . 并忽略文件扩展名。

```
(?i)English\\(?<Series>[^ ]+) - (?<Title>.+(?= #))(?<garb1>..)(?<Number>[^.]+)(?-i) 
```

使用的文件名是

```
F:\Downloads\Downloads\500 Comics CCC CBR English\Isukani - Great Girl #01.cbr 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2020-06-21T07:32:22.390

我对此有点陌生，但您可以使用竖线符号`|`，它充当 OR。

这可能适用于.NET：

```
((?<=[A-Z]{2}-)\d\d\d)|([A-Z]{2}(?=-\d\d\d)) 
```

这在 VIM 语法文件中对我有用：

```
\(\([A-Z]\{2}-\)\@<=\d\d\d\)\|\([A-Z]\{2}\(-\d\d\d\)\@=\) 
```

# c - 如何使用 SQLite 从内存中打开数据库？

> ID：277551
> 
> 赞同：5
> 
> 时间：2008-11-10T10:32:41.177
> 
> 标签：c, sqlite

看起来所有加载 SQLite 的方法都涉及使用字符串从命名文件加载。我想从内存中加载 SQlite 数据库。

数据库已加载到内存中。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-10T10:35:20.703

使用特殊的文件名，`:memory:`

```
sqlite3_open(":memory:", &db); 
```

`libsqlite`[正如SQLite 文档](http://www.sqlite.org/compile.html)中所指出的，必须在未定义的**情况下** 进行编译：`SQLITE_OMIT_MEMORYDB`

> **`SQLITE_OMIT_MEMORYDB`**
> 
> > 定义时，库不尊重特殊的数据库名称`":memory:"`（通常用于创建内存数据库）。如果`":memory:"`传递给`sqlite3_open()`、`sqlite3_open16()`或`sqlite3_open_v2()`，将打开或创建具有此名称的文件。

但是，如果您想读取*已经*完全加载到内存中的数据库，则工作量会更大。您必须实现一个自定义 VFS 层来操作内存文件并将其注册到您的 SQLite 上下文中。

看：

*   [`sqlite3_vfs`](http://sqlite.org/c3ref/vfs.html)
*   [`sqlite3_io_methods`](http://sqlite.org/c3ref/io_methods.html)

我自己没有实现它，所以我无法可靠地判断您是否必须实现整个新的 VFS 层，或者您可以在默认层中替换一些函数（后者不太可能）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-01T11:16:17.477

有一个 memvfs 实现在

[article.gmane.org/gmane.comp.db.sqlite.general/46450](http://article.gmane.org/gmane.comp.db.sqlite.general/46450)

# outlook - 如何从 GAL 获取照片到 Outlook 邮件表单？

> ID：277552
> 
> 赞同：3
> 
> 时间：2008-11-10T10:33:29.943
> 
> 标签：outlook

Outlook 2007 在邮件表单的右侧显示联系人图片。这仅适用于您的个人联系人以及您有照片的情况。

有没有办法将该图片与公司的 GAL 或 AD 挂钩，以便所有员工的照片自动显示？希望不必编写和部署新的 msg 表单。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-10T11:05:32.280

要将照片存储在 AD 中，您可以使用`jpegPhoto`属性（请参阅[MSDN 中的正式描述](http://msdn.microsoft.com/en-us/library/ms676813(VS.85).aspx)）。这是[一种使用 VBScript 的方法，](http://www.arricc.net/active-directory-photos-sharepoint.php#)这是一种[使用 VB.NET](http://blogs.technet.com/btrst4/archive/2004/09/07/226323.aspx)的方法。

我不确定 Outlook 2007 是否使用了这个值（我的猜测是 - 它没有），但值得一试。`jpegPhoto`我的猜测是，即使您将 GAL 中的某个人放入您的个人通讯簿，Outlook 也不关心。无论如何，这应该很容易测试。

如果所有其他方法都失败了，您要么明确表示它不起作用，要么构建一个读取值的自定义表单。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-09-28T20:16:29.873

您必须将图片存储在 AD 中的 thumbnailPhoto 属性下，才能在 Outlook 2010 中显示。对于 Outlook 2007 和 2003，您需要安装 Microsoft Outlook Social Connector。详细信息：[Outlook 2007 和 2003 中的 GAL 照片](http://www.stevieg.org/2010/12/enabling-outlook-2003-and-2007-to-display-exchange-gal-photos/)

LDAP 标准是上面提到的 jpegPhoto。MS 做任何他们想要的标准，所以他们使用thumbnailPhoto。有关如何在 AD 中导入图片的更多信息：[GAL pics in AD](http://blogs.technet.com/b/exchange/archive/2010/03/10/3409495.aspx "广告中的 GAL 照片")

我使用了这两个字段，以防其他更符合 LDAP 的应用程序想要从 jpegPhoto 获得它。由于最大大小为 100kb，因此即使是数千张图片在复制时也不是什么大问题。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-11-11T07:40:47.217

Outlook 将仅显示来自个人联系人的照片，而不是 GAL 或 AD。制作新表格不是一种选择。

我设法使用 PersonName 智能标签向上下文菜单中添加了一个菜单选项，该菜单在浏览器中查找并显示照片。不是最优的。有人有其他想法吗？

# debugging - 调试文件系统访问

> ID：277566
> 
> 赞同：1
> 
> 时间：2008-11-10T10:38:56.640
> 
> 标签：debugging, logging, filesystems

我正在寻找一种 Windows 工具，该工具能够记录对本地文件系统内的特定路径进行的每个操作（读取和写入），以便调试程序（找出它有时慢而有时不慢的原因）。从理论上讲，它可以像病毒扫描程序一样工作，可以识别任何正在运行的程序读取或写入的每个文件，并记录它看到的所有内容。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-10T10:41:38.647

听起来像是[Process Monitor](http://technet.microsoft.com/en-us/sysinternals/bb896645.aspx)的工作，以前称为[FileMon](http://technet.microsoft.com/en-us/sysinternals/bb896642.aspx)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-10T10:42:28.647

[sysinternals http://technet.microsoft.com/en-us/sysinternals/bb896645.aspx](http://technet.microsoft.com/en-us/sysinternals/bb896645.aspx)制作了一个名为 Process Monitor 的工具，它将监控文件系统和注册表，它将显示哪个进程正在执行操作。它应该可以帮助您做您需要的事情

我喜欢 sysinternals 制作的应用程序，它们使计算机世界成为一个更好的工作场所。

# php - 有没有一种简单的方法可以将数字转换为 PHP 中的单词？

> ID：277569
> 
> 赞同：44
> 
> 时间：2008-11-10T10:40:44.297
> 
> 标签：php, numbers

在 PHP 中，有没有一种简单的方法可以将数字转换为单词？例如，*27*到*27*。

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2008-11-10T10:46:03.257

我在网上[找到](http://bloople.net/num2text/cnumlib.txt)了一些 (2007/2008) 源代码，因为它是受版权保护的，但我可以自由使用它并随意修改它，所以我将它放在这里并在 CC-Wiki 下重新授权：

```
<?php
/**
 * English Number Converter - Collection of PHP functions to convert a number
 *                            into English text.
 *
 * This exact code is licensed under CC-Wiki on Stackoverflow.
 * http://creativecommons.org/licenses/by-sa/3.0/
 *
 * @link     http://stackoverflow.com/q/277569/367456
 * @question Is there an easy way to convert a number to a word in PHP?
 *
 * This file incorporates work covered by the following copyright and
 * permission notice:
 *
 *   Copyright 2007-2008 Brenton Fletcher. http://bloople.net/num2text
 *   You can use this freely and modify it however you want.
 */

function convertNumber($number)
{
    list($integer, $fraction) = explode(".", (string) $number);

    $output = "";

    if ($integer{0} == "-")
    {
        $output = "negative ";
        $integer    = ltrim($integer, "-");
    }
    else if ($integer{0} == "+")
    {
        $output = "positive ";
        $integer    = ltrim($integer, "+");
    }

    if ($integer{0} == "0")
    {
        $output .= "zero";
    }
    else
    {
        $integer = str_pad($integer, 36, "0", STR_PAD_LEFT);
        $group   = rtrim(chunk_split($integer, 3, " "), " ");
        $groups  = explode(" ", $group);

        $groups2 = array();
        foreach ($groups as $g)
        {
            $groups2[] = convertThreeDigit($g{0}, $g{1}, $g{2});
        }

        for ($z = 0; $z < count($groups2); $z++)
        {
            if ($groups2[$z] != "")
            {
                $output .= $groups2[$z] . convertGroup(11 - $z) . (
                        $z < 11
                        && !array_search('', array_slice($groups2, $z + 1, -1))
                        && $groups2[11] != ''
                        && $groups[11]{0} == '0'
                            ? " and "
                            : ", "
                    );
            }
        }

        $output = rtrim($output, ", ");
    }

    if ($fraction > 0)
    {
        $output .= " point";
        for ($i = 0; $i < strlen($fraction); $i++)
        {
            $output .= " " . convertDigit($fraction{$i});
        }
    }

    return $output;
}

function convertGroup($index)
{
    switch ($index)
    {
        case 11:
            return " decillion";
        case 10:
            return " nonillion";
        case 9:
            return " octillion";
        case 8:
            return " septillion";
        case 7:
            return " sextillion";
        case 6:
            return " quintrillion";
        case 5:
            return " quadrillion";
        case 4:
            return " trillion";
        case 3:
            return " billion";
        case 2:
            return " million";
        case 1:
            return " thousand";
        case 0:
            return "";
    }
}

function convertThreeDigit($digit1, $digit2, $digit3)
{
    $buffer = "";

    if ($digit1 == "0" && $digit2 == "0" && $digit3 == "0")
    {
        return "";
    }

    if ($digit1 != "0")
    {
        $buffer .= convertDigit($digit1) . " hundred";
        if ($digit2 != "0" || $digit3 != "0")
        {
            $buffer .= " and ";
        }
    }

    if ($digit2 != "0")
    {
        $buffer .= convertTwoDigit($digit2, $digit3);
    }
    else if ($digit3 != "0")
    {
        $buffer .= convertDigit($digit3);
    }

    return $buffer;
}

function convertTwoDigit($digit1, $digit2)
{
    if ($digit2 == "0")
    {
        switch ($digit1)
        {
            case "1":
                return "ten";
            case "2":
                return "twenty";
            case "3":
                return "thirty";
            case "4":
                return "forty";
            case "5":
                return "fifty";
            case "6":
                return "sixty";
            case "7":
                return "seventy";
            case "8":
                return "eighty";
            case "9":
                return "ninety";
        }
    } else if ($digit1 == "1")
    {
        switch ($digit2)
        {
            case "1":
                return "eleven";
            case "2":
                return "twelve";
            case "3":
                return "thirteen";
            case "4":
                return "fourteen";
            case "5":
                return "fifteen";
            case "6":
                return "sixteen";
            case "7":
                return "seventeen";
            case "8":
                return "eighteen";
            case "9":
                return "nineteen";
        }
    } else
    {
        $temp = convertDigit($digit2);
        switch ($digit1)
        {
            case "2":
                return "twenty-$temp";
            case "3":
                return "thirty-$temp";
            case "4":
                return "forty-$temp";
            case "5":
                return "fifty-$temp";
            case "6":
                return "sixty-$temp";
            case "7":
                return "seventy-$temp";
            case "8":
                return "eighty-$temp";
            case "9":
                return "ninety-$temp";
        }
    }
}

function convertDigit($digit)
{
    switch ($digit)
    {
        case "0":
            return "zero";
        case "1":
            return "one";
        case "2":
            return "two";
        case "3":
            return "three";
        case "4":
            return "four";
        case "5":
            return "five";
        case "6":
            return "six";
        case "7":
            return "seven";
        case "8":
            return "eight";
        case "9":
            return "nine";
    }
} 
```

* * *

## 回答 #2

> 赞同：35
> 
> 时间：2009-07-10T01:24:48.110

或者，您可以使用[`intl`](http://www.php.net/manual/en/intl.setup.php)PHP 包中的 NumberFormatter 类。这是一个让您入门的示例代码（用于命令行）：

```
<?php
if ($argc < 3) 
    {
    echo "usage: php {$argv[0]} lang-tag number ...\n";
    exit;
    }

array_shift($argv);
$lang_tag = array_shift($argv);

$nf1 = new NumberFormatter($lang_tag, NumberFormatter::DECIMAL);
$nf2 = new NumberFormatter($lang_tag, NumberFormatter::SPELLOUT);

foreach ($argv as $num) 
    {
    echo $nf1->format($num).' is '.$nf2->format($num)."\n"; 
    } 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-11-10T14:57:00.177

PECL中有[`Numbers_Words`包](http://pear.php.net/package/Numbers_Words)。它完全符合您的要求。支持以下语言：

*   库伯·萨帕列夫 (Kouber Saparev) 的 bg (保加利亚语)
*   CS（捷克语）由 Petr 'PePa' Pavel
*   de（德语） 作者：Piotr Klaban
*   Jesper Veggerby 的 dk（丹麦语）
*   Piotr Klaban 的 en_100（Donald Knuth 系统，英语）
*   Piotr Klaban 的 en_GB（英式英语）
*   en_US（美式英语） 作者：Piotr Klaban
*   Xavier Noguer 的 es（西班牙卡斯特拉诺）
*   Martin Marrese 的 es_AR（阿根廷西班牙语）
*   et（爱沙尼亚语） 作者：Erkki Saarniit
*   库伯·萨帕列夫（Kouber Saparev）的fr（法语）
*   fr_BE（法国比利时），Kouber Saparev 和 Philippe Bajoit
*   he (希伯来语) by Hadar Porat
*   Nils Homp 的 hu_HU（匈牙利语）
*   Ernas M. Jamil 和 Arif Rifai Dwiyanto 的 id（印度尼西亚语）
*   it_IT（意大利语）作者 Filippo Beltramini 和 Davide Caironi
*   lt (立陶宛语) 作者 Laurynas Butkus
*   nl (荷兰语) by WHAM van Dinter
*   Piotr Klaban 的 pl（波兰语）
*   pt_BR（巴西葡萄牙语），Marcelo Subtil Marcal 和 Mario HCT
*   ru (俄语) 作者 Andrey Demenev
*   sv（瑞典语） 作者：Robin Ericsson

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2017-07-16T06:39:56.960

我需要一个解决方案，将“和”放入返回的字符串并将其格式化为一个句子——通常就像人类所说的那样。所以我稍微调整了一个不同的解决方案 - 因为我认为这可能对某人有用而发布。

```
4,835,301 returns "Four million eight hundred and thirty five thousand three hundred and one." 
```

代码

```
function convertNumber($num = false)
{
    $num = str_replace(array(',', ''), '' , trim($num));
    if(! $num) {
        return false;
    }
    $num = (int) $num;
    $words = array();
    $list1 = array('', 'one', 'two', 'three', 'four', 'five', 'six', 'seven', 'eight', 'nine', 'ten', 'eleven',
        'twelve', 'thirteen', 'fourteen', 'fifteen', 'sixteen', 'seventeen', 'eighteen', 'nineteen'
    );
    $list2 = array('', 'ten', 'twenty', 'thirty', 'forty', 'fifty', 'sixty', 'seventy', 'eighty', 'ninety', 'hundred');
    $list3 = array('', 'thousand', 'million', 'billion', 'trillion', 'quadrillion', 'quintillion', 'sextillion', 'septillion',
        'octillion', 'nonillion', 'decillion', 'undecillion', 'duodecillion', 'tredecillion', 'quattuordecillion',
        'quindecillion', 'sexdecillion', 'septendecillion', 'octodecillion', 'novemdecillion', 'vigintillion'
    );
    $num_length = strlen($num);
    $levels = (int) (($num_length + 2) / 3);
    $max_length = $levels * 3;
    $num = substr('00' . $num, -$max_length);
    $num_levels = str_split($num, 3);
    for ($i = 0; $i < count($num_levels); $i++) {
        $levels--;
        $hundreds = (int) ($num_levels[$i] / 100);
        $hundreds = ($hundreds ? ' ' . $list1[$hundreds] . ' hundred' . ( $hundreds == 1 ? '' : '' ) . ' ' : '');
        $tens = (int) ($num_levels[$i] % 100);
        $singles = '';
        if ( $tens < 20 ) {
            $tens = ($tens ? ' and ' . $list1[$tens] . ' ' : '' );
        } elseif ($tens >= 20) {
            $tens = (int)($tens / 10);
            $tens = ' and ' . $list2[$tens] . ' ';
            $singles = (int) ($num_levels[$i] % 10);
            $singles = ' ' . $list1[$singles] . ' ';
        }
        $words[] = $hundreds . $tens . $singles . ( ( $levels && ( int ) ( $num_levels[$i] ) ) ? ' ' . $list3[$levels] . ' ' : '' );
    } //end for loop
    $commas = count($words);
    if ($commas > 1) {
        $commas = $commas - 1;
    }
    $words = implode(' ',  $words);
    $words = preg_replace('/^\s\b(and)/', '', $words );
    $words = trim($words);
    $words = ucfirst($words);
    $words = $words . ".";
    return $words;
} 
```

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2018-03-27T07:41:32.807

使用 NumberFormatter 类很容易转换为单词。

```
<?php

$number = '12345';
$locale = 'en_US';
$fmt = numfmt_create($locale, NumberFormatter::SPELLOUT);
$in_words = numfmt_format($fmt, $number);

print_r($in_words);
// twelve thousand three hundred forty-five

?> 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2013-03-24T02:36:13.610

我重写了上面的代码以适应标准的美国书面文字数字格式。

```
function singledigit($number){
    switch($number){
        case 0:$word = "zero";break;
        case 1:$word = "one";break;
        case 2:$word = "two";break;
        case 3:$word = "three";break;
        case 4:$word = "four";break;
        case 5:$word = "five";break;
        case 6:$word = "six";break;
        case 7:$word = "seven";break;
        case 8:$word = "eight";break;
        case 9:$word = "nine";break;
    }
    return $word;
}

function doubledigitnumber($number){
    if($number == 0){
        $word = "";
    }
    else{
        $word = "-".singledigit($number);
    }       
    return $word;
}

function doubledigit($number){
    switch($number[0]){
        case 0:$word = doubledigitnumber($number[1]);break;
        case 1:
            switch($number[1]){
                case 0:$word = "ten";break;
                case 1:$word = "eleven";break;
                case 2:$word = "twelve";break;
                case 3:$word = "thirteen";break;
                case 4:$word = "fourteen";break;
                case 5:$word = "fifteen";break;
                case 6:$word = "sixteen";break;
                case 7:$word = "seventeen";break;
                case 8:$word = "eighteen";break;
                case 9:$word = "ninteen";break;
            }break;
        case 2:$word = "twenty".doubledigitnumber($number[1]);break;                
        case 3:$word = "thirty".doubledigitnumber($number[1]);break;
        case 4:$word = "forty".doubledigitnumber($number[1]);break;
        case 5:$word = "fifty".doubledigitnumber($number[1]);break;
        case 6:$word = "sixty".doubledigitnumber($number[1]);break;
        case 7:$word = "seventy".doubledigitnumber($number[1]);break;
        case 8:$word = "eighty".doubledigitnumber($number[1]);break;
        case 9:$word = "ninety".doubledigitnumber($number[1]);break;

    }
    return $word;
}

function unitdigit($numberlen,$number){
    switch($numberlen){         
        case 3:case 6:case 9:case 12:$word = "hundred";break;
        case 4:case 5:$word = "thousand";break;
        case 7:case 8:$word = "million";break;
        case 10:case 11:$word = "billion";break;
    }
    return $word;
}

function numberToWord($number){

    $numberlength = strlen($number);
    if ($numberlength == 1) { 
        return singledigit($number);
    }elseif ($numberlength == 2) {
        return doubledigit($number);
    }
    else {

        $word = "";
        $wordin = "";
        switch ($numberlength ) {
        case 5:case 8:  case 11:
            if($number[0] >0){
                $unitdigit = unitdigit($numberlength,$number[0]);
                $word = doubledigit($number[0].$number[1]) ." ".$unitdigit." ";
                return $word." ".numberToWord(substr($number,2));
            }
            else{
                return $word." ".numberToWord(substr($number,1));
            }
        break;
        default:
            if($number[0] >0){
                $unitdigit = unitdigit($numberlength,$number[0]);
                $word = singledigit($number[0]) ." ".$unitdigit." ";
            }               
            return $word." ".numberToWord(substr($number,1));
        }
    }
} 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2018-09-24T16:27:17.800

您可以使用[NumberFormatter 类](http://php.net/manual/en/class.numberformatter.php)：

```
$f = new NumberFormatter("en", NumberFormatter::SPELLOUT);
echo $f->format($myNumber); 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2018-10-31T02:37:54.617

就在这里。不使用图书馆你只需要遵循这个..

首先，您需要检查您的服务器是否在您的**php.ini**`;extension=php_intl.dll`中启用，如果仍然无法正常工作，您需要查看此答案。

 **[带 wamp 的国际扩展 php_intl.dll](https://stackoverflow.com/questions/16372888/intl-extension-php-intl-dll-with-wamp/16372984#16372984)

成功移动所有文件后以**icu**开头。

从：`<wamp_installation_path>/bin/php/php5.4.3/`

到：`<wamp_installation_path>/bin/apache/apache2.2.22/bin/`

并重新启动您的服务器。

尝试运行此代码：

```
$f = new NumberFormatter("en", NumberFormatter::SPELLOUT);
echo $f->format(123456); 
```

它将显示 123,456 的***输出***。

希望对大家有所帮助:)。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2016-11-22T10:08:55.293

这是我今晚写的一个小班。注意事项：

1.  只有英文。
2.  仅处理美国/法国对十亿等的定义。
3.  该`longform`方法不处理小数。它只会抹去它们。如果您愿意，请随意修改并添加该功能。
4.  该`numberformat`方法确实做小数，但不做任何四舍五入。`numberformat`由于 PHP 对整数大小的固有限制，我不得不创建一个新函数。我翻译的数字太大了，以至于当我过去`number_format()`检查我的翻译时，我花了 30 分钟才意识到我的翻译没有错，`number_format`是的。
5.  这不是关于类的警告，而是关于 PHP 的警告。32 位版本的 PHP 不会处理大于`2,147,483,647`（20 亿和变化）的整数。64位版本将处理最多喜欢的`9 quintillion`东西。但是，只要您将数字`longform`作为`string`. `ajax`只要我将它作为`''+number`.

所以，这个类将最多翻译数字`999 Centillion, 999 etc.`（例如，一个 9 到 306 个字符长的字符串）。任何大于此的数字，该函数只会返回一条愚蠢的消息。

用法：

```
$number = '999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999';
reallyBig::longform($number); 
```

可选的第二个布尔参数默认为 true，它会在正确的位置尽可能地添加逗号，以使数字更具可读性。

顺便说一句，`-`如果你想让它为负数，你可以把a放在前面，但是输入字符串中包含的任何其他字符都将被删除。例如：

`reallyBig::longform('-C55LL-M5-4-a-9u7-71m3-M8');`将输出：`negative five billion, five hundred fifty-four million, nine hundred seventy-seven thousand, one hundred thirty-eight`

该`numberformat`方法对于任何其他方法都不是必需的。如果您想检查一个很长的翻译号码，它就在那里。由于所有这些函数都将数字作为字符串处理，因此它们不会违反 PHP 的限制。

我停在 999 centillion 的唯一原因是，centillion 是我在网站上看到的最后一个数字，当时我不记得在 decillion 之后发生了什么。

```
class reallyBig
{
    private static $map, $strings;
    private static function map()
    {
        $map = array();
        $num = 1;
        $count = 1;
        while($num < 307)
        {
            if($count == 1) $map[$num] = $num+2;
            elseif($count == 2) $map[$num] = $num+1;
            else 
            {
                $map[$num] = $num;
                $count = 0;
            }
            $count++;
            $num++;
        }
        return $map;
    }
    private static function strings()
    {
        return array 
        (
            6 => 'thousand',
            9 => 'million',
            12 => 'billion',
            15 => 'trillion',
            18 => 'quadrillion',
            21 => 'quintillion',
            24 => 'sextillion',
            27 => 'septillion',
            30 => 'octillion',
            33 => 'nonillion',
            36 => 'decillion',
            39 => 'undecillion',
            42 => 'duodecillion',
            45 => 'tredecillion',
            48 => 'quattuordecillion',
            51 => 'quindecillion',
            54 => 'sexdecillion',
            57 => 'septendecillion',
            60 => 'octodecillion',
            63 => 'novemdecillion',
            66 => 'vigintillion',
            69 => 'unvigintillion',
            72 => 'duovigintillion',
            75 => 'trevigintillion',
            78 => 'quattuorvigintillion',
            81 => 'quinvigintillion',
            84 => 'sexvigintillion',
            87 => 'septenvigintillion',
            90 => 'octovigintillion',
            93 => 'novemvigintillion',
            96 => 'trigintillion',
            99 => 'untrigintillion',
            102 => 'duotrigintillion',
            105 => 'tretrigintillion',
            108 => 'quattuortrigintillion',
            111 => 'quintrigintillion',
            114 => 'sextrigintillion',
            117 => 'septentrigintillion',
            120 => 'octotrigintillion',
            123 => 'novemtrigintillion',
            126 => 'quadragintillion',
            129 => 'unquadragintillion',
            132 => 'duoquadragintillion',
            135 => 'trequadragintillion',
            138 => 'quattuorquadragintillion',
            141 => 'quinquadragintillion',
            144 => 'sexquadragintillion',
            147 => 'septenquadragintillion',
            150 => 'octoquadragintillion',
            153 => 'novemquadragintillion',
            156 => 'quinquagintillion',
            159 => 'unquinquagintillion',
            162 => 'duoquinquagintillion',
            165 => 'trequinquagintillion',
            168 => 'quattuorquinquagintillion',
            171 => 'quinquinquagintillion',
            174 => 'sexquinquagintillion',
            177 => 'septenquinquagintillion',
            180 => 'octoquinquagintillion',
            183 => 'novemquinquagintillion',
            186 => 'sexagintillion',
            189 => 'unsexagintillion',
            192 => 'duosexagintillion',
            195 => 'tresexagintillion',
            198 => 'quattuorsexagintillion',
            201 => 'quinsexagintillion',
            204 => 'sexsexagintillion',
            207 => 'septensexagintillion',
            210 => 'octosexagintillion',
            213 => 'novemsexagintillion',
            216 => 'septuagintillion',
            219 => 'unseptuagintillion',
            222 => 'duoseptuagintillion',
            225 => 'treseptuagintillion',
            228 => 'quattuorseptuagintillion',
            231 => 'quinseptuagintillion',
            234 => 'sexseptuagintillion',
            237 => 'septenseptuagintillion',
            240 => 'octoseptuagintillion',
            243 => 'novemseptuagintillion',
            246 => 'octogintillion',
            249 => 'unoctogintillion',
            252 => 'duooctogintillion',
            255 => 'treoctogintillion',
            258 => 'quattuoroctogintillion',
            261 => 'quinoctogintillion',
            264 => 'sexoctogintillion',
            267 => 'septenoctogintillion',
            270 => 'octooctogintillion',
            273 => 'novemoctogintillion',
            276 => 'nonagintillion',
            279 => 'unnonagintillion',
            282 => 'duononagintillion',
            285 => 'trenonagintillion',
            288 => 'quattuornonagintillion',
            291 => 'quinnonagintillion',
            294 => 'sexnonagintillion',
            297 => 'septennonagintillion',
            300 => 'octononagintillion',
            303 => 'novemnonagintillion',
            306 => 'centillion',
        );
    }
    public static function longform($number = string, $commas = true)
    {
        $negative = substr($number, 0, 1) == '-' ? 'negative ' : '';
        list($number) = explode('.', $number);          
        $number = trim(preg_replace("/[^0-9]/u", "", $number));
        $number = (string)(ltrim($number,'0'));
        if(empty($number)) return 'zero';
        $length = strlen($number);
        if($length <  2) return $negative.self::ones($number);
        if($length <  3) return $negative.self::tens($number);
        if($length <  4) return $commas ? $negative.str_replace('hundred ', 'hundred and ', self::hundreds($number)) : $negative.self::hundreds($number);
        if($length < 307) 
        {
            self::$map = self::map();
            self::$strings = self::strings();
            $result = self::beyond($number, self::$map[$length]);
            if(!$commas) return $negative.$result;
            $strings = self::$strings;
            $thousand = array_shift($strings);
            foreach($strings as $string) $result = str_replace($string.' ', $string.', ', $result);
            if(strpos($result, 'thousand') !== false) list($junk,$remainder) = explode('thousand', $result);
            else $remainder = $result;
            return strpos($remainder, 'hundred') !== false ? $negative.str_replace('thousand ', 'thousand, ', $result) : $negative.str_replace('thousand ', 'thousand and ', $result);
        }
        return 'a '.$negative.'number too big for your britches';
    }
    private static function ones($number)
    {
        $ones = array('zero','one','two','three','four','five','six','seven','eight','nine');
        return $ones[$number];
    }
    private static function tens($number)
    {
        $number = (string)(ltrim($number,'0'));
        if(strlen($number) < 2) return self::ones($number);
        if($number < 20)
        {
            $teens = array('ten','eleven','twelve','thirteen','fourteen','fifteen','sixteen','seventeen','eighteen','nineteen');
            return $teens[($number-10)];
        }
        else
        {
            $tens = array('','','twenty','thirty','forty','fifty','sixty','seventy','eighty','ninety');
            $word = $tens[$number[0]];
            return empty($number[1]) ? $word : $word.'-'.self::ones($number[1]);
        }
    }
    private static function hundreds($number)
    {
        $number = (string)(ltrim($number,'0'));
        if(strlen($number) < 3) return self::tens($number);
        $word = self::ones($number[0]).' hundred';
        $remainder = substr($number, -2);
        if(ltrim($remainder,'0') != '') $word .= ' '.self::tens($remainder);
        return $word;
    }
    private static function beyond($number, $limit)
    {
        $number = (string)(ltrim($number,'0'));
        $length = strlen($number);
        if($length < 4) return self::hundreds($number);
        if($length < ($limit-2)) return self::beyond($number, self::$map[($limit-3)]);
        if($length == $limit) $word = self::hundreds(substr($number, 0, 3), true);
        elseif($length == ($limit-1)) $word = self::tens(substr($number, 0, 2));
        else $word = self::ones($number[0]);
        $word .= ' '.self::$strings[$limit];
        $sub = ($limit-3);
        $remainder = substr($number, -$sub);
        if(ltrim($remainder,'0') != '') $word .= ' '.self::beyond($remainder, self::$map[$sub]);
        return $word;
    }
    public static function numberformat($number, $fixed = 0, $dec = '.', $thou = ',')
    {
        $negative = substr($number, 0, 1) == '-' ? '-' : '';
        $number = trim(preg_replace("/[^0-9\.]/u", "", $number));
        $number = (string)(ltrim($number,'0'));
        $fixed = (int)$fixed;
        if(!is_numeric($fixed)) $fixed = 0;
        if(strpos($number, $dec) !== false) list($number,$decimals) = explode($dec, $number); 
        else $decimals = '0';
        if($fixed) $decimals = '.'.str_pad(substr($decimals, 0, $fixed), $fixed, 0, STR_PAD_RIGHT);
        else $decimals = '';
        $thousands = array_map('strrev', array_reverse(str_split(strrev($number), 3)));
        return $negative.implode($thou,$thousands).$decimals;
    }
} 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2021-07-04T04:06:11.723

```
<?php
$grandTotalAmount = 700000000;
echo ($grandTotalAmount == round($grandTotalAmount)) ? convert_number_to_words(floatval($grandTotalAmount)) . ' Only' : convert_number_to_words(floatval($grandTotalAmount)) . ' Only';

function convert_number_to_words($number) {
    $hyphen = ' ';
    $conjunction = ' and ';
    $separator = ', ';
    $negative = 'negative ';
    $decimal = ' Thai Baht And ';
    $dictionary = array(
        0 => 'zero',
        1 => 'one',
        2 => 'two',
        3 => 'three',
        4 => 'four',
        5 => 'five',
        6 => 'six',
        7 => 'seven',
        8 => 'eight',
        9 => 'nine',
        10 => 'ten',
        11 => 'eleven',
        12 => 'twelve',
        13 => 'thirteen',
        14 => 'fourteen',
        15 => 'fifteen',
        16 => 'sixteen',
        17 => 'seventeen',
        18 => 'eighteen',
        19 => 'nineteen',
        20 => 'twenty',
        30 => 'thirty',
        40 => 'fourty',
        50 => 'fifty',
        60 => 'sixty',
        70 => 'seventy',
        80 => 'eighty',
        90 => 'ninety',
        100 => 'hundred',
        1000 => 'thousand',
        1000000 => 'million',
        1000000000 => 'billion',
        1000000000000 => 'trillion',
        1000000000000000 => 'quadrillion',
        1000000000000000000 => 'quintillion'
    );

    if (!is_numeric($number)) {
        return false;
    }

    if (($number >= 0 && (int) $number < 0) || (int) $number < 0 - PHP_INT_MAX) {
        // overflow
        trigger_error(
                'convert_number_to_words only accepts numbers between -' . PHP_INT_MAX . ' and ' . PHP_INT_MAX, E_USER_WARNING
        );
        return false;
    }

    if ($number < 0) {
        return $negative . convert_number_to_words(abs($number));
    }

    $string = $fraction = null;

    if (strpos($number, '.') !== false) {
        list($number, $fraction) = explode('.', $number);
    }

    switch (true) {
        case $number < 21:
            $string = $dictionary[$number];
            break;
        case $number < 100:
            $tens = ((int) ($number / 10)) * 10;
            $units = $number % 10;
            $string = $dictionary[$tens];
            if ($units) {
                $string .= $hyphen . $dictionary[$units];
            }
            break;
        case $number < 1000:
            $hundreds = $number / 100;
            $remainder = $number % 100;
            $string = $dictionary[$hundreds] . ' ' . $dictionary[100];
            if ($remainder) {
                $string .= $conjunction . convert_number_to_words($remainder);
            }
            break;
        default:
            $baseUnit = pow(1000, floor(log($number, 1000)));
            $numBaseUnits = (int) ($number / $baseUnit);
            $remainder = $number % $baseUnit;
            $string = convert_number_to_words($numBaseUnits) . ' ' . $dictionary[$baseUnit];
            if ($remainder) {
                $string .= $remainder < 100 ? $conjunction : $separator;
                $string .= convert_number_to_words($remainder);
            }
            break;
    }

    if (null !== $fraction && is_numeric($fraction)) {
        $string .= $decimal;
        $words = array();
        foreach (str_split((string) $fraction) as $number) {
            $words[] = $dictionary[$number];
        }
        $string .= implode(' ', $words);
    }

    return $string;
}
?> 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2021-07-07T05:23:03.327

下面的代码工作正常

```
$test = 1000025.05;

$f = new \NumberFormatter( locale_get_default(), \NumberFormatter::SPELLOUT );

$word = $f->format($test);

echo $word; 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2021-08-17T09:42:18.440

```
protected function numberTextHelper($number)
{
    if (($number < 0) || ($number > 999999999)) 
    {
        throw new Exception("Number is out of range");
    }

    $ones = array("", "One", "Two", "Three", "Four", "Five", "Six", "Seven", "Eight", "Nine", "Ten", "Eleven", "Twelve", "Thirteen", "Fourteen", "Fifteen", "Sixteen", "Seventeen", "Eightteen", "Nineteen");
    $tens = array("", "", "Twenty", "Thirty", "Fourty", "Fifty", "Sixty", "Seventy", "Eigthy", "Ninety");

    $giga = floor($number / 1000000);
    // Millions (giga)
    $number -= $giga * 1000000;

    $thousands = floor($number / 1000);

    // Thousands (kilo)
    $number -= $thousands * 1000;

    $hecto = floor($number / 100);

    // Hundreds (hecto)
    $number -= $hecto * 100;

    $deca = floor($number / 10);

    // Tens (deca)
    $n = $number % 10;

    $frac  = round($number - (int)$number,2); 

    // Ones
    $result = array();
    if ($giga) 
    {
        $result[]= $this->numberTextHelper($giga).' '.($giga>1?'MILLIONS':'MILLION');
    }

    if ($thousands) 
    {
        $result[]= $thousands>1?$this->numberTextHelper($thousands).' THOUSANDS':'THOUSAND';
    }

    if ($hecto) 
    {
        $result[]= $this->numberTextHelper($hecto).'HUNDRED';
    }

    if ($deca) 
    {
        if($deca<2)
        {
            $result[]= $ones[$deca * 10 + $n];
            $n=0;
        }
        else
        {
            $result[]= $tens[$deca];
        }
    }

    if ($n) 
    {
        $result[]= $ones[$n];
    }

    if($frac) 
    {
        $result[]= 'and';
        $result[]= $this->numberTextHelper($frac*100);
        $result[]= 'cents';
    }

    if(empty($result)) 
    {
        $result[]= 'zero';
    }

    return implode(' ',$result);
} 
```

你可以翻译它

```
function numberText($number)
{
    $result=$this->numberTextHelper($number);
    $result=$this->strtoupper($result);
    $text=array_filter(explode(' ',$result));
    $translated=array_map(array($this,'getLang'),$text);
    return implode(' ',$translated);
} 
```

* * *

## 回答 #13

> 赞同：-3
> 
> 时间：2012-09-13T17:29:10.970

我已经使用递归函数生成了这个。

```
$wordnum = numberToWord($number);
echo $wordnum."<BR>";

function singledigit($number){
        switch($number){
            case 0:$word = "zero";break;
            case 1:$word = "One";break;
            case 2:$word = "two";break;
            case 3:$word = "three";break;
            case 4:$word = "Four";break;
            case 5:$word = "Five";break;
            case 6:$word = "Six";break;
            case 7:$word = "Seven";break;
            case 8:$word = "Eight";break;
            case 9:$word = "Nine";break;
        }
        return $word;
    }

    function doubledigitnumber($number){
        if($number == 0){
            $word = "";
        }
        else{
            $word = singledigit($number);
        }       
        return $word;
    }

    function doubledigit($number){
        switch($number[0]){
            case 0:$word = doubledigitnumber($number[1]);break;
            case 1:
                switch($number[1]){
                    case 0:$word = "Ten";break;
                    case 1:$word = "Eleven";break;
                    case 2:$word = "Twelve";break;
                    case 3:$word = "Thirteen";break;
                    case 4:$word = "Fourteen";break;
                    case 5:$word = "Fifteen";break;
                    case 6:$word = "Sixteen";break;
                    case 7:$word = "Seventeen";break;
                    case 8:$word = "Eighteen";break;
                    case 9:$word = "Ninteen";break;
                }break;
            case 2:$word = "Twenty".doubledigitnumber($number[1]);break;                
            case 3:$word = "Thirty".doubledigitnumber($number[1]);break;
            case 4:$word = "Forty".doubledigitnumber($number[1]);break;
            case 5:$word = "Fifty".doubledigitnumber($number[1]);break;
            case 6:$word = "Sixty".doubledigitnumber($number[1]);break;
            case 7:$word = "Seventy".doubledigitnumber($number[1]);break;
            case 8:$word = "Eighty".doubledigitnumber($number[1]);break;
            case 9:$word = "Ninety".doubledigitnumber($number[1]);break;

        }
        return $word;
    }

    function unitdigit($numberlen,$number){
        switch($numberlen){         
            case 3:$word = "Hundred";break;
            case 4:$word = "Thousand";break;
            case 5:$word = "Thousand";break;
            case 6:$word = "Lakh";break;
            case 7:$word = "Lakh";break;
            case 8:$word = "Crore";break;
            case 9:$word = "Crore";break;

        }
        return $word;
    }

    function numberToWord($number){

        $numberlength = strlen($number);
        if ($numberlength == 1) { 
            return singledigit($number);
        }elseif ($numberlength == 2) {
            return doubledigit($number);
        }
        else {

            $word = "";
            $wordin = "";

            if($numberlength == 9){
                if($number[0] >0){
                    $unitdigit = unitdigit($numberlength,$number[0]);
                    $word = doubledigit($number[0].$number[1]) ." ".$unitdigit." ";
                    return $word." ".numberToWord(substr($number,2));
                }
                else{
                    return $word." ".numberToWord(substr($number,1));
                }
            }

            if($numberlength == 7){
                if($number[0] >0){
                    $unitdigit = unitdigit($numberlength,$number[0]);
                    $word = doubledigit($number[0].$number[1]) ." ".$unitdigit." ";
                    return $word." ".numberToWord(substr($number,2));
                }
                else{
                    return $word." ".numberToWord(substr($number,1));
                }

            }

            if($numberlength == 5){
                if($number[0] >0){
                    $unitdigit = unitdigit($numberlength,$number[0]);
                    $word = doubledigit($number[0].$number[1]) ." ".$unitdigit." ";
                    return $word." ".numberToWord(substr($number,2));
                }
                else{
                    return $word." ".numberToWord(substr($number,1));
                }

            }
            else{
                if($number[0] >0){
                    $unitdigit = unitdigit($numberlength,$number[0]);
                    $word = singledigit($number[0]) ." ".$unitdigit." ";
                }               
                return $word." ".numberToWord(substr($number,1));
            }
        }
    } 
```

* * *

## 回答 #14

> 赞同：-3
> 
> 时间：2017-09-16T11:00:33.470

```
Amount in Words:</b><?=no_to_words($number)?> 
```

使用 PHP 函数将数字转换为单词的非常简单的方法。

# php - mysql_real_escape_string() 不应该在数据库中留下斜杠吗？

> ID：277575
> 
> 赞同：3
> 
> 时间：2008-11-10T10:43:48.673
> 
> 标签：php, mysql, escaping, smarty

我使用 smarty 和`mysql_real_escape_string()`用于用户输入，当我使用`'`or插入一些代码`"`并在 phpmyadmin 中查找时，它显示没有反斜杠。

当我从 DB 获取记录时，我也没有反斜杠。但是当我只是传递转义字符串而不插入数据库时​​，它是反斜杠的。

它不应该添加斜杠，插入它们，然后在输出时将它们剥离吗？还是我错过了什么？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-11-10T11:03:30.803

你错过了 - 用反斜杠转义是为了确保查询没有格式错误，例如，这样的事情肯定会中断并可能冒 SQL 注入的风险：

```
insert into table values ('whatever 'this' is') 
```

并且不会在表中保存任何内容，而这个：

```
insert into table values ('whatever \'this\' is') 
```

将在表中保存值“无论 'this' 是什么”。

# delphi - 如何在我的 Delphi 应用程序中设置 14 天试用限制

> ID：277588
> 
> 赞同：13
> 
> 时间：2008-11-10T10:47:42.427
> 
> 标签：delphi, licensing

我希望为我的软件添加 14 天试用限制。该程序是用 Delphi 7 编写的。

任何帮助将非常感激。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-11-10T10:52:22.387

你可以试试 Turbopower OnGuard。这现在是开源的。

[http://sourceforge.net/projects/tponguard/](http://sourceforge.net/projects/tponguard/)

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-11-10T10:57:41.970

您可以使用多种技巧，但没有一个是 100% 失败的。

*   您可以使用某种许可机制。
*   您可以将设置时间存储在注册表中隐藏的某个位置。
*   您可以将设置时间存储在文件中（可能是可执行文件或 dll）。
*   您可以将 IP 地址存储在中央数据库中，并检查每次是否超过 14 天（为此您需要互联网连接）。
*   您可以在服务器上动态创建文件（例如 dll）并让安装程序检索该文件。（请务必记录 IP，以免第二次尝试）。

但我认为最好的方法是提供功能有限的试用版。例如：不打印，不保存项目，或者只能保存小项目。

这样您就可以避免麻烦，可能的客户可以花时间评估您的项目。

**编辑：**如果你建立一个机制来检查时钟回滚。请务必留出余量，否则如果您返回其他时区，程序将被锁定。或者把时钟调回冬天。我认为 25 小时的保证金将涵盖所有内容。（并且在保存方面，您可以建立一个限制，用户可以每天回滚时间。）。

但保持付费客户的最佳方式是提供良好的支持。如果服务不好，我会停止产品。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-10T15:37:49.300

我用过犰狳、Asprotect 和 Winlicense。Armadillo 和 Asprotect 都存在严重问题，例如被某些 AV 视为病毒/木马、不兼容问题等。

我没有使用足够多的 Winlicense 来发表意见，但是支持非常好。

显然，两者都是比您要求的更完整的解决方案 - 它们包括保护、许可、密钥等。

正如其他人所提到的，有时限制功能或添加水印是最好的选择。我在我的一个程序[(STGThumb)](http://www.stgthumb.com)中添加了水印，销售额增长了约 400%...

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-10T12:57:06.660

对于有时间限制的应用程序，您需要防止的一件事是用户回滚他们的日历，以便应用程序仍然可以工作。解决此问题的一种方法是在应用程序启动时将时间戳存储在隐藏的注册表位置（或任何地方）。如果当前日期/时间早于您的应用程序记录的最后一个时间戳，则意味着用户已将日历回滚，您应该禁用该应用程序。

但是，对于程序员和用户来说，时间限制确实是一种痛苦。这也不是一个很好的营销理念：为什么要麻烦分发有有效期的促销材料（这是您的试用版）？这就像一家公司在纸上邮寄广告，两周后就会解体。

如果您的试用版在功能上被削弱了，您甚至可能在数月或数年后仍能从中获得销售。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-10T13:15:34.110

[你可以在这里](https://stackoverflow.com/questions/173930/incorporating-shareware-restrictions-in-c-software#173959)找到类似的问题。

一般来说，我发现时间限制比功能限制更有用。正如我在对[Gamecat 帖子的评论中解释的那样](https://stackoverflow.com/questions/277588/how-to-make-a-14-day-trial-limit-in-my-delphi-application#277604)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-10T13:40:25.650

执行任何这些检查时需要注意的事项。从您在任一方向输入的日期起，日期永远不会超过 14 天。大多数此类限制的常见方法是提前几年设置日期，安装并运行您的软件，然后将日期设置回当前时间。如果你被硬编码为从最初的开始日期起 14 天死掉，那么用户有几年的时间来试用你的软件。检查另一个方向也给用户最多 28 天。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-10T13:24:34.247

我建议制作带有时间戳的试用序列号，并在安装时强制用户将其输入软件。您甚至可以在设置完成后通过调用服务器端页面来自动化它。

试用序列号中的时间戳可让您在需要时延长试用期。

此外，您可以倒数以避免用户在安装时更改年份：

例如，如果您在 2008 年 11 月 15 日（服务器时间）生成了 14 天试用版，您可以在使用或输入序列号时检查定位日期是否始终大于 1.11.2008 或小于 24.11.2008。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2011-01-19T17:06:14.293

我创建了自己的密钥生成器（用于创建密钥的单独程序）。键值存储在与我的程序同名的二进制文件中，只是一个不同的分机。示例：myprogram.key

我存储：
名称
电子邮件
RegType (REG, TRIAL)
RegDate
FirstRun (0 OR 1)

程序查找文件。如果它不存在，它会向用户抛出一条消息并关闭。密钥文件生成器将值写入加密字符串，然后使用内置流例程写入。

我创建了一个与程序一起分发的试用密钥。如果有人注册，我会为他们创建一个正式的 REG 密钥。

无论如何，如果他们正在运行我的程序，它首先会查找密钥文件。如果找到，它会检查注册类型，如果是注册版本，则加载程序，并显示注册信息。我还存储了一个 regdate，我将它与程序运行的日期进行比较 - 如果 regdate 大于或等于今天的日期，则会提示用户重新注册。

如果它发现密钥文件存储了 TRIAL 的 RegType，那么他们第一次运行它的日期将存储在密钥文件中，并且第一次运行标志设置为 1。然后他们可以使用它 14 天。每次他们运行程序时，存储的日期都会与运行​​日期进行比较。

编写过程非常简单。是万无一失吗？不，什么都不是！我的应用程序取得了巨大的成功。它并不广为人知，因此没有黑客可以破解它。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2011-01-19T15:41:23.203

您可以使用专业工具作为 SoftwareShield。我在我们的应用程序中使用它，它提供了几种许可证模型，包括限时演示。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2018-03-20T11:39:58.717

最好的办法是从您的服务器获取注册信息。最大的缺点： 1\. 服务器必须始终在线！2.用户必须连接到互联网（当它使用你的应用程序时）。

为了让您开始，您可以使用[Delphi 许可证管理库](http://www.visualbioinformatics.com/Delphi%20VCL%20licensing%20system.html)来帮助您加密许可证信息并生成一个基于字符串的密钥，您可以在注册时将其发送给您的客户。那里的图书馆很少。

无论如何，您发送到服务器的任何内容都需要基于该计算机的[硬件指纹](http://www.soft.tahionic.com/download-hdd_id/hardware%20id%20programming%20source%20code/Delphi/demo%20application%20-%20full.html)。否则，您的许可证密钥将在某些warez 网站上泄露，每个人都可以使用该密钥。但是，如果密钥是基于硬件的，那么如果它在 Internet 上泄露，那将毫无用处。

并且不要过度这样做！没有牢不可破的软件保护。如果微软做不到，你就不会做。专注于为您的应用程序添加漂亮的功能，而不是创建防弹保护系统（这是不可能的）。

# jquery - 使用 jQuery 验证插件验证单选按钮组

> ID：277589
> 
> 赞同：132
> 
> 时间：2008-11-10T10:47:47.480
> 
> 标签：jquery, validation

如何使用 jQuery 验证插件对单选按钮组（应选择一个单选按钮）执行验证？

* * *

## 回答 #1

> 赞同：116
> 
> 时间：2010-07-27T21:01:26.730

对于较新版本的 jquery（我认为是 1.3+），您所要做的就是将无线电集的一个成员设置为必需的，jquery 将负责其余的工作：

```
<input type="radio" name="myoptions" value="blue" class="required"> Blue<br />
<input type="radio" name="myoptions" value="red"> Red<br />
<input type="radio" name="myoptions" value="green"> Green 
```

以上将需要在继续之前选择带有“我的选项”名称的 3 个单选选项中的至少 1 个。

Mahes 的标签建议，顺便说一句，效果很好！

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2009-12-03T21:54:03.187

使用以下规则验证单选按钮组选择

```
myRadioGroupName : {required :true} 
```

myRadioGroupName 是您赋予 name 属性的值

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2010-08-22T03:48:35.967

你也可以使用这个：

```
<fieldset>
<input type="radio" name="myoptions[]" value="blue"> Blue<br />
<input type="radio" name="myoptions[]" value="red"> Red<br />
<input type="radio" name="myoptions[]" value="green"> Green<br />
<label for="myoptions[]" class="error" style="display:none;">Please choose one.</label>
</fieldset> 
```

只需添加此规则

```
rules: {
 'myoptions[]':{ required:true }
} 
```

提及如何添加规则。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2012-11-08T16:28:00.317

根据布兰登的回答。但是，如果您使用的是使用非侵入式验证的 ASP.NET MVC，则可以将 data-val 属性添加到第一个属性。我还喜欢为每个单选按钮添加标签以提高可用性。

```
<span class="field-validation-valid" data-valmsg-for="color" data-valmsg-replace="true"></span>
<p><input type="radio" name="color" id="red" value="R" data-val="true" data-val-required="Please choose one of these options:"/> <label for="red">Red</label></p>
<p><input type="radio" name="color" id="green" value="G"/> <label for="green">Green</label></p>
<p><input type="radio" name="color" id="blue" value="B"/> <label for="blue">Blue</label></p> 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2012-09-13T17:33:51.837

另一种验证方法是这样的。

```
var $radio = $('input:radio[name="nameRadioButton"]');
$radio.addClass("validate[required]"); 
```

我希望我的例子对你有帮助

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2011-05-12T20:56:39.003

我有同样的问题。最后只为验证器编写一个自定义的高亮和取消高亮功能。将此添加到验证选项应将错误类添加到元素及其各自的标签：

```
 'highlight': function (element, errorClass, validClass) {
            if($(element).attr('type') == 'radio'){
                $(element.form).find("input[type=radio]").each(function(which){
                    $(element.form).find("label[for=" + this.id + "]").addClass(errorClass);
                    $(this).addClass(errorClass);
                });
            } else {
                $(element.form).find("label[for=" + element.id + "]").addClass(errorClass);
                $(element).addClass(errorClass);
            }
        },
        'unhighlight': function (element, errorClass, validClass) {
            if($(element).attr('type') == 'radio'){
                $(element.form).find("input[type=radio]").each(function(which){
                    $(element.form).find("label[for=" + this.id + "]").removeClass(errorClass);
                    $(this).removeClass(errorClass);
                });
            }else {
                $(element.form).find("label[for=" + element.id + "]").removeClass(errorClass);
                $(element).removeClass(errorClass);
            }
        }, 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2014-04-01T06:24:41.613

单选按钮的代码 -

```
<div>
<span class="radio inline" style="margin-right: 10px;">@Html.RadioButton("Gender", "Female",false) Female</span>
<span class="radio inline" style="margin-right: 10px;">@Html.RadioButton("Gender", "Male",false) Male</span>                                                        
<div class='GenderValidation' style="color:#ee8929;"></div>    
</div> 

<input class="btn btn-primary" type="submit" value="Create" id="create"/> 
```

和 jQuery 代码——

```
<script>
    $(document).ready(function () {
        $('#create').click(function(){

            var gender=$('#Gender').val();
            if ($("#Gender:checked").length == 0){
                $('.GenderValidation').text("Gender is required.");
                return false;
            }
        });
    });
</script> 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2019-04-30T21:29:38.653

将错误消息放在顶部。

```
 <style> 

 .radio-group{ 
      position:relative; margin-top:40px; 
 } 

 #myoptions-error{ 
     position:absolute; 
     top: -25px; 
  } 

 </style> 

 <div class="radio-group"> 
 <input type="radio" name="myoptions" value="blue" class="required"> Blue<br /> 
 <input type="radio" name="myoptions" value="red"> Red<br /> 
 <input type="radio" name="myoptions" value="green"> Green </div>
 </div><!-- end radio-group --> 
```

# localization - 应在应用程序中本地化哪些内容

> ID：277606
> 
> 赞同：6
> 
> 时间：2008-11-10T10:57:54.060
> 
> 标签：localization

在考虑应用程序的本地化版本应该考虑哪些方面时，会立即出现许多事情：

*   文字显示
*   日期和时间
*   单位
*   数字和小数
*   用户输入格式
*   从左到右支持
*   对话框和控件大小

在构建可本地化的应用程序时，是否还有其他事情/领域需要记住或牢记？是否有任何资源可以提供不仅针对文本本地化而且针对本地化所有方面的最佳实践列表？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-10T11:31:29.267

在[Kudzu](http://www.kudzuworld.com/Bio.EN.aspx)[谈到 l10N](http://www.woo-hoo.net/abstracts/Arch_Localization.aspx)之后， 我带着比以前更多的问题离开了房间，而我的旧问题都没有得到回答。但这给了我一些思考的机会，并传达了“取决于你能/想走多远”的信息。

*   用上述内容翻译文本正文
*   测试 LTR/RTL、TTB(TopToBottom) BTT 及其所有组合中的所有长度/对齐控件。
*   注意特殊字符和编码
*   注意不同对齐方式（LTR、RTL、TTB、BTT）的组合以及它们如何影响标点符号和引号。
*   根据文本对齐方式对齐控件（Hebrew Win 的开始菜单在右侧
*   考虑字符串长度。它们可以溢出其他语言。
*   将标签放在图标的正确一侧（LTR、TTB 等）
*   翻译语言选择控件
*   图片中没有文字（无法翻译）
*   翻译一切（标题、徽标、某些语言使用不同的品牌名称、产品名称等）
*   该地区是否有 24:00 或 00:00（也更改了 AM/PM）
*   该地区使用 AM/PM 还是 24:00 系统
*   他们使用什么日历系统
*   什么数字代表日期的哪个部分（日、月、年的所有组合）
*   尽量避免“复制 [number] 个文件”等价物。一些地区对按量换词有不同的规定。（这是一个非常复杂的话题，如果需要我会详细说明）
*   翻译句子，而不是单词。语法规则太复杂，无法放入您的业务逻辑中。
*   不要对区域使用标志。语言！=国家
*   考虑您可以支持哪些语言/方言（例如，印度有无数种语言）
*   编码
*   文化规则（一些展示女商人的西方图像在其他一些文化中可能会令人反感）
*   注意语言概括（例如 boot(UK) != boot(US)）

这些是我脑海中的那些。名单还在继续……

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-10T11:01:19.123

不要忘记转换所有文档和帮助文件的开销。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-10T11:22:32.433

来自我的 J2ME 应用程序日的一些提示：

1.  不要翻译单独的单词，翻译整个短语，即使有匹配的重复。您稍后必须翻译成一种语言，在这种语言中，单词必须在不同的上下文中进行不同的修改，您最终可能会得到类似“颜色：绿色”

2.  Right2Lelf 包括列表编号、对齐方式和替代滚动条

3.  阿拉伯语根据周围的字母以不同的方式书写相同的字母。您不能只从字符缓冲区打印字符串，您需要一个特殊的控件来输出这些字符串或支持您的平台

4.  按字母排序很难。没有中国人能向我解释规则，但他们总是会发现错误排序的单词。似乎有许多选项可以对中文进行排序。我猜其他语言可能有同样的问题

# c# - Html.RadioButton 将所有值设置为选定值

> ID：277607
> 
> 赞同：1
> 
> 时间：2008-11-10T10:57:56.273
> 
> 标签：c#, html-helper, asp.net-mvc-beta1

在修补解决[this][1]问题后，我认为问题的核心如下：

当您将 Html.RadioButton() html 助手与 Enum 作为值字段一起使用时，您只能选择一次选项。重新发布页面后，助手将忽略调用中设置的值，并将所有单选按钮设置为相同的值，即您选择的上一个帖子返回的值。难道我做错了什么？

*示例（观察按钮的**值）***

```
<fieldset>
    <legend>Test</legend>                            
    <div>
        <label for="SearchBag.EffectIndicatorAny" id="EffectIndicatorAnyLabel">
            Any
        </label>                
        <%=Html.RadioButton("SearchBag.EffectIndicator", "Any" , ViewData.Model.SearchBag.EffectIndicatorIsAny, new { @id = "SearchBag.EffectIndicatorAny" })%>
    </div>
    <div>
        <label for="SearchBag.EffectIndicatorSolid" id="EffectIndicatorSolidLabel">
            Solid
        </label>                
        <%=Html.RadioButton("SearchBag.EffectIndicator", "Solid", ViewData.Model.SearchBag.EffectIndicatorIsSolid, new { @id = "SearchBag.EffectIndicatorSolid" })%>
    </div>
    <div>
        <label for="SearchBag.EffectIndicatorEffect" id="EffectIndicatorEffectLabel">
            Effect
        </label>                
        <%=Html.RadioButton("SearchBag.EffectIndicator", "Effect", ViewData.Model.SearchBag.EffectIndicatorIsEffect, new { @id = "SearchBag.EffectIndicatorEffect" })%>
    </div>
</fieldset> 
```

会产生

```
<fieldset>
    <legend>Effect</legend>                            
    <div class="horizontalRadio">
        <label for="SearchBag.EffectIndicatorAny" id="EffectIndicatorAnyLabel">
            Any                                      
        </label>                
        <input checked="checked" id="SearchBag.EffectIndicatorAny" name="SearchBag.EffectIndicator" type="radio" value="Any" />
    </div>
    <div class="horizontalRadio">
        <label for="SearchBag.EffectIndicatorSolid" id="EffectIndicatorSolidLabel">
            Solid
        </label>                
        <input id="SearchBag.EffectIndicatorSolid" name="SearchBag.EffectIndicator" type="radio" value="Solid" />
    </div>
    <div class="horizontalRadio">
        <label for="SearchBag.EffectIndicatorEffect" id="EffectIndicatorEffectLabel">
            Effect
        </label>                
        <input id="SearchBag.EffectIndicatorEffect" name="SearchBag.EffectIndicator" type="radio" value="Effect" />
    </div>
</fieldset> 
```

并将生成第二次：

```
<fieldset>
    <legend>Effect</legend>                            
    <div class="horizontalRadio">
        <label for="SearchBag.EffectIndicatorAny" id="EffectIndicatorAnyLabel">
            Any                                      
        </label>                
        <input id="SearchBag.EffectIndicatorAny" name="SearchBag.EffectIndicator" type="radio" value="Solid" />
    </div>
    <div class="horizontalRadio">
        <label for="SearchBag.EffectIndicatorSolid" id="EffectIndicatorSolidLabel">
            Solid
        </label>                
        <input checked="checked" id="SearchBag.EffectIndicatorSolid" name="SearchBag.EffectIndicator" type="radio" value="Solid" />
    </div>
    <div class="horizontalRadio">
        <label for="SearchBag.EffectIndicatorEffect" id="EffectIndicatorEffectLabel">
            Effect
        </label>                
        <input id="SearchBag.EffectIndicatorEffect" name="SearchBag.EffectIndicator" type="radio" value="Solid" />
    </div>
</fieldset> 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-10T23:35:03.143

这是由于 ASP.NET MVC Beta 代码中的错误造成的。我在 asp.net MVC 论坛上写了对该问题的完整解释。参考这个[链接](http://forums.asp.net/t/1338576.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-12T10:58:27.177

万一有人关心这里是一个真正快速而肮脏的工作，以期待框架的下一次更新。它只会用您的值替换值。它没有经过单元测试，也不能保证。

将它放在您的 HtmlHelper 类库中或放置 HtmlHelper 扩展的任何位置。添加以下用法：

*   System.Text.RegularExpressions；
*   System.Web.Mvc.Html;

    ```
    /*ToDo: remove when patched in framework*/
    public static string MonkeyPatchedRadio(this HtmlHelper htmlHelper, string name, object value, bool isChecked, object htmlAttributes){
        string monkeyString = htmlHelper.RadioButton(name, value, isChecked, htmlAttributes);
        monkeyString = Regex.Replace(monkeyString, "(?<=value=\").*(?=\".*)", value.ToString());            
        return monkeyString;
    } 
    ```

我知道它可以做得更好等等，但我真的希望它会尽快修复。如果你想让它变得更好，它是社区 wiki，所以继续吧

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-10T11:34:07.607

一件事要检查。您是否使用更新后的模型来呈现您的视图？即第二次显示时从传递到视图的帖子更新的模型数据是否相同？

# sql-server - bigint 对于事件日志表是否足够大？

> ID：277608
> 
> 赞同：7
> 
> 时间：2008-11-10T10:58:36.087
> 
> 标签：sql-server, logging, biginteger

现在我知道 bigint 是 2^64；也就是说，原子比已知宇宙中的原子还要多。我不应该担心，因为我的人类大脑根本无法解决这个数字的巨大问题。

但是，假设我记录了系统中每个类别、产品和订单的每次更改，从发布到结束。在担心主键值用完之前，我是否应该关注表写入的性能？我应该将不同优先级的事件记录到不同的事件表中吗？在我用完 bigint 之前，我会用完硬盘上的原子吗？在开始归档/清除之前，我应该让事件日志表变得多大？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-11-10T11:05:11.830

即使您的每个条目只有 1 个字节，2^64 个条目也会在您的硬盘驱动器上占用大约 18000000 TB，所以我想您不必担心这一点。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2011-01-11T18:08:16.940

如果您的应用程序每百万分之一秒向表中添加一次记录，那么它将运行超过 50 万年，然后才会用完键。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-10T11:57:19.603

“在开始归档/清除它之前，我应该让事件日志表变得多大？”

永远不要清除事件日志——这些信息具有重要价值。

然而，当一些经理坚持认为归档是必要的时，您可以显示存储成本与您的时间成本，以 (a) 考虑它，(b) 获得第二和第三个意见，然后 (c) 写一个归档日志记录的过程。

存储成本直线下降。除了清除日志记录之外，您的时间最好花在任何事情上。

底线：您有权停止绞手。都很好。你没有犯一个根本性的错误。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-10T11:05:17.837

我们处理这个问题的方法是提供一个日志归档功能，按年份将日志表分离到单独的数据库中，允许我们重置 LogEvent 表上的身份种子。

我们也有不同的日志表，虽然只有两个主要的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-10T11:06:12.997

您极不可能用完主键值。但是，您可能需要考虑如何访问日志表以检索数据。使用它来通知您何时应该归档或清理数据。如果经常读取日志数据，请考虑添加索引以提高读取性能，但请记住，需要为添加的每条记录维护索引。

# taxonomy - 什么是学习曲线，为什么陡峭不难？

> ID：277618
> 
> 赞同：18
> 
> 时间：2008-11-10T11:04:06.357
> 
> 标签：taxonomy

*   究竟什么是学习曲线？
*   为什么将“陡峭的学习曲线”一词用于具有高进入门槛且需要相当长的时间才能进入的事物是错误的？

至于这个问题的原因：

*   这些术语在 Stack Overflow 上经常使用且不一致
*   我自己也被它弄糊涂了
*   大多数新手都会遇到这些术语，例如，当他们问诸如“什么是最好的 php 开发框架”之类的问题时

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-11-10T11:11:19.930

这是时间与熟练程度的曲线。

坚持不懈是错误的，因为这意味着您在很短的时间内变得非常精通

```
熟练度
  | __
  | |
  | | 在短时间内精通（陡峭=容易）
  | |
  |_/____________
       时间

熟练度
  |
  | 精通大量时间（温柔=困难）
  | __             
  | /
  |__________/___
       时间

```

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-11-10T11:12:03.250

参见[维基百科](http://en.wikipedia.org/wiki/Learning_curve)。

“陡峭的学习曲线”是一个没有任何实际意义的流行语。它曾经意味着你会取得快速的进步。“随着时间的推移，出现了一种误解，即“陡峭”的学习曲线意味着某些东西需要付出很大的努力才能学习……”

结论：使用该短语的人不知道它不清楚。您应该从他们那里获得有关哪些具体事物难以学习的详细信息，并摆脱流行语和陈词滥调。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-11-10T12:55:09.750

（来自`unix.rulez.org/~calver`）

[![一些常用编辑器的经典学习曲线](https://i.stack.imgur.com/EaXAn.jpg)](https://i.stack.imgur.com/EaXAn.jpg)
[（来源：[rulez.org](http://unix.rulez.org/~calver/pictures/curves.jpg)）]

对于任何记分的人来说，这个（非常不严肃的）图表赞同陡峭 == “难以攀登”的解释。Emacs。如此真实。;-)

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-11-10T11:27:30.863

我通常认为这与分配给学习的时间量以及在这段时间内您必须学习的内容有关。如果你只有很短的时间来学习一些东西，那么你的学习曲线将会比你有更长的时间来学习相同数量的材料要陡峭得多。所以陡峭的学习曲线是困难的，因为这意味着你试图将六个月的学习时间塞进三周，或者其他什么。

在相同的时间内，更多的材料会产生相同的曲线。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-11-10T11:11:19.477

来自维基百科：

> 学习曲线一词是指学习量与学习时间之间的图形关系。

“陡峭的学习曲线”一词经常**被错误地**用于需要一些时间来思考的事情。同样在 Stack Overflow 上，我已经看到它被错误地使用了很多次，因此这个问题和我自己的答案。

**事实上，当它相对容易开始使用新技能/技术/时，会给出一个陡峭的学习曲线。**

这意味着“学习进度（y）”和“投入时间（x）”之间的关系大于1。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-11-10T11:25:52.193

这是一场直觉之战。一方面，你有“陡峭=难以攀登”的联想，另一方面你有“横轴上的时间”惯例（但“横轴上的熟练度”不是“错误”，只是“更少”受欢迎的”）。所以，恕我直言，这不是“正确”与“错误”的问题，而是“直观”与“更直观”的问题。

我认为“陡峭=难以攀登”将获胜，因为它吸引了任何在他们生命中的任何时候爬过楼梯的人，而不是即使受过数学训练的人有时也会混淆的 xy 曲线。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-11-10T11:12:56.260

“学习曲线”有几种可能的解释，但相当自然的解释是 X 轴为“经过的时间”，Y 轴为“获得的知识”。在该映射中，陡峭的曲线意味着您快速获得了很多知识。

我能想到的“陡峭”与“硬”相同的唯一解释是，您在 X 轴上映射“获得的知识”，在 Y 轴上映射“付出的努力”，这不是一个非常自然的映射。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2011-02-09T22:23:15.267

“学习曲线”最初在 X 轴上具有总经过时间[或制造/学习的总累积单位]，在 y 轴上具有生产/学习单个单元所需的时间。你的第一个单元总是比第 100 个或第 1000 个花费更多的时间。曲线的“陡峭程度”取决于您擅长生产/学习事物的速度。学得快，你就有了“陡峭”的曲线；慢慢地，你有一个平坦的曲线。

我同意不知情的人已经改变了该术语的原始含义，但要准确地说**陡峭很容易**。人们感到不安是因为我们这些在学校注意正确使用语言的人很少参与这种类型的进化。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-11-10T11:19:54.140

学习曲线是可以获取知识的速率。复杂系统上的新开发人员可能会经历陡峭的学习曲线，因为他们需要学习很多东西才能变得富有成效。暗示一个有经验的开发人员如果熟悉一个系统，他们可能会经历一个浅薄的学习曲线。

知识的获得并不总是意味着理解。在某些情况下，开发人员可能不需要吸收大量系统细节，但可能需要了解底层设计才能发挥作用。这可能需要时间，但并不意味着学习曲线陡峭。

在实践中，理解和知识齐头并进。大多数开发人员将始终处于某种学习曲线上，但也会使用新知识来加深对他们正在工作的系统以及他们正在使用的工具和实践的理解。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-11-10T12:33:34.240

确实，**“陡峭的学习曲线”*应该*意味着“容易”**，因为学习曲线的起源是作为时间函数的测量性能图，而难以学习任务的正确表达应该是“渐进式”学习曲线”。但是很自然，“陡峭的学习曲线”应该意味着“困难”，因为a）大多数人从未看过实际的学习曲线，b）“陡峭”意味着“困难”，而“渐进”意味着“容易” ”。

这就是语言的演变方式，现在尝试改变这个术语的一般用法是完全徒劳的。而且，无论如何，**我不太**关心整个问题（看看你是怎么知道我的意思的？）。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2011-01-13T22:17:23.807

难度不是一个因素。学习曲线描述了获得熟练技能或高水平理解的时间长度。描述将根据曲线应用到的测试对象而有所不同。虽然可以肯定地说，获得诸如 MS Notepad 之类的应用程序的熟练程度的学习曲线会很陡峭，但曲线的另一个应用程序将是单个测试对象获得这种熟练程度所需的时间长度。熟练掌握 MS 记事本的学习曲线通常很陡峭，但 Mary 可能比 John 更陡峭。

我认为关键是首先要了解曲线应用于什么

# .net - 制作 Silverlight 和常规 .NET REST 客户端的最便携方式是什么

> ID：277623
> 
> 赞同：5
> 
> 时间：2008-11-10T11:06:02.687
> 
> 标签：.net, wcf, .net-3.5, rest, silverlight-2.0

我正在尝试让服务器应用程序使用 WCF 公开一些状态信息。特别是我在使用带有 RESTful“API”的 WCF 服务之后。当谈到从我想作为另一种客户端类型的 silverlight 应用程序/页面使用 REST api 时，我遇到了一些障碍......

到目前为止，我已经成功定义了一个状态界面：

```
public static class StatusUriTemplates
{
  public const string Status = "/current-status";
  public const string StatusJson = "/current-status/json";
  public const string StatusXml = "/current-status/xml";
}
[ServiceContract]
public interface IStatusService
{
  [OperationContract]
  [WebGet(ResponseFormat = WebMessageFormat.Json, UriTemplate = StatusUriTemplates.StatusJson)]
  StatusResultSet GetProgressAsJson();

  [OperationContract]
  [WebGet(ResponseFormat = WebMessageFormat.Xml, UriTemplate = StatusUriTemplates.StatusXml)]
  StatusResultSet GetProgressAsXml();

  [OperationContract]
  [WebGet(UriTemplate = StatusUriTemplates.Status)]
  StatusResultSet GetProgress();
} 
```

在服务器中实现它：

```
 [ServiceBehavior(InstanceContextMode = InstanceContextMode.Single)]
  public class ServerStatusService : IStatusService
  {
    public StatusResultSet GetProgressAsJson()
    { return GetProgress(); }

    public StatusResultSet GetProgressAsXml()
    { return GetProgress(); }

    public StatusResultSet GetProgress()
    {
       return StatusResultSet.Empty;
    }
  } 
```

在运行时从我的代码中公开它：

```
 var service = new ServerStatusService();
  var binding = new WebHttpBinding();
  var behavior = new WebHttpBehavior();

  var host = new WebServiceHost(service, new Uri("http://localhost:8000/server"));
  host.AddServiceEndpoint(typeof(IStatusService), binding, "status");
  host.Open(); 
```

我什至成功地使用了 .NET 控制台/winfoems/WPF 应用程序中的服务，使用了以下内容：

```
 var cf = new WebChannelFactory<IStatusService>(new Uri("http://localhost:8000/server/status"));
  var ss = cf.CreateChannel();
  Console.WriteLine(ss.GetProgress().TimeStamp); 
```

我要打的“墙”是 SliverLight 没有 WebChannelFactory。

时期。

这意味着当涉及到 silverlight 代码时，我的选择是：

*   使用 WebClient 编写丑陋的代码，这最终意味着每当我对我的 API 进行更改时，我都必须更新两组代码
*   对 WebService 使用 SOAP/WS 并不断更新 Visual Studio 中的服务引用

有没有办法在 SilverLight 中使用 WebChannelFactory 保持“干净”的实现？或许是 SilverLight 的公共领域/开源 WebChannelFactory？

对此的任何帮助将不胜感激！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-24T16:31:59.070

如果这是一个简单的 Xml REST 服务，为什么不使用 Silverlight 中的 WebClient 来使用 Linq to XML 捕获 XML？我知道你说它很乱，但这完全取决于你如何看待它。如果您随时更改服务接口，您将不得不在多个地方更新您的代码。就是那样子。

因此，要做到这一点，您需要以异步方式从 WebClient 捕获数据，然后使用 LINQ to XML 对其进行解析。

Time Heuer 在他的网站上有一个很好的例子：http: [//timheuer.com/blog/archive/2008/03/14/calling-web-services-with-silverlight-2.aspx](http://timheuer.com/blog/archive/2008/03/14/calling-web-services-with-silverlight-2.aspx)

本质上，它看起来像这样：

```
WebClient rest = new WebClient();
rest.DownloadStringCompleted += new DownloadStringCompletedEventHandler(rest_DownloadStringCompleted);
rest.DownloadStringAsync(new Uri("http://example.org/current-status/xml")); 
```

然后在您的“rest_DownloadStringCompleted”中，您会将字符串解析为 XML。像这样：

```
string data = e.Result;
string url = string.Empty;

XDocument doc = XDocument.Parse(e.Result);
var myResults = from results in doc.Descendants("myXmlElement") ... blah blah blah 
```

我对来自 WCF 和 Silverlight 的本土 REST 服务做了同样的事情，而且效果很好。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-12T07:39:53.180

[我几乎不想建议它，但是您对重新实现 WebChannelFactory<T> 类](http://msdn.microsoft.com/en-us/library/ms405827(VS.95).aspx "ChannelFactoryBase<TChannel>")感到满意吗？

粗略浏览一下 Silverlight API，您似乎不会从 Microsoft 开箱即用地获得太多帮助。您需要为它重新实现一个通道类和一个工厂。

也许另一种创建通道并将自己与特定于平台的代码隔离的方法是创建它的自定义实现？具体来说，我的意思是，您创建了另一个工厂类，并且工厂类在可用时调用 WebChannelFactory，或者为您进行设置。

抱歉，我没有更深入的建议。:)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-04-21T12:51:46.590

您缺少 Spring.Rest ： [http ://springframework.net/index.html#spring-rest-1.0.0-released](http://springframework.net/index.html#spring-rest-1.0.0-released)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-04-20T09:29:39.857

到目前为止，我已经找到了一些 WebChannelFactory 的替代方案，用于在 Silverlight 中使用 REST 服务。他们都在论坛和博客上看到了赞誉，但我自己还没有尝试过。我相信这三个都使用泛型轻松地将请求响应反序列化为 CLR 对象。

*   [RestSharp](https://github.com/johnsheehan/RestSharp/wiki/Recommended-Usage)
*   [Silverlight 的 REST 客户端](http://www.hardcodet.net/2010/02/wcf-rest-starter-kit-for-silverlight)，从 WCF REST Starter Kit 移植
*   [吊床](http://hammock.codeplex.com/documentation)

我倾向于 RestSharp，因为它的示例在我看来既简单又可扩展。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-06-11T22:59:27.713

I recently ran into the same problem and decided to create a class that has a simplified REST client interface for Silverlight, more or less like WebChannelFactory. Has synchronous-like behavior also.

[http://regular-language.blogspot.com/2011/06/wcf-webhttp-rest-client-for-silverlight.html](http://regular-language.blogspot.com/2011/06/wcf-webhttp-rest-client-for-silverlight.html)

# sql-server - 我应该摆脱 Guid 列上的聚集索引吗

> ID：277625
> 
> 赞同：37
> 
> 时间：2008-11-10T11:06:47.753
> 
> 标签：sql-server, guid, clustered-index

我正在研究一个通常使用 GUID 作为主键的数据库。

默认情况下，SQL Server 在主键列上放置一个聚集索引。我知道这对于 GUID 列是一个愚蠢的想法，并且非聚集索引更好。

你怎么看 - 我应该摆脱所有聚集索引并用非聚集索引替换它们吗？

为什么 SQL 的性能调整器不提供此建议？

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2008-11-10T11:17:40.680

聚集索引的一个重要原因是当您经常想要检索给定列的一系列值的行时。因为数据是按物理顺序排列的，所以可以非常有效地提取行。

像 GUID 这样的东西，虽然对于主键非常有用，但可能会对性能产生积极的不利影响，因为插入会产生额外的成本，而对选择没有明显的好处。

所以是的，不要在 GUID 上聚集索引。

至于为什么不将其作为推荐提供，我建议调谐器知道这一事实。

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2008-11-10T14:58:51.560

您几乎肯定希望在数据库中的每个表上建立一个聚集索引。如果表没有聚集索引，则它被称为“堆”，并且大多数类型的常见查询的性能[对于堆来说不如聚集索引表](http://msdn.microsoft.com/en-us/library/cc917672.aspx)。

应该在哪些字段上建立聚集索引取决于表本身，以及针对表的查询的预期使用模式。在几乎所有情况下，您可能希望聚集索引位于唯一的列或列组合上，即（备用键），因为如果不是，SQL 将在任何内容的末尾添加一个唯一值无论如何选择的字段。如果您的表中有一个或多个列将被查询频繁使用以选择或过滤多条记录，（例如，如果您的表包含销售交易，并且您的应用程序将经常按产品 ID 请求销售交易，甚至更好，发票详细信息表，几乎在每种情况下，您都将检索特定发票的所有详细记录，

这些列是聚集索引的候选。聚集索引中列的顺序很关键。索引中定义的第一列应该是在预期查询中将首先选择或过滤的列。

这一切的原因是基于对数据库索引的内部结构的理解。这些索引称为平衡树 (B-Tree) 索引。它们有点像二叉树，除了树中的每个节点可以有任意数量的条目（和子节点），而不仅仅是两个。聚集索引的不同之处在于，聚集索引中的叶节点是表本身的实际物理磁盘数据页。而非聚集索引的叶节点只是“指向”表的数据页。

因此，当表具有聚集索引时，表数据页是该索引的叶级，并且每个表都有一个指向索引顺序中的上一页和下一页的指针（它们形成一个双向链表） .

因此，如果您的查询请求与聚集索引顺序相同的一系列行......处理器只需遍历索引一次（或可能两次），即可找到数据的起始页，然后按照链表指针指向下一页和下一页，直到它读取了它需要的所有数据页。

对于非聚集索引，它必须为检索到的每一行遍历索引一次......

注意：编辑
要解决 Guid Key 列的顺序问题，请注意 SQL2k5 具有 NEWSEQUENTIALID() 实际上确实以“旧”顺序方式生成 Guid。

或者您可以研究在客户端代码中实现的 Jimmy Nielsens COMB guid 算法：

[梳状导轨](http://www.informit.com/articles/article.aspx?p=25862)

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-11-10T11:12:14.093

GUID 字段中的聚集索引的问题在于 GUID 是随机的，因此当插入新记录时，必须移动磁盘上的大部分数据以将记录插入到表的中间。

然而，对于基于整数的聚集索引，整数通常是顺序的（就像使用`IDENTITY`规范一样），所以它们只是被添加到末尾，不需要移动任何数据。

另一方面，聚集索引在 GUID 上并不总是不好的……这完全取决于您的应用程序的需要。如果您需要能够`SELECT`快速记录，那么使用聚集索引......`INSERT`速度会受到影响，但`SELECT`速度会有所提高。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-11-10T12:21:46.497

虽然在 GUID 上进行集群通常不是一个好主意，但请注意，[即使在非集群索引中，GUID 在某些情况下也会导致碎片](http://sqlskills.com/BLOGS/PAUL/post/Can-GUID-cluster-keys-cause-non-clustered-index-fragmentation.aspx)。

请注意，如果您使用的是 SQL Server 2005，则[newsequentialid()](http://msdn.microsoft.com/en-us/library/ms189786.aspx)函数会生成**顺序**GUID。这有助于防止碎片问题。

我建议在做出任何决定之前使用如下 SQL 查询来测量碎片（请原谅非 ANSI 语法）：

```
SELECT OBJECT_NAME (ips.[object_id]) AS 'Object Name',
       si.name AS 'Index Name',
       ROUND (ips.avg_fragmentation_in_percent, 2) AS 'Fragmentation',
       ips.page_count AS 'Pages',
       ROUND (ips.avg_page_space_used_in_percent, 2) AS 'Page Density'
FROM sys.dm_db_index_physical_stats 
     (DB_ID ('MyDatabase'), NULL, NULL, NULL, 'DETAILED') ips
CROSS APPLY sys.indexes si
WHERE si.object_id = ips.object_id
AND   si.index_id = ips.index_id
AND   ips.index_level = 0; 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-11-10T11:41:29.197

如果您使用 NewId()，则可以切换到 NewSequentialId()。这应该有助于插入性能。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-11-10T12:59:08.310

是的，在随机值上使用聚集索引是没有意义的。

您可能确实希望在数据库中的某个地方使用聚簇索引。例如，如果您有一个“Author”表和一个带有“Author”外键的“Book”表，并且如果您的应用程序中有一个查询显示“select ... from Book where AuthorId = .. "，那么您将阅读一组书籍。如果这些书在磁盘上物理上彼此相邻，则速度会更快，这样磁盘头就不必从一个扇区跳到另一个扇区来收集该作者的所有书籍。

因此，您需要考虑您的应用程序，它查询数据库的方式。

进行更改。

然后测试，因为你永远不知道...

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2013-01-29T17:53:54.733

正如大多数人所提到的，避免在聚集索引中使用随机标识符——你不会获得聚集的好处。实际上，您会遇到延迟增加的情况。摆脱所有这些是可靠的建议。还要记住 newsequentialid() 在多主复制场景中可能会出现极大的问题。如果数据库 A 和 B 在复制之前都调用了 newsequentialid()，就会发生冲突。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-10T11:14:37.427

是的，由于 Galwegian 上述原因，您应该删除 GUID 主键上的聚集索引。我们已经在我们的应用程序上做到了这一点。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-10T11:16:30.573

这取决于您是否要进行大量插入，或者您是否需要通过 PK 快速查找。

# java - Hibernate JPA 序列（非 Id）

> ID：277630
> 
> 赞同：149
> 
> 时间：2008-11-10T11:09:56.873
> 
> 标签：java, hibernate, jpa, sequence

**是否可以对某些不是标识符/不是复合标识符一部分的**列使用 DB 序列？

我使用休眠作为 jpa 提供程序，并且我有一个表，其中包含一些生成值（使用序列）的列，尽管它们不是标识符的一部分。

我想要的是使用序列为实体创建一个新值，其中序列的列**不是**主键（部分）：

```
@Entity
@Table(name = "MyTable")
public class MyEntity {

    //...
    @Id //... etc
    public Long getId() {
        return id;
    }

   //note NO @Id here! but this doesn't work...
    @GeneratedValue(strategy = GenerationType.AUTO, generator = "myGen")
    @SequenceGenerator(name = "myGen", sequenceName = "MY_SEQUENCE")
    @Column(name = "SEQ_VAL", unique = false, nullable = false, insertable = true, updatable = true)
    public Long getMySequencedValue(){
      return myVal;
    }

} 
```

然后当我这样做时：

```
em.persist(new MyEntity()); 
```

将生成 id，但`mySequenceVal`属性也将由我的 JPA 提供程序生成。

只是为了说清楚：我希望**Hibernate**为`mySequencedValue`属性生成值。我知道 Hibernate 可以处理数据库生成的值，但我不想使用触发器或除 Hibernate 本身之外的任何其他东西来为我的属性生成值。如果 Hibernate 可以为主键生成值，为什么它不能为一个简单的属性生成值？

* * *

## 回答 #1

> 赞同：85
> 
> 时间：2009-02-11T09:35:27.700

寻找这个问题的答案，我偶然发现了[这个链接](http://forum.hibernate.org/viewtopic.php?p=2405140)

似乎 Hibernate/JPA 无法自动为您的非 ID 属性创建值。`@GeneratedValue`注释仅用于与`@Id`创建自动编号一起使用。

`@GeneratedValue`注释只是告诉 Hibernate 数据库正在自己生成这个值。

该论坛中建议的解决方案（或解决方法）是使用生成的 ID 创建一个单独的实体，如下所示：

```
@实体
公共类 GeneralSequenceNumber {
  @ID
  @GeneratedValue(...)
  私人长号；
}

@实体
公共类 MyEntity {
  @ID ..
  私人长ID；

  @OneToOne(...)
  私人 GeneralSequnceNumber myVal；
}

```

* * *

## 回答 #2

> 赞同：57
> 
> 时间：2012-05-18T06:44:57.017

我发现这很`@Column(columnDefinition="serial")`完美，但只适用于 PostgreSQL。对我来说，这是完美的解决方案，因为第二个实体是“丑陋”的选择。

对实体的调用`saveAndFlush`也是必要的，并且`save`不足以从数据库中填充值。

* * *

## 回答 #3

> 赞同：26
> 
> 时间：2014-05-23T14:12:51.347

我知道这是一个非常古老的问题，但它首先显示在结果上，并且 jpa 自从这个问题以来发生了很大变化。

现在正确的方法是使用`@Generated`注释。您可以定义序列，将列中的默认值设置为该序列，然后将列映射为：

```
@Generated(GenerationTime.INSERT)
@Column(name = "column_name", insertable = false) 
```

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2008-11-12T10:57:19.037

Hibernate 绝对支持这一点。从文档：

“生成的属性是其值由数据库生成的属性。通常，Hibernate 应用程序需要刷新包含数据库为其生成值的任何属性的对象。但是，将属性标记为已生成，可以让应用程序将此责任委托给 Hibernate。本质上，每当 Hibernate 为已定义生成属性的实体发出 SQL INSERT 或 UPDATE 时，它会立即发出 select 以检索生成的值。”

对于仅在插入时生成的属性，您的属性映射 (.hbm.xml) 如下所示：

```
<property name="foo" generated="insert"/> 
```

对于插入和更新属性映射 (.hbm.xml) 时生成的属性，如下所示：

```
<property name="foo" generated="always"/> 
```

不幸的是，我不知道 JPA，所以我不知道这个功能是否通过 JPA 公开（我怀疑可能不是）

或者，您应该能够从插入和更新中排除该属性，然后“手动”调用 session.refresh(obj); 在您插入/更新它以从数据库加载生成的值之后。

这是您将属性排除在插入和更新语句中的方式：

```
<property name="foo" update="false" insert="false"/> 
```

同样，我不知道 JPA 是否公开了这些 Hibernate 特性，但 Hibernate 确实支持它们。

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2016-03-09T09:59:49.097

`@PrePersist`我使用注释修复了 Hibernate 的 UUID（或序列）的生成：

```
@PrePersist
public void initializeUUID() {
    if (uuid == null) {
        uuid = UUID.randomUUID().toString();
    }
} 
```

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2010-04-19T16:42:02.247

作为后续工作，这是我如何让它工作的：

```
@Override public Long getNextExternalId() {
    BigDecimal seq =
        (BigDecimal)((List)em.createNativeQuery("select col_msd_external_id_seq.nextval from dual").getResultList()).get(0);
    return seq.longValue();
} 
```

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2018-11-23T18:52:25.390

如果您使用的是 postgresql
而我在 spring boot 1.5.6 中使用

```
@Column(columnDefinition = "serial")
@Generated(GenerationTime.INSERT)
private Integer orderID; 
```

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2019-05-07T06:51:41.873

看起来线程很旧，我只是想在此处添加我的解决方案（在春季使用 AspectJ - AOP）。

解决方案是创建一个自定义注释`@InjectSequenceValue`，如下所示。

```
@Retention(RetentionPolicy.RUNTIME)
@Target(ElementType.FIELD)
public @interface InjectSequenceValue {
    String sequencename();
} 
```

现在您可以注释实体中的任何字段，以便在运行时使用序列的下一个值注入底层字段（Long/Integer）值。

像这样注释。

```
//serialNumber will be injected dynamically, with the next value of the serialnum_sequence.
 @InjectSequenceValue(sequencename = "serialnum_sequence") 
  Long serialNumber; 
```

到目前为止，我们已经标记了我们需要注入序列值的字段。所以我们将看看如何将序列值注入标记的字段，这是通过在 AspectJ 中创建切点来完成的。

`save/persist`我们将在方法执行之前触发注入。这是在下面的类中完成的。

```
@Aspect
@Configuration
public class AspectDefinition {

    @Autowired
    JdbcTemplate jdbcTemplate;

    //@Before("execution(* org.hibernate.session.save(..))") Use this for Hibernate.(also include session.save())
    @Before("execution(* org.springframework.data.repository.CrudRepository.save(..))") //This is for JPA.
    public void generateSequence(JoinPoint joinPoint){

        Object [] aragumentList=joinPoint.getArgs(); //Getting all arguments of the save
        for (Object arg :aragumentList ) {
            if (arg.getClass().isAnnotationPresent(Entity.class)){ // getting the Entity class

                Field[] fields = arg.getClass().getDeclaredFields();
                for (Field field : fields) {
                    if (field.isAnnotationPresent(InjectSequenceValue.class)) { //getting annotated fields

                        field.setAccessible(true); 
                        try {
                            if (field.get(arg) == null){ // Setting the next value
                                String sequenceName=field.getAnnotation(InjectSequenceValue.class).sequencename();
                                long nextval=getNextValue(sequenceName);
                                System.out.println("Next value :"+nextval); //TODO remove sout.
                                field.set(arg, nextval);
                            }

                        } catch (Exception e) {
                            e.printStackTrace();
                        }
                    }
                }
            }

        }
    }

    /**
     * This method fetches the next value from sequence
     * @param sequence
     * @return
     */

    public long getNextValue(String sequence){
        long sequenceNextVal=0L;

        SqlRowSet sqlRowSet= jdbcTemplate.queryForRowSet("SELECT "+sequence+".NEXTVAL as value FROM DUAL");
        while (sqlRowSet.next()){
            sequenceNextVal=sqlRowSet.getLong("value");

        }
        return  sequenceNextVal;
    }
} 
```

现在您可以如下注释任何实体。

```
@Entity
@Table(name = "T_USER")
public class UserEntity {

    @Id
    @SequenceGenerator(sequenceName = "userid_sequence",name = "this_seq")
    @GeneratedValue(strategy = GenerationType.SEQUENCE,generator = "this_seq")
    Long id;
    String userName;
    String password;

    @InjectSequenceValue(sequencename = "serialnum_sequence") // this will be injected at the time of saving.
    Long serialNumber;

    String name;
} 
```

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2012-08-07T09:16:18.750

虽然这是一个旧线程，但我想分享我的解决方案，并希望得到一些反馈。请注意，我仅在某些 JUnit 测试用例中使用本地数据库测试了此解决方案。因此，到目前为止，这还不是一个富有成效的功能。

我通过引入一个名为 Sequence 且没有属性的自定义注释为我解决了这个问题。它只是应该从递增序列中分配值的字段的标记。

```
@Retention(RetentionPolicy.RUNTIME)
@Target(ElementType.FIELD)
public @interface Sequence
{
} 
```

使用此注释我标记了我的实体。

```
public class Area extends BaseEntity implements ClientAware, IssuerAware
{
    @Column(name = "areaNumber", updatable = false)
    @Sequence
    private Integer areaNumber;
....
} 
```

为了保持数据库独立，我引入了一个名为 SequenceNumber 的实体，它保存序列当前值和增量大小。我选择了 className 作为唯一键，所以每个实体类都会有自己的序列。

```
@Entity
@Table(name = "SequenceNumber", uniqueConstraints = { @UniqueConstraint(columnNames = { "className" }) })
public class SequenceNumber
{
    @Id
    @Column(name = "className", updatable = false)
    private String className;

    @Column(name = "nextValue")
    private Integer nextValue = 1;

    @Column(name = "incrementValue")
    private Integer incrementValue = 10;

    ... some getters and setters ....
} 
```

最后一步也是最困难的一步是处理序列号分配的 PreInsertListener。请注意，我使用 spring 作为 bean 容器。

```
@Component
public class SequenceListener implements PreInsertEventListener
{
    private static final long serialVersionUID = 7946581162328559098L;
    private final static Logger log = Logger.getLogger(SequenceListener.class);

    @Autowired
    private SessionFactoryImplementor sessionFactoryImpl;

    private final Map<String, CacheEntry> cache = new HashMap<>();

    @PostConstruct
    public void selfRegister()
    {
        // As you might expect, an EventListenerRegistry is the place with which event listeners are registered
        // It is a service so we look it up using the service registry
        final EventListenerRegistry eventListenerRegistry = sessionFactoryImpl.getServiceRegistry().getService(EventListenerRegistry.class);

        // add the listener to the end of the listener chain
        eventListenerRegistry.appendListeners(EventType.PRE_INSERT, this);
    }

    @Override
    public boolean onPreInsert(PreInsertEvent p_event)
    {
        updateSequenceValue(p_event.getEntity(), p_event.getState(), p_event.getPersister().getPropertyNames());

        return false;
    }

    private void updateSequenceValue(Object p_entity, Object[] p_state, String[] p_propertyNames)
    {
        try
        {
            List<Field> fields = ReflectUtil.getFields(p_entity.getClass(), null, Sequence.class);

            if (!fields.isEmpty())
            {
                if (log.isDebugEnabled())
                {
                    log.debug("Intercepted custom sequence entity.");
                }

                for (Field field : fields)
                {
                    Integer value = getSequenceNumber(p_entity.getClass().getName());

                    field.setAccessible(true);
                    field.set(p_entity, value);
                    setPropertyState(p_state, p_propertyNames, field.getName(), value);

                    if (log.isDebugEnabled())
                    {
                        LogMF.debug(log, "Set {0} property to {1}.", new Object[] { field, value });
                    }
                }
            }
        }
        catch (Exception e)
        {
            log.error("Failed to set sequence property.", e);
        }
    }

    private Integer getSequenceNumber(String p_className)
    {
        synchronized (cache)
        {
            CacheEntry current = cache.get(p_className);

            // not in cache yet => load from database
            if ((current == null) || current.isEmpty())
            {
                boolean insert = false;
                StatelessSession session = sessionFactoryImpl.openStatelessSession();
                session.beginTransaction();

                SequenceNumber sequenceNumber = (SequenceNumber) session.get(SequenceNumber.class, p_className);

                // not in database yet => create new sequence
                if (sequenceNumber == null)
                {
                    sequenceNumber = new SequenceNumber();
                    sequenceNumber.setClassName(p_className);
                    insert = true;
                }

                current = new CacheEntry(sequenceNumber.getNextValue() + sequenceNumber.getIncrementValue(), sequenceNumber.getNextValue());
                cache.put(p_className, current);
                sequenceNumber.setNextValue(sequenceNumber.getNextValue() + sequenceNumber.getIncrementValue());

                if (insert)
                {
                    session.insert(sequenceNumber);
                }
                else
                {
                    session.update(sequenceNumber);
                }
                session.getTransaction().commit();
                session.close();
            }

            return current.next();
        }
    }

    private void setPropertyState(Object[] propertyStates, String[] propertyNames, String propertyName, Object propertyState)
    {
        for (int i = 0; i < propertyNames.length; i++)
        {
            if (propertyName.equals(propertyNames[i]))
            {
                propertyStates[i] = propertyState;
                return;
            }
        }
    }

    private static class CacheEntry
    {
        private int current;
        private final int limit;

        public CacheEntry(final int p_limit, final int p_current)
        {
            current = p_current;
            limit = p_limit;
        }

        public Integer next()
        {
            return current++;
        }

        public boolean isEmpty()
        {
            return current >= limit;
        }
    }
} 
```

从上面的代码可以看出，监听器为每个实体类使用了一个 SequenceNumber 实例，并保留了一对由 SequenceNumber 实体的 incrementValue 定义的序列号。如果序列号用完，它会为目标类加载 SequenceNumber 实体，并为下一次调用保留 incrementValue 值。这样我就不需要在每次需要序列值时查询数据库。请注意为保留下一组序列号而打开的 StatelessSession。您不能使用目标实体当前持久化的同一会话，因为这会导致 EntityPersister 中的 ConcurrentModificationException。

希望这可以帮助某人。

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2008-11-21T14:24:49.437

我在与您相同的情况下运行，如果基本上可以使用 JPA 生成非 id 属性，我也没有找到任何严肃的答案。

我的解决方案是使用本机 JPA 查询调用序列，以便在持久化之前手动设置属性。

这并不令人满意，但它目前可以作为一种解决方法。

马里奥

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2010-11-24T19:31:38.870

我在 JPA 规范的会话 9.1.9 GeneratedValue Annotation 中找到了这个特定的注释：“[43] 便携式应用程序不应在其他持久字段或属性上使用 GeneratedValue 注释。” 因此，我认为至少仅使用 JPA 无法为非主键值自动生成值。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2020-05-05T13:47:30.107

我想在@Morten Berg 接受的解决方案旁边提供一个替代方案，这对我来说效果更好。

这种方法允许使用实际需要的`Number`类型定义字段 -`Long`在我的用例中 - 而不是`GeneralSequenceNumber`. 这可能很有用，例如对于 JSON（反）序列化。

缺点是它需要更多的数据库开销。

* * *

首先，我们需要一个`ActualEntity`我们想要自动递增`generated`类型的类型`Long`：

```
// ...
@Entity
public class ActualEntity {

    @Id 
    // ...
    Long id;

    @Column(unique = true, updatable = false, nullable = false)
    Long generated;

    // ...

} 
```

接下来，我们需要一个辅助实体`Generated`。我将它放在 package-private 旁边`ActualEntity`，以使其成为包的实现细节：

```
@Entity
class Generated {

    @Id
    @GeneratedValue(strategy = SEQUENCE, generator = "seq")
    @SequenceGenerator(name = "seq", initialValue = 1, allocationSize = 1)
    Long id;

} 
```

最后，我们需要在保存`ActualEntity`. 在那里，我们创建并持久化一个`Generated`实例。然后，这提供了一个`id`类型为 的数据库序列`Long`。我们通过将其写入来使用此值`ActualEntity.generated`。

在我的用例中，我使用 Spring Data REST 实现了这一点，它在get 持久化`@RepositoryEventHandler`之前被调用。`ActualEntity`它应该展示的原则：

```
@Component
@RepositoryEventHandler
public class ActualEntityHandler {

    @Autowired
    EntityManager entityManager;

    @Transactional
    @HandleBeforeCreate
    public void generate(ActualEntity entity) {
        Generated generated = new Generated();

        entityManager.persist(generated);
        entity.setGlobalId(generated.getId());
        entityManager.remove(generated);
    }

} 
```

我没有在实际应用程序中对其进行测试，因此请谨慎使用。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2022-02-03T23:25:25.580

你可以完全按照你的要求去做。

我发现可以通过向[Integrator注册来调整 Hibernate 的](https://docs.jboss.org/hibernate/orm/5.6/javadocs/org/hibernate/integrator/spi/Integrator.html)[IdentifierGenerator](https://docs.jboss.org/hibernate/orm/5.6/javadocs/org/hibernate/id/IdentifierGenerator.html)实现。有了这个，您应该能够使用 Hibernate 提供的任何 id 序列生成器来为非 id 字段生成序列（假设非序列 id 生成器也可以工作）。

以这种方式生成 id 有很多选择。查看 IdentifierGenerator 的一些实现，特别是[SequenceStyleGenerator](https://docs.jboss.org/hibernate/orm/5.6/javadocs/org/hibernate/id/enhanced/SequenceStyleGenerator.html)和[TableGenerator](https://docs.jboss.org/hibernate/orm/5.6/javadocs/org/hibernate/id/enhanced/TableGenerator.html)。如果您使用[@GenericGenerator](https://docs.jboss.org/hibernate/orm/5.6/javadocs/index.html?org/hibernate/id/enhanced/TableGenerator.html)注解配置了生成器，那么您可能对这些类的参数很熟悉。这还具有使用 Hibernate 生成 SQL 的优势。

这是我如何让它工作的：

```
import org.hibernate.Session;
import org.hibernate.boot.Metadata;
import org.hibernate.engine.spi.SessionFactoryImplementor;
import org.hibernate.id.IdentifierGenerator;
import org.hibernate.id.enhanced.TableGenerator;
import org.hibernate.integrator.spi.Integrator;
import org.hibernate.internal.SessionImpl;
import org.hibernate.service.spi.SessionFactoryServiceRegistry;
import org.hibernate.tuple.ValueGenerator;
import org.hibernate.type.LongType;
import java.util.Properties;

public class SequenceIntegrator implements Integrator, ValueGenerator<Long> {
    public static final String TABLE_NAME = "SEQUENCE_TABLE";
    public static final String VALUE_COLUMN_NAME = "NEXT_VAL";
    public static final String SEGMENT_COLUMN_NAME = "SEQUENCE_NAME";
    private static SessionFactoryServiceRegistry serviceRegistry;
    private static Metadata metadata;
    private static IdentifierGenerator defaultGenerator;

    @Override
    public void integrate(Metadata metadata, SessionFactoryImplementor sessionFactoryImplementor, SessionFactoryServiceRegistry sessionFactoryServiceRegistry) {
        //assigning metadata and registry to fields for use in a below example
        SequenceIntegrator.metadata = metadata;
        SequenceIntegrator.serviceRegistry = sessionFactoryServiceRegistry;
        SequenceIntegrator.defaultGenerator = getTableGenerator(metadata, sessionFactoryServiceRegistry, "DEFAULT");
    }

    private TableGenerator getTableGenerator(Metadata metadata, SessionFactoryServiceRegistry sessionFactoryServiceRegistry, String segmentValue) {
        TableGenerator generator = new TableGenerator();
        Properties properties = new Properties();
        properties.setProperty("table_name", TABLE_NAME);
        properties.setProperty("value_column_name", VALUE_COLUMN_NAME);
        properties.setProperty("segment_column_name", SEGMENT_COLUMN_NAME);
        properties.setProperty("segment_value", segmentValue);

        //any type should work if the generator supports it
        generator.configure(LongType.INSTANCE, properties, sessionFactoryServiceRegistry);

        //this should create the table if ddl auto update is enabled and if this function is called inside of the integrate method
        generator.registerExportables(metadata.getDatabase());
        return generator;
    }

    @Override
    public Long generateValue(Session session, Object o) {
        // registering additional generators with getTableGenerator will work here. inserting new sequences can be done dynamically
        // example:
        // TableGenerator classSpecificGenerator = getTableGenerator(metadata, serviceRegistry, o.getClass().getName());
        // return (Long) classSpecificGenerator.generate((SessionImpl)session, o);
        return (Long) defaultGenerator.generate((SessionImpl)session, o);
    }

    @Override
    public void disintegrate(SessionFactoryImplementor sessionFactoryImplementor, SessionFactoryServiceRegistry sessionFactoryServiceRegistry) {

    }
} 
```

您需要在 META-INF/services 目录中注册此类。以下是 Hibernate 文档中关于注册集成器的内容：

> 为了在 Hibernate 启动时自动使用集成器，您需要将 META-INF/services/org.hibernate.integrator.spi.Integrator 文件添加到您的 jar 中。该文件应包含实现接口的类的完全限定名称。

因为这个类实现了[ValueGenerator](https://docs.jboss.org/hibernate/orm/5.6/javadocs/org/hibernate/tuple/ValueGenerator.html)类，所以它可以与[@GeneratorType](https://docs.jboss.org/hibernate/orm/5.6/javadocs/org/hibernate/annotations/GeneratorType.html)注解一起使用来自动生成顺序值。以下是您的课程的配置方式：

```
@Entity
@Table(name = "MyTable")
public class MyEntity {

    //...
    @Id //... etc
    public Long getId() {
        return id;
    }

    @GeneratorType(type = SequenceIntegrator.class, when = GenerationTime.INSERT)
    @Column(name = "SEQ_VAL", unique = false, nullable = false, insertable = true, updatable = true)
    public Long getMySequencedValue(){
      return myVal;
    }

} 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-11-17T16:29:24.443

“我不想使用触发器或除 Hibernate 本身之外的任何其他东西来为我的财产生成价值”

在这种情况下，如何创建生成所需值的 UserType 实现，并配置元数据以使用该 UserType 来持久化 mySequenceVal 属性？

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-11-11T20:36:46.697

这与使用序列不同。使用序列时，您不会插入或更新任何内容。您只是在检索下一个序列值。看起来hibernate不支持它。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2019-11-11T08:39:20.260

如果您有一列具有 UNIQUEIDENTIFIER 类型并且插入时需要默认生成但列不是 PK

```
@Generated(GenerationTime.INSERT)
@Column(nullable = false , columnDefinition="UNIQUEIDENTIFIER")
private String uuidValue; 
```

在分贝中，您将拥有

```
CREATE TABLE operation.Table1
(
    Id         INT IDENTITY (1,1)               NOT NULL,
    UuidValue  UNIQUEIDENTIFIER DEFAULT NEWID() NOT NULL) 
```

在这种情况下，您不会为您需要的值定义生成器（它将自动感谢 `columnDefinition="UNIQUEIDENTIFIER"`）。您可以尝试其他列类型相同

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2020-04-18T23:13:09.327

我在 Spring 应用程序中使用 @PostConstruct 和 JdbcTemplate 在 MySql 数据库上找到了解决方法。它可能适用于其他数据库，但我将介绍的用例是基于我对 MySql 的经验，因为它使用 auto_increment。

首先，我尝试使用 @Column 注释的 ColumnDefinition 属性将列定义为 auto_increment，但它不起作用，因为列需要成为键才能自动增量，但显然该列不会被定义为一个索引直到它被定义之后，导致死锁。

在这里，我想到了在没有 auto_increment 定义的情况下创建列，并在创建数据库*后添加它。*这可以使用@PostConstruct 注释来实现，它会在应用程序初始化bean 之后立即调用一个方法，再加上JdbcTemplate 的更新方法。

代码如下：

在我的实体中：

```
@Entity
@Table(name = "MyTable", indexes = { @Index(name = "my_index", columnList = "mySequencedValue") })
public class MyEntity {
    //...
    @Column(columnDefinition = "integer unsigned", nullable = false, updatable = false, insertable = false)
    private Long mySequencedValue;
    //...
} 
```

在 PostConstructComponent 类中：

```
@Component
public class PostConstructComponent {
    @Autowired
    private JdbcTemplate jdbcTemplate;

    @PostConstruct
    public void makeMyEntityMySequencedValueAutoIncremental() {
        jdbcTemplate.update("alter table MyTable modify mySequencedValue int unsigned auto_increment");
    }
} 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2020-09-01T13:29:02.057

我今天正在为此苦苦挣扎，能够使用它来解决

```
@Generated(GenerationTime.INSERT)
@Column(name = "internal_id", columnDefinition = "serial", updatable = false)
private int internalId; 
```

* * *

## 回答 #19

> 赞同：-1
> 
> 时间：2008-11-12T01:54:33.953

我遇到过像你这样的情况（非@Id 字段的JPA/Hibernate 序列），我最终在我的数据库模式中创建了一个触发器，该触发器在插入时添加了一个唯一的序列号。我只是从来没有让它与 JPA/Hibernate 一起工作

* * *

## 回答 #20

> 赞同：-1
> 
> 时间：2018-03-19T17:03:44.140

花了几个小时后，这巧妙地帮助我解决了我的问题：

对于 Oracle 12c：

```
ID NUMBER GENERATED as IDENTITY 
```

对于 H2：

```
ID BIGINT GENERATED as auto_increment 
```

还制作：

```
@Column(insertable = false) 
```

# c# - Linq查询返回父子的扁平列表

> ID：277634
> 
> 赞同：5
> 
> 时间：2008-11-10T11:11:35.357
> 
> 标签：c#, linq

对 linq 的世界来说还是新手，我需要一些帮助，将有孩子的父母名单整理成一个 ParentChild 的名单。

像这样：

```
class Program
{
    static void Main()
    {
        List<Parent> parents = new List<Parent>();

        parents.Add(new Parent { Name = "Parent1", Children = new List<Child> { new Child { Name = "Child1" }, new Child { Name = "Child2" } } });
        parents.Add(new Parent { Name = "Parent2", Children = new List<Child> { new Child { Name = "Child3" }, new Child { Name = "Child4" } } });

        // linq query to return List<ParentChild> parentChildList;
        // ParentName = Parent1, ChildName = Child1
        // ParentName = Parent1, ChildName = Child2
        // ParentName = Parent2, ChildName = Child3
        // ParentName = Parent2, ChildName = Child4
    }

    internal class ParentChild
    {
        public string ParentName { get; set; }
        public string ChildName { get; set; }
    }

    internal class Parent
    {
        public string Name { get; set; }
        public List<Child> Children { get; set; }
    }

    internal class Child
    {
        public string Name { get; set; }
    }
} 
```

非常感谢，克里斯

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-11-10T11:12:32.843

```
from parent in parents
from child in parent.Children
select new ParentChild() { ParentName = parent.Name, ChildName = child.Name }; 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-10T11:18:40.303

这应该为你做：

```
var k = from p in parents
        from c in p.Children
        select new {Name = p.Name, Child = c.Name }; 
```

编辑：Opps 忘记返回一个新的 ParentChild 对象。但肯特打败了我；）

# data-structures - 哈希函数和表格大小为 2^p 的表

> ID：277638
> 
> 赞同：0
> 
> 时间：2008-11-10T11:12:44.810
> 
> 标签：data-structures, hash

在从一个键的​​哈希码计算哈希表桶索引时，为什么当桶数组的大小是 2 的幂时，我们避免使用除法后的余数（模）？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-10T11:21:24.887

在计算散列时，您需要尽可能多的信息，并且可以在整个位范围内以良好的分布情况廉价地将其转换为：例如，32 位无符号整数通常是好的，除非您有很多（> 30 亿）项要存储在哈希表中。

它将哈希码转换为您真正感兴趣的存储桶索引。当存储桶的数量 n 是 2 的幂时，您需要做的就是在哈希码 h 和 (n-1) 之间进行 AND 运算，结果等于 h mod n。

这可能不好的一个原因是 AND 操作只是从哈希码中丢弃位 - 高级位。这可能是好是坏，取决于其他事情。一方面，它会非常快，因为 AND 比除法快得多（这也是您选择使用 2 个桶数的幂的通常原因），但另一方面，糟糕的哈希函数可能有低位熵差：也就是说，当被散列的数据发生变化时，低位变化不大。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-12-12T14:54:43.260

假设表格大小为 m = 2^p。设 k 为键。然后，每当我们做 k mod m 时，我们只会得到 k 的二进制表示的最后 p 位。因此，如果我放入几个具有相同最后 p 位的键，散列函数将执行非常非常糟糕，因为所有键都将被散列到表中的同一个槽中。因此，避免 2 的幂

# sharepoint - MOSS 2007：日期时间字段的 SPListItem.GetFormattedValue 有错误？

> ID：277640
> 
> 赞同：6
> 
> 时间：2008-11-10T11:13:08.740
> 
> 标签：sharepoint, datetime, moss

SPListItem.GetFormattedValue 似乎对 DateTime 字段有一个奇怪的行为。它通过 SPListItem 的索引器检索 DateTime 值，根据此[MSDN 文章](http://msdn.microsoft.com/en-us/library/ms197282.aspx)返回*本地*时间。这是Reflector的一个片段

```
public string GetFormattedValue(string fieldName)
{
    SPField field = this.Fields.GetField(fieldName);
    if (field != null)
    {
        return field.GetFieldValueAsHtml(this[fieldName]);
    }
    return null;
} 
```

所以它使用 SPListItem 的索引器来检索值，然后使用 SPFields.GetFieldValueAsHtml 来格式化值。GetFieldValueAsHtml 似乎假定日期为 UTC 并将其转换为本地时间，无论它是什么类型。（Reflector 显示它使用 GetFieldValueAsText，它使用 value.ToString() 但由于某种原因，它假定时间为 UTC。）

最终结果是通过 listItem.GetFormattedValue() 获得的时间字段上的字符串表示（至少在我的情况下）不正确，是本地时间 +（本地时间 - UTC）。

有人遇到过与 SPListItem.GetFormattedValue() 相同的问题吗？您的解决方法是什么？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-19T10:20:48.523

在调用 GetFieldValueAsHtml 之前将日期转换回通用时间就可以了。

```
DateTime localTime = (DateTime)item["DueDate"];
// this is local time but if you do localDateTime.Kind it returns Unspecified
// treats the date as universal time.. 
// let's give it the universal time :)
DateTime universalTime = SPContext.Current.Web
    .RegionalSettings.TimeZone.LocalTimeToUTC(localTime);
string correctFormattedValue = 
    item.Fields["DueDate"].GetFieldValueAsHtml(universalTime); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-10T19:45:43.870

我在 SharePoint 中从 UTC 转换日期时遇到了一个公认的错误。它已在 SP1 中修复。

# html - IE6 中带有翻转的透明 PNG 菜单项背景

> ID：277644
> 
> 赞同：0
> 
> 时间：2008-11-10T11:14:58.410
> 
> 标签：html, css, internet-explorer-6, png, transparency

嗨，我一直在努力做这件事，就像我一生的感觉一样

我有一个带有块显示链接的列表菜单，每个链接都有一个推拉门 png 背景图像。我已经使用这个 javascript ( [http://www.ideashower.com/our_solutions/png-hover/](http://www.ideashower.com/our_solutions/png-hover/) ) 使用透明 gif 来实现 ie6 的 alphaimageloader 修复。

当我第一次测试它时它可以工作，但是如果我单击到另一个页面然后单击返回它就不再工作了 - 菜单完全消失了，我可以通过复制透明 gif 并更改它的名称来让它再次工作，但是如果我再次转到另一个页面然后返回它，它就会停止工作并且菜单消失。

这是服务器缓存问题还是类似的问题。

对此的任何想法将不胜感激！

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-10T12:11:22.133

如果它的缓存那么也许 AJAX 技巧可以做到。每次执行代码时创建随机数并将其添加到透明 gif url。
所以在文件 pngHover.js 中：

> transparentImage = '/j/transparent.gif';

将会

> transparentImage = '/j/transparent.gif?143253214';

要在 js google 中获取随机数，它会给你很多。/

# asp.net - 在 ASP.NET 面板中查找所有控件？

> ID：277646
> 
> 赞同：10
> 
> 时间：2008-11-10T11:16:30.653
> 
> 标签：asp.net, controls

我的页面中有许多面板，我在其中收集用户信息并保存页面详细信息。页面面板有文本框、下拉列表、列表框。

当我需要来到这个页面。如果这些控件有任何值，我需要显示页面。这该怎么做？

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2008-11-10T11:24:17.830

它归结为枚举控件层次结构中的所有控件：

```
 IEnumerable<Control> EnumerateControlsRecursive(Control parent)
    {
        foreach (Control child in parent.Controls)
        {
            yield return child;
            foreach (Control descendant in EnumerateControlsRecursive(child))
                yield return descendant;
        }
    } 
```

你可以像这样使用它：

```
 foreach (Control c in EnumerateControlsRecursive(Page))
        {
            if(c is TextBox)
            {
                // do something useful
            }
        } 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-10T11:24:29.810

您可以循环通过面板控件

```
foreach (Control c in MyPanel.Controls) 
{
   if (c is Textbox) {
        // do something with textbox
   } else if (c is Checkbox) {
        /// do something with checkbox
   }
} 
```

如果您将它们嵌套在其中，那么您将需要一个递归执行此操作的函数。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-08-25T19:01:49.723

我知道这是一篇旧帖子，我真的很喜欢[christian libardo 的](https://stackoverflow.com/users/16526/cristian-libardo)解决方案。但是，我不喜欢这样一个事实，即为了将一整套元素生成到外部范围，我必须再次迭代这些元素，只是为了将这些元素从内部范围生成到当前范围。我更喜欢：

```
IEnumerable<Control> getCtls(Control par)
{    
    List<Control> ret = new List<Control>();
    foreach (Control c in par.Controls)
    {
        ret.Add(c);
        ret.AddRange(getCtls(c));
    }
    return (IEnumerable<Control>)ret;
} 
```

这让我可以像这样使用它：

```
foreach (Button but in getCtls(Page).OfType<Button>())
{
    //disable the button
    but.Enabled = false;
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-10T11:31:00.093

根据您使用的 UI 库或语言，面板等容器控件维护子控件列表。要测试表单/页面是否有任何数据，您需要递归搜索每个面板以查找数据输入控件，例如文本框。然后测试是否有任何数据输入控件包含默认值以外的值。

一个更简单的解决方案是实现一个观察者类，该类附加到数据控件的更改事件。如果观察者被触发，那么你的页面就会发生变化。您将需要考虑更改然后恢复数据等操作。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-08-24T08:32:03.900

与 Cristian 的解决方案非常相似，它使用递归和泛型来查找页面中的任何控件（您可以指定开始搜索的控件）。

[http://intrepidnoodle.com/articles/24.aspx](http://intrepidnoodle.com/articles/24.aspx)

# c++ - 为什么 C++ 流使用 char 而不是 unsigned char？

> ID：277655
> 
> 赞同：55
> 
> 时间：2008-11-10T11:24:29.280
> 
> 标签：c++, types, stream, overflow, iostream

我一直想知道为什么 C++ 标准库使用`char`类型而不是类型来实例化 basic_[io]stream 及其所有变体`unsigned char`。`char`意味着（取决于它是否已签名）您可以对 get() 之类的操作进行上溢和下溢，这将导致所涉及的变量的实现定义值。另一个例子是当你想使用它的`put`函数将一个未格式化的字节输出到 ostream 时。

有任何想法吗？

* * *

**注意**：我仍然不太相信。因此，如果您知道明确的答案，您仍然可以确实发布它。

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2008-11-10T11:43:03.127

可能我误解了这个问题，但是从 unsigned char 到 char 的转换不是未指定的，它依赖于实现（C++ 标准中的 4.7-3）。

C++ 中 1 字节字符的类型是“char”，而不是“unsigned char”。这为实现提供了更多的自由来在平台上做最好的事情（例如，标准机构可能认为存在有符号字节算术比无符号字节算术更快的 CPU，尽管这是我的猜测）。也是为了与 C 兼容。从 C++ 中消除这种存在不确定性的结果是 C# ;-)

鉴于存在“char”类型，我认为通常流使用它是有意义的，即使它的符号没有定义。因此，也许您的问题可以通过“为什么 C++ 不将 char 定义为无符号？”的答案来回答。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2010-05-27T19:51:09.133

我一直是这样理解的：`iostream`该类的目的是读取和/或写入字符流，如果您考虑一下，这些字符流是仅由计算机使用字符编码表示的抽象实体。C++ 标准极力避免限制字符编码，只说“声明为字符 ( `char`) 的对象应足够大以存储实现的基本字符集的任何成员”，因为它不需要强制“实现基本字符集”来定义C++语言；标准可以将使用*哪种*字符编码的决定留给实现（编译器与 STL 实现一起），`char`

实现编写者可以选择单字节编码，例如[ISO-8859-1](http://en.wikipedia.org/wiki/ISO/IEC_8859-1)，甚至可以选择双字节编码，例如[UCS-2](http://en.wikipedia.org/wiki/UCS-2)。没关系。只要一个`char`对象“大到足以存储实现的基本字符集的任何成员”（请注意，这明确禁止[可变长度编码](http://en.wikipedia.org/wiki/Variable-width_encoding)），那么实现甚至可以选择一种以不兼容的方式表示基本拉丁语的编码任何常见的编码！

令人困惑的是`char`,`signed char`和`unsigned char`类型在它们的名称中共享“char”，但重要的是要记住它与和`char`不属于同一基本类型家族。属于有符号整数类型家族：`signed char``unsigned char``signed char`

> 有四种有*符号整数类型*：“signed char”、“short int”、“int”和“long int”。

并且`unsigned char`属于无符号整数类型家族：

> 对于每个有符号整数类型，都存在一个对应的（但不同的）*无符号整数类型*：“unsigned char”、“unsigned short int”、“unsigned int”和“unsigned long int”……

`char`、`signed char`和类型之间的一个相似之处`unsigned char`是“[它们] 占用相同的存储量并具有相同的对齐要求”。因此，您可以`reinterpret_cast`从`char *`to`unsigned char *`来确定执行字符集中某个字符的数值。

要回答您的问题，STL`char`用作默认类型的原因是因为标准流用于读取和/或写入由`char`对象表示的字符流，而不是整数（`signed char`和`unsigned char`）。`char`对数值的使用是一种分离关注点的方法。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-10T11:44:19.787

char 用于字符，unsigned char 用于原始数据字节，signed char 用于有符号数据。

标准没有指定是否使用有符号或无符号字符来实现 char - 它是特定于编译器的。它只指定“char”将“足以”在您的系统上保存字符——就像当时的字符一样，即没有 UNICODE。

对字符使用“char”是标准方法。使用 unsigned char 是一种 hack，尽管它会在大多数平台上匹配编译器对 char 的实现。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-05-20T11:10:38.293

我认为[这个](https://stackoverflow.com/questions/10672587/representing-blobs-in-c#comment13846926_10672587)评论很好地解释了这一点。去引用：

> signed char 和 unsigned char 是算术整数类型，就像 int 和 unsigned int 一样。另一方面， char 明确旨在成为“I/O”类型，表示平台上一些不透明的、特定于系统的基本数据单元。我会本着这种精神使用它们。

# binary - 见过这种二进制日期格式吗？

> ID：277660
> 
> 赞同：4
> 
> 时间：2008-11-10T11:27:43.407
> 
> 标签：binary, date

2008 年 3 月 10 日 = 1822556159

2008 年 2 月 10 日 = 1822523391

2008 年 1 月 10 日 = 1822490623

2008 年 9 月 30 日 = 1822392319

2008 年 9 月 29 日 = 1822359551

这是我目前所知道的所有信息。

日期以 32768 递增，除非当增量为 32768 x 2 (65536) 时更改月份。

有没有人见过这种二进制日期格式，我怎样才能提取正确的日期？

* * *

日期的剩余部分可能是时间（小时、分钟、秒）

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-11-10T11:41:31.973

2008 年 9 月 30 日

```
1822392319 = 0x6c9f7fff
0x6c = 108 = 2008 (based on 1900 start date)
0x9 = 9 = September
0xf7fff - take top 5 bits = 0x1e = 30 
```

2008 年 10 月 1 日

```
1822490623 = 0x6ca0ffff
0x6c = 108 = 2008
0xa = 10  = October
0x0ffff  - take top 5 bits = 0x01 = 1 
```

如果有的话，任何人都可以猜测剩余的 15 个 1 位是干什么用的。

编辑：通过获取前 5 位，我的意思是：

```
day_of_month = (value >> 15) & 0x1f 
```

相似地：

```
year = (value >> 24) & 0xff + 1900
month = (value >> 20) & 0x0f 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-10T11:43:48.833

以二进制格式写下来：

```
a = 1822556159
1101100 1010 00011 111111111111111
b = 1822523391
1101100 1010 00010 111111111111111
c = 1822490623
1101100 1010 00001 111111111111111
d = 1822392319    
1101100 1001 11110 111111111111111 
```

其中 1101100 是 108，正如 Alnitak 所说，其余的是月份（1010 或 1001）和天。

最后的 1 可以保留用于表示秒/毫秒。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-10T12:01:31.013

编辑：Alnitak 关于这是一个定点二进制日期表示是正确的。但是，这些原理可能与下面描述的相似；格式是固定的，而不是小数位，低 15 位很可能是时间。如果您有任何示例，请发布它们，我们将尽力提供帮助。

ORIGINAL：这很可能是 Windows OLE/COM 日期格式，它使用 Double 来表示日期和时间。数字的整数部分用于日期，小数部分用于时间。它可以表示 100 年 1 月 1 日和 9999 年 12 月 31 日之间的日期。您可以在[MSDN](http://msdn.microsoft.com/en-us/library/a1z81fxe.aspx)或 google 上找到有关 OLE date COM double 的更多信息。

编辑：这是一个使用 DateTime.FromOADate的[C# 示例。](http://dotnetperls.com/Content/Excel-FromOADate.aspx)这是[MSDN VariantTimeToSystemTime](http://msdn.microsoft.com/en-us/library/aa912065.aspx)的更多细节。

> 变体时间存储为 8 字节实数值（双精度），表示 1753 年 1 月 1 日和 2078 年 12 月 31 日之间的日期，包括 1753 年 1 月 1 日和 2078 年 12 月 31 日之间的日期。
> 
> 值 2.0 代表 1900 年 1 月 1 日；3.0 代表 1900 年 1 月 2 日，以此类推。
> 
> 将值加 1 会使日期增加一天。该值的小数部分表示一天中的时间。因此，2.5 代表 1900 年 1 月 1 日中午；3.25 表示 1900 年 1 月 2 日上午 6:00，依此类推。
> 
> 负数表示 1899 年 12 月 30 日之前的日期。

这有点矛盾，因为[COleDateTime](http://msdn.microsoft.com/en-us/library/38wh24td.aspx)文档说它支持 100 年 1 月 1 日，而该文档说它支持 1753 年 1 月 1 日。

有用于 VB（使用 CDbl() 和 CDate()）、C#（DateTime.FromOADate/ToOADate）、Java（[OLEDate](http://techpubs.borland.com/starteam/2006/en/SDKDocs/api/com/starbase/util/OLEDate.html) - 虽然看起来已弃用）、[Delphi](http://treetron.googlepages.com/xls.oledatetime.html)、[Python](http://code.activestate.com/recipes/496683/)等的接口。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-10T11:47:31.883

32768 是 2^15；他们为这些天保留了 15 位，我认为这不会均匀地划分为小时、分钟和/或秒的任何有用组合。

# oracle - JBoss 上的 Oracle ADF：包装的 Jdbc 连接问题

> ID：277665
> 
> 赞同：3
> 
> 时间：2008-11-10T11:31:22.480
> 
> 标签：oracle, jdbc, jboss, oracle-adf

我正在尝试在 JBoss 服务器上使用 Oracle ADF 业务组件运行应用程序。我已经设法部署它，但是当我尝试加载页面时，出现以下异常：

```
 java.lang.ClassCastException: org.jboss.resource.adapter.jdbc.jdk6.WrappedConnectionJDK6 cannot be cast to oracle.jdbc.OracleConnection 
```

有没有办法解决这个问题？也许将 JBoss 配置为不使用此包装的连接或配置 ADF 框架来解包它？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-18T09:34:19.380

这是一段时间前的事了，但我会跟进我自己的问题。

[Oracle Metalink](https://metalink2.oracle.com/metalink/plsql/ml2_documents.showDocument?p_database_id=NOT&p_id=307682.1) (Needs login)上有一个指南，它解释了如何在 JBoss 上部署 ADF/BC。我很确定这就是为我解决这个问题的原因（这是不久前的......）

这是它的副本：

* * *

**摘要**
本说明的目的是展示如何创建 ADF BC 应用程序模块以及如何在 JBoss 应用程序服务器上部署它。它还将向您展示您需要在 JBoss 端执行哪些配置才能使应用程序模块正常工作。

**范围和应用**
本说明适用于即将将 ADF BC 模块部署到 JBoss 应用服务器的任何人。

**如何将 ADF BC 模块部署到 JBoss 应用程序服务器**
将 ADF BC 模块部署到 JBoss 应用程序服务器所需的步骤如下：

1.  在 JBoss 服务器上设置 ADF 运行时库
2.  在 JBoss 服务器上设置数据源
3.  配置 ADF BC 模块
4.  部署 ADF BC 模块

我将更详细地介绍这些步骤中的每一个。这里还附有一​​个完整的示例供下载。在 JBoss 服务器上设置 ADF 运行时库

1.  关闭应用程序服务器。
2.  调用 ADF 运行时安装程序向导。选择工具 | ADF 运行时安装程序，然后从子菜单中选择服务器类型。
3.  继续浏览向导的页面。有关向导任何页面的详细说明，请单击帮助。
4.  在“位置”页面上，选择要安装库的服务器的主（或根）目录。
5.  在安装选项页面上，您可以选择您希望执行的操作。* 从您的 JDeveloper 安装中安装 ADF 运行时库。* 卸载以前安装的 ADF 运行时库。* 将 ADF 运行时库的存档版本恢复为活动版本。
6.  如果您希望准备任何现有的 UIX JSP 项目以进行部署，请在 Summary 页面上单击 Migrate。
7.  在 Summary 页面上，确认安装的详细信息，然后单击 Finish。
8.  重新启动应用程序服务器。

**在 JBoss 服务器上设置数据源**
要在 JBoss 服务器中创建 Oracle 数据源，您需要执行以下步骤：

1.  创建一个名为 oracle-ds.xml 的文件。此文件将包含您的数据源配置。以下是有关此类文件外观的示例。

    ```
    <?xml version="1.0" encoding="UTF-8"?>
      <datasources>
        <local-tx-datasource>
        <jndi-name>OracleDS</jndi-name>
        <use-java-context>false</use-java-context>
        <connection-url>jdbc:oracle:thin:@mydbhost.com:1521:mysid</connection-url>
        <driver-class>oracle.jdbc.driver.OracleDriver</driver-class>
        <user-name>hr</user-name>
        <password>******</password>
        <exception-sorter-class-name>org.jboss.resource.adapter.jdbc.vendor.OracleExceptionSorter</exception-sorter-class-name>
      </local-tx-datasource>
    </datasources> 
    ```

2.  将文件复制到 /deploy。这会将它安装在 JBoss 服务器上。

**配置 ADF BC 模块**
需要在 ADF BC 模块上执行几个步骤才能使其在 JBoss 服务器上运行。

创建将在 JBoss 应用服务器上使用的 ADF BC 模块时，需要将 SQL Flavor 设置为 SQL92，将 Type Map 设置为 Java。将 JBoss 用作应用程序服务器时需要进行此更改。

****将 ADF 业务组件项目打包为 EJB 会话 bean。****

1.  右键单击应用程序模块，选择业务组件部署。
2.  在配置文件对话框中，选择 EJB Session Beans。
3.  在 EJB Session Beans 对话框中，选择 Deploy To: Other EJB Container
4.  在 AppModules 对话框中，配置应用程序模块，如下图 1 所示。

图 1\. 应用模块的配置
![替代文字](https://i.stack.imgur.com/qhmuk.jpg)

完成后，您的项目将类似于下图 2 中所示的项目。

图 2\. JDeveloper 项目
![替代文字](https://i.stack.imgur.com/4sWcg.jpg)

最后一步是配置应用程序模块以使用我们在上一步中创建的数据源。这是按如下方式完成的：

1.  编辑应用程序模块。
2.  在导航器中，右键单击业务组件应用程序模块图标并选择配置。
3.  选择适当的配置。
4.  选择此配置并单击编辑。
5.  在连接类型列表中，选择 JDBC 数据源。
6.  输入数据源名称。例如：java:/OracleDS。

**部署 ADF BC 模块**
如果您的 JBoss 服务器在本地或映射在本地机器上，您可以直接从 JDeveloper 内部部署它。如果您的 JBoss 服务器是远程的，并且没有映射到本地机器，或者您有一个稍后将使用此模块的 JSP 应用程序，您不能直接从 JDeveloper 中部署它。下面介绍这两种方法。

**从 JDeveloper 中部署模块**
1\. 创建到目标应用程序服务器的连接。2\. 如果要支持 EJB 的 JBoss 特定配置选项，请添加 jboss.xml 部署描述符文件。有关此文件的更多信息，请参见[http://www.jboss.org](http://www.jboss.org)。3\. 如果您的项目是 Business Components UIX JSP 项目，请向其添加所需的 Cabo 资源。4\. 在导航器中选择部署配置文件，右键单击，选择部署到 | <应用程序服务器连接> 将应用程序打包为存档文件并通过选定的应用程序服务器连接进行部署。

**在 JDeveloper 之外部署模块**
如果您的 JBoss 服务器是远程的，并且没有映射到本地机器，或者您有一个稍后将使用该模块的 JSP 应用程序，您必须执行以下操作：

1.  从上下文菜单中选择 Deploy to EAR file 以将其部署为 EAR 文件。您必须将此应用程序部署到 EAR 文件而不是 WAR 文件，因为 JBoss 不会在 java:comp/env/ JNDI 命名空间下为 WAR 文件添加 EJB 引用。
2.  将此文件手动复制到 /deploy 目录。

# iis - 不能在 IIS 的映射中添加“.*”

> ID：277675
> 
> 赞同：4
> 
> 时间：2008-11-10T11:35:39.583
> 
> 标签：iis, mapping

我无法在 IIS 的扩展映射（默认网站 -> 属性 -> 主目录 -> 配置）中添加 .*，因为它给出了消息“错误的文件扩展名”。

操作系统为 Windows 2003 服务器。当操作系统为 Windows XP 时，我可以在 IIS 中的映射处添加 .*

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-10T11:39:29.093

IIS6 有第二个通配符映射列表。它位于常规映射列表的下方，称为“通配符应用程序映射”。

# asp.net - 限制 IIS 中特定用户的文件访问权限

> ID：277695
> 
> 赞同：3
> 
> 时间：2008-11-10T11:50:08.773
> 
> 标签：asp.net, security, iis, ntfs

我在 IIS 6.0 (Windows 2003) 上运行一个 ASP.NET 网站，该网站使用“集成 Windows 身份验证”。IWA 配置不是必须的（直到现在），但无论如何都要配置。应用程序池作为“网络服务”运行。此外，在 web.config 中，还有“”行。我现在面临的问题是有一个新请求来限制对特定页面的访问，因此只有有限数量的用户（活动目录中的单个组）可以访问它。

我一直在尝试更改该文件的 NTFS 权限，但这不起作用，因为 IIS 使用“网络服务”来访问该文件，而不管其余的权限。从 ACL 中删除“网络服务”（或“用户”组）会导致页面根本无法工作。

那么如何限制对特定页面的访问，仅针对特定用户？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-10T11:59:17.510

您可以在 web.config 中使用以下内容：

```
<configuration>
   <location path="ProtectedPage.aspx">
      <system.web>
         <authorization>
            <allow users="SomeUser"/>
            <deny users="?"/>
         </authorization>
      </system.web>
   </location>
</configuration> 
```

# nhibernate - NHibernate 中的 Configuration.GenerateSchemaUpdateScript() 是管理数据库架构更改的好方法吗

> ID：277697
> 
> 赞同：5
> 
> 时间：2008-11-10T11:52:57.647
> 
> 标签：nhibernate

我在开发阶段使用 NHibernate 映射作为我的应用程序的定义架构，而对于架构定义，我正在使用该`NHibernate.Tool.hbm2ddl.SchemaExport()`方法生成一个 createscript。

现在，我已经考虑使用该`Configuration.GenerateSchemaUpdateScript()`方法生成这样的数据库更改脚本：

```
 var dialect = Dialect.GetDialect(configuration.Properties);
string[] schemaUpdateScript;
using (var conn = new SqlConnection(
        configuration.GetProperty("connection.connection_string")))
{
  conn.Open();
  schemaUpdateScript = configuration.GenerateSchemaUpdateScript(dialect, 
                            new DatabaseMetadata(conn, dialect));
} 
```

在此之后，我会将架构更新脚本保存到以时间戳命名的脚本文件中。

这是在 NHibernate 中管理模式更改的好方法吗？

有什么大的缺点吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-11T11:33:25.687

简而言之 - 这取决于。我用它来创建脚本，然后手动编辑，但我确定我在某处读到它不会为现有表创建新的非空列 - 这似乎是有道理的，因为 NHibernate 将如何知道如何填充列？

# authentication - 使用 ruby gem、apt-get 等。通过具有 NTLM 身份验证的代理

> ID：277698
> 
> 赞同：3
> 
> 时间：2008-11-10T11:53:46.567
> 
> 标签：authentication, proxy, ntlm

有哪些解决方案可以使用 NTLM 身份验证通过公司代理？任何不是浏览器的东西都会失败。

我试过NTLMAPS，但没有成功。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-10T11:58:12.767

[cntlm](http://cntlm.awk.cz/)效果很好。请务必遵循“配置提示”部分，它将为您节省一些试错周期。

# c# - XPath vs DeSerialization：读取操作的性能哪个更好

> ID：277710
> 
> 赞同：10
> 
> 时间：2008-11-10T11:59:55.917
> 
> 标签：c#, wcf, performance, serialization, xpath

我将小（2-10 KB）XML 文档作为输入传递给 WCF 服务。现在我有两个选项可以从传入的 XML 中读取数据值

1.  反序列化为强类型对象并使用对象属性访问值
2.  使用 XPath 访问值

哪种方法更快？一些支持您的答案的统计数据会很棒。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-20T23:16:15.540

我会反序列化它。

如果您使用 xpath，您将反序列化（或“加载”）它到 XmlDocument 或其他东西。所以这两种解决方案都使用时间反序列化。完成此操作后，xpath 将变慢，因为解析该字符串、解析名称、执行函数等所花费的时间。此外，如果您使用 xpath，则不会获得类型安全。您的编译器无法为您检查 xpath 语法。

如果您使用 XmlSerializer 和类，您将获得静态类型。真正快速地访问您的数据，如果您想使用 xpath 查询它们，仍然有办法做到这一点。

另外，我想说你的代码可能会更容易理解类。

唯一的缺点是 xml 必须始终符合相同的模式，但这在您的情况下可能不是真正的问题。

我希望你原谅没有统计数据，我认为没有例子的论点就足够了。如果您想要最终答案，请尝试两者并准备好秒表。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-10T12:04:25.657

还有第三种坚持使用 XML 的选项，但是使用您正在使用的任何 XML API 进行查询——例如 LINQ to XML 使得查询在代码中相对简单。

您是否已经将文本解析为 XML 文档？

您是否确信这实际上是您代码中的一个重要性能瓶颈？（例如，如果您正在与数据库交谈，那么开始时不要担心 - 先让它以最简单的方式工作）

查询总是相同的，还是以某种方式动态？

您是否有带有真实消息和查询的测试平台？*如果没有，您需要使用您的*数据来评估此处给出的任何答案。如果你这样做了，我希望你自己尝试一下会相当容易:)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2016-06-06T19:27:28.760

这里有 4 个案例，所有时间都在刻度和位置：

*   XmlSerializer（最慢的第 4 位）
*   实现 IXmlSerializable（第 3 次）
*   手卷（定制）（第 1 次）
*   XElement（第二名）

样本对象被读取 1000 次。

你应该关心吗？在大多数情况下，使用 .net 中内置的默认序列化程序。没有必要偏离，这将产生最少的代码。这些应该绰绰有余，提供类型安全并让自己腾出时间做更有意义的事情。在某些情况下，如果您希望从大型 XML 结构中挑选某些数据元素，XElement 可能会很有用，但即便如此，也应该将这些元素放入强类型 DTO 中。但请记住，所有方法都非常快。我个人在短短几毫秒内就序列化了一个极其广泛和深入的对象模型（远超过 400 个类）。对于较小和琐碎的对象，它将是亚毫秒的响应时间。XMLSerializer 的预热比其他的要慢，但可以通过 SGEN 或在启动时进行一些初始化来缓解。

详细信息和代码...

***Xml 序列化程序***

```
[Serializable]
    public class FoobarXml
    {
        public string Name { get; set; }
        public int Age { get; set; }
        public bool IsContent { get; set; }

        [XmlElement(DataType = "date")]
        public DateTime BirthDay { get; set; }
    } 
```

**第一次：2448965**

**1000 读取平均值：245**

***IXmlSerializable***

```
 public class FoobarIXml : IXmlSerializable
    {
        public string Name { get; set; }
        public int Age { get; set; }
        public bool IsContent { get; set; }
        public DateTime BirthDay { get; set; }

        public XmlSchema GetSchema()
        {
            return null;
        }

        public void ReadXml(XmlReader reader)
        {
            reader.MoveToContent();
            var isEmptyElement = reader.IsEmptyElement;
            reader.ReadStartElement();
            if (!isEmptyElement)
            {
                Name = reader.ReadElementString("Name");

                int intResult;
                var success = int.TryParse(reader.ReadElementString("Age"), out intResult);
                if (success)
                {
                    Age = intResult;
                }

                bool boolResult;
                success = bool.TryParse(reader.ReadElementString("IsContent"), out boolResult);
                if (success)
                {
                    IsContent = boolResult;
                }
                DateTime dateTimeResult;
                success = DateTime.TryParseExact(reader.ReadElementString("BirthDay"), "yyyy-MM-dd", null,
                    DateTimeStyles.None, out dateTimeResult);
                if (success)
                {
                    BirthDay = dateTimeResult;
                }
                reader.ReadEndElement(); //Must Do
            }
        }

        public void WriteXml(XmlWriter writer)
        {
            writer.WriteElementString("Name", Name);
            writer.WriteElementString("Age", Age.ToString());
            writer.WriteElementString("IsContent", IsContent.ToString());
            writer.WriteElementString("BirthDay", BirthDay.ToString("yyyy-MM-dd"));
        }
    }
} 
```

**第一次：2051813**

**1000 读取平均值：208**

***手卷***

```
 public class FoobarHandRolled
    {
        public FoobarHandRolled(string name, int age, bool isContent, DateTime birthDay)
        {
            Name = name;
            Age = age;
            IsContent = isContent;
            BirthDay = birthDay;
        }

        public FoobarHandRolled(string xml)
        {
            if (string.IsNullOrWhiteSpace(xml))
            {
                return;
            }

            SetName(xml);
            SetAge(xml);
            SetIsContent(xml);
            SetBirthday(xml);
        }

        public string Name { get; set; }
        public int Age { get; set; }
        public bool IsContent { get; set; }
        public DateTime BirthDay { get; set; }

        /// <summary>
        ///     Takes this object and creates an XML representation.
        /// </summary>
        /// <returns>An XML string that represents this object.</returns>
        public override string ToString()
        {
            var builder = new StringBuilder();
            builder.Append("<FoobarHandRolled>");

            if (!string.IsNullOrWhiteSpace(Name))
            {
                builder.Append("<Name>" + Name + "</Name>");
            }

            builder.Append("<Age>" + Age + "</Age>");
            builder.Append("<IsContent>" + IsContent + "</IsContent>");
            builder.Append("<BirthDay>" + BirthDay.ToString("yyyy-MM-dd") + "</BirthDay>");
            builder.Append("</FoobarHandRolled>");

            return builder.ToString();
        }

        private void SetName(string xml)
        {
            Name = GetSubString(xml, "<Name>", "</Name>");
        }

        private void SetAge(string xml)
        {
            var ageString = GetSubString(xml, "<Age>", "</Age>");
            int result;
            var success = int.TryParse(ageString, out result);
            if (success)
            {
                Age = result;
            }
        }

        private void SetIsContent(string xml)
        {
            var isContentString = GetSubString(xml, "<IsContent>", "</IsContent>");
            bool result;
            var success = bool.TryParse(isContentString, out result);
            if (success)
            {
                IsContent = result;
            }
        }

        private void SetBirthday(string xml)
        {
            var dateString = GetSubString(xml, "<BirthDay>", "</BirthDay>");
            DateTime result;
            var success = DateTime.TryParseExact(dateString, "yyyy-MM-dd", null, DateTimeStyles.None, out result);
            if (success)
            {
                BirthDay = result;
            }
        }

        private string GetSubString(string xml, string startTag, string endTag)
        {
            var startIndex = xml.IndexOf(startTag, StringComparison.Ordinal);
            if (startIndex < 0)
            {
                return null;
            }

            startIndex = startIndex + startTag.Length;

            var endIndex = xml.IndexOf(endTag, StringComparison.Ordinal);
            if (endIndex < 0)
            {
                return null;
            }

            return xml.Substring(startIndex, endIndex - startIndex);
        }
    } 
```

**第一次：161105**

**1000 次读取平均值：29**

***元素***

```
 var xDoc = XElement.Parse(xml);

        var nameElement = xDoc.Element("Name");
        var ageElement = xDoc.Element("Age");
        var isContentElement = xDoc.Element("IsContent");
        var birthDayElement = xDoc.Element("BirthDay");

        string name = null;
        if (nameElement != null)
        {
            name = nameElement.Value;
        }
        var age = 0;
        if (ageElement != null)
        {
            age = int.Parse(ageElement.Value);
        }
        var isContent = false;
        if (isContentElement != null)
        {
            isContent = bool.Parse(isContentElement.Value);
        }
        var birthDay = new DateTime();
        if (birthDayElement != null)
        {
            birthDay = DateTime.ParseExact(birthDayElement.Value, "yyyy-MM-dd", CultureInfo.InvariantCulture);
        } 
```

**第一次：247024**

**1000 读取平均值：113**

# sql-server - SQL Server 报告服务：如何在打开时停止报告触发

> ID：277714
> 
> 赞同：33
> 
> 时间：2008-11-10T12:02:18.703
> 
> 标签：sql-server, reporting-services

我们有一些 SQL 服务器报告服务报告。那时我没有写，但我必须照顾他们。

这些报告在浏览器中打开时会触发，并且使用默认参数（搜索词和限制为空白）它们会检索大量数据，这很慢。客户希望在用户输入参数并按“查看报告”之前不生成报告

不幸的是，我根本不了解 SSRS - 我如何阻止报告在打开时触发？

* * *

如何在已部署的报告上执行此操作（根据 Rihan Meij 的回答）的详细信息如下：

单击报告，单击顶部的“属性”。您可能需要稍等片刻，因为现在可能正在运行慢速报告。然后点击左侧的“参数”。

对于每个参数，确保选中“提示用户”，并且对于至少一个参数，不选中“具有默认值”。再次点击左上角的“查看”（或返回文件夹并点击报告名称）查看报告，注意报告不会立即触发。

在报表生成器中，您可以通过“过滤器”菜单执行此操作。从至少一个过滤器中取消选择值，然后保存报告。

当报告没有参数时，是否也可以阻止报告在加载时触发？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-11-17T18:34:03.973

我发现我必须至少设置一个报告参数以不设置默认值以防止报告自动运行。

我不得不使用这个配置（请注意，我留下的所有 3 个没有默认值的参数都接受 Null，因此用户只需单击 Null 复选框）：

[截图缺失]

让用户看到这一点并防止报告自动运行：

[截图缺失]

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2015-06-24T16:17:10.473

我将我的参数选择之一的默认值设置为不存在的值 -1（不是有效的参数值）。这没有产生错误。它只是将参数下拉框设置为并阻止报表运行。我不能使用默认值 NULL，因为 NULL 选择所有内容，并且我希望用户在报告运行之前有目的地选择 ALL (NULL)。如果选择 ALL，则报告需要几分钟才能呈现。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-10T13:58:07.877

我通过在运行时将查询稍微更改为需要参数来做到这一点。

然后我在报告站点上发布报告后，指定参数应该提示用户。这确实有这样的效果，即当用户打开报表查看时，报表不会将 sql 服务器拉到它的膝盖上。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2013-04-29T13:09:18.150

我知道这篇文章有点老了，但是因为我在这里有另一个解决方案，所以我只是发布它以防有人需要它。

如果您使用 ReportViewer，则可以设置属性 ShowBody="False"。然后在 OnSubmittingParameterValues 事件上，将 ShowBody 属性更改为 true。那么报表中不需要任何额外的参数或没有默认值的参数。

```
<rsweb:ReportViewer 
        ID="rv" 
        runat="server"  
        Width="100%" 
        Height="100%" 
        SizeToReportContent="false" 
        ZoomMode="PageWidth"
        KeepSessionAlive="true" 
        ProcessingMode="Remote"
        PromptAreaCollapsed="false" 
        InteractivityPostBackMode="AlwaysAsynchronous"
        AsyncRendering="true" 
        ExportContentDisposition="AlwaysInline"
        ShowReportBody="False"
        ShowPrintButton="false"
        OnSubmittingParameterValues="rv_SubmittingParameterValues"/> 
```

然后在 rv_SubmittingParameterValues 方法中：

```
this.rv.ShowReportBody = true; 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2015-12-02T23:07:06.493

在处理具有可选字段的报告时，我发现了一个很好的技巧，但如果可选字段为空白，则会提取大量数据。

第 1 步：防止自动点火

*   确保没有为可选参数启用“允许空值”
*   确保可选参数没有默认值

第 2 步：在不使用“null”的情况下使参数成为可选参数

*   为可选参数启用“允许空白值”
*   将可选参数的 where 子句修改为 `WHERE (@param="" OR column = @param)`

使用这种方法，最终用户需要担心额外的字段，在请求之前不会触发报告，如果文本框为空，则不会评估 where 子句中的条件。

* * *

*注意：如果报告指定了可用值，则可以使用任何对您的表结构无效的值来代替“”，您也可以通过这种方式与其他数据类型（非字符串）一起使用*

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2012-08-29T14:04:05.907

我发现最好的方法是添加一个不允许空值但报表不使用的参数。这会阻止它在开始时呈现，但不会影响报告。

唯一的缺点是，如果您在报表查看器中显示报表，则顶部有一个看起来有点奇怪的框。我相信你可以使用一些 C#/CSS 来隐藏它。

由于我没有使用报表查看器来显示，只是在后端呈现，这不会影响我。

即使您使用的是报表查看器，它在开发时也很有帮助！

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2012-12-21T11:34:04.510

我只是通过为不返回任何结果的 key 参数提供默认值来做到这一点。

* * *

## 回答 #8

> 赞同：-2
> 
> 时间：2020-11-16T13:50:44.223

我在我的查询中添加了这个：

> 其中'开始' = @Start

并制作了一个只有可用值“开始”的参数。报告正在等待输入。

# svn - 每当我结帐时，都不会创建 .svn 文件夹

> ID：277715
> 
> 赞同：2
> 
> 时间：2008-11-10T12:02:40.247
> 
> 标签：svn

我尝试了以下

1.  `svnadmin create svn_repos`
2.  `svn import my_first_proj file:///c:/svn_repos -m "initial import"`
3.  `svn checkout file:///c:/svn_repos`

并且返回的命令

```
A    svn_repos\trunk
A    svn_repos\trunk\Sample.txt.txt
A    svn_repos\branches
A    svn_repos\branches\my_pers_branch
Checked out revision 1. 
```

然而，该`.svn`文件夹并未在签出的文件夹中创建。因此[我猜]，我不能做`svn copy`or `svn merge`。

为什么会出现这种情况？问题是什么？我的命令有什么问题吗

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-10T12:48:03.150

也许您希望在 my_first_proj 目录中找到那个 .svn 目录。目前，您的 svn 在“svn_repos”目录中签出，相对于您在 checkout 命令中键入的路径。您可能想要做的是：

```
svn checkout --force file:///c:/svn_repos/ my_first_proj 
```

它检查现有目录中的存储库。不过，通常的方法是第一次签出到另一个目录。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-10T13:18:00.063

在 Windows Subversion 上，在某些情况下可能会使用隐藏的 _svn 目录而不是 .svn。

此行为由 SVN_ASP_DOT_NET_HACK 环境变量切换。请参阅[Subversion 文档](http://svn.collab.net/repos/svn/trunk/notes/asp-dot-net-hack.txt)。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-10T13:51:57.920

您尚未在结帐中指定路径，因此它默认为存储库本身的基本名称。换句话说，它的运作方式是：

```
svn checkout file:///c:/svn_repos ./svn_repos 
```

这意味着它已经检查了存储库目录中的工作副本！如果您查看存储库，您应该找到目录`trunk`和`branches`其余文件。如果您这样做，它将按照您的预期运行：

```
svnadmin create svn_repos
svn import my_first_proj file:///c:/svn_repos -m "initial import"
svn checkout file:///c:/svn_repos my_working_copy 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-10T12:14:50.783

您确定它不只是隐藏（默认情况下它们是隐藏的）吗？

尝试运行`dir /AH`

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-10T12:16:29.970

'svn status' 说什么？如果 .svn 真的丢失了，它会打印如下内容：

```
svn: warning: '.' is not a working copy 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-10T15:26:09.557

请提供更多详细信息：

当您执行每个命令时，您在哪个目录中？

在我看来，您可能正在将您的项目签入存储库本身？

另外，您使用的是什么操作系统？

# flash - Flash 投影仪中的浏览器链接打开但停留在 Flash 应用程序后面

> ID：277723
> 
> 赞同：1
> 
> 时间：2008-11-10T12:06:25.530
> 
> 标签：flash, actionscript-3

我有一个闪存投影仪文件，它在 CD-ROM 上。一个部分只是指向有用网站的链接的简单列表。这些链接是通过将属性框中的 URL 添加到静态文本来创建的。投影机以全屏模式运行，并使用 Flash CS3 制作。

这是在 Windows 中运行闪光灯投影仪应用程序时的行为：

如果浏览器未在后台运行，则链接可以正常打开。浏览器窗口打开并获得焦点。如果 Flash 应用程序保持全屏模式，我会更好，但这不是主要问题。

如果浏览器已打开，链接将在浏览器中打开，但窗口将保留在 Flash 应用程序的后面，用户会忘记并认为链接不起作用。

**当您单击 Flash 中的链接时，有没有办法使浏览器窗口获得焦点，有谁知道这是否已在 CS4 中修复？**

谢谢你的帮助。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-21T22:21:02.093

I think the key issue here could be what browser are we speaking of, and how it is configured. I.e., if it is Firefox, and you have configured it to open external links (from other applications) in the background, then it has nothing to do with flash, and the described behavior is completely in accordance with these settings. In my flash apps, opening an external link always brings the new browser tab/window to the front, albeit I have never tried this with standalone apps.

BTW, that the flash app exits from fullscreen when you click on a link is a security feature. I beleive what the architects at Adobe had in mind was a hacker creating a browser mockup in flash, and thus acquiring sensitive data.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-11T18:43:06.683

在将链接发送到浏览器之前，您是否尝试过手动放入一个挂钩以使投影仪退出全屏模式？也许在那种情况下它会得到焦点？

如果您使用 Flash Player 10（我猜您在编写 Flash CS4 时提到过），我认为不会有很大的不同，但是将您的应用程序更改为 AIR 可能会有所不同，并且在 CS3 中也很可能这样做。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-02-21T18:43:57.063

我在 FlashKit 上发布了此类问题的解决方案... [http://board.flashkit.com/board/showthread.php?t=674688&highlight=topmost](http://board.flashkit.com/board/showthread.php?t=674688&highlight=topmost)

该解决方案使用了我多年来开发的一些免费工具，并展示了如何解决 PDF 文件的问题，但 EXE 文件和其他文档类型将遵循相同的模式。

# sql - T SQL - 相关子查询的雄辩替换

> ID：277726
> 
> 赞同：6
> 
> 时间：2008-11-10T12:08:53.823
> 
> 标签：sql, sql-server-2005

我有一个查询当前正在使用相关子查询来返回结果，但我认为可以使用 ROW_NUMBER() 更雄辩地解决这个问题。

问题是围绕价值 v 的概况，通过一个项目的若干年。每个项目都有多个版本，每个版本都有自己的配置文件，当版本被引入时，数据当前看起来像这样：

```

ItemId ItemVersionId 年份 值
============================================
1 1 01 0.1
1 1 02 0.1
1 1 03 0.2
1 1 04 0.2
1 1 05 0.2
1 1 06 0.3
1 1 07 0.3
1 1 08 0.4
1 2 04 0.3
1 2 05 0.3
1 2 06 0.3
1 2 07 0.4
1 2 08 0.5
1 3 07 0.6
1 3 08 0.7
2 1 01 0.1
2 1 01 0.1
2 1 01 0.2
ETC

```

我想在适用的情况下使用最新版本返回项目的完整配置文件。对于上面第 1 项的示例：

```
ItemId ItemVersionId 年份 值
============================================
1 1 01 0.1
1 1 02 0.1
1 1 03 0.2
1 2 04 0.3
1 2 05 0.3
1 2 06 0.3
1 3 07 0.6
1 3 08 0.7

```

我目前正在使用

```
SELECT ItemId, ItemVersionId, Year, Value
FROM table t
WHERE
    ItemId = 1
    AND ItemVersionId = (SELECT MAX(ItemVersionId) FROM table WHERE ItemId = t.ItemId AND Year = t.Year) 
```

虽然这返回正确，但我怀疑有一种更有效的方法可以做到这一点，尤其是当表格变大时。

我正在使用 SQL Server 2005。

提前致谢

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-10T12:37:18.460

我会用 CTE 来做：

```
WITH Result AS
(
  SELECT Row_Number() OVER (PARTITION BY ItemId, Year
ORDER BY ItemversionId DESC) AS RowNumber
      ,ItemId
      ,ItemversionId
      ,Year
      ,Value
  FROM table
)
SELECT ItemId
  ,ItemversionId
  ,Year
  ,Value
FROM Result
WHERE RowNumber = 1
ORDER BY ItemId, Year 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-10T12:16:43.620

我觉得你怎么做也没关系。**您可以检查ItemId 和 Year 上**是否存在复合索引。

您可以检查查询计划以查看该查询的影响。

如果您的数据库中有一个“项目”表，您可以尝试另一种方法。**在该表中插入一列 ItemVersionId**并确保在保存新版本时更新该值。然后在您的查询中使用 ItemId 和 ItemVersionId而不是使用该子查询**加入 Item 表。**

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-10T15:15:06.037

这应该可行，尽管您必须使用自己的数据测试性能：

```
SELECT
    T1.ItemID,
    T1.ItemVersionID,
    T1.Year,
    T1.Value
FROM
    MyTable T1
INNER JOIN (SELECT Year, MAX(ItemVersionID) AS MaxItemVersionID FROM MyTable T2 WHERE T2.ItemID = 1 GROUP BY Year) SQ ON
    SQ.Year = T1.Year AND
    SQ.MaxItemVersionID = T1.ItemVersionID
WHERE
    T1.ItemID = 1 
```

此外，您可以将子查询更改为分组依据并返回 ItemID，这样如果您需要为应用程序的其他部分返回数据，则可以一次返回多个项目的数据。只需确保将 ItemID 添加到连接条件即可。

# c# - Java 6 语言与 C# 3.0 语言的比较

> ID：277732
> 
> 赞同：3
> 
> 时间：2008-11-10T12:12:57.950
> 
> 标签：c#, java, comparison

在 H.Mössenböck 比较这两种语言的地方，有一个关于 C# 与 Java 的很好的讨论。那是从 2003 年开始，C# 2.0 与 Java 1.5 相比。

可以在这里找到德语：http: [//dotnet.jku.at/](http://dotnet.jku.at/)

有哪些好的资源，比较实际的语言版本？或者也许在这里发布一个比较？

我的兴趣是：

**与 C# 3.0 语言相比，Java 6 语言（功能、语法糖等）的优点/缺点。**

*当前的 IDE、VM、CLR 和当前的框架功能将超过这个问题......*

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-10T12:40:16.177

Java 6 与 Java 5 相比没有任何*语言*改进——而 C# 3 有[大量新特性](http://csharpindepth.com/Articles/General/BluffersGuide3.aspx)。[在面向 .NET 2.0 时，仍然可以使用](http://csharpindepth.com/Articles/Chapter1/Versions.aspx)许多（但不是全部）C# 3 改进。

[Java 7对新的语言特性](http://tech.puredanger.com/java7)提出了很多[*建议*](http://tech.puredanger.com/java7)，但尚不清楚哪些特性会真正加入其中。[C# 4](http://code.msdn.microsoft.com/csharpfuture)将具有重要的新特性，但它会比 2 和 3 之间的变化更多。

# .net-3.5 - (WF) 工作流设计模式.net 3.0

> ID：277736
> 
> 赞同：1
> 
> 时间：2008-11-10T12:14:37.493
> 
> 标签：.net-3.5, workflow-foundation

我有一些工作流可以在 Worflow 基础中使用。我需要遵循一些工作流设计模式

工作流程中的一些最佳表现

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-10T13:26:46.490

您可以根据需要练习实施。

[http://www.odetocode.com/Articles/465.aspx](http://www.odetocode.com/Articles/465.aspx)

# oracle - JDBC - Oracle ArrayIndexOutOfBoundsException

> ID：277744
> 
> 赞同：14
> 
> 时间：2008-11-10T12:22:10.987
> 
> 标签：oracle, jdbc, jboss

尝试在 oracle 表中插入一行时出现异常。我正在为 oracle 11 使用 ojdbc5.jar 这是我正在尝试的 sql

```
INSERT INTO rule_definitions(RULE_DEFINITION_SYS,rule_definition_type,
rule_name,rule_text,rule_comment,rule_message,rule_condition,rule_active,
rule_type,current_value,last_modified_by,last_modified_dttm,
rule_category_sys,recheck_unit,recheck_period,trackable)
VALUES(RULE_DEFINITIONS_SEQ.NEXTVAL,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?) 
```

我得到以下异常。任何帮助将不胜感激。

```
java.ljava.lang.ArrayIndexOutOfBoundsException：15
在 oracle.jdbc.driver.OracleSql.computeBasicInfo(OracleSql.java:950)
    在 oracle.jdbc.driver.OracleSql.getSqlKind(OracleSql.java:623)
    在 oracle.jdbc.driver.OraclePreparedStatement.(OraclePreparedStatement.java:1212)
    在 oracle.jdbc.driver.T4CPreparedStatement.(T4CPreparedStatement.java:28)
    在 oracle.jdbc.driver.T4CDriverExtension.allocatePreparedStatement（T4CDriverExtension.java:68）
    在 oracle.jdbc.driver.PhysicalConnection.prepareStatement（PhysicalConnection.java:3059）
    在 oracle.jdbc.driver.PhysicalConnection.prepareStatement（PhysicalConnection.java:2961）
    在 oracle.jdbc.driver.PhysicalConnection.prepareStatement（PhysicalConnection.java:5874）
    在 org.jboss.resource.adapter.jdbc.WrappedConnection.prepareStatement（WrappedConnection.java:232）
    在 com.gehcit.platform.cds.common.util.db.DBWrapper.executeInsertOracleReturnPK(DBWrapper.java:605)

```

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-11-11T10:29:23.353

在 Oracle Metalink（Oracle 的支持站点 - 注意 ID 736273.1）中，我发现这是 JDBC 适配器（版本 10.2.0.0.0 到 11.1.0.7.0）中的一个错误，当您使用超过 7 个位置参数调用preparedStatement 时，JDBC 将抛出这个错误。

如果您有权访问 Oracle Metalink，那么一种选择是去那里下载提到的补丁。

另一种解决方案是解决方法 - 使用命名参数而不是位置参数：

```
INSERT INTO rule_definitions(RULE_DEFINITION_SYS,rule_definition_type,
rule_name,rule_text,rule_comment,rule_message,rule_condition,rule_active,
rule_type,current_value,last_modified_by,last_modified_dttm,
rule_category_sys,recheck_unit,recheck_period,trackable)
VALUES(RULE_DEFINITIONS_SEQ.NEXTVAL,:rule_definition_type,
:rule_name,:rule_text,:rule_comment,:rule_message,:rule_condition,:rule_active,
:rule_type,:current_value,:last_modified_by,:last_modified_dttm,
:rule_category_sys,:recheck_unit,:recheck_period,:trackable) 
```

然后使用

```
preparedStatement.setStringAtName("rule_definition_type", ...) 
```

等为此查询设置命名绑定变量。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2016-07-20T09:23:18.937

我正在使用 mybatis + oracle + spring + maven。如果有 8 个（或）以上参数，则出现相同的错误“arrayindexoutofboundsexception”。

在 pom 中将版本 ojdbc6 更改为 ojdbc14，

```
 <dependency>
        <groupId>com.oracle</groupId>
        <artifactId>ojdbc14</artifactId>
        <version>10.2.0.3.0</version>
    </dependency> 
```

有效。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-10T12:34:41.477

在没有看到代码的情况下，我唯一能想到的就是检查每个连接是否以线程安全的方式被访问。Oracle 驱动程序通常非常可靠。我唯一一次看到像这样的奇怪的内部错误是当你有多个线程访问同一个连接实例并用它做奇怪的事情时。它们不是线程安全的，每个线程应该保持一个。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-10T12:35:14.533

如果我理解正确，您可以创建一个包含 15 个占位符的准备好的语句。因此，您需要将一个包含 15 个参数值的数组传递给调用。也许你错过了一个或增加了一个多余的？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-10T13:51:01.947

看起来您传递的参数数量错误。您应该传递 15，但您要发送 16 或 14。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-10T13:55:30.487

是的，除非我的鼠标光标计数关闭，否则您会尝试将 16 个值插入 15 列。

尝试相同的 SQLPlus*，你应该得到 ORA-00913: too many values

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-07-06T10:10:59.600

当您无权访问 oracle.jdbc.PreparedStatement 类（并且被迫使用不支持方法#setXXXAtName() 的 java.sql.PreparedStatement）时，建议的使用命名参数的解决方案不是一个选项.

我使用 PreparedStatement 和 GeneratedKeyHolder 方法传递强制值（幸运的是小于 7），并使用返回的生成主键为剩余值发出简单的 SQL 更新。

# c# - 用xml本地化而不编译？

> ID：277746
> 
> 赞同：2
> 
> 时间：2008-11-10T12:24:26.460
> 
> 标签：c#, localization

我正在寻找用不同语言实现 winform 的最佳方法，但我不想使用 Visual Studio 的资源文件，因为您总是必须重新编译。

我发现以下解决方案无需编译即可使用 XML 文件：http: [//www.codeproject.com/KB/miscctrl/xml_localization.aspx](http://www.codeproject.com/KB/miscctrl/xml_localization.aspx)

我觉得没关系，用户可以编辑 xml，将来他们可以为我的应用程序提供翻译。

你知道更好的方法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-10T12:28:23.363

除了定义您自己的基于 XML 的内部化系统之外，您还可以采用标准方法，例如使用[Translation Memory eXchange](http://www.lisa.org/Translation-Memory-e.34.0.html)格式。

# paypal - PayPal 中的定期付款

> ID：277750
> 
> 赞同：6
> 
> 时间：2008-11-10T12:31:37.320
> 
> 标签：paypal, payment, recurring-billing

我正在尝试使用 PayPal 提供的定期付款 API。我有一个我无法直接解决的场景。它是这样的。

我们有一个销售一些服务的网站。现在，服务按用户许可收费。用户可以在两者之间购买/取消用户许可证。我们希望为客户提供定期计费选项。我们必须在此注意，金额可能会根据客户在该周期内使用的用户许可证数量在每个计费周期内有所不同。

有什么方法可以使用 PayPal 定期付款 API 来实现这一点。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2010-10-25T22:34:36.867

我意识到这是一个非常古老的帖子，但它仍然出现在谷歌搜索中，所以我想我会添加：

Paypal 确实允许您现在使用他们新的[自适应支付 API](https://www.x.com/community/ppx/adaptive_payments)来执行此操作。

Authorize.net 也有一个叫做[Customer Information Manager](http://developer.authorize.net/api/cim/)的服务。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-10T12:41:38.810

定期付款选项是客户预先同意每月（或期间）支付的固定金额。为了做你想做的事情，客户必须预先同意支付你决定在以后收取的任何金额。这意味着预授权未知的支付金额，任何支付服务都不允许这样做。

您唯一的选择是：

1.  每月按可变金额计费（即不订阅）。
2.  设置订阅，其中每月金额是可能计费的最大值，然后每月退还差额。

#2 祝你好运——我个人永远不会同意作为客户这样的事情。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-10T13:36:28.593

您正在寻找的东西在英国由直接借记系统覆盖，但考虑到滥用的可能性，它受到非常严格的控制，并且有很多限制和法规对其进行管理。

我强烈建议您建立一个每月发票系统，每月向客户收费。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2014-10-20T08:45:37.963

I don't know its meaning full or not as it is a very old post.

Instead of creating recurring profile on PayPal Server, You can store the customer's credit card on the PayPal using REST API: [https://developer.paypal.com/docs/api/#vault](https://developer.paypal.com/docs/api/#vault) then every month you can fetch it and charge it like recurring Payment Or When client is no longer with the services then just remove its card from PayPal.

I suppose Authorize.net SIM method also does the same.

Hope this make sense.

# asp.net - Memcached 最强大的功能是什么？

> ID：277751
> 
> 赞同：0
> 
> 时间：2008-11-10T12:32:04.977
> 
> 标签：asp.net, comparison, memcached

特别是它比 Asp.net 的缓存功能有什么优势

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-10T12:54:19.253

memcached 是一个分布式缓存——整个缓存可以分散到多个盒子中。例如，您可以使用 memcached 在集群环境中存储会话数据，因此该数据可用于集群的任何盒子。

memcached 可以与 Microsoft 的 Velocity ( [http://blogs.msdn.com/velocity/](http://blogs.msdn.com/velocity/) ) 进行比较。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-10T21:50:37.580

另一个不错的功能是 memcached 作为独立服务运行。如果您关闭应用程序，只要服务运行，缓存的数据就会保留在内存中。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-11T13:29:21.680

我们在 ASP.NET 网站中使用 memcached 作为缓存后端。我们有 12 个 memcached 盒子。

UP for memcached：

*   更具可扩展性，只需添加带内存的盒子即可
*   缓存节点非常无知：这意味着它们不知道其他参与的节点。这使得这样一个系统的管理和配置变得非常容易。
*   所有的网络服务器在缓存中都有相同的值（所以你永远不会看到取决于哪个网络服务器为你的请求提供服务的跳跃值）

DOWN for memcached：

*   与内存缓存相比，它非常慢。主要是因为序列化/反序列化和网络延迟
*   缓存节点非常无知：例如，无法遍历所有缓存项

Memcached 是最简单且最快的工具，您需要分布式缓存。如果您可以为您的应用程序使用进程内内存缓存，那将总是更快。我们使用缓存管理器将某些项目卸载到 memcached 并将其他项目保留在本地缓存中。

# html - html onresizeend 事件，或检测调整大小结束的等效方法

> ID：277759
> 
> 赞同：4
> 
> 时间：2008-11-10T12:36:49.493
> 
> 标签：html, events, javascript-events

我正在尝试检测 onresize 事件何时在浏览器中结束。如果我使用“onresize”事件，在 Firefox 中它似乎只被触发一次，在 resize 事件结束后，这正是我想要的。但是如果我在 IE 中尝试，“onresize”事件会在调整大小期间多次触发。

我还尝试了 MSDN 中宣传的“onresizeend”事件。但它似乎根本没有被解雇，无论是在 FF 还是在 IE 中。我使用以下代码：

```
<html>
    <head>
        <script>
        <!--
        function doLog(message)
        {
            document.getElementById("log").innerHTML += "<br/>" + message;
        }

        function doResize()
        {
            doLog("plain resize");
        }

        function doResizeEnd()
        {
            doLog("resize end");
        }
        -->
        </script>
        <style>
        <!--
        #log {
            width: 400px;
            height: 600px;
            overflow: auto;
            border: 1px solid black;
        }
        -->
        </style>
    </head>
    <body onresize="doResize();" onresizeend="doResizeEnd();">
        <div id="log"/>
    </body>
</html> 
```

任何想法为什么这不起作用？也许不支持“onresizeend”事件？在这种情况下，如何检测 resize 事件何时结束？

谢谢。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-10T12:59:15.407

来自[MSDN onresizeend()](http://msdn.microsoft.com/en-us/library/ms536960(VS.85).aspx)

> 只有内容可编辑对象才能包含在控件选择中。您可以通过将 contentEditable 属性设置为 true 或将父文档置于设计模式来使对象内容可编辑。

这就解释了为什么它不适合你。我怀疑你不想启用 contentEditable，所以为什么不设置一个计时器。

```
var resizeTimer = 0;
function doResize()
{
    if (resizeTimer)
        clearTimeout(resizeTimer);

    resizeTimer = setTimeout(doResizeEnd, 500);
} 
```

它并不完美，但希望会足够好。

# c# - 如何从控制台应用程序运行 winform？

> ID：277771
> 
> 赞同：75
> 
> 时间：2008-11-10T12:42:21.913
> 
> 标签：c#, winforms, console-application

如何从控制台应用程序中创建、执行和控制 winform？

* * *

## 回答 #1

> 赞同：104
> 
> 时间：2008-11-10T12:44:37.963

最简单的选择是启动一个 windows 窗体项目，然后将输出类型更改为控制台应用程序。或者，只需添加对 System.Windows.Forms.dll 的引用，然后开始编码：

```
using System.Windows.Forms;

[STAThread]
static void Main() {
    Application.EnableVisualStyles();
    Application.Run(new Form()); // or whatever
} 
```

重要的是`[STAThread]`你的`Main()`方法，需要完整的 COM 支持。

* * *

## 回答 #2

> 赞同：40
> 
> 时间：2012-06-15T20:59:48.663

我最近想这样做，但发现我对这里的任何答案都不满意。

如果您按照 Marc 的建议将输出类型设置为控制台应用程序，则会出现两个问题：

1) 如果您从资源管理器启动应用程序，您会在表单后面看到一个烦人的控制台窗口，该窗口在程序退出之前不会消失。我们可以通过在显示 GUI (Application.Run) 之前调用 FreeConsole 来缓解这个问题。这里的烦恼是控制台窗口仍然出现。它立即消失，但仍然存在片刻。

2) 如果从控制台启动它并显示 GUI，则控制台将被阻止，直到 GUI 退出。这是因为控制台 (cmd.exe) 认为它应该同步启动控制台应用程序和异步启动 Windows 应用程序（unix 等效于“myprocess &”）。

如果您将输出类型保留为 Windows 应用程序，但*正确*调用 AttachConsole，则从控制台调用时不会获得第二个控制台窗口，并且从资源管理器调用时不会获得不必要的控制台。调用 AttachConsole 的正确方法是将 -1 传递给它。这会导致我们的进程附加到父进程的控制台（启动我们的控制台窗口）。

但是，这有两个不同的问题：

1) 由于控制台在后台启动 Windows 应用程序，它会立即显示提示并允许进一步输入。一方面这是个好消息，控制台不会在您的 GUI 应用程序上被阻止，但是如果您想将输出转储到控制台并且从不显示 GUI，您的程序的输出会出现在提示之后并且没有新的提示完成后显示。这看起来有点令人困惑，更不用说您的“控制台应用程序”正在后台运行，并且用户可以在运行时自由执行其他命令。

2) 流重定向也搞砸了，例如“myapp some parameters > somefile”无法重定向。流重定向问题需要大量的 p/Invoke 来修复标准句柄，但它是可以解决的。

经过数小时的狩猎和试验，我得出的结论是，没有办法完美地做到这一点。您根本无法在没有任何副作用的情况下获得控制台和窗口的所有好处。选择对您的应用程序而言最不烦人的副作用是一个问题。

* * *

## 回答 #3

> 赞同：26
> 
> 时间：2008-11-11T02:03:38.520

这是我找到的最好的方法：首先，将您的项目输出类型设置为“Windows 应用程序”，然后 P/Invoke AllocConsole 创建一个控制台窗口。

```
internal static class NativeMethods
{
    [DllImport("kernel32.dll")]
    internal static extern Boolean AllocConsole();
}

static class Program
{

    static void Main(string[] args) {
        if (args.Length == 0) {
            // run as windows app
            Application.EnableVisualStyles();
            Application.Run(new Form1()); 
        } else {
            // run as console app
            NativeMethods.AllocConsole();
            Console.WriteLine("Hello World");
            Console.ReadLine();
        }
    }

} 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2011-12-01T20:26:10.737

做起来很简单：

只需将以下属性和代码添加到您的 Main 方法中：

```
[STAThread]
void Main(string[] args])
{
   Application.EnableVisualStyles();
   //Do some stuff...
   while(!Exit)
   {
       Application.DoEvents(); //Now if you call "form.Show()" your form won´t be frozen
       //Do your stuff
   }
} 
```

现在您完全可以显示 WinForms 了 :)

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-11-10T12:44:41.643

您可以在 VS2005/VS2008 中创建一个 winform 项目，然后将其属性更改为命令行应用程序。然后可以从命令行启动它，但仍会打开一个 winform。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2018-06-13T00:07:23.087

以上所有答案都有很大帮助，但我想为绝对初学者添加更多提示。

因此，您想**在控制台应用程序中对 Windows 窗体执行一些操作：**

在解决方案资源管理器的控制台应用程序项目中添加对**System.Windows.Forms.dll**的引用。（右键单击解决方案名称->添加->参考...）

在代码中指定名称空间：`using System.Windows.Forms;`

在您的类中为您希望添加到表单的控件声明所需的属性。

例如`int Left { get; set; } // need to specify the LEFT position of the button on the Form`

然后在中添加以下代码片段`Main()`：

```
static void Main(string[] args)
{
Application.EnableVisualStyles();
        Form frm = new Form();  // create aForm object

        Button btn = new Button()
        {
            Left = 120,
            Width = 130,
            Height = 30,
            Top = 150,
            Text = "Biju Joseph, Redmond, WA"
        };
       //… more code 
       frm.Controls.Add(btn);  // add button to the Form
       //  …. add more code here as needed

       frm.ShowDialog(); // a modal dialog 
} 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-10T12:46:23.140

您应该能够以与 Winform 应用程序相同的方式使用 Application 类。可能开始一个新项目最简单的方法就是按照 Marc 的建议：创建一个新的 Winform 项目，然后在选项中将其更改为控制台应用程序

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2015-07-09T03:29:09.983

这满足了我的需求...

```
Task mytask = Task.Run(() =>
{
    MyForm form = new MyForm();
    form.ShowDialog();
}); 
```

这从一个新线程中开始，并且在表单关闭之前不会释放线程。`Task`在 .Net 4 及更高版本中。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2018-04-20T14:51:01.293

如果您想摆脱**Form Freeze**并使用编辑（如按钮的文本），请使用此代码

```
Form form = new Form();
Form.Button.Text = "randomText";
System.Windows.Forms.Application.EnableVisualStyles();
System.Windows.Forms.Application.Run(form); 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2015-08-22T11:03:57.923

它完全取决于您的选择，即您如何实施。
一种。附加过程，例如：在表单上输入并在控制台
b 上打印。独立进程，例如：启动计时器，即使控制台退出也不关闭。

为一个，

```
Application.Run(new Form1());
//or -------------
Form1 f = new Form1();
f.ShowDialog(); 
```

对于b，使用线程，或任务任何东西， [如何独立打开win表单？](http://www.asptricks.net/2015/08/how-to-run-windows-form-from-console.html)

# c - 避免 printf() 中的尾随零

> ID：277772
> 
> 赞同：123
> 
> 时间：2008-11-10T12:42:23.460
> 
> 标签：c, printf

我一直在寻找 printf() 系列函数的格式说明符。我想要的是能够打印小数点后具有最大给定位数的双精度（或浮点数）。如果我使用：

```
printf("%1.3f", 359.01335);
printf("%1.3f", 359.00999); 
```

我明白了

```
359.013
359.010 
```

而不是想要的

```
359.013
359.01 
```

有谁能够帮助我？

* * *

## 回答 #1

> 赞同：97
> 
> 时间：2008-11-10T13:01:01.457

`printf`使用普通格式说明符无法做到这一点。你能得到的最接近的是：

```
printf("%.6g", 359.013); // 359.013
printf("%.6g", 359.01);  // 359.01 
```

但“.6”是*总*数字宽度，所以

```
printf("%.6g", 3.01357); // 3.01357 
```

打破它。

您*可以*做的是`sprintf("%.20g")`将数字转换为字符串缓冲区，然后将字符串操作为只有小数点后的 N 个字符。

假设您的数字在变量 num 中，以下函数将删除除第一个小数之外的所有`N`小数，然后去除尾随零（如果它们全为零，则去除小数点）。

```
char str[50];
sprintf (str,"%.20g",num);  // Make the number.
morphNumericString (str, 3);
:    :
void morphNumericString (char *s, int n) {
    char *p;
    int count;

    p = strchr (s,'.');         // Find decimal point, if any.
    if (p != NULL) {
        count = n;              // Adjust for more or less decimals.
        while (count >= 0) {    // Maximum decimals allowed.
             count--;
             if (*p == '\0')    // If there's less than desired.
                 break;
             p++;               // Next character.
        }

        *p-- = '\0';            // Truncate string.
        while (*p == '0')       // Remove trailing zeros.
            *p-- = '\0';

        if (*p == '.') {        // If all decimals were zeros, remove ".".
            *p = '\0';
        }
    }
} 
```

* * *

如果你对截断方面不满意（它会`0.12399`变成`0.123`而不是四舍五入`0.124`），你实际上可以使用已经提供的四舍五入工具`printf`。您只需要事先分析数字以动态创建宽度，然后使用它们将数字转换为字符串：

```
#include <stdio.h>

void nDecimals (char *s, double d, int n) {
    int sz; double d2;

    // Allow for negative.

    d2 = (d >= 0) ? d : -d;
    sz = (d >= 0) ? 0 : 1;

    // Add one for each whole digit (0.xx special case).

    if (d2 < 1) sz++;
    while (d2 >= 1) { d2 /= 10.0; sz++; }

    // Adjust for decimal point and fractionals.

    sz += 1 + n;

    // Create format string then use it.

    sprintf (s, "%*.*f", sz, n, d);
}

int main (void) {
    char str[50];
    double num[] = { 40, 359.01335, -359.00999,
        359.01, 3.01357, 0.111111111, 1.1223344 };
    for (int i = 0; i < sizeof(num)/sizeof(*num); i++) {
        nDecimals (str, num[i], 3);
        printf ("%30.20f -> %s\n", num[i], str);
    }
    return 0;
} 
```

在这种情况下，重点`nDecimals()`是正确计算字段宽度，然后使用基于此的格式字符串格式化数字。测试工具`main()`显示了这一点：

```
 40.00000000000000000000 -> 40.000
 359.01335000000000263753 -> 359.013
-359.00999000000001615263 -> -359.010
 359.00999999999999090505 -> 359.010
   3.01357000000000008200 -> 3.014
   0.11111111099999999852 -> 0.111
   1.12233439999999995429 -> 1.122 
```

获得正确舍入的值后，您可以再次传递它以`morphNumericString()`通过简单地更改来删除尾随零：

```
nDecimals (str, num[i], 3); 
```

进入：

```
nDecimals (str, num[i], 3);
morphNumericString (str, 3); 
```

`morphNumericString`（或在结束时调用，`nDecimals`但在这种情况下，我可能只是将两者合并为一个函数），你最终得到：

```
 40.00000000000000000000 -> 40
 359.01335000000000263753 -> 359.013
-359.00999000000001615263 -> -359.01
 359.00999999999999090505 -> 359.01
   3.01357000000000008200 -> 3.014
   0.11111111099999999852 -> 0.111
   1.12233439999999995429 -> 1.122 
```

* * *

## 回答 #2

> 赞同：65
> 
> 时间：2008-11-10T12:45:31.660

要摆脱尾随零，您应该使用“%g”格式：

```
float num = 1.33;
printf("%g", num); //output: 1.33 
```

在稍微澄清了问题之后，抑制零并不是唯一被要求的事情，但也需要将输出限制在小数点后三位。我认为这不能单独使用 sprintf 格式字符串来完成。正如[Pax Diablo](https://stackoverflow.com/questions/277772/#277810)所指出的，字符串操作是必需的。

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2010-11-22T16:10:46.423

我喜欢 R. 稍微调整的答案：

```
float f = 1234.56789;
printf("%d.%.0f", f, 1000*(f-(int)f)); 
```

'1000' 确定精度。

*幂为 0.5 舍入。*

**编辑**

好的，这个答案被编辑了几次，我忘记了几年前的想法（最初它没有满足所有标准）。所以这是一个新版本（它满足所有标准并正确处理负数）：

```
double f = 1234.05678900;
char s[100]; 
int decimals = 10;

sprintf(s,"%.*g", decimals, ((int)(pow(10, decimals)*(fabs(f) - abs((int)f)) +0.5))/pow(10,decimals));
printf("10 decimals: %d%s\n", (int)f, s+1); 
```

和测试用例：

```
#import <stdio.h>
#import <stdlib.h>
#import <math.h>

int main(void){

    double f = 1234.05678900;
    char s[100];
    int decimals;

    decimals = 10;
    sprintf(s,"%.*g", decimals, ((int)(pow(10, decimals)*(fabs(f) - abs((int)f)) +0.5))/pow(10,decimals));
    printf("10 decimals: %d%s\n", (int)f, s+1);

    decimals = 3;
    sprintf(s,"%.*g", decimals, ((int)(pow(10, decimals)*(fabs(f) - abs((int)f)) +0.5))/pow(10,decimals));
    printf(" 3 decimals: %d%s\n", (int)f, s+1);

    f = -f;
    decimals = 10;
    sprintf(s,"%.*g", decimals, ((int)(pow(10, decimals)*(fabs(f) - abs((int)f)) +0.5))/pow(10,decimals));
    printf(" negative 10: %d%s\n", (int)f, s+1);

    decimals = 3;
    sprintf(s,"%.*g", decimals, ((int)(pow(10, decimals)*(fabs(f) - abs((int)f)) +0.5))/pow(10,decimals));
    printf(" negative  3: %d%s\n", (int)f, s+1);

    decimals = 2;
    f = 1.012;
    sprintf(s,"%.*g", decimals, ((int)(pow(10, decimals)*(fabs(f) - abs((int)f)) +0.5))/pow(10,decimals));
    printf(" additional : %d%s\n", (int)f, s+1);

    return 0;
} 
```

以及测试的输出：

```
 10 decimals: 1234.056789
  3 decimals: 1234.057
 negative 10: -1234.056789
 negative  3: -1234.057
 additional : 1.01 
```

现在，满足所有条件：

*   零后面的最大小数位数是固定的
*   尾随零被删除
*   它在数学上是正确的（对吗？）
*   当第一个小数为零时（现在）也有效

不幸的是，这个答案是一个两行的，因为`sprintf`不返回字符串。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2014-08-14T16:54:13.297

为什么不这样做呢？

```
double f = 359.01335;
printf("%g", round(f * 1000.0) / 1000.0); 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2010-07-08T07:45:36.713

像这样的东西怎么样（可能有舍入错误和需要调试的负值问题，留给读者练习）：

```
printf("%.0d%.4g\n", (int)f/10, f-((int)f-(int)f%10)); 
```

它有点程序化，但至少它不会让你做任何字符串操作。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2013-03-08T01:27:58.533

我在字符串（从最右边开始）搜索`1`到`9`（ASCII 值`49`- `57`）范围内的第一个字符，然后`null`（设置为`0`）它右边的每个字符 - 见下文：

```
void stripTrailingZeros(void) { 
    //This finds the index of the rightmost ASCII char[1-9] in array
    //All elements to the left of this are nulled (=0)
    int i = 20;
    unsigned char char1 = 0; //initialised to ensure entry to condition below

    while ((char1 > 57) || (char1 < 49)) {
        i--;
        char1 = sprintfBuffer[i];
    }

    //null chars left of i
    for (int j = i; j < 20; j++) {
        sprintfBuffer[i] = 0;
    }
} 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2016-03-24T14:39:29.030

一些投票率很高的解决方案建议`%g`使用`printf`. 这是错误的，因为在某些情况下`%g`会产生科学记数法。其他解决方案使用数学来打印所需的小数位数。

我认为最简单的解决方案是使用`sprintf`转换`%f`说明符并从结果中手动删除尾随零和可能的小数点。这是一个 C99 解决方案：

```
#include <stdio.h>
#include <stdlib.h>

char*
format_double(double d) {
    int size = snprintf(NULL, 0, "%.3f", d);
    char *str = malloc(size + 1);
    snprintf(str, size + 1, "%.3f", d);

    for (int i = size - 1, end = size; i >= 0; i--) {
        if (str[i] == '0') {
            if (end == i + 1) {
                end = i;
            }
        }
        else if (str[i] == '.') {
            if (end == i + 1) {
                end = i;
            }
            str[end] = '\0';
            break;
        }
    }

    return str;
} 
```

请注意，用于数字和小数点分隔符的字符取决于当前的语言环境。上面的代码假定 C 或美国英语语言环境。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2013-02-28T04:08:39.573

一个简单的解决方案，但它可以完成工作，分配已知的长度和精度，并避免采用指数格式的机会（使用 %g 时这是一种风险）：

```
// Since we are only interested in 3 decimal places, this function
// can avoid any potential miniscule floating point differences
// which can return false when using "=="
int DoubleEquals(double i, double j)
{
    return (fabs(i - j) < 0.000001);
}

void PrintMaxThreeDecimal(double d)
{
    if (DoubleEquals(d, floor(d)))
        printf("%.0f", d);
    else if (DoubleEquals(d * 10, floor(d * 10)))
        printf("%.1f", d);
    else if (DoubleEquals(d * 100, floor(d* 100)))
        printf("%.2f", d);
    else
        printf("%.3f", d);
} 
```

如果您想要最多 2 位小数，请添加或删除“其他”；4 位小数；等等

例如，如果您想要 2 个小数：

```
void PrintMaxTwoDecimal(double d)
{
    if (DoubleEquals(d, floor(d)))
        printf("%.0f", d);
    else if (DoubleEquals(d * 10, floor(d * 10)))
        printf("%.1f", d);
    else
        printf("%.2f", d);
} 
```

如果要指定保持字段对齐的最小宽度，请根据需要增加，例如：

```
void PrintAlignedMaxThreeDecimal(double d)
{
    if (DoubleEquals(d, floor(d)))
        printf("%7.0f", d);
    else if (DoubleEquals(d * 10, floor(d * 10)))
        printf("%9.1f", d);
    else if (DoubleEquals(d * 100, floor(d* 100)))
        printf("%10.2f", d);
    else
        printf("%11.3f", d);
} 
```

您还可以将其转换为传递所需字段宽度的函数：

```
void PrintAlignedWidthMaxThreeDecimal(int w, double d)
{
    if (DoubleEquals(d, floor(d)))
        printf("%*.0f", w-4, d);
    else if (DoubleEquals(d * 10, floor(d * 10)))
        printf("%*.1f", w-2, d);
    else if (DoubleEquals(d * 100, floor(d* 100)))
        printf("%*.2f", w-1, d);
    else
        printf("%*.3f", w, d);
} 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2015-10-31T05:45:28.837

我在发布的一些解决方案中发现了问题。我根据上面的答案把它放在一起。它似乎对我有用。

```
int doubleEquals(double i, double j) {
    return (fabs(i - j) < 0.000001);
}

void printTruncatedDouble(double dd, int max_len) {
    char str[50];
    int match = 0;
    for ( int ii = 0; ii < max_len; ii++ ) {
        if (doubleEquals(dd * pow(10,ii), floor(dd * pow(10,ii)))) {
            sprintf (str,"%f", round(dd*pow(10,ii))/pow(10,ii));
            match = 1;
            break;
        }
    }
    if ( match != 1 ) {
        sprintf (str,"%f", round(dd*pow(10,max_len))/pow(10,max_len));
    }
    char *pp;
    int count;
    pp = strchr (str,'.');
    if (pp != NULL) {
        count = max_len;
        while (count >= 0) {
             count--;
             if (*pp == '\0')
                 break;
             pp++;
        }
        *pp-- = '\0';
        while (*pp == '0')
            *pp-- = '\0';
        if (*pp == '.') {
            *pp = '\0';
        }
    }
    printf ("%s\n", str);
}

int main(int argc, char **argv)
{
    printTruncatedDouble( -1.999, 2 ); // prints -2
    printTruncatedDouble( -1.006, 2 ); // prints -1.01
    printTruncatedDouble( -1.005, 2 ); // prints -1
    printf("\n");
    printTruncatedDouble( 1.005, 2 ); // prints 1 (should be 1.01?)
    printTruncatedDouble( 1.006, 2 ); // prints 1.01
    printTruncatedDouble( 1.999, 2 ); // prints 2
    printf("\n");
    printTruncatedDouble( -1.999, 3 ); // prints -1.999
    printTruncatedDouble( -1.001, 3 ); // prints -1.001
    printTruncatedDouble( -1.0005, 3 ); // prints -1.001 (shound be -1?)
    printTruncatedDouble( -1.0004, 3 ); // prints -1
    printf("\n");
    printTruncatedDouble( 1.0004, 3 ); // prints 1
    printTruncatedDouble( 1.0005, 3 ); // prints 1.001
    printTruncatedDouble( 1.001, 3 ); // prints 1.001
    printTruncatedDouble( 1.999, 3 ); // prints 1.999
    printf("\n");
    exit(0);
} 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2021-12-16T11:53:02.477

我的想法是计算不会导致给定双精度值尾随零的*所需*`"%1.*f"`精度，并将其传递给printf() 中的格式。这甚至可以作为单行来完成：

```
int main() {
    double r=1234.56789;
    int precision=3;
    printf(L"%1.*f", prec(r, precision), r);
}

int prec(const double& r, int precision)
{
    double rPos = (r < 0)? -r : r;
    double nkd = fmod(rPos, 1.0); // 0..0.99999999
    int i, ex10 = 1;
    for (i = 0; i < precision; ++i)
        ex10 *= 10;
    int nki = (int)(nkd * ex10 + 0.5);

    // "Eliminate" trailing zeroes
    int requiredPrecision = precision;
    for (; requiredPrecision && !(nki % 10); )  {
        --requiredPrecision;
        nki /= 10;
    }
    return requiredPrecision;        
} 
```

这是另一个`%g`解决方案。您应该始终提供“足够宽”的格式精度（默认仅为 6）并对值进行四舍五入。我认为这是一个很好的方法：

```
double round(const double &value, const double& rounding)  {
    return rounding!=0 ? floor(value/rounding + 0.5)*rounding : value;
}

printf("%.12g" round(val, 0.001)); // prints up to 3 relevant digits 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-11-10T14:49:43.983

这是我第一次尝试回答：

```
空白
xprintfloat(char *format, float f)
{
  字符 [50];
  字符 *p;

  sprintf(s, 格式, f);
  for(p=s; *p; ++p)
    if('.' == *p) {
      而（*++p）；
      while('0'==*--p) *p = '\0';
    }
  printf("%s", s);
}

```

已知错误：可能的缓冲区溢出取决于格式。如果 ”。” 除了 %f 可能发生错误结果之外的其他原因。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2010-02-01T05:47:24.437

以上略有变化：

1.  消除案例 (10000.0) 的期限。
2.  处理第一个期间后的休息时间。

代码在这里：

```
void EliminateTrailingFloatZeros(char *iValue)
{
  char *p = 0;
  for(p=iValue; *p; ++p) {
    if('.' == *p) {
      while(*++p);
      while('0'==*--p) *p = '\0';
      if(*p == '.') *p = '\0';
      break;
    }
  }
} 
```

它仍然有溢出的可能性，所以要小心;P

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2020-04-25T20:49:42.887

我会说你应该使用 `printf("%.8g",value);`

如果您使用`"%.6g"`某些数字（例如 32.230210），您将无法获得所需的输出，它应该打印`32.23021`但它会打印`32.2302`

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2020-08-28T09:26:44.153

遇到同样的问题，双精度是十进制的 15，浮点精度是十进制的 6，所以我分别为它们写了 2 个函数

```
#include <stdio.h>
#include <math.h>
#include <string>
#include <string.h>

std::string doublecompactstring(double d)
{
    char buf[128] = {0};
    if (isnan(d))
        return "NAN";
    sprintf(buf, "%.15f", d);
    // try to remove the trailing zeros
    size_t ccLen = strlen(buf);
    for(int i=(int)(ccLen -1);i>=0;i--)
    {
        if (buf[i] == '0')
            buf[i] = '\0';
        else
            break;
    }

    return buf;
}

std::string floatcompactstring(float d)
{
    char buf[128] = {0};
    if (isnan(d))
        return "NAN";
    sprintf(buf, "%.6f", d);
    // try to remove the trailing zeros
    size_t ccLen = strlen(buf);
    for(int i=(int)(ccLen -1);i>=0;i--)
    {
        if (buf[i] == '0')
            buf[i] = '\0';
        else
            break;
    }

    return buf;
}

int main(int argc, const char* argv[])
{
    double a = 0.000000000000001;
    float  b = 0.000001f;

    printf("a: %s\n", doublecompactstring(a).c_str());
    printf("b: %s\n", floatcompactstring(b).c_str());
    return 0;
} 
```

输出是

```
a: 0.000000000000001
b: 0.000001 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2021-05-27T07:56:10.497

我需要它，而 paxdiablo 的第一个答案就可以了。但我不需要截断，下面的版本可能会稍微快一点？在“.”之后开始搜索字符串结尾（EOS），只有一个 EOS 位置。

```
//https://stackoverflow.com/questions/277772/avoid-trailing-zeroes-in-printf
//adapted from paxdiablo (removed truncating)
char StringForDouble[50];
char *PointerInString;
void PrintDouble (double number) {
  sprintf(StringForDouble,"%.10f",number); // convert number to string
  PointerInString=strchr(&StringForDouble[0],'.'); // find decimal point, if any
  if(PointerInString!=NULL) {
    PointerInString=strchr(&PointerInString[0],'\0'); // find end of string
    do{
      PointerInString--;
    } while(PointerInString[0]=='0'); // remove trailing zeros
    if (PointerInString[0]=='.') { // if all decimals were zeros, remove "."
      PointerInString[0]='\0';
    } else {
      PointerInString[1]='\0'; //otherwise put EOS after the first non zero char
    }
  }
  printf("%s",&StringForDouble[0]);
} 
```

* * *

## 回答 #16

> 赞同：-1
> 
> 时间：2013-09-24T22:17:00.257

由于 f 之前的“.3”，您的代码四舍五入到小数点后三位

```
printf("%1.3f", 359.01335);
printf("%1.3f", 359.00999); 
```

因此，如果您将第二行四舍五入到小数点后两位，则应将其更改为：

```
printf("%1.3f", 359.01335);
printf("%1.2f", 359.00999); 
```

该代码将输出您想要的结果：

```
359.013
359.01 
```

*请注意，这是假设您已经将它打印在不同的行上，如果没有，则以下内容将阻止它在同一行上打印：

```
printf("%1.3f\n", 359.01335);
printf("%1.2f\n", 359.00999); 
```

以下程序源代码是我对此答案的测试

```
#include <cstdio>

int main()
{

    printf("%1.3f\n", 359.01335);
    printf("%1.2f\n", 359.00999);

    while (true){}

    return 0;

} 
```

# c# - 从javascript调用c#函数

> ID：277775
> 
> 赞同：0
> 
> 时间：2008-11-10T12:44:36.887
> 
> 标签：c#, javascript

我想从我的 javascript 函数中调用 ac# 函数。

我的 ascx 中有一个链接按钮（请参阅下面的代码）。问题是，如果您在 Firefox 中按 Enter 键不起作用，但它在 Internet Explorer 中运行良好。

```
<li class="clearfix border_top">
<label for="title" class="first_column bold">Search For</label>
<div class="contactUs_details">
<input type="text" id="advanced_txtBox1" name="advanced_txtBox1" class="searchbox" runat="server" style="width:300px;" />&nbsp;&nbsp;&nbsp;&nbsp;
<asp:CheckBox ID="chkSearchBDJ" runat="server" Text="Search BDJ" CssClass="checkboxlistnoborder" />
</div>
</li>

<div class="img_SearchNow">
<asp:LinkButton ID="btnSearchNow" CausesValidation="true" runat="server" OnClick="btnSearchNow_Click"></asp:LinkButton>
</div> 
```

我有 linkBut​​ton 见上面我在 Click 上调用了 c# 函数，但是如果你在上面的文本框中输入一些文本并按“Enter”，它应该会自动调用函数“btnSearchNow_Click”。它在 IE 中运行良好，但在 Firefox 中无法运行。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-10T13:00:24.920

单击按钮的javascript函数...

```
function clickMyButton() {
 var ele = document.getElementById('btnSearchNow');
 if ((ele !== null) && (ele != 'undefined')) {
   ele.click();
 }
} 
```

您问题的措辞可能需要一些清理或一些附加信息。

如果您正在寻找文本框中的伪提交行为，请查看这篇文章。[当我按 Enter 时提交登录控制按钮](https://stackoverflow.com/questions/201776/submit-login-control-button-when-i-hit-enter#201822)

您必须从服务器端生成 javascript，因为您使用的是 ASCX，并且 ID 不是您定义的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-10T13:46:51.550

您需要在页面上有一个提交类型，它才能在 Firefox 中正常工作。

```
<input id="mysubmit" runat="server" type="submit" onclick="return false;" style="display: none;" /> 
```

编辑：这是一个包含更多信息[的谷歌缓存页面。](http://74.125.95.104/search?q=cache:KAce1PN96SEJ:blog.solid1pxred.com/articles/2008/02/07/firefox-tip-for-broken-submit-on-enter-func+firefox+enter+submit+form&hl=en&ct=clnk&cd=4&gl=us&client=firefox-a)原来的帖子似乎没有可用的 ATM，但老谷歌有它。

# .net - 在 CF 3.5 中将音频作为流输入

> ID：277780
> 
> 赞同：0
> 
> 时间：2008-11-10T12:45:41.550
> 
> 标签：.net, audio, input, inputstream, audio-streaming

我用谷歌搜索并无法真正找到答案。

**如何****在使用 Compact Framework 的 CE/WinMobile 设备上将**音频输入设备（即麦克风）**作为流**（最好）打开？

 **我查看了 WindowsMo​​bile.DirectX，查看了名称中包含 Audio 的各种类，但似乎没有任何效果。

我想要做的基本上是通过网络将音频输入流式传输到服务器。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-10T13:32:29.770

“试图用 CF 做某事但不能”的通常答案是 OpenNetCF。

这是[WaveAudio 的页面，](http://www.opennetcf.com/library/sdf/html/f3fc3169-4143-54bc-1594-186da1fb01c2.htm)其中包含一个带有 RecordFor 方法的 Recorder 类，该方法在给定的秒数内录制到流中。对于您的目的来说，它不是很理想，但非常接近。OpenNetCF 的人们往往对请求非常敏感。

# c# - 如何正确打开 FileStream 以与 XDocument 一起使用

> ID：277783
> 
> 赞同：7
> 
> 时间：2008-11-10T12:48:30.013
> 
> 标签：c#, .net, filestream, linq-to-xml, access-control

我想使用 Linq2XML 将一些节点附加到 xml 文档中。有问题的文件正在被其他进程使用，他们应该能够在我更新文件时读取文件。所以我想出了这个解决方案，这显然不是正确的方法（方法 doc.Save() 失败并说另一个进程正在使用该文件）：

```
using (FileStream fs = new FileStream(filename, FileMode.Open, FileAccess.ReadWrite, FileShare.Read))
{
  doc = XDocument.Load(new StreamReader(fs));
  doc.Root.Add(entry);
  doc.Save(filename);
  fs.Close();
} 
```

非常感谢任何帮助。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-10T12:53:18.320

加载文档，关闭流，再次保存。这也意味着您可以以更简单的方式打开它:)

```
XDocument doc;

using (StreamReader reader = File.OpenText(filename))
{
  doc = XDocument.Load(reader);
  doc.Root.Add(entry);
}

doc.Save(filename); 
```

# java - Java XML：如何输出子元素的命名空间？

> ID：277793
> 
> 赞同：3
> 
> 时间：2008-11-10T12:54:50.127
> 
> 标签：java, xml

我正在使用 Java 的[Transformer](http://java.sun.com/j2se/1.5.0/docs/api/javax/xml/transform/Transformer.html)类来处理 XML Document 对象。

这是创建 Transformer 的代码：

```
import javax.xml.transform.TransformerFactory;
import javax.xml.transform.OutputKeys;
import javax.xml.transform.Transformer;

Transformer transformer = TransformerFactory.newInstance().newTransformer();
transformer.setOutputProperty(OutputKeys.INDENT, "no");
transformer.setOutputProperty(OutputKeys.OMIT_XML_DECLARATION, "yes");

transformer.transform(source, result); 
```

目前，我的输出如下所示：<svg ... />。我希望它包含每个元素的命名空间，如 <svg:svg ... />

我怎样才能做到这一点 ？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-12T17:00:07.087

请注意，`<svg xmlns="SVGNS" />`与 相同`<svg:svg xmlns:svg="SVGNS" />`。

你检查你调用`setNamespaceAware(true)`你的`DocumentBuilderFactory`实例了吗？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-10T13:26:48.627

[javax.xml.transform](http://java.sun.com/j2se/1.5.0/docs/api/javax/xml/transform/package-summary.html#package_description)的包描述有一个*Qualified Name Representation*部分，这似乎暗示可以在输入和输出中表示名称空间。

除了包含命名空间 URI 之外，我并不清楚结果会是什么样子。

试一试——希望其他人会有更具体的经验。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-29T02:06:58.613

我发现你需要把它作为前缀放在自己身上，甚至不使用命名空间。

例如，我使用了 el.setAttribute("xmi:type", type) 而不是 el.setAttributeNS("xsi", "type", type); 或 el.setAttributeNS(" [http://www...../URI](http://www...../URI) ", "type", type); 我发现 NS 方法并没有完全按照您的意愿去做。此外，它仍会呈现 xmlns="..." 而不是使用前缀。

# wcf - 使用 WCF 发送签名请求并接收未签名响应

> ID：277798
> 
> 赞同：2
> 
> 时间：2008-11-10T12:56:35.740
> 
> 标签：wcf, web-services, soap, ws-security

我正在与一个 .NET 开发团队合作，他们试图与使用 WS-Security 的 Web 服务进行交互，尽管该服务需要签名请求，但它只返回未签名的响应。

团队知道使用 WSE 调用服务的方法，但他们需要使用 WCF，所以任何人都可以建议如何配置 WCF 以发送签名请求并接收未签名响应？

TIA

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2010-06-23T16:50:06.130

查看[Microsoft Hotfix KB971493](http://support.microsoft.com/kb/971493/)：.NET Framework 3.5 SP1 提供了一个使 WCF 能够发送安全消息和接收不安全响应以及发送不安全消息和接收安全响应的修补程序。

Windows Communication Foundation (WCF) 没有发送安全消息然后接收不安全响应或发送不安全消息并接收安全响应的功能。本文中描述的修复程序添加了一个新的 enableUnsecuredResponse 属性。

# c# - 在不使用 COM 的情况下从 C++ 调用 C# 方法

> ID：277809
> 
> 赞同：6
> 
> 时间：2008-11-10T13:00:27.120
> 
> 标签：c#, .net, c++, com, interop

有没有办法创建 C# 对象并从非托管 C++ 调用方法，但不使用 COM Iterop？我正在寻找类似 JNI（但适用于 .Net）的东西，您可以在其中手动创建 VM、创建对象等。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-10T13:05:14.037

如果您使用的是 C++/CLI，那么您可以直接与托管世界和非托管代码进行交互，因此互操作是微不足道的。

您也可以自己托管 CLR，虽然托管 API 是基于 COM 的，但您可以创建任何托管对象。这个过程并不困难，因为听起来一些 API 调用封装了很多功能。网上有很多信息，例如关于“[托管公共语言运行时](http://msdn.microsoft.com/en-us/library/9x0wh2z3(VS.80).aspx)”的 MSDN 文档。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-10T13:14:04.423

有一种从 .NET 类/方法导出 C 样式 API 的“未记录”方式。

这最终会导致 .NET dll 导出了可以从 C/C++ 调用的 API 或任何可以使用 .DLL 的东西。

如果您喜欢“阅读”（beh ;），您可以得到一本书，名为：[Inside Microsoft® .NE​​T IL Assembler](http://www.microsoft.com/mspress/books/5771.aspx)，您将在第 15 章中找到该技术：“托管方法作为非托管导出”

还有一个关于代码项目的很好的示例项目，您可以将其用作 32 位环境的起点：http: [//www.codeproject.com/KB/dotnet/DllExport.aspx](http://www.codeproject.com/KB/dotnet/DllExport.aspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-10T13:03:06.570

您可以在 C++ 项目中逐个文件决定是否使用托管 C++。尝试更改项目中文件的设置，使其按托管方式编译。将调用放在您的 C# 对象中。

跨越 C++/C# 边界是有代价的，所以你应该分析在哪里做。就像，您不想在循环中执行此操作。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-10-31T20:03:38.533

我是[jni4net](http://jni4net.sf.net/)的作者，它是 JVM 和 CLR 之间的开源进程内桥梁。它建立在 JNI 和 PInvoke 之上。无需 C/C++ 代码。我希望它会帮助你。

# garbage-collection - 具有并发垃圾收集器的功能语言？

> ID：277812
> 
> 赞同：5
> 
> 时间：2008-11-10T13:02:56.287
> 
> 标签：garbage-collection, concurrency, tail-call

Microsoft 的新 F# 编程语言提供了函数式编程（一流的词法闭包和尾调用）与高效的并发垃圾收集器的强大组合，可以轻松利用多核。

OCaml、Haskell、Erlang 以及我所知道的所有免费 Lisp 和 Scheme 实现都没有并发 GC。Scala 和 Clojure 有一个并发 GC，但没有尾调用。

因此，似乎没有结合这些功能的开源编程语言。那是对的吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-12-03T13:35:33.973

Erlang 有一个无共享模型，其中[每个进程都有自己的垃圾收集器](http://prog21.dadgum.com/16.html)。您是否认为这不是并发，这取决于您。但随着进程数量的增加，它肯定可以很好地扩展。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-10T13:26:29.813

最新版本的 GHC 支持并行 GC。请参阅[发行说明](http://ghcmutterings.wordpress.com/2008/11/05/ghc-6101-is-out/)。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-11T18:36:38.750

Scala 有一些尾递归优化。但是要获得完整的[SISC 方案](http://sisc-scheme.org/)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-10T13:09:50.953

不是您问题的真正答案，但据我所知，F# 使用标准的 .NET 垃圾收集器，它不是并发的；GC期间所有线程都停止。

编辑：我的错误，在多处理器模式下存在并发 GC。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-10T13:35:35.787

据说 Java 正在添加尾调用。当这种情况发生时，clojure 会得到它们。同时，您可以使用循环/递归机制手动获取它们。

# c# - 我可以实现 DisposeBase 抽象类吗？

> ID：277814
> 
> 赞同：1
> 
> 时间：2008-11-10T13:03:26.333
> 
> 标签：c#, .net, inheritance, design-patterns, dispose

使用[DisposableBase 基类](http://www.danrigsby.com/blog/index.php/2008/03/15/disposable-base-class/)而不是在每个类上重新编码 Dispose 模式是否存在问题或隐藏问题？

为什么不是每个人都使用这样一个**相关**的类？

**编辑**：

1.  我自然只指实现 IDisposable 的类

2.  我知道它用尽了继承的选择权，但我愿意付出代价（至少在我可以的时候，否则它不会伤害我）。

3.  当我可以密封类时，我会这样做 - 但在某些情况下，我希望继承层次结构的基础是一次性的。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-10T13:09:37.150

您不需要在*每个*类上都实现 Dispose() - 只是那些需要确定性清理的东西。Re 一个 Disposable 基类，我不完全确定它提供了很多 -`IDisposable`不是一个复杂的接口。它可能有用的主要时间是如果您正在处理非托管资源并想要一个终结器，但即使那样它也没有太多代码。

就个人而言，我不会为这样的基类而烦恼。特别是，继承（在单继承世界中）很快就会受到限制。但更重要的是，重写一个方法与简单地提供一个公共 Dispose() 方法没有太大区别。

同样：如果您正在处理非托管对象，则只需要终结器等。

如果我有很多这些（非托管资源），我可能会看看是否可以让[PostSharp](http://www.postsharp.org/)为我完成这项工作。我不知道是否已经存在，但*可能*会创建一个处理（特别是）终结器等的方面。谁知道......

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-10T13:12:00.683

好吧，它使用了你的一个继承选项来描述你的类的一个方面——这并不理想，IMO。尝试用组合来做一些事情会很有趣，你有一个 DisposableHelper 的引用，而 IDisposable 的实现只调用了 helper.Dispose，它包含了其余的样板逻辑 - 并且可以通过 a 回调你的代码回调委托。唔。子类可以订阅受保护的 Disposing 事件以注册“我需要做某事”......这可能值得花点时间看看。

就我个人而言，我发现自己实现 IDisposable 的频率不足以使其成为问题 - 当我这样做时，我通常无论如何都会密封我的课程，因此模式中的一半内容变得不成问题。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-10T15:13:00.300

正如 Marc Gravell 所说，如果您正在处理非托管对象，则只需要一个终结器。[根据Dispose、Finalization 和 Resource Management](http://www.bluebytesoftware.com/blog/PermaLink.aspx?guid=88e62cdf-5919-4ac7-bc33-20c06ae539ae)指南第 1.1.4 节中的原因，在基类中引入不必要的终结器是一个坏主意：

> 从性能和代码复杂性的角度来看，带有终结器的实例存在实际成本。... 终结增加了对象生命周期的成本和持续时间，因为每个可终结对象在分配时都必须放在一个特殊的终结器注册队列中，本质上是创建一个额外的指针大小的字段来引用您的对象。此外，此队列中的对象在 GC 期间被遍历、处理并最终提升到 GC 用来执行终结器的另一个队列。增加可终结对象的数量与将更多对象提升到更高代直接相关，以及 GC 遍历队列、移动指针和执行终结器所花费的时间增加。此外，通过将对象的状态保持更长的时间，

如果您使用[SafeHandle](http://msdn.microsoft.com/en-us/library/system.runtime.interopservices.safehandle.aspx)（和相关类），则从 DisposableBase 派生的任何类都不太可能需要最终确定。

# c# - 在 .NET 中编译与版本无关的 DLL

> ID：277817
> 
> 赞同：10
> 
> 时间：2008-11-10T13:05:36.267
> 
> 标签：c#, .net, visual-studio-2008, dll, version

## 设想

我有两个围绕 Microsoft Office 的包装器，一个用于 2003，一个用于 2007。由于同时运行两个版本的 Microsoft Office 是“不可能的”，也不是 Microsoft 推荐的，所以我们有两个盒子，一个带有 Office 2003，另一个使用 Office 2007。我们分别编译包装器。DLL 包含在我们的解决方案中，每个框都有*相同*的结帐，但“卸载”了 Office 2003 或 2007，因此它不会尝试编译该特定 DLL。由于 Office COM DLL 不可用，否则将在编译时引发错误。

我们使用 .NET 2.0 和 Visual Studio 2008。

## 事实

由于 Microsoft 在 2007 年神秘地更改了 Office 2003 API，重命名和更改了一些方法（*叹气*），从而使它们不向后兼容，我们*需要*两个包装器。我们为每台构建机器提供了解决方案，并激活了一个 Office DLL。例如：装有 Office 2003 的机器已卸载“Office 2007”DLL，因此不编译它。另一个盒子是同样的想法，但反过来。这一切都是因为我们不能在同一个盒子里有 2 个不同的 Office 用于编程目的。（根据微软的说法，从技术上讲，你可以同时拥有两个 Office）但*不是*为了编程，也不是没有一些问题。

## 问题

当我们更改应用程序版本（例如从 1.5.0.1 到 1.5.0.2）时，我们需要重新编译 DLL 以匹配应用程序的新版本，这是自动完成的，因为解决方案中包含了 Office 包装器。由于包装器包含在解决方案中，它们继承了 APP 版本，但我们必须这样做两次，然后将另一个 DLL“复制”到创建安装程序的机器上。（疼痛……）

## 问题

是否有可能编译一个适用于*任何*版本的应用程序的 DLL，尽管它“较旧”？我读过一些关于清单的东西，但我从来没有与那些互动过。任何指针将不胜感激。

这样做的秘密原因是我们没有改变“时代”的包装器，微软也没有改变他们古老的 API，但我们正在重新编译 DLL 以匹配我们发布的*每个*版本的应用程序版本。我想自动化这个过程，而不必依赖*两台*机器。

我无法从项目中删除 DLL（两者都没有），因为存在依赖项。

我可以创建第三个“主包装器”，但还没有考虑过。

有任何想法吗？其他有同样要求的人吗？

## 更新

澄清：

我有 N 个项目的 1 个解决方案。

“应用程序”+ Office11Wrapper.dll + Office12Wrapper.dll。

两个“包装器”都使用解决方案中的应用程序 + 其他库（数据层、业务层、框架等）的依赖项

每个包装器都有各自 Office 包（2003 和 2007）的引用。

如果我编译但没有安装 office 12，我会从 Office12Wrapper.dll 收到错误，找不到 Office 2007 库。所以我有两台构建机器，一台使用 Office 2003，一台使用 Office 2007。在每台机器上进行完整的 SVN 更新 + 编译后，我们只需在“安装程序”中使用 office12.dll 来针对“相同”编译包装器代码，相同版本”。

注意：Office 2007 Build Machine 已“卸载”了 Office 2003 的 Wrapper，反之亦然。

提前致谢。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-11-12T16:19:00.650

当 .NET 程序集解析器在运行时无法找到引用的程序集时（在这种情况下，它找不到应用程序链接到的特定包装 DLL 版本），它的默认行为是失败并实质上使应用程序崩溃。但是，可以通过挂钩 AppDomain.AssemblyResolve 事件来覆盖此行为。只要找不到引用的程序集，就会触发此事件，它使您有机会用另一个程序集替换缺少的程序集（前提是它们兼容）。因此，例如，您可以替换您自己加载的旧版本的包装 DLL。

我发现做到这一点的最好方法是在挂钩事件的应用程序的主类上添加一个静态构造函数，例如：

```
using System.Reflection;

static Program()
{
    AppDomain.CurrentDomain.AssemblyResolve += delegate(object sender, ResolveEventArgs e)
    {
        AssemblyName requestedName = new AssemblyName(e.Name);

        if (requestedName.Name == "Office11Wrapper")
        {
            // Put code here to load whatever version of the assembly you actually have

            return Assembly.LoadFile("Office11Wrapper.DLL");
        }
        else
        {
            return null;
        }
    }
} 
```

通过将它放在主应用程序类的静态构造函数中，它可以保证在任何代码尝试访问包装 DLL 中的任何内容之前运行，从而确保挂钩提前到位。

您还可以使用策略文件进行版本重定向，但这往往更复杂。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-10T13:19:15.477

只是一个想法-您可以使用 TlbExp 创建两个互操作程序集（具有不同的名称和程序集），并使用接口/工厂通过您自己的接口对两者进行编码吗？一旦你有了互操作 dll，你就不需要 COM 依赖（当然除了测试等）。

TlbImp 有一个版本的 /asmversion，所以它可以作为构建脚本的一部分来完成；但我敢肯定你甚至需要这个：只需确保参考（解决方案资源管理器）中的“特定版本”是错误的？

另外 - 我知道它没有帮助，但是带有`dynamic`和/或“无 PIA”的 C# 4.0 可能会有所帮助（将来；也许）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-10T13:50:58.750

我不确定我是否完全遵循你所说的一切，但让我试试：

听起来您有一个包含 2 个（？）项目的解决方案。一个是实际应用程序，另一个是 Office API 的包装器。然后，您的应用程序具有对您的 Office API 包装器的项目引用。我以前从未为 Office 编程过，但听起来编程 API 是一个通用组件，您只能在机器上拥有一个版本（即 2003 或 2007，而不是两者）。也许这就是问题所在，但是因为您有一个项目引用，所以包装器将首先被编译，复制到您的应用程序的 bin 目录，您的应用程序将链接到该包装器的构建。这将导致应用程序的清单在运行时专门请求该版本的包装器。

如果您将包装器放在单独的解决方案中，并添加了对已编译库而不是项目的引用，您将始终将您的应用程序链接到该包装器版本，您可以避免该问题。

另一种可能的选择是程序集绑定重定向。这是更高级的，并带有它自己的一组问题，但你可以在[这里](http://msdn.microsoft.com/en-us/library/7wd6ex19.aspx)阅读。

或者类似于 Marc 的想法，您可以提取一个接口并将一些通用对象拉入一个框架库，然后针对接口和通用对象编写您的应用程序。然后在运行时使用反射来加载程序集并实例化您想要的包装器。

我认为关键是如果可以的话，删除项目依赖项。听起来包装器非常稳定并且没有改变，否则您不会要求链接到它的先前版本。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-10T14:16:14.643

在同一台机器上并排安装 Office 2003 和 2007[绝对是可能的](http://support.microsoft.com/kb/928091)- 我们在我们的组织中甚至在最终用户的生产工作站上也这样做。

在链接的文章中，Microsoft 建议您不要在实际使用中执行此操作。但在您的情况下，它似乎只适用于单个构建机器，即您不会在该机器上实际使用任一版本的 Office。在这种情况下，我会尝试看看您是否可以进行并排安装。

我的假设可能是错误的，您正在尝试为每个开发人员的机器执行此操作。在这种情况下，你应该忽略这个答案:-)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-16T17:12:51.617

不错的侦探工作！我只是根据上面介绍的概念拼凑了一个实现，它工作得非常好：

```
static Assembly domain_AssemblyResolve(object sender, ResolveEventArgs args)
{
     string partialName = args.Name.Substring(0, args.Name.IndexOf(','));
     return Assembly.Load(new AssemblyName(partialName));
} 
```

当然还有改进的空间，但这对我有用！

# c# - 从 ActionExecutingContext 获取原始端口？

> ID：277819
> 
> 赞同：3
> 
> 时间：2008-11-10T13:08:48.303
> 
> 标签：c#, asp.net-mvc, logging

是否可以从 ActionExecutingContext 对象获取原始端口？如果是这样，怎么做？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-11T14:31:22.833

是的，看看ActionExecutingContext.HttpContext.Request.Url.Port；

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2018-03-03T07:56:34.860

使用这个： context.HttpContext.Request.Path 或 context.HttpContext.Request.PathBase

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-10T19:12:10.443

ActionExecutionContext.HttpContextBase.Url.Port 应该适合你。

# java - 在 EJB 上加载列表

> ID：277832
> 
> 赞同：2
> 
> 时间：2008-11-10T13:17:27.913
> 
> 标签：java, ejb-3.0

我有一个带有验证对象（返回真或假）的方法的远程 EJB。我希望能够将一个 ArrayList 对象传递给它，并让 EJB 用验证期间遇到的错误加载它，同时仍然接收真/假结果。

我怎样才能做到这一点？到目前为止，我可以将列表发送给它，它在服务器端受到影响，但原始列表在客户端没有被修改。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-10T13:22:22.707

这是因为当列表通过线路发送到 bean 时，必须制作副本，因为列表从一个 JVM 移动到另一个。与普通方法不同，它不是同一个列表。我不知道它如何与本地 bean 一起工作，但远程 bean 没有其他方法。

我建议您让 bean 返回列表，如果该列表为空，则该对象有效。

例如：

```
public List<String> methodWithValidation(Object input) {
    List<String> errors = new java.util.ArrayList<String>();
    //various validation tests, each adding a message on fail

    return errors;
} 
```

调用方法会这样做：

```
List<String> errors = bean.methodWithValidation(object);
if(!errors.isEmpty()) {
    //error logic
} else {
   //continue
} 
```

# ms-word - 将使用 DAV 协议打开文档的超链接？

> ID：277851
> 
> 赞同：1
> 
> 时间：2008-11-10T13:29:30.667
> 
> 标签：ms-word, webdav

我有一个 DAV 服务器（在本例中为 Oracle Portal）。如果我打开 word，然后输入文档的 DAV URL，系统会正确提示我输入用户名/密码，并签出文档。我可以对其进行编辑，然后单击“保存”将其保存回服务器。到目前为止，一切都很好。

我需要的是网页上的链接，该链接将打开文档以在 Word 中进行编辑。如果我只使用与 Word 中的“文件打开”对话框中使用的 URL 相同的 URL，我会得到一个只读副本，并且“文件保存”对话框建议将其保存在本地。

有没有办法直接从超链接打开文档进行 DAV 编辑？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-10T13:51:41.213

根据[此线程](http://www.gossamer-threads.com/lists/zope/dev/217568?page=last)，您应该能够通过在响应中添加特殊标头来支持 DAV，以便单词知道它可以通过 DAV 进行编辑。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-06-10T14:18:50.160

以只读方式打开此类链接似乎是 Word 的默认行为。但是，似乎有两种解决方法。您可以调整注册表设置或使用 SharePoint.OpenDocuments ActiveX 控件。

见这里：[http ://www.webdavsystem.com/server/documentation/hyperlinked_ms_office_docs](http://www.webdavsystem.com/server/documentation/hyperlinked_ms_office_docs)

* * *

## 回答 #3

> 赞同：-2
> 
> 时间：2008-11-10T13:43:54.007

不，dav 协议使用标准的 HTTP 事务，除非客户端知道对 DAV 的支持，否则它不会知道使用它。

Word 可能无法识别 DAV，并且您依赖于将 DAV 设备安装为已安装的网络驱动器的人员。

IE：就文字而言，它就像任何其他 URL。

（除非有办法在 DAVFS 系统上通过具有不同协议说明符的 url 来明确告知它，例如 davfs://www.google.com/ 如果 davfs 恰好是您的客户认可的注册协议，这当然很有意义，仅出于这个原因，您不太可能在 windows 中找到它的支持）

# c++ - flash 和 c++ 的脚本语言？

> ID：277855
> 
> 赞同：0
> 
> 时间：2008-11-10T13:35:53.460
> 
> 标签：c++, flash, scripting

我每周花几个小时编写自己的个人项目。我有一个不错的 C++ 后端。对于我的下一个想法，它小巧轻便，可以在 Flash 中完成。但我想用脚本语言来做，所以我可以在我的 C++ 项目中调用代码。我可以在 Flash 和 c++ 中使用什么脚本？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-13T12:54:17.983

[根据 Adob](http://www.adobe.com/devnet/actionscript/articles/actionscript3_overview.html) ​​e 的说法，ActionScript 基于 ECMAScript（又名 JavaScript），因此原则上您可以使用 ECMAScript 编写代码并使用适用于 C++ 的 ECMAScript 引擎。[维基百科](http://en.wikipedia.org/wiki/List_of_ECMAScript_engines)有一个很好的引擎实现列表。

# c# - 如何从 .aspx 页面向 .txt 日志文件写入内容（c#）

> ID：277857
> 
> 赞同：0
> 
> 时间：2008-11-10T13:37:08.200
> 
> 标签：c#, .net, logging, asp.net

这段代码似乎没有编译，我只需要在一个小的日志文本文件中写一些东西（文件末尾的新行）。

```
<%@ Import Namespace="System.IO" %>

void Page_Load( object sender, EventArgs e ){

    FileSystem myFileSystem = new FileSystem();
    myFileSystem.WriteAllText(logFile, hash, false); 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-10T13:44:04.443

[我在命名空间](http://msdn.microsoft.com/en-us/library/system.io.aspx)中看不到任何名为 FileSystem[的`System.IO`](http://msdn.microsoft.com/en-us/library/system.io.aspx)类。这是您尝试使用的 .NET 4.0 中的新功能吗？

请注意，[`File`](http://msdn.microsoft.com/en-us/library/system.io.file.aspx)该类有一个*名为*[`WriteAllText`](http://msdn.microsoft.com/en-us/library/system.io.file.writealltext.aspx). 这是你的意思吗？

编辑：要改为附加到文件，请使用[`File.AppendAllText`](http://msdn.microsoft.com/en-us/library/system.io.file.appendalltext.aspx).

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-10T13:43:16.333

FileSystem 是 VisualBasic 命名空间中的一个类：

[http://msdn.microsoft.com/en-us/library/microsoft.visualbasic.filesystem.aspx](http://msdn.microsoft.com/en-us/library/microsoft.visualbasic.filesystem.aspx)

看看 C# 中的 FileStream 类：

[http://msdn.microsoft.com/en-us/library/system.io.filestream.aspx](http://msdn.microsoft.com/en-us/library/system.io.filestream.aspx)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-10T13:44:14.753

文件系统位于 Microsoft.VisualBasic.File.IO 中。你必须参考那个。

尽管您可能根本不想要 FileSystem。你可能想要 System.IO.File

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-10T14:19:24.607

毫无疑问log4net！[http://logging.apache.org/log4net/index.html](http://logging.apache.org/log4net/index.html)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-10T13:55:38.850

这个似乎可以编译：

```
File myFileSystem = new File();
myFileSystem.AppendAllText(logFile, hash, false); 
```

# c# - 需要以相同方式处理的多种方法

> ID：277869
> 
> 赞同：1
> 
> 时间：2008-11-10T13:43:30.810
> 
> 标签：c#, delegates

在我目前正在编写的一段 C# 中，我需要以相同的方式处理具有相同签名的多个方法。将来可能还会有更多这些方法。我没有一遍又一遍地重复相同的逻辑，而是想到了以下内容：

```
private delegate bool cleanStep(BuildData bd, out String strFailure);

List<cleanStep> steps = new List<cleanStep>();
steps.Add(WriteReadme);
steps.Add(DeleteFiles);
steps.Add(TFSHelper.DeleteLabel);
steps.Add(TFSHelper.DeleteBuild);

List<cleanStep>.Enumerator enumerator = steps.GetEnumerator();
bool result = true;
while (result && enumerator.MoveNext())
{
   result = enumerator.Current.Invoke(build, out strFailure);
   if (!result)
   {
      logger.Write(LogTypes.Error, strFailure);
   }
} 
```

我认为这有一些不错的功能，但也感觉有点过度设计和混淆。

**你能感谢一个更好的方法吗？**

顺便提一句：

*   它不需要是事务性的。
*   strFailure 不会隐藏异常，它会在必要时完全包装它们

谢谢。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-10T13:47:55.357

为什么不使用 foreach 循环然后中断？（我已将其重命名`cleanStep`为此`CleanStep`处以保持常规 - 我建议您也这样做。）

```
foreach(CleanStep step in steps)
{
    string failureText;
    if (!step(build, out failureText))
    {
        logger.Write(LogTypes.Error, strFailure);
        break;
    }
} 
```

请注意，这也遵守`IEnumerator<T>`您当前代码不`foreach`自动调用`Dispose`和`IEnumerator<T>`实现的约定`IDisposable`。在这种情况下这不是问题，但是对于迭代器块，[处置用于执行`finally`块](http://csharpindepth.com/Articles/Chapter6/IteratorBlockImplementation.aspx)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-10T13:48:15.247

您的解决方案既简单明了又易于理解。我看不出有什么理由用另一种方式来做:)

我唯一建议的是用 foreach 循环替换您的迭代器并在错误时中断。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-10T13:49:38.690

重新混淆 -`foreach`使用 break 可能会更清晰（加上它`Dispose()`是枚举器，你没有这样做）。

实际上，“params cleanStep[] 目标”可能会有所帮助：

```
static bool RunTargets(params cleanStep[] targets)
{
    // detail as per Jon's post
} 
```

然后你可以打电话：

```
bool foo = RunTargets(WriteReadme, DeleteFiles,
              TFSHelper.DeleteLabel, TFSHelper.DeleteBuild); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-10T14:35:25.477

我会返回一个异常对象而不是一个字符串。由于异常通常具有全局策略，因此我会编写一些异常扩展。现在你得到：

```
static Exception Run( this IEnumerable<Step> steps) {
   return 
       steps
       .FirstOrDefault( (step) => step( build ) != null )
       .LogIfFailure();  //or .ThrowIfFailure()
} 
```

扩展：

```
public static class ExceptionExtensions {
    private static logger = new Logger();

    public static Exception LogIfFailure( this Exception e ) {
        if( e != null )
            logger.Write( e.Message );
        return e;
    }
    public static Exception ShowDialogIfFailure( this Exception e ) {
        if( e != null )
            MessageBox.Show( e.Message );
        return e;
    }
    public static void ThrowIfFailure( this Exception e ) {
        if( e != null )
            Throw( e );
    }
} 
```

# c# - ASP.NET 模板

> ID：277875
> 
> 赞同：2
> 
> 时间：2008-11-10T13:44:16.767
> 
> 标签：c#, asp.net, algorithm, templates, caching

我们正在使用自定义 HttpModule 构建一个文本模板引擎，该引擎将 HTML 中的标签替换为 XML 文件中的整个文本部分。

目前，XML 文件作为字符串/字符串字典加载到内存中，因此 HttpModule 完成的查找/替换可以使用正则表达式非常快速地执行。

我们正在寻求扩展它的使用，以合并越来越大的替换文本部分，我担心作为字典的一部分一次在内存中保留更详细的文本，特别是当我们使用 ASP.NET 缓存也有很多用途。

有没有人对我们可以使用的更有效和可扩展的数据结构/管理策略提出建议？

**更新：**为了回应 Corbin March 在下面的好建议，我不认为这是我们走上一条“黑暗之路”的案例（尽管我很欣赏这种担忧）。我们的应用程序旨在为不同的客户完全重新设计，一直到页面上任何位置的文本 - 包括使用多种语言的能力。我所描述的技术已被证明是处理这个问题的最灵活的方法。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-10T14:08:59.773

您使用的内存量将与文件的大小大致相同。XML 在标签中会有一些开销，而 Dictionary 不会，因此它是对内存需求的安全估计。那么你说的是 10-50 MB 还是 100-500 MB？我不一定会担心 10 到 50 MB。

如果您担心，那么您需要考虑是否真的需要在每次加载页面时进行替换。你能接受每页访问一次数据库或 XML 文件，然后缓存 ASP.NET 页面的输出并保持一个小时吗？如果是这样，请考虑使用[Page Caching](http://msdn.microsoft.com/en-us/library/06bh14hk.aspx)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-10T16:22:03.407

几个想法：

压缩您的字典值。查看 Scott Hanselman 的[缓存压缩文章](http://www.hanselman.com/blog/TheWeeklySourceCode35ZipCompressingASPNETSessionAndCacheState.aspx)以获得练习的精神。如果您的字典键很大，请考虑压缩它们。

仅在请求时将 XML 文件中的项目加载到内存中并附加项目到期时间。如果在没有其他请求的情况下发生到期，请卸载该项目。这个想法是一些字典项目的使用频率较低，因此不常用项目的 IO 命中是可以接受的。显然，ASP.NET 缓存会为您执行此操作 - 我假设缓存在您处理输出时已脱离上下文。

只是一个意见......但我的蜘蛛感应警告我你可能会走上一条黑暗的道路。ASP.NET 的很大一部分是它的模板功能——母版页、页面模板、用户控件、自定义控件、模板化控件、国际化资源方案。如果可能的话，我会尝试使用这些工具而不是文本处理 HttpModule 来解决您的问题。

# .net - 为什么，当我在 WCF 服务中模拟时，当我尝试运行 LINQ to SQL 查询时，我的服务不能加载 System.Transactions？

> ID：277881
> 
> 赞同：8
> 
> 时间：2008-11-10T13:47:26.387
> 
> 标签：.net, sql-server, wcf, security, transactions

我有一个 WCF 服务，托管在 IIS 7.0 中，需要运行数据库查询。为了获得执行此操作的正确权限，我在服务中模拟如下：

### 代码

```
[OperationBehavior(Impersonation = ImpersonationOption.Allowed)]
public void MyOperation(int arg) 
```

### 配置

```
<behavior name="ReceivingServiceBehavior">
    <!-- Other behaviors -->
    <serviceAuthorization impersonateCallerForAllOperations="true" />
</behavior> 
```

当我尝试连接并运行我的查询时，我得到以下信息：

```
异常 - System.IO.FileLoadException：无法加载文件或
程序集'System.Transactions，版本=2.0.0.0，文化=中性，
PublicKeyToken=b77a5c561934e089' 或其依赖项之一。要么
未提供所需的模拟级别，或提供的
模拟级别无效。（来自 HRESULT 的异常：0x80070542）

文件名：'System.Transactions，Version=2.0.0.0，Culture=neutral，PublicKeyToken=b77a5c561934e089' ---> System.Runtime.InteropServices.COMException (0x80070542)：未提供所需的模拟级别，或提供的模拟级别无效。（来自 HRESULT 的异常：0x80070542）
   在 System.Data.Linq.SqlClient.SqlConnectionManager.UseConnection（IConnectionUser 用户）
   在 System.Data.Linq.SqlClient.SqlProvider.get_IsSqlCe()
   在 System.Data.Linq.SqlClient.SqlProvider.InitializeProviderMode()
   在 System.Data.Linq.SqlClient.SqlProvider.System.Data.Linq.Provider.IProvider.Execute（表达式查询）
   在 System.Data.Linq.DataQuery`1.System.Collections.Generic.IEnumerable.GetEnumerator()
   在 System.Linq.Buffer`1..ctor（IEnumerable`1 源）
   在 System.Linq.Enumerable.ToArray[TSource]（IEnumerable`1 源）
   在 Fourth.GHS.MessageRelay.RegistrationDBStorage.FindRegistration(SystemKey 键)

```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-26T14:41:11.647

您的 WCF 客户端是否设置了所需的“允许的模拟级别”：

```
<?xml version="1.0" encoding="utf-8" ?>
<configuration>
    <system.serviceModel>

        <!-- .... -->

        <behaviors>
           <endpointBehaviors>
              <behavior name="ImpersonationBehavior">
                 <clientCredentials>
                      <windows allowedImpersonationLevel="Impersonation" />
                 </clientCredentials>
              </behavior>
           </endpointBehaviors>
        </behaviors>
    </system.serviceModel>
</configuration> 
```

默认情况下，如果没有明确指定，则将其设置为**标识。**查看[此博客文章](http://agilior.pt/blogs/bruno.camara/archive/2008/02/19/3721.aspx)了解更多信息。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-10T15:31:36.253

如果您希望 SQL 查询作为模拟身份执行，您实际上可能需要启用对 SQL 服务器的委派。查看这篇文章了解更多信息：

[http://msdn.microsoft.com/en-us/library/ms730088.aspx](http://msdn.microsoft.com/en-us/library/ms730088.aspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-08T12:09:44.803

谢谢你们，我通过阅读以下声明下的XML解决了这个问题：

```
[OperationBehavior(Impersonation:=ImpersonationOption.Required)] 
```

它仅在我直接从 WCFService 类读取 XML 时才起作用。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-10T14:00:30.103

嗯……我不知道。但是，您可以强制 dll 尽早加载。由于您使用的是 IIS，因此这可能在您的 global.asax 中 - 创建和丢弃 TransactionScope 之类的东西应该可以完成这项工作......

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-11T14:31:18.903

玩过这个之后，最简单的 IIS 托管服务解决方案是使用具有必要权限的域用户的身份运行您的应用程序池。这在安全性方面可能存在问题，但就我们的目的而言，它已经足够好了。我们可以限制授予该用户的权限，但一切正常，无需进入 Kerberos、模拟、委托和 AD 的奥秘。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-07-01T17:31:35.307

谢谢你。在过去的一天半里，我一直在与这个战斗。这里有一些可以为我节省大量时间的东西。所以希望它会节省别人一些时间。我遇到了 SQLConnection 问题，并且使用传输安全性拒绝模拟抛出注册表访问。我什至尝试使用 transportwithmessagecredential。在 procmon 内部，我得到了“Bad Impersonation”。我的配置是 IIS 7，虚拟目录只启用了 Windows 身份验证，我禁用了内核模式身份验证。我将其设置为使用通过身份验证的基本设置。

服务配置 -

```
 <system.serviceModel>
    <serviceHostingEnvironment aspNetCompatibilityEnabled="false" />
    <services>
      <service behaviorConfiguration="SymitarService.ScheduleServiceBehavior" name="SymitarService.ScheduleService">
        <endpoint address="" binding="wsHttpBinding" bindingConfiguration="wsSecure" contract="SymitarService.IScheduleService">
          <identity>
            <dns value="localhost" />            
          </identity>
        </endpoint>
        <endpoint address="mex" binding="wsHttpBinding" bindingConfiguration="wsSecure" contract="IMetadataExchange" />
      </service>
    </services>
    <behaviors>
      <serviceBehaviors>
        <behavior name="SymitarService.UserDirectoryBehavior">
          <serviceMetadata httpGetEnabled="true" />
          <serviceDebug includeExceptionDetailInFaults="true" />
          <serviceAuthorization impersonateCallerForAllOperations="true" />
        </behavior>
        <behavior name="SymitarService.ScheduleServiceBehavior">
          <serviceMetadata httpGetEnabled="true" />
          <serviceDebug includeExceptionDetailInFaults="true" />
          <serviceAuthorization impersonateCallerForAllOperations="true" />
        </behavior>
      </serviceBehaviors>
    </behaviors>
    <bindings>
      <netTcpBinding>
        <binding name="tcpSecure" portSharingEnabled="true" />
      </netTcpBinding>
      <wsHttpBinding>
        <binding name="wsSecure" allowCookies="true">
          <security mode="Transport">
            <transport clientCredentialType="Windows" proxyCredentialType="Windows" />
            <message clientCredentialType="Windows" negotiateServiceCredential="true" />
          </security>
        </binding>
      </wsHttpBinding>
      <mexTcpBinding>
        <binding name="mexSecure" />
      </mexTcpBinding>
    </bindings>
  </system.serviceModel> 
```

和客户

```
<system.serviceModel>
    <bindings>
        <wsHttpBinding>
            <binding name="WSHttpBinding_IScheduleService" closeTimeout="01:00:00" openTimeout="01:00:00" receiveTimeout="01:00:00" sendTimeout="01:00:00" bypassProxyOnLocal="false" transactionFlow="false" hostNameComparisonMode="StrongWildcard" maxBufferPoolSize="524288" maxReceivedMessageSize="65536" useDefaultWebProxy="true" allowCookies="true">
          <readerQuotas maxDepth="32" maxStringContentLength="8192" maxArrayLength="16384" maxBytesPerRead="4096" maxNameTableCharCount="16384" />
          <reliableSession ordered="true" inactivityTimeout="00:20:00" enabled="false" />
          <security mode="Transport">
            <transport clientCredentialType="Windows" proxyCredentialType="Windows" realm="" />
            <message clientCredentialType="Windows" negotiateServiceCredential="true" establishSecurityContext="true" />
          </security>
        </binding>
      </wsHttpBinding>
    </bindings>
    <behaviors>
      <endpointBehaviors>
        <behavior name="ImpersonationBehavior">
          <clientCredentials>
            <windows allowedImpersonationLevel="Impersonation" allowNtlm="true"/>
          </clientCredentials>
        </behavior>
      </endpointBehaviors>
    </behaviors>
    <client>
      <endpoint address="https://server:444/SymitarService/ScheduleService.svc" 
                binding="wsHttpBinding" 
                bindingConfiguration="WSHttpBinding_IScheduleService" 
                contract="Symitar.ScheduleService.IScheduleService" 
                name="WSHttpBinding_IScheduleService"
                behaviorConfiguration="ImpersonationBehavior"
                >
        <identity>
          <dns value="localhost" />
        </identity>
      </endpoint>
    </client>
  </system.serviceModel> 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2015-03-30T13:27:32.247

这个解决了我的问题。

右键单击 Visual Studio（无论您使用哪个版本） 属性 选择兼容性选项卡 填写“以管理员身份运行此程序”复选框 从文件位置打开项目 运行应用程序

# c# - .NET 中“HttpRequest.RequestType”和“WebRequest.Method”值的常量在哪里？

> ID：277884
> 
> 赞同：97
> 
> 时间：2008-11-10T13:48:09.847
> 
> 标签：c#, .net, asp.net

我需要检查`RequestType`ASP.NET `HttpRequest`（或`WebRequest.Method`）中的 。我知道我可以只使用字符串值“ `POST`”或“ `GET`”作为请求类型，但我可以发誓在 .NET 的某个类中的某个地方存在一个常量，其中包含这些值。

出于好奇，我想知道是否有人知道这些字符串常量属于什么类`GET`。`POST`我试过在线搜索，但没有运气，所以我想我会在这里问。

* * *

## 回答 #1

> 赞同：127
> 
> 时间：2008-11-10T13:56:12.810

```
System.Net.WebRequestMethods.Http
    .Connect = "CONNECT"
    .Get = "GET"
    .Head = "HEAD"
    .MkCol = "MKCOL"
    .Post = "POST"
    .Put = "PUT" 
```

不过，最终；由于`const`表达式被写入调用者，这与使用“GET”等相同，只是没有拼写错误的风险。

* * *

## 回答 #2

> 赞同：56
> 
> 时间：2015-05-13T08:30:19.930

也存在[`System.Net.Http.HttpMethod`](https://docs.microsoft.com/en-us/dotnet/api/system.net.http.httpmethod)可以代替枚举的服务。您可以比较它们`aMethod == HttpMethod.Get`等。要获取字符串方法名称调用，例如`HttpMethod.Get.Method`。

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2008-11-10T14:21:36.363

在 ASP.NET MVC 中，它们位于**System.Web.Mvc.HttpVerbs**中。但是所有采用这些枚举值之一的方法也有一个文本覆盖，因为没有完整的 HTTP 动词集，只有一组当前定义的值（参见[此处](http://www.ietf.org/rfc/rfc2518.txt)和[此处](http://www.ietf.org/rfc/rfc2616.txt)以及[此处](http://www.w3.org/Protocols/rfc2616/rfc2616-sec9.html)）。

您无法创建涵盖所有动词的枚举，因为有可能添加动词，并且[枚举存在版本控制问题](http://blogs.msdn.com/brada/archive/2004/01/05/50987.aspx)，这使得这不切实际。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2019-02-23T16:43:07.373

在**ASP.NET Core中，您会在命名空间下的**[HttpMethods.cs](https://github.com/dotnet/aspnetcore/blob/v5.0.4/src/Http/Http.Abstractions/src/HttpMethods.cs)类中找到一组 http 方法字符串`Microsoft.AspNetCore.Http`。

此类还提供布尔帮助器，例如`IsGet()`or`IsPost()`以获得更好的语义。

请注意，这些字符串公开为`public static readonly string`而不是公开`constants`。

**更新 2020-05-17：** `GetCanonicalizedValue(string method)`已添加到`HttpMethods.cs`ASP.NET Core v5 中的类中，它返回与提供的字符串方法名称等效的静态实例。

# mysql - 易趣查询到mysql？

> ID：277888
> 
> 赞同：1
> 
> 时间：2008-11-10T13:48:45.290
> 
> 标签：mysql

我想知道有没有可能

从 ebay 页面中提取用户 ID 并将其作为插入语句的一部分插入到 mysql 中？否则，最好的方法是什么？

我有要导入的文件，其中包含数百个 ebay 拍卖 url，我必须从每个中获取卖家 ID。有没有比我建议的更简单的方法来做到这一点？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-10T13:59:40.153

您可以为此使用[eBay API](http://developer.ebay.com/common/api/)。每个页面的 URL 都包含一个商品编号，可用于在 eBay 中查询卖家 ID。

[eBay Hacks Item 109](http://books.google.com/books?id=bIMY8x-dpTMC&pg=PA391&lpg=PA391&dq=ebay+api+get+seller+id&source=web&ots=cv3mDqGq5w&sig=1l-5j7hXytPEZl-rDebdcQKKPrk&hl=en&sa=X&oi=book_result&resnum=9&ct=result)提供了一些 PHP 示例代码来满足您的需求（以及更多）。

# asp.net - 如何/在哪里学习在 ASP.NET 2.0+ 与 Winforms (VB.NET) 中布局 Webforms？

> ID：277891
> 
> 赞同：2
> 
> 时间：2008-11-10T13:49:53.527
> 
> 标签：asp.net

当我遇到一些迁移问题时，在这里寻找一些方向。

我们有一个遗留应用程序。“基础设施”运行良好。用 VB 编写的业务逻辑和数据访问层调用数据库的 SQL Server。

我有很多编写 Winforms（桌面）应用程序的经验并且没有遇到任何问题。但是，我最后一次编写任何 ASP.NET 内容是在 1.1（VS.NET 2003）中。

除此之外，对于 ASP.NET 2.0 及更高版本，网格布局已不复存在。这不仅仅是在表单上放置控件、对齐它们、排序它们并不再使用代码隐藏的简单案例。

新的基于 Web 的应用程序开始时非常简单。只是一个常见的页眉（已经为此制作了一个用户控件）和页脚，中间有典型的 CRUD 函数。

我尝试“直观”地使用带有内容占位符的母版页，但我无法让占位符“增长”，更不用说无法将文本框放在我想要的位置。哦，我在 VS2008 中找到了允许绝对定位的选项，但它只适用于某些控件——其他控件我必须手动编辑 asp 标签。

然后我看到了使用 div 的示例并尝试实现它们，但我最终得到的结果是对象相互重叠。在线帮助至少可以说没有帮助。

有谁知道一本可以提供我正在寻找的基础知识的好书、网站或教程？在实践中，我希望制作一些简单的页面，其中一些对象可能不得不将其他对象推到 y 轴上（例如，正在做出几条评论，该部分会将列出“附件”的部分进一步向下推）。当涉及到这个应用程序的所有其他方面时，我没有任何问题。看来我的网络表单技能已经过时了大约 3-4 年。

这不会是一些花哨的 flash/silverlight 应用程序——只是简单的“数据维护”，以摆脱一些丑陋且容易出错的过程，包括读取普通邮箱和解码 Word 文件。新目标是拥有一个带有适当验证的漂亮 weborm。

我想我正在寻找的是“面向 Winforms 程序员的 Webforms”一书或网站。

帮助！

提前致谢。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-10T15:10:50.757

我听到的关于学习使用 html/css 布局的最佳建议是这样的：

在构建新页面时，不要试图把所有的幻想都放在前面。首先构建一个非常基本的纯文本页面。它应该看起来像 1996 年的东西——那个短暂的时期，每个人都刚刚发现了网络，但还没有开始使用`table`标签进行布局——只有没有漫画无字体。此时不要使用图像，除非图像确实是所传达信息的一部分（而不是装饰门面以使其看起来更漂亮：您可以稍后添加它们）。`h1`页面顶部可能会有一个，并给每个子标题一个适当的`hN`，但此时页面中根本不应该有任何布局信息。您将拥有的唯一地方`table`标签是如果你真的有表格数据要显示。如果它可以帮助您编写此代码，那么您现在可以将所有内容包装在老式`<center>`标签中 - 只是不要忘记稍后删除它们。

现在让我们开始稍微调整一下标记。使用`ul`（无序列表）之类的东西作为您的导航链接*列表*`label`和/`legend`来识别和分组您的表单区域。这里的一般想法是让页面上的每个元素都包含在最合适的 html 标记中，并使用完整的可用标记集——每个标记都有其指定的用途。

此时，您的页面非常适合屏幕阅读器或搜索引擎。通过首先构建此页面，您可以轻松实现 SEO 和可访问性合规性。当然，这些不是唯一的要求，所以我们还没有完成。

现在您需要从布局*和*逻辑角度识别页面的不同部分。页面应该在很大程度上已经在逻辑上进行了划分，但是您可能会发现一些普通标签无法剪切的地方。出于布局原因，您还需要对某些元素进行分组。用标签将这些区域中的每一个都包裹起来`div`，并给标签一个类名，该类名指的是标签的用途：您正在创建的组。这只是将 a 标签（“division”标签）用于其预期目的的另一种情况。此外，由于元素可以有多个类，因此您可能还需要考虑对类进行逻辑分组。例如，您可能希望有一个单独的类将站点模板与页面的其余部分区分开来。

总的来说，这不应该改变页面的外观，但是现在您应该很容易开始添加样式。此时，您现在可以开始添加图像和布局。但是，这里的目标是尽可能少地更改实际标记。如果您可以管理它，只需添加 id 和类，尽管您可能需要添加之前没有识别的额外 span 或 div，有时您需要额外的块级元素来强制跨浏览器进行兼容布局。

如果事情做得正确，结果是一个页面不仅看起来不错，而且在跨浏览器测试时也更容易使用，当不支持样式或 javascript 功能时自然会很好地降级，并且在 SEO 和可访问性。这也使开发人员更容易构建一个提供一定级别功能的简单页面，他们可以将其传递给单独的设计人员以使其看起来更好。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-10T14:02:25.233

您可能还想查看[A List Apart。](http://www.alistapart.com/) 这是一个很棒的网站，其中包含许多“技巧”，用于使用 CSS 在 Web 上布局内容以及许多其他面向 Web 的内容。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-10T15:14:03.480

网格定位对网站来说是一种厌恶。当然，它可以让那些熟悉 WinForms 设计器的人轻松过渡，但它产生了几乎无法维护的可怕 HTML。

我可以向您推荐的最好的资源是[CSS Mastery](http://cssmastery.com)。您需要学习 HTML 和 CSS，但它们很容易上手。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-10T13:55:54.840

听上去，您正在寻找 HTML 速成课程？

ASP.NET aspx 页面和 ascx 控件的“设计画布”只是 HTML 标记标记。

如果您没有网页设计经验，我建议您从类似的地方开始

[W3学校](http://www.w3schools.com/html/default.asp)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-10T13:58:38.827

当微软给我们 ASP.NET 时，他们试图让编程网站更像是编写富客户端应用程序。但是，在为 Web 开发时，您必须处理很多问题，其中最主要的问题是无国籍状态，而在开发胖客户端应用程序 (WinForms) 时则不存在这些问题。所以第一步是无论如何不要认为两者相似。

拖放工具很不错，但您真正需要了解的是 HTML 和客户端服务器模型。HTML 将帮助您了解事物是如何布局的，而客户端服务器模型对于了解数据如何从 Web 到服务器以及从 Web 获取非常重要。如果您是在 ASP.NET 1.1 中开发的，那么 2.0 的情况确实没有改变。概念是相同的，只是提供的一些控件发生了变化。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-10T14:01:04.657

很多人对 1.1 中基于网格的布局非常不满意，因为它在很多情况下都不起作用。它仍然必须最终呈现为 html，而 html 只是不适合这种布局。例如，对于移动浏览器（iPhone 等），可能无法正确订购或从屏幕上推出东西。还有诸如盲人屏幕阅读器之类的东西。如果您为政府工作，那么第二项是法律要求，而不仅仅是一个不错的选择，并且有很多开发人员为政府工作。

所以 ASP.Net 2.0 试图生成对 html 至少更好一点的标记。缺点是您现在实际上必须了解 html 布局。但是，来吧：你正在建立一个网站。如果你不能处理一点 html，你就真的有麻烦了。

我的建议是使用 Visual Studio 以外的东西构建一个静态页面。在该页面上使用`<input`标签而不是服务器控件，并且实际上不实现任何逻辑。使用它来了解您的布局需要如何工作。一旦你把它弄下来，就很容易在 Visual Studio 中为你的页面复制它。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-10T16:12:04.580

*这并不真正属于单独的答案，但我不确定您是否会看到我上面的回复的另一条评论。*

* * *

所有块级元素（包括 div）的正常行为是每个新元素出现在前一个元素的下方。听起来您已经设置`position:absolute;`了所有内容，也许是在使用 Visual Studio 中基于网格的布局选项时。不要那样做——它劫持了预期的行为，这就是为什么你会看到所有东西都堆积在一起。

# php - strtolower 将会话传递给变量，这合法吗？

> ID：277899
> 
> 赞同：0
> 
> 时间：2008-11-10T13:53:49.603
> 
> 标签：php

这样做可以吗？

```
$author = strtolower($_SESSION['valid_username']); 
```

我想将所有作者以小写形式输入表中。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-10T13:57:47.643

是的，只要`$_SESSION['valid_username']`设置好就可以，否则您会收到通知（如果您的错误报告设置得那么低）。

您可以检查它是否存在`if (isset($_SESSION['valid_username']))`

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-10T13:57:49.750

是的。

```
$_SESSION['valid_username'] 
```

是一个会话变量，其计算结果为字符串，因此将其作为参数传递给 strtolower 函数不是问题。

# sql - 如何并行运行 sql server 存储过程？

> ID：277900
> 
> 赞同：8
> 
> 时间：2008-11-10T13:53:53.410
> 
> 标签：sql, sql-server, tsql, parallel-processing, dts

我想做类似的事情：

```
exec sproc1 and sproc2 at the same time
when they are both finished exec sproc3 
```

我可以在 dts 中做到这一点。有没有办法在事务 sql 中做到这一点？或者有没有办法用批处理脚本（例如vbs或powershell）来做到这一点？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-10T14:20:34.027

您可以创建一个 CLR 存储过程，它（使用 C#）将在自己的线程上调用前两个，然后阻塞直到两个都完成......然后运行第三个。

您可以在您的情况下使用 CLR 存储过程吗？如果是这样，我将编辑此答案以获取更多详细信息。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-10T01:28:51.613

sp_开始_工作

我现在正在做类似的事情，我发现避免使用 SSIS 或某些外部 shell 的唯一方法是将我的加载例程手动拆分为“线程”，然后触发一个主 sqlagent 作业，这反过来执行与我有线程一样多的 sp_start_job。从那时起，它们都自主运行。

这不完全是我们正在寻找的，但结果是一样的。如果您测试子作业的作业状态，您也可以实现 sproc 3 的条件启动。

如果我们不能一次全部使用 8 个核心，那又有什么意义呢？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-10T17:20:05.067

您绝对需要两个 SP 并行执行吗？

通过单个 SP 中的简单 CRUD 语句，我发现 SQL S. 在确定哪些可以并行运行并这样做方面做得非常好。我从来没有见过 SQL S。如果两个 SP 都是从 T-SQL 语句中按顺序调用的，那么并行运行 2 个 SP，甚至不知道它是否可能。

那么，DTS 真的并行执行它们吗？可能是它只是按顺序执行它们，然后在最后一个成功完成后调用第三个 SP。

如果它真的并行运行它们，可能你应该坚持使用 DTS，但是我想知道如果我有一个 DTS 包调用，比如说，10 个重型 SP 并行......我可能不得不做一些测试来了解自己：D

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-23T18:24:24.503

您可以使用 SSIS。这样做的好处是包可以存储在 SQL Server 中，并且可以轻松地在那里进行调度。

从 PowerShell 或几乎任何外部脚本语言，您可以使用 SQL 命令行 osql 或 sqlcmd。这种技术也可以通过使用 xp_cmdshell 来在 SQL Server 上调度它。

# asp.net - 在 ASP.NET 中，将 PDF 文件转换为 HTML 的最佳方法是什么？

> ID：277901
> 
> 赞同：1
> 
> 时间：2008-11-10T13:54:26.543
> 
> 标签：asp.net, html, pdf, pdf-to-html

我的用户要做的是在他们的机器上选择一个 PDF 文档，将其上传到我的网站，在那里我将转换为 HTML 文档以在网站上显示。该文件将在转换后存储在数据库中。

将 PDF 转换为 HTML 的最佳方法是什么？

我收到了一个要求，用户将创建一个 pdf 格式的“新闻”故事，然后将其上传到服务器，在那里它将转换为 HTML 并显示在网站上。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-10T14:52:38.797

任何可以将文档保存为 PDF 的文档创建软件都可以将它们保存为 HTML。我假设问题是您的用户将创建丰富的文档（大量嵌入图像），这会导致多个文件，而您的要求源于希望尽可能简单地将这些文档上传给用户。

有许多转换包可能可以为您做到这一点，但是当您谈论丰富的内容时，您谈论的是文本加图像。这些图像必须存储在某个地方并以某种方式提供服务，无论您使用什么转换方法都需要您检查所有图像源以确保它们指向您服务器上的有效位置。

我想向您的团队推荐一种替代方法：实现众多博客 API 中的一个来发布内容。有免费和商业软件包使用这些 API 将内容直接发布到网站，例如 Windows Live Writer 和 Microsoft Word。您的用户可以简单地创建他们的内容并将其直接上传到您的网站，而无需先将其发布为 PDF，然后再上传。因此，对于您的用户而言，该过程变得更加顺畅，并且您以不需要花费数千美元开发或购买转换代码的形式获得帖子。

两个最常见的 API 是[MetaWeblog API](http://www.xmlrpc.com/metaWeblogApi)和[Movable Type API](http://www.sixapart.com/developers/xmlrpc/movable_type_api/)。两者都非常简单且易于实现。我认为这种方式比您正在考虑的方式要好得多。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-10T14:00:43.537

我认为将 PDF 转换为 HTML 字符串不一定是最好的主意，尤其是如果您想将其导出为 PDF。PDF 文件通常包含图像等二进制元素，因此您最好通过 Base64 等编码将其转换为 ASCII。这样，您将拥有一个 ASCII 字符串，您可以将其保存到数据库中的文本字段中，然后将其转换回来。您能否进一步扩展主要要求？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-10T14:17:39.820

如果可能的话，我的建议是不要这样做（但我们都知道经理是什么样的）所以......

我建议您不要将 PDF 转换为 HTML 或从 HTML 转换（因为除非您能找到商业解决方案，否则它几乎是不可能的），而是按照已经提到的方式将其存储为编码的 Base64 字符串或 BLOB或数据库中的其他二进制格式，然后使用浏览器的某种 PDF 视图插件将其显示给用户。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-10T14:19:37.570

所需要的只是一个简单的谷歌搜索“PDF to HTML”： [http](http://www.gnostice.com/pdf2manyOverview_x.asp) ://www.gnostice.com/pdf2manyOverview_x.asp 。我确定还有其他人。

因此，虽然它是“可能的”，但您可能想向您的经理解释这不是最好的内容管理解决方案。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-10T14:23:24.393

为什么不使用[iTextSharp](http://itextsharp.sourceforge.net/)阅读 PDF 内容？然后您可以将二进制 PDF 和文本内容保存到数据库中。然后，您可以让用户搜索内容并下载 PDF。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-10T17:06:58.620

您应该查看 DynamicPDF。他们有一个转换器（目前是 Beta 版）来服务于这个目的。我们在使用他们的产品方面取得了巨大成功（尤其是将 Reporting Services 报告直接转储为 PDF）。

参考： [http ://www.dynamicpdf.com/](http://www.dynamicpdf.com/)

# php - 如何让 PHPUnit MockObjects 根据参数返回不同的值？

> ID：277914
> 
> 赞同：154
> 
> 时间：2008-11-10T13:58:37.987
> 
> 标签：php, unit-testing, mocking, phpunit

我有一个 PHPUnit 模拟对象，`'return value'`无论它的参数是什么，它都会返回：

```
// From inside a test...
$mock = $this->getMock('myObject', 'methodToMock');
$mock->expects($this->any))
     ->method('methodToMock')
     ->will($this->returnValue('return value')); 
```

我想要做的是根据传递给模拟方法的参数返回一个不同的值。我试过类似的东西：

```
$mock = $this->getMock('myObject', 'methodToMock');

// methodToMock('one')
$mock->expects($this->any))
     ->method('methodToMock')
     ->with($this->equalTo('one'))
     ->will($this->returnValue('method called with argument "one"'));

// methodToMock('two')
$mock->expects($this->any))
     ->method('methodToMock')
     ->with($this->equalTo('two'))
     ->will($this->returnValue('method called with argument "two"')); 
```

但是，如果没有使用参数调用模拟，这会导致 PHPUnit 抱怨`'two'`，所以我假设 的定义`methodToMock('two')`覆盖了第一个的定义。

所以我的问题是：有没有办法让 PHPUnit 模拟对象根据其参数返回不同的值？如果是这样，怎么办？

* * *

## 回答 #1

> 赞同：134
> 
> 时间：2008-11-15T11:13:17.827

使用回调。例如（直接来自 PHPUnit 文档）：

```
<?php
class StubTest extends PHPUnit_Framework_TestCase
{
    public function testReturnCallbackStub()
    {
        $stub = $this->getMock(
          'SomeClass', array('doSomething')
        );

        $stub->expects($this->any())
             ->method('doSomething')
             ->will($this->returnCallback('callback'));

        // $stub->doSomething() returns callback(...)
    }
}

function callback() {
    $args = func_get_args();
    // ...
}
?> 
```

在 callback() 中执行您想要的任何处理，并根据您的 $args 返回结果。

* * *

## 回答 #2

> 赞同：125
> 
> 时间：2012-07-31T09:27:47.723

来自最新的 phpUnit 文档：“有时，存根方法应根据预定义的参数列表返回不同的值。您可以使用[returnValueMap()](https://phpunit.de/manual/current/en/test-doubles.html#test-doubles.stubs.examples.StubTest5.php)创建将参数与相应返回值相关联的映射。”

```
$mock->expects($this->any())
    ->method('getConfigValue')
    ->will(
        $this->returnValueMap(
            array(
                array('firstparam', 'secondparam', 'retval'),
                array('modes', 'foo', array('Array', 'of', 'modes'))
            )
        )
    ); 
```

* * *

## 回答 #3

> 赞同：54
> 
> 时间：2010-01-13T08:53:34.943

我有一个类似的问题（虽然略有不同......我不需要基于参数的不同返回值，但必须测试以确保将 2 组参数传递给同一个函数）。我偶然发现使用这样的东西：

```
$mock = $this->getMock();
$mock->expects($this->at(0))
    ->method('foo')
    ->with(...)
    ->will($this->returnValue(...));

$mock->expects($this->at(1))
    ->method('foo')
    ->with(...)
    ->will($this->returnValue(...)); 
```

它并不完美，因为它要求 2 次调用 foo() 的顺序是已知的，但实际上这可能还*不错*。

* * *

## 回答 #4

> 赞同：30
> 
> 时间：2011-01-12T00:01:45.323

您可能希望以 OOP 方式进行回调：

```
<?php
class StubTest extends PHPUnit_Framework_TestCase
{
    public function testReturnAction()
    {
        $object = $this->getMock('class_name', array('method_to_mock'));
        $object->expects($this->any())
            ->method('method_to_mock')
            ->will($this->returnCallback(array($this, 'returnTestDataCallback')));

        $object->returnAction('param1');
        // assert what param1 should return here

        $object->returnAction('param2');
        // assert what param2 should return here
    }

    public function returnTestDataCallback()
    {
        $args = func_get_args();

        // process $args[0] here and return the data you want to mock
        return 'The parameter was ' . $args[0];
    }
}
?> 
```

* * *

## 回答 #5

> 赞同：21
> 
> 时间：2014-03-19T10:51:41.010

这并不完全符合您的要求，但在某些情况下它可以提供帮助：

```
$mock->expects( $this->any() ) )
 ->method( 'methodToMock' )
 ->will( $this->onConsecutiveCalls( 'one', 'two' ) ); 
```

[onConsecutiveCalls](http://phpunit.de/manual/3.7/en/test-doubles.html#test-doubles.stubs.examples.StubTest7.php) - 按指定顺序返回值列表

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2017-04-04T13:02:44.307

传递两级数组，其中每个元素是一个数组：

*   首先是方法参数，最后是返回值。

例子：

```
->willReturnMap([
    ['firstArg', 'secondArg', 'returnValue']
]) 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2013-08-06T08:59:43.217

您还可以按如下方式返回参数：

```
$stub = $this->getMock(
  'SomeClass', array('doSomething')
);

$stub->expects($this->any())
     ->method('doSomething')
     ->will($this->returnArgument(0)); 
```

[正如您在Mocking 文档](https://phpunit.de/manual/current/en/test-doubles.html)中所见，该方法`returnValue($index)`允许返回给定的参数。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-10T14:25:19.337

你的意思是这样的吗？

```
public function TestSomeCondition($condition){
  $mockObj = $this->getMockObject();
  $mockObj->setReturnValue('yourMethod',$condition);
} 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-10T15:13:04.950

我有一个类似的问题，我也无法解决（关于 PHPUnit 的信息非常少）。就我而言，我只是将每个测试单独测试 - 已知输入和已知输出。我意识到我不需要制作一个万事通的模拟对象，我只需要一个用于特定测试的特定对象，因此我将测试分开，并且可以单独测试我的代码的各个方面单元。我不确定这是否适用于您，但这取决于您需要测试的内容。

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2017-05-09T15:13:50.130

```
$this->BusinessMock = $this->createMock('AppBundle\Entity\Business');

    public function testBusiness()
    {
        /*
            onConcecutiveCalls : Whether you want that the Stub returns differents values when it will be called .
        */
        $this->BusinessMock ->method('getEmployees')
                                ->will($this->onConsecutiveCalls(
                                            $this->returnArgument(0),
                                            $this->returnValue('employee')                                      
                                            )
                                      );
        // first call

        $this->assertInstanceOf( //$this->returnArgument(0),
                'argument',
                $this->BusinessMock->getEmployees()
                );
       // second call

        $this->assertEquals('employee',$this->BusinessMock->getEmployees()) 
      //$this->returnValue('employee'),

    } 
```

* * *

## 回答 #11

> 赞同：-2
> 
> 时间：2009-10-03T21:26:30.617

尝试 ：

```
->with($this->equalTo('one'),$this->equalTo('two))->will($this->returnValue('return value')); 
```

# python - Python 参数绑定器

> ID：277922
> 
> 赞同：72
> 
> 时间：2008-11-10T14:01:22.113
> 
> 标签：python, partial-application

如何将参数绑定到 Python 方法以存储空函子以供以后调用？类似于 C++ 的`boost::bind`.

例如：

```
def add(x, y):
    return x + y

add_5 = magic_function(add, 5)
assert add_5(3) == 8 
```

* * *

## 回答 #1

> 赞同：87
> 
> 时间：2008-11-10T14:06:47.703

[`functools.partial`](http://docs.python.org/2/library/functools.html#functools.partial "Python 2 文档：functools 模块：部分函数")返回一个可调用的包装函数，其中部分或全部参数被冻结。

```
import sys
import functools

print_hello = functools.partial(sys.stdout.write, "Hello world\n")

print_hello() 
```

```
Hello world 
```

上面的用法等价于下面的`lambda`。

```
print_hello = lambda *a, **kw: sys.stdout.write("Hello world\n", *a, **kw) 
```

* * *

## 回答 #2

> 赞同：67
> 
> 时间：2008-11-10T14:07:14.707

我对 boost::bind 并不太熟悉，但`partial`函数 from`functools`可能是一个好的开始：

```
>>> from functools import partial

>>> def f(a, b):
...     return a+b

>>> p = partial(f, 1, 2)
>>> p()
3

>>> p2 = partial(f, 1)
>>> p2(7)
8 
```

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-11-10T15:50:43.703

如果`functools.partial`不可用，则可以轻松模拟：

```
>>> make_printer = lambda s: lambda: sys.stdout.write("%s\n" % s)
>>> import sys
>>> print_hello = make_printer("hello")
>>> print_hello()
hello 
```

或者

```
def partial(func, *args, **kwargs):
    def f(*args_rest, **kwargs_rest):
        kw = kwargs.copy()
        kw.update(kwargs_rest)
        return func(*(args + args_rest), **kw) 
    return f

def f(a, b):
    return a + b

p = partial(f, 1, 2)
print p() # -> 3

p2 = partial(f, 1)
print p2(7) # -> 8

d = dict(a=2, b=3)
p3 = partial(f, **d)
print p3(), p3(a=3), p3() # -> 5 6 5 
```

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2013-02-21T13:37:49.993

lambdas 允许您使用更少的参数创建一个新的未命名函数并调用该函数！

```
>>> def foobar(x,y,z):
...     print "%d, %d, %d" % (x,y,z)
>>> foobar(1,2,3) # call normal function

>>> bind = lambda x: foobar(x, 10, 20) # bind 10 and 20 to foobar
>>> bind(1) # print 1, 10, 20

>>> bind = lambda: foobar(1,2,3) # bind all elements  
>>> bind()  # print 1, 2, 3 
```

### 编辑

[https://docs.python.org/2/library/functools.html#functools.partial](https://docs.python.org/2/library/functools.html#functools.partial)

如果您打算在函数调用中使用命名参数绑定，这也适用：

```
>>> from functools import partial
>>> barfoo = partial(foobar, x=10)
>>> barfoo(y=5,z=6)
21 
```

请注意，如果从左侧绑定参数，则需要按名称调用参数。如果您从右侧绑定，它将按预期工作。

```
>>> barfoo(5,6) 
Traceback (most recent call last):
File "<stdin>", line 1, in <module>
TypeError: foobar() got multiple values for keyword argument 'x'
>>> f = partial(foobar, z=20)
>>> f(1,1)
22 
```

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2008-11-11T03:03:27.370

这也可以：

```
def curry(func, *args):
    def curried(*innerargs):
       return func(*(args+innerargs))
    curried.__name__ = "%s(%s, ...)" % (func.__name__, ", ".join(map(str, args)))
    return curried

>>> w=curry(sys.stdout.write, "Hey there")
>>> w()
Hey there 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-10T14:57:19.397

函子可以在 Python 中以这种方式定义。它们是可调用的对象。“绑定”仅设置参数值。

```
class SomeFunctor( object ):
    def __init__( self, arg1, arg2=None ):
        self.arg1= arg1
        self.arg2= arg2
    def __call___( self, arg1=None, arg2=None ):
        a1= arg1 or self.arg1
        a2= arg2 or self.arg2
        # do something
        return 
```

你可以做类似的事情

```
x= SomeFunctor( 3.456 )
x( arg2=123 )

y= SomeFunctor( 3.456, 123 )
y() 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2020-07-29T19:32:29.777

该问题通常询问绑定参数，但所有答案都与函数有关。如果您想知道，`partial`也可以使用类构造函数（即使用类而不是函数作为第一个参数），这对于工厂类很有用。你可以这样做：

```
from functools import partial

class Animal(object):
    def __init__(self, weight, num_legs):
        self.weight = weight
        self.num_legs = num_legs

animal_class = partial(Animal, weight=12)
snake = animal_class(num_legs = 0)
print(snake.weight) # prints 12 
```

# unit-testing - 运行时间最长的单元测试？

> ID：277923
> 
> 赞同：9
> 
> 时间：2008-11-10T14:01:26.903
> 
> 标签：unit-testing, junit

我们如何在我们的套件中找到运行时间最长的 junit 测试？junitreport ant 任务的默认输出很有帮助，但是我们的套件将数千个测试组织成许多较小的套件，因此它变得乏味，而且最严重的违规者总是在变化。

我们使用 luntbuild，但理想情况下，我们可以从 ant 中运行它。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-11T08:42:04.537

JUnitReport 处理由 JUnit 任务生成的 xml 文件。您可以编写一个任务，从相同的 xml 文件 (TEST-*.xml) 中读取测试持续时间。但是您也可以采取捷径，只需阅读由 JUnitReport (TESTS-TestSuites.xml) 创建的摘要文件，其中包含单个文件中的所有信息。

一个快速的方法是使用一些 xsl 来显示最慢的测试：

```
<?xml version="1.0"?>
<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
  <xsl:output method="text"/>

  <xsl:template match="/">
    <xsl:text>    </xsl:text>
    <xsl:for-each select="testsuites/testsuite">
    <xsl:sort select="@time" data-type="number" order="descending" />
      <xsl:value-of select="@name"/> : <xsl:value-of select="@time"/>
      <xsl:text>
  </xsl:text>
    </xsl:for-each>
  </xsl:template>
</xsl:stylesheet> 
```

要从 Ant 运行，请执行以下操作：

```
<target name="show.slow.tests">
    <xslt in="target/tests-results/TESTS-TestSuites.xml" out="target/slow.txt" style="slow.xsl"/>
</target> 
```

然后你可以只看前 X 行来找到 X 最慢的测试：

jfredrick$ 头目标/slow.txt

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-10T14:13:10.703

使用[团队城市](http://www.jetbrains.com/teamcity/)。他们有很好的报告，4.0 版甚至可以为您的测试排序，因此最不稳定的测试首先运行。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-10T14:19:33.903

如果您使用巡航控制在构建服务器上启动测试，它是按运行时间排序的顶级选项之一。

# javascript - 如何使用 Prototype 禁用 Mozilla 中某些元素的默认上下文菜单？

> ID：277924
> 
> 赞同：3
> 
> 时间：2008-11-10T14:01:36.827
> 
> 标签：javascript, prototypejs, contextmenu

我正在尝试在某些元素（特别是标签）上扩展上下文菜单的导航选项，`h1`我`h2`想在右键单击这些元素时阻止浏览器的默认操作。

[我在这个页面上](http://ajaxcookbook.org/disable-browser-context-menu/)找到了很好的信息。

但是，我找不到如何禁用某些元素的上下文菜单。有人知道该怎么做吗？

我使用原型作为我的 javascript API。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-10T14:11:38.367

这将防止上下文菜单出现在特定元素上

```
$(it).observe("contextmenu", function(e){
    e.stop();
}); 
```

因此，例如停止所有 H1/H2 标签显示上下文菜单

```
$$('h1, h2').each(function(it){
    $(it).observe("contextmenu", function(e){
        e.stop();
    });
}) 
```

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2008-11-10T14:12:16.757

您可以稍微混淆一下，但最终您的页面只是浏览器中的访客（如果您愿意，您可以将其理解为囚犯是国家的“访客”）。因此页面必须依靠浏览器才能玩得好。如果用户想要运行一个不能很好玩的浏览器，或者定制他们现有的浏览器来这样做，那总是他们的选择。你**永远不能** *强迫*浏览器做任何事情。 *没有*一旦用户在本地计算机上查看页面，如果他们真的愿意，您可以阻止用户使用浏览器执行给定的活动。不仅如此，最新的浏览器已经内置了一些功能，使用户可以很容易地在出现异常时覆盖正常行为。

# asp.net - asp.net 应用程序的物理内存过多？

> ID：277925
> 
> 赞同：2
> 
> 时间：2008-11-10T14:02:16.450
> 
> 标签：asp.net, memory, memory-leaks

我基于 LLBLGen 的大型 32 位 Web 服务数据访问应用程序单独运行在专用的 64 位机器上。当进程释放几乎所有分配的空间（高达 1.5GB）时，它的物理内存消耗稳步增长到大约 2GB，并从那时起继续增长。页面输入值或其他页面文件使用参数没有明显增加，因此看起来内存被释放而不是被换出到页面文件。我在想这是什么类型的个人资料？没有什么可以真正阻止进程获取它可以获取的所有内存，另一方面，内存释放存在不可接受的 http 内部错误 - 可能是清理块有用的工作。什么是使清理不那么突兀的好策略，

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-10T16:01:27.067

听起来您有内存泄漏，该进程一直在泄漏内存，直到它因内存不足而崩溃，然后由服务器自动重新启动。

1.5GB 大约是 32 位进程在地址空间用完之前可以分配的最大内存量。

要寻找的东西：

*   你自己做缓存吗？什么时候从缓存中删除项目？
*   是否有某个地方每隔一段时间就会将数据添加到集合中但从未删除？
*   您是否在每个实现 IDisposable 的对象上调用 Dispose？
*   您是否访问任何非托管代码（COM 对象或使用 DllImport）或分配非托管内存（例如使用 Marshal 类）？垃圾收集器永远不会释放在那里分配的任何东西，您必须自己释放它。
*   您是否使用第 3 方库或来自第 3 方的任何代码？它也可能存在列表中的任何问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-10T14:59:53.323

您是否有可能不处理各种一次性物品（特别是与数据库相关的）。这将使它们离开，可能会占用大量非托管资源，直到 GC 运行并调用它们的终结器。

值得对您的进程运行 perfmon 并查看某些关键资源（如句柄）是否稳定增长，或者您的数据库提供程序是否公开了性能计数器，然后是连接或打开的结果集。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-10T15:01:00.683

我同意 edg 回答的第一部分，但他说：

> “通过在对象死亡时将对象设置为 null，您可以鼓励 GC 重用这些对象消耗的内存，这限制了内存消耗的增长。”

是不正确的。您永远不需要将对象设置为 null，因为 GC 最终会在超出范围后收集您的对象。

在这个答案中对此进行了讨论：[在 .NET 中使用后将对象设置为 Null/Nothing](https://stackoverflow.com/questions/2785/setting-objects-to-nullnothing-after-use-in-dot-net)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-10T15:14:25.320

不要使用 Arraylists（垃圾收集对它们不起作用），而是使用通用列表

其他常见错误是在 web.config 中 Debug=true，这会消耗大量内存，请将选项更改为“false”。

其他要做的事情是使用 CLRProfiler 来跟踪问题。

祝你好运，佩德罗

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-10T14:39:33.050

垃圾收集器在释放对象时不会自动释放内存，它会保留该内存以帮助最大限度地减少未来 malloc 的开销。

当触发内存不足的情况时，内存将返回给操作系统，并且在查看任务管理器时您将看到更多可用内存。这通常会发生在 2GB 标记或 3GB 如果您使用[相关开关](http://technet.microsoft.com/en-us/library/bb124810.aspx)。

`<contentious>`

通过在对象死亡时将它们设置为 null，您可以鼓励 GC 重用这些对象消耗的内存，这限制了不断增长的内存消耗。

但是您应该将哪些对象设置为空？大对象、大集合、频繁创建的对象。

`</contentious>`

**编辑**：有证据支持将对象设置为 null 的值。有关详细信息，请参阅[此](http://weblogs.asp.net/pwilson/archive/2004/02/14/73033.aspx)。当然**不需要**将对象设置为null，关键是它对内存管理有什么帮助吗？

**编辑**：如果存在这样的事情而不是继续发表意见，我们需要一个最近的基准。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-10T16:55:30.717

My first guess would be a memory leak. My second guess would be that it is normal behavior - the GC won't be fired until you have significant memory pressure. The only way to be sure is to use a combination of a profiler and things like PerfMon. Some sites:

*   [http://blogs.msdn.com/ricom/archive/2004/12/10/279612.aspx](http://blogs.msdn.com/ricom/archive/2004/12/10/279612.aspx)
*   [http://support.microsoft.com/kb/318263](http://support.microsoft.com/kb/318263)
*   [Tess's excellent lab series](http://blogs.msdn.com/tess/pages/net-debugging-demos-information-and-setup-instructions.aspx)

In addition I would make sure you aren't running in Debug mode (as already mentioned).

As far as the HTTP errors - assuming you are running in server GC mode, it tries to do everything it can to not block requests. It would be interesting to find out what those HTTP errors are - that's not normal behavior from what I've seen in the past, and might point to some more of the root of your issue.

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-10T16:22:57.303

确保您没有建立项目的调试版本。有一个特性*，当您进行调试构建时，如果您实例化任何包含事件定义的对象，即使您不引发事件，它也只会无限期地保留一小块内存。随着时间的推移，这些小块内存会吞噬你的内存池，直到它最终重新启动 Web 进程并重新开始。

*我将此称为功能（而不是错误），因为它从 .Net 2 开始就存在（在 .Net 1.1 中不存在），并且没有修复它的补丁。内存泄漏一定是由于调试时需要的某些功能。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-10T16:25:55.067

我们遇到了类似的情况，并更改了我们所有的数据库连接以使用 try/catch/finally 方法。Try 用于执行代码，捕获错误收集，最后关闭所有变量和数据库连接。

```
internal BECollection<ReportEntity> GetSomeReport()
    {
        Database db = DatabaseFactory.CreateDatabase();
        BECollection<ReportEntity> _ind = new BECollection<ReportEntity>();
        System.Data.Common.DbCommand dbc = db.GetStoredProcCommand("storedprocedure");

        try
        {
            SqlDataReader reader = (SqlDataReader)db.ExecuteReader(dbc);
            while (reader.Read())
            {
                //populate entity
            }
        }
        catch (Exception ex)
        {
            Logging.LogMe(ex.Message.ToString(), "Error on SomeLayer/SomeReport", 1, 1);
            return null;
        }
        finally
        {
            dbc.Connection.Close();
            _ind = null;
        }
        return _ind;
    } 
```

# active-directory - Active Directory 中的 userPrincipalName 是否有最大长度？

> ID：277926
> 
> 赞同：6
> 
> 时间：2008-11-10T14:02:17.260
> 
> 标签：active-directory

我正在编写一个链接到 Active Directory 的应用程序，我需要将 userPrincipalName 存储在数据库表中，但我不知道该字段需要多大。

[在 MSDN 上](http://msdn.microsoft.com/en-us/library/ms680857(VS.85).aspx)，没有给出长度，在[RFC 822](http://www.faqs.org/rfcs/rfc822.html)中也没有。现在，在我恢复到具有定义长度（[sAMAccountName](http://msdn.microsoft.com/en-us/library/ms679635(VS.85).aspx)小于 20 个字符，NETBIOS 域名最大为 15 个字符）的 DOMAIN\Username 之前，我想知道是否有人知道标准或实现的限制是什么在 Windows 2003 和 Windows 2008 域中。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-27T06:54:26.237

在 Win2k3 SP2 上，它允许我创建的最长 userPrincipleName 是 1013 个字符。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2020-11-16T23:03:50.223

今天在尝试为自己回答这个问题时，我偶然发现了一个记录在案的答案。

[2.381 属性 userPrincipalName](https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-adls/63f5e067-d1b3-4e6e-9e53-a92953b6005b)按以下方式定义 userPrincipalName：

```
 cn: User-Principal-Name
 ldapDisplayName: userPrincipalName
 attributeId: 1.2.840.113556.1.4.656
 attributeSyntax: 2.5.5.12
 omSyntax: 64
 isSingleValued: TRUE
 schemaIdGuid: 28630ebb-41d5-11d1-a9c1-0000f80367c1
 systemOnly: FALSE
 searchFlags: fATTINDEX
 rangeUpper: 1024
 attributeSecurityGuid: e48d0154-bcf8-11d1-8702-00c04fb96050
 isMemberOfPartialAttributeSet: TRUE
 systemFlags: FLAG_SCHEMA_BASE_OBJECT | FLAG_ATTR_REQ_PARTIAL_SET_MEMBER 
```

这根据[rangeUpper](https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-adls/66e85f4e-6c29-4ea6-82a0-6fe5564dca42)属性定义将最大长度指定为 1024。

在此上下文中，1024 表示八位字节（字节），而不是 Unicode 代码点，如[LDAP 表示](https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-adts/7cda533e-d7a4-4aec-a517-91d02ff4a1aa)和参考[RFC 2252 LDAPv3 属性 6.10 目录字符串](https://www.ietf.org/rfc/rfc2252.html#section-6.10)`omSyntax: 64`中定义的那样`String(Unicode)`，将其描述如下：

> 6.10。目录字符串
> 
> （1.3.6.1.4.1.1466.115.121.1.15 DESC'目录字符串'）
> 
> 此语法中的字符串以 ISO 10646（Unicode 的超集）的 UTF-8 形式编码。服务器和客户端必须准备好接收任意 Unicode 字符的编码，包括当前未分配给任何字符集的字符。

由于 UTF-8 是一种可变长度编码，这意味着最大字符串长度是您可以将 UTF-8 编码为 1024 个八位字节（字节）的许多代码点。即：对于 1024 个代码点的纯 ASCII 字符串，对于具有非 ASCII 字符的任何内容，这意味着少于 1024 个代码点。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-08-05T09:19:17.037

不，不能更改 Active Directory 的登录名中的字符长度。

# email - 电子邮件通知

> ID：277928
> 
> 赞同：1
> 
> 时间：2008-11-10T14:02:58.710
> 
> 标签：email, exchange-server

我工作的公司有在场外工作的顾问。由于政策的原因，我们不允许设置电子邮件转发，以便这些用户可以接收他们的电子邮件。显然这是一个问题，因为这些用户可能会错过重要的电子邮件。谁能推荐一种我们可以通知这些用户他们有电子邮件等待他们的方法？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-10T15:20:45.090

提出此政策的人应负责为场外顾问提出解决方案。此类与技术现实相冲突的政策应重新评估；考虑到具体情况，在有限的时间内要求例外是没有害处的。

请注意，任何其他解决方案都相当于政策的“终结”，即使不是字面意思也违反了政策的精神。如果该政策出于“安全”原因而存在，那么“安全”专家将需要提出替代方案。如果您只是绕过该政策*并且出现问题*，则对所有相关人员都可能非常不利。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-10T14:08:30.883

如果他们身上有手机，您可以向他们发送短信。我不确定您将如何连接，但您希望从您能找到的任何供应商那里获得某种 SMPP 服务。使用 SMPP，您实际上可以重新编码电子邮件并以这种方式发送。对于拥有黑莓的用户来说，以这种方式阅读电子邮件不会太痛苦。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-10T14:11:59.427

您能否设置一个系统向他们发送电子邮件，让他们知道他们有一封电子邮件等着他们？类似于银行如何让您知道您应该登录您的帐户，而不在电子邮件中发送任何实际信息？

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-10T15:28:32.080

我认为在这里做的最好的事情是看看你是否可以改变政策。如果您由于某些政策而无法通过电子邮件向您的顾问发送电子邮件，那么正是政策阻碍了您正确地完成工作，而不是技术问题。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-10T14:41:39.833

我不明白顾问是使用贵公司的电子邮件地址，还是他们有自己的电子邮件地址，在与其他公司开展咨询业务时使用。

我有一个类似的问题，我必须在离开现场时检查电子邮件，这是一个 24/7 的支持演出。我必须构建一个应用程序，我的电子邮件将通过管道传输到 php 脚本并作为短信发送，并且该脚本仅在 22h00 - 07h00 运行，否则它将使用正常转发到我的电子邮件。

另一种选择，使用支持pop3邮件协议的手机，它们可以配置为定期检查并下载电子邮件的快照......

短信脚本对于 24/7 支持类型的环境来说是非常好的工具，否则我会推荐第二个选项（手机）

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-10T14:12:10.190

我确信这些顾问有自己的电子邮件帐户（通过他们的咨询公司或个人）。因此，只需将必要的消息通过电子邮件发送到这些帐户即可。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-10T14:18:05.870

为什么你不能只向他们的“正常”电子邮件地址发送电子邮件？
如果没有，一个电话就可以工作，并提供一个很好的时间来联系、聊天和讨论状态。

# list - 如何将自定义列添加到现有 WSS 列表模板

> ID：277930
> 
> 赞同：0
> 
> 时间：2008-11-10T14:04:21.780
> 
> 标签：list, sharepoint

我需要使用功能订书机将一些文本列添加到 OOTB 博客站点定义内的帖子列表中。我打算不使用网站栏，而只是将这些列添加到列表中（我不使用网站栏，因为我有多个网站集，每个网站集只有一个帖子列表，因此网站栏在这个案例）。我的问题是：我如何实现这一目标？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-10T19:42:03.907

也许您可以创建一个功能，该功能使用来自功能接收器的对象模型，以便在激活该功能时将列添加（并根据需要删除）特定列表。

我将使用 XML Schema 方法来创建列，以确保每列具有相同的 GUID。[看](http://msdn.microsoft.com/en-us/library/microsoft.sharepoint.spfieldcollection.addfieldasxml.aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-10T19:52:58.363

最好的解决方案是为帖子列表创建一个隐藏的自定义操作。我在这里发布一个简化版本

元素.xml：

```
<Elements xmlns="http://schemas.microsoft.com/sharepoint/">
<CustomAction Id="XXXXXXXX"
   RegistrationType="List"
   RegistrationId="101"
   Rights="Open"
   Location="ViewToolbar"
   Sequence="110"
   Title="Hidden Settings Button"
   ControlAssembly="MyLib, Version=1.0.0.0, Culture=neutral, PublicKeyToken=XXXXXX"
       ControlClass="MyLib.MyClass"
   />

    <FeatureSiteTemplateAssociation Id="XXXXXXX" TemplateName="YOUR_BLOG_SITE_TEMPLATE_NAME" /> 
```

MyClass.cs：

```
 [DefaultProperty("Text")]
  [ToolboxData("<{0}:MyClass runat=server></{0}:MyClass>")]
  public class MyClass : WebControl
  {
        [Bindable(true)]
        [Category("Appearance")]
        [DefaultValue("")]
        [Localizable(true)]
        public string Text
        {
            get
            {
                String s = (String)ViewState["Text"];
                return ((s == null) ? String.Empty : s);
            }

            set
            {
                ViewState["Text"] = value;
            }
        }

        protected override void OnLoad(EventArgs e)
        {
            SPList list = SPContext.Current.List;
            if (list != null)
            {
                 list.Fields.Add(XXX, XXX, XXX);
                 list.Update();
            }    
        }    
   } 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-11T14:06:16.673

我看不到为帖子列表创建自定义操作有什么好处。这两篇文章都很有帮助，但我可能会为此创建自定义功能。

# modulo - 在数字末尾添加两位数以计算特定模数的算法？

> ID：277931
> 
> 赞同：2
> 
> 时间：2008-11-10T14:04:54.680
> 
> 标签：modulo, iban

所以，假设我有一个数字 123456。123456 % 97 = 72。如何确定需要在 123456 的末尾添加哪些两位数字，以便新数字 % 97 = 1？注意——它必须始终是两位数。

例如，123456 **76** % 97 = 1。在这种情况下，我需要在数字末尾添加数字“76”。

（这是用于 IBAN 号码计算。）

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-10T14:09:59.100

```
x = 123456

x = x * 100
newX = x + 1 + 97 - (x % 97) 
```

编辑：把 100 放在错误的地方

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-11-10T14:13:41.433

您计算 123456 **00**到 97 的模数并将 (97 - that + 1) 添加到该数字。所以你得到了 RoBorg 上面解释的清洁剂 :)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-10T14:12:18.207

这是您需要的方程式

```
 X = Y -(Number*100 mod y) - 1 
```

在哪里：

```
 Number = 123456
    Y = 97
    X the number you need 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2016-07-07T04:32:08.467

假设我们必须接收包含 12 位数字的号码。

第 1 步：写任意 10 位的随机数，即比所需的少 2 位，例如 1234567890 - 这是 X

第 2 步：X * 100 = 123456789000\. '123456789000' - 这是 Y

第 3 步：Y / 97 = '1272750402.061856'。'06' - 这是 Z

第 4 步：97 - Z + 1 = 92。'92' - 这是 W

第 5 步：最终交易编号为 X，后跟 W，即“123456789092”

可接受的数字示例：100000000093 100000000190 100000000287 等。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-10T15:50:00.757

模算术实际上与常规算术没有什么不同。解决您遇到的此类问题的关键是要意识到您通常会解决该问题的方法仍然有效（在下文中，任何提及数字都意味着整数）：

说你有

15 + x = 20

你解决这个问题的方法是通过意识到在常规加法下 15 的倒数是 -15 然后你可以写（像我们自然地一样利用交换性和结合性）

15 + x + (-15) = (15 + (-15)) + x = 0 + x = x = 20 + (-15) = 5

所以你的答案是 x = 5

现在谈谈你的问题。

假设 N 和 M 是已知的，并且您正在寻找模 k 加法下的 x：

( N + x ) 模 k = M

首先意识到

( N + x ) mod k = ( ( N mod k ) + ( x mod k ) ) mod k

让问题变得有意义

M mod k = M

和

x 模 k = x

所以通过让

N mod k = N_k

和

( a + b ) mod k = a +_k b

你有

N_k +_k x = M

这意味着您需要的是+_k下的N_k的倒数。这实际上非常简单，因为 +_k 下的倒数满足这个方程：

N_k +_k ("​​-N_k") = 0

这实际上非常简单，因为对于一个数字 y 使得 0 <= y < k

(y + (k - y)) 模 k = k 模 k = 0

以便

“-N_k” = (k-N_k)

进而

N_k +_k x +_k "-N_k" = N_k +_k "-N_k" +_k x = 0 +_k x = x = M +_k "-N_k" = M +_k (k - N_k)

使解决方案

( N + x ) 模 k = M

是

x = ( M + ( k - ( N mod k ) ) ) mod k

特别是针对您的问题

( 12345600 + x ) % 97 = 1

解决了

x = ( 1 + ( 97 - ( 12345600 模 97 ) ) 模 97 = 76

请注意，只要 k < 100，您的解决方案总是有两位数的要求是内置的

# javascript - Ganymede 中的 JSEclipse 替代方案

> ID：277935
> 
> 赞同：0
> 
> 时间：2008-11-10T14:07:47.827
> 
> 标签：javascript, eclipse-plugin, eclipse-3.4

我在 Ganymede 中使用 JSEclipse 时遇到了很多问题，但我没有太多运气找到与 Ganymede (eclipse 3.4) 兼容的替代方案。

我真正在寻找的是代码高亮。任何人都有任何好的选择，或者我只需要吸吮它并继续它吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-10T14:37:22.463

[Spket](http://spket.com/)是一个非常好的 Eclipse JS 插件，可以与 Ganymede 一起使用。它提供的不仅仅是突出显示（例如大纲视图和跳转到函数定义的能力），但仍然非常轻量级。

有关 Eclipse 可用的各种 JS 插件的更详细讨论，请参见此处 Eclipse 中的[JavaScript 编辑器](https://stackoverflow.com/questions/24678/eclipse-javascript-editor)

# java - Java 6 中 Windows Communication Foundation 的功能等价物是什么？

> ID：277939
> 
> 赞同：5
> 
> 时间：2008-11-10T14:09:17.637
> 
> 标签：java, wcf

Java 6中[Windows Communication Foundation](http://msdn.microsoft.com/en-us/netframework/aa663324.aspx)的功能等价物是什么？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-10T14:37:48.173

WCF 提供了多种通信选项。David Chappel的[这份白皮书](http://www.davidchappell.com/articles/white_papers/WCF_Diversity_v1.0.docx)是一个很好的演示文稿。描述了以下选项：

*   使用 SOAP 和 WS-* 的互操作通信
*   WCF 应用程序之间的二进制通信
*   RESTful 通信
*   使用 POX、RSS 和 ATOM 进行通信
*   使用适配器与业务线应用程序通信
*   通过消息队列进行通信
*   通过 Windows 对等网络进行通信
*   同一台机器上的进程之间的通信
*   自定义通信

虽然有些选项与 Java 无关（例如第二个），但它可以帮助您识别 Java 中相应的功能等价物。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-10T14:17:42.563

我不知道所有 WCF 包含什么，但[JAX-WS](https://jax-ws.dev.java.net/)（及其参考实现[Metro](https://metro.dev.java.net/)）可能是一个很好的起点。

[J2EE](http://java.sun.com/javaee/technologies/)中的一些其他技术也可能适用。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2010-04-07T17:23:05.203

[Apache Axis](http://ws.apache.org/axis/)是 Web 服务部分的良好开端。如果您需要消息队列，请查看[Apache Qpid](http://qpid.apache.org/)，否则您可能需要询问您尝试在 Java 中解决的确切问题。

# open-source - 如何显示学分

> ID：277941
> 
> 赞同：11
> 
> 时间：2008-11-10T14:10:22.797
> 
> 标签：open-source, maven-2, dependencies, ivy

我想感谢我们在（商业）应用程序中使用的所有开源库。我想在我们的关于对话框中显示一个 HTML 页面。我们的构建过程使用 ant，第三方库在 svn 中提交。

您认为生成 HTML 页面的最佳方式是什么？

*   对 HTML 页面进行硬编码？
*   将依赖管理切换到 apache-ivy 并编写一些 ant 任务来生成 html
*   使用 maven-ant-tasks 并编写一些 ant 任务来生成 HTML
*   仅使用 maven 处理依赖项和 HTML 一次，下载并提交它们。其余的由未更改的 ant-scripts 完成
*   切换到 maven2 （嘿老板，我想切换到 maven，在 1 个月内构建可能会再次工作......）
*   ...

关于对话框应该显示哪些元素？

*   图书馆名称
*   版本
*   执照
*   作者
*   主页
*   使用指向源存档的链接所做的更改
*   ...

有一些最佳实践建议吗？一些好的例子（应用程序有一个很好的关于对话框显示依赖关系）？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-10T14:24:54.970

蚂蚁任务似乎是最好的方法。我们在我们的一个项目中做了类似的事情。所有开源库都存在于指定的文件夹中。Ant 任务读取这些库、版本等的清单并生成一个 HTML，将其复制到另一个指定的文件夹中，Web 容器从该文件夹中获取它。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-10T19:31:52.133

您需要考虑两件不同的事情。

首先，您可能需要识别第三方代码的许可证。这通常与 THIRDPARTYLICENSE 文件有关。Sun Microsystems 经常这样做。例如，查看 OpenOffice.org 的安装目录。有此类文件的 .txt 和 .html 版本的示例。

其次，您可能希望在“关于”框中以简短的方式标识您的依赖项（也请参阅许可证信息文件）。我会确保版本出现在“关于”框中。人们想要快速检查的一件事是指示他们拥有的代码副本是否需要替换或更新，因为您的库依赖项之一具有最近披露的错误或安全漏洞。

因此，我想您希望在“关于”框中包含的另一件事是人们可以找到您的支持站点以及对特定版本用户的任何重要通知（无论您的应用程序中是否有用于检查的规定-更新行）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-10T15:40:00.137

如果库不会经常更改，那么在每次构建时生成页面将是一种浪费。库版本可能会更改，但实际库不会更改。更容易地创建一个 HTML 页面将是最简单的方法，但这是另一个维护头疼的问题。生成一次并将其包含在包中。如果对库进行了一些更改（更新版本、添加新库），该脚本总是可以再次运行。

# templates - 将参数传递给 struts2 组件

> ID：277942
> 
> 赞同：1
> 
> 时间：2008-11-10T14:10:48.303
> 
> 标签：templates, struts2, components, freemarker

我正在尝试使用 freemarker 创建一个 struts2 组件。我`ftl`用这样的代码创建了一个文件：

```
<script type="text/javascript" src="${parameters.library?default('')}"></script> 
```

期望将名为的参数`library`传递给组件。如果参数不存在，则默认为空白`String`。

在我的 JSP 页面上，我指的是这样的组件：

```
<s:component template="mytemplate.ftl">
    <s:param name="library" value="/scripts/mylibrary.js"/>
</s:component> 
```

不幸的是，没有设置 library 参数的值。它始终是一个空白`String`。

我正在使用本[教程](http://www.vitarara.org/cms/struts_2_cookbook/creating_a_ui_component)中的建议，似乎`s:param`标签应该将参数传递到模板中并使其可用。我在这里想念什么？

有没有人有一些构建这些组件的经验可以提供一些启示？

谢谢。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-11-19T13:46:53.443

用单引号发送参数

```
<s:component template="mytemplate.ftl">
    <s:param name="library" value="'/scripts/mylibrary.js'"/>
</s:component> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-13T04:00:31.623

我最终在有效的文档中遇到了一些语法。我必须像这样引用参数：

```
<script type="text/javascript" src="${parameters.get('library')?default('')}">
</script> 
```

# database - 你有修补过Rel吗？

> ID：277943
> 
> 赞同：2
> 
> 时间：2008-11-10T14:10:57.057
> 
> 标签：database, rel

我想听听关于[Rel](http://dbappbuilder.sourceforge.net/Rel.php)的意见或人们的经验。它是注定要扔进垃圾箱的，还是编程中的下一件大事？我还没有尝试用它做任何事情（看起来你现在真的不能），但我对其中讨论的一些概念很感兴趣。尤其：

1.  从语言的数据处理部分完全删除空值。
2.  无需在语言和数据存储之间映射类型。
3.  嵌套表
4.  设计和实现完全分离。

想法？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-10T14:29:56.957

我认为它旨在帮助**教授**纯关系模型，而不是在短期或中期作为 SQL DBMS 的“实际工作”的竞争对手。[然而，Date 和 Darwen 在他们的书The Third Manifesto](http://www.thethirdmanifesto.com)中为正确实施关系模型提出了令人信服的案例。也许有一天有人会根据它生产出成功的产品。毕竟，甲骨文曾经是一家非常小的利基公司！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-10T16:41:21.730

对，我同意你的观点，托尼。不过，对我来说有趣的是，Rel 是一个有点工作的实现，理解它本质上是教程 D 的工作版本。想法是一些资金充足的企业进行研究并决定像工业 D 之类的东西可能是值得的。

也许我在这里错了，但我的印象是，虽然教程 D 主要是一种数据语言，但它也有可能进入应用程序领域。这对我来说似乎是开创性的。当然，在阅读了 Date、Darwen、Pascal 和其他人的一些东西之后，似乎该语言可能具有取代一般面向对象编程的目标。现在，OO 似乎统治着编程世界。Rel 将提供有关编程的另一种观点。

所以我想我很好奇的是这个项目是否有通往其他产品的腿，或者人们是否认为它只是一个历史好奇心。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-08-31T04:42:07.363

从OP开始将近四年。我最近遇到了 Rel，它确实对我正在做的事情有潜力。它更明确地被确立为一种教学语言，但现在的实现相当稳固，尽管在语法上仍然有点脆弱。它确实有潜力，我希望这种潜力能够实现。不幸的是，这与四年前的声明类似，因此如果要实现，显然是一个非常缓慢的燃烧器。大多数研究工作仍然需要大约 10 年的时间才能嵌入到产品中，因此仍有希望。

# java - 使用 Java 读取结构化二进制文件的最佳方法

> ID：277944
> 
> 赞同：52
> 
> 时间：2008-11-10T14:11:12.047
> 
> 标签：java, file, binaryfiles

我必须使用 Java 读取旧格式的二进制文件。

简而言之，该文件的标题由几个整数、字节和固定长度的字符数组组成，然后是一个记录列表，该列表也由整数和字符组成。

在任何其他语言中，我都会创建`struct`s (C/C++) 或`record`s (Pascal/Delphi)，它们是标题和记录的逐字节表示。然后我将`sizeof(header)`字节读入头变量并对记录执行相同的操作。

像这样的东西：（德尔福）

```
type
  THeader = record
    Version: Integer;
    Type: Byte;
    BeginOfData: Integer;
    ID: array[0..15] of Char;
  end;

...

procedure ReadData(S: TStream);
var
  Header: THeader;
begin
  S.ReadBuffer(Header, SizeOf(THeader));
  ...
end; 
```

用 Java 做类似事情的最佳方法是什么？我是否必须自己读取每个值，还是有其他方法可以进行这种“块读取”？

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2008-11-10T14:41:08.197

据我所知，Java 强制您以字节的形式读取文件，而不是阻止读取。如果您要序列化 ​​Java 对象，那就另当别论了。

显示的其他示例使用带有 File的[DataInputStream类，但您也可以使用快捷方式：](http://java.sun.com/javase/6/docs/api/java/io/DataInputStream.html) [RandomAccessFile](http://java.sun.com/javase/6/docs/api/java/io/RandomAccessFile.html)类：

```
RandomAccessFile in = new RandomAccessFile("filename", "r");
int version = in.readInt();
byte type = in.readByte();
int beginOfData = in.readInt();
byte[] tempId;
in.read(tempId, 0, 16);
String id = new String(tempId); 
```

请注意，您可以将响应对象转换为一个类，如果这样会更容易的话。

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2009-08-12T14:52:04.033

如果您要使用[Preon](https://github.com/preon/preon)，那么您所要做的就是：

```
public class Header {
    @BoundNumber int version;
    @BoundNumber byte type;
    @BoundNumber int beginOfData;
    @BoundString(size="15") String id;
} 
```

一旦你有了这个，你就可以使用一行来创建 Codec：

```
Codec<Header> codec = Codecs.create(Header.class); 
```

你像这样使用编解码器：

```
Header header = Codecs.decode(codec, file); 
```

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2008-11-10T14:31:32.380

您可以按如下方式使用 DataInputStream 类：

```
DataInputStream in = new DataInputStream(new BufferedInputStream(
                         new FileInputStream("filename")));
int x = in.readInt();
double y = in.readDouble();

etc. 
```

一旦你得到这些值，你就可以随心所欲地使用它们。在 API 中查找 java.io.DataInputStream 类以获取更多信息。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2008-11-10T15:58:16.277

我可能误解了你，但在我看来，你正在创建内存中的结构，你希望这将是你想从硬盘读取的内容的逐字节准确表示，然后将整个内容复制到内存中并操纵那里？

如果确实如此，那你就是在玩一场非常危险的游戏。至少在 C 中，该标准不强制执行诸如填充或对齐结构成员之类的事情。更不用说诸如大/小字节序或奇偶校验位之类的事情了……因此，即使您的代码碰巧运行它也是非常不可移植且有风险的——您依赖于编译器的创建者不会在未来的版本上改变主意。

最好创建一个自动机来验证从 HD 读取的结构（每个字节的字节）是否有效，如果确实可以，则填充内存中的结构。尽管您获得了平台和编译器的独立性，但您可能会失去一些毫秒（不像现代操作系统看起来做很多磁盘读取缓存那样多）。此外，您的代码将很容易移植到另一种语言。

帖子编辑：在某种程度上我同情你。在 DOS/Win3.11 的好日子里，我曾经创建了一个 C 程序来读取 BMP 文件。并使用了完全相同的技术。一切都很好，直到我尝试为 Windows 编译它 - 哎呀！Int 现在是 32 位长，而不是 16 位！当我尝试在 Linux 上编译时，发现 gcc 的位域分配规则与 Microsoft C（6.0！）非常不同。我不得不求助于宏技巧使其便携......

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2011-12-02T08:34:04.337

我使用了 Javolution 和 javastruct，它们都处理字节和对象之间的转换。

[Javolution](http://javolution.org/target/site/apidocs/javolution/io/Struct.html)提供了代表 C 类型的类。您需要做的就是编写一个描述 C 结构的类。例如，从 C 头文件中，

```
struct Date {
    unsigned short year;
    unsigned byte month;
    unsigned byte day;
}; 
```

应该翻译成：

```
public static class Date extends Struct {
    public final Unsigned16 year = new Unsigned16();
    public final Unsigned8 month = new Unsigned8();
    public final Unsigned8 day   = new Unsigned8();
} 
```

然后调用`setByteBuffer`初始化对象：

```
Date date = new Date();
date.setByteBuffer(ByteBuffer.wrap(bytes), 0); 
```

[javastruct](http://code.google.com/p/javastruct/wiki/HowToUseJavaStruct)使用注解来定义 C 结构中的字段。

```
@StructClass
public class Foo{

    @StructField(order = 0)
    public byte b;

    @StructField(order = 1)
    public int i;
} 
```

初始化一个对象：

```
Foo f2 = new Foo();
JavaStruct.unpack(f2, b); 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-11-10T14:18:20.630

我猜 FileInputStream 可以让你以字节为单位读取。因此，使用 FileInputStream 打开文件并读取 sizeof(header)。我假设标题具有固定的格式和大小。我没有在最初的帖子中看到这一点，但假设是这种情况，因为如果标题具有可选的参数和不同的大小，它会变得更加复杂。

获得信息后，可以有一个标头类，您可以在其中分配已读取的缓冲区内容。然后以类似的方式解析记录。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-11-10T16:10:24.273

这是使用 ByteBuffer (Java NIO) 读取字节的链接

[http://exampledepot.com/egs/java.nio/ReadChannel.html](http://exampledepot.com/egs/java.nio/ReadChannel.html)

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-11-10T16:15:28.037

正如其他人提到的那样，DataInputStream 和 Buffers 可能是您在 Java 中处理二进制数据所追求的低级 API。

但是，您可能想要[Construct](http://construct.wikispaces.com/)之类的东西（wiki 页面也有很好的示例：[http://en.wikipedia.org/wiki/Construct_(python_library)](http://en.wikipedia.org/wiki/Construct_(python_library)))，但适用于 Java。

我不知道有任何（Java 版本），但是采用这种方法（在代码中声明性地指定结构）可能是正确的方法。使用 Java 中合适的[流畅接口](http://en.wikipedia.org/wiki/Fluent_interface)，它可能与 DSL 非常相似。

编辑：一些谷歌搜索揭示了这一点：

[http://javolution.org/api/javolution/io/Struct.html](http://javolution.org/api/javolution/io/Struct.html)

这可能是您正在寻找的那种东西。我不知道它是否有效或有什么好处，但它看起来是一个明智的起点。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2010-03-04T11:52:42.870

我将创建一个对象，该对象包含数据的[ByteBuffer](http://java.sun.com/j2se/1.5.0/docs/api/java/nio/ByteBuffer.html)表示形式，并提供 getter 以直接从缓冲区读取。通过这种方式，您可以避免将数据从缓冲区复制到原始类型。此外，您可以使用[MappedByteBuffer](http://java.sun.com/j2se/1.5.0/docs/api/java/nio/MappedByteBuffer.html)来获取字节缓冲区。如果您的二进制数据很复杂，您可以使用类对其进行建模，并为每个类提供缓冲区的切片版本。

```
class SomeHeader {
    private final ByteBuffer buf;
    SomeHeader( ByteBuffer fileBuffer){
       // you may need to set limits accordingly before
       // fileBuffer.limit(...)
       this.buf = fileBuffer.slice();
       // you may need to skip the sliced region
       // fileBuffer.position(endPos)
    }
    public short getVersion(){
        return buf.getShort(POSITION_OF_VERSION_IN_BUFFER);
    }
} 
```

从字节缓冲区[读取无符号值的方法](http://www.javafaq.nu/java-example-code-342.html)也很有用。

高温高压

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-05-05T01:06:43.070

我已经编写了一种在 java 中执行此类操作的技术 - 类似于读取位字段的旧 C 类习语。请注意，这只是一个开始，但可以扩展。

[这里](http://codify.flansite.com/2009/05/c-struct-like-parsing-of-binary-data-with-java/)

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-11-10T14:32:33.550

过去我使用 DataInputStream 按指定顺序读取任意类型的数据。这将不允许您轻松解决大端/小端问题。

从 1.4 开始，java.nio.Buffer 系列可能是要走的路，但您的代码似乎实际上可能更复杂。这些类确实支持处理字节序问题。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-11-10T15:53:04.120

不久前，我发现[了这篇](http://www.webservicessummit.com/Articles/MadhuOct2005_1.htm)关于使用反射和解析来读取二进制数据的文章。在这种情况下，作者使用反射来读取 java 二进制 .class 文件。但是，如果您正在将数据读入类文件，它可能会有所帮助。

# mysql - 是否有任何 MySQL 函数可以获取开始或结束日期介于给定开始日期和结束日期之间的所有行？

> ID：277953
> 
> 赞同：8
> 
> 时间：2008-11-10T14:13:59.703
> 
> 标签：mysql

我有一个事件表，其中记录了开始和结束时间作为 MySQL DATETIME 对象（格式为`YYYY-MM-DD HH:MM:SS`。我想查找在特定日期范围内发生的所有事件。但是，事件可以跨越多天（并且超出我的日期范围，但如果它们与我的日期范围重叠 1 秒或更多，我想返回它们）。

建议？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-11-10T14:21:25.053

这将找到完全包含在范围内的每个事件：

```
SELECT * FROM table WHERE start_date BETWEEN start_of_range AND end_of_range 
                      AND stop_date  BETWEEN start_of_range AND end_of_range 
```

这将找到事件的任何部分与范围的任何部分重叠的任何事件：

```
SELECT * FROM table WHERE start_date <= end_of_range 
                      AND stop_date  >= start_of_range 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-11-10T14:32:33.033

@Bill the Lizard 和 @Robert Gamble 的回答对于所提出的问题是正确的，但我想知道你是否在问你认为你是什么......如果你正在寻找重叠的事件，那么你需要考虑帐户事件长于您的搜索范围。

```
 Monday   Tuesday   Wednesday   Thursday

Search:                |-----------|

Shopping                       |-----|              Found OK
Eating              |--------|                      Found OK
Stack Overflow |---------------------------------|  Not found! 
```

如果你想包括 SO，你会这样做：

`SELECT * FROM table WHERE (start_date < end_of_range AND end_date > start_of_range)`

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-10T14:21:18.267

```
SELECT *
FROM table
WHERE startdate >= 'starting date' AND startdate < 'ending date'
    OR enddate >= 'starting date' AND enddate < 'ending date' 
```

应该为你工作。

确保指定“开始日期”和“结束日期”并包含时间。

```
'2008-01-01 00:00:00'' AND '2008-01-31 23:59:59' 
```

这将有助于避免日期相同但您的时间在几小时、几分钟或几秒之内的时间间隔内的错误。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-10T14:25:23.267

基本上，您可以使用常规比较——上面的比较应该有效——诀窍是检查所有可能发生的不同情况。

A) 结束日期在范围内的事件

B) 开始日期在范围内的事件

C) 开始日期和结束日期都在范围内的事件

D) 开始日期和结束日期*超出*范围但重叠的事件

罗伯特的回答很好，但它没有考虑案例 D，即事件在范围之前开始并在范围之后结束。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-16T20:48:37.763

Llya，罗伯茨回答说，

SELECT * FROM table WHERE start_date <= end_of_range AND stop_date >= start_of_range

工作正常，

D) 开始日期和结束日期超出范围但重叠的事件

??

# windows-vista - 使用托管代码调用蓝屏死机

> ID：277959
> 
> 赞同：20
> 
> 时间：2008-11-10T14:18:05.263
> 
> 标签：windows-vista, windows-xp, managed-code, bsod

这里只是好奇：是否可以在 Windows XP/Vista 下使用 .net 托管代码调用 Windows 蓝屏死机？如果可能的话，示例代码是什么？

只是为了记录，这不是出于任何恶意目的，我只是想知道要真正杀死指定的操作系统需要什么样的代码。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-11-10T14:53:05.490

键盘的东西可能是一个不错的选择，但是如果您需要通过代码来完成，请继续阅读...

本质上，您实际上并不需要任何东西，您需要做的就是找到 KeBugCheck(Ex) 函数并调用它。

[http://msdn.microsoft.com/en-us/library/ms801640.aspx](http://msdn.microsoft.com/en-us/library/ms801640.aspx) [http://msdn.microsoft.com/en-us/library/ms801645.aspx](http://msdn.microsoft.com/en-us/library/ms801645.aspx)

对于手动启动的崩溃，您希望使用 0xE2 (MANUALLY_INITIATED_CRASH) 或 0xDEADDEAD (MANUALLY_INITIATED_CRASH1) 作为错误检查代码。它们被明确保留用于该用途。

然而，找到这个函数可能会有点棘手。Windows DDK 可能会有所帮助（检查 Ntddk.h）——我目前没有它，而且我现在似乎无法找到决定性的信息——我**认为**它在 ntoskrnl.exe 或 ntkrnlpa.exe 中，但我'不确定，目前没有工具来验证它。

您可能会发现只编写一个简单的 C++ 应用程序或调用该函数的东西，然后运行它会更容易。

请注意，我**假设**Windows 不会阻止您从用户空间访问该功能（.NET 可能有一些特殊规定）。我自己没有测试过。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-10T14:35:11.203

我不知道它是否真的有效，我确定您需要管理员权限，但您可以设置 CrashOnCtrlScroll 注册表项，然后使用 SendKeys 发送 CTRL+Scroll Lock+Scroll Lock。

但我相信这必须来自键盘驱动程序，所以我猜一个简单的 SendKeys 不够好，你要么需要以某种方式连接到键盘驱动程序（听起来真的很乱），要么检查 CrashDump 是否有一个 API 可以用 P/Invoke 调用。

[http://support.microsoft.com/kb/244139](http://support.microsoft.com/kb/244139)

HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\i8042prt\Parameters
名称：CrashOnCtrlScroll
数据类型：REG_DWORD
值：1
重新启动

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-10T14:24:46.933

我不得不说不。您必须 p/invoke 并与位于内核空间中的驱动程序或其他代码交互。.NET 代码与这个领域相去甚远，尽管在未来的 Windows 版本中有一些关于托管驱动程序的讨论。再等几年，你就可以像我们不受管理的朋友一样崩溃了。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-10T14:29:30.123

据我所知，真正的蓝屏死机需要内核模式代码失败。Vista 仍然有 BSOD，但它们的频率较低，因为新的驱动程序模型在内核模式下的驱动程序较少。任何用户模式故障只会导致您的应用程序被杀死。

您不能在内核模式下运行托管代码。所以如果你想蓝屏，你需要使用 PInvoke。但即便如此，也是相当困难的。你需要做一些非常花哨的 PInvokes 才能在内核模式下获得一些东西。

但是在成千上万的 SO 用户中，可能有人这样做了 :-)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-19T10:57:04.410

您可以使用触发内核崩溃的 OSR Online 工具。我自己从未尝试过，但我想您可以通过标准的 .net Process 类运行它：

[http://www.osronline.com/article.cfm?article=153](http://www.osronline.com/article.cfm?article=153)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-10T14:57:43.110

我曾经不负责任地使用 .NET 1.1 中的 System.Net.Sockets 在 Windows XP 上生成 BSOD。我可以经常重复它，但不幸的是那是几年前的事了，我不记得我到底是如何触发它的，也不记得有源代码了。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-10T15:22:48.033

尝试在directx8 或directx9 中使用directshow 进行实时视频输入，大多数调用都转到内核模式视频驱动程序。从实时视频捕获源运行回调过程时，我成功地出现了很多蓝屏，特别是如果您的回调需要很长时间，可能会停止整个内核驱动程序。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-11-10T16:17:51.900

当托管代码可以访问错误的内核驱动程序时，它可能会导致错误检查。但是，直接导致 BSOD 的将是内核驱动程序（例如，uffe 的 DirectShow BSOD、Terence Lewis 的套接字 BSOD 或在将 BitTorrent 与某些网络适配器一起使用时看到的 BSOD）。

对特权低级资源的直接用户模式访问可能会导致错误检查（例如，乱涂乱画`Device\PhysicalMemory`，如果它没有首先损坏您的硬盘；Vista 不允许用户模式访问物理内存）。

如果您只想要一个转储文件，Mendelt 建议使用 WinDbg 比利用内核驱动程序中的错误要好得多。不幸的是，`.dump`本地内核调试不支持该命令，因此您需要通过串行或 1394 连接的第二台 PC，或通过虚拟串行端口连接的 VM。如果您不需要内存转储的状态完全自洽，[LiveKd可能是单 PC 选项。](http://technet.microsoft.com/en-us/sysinternals/bb897415.aspx)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2012-03-20T19:11:38.607

不幸的是，我知道如何做到这一点，因为我们服务器上的 .NET 服务导致蓝屏。（注意：Windows Server 2008 R2，不是 XP/Vista）。

我简直不敢相信 .NET 程序是罪魁祸首，但确实如此。此外，我刚刚在虚拟机中复制了 BSOD。

违规代码导致 0x00000f4：

```
string name = string.Empty; // This is the cause of the problem, should check for IsNullOrWhiteSpace

foreach (Process process in Process.GetProcesses().Where(p => p.ProcessName.StartsWith(name, StringComparison.OrdinalIgnoreCase)))
{
    Check.Logging.Write("FindAndKillProcess THIS SHOULD BLUE SCREEN " + process.ProcessName);
    process.Kill();
    r = true;
} 
```

如果有人想知道我为什么要复制蓝屏，那没有恶意。我已经修改了我们的日志记录类以接受一个参数，告诉它[直接写入磁盘](https://stackoverflow.com/questions/9791088/filestream-constructor-and-default-buffer-size)，因为尽管调用了 .Flush()，但在 BSOD 之前的操作没有出现在日志中。我复制了服务器崩溃以测试日志记录更改。虚拟机正式崩溃，但日志记录工作。

编辑：杀死[csrss.exe](http://en.wikipedia.org/wiki/Client/Server_Runtime_Subsystem)似乎是导致蓝屏的原因。根据评论，这很可能发生在内核代码中。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2013-08-22T07:22:02.013

这个不需要任何内核模式驱动程序，只需要一个 SeDebugPrivilege。您可以将您的进程设置为关键[`NtSetInformationProcess`](http://undocumented.ntinternals.net/UserMode/Undocumented%20Functions/NT%20Objects/Process/NtSetInformationProcess.html)，或者[`RtlSetProcessIsCritical`](http://www.codeproject.com/Articles/43405/Protecting-Your-Process-with-RtlSetProcessIsCriti)只是终止您的进程。您将看到与杀死 csrss.exe 相同的错误检查代码，因为您在进程上设置了相同的“关键”标志。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2020-12-03T22:39:21.847

我发现如果您`taskkill /F /IM svchost.exe`以管理员身份运行，它会尝试一次杀死几乎所有服务主机。

# python - 字典或 If 语句，Jython

> ID：277965
> 
> 赞同：4
> 
> 时间：2008-11-10T14:20:13.777
> 
> 标签：python, switch-statement, jython

我现在正在编写一个脚本，它将使用 dom4j 从 HTML 中获取某些信息。

由于 Python/Jython 没有本机**switch**语句，我决定使用一大堆调用适当方法的**if**语句，如下所示：

```
if type == 'extractTitle':
    extractTitle(dom)
if type == 'extractMetaTags':
    extractMetaTags(dom) 
```

我将根据我想从 HTML 中提取的信息添加更多内容，并考虑采用我在本网站其他地方找到的字典方法，示例如下：

```
{
    'extractTitle':    extractTitle,
    'extractMetaTags': extractMetaTags
}[type](dom) 
```

我知道每次运行脚本时都会构建字典，但与此同时，如果我要使用**if**语句，脚本必须检查所有这些语句，直到找到正确的语句。我真正想知道的是，哪一个表现更好或通常是更好的做法？

**更新：** @Brian - 感谢您的精彩回复。我有一个问题，如果任何提取方法需要多个对象，例如

```
handle_extractTag(self, dom, anotherObject)
# Do something 
```

您将如何对**handle**方法进行适当的更改来实现这一点？希望你知道我的意思:)

干杯

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-11-10T14:24:04.580

为了避免在 dict 中指定标签和处理程序，您可以只使用一个处理程序类，其中的方法命名为匹配类型。例如

```
class  MyHandler(object):
    def handle_extractTitle(self, dom):
        # do something

    def handle_extractMetaTags(self, dom):
        # do something

    def handle(self, type, dom):
        func = getattr(self, 'handle_%s' % type, None)
        if func is None:
            raise Exception("No handler for type %r" % type)
        return func(dom) 
```

用法：

```
 handler = MyHandler()
 handler.handle('extractTitle', dom) 
```

**更新：**

当您有多个参数时，只需更改句柄函数以获取这些参数并将它们传递给函数。如果您想让它更通用（这样您在更改参数签名时不必同时更改处理程序函数和句柄方法），您可以使用 *args 和 **kwargs 语法来传递所有接收到的参数. 然后handle方法变成：

```
def handle(self, type, *args, **kwargs):
    func = getattr(self, 'handle_%s' % type, None)
    if func is None:
        raise Exception("No handler for type %r" % type)
    return func(*args, **kwargs) 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-10T14:27:44.963

使用您的代码，您正在运行您的所有函数都会被调用。

```
处理程序 = {
“提取标题”：提取标题，
'extractMetaTags'：提取MetaTags
}

处理程序[类型](dom)

```

会像您的原始`if`代码一样工作。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-10T14:26:14.857

这取决于我们正在谈论多少个 if 语句；如果它是一个非常小的数字，那么它会比使用字典更有效。

但是，与往常一样，我强烈建议您做任何使您的代码看起来更干净的事情，直到经验和分析告诉您需要优化特定的代码块。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-10T14:27:35.040

您对字典的使用不太正确。在您的实现中，所有方法都将被调用，所有无用的方法都将被丢弃。通常做的更像是：

```
switch_dict = {'extractTitle': extractTitle, 
               'extractMetaTags': extractMetaTags}
switch_dict[type](dom) 
```

如果您有大量（或可变）项目，那么这种方式更重要且更具可扩展性。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-10T14:36:53.463

效率问题几乎无关紧要。字典查找是通过一种简单的散列技术完成的，if 语句必须一次评估一个。字典往往更快。

我建议你实际上有从 DOM 中提取的多态对象。

目前尚不清楚如何`type`设置，但它确实看起来可能是一系列相关对象，而不是简单的字符串。

```
class ExtractTitle( object ):
    def process( dom ):
        return something

class ExtractMetaTags( object ):
    def process( dom ):
        return something 
```

您可以这样做，而不是设置 type="extractTitle"。

```
type= ExtractTitle() # or ExtractMetaTags() or ExtractWhatever()
type.process( dom ) 
```

然后，您将不会构建这个特定的字典或 if 语句。

# java - 显示标签、分组和空行

> ID：277982
> 
> 赞同：1
> 
> 时间：2008-11-10T14:28:06.943
> 
> 标签：java, jsp, grouping, displaytag

我正在寻找一种使用[displaytag](http://displaytag.sourceforge.net/)进行分组但将组标题与细节分开的方法。这可能不是那么清楚，所以这里有一个例子：

如果我只是将组添加到 displaytag 表中，我最终会得到类似的结果：

```
| group1 | item1 |
|        | item2 |
|        | item3 |
| group2 | item4 |
|        | item5 | 
```

我想要类似的东西：

```
| group1 |       | 
|        | item1 |
|        | item2 |
|        | item3 |
| group2 |       |
|        | item4 |
|        | item5 | 
```

我在文档中找不到任何内容。有谁知道是否有解决方法？或者我应该回到简单的手写 JTSL 吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-10T01:09:34.100

抱歉，晚会晚了 7 个月，但尝试使用`MultilevelTotalTableDecorator`装饰器，它会根据您的要求生成一个空行，但这确实是装饰器应该做的副作用。您必须尝试使用​​其他选项才能让它做您想做的事情。

```
<%
        // you can do this as a scriptlet on the page, but i put it into a taglib...
        org.displaytag.decorator.MultilevelTotalTableDecorator subtotals = new org.displaytag.decorator.MultilevelTotalTableDecorator();
        subtotals.setGrandTotalDescription("&nbsp;");    // optional, defaults to Grand Total
        subtotals.setSubtotalLabel("&nbsp;", null);
        pageContext.getRequest().setAttribute("subtotaler", subtotals);
%>
<display:table name="contacts" id="contactRow" defaultsort="1" defaultorder="ascending" decorator="subtotaler">
    <display:column property="contactType" title="Contact Type" total="true" group="1"/>
    <display:column property="contactDate" format="{0,date,MM/dd/yyyy}" title="Date" />
    <display:column property="contactName" title="Name" />
    <display:column property="contactPhone" title="Phone" />
    <display:column property="contactEmail" title="Email" />
</display:table> 
```

# xml - 从生成的 XML 中删除 'standalone="yes"'

> ID：277996
> 
> 赞同：83
> 
> 时间：2008-11-10T14:32:59.367
> 
> 标签：xml, xsd, jaxb, xml-binding

您是否知道防止在生成的 XML 中生成**独立 =“yes”的 JAXB 设置？**

```
<?xml version="1.0" encoding="UTF-8" standalone="yes"?> 
```

* * *

## 回答 #1

> 赞同：121
> 
> 时间：2010-11-01T08:27:51.080

在作为 JDK1.6 一部分的 JAXB 中

```
marshaller.setProperty(Marshaller.JAXB_FRAGMENT, true); 
```

* * *

## 回答 #2

> 赞同：66
> 
> 时间：2008-12-09T08:26:54.267

这个性质：

```
marshaller.setProperty("com.sun.xml.bind.xmlDeclaration", false); 
```

...可以用来没有：

```
<?xml version="1.0" encoding="UTF-8" standalone="yes"?> 
```

但是，我不会考虑这种最佳做法。

* * *

## 回答 #3

> 赞同：64
> 
> 时间：2011-03-25T11:00:29.150

您可以使用

```
marshaller.setProperty(Marshaller.JAXB_FRAGMENT, true); 
```

或者

```
marshaller.setProperty("com.sun.xml.bind.xmlDeclaration", false) 
```

禁用默认 XML 声明，然后添加您的自定义 XML 声明，

```
<?xml version="1.0" encoding="UTF-8"?> 
```

经过

```
marshaller.setProperty("com.sun.xml.bind.xmlHeaders",
      "<?xml version=\"1.0\" encoding=\"UTF-8\"?>"); 
```

到生成的 xml，从而避免了**Standalone="yes"**属性。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2016-11-07T12:13:36.077

只是如果其他人仍在努力解决这个问题，您可以考虑使用

```
marshaller.setProperty(Marshaller.JAXB_FRAGMENT, Boolean.TRUE); 
```

`String`删除所有 XML 声明，只需在输出流/方法的开头编写自己的声明

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-12-24T10:51:09.693

如果您使文档依赖于`DOCTYPE`（例如使用命名实体），那么它将不再是独立的，因此`standalone="yes"`在 XML 声明中是不允许的。

然而，独立的 XML 可以在任何地方使用，而非独立的 XML 解析器对于不加载外部的 XML 解析器来说是有问题的。

除了与不支持 XML 的软件的互操作性之外，我看不出这个声明如何成为问题，而是一些可怕的正则表达式汤。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2017-05-03T09:55:07.800

如果您只使用默认的 javax.xml 包，您可以将 marshaller 的 JAXB_FRAGMENT 选项设置为“true”（这会省略默认的 xml 处理指令）并使用 XMLStreamWriter 的 writeProcessingInstruction 方法插入您自己的：

```
xmlStreamWriter.writeProcessingInstruction("xml", "version=\"1.0\" encoding=\"UTF-8\"");
jaxbMarshaller.setProperty( Marshaller.JAXB_FRAGMENT, Boolean.TRUE);
jaxbMarshaller.marshal(object, xmlStreamWriter);
xmlStreamWriter.writeEndDocument(); 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2016-08-10T11:40:45.647

```
jaxbMarshaller.setProperty(Marshaller.JAXB_FRAGMENT, Boolean.TRUE);
jaxbMarshaller.setProperty("com.sun.xml.internal.bind.xmlHeaders", "<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"no\"?>"); 
```

这对我来说适用于 JDK1.7。可以删除standalone=\"no\" 以仅获取xml 部分的其余部分

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2018-04-10T17:46:23.003

您可以使用： marshaller.setProperty("jaxb.fragment", Boolean.TRUE);

它适用于 Java 8

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2016-09-21T23:34:00.387

我没有足够高的“声誉”来拥有评论的“特权”。;-)

@Debasis，请注意您指定的属性：

```
"com.sun.xml.internal.bind.xmlHeaders" 
```

应该：

```
"com.sun.xml.bind.xmlHeaders" (without the "internal", which are not meant to be used by the public) 
```

如果我像你一样使用“内部”属性，我会得到一个*javax.xml.bind.PropertyException*

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2019-02-10T19:33:59.190

如果您遇到属性异常，请添加以下配置：

```
jaxbMarshaller.setProperty("com.sun.xml.internal.bind.xmlHeaders",
              "<?xml version=\"1.0\" encoding=\"UTF-8\"?>");
jaxbMarshaller.setProperty("com.sun.xml.internal.bind.xmlDeclaration", Boolean.FALSE);
jaxbMarshaller.setProperty(Marshaller.JAXB_FRAGMENT, Boolean.TRUE); 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2019-08-06T18:56:28.043

你试一试

```
private String marshaling2(Object object) throws JAXBException, XMLStreamException {
    JAXBContext jaxbContext = JAXBContext.newInstance(object.getClass());
    Marshaller jaxbMarshaller = jaxbContext.createMarshaller();
    jaxbMarshaller.setProperty(Marshaller.JAXB_FORMATTED_OUTPUT, true);
    jaxbMarshaller.setProperty(Marshaller.JAXB_FRAGMENT, Boolean.TRUE);
    StringWriter writer = new StringWriter();
    writer.write("<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n");
    jaxbMarshaller.marshal(object, writer);
    return writer.toString();
  } 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2019-11-27T01:44:20.347

我正在使用 Java 1.8 和 JAXB 2.3.1

首先，确保在 pom.xml 中使用 java 1.8

```
<maven.compiler.source>1.8</maven.compiler.source>
<maven.compiler.target>1.8</maven.compiler.target> 
```

然后在我使用的源代码中：（关键是内部部分）

```
// remove standalone=yes
marshaller.setProperty(Marshaller.JAXB_FRAGMENT, true);
marshaller.setProperty("com.sun.xml.internal.bind.xmlHeaders", "<?xml version=\"1.0\" encoding=\"UTF-8\"?>"); 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2020-03-20T12:28:54.717

如果你有`<?xml version="1.0" encoding="UTF-8" standalone="yes"?>`

但想要这个：`<?xml version="1.0" encoding="UTF-8"?>`

做就是了：

```
marshaller.setProperty(Marshaller.JAXB_FRAGMENT, Boolean.TRUE);
marshaller.setProperty("com.sun.xml.internal.bind.xmlHeaders", "<?xml version=\"1.0\" encoding=\"UTF-8\"?>"); 
```

# asp.net - 将实时 Web 应用程序迁移到新服务器的最佳实践？

> ID：277997
> 
> 赞同：2
> 
> 时间：2008-11-10T14:33:04.563
> 
> 标签：asp.net, iis, server-migration

我的任务是将包括数据库在内的许多 Web 应用程序移至新服务器，它们是 ASP.NET。我不是最初创建和设置这些的人，所以我必须尝试弄清楚我需要复制什么才能不破坏任何东西，所以客户不知道有什么东西被移动了。

有没有人对此有任何提示，或者知道任何自动化方法？

有什么软件可以帮助解决这个问题吗？

我知道网络应用程序发送电子邮件，所以我需要设置 SMTP 并连接到数据库，这样我也需要移动。我想我应该在晚上这样做并关闭服务器，这样我就可以将数据库移动到它的最新状态......

任何提示或技巧？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-10T14:39:40.367

这可能会有所帮助：[IIS 6.0 迁移工具](http://www.iis.net/downloads/default.aspx?tabid=34&g=6&i=1293)

> “Internet Information Services 6.0 迁移工具是一个命令行工具，它自动执行将 Web 应用程序从 IIS 4.0、IIS 5.0 或 IIS 6.0 迁移到 Internet Information Services (IIS) 6.0 和 Windows Server 2003 的全新安装所需的几个步骤.
> 
> 如果需要，该工具将配置数据、网站内容和应用程序设置传输到新的 IIS 6.0 服务器，或者可以使用复制功能仅移动应用程序设置。"

不过，我认为这对数据库迁移没有帮助。

[这是](http://technet.microsoft.com/en-us/library/cc776892.aspx)有关使用该工具的更多详细信息的链接。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-10T14:39:38.620

我可以建议在暂存环境中设置新服务器。允许业务用户在切换并上线之前验证暂存环境中的功能。一旦你准备好了，然后带来一份新的数据副本。就电子邮件而言……您应该可以使用 ASP.NET，但是一些经典的 ASP 程序需要 COM 组件才能发送电子邮件。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-10-08T07:48:55.017

我过去采取的路线是对 to 进行实时/当前副本（无论需要什么`$CURRENT_SERVER`）`$NEW_SERVER`。如果数据库没有移动，只需确保`$NEW_SERVER`可以到达`$DB_SERVER`，并且复制后它将继续运行。

然后更新 DNS 以指向`$NEW_SERVER`.

一段时间后（DNS 记录的 TTL 的 2-3 倍），删除旧服务器。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-10T16:53:32.860

我们刚刚经历了同样的事情——购买了一台新服务器，并且不得不将 ASP.NET 站点 + 数据库转移到新服务器上。我们在使用 IIS 迁移工具时遇到了问题，因此我们采用了“暂存环境”方法，正如伯克希尔的回答中所述，并取得了很大的成功。当所有问题都从暂存环境中清除后，您可以满怀信心地让它“活”起来。

需要注意的另一件事是，您必须浏览 ASP 和 VB/C# 代码以获取到数据库的任何硬键连接字符串。这些将不得不更改以引用数据库的新位置。

# unix - 如何使用 unix 的“find”命令来查找所有的 cpp 和 h 文件？

> ID：277999
> 
> 赞同：30
> 
> 时间：2008-11-10T14:35:02.967
> 
> 标签：unix, find

我知道要找到`.h`我需要使用的所有文件：

```
find . -name "*.h" 
```

但是如何找到所有的`.h`AND`.cpp`文件？

* * *

## 回答 #1

> 赞同：44
> 
> 时间：2008-11-10T14:35:40.593

```
find . -name \*.h -print -o -name \*.cpp -print 
```

或者

```
find . \( -name \*.h -o -name \*.cpp \) -print 
```

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-11-10T14:40:18.573

```
find -name "*.h" -or -name "*.cpp" 
```

（编辑以保护被解释为格式的星号）

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-11-10T15:39:25.863

[Paul Tomblin](https://stackoverflow.com/questions/277999/how-to-use-the-unix-find-command-to-find-all-the-cpp-and-h-files#278002) 已经提供了一个了不起的答案，但我想我看到了你所做的事情的模式。

有一天，您可能会使用 find 生成一个文件列表以使用 grep 进行处理，而对于此类任务，存在一种对用户更友好的工具，[Ack](http://petdance.com/ack/)

适用于任何支持 perl 的系统，并且在目录中递归搜索所有与 C++ 相关的文件以查找给定的字符串非常简单

```
ack "int\s+foo" --cpp 
```

`"--cpp"`默认匹配`.cpp .cc .cxx .m .hpp .hh .h .hxx`文件

（默认情况下它还会跳过存储库目录，因此不会匹配恰好看起来像其中的文件的文件。）

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2015-04-30T08:59:53.853

一个简短而清晰的方法`find`是：

```
find . -regex '.*\.\(cpp\|h\)' 
```

从手册页`-regex`：“这是整个路径上的匹配，而不是搜索。” 因此需要前缀 with`.*`以匹配`./dir1/dir2/...`文件名之前的路径开头。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2010-10-04T20:31:16.583

```
find . -regex ".*\.[cChH]\(pp\)?" -print 
```

这在cygwin中对我来说很好。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2014-08-07T05:19:54.593

您可以使用`find`以下简短形式：

```
find \( -name '*.cpp' -o -name '*.h' \) -print 
```

`-print`可以省略。`-o`当您想要查找多种类型的文件并执行相同的工作（例如计算 md5sum）时，仅在表达式之间使用特别有用。***********