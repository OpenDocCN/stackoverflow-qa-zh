# StackOverflow 问答 000743000-000743999

# .net - string.Trim() 会从文件名中删除 *valid* 字符吗？

> ID：743003
> 
> 赞同：4
> 
> 时间：2009-04-13T03:58:37.863
> 
> 标签：.net, filesystems, whitespace, filenames, invalid-characters

我正在创建一个类来存储文件名。为此，我需要确切知道哪些字符无效以及哪些字符*作为前导/尾随字符*无效。

Windows 资源管理器在命名文件时会自动修剪前导和尾随空白字符，因此在构造文件名实例时需要修剪相同的字符。

我考虑过使用 string.Trim()，但假设它修剪的默认字符集与操作系统的无效前导/尾随文件名字符完全一致是天真的。

[string.Trim() 的文档](http://msdn.microsoft.com/en-us/library/t97s7bs3.aspx)说它默认修剪以下字符：U+0009、U+000A、U+000B、U+000C、U+000D、U+0020、U+0085、U+00A0、U +1680, U+2000, U+2001, U+2002, U+2003, U+2004, U+2005, U+2006, U+2007, U+2008, U+2009, U+200A, U+200B , U+2028, U+2029, U+3000, U+FEFF

不幸的是，上述某些字符在文件中并非无效，因为它们不在 System.IO.Path.GetInvalidFileNameChars 返回的字符集中。

**然后我是否更正了 string.Trim() 可能会从文件名中删除 VALID 前导/尾随字符，从而损坏文件名？**

**Windows Vista 操作系统中文件名的无效前导/尾随字符到底是什么？** 我知道它们不一定与文件系统本身相同，因为操作系统可以在不同的文件系统上运行。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-13T04:01:01.917

文件名可以以空格开始/结束。修剪将消除它们。

文件名不能包含

```
/ \ : * ? " | < > 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-13T04:01:20.730

> 然后我是否更正了 string.Trim() 可能会从文件名中删除 VALID 前导/尾随字符，从而损坏文件名？

是的。在类 UNIX 系统上更是如此，其中“X”是一个有效的文件名并且不同于“x”

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-13T04:10:30.083

此代码运行并创建文件：

```
Imports System.IO
Module Module1

Sub Main()
    Dim fs As New FileStream("d:\temp\   file . foo ", FileMode.Create, _
       FileAccess.Write)
    'declaring a FileStream and creating a word document file named file with
    'access mode of writing
    Dim s As New StreamWriter(fs)
    'creating a new StreamWriter and passing the filestream object fs as argument
    s.BaseStream.Seek(0, SeekOrigin.End)
    'the seek method is used to move the cursor to next position to avoid text to be
    'overwritten
    s.WriteLine("This is an example of using file handling concepts in VB .NET.")
    s.WriteLine("This concept is interesting.")
    'writing text to the newly created file
    s.Close()
End Sub

End Module 
```

注意：使用上述代码创建的文件的实际名称似乎是“file . foo”。如果我在资源管理器中编辑文件名，则空间不存在，但是当我重新运行上面的代码时，它会替换文件。

注意：我从[http://www.startvbdotnet.com/files/default.aspx](http://www.startvbdotnet.com/files/default.aspx)获取代码并添加了空格

注意：我注意到 Vista 的资源管理器重命名不允许您在文件名之前或之后添加空格，因此您可以使用该方法制作“foo .txt”但不能制作“foo.txt”。

# multithreading - 所有事件驱动的框架都应该是单线程的吗？

> ID：743008
> 
> 赞同：10
> 
> 时间：2009-04-13T04:01:31.697
> 
> 标签：multithreading, oop, events

[http://weblogs.java.net/blog/kgh/archive/2004/10/multithreaded_t.html](http://weblogs.java.net/blog/kgh/archive/2004/10/multithreaded_t.html)认为多线程 GUI 框架是一个失败的梦想。非 GUI 框架呢？这个经验法则是否适用于所有事件驱动的框架？

以下是引起我注意的文章中的一句话：

> > 输入事件处理的问题在于它倾向于以与大多数 GUI 活动相反的方向运行。通常，GUI 操作从库抽象堆栈的顶部开始，然后“向下”运行。我在我的应用程序中操作一个由一些 GUI 对象表达的抽象概念，所以我从我的应用程序开始，调用高级 GUI 抽象，调用低级 GUI 抽象，调用丑陋的内脏工具包，然后进入操作系统。相反，输入事件从操作系统层开始，并逐渐“向上”分派到抽象层，直到它们到达我的应用程序代码。
> > 
> > 现在，由于我们使用抽象，我们自然会在每个抽象中单独进行锁定。不幸的是，我们遇到了经典的锁排序噩梦：我们有两种不同类型的活动想要以相反的顺序获取锁。所以僵局几乎是不可避免的。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-13T04:04:41.047

不。即使根据经验，它只是在说“很难让它们工作”。但是事件驱动框架非常类似于事件驱动模拟和其他各种东西。在 Javaworld 中它很难的事实不是关于多线程的事实，而是关于 Java 中可用的抽象。

在另一个环境中，比如 Erlang，它既非常自然，又非常健壮。

### 更新

听起来他仍然有错误的抽象。我看不出问题中存在任何导致锁定问题的内在因素。我想，关键在这里：

> 现在，由于我们使用抽象，我们自然会在每个抽象中单独进行锁定。不幸的是，我们遇到了经典的锁排序噩梦：我们有两种不同类型的活动想要以相反的顺序获取锁。所以僵局几乎是不可避免的。

那么为什么死锁几乎是不可避免的呢？因为有两种不同的活动正在进行，它们想要以相反的顺序获取锁。那是因为“我们自然会在每个抽象中单独进行锁定”。

换句话说，他选择了——或者环境为他选择了——不支持他需要的抽象。因此，他似乎声称，因此没有抽象会这样做。我觉得这没有说服力。我将从检查两件事开始：

*   “*自然*我们将在抽象中单独进行锁定”，并且
*   “我们正在发生想要以相反顺序获取锁的事件。”

根据我的经验，“自然 X”通常意味着“我还没有真正寻找其他选择”。而且我非常怀疑事件想要以相反的顺序获取锁；你得到一个锁，你做某事，然后你释放它。

关键是，他似乎在提出这样一个事实，即他发现很难提出一个可以作为定理工作的方案来说明没有方案*可以**工作*。

如果没有关于问题的更多细节，很难构建一个反例，但正如我上面所说，有很多系统的例子有事件发生，异步地，从内部流程和 GUI，管理拥有许多并发控制线程并且不会死锁。之所以想到 Erlang，是因为其中一类问题，即电话，正是 Erlang 被发明的原因，而事实上，这些问题正是Erlang 被发明的*原因*。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-13T05:52:45.407

我不得不说不，但有一点需要注意。围绕共享状态的事件驱动框架（例如 UI）*应该*是单线程的。以通知为中心的事件驱动框架，例如机械监控（例如让您知道管道中的压力何时过高），可以是单线程的，但可能更适合多线程。

构建一个多线程的 UI 框架当然是可以的，我自己也是这样做的。最后，我将其转换为单线程。部分原因确实属于查理所说的“这太难了”。问题在于，对于多线程 UI 框架，不仅*我*必须处理线程，而且任何使用 UI 的人都需要处理。内核当然是线程安全的，但是任何编写控件的人都必须这样*做*线程安全。没关系，在对 UI 进行多项更改时，您必须通知核心您正在这样做，这样您就不会获得部分更新。由于用户通常是一个非常慢的东西，因此任何性能提升实际上都可以忽略不计，并且如果需要特定情况下可以使用异步调用来解决。单线程实际上是这里合适的模型。

另一方面，在没有（或很少）共享状态的模型中，多线程模型非常有意义。没有理由让一个事件（反应堆着火）延迟 30 秒，因为您的查询（Bob 操作员刚刚打卡）超时，因为操作中的某些 yahoo 操作使 punch_card 表被锁定。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-13T04:07:39.403

我想知道有多少问题来自多线程不适合事件处理的事实，以及许多构建 GUI 的开发人员不精通多线程这一事实。

我倾向于支持后一种情况，并且也支持某些框架的笨拙。例如，我发现在 Eclipse 中编写 GUI 代码相当烦人，因为没有更方便的方法来处理繁重的逻辑和 GUI 代码。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-13T04:46:14.660

一般来说，是的，因为事件驱动框架类似于 Reactor 模式，它规定了一个等待事件的主循环（“事件循环”，然后为各种元素调用注册的回调。

这就是传统上定义事件驱动框架的方式。下面是关于 Erlang 进程如何与 VM 的事件循环相关联的一个很好的描述：

> Erlang 进程与 Erlang VM 的事件驱动网络 IO 核心紧密集成。进程可以“拥有”套接字并向套接字发送和接收消息。这提供了面向并发编程的优雅以及事件驱动 IO 的可扩展性（Erlang VM 在幕后使用 epoll/kqueue）。
> 
> [http://yarivsblog.com/articles/2008/05/18/erlang-vs-scala/](http://yarivsblog.com/articles/2008/05/18/erlang-vs-scala/)

更新：这里有一些有趣的笔记，当时对我影响很大。请特别注意锁和回调如何糟糕地交互。

> [http://home.pacbell.net/ouster/threads.pdf](http://home.pacbell.net/ouster/threads.pdf)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-13T06:22:15.990

是和否。

Event driven frameworks usually allow you to do things that usually require multiple threads with 1 thread. That's why they are usually single threaded.

However, it is not in any definition that an event driven framework cannot dispatch events to multiple threads.

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-14T04:49:44.833

This rule of thumb doesn't apply at all to non-GUI frameworks. See Welsh's SEDA architecture, see yield (code.google.com/p/yield) for a good python/c++ hybrid implemenation.

# iphone - 为 UITableViewController 子类覆盖哪个初始化程序

> ID：743010
> 
> 赞同：16
> 
> 时间：2009-04-13T04:04:16.103
> 
> 标签：iphone, objective-c, cocoa-touch, designated-initializer

我有一个`UITableViewController`实例化的子类，具体取决于它的使用位置、NIB 或通过代码。在这两种情况下，我都想在初始化方法中进行自定义。这是否意味着我需要同时实现`initWithNibName:bundle:` *and* `initWithCoder:`，并且每个方法都会调用其各自的超级初始化程序？

虽然我现在不需要这个，但如果我也希望能够用 实例化视图控制器`initWithStyle:`怎么办？然后我需要 3 种不同的 init 方法来复制相同的行为吗？

这似乎违反了整个指定的初始化程序约定，因为本质上会有 3 个单独的初始化程序，它们最终不会调用一个通用的 init 方法。或者有没有办法在支持 3 个不同的实例化路由的同时创建一个通用的指定初始化器？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-16T15:14:56.880

我的困惑是基于一个错误的信念，即每个类都应该有一个指定的初始值设定项。这不是真的，如果`UITableViewController`有 3 个指定的初始化程序（据我所知）：

1.  `initWithStyle:`本地声明
2.  `initWithNibName:bundle:`继承自`UIViewController`
3.  `initWithCoder:`从采用`NSCoding`协议

根据子类的实例化方式，您需要在子类中覆盖其中的一个***或多个。***就我而言，我必须实现#2 和#3，因为该类可以从 NIB 加载，或者通过参考 NIB 的代码实例化。（我想你很少会同时使用`initWithStyle:`一个`initWithNibName:bundle:`类。）

我发现 Apple 的*[Cocoa 编码指南](http://developer.apple.com/documentation/Cocoa/Conceptual/CodingGuidelines/Articles/FrameworkImpl.html)*很有帮助。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2010-02-11T07:35:10.930

在内部，

*   UITableViewController`-initWithStyle:`调用 super 的`-init`然后设置`_tableViewStyle`ivar。
*   UIViewController`-init`只需`-initWithNibName:bundle:`使用默认参数调用。
*   UITableViewController**不会**覆盖`-initWithNibName:bundle:`.

因此，如果您覆盖`-initWithNibName:bundle:`then`-initWithStyle:`也将采用更改。当然，为了安全起见（因为您不应该依赖实现细节），请覆盖它们。

`-initWithCoder:`（除非您取消/归档实例，否则无需覆盖。）

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-02-10T18:34:15.553

为了澄清，`initWithStyle:`作为`UITableViewController`文档中唯一发布的初始化程序，它是一个明确指定的初始化程序。

`initWithNibName:bundle:`继承自 UIViewController 并且是该类的指定初始化程序。因此，根据 Cocoa 指南，`UITableViewController` **必须**重写此方法（通过实现它）。但是，这并不能使它成为 的指定初始值设定项`UITableViewController`。

`initWithCoder:`正如您所指出的，它是来自`NSCoding`.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-13T06:19:52.707

实施：

```
- (void) viewDidLoad 
```

并在那里进行组件初始化。

它的优点是仅在实际请求视图时才进行初始化。

或者只是创建一个由所有初始化程序调用的单独设置方法。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-01-03T17:48:00.887

对上面提到的帖子的补充——initWithCoder：

如果您通过界面构建​​器将视图控制器添加到其父级（例如：如果视图控制器连接到界面构建器中的选项卡栏控制器），那么您需要覆盖–initWithCoder。

（-initWithNibName 只会在您以编程方式创建视图控制器时被调用。）

# c# - 在 Visual C++ 中创建的 dll 文件可以在 C# 中使用吗？

> ID：743012
> 
> 赞同：1
> 
> 时间：2009-04-13T04:05:15.073
> 
> 标签：c#, visual-studio, visual-c++, dll, interop

我正在通过动态链接库项目在 Visual C++ 中创建一个 dll 文件。我知道我可以在 C# 中通过对象浏览器导入这个 dll。我想知道我是否可以毫无问题地使用这些功能，因为我正在使用 2 种不同的语言进行编程。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-13T04:16:47.697

您的 C++ DLL 是用托管 C++ 编写的吗？如果是这样，那么您应该能够通过从 C# 项目中添加对它的引用来使用它。否则，您想研究[.NET Interop 主题](http://msdn.microsoft.com/en-us/library/ms177552(VS.80).aspx)以了解如何使用这两者。

# sql-server-express - SQL Management Studio Express - 项目和解决方案

> ID：743017
> 
> 赞同：0
> 
> 时间：2009-04-13T04:09:22.287
> 
> 标签：sql-server-express, ssms

我有 SQL Managment Studio Express，但请注意它没有用于解决方案和项目创建的附加组件。是否有下载来添加该功能，以便我可以对查询和连接进行分组？还是这种功能不适用于express？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-13T15:26:56.977

不，该功能在 Express 中不可用。如果您正在寻找免费软件产品来执行此操作，请查看适用于 SQL Server 的 Quest Toad，它提供免费版和测试版：

[http://www.toadsoft.com/toadsqlserver/toad_sqlserver.htm](http://www.toadsoft.com/toadsqlserver/toad_sqlserver.htm)

# javascript - 删除后输入仍然存在

> ID：743020
> 
> 赞同：1
> 
> 时间：2009-04-13T04:12:44.977
> 
> 标签：javascript, html

我使用javascript将文本输入附加到表单中，在我通过removeNode将其删除后，它消失了，document.forms [“form”].length = 0，但我仍然可以使用document.forms [“form”获取它的obj ]["inputname"] (不返回 null)

为什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-13T05:47:23.143

我认为您在使用 Firefox 时遇到了问题。在 IE 中，您的代码似乎可以正常工作。

要让 removeNode 在 IE 和 FF 中工作，你可以这样写

var objectToRemove = document.getElementByID("你要删除的对象");

var parentNode = objectToRemove .parentNode;

parentNode.removeChild (objectToRemove);

希望这可以帮助

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-13T07:27:52.043

无论如何，您必须使用 document.getElementById() 才能正确操作元素树。像 document.forms[] 这样的结构是非常古老的面向 IE 的。但某些浏览器支持向后兼容。

# windows - 许多多个文件与 IIS7 + Windows Server 2008 托管的少量较大文件

> ID：743027
> 
> 赞同：0
> 
> 时间：2009-04-13T04:19:20.873
> 
> 标签：windows, iis, iis-7, windows-server-2008

您能否指出 IIS 7 中文件托管的最佳实践。文件数量可能非常高 > 500,000，每个 2-10KB。

一个可能的问题是处理大量文件时的性能。我们可以拥有较少数量的大文件并拥有一个 HTTP 处理程序来处理请求，或者只拥有较小的文件并使用 IIS7 直接将它们作为静态文件提供服务。

您可以分享任何最佳实践/性能比较吗？你有什么建议吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-13T04:26:41.103

一个考虑因素是在一个目录中包含大量文件的性能影响 - 大多数文件系统并未针对在包含 1000000 个或更多文件的目录中查找一个文件的性能进行优化。通过将文件系统结构化为每个目录中只有几个文件，您可能会获得更好的性能。

# java - 如何获取 Java 程序的可执行文件？

> ID：743029
> 
> 赞同：2
> 
> 时间：2009-04-13T04:22:01.350
> 
> 标签：java, executable-jar

> **可能重复：**
> [如何将我的 java 程序转换为 .exe 文件？](https://stackoverflow.com/questions/147181/how-can-i-convert-my-java-program-to-an-exe-file)

我正在尝试将用 Java 6 编写的程序导出到 JAR 文件中。

我的项目包含一个来自 Internet 的 Java 库和一些 Java 源文件。当我创建 JAR 文件时，应该默认设置类路径，并且最终用户应该能够直接从命令提示符或其他来源运行项目。

如果可能的话，我的目标是将所有内容导出到 JAR 文件中。此外，程序输出应在命令提示符下给出。

如何以这种方式导出我的程序？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-13T04:29:25.530

您需要为此编写一个`META-INF/MANIFEST.MF`文件；该文件应该位于您正在分发的 jar 文件中（即，人们使用的 jar 文件`java -jar`）。这是我最近写的一个“项目”的例子：

```
Manifest-Version: 1.0
Ant-Version: Apache Ant 1.7.0
Created-By: 11.3-b02 (Sun Microsystems Inc.)
Main-Class: com.hedgee.simonsays.Main
Class-Path: lib/libthrift.jar 
```

要关心的主要字段是`Main-Class`（指定要查找您的`main`方法的类）和`Class-Path`（指定您正在使用的外部 jar 文件）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-13T04:26:17.797

您可以使用 Jsmooth [http://jsmooth.sourceforge.net/](http://jsmooth.sourceforge.net/)捆绑您的 java 代码以生成可执行文件。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-13T08:30:53.950

我对两种不同的方法有很好的经验：

1) 将 fatjar 插件与 eclipse 一起使用，创建一个包含所有需要嵌入的 jar 的单个 jar 文件（使用自定义类加载器）。这将创建一个可点击的 jar 文件（如果它是一个 GUI 程序）。如果您需要此 Jar 的控制台输出，请按照 Bhushan 的描述用 jsmooth 包装它。

2）使用Eclipse 3.5 Milestone 6中的“Export -> Runnable Jar”和“将依赖库复制到子文件夹”选项来创建一个普通的可运行jar，其中包含引用依赖jar文件的适当清单（放在子文件夹中） . 如果您想要一个不使用任何技巧的解决方案，这非常有效，但是编写脚本有点困难。

# sql - 在 Oracle PL SQL 中检索 xml 元素的值

> ID：743031
> 
> 赞同：6
> 
> 时间：2009-04-13T04:23:10.443
> 
> 标签：sql, xml, oracle, plsql

有人知道如何检索`<ZIPCODE>`和`<CITY>`使用 PL/SQL 的值吗？我在网上遵循了一个教程，但是，它可以检索元素名称，但不能检索它们的值。你们中的任何人都知道似乎是什么问题吗？我已经就此咨询过谷歌（互联网的秘密），但没有运气:(

```
<Zipcodes>
  <mappings Record="4">
    <STATE_ABBREVIATION>CA</STATE_ABBREVIATION>
    <ZIPCODE>94301</ZIPCODE>
    <CITY>Palo Alto</CITY>
  </mappings>
</Zipcodes> 
```

这是示例代码：

```
-- prints elements in a document
PROCEDURE printElements(doc DBMS_XMLDOM.DOMDocument) IS
    nl  DBMS_XMLDOM.DOMNodeList;
    n   DBMS_XMLDOM.DOMNode;
    len number;
BEGIN
    -- get all elements
    nl   := DBMS_XMLDOM.getElementsByTagName(doc, '*');

    len  := DBMS_XMLDOM.getLength(nl);

    -- loop through elements
    FOR i IN 0 .. len - 1 LOOP
        n := DBMS_XMLDOM.item(nl, i);

        testr := DBMS_XMLDOM.getNodeName(n) || ' ' || DBMS_XMLDOM.getNodeValue(n);

        DBMS_OUTPUT.PUT_LINE (testr);
    END LOOP;

    DBMS_OUTPUT.PUT_LINE ('');
END printElements; 
```

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-13T09:17:10.017

你需要换行

```
testr := DBMS_XMLDOM.getNodeName(n) || ' ' || DBMS_XMLDOM.getNodeValue(n); 
```

至

```
testr := DBMS_XMLDOM.getNodeName(n) || ' ' || DBMS_XMLDOM.getNodeValue(DBMS_XMLDOM.getFirstChild(n)); 
```

在 XML DOM 中，元素没有任何“价值”可言。元素节点包含作为子节点的文本节点，正是这些节点包含您想要的值。

编辑（回应 Tomalak 的评论）：我不知道 DBMS_XMLDOM 中有任何函数可以获取元素的所有子文本节点的组合值。如果这就是您所需要的，那么您可能需要使用类似以下函数的东西：

```
CREATE OR REPLACE FUNCTION f_get_text_content (
    p_node          DBMS_XMLDOM.DOMNode
) RETURN VARCHAR2
AS
  l_children        DBMS_XMLDOM.DOMNodeList;
  l_child           DBMS_XMLDOM.DOMNode;
  l_text_content    VARCHAR2(32767);
  l_length          INTEGER;
BEGIN
  l_children := DBMS_XMLDOM.GetChildNodes(p_node);
  l_length := DBMS_XMLDOM.GetLength(l_children);
  FOR i IN 0 .. l_length - 1 LOOP
    l_child := DBMS_XMLDOM.Item(l_children, i);
    IF DBMS_XMLDOM.GetNodeType(l_child) IN (DBMS_XMLDOM.TEXT_NODE, DBMS_XMLDOM.CDATA_SECTION_NODE) THEN
      l_text_content := l_text_content || DBMS_XMLDOM.GetNodeValue(l_child);
    END IF;
  END LOOP;
  RETURN l_text_content;
END f_get_text_content;
/ 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2016-10-13T15:11:24.077

这是如何从文档中检索所需值的简单说明：

```
declare
  vDOM      dbms_xmldom.DOMDocument;
  vNodes    dbms_xmldom.DOMNodeList;
  vXML      xmltype := xmltype('<Zipcodes>
  <mappings Record="4">
    <STATE_ABBREVIATION>CA</STATE_ABBREVIATION>
    <ZIPCODE>94301</ZIPCODE>
    <CITY>Palo Alto</CITY>
  </mappings>
</Zipcodes>');
begin
  -- create the dom document from our example xmltype
  vDOM := dbms_xmldom.newDOMDocument(vXML);
  -- find all text nodes in the dom document and return them into a node list
  vNodes := dbms_xslprocessor.selectNodes
              (n         => dbms_xmldom.makeNode(dbms_xmldom.getDocumentElement(vDOM))
              ,pattern   => '//*[self::ZIPCODE or self::CITY]/text()'
              ,namespace => null
              );
  -- iterate through the node list
  for i in 0 .. dbms_xmldom.getlength(vNodes) - 1 loop
    -- output the text value of each text node in the list
    dbms_output.put_line(dbms_xmldom.getNodeValue(dbms_xmldom.item(vNodes,i)));
  end loop;
  -- free up document resources
  dbms_xmldom.freeDocument(vDOM);       
end; 
```

上面的结果是请求的输出：

```
94301
Palo Alto 
```

将上面示例中的 xpath 模式替换为 pattern => '//text()' 会导致输出：

```
CA
94301
Palo Alto 
```

IE。文档中的所有文本。使用这种技术当然可以对这个主题进行许多变化。

# geometry - 单位球面上的最近邻，点分布大致均匀

> ID：743034
> 
> 赞同：6
> 
> 时间：2009-04-13T04:26:16.643
> 
> 标签：geometry, nearest-neighbor

我正在编写一个实现 SCVT（Spherical Centroidal Voronoi Tesselation）的程序。我从分布在单位球面上的一组点开始（我可以选择随机点或等面积螺旋）。会有几百到可能 64K 点。

然后，我需要生成大约数百万个随机样本点，为每个样本找到集合中最近的点，并使用它来计算该点的“权重”。（这个权重可能必须从另一个球形集合中查找，但是对于任何给定的算法运行，该集合将保持静态。）

然后我将原始点移动到计算点，并迭代该过程，大概 10 或 20 次。这将为我提供 Voronoi 瓷砖的中心以供后续使用。

稍后我将需要找到给定点的最近邻居，以查看用户单击了哪个图块。这在上述问题中很容易解决，并且无论如何都不需要超快。我需要提高效率的部分是单位球面上数百万个最近的邻居。任何指针？

哦，我使用的是 x、y、z 坐标，但这不是一成不变的。看起来它会简化事情。我也在使用我最熟悉的 C，但也不拘泥于那个选择。:)

我考虑过对样本点使用螺旋模式，因为这至少让我找到了最后一个点的邻居作为下一次搜索的良好起点。但如果我这样做，看起来它会使任何类型的树搜索变得无用。

编辑：[对不起，我以为我对标题和标签很清楚。我可以轻松生成随机点。问题是最近邻搜索。当所有点都在单位球面上时，什么是有效的算法？]

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-14T23:56:43.343

您的点均匀分布在球体上。因此，将它们转换为球坐标并离散化会很有意义。首先搜索 2D 网格会在恒定时间内将最近邻的选择范围缩小到球体的一小部分。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-14T09:59:57.363

您可能会发现将您的点组织成一个称为八叉树的数据结构对于有效搜索附近的点很有用。见[http://en.wikipedia.org/wiki/Octree](http://en.wikipedia.org/wiki/Octree)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-18T03:10:26.000

我设计了一条曲线（我确定我不是第一个），它沿着球体从一极到另一极螺旋。它与相邻绕组保持恒定距离（如果我做得对的话）。对于`z`（`-1`在南极到`+1`北极）：

```
n = a constant defining a given spiral
k = sqrt(n * pi)

r = sqrt(z^2)
theta = k * asin(z)
x = r * cos(theta)
y = r * sin(theta) 
```

它`k/2`围绕球体旋转，每个绕组`sqrt(4pi/n)`从相邻绕组开始，而斜率`dz/d(x,y)`为`1/k`。

无论如何，设置`k`为使绕组间的距离覆盖球体上最大的瓷砖。对于主集中的每个点，计算`theta`曲线上最近点的 ，并按这些数字索引点列表。对于给定的测试点，计算它（`theta`曲线上最近点的），并在索引中找到它。从那里向外（在两个方向）搜索到`theta`与您当前最近的邻居一样远的值。达到该限制后，如果到该邻居的距离小于从测试点到下一个相邻绕组的距离，则您找到了最近的邻居。如果不是，则跳过该`theta`值`2pi`并以相同的方式搜索该绕组。

批判？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-13T21:04:56.040

使用 KD Trie 是加快搜索速度的好方法。如果你能容忍一些错误，你也可以获得明显更好的性能。[ANN](http://www.cs.umd.edu/~mount/ANN/)库将在您选择的 ε 范围内为您提供结果。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-14T05:40:50.623

好的。NEARPT3 [http://www.ecse.rpi.edu/Homepages/wrf/Research/nearpt3/nearpt3.pdf](http://www.ecse.rpi.edu/Homepages/wrf/Research/nearpt3/nearpt3.pdf)算法可能对您的情况有所帮助。这一切都取决于您可以为您的 N 点使用多少空间。如果它是 O(N*logN) 那么有像 kD-tree 这样的算法（[http://www.inf.ed.ac.uk/teaching/courses/inf2b/learnnotes/inf2b-learn06-lec.pdf](http://www.inf.ed.ac.uk/teaching/courses/inf2b/learnnotes/inf2b-learn06-lec.pdf)）可以为 O(logN) 找到最近的点。在 64K 点 Nlog_2 N = 大约 10^6 的情况下，这很容易适合现代计算机的内存。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-13T05:42:26.273

这是关于邻居搜索的文章：[http](http://en.wikipedia.org/wiki/Nearest_neighbor_search) ://en.wikipedia.org/wiki/Nearest_neighbor_search 在我的理解中，您可以使用简单的算法遍历所有 Voronoi 中心并计算您的点和中心点之间的 3d 距离。

```
distance_2 = (x - x_0)^2 + (y - y_0)^2 + (z - z_0)^2 
```

其中 (x_0, y_0, z_0) 是您的兴趣点（点击），{(x, y, z)} 是 Voronoi 中心。最小的距离将为您提供最近的中心。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2014-02-08T21:32:22.910

另一种比创建四叉树更简单的可能性是使用**邻域矩阵**。

首先将所有点放入 2D 方阵中（通过将点转换为极坐标）。然后您可以运行完整或部分空间排序，因此点将在矩阵内变得有序。

Y（或 phi）小的点可以移动到矩阵的顶行，同样，Y 大的点会移动到矩阵的底行。具有小 X（或 theta）坐标的点也会发生同样的情况，这些点应该移动到左侧的列。并且对称地，具有大 X 值的点将进入右列。

完成空间排序后（有很多方法可以通过串行或并行算法实现这一点），您可以通过访问点 P 实际存储在邻域矩阵中的相邻单元来查找给定点 P 的最近点。

您可以在以下论文中阅读有关此想法的更多详细信息（您可以在线找到它的 PDF 副本）：*基于紧急行为的 GPU 上的超大规模人群模拟*。

排序步骤为您提供了有趣的选择。您可以只使用论文中描述的奇偶转置排序，它实现起来非常简单（即使在 CUDA 中也是如此）。如果你只运行一次，它会给你一个部分排序，如果你的矩阵是接近排序的，这可能已经很有用了。也就是说，如果您的点移动缓慢，它将为您节省大量计算。

如果你需要一个完整的排序，你可以多次运行这样的奇偶转置传递（如下面的维基百科页面所述）：

[http://en.wikipedia.org/wiki/Odd%E2%80%93even_sort](http://en.wikipedia.org/wiki/Odd%E2%80%93even_sort)

# c# - 我在 C# 中反转了图像

> ID：743037
> 
> 赞同：2
> 
> 时间：2009-04-13T04:26:58.217
> 
> 标签：c#, bitmap, flip

这是我将 byte[] 数组转换为图像的代码

```
unsafe
{
  //convert the UInt32[] into byte array and then assign the pointer to it
  fixed (byte* ptr = Misc.ConvertFromUInt32Array(image)) 
  {
    Bitmap bmp = new Bitmap(200,64,800,
      PixelFormat.Format32bppRgb,
      new IntPtr(ptr));
    bmp.Save("test.bmp");
  }
} 
```

我明白了：

[替代文字 http://img11.imageshack.us/img11/4853/testacr.png](http:////img11.imageshack.us/img11/4853/testacr.png)

代码中的问题在哪里，为什么会发生这种情况？怎样才能让它恢复正常？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-13T04:42:35.840

```
 bmp.RotateFlip(RotateFlipType.Rotate180FlipX); 
```

修复了问题:)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-13T04:31:27.130

嘿，看起来你发布的两张图片没有任何关系（除了有类似的混淆模式）。你发错文件了吗？

关于您看到的问题，我猜您看到的是 xy 轴原点的问题。普通图像和图形 API 使用一个稍微奇怪的轴，您在 y 轴“向下”计数，也就是说，point(0, 0) 位于屏幕的左上角，当您增加 y 时，您向下计数屏幕。因此，假设您在转换中犯了错误或这两个图像使用不同的 y 轴方案似乎是合理的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-13T04:52:34.880

为什么不将所有不安全的东西替换为：

```
private static Bitmap ConvertFromBytes(Byte[] imagebytes)
{
   return new Bitmap(new MemoryStream(imagebytes));
} 
```

# python - 试图将 python 嵌入到 tinycc 中，说 python 符号未定义

> ID：743044
> 
> 赞同：1
> 
> 时间：2009-04-13T04:32:36.003
> 
> 标签：python, c, compilation

在过去的半个小时里，我一直在寻找解决方案，而且一切都涉及到 GCC。我在这里所做的工作与 GCC 完全一致，但是我使用的是 TinyCC，这就是我感到困惑的地方。首先是代码：

```
#include <Python.h>
#include <stdio.h>
int main(int argc, char*argv[])
{
    Py_Initialize();
    PyRun_SimpleString("print(\"Hello World!\")");
    Py_Finalize();
    return 0;
} 
```

然后我像这样调用 tcc ：

```
tcc -o tinypyembed.exe tiny.c -IC:\Python26\include -LC:\Python26\libs -lpython26 
```

然后它变成一个大胖子并吐出来

```
tcc: undefined symbol 'Py_Initialize'
tcc: undefined symbol 'PyRun_SimpleStringFlags'
tcc: undefined symbol 'Py_Finalize' 
```

我完全不知所措，如果有人知道发生了什么，我真的很感激。

在请朋友尝试后，我发现这实际上是一个 Windows 问题。愿这留在这里作为对任何可能在 Windows 上尝试使用 python 的 tinycc 的人的警告。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-13T06:57:54.143

您是否使用过为 Python DLL`tiny_impdef.exe`创建文件？`.def`

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-09-22T13:04:32.137

适用于 Windows 的完整解决方案：

1.  tiny_impdef 根据 bk1e 的建议

    `tiny_impdef.exe c:\WINDOWS\system32\python25.dll`

2.  将 python25.def（或 python26.def）添加到编译列表

    `tcc tiny.c python25.def -IC:\Python25\include -LC:\Python25\libs -lpython25`

    （对于 Python2.6 将 25 替换为 26）

# java - 从自定义类获取弹簧配置值

> ID：743051
> 
> 赞同：1
> 
> 时间：2009-04-13T04:38:06.880
> 
> 标签：java, spring, configuration

我正在考虑使用 Spring 来组装我的应用程序的组件，但是我遇到了一个问题。我们的应用程序使用对 VM 来说是全局的配置存储库，并且与系统属性类似（但不精确）。

此配置 API 的访问方式如下：

```
Configuration.getDb ().get ("some_property_name") 
```

有没有办法在 Spring xml bean 文件中使用这个全局配置中的值？ `getDb`可能会根据配置库的当前状态（它具有上下文）返回不同的值，但我愿意声明 Spring 配置将在应用程序上下文初始化时完全加载。不过，更灵活的东西会很棒。

鉴于我是 Spring 新手，代码示例将使我的生活变得更轻松。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-13T04:59:50.930

您可以这样做，尽管这不是处理配置数据的建议方法。请参阅Spring 参考文档的[3.7 容器扩展点](http://static.springframework.org/spring/docs/2.5.x/reference/beans.html#beans-factory-extension)。

基本上，您将希望创建一个自定义 BeanFactoryPostProcessor 实现，它将替换如下表达式：

```
${some_property_name} 
```

使用基于回调的适当值。

以 PropertyPlaceholderConfigurer 的实现为起点。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-17T14:51:25.357

为了扩展 cletus 的建议，我想说您想要一个 PropertyPlaceholderConfigurer 的自定义子类，并覆盖 resolvePlaceholder() 方法，该方法将调用您的 Configuration.getDb() 代码。如果您无法解析该值，则委托回超类。

例如：

```
public class MyPlaceholderConfigurer extends PropertyPlaceholderConfigurer {
    @Override
    protected String resolvePlaceholder(String placeholder, Properties props) {
        String value = Configuration.getDb().get(placeholder)
        if (value == null) {
            value = super.resolvePlaceholder(placeholder, props);
        }
        return value;
    }
} 
```

然后只需在您的应用程序上下文中定义一个 MyPlaceholderConfigurer 类型的 bean，spring 将自动咨询您的类以解析占位符值。

如果您的 Configuration.getDb() 组件无法解析该值，则委托回超类允许 spring 将值作为系统属性查找。或者，您可以将属性文件注入 bean，它也可以检查它。

阅读有关 PropertyPlaceholderConfigurer 基本用法的参考文档，了解它的工作原理。它非常灵活。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-30T19:59:12.547

您可以完全在配置中执行此操作（我并不是说这真的很漂亮；）：

```
<bean id="database" class="com.acme.Configuration" factory-method="getDb" />

<bean class="com.acme.YourHost">
  <property name="yourProperty">
    <bean factory-bean="database" factory-method="get">
      <constructor-arg value="some_property_name" />
    </bean>
  </property>
</bean> 
```

很高兴 Spring 3.0 将包含用于此类情况的表达式语言（请参阅[博客文章](http://blog.springsource.com/2008/12/05/spring-framework-30-m1-released/)）:)。

# jquery - 如何在jquery中获取单选按钮列表的选定值？

> ID：743052
> 
> 赞同：37
> 
> 时间：2009-04-13T04:39:51.090
> 
> 标签：jquery, html.radiobuttonlist

我有以 id 作为值的单选按钮列表，我想在 jquery 函数中访问选定的 id。

* * *

## 回答 #1

> 赞同：79
> 
> 时间：2009-04-13T04:59:50.480

如果您的 HTML 如下所示：

```
<input type='radio' name='choices' value='1'>
<input type='radio' name='choices' value='2'>
<input type='radio' name='choices' value='3'>
<input type='radio' name='choices' value='4'>
<input type='radio' name='choices' value='5'> 
```

您将通过以下方式获得选定的单选值：

```
$("input:radio[name='choices']:checked").val(); 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2013-08-26T08:50:05.470

它将在按钮单击时获取单选按钮的选定值。
前列表

```
$("#btn").click(function() {
   $('input[type="radio"]:checked').val();
}); 
```

# vim - 如何使 %（跳转到匹配的括号）键忽略 Vim 中的注释代码

> ID：743053
> 
> 赞同：4
> 
> 时间：2009-04-13T04:41:28.573
> 
> 标签：vim

```
1  #include <stdio.h>
2  int main(int argc, char* argv[]) {
3    int i=10;
4  /* } */
5    return 0;
6  } 
```

如果光标在第 2 行下方`{`并且我按下`%`键，则光标在第 4 行显示匹配的右大括号（已被注释掉），而不是在第 6 行显示匹配的右大括号。

有什么解决方法吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-13T09:20:06.110

你想要[`matchit`](http://www.vim.org/scripts/script.php?script_id=39)插件。它以多种方式扩展了该`%`命令，包括跳过注释。包含在 Vim 中，但默认不启用。

从它的文档：

> 默认情况下，注释和字符串中的单词会被忽略，除非当您键入“%”时光标位于注释或字符串中。

我也刚刚尝试了您的示例，并且效果很好。

# c++ - 将迭代器转换为指针？

> ID：743055
> 
> 赞同：61
> 
> 时间：2009-04-13T04:41:45.420
> 
> 标签：c++, stl, pointers, vector, iterator

我有一个`std::vector`元素`n`。现在我需要将一个指针传递给一个向量，该向量具有`n-1`函数的最后一个元素。

例如，我的`vector<int> foo`包含`(5,2,6,87,251)`. 一个函数需要`vector<int>*`，我想将一个指针传递给`(2,6,87,251)`.

我可以（安全地）获取迭代器`++foo.begin()`，将其转换为指针并将其传递给函数吗？还是使用`&foo[1]`？

**更新：**人们建议我将函数更改为采用迭代器而不是指针。在我的情况下这似乎是不可能的，因为我提到的`find`功能是`unordered_set<std::vector*>`. 那么在这种情况下，是否将`n-1`元素复制`foo`到新向量中并`find`使用指向该唯一选项的指针进行调用？非常低效！就像画家 Shlemiel 一样，特别是因为我必须查询许多子集： last `n-1`、 then`n-2`等元素并查看它们是否在`unordered_set`.

* * *

## 回答 #1

> 赞同：116
> 
> 时间：2010-01-29T06:36:05.487

在这里，获取对迭代器使用的对应指针的引用：

例子：

```
string my_str= "hello world";

string::iterator it(my_str.begin());

char* pointer_inside_buffer=&(*it); //<-- 
```

[注意运算符 * 返回一个**引用**，因此在引用上执行 & 将为您提供地址]。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-04-13T05:16:18.583

> 在我的情况下这似乎是不可能的，因为我提到的功能是`unordered_set<std::vector*>`.

您是否使用自定义哈希/谓词函数对象？如果不是，那么您必须将`unordered_set<std::vector<int>*>::find()`指针传递给您要查找的确切向量。指向具有相同内容的另一个向量的指针将不起作用。至少可以说，这对于查找不是很有用。

使用`unordered_set<std::vector<int> >`会更好，因为这样您就可以按值执行查找。我认为这还需要一个自定义散列函数对象，因为`hash`据我所知，它并没有专门针对`vector<int>`.

无论哪种方式，指向向量中间的指针本身都不是向量，正如其他人所解释的那样。如果不复制其内容，则无法将迭代器转换为指向向量的指针。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-04-13T04:47:21.990

如果可以，更好的选择可能是更改函数以将迭代器带到元素或全新的向量（如果它不修改）。

虽然您可以对数组执行此类操作，因为您知道它们是如何存储的，但对向量执行相同操作可能不是一个好主意。`&foo[1]`没有类型`vector<int>*`。

此外，虽然 STL 实现可以在线获得，但尝试依赖抽象的内部结构通常是有风险的。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-13T04:47:23.443

您的功能不应该使用`vector<int>*`; 它应该采取`vector<int>::iterator`或`vector<int>::const_iterator`酌情。然后，只需传入`foo.begin() + 1`.

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-04-16T20:20:30.987

向量是对其元素拥有完全所有权的容器。一个向量不能包含另一个向量的部分视图，即使是 const 视图。这就是这里的根本原因。

如果需要，请创建自己的容器，该容器具有对数据的weak_ptr 视图，或查看范围。一对迭代器（即使是指针也可以很好地作为向量中的迭代器），或者更好的是 boost::iterator_range，它们可以非常无缝地工作。

这取决于代码的模板性。如果您需要在 cpp 中隐藏代码，请使用 std::pair。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-04-13T12:48:23.643

你的问题的直接答案是肯定的。如果 foo 是一个向量，你可以这样做：&foo[1]。

然而，这只适用于向量，因为标准规定向量通过使用连续内存来实现存储。

但是您仍然可以（并且可能应该）传递迭代器而不是原始指针，因为它更具表现力。传递迭代器不会复制向量。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-13T06:20:59.490

> 例如，我的`vector<int> foo`包含 (5,2,6,87,251)。一个函数需要`vector<int>*`，我想传递一个指向 (2,6,87,251) 的指针。

指向 a`vector<int>`的指针与指向向量元素的指针完全不同。

为了做到这一点，您需要创建一个新`vector<int>`的，其中仅包含您希望在其中传递指针的元素。就像是：

```
 vector<int> tempVector( foo.begin()+1, foo.end());

 // now you can pass &tempVector to your function 
```

但是，如果您的函数需要一个指向int*数组*的指针，那么您可以传递`&foo[1]`.

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2011-06-09T20:08:09.653

使用[`vector::front`](http://www.cplusplus.com/reference/stl/vector/front/)，它应该是最便携的解决方案。当我与需要 char ptr 的固定 API 交互时，我使用了它。例子：

```
void funcThatTakesCharPtr(char* start, size_t size);

...

void myFunc(vector<char>& myVec)
{
    // Get a pointer to the front element of my vector:
    char* myDataPtr = &(myVec.front());

    // Pass that pointer to my external API:
    funcThatTakesCharPtr(myDataPtr, myVec.size());
} 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-13T04:44:55.537

如果您的函数确实需要`vector<int> *`（指向向量的指针），那么您应该传递`&foo`，因为这将是指向向量的指针。显然这不会简单地解决您的问题，但您不能直接将迭代器转换为向量，因为迭代器地址处的内存不会直接寻址有效向量。

您可以通过调用[向量构造函数](http://www.sgi.com/tech/stl/Vector.html)来构造一个新向量：

```
template <class InputIterator> vector(InputIterator, InputIterator) 
```

这通过复制两个迭代器之间的元素来构造一个新向量。您将大致像这样使用它：

```
bar(std::vector<int>(foo.begin()+1, foo.end()); 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-04-14T08:53:19.537

我还没有对此进行测试，但是您可以使用一组迭代器来代替吗？每个迭代器对将代表序列向量的开始和结束迭代器。例如：

```
typedef std::vector<int> Seq;
typedef std::pair<Seq::const_iterator, Seq::const_iterator> SeqRange;

bool operator< (const SeqRange& lhs, const SeqRange& rhs)
{
    Seq::const_iterator lhsNext = lhs.first;
    Seq::const_iterator rhsNext = rhs.first;

    while (lhsNext != lhs.second && rhsNext != rhs.second)
        if (*lhsNext < *rhsNext)
            return true;
        else if (*lhsNext > *rhsNext)
            return false;

    return false;
}

typedef std::set<SeqRange, std::less<SeqRange> > SeqSet;

Seq sequences;

void test (const SeqSet& seqSet, const SeqRange& seq)
{
    bool find = seqSet.find (seq) != seqSet.end ();
    bool find2 = seqSet.find (SeqRange (seq.first + 1, seq.second)) != seqSet.end ();
} 
```

显然，向量必须像以前一样保存在其他地方。此外，如果修改了序列向量，则必须删除并重新添加其在集合中的条目，因为迭代器可能已更改。

乔恩

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2011-09-25T15:08:59.273

Vector 是一个模板类，将类的内容转换为指针是不安全的：您不能继承 vector 类来添加这个新功能。并且更改函数参数实际上是一个更好的主意。Jst 创建另一个 int 向量 temp_foo (foo.begin[X],foo.end()); 并将这个向量传递给你的函数

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2017-08-29T19:07:41.243

将迭代器转换为指针的安全版本（无论含义如何，这意味着什么）并且安全我的意思是不用担心必须取消引用迭代器并由于`end()`/其他情况导致可能的异常/错误

```
#include <iostream>
#include <vector>
#include <string.h>

int main()
{
    std::vector<int> vec;

    char itPtr[25];
    long long itPtrDec;

    std::vector<int>::iterator it = vec.begin();
    memset(&itPtr, 0, 25);
    sprintf(itPtr, "%llu", it);
    itPtrDec = atoll(itPtr);
    printf("it = 0x%X\n", itPtrDec);

    vec.push_back(123);
    it = vec.begin();
    memset(&itPtr, 0, 25);
    sprintf(itPtr, "%llu", it);
    itPtrDec = atoll(itPtr);
    printf("it = 0x%X\n", itPtrDec);
} 
```

会打印出类似的东西

> 它= 0x0
> 
> 它= 0x2202E10

这是一种令人难以置信的hacky方式，但是如果您需要它，它就可以完成工作。您将收到一些编译器警告，如果真的困扰您，可以使用`#pragma`

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2021-04-04T01:52:28.657

```
std::vector<int> v;
  :
auto it=v.end();
auto ptr=v.data()+std::distance(v.begin(),it); 
```

# .net - dotNet 2.0 中哪种 FIPS 兼容算法更好？

> ID：743058
> 
> 赞同：0
> 
> 时间：2009-04-13T04:43:49.707
> 
> 标签：.net, algorithm, .net-2.0, cryptography

我使用 Rijndael 算法来加密/解密我的数据。但它不兼容 FIPS。我想把它换成另一个。你能给我一个建议，哪个更好？更好的意思是：

1.  兼容 FIPS
2.  安全级别高
3.  该算法应该来自微软提供的dotnet **2.0框架。**

谢谢

-詹姆博

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-13T06:24:21.523

您可以使用 AES 256，许多供应商都使用它并获得了 FIPS 认证。
问题是仅仅使用“适当的”加密算法来符合 FIPS 是不够的，您需要让您的系统接受 NIST 的测试。

编辑：[有人已经对所有 .NET 2.0 和 3.5](http://icumove.spaces.live.com/blog/cns!FB93073C6534B681!443.entry)提供程序进行了测试，以查看它们是否符合 FIPS。

长话短说：

在 .NET 2.0 下，支持以下内容：
DESCryptoServiceProvider
DSACryptoServiceProvider
RSACryptoServiceProvider
TripleDESCryptoServiceProvider

# java - JAVA - 简单服务器查看客户端的困难

> ID：743066
> 
> 赞同：1
> 
> 时间：2009-04-13T04:51:57.067
> 
> 标签：java, networking, sockets, tcp

我正在尝试制作一个通过 TCP 网络的简单游戏。

服务器在 Server.java 中执行类似的操作来检查连接：

```
try
{
    server = new ServerSocket(port);
    System.out.println("Server started on port " + port);

    while (true)
    {
        socket = server.accept();
        System.out.println("A new player has joined the server.");
        new Server(socket).start();
    }
} 
```

并在 Player.java 中创建一个新客户端：

```
socket = new Socket(hostname, port); 
```

现在，这一切正常，但我需要服务器将 Player 的实例添加到数组列表中，并能够向所有这些实例发送某些数据。它们都有主要方法，因此一台计算机可以只运行服务器，并通过运行 Player.java 让其他 4 台计算机连接到它。如果 Player 所做的只是创建一个新套接字，那么服务器应该如何与每个 Player 交互？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-13T04:56:56.383

`server.accept()`方法返回一个对象`Socket`。`Socket`类有一个方法`getOutputStream()`，你可以使用这个流来发送消息。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-13T04:58:04.197

我不确定我是否理解这个问题。

对 accept 的调用将为每个连接的客户端（通常表示客户端地址和端口）产生不同的返回值，因此您需要存储它们中的每一个。然后您可以通过套接字进行交互，Sun[在其教程中有一个很好的示例](http://java.sun.com/docs/books/tutorial/networking/sockets/clientServer.html)：

话虽如此，省去很多麻烦，并考虑一下您期望从游戏中获得的性能。[如果您使用 JMS 和 ActiveMQ](http://java.sun.com/products/jms/tutorial/)进行通信而不是自己搞乱套接字，那么您可以为自己省去很多麻烦并轻松增加可靠性和可伸缩性。

花时间编写游戏，而不是进行低级套接字编程，除非您正在努力学习。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-13T04:56:02.203

试试这个：

```
Server client = new Server(socket);
clients.add(client);
client.start(); 
```

哪里`clients`有类型`List<Server>`。然后，向您的类添加一个`sendMessage`方法（或其他方法） 。`Server`然后：

```
for (Server client : clients) {
    client.sendMessage("...");
} 
```

希望这可以帮助！`client`（顺便说一句，我调用变量和有一个明显的原因`clients`。它们实际上是传入客户端的抽象，而不是服务器本身，即使里面的代码`Server`实际上是用于与所述客户端交互的服务器。）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-13T21:07:18.827

让我根据我对他的问题的理解做一些名称重构。

将现有的 Server.java 重命名为 Player.java

```
Player player = new Player(socket);
players.add(player); // server can use this collection for group notification
.....

class Player implements Runnable {

   Player(Socket socket) {
        this.socket = socket;
        new Thread(this).start(); // later you may avoid it by using a threadpool executor. 
   }

   public void run() {
        while(running) {
            // read and write data from client machines.
            // use wait() appropriately
        }
   }

} 
```

如果服务器想要通知所有玩家，它可以调用玩家对象上的一个方法，该方法进一步完成向客户端发送数据所需的工作。

最后将现有的 Player.java 重命名为 GameLauncher.java。

在完成这个简单的“重命名”重构之后，您可能会获得更多的把握。

# asp.net-mvc - 有什么比 ASP.NET MVC 中的隐藏表单域更安全的吗？

> ID：743068
> 
> 赞同：22
> 
> 时间：2009-04-13T04:55:47.587
> 
> 标签：asp.net-mvc

在 ASP.NET MVC（默认路由）中，我想使用这样的 URL 来返回带有表单的视图来编辑客户：

```
/Customers/Edit/5 
```

我需要使用`CustomerId=5`，但我不想允许客户更改它。现在我使用以下方法隐藏 id：

```
<%= Html.Hidden("CustomerId") %> 
```

这完成了我想要的，但我的印象是隐藏的表单变量不安全，可以由最终用户操作。

那么，允许客户编辑他们的信息而不是他们的 ID 的最佳方式是什么？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2010-03-08T02:47:28.140

[我的解决方案是使用Steven Sanderson 的 ASP.NET MVC book](https://rads.stackoverflow.com/amzn/click/com/1430210079)中的防篡改代码。这个想法是您创建要防篡改的任何隐藏表单字段的哈希：

```
<%= Html.Hidden("CustomerId") %>
<%= Html.Hidden("CustomerIdHash") %> 
```

提交表单后，Steven 的代码会计算 CustomerId 的另一个散列并确保它等于 CustomerIdHash。如果是这样，则没有发生篡改。这是很棒的代码，物有所值。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-04-13T05:43:31.653

在显示相应视图之前检查控制器操作 (/Customers/Edit) 中的权限。请注意，这里的问题根本不在于您的隐藏字段：用户可以在他的浏览器中输入“ [http://yoursite.com/Customers/Edit/10 ”。](http://yoursite.com/Customers/Edit/10)因此，您必须检查您的操作是否真的允许用户编辑请求的客户的详细信息，无论他如何调用操作。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-04-13T05:02:57.150

您不会在浏览器端做任何真正的安全措施。您可以将客户 ID 放在查询字符串中，但服务器应验证他们是否真的被允许编辑该客户。如果不是，则返回错误。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2010-03-06T15:34:02.520

我遇到了同样的问题，我相信解决方案涉及使用代理键。在我有一个 ID 列的每个表中，我还添加了一个 Key 列，它是一个 Guid（SQL 服务器中的唯一标识符）。现在，在进行连接或任何内部逻辑时，我使用 ID，但控制器都使用密钥。由于它是 Guid，因此很难猜出另一张唱片的 Guid 是什么。

或者（或除上述之外）您可以根据[本文加密隐藏字段](http://www.heartysoft.com/post/2010/02/25/Encrypted-Hidden-Inputs-in-ASPNET-MVC.aspx)

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2010-09-24T13:22:16.720

防篡改隐藏字段都很好，但这仍然是通过默默无闻的安全性。最好通过保护控制器和操作来保护网站，更具体地说是 MVC。然后用户可以篡改他们想要的所有东西，他们将无处可去。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-13T16:17:15.560

有两个方面。我不确定你直接问的是哪个，但它们都很重要：

*   对于任何给定用户，可能不允许他们编辑所有客户。因此，正如 Dmitry 所建议的，您对表单帖子的控制器操作需要查看他们尝试编辑的客户，并验证登录用户实际上是否被允许编辑该客户。您可能还想在首先生成编辑表单的控制器操作中进行类似的检查，如果不允许他们编辑请求的客户，甚至不让他们进入表单。
*   对于给定用户和给定客户，您可能不希望用户能够更改客户 ID。如果您在 POST 控制器操作中使用 UpdateModel 方法，则需要使用属性白名单参数并排除 ID 属性，以便用户不会更改 ID。即使他们更改了隐藏字段的值，UpdateModel 也会通过白名单忽略更改的值。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2018-06-27T11:44:54.910

我有同样的担心，我的解决方案是使用加密。您可以在服务器端加密 CustomerId 值并将其作为查询字符串或隐藏字段发送，以便用户无法更改它，您可以随时解密它

# wpf - 一般来说，什么是 WPF 面板和布局的好指南？

> ID：743070
> 
> 赞同：7
> 
> 时间：2009-04-13T04:56:42.763
> 
> 标签：wpf, layout, panel

是否有关于从 System.Windows.Controls.Panel 继承的控件的各种行为的简明指南？或者只是一般的 WPF 布局指南？

特别是，我对面板如何处理宽度或高度设置为“自动”且水平或垂直对齐设置为“拉伸”的子对象感兴趣。一些布局使对象填充其容器的大小，而另一些布局只是使它们根据自己的内容调整大小。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-13T05:08:47.400

请参阅[http://msdn.microsoft.com/en-us/library/ms754152.aspx](http://msdn.microsoft.com/en-us/library/ms754152.aspx)开始...听起来您可能对“用户界面面板”部分中的表格特别感兴趣。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-13T05:09:33.840

我建议首先查看有关面板和[此示例的](http://msdn.microsoft.com/en-us/library/ms754152.aspx#Panels_custom_panel_elements)[MSDN 条目](http://msdn.microsoft.com/en-us/library/ms754152.aspx)。MeasureOverride 和 ArrangeOverride 方法处理所有与布局相关的逻辑。

# c# - 我可以使用密码从文件夹下载文件吗？

> ID：743076
> 
> 赞同：0
> 
> 时间：2009-04-13T05:00:06.920
> 
> 标签：c#, .net, winforms

t获得密码进入，这个文件夹获得密码（当然我插入密码）因为它拒绝访问并且未经许可被人取消所以我正在寻找如何使用C＃从该文件夹下载文件。在我尝试下载文件但 Visual Studio 出现错误之前：“访问被拒绝”！您有什么建议如何从带有密码的文件夹中下载文件或不可能？非常感谢！

很好的问候。

编辑：这是我用来从文件夹下载文件的代码片段

```
 private List<string> GetFolder(string Folder)
    {

        DirectoryInfo dir = new DirectoryInfo(Folder);
        FileInfo[] files = dir.GetFiles("*.mp3",SearchOption.AllDirectories);

        List<string> str = new List<string>();

        foreach (FileInfo file in files)
        {
            str.Add(file.FullName);

        }
        return  str;

    }

 private void Form1_Load(object sender, EventArgs e)
    {
GetFolder(@"D:\\Music\\")
} 
```

抱歉，我之前忘记添加代码。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-13T05:04:38.923

如果您使用 URL 下载文件，您可以在 URL 中指定用户名和密码：`http://user:pass@host/path`

显然，如果您的用户名或（更有可能）密码包含有趣的字符，则需要对这些字符进行适当的 %XX 编码。

# iphone - 使用 SQLite 插入记录

> ID：743081
> 
> 赞同：0
> 
> 时间：2009-04-13T05:04:20.920
> 
> 标签：iphone, objective-c, sqlite

“插入”的 SQLite 语句是什么？

我努力了

```
insert into table1 values(field1,field2) values (?,?) 
```

但这会在语句中返回错误——我该怎么做？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-13T05:10:32.607

插入语句的正确语法在[这里](http://en.wikipedia.org/wiki/Insert_(SQL))：

```
INSERT INTO table (column1, [column2, ... ]) VALUES (value1, [value2, ...]) 
```

请注意，您已将`VALUES`关键字放在列名列表之前。

# asp.net - ASP.NET - 动态创建的按钮

> ID：743083
> 
> 赞同：1
> 
> 时间：2009-04-13T05:04:54.040
> 
> 标签：asp.net

我在我的网络表单中添加了一个动态创建的按钮。但它的点击事件不起作用。谁能解释一下为什么？

这是我的代码：

```
 Button save = new Button();
    save.ID = "btnSave";
    save.Text = "Save";
    save.Click += new System.EventHandler(this.Save_Click);
    Webform.Controls.Add(save);

protected void Save_Click(object sender, EventArgs e)
{

    Response.Redirect("Default.aspx");
} 
```

它本身又回到了同一页面。它不会重定向到 Default.aspx。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-13T05:33:46.887

您的代码示例不足以进行诊断，但我会试一试。

您在页面生命周期的哪个时间点将按钮添加到页面？如果您在 PreRender 中执行此操作，这就是它不起作用的原因。您应该在初始化期间执行此操作。

更新：

您无法在页面生命周期的 Init 阶段之后动态创建控件并使其正常工作，除非您每次都以相同的方式创建它。这是因为生命周期如下所示：

初始化 -> 加载 ViewState -> 页面加载 -> 事件处理程序 -> 预渲染。

您正在创建一个按钮并在倒数第二个阶段为其提供事件处理程序。这意味着该按钮永远不会注册以将其 ViewState 与页面一起保存，因此该按钮的所有状态在单击时都不会恢复 - 这意味着您分配的事件处理程序消失得无影无踪，并且永远不会被调用。

我的建议是在页面上正常创建保存按钮（不是动态的），然后简单地将其设置为 Visible="False"。然后，在第一个按钮的 Click 处理程序上，只需设置保存按钮 Visible="true"。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-13T05:36:20.827

您能否对此进行调试并确定代码是否甚至到达了单击事件，或者您的重定向是否存在问题？Womp是正确的，在Page_Init中绑定事件。

# opengl - 在 OpenGL / Glut 中创建一个 Chrome 立方体？

> ID：743085
> 
> 赞同：3
> 
> 时间：2009-04-13T05:07:42.037
> 
> 标签：opengl, glut, cube

我正在尝试在 GLUT / OpenGL 中制作一个镀铬立方体，但我不确定该怎么做。

我在教科书中查找了“材料表”，其中显示“Chrome”为：环境：（0.25、0.25、0.25）、漫反射：（0.4、0.4、0.4）和镜面反射：（0.774597,0.774597,0.774597）。

我的问题是，如何创建一个简单的立方体并在 Glut/OpenGL 中应用这种材质/纹理？

我是否使用“glutSolidCube()”？如果是这样，我该如何应用镀铬纹理呢？

任何 GLUT/OpenGL 的人都可以指出我正确的方向吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-13T05:29:59.190

这应该和之前调用一样[`glMaterialfv()`](http://www.opengl.org/sdk/docs/man/xhtml/glMaterial.xml)简单[`glutSolidCube()`](http://openglut.sourceforge.net/group__geometry.html#ga1)。

我从学校开始就没有做过 OpenGL，但这里有一些来自一个旧项目的显示循环代码，它使用了一个应该让你走上正轨的球体：

```
_Ambient[CHROME][0] = 0.25f;
_Ambient[CHROME][1] = 0.25f;
_Ambient[CHROME][2] = 0.25f;
_Ambient[CHROME][3] = 1.0f;
_Diffuse[CHROME][0] = 0.4f;
_Diffuse[CHROME][1] = 0.4f;
_Diffuse[CHROME][2] = 0.4f;
_Diffuse[CHROME][3] = 1.0f;
_Specular[CHROME][0] = 0.774597f;
_Specular[CHROME][1] = 0.774597f;
_Specular[CHROME][2] = 0.774597f;
_Specular[CHROME][3] = 1.0f;
_Shininess[CHROME] = 76.8f;

void Display()
{
  glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);

  glPushMatrix();
    glMaterialfv(GL_FRONT_AND_BACK, GL_AMBIENT, _Ambient[CHROME]);
    glMaterialfv(GL_FRONT_AND_BACK, GL_DIFFUSE, _Diffuse[CHROME]);
    glMaterialfv(GL_FRONT_AND_BACK, GL_SPECULAR, _Specular[CHROME]);
    glMaterialf(GL_FRONT_AND_BACK, GL_SHININESS, _Shininess[CHROME]);
    // Translations...
    glutSolidSphere(_Radius, _Slices, _Stacks);
  glPopMatrix();

  glFlush();

  glutSwapBuffers();
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-26T03:59:28.143

你看过环境映射吗？您希望您的对象反射来自环境中其他对象的光，因此您基本上应用一个看起来像环境的纹理并根据法线生成纹理坐标。这将使表面具有镜面外观。您可以让 OpenGL 自动为每个顶点生成纹理坐标，使用[`glTexGen`](http://www.opengl.org/documentation/specs/man_pages/hardcopy/GL/html/gl/texgen.html).

[NeHe 教程 23](http://nehe.gamedev.net/data/lessons/lesson.asp?lesson=23)使用球体映射涵盖了这一点。您还可以使用 GLSL 为每个顶点或每个像素生成自己的纹理坐标。[这是一个教程](http://www.ozone3d.net/tutorials/glsl_texturing.php)。

# asp.net-mvc - 如何处理asp.net mvc中的分页？

> ID：743087
> 
> 赞同：6
> 
> 时间：2009-04-13T05:08:42.953
> 
> 标签：asp.net-mvc, paging

我正在使用 asp.net mvc。我想将分页添加到记录列表中。请帮助任何链接或示例代码。

谢谢。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-13T05:16:57.753

[使用 ASP.NET MVC 演示分页](http://blogs.taiga.nl/martijn/2008/08/27/paging-with-aspnet-mvc/)

[![替代文字](https://i.stack.imgur.com/FZqZU.png)](https://i.stack.imgur.com/FZqZU.png)
[（来源：[taiga.nl](http://blogs.taiga.nl/martijn/wp-content/uploads/subtext/WindowsLiveWriter/PagingwithASP.NETMVC_D952/aspnetmvc-pager_2.png)）]

# javascript - Javascript鼠标跟踪速度

> ID：743092
> 
> 赞同：0
> 
> 时间：2009-04-13T05:11:30.543
> 
> 标签：javascript, tablet-pc, stylus-pen

今天早些时候，我正在使用 zoho notebook ( [http://notebook.zoho.com](http://notebook.zoho.com) ) 在平板电脑上工作，并注意到手写笔输入不如 OneNote 之类的准确或流畅。似乎该功能是在 javascript 中完成的，所以我的问题就变成了：是否有可能提高 javascript 跟踪鼠标/手写笔的准确性（对于类似于 zoho notebook 的钢笔工具功能），以便使用手写笔书写更流畅自然？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-13T07:41:09.500

您很可能受硬件限制。问题在于捕获设备，而不是使用的软件。

# asp.net - App_Data/ASPNETDB.MDF 到 Sql Server 2005（或 08）

> ID：743094
> 
> 赞同：5
> 
> 时间：2009-04-13T05:11:49.763
> 
> 标签：asp.net, forms-authentication

我一直在开发一个需要帐户登录功能的 ASP.NET WebForms 应用程序（例如注册新用户、更改密码、恢复密码、配置文件、角色等）。为此，我将 FormsAuthentication 与默认数据存储一起使用，令我惊讶的是，它是 App_Data 中的 MDF 文件。当需要实际部署此应用程序时。生活在网络上，我将使用一些共享主机，如 GoDaddy 或其他廉价公司。

为了提高效率，我想从这个 MDF 切换到实际的 SQL Server 2005 或 2008（谁在他们的头脑中使用平面文件？）。但是，对于共享主机，我将无法运行任何程序，例如 aspnet_regsql.exe。我只需要一个 SQL Server 数据库的登录名和密码，以及一个进入域根目录的 FTP 帐户。没有 MSTSC 远程桌面，没有控制台访问，没有 IIS 中的修修补补等。

我不需要从 ASPNETDB.MDF 转移任何用户帐户（站点将从零用户开始），但我想如何：

1) 在我使用Web Site Administration Tool 开始FormsAuthentication 时，轻松创建Visual Studio 在ASPNETDB.MDF 中自动创建的表、过程等？

2) 让 SQL 成员资格提供程序使用我给它的连接字符串，而不是使用现在的任何东西来连接到这个 ASPNETDB.MDF。见鬼，我什至在 web.config 中都没有看到这个 MDF 的任何连接字符串；我的应用到底是怎么回事。甚至找到它？机器配置？如果是这样，那将是一个糟糕的决定。这种幕后的废话让我发疯。

**非常非常感谢经历过此迁移的人的任何帮助！**

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-13T05:59:07.093

.mdf 不是平面文件。它是一个 SQL Server Express 数据库文件。

有时最好不要在土路上驾驶保时捷……；）

如果您要托管具有严格后端的网站，我建议您使用专用服务器。从管理员的角度来看，共享主机有限制。

为了在 SQL Express 中查找表，SQL Server EE 附带了一个名为“management studio”的工具，它应该允许您访问 .mdf 等中的表

这是 web.config 中 .mdf 的连接字符串示例

```
<connectionStrings>

        <add name="AddressBookConnectionString" connectionString="Data Source=.\SQLEXPRESS;AttachDbFilename=|DataDirectory|\AddressBook.mdf;Integrated Security=True;User Instance=True" providerName="System.Data.SqlClient"/>

</connectionStrings> 
```

我对你的沮丧感同身受。建立和托管一个复杂的网站并非易事。如果您为站点计划任何严肃的事情，通常运行向导来配置 Web 应用程序是一个坏主意，除非您正在学习 Web 应用程序。如果您要进行专业托管，您需要超越该抽象级别并了解有关如何手动配置/覆盖会员提供程序等的更多信息。

希望这将为您指明正确的方向。祝你好运 ;）

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-10-27T22:09:54.913

该 MDF 文件是一个 SQL Server 数据库。所有 SQL Server 版本（CE 除外）都使用相同的文件格式，因此任何其他 SQL Server 都可以使用[sp_attach_db](http://msdn.microsoft.com/en-us/library/ms179877.aspx)或 SSMS 打开 MDF，请参阅[如何：附加数据库 (SQL Server Management Studio)。](http://msdn.microsoft.com/en-us/library/ms190209.aspx). 连接到 SQL Server 后，SSMS 可以编写整个数据库的脚本，请参阅[如何：生成脚本 (SQL Server Management Studio)](http://msdn.microsoft.com/en-us/library/ms178078.aspx)。这也可以使用 SMO [Scripter](http://msdn.microsoft.com/en-us/library/microsoft.sqlserver.management.smo.scripter.aspx)对象以编程方式完成。SSMS 脚本将包含数据库中的所有表、索引、过程和所有其他对象。SSMS中还有一个[导入和导出向导](http://msdn.microsoft.com/en-us/library/ms141209.aspx)您可以使用它将表格内容（任何数据）导出到 CSV 文件中，然后将此 CSV 文件导入到托管数据库中，但是该导入/导出向导相当复杂（它使用 SSIS）。

数据导出的另一种选择是使用 bcp 实用程序，请参阅[批量导入和批量导出操作](http://msdn.microsoft.com/en-us/library/ms187042.aspx)。

从技术上讲，您可以使用 VS 环境中的 SQL Server Express 实例、使用 sqlcmd 和 bcp 等命令行工具执行所有这些操作，也可以编写自己的 SMO Scripter 应用程序来导出数据库模式。但是，这需要一定的经验。访问一个成熟的 Managent Studio 来准备所有要在您的托管站点导入的数据将变得更加容易。

如果他们允许恢复或附加您自己的数据库，请不要忘记与您的提供商核实，那么您只需将文件副本发送给提供商即可轻松逃脱。

请注意，您的 MDF 文件只能附加到至少与您创建的版本相同的 SQL Server 上。您的 VS 环境包含一个 SQL Server，可能名为 SQLEXPRESS，您必须检查它的确切版本。比您的 VS SQL 实例版本更早的版本的服务器将拒绝附加您的 MDF 文件，因为这是他们无法识别的格式。按照[KB 321185](http://support.microsoft.com/default.aspx/kb/321185)中的步骤确定 VS 环境具有的 SQL Server 版本。

**更新**

我不知道 VS 有一个导出向导。只需按照Gary 在他提供[的链接中提到的步骤操作即可。](http://weblogs.asp.net/nannettethacker/archive/2008/11/04/deploying-the-aspnetdb-mdf-to-a-production-server.aspx)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-13T06:12:47.713

根据您的托管服务提供商，一些细节会有所不同，但是：

1.  如果您尚未这样做，请下载并安装[Microsoft SQL Server Management Studio Express](http://www.microsoft.com/downloads/details.aspx?FamilyID=c243a5ae-4bd1-4e3d-94b8-5a0f62bf7796&displaylang=en)

2.  您的托管服务提供商必须为您提供管理员连接信息才能连接到您的 sql server 实例。使用该信息验证您是否可以使用 MSSMSE 进行连接。如果你不能，那么剩下的就无关紧要了。

3.  转到此[博客](http://weblogs.asp.net/nannettethacker/archive/2008/11/04/deploying-the-aspnetdb-mdf-to-a-production-server.aspx)并按照步骤创建所需的数据库脚本，以将您的数据库移至生产环境。这些脚本可以在 MSSMSE 的查询窗口中运行。

4.  通常，您的连接字符串将存储在 Web.Config 文件中。连接字符串。如果正如您在问题中所说，您已移至完整的 SQL Server，您将不想使用“AttachDbFilename =”样式。您的连接字符串看起来更像这样：

    <add name="myConnectionName" connectionString="Data Source=myServerAddress;Initial Catalog=myDataBase;User Id=myUsername;Password=myPassword;">

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-13T05:59:41.163

MDF 实际上并不是一个平面文件数据库，它使用带有[用户实例](http://msdn.microsoft.com/en-us/library/bb264564(SQL.90).aspx)的 SQL Express 引擎，因此它可以即时附加数据库。这个引擎是 SQL Server 的一个受限版本，虽然限制相当高，所以除非你有一个繁忙的站点，否则它不会成为问题。从[这里开始](http://msdn.microsoft.com/en-us/library/ms345154.aspx)，限制是......

*   缺乏企业功能支持
*   仅限于一个 CPU 1 GB 内存
*   缓冲池数据库的限制
*   最大大小为 4 GB

连接字符串应该在您的 web.config 中，搜索“AttachDbFileName”（不带引号）。有关更多信息，请参见[此处](http://msdn.microsoft.com/en-us/library/bb264564(SQL.90).aspx)。

如果您的托管包中有完整的 SQL，通常托管公司会为您提供一个 Web 工具，以将 MDF 文件（通过指定其路径）附加到完整的 SQL 服务器实例。您可以将 MDF 文件留在 app_data 文件夹中（因为该文件夹设置了权限，防止匿名用户下载 db 文件）。

一旦附加到使用 SQL Server 标准实例（或其他版本）而不是 SQL Express 用户实例，您只需更改 web.config 文件中的连接字符串以指向您使用 Web 工具配置的数据库实例，而不是使用SQL Express 的自动附加功能。

有关 godaddy 的说明，请参见[此处](http://help.godaddy.com/article/689)。

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2009-08-18T07:13:55.970

如果您从新数据开始，这很容易做到

我运行了“C:\Windows\Microsoft.NET\Framework\v2.0.50727\a spnet_regsql -C *Data Source=localhost;Initial Catalog=MYDB;Persist Security Info=True;User ID=;Password=**;” * -A all" 将 ASP.NET 成员表和存储过程包含到我选择的数据库中。如果你这样做..确保覆盖默认的 LocalSQLServer 连接字符串，否则它不会在 web.config 中找到这样的数据库你的 asp.net 网站

<connectionStrings> <clear/> <add name="LocalSQLServer" connectionString="Data Source=localhost;Initial Catalog=MYDB;Persist Security Info=True;User ID=**;Password=****;" providerName="System.Data.SqlClient" />

# c++ - 在OpenGL中将纹理bmp文件作为纹理平铺到矩形上？

> ID：743097
> 
> 赞同：1
> 
> 时间：2009-04-13T05:14:40.053
> 
> 标签：c++, opengl, textures, glut

我有一个 pic.bmp，我正在尝试将其平铺到一个 3 x 2 矩形平面上，以进行我正在制作的演示。

我试图保持 bmp 的纵横比完好，但我仍然想将它平铺在该表面上。现在我的曲面顶点为 (0,0,0)、(3,0,0)、(0,2,0) 和 (3,2,0)。

如何将此 bmp 应用到平面并平铺？在 GLUT 和 OpenGL 中执行此操作的最佳方法是什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-13T05:31:55.037

有关示例，请参阅[此 NeHe 课程](http://nehe.gamedev.net/data/lessons/lesson.asp?lesson=06)。要进行平铺，只需编写如下内容：

```
glBegin(GL_QUADS);
        // your surface
        glTexCoord2f(0.0f, 0.0f); glVertex3f( 0.0f,  0.0f,  0.0f);  
        glTexCoord2f(3.0f, 0.0f); glVertex3f( 3.0f,  0.0f,  0.0f);  
        glTexCoord2f(3.0f, 2.0f); glVertex3f( 3.0f,  2.0f,  0.0f);  
        glTexCoord2f(0.0f, 2.0f); glVertex3f( 0.0f,  2.0f,  0.0f);  
glEnd(); 
```

这将设置纹理坐标以在此表面上平铺任何纹理 3x2 次。

# objective-c - 可可屏幕捕获？

> ID：743107
> 
> 赞同：1
> 
> 时间：2009-04-13T05:23:30.140
> 
> 标签：objective-c, cocoa

如何在 Cocoa 中捕获屏幕的 NSImage？我需要知道最快的方法，因为我正在尝试制作一个截屏应用程序。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-13T06:40:28.007

请参阅[OpenGLCaptureToMovie](http://developer.apple.com/samplecode/OpenGLScreenCapture/)示例。我要补充一点，您应该使用[Quartz Display Services 的刷新通知 API](http://developer.apple.com/documentation/GraphicsImaging/Reference/Quartz_Services_Ref/Reference/reference.html#//apple_ref/doc/uid/TP30001070-CH202-341696)而不是计时器。

请注意，OpenGL 示例不会生成 NSImage 对象。这样做是没有意义的，因为您不能将它们放入电影中。好吧，我想你可以在指定的帧时间分配一个 NSImage，但我不知道这对压缩有多好。

说到压缩，请以最高质量使用动画编解码器进行录制。这提供了足够好的压缩，不会压倒磁盘，当然也不会压倒处理器。然后，您可以提供转换选项，例如 H.264、iPhone 的 H.264 和 iPod 的 H.264。您还应该允许用户保留原始文件；一些网站，例如 Vimeo，会接受它并允许访问者下载它。

# java - Lucene 中的标签和属性在文档间共享

> ID：743119
> 
> 赞同：2
> 
> 时间：2009-04-13T05:37:24.493
> 
> 标签：java, lucene

我的应用程序需要保留文件索引，其中文件通过标签和属性已知，建议使用 Lucene (Java) 文档模式，例如：

```
tags: i s (indexed, stored)
attributes: i s
content: i
fileId: i s 
```

（实际文件在 sqlite 中通过 id 查找。）然而，虽然文件只有一组标签/属性，但它可能有多个版本的内容（每个版本都由 versionId 标识）。

唯一真正的解决方案似乎是一种文档类型，每个版本都有一个文档，这样标签和属性在许多文档中都是冗余的：

```
tags: i s
attributes: i s
content: i
versionId: i s
fileId: i s 
```

我对这个模式的担忧是它是否足够高性能和足够紧凑。所以这是我的问题：

1.  如果我正确理解了 Lucene 的索引方案，当相同的长字符串被索引为许多文档中的字段时，与仅索引一次相比，这并不会真正扩大索引。正确的？

2.  如果我创建一个 Term 对象，将其存储，然后将其添加到许多文档中，是否会为索引中的每个文档复制完整的字符串数据？如果是这种情况，我是否最好将标签/属性的实际存储放入 sql 中？

3.  据我所知，查询结果中返回的唯一信息是按分数排序的文档本身。要确定哪些字段满足对匹配文档的查询，我必须对每个文档的字段进行单独查询，还是什么？

了解这只是一个客户端应用程序，因此并发访问不是问题，并且索引更新将非常罕见（每次用户重新标记或编辑/创建文件时）。我主要关心单个用户的实时响应，并且在某种程度上关心索引大小（尽管更多的是为了节省内存而不是磁盘空间）。

* * *

## 更多背景

我考虑了一些替代文档模式，但拒绝了它们。我最初的直觉是通过将文档分成两种类型来避免数据重复，一种用于表示文件：

```
tags: i s
attributes: i s
fileId: i s 
```

...但随后是一种用于表示文件*版本*的文档类型：

```
content: i
fileId: i s
versionId: i s 
```

这样做有很多问题：

首先，它需要对内容和标签/属性进行单独查询，然后将内容结果与文件匹配：对于结果中的每个版本文档，我必须查看其 fileId，然后在单独的查询中查找相应的文件文档。虽然这是一种标准的关系技术，但我的理解是，在 Lucene 中这是一件相当尴尬和缓慢的事情。

其次，对于同时需要“pizza”和“hot dog”的查询，我想取回在标签/属性或内容中包含这两个术语的文件版本，或者在一个中包含*“hot dog”和在一个中包含“pizza”的文件版本其他*。通过从内容中分离标签/属性，这变得非常棘手（并且可能很昂贵）。

所以也许我可以通过保留多个内容字段来将内容和标签/属性保持在一起：

```
tags: i s
attributes: i s
content: i  (multiple fields)
fileId: i s 
```

问题是我是否可以识别内容字段，以便知道哪个版本的内容产生了点击。我可以不同地命名每个内容字段，对应于版本 ID：

```
tags: i s
attributes: i s
content {versionId}: i
content {versionId}: i
content {versionId}: i   # etc.
fileId: i s 
```

即使我可以识别导致文档与查询匹配的内容字段，合并版本也会打乱评分。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-13T07:04:14.220

> 1.  如果我正确理解了 Lucene 的索引方案，当相同的长字符串被索引为许多文档中的字段时，与仅索引一次相比，这并不会真正扩大索引。正确的？
> 2.  如果我创建一个 Term 对象，将其存储，然后将其添加到许多文档中，是否会为索引中的每个文档复制完整的字符串数据？如果是这种情况，我是否最好将标签/属性的实际存储放入 sql 中？
> 3.  据我所知，查询结果中返回的唯一信息是按分数排序的文档本身。要确定哪些字段满足对匹配文档的查询，我必须对每个文档的字段进行单独查询，还是什么？

1.  正确的。Lucene 存储了一个字典，将字符串映射到数字标识符，因此消耗的内存只是存储标识符几次。
2.  我认为您可以安全地将标签和属性存储在 Lucene 中。
3.  您不需要单独的查询——一旦您持有一个 Document 对象，您就可以使用例如[getField()](http://lucene.apache.org/java/2_4_0/api/org/apache/lucene/document/Document.html#getField(java.lang.String))来获取相关的字段信息。由于您关心 Lucene 性能，我建议您阅读[Scaling Lucene 和 Solr](http://www.lucidimagination.com/Community/Hear-from-the-Experts/Articles/Scaling-Lucene-and-Solr)，其中涵盖了许多性能技巧。

# c# - IExtension：可扩展对象模式：它是如何工作的？

> ID：743121
> 
> 赞同：2
> 
> 时间：2009-04-13T05:42:25.290
> 
> 标签：c#, .net, design-patterns, extensibility

我在 C# 中使用 (IExtension, IExtensibleObject) 接口探索可扩展对象模式，我提供了一个非常简单的示例，将日期从本地转换为 UTC，反之亦然：

```
public class BaseObject : IExtensibleObject<BaseObject> 
{
    private DateTime _startDate;
    private ExtensionCollection<BaseObject> _extensions;

    public DateTime StartDate
    {
        get { return _startDate; }
        set { _startDate = value; }
    }

    public BaseObject()
    {
        StartDate = DateTime.Now;
        _extensions = new ExtensionCollection<BaseObject>(this); 
    }

    #region IExtensibleObject<BaseObject> Members

    public IExtensionCollection<BaseObject> Extensions
    {
        get 
        {
            return _extensions;
        }
    }

    #endregion
}

public class DateTimeConverterExtension : IExtension<BaseObject>
{
    private BaseObject _owner;

    #region IExtension<BaseObject> Members

    public void Attach(BaseObject owner)
    {
        _owner = owner;
        _owner.StartDate = owner.StartDate.ToUniversalTime();
    }

    public void Detach(BaseObject owner)
    {
        _owner.StartDate = _owner.StartDate.ToLocalTime();
    }

    #endregion
}

class Program
{
    static void Main(string[] args)
    {
        BaseObject obj = new BaseObject();
        Console.WriteLine("Local Time: "+obj.StartDate);

        obj.Extensions.Add(new DateTimeConverterExtension());

        Console.WriteLine("UTC: "+obj.StartDate);

        DateTimeConverterExtension ext = obj.Extensions.Find<DateTimeConverterExtension>();
        obj.Extensions.Remove(ext);

        Console.WriteLine("Local Time: "+obj.StartDate);
    }
} 
```

输出：

> 当地时间：2009 年 4 月 13 日上午 11:09:19
> UTC：2009 年 4 月 13 日上午 5:39:19
> 当地时间：2009 年 4 月 13 日上午 11:09:19
> 按任意键继续。. .

所以它有效，问题是：

当程序调用 IExtensionCollection.Add 和 IExtensionCollection.Detach 方法时，.Net 框架如何调用“附加”和“分离”？填写我在这里遗漏的内部细节。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-13T06:05:46.950

`Attach`和`Detach`方法分别由和`ExtensionCollection<T>.InsertItem`调用`ExtensionsCollection<T>.RemoveItem`。反过来，这些方法是由`SynchronizedCollection<T>.Add`and调用的虚拟方法`SynchronizedCollection<T>.Remove`，这是您的代码最终调用的方法。这可以通过使用[Reflector](http://www.red-gate.com/products/reflector/)来验证。如果您创建了自己的 实现`IExtensionCollection<T>`，则无法保证`Attach`并且`Detach`会被正确调用。

# javascript - 固定移动 Safari 中的定位

> ID：743123
> 
> 赞同：67
> 
> 时间：2009-04-13T05:42:38.317
> 
> 标签：javascript, iphone, css, mobile-safari

是否可以在 Mobile Safari 中定位相对于视口固定的元素？正如许多人所指出的那样，`position: fixed`它不起作用，但 Gmail 刚刚推出了一个几乎是我想要的解决方案 - 请参阅消息视图上的浮动菜单栏。

在 JavaScript 中获取实时滚动事件也是一个合理的解决方案。

* * *

## 回答 #1

> 赞同：74
> 
> 时间：2010-08-17T22:00:53.757

这个固定位置的 div 只需 2 行代码就可以实现，它将滚动时的 div 移动到页面底部。

```
window.onscroll = function() {
  document.getElementById('fixedDiv').style.top =
     (window.pageYOffset + window.innerHeight - 25) + 'px';
}; 
```

* * *

## 回答 #2

> 赞同：35
> 
> 时间：2011-06-08T00:57:20.193

iOS 5[支持 position:fixed](http://davidbcalhoun.com/2011/new-mobile-safari-stuff-in-ios5-position-fixed-overflow-scroll-new-input-type-support-web-workers-ecmascript-5)。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2010-12-22T18:58:58.613

请参阅[Google 对此问题的解决方案](https://web.archive.org/web/20141001100814/https://developers.google.com/mobile/articles/webapp_fixed_ui)。您基本上必须使用 JavaScript 自己滚动内容。[Sencha Touch](http://www.sencha.com/products/touch/)还提供了一个库，用于在非常高效的庄园中获取此行为。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2010-12-01T18:35:31.400

它对我有用：

```
function changeFooterPosition() {   
  $('.footer-menu').css('top', window.innerHeight + window.scrollY - 44 + "px");
}

$(document).bind('scroll', function() {
  changeFooterPosition();
}); 
```

（44是我酒吧的高度）

尽管该栏仅在滚动结束时移动...

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2010-11-29T13:40:56.207

这可能会让你感兴趣。这是 Apple Dev 支持页面。
[http://developer.apple.com/library/ios/#technotes/tn2010/tn2262/](http://developer.apple.com/library/ios/#technotes/tn2010/tn2262/)

阅读“ **4.修改依赖CSS固定定位的代码**”这一点，你会发现苹果做出来是有充分理由的有意识地决定将固定位置处理为静态。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-04-13T05:57:27.703

我认为 gmail 只是跟踪计时器上的滚动位置并相应地重新定位 a `div`。

我见过的最好的解决方案是在[doctyper](http://doctyper.com/archives/200808/fixed-positioning-on-mobile-safari/)。

一个更简单的 jQuery 解决方案，可以移动元素 onscroll：[link](http://markmail.org/message/c36au6ogcpyysit5)

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2011-02-15T15:12:11.303

您可以尝试使用 touch-scroll，这是一个 jQuery 插件，可以模拟移动 Safari 上固定元素的滚动：[https ://github.com/neave/touch-scroll](https://github.com/neave/touch-scroll)

[在http://neave.github.com/touch-scroll/](http://neave.github.com/touch-scroll/)上使用您的 iOS 设备查看示例

或者另一种选择是 iScroll：[http ://cubiq.org/iscroll](http://cubiq.org/iscroll)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2012-03-20T17:15:31.017

我就是这样做的。向下滚动页面后，我在标题下方有一个导航块，它“粘”到窗口顶部。如果您滚动回顶部，导航会回到我使用位置的位置：非移动平台和 iOS5 的 CSS 中固定。其他移动版本确实存在“滞后”，直到屏幕在设置之前停止滚动。

```
// css
#sticky.stick {
    width:100%;
    height:50px;
    position: fixed;
    top: 0;
    z-index: 1;
}

// jquery 
//sticky nav
    function sticky_relocate() {
      var window_top = $(window).scrollTop();
      var div_top = $('#sticky-anchor').offset().top;

      if (window_top > div_top)
        $('#sticky').addClass('stick');
      else
        $('#sticky').removeClass('stick');
     }

$(window).scroll(function(event){

    // sticky nav css NON mobile way
       sticky_relocate();

       var st = $(this).scrollTop();

    // sticky nav iPhone android mobile way iOS<5

       if (navigator.userAgent.match(/OS 5(_\d)+ like Mac OS X/i)) {
            //do nothing uses sticky_relocate() css
       } else if ( navigator.userAgent.match(/(iPod|iPhone|iPad)/i) || navigator.userAgent.match(/Android/i) || navigator.userAgent.match(/webOS/i) ) {

            var window_top = $(window).scrollTop();
            var div_top = $('#sticky-anchor').offset().top;

            if (window_top > div_top) {
                $('#sticky').css({'top' : st  , 'position' : 'absolute' });
            } else {
                $('#sticky').css({'top' : 'auto' });
            }
        }; 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2012-05-11T22:52:53.830

```
<meta name="viewport" content="width=320, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"/> 
```

此外，确保`height=device-height`在此元标记中不存在有助于防止页面上通常不存在的额外页脚填充。菜单栏高度增加了视口高度，导致固定背景变得可滚动。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2013-03-12T08:37:41.237

在这里您可以看到哪些（移动）浏览器支持 CSS 位置固定 + 那里的版本。

[http://caniuse.com/css-fixed](http://caniuse.com/css-fixed)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2014-10-22T13:38:00.480

我们的网络应用程序需要一个固定的标题。幸运的是，我们只需要支持最新的浏览器，但 Safari 在这方面的行为给我们带来了真正的问题。

正如其他人指出的那样，最好的解决方法是编写我们自己的滚动代码。但是，我们不能证明为解决仅在 iOS 上出现的问题所做的努力是合理的。希望苹果可以解决这个问题更有意义，特别是因为正如 QuirksMode 所暗示的那样，苹果现在在他们对“位置：固定”的解释中独树一帜。

[http://www.quirksmode.org/blog/archives/2013/12/position_fixed_1.html](http://www.quirksmode.org/blog/archives/2013/12/position_fixed_1.html)

对我们有用的是根据用户是否缩放在“位置：固定”和“位置：绝对”之间切换。这用可预测的行为替换了我们的“浮动”标题，这对可用性很重要。缩放时，行为不是我们想要的，但用户可以通过反转缩放轻松解决此问题。

```
// On iOS, "position: fixed;" is not supported when zoomed, so toggle "position: absolute;".
header = document.createElement( "HEADER" );
document.body.appendChild( header );
if( navigator.userAgent.match( /iPad/i ) || navigator.userAgent.match( /iPhone/i )) {
    addEventListener( document.body, function( event ) {
        var zoomLevel = (( Math.abs( window.orientation ) === 90 ) ? screen.height : screen.width ) / window.innerWidth;
        header.style.position = ( zoomLevel > 1 ) ? "absolute" : "fixed";
    });
} 
```

# javascript - 移动检测

> ID：743129
> 
> 赞同：28
> 
> 时间：2009-04-13T05:46:29.540
> 
> 标签：javascript, mobile, user-agent, browser-detection

有没有办法使用 Javascript 检测移动设备？此外，我研究了有这样一个 XML 包含可以帮助识别手机的用户代理。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2011-08-10T00:40:52.917

您可能有一个普通站点，如果满足某些条件，您可能希望重定向到移动站点，例如屏幕非常小，或者内容被缩小以适应小型物理空间中的大“虚拟”屏幕。那么，为什么不检查这些条件而不是测试无数的 UA 字符串。

尝试这样的事情：

为了让 UA 报告屏幕的物理像素大小，该标签必须存在于 html 页面中。*

```
<meta name="viewport" 
      content="width=device-width, initial-scale=1, maximum-scale=1" /> 
```

现在，只需获取屏幕大小并在需要时重定向。使用轻微的延迟。**

```
setTimeout(function(){
  if ((screen.width < 480) || (screen.height < 480)) {
    location.replace('/mobile/');
  }
}, 100); 
```

差不多就是这样。由于此页面已经为移动设备设置了视口标签，因此您也可以反过来，在此处显示移动设备并在屏幕更大时重定向到完整站点。

编辑：我不确定为什么这个问题已经关闭；据我所知，它非常适合 SO 格式。投票决定重新开放。

^(* 用 javascript 插入它似乎不起作用（如果你想出办法，请纠正我）。如果它不存在，手机将报告一个大于实际屏幕的虚拟屏幕尺寸。它似乎也不适用于 iframe，只有顶级窗口（这是有道理的，因为 iframe 需要缩放与外部窗口相同的数量，它们共享相同的视口）。)

^(** 一些移动浏览器会保留上次加载页面的视口大小，因此它们会在几毫秒内报告较大的虚拟屏幕大小，直到它们注意到我猜的元标记。我找不到一个早期的事件来解决这个问题，如果你有更好的方法，请发表评论。在我所有的测试中，50 毫秒的延迟都很好，100 应该是安全的。)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2010-10-08T10:39:39.947

我有这个来自 K2F 的代码，它在**PHP**中，你必须将它转换为 javascript。

应该不会太麻烦。了解常量（文本位）应该对您有很大帮助。

```
/**
 * A simple class used to detect whether page<br>
 * is being viewed from a mobile device or not.
 * @copyright 2010 Covac Software
 * @author Christian Sciberras
 * @version 01/05/2010
 */
class Mobile {
    public static function is_mobile(){
        $user_agent = $_SERVER['HTTP_USER_AGENT']; // get the user agent value - this should be cleaned to ensure no nefarious input gets executed
        $accept     = $_SERVER['HTTP_ACCEPT']; // get the content accept value - this should be cleaned to ensure no nefarious input gets executed
        return false
            || (preg_match('/ipad/i',$user_agent))
            || (preg_match('/ipod/i',$user_agent)||preg_match('/iphone/i',$user_agent))
            || (preg_match('/android/i',$user_agent))
            || (preg_match('/opera mini/i',$user_agent))
            || (preg_match('/blackberry/i',$user_agent))
            || (preg_match('/(pre\/|palm os|palm|hiptop|avantgo|plucker|xiino|blazer|elaine)/i',$user_agent))
            || (preg_match('/(iris|3g_t|windows ce|opera mobi|windows ce; smartphone;|windows ce; iemobile)/i',$user_agent))
            || (preg_match('/(mini 9.5|vx1000|lge |m800|e860|u940|ux840|compal|wireless| mobi|ahong|lg380|lgku|lgu900|lg210|lg47|lg920|lg840|lg370|sam-r|mg50|s55|g83|t66|vx400|mk99|d615|d763|el370|sl900|mp500|samu3|samu4|vx10|xda_|samu5|samu6|samu7|samu9|a615|b832|m881|s920|n210|s700|c-810|_h797|mob-x|sk16d|848b|mowser|s580|r800|471x|v120|rim8|c500foma:|160x|x160|480x|x640|t503|w839|i250|sprint|w398samr810|m5252|c7100|mt126|x225|s5330|s820|htil-g1|fly v71|s302|-x113|novarra|k610i|-three|8325rc|8352rc|sanyo|vx54|c888|nx250|n120|mtk |c5588|s710|t880|c5005|i;458x|p404i|s210|c5100|teleca|s940|c500|s590|foma|samsu|vx8|vx9|a1000|_mms|myx|a700|gu1100|bc831|e300|ems100|me701|me702m-three|sd588|s800|8325rc|ac831|mw200|brew |d88|htc\/|htc_touch|355x|m50|km100|d736|p-9521|telco|sl74|ktouch|m4u\/|me702|8325rc|kddi|phone|lg |sonyericsson|samsung|240x|x320|vx10|nokia|sony cmd|motorola|up.browser|up.link|mmp|symbian|smartphone|midp|wap|vodafone|o2|pocket|kindle|mobile|psp|treo)/i',$user_agent))
            || ((strpos($accept,'text/vnd.wap.wml')>0)||(strpos($accept,'application/vnd.wap.xhtml+xml')>0))
            || (isset($_SERVER['HTTP_X_WAP_PROFILE'])||isset($_SERVER['HTTP_PROFILE']))
            || (in_array(strtolower(substr($user_agent,0,4)),array('1207'=>'1207','3gso'=>'3gso','4thp'=>'4thp','501i'=>'501i','502i'=>'502i','503i'=>'503i','504i'=>'504i','505i'=>'505i','506i'=>'506i','6310'=>'6310','6590'=>'6590','770s'=>'770s','802s'=>'802s','a wa'=>'a wa','acer'=>'acer','acs-'=>'acs-','airn'=>'airn','alav'=>'alav','asus'=>'asus','attw'=>'attw','au-m'=>'au-m','aur '=>'aur ','aus '=>'aus ','abac'=>'abac','acoo'=>'acoo','aiko'=>'aiko','alco'=>'alco','alca'=>'alca','amoi'=>'amoi','anex'=>'anex','anny'=>'anny','anyw'=>'anyw','aptu'=>'aptu','arch'=>'arch','argo'=>'argo','bell'=>'bell','bird'=>'bird','bw-n'=>'bw-n','bw-u'=>'bw-u','beck'=>'beck','benq'=>'benq','bilb'=>'bilb','blac'=>'blac','c55/'=>'c55/','cdm-'=>'cdm-','chtm'=>'chtm','capi'=>'capi','cond'=>'cond','craw'=>'craw','dall'=>'dall','dbte'=>'dbte','dc-s'=>'dc-s','dica'=>'dica','ds-d'=>'ds-d','ds12'=>'ds12','dait'=>'dait','devi'=>'devi','dmob'=>'dmob','doco'=>'doco','dopo'=>'dopo','el49'=>'el49','erk0'=>'erk0','esl8'=>'esl8','ez40'=>'ez40','ez60'=>'ez60','ez70'=>'ez70','ezos'=>'ezos','ezze'=>'ezze','elai'=>'elai','emul'=>'emul','eric'=>'eric','ezwa'=>'ezwa','fake'=>'fake','fly-'=>'fly-','fly_'=>'fly_','g-mo'=>'g-mo','g1 u'=>'g1 u','g560'=>'g560','gf-5'=>'gf-5','grun'=>'grun','gene'=>'gene','go.w'=>'go.w','good'=>'good','grad'=>'grad','hcit'=>'hcit','hd-m'=>'hd-m','hd-p'=>'hd-p','hd-t'=>'hd-t','hei-'=>'hei-','hp i'=>'hp i','hpip'=>'hpip','hs-c'=>'hs-c','htc '=>'htc ','htc-'=>'htc-','htca'=>'htca','htcg'=>'htcg','htcp'=>'htcp','htcs'=>'htcs','htct'=>'htct','htc_'=>'htc_','haie'=>'haie','hita'=>'hita','huaw'=>'huaw','hutc'=>'hutc','i-20'=>'i-20','i-go'=>'i-go','i-ma'=>'i-ma','i230'=>'i230','iac'=>'iac','iac-'=>'iac-','iac/'=>'iac/','ig01'=>'ig01','im1k'=>'im1k','inno'=>'inno','iris'=>'iris','jata'=>'jata','java'=>'java','kddi'=>'kddi','kgt'=>'kgt','kgt/'=>'kgt/','kpt '=>'kpt ','kwc-'=>'kwc-','klon'=>'klon','lexi'=>'lexi','lg g'=>'lg g','lg-a'=>'lg-a','lg-b'=>'lg-b','lg-c'=>'lg-c','lg-d'=>'lg-d','lg-f'=>'lg-f','lg-g'=>'lg-g','lg-k'=>'lg-k','lg-l'=>'lg-l','lg-m'=>'lg-m','lg-o'=>'lg-o','lg-p'=>'lg-p','lg-s'=>'lg-s','lg-t'=>'lg-t','lg-u'=>'lg-u','lg-w'=>'lg-w','lg/k'=>'lg/k','lg/l'=>'lg/l','lg/u'=>'lg/u','lg50'=>'lg50','lg54'=>'lg54','lge-'=>'lge-','lge/'=>'lge/','lynx'=>'lynx','leno'=>'leno','m1-w'=>'m1-w','m3ga'=>'m3ga','m50/'=>'m50/','maui'=>'maui','mc01'=>'mc01','mc21'=>'mc21','mcca'=>'mcca','medi'=>'medi','meri'=>'meri','mio8'=>'mio8','mioa'=>'mioa','mo01'=>'mo01','mo02'=>'mo02','mode'=>'mode','modo'=>'modo','mot '=>'mot ','mot-'=>'mot-','mt50'=>'mt50','mtp1'=>'mtp1','mtv '=>'mtv ','mate'=>'mate','maxo'=>'maxo','merc'=>'merc','mits'=>'mits','mobi'=>'mobi','motv'=>'motv','mozz'=>'mozz','n100'=>'n100','n101'=>'n101','n102'=>'n102','n202'=>'n202','n203'=>'n203','n300'=>'n300','n302'=>'n302','n500'=>'n500','n502'=>'n502','n505'=>'n505','n700'=>'n700','n701'=>'n701','n710'=>'n710','nec-'=>'nec-','nem-'=>'nem-','newg'=>'newg','neon'=>'neon','netf'=>'netf','noki'=>'noki','nzph'=>'nzph','o2 x'=>'o2 x','o2-x'=>'o2-x','opwv'=>'opwv','owg1'=>'owg1','opti'=>'opti','oran'=>'oran','p800'=>'p800','pand'=>'pand','pg-1'=>'pg-1','pg-2'=>'pg-2','pg-3'=>'pg-3','pg-6'=>'pg-6','pg-8'=>'pg-8','pg-c'=>'pg-c','pg13'=>'pg13','phil'=>'phil','pn-2'=>'pn-2','pt-g'=>'pt-g','palm'=>'palm','pana'=>'pana','pire'=>'pire','pock'=>'pock','pose'=>'pose','psio'=>'psio','qa-a'=>'qa-a','qc-2'=>'qc-2','qc-3'=>'qc-3','qc-5'=>'qc-5','qc-7'=>'qc-7','qc07'=>'qc07','qc12'=>'qc12','qc21'=>'qc21','qc32'=>'qc32','qc60'=>'qc60','qci-'=>'qci-','qwap'=>'qwap','qtek'=>'qtek','r380'=>'r380','r600'=>'r600','raks'=>'raks','rim9'=>'rim9','rove'=>'rove','s55/'=>'s55/','sage'=>'sage','sams'=>'sams','sc01'=>'sc01','sch-'=>'sch-','scp-'=>'scp-','sdk/'=>'sdk/','se47'=>'se47','sec-'=>'sec-','sec0'=>'sec0','sec1'=>'sec1','semc'=>'semc','sgh-'=>'sgh-','shar'=>'shar','sie-'=>'sie-','sk-0'=>'sk-0','sl45'=>'sl45','slid'=>'slid','smb3'=>'smb3','smt5'=>'smt5','sp01'=>'sp01','sph-'=>'sph-','spv '=>'spv ','spv-'=>'spv-','sy01'=>'sy01','samm'=>'samm','sany'=>'sany','sava'=>'sava','scoo'=>'scoo','send'=>'send','siem'=>'siem','smar'=>'smar','smit'=>'smit','soft'=>'soft','sony'=>'sony','t-mo'=>'t-mo','t218'=>'t218','t250'=>'t250','t600'=>'t600','t610'=>'t610','t618'=>'t618','tcl-'=>'tcl-','tdg-'=>'tdg-','telm'=>'telm','tim-'=>'tim-','ts70'=>'ts70','tsm-'=>'tsm-','tsm3'=>'tsm3','tsm5'=>'tsm5','tx-9'=>'tx-9','tagt'=>'tagt','talk'=>'talk','teli'=>'teli','topl'=>'topl','hiba'=>'hiba','up.b'=>'up.b','upg1'=>'upg1','utst'=>'utst','v400'=>'v400','v750'=>'v750','veri'=>'veri','vk-v'=>'vk-v','vk40'=>'vk40','vk50'=>'vk50','vk52'=>'vk52','vk53'=>'vk53','vm40'=>'vm40','vx98'=>'vx98','virg'=>'virg','vite'=>'vite','voda'=>'voda','vulc'=>'vulc','w3c '=>'w3c ','w3c-'=>'w3c-','wapj'=>'wapj','wapp'=>'wapp','wapu'=>'wapu','wapm'=>'wapm','wig '=>'wig ','wapi'=>'wapi','wapr'=>'wapr','wapv'=>'wapv','wapy'=>'wapy','wapa'=>'wapa','waps'=>'waps','wapt'=>'wapt','winc'=>'winc','winw'=>'winw','wonu'=>'wonu','x700'=>'x700','xda2'=>'xda2','xdag'=>'xdag','yas-'=>'yas-','your'=>'your','zte-'=>'zte-','zeto'=>'zeto','acs-'=>'acs-','alav'=>'alav','alca'=>'alca','amoi'=>'amoi','aste'=>'aste','audi'=>'audi','avan'=>'avan','benq'=>'benq','bird'=>'bird','blac'=>'blac','blaz'=>'blaz','brew'=>'brew','brvw'=>'brvw','bumb'=>'bumb','ccwa'=>'ccwa','cell'=>'cell','cldc'=>'cldc','cmd-'=>'cmd-','dang'=>'dang','doco'=>'doco','eml2'=>'eml2','eric'=>'eric','fetc'=>'fetc','hipt'=>'hipt','http'=>'http','ibro'=>'ibro','idea'=>'idea','ikom'=>'ikom','inno'=>'inno','ipaq'=>'ipaq','jbro'=>'jbro','jemu'=>'jemu','java'=>'java','jigs'=>'jigs','kddi'=>'kddi','keji'=>'keji','kyoc'=>'kyoc','kyok'=>'kyok','leno'=>'leno','lg-c'=>'lg-c','lg-d'=>'lg-d','lg-g'=>'lg-g','lge-'=>'lge-','libw'=>'libw','m-cr'=>'m-cr','maui'=>'maui','maxo'=>'maxo','midp'=>'midp','mits'=>'mits','mmef'=>'mmef','mobi'=>'mobi','mot-'=>'mot-','moto'=>'moto','mwbp'=>'mwbp','mywa'=>'mywa','nec-'=>'nec-','newt'=>'newt','nok6'=>'nok6','noki'=>'noki','o2im'=>'o2im','opwv'=>'opwv','palm'=>'palm','pana'=>'pana','pant'=>'pant','pdxg'=>'pdxg','phil'=>'phil','play'=>'play','pluc'=>'pluc','port'=>'port','prox'=>'prox','qtek'=>'qtek','qwap'=>'qwap','rozo'=>'rozo','sage'=>'sage','sama'=>'sama','sams'=>'sams','sany'=>'sany','sch-'=>'sch-','sec-'=>'sec-','send'=>'send','seri'=>'seri','sgh-'=>'sgh-','shar'=>'shar','sie-'=>'sie-','siem'=>'siem','smal'=>'smal','smar'=>'smar','sony'=>'sony','sph-'=>'sph-','symb'=>'symb','t-mo'=>'t-mo','teli'=>'teli','tim-'=>'tim-','tosh'=>'tosh','treo'=>'treo','tsm-'=>'tsm-','upg1'=>'upg1','upsi'=>'upsi','vk-v'=>'vk-v','voda'=>'voda','vx52'=>'vx52','vx53'=>'vx53','vx60'=>'vx60','vx61'=>'vx61','vx70'=>'vx70','vx80'=>'vx80','vx81'=>'vx81','vx83'=>'vx83','vx85'=>'vx85','wap-'=>'wap-','wapa'=>'wapa','wapi'=>'wapi','wapp'=>'wapp','wapr'=>'wapr','webc'=>'webc','whit'=>'whit','winw'=>'winw','wmlb'=>'wmlb','xda-'=>'xda-',)))
        ;
    }
} 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2010-11-09T06:06:19.393

我编写了一个名为“ **redirection_mobile.js** ”的 JS 脚本来解决这个问题。如果您从移动设备访问站点，它会检​​测用户代理并重定向到移动版本。

在某些情况下，您想从移动设备重定向到桌面版本（例如使用“转到主站点”链接），脚本将处理该问题，一旦您完成会话，您将再次访问移动版本.

您可以在 github 上找到源代码**https://github.com/sebarmeli/JS-Redirection-Mobile-Site**并且您可以在我的一篇文章中阅读更多详细信息：

[http://blog.sebarmeli.com/2010/11/02/how-to-redirect-your-site-to-a-mobile-version-through-javascript/](http://blog.sebarmeli.com/2010/11/02/how-to-redirect-your-site-to-a-mobile-version-through-javascript/)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-01-10T05:41:10.840

The very last place I recommend browser sniffing code is mobile. It's the wild west out there right now and nobody is reading from the same rule book. I've heard rumors some browsers are mimicking other user agents to avoid sniffing code that excludes them just like IE used to back in the '90s.

Test by method and google progressive enhancement if you don't already know what it means. Some browser implementations of JS are so messed up they're not worth trying to accomodate and should be served versions of a site that work without JS, IMO.

Just look at what JQuery's core team considers C-grade (not worth supporting) on their graded compatibility tables. And yes, I believe this applies to both the core and the JQ mobile library (which is kind of like JQ ui for mobile, not JQ core for mobile - still needs core to work).

[http://jquerymobile.com/gbs/](http://jquerymobile.com/gbs/)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-08-15T23:38:59.453

我已经发布了“Apache Mobile Filter”的最后一个版本，这个开源项目在前 8 个月内有超过 1100 次来自 sourceforge 的下载，我想来自 CPAN 的下载量也是如此。

Apache Mobile Filter 允许您从任何编程语言访问 WURFL，而不仅仅是传统上用于动态移动网站的 Java 和 php。

该模块检测移动设备并将 WURFL 功能作为环境变量传递给其他 Web 应用程序。它还可以用于动态调整图像大小以适应移动设备的屏幕尺寸。

试试看，让我知道你的意见。

欲了解更多信息：[http ://www.idelfuschini.it/it/apache-mobile-filter-v2x.html](http://www.idelfuschini.it/it/apache-mobile-filter-v2x.html)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-01-11T03:03:36.747

插入[手机检测](http://www.handsetdetection.com)。您可以使用 Javascript、PHP 或最流行的脚本语言。我们处理痛苦，所以你不必:-) 免责声明 - 我在那里工作。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-13T05:55:19.190

我不建议使用 Javascript 来检测移动设备，原因很简单，因为其中许多设备不支持 Javascript，因此无法保证您的检测代码适用于所有设备。

通常检测是使用像[WURFL](http://wurfl.sourceforge.net/)这样的描述符文件在服务器端完成的，它不仅可以帮助您检测各种移动用户代理，还可以检测它们的功能、屏幕尺寸、颜色深度等。这样您就可以提供不同的配置资产（javascript 文件、图像大小等）取决于移动设备。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2010-10-08T10:05:40.050

[http://www.hand-interactive.com/resources/detect-mobile-javascript.htm](http://www.hand-interactive.com/resources/detect-mobile-javascript.htm)

```
var deviceBB = "blackberry";

//Initialize our user agent string to lower case. 
var uagent = navigator.userAgent.toLowerCase();

//************************** // Detects if the current browser is a BlackBerry of some sort. 

function DetectBlackBerry() {    
if (uagent.search(deviceBB) > -1)
      return true;    else
      return false; 
} 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2011-09-09T21:57:33.333

这是一个移动检测 Javascript，即使与 Opera MIni 之类的瘦客户端一起使用，我也可以保证它也能很好地工作（免责声明：我写的）：

[https://github.com/miohtama/detectmobile.js](https://github.com/miohtama/detectmobile.js)

# perl - Perl 模块是否知道它的安装位置？

> ID：743137
> 
> 赞同：7
> 
> 时间：2009-04-13T05:54:26.557
> 
> 标签：perl, templates, module

我已经开始创建一个包含默认电子邮件模板的 Perl 包。

清单看起来像：

```
SendMyEmail.pm
SendMyEmail/defualt_email.tt 
```

目前我知道模块（和模板）在哪里 - 但是模块本身知道它在磁盘上的位置吗？那么模块可以在没有我帮助的情况下找到默认模板吗？

```
# This is what I would like to do.
package SendMyEmail;
sub new {
    my ($self, $template) = @_;
    $template ||= $dir_of_SendMyEmail .'/SendMyEmail/default_email.tt'; # ??
} 
```

有没有更好的方法来包含模板文本，或者有更好的放置模板的地方？

任何对做类似事情的 CPAN 模块的引用都将受到欢迎。

提前致谢。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-13T06:28:55.243

每个 perl 文件都可以访问`__FILE__`告诉它其完整路径的变量。这样的事情应该可以解决问题：

```
my $DEFAULT_TEMPLATE;
BEGIN {
    $DEFAULT_TEMPLATE = __FILE__;
    $DEFAULT_TEMPLATE =~ s,\.pm$,/default_email.tt,;
} 
```

不过，如果您只想将“数据”文件与模块捆绑在一起，那么请查看[File::ShareDir](http://search.cpan.org/perldoc?File::ShareDir)，它提供了一种方法。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-12-03T14:29:31.843

在文件与包名称不完全匹配的情况下，使用 %INC 可能会产生误导。（这是一种反模式，但它确实会发生，有时是出于正当的原因。）如果您想定位文件，那么方便的[`__FILE__`](http://perldoc.perl.org/perldata.html#Special-Literals)令牌是您最好的选择。可以定位自身的示例模块：

```
package Foo::Bar;

use Cwd qw(abs_path);
use File::Basename qw(dirname);

sub module_dir { abs_path(dirname(__FILE__)) }

1; 
```

用法：

```
use Foo::Bar;

print Foo::Bar->module_dir, "\n"; 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-12-03T14:07:42.617

`%INC`如果模块已经加载，您可以使用哈希。例如：

```
## load the module
use Data::Dumper;

## output full path to Data::Dumper module loaded
print $INC{'Data/Dumper.pm'};

## see which module was loaded (if you have multiple folders with same modules)
print Dumper(\%INC); 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-13T17:48:05.173

Perl 也在 %INC 变量中记录文件位置。当 __FILE__ 不可用时，您可以使用它。[有关详细信息，请参阅perlvar](http://perldoc.perl.org/perlvar.html)中的文档。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-13T06:24:42.960

重写以反映我在评论中学到的东西：

*   **查找模块的路径**

    ```
    package FooBar;

    use File::Spec;
    sub location  {
    return File::Spec->rel2abs( __FILE__);
    } 
    ```

*   **放置模板的位置：**

    由于模板很可能是可编辑的，甚至可能是通过网络工作的人，我强烈建议将其放入模板中包含的“代码”无法执行的目录中。

    想象有人打电话：`http://your.home.net/cgi-bin/default_email.tt`

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-12-03T14:26:27.870

您可以使用`__FILE__`令牌来获取当前文件的名称（包括路径）。如果您想知道不同模块（已经加载的模块）的路径，请检查`%INC`散列的内容。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-12-03T18:02:22.433

我使用这个 bash 别名来查找模块的位置（例如，查看它的实现或破解一些调试打印语句）：

```
perlwhere() {
    perl -wle'eval "require $ARGV[0]" or die; ($mod = $ARGV[0]) =~ s|::|/|g; print $INC{"${mod}.pm"}' $1
} 
```

```
$ perlwhere 测试::更多
/usr/lib/perl5/5.8.8/Test/More.pm

```

# c# - Reading inner list only with LinqToXml

> ID：743138
> 
> 赞同：3
> 
> 时间：2009-04-13T05:54:48.817
> 
> 标签：c#, linq, linq-to-xml

With LinqToXml I would like to read out the album list for a given artist from an xml file like

```
<?xml version="1.0" encoding="utf-8" ?>
<artists>
  <artist name="Beatles">
    <albums>
      <album title="Please Please Me" year="1963"/>
      <album title="With the Beatles" year="1963"/>
      ...
    </albums>
  </artist>
  ...

```

I tried the following with LinqToXml. However, I would like to avoid instantiating an artist object...

```
XDocument xartists = XDocument.Load(FilePhysicalPath);
var artists = from xartist in xartists.Descendants("artist")
              where xartist.Attribute("name").Value.Equals(id)
              select new MusicArtist
              {
                  Albums = from xalbum in xartist.Descendants("album")
                           select new MusicAlbum
                           {
                               Title = xalbum.Attribute("title").Value,
                               Year =
                               int.Parse(xalbum.Attribute("year").Value)
                           }
              };
var artist = artists.SingleOrDefault();
if (artist != null)
    return artist.Albums;
else
    return null;

```

* * *

Update: My current 'best' attempt: See the accepted answer.

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-13T06:28:11.703

Try something like this:

```
 return (from artist in 
                     (from xartist in xartists.Descendants("artist")
                     where xartist.Attribute("name").Value.Equals("Beatles")
                     select new MusicArtist
                     {
                         Albums = from xalbum in xartist.Descendants("album")
                                  select new MusicAlbum
                                  {
                                      Title = xalbum.Attribute("title").Value,
                                      Year =  int.Parse(xalbum.Attribute("year").Value)
                                  }
                     })
                  where artist != null
                 select artist).FirstOrDefault(); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-13T08:06:57.597

It should be something like:

```
var result = from artist in xartists.Root.Elements("artist")
             where artist.Attribute("name").Value.Equals(id)
             let albums = artist.Element("albums")
             from album in albums.Elements("album")
             select new MusicAlbum
             {
                 Title = album.Attribute("title").Value,
                 Year = (int) album.Attribute("year")
             }; 
```

Note in particular the use of `Element`/`Elements` instead of `Descendents`

# objective-c - 如何使用 Cocoa 获取当前时间？

> ID：743140
> 
> 赞同：4
> 
> 时间：2009-04-13T05:55:35.493
> 
> 标签：objective-c, cocoa

如何使用 Objective-C 获取 Cocoa 中的当前时间？

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2009-04-13T06:17:40.323

首先，您应该阅读[Cocoa 的日期和时间编程主题](http://developer.apple.com/documentation/Cocoa/Conceptual/DatesAndTimes/DatesAndTimes.html#//apple_ref/doc/uid/10000039)。这将使您很好地理解如何使用 Cocoa 中提供的各种日期/时间/日历对象来进行日期的高级转换。

但是，此代码片段将回答您的具体问题：

```
- (NSInteger)currentHour
{
    // In practice, these calls can be combined
    NSDate *now = [NSDate date];
    NSCalendar *calendar = [NSCalendar currentCalendar];
    NSDateComponents *components = [calendar components:NSHourCalendarUnit fromDate:now];

    return [components hour];
} 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-13T06:16:13.027

一种方法是使用 NSCalendar 和 NSDateComponents

```
NSDate *now = [NSDate date];
NSCalendar *calendar = [NSCalendar currentCalendar];
NSDateComponents *components = [calendar components:NSHourCalendarUnit fromDate:now];
NSInteger hour = [components hour]; 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-10-06T21:31:36.417

我也是 Cocoa 的新手，我很高兴我找到了这个。我还想补充一点，您可以轻松地将其设为在一个 NSDateComponents 对象中返回当前小时、分钟和秒的函数。像这样：

```
// Function Declaration (*.h file)
-(NSDateComponents *)getCurrentDateTime:(NSDate *)date;

// Implementation
-(NSDateComponents *)getCurrentDateTime:(NSDate *)date
{
    NSDate *now = [NSDate date];
    NSCalendar *calendar = [NSCalendar currentCalendar];
    NSDateComponents *comps = [calendar components:NSHourCalendarUnit + NSMinuteCalendarUnit + NSSecondCalendarUnit fromDate:now];
    return comps;

}

// call and usage

NSDateComponents *today = [self getCurrentDateTime:[NSDate date]];
        hour = [today hour];
        minute = [today minute];
        second = [today second]; 
```

如您所见，NSCalendar 对象中的 components 参数是一个有点明智的枚举，您可以使用“+”组合枚举值

只是想我会做出贡献，因为我能够使用这些示例来创建我的示例。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-13T06:17:07.453

```
[NSDate date] 
```

那是当前时间，根据需要解析出小时。您没有提供很多关于您所指的确切时间的详细信息 - 例如，格式化为当前时区？还是另一种？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2015-03-21T05:08:51.710

斯威夫特版本

```
func currentHour() -> Int {
    let now = NSDate()
    let calendar = NSCalendar.currentCalendar()
    let components = calendar.components(.Hour, fromDate: now)

    return components.hour
} 
```

# c# - 使用 Moq、Silverlight 和 NUnit 进行单元测试

> ID：743147
> 
> 赞同：11
> 
> 时间：2009-04-13T06:00:01.940
> 
> 标签：c#, silverlight, nunit, moq

我正在尝试对 Silverlight 3 项目进行单元测试。我在用：

*   起订量.Silverlight (3.0.308.2)
*   NUnitSilverlight ( [http://www.jeff.wilcox.name/2009/01/nunit-and-silverlight/](http://www.jeff.wilcox.name/2009/01/nunit-and-silverlight/) )

当我编写一个不使用[Moq](http://code.google.com/p/moq/)的测试时，它可以正常工作。

当我在测试之外使用 Moq 时，Moq 可以正常工作。（我模拟了一个界面并在按钮处理程序中进行了验证作为证明。）

但是当我运行一个使用 Moq 的单元测试时，我总是得到这个：

```
System.IO.FileNotFoundException: Could not load file or assembly 'System, Version=2.0.5.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e' or one of its dependencies. The system cannot find the file specified.
at Moq.ExpressionExtensions.ToStringFixVisitor..ctor(Expression expression)
at Moq.Interceptor.AddCall(IProxyCall call, SetupKind kind) in c:\Build\Moq Drop\moq\WorkingDirectory\trunk\Source\Interceptor.cs: line 104
at Moq.Mock.<>c__DisplayClassc`2.<Setup>b__b() in c:\Build\Moq Drop\moq\WorkingDirectory\trunk\Source\Mock.cs: line 387
at Moq.PexProtector.Invoke<T>(Func`1 function) in c:\Build\Moq Drop\moq\WorkingDirectory\trunk\Source\PexProtector.cs: line 17
at Moq.Mock.Setup<T1,TResult>(Mock mock, Expression`1 expression) in c:\Build\Moq Drop\moq\WorkingDirectory\trunk\Source\Mock.cs: line 371
at Moq.Mock`1.Setup<TResult>(Expression`1 expression) in c:\Build\Moq Drop\moq\WorkingDirectory\trunk\Source\Mock.Generic.cs: line 194
at SilverlightMoq.Test1.TestFirst() in Test1.cs: line 23 
```

如何修复？

* * *

我为 SL 3 重建了两个程序集，结果相同。

我能够在 Microsoft Silverlight 单元测试框架上运行测试。

[http://code.msdn.microsoft.com/silverlightut/](http://code.msdn.microsoft.com/silverlightut/)

这是浏览器内测试框架，似乎是单元测试 SL 的标准方法。问题是：

1.  您必须一次运行所有测试

2.  它非常缓慢。

    （比在 nunit 测试框架中运行的相同测试慢约 5 倍）

有谁知道任何其他 SL 测试框架或针对该框架运行测试的更好方法？

当我尝试使用 TestDriven.Net 的 vs 插件时，出现错误：

System.IO.FileNotFoundException：无法加载文件或程序集“系统，...

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2010-07-22T13:30:29.600

感谢 Lee 提供的信息和他提供的链接（[http://weblogs.asp.net/nunitaddin/archive/2008/05/01/silverlight-nunit-projects.aspx](http://weblogs.asp.net/nunitaddin/archive/2008/05/01/silverlight-nunit-projects.aspx)），我能够获得我的 Silverlight [NUnit](http://en.wikipedia.org/wiki/NUnit)在[Hudson](http://en.wikipedia.org/wiki/Hudson_%28software%29)中运行代码覆盖率的测试！很棒的东西嘿！而且它们还与[ReSharper](http://en.wikipedia.org/wiki/ReSharper)一起运行，所以我觉得我不再因为在 Silverlight中执行[TDD而受到惩罚（延迟 20 秒）。](http://en.wikipedia.org/wiki/Test-driven_development)

那么，我到底做了什么？

*   我为 SL3 制作了一个 Silverlight 单元测试框架项目：

    （[http://www.jeff.wilcox.name/2010/05/sl3-utf-bits/](http://www.jeff.wilcox.name/2010/05/sl3-utf-bits/)）

*   然后我将所有测试项目的 Silverlight 程序集的引用（“mscorlib”除外）更改为“复制本地：真”，详见：

    ( [http://weblogs.asp.net/nunitaddin/archive/2008/05/01/silverlight-nunit-projects.aspx](http://weblogs.asp.net/nunitaddin/archive/2008/05/01/silverlight-nunit-projects.aspx) )

*   然后我添加了对以下博客中提供的 Silverlight NUnit 2.5.1 框架的引用（我在下面提到的博客中 Jeff Willcox 和上面他的博客中的 Jamie Cansdale 提供了其他版本，但这是我找到的最新版本）：

    （[http://wesmcclure.tumblr.com/post/152727000](http://wesmcclure.tumblr.com/post/152727000)）

*   而已！之后，我可以编写我的测试，在 ReSharper 和 NUnit 测试运行器中运行它们！另外，我可以使用 ncover 来获取覆盖率报告！！！

*   编辑：哦，是的，如果您运行任何需要 UI 线程的测试，您将在 ReSharper 中遇到跨线程错误。这可以通过在`Deployment.Current.Dispatcher.BeginInvoke(...)`调用中执行这些测试来解决。

*   在为我的测试使用单元后，我无法从 SL 测试框架 Web 界面运行它们，但这对我来说不是什么大问题。如果您确实需要使其正常工作，请查看：

    （[http://www.jeff.wilcox.name/2009/01/nunit-and-silverlight/](http://www.jeff.wilcox.name/2009/01/nunit-and-silverlight/)）

*   PS：我还为 NUnit 控制台运行程序创建了一个 NUnit 项目，以便从 NUnit 控制台运行我的测试（不要尝试在同一个 NUnit 项目中包含您的非 SL 测试程序集，它不会工作，因为它使用不同的 nunit。框架库）。

我还尝试了 StatLight ( [http://statlight.codeplex.com/](http://statlight.codeplex.com/) ) 从控制台运行测试，这对我来说效果很好，但我是 ReSharper 和 NUnit 的粉丝，所以这对我来说不是最好的选择. StatLight 还有一个奇怪的错误，它没有正确加载我的测试项目资源，导致一些测试失败。

我希望这对某人有所帮助。我在这里没有想出任何新东西，只是整合了我希望有人预先为我总结的所有信息。当我有时间时，我将在博客中介绍如何使用 SilverLight创建一个 Habanero 框架 ( [http://www.habanerolabs.com ) 项目。](http://www.habanerolabs.com)

唷。这就是所有的人！

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-13T08:18:27.507

目前的答案似乎是 Jamie Cansdale 的 Silverlight Nunit 项目模板：

[http://weblogs.asp.net/nunitaddin/archive/2008/05/01/silverlight-nunit-projects.aspx](http://weblogs.asp.net/nunitaddin/archive/2008/05/01/silverlight-nunit-projects.aspx)

这个模板很棒，正是我想要的。它也适用于 Resharper！我希望这可以节省其他人几个小时。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-13T15:40:31.280

我构建了一个用于持续集成和加速通用 Silverlight TDD 的工具......

[http://www.StatLight.net](http://www.StatLight.net)

它现在完全支持编译为在 Silverlight 下运行的任何版本的 NUnit。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-29T13:13:57.880

对我有用的是确保“复制本地”属性（在参考系统的 IDE 属性网格 (F4) 中）设置为 true。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-13T06:58:34.267

听起来像是 Silverlight 3 的问题。你能获得 Moq.Silverlight 和 NUnitSilverlight 的源代码并在 silverlight 3 二进制文件上构建它们吗？这些似乎是用 SL 2 构建的。

# vim - 如何防止 vim 创建（和留下）临时文件？

> ID：743150
> 
> 赞同：184
> 
> 时间：2009-04-13T06:07:54.717
> 
> 标签：vim, text-editor, temporary-files

vim 为什么要创建`<filename>~`文件？有没有办法禁用它？

如果是用于备份（或其他），我会使用 git。

此外，这些`.<filename.with.path.hints>.swp`文件也是如此。

我如何告诉 vim 不要创建这些，或者至少要自行清理？

**编辑**

哎呀，重复：

> [为什么 Vim 使用 ~ 扩展名保存文件？](https://stackoverflow.com/questions/607435/why-does-vim-save-files-with-a-extension)

我从那里采用了[rogeriopvl的回答](https://stackoverflow.com/questions/607435/why-does-vim-save-files-with-a-extension/607474#607474)。

逐字复制：

```
set nobackup       "no backup files
set nowritebackup  "only in case you don't want a backup file while editing
set noswapfile     "no swap files 
```

* * *

## 回答 #1

> 赞同：87
> 
> 时间：2009-04-15T07:48:29.433

我强烈建议继续使用交换文件（以防 Vim 崩溃）。

您可以设置存储交换文件的目录，这样它们就不会弄乱您的正常目录：

```
set swapfile
set dir=~/tmp 
```

也可以看看

```
:help swap-file 
```

* * *

## 回答 #2

> 赞同：61
> 
> 时间：2009-04-13T06:10:13.400

把它放在你的 .vimrc 配置文件中。

```
set nobackup 
```

* * *

## 回答 #3

> 赞同：39
> 
> 时间：2011-06-16T05:20:02.297

; 让 Windows 用户回到临时目录

```
set backup
set backupdir=C:\WINDOWS\Temp
set backupskip=C:\WINDOWS\Temp\*
set directory=C:\WINDOWS\Temp
set writebackup 
```

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2017-04-07T19:56:29.790

在 Windows 上将以下行添加到 _vimrc

```
" store backup, undo, and swap files in temp directory
set directory=$HOME/temp//
set backupdir=$HOME/temp//
set undodir=$HOME/temp// 
```

* * *

## 回答 #5

> 赞同：13
> 
> 时间：2017-08-17T03:08:45.297

This answer applies to using gVim on Windows 10\. I cannot guarantee the same results for other operating systems.

Add:

```
set nobackup
set noswapfile
set noundofile 
```

To your _vimrc file.

Note: This is the direct answer to the question (for Windows 10) and probably not the safest thing to do (read the other answers), but this is the fastest solution in my case.

* * *

## 回答 #6

> 赞同：11
> 
> 时间：2014-11-24T19:08:03.803

我制作了一个名为“noswapsuck”的插件，仅当缓冲区包含未保存的更改时才启用交换文件。保存更改后，将清除交换文件。因此，与磁盘上的文件包含相同内容的交换文件将被删除。

在这里获取：[`noswapsuck.vim`](https://github.com/joeytwiddle/rc_files/blob/master/.vim/plugin/noswapsuck.vim)

它对我来说效果很好，但我以前从未公开过它，所以我欢迎反馈。

优点：

*   唯一保留在磁盘上的交换文件将是与文件实际不同的重要交换文件！

缺点：

*   ~~如果缓冲区有交换文件，则在第一次打开文件时不会检测到它。只有在启用时才会检测到它`swapfile`，即当您开始编辑缓冲区时。那太烦人了，会打断你。~~ （已解决：我们现在在打开缓冲区时检查预先存在的交换文件，方法是`swapfile`再次临时打开该选项。）

*   如果您在希望最小化磁盘写入的环境中工作（例如，低功耗，或通过网络挂载的文件，或编辑大文件），那么在每个磁盘上继续删除和重新创建交换文件并不理想。保存和编辑。在这种情况下，您可以这样做：

    ```
    :let g:NoSwapSuck_CloseSwapfileOnWrite = 0 
    ```

    这将在写入后保留交换文件，但在缓冲区失去焦点时仍将其删除。

顺便说一句，我还有另一个小插件[`:DiffAgainstFileOnDisk`](https://github.com/joeytwiddle/rc_files/blob/master/.vim/plugin/diff_against_file_on_disk.vim)，它在点击后非常有用`(r)ecover`，可以检查您恢复的缓冲区是比现有文件新还是旧，或者与现有文件相同。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2020-05-04T04:06:13.953

我在我的 Ubuntu .vimrc 中有这个设置。我的项目文件中没有看到任何交换文件。

```
set undofile
set undolevels=1000         " How many undos
set undoreload=10000        " number of lines to save for undo

set backup                        " enable backups
set swapfile                      " enable swaps
set undodir=$HOME/.vim/tmp/undo     " undo files
set backupdir=$HOME/.vim/tmp/backup " backups
set directory=$HOME/.vim/tmp/swap   " swap files

" Make those folders automatically if they don't already exist.
if !isdirectory(expand(&undodir))
    call mkdir(expand(&undodir), "p")
endif
if !isdirectory(expand(&backupdir))
    call mkdir(expand(&backupdir), "p")
endif
if !isdirectory(expand(&directory))
    call mkdir(expand(&directory), "p")
endif 
```

# java - 用于标记 TIFF 文件的 Java API

> ID：743154
> 
> 赞同：3
> 
> 时间：2009-04-13T06:12:34.983
> 
> 标签：java, tiff

是否有用于标记 TIFF 图像文件的开源 Java API？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-13T06:25:02.023

我认为 Apache Commons Sanselan 可能会满足您的需求

[http://commons.apache.org/imaging/](http://commons.apache.org/imaging/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-13T06:36:55.440

还有用于操作各种图像和绘制图形的 Java 2D API。

[http://java.sun.com/docs/books/tutorial/2d/index.html](http://java.sun.com/docs/books/tutorial/2d/index.html)

# asp.net - 从javascript调用vb链接按钮（在用户控件内）单击事件

> ID：743155
> 
> 赞同：0
> 
> 时间：2009-04-13T06:12:40.210
> 
> 标签：asp.net, javascript, vb.net, user-controls, .net-3.0

如何从 usercontrol.ascx 中的 clickhandler(e) 中的 javascript 函数调用 VB 函数 - usercontrol.ascx.vb 中的 deleteevent()。该调用应该会导致回发，因为我需要用户控件来显示更改。

我目前正在尝试通过使用带有样式显示的链接按钮来做到这一点：无，并从 javascript 函数中调用其点击事件。但我不知道如何调用点击事件。

我必须从 javascript 向 vb 函数传递一个值，但我正在使用隐藏字段来处理它。

环境是asp.net 3.0 语言：vb

谢谢。

KK

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-13T14:29:24.777

尝试查看 __doPostBack 函数，它是 ASP.NET 用来触发链接按钮和其他控件的回发，但可以从任何其他 JavaScriptcript 函数中使用。

可以在[此处](http://aspalliance.com/895_Understanding_the_JavaScript___doPostBack_Function.all)找到有关该主题的带有示例的好文章。

# python - 如何模拟 do-while 循环？

> ID：743164
> 
> 赞同：995
> 
> 时间：2009-04-13T06:18:42.693
> 
> 标签：python, while-loop, do-while

我需要在 Python 程序中模拟一个 do-while 循环。不幸的是，以下简单的代码不起作用：

```
list_of_ints = [ 1, 2, 3 ]
iterator = list_of_ints.__iter__()
element = None

while True:
  if element:
    print element

  try:
    element = iterator.next()
  except StopIteration:
    break

print "done" 
```

它打印以下输出，而不是“1,2,3,done”：

```
[stdout:]1
[stdout:]2
[stdout:]3
None['Traceback (most recent call last):
', '  File "test_python.py", line 8, in <module>
    s = i.next()
', 'StopIteration
'] 
```

我该怎么做才能捕获“停止迭代”异常并正确中断 while 循环？

下面以伪代码的形式显示了为什么需要这样的东西的示例。

状态机：

```
s = ""
while True :
  if state is STATE_CODE :
    if "//" in s :
      tokens.add( TOKEN_COMMENT, s.split( "//" )[1] )
      state = STATE_COMMENT
    else :
      tokens.add( TOKEN_CODE, s )
  if state is STATE_COMMENT :
    if "//" in s :
      tokens.append( TOKEN_COMMENT, s.split( "//" )[1] )
    else
      state = STATE_CODE
      # Re-evaluate same line
      continue
  try :
    s = i.next()
  except StopIteration :
    break 
```

* * *

## 回答 #1

> 赞同：1226
> 
> 时间：2009-04-13T06:28:43.760

我不确定您要做什么。你可以像这样实现一个 do-while 循环：

```
while True:
  stuff()
  if fail_condition:
    break 
```

或者：

```
stuff()
while not fail_condition:
  stuff() 
```

你在做什么尝试使用 do while 循环来打印列表中的内容？为什么不直接使用：

```
for i in l:
  print i
print "done" 
```

更新：

那么你有一个行列表吗？你想继续迭代它吗？怎么样：

```
for s in l: 
  while True: 
    stuff() 
    # use a "break" instead of s = i.next() 
```

这看起来像你想要的吗？使用您的代码示例，它将是：

```
for s in some_list:
  while True:
    if state is STATE_CODE:
      if "//" in s:
        tokens.add( TOKEN_COMMENT, s.split( "//" )[1] )
        state = STATE_COMMENT
      else :
        tokens.add( TOKEN_CODE, s )
    if state is STATE_COMMENT:
      if "//" in s:
        tokens.append( TOKEN_COMMENT, s.split( "//" )[1] )
        break # get next s
      else:
        state = STATE_CODE
        # re-evaluate same line
        # continues automatically 
```

* * *

## 回答 #2

> 赞同：365
> 
> 时间：2010-03-14T00:09:54.823

这是模拟 do-while 循环的一种非常简单的方法：

```
condition = True
while condition:
    # loop body here
    condition = test_loop_condition()
# end of loop 
```

do-while 循环的关键特性是循环体总是至少执行一次，并且条件在循环体的底部进行评估。此处显示的控制结构无需异常或中断语句即可完成这两项工作。它确实引入了一个额外的布尔变量。

* * *

## 回答 #3

> 赞同：91
> 
> 时间：2014-11-23T23:37:17.577

我下面的代码可能是一个有用的实现，突出了我所理解的[do-while](/questions/tagged/do-while "显示标记为“do-while”的问题")与[while](/questions/tagged/while "显示标记为“同时”的问题")之间的主要区别。

因此，在这种情况下，您总是至少经历一次循环。

```
first_pass = True
while first_pass or condition:
    first_pass = False
    do_stuff() 
```

* * *

## 回答 #4

> 赞同：37
> 
> 时间：2009-04-13T13:57:02.997

```
do {
  stuff()
} while (condition()) 
```

->

```
while True:
  stuff()
  if not condition():
    break 
```

你可以做一个功能：

```
def do_while(stuff, condition):
  while condition(stuff()):
    pass 
```

但是1）它很丑。2) Condition 应该是一个带有一个参数的函数，应该由一些东西填充（这是*不*使用经典 while 循环的唯一原因。）

* * *

## 回答 #5

> 赞同：34
> 
> 时间：2009-04-13T07:06:40.800

异常会打破循环，所以你不妨在循环外处理它。

```
try:
  while True:
    if s:
      print s
    s = i.next()
except StopIteration:   
  pass 
```

我猜你的代码的问题是没有定义`break`inside的行为。`except`通常`break`只向上一级，因此例如`break`inside`try`直接进入`finally`（如果存在）一个 out of the `try`，但不是 out of the loop。

相关 PEP：[http](http://www.python.org/dev/peps/pep-3136)
://www.python.org/dev/peps/pep-3136 相关问题：[打破嵌套循环](https://stackoverflow.com/questions/653509/breaking-out-of-nested-loops)

* * *

## 回答 #6

> 赞同：17
> 
> 时间：2009-11-02T17:32:02.063

这是一个不同模式的更疯狂的解决方案——使用协程。代码仍然非常相似，但有一个重要区别；根本没有退出条件！当您停止向其提供数据时，协程（实际上是协程链）就会停止。

```
def coroutine(func):
    """Coroutine decorator

    Coroutines must be started, advanced to their first "yield" point,
    and this decorator does this automatically.
    """
    def startcr(*ar, **kw):
        cr = func(*ar, **kw)
        cr.next()
        return cr
    return startcr

@coroutine
def collector(storage):
    """Act as "sink" and collect all sent in @storage"""
    while True:
        storage.append((yield))

@coroutine      
def state_machine(sink):
    """ .send() new parts to be tokenized by the state machine,
    tokens are passed on to @sink
    """ 
    s = ""
    state = STATE_CODE
    while True: 
        if state is STATE_CODE :
            if "//" in s :
                sink.send((TOKEN_COMMENT, s.split( "//" )[1] ))
                state = STATE_COMMENT
            else :
                sink.send(( TOKEN_CODE, s ))
        if state is STATE_COMMENT :
            if "//" in s :
                sink.send(( TOKEN_COMMENT, s.split( "//" )[1] ))
            else
                state = STATE_CODE
                # re-evaluate same line
                continue
        s = (yield)

tokens = []
sm = state_machine(collector(tokens))
for piece in i:
    sm.send(piece) 
```

上面的代码将所有标记收集为元组，我假设原始代码之间`tokens`没有区别。`.append()``.add()`

* * *

## 回答 #7

> 赞同：17
> 
> 时间：2018-06-23T20:00:26.973

我这样做的方式如下...

```
condition = True
while condition:
     do_stuff()
     condition = (<something that evaluates to True or False>) 
```

在我看来，这似乎是一个简单的解决方案，我很惊讶我还没有在这里看到它。这显然也可以反转为

```
while not condition: 
```

等等

* * *

## 回答 #8

> 赞同：13
> 
> 时间：2020-09-08T08:10:00.420

Python 3.8 给出了答案。

它被称为赋值表达式。从[文档](https://docs.python.org/3/whatsnew/3.8.html#assignment-expressions)：

```
# Loop over fixed length blocks
while (block := f.read(256)) != '':
    process(block) 
```

* * *

## 回答 #9

> 赞同：10
> 
> 时间：2011-05-10T22:03:06.030

for 包含 try 语句的 do - while 循环

```
loop = True
while loop:
    generic_stuff()
    try:
        questionable_stuff()
#       to break from successful completion
#       loop = False  
    except:
        optional_stuff()
#       to break from unsuccessful completion - 
#       the case referenced in the OP's question
        loop = False
   finally:
        more_generic_stuff() 
```

或者，当不需要“finally”子句时

```
while True:
    generic_stuff()
    try:
        questionable_stuff()
#       to break from successful completion
#       break  
    except:
        optional_stuff()
#       to break from unsuccessful completion - 
#       the case referenced in the OP's question
        break 
```

* * *

## 回答 #10

> 赞同：8
> 
> 时间：2021-05-02T19:17:59.627

我相信这种在 python 上的 do-while 模拟具有最接近 C 和 Java 中存在的 do-while 结构格式的语法格式。

```
do = True
while do:
    [...]
    do = <condition> 
```

* * *

## 回答 #11

> 赞同：7
> 
> 时间：2010-11-30T01:38:03.477

```
while condition is True: 
  stuff()
else:
  stuff() 
```

* * *

## 回答 #12

> 赞同：7
> 
> 时间：2013-04-21T21:42:57.920

快速破解：

```
def dowhile(func = None, condition = None):
    if not func or not condition:
        return
    else:
        func()
        while condition():
            func() 
```

像这样使用：

```
>>> x = 10
>>> def f():
...     global x
...     x = x - 1
>>> def c():
        global x
        return x > 0
>>> dowhile(f, c)
>>> print x
0 
```

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2009-04-13T06:23:44.537

你为什么不做

```
for s in l :
    print s
print "done" 
```

?

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2009-04-13T08:17:55.697

看看这是否有帮助：

在异常处理程序中设置一个标志并在处理 s 之前检查它。

```
flagBreak = false;
while True :

    if flagBreak : break

    if s :
        print s
    try :
        s = i.next()
    except StopIteration :
        flagBreak = true

print "done" 
```

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2018-05-06T06:01:43.663

如果您处于循环时资源不可用或类似的引发异常的情况，您可以使用类似的东西

```
import time

while True:
    try:
       f = open('some/path', 'r')
    except IOError:
       print('File could not be read. Retrying in 5 seconds')   
       time.sleep(5)
    else:
       break 
```

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2020-03-08T10:08:22.363

对我来说，一个典型的 while 循环将是这样的：

```
xBool = True
# A counter to force a condition (eg. yCount = some integer value)

while xBool:
    # set up the condition (eg. if yCount > 0):
        (Do something)
        yCount = yCount - 1
    else:
        # (condition is not met, set xBool False)
        xBool = False 
```

如果情况允许，我也可以在 while 循环中包含一个*for..loop*，用于循环另一组条件。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2021-03-13T18:36:04.887

你想知道：

> **我该怎么做才能捕获“停止迭代”异常并正确中断 while 循环？**

您可以如下所示执行此操作，这还利用了 Python 3.8 中引入的[赋值表达式](https://docs.python.org/3.8/whatsnew/3.8.html#assignment-expressions)功能（又名“海象运算符”）：

```
list_of_ints = [1, 2, 3]
iterator = iter(list_of_ints)

try:
    while (element := next(iterator)):
        print(element)
except StopIteration:
    print("done") 
```

另一种可能性（适用于 Python 2.6 到 3.x）是为*`default`*内置[`next()`](https://docs.python.org/3/library/functions.html#next)函数提供一个参数以避免`StopIteration`异常：

```
SENTINEL = object()  # Unique object.
list_of_ints = [1, 2, 3]
iterator = iter(list_of_ints)

while True:
    element = next(iterator, SENTINEL)
    if element is SENTINEL:
        break
    print(element)

print("done") 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2020-06-28T19:00:48.870

内置的[iter](https://docs.python.org/3/library/functions.html?highlight=iter#iter)函数专门执行以下操作：

```
for x in iter(YOUR_FN, TERM_VAL):
    ... 
```

例如（在 Py2 和 3 中测试）：

```
class Easy:
  X = 0
  @classmethod
  def com(cls):
    cls.X += 1
    return cls.X

for x in iter(Easy.com, 10):
  print(">>>", x) 
```

如果你想给出一个终止条件而不是一个值，你总是可以设置一个等式，并要求该等式为`True`。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2022-03-03T17:51:03.800

**While循环：**

```
while condition:
  logic 
```

**做while循环：**

```
while True:
  logic
  if not condition:
    break 
```

# perl - 如何在 Perl 中按键对哈希进行排序？

> ID：743167
> 
> 赞同：6
> 
> 时间：2009-04-13T06:20:40.177
> 
> 标签：perl, sorting, hash

我想对实际上具有哈希值的哈希进行排序。例如：

```
my %hash1=(
   field1=>"",
   field2=>"",
   count=>0,
);
my %hash2;
$hash2{"asd"}={%hash1}; 
```

`%hash2`我用不同的计数值插入了很多哈希值`%hash2`。

如何`%hash1`根据计数值排序`hash1`？

有没有办法在不手动实现快速排序的情况下做到这一点，例如使用 Perl 的排序功能？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-13T06:30:15.193

```
my @hash1s = sort {$a->{count} <=> $b->{count}} values %hash2; 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-13T17:45:35.850

在[perlfaq4中，](http://faq.perl.org/perlfaq4.html) [“http://faq.perl.org/perlfaq4.html#How_do_I_sort_a_hash”](http://faq.perl.org/perlfaq4.html#How_do_I_sort_a_hash)的答案包含了将代码放在一起所需的大部分信息。

您可能还想查看*学习 Perl*中的排序章节。

克里斯有一个完全好的答案，虽然我讨厌`values`这样使用。做同样事情的一种更熟悉的方法是遍历顶级哈希的键，但按二级键排序：

```
my @sorted_hashes = 
    sort { $hash2->{$a}{count} <=> $hash2->{$b}{count} } 
    keys %hash2; 
```

我这样做是因为它不那么令人费解。

* * *

如何对哈希进行排序（可选按值而不是键）？

（由布赖恩·d·福伊提供）

要对哈希进行排序，请从键开始。在此示例中，我们将键列表提供给排序函数，然后按 ASCII 顺序比较它们（这可能会受到您的语言环境设置的影响）。输出列表具有按 ASCII 顺序排列的键。一旦我们有了密钥，我们就可以通过它们来创建一个以 ASCII 顺序列出密钥的报告。

```
my @keys = sort { $a cmp $b } keys %hash;

foreach my $key ( @keys )
    {
    printf "%-20s %6d\n", $key, $hash{$key};
    } 
```

不过，我们可以在 sort() 块中获得更多花哨。我们可以用它们计算一个值并将该值用作比较，而不是比较键。

例如，为了使我们的报告顺序不区分大小写，我们在双引号字符串中使用 \L 序列来使所有内容都小写。然后 sort() 块比较小写的值以确定放置键的顺序。

```
my @keys = sort { "\L$a" cmp "\L$b" } keys %hash; 
```

注意：如果计算量很大或哈希有很多元素，您可能需要查看 Schwartzian 变换来缓存计算结果。

如果我们想按哈希值排序，我们使用哈希键来查找它。我们仍然得到一个键列表，但这次它们是按它们的值排序的。

```
my @keys = sort { $hash{$a} <=> $hash{$b} } keys %hash; 
```

从那里我们可以变得更复杂。如果哈希值相同，我们可以对哈希键进行二次排序。

```
my @keys = sort {
    $hash{$a} <=> $hash{$b}
        or
    "\L$a" cmp "\L$b"
    } keys %hash; 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-13T06:33:27.273

如果您想从 hash2 中的值中获取按计数排序的哈希列表（如 hash1），这可能会有所帮助：

```
@sorted_hash1_list = sort sort_hash_by_count_key($a, $b) (values (%hash2);

# This method can have any logic you want
sub sort_hash_by_count_key {
    my ($a, $b) = @_;
    return $a->{count} <=> $b->{count};
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-13T06:55:40.980

请参阅[http://perldoc.perl.org/functions/sort.html](http://perldoc.perl.org/functions/sort.html)了解有关在 Perl 中排序如何工作的大量上下文。

这是一个例子.. 试图可读，而不是腐烂。

```
#!/usr/bin/perl
# Sort Hash of Hashes by sub-hash's element count.
use warnings;
use strict;

my $hash= {
            A=>{C=>"D",0=>"r",T=>"q"}
           ,B=>{}
           ,C=>{E=>"F",G=>"H"}
          };

sub compareHashKeys {0+(keys %{$hash->{$a}}) <=> 0+(keys %{$hash->{$b}}) }

my @SortedKeys = sort compareHashKeys keys %{$hash};
print join ("," , @SortedKeys) ."\n"; 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-06-01T15:29:06.823

要按数字排序，请使用 <=>，对于字符串，请使用 cmp。

```
# sort by the numeric count field on inner hash
#
foreach my $key (sort {$hash2{$a}->{'count'} <=> $hash2{$b}->{'count'}} keys %hash2) {
   print $key,$hash2{$key}->{'count'},"\n";
}

# sort by the string field1 (or field2) on the inner hash
#
foreach my $key (sort {$hash2{$a}->{'field1'} cmp $hash2{$b}->{'field1'}} keys %hash2) {
   print $key,$hash2{$key}->{'field1'},"\n";
} 
```

要反转顺序，只需交换 $a 和 $b：

```
# sort by the numeric count field on inner hash
#
foreach my $key (sort {$hash2{$a}->{'count'} <=> $hash2{$b}->{'count'}} keys %hash2) {
   print $key,$hash2{$key}->{'count'},"\n";
}

# sort by the string field1 (or field2) on the inner hash
#
foreach my $key (sort {$hash2{$a}->{'field1'} cmp $hash2{$b}->{'field1'}} keys %hash2) {
   print $key,$hash2{$key}->{'field1'},"\n";
} 
```

# .net - scala.net 生产准备好了吗？

> ID：743172
> 
> 赞同：43
> 
> 时间：2009-04-13T06:22:32.667
> 
> 标签：.net, scala

Scala 似乎也有一个 .NET 实现。我想知道它是否是一个完整的实现，没有松散的结局，或者只是一个展示的东西。

这很重要，因为我们要开发的应用程序除了 Web 上的主要实现外，还应该有 Windows GUI。拥有一种可以在两个实现之间移植核心代码的语言看起来像是一个交易撮合者。

有人从事过 Scala 的 .NET 实现吗？任何反馈？

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2009-04-13T14:56:35.473

我听说 .NET 方面已经获得了新的资金，但目前距离“生产就绪”甚至“可用”还有很大的距离。很长一段时间以来，还没有一个有意义地触及 .NET 方面的签入。

**2010 年 1 月 15 日更新：**发给 Scala 列表之一的最新消息。

来自：卢卡斯·里茨

2010 年 1 月 15 日星期五 03:18，Naftoli Gugenheim 写道：

> 不确定这是否是您要查找的内容，但
> 根据其文档/网站，我认为 H2 可以在 .NET 上运行。
> 如果您正在寻找用 Scala 编程的数据库引擎，我个人
> 还没有听说过，但这并不意味着什么。
> 如果您的意思是 ORM 等，则有一些。
> 您甚至可以在非 Lift 应用程序中使用 Lift Mapper （仅包括 webkit 和 util jars IIRC）。
> .NET 上 Scala 的状态如何？

我们正在努力引导编译器，并在此过程中修复 MSIL-Backend-Bugs。EPFL 将提供在 .NET 上运行的编译器（至少在第一个版本中使用 IKVM.OpenJDK.Core.dll）

现在，我们有一个在 JVM 上运行的交叉编译器，以及在 .NET 上运行的 scala-library.jar 的简化版本。

对于某些部分，我们将依赖社区（例如将更多的 scala-library.jar 移植到 .NET）。

卢卡斯

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2011-02-16T13:02:50.973

Martin Odersky 在这次[SE Radio 采访](http://www.se-radio.net/2011/02/episode-171-scala-update-with-martin-odersky/)（2011 年 1 月）中说：

> 我不想给你一个预计的到达时间，但应该是今年，包括视觉工作室支持。

他在第 15 分钟开始谈论 .NET。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-04-13T07:03:53.130

维基[百科条目](http://en.wikipedia.org/wiki/Scala_(programming_language))声称：

> .NET 平台存在替代实现，但尚未保持最新。（需要引用）

常见问题解答的[“限制”部分](http://www.scala-lang.org/faq/5)有以下条目：

> Scala 可以在 .Net 上运行吗？
> 
> 是的，当前的 Scala 发行版可以为 .Net 平台编译程序。.Net 平台与 Java 有许多相似之处，但也有许多特性，因此维护此端口是一项复杂的任务。在这个阶段，MSIL/.Net 版本的 Scala 几乎实现了整个 Scala 语言和大多数标准库。一个重要的限制是结构类型还不能在 .NET 上工作。使用特别复杂的异常处理程序时可能仍然存在问题。由于 .Net 的特殊性，少数库不可用，并且不支持与其他 .Net 语言的交互。有关更多详细信息，请参阅此（可能有点过时）文档页面。

[将Scala 与 .NET 结合使用](http://www.scala-lang.org/node/168)的指南谈到了 1.4 版，该版本现在已经相当老了。另一方面，文档似乎是在 2008 年才编写的，包括[“.NET 上的 Scala：怪癖”](http://www.scala-lang.org/node/169)页面，这听起来很重要。

自己没有任何经验，听起来支持是一瘸一拐的，但.NET 端口并不是真正的一等公民。.NET 上的 Scala 没有“嗡嗡声”这一事实（与 Java 版本相比）也不令人鼓舞。这听起来不像是我现在想用于商业软件的东西。当然，它可能很好，只是没有很好的营销。如果你真的热衷于这个想法，我会在[邮件列表中](http://www.scala-lang.org/node/199)询问。

为什么不将[Eclipse RCP](http://wiki.eclipse.org/index.php/Rich_Client_Platform)用于基于 Java/Scala 的 Windows 客户端，或者将 .NET 用于 Web 应用程序？

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2011-07-18T11:11:33.030

在 2011 年 7 月 18 日对 scala-lang.org 的采访中：

> 我现在可以在 .Net 上运行 Scala 程序吗？
> **米格尔**：
> 简单的答案是肯定的，但有一些限制将在秋季取消。

链接：[inteview](http://www.scala-lang.org/node/10299)
链接：[二进制文件](http://lampsvn.epfl.ch/svn-repos/scala/scala-experimental/trunk/bootstrap/)

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-06-07T23:32:36.787

目前 - 不，不是真的，这很遗憾，因为它是一种非常有趣的语言。

“Hello world”类型的程序，很好——甚至是花哨的技巧，比如编写一个简单的堆栈，其中一小段 Python（Jython 或 IronPython 下的相同代码）驱动同一个 Scala。

任何适度的负担——scalac-net 编译可以并且将会抛出，即使代码不使用 scala 命名空间之外的任何东西，并且在 JVM 上构建并通过一组相当详尽的单元测试。即使是相当简单的程序集（即使使用 .net 1.0 构建，以匹配 scala-msil 包中包含的 mscorlib 的低规格），它也可能会阻碍构建。

我的“适度征税”测试集包括以下实现，旨在弥补 .net 上当前的不足

*   BigInteger 的 C# 库的 Scala 端口（[来自 codeplex](http://www.codeplex.com/biginteger)，带有我自己的单元测试）
*   scala.actors 中 Java 代码的 Scala 端口

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2010-08-11T11:42:34.627

从 4 月的 Scala Days 2010 开始，Miguel Garcia 就在 Scala.NET 上工作。我相信他正在开发一个视觉工作室插件，我不确定事情进展如何，但是你可以在这里找到他工作的证据：

[http://lamp.epfl.ch/~magarcia/ScalaCompilerCornerReloaded/](http://lamp.epfl.ch/~magarcia/ScalaCompilerCornerReloaded/) [http://www.sts.tu-harburg.de/people/mi.garcia/ScalaCompilerCorner/MixedSourceScalaCSharp.pdf](http://www.sts.tu-harburg.de/people/mi.garcia/ScalaCompilerCorner/MixedSourceScalaCSharp.pdf) [http://www.sts.tu- harburg.de/people/mi.garcia/ScalaCompilerCorner/ScalaNetLearnsLINQTricks.pdf](http://www.sts.tu-harburg.de/people/mi.garcia/ScalaCompilerCorner/ScalaNetLearnsLINQTricks.pdf)

Miguel 现在在 EPFL 做他的博士后：http: [//lamp.epfl.ch/~magarcia/](http://lamp.epfl.ch/~magarcia/)

保罗（即席）的回答可能有更多最新信息，但如果我很好奇，我可能会直接问米格尔。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2011-07-16T10:11:19.533

> DDJ：有计划的 .NET 版本的 Scala 吗？
> 
> 莫：是的。我们在七月宣布了它。我们有一个项目，实际上是由微软资助的，用于构建 .NET 版本的 Scala。我们拥有在 .NET 上自行编译的编译器的第一个引导版本。还有很多工作要做，尤其是在 Visual Studio 集成方面。

[采访 Scala 的 Martin Odersky - 2011 年 7 月 14 日](http://drdobbs.com/231001802?pgno=2)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-06-20T22:18:09.763

查看 SVN 存储库，.net 空间中肯定有一些活动正在进行。里面有`2.7.x`一个`dotnet-library`目录，但是那个目录`2.8.x`和`trunk`. 相反，最近[4 个月前 rytz](http://lampsvn.epfl.ch/trac/scala/changeset/20826/scala/trunk/src/msil/ch/epfl/lamp/compiler/msil/emit)`msil`有一个目录发生了一些不平凡的事情。

所有可用的文档似乎都已经过时了，但也许值得向主要贡献者之一询问当前状态是什么。请注意，即兴的（一年多前已经回答过这个问题）似乎是其中之一。

# sql-server - 游标有什么问题？

> ID：743183
> 
> 赞同：13
> 
> 时间：2009-04-13T06:27:21.393
> 
> 标签：sql-server, oracle, data-structures, database-cursor

SQL Server 开发人员认为游标是一种不好的做法，除非在某些情况下。他们认为 Cursors 没有最佳地使用 SQL 引擎，因为它是一个过程构造并且破坏了基于集合的 RDBMS 概念。

但是，Oracle 开发人员似乎不建议反对 Cursors。Oracle 的 DML 语句本身就是隐式游标。

为什么在方法上有这种差异？是因为这两种产品的制造方式，还是这个建议适用于两种产品？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-04-14T12:47:10.940

游标的问题在于它们经常被滥用，无论是 in`Oracle`还是 in `MS SQL`。

光标用于保持稳定的结果集，您可以逐行检索。它们在您的查询运行时隐式创建，并在完成时关闭。

当然，保持这样的结果集需要一些资源：`locks`, `latches`, `memory`, 甚至`disk space`。

这些资源释放得越快越好。

**保持光标打开就像保持冰箱门打开一样**

**您不会在没有必要的情况下连续数小时这样做，但这并不意味着您永远不应该打开冰箱。**

这意味着：

*   您不会逐行获得结果并将它们求和：您改为调用`SQL`'s 。`SUM`
*   您不会执行整个查询并从游标中获取第一个结果：您将`rownum <= 10`条件附加到查询

， ETC。

至于`Oracle`，在过程中处理游标需要臭名昭著`SQL/PLSQL context switch`，每次`SQL`从游标中获得查询结果时都会发生这种情况。

它涉及在线程之间传递大量数据并同步线程。

这是最令人恼火的事情之一`Oracle`。

该行为的不太明显的后果之一是应尽可能避免使用 Oracle 中的触发器。

创建触发器并调用`DML`函数等于打开游标选择更新的行并为此游标的每一行调用触发器代码。

仅存在触发器（甚至是空触发器）可能会减慢`DML`操作速度`10 times`或更多。

上的测试脚本`10g`：

```
SQL> CREATE TABLE trigger_test (id INT NOT NULL)
  2  /

Table created

Executed in 0,031 seconds
SQL> INSERT
  2  INTO   trigger_test
  3  SELECT level
  4  FROM   dual
  5  CONNECT BY
  6     level <= 1000000
  7  /

1000000 rows inserted

Executed in 1,469 seconds
SQL> COMMIT
  2  /

Commit complete

Executed in 0 seconds
SQL> TRUNCATE TABLE trigger_test
  2  /

Table truncated

Executed in 3 seconds
SQL> CREATE TRIGGER trg_test_ai
  2  AFTER INSERT
  3  ON trigger_test
  4  FOR EACH ROW
  5  BEGIN
  6     NULL;
  7  END;
  8  /

Trigger created

Executed in 0,094 seconds
SQL> INSERT
  2  INTO   trigger_test
  3  SELECT level
  4  FROM   dual
  5  CONNECT BY
  6     level <= 1000000
  7  /

1000000 rows inserted

Executed in 17,578 seconds 
```

`1.47`没有触发器的`17.57`秒数，空触发器的秒数什么都不做。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-04-13T06:42:01.623

来自[MSDN：光标实现](http://msdn.microsoft.com/en-us/library/ms189546.aspx)

> 使用游标的效率低于使用默认结果集。在默认结果集中，从客户端发送到服务器的唯一数据包是包含要执行的语句的数据包。使用服务器游标时，每个 FETCH 语句都必须从客户端发送到服务器，在服务器上必须对其进行解析并编译成执行计划。
> 
> 如果 Transact-SQL 语句将返回一个相对较小的结果集，该结果集可以缓存在客户端应用程序可用的内存中，并且您知道在执行该语句之前必须检索整个结果集，请使用默认结果集。仅当需要游标操作来支持应用程序的功能时，或者可能只检索部分结果集时，才使用服务器游标。

我不是 Oracle DBA，所以我无法真正说出实现的不同之处。但是，从编程的角度来看，基于集合的操作几乎总是比在游标中处理结果要快。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-13T07:13:20.143

我一直被告知游标是邪恶的，但 MS SQL Server 大师总是告诉我，因为它的性能很差。关于 Oracle 的 PL/SQL [，我发现这句话说何时*使用*游标](http://www.dba-oracle.com/t_top_reasons_poor_performance.htm)：

> 不使用游标会导致重复解析。如果不使用绑定变量，则对所有 SQL 语句进行硬解析。这对性能有一个数量级的影响，而且完全不可扩展。将游标与打开游标并多次执行的绑定变量一起使用。对生成动态 SQL 的应用程序持怀疑态度。

由于游标是[在每个操作上](http://www.dbapool.com/articles/090706.html)[隐式创建](http://www.exforsys.com/tutorials/oracle-9i/oracle-cursors.html) 的，因此在需要时使用它们似乎并没有那么惩罚性能:)

请记住，Oracle 的实现更接近 Postgres 而不是 Sybase（MS SQL Server 的起源），因此不同任务的性能会有所不同。如果可以，请避免在可以交换后端的系统上进行性能调整，如果您需要同时使用两者，请选择最小公分母。/tangential_topic

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-13T06:30:34.130

我相信有人可以更详细地解释，但基本上归结为 SQL 服务器中的游标很慢。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-14T15:04:04.793

其他答案正确地指出了游标的性能问题，但他们没有提到 SQL 和关系数据库最擅长基于集合的操作，而游标基本上用于迭代操作。有一些操作（在更广泛的意义上）使用游标更容易执行，但是在使用 SQL 时，您应该始终考虑使用数据集。游标经常被滥用，因为编码人员没有掌握如何使用基于集合的操作来执行任务。

# c++ - 如何在 C++ 中解析具有不同字段数的行

> ID：743191
> 
> 赞同：1
> 
> 时间：2009-04-13T06:31:42.677
> 
> 标签：c++, parsing, stringstream

我有一个看起来像这样的数据：

```
AAA 0.3 1.00 foo chr1,100
AAC 0.1 2.00 bar chr2,33
AAT 3.3 2.11     chr3,45
AAG 1.3 3.11 qux chr1,88
ACA 2.3 1.33     chr8,13
ACT 2.3 7.00 bux chr5,122 
```

请注意，上面的行是制表符分隔的。此外，它有时可能包含 5 个字段或 4 个字段。

我想要做的是将变量中的第四个字段捕获为“”，如果它不包含任何值。

我有以下代码，但它以某种方式读取第 5 个字段，当第 4 个为空时作为第 4 个字段。

正确的方法是什么？

```
#include <iostream>
#include <vector>
#include <fstream>
#include <sstream>
using namespace std;

int main  ( int arg_count, char *arg_vec[] ) {
    string line;
    ifstream myfile (arg_vec[1]);

    if (myfile.is_open())
    {
        while (getline(myfile,line) )
        {
            stringstream ss(line);    
            string Tag;  
            double Val1;
            double Val2;
            double Field4;
            double Field5;

            ss >> Tag >> Val1 >> Val2 >> Field4 >> Field5;
            cout << Field4 << endl;
            //cout << Tag << "," << Val1 << "," << Val2 << "," << Field4 << "," << Field5 << endl;

        }
        myfile.close();
    }
    else { cout << "Unable to open file"; }
    return 0;
} 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-13T06:35:14.353

将行标记为字符串向量，然后根据标记的数量转换为适当的数据类型。

如果您可以使用[Boost.Spirit](http://spirit.sourceforge.net/)，这将简化为定义适当语法的简单问题。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-13T08:54:01.850

如果您想尝试 Boost.Spirit，请从这里开始。它确实可以编译，我已经对其进行了一些测试。它似乎工作正常。

```
#include <iostream>
#include <vector>
#include <fstream>
#include <sstream>
#include <list>
#include <boost/spirit/core.hpp>
#include <boost/spirit/actor/assign_actor.hpp>

using namespace std;
using namespace boost::spirit;

struct OneLine
{
        string tag;
        double val1;
        double val2;
        string field4;
        string field5;
};

int main  ( int arg_count, char *arg_vec[] ) {
    string line;
    ifstream myfile (arg_vec[1]);
    list<OneLine> myList;

    if (myfile.is_open())
    {
        while (getline(myfile,line) )
        {
                OneLine result;
                rule<> good_p(alnum_p|punct_p);
                parse( line.c_str(),
                    (*good_p)[assign_a(result.tag)] >> ch_p('\t') >>
                    real_p[assign_a(result.val1)] >> ch_p('\t') >>
                    real_p[assign_a(result.val2)] >> ch_p('\t') >>
                    (*good_p)[assign_a(result.field4)] >> ch_p('\t') >>
                    (*good_p)[assign_a(result.field5)],
                    ch_p(";") );

                myList.push_back( result );
        }
        myfile.close();
    }
    else { cout << "Unable to open file"; }
    return 0;
} 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-13T13:07:23.333

另一个仅使用 C++ 的版本仅使用 istream 必须在 operator>> 无法解析时设置故障位这一事实。

```
while(getline(ss, line))
{
    stringstream sl(line);

    sl >> tag >> v1 >> v2 >> v3 >> v4;

    if(sl.rdstate() == ios::failbit) // failed to parse 5 arguments?
    {
        sl.clear();
        sl.seekg(ios::beg);
        sl >> tag >> v1 >> v2 >> v4; // do it again with 4
        v3 = "EMPTY"; // just a default value
    }

    cout << "tag: " << tag <<std::endl
        << "v1: " << v1 << std::endl
        << "v2: " << v2 << std::endl
        << "v3: " << v3 << std::endl
        << "v4: " << v4 << std::endl << std::endl;
} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-13T12:39:23.777

带升压：

```
int main()
{
    std::ifstream in("parsefile.in");

    if (!in)
        return 1;

    typedef std::istreambuf_iterator<char> InputIterator;
    typedef boost::char_separator<char> Separator;
    typedef boost::tokenizer< Separator, InputIterator > Tokenizer;

    Tokenizer tokens(InputIterator(in),
                     InputIterator(),
                     Separator(",\t\n", "", boost::keep_empty_tokens));

    const std::size_t columnsCount = 6;
    std::size_t columnNumber = 1;
    for(Tokenizer::iterator it = tokens.begin(); 
        it != tokens.end(); 
        ++it)
    {
        const std::string value = *it;

        if ( 2 == columnNumber )
        {
            const double d = convertToDouble(value);
        }

        std::cout << std::setw(10) << value << "|";

        if ( columnsCount == columnNumber )
        {
            std::cout << std::endl;
            columnNumber = 1;
        }
        else
        {
            ++columnNumber;
        }
    }

    return 0;
} 
```

没有提升：

```
int main()
{
    std::ifstream in("parsefile.in");

    if (!in)
        return 1;

    const std::size_t columnNumber = 5;
    while (in)
    {
        std::vector< std::string > columns(columnNumber);

        for (std::size_t i = 0; i < columnNumber - 1; ++i)
            std::getline(in, columns[i], '\t');
        std::getline(in, columns[columnNumber - 1], '\n');

        std::cout << columns[3] << std::endl;
    }

    return 0;
} 
```

要将字符串值转换为双精度值，您可以使用以下命令。

```
double convertToDouble( const std::string& value )
{
    std::stringstream os;
    os << value;
    double result;
    os >> result;
    return result;
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-13T11:21:09.843

最简单的就是使用两个 fscanf、scanf 或 sscanf 调用，如下所示：

```
std::string line = /* some line */;
if(sscanf(line.c_str(), "%s %f %f %s", &str1, &float1, &float2, &str2) == 4){
    // 4 parameters
}else if(sscanf(line.c_str(), ...) == 5){
    // 5 parameters
} 
```

使用 boost::Spirit 似乎有点矫枉过正，尽管这不是最 C++ 的做事方式。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-13T13:29:54.387

还有另一个版本 - 我认为这是涉及最少打字的版本！

```
#include <iostream>
#include <sstream>
#include <string>
using namespace std;

int main() {

    string f1, f4;
    double f2, f3, f5;

    string line;
    istringstream is;

    while( getline( cin, line ) ) {

        is.str( line );

        if ( ! (is >> f1 >> f2 >> f3 >> f4 >> f5) ) {
            is.str( line);
            f4 = "*";
            is >> f1 >> f2 >> f3 >> f5;
        }

        cout << f1 << " " << f2 << " " << f3 << " " << f4 << " " << f5 << endl;
    }
} 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-13T16:33:20.920

一种更通用的解决方案，用于读取和处理任何基于文本的表格。解决方案是提升。

```
typedef boost::function< void (int, int, const std::string&) > RecordHandler;
void readTableFromFile( const std::string& fileName,
                        const std::string& delimiter,
                        RecordHandler handler );

void handler(int row, int col, const std::string& value)
{
    std::cout << "[ " << row << ", " << col << "] " << value;
}

int main()
{
    readTableFromFile("parsefile.in", "\t,", handler);

    return 0;
} 
```

和实施

```
std::size_t columnsCountInTheFile( const std::string& fileName,
                                   const std::string& delimiter )
{
    typedef boost::char_separator<char> Separator;
    typedef boost::tokenizer< Separator > Tokenizer;

    std::ifstream in(fileName.c_str());

    std::string line;
    std::getline(in, line);

    Tokenizer t(line,
                Separator(delimiter.c_str(), "", boost::keep_empty_tokens));

    return std::distance(t.begin(), t.end());
}

void readTableFromFile( const std::string& fileName,
                        const std::string& delimiter,
                        RecordHandler handler );
{
    std::ifstream in(fileName.c_str());

    if (!in)
        throw std::runtime_error("can't read from " + fileName);

    typedef std::istreambuf_iterator<char> InputIterator;
    typedef boost::char_separator<char> Separator;
    typedef boost::tokenizer< Separator, InputIterator > Tokenizer;

    Tokenizer tokens(InputIterator(in),
                     InputIterator(),
                     Separator((delimiter + "\n").c_str(), "", boost::keep_empty_tokens));

    const std::size_t columnsCount = columnsCountInTheFile(fileName, delimiter);

    std::size_t columnNumber = 1;
    std::size_t rowNumber = 1;
    for(Tokenizer::iterator it = tokens.begin(); 
        it != tokens.end(); 
        ++it)
    {
        handler(rowNumber, columnNumber, *it);

        if ( columnsCount == columnNumber )
        {
            columnNumber = 1;
            ++rowNumber;
        }
        else
        {
            ++columnNumber;
        }
    }
} 
```

# c++ - 向量中的 size() 与 empty() - 为什么首选 empty()？

> ID：743197
> 
> 赞同：39
> 
> 时间：2009-04-13T06:38:13.877
> 
> 标签：c++, stl, size

在调试某些东西时，我看到了 STL vector::empty() 实现：

```
bool empty() const
        {return (size() == 0); } 
```

我相信，每当我们探测向量的空性时，总是建议使用空的大小（）。但是看到这个实现，我想知道，这样做有什么好处？相反，在调用 empty 时会产生函数调用开销，因为它在内部调用 size()==0。

我认为 empty() 在列表的情况下可能会有所帮助，因为 size() 不能保证列表中的恒定时间。为了验证我的假设，我检查了列表实现，令人惊讶的是，在列表中也发现了相同的实现，

```
return (size() == 0); 
```

我现在有点困惑。如果 empty 内部使用 size() 那么我们为什么更喜欢 empty 而不是 size() ？

* * *

## 回答 #1

> 赞同：45
> 
> 时间：2009-04-13T06:41:20.907

因为如果你从 std::vector 切换到 std::list 或其他容器，它可能会有所不同。

例如`std::list::size`take`O(n)`和 not的一些实现`O(1)`。

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2009-04-13T06:51:14.127

每次使用时都需要写出条件`size()`。使用起来很方便`empty()`。当然，前提是您不切换容器。正如其他人指出的那样，是否使用取决于`size()`实现`empty()`。但是，该标准确实保证：`empty()`是所有标准容器的恒定时间操作。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2009-04-13T06:42:36.270

好吧，正如你所说，这只是一个实现细节。`std::list`可以使用存储的大小（恒定时间`size()`但线性时间`splice()`）或不使用（恒定时间`splice()`但线性时间`size()`）来实现。通过选择使用`empty()`，您可以避免在不需要知道大小的情况下押注于实现细节。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-04-13T07:31:45.980

遵循标准，应首选 empty()，因为它具有恒定的时间复杂度，而与容器类型无关。

在 C++03 标准中，第 23.1 章，表 65：容器要求

```
Operation:   empty()
Return_type: convertible to bool
Semantics:   equivalent to size()==0
Complexity:  constant 
```

似乎在您的 STL 实现中，他们将语义视为真正的实现而忽略了复杂性要求，或者 size() 是实现中的常量时间（存储字段）。

如果 size() 不是恒定时间，请联系您的供应商以了解 std::list<>::empty() 不满足标准容器要求。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2009-04-13T09:03:32.127

第一，当您想知道某物是否为空时使用调用的函数`empty()`使代码更具可读性，这意味着您不必担心实现细节。这也意味着您的代码可以更容易地适应具有其他特性的其他类型的容器。

第二，这只是一个 STL 实现。我的 GNU C++ 看起来像这样：

```
bool
empty() const
{ return begin() == end(); } 
```

这最终将导致指针比较，而使用 size() 将导致减法（在此实现中）。

第三，它不太可能产生额外函数调用的开销，因为`empty()`-function 可能是内联的（在两个实现中）。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2009-04-14T03:05:45.377

empty() 对所有容器类都有 O(1) 的实现。size() 只能为某些容器提供 O(n) 的实现；这就是为什么首选 empty() 的原因。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-13T07:38:09.867

除了上面给出的原因，它也可以说比 foo.size() == 0 和/或 !foo.size()

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-13T13:57:34.587

除了非常有效的可读性点之外，您所经历的只是一种特定实现的工件，而不是唯一可能的工件。

也就是说，在向量和列表情况下，或者实际上任何其他容器中，都没有理由或要求根据 size() 来实现 empty()。如果有更好的替代方案，则应该使用它们，除非库的作者不称职，或者更合理地说是懒惰。

至于列表和 size() 的 O(1)-ness，或者缺少它，您应该考虑到该列表可能将 size() 实现为 O(1) 或 splice()，但不能同时实现两者（思考关于原因是一个有趣的练习。）因此，在您的情况下，您检查的库可能已将 size() 实现为 O(1)（在这种情况下 splice() 将是 O(n)），因此可以实现 empty()就 size() 而言，不会牺牲性能，否则，这将是一个非常糟糕的库。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2013-11-19T13:29:38.790

更喜欢使用 empty() 而不是 size() 因为，每个容器可能以不同的方式实现 empty() 来获得恒定时间操作。

例子：

vector 实现为： bool empty() const { // 测试序列是否为空 return (size() == 0); }

列表实现为：

```
 bool empty() const
    {   // test if sequence is empty
    return (_Mysize == 0);
    } 
```

# c++ - 在 C++ 中访问静态类变量？

> ID：743203
> 
> 赞同：33
> 
> 时间：2009-04-13T06:43:58.840
> 
> 标签：c++, class, static

重复：
**[C++：对静态类成员的未定义引用](https://stackoverflow.com/questions/272900/c-undefined-reference-to-static-class-member)**

如果我有这样的类/结构

```
// header file
class Foo
{
   public:
   static int bar;
   int baz;
   int adder();
};

// implementation
int Foo::adder()
{
   return baz + bar;
} 
```

这行不通。我收到“未定义的对 `Foo::bar' 的引用”错误。如何在 C++ 中访问静态类变量？

* * *

## 回答 #1

> 赞同：66
> 
> 时间：2009-04-13T06:46:46.260

*您必须在实现*文件中添加以下行：

```
int Foo::bar = you_initial_value_here; 
```

这是必需的，因此编译器有一个静态变量的位置。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2009-04-13T06:46:50.753

这是正确的语法，但是，`Foo::bar`必须在标头之外单独定义。在您的一个`.cpp`文件中，这样说：

```
int Foo::bar = 0;  // or whatever value you want 
```

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2009-04-13T06:48:03.683

您需要添加一行：

```
int Foo::bar; 
```

这将为您定义一个存储。类中静态的定义类似于“extern”——它提供符号但不创建它。IE

foo.h

```
class Foo {
    static int bar;
    int adder();
}; 
```

foo.cpp

```
int Foo::bar=0;
int Foo::adder() { ... } 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2015-11-10T22:27:06.990

为了在类中使用静态变量，首先您必须为静态变量（初始化）提供一个一般的值（无本地化），然后您可以访问类中的静态成员：

```
class Foo
{
   public:
   static int bar;
   int baz;
   int adder();
};

int Foo::bar = 0;
// implementation
int Foo::adder()
{
   return baz + bar;
} 
```

# .net - 我需要用来声明特定类的命名空间是什么？

> ID：743204
> 
> 赞同：0
> 
> 时间：2009-04-13T06:45:41.987
> 
> 标签：.net, c++-cli

课程如下：

```
public __gc class test :public MarshalByValueComponent,IListSource,ISupportInitialize,ISerializable 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-13T08:02:06.220

命名空间是`System.ComponentModel`

# javascript - 加载后如何使用 JavaScript 调整 Google 地图的大小？

> ID：743214
> 
> 赞同：108
> 
> 时间：2009-04-13T06:54:46.663
> 
> 标签：javascript, css, google-maps

我有一个 'mapwrap' div 设置为 400px x 400px，在里面我有一个 Google 'map' 设置为 100% x 100%。因此地图以 400 x 400 像素加载，然后使用 JavaScript 我将“mapwrap”的大小调整为屏幕的 100% x 100% - 谷歌地图按照我的预期调整到整个屏幕的大小，但图块在右侧边缘之前开始消失页。

我可以调用一个简单的函数来使 Google 地图重新调整为更大尺寸的“mapwrap”div吗？

* * *

## 回答 #1

> 赞同：324
> 
> 时间：2010-04-07T04:41:25.440

对于 Google Maps v3，您需要以不同的方式触发调整大小事件：

```
google.maps.event.trigger(map, "resize"); 
```

请参阅调整大小事件的文档（您需要搜索“调整大小”一词）：[http ://code.google.com/apis/maps/documentation/v3/reference.html#event](http://code.google.com/apis/maps/documentation/v3/reference.html#event)

* * *

**更新**

这个答案已经在这里很久了，所以一个小演示可能是值得的，虽然它使用了 jQuery，但实际上并没有必要这样做。

```
$(function() {
  var mapOptions = {
    zoom: 8,
    center: new google.maps.LatLng(-34.397, 150.644)
  };
  var map = new google.maps.Map($("#map-canvas")[0], mapOptions);

  // listen for the window resize event & trigger Google Maps to update too
  $(window).resize(function() {
    // (the 'map' here is the result of the created 'var map = ...' above)
    google.maps.event.trigger(map, "resize");
  });
});
```

```
html,
body {
  height: 100%;
}
#map-canvas {
  min-width: 200px;
  width: 50%;
  min-height: 200px;
  height: 80%;
  border: 1px solid blue;
}
```

```
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script src="https://maps.googleapis.com/maps/api/js?v=3.exp&dummy=.js"></script>
Google Maps resize demo
<div id="map-canvas"></div>
```

**更新 2018-05-22**

随着 Maps JavaScript API 3.32 版中的新渲染器版本的发布，调整大小事件不再是`Map`类的一部分。

该文件指出

> 调整地图大小时，地图中心固定
> 
> *   全屏控制现在保留中心。
>     
>     
> *   **不再需要手动触发调整大小事件。**

来源：[https ://developers.google.com/maps/documentation/javascript/new-renderer](https://developers.google.com/maps/documentation/javascript/new-renderer)

`google.maps.event.trigger(map, "resize");`从版本 3.32 开始没有任何效果

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2009-04-13T07:36:24.800

如果您使用的是 Google Maps v2，请`checkResize()`在调整容器大小后调用您的地图。 [关联](http://code.google.com/apis/maps/documentation/reference.html#GMap2)

**更新**

Google Maps JavaScript API v2 已于 2011 年弃用。它不再可用。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2015-07-23T18:48:23.943

流行的答案`google.maps.event.trigger(map, "resize");`并不适合我一个人。

这是一个确保页面已加载并且地图也已加载的技巧。通过设置监听器并监听地图的空闲状态，您可以调用事件触发器来调整大小。

```
$(document).ready(function() {
    google.maps.event.addListener(map, "idle", function(){
        google.maps.event.trigger(map, 'resize'); 
    });
}); 
```

这是我的答案，对我有用。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2016-06-17T08:23:06.620

*这是最好的，它会完成工作。它将重新调整您的地图大小。不再需要检查元素来重新调整地图的大小。它会自动触发 re-size 事件。*

```
 google.maps.event.addListener(map, "idle", function()
        {
            google.maps.event.trigger(map, 'resize');
        });

        map_array[Next].setZoom( map.getZoom() - 1 );
    map_array[Next].setZoom( map.getZoom() + 1 ); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2017-03-09T07:22:48.700

首先，感谢您指导我并关闭此问题。我从您的讨论中找到了解决此问题的方法。是的，让我们进入正题。问题是我在 CakePHP3 中使用 GoogleMapHelper v3 助手。当我尝试打开引导模式弹出窗口时，我被地图上的灰色框问题震惊了。已经延长了2天。最后我解决了这个问题。

我们需要更新 GoogleMapHelper 来解决这个问题

需要在 setCenterMap 函数中添加以下脚本

```
google.maps.event.trigger({$id}, \"resize\"); 
```

并且需要在 JavaScript 中包含以下代码

```
google.maps.event.addListenerOnce({$id}, 'idle', function(){
   setCenterMap(new google.maps.LatLng({$this->defaultLatitude}, 
   {$this->defaultLongitude}));
}); 
```

# bash - 如果命令需要超过 1 分钟才能完成，则 bash 发出哔声

> ID：743219
> 
> 赞同：10
> 
> 时间：2009-04-13T06:58:47.883
> 
> 标签：bash, exec

我正在寻找我的 bash 发出哔哔声，如果我执行的命令需要超过一定的时间（比如 1 分钟）。

如果它每隔几分钟就一直发出哔哔声，直到我按下回车键或其他东西.. 那太好了。

有什么聪明的主意吗？

我可以使用屏幕的监控功能作为最后的手段。（我在cygwin上，但这没关系）。

让我澄清一下：

```
 $ ls    
   < output appears >   
 $ rsync foo bar 
   < since this takes lot of time, i switch to other console
      and forget this .. .and remember only after some time >
    < so when this finished, i want it to beep > 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2011-11-20T00:16:36.253

一个谦虚的建议：如果您知道某个命令需要一段时间，只需在命令后面加一个分号，然后发出哔声。

```
rsync foo bar; beep 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-13T07:02:16.487

Linux 中有一些命令会为您发出哔哔声。查看 Ubuntu（可能还有其他发行版）提供的 beep 源代码，或者查看[http://www.johnath.com/beep/beep.c](http://www.johnath.com/beep/beep.c)以获取另一个源代码（我相信它是相同的代码）。

它允许您轻松控制频率、长度和重复次数（除其他外）。

要真正让它工作，你需要一个脚本在后台启动你的实际*工作*程序，然后进入一个`"sleep 60"`循环，发出哔哔声直到它完成。

以下脚本应该是一个好的开始。您可以使用以下方式运行它：

```
beeper sleep 3600 
```

它`sleep 3600`在后台运行，每分钟发出哔哔声，直到完成。

```
#!/bin/bash
$* &
pid=$!
oldmin=$(date +%M)
exf=$pid
while [[ $exf == $pid ]] ; do
    min=$(date +%M)
    if [[ $oldmin != $min ]] ; then
        beep
        oldmin=$min
    fi
    exf="$(ps -ef | awk '{print $2}' | grep $pid)"
    sleep 2
done 
```

这就是它的工作原理。它将参数作为后台进程运行并保存进程 ID。然后它每隔几秒钟循环一次，检查分钟何时改变并在这种情况下发出哔哔声（所以这里的第一次哔哔声可能长达一分钟）。

当进程从 的输出中消失时，就会退出循环`ps`。

你甚至可以做beeper sleep 3600 & 把整个地段放在后台。要停止蜂鸣声，请关闭蜂鸣器进程（如果您希望在没有蜂鸣声的情况下继续工作）或杀死工作进程本身（这将停止工作和蜂鸣声）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-13T07:10:15.517

我确定我使用过类似的东西：

```
echo "\007" 
```

没有方便测试的 *nix shell。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-13T07:12:51.783

```
echo "\007" 
```

*   为我发出哔哔声。

    美元！

*   返回在 bash 中在后台运行的最后一个进程的 pid，因此您可以在其上休眠并验证它是否仍在运行。

为了更清楚，使用 $! 捕获 pid！并在无限循环中休眠并检查上面的pid是否还活着。

在（希望）理解你想要什么之后，这里是代码：

```
#! /bin/bash

if [[ "$#" != "1" ]]
then
  echo "Usage: $0 <command>"
  echo "Will wait till the command finishes and starts beeping once a minute"
  exit 1
fi

CMD="$1"
SECS_BETWEEN_BEEPS="60"

# echo commmand and start time:
echo "@@ Command: '${CMD}'"
echo "@@ Starting at `date`"

# execute and wait till finish:
"${CMD}"
wait

# echo finish time:
echo "@@ Finished at `date`"

# beep once in SECS_BETWEEN_BEEPS:
while ((1))
do
  echo -en '\a'
  sleep "${SECS_BETWEEN_BEEPS}"
done 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-14T08:43:37.530

我喜欢 Pax 提供的答案。看看“哔”能做什么：

```
root@tower:/usr/src/linux # beep --help 
```

> 用法：哔声 [-f 频率] [-l 长度] [-r reps] [-d 延迟] [-D 延迟] [-s] [-c] [-e 设备]
> 
> 哔声 [选项...] [-n] [--new] [选项...] ...哔声 [-h] [--help] 哔声 [-v] [-V] [--version]

因此，当程序继续运行比预期更长的时间时，您可以振荡哔声（使它们更响亮、更长或两者兼而有之）。

如果您使用它，您可以让脚本播放每个人最喜欢的 80 年代热门歌曲的 MUSAC 版本，这肯定会吸引某人到终端，如果没有其他原因只是让它停止。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-04-13T07:03:19.713

我不知道它是否适用于 bash，但是对于许多 shell，例如

```
command && echo ^G 
```

(ctrl-g) 成功完成命令后会发出哔哔声。当您想要执行一个长时间运行的命令然后在另一个窗口中工作但在第一件事完成时收到通知时，这通常很有用。（我不清楚这是否是你的目标。）

* * *

## 回答 #7

> 赞同：-2
> 
> 时间：2009-04-13T08:18:27.787

你在这里问两个完全不同的事情。首先，您询问如何在一分钟后发出哔声，然后您要求在命令完成后发出哔声。这是两件完全不同的事情。

```
# bof [command] [args...] - Beep on Finish
bof() {
    "$@"; local r=$?

    printf '\a'
    return $r
} 
```

该函数运行一个命令，然后在命令完成后发出一次哔声，同时确保命令的退出代码是函数的退出代码。

```
# bot [command] [args...] - Beep on Timeout
bot() {
    { sleep 60; printf '\a'; } &

    "$@"; local r=$?

    kill $!
    return $r
} 
```

`60`除非命令在该时间之前完成（此处为秒，一分钟），否则此功能会在特定时间后发出一次哔声。

```
# bem [command] [args...] - Beep every Minute
bem() {
    { while sleep 60; do printf '\a'; done; } &

    "$@"; local r=$?

    kill $!
    return $r
} 
```

这是对早期功能的简单改编，只要您的命令仍然存在，它就会*每分钟发出哔声。*

```
# bofem [command] [args...] - Beep on Finish every Minute
bofem() {
    "$@"; local r=$?

    until read -t 60 -n 1; do printf '\a'; done
    return $r
} 
```

最后，*每*分钟发出哔声的功能，但仅在命令完成后。一直发出哔哔声，直到你按下一个键来停止它。然后，该函数返回您的命令的退出代码。

我认为这将涵盖您可能针对您的问题提出的所有基础。

像这样使用（和组合）它们：

```
bof rsync foo bar:      # Beep when rsync finishes.
bot ssh foo 'ls bar/'   # Beep if the 'ssh' process takes too long to run. 
```

# streaming - 流式播放 AVI 文件的问题

> ID：743220
> 
> 赞同：0
> 
> 时间：2009-04-13T07:02:08.267
> 
> 标签：streaming, avi

我正在编写一个视频流服务器应用程序。我有一个 AVI 文件，我已将它放在 IIS 7 上进行流式传输。我发现如果媒体尚未缓冲，客户端无法跳转到媒体的任意位置。我认为录制过程中缺少一些元数据？

搜索后，我认为，Windows Media Player 在本地缓冲之前无法跳转到任意位置，因为 AVI 的索引块（查找所需）存储在文件末尾。

举个例子，如果我录制的 avi 视频是 10 分钟，现在我正在播放到第 4 分钟，而本地缓冲的流媒体缓冲到第 5 分钟，我无法跳转到第 5 分钟之后的任何时间，比如Windows Media Player 中的第 7 分钟。

对于 asf/wmv 等其他格式，我没有遇到同样的问题。所以我认为这是一个 AVI 问题，而不是服务器或任何其他环境问题。

我的问题是，

1.  在缓冲之前无法跳转到 AVI 文件的任意位置的实际原因是什么？
2.  任何解决方案或解决方法？我可以改用其他更聪明的播放器，它可以处理这个问题，或者我可以在服务器端添加一些代码修复吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-13T07:06:09.350

正如您自己已经发现的那样，索引写在 avi 容器的末尾。这就是为什么 avi 格式不适合流式传输的原因。

您应该将视频转换为其他格式，该格式在开头具有索引信息。例如，flv、wmv、ogg/theora 等。

# c# - 比较两个字符串的最有效方法是什么？

> ID：743227
> 
> 赞同：0
> 
> 时间：2009-04-13T07:05:28.197
> 
> 标签：c#, string, compare

就像 stakeoverflow.com 上的这个页面一样 [https://stackoverflow.com/revisions/620144/list](https://stackoverflow.com/revisions/620144/list)

我想比较两个字符串，发现哪些部分被修改了。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-13T07:18:01.583

您可能想要的是[Hirschberg 算法](http://en.wikipedia.org/wiki/Hirschberg%27s_algorithm)的变体。无论如何，动态编程是要走的路，请查阅任何标准算法参考书。

# nhibernate - session.Save 上的 NHibernate 错误

> ID：743232
> 
> 赞同：7
> 
> 时间：2009-04-13T07:08:05.460
> 
> 标签：nhibernate

我有一个使用 NHibernate 的 MVC 应用程序。

我创建了一个模型并第一次尝试使用 NHibernate 将数据插入数据库，所以请放轻松。

我在 session.Save(object); 上收到此错误。

用户代码未处理 IndexOutOfRangeException

此 SqlParameterCollection 的索引 8 无效，Count=8。

当我使用监视窗口查看对象中的数据时，一切似乎都正常，并且集合也被初始化。

使用 SQL 2005。

请有任何想法为什么会发生这种情况？

马尔科姆

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-05-05T09:49:24.030

我自己使用 NHibernate 时遇到了同样的问题，我的问题在于映射。在我的关联中，我映射了一个包含关联实体的属性，以及一个仅具有关联 ID 的属性。

在我的情况下，解决方案是添加`update="false" insert="false"`到包含 ID 的属性的映射中。像这样：

```
<property name="AssociationId" column="AssociationColumnName" update="false" insert="false" />
<many-to-one name="Association" column="AssociationColumnName" property-ref="Id" not-null="false" /> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-11-11T22:41:35.720

伙计们，如果你得到这个检查映射文件，我得到了同样的错误，我有两个属性映射到同一列，我知道答案已经很晚了，这是给那些来寻找相同问题答案的用户的。

注意：这可能不是唯一的原因，反正我的原因是这个。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-13T13:14:52.787

这些链接之一有帮助吗？

[http://groups.google.com/group/nhusers/browse_thread/thread/34f124a7052c37ff](http://groups.google.com/group/nhusers/browse_thread/thread/34f124a7052c37ff)

[http://www.methodicmadness.com/2009/01/nhibernate-what-is-heck-clazz.html](http://www.methodicmadness.com/2009/01/nhibernate-what-is-heck-clazz.html)

[http://groups.google.com/group/fluent-nhibernate/browse_thread/thread/116c822c44aae797](http://groups.google.com/group/fluent-nhibernate/browse_thread/thread/116c822c44aae797)

如果没有，您将不得不发布您的映射以获得更多建议。

我建议通过首先将插入隔离到单元测试中来解决此问题。

# c# - 如何将 CodeVariableDeclarationStatement 转换为 CodeAssignmentStatement。？

> ID：743236
> 
> 赞同：0
> 
> 时间：2009-04-13T07:11:18.103
> 
> 标签：c#

```
CodeVariableDeclarationStatement hashTableParam = new CodeVariableDeclarationStatement();
hashTableParam.Name = "hastable";
hashTableParam.Type = new CodeTypeReference(typeof(System.Collections.Hashtable));
CodeMethodInvokeExpression invokeExp2 =
    new CodeMethodInvokeExpression(new CodeVariableReferenceExpression(hashTableParam.Name), "add");
invokeExp2.Parameters.Add(new CodeArgumentReferenceExpression("key"));
invokeExp2.Parameters.Add(new CodeArgumentReferenceExpression("value"));
return hashTableParam; 
```

我需要在返回 CodeAssignStatement 的方法中使用上述代码。？我该怎么做。？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-13T08:34:19.183

据我所知，`CodeAssignStatement`上面唯一明智的就是（未经测试）：

```
 CodeAssignStatement assign = new CodeAssignStatement(
            new CodeVariableReferenceExpression(hashTableParam.Name),
            new CodeObjectCreateExpression(hashTableParam.Type)); 
```

但是，此分配（此时返回）将不包括键/值添加。你到底想做什么？

# asp.net - 将 SQL 2005 数据库发布到远程主机

> ID：743237
> 
> 赞同：0
> 
> 时间：2009-04-13T07:11:43.767
> 
> 标签：asp.net, sql-server, database, publishing, merge

我创建了一个 ASP.NET 2.0 网站，它使用两个数据库，即 aspnetdb 和 my_db。我运行了 aspnet_regsql.exe -E -S localhost -A mr 工具，并在我的项目中获得了 aspnetdb.mdf。我将它用于为我的网站提供登录功能。现在我想将该站点发布到我购买的远程托管服务器上。他们向我提供了我必须连接的服务器的详细信息，我成功地这样做了。现在的情况是这样的：-

1）我的站点支持单个 MS SQL Server 数据库，并且我正在使用两个数据库。如何将这两个数据库合并为一个，并使用访问相应数据库时发生的更改更新所有页面，然后发布。

2）我想将 aspnetdb 重命名为其他名称，因为当我将名为 aspnetdb 的数据库发布到服务器时出现错误（它说数据库已经存在，但我找不到它）。那么我怎样才能有效地重命名它。

3）如何将合并的数据库正确发布到远程位置，我是否也必须考虑连接字符串？到目前为止，由于我是本地用户，我没有提供任何用户名和密码，但在站点上我会为 SQL 服务器创建一个用户。那么如何将它安全地集成到我的项目中。

希望我已经正确解释了我的问题，等待一些解决方案。

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-13T01:46:38.457

这里有几个问题，所以我将把它们分开。

**1）如何将这两个数据库合并为一个**

Devmania 提到了 Red Gate Data Compare，所以我会提到 Q​​uest [Toad for SQL Server](http://www.toadsoft.com)，它也可以做同样的事情。但免责声明 - 我为 Quest 工作。您可以下载 v4.5 beta，它现在是免费的，它具有数据和模式比较功能。

**并根据访问相应数据库时发生的更改更新所有页面，然后发布。**

不幸的是，没有人的工具会改变你的代码。

**2）我想将 aspnetdb 重命名为其他名称，因为当我将名为 aspnetdb 的数据库发布到服务器时出现错误（它说数据库已经存在，但我找不到它）。那么我怎样才能有效地重命名它。**

进入 SQL Server Management Studio，连接到数据库服务器，右键单击数据库名称，然后单击重命名。

**3）如何将合并的数据库正确发布到远程位置，我是否也必须考虑连接字符串？**

请咨询您的托管服务提供商，因为并非所有服务提供商都允许远程 SSMS 访问。如果他们这样做，那么您需要编写数据库脚本，然后将其应用到远程数据库。Toad 包括在您的数据库中编写模式和数据的脚本的能力。

**到目前为止，由于我是本地用户，我没有提供任何用户名和密码，但在站点上我会为 SQL 服务器创建一个用户。那么如何将它安全地集成到我的项目中。**

在 SQL Server Management Studio 中，进入数据库、安全、登录。您可以右键单击那里，创建一个新的登录，并使用 SQL 身份验证。指定用户名和密码，你可以给登录你想要的权限。我会为您的 Web 应用程序使用一个单独的应用程序，它只有 db_datareader 和 db_datawriter，而不是 db_owner。所有者有能力更改架构，您的应用不应该这样做。万一您被黑客入侵并且有人窃取了用户名/密码，至少他们不会更改您的架构。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-13T12:06:21.483

伙计，为此改变我生活的最佳工具是 Redgate Data Compare。它将检查两个数据库并同步其中的任何内容，此外它还为您提供了 SQL 脚本。

希望这可以帮助。

# mysql - 如何将mysql数据库移动到另一个挂载点

> ID：743245
> 
> 赞同：4
> 
> 时间：2009-04-13T07:13:59.097
> 
> 标签：mysql, database-administration

我有一个 MySQL 数据库，它越来越大，我想将整个数据库移动到另一个安装点，那里有足够的存储空间。我希望传输我当前的数据，并将新数据保存到新位置。

软件堆栈：在 FreeBSD 6 上运行的 MySQL 5

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-13T07:51:58.863

*   停止 mysqld
*   将 /var/lib/mysql（或 my.cnf 中的 $datadir 设置为）复制到新位置
*   在旧的 $datadir 下挂载新位置或修改文件 my.cnf 中的 MySQL 配置以反映新位置。
*   启动 mysqld

没有魔法。;) 但是您应该确保，您使用 MySQL 的文件复制所有权限。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-13T08:05:55.603

当然，其他答案是有效的。但是，如果要保留默认配置，请执行以下操作：

1.  停止 mysqld
2.  `mv /var/lib/mysql /var/lib/mysql.backup`
3.  挂载你的新分区`/var/lib/mysql`
4.  `cp -r /var/lib/mysql.backup /var/lib/mysql`
5.  启动mysqld

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-13T07:50:56.777

如果您可以容忍数据库因移动而关闭：

1.  关闭 MySQL
2.  rsync 文件到新的挂载点
3.  任何一个：
    1.  更改`mysql.conf`以告诉 MySQL 在哪里可以找到文件，或者
    2.  使当前目录成为新目录的符号链接
4.  重启 MySQL

# html - URL 类型的名称

> ID：743247
> 
> 赞同：27
> 
> 时间：2009-04-13T07:14:30.467
> 
> 标签：html, http, url

1.  **绝对**
    `http://www.example.com/images/icons.png`

2.  **相对的**
    `../images/icons.png`

3.  **？？？**
    `/images/icons.png`

4.  **？？？**
    `//www.example.com/images/icons.png`

[URL](https://en.wikipedia.org/wiki/URL)类型 3 和 4 有名称吗？我在[Slashdot](https://slashdot.org/)上看到过使用类型 4 的一个地方。

* * *

## 回答 #1

> 赞同：52
> 
> 时间：2009-04-13T08:04:17.587

1.  **绝对** [http://www.example.com/images/icons.png](http://www.example.com/images/icons.png)
2.  **文档相关的**../images/icons.png
3.  **根相关**/images/icons.png
4.  **协议相关**//www.example.com/images/icons.png

对于#4，我也经常称它们为“协议不可知论者”

* * *

## 回答 #2

> 赞同：45
> 
> 时间：2009-04-13T08:06:02.187

类型 1 只是一个“URI”（有时称为“绝对 URI”）。

对于类型 2、3 和 4，最终答案在[RFC 3986](https://www.rfc-editor.org/rfc/rfc3986#page-27)的第 4.2 节中。

它们都是“相对引用”，但根据 RFC 是这样限定的：

*   `../images/icons.png`- “相对路径参考”
*   `/images/icons.png`- “绝对路径参考”
*   `//`... `/icons.png`- “网络路径参考”

如果您要指定包含域名的 URL，但您希望协议与用于访问当前资源的协议匹配，则通常使用后者。例如，如果您的图像是从 CDN 下载的，您可以使用它来默认`https`当前页面是否也是通过 下载`https`的，从而防止在安全页面中包含非安全资源的警告。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-04-13T07:25:32.860

数字 3 也被认为是相对的。4 号是绝对的，但缺少协议。如果您希望能够使用 HTTP 和 HTTPS 访问相同的 URL，这很有用。

**绝对 URL**完整地指定了网页的位置，并且无论您在世界的哪个地方都可以相同地工作。

**相对 URL**是上下文相关的，提供相对于您当前位置的路径。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-13T07:22:45.533

类型三是**根相关的**。

不知道大约4。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-08-09T07:40:27.927

绝对网址直接给出您要查找的文件/文档的位置。示例：“http:/www.otagasue.com/images/coolpics.jpg”相对 URL 通常指向与文件当前位置相关的文件/文档。与绝对 URL 不同，它是指根目录示例的短 URL。 .otagasue/pica.jpg"

奥塔加.

# python - Python中列表的输出有问题

> ID：743248
> 
> 赞同：2
> 
> 时间：2009-04-13T07:16:48.653
> 
> 标签：python, list, text

我想要一个 Python 程序从文本文件中导入单词列表，并将文本文件的内容打印为两个列表。文本文件中的数据采用这种形式：

```
A Alfa
B Betta
C Charlie 
```

我想要一个 Python 程序打印出一个包含 A、B、C 的列表和一个包含 Alfa、Betta、Charlie 的列表。

这是我写的：

```
english2german = open('english2german.txt', 'r')
englist = []
gerlist = []

for i, line in enumerate(english2german):
    englist[i:], gerlist[i:] = line.split() 
```

这是制作两个列表，但只会打印出每个单词的第一个字母。我怎样才能让我的代码打印出整个单词？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-13T07:30:34.797

你想要这样的东西：

```
english2german = open("english2german.txt")
englist = []
gerlist = []

for line in english2german:
    (e, g) = line.split()
    englist.append(e)
    gerlist.append(g) 
```

之前代码的问题在于`englist[i:]`它实际上是*列表*的一部分，而不仅仅是单个索引。字符串也是可迭代的，因此您基本上是将单个字母填充到多个索引中。换句话说，类似的东西`gerlist[0:] = "alfa"`实际上会导致`gerlist = ['a', 'l', 'f', 'a']`.

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-13T07:58:57.117

甚至比[amo-ej1 的 answer](https://stackoverflow.com/questions/743248/something-wrong-with-output-from-list-in-python/743274#743274)更短，而且可能更快：

```
In [1]: english2german = open('english2german.txt')
In [2]: eng, ger = zip(*( line.split() for line in english2german ))
In [3]: eng
Out[3]: ('A', 'B', 'C')
In [4]: ger
Out[4]: ('Alfa', 'Betta', 'Charlie') 
```

如果您使用的是 Python 3.0 或`from future_builtins import zip`，这也可以节省内存。否则`zip`用`izip`from `itertools`if替换`english2german`很长。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-13T14:04:15.927

只是一个补充：您正在处理文件。请关闭它们 :) 或使用 with 构造：

```
with open('english2german.txt') as english2german:
  englist, gerlist = zip(*(line.split() for line in english2german)) 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-13T07:32:34.700

像这样你的意思是：

```
english2german = open('k.txt', 'r')
englist = []
gerlist = []

for i, line in enumerate(english2german):
    englist.append(line.split()[0])
    gerlist.append(line.split()[1])

print englist
print gerlist 
```

生成：

['A', 'B', 'C'] ['阿尔法', '斗鱼', '查理']

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-13T08:46:23.897

如果您在任何单词中都没有空格（即每行有一个空格），那么已经发布的解决方案是可以的。如果我理解正确，您正在尝试构建字典，所以我建议您考虑这样一个事实，即您也可以定义多个单词表达。在这种情况下，您最好使用其他字符而不是空格来将定义与单词分开。像“|”这样的东西，不可能出现在一个单词中。

然后，你做这样的事情：

```
for line in english2german:
    (e, g) = line.split("|")
    englist.append(e)
    gerlist.append(g) 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-13T14:37:42.087

[对Autoplectic 的](https://stackoverflow.com/questions/743248/something-wrong-with-output-from-list-in-python/743313#743313)使用建议略作元回答（？）`zip()`

输入文件中有 3 行（来自问题中提供的数据）：

与构建两个列表的简单 for 循环相比（来自[mipadi](https://stackoverflow.com/questions/743248/something-wrong-with-output-from-list-in-python/743268#743268)当前接受的答案的代码） ，该`zip()`方法平均需要几秒钟。`0.404729390144``0.341339087486`

输入文件中有 10,000 行（随机生成 3-12 个字符的单词。我将`timeit.repeat()`值减少到 100 次，重复两次）：

`zip()`与 for 循环`1.43965339661`相比，平均花费了几秒钟。`1.52318406105`

两个基准测试都是使用 Python 2.5.1 版完成的

几乎没有太大的区别.. 鉴于简单的 for 循环的可读性更高，我建议使用它..`zip`大文件的代码可能会更快一些，但 10,000 行的差异约为 0.083 秒..

基准代码：

```
import timeit

# https://stackoverflow.com/questions/743248/something-wrong-with-output-from-list-in-python/743313#743313
code_zip = """english2german = open('english2german.txt')
eng, ger = zip(*( line.split() for line in english2german ))
"""

# https://stackoverflow.com/questions/743248/something-wrong-with-output-from-list-in-python/743268#743268
code_for = """english2german = open("english2german.txt")
englist = []
gerlist = []

for line in english2german:
    (e, g) = line.split()
    englist.append(e)
    gerlist.append(g)
"""

for code in [code_zip, code_for]:
    t = timeit.Timer(stmt = code)
    try:
        times = t.repeat(10, 10000)
    except:
        t.print_exc()
    else:
        print "Code:"
        print code
        print "Time:"
        print times
        print "Average:"
        print sum(times) / len(times)
        print "-" * 20 
```

# asp.net-mvc - 我如何才能最好地将 [Authorize] 属性与 Ajax 和部分视图一起使用？

> ID：743252
> 
> 赞同：7
> 
> 时间：2009-04-13T07:19:43.700
> 
> 标签：asp.net-mvc, ajax, asp.net-ajax

我正准备`[Authorize]`在通过 Ajax 返回部分视图的 Actions 上使用；但我没有得到我想要的行为（尽管它是我预期的行为）。

这似乎是一个远射；但是，有没有办法将此属性扩展为“中断”AJAX 调用并将整个页面重定向到登录屏幕？（而不是将登录屏幕返回到我设置 UpdateTargetId 的任何位置？）

我想我已经掌握了如何在每个特定的 Ajax 调用上执行此操作，但如果我能以某种方式集中它，它将节省大量代码......

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-13T12:43:47.477

AuthorizeAttribute 不会为您执行此操作，但您可以集中您的代码。创建一个新属性，当当前没有用户登录时返回 http 状态代码 401（未授权）。在您的 site.master 引用的 JavaScript 文件中，处理 jQuery $.ajaxError 事件。在响应状态代码中查找 http 401 并通过 JavaScript 重定向到您的登录页面。现在，如果当前用户未被授权，您通过 jQuery 进行的任何 Ajax 调用都将在此处结束。

# scala - 为什么 Scala 对此没有多少热情？

> ID：743256
> 
> 赞同：15
> 
> 时间：2009-04-13T07:23:00.353
> 
> 标签：scala

随着时间的推移，我注意到 Clojure 用户对这种语言只有极大的热情。然而，似乎大多数 Scala 用户甚至都不太关心这种语言。一些人告诉我“这比必须使用 Java 要好。”。我不确定为什么 Clojure 对它有如此多的热情，而 Scala 却几乎没有。它破坏了我必须学习该语言的任何动力。我不太关心使用一种语言“因为它比必须使用 Java 更好。”。你怎么看？我对 Scala 的了解还不够长，无法衡量随着时间的推移流行度增加或减少了多少。你对语言有什么看法？我特别有兴趣听取使用该语言的人的意见。

谢谢。

编辑：显然这篇文章比我预期的更具攻击性。我不是要贬低这两种语言，也不是说 Scala 没有人支持它。我只是说，随着时间的推移，在我看来，像 Clojure 那样对 Scala 充满热情的人越来越少。我不是在做出“不合理的假设”或做出“辩论中的肮脏举动”，我只是在寻求理论。

如果我知道这会引起如此多的争议，我什至不会写这个帖子。对于任何误解，我深表歉意。最后我想指出，我**确实**喜欢 Scala 和 Clojure。我们说话时我正在学习 Scala。感谢您的帖子，至少有理论的部分。

编辑：9 月 30 日：我确实为我对我赢得的任何敌意表示歉意。这个问题被严重误解了。我喜欢 Scala，并认为它是一种了不起的语言。我是根据自己的观察发言，看来我自己的观察显然是错误的。欢迎您继续投票否决这个问题，但如果我有能力这样做，我会删除它，但我不是。

* * *

## 回答 #1

> 赞同：45
> 
> 时间：2009-04-13T07:41:03.243

我认为有些用户*对*Scala 充满热情。[Daniel Spiewak](https://stackoverflow.com/users/9815)写了很多关于该语言的[博客文章](http://www.codecommit.com/blog)，Twitter 的人们经常谈论用 Scala 重写他们的软件的一部分。*相比之下*， Clojure 似乎能激发更多热情的主要原因是，Clojure 是 Lisp 的一种方言，而 Lispers 往往对他们的语言充满热情。我认为这个想法很关键：很多 Clo​​jure 程序员使用 Clojure 是因为他们*喜欢*Lisp，而不是因为他们*讨厌*Java，而很多 Scala 程序员（不是全部，但很多）使用 Scala 不是因为他们*喜欢*面向对象的函数式语言，但因为他们不想使用 Java。

* * *

## 回答 #2

> 赞同：34
> 
> 时间：2009-04-13T15:12:43.297

这是辩论中的经典“肮脏”举动。假设一个前提，然后根据该前提提出一个问题。“你到底是什么时候停止打你老婆的？”

问题需要编辑

```
I'm not sure why Clojure has so much enthusiasm about it yet Scala has hardly any.
[citation needed] 
```

我不会质疑 Clojure 用户是否有热情。我的经验是他们这样做。没错，它是一门很棒的语言。

但是您似乎随便忽略了 Scala 方面的热情。Brian Goetz 说，提交给 JavaOne 的 1300 场演讲中有 100 场是关于 Scala 的。因此，至少有 100 人对 Scala 充满热情，能够站在陌生人面前谈论它。[http://blogs.oracle.com/briangoetz/entry/how_to_get_your_javaone](http://blogs.oracle.com/briangoetz/entry/how_to_get_your_javaone)

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2009-04-13T14:51:32.070

我已经在 scala 中全职编程了大约一年。我对它只有巨大的热情。你有没有想过也许人们喜欢使用它来花费大量时间进行宣传？在这么晚的日子里，我认为人们会学会对炒作持怀疑态度。这一教训的必然结果是不要对缺乏它做出太多假设。（这并不是说 scala 没有被炒作，但大多数炒作似乎源于不使用它的人......）

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2009-04-30T21:45:10.700

有趣的。就个人而言，我认为 Scala 是一门很棒的语言（它的优势将在更大的项目中显示出来），但在某种意义上你是对的，因为我没有看到诸如“Scala 摇滚而你的语言是 suxx0r ！！”之类的评论。这在其他社区似乎很常见。

也许

*   ... Scala 社区的成员更成熟？（呃……年纪大了？）
*   ...他们忙于在 Scala 中编写东西而没有时间进行宣传？
*   ...他们已经知道不止一种语言，并且知道没有一种语言可以统治他们所有人？

（幽默暗示，没必要开战）

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2013-11-03T15:49:20.420

我对 Scala 非常感兴趣，事实上，我打算把我的编码生涯赌在它上面。在成为 Java 粉丝这么久之后，我最早的印象是 Scala 只是一种学术时尚——一种计算机科学家的玩具语言，对严肃的软件开发人员几乎没有用处，例如天文学家对你的宇航员，我当时想， “来吧，谁需要另一个 Haskell？”，但经过第二次更仔细的观察，我被迷住了。

这是我一生都在等待的语言——功能强大、面向对象、基于 JVM，而且一旦你掌握了它就非常漂亮。有人提到通过写文章表现出热情，但 Scala 爱好者应该做程序员最擅长的事情，而不是写代码。

我们发布的 Scala 越多——数据库引擎、应用服务器、消息代理、构建系统等，就越好。愿 Scala 将我们从 Jevil 中拯救出来……嗯 Java。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2009-05-22T16:39:28.017

Scala 不是初学者的语言。它复杂而微妙，需要大量的学习投资。这很棒，但这并不容易。

其他答案使这听起来很消极：

> **mipadi：** 很多 Scala 程序员（不是全部，但很多）使用 Scala 不是因为他们喜欢面向对象的函数式语言，而是因为他们不想使用 Java

我更愿意从积极的角度看待这一点。Scala 是一门从历史错误中吸取教训并努力不重蹈覆辙的语言。它吸引了那些在 Java 和其他传统语言方面有足够经验的开发人员来欣赏这一点。

不成熟的标志是相信一种方法论凌驾于所有其他方法之上。我知道我在十年前曾相信面向对象是一种真正的方式是有罪的。现在我们有一些人声称函数式编程是正确的方法。Scala 比这更成熟：它明白一种尺寸并不适合所有人。

Scala 仍然是相当新的（在这些东西的规模上），当我输入这个时，它的一部分正在稳定下来，但是有人使用它来创建一个杀手级应用程序只是时间问题，数百万人开始依赖它。我当然希望那会是我:)

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2011-06-07T06:59:47.693

我使用 Scala 是因为它可以让我更快更好地完成工作。我不使用它，因为它是一种编程的乐趣（嗯，它与 Java 相比）。基本上我认为所有的编程语言都很糟糕，我选择了较小的邪恶。

也许 Scala 是一种像我这样务实的人使用的语言。这并不意味着它是一种糟糕的语言。这也不意味着，这些务实的人会为 Clojure 欢呼。也许他们只是不会使用它。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2011-06-07T00:20:24.857

在谷歌搜索术语[scala 语言流行度](http://www.google.com/search?q=scala+language+popularity)后，我偶然发现了这个问题。具有讽刺意味的是，四天前，我参加了[Scala Days 2011](http://days2011.scala-lang.org/)会议，来自世界各地的数百名热情的 Scala 用户齐聚一堂，展示和讨论这种非凡语言的最新发展。

@Rayne，我不知道是什么情况促使您建议大多数 Scala 用户不太关心该语言，但我自己的经验完全相反。诚然，我认识的大多数 Scala 用户，我都是通过本地用户组和活动（如 Scala Days 和 OSCON [Scala 峰会](http://www.oscon.com/oscon2010/public/schedule/detail/15318)）认识的；这显然创建了一个子集，他们愿意放弃空闲时间来学习和/或分享他们的 Scala 知识。

我也很惊讶，任何在 2009 年对 Scala 缺乏热情的人都会费心使用它。即使是现在，Scala 在很大程度上仍然是一种“早期采用者”技术，对于对 Scala 不以为然的开发人员来说，（并且曾经）不乏令人信服的替代方案：Clojure、Groovy、JRuby、Ruby、Python……我可以继续，但是惯于。并不是说企业 IT 部门大量转向 Scala*并*强迫他们的开发人员使用它：那一天离未来还有很长的路要走。你到底是在哪里遇到这些不热心的 Scala 用户的？

我想，另一种可能的解释是，你用一个不公平的长标准来衡量 Scala 用户。@mipadi 对 Clojure 的评论很到位。您将很难找到一群更热心的语言爱好者来与 Scala 用户进行比较。

我意识到你在 18 个月前提出了这个问题。我希望在此期间，您会遇到越来越多的热心 Scala 用户，甚至您自己也可能成为其中的一员。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-15T00:45:06.613

我认为提问者做出了一些不合理的假设。 [编程语言的流行](http://www.langpop.com/)似乎表明，除了两个相当热心的早期采用者社区之外，这两种语言（Clojure 或 Scala）都没有太多的支持。如果一组或另一组早期采用者更愿意宣传他们的新语言，那么无论如何他们都是非常小的社区。

# gdi+ - 任何人都可以在 gdi+ 中为我提供一个示例以在画布上绘制图像吗？

> ID：743258
> 
> 赞同：1
> 
> 时间：2009-04-13T07:23:35.843
> 
> 标签：gdi+, matrix, rotation

我需要在画布上绘制一定角度的图像，它需要旋转角度 N ，它的中心在 x, y

```
 Matrix myPathMatrix;
        myPathMatrix.Translate(x, y, MatrixOrderAppend);
        myPathMatrix.Rotate(angle, MatrixOrderAppend);
        canvas->SetTransform(&myPathMatrix);
        Draw(canvas);// draw the image
        myPathMatrix.Rotate(-angle, MatrixOrderAppend);
        myPathMatrix.Translate(-x, -y, MatrixOrderAppend);
        canvas->SetTransform(&myPathMatrix); 
```

但我发现 img 在左上角旋转，我需要图像以其中心旋转。我怎样才能做到这一点？非常感谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-13T07:51:45.137

您需要更改默认为左上角的旋转“中心”。
这是我在网上找到的一些代码：

```
private Bitmap rotateImage(Bitmap b, float angle)
{
  //create a new empty bitmap to hold rotated image
  Bitmap returnBitmap = new Bitmap(b.Width, b.Height);
  //make a graphics object from the empty bitmap
  Graphics g = Graphics.FromImage(returnBitmap);
  //move rotation point to center of image
  g.TranslateTransform((float)b.Width/2, (float)b.Height / 2);
  //rotate
  g.RotateTransform(angle);
  //move image back
  g.TranslateTransform(-(float)b.Width/2,-(float)b.Height / 2);
  //draw passed in image onto graphics object
  g.DrawImage(b, new Point(0, 0)); 
  return returnBitmap;
} 
```

# ajax - 在 grails 中显示加载时间的 ajax 调用中的 spinner.gif

> ID：743262
> 
> 赞同：3
> 
> 时间：2009-04-13T07:25:17.150
> 
> 标签：ajax, grails

我正在使用大量 ajax 的 grails 中开发一个 Web 应用程序。我需要在处理 ajax 请求时显示一个 spinner.gif 图像。我的示例 gsp 代码是

```
<div id="ajax-area">
  <g:remoteLink action="list" controller="file" update="ajax-area">
    view files
  </g:remoteLink>
</div> 
```

在上面的代码中，如果我们单击查看文件链接，它将更新 ajax-area div。

有人可以告诉我如何在加载 ajax 时使用 spinner.gif 更新 ajax 区域。

谢谢

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-07T16:07:17.240

jQuery 也是如此（这实际上是捆绑在 Grails jQuery 插件中）：

```
$(document).ready(function() {
    $("#spinner").bind("ajaxSend", function() {
        $(this).fadeIn();
    }).bind("ajaxComplete", function() {
        $(this).fadeOut();
    })}
); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-13T18:40:20.163

假设您使用 Prototype，您可以在页面（或布局）中添加类似这样的内容以显示微调器：

```
<script type="text/javascript">
Ajax.Responders.register({
   onCreate: function() {
      if($('ajax-area'))
         $('ajax-area').update('<img src="${createLinkTo(dir:'images',file:'spinner.gif')}" border="0" alt="Loading..." title="Loading..." width="16" height="16" />');
   }
});
</script> 
```

当启动 Ajax 调用时，它会覆盖“ajax-area”元素的内容。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-03-02T10:38:23.383

关于该主题的有趣链接：http: [//blog.oio.de/2010/11/08/how-to-create-a-loading-animation-spinner-using-jquery/](http://blog.oio.de/2010/11/08/how-to-create-a-loading-animation-spinner-using-jquery/)

# c - Perl 或 C 的解析速度更快吗？

> ID：743265
> 
> 赞同：20
> 
> 时间：2009-04-13T07:27:16.490
> 
> 标签：c, perl, optimization, parsing

我有一些非常大的日志文件，我需要解析它们。易于实施显然将我指向 Perl 和正则表达式组合（我还是个新手）。但是速度呢？在 C 中实现它会更快吗？每个日志文件大小为 2 GB。

* * *

## 回答 #1

> 赞同：44
> 
> 时间：2009-04-13T07:41:57.703

我非常怀疑 C 会比 Perl 快，除非你手动编译 RE。

通过手动编译，我的意思是直接对有限状态机 (FSM) 进行编码，而不是使用 RE 引擎对其进行编译。这种方法意味着您可以针对您的特定情况对其进行优化，这通常比依赖更通用的引擎更快。

但是，如果没有 lex、yacc、bison 或其他类似工具的好处，我不会向以前不必编写编译器或解析器的任何人建议过这样的事情。

通用引擎，例如 PCRE，通常足够强大且足够快（无论如何满足我的需求，而这些需求通常*非常*苛刻）。

使用通用 RE 引擎时，无论是用 C 还是 Perl 编写的，它都需要能够处理各种情况。当您考虑哪个更快时，您只需比较两种情况下的 RE 引擎是用什么编写的（提示：Perl RE 引擎*不是*用 Perl 编写的）。

它们都是用 C 语言编写的，因此您应该会发现在匹配速度方面的差异很小。

您*可能会*发现 RE 周围的支持代码存在差异，但差异很小，尤其是当它是一个简单的读取/匹配/输出循环时。

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2009-04-13T17:30:14.810

*   一个天真的编写的基于 Perl 正则表达式的解析器将比一个天真的编写的基于 C 正则表达式的解析器更快。
*   一个编写良好的基于​​ Perl 正则表达式的解析器*将比*一个简单编写的基于 C 正则表达式的解析器快得多。
*   编写良好的基于​​ C 正则表达式的解析器将比编写良好的基于​​ Perl 正则表达式的解析器稍微快一些。（它的编写难度也将增加一倍，调试难度也将增加十倍。）

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2009-04-13T07:32:09.473

Perl 正则表达式匹配器经过高度优化。这就是 Perl 的亮点所在，在 Perl 中处理 2GB 文件应该没有问题，而且性能应该很容易与 C 版本相媲美。顺便说一句：您是否尝试寻找已经完成的日志解析器？他们有很多。

* * *

## 回答 #4

> 赞同：17
> 
> 时间：2009-04-13T18:14:28.917

如果你同样精通 C 和 Perl，答案很简单：

1.  用 Perl 编写它。
2.  如果速度太慢，请对其进行分析并修复它。
3.  如果它仍然太慢，并且问题是 CPU 或 RAM 使用过多，请考虑用 C 编写它。

一般来说，我会说这适用，除非你是某种 C 小神，可以通过对指针和类型转换的强力操作巧妙地操纵现实的基础。

说真的，perl 中的正则表达式实现非常快速、灵活且经过良好测试。您编写的任何代码都可能快速而灵活，但它永远无法经过彻底的测试。

由于您是 Perl 和正则表达式的新手，因此请务必记住，如果您需要，有些[资源](http://learn.perl.org/)可以[为](https://stackoverflow.com/questions/tagged/perl)您提供[出色的帮助。](http://perlmonks.org/)[精美的手册](http://perldoc.perl.org/)中甚至还有一些[不错的教程](http://perldoc.perl.org/index-tutorials.html)。

无论你做什么，都不要这样做：

```
for my $line ( <$log> ) {
    # parse line here.
} 
```

您会将整个日志文件读入内存，并且随着您的系统交换和交换（并可能崩溃），这将需要很长时间。

而是使用 while 循环：

```
while (defined( my $line = <$log> )) {
    # parse line here.
} 
```

* * *

## 回答 #5

> 赞同：13
> 
> 时间：2009-04-13T08:27:23.273

如果您确实**需要**使用正则表达式，那么 Perl 正则表达式引擎很难被击败。但是，如果没有它们，许多解析问题可以更有效地解决 - 例如，如果您只需要在某个字符处分割一行，在这种情况下 C 可能会更快。

如果性能是最重要的，那么您应该尝试两种语言，并测量速度差异。否则，只需使用您最喜欢的那个。

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2009-04-13T09:49:06.103

我猜测（代替对 Alphaneo 的实际数据进行基准测试，我没有）I/O 处理将成为这里的边界因素。而且我希望在启用了 usefaststdio 的 perl 上的 Perl 实现能够匹配或击败基本的 C 实现，但如果没有 usefaststdio 会明显变慢。（对于大多数平台，usefaststdio 在 perl 5.8 及更早版本中默认开启，而在 perl 5.10 中默认关闭。）

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2009-04-13T10:35:16.290

速度真的是这里的一个因素吗？你真的关心解析是在 5 分钟还是 10 分钟后完成吗？

选择提供最佳解析功能并且您最熟悉的语言或工具。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2009-04-13T07:32:01.470

过去，我发现 C 更快，但还没有到选择已成定局的程度。

您是否考虑过使用通用的 Log Parser 工具，例如[Log Parser](http://www.microsoft.com/downloads/details.aspx?FamilyID=890cd06b-abf8-4c25-91b2-f8d975cf8c07&displaylang=en)：

> 日志解析器是一个强大的通用工具，它提供对基于文本的数据（如日志文件、XML 文件和 CSV 文件）以及 Windows® 操作系统上的关键数据源（如事件日志、注册表、文件系统和 Active Directory®。

该[站点](http://www.loganalysis.org/sections/parsing/generic-log-parsers/)列出了一些通用日志解析器。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2009-04-13T07:48:36.907

与 C 相比，Perl 显然有一些开销。但是如果您将大部分时间花在用 C 实现的 Perl Regex 函数中，那么这个开销可能可以忽略不计。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2009-04-13T17:25:08.317

这部分取决于解析将如何集成到应用程序中。如果应用程序是解析器，那么 Perl 就可以了，因为它也会处理围绕它的所有内容，但是如果它直接集成到更大的应用程序中，那么您完全有可能想要研究类似 Lex (或 Flex）：[http://en.wikipedia.org/wiki/Lex_(software)](http://en.wikipedia.org/wiki/Lex_(software)) 该工具为您生成解析器，您可以将 C/C++ 代码直接集成到您的软件中。

至于速度方面的考虑，我同意这里大多数其他响应者的观点，即使用的库的成熟度将是主要因素，而 Perl 的库非常成熟。我不知道其他一些库有多成熟（例如 Boost 中可用于 C++ 的正则表达式），但是由于您的大部分处理时间都在库中，因此语言问题可能是次要的。

底线：使用你最熟悉的东西，并在库中做尽可能多的工作，因为它几乎总是比你用任何语言自己制作的更快。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2009-04-13T17:39:45.207

是的，如果您知道自己在做什么，那么您可以在 C 中创建一个更快的解析器。

然而，对于绝大多数人来说，更聪明的事情是担心代码的实现和维护的容易性。您无法正常工作的快速解析器对任何人都没有任何好处。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2009-04-13T07:33:57.050

如果您精通 Perl，请使用它。否则，请使用[AWK](http://en.wikipedia.org/wiki/Awk)和 SED。

解析文本不是你想用 C 做的。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-04-13T17:59:21.323

如果您以 Apache 通用日志格式解析日志，则用 C 编写的[访问者](http://www.hping.org/visitors/)将比任何可比较的 perl 日志解析器至少高出 2 倍。

因此，如果日志格式很常见，请找到现有的解析器并对其进行基准测试。

根据我过去的经验，在 C 中正确编写的日志解析器总是比在 Perl 中正确编写的日志解析器快得多。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2009-04-14T07:03:34.340

如果您要对每一行应用相同的正则表达式，请不要忘记，您可以通过将 /o 标志附加到模式来大大优化执行，即

如果（/[a-zA-Z]+/o）

这将导致表达式仅在内部编译一次，并且随后将重新使用该结果，而不是在每个连续的循环迭代中。

有了这种增强功能，如果您的 Perl 解析器没有遍历您在实际时间内可能提出的任何 C 实现，我会感到非常惊讶。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2010-12-03T12:06:22.660

如果您想通过 perl 读取 2 Gb，最好使用 sysread（具有足够大的块大小，例如 256k 或 512k）。PerlIO 使用太小的块大小 - 4k，效率低下。[有关PerlIO](http://www.perlmonks.org/?node_id=692348)块大小的更多信息，请参阅PerlMonks。

# php - 如何编辑和水印动画 gif，最好是通过 php？

> ID：743267
> 
> 赞同：0
> 
> 时间：2009-04-13T07:28:27.907
> 
> 标签：php, gif, animated-gif

我一直在到处寻找可以在服务器端操作动画 gif 文件的东西，最好是通过 php，但是可以通过 exec() 执行的简单命令行工具也可以。本质上，我希望为动画 gif 文件添加水印，并且能够从动画中剔除帧（例如，每 2、3 帧被删除）。

外面有这样的吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-13T07:32:11.813

[http://www.php.net/manual/en/book.imagick.php](http://www.php.net/manual/en/book.imagick.php)

在此处查看动画 GIF 示例：http: [//valokuva.org/ ?p=46](http://valokuva.org/?p=46)

# perl - 设计 Web 应用程序用户活动记录的最佳实践？

> ID：743278
> 
> 赞同：0
> 
> 时间：2009-04-13T07:35:29.887
> 
> 标签：perl, logging, web-applications, user-activity

我们有一个网络电子学习类型的系统，对于这个项目，我应该为整个系统设计一个活动记录功能，这样我们就可以追踪他们的日常活动，也许可以帮助他们提高工作效率。

不幸的是，这个系统很可能会被用来在官方时间跟踪用户的工作（并且对这个功能的需求可能是经济衰退驱动的）

实际上，我在设计这种类型的系统时相当无知，而且只有我们的一些模块具有活动日志记录。

我正在考虑列出我们当前在系统中拥有的所有可用功能，并列出我们想要保留的数据，并创建一个简单的函数，该函数将缓慢而痛苦地添加到每个模块中，这将开始转储将数据记录到我们的 MySQL 数据库。

它是一个连接到 MySQL 数据库的 Perl 应用程序，中间有 AXKit、XML、XLST 和 JavaScript。

有没有人有什么好的建议或资源可供我阅读和学习？

特别是关于良好的设计、用户界面、要生成的报告、数据库负载等。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-13T21:18:34.107

我想这在一定程度上取决于您对日志记录的具体需求，但通常[Log::Log4perl](http://search.cpan.org/dist/Log-Log4perl/)可以被欺骗去做您想做的事情。

# php - php： 从字符串末尾修剪？

> ID：743279
> 
> 赞同：0
> 
> 时间：2009-04-13T07:35:51.273
> 
> 标签：php

如何`<br>&nbsp;`从字符串的末尾修剪？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-13T07:46:28.067

```
$Output = preg_replace('/'.preg_quote('<br>&'.'nbsp;').'$/i', '', $String); 
```

`$String`输入在哪里`$Output`，结果在哪里。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-13T19:45:18.667

稍微快一点，如果你正在修剪的是恒定的：

```
$haystack = "blah blah blah <br>&"."nbsp;";
$needle = "<br>&"."nbsp;";
echo substr($haystack, 0, strrpos($haystack, $needle)); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2022-02-25T14:19:24.430

这是我的解决方案，它像 PHP 一样工作，`trim()`但带有文字

```
/**
 * Trim one or more words from a string
 * @param string   $string
 * @param string[] $words
 */
public function mb_word_trim( string $string, array $words ) : string
{
    // Cache the word lengths
    $wordLens = [];
    foreach ( $words as $word )
    {
        $wordLens[ $word ] = mb_strlen( $word );
    }

   $stringLength = mb_strlen( $string );

   // Loop until no words were trimmed
   do
   {
       $wordWasTrimmed = false;
       foreach ( $words as $word )
       {
            // Trim the start
            if ( mb_substr( $string, 0, $wordLens[$word] ) === $word )
            {
                $string = mb_substr( $string, $wordLens[$word] );
                $stringLength = mb_strlen( $string );
                $wordWasTrimmed = true;
            }

           // Time the end
           if ( mb_substr( $string, $stringLength - $wordLens[$word] ) === $word )
           {
               $string = mb_substr( $string, 0, $stringLength - $wordLens[$word] );
               $stringLength = mb_strlen( $string );
               $wordWasTrimmed = true;
           }

           // If a word was trimmed we need to restart the check from the begging of the array of words
           if ( $wordWasTrimmed )
           {
               break;
           }
       }
   } while ( $wordWasTrimmed );

   return $string;
} 
```

快速 PHP 单元测试

```
public function test_mb_word_trim() : void
{
    $string = "<br>  &nbsp; have some  BEER <br> don't mess with inner text  &nbsp; 123   &nbsp;";
    $wordsToTrim = [ '<br>', '&nbsp;', ' ', '' ]; // Note I've added an emoji to test multi byte

    $this->assertSame(
        "have some  BEER <br> don't mess with inner text  &nbsp; 123",
        \TGHelpers_String::mb_word_trim( $string, $wordsToTrim ),
    );
} 
```

# content-management-system - Joomla 适合社交网站吗？Joomla 的公正利弊

> ID：743281
> 
> 赞同：3
> 
> 时间：2009-04-13T07:36:30.167
> 
> 标签：content-management-system, joomla, social-networking, opencms

我们已将 Joomla 用作我们公司网站的开箱即用 CMS。

现在我们收到客户的要求，要创建一个旅游推荐网站。客户从未使用过 Joomla 进行编程。他使用 Joomla 作为开箱即用的组件。

他们需要创建目的地并在目的地上写下其他用户的评论、评级等。但他想重用现有的 Joomla 模块/插件以避免开发成本。

有人在这里使用过 Joomla 来完成这样的任务吗？对于可以使用什么 Joomla，我找不到更好的讨论？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-13T16:40:43.413

## Your specific problem

THE community extension for Joomla is [Community Builder](http://www.joomlapolis.com/) (CB). There are also voting, commenting, bloging, etc. extensions available.

Your problem will be to find a combination which does what you want to an acceptable extent. If your customer is not satisfied and has MUSTS which the Joomla+Extensions solution doesn't provide you will have to start hacking the extensions or start writing plug-ins.

Now hacking a Joomla installation is not really a good idea since upgrading will become hard and a not upgraded Joomla installation is a great security risk.

In the end you might be better of developing your own Joomla extension which does what you need it to do, or refrain from using Joomla at all.

The more extensions you use at the same time, the harder maintenance of hacked code will be.

## Joomla pros and cons in general

Joomla is definitely one of the best CMS but it always depends on your needs, what tools you use. Two websites can help with the choice greatly:

### CMS overviews

*   [OpensourceCMS](http://opensourcecms.com/) A page where you can live-test over a 100 open source CMS and similar software
*   [CMSMatrix](http://www.cmsmatrix.org/) Basically an extremely large feature comparison matrix of almost 1000 (a thousend, yes) CMS and similar software (in all price ranges)

### My own experience story

There was a time, when Typo3 was strong among free CMS but that time is over, the interface is clunky and complicated, Typo3 has fallen far behind in the race. Then there was a time when Mambo became strong and later Joomla split from Mambo and became even stronger. But the code legacy of the Joomla 1.0 series was strongly flawed and a new player quickly took the momentum: Drupal. Cleaner code, clearer node based architecture, maybe for some too hard to get. In the same time when Drupal got strong and popular, the Joomla 1.0 series had serious security problems. Stories about hacked installations piled up and Drupal had the pole position for some time. Joomla 1.5 is a completely different story. It has a few fantastic new features and in every upgrade (Now 1.5.10) more and more code follows OO, MVC and other nice principles. Together with the enormous wealth of extensions (components, plugins, design templates) Joomla definitely offers more options than any other open source CMS. I've had several extrem cases (for which I would do custom development today) where only Joomla was able to fullfill all the needs for a project. There are also a few new names which have a great potential. Silverstripe for example.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-11-19T03:21:11.357

我用过 CB、Joomunity、JomSocial 和其他一些。我的建议是使用另一个平台（对于这些类型的应用程序，我已经使用 BuddyPress 迁移到 WordPress），但它的价值：

Joomunity 现在更名为 Tuiyo (http://www.tuiyo.co.uk/)，并且一年多没有发布任何代码；当我最后一次使用它时，它被拼写错误所困扰，而且非常有问题。这几乎是蒸汽器皿。

JomSocial 运行良好，但我对 Azrul 的支持非常不满意——他们有一次发布了一个补丁，破坏了一堆语言文件，而*我*最终提供了一个工作替换文件。这对于开源项目来说很好，但对于商业项目来说却是不可接受的。我还不断收到奇怪的令牌错误，这些错误会导致代码停止（IE，空白屏幕上的错误）。

Community Builder 通常看起来很丑，没有很多工作，需要很多配置；它比其他的“开箱即用”要少得多。我已经尝试了一些分支，但对于我的经验来说，这些都不是很成熟。

此外，没有人提到 Anahita；我个人没用过，但看起来很酷。

但同样，我对 Joomla 的可用功能感到相当失望！在这方面。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-03T17:36:35.093

我建议您使用两个开箱即用的 Joomla 扩展来完成您想要做的事情：

评论：[Jreviews](http://www.reviewsforjoomla.com/)

社交网络：[Jomsocial](http://jomsocial.com)

这两个组件的总成本约为 200 美元，但它们可以很容易地集成在一起。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-10T11:12:56.490

只想补充几点：

*   CB 的代码看起来不是很优雅（+ 大部分没有使用强大的 Joomla 1.5 MVC 架构。
*   那里有几个新的社交网络扩展。提到了 JomSocial，但也有[jCoummnity](http://www.ijoobi.com/applications/jcommunity/jcommunity-easily-create-your-online-community.html)（虽然代码受到保护，所以你不能查看它的内部工作原理）和开源和免费的[JooCommunity 。](http://my.joomunity.org/)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-09-07T06:04:23.097

评级扩展是一毛钱。至于评论和其他社交活动，你为什么不安装一个 Facebook 扩展程序。有一些非常强大，Facebook 非常擅长将社交网络流量吸引到任何网站。

# java - Java：同步实用程序

> ID：743288
> 
> 赞同：3
> 
> 时间：2009-04-13T07:44:06.840
> 
> 标签：java, synchronization, utilities

*我问这个纯粹是为了确定在问题中实现类的价值......*

您是否知道一个 Java 实用程序类，它采用非同步实例，使用反射来调查该实例，并在同步调用中返回“包装”的输入实例？

（即：为任何实例创建同步委托类的工厂）

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-13T07:53:56.660

不，我不知道有什么能做到这一点——而且我很少想使用它。

同步单个操作很少是有用的功能。通常，您希望一次同步几个操作。简单地同步单个操作的东西给人一种线程安全的*错觉*（足以让一些程序员粗心），而没有处理在任何特定情况下需要以原子方式执行哪些操作的真正决定。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-04-13T08:01:22.307

我喜欢 Jon Skeet 的回答；它看到的是森林而不是树木。但是要回答这个问题：

假设实例属于某个接口，使用起来很容易`java.lang.reflect.Proxy`。

```
public final class SynchronizedFactory {
    private SynchronizedFactory() {}

    public static <T> T makeSynchronized(Class<T> ifCls, T object) {
        return ifCls.cast(Proxy.newProxyInstance(
                object.getClass().getClassLoader(),
                new Class<?>[] {ifCls},
                new Handler<T>(object)));
    }

    private static class Handler<T> implements InvocationHandler {
        private final T object;

        Handler(T object) {
            this.object = object;
        }

        @Override
        public Object invoke(Object proxy, Method method,
                Object[] args) throws Throwable {
            synchronized (object) {
                return method.invoke(object, args);
            }
        }
    }
} 
```

顺便说一句，此代码未经测试。使用风险自负。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2014-01-20T20:35:14.920

我想提请注意 Chris Jester-Young 的解决方案有多酷。我已将它重构为一个简单的静态函数，我已成功使用该函数，我已将其包含在下面。谢谢克里斯！

```
/**
 * Utility that can take any object that implements a given interface and returns
 * a proxy that implements the same interface and synchronizes all calls that are
 * delegated to the given object. From Chris Jester-Young, http://about.me/cky
 * @param interfaceClass The interface to synchronize. Use MyInterface.class.
 * @param object The object to synchronize that implements the given interface class.
 * @return A synchronized proxy object that delegates to the given object.
 */
public static <T> T makeSynchronized(Class<T> interfaceClass, final T object) {
    return interfaceClass.cast(
        Proxy.newProxyInstance(
            object.getClass().getClassLoader(),
            new Class<?>[]{interfaceClass},
            new InvocationHandler() {
                @Override
                public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {
                    synchronized (object) {
                        return method.invoke(object, args);
                    }
                }
            }
        )
    );
} 
```

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-04-28T06:23:02.463

反射的开销也会降低通过线程化代码获得的加速......

# excel - 一种以编程方式将图片添加到 Excel 工作表但不是从文件中添加图片的方法

> ID：743290
> 
> 赞同：2
> 
> 时间：2009-04-13T07:46:22.247
> 
> 标签：excel

我正在开发一种将文件加载到 Excel 工作表中的产品。该文件包含转换为图片（使用某些 Web 服务）然后显示在工作表上的数据。

最近，我正在考虑在此加载操作中避免文件 IO。如果导入文件包含 1000 条记录，则加载方法必须创建和删除 1000 个使用 Shapes.AddPicture() 命令导入 Excel 的临时文件。

有没有办法使用一些内存方法在 Excel 工作表上添加图片并避免文件 IO？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-13T08:54:30.807

是的，您可以将图片放入剪贴板并粘贴。

但是，这样做的缺点是从剪贴板上擦除用户的东西，这不是一件好事。

# asp.net-mvc - 如何在我自己的路由处理程序中指定控制器名称和操作名称？

> ID：743312
> 
> 赞同：0
> 
> 时间：2009-04-13T07:58:53.700
> 
> 标签：asp.net-mvc, routing

我正在添加一条新路线来`RouteCollection`像这样：

```
routes.Add(new Route("{*data}", new MyRoutehandler())); 
```

如何在此`MyRouteHandler`（我自己的路由处理程序）中指定控制器名称和操作名称？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-13T08:05:41.250

看看这里：

*   [ASP.NET MVC 的自定义路由](http://codingcockerel.co.uk/2008/05/26/custom-routing-for-asp-net-mvc/)
*   [ASP.Net MVC 框架 - 创建自己的 IRouteHandler](http://weblogs.asp.net/fredriknormen/archive/2007/11/18/asp-net-mvc-framework-create-your-own-iroutehandler.aspx)
*   [ASP.Net MVC 框架 - 创建一个支持拦截器的 IRouteHandler](http://weblogs.asp.net/fredriknormen/archive/2007/11/19/asp-net-mvc-framework-creating-a-iroutehandler-which-will-support-interceptors.aspx)
*   [ASP.NET MVC 技巧：路由引擎辅助 SEO/301 重定向/跟踪](http://geekswithblogs.net/shahed/archive/2009/02/14/129386.aspx)

# .net - 如何在 C++（DATATABLE）中实例化托管类？

> ID：743314
> 
> 赞同：0
> 
> 时间：2009-04-13T07:59:18.427
> 
> 标签：.net, c++-cli

嗨，当我尝试创建实例时，我正在 C++ 中创建一个数据表，如下所示
，因为无法为抽象类创建实例，所以出现编译时错误。在这里，我没有使用任何抽象关键字。

```
#include "stdio.h"
#include "conio.h"
#using <mscorlib.dll>
using namespace System::Data;
using namespace System::ComponentModel;
using namespace System;

[Serializable]
 public __gc class Table :public MarshalByValueComponent,public IListSource,public ISupportInitialize,public System::Runtime::Serialization::  ISerializable

{
public:
    void MakeTable();
void main()
  {  
    Table *s=new Table();
    s->MakeTable();
    Console::WriteLine("Hai");
    printf("hello");
    getch();
  }
};
 void Table::MakeTable()
 {

     DataSet* myDataSet;
    // Create a new DataTable.
    DataTable* myDataTable = new DataTable(S"ParentTable");
    // Declare variables for DataColumn and DataRow objects.
    DataColumn* myDataColumn;
    DataRow* myDataRow;

    // Create new DataColumn, set DataType, ColumnName and add to DataTable.    
    myDataColumn = new DataColumn();
    myDataColumn->DataType = System::Type::GetType(S"System.Int32");
    myDataColumn->ColumnName = S"id";
    myDataColumn->ReadOnly = true;
    myDataColumn->Unique = true;
    // Add the Column to the DataColumnCollection.
    myDataTable->Columns->Add(myDataColumn);

    // Create second column.
    myDataColumn = new DataColumn();
    myDataColumn->DataType = System::Type::GetType(S"System.String");
    myDataColumn->ColumnName = S"ParentItem";
    myDataColumn->AutoIncrement = false;
    myDataColumn->Caption = S"ParentItem";
    myDataColumn->ReadOnly = false;
    myDataColumn->Unique = false;
    // Add the column to the table.
    myDataTable->Columns->Add(myDataColumn);

    // Make the ID column the primary key column.
    DataColumn* PrimaryKeyColumns[] = new DataColumn*[1];
    PrimaryKeyColumns->Item[0] = myDataTable->Columns->Item[S"id"];
    myDataTable->PrimaryKey = PrimaryKeyColumns;

    // Instantiate the DataSet variable.
    myDataSet = new DataSet();
    // Add the new DataTable to the DataSet.
    myDataSet->Tables->Add(myDataTable);

    // Create three new DataRow objects and add them to the DataTable
    for (int i = 0; i<= 2; i++){
       myDataRow = myDataTable->NewRow();
       myDataRow->Item[S"id"] = __box(i);
       myDataRow->Item[S"ParentItem"] = String::Format( S"ParentItem {0}", __box(i));
       myDataTable->Rows->Add(myDataRow);
    } 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-13T09:04:59.860

您可能没有在接口中实现成员（IListSource 需要[GetList](http://msdn.microsoft.com/en-us/library/system.componentmodel.ilistsource_methods.aspx]) 方法），因此在您实现（或子类然后实现）缺少的方法之前，您的类是抽象的。

# paradigms - Dtrace 的编程范式是什么？

> ID：743316
> 
> 赞同：2
> 
> 时间：2009-04-13T08:00:11.043
> 
> 标签：paradigms, dtrace

我使用 Dtrace 已经有一段时间了，随着时间的推移，我开始想知道 Dtrace 中使用的 D 语言的编程范式是什么。

我猜它不是命令式语言，所以这意味着它是某种声明性功能语言，但我不是语言分类学方面的专家，那么 D 语言应该正式（或半正式）归类为什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-13T09:01:01.633

D 语言似乎是 C 的子集，添加了特定于跟踪的内置函数（变量、函数）。它可以在结构上与 awk 或 YACC 程序进行比较：它由一个或多个检测点（探针、规则）的列表组成，每个探针与一个操作相关联。

我的 2 美分。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-01-16T11:29:18.863

Dtrace 显然与[面向方面的编程](http://en.wikipedia.org/wiki/Aspect-oriented_programming)有关，因为它以某种方式 将其探测*编织*到正在研究的程序中。

我会说编织点的规范属于*声明式编程*世界，而探针本身是命令式编程的（类似 C）。不确定这是否回答了您的问题:-)

# c++ - 将堆栈分配的对象作为指针参数发送给其他函数是否很好？

> ID：743321
> 
> 赞同：7
> 
> 时间：2009-04-13T08:03:29.990
> 
> 标签：c++, function, parameters

将堆栈分配的对象作为指针参数发送给其他函数是否很好？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-13T08:12:40.203

是的，但这种情况下更常见的 C++ 习惯用法是使用引用（可能是 const rreference）而不是指针。所以而不是

```
void foo( sometype * p ) {
   p->func();
} 
```

你写：

```
void foo( sometype & p ) {
   p.func();
} 
```

这样做的好处是您不需要在调用者中取消引用对象：

```
void afunc() {
   sometype t;
   foo( t );
} 
```

并且还给读者一个潜意识的暗示，你不打算让函数获得对象的所有权。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-04-13T08:05:44.463

如果您确定调用是同步的，那么将堆栈分配对象的地址发送给函数是完全有效的。如果调用是异步的（即您调用的函数将指针传递给不同的线程），那么它肯定会产生问题，因为即使在堆栈分配的对象被销毁后，您也可能尝试从不同的线程访问内存地址。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-04-13T08:07:07.377

只要接收函数不假设它获得了资源的所有权（并试图释放它），当然可以。不过，参考可能是一个更好的主意。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-13T08:07:47.190

它非常适合同步函数调用。如果调用是异步的，当堆栈对象超出范围时被删除时，它可能会导致崩溃。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-13T10:02:18.473

您应该注意不要存储该指针以供进一步使用。例如：

```
void store(int* param) {
     // Store pointer in some global storage for further use
     global_storage.add_param(param); 
}
void func() {
    int test_var = 5;
    store(&test_var); // Pass the pointer to the global storage
} 
// At this point stack object test_var will be destroyed
// Global storage contains a pointer, that points to some garbage 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-13T12:58:44.947

这当然是有效的，但有很多警告。以下是要记住的最重要的事情（有些人已经提到过，有些没有。）

*   指针本身可能暗示资源所有权被传递给被调用者（即他们必须在使用后释放它）。这里有一个参考。
*   在许多情况下，您需要调用的函数已经定义并且您无法更改它，您必须研究它的行为并确保它不会假定它将拥有该对象、静态存储它或将其复制到其他地方。
*   如果您正在调用的函数需要使用空指针来指示缺少所述参数，则您将无法选择使用引用。
*   异步调用绝对是一个禁忌（当然，除非您阻塞，直到它们使用本地对象完成然后返回）。
*   被调用的函数在任何情况下都不应访问超出相关对象的大小，这将破坏您的堆栈并几乎肯定会使您的程序崩溃！
*   Calling a function that is susceptible to accessing bytes beyond the size of the object may be a security liability. In deed, this is the most common method for breaking into secure systems. This is called buffer overflow. (beyond the scope of your question, but you can read more [here](http://en.wikipedia.org/wiki/Buffer_overflow) and [here](http://searchsecurity.techtarget.com/news/article/0,289142,sid14_gci1048483,00.html))

# nhibernate - NHibernate 启用 log4net

> ID：743323
> 
> 赞同：2
> 
> 时间：2009-04-13T08:04:33.217
> 
> 标签：nhibernate

我启用了 log4net 并运行了我的应用程序，它给出了异常。

但是日志文件是空的。

NHibernate 不会记录有关异常的信息？？？

马尔科姆

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-13T09:43:31.343

您需要配置 log4net。只需将 log4net dll 添加到项目中就不会记录任何内容。您需要创建附加程序来指定所有登录应定向到的位置。创建一个像这样的 xml 文件：

```
 <log4net>  
    <appender name="RollingFileAppender" type="log4net.Appender.RollingFileAppender">  
        <file value="Logs\Trace.log" />  
        <appendToFile value="true" />  
        <rollingStyle value="Composite" />  
        <maxSizeRollBackups value="30" />  
        <maximumFileSize value="1000KB" />  
        <layout type="log4net.Layout.PatternLayout">  
            <conversionPattern value="%date [%thread] %-5level - %message%newline" />  
        </layout>  
        <threshold value="DEBUG"/>  
    </appender>  
    <root>  
        <appender-ref ref="RollingFileAppender" />  
    </root>  
</log4net> 

```

...并在启动应用程序时对其进行配置：

```
 public static void Main()
   {  
      var logconfig = new System.IO.FileInfo(PATH_TO_LOG_CONFIG);  
      if(logconfig.Exists)  
      {  
          log4net.Config.XmlConfigurator.ConfigureAndWatch(logconfig);  
      }  
   } 

```

# asp.net - 使用复选框自定义 AJAX AutoCompleteExtender

> ID：743335
> 
> 赞同：1
> 
> 时间：2009-04-13T08:12:44.477
> 
> 标签：asp.net, ajax, drop-down-menu, checkbox, autocompleteextender

我想实现一个多选 AutoCompleteExtender，它在每一行上显示一个复选框。我发现了一些在下拉列表中实现复选框的示例，但没有涉及 AutoCompleteExtender。有任何想法吗？

谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-13T08:53:46.610

AutoCompleteExtender 将扩展什么控件 - 下拉复选框列表？

[AJAX 控件工具包](http://ajaxcontroltoolkit.codeplex.com/Release/ProjectReleases.aspx?ReleaseId=16488)有一个 AutoCompleteExtender 来扩展文本框，值得下载并查看源代码以了解如何去做。

还有一个[关于如何开发自己的扩展器的演练](http://www.asp.net/AJAX/AjaxControlToolkit/Samples/Walkthrough/CreatingNewExtender.aspx)

# java - 无法通过 Java6 中的 jconsole 连接到 Tomcat 的 MBeanServer

> ID：743343
> 
> 赞同：2
> 
> 时间：2009-04-13T08:20:16.987
> 
> 标签：java, tomcat, jmx, administration

我在vista机器上。我已经使用以下选项启动了 tomcat 5.5.27：

```
CATALINA_OPTS="-Dcom.sun.management.jmxremote.port=9003 \
    -Dcom.sun.management.jmxremote.ssl=false \
    -Dcom.sun.management.jmxremote.authenticate=false" 
```

当我通过 jconsole 连接并添加以下服务 url

```
service:jmx:rmi:///jndi/rmi://localhost:9003/jmxrmi 
```

它不会连接。有任何想法吗 ？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2011-08-10T20:21:18.530

好的，我原本以为 op 给出的 URL 是错误的，但事实证明不是。所以我无法回答。

不过，这里是基础知识：

通过`jconsole`.

例如，如果您**知道**要连接的 JMX 服务器的*RMI 注册表端口*为 9003，请使用

```
localhost:9003 
```

反而。

否则，这就是我从头开始发现的：

假设您在“目标机器”上运行 JMX 服务器（别名“JMX 代理”别名“您要连接的 JVM”），*RMI 注册表端口*位于“RMI REGISTRY PORT”，*JMX RMI 服务器端口*位于“JMX RMI”服务器端口'。

笔记：

1.  *RMI 注册表*告诉 JMX 客户端在哪里可以找到*JMX RMI 服务器端口*；可以在 key 下获取信息`jmxrmi`。
2.  *RMI 注册端口*通常是众所周知的，因为它是在 JVM 启动时通过系统属性设置的。
3.  *JMX RMI 服务器端口*通常是**未知**的，因为 JVM 随机选择它（如果没有采取其他预防措施）。

以下 URI 将导致成功（已测试）

`service:jmx:rmi://<TARGET_MACHINE>:<JMX_RMI_SERVER_PORT>/jndi/rmi://<TARGET_MACHINE>:<RMI_REGISTRY_PORT>/jmxrmi`

这看起来很恶心。让我们把它分开。

这个 URI 是一个 RFC2609 “服务位置协议 URL”（嗯，它真的是一个 URI，对吧？）

它由以下部分组成：

*   `service`- 一个常数
*   `jmx:rmi`-*服务类型*由：*抽象类型* `jmx`和*URL方案组成* `rmi`
*   其余的 - *sap*（服务访问协议规范）

*树液*分解为：

*   `//<TARGET_MACHINE>:<JMX_RMI_SERVER_PORT>`- ipsite
*   `/jndi/rmi://<TARGET_MACHINE>:<RMI_REGISTRY_PORT>/jmxrmi`- 网址部分

消息灵通的 JMX 客户端连接到“ipsite”以进行 JMX-over-RMI 交换；但是不知道该端口的 JMX 客户端呢？耐心...

*URL部分*分解为：

*   `/jndi/`- 这似乎告诉 JMX 客户端它可以在后面的位置获取查找信息
*   `rmi://<TARGET_MACHINE>:<RMI_REGISTRY_PORT>/jmxrmi`- 是的，我们在 RMI 注册表中的查找键下获取有关 JMX RMI 服务器的信息`jmxrmi`

这有点先入为主，因为必须先联系SLP URL**后半部分**给出的*RMI 注册表。*

 **挠头之后，直观地，让我们尝试一下：

`service:jmx:rmi://<TARGET_MACHINE>/jndi/rmi://<TARGET_MACHINE>:<RMI_REGISTRY_PORT>/jmxrmi`

是的，这行得通！JMX RMI 服务器端口很好地从注册表中获得。再三考虑，*目标机器*也应该从注册表中获得，因此：

`service:jmx:rmi:///jndi/rmi://<TARGET_MACHINE>:<RMI_REGISTRY_PORT>/jmxrmi`

更好的是，这也有效！

参考：

```
1 download.oracle.com/javase/6/docs/api/javax/management/remote/rmi/package-summary.html
2 download.oracle.com/javase/6/docs/api/javax/management/remote/JMXServiceURL.html
3 mx4j.sourceforge.net/docs/ch03s04.html
4 download.oracle.com/javase/6/docs/technotes/guides/management/agent.html#gdevg
5 http://www.rfc-editor.org/rfc/rfc2609.txt 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2010-12-03T10:31:35.653

在使用 OpenJDK 6 和 Tomcat 6.0.29 的 Ubuntu 10.04 上，无论我使用 CATALINA_OPTS 将多少**com.sun.management.jmxremote.***选项传递给 java，我都无法为本地 jconsole 会话激活 JMX。问题是**-Djava.io.tmpdir**设置，默认为**$CATALINA_BASE/temp**。我只需要设置：

```
CATALINA_TMPDIR="/tmp" 
```

在*bin/catalina.sh*的开头，我能够在本地连接 jconsole、jmap、jps 等。根本不需要任何**com.sun.management.jmxremote.***设置。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-14T10:34:20.870

Are the processes run under the same user?

You can also check by running jps and jconsole (both in the JDK_HOME/bin directory)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-08-09T19:45:17.277

OS X 10.7 aka Lion 也需要此功能。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2014-03-06T14:38:07.770

我在这里回答了一个类似的问题：[java.rmi.ConnectException: Connection denied to host: 127.0.1.1;](https://stackoverflow.com/questions/15685686/java-rmi-connectexception-connection-refused-to-host-127-0-1-1)

我发现了很多关于这个主题的问答，并不是什么都对我有帮助——那是因为我的问题更基本（我能说什么我不是网络专家:)）。我在 /etc/hosts 中的 IP 地址不正确。我尝试过的 CATALINA_OPTS 包括以下内容：

```
CATALINA_OPTS="$CATALINA_OPTS -Djava.awt.headless=true -Xmx128M -server 
-Dcom.sun.management.jmxremote 
-Dcom.sun.management.jmxremote.port=7091 
-Dcom.sun.management.jmxremote.authenticate=false 
-Dcom.sun.management.jmxremote.ssl=false
-Djava.rmi.server.hostname=A.B.C.D"  #howeverI put the wrong ip here!

export CATALINA_OPTS 
```

我的问题是我几个月前更改了我的 IP 地址，但从未更新我的 /etc/hosts 文件。似乎默认情况下 jconsole 以某种方式使用主机名 -i ip 地址，即使我正在查看本地进程。最好的解决方案是简单地更改 /etc/hosts 文件。

另一个可行的解决方案是从 /sbin/ifconfig 获取正确的 IP 地址，并在例如 catalina.sh 脚本中指定 IP 地址时使用该 IP 地址：

```
-Djava.rmi.server.hostname=A.B.C.D 
```

# php - 关于数据库更改的实时更新通知 MYSQL PHP

> ID：743346
> 
> 赞同：10
> 
> 时间：2009-04-13T08:21:49.993
> 
> 标签：php, mysql

我想知道如果使用 PHP 和 MySQL 将新记录插入数据库，如何触发通知。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2011-11-18T16:50:37.557

您可以创建一个触发器，然后在更新发生时运行。可以使用 UDF（用户定义函数）运行/通知外部进程。没有任何内置方法可以这样做，所以这是一个加载 UDF 插件的情况，它会为您完成。

谷歌搜索“mysql udf sys_exec”或“mysql udf ipc”。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-13T08:30:07.633

最简单的事情可能是每隔几秒钟轮询一次数据库，看看是否插入了新记录。由于数据库中的查询缓存，这不会显着影响数据库性能。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-13T08:28:37.530

MySQL 现在确实有触发器和存储过程，但我不相信它们有任何通知外部进程的方法，据我所知这是不可能的。您必须每秒钟左右轮询一次数据库以查找新记录。

即使是这样，这也假定您的 PHP 进程是长期存在的，这样它就可以承受等待记录出现的代价。鉴于大多数 PHP 用于代码运行然后尽快退出的网站，因此不清楚这是否与您所拥有的兼容。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-13T12:42:09.353

如果您的所有数据库更改都是由 PHP 进行的，我将为 mysql_query 创建一个包装函数，并且如果查询类型是 INSERT、REPLACE、UPDATE 或 DELETE，我将调用一个函数来发送相应的电子邮件。

编辑：我忘了提及，但您也可以执行以下操作：

```
if (mysql_affected_rows($this->connection) > 0)
{
    // mail(...)
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-14T22:14:45.867

有一天，我在 MySQL 论坛上询问 MySQL 中是否存在 Firebird 或 Interbase 等事件，我看到有人回答是（我真的不确定）

检查这个： http: [//forums.mysql.com/read.php?84,3629,175177#msg-175177](http://forums.mysql.com/read.php?84,3629,175177#msg-175177)

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-05-22T14:02:42.723

这可以使用存储过程和触发器相对容易地完成。我创建了一个“实时视图”屏幕，它有一个滚动显示，它会使用我的事件表中的新事件进行更新。它可能有点繁琐，但一旦运行很快。

# c# - 验证反射

> ID：743355
> 
> 赞同：1
> 
> 时间：2009-04-13T08:28:16.437
> 
> 标签：c#, asp.net, validation, reflection

```
CustomerValidator: AbstractValidator<Customer> 
```

如果传递一个客户的实例，如何动态实例化上面的类？同样，如果我有：

```
Cat c = new Cat(); 
```

我想动态调用实现的类

```
AbstractValidator<Cat> 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-13T08:46:55.817

一种常见的方法（如果你同时拥有`Customer`and `CustomerValidator`）是通过属性用提供验证的类来装饰类：

```
[Validator(typeof(CustomerValidator))]
public class Customer { } 
```

*请注意，您可能会发现在泛型之外*工作更容易，可能通过接口（注意：此处未显示方法等）：

```
public interface IValidator { }
public class CustomerValidator : AbstractValidator<Customer> {}
public class AbstractValidator<T> : IValidator where T : class {} 
```

然后通过反射获得正确的验证器：

```
[AttributeUsage(AttributeTargets.Class, AllowMultiple = false, Inherited = true)]
public sealed class ValidatorAttribute : Attribute
{
    public Type ValidatorType { get; private set; }
    public ValidatorAttribute(Type validatorType)
    {
        ValidatorType = validatorType;
    }
    public static IValidator GetValidator(object obj)
    {
        if (obj == null) return null;
        return GetValidator(obj.GetType());
    }
    public static IValidator GetValidator(Type type)
    {
        if (type == null) return null;
        ValidatorAttribute va = (ValidatorAttribute)
            Attribute.GetCustomAttribute(type, typeof(ValidatorAttribute));
        if (va == null || va.ValidatorType == null) return null;
        return (IValidator) Activator.CreateInstance(va.ValidatorType);
    }
} 
```

所以调用`GetValidator`应该返回`null`或一个合适的`IValidator`.

您可以在上面使用泛型 - 但它通常会产生比在这样的示例中解决的问题更多的问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-13T13:22:35.670

我建议您参考**[Imaar Spaanjaars提出的解决方案，他在他为“](http://imar.spaanjaars.com)****[使用 ASP.NET 3.5 的 N 层 Web 应用程序](http://imar.spaanjaars.com/QuickDocId.aspx?quickdoc=476)**”撰写的一系列文章中提供了该解决方案。该系列的[第 2 部分](http://imar.spaanjaars.com/QuickDocId.aspx?quickdoc=477)提供了完全符合您要求的解决方案。我已经在我的模型中成功地实现了这个解决方案，并且它工作得非常完美。

这是链接：

[链接文本](http://imar.spaanjaars.com/QuickDocId.aspx?quickdoc=477)

另请参阅[第 3 部分](http://imar.spaanjaars.com/QuickDocId.aspx?quickdoc=478)，其中讨论了验证的高级场景。

# css - 使用 CSS 进行 GUI 编程

> ID：743358
> 
> 赞同：1
> 
> 时间：2009-04-13T08:29:50.957
> 
> 标签：css, user-interface

我将为游戏 GUI 编写一个简单的布局系统。我想到了 GUI 中使用的各种布局系统，比如绝对定位、Java 的布局管理器、spring 和 struts 等。最后我发现我更喜欢 CSS 所看到的布局——填充、边距、浮动、块、内联等。你见过这样的应用程序 GUI 吗？不是 Web 应用程序，而是必须从头开始编写 CSS 布局系统的“真实”应用程序。你认为有可能得到一个工作和富有表现力的类似 CSS 的布局系统，即使非常简单，也有相当数量的代码？

* * *

*更新：*我不想从外部样式表创建 GUI。我会对运行时界面感到满意，即。像这样的东西：

```
Widget *container = [Container withWidth:100 height:100];
Widget *button1 = [Button withText:@"Foo"];
Widget *button2 = [Button withText:@"Bar"];
button1.floating = button2.floating = YES;
[container addObjects: button1, button2, nil]; 
```

早该说的，抱歉。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-13T08:37:39.333

我不确定这是否真的是最好的方法，但我看不出有任何问题会阻止你这样做。您需要某种 CSS 解析器才能从样式表实际创建 GUI，但我想这是可行的。那里已经有一堆 CSS 解析器，您可能只需要稍微定制一下，以满足您对 GUI 的特定需求。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-13T08:48:05.330

我过去已经这样做了，如果你不完全实现 CSS 规范并且只实现你需要的东西，它真的是可行的。我最终做的是实现一个 CSS 解析器、选择器语句和级联规则。属性和布局模型完全不同，因为当时根本不需要。我会说这也是编写完整 CSS 引擎的大部分工作所在。

相反，我所做的是创建一些模仿 HTML 表格工作方式的东西，因为它们在概念上易于使用，并且因为应用程序本身对整个“语义网络”讨论是公正的。

除了 CSS 规范本身，我找不到很多有用的资源，因为它已经包含 flex 和 bison 语法规则。

* * *

**编辑：**在这种情况下，您可能想查看 WebKit 和 Mozilla 如何实现其布局引擎作为参考。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-13T08:46:54.600

不，我从未见过围绕 CSS 命名方案设计的应用程序。

是的，我认为创建这样一个系统是完全可能的，程序员能够以编程方式移动按钮和其他字段。通常使用小部件存在的默认功能和参数，如果您要使用这些小部件并从它们派生，您将能够完成您想要的。

我不确定您为什么要这样做，但答案是肯定的，这是可能的！

# python - 如何将字符串表示字节转换回字节？

> ID：743374
> 
> 赞同：1
> 
> 时间：2009-04-13T08:42:41.880
> 
> 标签：python, web-services

我正在使用 SUDS 与 C# 编写的 Web 服务进行通信。该服务接收一个 url，爬取其网页，然后将其内容作为 byte[] 返回。

它在 SOAP 中的类型是：

```
<s:element minOccurs="0" maxOccurs="1" name="rawByte" type="s:base64Binary" /> 
```

示例客户端代码：

```
>>> from suds.client import Client
>>> url = "http://WSServer/Service1.asmx?wsdl"
>>> client = Client(url)
>>> page = client.service.GetURLContent("http://www.google.co.uk")
>>> print page
(CrawlResult){
   crawStatus = "SUCC"
   rawByte = "PGh0bWw+PGhlYWQ+PG1ldGEgaHR0cC1lcXVpdj0iY29udGVudC10eXBlIiBjb2 ... " 
```

问题是如何将 rawByte 从字符串转换为字节，然后将其解释为带有编码的文本（如“ascii”）。

我不清楚。

谢谢，丹尼尔。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-13T08:47:05.283

正如 SOAP 元素所说，字节是[base64 编码的](http://en.wikipedia.org/wiki/Base64)。

要解码，请使用 python 模块 [`base64`](http://docs.python.org/library/base64.html)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-13T09:07:06.750

我需要使用 binascii 模块将其转换回字符串，例如：

```
>>> btxt = binascii.a2b_base64(page.rawByte) 
```

那么 btxt 可以被视为一个普通的字符串。

# asp.net-mvc - 控制器动作调用者

> ID：743375
> 
> 赞同：9
> 
> 时间：2009-04-13T08:42:42.127
> 
> 标签：asp.net-mvc, asp.net-mvc-routing, controlleractioninvoker

ControllerActionInvoker 类有什么用？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-04-15T16:42:09.260

基本上，它是 Controller 类的一个可扩展点，允许您进入并影响控制器与参数、过滤器和操作本身的交互方式。当请求被路由到 Controller 时，Controller 会要求 ControllerActionInvoker 处理该请求（这通常涉及它在 Controller 上调用一个方法）。

到目前为止，我看到的主要用途是为动作过滤器提供依赖注入，如此处所示[，](https://lostechies.com/jimmybogard/2010/05/03/dependency-injection-in-asp-net-mvc-filters/)但我相信我们将来会看到此功能的更多用途！

# c# - .NET 中的选择性资源编译？

> ID：743377
> 
> 赞同：1
> 
> 时间：2009-04-13T08:44:51.157
> 
> 标签：c#, .net, vb.net, visual-studio

如何根据使用的编译常量选择要编译的资源？所以，如果 VAR1=0 那么我不会将 RESOURCE_A 添加到我的最终程序集中。

我四处搜索，但没有找到任何有关此的信息...我想我使用了错误的关键字，因为我怀疑以前没有人遇到过这个问题/怀疑。

此外，我在工作中同时使用 VS2005 和 2008，主要是 VB，尽管我在使用 C# 时也没有遇到任何问题。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-30T21:26:19.500

您可以使用 MSBuild <Choose> 元素完成此操作：

```
<Choose>
    <When Condition=" '$(Configuration)'=='Debug' ">
        <ItemGroup>
            <EmbeddedResource Include="debug_resource.txt" />
        </ItemGroup>
    </When>
    <When Condition=" '$(Configuration)'=='retail' ">
        <ItemGroup>
            <EmbeddedResource Include="retail_resource.txt" />
        </ItemGroup>
    </When>
</Choose> 
```

...当然，您可以使用 $(Configuration) 变量以外的东西。您可以检查文件/文件夹的存在，使用另一个任务的输出，或者完全使用不同的变量。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-13T10:27:44.857

编译常量只影响代码。您可以将这两种资源都添加到程序集中，并根据编译常量检索适当的资源。

当然还有其他方法可以实现这一点 - 例如，根据您定义的某些标准在预构建事件中复制适当的资源。

# design-patterns - DDD 聚合与 GoF 的外观

> ID：743382
> 
> 赞同：6
> 
> 时间：2009-04-13T08:47:18.030
> 
> 标签：design-patterns, oop, domain-driven-design

除了实现细节之外，DDD 聚合是否类似于 GoF 的外观？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-13T09:14:41.803

GoF Façade，很像真正的外观，通过创建另一个抽象来隐藏底层实现的复杂性；它将一个复杂且通常独立的系统（或子系统）隐藏在一个简单易用的界面后面。例如，游戏的外观可能具有 start、update 和 pause 方法；完全隐藏了游戏的实现，但提供了一种与之交互的高级方式。

另一方面，DDD 聚合是一种在对象之间指定“has-a”关系的方法，这些对象之间的相关性比普通引用更强。它们可以被视为域对象树中的节点，并且在数据交换方面它们通常被视为单个单元。

# c++ - 如何在 C++ 中重构一个类以使某个函数成为 const？

> ID：743395
> 
> 赞同：2
> 
> 时间：2009-04-13T08:59:30.840
> 
> 标签：c++, oop, constants

我有一个看起来像这样的类：

```
class MyClass
{
public:
  // some stuff omitted

  /*** 
    A function which, in itself, is constant and doesn't change the class
  ***/
  void myFunction( void ) const;
private:
  /***
    If loaded is true, then internal resources are loaded
  ***/
  boolean loaded;
}; 
```

因为我以这种方式设计了我的课程，所以我被迫这样做：

```
MyClass :: myFunction( void ) const
{
  if( !loaded )
  {
     // do something here

     loaded = true; /** <-- this violates const **/
  }

  // carry out some computation
} 
```

因为我需要设置*加载*标志，所以该函数现在违反了*const*限定符。

我有很多存储常量对象的代码，将它们更改为非常量对象会很耗时。此外，这会有点 hacky，因为我真的希望对象是 const。

重构我的类以保持*myFunction*不变的最佳方法是什么？

PS由于*loaded*保护的资源只有几个功能需要，所以提前加载并不是一个很好的解决方案。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-13T09:01:19.633

使用**可变**关键字。

```
class MyClass
{
public:
  void myFunction( void ) const;
private:
  mutable boolean loaded;
}; 
```

这表示加载的成员应该被视为逻辑上的 const 但物理上它可能会改变。

# asp.net - 将 ASP.NET 网页链接到另一个项目的代码文件

> ID：743398
> 
> 赞同：0
> 
> 时间：2009-04-13T09:01:46.217
> 
> 标签：asp.net

我有一系列 .NET 2.0 web 项目，它们的网页中有相同的代码。唯一不同的是 html 的布局方式。

有没有办法让我拥有一个包含所有代码的主 Web 项目（包括按钮单击等控制事件），以便其他 Web 项目将网页代码文件引用到该项目的代码文件？

编辑：请注意，html 中的更改包括排除某些控件，我通过使用该`FindControl`方法来解决这个问题，以便如果控件不存在，我只会有一个空值。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-13T09:10:39.300

您可以尝试将所有代码隐藏类放入库中并从公共基类继承。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-13T09:17:48.033

您可以查看 Visual Studio 的“皮肤文件”文件类型。另一方面，您可以从以下地址了解它是否适​​合您：http:

[//msdn.microsoft.com/en-us/library/ykzx33wh (VS.80).aspx](http://msdn.microsoft.com/en-us/library/ykzx33wh(VS.80).aspx)

# asp.net - 如何更新 asp.net 网站（只是更改了文件）

> ID：743401
> 
> 赞同：15
> 
> 时间：2009-04-13T09:03:29.067
> 
> 标签：asp.net, file

我正在开发一个需要定期更新源代码和 HTML 方面的 asp.net 网站。完成必要的更新后，我使用“发布网站工具”并将网站发布到我的本地目录。然后我将所有文件上传到远程文件。

有什么方法可以通过更改文件来修复我的网站。例如，如果我只更新了 2 个 84 文件（HTML 或源端），是否可以只更新这 2 个文件而没有任何问题？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-13T20:17:23.800

虽然 Visual Studio 确实提供了一些不同的编译/构建选项，但我认为您可能对 Visual Studio 网站项目所做的一切都很好。当我使用网站而不是 Web 应用程序时，我只会 FTP 已更改的文件。例如，如果我要更改 .aspx 页面中的一些 HTML 标记，则只需将该页面上传到 Web 服务器。如果我更改 .aspx.cs 页面中的 Page_Load 函数，那么我肯定还需要在 Web 服务器上获取更新的 DLL。

我将[FileZilla](http://filezilla-project.org/)用于我的 FTP 工具，并且可以选择仅上传更改的文件。因此，在您使用 Visual Studio 发布您的网站后，您可以获取该目录的全部内容并将其拖到 FTP 服务器位置，并且只更新已更改的内容。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-13T09:25:55.300

ASP.NET 网站项目在项目属性->“MSBuild 选项”选项卡页中提供了一个选项，您可以在其中设置“允许此预编译站点可更新”。

设置此选项

> "指定不将 .aspx 页面的内容编译成程序集；相反，标记保持原样，允许您在预编译网站后更改 HTML 和客户端功能。选中此复选框相当于添加aspnet_compiler.exe 命令的 -u 选项。”

根据文档。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2017-08-09T19:55:12.533

我对 VStudio 可用的工具完全不知所措。我改为使用 Gulp。即使在 2017 年，问题仍然存在。

使用 gulp，您可以“监视”目录中更改的文件，因此我将其配置为监视 [bin] 文件夹以及与 aspx/cshtml 文件分开的资产。

这样，每当我更改任何内容时，它都会立即复制到我的发布文件夹中，以后我可以将其压缩并仅部署变更集。该脚本甚至有延迟，因此我可以在动态生成捆绑包等情况下延迟复制/上传，并且需要一些时间才能完全修改。

我唯一需要做的就是在我开始下一个里程碑之前清理它，以便 gulp “自动部署”到的“发布”文件夹是空的并准备好下一次运行。清空文件夹并在后台运行“gulp watch”似乎是为这样一个需要的功能付出的小代价。

我觉得这应该是作为 vstudio 插件开发的好项目。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2018-11-22T22:46:59.880

最近我被迫从 linux/node/angular 迁移到 windows/C#/.NET/MVC 环境。叹。我发现以下解决方案（下一段）消除了使用 Visual Studio“发布”代码时造成的痛苦。VS2017 发布过程将整个应用程序中的每个文件复制到 Web 服务器，即使一个文件中仅更改了一个字符。对于我们中等大小的应用程序，这可能需要一个多小时。

所以这就是我要做的。我首先在本地发布解决方案（通常发布到 bin/release/Publish/）。这需要大约 1 分钟而不是 1 小时才能发布到服务器。然后，我使用 FreeFileSync 比较本地 Publish 目录和服务器目录之间的文件。FreeFileSync 很棒——而且是免费的。我可以通过 Windows 文件共享访问服务器目录。比较大约需要 15 分钟。然后我可以确切地看到哪些文件不同并且需要推送。请注意，我使用的选项比较文件的实际内容，而不仅仅是创建时间。然后我使用 FreeFileSync 同步功能（镜像选项）将所需的几个文件复制到服务器。这可能需要两分钟。因此，总操作大约需要 Visual Studio“发布”时间的 20%。但最重要的是，

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-13T09:24:37.753

这取决于项目的类型。

如果是使用**File > New Web Site**创建的项目，那么只需复制更改的 .aspx 文件即可（确保也复制了相应的代码 - .cs - 文件）。

如果项目是使用**File > New Project > ASP.NET Web Application**创建的，那么您需要从项目中的 bin 文件夹。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-04-13T12:02:58.060

我认为您需要一些东西[http://winmerge.org/](http://winmerge.org/) 它将比较已更改的文件并上传它们。

希望这可以帮助

# java - 在Java中反序列化一个序列化的php对象

> ID：743402
> 
> 赞同：15
> 
> 时间：2009-04-13T09:03:30.673
> 
> 标签：java, php, serialization

有谁知道是否有可能，实际上是否已经完成，在 php 中序列化一个对象并在 Java 中反序列化它（java-php 通信）。也许需要一个适配器。

你怎么看？

谢谢

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-04-13T16:09:44.940

有[`serialized-php-parser`](http://code.google.com/p/serialized-php-parser/)，这是一个可以解析 php 序列化对象的 Java 实现。一般来说，如果你可以选择，我不推荐 php-serialized 作为交换格式，因为它不是 ascii 安全的（它包含空字节）。改用 xml 或 json 之类的格式。如果您需要一些类型信息，[xmlrpc](http://www.xmlrpc.com/spec)是一个不错的选择。它对 php 和 Java 都有很好的实现。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-04-13T09:24:17.100

PHP 和 Java 都使用自己的（明显不同的）序列化方案。但是，您可以使用既可以读取又可以写入的交换格式。

两个最明显的例子是 XML 和 JSON。

但是还有其他的，例如 Google Protocol Buffers。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2013-01-16T07:45:00.953

另一个使用 PHP 序列化格式的 Java 项目是[Pherialize](https://github.com/kayahr/pherialize/)。

假设您正在像这样序列化一个数组：

```
array(3) {
  [0]=>
  string(8) "A string"
  [1]=>
  int(12345)
  [2]=>
  bool(true)
} 
```

然后你可以使用 Pherialize 在 Java 中反序列化它，如下所示：

```
MixedArray list = Pherialize.unserialize(data).toArray();
System.out.println("Item 1: " + list.getString(0));
System.out.println("Item 2: " + list.getInteger(1));
System.out.println("Item 3: " + list.getBoolean(2)); 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-04-13T09:16:53.980

从理论上讲，这当然是可能的。毕竟只是字节，可以解析。当然，反序列化的对象将只包含数据，而不包含任何 PHP 方法。如果需要，您必须将行为重写为与 PHP 类直接对应的 Java 类。

在实践中，主要问题似乎是 PHP 序列化格式似乎没有正式指定——至少[手册](http://php.net/manual/en/language.oop5.serialization.php)中没有规范的链接。

因此，您可能必须深入研究代码才能理解格式。

总而言之，听起来使用 XML 序列化之类的东西会更容易、更稳定——我相信这两种语言都有可以促进这一点的库。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-04-13T12:32:19.907

[JSON](http://www.json.org/)格式将是一个很好的起点。有[Java](http://www.json.org/java/)、[PHP](http://us3.php.net/json)和许多其他语言的实现。

虽然最初基于 javascript 对象文字表示法，但 JSON 被证明可以方便地在所有类型的系统之间传输轻量级数据。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2017-04-08T13:11:43.573

添加到 pom.xml

```
<dependency>
    <groupId>de.ailis.pherialize</groupId>
    <artifactId>pherialize</artifactId>
    <version>1.2.1</version>
</dependency> 
```

然后在代码中使用

```
MixedArray list = Pherialize.unserialize(data).toArray(); // data is string `enter code here` 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-04-13T09:21:49.787

您可以以某种方式为此使用 PHP 的[var_export()](http://www.php.net/var_export)函数，该函数返回要序列化的对象的可解析字符串表示。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-04-13T12:19:31.327

我记得需要此功能的 Drupal (PHP CMS) 的片段。刚刚找到它，所以看看[Serialized drupal node objects to java](http://drupal.org/node/319482)（应该适用于任何 PHP 序列化对象）。

也许你可以使用它。我不知道较新版本的 PHP 是否存在问题。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-04-13T12:39:15.227

在 PHP 中序列化对象将转储对象属性。生成的字符串并不是非常复杂。

```
echo serialize(
    array(1, null, "mystring", array("key"=>"value"))
); 
```

结果是：

```
a:4:{i:0;i:1;i:1;N;i:2;s:8:"mystring";i:3;a:1:{s:3:"key";s:5:"value";}} 
```

字符串标识数据类型、数组长度、数组索引和值、字符串长度......我认为不需要太多精力对其进行逆向工程并提出您自己的解析器。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2013-03-20T17:38:36.563

就像之前的答案提到的那样，如果可能的话，我会避免 PHP 对象序列化。使用 JSON（实际上比 PHP 中的 serialize() 更快）、thrift 或其他更通用的格式。

如果您别无选择，我一直在研究[Jackson 模块](https://github.com/Photobucket/jackson-dataformat-php)，以支持从 Java 读取和写入序列化的 PHP。Jackson 是一个很棒的 JSON 解析器，因为 PHP 序列化格式非常相似，所以它看起来很合适。它还不是很完整（写作仍在进行中）。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2016-06-16T12:08:02.170

更好的选择是将 php 序列化字符串解析为 JSONArray，这个 repo ( [https://github.com/superalsrk/PhpSerialization](https://github.com/superalsrk/PhpSerialization) ) 可以帮助你

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-04-13T11:37:51.287

尝试[使用 xstream](http://xstream.codehaus.org/)（将 Java 对象转换为可读的 XML）进行序列化，然后编写自己的 PHP 代码进行反序列化。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-04-13T12:07:38.173

使用 Web 服务（REST、RPC、SOAP）或任何其他存储纯文本的解决方案，以允许您从 Java 读取/重建数据。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-04-13T09:21:29.837

请注意，有一个[PHP 的 Java 实现](http://www.caucho.com/resin-3.0/quercus/)。因此，您*可以*序列化对象并将其传递给您的 Java-PHP 实例，反序列化然后调用您的 Java 基础架构。

这一切听起来有点糟糕，但也许值得一看！

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-04-13T14:46:25.717

您可能还对使用 PHP/Java 桥 ( [http://php-java-bridge.sourceforge.net/](http://php-java-bridge.sourceforge.net/) ) 感兴趣。它有自己的协议。在他们的网站上说它是快速实施的桥梁。

# asp.net-mvc - ajax调用后运行js函数将传入数据放入元素

> ID：743405
> 
> 赞同：1
> 
> 时间：2009-04-13T09:04:01.843
> 
> 标签：asp.net-mvc, asp.net-mvc-ajax

我的应用程序中有一个 ajax 链接：

```
<head>
<script type="text/javascript">function GoFurther() { ... }</script>
</head>
...
<%= Ajax.ActionLink("Go", "SomeAction", "SomeController", new AjaxOptions() { UpdateTargetId = "someDiv" }) %>
<div id="someDiv"></div> 
```

我想在 ajax 请求完成并且 someDiv 填充其内容后执行 GoFurther() ，以便它可以在来自服务器的某些按钮上绑定一些事件。OnCompleted 和 OnSuccess 似乎在收到 ajax 答案之后但在填充 someDiv 之前工作。所以他们不适合我。

需要明确的是，在 ajax 调用之后，一些 div 会填充一些内容：

```
<someDiv><input type="button" value="Click" class="someButton" /></someDiv> 
```

GoFurther 使用 $(".someButton").click(...); 进行一些绑定；所以它必须在 someDiv 完全填满后运行。如何确保它在 someDiv 被填充后运行？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-13T15:55:30.497

OnSuccess 应该在 DOM 元素更新后运行 [根据[Mvc Ajax Helpers 的源代码](http://aspnet.codeplex.com/SourceControl/changeset/view/22929#266390)- 请参阅 OnComplete 方法]。使用 OnSuccess 时是否发生了特定问题？

# design-patterns - 对提供许多服务的对象进行建模的正确方法是什么？

> ID：743409
> 
> 赞同：2
> 
> 时间：2009-04-13T09:06:53.863
> 
> 标签：design-patterns, oop

基本上我有一个实体（称为会话），它将提供许多不同的服务。用户可以有选择地打开或关闭每个服务（登录或注销）。我不确定代表这一点的最佳设计是什么。见[UML](http://www.flickr.com/photos/37403003@N08/3437789716/)

从编程用例的角度来看，与 Session 实例的交互：

```
Session session = new Session( "1234" ); // 1234 is the userid
session.start();

session.serviceSignIn( ServiceType.DELICIOUS );
.... do stuff ...
session.serviceSignOut( ServiceType.DELICIOUS );

session.serviceSignIn( ServiceType.MAGNOLIA );
.... do stuff ...
session.serviceSignOut( ServiceType.MAGNOLIA ); 
```

另一种可能的设计：

```
session.delicious().signIn();
.... do stuff ...
session.delicious().signOut();

session.magnolia().signIn();
.... do stuff ...  
session.magnolia().signOut(); 
```

我应该更喜欢哪个？我犯了什么错误？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-13T18:05:58.373

为什么要明确命名服务？大概这将连接到某些 GUI 或其他界面，对吗？可能足以通过诸如“美味”之类的字符串来引用它们。另外，为什么不让每个服务都成为一个可以自己签入和签出的类呢？

```
interface Service {
    String getName();
    void signin();
    void signout();
    State getState(); // state could be signed in signed out or signing in perhaps
} 

class Services {
   void addService(Service service);
   void removeService(Service service);
   Service getService(String serviceName);

   ...
} 
```

您还应该使服务接口具有对服务执行操作的操作，例如添加书签。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-13T09:11:28.923

我认为第一种方法不会以任何方式束缚您的设计。您可以动态加载服务，并在将来轻松添加新服务（因为没有代码绑定到确切的服务类型 - 就像在第二种方法中一样）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-13T09:25:06.770

我认为做出这个决定的驱动因素应该是美味和木兰提供的实际服务。他们是同一个服务吗？如果他们唯一的共同点是登录/注销行为，那么我会选择第二种方法，可能使用登录/注销功能作为某种接口/混合。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-13T09:28:39.193

对我来说，它看起来像是一个经典的 Facade 模式，你说的服务是 SOA 实现的吗？也许看看[Service Facade](http://www.soapatterns.org/service_facade.asp)。我将考虑使用您所描述的单一入口点（Facade）以及驱动工厂返回特定实现的参数。以下示例将允许您在不更改实现的情况下添加其他服务。

```
interface ISessionFacade
{
    void ServicesSignIn(string serviceType);

    void ServiesSignOut(string serviceType);
}

interface ISessionService
{
    void ServicesSignIn();

    void ServiesSignOut();
}

class ServiceFactory
{
    public static ISessionService CreateService(string serviceType)
    {
        ISessionService sessionService = null;

        // TODO: Configuration lookup of serviceType, returning a fully qualified class name to load

        // TODO: Dynamically load class, perhaps this should be a singleton?

        return sessionService;
    }
}

class Session : ISessionFacade
{
    public void ServicesSignIn(string serviceType)
    {
        ISessionService serviceSession = ServiceFactory.CreateService(serviceType);
        serviceSession.ServicesSignIn();
    }

    public void ServiesSignOut(string serviceType)
    {
        ISessionService serviceSession = ServiceFactory.CreateService(serviceType);
        serviceSession.ServiesSignOut();
    }
} 
```

# openrowset - 在 SQL 查询中运行 XMLA 语句？

> ID：743412
> 
> 赞同：0
> 
> 时间：2009-04-13T09:08:47.883
> 
> 标签：openrowset

我正在尝试在我的分析数据库上创建一个新角色。

我已经测试了多种组合：
当使用 Openrowset => 运行简单的 MDX 查询时，它可以工作。
运行时它可以工作。
尝试使用 openrowset=> ERROR 从 SQl 关系数据库创建新的 SSAS 角色时。

这是我正在尝试的代码

```
SELECT * FROM OpenRowset('MSOLAP', 'DATA SOURCE=servername; Initial Catalog=AnalysisDBName;',
'
<Create xmlns="http://schemas.microsoft.com/analysisservices/2003/engine">
            <ParentObject>
                <DatabaseID>AnalysisDBName</DatabaseID>
            </ParentObject>
            <ObjectDefinition>
                <Role xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:ddl2="http://schemas.microsoft.com/analysisservices/2003/engine/2" xmlns:ddl2_2="http://schemas.microsoft.com/analysisservices/2003/engine/2/2">
                    <ID>Role 22</ID>
                    <Name>Rolename</Name>
                </Role>
            </ObjectDefinition> 
    </Create>

') 
```

我收到的错误是：

```
OLE DB provider "MSOLAP" for linked server "(null)" returned message "A required child element is missing under Envelope/soap:Body at line , column  (namespace 'http://schemas.xmlsoap.org/soap/envelope/'). One of Fault, AuthenticateResponse, DiscoverResponse, ExecuteResponse was expected.".
Msg 7321, Level 16, State 2, Line 2
An error occurred while preparing the query "
<Create xmlns="http://schemas.microsoft.com/analysisservices/2003/engine">
    <ParentObject>
        <DatabaseID>AnalysisDBName</DatabaseID>
    </ParentObject>
    <ObjectDefinition>
        <Role xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:ddl2="http://schemas.microsoft.com/analysisservices/2003/engine/2" xmlns:ddl2_2="http://schemas.microsoft.com/analysisservices/2003/engine/2/2">
            <ID>Role 22</ID>
            <Name>Rolename</Name>
        </Role>
    </ObjectDefinition>
</Create>
" for execution against OLE DB provider "MSOLAP" for linked server "(null)". 
```

请帮助 :)
问候，伊利

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-25T23:04:18.307

您可以将 ssas olap 添加为链接服务器，然后使用以下代码：

EXEC ('XMLAsomething ....rest of your code') 在 LinkedOlap

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-13T09:47:07.323

[OPENROWSET](http://technet.microsoft.com/en-us/library/ms190312(SQL.90).aspx)需要一个有效的查询，例如“ `SELECT * FROM table`”（在指定数据源的正确 SQL 方言中）

在大多数 SQL 方言中，xml 片段不是有效的查询，尤其是在 T-SQL 中。

不幸的是，在 MDX 中没有像 T-SQL 这样的 CREATE USER 等效项，因此无法通过常规 SQL 语句或 OPENROWSET 来完成。

在[SSAS Granting User Access](http://technet.microsoft.com/en-us/library/ms175408(SQL.90).aspx)中，它提到使用 AMO 来管理使用 OPENROWSET 无法完成的用户。

对不起，这不是答案：我只能说如何不这样做......

# c++ - WxWidgets 工具链解释

> ID：743413
> 
> 赞同：0
> 
> 时间：2009-04-13T09:09:12.737
> 
> 标签：c++, wxwidgets

我在哪里可以找到一篇文章，告诉我如何在 linux/ubunto 和/或 OS X 上为 WxWidgets (C++) 设置工具链。

我在 linux 和 OS X 上下载、编译和安装了 WxWidgets，编译并尝试了示例，但似乎无法在我自己的主目录中设置编译环境。

[来自http://www.dialogblocks.com](http://www.dialogblocks.com)的 DialogBlocks看起来很有希望，但它坚持一次又一次地重新编译 WxWidgets .. 一定是我不明白的地方。

由于缺乏通往库、工具或诸如此类的路径，从头开始编写代码似乎失败了。我敢肯定，我又缺乏对我的理解。

所以，谁能给我指出一个工具链设置，它不仅包含最少的指令，还填写了一些“为什么”，而不仅仅是最少的“什么”。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-13T09:26:52.537

与所有 C/C++ 程序一样，编译器必须知道在哪些目录中查找包含文件，而链接器必须知道它应该链接到哪些库。

WxWidgets 软件包，如果安装正确，包括程序 wx-config。这可以在编译和链接时使用，如下所示：

```
g++ $(wx-config --cxxflags) -c my_prog.cpp
g++ my_prog.o $(wx-config --libs) -o my_prog 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-13T10:06:29.290

[在为Eclipse](http://wiki.wxwidgets.org/Eclipse)和[MinGW](http://wiki.wxwidgets.org/Eclipse%2C_CDT_%26_MingW_Setup_Guide)设置 wxWidgets 时，我发现这两个页面很有帮助。

# asp.net-mvc - ProcessRequest(HttpContextBase) 方法

> ID：743414
> 
> 赞同：0
> 
> 时间：2009-04-13T09:10:29.207
> 
> 标签：asp.net-mvc, routing

如何更改 ProcessRequest(HttpContextBase) 方法中的默认操作名称..

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-13T16:01:41.450

我不太确定你想要完成什么......你所指的 ProcessRequest 方法是在哪个类上定义的？为什么要更改动作名称？（为什么[ActionNameAttribute](http://codebetter.com/blogs/david.hayden/archive/2008/11/19/asp-net-mvc-actionnameattribute-and-actionmethodselector-class.aspx)不够用？）

# asp.net - VB ASP.NET 向 Flash 电影发送数据

> ID：743417
> 
> 赞同：0
> 
> 时间：2009-04-13T09:12:55.130
> 
> 标签：asp.net, flash, actionscript-3

我在 Flash 电影中有一个“标签”。我需要从服务器端发送数据，并且该数据必须显示在 Flash 电影上。

我该如何实施？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-13T09:20:31.273

您可以从服务器端将数据发送到您的 Flash 电影。尝试 .xml 文件。在 Adob​​e Flash 中使用 xml 文件很容易。您可以通过任何编程语言编辑您的 XML 文件。

# .net - 在 .Net 中处理电子邮件列表的最佳方式

> ID：743428
> 
> 赞同：0
> 
> 时间：2009-04-13T09:22:08.243
> 
> 标签：.net, email, list

在我们的项目中，我们需要发送 5-6 组邮件列表（100k-200k 封电子邮件）。

在 .Net 中执行此操作的最佳方法是什么？使用自定义类和自定义 smtp 服务器？或者使用一些第三方服务（我没有找到类似的东西）。

PS：我们有 2 台带有 win 2003 的专用服务器。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-13T09:30:11.657

[System.Net.Mail](http://msdn.microsoft.com/en-us/library/system.net.mail.aspx)命名空间呢？

它是 .net 框架的一部分，支持我能想到的所有功能。

在项目的那个阶段使用其他东西听起来像是过早的优化；如果您觉得遇到性能问题，您仍然可以稍后切换到其他内容。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-13T13:57:34.820

您将需要运行某种电子邮件假脱机应用程序。这意味着要么自己写一个，要么买一些东西（我不知道.net 的任何开源解决方案）。[更智能的邮件](http://www.smartertools.com/SmarterMail/Features/Windows-Mail-Server-Software-Webmail-Exchange-Alternative.aspx)可能会成功。免费版支持电子邮件假脱机功能。

# avi - 从avi转换为asf的代码

> ID：743429
> 
> 赞同：1
> 
> 时间：2009-04-13T09:23:25.930
> 
> 标签：avi, asf

无论使用什么库/SDK，我都想非常快速地从 avi 转换为 asf（我什至可以牺牲一些视频和音频的质量）。我在 Windows 平台（Vista 和 2008 Server）上工作，更好的 .Net SDK/代码，C++ 代码也很好。:-)

我从下面的链接中了解到，可能有一种非常快速的方法可以从 avi 转换为 asf 以更好地支持流媒体，如前所述“可以使用简单的副本将视频从 AVI 转换为 ASF 格式（即内容相同，但容器发生变化）。”。我的问题是经过几个小时的学习和试用各种 SDK/工具，作为一个新手，我不知道如何开始，所以我要求参考示例代码来完成这项任务。:-)

（因为这是一个不同的问题，我们决定开始一个新的话题。:-)）

[流式播放 AVI 文件的问题](https://stackoverflow.com/questions/743220/streaming-avi-file-issue)

提前谢谢，乔治

编辑1：

我试图从中获取 ffmpeg 的二进制文件，

[http://ffmpeg.arrozcru.org/autobuilds/ffmpeg-latest-mingw32-static.tar.bz2](http://ffmpeg.arrozcru.org/autobuilds/ffmpeg-latest-mingw32-static.tar.bz2)

然后运行以下命令，

```
C:\software\ffmpeg-latest-mingw32-static\bin>ffmpeg.exe -i test.avi -acodec copy
 -vcodec copy test.asf
FFmpeg version SVN-r18506, Copyright (c) 2000-2009 Fabrice Bellard, et al.
  configuration: --enable-memalign-hack --prefix=/mingw --cross-prefix=i686-ming
w32- --cc=ccache-i686-mingw32-gcc --target-os=mingw32 --arch=i686 --cpu=i686 --e
nable-avisynth --enable-gpl --enable-zlib --enable-bzlib --enable-libgsm --enabl
e-libfaac --enable-pthreads --enable-libvorbis --enable-libmp3lame --enable-libo
penjpeg --enable-libtheora --enable-libspeex --enable-libxvid --enable-libfaad -
-enable-libschroedinger --enable-libx264
  libavutil     50\. 3\. 0 / 50\. 3\. 0
  libavcodec    52.25\. 0 / 52.25\. 0
  libavformat   52.32\. 0 / 52.32\. 0
  libavdevice   52\. 2\. 0 / 52\. 2\. 0
  libswscale     0\. 7\. 1 /  0\. 7\. 1
  built on Apr 14 2009 04:04:47, gcc: 4.2.4
Input #0, avi, from 'test.avi':
  Duration: 00:00:44.86, start: 0.000000, bitrate: 5291 kb/s
    Stream #0.0: Video: msvideo1, rgb555le, 1280x1024, 5 tbr, 5 tbn, 5 tbc
    Stream #0.1: Audio: pcm_s16le, 22050 Hz, mono, s16, 352 kb/s
Output #0, asf, to 'test.asf':
    Stream #0.0: Video: CRAM / 0x4D415243, rgb555le, 1280x1024, q=2-31, 1k tbn,
5 tbc
    Stream #0.1: Audio: pcm_s16le, 22050 Hz, mono, s16, 352 kb/s
Stream mapping:
  Stream #0.0 -> #0.0
  Stream #0.1 -> #0.1
Press [q] to stop encoding
frame=  224 fps=222 q=-1.0 Lsize=   29426kB time=44.80 bitrate=5380.7kbits/s

video:26910kB audio:1932kB global headers:0kB muxing overhead 2.023317%

C:\software\ffmpeg-latest-mingw32-static\bin> 
```

[http://www.microsoft.com/windows/windowsmedia/player/webhelp/default.aspx?&mpver=11.0.6001.7000&id=C00D11B1&contextid=230&originalid=C00D36E6](http://www.microsoft.com/windows/windowsmedia/player/webhelp/default.aspx?&mpver=11.0.6001.7000&id=C00D11B1&contextid=230&originalid=C00D36E6)

然后使用Windows Media Player播放时出现以下错误，有没有人有什么想法？

[http://www.microsoft.com/windows/windowsmedia/player/webhelp/default.aspx?&mpver=11.0.6001.7000&id=C00D11B1&contextid=230&originalid=C00D36E6](http://www.microsoft.com/windows/windowsmedia/player/webhelp/default.aspx?&mpver=11.0.6001.7000&id=C00D11B1&contextid=230&originalid=C00D36E6)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-13T10:41:27.133

也许您可以使用 FFMPEG 并运行这样的命令（我没有尝试过）：

```
ffmpeg.exe -i test.avi -acodec copy -vcodec copy test.asf 
```

# hibernate - Hibernate：如何声明外键而不必在域对象中编写关联方法？

> ID：743434
> 
> 赞同：2
> 
> 时间：2009-04-13T09:25:52.603
> 
> 标签：hibernate

我有两个相关的表，很多和一个。MANY 表上的整数 ONE_ID 列形式化了多对一关系。

我想映射到多和一个域对象并让 Hibernate 生成 DDL，包括对 MANY.ONE_ID 的外键约束。但我想要一个简单的属性 getter 和 setter 对 ("int getOneId() / void setOneId(int)") 在 Many 域对象上，而不是 Hibernate 通常希望我提供的关联方法（"One getOne() / void集一（一）”）。这可能吗？

我将尝试解释我想要这个的原因：我实际上有数百个这样的多对一关联，我想要 FK 约束但我永远不需要导航。休眠映射文件和域对象将通过代码生成来创建。我在运行时需要做的就是能够从“许多”侧面对象中读取 FK 属性并进行设置；我从不需要实际导航多对一关联。由于代码生成问题，如果我可以为 FK 字段提供基于简单属性的访问器，它将大大简化事情。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-13T10:41:18.130

AFAIK，你有两个选择：

*   正常声明映射，关联惰性。这样你就不会为你不使用的东西付费。您还需要仔细选择协会的所有者。此外，您指定一个 Long 属性并将其映射到 FK。
*   不要依赖休眠来生成 ddl/schema。按照您最初想要的方式映射表（没有关联，只有长类型）。

# ruby-on-rails - 克隆会影响 activerecord 回调吗？

> ID：743439
> 
> 赞同：0
> 
> 时间：2009-04-13T09:28:24.843
> 
> 标签：ruby-on-rails, activerecord, associations, callback

我有一系列想要级联销毁的 ActiveRecord 对象，但其中一些对象没有被删除。

基本上我有如下： -

```
class Project < ActiveRecord::Base

  has_many :tasks, :dependent => :destroy
  has_many :schedules, :dependent => :destroy
  has_many :project_schedules, :through => :schedules, :class_name => "Project", :dependent => :destroy

end

class Schedule < ActiveRecord::Base

  belongs_to :project_schedule, :class_name => "Project"
  belongs_to :project

end

class Task < ActiveRecord::Base

  belongs_to :project

end 
```

其中 Project 是项目的定义， Task 是该项目上的任务的定义， Schedule a has_many :through 将原始项目链接到另一个项目，这是原始项目的计划。

当我创建一个日程表时，我正在对原始项目进行深度克隆（即日程表是原始项目的克隆，日程表上的每个任务都是原始日程表上的任务的克隆）。

当我执行 schedule.destroy 时，我希望计划项目及其所有相关任务都被删除。但是，仅删除了计划项目，保留了计划任务。

这不是缓存问题，因为记录仍在数据库中。此外，在数据库中肯定有单独的任务被创建，日程 ID 作为项目 ID，它们自己的唯一 ID。

回调仍然会在克隆对象上触发吗？我在这里错过了一个技巧吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-13T12:00:12.823

从您的类描述来看，我不希望在您销毁 Schedule 对象时进行级联删除。如果您删除一个项目对象，那么 Rails 应该通过子任务和计划（不确定这里的项目计划是什么）并删除记录，因为该`:dependent => :destroy`选项。任务和计划是 Project 的子项，不会导致父项被删除。

如果您想在删除计划时删除父项目，我可能会考虑编写`after_delete`回调。

# c# - 会话状态序列化

> ID：743441
> 
> 赞同：1
> 
> 时间：2009-04-13T09:29:51.343
> 
> 标签：c#, session, serialization

我的会话对象序列化有问题。我做错了什么？我尝试使用 XmlSerializer 和 BinaryFormatter 序列化该对象，没有问题。

当我尝试将购物篮对象保存到会话时，我会收到错误消息：

> 无法序列化会话状态。在“StateServer”和“SQLServer”模式下，ASP.NET 将序列化会话状态对象，因此不允许不可序列化的对象或 MarshalByRef 对象。如果自定义会话状态存储在“自定义”模式下完成类似的序列化，则适用相同的限制。

这是对象：

```
[Serializable]
public class Basket
{
    #region Fields (2)

    [NonSerialized]
    private CMS.CmsEntity db;

    private List<ShopOrderItem> ShopOrderItems;

    #endregion Fields

    #region Properties (2)

    public bool IsEmpty
    {
        get
        {
            return (this.Items.Count == 0);
        }
    }

    public List<ShopOrderItem> Items
    {
        get
        {
            if (this.ShopOrderItems == null)
            {
                this.ShopOrderItems = new List<ShopOrderItem>();
            }

            return this.ShopOrderItems;
        }
        set
        {
            this.ShopOrderItems = value;
        }
    }

    #endregion Properties

    #region Delegates and Events (1)

    // Events (1) 

    public event EventHandler CartItemsChanged;

    #endregion Delegates and Events

    #region Methods (9)

    public int CountItems()
    {
        return this.ShopOrderItems.Sum(s => s.Quantity);
    }
    public decimal CountTotalAmount()
    {
        ...
    }
    public decimal CountTotalAmountWithoutVAT()
    {
        ...
    }
    public CMS.ProductVariant GetProductVariantById(int id)
    {
        ...
    }

    #region AddProductToCart
    public void AddProductToCart(int productVariantId, int quantity)
    {
        AddProductToCart(GetProductVariantById(productVariantId), quantity);
    }
    public void AddProductToCart(ProductVariant productVariant, int quantity)
    {
        ...
    }
    #endregion

    #region RemoveProductFromCart
    public void RemoveProductFromCart(int productVariantId)
    {
        RemoveProductFromCart(GetProductVariantById(productVariantId));
    }
    public void RemoveProductFromCart(ProductVariant productVariant)
    {
        ..
    }
    #endregion

    #region UpdateProductQuantity
    public void UpdateProductQuantity(int variantId, int quantity, bool isRelative)
    {
        UpdateProductQuantity(GetProductVariantById(variantId), quantity, isRelative);
    }
    public void UpdateProductQuantity(ProductVariant productVariant, int quantity, bool isRelative)
    {
        ...
    }
    #endregion

    #endregion Methods} 
```

使用会话操作的代码：

```
public static class CurrentSession
{                  

#region public static Basket Basket
public static Basket Basket
    {
        get
        {
                        Basket c = SessionHelper.GetSessionObject("UserCart") as Basket;

                        if (c == null)
                        {
                            c = new Basket();
                            SessionHelper.SetSessionObject("UserCart", c);  // If i comment this line, exception is not thrown
                        }

                        return c;
        }
        set
        {
                        SessionHelper.SetSessionObject("UserCart", value);
        }
    }
    #endregion

} 
```

如果我使用 InProc 会话状态，它可以工作。所以它必须在序列化过程中

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-13T11:27:38.020

由于我们没有您的其余代码，因此我们无法判断该类的哪个部分存在问题。但*你*可以告诉。

注释掉该类的一半，然后重试。如果它有效，那么你注释掉的那一半就有问题。如果它不起作用，那么你没有注释掉的那一半有问题。无论哪种方式，请注释掉其中有问题的部分，然后重试...

这就像二分搜索。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-13T14:47:09.723

我发现了错误..

序列化过程可能不喜欢事件：-/

我必须只使用 InProc Session。

# debugging - 实现功能与错误修复

> ID：743442
> 
> 赞同：9
> 
> 时间：2009-04-13T09:30:06.913
> 
> 标签：debugging

我感兴趣的是，与**修复错误**相比，您在**实现新功能**上花费了多少日常工作时间。

 *** * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-13T09:36:43.637

只要我的软件中有一些未修复的错误，我就不会编写任何新功能。

我能想到让我的软件中的错误未修复的唯一原因是修复它的成本肯定很高。在这种情况下，我们可能会选择将其从“错误”更改为“已知限制”或“已知错误”，并相应地修复我们提供给用户的反馈，以便用户确切知道发生了什么以及为什么没有发生固定（见下面我的编辑）

**所以通常情况下，只要 QA 抱怨某事**，我就会把所有的时间都花在修复 bug 上，而当它不是抱怨的时候，我所有的时间都会花在编码上！:)

我这样做是因为：

*   当一个软件做了很多事情，但随机崩溃时，用户会觉得他不能依赖这个软件，而你无法解决这个问题。曾经。

*   当一个软件缺少某些功能，但擅长做它该做的事情时，用户宁愿认为“这可能是一个很棒的软件，可惜它不支持 X 和 Y……我会在 6 中检查下一个版本个月”。

* * *

[Joel Spolsky 在他的12 steps to better code](http://www.joelonsoftware.com/articles/fog0000000043.html)中就该问题写了一篇有趣的文章 。

* * *

**编辑以回答评论：** 如果我遇到随机崩溃，那绝对是一个错误，而不是“已知限制”。一旦我确切地知道发生了什么，只有到那时，我才能决定是否可以修复它。

我宁愿考虑以下情况：

*   该错误是由不属于我的代码（通常是第三方库）引起的。如果实施变通方法非常复杂，则可以等待第三方供应商修复它。现实世界的例子：Clickonce 在某些代理情况下不起作用......我希望微软最终会修复它。

*   如果错误是特定功能在所有情况下都不起作用，并且该功能对于这些特定情况难以实现，我认为可以在用户使用该功能*之前*警告用户正在尝试做的事情是没有实施，而不仅仅是崩溃。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-13T17:55:22.127

我在公司内部的一个小组工作，该小组既要创建“专题”又要响应客户问题。我倾向于将更多时间花在高优先级的客户问题上（阅读：错误）。所以我想说我的时间几乎 100% 都花在了修复 bug 上。

也就是说，让我们在字里行间读一读。似乎这个问题是在说“ugg，我花了很多时间修复错误......希望我能做更多的功能开发”。如果是这样的话，我认为你需要向内看一点。

正如我所说，我几乎将所有时间都花在修复客户问题的错误上，但我也编写了大量工具来帮助解决这个过程。我拥有从专门的日志分析器到通用的 visualstudio 解决方案文件错误检查器的一切。更不用说我为深奥的断点编写的一些甜蜜的 wndbg 脚本了！

正是通过做这样的事情，我实现了从事“新事物”的愿望。在某种程度上，它比在大型企业应用程序中实现一些新的小齿轮更有价值。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-13T09:44:49.843

由于我维护任何项目都没有得到报酬，所以大部分时间我都在从事新项目，因此一直在添加新功能。

但是，每个功能都需要彻底测试和调试，因此您可以说实现一个功能所花费的 30-40% 的时间将用于调试它。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-13T09:55:18.460

许多项目都有一个开发阶段（“代码解冻”），在此阶段主动添加新功能与错误修复同时发生，以及一个“代码冻结”阶段，其中功能集被冻结并且 100% 的工作用于将关键错误计数到0（或在固定期限之前尽可能多地修复错误），因此答案将取决于您的项目所处的阶段。

当我“做错误”时，我也会尽我最大的努力要求同时处理至少一个功能，或者（当遇到特别有错误的代码块时）请求重构整个块的授权。因此，我可以进行一些新的开发（而且，面对现实，我们大多数人更喜欢编写新的东西来修复旧的东西），同时减少错误数量。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-13T14:42:32.450

当我对我的工作进行分类时，我脑子里有很多优先事项：

1.  影响客户开展业务或访问数据的能力的错误。在解决任何此类错误之前，不会进行任何工作。
2.  其他高优先级错误或功能。这些通常是“已知问题”类型的错误或增强功能，已经变得难以处理，现在需要更改代码。此外，大客户或潜在客户要求的功能通常属于这一类。
3.  其他一切。这包括维护、不错的功能以及我们代码库上的一般性痒痒类型维护。

可以想象，#3 类别的工作并不经常进行，这从工程的角度来看有点令人沮丧。但是，我们的客户喜欢我们，因为他们在致电我们的支持热线后几乎立即让工程师处理他们的问题，并且通常在 24 小时内得到解决方案，无论其规模或重要性如何。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-13T09:39:10.743

这取决于项目，如果有一个显示阻止错误，我会专注于它，但有时当我没有足够的动力时，我只是添加一个新的很酷的功能，这样我至少可以处理它而不是什么都不做。

***这适用于个人项目或预发布/研究产品之前***

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-13T09:41:29.943

这一切都取决于我目前正在从事的项目类型。如果项目是新项目，那么我们在测试阶段之后确实有一个称为 bug 修复的阶段。大多数错误都在那里得到修复。（！）

如果项目是维护项目，那么修复错误是日常工作。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-13T09:52:34.207

这取决于错误。

这是一个小的外观问题，例如错误的标签还是破坏数据的巨大敲除错误？

即使是轻微的或装饰性的，是否会引起用户头痛，例如在错误的位置打开弹出窗口？数据损坏错误是否仅在满月的 Firefox 2 中（并且您的公司 Intranet 是 IE 6）？

好问题虽然...

# asp.net - 关闭网页时如何丢弃会话变量？

> ID：743447
> 
> 赞同：2
> 
> 时间：2009-04-13T09:32:35.817
> 
> 标签：asp.net, asp.net-2.0, session-variables

我们在开发网页时遵循的工作流程是将页面绑定到一个或多个会话变量，这些会话变量仅用于该页面，用于保存当前处理对象，因此在关闭页面时不需要它们。

关闭页面时如何丢弃这些会话变量？关于该技术或如何解决该问题的任何建议？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-13T09:51:11.403

离开/关闭页面时不会引发服务器端事件。离开页面时也不会调用 Session_End 事件（在其他答案中提到），因为用户可能会导航到同一 Web 应用程序的其他页面（因此会话将继续存在）。

我可以想到 3 种可能的方法来解决（或解决）这个问题：

**1** - 使用**ViewState**存储具有页面范围的数据。这就是 ViewState 的用途，除非您有大量数据，否则这应该不是问题。如果您有大量数据，请记住，对于每个请求，它将被序列化/反序列化并发送到客户端/返回到服务器（这可能会导致大量请求，因此性能不佳）。

**2** - 不是将数据放入会话中，而是将其放入**缓存**中（具有低滑动到期超时）。在您的页面上，您可以通过与会话相同的方式访问您的数据，即 data = Cache["data"]，但您必须准备好数据已从缓存中删除（您必须重新加载它例如再次从数据库中），如果两个请求之间的时间大于到期时间。

**3** - 使用**客户端**(javascript) **onUnload**事件，并触发一些操作（例如 ajax 回调）以从会话中删除数据。但我认为 onUnload 事件不可靠（在任何情况下它都不会被触发，例如当浏览器因崩溃或任务管理器而终止时，或者如果 javascript 被禁用）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-13T09:39:20.073

如果您只为该页面使用变量，请将它们存储在[viewstate](http://msdn.microsoft.com/en-us/library/ms972976.aspx)中。ViewState 适用于页面范围的变量。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-04-13T09:42:52.483

如果您正在使用 ASP.NET 会话（您可能是），您可以将 global.asax 文件添加到您的解决方案中。在那里可以找到这个事件委托（如果没有，创建它）：

```
protected void Session_End(object sender, EventArgs e)
{

} 
```

.. 在这里你可以清除你的会话集合。

```
 protected void Session_End(object sender, EventArgs e)
    {
        Session.Clear();
    } 
```

这将在会话到期或用户单击注销时触发:)

# jquery - 尝试使用 jQuery 为 Zend Framework 找到 AJAX 文件上传解决方案

> ID：743449
> 
> 赞同：7
> 
> 时间：2009-04-13T09:33:17.157
> 
> 标签：jquery, ajax, zend-framework, file-upload, zend-file

我正在尝试创建一个“上传文件，并将电子邮件作为附件”表单，在该表单中，文件在被选中后开始上传（如 Gmail），然后再发送电子邮件。我还想实现一个进度条来显示上传的状态。

应该有各种各样的例子，但我就是找不到！

您是否知道任何示例、教程、插件、帮助程序，或者您自己做过这些并想分享一些代码示例？

谢谢！

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-12-14T10:38:43.990

看一下

*   [上传](http://www.uploadify.com/)
*   [将 Uploadify 与 Zend 框架一起使用](http://slavi.ca/general/using-uploadify-with-zend-framework/)
*   [如何在 Zend Framework 1.9.6 中集成 uploadify](http://blog.uauzilla.ro/how-to-integrate-uploadify-in-zend-framework-1_9_6.html)

还有一个[将 fancyupload 与 Zend Framework 集成](http://zend.lojcomm.com.br/entries/tutorial-starting-with-asp-xtreme-evolution/)的示例：虽然 fancyupload 是基于 mootools 的，但您可以从所解释的内容中学习。

注意：和fancyupload 一样，uploadify 使用flash。但是，当闪光灯不可用时，它会降级。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-13T09:38:24.070

尝试使用支持 ajax 上传的 jQuery[表单插件](http://www.malsup.com/jquery/form/)，可以在提供的链接上找到示例。Zend 框架有一个[jQuery 助手](http://framework.zend.com/manual/en/zendx.jquery.html)。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-12-14T20:35:01.777

正如其他人所建议的，Jquery 有你需要的插件。

一个简单的 iframe 就可以了，进度条需要[APC](http://php.net/manual/en/book.apc.php)。

这是一个“经过大量测试”的解决方案，例如 cms [Drupal](http://drupal.org)使用它（不知道是否使用 jquery，但我确定 iframe 和 APC）。

一些教程：

[使用 APC 在 PHP 中创建上传进度条](http://www.ultramegatech.com/blog/2008/12/creating-upload-progress-bar-php/)

[使用 APC 在 PHP 中创建上传进度条：第 4 页中的 js/Ajax 部分](http://www.ultramegatech.com/blog/2008/12/creating-upload-progress-bar-php/4/)

[每个 APC + jQuery 上传 con 进度条](http://forum.html.it/forum/showthread.php?threadid=1177950)（意大利语）

[使用 PHP5、APC 和 jQuery 上传进度条](http://webreflection.blogspot.com/2007/10/upload-progress-bar-with-php5-apc-and.html)

[HOWTO：PHP和jQuery上传进度条](http://t.wits.sg/2008/06/25/howto-php-and-jquery-upload-progress-bar/)

[PHP中使用AJAX进度条的异步文件上传](http://ajaxian.com/archives/asynchronous-file-upload-with-ajax-progress-bar-in-php)

[Zend 框架：文档（第 21.1.5 章。文件上传进度）](http://framework.zend.com/manual/en/zend.file.html#zend.file.transfer.introduction.uploadprogress)

**编辑**：

我不会发布代码，因为没用；只需按照我发布的教程之一（例如第一个教程），您就会找到所需的所有代码以及对 cose 所做的完整解释（这比代码本身更重要，恕我直言）。

[旧约]

停止这场愚蠢的向下/向上选票战争。我们来这里不是为了赢得愚蠢的名声，而是为了在编程技巧上互相帮助，对吧？

我没有否决所有建议 Flash 解决方案的人，只是安德鲁的回答是不正确的，而**不是对 swf '问题'的有用**分析。

关键不是*我不喜欢 flash*，而是 flash 对于其他类型的问题（视频、音乐等）很好（不可或缺），但**不是**处理文件上传的可靠解决方案，这些事情可以通过 Javascript 轻松完成和 php 本身（使用 APC，如果您不能在服务器上使用 APC，则使用“闪存解决方案”）。

使用 swf 对象，您只需要希望处理它的 'api' 满足您的所有需求，否则.. 他们会给您源 (.fla) 文件吗？你有 adobe flash 的许可证，以及编辑它的知识吗？您是否准备好在每次您喜欢的上传需要更简单的修改时都这样做？你同意我的观点，找到 js 或 php 的帮助比寻找 flash 的帮助最容易？

这就是为什么我不喜欢**这类问题**的闪存解决方案。

然后，请随时让您对我投反对票，我在这里学习不要获得愚蠢的代表点。

[/OT]

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-12-10T16:16:29.760

我建议你用 jquery uploadify.com。该示例在网站上。您可以使用此 jquery 插件并将文件存储到数据库中（可能是临时表）。当用户发送电子邮件时，您将获取文件，将其附加并从数据库中删除。

PS：如果您有一些会话问题，请使用：[zend framework loss session](https://stackoverflow.com/questions/604555/zend-framework-losing-session)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-12-14T05:49:00.887

你看过[http://digitarald.de/project/fancyupload/](http://digitarald.de/project/fancyupload/)吗？似乎可以满足您的要求。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-12-14T19:45:47.950

[SWFUpload](http://www.swfupload.org/)看起来很有希望：

## 优点：

*   在对话框中通过 ctrl/shift-selecting 一次上传多个文件
*   所有事件的 Javascript 回调
*   在上传开始前获取文件信息
*   使用 XHTML 和 css 样式上传元素
*   使用 HTML 上传文件时显示信息
*   无需重新加载页面
*   适用于所有支持 Flash 的平台/浏览器。
*   **如果 Flash 或 javascript 不可用，则**优雅地降级为正常的 HTML 上传表单****
***   在上传开始之前控制文件大小*   仅在对话框中显示选择的文件类型*   排队上传，在开始上传之前删除/添加文件**

 **甚至还有一个[SWFUpload jQuery 插件](http://blogs.bigfish.tv/adam/2009/06/14/swfupload-jquery-plugin/)可以让使用 SWFUpload 变得更加容易，还有一个关于[如何使用 SWFUpload jQuery 插件通过进度条进行多文件上传的教程](http://webdeveloperplus.com/jquery/multiple-file-upload-with-progress-bar-using-jquery/)

## 缺点：

需要闪存。=/

另外，根据[这篇博文](http://www.ihwan.com/2511202)：

> 许多人在将 SWFUpload 与 Zend Framewok 一起使用时遇到的一个问题是，会话在上传过程中经常丢失。

但是作者提供了一个[在使用 SWFUpload 和 Zend Framework 时丢失会话的解决方案](http://www.ihwan.com/2511202)。这也是[使用 SWFUpload 和 Zend Framework 时丢失会话的 Stack Overflow 解决方案](https://stackoverflow.com/questions/604555/zend-framework-losing-session/604779#604779)。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-11-28T14:22:46.027

只是一个非常重要的注意事项 - 当使用 Flash 上传器时，文件 mime 类型不会传递给服务器，所有文件都将是 application/octet-stream - 这意味着您需要利用其他方法来找到真正的类型......也许exe文件已上传！

# refactoring - 您如何决定接下来应该合并/重构代码的哪些部分？

> ID：743451
> 
> 赞同：1
> 
> 时间：2009-04-13T09:35:43.577
> 
> 标签：refactoring, consolidation

您是否使用任何指标来决定接下来应该合并或重构代码的哪些部分（类、模块、库）？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-13T09:59:10.773

我不使用任何可以自动计算的指标。

我使用[代码气味](http://en.wikipedia.org/wiki/Code_smell)和类似的启发式方法来检测不良代码，然后我会在注意到它后立即修复它。我没有任何查找问题的清单 - 主要是一种直觉，“这段代码看起来很乱”，然后推理为什么它很乱并找出解决方案。简单的重构，例如为变量提供更具描述性的名称或提取方法只需几秒钟。更密集的重构，例如提取一个类，可能需要一两个小时（在这种情况下，我可能会留下 TODO 评论并稍后重构）。

我使用的一个重要启发式方法是[单一责任原则](http://www.objectmentor.com/resources/articles/srp.pdf)。它使课程具有很好的凝聚力。在某些情况下，我使用代码行中类的大小作为一种启发式方法，以便更仔细地查看一个类是否具有多种职责。在我[目前的项目](http://dimdwarf.sourceforge.net/)中，我注意到在编写 Java 时，大多数类的长度会少于 100 行，并且通常当大小接近 200 行时，该类会做很多不相关的事情，并且可以将其拆分，所以以获得更集中的凝聚力课程。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-13T10:03:03.557

每次我需要添加新功能时，我都会搜索执行类似操作的现有代码。一旦我找到这样的代码，我就会考虑重构它以解决原始任务和新任务。当然，我不会决定每次都重构 - 大多数情况下我会按原样重用代码。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-13T10:21:18.460

我通常只“按需”重构，即，如果我看到代码有一个具体的、直接的问题。

通常当我需要实现一个新特性或者修复一个 bug 时，我会发现当前的代码结构让这变得很困难，例如：

*   由于复制和粘贴而改变的地方太多
*   不合适的数据结构
*   需要改变的硬编码的东西
*   方法/类太大而无法理解

然后我会重构。

我有时会看到看起来有问题并且我想更改的代码，但是如果该区域当前没有被处理，我会抵制这种冲动。

我认为重构是在面向未来的代码和做不会真正产生任何直接价值的事情之间取得平衡。因此，除非我看到具体的需要，否则我通常不会重构。

我想听听那些将重构视为例行公事的人的经验。您如何阻止自己过多地打磨而浪费时间来开发重要功能？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-13T09:50:10.390

我们使用[Cyclomatic_complexity](http://en.wikipedia.org/wiki/Cyclomatic_complexity)来识别接下来需要重构的代码。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-13T09:54:23.843

当复杂度指标超过 8.0 时，我会使用[Source Monitor并定期重构方法。](http://www.campwoodsw.com/)

# java - Java 命令行参数中的空格

> ID：743454
> 
> 赞同：30
> 
> 时间：2009-04-13T09:37:11.437
> 
> 标签：java

在我的 Java 命令行参数中，空格后的任何字符都会被忽略。例如，

```
java test.AskGetCampaignByName "Dummy books" 
```

我只将第一个参数 (args[0]) 作为“虚拟”。单引号也无济于事。有解决方法/解决方法吗？可能是因为我的终端设置？

我的 $TERM 是 xterm，$LANG 是“en_IN”。

* * *

## 回答 #1

> 赞同：59
> 
> 时间：2009-04-13T10:42:39.203

参数由 shell 处理（我假设您在 Linux 下使用 Bash？），因此任何终端设置都不应影响这一点。

既然你已经引用了这个论点，它应该可以工作。我能想到的唯一可能的解释是，如果您的`java`命令是一个包装脚本，并且在传递给实际程序时会混淆参数的转义。这很容易做到，或者可能有点难以正确做到。

一个正确的包装脚本应该将它的所有参数传递给 as `${1+"$@"}`，而任何其他版本很可能是一个关于能够正确处理嵌入空间的错误。正确执行此操作并不少见，但是任何出现`$2`或类似的情况也很麻烦，并且必须写为`"$2"`（或可能`${2+"$2"}`）才能正确处理嵌入空间，这对很多人都是有罪的。

语法不那么直观的原因`${1+"$@"}`是原始`$*`加入了所有参数，因为`"$1 $2 $3 ..."`这些参数不适用于嵌入式空间。然后`"$@"`介绍了（正确地）扩展`"$1" "$2" "$3" ...`为所有参数，如果没有给出参数，它应该扩展为空。不幸的是，一些 Unix 供应商搞砸了，甚至在没有参数的情况下也进行了`"$@"`扩展`""`，为了解决这个问题，`${1+"$@"}`发明了聪明（但不那么可读）的写作技巧，`"$@"`仅在设置参数时才进行扩展`$1`（即避免在没有论据）。

如果我的包装假设错误，您可以尝试使用[strace](https://en.wikipedia.org/wiki/Strace)进行调试：

```
strace -o outfile -f -ff -F java test.AskGetCampaignByName "Dummy books" 
```

并找出传递给`execve`. 运行“”的示例`strace /bin/echo '1 2' 3`：

```
execve("/bin/echo", ["/bin/echo", "1 2", "3"], [/* 93 vars */]) = 0
brk(0)                                  = 0x2400000
mmap(NULL, 4096, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x7f420075b000
mmap(NULL, 4096, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x7f420075a000
access("/etc/ld.so.preload", R_OK)      = -1 ENOENT (No such file or directory)
open("/usr/lib64/alliance/lib/tls/x86_64/libc.so.6", O_RDONLY) = -1 ENOENT (No such file or directory)
stat("/usr/lib64/alliance/lib/tls/x86_64", 0x7fff08757cd0) = -1 ENOENT (No such file or directory)
open("/usr/lib64/alliance/lib/tls/libc.so.6", O_RDONLY) = -1 ENOENT (No such file or directory)
... 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-13T09:53:32.583

如果您的程序需要的不仅仅是位置参数（= 当命令行使用很重要时），您应该考虑选项和开关。Apache Commons 有一个很棒的[库](http://commons.apache.org/cli/)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-13T10:34:20.037

听起来您正在使用操作系统发行版，其中`java`用户可用的命令是一个包装器，它在“某处”找到正确的 JVM 并相应地调用它。

`java`如果是这样，它很可能在调用实际可执行文件时无法正确转义参数。

你使用什么发行版？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-03-04T22:41:52.527

你只需要像这样逃避空格：

```
normal String: "Hello World!"
escaped String: "Hello" "World!" 
```

这对我有用。

我的环境：

```
23:39:19 Zarathustra@thora:/Users/Zarathustra~$bash -version
GNU bash, version 3.2.48(1)-release (x86_64-apple-darwin11)
Copyright (C) 2007 Free Software Foundation, Inc. 
```

* * *

## 回答 #5

> 赞同：-3
> 
> 时间：2011-01-25T06:15:16.490

只需在 Java 程序中重新组合参数：

```
StringBuilder allArgs = new StringBuilder();
for (int i=0; i < args.length; i++)
{
    //System.out.println("arg"+i+": "+args[i]);
    allArgs.append(args[i]+" ");
}
// Parse out the args the way you wish using allArgs 
```

# mysql - 使用mysql group by显示计数为0的行

> ID：743456
> 
> 赞同：15
> 
> 时间：2009-04-13T09:37:57.283
> 
> 标签：mysql, group-by

我在 MySql 公司有两个表：（cname，city）作品：（ename，cname，salary）

我想显示为每家公司工作的员工人数，即使该数字为零。

例如对于

```
Company : 
Microsoft Bangalore
IBM       NY

works : 
emp1 Microsoft 10000
emp2 Microsoft 90000 
```

输出应该是：

```
Microsoft 2
IBM 0 
```

但以下查询和其他类似查询仅打印那些至少有一名员工的公司：

```
Select count(*) from works natural join company group by company.cname 
```

如果我使用外部联接，那么员工为零的公司仍将显示在一行中，因此该选项也无效。

怎么做？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-04-13T09:44:27.487

LEFT JOIN 的经典案例：

```
SELECT
  c.cname,
  COUNT(w.ename) wcount 
FROM
  company c
  LEFT JOIN works w ON c.cname = w.cname
GROUP BY
  c.cname 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-13T09:42:47.773

尝试

```
Select company.cname, count(work.id) from company left join work on ....=.... group by company.cname 
```

在哪里填写“....”部分，然后将 work.id 更改为您的姓名

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2017-12-14T03:28:26.330

使用子查询还有另一种方法，这是我案例中的一个示例：

```
select count(`order_id`) as cnt
from (
    select `order_id` from `room_bookings`
    where `room_id` = 3 and `day_id` = 20180201 
    group by `order_id`
) as b; 
```

# c# - const 正确性如何帮助编写更好的程序？

> ID：743458
> 
> 赞同：2
> 
> 时间：2009-04-13T09:38:37.440
> 
> 标签：c#, c++, const-correctness

这个问题来自一个 C# 的人问 C++ 的人。（我对 C 有一定的了解，但只对 C++ 有一些常识）。

很多使用 C# 的 C++ 开发人员说他们错过了 const 的正确性，这对我来说似乎很奇怪。在 .Net 中，为了禁止更改事物，您需要创建不可变对象或具有只读属性/字段的对象，或传递对象的副本（默认情况下复制结构）。

是 C++ const 正确性，一种创建不可变/只读对象的机制，还是还有更多？如果目的是创建不可变/只读对象，则可以在 .Net 等环境中完成相同的操作。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-04-13T09:47:27.153

FAQ 中有一整节专门讨论[Const 正确性](http://www.parashift.com/c++-faq-lite/const-correctness.html)。享受！

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-04-13T09:42:11.143

C++ 中的 const 正确性本质上只是一种准确表达您的意思的方式：

```
void foo( const sometype & t ) {
   ...
} 
```

说“我不会更改 t 引用的对象，如果我尝试更改，请编译器先生警告我”。

它不是一种安全特性，也不是一种（可靠地）创建只读对象的方式，因为使用 C 风格的转换来颠覆是微不足道的。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-04-13T09:49:56.147

我敢打赌，这是一个心态问题。我正在与长期使用 C++ 的人一起工作，并注意到他们似乎在用 C++ 思考（他们当然会这样做！）。他们需要时间才能开始看到他们已经熟悉的答案的多个答案，以获得像 const 正确性这样的“标准”答案。给他们时间，试着温和地教育他们。

话虽如此，我确实喜欢 C++ 'const' 的保证方式。它主要是向接口的用户保证对象、指针后面的数据或其他任何东西都不会被弄乱。我会将此视为 const 正确性的 #1 值。#2 值是它可以允许编译器在优化方面的值。

当然，问题是，如果整个 sw 堆栈没有从头开始构建时考虑到 const。

我确信 C# 有自己的一套范例来做同样的事情。这说明了为什么“每年学习一种新的（计算或自然）语言”如此重要。只是为了锻炼一个人的其他方式来看待世界，解决它的问题。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-04-13T09:42:21.470

使用 const-correctness，您可以将可变对象公开为只读，**而无需复制它**并浪费宝贵的内存（尤其是与集合相关）。我知道，桌面开发人员有这种*CPU 和内存便宜的*理念，但它在嵌入式世界中仍然很重要。

最重要的是，如果在 C++ 中添加内存所有权的复杂性，最好不要复制包含或引用其他对象的非平凡对象，因此有一种方法可以将现有对象公开为只读。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-04-13T10:16:49.407

优秀的 Scott Meyer 的《 [Effective C++](https://rads.stackoverflow.com/amzn/click/com/0321334876) 》一书专门针对这个问题发表了一篇文章：

第 3 项：尽可能使用 const。

它真的启发了你:-)

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-04-13T11:16:53.037

真正的答案，即使你没有使用它真的很难掌握，是你失去了表现力。该语言具有您无法在 C# 中表达的概念，它们具有意义，它们是设计的一部分，但在转换为代码时丢失了。

这不是一个答案，而是一个例子：

假设您有一个容器，该容器按存储的元素的字段进行排序。那些物体真的很大。您需要为读者提供对数据的访问权限（考虑在 UI 中显示信息）。

现在，在 C#/Java 中，您可以采用以下两种方式之一：要么制作副本供调用者使用（保证数据不会更改，但效率低下），要么返回对内部持有对象的引用（只需希望调用者不会通过设置器更改您的数据）。

如果用户获取引用并通过它更改用作索引的字段，那么您的容器不变量将被破坏。

在 C++ 中，您可以返回一个常量引用/指针，编译器将禁用在您返回的实例上调用 setter 方法（变异方法）。您可以获得用户不会更改的安全性 (*) 和通话效率。

之前没有提到的第三个选项是使对象不可变，但这会在任何地方禁用更改。将不允许对对象进行完全受控的更改，唯一可能的更改是创建一个执行更改的新元素。这相当于时间和空间。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-04-13T10:13:56.107

C++ 提供了很多方法可以让你搞乱你的代码。我认为 const 正确性是对代码施加约束的第一种有效方式，以控制“副作用”（不需要的更改）。

将参数标记为 const（通常引用 const 对象或指向 const 对象的指针）将确保传递的对象无法更改，因此您没有该函数/方法的“副作用”。

将方法标记为 const 将保证该方法不会改变它所使用的对象的状态。如果是这样，编译器将生成错误。

标记一个 const 数据成员将确保该数据成员只能在构造函数的初始化列表中进行初始化，而不能更改。

此外，智能编译器可以使用常量作为各种性能优化的提示。

当然，您可以覆盖 constness。常量是编译时检查。默认情况下您不能违反规则，但您可以使用强制转换（例如 const_cast）使 const 对象成为非 const 对象，以便对其进行更改。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-04-13T09:50:47.910

仅仅在编写代码时寻求编译器的帮助就足以让我提倡 const 正确性。但是今天还有一个额外的优势：当您知道我们的对象在哪里可以更改以及在哪里不能更改时，多线程代码通常更容易编写。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-04-15T09:37:45.490

我认为遗憾的是 C# 不像 C++ 那样支持 const 正确性。我传递给函数的所有参数中有 95% 是常量值，const 特性保证您通过引用传递的数据在调用后不会被修改。“const”关键字提供了经过编译器检查的文档，这对大型程序有很大帮助。

# asp.net - RadAjaxPanel 中 FormView 中的 RadUpload

> ID：743465
> 
> 赞同：0
> 
> 时间：2009-04-13T09:41:10.617
> 
> 标签：asp.net, telerik, formview, radupload

我`RadUpload`在编辑模板中有一个`FormView`. 我想要的行为是

*   `Formview`应该在`ReadOnly`模式下打开
*   单击更新按钮时，应进行回发

因此，所需的过渡方案`ReadOnly->Edit`应该`Ajaxified Edit->Readonly`是回发。

我尝试过使用[这篇](http://www.telerik.com/community/forums/aspnet-ajax/upload/radupload-inside-ajaxified-formview.aspx)文章，但我无法访问脚本中的更新按钮（因为表单视图以只读模式打开）。

知道如何获得我想要的功能

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-14T19:04:30.393

您可以查看[此](http://www.telerik.com/help/aspnet-ajax/upload_uploadingajax.html)在线帮助文​​章，该文章显示了当 RadUpload 位于 RadAjaxPanel 中时如何上传文件。

# javascript - 更改坐标后如何重置 Google 地图上的“重新居中”按钮？

> ID：743493
> 
> 赞同：0
> 
> 时间：2009-04-13T09:54:58.290
> 
> 标签：javascript, google-maps

我有一个从特定位置开始的 Google 地图，然后您可以单击一个按钮来更改位置。然后如何重置“重新居中”按钮，以便单击它可以转到第二个位置？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-13T10:59:00.037

我找到了答案： GMap.savePosition() 重置位置。

# oracle - 来自过程的Oracle合并分区给出错误

> ID：743495
> 
> 赞同：0
> 
> 时间：2009-04-13T09:55:34.090
> 
> 标签：oracle

```
 CREATE OR REPLACE PROCEDURE test
  AS
  sql_stmt  VARCHAR2(200);
  BEGIN
     sql_stmt := 'ALTER TABLE daily_table PARTITIONS p1 , p2 into PARTITION p2';
     EXECUTE IMMEDIATE sql_stmt;

  END ;
  / 
```

上述程序给了我以下错误-

```
ORA-01031: insufficient privileges
ORA-06512: at "test", line 8
ORA-06512: at line 6 
```

但是如果我直接在 sql 提示符下运行 ALTER 命令，我不会收到任何错误。我想知道我需要为用户提供什么权限才能从过程中执行合并。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-13T10:22:27.223

我通过使用 AUTHID CURRENT_USER 解决了这个问题

```
CREATE OR REPLACE PROCEDURE test AUTHID CURRENT_USER
  AS
  sql_stmt  VARCHAR2(200);
  BEGIN
     sql_stmt := 'ALTER TABLE daily_table PARTITIONS p1 , p2 into PARTITION p2';
     EXECUTE IMMEDIATE sql_stmt;

  END ;
  / 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-20T17:48:45.653

我敢肯定，如果有人专门为 DDL 创建了一个存储过程，那么他们就会意识到它是自动提交的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-13T10:02:39.097

**注意：你不应该`DDL`在存储过程中使用。下面是应该避免的设计非常非常糟糕的代码示例。**

```
CREATE OR REPLACE PROCEDURE test
AS
sql_stmt  VARCHAR2(200);
BEGIN
     sql_stmt := 'GRANT ALTER ON daily_table TO your_user';
     EXECUTE IMMEDIATE sql_stmt;
     sql_stmt := 'ALTER TABLE daily_table PARTITIONS p1 , p2 into PARTITION p2';
     EXECUTE IMMEDIATE sql_stmt;
END ;
/ 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-20T18:09:00.493

我确实在存储过程中使用 DDL：最常见的是截断过程将重新填充的汇总表；不时用于 DDLish 任务，例如重命名导入表的列以符合 Oracle 的标识符标准规则，或为命名表创建主键和序列。一般我用

```
dbms_utility.exec_ddl_statement(blah); 
```

而不是

```
EXECUTE IMMEDIATE blah; 
```

我不会试图证明的偏见。我会说，由 Oracle 提供和记录的打包程序表明它不是全面禁止的。

# javascript - window.history.go 不工作

> ID：743496
> 
> 赞同：1
> 
> 时间：2009-04-13T09:55:43.060
> 
> 标签：javascript, cross-browser

我有一个点击按钮，我想使用 javascript 后退一步。为此，我正在使用 window.history.go，尽管这在 IE7 和 firefox 中运行良好，但在 IE6 中不起作用，并且由于用户停留在同一页面上，因此没有任何变化。

我将事件附加到 LinkBut​​ton

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-13T10:19:03.690

IE6 与 window.history.go() 有问题。它适用于这样的常规链接：

```
 <a href='#' onclick='history.go(-1);'>Back!</a> 
```

但其他一些将无法正常工作。你可以试试这个：

```
 <button onclick='history.go(-1);'>Back!</button> 
```

但我不太确定这是否可行。您还可以显示所有其他浏览器的按钮和 IE 的链接：

```
 <button id='backButton' onclick='history.go(-1);'>Back!</button>
 <!--[if IE 6]>
 <script type='text/javascript'> document.getElementById('backButton').style.display = 'none'; </script>
 <a href='#' onclick='history.go(-1);'>Back!</a>
 <![endif]--> 
```

将行为添加到单独的 javascript 文件中而不是在 HTML 中内联会更好。但我想你明白了。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-13T10:00:06.607

使用 history.back()

# c# - 为什么是哈希集 .IsReadOnly 是显式的吗？

> ID：743498
> 
> 赞同：12
> 
> 时间：2009-04-13T09:59:31.117
> 
> 标签：c#, interface, hashset, icollection, explicit-interface

这

```
var h = new HashSet<int>();
var r = h.IsReadOnly; 
```

不编译。我要做

```
var r = ((ICollection<int>)h).IsReadOnly; 
```

为什么 IsReadOnly 没有正常实施？

（我不是问**如何**，而是**为什么**）

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-04-13T10:17:53.337

我猜是因为，虽然 HashSet 实现了 ICollection，但 IsReadOnly 对 HashSet 没有任何意义。事实上，如果你反映它，该属性总是返回false。显式实现它会在公共接口中隐藏此方法。

另一个原因是，ICollection 接口的实现可能是由于偶然的原因（例如，为了支持 xaml 序列化），而不是因为它对于类的主要使用是必需的。因此，显式地实现它可以避免类接口的混乱。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-13T10:38:10.087

使用显式接口实现的原因基本上有两个（来源：[MSDN](http://msdn.microsoft.com/en-us/library/aa664591(loband).aspx)）：

1.  您使用包含相同签名的成员实现多个接口，并且希望这些成员具有不同的行为。
2.  接口成员对类不是特别感兴趣，但它是接口引用对象所必需的。

对于`HashSet<T>`，后一种情况适用，因为哈希集永远不会是只读的，`IsReadOnly`因此将始终返回`false`。

# php - 如何在 PHP 中通过 IP 地址获取时区

> ID：743505
> 
> 赞同：37
> 
> 时间：2009-04-13T10:06:09.900
> 
> 标签：php, time, timezone, ip

我想通过 PHP 中的 IP 地址获取时区。实际上，我有一个将在客户端机器上运行的应用程序。我有客户端机器的 IP 地址。但我无法获得每台客户端机器的时区。

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2017-03-30T14:05:01.663

```
$ip = "189.240.194.147";  //$_SERVER['REMOTE_ADDR']
$ipInfo = file_get_contents('http://ip-api.com/json/' . $ip);
$ipInfo = json_decode($ipInfo);
$timezone = $ipInfo->timezone;
date_default_timezone_set($timezone);
echo date_default_timezone_get();
echo date('Y/m/d H:i:s'); 
```

有时它在本地服务器上不起作用，所以在服务器上尝试。

编辑：此数据来自**ip-api.com**，只要您**每分钟不超过 45 个请求**并且**不使用商业**用途，它们就可以免费使用。看他们的[TOS](https://ip-api.com/docs/legal)，不是很长的一页。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-04-13T10:52:11.023

甚至不能依靠 IP 地址映射到一个国家；如果您还想获得时区，那您就如履薄冰。您最好让客户端*向*您发送时区，也许在标题中。

请参阅[Tor：在线匿名](http://www.torproject.org/)，这是停止将 IP 地址用于非设计用途的另一个原因。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2009-04-13T10:10:52.057

如果你在本地机器上运行它，你可以检查配置的时区。
[http://www.php.net/manual/en/function.date-default-timezone-get.php](http://www.php.net/manual/en/function.date-default-timezone-get.php)

有很多更好、更可靠的方法，然后尝试使用 GeoIP 猜测时区。如果您感觉幸运，请尝试：[http ://www.php.net/manual/en/book.geoip.php](http://www.php.net/manual/en/book.geoip.php)

```
$region = geoip_region_by_name('www.example.com');
$tz = geoip_time_zone_by_country_and_region($region['country_code'],
                                            $region['region']); 
```

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2009-04-13T10:30:09.360

没有绝对确定的方法来获取客户的时区，但是如果您让客户从他们的机器上提交日期和时间，您可以根据它相对于 GMT 的时间来计算它。因此，如果他们的机器上是晚上 7:00 并且是格林威治标准时间上午 12:00，那么您可以确定他们是格林威治标准时间或 (EST/DST) 的 -5

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2015-09-02T13:41:28.707

通过他或她的 IP 地址搜索用户的时区不是一个好主意，因为他可以在不同的时间从不同的地方访问他或她的帐户。所以不可能通过ip地址定位到他的时区。但我试图找到一个解决方案，我在这里给出我的代码。对编码技术的任何批评都将受到高度赞赏。

```
<?php

$time_zone = getTimeZoneFromIpAddress();
echo 'Your Time Zone is '.$time_zone;

function getTimeZoneFromIpAddress(){
    $clientsIpAddress = get_client_ip();

    $clientInformation = unserialize(file_get_contents('http://www.geoplugin.net/php.gp?ip='.$clientsIpAddress));

    $clientsLatitude = $clientInformation['geoplugin_latitude'];
    $clientsLongitude = $clientInformation['geoplugin_longitude'];
    $clientsCountryCode = $clientInformation['geoplugin_countryCode'];

    $timeZone = get_nearest_timezone($clientsLatitude, $clientsLongitude, $clientsCountryCode) ;

    return $timeZone;

}

function get_client_ip() {
    $ipaddress = '';
    if (getenv('HTTP_CLIENT_IP'))
        $ipaddress = getenv('HTTP_CLIENT_IP');
    else if(getenv('HTTP_X_FORWARDED_FOR'))
        $ipaddress = getenv('HTTP_X_FORWARDED_FOR');
    else if(getenv('HTTP_X_FORWARDED'))
        $ipaddress = getenv('HTTP_X_FORWARDED');
    else if(getenv('HTTP_FORWARDED_FOR'))
        $ipaddress = getenv('HTTP_FORWARDED_FOR');
    else if(getenv('HTTP_FORWARDED'))
        $ipaddress = getenv('HTTP_FORWARDED');
    else if(getenv('REMOTE_ADDR'))
        $ipaddress = getenv('REMOTE_ADDR');
    else
        $ipaddress = 'UNKNOWN';
    return $ipaddress;
}

function get_nearest_timezone($cur_lat, $cur_long, $country_code = '') {
    $timezone_ids = ($country_code) ? DateTimeZone::listIdentifiers(DateTimeZone::PER_COUNTRY, $country_code)
        : DateTimeZone::listIdentifiers();

    if($timezone_ids && is_array($timezone_ids) && isset($timezone_ids[0])) {

        $time_zone = '';
        $tz_distance = 0;

        //only one identifier?
        if (count($timezone_ids) == 1) {
            $time_zone = $timezone_ids[0];
        } else {

            foreach($timezone_ids as $timezone_id) {
                $timezone = new DateTimeZone($timezone_id);
                $location = $timezone->getLocation();
                $tz_lat   = $location['latitude'];
                $tz_long  = $location['longitude'];

                $theta    = $cur_long - $tz_long;
                $distance = (sin(deg2rad($cur_lat)) * sin(deg2rad($tz_lat)))
                    + (cos(deg2rad($cur_lat)) * cos(deg2rad($tz_lat)) * cos(deg2rad($theta)));
                $distance = acos($distance);
                $distance = abs(rad2deg($distance));
                // echo '<br />'.$timezone_id.' '.$distance;

                if (!$time_zone || $tz_distance > $distance) {
                    $time_zone   = $timezone_id;
                    $tz_distance = $distance;
                }

            }
        }
        return  $time_zone;
    }
    return 'unknown';
} 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2013-09-19T01:09:18.620

这不是直截了当的，但我得到了时间，包括使用 jquery 和 php 的 2 个 api 调用的夏令时偏移量。所有这些都可以很容易地在 PHP 中完成，只需稍加调整即可。我确信这也可以以不同的方式布局，但我只是从现有的代码中获取它，这适合我当时的需要。

jQuery/php：

```
function get_user_time(){
    var server_time = <? echo time(); ?>; //accuracy is not important it's just to let google know the time of year for daylight savings time
    $.ajax({
        url: "locate.php",
        dataType: "json",
        success: function(user_location) {
            if(user_location.statusCode=="OK"){
                $.ajax({
                    url: "https://maps.googleapis.com/maps/api/timezone/json?location="+user_location.latitude+","+user_location.longitude+"&timestamp="+server_time+"&sensor=false",
                    dataType: "json",
                    success: function(user_time) {
                        if(user_time.statusCode=="error"){
                            //handle error
                        }else{
                            user_time.rawOffset /= 3600;
                            user_time.dstOffset /= 3600;
                            user_real_offset = user_time.rawOffset+user_time.dstOffset+user_time.utc;
                            //do something with user_real_offset
                        }
                    }
                });
            }
        }
    });
} 
```

定位.php

```
function get_client_ip() {
    $ipaddress = '';
    if ($_SERVER['HTTP_CLIENT_IP'])
        $ipaddress = $_SERVER['HTTP_CLIENT_IP'];
    else if($_SERVER['HTTP_X_FORWARDED_FOR'])
        $ipaddress = $_SERVER['HTTP_X_FORWARDED_FOR'];
    else if($_SERVER['HTTP_X_FORWARDED'])
        $ipaddress = $_SERVER['HTTP_X_FORWARDED'];
    else if($_SERVER['HTTP_FORWARDED_FOR'])
        $ipaddress = $_SERVER['HTTP_FORWARDED_FOR'];
    else if($_SERVER['HTTP_FORWARDED'])
        $ipaddress = $_SERVER['HTTP_FORWARDED'];
    else if($_SERVER['REMOTE_ADDR'])
        $ipaddress = $_SERVER['REMOTE_ADDR'];
    else
        $ipaddress = 'UNKNOWN';

    return $ipaddress;
}
$location = file_get_contents('http://api.ipinfodb.com/v3/ip-city/?key=xxxxxxxxx&ip='.get_client_ip().'&format=json');
$location = json_decode($location,true);
if(is_array($location)){
    date_default_timezone_set('UTC');
    $location['utc'] = time();
    echo json_encode($location);
}else{
    echo '{"statusCode":"error"}';
} 
```

在此处注册免费密钥：http: [//ipinfodb.com/register.php](http://ipinfodb.com/register.php)（没有限制，但如果每秒请求超过 1 个，则排队）

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2014-03-10T21:53:36.463

查看 Maxmind GeoLite2 数据库。它包含有关大多数 IP 地址的大陆/国家/城市和纬度/经度的详细信息，包括**time_zone**，如下所示。

我在这里描述了如何编译 PHP 扩展，以及如何在 PHP 中使用 mmdb 数据库：

[使用 Kohana PHP 介绍 Maxmind GeoLite2](http://blog.jamieisaacs.com/2014/03/10/intro-to-maxmind-geolite2-with-kohana/)

![在此处输入图像描述](https://i.stack.imgur.com/fFHzq.png)

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-04-13T10:54:42.327

如果您需要知道浏览您网页的用户的时区，那么您可以使用[IP2LOCATION](http://www.ip2location.com/)之类的服务来猜测时区。但请记住，正如 altCognito 所说，这不是告诉客户时区的 100% 准确的方法。这种方法存在一些准确性问题。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2017-03-20T13:54:56.057

这是一个使用将 IP 地址映射到时区的[位置 API](https://ipapi.co)的示例，例如发送请求并`https://ipapi.co/<IP-Address>/timezone/` 返回该 IP 地址的时区。

PHP 代码

```
file_get_contents('https://ipapi.co/1.2.3.4/timezone/'); 
```

准确率并非像其他人所说的那样是 100%。

# eclipse-plugin - Eclipse RCP：透视切换器窗口对话框排序问题

> ID：743508
> 
> 赞同：0
> 
> 时间：2009-04-13T10:07:41.550
> 
> 标签：eclipse-plugin, eclipse-rcp

在我的应用程序中，当我选择 File->Open Perspective->Other 时，它会打开一个列出所有透视图的对话框。我的问题是我希望这些透视图以定义的顺序出现（它们不在此默认透视图切换器中）。

这与单击透视栏上显示在最左侧的图标时弹出的对话框相同。

有一些像[这样](http://eclipsesource.com/blogs/2009/03/31/replacing-the-perspective-switcher-in-rcp-apps/)的实现讨论如何禁用透视栏并制作我们自己的自定义透视切换器。一般的方法是首先通过改变 ApplicationWorkbenchWindowAdvisor.java 来禁用透视栏，如下所示。

```
public void preWindowOpen() {   
IWorkbenchWindowConfigurer configurer = getWindowConfigurer();   
configurer.setShowPerspectiveBar(false);   
} 
```

但问题是这也隐藏了整个透视切换器（包括我需要的透视按钮，我已按特定顺序排列）。

那么，有没有办法让透视栏上仍然显示透视按钮并改变默认对话框中显示的透视顺序（在文件->打开透视->其他上打开）？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-16T21:23:03.020

AFAIK, perspectives and views are always ordered according to their names, grouped by their categories. Maybe you can file an enhancement request for this at Eclipse Bugzilla.

# language-agnostic - 远程方法的异常

> ID：743510
> 
> 赞同：2
> 
> 时间：2009-04-13T10:09:42.730
> 
> 标签：language-agnostic, exception-handling, rmi

远程方法异常的最佳实践是什么？

我确定您需要在远程方法实现级别处理所有异常，因为您需要在服务器端记录它。但是之后你应该怎么做？

您是否应该将异常包装在 RemoteException (java) 中并将其抛出给客户端？这意味着客户端必须导入所有可能抛出的异常。抛出一个细节更少的新自定义异常会更好吗？因为客户不需要知道问题的所有细节。你应该在客户端登录什么？我什至听说过使用返回码（也许是为了提高效率？）来告诉调用者发生了什么。

要记住的重要一点是，**必须**告知客户出了什么问题。“某事失败”或根本没有通知的通用答案是不可接受的。那么运行时（未经检查的）异常呢？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-15T22:27:38.790

您似乎希望能够区分故障是由于系统故障（例如服务或机器停机）还是业务逻辑故障（例如用户不存在）造成的。

我建议使用您自己的自定义异常来包装 RMI 调用中的所有系统异常。您仍然可以通过将其作为原因传递给您的自定义异常来维护异常中的信息（这在 Java 中是可能的，不确定其他语言）。这样客户只需要知道如何处理导致系统故障的一个异常。是否检查此自定义异常或运行时有待讨论（可能取决于您的项目标准）。我肯定会记录这种类型的失败。

业务类型失败可以表示为单独的异常或某种类型的默认（或空）响应对象。我会尝试从这种类型的故障中恢复（即采取一些替代措施）并仅在恢复失败时记录。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-13T10:19:03.877

在过去的项目中，我们会在最顶层捕获所有服务层（层）异常，通过 DTO/VO 将应用程序特定的错误代码/信息传递给 UI。这是一种简单的方法，因为每个服务的所有错误处理都发生在同一个地方，而不是分散在服务和 UI 层中。

然后 UI 所要做的就是检查 DTO/VO 的标志（hasError？）并显示错误消息，它不必知道也不关心实际的异常是什么。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-20T11:48:55.240

我总是会在我的应用程序中记录异常（在您问题中定义的服务器端）。

然后我会抛出一个异常，被客户端捕获。如果调用者可以采取纠正措施来防止异常，那么我将确保异常包含此信息（例如`DateTime argName must not be in the past`）。如果错误是由第三方系统的某些中断引起的，那么我可能会将此信息通过调用堆栈传递给调用者。

然而，如果异常本质上是由我的系统中的错误引起的，那么我将构建我的异常处理，以便使用非信息性异常消息（例如`General failure`）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-27T15:46:30.980

这就是我所做的。每个远程方法实现都会捕获服务器端的所有异常并记录它们。然后将它们包装在自定义异常中，其中将包含问题的描述。这个描述必须对**客户端**有用，所以它不会包含捕获的异常的所有细节，因为客户端不需要它们。他们已经在服务器端登录。现在，在客户端，可以按照用户的意愿处理这些异常。

Why I chose using Exceptions and not return codes is because of one very important drawback of return codes: you can't throw them to higher levels without some effort. This means you have to check for an error right after the call and handle it there. But this may not be what I want.

# wcf - 使用 Linq2Sql DataContext.SubmitChanges() 时事务超时已过期

> ID：743520
> 
> 赞同：1
> 
> 时间：2009-04-13T10:14:46.993
> 
> 标签：wcf, linq-to-sql, transactions

请帮我解决这个问题：

有一个环境 MSMQ 事务。我正在尝试使用新事务进行日志记录，但在尝试提交更改时出现下一个错误 - “超时已过期。在操作完成之前超时时间已过或服务器没有响应。” 这是代码：

```
public static void SaveTransaction(InfoToLog info)
    {
        using (TransactionScope scope =
            new TransactionScope(TransactionScopeOption.RequiresNew))
        {
            using (TransactionLogDataContext transactionDC =
                        new TransactionLogDataContext())
            {
                transactionDC.MyInfo.InsertOnSubmit(info);

                transactionDC.SubmitChanges();
            }

            scope.Complete();
        }
    } 
```

请帮我。谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-13T11:57:39.913

您可以考虑增加超时或将其全部消除。

就像是：

```
using(TransactionLogDataContext transactionDC = new TransactionLogDataContext())
{
    transactionDC.CommandTimeout = 0;  // No timeout.
} 
```

当心

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-06-08T18:11:19.750

你说：

> 谢谢你。但是这个解决方案提出了新的问题——如果事务范围发生了变化，为什么提交操作会变得如此耗时？数据库和应用程序在同一台机器上

那是因为您正在那里创建新的 DataContext ：

```
TransactionLogDataContext transactionDC = new TransactionLogDataContext()) 
```

使用新的数据上下文 ADO.NET 会打开新的连接（即使连接字符串相同，除非您进行一些巧妙的连接池）。在事务上下文中，当您尝试使用超过 1 个连接实例（您刚刚这样做）时，ADO.NET 会自动将事务提升为分布式事务，并尝试将其加入 MSDTC。将每个连接的第一个事务登记到 MSDTC 需要时间（对我来说需要 30 多秒），但是连续事务会很快（在我的情况下为 60 毫秒）。看看这个[http://support.microsoft.com/Default.aspx?id=922430](http://support.microsoft.com/Default.aspx?id=922430)

您可以做的是在创建新 DataContext 时重用事务和连接字符串（如果可能）。

```
 TransactionLogDataContext tempDataContext = 
      new TransactionLogDataContext(ExistingDataContext.Transaction.Connection);
 tempDataContext.Transaction = ExistingDataContext.Transaction; 
```

ExistingDataContext 是启动环境事务的地方。

或者尝试加快您的 MS DTC。

还请使用 billb 建议的 SQL Profiler 并在不同命令之间查找 SessionId（在您的情况下为 save 和 savelog）。如果 SessionId 发生变化，您实际上正在使用 2 个不同的连接，在这种情况下将不得不重用事务（如果您不希望将其提升为 MS DTC）。

# visual-c++ - CString 大小类

> ID：743523
> 
> 赞同：0
> 
> 时间：2009-04-13T10:16:21.933
> 
> 标签：visual-c++

如果 CString 对象获得最大大小，如何增加 CString 的大小。或者告诉我可以容纳比 CString 更多的最大数据的函数

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-13T11:07:46.337

CString 对字符串缓冲区使用堆分配，因此字符串长度的实际限制取决于许多条件，大约为数百兆字节。

通常，每次字符串需要增加其缓冲区时，它都会分配一个大于前一个缓冲区的新缓冲区 - 有一种策略来确定缓冲区的新大小。根据系统中可用内存的实际数量，此重新分配可能失败或成功。如果它失败了，你几乎没有什么可以做的选择——最好的选择通常是重新启动程序。

对于您解决的任务 - 使用 COM 端口 - 您可以使用 MFC::CArray，它非常方便用作可变大小数组。您也可以使用 std::vector 。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-13T12:26:03.137

在 CString 中，字符串的实际大小和分配的缓冲区由有符号整数保存（查看 CStringData）。字符串缓冲区本身是动态分配的。这意味着理论上的限制是 2^31 个字符。实际上，在 32 位环境中，由于内存碎片，您将能够获得更少的东西。此外，如果您使用 Unicode CString，每个字符是两个字节，这意味着 CString 缓冲区将容纳更少的文本。在 64 位环境中，您可能可以获得多达 2^31 个字符。

话虽如此，您真的要尝试使用那么长的字符串吗？在达到 CString 长度限制之前，可能还有很多事情要做。

# ads - 第三方广告提供商的广告是如何传送到网页的？

> ID：743524
> 
> 赞同：3
> 
> 时间：2009-04-13T10:16:25.693
> 
> 标签：ads

当网页加载到浏览器中时，第三方广告提供商如何决定向网页投放什么广告？这些数据以什么格式提供？

假设我的网页不包含与广告相关或差异化的内容，但我对我的用户了解很多：人口统计资料、兴趣、浏览历史等。所以我要加载的广告必须依赖于用户（个人资料），并且不是特定页面。

是否有可能在从浏览器向第三方提供商发出的广告请求中，在请求中包含个人资料数据以获得合适的广告？如果是这样，该请求可能会以何种格式发出，响应的格式将如何？例如 XML、JSON 等。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-13T10:24:16.830

> 是否有可能在从浏览器向第三方提供商发出的广告请求中，在请求中包含个人资料数据以获得合适的广告？

一般来说，您必须（根据法律）通知您的用户您将他们的信息泄露给第三方，（这称为“隐私”；））。虽然一般来说，它不是在个人请求的基础上完成的。网站向广告代理商出售广告空间，广告代理商将广告空间出售给广告商。由于网站具有一组给定的方面，因此广告商会购买具有方面 A、B 和 C 的网站的 X 次综合浏览量。广告代理然后控制这一点：网站调用（通常在 iframe 中）广告代理的广告服务器为 A、B 和 C 方面提供广告，而广告服务器只是提供广告。

由于它是一个 IFrame，广告代理可以通过 cookie 跟踪用户，它的*OWN* cookie。这更有价值，因为他们可以跨多个为其投放广告的网站跟踪用户（因此他们可以查看用户 X 访问了哪些网站，以及该用户在页面上遵循了多长时间/哪些路径，并将其与网站传递的信息相结合在 iframe 请求中发送到广告代理的广告服务器。

您向第 3 方提供的信息越多（并且您必须向您的用户提供该信息），越多的用户将阻止您网站上来自第 3 方的所有内容，或者干脆离开。尊重用户的隐私。与与广告公司的一些老大哥交易相比，它会给你更多的回报。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2013-07-01T14:59:34.323

一般来说，广告网络的主要工作方式是您将 HTML 添加到您的网页，该网页通过广告网络控制的服务器上的 URL（通常带有您的帐号或类似标识符）引用某些资源。资源可能是图像、视频、一段 JavaScript 或其他任何东西（iFrame 是另一种常见的）。

在大多数情况下，它将是一段 JavaScript 或 iFrame，脚本将从其网络中获取广告并将其设置在链接中。此链接通常是返回其服务器的链接，然后服务器将点击它的用户重定向到广告将流量引向的任何目的地。

通过点击他们服务器上的资源，他们可以计算特定广告从您的网站获得**的“展示次数”或“查看次数” ，并通过他们的服务器路由点击，他们****计算点击次数**。由于您在请求资源时向他们发送了您的帐户 ID，因此他们可以将这一切与您的帐户相关联，并**根据“每次点击费用” (CCP) 和/或展示次数向您付款**。

正如其他一些答案所提到的，广告网络使用的大部分“个人资料”信息都是**基于他们自己设置的 cookie**，而不是基于来自显示广告的网络资产的信息。这些 cookie 的工作方式以及它们如何允许广告网络建立这样一个特定的用户配置文件是**依赖于 Web 请求的 Referer 标头**。

广告代理商会给每个用户一个唯一的 id 作为他们的 cookie，然后每次页面向他们的服务器发出请求时，该请求将包含请求来自的页面的 URL，以及包含用于广告网络（因为这是对他们服务器的请求）。**如果您有足够的个人推荐 URL，您可以很好地了解他们是谁以及他们对什么感兴趣**，包括非常准确的人口统计信息。

使用 cookie 标识的用户的推荐人历史记录，广告网络能够更详细准确地了解您的用户以及他们想要什么，因为**他们的个人资料是基于行为的（即访问的实际站点）而不是**像大多数用户个人资料一样，**自我报告。**

非标准广告的其他示例（例如某处的横幅）包括使用脚本扫描您页面的文本内容并有选择地将一些单词转换为链接的广告网络，通常会在用户鼠标移过时弹出较大的广告他们。一个变体是当您第一次进入网站时弹出的广告，或者在指定时间内“附加”到用户光标上的广告。

然而，所有这些示例都相当具有侵略性，**可能会惹恼您的用户，并会减少您网站上的用户数量**，这是一件***坏事***。Google 对有效的广告展示位置进行了大量研究，包括尺寸、颜色、与网站其他内容的区别等，并且他们通过 AdSense 文档提供了大部分信息。

[注意：这是我对[这个问题的回答的扩展](https://stackoverflow.com/q/7394940/20770)]

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-01T13:45:49.253

根据您使用的广告服务器..您将设置各种目标配置文件。然后，当您销售库存时，您可以让广告商选择他们想要购买的定位配置文件。

广告服务器将为这些展示位置/区域生成代码。您将根据用户对您的站点进行编程以调用正确的区域。

# gdi+ - 在gdi +中旋转图像时如何避免别名？

> ID：743529
> 
> 赞同：0
> 
> 时间：2009-04-13T10:18:34.783
> 
> 标签：gdi+, rotation, antialiasing

我在 gdi+ 的画布上旋转图像时遇到问题，我正在使用以下代码，但是我发现边缘有别名。

```
myPathMatrix.Rotate(GetDCAngle(), MatrixOrderAppend);
myPathMatrix.Translate(
GetDCX(), 
GetDCY(),
MatrixOrderAppend);
canvas->SetTransform(&myPathMatrix);
canvas->Draw(XXX); 
```

**我使用以下代码删除别名，但失败了。**

```
canvas->SetInterpolationMode(InterpolationMode::InterpolationModeHighQualityBicubic);
canvas->SetSmoothingMode(SmoothingModeAntiAlias); 
```

如何删除旋转图像边缘的别名。

非常感谢！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-13T12:06:07.537

自从我使用 GDI+ 以来已经有一段时间了，但我认为没有有效的选项可以在旋转时消除边缘周围的抗锯齿。原因基本上是像素是正方形的。要将图像旋转 90 度的倍数以外的量，您需要使用某种插值来估计以前没有真正像素的像素颜色。

因此，如果库中没有任何东西可以专门消除边缘周围的抗锯齿，您是否考虑过在背景颜色中沿边界绘制硬线？在没有任何抗锯齿的情况下绘制这些线条应该更容易。

# javascript - 带有 jquery 的 Google 地理地图在 IE 中失败

> ID：743530
> 
> 赞同：2
> 
> 时间：2009-04-13T10:18:53.503
> 
> 标签：javascript, jquery, internet-explorer, jquery-ui, google-maps

我遇到了谷歌地理地图在 Internet Explorer 中与 JQuery 一起失败的问题。

否则在 Firefox 中它看起来像这样：

[![1239617014-clip-11kb](https://i.stack.imgur.com/Tnat6.jpg)](https://i.stack.imgur.com/Tnat6.jpg)
[（来源：[clip2net.com](http://clip2net.com/clip/m0/1239617014-clip-11kb.jpg)）]

js引用来了

```
<script type="text/javascript" src="http://maps.google.com/maps?file=api&amp;v=2&amp;key=ABCDEFG">
</script>
<script type="text/javascript" src="http://www.google.com/jsapi"></script>
<script src="/js/jquery-1.3.2.min.js" type="text/javascript"></script>
<script src="/js/ui.core.js" type="text/javascript"></script>
<script src="/js/ui.accordion.js" type="text/javascript"></script> 
```

[![1239620705-clip-21kb](https://i.stack.imgur.com/K7zBA.jpg)](https://i.stack.imgur.com/K7zBA.jpg)
[（来源：[clip2net.com](http://clip2net.com/clip/m0/1239620705-clip-21kb.png)）]

请任何人帮助解决这个问题...

谢谢指教。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-13T17:54:22.053

在 IE 中调试 javascript 很困难，但在没有实际 url 或使用缩小的 javascript 时更难调试。您可能希望暂时切换到完整的非缩小版 jquery，以便您可以找到发生错误的行并查看发生了什么。

此外，在 firefox 中，您可以尝试使用 firebug 来查看它是否会引发任何错误。即使地图在 Firefox 中运行，它也可能会从 IE 无法恢复的错误中静默恢复。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-13T22:57:08.953

您是否使用 console.log() 调用打印到萤火虫？这将导致 IE 抛出错误。如果是这样的话，可以尝试这样的事情

```
var a = "hello";
try
{
console.log(a);
}
catch(err)
{
alert(a);
} 
```

这将用 IE 中的普通旧警报替换 console.log

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-05T09:14:19.433

通过从页面中删除 JQuery.UI.Dialog 来修复。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-07-23T22:04:02.743

```
#map { float:left; width:700px; height:500px; margin-top:10px; } 
```

就这样 ：-）

# c# - 使用 NUnit 测试弹出窗口

> ID：743534
> 
> 赞同：2
> 
> 时间：2009-04-13T10:19:09.433
> 
> 标签：c#, unit-testing, nunit

我正在使用 VS2005 和 NUnit。

我想知道是否有一种方法可以仅使用 NUnit 来测试弹出窗口。

```
button1.click();<-Find/Assert if the popup window has been opened-> 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-13T15:18:59.257

恕我直言，对 UI 进行单元测试通常是个坏主意。UI 的本质使它们在自动化测试中存在问题。它们是流动的，并且经常更改，比其他代码更频繁，其方式会破坏任何测试。许多自动化测试只能通过拍摄图像快照来解决，这显然非常脆弱。时间问题变得非常成问题。最后，这种自动化依赖于对整个 UI 的控制，包括键盘和鼠标等 I/O 设备。这意味着在运行测试时不能在系统上进行任何其他活动，以免破坏正在运行的测试。将尽可能多的功能从 UI 中移出要好得多（[Presentation Model](http://martinfowler.com/eaaDev/PresentationModel.html)等模式对此有所帮助）并改为测试该功能。

也就是说，如果您必须和/或坚持为 UI 创建自动化测试，最好使用专为此设计的自动化库。对于 WinForms 和 WPF，[White](http://www.codeplex.com/white)是此类库的一个很好的例子。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-13T10:35:19.267

如果您正在测试弹出窗口是否已打开，那么我想您正在为浏览器而不是您的项目工作:)

这种功能使用[NMock](http://www.nmock.org)或[Rhino.Mocks](http://ayende.com/projects/rhino-mocks.aspx)进行测试，其中创建了一个模拟对象，它与您的 UI 对象等效，并将其“模拟”为具有您的 UI 组件的功能，用于测试功能你会期望 UI 组件/对象通过。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-13T12:35:23.130

我已经使用`FindWindowEx`和`CloseWindow`非托管函数来自动化你正在尝试做的事情，如果你有信心知道弹出窗口的标题，这可能是合适的。（我假设这是在 Win32 平台上）。我用它来测试一个创建模态对话框的函数，并且在对话框关闭之前不会将控制权返回给原始线程（它断言窗口已找到并成功关闭）。这不是 NUnit kosher，但它适用于我的目的。

如果这听起来对您有用，我可以制作一个片段，但这是一个相当具体的用例。

# apache - 错误 404--未找到（使用 apache 和 weblogic 时）

> ID：743541
> 
> 赞同：2
> 
> 时间：2009-04-13T10:26:56.310
> 
> 标签：apache, jsp, weblogic

我在 weblogic 中部署了一个应用程序，并且正在使用 apche 服务器。通常，当我输入应用程序的 url 时，它应该显示一个 jsp (1) 类型，请稍候，然后这个将重定向到另一个 jsp (2)。

问题是当我输入应用程序的 url 时，它显示 jsp (1) “请稍候”，并且在重定向时给出错误（错误 404--未找到）。

你认为问题是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-12-23T12:12:58.677

404 仅表示 URL 无效或资源实际上不在您认为的位置。

首先使用绝对 URL 独立测试其可用性。比如`http://example.com/context/page.jsp`。如果这不起作用，请验证资源是否确实存在于您的 web 应用程序中您期望的位置。如果这确实有效，那么您可能在重定向中使用了相对 URL，例如：

```
<meta http-equiv="refresh" content="3;url=/page.jsp"> 
```

您需要注意页面中的任何相对 URL 都是相对于当前请求的绝对 URL。因此，如果页面被请求，例如`http://example.com/context/wait.jsp`，那么上面的相对 URL 将解析为`http://example.com/page.jsp`。因此，如果页面实际位于`http://example.com/context/page.jsp`. 然后，您应该用正确的相对 URL 替换 URL：

```
<meta http-equiv="refresh" content="3;url=page.jsp"> 
```

或者只是一个绝对 URL：

```
<meta http-equiv="refresh" content="3;url=http://example.com/context/page.jsp"> 
```

# c - 如何在大量递归中允许更多内存并避免堆栈溢出？

> ID：743545
> 
> 赞同：3
> 
> 时间：2009-04-13T10:28:03.733
> 
> 标签：c, linux, gcc

我正在测试执行大量递归调用的算法的时间。我的程序在大约 128k 递归调用时终止，而这只需要 0.05 秒。我想让更多的内存在我的分析中有更长的时间。我正在运行 linux 并使用 gcc。是否有系统调用、环境变量、gcc 标志、包装器或其他什么？

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2009-04-13T10:30:52.273

尝试组织您的递归函数以进行[尾递归](http://en.wikipedia.org/wiki/Tail_recursion)。

也就是说，确保递归函数的最后一个操作是递归调用。通过这样做，编译器可以将其优化为简单的迭代。

尾递归将对您有所帮助，因为迭代会大大减少使用的堆栈空间。

使用尾递归，您通常会一直向上传递您的值，一次计算 1 步。所以当递归完成后，所有需要做的就是返回。

* * *

**例子：**

转换以下代码：

```
unsigned fact(unsigned x)
{
  if(x == 1)
    return 1;

   //--> Not tail recursive, multiply operation after the recursive call
   return fact(x-1) * x;
} 
```

对此：

```
unsigned fact(unsigned x)
{
    return tail_fact(x, 1);
}

unsigned tail_fact(unsigned x, unsigned cur_val)
{
  if(x == 1)
    return cur_val;  

  return tail_fact(x-1, x * cur_val);  
} 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-04-13T10:40:32.860

Linux 下的 gcc 没有堆栈大小编译器选项。然而[，本文讨论了如何在 Linux 上设置堆栈大小。](http://cs.nyu.edu/exact/core/doc/stackOverflow.txt)使用`ulimit`命令。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-13T10:38:56.997

你有三个选择：

1.  重写程序以使其非递归。这是最好的，但并不总是可能的。

2.  重写程序以使用单独的堆栈来存储执行状态。这样，您可以保留递归性质，但不再使用系统堆栈来存储递归算法状态数据。

3.  调整环境以推迟不可避免的事情。Visual C++ 有一个堆栈大小的链接器设置。几乎可以肯定 gcc 也有一个。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-13T22:16:38.413

尽管其他答案谈论如何完全避免递归，或如何使用尾递归，或如何简单地设置更大的堆栈大小，但我认为为了完整起见，考虑内存使用模式是值得的（回答“如何允许更多内存...大量递归”）。

出于习惯，许多程序员会在递归函数内部分配缓冲区，并在递归调用函数时重新分配新的缓冲区：

```
int recursive_function(int x)
{
    if (1 == x)
        return 1;
    int scratchpad[100];
    ... // use scratchpad
    return recursive_function(x-1) + scratchpad[x-1];
} 
```

**由于这是一个一次性示例，我不会担心无效输入（负值，大于 100 的值），我会假设有人提出有关编程的问题，要么知道如何做到这一点，要么足够聪明地找出答案。**

这里重要的一点是`scratchpad`每次`recursive_function()`调用都要占用栈的400字节（32位机器上，64位机器上800字节），所以如果`recursive_function()`递归调用100次，那么40000字节（或者80000字节）在 64 位机器上）堆栈空间被用于缓冲区，很可能您可以修改函数以在每次调用时重用相同的缓冲区：

```
int recursive_function(int x, int* buffer, int buffer_length)
{
    if (1 == x)
        return 1;
    ... // use buffer (and buffer_length to avoid overflow)
    int temp_value = buffer[x-1];
    return recursive_function(x-1, buffer, buffer_length) + temp_value;
} 
```

当然，您可以改用 a `std::vector`，它会为您处理一些细节，以保护您免受内存泄漏和缓冲区溢出的影响（并且，作为记录，将数据保留在堆上 [参见脚注]，这意味着它可能会使用更少的堆栈空间） .

40k 甚至 80k 可能看起来不多，但可以加起来。如果该函数没有许多其他堆栈分配的变量，那么这可能会支配堆栈空间（也就是说，如果不是因为缓冲区占用的额外空间，您可能可以多次调用该函数）。

这似乎很明显，[但它确实出现了](http://svnbook.red-bean.com/en/1.1/ch08s05.html)，即使在非递归函数中也是如此。此外，缓冲区并不总是像数组一样明显。例如，它们可能是字符串或对象。

* * *

**脚注**：STL 容器，例如数组，*不一定*将所有数据都放在堆上。它们实际上采用模板参数来指定使用的内存分配；只是他们默认使用的分配器将数据放在堆上。显然，除非您指定一个以某种方式将数据放入堆栈的分配器，否则最终结果将是相同的：使用 STL 容器可能会比使用堆栈分配的数组或对象使用更少的内存。

我说“可能”是因为虽然数据保存在堆上（或其他地方），但容器只能通过它内部保存的指针访问该数据，如果容器在堆栈上，那么这些指针将驻留在堆栈上，并且这些指针占用空间。因此，一个或两个元素`std::vector`实际上可能比相应的数组占用更多的堆栈空间。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-13T11:49:51.820

看看[`setrlimit()`](http://opengroup.org/onlinepubs/009695399/functions/getrlimit.html)：

> `RLIMIT_STACK`
> 这是初始线程堆栈的最大大小，以字节为单位。该实现不会自动将堆栈增长到超出此限制。如果超过此限制，`SIGSEGV`则应为线程生成。如果线程阻塞`SIGSEGV`，或者进程忽略或捕获`SIGSEGV`并且没有安排使用备用堆栈，`SIGSEGV`则应在`SIG_DFL`生成之前将处置设置为。

# c# - 如何将图像从位图放入图片框中

> ID：743549
> 
> 赞同：23
> 
> 时间：2009-04-13T10:30:20.123
> 
> 标签：c#, bitmap, image

是否可以从内存（`byte[]`或）加载图片而不将其保存到磁盘？`stream``Bitmap`

这是我用来将`byte[]`数组转换为的代码`Bitmap`：

```
unsafe
{
    fixed (byte* ptr = Misc.ConvertFromUInt32Array(image))
    {
        Bitmap bmp = new Bitmap(200, 64, 800, PixelFormat.Format32bppRgb, new IntPtr(ptr));
        bmp.RotateFlip(RotateFlipType.Rotate180FlipX);
        bmp.MakeTransparent(Color.Black);
        bmp.Save("test.bmp");
    }
} 
```

除了使用`Bmp.save()`，我可以将`Bitmap`图片框放在我的表单上吗？

* * *

## 回答 #1

> 赞同：60
> 
> 时间：2009-04-13T10:49:13.183

你试过这个吗？

```
pictureBox.Image = bmp; 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2014-05-03T03:15:53.517

我有一些类似于导致内存泄漏的公认答案的代码。问题是当您将图片框图像设置为位图时，您仍然指的是位图，而不是创建副本。如果您需要多次设置图像，则需要确保处理所有旧位图。

这适用于希望将位图克隆到图像框的任何*人*。试试这个：

```
if (pictureBox.Image != null) pictureBox.Image.Dispose();
pictureBox.Image = myBitmap.Clone(
    new Rectangle(0, 0, myBitmap.Width, myBitmap.Height), 
    System.Drawing.Imaging.PixelFormat.DontCare); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-01-12T08:19:15.673

如果您正在使用 C++ 编程语言，则可以这样做：

```
void backGroundImage()
{
    Image^ back = gcnew Bitmap("C:\\Users\\User\\Documents\\image.bmp");
    pictureBox1->BackGroundImage = back;
}; 
```

然后您可以`backGroundImage`在需要加载位图时调用。

# automation - 基于页面内容的自动网页数据输入

> ID：743554
> 
> 赞同：0
> 
> 时间：2009-04-13T10:31:56.530
> 
> 标签：automation, webpage, data-entry

是否可以制作一个打开页面的程序（就像 IE 打开书签文件一样），并根据其内容生成反馈，应该通过按下所述页面上的按钮在所述页面上的文本框中反馈？

我需要这个程序按照设定的时间表执行，以根据时间相关的网页数据将一些数据提供给 Web 服务器。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-13T10:35:55.303

是的，这是可能的。它通常被称为[屏幕抓取](http://en.wikipedia.org/wiki/Screen_scraping)。您基本上通过 HTTP 请求检索有问题的网页，解析/分析您获得的页面，然后发回应该进入文本框的数据（再次是 HTTP 请求）。

有图书馆可以做到这一点。这是一篇描述 Perl 示例的文章： [http ://www.perl.com/pub/a/2003/01/22/mechanize.html](http://www.perl.com/pub/a/2003/01/22/mechanize.html)

# iphone - App Store API 的使用是否有官方文档？

> ID：743555
> 
> 赞同：1
> 
> 时间：2009-04-13T10:32:21.477
> 
> 标签：iphone, objective-c, app-store

如果这是合法的，我可能想编写一个工具来进行一些 App Store 统计分析。我想知道是否有任何关于如何使用第三方软件访问 App Store API 的官方文档。有人知道吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-13T10:58:11.787

不，没有官方的 API 可以做到这一点。事实上，苹果通常对其数字、统计数据和一般信息非常封闭。

有些人所做的，为了获取有关大多数下载的应用程序、音乐和其他 iTunes 商店内容的一些信息，就是爬取商店并解析 HTML 内容以获得他们想要的数字。

# iphone - UITableView添加子视图问题

> ID：743565
> 
> 赞同：1
> 
> 时间：2009-04-13T10:36:46.410
> 
> 标签：iphone, uitableview

我有一个 UITableView，它在一个部分中有很多行。当我向下滚动到底行并单击按钮添加子视图时，我的子视图将显示在屏幕底部而不是从顶部显示，谁能帮我解决这个问题

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-29T21:59:48.617

我认为你需要澄清你的问题：

您是在询问向 UITableView 添加行还是向 UITableRow 添加子视图？如果要添加新行，则需要插入一行，更新数据源并重新加载表。

您不能也不应该向 UITableView 添加子视图。它不是那样工作的。

查看文档：

[UITableView 文档](http://developer.apple.com/iphone/library/documentation/uikit/reference/UITableView_Class/Reference/Reference.html#//apple_ref/occ/instm/UITableView/insertRowsAtIndexPaths:withRowAnimation: "UITableView")

# delphi - 无法注册多个全局热键

> ID：743567
> 
> 赞同：1
> 
> 时间：2009-04-13T10:37:19.310
> 
> 标签：delphi

我一直在尝试注册 3 个热键。我按照[这个](http://209.85.229.132/search?q=cache:SxqcrRMN6zAJ:www.delphi3000.com/articles/article_3529.asp+GetShortCutKey+GetShortCutModifier&cd=3&hl=en&ct=clnk&gl=de&client=firefox-a)例子（或[这个](http://www.delphi3000.com/articles/article_3529.asp)）。

如果我注册一个热键，代码就可以工作。但是，如果我尝试注册 3 个热键，则只有最后一个注册的热键有效：

```
procedure TFrmSettings.FormCreate;
begin
 atomN:= GlobalAddAtom(pchar('atomN'));    
 atomT:= GlobalAddAtom(pchar('atomT'));
 atomH:= GlobalAddAtom(pchar('atomH'));
end;

procedure TFrmSettings.test1;
begin
 RegisterHotShortCut(Handle, atomN, hotN.HotKey);        // first registered 
 RegisterHotShortCut(Handle, atomH, hotH.HotKey);        // second registered 
 RegisterHotShortCut(Handle, atomT, hotT.HotKey);        // third - only this works
end; 
```

RegisterHotShortCut 是在上面提到的网页中声明的。

```
function RegisterHotShortCut(const h:THandle; const Atom: integer; const ShortCut: TShortCut): Boolean;
VAR
  key : Word;
  Shift: TShiftState;
begin
  Windows.UnregisterHotKey(h, Atom);                                                    
  ShortCutToKey(ShortCut, key, shift);
  Result:= RegisterHotKey(h, Atom, ShiftState2Modifier(Shift), key);
end; 
```

如果在上面的代码中，我注释了最后一行，那么前面的热键 (hotH) 正在工作。这意味着我声明一切正确，但最后一个热键控制（取消注册）其他热键。

或者换一种说法，按第一次注册的快捷键的组合键不会使程序进入 `TFrmSettings.HotyKeyMsg(VAR msg: TMessage)`程序。

有什么提示吗？谢谢。

* * *

编辑1：

1.  有一些简单的片段似乎对其他人有用，但我真的需要让用户更改快捷方式，所以我需要 ShortCutToKey 过程。

2.  我应该为每个全局快捷方式声明一个原子。对？

* * *

Edit2： 已**解决** 上述代码仅在我使用“GlobalAddAtom”函数时才会失败。如果我只使用数字 1、2 和 3 而不是原子，则代码有效。如果我使用 4、5、6，代码会再次失败。问题（半）解决了。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-14T03:31:38.950

我一直在为我的多个热键使用这样的代码，我不知道这是否是你想要做的：首先声明

```
procedure WMHotKey(var Msg: TWMHotKey); message WM_HOTKEY; 
```

然后把这些放在 form.create 或 elsehere

```
 RegisterHotKey(Handle, 1, MOD_SHIFT, VK_F9); 
  RegisterHotKey(Handle, 2, MOD_WIN, VK_F8);
  RegisterHotKey(Handle, 3, MOD_ALT, VK_F7); 
```

和热键处理程序

```
procedure TForm1.WMHOTKEY(var Msg: TWMHOTKEY);
begin
  case Msg.HotKey of
    1 : ShowMEssage('this is 1 (shift+F9)');
    2 : ShowMessage('this is 2 (Win+F8)');
    3 : ShowMessage('this is 3 (ALT+F7)');
  end;
end; 
```

关闭您的应用程序时不要忘记取消注册。已在 winxp+sp3 , delphi 2006 上测试

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-13T10:58:33.050

在谷歌上搜索`RegisterHotShortCut`只返回 5 次点击，对我来说这表明这个函数不是正确的答案。搜索“delphi register hotkey”得到 235000 次点击，文章[How to register a global hotkey](http://www.delphidabbler.com/tips/16) (from 2007, using `RegisterHotKey`) 似乎与您查看的文章相似（从 2003 年开始）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-13T18:55:47.460

是的，每个快捷方式都需要一个 Atom。我很好奇您在注册之前为每个 UnregisterHotKey 打的电话。如果您之前没有注册该热键，那么您就不需要它。尝试删除该行，看看是否可以修复它。听起来 UnregisterHotKey 正在删除以前的热键，即使它有不同的 atom 。.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-15T03:37:28.460

请检查此代码，它使用原子并且工作正常（我测试过） [http://www.swissdelphicenter.ch/torry/showcode.php?id=147](http://www.swissdelphicenter.ch/torry/showcode.php?id=147)

编辑1：请记住，注册失败的原因是您尝试注册的组合键已被系统或其他应用程序注册。（见上面的链接）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-08-19T20:13:01.833

已解决仅当我使用“GlobalAddAtom”函数时，上述代码才会失败。如果我只使用数字 1、2 和 3 而不是原子，则代码有效。如果我使用 4、5、6，代码会再次失败。问题（半）解决了。

# mysql - MySQL 查询 - 未知列

> ID：743569
> 
> 赞同：0
> 
> 时间：2009-04-13T10:38:19.167
> 
> 标签：mysql, field, alias

我正在尝试运行查询，但出现“'where 子句'中的未知列'MyField'”错误。

这是我的查询：

```
SELECT id, sum(lineValue * quantity) as TotalLine
FROM myTable
WHERE (TotalLine BETWEEN 10 and 500)
group by id 
```

如何执行类似的查询？谢谢

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-13T10:45:16.357

```
SELECT  id, SUM(lineValue * quantity) as TotalLine
FROM    myTable
GROUP BY
        id
HAVING  TotalLine BETWEEN 10 and 500 
```

# asp.net - 动态创建的按钮

> ID：743576
> 
> 赞同：1
> 
> 时间：2009-04-13T10:42:16.600
> 
> 标签：asp.net

当我单击一个按钮时，我需要动态创建一些文本框。必须通过单击应在这些文本框下方动态生成的按钮将文本框的值输入数据库。我如何实现这个？我需要为这个新生成的按钮设置一个 Click 事件。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-13T14:18:23.087

Use ASP.NET MVC, if you want dynamic creation of elements on your page, MVC Framework is much better suited for this than Webforms are. Save yourself the headache.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-13T11:41:59.810

您可以在回发时简单地处理 Page_Load 中新数据的输入，并让您新创建的按钮回发表单。显然，您需要查看新文本框的表单参数，并有办法将它们与以前存在的文本框区分开来。

如果您必须使用按钮单击事件处理程序来处理它们，您可以尝试向您的页面添加一个隐藏（“显示：无；”，而不是“可见 = false”）按钮并将服务器端单击处理程序与其关联。让客户端单击处理程序在单击隐藏按钮时引发单击事件。这应该调用隐藏按钮的服务器端单击处理程序。同样，您需要在请求的表单参数中找到新的文本框，因为它们不会作为服务器端控件存在。

# asp.net - 页面刷新导致 ASP.NET 应用程序中的重复 POST

> ID：743580
> 
> 赞同：12
> 
> 时间：2009-04-13T10:43:36.330
> 
> 标签：asp.net

我有一个应用程序，我在其中添加一条新记录，如果我按下刷新按钮，记录会被添加两次。

我正在清除缓存，但我遇到了同样的问题。该怎么办？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-13T10:46:53.640

一旦您处理了返回页面的帖子，最佳做法是然后重定向，这样您就不能使用“刷新”按钮再次发布数据。这对所有 Web 开发都很常见，而不仅仅是 ASP.NET。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-09-03T20:15:43.317

My method is shamelessly stolen from page 4 of [this](http://aspalliance.com/687) awesome article on ASP Alliance. To detect a refresh, you can store the same value in ViewState and Session. If the user refreshes a page, it will PostBack using the old ViewState data that does not match your Session value. Once you detect this, you can create a Page that all of your other Pages inherit from with a simple variable to test for whether the user refreshed the browser. This solution requires ViewState to be enabled and a valid Session.

```
protected override void OnLoad(EventArgs e)
{
    base.OnLoad(e);

    if (IsPostBack && ViewState[REFRESH_CHECK_GUID] != Session[REFRESH_CHECK_GUID])
    {
        IsRefresh = true;
    }
    Session[REFRESH_CHECK_GUID] = System.Guid.NewGuid().ToString();
    ViewState[REFRESH_CHECK_GUID] = Session[REFRESH_CHECK_GUID];
}

/// <summary>
/// True if the last PostBack was caused by a Page refresh.
/// </summary>
public virtual bool IsRefresh
{
    get;
    private set;
} 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-13T11:30:09.307

在理想情况下，导致数据库更新的 HTTP POST 提交将在成功更新后重定向到通知用户操作成功的辅助页面。如果用户试图返回上一个页面，浏览器会提示用户类似“”如果不重新发送信息，页面将无法刷新。单击“重试”以重新发送信息或单击“取消”以继续”。这足以说明用户刷新页面将导致重复提交。但是，如果更新失败，将加载同一页面并允许用户重试。

当然，这不是一成不变的规则，并且实现方式各不相同。我强烈建议您将@edg 的建议付诸实践——您的数据库插入代码应始终在应用插入/更新之前检查重复性。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-09-24T19:29:15.523

如果您没有任何会话（并且启用了 cookie），您可以使用：

```
protected override void OnLoad(EventArgs e)
{
    base.OnLoad(e);

    if (IsPostBack && ViewState[REFRESH_CHECK_GUID] != Request.Cookies[REFRESH_CHECK_GUID])
    {
        IsRefresh = true;
    }
    String checkGuid=System.Guid.NewGuid().ToString();
    Response.Cookies[REFRESH_CHECK_GUID] = checkGuid;
    ViewState[REFRESH_CHECK_GUID] = checkGuid;
}

/// <summary>
/// True if the last PostBack was caused by a Page refresh.
/// </summary>
public virtual bool IsRefresh
{
    get;
    private set;
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-13T10:45:24.050

如果应用程序是您的，您需要添加代码，在尝试将记录保存到数据库之前先检查该记录是否不存在。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-14T08:47:33.420

即使我们对整个表单使用 Ajax，它也会提供相同的重复插入，但我们可以尝试通过清除 hiddenfield _EventTaret 并更改其他一些控件的焦点:)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-14T08:57:37.247

正如上面大卫 M 所说，最好的想法是在发布后重定向。让另一个服务器往返的影响非常小，因为只有 http 标头在重定向中发送。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-13T10:56:46.610

问题是由于 __EVENTTARGET 中的隐藏值无法通过代码设置。

如果您可以使用 Ajax 添加数据，则可以解决此问题。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-09-03T19:45:38.693

如果您**需要**留在同一页面，那么我建议您将用户重定向到确认页面，然后您可以在其中询问用户是否要插入另一条记录，如果是，那么您将他们重定向回他们可以插入的页面记录，这将有助于防止重复插入。或者，如果他们完成插入记录，他们可以直接进入“主”页面。当我需要用户在插入后能够“停留”在同一页面中时，这就是我过去所做的。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2016-09-13T10:04:12.937

执行插入或更新语句后，您可以将用户重定向到同一页面

**Response.Redirect(Request.Url.AbsoluteUri);**

# scripting - 批处理文件显示启动项

> ID：743585
> 
> 赞同：2
> 
> 时间：2009-04-13T10:47:03.703
> 
> 标签：scripting, batch-file, startup

在 Windows 中，如何使用批处理文件显示启动项？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-13T11:00:15.543

您的启动项是您自己的项和“所有用户”项的组合。您可以通过以下方式找到自己的：

```
dir "%homedrive%%homepath%\start menu\progams\startup" 
```

和“所有用户”（通常）具有：

```
dir "%homedrive%%homepath%\..\all users\start menu\progams\startup" 
```

您所要做的就是操作文件名以删除路径和末尾的“.lnk”以获取快捷方式名称。

如果您`cd`首先访问这些目录并且只执行 dir，则您甚至不必删除路径。

**更新：**

如果，正如您的评论似乎表明的那样，您希望所有事情都在系统启动时启动，那么它们无处不在。您需要获得一份[Autoruns](http://technet.microsoft.com/en-us/sysinternals/bb963902.aspx)（或它的命令行兄弟 Autorunsc，用于您的目的）。

这是最好的方法，因为它得到了微软自己的“祝福”。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-13T14:50:40.777

如果您可以使用 PowerShell，这里有一些使用[AUTORUNSC](http://live.sysinternals.com/autorunsc.exe)的代码。

```
$autoruns = [xml](AUTORUNSC -x 2>$null)

foreach ($item in $autoruns.autoruns.item)
{
  If ($item.Description.Length -gt 0)
  { Write-Output $item.Description.Trim() }
  Else
  { Write-Output "n/a"}
  Write-Output $item.ItemName.Trim()
  Write-Output $item.imagepath.Trim()
  "---------------------------------------"
} 
```

**编辑**：`-x`AUTORUNSC 上的参数使其输出 XML。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-13T11:52:07.413

正如已经回答的那样，启动项是“所有用户”和当前用户的启动项的组合。启动项可以作为链接放置在“开始”菜单的“启动”文件夹中，也可以作为注册表项放置。

对于启动文件夹，您已经在 Pax 的答案中获得了路径，但请注意，在非英语版本的 Windows 中路径会有所不同。

对于注册表，我认为您不能仅使用批处理脚本来查询它。如果可以的话，可以通过 PowerShell 脚本来完成。否则，我认为完成该任务的最简单方法是为该任务制作一个小型实用程序。（用其中一种 .NET 语言很容易做到，或者如果不能依赖现有的 .NET Framework，也可以用 C 语言做到这一点）。

对于所有用户，可以在此处找到注册表条目：

```
HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Run 
```

对于当前用户：

```
HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run 
```

最后，请注意注册表还包含 RunOnce 键；其中包含仅应在启动时运行一次然后被删除的条目。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-13T11:12:59.223

“所有用户”似乎没有显示 MSConfig 中的内容。是否有查询注册表以获取 MSConfig 启动条目？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-13T12:45:18.363

您可以使用[reg](http://www.ss64.com/nt/reg.html)命令查询相应的注册表项：

```
reg QUERY HKCU\Software\Microsoft\Windows\CurrentVersion\Run > out 
```

这将为您提供文件“out”中的键列表，如下所示：

```
 UIWatcher    REG_SZ    D:\Utils\Ashampoo UnInstaller\UIWatcher.exe
    SpybotSD TeaTimer    REG_SZ    C:\Program Files\Spybot - Search & Destroy\TeaTimer.exe
    SandboxieControl    REG_SZ    "C:\Program Files\Sandboxie\SbieCtrl.exe"
    WMPNSCFG    REG_SZ    C:\Program Files\Windows Media Player\WMPNSCFG.exe 
```

您需要解析此列表以获取第一个和第二个标记，其中 REG_SZ 是分隔符。如果您想坚持使用简单的批处理语言（meh ...），这只不过是麻烦，您将不得不使用 FOR /F 命令以下列方式获取令牌：

```
FOR /F "tokens=1,2 delims=$" %i in (out) do @echo %i %j 
```

在此之前，您需要用一些字符替换 REG_SZ，比如说 $，因为 FOR 不接受字符串分隔符。整个过程可以放在一个批处理文件中：

```
SETLOCAL EnableDelayedExpansion

@echo off > StartUp.txt
FOR /F "skip=2 usebackq tokens=* delims= " %%i in (`reg QUERY HKCU\Software\Microsoft\Windows\CurrentVersion\Run`) do (  
    set LINE=%%i
    set LINE=!LINE:REG_SZ=$!
    FOR /F "tokens=1 delims=$" %%j in ('cmd.exe /C echo !LINE!') do echo %%j >> StartUp.txt
) 
```

在你运行它之后，StartUp.txt 应该包含程序的全名，每个都在它自己的行上。构造 'cmd.exe /C echo !LINE!' 令人困惑。我把它作为我扫描 LINE 变量的问题的解决方法。根据文档，它应该只是“！LINE！” 但由于某种原因它不起作用......如果你对 !VAR 感兴趣！语法，见 set /?

无论如何，批处理语言很浪费时间，所以如果可能的话最好避免使用它，或者将它与一些严肃的工具（如 awk、sed、autohotkey 等）结合使用......它们中的每一个都可以解析 reg 命令的输出在一个单一的regexp 行，而 autohotkey 甚至可以为它创建一个漂亮的 GUI，你可以完全避免批处理脚本。

最后，不要忘记也可以运行“所有用户”部分。

# objective-c - 隐藏公共访问的属性

> ID：743586
> 
> 赞同：25
> 
> 时间：2009-04-13T10:47:39.050
> 
> 标签：objective-c

`Private`我正在尝试在这样的类别中声明仅供内部使用的属性：

```
@interface BarLayer (Private)

@property (readwrite, retain) MenuItemFont  *menuButton;
@property (readwrite, retain) Menu          *menuMenu;
@property (readwrite, retain) LabelAtlas    *messageLabel;

@end 
```

现在我正试图弄清楚我应该在哪里`@synthesize`。

我试过：

```
@implementation BarLayer (Private)

@synthesize menuButton      = _menuButton;
@synthesize menuMenu        = _menuMenu;
@synthesize messageLabel    = _messageLabel;

@end 
```

在这里，编译器抱怨：

> 类别的实现中不允许使用@synthesize

所以我试着把它放在我的`BarLayer`实现中，但是在这里它没有在`BarLayer`接口中找到声明。

> 在界面中找不到属性“menuButton”的声明

正确的方法是什么？

* * *

## 回答 #1

> 赞同：43
> 
> 时间：2009-04-13T11:42:06.923

您不能`@synthesize`与类别一起使用。

您*可以*使用类扩展（又名匿名类别）来做到这一点，它只是一个没有名称的类别，其方法必须在`@implementation`该类的主块中实现。对于您的代码，只需将“（私有）”更改为“（）”并`@synthesize`在主`@implementation`块中与该类的其余代码一起使用。

有关更多信息，请参阅[有关扩展的 Apple 文档](http://developer.apple.com/library/mac/#documentation/Cocoa/Conceptual/ObjectiveC/Chapters/ocCategories.html)。（显然这是 Mac OS 10.5 中的新功能。）

编辑：一个例子：

```
// Main interface (in .h)
@interface Foo : NSObject
- (void)bar;
@end

// Private interface (in .m, or private .h)
@interface Foo ()
@property (nonatomic, copy) NSString *myData;
@end

@implementation Foo
@synthesize myData; // only needed for Xcode 4.3 and earlier
- (void)bar { ... }
@end 
```

另一种工作量更大的解决方案是使用`objc_setAssociatedObject`和`objc_getAssociatedObject`伪造额外的实例变量。在这种情况下，您可以将它们声明为属性，并使用上面的 objc_* 运行时方法自己实现 setter 和 getter。有关这些函数的更多详细信息，请参阅[有关 Objective-C 运行时的 Apple 文档](http://developer.apple.com/library/mac/#documentation/Cocoa/Reference/ObjCRuntimeRef/Reference/reference.html)。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2010-07-15T00:30:29.450

我找到了为什么在类别中禁止合成属性的解释，但是如何**使用类扩展**来代替：

以下信息来自[http://www.friday.com/bbum/2009/09/11/class-extensions-explained/](http://www.friday.com/bbum/2009/09/11/class-extensions-explained/)

“在类别中禁止合成的原因是因为合成需要存储，并且没有办法有效地在类别中声明存储，并且不允许一个类别合成方法然后直接欺骗该类的 ivars 是不可接受的。太脆弱了和丑陋的。

然而，显然也希望能够声明一个公开只读的属性，但其实现是读写的，用于内部到类或框架的目的。

另一个要求是，这些属性的合成必须始终能够自然而精确地合成 setter 和 getter。具体来说，当声明一个属性为原子属性时，开发人员无法正确手动编写只有 1/2 的 getter setter 对；锁定基础设施没有暴露，因此在这种情况下无法保证原子性。

类扩展优雅地解决了这个问题。

具体来说，您可以声明如下属性：

```
@interface MyClass : NSObject
@property(readonly) NSView *targetView;
@end 
```

然后，在实现文件中：

```
@interface MyClass()
@property(readwrite) NSView *targetView;
@end

@implementation MyClass
@synthesize targetView;
@end 
```

最终结果？一个公共只读的属性，但私有的可读写的属性，不会对与类别相关的所有有趣的脆弱性开放属性。”

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-04-13T11:53:28.473

Scott Stevenson ( [http://theocacao.com/](http://theocacao.com/) ) 在他的博客文章[“A Quick Objective-C 2.0 教程：第二部分”](http://theocacao.com/document.page/516)中解释了如何**使用 Private Setter 获取公共属性**。按照他的建议，您将获得一个对公众只读的属性，但有一个可以与点语法一起使用的私有 setter。希望这可以帮助...

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-11-02T20:45:36.297

我只想添加我的 2 美分，让人们知道可以通过类别（而不是类扩展）向现有类添加属性。它需要使用关联引用，但实际上并没有那么糟糕。

如果有人想了解更多详细信息，我在这里写了一篇[关于它的帖子。](http://www.xn--w-mer-iza4o.com/2011/11/02/adding-properties-to-a-class-through-categories/)

还有另一个问题解决了这个话题，[但它的细节很少](https://stackoverflow.com/questions/4071500/how-to-add-properties-to-nsmutablearray-via-category-extension/4071538#4071538)。

干杯

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-13T11:41:48.780

因为类别只能将方法添加到类中，所以您无法通过尝试在类别中定义属性方法来解决此问题。

您可以声明从现有类派生的属性。例如。如果你的类有一个`firstName`和一个`lastName`属性，你可以声明一个`fullName`在@implementation 类别中调用的属性。

```
@interface Bar (Private)
@property (readonly) NSString *fullName; // Note readonly, you have nothing to write to.
@end 
```

但是，您不能只`@synthesize`使用此属性，您必须编写自己的访问器，因为编译器不知道您想从哪里获取此值。

```
@implementation Bar (Private)
- (NSString *)fullName {
    NSString *returnString = [NSString stringWithFormat:@"%@ %@", 
                             self.firstName, self.lastName];
} 
```

从类设计的角度来看，我不确定私有属性的想法是否有意义：我个人认为属性是类公开暴露的东西。

您可以使用`@private`BarLayer 类中的关键字至少为其状态添加一些保护。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-10-21T08:46:58.450

实际上，使用最新的 LLVM 编译器，可以更好地解决这个问题。之前推荐的尽可能多地隐藏属性的方法是在 .h 中声明变量，以 _ 为前缀，在私有 .m 中的类扩展中声明属性，然后在 @synthesise 中 @synthesise执行。

使用最新的 LLVM (3.0)，您可以走得更远，隐藏有关您的财产的所有内容，包括支持的 ivar。它的声明可以移动到 .m 甚至在那里省略，在这种情况下它将由编译器合成（感谢 Ivan）：

汽车.h：

```
@interface Car : NSObject

- (void)drive;

@end 
```

汽车.m:

```
@interface Car ()

@property (assign) BOOL driving;

@end

@implementation Car
@synthesize driving;

- (void)drive {

    self.driving = YES;
}

@end 
```

# .net - 从“本机”OODBMS 迁移到 ORM（实体框架/SQL Server）

> ID：743591
> 
> 赞同：2
> 
> 时间：2009-04-13T10:49:45.613
> 
> 标签：.net, orm, migration, rdbms, object-oriented-database

不久前，我们开始开发一个新项目，该项目内部有大约 25-30 个不同的类/类型/模型，它们通过 1:n、n:m 或 n:1 关系彼此密切相关。

那时我们使用原生 .net oodbms 系统，主要是因为它允许我们做的是采用我们的对象模型并简单地在这里和那里添加一些与持久性相关的方法（-calls），我们就可以开始了。然而，随着时间的推移，我们遇到了越来越多的警告，非常糟糕、不可修复（在合理的时间范围内）的限制，迫使我们实施缓慢的解决方法，导致性能平庸，可扩展性问题即将出现，许可费用几乎增加了对我们来说是 5 倍，而我们没有任何变化（他们被大公司收购了）。

因此，我们目前开始在可扩展性/性能以及维护方面寻找长期解决方案。我们查看了其他“真正的”oodbms，并且总是遇到主要的破坏者，因此我们开始进一步研究，现在基本上正在考虑 ORM，希望这能让我们将大部分注意力集中在我们的对象上与 SQL 的争吵。

所以基本上这是我的问题：是否有人对 Microsoft 的实体框架或任何其他 .NET ORM 有任何实际经验，可以保持配置尽可能可维护，并在密切/高度相关的实体中表现良好？我们存储的数据量在任何方面都不是惊人的或广泛的（我们预计在未来 3 年内所有实体中总共有 10 万个实例）。

是否有人对 ORM 有任何想法/建议和/或从 oodbms 迁移到 rdbms 的经验？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-15T10:44:01.820

由于您有一个现有的对象模型并且您希望迁移到 ORM 解决方案，那么我会说 NHibernate 肯定是一个不错的选择。原因如下：

1.  您不必对域模型类进行（m）任何添加/更改以支持持久性。NHibernate 在支持域模型中的持久性无知方面有很长的路要走，尽管您可能会发现您需要进行一些小的更改，例如将更多的方法/属性标记为虚拟，而不是其他方式。
2.  映射现有对象模型后，您可以为数据库生成架构。这对于域驱动（或者只是对象模型优先）开发来说是一个巨大的节省时间。此功能通过 FluentConfiguration.ExposeConfiguration() 方法和 fluent NHibernate 或通过 hbm2ddl 工具和标准 NHibernate 映射文件来支持。当然，这也有助于提高可维护性——对对象模型的更改可以快速反映在数据库模式中。
3.  使用流利的 NHibernate 进行映射有助于使初始映射非常快，因为您获得了自动完成和简化的映射模型。这也将有助于为您提供您正在寻找的可维护性 - 您的映射是在具有流畅 NHibernate 的代码中声明的，因此重构工具将相应地更改您的映射。您可能还会发现您可以使用 Fluent NHibernate 自动映射，并且在大多数情况下避免手动映射您的对象模型。

为此使用实体框架将更具挑战性。虽然实体框架在许多方面都是一个有能力的 ORM，但它不如 NHibernate 成熟，在这种情况下有几个原因，特别是为什么我认为它可能不是最佳选择：

1.  您将不得不对现有对象模型进行大量更改以支持实体框架。如果您想使用当前提供的实体框架工具，您可能需要将代码迁移到生成的部分类，这些类继承自 EntityObject 实体框架基类。根据您现有的对象模型，此继承要求对您来说可能是也可能不是问题。您可以通过在代码中支持[某些接口](http://msdn.microsoft.com/en-us/library/bb738631.aspx)来避免这种情况，但这并不重要，我认为您将失去很多用于管理映射的内置工具支持。
2.  您几乎肯定需要手动创建数据库模式。对于大小合适的对象模型，这通常不是一项微不足道的任务。
3.  实体框架不支持开箱即用的透明延迟加载。我确信透明延迟加载是您习惯使用 OODBMS 的东西，并且大多数其他 ORM（当然包括 NHibernate）都支持它，但是对于实体框架，您会发现您需要显式地 .Load() 相关对象（父子关系），然后再在代码中引用它们。有解决方法（例如[this one](http://blogs.msdn.com/jkowalski/archive/2008/05/12/transparent-lazy-loading-for-entity-framework-part-1.aspx)），但它不是内置功能。

总的来说，在我看来，对于对象优先的开发，或者你试图利用现有的对象模型，NHIbernate 是一个更好的选择。对于以数据为中心的开发，实体框架（或 linq to sql 甚至 subsonic）成为更可行的选择。

您可能还想评估诸如[Lightspeed](http://www.mindscape.co.nz/products/LightSpeed/)之类的商业 ORM 产品——我自己对这个特定工具的经验很少（当有很好的免费替代品时，客户通常反对为 ORM 付费），但它受到高度重视。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-13T10:55:17.007

我对 OODBMS 没有任何经验，但我在 NHibernate + MS SQL Server 方面的经验在一对多、多对一和多对多关系的强制和级联更改方面非常积极。

您使用的是什么 OODBMS 工具？OODBMS -> RDBMS 迁移工具可能存在，但我不知道。

# c++ - 二叉堆的 C++ 实现

> ID：743594
> 
> 赞同：7
> 
> 时间：2009-04-13T10:54:11.157
> 
> 标签：c++, data-structures, heap, binary-tree

我需要一个实现为二叉树的最小堆。真正快速访问最小节点和插入排序。

stl 或 boost 中是否有一个很好的实现，任何人都可以指出我？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-04-13T10:58:47.653

我认为[std::priority_queue](http://en.cppreference.com/w/cpp/container/priority_queue)是您正在寻找的。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-13T11:02:31.543

请参阅标准 C++ 算法[make_heap](http://www.sgi.com/tech/stl/make_heap.html) ()。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-04-13T11:03:42.383

STL 没有（二叉）树的概念，但有一些方法有助于维护数据集中的堆属性，例如 std::make_heap、std::sort_heap、std::push_heap 等。

# seo - 使 joomla 搜索页面搜索引擎友好

> ID：743600
> 
> 赞同：0
> 
> 时间：2009-04-13T10:56:44.567
> 
> 标签：seo, joomla

我想向 joomla 搜索组件添加一些 seo 功能，例如元和集成标题页。我应该在文件中破解什么？感谢 joomla 版本 1.0.15

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-13T11:17:06.360

我建议直接在 Joomla 上进行黑客攻击！搜索模块。这应该`modules/mod_search.php`归档并从那里添加您的功能。我对SEO优化的主题不太熟悉。

# size - 为什么我的页面大小比维基百科大？

> ID：743607
> 
> 赞同：2
> 
> 时间：2009-04-13T11:01:01.623
> 
> 标签：size

当我从我的网站上保存一个关于特蕾莎修女的页面时 - [http://www.peopleforever.org/nfhomepage.aspx?nfid=41](http://www.peopleforever.org/nfhomepage.aspx?nfid=41)它占用了 1.73mb，这是巨大的！

类似的维基百科页面需要更少的时间。我知道我有很多图片，所以它应该占用更多空间，但还有更多吗？

保存时，我看到以下文件：

ScriptResource_002.js - 254 kb mediaplayer-min-2.js - 204 kb main.js - 194 kb Prototype.js - 124 kb ScriptResource.js - 96 kb

我不明白这些文件是如何形成的，我是否可以做一些事情来减小页面大小以加快加载速度？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-13T11:02:59.763

这些 .js 文件是 Javascript 文件，听起来您正在使用某种[所见即所得](http://en.wikipedia.org/wiki/WYSIWYG)的编辑器。

Javascript 是有时嵌入在 HTML 文件中，有时嵌入在客户端执行的自己的 .js 文件中的代码。

看看[YSlow](https://addons.mozilla.org/en-US/firefox/addon/5369)，它会告诉你为什么你的页面很慢。

我不确定你的 Javascript 文件为什么这么大。尝试像[JSMin](http://www.crockford.com/javascript/jsmin.html)这样的东西来最小化你的 javascript 大小。如果可能的话，合并你的 .js 文件也将改善页面加载时间，因为服务器需要更少的请求来获得更少的文件，但是这些 .js 文件的纯大小真的让你很生气。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-13T11:12:20.707

获取 firefox 和 Firebug + Yslow 插件 - 然后阅读 Yslow 报告中的链接页面。

合并您的 Javascript 和 CSS 文件，并丢弃您的页面模板，因为基于表格的设计意味着在下载整个 HTML 页面和大部分图像之前，它无法呈现。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-13T11:10:54.597

您可以在网页中压缩组件以加快执行速度。您可以为此使用 IIS 压缩。

你也可以缩小你的 javascript 文件。有很多免费工具可以实现这一目标。

看看这个链接

[http://developer.yahoo.com/performance/rules.html](http://developer.yahoo.com/performance/rules.html)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-13T11:26:41.330

保存页面的大小并不重要，因为您提到的大多数大型 JS 文件都有望被浏览器缓存并且只会加载一次，因此最小化它们的大小不会大大加快加载时间。

但是当页面加载时，一些 JavaScript 代码会被执行，这会减慢它的速度。尝试为您的浏览器禁用 Java/JavaScript，然后页面将几乎立即加载。主要的减速似乎是谷歌地图小程序，它在初始化后也会加载一些图像。

还可以查看页面本身，此处大小为 219 KB，其他页面最大为 300 KB。有一个大的编码（Base64？）“__VIEWSTATE”部分，大小约为 20 KB，这似乎是一些 ASP 安全问题或类似的东西。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-13T11:35:58.263

如果您的 javascript 未打包，请使用以下内容：

[http://dean.edwards.name/packer/](http://dean.edwards.name/packer/)

使它们更短更紧凑。这将节省很多。还要确保您的网络服务器使用**gzip**之类的东西，它对文本数据也有很大帮助。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-13T12:16:32.723

还要记住，文件的大小并不是减慢页面速度的唯一因素。外部文件的数量。事实上，每个文件（甚至是缓存的文件）都是从服务器请求的（如果缓存则不会下载），如果您有很多文件，这可以在几毫秒甚至几秒钟内完成。

如果您愿意将页面推向极限，可以考虑以下步骤：

*   将您可以访问的所有 js 和 css 文件合并到一个大文件中
*   缩小 js 和 css
*   gzip 一切。这可以在 IIS 中完成。网上有很多关于这方面的文章
*   因为这是 ASP，所以我想有很多 ViewState 数据来回发送给用户。审查它。也许那里根本不需要一些数据？

# api - 代理每个服务器调用以绕过 API 限制（即 Twitter）是否合理？

> ID：743611
> 
> 赞同：0
> 
> 时间：2009-04-13T11:03:17.470
> 
> 标签：api, proxy, air

在编写 AIR 应用程序时，我遇到了 API 限制（调用太多）和服务器超时（调用太快）的一些问题。

我对代理的性能不是很熟悉，所以我想知道是否经常将代理列表下载到应用程序并为每个 API 调用使用不同的代理会相当快。我什至不确定在哪里可以获得更新的代理列表，所以任何见解都会有所帮助。

随意提出其他替代解决方案。谢谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-13T11:31:30.770

通过走代理路线，您实际上使您的每个用户都违反了 Twitter 的 TOS。这是一个坏主意。

我的建议是：

*   允许客户端设置间隔
*   在另一个遵循客户端间隔的线程中刷新/获取您的数据
*   让您的用户配置一个 SOCKS 代理，或者他们自己喜欢的 HTTP 代理

那时，是他们，而不是你（可能）惹恼了推特。

不过，请考虑一下您的应用程序的可行性，如果它需要如此快速地发出请求才能使用。你最不想看到的就是有人说“我下载了 footwit，现在我被 twitter 禁止了！我不得不支付 10 美元从我的 ISP 那里获得一个新 IP，然后我发现 Twitter 禁止了整个 /20 ！！”

想，想，想。

# visual-sourcesafe - VSS 2005/ 6.0 的路线图是什么？

> ID：743618
> 
> 赞同：2
> 
> 时间：2009-04-13T11:11:39.180
> 
> 标签：visual-sourcesafe

Microsoft 一直在积极争取使用 Team Foundation Server。我们组织中的 VSS 数量非常庞大。我试图找到过渡的绝对必要原因。没有什么比 VSS 6.0/ 2005 将在 20XX 年破产这一事实更令人害怕了。MSDN 站点仍在路线图上运行 2004 年更新 ( [http://msdn.microsoft.com/en-us/library/aa302175.aspx](http://msdn.microsoft.com/en-us/library/aa302175.aspx) )

任何人都可以分享有关 VSS 不支持日期的任何指示吗？

谢谢帕里托什

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-13T11:20:57.897

比过时更好 - 缺少功能和损坏数据库的可能性如何？

您是否曾经通过 VPN 远程使用过 VSS？在这种情况下，我在 VSS 中遇到了可怕的数据损坏问题，而我离这里只有 15 英里！想到还有人在远程设置中使用它，我不寒而栗。

至少，您需要一个使用可靠数据存储（最好是数据库）的源代码控制系统。如果您不想切换到 TFS，请切换到 SourceGear Vault。Vault 作为迁移路径与 VSS 非常相似。

另一方面，TFS 不仅仅是源代码控制。源代码管理只是其功能的开始。它还处理错误跟踪和其他工作项跟踪；允许持续集成和跟踪所有构建，包括跟踪自动化单元测试的成功；执行代码覆盖分析和静态分析（并跟踪结果）。

这真的是苹果和橙子的比较：它们都是水果，长在树上。这就是相似性的终结。

哦，它们都使用相同的路径语法，以美元符号开头。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-13T11:32:25.107

我不知道是否有 VSS 的路线图（即新版本）。但是[这个页面](http://support.microsoft.com/lifecycle/?p1=10433)说 VSS2005 将被支持到 2016 年。

顺便说一句：我知道的 VSS 2005 的最后一次更新似乎是[2005 GDR 包](http://blogs.msdn.com/richardb/archive/2007/06/06/list-of-bugs-fixed-in-sourcesafe-2005-gdr.aspx)，它于 2007 年发布。虽然我在那个时候停止使用 SourceSafe 并切换到颠覆（从那以后再也没有回头）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-13T11:21:51.403

不要引用我的话，但我认为我已经读过标准的 Microsoft 政策是在产品不再销售后继续支持 10 年。

也就是说，我仍然建议您升级到比 VSS 更强大的东西。有很多免费的选择。

**编辑**

从[http://support.microsoft.com/gp/lifepolicy](http://support.microsoft.com/gp/lifepolicy)：

> Microsoft 将为商业和开发人员产品提供至少 10 年的支持。商业和开发产品的主流支持将提供 5 年或后续产品 (N+1) 发布后的 2 年，以较长者为准。Microsoft 还将在主流支持后的 5 年或第二个后续产品 (N+2) 发布后的 2 年内提供扩展支持，以较长者为准。最后，大多数商业和开发产品将获得至少 10 年的在线自助支持。

# r - 使用R查找包含最大值的行索引

> ID：743622
> 
> 赞同：128
> 
> 时间：2009-04-13T11:13:51.627
> 
> 标签：r, matrix

给定以下矩阵，假设我想在第二列中找到最大值：

```
mat <- matrix(c(1:3,7:9,4:6), byrow = T, nc = 3)
mat
     [,1] [,2] [,3]
[1,]    1    2    3
[2,]    7    8    9
[3,]    4    5    6 
```

我知道`max(mat[,2])`会返回 8。如何返回行索引，在这种情况下为第二行？

* * *

## 回答 #1

> 赞同：182
> 
> 时间：2009-04-13T11:44:58.150

看`?which.max`

```
> which.max( matrix[,2] )
[1] 2 
```

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2009-04-13T11:33:40.033

见`?order`。您只需要最后一个索引（或第一个，按降序排列），所以这应该可以解决问题：

```
order(matrix[,2],decreasing=T)[1] 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2015-11-09T17:07:03.910

以下怎么样，其中 y 是矩阵的名称，并且您正在寻找整个矩阵中的最大值：

```
row(y)[y==max(y)] 
```

如果要提取行：

```
y[row(y)[y==max(y)],] # this returns unsorted rows. 
```

要返回已排序的行，请使用：

```
y[sort(row(y)[y==max(y)]),] 
```

这种方法的优点是您可以将内部条件更改为您需要的任何内容。此外，还`col(y)`可以使用悬挂逗号的位置和位置来提取列。

```
y[,col(y)[y==max(y)]] 
```

要查找特定列中最大值的行，例如第 2 列，您可以使用：

```
seq(along=y[,2])[y[,2]==max(y[,2])] 
```

再次，条件是灵活的，以寻找不同的要求。

有关其他想法，请参阅 Phil Spector 出色的“S 和 S-Plus 简介”第 5 章。

# asp.net-mvc - 从 LLBLGen 验证生成客户端验证

> ID：743629
> 
> 赞同：1
> 
> 时间：2009-04-13T11:18:48.383
> 
> 标签：asp.net-mvc, llblgenpro

我一直在寻找，似乎还没有人破解这个问题，但我想我也会问这里的社区，看看有没有什么问题。

有没有办法让客户端验证（jQuery、实时验证等）自动从 LLBLGen 的内置验证中获取验证规则？

LLBLGen（和 Subsonic 等其他人）已经知道字段不能为空，必须少于 100 个字符等，并且不必在所有地方都设置这些似乎很有用。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-13T22:25:34.787

Check out xVal... it generates [jQuery Validation](http://docs.jquery.com/Plugins/Validation) based on validation found in your models.

[xVal @ CodePlex](http://xval.codeplex.com/)

[Introduction to xVal blog post](http://blog.codeville.net/2009/01/10/xval-a-validation-framework-for-aspnet-mvc/)

I don't know how LLBL validation works or if there is any native support for it in xVal. But if there isn't, it would just be a matter of creating an IRulesProvider - no doubt it would come in handy to numerous other LLBL users.

I think something similar was done for the LightSpeed ORM. See here [MVC and LightSpeed – Part 4 – Model Binding](http://www.mindscape.co.nz/staff/jeremy/index.php/2009/03/aspnet-mvc-part4/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-13T14:14:57.633

Jquery.Validate is pretty awsome. It can validate credit card numbers, dates, min and max characters, and many other features. The link is here and it is very simple to use.

[http://docs.jquery.com/Plugins/Validation](http://docs.jquery.com/Plugins/Validation)

Basically all you do is register the .js file when loading up your page and when declaring the class of an input, put in "validate" or "validate date" or whatever and it will intelligently do it for you. Again they give examples and documentation in the link. Hope this helps you.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-13T14:22:04.887

我想说必须创建适当的模板来输出您想要的任何验证代码（或修改现有的）。我不确定是否有任何现有的，但您可以自己创建它们 - 这很容易。

高温高压

# iphone - UITableViewCell 没有得到更新

> ID：743631
> 
> 赞同：0
> 
> 时间：2009-04-13T11:19:40.567
> 
> 标签：iphone, objective-c, cocoa, cocoa-touch

对于表格视图单元格中的每个条目，我需要在右侧有一个按钮，然后是一些文本，然后在左侧需要一个按钮。在按钮单击事件中，我需要更改文本（单击左/右按钮。）并根据文本条件删除任一按钮。我无法使用 cellForRowAtIndexPath 方法删除按钮。我尝试子类化 UITableViewCell 并使用方法 -prepareForReuse 但我无法重置单元格。任何想法我如何实现这一目标？或者有什么方法可以使这个按钮不可见或隐藏？

```
 NSString *CellIdentifier = [[NSString alloc] initWithFormat:@"Cell%d",indexPath.row];
UITableViewCell *cell = [tableView dequeueReusableCellWithIdentifier:CellIdentifier];

if (cell == nil) {
    cell = [[[UITableViewCell alloc] initWithFrame:CGRectZero reuseIdentifier:CellIdentifier] autorelease];
}

[self.tableView clearsContextBeforeDrawing];
NSString *str = [listOfItems objectAtIndex:indexPath.row];

    cell.text = [listOfItems objectAtIndex:indexPath.row];
    cell.textColor = [UIColor blueColor];
    cell.font = [UIFont systemFontOfSize:14];

        UIButton *button = [UIButton buttonWithType:UIButtonTypeRoundedRect];       
        UIImage *image = [UIImage imageNamed:@"Arrow_Right.png"];
        CGRect frame = CGRectMake(290, 5, image.size.width, image.size.height);
        button.frame = frame;   
        [button setBackgroundImage:image forState:UIControlStateNormal];
        button.backgroundColor = [UIColor clearColor];
        [button addTarget:self action:@selector(rightArrow_clicked:) forControlEvents:UIControlEventTouchUpInside];
        [cell addSubview:button];

        UIButton *button1 = [UIButton buttonWithType:UIButtonTypeRoundedRect];      
        UIImage *img = [UIImage imageNamed:@"Arrow_Left.png"];
        CGRect frame1 = CGRectMake(5, 5, img.size.width, img.size.height);
        button1.frame = frame1;
        [button1 setBackgroundImage:img forState:UIControlStateNormal];
        button1.backgroundColor = [UIColor clearColor];
        [button1 addTarget:self action:@selector(leftArrow_clicked:) forControlEvents:UIControlEventTouchUpInside];
        [cell addSubview:button1];

    if([str isEqual:@" abc  "])
        [button setEnabled:NO];
    if([str isEqual:@" pqr "])
        [button1 setEnabled:NO]; 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-13T12:33:48.173

您要做的是子类化 UITableViewCell，并在`init`方法中添加子视图，以便它们只添加一次。

最有可能发生的情况是您正在将子视图添加到可重复使用的单元格中，该单元格上很可能已经有以前使用过的按钮。此外，您可以将按钮设置为“不可见”，如下所示：

```
[button setHidden:YES]; 
```

# iphone - iPhone禁用UIActionSheet按钮

> ID：743636
> 
> 赞同：8
> 
> 时间：2009-04-13T11:24:21.833
> 
> 标签：iphone, objective-c, cocoa-touch, uikit

我想禁用 UIAction 表中的按钮并在某个条件为真后启用它们。我如何实现这一目标？有任何想法吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-12-14T12:07:02.380

我发现克雷格的答案对我不起作用（在 OS 3.1 上）。经过一番挖掘，我发现的子视图`UIActionSheet`实际上是一个**无证类** `UIThreePartButton`

无论如何，这对我有用（作为`UIActionSheetDelegete`方法的一部分实现）

```
- (void)willPresentActionSheet:(UIActionSheet *)actionSheet  // before animation and showing view
{
    for (UIView* view in [actionSheet subviews])
    {
        if ([[[view class] description] isEqualToString:@"UIThreePartButton"])
        {
            if ([view respondsToSelector:@selector(title)])
            {
                NSString* title = [view performSelector:@selector(title)];
                if ([title isEqualToString:@"Button 1"] && [view respondsToSelector:@selector(setEnabled:)])
                {
                    [view performSelector:@selector(setEnabled:) withObject:NO];
                }
            }
        }
    }
} 
```

希望对其他人有所帮助，尽管我会回应 Ed Marty 的问题，即您是否最好完全从操作表中省略这些按钮而不是这样做。与往常一样，在使用未记录的功能时，存在应用商店拒绝的风险，尽管如果 Apple 在未来的操作系统版本中再次更改 API，此代码会优雅地失败。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-13T14:23:26.177

在操作表打开时，是否存在可以更改的情况，这可能导致按钮变为启用状态？如果没有，我认为更好的方法是根据您的情况更改工作表显示的按钮。

否则，处理此问题的唯一方法是遍历工作表的子视图，就像克雷格所说的那样，并寻找`UIButton`对象。不过，我会小心使用按钮的标题，因为标题可以（并且应该！）针对不同的语言进行本地化。因此，与标题的比较并不是那么可靠。由于您没有创建按钮，因此您也不真正知道每个按钮的`tag`or`action`是什么，所以这也有点困难。

`subviews`据推测，按钮将按照您指定的顺序出现在数组`UIActionSheet`中Cocoa Touch SDK 的。因此，我主要担心会因为使用未记录的功能而被 App Store 拒绝。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-12-14T17:31:19.510

UIActionSheet 不适用于自定义。它应该显示实际的可用选项集。它不应该在顶部更改按钮的可用性。只需删除未使用的按钮，或改用自定义视图

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-05-18T23:11:17.690

这可能有点晚了。但是，我想出的方法是创建 UIButton(s) 并将它们添加到 UIActionSheet 子视图。确保将这些按钮放在顶部并完全覆盖要替换的默认 UIActionSheet 按钮。当 UIButton 放置在默认的 UIActionSheet 按钮上时，它的 UIResponder 优先于 UIActionSheet 按钮 UIResponder。因此，这样做您可以禁用和启用这些按钮，但是您希望在 UIViewController 逻辑中的任何位置。这可能是访问 SDK 的私有方法（如上 - UIThreePartButton）的替代方法，并且苹果可能会拒绝您的应用程序。我相信这遵循了 Apple 的指导方针。

即设置 UIButtons 以便在某些条件发生后启用/禁用。

```
// Instantiate once within a method
if (self.actionSheet==nil)  {
    UIActionSheet *as = [[UIActionSheet alloc] 
                         initWithTitle:@""
                         delegate:self 
                         cancelButtonTitle:@"Cancel"
                         destructiveButtonTitle:@"Load Data"
                         otherButtonTitles:@"Update Data",nil];

    //[actionSheet showInView:self.view];
    self.loadUIButton.frame = CGRectMake(24.0f,25.0f,275.f,46.0f);
    [as addSubview: self.loadUIButton];
    self.updateUIButton.frame = CGRectMake(24.0f,78.0f,275.f,46.0f);
    [as addSubview: self.updateUIButton];
    //[actionSheet addSubview: self.cancelUIButton];
    //[as showFromToolbar: self.navigationController.toolbar];
    self.actionSheet = as;
    [as release];
}
[self.actionSheet showFromToolbar: self.navigationController.toolbar]; 
```

注意：这在我之前构建的应用程序中运行良好。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-12-01T07:54:59.220

您可以在 UIActionSheetDelegate 中尝试 [actionSheet valueForKey:@"_buttons"]，如下所示：

```
- (void)willPresentActionSheet:(UIActionSheet *)actionSheet
{
    for (UIButton *btn in [actionSheet valueForKey:@"_buttons"])
    {
        [btn setBackgroundImage:[UIImage imageNamed:@"btnActionSheetUp.png"]     forState:UIControlStateNormal];
        [btn setBackgroundImage:[UIImage imageNamed:@"btnActionSheetDown.png"] forState:UIControlStateHighlighted];
    }
} 
```

希望这在 sdk 的未来版本中不会改变。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-07-06T06:48:53.877

如果您将视图添加到操作表，该视图将不会收到任何事件。您需要查看操作表的超级视图。

请参阅下面我如何添加带有修饰事件的按钮：

```
- (void)didPresentActionSheet:(UIActionSheet *)actionSheet{
CGRect rect = CGRectMake(0,0, 320, 480);
UIButton* anImage = [[UIButton alloc] init];
[anImage setTitle:@"GHello worl" forState:UIControlStateNormal];
[anImage setTitle:@"GHello worl dfasd" forState:UIControlStateHighlighted];
[anImage setTitle:@"GHello worl selected" forState:UIControlStateSelected];
//[anImage setBackgroundImage:[UIImage imageNamed:@"photo.png"] forState:UIControlStateNormal];
[anImage addTarget:self action:@selector(buttonClicked:) forControlEvents:UIControlEventTouchUpInside];
rect = CGRectMake(0,0, 320, 220);
anImage.frame =rect;

[actionSheet.superview addSubview:anImage];

[anImage release]; 
```

}

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-10-18T08:39:38.920

当我有一个根据某些条件更改的操作表时，我遇到了类似的问题。我完全省略了操作表中不适用的选项，但在某些情况下，我最终会得到一个只有一个选项的操作表。这似乎有点傻，因为我可以立即激活该选择而根本不显示工作表。

但是，我还希望用户了解单击屏幕上的某个按钮会给他们一个可供选择的选项列表。这就是为什么我想在只有一个选择的情况下也显示操作表。我想过禁用不适用的选项，而不是从工作表中省略它们，但这也感觉不对。

我的案例与在自定义底栏中有一个用户图标有关，然后按下它会出现以下选择：

*   *如果登录*
    *   **我的简历**
    *   **登出**
*   *如果没有登录*
    *   **登录**

# java - 合并队列条目的好方法

> ID：743637
> 
> 赞同：3
> 
> 时间：2009-04-13T11:24:42.830
> 
> 标签：java, performance, queue

我有一个线程池，它们从队列中获取任务。通常，少量线程能够保持队列为空。偶尔，特别大的突发事件会使队列大小在一段时间内保持在零以上，但不会持续很长时间。

我担心的是重复的事件或携带过时的数据的事件。在高容量期间，此类事件可能会在队列中并存一小段时间。我希望能够将这些混为一谈，这样我就可以减少浪费在工作上的时间。

合并这样一个队列的好方法是什么？我可以在插入时通过从头到尾迭代并搜索要替换的候选者来合并，但这似乎太暴力了。如果您有代码或库建议，请记住我使用的是 Java。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-13T11:44:42.003

为什么不根据您的任务实现 hashCode() 和 equals() 。然后只需删除任务。例如。

```
queue.remove(task);
queue.offer(task); 
```

那么你将不会有重复。或者。

```
if(!queue.contains(task)) {
   queue.offer(task);
} 
```

如果它已经在队列中，这将避免将任务排队。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-13T21:09:07.403

如果使用[`LinkedHashMap`](http://java.sun.com/javase/6/docs/api/java/util/LinkedHashMap.html)，则可以保留条目添加到队列中的顺序。

当匹配条目到达时，我推测您希望将其一些数据附加到原始队列条目。在这种情况下，您可以就地更新散列对象，或者使用[`HashMap.put(key, value)`](http://java.sun.com/j2se/1.4.2/docs/api/java/util/HashMap.html#put(java.lang.Object,%20java.lang.Object))新对象替换排队的项目。（我**认为**这保留了原始项目的顺序，但我没有对此进行测试。）

`LinkedHashMap`请注意，您的代码将需要显式同步对其内部数据的读写访问。您不希望在另一个线程抓取它进行处理的同时更新队列中的项目。最简单的同步方法可能是通过`LinkedHashMap`访问`Collections.synchronizedMap()`.

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2016-10-14T07:06:00.987

这个 conflator 似乎可以满足您的需求： [https ://github.com/GuillaumeArnaud/conflator](https://github.com/GuillaumeArnaud/conflator)

根据您的要求，如果合并队列中存在一个现有事件，则可以将实现更改为合并或用现有事件替换最新事件。

例如。对于以下内容，每个事件都被实现为一个“Tick”，它定义了合并行为。

```
public class Tick implements Message<Tick> {

    private final String ticker;

    public long getInitialQuantity() {
        return initialQuantity;
    }

    private final long initialQuantity;

    public long getCurrentQuantity() {
        return currentQuantity;
    }

    private long currentQuantity;
    private int numberOfMerges;

    public String getTicker() {
        return ticker;
    }

    public Tick(String ticker, long quantity) {
        this.ticker = ticker;
        this.initialQuantity = quantity;
        this.currentQuantity = quantity;
    }

    @Override
    public String key() {
        return this.ticker;
    }

    @Override
    public String body() {
        return String.valueOf(currentQuantity);
    }

    @Override
    public boolean isMerged() {
        return this.initialQuantity != this.currentQuantity;
    }

    @Override
    public int mergesCount() {
        return numberOfMerges;
    }

    @Override
    public boolean isValid() {
        return false;
    }

    @Override
    public boolean merge(Tick message) {
        if (this.equals(message)) {
            this.currentQuantity += message.currentQuantity;
            numberOfMerges++;
            return true;
        }
        return false;
    }

    @Override
    public int hashCode() {
        return ticker.hashCode();
    }

    @Override
    public boolean equals(Object obj) {
        if (obj != null && obj instanceof Tick) {
            Tick other = (Tick) obj;
            return this.ticker.equals(other.getTicker());
        }
        return false;
    } 
```

测试用例：

```
public class TickMergeTest {
    MultiValuedMapConflator conflator;

    @Test
    public void two_unmergeable_ticks_should_be_remain_unmergeable() {
        Tick tick1 = new Tick("GOOG", 100L);
        Tick tick2 = new Tick("AAPL", 120L);

        List<Tick> messages = conflator.merge(Lists.newArrayList(tick1, tick2));

        assertNotNull(messages);
        assertEquals(messages.size(), 2);
        assertEquals(Long.valueOf(messages.get(0).body()).longValue(), tick1.getCurrentQuantity());
        assertEquals(Long.valueOf(messages.get(1).body()).longValue(), tick2.getCurrentQuantity());
    }

    @Test(timeout = 1000)
    public void two_mergeable_ticks_should_be_merged() {
        Tick tick1 = new Tick("GOOG", 100L);
        Tick tick2 = new Tick("GOOG", 120L);

        List<Tick> messages = conflator.merge(Lists.newArrayList(tick1, tick2));

        assertNotNull(messages);
        assertEquals(messages.size(), 1);
        assertEquals(Long.valueOf(messages.get(0).body()).longValue(), tick1.getInitialQuantity() + tick2.getInitialQuantity());
    }

    @Test(timeout = 1000)
    public void should_merge_messages_on_same_key() throws InterruptedException {
        // given
        conflator.put(new Tick("GOOG", 100L));
        conflator.put(new Tick("GOOG", 120L));

        // test
        Thread.sleep(300); // waiting the conflation
        Message message = conflator.take();

        // check
        assertNotNull(message);
        assertEquals(Long.valueOf(message.body()).longValue(), 220L);
        assertTrue(message.isMerged());
    }

    @Test(timeout = 1000)
    public void should_not_merge_messages_on_diff_key() throws InterruptedException {
        // given
        conflator.put(new Tick("GOOG", 100L));
        conflator.put(new Tick("AAPL", 120L));

        // test
        Thread.sleep(300); // waiting the conflation
        Message message1 = conflator.take();
        Message message2 = conflator.take();

        // check
        assertNotNull(message1);
        assertNotNull(message2);

        assertEquals(Long.valueOf(message1.body()).longValue(), 100L);
        assertFalse(message1.isMerged());

        assertEquals(Long.valueOf(message2.body()).longValue(), 120L);
        assertFalse(message2.isMerged());

    }
    @Before
    public void setUp() {
        conflator = new MultiValuedMapConflator<Tick>(true);
    }

    @After
    public void tearDown() {
        conflator.stop();
    }
} 
```

# c - Windows平台如何用C语言实现ping请求？

> ID：743647
> 
> 赞同：2
> 
> 时间：2009-04-13T11:34:26.460
> 
> 标签：c

我想用 C 语言实现 ping 请求。我在 Windows 平台上工作。任何人都可以建议如何实现它，或者如果代码已经可用，那么我可以从哪里找到它？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-13T12:11:36.213

非常有用和开源 - [fping](http://fping.sourceforge.net/)。

> fping 是一个类似 ping(1) 的程序，它使用 Internet 控制消息协议 (ICMP) 回显请求来确定主机是否已启动。fping 与 ping 的不同之处在于您可以在命令行上指定任意数量的主机，或者指定一个包含要 ping 的主机列表的文件。fping 不会尝试一个主机直到它超时或回复，而是发送一个 ping 数据包并以循环方式移动到下一个主机。如果主机回复，则将其记录并从要检查的主机列表中删除。如果主机在特定时间限制和/或重试限制内没有响应，它将被视为无法访问。
> 
> 与 ping 不同，fping 旨在用于脚本，其输出易于解析。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-13T11:41:04.197

您可以使用 system() 来运行命令行指令。所以像

```
system("ping 127.0.0.1") 
```

应该管用。

# git - 如何将远程非裸仓库转换为裸仓库，而无需在 git 的本地机器中重新克隆？

> ID：743648
> 
> 赞同：1
> 
> 时间：2009-04-13T11:34:51.060
> 
> 标签：git

我有一台远程机器 RemoteMachine，其中包含另一个 MachineWeNotConcern 的克隆：

```
git clone MachineWeNotConcern/prj prj 
```

我的本地机器克隆是这样的：

```
git clone RemoteMachine/prj local_prj 
```

现在我想让 RemoteMachine 的 repos 裸露（如何？），就好像我检查过：

```
git clone --bare MachineWeNotConcern/prj prj 
```

而且我不想从 RemoteMachine 的裸存储库中重新克隆，因为它总是需要很多时间。

我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-13T12:12:14.653

您可以使用 --bare 从项目*远程计算机上的本地存储库中创建一个新克隆。*IE：

```
git clone --bare prj bare_prj 
```

然后删除原来的prj。这比再次从原始机器克隆它要快。

编辑：另一种解决方案：

看起来您可以通过以下方式将您的回购变成一个裸回购：

*   将 .git/config 文件更改为 bare = true 而不是 bare = false
*   除去 .git 文件以外的 prj/* 的内容
*   将 .git 目录内容移动到 prj/ 并删除 .git 目录

至少，这似乎对我有用，但据我所知，这可能会失败。

# linq - LINQ SQL 查询检查对象字段是否不为空

> ID：743649
> 
> 赞同：8
> 
> 时间：2009-04-13T11:35:29.280
> 
> 标签：linq

我正在尝试编写一个 SQL 查询，该查询按输入的字段过滤网格视图。有四个字段，title、firstname、surname 和 Company.Name。

前三个很好，因为它们永远不会为空，但第四个可以为空。以下 LINQ 查询可以正常工作：

```
var listofclients = from client in allcients
                    where client.Title.ToLower().Contains(titletxtbox.Text.Trim().ToLower())
                    where client.Firstname.ToLower().Contains(firstnametxtbox.Text.Trim().ToLower())
                    where client.Surname.ToLower().Contains(surnametxtbox.Text.Trim().ToLower())
                    orderby client.Name 
```

但是当我尝试为公司添加过滤器时，当公司为空时，我会在运行时收到错误

```
var listofclients = from client in allcients
                    where client.Title.ToLower().Contains(titletxtbox.Text.Trim().ToLower())
                    where client.Firstname.ToLower().Contains(firstnametxtbox.Text.Trim().ToLower())
                    where client.Surname.ToLower().Contains(surnametxtbox.Text.Trim().ToLower())
                    where client.Company.Name.ToLower().Contains(companynametxtbox.Text.Trim().ToLower())
                    orderby client.Name 
```

我想知道的是，有没有一种方法可以构建查询，以便仅在 client.Company 字段不为空时进行过滤。

当我直接从这样的文本框字段中提取时，我也容易受到 SQL 注入等的攻击。我知道在这种情况下它没有连接到数据库，但如果是的话，他们可以做一个下降。或者即使它没有连接到数据库，他们可以摆弄列表中的对象吗？

谢谢

乔恩·霍金斯

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-13T11:49:47.123

我假设您想要 Company 为空但在 Company 存在时按名称过滤的所有匹配记录。以下应该做到这一点。此外，您不必担心 SQL 注入，因为 LINQToSQL 使用参数化查询。如果您打算从客户端控件中插入并在 Web 上显示任何值以避免 XSS 攻击，您将不得不担心清理客户端控件中可能存在的任何 HTML。

```
var listofclients = from client in allcients
                    where client.Title.ToLower().Contains(titletxtbox.Text.Trim().ToLower())
                    where client.Firstname.ToLower().Contains(firstnametxtbox.Text.Trim().ToLower())
                    where client.Surname.ToLower().Contains(surnametxtbox.Text.Trim().ToLower())
                    where client.Company == null || client.Company.Name.ToLower().Contains(companynametxtbox.Text.Trim().ToLower())
                    orderby client.Name 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-13T11:41:55.287

```
var listofclients = from client in allcients
                    orderby client.Name
                    select client;

if (string.IsNullOrEmpty(titletxtbox.Text))
listofclients = listofclients.Where(l=>l.Title.Contains(titletxtbox.Text)) 
```

...........

像这样的东西

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-13T11:44:28.477

1) Linq to Sql 在其查询中使用参数，因此不易受到 sql 注入的影响。但是，永远不要相信用户输入。

2) Linq 不提供免费的空值检查，抱歉。您可以使用简单的扩展方法来完成此操作，以保持您的 linq 查询修剪和适合：

```
public static class StringExtensions
{
  public static bool ContainsEx(this string me, string other)
  {
    if(me == null || other == null) return false;
    // This is a better way of performing a case-insensitive Contains
    return me.IndexOf(other, 0, StringComparison.OrdinalIgnoreCase) != -1;
  }
} 
```

# actionscript-3 - AS3问题中的禁用按钮

> ID：743651
> 
> 赞同：0
> 
> 时间：2009-04-13T11:35:59.090
> 
> 标签：actionscript-3, button

我想动态地在 Flash 中制作一个简单的选项卡菜单，并且我只想在开始使用我的应用程序时启用第一个选项卡 - 其他选项卡将在以后启用。但是，导出电影后，选项卡不可点击（光标不会显示为手形），但是当我单击其中一个时，它的代码会启动。问题可能出在哪里？这是我的代码（到目前为止我只有两个选项卡）：

```
var shieldTab = new Tab("Shield", "shieldMenu", 590,120);
this.addChild(shieldTab);
mainMenu.push(shieldTab);
var orderTab = new Tab("Order", "orderMenu", 590+shieldTab.width, 120);
this.addChild(orderTab);
mainMenu.push(orderTab);

for each (var tab:SimpleButton in mainMenu){
    tab.addEventListener(MouseEvent.CLICK, showMenu);
}

this.orderTab.enabled = false; 
```

这是 Tab 类：

```
package coa.application{
    import flash.display.SimpleButton;
    import flash.text.*;

    public class Tab extends SimpleButton {

        public var menuType:String;

        public function Tab(tabText:String, menuType:String, x:Number, y:Number) {
            this.menuType=menuType;
            var mytext:TextField=new TextField();
            var fm:TextFormat = new TextFormat("Verdana", 18);
            mytext.autoSize = TextFieldAutoSize.CENTER;
            mytext.text=tabText;
            mytext.border = true;
            mytext.selectable = false;
            mytext.background = true;
            mytext.setTextFormat(fm);
            upState = overState = downState = hitTestState = mytext;
            this.x=x;
            this.y=y;

        }
    }
} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-13T11:48:23.883

我认为没有“启用”属性。您是否尝试过将 mouseEnabled 设置为 false。甚至更好。在您的选项卡类上创建一个启用的属性，然后在 showMenu 中检查它。然后，如果未启用选项卡，您可以忽略单击。

# javascript - 如何在可滚动的 div 中冻结 html 表格的第一列和最后一列？

> ID：743663
> 
> 赞同：13
> 
> 时间：2009-04-13T11:44:54.703
> 
> 标签：javascript, html, layout, html-table

我有一个表，它有一个标题行，还有一个标题列和一个总列，中间有几列。

像这样的东西：

```
Name    Score 1    Score 2  ...  Total
--------------------------------------
John       5          6            86
Will       3          7            82
Nick       7          1            74 
```

整个表格定义在一个固定宽度的可滚动 div 内，因为可能有大量的“分数”行，而且我有一个固定宽度的页面布局。

```
<div id="tableWrapper" style="overflow-x: auto; width: 500px;">
    <table id="scoreTable">
        ...
    </table>
</div> 
```

我想要的是第一 ( `Name`) 和最后 ( `Total`) 列在内部列滚动时保持可见。

谁能帮我这个？

**编辑：**我的意思是仅水平滚动 - 更改为指定。

* * *

**更新：**我已经为自己解决了这个问题，并在下面发布了答案。如果您需要更多信息，请告诉我 - 这有点痛苦，我讨厌其他人必须重写所有内容。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-13T12:39:18.270

我可以提出一个有点非正统的解决方案吗？

如果将“total”列放在“name”列之后，而不是放在最后，您会怎么想？这不会避免只滚动表格的一部分的要求吗？

这并不完全是您所要求的，但也许它是一个足够的解决方案，因为替代方案会非常混乱。（例如，将 'total' 和 'name' 列放在表格之外，当并非所有行的高度都相同时，会产生对齐问题。您可以使用 javascript 更正此问题，但随后您将进入一个全新的世界痛）。

同样从 UI 的角度来看，“名称”和“总数”可能是最重要的数据，在这种情况下，将它们放在一起是有意义的，然后是总数的“细分”。当然，我们似乎有一种直觉，即“总数”应该放在其组成部分之后，但我认为如果像这样颠倒顺序不会给用户造成太大的困惑（尽管这是一个问题您，基于您的产品和用户）。

无论如何，要考虑的事情。

编辑：

这里有一些更非正统的解决方案，现在我想我更好地理解了你的意图：

1.  对分数进行分页。给出最近的十个，比如说，总数，以及一个指向旧分数的链接，一次提供 10 个
2.  只给出名称、总数和其他一些有意义的度量，例如 mean 和 sd，然后为每个名称提供一个链接，显示与该名称对应的所有结果。然后，您还可以提供一个链接，显示给定分数集的所有结果，以便可以在不同用户之间进行比较。关键是您只需为每个视图提供 1 维数据，而不是拥有笨重的 2D 数据集
3.  使行可排序（使用 jQuery UI 很容易），这样如果我想比较 Mary 和 Jane，我可以一个接一个地拖动和放置，所以我不需要继续左右滚动来查看哪些分数对应于哪些名字
4.  单击时突出显示一行，通过更改背景颜色或类似颜色再次突出显示，因此我不需要继续左右滚动。

无论如何，你明白了。也许寻找一个 UI 解决方案比一个扭曲的标记解决方案更好。最终，我会质疑一次向用户呈现如此多数据的重要性，以至于其中的一部分需要以特定方式滚动才能使数据可读。也许您正在构建一个电子表格应用程序，并且您确实需要在单个视图中显示一个 100x100 矩阵。如果没有，你肯定能想出比我分解结果更有创意的方法。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2011-01-04T15:42:39.270

看看这个 jQuery 插件：

[http://fixedheadertable.com/](http://fixedheadertable.com/)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-13T11:54:42.307

我假设您只想水平滚动它。否则它可能会与静态列混淆。

您可以将 overflow: auto 仅放在内部表格单元格的包含元素上...我不确定浏览器将如何处理此问题，但是您可以将要修复的元素放在 thead 和 tfoot 元素中，并且将滚动部分放在 tbody 元素中，并将其溢出设置为自动。

如果做不到这一点，您可能需要删除语义并在表外对左列和右列进行编码。

就个人而言，我会尝试尽可能将其编码为语义，然后使用 JavaScript 来定位左右列。如果没有 JavaScript，你应该让它优雅地失败到一个宽表（不确定这会有多困难，因为你说你有一个固定的宽度）

您可以尝试这个（粗略的）jQuery 示例将第一列的值放在外面。

```
var nameTable = '<table id="outside-name-col">
                  <thead>
                   <tr>
                    <th>Name</th>
                   </tr>
                  </thead>
                 <tbody>'; // start making a table for name column only

$('#scoreTable tbody tr').each(function() { // iterate through existing table

   var nameCol = $(this).find(':first'); // get column of index 0, i.e. first

   var cellHeight = nameCol.height(); // get the height of this cell

   $(this).find('td').height(cellHeight); // equalise the height across the row so removing this element will not collapse the height if it is taller than the scores and total       

   nameTable += '<tr><td style="height: ' + cellHeight + 'px">' + nameCol.html() + '</td></tr>'; // append the next row with new height and data

   nameCol.remove(); // remove this cell from the table now it's been placed outside

});

nameTable += '</tbody></table>'; // finish table string

$('#scoreTable').before(nameTable); // insert just before the score table 
```

使用 CSS 定位它们以正确对齐。这是未经测试的，但它应该给你一些想法。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-13T13:21:24.907

它现在还不完整（我只是很快地模拟了它），但这里有一种使用直接 HTML 的方法。您需要三个表... <div> 之外的两个表和 <div> 内的一个表。所有三个都向左浮动，因此它们都在同一条线上。

[表测试](http://52colony.rh.rit.edu/websites/tableTest.htm)

和代码本身：

```
 <table style="float: left;">
     <tr>
        <td>Name</td>
     </tr>
     <tr>
        <td>John</td>
     </tr>
     <tr>
        <td>Will</td>
     </tr>
  </table>
  <div id="tableWrapper" style="overflow-x: auto; width: 500px;float:left;padding-bottom: 10px;">
      <table>
        <tr>
           <td>Score1</td>
           <td>Score2</td>
           ...
        </tr>
        <tr>
           <td>5</td>
           <td>6</td>
           ...
        </tr>
        <tr>
           <td>3</td>
           <td>7</td>
           ...
        </tr>
        <tr>
           <td>7</td>
           <td>1</td>
           ...
        </tr>
      </table>
  </div>
  <table style="float: left;">
     <tr>
        <td>Total</td>
     </tr>
     <tr>
        <td>86</td>
     </tr>
     <tr>
        <td>82</td>
     </tr>
  </table> 
```

注意：div 上的 padding-bottom 是为了让滚动条不会覆盖 IE 中的表格。此外，我必须解决的错误是如何指定中间表中标题元素的宽度。由于某种原因，指定 width="" 属性不起作用。因此，如果 header 元素的文本太宽（并中断到另一行），则布局被中断（关闭一行）

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-09-22T07:21:26.617

我已经尝试了一些方法（感谢所有提供帮助的人），这就是我使用 jQuery 提出的方法。它似乎在我测试的所有浏览器中都运行良好。随意拿走它并随心所欲地使用它。对我来说，下一步将把它变成一个可重用的 jQuery 插件。

## 概括：

我从一个包含所有内容的普通表开始（*Id="ladderTable"*），然后我编写了**三种方法**- 一个去除第一列，一个去除最后一列，一个固定行高。

stripFirstColumn方法创建一个新表（*Id="nameTable"* *）*，遍历原始表并取出第一列，并将这些单元格添加到 nameTable。

 *stripLastColumn方法基本上*做*同样的事情，除了它取出最后一列并将单元格添加到一个名为*totalTable*的新表中。

fixHeights方法*查看*每个表中的每一行，计算最大高度，并将其应用于相关表。

在文档就绪事件中，我按顺序调用了所有三个方法。请注意，所有三个表都向左浮动，因此它们只会水平堆叠。

## HTML结构：

```
<h1>Current Ladder</h1> 
<div id="nameTableSpan" style="float:left;width:100px;border-right:2px solid gray;"></div> 
<div id="ladderDiv" style="float:left;width:423px;overflow:auto;border:1px solid gray;margin-top:-1px;"> 
    <table id="ladderTable" class="ladderTable">
        <thead> 
            <tr><td>Name</td><td>Round 1</td> ... <td>Round 50</td><td class="scoreTotal">Total</td></tr>
        </thead>
        <tr><td>Bob</td><td>11</td> ... <td>75</td><td>421</td></tr>
           ... (more scores)
    </table>
</div>
<div id="totalTableSpan" style="float:left;width:70px;border-left:2px solid gray;"></div> 
```

## jQuery：

```
function stripFirstColumn() {                
    // pull out first column:
    var nt = $('<table id="nameTable" cellpadding="3" cellspacing="0" style="width:100px;"></table>');
    $('#ladderTable tr').each(function(i)
    {
        nt.append('<tr><td style="color:'+$(this).children('td:first').css('color')+'">'+$(this).children('td:first').html()+'</td></tr>');
    });
    nt.appendTo('#nameTableSpan');
    // remove original first column
    $('#ladderTable tr').each(function(i)
    {
        $(this).children('td:first').remove();
    });
    $('#nameTable td:first').css('background-color','#8DB4B7');
}

function stripLastColumn() {                
    // pull out last column:
    var nt = $('<table id="totalTable" cellpadding="3" cellspacing="0" style="width:70px;"></table>');
    $('#ladderTable tr').each(function(i)
    {
        nt.append('<tr><td style="color:'+$(this).children('td:last').css('color')+'">'+$(this).children('td:last').html()+'</td></tr>');
    });
    nt.appendTo('#totalTableSpan');
    // remove original last column
    $('#ladderTable tr').each(function(i)
    {
        $(this).children('td:last').remove();
    });
    $('#totalTable td:first').css('background-color','#8DB4B7');
}

function fixHeights() {
    // change heights:
    var curRow = 1;
    $('#ladderTable tr').each(function(i){
        // get heights
        var c1 = $('#nameTable tr:nth-child('+curRow+')').height();    // column 1
        var c2 = $(this).height();    // column 2
        var c3 = $('#totalTable tr:nth-child('+curRow+')').height();    // column 3
        var maxHeight = Math.max(c1, Math.max(c2, c3));

        //$('#log').append('Row '+curRow+' c1=' + c1 +' c2=' + c2 +' c3=' + c3 +'  max height = '+maxHeight+'<br/>');

        // set heights
        //$('#nameTable tr:nth-child('+curRow+')').height(maxHeight);
        $('#nameTable tr:nth-child('+curRow+') td:first').height(maxHeight);
        //$('#log').append('NameTable: '+$('#nameTable tr:nth-child('+curRow+')').height()+'<br/>');
        //$(this).height(maxHeight);
        $(this).children('td:first').height(maxHeight);
        //$('#log').append('MainTable: '+$(this).height()+'<br/>');
        //$('#totalTable tr:nth-child('+curRow+')').height(maxHeight);
        $('#totalTable tr:nth-child('+curRow+') td:first').height(maxHeight);
        //$('#log').append('TotalTable: '+$('#totalTable tr:nth-child('+curRow+')').height()+'<br/>');

        curRow++;
    });

    if ($.browser.msie)
        $('#ladderDiv').height($('#ladderDiv').height()+18);
}

$(document).ready(function() {
    stripFirstColumn();
    stripLastColumn();
    fixHeights();
    $("#ladderDiv").attr('scrollLeft', $("#ladderDiv").attr('scrollWidth'));    // scroll to the last round
}); 
```

如果您有任何问题或有任何不清楚的地方，我很乐意为您提供帮助。

我花了很长时间才弄清楚没有什么可以真正重用，而且写这篇文章也花了更长的时间。我讨厌有人遇到同样的麻烦。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-13T11:51:11.677

你的意思是水平滚动？

如果要实现水平滚动，则可以使用 3 个容器。

1.  对于第一列（名称）
2.  对于要滚动的列。将此容器的overflow-x样式设置为auto
3.  最后一列（总计）

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-13T12:53:38.530

滚动表格的内容是一个有问题的问题，因为没有简单且浏览器安全的解决方案来实现这一点。

最好和最安全的方法需要 JavaScript。使用我使用的这种技术，您甚至可以轻松实现水平滚动（它是免费提供的）。您可以轻松地将其转换为您的问题：

1）我做了3张桌子

2) 将包含数据的中间表放置在 DIV 容器内

3）设置DIV样式溢出：自动

4) 为页眉和页脚表以及 div 分别设置了 100% 的宽度

5）用另一个div包围所有东西来控制整个表格的宽度

6) 确保所有三个表格中的列数都匹配，并且所有三个表格在填充、边距和边框方面都具有相同的样式

现在有趣的部分：

6）在该表结构的最后一个元素下方，编写一个javascript块（或从文件中包含它）

7) 编写一个函数，从第一列开始依次查看每一列（使用 for 循环）。在该循环的每次迭代中，检查当前列中前两个表的 td 单元格。检查哪个 with 较大，并将其分配给较小的 td 单元格的样式。您可能还想将该值应用于页脚表。

8）调用该函数。您可能希望在一段时间内或发生特殊事件时执行此操作，例如单元格中的新数据（例如，如果使用 ajax）。

注意：如果您确实水平滚动，您的列大小是同步的。但是您必须将页眉和页脚表的滚动位置与内容表同步。或者，您只需让整个 div 水平滚动整个内容，而不是垂直滚动。那将是包含数据表的 DIV 的工作。

在一个非常复杂的甘特图项目中，这种技术在所有主要浏览器中都非常有效。

注意：您可以以 90 度旋转的方式轻松想到该概念，以便在滚动时固定第一个和最后一个标题列。

编辑：这是我的代码库中的另一个示例，可能会帮助您获得解决方案：

```
var left_td = document.getElementById("left_td");
var right_td = document.getElementById("right_td");
var contentDiv = document.getElementById("contentDiv");
window.setInterval(function(){
    var left_td_width = Math.round((parseInt(contentDIV.offsetWidth) - 120) / 2);
    var right_td_width = (parseInt(contentDIV.offsetWidth) - left_td_width - 120;

    left_td.style.width = left_td_width + "px";
    right_td.style.width = right_td_width + "px";
}, 25); 
```

此代码执行以下操作：它确保具有 3 列的表始终如下所示：第一列和最后一列具有相同的大小，并且中心列的宽度为 120 像素。当然，这并不直接适用于您的特殊问题，但它可能会为您提供通过 JavaScript 进行动态表操作的起点。

# email - 使用 sendmail 查看“已发送邮件”

> ID：743667
> 
> 赞同：0
> 
> 时间：2009-04-13T11:47:23.353
> 
> 标签：email, smtp, sendmail

我有一个通过 sendmail 中继来发送电子邮件的应用程序。

我可以查看过去发送的邮件吗？它们是否保存在某个地方，也许在日志中。我不一定需要完整的电子邮件、正文、附件等。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-13T11:50:33.160

sendmail 确实提供了将服务上发出的每个操作记录到文件的能力，因此您可以检查系统上的 sendmail 版本是否确实这样做。如果我没记错的话（已经有一段时间了），它会记录谁（unix 用户）向谁发送了什么。

# c++ - C/C++ 中的内联函数是一种使它们成为线程安全的方法吗？

> ID：743669
> 
> 赞同：6
> 
> 时间：2009-04-13T11:48:39.013
> 
> 标签：c++, c, multithreading, thread-safety

我做出以下推理，请告诉我它的错误（或正确）：

“如果内联函数在调用函数的地方复制了代码，那么静态变量和局部变量对于调用它的每个函数都会复制，并且如果只有一个线程在运行同时调用内联函数的函数，那么代码是线程安全的”。

“而且，如果它对静态和全局变量没有帮助，那么它对创建临时变量的代码有帮助吗？”

谢谢

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-04-13T11:50:05.720

不，你错了。对于静态变量，无论是否内联，实际上只有一个实例。内联函数对线程安全没有任何影响，无论哪种方式。

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2009-04-13T11:54:02.870

当您将函数声明为内联时，它只是对编译器的提示。静态变量在语言中有明确的定义。如果编译器确实内联函数，它仍然有义务在函数的所有实例之间保持静态变量共享。因此，它们将保持全球性，并且必须在 MT 环境中受到保护。

至于局部变量，除非它们在函数外部使用，否则无论函数是否内联，它们都是线程安全的。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-04-13T11:55:09.920

每个线程都有自己的本地对象副本，因此无论您是否将其设为内联，它们都不会出现任何与线程相关的问题。

但是，如果您正在访问类的静态变量或成员变量，则与多线程相关的所有问题（损坏变量、丢失更新......）仍然存在，无论它是否是内联的。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-06-09T17:58:51.957

内联和线程安全是正交的，即不相关的概念。

考虑这些函数：

```
int 阶乘（const int n）
{
  如果 (n <= 1)
  {
    返回 1；
  }

  返回阶乘（n - 1）；
}

```

这个函数不能被内联，因为它是递归的，但它是完全线程安全的。

```
int factorial_2(int n)
{
  整数结果 = 1;

  而 (n > 1)
  {
    结果 *= n--;
  }

  返回结果；
}

```

这个函数可以被编译器内联，并且仍然是完全线程安全的。

```
整数引用计数；

无效的 DecRef()
{
  --引用计数；
}

```

无论编译器是否内联它，这个函数都不是线程安全的。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-13T11:52:12.813

有（或者可能*有*）错误的编译器为包含函数的每个内联复制静态变量。这不是预期的行为。

使用符合标准的编译器，无论内联如何，都可以保证每个静态变量都有一个实例，并且必须自己处理线程安全。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-04-13T15:27:39.067

[线程安全](http://en.wikipedia.org/wiki/Thread_safety)与内联无关。仅仅因为每个线程都执行相同代码的副本并不能保证访问共享数据的安全。在开始多线程编程之前，请务必阅读[线程安全。](http://en.wikipedia.org/wiki/Thread_safety)

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-04-13T15:49:22.180

如果我是你，我不会在内联函数中使用静态变量。旧版本的 C++ 标准要求与当前版本不同的含义。

注意：历史答案。今天没用。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2012-07-12T12:27:28.527

以前版本的 C++（和当前版本的 C）不承认线程的概念。它只是不是标准的一部分。所以依靠一些编译器优化来使你的代码线程安全并不是一个好主意。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-04-13T12:28:46.423

内联对函数是否是线程安全的没有影响。例如：

```
inline void doTheThing()
{
   int a = 42; // this is thread safe, but it would be anyway
   vector<int> * answers = getTheAnswers(); // this is not thread safe
} 
```

对 getTheAnswers() 指向的向量的访问不是线程安全的，因为没有代码阻止任何其他线程执行代码。使函数内联不会阻止 doTheThing() 被多个线程同时调用。为了使 doTheThing() 线程安全，您需要确保它不会被并行调用，或者您访问的任何共享（非本地）数据都受到保护。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-04-13T17:12:25.773

一点也不。

为了线程安全，函数需要对函数的任何实例（包括它自己）都是线程安全的；多个线程可以同时执行内联函数的同一个实例。

因此，即使编译器执行了您的建议（正如其他人所说，它不应该这样做），这仍然不会使其成为线程安全的。

* * *

## 回答 #11

> 赞同：-3
> 
> 时间：2009-04-14T01:44:05.760

（普通和内联）函数中的所有静态变量都进入堆。堆**不是线程安全**的。

# java - Hibernate：我是否需要编写一个单独的 POJO 来从一个现有表中检索数据？

> ID：743674
> 
> 赞同：2
> 
> 时间：2009-04-13T11:50:13.287
> 
> 标签：java, hibernate, pojo

我正在使用休眠。

我的主应用程序有一些现有的表，我想将它们用于可选功能。现在我需要从一个现有表中检索数据并处理该数据。我需要为这个表写一个单独的 POJO 吗？我只想要这些表的 2 列。

数据库的所有表是否也需要与 POJO 进行映射？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-13T12:01:20.387

您只需为要使用的表编写 POJO。如果一个表通过外键连接到另一个表，那么您需要同时包含两者。这没什么大不了的——您可以使用[Hibernate Tools](http://tools.hibernate.org/)为您完成这项工作。对于现有数据库，他们可以创建所需的 Java 和 xml 配置文件。如果您刚开始使用 Hibernate，这是理想的。自动生成文件，然后查阅它们以了解如何编写自己的文件。

在单个表中，您可以省略一些列，如果您不需要它们。但是，您需要包括主键和外键。一般来说，我建议始终映射所有列。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-13T17:21:15.937

简短的回答——是的。

有一些创造性的方法可以尝试创建一个对象，但是从一个好的设计和 Hibernate 最佳实践的角度来看，你确实想要继续编写这个小类。听起来它是一个非常小的类（空构造函数、两个字段、两个 setter/getter）。继续编写该类将使处理该信息的代码更清晰。继续写这门课绝对符合你自己的最大利益。

即使您根本不打算使用 Hibernate，编写一个类仍然是一个好主意。一行数据，无论是逗号分隔的列表还是数据库，都是数据的基本单位，这样处理会提高代码的可读性。

# c# - WCF 错误通信对象 System.ServiceModel.Channels.ServiceChanne 无法用于通信，因为它处于故障状态

> ID：743675
> 
> 赞同：11
> 
> 时间：2009-04-13T11:50:14.143
> 
> 标签：c#, wcf

我们得到

“通信对象 System.ServiceModel.Channels.ServiceChannel 无法用于通信，因为它处于故障状态。”

当我们关闭应用程序时的消息。谁能告诉我如何解决它？我们知道这是试图关闭的通信通道，但由于服务不可用或处于故障状态而无法关闭。

我只能说，当服务不可用，但垃圾收集器试图销毁对象时，通信对象正在调用其服务关闭函数。我们得到异常。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-13T12:03:43.363

当您询问有关异常的问题时，您应该发布整个异常，包括所有 InnerException 实例。您应该捕获异常，显示 ex.ToString()，然后用“throw”重新抛出异常：

```
try {
    // Do whatever causes the exception
} catch (Exception ex) {
    Console.WriteLine(ex.ToString());  // Or Debug.Print, or whatever
    throw; // So exception propagation will continue
} 
```

在这种情况下，我想知道您的代理实例周围是否有*using块：*

```
using (var proxy = new WcfProxyClient())
{
    // Use of proxy
} 
```

WCF 中存在一个设计缺陷，这使得它成为 .NET 中唯一不应该使用*using*块的地方。相反，您需要手动完成。参见[http://web.archive.org/web/20100703123454/http://old.iserviceorientated.com/blog/post/Indisposable+-+WCF+Gotcha+1.aspx](http://web.archive.org/web/20100703123454/http://old.iserviceoriented.com/blog/post/Indisposable+-+WCF+Gotcha+1.aspx)。

Also, see "[What is the best workaround for the WCF client `using` block issue?](https://stackoverflow.com/questions/573872/what-is-the-best-workaround-for-the-wcf-client-using-block-issue)" and "[Indisposable WCF clients](http://thorarin.net/blog/post/2010/05/30/Indisposable-WCF-clients.aspx)".

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-13T11:57:11.117

看看[这里](http://www.dasblonde.net/2008/04/24/MyProxyWrapperAndTheEVILSUOFile.aspx)的代理项目。

我们遇到了类似的问题，这种技术解决了它。它基本上涉及从一个类继承，如果它出现故障，它将自动重新创建通道。

# scripting - 反编译 Lua 字节码的最佳工具？

> ID：743684
> 
> 赞同：14
> 
> 时间：2009-04-13T11:53:47.800
> 
> 标签：scripting, lua, bytecode, decompiling

我真的很难找到一个好的工作 Lua 字节码反编译器。我正在尝试反编译我在游戏中找到的一些脚本文件，但它们似乎已被编译，但似乎并非不可能解码。什么是反编译 Lua 二进制文件的最佳工具？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-13T20:55:27.123

看起来[LuaDec](http://luadec.luaforge.net/)本身最后一次更新为 Lua 5.0.2。针对 Lua 5.1.x 字节码的新版本已发布为[LuaDec51](http://luadec51.luaforge.net/)。如f3lix 所述， [wiki](http://lua-users.org/wiki/)始终是开始寻找资源的好地方。[邮件列表](http://www.lua.org/lua-l.html)也是一个询问的好地方。

请注意，向字节码加载器添加混淆甚至加密是相对容易的。两者都不需要对 Lua 核心进行编辑。如果您正在分析的系统已采取任何这些措施，您可能还有更多工作要做。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-13T12:01:32.027

lua-users.org wiki的[Lua 工具](http://lua-users.org/wiki/LuaTools)页面列出了几个反编译器。您的选择将取决于您尝试反编译的 Lua 版本...

# php - 确定使用 PHP 调用函数的位置

> ID：743686
> 
> 赞同：5
> 
> 时间：2009-04-13T11:54:30.687
> 
> 标签：php

你们知道我如何从哪个文件中确定该函数内部调用的函数吗？

我正在考虑使用 debug_backtrace .. 但这看起来不是一种优雅的方式，他们还在另一个问题中列举了其他[原因](https://stackoverflow.com/questions/346703/php-debugbacktrace-in-production-code)

那么还有哪些其他选择呢？

多谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-13T12:12:03.827

我前段时间从某个地方借用了这段代码，它使用[debug_backtrace()](http://us2.php.net/manual/en/function.debug-backtrace.php)就像一个魅力。希望你觉得它有用：

```
function backtrace(){
    $backtrace = debug_backtrace();

    $output = '';
    foreach ($backtrace as $bt) {
        $args = '';
        foreach ($bt['args'] as $a) {
            if (!empty($args)) {
                $args .= ', ';
            }
            switch (gettype($a)) {
                case 'integer':
                case 'double':
                    $args .= $a;
                    break;
                case 'string':
                    //$a = htmlspecialchars(substr(, 0, 64)).((strlen($a) > 64) ? '...' : '');
                    $args .= "\"$a\"";
                    break;
                case 'array':
                    $args .= 'Array('.count($a).')';
                    break;
                case 'object':
                    $args .= 'Object('.get_class($a).')';
                    break;
                case 'resource':
                    $args .= 'Resource('.strstr($a, '#').')';
                    break;
                case 'boolean':
                    $args .= $a ? 'TRUE' : 'FALSE';
                    break;
                case 'NULL':
                    $args .= 'Null';
                    break;
                default:
                    $args .= 'Unknown';
            }
        }
        $output .= '<br />';
        $output .= '<b>file:</b> '.@$bt['file'].' - line '.@$bt['line'].'<br />';
        $output .= '<b>call:</b> '.@$bt['class'].@$bt['type'].@$bt['function'].'('.$args.')<br />';
    }
    return $output;
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-02-16T08:33:56.900

米老鼠团队的回复是典型的在线 PHP 社区！他们没有分享答案，而是问你为什么需要它。别介意 solomongaby 提出了一个有效的问题，这是标准 IDE 和更专业的语言（如 Java 和 Objective-C）中的一个非常正常的功能。

Solomongaby，这是为您提供所需的最简单方法：

```
$bt = debug_backtrace();
$end = end($bt);
var_dump($end['class']); //or var_dump($end['file']); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-13T12:18:37.273

从函数内部`debug_backtrace()`是确定调用者的唯一方法，当然除非您将该信息作为参数传递。

请注意，您**不能**使用默认值来执行此操作。例如：

```
function f($param1, $param2, $caller=__FUNCTION__) ... 
```

`__FUNCTION__`将在解析时进行评估，因此它始终具有相同的值。声明范围的函数`f`。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-13T12:12:48.877

你不会有很多选择。另一个选项（在另一个问题中发布）强制调用者通过函数调用提供它的信息（使用 PHP 魔术常量）：

```
callFunction(1, 2, 3, __FUNCTION__)
callFunction(1, 2, 3, __CLASS__,  __METHOD__)
callFunction(1, 2, 3, $this,  __METHOD__)

  or

$class = new ReflectionClass( __CLASS__ ); 
$method = $class->getMethod( __METHOD__ );
callFunction(1, 2, 3, $method) // $method would be a ReflectionMethod obj 
```

将是一个可能的选择。但它是

*   混淆你的代码
*   可以被“操纵”，这可能导致代码`callFunction`失败，并且很难追踪这些错误。

如果我在你的位置，我会尝试在整个代码中使用的函数中避免它。使用`debug_backtrace`（即使它可能是“慢”）。可读代码胜过快速代码。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-13T12:12:57.147

如果这是出于调试目的，您可以抛出异常，并打印捕获它的函数调用堆栈。

# c++ - 实例变量的确切定义是什么？

> ID：743697
> 
> 赞同：4
> 
> 时间：2009-04-13T12:02:00.153
> 
> 标签：c++, class, instance-variables

我认为实例变量是简单的数据类型，如 int 或 double。创建对象时自动创建的所有内容。

如果一个对象创建了额外的对象——就像它使用 NEW 关键字所做的一切——这些不是实例变量。

我是对还是错？确切的定义是什么？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-04-13T12:04:24.903

错误的。绑定在实例中的任何东西（即实例化对象）都是实例变量。与绑定到类的静态（类）变量相反。它们是简单类型还是指向对象的指针都没有关系。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-13T12:07:59.997

实例变量是可以与类的实例相关联的变量。例如，如果您有

```
class A
{
private:
int m_a;
double m_b;
int* m_c;
}; 
```

如果您创建 A 的一个对象（即一个实例），则会创建一个 m_a、m_b、m_c 实例并与之关联。所以这些成为实例变量。同时，如果您在类中有一个静态变量，则静态变量实例不与该类的每个对象相关联，因此它不是实例变量。NEW 或创建堆栈对象只是创建对象的方法，因此与实例变量无关。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-04-13T12:07:13.150

来自[维基百科](http://en.wikipedia.org/wiki/Instance_variable)（你要求一个确切的定义）：

> 在使用类的面向对象编程中，实例变量是在类中定义的变量，类中的每个对象都有一个单独的副本。
> 
> 实例变量与类变量相反，是一种特殊类型的实例成员。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-13T12:12:28.520

```
class A {
    int a;
    Foo *f;
    static int b;
}; 
```

`a`是一个实例变量。`b`不是。指针`f`本身就是一个实例变量，由(created with )*指向的对象`f`*`new`不是一个实例变量，因为它甚至不是一个变量，即使它仍然是实例状态的一部分。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-13T12:13:49.233

我是 OOP 概念的新手，但我会尽力而为。

是的，实例变量是具有普通数据类型的变量，但它们属于 OBJECT 的特定实例。实例变量是描述对象的“特征”或“属性”的变量。例如，carColor、carName 可以是“Car”类的实例变量，因为它描述了对象汽车的特性。

当使用关键字“new”实例化一个新对象时，所有实例变量都会自动附加到该对象并可以单独跟踪。例如

```
var carA = new car
carA.carName = "Honda" 
carA.carColor= "Blue" 

var carB = new car
carA.carName = "Austin" 
carA.carColor= "Red" 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-13T12:06:39.830

实例变量（又名字段）是属于*实例*的变量，而不是属于*类的**静态变量和属于**本地堆栈框架*的局部变量。

 **您的定义定义了一个*对象*，它是一种类型的实例。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-13T12:06:15.120

这取决于对象创建它们的时间和地点。如果它们在类级别声明，但仅在实例化后创建，它们仍然是实例变量。如果它们都在函数内声明和创建，它们是局部变量，而不是实例变量。

# sql-server - 我如何知道我的存储过程是否在 MS SQL Server 中被删除？

> ID：743712
> 
> 赞同：4
> 
> 时间：2009-04-13T12:08:06.923
> 
> 标签：sql-server

它有时会发生，我如何知道我的存储过程何时在我不知情的情况下删除/删除？

每当我调试并发现知道存储过程没有退出时，它都会让我烦恼，这是几天前创建和测试的。

有没有办法知道 MS SQL Server 中删除的存储过程？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-13T12:16:49.413

检查程序是否存在的标准方法是

```
if exists(
    SELECT * FROM INFORMATION_SCHEMA.ROUTINES
    WHERE routine_type = N'PROCEDURE' and routine_name = @procname)
  print 'exists' 
```

从 MSSQL 2005 开始，您可以使用 [DDL 触发器]( [http://msdn.microsoft.com/en-us/library/ms190989(SQL.90%29.aspx)](http://msdn.microsoft.com/en-us/library/ms190989(SQL.90%29.aspx))在删除或创建过程时发送电子邮件通知：

```
USE msdb
GO
CREATE TABLE ddl_log
(ID int idenity(1,1) PRIMARY KEY CLUSTERED,
 PostTime datetime,
 DB_User nvarchar(100),
 Event nvarchar(100),
 TSQL nvarchar(2000));

CREATE TRIGGER DDL_Notify
ON DATABASE
FOR DROP_PROCEDURE, CREATE_PROCEDURE
AS
DECLARE @data XML,
        @tableHTML  NVARCHAR(MAX) ;

SET @data = EVENTDATA()

INSERT msdb.dbo.ddl_log (PostTime, DB_User, Event, TSQL)
VALUES (GETDATE(), CONVERT(nvarchar(100), USER_NAME()),
   @data.value('(/EVENT_INSTANCE/EventType)[1]', 'nvarchar(100)'),
   @data.value('(/EVENT_INSTANCE/TSQLCommand)[1]', 'nvarchar(2000)') ) ;

SET @tableHTML =
    N'<H1>DDL Table Event</H1>' +
    N'<table border="1">' +
    N'<tr><th>Post Time</th><th>User</th>' +
    N'<th>TSQL</th><th></tr>' +
    CAST ( ( SELECT td = PostTime, '',
                    td = DB_User, '',
                    td = TSQL, ''
              FROM msdb.dbo.ddl_log
              WHERE id = (select max(id) from msdb.dbo.ddl_log)
              FOR XML PATH('tr'), TYPE
    ) AS NVARCHAR(MAX) ) +
    N'</table>';

EXEC msdb.dbo.sp_send_dbmail
    @profile_name = 'Default',
    @recipients = 'dba@youraddress.com',
    @subject = 'DDL Table Event',
    @body = @tableHTML,
    @body_format = 'HTML' 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-13T12:21:54.363

如果您想或多或少独立于数据库供应商，您可以使用名为 INFORMATION_SCHEMA 的 SQL 标准目录视图 - 它们在 SQL Server、MySQL 和许多其他系统中实现：

```
select * from INFORMATION_SCHEMA.ROUTINES
where ROUTINE_NAME = 'YourStoredProcName' 
```

如果您返回一行，则存储的过程仍在系统中 - 如果没有，它就消失了。

马克

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-13T12:12:34.073

```
if not exists(select * from sysobjects where type='P' and name= @procedure_name)
   print 'does not exist' 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-12-15T16:06:24.880

上面的答案是正确的，但我不明白为什么经验丰富的 dba 不包含模式名称。下面显示了 SCHEMA 和区分大小写的更正。

```
IF NOT EXISTS 
    (
    SELECT * FROM INFORMATION_SCHEMA.ROUTINES
    WHERE ROUTINE_TYPE = N'PROCEDURE' and ROUTINE_SCHEMA = N'dbo' and ROUTINE_NAME = N'uspMyProcedure'  
    )
BEGIN
    print 'Does not exist'
END 
```

..

Microsoft.com 上的架构讨论

[http://msdn.microsoft.com/en-us/library/dd283095%28v=sql.100%29.aspx](http://msdn.microsoft.com/en-us/library/dd283095%28v=sql.100%29.aspx)

..

至于“如果存在”的最佳实践……我还将阅读 Andy Leonard 的关于使用 TSQL 进行测试驱动开发的 5 部分系列（并且还在不断增长）。

[http://www.sqlservercentral.com/articles/Testing/66553/](http://www.sqlservercentral.com/articles/Testing/66553/)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-13T12:10:20.850

快速而肮脏的方法是：

sp_helptext proc_name

如果函数抱怨，则存储过程丢失。

如果您想以编程方式查找，则对 sysobjects 表执行查询。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-13T12:17:28.867

如果您真的想知道“何时”删除您的过程，请查找[DDL 触发器](http://msdn.microsoft.com/en-us/library/ms190989(SQL.90).aspx)（SQL 2005 及更高版本）。

# windows - 新创建的模态窗口在 Windows Vista 中失去焦点并变得无法访问

> ID：743713
> 
> 赞同：10
> 
> 时间：2009-04-13T12:09:17.497
> 
> 标签：windows, delphi, windows-vista

有时，当我在我的 Delphi 应用程序中打开一个模态窗口时，它需要一段时间才能显示出来，然后我注意到该应用程序有点被阻止，发生的情况是模态窗体是用 ShowModal 打开但没有显示的，并且应用程序就像模态窗口在第一层一样被锁定。

通常发生这种情况时，我必须使用 Alt + Tab 或 Windows + Tab 来查找“隐藏”模式窗口，但这并非每次都有效。

这种行为只发生在 Vista 中，但它很烦人。

有什么方法可以防止这种“焦点怪异”的发生吗？

谢谢。

*** 编辑 ***

显然设置 Application.MainFormOnTaskbar := True 解决了这个问题，但现在下结论还为时过早，因为这是随机发生的。

*** 编辑 2 ***

ModalFormOnTaskbar 没有解决问题，之后我尝试设置 PopupMode = pmAuto ，但这只会让问题变得更糟。

现在我正在尝试明确设置 PopupParent，如果问题得到解决，我会告诉你。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-13T12:52:51.963

查看 PopupParent 属性。您可能希望在 ShowModal 调用之前为您的模态表单显式设置它。当 PopupParent 为 nil（默认）时，VCL 的行为会有所不同，具体取决于相关 PopupMode 属性的值。

如果您将模态表单的 PopupParent 设置为在调用 ShowModal 之前处于活动状态的表单，这可能会有所帮助。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-04-13T15:26:26.853

当 Windows XP 引入*窗口重影*的概念时，您已经开始出现的问题。由于 Delphi 使用的不寻常架构（所有窗体都是隐藏窗口的子窗口 - *TApplication*），许多 Delphi 应用程序都会遇到同样的问题。

快速解决它的一种方法是在初始化应用程序时[禁用窗口重影：](http://msdn.microsoft.com/en-us/library/ms648415.aspx)

```
var 
  User32: HMODULE; 
  DisableProcessWindowsGhosting: TProcedure; 
begin 
  User32 := GetModuleHandle('USER32'); 
  if User32 <> 0 then 
  begin 
    DisableProcessWindowsGhosting := GetProcAddress(User32, 'DisableProcessWindowsGhosting'); 
    if Assigned(DisableProcessWindowsGhosting) then 
      DisableProcessWindowsGhosting; 
  end; 
end; 
```

另一种可能（更优雅但费力）的解决方案是[规范化您的 Delphi 应用程序](http://groups.google.com/group/borland.public.delphi.vcl.components.writing/browse_thread/thread/2a24d50287320dc0/730885513921e8be)。

第三种选择是[切换到 Delphi 2006 (Delphi 10.0)](http://qc.embarcadero.com/wc/qcmain.aspx?d=3730)。

除了您报告的问题之外，Delphi 的体系结构还引入了更多奇怪的东西，其中包括不同的任务栏菜单和无法[刷新](http://msdn.microsoft.com/en-us/library/ms679346.aspx)。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-11-25T11:30:39.713

我已经设法通过删除我在代码中对 Application.ProcessMessages 的任何调用来减少很多此类事件，只要我可以。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2015-02-18T17:57:25.663

`Alt+P+V`(.dpr) 有`Application.MainFormOnTaskbar := True;`默认值，我不知道为什么，但如果我把`Application.MainFormOnTaskbar := False;`问题解决了。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-08-05T19:06:08.503

您可能想尝试编辑`Forms.pas`以将以下代码添加到`TCustomForm.ShowModal()`，就在调用之前`Application.ModalStarted()`：

```
if Assigned(Application) then begin
  while PeekMessage(msg, Application.Handle, CM_ACTIVATE, CM_DEACTIVATE, PM_REMOVE) do begin
    TranslateMessage(msg);
    DispatchMessage(msg);
  end;
end; 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2019-05-01T14:26:16.070

我在 Windows 10 上遇到了同样的问题，我通过替换 dpr/dproj 文件解决了这个问题：

… Application.CreateForm(TFrmMain, FrmMain);

应用程序运行；…</p>

经过

… Application.CreateForm(TFrmMain, FrmMain);

试试 FrmMain.ShowModal；最后是 FrmMain.Free; 结尾;

# function - 也在内部调用外部（即接口）函数？

> ID：743724
> 
> 赞同：2
> 
> 时间：2009-04-13T12:13:39.063
> 
> 标签：function, methods, private, public

我想知道在内部调用公共函数是否是一种好习惯。

公共函数是指您显式创建的所有方法/函数，以便从其他对象、模块等调用。例如，您通常会放入 Java 接口定义中的方法。通过内部调用，我的意思是在同一个模块、类等中。

我一直*觉得*这是某种“滥用”公共方法，尽管我想不出任何有效的技术理由不这样做。

另一种方法是将函数体放在私有函数/方法中，您可以在内部调用它。然后，公共方法的主体将包含对私有函数的单个调用。

我认为这个问题是非常主观的，但仍然......对此有什么想法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-13T12:23:02.473

没有理由不在内部使用公共方法。不要将私有方法包装在公共方法中，这样做没有任何好处，而且它会使您的代码稍微不那么清晰。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-13T12:28:05.613

是的，您可以这样做，这是一种很好的做法，但是必须根据情况认真考虑。

两个例子：

*   注意不要在类构造函数中调用方法：在调用期间，您的类已部分初始化，因此对方法（类本身或继承的）的任何调用都可能产生不好且难以跟踪的后果。根据经验，构造函数必须对类“自满”。

*   由于您使用的是类的方法，因此您可以自由访问其实现。问问自己“我是想通过它的接口还是通过它的实现来访问这个类？”。

为了更好地解释第二点，假设您有一个带有方法 foo() 和 bar() 的类 A。

假设 foo() 在其代码中调用 bar()。在这种情况下，您正在使用对象的接口。这个界面不可能是你所期望的！例如，假设您已经重新实现了该类（B 类，从 A 派生），但您的代码的用户也重新实现了该类，并且该方法 bar() 已被覆盖。由于继承，A::foo() 将调用 B::bar()，而不是 A::bar()。

通过不使用 bar() 方法调用，而是访问*实现*，您可以保证您的函数行为相同，即使对于子类也是如此。

其中一些问题进入了所谓的[脆弱基类问题](http://en.wikipedia.org/wiki/Fragile_base_class)。这是一篇关于它[的非常好的文章](http://www.javaworld.com/javaworld/jw-08-2003/jw-0801-toolbox.html)。

# c# - access elements of datagrid view

> ID：743726
> 
> 赞同：1
> 
> 时间：2009-04-13T12:14:11.183
> 
> 标签：c#

```
 string s = dataGridView1[0, 0].ToString();
                string s2 = dataGridView1[0, 1].ToString(); 
```

I used the above method to access elements of datagridview. but i'm getting only these values in 's' and 's2' "DataGridViewTextBoxCell { ColumnIndex=0, RowIndex=0 }"

"DataGridViewTextBoxCell { ColumnIndex=0, RowIndex=1 }"

but the values in datagrid are '1','hello'. how can i access it.?

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-13T12:17:25.200

```
string s = dataGridView1[0, 0].Value.ToString();
string s2 = dataGridView1[0, 1].Value.ToString(); 
```

You'll notice that when you index into the DGV you get an instance of the DataGridViewTextBoxCell class. It does overload the ToString method, but not in the way you hoped/expected.

So you must get the value contained within this instance, then call ToString on it.

# c - C中的短路错误处理

> ID：743729
> 
> 赞同：3
> 
> 时间：2009-04-13T12:17:22.487
> 
> 标签：c, error-handling, short-circuiting

我想知道是否有更好的方法来处理 C 中的情况，即一旦在一系列表达式中遇到错误，就想退出函数。（在这种情况下，它是一个在错误时返回 NULL 的函数）

例如，在一些 C 代码中，他们试图通过将一系列语句与 AND (&&) 组合来缩短错误处理。

```
return doSomething() && 
     doSomething2() && 
     doSomething3() && ... ; 
```

这让我很恼火，因为我们在一份声明中的~~一行写了这么多。~~但我想另一种选择是

```
if (!(value = doSomething()))
    return NULL;
if (!(value = doSomething2()))
    return NULL;
etc
return value; 
```

但是我在 perl 和 bash 脚本中看到的短路错误评估呢？

```
int die(int retvalue) {
    exit(retvalue);
}
.....
(value = doSomething()) || die(1);
(value = doSomething2()) || die(2);
(value = doSomething3()) || die(3);
return value; 
```

这样做的主要问题是 RHS 必须是一个表达式，因此您不能真正从函数中转到或返回。有人会觉得这很有价值还是太有限了？

编辑：我想我应该打算在第一个示例中包含换行符。问题是如果您决定在中间添加另一个表达式，则需要小心。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-13T12:40:50.590

我已经看到在 C 中使用 GOTO 来实现这个确切的目的。

因为 C 中没有“finally”构造，所以即使您提前退出函数，也需要一种方法来释放所有内存。

所以它基本上如下（如果我错了，有人可以纠正我的C语法，我有点生疏）

```
int foo()
{
    /* Do Stuff */
    if(!DoSomething())
        GOTO Failure;

    if(!DoSomething2())
        GOTO Failure;

    if(!DoSomething3())
        GOTO Failure;

    /* return success */
    return true; 

    Failure:
    /* release allocated resources */
    /* print to log if necessary */
    return false;
} 
```

**重要说明** 不要将 GOTO 用于执行流程。它们应该只在错误时使用，并且只用于当前函数的末尾。如果您将它们用于其他任何事情，您正在创建可能会破坏现实结构的意大利面条式代码。只是不要这样做。

**编辑**

正如其中一位海报所指出的，使用 Exit(x) 将杀死您的整个程序，从而使该解决方案保留用于致命错误。但是，您最初提出的解决方案 (DS() && DS2() && DS3()) 全部放在一行上，这会给错误处理带来问题。

如果您想将函数包装在某种特定于函数的错误处理中，那么当您将函数调用全部包装在一行中时，就没有办法做到这一点。所以，至少你可以做类似的事情

```
int result1 = 0;
int result2 = 0;
int result3 = 0;

result1 = DoSomething();

if(result1)
    result2 = DoSomething2();

if(result2)
    result3 = DoSomething3();

return result1 && result2 && result3; 
```

因为这种方法不会排除错误处理。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-13T12:22:46.157

如果您唯一担心的是在一条线上塞进太多东西，为什么不直接使用：

```
return doSomething()
    && doSomething2()
    && doSomething3()
    && ... ; 
```

我倾向于将第二种情况写为：

```
if (!(value = doSomething()))  return NULL;
if (!(value = doSomething2())) return NULL;
: : : : :
return value; 
```

（甚至排列返回以使其可读）因为我喜欢在屏幕上看到尽可能多的代码（并且您可以根据需要在行之间插入其他检查）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-13T13:25:56.923

这样的事情怎么样？

```
int result;

result = doSomething();

result = result && doSomething2();

result = result && doSomething3();

return result; 
```

这以与您的第一个示例类似的方式使用短路，但它允许您将其分成多行并添加注释等。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-13T12:25:34.183

我建议您反对您提出的技术。首先，C 中的 exit 终止进程；它不只是返回。所以它仅限于少数致命错误的情况。

在我看来，您试图避免的第一个解决方案是最好和最容易理解的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-13T13:41:47.743

根据我的经验，用 C 语言编写它的惯用方式是使用一系列 if 语句来启动函数，这些语句检查函数其余部分的先决条件。如果不满足先决条件，则立即返回错误代码。这样，当您到达函数主体的主要部分时，您就知道一切正常，并且可以使代码尽可能简单。

换句话说，你的第二种方法。

例如，可以编写一个函数来复制字符串，如下所示：

```
int copy_string(char *source, char *target, size_t max)
{
    if (source == NULL)
        return -1;
    if (target == NULL)
        return -1;
    source_len = strlen(source);
    if (source_len + 1 > max)   // +1 for NUL
        return -1;
    memcpy(target, source, source_len + 1);
    return 0;
} 
```

（我喜欢 Unix 系统调用约定为错误返回 -1，但这是一个有争议的风格问题，与这个问题无关。）

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-13T14:04:05.617

我以前见过这个：

```
int Function (void)
{
    int Result = DoSomething();

    if (Result) Result = DoSomething2();
    if (Result) Result = DoSomething3();
    if (Result) Result = DoSeomthing4();

    return Result;
} 
```

它看起来很整洁，很容易对齐。它不会立即退出，但不会执行任何其他操作。这当然假设函数在成功时返回非零值。否则，您可以简单地使用`if (!Result)`if 函数在失败时返回非零值。

# c++ - 关于 NOTIFYICONDATA 的 cbSize 成员的 MSDN 文档

> ID：743732
> 
> 赞同：1
> 
> 时间：2009-04-13T12:17:41.083
> 
> 标签：c++, winapi, notifyicon

我正在阅读 MSDN 中的 NOTIFYICONDATA 文档。

它说NOTIFYICONDATA结构有一个cbSize成员应该设置为结构的大小，但NOTIFYICONDATA结构的大小在每个Shell32.dll中都有不同的大小，所以你应该在设置cbSize之前获得Shell32.dll版本。

以下引用来自 MSDN：

* * *

如果是 5.0 或更高版本，请按如下方式初始化 cbSize 成员。

nid.cbSize = sizeof(NOTIFYICONDATA);

将 cbSize 设置为该值会启用所有 5.0 和 6.0 版本的增强功能。对于早期版本，6.0 之前的结构的大小由 NOTIFYICONDATA_V2_SIZE 常量给出，5.0 之前的结构由 NOTIFYICONDATA_V1_SIZE 常量给出。如下初始化 cbSize 成员。nid.cbSize = NOTIFYICONDATA_V2_SIZE;

将此值用于 cbSize 将允许您的应用程序将 NOTIFYICONDATA 与早期的 Shell32.dll 版本一起使用，尽管没有 6.0 版增强功能。

* * *

我发现它有点模糊，因为 'sizeof(NOTIFYICONDATA)' 在 Win98（使用 Shell32.dll 4.x 版）、Win2K（5.0 版）和 WinXP（6.0 版）中具有不同的值。它怎么能“启用所有版本 5.0 和 6.0 的增强功能”？

于是我找了NOTIFYICONDATA_V1_SIZE的定义（源代码如下），我看到了：

NOTIFYICONDATA_V1_SIZE 适用于 Win 2K（不包括 2K）

NOTIFYICONDATA_V2_SIZE 适用于 Win XP

NOTIFYICONDATA_V3_SIZE 适用于 Vista

（不确定我是否正确）

和 MSDN 说的完全不一样？Win2K没有？

所以，我现在完全糊涂了。如何根据 Shell32.dll 版本设置 cbSize 成员？

```
//= = = = = = = = ShellAPI.h = = = = = = = =

typedef struct _NOTIFYICONDATAA {
    DWORD cbSize;
    HWND hWnd;
    UINT uID;
    UINT uFlags;
    UINT uCallbackMessage;
    HICON hIcon;
＃if (NTDDI_VERSION < NTDDI_WIN2K)
    CHAR   szTip[64];
＃endif
＃if (NTDDI_VERSION >= NTDDI_WIN2K)
    CHAR   szTip[128];
    DWORD dwState;
    DWORD dwStateMask;
    CHAR   szInfo[256];
    union {
        UINT  uTimeout;
        UINT  uVersion;  // used with NIM_SETVERSION, values 0, 3 and 4
    } DUMMYUNIONNAME;
    CHAR   szInfoTitle[64];
    DWORD dwInfoFlags;
＃endif
＃if (NTDDI_VERSION >= NTDDI_WINXP)
    GUID guidItem;
＃endif
＃if (NTDDI_VERSION >= NTDDI_VISTA)
    HICON hBalloonIcon;
＃endif
} NOTIFYICONDATAA, *PNOTIFYICONDATAA;

typedef struct _NOTIFYICONDATAW {
    DWORD cbSize;
    HWND hWnd;
    UINT uID;
    UINT uFlags;
    UINT uCallbackMessage;
    HICON hIcon;
＃if (NTDDI_VERSION < NTDDI_WIN2K)
    WCHAR  szTip[64];
＃endif
＃if (NTDDI_VERSION >= NTDDI_WIN2K)
    WCHAR  szTip[128];
    DWORD dwState;
    DWORD dwStateMask;
    WCHAR  szInfo[256];
    union {
        UINT  uTimeout;
        UINT  uVersion;  // used with NIM_SETVERSION, values 0, 3 and 4
    } DUMMYUNIONNAME;
    WCHAR  szInfoTitle[64];
    DWORD dwInfoFlags;
＃endif
＃if (NTDDI_VERSION >= NTDDI_WINXP)
    GUID guidItem;
＃endif
＃if (NTDDI_VERSION >= NTDDI_VISTA)
    HICON hBalloonIcon;
＃endif
} NOTIFYICONDATAW, *PNOTIFYICONDATAW;

＃define NOTIFYICONDATAA_V1_SIZE     FIELD_OFFSET(NOTIFYICONDATAA, szTip[64])
＃define NOTIFYICONDATAW_V1_SIZE     FIELD_OFFSET(NOTIFYICONDATAW, szTip[64])
＃ifdef UNICODE
＃define NOTIFYICONDATA_V1_SIZE      NOTIFYICONDATAW_V1_SIZE
＃else
＃define NOTIFYICONDATA_V1_SIZE      NOTIFYICONDATAA_V1_SIZE
＃endif

＃define NOTIFYICONDATAA_V2_SIZE     FIELD_OFFSET(NOTIFYICONDATAA, guidItem)
＃define NOTIFYICONDATAW_V2_SIZE     FIELD_OFFSET(NOTIFYICONDATAW, guidItem)
＃ifdef UNICODE
＃define NOTIFYICONDATA_V2_SIZE      NOTIFYICONDATAW_V2_SIZE
＃else
＃define NOTIFYICONDATA_V2_SIZE      NOTIFYICONDATAA_V2_SIZE
＃endif

＃define NOTIFYICONDATAA_V3_SIZE     FIELD_OFFSET(NOTIFYICONDATAA, hBalloonIcon)
＃define NOTIFYICONDATAW_V3_SIZE     FIELD_OFFSET(NOTIFYICONDATAW, hBalloonIcon)
＃ifdef UNICODE
＃define NOTIFYICONDATA_V3_SIZE      NOTIFYICONDATAW_V3_SIZE
＃else
＃define NOTIFYICONDATA_V3_SIZE      NOTIFYICONDATAA_V3_SIZE
＃endif 
```

（好像代码在网站上看起来不太好，但它来自ShellAPI.h，都一样）

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-13T12:26:39.343

这取决于您编译的最低 Windows 版本。您不会动态设置大小。根据您支持的最低版本的 Windows 设置大小。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-13T16:25:16.073

通过平台 sdk 标头可以使用哪些功能由 控制`_WIN32_WINNT`，应将其定义为您所针对的操作系统的较低版本。

从[http://msdn.microsoft.com/en-us/library/6sehtctf.aspx](http://msdn.microsoft.com/en-us/library/6sehtctf.aspx)正确的值是：

> 0x0500 用于 Windows 2000 操作系统，0x0501 用于 Windows XP，0x0502 用于 Windows Server 2003，0x0600 用于 Windows Vista。

所以`NOTIFYICONDATA_V1_SIZE`参考任何低于 2K 的版本，参考`NOTIFYICONDATA_V2_SIZE`2K，参考`NOTIFYICONDATA_V3_SIZE`XP 而没有参考 Vista（在这种情况下，您可以使用 sizeof(NOTIFYICONDATA)）。

如果您编译项目并`_WIN32_WINNT`设置为最新版本，并检测您在运行时运行的 shell.dll 版本，您可以将 .cbSize 设置为正确的大小，其余字段将被忽略。

像这样的东西应该工作：

```
NOTIFYICONDATA notify;
ZeroMemory(&notify, sizeof(notify)); 
if(version >= VISTA) {
  notify.cbSize = sizeof(NOTIFYICONDATA);
}
else if(version >= XP) {
  notify.cbSize = NOTIFYICONDATA_V3_SIZE;
}
else if(version >= 2K) {
  notify.cbSize = NOTIFYICONDATA_V2_SIZE;
}
else {
  notify.cbSize = NOTIFYICONDATA_V1_SIZE;
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2014-04-04T13:16:35.613

“这取决于您编译的最低 Windows 版本。您不会动态设置大小。您根据您支持的最低 Windows 版本设置大小。”

其实并不是。只需尝试针对 VISTA 构建并在 XP 下运行。您将在 64+ 字节的消息大小上获得一个空的工具提示字符串。安全的解决方案是构建`(_WIN32_WINNT >= 0x0600)`和设置`cbSize = NOTIFYICONDATA_V3_SIZE`；

正确的解决方案是在运行时检查`shell32.dll`版本。`6.0.6000 - Vista+`, `6.0.0 - XP`,`5.0.0 - W2K`

# c++ - 为什么 printf 显示 FPTAN 结果的 -1.#IND？

> ID：743735
> 
> 赞同：2
> 
> 时间：2009-04-13T12:19:11.407
> 
> 标签：c++, assembly, floating-point, x86

我正在开发一个从表达式生成汇编代码的程序。所需的函数之一是 tan(x)，它目前使用以下代码序列工作（地址在运行时填写）：

```
fld [0x00C01288];
fld st(0);
fsin;
fld st(1);
fcos;
fdivp;
fst [0x0030FA8C]; 
```

但是，我想改用[FPTAN](http://www.sesp.cse.clrc.ac.uk/html/SoftwareTools/vtune/users_guide/mergedProjects/analyzer_ec/mergedProjects/reference_olh/mergedProjects/instructions/instruct32_hh/vc110.htm)操作码，所以我尝试使用以下代码：

```
fld [0x00C01288];
fptan;
fincstp;
fst [0x0030FA8C]; 
```

测试程序使用 printf 显示存储在 0x30FA8C 的结果，但对于第二个序列，结果显示为 -1.#IND（第一个使用 cos 和 sin 工作正常）。如果我尝试在调试器中检查内存地址或浮点堆栈顶部的值，它会显示为正确的数字。

所以，我的问题是：为什么 printf 显示 -1.#IND，我该如何解决？

0x00C01288 处的值是双精度 0.5 两种情况下的结果都是 ~0.5463024898

我的第一个想法是存储的值是相同数字的不同表示，但检查存储在 0x0030FA8C 的值显示它在两种情况下都是 0x3FE17B4F5BF3474A。

我不明白为什么 printf 函数的相同输入会产生不同的输出......

任何帮助或建议将不胜感激。

编辑：调用 printf 的源：

```
#include "FridgeScript.h"
#include <stdio.h>
#include <math.h>

char test[] = "a=tan(0.5);";

int main(int c, char** s)
{
    unsigned int SC = FSCreateContext();

    double a = 0.0;
    FSRegisterVariable(SC, "a", &a);

    unsigned int CH = FSCompile(SC, test);
    if(CH) FSExecute(SC, CH);

    printf("a: %.10g\r\n", a);
    printf("hex a: %I64X", a);

    FSDestroyContext(SC);
    return 0;
} 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-13T12:51:46.820

让我把一些东西扔在那里：如何使用

```
fstp st(0); 
```

代替

```
fincstp; 
```

fincstp 上的文档说它不等同于从堆栈中弹出项目，因为它会将该位置标记为已填充 - 也许这会弄乱 printf 内部的浮点处理？

（你可能会猜到我不知道我在说什么。但也许这会给你一个想法？）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-13T12:52:55.957

```
fld [0x00C01288];
fptan;
fincstp;
fst [0x0030FA8C]; 
```

在我看来，这段代码执行后，切线仍然在`st0`. 你不应该使用`fstp`而不是`fst`吗？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-13T12:53:22.447

也许您的 FST 指令只存储浮点结果，而第二个 dword 仍未初始化？

我在汇编代码中看不到任何大小前缀。通常你会看到类似的东西：

```
 FST [dword ptr some_address]

  or 

  FS [qword ptr some_address] 
```

# winapi - 如何安装可以在安全桌面上运行的实用程序管理器应用程序？

> ID：743737
> 
> 赞同：0
> 
> 时间：2009-04-13T12:19:16.367
> 
> 标签：winapi, accessibility

我尝试编写实用程序管理器应用程序，并尝试在 WinXP SP3 上对其进行测试。我将它添加到`HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Accessibility\Utility Manager`，并且在我登录时加载实用程序管理器时效果很好。

但是，当我在登录前（通过 Window+U）或从锁定屏幕尝试在启动时从实用程序管理器加载它时，会出现一条错误消息，说（大约，因为它是 WinXP 的德语版本）“此应用程序不能在安全桌面上执行。请联系您的系统管理员以获取所需的权限”。

我必须做些什么不同的事情才能在安全桌面上进行这项工作？

[b] 编辑：[/b] 我听从 David Pope 的建议并尝试调试 utilman.exe（使用[OllyDebug](http://www.ollydbg.de)，因为我比使用新的调试器更习惯...，并要求它中断进程创建）。好像我的应用程序根本没有启动。由于 OllyDebug 似乎禁用了某些功能（例如中断 API 调用）（可能是因为该进程以不同的用户身份运行），我使用 Sysinternals Process Monitor 仔细检查了它。启动屏幕键盘时，会出现“进程创建”事件；启动我的工具时，没有出现任何事件。

另一个注意事项：当我将 osk.exe（屏幕键盘）放入我的新注册表项时，它可以正常工作（我基本上在菜单中有两个屏幕键盘条目），但是如果我将 osk.exe 复制到 osk2。 exe 并将 osk2.exe 作为可执行文件，屏幕键盘上的副本将在非安全桌面上启动。所以在调用可执行文件之前必须是某种验证（针对文件名+内容）？用我的工具（或 osk.exe）替换 magnify.exe 将使该工具在下一次重新启动后无法工作（当 utilman 重新启动时？？）。

换句话说：只有文件名为 osk.exe 并且是屏幕键盘或文件名为 magnify.exe 并且是放大镜时，它才会起作用。

这也不会在事件日志中创建任何信息。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-20T06:46:05.873

您是否按照[此页面](http://msdn.microsoft.com/en-us/accessibility/bb879984.aspx)上的所有说明进行操作？它似乎涵盖的注册表设置比您描述的要多。

编辑：正如您所指出的，该页面似乎适用于 Vista。令人讨厌的是 MSFT 如何剔除遗留信息并使其难以找到......

要检查的一件事是事件日志 - 也许它们包含线索。可以提高审核级别以查看更多与安全相关的数据。

我没有您的代码，所以我无法自己调试它，但我能够将调试器挂接到 utilman.exe 并在它在安全桌面上启动实用程序时获得控制。也许如果你这样做，你可以找出安全违规。

1.  在目标计算机上：
    *   安装适用于 Windows 的调试工具。
    *   启用 RDP 访问。
    *   锁定屏幕。
    *   按 Win-U 调出实用程序管理器并使其运行。
    *   确保您的符号和源代码在目标上与它们在开发机器上编译的路径相同。
2.  在另一台机器上：
    *   以具有调试/管理员权限的用户身份将 RDP 导入目标计算机。
3.  在 RDP 会话中：
    *   运行 WinDBG 并附加到 utilman 进程（F6 键）
    *   如果它没有进入调试器，请按 ctrl-break。
    *   确保您`.childdbg 1`的实用程序在启动时加载到此调试器实例中。
    *   做`g`继续运行。
4.  返回目标计算机控制台（登录屏幕）：
    *   从实用程序管理器启动您的实用程序。调试器（在 RDP 会话中）应该会在新进程中中断，您应该能够从那里进行调试。

（我在我尝试过的机器上没有 Visual Studio；如果你在目标机器上有 VStudio，你可能可以使用它而不是 WinDBG。）

如果您的实用程序甚至没有加载，那么 Windows 会在调用 CreateProcess 之前进行某种验证。安全日志可能会帮助您。

**编辑 2**我尝试使用[字符串](http://technet.microsoft.com/en-us/sysinternals/bb897439.aspx)实用程序来定位生成对话框的程序，但我使用的是英文 WinXP，所以我没有实际的字符串。我还没有运气寻找硬编码的“osk.exe”等。

如果您能弄清楚是什么 EXE 设置了该对话框（可能是 utilman，可能是 winlogon ...），您应该能够使用调试器附加到它并返回堆栈以查找错误检查。一旦检查失败的大致区域，您应该能够在代码路径中更早设置一个断点，该断点应该在您下次尝试启动时进入调试器。您应该能够从那里逐步完成失败的检查。对于所有这些，请确保您有可用的[操作系统符号](http://www.microsoft.com/whdc/DevTools/Debugging/debugstart.mspx)，因为它应该使“路标”更易于阅读。我不熟悉您的调试器是否支持符号服务器。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-24T19:41:36.663

您的程序是否经过数字签名？你的程序是从哪里运行的？

尝试将它放在以下受保护的路径之一中：

```
* ..\Program Files\ (and subfolders)
* ..\Program Files (x86)\ (and subfolders, in 64-bit versions of Windows only)
* ..\Windows\System32\ 
```

你看过[http://netsecurity.about.com/od/secureyourwindowspc/qt/uacuiaccess.htm](http://netsecurity.about.com/od/secureyourwindowspc/qt/uacuiaccess.htm)吗？这似乎描述了你正在尝试做的一些事情。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-15T00:26:32.053

我不确定该消息的来源是什么，但我知道有一个名为 Winlogon 的桌面对象，它是安全的 CTRL+ALT+DELETE 桌面。在您的 GUI 线程中创建任何窗口之前，您可以使用[OpenDesktop](http://msdn.microsoft.com/en-us/library/ms684303(VS.85).aspx)和[SetThreadDesktop ，这应该使您的窗口能够在那里显示。](http://msdn.microsoft.com/en-us/library/ms686250(VS.85).aspx)在较新版本的 Windows 中，可能有另一种方法可以使用辅助功能 API。

# actionscript-3 - 从actionscript 3中的完整路径中提取“文件名”

> ID：743739
> 
> 赞同：5
> 
> 时间：2009-04-13T12:20:48.283
> 
> 标签：actionscript-3

AS3 是否具有内置类/函数来从完整路径中提取“文件名”。例如，我希望从完整路径“C:\Documents and Settings\All Users\Desktop\filename.doc”中提取“ **filename.doc** ”

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2010-10-04T10:28:12.023

对于 Air，您可以尝试使用[File](http://www.adobe.com/livedocs/flash/9.0/ActionScriptLangRefV3/flash/filesystem/File.html) Class 提取文件名

```
var file:File=new File("path_string");   
//path_string example "C:\\Windows\\myfile.txt"  
var filename:String = file.name; 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-13T12:47:35.580

你不能做一些基本的事情，比如：

```
string filename = filename.substring(filename.lastIndexOf("\\") + 1) 
```

我知道这不是一个单一的函数调用，但它应该是一样的。

根据@Bryan Grezeszak 的评论编辑。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-13T18:25:15.863

首先，您要查找路径中最后出现的 / 或 \，使用以下方法：

```
var fSlash: int = fullPath.lastIndexOf("/");
var bSlash: int = fullPath.lastIndexOf("\\"); // reason for the double slash is just to escape the slash so it doesn't escape the quote!!!
var slashIndex: int = fSlash > bSlash ? fSlash : bSlash;
```

这将为您提供最后一个斜杠之前的字符串中的索引。因此，要在此之后返回字符串的部分，您将一个添加到索引（将其移过最后一个斜杠）并返回字符串的其余部分

```
var docName: String = fullPath.substr(slashIndex + 1);
```

要将此作为一个简单易用的功能，请执行以下操作：

```
function getFileName(fullPath: String) : String
{
    var fSlash: int = fullPath.lastIndexOf("/");
    var bSlash: int = fullPath.lastIndexOf("\\"); // reason for the double slash is just to escape the slash so it doesn't escape the quote!!!
    var slashIndex: int = fSlash > bSlash ? fSlash : bSlash;
    return fullPath.substr(slashIndex + 1);
}

var fName: String = getFileName(myFullPath);
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-13T13:00:37.110

显然，您可以使用[File](http://livedocs.adobe.com/flash/9.0/ActionScriptLangRefV3/flash/filesystem/File.html)类，或者更具体地说，如果您使用 AIR ，则可以使用[File.separator静态成员。](http://livedocs.adobe.com/flash/9.0/ActionScriptLangRefV3/flash/filesystem/File.html#separator)它应该返回“/”或“\”，您可以将其插入@cmptrgeekken 的建议中。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-12-09T23:52:24.997

尝试这个：

```
var file_ :File = new File("C:/Usea_/Dtop/sinim (1).jpg"); // or url variable ... whatever//

file_ = file_.parent;

trace(file_.url); 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2017-03-02T22:33:08.733

你可以使用这样的东西来完成这项工作：

```
var tmpArray:Array<String>;
var fileName:String;

tmpArray = fullFilePath.split("\");
fileName = tmpArray.pop(); 
```

如果您使用的是 Unix 文件系统 ("/") 或 Windows 文件系统 ("\")，则必须小心。

# xml - 在用各种语言编写的程序之间交换数据

> ID：743770
> 
> 赞同：0
> 
> 时间：2009-04-13T12:35:17.140
> 
> 标签：xml, json, api, protocols

我在写一个小型的浏览器游戏，由于我不是一个好的设计师，我想先从技术部分开始，然后再添加用户界面，所以我想让第一个版本包含机器人支持，这样每个人都可以写他们自己的机器人并让它玩游戏。这样，我就不必关心为用户界面制作图形，并且可以专注于游戏的核心，同时拥有稳定的测试数据流和许多测试人员。

但是，我无法在服务器（C++）和客户端（任何语言，但第一个参考实现将使用 C++ 和 Python）之间交换数据的各种方式之间做出决定。
对于传输，我考虑提供 HTTP 和 TCP（一些简单的自制协议），因为大多数语言都有这些协议的初学者友好实现。

为了对数据进行编码，我考虑了一些由我任意定义的东西（像 CSV 之类的原始东西）、JSON 和 XML，但我想要一些关于 C++ 易用性、各种语言的简单实现和人类可理解性的评论。

我该怎么办？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-13T12:45:43.027

如果您要制作基于浏览器的游戏，那么将要玩它的人将使用 http 请求并访问某些 URL。对我来说，让你的机器人 API 与此类似是有意义的，而不是为自己重复工作。那么为什么不通过 Web 服务公开游戏的功能呢？

尽可能地，我会尽量保持协议/API 尽可能标准。必须学习您的自制版本是人们在与您的游戏互动之前必须克服的额外障碍。

至于语言，您为基于浏览器的游戏选择 C++ 是否有原因？那里有很多 Web 框架，但很少有人使用 C++。

# sql - 如何在 Oracle SQL 语句中重用动态列？

> ID：743772
> 
> 赞同：4
> 
> 时间：2009-04-13T12:35:33.207
> 
> 标签：sql, oracle, ora-00904

我尝试重用我在 Oracle SQL 中动态计算的一些列，例如

```
SELECT
    A*2 AS P,
    P+5 AS Q
FROM tablename 
```

其中“tablename”有一个名为“A”的列，但没有其他列。这给了我一个

```
ORA-00904: "P": invalid identifier 
```

我知道如何通过使用子查询来解决这个问题

```
SELECT P, P+5 AS Q
FROM ( SELECT A*2 AS P FROM tablename ) 
```

但我认为这有点丑陋。此外，我想让查询变得更复杂一些，例如也重用“Q”，并且我不想再创建另一个子查询。

更新：我想存储'P'的计算的原因是我想让它更复杂，并多次重复使用'P'。所以我不想明确地说“A*2+5 AS Q”，因为随着“P”变得越来越复杂，这很快就会变得很麻烦。

必须有一个好方法来做到这一点，有什么想法吗？

更新：我应该注意我不是数据库管理员:(。

* * *

更新：一个真实世界的例子，有一个更具体的查询。我想做的是：

```
SELECT 
    SL/SQRT(AB) AS ALPHA,
    5*LOG(10,ALPHA) AS B,
    2.5*LOG(10,1-EXP(-5/ALPHA)*(5/ALPHA+1)) AS D
    BS -2.74 + B + D AS BSA
FROM tablename 
```

现在，我已经把它写出来了，它有效，但很丑：

```
SELECT
    SL/SQRT(AB) AS ALPHA,
    5*LOG(10,SL/SQRT(AB)) AS B,
    2.5*LOG(10,1-EXP(-5/(SL/SQRT(AB)))*(5/(SL/SQRT(AB))+1)) AS D
    BS -2.74 + 5*LOG(10,SL/SQRT(AB)) + 2.5*LOG(10,1-EXP(-5/(SL/SQRT(AB)))*((5/(SL/SQRT(AB)))+1)) AS BSA
FROM tablename 
```

收到数据后我可以做所有这些，但我想，让我们看看我可以让数据库做多少。另外，我也想选择“BSA”（我现在可以将此查询作为子查询/带有子句）。

* * *

更新：好的，我想现在我完成了 Cade Roux 和 Dave Costa 的解决方案。尽管 Pax 和 Jens Schauder 的解决方案看起来会更好，但我不能使用它们，因为我不是 DBA。现在我不知道将谁标记为最佳答案:)。

```
WITH 
  A1 AS ( 
    SELECT A0.*, 
    SL/SQRT(AB) AS ALPHA
    FROM tablename A0
  ),
  A2 AS (
    SELECT A1.*, 
    5*LOG(10,ALPHA) AS B,
    2.5*LOG(10,1-EXP(-5/ALPHA)*((5/ALPHA)+1)) AS D
    FROM A1
  )
SELECT
  ALPHA, B, D, BS,
  BS -2.74 + B + D AS BSA
FROM A2 
```

* * *

顺便说一句，如果有人感兴趣，SB 是星系的“表面亮度”，B 和 D 是修正项。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-13T13:46:19.887

我们在 SQL Server 中也有同样的问题（这是一个 ANSI 问题）。我相信这是为了避免混淆混叠效果：

```
SELECT A * 2 AS A
    ,A * 3 AS B -- This is the original A, not the new A
FROM whatever 
```

我们通过堆叠公用表表达式来解决它：

```
WITH A1 AS (
    SELECT A * 2 AS A
    FROM whatever
)
,A2 AS (
    SELECT A1.*
        ,A * 3 AS B
    FROM A1
)
,A3 AS (
    SELECT A2.*
        ,A + B AS X
    FROM A2
)
SELECT *
FROM A3 
```

这是最具可读性和可维护性和可遵循性的版本。

对于 UPDATE，有一个使用 column_name = notation 的已弃用 SQL Server 解决方法，您可以在其中引用列表中先前已更新的列。但这不能在 SELECT 中使用。

我希望将来某个时候将一些堆叠表达式的功能（不使用标量 UDF）添加到 ANSI SQL。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-13T12:40:12.417

我不确定您是否可以做到这一点（我从未见过这样做过），但您可以通过以下方式解决它：

```
SELECT
    A*2   AS P,
    A*2+5 AS Q
FROM tablename 
```

这肯定比引入子查询要好。

我建议的唯一另一种方法是创建一个视图，为您提供 P/Q 类型的列（使用上面的公式），这至少可以简化查询的文本。然后你可以：

```
SELECT P, Q FROM viewintotablename 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-13T12:46:35.833

你不能。

如果您不希望重新评估子查询，请为`NO_MERGE`子查询添加提示：

此子查询将在嵌套循环中重新评估（`MERGE`使用提示）：

```
SELECT  /*+ LEADING(g) USE_NL(g, r) MERGE(g) */
        *
FROM    (
        SELECT  1
        FROM    dual
        UNION ALL
        SELECT  2
        FROM    dual
        ) r, 
        (
        SELECT  SYS_GUID() AS guid
        FROM    dual d
        ) g

---
33CA48C1AB6B4403808FB0219302CE43
711BB04F9AFC406ABAEF8A8F4CFA1266 
```

此子查询不会在嵌套循环中重新计算（`NO_MERGE`使用了提示）：

```
SELECT  /*+ LEADING(g) USE_NL(g, r) NO_MERGE(g) */
        *
FROM    (
        SELECT  1
        FROM    dual
        UNION ALL
        SELECT  2
        FROM    dual
        ) r, 
        (
        SELECT  SYS_GUID() AS guid
        FROM    dual d
        ) g

------
7715C69698A243C0B379E68ABB55C088
7715C69698A243C0B379E68ABB55C088 
```

在你的情况下，只需写：

```
SELECT  BS - 2.74 + d
FROM    (
        SELECT  t2.*, 2.5 * LOG(10, 1 - EXP(-5 / b)) * ((5 / A) + 1) AS d
        FROM    (
                SELECT  t1.*, 5 * LOG(10, alpha) AS b
                FROM    (
                        SELECT  /*+ NO_MERGE */ t.*,
                                SL/SQRT(AB) AS alpha
                        FROM    tablename t
                        ) t1
                ) t2
        ) t3 
```

，这更有效（`EXP`并且`LOG`成本更高）并且更容易调试。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-13T12:57:47.180

在 sql 中没有直接的方法可以做到这一点。

但是您可以使用 PL/SQL 定义一个函数。所以你的选择看起来像这样

```
select 
    P(A), 
    Q(P(A)) 
from tablename 
```

对于 P 和 Q 来说，这并不比原来的更好（很多），但是如果函数很复杂，并且不需要很多参数，它可能会使您的语句更具可读性。

它还允许您独立于 sql 语句和任何数据来测试您的函数。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-13T13:03:01.520

您可能会比您提供的内联视图示例更喜欢这个：

```
WITH inner_view AS ( SELECT A*2 AS P FROM tablename )
SELECT P, P+5 AS Q
FROM inner_view 
```

我认为它相当于同一件事，但读起来更清楚一些。

如果计算列是您将在多个列中使用的东西，那么创建一个永久视图可能是有意义的。

Oracle 11（我还没有使用过）有一个虚拟列功能，可能对您有用。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2019-04-21T17:28:25.793

别名重用在 Teradata 中很常见，但有时可能会造成混淆，主要是当您使用表/子查询中存在的名称为列名取别名并尝试重用它时，数据库将使用原始列而不是您别名的列。

# visual-studio - 如何退出 Visual Studio 中的当前项目？

> ID：743775
> 
> 赞同：5
> 
> 时间：2009-04-13T12:37:20.397
> 
> 标签：visual-studio

在 Visual Studio 中，如何退出当前项目并加载另一个项目？重载之类的？

即当我正在执行我的项目（窗口应用程序）时，我需要关闭当前的 exe 并加载 exe 文件的另一个实例。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-13T12:48:25.127

文件 --> 关闭项目... 文件 --> 打开项目

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-13T12:52:52.853

我认为您正在寻找重新启动操作。

View|Toolbars|Debug 将显示工具栏；带有向左箭头的方形蓝色图标就是您所追求的。

在我的系统上，键盘快捷键是 Ctrl+Shift+F5。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-13T12:45:39.080

只需打开另一个项目。Visual Studio 在打开新项目时会自动关闭当前项目。

我仍然不完全确定这就是你所要求的。以下是一些相关的操作以及实现它们的方法

*   卸载项目：右键单击并选择“卸载”
*   从解决方案中删除项目：右键单击并选择“删除”
*   关闭解决方案：右键单击解决方案并选择“关闭”

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-13T12:53:06.567

如果您的意思是如何重新启动当前正在调试的程序，请使用命令“ **Debug -> Restart** ”或按“ **Ctrl+Shift+F5** ”。

# objective-c - 为什么我有时会在书籍“layoutSubviews Method”中阅读，有时会阅读“drawRect: Method”，这是有原因的吗？

> ID：743776
> 
> 赞同：1
> 
> 时间：2009-04-13T12:37:29.007
> 
> 标签：objective-c

我想知道为什么在 Books 和 Apple Documentation 中，有时 Method 以冒号作为后缀，但有时却没有。我猜这意味着如果它没有冒号，它就没有参数。另一方面，如果它有一个冒号，它就只有一个参数。对还是错？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-13T14:50:16.067

您是对的，尾随冒号表示单个参数，并且在代码中使用完整的包含冒号名称很重要——例如`@selector(drawRect:)`

然而，虽然我找不到一个手头的例子，但在散文中，我相信你偶尔会看到编写的方法没有尾随冒号，只是为了让它更好读。我知道我在编写评论/文档时会这样做——例如，当我真正的意思是“子类应该自定义 doFoo 方法”时`doFoo:`。因此，如果您在散文中看到方法名称，最好检查头文件或类参考文档以获取正确的签名。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-13T12:43:18.727

这是正确的，尽管它很容易打错。您应该始终检查文档以确保任何方法的签名以避免任何运行时错误。

**带有签名的方法：**

```
- (void)refresh 
```

将像这样使用：

```
[myObject refresh]; 
```

**带有签名的方法：**

```
- (void)refreshView:(UIView *)view 
```

将像这样使用：

```
[myObject refreshView:view]; 
```

**最后，一个带有签名的方法：**

```
- (void)refreshView:(UIView *)view updateLabels:(BOOL)update 
```

将像这样使用：

```
[myObject refreshView:view updateLabels:YES]; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-13T14:27:55.793

Objective-C`refreshView:`和Objective-C`refreshView`是两种不同的方法。第一个接受一个参数，另一个不接受任何参数。正如你所说。

这很重要，因为这是方法的全名，并且您需要在传递选择器时能够正确编写它。

例如在显示工作表时：

```
- (void)beginSheet:(NSWindow *)sheet 
    modalForWindow:(NSWindow *)docWindow 
    modalDelegate:(id)modalDelegate 
    didEndSelector:(SEL)didEndSelector 
    contextInfo:(void *)contextInfo; 
```

didEndSelector 通常采用以下形式：

```
- (void)sheetDidEnd:(NSWindow *)sheet 
    returnCode:(int)returnCode 
    contextInfo:(void *)contextInfo; 
```

因此在 beginSheet 方法中，这将需要传递给 didEndSelector 参数，如下所示：

```
@selector(sheetDidEnd:returnCode:contextInfo:); 
```

选择器的签名错误会导致在调试时深夜挠头。

# vb.net - DotNetNuke 网站的本地化

> ID：743788
> 
> 赞同：0
> 
> 时间：2009-04-13T12:42:58.867
> 
> 标签：vb.net, localization, dotnetnuke

我在 dnn 的网站上工作。我想更改网站或特定页面的语言。所以我下载了西班牙语（es-es），中文（zh-cn）的语言包并从主机安装它们。接下来，当我更改浏览器的语言时，网站语言并没有改变。在 dnn 5.0 上工作。

请让我知道如何在 dnn 网站中使用语言包。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2011-08-27T10:45:19.020

对于 DotNetNuke 翻译的初始翻译和维护，我建议使用 OmegaT。它直接处理 resx 文件。借助 DNN 的 API，可以下载、翻译和上传内容（例如 HTML 或博客）（如果您需要脚本，请给我留言）。

OmegaT 将翻译存储在它的内存中（一个 TMX 文件，实际上是某种 XML）。它还使用谷歌翻译和类似的东西，并有一个快速的用户界面，与不断等待 DotNetNuke 处理您的更新资源相比，这大大提高了翻译速度。

[有关OmegaT](http://www.omegat.org)的更多信息。已翻译网站和模块的示例：[从荷兰语翻译成英语的网站](http://www.invantive.com)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-13T12:45:43.730

您可能应该在 DotNetNuke 论坛中提出这个问题：http: [//www.dotnetnuke.com/tabid/795/default.aspx](http://www.dotnetnuke.com/tabid/795/default.aspx)。

有一个专门讨论语言包和本地化问题的论坛。您可能会在那里找到答案：http: [//www.dotnetnuke.com/Community/Forums/tabid/795/forumid/77/scope/threads/Default.aspx](http://www.dotnetnuke.com/Community/Forums/tabid/795/forumid/77/scope/threads/Default.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-13T14:45:16.390

语言包并不总是包含网站上所有内容的翻译，尤其是您自己添加的内容。您需要做两件事才能使它们正常工作：

1.  转到管理 > 语言，然后启用您要使用的语言。
2.  打开语言编辑器并开始翻译。在每个资源名称下，您将看到本地化值的编辑文本框和默认值的只读文本框。在大多数情况下，您需要逐字翻译您在“默认值”下看到的内容。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-23T16:19:00.640

我们必须编写自己的菜单提供程序来获取菜单来执行此操作 - 而不是去寻找资源文件，我们去寻找数据库解决方案 - 其他原因也适用于此 - 我们还为此构建了一个界面 - 至于事情像 text/html 模块一样，有一些第三方构建允许您将内容国有化。Apollo 想到了[Apollo Software](http://www.apollo-software.nl/ "阿波罗软件")他们有一些多语言模块

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-29T15:59:40.963

语言包通常只会本地化核心使用的文本，例如“登录”和“设置”。它的设计目的是让您可以拥有一个非英语语言的网站，而不是让您可以在一个网站上拥有多种语言。您可以轻松拥有多个门户，每个门户都使用不同的语言。

为了在一个门户上拥有多个语言环境，您需要使用第三方模块或开发自己的模块。

# c# - ASP.NET MVC 默认参数

> ID：743790
> 
> 赞同：2
> 
> 时间：2009-04-13T12:43:24.997
> 
> 标签：c#, asp.net-mvc, asp.net-mvc-routing

我创建了一条新路线，如下所示：

```
 routes.MapRoute(
     "BlogYMD",
     "blog/date/{year}/{month}/{day}",
     new { controller = "Blog", action = "Date", year = "2009", month="01", day="01" }); 
```

该视图仅返回年、月和日的串联。这适用于 URL 之类的：

[http://localhost/blog/date/2009/01/01](http://localhost/blog/date/2009/01/01)

但是，如果我输入此 URL：

[http://localhost/blog/date/2009](http://localhost/blog/date/2009)

我希望将月份和日期的默认值传递给 date 方法。但是它们不是，该方法上的所有参数都作为空值传入。

我错过了一些明显的东西吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-13T12:57:47.583

您没有显示其余路线，但我怀疑您的 global.asax.CS 中的这条路线上方有另一条路线（例如，默认路线），它与第二个 URL 匹配。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-13T13:48:34.467

声明路由的顺序很重要。您希望在默认路由之前声明您的自定义路由。

# c# - .NET HTTP 解析器

> ID：743794
> 
> 赞同：5
> 
> 时间：2009-04-13T12:44:32.343
> 
> 标签：c#, .net, http, parsing

我正在编写一个应用程序来嗅探一些 HTTP 流量。我正在使用 WinPcap 访问 TCP/IP 数据包。是否有一个库可以帮助我解析 HTTP 消息？

我自己实现了一个基本的解析器，但我想要更成熟的东西：我不断遇到新的变体（分块消息、gzip 压缩等）

.NET 框架可能有一个 HTTP 解析器，但是当 TCP 数据包不是来自直接 TCP 连接时，我看不到任何使用它的方法。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-13T13:10:50.283

长镜头，但你看过[卡西尼源代码](http://blogs.msdn.com/dmitryr/archive/2005/09/27/474534.aspx)吗？
我还在之前的 SO question 中找到了[HTML](https://stackoverflow.com/questions/233648/what-is-the-most-useful-net-library-youve-found/233662#233662) [Agility](http://www.codeplex.com/htmlagilitypack)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-13T13:14:57.700

您可以创建一个虚拟的“http 服务器”并从中提供嗅探的数据包，然后您可以使用.NET 的解析器（HttpWebResponse 或其他）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-05-25T08:58:30.150

查看 HttpMachine | [https://github.com/bvanderveen/httpmachine](https://github.com/bvanderveen/httpmachine)

# c# - 在图像上绘制叠加层

> ID：743801
> 
> 赞同：4
> 
> 时间：2009-04-13T12:47:21.150
> 
> 标签：c#, wpf, xaml, drawing, overlay

我有一个用户可以缩放/滚动的图像。我想在不同的图层上绘制一些矩形/圆圈（例如：为图片中识别的每个人的脸部绘制一个圆圈）。

矩形位置是相对于图像的。

如何创建这样的叠加层？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-11-24T15:58:11.163

一种简单的方法是使用 Canvas 并将画布的背景属性设置为您的照片，然后将圆形或矩形放在其上，并使用 Canvas.Left 和 .Top 属性定位它们。

```
 <Canvas x:Name="myCanvas">
        <Canvas.Background>
            <ImageBrush ImageSource="c:\photo.bmp"/>
        </Canvas.Background>
        <Image Canvas.Top="20" Canvas.Left="20" Height="20" Width="20" Source="c:\circle.bmp"/>
    </Canvas> 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-13T12:59:05.133

我设法做了类似的事情：

*   将图像设置为背景
*   `ItemsControl`在上面放一个透明的
*   设置`ItemsControl.ItemsPanel`为`Canvas`
*   为拖动操作编写处理程序

代码片段：

```
 <ItemsControl x:Name="overlayItemsControl" 
        Background="Transparent"  
        ItemsSource="{Binding Path=Blocks}"
        Width="{Binding ElementName=imageControl, Path=Width}"
        Height="{Binding ElementName=imageControl, Path=Height}"
        ItemContainerStyle="{StaticResource rectStyle}"
        PreviewMouseMove="ItemsControl_PreviewMouseMove"
        PreviewMouseDown="ItemsControl_PreviewMouseDown"
        PreviewMouseUp="ItemsControl_PreviewMouseUp"
        PreviewKeyDown="ItemsControl_PreviewKeyDown">

        <ItemsControl.ItemsPanel>
            <ItemsPanelTemplate>
                <Canvas IsItemsHost="True" />
            </ItemsPanelTemplate>
        </ItemsControl.ItemsPanel>
   ....
</ItemsControl> 
```

# python - 如何将字符串拆分为列表？

> ID：743806
> 
> 赞同：612
> 
> 时间：2009-04-13T12:48:44.750
> 
> 标签：python, list, split, text-segmentation

我希望我的 Python 函数拆分一个句子（输入）并将每个单词存储在一个列表中。我当前的代码拆分句子，但不将单词存储为列表。我怎么做？

```
def split_line(text):

    # split the text
    words = text.split()

    # for each word in the line:
    for word in words:

        # print the word
        print(words) 
```

* * *

## 回答 #1

> 赞同：520
> 
> 时间：2009-04-13T12:54:16.937

```
text.split() 
```

这应该足以将每个单词存储在列表中。 `words`已经是句子中单词的列表，因此不需要循环。

其次，这可能是一个错字，但你的循环有点混乱。如果你真的想使用追加，那就是：

```
words.append(word) 
```

不是

```
word.append(words) 
```

* * *

## 回答 #2

> 赞同：467
> 
> 时间：2009-04-13T12:50:21.970

`text`在任何连续运行的空白处拆分字符串。

```
words = text.split() 
```

在分隔符上拆分字符串`text`：`","`.

```
words = text.split(",") 
```

words 变量将是 a`list`并包含`text`分隔符上拆分的单词。

* * *

## 回答 #3

> 赞同：91
> 
> 时间：2009-04-13T12:54:58.607

[str.split()](https://docs.python.org/2/library/stdtypes.html#str.split)

> 返回字符串**中的单词列表**，使用 sep 作为分隔符...如果未指定 sep 或为 None，则应用不同的拆分算法：连续空格的运行被视为单个分隔符，结果将包含如果字符串具有前导或尾随空格，则在开头或结尾处没有空字符串。

```
>>> line="a sentence with a few words"
>>> line.split()
['a', 'sentence', 'with', 'a', 'few', 'words']
>>> 
```

* * *

## 回答 #4

> 赞同：58
> 
> 时间：2009-04-13T14:24:18.843

根据您打算如何处理句子列表，您可能需要查看[Natural Language Take Kit](http://www.nltk.org/)。它主要处理文本处理和评估。您也可以使用它来解决您的问题：

```
import nltk
words = nltk.word_tokenize(raw_sentence) 
```

这具有拆分标点符号的额外好处。

例子：

```
>>> import nltk
>>> s = "The fox's foot grazed the sleeping dog, waking it."
>>> words = nltk.word_tokenize(s)
>>> words
['The', 'fox', "'s", 'foot', 'grazed', 'the', 'sleeping', 'dog', ',', 
'waking', 'it', '.'] 
```

这使您可以过滤掉任何您不想要的标点符号并仅使用单词。

请注意，`string.split()`如果您不打算对句子进行任何复杂的操作，则使用其他解决方案会更好。

[已编辑]

* * *

## 回答 #5

> 赞同：36
> 
> 时间：2013-07-30T15:32:43.213

这个算法怎么样？在空白处拆分文本，然后修剪标点符号。这会小心地从单词边缘删除标点符号，而不会损害单词内部的撇号，例如`we're`.

```
>>> text
"'Oh, you can't help that,' said the Cat: 'we're all mad here. I'm mad. You're mad.'"

>>> text.split()
["'Oh,", 'you', "can't", 'help', "that,'", 'said', 'the', 'Cat:', "'we're", 'all', 'mad', 'here.', "I'm", 'mad.', "You're", "mad.'"]

>>> import string
>>> [word.strip(string.punctuation) for word in text.split()]
['Oh', 'you', "can't", 'help', 'that', 'said', 'the', 'Cat', "we're", 'all', 'mad', 'here', "I'm", 'mad', "You're", 'mad'] 
```

* * *

## 回答 #6

> 赞同：17
> 
> 时间：2009-04-13T13:46:06.283

> 我希望我的 python 函数拆分一个句子（输入）并将每个单词存储在一个列表中

该`str().split()`方法执行此操作，它需要一个字符串，将其拆分为一个列表：

```
>>> the_string = "this is a sentence"
>>> words = the_string.split(" ")
>>> print(words)
['this', 'is', 'a', 'sentence']
>>> type(words)
<type 'list'> # or <class 'list'> in Python 3.0 
```

您遇到的问题是由于拼写错误，您写`print(words)`的是`print(word)`：

`word`将变量重命名为`current_word`，这就是你所拥有的：

```
def split_line(text):
    words = text.split()
    for current_word in words:
        print(words) 
```

..当你应该做的时候：

```
def split_line(text):
    words = text.split()
    for current_word in words:
        print(current_word) 
```

如果出于某种原因您想在 for 循环中手动构造一个列表，您将使用 list`append()`方法，可能是因为您想将所有单词小写（例如）：

```
my_list = [] # make empty list
for current_word in words:
    my_list.append(current_word.lower()) 
```

或者更简洁一些，使用[list-comprehension](http://docs.python.org/tutorial/datastructures.html#list-comprehensions)：

```
my_list = [current_word.lower() for current_word in words] 
```

* * *

## 回答 #7

> 赞同：16
> 
> 时间：2018-10-24T09:06:30.800

如果您想要列表中的**单词/句子**的所有字符，请执行以下操作：

```
print(list("word"))
#  ['w', 'o', 'r', 'd']

print(list("some sentence"))
#  ['s', 'o', 'm', 'e', ' ', 's', 'e', 'n', 't', 'e', 'n', 'c', 'e'] 
```

* * *

## 回答 #8

> 赞同：14
> 
> 时间：2013-11-28T16:33:44.647

[shlex](https://docs.python.org/library/shlex.html)有一个[`.split()`](https://docs.python.org/library/shlex.html#shlex.split)功能。它的不同之处`str.split()`在于它不保留引号并将引用的短语视为单个单词：

```
>>> import shlex
>>> shlex.split("sudo echo 'foo && bar'")
['sudo', 'echo', 'foo && bar'] 
```

注意：它适用于类 Unix 命令行字符串。它不适用于自然语言处理。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2009-04-13T13:17:13.670

我认为你因为错字而感到困惑。

在循环中替换`print(words)`为将每个单词打印在不同的行上`print(word)`

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2021-01-27T10:58:40.433

在不损害单词内部撇号的情况下拆分单词 请找到 input_1 和 input_2 摩尔定律

```
def split_into_words(line):
    import re
    word_regex_improved = r"(\w[\w']*\w|\w)"
    word_matcher = re.compile(word_regex_improved)
    return word_matcher.findall(line)

#Example 1

input_1 = "computational power (see Moore's law) and "
split_into_words(input_1)

# output 
['computational', 'power', 'see', "Moore's", 'law', 'and']

#Example 2

input_2 = """Oh, you can't help that,' said the Cat: 'we're all mad here. I'm mad. You're mad."""

split_into_words(input_2)
#output
['Oh',
 'you',
 "can't",
 'help',
 'that',
 'said',
 'the',
 'Cat',
 "we're",
 'all',
 'mad',
 'here',
 "I'm",
 'mad',
 "You're",
 'mad'] 
```

# c# - 私有成员变量的 C# 编码标准

> ID：743808
> 
> 赞同：37
> 
> 时间：2009-04-13T12:50:44.543
> 
> 标签：c#, coding-style

我看到了两种常见的私有成员变量编码标准的方法：

```
class Foo
{
    private int _i;
    private string _id;     
} 
```

和

```
class Foo
{
    private int m_i;
    private string m_id; 
} 
```

我相信后者来自 C++。此外，许多人在成员变量（例如`double m_dVal`）之前指定类型以表明它是 double 类型的非常量成员变量？

C#中的约定是什么？

* * *

## 回答 #1

> 赞同：66
> 
> 时间：2009-04-13T12:53:49.857

除了您提到的两个之外，在 C# 中，私有成员没有前缀是很常见的。

```
class Foo
{
    private int i;
    private string id; 
} 
```

这是我使用的，也是[微软内部命名指南](http://blogs.msdn.com/brada/articles/361363.aspx)中推荐的。

另请参阅这些[.NET 命名准则](https://docs.microsoft.com/en-us/dotnet/standard/design-guidelines/naming-guidelines)。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-04-13T12:55:19.867

正如[Brad Abrams 所说：内部编码指南](http://blogs.msdn.com/brada/articles/361363.aspx)：

> 不要为成员变量（`_`、`m_`、`s_`等）使用前缀。如果你想区分局部变量和成员变量，你应该使用“<code>this”。在 C# 和“<code>Me”中。在 VB.NET 中。

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2009-04-13T13:01:13.520

我认为这里的重要原则是你是一致的。如果您喜欢这样做并且与您正在使用的其余代码一致，请使用“_”或“m”前缀。无论您选择什么，坚持下去并始终如一。

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2009-04-13T12:53:45.130

我更喜欢使用你的第一个例子，或者像这样的自动属性，它完全避免在你的类中定义私有字段：

```
public String MyString { get; set; } 
```

使用`prop`代码片段使这些变得非常快。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2009-04-13T12:55:05.970

[正如我在阅读Framework Design Guidelines](https://rads.stackoverflow.com/amzn/click/com/0321545613)中记得的那样，对于私有成员变量确实没有设置约定，除了一个不应该使用匈牙利符号并且一个不应该大写变量名的第一个字母（使用 Camel-casing）。书中的引文支持您的两个示例，并且根本不使用任何前缀。

就个人而言，我更喜欢“m_”前缀。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2009-04-13T13:00:14.083

此处来自 Microsoft 的一般指导：

[http://msdn.microsoft.com/en-us/library/ms229002.aspx](http://msdn.microsoft.com/en-us/library/ms229002.aspx)

C# 中的自动属性很棒，我会尽可能使用它们，但在某些情况下它们对我不起作用，例如在对 set 方法进行类型或值检查时。

一般来说：使用驼峰式大小写，不要在你的名字前加上下划线或类型前缀。

```
public int Age {get; set;} 
```

或者

```
private int age;
public int Age
{
    get { return age; }
    set
    {
        if(value < 0)
            throw new InvalidOperationException("Age > 0");
        age = value;
    }
} 
```

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2009-04-13T13:02:50.707

最好是使用项目中已经使用的任何东西。如果您开始一个新项目，请使用公司中最常用的任何东西。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2009-04-13T14:36:25.833

我更喜欢下划线作为私有非 const 非只读字段的前缀。为什么？原因： 1\. 只需查看变量，我就可以区分字段和局部/参数变量。使用“这个”。对于所有领域都不是一种选择 - 它更长。2、参数与字段有歧义：

```
class Foo
{
  private int id;
  public Foo(int id)
  {
    id = id; //Will compile and work fine. But field will not be initialized.
  }
} 
```

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2009-04-13T14:48:13.683

我个人一直使用您的第一个示例：

```
 public class Foo
    {
        private int _i;
        private string _id;
    } 
```

事实上，这就是我整个团队所使用的。此外，您提到的那个`m_dVal`被称为 Hungarian Notation，这里是[Wikipedia Entry](http://en.wikipedia.org/wiki/Hungarian_notation)。Hungarian Notation 实际上违反了我们团队的编码标准，所以我从不使用它。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-04-13T12:59:29.173

我不喜欢对成员变量使用任何前缀。对于在方法外声明的那些，我使用“this.memberVariableName”来区分它们与在方法内声明的那些。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-04-13T12:56:46.590

我倾向于使用第一个约定，一个简单的下划线。我也没有在名称中指定类型，因为我有 Intellisense 告诉我它是什么（我知道，它可能是一个拐杖）。

最好与您的同事或项目团队成员核对并决定一个约定，其中一些是任意的。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-04-13T13:12:44.570

在 C++ 中，以 _ 开头的标识符被认为是不好的做法，它们应该留作内部使用。我认为这就是为什么在 C# 中使用 _ 作为变量名前缀有时也被认为是不好的做法......尽管没有理由不这样做，因为所有 .NET 内部都被正确封装，这与 C/C++ 不同标准库。

# r - 计算移动平均线

> ID：743812
> 
> 赞同：224
> 
> 时间：2009-04-13T12:52:51.980
> 
> 标签：r, moving-average

我正在尝试使用 R 计算矩阵中一系列值的移动平均值。R 中似乎没有[内置函数](http://www.statmethods.net/management/functions.html)可以让我计算移动平均线。是否有任何套餐提供一个？还是我需要自己写？

* * *

## 回答 #1

> 赞同：236
> 
> 时间：2011-02-01T12:06:50.387

或者您可以简单地使用过滤器计算它，这是我使用的函数：

```
ma <- function(x, n = 5){filter(x, rep(1 / n, n), sides = 2)} 
```

如果使用`dplyr`，请注意在上面的函数中指定`stats::filter`。

* * *

## 回答 #2

> 赞同：160
> 
> 时间：2009-04-13T13:06:55.380

*   [zoo](http://cran.r-project.org/package=zoo)包中的滚动均值/最大值/中位数(rollmean)
*   [TTR](http://cran.r-project.org/package=TTR)中的移动平均线
*   马在[预测](http://cran.r-project.org/package=forecast)

* * *

## 回答 #3

> 赞同：33
> 
> 时间：2015-08-12T20:26:21.840

使用`cumsum`应该是充分和有效的。假设你有一个向量*x并且你想要**n 个*数字的运行总和

```
cx <- c(0,cumsum(x))
rsum <- (cx[(n+1):length(cx)] - cx[1:(length(cx) - n)]) / n 
```

正如@mzuther 在评论中指出的那样，这假设数据中没有 NA。处理这些需要将每个窗口除以非 NA 值的数量。这是一种方法，结合了@Ricardo Cruz 的评论：

```
cx <- c(0, cumsum(ifelse(is.na(x), 0, x)))
cn <- c(0, cumsum(ifelse(is.na(x), 0, 1)))
rx <- cx[(n+1):length(cx)] - cx[1:(length(cx) - n)]
rn <- cn[(n+1):length(cx)] - cn[1:(length(cx) - n)]
rsum <- rx / rn 
```

这仍然存在一个问题，如果窗口中的所有值都是 NA，那么将出现除以零错误。

* * *

## 回答 #4

> 赞同：31
> 
> 时间：2018-12-22T15:00:29.947

在**data.table 1.12.0**中添加了新`frollmean`函数来计算快速和精确的滚动平均值，仔细`NA`处理`NaN`和`+Inf`值`-Inf`。

由于问题中没有可重复的示例，因此这里没有更多要解决的问题。

您可以在手册中找到有关的更多信息`?frollmean`，也可以在线获取[`?frollmean`](https://rdatatable.gitlab.io/data.table/library/data.table/html/froll.html)。

以下手册中的示例：

```
library(data.table)
d = as.data.table(list(1:6/2, 3:8/4))

# rollmean of single vector and single window
frollmean(d[, V1], 3)

# multiple columns at once
frollmean(d, 3)

# multiple windows at once
frollmean(d[, .(V1)], c(3, 4))

# multiple columns and multiple windows at once
frollmean(d, c(3, 4))

## three above are embarrassingly parallel using openmp 
```

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2013-08-21T17:11:53.500

该`caTools`软件包具有非常快速的滚动平均值/最小值/最大值/标准差和其他一些功能。我只使用过`runmean`并且`runsd`它们是迄今为止提到的任何其他软件包中最快的。

* * *

## 回答 #6

> 赞同：10
> 
> 时间：2015-01-16T14:49:35.207

您可以使用`RcppRoll`用 C++ 编写的非常快速的移动平均线。只需调用该`roll_mean`函数。文档可以在[这里](http://cran.r-project.org/web/packages/RcppRoll/RcppRoll.pdf)找到。

否则，这个（较慢的）for循环应该可以解决问题：

```
ma <- function(arr, n=15){
  res = arr
  for(i in n:length(arr)){
    res[i] = mean(arr[(i-n):i])
  }
  res
} 
```

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2016-03-13T02:02:15.557

事实上`RcppRoll`非常好。

[cantdutchthis](https://stackoverflow.com/users/1600821/cantdutchthis)发布的代码必须在第四行更正到窗口被修复：

```
ma <- function(arr, n=15){
  res = arr
  for(i in n:length(arr)){
    res[i] = mean(arr[(i-n+1):i])
  }
  res
} 
```

[这里](http://www.cookbook-r.com/Manipulating_data/Calculating_a_moving_average/)给出了另一种处理缺失的方法。

第三种方法，改进[cantdutchthis](https://stackoverflow.com/users/1600821/cantdutchthis)代码以计算或不计算部分平均值，如下：

```
 ma <- function(x, n=2,parcial=TRUE){
  res = x #set the first values

  if (parcial==TRUE){
    for(i in 1:length(x)){
      t<-max(i-n+1,1)
      res[i] = mean(x[t:i])
    }
    res

  }else{
    for(i in 1:length(x)){
      t<-max(i-n+1,1)
      res[i] = mean(x[t:i])
    }
    res[-c(seq(1,n-1,1))] #remove the n-1 first,i.e., res[c(-3,-4,...)]
  }
} 
```

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2020-04-23T03:59:27.933

下面是示例代码，展示了如何使用[zoo](https://cran.r-project.org/web/packages/zoo/index.html)包中的函数计算*居中移动平均*线和*尾随移动平均线。*`rollmean`

```
library(tidyverse)
library(zoo)

some_data = tibble(day = 1:10)
# cma = centered moving average
# tma = trailing moving average
some_data = some_data %>%
    mutate(cma = rollmean(day, k = 3, fill = NA)) %>%
    mutate(tma = rollmean(day, k = 3, fill = NA, align = "right"))
some_data
#> # A tibble: 10 x 3
#>      day   cma   tma
#>    <int> <dbl> <dbl>
#>  1     1    NA    NA
#>  2     2     2    NA
#>  3     3     3     2
#>  4     4     4     3
#>  5     5     5     4
#>  6     6     6     5
#>  7     7     7     6
#>  8     8     8     7
#>  9     9     9     8
#> 10    10    NA     9 
```

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2017-06-29T14:22:55.180

为了补充 [cantdutchthis](https://stackoverflow.com/users/1600821/cantdutchthis)和[Rodrigo](https://stackoverflow.com/users/5490241/rodrigo-remedio) Remedio 的答案；

```
moving_fun <- function(x, w, FUN, ...) {
  # x: a double vector
  # w: the length of the window, i.e., the section of the vector selected to apply FUN
  # FUN: a function that takes a vector and return a summarize value, e.g., mean, sum, etc.
  # Given a double type vector apply a FUN over a moving window from left to the right, 
  #    when a window boundary is not a legal section, i.e. lower_bound and i (upper bound) 
  #    are not contained in the length of the vector, return a NA_real_
  if (w < 1) {
    stop("The length of the window 'w' must be greater than 0")
  }
  output <- x
  for (i in 1:length(x)) {
     # plus 1 because the index is inclusive with the upper_bound 'i'
    lower_bound <- i - w + 1
    if (lower_bound < 1) {
      output[i] <- NA_real_
    } else {
      output[i] <- FUN(x[lower_bound:i, ...])
    }
  }
  output
}

# example
v <- seq(1:10)

# compute a MA(2)
moving_fun(v, 2, mean)

# compute moving sum of two periods
moving_fun(v, 2, sum) 
```

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2020-09-17T20:51:16.913

您可以计算`x`窗口宽度为的向量的移动平均值`k`：

```
apply(embed(x, k), 1, mean) 
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2020-03-24T18:43:12.413

滑块包可用于此。它的界面经过专门设计，感觉类似于 purrr。它接受任意函数，并且可以返回任何类型的输出。数据帧甚至可以逐行迭代。pkgdown 站点在[这里](https://davisvaughan.github.io/slider/)。

```
library(slider)

x <- 1:3

# Mean of the current value + 1 value before it
# returned as a double vector
slide_dbl(x, ~mean(.x, na.rm = TRUE), .before = 1)
#> [1] 1.0 1.5 2.5

df <- data.frame(x = x, y = x)

# Slide row wise over data frames
slide(df, ~.x, .before = 1)
#> [[1]]
#>   x y
#> 1 1 1
#> 
#> [[2]]
#>   x y
#> 1 1 1
#> 2 2 2
#> 
#> [[3]]
#>   x y
#> 1 2 2
#> 2 3 3 
```

滑块和 data.table 的开销`frollapply()`应该非常低（比动物园快得多）。`frollapply()`对于这里的这个简单示例，看起来要快一些，但请注意，它只接受数字输入，并且输出必须是标量数值。滑块函数是完全通用的，您可以返回任何数据类型。

```
library(slider)
library(zoo)
library(data.table)

x <- 1:50000 + 0L

bench::mark(
  slider = slide_int(x, function(x) 1L, .before = 5, .complete = TRUE),
  zoo = rollapplyr(x, FUN = function(x) 1L, width = 6, fill = NA),
  datatable = frollapply(x, n = 6, FUN = function(x) 1L),
  iterations = 200
)
#> # A tibble: 3 x 6
#>   expression      min   median `itr/sec` mem_alloc `gc/sec`
#>   <bch:expr> <bch:tm> <bch:tm>     <dbl> <bch:byt>    <dbl>
#> 1 slider      19.82ms   26.4ms     38.4    829.8KB     19.0
#> 2 zoo        177.92ms  211.1ms      4.71    17.9MB     24.8
#> 3 datatable    7.78ms   10.9ms     87.9    807.1KB     38.7 
```

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2020-07-18T17:50:21.220

**编辑**：非常高兴地添加`side`参数，例如`Date`向量过去 7 天的移动平均值（或总和，或...）。

* * *

对于只想自己计算的人来说，无非是：

```
# x = vector with numeric data
# w = window length
y <- numeric(length = length(x))

for (i in seq_len(length(x))) {
  ind <- c((i - floor(w / 2)):(i + floor(w / 2)))
  ind <- ind[ind %in% seq_len(length(x))]
  y[i] <- mean(x[ind])
}

y 
```

但是让它独立于 会很有趣`mean()`，因此您可以计算任何“移动”函数！

```
# our working horse:
moving_fn <- function(x, w, fun, ...) {
  # x = vector with numeric data
  # w = window length
  # fun = function to apply
  # side = side to take, (c)entre, (l)eft or (r)ight
  # ... = parameters passed on to 'fun'
  y <- numeric(length(x))
  for (i in seq_len(length(x))) {
    if (side %in% c("c", "centre", "center")) {
      ind <- c((i - floor(w / 2)):(i + floor(w / 2)))
    } else if (side %in% c("l", "left")) {
      ind <- c((i - floor(w) + 1):i)
    } else if (side %in% c("r", "right")) {
      ind <- c(i:(i + floor(w) - 1))
    } else {
      stop("'side' must be one of 'centre', 'left', 'right'", call. = FALSE)
    }
    ind <- ind[ind %in% seq_len(length(x))]
    y[i] <- fun(x[ind], ...)
  }
  y
}

# and now any variation you can think of!
moving_average <- function(x, w = 5, side = "centre", na.rm = FALSE) {
  moving_fn(x = x, w = w, fun = mean, side = side, na.rm = na.rm)
}

moving_sum <- function(x, w = 5, side = "centre", na.rm = FALSE) {
  moving_fn(x = x, w = w, fun = sum, side = side, na.rm = na.rm)
}

moving_maximum <- function(x, w = 5, side = "centre", na.rm = FALSE) {
  moving_fn(x = x, w = w, fun = max, side = side, na.rm = na.rm)
}

moving_median <- function(x, w = 5, side = "centre", na.rm = FALSE) {
  moving_fn(x = x, w = w, fun = median, side = side, na.rm = na.rm)
}

moving_Q1 <- function(x, w = 5, side = "centre", na.rm = FALSE) {
  moving_fn(x = x, w = w, fun = quantile, side = side, na.rm = na.rm, 0.25)
}

moving_Q3 <- function(x, w = 5, side = "centre", na.rm = FALSE) {
  moving_fn(x = x, w = w, fun = quantile, side = side, na.rm = na.rm, 0.75)
} 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2018-09-11T04:34:26.353

虽然有点慢，但您也可以使用 zoo::rollapply 对矩阵执行计算。

```
reqd_ma <- rollapply(x, FUN = mean, width = n) 
```

其中 x 是数据集，FUN = mean 是函数；您也可以将其更改为 min、max、sd 等，width 是滚动窗口。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2019-10-27T08:09:56.113

可以使用[`runner`](https://gogonzo.github.io/runner/)包来移动功能。在这种情况下`mean_run`功能。问题`cummean`在于它不处理`NA`值，但`mean_run`可以。`runner`包还支持不规则的时间序列和窗口可以依赖于日期：

```
library(runner)
set.seed(11)
x1 <- rnorm(15)
x2 <- sample(c(rep(NA,5), rnorm(15)), 15, replace = TRUE)
date <- Sys.Date() + cumsum(sample(1:3, 15, replace = TRUE))

mean_run(x1)
#>  [1] -0.5910311 -0.2822184 -0.6936633 -0.8609108 -0.4530308 -0.5332176
#>  [7] -0.2679571 -0.1563477 -0.1440561 -0.2300625 -0.2844599 -0.2897842
#> [13] -0.3858234 -0.3765192 -0.4280809

mean_run(x2, na_rm = TRUE)
#>  [1] -0.18760011 -0.09022066 -0.06543317  0.03906450 -0.12188853 -0.13873536
#>  [7] -0.13873536 -0.14571604 -0.12596067 -0.11116961 -0.09881996 -0.08871569
#> [13] -0.05194292 -0.04699909 -0.05704202

mean_run(x2, na_rm = FALSE )
#>  [1] -0.18760011 -0.09022066 -0.06543317  0.03906450 -0.12188853 -0.13873536
#>  [7]          NA          NA          NA          NA          NA          NA
#> [13]          NA          NA          NA

mean_run(x2, na_rm = TRUE, k = 4)
#>  [1] -0.18760011 -0.09022066 -0.06543317  0.03906450 -0.10546063 -0.16299272
#>  [7] -0.21203756 -0.39209010 -0.13274756 -0.05603811 -0.03894684  0.01103493
#> [13]  0.09609256  0.09738460  0.04740283

mean_run(x2, na_rm = TRUE, k = 4, idx = date)
#> [1] -0.187600111 -0.090220655 -0.004349696  0.168349653 -0.206571573 -0.494335093
#> [7] -0.222969541 -0.187600111 -0.087636571  0.009742884  0.009742884  0.012326968
#> [13]  0.182442234  0.125737145  0.059094786 
```

还可以指定其他选项，例如`lag`, 并仅滚动`at`特定索引。[包](https://gogonzo.github.io/runner/index.html)和[功能](https://gogonzo.github.io/runner/reference/mean_run.html)文档中的更多内容。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2020-07-19T23:55:36.683

这是一个简单的函数，`filter`演示了一种使用填充处理开始和结束 NA 的方法，并`filter`使用自定义权重计算加权平均值（由 支持）：

```
wma <- function(x) { 
  wts <- c(seq(0.5, 4, 0.5), seq(3.5, 0.5, -0.5))
  nside <- (length(wts)-1)/2
  # pad x with begin and end values for filter to avoid NAs
  xp <- c(rep(first(x), nside), x, rep(last(x), nside)) 
  z <- stats::filter(xp, wts/sum(wts), sides = 2) %>% as.vector 
  z[(nside+1):(nside+length(x))]
} 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2020-07-16T12:11:49.693

```
vector_avg <- function(x){
  sum_x = 0
  for(i in 1:length(x)){
    if(!is.na(x[i]))
      sum_x = sum_x + x[i]
  }
  return(sum_x/length(x))
} 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2020-12-07T15:17:15.937

我使用聚合以及由 rep() 创建的向量。这具有使用 cbind() 一次在数据框中聚合多于 1 列的优点。以下是长度为 1000 的向量 (v) 的移动平均值为 60 的示例：

```
v=1:1000*0.002+rnorm(1000)
mrng=rep(1:round(length(v)/60+0.5), length.out=length(v), each=60)
aggregate(v~mrng, FUN=mean, na.rm=T) 
```

请注意，rep 中的第一个参数是根据向量的长度和要平均的数量，简单地为移动范围获取足够的唯一值；第二个参数保持长度等于向量长度，最后一个参数重复第一个参数的值与平均周期相同的次数。

总的来说，您可以使用多个函数（中值、最大值、最小值） - 例如所示的平均值。同样，可以使用带有 cbind 的公式在数据框中的多个（或所有）列上执行此操作。

# methodology - 示踪子弹开发

> ID：743815
> 
> 赞同：9
> 
> 时间：2009-04-13T12:52:54.570
> 
> 标签：methodology

我正在使用[The Pragmatic Programmer](http://www.pragprog.com/titles/tpp/the-pragmatic-programmer)中提倡的 Tracer Bullet 方法开发客户端服务器应用程序，并希望得到一些建议。我正在处理从客户端启动到服务器并再次返回客户端以显示结果的每个用例。

我可以看到两种方法：

1.  涵盖基本用例，只需编写足够的代码来满足我正在处理的用例，然后再回去充实所有错误处理。
2.  尽可能充实每个用例，捕获所有异常并完善界面，然后再继续下一个用例。

我倾向于第一个选项，但我害怕忘记处理一些异常并在应用程序投入生产时让它咬我。或者留下不清楚的“存根”错误消息。但是，如果我采取第二种选择，那么我想我以后会做出更多的改变。

问题：
当使用示踪子弹开发时，您采用这两种方法中的哪一种，为什么？
或者，我还缺少另一种方法吗？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-04-13T13:13:05.550

据我了解，Tracer Bullet 方法有两个主要目标

1.  尽快解决根本问题
2.  尽快给客户一个有用的结果

您不“打磨”每个用例的动机可能是进一步加快 2\. 的速度。问题是这样做是否会危害 1\. 以及客户是否真的对“未抛光”的结果感兴趣。即使没有，beng 能够快速从客户那里获得反馈肯定是有优势的。

我会说你的想法是可以的，只要

*   您确保没有任何基本问题隐藏在“未抛光”部分中 - 这肯定会发生在错误处理中
*   您可以在问题跟踪器中或通过将 TODO 留在源代码中来跟踪您稍后必须“抛光”的任何内容 - 并在用例正常工作后仔细检查这些内容
*   用例不是那么“粗糙”以至于客户不能/不会给你有用的反馈

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-13T19:24:46.470

如果您采用方法#1，您将有 90% 的功能运行得非常快。但是，您的客户也会认为您已经完成了 90%，并且会想知道为什么要花 9 倍的时间才能完成工作。

如果您采用方法＃1，那么我只会称其为原型并以这种方式对待它。将其表示为除此之外的任何东西只会导致以后的问题。快乐的一天场景只占工作的 10%。剩下的 90% 是让其他场景正常工作，让快乐的一天场景可靠工作。很难让非开发人员相信这一点。我通常在#1 和#2 之间做一些事情。我试图在识别用例和所有场景方面做得相当好。然后，我尝试确定对架构影响最大的场景并着手处理这些场景。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2014-01-12T15:18:04.393

我建议对于 Tracer 子弹，您可以使用阳性 + 阴性测试用例的组合

1.  正面测试用例（*这些将在您的用户故事/功能文档/功能规范中提及）*
2.  负面测试用例（*BAU场景中可以预期的常见负面场景*）（*慎重考虑后可以省略罕见的业务场景。*）

这些测试用例是使用 specflow 运行的以自动化测试。

在您的测试用例中包含常见的否定场景提供了足够的信心，即可以使用底层代码完成后续开发。

在这里分享经验[http://softwarecookie.wordpress.com/2013/12/26/tracer-bullet/](http://softwarecookie.wordpress.com/2013/12/26/tracer-bullet/)

# javascript - 如何从 xml 文件中读取所有带有标签名称及其值的子元素？

> ID：743827
> 
> 赞同：1
> 
> 时间：2009-04-13T12:55:30.740
> 
> 标签：javascript, xml, dom

我有一个 xml 文件，其中我将一些 HTML 内容存储在一个名为`<body>`. 现在我正在尝试使用 JavaScript 中的 XML DOM 读取 body 标记的所有 HTML 内容。

我试过这段代码：

```
var xmlDoc=loadXMLDoc('QID_627.xml');
var bodytag = xmlDoc.getElementsByTagName("body");
document.write(bodytag); 
```

但它在浏览器屏幕上显示 [object HTMLCollection] 消息。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-13T13:00:49.653

试试这个：

```
var xmlDoc=loadXMLDoc('QID_627.xml');
var bodytags = xmlDoc.getElementsByTagName("body");
document.write(bodytags[0]); 
```

`getElementsByTagName`返回一个元素数组（即使只找到一个），因此您需要为数组下标以检索您的元素。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-13T13:24:07.507

Andrew Hare 指出 getElementsByTagName() 总是返回一个数组，所以你必须使用 bodytag[0] 来获取你想要的元素。这是正确的，但并不完整，因为即使您这样做了，您仍然会收到同样无用的“[object *ElementName* ]”消息。

如果您准备使用 document.write() 您可以尝试使用以下命令序列化 body 标签的内容

```
 document.write(bodytag[0].innerHTML); 
```

更好的是直接将源 DOM 节点附加到目标 DOM。

你会使用类似的东西

```
document.getElementById("destinationNodeId").appendChild(bodytag[0]); 
```

从另一个文档附加 DOM 节点可能会出现一些问题，这可能需要您复制节点，或者跳过其他一些环节才能使其工作。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-13T13:00:07.737

你需要使用`document.write(bodytag.toXMLString());`

编辑：Andrew Hare 还指出你需要先下标。我认为您可能仍需要使用该`toXMLString`呼叫。

# c# - 如何保存 VSTO 插件的首选项？

> ID：743852
> 
> 赞同：2
> 
> 时间：2009-04-13T13:10:23.233
> 
> 标签：c#, ms-office, vsto

我为 MS Project 2007 编写了一个 VSTO 插件，它基本上只是将项目数据发布到我们的 Sharepoint 门户。为此，用户每次想要发布时都必须在我们的插件中输入共享点站点名称。

如何保留此信息，以便用户只需输入一次信息？理想情况下，我想将它保存为项目文件的一部分，以便它可以在用户之间移植。如果这不可能，我会满足于它只在单个用户的机器上持续存在。

到目前为止，我最好的解决方案是将项目文件名的映射存储到用户的临时目录中的 Sharepoint 站点，但这似乎不是最干净的做事方式。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-01-10T21:46:22.920

也许您可以使用 IsolatedStorage 存储它：http: [//msdn.microsoft.com/en-us/library/3ak841sy.aspx](http://msdn.microsoft.com/en-us/library/3ak841sy.aspx)

# sharepoint - Sharepoint 服务 (WSS) 作为自定义 Web 应用程序基础架构

> ID：743854
> 
> 赞同：0
> 
> 时间：2009-04-13T13:12:25.600
> 
> 标签：sharepoint, moss, wss, wss-3.0

我们正在开发自己的应用程序基础架构，为我们的客户开发定制的 Web 应用程序，这些应用程序具有标准的 Web 功能，如 CMS、本地化、身份验证等......

自定义应用程序可以是 Web 上的任何业务线/B2B/B2C 应用程序。应用程序可以同时满足 Intranet/Internet 用户的需求。并非所有自定义应用程序都需要 WSS 提供的标准功能，包括 CMS、本地化和搜索

我们是否应该考虑使用 WSS 作为核心框架来开发我们的应用程序基础架构？更重要的是我们不能指望 WSS 为我们做什么

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-13T13:29:07.977

You need to give more information on what you are building. How many users are you trying to cater for? Are these applications going to be accessible over the internet? I would strongly recommend that you install WSS for yourself and evaluate the features and the costs.

WSS provides a basic collaboration infrastructure over and above the services available for ASP.NET. Licencing costs can be quite expensive for internet use, but that is relative to your revenues. Features like publishing are only available in MOSS so your CMS/localization requirements may not be satisfied with WSS. Authentication is provided in ASP.NET and WSS simply provides a mechanism for managing users and setting authorization.

# sql - SQL Server 索引 - 升序或降序，有什么区别？

> ID：743858
> 
> 赞同：152
> 
> 时间：2009-04-13T13:13:37.470
> 
> 标签：sql, sql-server, optimization, indexing

在 MS SQL Server（我使用的是 2005 版）中为一列或多列创建索引时，可以指定每列的索引是升序还是降序。我很难理解为什么这个选择甚至在这里。使用二进制排序技术，查找不是一样快吗？我选择哪个顺序有什么不同？

* * *

## 回答 #1

> 赞同：150
> 
> 时间：2009-04-13T13:20:52.957

这主要在与复合索引一起使用时很重要：

```
CREATE INDEX ix_index ON mytable (col1, col2 DESC); 
```

可用于：

```
SELECT  *
FROM    mytable
ORDER BY
        col1, col2 DESC 
```

或者：

```
SELECT  *
FROM    mytable
ORDER BY
        col1 DESC, col2 
```

，但不适用于：

```
SELECT  *
FROM    mytable
ORDER BY
        col1, col2 
```

单个列上的索引可以有效地用于两种方式的排序。

详情请看我博客中的文章：

*   [**降序索引**](http://explainextended.com/2009/04/27/descending-indexes/)

**更新：**

事实上，即使对于单列索引，这也很重要，尽管它并不那么明显。

想象一下聚集表的列上的索引：

```
CREATE TABLE mytable (
       pk INT NOT NULL PRIMARY KEY,
       col1 INT NOT NULL
)
CREATE INDEX ix_mytable_col1 ON mytable (col1) 
```

上的索引`col1`保持有序的值`col1`以及对行的引用。

由于表是聚集的，所以对行的引用实际上是`pk`. 它们也在 的每个值内排序`col1`。

这意味着索引的叶子实际上是在 上排序的`(col1, pk)`，这个查询：

```
SELECT  col1, pk
FROM    mytable
ORDER BY
        col1, pk 
```

不需要排序。

如果我们创建索引如下：

```
CREATE INDEX ix_mytable_col1_desc ON mytable (col1 DESC) 
```

，则 的值`col1`将按降序排序，但`pk`每个 值中的 值`col1`将按升序排序。

这意味着以下查询：

```
SELECT  col1, pk
FROM    mytable
ORDER BY
        col1, pk DESC 
```

可以送达，`ix_mytable_col1_desc`但不能送达`ix_mytable_col1`。

换句话说，`CLUSTERED INDEX`在任何表上构成 a 的列始终是该表上任何其他索引的尾随列。

* * *

## 回答 #2

> 赞同：79
> 
> 时间：2012-02-21T17:48:55.497

对于真正的单列索引，它与查询优化器的观点几乎没有什么区别。

对于表定义

```
CREATE TABLE T1( [ID] [int] IDENTITY NOT NULL,
                 [Filler] [char](8000) NULL,
                 PRIMARY KEY CLUSTERED ([ID] ASC)) 
```

查询

```
SELECT TOP 10 *
FROM T1
ORDER BY ID DESC 
```

使用带扫描方向的有序扫描，`BACKWARD`如执行计划中所示。然而，有一个细微的差别，目前只有`FORWARD`扫描可以并行化。

![计划](https://i.stack.imgur.com/0RnFz.png)

但是**，它可以在逻辑碎片方面产生很大的不同**。如果索引是使用降序键创建的，但新行附加了升序键值，那么您最终可能会导致每一页都没有逻辑顺序。当扫描表并且它不在缓存中时，这会严重影响 IO 读取的大小。

查看分片结果

```
 avg_fragmentation                    avg_fragment
name   page_count   _in_percent         fragment_count   _size_in_pages
------ ------------ ------------------- ---------------- ---------------
T1     1000         0.4                 5                200
T2     1000         99.9                1000             1 
```

对于下面的脚本

```
/*Uses T1 definition from above*/
SET NOCOUNT ON;

CREATE TABLE T2( [ID] [int] IDENTITY NOT NULL,
                 [Filler] [char](8000) NULL,
                 PRIMARY KEY CLUSTERED ([ID] DESC))

BEGIN TRAN

GO
INSERT INTO T1 DEFAULT VALUES
GO 1000
INSERT INTO T2 DEFAULT VALUES
GO 1000

COMMIT

SELECT object_name(object_id) AS name, 
       page_count, 
       avg_fragmentation_in_percent, 
       fragment_count, 
       avg_fragment_size_in_pages 
FROM 
sys.dm_db_index_physical_stats(db_id(), object_id('T1'), 1, NULL, 'DETAILED') 
WHERE  index_level = 0 
UNION ALL 
SELECT object_name(object_id) AS name, 
       page_count, 
       avg_fragmentation_in_percent, 
       fragment_count, 
       avg_fragment_size_in_pages 
FROM 
sys.dm_db_index_physical_stats(db_id(), object_id('T2'), 1, NULL, 'DETAILED') 
WHERE  index_level = 0 
```

可以使用空间结果选项卡来验证假设这是因为后面的页面在两种情况下都有升序键值。

```
SELECT page_id,
       [ID],
       geometry::Point(page_id, [ID], 0).STBuffer(4)
FROM   T1
       CROSS APPLY sys.fn_PhysLocCracker( %% physloc %% )
UNION ALL
SELECT page_id,
       [ID],
       geometry::Point(page_id, [ID], 0).STBuffer(4)
FROM   T2
       CROSS APPLY sys.fn_PhysLocCracker( %% physloc %% ) 
```

![在此处输入图像描述](https://i.stack.imgur.com/HsHcS.png)

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-04-13T13:14:56.903

当您想要检索大量排序数据而不是单个记录时，排序顺序很重要。

请注意（正如您对您的问题提出的建议），排序顺序通常远不如您要索引的列重要（如果顺序与它想要的相反，系统可以反向读取索引）。我很少考虑索引排序顺序，而我却为索引所涵盖的列而苦恼。

@Quassnoi 提供了一个[很好的例子，说明它](https://stackoverflow.com/questions/743858/sql-server-indexes-ascending-or-descending-what-difference-does-it-make/743870#743870)*什么*时候很重要。

# session - Struts 2.1.6 中的会话处理

> ID：743859
> 
> 赞同：0
> 
> 时间：2009-04-13T13:14:21.337
> 
> 标签：session, login, struts2

我有一个具有以下设置的项目：

```
Tomcat 6.x
Struts 2.1.6
DisplayTag 1.2
Spring 2.x (1 or 5, don't remember now) 
```

我想知道在我的应用程序的每个操作中进行会话控制，比如如果用户没有登录，他们会被重定向到某个页面进行登录（在我的项目中，要么用户来到一个特殊的精心制作的 url，如 login/SPECIALHASHTOLOGIN 或根本不会输入。

需要更多细节？

提前谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-13T13:31:21.327

我也是 S2 的新手，但我相信您需要做的是修改默认拦截器堆栈（或创建自定义堆栈）并添加自定义拦截器。此自定义拦截器将需要实现[SessionAware](http://struts.apache.org/2.0.6/struts2-core/apidocs/org/apache/struts2/interceptor/SessionAware.html)以访问用户会话，并且必须实现您的自定义逻辑（重定向到哪个操作，哪些 URL 不需要保护等）。

这是一个很好的[LoginInterceptor](http://www.vitarara.org/cms/struts_2_cookbook/creating_a_login_interceptor)教程，其行为类似于您所请求的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-24T19:32:24.520

如果您已经在使用 Spring，Acegi 安全性是为您的 Web 应用程序添加安全性的好方法。这是[一个不错的 1 小时 Acegi 教程](http://www.javaworld.com/javaworld/jw-10-2007/jw-10-acegi2.html)。

# app-config - DLL 的配置文件

> ID：743866
> 
> 赞同：4
> 
> 时间：2009-04-13T13:17:14.840
> 
> 标签：app-config

我们的应用程序在运行时从应用程序的根目录加载我们的自定义 DLL（这些 DLL 正在实现某些接口）并通过反射执行方法。

如果自定义 DLL 必须从配置文件中读取一些值，那么我们必须将这些配置设置复制到主应用程序的 app.config 文件中。

有没有办法让每个自定义 DLL 都有自己的名为 .config 的配置文件，并从该文件本身读取其配置设置。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-13T13:54:05.093

If you're on .NET 2.0 or higher, you can manually tell the Configuration system to load the settings from any config file you want.

```
ExeConfigurationFileMap exeMap = new ExeConfigurationFileMap();
exeMap.ExeConfigFilename = "C:\Application\Default.config";

Configuration exeConfig = ConfigurationManager.OpenMappedExeConfiguration(exeMap, ConfigurationUserLevel.None); 
```

Now you have your custom "Config" object and you can party on it! :-) Load a whole section by calling exeConfig.GetSection() or whatever you like.

Also check out this excellent three-part series on .NET 2.0 configuration system on CodeProject - highly recommended!

*   [Unraveling the mysteries of .NET 2.0 configuration](http://www.codeproject.com/KB/dotnet/mysteriesofconfiguration.aspx)
*   [Decoding the mysteries of .NET 2.0 configuration](http://www.codeproject.com/KB/dotnet/mysteriesofconfiguration2.aspx)
*   [Cracking the mysteries of .NET 2.0 configuration](http://www.codeproject.com/KB/dotnet/mysteriesofconfiguration3.aspx)

Marc

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-13T13:23:38.380

将您的 DLL 加载到新的 AppDomain 并设置 AppDomainSetup.ConfigurationFile。这将允许您为每个自定义 DLL 创建单独的配置文件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-13T13:26:58.810

I was certain there is a way to do this in the framework, just can't remember off the top of my head. What you're looking for is Per-Assembly configuration files, I remember reading an article about this [Per Assembly Configuration Files](http://www.bearcanyon.com/dotnet/#AssemblySettings)

# asp.net - 使用 ASP.NET 3.5 和 IIS 7 以编程方式确定 URL 应指向的文件

> ID：743867
> 
> 赞同：0
> 
> 时间：2009-04-13T13:19:05.863
> 
> 标签：asp.net, iis, url

是否可以使用 ASP.NET 和 IIS 以编程方式将 URL 解析为文件？具体来说，我希望该文件位于我的虚拟目录之外（可能位于本地文件系统上的任何位置）。所以如果一个 URL 像[http://mysite/somepicture.jpg](http://mysite/somepicture.jpg)我希望能够返回 c:\mypicture.jpg。我考虑为 URL 重写创建一个 IHttpModule 但这并不是我所需要的——它仅限于现有站点中的 URL。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-13T13:22:08.027

您无法通过 URL 重写来实现它，因为该文件未托管在您的网站上。您应该使用or中`Response.WriteFile`的方法手动将文件流式传输给用户。`HttpModule``HttpHandler`

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-13T13:47:36.733

我想补充一下 Mehrdad 的回复，说您需要确保您的应用程序有权访问您想要存放的文件的文件夹。这样您就可以按照 Mehrdad 的建议将其分发出去。

# oracle - 使用非托管 Oracle 提供程序所需的最小占用空间是多少？

> ID：743868
> 
> 赞同：1
> 
> 时间：2009-04-13T13:19:17.940
> 
> 标签：oracle, oledb, ado

我正在开发一个用 .NET 编写的应用程序。我们目前正在为所有 .NET 操作使用 ODP.NET 11 的 xcopy 部署，一切都很好——我们可以在以前没有安装 Oracle 客户端的机器上运行。Peachy，也就是说，直到我们来到依赖于用 COM 编写的库的应用程序部分，显然（？）不能使用 .NET 提供程序。

为了使 Oracle 的 OLEDB 或 ODBC 提供程序正常工作，我们必须安装最少的东西是多少？

一些额外的细节：

*   我相信任何 OLEDB 或 ODBC 提供程序都足以满足这些目的——性能并不是什么大问题。
*   我们肯定需要将 ODP.NET 11 客户端用于 .NET 内容，因为我们使用的是 11 特定的功能。（所以我们不能只安装 big ol' 10 客户端。）
*   我们最终会有一个安装程序，所以我们可以通过命令行安装我们需要的任何东西，这一点很重要。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-13T15:52:36.853

您可能想查看[Instant Client](http://www.oracle.com/technology/tech/oci/instantclient/index.html)。您将需要基本包以及 ODBC Supplement（使用 ODBC）或 ODAC（使用 OLE DB）。这涉及仅安装少量 DLL 和环境变量作为安装程序的一部分。

# sql - Rails（或者可能是 SQL）：查找和删除重复的 AR 对象

> ID：743873
> 
> 赞同：0
> 
> 时间：2009-04-13T13:21:25.220
> 
> 标签：sql, mysql, ruby-on-rails, ruby, activerecord

'Location' 类的 ActiveRecord 对象（表示 db 表位置）具有属性 'url'、'lat'（纬度）和 'lng'（经度）。

此模型上的 Lat-lng-combinations 应该是唯一的。问题是，数据库中有很多 Location-objects 具有重复的 lat-lng-combinations。

我需要帮助来执行以下操作

1.  查找共享相同 lat-lng-combination 的对象。
2.  如果对象的 'url' 属性不为空，则保留该对象并删除其他重复项。否则只需选择最旧的对象（通过检查属性'created_at'）并删除其他重复项。

由于这是一次性操作，因此也欢迎使用 SQL（兼容 MySQL 5.1）的解决方案。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-13T16:20:25.570

如果这是一次性的事情，那么我会在 Ruby 中完成它，而不必太担心效率。我还没有彻底测试过，请检查排序等，以确保它在你的数据库上运行它之前完全符合你的要求:)

```
keep = []
locations = Location.find(:all)

locations.each do |loc|
  # get all Locations's with the same coords as this one
  same_coords = locations.select { |l| l.lat == loc.lat and \
                                       l.lng == loc.lng }
  with_urls = same_coords.select { |l| !l.url.empty? }

  # decide which list to use depending if there were any urls
  same_coords = with_urls.any? ? with_urls : same_coords

  # pick the best one
  keep << same_coords.sort { |a,b| b.created_at <=> a.created_at }.first.id
end

# only keep unique ids
keep.uniq!

# now we just delete all the rows we didn't decide to keep
locations.each do |loc|
  loc.destroy unless keep.include?( loc.id )
end 
```

现在就像我说的，这绝对是糟糕的、糟糕的代码。但有时仅仅破解有效的东西是值得节省时间思考“更好”的东西，特别是如果它只是一次性的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-13T13:27:22.380

如果您有 2 个 MySQL 列，则可以使用 CONCAT 函数。

```
SELECT * FROM table1 GROUP BY CONCAT(column_lat, column_lng) 
```

如果您需要知道总数

```
SELECT COUNT(*) AS total FROM table1 GROUP BY CONCAT(column_lat, column_lng) 
```

或者，您可以将两者结合起来

```
SELECT COUNT(*) AS total, table1.* FROM table1 
GROUP BY CONCAT(column_lat, column_lng) 
```

但是，如果您可以对您的问题进行更多解释，也许我们可以得到更多相关的答案。

# javascript - 列出使用 jquery 在页面上连接的所有 javascript 事件

> ID：743876
> 
> 赞同：46
> 
> 时间：2009-04-13T13:22:51.707
> 
> 标签：javascript, jquery, events

使用 jQuery，是否可以获得所有事件的列表以及事件绑定到哪个元素？

* * *

## 回答 #1

> 赞同：93
> 
> 时间：2009-04-13T21:00:28.453

jQuery 使这相对容易，因为它将事件处理程序存储在元素数据中。你应该能够使用这样的东西：

```
(function($) {
    $.eventReport = function(selector, root) {
        var s = [];
        $(selector || '*', root).andSelf().each(function() {
            // the following line is the only change
            var e = $.data(this, 'events');
            if(!e) return;
            s.push(this.tagName);
            if(this.id) s.push('#', this.id);
            if(this.className) s.push('.', this.className.replace(/ +/g, '.'));
            for(var p in e) {
                var r = e[p],
                    h = r.length - r.delegateCount;
                if(h)
                    s.push('\n', h, ' ', p, ' handler', h > 1 ? 's' : '');
                if(r.delegateCount) {
                    for(var q = 0; q < r.length; q++)
                        if(r[q].selector) s.push('\n', p, ' for ', r[q].selector);
                }
            }
            s.push('\n\n');
        });
        return s.join('');
    }
    $.fn.eventReport = function(selector) {
        return $.eventReport(selector, this);
    }
})(jQuery); 
```

你可以称之为：

```
// all events
alert($.eventReport());

// just events on inputs
alert($.eventReport('input')); 

// just events assigned to this element
alert($.eventReport('#myelement')); 

// events assigned to inputs in this element
alert($.eventReport('input', '#myelement')); 
alert($('#myelement').eventReport('input')); // same result

// just events assigned to this element's children
alert($('#myelement').eventReport()); 
alert($.eventReport('*', '#myelement'); // same result 
```

**更新：** 我在上述函数的输出中添加了一些处理程序和一些有关委托事件的信息。

**更新（2012 年 8 月 24 日）：** 虽然上述函数在 jQuery 1.7.2 及更低版本中仍然有效，但 jQuery 不再将事件对象存储在其中`jQuery.data(elem, 'events')`，**如果您使用的是 jQuery 1.8 或更高版本，您将无法再使用该函数以上！**

换取`jQuery.data(elem, 'events')`你现在可以使用`jQuery._data(elem, 'events')`. 对上述函数的更新如下所示：

```
(function($) {
    $.eventReport = function(selector, root) {
        var s = [];
        $(selector || '*', root).addBack().each(function() {
            // the following line is the only change
            var e = $._data(this, 'events');
            if(!e) return;
            s.push(this.tagName);
            if(this.id) s.push('#', this.id);
            if(this.className) s.push('.', this.className.replace(/ +/g, '.'));
            for(var p in e) {
                var r = e[p],
                    h = r.length - r.delegateCount;
                if(h)
                    s.push('\n', h, ' ', p, ' handler', h > 1 ? 's' : '');
                if(r.delegateCount) {
                    for(var q = 0; q < r.length; q++)
                        if(r[q].selector) s.push('\n', p, ' for ', r[q].selector);
                }
            }
            s.push('\n\n');
        });
        return s.join('');
    }
    $.fn.eventReport = function(selector) {
        return $.eventReport(selector, this);
    }
})(jQuery); 
```

**更新（2013 年 4 月 25 日）：** `andSelf()`从 1.8.x [http://bugs.jquery.com/ticket/9800](http://bugs.jquery.com/ticket/9800)弃用，我改为替换`addBack()`。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2011-12-12T22:56:59.643

```
// List bound events
console.log($('#elem').data('events'));

// Log ALL handlers for ALL events
$.each($('#elem').data('events'), function(i, event) {
  $.each(event, function(i, handler){
    console.log(handler.toString());
  });
}); 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2013-03-25T14:06:31.320

我用这个来列出所有有界事件的元素。

```
$('*').each(function(){
    var events = $(this).data('events');
    if(events != null)
    {
        console.log(this);
        console.log(events);
    }
}); 
```

也可以通过编写一些额外的代码来收集元素作为每个事件的列表：

```
var eventArrays = {};

$('*').each(function(){
    var events = $(this).data('events');
    for(var anEvent in events){
        if(!eventArrays[anEvent])
            eventArrays[anEvent] = [];
        eventArrays[anEvent].push(this);
    }
});

console.log(eventArrays); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-13T13:25:46.270

我敢打赌，您可以遍历 DOM 并检查每个元素上的 event[属性](http://docs.jquery.com/Attributes/attr#name)，从而构建一个列表……但我从未尝试过。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2015-01-02T19:40:20.043

要使用 console.table() 我做了一些修改......

```
(function($) {
    $.eventReport = function(selector, root) {
        var s = [];
        $(selector || '*', root).addBack().each(function() {
            var e = $._data(this, 'events');
            if(!e) return;
            var tagGroup = this.tagName || "document";
            if(this.id) tagGroup += '#' + this.id;
            if(this.className) tagGroup += '.' + this.className.replace(/ +/g, '.');

            var delegates = [];
            for(var p in e) {
                var r = e[p];
                var h = r.length - r.delegateCount;

                if(h)
                    s.push([tagGroup, p + ' handler' + (h > 1 ? 's' : '')]);

                if(r.delegateCount) {
                    for(var q = 0; q < r.length; q++)
                        if(r[q].selector) s.push([tagGroup + ' delegates', p + ' for ' + r[q].selector]);
                }
            }
        });
        return s;
    }
    $.fn.eventReport = function(selector) {
        return $.eventReport(selector, this);
    }
})(jQuery); 
```

所以现在我可以做这样的事情：

```
console.table($.eventReport()) 
```

看看 chrome 会发生什么： ![chrome中的控制台](https://i.stack.imgur.com/jW5XH.png)

# actionscript-3 - 如何在 flex 3 中有一个类似于谷歌地理地图可视化示例中的悬停详细信息框

> ID：743880
> 
> 赞同：2
> 
> 时间：2009-04-13T13:24:40.377
> 
> 标签：actionscript-3, flex3, hover

我想知道是否有一个已经可用的悬停详细信息组件，类似于[谷歌地理地图可视化示例](http://code.google.com/apis/visualization/documentation/gallery/geomap.html)中显示的显示城市名称及其详细信息的组件，或任何其他可用于悬停详细信息框的类似组件。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-14T05:30:26.653

可以想象，您可以使用 Flex 框架自己的 ToolTip 类来做到这一点。所有标准 Flex 组件（从 UIComponent 派生）都有一个用于创建工具提示的 toolTip 属性。标准的工具提示样式是黄色背景上的黑色文本，但这很容易使用 CSS 进行更改。对于更精细的样式，您可以在 ToolTip 类中的 TextField 上使用 htmlText 属性。

以下是一些示例：[http ://livedocs.adobe.com/flex/3/html/help.html?content=tooltips_3.html](http://livedocs.adobe.com/flex/3/html/help.html?content=tooltips_3.html)

# c# - 如何确定 Console.Out 是否已重定向到文件？

> ID：743885
> 
> 赞同：17
> 
> 时间：2009-04-13T13:27:02.570
> 
> 标签：c#, .net, console

如果我的程序正在打印到控制台，我会根据 Console.WindowWidth 通过插入换行符以某种方式执行自动换行 - 这非常有效。

但是，如果程序的输出被重定向到一个文件或另一个程序，我希望它跳过自动换行。我怎样才能检测到这种情况？

Console.WindowWidth 在两种情况下都返回相同的数字。

**如果解决方案可以区分重定向的 Console.Out 和重定向的 Console.Error，则加分**。****

 *** * *

## 回答 #1

> 赞同：15
> 
> 时间：2013-02-28T12:46:03.050

.NET 4.5 添加`Console.IsOutputRedirected`和`Console.IsErrorRedirected`.

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-04-13T13:40:19.933

p/invoke `GetFileType(GetStdHandle(STD_OUTPUT_HANDLE))`，或调用无害的控制台函数，例如`GetConsoleScreenBufferInfo`检查无效句柄错误。如果您想了解标准错误，请使用`STD_ERROR_HANDLE`. 我相信您甚至可以比较返回的句柄`GetStdHandle(STD_OUTPUT_HANDLE)`并`GetStdHandle(STD_ERROR_HANDLE)`检测`2>&1`.

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-04-13T13:43:51.453

虽然这有点阴暗并且可能不能保证有效，但您可以尝试以下操作：

```
bool isRedirected;

try
{
    isRedirected = Console.CursorVisible && false;
}
catch
{
    isRedirected = true;
} 
```

重定向控制台时调用 CursorVisible 会引发异常。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-13T13:48:55.917

您需要使用反射 - 有点肮脏，但以下将起作用：

```
static bool IsConsoleRedirected()
{
    var writer = Console.Out;
    if (writer == null || writer.GetType ().FullName != "System.IO.TextWriter+SyncTextWriter") return true;
    var fld = writer.GetType ().GetField ("_out", BindingFlags.Instance | BindingFlags.NonPublic);
    if (fld == null) return true;
    var streamWriter = fld.GetValue (writer) as StreamWriter;
    if (streamWriter == null) return true;
    return streamWriter.BaseStream.GetType ().FullName != "System.IO.__ConsoleStream";
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-13T13:36:22.593

为什么输出会包含在重定向文件中？控制台所做的换行不是通过换行符进行的。换句话说，这个字符串：

> 你好，我的名字是安德鲁黑尔

会像这样包裹在一个瘦小的控制台中：

> 你好，我
> 叫安德鲁·
> 黑尔

但是如果你要将输出重定向到一个文件，它会这样写：

> 你好，我的名字是安德鲁黑尔

因为输出中没有真正的换行符。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-13T13:56:52.530

不要那样做！只需传递一个额外的命令行参数，该参数指定您要应用的格式。它更简单、更简洁、更容易被使用您的应用程序的人和将使用您的代码的人理解。

# sqlite - SQLite - 存储多个值

> ID：743889
> 
> 赞同：4
> 
> 时间：2009-04-13T13:28:44.420
> 
> 标签：sqlite

如何在 SQLite 数据库中为同一列的同一行存储和检索多个值？

即我有一个产品列，另一列是商店，我把所有商店都放在了那里，可以得到这个产品：

```
Product: iLamp;
Stores: River's; McWay; Lonnie's; ... 
```

我该如何实施？

先感谢您。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-13T13:39:57.937

如果你很聪明，你*不*会这样做。因为当需要确定哪些商店存有该商品时，您的查询将严重变形。当您的库存控制应用程序尝试插入和删除商店时，它们也会如此。你最终会得到我喜欢称之为 SQL 体操的东西，花费越来越多的时间尝试以最奇怪的方式执行 SQL，这仅仅是因为设计选择不当。

说真的，按照 Codd 的意图，将它们存储在数据库中的不同行中。

将多行组合成一个以分号分隔的字符串比将该字符串分解为元素要容易得多（就 DBMS 而言更快）。

像这样的模式就足够了：

```
Products:
    ProdCode integer primary key
    ProdDesc varchar(50)
Stores:
    StoreCode integer primary key
    StoreDesc varchar(50)
StockLevels:
    StoreCode integer \
    ProdCode  integer / primary key
    Count     integer 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-13T13:40:18.230

就像其他人提到的那样，您可以将其存储为逗号分隔的字符串，然后将其放入数据库中，但就像[ocdecio](https://stackoverflow.com/questions/743889/sqlite-storing-multiple-values/743896#743896)提到的那样，您现在拥有表格的方式是一种糟糕的设计。您应该考虑做一些事情，比如添加另一个表，比如一个`PRODUCT_TO_STORE`有两列的表，一列有产品的键，另一列有商店的键。然后是产品和商店之间的关系，并有助于规范您的数据，这在大多数情况下是一件好事。然后，当您需要查找产品所在的所有商店时，您只需对该`PRODUCT_TO_STORE`表执行查询即可。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-13T13:31:51.810

我会使用像 JSON 这样简单的东西。然而，这是一个糟糕的数据库设计，因为它没有被规范化。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-13T13:43:46.053

更改架构。

不要在同一行的列中存储多个值。

添加一个新表，其中多个值可以存储在各自的行中

坏表设计：
父母：

```
ParentID, values, other columns 
```

好的桌子设计：
父母

```
parentID, other columns 
```

孩子

```
parentID, childID, value 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-13T13:32:38.640

要么存储为每个商店的逗号分隔列表，要么为每对“商店”-产品添加多行。

# web-services - 在长时间运行的 Common Lisp 应用程序中，应该使用什么策略来管理垃圾？

> ID：743893
> 
> 赞同：13
> 
> 时间：2009-04-13T13:30:55.617
> 
> 标签：web-services, garbage-collection, lisp, common-lisp

如果我在 Common Lisp 映像中托管一个长时间运行的应用程序（例如 Web 服务器），我应该使用什么策略来管理垃圾收集器？

我假设，默认情况下，垃圾收集器有权花费很长时间整理堆，有时我无法预测。这可能会以我不希望的方式影响特定的浏览器请求。

Common Lisp 中是否有方法来控制它？也许通过鼓励它以“很少和经常”的方式工作？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-04-13T17:58:27.923

一些 Lisp 实现具有出色的垃圾收集器。一个特殊的问题是 Lisp 应用程序通常对小对象（conses，...）有很高的分配率。

有几件事需要考虑。

*   精确与保守 GC。我不是 Lisp 的保守 GC（Boehm 等）的忠实粉丝。保守 GC 的一个问题是它们无法找到所有垃圾。对于长时间运行的程序来说，这可能是一个问题，并导致碎片和未回收的未使用内存。精确 GC 使用 Lisp 数据的标记信息，可以识别每个对象的每种数据类型。保守的 GC 是为不使用标记数据（C++，...）的编程语言实现而发明的。

*   复制GC，压缩GC。为了防止长时间运行的 Lisps 中的内存碎片，压缩和本地化对象的 GC 可能很有用。当需要重新散列哈希表（因为位置发生变化）时，有时会出现问题。复制 GC 可能需要更多内存（因为内存有一个 from 和一个 to 空间）。但是当 GC 将对象从一个内存空间复制到另一个内存空间时，它会自动使其更紧凑。更高级的 GC（如在 Lisp 机器上）还可以对对象进行排序并在彼此附近分配相同类型的对象 - 假设这将加快访问对象的速度。

*   临时GC。这意味着第一个 GC 阶段专门在主内存中运行，并从内存管理单元获得一些支持，以识别更改的内存区域。扫描主内存比扫描虚拟内存要快，并且只扫描更改的内存区域可以进一步减少工作量。当大量对象被分配并迅速变成垃圾时，这会导致非常短的 GC 暂停。

*   代GC。现在的 GC 通常是分代的。有不止一代，并且在几次 GC 中幸存下来的对象被提升为老一代。通常只有第一代经常被 GC。

*   调音。例如，LispWorks 和 Allegro CL 的 GC 有很多调音旋钮。特别是对于长时间运行的应用程序，阅读手册并调整代数、大小和其他内容是有意义的。

*   虚拟内存。虚拟内存上的 GC 通常非常慢。如果可能，请避免这种情况 - 向机器添加更多 RAM。

*   手动内存管理。例如，CL-HTTP Web 服务器使用**资源**进行一些手动内存管理。这些是可以非常快速地重新初始化的预分配对象池。Lisp Machines 经常使用它。它们的典型用途是在流的读取缓冲区中。与每次读取操作都创建新字符串不同，使用可重用缓冲区很有用。

*   堆栈分配。一些 Common Lisp 允许堆栈分配一些数据 - 离开块然后自动释放内存。这假设在离开块时不再引用内存。请参阅声明`dynamic-extent`。

*   并发GC。通常的 Common Lisp 实现都没有并发 GC 和对并发 Lisp 线程的支持。一些实现有并发的 Lisp 线程，但是 GC 会在它们工作时停止它们。如果 Lisp 实现在 JVM 上运行，比如 ABCL，那么它可能能够使用 JVM 并发/并行 GC。

*   分析内存分配。如果您不确定分配发生在哪里以及 GC 做了什么，则需要使用分析信息找出答案。

如果你的 Lisp 有一个在主内存中运行的精确的分代 GC，那么长时间停顿就很难出现问题。例如，Clozure CL（一个免费的 Common Lisp 实现）在某些平台上具有非常好的 GC 实现。您希望避免虚拟内存中的内存碎片和垃圾收集。如有必要，请使用具有更多主内存的 64 位 Lisp 实现。

指针：

*   Clozure CL，[了解和配置垃圾收集器](http://ccl.clozure.com/manual/chapter15.html)
*   CMUCL，[垃圾收集](http://common-lisp.net/project/cmucl/doc/cmu-user/extensions.html#toc30)
*   LispWorks，[存储管理](http://www.lispworks.com/documentation/lw51/LWUG/html/lwuser-115.htm)
*   Allegro CL，[垃圾收集](http://franz.com/support/documentation/current/doc/gc.htm)

您可以从文档中看到 LispWorks 和 Allegro CL 有很多用于调整 GC 的旋钮。

Common Lisp 有一些处理实现环境的函数。(ROOM) 是一个概述内存使用情况的函数。(ROOM t) 给出了更多细节（这里是 LispWorks）：

```
CL-USER 2 > (room t)
 Generation 0:  Total Size 1823K, Allocated 1090K, Free 725K 
          Segment 2008AAB8: Total Size 507K, Allocated 361K, Free 142K
                    minimum free space 64K, 
                      Awaiting promotion = 0K, sweeps before promotion =10
          Segment 217E7050: Total Size 1315K, Allocated 729K, Free 582K
                    minimum free space 0K, 
                      Awaiting promotion = 0K, sweeps before promotion =2
 Generation 1:  Total Size 1397K, Allocated 513K, Free 871K 
          Segment 20CB9A50: Total Size 68K, Allocated 48K, Free 15K
                    minimum free space 0K, 
                      Awaiting promotion = 0K, sweeps before promotion =4
          Segment 216D7050: Total Size 1088K, Allocated 331K, Free 752K
                    minimum free space 0K, 
                      Awaiting promotion = 0K, sweeps before promotion =4
          Segment 2004E4F8: Total Size 241K, Allocated 133K, Free 103K
                    minimum free space 0K, static
 Generation 2:  Total Size 2884K, Allocated 1290K, Free 1585K 
          Segment 21417050: Total Size 2816K, Allocated 1227K, Free 1584K
                    minimum free space 0K, 
                      Awaiting promotion = 0K, sweeps before promotion =4
          Segment 20DA5DA0: Total Size 68K, Allocated 62K, Free 1K
                    minimum free space 117K, 
                      Awaiting promotion = 0K, sweeps before promotion =4
 Generation 3:  Total Size 19373K, Allocated 19232K, Free 128K 
          Segment 20109A50: Total Size 11968K, Allocated 11963K, Free 0K
                    minimum free space 3K, 
                      Awaiting promotion = 0K, sweeps before promotion =10
          Segment 20DB6E18: Total Size 6528K, Allocated 6396K, Free 128K
                    minimum free space 0K, 
                      Awaiting promotion = 0K, sweeps before promotion =10
          Segment 20CCAAC8: Total Size 876K, Allocated 872K, Free 0K
                    minimum free space 0K, 
                      Awaiting promotion = 0K, sweeps before promotion =10

Total Size 25792K, Allocated 22127K, Free 3310K 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-13T14:06:14.923

自早期以来，垃圾收集已经走过了漫长的道路，并且已经做了很多工作来避免不可预测的长时间等待。对于现代实现，我认为这些已经成为过去。

但是，垃圾收集的细节确实因实现而异。那里没有那么多高质量的 Lisp 实现，所以你应该可以毫不费力地查阅他们关于垃圾收集的文档。

# c# - My IsConnected always returns true

> ID：743895
> 
> 赞同：2
> 
> 时间：2009-04-13T13:31:48.750
> 
> 标签：c#, .net, sockets

Test-cases:

1.  Before connection starts it should return *false*
2.  Connection is closed by other end return *false*
3.  Connection is closed by the client return *false*
4.  Connection exists even if no data is avaliable return *true*

    ```
    class MyConnection
    { 
        //Assume I have all initialization for _socket 
        public bool IsConnected()
        {
            return !(_socket.Poll(1, SelectMode.SelectRead)
                                        && _socket.Available == 0);
        }
        private Socket _socket; 
    ```

    }

    ```
    class Test
    {
       static void Main(string[] args)
       { 
            MyConnection my = new  MyConnection()
            if(my.IsConnected())
               /*always return true even when I am not connected*/;    
       }
    } 
    ```

Any ideas how to prevent that?

* * *

So far, none of the answers were satisfactory....

The following can be done:

```
 public bool IsConnected()
        {

            bool bConnected = false;
            bool bState = _socket.Poll(1, SelectMode.SelectRead);
            try
            {
                if (bState && (_socket.Available == 0))
                    bConnected = false;
                else
                    bConnected = true;
            }
            catch (SocketException)
            {
                //_socket.Available can throw an exception
                bConnected = false;
            }

            return bConnected;
        } 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-13T13:49:04.340

I think your `_socket.Poll()` call is backwards. If the poll fails, that will help the method evaluate as true rather than false. Try this:

```
public bool IsConnected()
{
    return !(!_socket.Poll(1, SelectMode.SelectRead)
                                && _socket.Available == 0);

} 
```

I'm also not sure it's a good idea to make `_socket.Available` part of this check. According to the [documentation](http://msdn.microsoft.com/en-us/library/system.net.sockets.socket.available.aspx), a return value of 0 just means that "no data is queued in the network buffer." That could very easily be true even of a connected socket.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-13T13:38:53.943

I'm not sure exactly what you're trying to achieve, but assuming you're trying to tell if the connection has been broken, this post may be helpful:

[How can I tell if the connection has been broken in my sockets based client?](https://stackoverflow.com/questions/681866/how-can-i-tell-if-the-connection-has-been-broken-in-my-sockets-based-client)

Edit: A troubleshooting step would be to determine which of the two boolean expressions are returning false, or if they are both returning false.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-15T12:29:57.337

在我看来，您可能无法从 Socket 类中获得您期望的功能。我的理解是 Socket 类只知道上次套接字操作时的连接状态。

请注意，[Poll 方法](http://msdn.microsoft.com/en-us/library/system.net.sockets.socket.poll.aspx)有一些限制：

> 此方法无法检测到某些类型的连接问题，例如网络电缆损坏或远程主机被不正常关闭。您必须尝试发送或接收数据以检测此类错误。

这意味着在不正常的断开连接的情况下，套接字继续报告 true 直到随后的套接字操作超时是正常的（这可以解释您在之前的帖子中遇到的几分钟延迟）。

这意味着，如果您想检测不正常的断开连接，您可能需要实现应用程序级别的心跳/ping，如上一个[答案中所建议的那样](https://stackoverflow.com/questions/685951/how-to-check-if-client-socket-disconnected-in-winsock/685986#685986)。您可能需要调整 ping 之间的间隔，否则您会失去一定程度的容错能力，并且延迟峰值可能会导致不必要的断开连接报告。

# c++ - 成员初始化部分的复杂语句？

> ID：743901
> 
> 赞同：2
> 
> 时间：2009-04-13T13:36:29.473
> 
> 标签：c++, member-initialization

我有这个：

```
struct myClass{
    multiset<string,binPred<string> > values ;

    myClass(const char param1, const char param2) : values(less<string>())
    { }
} ; 
```

我需要根据和**`values`**的值使用不同的函子初始化成员。不幸的是，决定使用哪个仿函数的逻辑并不那么简单，一旦构建，我就无法更改其关联的比较仿函数。**`param1`****`param2`****`values`**

所以......我需要将所有决策逻辑放在成员初始化部分，但我不知道如何使用**`?:`**运算符。
是否可以在其中放置更复杂的语句？（如`switch`语句）

如果没有，有没有办法延迟构造，**`values`**所以我可以在构造函数的主体中初始化它？

谢谢。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-13T13:39:41.510

调用一个函数：

```
myClass(const char param1, const char param2) 
             : values( MakeComplicatedDecision( xxx ) ) {
} 
```

并将您的逻辑放入函数中。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-13T13:40:50.757

您可以使用静态成员函数，该函数将接受您拥有的参数并返回必要的值。这完全解决了问题，并允许干净且易于调试的代码。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-13T13:38:04.167

您可以使用指向多重集的指针来获取值，然后`new`在构造函数中使用它来创建它。这会延迟施工，但这确实意味着少量的开销。

# iphone - ObjC - 使用 NSData 和 NSURLRequest 发布 UIImage？

> ID：743903
> 
> 赞同：0
> 
> 时间：2009-04-13T13:37:58.673
> 
> 标签：iphone, objective-c, uikit

我正在尝试使用他们的 API 将图像发布到 TwitPic.com。

但是，我以前从未使用 HTTPPOST 或其他方式发布过图像。

有人告诉我如何使用他们的 api 从 UIImage 发布 NSData 吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-13T14:41:47.240

TwitPic 期待一个[多部分的表单数据](http://www.twitpic.com/api.do#uploadAndPost)。有一个很棒的开源库，叫做[ASIHTTPRequest](http://allseeing-i.com/ASIHTTPRequest/)。

您可以使用他们的 API 并将您的图像作为多部分/表单数据发布。

请参阅下面的示例。

[http://allseeing-i.com/ASIHTTPRequest/How-to-use](http://allseeing-i.com/ASIHTTPRequest/How-to-use)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-13T14:57:39.683

使用该`UIImagePNGRepresentation`函数或其等效的 JPEG 将 UIImage 转换为 NSData：

[http://developer.apple.com/iphone/library/documentation/UIKit/Reference/UIKitFunctionReference/Reference/reference.html#//apple_ref/c/func/UIImagePNGRepresentation](http://developer.apple.com/iphone/library/documentation/UIKit/Reference/UIKitFunctionReference/Reference/reference.html#//apple_ref/c/func/UIImagePNGRepresentation)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-15T11:39:47.757

@杰米：

尝试：

[请求 setData:twitpicImage forKey:@"media"];

如果图像视图实际显示的是存储在磁盘文件中的图像，请使用：

[请求 setFile:theImagePath forKey:@"media"];

这样，ASIHTTPRequest 将从磁盘流式传输图像数据，因此您不必在内存中保留 NSData 实例。

塔

本

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-27T10:39:17.340

代替图像的 setPostValue，使用 setData 代替。

# c# - 如何在 WPF 窗口中隐藏关闭按钮？

> ID：743906
> 
> 赞同：223
> 
> 时间：2009-04-13T13:39:08.173
> 
> 标签：c#, wpf, xaml, button, dialog

我正在 WPF 中编写模式对话框。如何将 WPF 窗口设置为没有关闭按钮？我仍然希望它`WindowState`有一个正常的标题栏。

我找到了`ResizeMode`、`WindowState`和`WindowStyle`，但这些属性都不允许我隐藏关闭按钮但显示标题栏，就像在模式对话框中一样。

* * *

## 回答 #1

> 赞同：293
> 
> 时间：2009-06-06T04:15:13.733

WPF 没有内置属性来隐藏标题栏的关闭按钮，但您可以通过几行 P/Invoke 来实现。

首先，将这些声明添加到您的 Window 类中：

```
private const int GWL_STYLE = -16;
private const int WS_SYSMENU = 0x80000;
[DllImport("user32.dll", SetLastError = true)]
private static extern int GetWindowLong(IntPtr hWnd, int nIndex);
[DllImport("user32.dll")]
private static extern int SetWindowLong(IntPtr hWnd, int nIndex, int dwNewLong); 
```

然后将这段代码放入Window的`Loaded`事件中：

```
var hwnd = new WindowInteropHelper(this).Handle;
SetWindowLong(hwnd, GWL_STYLE, GetWindowLong(hwnd, GWL_STYLE) & ~WS_SYSMENU); 
```

你去了：没有更多的关闭按钮。你也不会在标题栏的左侧有一个窗口图标，这意味着没有系统菜单，即使你右键单击标题栏 - 它们都在一起。

重要提示：**所有这些都是隐藏按钮。**用户仍然可以关闭窗口！如果用户按下`Alt`+`F4`或通过任务栏关闭应用程序，窗口仍将关闭。

如果您不想让窗口在后台线程完成之前关闭，那么您也可以按照 Gabe 的建议覆盖`OnClosing`并设置`Cancel`为 true。

* * *

## 回答 #2

> 赞同：98
> 
> 时间：2010-07-14T15:12:02.197

我刚遇到类似的问题，[Joe White 的解决方案](https://stackoverflow.com/a/958980/3195477)在我看来简单而干净。我重用了它并将其定义为 Window 的附加属性

```
public class WindowBehavior
{
    private static readonly Type OwnerType = typeof (WindowBehavior);

    #region HideCloseButton (attached property)

    public static readonly DependencyProperty HideCloseButtonProperty =
        DependencyProperty.RegisterAttached(
            "HideCloseButton",
            typeof (bool),
            OwnerType,
            new FrameworkPropertyMetadata(false, new PropertyChangedCallback(HideCloseButtonChangedCallback)));

    [AttachedPropertyBrowsableForType(typeof(Window))]
    public static bool GetHideCloseButton(Window obj) {
        return (bool)obj.GetValue(HideCloseButtonProperty);
    }

    [AttachedPropertyBrowsableForType(typeof(Window))]
    public static void SetHideCloseButton(Window obj, bool value) {
        obj.SetValue(HideCloseButtonProperty, value);
    }

    private static void HideCloseButtonChangedCallback(DependencyObject d, DependencyPropertyChangedEventArgs e)
    {
        var window = d as Window;
        if (window == null) return;

        var hideCloseButton = (bool)e.NewValue;
        if (hideCloseButton && !GetIsHiddenCloseButton(window)) {
            if (!window.IsLoaded) {
                window.Loaded += HideWhenLoadedDelegate;
            }
            else {
                HideCloseButton(window);
            }
            SetIsHiddenCloseButton(window, true);
        }
        else if (!hideCloseButton && GetIsHiddenCloseButton(window)) {
            if (!window.IsLoaded) {
                window.Loaded -= ShowWhenLoadedDelegate;
            }
            else {
                ShowCloseButton(window);
            }
            SetIsHiddenCloseButton(window, false);
        }
    }

    #region Win32 imports

    private const int GWL_STYLE = -16;
    private const int WS_SYSMENU = 0x80000;
    [DllImport("user32.dll", SetLastError = true)]
    private static extern int GetWindowLong(IntPtr hWnd, int nIndex);
    [DllImport("user32.dll")]
    private static extern int SetWindowLong(IntPtr hWnd, int nIndex, int dwNewLong);

    #endregion

    private static readonly RoutedEventHandler HideWhenLoadedDelegate = (sender, args) => {
        if (sender is Window == false) return;
        var w = (Window)sender;
        HideCloseButton(w);
        w.Loaded -= HideWhenLoadedDelegate;
    };

    private static readonly RoutedEventHandler ShowWhenLoadedDelegate = (sender, args) => {
        if (sender is Window == false) return;
        var w = (Window)sender;
        ShowCloseButton(w);
        w.Loaded -= ShowWhenLoadedDelegate;
    };

    private static void HideCloseButton(Window w) {
        var hwnd = new WindowInteropHelper(w).Handle;
        SetWindowLong(hwnd, GWL_STYLE, GetWindowLong(hwnd, GWL_STYLE) & ~WS_SYSMENU);
    }

    private static void ShowCloseButton(Window w) {
        var hwnd = new WindowInteropHelper(w).Handle;
        SetWindowLong(hwnd, GWL_STYLE, GetWindowLong(hwnd, GWL_STYLE) | WS_SYSMENU);
    }

    #endregion

    #region IsHiddenCloseButton (readonly attached property)

    private static readonly DependencyPropertyKey IsHiddenCloseButtonKey =
        DependencyProperty.RegisterAttachedReadOnly(
            "IsHiddenCloseButton",
            typeof (bool),
            OwnerType,
            new FrameworkPropertyMetadata(false));

    public static readonly DependencyProperty IsHiddenCloseButtonProperty =
        IsHiddenCloseButtonKey.DependencyProperty;

    [AttachedPropertyBrowsableForType(typeof(Window))]
    public static bool GetIsHiddenCloseButton(Window obj) {
        return (bool)obj.GetValue(IsHiddenCloseButtonProperty);
    }

    private static void SetIsHiddenCloseButton(Window obj, bool value) {
        obj.SetValue(IsHiddenCloseButtonKey, value);
    }

    #endregion

} 
```

然后在 XAML 中，您只需像这样设置它：

```
<Window 
    x:Class="WafClient.Presentation.Views.SampleWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:u="clr-namespace:WafClient.Presentation.Behaviors"
    ResizeMode="NoResize"
    u:WindowBehavior.HideCloseButton="True">
    ...
</Window> 
```

* * *

## 回答 #3

> 赞同：71
> 
> 时间：2012-08-23T11:25:50.050

将`WindowStyle`属性设置为 None 将隐藏控制框和标题栏。无需内核调用。

* * *

## 回答 #4

> 赞同：55
> 
> 时间：2009-05-15T05:23:17.383

这不会摆脱关闭按钮，但会阻止某人关闭窗口。

把它放在你的代码后面的文件中：

```
protected override void OnClosing(CancelEventArgs e)
{
   base.OnClosing(e);
   e.Cancel = true;
} 
```

* * *

## 回答 #5

> 赞同：15
> 
> 时间：2009-10-26T10:05:06.357

要禁用关闭按钮，您应该将以下代码添加到您的 Window 类（代码取自[此处](http://blogs.microsoft.co.il/blogs/tamir/archive/2007/09/26/never-ever-close-me-how-to-disable-close-button-in-wpf.aspx)，经过编辑和重新格式化）：

```
protected override void OnSourceInitialized(EventArgs e)
{
    base.OnSourceInitialized(e);

    HwndSource hwndSource = PresentationSource.FromVisual(this) as HwndSource;

    if (hwndSource != null)
    {
        hwndSource.AddHook(HwndSourceHook);
    }

}

private bool allowClosing = false;

[DllImport("user32.dll")]
private static extern IntPtr GetSystemMenu(IntPtr hWnd, bool bRevert);
[DllImport("user32.dll")]
private static extern bool EnableMenuItem(IntPtr hMenu, uint uIDEnableItem, uint uEnable);

private const uint MF_BYCOMMAND = 0x00000000;
private const uint MF_GRAYED = 0x00000001;

private const uint SC_CLOSE = 0xF060;

private const int WM_SHOWWINDOW = 0x00000018;
private const int WM_CLOSE = 0x10;

private IntPtr HwndSourceHook(IntPtr hwnd, int msg, IntPtr wParam, IntPtr lParam, ref bool handled)
{
    switch (msg)
    {
        case WM_SHOWWINDOW:
            {
                IntPtr hMenu = GetSystemMenu(hwnd, false);
                if (hMenu != IntPtr.Zero)
                {
                    EnableMenuItem(hMenu, SC_CLOSE, MF_BYCOMMAND | MF_GRAYED);
                }
            }
            break;
        case WM_CLOSE:
            if (!allowClosing)
            {
                handled = true;
            }
            break;
    }
    return IntPtr.Zero;
} 
```

此代码还禁用系统菜单中的关闭项，并禁止使用 Alt+F4 关闭对话框。

您可能希望以编程方式关闭窗口。只是打电话是`Close()`行不通的。做这样的事情：

```
allowClosing = true;
Close(); 
```

* * *

## 回答 #6

> 赞同：10
> 
> 时间：2013-06-22T10:04:11.677

我正在尝试 Viachaslau 的回答，因为我喜欢不删除按钮而是禁用它的想法，但由于某种原因，它并不总是有效：关闭按钮仍然启用，但没有任何错误。

另一方面，这始终有效（省略了错误检查）：

```
[DllImport( "user32.dll" )]
private static extern IntPtr GetSystemMenu( IntPtr hWnd, bool bRevert );
[DllImport( "user32.dll" )]
private static extern bool EnableMenuItem( IntPtr hMenu, uint uIDEnableItem, uint uEnable );

private const uint MF_BYCOMMAND = 0x00000000;
private const uint MF_GRAYED = 0x00000001;
private const uint SC_CLOSE = 0xF060;
private const int WM_SHOWWINDOW = 0x00000018;

protected override void OnSourceInitialized( EventArgs e )
{
  base.OnSourceInitialized( e );
  var hWnd = new WindowInteropHelper( this );
  var sysMenu = GetSystemMenu( hWnd.Handle, false );
  EnableMenuItem( sysMenu, SC_CLOSE, MF_BYCOMMAND | MF_GRAYED );
} 
```

* * *

## 回答 #7

> 赞同：9
> 
> 时间：2014-04-29T13:05:06.483

要设置的属性是 =>`WindowStyle="None"`

```
<Window x:Class="mdaframework.MainWindow"
            xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
            xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
            Title="Start" Height="350" Width="525" ResizeMode="NoResize"  WindowStartupLocation="CenterScreen" WindowStyle="None"> 
```

* * *

## 回答 #8

> 赞同：9
> 
> 时间：2014-12-05T07:02:22.803

我只是使用交互行为添加了我对[Joe White 答案的](https://stackoverflow.com/a/958980/911929)实现（您需要参考 System.Windows.Interactivity）。

代码：

```
public class HideCloseButtonOnWindow : Behavior<Window>
{
    #region bunch of native methods

    private const int GWL_STYLE = -16;
    private const int WS_SYSMENU = 0x80000;

    [DllImport("user32.dll", SetLastError = true)]
    private static extern int GetWindowLong(IntPtr hWnd, int nIndex);

    [DllImport("user32.dll")]
    private static extern int SetWindowLong(IntPtr hWnd, int nIndex, int dwNewLong);

    #endregion

    protected override void OnAttached()
    {
        base.OnAttached();
        AssociatedObject.Loaded += OnLoaded;
    }

    protected override void OnDetaching()
    {
        AssociatedObject.Loaded -= OnLoaded;
        base.OnDetaching();
    }

    private void OnLoaded(object sender, RoutedEventArgs e)
    {
        var hwnd = new WindowInteropHelper(AssociatedObject).Handle;
        SetWindowLong(hwnd, GWL_STYLE, GetWindowLong(hwnd, GWL_STYLE) & ~WS_SYSMENU);
    }
} 
```

用法：

```
<Window x:Class="WpfApplication2.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:i="http://schemas.microsoft.com/expression/2010/interactivity"
        xmlns:w="clr-namespace:WpfApplication2">

    <i:Interaction.Behaviors>
        <w:HideCloseButtonOnWindow />
    </i:Interaction.Behaviors>

</Window> 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2010-08-06T08:06:00.240

让用户“关闭”窗口，但实际上只是隐藏它。

在窗口的 OnClosing 事件中，如果已经可见，则隐藏窗口：

```
 If Me.Visibility = Windows.Visibility.Visible Then
        Me.Visibility = Windows.Visibility.Hidden
        e.Cancel = True
    End If 
```

每次执行后台线程时，重新显示后台 UI 窗口：

```
 w.Visibility = Windows.Visibility.Visible
    w.Show() 
```

终止程序执行时，确保所有窗口都/可以关闭：

```
Private Sub CloseAll()
    If w IsNot Nothing Then
        w.Visibility = Windows.Visibility.Collapsed ' Tell OnClosing to really close
        w.Close()
    End If
End Sub 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-04-13T14:55:50.530

所以，这几乎是你的问题。窗口框架右上角的关闭按钮不是 WPF 窗口的一部分，但它属于由您的操作系统控制的窗口框架部分。这意味着您必须使用 Win32 互操作来执行此操作。

或者，您可以使用 noframe 并提供您自己的“框架”或根本没有框架。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2010-04-11T00:54:25.947

以下是关于禁用关闭和最大化/最小化按钮，它实际上并*没有*删除按钮（但它确实删除了菜单项！）。标题栏上的按钮以禁用/灰色状态绘制。（我还没有准备好自己接管所有功能^^）

这与 Virgoss 解决方案略有不同，因为它删除了菜单项（以及尾随分隔符，如果需要），而不仅仅是禁用它们。它与 Joe Whites 解决方案不同，因为它不会禁用整个系统菜单，因此，就我而言，我可以保留最小化按钮和图标。

以下代码还支持禁用最大化/最小化按钮，因为与关闭按钮不同，从菜单中删除条目不会导致系统将按钮呈现为“禁用”，即使删除菜单条目*确实会*禁用按钮的功能。

这个对我有用。YMMV。

```
 using System;
    using System.Collections.Generic;
    using System.Text;

    using System.Runtime.InteropServices;
    using Window = System.Windows.Window;
    using WindowInteropHelper = System.Windows.Interop.WindowInteropHelper;
    using Win32Exception = System.ComponentModel.Win32Exception;

    namespace Channelmatter.Guppy
    {

        public class WindowUtil
        {
            const int MF_BYCOMMAND = 0x0000;
            const int MF_BYPOSITION = 0x0400;

            const uint MFT_SEPARATOR = 0x0800;

            const uint MIIM_FTYPE = 0x0100;

            [DllImport("user32", SetLastError=true)]
            private static extern uint RemoveMenu(IntPtr hMenu, uint nPosition, uint wFlags);

            [DllImport("user32", SetLastError=true)]
            private static extern IntPtr GetSystemMenu(IntPtr hWnd, bool bRevert);

            [DllImport("user32", SetLastError=true)]
            private static extern int GetMenuItemCount(IntPtr hWnd);

            [StructLayout(LayoutKind.Sequential)]
            public struct MenuItemInfo {
                public uint   cbSize;
                public uint   fMask;
                public uint   fType;
                public uint   fState;
                public uint   wID;
                public IntPtr hSubMenu;
                public IntPtr hbmpChecked;
                public IntPtr hbmpUnchecked;
                public IntPtr dwItemData; // ULONG_PTR
                public IntPtr dwTypeData;
                public uint   cch;
                public IntPtr hbmpItem;
            };

            [DllImport("user32", SetLastError=true)]
            private static extern int GetMenuItemInfo(
                IntPtr hMenu, uint uItem,
                bool fByPosition, ref MenuItemInfo itemInfo);

            public enum MenuCommand : uint
            {
                SC_CLOSE = 0xF060,
                SC_MAXIMIZE = 0xF030,
            }

            public static void WithSystemMenu (Window win, Action<IntPtr> action) {
                var interop = new WindowInteropHelper(win);
                IntPtr hMenu = GetSystemMenu(interop.Handle, false);
                if (hMenu == IntPtr.Zero) {
                    throw new Win32Exception(Marshal.GetLastWin32Error(),
                        "Failed to get system menu");
                } else {
                    action(hMenu);
                }
            }

            // Removes the menu item for the specific command.
            // This will disable and gray the Close button and disable the
            // functionality behind the Maximize/Minimuze buttons, but it won't
            // gray out the Maximize/Minimize buttons. It will also not stop
            // the default Alt+F4 behavior.
            public static void RemoveMenuItem (Window win, MenuCommand command) {
                WithSystemMenu(win, (hMenu) => {
                    if (RemoveMenu(hMenu, (uint)command, MF_BYCOMMAND) == 0) {
                        throw new Win32Exception(Marshal.GetLastWin32Error(),
                            "Failed to remove menu item");
                    }
                });
            }

            public static bool RemoveTrailingSeparator (Window win) {
                bool result = false; // Func<...> not in .NET3 :-/
                WithSystemMenu(win, (hMenu) => {
                    result = RemoveTrailingSeparator(hMenu);
                });
                return result;
            }

            // Removes the final trailing separator of a menu if it exists.
            // Returns true if a separator is removed.
            public static bool RemoveTrailingSeparator (IntPtr hMenu) {
                int menuItemCount = GetMenuItemCount(hMenu);
                if (menuItemCount < 0) {
                    throw new Win32Exception(Marshal.GetLastWin32Error(),
                        "Failed to get menu item count");
                }
                if (menuItemCount == 0) {
                    return false;
                } else {
                    uint index = (uint)(menuItemCount - 1);
                    MenuItemInfo itemInfo = new MenuItemInfo {
                        cbSize = (uint)Marshal.SizeOf(typeof(MenuItemInfo)),
                        fMask = MIIM_FTYPE,
                    };

                    if (GetMenuItemInfo(hMenu, index, true, ref itemInfo) == 0) {
                        throw new Win32Exception(Marshal.GetLastWin32Error(),
                            "Failed to get menu item info");
                    }

                    if (itemInfo.fType == MFT_SEPARATOR) {
                        if (RemoveMenu(hMenu, index, MF_BYPOSITION) == 0) {
                            throw new Win32Exception(Marshal.GetLastWin32Error(),
                                "Failed to remove menu item");
                        }
                        return true;
                    } else {
                        return false;
                    }
                }
            }

            private const int GWL_STYLE = -16;

            [Flags]
            public enum WindowStyle : int
            {
                WS_MINIMIZEBOX = 0x00020000,
                WS_MAXIMIZEBOX = 0x00010000,
            }

            // Don't use this version for dealing with pointers
            [DllImport("user32", SetLastError=true)]
            private static extern int SetWindowLong (IntPtr hWnd, int nIndex, int dwNewLong);

            // Don't use this version for dealing with pointers
            [DllImport("user32", SetLastError=true)]
            private static extern int GetWindowLong (IntPtr hWnd, int nIndex);

            public static int AlterWindowStyle (Window win,
                WindowStyle orFlags, WindowStyle andNotFlags) 
            {
                var interop = new WindowInteropHelper(win);

                int prevStyle = GetWindowLong(interop.Handle, GWL_STYLE);
                if (prevStyle == 0) {
                    throw new Win32Exception(Marshal.GetLastWin32Error(),
                        "Failed to get window style");
                }

                int newStyle = (prevStyle | (int)orFlags) & ~((int)andNotFlags);
                if (SetWindowLong(interop.Handle, GWL_STYLE, newStyle) == 0) {
                    throw new Win32Exception(Marshal.GetLastWin32Error(),
                        "Failed to set window style");
                }
                return prevStyle;
            }

            public static int DisableMaximizeButton (Window win) {
                return AlterWindowStyle(win, 0, WindowStyle.WS_MAXIMIZEBOX);
            }
        }
    } 
```

用法：这必须在源初始化之后完成。一个好地方是使用 Window 的 SourceInitialized 事件：

```
Window win = ...; /* the Window :-) */
WindowUtil.DisableMaximizeButton(win);
WindowUtil.RemoveMenuItem(win, WindowUtil.MenuCommand.SC_MAXIMIZE);
WindowUtil.RemoveMenuItem(win, WindowUtil.MenuCommand.SC_CLOSE);
while (WindowUtil.RemoveTrailingSeparator(win)) 
{
   //do it here
} 
```

要禁用 Alt+F4 功能，最简单的方法是连接 Canceling 事件并在您确实想要关闭窗口时使用设置标志。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2019-01-11T17:42:08.983

这不会隐藏按钮，但会阻止用户通过关闭窗口继续前进。

```
protected override void OnClosing(System.ComponentModel.CancelEventArgs e)
{            
    if (e.Cancel == false)
    {
        Application.Current.Shutdown();
    }
} 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2021-08-26T13:37:27.530

以下是我使用自定义样式实现类似目标的方法，而无需 DllImports 和 P/Invoke 调用。这将删除现有的标题栏，`WindowStyle="none"`并显示一个具有相似背景颜色的“TextBlock”以指示为标题栏。

[![在此处输入图像描述](https://i.stack.imgur.com/IMl9v.png)](https://i.stack.imgur.com/IMl9v.png)

XAML 代码

```
<Window x:Class="AddBook"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:controls="http://wpftoolkit.my-libraries.com/v5" 
    WindowStartupLocation="CenterOwner"        
    ResizeMode="NoResize" 
    Style="{DynamicResource WindowStyleX}"
    ShowInTaskbar="False"
    ShowActivated="True"
    SizeToContent="Height"
    Title="Add New Book" 
    Width="450">
..............

</Window> 
```

XAML

```
<Style x:Key="WindowStyleX" TargetType="{x:Type Window}">
<Setter Property="WindowStyle" Value="None" />
<Setter Property="AllowsTransparency" Value="False" />
<Setter Property="ResizeMode" Value="NoResize" />
<Setter Property="Background" Value="White" />
<Setter Property="BorderThickness" Value="1" />
<Setter Property="Template">
    <Setter.Value>
        <ControlTemplate TargetType="{x:Type Window}">
            <Border BorderBrush="{DynamicResource BlackColor}" BorderThickness="1">
                <Grid Background="{TemplateBinding Background}">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="30" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>
                    <Border
                        Grid.Row="0"
                        Grid.ColumnSpan="2"
                        Background="{DynamicResource BlackColor}">
                        <Grid>
                            <TextBlock
                                Grid.Column="1"
                                Margin="10,0,0,0"
                                HorizontalAlignment="Left"
                                VerticalAlignment="Center"
                                FontSize="16"
                                Foreground="{DynamicResource WhiteTextForeground}"
                                Text="{TemplateBinding Title}" />
                        </Grid>
                    </Border>
                    <ContentPresenter Grid.Row="1" />
                </Grid>
            </Border>
        </ControlTemplate>
    </Setter.Value>
</Setter> 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-04-13T13:45:54.553

XAML 代码

```
<Button Command="Open" Content="_Open">
    <Button.Style>
        <Style TargetType="Button">
            <Style.Triggers>
                <Trigger Property="IsEnabled" Value="False">
                    <Setter Property="Visibility" Value="Collapsed" />
                </Trigger>
            </Style.Triggers>
        </Style>
     </Button.Style>
</Button> 
```

应该管用

**编辑**- 就你而言，这个[线程](http://social.expression.microsoft.com/Forums/en-US/wpf/thread/cb7cd66c-1837-4e1a-a554-cf8a77937d53/)显示了如何做到这一点，但我认为 Window 没有一个属性可以在不丢失正常标题栏的情况下获得你想要的东西。

**编辑 2** 此[线程](http://khason.net/blog/never-ever-close-me-how-to-disable-close-button-in-wpf/)显示了一种完成方法，但您必须将自己的样式应用于系统菜单，它显示了一种方法，您可以如何做到这一点。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2013-09-12T17:05:11.083

如其他答案所述，您可以使用`WindowStyle="None"`完全删除标题栏。

而且，正如对其他答案的评论中所述，这可以防止窗口被拖动，因此很难将其从初始位置移动。

但是，您可以通过在 Window 的 Code Behind 文件中的构造函数中添加一行代码来克服这个问题：

```
MouseDown += delegate { DragMove(); }; 
```

或者，如果您更喜欢 Lambda 语法：

```
MouseDown += (sender, args) => DragMove(); 
```

这使得整个 Window 可拖动。Window 中存在的任何交互式控件，例如 Button，仍将正常工作，并且不会充当 Window 的拖动句柄。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2016-08-06T15:57:32.313

尝试向窗口添加关闭事件。将此代码添加到事件处理程序。

```
e.Cancel = true;
```

这将防止窗口关闭。这与隐藏关闭按钮的效果相同。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2017-03-21T18:24:30.940

使用这个，从[https://stephenhaunts.com/2014/09/25/remove-the-close-button-from-a-wpf-window](https://stephenhaunts.com/2014/09/25/remove-the-close-button-from-a-wpf-window)修改：

```
using System;
using System.Runtime.InteropServices;
using System.Windows;
using System.Windows.Input;
using System.Windows.Interop;
using System.Windows.Media;

namespace Whatever
{
    public partial class MainMenu : Window
    {
        private const int GWL_STYLE = -16;
        private const int WS_SYSMENU = 0x00080000;

        [DllImport("user32.dll", SetLastError = true)]
        private static extern int GetWindowLongPtr(IntPtr hWnd, int nIndex);

        [DllImport("user32.dll")]
        private static extern int SetWindowLong(IntPtr hWnd, int nIndex, int dwNewLong);

        public MainMenu()
        {
             InitializeComponent();
             this.Loaded += new RoutedEventHandler(Window_Loaded);
        }

        private void Window_Loaded(object sender, RoutedEventArgs e)
        {
            var hwnd = new WindowInteropHelper(this).Handle;
            SetWindowLongPtr(hwnd, GWL_STYLE, GetWindowLongPtr(hwnd, GWL_STYLE) & ~WS_SYSMENU);
        }  

    }
} 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2020-07-13T19:18:52.833

我非常喜欢这个使用附加属性来调解行为的[答案。](https://stackoverflow.com/a/3247575)但是，我发现答案的实现过于复杂，而且它也没有解决即使使用`Alt`+也无法关闭窗口的次要目标`F4`。所以我提供了这个替代方案：

```
enum CloseButtonVisibility
{
    Visible,
    Hidden,
    CloseDisabled,
}

static class WindowEx
{
    private static readonly CancelEventHandler _cancelCloseHandler = (sender, e) => e.Cancel = true;

    public static readonly DependencyProperty CloseButtonVisibilityProperty =
        DependencyProperty.RegisterAttached(
            "CloseButtonVisibility",
            typeof(CloseButtonVisibility),
            typeof(WindowEx),
            new FrameworkPropertyMetadata(CloseButtonVisibility.Visible, new PropertyChangedCallback(_OnCloseButtonChanged)));

    [AttachedPropertyBrowsableForType(typeof(Window))]
    public static CloseButtonVisibility GetCloseButtonVisibility(Window obj)
    {
        return (CloseButtonVisibility)obj.GetValue(CloseButtonVisibilityProperty);
    }

    [AttachedPropertyBrowsableForType(typeof(Window))]
    public static void SetCloseButtonVisibility(Window obj, CloseButtonVisibility value)
    {
        obj.SetValue(CloseButtonVisibilityProperty, value);
    }

    private static void _OnCloseButtonChanged(DependencyObject d, DependencyPropertyChangedEventArgs e)
    {
        if (!(d is Window window))
        {
            return;
        }

        if (e.OldValue is CloseButtonVisibility oldVisibility)
        {
            if (oldVisibility == CloseButtonVisibility.CloseDisabled)
            {
                window.Closing -= _cancelCloseHandler;
            }
        }

        if (e.NewValue is CloseButtonVisibility newVisibility)
        {
            if (newVisibility == CloseButtonVisibility.CloseDisabled)
            {
                window.Closing += _cancelCloseHandler;
            }

            if (!window.IsLoaded)
            {
                // NOTE: if the property is set multiple times before the window is loaded,
                // the window will wind up with multiple event handlers. But they will all
                // set the same value, so this is fine from a functionality point of view.
                //
                // The handler is never unsubscribed, so there is some nominal overhead there.
                // But it would be incredibly unusual for this to be set more than once
                // before the window is loaded, and even a handful of delegate instances
                // being around that are no longer needed is not really a big deal.
                window.Loaded += _ApplyCloseButtonVisibility;
            }
            else
            {
                _SetVisibility(window, newVisibility);
            }
        }
    }

    #region Win32 imports

    private const int GWL_STYLE = -16;
    private const int WS_SYSMENU = 0x80000;
    [DllImport("user32.dll", SetLastError = true)]
    private static extern int GetWindowLong(IntPtr hWnd, int nIndex);
    [DllImport("user32.dll")]
    private static extern int SetWindowLong(IntPtr hWnd, int nIndex, int dwNewLong);

    #endregion

    private static void _ApplyCloseButtonVisibility(object sender, RoutedEventArgs e)
    {
        Window window = (Window)sender;
        CloseButtonVisibility visibility = GetCloseButtonVisibility(window);

        _SetVisibility(window, visibility);
    }

    private static void _SetVisibility(Window window, CloseButtonVisibility visibility)
    {
        var hwnd = new WindowInteropHelper(window).Handle;

        if (visibility == CloseButtonVisibility.Visible)
        {
            SetWindowLong(hwnd, GWL_STYLE, GetWindowLong(hwnd, GWL_STYLE) | WS_SYSMENU);
        }
        else
        {
            SetWindowLong(hwnd, GWL_STYLE, GetWindowLong(hwnd, GWL_STYLE) & ~WS_SYSMENU);
        }
    }
} 
```

这提供了三种状态可供选择：

1.  可见的
2.  隐藏，但用户仍然可以使用`Alt`+关闭`F4`
3.  隐藏，关闭完全禁用

请注意，默认情况下，从不关闭的窗口将阻止 WPF 程序的进程终止。因此，如果您选择使用该`CloseButtonVisibility.CloseDisabled`值，您将需要自定义`Application.Run()`行为，或者在退出前重新启用窗口关闭。例如，在你的主窗口中，你可能有这样的东西：

```
protected override void OnClosed(EventArgs e)
{
    WindowEx.SetCloseButtonVisibility(this.toolWindow.Value, CloseButtonVisibility.Hidden);
    this.toolWindow.Value.Close();

    base.OnClosed(e);
} 
```

禁用关闭按钮的窗口`toolWindow`的参考在哪里。`Window`

以上假设窗口通常只是在正常 UI 活动期间隐藏并根据需要显示。当然，您也可以随时选择显式关闭窗口，但同样的技术——将选项设置为不禁用关闭，然后显式关闭窗口——仍然适用。

* * *

## 回答 #19

> 赞同：-1
> 
> 时间：2013-07-30T10:25:11.940

转到窗口属性集

```
window style = none; 
```

你不会得到关闭按钮...

* * *

## 回答 #20

> 赞同：-1
> 
> 时间：2017-04-26T23:41:38.340

如果只需要禁止用户关闭窗口，这是一个简单的解决方案。

XAML 代码： `IsCloseButtonEnabled="False"`

它阻止了按钮。

* * *

## 回答 #21

> 赞同：-1
> 
> 时间：2018-01-16T14:18:50.633

在寻找了很多答案之后，我制定了这个简单的解决方案，我将在这里分享，希望它可以帮助其他人。

我设置`WindowStyle=0x10000000`。

这将设置 Window Style 的`WS_VISIBLE (0x10000000)`和`WS_OVERLAPPED (0x0)`值。“重叠”是显示标题栏和窗口边框的必要值。通过从我的样式值中删除`WS_MINIMIZEBOX (0x20000)`、`WS_MAXIMIZEBOX (0x10000)`和`WS_SYSMENU (0x80000)`值，标题栏中的所有按钮都被删除，包括关闭按钮。

* * *

## 回答 #22

> 赞同：-2
> 
> 时间：2012-04-25T17:29:39.687

使用`WindowStyle="SingleBorderWindow"`，这将从 WPF 窗口中隐藏最大和最小按钮。

# .net - Try Catches 仍然有用吗？

> ID：743918
> 
> 赞同：9
> 
> 时间：2009-04-13T13:43:47.240
> 
> 标签：.net, asp.net, asp.net-mvc

当我第一次开始在 .NET 中编程时，我一直使用 try/catch。我最近发现虽然我很少将它们用于 Web 应用程序。我的例外（没有双关语）是非托管代码，可能会造成内存泄漏，例如 com 对象。他们真的不再需要了，还是他们只是把事情弄得乱七八糟？

**更新：**假设正在使用自定义错误来处理丑陋的堆栈跟踪页面。

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-04-13T13:55:16.153

我发现初级程序员过度使用 try/catch 方式。使用 try/catch 的决定应该归结为这些简单的规则：

*   你能处理错误吗？（也许这意味着再试一次，或者使用不同的设置，返回替代值等）

*   你能提供更好的错误信息（更详细）吗？

*   你需要记录这个特定的错误吗？（请记住，所有错误*都应*记录在最高级别——例如在 Application_Error 方法中的 global.asax 文件中）

*   您是否需要清理/处置操作中使用的资源，例如数据库连接或事务？

如果您对其中任何一个回答是肯定的，那么请使用 try/catch。如果您说不，那么您可以安全地只允许显示错误页面并让全局错误处理程序记录它。

如果您确实打算记录或清理资源，但仍然让异常通过，请**确保**您使用`throw;`而不是创建全新的异常。这样做会消除您的堆栈跟踪，并且基本上不会给错误提供上下文。

刚刚从[Ayende中找到](http://ayende.com/blog)[了这句优秀的引言](http://ayende.com/Blog/archive/2009/04/17/kobe-ndash-an-example-of-exception-handling-done-wrong.aspx)，似乎说得非常好：

> 异常处理应该恰好出现在两个地方：
> 
> *   当预期会发生错误（例如，发出 Web 请求调用）并且在失败的情况下需要执行一些有意义的行为（例如在一些延迟后重试）
> *   在系统边界上，在这种情况下，您需要决定如何将错误暴露给外界。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2009-04-13T13:47:57.200

这是问题形式的答案

> 如果您不捕获异常，您希望如何进行错误处理？

异常（正确或错误）是 .Net 语言的错误机制。您根本无法编写一个既忽略异常又具有足够错误处理能力的应用程序。它根深蒂固于框架中，无法避免

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-13T13:53:32.990

尝试捕获是编程的一个重要方面，不应被忽视；但是，您不需要将每个语句都包装在 try catch 块中。通常我使用以下规则：

1.  如果这是一个 Windows 应用程序，那么入口点应该总是有一个 try catch 作为捕捉任何异常的最后尝试。在 asp.net 中，这是使用 Application 对象的 OnError 完成的。

2.  如果我知道可以抛出特定异常并且我想处理它。例如，如果您尝试发送一封格式无效的电子邮件，用于发送到电子邮件地址，您将收到格式异常。我可能会捕获该特定异常并通知用户他们使用的电子邮件无效。

3.  如果您有其他上下文信息要记录，这对故障排除很有用。例如，虽然我的全局 asp.net 错误处理程序可能会记录所有表单变量，但也许我想捕获某些对象的值。

4.  如果您想修改应用程序的流程，例如在 ASP.Net 中，如果我想在我的 ajax 调用失败时显示错误消息，我不应该让错误冒泡到我未处理的异常例程中。

5.  如果有需要清理的资源，那么我使用 try catch finally 或 try finally 块来确保我的资源被关闭。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-13T13:54:37.650

采用`Finally`

这样你就可以使用 try-catch 并且仍然清理你的非托管内存。

而且，虽然你确实应该避免在不必要的时候使用 try-catch，（即 check`if x == null`而不是让 x throw `NullReferenceException`）你会发现，尤其是在 Web 应用程序中，有很多时候 try-catch 语句是绝对的需要，因为有时你会失去连接，或者用户会做错事，无论你喜欢与否都会抛出异常。

在这些情况下，您希望捕获它们，将它们捆绑在一些日志记录中，然后优雅地继续，或者释放您的资源并重新抛出。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-13T13:48:11.457

当在正确的地方使用时，异常处理逻辑在 Web 域中仍然非常有用。您的后端代码可能需要连接到数据库、与不同的服务通信或调用您自己的异常抛出逻辑。在任何这些情况下，您都需要捕获异常并将其传达给用户。

例如，假设您需要与已关闭的数据库进行通信。您需要将该信息发送回客户端页面，以通知用户您的站点当前已关闭或遇到问题。除非您的所有外部调用都返回友好的状态代码（这极不可能且很麻烦），否则您将需要依赖异常。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-13T14:08:57.727

您应该尝试/捕获任何可能引发您可以合理处理的异常的语句。通过合理处理，我的意思是记录、干净地关闭应用程序、发送电子邮件、尽可能解决问题、警告用户、向异常添加信息并重新抛出等等。如果你不能在一个这种方式是有道理的，那为什么要抓住它呢？话虽如此，有时我将捕获异常委托给更高级别的函数，但我很少让异常完全未被捕获。至少我通常可以记录错误、提醒用户并关闭应用程序。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-14T06:22:16.387

我要补充一点，出现异常的关键原因之一是使您的应用程序能够在代码中最适当的级别处理错误，以便对其进行合理的处理。异常提供了一种干净的方式将信息传回调用堆栈以启用此功能。

决定在哪一层来处理各种异常是应用程序设计中的一个关键决定。您正在开发的应用程序类型将影响决策。

例如，在开发 Web 或桌面应用程序时，仅在非常高的级别处理大多数异常类型可能是完全可以接受的。当您的应用程序确实无法对错误做太多事情时，这种技术可以节省大量代码，只需要告诉某人并记录它。

但是，在任务关键型、多线程服务器应用程序中，您可能需要对异常进行细粒度控制，以便适当地处理它们并无论如何都保持线程旋转。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-14T08:33:26.387

如果您愿意处理 SomeException，请仅使用 Catch(SomeException ex)。您不愿意处理的异常被视为意外。使用单元测试来练习您的代码并找到预期的异常。

以下示例是错误的，因为您没有对异常做任何事情

```
try
{
    // Some code that throws a exception
}
catch(Exception ex)  // Only handle this type of exception in the User interface.
{
    throw;     // Incorrect, throwing exception for no reason
} 
```

这个更好：

```
try
{
    // Some code that throws a exception
}
catch(System.Data.UpdateException ex)
{
    LogException(ex);
    string message = DecipherException(ex);
    throw new MyException(message, ex);     // Incorrect
} 
```

并跟进（在用户界面中）

```
try
{
    // Code that throws a exception
}
catch (MyException myEx)
{
   // Use a nice dialog which shows the user how to fix the error
}
catch (Exception ex)
{
    // Unhandled scenario - usually fatal because you didn't expect it to happen.
} 
```

# css - styling tag and tag in text control.htmlText using css

> ID：743923
> 
> 赞同：0
> 
> 时间：2009-04-13T13:46:14.100
> 
> 标签：css, apache-flex

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-13T14:49:53.633

根据您的描述，听起来您正试图将样式放入 Flex 应用程序的样式表中。**那是行不通的**。您正在使用的样式表用于设置应用程序的样式，而不是应用程序中的 html 内容。

如果要在 htmlText 块中呈现样式文本，请遵循此处描述的模式：

[Flex 3 - 应用级联样式表](http://livedocs.adobe.com/flex/3/html/help.html?content=Working_with_Text_14.html)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-05-23T17:45:24.777

使用 StyleSheet::parseCSS 导入自定义 CSS 定义，然后使用 mx:Text 的 styleSheet 属性附加它。

```
var ss : StyleSheet = new StyleSheet;
ss.parseCSS("a{color:#2222ff;} a:hover{text-decoration: underline;}");
tmsg.styleSheet=ss;
tmsg.htmlText="<a href=\"http://blabla.bla\">blabla.bla</a>"; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-07-31T17:07:53.200

你可以这样做

一些文字 http://www.orf.at'> [http://www.orf.at](http://www.orf.at)一些文字

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-13T15:32:29.927

您需要将 css 应用于 htmlText 对象的内容而不是整个应用程序。您可以设置的 htmlText 对象上应该有一个“styleSheet”属性或类似属性。

# php - 使用 php、ajax 和 jquery 对 mysql 表进行排序

> ID：743932
> 
> 赞同：0
> 
> 时间：2009-04-13T13:49:53.327
> 
> 标签：php, mysql, sorting

好的，这是我正在通过 php、ajax、jquery 和 mysql 构建消息传递系统的交易表格但已排序所以我该怎么做

//在这里我添加消息并将消息称为消息

```
function addMsg()
    {
      //alert(post);
        $.get("db.php",$('form').serialize(),
           function(data){
            getMsg(data);},"html");
} 
```

函数getMsg（数据）{警报（数据）；
$("#t1").append(data); } //php

".""."".$row["col"]."".$row["col"]."".$row["col"].""; } ?>

//现在进行排序 //javascript

```
function sort()
    {
        $.ajax({
          url: "sort.php",
          dataType: "text",
          success: function(data){
          $("t1").text(data);
              }

        });

    } 
```

//php

$result = mysql_query("SELECT * FROM table ORDER BY col desc");

```
 while($row = mysql_fetch_array($result))
           {     
           echo "<tbody><tr><td>"."&#8226;"."</td><td>".$row["col"]."</td><td>".$row["col"]."</td><td></td><td></td><tr><td></td><td colspan='4'>".$row["col"]."</td></tr></tbody>"; 
           } 
```

?>

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-13T14:21:14.420

Use ORDER BY when you do the SELECT. Check this: [http://dev.mysql.com/doc/refman/5.0/en/sorting-rows.html](http://dev.mysql.com/doc/refman/5.0/en/sorting-rows.html)

# c - C 的最小散列函数？

> ID：743939
> 
> 赞同：44
> 
> 时间：2009-04-13T13:54:19.383
> 
> 标签：c, hash, hashtable

我不能使用 boost:hash 因为我必须坚持使用 C 并且不能使用 C++。

但是，我需要散列大量（10K 到 100k）令牌字符串（5 到 40 字节长度），以便在这些字符串中搜索最快。

MD5、SHA1 或任何长散列函数对于一个简单的任务来说似乎太重了，我不是在做密码学。另外还有存储和计算成本。

因此我的问题：

1.  在大多数实际情况下，可以确保防止冲突的最简单的哈希算法可能是什么。

2.  哈希值使用多少位？我正在开发 32 位系统。Perl/Python 中的哈希算法是否也使用 32 位哈希？还是我必须跳到64？

3.  关于在通用脚本语言中实现哈希表：实现是否检查冲突或者我可以完全避免那部分？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-04-13T14:04:18.937

您可以在[http://www.azillionmonkeys.com/qed/hash.html](http://www.azillionmonkeys.com/qed/hash.html)

唯一不应该检查冲突的情况是，如果您使用完美的散列 - 一个很好的老式查找表，例如[gperf](http://www.gnu.org/software/gperf/)。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-04-13T14:02:43.560

1.  [这](http://smallcode.weblogs.us/oldblog/2008/06/17/murmur-hash/)是最著名的散列函数的一个很好的概述。

2.  32位应该可以正常工作。

3.  你总是需要检查冲突，除非你想写一个有趣的哈希表:)

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-04-13T14:00:34.563

用于[哈希表查找](http://burtleburtle.net/bob/hash/doobs.html)的通用哈希函数。它指定**Do NOT use for cryptographic purpose**，但由于您指定您没有这样做的意图，那么您应该没问题。

> 它包括**对哈希函数的调查**以尝试

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-04-13T16:05:02.300

如果您使用的是类似 posix 的系统并坚持使用纯 C，我会简单地使用系统已经提供的功能。man 3 hcreate 为您提供所有详细信息，或者您可以在此处找到在线版本[http://linux.die.net/man/3/hcreate](http://linux.die.net/man/3/hcreate)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-13T14:12:22.180

尝试[Adler32](http://en.wikipedia.org/wiki/Adler-32)用于长字符串或[Murmur2](http://murmurhash.googlepages.com/)用于短字符串。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2013-10-22T08:48:16.360

[xxhash](http://code.google.com/p/xxhash/)是一个非常快速和简单的选择。一个简单的代码将使用`XXH32`函数：

```
unsigned int XXH32 (const void* input, int len, unsigned int seed); 
```

它是 32 位哈希。由于`len`is `int`，对于大于`2^31-1`字节的更大数据，请使用以下内容：

```
void*         XXH32_init   (unsigned int seed);
XXH_errorcode XXH32_update (void* state, const void* input, int len);
unsigned int  XXH32_digest (void* state); 
```

# c# - 2D 游戏引擎应该包含什么？

> ID：743947
> 
> 赞同：32
> 
> 时间：2009-04-13T13:57:42.917
> 
> 标签：c#, xna

好的，所以我最终基于 XNA 编写了自己的游戏引擎，我只是想知道我还需要什么来制作一个完整的引擎。

这是引擎中的内容：

*   物理学（Farseer 物理学）
*   粒子引擎（水星计划）
*   二维相机
*   输入处理
*   屏幕管理（菜单、暂停屏幕等）
*   精灵（动画，精灵表）
*   还有 XNA 的东西，比如 Sound。

**我是否遗漏了任何可能对游戏引擎至关重要的东西？**

* * *

## 回答 #1

> 赞同：59
> 
> 时间：2009-05-03T13:44:53.093

你正在以一种颠倒的方式接近它。

您的引擎中应该包含以下内容：

*所有在你的第一个游戏和第二个游戏中都被证明是通用的代码。*

首先，写一个游戏。不要编写引擎，因为正如你所发现的，你不知道它应该包含什么，或者它应该如何设计。而是写一个游戏。

一旦你有了那个游戏，再写*一个*游戏。然后，当您完成该操作后，检查第二个游戏的代码。从第一场比赛中重复使用了多少？

任何被重用的东西都应该被重构到一个单独的项目中。该项目现在是您的游戏引擎。

这并不意味着你不应该计划，或者不应该尝试编写好的代码。但是请确保您正在朝着具体的方向努力，您可以在其中区分一个好的实现和一个坏的实现。一个好的游戏实现，是一个有效、有趣且不会崩溃的游戏。编写代码以首先实现这些目标。

一个好的引擎实现？这更棘手。什么是渲染器的好实现？一个人工智能框架？粒子系统？最终，确定您是否拥有一个好的引擎的唯一方法是查看它*在实际游戏中的*运行情况。因此，如果您没有游戏，就无法评估您的引擎。如果你无法评估你的引擎，你就无法判断你正在编写的任何代码是否真的有用。

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2009-04-13T14:36:19.877

您的引擎的主题或市场。如果您正在做超出基本图形引擎的任何事情，您将希望专注于您的引擎市场，例如 RPG、策略、解谜、平台游戏、动作或 FPS（好吧，不是 FPS）。

这将帮助您指出您需要前进的方向，以便在不询问我们的情况下进一步增强引擎。像虚幻引擎这样的引擎可以做很多事情，但它往往做得最好的是它的用途，即 FPS 游戏。同样，您应该定制您的引擎，使其适合特定的兴趣领域，因此适合该类型的游戏玩法。

您可以在一定程度上使其通用，但要意识到您的引擎越通用，编程就越难，无论是时间还是技能方面。如果有更具体的平台可用，其他程序员也不太可能选择通用引擎（除非仅此而已）。或者只编写自己的，因为修改通用引擎与创建自己的引擎一样难。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2009-04-13T14:26:43.813

还有几件事：

*   **寻路**——对人工智能非常有用
*   AI - 可能 - 取决于您希望引擎的通用性。
*   高分数
*   **回放**- 让高分变得更加有趣，因为您可以实际观看它们。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-04-13T14:07:13.953

几个想法：

*   人工智能（也许只是简单的人工智能实用程序，如[寻路算法](https://web.archive.org/web/20171022224528/http://www.policyalmanac.org:80/games/aStarTutorial.htm)）
*   保存全部或部分游戏状态（用于暂停和稍后重新启动或保存高分）。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-04-13T15:01:38.567

我认为您涵盖了 2D 引擎的一般要求。我在该列表中唯一会错过的是：

*   图形用户界面库

还使开发过程更容易：

*   脚本引擎（LUA、C#Script、...）
*   动态刷新的资产（参见[Nick Gravelyn 的博客条目](http://nickgravelyn.com/2009/03/dynamically-refreshed-assets-in-xna/)）

您还可以在 XNA 现有的东西之上添加另一层：

*   一个相当简陋的网络/大厅实现
*   多个控制器的更抽象处理（游戏会话期间的 DropIn/DropOut，例如参见 Resident Evil 5 Coop） - 可能基于事件

最后，您可能会添加一些“ready2use”着色器。[或许可以从已停产的FaceWound](http://www.facewound.com/?s=media)（来自“Garry's Mod”开发者）那里获得一些灵感。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-04-13T15:01:11.890

这取决于游戏，但通常需要的另一件事是良好的网络框架。

许多现代游戏，包括 2D 游戏，似乎都有某种形式的网络。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-04-13T14:28:47.303

*   动画框架，这样你就可以说：拿这个精灵，朝这个方向移动，用这个速度、加速度等沿着这个路径走
*   基本的图形用户界面系统。不要实现整个 Windows，而是实现指针和按钮之类的基本功能 - 保持基本功能
*   用于显示 FPS、精灵数量等的调试组件

制作一些游戏也是一件好事，然后你会很快看到你为每款游戏重复做的事情，然后研究如何将其放入引擎中。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2011-11-24T13:23:49.590

*   2d 照明系统是一个很好的高级功能。你可以为此使用[氪星](http://krypton.codeplex.com/)。
*   地图编辑器。甚至更好地支持任何与“[平铺地图编辑器](http://www.mapeditor.org/)”兼容的平铺地图格式。所以你可以只使用 Tiled。
*   游戏动作的调度程序/计时器。
*   屏幕擦除效果，例如翻页、淡出等，以在屏幕之间进行漂亮的过渡。
*   内置视差的游戏层也很有用。
*   在游戏控制台中无需重启即可处理命令或脚本。
*   将纹理图集轻松加载为精灵或动画。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2013-06-03T07:36:30.710

干得好，我们（我和我的一些朋友）实际上也在开发游戏引擎，我们已经得到了你提到的所有内容，但此外我们还有以下内容。

*   **音频管理器**：一个简单的类来处理 XNA 中的背景音乐和音效。
*   **视频管理器**：它并不复杂，一个简单的类来处理 XNA 中的视频播放。
*   **效果管理器**：负责绽放、模糊、黑/白等颜色。

祝你好运 ：）

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-04-13T13:59:57.513

3d Acceleration 应该在 2D 引擎中。

使用当今大多数人拥有的 3D 硬件是为您的 2D 游戏获得惊人性能的最佳方式......

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-04-13T15:14:33.107

良好的碰撞检测非常有帮助。如果你有效地实现它，它确实减少了每一帧所需的时间。除此之外，在我的引擎（用于 Pygame）中，我有一种将主屏幕分成多个子屏幕的方法，我觉得这很有用。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-04-13T15:24:21.740

根据目标游戏类型，包括带有节点和边缘注释的导航图。（适用于许多游戏，但不适用于使用 2D 图形引擎制作的令牌侧滚轮）

*   生成它们的组件（通过洪水填充算法）。
*   确保包含所有主要的路径查找/规划算法（A*/Dijkstra/等）来遍历这些图。

这样做的缺陷是您必须定义引擎的“地图”是什么，这可能会限制引擎的用户。

相关事项：

*   基于位置的触发器（玩家进入一个不可见的圆圈并发生一些事情 - 排队过场动画，开始伏击等）。我想说为触发器提供一个基类并实现一些基本类来展示它是如何完成的（即武器拾取器等）
*   一些游戏引擎实现了网络（尽管这是“xna 东西”的一部分）

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-04-13T17:59:10.183

首先要包含的最有用的东西是轻松使用引擎的工具。也许使用您的引擎来创建工具。我相信你会发现很多这样的缺陷。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2009-04-15T11:42:55.267

简单的像素完美碰撞检测。不是先知物理学。简单的绘图例程，如drawline，drawcircle等。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-04-13T15:00:54.183

瓷砖重复工具。允许用户添加/创建图块并操纵边缘以获得平滑重复图案的东西。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2009-05-03T13:26:03.620

嗯。这个列表是一个“内部”列表。做伟大的引擎就是做伟大的“外部”清单。以 UE3 为例——它之所以出现，是因为有很棒的工具。您需要用于创建世界的工具，创建最佳资源包（它也应该在内部列表中;-)），用于碰撞对象规范等。另外，要添加到[Organiccat 答案](https://stackoverflow.com/questions/743947/what-should-be-in-a-2d-game-engine/744091#744091)，您应该决定技术水平。您可以选择简单的精灵，也可以想要花哨的效果（因此需要着色器，并且需要基础设施）

# asp.net - Asp.Net SQL Refresh page duplicate inserts?

> ID：743948
> 
> 赞同：1
> 
> 时间：2009-04-13T13:57:48.843
> 
> 标签：asp.net, sql, post, refresh

I have a *.aspx page that contains a text box and a button. When the user enters information in to the textbox and clicks post, it inserts the data into my sql database. The issue is, that if the user hits refresh, it will keep inserting the same data into the database. I am pretty sure the whole "click" method is called, not just the insert call. I tried messing with sessions but it complains. I am not really sure what to do. I am looking for a simple easy fix.

```
protected void PostButton_Click(object sender, EventArgs e)
{
    string wpost = (string)Session["WallPost"];
    DateTime wtime = (DateTime)Session["WallDateTime"];
    if (txtWallPost.Text.Length > 0 && !wpost.Equals(txtWallPost.Text))
    {
        string strCon = System.Web.Configuration.WebConfigurationManager.ConnectionStrings["SocialSiteConnectionString"].ConnectionString;
        using (SqlConnection conn = new SqlConnection(strCon))
        {
            using (SqlCommand cmd = conn.CreateCommand())
            {
                cmd.CommandText = "INSERT INTO [WallTable] ([UserId], [FriendId], [WallPost]) VALUES (@UserId, @FriendId, @WallPost)";
                cmd.Parameters.AddWithValue("@UserId", User.Identity.Name);
                cmd.Parameters.AddWithValue("@FriendId", User.Identity.Name);
                cmd.Parameters.AddWithValue("@WallPost", txtWallPost.Text);
                conn.Open();
                cmd.ExecuteNonQuery();
                Session.Add("WallPost", txtWallPost.Text);
                Session.Add("WallDateTime", new DateTime());
                conn.Close();
                txtWallPost.Text = "";
                LoadWallPosts();
            }
        }
    }
    return;
} 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2013-01-20T21:20:19.380

添加 Response.Redirect(Request.Url.ToString(), false); 到您的按钮事件，这应该可以解决问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-13T14:22:10.923

如果它`PostButton_Click`是按钮上单击事件的服务器处理程序，则仅当用户点击发布按钮时才执行插入代码 - 在刷新的情况下不应发生。

*我很确定*这还不够 - 确保在您的`PostButton_Click`方法中放置一个断点，按 F5 以在调试模式下运行，然后查看是否刷新断点。

如果是这样，则意味着：

1.  您正在 `PostButton_Click`从其他地方明确调用（`Page_Load`？）
2.  `PostButton_Click`被意外设置为页面上某些其他事件的事件处理程序

验证假设 1 和 2 的一种快速方法是运行搜索`PostButton_Click`并查看您从哪里调用它，或者它是否设置为标记中某个其他元素（可能是您的表单？）的处理程序。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-04-13T14:02:14.513

if he refreshes or press the back button the post will happen again, thus your page will process the same data thus insert once again.

You have to change your logic

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-04-13T15:02:44.367

插入后最好将客户端重定向到另一个页面，但是，如果您确实需要客户端留在同一页面中，您可以在页面上使用 (bool) 变量来说明插入是否已完成，并且如果之前已经执行过插入逻辑，则跳过它

# sql-server - How to automate tests for reports in SSRS

> ID：743950
> 
> 赞同：11
> 
> 时间：2009-04-13T13:59:26.923
> 
> 标签：sql-server, unit-testing, reporting-services, report

My current project uses SSRS as the reporting engine. I have the report executing a text command with about 10 variables passed to it. I have been looking for a solution on how to unit test (acceptance or integration, whatever, just some automation) to an SSRS report project.

I thought about using this method:

1.  Move the SQL text command to a stored procedure
2.  Create a Reports.Tests project
3.  Create a project_tests database and point the connection string to this database
4.  Set up my unit test <Setup> with the data I would return in the test
5.  Create a test with the parameters passed and test the result set

I wanted to be sure that I wasn't missing something obvious.

How do other programmers test their reports automatically? Any suggestions on how to improve this method?

EDIT: I should clarify that I would like to only test the result set and not formatting of the report.

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2011-08-12T13:30:56.247

我在 CodePlex 上看到了可能有用的[Reporting Services 单元测试框架](http://rsunit.codeplex.com/)，尽管我还没有机会对其进行评估。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-06-04T09:08:12.883

不知道这是否为时已晚-但我在以下站点查看了测试产品：[http ://www.asyncsoftware.co.uk/ReportTestGenerator.html](http://www.asyncsoftware.co.uk/ReportTestGenerator.html)

它根据您创建的断言生成（MSTest 或 NUnit）单元测试......可能会有所帮助。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-15T07:24:40.240

好吧，这只会测试数据库“API”，它不会考虑您可能在报告中使用的任何功能（过滤、排序、聚合等）。

我唯一能建议的是找到一个可以比较 XML 的工具，然后让报表服务器发送一个 XML 版本的报表。

```
http://reportserver/ReportServer?/directory/Report1&rs:Format=XML&rs:Command=Render 
```

必须有一个工具可以做到这一点

不确定这是否有能力做到这一点：http: [//www.soapui.org/](http://www.soapui.org/)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-16T13:09:56.337

[Selenium](http://seleniumhq.org/projects/remote-control/)对我来说是一个很好的工具。Selenium 应该允许您从 Web 浏览用户的角度验证报告中的大多数功能是否按预期工作。

将测试数据库与生产分开将有助于保持环境清洁，但不会影响测试的质量。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-14T02:49:56.480

那么您基本上是想测试SP吗？

[http://tsqlunit.sourceforge.net/](http://tsqlunit.sourceforge.net/)

或数据库专业人员的 VSTS

[http://msdn.microsoft.com/en-us/library/bb381703(VS.80).aspx](http://msdn.microsoft.com/en-us/library/bb381703(VS.80).aspx)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-01-31T15:29:10.450

似乎没有很多用于单元测试 SSRS 的解决方案。我发现[这个博客](http://consultingblogs.emc.com/stevewright/archive/2009/08/27/unit-testing-report-within-reporting-services-my-theory.aspx)中的想法很有帮助。

此外，如果您对提供帮助的工具感兴趣，请参阅：[Innosphere 的 SSRS 单元测试套件](http://www.innosphere.ca/Products/SSRSUnitTestingSuite/tabid/110/Default.aspx)。他们正在使用与博客中描述的方法非常相似的方法，即将 SSRS 报告导出为 XML，并使用 XML 进行断言。

希望其中一些有所帮助。

# .net - .NET 中的依赖注入示例？

> ID：743951
> 
> 赞同：27
> 
> 时间：2009-04-13T13:59:32.803
> 
> 标签：.net, dependency-injection

**有人可以用****一个基本的 .NET 示例**来解释**依赖注入** ，并提供一些指向 .NET 资源的链接以扩展该主题吗？

 ****这不是[什么是依赖注入？](https://stackoverflow.com/questions/130794/what-is-dependency-injection)因为我在询问特定的 .NET 示例和资源。

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2009-04-13T14:19:19.497

这是一个常见的例子。您需要登录您的应用程序。但是，在设计时，您不确定客户端是否要记录到数据库、文件或事件日志。

因此，您希望使用 DI 将该选择推迟到可由客户端配置的选择。

这是一些伪代码（大致基于 Unity）：

您创建一个日志记录接口：

```
public interface ILog
{
  void Log(string text);
} 
```

然后在你的类中使用这个接口

```
public class SomeClass
{
  [Dependency]
  public ILog Log {get;set;}
} 
```

在运行时注入这些依赖项

```
public class SomeClassFactory
{
  public SomeClass Create()
  {
    var result = new SomeClass();
    DependencyInjector.Inject(result);
    return result;
  }
} 
```

并且实例在 app.config 中配置：

```
<?xml version="1.0" encoding="utf-8"?>
<configuration>
  <configSections>
    <section name ="unity"
             type="Microsoft.Practices.Unity.Configuration.UnityConfigurationSection,
              Microsoft.Practices.Unity.Configuration"/>
  </configSections>
  <unity>
    <typeAliases>
      <typeAlias alias="singleton"
                 type="Microsoft.Practices.Unity.ContainerControlledLifetimeManager,Microsoft.Practices.Unity" />
    </typeAliases>
    <containers>
      <container>
        <types>
          <type type="MyAssembly.ILog,MyAssembly"
                mapTo="MyImplementations.SqlLog, MyImplementations">
            <lifetime type="singleton"/>
          </type>
        </types>
      </container>
    </containers>
  </unity>
</configuration> 
```

现在，如果您想更改记录器的类型，您只需进入配置并指定另一种类型。

* * *

## 回答 #2

> 赞同：32
> 
> 时间：2009-11-14T09:59:26.147

[Ninject](https://github.com/ninject/Ninject/wiki/Dependency-Injection-With-Ninject)必须有最酷的样本之一：（从样本中拼凑而成）

```
interface IWeapon {
  void Hit(string target);
}
class Sword : IWeapon {
  public void Hit(string target) {
    Console.WriteLine("Chopped {0} clean in half", target);
  }
}
class Shuriken : IWeapon {
  public void Hit(string target) {
    Console.WriteLine("Shuriken tossed on {0}", target);
  }
}
class Samurai {
  private IWeapon _weapon;

  [Inject]
  public Samurai(IWeapon weapon) {
    _weapon = weapon;
  }

  public void Attack(string target) {
    _weapon.Hit(target);
  }
}

class WeaponsModule: NinjectModule {
  private readonly bool _useMeleeWeapons;

  public WeaponsModule(bool useMeleeWeapons) {
    _useMeleeWeapons = useMeleeWeapons;
  }

  public void Load() {
    if (useMeleeWeapons)
      Bind<IWeapon>().To<Sword>();
    else
      Bind<IWeapon>().To<Shuriken>();
  }
}

class Program {
  public static void Main() {
    bool useMeleeWeapons = false;
    IKernel kernel = new StandardKernel(new WeaponsModule(useMeleeWeapons));
    Samurai warrior = kernel.Get<Samurai>();
    warrior.Attack("the evildoers");
  }
} 
```

对我来说，这读起来很流畅，在你开始你的道场之前，你可以决定如何武装你的武士。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2015-06-16T12:35:29.843

我认为首先在没有 IoC 容器的情况下学习 DI 很重要。因此，我编写了一个慢慢构建为 IoC 容器的示例。这是我工作中的一个真实例子，但对于新手来说仍然足够基本，可以抓住 DI 的精髓。你可以在这里找到它：[https ://dannyvanderkraan.wordpress.com/2015/06/15/real-world-example-of-dependeny-injection/](https://dannyvanderkraan.wordpress.com/2015/06/15/real-world-example-of-dependeny-injection/)

它在 C#.NET 中，后来它使用 Unity。

**评论后更新：**

*文章相关部分*

“请注意对原始设计的以下更改：

[![情况快速图](https://i.stack.imgur.com/4DT4a.png)](https://i.stack.imgur.com/4DT4a.png)

我们采用“构造函数注入”模式来实现 DI，重构步骤是：

1.  通过创建接口ICardPresenceChecker抽象出CardPresenceChecker的接口；
2.  通过将其名称更改为 XCardPresenceChecker 来明确表明此 CardPresenceChecker 仅适用于 X 公司的库；
3.  让 XCardPresenceChecker 实现接口 ICardPresenceChecker ；
4.  将 LogInService 的属性抽象为 ICardPresenceChecker 类型，而不是“知道”确切的实现是什么；
5.  最后但并非最不重要的一点是，LogInService 的用户（其他开发人员）要求他们提供至少实现 ICardPresenceChecker 的任何类，以便 LogInService 可以做它的事情。

LogInService 的构造函数如下所示：

```
this.myCardPresenceChecker = cardPresenceChecker;
this.myCardPresenceChecker.CardIn += MyCardPresenceChecker_CardIn;
this.myCardPresenceChecker.CardOut += MyCardPresenceChecker_CardOut;
this.myCardPresenceChecker.Init(); 
```

那么你在哪里为 LogInService 提供 ICardPresenceChecker 的实现呢？您通常希望在应用程序启动时将这个“映射”（在本例中，我们将 ICardPresenceChecker“映射”到 XCardPresenceChecker）放在一个中心位置，在概念上称为“组合根”。对于一个 ol' 常规控制台应用程序，它可能是 Program 类中的 void Main。所以对于这个例子，这段代码将在上述地方使用：

LogInService logInService = new LogInService(new XCardPresenceChecker());"

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-13T14:20:42.503

我有一个像这样的非常简单的例子的依赖注入。

请参阅下面的课程，您将了解整个想法。如您所见，除非您提供文件，否则它将使用默认的设置文件，但您可以设置一个设置文件，然后该类将使用它。

```
Public Class ProcessFile

Private _SettingsFile As String = "settings.bin"

Public Sub New()
End Sub

Public Sub New(settings As String)
_SettingsFile= settings
End Sub

Public Function ReadFile() As String 
'Do stuff based on the settings stored in the _SettingsFile 
End Function

End Class 
```

显然这是最基本的情况。在现实世界中，你可以对类类型做同样的事情，比如你有数据库层，你可以通过依赖注入来切换底层数据库 dll，只要你能提供有效的类，你的代码就可以与任何数据库一起工作（实现您正在使用的接口的类）。

掌握基础知识后，您可以通过使用像 unity 这样的 DI 框架在更大范围内完全独立于应用程序执行此操作。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-13T14:14:19.053

您基本上在构造函数中传递了所有必要的对象。或者，您可以在运行时使用接口解析器解析它们（尽管这不太安全）。您可以在 Ninject 网站上找到第一种方法的优秀示例，在[Unity](http://www.codeplex.com/unity)网站上找到第二种方法的优秀示例。这避免了对单例的需要，并允许您轻松放入符合所需接口的替换对象

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2014-11-03T12:28:52.343

在主 mvc4 项目名称 SampleDependency 下安装 Nuget 包。Unity.mvc4、unity.webapi 和 MicrosoftAsp.Net Web API 2.2 Web 主机

在网络项目中

```
public static class Bootstrapper
{
    public static IUnityContainer Initialise()
    {
        var container = BuildUnityContainer();

        DependencyResolver.SetResolver(new UnityDependencyResolver(container));
        GlobalConfiguration.Configuration.DependencyResolver = new Unity.WebApi.UnityDependencyResolver(container);

        return container;
    }

    private static IUnityContainer BuildUnityContainer()
    {
        var container = new UnityContainer();

        // register all your components with the container here
        // it is NOT necessary to register your controllers

        // e.g. container.RegisterType<ITestService, TestService>();
        container.RegisterType<IUserDetailLogic, UserDetailLogic>();
        container.RegisterType<IUserData, UserData>();

        RegisterTypes(container);

        return container;
    }
    public static void RegisterTypes(IUnityContainer container)
    {

    }
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2014-11-04T10:56:43.287

创建 DB 层项目（类库）并在其中添加以下代码。

```
public class UserData : IUserData
{
    public string getUserDetails()
    {
        return "Asif";
    }
}

public interface IUserData
{
    string getUserDetails();
} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2014-11-04T11:02:00.283

添加类型类库的业务逻辑项目，并在其中添加以下代码。公共类 UserDetailLogic ： IUserDetailLogic { 私有 IUserData _userData = null;

```
 public UserDetailLogic(IUserData userData)
    {
        _userData = userData;
    }
    public string getUserDetails()
    {
        return _userData.getUserDetails();
    }
}

public interface IUserDetailLogic
{
    string getUserDetails();
} 
```

在您的主项目中，在主控制器中添加以下代码。

公共类 HomeController : 控制器 { 私有只读 IUserDetailLogic _userDetailLogic;

```
 public HomeController(IUserDetailLogic userDetailLogic)
    {
        _userDetailLogic = userDetailLogic;
    }

    public ActionResult Index()
    {
        ViewBag.Message = "Modify this template to jump-start your ASP.NET MVC application.";
        string str = _userDetailLogic.getUserDetails();
        return View();
    }

    public ActionResult About()
    {
        ViewBag.Message = "Your app description page.";

        return View();
    }

    public ActionResult Contact()
    {
        ViewBag.Message = "Your contact page.";

        return View();
    }
} 
```

# c - 子进程的内存使用情况？

> ID：743955
> 
> 赞同：6
> 
> 时间：2009-04-13T14:00:45.360
> 
> 标签：c, linux, memory-management, sandbox

我在 Ubuntu 上用 C 语言运行一种“沙箱”：它需要一个程序，并在用户下安全地运行它`nobody`（并拦截信号等）。此外，它还分配内存和时间限制，并测量时间和内存使用情况。
（如果您很好奇，这是一种“在线法官”在测试数据上标记程序）

目前我已经从[mooshak改编了](http://mooshak.dcc.fc.up.pt/%7Ezp/mooshak/)*safeexec*模块。尽管大多数事情都可以正常工作，但内存使用似乎是个问题。（这是非常不准确的）

现在我已经尝试了[这里](https://stackoverflow.com/questions/669438/how-to-get-memory-usage-at-run-time-in-c)的建议并从 中解析了 VM `/proc/pid/stat`，现在准确性问题已得到解决。但是，对于真正快速完成的程序，它不起作用，只会返回 0。

safeexec程序似乎是这样工作的*：*

1.  它`fork()`是
2.  在子进程中使用`execv()`以运行所需的程序
3.  从父进程监视程序，直到子进程终止（使用`wait4`，这恰好返回 CPU 使用率 - 但不是内存？）
    因此它解析`/proc/../stat`子进程（已被 execv 替换）

那么为什么 VM in`/proc/child_pid/stat`有时等于 0？
是因为 execv() 完成得太快，而且`/proc/child_pid/stat`不可用吗？
如果是这样，是否有其他方法可以获取孩子的内存使用情况？
（因为这是为了在时间限制内判断程序，所以我不能承受像 valgrind 这样的性能损失）

提前致谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-13T14:07:54.623

您能否安排子进程使用您自己的`malloc()`et al 版本并记录 HWM 内存使用情况（可能使用注册的处理程序`atexit()`）？也许您会使用 LD_PRELOAD 来加载您的内存管理库。这对巨大的静态数组或巨大的自动数组没有帮助。

* * *

> 嗯，听起来很有趣。不过，有什么方法可以跟踪静态/自动数组吗？

可以使用“size”命令分析静态内存——或多或少。

自动数组是个问题——我不确定你如何处理这些。您的内存分配代码可以查看调用时使用了多少堆栈（查看局部变量的地址）。但是不能保证在使用最大数量的本地数组时会分配内存，因此它充其量只是一个粗略的衡量标准。

另一种想法：也许你可以使用调试器技术——`ptrace()`系统调用——来控制子进程，特别是让它保持足够长的时间，以便能够从`/proc/...`.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-13T14:09:43.387

您可以在 execve() 之前设置硬资源限制（RLIMIT_AS 资源的 setrlimit）。该程序将无法分配超过该数量的内存。如果它尝试这样做，内存分配调用（brk、mmap、mremap）将失败。如果程序没有处理内存不足的情况，就会出现segfault，这会体现在wait4返回的退出状态中。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2018-03-25T18:30:15.570

您可以使用 sys/resources.h 库中的 getrusage(2) 函数。
链接：[https](https://linux.die.net/man/2/getrusage)
: //linux.die.net/man/2/getrusage 此函数使用“rusage”结构，其中包含 ru_maxrss 字段，该字段存储有关当前所有子进程拥有的最大子内存使用量的信息。
在所有子进程终止后，也可以从主进程执行此功能。
要获取信息，请尝试以下操作：

```
struct rusage usage;
int a = getrusage(RUSAGE_CHILDREN, &usage); 
```

但是有一个小技巧。
如果您想获得有关每个子进程内存使用情况的信息（不仅是最大的一个），您必须两次 fork() 您的程序（第一次 fork 允许您拥有独立的进程，第二个将是您想要测试的进程.

# javascript - 如何获取没有子元素但可能有文本的元素？

> ID：743957
> 
> 赞同：20
> 
> 时间：2009-04-13T14:01:47.993
> 
> 标签：javascript, jquery, html

空[选择器](http://docs.jquery.com/Selectors/empty)表示：匹配所有没有子元素的元素（包括文本节点）。
查找所有为空的元素 - 它们没有子元素或文本。

我想要的是获取没有子元素但内部可能有文本的元素。，如何？

**更新：**
示例：
我想选择这些没有子元素但可能有文本的元素，语法如下：

```
$('div:empty, a:empty, span, p:empty, td:empty, img, input').mousemove(myMouseOverHandler); 
```

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-04-13T14:58:13.753

获取没有任何其他元素的任何元素：

```
$('*:not(:has(*))'); 
```

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2009-04-13T14:06:49.510

如果元素只有文本，[`children()`](http://docs.jquery.com/Traversing/children)则长度为`0`：

```
<div id="test1">
Hello World
</div>

<div id="test2">
<b>Hey there</b>
</div>

<script>
alert($("#test1").children().length); // alerts 0
alert($("#test2").children().length); // alerts 1 (the bold tag)
</script> 
```

**编辑**：作为对您的编辑的回应，jQuery 非常棒，可以让您进行自定义过滤器：

```
$.expr[':'].emptyOrText = function(e) {  
    return $(e).children().length == 0;
}; 
```

因此，对上面的 HTML 使用上面的内容，您可以这样做：

```
$('div:emptyOrText'); // will select #test1 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2014-05-15T16:46:38.523

我为不想使用 jQuery 的任何人制作了一个纯 JavaScript 函数。

```
const getElementsWithNoChildren = (target) => {
    let candidates;

    if (target && typeof target.querySelectorAll === 'function') {
        candidates = target.querySelectorAll('*');
    }
    else if (target && typeof target.length === 'number') {
        candidates = target;
    }
    else {
        candidates = document.querySelectorAll('*');
    }

    return Array.from(candidates).filter((elem) => {
        return elem.children.length === 0;
    });
}; 
```

# asp.net - 在 asp.net 中使用像公共变量这样的类

> ID：743964
> 
> 赞同：3
> 
> 时间：2009-04-13T14:03:28.393
> 
> 标签：asp.net, vb.net, class, scope

尝试在我的代码隐藏页面上声明公共类时，我在 .net 中遇到错误。

```
Partial Class _Default
    Inherits System.Web.UI.Page

    Public someVariable as integer
    Public someClass as className

    Protected Sub Page_Load(ByVal sender As Object, ByVal e As System.EventArgs) Handles Me.Load [...] 
```

我得到的错误是 `BC30508: 'someClass' cannot expose type 'className' in namespace '<Default>' through class '_Default'.`

这里的目标是像这样访问 aspx 页面上脚本块中的类属性`<%=someClass.classProperty%>`

我不确定我是否正在尝试正确的方法（我已经尝试了几种声明公共类的方法）或者是否可以完成......感谢您查看它。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-13T14:12:20.197

检查您的`className`类型的保护级别。您忘记将其标记为公开吗？

该错误消息意味着您有一些访问受限的东西，并且您正在尝试以允许超出限制访问的方式使用它。例如，如果您的`className`类型是`internal`或 的`private`子类`_Default`，但您将该类型的公共成员添加为属性，您的程序集会将一个类型作为其接口的一部分公开，否则将无法使用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-13T14:13:03.347

这几乎可以肯定是你的“className”类的声明。尝试将其设置为公开。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-13T14:07:53.377

检查 _Default 类的保护级别。它可能没有设置为部分类，这将导致您看到的保护级别问题。

# svn - 如何在 Redmine 中修改存储库设置？

> ID：743972
> 
> 赞同：17
> 
> 时间：2009-04-13T14:04:33.570
> 
> 标签：svn, repository, redmine, relocation

这听起来像是一个愚蠢的问题，但我一辈子都找不到这个问题的答案。

我们在 Redmine 中建立了一个项目并链接到 SVN 存储库。一切正常，但我们最近进行了存储库重定位，我们需要更新其 Redmine 存储库路径设置以指向新的存储库。

问题是该选项显示为灰色，我无法更改它。我想你可以点击“删除”并创建一个新的，但这个选项听起来真的很吓人（URL 中有 /destroy/ 这个词！！）而且我不想清除 repo。在 Redmine 手册中我找不到关于此的参考。我该怎么办？

另外——与此相关——你知道旧提交中的所有票证引用是否仍将指向正确的位置吗？

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-04-13T14:48:26.040

好的，我想通了。我创建了一个带有虚拟 svn 存储库的虚拟项目进行测试，最后单击了那个可怕的“删除”链接。事实证明，它只删除了对存储库的引用，而不是存储库本身。

这是一个公认的愚蠢问题，但这应该记录在 Redmine 手册中:)

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-08-27T11:10:56.337

另一种选择是更改“**存储库**”表中的值。在存储库重定位的情况下它工作得很好。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2010-05-13T16:44:05.967

> 另一种选择是通过更改“存储库”表中的值。在存储库重定位的情况下它工作得很好。

除非您确定它们完全相同，否则我不会推荐这个。

* * *

PS我刚刚意识到这个问题有多老，但我认为它仍然相关。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-06T09:41:35.570

事实上，我只是被同一个*愚蠢*的问题难住了。谢谢。但是，看起来包含对 redmine 中每个提交的引用的数据库信息已被删除，然后也被重新创建。如果您的存储库很大，这可能需要很长时间。（就像 linux 内核）

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2013-07-24T12:07:12.173

这是在 Redmine 数据库上运行以更改存储库位置的 MySQL 查询：

```
UPDATE repositories SET url='/opt/git/NEW_LOCATION.git', root_url='/opt/git/NEW_LOCATION.git' WHERE url='/opt/git/OLD_LOCATION.git'; 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2015-02-26T10:59:12.513

在 redmine 中删除存储库时要非常小心。它不会删除您的物理存储库，但**会删除存储库的所有 redmine 存储，例如指向问题的链接**。这些通常无法恢复（通过从重新定位的存储库导入），因为有些是手动创建的，在我的情况下，有些链接是很久以前使用提交评论中的另一种模式创建的。

在不丢失链接数据的情况下重新定位存储库的唯一方法是直接在数据库中更新 URL（它在设置页面中是只读的）。例如 dotancohen 建议的

```
UPDATE repositories SET url='newurl', root_url='newurlroot' WHERE url='oldurl'; 
```

# printf - printfs inside a shared object (dynamic library) not getting printed

> ID：743977
> 
> 赞同：1
> 
> 时间：2009-04-13T14:07:00.883
> 
> 标签：printf, shared

I have a shared object which i create on windows using Real View developer suite tool linked command on windows host-

armlink -o mylib.so <"my *.o files given here">

Then i link an application with this mylib.so shared library on linux using gcc tools.

I have printf statements inside functions in this mylib.so, but when I run the final executable, i do not get any printf outputs on console.(stdio.h is inlcuded wherever printfs are called)

So is there any known issue with shared libraries which cause printf or any system functions/system calls/run time library functions not to work correctly?

Or is that got to do with my peculiar setup of making a shared library on windows based compiler tool chain but linking this shared library with an application on linux-gcc compiler tools?

Thank you.

-AD

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-13T22:42:54.777

Since your target is arm, and I assume this is C it should not be a problem to compile some files on windows and then link on linux. Have you verified this however? I would suggest making a hello.so on windows, linked from hello.c:

```
#include <stdio.h>
void hello(void) {printf("Hello\n");} 
```

and then link main from main.c on linux:

```
void hello(void);
int main(int argc, char *argv[]){ hello(); return 0; } 
```

as a minimum compiler chain test.

* * *

If you call printf from code in defined in your final executable (i.e. not code from your shared library) do you get any output from that?

* * *

Does

```
strings --print-file-name -a mylib.so final_executable | grep "string from printf in shared library" 
```

return two occurenses?

* * *

Are there any references to printf in

```
readelf -a mylib.so
readelf -a final_executable 
```

?

# asp.net - 在asp.net中填写word文档？

> ID：743987
> 
> 赞同：6
> 
> 时间：2009-04-13T14:09:51.500
> 
> 标签：asp.net

我正在做一个需要填写word文档的Asp.Net项目。我的客户提供了一个带有姓氏、名字、出生日期等的单词模板。我在 sql 数据库中拥有所有这些信息，并且客户端希望应用程序的用户能够从数据库中下载填充信息的 word 文档。

归档这个的最好方法是什么？基本上，我需要识别word文档中的那些“可填写点”，当应用程序用户点击下载按钮时填写这些信息。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-13T14:19:31.087

如果您可以使用 Office 2007，则可以使用 Open XML API 来格式化文档： http: [//support.microsoft.com/kb/257757](http://support.microsoft.com/kb/257757)。您必须走这条路的原因是您不能真正在服务器环境中使用 Word Automation。（你可以，但是要正常工作是一个巨大的痛苦，而且很容易坏）。

如果你不能走 2007 年的路线，我实际上已经取得了相当大的成功，只需将 word 模板作为流打开并查找和替换标记并将其提供给用户。根据我的经验，这实际上效果非常好，而且实现起来非常简单。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-13T14:17:24.913

我不确定 ASP.Net 的某些方面，但我正在研究类似的东西，您可能想考虑使用 RTF。您可以在 RTF 中使用模式替换。例如，您可以在 RTF 文档中添加类似 {USER_FIRST_NAME} 的标签。当用户单击下载按钮时，您的应用程序可以从数据库中获取信息，并将 {USER_FIRST_NAME} 的每个实例替换为数据库中的数据。我目前正在使用 PHP 进行此操作，并且效果很好。Word 将毫无问题地打开 RTF，因此这是我选择此方法的另一个原因。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-13T14:14:45.607

我已将**[Aspose.Words 用于 .NET](http://www.aspose.com/categories/file-format-components/aspose.words-for-.net-and-java/default.aspx)**。它有点贵，但它工作得非常好，而且对于可能非常复杂的东西，API 相当直观。

如果您想预先设计您的文档（或允许其他人为您这样做），任何人都可以将[**字段**](http://addbalance.com/usersguide/fields.htm)放入文档中。Aspose 可以打开文档，查找并填写字段，并保存一份新填写的副本以供下载。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-13T14:18:43.147

Aspose 工作正常，但又一次：它很昂贵。

绝对要尽可能避免在 Web 应用程序中使用 Office 自动化。它只是不能很好地扩展。

对于此类问题，我首选的解决方案是 xml：特别是这里我推荐[WordProcessingML](http://msdn.microsoft.com/en-us/library/aa212812.aspx)。您根据架构创建一个 Xml 文档，在其上添加`.doc`扩展名，MS Word 将打开它，就好像它是任何版本的本地文件一样，可以追溯到 Office XP。这支持大多数 Word 功能，这样您就可以安全地减少替换文本流中的标记的问题。

请仔细搜索有关此内容的更多信息：此格式与 Office 2007 的基于 Xml 的新格式之间存在很多混淆。它们不是一回事。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-13T14:21:20.863

此代码适用于 WordMl 文本框和复选框。它是基于索引的，因此只需为所有文本框传入一个字符串数组，为所有复选框传入一个布尔数组。

```
public void FillInFields(
    Stream sourceStream,
    Stream destinationStream,
    bool[] pageCheckboxFields,
    string[] pageTextFields
    ) {

    StreamUtil.Copy(sourceStream, destinationStream);
    sourceStream.Close();

    destinationStream.Seek(0, SeekOrigin.Begin);

    Package package = Package.Open(destinationStream, FileMode.Open, FileAccess.ReadWrite);
    Uri uri = new Uri("/word/document.xml", UriKind.Relative);

    PackagePart packagePart = package.GetPart(uri);
    Stream documentPart = packagePart.GetStream(FileMode.Open, FileAccess.ReadWrite);
    XmlReader xmlReader = XmlReader.Create(documentPart);

    XDocument xdocument = XDocument.Load(xmlReader);

    List<XElement> textBookmarksList = xdocument
        .Descendants(w + "fldChar")
        .Where(e => (e.AttributeOrDefault(w + "fldCharType") ?? "") == "separate")
        .ToList();

    var textBookmarks = textBookmarksList.Select(e => new WordMlTextField(w, e, textBookmarksList.IndexOf(e)));

    List<XElement> checkboxBookmarksList = xdocument
        .Descendants(w + "checkBox")
        .ToList();

    IEnumerable<WordMlCheckboxField> checkboxBookmarks = checkboxBookmarksList
        .Select(e => new WordMlCheckboxField(w, e, checkboxBookmarksList.IndexOf(e)));

    for (int i = 0; i < pageTextFields.Length; i++) {
        string value = pageTextFields[i];
        if (!String.IsNullOrEmpty(value))
            SetWordMlElement(textBookmarks, i, value);
    }

    for (int i = 0; i < pageCheckboxFields.Length; i++) {
        bool value = pageCheckboxFields[i];
        SetWordMlElement(checkboxBookmarks, i, value);
    }

    PackagePart newPart = packagePart;
    StreamWriter streamWriter = new StreamWriter(newPart.GetStream(FileMode.Create, FileAccess.Write));
    XmlWriter xmlWriter = XmlWriter.Create(streamWriter);
    if (xmlWriter == null) throw new Exception("Could not open an XmlWriter to 4311Blank-1.docx.");
    xdocument.Save(xmlWriter);

    xmlWriter.Close();
    streamWriter.Close();
    package.Flush();

    destinationStream.Seek(0, SeekOrigin.Begin);
}

private class WordMlTextField {
    public int? Index { get; set; }
    public XElement TextElement { get; set; }

    public WordMlTextField(XNamespace ns, XObject element, int index) {
        Index = index;

        XElement parent = element.Parent;
        if (parent == null) throw new NicException("fldChar must have a parent.");
        if (parent.Name != ns + "r") {
            log.Warn("Expected parent of fldChar to be a run for fldChar at position '" + Index + "'");
            return;
        }
        var nextSibling = parent.ElementsAfterSelf().First();

        if (nextSibling.Name != ns + "r") {
            log.Warn("Expected a 'r' element after the parent of fldChar at position = " + Index);
            return;
        }

        var text = nextSibling.Element(ns + "t");
        if (text == null) {
            log.Warn("Expected a 't' element inside the 'r' element after the parent of fldChar at position = " + Index);
        }

        TextElement = text;
    }
}

private class WordMlCheckboxField {
    public int? Index { get; set; }
    public XElement CheckedElement { get; set; }
    public readonly XNamespace _ns;

    public WordMlCheckboxField(XNamespace ns, XContainer checkBoxElement, int index) {
        _ns = ns;
        Index = index;

        XElement checkedElement = checkBoxElement.Elements(ns + "checked").FirstOrDefault();
        if (checkedElement == null) {
            checkedElement = new XElement(ns + "checked", new XAttribute(ns + "val", "0"));
            checkBoxElement.Add(checkedElement);
        }

        CheckedElement = checkedElement;
    }

    public static void Copy(Stream readStream, Stream writeStream) {
        const int Length = 256;
        Byte[] buffer = new Byte[Length];
        int bytesRead = readStream.Read(buffer, 0, Length);
        // write the required bytes
        while (bytesRead > 0) {
            writeStream.Write(buffer, 0, bytesRead);
            bytesRead = readStream.Read(buffer, 0, Length);
        }
        readStream.Flush();
        writeStream.Flush();
    } 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-13T14:21:58.553

通常，您会希望避免在服务器上执行 Office 自动化，Microsoft 甚至[表示这也是一个坏主意](http://support.microsoft.com/kb/257757)。但是，我通常使用的技术是[aquinas](https://stackoverflow.com/questions/743987/fill-a-word-document-in-asp-net/744017#744017)提到的[Office Open XML](http://openxmldeveloper.org/default.aspx)。了解这种格式确实需要一些时间，但是一旦你这样做了，就非常值得，因为你不必担心 Office 自动化所涉及的一些问题（例如进程挂起）。

不久前，我回答了一个类似的问题，您可能会觉得这很有用，您可以在[这里](https://stackoverflow.com/questions/10412/creating-a-word-doc-in-c-net/10423#10423)找到它。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-01-20T16:20:15.590

如果您需要在 DOC 文件中执行此操作（而不是 DOCX），那么 OpenXML SDK 将无法帮助您。

此外，只想添加另一个关于在服务器上自动化 Office 应用程序的危险的 +1。你会遇到规模问题——我保证。

要添加对可用于解决您的问题的第三方工具的另一个引用：

[http://www.officewriter.com](http://www.officewriter.com)

OfficeWriter 让您可以使用完整的 API 或基于模板的方法（如您的要求）来控制文档，基本上可以让您在这样的场景中用很少的代码打开、绑定和保存 DOC 和 DOCX。

* * *

## 回答 #8

> 赞同：-3
> 
> 时间：2009-04-13T14:21:14.530

你能不使用微软自己的 InterOp 框架来利用 Word 功能吗

看[这里](http://support.microsoft.com/kb/328912)

# c# - 如何实现自定义 Windows 窗体设计器？

> ID：743988
> 
> 赞同：5
> 
> 时间：2009-04-13T14:12:13.927
> 
> 标签：c#, .net, winforms, form-designer

我们如何在 WinForms 应用程序中实现 Windows 窗体设计器？Visual Studio 使用 System.ComponentModel.Design 命名空间来实现表单设计器。我们如何使用它在 WinForms 应用程序中实现表单设计器？是否有任何其他库可用于实现相同目标？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-25T06:53:11.510

我终于从 CodePlex 中找到了一些非常有趣和有用的[东西](http://mef.codeplex.com/)。[我在Brad Abram 的博客](http://blogs.msdn.com/brada/archive/2009/04/13/managed-extensibility-framework-preview-5-released.aspx)文章中读到了这一点。其中包括许多关于框架可扩展性的示例，自定义 Windows 窗体设计器界面就是其中之一。

**链接文本 1： http: [//mef.codeplex.com/](http://mef.codeplex.com/)**

**链接文本 2：http: [//blogs.msdn.com/brada/archive/2009/04/13/managed-extensibility-framework-preview-5-released.aspx](http://blogs.msdn.com/brada/archive/2009/04/13/managed-extensibility-framework-preview-5-released.aspx)**

谢谢。

# java - How can I manage sessions in Java EE?

> ID：743989
> 
> 赞同：4
> 
> 时间：2009-04-13T14:12:15.127
> 
> 标签：java, jakarta-ee, session

In my Java EE application, I have a problem with sessions. Different users can login to the application and the specified user can see the data for which he is authorized. He should not be able to see other user data. To differentiate users, we are using `Client_ID`. As soon as the user logs in we are fetching this `Client_ID` from the database and setting it in session like this:

```
session.setAttribute("Client_ID",user.getClient_ID()) 
```

We access this session value throughout the application and fetching the relevant data to that `Client_ID`. This works fine when users work on a single browser, but the problem is this:

Suppose there is a SuperAdmin, who needs to look all the clients under him. SuperAdmin logs in as `client_1`, and again as `client_2`. SuperAdmin has logged in both times using the same browser. When I refresh the `client_1` browser, I am seeing the `client_2` details, which should not happen.

I think our application is using the same session for two different logins in the same browser. What would be solution for this problem? I should see the correct data for the particular client when I refresh the page.

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-13T14:42:30.033

不要使用 cookie 来存储 Session ID，而是使用请求参数。所以每个打开的选项卡都会请求自己的会话。使用 cookie，您对浏览器中的所有选项卡只有一个 cookie。

PS：我认为在一个浏览器中同时登录2个或更多用户是不正确的。您的应用程序应该检测到 client_1 已经对其进行了签名，并限制其他用户从同一浏览器登录，直到注销。例如，谷歌的应用程序就是这样工作的。如果 SuperAdmin 具有无需登录即可查看 client_1 或 client_2 数据的功能，那也很棒。这将使他/她免于记住数十个密码并提高工作绩效（时间就是金钱，不是吗？）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-13T15:43:03.320

如果您希望同一个浏览器实例中的多个选项卡看到不同的内容，那么您将不得不重新设计会话管理并将内容从 URL 中删除。

会话在浏览器选项卡之间共享（对于大多数浏览器来说都是如此），因此使用一个选项卡登录会影响其他选项卡的会话。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-13T16:37:44.000

解决方案是使用角色而不是多个登录。您将赋予 client_1 超级管理员角色，而客户端 2 则没有。这将减少两次登录的需要。

但无论如何，您应该只允许一个用户一次登录。登录过程应使先前的会话无效。我忘记了 Java EE 中的确切代码，但它类似于`session.invalidate()`.

# jquery - 如何使用 ID 变量在 jQuery 中选择元素？

> ID：743994
> 
> 赞同：110
> 
> 时间：2009-04-13T14:13:19.477
> 
> 标签：jquery, syntax, select

例如，以下选择 id="2" 的部门：

```
row = $("body").find("#2"); 
```

我该怎么做这样的事情：

```
row_id = 5;
row = $("body").find(row_id); 
```

上面的语法会产生错误。我在这里检查了 jQuery 文档和答案，但没有成功。

* * *

## 回答 #1

> 赞同：205
> 
> 时间：2009-04-13T14:16:41.920

```
row = $("body").find('#' + row_id); 
```

更重要的是做额外的 body.find 对性能没有影响。正确的方法很简单：

```
row = $('#' + row_id); 
```

* * *

## 回答 #2

> 赞同：47
> 
> 时间：2009-04-13T14:31:47.047

最短的方法是：

```
$("#" + row_id) 
```

将搜索限制在身体上没有任何好处。

此外，您应该考虑将您`id`的 s 重命名为更有意义的东西（并且根据 Paolo 的回答符合 HTML），特别是如果您还有另一组数据也需要命名。

* * *

## 回答 #3

> 赞同：27
> 
> 时间：2009-04-13T14:34:23.843

`$('body').find();`通过ID查找时无需执行；没有性能增益。

另请注意，以数字开头的 ID[不是有效的 HTML](http://www.w3.org/TR/html4/types.html#type-id)：

> ID 和 NAME 标记必须以字母 ([A-Za-z]) 开头，后跟任意数量的字母、数字 ([0-9])、连字符 ("-")、下划线 ("_") , 冒号 (":") 和句点 (".")。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-04-13T14:15:57.570

你可以这样做：

```
row_id = 5;
row = $("body").find('#'+row_id); 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-13T14:20:02.443

你的代码有两个问题

1.  要按 ID 查找元素，您必须在其前面加上“#”
2.  当需要字符串时，您试图将数字传递给查找函数（传递“#”+ 5 将解决此问题，因为它会首先将 5 转换为“5”）

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-13T14:15:42.780

我对jQuery不太了解，但试试这个：

```
row_id = "#5";
row = $("body").find(row_id); 
```

编辑：当然，如果变量是一个数字，你必须添加`"#"`到前面：

```
row_id = 5
row = $("body").find("#"+row_id); 
```***************